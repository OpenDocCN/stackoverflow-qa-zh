# StackOverflow 问答 000147000-000147999

# c++ - 常见的可写应用程序文件放在哪里？

> ID：147016
> 
> 赞同：17
> 
> 时间：2008-09-28T23:39:19.130
> 
> 标签：c++, windows, winapi, uac, application-data

我认为这`CSIDL_COMMON_APPDATA\company\product`应该是放置应用程序所有用户通用的文件并且应用程序可以修改的地方，但是，在 Vista 上，这是一个只读位置，除非由安装程序修改（根据 MSDN - [http： //msdn.microsoft.com/en-us/library/ms995853.aspx](http://msdn.microsoft.com/en-us/library/ms995853.aspx)），所以......什么是最好的？修改位置的安全设置以允许写入或`CSIDL_COMMON_DOCUMENTS\company\product`改用？也许还有第三种选择？

另外，在某个地方是否有“官方”微软推荐？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-28T23:55:15.490

仅修改 AppData 目录的特定子目录上的安全性（来自[您提供的链接](http://msdn.microsoft.com/en-us/library/ms995853.aspx)）：

> CSIDL_COMMON_APPDATA 此文件夹应该用于非用户特定的应用程序数据。例如，应用程序可以在 CSIDL_COMMON_APPDATA 文件夹中存储拼写检查字典、剪贴画数据库或日志文件。此信息不会漫游，任何使用计算机的人都可以使用。默认情况下，此位置对于普通（非管理员、非电源）用户是只读的。**如果应用程序要求普通用户对 CSIDL_COMMON_APPDATA 的应用程序特定子目录具有写访问权限，则应用程序必须在应用程序设置期间显式修改该子目录的安全性。**修改后的安全必须记录在供应商问卷中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-08-21T04:53:23.883

下面是一个简单示例，展示了如何为 Common App Data 文件夹 (CSIDL_COMMON_APPDATA) 中的所有用户创建具有读/写权限的文件和文件夹。任何用户都可以运行此代码以授予所有其他用户写入文件和文件夹的权限：

```
#include <windows.h>

#include <shlobj.h>
#pragma comment(lib, "shell32.lib")

// for PathAppend
#include <Shlwapi.h>
#pragma comment(lib, "Shlwapi.lib")

#include <stdio.h>
#include <aclapi.h>
#include <tchar.h>
#pragma comment(lib, "advapi32.lib")    

#include <iostream>
#include <fstream>
using namespace std;

int _tmain(int argc, _TCHAR* argv[])
{
    DWORD dwRes, dwDisposition;
    PSID pEveryoneSID = NULL;
    PACL pACL = NULL;
    PSECURITY_DESCRIPTOR pSD = NULL;
    EXPLICIT_ACCESS ea;
    SID_IDENTIFIER_AUTHORITY SIDAuthWorld = SECURITY_WORLD_SID_AUTHORITY;
    SID_IDENTIFIER_AUTHORITY SIDAuthNT = SECURITY_NT_AUTHORITY;
    SECURITY_ATTRIBUTES sa;

    // Create a well-known SID for the Everyone group.
    if (!AllocateAndInitializeSid(&SIDAuthWorld, 1,
                     SECURITY_WORLD_RID, 0, 0, 0, 0, 0, 0, 0,
                     &pEveryoneSID))
    {
        _tprintf(_T("AllocateAndInitializeSid Error %u\n"), GetLastError());
        goto Cleanup;
    }

    // Initialize an EXPLICIT_ACCESS structure for an ACE.
    // The ACE will allow Everyone access to files & folders you create.
    ZeroMemory(&ea, sizeof(EXPLICIT_ACCESS));
    ea.grfAccessPermissions = 0xFFFFFFFF;
    ea.grfAccessMode = SET_ACCESS;

    // both folders & files will inherit this ACE
    ea.grfInheritance= CONTAINER_INHERIT_ACE|OBJECT_INHERIT_ACE;
    ea.Trustee.TrusteeForm = TRUSTEE_IS_SID;
    ea.Trustee.TrusteeType = TRUSTEE_IS_WELL_KNOWN_GROUP;
    ea.Trustee.ptstrName  = (LPTSTR) pEveryoneSID;

    // Create a new ACL that contains the new ACEs.
    dwRes = SetEntriesInAcl(1, &ea, NULL, &pACL);
    if (ERROR_SUCCESS != dwRes)
    {
        _tprintf(_T("SetEntriesInAcl Error %u\n"), GetLastError());
        goto Cleanup;
    }

    // Initialize a security descriptor.
    pSD = (PSECURITY_DESCRIPTOR) LocalAlloc(LPTR, SECURITY_DESCRIPTOR_MIN_LENGTH);
    if (NULL == pSD)
    {
        _tprintf(_T("LocalAlloc Error %u\n"), GetLastError());
        goto Cleanup;
    }

    if (!InitializeSecurityDescriptor(pSD, SECURITY_DESCRIPTOR_REVISION))
    {
        _tprintf(_T("InitializeSecurityDescriptor Error %u\n"), GetLastError());
        goto Cleanup;
    }

    // Add the ACL to the security descriptor.
    if (!SetSecurityDescriptorDacl(pSD,
            TRUE,     // bDaclPresent flag
            pACL,
            FALSE))   // not a default DACL
    {
        _tprintf(_T("SetSecurityDescriptorDacl Error %u\n"), GetLastError());
        goto Cleanup;
    }

    // Initialize a security attributes structure.
    sa.nLength = sizeof(SECURITY_ATTRIBUTES);
    sa.lpSecurityDescriptor = pSD;
    sa.bInheritHandle = FALSE;

    TCHAR szPath[MAX_PATH];

    if (SUCCEEDED(SHGetFolderPath(NULL, CSIDL_COMMON_APPDATA|CSIDL_FLAG_CREATE, NULL, 0, szPath))) 
    {
        PathAppend(szPath, TEXT("Your Shared Folder"));

        if (!CreateDirectory(szPath, &sa)
            && GetLastError() != ERROR_ALREADY_EXISTS) 
        {
            goto Cleanup;
        }

        PathAppend(szPath, TEXT("textitup.txt"));

        HANDLE hFile = CreateFile(szPath, GENERIC_READ | GENERIC_WRITE, 0, &sa, CREATE_ALWAYS, 0, 0);
        if (hFile == INVALID_HANDLE_VALUE)
            goto Cleanup;
        else
            CloseHandle(hFile);

        //TODO: do the writing
        ofstream fsOut;
        fsOut.exceptions(ios::eofbit | ios::failbit | ios::badbit);
        fsOut.open(szPath, ios::out | ios::binary | ios::trunc);

        fsOut << "Hello world!\n";
        fsOut.close();
    }

Cleanup:

    if (pEveryoneSID) 
        FreeSid(pEveryoneSID);
    if (pACL) 
        LocalFree(pACL);
    if (pSD) 
        LocalFree(pSD);

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T23:48:01.653

我认为[这篇文章](http://lists.runrev.com/pipermail/use-revolution/2007-February/094217.html)可能会回答一些问题，但对许多人来说似乎是一个难题。

显然，CSIDL_COMMON_DOCUMENTS 提供了一个常见的解决方法

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T00:07:50.327

Vista/UAC 指南可在[此处](http://msdn.microsoft.com/en-us/library/bb530410.aspx)找到。在该页面中搜索“ `CSIDL`”，您会找到一些“官方”答案。

# .net - 创建 Web 控件时，您应该覆盖 OnLoad 还是实现 Page_Load

> ID：147033
> 
> 赞同：9
> 
> 时间：2008-09-28T23:54:56.347
> 
> 标签：.net, asp.net, web-controls

在 Visual Studio 中创建新的 Web 用户控件时，默认情况下会添加 Page_Load 事件。使用它而不是覆盖`OnLoad`控件上的基本事件有什么好处？只是`Page_Load`事件之前触发了`OnLoad`吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T00:06:20.220

该方法应该是引发事件`OnLoad`的地方。`Load`我个人总是尝试处理事件，除非我需要围绕引发事件进行额外处理。

我建议在正常情况下处理事件本身。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T00:15:55.813

您可能会发现[这篇](http://msdn.microsoft.com/en-us/library/ms178472.aspx)关于 Microsoft 页面生命周期的文章很有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T05:43:19.973

正如您在上面看到的，如果选择是明智的，它确实主要归结为个人选择。我见过的最好的快速但可靠的概述是[http://weblogs.asp.net/infinitiesloop/archive/2008/03/24/onload-vs-page-load-vs-load-event.aspx](http://weblogs.asp.net/infinitiesloop/archive/2008/03/24/onload-vs-page-load-vs-load-event.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T02:27:21.223

这真的只是一个选择问题。对我来说，一个对象将一个事件附加到自己上似乎很奇怪，尤其是当有一个可以覆盖的方法时。

我认为 ASP.NET 团队使用事件是因为这是 ASP 中 Global.asa 的模型，并且可以降低不了解继承和覆盖虚拟方法的开发人员的门槛。

覆盖该方法确实需要更多关于页面生命周期的知识，但它没有任何“错误”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-02T07:52:40.860

阅读MSDN 页面上名为*“绑定页面事件”的部分，标题为：* *“ASP.NET Web 服务器控制事件模型”*（[链接到页面](http://msdn.microsoft.com/en-us/library/y3bwdsh3.aspx)）有一些有用的语句，如下所示：

> **AutoEventWireup**属性的一个缺点是它要求页面事件处理程序具有特定的、可预测的名称。这限制了您命名事件处理程序的灵活性。另一个缺点是**性能受到不利影响**，因为 ASP.NET 在运行时搜索方法。对于具有高流量的网站，对性能的影响可能很大。

（*AutoEventWireup*标志打开诸如 Page_Load 之类的方法）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T00:28:05.193

即使您继承自`UserControl`，我认为您应该避免在不必要的情况下覆盖受保护的方法。可以让`Page_Load`您更轻松地添加特定于您的`UserControl`.

仅`OnLoad`当您需要绝对控制何时（/如果）`Load`触发事件时才覆盖（这应该很少见，IMO）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T08:20:22.950

我认为是一样的。恕我直言，有了事件，你就有了更多的灵活性，因为你的事件可以发生多个听众！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-16T08:47:30.757

我认为这两种方法存在一个潜在的显着差异。

我指的是控制执行顺序的能力。

如果您正在覆盖，您知道基类 Load 何时发生，因为您正在调用它。这提供了更多的控制，但正如许多人所说的那样，这可能是一件坏事。

如果您使用事件，您无法保证调用顺序。这迫使您编写 Load 事件，该事件应该不知道超类在 Load 阶段正在做什么。我认为这将是首选方法，也许这就是为什么 VS 自动生成的代码是这种方式的原因。

# visual-studio - VS 2008 在文件开头自动添加指定文本

> ID：147040
> 
> 赞同：3
> 
> 时间：2008-09-29T00:03:52.630
> 
> 标签：visual-studio, visual-studio-2008

有没有办法让 Visual Studio 2008 自动将标题信息添加到文件中？例如，“版权 2008”或类似的内容。我一直在研究这些选项，但似乎没有什么对我产生影响。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T00:06:36.320

我假设您想修改类文件模板。他们在：

```
%ProgramFiles%\Microsoft Visual Studio 9.0\Common7\IDE\ItemTemplates\CSharp\Code\1033 
```

[更具体的细节在这里](http://blogs.southworks.net/jpgarcia/2008/09/01/visual-studio-2008-templates-compliant-with-microsoft-stylecop/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T18:12:58.310

我找到了比直接修改模板文件更好的解决方案。此实用程序允许您创建和保存页眉/页脚模板并将它们应用于整个源代码树。

MSDN 代码库中的[C# 标头设计器](http://code.msdn.microsoft.com/HeaderDesigner)

# c# - 在c#中使用继承而不是名称别名是否正确？

> ID：147049
> 
> 赞同：6
> 
> 时间：2008-09-29T00:12:16.697
> 
> 标签：c#, inheritance, alias, typedef

换句话说，是否正确使用：

```
public class CustomerList : System.Collections.Generic.List<Customer>
{
    /// supposed to be empty
} 
```

代替：

```
using CustomerList = System.Collections.Generic.List<Customer> 
```

我宁愿使用第一种方法，因为我只定义了一次 CustomerList，每次我需要一个客户列表时，我总是使用相同的类型。另一方面，使用名称别名方法不仅迫使我不得不在任何地方重新定义它，而且每次有人想要使用它时都可以给一个不同的别名（想想一个大团队），从而导致代码可读性差。

请注意，这种情况下的意图绝不是扩展类，而只是创建一个别名。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T00:17:47.167

好吧，除非您向基类添加一些功能，否则创建包装器对象是没有意义的。如果你真的需要，我会选择第二个，但为什么不直接创建一个变量呢？

```
List<Customer> customerList = new List<Customer>(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T06:09:13.420

不要这样做。当人们阅读：

```
List<Customer> 
```

他们立刻明白了。当他们读到：

```
CustomerList 
```

他们必须去弄清楚 CustomerList 是什么，这会使您的代码更难阅读。除非你是唯一一个在你的代码库上工作的人，否则编写可读的代码是个好主意。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T08:58:14.700

我同意*不*以这种方式使用别名。您的团队中的任何人都不应该以所呈现的方式使用别名；这不是提供别名的原因。此外，从泛型的工作方式来看，无论您在多少地方使用它，都只有一个 List 类。

除了声明和使用 之外`List<Customer>`，您最终还希望将该列表传递给其他东西。避免传递具体内容`List<Customer>`，而是传递一个`IList<Customer>`or `ICollection<Customer>`，因为这将使这些方法更具弹性并且更容易编程。

将来的某一天，如果你真的需要一个 CustomerList 集合类，你可以在它上面实现`ICollection<Customer>`or`IList<Customer>`并继续将它传递给那些方法，而不用改变它们甚至不知道更好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T01:01:34.427

其实你也不应该使用。根据[框架设计指南，正确的方法是在公共 API 中使用或继承 System.Collections.ObjectModel.Collection<T>](http://blogs.msdn.com/kcwalina/archive/2004/03/15/89860.aspx)（List<T> 只能用于内部实现）。

但是关于命名的具体问题，建议似乎是直接使用泛型类型名称而不使用别名，除非您需要向集合添加功能：

> 务必从对象模型返回 Collection<T> 以提供标准的普通香草集合 API。
> 
> 请务必从对象模型返回 Collection<T> 的子类以提供高级集合 API。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-07-30T20:11:48.930

使用继承来做别名/类型定义的问题是需要你重新定义相关的构造函数。

由于在任何地方都这样做很快就会变得不合理，为了保持一致性，最好避免这样做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T00:20:10.530

这是那些“视情况而定”的问题之一。

如果您需要的是一个新类，除了您的其他要求之外，它还充当客户列表，那么继承就是方法。

如果您只想使用客户列表，请使用该变量。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T00:22:46.703

如果您只是想节省打字，请使用后者。这样你就不会遇到任何奇怪的继承问题。

如果你真的想公开一个逻辑上不同的集合类型，那么使用前者 - 你可以回去然后向它添加东西。

就个人而言，我会使用`List<Customer>`并收工。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T00:23:25.173

我基本上同意埃德的观点。如果您不需要实际扩展泛型 List 构造的功能，只需使用泛型 List：

```
List<Customer> customerList = new List<Customer>(); 
```

如果您确实需要扩展功能，那么通常您会考虑继承。

第三种可能性是您需要从通用列表构造中显着更改功能，在这种情况下，您可能希望简单地从 IEnumerable 继承。这样做可以使类在可枚举操作（例如“foreach”）中可用，但允许您完全定义所有类行为。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T00:46:55.023

一个程序员在打字上的节省很可能是下一个程序员的维护噩梦。我想说只是正确地输入泛型，正如这里很多人所说的那样。它更清晰、更准确地描述了您的代码意图，并且有助于维护程序员。（谁可能是你，六个月和四个新项目！）

# php - 正则表达式：抓住一切，直到一个特定的词

> ID：147052
> 
> 赞同：32
> 
> 时间：2008-09-29T00:14:39.547
> 
> 标签：php, html, regex

前任：`<a><strike>example data in here</strike></a>`

我想要 a 标签内的所有内容，到最后

```
/<a>([^<]*)<\/a>/ 
```

它在标签内没有其他标签时有效`<a>`，但如果有呢？

我想知道你是否可以告诉它抓住一切`[^</a>]`而不是`[^<]`仅仅。

这样做`/<a>(.*)<\/a>/`效果不好。有时我会在`<a>`标签中获得所有内容，而其他时候我会在该调用中包含大量行。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-09-29T00:17:36.620

```
/<a>(.*?)<\/a>/ 
```

应该管用。这 ？`</a>`使它变得懒惰，因此在匹配零件之前它会尽可能少地抓取。但使用 . 将意味着它匹配所有内容，直到找到`</a>`. 如果您希望能够跨行匹配，可以使用以下 if 与[preg_match](http://ca3.php.net/manual/en/function.preg-match.php)

```
/<a>(.*?)<\/a>/s 
```

末尾的“s”将正则表达式置于“单行”模式，这意味着 . 字符匹配所有字符，包括换行符。查看[其他有用的修饰符](http://php.net/manual/en/reference.pcre.pattern.modifiers.php)

# c# - Outlook attachments.Add() 未显示在邮件正文中

> ID：147053
> 
> 赞同：3
> 
> 时间：2008-09-29T00:15:01.073
> 
> 标签：c#, outlook, office-2007

我正在 C# VS-2008 Outlook 2007 中创建一个新邮件项目，并附加一个文件。第一个问题是我在主题行下方看不到显示附件的附件区域。如果我发送电子邮件，它的属性会显示有一个附件，并且电子邮件的大小已经增加了附件数量。我只是看不到它或提取附件。

这是我正在使用的代码：

```
Outlook.MailItem mailItem = (Outlook.MailItem)this.Application.CreateItem(Outlook.OlItemType.olMailItem);
attachments.Add(ReleaseForm.ZipFile, Outlook.OlAttachmentType.olByValue, 0, "DisplayName"); 
```

我期望“DisplayName”部分将显示为附件名称，我应该使用文件名。

我不会以编程方式在电子邮件上调用 .Send()，而是调用 mailItem.Display(true) 向用户显示电子邮件以进行任何最终编辑。此时我可以查看属性并看到那里有一个附件。

如果我按发送（发送给自己），我会看到同样的内容，附件似乎在那里但无法访问。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T01:25:53.367

我发现了这个问题。我更改代码以使用以下内容：

```
attachments.Add(ReleaseForm.ZipFile, Outlook.OlAttachmentType.olByValue, Type.Missing, Type.Missing); 
```

Position 和 DisplayName 参数似乎控制了 olByValue 发生的情况。使用 Type.Missing，现在我可以在电子邮件中正确看到附件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-24T12:50:26.230

顺便说一句，如果您将 Position 设置为 0，您的附件将被隐藏：

[Attachment.Position 属性](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.outlook.attachment.position.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-19T01:34:14.227

我和你一样有问题，但即使我像你一样更改代码，但它似乎仍然无法正常工作。同样，它似乎已经在邮件项目中，但未显示在邮件项目显示中。好的，您必须确保 mailItem 正文不为空才能显示附件

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-09-22T18:06:17.017

有点旧的帖子，但正如其他一些人提到的，使用

```
attachments.Add(path, Outlook.OlAttachmentType.olByValue, Type.Missing, Type.Missing); 
```

也没有帮助我，所以我想我会分享一种替代方法。这个问题的解决方案最终是`mailItem.Save();`在你打电话之前打电话`mailItem.Display(true);`。这将刷新 Outlook 表单以显示您的附件。还值得指出的是，它将消息保存到草稿中。如果您希望用户发送电子邮件，这不是问题，但如果他们取消，它将留在他们的草稿文件夹中。

# c - unix路径搜索C函数

> ID：147057
> 
> 赞同：3
> 
> 时间：2008-09-29T00:16:49.400
> 
> 标签：c, unix, path

我正在编写一个 UNIX shell，我必须使用`execv()`系统调用来创建一个进程。的参数之一`execv()`是可执行文件的文件路径。因此，如果有人输入`/bin/ls`，它将运行`ls`可执行文件。但我需要的是一个函数，当`ls`输入时，它将搜索`ls`（如`which`命令）的文件路径。有没有允许我这样做的功能？

不幸的是，这是一个学校项目，我不允许使用`execvp()`。我需要实现一些路径搜索功能，然后将该文件路径添加到`execv()`参数中。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T13:33:05.507

用于`PATH = getenv("PATH")`从环境中获取路径字符串，然后使用对`strtok(PATH,":")`then`strtok(NULL,":")`的连续调用将字符串中的路径解析`PATH`为 的数组`char **path`，您需要使用`malloc()`. 将`path[x]`++`'/'`放入`argv[0]`缓冲区，并用于`access(buffer, X_OK)`查看是否可以在该路径位置执行文件，如果可以，请执行`execv(buffer,argv)`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T00:20:33.883

您需要 execvp()，它将搜索 PATH 变量中指定的路径，除非文件名包含“/”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T00:27:47.033

使用`execvp`.

```
char *args[] = {"ls", (char *) NULL};
execvp("ls", args); 
```

例如，此示例将执行`/bin/echo`（假设`/bin`在您的 PATH 上）。

```
#include <unistd.h>

int main()
{
    char *args[] = {"echo", "hello world", (char *) NULL};
    execvp("echo", args);
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T00:29:31.787

如果您不能使用 execvp，您可以`char** environ`从 <unistd.h> 或`char* getenv(const char* name)`<stdlib.h> 获取 PATH 变量，然后用于`int access(const char* filename, int mode)`查看文件是否存在并且是否可执行。我将把实施留给你，因为这是一个学校项目。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T00:18:50.347

我认为 execvp() 可以满足您的需要。

**编辑：**所以您实际上是在问如何手动执行此操作？在这种情况下...

1.  在 envp 中找到你的 PATH（main() 的第三个参数）
2.  将其拆分为单独的路径
3.  使用 stat() 检查您的程序在每个程序中是否存在
4.  执行你发现存在的第一个

或者，如果您想要一个*真正*可靠的实现，请使用[this](http://cvsweb.netbsd.org/bsdweb.cgi/src/lib/libc/gen/execvp.c?rev=1.24&content-type=text/x-cvsweb-markup)。不过，它可能会引发剽窃检测器:)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T00:38:40.807

`access()`一些人建议您`stat()`在尝试使用`execv()`. 你不需要这样做。`execv()`如果无法执行请求的文件，将返回错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T00:20:14.227

`execvp`:-)

编辑：好的。这是一个 Perl 版本，它可以作为您的问题的伪代码。

```
use List::Util qw(first);

my @path = split /:/, $ENV{PATH};
my $dir = first {$_ ||= '.'; -x "$_/$name"} @path
    or die "Can't find program $name\n";
exec "$dir/$name", @args; 
```

`split`使用给定的分隔符将字符串拆分为字符串数组。`first`找到符合某个标准的第一个项目；在这里，目录和正在寻找的名称的连接是可执行的（`-x`）。然后它运行。

希望能帮助到你！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T00:26:15.010

从 execvp 手册页：

```
 The  functions  execlp() and execvp() will duplicate the actions of the
   shell in searching for an executable file  if  the  specified  filename
   does  not  contain  a slash (/) character.  The search path is the path
   specified in the environment by the PATH variable.   If  this  variable
   isn’t specified, the default path ‘‘:/bin:/usr/bin’’ is used.  In addi-
   tion, certain errors are treated specially. 
```

也许您可以使用 execlp()？如果必须使用 execv，则需要获取 PATH 环境变量的值，使用 strtok() 解析它以获取各个路径，将文件名附加到每个路径并尝试使用 execv() 执行它。

我会提供代码，但我不会为你做作业。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T17:13:52.480

哦，学校项目...

好吧，如果您想要“类似哪个”的东西，为什么不直接执行“哪个”本身（Linux 上的 /usr/bin/which，而不是 bash 别名或 tcsh 内置）来获取您正在寻找的路径...

:-)

# iphone - iPhone 是否支持 XML-RPC？

> ID：147062
> 
> 赞同：6
> 
> 时间：2008-09-29T00:19:56.240
> 
> 标签：iphone, xml-rpc

iPhone 是否支持 XML-RPC，我可以使用它们的任何开源框架吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T00:52:39.237

查看 wordpress 应用程序的源代码。他们可能正在使用 XML-RPC。:)

[http://iphone.wordpress.org/](http://iphone.wordpress.org/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-29T02:47:51.143

[“Airsource Ltd”](https://stackoverflow.com/questions/147062/does-iphone-support-xml-rpc#147071)*对*那份文件的看法确实*非常* 错误。该文档特定于 Mac OS X 而*不是*iPhone。事实上（几乎）所有 Apple iPhone 文档都隐藏在登录页面和许可协议后面。文档中提到的大多数技术（例如 AppleScript）甚至都不存在于 iPhone 上。

 **阿米特，如果你听从 Airsource 的建议，你的运气就会为零。但是，如果您按照“ [Lounge](https://stackoverflow.com/questions/147062/does-iphone-support-xml-rpc#147127) ”所说的那样去获取 wordpress 源代码，那么您会做得很好。看起来他们推出了自己的 XMLRPC 库以在 iPhone 上使用。

至于 SOAP - 你自己。不过，您也许能够找到一个构建在 libxml2 之上的开源 SOAP 库。祝你好运。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-04T03:58:35.250

是的 iPhone 支持 XML-RPC 和 wordpress 开源应用程序是最好的例子，但从性能方面我必须说 JSON 更适合 iPhone 应用程序使用，

从这里[https://github.com/stig/json-framework/](https://github.com/stig/json-framework/)你可以下载 JSON 解析器。

# c# - 服务如何控制自己的状态？

> ID：147083
> 
> 赞同：0
> 
> 时间：2008-09-29T00:30:29.460
> 
> 标签：c#

我有一个从 ServiceBase 类继承的标准 Windows 服务器。

在 OnStart 方法上，我想在了解我的服务的主要目的之前检查某些条件。

例如：

```
protected override void OnStart(string[] args)
{
  if (condition == false)
  {
    EventLog.WriteEntry("Pre-condition not met, service was unable to start");

    // TODO: Convert service state to "Stopped" because my precondition wasn't met
    return;
  }

  InnitializeService();
} 
```

任何人都有一个很好的例子来说明服务如何控制自己的状态？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-29T00:32:45.820

抛出异常。这将导致服务 MMC 出错 - 异常消息和堆栈将自动记录到事件日志中。在这种情况下，我使用 ApplicationException。

此外，服务将返回“未运行”状态。

如果以后需要停止，可以调用 ServiceBase 上的 Stop 方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T01:01:50.853

在“计算机管理”MMC 应用程序中向用户显示的错误似乎无法在 Vista 中正确获取异常文本。它显示以下内容：

> 本地计算机上的“您的服务名称”服务启动然后停止。如果某些服务没有被其他服务或程序使用，它们会自动停止。

但是，它可以正确写入事件日志。

很酷。谢谢。

# ubuntu - 如何在 Ubuntu 服务器上继承权限？

> ID：147084
> 
> 赞同：0
> 
> 时间：2008-09-29T00:30:34.890
> 
> 标签：ubuntu, system-administration

对于第二个新手问题，我很抱歉，我是开发人员而不是系统管理员，所以这对我来说都是全新的。我希望我能清楚地解释自己！开始。

这是我所做的：

*   **登录到 root 帐户**

*   创建帐户“richard”和“austin”

*   创建了“开发者”组，并在其中添加了“理查德”和“奥斯汀”

*   创建目录/server，并使用“chown richard:developers /server”更改所有者

*   将 /server 的权限更改为 drwxrwxr-x（以便组可以写入）

*   **退出 root 帐户，并进入“richard”帐户**

*   创建目录 /server/production 和 /server/staging

*   在 /server 中使用“ls -l”列出内容，并找到 drwxr-xr-x 的权限以及 /server/production 和 /server/staging 的“richard:richard”所有权。因此，“austin”可以在 /server 目录内进行编辑，但不能在“richard”创建的目录内进行编辑。

我究竟做错了什么？我想确保在 /server 目录中创建的任何文件或文件夹都具有组写入权限并且属于开发人员组。我该怎么做？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T00:36:27.077

看起来您想使用“chmod g+s”或“chmode 2775”来获取在目录上设置的 SetGID 位，如果我正确记住了我的权限模式，那应该保留该组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T00:36:44.983

当您以 Richard 的身份创建目录时，系统假定您是所有者并将您设置为所有者，您可以手动更改所有权和权限

```
sudo chown richard:developers
sudo chmod 775 
```

或
设置创建文件/文件夹的默认权限（找到：[http](http://wiki.slicehost.com/doku.php?id=setting_up_ubuntu_slice_with_django_postgresql_ledgersmb_and_openvpn) ://wiki.slicehost.com/doku.php?id=setting_up_ubuntu_slice_with_django_postgresql_ledgersmb_and_openvpn ）
或
使用acl（参见：[http://ubuntuforums.org/showpost.php? p=3718480&postcount=12](http://ubuntuforums.org/showpost.php?p=3718480&postcount=12) ) 了解详情

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T00:32:14.900

你是如何改变/server的权限的？如果没有，请递归执行。

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T05:56:39.587

您必须设置了限制性 umask

编辑 ~/.bash_profile

并修改特定用户的 umask 设置。

[http://en.wikipedia.org/wiki/Umask](http://en.wikipedia.org/wiki/Umask)

# .net - 是否有任何免费的方法可以将 html 页面转换为 .net 的图像

> ID：147100
> 
> 赞同：8
> 
> 时间：2008-09-29T00:36:29.820
> 
> 标签：.net, html, rendering, screenshot, webpage

我想获取 html，包括文本和图像，并将其转换为包含所有内容的图像。有免费的方法吗？

这是使用.net 3.5。

### 也可以看看：

[服务器生成的网页截图？](https://stackoverflow.com/questions/119116/server-generated-web-screenshots)
[创建网页缩略图的最佳方法是什么？](https://stackoverflow.com/questions/65078/what-is-the-best-way-to-create-a-web-page-thumbnail)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T00:43:27.823

您可以查看[此项目](http://www.codeproject.com/KB/graphics/IECapture.aspx)或[此页面](http://www.developerfusion.co.uk/show/4712/)。

希望有帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T02:31:54.903

这是我几周前在我的博客上发布的一些代码：

[C#：生成网页缩略图截图图像](http://pietschsoft.com/post.aspx?id=2a628f30-fe83-4e44-a34b-f31be76d1b4f)

我还将在下面发布它的代码：

```
public Bitmap GenerateScreenshot(string url)
{
    // This method gets a screenshot of the webpage
    // rendered at its full size (height and width)
    return GenerateScreenshot(url, -1, -1);
}

public Bitmap GenerateScreenshot(string url, int width, int height)
{
    // Load the webpage into a WebBrowser control
    WebBrowser wb = new WebBrowser();
    wb.ScrollBarsEnabled = false;
    wb.ScriptErrorsSuppressed = true;
    wb.Navigate(url);
    while (wb.ReadyState != WebBrowserReadyState.Complete) { Application.DoEvents(); }

    // Set the size of the WebBrowser control
    wb.Width = width;
    wb.Height = height;

    if (width == -1)
    {
        // Take Screenshot of the web pages full width
        wb.Width = wb.Document.Body.ScrollRectangle.Width;
    }

    if (height == -1)
    {
        // Take Screenshot of the web pages full height
        wb.Height = wb.Document.Body.ScrollRectangle.Height;
    }

    // Get a Bitmap representation of the webpage as it's rendered in the WebBrowser control
    Bitmap bitmap = new Bitmap(wb.Width, wb.Height);
    wb.DrawToBitmap(bitmap, new Rectangle(0, 0, wb.Width, wb.Height));
    wb.Dispose();

    return bitmap;
} 
```

以下是一些示例用法：

```
// Generate thumbnail of a webpage at 1024x768 resolution
Bitmap thumbnail = GenerateScreenshot("http://pietschsoft.com", 1024, 768);

// Generate thumbnail of a webpage at the webpage's full size (height and width)
thumbnail = GenerateScreenshot("http://pietschsoft.com");

// Display Thumbnail in PictureBox control
pictureBox1.Image = thumbnail;

/*
// Save Thumbnail to a File
thumbnail.Save("thumbnail.png", System.Drawing.Imaging.ImageFormat.Png);
*/ 
```

# editor - 什么是可在 Web 上使用的可靠的、功能齐全的开放富文本表示？

> ID：147104
> 
> 赞同：8
> 
> 时间：2008-09-29T00:37:51.610
> 
> 标签：editor, wysiwyg, richtext

我正在寻找**text**的内部表示格式，它将支持基本格式（字体、大小、粗细、缩进、基本表格，**还支持**以下功能：

*   双向输入（希伯来语、阿拉伯语等）
*   同一文本字段中的多语言输入（即 UTF-8）
*   锚定脚注（即上标数字是指向该编号脚注的链接）

我猜[TEI](http://www.tei-c.org/index.xml)或[DocBook](http://www.docbook.org/)已经足够丰富了，但这里有个问题——我希望这些文本缓冲区是**Web 可编辑的**，所以我需要一个可以使用 TEI 或 DocBook 的编辑控件，或者在其中一个之间进行**可靠**的**双向**转换以及编辑控件可以吃的任何东西。

更新：我正在考虑的编辑控件类似于[TinyMCE](http://tinymce.moxiecode.com/)，但是 AFAICT，TinyMCE 缺少脚注，而且我不确定它的可扩展性（编辑 1 或 2 兆字节的文本怎么样？）

非常感谢任何指针！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T01:17:15.730

FCKeditor 有很棒的 AP​​I，支持多种编程语言（考虑到是 javascript 这并不难实现），可以通过 HTML 加载或在代码中实例化；但最重要的是，它允许轻松访问底层表单字段，因此拥有一个 jQuery 或原型 ajax 缓冲区应该不会很难实现。

与以前的版本相比，加载时间非常快。我会试一试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T11:38:39.060

根据我的经验，HTML 和 XML 格式（如 TEI 或 DocBook）之间的双向转换很难做到 100% 可靠。

您可以使用[Xopus](http://xopus.com) ( [demo](http://xopus.com/files/demo/xopus/xopus.html#/files/demo/examples/Simple/start.html) ) 让您的用户直接编辑 TEI 或 DocBook XML。Xopus 是一个基于商业浏览器的 XML 编辑器，专为非技术用户设计。它支持双向和 UTF-8。WYSIWYG 视图是使用 XSLT 呈现的，因此您可以充分控制以您描述的方式呈现脚注。

由于 TEI 和 DocBook 无法存储样式信息，这些格式将不允许您的用户更改字体、大小和粗细。但我认为这是一件好事：用户应该插入标题和强调，设计师应该选择字体和大小。

Xopus 有一个强大的表格编辑器，缩进是通过嵌套部分或列表来处理的，XSLT 对此作出反应。

不幸的是，Xopus 3 只能扩展到大约 200KB 的 XML，但我们正在[努力](http://2008.nwerc.eu/downloads/nwerc08-xopus.pdf)解决这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T01:09:10.477

我真的无法决定其中之一。恕我直言，它们都不是很好也不完整。它们都有自己的优点和明显的缺点。如果 TinyMCE 是您最喜欢的，那么 afaik，它也可以制作表格。

这个列表可能会派上用场：[WysiwygEditorComparision](http://code.google.com/p/wikimodel/wiki/WysiwygEditorComparision)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T03:43:38.810

我也使用过 FCKEditor，它表现良好并且很容易集成到我的项目中。值得一试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-16T12:51:35.143

对上面 laurens 的回答进行小幅修正：截至目前（2012 年 5 月），Xopus 支持 UTF8，但不支持 BiDi 编辑。如果来自其他来源的从右到左的文本显示正常，则无法正确编辑。资料来源：我最近被要求评估这个，所以一直在测试它。

# linux - 为什么关于“交换性”的讨论就像信息一次只能在一个地方一样？

> ID：147125
> 
> 赞同：4
> 
> 时间：2008-09-29T00:49:49.553
> 
> 标签：linux, memory, operating-system, performance

我一直在阅读 Linux 的“swappiness”可调参数，它控制内核在不使用时将应用程序的内存交换到磁盘的积极程度。如果你用谷歌搜索这个词，你会看到很多这样的页面[讨论](http://www.debian.co.nz/Tweak+your+swappiness.html)优缺点。简而言之，论点是这样的：

> 如果您的 swappiness 太低，不活动的应用程序将占用其他程序可能想要使用的所有系统内存。
> 
> 如果您的 swappiness 太高，当您唤醒那些不活动的应用程序时，将会有很大的延迟，因为它们的状态会从磁盘读回。

这个论点对我来说没有意义。如果我有一个使用大量内存的非活动应用程序，为什么内核不将其内存分页到磁盘并将该数据的另一个副本留在内存中？这似乎是两全其美：如果另一个应用程序需要该内存，它可以立即申请物理 RAM 并开始对其进行写入，因为它的另一个副本在磁盘上，并且可以在不活动的应用程序被唤醒时换回向上。当原始应用程序唤醒时，它的任何仍在 RAM 中的页面都可以按原样使用，而无需将它们从磁盘中拉出。

还是我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T02:12:44.097

> 如果我有一个使用大量内存的非活动应用程序，为什么内核不将其内存分页到磁盘并将该数据的另一个副本留在内存中？

可以说我们做到了。我们将页面写入磁盘，但将其留在内存中。过了一会儿，另一个进程需要内存，所以我们想从第一个进程中踢出页面。

我们需要绝对确定地知道第一个进程是否在页面被写入磁盘后对其进行了修改。如果有，我们必须重新写出来。我们跟踪这一点的方法是在我们第一次将其写入磁盘时将进程对页面的写权限带回。如果该进程再次尝试写入该页面，则会出现页面错误。在恢复写权限并允许应用程序继续之前，内核可以注意到该进程已经弄脏了页面（因此需要再次写出）。

问题就在于此。从页面中删除写权限实际上有点昂贵，尤其是在多处理器机器中。重要的是，所有 CPU 都清除其页面翻译缓存以确保它们取消写入权限。

如果进程确实写入页面，则发生页面错误会更加昂贵。我认为这些页面中的重要数量最终会承担这个错误，这会通过将其留在内存中来侵蚀我们正在寻找的收益。

那么值得做吗？老实说，我不知道。我只是想解释为什么将页面留在内存中并不像听起来那么明显。

(*) 这整个事情非常类似于一种称为 Copy-On-Write 的机制，它在进程 fork()s 时使用。子进程很可能只执行几条指令并调用 exec()，因此复制所有父页面会很愚蠢。取而代之的是，写权限被取消，孩子只是允许运行。Copy-On-Write 是一个胜利，因为几乎从未发生页面错误：孩子几乎总是立即调用 exec()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T01:05:02.107

即使您将应用程序内存分页到磁盘并将其保存在内存中，您仍然必须决定何时应将应用程序视为“非活动”，这就是交换性控制的内容。分页到磁盘在 IO 方面是昂贵的，您不想经常这样做。这个等式还有另一个变量，那就是 Linux 使用剩余内存作为磁盘缓冲区/缓存的事实。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T16:57:09.167

根据这个[1](http://www.linux-tutorial.info/modules.php?name=MContent&pageid=314)这正是 Linux 所做的。

我仍在尝试理解其中的很多内容，因此任何权威链接都将不胜感激。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-29T18:20:10.777

VM 做的第一件事是清理页面并将它们移动到清理列表中。
清理匿名内存时（没有实际文件后备存储的东西，您可以在 /proc//maps 中看到匿名的段，并且它们后面没有文件系统 vnode 存储），VM 要做的第一件事是取“脏”页面和“干净”页面，然后将页面内容写入交换。现在，当虚拟机缺少完全空闲的内存并且担心它是否能够授予新的空闲页面以供使用时，它可以通过“干净”页面的列表并根据它们最近的使用时间和内存类型它们会将这些页面移动到空闲列表中。

一旦内存页面被放置在空闲列表中，它们就不再与之前的内容相关联。如果一个程序引用了该页面先前服务的内存位置，则该程序将发生重大故障，并且将从空闲列表中抓取一个（很可能完全不同的）页面，并将数据从磁盘读入该页面。一旦完成，页面实际上仍然是“干净的”，因为它没有被修改过。如果 VM 选择在交换时使用该页面以换取 RAM 中的不同页面，则该页面将再次“脏”，或者如果应用程序写入该页面，它将被“脏”。然后该过程再次开始。

此外，对于业务/事务/在线/延迟敏感环境中的服务器应用程序，swappinness 非常可怕。当我有 16GB 的 RAM 盒子时，我没有运行很多浏览器和 GUI，我通常希望我的所有应用程序几乎都固定在内存中。我的大部分 RAM 往往是 8-10GB Java 堆，我*从来没有*想要分页到磁盘，永远，可用的垃圾是像mingetty这样的进程（但即使在那里，这些应用程序中的glibc页面也被其他应用程序共享并实际使用，因此即使是那些无用进程的RSS大小也大多是共享的，使用页）。我通常不会看到超过几个 10MB 的 16GB 实际清理以进行交换。我建议服务器的交换数量非常非常低或为零 - 未使用的页面应该是整个 RAM 的一小部分，并且试图回收相对少量的 RAM 用于缓冲区缓存可能会交换应用程序页面并导致延迟命中正在运行的应用程序。

# macos - 如何从 OS X 错误日志中诊断应用程序崩溃？

> ID：147126
> 
> 赞同：2
> 
> 时间：2008-09-29T00:51:40.097
> 
> 标签：macos, crash, kernel, error-logging

短问：这个例外是什么意思？“EXC_BAD_ACCESS (0x0001)”

完整问题：如何使用此错误日志信息（以及我在此处省略的线程详细信息）来诊断此应用程序崩溃？（注意：我没有崩溃日志或操作系统内核方面的专业知识。）

在这种情况下，我的电子邮件客户端 (Eudora) 在启动时立即崩溃，每次都没有明显的系统更改。

```
Host Name:      [name of Mac]
Date/Time:      2008-09-28 14:46:54.177 -0400
OS Version:     10.4.11 (Build 8S165)
Report Version: 4
Command: Eudora
Path:    /Applications/[...]/Eudora Application Folder/Eudora.app/Contents/MacOS/Eudora
Parent:  WindowServer [59]
Version: 6.2.4 (6.2.4)
PID:    231
Thread: 0
Exception:  EXC_BAD_ACCESS (0x0001)
Codes:      KERN_PROTECTION_FAILURE (0x0002) at 0x00000001 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T05:00:04.867

回答您的简短问题：EXC_BAD_ACCESS 表示非法内存访问。这意味着程序试图使用其虚拟地址空间之外的内存位置（粗略地说，它向操作系统内核请求的内存区域）。这就是Unix人通常所说的“分段错误”（segfault），而Windows人通常所说的“访问冲突”（AV）或“一般保护错误”（GPF）。（是的，你可能已经知道了。但我只是确保......）

崩溃报告是否说明引用了哪个内存地址？报告是否包括调用堆栈或核心转储？这三个都非常有价值，尤其是核心转储，因为您可以将其加载到调试器中并从异常点重新启动程序。如果内存地址看起来完全不正常（在虚拟地址的上半部分，或者非常接近 0，那么您就知道问题出在哪里了）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T05:22:45.123

只是为了完成迈克尔的回答 - 分析崩溃日志不是你应该做的。eudora 程序员搞砸了（或提供 eudora 程序员用来制作 eudora 的工具的人）。您可以做的最好的事情是将崩溃日志的全部内容复制并粘贴到邮件客户端（尝试 MAIL，因为您似乎无法使用 eudora，现在，哈哈哈），并将其发送到 eudora-support@ eudora.com 以及正在发生的事情的简短描述。找出问题所在是他们的工作。

# c# - c#绑定到和接口时向下转换

> ID：147129
> 
> 赞同：3
> 
> 时间：2008-09-29T00:53:02.323
> 
> 标签：c#, casting, oop

**除了向下转换之外，是否有更好的方法将基类列表绑定到 UI，例如：**

```
static void Main(string[] args) {
    List<Animal> list = new List<Animal>();  
    Pig p = new Pig(5);  
    Dog d = new Dog("/images/dog1.jpg");  
    list.Add(p);  
    list.Add(d);  
    foreach (Animal a in list)   
    {  
        DoPigStuff(a as Pig);  
        DoDogStuff(a as Dog);  
    }  

}  

static void DoPigStuff(Pig p)
{
    if (p != null) 
    {  
        label1.Text = String.Format("The pigs tail is {0}", p.TailLength);
    }  
}

static void DoDogStuff(Dog d) {
    if (d != null) 
    {
        Image1.src = d.Image;
    }
}

class Animal {
    public String Name { get; set; }
}

class Pig : Animal{
    public int TailLength { get; set; }

    public Pig(int tailLength) 
    {
        Name = "Mr Pig";
        TailLength = tailLength;
    }
}

class Dog : Animal {
    public String Image { get; set; }

    public Dog(String image) 
    {
        Name = "Mr Dog";
        Image = image;
    }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T01:01:33.723

为什么不让 Animal 包含 Pig 和 Dog 强制实现的抽象方法

```
public class Animal
{
    public abstract void DoStuff();
}

public Dog : Animal
{
    public override void DoStuff()
    {
        // Do dog specific stuff here
    }
}

public Pig : Animal
{
    public override void DoStuff()
    {
        // Do pig specific stuff here
    }
} 
```

这样，每个特定的类都对其操作负责，从而使您的代码更简单。你也不需要在你的 foreach 循环中进行强制转换。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T03:29:47.907

遇到此类问题时，我遵循[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)。

```
interface IVisitor
{
  void DoPigStuff(Piggy p);
  void DoDogStuff(Doggy d);
}

class GuiVisitor : IVisitor
{
  void DoPigStuff(Piggy p)
  {
    label1.Text = String.Format("The pigs tail is {0}", p.TailLength);
  }

  void DoDogStuff(Doggy d)
  {
    Image1.src = d.Image;
  }
}

abstract class Animal
{
    public String Name { get; set; }
    public abstract void Visit(IVisitor visitor);
}

class Piggy : Animal
{
    public int TailLength { get; set; }

    public Piggy(int tailLength) 
    {
        Name = "Mr Pig";
        TailLength = tailLength;
    }

    public void Visit(IVisitor visitor)
    {
       visitor.DoPigStuff(this);
    }
}

class Doggy : Animal 
{
   public String Image { get; set; }

   public Doggy(String image) 
   {
     Name = "Mr Dog";
     Image = image;
   }

   public void Visit(IVisitor visitor)
   {
     visitor.DoDogStuff(this);
   }
}

public class AnimalProgram
{
  static void Main(string[] args) {
    List<Animal> list = new List<Animal>();  
    Pig p = new Pig(5);  
    Dog d = new Dog("/images/dog1.jpg");  
    list.Add(p);  
    list.Add(d);

    IVisitor visitor = new GuiVisitor();  
    foreach (Animal a in list)   
    {
      a.Visit(visitor);
    }  
  }
} 
```

因此，访问者模式在传统的单分派面向对象语言（如 Java、Smalltalk、C# 和 C++）中模拟了双分派。

[与jop](https://stackoverflow.com/questions/147129/c-downcasting-when-binding-to-and-interface#147383)相比，此代码的唯一优势是，稍后当您需要添加新类型的访问者（如**XmlSerializeVisitor**或**FeedAnimalVisitor**）时，可以在不同的类上实现 IVisitor 接口。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T03:13:50.287

另一种方法是在调用方法之前执行类型检查：

```
if (animal is Pig) DoPigStuff();
if (animal is Dog) DoDogStuff(); 
```

您正在寻找的是多次调度。NO - C# 不支持多分派。它只支持单次调度。C#只能根据接收者的类型（即方法调用中.左侧的对象）动态调用方法

此代码使用[double-dispatch](http://en.wikipedia.org/wiki/Double_dispatch)。我会让代码自己说话：

```
class DoubleDispatchSample
{
    static void Main(string[]args)
    {
        List<Animal> list = new List<Animal>();
        Pig p = new Pig(5);
        Dog d = new Dog(@"/images/dog1.jpg");
        list.Add(p);
        list.Add(d);

        Binder binder = new Binder(); // the class that knows how databinding works

        foreach (Animal a in list)
        {
            a.BindoTo(binder); // initiate the binding
        }
    }
}

class Binder
{
    public void DoPigStuff(Pig p)
    {
        label1.Text = String.Format("The pigs tail is {0}", p.TailLength);
    }

    public void DoDogStuff(Dog d)
    {
        Image1.src = d.Image;
    }
}

internal abstract class Animal
{
    public String Name
    {
        get;
        set;
    }

    protected abstract void BindTo(Binder binder);
}

internal class Pig : Animal
{
    public int TailLength
    {
        get;
        set;
    }

    public Pig(int tailLength)
    {
        Name = "Mr Pig";
        TailLength = tailLength;
    }

    protected override void BindTo(Binder binder)
    {
        // Pig knows that it's a pig - so call the appropriate method.
        binder.DoPigStuff(this);
    }
}

internal class Dog : Animal
{
    public String Image
    {
        get;
        set;
    }

    public Dog(String image)
    {
        Name = "Mr Dog";
        Image = image;
    }

    protected override void BindTo(Binder binder)
    {
        // Pig knows that it's a pig - so call the appropriate method.
        binder.DoDogStuff(this);
    }
} 
```

注意：您的示例代码比这简单得多。我认为双重调度是 C# 编程中的重炮之一——我只是在万不得已的情况下才把它拿出来。但是如果有很多类型的对象和很多不同类型的绑定你需要做（例如你需要将它绑定到一个 HTML 页面但你还需要将它绑定到一个 WinForms 或一个报告或一个 CSV） ，我最终会重构我的代码以使用双重调度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T01:02:41.350

你没有充分利用你的基类。如果你的 Animal 类中有一个 Dog & Pig 覆盖的虚函数，你就不需要强制转换任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T01:44:45.367

除非您有更具体的示例，否则只需覆盖 ToString()。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T04:03:46.453

我认为您想要一个与工厂关联的视图类。

```
Dictionary<Func<Animal, bool>, Func<Animal, AnimalView>> factories;
factories.Add(item => item is Dog, item => new DogView(item as Dog));
factories.Add(item => item is Pig, item => new PigView(item as Pig)); 
```

然后你的 DogView 和 PigView 将继承 AnimalView 看起来像：

```
class AnimalView {
  abstract void DoStuff();
} 
```

你最终会做类似的事情：

```
foreach (animal in list)
  foreach (entry in factories)
    if (entry.Key(animal)) entry.Value(animal).DoStuff(); 
```

我想你也可以说这是策略模式的实现。

# c++ - 为什么 C++ 没有垃圾收集器？

> ID：147130
> 
> 赞同：291
> 
> 时间：2008-09-29T00:53:20.733
> 
> 标签：c++, garbage-collection, c++11

我之所以问这个问题，首先是因为垃圾收集的优点。我问这个的主要原因是我知道 Bjarne Stroustrup 说过 C++ 将在某个时间点有一个垃圾收集器。

说了这么多，怎么还没加呢？已经有一些用于 C++ 的垃圾收集器。这只是那些“说起来容易做起来难”的事情之一吗？还是有其他原因没有添加（并且不会在 C++11 中添加）？

交叉链接：

*   [C++ 的垃圾收集器](https://stackoverflow.com/questions/81062/garbage-collectors-for-c)

澄清一下，我理解 C++ 在首次创建时没有垃圾收集器的原因。我想知道为什么无法添加收集器。

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2008-09-29T00:58:30.970

可以添加隐式垃圾收集，但它没有成功。可能不仅是由于实施的复杂性，还因为人们无法足够快地达成普遍共识。

Bjarne Stroustrup 本人的一句话：

> 我曾希望可以选择启用的垃圾收集器将成为 C++0x 的一部分，但是有足够的技术问题，我只需要详细说明这种收集器如何与语言的其余部分集成即可，如果提供。与基本上所有 C++0x 功能的情况一样，存在实验性实现。

有一个很好的讨论主题[here](http://www.informit.com/guides/content.aspx?g=cplusplus&seqNum=222)。

**总体概述：**

C++ 非常强大，几乎可以让你做任何事情。出于这个原因，它不会自动将许多可能影响性能的东西推给您。垃圾收集可以很容易地用智能指针（用引用计数包装指针的对象，当引用计数达到 0 时自动删除自己）实现。

C++ 在构建时考虑了没有垃圾收集的竞争对手。与 C 和其他语言相比，效率是 C++ 必须抵御批评的主要问题。

有两种类型的垃圾收集...

**显式垃圾收集：**

C++0x 通过 shared_ptr 创建的指针进行垃圾收集

如果你想要它，你可以使用它，如果你不想要它，你不会被迫使用它。

对于 C++0x 之前的版本， boost:shared_ptr 存在并用于相同目的。

**隐式垃圾回收：**

虽然它没有透明的垃圾收集。不过，它将成为未来 C++ 规范的焦点。

**为什么 Tr1 没有隐式垃圾回收？**

C++0x 的 tr1 应该有很多东西，Bjarne Stroustrup 在之前的采访中表示 tr1 没有他想要的那么多。

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2010-02-24T14:40:11.600

在这里加入辩论。

垃圾收集存在已知问题，理解它们有助于理解为什么 C++ 中没有。

**1.性能？**

第一个抱怨通常是关于性能的，但大多数人并没有真正意识到他们在说什么。如`Martin Beckett`问题所示，可能不是性能本身，而是性能的可预测性。

目前有 2 个 GC 系列被广泛部署：

*   Mark-And-Sweep 类型
*   引用计数类型

速度更快（对整体性能的`Mark And Sweep`影响较小），但它遭受“冻结世界”综合症的困扰：即当 GC 启动时，其他一切都停止，直到 GC 完成清理。如果您希望构建一个可以在几毫秒内回答的服务器......有些事务将无法达到您的期望:)

的问题`Reference Counting`不同：引用计数增加了开销，尤其是在多线程环境中，因为您需要原子计数。此外，还有参考周期的问题，因此您需要一个聪明的算法来检测这些周期并消除它们（通常也通过“冻结世界”来实现，尽管频率较低）。一般来说，截至今天，这种（尽管通常反应更快，或者更确切地说，冻结的频率更低）比`Mark And Sweep`.

我看到了 Eiffel 实现者的一篇论文，该论文试图实现一个垃圾收集器，该垃圾收集器在没有“冻结世界”方面的情况下`Reference Counting`具有类似的全局性能。`Mark And Sweep`它需要一个单独的 GC 线程（典型）。算法有点吓人（最后），但这篇论文很好地一次介绍了一个概念，并展示了算法从“简单”版本到成熟版本的演变。推荐阅读，如果我能把我的手重新放在 PDF 文件上……

**2\. 资源获取即初始化（RAII）**

这是一个常见的习惯用法，`C++`因为您将资源的所有权包装在一个对象中以确保它们被正确释放。它主要用于内存，因为我们没有垃圾收集，但它在许多其他情况下也很有用：

*   锁（多线程，文件句柄，...）
*   连接（到数据库，另一台服务器，...）

这个想法是正确控制对象的生命周期：

*   只要你需要它就应该活着
*   完成后应该将其杀死

GC 的问题在于，如果它对前者有所帮助并最终保证以后……这个“最终”可能还不够。如果你释放一个锁，你真的很想现在就释放它，这样它就不会阻塞任何进一步的调用！

带有 GC 的语言有两种解决方法：

*   当堆栈分配足够时不要使用 GC：它通常用于性能问题，但在我们的例子中它确实有帮助，因为范围定义了生命周期
*   `using`构造...但它是显式（弱）RAII，而在 C++ 中 RAII 是隐式的，因此用户不能无意中犯错误（通过省略`using`关键字）

**3\. 智能指针**

智能指针通常作为处理内存的灵丹妙药出现在`C++`. 我经常听到：毕竟我们不需要 GC，因为我们有智能指针。

大错特错了。

智能指针确实有帮助：`auto_ptr`并且`unique_ptr`使用 RAII 概念，确实非常有用。它们非常简单，您可以很容易地自己编写它们。

但是，当需要共享所有权时，它会变得更加困难：您可能会在多个线程之间共享，并且在处理计数方面存在一些微妙的问题。所以，自然而然的走向`shared_ptr`。

这很棒，毕竟这就是 Boost 的用途，但它不是灵丹妙药。事实上，主要问题`shared_ptr`是它模拟了一个 GC 实现`Reference Counting`但你需要自己实现循环检测...... Urg

当然有这个`weak_ptr`东西，但不幸的是，尽管使用了这些循环，但我已经看到了内存泄漏`shared_ptr`......当你处于多线程环境中时，很难检测到！

**4\. 解决办法是什么？**

没有灵丹妙药，但一如既往，绝对可行。在没有 GC 的情况下，需要明确所有权：

*   如果可能的话，更喜欢在某个特定时间拥有一个所有者
*   如果没有，请确保您的类图没有任何与所有权有关的循环，并通过微妙的应用来打破它们`weak_ptr`

因此，确实，拥有 GC 会很棒……但这不是一个小问题。与此同时，我们只需要卷起袖子。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2008-09-29T00:56:11.333

什么样的？是否应该针对嵌入式洗衣机控制器、手机、工作站或超级计算机进行优化？
它应该优先考虑gui响应还是服务器加载？
它应该使用大量内存还是大量 CPU？

C/c++ 用于太多不同的情况。我怀疑像 boost smart pointers 这样的东西对于大多数用户来说就足够了

编辑 - 自动垃圾收集器不是性能问题（您总是可以购买更多服务器），而是可预测性能的问题。
不知道 GC 什么时候开始工作就像雇用一个嗜睡症的航空公司飞行员，大多数时候他们都很棒——但是当你真的需要响应时！

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-09-29T01:27:44.830

C++ 没有内置垃圾收集的最大原因之一是让垃圾收集与析构函数很好地配合起来非常非常困难。据我所知，没有人真正知道如何完全解决它。有很多问题需要处理：

*   对象的确定性生命周期（引用计数为您提供了这一点，但 GC 没有。虽然它可能没什么大不了的）。
*   如果在对象被垃圾回收时抛出析构函数会发生什么？大多数语言都会忽略此异常，因为实际上没有可以将其传输到的 catch 块，但这可能不是 C++ 可接受的解决方案。
*   如何启用/禁用它？自然，这可能是一个编译时间决定，但是为 GC 编写的代码与为 NOT GC 编写的代码将非常不同并且可能不兼容。你如何调和这个？

这些只是面临的一些问题。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2011-06-13T15:54:21.607

虽然这是一个*老*问题，但我仍然没有看到有人解决过一个问题：几乎不可能指定垃圾收集。

特别是，C++ 标准非常小心地根据外部可观察行为来指定语言，而不是实现如何实现该行为。然而，在垃圾收集的情况下，*几乎*没有外部可观察的行为。

垃圾收集的*一般思想*是它应该做出合理的尝试来确保内存分配成功。不幸的是，基本上不可能保证任何内存分配都会成功，即使您确实有一个垃圾收集器在运行。在任何情况下这在某种程度上都是正确的，但在 C++ 的情况下尤其如此，因为（可能）不可能使用复制收集器（或任何类似的东西）在收集周期中移动内存中的对象。

如果你不能移动对象，你就不能创建一个单一的、连续的内存空间来进行分配——这意味着你的堆（或自由存储，或者你喜欢叫它的任何东西）可以并且可能会，随着时间的推移变得支离破碎。反过来，这会阻止分配成功，即使可用内存多于请求的内存量也是如此。

虽然可能会提出*一些*保证（本质上），如果您重复完全相同的分配模式，并且第一次成功，它将在后续迭代中继续成功，前提是分配的内存在迭代之间变得无法访问。这是一个如此薄弱的保证，它基本上是无用的，但我看不到任何加强它的合理希望。

即便如此，它还是比为 C++ 提出的要强。先前的[提案](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2287.pd)[警告：PDF]（已被删除）根本不保证任何事情。在 28 页的提案中，阻碍外部可观察行为的是一个单一的（非规范性的）注释，上面写着：

> [注意：对于垃圾收集程序，高质量的托管实现应该尝试最大化它回收的不可达内存量。——尾注]

至少对我来说，这引发了一个关于投资回报的*严肃问题。*我们要破坏现有的代码（没有人知道具体多少，但肯定不少），对实现提出新的要求，对代码提出新的限制，而我们得到的回报很可能什么都没有？

即使充其量，我们得到的是基于[Java 测试的程序](http://www.cs.umass.edu/~emery/pubs/04-17.pdf)，它们可能需要大约六倍的内存才能以与现在相同的速度运行。更糟糕的是，垃圾收集从一开始就是 Java 的一部分——C++ 对垃圾收集器施加了足够多的限制，几乎可以肯定它的成本/收益比会*更差*（即使我们超出了提案所保证的范围并假设会有一些好处）。

我会以数学方式总结情况：这是一个复杂的情况。任何数学家都知道，复数有两部分：实数和虚数。在我看来，我们这里的成本是真实的，但收益（至少大部分）是想象的。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-09-29T01:04:16.993

> 如果你想要自动垃圾收集，有很好的 C++ 商业和公共领域的垃圾收集器。对于适合垃圾收集的应用程序，C++ 是一种出色的垃圾收集语言，其性能可与其他垃圾收集语言相媲美。有关 C++ 中自动垃圾收集的讨论，请参阅[The C++ Programming Language (4rd Edition)](http://www.stroustrup.com/4th.html)。另见，汉斯-J。Boehm 的[C 和 C++ 垃圾收集站点](http://www.hpl.hp.com/personal/Hans_Boehm/gc)（[存档](https://web.archive.org/web/20140214104520/http://www.hpl.hp.com/personal/Hans_Boehm/gc/)）。
> 
> 此外，C++ 支持允许内存管理[安全且隐式的编程技术，而无需垃圾收集器](http://www.stroustrup.com/bs_faq2.html#memory-leaks)。我认为垃圾收集是最后的选择，也是处理资源管理的一种不完美的方式。这并不意味着它永远不会有用，只是在许多情况下都有更好的方法。

来源： http: [//www.stroustrup.com/bs_faq.html#garbage-collection](http://www.stroustrup.com/bs_faq.html#garbage-collection)

至于为什么它没有内置它，如果我没记错的话，它是在 GC 出现之前发明*的*，而且我不相信该语言可能有 GC 有几个原因（IE 与 C 的向后兼容性）

希望这可以帮助。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2013-10-19T13:15:57.193

Stroustrup 在 2013 年 Going Native 会议上对此做了一些很好的评论。

只需跳到[此视频](http://channel9.msdn.com/Events/GoingNative/2013/Opening-Keynote-Bjarne-Stroustrup)中的 25 分 50 秒左右。（我建议实际上观看整个视频，但这会跳到有关垃圾收集的内容。）

当您拥有一种非常棒的语言，可以轻松（并且安全、可预测、易于阅读和易于教授）以直接方式处理对象和值时，避免（显式）使用堆，那么你甚至*不需要*垃圾收集。

对于现代 C++，以及我们在 C++11 中拥有的东西，垃圾收集不再是可取的，除非在有限的情况下。事实上，即使在主要的 C++ 编译器之一中内置了一个好的垃圾收集器，我认为它也不会经常使用。避免 GC会*更容易*，而不是更难。

他展示了这个例子：

```
void f(int n, int x) {
    Gadget *p = new Gadget{n};
    if(x<100) throw SomeException{};
    if(x<200) return;
    delete p;
} 
```

这在 C++ 中是不安全的。但它在 Java 中也是不安全的！在 C++ 中，如果函数提前返回，`delete`则永远不会调用 。但是如果你有完整的垃圾收集，比如在 Java 中，你只会得到一个建议，即对象将在“将来的某个时候”被破坏（*更新：*更糟糕的是，Java*没有*承诺永远调用终结器——它可能永远不会被调用）。如果 Gadget 拥有打开的文件句柄、与数据库的连接或您为稍后写入数据库而缓冲的数据，这还不够好。我们希望小工具在完成​​后立即销毁，以便尽快释放这些资源。您不希望您的数据库服务器为成千上万不再需要的数据库连接而苦苦挣扎——它不知道您的程序已经完成工作。

那么解决方案是什么？有几种方法。您将对绝大多数对象使用的显而易见的方法是：

```
void f(int n, int x) {
    Gadget p = {n};  // Just leave it on the stack (where it belongs!)
    if(x<100) throw SomeException{};
    if(x<200) return;
} 
```

这需要更少的字符来键入。它没有`new`妨碍。它不需要您输入`Gadget`两次。对象在函数结束时被销毁。如果这是您想要的，这是非常直观的。 `Gadget`s 的行为与`int`or相同`double`。可预测、易读、易教。一切都是“价值”。有时价值很大，但价值更容易教授，因为您没有通过指针（或引用）获得的这种“远距离行动”的东西。

您创建的大多数对象仅在创建它们的函数中使用，并且可能作为输入传递给子函数。程序员在返回对象时不必考虑“内存管理”，或者在软件的广泛分离的部分之间共享对象。

范围和生命周期很重要。大多数情况下，如果生命周期与范围相同，则更容易。它更容易理解，也更容易教授。当您想要一个不同的生命周期时，阅读您正在执行此操作的代码应该是显而易见的`shared_ptr`，例如使用。（或按值返回（大）对象，利用移动语义或`unique_ptr`.

这似乎是一个效率问题。如果我想从中退回小工具`foo()`怎么办？C++11 的移动语义使得返回大对象变得更容易。只需编写`Gadget foo() { ... }`它，它就会工作，并且工作得很快。你不需要自找麻烦`&&`，只需按值返回，语言通常能够进行必要的优化。（甚至在 C++03 之前，编译器在避免不必要的复制方面做得非常好。）

正如 Stroustrup 在视频其他地方所说（释义）：*“只有计算机科学家才会坚持复制一个对象，然后破坏原件。（观众笑）。为什么不直接将对象移动到新位置？这就是人类（不是计算机科学家）期待。”*

当您可以保证只需要一个对象的副本时，就更容易理解对象的生命周期。你可以选择你想要的生命周期策略，如果你愿意，垃圾收集就在那里。但是当您了解其他方法的好处时，您会发现垃圾收集在您的偏好列表的底部。

如果这对您不起作用，您可以使用`unique_ptr`，或失败，`shared_ptr`。在内存管理方面，与许多其他语言相比，编写良好的 C++11 更短、更易于阅读和更易于教学。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2017-12-31T22:45:43.377

## tl; dr：因为现代 C++ 不需要垃圾收集。

Bjarne Stroustrup[关于这个问题的常见问题解答说](http://www.stroustrup.com/bs_faq.html#garbage-collection)：

> 我不喜欢垃圾。我不喜欢乱扔垃圾。我的理想是通过不产生任何垃圾来消除对垃圾收集器的需求。现在这是可能的。

* * *

对于这些天编写的代码（C++17 并遵循官方 [核心指南](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md)），情况如下：

*   大多数与内存所有权相关的代码都在库中（尤其是那些提供容器的）。
*   大多数涉及内存所有权的代码*使用*都遵循 RAII[模式](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rr-raii)，因此在构造时进行分配，在销毁时进行释放，这发生在退出分配某些内容的范围时。
*   您[不直接显式分配或取消分配内存](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#S-resource)。
*   原始指针[不拥有内存](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rr-ptr)（如果您遵循了指南），因此您不能通过传递它们来泄漏。
*   如果您想知道如何在内存中传递值序列的起始地址 - 您可以并且应该更喜欢[span](https://stackoverflow.com/q/45723819/1593077)，从而消除对原始指针的需求。你仍然可以使用这样的指针，它们只是非拥有的。
*   如果你真的需要一个拥有的“指针”，你可以使用 C++ 的 [标准库智能指针](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rr-owner)——它们不会泄漏，而且效率相当高（尽管[ABI 可能会妨碍](https://stackoverflow.com/q/58339165/1593077)它）。[或者，您可以使用“所有者指针”](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rr-ptr)跨范围边界传递所有权。这些是不常见的，必须明确使用；但是当被采用时 - 它们允许对泄漏进行很好的静态检查。

## “哦，是吗？但是……

### ......如果我只是按照我们过去编写 C++ 的方式编写代码？”

实际上，您*可以*忽略所有指南并编写泄漏的应用程序代码 - 它会像往常一样编译和运行（和泄漏）。

但这不是“只是不这样做”的情况，在这种情况下，开发人员应该是有德行的，并且会进行大量的自我控制；编写不符合标准的代码并不简单，编写起来也不是更快，性能也不是更好。逐渐地，它也将变得更加难以编写，因为您将面临越来越多的“阻抗不匹配”与符合代码提供和期望的内容。

### ...如果我`reintrepret_cast`？还是做复杂的指针运算？还是其他类似的黑客？”

事实上，如果你下定决心，你可以编写出把事情搞得一团糟的代码，尽管你可以很好地遵守这些准则。但：

1.  您很少会这样做（就代码中的位置而言，不一定就执行时间的一部分而言）
2.  你只会故意这样做，而不是意外。
3.  这样做将在符合准则的代码库中脱颖而出。
4.  无论如何，这是一种可以绕过另一种语言的 GC 的代码。

### ……图书馆发展？”

如果您是 C++ 库开发人员，那么您确实会编写涉及原始指针的不安全代码，并且您需要仔细且负责任地编写代码 - 但这些是由专家编写的自包含代码（更重要的是，由专家审查）。

所以，就像 Bjarne 说的：一般来说，确实没有收集垃圾的动机，因为你们都确保不产生垃圾。GC 正在成为 C++ 的一个非问题。

[这并不是说 GC 对于某些特定应用程序来说不是一个有趣的问题，当您想要使用自定义分配和取消分配策略时。对于那些你想要自定义分配和取消分配的人，而不是语言级别的 GC。]

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-09-29T01:01:48.230

C++ 背后的想法是，您不会为不使用的功能支付任何性能影响。因此，添加垃圾收集意味着让一些程序像 C 那样直接在硬件上运行，而另一些程序则在某种运行时虚拟机中运行。

没有什么可以阻止您使用某种形式的智能指针，这些指针绑定到某些第三方垃圾回收机制。我似乎记得微软在 COM 上做过类似的事情，但效果并不好。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-09-29T01:11:14.403

要回答有关 C++ 的大多数“为什么”问题，请阅读 C++[的设计和演变](http://www.stroustrup.com/dne.html)

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2017-06-11T17:36:02.420

原始 C 语言背后的基本原则之一是内存由一系列字节组成，代码只需要关心这些字节在使用它们的确切时刻意味着什么。现代 C 允许编译器施加额外的限制，但 C 包括 - 并且 C++ 保留 - 将指针分解为字节序列，将包含相同值的任何字节序列组装成指针，然后使用该指针访问较早的对象。

虽然这种能力在某些类型的应用程序中可能是有用的——甚至是必不可少的——但包含这种能力的语言在支持任何有用和可靠的垃圾收集的能力方面将非常有限。如果编译器不知道对构成指针的位所做的一切，它就无法知道足以重建指针的信息是否存在于宇宙的某个地方。因为这些信息有可能以计算机无法访问的方式存储，即使它知道它们（例如，构成指针的字节可能已经在屏幕上显示足够长的时间供某人写入它们写在一张纸上），计算机实际上不可能知道将来是否可以使用指针。

许多垃圾收集框架的一个有趣的怪癖是对象引用不是由其中包含的位模式定义的，而是由对象引用中保存的位与其他地方保存的其他信息之间的关系定义的。在 C 和 C++ 中，如果存储在指针中的位模式标识了一个对象，则该位模式将标识该对象，直到该对象被显式销毁。在典型的 GC 系统中，一个对象可能在某个时刻由位模式 0x1234ABCD 表示，但下一个 GC 周期可能会将对 0x1234ABCD 的所有引用替换为对 0x4321BABE 的引用，因此该对象将由后一种模式表示。即使要显示与对象引用关联的位模式，然后再从键盘读回，

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-10-23T22:42:18.107

所有的技术讨论都使这个概念过于复杂。

如果您将所有内存的 GC 自动放入 C++ 中，那么请考虑使用 Web 浏览器之类的东西。Web 浏览器必须加载完整的 Web 文档并运行 Web 脚本。您可以将 Web 脚本变量存储在文档树中。在浏览器中打开许多选项卡的 BIG 文档中，这意味着每次 GC 必须执行完整收集时，它还必须扫描所有文档元素。

在大多数计算机上，这意味着会发生 PAGE FAULTS。因此，回答问题的主要原因是会发生PAGE FAULTS。当您的 PC 开始进行大量磁盘访问时，您就会知道这一点。这是因为 GC 必须接触大量内存才能证明无效指针。当您有一个真正的应用程序使用大量内存时，由于 PAGE FAULTS，必须扫描每个集合的所有对象是严重的。页面错误是指虚拟内存需要从磁盘读回 RAM。

所以正确的解决方案是将一个应用程序分成需要GC的部分和不需要GC的部分。在上面的 Web 浏览器示例中，如果文档树是使用 malloc 分配的，但 javascript 使用 GC 运行，那么每次 GC 启动时，它只会扫描一小部分内存和内存的所有 PAGED OUT 元素文档树不需要重新分页。

要进一步了解这个问题，请查看虚拟内存以及它是如何在计算机中实现的。这完全是因为当没有那么多 RAM 时，程序可以使用 2GB。在具有 2GB RAM 的 32 位系统的现代计算机上，只要一个程序正在运行，就不是这样的问题。

作为另一个示例，考虑一个必须跟踪所有对象的完整集合。首先，您必须扫描所有可通过根访问的对象。第二次扫描步骤 1 中可见的所有对象。然后扫描等待的析构函数。然后再次转到所有页面并关闭所有不可见的对象。这意味着许多页面可能会被多次换出和换回。

所以我简短的回答是，由于接触所有内存而发生的 PAGE FAULTS 的数量会导致程序中所有对象的完全 GC 不可行，因此程序员必须将 GC 视为脚本之类的辅助工具和数据库工作，但通过手动内存管理做正常的事情。

另一个非常重要的原因当然是全局变量。为了让收集器知道全局变量指针在 GC 中，它需要特定的关键字，因此现有的 C++ 代码将无法工作。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-11-18T20:58:20.727

简短的回答：我们不知道如何有效地进行垃圾收集（时间和空间开销很小）并且始终正确（在所有可能的情况下）。

长答案：就像 C 一样，C++ 是一种系统语言。这意味着它在您编写系统代码（例如操作系统）时使用。换句话说，C++ 的设计就像 C 一样，以尽可能最佳的*性能*作为主要目标。该语言的标准不会添加任何可能阻碍性能目标的功能。

这暂停了一个问题：为什么垃圾收集会阻碍性能？主要原因是，在实现方面，我们 [计算机科学家] 不知道如何在所有情况下以最小的开销进行垃圾收集。因此，C++ 编译器和运行时系统不可能一直有效地执行垃圾收集。另一方面，C++ 程序员应该了解他的设计/实现，并且他是决定如何最好地进行垃圾收集的最佳人选。

最后，如果控制（硬件、细节等）和性能（时间、空间、功率等）不是主要限制因素，那么 C++ 就不是编写工具。其他语言可能会提供更好的服务并提供更多 [隐藏] 运行时管理，但会产生必要的开销。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-08-21T17:20:43.190

当我们将 C++ 与 Java 进行比较时，我们发现 C++ 在设计时并没有考虑到隐式垃圾收集，而 Java 是。

在 C 风格中拥有诸如任意指针之类的东西不仅不利于 GC 实现，而且还会破坏大量 C++ 遗留代码的向后兼容性。

除此之外，C++ 是一种旨在作为独立可执行文件运行的语言，而不是具有复杂的运行时环境。

总而言之：是的，可以将垃圾收集添加到 C++，但为了连续性，最好不要这样做。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-08T15:54:39.517

主要有两个原因：

1.  因为它不需要一个（恕我直言）
2.  因为它与作为 C++ 基石的 RAII 几乎不兼容

C++ 已经提供了手动内存管理、堆栈分配、RAII、容器、自动指针、智能指针……这应该足够了。垃圾收集器适用于不想花 5 分钟思考谁应该拥有哪些对象或何时应该释放资源的懒惰程序员。这不是我们在 C++ 中做事的方式。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-01-27T13:36:29.280

实施垃圾收集实际上是从低级到高级的范式转变。

如果您查看带有垃圾收集的语言中处理字符串的方式，您会发现它们只允许高级字符串操作函数并且不允许对字符串进行二进制访问。简而言之，所有字符串函数首先检查指针以查看字符串的位置，即使您只是绘制一个字节。因此，如果您正在执行一个循环来处理带有垃圾收集的语言中的字符串中的每个字节，它必须计算每次迭代的基本位置和偏移量，因为它不知道字符串何时移动。然后你必须考虑堆、堆栈、线程等。

# iphone - 在按钮上滚动溢出文本的简单方法？

> ID：147154
> 
> 赞同：2
> 
> 时间：2008-09-29T01:08:04.567
> 
> 标签：iphone, cocoa, animation, core-animation

有没有人有任何示例或资源，我可以在其中找到有关滚动文本的信息，这些信息太长而无法在按钮控件中显示？我正在考虑这些方面的事情。

*   显示尽可能多的文本以适合当前矩形，并在末尾带有“...”以表示溢出。
*   暂停 1 秒钟，然后将文本慢慢滚动到显示字符串右侧部分的右边缘。
*   显示尽可能多的文本以适合当前矩形，并在开头使用“...”表示溢出。
*   将整个事情反过来重新开始。

有没有一种简单的方法可以使用特定移动设备上的“核心”或内置“动画”框架来做到这一点？

[编辑] 我想添加更多细节，因为我认为人们更关注我想要完成的事情是否合适。该按钮用于问答游戏的答案。它不执行任何特定的 UI 功能，但用于显示答案。Apple 自己在 iPod Nano 上的 iQuiz 琐事游戏中这样做了，我认为它是一个非常优雅的解决方案，可以解决比我的按钮宽度更长的答案。

万一它的'......'那是这个的困难部分。可以说我删除了这个要求。我可以让按钮的标签全尺寸，但剪辑到按钮的客户端矩形并使用一些动画方法在剪辑矩形内滚动它吗？这会给我几乎相同的效果减去椭圆。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T01:41:22.317

不想变得迟钝，也许你应该重新考虑你的问题。一个按钮应该有一个清晰和可预测的功能。它不是存储和显示文本的地方。也许您可以在屏幕上显示一个描述，下面有一个漂亮的标准按钮？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T10:36:57.130

更新源代码示例：

[这是一些准备使用的源代码示例](http://www.mediafire.com/?hm3znmwjoih)（实际上是一个完整的压缩 Xcode 项目，包含图像和 nib 文件以及一些源代码），不适用于 iPhone，不使用 Core Animation，只使用几个简单的 NSImage 和一个 NSImageView。这只是一个廉价的 hack，它没有实现您要求的全部功能（对不起，但我不想为您编写源代码 :-P），糟糕的代码布局（嘿，我只是在一个几分钟，所以你不能指望更好;-)) 这只是一个演示如何做到这一点。它也可以通过 Core Animation 完成，但这种方法更简单。将按钮动画组合成 NSImageView 不如将 NSView 子类化并直接绘制到其上下文中那么好，但它要简单得多（我只是想将最简单的解决方案组合在一起）。一旦一直向右滚动，它也不会向后滚动。因此，您只需要另一种方法来回滚并启动另一个 NSTimer，它会在您将点向左绘制 2 秒后触发。

只需在 Xcode 中打开项目并点击运行，即可。然后看看源代码。它真的没有那么复杂（但是，您可能必须先重新格式化它，布局很烂）。

* * *

由于对我的回答的评论而更新：

如果您根本不使用 Apple UI 元素，我看不到问题所在。在这种情况下，您的按钮甚至不是按钮，它只是一个可点击的视图（如果您使用 Cocoa，则为 NSView）。您可以将 NSView 子类化为 MyAnswerView 并覆盖paint方法以绘制任何您想要的视图。多行文字、滚动文字、3D文字动画，完全取决于你的想象。

[这是一个示例](http://web.archive.org/web/20100323054539/http://katidev.com:80/blog/2008/03/07/how-to-create-a-custom-control-with-nsview/)，展示了某人如何将 NSView 子类化以创建默认情况下不存在的完整自定义控件。控件如下所示：

![替代文字](https://i.stack.imgur.com/KkWVV.jpg "自定义控件")

看到左上角有趣的东西了吗？那是一个控制。以下是它的工作原理：

![替代文字](https://i.stack.imgur.com/a4iSx.jpg)

* * *

我讨厌这样说，因为这不是你问题的答案，但是“*不要那样做！* ”。Apple 有如何实现用户界面的指南。虽然您可以随意忽略它们，但 Apple 用户习惯于让 UI 遵循这些准则，而不遵循它们会创建 Apple 用户觉得丑陋且没有吸引力的应用程序。

[以下是 Apple 的人机界面指南](http://developer.apple.com/documentation/UserExperience/Conceptual/AppleHIGuidelines/index.html)

让我从那里引用

> **按钮内容和标签**
> 
> 按钮总是包含文本，它不包含图像。如果您需要在按钮上显示图标或其他图像，请改用斜角按钮，如“斜角按钮”中所述。</p>
> 
> 按钮上的标签应该是一个动词或动词短语，描述它执行的操作——保存、关闭、打印、删除、更改密码等。如果按钮作用于单个设置，请尽可能具体地标记按钮；例如，“选择图片...”比“选择...”更有帮助，因为按钮会立即执行操作，因此不必在标签中使用“现在”（例如，立即扫描）。
> 
> 按钮标签应具有标题风格的大写，如“界面元素标签和文本的大写”中所述。如果按钮立即打开另一个窗口、对话框或应用程序来执行其操作，您可以在标签中使用省略号。例如，Mail 首选项会显示一个包含省略号的按钮，因为它会打开 .Mac 系统首选项，如图 15-8 所示。

按钮应包含单个动词或动词短语，而不是琐事游戏的答案！如果您有 2 到 5 个答案，您应该使用单选按钮让用户选择答案，并使用确定按钮让用户接受答案。对于超过 5 个答案，您应该根据指南考虑使用弹出式选择器，尽管我想在这种情况下会相当难看。

您可以考虑使用只有一列的表格，每个答案一行，如果答案很长并且需要中断，则每个单元格都是多行的。因此，用户通过单击选择表格行，突出显示表格单元格，然后单击“确定”按钮完成。或者，您可以直接继续，只要用户选择任何表格单元格（但这样您就可以让用户有机会更正意外点击）。另一方面，多行单元格的表格在 MacOS X 上相当少见。iPhone 使用了一些，但通常只有很少的文本（最多两行）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T04:18:54.077

这里有一个想法：不要使用省略号 (...)，而是在每一侧使用渐变，这样多余的文本就会消失在背景色中。然后你可以用三个 CALayers 来做到这一点：一个用于文本，两个用于淡入淡出效果。

渐变蒙版只是具有从透明到背景颜色的渐变的矩形。它们应位于文本层上方。文本将被绘制在文本层上，然后您只需动画它以您描述的方式来回滑动。您可以创建一个描述路径的 CGPath 对象并将其添加到您添加到文本层的 CAKeyframeAnimation 对象。

至于你认为这是否“简单”取决于你对 Core Animation 的了解程度，但我认为一旦你学习了 API，你会发现这并不算太糟糕，而且值得一试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T01:38:05.087

很确定你不能使用标准 API 来做到这一点，当然不能使用 UILineBreakMode。此外，样式指南说省略号表示按下按钮时会询问您更多信息 - 例如 Open File... 将询问文件名。您提议使用省略号违反了本指南。

您需要一些自定义逻辑来实现您描述的行为，但我不认为这是要走的路。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T01:43:13.390

这不是一个很好的 UI 实践，但如果你仍然想这样做，最好的办法是通过一个看起来像按钮的可点击 div 来做到这一点。

将 div 的宽度设置为显式值，并将其溢出设置为隐藏，然后使用间隔执行的脚本来调整此 div 的 scrollLeft 属性。

# web-applications - SMS + Web 应用程序：美国运营商用户在美国境内使用的 SMS“长代码”提供商？

> ID：147164
> 
> 赞同：8
> 
> 时间：2008-09-29T01:16:04.000
> 
> 标签：web-applications, sms, mobile-phones, cellular-network

Q.：如何在美国境内获得美国运营商用户使用的手机短信“长码”？

背景：我正在构建一个网络应用程序，用于接收来自手机的查询/向手机发送答案。应用程序设计（和业务模型）期望通过 SMS 与手机设备通信，通过 SMS“长代码”（VMN 或 MSISDN）寻址 Web 应用程序。手机用户将在美国境内发送/接收，并使用美国运营商。美国蜂窝服务中不提供长代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-02T22:35:51.183

群发短信是一项新的长代码服务 ( [http://grouptexting.com](http://grouptexting.com) )。与 Twilio 不同，传入消息不收费，也没有 1 条短信/秒规则！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T02:44:16.130

这不是一件容易的事。首先，您需要获取代码。然后，您必须与所有运营商协商以使他们认可它。

或者您可以使用像 Cell It ( [http://www.cellitmarketing.com/](http://www.cellitmarketing.com/) ) 这样的人，它已经处理了所有这些事情并充当了您的中介。

我与他们没有关系，但我们正在探索做类似的事情，与所有运营商谈判的专业知识让我们寻找与谁合作的人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-16T03:43:16.843

“长代码”只是一个普通电话号码（完整的 e.164 格式的 MSISDN）您可以通过购买 SIM 卡来获得一个（在 GSM 的情况下——您今天必须在 CDMA 中获得整个电话，因为他们没有'不要像身份模块一样使用 SIM）。一旦你有了它，你就可以得到一个 GSM 调制解调器并使用标准的 COM 编程让调制解调器发送和接收 SMS 消息。最后，我在美国寻找最便宜的运营商是 T-Mobile，它提供无限消息计划。

正如 Barry 指出的那样，您不应该将此方法用于商业目的，但我在 SMS 聚合器工作的经验是，很多人都在这样做。检查合同中的细则以确保您知道“无限”的真正含义，还要注意 GSM 调制解调器的速度对于大规模操作来说并不是那么好。对于大型商业应用程序，您可能需要考虑连接到聚合器。但是您必须与聚合器和运营商协商解决方案，因此您可能无法使用长代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T00:37:21.370

我相信我已经在另一篇文章中回答了您的问题。在这里你可以看到它：

[有哪些技术可用于发送短信](https://stackoverflow.com/questions/53019/what-kind-of-technologies-are-available-for-sending-text-messages#53067)

希望这是您所需要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T19:14:23.513

如果您只是要发送短信，请让 kannel 将 gsm 手机连接到它，然后您就完成了..

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T19:24:55.113

您将需要一个短代码来进行任何自动短信营销。这包括简单地响应有关产品或事件的查询。如果您不这样做，您可以预期运营商最终会阻止您的号码。即使您确实获得了短代码，如果您未能通过他们的审核，运营商仍然可以阻止您的号码。审核通常包括提供一个响应取消订阅您的服务，并且只向选择加入的客户发送消息。还有更多的指导方针，而且从承运人到承运人，但大多数信息都可以在[MMA 网站上找到](http://www.mmaglobal.com/main)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T18:19:08.173

在美国获得“长码”的唯一合法途径是购买手机调制解调器和 SIM 卡。

通常，美国所有从服务器到消费者的流量都是通过短代码完成的，每月费用约为 500 美元。

而且您不应该将长代码用于任何商业目的

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-07T05:52:44.247

broadtexter.com 使用 10 位长代码 (646-662-3101)，该代码已注册到 t-mobile，他们能够在美国发送和接收 SMS。

我最近也发布了这个：[BULK SMS、Long Codes (VMN MSIDN)、T-mobile？](https://stackoverflow.com/questions/1090657/bulk-sms-long-codes-vmn-msidn-t-mobile)

根据我的经验，stackoverflow 上的用户非常愿意帮助其他开发人员，因此请尽快检查该链接，因为我确信它也可能对您有所帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-03T17:23:19.550

[http://www.twilio.com](http://www.twilio.com)为 SMS 提供长代码。

只有两个警告：

1.  他们强制执行 1 条短信/秒的规则（尽管如果您超出速率，他们会自动将消息排队）
2.  **他们对**传入和传出的消息收取 3 美分/消息。

# rest - 全局资源 URI 有什么好处（即可寻址性）？

> ID：147172
> 
> 赞同：3
> 
> 时间：2008-09-29T01:21:42.160
> 
> 标签：rest, uri

使用全局唯一的 URI（如 REST 那样）引用资源与使用专有的 id 格式相比有什么好处？

例如：

1.  [http://host.com/student/5](http://host.com/student/5)
2.  [http://host.com/student?id=5](http://host.com/student?id=5)

在第一种方法中，整个 URL 是 ID。在第二种方法中，只有 5 是 ID。第一种方法比第二种方法有什么实际好处？

~~为什么 REST（似乎）不遗余力地提倡第一种方法？~~

- 编辑：

我的问题令人困惑，因为它确实问了两个不同的问题：

1.  可寻址性有什么好处？
2.  上面看到的两种 URI 形式有什么区别。

我已经使用自己的帖子回答了以下两个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T01:25:06.490

当我看到这样的 uri 时，主要的事情是普通用户能够记住那个 uri。

我们的极客对问号和获取变量很好，但如果有人记得[http://www.host.com/users/john](http://www.host.com/users/john)而不是[http://www.host.com/?view=users&name=john](http://www.host.com/?view=users&name=john)，那就是一个巨大的好处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T18:52:36.823

我将回答我自己的问题：

1）为什么URI很重要？

我将引用**Leonard Richardson 和 Sam Ruby 的 RESTful Web Services (ISBN: 978-0-596-52926-0)**：

> 考虑一个真实的 URI，它命名了“关于水母的资源目录”类型的资源：[http](http://www.google.com/search?q=jellyfish) ://www.google.com/search?q=jellyfish 。[jellyfish 搜索与http://www.google.com](http://www.google.com)一样是一个真实的 URI 。如果 HTTP 不可寻址，或者如果 Google 搜索引擎不是可寻址的 Web 应用程序，我将无法在书中发布该 URI。我得告诉你：“打开到 google.com 的网络连接，在搜索框中输入‘jellyfish’，然后点击‘Google 搜索’按钮。
> 
> 这不是学术上的担忧。直到 1990 年代中期，当 ftp:// URI 开始流行用于描述 FTP 站点上的文件时，人们不得不编写如下内容：“在 ftp.example.com 上启动一个匿名 FTP 会话。然后切换到目录 pub/files/ 并下载文件 file.txt。” URI 使 FTP 与 HTTP 一样可寻址。现在人们只写：“下载 ftp://ftp.example.com/pub/files/file.txt。” 步骤相同，但现在可以通过机器执行。
> 
> [...]
> 
> 可寻址性是 Web 应用程序最好的事情之一。它使客户可以轻松地以原始设计者从未想象过的方式使用网站。

2) 可寻址性有什么好处？

> 遵循服务器提供的 URI 比自己构建它们要容易得多。当资源关系变得过于复杂而无法用简单的规则表达时，尤其如此。在服务器中编写一次逻辑比在众多客户端中重新实现它更容易。
> 
> 即使各个资源 URI 保持不变，资源之间的关系也可能会发生变化。例如，如果 Google 地图要更改其地图图块的比例，则计算相对图块位置的客户端将会中断。

3) URI 比自定义 ID 有什么好处？

> 自定义 ID 唯一标识资源。URI 通过告诉您在哪里可以找到它更进一步。这简化了客户端逻辑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T01:23:21.113

主要是搜索引擎优化。

在我看来，这也使它们更容易记住，更干净，更专业。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T01:23:25.450

第一个更美观。

从技术上讲没有区别，但尽可能使用前者。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T02:02:30.643

正如 Ólafur 提到的，前一个网址的清晰是一个好处。

另一个是实施灵活性。

假设学生 5 不经常更改。如果您使用 REST 样式的 url，您可以选择提供静态文件而不是运行代码。在 Rails 中，对 student/5 的第一个请求通常会在您的 Web 根目录下创建一个缓存的 html 文件。该文件用于在不接触后端的情况下为后续请求提供服务。自然地，这种方法没有什么特别之处。

后来的网址不允许这样做。静态页面的名称中不能包含 url 变量 (?, =)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T13:34:04.180

从 REST 的角度来看，这两个 URI 都是有效的，但是只需意识到 Web 缓存对查询字符串参数的处理方式非常不同。
如果您想利用缓存来发挥自己的优势，那么我建议您不要使用查询字符串参数来识别您的资源。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-29T01:51:33.323

我认为这取决于您要遵守风水原则的程度。

# assembly - `testl` eax 对 eax？

> ID：147173
> 
> 赞同：123
> 
> 时间：2008-09-29T01:22:57.010
> 
> 标签：assembly, x86, instructions

我试图了解一些装配。

汇编如下，我感兴趣的`testl`行：

```
000319df  8b4508        movl   0x08(%ebp), %eax  
000319e2  8b4004        movl   0x04(%eax), %eax  
000319e5  85c0          testl  %eax, %eax  
000319e7  7407          je     0x000319f0 
```

我试图理解`testl`介于`%eax`和之间的那个点`%eax`？我认为这段代码的细节并不重要，我只是想用它本身来理解测试——这个值不总是正确的吗？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-09-29T01:23:43.687

它测试是否`eax`为 0，或高于或低于。在这种情况下，如果`eax`为 0，则进行跳转。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2008-09-29T01:24:49.877

的含义`test`是将参数与在一起，并检查结果是否为零。所以这段代码测试 EAX 是否为零。`je`如果为零将跳转。

顺便说一句，这会生成比`cmp eax, 0`编译器通常会这样做的原因更小的指令。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-09-29T01:29:03.297

测试指令在操作数之间进行逻辑与运算，但不将结果写回寄存器。仅更新标志。

在您的示例中，测试 eax，如果 eax 为零，则 eax 将设置零标志，如果设置了最高位，则设置符号标志以及其他一些标志。

如果设置了零标志，则跳转如果等于 (je) 指令会跳转。

您可以将代码翻译成更易读的代码，如下所示：

```
cmp eax, 0
je  somewhere 
```

这具有相同的功能，但需要一些字节更多的代码空间。这就是编译器发出测试而不是比较的原因。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2016-06-25T20:45:19.103

[`test`](https://github.com/HJLebbink/asm-dude/wiki/TEST)就像[`and`](https://github.com/HJLebbink/asm-dude/wiki/AND)，除了它只写 FLAGS ，而它的两个输入都保持不变。对于两个*不同*的输入，它对于测试某些位是否全为零或是否至少设置了一个很有用。（例如`test al, 3`，如果 EAX 是 4 的倍数，则设置 ZF（因此它的低 2 位都归零）。

* * *

**[`test eax,eax`](http://www.felixcloutier.com/x86/TEST.html)以完全相同的方式设置所有[`cmp eax, 0`](http://www.felixcloutier.com/x86/CMP.html)标志**：

*   CF 和 OF 清零（AND/TEST 总是这样做；减去零永远不会产生进位）
*   ZF、SF 和 PF 根据 EAX 中的值。( `a = a&a = a-0`)。
    （PF照常[只根据低8位设置](https://stackoverflow.com/questions/47404539/intel-assembly-test-pf-flag-operation/47405136#47405136)）

除了过时的 AF（辅助进位标志，由 ASCII/BCD 指令使用）。 [TEST 将其保留为 undefined](http://www.felixcloutier.com/x86/Jcc.html)，但[CMP 将其设置为“根据结果”](http://www.felixcloutier.com/x86/TEST.html)。由于减零不能产生从第 4 位到第 5 位的进位，CMP 应始终清除 AF。

* * *

TEST 更小（不立即），有时更快（可以在比 CMP 更多的情况下在更多 CPU 上宏融合到比较和分支微指令中）。 [**这使得`test`将寄存器与零进行比较的首选习语**](https://stackoverflow.com/questions/33721204/x86-assembly-cmp-reg-0-vs-or-reg-reg/33724806#33724806)。这是一个窥视孔优化，`cmp reg,0`无论语义如何，您都可以使用它。

使用立即数为 0 的 CMP 的唯一常见原因是当您想与内存操作数进行比较时。例如，`cmpb $0, (%esi)`检查隐式长度 C 样式字符串末尾的终止零字节。

* * *

**AVX512F add[`kortestw k1, k2`](https://github.com/HJLebbink/asm-dude/wiki/KORTESTW_KORTESTB_KORTESTQ_KORTESTD)**和 AVX512DQ/BW (Skylake-X 但不是 KNL) add [`ktestb/w/d/q k1, k2`](https://github.com/HJLebbink/asm-dude/wiki/KTESTW_KTESTB_KTESTQ_KTESTD)，它们在 AVX512 掩码寄存器 (k0..k7) 上运行，但仍然像`test`整数`OR`或`AND`指令一样设置常规 FLAGS。（有点像 SSE4`ptest`或 SSE `ucomiss`：在 SIMD 域中输入并产生整数 FLAGS。）

`kortestw k1,k1`是基于 AVX512 比较结果分支 / cmovcc / setcc 的惯用方式，替换 SSE/AVX2 `(v)pmovmskb/ps/pd`+`test`或`cmp`.

* * *

**`jz`vs.的使用`je`可能会令人困惑。**

[`jz`并且`je`实际上是相同的指令](http://www.felixcloutier.com/x86/Jcc.html)，即机器代码中的相同操作码。 **它们做同样的事情，但对人类有不同的语义**。反汇编程序（通常是编译器的 asm 输出）只会使用一个，因此语义区别会丢失。

`cmp`并`sub`在它们的两个输入相等（即减法结果为0）时设置ZF。 `je`(jump if equal) 是语义相关的同义词。

`test %eax,%eax`/`and %eax,%eax`当结果为零时再次设置 ZF，但没有“相等”测试。测试后的 ZF 不会告诉您两个操作数是否相等。所以`jz`(jump if zero) 是语义相关的同义词。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-29T03:40:00.550

这段代码来自一个子程序，它被赋予了一个指向某个东西的指针，可能是某个结构或对象。第二行取消引用该指针，从该事物中获取一个值 - 可能本身是一个指针，也可能只是一个 int，存储为其第二个成员（偏移量 +4）。第 3 行和第 4 行测试该值是否为零（如果是指针则为 NULL），如果为零则跳过以下几个操作（未显示）。

零测试有时被编码为与立即字面零值的比较，但编写此代码的编译器（或人类？）可能认为 testl 操作会运行得更快 - 考虑到所有现代 CPU 的东西，如流水线和寄存器重命名。它来自同一个技巧，包含使用 XOR EAX，EAX 清除寄存器的想法（我在科罗拉多州的某人的车牌上看到！）而不是明显但可能较慢的 MOV EAX，#0（我使用较旧的符号）。

在 asm 中，与 perl、TMTOWTDI 一样。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-29T01:25:07.787

如果 eax 为零，它将执行条件跳转，否则它将在 319e9 处继续执行

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-12-06T21:19:36.093

在某些程序中，它们可用于检查缓冲区溢出。在分配空间的最顶部放置一个 0。将数据输入堆栈后，它会在分配空间的最开头查找0，以确保分配的空间没有溢出。

它被用在exploit-exercises的stack0练习中来检查它是否溢出，如果没有溢出并且那里有一个零，它会显示“再试一次”

```
0x080483f4 <main+0>:    push   ebp
0x080483f5 <main+1>:    mov    ebp,esp
0x080483f7 <main+3>:    and    esp,0xfffffff0
0x080483fa <main+6>:    sub    esp,0x60                     
0x080483fd <main+9>:    mov    DWORD PTR [esp+0x5c],0x0 ;puts a zero on stack
0x08048405 <main+17>:   lea    eax,[esp+0x1c]
0x08048409 <main+21>:   mov    DWORD PTR [esp],eax
0x0804840c <main+24>:   call   0x804830c <gets@plt>
0x08048411 <main+29>:   mov    eax,DWORD PTR [esp+0x5c] 
0x08048415 <main+33>:   test   eax,eax                  ; checks if its zero
0x08048417 <main+35>:   je     0x8048427 <main+51>
0x08048419 <main+37>:   mov    DWORD PTR [esp],0x8048500 
0x08048420 <main+44>:   call   0x804832c <puts@plt>
0x08048425 <main+49>:   jmp    0x8048433 <main+63>
0x08048427 <main+51>:   mov    DWORD PTR [esp],0x8048529
0x0804842e <main+58>:   call   0x804832c <puts@plt>
0x08048433 <main+63>:   leave
0x08048434 <main+64>:   ret 
```

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2017-03-14T07:35:26.293

我们可以看到**jg**，<strong>jle 如果`testl %edx,%edx. jle .L3`我们很容易发现**jle**是西装`(SF^OF)|ZF`，如果 %edx 为零，ZF=1，但如果 %edx 不为零且为-1，则在 testl 之后，OF=0，而SF =1，所以flag =true，实现跳转。对不起，我的英语很差

# java - 计算 ISO 8601 周数的好方法是什么？

> ID：147178
> 
> 赞同：21
> 
> 时间：2008-09-29T01:23:48.460
> 
> 标签：java, date

假设我有一个日期，即年、月和日，作为整数。什么是计算给定日期所在周的[ISO 8601](http://en.wikipedia.org/wiki/ISO_8601) [周数的好（正确）、简洁且相当易读的算法？](http://en.wikipedia.org/wiki/ISO_week_date)我遇到了一些真正可怕的代码，这让我认为肯定有更好的方法。

我希望在 Java 中执行此操作，但任何类型的面向对象语言的伪代码都可以。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2016-01-25T07:18:38.090

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-29T01:29:37.400

我相信您可以使用 Calendar 对象（只需将 FirstDayOfWeek 设置为 Monday 并将 MinimalDaysInFirstWeek 设置为 4 以使其符合 ISO 8601）并调用 get(Calendar.WEEK_OF_YEAR)。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-11-25T17:32:55.210

```
/* Build a calendar suitable to extract ISO8601 week numbers
 * (see http://en.wikipedia.org/wiki/ISO_8601_week_number) */
Calendar calendar = Calendar.getInstance();
calendar.setMinimalDaysInFirstWeek(4);
calendar.setFirstDayOfWeek(Calendar.MONDAY);

/* Set date */
calendar.setTime(date);

/* Get ISO8601 week number */
calendar.get(Calendar.WEEK_OF_YEAR); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-29T07:32:17.217

joda-time 库具有 ISO8601 日历，并提供以下功能：

[http://joda-time.sourceforge.net/cal_iso.html](http://joda-time.sourceforge.net/cal_iso.html)

> yyyy-Www-dTHH:MM:SS.SSS 这种格式的 ISO8601 有以下字段：
> 
> ```
> * four digit weekyear, see rules below
> * two digit week of year, from 01 to 53
> * one digit day of week, from 1 to 7 where 1 is Monday and 7 is Sunday
> * two digit hour, from 00 to 23
> * two digit minute, from 00 to 59
> * two digit second, from 00 to 59
> * three decimal places for milliseconds if required 
> ```
> 
> 周总是完整的，一年的第一周包括一年中的第一个星期四。这个定义可能意味着一年的第一周从上一年开始，最后一周在下一年结束。weekyear 字段被定义为引用拥有该周的年份，这可能与实际年份不同。

所有这一切的结果是，您创建了一个 DateTime 对象，并调用了相当混乱（但逻辑上）名为 getWeekOfWeekyear()，其中 weekyear 是 ISO8601 使用的基于特定周的年份定义。

一般来说，joda-time 是一个非常有用的 API，我已经完全停止使用 java.util.Calendar 和 java.util.Date，除非我需要与使用它们的 API 交互。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-02-03T15:28:37.917

只有 Java.util.Calendar 可以解决问题：您可以创建一个 Calendar 实例并设置一周的**第一**天和第一周 的**最小天数**

```
Calendar calendar = Calendar.getInstance();
calendar.setMinimalDaysInFirstWeek(4);
calendar.setFirstDayOfWeek(Calendar.MONDAY);
calendar.setTime(date);

// Now you are ready to take the week of year.
calendar.get(Calendar.WEEK_OF_YEAR); 
```

这是由[javaDoc提供的](https://docs.oracle.com/javase/7/docs/api/java/util/GregorianCalendar.html)

> 当 getFirstDayOfWeek() 为 MONDAY 且 getMinimalDaysInFirstWeek() 为 4 时，星期确定与**ISO 8601**标准兼容，这些值用于首选标准的区域设置。这些值可以通过调用 setFirstDayOfWeek() 和 setMinimalDaysInFirstWeek() 显式设置。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-05-23T21:04:04.453

Calendar 类几乎可以工作，但基于 ISO 周的年份与符合“Olson 的时区包”的系统报告的不一致。这个来自 Linux 机器的示例显示了基于周的年份值 (2009) 与实际年份 (2010) 的差异：

```
$ TZ=UTC /usr/bin/date --date="2010-01-01 12:34:56" "+%a %b %d %T %Z  %%Y=%Y,%%G=%G  %%W=%W,%%V=%V  %s"
Fri Jan 01 12:34:56 UTC  %Y=2010,%G=2009  %W=00,%V=53  1262349296 
```

但是 Java 的 Calendar 类仍然报告 2010，尽管一年中的星期是正确的。*skaffman*提到的 Joda-Time 类确实正确处理了这个问题：

```
import java.util.Calendar;
import java.util.TimeZone;
import org.joda.time.DateTime;

Calendar cal = Calendar.getInstance(TimeZone.getTimeZone("GMT"));
cal.setTimeInMillis(1262349296 * 1000L);
cal.setMinimalDaysInFirstWeek(4);
cal.setFirstDayOfWeek(Calendar.MONDAY);
System.out.println(cal.get(Calendar.WEEK_OF_YEAR));     // %V
System.out.println(cal.get(Calendar.YEAR));             // %G

DateTime dt = new DateTime(1262349296 * 1000L);
System.out.println(dt.getWeekOfWeekyear());             // %V
System.out.println(dt.getWeekyear());                   // %G 
```

运行该程序显示：

> 53 2010 53 2009

因此，日历中的 ISO 8601 周数是正确的，但基于周的年份不是。

strftime(3) 的手册页报告：

> ```
>  %G     The ISO 8601 week-based year (see NOTES) with century as  a  decimal  number.   The
>          4-digit year corresponding to the ISO week number (see %V).  This has the same for‐
>          mat and value as %Y, except that if the ISO week number belongs to the previous  or
>          next year, that year is used instead. (TZ) 
> ```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T13:54:52.087

如果您想走在最前沿，您可以采用由 Stephen Colebourne（Joda Fame 的）领导[的 JSR-310 代码库](http://www.threeten.org/)（日期时间 API）的最新版本。它是一个流畅的界面，实际上是对 Joda 的自下而上的重新设计。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-09T22:25:29.047

这是相反的：给你一周中的星期一的日期（在 perl 中）

```
use POSIX qw(mktime);
use Time::localtime;

sub monday_of_week {
    my $year=shift;
    my $week=shift;
    my $p_date=shift;

    my $seconds_1_jan=mktime(0,0,0,1,0,$year-1900,0,0,0);
    my $t1=localtime($seconds_1_jan);
    my $seconds_for_week;
    if (@$t1[6] < 5) {
#first of january is a thursday (or below)
        $seconds_for_week=$seconds_1_jan+3600*24*(7*($week-1)-@$t1[6]+1);
    } else {
        $seconds_for_week=$seconds_1_jan+3600*24*(7*($week-1)-@$t1[6]+8);
    }
    my $wt=localtime($seconds_for_week);
    $$p_date=sprintf("%02d/%02d/%04d",@$wt[3],@$wt[4]+1,@$wt[5]+1900);
} 
```

# java - 如何将我的 Java 程序转换为 .exe 文件？

> ID：147181
> 
> 赞同：551
> 
> 时间：2008-09-29T01:23:59.487
> 
> 标签：java, installation, exe

如果我有 Java 源文件 (*.java) 或类文件 (*.class)，如何将其转换为 .exe 文件？

我还需要我的程序的安装程序。

* * *

## 回答 #1

> 赞同：362
> 
> 时间：2008-09-29T01:42:12.813

### [打包程序](https://docs.oracle.com/javase/10/tools/javapackager.htm)

> Java Packager 工具编译、打包和准备 Java 和 JavaFX 应用程序以进行分发。javapackager 命令是命令行版本。
> 
> – Oracle 的文档

该`javapackager`实用程序随 JDK 一起提供。它可以生成带有标志的 .exe 文件`-native exe`，等等。

### [WinRun4J](http://winrun4j.sourceforge.net/)

> WinRun4j 是一个用于 Windows 的 java 启动器。它是 javaw.exe 的替代品，具有以下优点：
> 
> *   使用 INI 文件指定类路径、主类、虚拟机参数、程序参数。
> *   显示在任务管理器中的自定义可执行文件名称。
> *   额外的 JVM 参数，用于更灵活的内存使用。
> *   自定义图标的内置图标替换器。
> *   *[更多要点如下]*
> 
> – WinRun4J 的网页

WinRun4J 是一个开源实用程序。它有*很多*特点。

### [打包机](https://github.com/libgdx/packr)

> 打包您的 JAR、资产和 JVM，以便在 Windows、Linux 和 Mac OS X 上分发，添加本机可执行文件以使其看起来像本机应用程序。Packr 最适合 GUI 应用程序。
> 
> – 打包器自述文件

packr 是另一个开源工具。

### [JS平滑](http://jsmooth.sourceforge.net/)

> JSmooth 是一个 Java 可执行包装器。它为您的 Java 应用程序创建本机 Windows 启动器（标准 .exe）。它使 Java 部署更加顺畅和用户友好，因为它能够自行找到任何已安装的 Java VM。
> 
> – JSmooth 的网站

JSmooth 是开源的，有特点，但是很老了。最后一次发布是在 2007 年。

### [压缩包](https://www.duckware.com/jexepack/index.html)

> *JexePack*是一个命令行工具（非常适合自动编写脚本），它允许您将 Java 应用程序（类文件）以及它的资源（如 GIF/JPG/TXT/等）打包成单个*压缩*的 32 位 Windows EXE ，它使用 Sun 的 Java 运行时环境运行。支持控制台和窗口应用程序。
> 
> – JexePack 的网站

JexePack 是试用软件。生产使用需要付费，使用此工具创建的exe文件会显示“提醒”，无需付费。此外，最后一次发布是在 2013 年。

### [随处安装](https://www.flexera.com/products/installation/installanywhere.html)

> InstallAnywhere 使开发人员可以轻松地为任何平台创建专业的安装软件。借助 InstallAnywhere，您将快速适应行业变化、更快进入市场并提供引人入胜的客户体验。并在发货前了解您项目的 OSS 组件的漏洞。
> 
> – InstallAnywhere 的网站

InstallAnywhere 是一个商业/企业软件包，可为基于 Java 的程序生成安装程序。它可能能够创建 .exe 文件。

### 可执行的 JAR 文件

[作为 .exe 文件的替代方法，您可以通过向 JAR 清单添加入口点来](https://docs.oracle.com/javase/tutorial/deployment/jar/appman.html)创建双击时自动运行的 JAR 文件。

* * *

# 了解更多信息

[Excelsior 的文章“将 Java 转换为 EXE – 为什么、何时、何时不以及如何](https://www.excelsior-usa.com/articles/java-to-exe.html)”是有关该主题的一个极好的信息来源。

另请参阅配套文章“[最佳 JAR 到 EXE 转换工具，免费和商业](https://www.excelsior-usa.com/articles/best-jar-to-exe-conversion-tools-free-commercial.html)”。

* * *

## 回答 #2

> 赞同：120
> 
> 时间：2008-09-29T08:10:37.437

# [启动4j](http://launch4j.sourceforge.net/)

> Launch4j 是一个跨平台工具，用于将作为 jar 包分发的 Java 应用程序打包到轻量级 Windows 本机可执行文件中。可执行文件可以配置为搜索某个 JRE 版本或使用捆绑的版本，并且可以设置运行时选项，例如初始/最大堆大小。包装器还通过应用程序图标、本地 pre-JRE 启动屏幕、自定义进程名称和 Java 下载页面提供更好的用户体验，以防找不到合适的 JRE。
> 
> – Launch4j 的网站

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-09-29T01:40:25.003

> **更新：** GCJ 死了。它于 2016 年[正式](https://tromey.com/blog/?p=911)从 GCC 项目中删除。甚至在此之前，它实际上已经被废弃了 7 年，而且无论如何它[都还不够完整](https://stackoverflow.com/a/4040404)，无法作为可行的替代 Java 实现。
> 
> 去找另一个 Java AOT 编译器。

[GCJ：GNU Compiler for Java](https://web.archive.org/web/20161119151952im_/http://gcc.gnu.org/java/)可以将 Java 源代码编译为本机机器代码，包括 Windows 可执行文件。

尽管 GCJ 并不支持 Java 中的所有内容，尤其是 GUI 组件（请参阅 [支持哪些 Java API？支持有多完整？](https://web.archive.org/web/20161020222532im_/https://gcc.gnu.org/java/faq.html#2_1)[FAQ](https://web.archive.org/web/20161020222532im_/https://gcc.gnu.org/java/faq.html)中的问题）。我没有太多使用 GCJ，但从我对控制台应用程序所做的有限测试来看，它似乎还不错。

使用 GCJ 创建独立可执行文件的一个缺点是生成的 EXE 的大小可能非常大。有一次我在 GCJ 中编译了一个简单的控制台应用程序，结果是一个大约 1 MB 的可执行文件。（可能有一些我不知道的方法。另一种选择是可执行压缩程序。）

在开源安装程序方面，[Nullsoft Scriptable Install System](https://nsis.sourceforge.io/Main_Page)是一个可编写脚本的安装程序。如果您好奇，有一些[用户提供的示例](https://nsis.sourceforge.io/Category:Code_Examples)说明如何检测 JRE 的存在并在未安装所需 JRE 时自动安装它。（只是让你知道，我以前没有使用过 NSIS。）

有关使用 NSIS 安装 Java 应用程序的更多信息，请查看[我对](https://stackoverflow.com/questions/80105/whats-the-best-way-to-distribute-java-applications#101628)问题“[分发 Java 应用程序的最佳方式是什么？](https://stackoverflow.com/questions/80105/whats-the-best-way-to-distribute-java-applications#101628) ”的回答。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2013-08-17T15:42:04.803

您可以使用以下代码制作批处理文件：

```
start javaw -jar JarFile.jar 
```

并使用任何 .bat 到 .exe 转换器将 .bat 转换为 .exe。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2008-09-29T13:01:46.190

我们正在使用[Install4J](http://www.ej-technologies.com/products/install4j/overview.html)为 windows 或 unix 环境构建安装程序。

它可以轻松定制，直到您想要为标准对话无法完成的特殊操作编写脚本。但即使我们使用它设置 Windows 服务，我们也只使用标准组件。

*   安装程序+启动器
*   windows或unix
*   可在 Java 中编写脚本
*   蚂蚁任务
*   许多可定制的标准面板和动作
*   可选择包含或下载 JRE
*   也可以启动windows服务
*   多种语言

我认为 Launch4J 来自同一家公司（只是启动器 - 没有安装程序）。

PS：很遗憾我没有得到这个代言的报酬。我就是喜欢那个工具。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-05-27T10:09:54.533

最新的[Java Web Start](https://stackoverflow.com/tags/java-web-start/info)已得到增强，允许良好的离线操作以及允许“本地安装”。值得研究。

编辑 2018：Java Web Start 不再与最新的 JDK 捆绑在一起。Oracle 正在推动“使用封闭的 JRE 在本地部署您的应用程序”模型。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-09-29T01:37:33.560

恕我直言， [JSmooth](http://jsmooth.sourceforge.net/)似乎做得很好。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2010-04-29T01:38:47.477

如果您需要将整个应用程序转换为本机代码，即 EXE 加 DLL，则有[ExcelsiorJET](http://www.excelsior-usa.com/jet.html)。我发现它运行良好，并提供了捆绑 JRE 的替代方法。

编辑：这是在 2010 年发布的 - 该产品不再可用。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2012-08-27T18:40:48.410

我想说launch4j是将java源代码（.java）转换为.exe文件的最佳工具您甚至可以将jre与它捆绑在一起进行分发，甚至可以将exe图标化。尽管应用程序的大小增加了，但它确保即使用户没有安装 jre，应用程序也能完美运行。它还确保您能够提供应用所需的特定 jre，而无需用户单独安装。但不幸的是，java 失去了它的重要性。它的多平台支持完全被忽略了，最终的应用程序只支持 Windows。但这没什么大不了的，如果您只为 Windows 用户提供服务。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2013-06-10T09:13:54.803

您可以使用[珍妮尔](http://sourceforge.net/projects/janel/)。最后一个用作应用程序启动器或服务启动器（可从 4.x 获得）。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2021-06-01T12:51:00.510

从 JDK14 开始，@Jay 回答中提到的[jpackage](https://docs.oracle.com/en/java/javase/16/jpackage/packaging-overview.html)替换。`javapackager`Windows 版本需要 Wix 3.0，使用 java 应用程序并构建提供 EXE 启动器的安装程序相当简单。

它还可以与[jlink](https://docs.oracle.com/en/java/javase/16/docs/specs/man/jlink.html)一起使用来构建一个精简的 Java 运行时映像，该映像与安装程序捆绑在一起，并且只包含支持您的应用程序所需的模块集。如果未指定运行时，该`jlink`步骤也将由 jpackage 隐式运行，但我更喜欢单独制作 JRE 映像，因为它只会在您更新 JDK 或向项目中添加新模块依赖项时更改。

Java 类的主要示例：

```
package exe;
public class Main {
    public static void main(String[] args) {
        for (int i = 0; i < args.length; i++) {
            System.out.println("args["+i+"]="+args[i]);
        }
    }
} 
```

以下是在 Windows 上构建的示例步骤 - 显然您已经设置了本地构建环境（Maven / ant / 等）来重新生成它：

```
mkdir jpackage.input\jars tmp
javac -d tmp src\exe\Main.java
pushd tmp && jar cvf ..\jpackage.input\jars\myapp.jar . && popd 
```

检查它是否运行：

```
java -cp jpackage.input\jars\myapp.jar exe.Main X Y Z 
```

使用 jlink 为应用程序使用的一组模块创建运行时映像：

```
set jlink.modules=java.base
jlink --add-modules %jlink.modules% --strip-debug --no-man-pages --no-header-files --compress=1 --output jpackage.jre 
```

如果上面缺少模块，您应该检查 jlink JRE 运行时映像是否可以运行您的应用程序：

```
jpackage.jre\bin\java -cp jpackage.input\jars\myapp.jar exe.Main X Y Z 
```

使用 jpackage 生成安装程序，应用程序[版本](https://stackoverflow.com/questions/62675323/cannot-rerun-java-jpackage-installer-if-already-installed-second-time-just-exit/62819060#62819060)基于日期+小时（这样可以节省每次重新安装时都需要卸载）并打印出所有系统属性 - 测试后删除参数“-XshowSettings:properties”：

```
set appver=%date:~6,2%.%date:~3,2%.%date:~0,2%%time:~0,2%
jpackage --win-console --input jpackage.input --runtime-image jpackage.jre --app-version %appver% --type exe --name "MyApp" --dest jpackage.dest --java-options "-XshowSettings:properties" --main-jar jars\myapp.jar --main-class exe.Main 
```

运行安装程序：

```
jpackage.dest\MyApp-%appver%.exe 
```

测试应用程序：

```
"C:\Program Files\MyApp\MyApp.exe" ONE 2 THREE

... Prints system properties ...

args[0]=ONE
args[1]=2
args[2]=THREE 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2010-05-28T14:26:14.263

或者，您可以使用一些 java-to-c 转换器（例如[JCGO](http://www.ivmaisoft.com/jcgo/)）并将生成的 C 文件编译为目标平台的本地二进制 (.exe) 文件。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2012-07-19T13:16:24.370

我反对将 java 程序转换为 .exe 应用程序是可以原谅的，我有我的理由。主要的一点是可以从很多 IDE 中将 java 程序编译为 jar 文件。当程序为 .jar 格式时，它可以在多个平台上运行，而 .exe 则只能在非常有限的环境中运行。我赞成 Java 程序不应该转换为 Exe 的想法，除非它是非常必要的。人们总是可以编写运行 Java 程序的 .bat 文件，而它是一个 jar 文件。

如果确实需要将其转换为 exe，Jar2Exe 转换器会默默地执行此操作，并且还可以附加与主应用程序一起编译的库。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2012-10-16T17:22:14.640

[您可以使用jar2exe](http://www.regexlab.com/en/jar2exe/)将 jar 转换为 exe 。但是，您需要购买该软件。如果您需要开源软件，我建议您使用[JSmooth](http://jsmooth.sourceforge.net/)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-04T09:26:57.153

*注意事项：*自从第一次提出这个问题以来，打包和部署已经发生了很大变化。给出的大多数答案都不是最新的 JIGSAW (Java 9+)。

如果目标是创建特定于操作系统的包，Oracle Docs Java 17 [Packaging Tool User Guide](https://docs.oracle.com/en/java/javase/7/jpackage/packaging-overview.html#GUID-C1027043-587D-418D-8188-EF8F44A4C06A)中提供了信息。本指南包括该`jpackage`工具的文档，它允许人们为 Linux、macOS 和 Windows 创建特定于平台的包。我认为特定于 Windows 的说明应包括获取 .exe 文件，因为这仍然是 Windows 用户安装和运行应用程序最熟悉的方式。

我自己创建 exe（在 itch.io 上出售）的个人经验是使用*Java 平台标准版部署指南*，其中包括使用工具*Inno Setup 5*。该文档较旧，适用于 Java 9。与 .exe 打包直接相关的部分位于[此处](https://docs.oracle.com/javase/10/deploy/self-contained-application-packaging.htm#JSDPG600)作为第一步，我曾经`jlink`制作一个自包含的包。当我第一次为此争论不休时，我无法弄清楚如何`jpackage`使用我的模块化程序。但是现在 Jigsaw 已经存在了好几年，`jpackage`现在可能更容易使用，并且将是我可能为 Windows 用户发布的下一个 Java 应用程序的首选。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2020-06-20T13:44:35.890

Java 项目导出为 Jar 可执行文件。当你想做一个java项目的.exe文件时，你可以做的是将JAR“转换”为EXE（我说我在引号之间加上了转换，因为不完全是这样）。

从 intelij 你将只能生成 jar

尝试遵循下一个示例：[https ://www.genuinecoder.com/convert-java-jar-to-exe/](https://www.genuinecoder.com/convert-java-jar-to-exe/)

# requirements - 低摩擦最小要求收集

> ID：147182
> 
> 赞同：1
> 
> 时间：2008-09-29T01:24:19.923
> 
> 标签：requirements, process-management, product-management

我们的团队如何以尽可能低摩擦但可用的方式从我们的“产品负责人”那里收集需求？

现在这是指导方针 - 没有无法完成或业务需要做出决定它关心质量的决定的帖子，yada yada。我工作的产品是一个成功多年的小团体。我只是想帮助他们提高一个档次。

基本上，我在一个 6 或 7 人的团队中，只有一个产品负责人。她做得很好，但同时兼顾了几个不同的角色（我相信这在极小的团队中很常见）。通常会在零星的时间给出要求（电子邮件会议、面对面的讨论、会议等）。它们永远不会进入系统，有时这会导致功能缺少发布或发布被推迟，因为每个人都忘记了必要的功能。

如果您处于类似情况，但您找到了克服此问题的方法，我很想听听。我很高兴编写代码来帮助缓解这种情况，但它不能是产品负责人必须访问才能完成任何事情的网站。她非常忙，我们需要某种方式作为一个团队一起工作，以收集这些要求。

我目前正在考虑这样的事情：开发人员和团队成员收集面对面会议上讨论的需求，并就 wiki 页面上讨论的功能写一些简短的笔记。每当这些页面更新时，产品所有者都会收到通知，然后确保准确性成为她的责任。

优点：我们将记录一些功能。缺点：开发人员要为他们通常不会承担的责任。我在这里没问题。我认为在这种情况下，这是团队合作。

当然，一旦我们这样做了，我们就会看到产品负责人可能没有足够的时间来确保功能的准确性。最终她负担过重，我认为这将有助于展示这一事实，但我只需要能够首先引起人们的注意。

那么有什么建议吗？

PS她的时间非常有限，因此期望她在讨论后需要输入要求被认为是不合理的。她只有时间讨论一次然后继续前进。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T21:35:38.703

尽管“产品负责人”的概念对我来说有点模糊，但我认为我的工作环境非常相似：客户非常忙碌，总是成为开发需求的瓶颈。

从表面上看，我们在这种情况下尝试做的事情是非常明显和看似简单的：我们尝试确保客户参与“只读/只谈”模式。没有写作。最低阅读量。主要是说话。

当然，魔鬼在细节中。所以，这里有一些关于我们的流程的细节（没有特别的顺序）：

*   我们经常从**记录问题陈述**开始，这是需求的最终来源。事实上，有时我们最初只记录问题陈述，只是为了确保它不会丢失。

    **注意：**区分问题陈述和需求很重要。尽管问题陈述有时清楚地暗示了一些要求，但一般来说，一个问题陈述可能会产生一大堆要求（每个都有自己的严重性和优先级）；此外，有时给定的需求我定义了多个问题的解决方案（通常只是部分解决方案）。

    记录问题陈述的主要原因之一（**这与您的问题非常相关！**）是语义上它们有点“更接近客户的皮肤”并且比源自它们的要求更稳定。我相信，只要客户有时间向开发团队提供反馈，这些问题陈述就可以更轻松、更快捷地将客户置于适当的环境中。

*   我们确实**记录*了所有*需求（并将它们回溯到问题陈述）**，无论我们何时实施它们。优先级决定了要求的实施顺序。当然，它们还控制客户审查未完成需求的顺序。

    **注意：** **包含所有要求的单个胖文件是绝对禁止的！**所有需求都与错误报告一起放在“问题跟踪数据库”中。（错误只是我们书中问题的一个特例。）

*   我们总是尽量减少“最终确定”每个需求（或一组相关需求）所需**的迭代次数。**理想情况下，客户应该只需要审查一次需求。

    每当第一次审查结果不充分（总是发生），并且所讨论的要求足够复杂以至于需要大量文本和/或插图时，我们**确保客户不必重新阅读所有内容划伤**。自上一个修订版本以来的所有**重要更改/添加/删除都将突出显示。**

    虽然问题或需求仍处于未完成状态，**但所有未解决的问题（主要是向客户提出的问题）都嵌入到文档中并突出显示**。因此，只要客户有时间审查需求，他就不必召集会议并向团队征求问题；相反，客户可以先打开任何未完成的文档，看看他究竟期望什么，然后决定（对他而言）解决任何未完成问题的最佳方式和时间。有时客户选择写一封电子邮件或直接在问题文档中添加评论。

*   我们尽最大努力**建立和维护官方领域词汇**（即使它分散在文档中）。最重要的是，我们实际上迫使客户坚持使用该词汇。

    **注意：**这是流程中最困难的部分之一，客户不时会尝试“反抗”。然而，归根结底，每个人都同意这是使与客户的宝贵会议尽可能高效的唯一方法。如果你曾经参加过 30 分钟的一小时会议，只是为了让每个人都在同一页面上（再次），我相信你会喜欢有一个词汇表。

    **注意：**只要有可能，官方词汇中的任何更改都会反映在软件的下一个版本中。

*   有时，一个给定的问题可以通过多种方式解决，如果不咨询客户，正确的选择并不明显。这意味着将有**一个“需求菜单”供客户选择**。我们记录了这样的“菜单”，而不仅仅是最终选择的要求。

    这可能看起来有争议，并且看起来像是不必要的开销。但是，每当客户（通常是几周或几个月后）突然提出诸如“为什么我们这样做而不是那样做”之类的问题时，这种方法可以节省大量时间。此外，使用适当的需求文档组织/格式来隐藏“被拒绝的分支”并不是什么大不了的事。无聊但可行。:-)

    **注意：**在准备“需求菜单”时，不要过度使用它们是非常重要的。太多的选择或太多的选择嵌套级别 - 下一次审查可能需要比实际需要更多的客户时间。不用说，花在精心设计的分支上的时间可能完全被浪费了。是的，在这里很难找到平衡（这在很大程度上取决于总是匆忙的客户提前两步或多步思考并快速完成的能力）。但是，我能说什么呢？如果你真的想把工作做好，我相信一段时间后你会找到合适的平衡点。:-)

*   我们的客户是一个非常“视觉”的人。因此，每当我们讨论任何重要的用户界面元素时，**屏幕模型**（甚至是轻量级原型）通常都非常有用。有时可以节省时间！

    **注意：**我们*专门*为客户制作屏幕模型，只是为了方便讨论。开发人员也可以使用它们，但它们绝不会替代用户界面规范！通常情况下，有一些非常重要的 UI 细节会以书面形式指定（现在 - 主要针对开发人员）。

*   我们很幸运有一位技术背景非常好的客户。因此，我们毫不犹豫地**使用 UML 图作为讨论辅助**。各种 UML 图——只要它们能帮助客户更快地进入正确的上下文并留在那里。

    当然，我说的是需求级别的 UML 图。与实施级别的无关。我相信即使不是很技术的人也迟早会开始挖掘需求级别的 UML 图。你只需要耐心并且知道在图表上放什么。

显然，这种过程的成本在很大程度上取决于团队的分析和写作技巧，当然也取决于您可以使用的工具。我必须承认，在我们的案例中，这个过程似乎相当昂贵且缓慢。但是，考虑到非常低的错误率和“蒸汽特征”的低率......我认为，从长远来看，我们会得到很好的回报。

FWIW：根据[Joel 对软件产品的分类](http://joelonsoftware.com/articles/FiveWorlds.html)，这个项目是一个“内部”项目。因此，我们可以负担得起客户可以处理的敏捷。:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T01:33:37.110

“开发人员和团队成员收集面对面会议讨论的需求并写一些快速笔记”

从那开始。如果你不做笔记，只需做一点小改动。做笔记。稍后，您可能会将它们发布到 wiki 或创建功能积压或开始使用 Scrum 或 bugzilla 或其他东西。

然而，首先，做一些小的改变。写下来听起来像是你没有做的事情，所以就这样做，看看有什么改进以及下一步可以做什么。敏捷。增量工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T18:15:15.623

您可能要小心房间里的 HiPPO。最高薪人士的意见并不总是好的。我们倾向于更多地专注于为开发人员提供出色的工具和支持。这些事情做对了，可以减少开发中的一些麻烦，让它变得更快、更有趣。然后，开发人员在工作量方面更加灵活，并且更容易接受最新的更改。

一键式测试和部署是一些不错的开始；确保每个开发人员都可以在几秒钟内运行自己的软件堆栈并直接尝试想法。然后，开发人员能够快速进行修订或沿着他们觉得有趣的小路走下去，而这些小路通常是最成功的。我所说的成功是指基于系统中收集的真实指标衡量的成功，并随时可供所有相关人员使用。然后，所有者可以设置他们可能关心的指标，而不是他们不关心或没有定义经验的需求。

当然，这取决于所有者和您的具体情况，但我们发现指标比需求更容易讨论，而且开发人员也非常擅长解释它们。一个典型的问题可能是，客户似乎花了很长时间填充他们的购物车，但没有继续结账。

1）营销要求可能是使结帐按钮更大更红。2) CEO 的要求可能是让顾客直接结账，因为无论如何 CEO 一次只能购买一件商品。3) UI 设计师的要求可能是在购物车顶部放置第二个结帐按钮以及在底部放置现有的结帐按钮。4) 开发人员的需求可能是一些 Web 2.0 AJAX 小部件，它跟随鼠标指针在屏幕上移动。谁是对的？

谁在乎...客户可能看到了可笑的交付成本并逃跑了。但是将问题重新定义为度量，而不是需求，开发人员突然变得感兴趣。开发人员不必与 CMO 就按钮应该是什么红色阴影进行 10 轮讨论。他可以整周都在玩他的 Web 2.0 东西，然后在星期一早上匆忙解决其他 3 个解决方案。每个人都可以实时部署 48 小时，并且会立即测量和报告*购物车到结账率。*这些都没有任何区别，但是开发商必须做好他们的工作，并且业务将重点转移到他们销售的蹩脚产品和他们在交付时衡量的价格上。

好吧，好吧，所以这个例子是人为的。那里有很多工作来确保项目规模小、团队经验丰富、热部署简单、提供即时回滚以及每个人都参与其中。我们想要达到的状态是开发人员的全部潜力不会被浪费，这就是为什么他们不仅从一开始就参与其中，而且还参与到成功中。从注册时点击量过高这样的问题开始，通过设计委员会运行，我们发现点击量在设计规范中实际上上升了。无论如何，那是我们的经验。但是给开发者一些自由来*减少点击次数*就像我们所做的那样，您实际上可能最终获得了专利解决方案。并不是说开发人员关心专利，而是它有优点——而且没有点击！

# ruby-on-rails - RoR + SMS：用于发送/接收 SMS 的 Rails Web 应用程序架构？

> ID：147184
> 
> 赞同：5
> 
> 时间：2008-09-29T01:25:02.340
> 
> 标签：ruby-on-rails, web-applications, sms, mobile-phones

哪种 Web 应用程序架构可以很好地接收/发送 SMS 文本消息？我所说的“架构”是指特定的架构，而不是笼统的，比如 MVC。

背景：我正在构建一个网络应用程序，用于接收来自手机的查询/向手机发送答案。应用程序设计（和商业模式）期望通过 SMS 文本消息与手机设备进行通信。IOW：没有 MVC 网页“视图”。手机屏幕实际上是“视图”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T04:09:18.093

我会质疑这是否真的是一个网络应用程序。如果视图层是 SMS，则不必使用 Internet 作为传输，您可以使用硬件连接到手机网络。

如果您正在考虑使用商业 http/sms 网关，有[一篇](http://www.lukeredpath.co.uk/2007/8/29/sending-sms-messages-from-your-rails-application)关于使用Rails 应用程序中的[Ruby Clicktell gem的好文章。](http://clickatell.rubyforge.org/)似乎是一个很好的尝试路线。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T03:11:51.680

这取决于您将如何接收和发送 SMS 消息。

有一个特定的短消息协议（SMPP - [http://en.wikipedia.org/wiki/SMPP](http://en.wikipedia.org/wiki/SMPP)）。为此，您将需要一个 SMPP 服务器。

如果您使用各种基于 HTTP 的 SMS 提供商之一（例如 Clickatell - [http://www.clickatell.com](http://www.clickatell.com)），那么像 RoR 这样的 Web 框架就可以了，因为 SMS 消息的发送和接收实际上都是 Web要求。在这种情况下，您的系统视图是对网关的 HTTP 响应，而不是手机屏幕。实际上涉及很多步骤： `Cellphone -> Cellular Network -> Gateway -> Your Service`以及回复：`Cellphone <- Cellular Network <- Gateway <- Your Service`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T04:37:43.423

在使用导轨之前，我已经制作了其中之一。我创建了一个预算跟踪器，我可以用我的手机向它发送命令。我用它来创建我需要在即将到来的薪水中购买/照顾的物品清单。当支票进来时，我会发送命令将每个项目从列表中标记出来。我还包括了查询列表的命令。这些命令看起来像“lc mar4”，用于在 3 月份的预算清单中创建第四个薪水。创建列表后，我可以在不指定列表的情况下发送命令，如果没有指定列表，我让脚本只将命令应用于最后一个列表，然后处理其他参数。“la court 50 p”也会在 mar4 列表中添加一个名为“court”的项目，其值为 50 和一个标签“p”，我称之为待定。当我在那个星期五处理法庭时，我可以发送“

我制作了一个空的 Rails 应用程序。制作了我的数据库架构和模型，但没有控制器。我在脚本中有一个脚本，其中包含一个 pop/ssl 库，我在某个地方找到了从我为此设置的 gmail 帐户下载电子邮件的地方。从那时起，这很容易，只需检查每条消息的新消息，确保它来自我的手机并解析消息并选择发回响应。（我已经将该电子邮件地址编程到我的手机中，并向该电子邮件地址发送了文本命令）。我添加了一个 cron 作业并将其设置为每分钟运行一次。

我不知道该架构是什么，但它基本上是一种查询第三方并根据响应执行不同操作的服务。如果您使用短代码进行了真正的 SMS，我现在会让您知道，我认为需要大量投资才能真正做到这些。通过 sms 网关使用电子邮件文本消息开始开发可能更容易。

我并不是说这是迄今为止最好的方法，将消息“推送”给我而不是每分钟检查一次会更酷，但是嘿，我只是想用我的手机来平衡我的预算。

# rest - 为什么我们需要的不仅仅是 HTTP GET、PUT、POST？

> ID：147187
> 
> 赞同：12
> 
> 时间：2008-09-29T01:25:13.230
> 
> 标签：rest

使用 HTTP GET、PUT、DELETE、POST、HEAD 的实际好处是什么？为什么不关注他们的行为优势（安全性和幂等性），忘记他们的名字，并根据我们想要的行为使用 GET、PUT 或 POST？

**为什么我们不应该只使用 GET、PUT 和 POST（以及删除 HEAD、DELETE）？**

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-29T01:30:17.180

[REST][1] 方法使用 POST、GET、PUT 和 DELETE 来实现 Web 资源的 CRUD 规则。这是一种将对象公开给 Web 上的请求的简单而整洁的方法。它是没有开销的 Web 服务。

只是为了澄清语义差异。每个操作都相当不同。关键是要有很好的 HTTP 方法，这些方法具有清晰、不同的含义。

POST 创建新对象。URI 没有密钥；它接受定义对象的消息体。SQL 插入。[*编辑*虽然 POST 没有密钥没有技术原因，但 REST 人员强烈建议 POST 具有与 CREATE 不同的含义，它不应该有密钥。]

GET 检索现有对象。URI*可能*有一个键，取决于你是在做单例 GET 还是列表 GET。SQL 选择

PUT 更新现有对象。URI 有一个密钥；它接受更新对象的消息体。SQL 更新。

DELETE 删除现有对象。URI 有一个密钥。SQL 删除。

您可以使用 POST 而不是 PUT 来更新记录吗？并非没有引入一些歧义。动词应该有明确的效果。此外，POST URI 没有键，而 PUT 必须有键。

当我发布时，我期望 201 已创建。如果我不明白，那就有问题了。同样，当我 PUT 时，我期望 200 OK。如果我不明白，那就有问题了。

我想您可能会坚持在 POST 执行 POST 或 PUT 时存在一些歧义。URI 必须不同；相关的消息也可能不同。通常，REST 人员从 SQL 中获得启发，其中 INSERT 和 UPDATE 是不同的动词。

您可以假设如果记录不存在则 UPDATE 应该插入，或者如果记录存在则更新。但是，如果 UPDATE 意味着 UPDATE 并且更新失败意味着出现问题，则更简单。对 INSERT 的秘密回退使操作变得模棱两可。

如果您没有构建 RESTful 接口，那么通常只使用 GET 和 POST 进行检索和创建/更新。当一个人在表单上单击提交时，通常存在 URI 差异或消息内容差异来区分 POST 和 PUT。但是，它不是很干净，因为您的代码必须确定您是在 POST=create 案例还是 POST=update 案例中。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-16T18:29:44.123

[**POST**](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.5)不保证[安全性**或**幂等](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1)性。**这就是PUT**和**DELETE**的一个原因——PUT 和 DELETE 都是幂等的（即 1+N 个相同的请求与仅 1 个请求具有相同的最终结果）。

[**PUT**](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.6)用于*在给定的 URI 处设置*资源的状态。当您向特定 URI 上的资源发送**POST请求时，****该资源** *不应*被*内容替换*。最多，它应该被*附加*到。这就是为什么 POST 不是幂等的——在附加 POSTS 的情况下，每个请求都会添加到资源中（例如，每次都向讨论论坛发布一条新消息）*。*

[**DELETE**](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.7)用于确保从服务器中删除给定 URI 的资源。*除了提交*删除请求的情况外，通常不应使用**POST**进行删除。同样，在这种情况下您将发布到的资源的 URI 不应是您要删除的资源的 URI。您发布到的任何资源都是接受发布数据以附加到自身、添加到集合或以其他方式处理的资源。

 *[](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.4)**如果您只关心 GET 请求的标头并且您不想在实际内容上浪费带宽，则使用[**HEAD 。**](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.4)这是很好的。**

 *** * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T01:35:30.287

为什么我们需要的不仅仅是 POST？它允许数据双向流动，那么为什么需要 GET 呢？答案与您的问题基本相同。通过标准化各种方法的基本期望，其他流程可以更好地知道该做什么。

例如，干预缓存代理可以有更好的机会做正确的事情。

以 HEAD 为例。如果代理服务器知道 HEAD 的含义，那么它可以处理先前 GET 请求的结果，为 HEAD 请求提供正确的答案。并且它可以知道 POST、PUT 和 DELETE 不应该被缓存。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-16T23:50:26.190

没有人发布我正在寻找的那种答案，所以我将尝试自己总结要点。

“RESTful Web Services”第 8 章“重载 POST”部分写道：“如果你想完全不使用 PUT 和 DELETE，那么通过 GET 公开对资源的安全操作以及通过重载 POST 公开所有其他操作完全是 RESTful。这样做违反了我的面向资源的架构，但它符合限制较少的 REST 规则。”

简而言之，**将 PUT/DELETE 替换为 POST 会使 API 更难阅读，并且 PUT/DELETE 调用不再是幂等**的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-27T15:19:28.877

一句话：

幂等性

再多说几句：

GET = 安全 + 幂等

PUT = 幂等

删除 = 幂等

POST = 既不安全也不幂等

“幂等”只是意味着你可以一遍又一遍地做它，它总是会做完全相同的事情。

您可以根据需要多次重新发出 PUT（更新）或 DELETE 请求，并且每次都会产生相同的效果，但是所需的效果会修改资源，因此它不被视为“安全”。

POST 请求应该为每个请求创建一个新资源，这意味着每次的效果都会不同。因此 POST 不被认为是安全的或幂等的。

像 GET 和 HEAD 这样的方法只是读取操作，因此被认为是“安全的”以及幂等的。

这实际上是一个非常重要的概念，因为它提供了一种标准/一致的方式来解释 HTTP 事务；这在安全环境中特别有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T02:18:39.450

并非所有主机都不支持 PUT、DELETE。

我问了这个问题，在一个理想的世界里，我们会有所有的动词，但是......：

[RESTful Web 服务和 HTTP 动词](https://stackoverflow.com/questions/23963/restful-web-services-and-http-verbs)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T05:36:37.180

HEAD 对于确定给定服务器的时钟设置非常有用（精确到 1 秒或网络往返时间，以较大者为准）。从 Slashdot 获取 Futurama 报价也很棒：

```
~$ curl -I slashdot.org
HTTP/1.1 200 正常
日期：格林威治标准时间 2008 年 10 月 29 日星期三 05:35:13
服务器：Apache/1.3.41 (Unix) mod_perl/1.31-rc4
SLASH_LOG_DATA：shtml
X-Powered-By：斜线 2.005001227
X-Fry：那是小鸡秀。我更喜欢这种类型的节目：World's Blankiest Blank。
缓存控制：私有
Pragma：私人的
连接：关闭
内容类型：文本/html；字符集=iso-8859-1
```

对于[cURL](http://curl.haxx.se/)，`-I`是执行 HEAD 请求的选项。要获取给定服务器的当前日期和时间，只需执行

`curl -I $server | grep ^Date`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T02:23:12.747

限制歧义，这将允许更好/更轻松地重用我们的简单 REST api。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T02:30:27.597

你可以只使用 GET 和 POST，但是你会失去 PUT 和 DELETE 带来的一些精确性和清晰度。POST 是一个通配符操作，它可能意味着任何东西。PUT 和 DELETE 的行为非常明确。如果您想到资源管理 API，那么 GET、PUT 和 DELETE 可能涵盖了所需功能的 80%-90%。如果您将自己限制为 GET 和 POST，那么 40%-60% 的 api 是使用指定不当的 POST 访问的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-16T17:54:44.817

使用 GET 和 POST 的 Web 应用程序允许用户创建、查看、修改和删除他们的数据，但这样做是在最初为这些目的创建的 HTTP 命令之上的一层。REST 背后的想法之一是回归 Web 设计的初衷，即每个 CRUD 动词都有特定的 HTTP 操作。

此外，HEAD 命令可用于改善（可能很大）文件下载的用户体验。您调用 HEAD 以了解响应的大小，然后调用 GET 以实际检索内容。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-16T18:04:57.883

有关说明性示例，请参见以下[链接。](http://www.infoq.com/articles/webber-rest-workflow)它还提出了一种使用 OPTIONS http 方法的方法，此处尚未讨论。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-17T00:00:00.133

有像 WebDAV 这样的 http 扩展需要额外的功能。

[http://en.wikipedia.org/wiki/WebDAV](http://en.wikipedia.org/wiki/WebDAV)

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-29T02:40:31.787

早期的网络服务器战争可能是造成它的原因。

在[1996 年编写的 HTTP 1.0 中，只有 GET、HEAD 和 POST](https://www.rfc-editor.org/rfc/rfc1945#section-8)。但正如您在[附录 D](https://www.rfc-editor.org/rfc/rfc1945#appendix-D.1)中看到的，供应商开始添加他们自己的东西。因此，为了保持 HTTP 兼容，他们被迫[在 1999 年制作了 HTTP 1.1](https://www.rfc-editor.org/rfc/rfc2616#section-1)。

> 但是，HTTP/1.0 没有充分考虑分层代理、缓存、持久连接的需求或虚拟主机的影响。此外，自称为“HTTP/1.0”的未完全实现的应用程序激增，需要更改协议版本，以便两个通信应用程序确定彼此的真实能力。
> 
> 该规范定义了称为“HTTP/1.1”的协议。该协议包括比 HTTP/1.0 更严格的要求，以确保其功能的可靠实现。

* * *

## 回答 #14

> 赞同：-4
> 
> 时间：2008-10-16T18:07:59.860

GET、PUT、DELETE 和 POST 是一个时代的遗留物，当时大二学生认为网页可以简化为一些简单的原则。

如今，大多数网页都是复合实体，其中包含部分或全部这些原始操作。例如，一个页面可能包含用于查看或更新客户信息的表单，这些表单可能跨越多个表。

我通常在 php 中使用 $_REQUEST[]，并不真正关心信息是如何到达的。我会选择使用基于效率的 GET 或 PUT 方法，而不是底层（多个）范例。

# rest - REST 中的事务？

> ID：147207
> 
> 赞同：157
> 
> 时间：2008-09-29T01:33:52.820
> 
> 标签：rest

我想知道您将如何在 REST 中实现以下用例。是否有可能在不损害概念模型的情况下做到这一点？

在单个事务的范围内读取或更新多个资源。例如，将 100 美元从 Bob 的银行账户转入 John 的账户。

据我所知，实现这一点的唯一方法是作弊。您可以 POST 到与 John 或 Bob 关联的资源，并使用单个事务执行整个操作。就我而言，这破坏了 REST 架构，因为您实际上是通过 POST 隧道调用 RPC 调用，而不是真正对单个资源进行操作。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-09-29T02:13:30.790

考虑一个 RESTful 购物篮场景。购物篮在概念上是您的交易包装器。与您可以将多个商品添加到购物篮然后提交该购物篮以处理订单的方式相同，您可以将 Bob 的帐户条目添加到交易包装器中，然后将 Bill 的帐户条目添加到包装器中。当所有部分都到位后，您可以使用所有组件部分发布/放置事务包装器。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2011-01-19T22:46:28.447

这个问题没有回答一些重要的案例，我认为这太糟糕了，因为它在谷歌上的搜索词排名很高:-)

具体来说，一个不错的属性是：如果您 POST 两次（因为中间有一些缓存打嗝），您不应该将金额转移两次。

为此，您将事务创建为对象。这可能包含您已经知道的所有数据，并将交易置于待处理状态。

```
POST /transfer/txn
{"source":"john's account", "destination":"bob's account", "amount":10}

{"id":"/transfer/txn/12345", "state":"pending", "source":...} 
```

一旦你有了这个事务，你就可以提交它，比如：

```
PUT /transfer/txn/12345
{"id":"/transfer/txn/12345", "state":"committed", ...}

{"id":"/transfer/txn/12345", "state":"committed", ...} 
```

请注意，此时多个 put 无关紧要。甚至 txn 上的 GET 也会返回当前状态。具体来说，第二个 PUT 会检测到第一个 PUT 已经处于适当的状态，然后将其返回——或者，如果您在它已经处于“提交”状态后尝试将其置于“回滚”状态，您会得到一个错误，并返回实际提交的事务。

只要您与单个数据库或具有集成事务监视器的数据库通信，这种机制实际上就可以正常工作。您还可以为交易引入超时，如果您愿意，您甚至可以使用 Expires 标头来表示。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2011-04-03T23:56:16.000

在 REST 术语中，资源是可以使用 CRUD（创建/读取/更新/删除）动词作用的名词。由于没有“转账”动词，我们需要定义一个可以使用 CRUD 执行的“交易”资源。这是 HTTP+POX 中的一个示例。第一步是**创建**（HTTP POST 方法）一个新的**空**事务：

```
POST /transaction 
```

这将返回一个事务 ID，例如“1234”和相应的 URL“/transaction/1234”。请注意，多次触发此 POST 不会创建具有多个 ID 的同一事务，并且还会避免引入“待处理”状态。此外，POST 不能始终是幂等的（REST 要求），因此最好尽量减少 POST 中的数据。

您可以将事务 ID 的生成留给客户端。在这种情况下，您将发布 /transaction/1234 以创建事务“1234”，如果它已经存在，服务器将返回一个错误。在错误响应中，服务器可能会返回一个当前未使用的 ID 以及相应的 URL。使用 GET 方法向服务器查询新 ID 不是一个好主意，因为 GET 永远不应该改变服务器状态，而创建/保留新 ID 会改变服务器状态。

接下来，我们用所有数据**更新**（PUT HTTP 方法）事务，隐式提交它：

```
PUT /transaction/1234
<transaction>
  <from>/account/john</from>
  <to>/account/bob</to>
  <amount>100</amount>
</transaction> 
```

如果之前已经 PUT 了 ID 为“1234”的事务，则服务器给出错误响应，否则给出 OK 响应和 URL 以查看已完成的事务。

注意：在 /account/john 中，“john”应该是 John 的唯一帐号。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-12-14T04:33:37.473

很好的问题，REST 主要通过类似数据库的示例来解释，其中存储、更新、检索、删除某些内容。像这样的例子很少，服务器应该以某种方式处理数据。我不认为 Roy Fielding 在他的论文中包含任何内容，毕竟它是基于 http 的。

但他确实将“代表性状态转移”作为状态机谈论，链接移动到下一个状态。通过这种方式，文档（表示）跟踪客户端状态，而不是服务器必须这样做。通过这种方式，没有客户端状态，只有您在哪个链接上的状态。

我一直在想这个，在我看来，让服务器为你处理一些东西，当你上传时，服务器会自动创建相关资源，并给你它们的链接（实际上它不会不需要自动创建它们：它可以只告诉您链接，并且仅在您关注它们时创建它们 - 延迟创建）。并且还为您提供创建*新*相关资源的链接 - 相关资源具有相同的 URI 但更长（添加后缀）。例如：

1.  您上传（**POST ）****包含所有信息**的交易概念的表示。 这看起来就像一个 RPC 调用，但它实际上是在创建“提议的事务资源”。例如 URI：`/transaction` 故障将导致创建多个此类资源，每个资源都有不同的 URI。
2.  服务器的响应说明了创建的资源的 URI，它的表示 - 这包括链接 ( **URI** ) 以创建**新的“已提交事务资源”的相关资源。**其他相关资源是删除提议交易的链接。这些是状态机中的状态，客户端可以遵循这些状态。从逻辑上讲，这些是在服务器上创建的资源的一部分，超出了客户端提供的信息。例如 URI: `/transaction/1234/proposed`, `/transaction/1234/committed`
3.  您**发布**到链接以**创建“提交的交易资源”**，该资源创建该资源，更改服务器的状态（两个帐户的余额）**。就其性质而言，此资源只能创建一次，并且不能更新。因此，不会发生提交许多事务的故障。
4.  您可以获取这两个资源，以查看它们的状态。假设 POST 可以更改其他资源，该提案现在将被标记为“已提交”（或者可能根本不可用）。

这类似于网页的操作方式，最终网页显示“您确定要这样做吗？” 最终的网页本身就是交易状态的表示，其中包括进入下一个状态的链接。不仅仅是金融交易；也（例如）预览然后在维基百科上提交。我猜 REST 的区别在于状态序列中的每个阶段都有一个明确的名称（它的 URI）。

在现实生活中的交易/销售中，交易的不同阶段（提案、采购订单、收据等）通常有不同的物理文件。更适合买房，定居等。

OTOH 这对我来说就像在玩语义；我对将动词转换为名词以使其成为 RESTful 的名词化感到不舒服，“因为它使用名词（URI）而不是动词（RPC 调用）”。即名词“提交的事务资源”而不是动词“提交这个事务”。我想名词化的一个优点是您可以按名称引用资源，而无需以其他方式指定它（例如维护会话状态，因此您知道“此”事务是什么...）

但重要的问题是：这种方法有什么好处？即，这种 REST 风格比 RPC 风格在哪些方面更好？除了存储/检索/更新/删除之外，对网页有用的技术是否也有助于处理信息？我认为 REST 的主要好处是可扩展性。其中一个方面是不需要显式维护客户端状态（但将其隐含在资源的 URI 中，并将下一个状态作为其表示中的链接）。从这个意义上说，它有所帮助。也许这也有助于分层/流水线？OTOH 只有一个用户会查看他们的特定事务，因此缓存它以便其他人可以读取它没有任何优势，这是 http 的一大胜利。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2016-02-15T09:35:39.710

我已经离开这个话题 10 年了。回来，我无法相信当你谷歌休息+可靠时你涉足的伪装成科学的宗教。混乱是神话般的。

我会将这个广泛的问题分为三个：

*   下游服务。您开发的任何 Web 服务都将具有您使用的下游服务，并且您别无选择，只能遵循其事务语法。您应该尝试对您的服务用户隐藏所有这些，并确保您的操作的所有部分作为一个组成功或失败，然后将此结果返回给您的用户。
*   您的服务。客户希望 Web 服务调用得到明确的结果，而直接在实质性资源上发出 POST、PUT 或 DELETE 请求的通常 REST 模式让我觉得这是一种提供这种确定性的糟糕且易于改进的方式。如果您关心可靠性，则需要识别操作请求。这个 id 可以是在客户端创建的 guid，也可以是来自服务器上的关系数据库的种子值，没关系。对于服务器生成的 ID，使用“预检”请求-响应来交换操作的 ID。如果这个请求失败或成功一半，没问题，客户端只是重复请求。未使用的 id 没有害处。

    这很重要，因为它允许所有后续请求完全幂等，因为如果它们重复 n 次，它们将返回相同的结果并且不会导致任何进一步的发生。服务器存储所有针对 action id 的响应，如果它看到相同的请求，它会重放相同的响应。在[这个 google doc](https://docs.google.com/document/d/1s0joc0yb6kXpXZGfdE9SRutoPQuK9RVa77f92xsXzrM/edit?usp=sharing)中对模式进行了更全面的处理。该文档提出了一种实现，我相信（！），它广泛遵循 REST 原则。专家肯定会告诉我它是如何侵犯他人的。无论是否涉及下游事务，此模式都可用于对 Web 服务的任何不安全调用。
*   将您的服务集成到由上游服务控制的“事务”中。在 Web 服务的上下文中，完整的 ACID 交易通常被认为不值得付出努力，但是您可以通过在确认响应中提供取消和/或确认链接来极大地帮助您的服务的消费者，从而[通过补偿实现交易](https://docs.microsoft.com/en-us/azure/architecture/patterns/compensating-transaction)。

您的要求是基本要求。不要让人们告诉你你的解决方案是不洁的。根据他们解决问题的好坏程度和简单程度来判断他们的架构。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2014-03-09T03:57:25.197

如果您回过头来总结这里的讨论，很明显 REST 不适用于许多 API，尤其是当客户端-服务器交互本质上是有状态的时，因为它具有非平凡事务。为什么要跳过所有建议的箍，对于客户端和服务器来说，为了迂腐地遵循一些不适合问题的原则？一个更好的原则是为客户提供最简单、最自然、最有效的方式来组合应用程序。

总之，如果您真的在应用程序中执行大量事务（类型，而不是实例），那么您真的不应该创建 RESTful API。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-29T01:52:04.630

您必须推出自己的“交易 ID”类型的 tx 管理。所以这将是4个电话：

```
http://service/transaction (some sort of tx request)
http://service/bankaccount/bob (give tx id)
http://service/bankaccount/john (give tx id)
http://service/transaction (request to commit) 
```

您必须处理将操作存储在数据库（如果负载平衡）或内存等中，然后处理提交、回滚、超时。

在公园里不是真正的休息日。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-10-19T09:22:09.030

首先，转账是您在单个资源调用中无法完成的事情。您要做的操作是汇款。因此，您将汇款资源添加到发件人的帐户中。

```
POST: accounts/alice, new Transfer {target:"BOB", abmount:100, currency:"CHF"}. 
```

完毕。您不需要知道这是一个必须是原子的交易等。您只需转移资金。从 A 向 B 汇款。

* * *

但对于罕见的情况，这里有一个通用的解决方案：

如果你想做一些非常复杂的事情，在定义的上下文中涉及许多资源，并且有很多限制，实际上跨越了什么与为什么的障碍（业务与实施知识），你需要转移状态。由于 REST 应该是无状态的，因此您作为客户端需要转移状态。

如果您传输状态，则需要向客户端隐藏内部信息。客户不应知道仅执行所需的内部信息，但不携带与业务相关的信息。如果这些信息没有商业价值，则应该对状态进行加密，并且需要使用令牌、通行证等隐喻。

通过这种方式，人们可以传递内部状态，并且使用加密和签名系统仍然可以安全可靠。为客户找到正确的抽象为什么要传递状态信息取决于设计和架构。

* * *

真正的解决方案：

记住 REST 是在谈论 HTTP，而 HTTP 带有使用 cookie 的概念。当人们谈论跨越多个资源或请求的 REST API 和工作流和交互时，这些 cookie 经常被遗忘。

记住维基百科中关于 HTTP cookie 的内容：

> Cookie 旨在成为网站记住状态信息（例如购物车中的商品）或记录用户浏览活动（包括单击特定按钮、登录或记录用户访问过哪些页面）的可靠机制回到几个月或几年前）。

因此，基本上如果您需要传递状态，请使用 cookie。它是出于完全相同的原因而设计的，它是 HTTP，因此它在设计上与 REST 兼容 :)。

* * *

更好的解决方案：

如果您谈论客户端执行涉及多个请求的工作流，您通常会谈论协议。每种形式的协议都为每个潜在步骤提供了一组先决条件，例如在执行步骤 A 之前执行步骤 B。

这是很自然的，但向客户端公开协议会使一切变得更加复杂。为了避免它，只要想想我们在现实世界中必须进行复杂的交互和事情时会做什么...... 我们使用代理。

使用代理隐喻，您可以提供一种资源，该资源可以为您执行所有必要的步骤，并将它正在执行的实际分配/指令存储在其列表中（因此我们可以在代理或“代理”上使用 POST）。

一个复杂的例子：

买房：

您需要证明您的可信度（例如提供您的警察记录条目），您需要确保财务细节，您需要使用律师和受信任的第三方存储资金购买实际房屋，验证房屋现在属于您并且将购买的东西添加到您的税务记录等中（例如，某些步骤可能是错误的或其他）。

这些步骤可能需要几天才能完成，有些可以并行完成，等等。

为了做到这一点，你只需给代理任务买房，如：

```
POST: agency.com/ { task: "buy house", target:"link:toHouse", credibilities:"IamMe"}. 
```

完毕。该机构会向您发回一份参考资料，您可以使用该参考资料查看和跟踪该工作的状态，其余工作由该机构的代理人自动完成。

例如，考虑一个错误跟踪器。基本上，您报告错误并可以使用错误 ID 来检查发生了什么。你甚至可以使用服务来监听这个资源的变化。任务完成。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-07-05T08:58:17.080

不得在 REST 中使用服务器端事务。

REST 约束之一：

> 无状态
> 
> 客户端-服务器通信进一步受到请求之间没有客户端上下文存储在服务器上的限制。来自任何客户端的每个请求都包含服务请求所需的所有信息，并且任何会话状态都保存在客户端中。

唯一的 RESTful 方式是创建事务重做日志并将其置于客户端状态。通过请求，客户端发送重做日志，服务器重做事务并

1.  回滚事务但提供新的事务重做日志（更进一步）
2.  或最终完成交易。

但也许使用支持服务器端事务的基于服务器会话的技术更简单。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-29T02:35:37.257

我认为在这种情况下，在这种情况下打破 REST 的纯理论是完全可以接受的。无论如何，我认为 REST 中实际上没有任何内容表明您不能在需要它的业务案例中触及依赖对象。

我真的认为，当您可以利用数据库来执行此操作时，您将跳过创建自定义事务管理器的额外步骤是不值得的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-10-08T03:37:33.737

在简单的情况下（没有分布式资源），您可以将事务视为一种资源，其中创建它的行为达到了最终目标。

因此，要在`<url-base>/account/a`和之间转移`<url-base>/account/b`，您可以将以下内容发布到`<url-base>/transfer`。

```
<转移>
    <from><url-base>/account/a</from>
    <to><url-base>/account/b</to>
    <数量>50</数量>
</转移>

```

这将创建一个新的传输资源并返回传输的新 url - 例如`<url-base>/transfer/256`。

然后，在成功发布的那一刻，“真实”交易在服务器上进行，金额从一个帐户中删除并添加到另一个帐户。

然而，这不包括分布式事务（如果说“a”在一个服务后面的一家银行持有，而“b”在另一个服务后面的另一家银行持有）——除了说“试着把所有以不需要分布式事务的方式进行操作”。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-03-26T19:22:24.927

我相信这将是使用在客户端生成的唯一标识符来确保连接中断不会暗示 API 保存的重复性的情况。

我认为使用客户端生成的 GUID 字段以及转账对象并确保不再重新插入相同的 GUID 将是银行转账问题的更简单的解决方案。

不知道更复杂的场景，例如多机票预订或微架构。

我找到了一篇关于这个主题的论文，讲述了[在 RESTful 服务中处理事务原子性](http://ws-rest.org/2014/sites/default/files/wsrest2014_submission_7.pdf)的经验。

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2008-09-29T02:01:48.117

我想您可以在 URL/资源中包含 TAN：

1.  PUT /transaction 获取ID（例如“1”）
2.  [PUT，GET，POST，随便] /1/account/bob
3.  [PUT、GET、POST 等] /1/account/bill
4.  删除/事务 ID 1

只是一个想法。

# javascript - 如何在不调整整体宽度的情况下隐藏表格行？

> ID：147208
> 
> 赞同：7
> 
> 时间：2008-09-29T01:33:58.777
> 
> 标签：javascript, html, css, xhtml, html-table

有没有办法在不影响整个表格宽度的情况下隐藏表格行？我有一些显示/隐藏一些表格行的 javascript，但是当这些行设置为`display: none;`时，表格会缩小以适应可见行的内容。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T01:36:17.087

如果您希望保留表格的整体宽度，您可以在隐藏一行之前检查它，并将宽度样式属性显式设置为此值：

```
table.style.width = table.clientWidth + "px";
table.rows[3].style.display = "none"; 
```

但是，当您隐藏行时，这可能会导致各个列重排。减轻这种情况的一种可能方法是向表中添加样式：

```
 table {
  table-layout: fixed;
 } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2019-03-07T16:08:44.840

CSS 规则[`visibility: collapse`](https://developer.mozilla.org/en-US/docs/Web/CSS/visibility#Values)正是为此而设计的。

```
tbody.collapsed > tr {
    visibility: collapse;
} 
```

添加此 CSS 后，您可以通过以下方式触发 JS 的可见性：

```
tbody.classList.toggle('collapsed'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T02:09:00.333

作为参考，levik 的解决方案非常有效。在我的例子中，使用 jQuery，解决方案看起来像这样：

```
$('#tableId').width($('#tableId').width()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T13:23:23.737

在 CSS 中，`table-layout: fixed;`在您的表格上指示浏览器遵循您为高度和宽度指定的尺寸。这通常会抑制浏览器自动调整大小，除非您没有给出任何关于行和列的首选大小的提示。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-24T15:10:08.623

您可以使用纯 HTML 来完成

```
<table border="1">
  <colgroup>
    <col width="150px" />
    <col width="10px"  />
    <col width="220px" />
  </colgroup>
  <tr>
    <td valign="top">1</td>
    <td> </td>
    <td>2</td>
  </tr>
  <tr>
    <td>3</td>
    <td> </td>
    <td>4</td>
  </tr>
</table>
```

# sql-server - 如何为 T-SQL 表变量中的标识列重新设定种子？

> ID：147210
> 
> 赞同：37
> 
> 时间：2008-09-29T01:34:17.933
> 
> 标签：sql-server, tsql, table-variable

我有一个 T-SQL**表变量**（不是表），它有一个自动递增的标识列。我想清除该变量中的所有数据并将标识列值重置为 1。如何做到这一点？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-29T02:57:12.820

如果您使用的是表变量，则不能这样做。如果它是一个表，你可以截断它或使用`DBCC CHECKIDENT`. 但是，如果您*必须*使用表变量，则必须使用标识列以外的其他内容。或者，更准确地说，使用表变量中的标识列，但输出使用`ROWNUMBER`：

```
DECLARE @t table (pkint int IDENTITY(1,1), somevalue nvarchar(50))
INSERT INTO @t (somevalue) VALUES( 'one')
INSERT INTO @t (somevalue) VALUES('twp')
INSERT INTO @t (somevalue) VALUES('three')
SELECT row_number() OVER (ORDER BY pkint), somevalue FROM @t
DELETE FROM @t
INSERT INTO @t (somevalue) VALUES('four')
SELECT row_number() OVER (ORDER BY pkint), somevalue FROM @t 
```

这是你可以用 table 变量做的最好的事情。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-29T01:37:46.023

截断表将转储所有数据，并重置身份种子。

否则，您可以使用此调用来重置身份，同时保留任何数据：

```
DBCC CHECKIDENT (yourtableName, reseed, @NewStartSeedValue) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-01-26T04:58:12.267

我建议你使用两个表变量。@Table1 在第一列有一个标识种子。@Table2 具有相同的第一列，但上面没有标识种子。

当你循环你的过程时，

```
Insert into @Table2 from @Table1 
```

然后从两个表中删除作为您的流程循环。

在您的第一次通过时，@Table2 将在第一行中有一个从 1 开始的序列号。

第二次通过循环，您的第二个表可能在第一列中的序号从 1081 开始。但是如果您选择变量的最小值

```
(Select @FixSeed = min(RowID) From @Table2) 
```

然后您可以更新 @Table2 以使 RowID 从 1 开始，如下所示：

```
Update @Table2  Set  RowID = RowID - @FixSeed +1 
```

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-07T17:02:22.973

```
 declare @tb table (recid int,lineof int identity(1,1))

    insert into @tb(recid)
    select recid from tabledata 

    delete from @tb where lineof>(select min(lineof) from @tb)+@maxlimit 
```

当我想在使用 SQL 2000 时使用 TOP 和变量时，我这样做了。基本上，您添加记录，然后查看最小值。我有同样的问题，并注意到这个线程。删除表不会重置种子，尽管我想使用 GO 应该删除表和变量来重置种子。

上面查询中的@maxlimit 是为了获取查询的前 900 个，并且由于表变量将具有不同的起始标识键，这将解决该问题。

任何后续查询都可以减去该派生过程以使其插入为“1”等。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2011-10-27T23:12:52.523

如果您需要在while循环的每一轮中截断表变量，您可以将`declare @myTbl (...)`语句放入循环中。这将在循环的每一轮重新创建表并重置标识列。但是，它对性能造成了严重影响。我有一个相当紧凑的循环，并且相对于重新声明表变量要`delete @myTbl`慢几倍。

*   担

# ruby - Ruby isPrime 方法

> ID：147240
> 
> 赞同：24
> 
> 时间：2008-09-29T01:47:29.137
> 
> 标签：ruby, regex, primes

```
('1' * N) !~ /^1?$|^(11+?)\1+$/ 
```

在网上，我发现这段 Ruby 代码适用于 N >= 0，它确定 N 是否为素数。据我所知，它看起来像是在玩正则表达式，但我不知道它是如何工作的。有人可以告诉我它是如何工作的吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-29T01:53:14.253

您可以在此处找到此代码的详细说明： [http ://www.noulakaz.net/weblog/2007/03/18/a-regular-expression-to-check-for-prime-numbers/](http://www.noulakaz.net/weblog/2007/03/18/a-regular-expression-to-check-for-prime-numbers/)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-01-18T19:58:27.267

这可能有点离题，但在 Ruby 1.9 中，您可以这样做：

```
 require 'mathn'
 38749711234868463.prime?
 => false 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-04-01T08:44:46.097

```
require 'prime'

Prime.prime?(4)
# => false

Prime.prime?(5)
# => true 
```

或者：

```
require 'prime'

Prime.instance.prime?(4)
# => false

Prime.instance.prime?(5)
# => true 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T07:55:46.317

另请参阅[您使用过的最出色的正则表达式是什么？](https://stackoverflow.com/questions/20448/what-is-the-most-brilliant-regex-youve-ever-used)（是的，我可以确认这个正则表达式最初是由 Abigail 编写的。我什至听过她解释它是如何工作的 :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T07:42:39.797

最大公约数（gcd）：

```
/^(1+)\1*=\1+$/.match('1' * x + '=' + '1' * y)[1].length 
```

这和 is_prime 都以大致相同的方式工作。它会在放弃之前尝试所有组合。

这个将尝试将第一个数字分成偶数部分，并将第二个数字与这些部分中的一个或多个匹配。如果找到匹配项，则返回所选部分的长度。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-18T20:35:37.380

另一个有很好解释的博客：[Famous Perl One-Liners Explained (part III)](http://www.catonmat.net/blog/perl-one-liners-explained-part-three/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-13T20:52:05.617

如果一个 1 的字符串的长度是复合的，那么该字符串可以分解为多个相同的子字符串，如 111111 -> 11 11 11

例如，1111111111，有 10 个 1，匹配 (11){5} 或 (11111){2}，其中 {2} 表示重复 2 次。111111111，有 9 个 1，匹配 (111){3}。

通过概括 1 的计数和 {} 中的数字，正则表达式是 `/(1{2,}){2,}/`. 但是，1{2,} 也可以写成 11+，并且 (...){2,} 可以重写为 (...)\1+，带有反向引用。

第`^1?$`一个交替中的部分检查 0 和 1 情况。

# web-services - 如何远程（通过 Web 服务）确定 SharePoint 2003 站点的日期格式，以便在 Versions.asmx 返回的 XML 中使用？

> ID：147245
> 
> 赞同：1
> 
> 时间：2008-09-29T01:51:02.263
> 
> 标签：web-services, sharepoint, locale, regional, date-format

SharePoint 2003 中对 Versions.asmx Web 服务的 GetVersions() 调用返回本地化的日期格式，但无法确定格式是什么。这是日期格式的站点区域设置，但我找不到从 SharePoint 2003 中获取的方法。在本地，看起来可以使用 SPRegionalSettings ( [http://msdn.microsoft.com/en-us/ library/microsoft.sharepoint.spregionalsettings.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spregionalsettings.aspx)）但是这个的网络服务版本呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T03:44:25.127

可悲的是，它不可用。但是，您可以指定一个查询选项来指定您希望以 UTC 格式返回的值：

[http://www.sharepointblogs.com/pm4everyone/archive/2006/10/03/sharepoint-2003-querying-with-gmt-datetime.aspx](http://www.sharepointblogs.com/pm4everyone/archive/2006/10/03/sharepoint-2003-querying-with-gmt-datetime.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T09:13:01.570

不幸的是，此调用不支持要求 UTC 值的参数。我只需要寻找大于 12 的月份并将其用作切换日期格式的提示。它会弄乱一些日期，但我看不出有什么办法。如果有人感兴趣，代码位于[http://sourceforge.net/projects/splistcp/ 。](http://sourceforge.net/projects/splistcp/)

# database - 我可以在我的事实表中将非度量代码与度量混合吗？

> ID：147260
> 
> 赞同：0
> 
> 时间：2008-09-29T01:58:01.077
> 
> 标签：database, database-design, data-warehouse

我们正在做一些复杂的数据积累。我们的客户向我们发送了一些包含两个维度（时间和业务单位）的内容。时间主要是年月。业务单位维度只有几个属性：名称和几个类别，BU 可以属于这些类别以用于报告和分析目的。

他们发给我们的东西包括一些当前状态信息（日期和代码）。这些看起来像事实。他们还发送一些描述与业务部门关系的信息（主要是附加代码）。同样，这些对于业务部门和时间段来说是独一无二的。

最后，他们向我们发送了显然是附加事实的东西。它包括具有适当单位的货币和计数。

我应该将这些定性信息与附加事实混合在一个事实表中吗？或者我应该将定性的东西（只能与计数一起使用）与定量的东西（可以与总和一起使用）分开吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T02:20:59.787

如果数据既与附加事实直接相关，又不是您想要对其进行分组/排序/搜索的数据，那么将其放入事实表中是可以的。

但请注意，事实表中的非相加数据要么会阻止汇总，要么会成为有损操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T02:50:19.727

仅当事物退化时才将它们放入事实表中（导致维度中的高基数/唯一性问题，其中维度与事实表的关系为 1-1）。Kimball 建议避免将退化维度以外的任何内容与事实（例如，唯一的订单号）结合起来。

你总是可以把这些放在 Kimball 所说的“垃圾”维度中。所有这些代码都可以简单地归为垃圾维度。大多数日期将作为特定角色的日期维度的键进入事实表（通常使用 YYYYMMDD 形式的自然 int 键 - 这是我们不使用非身份无意义代理键的唯一时间之一）

我喜欢天真地将星星视为所有事实，然后哪些列进入哪些维度只是由方便决定的。不必将它们视为对应于特定的业务实体 - 请记住，星号不是 ERD 样式的规范化 OLTP 数据库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T15:31:09.257

Brad Wilson 准确地描述了将它们添加到事实表中的风险。过去，我在事实表中添加了垃圾属性，只是为了以后需要重构。

> 他们发给我们的东西包括一些当前状态信息（日期和代码）。这些看起来像事实。他们还发送一些描述与业务部门关系的信息（主要是附加代码）。同样，这些对于业务部门和时间段来说是独一无二的。

这些日期有什么商业目的？顺便说一句，我建议将它们设为自己的尺寸并准确描述它们。

进来的额外代码有多不稳定？如果事实表的粒度是日期和BU，为什么不能将它们包含在BU维度中并视为渐变属性？

如果没有更多细节，我无法做出坚定的建议，但这些将是我要问自己的第一个问题。

# javascript - jQuery - 通过单击链接问题触发事件

> ID：147264
> 
> 赞同：7
> 
> 时间：2008-09-29T01:59:17.827
> 
> 标签：javascript, jquery, firefox, events

我想通过正常单击链接或在新选项卡中打开链接（例如，中键单击、ctrl + 单击等）在单击链接时触发事件

到目前为止，我已经尝试了以下方法：

`$('a').click(myfunc)` 不捕获中间点击。

`$('a').mousedown(myfunc)`有效，但它似乎阻止了链接被跟踪，即使我的函数没有调用`event.preventDefault`.

任何想法如何做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T02:11:15.367

尝试从您的处理程序函数返回**true 。**浏览器可以将不返回任何内容解释为无效返回，从而阻止执行默认操作。

# c - 在C中使用枚举类型的变量作为字符串的简单方法？

> ID：147267
> 
> 赞同：94
> 
> 时间：2008-09-29T02:00:24.800
> 
> 标签：c, enums, c-preprocessor

这是我想做的事情：

```
typedef enum { ONE, TWO, THREE } Numbers; 
```

我正在尝试编写一个函数来执行类似于以下的切换案例：

```
char num_str[10];
int process_numbers_str(Numbers num) {
  switch(num) {
    case ONE:
    case TWO:
    case THREE:
    {
      strcpy(num_str, num); //some way to get the symbolic constant name in here?
    } break;
    default:
      return 0; //no match
  return 1;
} 
```

有没有办法像我在上面尝试做的那样使用枚举变量来设置它，而不是在每种情况下都定义？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-10-14T19:33:50.157

[使某物既是 C 标识符又是字符串](https://stackoverflow.com/questions/126277/making-something-both-a-c-identifier-and-a-string)的技术？可以在这里使用。

像往常一样使用这种预处理器的东西，编写和理解预处理器部分可能很困难，包括将宏传递给其他宏，并涉及使用 # 和 ## 运算符，但使用它真的很容易。我发现这种风格对于长枚举非常有用，在这种情况下，两次维护同一个列表真的很麻烦。

## 工厂代码 - 只输入一次，通常隐藏在标题中：

枚举工厂.h：

```
// expansion macro for enum value definition
#define ENUM_VALUE(name,assign) name assign,

// expansion macro for enum to string conversion
#define ENUM_CASE(name,assign) case name: return #name;

// expansion macro for string to enum conversion
#define ENUM_STRCMP(name,assign) if (!strcmp(str,#name)) return name;

/// declare the access function and define enum values
#define DECLARE_ENUM(EnumType,ENUM_DEF) \
  enum EnumType { \
    ENUM_DEF(ENUM_VALUE) \
  }; \
  const char *GetString(EnumType dummy); \
  EnumType Get##EnumType##Value(const char *string); \

/// define the access function names
#define DEFINE_ENUM(EnumType,ENUM_DEF) \
  const char *GetString(EnumType value) \
  { \
    switch(value) \
    { \
      ENUM_DEF(ENUM_CASE) \
      default: return ""; /* handle input error */ \
    } \
  } \
  EnumType Get##EnumType##Value(const char *str) \
  { \
    ENUM_DEF(ENUM_STRCMP) \
    return (EnumType)0; /* handle input error */ \
  } \ 
```

## 工厂使用

一些枚举.h：

```
#include "enumFactory.h"
#define SOME_ENUM(XX) \
    XX(FirstValue,) \
    XX(SecondValue,) \
    XX(SomeOtherValue,=50) \
    XX(OneMoreValue,=100) \

DECLARE_ENUM(SomeEnum,SOME_ENUM) 
```

一些枚举.cpp：

```
#include "someEnum.h"
DEFINE_ENUM(SomeEnum,SOME_ENUM) 
```

该技术可以轻松扩展，以便 XX 宏接受更多参数，并且您还可以准备更多宏来替代 XX 以满足不同的需求，类似于我在此示例中提供的三个。

## 使用 #include / #define / #undef 与 X-Macros 进行比较

虽然这类似于其他人提到的 X-Macros，但我认为这个解决方案更优雅，因为它不需要 #undefing 任何东西，它允许您隐藏更多复杂的东西在工厂中的头文件 - 头文件当您需要定义一个新的枚举时，您根本不会触及它，因此新的枚举定义要短得多且更清晰。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2008-09-29T05:00:33.757

```
// Define your enumeration like this (in say numbers.h);
ENUM_BEGIN( Numbers )
    ENUM(ONE),
    ENUM(TWO),
    ENUM(FOUR)
ENUM_END( Numbers )

// The macros are defined in a more fundamental .h file (say defs.h);
#define ENUM_BEGIN(typ) enum typ {
#define ENUM(nam) nam
#define ENUM_END(typ) };

// Now in one and only one .c file, redefine the ENUM macros and reinclude
//  the numbers.h file to build a string table
#undef ENUM_BEGIN
#undef ENUM
#undef ENUM_END
#define ENUM_BEGIN(typ) const char * typ ## _name_table [] = {
#define ENUM(nam) #nam
#define ENUM_END(typ) };
#undef NUMBERS_H_INCLUDED   // whatever you need to do to enable reinclusion
#include "numbers.h"

// Now you can do exactly what you want to do, with no retyping, and for any
//  number of enumerated types defined with the ENUM macro family
//  Your code follows;
char num_str[10];
int process_numbers_str(Numbers num) {
  switch(num) {
    case ONE:
    case TWO:
    case THREE:
    {
      strcpy(num_str, Numbers_name_table[num]); // eg TWO -> "TWO"
    } break;
    default:
      return 0; //no match
  return 1;
}

// Sweet no ? After being frustrated by this for years, I finally came up
//  with this solution for my most recent project and plan to reuse the idea
//  forever 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-29T02:06:34.533

没有内置的解决方案。`char*`最简单的方法是使用枚举的 int 值索引到包含该枚举的描述性名称的字符串的数组。如果您有一个稀疏的`enum`（不是从 0 开始或编号中有间隙的），其中一些`int`映射足够高以使基于数组的映射不切实际，那么您可以改用哈希表。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-29T13:17:09.727

肯定有办法做到这一点——使用[X() 宏](http://www.ddj.com/cpp/184401387)。这些宏使用 C 预处理器从源数据列表中构造枚举、数组和代码块。您只需将新项目添加到包含 X() 宏的#define。switch 语句将自动扩展。

你的例子可以写成如下：

```
 // Source data -- Enum, String
 #define X_NUMBERS \
    X(ONE,   "one") \
    X(TWO,   "two") \
    X(THREE, "three")

 ...

 // Use preprocessor to create the Enum
 typedef enum {
  #define X(Enum, String)       Enum,
   X_NUMBERS
  #undef X
 } Numbers;

 ...

 // Use Preprocessor to expand data into switch statement cases
 switch(num)
 {
 #define X(Enum, String) \
     case Enum:  strcpy(num_str, String); break;
 X_NUMBERS
 #undef X

     default: return 0; break;
 }
 return 1; 
```

还有更有效的方法（即使用 X Macros 创建字符串数组和枚举索引），但这是最简单的演示。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-29T13:48:46.390

我知道您有几个很好的可靠答案，但是您知道 C 预处理器中的 # 运算符吗？

它可以让你这样做：

```
#define MACROSTR(k) #k

typedef enum {
    kZero,
    kOne,
    kTwo,
    kThree
} kConst;

static char *kConstStr[] = {
    MACROSTR(kZero),
    MACROSTR(kOne),
    MACROSTR(kTwo),
    MACROSTR(kThree)
};

static void kConstPrinter(kConst k)
{
    printf("%s", kConstStr[k]);
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-07-05T15:46:16.883

吻。你将用你的枚举做各种其他的 switch/case 事情，那么为什么打印应该不同呢？当您考虑到大约有 100 个其他地方可以忘记一个案例时，在您的打印程序中忘记一个案例并不是什么大问题。只需编译 -Wall，它将警告非详尽的大小写匹配。不要使用“默认”，因为这会使切换变得详尽，并且您不会收到警告。相反，让开关退出并像这样处理默认情况......

```
const char *myenum_str(myenum e)
{
    switch(e) {
    case ONE: return "one";
    case TWO: return "two";
    }
    return "invalid";
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-29T02:44:23.257

C 或 C++ 不提供此功能，尽管我经常需要它。

以下代码有效，尽管它最适合非稀疏枚举。

```
typedef enum { ONE, TWO, THREE } Numbers;
char *strNumbers[] = {"one","two","three"};
printf ("Value for TWO is %s\n",strNumbers[TWO]); 
```

通过非稀疏，我的意思不是形式

```
typedef enum { ONE, FOUR_THOUSAND = 4000 } Numbers; 
```

因为那里面有很大的差距。

这种方法的优点是它把枚举和字符串的定义放在一起；在函数中使用 switch 语句将它们分开。这意味着你不太可能在没有另一个的情况下改变一个。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-29T02:28:01.440

尝试[将 C++ 枚举转换为字符串](http://www.codeproject.com/KB/cpp/C___enums_to_strings.aspx)。当枚举项具有任意值时，[注释](http://www.codeproject.com/KB/cpp/C___enums_to_strings.aspx?fid=184894&tid=1139776)具有解决问题的改进。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-02-23T02:02:03.277

[boost::preprocessor](http://www.boost.org/doc/libs/1_48_0/libs/preprocessor/doc/index.html)的使用使得一个优雅的解决方案成为可能，如下所示：

第一步：包含头文件：

```
#include "EnumUtilities.h" 
```

步骤 2：使用以下语法声明枚举对象：

```
MakeEnum( TestData,
         (x)
         (y)
         (z)
         ); 
```

第 3 步：使用您的数据：

获取元素数量：

```
td::cout << "Number of Elements: " << TestDataCount << std::endl; 
```

获取相关字符串：

```
std::cout << "Value of " << TestData2String(x) << " is " << x << std::endl;
std::cout << "Value of " << TestData2String(y) << " is " << y << std::endl;
std::cout << "Value of " << TestData2String(z) << " is " << z << std::endl; 
```

从关联的字符串中获取枚举值：

```
std::cout << "Value of x is " << TestData2Enum("x") << std::endl;
std::cout << "Value of y is " << TestData2Enum("y") << std::endl;
std::cout << "Value of z is " << TestData2Enum("z") << std::endl; 
```

这看起来干净紧凑，没有额外的文件要包含。我在 EnumUtilities.h 中编写的代码如下：

```
#include <boost/preprocessor/seq/for_each.hpp>
#include <string>

#define REALLY_MAKE_STRING(x) #x
#define MAKE_STRING(x) REALLY_MAKE_STRING(x)
#define MACRO1(r, data, elem) elem,
#define MACRO1_STRING(r, data, elem)    case elem: return REALLY_MAKE_STRING(elem);
#define MACRO1_ENUM(r, data, elem)      if (REALLY_MAKE_STRING(elem) == eStrEl) return elem;

#define MakeEnum(eName, SEQ) \
    enum eName { BOOST_PP_SEQ_FOR_EACH(MACRO1, , SEQ) \
    last_##eName##_enum}; \
    const int eName##Count = BOOST_PP_SEQ_SIZE(SEQ); \
    static std::string eName##2String(const enum eName eel) \
    { \
        switch (eel) \
        { \
        BOOST_PP_SEQ_FOR_EACH(MACRO1_STRING, , SEQ) \
        default: return "Unknown enumerator value."; \
        }; \
    }; \
    static enum eName eName##2Enum(const std::string eStrEl) \
    { \
        BOOST_PP_SEQ_FOR_EACH(MACRO1_ENUM, , SEQ) \
        return (enum eName)0; \
    }; 
```

有一些限制，即 boost::preprocessor 的限制。在这种情况下，常量列表不能大于 64 个元素。

按照相同的逻辑，您还可以考虑创建稀疏枚举：

```
#define EnumName(Tuple)                 BOOST_PP_TUPLE_ELEM(2, 0, Tuple)
#define EnumValue(Tuple)                BOOST_PP_TUPLE_ELEM(2, 1, Tuple)
#define MACRO2(r, data, elem)           EnumName(elem) EnumValue(elem),
#define MACRO2_STRING(r, data, elem)    case EnumName(elem): return BOOST_PP_STRINGIZE(EnumName(elem));

#define MakeEnumEx(eName, SEQ) \
    enum eName { \
    BOOST_PP_SEQ_FOR_EACH(MACRO2, _, SEQ) \
    last_##eName##_enum }; \
    const int eName##Count = BOOST_PP_SEQ_SIZE(SEQ); \
    static std::string eName##2String(const enum eName eel) \
    { \
        switch (eel) \
        { \
        BOOST_PP_SEQ_FOR_EACH(MACRO2_STRING, _, SEQ) \
        default: return "Unknown enumerator value."; \
        }; \
    }; 
```

在这种情况下，语法是：

```
MakeEnumEx(TestEnum,
           ((x,))
           ((y,=1000))
           ((z,))
           ); 
```

用法与上面类似（减去 eName##2Enum 函数，您可以尝试从前面的语法推断）。

我在 mac 和 linux 上对其进行了测试，但请注意 boost::preprocessor 可能不是完全可移植的。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-04-10T12:23:22.520

通过在这里合并一些技术，我想出了最简单的形式：

```
#define MACROSTR(k) #k

#define X_NUMBERS \
       X(kZero  ) \
       X(kOne   ) \
       X(kTwo   ) \
       X(kThree ) \
       X(kFour  ) \
       X(kMax   )

enum {
#define X(Enum)       Enum,
    X_NUMBERS
#undef X
} kConst;

static char *kConstStr[] = {
#define X(String) MACROSTR(String),
    X_NUMBERS
#undef X
};

int main(void)
{
    int k;
    printf("Hello World!\n\n");

    for (k = 0; k < kMax; k++)
    {
        printf("%s\n", kConstStr[k]);
    }

    return 0;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-04-28T13:40:01.780

如果您使用的是 gcc，则可以使用：

```
const char * enum_to_string_map[]={ [enum1]='string1', [enum2]='string2'}; 
```

然后只需调用例如

```
enum_to_string_map[enum1] 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-29T04:19:11.097

[在Mu Dynamics 研究实验室 - 博客存档](http://labs.mudynamics.com/2007/01/03/enums-strings-and-laziness/)中查看这些想法。我在今年早些时候发现了这个——我忘记了我遇到它的确切上下文——并将它改编成这段代码。我们可以讨论在前面添加 E 的优点；它适用于解决的具体问题，但不是一般解决方案的一部分。我把它藏在我的“vignettes”文件夹中——在那里我保留了一些有趣的代码片段，以防我以后想要它们。我很尴尬地说我当时没有记下这个想法的来源。

**头文件：paste1.h**

```
/*
@(#)File:           $RCSfile: paste1.h,v $
@(#)Version:        $Revision: 1.1 $
@(#)Last changed:   $Date: 2008/05/17 21:38:05 $
@(#)Purpose:        Automated Token Pasting
*/

#ifndef JLSS_ID_PASTE_H
#define JLSS_ID_PASTE_H

/*
 * Common case when someone just includes this file.  In this case,
 * they just get the various E* tokens as good old enums.
 */
#if !defined(ETYPE)
#define ETYPE(val, desc) E##val,
#define ETYPE_ENUM
enum {
#endif /* ETYPE */

   ETYPE(PERM,  "Operation not permitted")
   ETYPE(NOENT, "No such file or directory")
   ETYPE(SRCH,  "No such process")
   ETYPE(INTR,  "Interrupted system call")
   ETYPE(IO,    "I/O error")
   ETYPE(NXIO,  "No such device or address")
   ETYPE(2BIG,  "Arg list too long")

/*
 * Close up the enum block in the common case of someone including
 * this file.
 */
#if defined(ETYPE_ENUM)
#undef ETYPE_ENUM
#undef ETYPE
ETYPE_MAX
};
#endif /* ETYPE_ENUM */

#endif /* JLSS_ID_PASTE_H */ 
```

**示例来源：**

```
/*
@(#)File:           $RCSfile: paste1.c,v $
@(#)Version:        $Revision: 1.2 $
@(#)Last changed:   $Date: 2008/06/24 01:03:38 $
@(#)Purpose:        Automated Token Pasting
*/

#include "paste1.h"

static const char *sys_errlist_internal[] = {
#undef JLSS_ID_PASTE_H
#define ETYPE(val, desc) desc,
#include "paste1.h"
    0
#undef ETYPE
};

static const char *xerror(int err)
{
    if (err >= ETYPE_MAX || err <= 0)
        return "Unknown error";
    return sys_errlist_internal[err];
}

static const char*errlist_mnemonics[] = {
#undef JLSS_ID_PASTE_H
#define ETYPE(val, desc) [E ## val] = "E" #val,
#include "paste1.h"
#undef ETYPE
};

#include <stdio.h>

int main(void)
{
    int i;

    for (i = 0; i < ETYPE_MAX; i++)
    {
        printf("%d: %-6s: %s\n", i, errlist_mnemonics[i], xerror(i));
    }
    return(0);
} 
```

不一定是世界上最干净的 C 预处理器使用 - 但它确实可以防止多次写出材料。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T09:29:33.173

[使某物既是 C 标识符又是字符串](https://stackoverflow.com/questions/126277/making-something-both-a-c-identifier-and-a-string)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-29T02:06:39.433

如果枚举索引是从 0 开始的，您可以将名称放在 char* 数组中，并使用枚举值对它们进行索引。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-09-19T17:13:22.283

我认为像 Boost.Fusion 这样的用于调整结构和类的解决方案会很好，他们甚至在某个时候拥有它，将枚举用作融合序列。

所以我只做了一些小宏来生成代码来打印枚举。这并不完美，与 Boost.Fusion 生成的样板代码无关，但可以像 Boost Fusion 宏一样使用。我真的想生成 Boost.Fusion 所需的类型以集成到允许打印结构成员名称的基础设施中，但这将在稍后发生，因为现在这只是宏：

```
#ifndef SWISSARMYKNIFE_ENUMS_ADAPT_ENUM_HPP
#define SWISSARMYKNIFE_ENUMS_ADAPT_ENUM_HPP

#include <swissarmyknife/detail/config.hpp>

#include <string>
#include <ostream>
#include <boost/preprocessor/cat.hpp>
#include <boost/preprocessor/stringize.hpp>
#include <boost/preprocessor/seq/for_each.hpp>

#define SWISSARMYKNIFE_ADAPT_ENUM_EACH_ENUMERATION_ENTRY_C(                     \
    R, unused, ENUMERATION_ENTRY)                                               \
    case ENUMERATION_ENTRY:                                                     \
      return BOOST_PP_STRINGIZE(ENUMERATION_ENTRY);                             \
    break;                                                                      

/**
 * \brief Adapts ENUM to reflectable types.
 *
 * \param ENUM_TYPE To be adapted
 * \param ENUMERATION_SEQ Sequence of enum states
 */
#define SWISSARMYKNIFE_ADAPT_ENUM(ENUM_TYPE, ENUMERATION_SEQ)                   \
    inline std::string to_string(const ENUM_TYPE& enum_value) {                 \
      switch (enum_value) {                                                     \
      BOOST_PP_SEQ_FOR_EACH(                                                    \
          SWISSARMYKNIFE_ADAPT_ENUM_EACH_ENUMERATION_ENTRY_C,                   \
          unused, ENUMERATION_SEQ)                                              \
        default:                                                                \
          return BOOST_PP_STRINGIZE(ENUM_TYPE);                                 \
      }                                                                         \
    }                                                                           \
                                                                                \
    inline std::ostream& operator<<(std::ostream& os, const ENUM_TYPE& value) { \
      os << to_string(value);                                                   \
      return os;                                                                \
    }

#endif 
```

下面的旧答案很糟糕，请不要使用它。:)

# 老答案：

我一直在寻找一种无需过多更改枚举声明语法即可解决此问题的方法。我找到了一个解决方案，它使用预处理器从字符串化枚举声明中检索字符串。

我可以像这样定义非稀疏枚举：

```
SMART_ENUM(State, 
    enum State {
        RUNNING,
        SLEEPING, 
        FAULT, 
        UNKNOWN
    }) 
```

我可以通过不同的方式与他们互动：

```
// With a stringstream
std::stringstream ss;
ss << State::FAULT;
std::string myEnumStr = ss.str();

//Directly to stdout
std::cout << State::FAULT << std::endl;

//to a string
std::string myStr = State::to_string(State::FAULT);

//from a string
State::State myEnumVal = State::from_string(State::FAULT); 
```

基于以下定义：

```
#define SMART_ENUM(enumTypeArg, ...)                                                     \
namespace enumTypeArg {                                                                  \
    __VA_ARGS__;                                                                         \
    std::ostream& operator<<(std::ostream& os, const enumTypeArg& val) {                 \
            os << swissarmyknife::enums::to_string(#__VA_ARGS__, val);                   \
            return os;                                                                   \
    }                                                                                    \
                                                                                     \
    std::string to_string(const enumTypeArg& val) {                                      \
            return swissarmyknife::enums::to_string(#__VA_ARGS__, val);                  \
    }                                                                                    \
                                                                                     \
    enumTypeArg from_string(const std::string &str) {                                    \
            return swissarmyknife::enums::from_string<enumTypeArg>(#__VA_ARGS__, str);   \
    }                                                                                    \
}                                                                                        \

namespace swissarmyknife { namespace enums {

    static inline std::string to_string(const std::string completeEnumDeclaration, size_t enumVal) throw (std::runtime_error) {
        size_t begin = completeEnumDeclaration.find_first_of('{');
        size_t end = completeEnumDeclaration.find_last_of('}');
        const std::string identifiers = completeEnumDeclaration.substr(begin + 1, end );

        size_t count = 0;
        size_t found = 0;
        do {
            found = identifiers.find_first_of(",}", found+1);

            if (enumVal == count) {
                std::string identifiersSubset = identifiers.substr(0, found);
                size_t beginId = identifiersSubset.find_last_of("{,");
                identifiersSubset = identifiersSubset.substr(beginId+1);
                boost::algorithm::trim(identifiersSubset);
                return identifiersSubset;
            }

            ++count;
        } while (found != std::string::npos);

        throw std::runtime_error("The enum declaration provided doesn't contains this state.");
    }                                                  

    template <typename EnumType>
    static inline EnumType from_string(const std::string completeEnumDeclaration, const std::string &enumStr) throw (std::runtime_error) {
        size_t begin = completeEnumDeclaration.find_first_of('{');
        size_t end = completeEnumDeclaration.find_last_of('}');
        const std::string identifiers = completeEnumDeclaration.substr(begin + 1, end );

        size_t count = 0;
        size_t found = 0;
        do {
            found = identifiers.find_first_of(",}", found+1);

            std::string identifiersSubset = identifiers.substr(0, found);
            size_t beginId = identifiersSubset.find_last_of("{,");
            identifiersSubset = identifiersSubset.substr(beginId+1);
            boost::algorithm::trim(identifiersSubset);

            if (identifiersSubset == enumStr) {
                return static_cast<EnumType>(count);
            }

            ++count;
        } while (found != std::string::npos);

        throw std::runtime_error("No valid enum value for the provided string");
    }                      

}} 
```

当我需要对稀疏枚举的支持并且当我有更多时间时，我将使用 boost::xpressive 改进**to_string**和**from_string**实现，但这将花费编译时间，因为执行的重要模板和生成的可执行文件是可能真的更大。但这有一个优点，即它比这个丑陋的手动字符串操作代码更具可读性和可维护性。**:D**

否则我总是使用 boost::bimap 来执行枚举值和字符串之间的这种映射，但它必须手动维护。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-11-02T02:46:31.890

```
#define stringify( name ) # name

enum MyEnum {
    ENUMVAL1
};
...stuff...

stringify(EnumName::ENUMVAL1);  // Returns MyEnum::ENUMVAL1 
```

[对该方法的进一步讨论](http://www.cplusplus.com/forum/general/2949/)

[新手的预处理指令技巧](http://www.cprogramming.com/tutorial/cpreprocessor.html)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-07-31T23:11:47.437

我创建了一个简单的模板类`streamable_enum`，它使用流运算符`<<`，`>>`并且基于`std::map<Enum, std::string>`：

```
#ifndef STREAMABLE_ENUM_HPP
#define STREAMABLE_ENUM_HPP

#include <iostream>
#include <string>
#include <map>

template <typename E>
class streamable_enum
{
public:
    typedef typename std::map<E, std::string> tostr_map_t;
    typedef typename std::map<std::string, E> fromstr_map_t;

    streamable_enum()
    {}

    streamable_enum(E val) :
        Val_(val)
    {}

    operator E() {
        return Val_;
    }

    bool operator==(const streamable_enum<E>& e) {
        return this->Val_ == e.Val_;
    }

    bool operator==(const E& e) {
        return this->Val_ == e;
    }

    static const tostr_map_t& to_string_map() {
        static tostr_map_t to_str_(get_enum_strings<E>());
        return to_str_;
    }

    static const fromstr_map_t& from_string_map() {
        static fromstr_map_t from_str_(reverse_map(to_string_map()));
        return from_str_;
    }
private:
    E Val_;

    static fromstr_map_t reverse_map(const tostr_map_t& eToS) {
        fromstr_map_t sToE;
        for (auto pr : eToS) {
            sToE.emplace(pr.second, pr.first);
        }
        return sToE;
    }
};

template <typename E>
streamable_enum<E> stream_enum(E e) {
    return streamable_enum<E>(e);
}

template <typename E>
typename streamable_enum<E>::tostr_map_t get_enum_strings() {
    // \todo throw an appropriate exception or display compile error/warning
    return {};
}

template <typename E>
std::ostream& operator<<(std::ostream& os, streamable_enum<E> e) {
    auto& mp = streamable_enum<E>::to_string_map();
    auto res = mp.find(e);
    if (res != mp.end()) {
        os << res->second;
    } else {
        os.setstate(std::ios_base::failbit);
    }
    return os;
}

template <typename E>
std::istream& operator>>(std::istream& is, streamable_enum<E>& e) {
    std::string str;
    is >> str;
    if (str.empty()) {
        is.setstate(std::ios_base::failbit);
    }
    auto& mp = streamable_enum<E>::from_string_map();
    auto res = mp.find(str);
    if (res != mp.end()) {
        e = res->second;
    } else {
        is.setstate(std::ios_base::failbit);
    }
    return is;
}

#endif 
```

用法：

```
#include "streamable_enum.hpp"

using std::cout;
using std::cin;
using std::endl;

enum Animal {
    CAT,
    DOG,
    TIGER,
    RABBIT
};

template <>
streamable_enum<Animal>::tostr_map_t get_enum_strings<Animal>() {
    return {
        { CAT, "Cat"},
        { DOG, "Dog" },
        { TIGER, "Tiger" },
        { RABBIT, "Rabbit" }
    };
}

int main(int argc, char* argv []) {
    cout << "What animal do you want to buy? Our offering:" << endl;
    for (auto pr : streamable_enum<Animal>::to_string_map()) {          // Use from_string_map() and pr.first instead
        cout << " " << pr.second << endl;                               // to have them sorted in alphabetical order
    }
    streamable_enum<Animal> anim;
    cin >> anim;
    if (!cin) {
        cout << "We don't have such animal here." << endl;
    } else if (anim == Animal::TIGER) {
        cout << stream_enum(Animal::TIGER) << " was a joke..." << endl;
    } else {
        cout << "Here you are!" << endl;
    }

    return 0;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-11-22T00:45:18.043

这是使用具有以下功能的宏的解决方案：

1.  仅将枚举的每个值写入一次，因此无需维护双重列表

2.  不要将枚举值保存在稍后#included 的单独文件中，这样我就可以将它写在我想要的任何地方

3.  不要替换枚举本身，我仍然希望定义枚举类型，但除此之外我希望能够将每个枚举名称映射到相应的字符串（不影响遗留代码）

4.  对于那些巨大的枚举，搜索应该很快，所以最好不要使用 switch-case

[https://stackoverflow.com/a/20134475/1812866](https://stackoverflow.com/a/20134475/1812866)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-03-29T13:14:50.060

因为出于所有通常的原因我不喜欢使用宏，所以我使用了一个更有限的宏解决方案，它具有保持枚举声明宏免费的优点。缺点包括必须复制粘贴每个枚举的宏定义，并且在向枚举添加值时必须显式添加宏调用。

```
std::ostream& operator<<(std::ostream& os, provenance_wrapper::CaptureState cs)
{
#define HANDLE(x) case x: os << #x; break;
    switch (cs) {
    HANDLE(CaptureState::UNUSED)
    HANDLE(CaptureState::ACTIVE)
    HANDLE(CaptureState::CLOSED)
    }
    return os;
#undef HANDLE
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-10-24T13:59:20.667

该线程缺少一种更简单且更清晰的方法：

```
 #define ENUM_PUSH(ENUM)   ENUM,
    #define STRING_PUSH(STR)  #STR,

    #define FETCH_MSG(X)      \
            X(string1)        \
            X(string2)        \

    static const char * msgStr[] = {
        FETCH_MSG(STRING_PUSH)
    };

    enum msg {
        FETCH_MSG(ENUM_PUSH)
    };

    static enum msg message;

    void iterate(void) {
        switch (message) {
        case string1:
// do your thing here
            break;
        case string2:
            break;
        }
    } 
```

唯一的缺点是最后一个单元格将在后面加上逗号，尽管 C/C++ 编译器似乎可以接受。

# c++ - C/C++ 的多线程内存分配器

> ID：147298
> 
> 赞同：37
> 
> 时间：2008-09-29T02:13:02.817
> 
> 标签：c++, c, memory, malloc, allocation

我目前有大量的多线程服务器应用程序，我正在四处寻找一个好的多线程内存分配器。

到目前为止，我在：

*   孙梅
*   谷歌的 tcmalloc
*   英特尔的线程构建块分配器
*   埃默里·伯杰的宝藏

根据我的发现，hoard 可能是最快的，但我在今天之前没有听说过它，所以我怀疑它是否真的像看起来那么好。任何人都有尝试这些分配器的个人经验吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-29T04:01:01.157

我使用过 tcmalloc 并阅读了有关 Hoard 的信息。两者都有类似的实现，并且都实现了相对于线程/CPU 数量的大致线性性能扩展（根据各自站点上的图表）。

所以：如果性能真的非常重要，那么就进行性能/负载测试。否则，只需掷骰子并选择列出的一个（根据目标平台上的易用性加权）。

从[trshiv 的链接](http://developers.sun.com/solaris/articles/multiproc/multiproc.html)来看，Hoard、tcmalloc 和 ptmalloc 的速度似乎都差不多。总体而言，tt 看起来 ptmalloc 为尽可能少地占用空间而优化，Hoard 为速度 + 内存使用的权衡而优化，而 tcmalloc 为纯速度而优化。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-11-14T19:46:27.850

真正判断哪个内存分配器适合您的应用程序的唯一方法是尝试一些。提到的所有分配器都是由聪明的人编写的，并且将在一个特定的微基准测试或另一个上击败其他分配器。如果您的应用程序整天所做的只是在线程 A 中分配一个 8 字节块并在线程 B 中释放它，并且根本不需要处理任何其他事情，那么您可能会编写一个内存分配器来击败任何一个到目前为止列出的那些。它对其他很多事情都没有多大用处。:)

我在工作的地方有一些使用 Hoard 的经验（足以让我发现最近的 3.8 版本中解决的一个更模糊的错误是由于该经验而发现的）。这是一个非常好的分配器——但对你来说有多好取决于你的工作量。而且你必须为 Hoard 付费（尽管它并不太贵）才能在商业项目中使用它，而无需 GPL 对你的代码进行 GPL。

很长一段时间以来，经过轻微调整的 ptmalloc2 一直是 glibc 的 malloc 背后的分配器，因此它被广泛使用和测试。如果稳定性高于一切，它可能是一个不错的选择，但你没有在列表中提到它，所以我假设它已经过时了。对于某些工作负载，这很糟糕——但任何通用 malloc 也是如此。

如果您愿意为此付费（而且价格合理，根据我的经验），[SmartHeap SMP](http://www.microquill.com/smartheapsmp/index.html "智能堆 SMP")也是一个不错的选择。提到的大多数其他分配器都设计为可以 LD_PRELOAD 的插入式 malloc/free new/delete 替换。SmartHeap 也可以这样使用，但它还包括一个完整的与分配相关的 API，可让您根据自己的需要微调分配器。在我们已经完成的测试中（同样，非常特定于特定应用程序），SmartHeap 作为替代 malloc 时的性能与 Hoard 大致相同；两者的真正区别在于定制的程度。您需要分配器的通用性越低，您就可以获得更好的性能。

并且根据您的用例，通用多线程分配器可能根本不是您想要使用的；如果您不断地 malloc 和释放大小相同的对象，您可能只想编写一个简单的平板分配器。Slab 分配用于 Linux 内核中符合该描述的多个位置。（我会给你几个更有用的链接，但我是一个“新用户”，Stack Overflow 决定不允许新用户在一个答案中提供*太多*帮助。不过，谷歌可以提供足够的帮助。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T04:38:42.843

我个人更喜欢并推荐 ptmalloc 作为多线程分配器。Hoard 很好，但是在几年前我的团队在 Hoard 和 ptmalloc 之间进行的评估中，ptmalloc 更好。据我所知，ptmalloc 已经存在了很多年，并且被广泛用作多线程分配器。

您可能会发现[此比较](http://developers.sun.com/solaris/articles/multiproc/multiproc.html)很有用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-29T02:22:35.930

也许这是处理您所要求的错误的方法，但也许可以完全采用不同的策略。如果您正在寻找一个非常快速的内存分配器，也许您应该问为什么您需要花费所有时间分配内存，而您也许可以摆脱变量的堆栈分配。堆栈分配虽然更烦人，但正确完成可以为您节省很多互斥争用的方式，以及避免代码中出现奇怪的内存损坏问题。此外，您可能会有更少的碎片，这可能会有所帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T02:26:24.830

我们在几年前我工作的一个项目中使用了hoard。它似乎工作得很好。我对其他分配器没有经验。尝试不同的并进行负载测试应该很容易，不是吗？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-08-17T17:56:01.667

locklessinc 分配器非常好，如果您有问题，开发人员会及时响应。他写了一篇关于使用的一些优化技巧的文章，读起来很有趣：http: [//locklessinc.com/articles/allocator_tricks/](http://locklessinc.com/articles/allocator_tricks/)。我过去用过它，效果很好。

![在此处输入图像描述](https://i.stack.imgur.com/98wzv.png)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-04-25T01:03:23.843

可能对您的问题的答复较晚，但是

如果你有性能提升，为什么要使用 mallocs？

更好的方法是在初始化时做一个大内存窗口的 malloc，然后想出`light weight Memory manager`一个`lease out the memory chunks at run time`。

如果您的堆扩展，这可以避免任何系统调用的可能性。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-08-17T17:14:12.557

您可以尝试[ltalloc](http://alextretyak.github.io/ltalloc)（具有快速池分配器速度的通用全局内存分配器）。

# c# - .NET：如何在 EventLog 条目中设置用户信息？

> ID：147307
> 
> 赞同：5
> 
> 时间：2008-09-29T02:21:49.117
> 
> 标签：c#, .net, vb.net, event-log

System.Diagnostics.EventLog 类提供了一种与 Windows 事件日志交互的方法。我一直用它来进行简单的日志记录...

```
System.Diagnostics.EventLog.WriteEntry("MyEventSource", "My Special Message") 
```

有没有办法使用 .NET 在生成的事件日志条目中设置用户信息？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T20:53:30.907

坚强...

我寻找一种使用 .NET 方法填充用户字段的方法。不幸的是，没有，您必须导入普通的旧 Win32 API [ReportEvent 函数]( http://msdn.microsoft.com/en-us/library/aa363679(VS.85).aspx [)](http://msdn.microsoft.com/en-us/library/aa363679(VS.85).aspx))`DLLImportAttribute`

[正如Platform Invoke Data Types](http://msdn.microsoft.com/en-us/library/ac7ay120.aspx)所说，您还必须使用正确的类型重新声明函数

所以

```
BOOL ReportEvent(
__in  HANDLE hEventLog,
__in  WORD wType,
__in  WORD wCategory,
__in  DWORD dwEventID,
__in  PSID lpUserSid,
__in  WORD wNumStrings,
__in  DWORD dwDataSize,
__in  LPCTSTR *lpStrings,
__in  LPVOID lpRawData
); 
```

变成

```
[DllImport("Advapi32.dll", EntryPoint="ReportEventW",  SetLastError=true,
CharSet=CharSet.Unicode)]
bool WriteEvent(
  IntPtr hEventLog, //Where to find it ?
  ushort  wType,
  ushort  wCategory,
  ulong dwEventID,
  IntPtr lpUserSid, // We'll leave this struct alone, so just feed it a pointer
  ushort wNumStrings,
  ushort dwDataSize,
  string[] lpStrings,
  IntPtr lpRawData
); 
```

您还想查看 [OpenEventLog]( [http://msdn.microsoft.com/en-us/library/aa363672(VS.85).aspx)](http://msdn.microsoft.com/en-us/library/aa363672(VS.85).aspx))和 [ConvertStringSidToSid]( [http://msdn.microsoft.com/ en-us/library/aa376402(VS.85).aspx)](http://msdn.microsoft.com/en-us/library/aa376402(VS.85).aspx))

哦，你现在正在编写非托管代码......注意内存泄漏。祝你好运：p

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T02:26:45.500

您需要自己将其添加到事件消息中。

使用 System.Security.Principal 命名空间来获取记录事件的线程的当前标识。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T02:36:00.737

通常，执行调用 EventLog.WriteEntry 方法的代码的用户将是该条目的事件日志中显示的用户。

您可以尝试通过创建自己的 Principal 和 Identity 并将其与当前线程关联来模拟另一个用户，但是不建议这样做，因为它可能会引入安全问题并且肯定会使您的应用程序复杂化。

# mysql - MySQL行格式：固定和动态之间的区别？

> ID：147315
> 
> 赞同：49
> 
> 时间：2008-09-29T02:25:28.107
> 
> 标签：mysql, table-structure

MySQL 将表的行格式指定为固定的或动态的，具体取决于列数据类型。如果表具有可变长度列数据类型，例如 TEXT 或 VARCHAR，则行格式是动态的；否则，它是固定的。

我的问题是，这两种行格式有什么区别？一个比另一个更有效吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-29T02:37:48.187

差异只对 MyISAM 很重要，其他存储引擎并不关心差异。 **编辑：**许多用户评论说 InnoDB 确实关心：[链接 1 由 steampowered](https://dev.mysql.com/doc/refman/5.7/en/innodb-row-format.html)，[链接 2 由 Kaan](http://www.mysqlperformanceblog.com/2010/02/09/blob-storage-in-innodb/)。

使用具有固定宽度行的 MyISAM，有几个优点：

1.  无行碎片：可以使用可变宽度的行将单行拆分为数据文件中的多个部分。这会增加磁盘寻道并减慢操作。可以使用 OPTIMIZE TABLE 对其进行碎片整理，但这并不总是可行的。

2.  数据文件指针大小：在MyISAM中，有一个数据文件指针的概念，在需要引用数据文件时使用。例如，当索引引用行实际存在的位置时，它会在索引中使用。对于固定宽度大小，此指针基于文件中的行偏移量（即，行是 1、2、3，而不管它们的大小）。对于可变宽度，指针基于字节偏移量（即行可能是 1、57、163）。结果是，对于大型表，指针需要更大，这可能会给表增加更多开销。

3.  在损坏的情况下更容易修复。由于每一行的大小相同，如果您的 MyISAM 表损坏，修复起来会容易得多，因此您只会丢失实际损坏的数据。对于可变宽度，理论上可变宽度指针可能会被弄乱，这可能导致以糟糕的方式存储数据。

现在固定宽度的主要缺点是它浪费更多的空间。例如，您需要使用 CHAR 字段而不是 VARCHAR 字段，因此最终会占用额外的空间。

通常，您在格式上没有太多选择，因为它是基于模式的。但是，如果您只有几个 varchar 或单个 blob/文本来尝试对此进行优化，这可能是值得的。例如，考虑将唯一的 varchar 转换为 char，或将 blob 拆分到它自己的表中。

您可以在以下位置阅读更多相关信息：

[http://dev.mysql.com/doc/refman/5.0/en/static-format.html](http://dev.mysql.com/doc/refman/5.0/en/static-format.html)

[http://dev.mysql.com/doc/refman/5.0/en/dynamic-format.html](http://dev.mysql.com/doc/refman/5.0/en/dynamic-format.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-29T02:32:48.713

更新记录时会出现一个关键区别。如果行格式是固定的，则记录的长度没有变化。相反，如果行格式是动态的并且新数据导致记录长度增加，则使用链接指向“溢出”数据（即，它被称为溢出指针）。

这会使表格碎片化，通常会减慢速度。有一个碎片整理命令（OPTIMIZE TABLE），这在一定程度上缓解了这个问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-14T19:56:25.057

MySQL 文档中的这个页面似乎与这里的最佳答案相矛盾，因为 DYNAMIC 行格式对于 InnoDB 表也意味着一些东西：

[https://dev.mysql.com/doc/refman/5.7/en/innodb-row-format.html](https://dev.mysql.com/doc/refman/5.7/en/innodb-row-format.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-29T02:30:46.147

固定意味着每一行的大小完全相同。这意味着如果需要加载数据页上的第 3 行，它将正好为 PageHeader+2*RowSize，从而节省一些访问时间。

为了找到动态记录的开头，必须查阅记录偏移列表，这涉及到额外的间接。

简而言之，是的，动态行的性能会受到轻微影响。不，它不是一个很大的。如果您认为这将是一个问题，请对其进行测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T02:33:10.507

固定应该比动态更快，更安全，缺点是具有固定的字符长度。您可以在此处找到此信息：http: [//dev.mysql.com/doc/refman/5.0/en/static-format.html](http://dev.mysql.com/doc/refman/5.0/en/static-format.html)

# c++ - CScrollView 和窗口大小

> ID：147323
> 
> 赞同：0
> 
> 时间：2008-09-29T02:29:14.543
> 
> 标签：c++, winapi, mfc

（MFC 问题）在 CScrollView 中确定当前显示的客户区的最佳方法是什么？我只需要可见部分的大小，因此 GetClientRect() 在这里不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T15:58:14.113

您确实需要使用 GetClientRect()，但我认为您问错了问题。在滚动视图中并不是有一个非常大的客户端窗口可以物理滚动。相反，当您滚动时，会调整 DC 的 viewporttext 和映射模式，这会使您的视图看起来比实际更大。所以，如果你想从当前视口的右下角的左上角画一条线，你确实需要GetViewPortOrg()和GetViewportExt()。如果这些返回错误的值，则说明您在使用 CScrollView 时出现了问题。您是否调用了 SetScrollSizes()？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-29T02:41:19.117

在 OnDraw() 函数中，您可以调用 pDC->GetViewportOrg 和 pDC->GetViewportExt。

**编辑**：对不起，我忘记了视口范围只是缩放因子。我同意您在这里真正需要的是客户矩形。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-30T21:14:45.467

是的，你们俩都是对的。GetClientRect 正是我所需要的。我的脑袋放屁了……

# wcf - 在 WCF 中通过 HTTP Post 接受表单字段

> ID：147328
> 
> 赞同：7
> 
> 时间：2008-09-29T02:31:16.427
> 
> 标签：wcf, http-post, webinvoke

我需要接受表单数据到基于 WCF 的服务。这是界面：

```
[OperationContract]
[WebInvoke(UriTemplate = "lead/inff",
    BodyStyle = WebMessageBodyStyle.WrappedRequest)]
int Inff(Stream input); 
```

这是实现（示例 - 没有错误处理和其他保护措施）：

```
public int Inff(Stream input)
{

    StreamReader sr = new StreamReader(input);
    string s = sr.ReadToEnd();
    sr.Dispose();

    NameValueCollection qs = HttpUtility.ParseQueryString(s);
    Debug.WriteLine(qs["field1"]);
    Debug.WriteLine(qs["field2"]);

    return 0;
} 
```

假设 WCF，除了解析传入的流之外，还有更好的方法来实现这一点吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-04T14:15:54.090

我记得在 DevLink 上和你谈过这个。

由于您必须支持表单字段，因此获取这些字段的机制（您当前正在做的事情）不会改变。

可能有帮助的东西，特别是如果您想为不需要表单字段的新应用程序重用您的服务是创建一个通道来解构您的流并将其重新打包为 XML/JSON/SOAP/Whatever 并拥有您的表单客户端通过它与服务进行通信，而不使用表单的客户端可以使用另一个通道堆栈。只是一个想法...

希望有帮助。如果您需要有关频道的帮助，请随时告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-03T16:10:44.077

您可以使用 jquery 序列化表单字段并将其打包为 wcf 服务的 json 请求。

# c++ - Visual Studio 6 提示和技巧

> ID：147339
> 
> 赞同：12
> 
> 时间：2008-09-29T02:39:30.913
> 
> 标签：c++, visual-studio, vb6, ide

我们中的一些人总是不得不使用 Microsoft 的 Visual Studio 6.0 IDE 来支持“遗留”代码，尽管意见会有所不同，但与 Visual Studio 系列 IDE 的后期版本相比，这些 IDE 通常被认为对用户不太友好。

所以我想听听一些你最好的隐藏/记录不充分的 IDE 功能（可能适用于 C++ 或 VB）。请按照惯例，每篇文章一个功能。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-08T21:19:26.760

上次我不得不使用 VB6 时，我很生气，因为**我的鼠标上的滚轮（**实际上可以与 Windows 中的所有其他程序一起使用）不起作用。这与 VB6 的时代以及微软多年来如何改变滚轮功能有关。

[这个人写了一个程序来让它工作。](http://www.joebott.com/vb6scrollwheel.htm)

（看起来微软[也修复了](http://support.microsoft.com/kb/837910)这些年）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-29T03:33:59.300

对于 VB6，[MZ-Tools](http://www.mztools.com/v3/mztools3.aspx)是一个很棒的免费插件。我最喜欢的功能是它的查找功能以及通过单击按钮查找给定例程的所有调用者的能力。它还有其他一些功能，我发现其中一些功能有时很有帮助。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T03:17:32.857

### VB6 中的自定义代码模板

我不知道这是否真的是一个“隐藏”功能，但我一直认为这是一个很好的节省时间的方法。

您可以为类、模块、表单等创建自己的自定义模板，并使它们在 IDE 中可用。例如，我通常喜欢`Collection`在我的 VB6 代码中使用强类型类。所以我可能想要一个`FooCollection`包含`Foo`对象而不是别的东西，而不是一个普通的 old `Collection`。我不想`Collection`每次需要新的 strong-typed 时都重新实现接口`Collection`，所以我创建了一个包含所有样板`Collection`代码的新类模板。现在，每当我向我的项目添加一个新的类模块时，我的自定义`TypedCollection`模板都可以作为一个选项使用。然后我只是重命名新添加的类`FooCollection`并将所有出现的“As Object”替换为“As Foo”（其中 Foo 是我想要存储在集合中的对象类型），我就完成了。

与我的自定义类模板示例保持一致，您可以这样做：

1.  打开IDE并开始一个新项目（我通常只做标准EXE，因为你在这里选择什么并不重要）。
2.  向项目中添加一个新类。这将成为您的模板。
3.  编写您的模板类。基本上只需编写您希望能够在其他项目中重用的任何样板代码。这是直接的 VB 代码，没什么特别的。
4.  完成后将文件保存在您的`C:\Program Files\Microsoft Visual Studio\VB6\Template\Classes`文件夹中（注意：其他子文件夹，例如`Forms`等用于其他类型的模板）。.cls 文件的名称减去扩展名将出现在 IDE 中，因此为了便于阅读，我通常在文件名中包含空格。
5.  下次打开 IDE 并单击`Project->Add Class Module`时，您的模板类将出现在可用类模板列表中。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-08T21:10:57.807

您可以编辑该文件`C:\Program Files\Microsoft Visual Studio\Common\MSDev98\Bin\AUTOEXP.DAT`以添加规则，以便在“调试观察”窗口中显示自定义类的有意义的值。

我的意思是这个。我们有一个这样定义的日期结构：

```
typedef struct tagMHDATE
   {
   short int  nDay;      // Day of the Month  1..31
   short int  nMonth;    // Month of the Year 1..12
   short int  nYear;     // Year
   } MHDATE, FAR *LPMHDATE; 
```

如果我有这个代码：

```
MHDATE today;
GetDate(&today); 
```

...然后`today`进入监视窗口，我会看到如下内容：

```
today    {...} 
```

现在去把它添加到 AUTOEXP.DAT 的末尾（它只是一个文本文件）

```
tagMHDATE=date=<nMonth>/<nDay>/<nYear> 
```

...现在我在 Watch 窗口中看到了这个：

```
today    {date=10/8/2008} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-29T02:41:30.253

我将启动一个 VS C++ 功能，它为我节省了大量时间：在调试器的监视窗口中将“，su”（不带引号）附加到 unicode 字符串使您能够查看字符串的值（而不是该字符串的内存地址）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-29T03:30:32.227

VB6 中的**Erl**函数。如果您在 VB6 代码中放置行号，则可以在错误处理程序中通过函数**Erl**的返回值访问发生错误的行号。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-08T21:01:19.777

[这里](http://www.highprogrammer.com/alan/windev/visualstudio.html)有很多提示和技巧。我最喜欢的是放置`@err,hr` 在 Watch 窗口中以获取错误消息。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-29T03:30:53.910

对于 VC6，获取Whole Tomato的[Visual Assist X](http://www.wholetomato.com/purchase/default.asp)副本。它包含一个智能（且可用）的 Intellisense 替代品、更丰富的代码着色、一些重构支持以及更多功能。绝对值得投资。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-15T21:50:12.440

将用于启动 VB6 的快捷方式上的“开始于”属性更改为源代码目录的根目录。每次从 IDE 中打开项目时，这将节省许多浪费的鼠标点击。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-01T02:27:14.047

CodeShine：VB6 代码重构插件（免费）。包括提取方法、引入解释变量、提取函数、引入解释变量、重命名等重构

[http://www.wsdesigns.com/CodeShine/default.htm](http://www.wsdesigns.com/CodeShine/default.htm)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-08T20:50:30.237

快速宏一直是我个人的最爱。本身并不是真正的隐藏功能，但非常有用，并且 VC6 是最后一个版本，它们足够快，可以使用（在 MS 重写宏引擎以使用 .NET 之前）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-29T02:50:47.703

Shift-Alt-Enter 增加编辑器窗口的大小

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-23T11:24:06.083

不是真正的 VB6 IDE 功能，但如果您必须用大量数据填充未绑定的列表视图，那么在填充过程中使其不可见会加快 10 倍的速度。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-08T21:11:42.500

我对“如果你对别人的问题的[答案](https://stackoverflow.com/questions/154661/pre-setting-locations-for-looking-for-source-files-in-visual-c-60#173240)[不满意，你应该自己开始吗？”这个问题的回答](https://stackoverflow.com/questions/184930/if-you-are-not-satisfied-with-answers-on-someone-elses-question-should-you-star) 展示了如何使用所有源路径预先填充 VC++。它对我们这些从命令行构建但使用 msdev 进行调试的人很有用。

# c - 将 Win16 C 代码转换为 Win32

> ID：147351
> 
> 赞同：16
> 
> 时间：2008-09-29T02:48:47.630
> 
> 标签：c, windows, winapi, 16-bit

一般来说，将16位Windows程序转换为Win32需要做什么？我敢肯定，我不是唯一一个继承代码库并惊讶地发现潜伏在角落里的 16 位代码的人。

有问题的代码是C。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-29T04:44:24.577

1.  `wParam`和的含义`lParam`在很多地方都发生了变化。我**强烈**建议您保持偏执，并尽可能多地使用[消息破解](http://support.microsoft.com/kb/83456)程序。它们将为您省去无穷无尽的头痛。如果我只能给你一条建议，那就是它。
2.  只要您使用消息破解程序，也请启用`STRICT`. 它将帮助您`int`在应该使用的地方捕获 Win16 代码库`HWND`，`HANDLE`或其他东西。转换这些将极大地帮助此列表中的#9。
3.  `hPrevInstance`没用。确保它没有被使用。
4.  确保您使用的是 Unicode 友好的调用。这并不意味着您需要将所有内容都转换为`TCHAR`s，而是意味着您最好将`OpenFile`,`_lopen`和`_lcreat`with替换为`CreateFile`, 以命名显而易见的
5.  `LibMain`现在是`DllMain`，整个库格式和导出约定都不同了
6.  Win16 没有 VMM。 `GlobalAlloc`, `LocalAlloc`, `GlobalFree`, 和`LocalFree`应该替换为更现代的等价物。`LocalLock`完成后，清理给`LocalUnlock`和朋友的电话；他们现在没用了。并不是说我可以想象您的应用程序会这样做，但请确保您`WM_COMPACTING`在那里时不要依赖。
7.  Win16也没有内存保护。确保您没有使用`SendMessage`或`PostMessage`发送指向进程外窗口的指针。您需要切换到更现代的 IPC 机制，例如管道或内存映射文件。
8.  Win16 也缺乏抢先式多任务处理。如果您想从另一个窗口快速得到答复，打电话`SendMessage`并等待消息被处理是非常酷的。现在这可能是个坏主意。考虑是否`PostMessage`不是更好的选择。
9.  指针和整数大小发生变化。记住要仔细检查您正在读取或写入数据到磁盘的任何位置——尤其是当它们是 Win16 结构时。您需要手动重做它们以处理较短的值。同样，处理这种情况最不痛苦的方法是尽可能使用消息破解程序。否则，您将需要在适用的情况下手动搜索并转换`int`为`DWORD`等等。
10.  最后，当您确定了这一点后，请考虑启用 64 位编译检查。从 16 位升级到 32 位所面临的许多问题与从 32 位升级到 64 位所面临的问题相同，而如今 Visual C++ 实际上非常聪明。您不仅会发现一些挥之不去的问题；您也将为最终的 Win64 迁移做好准备。

* * *

**编辑**：正如@ChrisN 指出的那样，[将 Win16 应用程序移植到 Win32 的官方指南](https://web.archive.org/web/20150702031047/https://msdn.microsoft.com/en-us/library/aa314542(VS.60).aspx)已存档，并且都充实并补充了我的上述观点。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T03:22:34.697

除了让您的构建环境正确之外，您还需要解决以下几个细节：

1.  包含整数的结构将需要从 16 位更改为短或加宽到 32 位。如果您更改结构的大小并将其加载/保存到磁盘，您将需要编写数据文件升级代码。

2.  每个窗口的数据通常使用 GWL_USERDATA 与窗口句柄一起存储。如果您将一些数据扩大到 32 位，您的偏移量将会改变。

3.  POINT & SIZE 结构在 Win32 中是 64 位的。在 Win16 中，它们是 32 位的，可以作为 DWORD 返回（调用者会将返回值拆分为两个 16 位值）。这在 Win32 中不再有效（即 Win32 不返回 64 位结果）并且函数被更改为接受一个指针来存储返回值。您将需要编辑所有这些。GetTextExtent 等 API 会受此影响。同样的问题也适用于某些 Windows 消息。

4.  在 Win32 中不鼓励使用 INI 文件以支持注册表。虽然 INI 文件功能仍然有效，但您需要小心处理 Vista 问题。16 位程序通常将其 INI 文件存储在 Windows 系统目录中。

这只是我能回忆起的几个问题。自从我进行任何 Win32 移植以来已经有十多年了。一旦你进入它，它非常快。当涉及到您将习惯的移植时，每个代码库都会有自己的“感觉”。您甚至可能会在此过程中发现一些错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T19:24:47.020

MSDN 上的文章将[16 位代码移植到 32 位 Windows中有一个权威指南。](https://web.archive.org/web/20150702031047/https://msdn.microsoft.com/en-us/library/aa314542(VS.60).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T02:59:05.250

最初的win32 sdk 有一个工具可以扫描源代码并标记需要更改的行，但我不记得该工具的名称。

当我过去不得不这样做时，我使用了蛮力技术 - 即： 1 - 更新 makefile 或构建环境以使用 32 位编译器和链接器。或者，只需在您的 IDE 中创建一个新项目（我使用 Visual Studio），然后手动添加文件。

2 - 构建

3 - 修复错误

4 - 重复 2&3 直到完成

该过程的痛苦取决于您要迁移的应用程序。我在一小时内转换了 10,000 个线路程序，在不到一周的时间内转换了 75,000 个线路程序。我也有一些我刚刚放弃并从头开始重写（大部分）的小型实用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T03:07:54.667

我同意 Alan 的观点，即反复试验可能是最好的方法。

这里有一些很好的[提示](http://web.mit.edu/dosathena/doc/www/porting-to-NT.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T03:19:16.560

同意编译器可能会捕获大部分错误。此外，如果您使用“近”和“远”指针，您可以删除这些名称——指针只是 Win32 中的指针。

# vb.net - 如何将加密的字符串保存到数据库中？

> ID：147359
> 
> 赞同：5
> 
> 时间：2008-09-29T02:58:43.893
> 
> 标签：vb.net

我在 VB.net "ENCRYPT" 中有这个功能（见下文）

```
Private key() As Byte = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24}
Private iv() As Byte = {65, 110, 68, 26, 69, 178, 200, 219}

Public Function Encrypt(ByVal plainText As String) As Byte()
    ' Declare a UTF8Encoding object so we may use the GetByte 
    ' method to transform the plainText into a Byte array. 
    Dim utf8encoder As UTF8Encoding = New UTF8Encoding()
    Dim inputInBytes() As Byte = utf8encoder.GetBytes(plainText)

    ' Create a new TripleDES service provider 
    Dim tdesProvider As TripleDESCryptoServiceProvider = New TripleDESCryptoServiceProvider()

    ' The ICryptTransform interface uses the TripleDES 
    ' crypt provider along with encryption key and init vector 
    ' information 
    Dim cryptoTransform As ICryptoTransform = tdesProvider.CreateEncryptor(Me.key, Me.iv)

    ' All cryptographic functions need a stream to output the 
    ' encrypted information. Here we declare a memory stream 
    ' for this purpose. 
    Dim encryptedStream As MemoryStream = New MemoryStream()
    Dim cryptStream As CryptoStream = New CryptoStream(encryptedStream, cryptoTransform, CryptoStreamMode.Write)

    ' Write the encrypted information to the stream. Flush the information 
    ' when done to ensure everything is out of the buffer. 
    cryptStream.Write(inputInBytes, 0, inputInBytes.Length)
    cryptStream.FlushFinalBlock()
    encryptedStream.Position = 0

    ' Read the stream back into a Byte array and return it to the calling method. 
    Dim result(encryptedStream.Length - 1) As Byte
    encryptedStream.Read(result, 0, encryptedStream.Length)
    cryptStream.Close()
    Return result
End Function 
```

我想将加密的字符串保存在 SQL 数据库中。我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T04:15:54.537

只需存储在二进制列中。（大部分是凭记忆完成的，欢迎指正！）

```
CREATE TABLE [Test]
(
    [Id] NOT NULL IDENTITY(1,1) PRIMARY KEY,
    [Username] NOT NULL VARCHAR(500),
    [Password] NOT NULL VARBINARY(500)
) 
```

然后插入这样的：

```
Dim conn As SqlConnection

Try
    conn = New SqlConnection("<connectionstring>")
    Dim command As New SqlCommand("INSERT INTO [Test] ([Username], [Password]) VALUES (@Username, @Password)", conn)

    Dim usernameParameter = New SqlParameter("@Username", SqlDbType.VarChar)
    usernameParameter.Value = username
    command.Parameters.Add(usernameParameter)

    Dim passwordParameter = New SqlParameter("@Password", SqlDbType.VarBinary)
    passwordParameter.Value = password
    command.Parameters.Add(passwordParameter)

    command.ExecuteNonQuery()

Finally
    If (Not (conn Is Nothing)) Then
        conn.Close()
    End If
End Try 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T03:05:14.127

将字节数组编码为字符串。0x00 可以是“00”，0xFF 可以是“FF”。或者你可以看看[Base64](http://en.wikipedia.org/wiki/Base64)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T03:06:05.030

加密的字符串应该与任何二进制数据没有什么不同。

如果您知道结果会很小，您可以对其进行 uuencode 编码并将其保存在文本字段中。

# sql-server - 测试存储过程的最佳方法是什么？

> ID：147362
> 
> 赞同：31
> 
> 时间：2008-09-29T02:59:32.877
> 
> 标签：sql-server

像许多要求所有访问都通过存储过程的公司一样，我们似乎有很多业务逻辑被锁定在存储过程中。这些东西很难测试，其中一些已经变得很愚蠢。有没有人有一套最佳实践可以让自信地测试这些东西变得更容易一些？

目前，我们维护着 30 个左右运行的“问题”数据库。这并不总是特别有据可查，而且肯定不是自动化的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-29T03:05:26.360

一位同事对[TSQLUnit 测试框架](https://github.com/aevdokimenko/tsqlunit)发誓。可能值得一看您的需求。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T12:54:01.600

我们有一个非常薄的数据访问层，它基本上将存储过程看起来像 C# 方法。然后，我们的 NUnit 测试套件使用 SetUp/TearDown 创建/回滚事务和调用 DAL 的测试方法。没有什么花哨的，并且被证明比 TSQLUnit 测试套件更容易维护。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T03:06:20.227

不确定这是否是您正在寻找的，但由于您使用的是 SQL Server：我发现 LINQ 是一个很好的工具测试存储过程。您可以将存储过程拖到 DBML 图上，然后将它们作为数据上下文中的方法调用。优于为测试工具设置 ADO 连接等。例如，如果您在 Visual Studio 中设置了一个测试项目，您可以简单地测试您的过程，例如在另一个对象上的方法。如果您存储的过程返回结果集，我认为 LINQ 会将其转换为您应该能够通过 IEnumerable 或 IQueryable 访问的匿名变量（请有人验证这一点）。但是，如果您只返回返回码，这应该是一种快速且相当简单的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T03:31:47.573

我注意到您的帖子被标记为 SqlServer。如果是这种情况，那么您应该查看作为 Visual Studio 一部分的 Team Edition for Database Professionals。这里有一些文章：

*   [我写的关于使用 DBPro 进行 TDDing Stored Procs 的教程](http://weblogs.asp.net/rosherove/archive/2004/10/05/238201.aspx)
*   [一篇](http://blogs.msdn.com/msdnmagazine/archive/2008/03/07/8032278.aspx)更深入的 MSDN 杂志文章
*   [DbFit](http://benilovj.github.com/dbfit/)，一个与 FIT 和 Fitnesse 集成的框架，用于对数据库进行功能测试

最后一个实际上是跨DB平台，而DBPro目前只是SQL Server。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-08T16:25:54.607

我使用的一种方法是编写一个“临时”单元测试来重构特定的存储过程。您从数据库中的一组查询中保存数据，并将它们存储在单元测试可以获取它们的位置。

然后，重构您的 proc 库存。返回的数据应该相同，并且可以自动或手动直接与保存的数据进行比较。

另一种方法是并行运行两个存储过程，并比较结果集。

这对于仅选择存储过程特别有效，但更新、插入和删除更复杂。

我使用这种方法使代码更容易受到单元测试的影响，或者更简单，或者两者兼而有之。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-25T22:16:22.653

试试 TST。您可以从以下网址下载并安装它：[http ://tst.codeplex.com/](http://tst.codeplex.com/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T04:01:23.167

这似乎是一个可怕的政策。也许您可以编写一个执行 SQL 的存储过程并开始转换您的代码以在其中运行。

在任何情况下，我都会通过传统的自动化框架测试调用存储过程。作为应用程序和数据之间的网关，这些应该作为集成测试来处理，而不是纯粹的单元测试。但是，您可以使用基于 xUnit 的单元测试框架来驱动它们。只要您的测试有权对数据库运行 SQL，也许通过我前面提到的方法，您应该能够断言做出了正确的更改。

一个挑战是你表明他们正在变得冗长。我建议将它们分解为子例程并使它们尽可能小。它使测试更容易，也更容易维护。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-08T05:04:02.643

这是我将示例输入方便地保存在 DDL 中的低技术快速方法

```
 USE [SpacelySprockets]

GO

/****** Object:  StoredProcedure [dbo].[uspBrownNoseMrSpacely]    Script Date: 02/03/3000 00:24:41 ******/

SET ANSI_NULLS ON

GO

SET QUOTED_IDENTIFIER ON

GO

--================================

--Stored Procedure DDL:

--================================

--Example Inputs

/*

DECLARE @SuckupPloyId              int

DECLARE @SuckupIdentityRecordId        int 

SET        @SuckupPloyId               = 3

*/

-- =============================================

-- Author:     6eorge Jetson

-- Create date: 01/02/3000

-- Description:    Sucks up to the boss

-- =============================================

CREATE PROCEDURE [dbo].[uspBrownNoseMrSpacely]

    @SuckupPloyId              int

   ,@SuckupIdentityRecordId    int OUTPUT 

AS

BEGIN
    DECLARE @EmployeeId     int
    DECLARE @SuckupPoints   int
    DECLARE @DateTimeStamp  datetime

    SET     @EmployeeId     = dbo.svfGetEmployeeId('6eorge Jetson')
    SET     @SuckupPoints   = dbo.svfGetSuckupPoints(@SuckupPloyId)
    SET     @DateTimeStamp  = getdate()

    --Data state-changing statement in sproc
    INSERT INTO [dbo].[tblSuckupPointsEarned]([EmployeeId], [SuckupPoints], [DateTimeStamp] )
    VALUES (@EmployeeId, @SuckupPoints, @DateTimeStamp)

    SET @SuckupIdentityRecordId = @@Identity
END 
--单元测试证据展示
/*
选择
     @EmployeeId 作为 EmployeeId
    ,@SuckupPoints 作为 SuckupPoints
    ,@DateTimeStamp 作为 DateTimeStamp
*/

--================================================== ===========================
--在为低技术、非状态变化的“类似单元”的测试调用进行编辑之后
--================================================== ===========================

--示例输入
声明 @SuckupPloyId int
声明 @SuckupIdentityRecordId int
设置@SuckupPloyId = 3

/*
-- ===============================================
——作者：6eorge Jetson
-- 创建日期：01/02/3000
-- 描述： 吸老板
-- ===============================================
创建过程 [dbo].[uspBrownNoseMrSpacely]
     @SuckupPloyId 整数
    ,@SuckupIdentityRecordId int 输出
作为
开始
*/
    声明@EmployeeId int
    声明@SuckupPoints int
    声明 @DateTimeStamp 日期时间

    SET @EmployeeId = dbo.svfGetEmployeeId('6eorge Jetson')
    SET @SuckupPoints = dbo.svfGetSuckupPoints(@SuckupPloyId)
    SET @DateTimeStamp = getdate()

    --数据状态改变语句现在注释掉以防止数据状态改变
-- 插入 [dbo].[tblSuckupPointsEarned]([EmployeeId], [SuckupPoints], [DateTimeStamp] )
-- 值（@EmployeeId、@SuckupPoints、@DateTimeStamp）

    SET @SuckupIdentityRecordId = @@Identity

--END --还需要注释掉sproc "END"

--单元测试证据展示
选择
     @EmployeeId 作为 EmployeeId
    ,@SuckupPoints 作为 SuckupPoints
    ,@DateTimeStamp 作为 DateTimeStamp

```

它对 udfs 效果更好，因为无需担心状态变化。显然，我不建议用这个来代替测试框架，但如果我坚持这个简单的秒成本原则

> 断言我的可管理大小的 sproc 至少通过了一个简单的“单元测试”

在执行 CREATE PROCEDURE 之前，我发现我犯的错误更少（可能是由于纪律而不是测试本身）。

# asp.net - 在 ASP.NET 中汇总一个 GridView

> ID：147364
> 
> 赞同：2
> 
> 时间：2008-09-29T03:01:48.753
> 
> 标签：asp.net, javascript, ajax, gridview

在我的一个 ASP.NET Web 应用程序中，我使用[BulkEditGridView](http://blogs.msdn.com/mattdotson/articles/490868.aspx)（允许同时编辑所有行的 GridView）来实现订单。在我的网格中，我有一列计算每个项目的总数（成本 x 数量）和页面底部的总计字段。但是，目前，这些字段仅在每次回发时刷新。我需要动态更新这些字段，以便当用户更改数量时，总计和总计更新以反映新值。我曾尝试使用 AJAX 解决方案来完成此操作，但异步回发会干扰页面上的焦点。我想存在一个纯粹的客户端解决方案，我希望社区中的某个人可以分享。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T10:37:56.130

如果您的计算可以在 JavaScript 中重现，最简单的方法是使用 jQuery 来获取所有项目，如下所示：

```
$("#myGridView input[type='text']").each(function(){
  this.change(function(){
    updateTotal(this.value);
  });
}); 
```

或者，如果您的计算过于复杂而无法在 JavaScript 中完成（或者时间限制阻止了它），那么对 Web 服务的 AJAX 调用是最好的方法。假设我们的网络服务是这样的：

```
[WebMethod, ScriptMethod]
public int UpdateTotal(int currTotal, int changedValue){
  // do stuff, then return
} 
```

您需要一些 JavaScript 来调用 Web 服务，您可以使用 jQuery 或 MS AJAX 来实现。我将展示两者的组合，只是为了好玩：

```
$("#myGridView input[type='text']").each(function(){
  this.change(function(){
    Sys.Net.WebServiceProxy.invoke(
      "/Helpers.asmx",
      "UpdateTotal",
      false,
      { currTotal: $get('totalField').innerHTML, changedValue: this.value },
      showNewTotal
    );
  });
});

function showNewTotal(res){
  $get('totalField').innerHTML = res;
} 
```

查看此链接以获取有关 Sys.Net.WebServiceProxy.invoke 方法的完整信息：[http ://www.asp.net/AJAX/Documentation/Live/ClientReference/Sys.Net/WebServiceProxyClass/WebServiceProxyInvokeMethod.aspx](http://www.asp.net/AJAX/Documentation/Live/ClientReference/Sys.Net/WebServiceProxyClass/WebServiceProxyInvokeMethod.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T05:21:41.243

一种解决方案是在您的 RowDataBound 方法中构建一些 javascript，以便在文本框更改时不断更新这些总数。

因此，在 RowDataBound 期间，开始在内存中构建一个 javascript 字符串，它将添加您需要添加的文本框。RowDataBound 的优点是您可以通过调用 TextBox.ClientId 来获取这些文本框的客户端 ID。将此 javascript 添加到页面，然后还将 onkeyup 事件添加到调用此脚本所需的每个文本框。

类似于（这是来自gridview的行绑定事件）

```
private string _jscript;
protected void gridview_RowDataBound(object sender, GridViewRowEventArgs e)
{
   if (e.Row.RowType == DataControlRowType.DataRow)
   {
      //Get your textbox
      Textbox tb = e.Row.FindControl("tbAddUp");
      //Add the event that you're going to call to this textbox's attributes
      tb.Attributes.Add("onkeyup", "MyAddUpJavaScriptMethod();");
      //Build the javascript for the MyAddUpJavaScriptMethod
      jscript += "document.getElementById('" + tb.ClientId + '").value + ";
   }
} 
```

然后，一旦您构建了整个脚本，请使用您的 Page.ClientScript 类向您的页面添加一个方法，该方法将由您的 onkeyup 在您的文本框“MyAddUpJavaScriptMethod”中调用

希望这有意义并有所帮助

# c++ - 这个 C++ 函数如何使用 memoization？

> ID：147372
> 
> 赞同：4
> 
> 时间：2008-09-29T03:07:26.433
> 
> 标签：c++, dynamic-programming, memoization

```
#include <vector>
std::vector<long int> as;

long int a(size_t n){
  if(n==1) return 1;
  if(n==2) return -2;
  if(as.size()<n+1)
    as.resize(n+1);
  if(as[n]<=0)
  {
    as[n]=-4*a(n-1)-4*a(n-2);
  }
  return mod(as[n], 65535);
} 
```

上面的代码示例使用 memoization 根据一些输入计算递归公式`n`。我知道这使用了记忆化，因为我编写了一个使用相同公式的纯递归函数，但是对于更大的`n`. 我以前从未使用过向量，但我做了一些研究，我理解了它们的概念。我知道记忆应该存储每个计算的值，这样它就可以简单地检索已经计算过的值，而不是再次执行相同的计算。

我的问题是：这个记忆如何，它是如何工作的？我似乎无法在代码中看到它检查 n 的值是否已经存在。另外，我不明白`if(as[n]<=0)`. 这个公式可以产生正值和负值，所以我不确定这个检查在寻找什么。

* * *

谢谢，我想我已经接近理解它是如何工作的了，它实际上比我想象的要简单一些。

我不认为序列中的值永远是 0，所以这应该对我有用，因为我认为 n 必须从 1 开始。

但是，如果零在我的序列中是一个可行的数字，那么我可以解决它的另一种方法是什么？例如，如果五个永远不会出现怎么办？我只需要用五个填充我的向量吗？

编辑：哇，我在检查代码和输入这个代码时收到了很多其他的回复。谢谢大家的帮助，我想我现在明白了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T03:08:31.017

`if (as[n] <= 0)`是支票。如果像你说的那样有效值可能是负数，那么你需要一个不同的哨兵来检查。有效值可以为零吗？如果没有，那么只需进行测试`if (as[n] == 0)`。这使您的代码更容易编写，因为默认情况下`int`s 的向量用零填充。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T03:36:01.403

代码似乎错误地检查了 is (as[n] <= 0)，并重新计算了函数的负值（看起来大约是每隔一个值）。这使得工作与 n 线性缩放，而不是递归解决方案的 2^n，因此它运行得更快。

不过，更好的检查是测试 if (as[n] == 0)，它在我的系统上运行速度似乎快了 3 倍。即使函数可以返回 0，0 值也只是意味着计算需要稍长的时间（尽管如果 0 是一个频繁的返回值，您可能需要考虑一个单独的向量来标记该值是否已被计算，而不是使用单个向量来存储函数的值以及是否已计算）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T03:30:23.507

如果公式可以同时产生正值和负值，则此函数存在严重错误。检查*应该*`if(as[n]<=0)`是检查它是否已经缓存了这个计算值。但是如果公式可以是负数，这个函数会重新计算这个缓存值很多......

 *它真正想要的是 a `vector<pair<bool, unsigned> >`，其中 bool 表示该值是否已计算。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T03:38:18.433

所发布的代码仅记忆大约 40% 的时间（恰好在记忆值为正时）。正如 Chris Jester-Young 指出的那样，正确的实现将改为检查`if(as[n]==0)`. 或者，可以将记忆代码本身更改为读取`as[n]=mod(-4*a(n-1)-4*a(n-2),65535);`

（`==0`当记忆值为 0 时，即使检查也会花费精力。幸运的是，在你的情况下，这永远不会发生！）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T04:20:16.897

这段代码有一个错误。当 as[n] <= 0 时，它将继续重新计算 as[n] 的值。它会记住结果为正的 a 的值。它比没有记忆的代码工作得快得多，因为 as[] 有足够的正值，因此递归很快终止。您可以通过使用大于 65535 的值作为哨兵来改善这一点。当向量扩展时，向量的新值被初始化为零。

# sql-server - 数据库再次受到源代码控制！

> ID：147376
> 
> 赞同：3
> 
> 时间：2008-09-29T03:09:40.263
> 
> 标签：sql-server, version-control, testing

我们使用 MS SQL Server 和 C#。我们的数据库处于源头控制之下，我将告诉您我们实施的一些细节。我们实施了两个操作：

1.  将数据库导出为纯文本文件。数据库模式文件：tables.sql relationship.sql views.sql ... 和表内容文件：Data/table1.txt Data/table2.txt ... 使用源代码控制日志很容易查看数据库更改，因为所有这些文件都有纯文本格式。实施基于命名空间 Microsoft.SqlServer.Management.Smo 中的类。

2.  从此纯文本文件导入数据库。实现很简单——只需从 *.sql 文件执行 sql 语句，然后执行一堆插入。

所以我们有两个 bat 文件：create-test-databse.bat 和 export-test-database.bat。当开发人员需要一个新的测试数据库时，他只需执行 bat 文件并等待一分钟。每个需要数据库的功能测试都会创建一个新的数据库，使用它，然后终止它。但我应该说它不是很快的操作。:(

那么您使用什么工具将您的数据库置于源代码控制之下？我的意思是，例如，您如何实现“创建测试数据库”和“导出测试数据库”操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T03:27:24.217

我想你在这里问两个问题。首先是如何使您的数据库处于源代码控制之下。您的解决方案很有趣，我还使用了 Visual Studio Team Edition for Database Professionals（这是我写的关于使用它[的存储过程的 TDD 的教程）](http://www.cornetdesign.com/2007/07/test-driving-stored-procedures-in-sql.html)

第二个是如何为集成测试设置数据库。设置和拆除整个数据库似乎有点矫枉过正。有几种解决方案。我用过[DBFit](http://benilovj.github.com/dbfit)。Roy Osherove 不久前发布了一个名为[XtUnit](http://weblogs.asp.net/rosherove/archive/2004/10/05/238201.aspx)的工具，我还没有玩过。而且，当然，您始终可以设置测试以在 SetUp 中启动事务，并在拆卸期间进行回滚。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T03:17:45.563

我们使用 Visual Studio for Database Professionals。没有它就不要离开家。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T03:24:40.540

我为 DB Pros 使用 VSTS。您将它指向您的 SQL 服务器，它会分析您的数据库并为您创建单独的文件。您甚至可以让它为您生成测试数据。下一个版本将包括对第三方提供商（想想 Oracle、MySQL、DB2）的支持。

这里真正伟大的功能是验证。我们发现我们数据库的某些部分完全损坏了（它们是退化的，不再被代码使用）。它基本上可以按需部署数据库。

# c++ - 从原生 C++ 重构代码位的选项？

> ID：147378
> 
> 赞同：2
> 
> 时间：2008-09-29T03:11:00.447
> 
> 标签：c++, performance, refactoring, native

因此，在谈论性能时，一个常见的评论是，您使用任何可以最快完成工作的语言编写代码。如果特定领域的性能有问题，则用 C/C++ 重写这些位。

但是，如果您从本机 C++ 应用程序开始呢？如果你想用 Python、Ruby、C# 或其他语言编写简单的部分或重构旧的部分，你有什么选择？请记住，在本地和其他端之间传输数据是必须的。能够简单地调用用“更简单”的语言编写的函数，同时将 C++ 类作为数据传递，这将是很美好的。

我们有一个硬壳 Win32 应用程序，如果我们可以用 C# 或其他东西编写新代码或重构旧代码，它将会受益匪浅。其中很少需要 C++ 的复杂性，处理这些小细节会拖累编程过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T11:10:28.263

正如[Aaron Fischer](https://stackoverflow.com/questions/147378/options-for-refactoring-bits-of-code-away-from-native-c#147446)建议的那样，尝试在打开 /clr 选项的情况下重新编译 C++ 应用程序，然后开始利用 .Net 平台。

如果您已经了解 C# 和 C++，那么 CLI/C++ 很容易上手，它提供了 .Net 世界和原生 C++ 之间的桥梁。

如果您当前的 C++ 代码无法在打开 /clr 的情况下干净地编译，那么我建议尝试将您的应用程序构建为静态库（未启用 /clr），然后让您的 main() 位于 CLI/C++ 项目中调用您的旧版应用程序入口点。这样，您至少可以开始利用 .Net 获得新功能。

有关已“移植”到 .Net CLI/C++ 的“传统”C/C++ 应用程序的示例，请查看[Quake 2](http://www.vertigosoftware.com/Quake2.htm)和[Quake 3: Arena](http://gregs-blog.com/2008/01/22/update-quake-3-arena-net-port-is-done/)的 .Net 端口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T03:23:43.663

如果你想在 C++ 和 Python 之间工作，那么[Boost Python](http://www.boost.org/doc/libs/1_36_0/libs/python/doc/index.html)就是你要找的。您可以为 Cython 手动编写 C Python 绑定，但这在许多方面限制了您编写代码的方式。这是最简单的方法，如[本教程](http://www.boost.org/doc/libs/1_36_0/libs/python/doc/tutorial/doc/html/index.html)的一些片段所示：

一个执行 hello world 的简单函数：

```
char const* greet()
{
   return "hello, world";
} 
```

将其公开给 python 所需的 Boost python 代码：

```
#include <boost/python.hpp>

BOOST_PYTHON_MODULE(hello_ext)
{
    using namespace boost::python;
    def("greet", greet);
} 
```

如何在 python 中使用此代码：

```
>>> import hello_ext
>>> print hello.greet()
hello, world 
```

朝相反的方向前进有点困难，因为 python 不会编译为本机代码。您必须将 python 解释器嵌入到您的 C++ 应用程序中，但执行此操作所需的工作记录[在此处](http://www.boost.org/doc/libs/1_36_0/libs/python/doc/tutorial/doc/html/python/embedding.html)。这是一个调用 python 解释器并提取结果的示例（python 解释器定义了在 C++ 中使用的对象类）：

```
object result = eval("5 ** 2");
int five_squared = extract<int>(result); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T03:24:10.557

嗯，这真的取决于语言。例如，Python 接口最容易使用 Boost Python 完成，许多其他语言将要求您像使用 C 一样使用它们的 C 库并声明您的回调是 extern "C"（不幸的是，您可以' t 通常使用其他语言中的 C++ 类定义）。

但我也想问你打算用它做什么，因为 C++ 是一门复杂的语言，但是一旦你熟悉了它，它就非常强大，并且不会比其他语言更难编码。我能想到的唯一真正好的例外是，如果您打算使用仅以一种语言存在并且没有像样的 C++ 替代品的强大库（图形库可能是最好的例子，因为您必须非常熟悉与他们一起有效地使用它们）。

还值得指出的是，如果您将 C++ 代码与另一种语言接口，您将失去该语言授予的跨平台兼容性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T03:47:59.953

您可以将 c++ 项目中的通用语言运行时支持更改为 /clr。从这一点开始，您可以在您的 c++ 代码中使用任何 .net 功能。这也包括在您的项目中创建 winforms。您还可以添加处理 ui 和其他功能的 ac# 库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T03:31:10.947

在 .NET 世界中，您始终可以选择为 C#/VB.NET 程序集创建 COM/ActiveX 互操作层。

然后，您可以使用 C++ 应用程序中的普通 COM API 创建此 COM 服务器的实例，该实例实际上包装了您的 .NET 程序集。

这样做的好处是简单的参数，如 int、bool、string、float 等都被映射到它们的 COM 等效项。但是据我所知，不可能轻松地传递完整的 .NET 对象（您创建的类的实例）。

另请注意，COM 互操作调用相对较慢。您不应该在紧密循环中不断地从您的 C++ 代码调用 COM 互操作方法。

COM/ActiveX 传统上依赖于 Windows 注册表，这并不理想，因为它是一个很大的依赖项。但是，也可以使用[免注册](http://msdn.microsoft.com/en-us/library/fh1h056h.aspx)COM 互操作来避免这种依赖性。

[本文](http://www.codeproject.com/KB/COM/nettocom.aspx)介绍了为 COM 互操作注册 .NET 程序集所需的步骤。

# c++ - 使用 boost::random 作为 std::random_shuffle 的 RNG

> ID：147391
> 
> 赞同：11
> 
> 时间：2008-09-29T03:24:14.910
> 
> 标签：c++, stl, boost-random

我有一个程序使用来自 boost::random 的 mt19937 随机数生成器。我需要做一个 random_shuffle 并希望为此生成的随机数来自这个共享状态，这样它们就可以确定 mersenne twister 先前生成的数字。

我试过这样的事情：

```
void foo(std::vector<unsigned> &vec, boost::mt19937 &state)
{
    struct bar {
        boost::mt19937 &_state;
        unsigned operator()(unsigned i) {
            boost::uniform_int<> rng(0, i - 1);
            return rng(_state);
        }
        bar(boost::mt19937 &state) : _state(state) {}
    } rand(state);

    std::random_shuffle(vec.begin(), vec.end(), rand);
} 
```

但是我收到一个模板错误，用 rand 调用 random_shuffle。但是，这有效：

```
unsigned bar(unsigned i)
{
    boost::mt19937 no_state;
    boost::uniform_int<> rng(0, i - 1);
    return rng(no_state);
}
void foo(std::vector<unsigned> &vec, boost::mt19937 &state)
{
    std::random_shuffle(vec.begin(), vec.end(), bar);
} 
```

可能是因为它是一个实际的函数调用。但很明显，这并不能保持原始梅森捻线机的状态。是什么赋予了？在没有全局变量的情况下，有什么方法可以做我想做的事情吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-29T03:42:31.137

在评论中，罗伯特古尔德要求为后代提供一个工作版本：

```
#include <algorithm>
#include <functional>
#include <vector>
#include <boost/random.hpp>

struct bar : std::unary_function<unsigned, unsigned> {
    boost::mt19937 &_state;
    unsigned operator()(unsigned i) {
        boost::uniform_int<> rng(0, i - 1);
        return rng(_state);
    }
    bar(boost::mt19937 &state) : _state(state) {}
};

void foo(std::vector<unsigned> &vec, boost::mt19937 &state)
{
    bar rand(state);
    std::random_shuffle(vec.begin(), vec.end(), rand);
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-29T03:29:36.160

在 C++03 中，您不能实例化基于函数局部类型的模板。如果将 rand 类移出函数，它应该可以正常工作（免责声明：未经测试，可能存在其他险恶的错误）。

这个要求在 C++0x 中已经放宽了，但是我不知道这个改变是否已经在 GCC 的 C++0x 模式中实现了，如果发现它出现在任何其他编译器中，我会非常惊讶。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-03-16T19:55:09.380

我在这里使用 tr1 而不是 boost::random ，但应该没什么大不了的。

以下是有点棘手，但它的工作原理。

```
#include <algorithm>
#include <tr1/random>

std::tr1::mt19937 engine;
std::tr1::uniform_int<> unigen;
std::tr1::variate_generator<std::tr1::mt19937, 
                            std::tr1::uniform_int<> >gen(engine, unigen);
std::random_shuffle(vec.begin(), vec.end(), gen); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-02-27T02:25:52.893

我认为值得指出的是，现在这在 C++11 中非常简单，只使用标准库：

```
#include <random>
#include <algorithm>

std::random_device rd;
std::mt19937 randEng(rd());
std::shuffle(vec.begin(), vec.end(), randEng); 
```

# c - 性能挑战：NAL 单元包装

> ID：147408
> 
> 赞同：3
> 
> 时间：2008-09-29T03:30:14.553
> 
> 标签：c, performance, optimization

从我过去看到的情况来看，StackOverflow 似乎喜欢编程挑战，例如[快速 char 到 string 的练习问题](https://stackoverflow.com/questions/69115/char-to-hex-string-exercise)，它得到了几十个响应。这是一个优化挑战：取一个非常简单的函数，看看你是否能想出一个更聪明的方法来做这件事。

我有一个函数，我想进一步优化很长一段时间，但我总是发现我的优化有一些漏洞，导致输出不正确——一些罕见的特殊情况会失败。但是，考虑到功能，我一直认为应该能够做得比这更好。

该函数采用输入数据流（从熵的角度来看，实际上是随机位）并将其包装到 NAL 单元中。这涉及放置转义码：00 00 00、00 00 01、00 00 02 或 00 00 03 的任何字节序列都将替换为 00 00 03 XX，其中 XX 是原始序列的最后一个字节。正如人们可以猜测的那样，考虑到这种序列的可能性，这些仅在每 400 万字节的输入中放置大约 1 个 - 所以这是一个挑战，人们正在**搜索大量数据并且几乎什么都不做，**除了在非常罕见的情况。但是，因为“做某事”涉及*插入字节*，所以事情变得有点棘手。当前未优化的代码如下C：

src 和 dst 是指向字节数组的指针，end 是指向输入数据末尾的指针。

```
int i_count = 0;
while( src < end )
{
    if( i_count == 2 && *src <= 0x03 )
    {
        *dst++ = 0x03;
        i_count = 0;
    }
    if( *src == 0 )
        i_count++;
    else
        i_count = 0;
    *dst++ = *src++;
} 
```

此函数的常见输入大小范围大致在 1000 到 1000000 字节数据之间。

我最初的想法包括一个函数（以某种方式）快速搜索输入以查找需要转义码的情况，以避免在不需要放置转义码的绝大多数输入中出现更复杂的逻辑。

* * *

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T04:21:34.273

嗯……这样的事情怎么样？

```
#define likely(x) __builtin_expect((x),1)
#define unlikely(x) __builtin_expect((x),0)

while( likely(src < end) )
{
    //Copy non-zero run
    int runlen = strlen( src );
    if( unlikely(src+runlen >= end) )
    {
        memcpy( dest, src, end-src );
        dest += end-src;
        src = end;
        break;
    }

    memcpy( dest, src, runlen );
    src += runlen;
    dest += runlen;

    //Deal with 0 byte
    if( unlikely(src[1]==0 && src[2]<=3 && src<=end-3) )
    {
        *dest++ = 0;
        *dest++ = 0;
        *dest++ = 3;
        *dest++ = *src++;
    }
    else
    {
        *dest++ = 0;
        src++;
    }
} 
```

strcpy 和 memcpy 之间有一些重复的工作，但最好摆脱它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T03:35:50.920

将明显的优化应用于您的代码：

```
#define unlikely(x) __builtin_expect((x),0)

while( src < end )
{
    const char s = *src++;
    if( unlikely(i_count==2 && s<=0x03) )
    {
        *dst++ = 0x03;
        i_count = 0;
    }
    if( unlikely(s==0) )
        i_count++;
    else
        i_count = 0;
    *dst++ = s;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T04:07:09.097

Mike F，非常感谢“不太可能”的建议：以下比原来的速度快 10%：

```
#define unlikely(x) __builtin_expect((x),0)
while( src < end )
{
    if( unlikely(i_count == 2) && unlikely(*src <= 0x03) )
    {
        *dst++ = 0x03;
        i_count = 0;
    }
    if( unlikely(*src == 0) )
        i_count++;
    else
        i_count = 0;
    *dst++ = *src++;
} 
```

而且，更好的是，下面的*速度比原来的快 50%（！！！）* 我仍然无法弄清楚为什么循环条件中的可能（）有帮助......一定是 gcc 再次变得奇怪。

```
#define unlikely(x) __builtin_expect((x),0)
#define likely(x) __builtin_expect((x),1)
while( likely(src < end) )
{
    if( unlikely(i_count == 2) && unlikely(*src <= 0x03) )
    {
        *dst++ = 0x03;
        i_count = 0;
    }
    if( unlikely(*src == 0) )
        i_count++;
    else
        i_count = 0;
    *dst++ = *src++;
} 
```

但是，我希望的不仅仅是优化当前的幼稚方法；我怀疑除了单独处理每个字节之外，必须有更好的方法来做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T04:19:15.853

```
while (src < end-2)
{
    if ((src[0] == 0) && (src[1] == 0) && (src[2] <= 3))
    {
        dst[0] = 0;
        dst[1] = 0;
        dst[2] = 3;
        dst[3] = src[2];
        src += 3;
        dst += 4;
    }
    else
        *dst++ = *src++;
}
while (src < end)
    *dst++ = *src++; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T04:34:40.717

我以前的答案的更快版本：

```
while (src < end-2)
{
    if (src[0] == 0)
    {
        if (src[1] == 0)
        {
            if (src[2] <= 3)
            {
                dst[0] = 0;
                dst[1] = 0;
                dst[2] = 3;
                dst[3] = src[2];
                src += 3;
                dst += 4;
            }
            else
            {
                dst[0] = 0;
                dst[1] = 0;
                dst[2] = src[2];
                src += 3;
                dst += 3;
            }
        }
        else
        {
            dst[0] = 0;
            dst[1] = src[1];
            src += 2;
            dst += 2;
        }
    }
    else
        *dst++ = *src++;
}
while (src < end)
    *dst++ = *src++; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T04:55:38.013

像这样的测试**非常**依赖您的编译器和处理器/内存设置。在我的系统上，我改进的版本与 Mike F 的 strlen/memcpy 版本的速度完全相同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-30T00:35:06.153

在我看来，只要您逐字节地复制，您在访问内存时就会遇到字对齐问题，这些都会减慢您的速度。

所以，我建议以下（对于伪代码，我的 C/C++ 基本上被遗忘了）：

*   搜索以找到下一个插入点
    [ [Boyer-Moore](http://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string_search_algorithm)搜索算法是一个不错的选择，因为它是次线性的（不需要检查每个字节）]
*   块复制未更改的块
    [我的理解是 GCC 和其他优秀的 C++ 编译器可以将`memcpy()`调用直接转换为正确的处理器指令，从而提供接近最优的性能]
*   插入修改后的代码
*   重复直到完成

# .net - 将集合项复制到 .NET 中的另一个集合

> ID：147416
> 
> 赞同：16
> 
> 时间：2008-09-29T03:31:49.213
> 
> 标签：.net, vb.net, collections

在 .NET (VB) 中，如何获取一个集合中的所有项目，并将它们添加到第二个集合中（而不会丢失第二个集合中预先存在的项目）？我正在寻找比这更有效的东西：

```
For Each item As Host In hostCollection1
    hostCollection2.Add(item)
Next 
```

我的集合是泛型集合，继承自基类 -- Collection(Of )

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-29T03:41:00.173

您可以使用 AddRange: `hostCollection2.AddRange(hostCollection1)`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T03:33:49.847

我知道您要的是 VB，但在 C# 中，您可以使用集合的构造函数使用任何 IEnumerable 对其进行初始化。例如：

```
List<string> list1 = new List<string>();
list1.Add("Hello");
List<string> list2 = new List<string>(list1); 
```

也许在 VB 中也存在同样的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T03:39:22.907

不要忘记，如果您将 List2 初始化为 List1，您将获得参考而不是副本。除非您进行深度克隆，否则您仍将拥有一组字符串。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T03:43:32.007

我总是使用这个`List<T>.AddRange(otherList<T>)`功能。同样，如果这是一个对象列表，它们将引用相同的东西。

您尚未指定哪种集合，但 CollectionBase 继承的对象中不存在 AddRange

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-24T07:24:03.897

当使用`IList`. 但是`AddRange`方法在`Collection`. 我想过投射`Collection`到`List`，但这是不可能的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T03:37:42.070

VB.Net 确实存在 Ben 的解决方案：

```
Dim collection As IEnumerable(Of T)    
Dim instance As New List(collection) 
```

这是链接的[文档](http://msdn.microsoft.com/en-us/library/fkbw11z0.aspx)。

但是，我会关心的一件事是它是进行浅拷贝还是深拷贝。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T03:46:12.440

除非您希望两个集合都修改同一组对象，否则每个对象都必须复制到堆中。也许您可以描述您的场景如何影响您的性能，我们可以找到一个好的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T03:34:53.823

`Array.Copy`可以解决你的问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T03:35:30.577

List.CopyTo(T[]); 也许？

[http://msdn.microsoft.com/en-us/library/t69dktcd.aspx](http://msdn.microsoft.com/en-us/library/t69dktcd.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-10T22:13:06.547

不确定这个

为什么不这样做

```
 Dim newlines = _singSongs.ToList 
```

.tolist 意味着它创建了一个全新的列表

# java - 在 tomcat webapp 中设置身份验证的最佳方法是什么？

> ID：147420
> 
> 赞同：0
> 
> 时间：2008-09-29T03:34:41.157
> 
> 标签：java, authentication, jsp, tomcat

我有一个自建的 JSP webapp，目前我正在使用管理面板中内置的 tomcats 来管理用户帐户（存储在 tomcats config xml 文件中），但这很有限，因为我无法从网络中创建新帐户-应用程序（例如，我没有注册网站）并且需要手动创建帐户。

在 tomcat 环境中实现帐户最直接的方法是什么？

丹尼斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T04:39:33.700

在 Tomcat 中设置一个[数据库领域](http://tomcat.apache.org/tomcat-5.5-doc/realm-howto.html)，可以是简单的 JDBC 领域，也可以是允许连接池的 DataSource 领域。然后添加用户是一个非常简单的 CRUD Web 应用程序，可能会结合一些确认电子邮件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T06:42:13.013

如果您在 Windows 上（未在问题中指定）并且想要使用 Windows 登录进行身份验证，您可能需要查看[JCIFS](http://jcifs.samba.org/)。JCIFS 允许您在 Java 中获取经过身份验证的 Windows 登录的用户名。它易于安装且相对万无一失。

并非适用于所有情况，但在仅限 Windows 的环境中，它可以让您快速启动并运行。

# python - Difflib.SequenceMatcher isjunk 可选参数查询：如何忽略空格、制表符、空行？

> ID：147437
> 
> 赞同：3
> 
> 时间：2008-09-29T03:41:45.507
> 
> 标签：python, lambda, difflib

我正在尝试使用 Difflib.SequenceMatcher 来计算两个文件之间的相似性。这两个文件几乎相同，除了一个包含一些额外的空格、空行而另一个不包含。我正在尝试使用

```
s=difflib.SequenceMatcher(isjunk,text1,text2)
ratio =s.ratio() 
```

以此目的。

所以，问题是如何为这个 isjunk 方法编写 lambda 表达式，以便 SequenceMatcher 方法将忽略所有空格、空行等。我尝试使用参数 lambda x: x==" "，但结果不是一样棒。对于两个非常相似的文本，该比率非常低。这是非常反直觉的。

出于测试目的，以下是您可以在测试中使用的两个字符串：

> 是什么促使 jwovu 做好你的工作？好的，这是一个试图赢得价值 100 美元的软件开发书籍的条目，尽管我不读
> 
> 编程书籍。为了赢得奖品，你必须写一个条目，以及
> 是什么促使 fggmum 做好你的工作。因此这篇文章。第一个动机
> 
> 钱。我知道，这听起来对许多人来说并不是一个很好的灵感，并且说金钱是激励因素之一可能会让我失去机会。
> 
> 好像金钱是编程世界的禁忌。我知道有些人不能被金钱所激励。另一方面，Mme 生活在一个真实的世界中，
> 
> 有房贷要付，我自己要养活，还要付账单。所以我真的不能把钱排除在我的考虑之外。如果我能得到一大笔钱
> 
> 干得好，那肯定会鼓舞我的士气。我不在乎我是在使用旧工作站，还是被迫与其他人共用房间或隔间
> 
> 人，或者不得不忍受一个烦人的老板，或者其他什么。事实上，在一天结束时我会带着一大笔钱走人本身就足够了
> 
> 让我克服所有的障碍，忍受所有的痛苦和伤害自尊心，忍受慢速的电脑，甚至忍受

这是另一个字符串

> 是什么促使你做好工作？好的，这是一个试图赢得价值 100 美元的软件开发书籍的条目，尽管我不阅读编程书籍。为了赢得奖品，你必须写一个条目并描述是什么促使你做好工作。因此这篇文章。
> 
> 第一个动机，金钱。我知道，这听起来对许多人来说并不是一个很好的灵感，并且说金钱是激励因素之一可能会让我失去机会。好像金钱是编程世界的禁忌。我知道有些人不能被金钱所激励。向他们致敬。另一方面，我生活在一个现实世界中，要支付房屋抵押贷款，要养活自己，要支付账单。所以我真的不能把钱排除在我的考虑之外。
> 
> 如果我能因为做好工作而得到一大笔钱，那肯定会鼓舞我的士气。我不在乎我是在使用旧的工作站，还是被迫与其他人共用房间或隔间，或者不得不忍受烦人的老板，或者其他什么。一天结束时，我会带着一大笔钱走人，这一事实足以让我克服所有的障碍，忍受所有的痛苦和伤害自尊心，容忍一台运行缓慢的电脑，甚至忍受

我运行了上面的命令，并将 isjunk 设置为 lambda x:x==" "，比率只有 0.36。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T07:17:02.400

如果匹配所有空格，则相似性会更好：

```
difflib.SequenceMatcher(lambda x: x in " \t\n", doc1, doc2).ratio() 
```

然而，difflib 对于这样的问题并不理想，因为这是两个几乎相同的文档，但是错别字等会在人类看不到的 difflib 中产生差异。

尝试阅读[tf-idf](http://en.wikipedia.org/wiki/Tf-idf)、[贝叶斯概率](http://en.wikipedia.org/wiki/Bayesian_probability)、[向量空间模型](http://en.wikipedia.org/wiki/Vector_space_model)和[w-shingling](http://en.wikipedia.org/wiki/W-shingling)

我编写了一个[tf-idf 的实现，](http://hg.codeflow.org/tfclassify)将其应用于向量空间并使用点积作为距离度量来对文档进行分类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T06:43:27.987

使用您的示例字符串：

```
>>> s=difflib.SequenceMatcher(lambda x: x == '\n', s1, s2)
>>> s.ratio()
0.94669848846459825 
```

有趣的是，如果 ' ' 也被列为垃圾：

```
>>> s=difflib.SequenceMatcher(lambda x: x in ' \n', s1, s2)
>>> s.ratio()
0.7653142402545744 
```

看起来新行的影响比空格大得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T11:48:48.457

鉴于上述文本，测试确实如建议的那样：

```
difflib.SequenceMatcher(lambda x: x in " \t\n", doc1, doc2).ratio() 
```

但是，为了稍微加快速度，您可以利用 CPython 的[method-wrappers](http://mail.python.org/pipermail/python-list/2005-April/320354.html)：

```
difflib.SequenceMatcher(" \t\n".__contains__, doc1, doc2).ratio() 
```

这避免了许多 python 函数调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T03:47:19.673

我没有使用 Difflib.SequenceMatcher，但是您是否考虑过预处理文件以删除所有空白行和空格（可能通过正则表达式）然后进行比较？

# linux - 将颜色校准数据写入 TIFF 或 PNG 文件

> ID：147449
> 
> 赞同：4
> 
> 时间：2008-09-29T03:51:26.247
> 
> 标签：linux, image, graphics, image-processing, color-management

我的自定义自制摄影处理软件，在 64 位 Linux/GNU 上运行，可以写出 PNG 和 TIFF 文件。这些将被送到高质量的印刷厂制作成精美的艺术品。与室内设计师合作 - 让颜色恰到好处很重要！

印刷店通常不会遇到由商业软件（如 Photoshop）制作的 TIFF 和 PNG。尽管我手头有 TIFF 6.0 规范、PNG 规范和其他信息，但不清楚如何在 linux 上包含颜色校准数据或实现颜色管理系统。我的文件经常因为错误而被拒绝，没有足够的错误报告来进行修复。

对于许多人来说，这一直是一个令人讨厌的问题。甚至我在好莱坞后期制作工作室的联系人也在为这个问题而苦苦挣扎。一个工作室甚至想聘请我来负责他们的色彩校准，以为我是专家 - 但不，我和每个人一样盲目和迷失！

有没有人知道好的代码示例，详细的技术资料，或者有什么其他的启示？或者是时候改用纯苹果了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T18:32:21.933

看看 LittleCMS

[http://www.littlecms.com/](http://www.littlecms.com/)

此页面包含将其应用于 TIFF 的代码

[http://www.littlecms.com/newutils.htm](http://www.littlecms.com/newutils.htm)

您需要了解的基本信息是颜色配置文件数据是您需要存储在文件本身的元数据中的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T19:16:24.183

有一位名叫[Charles Poynton](http://www.poynton.com/)的顾问专门研究这个领域。我在你提到的一个后期制作工作室工作（尽管在伦敦而不是在好莱坞），并且看过他几次关于这个主题的演讲。他的网站包含他提供的大量材料，您可能会在那里找到一些有用的东西。他还有一本名为[Digital Video and HDTV Algorithms and Interfaces](https://rads.stackoverflow.com/amzn/click/com/1558607927)的书，它并不像标题所暗示的那么重！虽然这些资源可能不会直接回答您的问题，但它可能会为其他解决方案提供跳板。

更具体地说，您使用哪些库来编写 png 和 tif 文件 - 您提到它们是自制软件，但它们到底有多定制？在图像处理程序（例如[ImageMagick](http://www.imagemagick.org/script/index.php)或[dcraw](http://www.cybercom.net/~dcoffin/dcraw/)）中对图像进行后处理可能允许您更成功地将此信息注入到标头中。

抱歉，我没有任何具体的答案，但也许可以为您指明正确的方向……

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-08T11:22:12.933

作为 GNU/Linux 用户，您将需要考虑**DispcalGUI** —— [http](http://dispcalgui.hoech.net/) ://dispcalgui.hoech.net/——一个基于 GNOME 的 GUI，它集中了色彩管理、ICC 配置文件管理和（对您的情况至关重要）设备校准。它可以与知名的专业级和中级硬件通信，例如 i1、X-Rite、Spyder 等。

但在你开始之前——你说你正在生成你的文件来规范；您是否使用特定于相关格式的测试套件来验证您的输出？如果没有，这里有三个可以帮助您入门：

1.  `imagetestsuite`支持众所周知的格式：[https ://code.google.com/p/imagetestsuite/w/list?can=1&q=](https://code.google.com/p/imagetestsuite/w/list?can=1&q=)

2.  Luminous* 测试套件是一个 JIRA 插件，如果这是你的事：[https ://marketplace.atlassian.com/plugins/com.luminouslead.plugin.jira.testsuite.LuminousTestSuite](https://marketplace.atlassian.com/plugins/com.luminouslead.plugin.jira.testsuite.LuminousTestSuite)

3.  FLOSS 解码器实现通常有一个您可以使用的，即 OpenJPEG – [https://code.google.com/p/openjpeg/wiki/TestSuiteDocumentation](https://code.google.com/p/openjpeg/wiki/TestSuiteDocumentation)

但即使排除所有这些，您的问题似乎在于**嵌入式 ICC 数据**——这是两个规范合二为一。首先，有宿主图像文件格式，它们都以不同的方式处理嵌入（这意味着嵌入 TIFF 中的 ICC 数据可能看起来与 JPEG 或 WebP 文件完全不同）。其次，有 ICC 规范本身。它记录在此处：[http](http://color.org/v4spec.xalter) : //color.org/v4spec.xalter - 您可能还想查看上述 dispcalGUI 的源代码，其中包括 Python 中非常清晰和可破解的 ICC 配置文件类：[http://sourceforge .net/p/dispcalgui/code/HEAD/tree/trunk/dispcalGUI/ICCProfile.py](http://sourceforge.net/p/dispcalgui/code/HEAD/tree/trunk/dispcalGUI/ICCProfile.py)

*完全披露：[我已经](https://github.com/fhoech/opi.py/commit/cbc1f1cdbbff4727ef0edbc8b2c1c7b8a5644f62)为那个非常 ICC 配置文件类做出了贡献，我刚刚在最后一个链接中链接到该类¶*

这就是基础知识（其中许多您无疑已经涵盖）......除此之外，如果您发布更多关于究竟出了什么问题的信息，我有兴趣查看它。不管怎样，祝你好运。

^(* 注意。本项目与历史悠久的摄影网站“<a href="http://www.luminous-landscape.com/" rel="nofollow">the Luminous Landscape”</sup>无关)

# boundary - 创建多部分表单边界的有效字符是什么？

> ID：147451
> 
> 赞同：14
> 
> 时间：2008-09-29T03:53:13.593
> 
> 标签：boundary, multipartform-data

在 HTML 表单帖子中，创建多部分边界的有效字符是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T04:01:31.560

根据[RFC 2046](https://www.rfc-editor.org/rfc/rfc2046)，第 5.1.1 节：

```
 boundary := 0*69<bchars> bcharsnospace

 bchars := bcharsnospace / " "

 bcharsnospace := DIGIT / ALPHA / "'" / "(" / ")" /
                  "+" / "_" / "," / "-" / "." /
                  "/" / ":" / "=" / "?" 
```

因此，它的长度可以在 1 到 70 个字符之间，由字母数字和您在列表中看到的标点符号组成。除了末尾之外，允许有空格。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T04:03:30.463

边界的内容没有规则，但它不得出现在您的消息的任何部分内容通常是随机生成的数字、字母或两者组合的序列，以保证唯一性并区分任何可能的字典单词。因此，当您开始您的消息时，每个数据类型部分都由“–”分隔，然后是边界序列和内容类型 + 编码。在最后一段“-”之后的边界后跟“-”用于分隔消息的结尾。多部分内容的工作方式是在电子邮件的“Content-type:”标题中指定一个边界。边界用于分隔不同的内容类型，看起来像这样：

```
Content-type: multipart/mixed; boundary="fU3W4Vzr4G3D54f3" 
```

# java - 为什么在 Java 导入语句中使用通配符不好？

> ID：147454
> 
> 赞同：508
> 
> 时间：2008-09-29T03:55:51.417
> 
> 标签：java, import, wildcard

使用像这样的单个语句更方便、更简洁

```
import java.awt.*; 
```

而不是导入一堆单独的类

```
import java.awt.Panel;
import java.awt.Graphics;
import java.awt.Canvas;
... 
```

`import`在语句中使用通配符有什么问题？

* * *

## 回答 #1

> 赞同：639
> 
> 时间：2008-09-29T03:58:50.553

唯一的问题是它使您的本地命名空间变得混乱。例如，假设您正在编写一个 Swing 应用程序，因此需要`java.awt.Event`，并且还与公司的日历系统交互，该系统具有`com.mycompany.calendar.Event`. 如果您使用通配符方法导入两者，则会发生以下三种情况之一：

1.  `java.awt.Event`您在and之间存在彻底的命名冲突`com.mycompany.calendar.Event`，因此您甚至无法编译。
2.  你实际上只导入了一个（你的两个导入中只有一个`.*`），但它是错误的，你很难弄清楚为什么你的代码声称类型是错误的。
3.  当您编译代码时，没有`com.mycompany.calendar.Event`，但是当他们后来添加一个时，您以前有效的代码突然停止编译。

显式列出所有导入的好处是我可以一眼看出您打算使用哪个类，这使得阅读代码变得更加容易。如果你只是做一件快速的一次性事情，没有什么明显的*错误*，但未来的维护者会感谢你的清晰说明。

* * *

## 回答 #2

> 赞同：228
> 
> 时间：2008-09-29T15:45:56.250

**这是对**明星进口的投票。导入语句旨在导入*包*，而不是类。导入整个包要干净得多；此处确定的问题（例如`java.sql.Date`vs `java.util.Date`）可以通过其他方式轻松解决，具体导入并未**真正**解决，当然也不能证明对所有类进行疯狂迂腐的导入。没有什么比打开一个源文件并不得不翻阅 100 个导入语句更令人不安的了。

进行特定的导入会使重构更加困难；如果您删除/重命名一个类，则需要删除其**所有**特定导入。如果将实现切换到同一个包中的不同类，则必须修复导入。虽然这些额外的步骤可以自动化，但它们确实是对生产力的打击，并没有真正的收益。

如果 Eclipse 默认不进行特定的类导入，那么每个人仍然会进行星型导入。很抱歉，但确实没有合理的理由进行特定的进口。

以下是处理类冲突的方法：

```
import java.sql.*;
import java.util.*;
import java.sql.Date; 
```

* * *

## 回答 #3

> 赞同：201
> 
> 时间：2008-09-29T19:42:46.867

请参阅我的文章[按需导入是邪恶的](http://www.javadude.com/posts/20040522-import-on-demand-is-evil/)

简而言之，最大的问题是当将类*添加*到您导入的包中时，您的代码可能会中断。例如：

```
import java.awt.*;
import java.util.*;

// ...

List list; 
```

在 Java 1.1 中，这很好；在 java.awt 中找到 List 并且没有冲突。

现在假设您签入了完美运行的代码，一年后有人将它拿出来进行编辑，并且正在使用 Java 1.2。

Java 1.2 向 java.util 添加了一个名为 List 的接口。繁荣！冲突。完美运行的代码不再有效。

这是*EVIL*语言功能。没有*理由*仅仅因为将类型*添加*到包中而停止编译代码......

此外，读者很难确定您使用的是哪个“Foo”。

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2010-01-02T20:17:19.890

在 Java 导入语句中使用通配符也*不错。*

在[Clean Code](https://rads.stackoverflow.com/amzn/click/com/0132350882)中，Robert C. Martin 实际上建议使用它们来避免长导入列表。

这是建议：

> J1：使用通配符避免长导入列表
> 
> 如果您使用包中的两个或多个类，则使用以下命令导入整个包
> 
> 导入包。*；
> 
> 长长的进口清单令读者望而生畏。我们不想用 80 行导入来弄乱我们模块的顶部。相反，我们希望导入是关于我们与哪些包合作的简明陈述。
> 
> 特定的导入是硬依赖，而通配符导入不是。如果您专门导入一个类，则该类必须存在。但是，如果您使用通配符导入包，则不需要存在特定的类。import 语句只是在搜索名称时将包添加到搜索路径中。因此，此类导入不会创建真正的依赖关系，因此它们有助于减少我们的模块耦合。
> 
> 有时，一长串特定的进口产品可能会很有用。例如，如果您正在处理遗留代码并且想要找出需要为哪些类构建模拟和存根，您可以遍历特定导入列表以找出所有这些类的真正限定名称，然后输入适当的存根到位。但是，这种用于特定进口的用途非常罕见。此外，大多数现代 IDE 将允许您使用单个命令将通配符导入转换为特定导入列表。因此，即使在遗留情况下，最好导入通配符。
> 
> 通配符导入有时会导致名称冲突和歧义。两个具有相同名称但在不同包中的类将需要专门导入，或者在使用时至少需要专门限定。这可能很麻烦，但很少见，使用通配符导入通常仍然比特定导入更好。

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2014-05-06T18:21:25.977

**性能**：对性能没有影响，因为字节码是相同的。虽然它会导致一些编译开销。

**编译**：在我的个人机器上，编译一个空白类而不导入任何东西需要 100 毫秒，但导入 java.* 时相同的类需要 170 毫秒。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2008-09-29T04:05:04.873

它使您的命名空间变得混乱，要求您完全指定任何不明确的类名。最常见的情况是：

```
import java.util.*;
import java.awt.*;

...
List blah; // Ambiguous, needs to be qualified. 
```

它还有助于使您的依赖项具体化，因为您的所有依赖项都列在文件的顶部。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2008-09-29T04:42:24.847

1.  它有助于识别类名冲突：不同包中具有相同名称的两个类。这可以用 * 导入来掩盖。
2.  它使依赖项变得明确，以便以后必须阅读您的代码的任何人都知道您要导入什么以及您不打算导入什么。
3.  它可以使一些编译更快，因为编译器不必搜索整个包来识别依赖关系，尽管这对于现代编译器来说通常不是什么大问题。
4.  现代 IDE 将显式导入的不便之处降至最低。大多数 IDE 允许您折叠导入部分，使其不碍事，在需要时自动填充导入，并自动识别未使用的导入以帮助清理它们。

我工作过的大多数使用大量 Java 的地方都将显式导入作为编码标准的一部分。我有时仍然使用 * 进行快速原型设计，然后在产品化代码时扩展导入列表（某些 IDE 也会为您执行此操作）。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-09-29T03:59:11.813

我更喜欢特定的导入，因为它允许我查看文件中使用的所有外部引用，而无需查看整个文件。（是的，我知道它不一定会显示完全限定的引用。但我尽可能避免使用它们。）

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-10-10T15:57:56.600

在之前的项目中，我发现从 *-imports 更改为特定的导入将编译时间减少了一半（从大约 10 分钟到大约 5 分钟）。*-import 使编译器在列出的每个包中搜索与您使用的类匹配的类。虽然这个时间可能很小，但它对于大型项目来说是加起来的。

*-import 的一个副作用是开发人员会复制和粘贴常见的导入行，而不是考虑他们需要什么。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-06-17T08:54:23.197

在[DDD 书中](https://rads.stackoverflow.com/amzn/click/com/0321125215)

> 在实现将基于的任何开发技术中，寻找最小化重构 MODULES 工作的方法。在 Java 中，无法避免导入单个类，但您至少可以一次导入整个包，这反映了包是高度内聚的单元的意图，同时减少了更改包名称的工作量。

如果它使本地命名空间混乱，这不是你的错 - 归咎于包的大小。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2018-03-18T05:29:51.747

*   没有运行时影响，因为编译器会自动将 * 替换为具体的类名。如果你反编译 .class 文件，你永远不会看到`import ...*`.

*   C#**总是**使用 * （隐式），因为您只能`using`包名称。您根本无法指定类名。Java 引入了 c# 之后的特性。（Java 在许多方面都非常棘手，但它超出了这个主题）。

*   在 Intellij Idea 中，当您“组织导入”时，它会自动将同一包的多个导入替换为 *. 这是一项强制性功能，因为您无法将其关闭（尽管您可以提高阈值）。

*   接受的答复列出的案例无效。没有 * 你仍然有同样的问题。无论您是否使用 *，您都需要在代码中指定 pakcage 名称。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-09-20T17:27:35.887

最重要的一点是，导入`java.awt.*`会使您的程序与未来的 Java 版本不兼容：

假设您有一个名为“ABC”的类，您使用的是 JDK 8，并且您导入了`java.util.*`. 现在，假设 Java 9 出来了，它的包`java.util`中有一个新类，巧合的是，它也被称为“ABC”。您的程序现在无法在 Java 9 上编译，因为编译器不知道名称“ABC”是指您自己的类还是`java.awt`.

`java.awt`当您仅从您实际使用的类中显式导入这些类时，您将不会遇到这个问题。

资源：

[Java 导入](https://coderanch.com/t/488764/java/java/import-java-util-List-faster)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-10-11T09:55:39.030

以下是我发现的关于这个主题的几件事。

*   在编译期间，编译器会尝试从 .* 导入中查找代码中使用的类，并通过从 .* 导入中选择使用的类来生成相应的字节码。所以使用 .* import 或 .class names import 的字节码是相同的，因为相同的字节码，运行时性能也会相同。

*   在每次编译中，编译器必须扫描 .* 包的所有类，以匹配代码中实际使用的类。因此，与使用 .class 名称导入相比，使用 .* 导入的代码在编译过程中需要更多时间。

*   使用 .* import 有助于使代码更简洁

*   当我们使用来自两个不同包的两个同名类时，使用 .* import 会产生歧义。例如，日期在两个包中都可用。

    ```
     import java.util.*;
      import java.sql.*;

      public class DateDemo {
          private Date utilDate;
          private Date sqlDate;
      } 
    ```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-12-21T00:25:52.767

在双方提出的所有有效观点中，我没有找到避免使用通配符的主要原因：我喜欢能够阅读代码并直接知道每个类是什么，或者它的定义是否不在语言中或文件，在哪里可以找到它。如果使用 * 导入了多个包，我必须搜索每个包以找到我不认识的类。可读性是至高无上的，我同意代码不应该*需要*IDE 来阅读它。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-02-07T11:44:39.840

作为记录：当你添加一个导入时，你也表明了你的依赖关系。

您可以快速看到文件的依赖关系（不包括相同命名空间的类）。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-10-03T18:20:50.180

忘掉杂乱的命名空间……想想可怜的灵魂，他们必须在 GitHub、vi、Notepad++ 或其他一些非 IDE 文本编辑器中阅读和理解你的代码。

该人必须煞费苦心地查找来自通配符之一的每个标记与每个通配符范围内的所有类和引用......只是为了弄清楚到底发生了什么。

如果你只为编译器编写代码——而且你知道自己在做什么——我相信通配符没有问题。

但是，如果其他人——包括未来的你——想在一次阅读中快速理解特定的代码文件，那么显式引用会有很大帮助。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2021-12-16T13:44:16.607

使用通配符导入还不错，因为 Oracle 的 Java 教程使用通配符导入。我不认为 Oracle 的 Java 人员会做错事。

请看这里：[https ://docs.oracle.com/javase/tutorial/uiswing/examples/components/CustomComboBoxDemoProject/src/components/CustomComboBoxDemo.java](https://docs.oracle.com/javase/tutorial/uiswing/examples/components/CustomComboBoxDemoProject/src/components/CustomComboBoxDemo.java)

上述程序使用通配符导入：

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.*; 
```

您可以在此处查看更多程序： [https](https://docs.oracle.com/javase/tutorial/uiswing/examples/components/) ://docs.oracle.com/javase/tutorial/uiswing/examples/components/ 。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2020-07-26T01:27:56.460

导入包中的所有类被认为是一种盲目的方法。造成这种情况的一个主要原因是它使类命名空间变得混乱，并可能导致不同包中具有相同名称的类之间发生冲突。

专门填充必要的类可以避免这个问题，并清楚地显示需要哪些版本。这有利于代码的可维护性。

# asp.net - GetCallbackEventReference 不能同步工作

> ID：147458
> 
> 赞同：2
> 
> 时间：2008-09-29T03:58:00.850
> 
> 标签：asp.net, callback, webforms, asp.net-3.5

我有一个利用框架 Page.ClientScript.GetCallbackEventReference() 方法的 ASP.NET 3.5 WebForm，我希望一些调用是同步的。

现在，文档说第五个参数（见下文）控制它。具体来说，当您传递“false”时，它应该是一个非异步调用。但是，无论是真还是假，它仍然异步处理调用。

```
Page.ClientScript.GetCallbackEventReference(this, "arg", "ReceiveServerData", "context",false); 
```

是否有解决方法，或者我做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-05-02T18:27:18.040

**ASPX 页面**

```
<%@ Page Language="VB" AutoEventWireup="false" CodeFile="How-to-use-GetCallbackEventReference.aspx.vb" Inherits="How_to_use_Callback" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>How to use GetCallbackEventReference</title>
        <script type="text/javascript">
            function GetNumber() {
                UseCallback();
            }
            function GetRandomNumberFromServer(txtGetNumber, context) {
                document.forms[0].txtGetNumber.value = txtGetNumber
            }
        </script>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <input id="Button1" type="button" value="Get Random Number" onclick="GetNumber()" /><br /><br />
        <asp:TextBox ID="txtGetNumber" runat="server"></asp:TextBox>&nbsp;</div>
    </form>
</body>
</html> 
```

**代码背后**

```
Partial Class How_to_use_Callback
    Inherits System.Web.UI.Page
    Implements System.Web.UI.ICallbackEventHandler
    Dim CallbackResult As String = Nothing
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Dim cbReference As String = Page.ClientScript.GetCallbackEventReference(Me, "arg", "GetRandomNumberFromServer", "context")
        Dim cbScript As String = "function UseCallback(arg,context)" & "{" & cbReference & " ; " & "}"
        Page.ClientScript.RegisterClientScriptBlock(Me.GetType(), "UseCallback", cbScript, True)
    End Sub

    Public Function GetCallbackResult() As String Implements System.Web.UI.ICallbackEventHandler.GetCallbackResult
        Return CallbackResult
    End Function

    Public Sub RaiseCallbackEvent(ByVal eventArgument As String) Implements System.Web.UI.ICallbackEventHandler.RaiseCallbackEvent
        CallbackResult = Rnd().ToString()
    End Sub
End Class 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-07-05T07:39:48.320

对于仍在使用 MS AJAX 库的任何其他可怜的灵魂，我发现了以下帖子：

[https://social.msdn.microsoft.com/Forums/vstudio/en-US/f4134c2e-ca04-423a-9da3-c613713a7b52/synchronous-callbacks-with-the-net-20-framework?forum=netfxjscript](https://social.msdn.microsoft.com/Forums/vstudio/en-US/f4134c2e-ca04-423a-9da3-c613713a7b52/synchronous-callbacks-with-the-net-20-framework?forum=netfxjscript)

来自 MS 消息来源的最后一条评论说：

> 这实际上是设计使然。为了不阻塞浏览器的 UI，这个参数实际上并没有同步请求，而是确保请求排队并且在任何给定时间只有一个在进行。效果几乎相同，除了最终用户在请求进行时仍然可以使用浏览器 UI，并且如果服务器无法响应或网络连接中断，他不必终止进程。

[MSDN 页面](https://msdn.microsoft.com/en-us/library/ms153103.aspx)证实了这一点：

> 在回调场景中同步发送数据时，同步回调会立即返回，不会阻塞浏览器。浏览器中不能同时执行两个同步回调回调。如果第二个同步回调在当前未决时触发，则第二个同步回调取消第一个，只有第二个回调会返回。

# tfs - 在 TFS 中使用项目下的多个产品正确构建报告

> ID：147459
> 
> 赞同：2
> 
> 时间：2008-09-29T03:58:04.890
> 
> 标签：tfs, tfsbuild

在 TFS 中的一个“项目”下，我们有多个产品。这是因为对我们来说，一个项目就是一个业务单元，他们每个人都可以拥有我们为他们开发的许多应用程序。每个人都有自己的源代码控制文件夹（在 TFS 项目下），每个人都有自己的 TeamBuild 设置。我遇到的问题是，每当构建运行时，为其生成的报告包含与 TFS 项目关联的所有变更集的列表；即使其中许多是针对不同产品的，并且实际上引用的代码并未在该构建期间编译或构建。

有谁知道如何让 TFS 仅在其报告中包含与 TeamBuild 中正在构建的实际 VisualStudio 项目相关联的变更集？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T21:56:48.243

最好的解决方案是修改团队构建定义的工作区映射以包含解决方案根路径而不是团队项目根。

在 TFS2008 中，

*   右键单击团队构建定义并选择“编辑构建定义”
*   选择“工作区”选项卡
*   删除现有映射：$/TeamProjectName
*   将新映射添加到解决方案根目录，例如：$/TeamProject/Main/Solution1/

在 TFS2005 中，

*   开源控制资源管理器
*   浏览到 $/TeamProject/TeamBuildTypes/BuildName/WorkspaceMappings.xml
*   获取最新的文件并检查它以进行编辑
*   删除现有映射：$/TeamProjectName
*   将新映射添加到解决方案根目录，例如：$/TeamProject/Main/Solution1/

此工作区映射定义了要包含在构建中的变更集的范围。

看：

*   [http://blogs.msdn.com/buckh/archive/2007/08/14/tfs-2008-a-basic-guide-to-team-build-2008.aspx](http://blogs.msdn.com/buckh/archive/2007/08/14/tfs-2008-a-basic-guide-to-team-build-2008.aspx)

*   [http://msdn.microsoft.com/en-us/library/ms181718.aspx](http://msdn.microsoft.com/en-us/library/ms181718.aspx)

*   [http://msdn.microsoft.com/en-us/library/ms181286.aspx](http://msdn.microsoft.com/en-us/library/ms181286.aspx)

授予

# c# - 你能为 Visual C#.NET 解决方案推荐一个 .cvsignore 文件吗？

> ID：147460
> 
> 赞同：1
> 
> 时间：2008-09-29T03:58:30.147
> 
> 标签：c#, .net, visual-studio, visual-studio-2008, cvs

我开发了一个包含三个项目的 Visual C#.NET 2008 Express Edition 解决方案。我正在清理它以将其提交到 CVS 存储库中。

有几个在构建过程中创建的文件不需要放在存储库中，因为它们会自动重新生成。

问题：任何人都可以建议将模式列表放入 .cvsignore 文件中，以便忽略这些生成的文件和文件夹吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T04:06:22.530

通常这些是您*必须*提交的唯一事情：

*   .sln 文件
*   .cs 文件
*   .csproj 文件
*   .config 文件
*   您引用的外部 DLL 和相应的 XML/配置文件
*   您的应用程序使用的其他非生成文件

其余的都将被忽略，包括：

*   .suo 文件
*   .csproj.user 文件
*   /bin 文件夹和内容
*   /obj 文件夹和内容
*   几乎所有其他

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-03T12:47:16.930

谢谢！这是我创建的：

```
bin
obj
*.cache
*.suo
*.csproj.user 
```

# .net - 什么时候为程序分配内存？

> ID：147462
> 
> 赞同：1
> 
> 时间：2008-09-29T03:58:53.953
> 
> 标签：.net, asp.net

我需要知道何时为特定程序分配内存。我如何查看分配内存的位置。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T04:21:32.447

您需要更具体地使用操作系统，如果它是解释的或运行时编译的（即 PHP、JAVA、.NET 等），可能还需要更具体的语言。

但是，总的来说：

*   程序加载到内存时分配静态和全局变量。
*   当运行实例化它们的函数或块时，局部变量在堆栈（有时是堆，取决于编译器）上分配。
*   在程序内存中的其他点，在创建对象时分配，并在销毁对象时释放（显式或通过垃圾收集）
*   该程序还可以通过 malloc 或类似的对 OS 的内存分配调用显式分配内存。

应该注意的是，即使内存已经分配给操作系统，它也可能实际上还没有被分配——操作系统会等到内存被使用后才为其获取页面。内存分析器将帮助您了解给定进程在何时何地发生这种情况。

分配内存的位置是一个更大的问题。有几个观点需要考虑：

*   程序的观点（通常是一个平坦的虚拟内存区域，程序可以在其中运行而不会与其他程序发生冲突 - 在 32 位机器上大约 4GB）
*   从操作系统的角度来看，内存页面根据需要换入换出，因此程序可以假装它们有一个很好的、平坦的、未分段的内存区域可以播放
*   内存是连续的CPU的观点
*   内存控制器的观点，它可能有两个 512 记忆棒和一个 1GB 记忆棒，中间有一个空插槽

你对哪个视角感到好奇？您是否正在编写在感兴趣的程序中运行、与其共享内存、在同一操作系统上运行、在同一 CPU 上运行的代码，或者将逻辑分析仪连接到内存总线？

-亚当

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T04:17:26.373

我将在这里尝试并推荐[dotTrace](http://www.jetbrains.com/profiler/)，这是我使用过的最好的分析器。它会告诉你内存使用情况等等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T04:14:33.167

安装[Process Explorer](http://live.sysinternals.com/procexp.exe)，在列表中找到您的应用程序/进程，右键单击，属性，性能选项卡。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T04:23:19.883

就像一个警示故事一样，即使您自己分配的不多，您使用的库也可能会进行大量分配，因此您需要与内核或框架相关的东西。正如 Ben Hoffstein 所说，dotTrace 可能是 .Net 应用程序的一个很好的解决方案（这是我在查看问题标签后才意识到的）

# java - 为什么首选 Java 类的接口？

> ID：147468
> 
> 赞同：80
> 
> 时间：2008-09-29T04:02:55.957
> 
> 标签：java, collections, interface

[PMD](https://pmd.github.io/)将报告以下违规行为：

```
ArrayList<Object> list = new ArrayList<Object>(); 
```

违规行为是“避免使用像 'ArrayList' 这样的实现类型；改用接口”。

以下行将纠正违规行为：

```
List<Object> list = new ArrayList<Object>(); 
```

为什么要使用后者`List`而不是`ArrayList`？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-29T04:20:12.810

在具体类型上使用接口是良好封装和松散耦合代码的关键。

在编写自己的 API 时遵循这种做法甚至是一个好主意。如果这样做，您稍后会发现向代码中添加单元测试（使用 Mocking 技术）以及在将来需要时更改底层实现会更容易。

这是一篇关于这个主题的[好文章](http://www.javaworld.com/javaworld/jw-08-2003/jw-0801-toolbox.html)。

希望能帮助到你！

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-29T04:04:28.277

这是首选，因为您将代码与列表的实现分离。使用该接口，您可以轻松地将实现（在本例中为 ArrayList）更改为另一个列表实现，而无需更改任何其余代码，只要它仅使用 List 中定义的方法即可。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-30T01:06:41.720

总的来说，我同意将接口与实现分离是一件好事，这将使您的代码更易于维护。

但是，您必须考虑一些例外情况。通过接口访问对象会增加一个额外的间接层，这将使您的代码变慢。

出于兴趣，我进行了一个实验，该实验生成了对 100 万长度的 ArrayList 的 100 亿次顺序访问。在我的 2.4Ghz MacBook 上，通过 List 接口访问 ArrayList 平均需要 2.10 秒，而在声明 ArrayList 类型时平均需要 1.67 秒。

如果您正在处理大型列表，深入内部循环或经常调用的函数，那么这是需要考虑的事情。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T04:35:09.373

ArrayList 和 LinkedList 是 List 的两个实现，它是项的有序集合。从逻辑上讲，使用 ArrayList 还是 LinkedList 并不重要，因此您不应该将类型限制为那样。

这与说 Collection 和 List 形成对比，它们是不同的东西（List 意味着排序，Collection 不是）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-12-27T14:35:45.150

> 为什么要使用 List 而不是 ArrayList 的后者？

这是一个很好的做法：*编程接口而不是实现*

通过替换`ArrayList`为`List`，您可以`List`在未来根据您的业务用例更改实现，如下所示。

```
List<Object> list = new  LinkedList<Object>(); 
/* Doubly-linked list implementation of the List and Deque interfaces. 
 Implements all optional list operations, and permits all elements (including null).*/ 
```

或者

```
List<Object> list = new  CopyOnWriteArrayList<Object>(); 
/* A thread-safe variant of ArrayList in which all mutative operations
 (add, set, and so on) are implemented by making a fresh copy of the underlying array.*/ 
```

或者

```
List<Object> list = new  Stack<Object>(); 

/* The Stack class represents a last-in-first-out (LIFO) stack of objects.*/ 
```

或者

其他一些`List`具体的实现。

`List`接口定义了合约，具体的实现`List`可以改变。这样，*接口和实现是松耦合的。*

相关的 SE 问题：

[“编程到接口”是什么意思？](https://stackoverflow.com/questions/383947/what-does-it-mean-to-program-to-an-interface)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T13:48:05.003

一般来说，对于您的代码行，打扰接口是没有意义的。但是，如果我们谈论 API，那是有充分理由的。我有小班

```
class Counter {
    static int sizeOf(List<?> items) {
        return items.size();
    }
} 
```

在这种情况下，需要使用接口。因为我想计算*每个可能*实现的大小，包括我自己的自定义。`class MyList extends AbstractList<String>...`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T00:37:17.003

您的类/接口的属性应该通过接口公开，因为它为您的类提供了使用的行为契约，而不管实现如何。

然而...

在局部变量声明中，这样做没有什么意义：

```
public void someMethod() {
List theList = new ArrayList();
//do stuff with the list
} 
```

如果它是局部变量，只需使用类型。它仍然可以隐式向上转换为其适当的接口，并且您的方法应该希望接受接口类型作为其参数，但是对于局部变量，将实现类型用作容器是完全有意义的，以防万一您确实需要实现-具体功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-03T23:09:01.503

即使对于局部变量，在具体类上使用接口也有帮助。您最终可能会调用接口之外的方法，然后在必要时很难更改 List 的实现。此外，最好在声明中使用最不具体的类或接口。如果元素顺序无关紧要，请使用 Collection 而不是 List。这为您的代码提供了最大的灵活性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-10-15T11:57:52.137

界面向最终用户公开。一个类可以实现多个接口。暴露于特定接口的用户可以访问在该特定接口中定义的某些特定行为。

一个接口也有多个实现。基于场景系统将使用不同的场景（接口的实现）。

如果您需要更多解释，请告诉我。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-10T08:32:52.380

接口在调试器视图中的表示通常比具体类更好。

# xml - XPath 查询搜索具有特定文本的元素

> ID：147486
> 
> 赞同：18
> 
> 时间：2008-09-29T04:14:57.267
> 
> 标签：xml, xpath

给定以下 XML 结构

```
<html>
  <body>
    <div>
      <span>Test: Text2</span>
    </div>
    <div>
      <span>Test: Text3</span>
    </div>
    <div>
      <span>Test: Text5</span>
    </div>
  </body>
</html> 
```

`span`查找任何以 开头的文本的最佳 XPath 查询是什么`Test`？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-29T04:20:38.050

```
//span[starts-with(.,'Test')] 
```

参考：

[http://www.w3.org/TR/xpath/#function-starts-with](http://www.w3.org/TR/xpath/#function-starts-with)

[https://developer.mozilla.org/en-US/docs/Web/XPath/Functions/starts-with](https://developer.mozilla.org/en-US/docs/Web/XPath/Functions/starts-with)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-11-15T11:49:20.593

有效的选项也是：

```
//span[contains(.,'Test')] 
```

# vb.net - 如何在 vb.net 中将字节转换为字符串？

> ID：147491
> 
> 赞同：0
> 
> 时间：2008-09-29T04:18:44.530
> 
> 标签：vb.net, encryption

我有下面的功能 ENCRYPT。

```
Public Function Encrypt(ByVal plainText As String) As Byte()

Dim key() As Byte = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24}
Dim iv() As Byte = {65, 110, 68, 26, 69, 178, 200, 219}

    ' Declare a UTF8Encoding object so we may use the GetByte 
    ' method to transform the plainText into a Byte array. 
    Dim utf8encoder As UTF8Encoding = New UTF8Encoding()
    Dim inputInBytes() As Byte = utf8encoder.GetBytes(plainText)

    ' Create a new TripleDES service provider 
    Dim tdesProvider As TripleDESCryptoServiceProvider = New TripleDESCryptoServiceProvider()

    ' The ICryptTransform interface uses the TripleDES 
    ' crypt provider along with encryption key and init vector 
    ' information 
    Dim cryptoTransform As ICryptoTransform = tdesProvider.CreateEncryptor(Me.key, Me.iv)

    ' All cryptographic functions need a stream to output the 
    ' encrypted information. Here we declare a memory stream 
    ' for this purpose. 
    Dim encryptedStream As MemoryStream = New MemoryStream()
    Dim cryptStream As CryptoStream = New CryptoStream(encryptedStream, cryptoTransform, CryptoStreamMode.Write)

    ' Write the encrypted information to the stream. Flush the information 
    ' when done to ensure everything is out of the buffer. 
    cryptStream.Write(inputInBytes, 0, inputInBytes.Length)
    cryptStream.FlushFinalBlock()
    encryptedStream.Position = 0

    ' Read the stream back into a Byte array and return it to the calling 
    ' method. 
    Dim result(encryptedStream.Length - 1) As Byte
    encryptedStream.Read(result, 0, encryptedStream.Length)
    cryptStream.Close()
    Return result
End Function 
```

我如何查看文本的字节值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T04:24:16.310

您可以使用[编码](http://msdn.microsoft.com/en-us/library/system.text.encoding.aspx)类。

要将字节数组转换为字符串，您可以使用[Encoding.GetString](http://msdn.microsoft.com/en-us/library/system.text.encoding.getstring.aspx)方法

UTF8 有一个特殊的版本：[UTF8Encoding.GetString](http://msdn.microsoft.com/en-us/library/system.text.utf8encoding.getstring.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T04:54:44.800

不是 100% 确定你在问什么，如果你想将加密的字节数组显示为字符串，那么我会说，不要那样做，因为你的字符串不会是“字符串”数据，它将被加密字节并赢得'不可显示（一般）

如果您问我如何将字节值视为字符串...即 129、45、24、67 等（假设 .net 3.5）

```
string.Join(",", byteArray.Select(b => b.ToString()).ToArray()); 
```

如果您询问是否要转换回解密的字节数组，那么您需要使用与创建原始字节数组相同的编码类，在您的情况下为 UTF8 编码类。

# css - 是否可以在另一个中包含一个 CSS 文件？

> ID：147500
> 
> 赞同：836
> 
> 时间：2008-09-29T04:23:10.667
> 
> 标签：css

是否可以在另一个中包含一个 CSS 文件？

* * *

## 回答 #1

> 赞同：1152
> 
> 时间：2008-09-29T04:29:34.580

是的：

```
@import url("base.css"); 
```

笔记：

*   该[`@import`](https://developer.mozilla.org/en-US/docs/Web/CSS/@import)规则[必须先于](https://drafts.csswg.org/css-cascade-3/#at-import)所有其他规则（除了`@charset`）。
*   附加`@import`语句需要附加服务器请求。作为替代方案，将所有 CSS 连接到一个文件中以避免多个 HTTP 请求。例如，将 和 的内容复制`base.css`到`special.css`并`base-special.css`仅引用`base-special.css`。

* * *

## 回答 #2

> 赞同：156
> 
> 时间：2008-09-29T05:31:24.137

是的。可以将 CSS 文件导入另一个 CSS 文件。

它必须是样式表中使用[@import 规则的第一条规则](http://www.w3.org/TR/CSS21/cascade.html#at-import)。

```
@import "mystyle.css";
@import url("mystyle.css"); 
```

唯一需要注意的是旧的网络浏览器将不支持它。事实上，这是从旧浏览器中隐藏 CSS 样式的 CSS 'hack' 之一。

有关浏览器支持，请参阅[此列表。](http://www.westciv.com/style_master/academy/browser_support/basic_concepts.html)

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2008-09-29T07:06:21.070

工作正常，`@import url("base.css");`但请记住，每个`@import`语句都是对服务器的新请求。这对您来说可能不是问题，但是当需要最佳性能时，您应该避免使用`@import`.

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-29T04:29:40.180

CSS`@import`规则就是这样做的。例如，

```
@import url('/css/common.css');
@import url('/css/colors.css'); 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-09-29T04:33:29.487

是的。

```
@import "your.css"; 
```

该规则记录[在这里](http://www.w3.org/TR/CSS2/cascade.html#at-import)。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-29T04:31:13.047

在某些情况下，可以使用@import "file.css"，大多数现代浏览器都应该支持这一点，像 NN4 这样的旧浏览器会有点发疯。

注意：import 语句必须在文件中的所有其他声明之前，并在生产中使用之前在所有目标浏览器上对其进行测试。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-29T04:33:21.843

是的，使用@import

[详细信息很容易在谷歌上搜索到， http:](http://webdesign.about.com/od/beginningcss/f/css_import_link.htm) //webdesign.about.com/od/beginningcss/f/css_import_link.htm 上的一个很好的信息

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-01-22T17:18:51.570

是的，可以使用 @import 并提供 css 文件的路径，例如

```
@import url("mycssfile.css"); 
```

或者

```
@import "mycssfile.css"; 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-07-27T03:22:11.103

`@import("/path-to-your-styles.css");`

这是使用 css 在 css 样式表中包含 css 样式表的最佳方式。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-04-08T17:33:30.253

“@import”规则可以调用多个样式文件。这些文件在需要时由浏览器或用户代理调用，例如 HTML 标记调用 CSS。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="EN" dir="ltr">
<head>
<title>Using @import</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<style type="text/css">
@import url("main.css");
</style>
</head>
<body>
</body>
</html> 
```

CSS 文件“main.css”包含以下语法：

```
@import url("fineprint.css") print;
@import url("bluish.css") projection, tv;
@import 'custom.css';
@import url("chrome://communicator/skin/");
@import "common.css" screen, projection;
@import url('landscape.css') screen and (orientation:landscape); 
```

要插入样式元素，请使用[createTexNode 不要使用 innerHTML](https://stackoverflow.com/a/5229978/4058484)但是：

```
<script>
var style = document.createElement('style');
style.setAttribute("type", "text/css");
var textNode = document.createTextNode("
    @import 'fineprint.css' print;
    @import 'bluish.css' projection, tv;
    @import 'custom.css';
    @import 'chrome://communicator/skin/';
    @import 'common.css' screen, projection;
    @import 'landscape.css' screen and (orientation:landscape);
");
style.appendChild(textNode);
</script> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-04-09T08:28:35.633

```
@import url('style.css'); 
```

与最佳答案相反，不建议在使用 HTTP/2.0 时将所有 CSS 文件聚合为一个块

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-04-05T08:37:50.423

## 使用 altervista 和 wordpress 导入引导程序

我用它来用 wordpress 在 altervista 中导入 bootstrap.css

```
@import url("https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"); 
```

它工作正常，因为如果我把它放到页面中，它会删除 html 链接 rel 代码

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-12-15T05:59:58.553

是的，您可以轻松地将一个 css 导入另一个（网站中的任何位置）您必须使用如下：

```
@import url("url_path"); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-02-26T02:56:56.303

[在这里](http://www.cssnewbie.com/css-import-rule/#.Uw1XRPmSzkc "sing the CSS @import Rule")唱 CSS @import 规则

```
@import url('/css/header.css') screen;
@import url('/css/content.css') screen;
@import url('/css/sidebar.css') screen;
@import url('/css/print.css') print; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-11-12T07:33:47.627

我创建了 main.css 文件并在其中包含了所有 css 文件。

我们只能包含一个 main.css 文件

```
@import url('style.css');
@import url('platforms.css'); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-05-09T14:13:18.330

无论出于何种原因，@import 对我不起作用，但这并不是真的必要，不是吗？

这是我在 html 中所做的：

```
 <link rel="stylesheet" media="print" href="myap-print.css">
  <link rel="stylesheet" media="print" href="myap-screen.css">
  <link rel="stylesheet" media="screen" href="myap-screen.css"> 
```

请注意，media="print" 有 2 个样式表：myap-print.css 和 myap-screen.css。这与在 myap-print.css 中包含 myap-screen.css 的效果相同。

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2013-03-06T16:31:58.523

我偶然发现了这一点，我只想说请不要在 CSS 中使用 @IMPORT ！！！导入语句被发送到客户端，客户端执行另一个请求。如果您想在不同文件之间划分 CSS，请使用 Less。在 Less 中，导入语句发生在服务器上，并且输出被缓存，并且不会通过强制客户端建立另一个连接来造成性能损失。Sass 也是我探索过的另一种选择。坦率地说，如果您不使用 Less 或 Sass，那么您应该开始使用。[http://willseitz-code.blogspot.com/2013/01/using-less-to-manage-css-files.html](http://willseitz-code.blogspot.com/2013/01/using-less-to-manage-css-files.html)

# apache-flex - Flex HTTPService 不包含 Content-Length 标头？

> ID：147505
> 
> 赞同：0
> 
> 时间：2008-09-29T04:26:05.633
> 
> 标签：apache-flex, actionscript-3

我正在尝试让 Flex 应用程序与我开发的自定义 python 网络服务器进行通信。

我注意到我无法读取收到的 postdata，因为 Flex 似乎没有在 HTTP 标头中包含 Content-Length。（从纯 HTML 发布到我的网络服务器时工作）

这是一个已知问题吗？任何想法如何设置内容长度标头？

这是正在发送的当前标头：

```
主机：本地主机：7070

用户代理：Mozilla/5.0（Windows；U；Windows NT 5.1；en-US；rv:1.9.0.3）Gecko/2008092417 Firefox/3.0

.3

接受：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

接受语言：en-us,en;q=0.5

接受编码：gzip,deflate

接受字符集：ISO-8859-1,utf-8;q=0.7,*;q=0.7

保活：300

连接：保持活动

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T17:40:42.480

它应该，只要您将 HTTPService 的方法属性设置为 POST。如果省略它，它将默认为 GET，并且参数将作为查询字符串的一部分发送，而不是作为 POST 数据发送。

我使用这个 Flex 代码设置了这个场景：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application  layout="absolute"
    xmlns:mx="http://www.adobe.com/2006/mxml"
    creationComplete="init()">

    <mx:HTTPService id="service" 
        url="http://localhost:8000/"
        method="POST"
        resultFormat="text"
        result="response.htmlText=ResultEvent(event).result.toString()"/>

    <mx:Text id="response" width="100%" height="100%"/>

    <mx:Script>
        <![CDATA[
            import mx.rpc.events.ResultEvent;
            private function init() : void {
                service.send({
                    foo: "Fred",
                    bar: "Barney"
                });
            }
        ]]>
    </mx:Script>
</mx:Application> 
```

这个python服务器代码：

```
#!/usr/bin/env python

import SimpleHTTPServer, BaseHTTPServer, string

class MyHandler(BaseHTTPServer.BaseHTTPRequestHandler):
    def do_POST(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html")
        self.end_headers()
        self.wfile.write("<html><body>")
        self.wfile.write("<b>METHOD:</b> " + self.command)

        # Write out Headers
        header_keys = self.headers.dict.keys()
        for key in header_keys:
            self.wfile.write("<br><b>" + key + "</b>: ")
            self.wfile.write(self.headers.dict[key])

        # Write out any POST data
        if self.headers.dict.has_key("content-length"):
            content_length = string.atoi(self.headers.dict["content-length"])
            raw_post_data = self.rfile.read(content_length) 
            self.wfile.write("<br><b>Post Data:</b> " + raw_post_data) 
        self.wfile.write("</body></html>")
    def do_GET(self):
        self.do_POST()

try:
    BaseHTTPServer.test(MyHandler, BaseHTTPServer.HTTPServer)
except KeyboardInterrupt:
    print 'Exiting...' 
```

并得到了这个结果：

```
METHOD: POST
content-length: 19
accept-language: en-us,en;q=0.5
accept-encoding: gzip,deflate
connection: keep-alive
keep-alive: 300
accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
user-agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.1) Gecko/2008070208 Firefox/3.0.1
accept-charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
host: 10.0.7.61:8000
content-type: application/x-www-form-urlencoded
Post Data: bar=Barney&foo=Fred 
```

所以它应该工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T04:44:56.277

我不相信这是一个已知问题。

您确定没有发送 Content-Length 吗？您已经发布了来自浏览器的 HTTP 交互的请求端；协议的那一侧永远没有 Content-Length 标头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T13:28:14.203

正如比尔 D 所说，您几乎可以肯定不会进行 POST，因为我们一直都在这样做，将它们与我们的服务器代码一起使用，并且它肯定包括 Content-Length。

# python - 如何使用 Python 的 __import__ 函数执行相当于“import * from module”的操作？

> ID：147507
> 
> 赞同：20
> 
> 时间：2008-09-29T04:28:41.137
> 
> 标签：python, python-import

给定一个带有模块名称的字符串，你如何导入模块中的所有内容，就好像你调用了：

```
from module import * 
```

即给定字符串 S="module"，如何获得以下等效项：

```
__import__(S, fromlist="*") 
```

这似乎没有按预期执行（因为它不导入任何东西）。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-29T04:45:07.447

请重新考虑。唯一比*魔法*`import *`更糟糕的是。 *`import *`*

 *如果你真的想：

```
m = __import__ (S)
try:
    attrlist = m.__all__
except AttributeError:
    attrlist = dir (m)
for attr in attrlist:
    globals()[attr] = getattr (m, attr) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-07-20T03:16:33.197

这是我为 Django 动态命名本地设置文件的解决方案。请注意下面添加的检查以不包括导入文件中包含“__”的属性。`__name__`全局被本地设置文件的模块名称覆盖，这导致在`setup_environ()`manage.py 中使用的有问题。

```
try:
    import socket
    HOSTNAME = socket.gethostname().replace('.','_')
    # See http://docs.python.org/library/functions.html#__import__
    m = __import__(name="settings_%s" % HOSTNAME, globals=globals(), locals=locals(), fromlist="*")
    try:
        attrlist = m.__all__
    except AttributeError:
        attrlist = dir(m)        
    for attr in [a for a in attrlist if '__' not in a]:
        globals()[attr] = getattr(m, attr)

except ImportError, e:
    sys.stderr.write('Unable to read settings_%s.py\n' % HOSTNAME)
    sys.exit(1) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T02:33:33.477

潜在的问题是我正在开发一些 Django，但在多个主机（与同事）上，所有主机都具有不同的设置。我希望在 project/settings.py 文件中做这样的事情：

```
from platform import node

settings_files = { 'BMH.lan': 'settings_bmh.py", ... } 

__import__( settings_files[ node() ] ) 
```

这似乎是一个简单的解决方案（因此很优雅），但我同意它有一种味道，并且当您必须使用 John Millikin 发布的逻辑（谢谢）时，这种简单性就会消失。这基本上是我采用的解决方案：

```
from platform import node

from settings_global import *

n = node()

if n == 'BMH.lan':
  from settings_bmh import *
# add your own, here...
else:
  raise Exception("No host settings for '%s'. See settings.py." % node()) 
```

这对我们的目的很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-29T09:30:01.560

在您的情况下，您似乎也可以在模块的字典上使用**dict.update() ：**

```
config = [__import__(name) for name in names_list]

options = {}
for conf in config:
    options.update(conf.__dict__) 
```

**更新：**我认为它有一个简短的“功能”版本：

```
options = reduce(dict.update, map(__import__, names_list)) 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-15T22:55:08.893

我没有找到一个好方法，所以我从[http://www.djangosnippets.org/snippets/600/采取了一种更简单但丑陋的方法](http://www.djangosnippets.org/snippets/600/)

```
try:
    import socket
    hostname = socket.gethostname().replace('.','_')
    exec "from host_settings.%s import *" % hostname
except ImportError, e:
    raise e 
```

# algorithm - 3个或更多数字的最小公倍数

> ID：147515
> 
> 赞同：167
> 
> 时间：2008-09-29T04:33:16.087
> 
> 标签：algorithm, math, lcm

你如何计算多个数字的最小公倍数？

到目前为止，我只能在两个数字之间计算它。但不知道如何扩展它以计算 3 个或更多数字。

到目前为止，我就是这样做的

```
LCM = num1 * num2 /  gcd ( num1 , num2 ) 
```

使用 gcd 是计算数字的最大公约数的函数。使用欧几里得算法

但我不知道如何计算 3 个或更多数字。

* * *

## 回答 #1

> 赞同：194
> 
> 时间：2008-09-29T04:37:31.660

您可以通过迭代计算两个数字的 LCM 来计算两个以上数字的 LCM，即

```
lcm(a,b,c) = lcm(a,lcm(b,c)) 
```

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2008-09-29T04:44:40.147

在 Python 中（修改[primes.py](http://www.4dsolutions.net/cgi-bin/py2html.cgi?script=/ocn/python/primes.py)）：

```
def gcd(a, b):
    """Return greatest common divisor using Euclid's Algorithm."""
    while b:      
        a, b = b, a % b
    return a

def lcm(a, b):
    """Return lowest common multiple."""
    return a * b // gcd(a, b)

def lcmm(*args):
    """Return lcm of args."""   
    return reduce(lcm, args) 
```

用法：

```
>>> lcmm(100, 23, 98)
112700
>>> lcmm(*range(1, 20))
232792560 
```

`reduce()`像[这样](http://ideone.com/353pA)工作：

```
>>> f = lambda a,b: "f(%s,%s)" % (a,b)
>>> print reduce(f, "abcd")
f(f(f(a,b),c),d) 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-04-14T21:48:38.557

这是一个 ECMA 风格的实现：

```
function gcd(a, b){
    // Euclidean algorithm
    while (b != 0){
        var temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}

function lcm(a, b){
    return (a * b / gcd(a, b));
}

function lcmm(args){
    // Recursively iterate through pairs of arguments
    // i.e. lcm(args[0], lcm(args[1], lcm(args[2], args[3])))

    if(args.length == 2){
        return lcm(args[0], args[1]);
    } else {
        var arg0 = args[0];
        args.shift();
        return lcm(arg0, lcmm(args));
    }
} 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2015-04-18T12:41:34.220

我会选择这个（C#）：

```
static long LCM(long[] numbers)
{
    return numbers.Aggregate(lcm);
}
static long lcm(long a, long b)
{
    return Math.Abs(a * b) / GCD(a, b);
}
static long GCD(long a, long b)
{
    return b == 0 ? a : GCD(b, a % b);
} 
```

只是一些澄清，因为乍一看它并没有很清楚这段代码在做什么：

Aggregate 是一种 Linq 扩展方法，因此您不能忘记将 using System.Linq 添加到您的引用中。

Aggregate 获得了一个累加函数，因此我们可以在 IEnumerable 上使用属性 lcm(a,b,c) = lcm(a,lcm(b,c))。[更多关于聚合](https://msdn.microsoft.com/en-us/library/vstudio/bb548651(v=vs.100).aspx)

GCD 计算使用[欧几里得算法](http://en.wikipedia.org/wiki/Euclidean_algorithm)。

lcm 计算使用 Abs(a*b)/gcd(a,b) ，参考[Reduction by the maximum common divisor](http://en.wikipedia.org/wiki/Least_common_multiple)。

希望这可以帮助，

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-01-26T21:54:06.607

我刚刚在 Haskell 中发现了这一点：

```
lcm' :: Integral a => a -> a -> a
lcm' a b = a`div`(gcd a b) * b
lcm :: Integral a => [a] -> a
lcm (n:ns) = foldr lcm' n ns 
```

我什至花时间写了自己的`gcd`函数，结果在 Prelude 中找到了！今天学到了很多东西 :D

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-08-07T17:54:27.803

一些不需要 gcd 函数的 Python 代码：

```
from sys import argv 

def lcm(x,y):
    tmp=x
    while (tmp%y)!=0:
        tmp+=x
    return tmp

def lcmm(*args):
    return reduce(lcm,args)

args=map(int,argv[1:])
print lcmm(*args) 
```

这是它在终端中的样子：

```
$ python lcm.py 10 15 17
510 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-11-02T18:45:47.730

这是一个 Python 单线器（不计算导入），用于返回 1 到 20（含）整数的 LCM：

Python 3.5+ 导入：

```
from functools import reduce
from math import gcd 
```

Python 2.7 导入：

```
from fractions import gcd 
```

常见逻辑：

```
lcm = reduce(lambda x,y: x*y // gcd(x, y), range(1, 21)) 
```

请注意，在[Python 2](https://docs.python.org/2/reference/expressions.html#operator-precedence)和[Python 3](https://docs.python.org/3/reference/expressions.html#operator-precedence)中，运算符优先级规则规定`*`and`//`运算符具有相同的优先级，因此它们从左到右应用。因此，`x*y // z`手段`(x*y) // z`而不是`x * (y//z)`。两者通常会产生不同的结果。这对于浮点除法没有那么重要，但对于[地板除法](https://stackoverflow.com/a/183870/832230)却很重要。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2018-03-24T16:42:04.050

这是在**Swift**中。

```
// Euclid's algorithm for finding the greatest common divisor
func gcd(_ a: Int, _ b: Int) -> Int {
  let r = a % b
  if r != 0 {
    return gcd(b, r)
  } else {
    return b
  }
}

// Returns the least common multiple of two numbers.
func lcm(_ m: Int, _ n: Int) -> Int {
  return m / gcd(m, n) * n
}

// Returns the least common multiple of multiple numbers.
func lcmm(_ numbers: [Int]) -> Int {
  return numbers.reduce(1) { lcm($0, $1) }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-12-05T20:26:29.997

这是 Virgil Disgr4ce 实现的 C# 端口：

```
public class MathUtils
{
    /// <summary>
    /// Calculates the least common multiple of 2+ numbers.
    /// </summary>
    /// <remarks>
    /// Uses recursion based on lcm(a,b,c) = lcm(a,lcm(b,c)).
    /// Ported from http://stackoverflow.com/a/2641293/420175.
    /// </remarks>
    public static Int64 LCM(IList<Int64> numbers)
    {
        if (numbers.Count < 2)
            throw new ArgumentException("you must pass two or more numbers");
        return LCM(numbers, 0);
    }

    public static Int64 LCM(params Int64[] numbers)
    {
        return LCM((IList<Int64>)numbers);
    }

    private static Int64 LCM(IList<Int64> numbers, int i)
    {
        // Recursively iterate through pairs of arguments
        // i.e. lcm(args[0], lcm(args[1], lcm(args[2], args[3])))

        if (i + 2 == numbers.Count)
        {
            return LCM(numbers[i], numbers[i+1]);
        }
        else
        {
            return LCM(numbers[i], LCM(numbers, i+1));
        }
    }

    public static Int64 LCM(Int64 a, Int64 b)
    {
        return (a * b / GCD(a, b));
    }

    /// <summary>
    /// Finds the greatest common denominator for 2 numbers.
    /// </summary>
    /// <remarks>
    /// Also from http://stackoverflow.com/a/2641293/420175.
    /// </remarks>
    public static Int64 GCD(Int64 a, Int64 b)
    {
        // Euclidean algorithm
        Int64 t;
        while (b != 0)
        {
            t = b;
            b = a % b;
            a = t;
        }
        return a;
    }
}' 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-11-14T19:09:59.413

以及 Scala 版本：

```
def gcd(a: Int, b: Int): Int = if (b == 0) a else gcd(b, a % b)
def gcd(nums: Iterable[Int]): Int = nums.reduce(gcd)
def lcm(a: Int, b: Int): Int = if (a == 0 || b == 0) 0 else a * b / gcd(a, b)
def lcm(nums: Iterable[Int]): Int = nums.reduce(lcm) 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-11-20T12:52:42.830

查找任何数字列表的 lcm 的函数：

```
 def function(l):
     s = 1
     for i in l:
        s = lcm(i, s)
     return s 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-04-24T12:27:31.957

使用 LINQ，您可以编写：

```
static int LCM(int[] numbers)
{
    return numbers.Aggregate(LCM);
}

static int LCM(int a, int b)
{
    return a * b / GCD(a, b);
} 
```

应该添加`using System.Linq;`并且不要忘记处理异常......

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-09-14T06:56:56.057

你可以用另一种方式来做 - 让有 n 个数字。取一对连续的数字并将其 lcm 保存在另一个数组中。在第一次迭代程序中执行此操作会进行 n/2 次迭代。然后接下来从 0 开始拾取对，例如 (0,1) ， (2,3) 等等。计算它们的 LCM 并存储在另一个数组中。这样做直到你只剩下一个数组。（如果 n 为奇数，则无法找到 lcm）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-06-16T19:13:54.793

ES6 风格

```
function gcd(...numbers) {
  return numbers.reduce((a, b) => b === 0 ? a : gcd(b, a % b));
}

function lcm(...numbers) {
  return numbers.reduce((a, b) => Math.abs(a * b) / gcd(a, b));
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-04-05T15:15:35.113

在 R 中，我们可以使用包*numbers中的函数***mGCD** (x) 和**mLCM** (x)来计算整数向量 x 中所有数字的最大公约数和最小公倍数：

 *```
 library(numbers)
    mGCD(c(4, 8, 12, 16, 20))
[1] 4
    mLCM(c(8,9,21))
[1] 504
    # Sequences
    mLCM(1:20)
[1] 232792560 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-11-25T00:56:21.307

只是为了好玩，一个外壳（几乎所有外壳）实现：

```
#!/bin/sh
gcd() {   # Calculate $1 % $2 until $2 becomes zero.
      until [ "$2" -eq 0 ]; do set -- "$2" "$(($1%$2))"; done
      echo "$1"
      }

lcm() {   echo "$(( $1 / $(gcd "$1" "$2") * $2 ))";   }

while [ $# -gt 1 ]; do
    t="$(lcm "$1" "$2")"
    shift 2
    set -- "$t" "$@"
done
echo "$1" 
```

试试看：

```
$ ./script 2 3 4 5 6 
```

要得到

```
60 
```

最大的输入和结果应该小于`(2^63)-1`或 shell 数学将换行。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-12-26T13:21:22.203

我正在寻找数组元素的 gcd 和 lcm 并在以下链接中找到了一个很好的解决方案。

[https://www.hackerrank.com/challenges/between-two-sets/forum](https://www.hackerrank.com/challenges/between-two-sets/forum)

其中包括以下代码。gcd 的算法使用的欧几里得算法在下面的链接中得到了很好的解释。

[https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm](https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm)

```
private static int gcd(int a, int b) {
    while (b > 0) {
        int temp = b;
        b = a % b; // % is remainder
        a = temp;
    }
    return a;
}

private static int gcd(int[] input) {
    int result = input[0];
    for (int i = 1; i < input.length; i++) {
        result = gcd(result, input[i]);
    }
    return result;
}

private static int lcm(int a, int b) {
    return a * (b / gcd(a, b));
}

private static int lcm(int[] input) {
    int result = input[0];
    for (int i = 1; i < input.length; i++) {
        result = lcm(result, input[i]);
    }
    return result;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-09-27T10:14:53.820

这是**PHP**的实现：

```
 // https://stackoverflow.com/q/12412782/1066234
    function math_gcd($a,$b) 
    {
        $a = abs($a); 
        $b = abs($b);
        if($a < $b) 
        {
            list($b,$a) = array($a,$b); 
        }
        if($b == 0) 
        {
            return $a;      
        }
        $r = $a % $b;
        while($r > 0) 
        {
            $a = $b;
            $b = $r;
            $r = $a % $b;
        }
        return $b;
    }

    function math_lcm($a, $b)
    {
        return ($a * $b / math_gcd($a, $b));
    }

    // https://stackoverflow.com/a/2641293/1066234
    function math_lcmm($args)
    {
        // Recursively iterate through pairs of arguments
        // i.e. lcm(args[0], lcm(args[1], lcm(args[2], args[3])))

        if(count($args) == 2)
        {
            return math_lcm($args[0], $args[1]);
        }
        else 
        {
            $arg0 = $args[0];
            array_shift($args);
            return math_lcm($arg0, math_lcmm($args));
        }
    }

    // fraction bonus
    function math_fraction_simplify($num, $den) 
    {
        $g = math_gcd($num, $den);
        return array($num/$g, $den/$g);
    }

    var_dump( math_lcmm( array(4, 7) ) ); // 28
    var_dump( math_lcmm( array(5, 25) ) ); // 25
    var_dump( math_lcmm( array(3, 4, 12, 36) ) ); // 36
    var_dump( math_lcmm( array(3, 4, 7, 12, 36) ) ); // 252 
```

归功于@T3db0t[上面的回答（ECMA 风格的代码）](https://stackoverflow.com/a/2641293/1066234)。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-01-04T18:03:08.470

GCD 需要对负数进行一些修正：

```
def gcd(x,y):
  while y:
    if y<0:
      x,y=-x,-y
    x,y=y,x % y
    return x

def gcdl(*list):
  return reduce(gcd, *list)

def lcm(x,y):
  return x*y / gcd(x,y)

def lcml(*list):
  return reduce(lcm, *list) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-05-30T02:53:00.890

这个怎么样？

```
from operator import mul as MULTIPLY

def factors(n):
    f = {} # a dict is necessary to create 'factor : exponent' pairs 
    divisor = 2
    while n > 1:
        while (divisor <= n):
            if n % divisor == 0:
                n /= divisor
                f[divisor] = f.get(divisor, 0) + 1
            else:
                divisor += 1
    return f

def mcm(numbers):
    #numbers is a list of numbers so not restricted to two items
    high_factors = {}
    for n in numbers:
        fn = factors(n)
        for (key, value) in fn.iteritems():
            if high_factors.get(key, 0) < value: # if fact not in dict or < val
                high_factors[key] = value
    return reduce (MULTIPLY, ((k ** v) for k, v in high_factors.items())) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-04-25T03:09:29.890

```
clc;

data = [1 2 3 4 5]

LCM=1;

for i=1:1:length(data)

    LCM = lcm(LCM,data(i))

end 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-02-05T16:26:47.500

我们[在微积分上实现了最小公倍数](http://www.calculla.com/en/least_common_multiple)，它适用于任意数量的输入，也显示步骤。

我们所做的是：

```
0: Assume we got inputs[] array, filled with integers. So, for example:
   inputsArray = [6, 15, 25, ...]
   lcm = 1

1: Find minimal prime factor for each input.
   Minimal means for 6 it's 2, for 25 it's 5, for 34 it's 17
   minFactorsArray = []

2: Find lowest from minFactors:
   minFactor = MIN(minFactorsArray)

3: lcm *= minFactor

4: Iterate minFactorsArray and if the factor for given input equals minFactor, then divide the input by it:
  for (inIdx in minFactorsArray)
    if minFactorsArray[inIdx] == minFactor
      inputsArray[inIdx] \= minFactor

5: repeat steps 1-4 until there is nothing to factorize anymore. 
   So, until inputsArray contains only 1-s. 
```

就是这样 - 你得到了你的 lcm。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-02-23T05:16:26.777

LCM 既是关联的又是可交换的。

LCM(a,b,c)=LCM(LCM(a,b),c)=LCM(a,LCM(b,c))

这是C中的示例代码：

```
int main()
{
  int a[20],i,n,result=1;  // assumption: count can't exceed 20
  printf("Enter number of numbers to calculate LCM(less than 20):");
  scanf("%d",&n);
  printf("Enter %d  numbers to calculate their LCM :",n);
  for(i=0;i<n;i++)
    scanf("%d",&a[i]);
 for(i=0;i<n;i++)
   result=lcm(result,a[i]);
 printf("LCM of given numbers = %d\n",result);
 return 0;
}

int lcm(int a,int b)
{
  int gcd=gcd_two_numbers(a,b);
  return (a*b)/gcd;
}

int gcd_two_numbers(int a,int b)
{
   int temp;
   if(a>b)
   {
     temp=a;
     a=b;
     b=temp;
   }
  if(b%a==0)
    return a;
  else
    return gcd_two_numbers(b%a,a);
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-04-30T21:05:04.370

方法 compLCM 接受一个向量并返回 LCM。所有数字都在向量 in_numbers 内。

```
int mathOps::compLCM(std::vector<int> &in_numbers)
 {
    int tmpNumbers = in_numbers.size();
    int tmpMax = *max_element(in_numbers.begin(), in_numbers.end());
    bool tmpNotDividable = false;

    while (true)
    {
        for (int i = 0; i < tmpNumbers && tmpNotDividable == false; i++)
        {
            if (tmpMax % in_numbers[i] != 0 )
                tmpNotDividable = true;
        }

        if (tmpNotDividable == false)
            return tmpMax;
        else
            tmpMax++;
    }
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-01-07T17:55:18.987

对于任何寻找快速工作代码的人，试试这个：

我编写了一个函数**`lcm_n(args, num)`** ，它计算并返回数组中所有数字的 lcm `args`。第二个参数`num`是数组中数字的计数。

将所有这些数字放入一个数组中`args`，然后调用函数`lcm_n(args,num);`

此函数**返回**所有这些数字的 lcm。

**下面是函数的实现`lcm_n(args, num)`：**

```
int lcm_n(int args[], int num) //lcm of more than 2 numbers
{
    int i, temp[num-1];

    if(num==2)
    {
        return lcm(args[0], args[1]);
    }
    else
    {
        for(i=0;i<num-1;i++)
        {
           temp[i] = args[i];   
        }

        temp[num-2] = lcm(args[num-2], args[num-1]);
        return lcm_n(temp,num-1);
    }
} 
```

此功能需要以下两个功能才能工作。因此，只需将它们与它一起添加即可。

```
int lcm(int a, int b) //lcm of 2 numbers
{
    return (a*b)/gcd(a,b);
}

int gcd(int a, int b) //gcd of 2 numbers
{
    int numerator, denominator, remainder;

    //Euclid's algorithm for computing GCD of two numbers
    if(a > b)
    {
        numerator = a;
        denominator = b;
    }
    else
    {
        numerator = b;
        denominator = a;
    }
    remainder = numerator % denominator;

    while(remainder != 0)
    {
        numerator   = denominator;
        denominator = remainder;
        remainder   = numerator % denominator;
    }

    return denominator;
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-09-15T15:51:35.383

`int gcd(int a, int b) { if (b == 0) return a; return gcd(b, a%b); } int lcm(int[] a, int n) { int res = 1, i; for (i = 0; i < n; i++) { res = res*a[i]/gcd(res, a[i]); } return res; }`

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-12-25T13:50:42.020

在蟒蛇中：

```
def lcm(*args):
    """Calculates lcm of args"""
    biggest = max(args) #find the largest of numbers
    rest = [n for n in args if n != biggest] #the list of the numbers without the largest
    factor = 1 #to multiply with the biggest as long as the result is not divisble by all of the numbers in the rest
    while True:
        #check if biggest is divisble by all in the rest:
        ans = False in [(biggest * factor) % n == 0 for n in rest]
        #if so the clm is found break the loop and return it, otherwise increment factor by 1 and try again
        if not ans:
            break
        factor += 1
    biggest *= factor
    return "lcm of {0} is {1}".format(args, biggest) 
```

* * *

```
>>> lcm(100,23,98)
'lcm of (100, 23, 98) is 112700'
>>> lcm(*range(1, 20))
'lcm of (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19) is 232792560' 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2017-02-16T20:40:35.470

这是我用的——

```
def greater(n):

      a=num[0]

      for i in range(0,len(n),1):
       if(a<n[i]):
        a=n[i]
      return a

r=input('enter limit')

num=[]

for x in range (0,r,1):

    a=input('enter number ')
    num.append(a)
a= greater(num)

i=0

while True:

    while (a%num[i]==0):
        i=i+1
        if(i==len(num)):
               break
    if i==len(num):
        print 'L.C.M = ',a
        break
    else:
        a=a+1
        i=0 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2018-08-22T02:09:50.597

对于蟒蛇 3：

```
from functools import reduce

gcd = lambda a,b: a if b==0 else gcd(b, a%b)
def lcm(lst):        
    return reduce(lambda x,y: x*y//gcd(x, y), lst) 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-05-21T10:13:28.920

在 Ruby 中，它很简单：

```
> [2, 3, 4, 6].reduce(:lcm)
=> 12

> [16, 32, 96].reduce(:gcd)
=> 16 
```

（在 Ruby 2.2.10 和 2.6.3 上测试。）

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2020-10-15T11:30:24.070

Python 3.9`math`模块`gcd`和`lcm`对数字列表的支持。

```
import math

lst = [1,2,3,4,5,6,7,8,9]

print(math.lcm(*lst))

print(math.gcd(*lst)) 
```

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2018-06-27T19:53:09.960

如果没有时间限制，这相当简单直接：

```
def lcm(a,b,c):
    for i in range(max(a,b,c), (a*b*c)+1, max(a,b,c)):
        if i%a == 0 and i%b == 0 and i%c == 0:
            return i 
```

# css - 即使没有内容，如何强制 DIV 块扩展到页面底部？

> ID：147528
> 
> 赞同：212
> 
> 时间：2008-09-29T04:40:24.290
> 
> 标签：css, html, border

在下面显示的标记中，我试图让内容 div 一直拉伸到页面底部，但只有在有内容要显示时才会拉伸。我想这样做的原因是即使没有任何内容要显示，垂直边框仍然会出现在页面下方。

这是我的**演示**：

```
body {
    font-family: Trebuchet MS, Verdana, MS Sans Serif;
    font-size:0.9em;
    margin:0;
    padding:0;
}
div#header {
    width: 100%;
    height: 100px;
}
#header a {
    background-position: 100px 30px;
    background: transparent url(site-style-images/sitelogo.jpg) no-repeat fixed 100px 30px;
    height: 80px;
    display: block;
}
#header, #menuwrapper {
    background-repeat: repeat;
    background-image: url(site-style-images/darkblue_background_color.jpg);
}
#menu #menuwrapper {
    height:25px;
}
div#menuwrapper {
    width:100%
}
#menu, #content {
    width:1024px;
    margin: 0 auto;
}
div#menu {
    height: 25px;
    background-color:#50657a;
}
```

```
<form id="form1">
  <div id="header">
      <a title="Home" href="index.html" />
  </div>

  <div id="menuwrapper">
      <div id="menu">
      </div>
  </div>

  <div id="content">
  </div>
</form>
```

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2009-02-23T20:09:13.557

您的问题不是 div 不是 100% 高度，而是它周围的容器不是。这将有助于我怀疑您正在使用的浏览器：

```
html,body { height:100%; } 
```

您可能还需要调整填充和边距，但这将使您完成 90% 的工作。如果您需要使其适用于所有浏览器，您将不得不稍微弄乱它。

这个网站有一些很好的例子：

[http://www.brunildo.org/test/html_body_0.html](http://www.brunildo.org/test/html_body_0.html)
[http://www.brunildo.org/test/html_body_11b.html](http://www.brunildo.org/test/html_body_11b.html)
[http://www.brunildo.org/test/index.html](http://www.brunildo.org/test/index.html)

我还建议去[http://quirksmode.org/](http://quirksmode.org/)

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2014-06-02T02:08:51.100

我将尝试直接在标题中回答问题，而不是一心想将页脚粘贴到页面底部。

## 如果没有足够的内容来填充可用的垂直浏览器视口，则使 div 扩展到页面底部：

演示在（拖动框架句柄查看效果）：http: [//jsfiddle.net/NN7ky](http://jsfiddle.net/NN7ky)
*（优点：干净、简单。缺点：需要 flexbox - [http://caniuse.com/flexbox](http://caniuse.com/flexbox)）*

**HTML：**

```
<body>

  <div class=div1>
    div1<br>
    div1<br>
    div1<br>
  </div>

  <div class=div2>
    div2<br>
    div2<br>
    div2<br>
  </div>

</body> 
```

**CSS：**

```
* { padding: 0; margin: 0; }

html, body {
  height: 100%;

  display: flex;
  flex-direction: column;
}

body > * {
  flex-shrink: 0;
}

.div1 { background-color: yellow; }

.div2 {
  background-color: orange;
  flex-grow: 1;
} 
```

*ta-da - 或者我只是太困了*

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-29T04:47:19.797

尝试使用以下 css 规则：

```
#content {
    min-height: 600px;
    height: auto !important;
    height: 600px;
} 
```

更改高度以适合您的页面。为了跨浏览器的兼容性，两次提到了高度。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T04:44:24.047

[你可以用最小高度](http://www.w3schools.com/CSS/pr_dim_min-height.asp)声明来破解它

```
<div style="min-height: 100%">stuff</div> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T07:00:54.797

并非所有浏览器都支持 min-height 属性。如果您需要 #content 在较长的页面上扩展它的高度，那么 height 属性会将其缩短。

这有点小技巧，但你可以在你的#content div 中添加一个宽度为 1 像素、高度为例如 1000 像素的空 div。这将强制内容至少为 1000px 高，并且仍然允许更长的内容在需要时扩展高度

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T03:39:18.517

虽然它不像纯 CSS 那样优雅，但一点点 javascript 可以帮助实现这一点：

```
<html>
<head>
<style type='text/css'>
    div {
        border: 1px solid #000000;
    } 
</style>
<script type='text/javascript'>

    function expandToWindow(element) {
         var margin = 10; 

         if (element.style.height < window.innerHeight) { 
            element.style.height = window.innerHeight - (2 * margin) 
         }
    }

</script>
</head>
<body onload='expandToWindow(document.getElementById("content"));'>
<div id='content'>Hello World</div>
</body>
</html> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-07-25T23:44:10.337

试试 Ryan Fait 的“粘页脚”解决方案，

[http://ryanfait.com/sticky-footer/](http://ryanfait.com/sticky-footer/)
[http://ryanfait.com/resources/footer-stick-to-bottom-of-page/](http://ryanfait.com/resources/footer-stick-to-bottom-of-page/)

也可以在 IE、Firefox、Chrome、Safari 和 Opera 上工作，但还没有测试过。这是一个很好的解决方案。实施起来非常简单可靠。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-03-07T23:10:28.757

尝试：

```
html, body {
    height: 102%;
}
.wrapper {
    position: relative;
    height: 100%;
    width: 100%;
}
.div {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 1000px;
    min-height: 100%;
} 
```

还没测试...

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-08-15T08:42:15.450

固定高度的粘性页脚：

**HTML 方案：**

```
<body>
   <div id="wrap">
   </div>
   <div id="footer">
   </div>
</body> 
```

**CSS：**

```
html, body {
    height: 100%;
}
#wrap {
    min-height: 100%;
    height: auto !important;
    height: 100%;
    margin: 0 auto -60px;
}
#footer {
    height: 60px;
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-03-10T15:40:03.420

您可以将“vh”长度单位用于元素本身及其父元素的 min-height 属性。从 IE9 开始支持：

```
<body class="full-height">
    <form id="form1">
    <div id="header">
        <a title="Home" href="index.html" />
    </div>

    <div id="menuwrapper">
        <div id="menu">
        </div>
    </div>

    <div id="content" class="full-height">
    </div>
</body> 
```

CSS：

```
.full-height {
    min-height: 100vh;
    box-sizing: border-box;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-08-04T06:22:37.093

试试[http://mystrd.at/modern-clean-css-sticky-footer/](http://mystrd.at/modern-clean-css-sticky-footer/)

上面的链接失效了，但是这个链接[https://stackoverflow.com/a/18066619/1944643](https://stackoverflow.com/a/18066619/1944643)没问题。:D

演示：

```
<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="author" content="http://mystrd.at">
    <meta name="robots" content="noindex, nofollow">
    <title>James Dean CSS Sticky Footer</title>
    <style type="text/css">
        html {
            position: relative;
            min-height: 100%;
        }
        body {
            margin: 0 0 100px;
            /* bottom = footer height */
            padding: 25px;
        }
        footer {
            background-color: orange;
            position: absolute;
            left: 0;
            bottom: 0;
            height: 100px;
            width: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <article>
        <!-- or <div class="container">, etc. -->
        <h1>James Dean CSS Sticky Footer</h1>

        <p>Blah blah blah blah</p>
        <p>More blah blah blah</p>
    </article>
    <footer>
        <h1>Footer Content</h1>
    </footer>
</body>

</html> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-08-08T08:38:24.380

我认为只要让 html 填充 100% 也可以解决这个问题，可能是 body 填充了 html 的 100%，但 html 没有填充 100% 的屏幕。

尝试：

```
html, body {
      height: 100%;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-29T04:46:43.650

你也可能喜欢这个： http: [//matthewjamestaylor.com/blog/ultimate-2-column-left-menu-pixels.htm](http://matthewjamestaylor.com/blog/ultimate-2-column-left-menu-pixels.htm)

这不是您所要求的，但它也可能适合您的需求。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-29T07:19:14.610

我没有代码，但我知道我曾经使用 height:1000px 和 margin-bottom: -1000px; 试试看。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-23T19:29:45.663

根据您的布局的工作方式，您可能会在`<html>`元素上设置背景，这始终至少是视口的高度。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-09-28T09:51:08.077

仅使用样式表 (CSS) 是不可能做到这一点的。有些浏览器不接受

```
height: 100%; 
```

作为比浏览器窗口的视点更高的值。

Javascript 是最简单的跨浏览器解决方案，尽管如前所述，它不是一个干净或漂亮的解决方案。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-09-07T12:40:08.520

```
#content {
    height: calc(100% - the amount of pixels the content div is away from the top);
} 
```

因此，如果您的 div 距离顶部 200px，您需要的代码将是

```
#content {
    height: calc(100% - 200px);
} 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2011-12-02T17:30:08.223

我知道这不是最好的方法，但如果不弄乱我的标题、菜单等位置，我就无法弄清楚。所以....我为这两个列使用了一个表格。这是一个快速修复。不需要 JS ;)

# ide - 真正的 HLSL IDE/调试器

> ID：147530
> 
> 赞同：8
> 
> 时间：2008-09-29T04:40:32.293
> 
> 标签：ide, 3d, hlsl

是否有用于开发 HLSL 代码的 IDE？我想要的三个关键特性是：
1）语法高亮
2）自动完成
3）交互调试

Visual Studio 不做任何这些事情，RenderMonkey 或 FX Composer 似乎也不做。

是否有一些我不知道的 IDE，或者这三个 IDE 中的一个实际上支持这些功能，而我太无能，无法弄清楚如何正确使用它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T05:16:35.497

你真的尝试过 ATI 的 RenderMoney 或 NVidia 的 FX Composer 吗？

两者实际上都提供语法突出显示。此外，NVidia 的 Cg 工具包实际上允许您通过一些自定义设置在 Visual Studio 中启用语法高亮。

至于自动完成，与我们的正常编程相比，我认为它并不需要。这是因为您不会为着色器编程编写很长的代码。着色器非常关键，因为它在生成的每一帧上运行，并且每条指令都需要 1 到几个时钟周期才能执行，因此您可以写多长时间总是有物理限制。

交互式调试目前是 GPU 硬件的限制。要真正做到这一点，GPU 必须用我们的 CPU 来模拟，考虑到 REF（软件渲染）设备永远无法应付甚至过时的 GPU，这是完全不可能的，关于模拟着色器还有什么要说的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-04T17:56:33.120

旧问题的新答案，用于调试：[NVidias Shader Debugger](http://developer.nvidia.com/nv-shader-debugger)，它最近变得免费。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-20T16:08:16.903

对旧问题的另一个新答案（实际上是 2 个答案）：

1.  [NShader](http://nshader.codeplex.com/)是一个 Visual Studio 插件，为 HLSL / GLSL / CG 提供语法高亮。虽然没有智能感知或调试。

2.  已经提到的 IntelliShade 在原始站点不再可用，但已在[此处](http://xna-uk.net/blogs/mvi/archive/2010/03/12/intellishade.aspx)镜像。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T14:09:52.457

在 MSDev 环境中，您可以定义关键字并指定要识别和已知文件的“hlsl”和“fx”，并让 MSDev 突出显示您想要的关键字。

至于编辑工具 - 您可以使用 NVidia 的 FX composer 或 ATI 的 RenderMonkey。如果您需要调试和配置文件，您也可以使用他们的工具并给 Pix 一个旋转。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-11T18:50:28.870

看看[沙赞](http://blog.shazzam-tool.com/)。它不具有交互式调试功能，但很容易编辑和刷新。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-11T02:45:16.510

现在有了 Visual Studio 11，就有了“真正的 hlsl ide 和调试器”。它在 Visual Studio 11 中的[Game Debugging 中](http://blogs.msdn.com/b/vcblog/archive/2011/11/08/10235150.aspx)有详细说明，可在[Visual Studio 11 Beta](http://blogs.msdn.com/b/chuckw/archive/2012/02/29/visual-studio-11-beta.aspx)中获得。

# file - 保存 Windows XP 和 Vista 应用程序用户信息的最佳位置

> ID：147533
> 
> 赞同：3
> 
> 时间：2008-09-29T04:43:12.693
> 
> 标签：file, windows-vista, windows-xp, save

我需要为我正在构建的这个应用程序以加密形式保存用户的登录信息，但我不确定保存文件的最佳位置。我不想将它保存到程序应用程序文件夹中，因为我希望每个用户都有它。

那么保存它的最佳文件夹（或方法）是什么？

编辑：使用 C++。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T05:07:21.510

[根据维基百科](http://en.wikipedia.org/wiki/Special_Folders)，似乎 C:\Documents and Settings\%username%\Local Settings\Application Data 可能是合适的地方。文章称此位置用于“特定于用户和特定于计算机的应用程序设置”。

编辑：Cruizer 在评论中指出（我会在那里回复，但我还不能发表评论）在 Vista 中它是 C:\Users\%username% 并且它不应该是硬编码的。谢谢。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T05:04:33.233

使用数据保护 API (DPAPI) - XP 和 Vista 中 CryptoAPI 的一部分。这是 DPAPI 的一个很好的概述 - [http://msdn.microsoft.com/en-us/library/ms995355.aspx](http://msdn.microsoft.com/en-us/library/ms995355.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T05:16:49.430

是的，本地应用程序路径看起来像是赢家。

我在 MSDN 中找到这篇文章以使用 C++ 获取它：http: [//msdn.microsoft.com/en-us/library/bb762494.aspx](http://msdn.microsoft.com/en-us/library/bb762494.aspx)

例子：

```
char localAppPath[MAX_PATH];
SHGetFolderPath(NULL, CSIDL_LOCAL_APPDATA, NULL, SHGFP_TYPE_CURRENT, localAppPath); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T04:47:32.277

你在使用.NET吗？[隔离存储](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)怎么样？这样您就不必担心目录位置，它就在那里......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T05:16:28.073

用户信息应始终放在 %HOMEDRIVE%%HOMEPATH% 的某个子目录中（映射到用户主目录）。没有例外。每个用户的应用程序特定设置的好地方是 %APPDATA% 内的子目录。这映射到：XP 上的“%HOMEDRIVE%%HOMEPATH%\Application Data”和 Vista 上的“%HOMEDRIVE%%HOMEPATH%\AppData\Roaming”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-16T06:56:15.707

如果您使用 .NET 获取特殊文件夹，您可以使用

```
Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData); 
```

或者

```
Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData); 
```

对于非漫游版本。

# asp.net - ASP.NET 和无法验证的组件

> ID：147536
> 
> 赞同：1
> 
> 时间：2008-09-29T04:43:41.317
> 
> 标签：asp.net

我正在开发一个 ASP.NET 应用程序。我需要使用一些无法验证的第三方组件（没有源代码）（我认为它是用托管 C++ 编写的）。

我想知道这是否会给客户带来问题。ASP.NET 应用程序可以安装在客户服务器上，也可以安装在某些托管服务器上。

我/客户可能会遇到什么问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T04:55:28.683

你必须自己测试这些。可能会出现的问题是：

*   COM DLL 注册不当——您必须测试您的应用程序安装程序以确保不会发生这种情况
*   注册表复杂性 - 一些第三方组件设置的注册表项只能使用*他们自己的安装程序*输入，使您无法自行正确安装组件。在这种情况下，您必须将他们的安装程序引导到您的安装程序。
*   未知的依赖关系——如果您的第三方组件对其他不明显的组件有依赖关系
*   未知要求——如果您的第三方组件有特定的硬件要求，它们可能会失败。
*   环境要求不明确——某些第三方组件可以在 Windows Server 2000 或 2003 上运行，但不能在 2008 上运行，反之亦然

所有这些都可以通过在 vanilla（普通 Windows）服务器上测试您的最终应用程序安装程序来缓解，这些服务器代表了您的目标服务器操作系统的良好示例：Windows Server 2000、2003、2008。您还应该针对新安装的实例测试您的应用程序IIS 5、6 和 7。

因此，如果您希望以 Mono 为目标，则必须在各种 Linux 发行版上进行进一步的测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T04:49:29.650

首先，您必须确保使用与客户相同的 .NET Framework 版本。另请注意该第三方组件的依赖项/要求；如果这些不存在于您客户的机器中，那么它将无法工作。

# jquery - Silverlight 与 jQuery 是否“相同”？

> ID：147551
> 
> 赞同：11
> 
> 时间：2008-09-29T04:50:41.427
> 
> 标签：jquery, silverlight, rich-internet-application

Silverlight 可以用于与 jQuery 相同的东西，还是它们打算用于不同的东西？

例如，vb.net 可以用于与 C# 相同的东西，而 C# 用于与 JavaScript 不同的东西。Silverlight 和 jQuery 是像 vb.net 和 C#，还是更像 C# 和 JavaScript？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-29T04:54:52.507

有趣的谜语。不，Silverlight 和 jQuery 完全是两个不同的东西。如果您想进行类比，Silverlight 更类似于 Adob​​e Flash。jQuery 是一个类似于 Prototype、Dojo 等的 Javascript 库。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-29T13:34:49.217

Silverlight 可用于创建丰富的交互式媒体，并且比其他任何东西都更类似于 Flash。jQuery 是一个 JavaScript 库。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-29T04:57:48.600

这更像是 C# 和 JavaScript 之间的区别。高级别的 Silverlight 和 jQuery 旨在用于类似的事情 - 在 Web 浏览器中进行丰富的用户交互。然而，Silverlight 可以通过使用 .NET 框架来做一些更有趣的事情，并且允许您使用 WPF 进行混搭，这样您就可以添加 3D 渲染、高级打印、播放电影、DRM（呃）以及更多 jQuery 刚刚提供的功能还不能做。也就是说，我毫不怀疑 JavaScript 和 JS 框架（如 jQuery）最终会赶上 Silverlight 可以做的大部分事情。

另一件要提的是，Silverlight 要求用户下载并安装浏览器插件，而 jQuery 可与任何支持 JavaScript 的现代浏览器一起使用。我认为 Silverlight 更接近于 Adob​​e Flash 而不是 jQuery。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T04:53:35.053

这不是“相同”的东西。

它更像是 C# 和 Javascript。

jQuery 是一个有助于编写 javascript 的 javascript 框架

但 Silverlight 本身就是一种交互式媒体技术……这与……IMO……完全不同。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-12T18:34:03.987

说 Silverlight“就像 Flash”并不能回答这个问题。

好的，怎么样，*(Flash|Silverlight) 可以产生相同的结果 javascript 吗？*

更重要的是，在当今的浏览器中，是否有任何视觉效果无法像 (Flash|Silverlight) 那样在 Javascript 中轻松呈现？

将 (Flash|Silverlight) 用于下拉菜单和动画等内容与 javascript 相比，是否有速度和性能优势？

在定制高度数据丰富的网站以使其更容易使用代码而不是设计器类型的界面时，使用 (Flash|Silverlight) 是否有困难？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T05:00:22.993

Silverlight 更接近于 Flash，而不是 JScript。

Flash 和 Silverlight 都是可用于创建丰富界面的浏览器插件。两者都使用专有技术和格式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T05:24:06.883

将 Silverlight 视为“Flash.NET”——一种编写在浏览器中自己的盒子中运行的 .NET 应用程序的方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T07:13:16.777

扩展所说的内容，您不妨尝试将汇编程序与 Photoshop 进行比较。在推理上，两者都可以用来生成文件。

它们确实是完全不同的技术。

Javascript 完全依赖底层页面结构和 DOM 扩充来产生结果，Silverlight 就像 Flash，更倾向于成为页面中的一个“窗口”，有自己的画布等。

然而，试图将 silverlight 与 jQuery（这是一个javascript*库）进行比较，这简直是荒谬的。*

它们是如此无与伦比，我很难找到另外两件同样无与伦比的东西。你不妨问，“哪个更好，一栋房子，还是一片奶酪”。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T15:22:10.393

今天早上，[Scott Guthrie 的博客](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx)上发表了一篇文章，指出微软将从现在开始随 Visual Studio 一起发布标准 jQuery 库，并为其定义智能感知。这对于 jQuery 和 Silverlight 的未来来说是一个令人振奋的消息，不是作为竞争技术，而是作为互补技术！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-29T05:00:24.210

您可以将它们用于相同的任务。您可以使用 jQuery 或 Flash 制作交互式 Web 应用程序。每个都有优点，这取决于您是否*需要*闪光灯/银光。如果您可以在不借助 Flash 的情况下实现目标，那么您应该只使用 JS。有些人可能会反过来认为 javascript 是一种手段，而 flash/silverlight 是创建交互式内容的主要方法。就个人而言，我听说silverlight 的开发时间比flash/flex 长得多，而且用户群也少得多（可以理解）。使用 flash 和 flex，你会得到那些还没有下载 flash 的人。使用 javascript，您会遇到使用奇怪浏览器无法运行它的人。这仅取决于您的需求。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-08-18T06:44:43.470

jQuery 用于操作 HTML DOM 并以更简单的方式执行复杂的任务（如查找控件、动画等）...... jQuery 与 Silverlight 完全不同。Silverlight 是一种客户端 UI 语言，类似于 Java Applets、Adobe Flex 等。

如果您正在为 Silverlight 寻找类似的工具（如 jQuery），请尝试**[XamlQuery](http://xamlquery.codeplex.com/)**。您可以使用 XamlQuery 操作 Silverlight DOM 并执行可以使用 jQuery 执行的大部分任务。但请记住，**jQuery 用于 JavaScript**，而**XamlQuery 用于 Silverlight**。

# c# - 在 C# 中记录错误

> ID：147557
> 
> 赞同：73
> 
> 时间：2008-09-29T04:53:55.007
> 
> 标签：c#, error-reporting, error-logging

我正在从 C++ 编码切换到 C#。我需要用 C# 中类似的东西替换我的 C++ 错误记录/报告宏系统。

在我的 C++ 源代码中，我可以编写

LOGERR("一些错误"); 或 LOGERR("输入 %s 和 %d 出错", stringvar, intvar);

然后，宏和支持库代码将（可能是可变参数）格式化的消息连同源文件、源行、用户名和时间一起传递到数据库中。相同的数据也被填充到数据结构中，以便以后向用户报告。

是否有人有 C# 代码片段或指向执行此基本错误报告/记录的示例的指针？

**编辑：** 当我问这个问题时，我对 .NET 真的很陌生，并且不知道 System.Diagnostics.Trace。System.Diagnostics.Trace 是我当时所需要的。从那以后，我在日志记录要求更大、更复杂的项目中使用了 log4net。只需编辑那个 500 行的 XML 配置文件，log4net 就会做你需要的一切:)

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-09-29T09:41:56.560

这里有很多 log4net 拥护者，所以我相信这会被忽略，但我会添加自己的偏好：

```
System.Diagnostics.Trace 
```

这包括侦听您的`Trace()`方法的侦听器，然后写入日志文件/输出窗口/事件日志，框架中包含的侦听`DefaultTraceListener`器`TextWriterTraceListener`是`EventLogTraceListener`. 它允许您指定级别（警告、错误、信息）和类别。

[MSDN 上的跟踪类在](http://msdn.microsoft.com/en-us/library/system.diagnostics.trace.aspx)
[Web 应用程序](https://stackoverflow.com/questions/286060/what-do-i-need-to-change-to-alllow-my-iis7-asp-net-3-5-application-to-create-an/7848414#7848414)
[UdpTraceListener 中写入事件日志 - 将与 log4net 兼容的 XML 消息写入日志查看器，例如 log2console](http://www.anotherchris.net/log4net/udptracelistener-a-udp-tracelistener-compatible-with-log4netlog4j/)

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-09-29T04:59:22.793

我强烈建议您查看[log4Net](http://logging.apache.org/log4net/)。这篇[文章](https://mitchwheat.com/2007/04/29/log4net-net-logging-tool/)涵盖了您入门所需的大部分内容。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-29T09:38:50.593

另一个不错的日志库是[NLog](http://www.nlog-project.org/)，它可以记录到很多不同的地方，例如文件、数据库、事件记录器等。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-02-08T04:17:04.940

我使用[The Object Guy 的日志框架](http://www.theobjectguy.com/dotnetlog)——大多数尝试过它的人也是如此。这家伙对此有一些有趣的[评论](http://blog.rantingsandravings.com/2009/02/logging-frameworks.html)。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-29T05:08:41.897

[Enterprise Library](http://www.codeplex.com/entlib)是[log4net](http://logging.apache.org/log4net/)的可靠替代品，它还提供了许多其他功能（缓存、异常处理、验证等）。我几乎在我构建的每个项目中都使用它。

强烈推荐。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-29T04:59:15.947

尽管我个人讨厌它，但[log4net](http://logging.apache.org/log4net/index.html)似乎是 C# 日志记录的事实标准。示例用法：

```
log4net.ILog log = log4net.LogManager.GetLogger(typeof(Program));
log.Error(“Some error”);
log.ErrorFormat("Error with inputs {0} and {1}", stringvar, intvar); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-08-11T01:35:07.913

正如我在另一个线程中所说，我们已经在多个生产应用程序中使用[The Object Guy 的日志框架](http://www.theobjectguy.com/dotnetlog)好几年了。它非常易于使用和扩展。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-29T05:00:53.663

[Log4Net](http://logging.apache.org/log4net/)是一个相当全面的日志框架，它允许您记录到不同的级别（调试、错误、致命）并将这些日志语句输出到可能不同的地方（滚动文件、Web 服务、Windows 错误）

我可以通过创建记录器的实例轻松地在任何地方记录

```
private static readonly ILog _log = LogManager.GetLogger(typeof([Class Name])); 
```

然后记录错误。

```
_log.Error("Error messsage", ex); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-03-22T21:52:48.110

[Serilog](http://serilog.net)在这里聚会迟到了，但带来了一些有趣的选择。它看起来很像使用经典的基于文本的记录器：

```
Log.Information("Hello, {0}", username); 
```

但是，与早期的框架不同，它仅在写入文本时将消息和参数呈现为字符串，例如写入文件或控制台。

这个想法是，如果您使用“NoSQL”风格的日志数据存储，您可以记录以下事件：

```
{
    Timestamp: "2014-02-....",
    Message: "Hello, nblumhardt",
    Properties:
    {
        "0": "nblumhardt"
    }
} 
```

扩展了 .NET 格式字符串语法，因此您可以将上面的示例编写为：

```
Log.Information("Hello, {Name}", username); 
```

在这种情况下，将调用属性`Name`（而不是`0`），从而使查询和关联更容易。

已经有一些不错的存储选择。MongoDB 和 Azure Table Storage 似乎很受 DIY 的欢迎。我最初构建了 Serilog（尽管它是一个社区项目），现在我正在开发一个名为[Seq](http://getseq.net)的产品，它提供对这些类型的结构化日志事件的存储和查询。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-29T15:24:04.150

您可以使用内置的 .NET 日志记录。查看 TraceSource 和 TraceListeners，它们可以在 .config 文件中进行配置。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-29T05:35:46.917

同样适用于 log4net。我添加了我的两位，因为对于实际使用，查看一些开源实现以查看带有一些方便添加的真实世界代码示例是有意义的。对于 log4net，我建议不经意间查看[subtext](http://subtextproject.com/)。特别看一下应用程序启动和组装信息位。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-29T13:01:57.203

除了关于使用 System.Diagnostics 方法进行日志记录的几条评论之外，我还想指出[DebugView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)工具非常适合在需要时检查调试输出 - 除非您需要它，否则不需要要生成日志文件的应用程序，您只需在需要时启动 DebugView。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-09-28T19:56:05.293

System.Diagnostics 中的内置跟踪在 .NET Framework 中很好，我在许多应用程序中使用它。但是，我仍然使用 log4net 的主要原因之一是内置的 .NET Framework 跟踪缺少 log4net 已经内置的许多有用的全功能附加程序。

例如，除了 VB.NET dll 中的一个，实际上并没有在 .NET Framework 中定义一个好的滚动文件跟踪侦听器，它确实不是所有功能。

根据您的开发环境，我建议使用 log4net，除非 3rd 方工具不可用，然后我会说使用 System.Diagnostics 跟踪类。如果你真的需要一个更好的 appender/tracelistener，你总是可以自己实现它。

例如，我们的许多客户要求我们在安装在他们的公司机器上时不要使用开源库，因此在这种情况下，.NET Framework 跟踪类非常适合。

此外 - [http://www.postsharp.org/](http://www.postsharp.org/)是我正在研究的 AOP 库，它也可能有助于记录，如代码项目中所示：http: [//www.codeproject.com/KB/dotnet/log4postsharp-介绍.aspx](http://www.codeproject.com/KB/dotnet/log4postsharp-intro.aspx)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-07-01T13:14:12.440

[ExceptionLess](https://exceptionless.com/)是可用于日志记录的最简单的 nuget 包之一。它是一个[开源](https://github.com/exceptionless/Exceptionless)项目。它会自动处理未处理的异常，并提供[手动日志](https://github.com/exceptionless/Exceptionless.Net/wiki/Sending-Events)选项。您可以登录到本地服务器上的在线或[自我主机。](https://github.com/exceptionless/Exceptionless/wiki/Self-Hosting)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-29T14:58:11.013

正如其他人所说，Log4Net 相当普遍，并且类似于 Log4j，如果您使用过任何 Java，它将为您提供帮助。

您还可以选择使用日志记录应用程序块[http://www.codeproject.com/KB/architecture/GetStartedLoggingBlock.aspx](http://www.codeproject.com/KB/architecture/GetStartedLoggingBlock.aspx)

# command-line - Win XP 中命令行实用程序的代理

> ID：147558
> 
> 赞同：2
> 
> 时间：2008-09-29T04:54:01.667
> 
> 标签：command-line, proxy, windows-xp, telnet, ping

如何让命令行实用程序（如 ping）使用 Windows XP 中的默认代理。

proxycfg -u 可以将代理设置为默认 (IE) 代理，但它似乎不起作用。

**更新**：我在代理后面，想要一种方法来检查站点是否启动，因此尝试使用 ping！还想要一种远程登录（不使用 Putty）到特定站点和端口以检查连接性的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T04:57:45.450

代理通常用于 Web (HTTP) 流量，ping 使用 ICMP，这是一个完全独立的协议。什么，你到底想做什么？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T10:18:41.560

So, standard ping doesn't go via an HTTP proxy, as everyone's already mentioned. What you probably want is to tunnel your TCP connections (e.g., HTTP, telnet, ssh) via your HTTP proxy using the CONNECT method. For instance, using netcat (telnet will also work, but netcat's better) you'll do the following:

```
$ nc yourproxy 3128
CONNECT yourtelnetserver:23 HTTP/1.0 
```

then press enter twice.

There are also tools that can do this for you. Keep in mind that some HTTP proxies are configured to allow CONNECT connections only to certain destinations, for example, to port 443 ony (for TLS/SSL/HTTPS).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T04:58:56.897

Ping 不使用 TCP - 它使用 ICMP，因此使用代理没有任何意义。

您是否想到了另一个命令行实用程序？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T05:53:27.423

您最好的选择可能是 Windows 的命令行浏览器。

您可以尝试[lynx](http://pachome1.pacific.net.sg/~kennethkwok/lynx/)，它几乎是一个完整的浏览器，或者您可以使用更简单的东西并使用[wget](http://gnuwin32.sourceforge.net/packages/wget.htm)。我会推荐 wget 自己。

这两个程序都有一些配置代理的方法，Linux 和 Windows 版本的文档应该是相同的。

# language-design - Adobe Acrobat 9 是如何制作的？

> ID：147565
> 
> 赞同：2
> 
> 时间：2008-09-29T04:55:51.757
> 
> 标签：language-design, acrobat

谁能说出 Adob​​e Acrobat 9 是如何制作的？我喜欢 GUI 的外观和感觉，我很好奇它是如何制作的。具体来说，使用什么编程语言来制作它？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T05:13:05.147

Adobe 的所有主要产品都是用 C++ 编写的。尽管它们大多是使用专有工具包编写的，但 Adob​​e 实际上已经开源了一些常见的低级库。[您可以在Adob​​e 的软件和技术实验室 (STLab)](http://stlab.adobe.com/)阅读有关它们的更多信息并自行下载。我发现他们的其中一个库[Adam 和 Eve](http://stlab.adobe.com/group__asl__overview.html#asl_overview_adam_and_eve_architecture)特别有趣且通常很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T05:07:51.743

我相信它是使用 Evil 框架用 C++ 编写的。

# c++ - 下面的代码会导致c ++中的内存泄漏吗

> ID：147572
> 
> 赞同：20
> 
> 时间：2008-09-29T04:58:34.183
> 
> 标签：c++, exception, memory-leaks, constructor

```
class someclass {};

class base
{
    int a;
    int *pint;
    someclass objsomeclass;
    someclass* psomeclass;
public:
    base()
    {
        objsomeclass = someclass();
        psomeclass = new someclass();
        pint = new int(); 
        throw "constructor failed";
        a = 43;
    }
}

int main()
{
    base temp();
} 
```

在上面的代码中，构造函数抛出。哪些对象会被泄露，如何避免内存泄露？

```
int main()
{
    base *temp = new base();
} 
```

在上面的代码中怎么样？构造函数抛出后如何避免内存泄漏？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-29T05:04:45.167

是的，它会泄漏内存。当构造函数抛出时，不会调用析构函数（在这种情况下，您不会显示释放动态分配对象的析构函数，但假设您有一个）。

这是使用智能指针的主要原因——因为智能指针是成熟的对象，它们将在异常堆栈展开期间调用析构函数并有机会释放内存。

如果你使用类似 Boost 的 scoped_ptr<> 模板，你的类可能看起来更像：

```
class base{
    int a;
    scoped_ptr<int> pint;
    someclass objsomeclass;
    scoped_ptr<someclass> psomeclass;
    base() : 
       pint( new int),
       objsomeclass( someclass()),
       psomeclass( new someclass())

    {
        throw "constructor failed";
        a = 43;
    }
} 
```

而且你不会有内存泄漏（默认的 dtor 也会清理动态内存分配）。

* * *

总结一下（希望这也能回答关于

```
base* temp = new base(); 
```

陈述）：

当在构造函数中抛出异常时，在正确处理对象的中止构造中可能发生的资源分配方面，您应该注意几件事：

1.  将**不会**调用正在构造的对象的析构函数。
2.  该对象的类中包含的成员对象的析构函数将被调用
3.  正在构造的对象的内存将被释放。

这意味着如果您的对象拥有资源，您有 2 个方法可用于清理那些在构造函数抛出时可能已经获取的资源：

1.  捕获异常，释放资源，然后重新抛出。这可能很难纠正，并且可能成为维护问题。
2.  使用对象来管理资源生命周期 (RAII) 并将这些对象用作成员。当对象的构造函数抛出异常时，成员对象将调用析构函数，并有机会释放它们负责其生命周期的资源。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T05:03:27.340

两个新的都将被泄露。

将堆创建对象的地址分配给**命名**的智能指针，以便在抛出异常时调用的智能指针析构函数中将其删除 - ( [RAII](http://en.wikipedia.org/wiki/RAII) )。

```
class base {
    int a;
    boost::shared_ptr<int> pint;
    someclass objsomeclass;
    boost::shared_ptr<someclass> psomeclass;

    base() :
        objsomeclass( someclass() ),
        boost::shared_ptr<someclass> psomeclass( new someclass() ),
        boost::shared_ptr<int> pint( new int() )
    {
        throw "constructor failed";
        a = 43;
    }
}; 
```

现在，当在构造函数中抛出异常时堆栈展开时，将调用*psomeclass*和*pint析构函数，并且这些析构函数将释放分配的内存。*

```
int main(){
    base *temp = new base();
} 
```

对于使用 (non-plcaement) new 的普通内存分配，如果构造函数抛出异常，则由 operator new 分配的内存会自动释放。至于为什么要释放单个成员（响应对 Mike B 的回答的评论），自动释放仅适用于在新分配的对象的构造函数中引发异常时，而不是在其他情况下。此外，释放的内存是为对象成员分配的内存，而不是您可能在构造函数内部分配的任何内存。即它会释放成员变量*a*、*pint*、*objsomeclass*和*psomeclass*的内存，但不会释放从*new someclass()*和*new int()*分配的内存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-28T12:32:13.673

我相信最佳答案是错误的，并且仍然会泄漏内存。*如果构造函数抛出异常，则不会*调用类成员的析构函数（因为它从未完成初始化，并且可能某些成员从未到达其构造函数调用）。它们的析构函数仅在类的析构函数调用期间被调用。这才有意义。

这个简单的程序演示了它。

```
#include <stdio.h>

class A
{
    int x;

public:
    A(int x) : x(x) { printf("A constructor [%d]\n", x); }
    ~A() { printf("A destructor [%d]\n", x); }
};

class B
{
    A a1;
    A a2;

public:
    B()
    :   a1(3),
        a2(5)
    {
        printf("B constructor\n");
        throw "failed";
    }
    ~B() { printf("B destructor\n"); }
};

int main()
{
    B b;

    return 0;
} 
```

使用以下输出（使用 g++ 4.5.2）：

```
A constructor [3]
A constructor [5]
B constructor
terminate called after throwing an instance of 'char const*'
Aborted 
```

如果您的构造函数中途失败，那么您有责任处理它。更糟糕的是，异常可能会从您的基类的构造函数中抛出！处理这些情况的方法是使用“函数尝试块”（但即便如此，您也必须仔细编写部分初始化对象的销毁代码）。

解决问题的正确方法是这样的：

```
#include <stdio.h>

class A
{
    int x;

public:
    A(int x) : x(x) { printf("A constructor [%d]\n", x); }
    ~A() { printf("A destructor [%d]\n", x); }
};

class B
{
    A * a1;
    A * a2;

public:
    B()
    try  // <--- Notice this change
    :   a1(NULL),
        a2(NULL)
    {
        printf("B constructor\n");
        a1 = new A(3);
        throw "fail";
        a2 = new A(5);
    }
    catch ( ... ) {   // <--- Notice this change
        printf("B Cleanup\n");
        delete a2;  // It's ok if it's NULL.
        delete a1;  // It's ok if it's NULL.
    }

    ~B() { printf("B destructor\n"); }
};

int main()
{
    B b;

    return 0;
} 
```

如果您运行它，您将获得预期的输出，其中只有分配的对象被销毁和释放。

```
B constructor
A constructor [3]
B Cleanup
A destructor [3]
terminate called after throwing an instance of 'char const*'
Aborted 
```

如果您愿意，您仍然可以使用智能共享指针来解决它，并进行额外的复制。编写类似这样的构造函数：

```
class C
{
    std::shared_ptr<someclass> a1;
    std::shared_ptr<someclass> a2;

public:
    C()
    {
        std::shared_ptr<someclass> new_a1(new someclass());
        std::shared_ptr<someclass> new_a2(new someclass());

        // You will reach here only if both allocations succeeded. Exception will free them both since they were allocated as automatic variables on the stack.
        a1 = new_a1;
        a2 = new_a2;
    }
} 
```

祝你好运，茨维。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T05:01:20.417

是的，该代码会泄漏内存。引发异常时，不会释放使用“new”分配的内存块。[这是RAII](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)背后的部分动机。

为避免内存泄漏，请尝试以下操作：

```
psomeclass = NULL;
pint = NULL;
/* So on for any pointers you allocate */

try {
    objsomeclass = someclass();
    psomeclass = new someclass();
    pint = new int(); 
    throw "constructor failed";
    a = 43;
 }
 catch (...)
 {
     delete psomeclass;
     delete pint;
     throw;
 } 
```

* * *

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T05:02:39.290

如果你在构造函数中抛出，你应该清理在调用 throw 之前的所有内容。如果您使用继承或抛出析构函数，您真的不应该这样做。这种行为很奇怪（没有我的标准，但它可能是未定义的？）。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-29T05:00:12.993

您“新”的所有内容都需要删除，否则会导致内存泄漏。所以这两行：

```
psomeclass = new someclass();
pint = new int(); 
```

会导致内存泄漏，因为你需要这样做：

```
delete pint;
delete psomeclass; 
```

在 finally 块中以避免它们被泄露。

另外，这一行：

```
base temp = base(); 
```

是不必要的。你只需要这样做：

```
base temp; 
```

添加“= base()”是不必要的。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-09-29T05:19:34.070

您需要删除 psomeclass ...不需要清理整数...

[温迪](http://www.rwendi.com)

# c# - 确定窗口是否处于帮助模式

> ID：147583
> 
> 赞同：3
> 
> 时间：2008-09-29T05:00:40.030
> 
> 标签：c#, .net, winforms

开发 .NET WinForms 应用程序：如何检查窗口是否处于帮助模式（即单击标题栏中的“？”按钮后）？

我遇到的问题是我的 System.Windows.Forms.ToolStripItem 对象没有 HelpRequested 事件（因为它们没有从 Control 继承）所以在 Click 事件处理程序中，我试图确定窗口当前是否处于帮助模式所以我可以以编程方式弹出一个工具提示。

任何帮助都将受到赞赏！谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T05:06:02.560

我相信[Form.HelpButtonClicked](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.helpbuttonclicked.aspx)事件是您想要的，因为它在您的命名空间中。

# javascript - 引号字符串列表的正则表达式匹配 - 不带引号

> ID：147626
> 
> 赞同：10
> 
> 时间：2008-09-29T05:24:35.557
> 
> 标签：javascript, regex, actionscript-3

在 Javascript 中，以下内容：

```
var test = '"the quick" "brown fox" "jumps over" "the lazy dog"';
var result = test.match(/".*?"/g);
alert(result); 
```

产生 "the quick","brown fox","jumps over","the lazy dog"

我希望每个匹配的元素不被引用：快速、棕色的狐狸、跳过、懒惰的狗

什么正则表达式会这样做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T05:55:10.553

这似乎有效：

```
var test = '"the quick" "brown fox" "jumps over" "the lazy dog"';
var result = test.match(/[^"]+(?=(" ")|"$)/g);
alert(result); 
```

注意：这不匹配空元素（即“”）。此外，它不适用于不支持 JavaScript 1.5 的浏览器（前瞻是 1.5 的功能）。

有关详细信息，请参阅[http://www.javascriptkit.com/javatutors/redev2.shtml](http://www.javascriptkit.com/javatutors/redev2.shtml)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T05:56:38.973

它不是一个正则表达式，而是两个更简单的正则表达式。

```
var test = '"the quick" "brown fox" "jumps over" "the lazy dog"';

var result = test.match(/".*?"/g);
// ["the quick","brown fox","jumps over","the lazy dog"]

result.map(function(el) { return el.replace(/^"|"$/g, ""); });
// [the quick,brown fox,jumps over,the lazy dog] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T13:30:27.837

葡萄水果的回答也有效。我会使用大卫的变体

```
match(/[^"]+(?=("\s*")|"$)/g) 
```

因为它可以正确处理字符串之间的任意数量的空白和制表符，这正是我所需要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T05:36:36.167

您可以使用[Javascript replace() 方法](http://www.w3schools.com/jsref/jsref_replace.asp)将它们删除。

```
var test = '"the quick" "brown fox" "jumps over" "the lazy dog"';

var result = test.replace(/"/, ''); 
```

除了摆脱双引号之外，还有更多的功能吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T09:49:39.647

这是我将在 actionscript3 中使用的：

```
var test:String = '"the quick" "brown fox" "jumps over" "the lazy dog"';
var result:Array = test.match(/(?<=^"| ").*?(?=" |"$)/g);
for each(var str:String in result){
    trace(str);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-01-26T07:35:43.337

> 用于匹配单引号和双引号之间的内容，处理转义的。

由于搜索引擎首先将我带到了这里，我真的很想将希望检查引号对的人引导到更通用的问题：[https](https://stackoverflow.com/a/41867753/2012407) ://stackoverflow.com/a/41867753/2012407 。

正则表达式将获得格式正确的引号对之间的完整内容`'"What\'s up?"'`，例如不在代码注释中的引号，例如`// Comment.`or `/* Comment. */`。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-29T05:37:18.333

这是一种方法：

```
var test = '"the quick" "brown fox" "jumps over" "the lazy dog"';
var result = test.replace(/"(.*?)"/g, "$1");
alert(result); 
```

# python - Django VMware 设备

> ID：147627
> 
> 赞同：4
> 
> 时间：2008-09-29T05:25:00.830
> 
> 标签：python, django, vmware

有人知道 Django 1.0 + postgresql + apache + mod_python VMware 设备吗？可以手动安装 postgresql 的“香草”Django 1.0 设备也可以。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T06:11:05.243

[在Elastic Server On-Demand](https://elasticserver.com/)配置和构建您的设备。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-09T04:33:13.837

我取得了一定成功的另一个选择

[TurnKey Linux Django 设备](http://www.turnkeylinux.org/appliances/django)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-07-27T15:07:12.283

除了建议的其他设备外，您可能还想看看我们的[BitNami Django Stack](http://bitnami.org/stack/djangostack) VMWare 设备。

它是完全免费的，我们会保持更新，通常在每个新的 Django 发布后的几个小时内。特别是，它包括 mod_wsgi，因为 mod_python 已经有一段时间没有更新了。您可能想要检查的另一件事是[Django Amazon Cloud Image](http://bitnami.org/stack/djangostack#cloudImage)。与亚马逊免费套餐一起，您可以免费拥有自己的托管 Django（在带宽等方面有一些限制）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T06:51:08.547

对于您的要求来说，它可能有点过于繁重，但所有这些项目（以及更多）都包含在[Python Web Developer Appliance](http://www.vmware.com/appliances/directory/289)中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T17:08:15.850

Poulsenj 说得对，[Elastic Server On-Demand](http://es.cohesiveft.com/) ( [Django Elastic Server Site](http://es.cohesiveft.com/site/django) ) 是在几分钟内配置和下载免费自定义 Django VMware 映像的好地方。

Elastic Server 平台允许您通过从流行的软件堆栈库中选择组件来组装自定义服务器。组装后，这些自定义应用程序堆栈可以配置为各种虚拟化和云就绪格式，实时下载和部署。

# javascript - 检测用户何时离开网页的最佳方法？

> ID：147636
> 
> 赞同：217
> 
> 时间：2008-09-29T05:30:46.383
> 
> 标签：javascript

检测用户是否离开网页的最佳方法是什么？

`onunload`JavaScript 事件并非每次都起作用（HTTP 请求花费的时间比终止浏览器所需的时间长）。

创建一个可能会被当前的浏览器阻止。

* * *

## 回答 #1

> 赞同：233
> 
> 时间：2008-09-29T07:02:06.493

试试这个`onbeforeunload`事件：它在页面被卸载之前被触发。它还允许您询问用户是否真的想离开。请参阅演示*[onbeforeunload Demo](http://www.4guysfromrolla.com/demos/OnBeforeUnloadDemo1.htm)*。

或者，您可以在他离开时发送[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)请求。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-05-05T06:30:55.750

[Mozilla 开发者网络对onbeforeunload](https://developer.mozilla.org/en/DOM/window.onbeforeunload)有很好的描述和示例。

如果您想在页面脏了（即如果用户输入了一些数据）离开页面之前警告用户：

```
window.addEventListener('beforeunload', function(e) {
  var myPageIsDirty = ...; //you implement this logic...
  if(myPageIsDirty) {
    //following two lines will cause the browser to ask the user if they
    //want to leave. The text of this dialog is controlled by the browser.
    e.preventDefault(); //per the standard
    e.returnValue = ''; //required for Chrome
  }
  //else: user is allowed to leave without a warning dialog
}); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2017-07-15T14:52:29.183

这是另一种解决方案 - 因为在大多数浏览器中，导航控件（导航栏、选项卡等）位于页面内容区域的*上方*，您可以检测到鼠标指针通过顶部离开页面并显示“*在您离开之前*”对话。它完全不引人注目*，*它允许您在用户实际执行离开操作*之前*与他们进行交互。

```
$(document).bind("mouseleave", function(e) {
    if (e.pageY - $(window).scrollTop() <= 1) {    
        $('#BeforeYouLeaveDiv').show();
    }
}); 
```

缺点是当然这是用户实际打算离开的*猜测*，但在绝大多数情况下它是正确的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-09-05T12:30:23.943

感谢[Service Workers](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers) ，如果浏览器支持的话，可以在客户端实现类似于[Adam 的解决方案。](https://stackoverflow.com/a/57188812/1080079)只是绕过心跳请求：

```
// The delay should be longer than the heartbeat by a significant enough amount that there won't be false positives
const liveTimeoutDelay = 10000
let liveTimeout = null

global.self.addEventListener('fetch', event => {
  clearTimeout(liveTimeout)
  liveTimeout = setTimeout(() => {
    console.log('User left page')
    // handle page leave
  }, liveTimeoutDelay)
  // Forward any events except for hearbeat events
  if (event.request.url.endsWith('/heartbeat')) {
    event.respondWith(
      new global.Response('Still here')
    )
  }
}) 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2020-04-01T06:39:08.880

**如果您需要执行一些异步代码**（例如向服务器发送一条消息，表明用户现在没有关注您的页面），该事件`beforeunload`不会给异步代码运行时间。在异步的情况下，我发现`visibilitychange`和`mouseleave`事件是最好的选择。这些事件在用户更改选项卡、隐藏浏览器或将课程移出窗口范围时触发。

```
document.addEventListener('mouseleave', e=>{
     //do some async code
})

document.addEventListener('visibilitychange', e=>{
     if (document.visibilityState === 'visible') {
   //report that user is in focus
    } else {
     //report that user is out of focus
    }  
})
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-04-10T15:50:37.837

我知道这个问题已经得到解答，但如果您只想在实际 BROWSER 关闭时触发某些东西，而不仅仅是在页面加载发生时，您可以使用以下代码：

```
window.onbeforeunload = function (e) {
        if ((window.event.clientY < 0)) {
            //window.localStorage.clear();
            //alert("Y coords: " + window.event.clientY)
        }
}; 
```

在我的示例中，我正在清除本地存储并使用鼠标 y 坐标提醒用户，仅当浏览器关闭时，这将在程序内的所有页面加载中被忽略。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T05:33:51.633

一种（有点笨拙）的方法是使用 AJAX 调用到服务器端来替换和链接离开您的站点的链接，指示用户正在离开，然后使用相同的 javascript 块将用户带到他们的外部站点已要求。

当然，如果用户只是关闭浏览器窗口或输入新的 URL，这将不起作用。

为了解决这个问题，您可能需要在页面上使用 Javascript 的 setTimeout()，每隔几秒进行一次 AJAX 调用（取决于您想知道用户是否离开的速度）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-02-11T19:17:19.657

您可以做的是在页面加载时打开[WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API)连接，可选择通过标识当前用户的 WebSocket 发送数据，并检查该连接何时在服务器上关闭。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-07-24T18:01:34.407

对于它的价值，这就是我所做的，即使文章很旧，它也可能对其他人有所帮助。

PHP：

```
session_start();

$_SESSION['ipaddress'] = $_SERVER['REMOTE_ADDR'];

if(isset($_SESSION['userID'])){
    if(!strpos($_SESSION['activeID'], '-')){
        $_SESSION['activeID'] = $_SESSION['userID'].'-'.$_SESSION['activeID'];
    }
}elseif(!isset($_SESSION['activeID'])){
    $_SESSION['activeID'] = time();
} 
```

JS

```
window.setInterval(function(){
            var userid = '<?php echo $_SESSION['activeID']; ?>';
            var ipaddress = '<?php echo $_SESSION['ipaddress']; ?>';
            var action = 'data';

            $.ajax({
                url:'activeUser.php',
                method:'POST',
                data:{action:action,userid:userid,ipaddress:ipaddress},
                success:function(response){
                     //alert(response);                 
                }
            });
          }, 5000); 
```

对 activeUser.php 的 Ajax 调用

```
if(isset($_POST['action'])){
    if(isset($_POST['userid'])){
        $stamp = time();
        $activeid = $_POST['userid'];
        $ip = $_POST['ipaddress'];

        $query = "SELECT stamp FROM activeusers WHERE activeid = '".$activeid."' LIMIT 1";
        $results = RUNSIMPLEDB($query);

        if($results->num_rows > 0){
            $query = "UPDATE activeusers SET stamp = '$stamp' WHERE activeid = '".$activeid."' AND ip = '$ip' LIMIT 1";
            RUNSIMPLEDB($query);
        }else{
            $query = "INSERT INTO activeusers (activeid,stamp,ip)
                    VALUES ('".$activeid."','$stamp','$ip')";
            RUNSIMPLEDB($query);
        }
    }
} 
```

数据库：

```
CREATE TABLE `activeusers` (
  `id` int(11) NOT NULL,
  `activeid` varchar(20) NOT NULL,
  `stamp` int(11) NOT NULL,
  `ip` text
) ENGINE=MyISAM DEFAULT CHARSET=utf8; 
```

基本上每 5 秒，js 将发布到一个 php 文件，该文件将跟踪用户和用户的 IP 地址。活动用户只是在 5 秒内更新数据库时间戳的数据库记录。老用户停止更新数据库。ip 地址仅用于确保用户是唯一的，因此网站上的 2 个人不会同时注册为 1 个用户。

可能不是最有效的解决方案，但它可以完成工作。

# linux - XFCE4 的窗口快捷方式

> ID：147642
> 
> 赞同：3
> 
> 时间：2008-09-29T05:35:32.910
> 
> 标签：linux, x11, window-managers, xfce

这本身不是一个编程问题，但这肯定会有助于提高我的编程效率。

在 KDE 中，可以为特定窗口分配快捷方式。这完全消除了 alt-tabbing，并且在打开多个应用程序（浏览器、控制台、emacs 等）时非常方便。我的问题是 - 可以在 XFCE4 中分配窗口快捷方式吗？如果是，如何？我最近从 KDE4 切换到 XFCE，希望能对此提供任何帮助。

TIA。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-14T14:49:15.587

我正在使用 xdotool。例如下面的命令将 Firefox 移动到前台：

```
xdotool search --onlyvisible --name 'Mozilla Firefox' windowraise 
```

您可以使用所需参数更新键盘设置（应用程序菜单 -> 设置 -> 设置管理器 -> 键盘）：

![在此处输入图像描述](https://i.stack.imgur.com/6ZE2E.png)

# c# - .NET 泛型中重载运算符约束的解决方案

> ID：147646
> 
> 赞同：37
> 
> 时间：2008-09-29T05:37:19.317
> 
> 标签：c#, generics, operator-overloading, constraints

如果我想要一个只接受重载运算符的类型的泛型方法，例如减法运算符，我会怎么做。我尝试使用接口作为约束，但接口不能有运算符重载。

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-29T05:46:02.743

没有立即的答案；运算符是静态的，不能在约束中表示 - 现有的原语不实现任何特定的接口（与可用于模拟大于/小于的 IComparable[<T>] 形成对比）。

然而; 如果你只是想让它工作，那么在 .NET 3.5 中有一些选项......

[我在这里](http://www.yoda.arachsys.com/csharp/miscutil/usage/genericoperators.html)整理了一个库，允许使用泛型高效且简单地访问运算符 - 例如：

```
T result = Operator.Add(first, second); // implicit <T>; here 
```

它可以作为[MiscUtil的一部分下载](http://www.yoda.arachsys.com/csharp/miscutil/)

此外，在 C# 4.0 中，这可以通过以下方式实现`dynamic`：

```
static T Add<T>(T x, T y) {
    dynamic dx = x, dy = y;
    return dx + dy;
} 
```

我也（在某一时刻）有一个 .NET 2.0 版本，但测试较少。另一种选择是创建一个界面，例如

```
interface ICalc<T>
{
    T Add(T,T)() 
    T Subtract(T,T)()
} 
```

等等，但是您需要`ICalc<T>;`通过所有方法，这会变得混乱。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-06-26T00:00:34.900

我发现 IL 实际上可以很好地处理这个问题。前任。

```
ldarg.0
ldarg.1
add
ret 
```

在泛型方法中编译，只要指定了原始类型，代码就可以正常运行。可以扩展它以在非原始类型上调用运算符函数。

见[这里](http://graphicsnut.blogspot.com/2011/06/solution-to-generic-arithmetic.html)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2015-08-18T14:09:45.263

有一段代码是从我经常使用的内部人员那里偷来的。`IL`它使用基本的算术运算符查找或构建。这一切都在一个`Operation<T>`泛型类中完成，您所要做的就是将所需的操作分配给一个委托。喜欢`add = Operation<double>.Add`。

它是这样使用的：

```
public struct MyPoint
{
    public readonly double x, y;
    public MyPoint(double x, double y) { this.x=x; this.y=y; }
    // User types must have defined operators
    public static MyPoint operator+(MyPoint a, MyPoint b)
    {
        return new MyPoint(a.x+b.x, a.y+b.y);
    }
}
class Program
{
    // Sample generic method using Operation<T>
    public static T DoubleIt<T>(T a)
    {
        Func<T, T, T> add=Operation<T>.Add;
        return add(a, a);
    }

    // Example of using generic math
    static void Main(string[] args)
    {
        var x=DoubleIt(1);              //add integers, x=2
        var y=DoubleIt(Math.PI);        //add doubles, y=6.2831853071795862
        MyPoint P=new MyPoint(x, y);
        var Q=DoubleIt(P);              //add user types, Q=(4.0,12.566370614359172)

        var s=DoubleIt("ABC");          //concatenate strings, s="ABCABC"
    }
} 
```

`Operation<T>`源代码由粘贴箱提供：http: [//pastebin.com/nuqdeY8z](http://pastebin.com/nuqdeY8z)

归属如下：

```
/* Copyright (C) 2007  The Trustees of Indiana University
 *
 * Use, modification and distribution is subject to the Boost Software
 * License, Version 1.0\. (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *  
 * Authors: Douglas Gregor
 *          Andrew Lumsdaine
 *          
 * Url:     http://www.osl.iu.edu/research/mpi.net/svn/
 *
 * This file provides the "Operations" class, which contains common
 * reduction operations such as addition and multiplication for any
 * type.
 *
 * This code was heavily influenced by Keith Farmer's
 *   Operator Overloading with Generics
 * at http://www.codeproject.com/csharp/genericoperators.asp
 *
 * All MPI related code removed by ja72\. 
 */ 
```

# cakephp - CakePHP hasAndBelogsToMany 使用 save() 与 saveAll()

> ID：147649
> 
> 赞同：1
> 
> 时间：2008-09-29T05:40:55.737
> 
> 标签：cakephp, entity-relationship, has-and-belongs-to-many

我正在使用带有 CakePHP 应用程序的非常内在的数据库，到目前为止，我的多模型视图和控制器工作正常。我有一个单数表（`Entity`），它`id`在其他几个表上作为外键`entity_id`

有些表是一对一的关系（比如 a`Company`是一个`Entity`），有些表是一对多的（`Entity`可以有几个`Addresses`）等等。

*我不会/不能更改数据库模型*，所以这就是结构。

我一直在使用`saveAll()`以下输入名称在这些表上保存数据：

```
Entity.type='x' (hidden inside the view)
Company.name
Address.0.street
Address.0.city
Address.1.street
Address.1.city

... and so on ... 
```

而我的拯救就是做所有艰苦的工作`BEGIN TRANSACTION`，所有`INSERT`的和最后的`COMMIT`......

但是现在我创建了`EntityCategory`一个对 n 的关系，并在`HABTM`模型内创建了完整的关系。

当我使用它时它起作用`save()`，但只是`HABTM`关系，当我使用时它会保存一切`saveAll()`（就像以前一样），除了`HABTM`关系。

我错过了什么吗？我如何使它正常工作？我今天使用以下代码：

```
if (!empty($this->data)) {
  $this->Entity->saveAll($this->data);
  $this->Entity->save($this->data);
} 
```

将`saveAll()`所有数据保存在几个表中，保存 id`Entity->id`并`save()`保存`HABTM`关系，但我不确定它是否正确，或者如果我更改某些结构/模型是否会给我带来问题。

这是最好的使用方法吗？有没有一种*正确*的方法可以在 CakePHP 中保存这种关系？您的经验/知识可以告诉我什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T09:19:10.223

如果您下载[每晚](http://cakephp.org/downloads/index/nightly/1.2.x.x)的.

不过要小心，其他东西可能会损坏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T07:14:00.677

saveAll() 和 HABTM 关联的问题是一个已知的 CakePHP[问题](https://trac.cakephp.org/ticket/4389)，并且在 1.2 RC2 中还没有解决。

根据 CakePHP[食谱](http://book.cakephp.org/view/75/Saving-Your-Data#Saving-Related-Model-Data-hasOne-hasMany-belongsTo-84)，保存相关模型数据的最佳实践是：

> “在使用关联模型时，重要的是要意识到保存模型数据应始终由相应的 CakePHP 模型完成。如果您要保存新帖子及其关联的评论，那么您将在保存期间同时使用帖子和评论模型手术。”

但是，使用 saveAll() 和 save() 应该可以工作，恕我直言，这是一个更灵活/通用的解决方案。

# python - 通过 Eclipse 调试 Pylons 应用程序

> ID：147650
> 
> 赞同：11
> 
> 时间：2008-09-29T05:41:00.353
> 
> 标签：python, eclipse, pylons, pydev, pyramid

我使用 PyDev 设置了 Eclipse，并且喜欢能够调试我的脚本/应用程序。我刚刚开始玩 Pylons，想知道是否有办法通过 Eclipse 启动粘贴服务器，以便调试我的 web 应用程序？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T07:03:33.540

创建新的启动配置（Python 运行）

**主选项卡**

使用 paste-script.py 作为主模块（你可以在你的 python 安装目录的 Scripts 子目录中找到它）

不要忘记在 PYTHONPATH 区域中添加应用程序的根文件夹

**参数** 还将基目录设置为根文件夹。

由于程序参数使用“serve development.ini”（或任何你用来调试你的应用程序的东西”）

**常用选项卡**

检查分配控制台并在后台启动

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-01-06T18:47:21.973

如果您不想将 Python 安装包含在项目的工作区中以获取粘贴，则可以创建一个纯 Python 驱动程序，例如：

```
#!/usr/bin/env python

from paste.script.serve import ServeCommand

ServeCommand("serve").run(["development.ini"]) 
```

...并在 Eclipse 中运行/调试它。

注意：这是在没有`--reload`选项的情况下运行的，因此您不会得到热部署（即，您需要重新加载服务器才能看到更改）。或者，您可以添加`--reload`获取热部署的选项，但 Pydev 不会在您的断点处停止。不能吃你的蛋糕也吃...

```
ServeCommand("serve").run(["--reload", "development.ini"]) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-20T13:17:28.813

yanjost 说得对，只是想补充一点，您需要确保不使用 --reload 选项，这将阻止调试器正确附加自身并导致断点无法工作。只是我遇到的一件小事。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-29T00:01:12.273

我可以通过将参数选项卡中的“工作目录”更改为不使用默认值（即选择“其他”->“文件系统”->“你的 Pylons 的根目录”应用程序存储 development.ini 来获得 --reload 工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-02T13:36:44.827

在 Linux 上，可能是 /usr/bin/paster 或 /usr/local/bin/paster 用于粘贴脚本，对于我有的参数：服务 ${workspace_loc}${project_path}/development.ini

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-17T02:14:05.323

我也得到了这个工作（最后）。我使用 buildout 而不是 virtualenv 来安装 pylons（说明位于：[http](http://wiki.pylonshq.com/display/pylonscommunity/Howto+install+Pylons+with+buildout) ://wiki.pylonshq.com/display/pylonscommunity/Howto+install+Pylons+with+buildout ），因此上述说明需要稍作更改随着路径的发展。

- 对于“主模块”，我使用：

```
${workspace_loc:myeclipseprojectname/bin/paster} 
```

（添加 --reload 使断点对我不起作用，我对此进行了几次测试）

-对于“程序参数”，我使用：

```
serve ${workspace_loc:myeclipseprojectname/mypylonsprojectname/development.ini} 
```

-对于“工作目录，其他：”，我使用：

```
${workspace_loc:myeclipseprojectname/mypylonsprojectname} 
```

- 如上所述，在“常用选项卡”中，“检查分配控制台并在后台启动”

- 并记住在尝试之前设置断点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-29T08:34:12.603

这并没有真正回答有关如何在 Eclipse 中执行此操作的问题。但是我一直在用 winpdb 调试 paste 服务器，这是一个非常好的图形化 python 调试器（你可以用 easy_install winpdb 安装它）。

只需启动您的服务器，例如：

```
winpdb /usr/local/bin/paster serve development.ini 
```

然后点击运行按钮。

As wayne said, it's necessary to *not* use --reload option. At least I wasn't able to find how to attach to actual webapp even, when selecting to which forked process debugger should enter (entering different processes can be controlled with "fork parent" and "fork child" debugger commands).

# .net - 如何使 RightToLeftLayout 适用于 GroupBoxes 和 Panels 中的控件？

> ID：147657
> 
> 赞同：5
> 
> 时间：2008-09-29T05:46:31.400
> 
> 标签：.net, winforms, localization

根据 MSDN

```
form.RightToLeftLayout = True;
form.RightToLeft = ifWeWantRTL() ? RightToLeft.True : RightToLeft.False; 
```

足以镜像 RTL 语言的表单内容。

但是控件的放置只对窗体上的控件立即进行mirrowed，
GroupBox 或 Panel 内的控件**不会被 mirrowed**，除非我首先将它们放在 TableLayoutPanel 或 FlowLayoutPanel 上。

在每个 GroupBox 中放置一个 TableLayoutPanel 需要大量手动工作，尤其是重新排列控件（每个表格单元格一个控件、填充、边距等）

有没有一种更简单的方法可以使所有控件的镜像工作？

或者至少，我怎样才能绕过重新排列步骤，因为我们的表格数量是一项相当大的任务？

* * *

**编辑**：默认情况下，窗体上每个控件的 RightToLeft 属性都是继承的，
因此 Panels 和 GroupBoxes 始终具有所需的 RightToLeft 设置。
尽管如此，我尝试以编程方式和设计师为他们重新分配它，但没有帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T09:38:47.457

它确实看到你手上有一个非常讨厌的问题。玩了一段时间，想出了以下几点：

使用一点递归，您可以运行所有控件，并对那些困在 Pannels 和 GroupBoxes 中的控件进行手动 RTL 转换。

这是我拼凑在一起的一个*简短的代码模拟。*我建议你把它放在你的 BaseForm 中（希望你有其中之一）并调用基本表单加载。

```
private void SetRTL (bool setRTL)
{
    ApplyRTL(setRTL, this);
}

private void ApplyRTL(bool yes, Control startControl)
{
    if ((startControl is Panel ) || (startControl is GroupBox))
    {
        foreach (Control control in startControl.Controls)
        {
            control.Location = CalculateRTL(control.Location, startControl.Size, control.Size);
        }
    }

    foreach (Control control in startControl.Controls)
        ApplyRTL(yes, control);
}

private Point CalculateRTL (Point currentPoint, Size parentSize, Size currentSize)
{
    return new Point(parentSize.Width - currentSize.Width - currentPoint.X, currentPoint.Y);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-26T01:41:42.347

我不记得我第一次在哪里看到这个关于覆盖 CreateParams 的提示，但你在这里；）最快、最简单的方法是从 Panel、GroupBox 或 Usercontrol 继承并覆盖 CreateParams 属性

```
 protected override CreateParams CreateParams
    {
        get
        {
            return Control_RTF(base.CreateParams, base.RightToLeft);
        }
    }

    private CreateParams Control_RTF(CreateParams CP, RightToLeft rightToLeft)
    {
        if (rightToLeft == System.Windows.Forms.RightToLeft.Yes)
            CP.ExStyle = ((CP.ExStyle | 0x400000) | 0x100000);
        return CP;
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T08:54:30.013

根据文章 [Visual Studio 2005：开发阿拉伯语 Windows 窗体应用程序](http://www.microsoft.com/middleeast/msdn/WinFormsAndArabic.aspx#_Toc136842131) ，我只剩下两个选择

*   继续在这里和那里添加 TableLayoutPanels
*   重新定位 RTL 上的子控件更改自己

真可惜，它必须是那样的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-03T19:27:58.620

如果您有一个从 Control 派生的包含子控件（如 a `ContainerControl`）的类，则可以添加以下代码以强制所有子控件在父窗体`RightToLeftLayout`设置为 true 和控件设置为`RightToLeft`时进行镜像`RightToLeft.Yes`。

```
protected override CreateParams CreateParams
{
    get
    {
        CreateParams createParams = base.CreateParams;
        Form parent = this.FindForm();
        bool parentRightToLeftLayout = parent != null ? parent.RightToLeftLayout : false;
        if ((this.RightToLeft == RightToLeft.Yes) && parentRightToLeftLayout)
        {
            createParams.ExStyle |= 0x500000; // WS_EX_LAYOUTRTL | WS_EX_NOINHERITLAYOUT
            createParams.ExStyle &= ~0x7000; // WS_EX_RIGHT | WS_EX_RTLREADING | WS_EX_LEFTSCROLLBAR
        }
        return createParams;
    }
}

protected override void OnRightToLeftChanged(EventArgs e)
{
    base.OnRightToLeftChanged(e);
    RecreateHandle();
} 
```

# sql-server - 从 SQL Server 获取数据库列表

> ID：147659
> 
> 赞同：432
> 
> 时间：2008-09-29T05:50:14.077
> 
> 标签：sql-server

如何获取 SQL Server 实例上的可用数据库列表？我打算在 VB.NET 的组合框中列出它们。

* * *

## 回答 #1

> 赞同：695
> 
> 时间：2008-09-29T05:51:08.723

执行：

`SELECT name FROM master.sys.databases`

这是现在的首选方法，而不是`dbo.sysdatabases`已被弃用一段时间的 。

* * *

执行这个查询：

```
SELECT name FROM master.dbo.sysdatabases 
```

或者如果你喜欢

```
EXEC sp_databases 
```

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2011-05-26T13:57:00.603

鉴于非用户数据库的数量不明确，您可能应该添加：

```
WHERE name NOT IN ('master', 'tempdb', 'model', 'msdb'); 
```

并添加报告服务数据库的名称

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2008-09-29T06:28:14.843

要排除系统数据库：

```
SELECT [name]
FROM master.dbo.sysdatabases
WHERE dbid > 6 
```

> 已编辑：2013 年 2 月 5 日下午 2:36

使用准确的 database_id 更新，它应该大于 4，以跳过列出数据库 id 介于 1 和 4 之间的系统数据库。

```
SELECT * 
FROM sys.databases d
WHERE d.database_id > 4 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2011-02-07T14:18:02.327

```
SELECT [name] 
FROM master.dbo.sysdatabases 
WHERE dbid > 4 
```

适用于我们的 SQL Server 2008

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2014-07-18T10:56:47.050

不要混淆，使用下面的简单查询来获取所有数据库，

```
select * from sys.databases 
```

如果您只需要用户定义的数据库；

```
select * from sys.databases WHERE name NOT IN ('master', 'tempdb', 'model', 'msdb'); 
```

一些系统数据库名称是 (resource,distribution,reportservice,reportservicetempdb)，只需将其插入到查询中即可。如果您的机器中默认有上述数据库。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2011-08-07T22:35:07.383

由于您使用的是 .NET，因此您可以使用[SQL Server 管理对象](http://msdn.microsoft.com/en-us/library/ms162169.aspx)

```
Dim server As New Microsoft.SqlServer.Management.Smo.Server("localhost")
For Each db As Database In server.Databases
    Console.WriteLine(db.Name)
Next 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-10-28T06:44:31.823

```
SELECT [name] 
FROM master.dbo.sysdatabases 
WHERE dbid > 4 and [name] <> 'ReportServer' and [name] <> 'ReportServerTempDB' 
```

这适用于两种情况，无论是否启用报告

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-12-11T15:32:02.280

我使用以下[SQL Server 管理对象](http://msdn.microsoft.com/en-us/library/ms162169.aspx)代码来获取不是系统数据库且不是快照的数据库列表。

```
using Microsoft.SqlServer.Management.Smo;

public static string[] GetDatabaseNames( string serverName )
{
   var server = new Server( serverName );
   return ( from Database database in server.Databases 
            where !database.IsSystemObject && !database.IsDatabaseSnapshot
            select database.Name 
          ).ToArray();
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-07-02T11:23:29.610

如果您想省略系统数据库和 ReportServer 表（如果已安装）

```
select DATABASE_NAME = db_name(s_mf.database_id)
from sys.master_files s_mf
where
    s_mf.state = 0 -- ONLINE
    and has_dbaccess(db_name(s_mf.database_id)) = 1
    and db_name(s_mf.database_id) NOT IN ('master', 'tempdb', 'model', 'msdb')
    and db_name(s_mf.database_id) not like 'ReportServer%'
group by s_mf.database_id
order by 1; 
```

这适用于 SQL Server 2008/2012/2014。大多数查询来自“ *sp_databases* ”系统存储过程。我只删除了不需要的列并添加了 where 条件。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-09-13T20:11:34.410

不确定这是否会省略报告服务器数据库，因为我没有运行报告服务器数据库，但据我所知，我可以使用以下 SQL 省略系统用户拥有的数据库：

```
 SELECT  db.[name] as dbname 
    FROM [master].[sys].[databases] db
    LEFT OUTER JOIN  [master].[sys].[sysusers] su on su.sid = db.owner_sid
    WHERE su.sid is null
    order by db.[name] 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-01-28T00:05:09.697

也许我是渡渡鸟！

`show databases;`为我工作。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-07-21T20:56:44.167

在 SQL Server 7 中，dbid 1 到 4 是系统 dbs。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-09-06T12:36:09.537

如果您正在寻找**在 MYSQL 中列出数据库**的命令，那么只需使用以下命令。登陆sql server后，

> ***显示数据库；***

* * *

## 回答 #14

> 赞同：-4
> 
> 时间：2017-02-14T08:00:04.307

排除系统数据库：

```
SELECT name FROM master.dbo.sysdatabases where sid <>0x01 
```

# open-source - 有没有像样的开源游戏机

> ID：147661
> 
> 赞同：9
> 
> 时间：2008-09-29T05:51:07.693
> 
> 标签：open-source

我有一个年轻的侄子，他渴望长大成为一名游戏程序员，我想把他介绍给开源世界，并给他一份甜蜜的礼物。

外面有这样的吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-29T06:10:49.017

嗯，这是一个棘手的问题，因为我们不知道你侄子的水平，更不用说如果没有比初学者更多的工作量就很难制作出非常漂亮的游戏。

## X 游戏站

尽管如此，[André LaMothe 的 X Game Station](http://www.xgamestation.com/)正是您所要求的系统 - 关于如何在资源有限的硬件上开发具有交互式元素和游戏玩法的复杂程序的初学者指南和系统。这几乎是游戏设计师被要求做的事情。

## GP32

GP32也[旨在](http://en.wikipedia.org/wiki/GP32)填补这一空白，但配备了更强大的处理器。继任者从未发布，[公司](http://en.wikipedia.org/wiki/GamePark)很快就破产了，但你仍然可以在 ebay 或围绕原始机器开发的社区中找到一个。

## 谷歌安卓

您也可以考虑使用[Google Android 平台](http://www.developmag.com/news/30566/Android-builds-momentum)。手机游戏现在并将成为未来最大的平台之一。android 的设置并不适合游戏，但它是一个很好的初步近似，不是非常昂贵，并且包含用于高端移动处理器的强大开发工具集。几家大牌游戏开发公司已经承诺支持这个平台，所以它在简历上也会很好看。

*但是作为一个孩子，一台便宜的电脑和一本 VGA 图形书是非常有趣的......*

-亚当

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T07:06:31.147

游戏开发有很多开源平台，如果你去[这里](http://en.wikipedia.org/wiki/List_of_game_engines)有大量的游戏引擎和开发平台。对于编程经验很少的初学者，我建议使用[Game Maker](http://www.yoyogames.com/gamemaker)或[RPG Maker 之](http://tkool.jp/products/rpgxp/eng/)类的游戏引擎，它们是拖放游戏引擎。这两个都是免费的开源游戏引擎。这两个游戏引擎的另一个问题是它们仅限于 2D 游戏，即使 Game Maker 允许您制作类似于 Doom 风格的图形的 FPS。

对于中级或初级程序员，我真诚地建议[Torque](http://www.garagegames.com/)，它同时具有 2D 和 3D 游戏引擎。这个引擎是开源的，但你仍然需要从他们的网站上为编译版本付费。过去我在 Torque 方面取得了很大的成功，尤其是 Torque Game Builder（2D 游戏引擎）。上手并开始制作好看/实用的游戏非常简单。事实上，已经使用 Torque 游戏引擎构建了许多 XBOX 现场游戏，例如 Marble Blast。

另一个我听说过不错但没有机会尝试的开源游戏引擎是[Multiverse](http://www.multiverse.net/index.html)。Multiverse其实是针对MMOG创作的。Multiverse 的好处在于它提供了 3D 游戏环境的创建，但也允许将 Flash 内容集成到游戏世界中。

对于更高级的程序员，我建议研究[SDL](http://www.libsdl.org/)、[OpenGL](http://www.opengl.org/)和[OpenAL](http://connect.creativelabs.com/openal/default.aspx)。这些不是游戏引擎，而是游戏程序员的图形和声音库。这些是完全开源的，可以免费使用。大多数游戏技术将在其软件中实现这些库中的一个或全部。

尽管[XNA](http://creators.xna.com/)不是开源的，但对于更高级的程序员来说，它也是一个很好的起点。它不仅允许创建 XBOX 游戏，还可以为 PC 和 Zune 进行开发。

您可能想向您的侄子建议的另一件事是修改他拥有的现有游戏。大多数 PC 游戏和许多主机游戏都允许对游戏进行某种形式的修改（关卡设计、重写等）。我见过的一些比较流行的游戏引擎是源引擎和虚幻引擎。[MODDB](http://www.moddb.com/tutorials)和[3DBuzz](http://www.3dbuzz.com/vbforum/sv_home.php)上有很多教程（其中也有关于游戏编程和设计其他方面的精彩教程）。

除了我列出的内容之外，我还听说过有关[Ogre3D](http://www.ogre3d.org/)和[Havok](http://www.havok.com/)（许多游戏中使用的物理引擎）的好消息。他还可以访问[IGDA](http://www.igda.org/)、[Gamasutra](http://gamasutra.com/)、[GameDev](http://www.gamedev.net/)、[Game Career Guie](http://gamecareerguide.com/)、[3D Buzz](http://www.3dbuzz.com/vbforum/sv_home.php)等网站，了解有关游戏开发的更多信息。

希望这些信息有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T05:54:43.643

我之前看到一个关于在[Nintendo DS](https://stackoverflow.com/questions/144985/programming-on-a-nintendo-ds)上编程的问题。听起来这可能就是您正在寻找的东西。

另外，我最近读到了[BUG](http://buglabs.net)，它看起来是一个非常酷的平台，可以构建任意数量的手持设备。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T06:15:23.140

您可能对[XGameStation](http://www.xgamestation.com/)感兴趣。这是一个硬件控制台，旨在教授游戏控制台编程。它由 Andre LaMothe 创建，他写了几本关于游戏编程的书。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-13T15:55:47.320

[http://devmaster.net/devdb/engines/sylphis-3d#general-overview](http://devmaster.net/devdb/engines/sylphis-3d#general-overview)看起来不错，面向 c/c++，GPL 许可，免费。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T06:03:24.933

在 NintendoDS 上进行良好的编程是可能的，但是你会在那里打破和延伸相当多的法律。

但是，我应该说，当我回到学校时，我学到了我所做的关于硬件的大部分工作。我从做这类事情中学到了很多；）但我不会向年轻人或新手推荐它，因为你会完全失去支持（很多挫折），可能会破坏你的游戏机，除非你已经知道编程学习曲线太高了。

我可以推荐在控制台编程之前从 Flash 或 PC 游戏开始吗？

编辑：当我的意思是打破/延伸法律时，我并不是说为你的硬件编写代码，这取决于你。但购买盗版存储卡和写卡器（违反专利法）是违法的。此外，资助硬件盗版不太可能是值得骄傲的事情。

编辑：@Mike F 你读过我的帖子吗？我说，我在学生时代就做过这个，我学到了很多东西。但这仍然是盗版，是的，当我还是个穷学生的时候，我做了我应得的盗版，但我不想教刚接触编程的人。你会？

此外，还有很多非常棒的方法可以学习游戏编程，而无需破解 RPGMaker、XNA 等内容……

@Mike F：再一次，NDS flash-rom 是通过专利盗版（/侵权）而不是软件盗版生产的，因为生产此类硬件是非法的，因为它违反了专利法。而制造这种闪存硬件的公司是盗版公司，他们在灰色市场上贩卖他们的商品，就这么简单。我在这里根本不是在谈论“软件盗版”。这就是为什么我已经两次提到任何人都可以自由地在他们的硬件上运行任何软件，无论是自制软件还是其他软件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T06:09:36.510

好吧，这不是完全开源的（编辑器不是，引擎是），但我推荐 RPG Maker VX（如果他喜欢角色扮演游戏）：

[http://tkool.jp/products/rpgvx/eng/index.html](http://tkool.jp/products/rpgvx/eng/index.html)

我已经使用这个（和早期版本）有一段时间了。这很好，因为有一个很棒的编辑器和事件系统，无需编写任何代码就可以教授基本的编程概念。一旦您的侄子想要编写一些真正的代码，就有一个用 ruby​​ 编写的完整 API (RGSS2)，他可以自由地操作和扩展。这个 API 构成了游戏引擎的大部分，只隐藏了低级实现的东西。

还有其他程序，例如 GameMaker，但 RPG Maker 是最用户友好的，同时仍然提供了一种获取更高级内容的方法。

编辑：我忘了提到最好的部分之一；RPG Maker 周围有一个庞大而活跃的社区。有许多完全致力于该计划的论坛，人们很乐意帮助完成最基本的任务，更不用说可用的大量资源了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T06:11:47.410

我会在 Nintendo DS 推荐中排名第三——拿一个 R4“自制”墨盒，你就已经准备好了。

另一个想法是独立手持设备之一——类似于[GP32](http://en.wikipedia.org/wiki/GP32)，尽管市场上肯定有更新的设备。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T06:20:31.227

我相信这有点像篮球，从靠近篮筐的地方开始，然后通过练习打出三分球。

在我看来，游戏编程是 3pt，如果没有学会正确投篮，你可能会作弊并开始抛球，或者只是将球扔到篮板上，希望它能够进入。

如果你有一个不能正确投篮中距离篮筐的年轻人，你认为他能够激励自己继续尝试，而不是在他有信心的时候尝试更接近球门的东西并在外线工作吗？

如果你的侄子对学习编程很认真，给他买一本 python 书或 vb.net/c# 书。也许他会因为这些语言而对应用程序开发更感兴趣（我就是这种情况，我 14 岁）。:)

编辑：这是假设他没有太多的编程经验。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T04:04:00.920

Ars Technica 刚刚发布了[一篇](http://arstechnica.com/news.ars/post/20081001-pandora-targeting-wiz-in-open-source-gaming-handheld-war.html)关于开源游戏机的文章。它们是手持设备，所以我不知道这是否是个问题，但它们看起来相当不错，有很多功能需要修改。

# c# - 为什么 regasm.exe 使用错误的 GUID 注册我的 c# 程序集？

> ID：147669
> 
> 赞同：11
> 
> 时间：2008-09-29T05:56:51.080
> 
> 标签：c#, .net, delphi, com, regasm

我有 ac# 程序集，我通过 COM 从 Delphi（win32 本机）应用程序中调用它。

这适用于我测试过的所有机器，除了一台。

问题是 Delphi 应用程序在尝试创建 COM 对象时得到“类未注册”。

现在，当我查看注册表时`HKEY_CLASSES_ROOT\DelphiToCSharp\CLSID`，那里列出的 GUID 与 AssemblyInfo.cs 中的程序集 Guid 不同。它应该是相同的 - 在安装它的所有其他计算机上都是相同的。

我试过`regasm /unregister delphitocsharp.dll`了，这会删除注册表项。然后，如果我这样做`regasm delphitocsharp.dll`，注册表项会返回，但 GUID 与以前相同（即错误），并且 Delphi 仍然得到“类未注册”。

工作机器上的 DelphiToCSharp.dll 与非工作机器上的版本相同（使用 md5 验证）。

我能想到的只是之前注册了旧版本的 dll，并且仍然存在该文件的一些残留物，这让 regasm 感到困惑。

我该如何解决或至少进一步诊断此问题？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T07:13:04.097

AssemblyInfo 中的 GUID 成为“类型库”GUID，通常不是您想要的。我将假设您正在尝试访问一个类，并且您需要为该类定义一个 Guid 属性和 ComVisible。例如：

```
[Guid("00001111-2222-3333-4444-555566667777"), ComVisible(true)]    
public class MyCOMRegisteredClass 
```

如果你不这样做，那么类 a) 将不会被注册，或者 b) 如果你已经在程序集级别定义了 COMVisible(true)，则将被分配一个 .NET 为你烘焙的 guid。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T06:41:55.807

也许您在某处有旧版本的程序集？也许在 GAC 中？Regasm 可能正在接受并使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T07:02:06.057

很可能您在系统某处有相同（旧版本）dll 的副本，在磁盘上搜索相同文件的副本并在注册新副本之前手动删除（备份）它们。

# sql - 获取 SQL 服务器组中可用服务器的列表

> ID：147670
> 
> 赞同：3
> 
> 时间：2008-09-29T05:57:03.357
> 
> 标签：sql, vb.net

如何提取 SQL 服务器组中可用的 SQL 服务器列表？我打算将该列表放在 VB.NET 的组合框中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T06:04:56.473

我知道的唯一方法是使用命令行：

```
osql -L 
```

但是我发现下面的文章似乎可以解决您填充组合框的特定目标：

[http://www.sqldbtips.com/showarticle.asp?ID=45](http://www.sqldbatips.com/showarticle.asp?ID=45)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T19:38:22.390

如果您不想绑定到[Ben 的文章](https://stackoverflow.com/a/147680/7444103)使用的 SQL SMO，您可以执行以下操作来发现网络上的所有 SQL 服务器：

```
Private Sub cmbServer_DropDown(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbServer.DropDown
    Dim oTable As Data.DataTable
    Dim lstServers As List(Of String)
    Try
        If cmbServer.Items.Count = 0 Then
            System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.WaitCursor
            oTable = System.Data.Sql.SqlDataSourceEnumerator.Instance.GetDataSources

            For Each oRow As DataRow In oTable.Rows
                If oRow("InstanceName").ToString = "" Then
                    cmbServer.Items.Add(oRow("ServerName"))
                Else
                    cmbServer.Items.Add(oRow("ServerName").ToString & "\" & oRow("InstanceName").ToString)
                End If
            Next oRow
        End If
    Catch ex As Exception
        ErrHandler("frmLogin", "cmbServer_DropDown", ex.Source, ex.Message, Ex.InnerException)
    Finally
        System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.Default

        If oTable IsNot Nothing Then
            oTable.Dispose()
        End If
    End Try
End Sub 
```

[SqlDataSourceEnumerator](https://docs.microsoft.com/en-us/dotnet/api/system.data.sql.sqldatasourceenumerator)类很不错，因为它可以让您直接从 2.0 框架中发现 SQL 服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T06:19:22.773

在 C# 中，我使用了对 odbc32.dll 的调用

例如：

```
[DllImport("odbc32.dll", CharSet = CharSet.Ansi)]

private static extern short SQLBrowseConnect(
IntPtr hconn, StringBuilder inString,
short inStringLength, StringBuilder outString, short outStringLength, out short 
outLengthNeeded); 
```

该功能的文档在[MSDN上](http://msdn.microsoft.com/en-us/library/ms130926.aspx)

# ruby-on-rails - 将 JRuby on Rails 应用程序部署到 Tomcat 的最佳方式是什么？

> ID：147671
> 
> 赞同：10
> 
> 时间：2008-09-29T05:58:39.437
> 
> 标签：ruby-on-rails, ruby, tomcat, jruby, capistrano

我正在寻找将 Ruby on Rails 应用程序（在 JRuby 上运行）部署到 Tomcat 实例以进行测试的方法。

tomcat 实例在我可以通过 SSH 连接到的 Solaris 服务器上运行。我看过使用 Capistrano，但似乎没有很多关于使用它部署到 Tomcat，甚至在 JRuby 下运行它，而且由于 Windows/JRuby 环境，我一直在 Capistrano 中遇到错误我的电脑正在运行（是的，它是公司的——不是我的选择，但我必须忍受它）。

我正在使用 warble 来构建 .war 文件，一旦我手动复制并部署它，应用程序就会部署并运行良好。我想要一些更简单、更自动化的东西来真正实现它。

以前有人做过吗？网络上的文档似乎很薄。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-26T21:23:33.027

我正在使用 JRuby 运行 Rails 项目并部署到 Tomcat 服务器。我选择使用 Capistrano 进行部署，因为它几乎可以自动执行所有操作。为了让它在 Tomcat 上运行，我不得不对 Capistrano 的部署生命周期进行一些小的修改：

第 1 步：在 Capistrano 更新代码后，我创建了一个要在服务器上运行的 warble 任务：

```
desc "Run the warble command to deploy the site"
namespace(:deploy) do
  task :warble do
    run ". ~/.profile;cd #{release_path};warble"
  end
end 
```

并使用以下方法将其连接到 Capistrano 生命周期：

```
after 'deploy:update_code', 'deploy:warble' 
```

我的 Tomcat 服务器有一个符号链接指向`#{release_path}/tmp/war`由 warble 创建的目录。如果您不喜欢这样，您可以轻松修改 warble 任务，将 war 文件移动到 Tomcat 目录中。

第 2 步：我覆盖了`deploy:start`and`deploy:stop`任务，以便它们启动 Tomcat 服务器而不是 Mongrel 服务器：

```
desc "Starts the Tomcat Server"
namespace(:deploy) do
  task :start do
    sudo "#{tomcat_home}/bin/startup.sh"
  end
end

desc "Shutdown the Tomcat Server"
namespace(:deploy) do
  task :stop do
    sudo "#{tomcat_home}/bin/shutdown.sh"
  end
end 
```

我使用 MRI 而不是 JRuby 解释器运行 Capistrano 任务。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T06:31:13.883

我在这方面没有太多经验，所以我不知道我是否可以给你最好的方法，但如果 Capistrano 不起作用，并且你不能单独安装 MRI 来运行它，你有只剩下几个选择：

尝试运行普通 Rake 并编写自己的部署目标： [http ://www.gra2.com/article.php/deploy-ruby-on-rails-applications-rake](http://www.gra2.com/article.php/deploy-ruby-on-rails-applications-rake)

或者使用 Ant 或 Maven。

或者，如果它只是您必须部署到的一台服务器，您可以将两个 Ruby 脚本组合在一起 - 一个在服务器上侦听关闭/启动请求，另一个在本地运行：发送关闭，通过文件 scp，发送启动。

顺便问一下，你有没有向 JRuby 团队提交你在 Capistrano 中发现的任何集成错误？我相信他们会很高兴有任何贡献。:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T07:28:39.267

可能值得一看 'Vlad the deployer'，它将 remote_task 添加到 Rake 允许您在远程服务器上运行任务。然而，就我个人而言，我更喜欢在服务器上有一个标准的 Rake 任务，通过 ssh 进入并运行该任务——然后它会执行 svn 结帐，制作 WAR 文件，无论如何......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T10:11:30.093

我可能会为此使用 Ant。毕竟，它只是另一个 WAR 文件，对吧？我不知道您使用的是哪个版本的 Tomcat，但 4.1x 版本[附带了一个用于部署到 Tomcat 的 Ant 任务](http://raibledesigns.com/rd/entry/deploying_to_tomcat_using_ant)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-07T19:25:59.007

有一些用于部署到 Tomcat 的 Capistrano 配方——我在一个名为[capistrano-tomcat](http://rubygems.org/gems/capistrano-tomcat)的 gem 中构建了一个。它需要您构建的 WAR（可能使用[Warbler](http://caldersphere.rubyforge.org/warbler/)）并在远程服务器上部署和启动 Tomcat 实例。

来源在 Github：http: [//github.com/rhunter/capistrano-tomcat](http://github.com/rhunter/capistrano-tomcat)

# html - 页面在 FF 中工作，而不是在 IE 中，从哪里开始

> ID：147684
> 
> 赞同：3
> 
> 时间：2008-09-29T06:09:50.567
> 
> 标签：html, css, dom

我有一个主要由 DOM 脚本创建的页面，它从几个网络摄像头生成一个图像表（正常的 img 元素）（帮助一个朋友寄养宠物，我的 HTML/DOM 有点生疏）。

它在 FF3 或 Chrome 中运行良好，但在 IE7 中不行，事实上，整个表格在 IE 中不可见（但应用了正文背景色）。

在 IE 中查看页面，没有脚本错误，CSS 似乎应用 OK，DOM 似乎显示了表格中的所有单元格和行，这些都是生成的。

使用 IE 开发工具栏，运行图像报告甚至会显示图像（即使它们没有出现在表格中，并且页面中的表格没有呈现的迹象 - 即使单元格中的文本也没有呈现）

在查看 img 元素并使用跟踪样式功能时，有一次，我看到 img 元素都有 display : none，它说的是内联样式，但我的代码或样式表中没有任何内容可以做到这一点。当我开始为样式表中的每个表格元素添加显式条目时，这个问题似乎已经消失了。

从哪儿开始？

```
body { background-color : gray ; color : white ; margin : 0 ; font-family : Verdana, "lucida console", arial, sans-serif ; }
#CameraPreviewParent { text-align : center ; width : 100% ; }
#CameraTable { text-align : center ; width : 100% ; }
#CameraLiveParent { text-align : center ; margin : 50px ; }
#CameraLiveHeading { color : white ; }
td.CameraCell { text-align : center ; }
img.CameraImage { border : none ; }
a:link, a:visited, a:active, a:hover { text-decoration : none ; color : inherit ; }
table#CameraTable { color : white ; background-color : gray ; }
td.CameraCell { color : white ; background-color : gray ; } 
```

完全删除样式表没有任何效果。

这是生成后页面的代码（对于 DOM 工具栏的格式，我深表歉意——我尝试添加一些换行符以使其更易于阅读）：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML Strict//EN"><META http-equiv="Content-Type" content="text/html; charset=windows-1252">
<HTML>
<HEAD>
<TITLE></TITLE>
<SCRIPT src="cameras.js" type="text/javascript"> </SCRIPT>
<SCRIPT type="text/javascript">
function CallOnLoad() {
document.title = PreviewPageTitle ;         BuildPreview(document.getElementById("CameraPreviewParent")) ;
}
</SCRIPT>
</HEAD>
<BODY>
<!-- Any HTML can go here to modify page content/layout -->
<DIV id="CameraPreviewParent">
<TABLE id="CameraTable" class="CameraTable">
<TR id="CameraRow0" class="CameraRow">
<TD id="CameraCell0" class="CameraCell"><A id="CameraNameLink0" href="http://192.168.4.3:801" class="CameraNameLink">Luxury Suite 1 (1)</A><BR /><A id="CameraLink0" href="camlive.html?camIndex=0" class="CameraLink"><IMG id="CameraImage0" title="Click For Live Video from Luxury Suite 1 (1)" height="0" alt="Click For Live Video from Luxury Suite 1 (1)" src="http://192.168.4.3:801/IMAGE.JPG" width="0" class="CameraImage" /></A></TD>
<TD id="CameraCell1" class="CameraCell"><A id="CameraNameLink1" href="http://192.168.4.3:802" class="CameraNameLink">Luxury Suite 2 (2)</A><BR /><A id="CameraLink1" href="camlive.html?camIndex=1" class="CameraLink"><IMG id="CameraImage1" title="Click For Live Video from Luxury Suite 2 (2)" height="0" alt="Click For Live Video from Luxury Suite 2 (2)" src="http://192.168.4.3:802/IMAGE.JPG" width="0" class="CameraImage" /></A></TD>
</TR>
</TABLE>
</DIV><!-- This element is used to hold the preview -->
<!-- Any HTML can go here to modify page content/layout -->
</BODY>
</HTML> 
```

显然，插入图像宽度和高度的 DOM 代码在 IE 中无法正常工作：

```
var PhotoWidth = 320 ;
var PhotoHeight = 240 ;

var image = document.createElement("img") ;
image.setAttribute("id", "CameraImage" + camIndex) ;
image.setAttribute("class", "CameraImage") ;
image.setAttribute("src", thisCam.ImageURL()) ;
image.setAttribute("width", PhotoWidth) ;
image.setAttribute("height", PhotoHeight) ;
image.setAttribute("alt", thisCam.PreviewAction()) ;
image.setAttribute("title", thisCam.PreviewAction()) ;
link.appendChild(image) ; 
```

**动态构建表格时对 require TBODY 元素的响应似乎是整个问题 - 这似乎甚至将 DOM 中的图像宽度和高度设置为 0！**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T06:21:31.300

我发现的一个问题是，在 IE 中，如果您使用 . 动态创建表`document.createElement()`，则需要`table(tbody(tr(tds)))`. 如果没有`tbody`，表格将不会显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T06:13:25.657

总是让我感到困惑的是 IE 对`<script>`标签的错误处理，当它被使用`<script src="..." />`而不是一个开始标签然后是一个结束`</script>`标签时。我似乎经常遇到这种情况，因为我倾向于使用 XSLT 来生成 HTML 输出。

不过，第一步是在某处发布一个无法正确显示的页面示例。它不必包含任何真实数据，足以显示问题。没有工作示例，没有人能够猜出问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T06:16:17.977

您是否已开始将 CSS 重置为公共基础？看看[CSS Reset](http://meyerweb.com/eric/tools/css/reset/)或[YUI Reset CSS](http://developer.yahoo.com/yui/reset/)。（但没有示例页面可供查看，我们将猜测实际问题是什么。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T06:22:13.623

[探险家曝光！positioniseverything.net 上](http://www.positioniseverything.net/explorer.html)列出了仅在 IE 中发现的错误。

# ruby - 计算 Array::pack 格式字符串的大小

> ID：147693
> 
> 赞同：3
> 
> 时间：2008-09-29T06:16:44.917
> 
> 标签：ruby

如何计算 Array::pack 返回的字符串的长度？有没有像 Python 的 calcsize 这样的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-26T09:42:19.277

array.pack("").count 我会说。不是真正最快的方法，但它有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T06:25:50.993

通过使解释器符合[Array::pack](http://www.ruby-doc.org/core/classes/Array.html#M002245)中的规范。

或者，重用现有实现来计算字符数，而不是将它们附加到字符串中。

# .net - 如何将数据源分配给通用列表集合？

> ID：147703
> 
> 赞同：6
> 
> 时间：2008-09-29T06:25:19.483
> 
> 标签：.net

我有一个通用列表，即`List<myclass>`. 这里`myclass`包含两个字符串属性。

如何将数据源分配给列表集合？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T06:40:56.903

mirmal，我猜英语不是你的第一语言，这个问题不是很清楚。我认为您要问的是您的班级列表，然后您如何将该列表绑定到某些东西（列表框或组合框等）

这是如何执行此操作的简单代码片段...

```
private void button2_Click(object sender, EventArgs e)
{
  List<MyClass> list = new List<MyClass>();
  list.Add(new MyClass() { FirstName = "Tim", Lastname = "Jarvis"});
  list.Add(new MyClass() { FirstName = "John", Lastname = "Doe" });

  listBox1.DataSource = list;
  listBox1.DisplayMember = "FirstName"; // or override MyClass's ToString() method.
} 
```

我希望这已经回答了你的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T06:50:13.650

从一个简单的类开始：

```
 // create a dummy class
    public class MyClass
    {
        private string name;
        public MyClass(string name)
        {
            ItemName = name;
        }
        public string ItemName
        {
            get { return name; }
            set { name = value; }
        }
    } 
```

创建一个绑定列表并将一些类添加到列表中：

```
 // create a binding list
    BindingList<MyClass> my_list = new BindingList<MyClass>();

    // add some clssses to the list
    my_list.Add(new MyClass("Item #1"));
    my_list.Add(new MyClass("Item #2")); 
```

将列表绑定到列表框数据源，指示要在列表框显示中使用哪个类属性：

```
 // make the list the datasource for a listbox
    listBox1.DataSource = my_list;

    // this is the property of the class displayed in the listbox
    listBox1.DisplayMember = "ItemName"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T06:50:55.303

您可以将列表包装到绑定列表中：

```
System.ComponentModel.BindingList<myClass> bindingList = new System.ComponentModel.BindingList<myClass>(originalList); 
```

戈兰

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T06:36:31.360

你不能。那是因为 List 不是 IBindableComponent。Windows 窗体是：请参阅 MSDN[控件类](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T06:45:37.360

您不将数据源分配给`List<>`对象。不过，您可以将 a`List<>`用作用户界面控件的数据源。

如果您想使您可以派生`List<>`并实现[`IBindableComponent`](http://msdn.microsoft.com/en-us/library/system.windows.forms.ibindablecomponent.aspxwindows.forms.ibindablecomponent.aspx)它将允许您提供将数据绑定到列表的机制。这几乎肯定不是实现您想要做的事情的最佳方式。

**编辑：** 如果您有一个控件并且想要检索数据源并且您知道它是一个`List<>`对象，您可以这样做：

```
List<MyClass> lst = listBox1.DataSource as List<MyClass>; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T06:34:21.787

你反其道而行之。像网格等数据绑定对象可以将通用列表设置为其数据源。

您必须手动填充列表或使用为您填充列表的技术（例如，LINQ to SQL、NHibernate）

# iphone - 更改 iPhone 中图像的分辨率？

> ID：147706
> 
> 赞同：0
> 
> 时间：2008-09-29T06:27:53.063
> 
> 标签：iphone, cocoa-touch

我想改变图像的分辨率，这张我从远程位置获得的图像。我得到的图像太大而无法放入 iPhone 屏幕，他们有什么方法可以改变该分辨率吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T17:59:05.150

如果您使用的是 UIImageView，那么 UIView 的 contentMode 就是您所需要的，您可能应该将其设置为 UIViewContentModeScaleAspectFit（或 Interface Builder 中的等效项）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T07:52:54.263

假设您使用某种“视图”来显示图像（而不是自定义绘图），您可能会看到是否有某种属性允许您设置视图的“模式”以允许各种缩放方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T13:47:50.980

如果你渲染它，它无论如何都应该缩放（参见 UIImage::drawInRect） 但是，CGContextDrawImage 会将图像缩放到一个新的上下文中，然后你可以使用它来渲染到屏幕上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T07:01:00.080

如果您希望将 UIImage 实际调整为更小的尺寸，[这篇博文](http://ofcodeandmen.poltras.com/2008/10/30/undocumented-uiimage-resizing/)可能会有所帮助。

# jakarta-ee - 部署ear文件时连接超时

> ID：147708
> 
> 赞同：0
> 
> 时间：2008-09-29T06:29:33.497
> 
> 标签：jakarta-ee

我收到以下错误：

在域中部署应用程序失败；为 jrules-teamserver-SUNAS82 加载部署描述符时出错——连接超时；无法完成请求的操作 加载 jrules-teamserver-SUNAS82 的部署描述符时出错——连接超时

部署 ear 文件时。可能是什么原因连接超时以及如何解决问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T03:14:51.290

您的部署工具可能根本无法连接到应用服务器。它试图建立网络连接，但没有建立连接：在超时后，它给出了错误

你能找出它试图连接到哪个应用服务器 > 吗？

# python - 如何在 Python 中操作位？

> ID：147713
> 
> 赞同：40
> 
> 时间：2008-09-29T06:31:27.423
> 
> 标签：python

例如，在 CI 中，可以将 32 位无符号值中的第 10 位清零，如下所示：

```
unsigned long value = 0xdeadbeef;
value &= ~(1<<10); 
```

我如何在 Python 中做到这一点？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-29T06:45:34.347

Python ints 上的按位运算的工作方式与 C 中的非常相似。Python 中的`&`,`|`​​ 和`^`运算符的工作方式与 C 中的相同。`~`运算符的工作方式与 C 中的有符号整数一样。也就是说，`~x`计算`-x-1`.

你必须小心左移，因为 Python 整数不是固定宽度的。使用位掩码获取低位。例如，做相当于移位 32 位整数的操作`(x << 5) & 0xffffffff`。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-29T06:34:18.277

```
value = 0xdeadbeef
value &= ~(1<<10) 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2018-04-20T13:28:47.333

可以作为示例的一些常见位操作：

```
def get_bit(value, n):
    return ((value >> n & 1) != 0)

def set_bit(value, n):
    return value | (1 << n)

def clear_bit(value, n):
    return value & ~(1 << n) 
```

用法例如

```
>>> get_bit(5, 2)
True
>>> get_bit(5, 1)
False
>>> set_bit(5, 1)
7
>>> clear_bit(5, 2)
1 
>>> clear_bit(7, 2)
3 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T07:04:17.087

您还应该查看[BitArray](http://pypi.python.org/pypi/bitarray/0.2.3)，这是一个处理位序列的好接口。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T06:35:58.037

省略'unsigned long'，也不需要分号：

```
value = 0xDEADBEEF
value &= ~(1<<10)
print value
"0x%08X" % value 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-29T06:36:01.843

Python 具有 C 风格的位操作运算符，因此您的示例在 Python 中实际上是相同的，只是没有类型关键字。

```
value = 0xdeadbeef
value &= ~(1 << 10) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T06:34:41.020

您是否尝试过将代码复制并粘贴到 Python REPL 中以查看会发生什么？

```
>>> value = 0xdeadbeef
>>> value &= ~(1<<10)
>>> hex (value)
'0xdeadbaef' 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-29T20:05:16.733

如果您要进行大量位操作（并且您更关心应用程序的可读性而不是性能），那么您可能需要创建一个整数包装器来启用像 Verilog 或 VHDL 中的切片：

```
导入数学
 类位向量：
     def __init__(self,val):
         self._val = val

     def __setslice__(self,highIndx,lowIndx,newVal):
         断言 math.ceil(math.log(newVal)/math.log(2)) <= (highIndx-lowIndx+1)

         # 清除位片
         clean_mask = (2**(highIndx+1)-1)^(2**(lowIndx)-1)

         self._val = self._val ^ (self._val & clean_mask)
         # 设置新值
         self._val = self._val | (newVal<<lowIndx)

     def __getslice__(self,highIndx,lowIndx):
         返回 (self._val>>lowIndx)&(2L**(highIndx-lowIndx+1)-1)

 b = 位向量(0)
 b[3:0] = 0xD
 b[7:4] = 0xE
 b[11:8] = 0xA
 b[15:12] = 0xD

 对于 xrange(0,16,4) 中的 i：
     打印 '%X'%b[i+3:i]

```

输出：

```
D
 乙
 一种
 D

```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-08-08T09:08:57.350

```
a = int('00001111', 2)
b = int('11110000', 2)
bin(a & b)[2:].zfill(8)
bin(a | b)[2:].zfill(8)
bin(a << 2)[2:].zfill(8)
bin(a >> 2)[2:].zfill(8)
bin(a ^ b)[2:].zfill(8)
int(bin(a | b)[2:].zfill(8), 2) 
```

# html - 用于基于表单的 Web 应用程序的良好 HTML 模板

> ID：147714
> 
> 赞同：2
> 
> 时间：2008-09-29T06:33:04.707
> 
> 标签：html

我想参考专为基于表单的 Web 应用程序设计/开发的 HTML 模板。

我一直在搜索它们，但找不到更好的方法。

问候， 贾坦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T08:40:06.437

这类事情的大部分选择将由您选择的服务器技术/平台来定义，例如，.NET 具有您可以使用的内置小部件，许多 Web 应用程序框架也是如此。

django 管理布局设计得非常好，您可以下载[Django](http://www.djangoproject.com/)并查看它。

[流线型框架](http://streamlinedframework.org/)也为 Rails 实现了类似的形式，更不用说内置的脚手架生成器了。

YUI 框架和 ExtJS 框架一样，有许多具有一致风格的不同小部件，并且与服务器技术无关。这些可以使用 json 作为数据源而不是 html/xml 动态创建

您还可以使用诸如 BlueprintCSS 之类的 CSS 框架，并将其与建议的 HTML 相结合，并添加效果 + 与 jQuery 的交互，并将其构建在您的 html 之上。

修改现有布局并不难，对于一个简单的 CRUD 应用程序，您可能只需要一个用于表单和列表/表格和菜单的大区域。

如果你需要比这更特别的东西，可能是时候投资设计，或者学会自己做。

最简单的布局将是一个带有菜单的标题（可能还有一个标题），以及一个用于表单的内容区域。

* * *

```
<style type="text/css" media="screen">
    div#page { width:900px; margin:0; auto; }
</style>
<body>
    <div id="page">
        <div id="header">
            <!-- Menu Goes Here! -->
        </div>
        <div id="content">
            <!-- Put some Forms n stuff here -->
        </div>
    </div>      
</body> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T07:05:29.200

以下是一些模板设计目录：

*   [开放设计社区](http://www.opendesigns.org/)
*   [开放网页设计](http://www.openwebdesign.org/)
*   [开源网页设计](http://www.oswd.org/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-12T16:23:49.163

我创建了一个，也许你会发现它很有用 => [Web 应用程序管理模板](https://github.com/williamn/web-application-admin-template)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T08:45:37.093

我个人喜欢[ThemeForest](http://themeforest.net/)。他们有很多选择，包括原始标记和 css 脚本，因此您可以立即使您的表单应用程序看起来像模板。

# delphi - Delphi #IF(DEBUG) 等效？

> ID：147719
> 
> 赞同：22
> 
> 时间：2008-09-29T06:34:49.287
> 
> 标签：delphi, compiler-directives

是否有与 C# #if(DEBUG) 编译器指令等效的 Delphi？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-29T06:38:19.687

用这个：

```
{$IFDEF DEBUG}
...
{$ENDIF} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-29T07:54:09.863

除了lassevk所说的之外，您还可以使用其他一些编译器评估方法（我相信从Delphi 6开始）：

```
{$IF NOT DECLARED(SOME_SYMBOL)} 
  // Mind you : The NOT above is optional
{$ELSE}
{$IFEND} 
```

要检查编译器是否具有此功能，请使用：

```
 {$IFDEF CONDITIONALEXPRESSIONS} 
```

这有几种用途。

例如，您可以检查 RTL 的版本；从德尔福帮助：

> 您可以在 $IF 表达式中使用 RTLVersion 来独立于编译器版本级别测试运行时库版本级别。
> 示例：{$IF RTLVersion >= 16.2} ... {$IFEND}

此外，可以再次从代码中检查编译器版本本身：

> CompilerVersion 在编译系统单元时由编译器分配一个值。它指示编译器功能/语言语法的修订级别，可以独立于 RTLVersion 前进。CompilerVersion 可以在 $IF 表达式中进行测试，并且应该使用而不是测试 VERxxx 条件定义。始终测试大于或小于已知修订级别。测试特定的修订级别是个坏主意。

我经常做的另一件事是定义一个尚未定义的符号（对于前向兼容性很好），如下所示：

```
 {$IF NOT DECLARED(UTF8String)}
 type
   UTF8String = type AnsiString;
 {$IFEND} 
```

希望这可以帮助！

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-10-15T14:06:26.760

如果应用程序在 IDE 调试器下运行，则设置 DebugHook。与编译器指令不同，但仍然非常有用。例如：

```
ReportMemoryLeaksOnShutdown := DebugHook <> 0; // show memory leaks when debugging 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T13:36:34.617

这些控制指令可用：

```
{$IFDEF}
{$ELSE}
{$ENDIF}
{$IFNDEF} //if *not* defined 
```

并且可以使用它们，如下所示：

```
procedure TfrmMain.Button1Click(Sender: TObject);
begin
  {$IFDEF MY_CONDITIONAL}
  ShowMessage('my conditional IS defined!');
  {$ELSE}
  ShowMessage('my conditional is NOT defined!');
  {$ENDIF}

  {$IFNDEF MY_CONDITIONAL}
  ShowMessage('My conditional is explicitly NOT defined');
  {$ENDIF}
end; 
```

# .net - 保存安全字符串

> ID：147726
> 
> 赞同：7
> 
> 时间：2008-09-29T06:38:35.817
> 
> 标签：.net, securestring

我对正在开发的程序提出的功能要求之一是能够保存用户输入的凭据列表，以便可以共享它们。激发这个请求的具体用例是在一个大型企业网络上使用我们的程序，该网络由相当好的 LAN 组成，通过一个不稳定的 WAN 连接。我们的想法是，与其让我们的程序在 WAN 宕机时与它对抗，不如发送一个包含严密保护的管理员凭据的“配置”文件，在每个 LAN 中运行它并将结果压缩并通过电子邮件发送背部。

是的。

我最初的直觉是对这个要求嗤之以鼻——保存密码？*真的吗？*当然，公司的网络部门更希望你尝试销售他们拥有的任何 WAN 产品——但事实证明，我使用凭证的其中一个类可以使用 SecureString，而且，注意总是很好可以为人们节省一些精力的方法。这让我想知道：

是否可以保存加密的 SecureString，以便我可以将敏感数据保存到文件并在其他地方打开它？

你有什么想法，堆栈溢出？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T07:06:37.947

SecureString 中没有保存支持，它旨在作为一种保护内存中托管字符串的机制，仅用于与非托管 API 交互。如果密码存储在 System.String 实例中，由于 System.String 的性质，安全性会降低。垃圾收集和实习的存在将使密码在内存中的时间超过必要的时间。此外，由于 .NET 有大量出色的调试工具，即使没有更长的生命周期，通过反射或其他 .NET API 访问字符串也会变得更加容易。

如果您要在磁盘上保存密码，那么您的安全性就会受到很大影响。如果有人可以物理访问机器或管理员级别的远程访问，那么您能做的最好的事情就是让它变得更加困难，但绝不是不可能的。使用加密 API，将其存储在安全位置，配置访问权限。

除此之外，Merus，我建议您尝试改进整个系统，因为对于您所描述的用例（假设我理解它），您最好存储哈希而不是实际密码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T15:23:05.977

您可能想查看比较密码哈希。
您将有一个由用户名和可能其他一些常量组成的盐，然后是字符串。然后，您会将其传递给哈希算法，例如 SHA1*。
例如，

```
using System.Security.Cryptography;

public byte[] GetPasswordHash(string username, string password, string salt)
{
    // get salted byte[] buffer, containing username, password and some (constant) salt
    byte[] buffer;
    using (MemoryStream stream = new MemoryStream())
    using (StreamWriter writer = new StreamWriter(stream))
    {
        writer.Write(salt);
        writer.Write(username);
        writer.Write(password);
        writer.Flush();

        buffer = stream.ToArray();
    }

    // create a hash
    SHA1 sha1 = SHA1.Create();
    return sha1.ComputeHash(buffer);
} 
```

然后，您将比较`GetPasswordHash(username, expectedPassword, salt)`to的结果`GetPasswordHash(username, givenPassword, salt)`。
如果您使用用户名和密码实现自己的用户列表，您可能会考虑只保存哈希 ( `GetPasswordHash(username, givenPassword, salt)`) 并与保存的哈希进行比较。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T06:45:07.423

如果您的意思是保存 SecureString 的加密字节，那么这将不起作用 - SecureString 的密钥与用户和进程相关联。在不同的进程中或为不同的用户读取这些字节，并且无法解密字符串。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T06:47:12.347

这将破坏 SecureString 的点，它保证驻留在内存中。因此，如果您将其保存到文件中，您不妨将其保存为普通字符串，因为它不再“安全”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T06:46:37.217

您可能想看一下[IsolatedStorageFileStream 类](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragefilestream.aspx)。它指定了写入和存储只能由程序集访问的文件数据的方法。

我不认为你可以在上面使用 SecureString 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T06:47:12.143

SecureString 不可序列化，因此您不能仅使用某些交付的序列化程序（二进制、XML 等）保存它

您也不能只从安全字符串对象访问例如“密码”属性，因为没有这样的东西。你必须使用编组和一些管道来做到这一点。如果您想将用户凭据存储在某处，我建议您自己对其进行加密，因为这样可以简化以后的开发。在评估了 SecureString 方法之后，我们决定自己实现一些东西，但这只是我的 2 美分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-07T06:53:50.660

如此处所述，`SecureString`这不是在这种情况下使用的最佳方式。

如果我需要**共享**用户凭据，我可能会共享*用户名*和*hashed + salted 密码*，这样你就安全了，只共享**密码的表示**，而不是它的内容。

简单的方法是例如使用**BCryt 库**（[其中有一个 .NET 表示形式](http://bcrypt.codeplex.com/)）并将用户名和密码表示形式简单地托管在准备好共享的表中

这是你将如何使用它：

```
StringBuilder sb = new StringBuilder();

// run ADO.NET / Entity Framework / etc and query your DB with something like:
"SELECT user_id, username, password FROM [TblUsers];"

// loop through the results

sb.AppendFormat(
       "INSERT INTO [TblSharedUsers] SELECT '{0}','{1}','{2}'",            
           dr["id"], dr["username"],
           BCrypt.HashPassword(dr["password"], BCrypt.GenerateSalt(12));
       );

// then run sb.ToSTring() agains your db 
```

在客户端，您可以创建一个新的（因此当网络不可用时使用[IoC](http://en.wikipedia.org/wiki/Inversion_of_control)和[DI](http://en.wikipedia.org/wiki/Dependency_injection)`AuthenticationProvider`很容易更改）读取并检查用户密码，例如`TblSharedUsers`

```
string userPassword = Request["password"];

"SELECT id, password FROM [TblSharedUsers] WHERE username = @usr;"

if( BCrypt.CheckPassword(userPassword, dr["password"]) )
    // User can log in
else
    // Credentials are invalid 
```

我希望这可以帮助有同样问题的人。

# python - 在 Python 中从文件中读取字符

> ID：147741
> 
> 赞同：115
> 
> 时间：2008-09-29T06:47:47.900
> 
> 标签：python, unicode, encoding, ascii

在文本文件中，有一个字符串“我不喜欢这个”。

然而，当我把它读成一个字符串时，它变成了“我不喜欢这样\xe2\x80\x98t”。我知道 \u2018 是“'”的 unicode 表示。我用

```
f1 = open (file1, "r")
text = f1.read() 
```

命令进行阅读。

现在，是否有可能以这样的方式读取字符串，当它被读入字符串时，它是“我不喜欢这个”，而不是“我不喜欢这个”？

第二次编辑：我看到有人使用映射来解决这个问题，但实际上，没有内置的转换可以将这种 ANSI 转换为 unicode（反之亦然）吗？

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2008-09-29T06:55:23.980

参考：[http ://docs.python.org/howto/unicode](http://docs.python.org/howto/unicode)

*因此，从文件中读取 Unicode 很简单：*

```
import codecs
with codecs.open('unicode.rst', encoding='utf-8') as f:
    for line in f:
        print repr(line) 
```

*也可以在更新模式下打开文件，允许读取和写入：*

```
with codecs.open('test', encoding='utf-8', mode='w+') as f:
    f.write(u'\u4500 blah blah blah\n')
    f.seek(0)
    print repr(f.readline()[:1]) 
```

**编辑**：我假设您的预期目标只是能够将文件正确读入 Python 中的字符串。如果您尝试从 Unicode 转换为 ASCII 字符串，那么实际上没有直接的方法可以这样做，因为 Unicode 字符不一定存在于 ASCII 中。

如果您尝试转换为 ASCII 字符串，请尝试以下操作之一：

1.  如果您只想处理一些特殊情况，例如此特定示例，请用 ASCII 等效项替换特定的 unicode 字符

2.  使用`unicodedata`模块`normalize()`和`string.encode()`方法尽可能转换为下一个最接近的 ASCII 等效项（参考[https://web.archive.org/web/20090228203858/http://techxplorer.com/2006/07/18/converting- unicode-to-ascii-using-python](https://web.archive.org/web/20090228203858/http://techxplorer.com/2006/07/18/converting-unicode-to-ascii-using-python)）：

    ```
    >>> teststr
    u'I don\xe2\x80\x98t like this'
    >>> unicodedata.normalize('NFKD', teststr).encode('ascii', 'ignore')
    'I donat like this' 
    ```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-29T07:15:17.630

有几点需要考虑。

\u2018 字符可能仅作为 Python 中 unicode 字符串表示的片段出现，例如，如果您编写：

```
>>> text = u'‘'
>>> print repr(text)
u'\u2018' 
```

现在，如果您只是想漂亮地打印 unicode 字符串，只需使用 unicode 的`encode`方法：

```
>>> text = u'I don\u2018t like this'
>>> print text.encode('utf-8')
I don‘t like this 
```

为确保任何文件中的每一行都被读取为 unicode，您最好使用该`codecs.open`函数而不是 just `open`，它允许您指定文件的编码：

```
>>> import codecs
>>> f1 = codecs.open(file1, "r", "utf-8")
>>> text = f1.read()
>>> print type(text)
<type 'unicode'>
>>> print text.encode('utf-8')
I don‘t like this 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2018-11-29T22:40:27.287

也可以使用 python 3 读取方法读取编码的文本文件：

```
f = open (file.txt, 'r', encoding='utf-8')
text = f.read()
f.close() 
```

有了这个变体，就不需要导入任何额外的库

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T07:00:40.660

但它确实是“我不喜欢这个”而不是“我不喜欢这个”。字符 u'\u2018' 是一个与 "'" 完全不同的字符（并且，在视觉上，应该更多地对应于 '`'）。

如果您尝试将编码的 unicode 转换为纯 ASCII，您也许可以保留一个您想要转换为 ASCII 的 unicode 标点符号的映射。

```
punctuation = {
  u'\u2018': "'",
  u'\u2019': "'",
}
for src, dest in punctuation.iteritems():
  text = text.replace(src, dest) 
```

但是，在 unicode中有很多[标点符号](http://www.fileformat.info/info/unicode/block/general_punctuation/images.htm)，但我想您只能指望其中的几个实际上被创建您正在阅读的文档的任何应用程序使用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T07:22:21.233

有可能你有一个带有 unicode 转义字符的非 unicode 字符串，例如：

```
>>> print repr(text)
'I don\\u2018t like this' 
```

这实际上发生在我身上一次。您可以使用`unicode_escape`编解码器将字符串解码为 un​​icode，然后将其编码为您想要的任何格式：

```
>>> uni = text.decode('unicode_escape')
>>> print type(uni)
<type 'unicode'>
>>> print uni.encode('utf-8')
I don‘t like this 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T20:10:54.873

撇开您的文本文件损坏（U+2018 是左引号，而不是撇号）这一事实不谈：iconv 可用于将 unicode 字符音译为 ascii。

您必须在谷歌上搜索“iconvcodec”，因为该模块似乎不再受支持，而且我找不到它的规范主页。

```
>>> import iconvcodec
>>> from locale import setlocale, LC_ALL
>>> setlocale(LC_ALL, '')
>>> u'\u2018'.encode('ascii//translit')
"'" 
```

或者，您可以使用`iconv`命令行实用程序来清理您的文件：

```
$ xxd foo
0000000: e280 980a                                ....
$ iconv -t 'ascii//translit' foo | xxd
0000000: 270a                                     '. 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T06:52:53.037

实际上， U+2018 是特殊字符 ' 的 Unicode 表示。如果需要，可以使用以下代码将该字符的实例转换为 U+0027：

```
text = text.replace (u"\u2018", "'") 
```

另外，你用什么来写文件？`f1.read()`应该返回一个如下所示的字符串：

```
'I don\xe2\x80\x98t like this' 
```

如果它返回*此*字符串，则文件写入不正确：

```
'I don\u2018t like this' 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T06:54:22.627

这是 Python 向您展示 unicode 编码字符串的方式。但我认为您应该能够在屏幕上打印字符串或将其写入新文件而不会出现任何问题。

```
>>> test = u"I don\u2018t like this"
>>> test
u'I don\u2018t like this'
>>> print test
I don‘t like this 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-01-02T16:38:52.890

不确定 (errors="ignore") 选项，但它似乎适用于具有奇怪 Unicode 字符的文件。

```
with open(fName, "rb") as fData:
    lines = fData.read().splitlines()
    lines = [line.decode("utf-8", errors="ignore") for line in lines] 
```

# security - 返回“正确”的错误代码，还是保护隐私？

> ID：147747
> 
> 赞同：3
> 
> 时间：2008-09-29T06:51:02.183
> 
> 标签：security, authentication

好的，最好在这里举一个例子来说明我的意思。

想象一个基于 Web 的论坛系统，其中用户身份验证是通过系统知道的某种外部方法完成的。

现在，例如，用户输入他们无权访问的线程的 URL。为此，我应该返回 403（禁止），让用户知道他们应该尝试另一种身份验证方法或 404，而不是让他们知道那里有东西可以访问。

假设我返回 403，当他们访问尚不存在的主题的 URL 时，我是否也应该返回 403？

编辑：上面的例子更像是一个 IRL 的例子。

另一个例子，说我暴露了类似的东西

```
/adminnotes/user 
```

如果有关于用户的管理员注释。现在，返回 403 会让用户知道有人在谈论他们。404 什么也不说。

但是，如果我要返回 403 - 我可以将其返回给 adminnotes/* - 这将解决该问题。

编辑2：另一个例子。这里的软删除问题返回 404。但是，通过正确的身份验证和访问，您仍然可以看到它们（我想）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T06:57:52.383

最重要的是，**遵守 HTTP 规范。**返回 403 代替 404 并不是一件好事。返回 404 代替 403 可能是可以的（或者不是一个大错误），但我**会让软件说出真相**。如果用户只知道一个主题的ID，那也没什么。并且他可以尝试*定时攻击*来确定这个话题是否存在。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T15:48:12.257

我会进行 307 重定向到 NoSuchPageOrNoPermissions.html，在那里您可以很好地告诉用户他们输入错误的 url 或没有权限。

这不会破坏合规性，也不会发出错误的信息。

如果您非常偏执，您可以在返回重定向之前随机等待，这样时间分析会更加困难。

至于这里所有询问为什么保护目录的人，请尝试这些示例

### 1\. 用户名

假设我们是一个 ISP，我们为每个用户提供一个位于 www.isp.example/home/USERNAME 的网页和 USERNAME@isp.example 的电子邮件地址。如果攻击者进行字典攻击，向 www.isp.example/home/[Random] 发送请求并且可以判断这是否是有效用户名，我们现在可以生成有效电子邮件地址列表以出售给坏人。

### 2.什么文件夹

Bob 正在竞选公职，他在海报上有一个帐户，并使用他的网站存储个人信息。但他通过将其设为私有文件夹来保护它，他的公共页面位于：www.example.com/Bob，他的秘密文件夹是 www.example.com/Bob/IceCream，他已将此标记为私有，因此任何请求的人都会收到 403。但是 www.example.com/Bob/Cake 返回 404，因为 Bobs 的秘密是冰淇淋而不是蛋糕。

记者爱丽丝对 Bobs 网站进行字典攻击

*   www.example.com/Bob/Cake - 404
*   www.example.com/Bob/Donuts - 404
*   www.example.com/Bob/Lollies - 404
*   www.example.com/Bob/IceCream - 403

现在爱丽丝知道鲍勃的秘密，并且可以诋毁他是一个吃冰淇淋的人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T15:38:46.953

我认为您应该发送 307（临时重定向）请求“/adminnotes/user”以将非特权客户端重定向到“/adminnotes/”。所以客户端请求“/adminnotes/”，因此你可以发回403，因为它是被禁止的。

这样，您的应用程序将保持 HTTP 兼容，并且非特权用户不会了解太多有关受保护数据的信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T06:56:43.480

通过向用户隐藏特定线程的存在来保护什么“隐私”？

我想说在他们无法访问的线程上返回 403 或 404 是可以的。在不存在的线程上返回 403 是个*坏*主意。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T06:53:56.467

世界上没有一个网站按照你的建议做，所以通过这个例子我们看到最好遵循标准，当资源不存在时返回 404，当资源被禁止时返回 403。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T07:14:10.660

我不明白您为什么担心 URL 的隐私问题。在 stackoverflow 的情况下，您可以在 QuestionID 编号之后放置任何文本。例如，[返回“正确”的错误代码，还是保护隐私？](https://stackoverflow.com/questions/147747/how-is-babby-formed)仍然回到这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-16T04:50:16.070

不要忘记 404 在技术上也可以泄露信息。例如，您可以分辨出谁没有 adminnotes。根据具体情况，这可能与表明资源确实存在一样糟糕。

在我看来，错误不应该说谎。如果您给出 404，则应该始终是资源不存在的情况。

如果您正在处理敏感信息，那么您总是可以说用户没有对该资源的权限。这不一定要求资源存在。客户端甚至可能无权知道资源是否存在。因此，您需要为 /adminnotes/ 的任何组合提供权限被拒绝错误。

也就是说，官方规范似乎不同意，这是官方 rfc 关于[http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)错误的说法：

10.4.4 403 Forbidden 服务器理解请求，但拒绝执行。授权将无济于事，并且不应重复请求。如果请求方法不是 HEAD 并且服务器希望公开请求未完成的原因，它应该在实体中描述拒绝的原因。如果服务器不希望向客户端提供此信息，则可以使用状态代码 404（未找到）来代替。

10.4.5 404 Not Found The server has not found anything matching the Request-URI. No indication is given of whether the condition is temporary or permanent. The 410 (Gone) status code SHOULD be used if the server knows, through some internally configurable mechanism, that an old resource is permanently unavailable and has no forwarding address. This status code is commonly used when the server does not wish to reveal exactly why the request has been refused, or when no other response is applicable.

I'm no expert, but I think it's crappy to give a "not found", when a resource may exist. I'd prefer a "forbidden", without a guarantee that the resource exists, implying that you would need to authenticate somehow in order to find out.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T07:09:44.367

假设当您检测到用户没有正确的访问权限时，您确实返回了“找不到页面”错误。一个具有黑客攻击意图的恶意人员很快就会发现您将返回它来代替拒绝访问。

但是，真正的用户输入错误的网址或使用错误的登录等会感到困惑，并且需要不停地解释和发布说明来向客户、TAC 等解释您的立场。以换取什么？

意图是好的，但我担心你提出的这个政策可能不会如你所愿。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T07:10:00.903

我的建议是：

1.  如果 Not Exists_Thread 则返回 404
2.  如果不是 User_Can_Access_to_this_Thread 则返回 403

# python - 在 Django 中有没有办法将选项显示为复选框？

> ID：147752
> 
> 赞同：50
> 
> 时间：2008-09-29T06:53:13.083
> 
> 标签：python, django

在管理界面和新表单中，有一个出色的助手可以定义选择。你可以使用这样的代码：

```
APPROVAL_CHOICES = (
    ('yes', 'Yes'),
    ('no', 'No'),
    ('cancelled', 'Cancelled'),
)

client_approved = models.CharField(choices=APPROVAL_CHOICES) 
```

在表单中创建一个下拉框并强制用户选择其中一个选项。

我只是想知道是否有一种方法可以定义一组选择，其中可以使用复选框选择多个？（能够说用户可以选择其中的最大数量也很高兴。）这似乎是一个可能已实现的功能，只是我似乎无法在文档中找到它。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-29T07:17:46.533

就表单库而言，您可以使用带有[CheckboxSelectMultiple小部件的](http://docs.djangoproject.com/en/dev/ref/forms/widgets/#django.forms.CheckboxSelectMultiple)[MultipleChoiceField](http://docs.djangoproject.com/en/dev/ref/forms/fields/#multiplechoicefield)字段来执行此操作。您可以通过为该字段编写验证方法来验证所做的选择数量：

```
class MyForm(forms.Form):
    my_field = forms.MultipleChoiceField(choices=SOME_CHOICES, widget=forms.CheckboxSelectMultiple())

    def clean_my_field(self):
        if len(self.cleaned_data['my_field']) > 3:
            raise forms.ValidationError('Select no more than 3.')
        return self.cleaned_data['my_field'] 
```

要在管理应用程序中获取此信息，您需要自定义一个 ModelForm 并[覆盖在适当的 ModelAdmin 中使用的表单](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#adding-custom-validation-to-the-admin)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-11-24T15:29:37.373

@JonnyBuchanan 给出了正确答案。

但是，如果您在 django admin 中为许多模型需要这个，并且您（像我一样）懒得自定义 ModelForm 并覆盖 ModelAdmin 类中的正确方法，您可以使用这种方法：

[http://www.abidibo.net/blog/2013/04/10/convert-select-multiple-widget-checkboxes-django-admin-form/](http://www.abidibo.net/blog/2013/04/10/convert-select-multiple-widget-checkboxes-django-admin-form/)

# user-interface - 如何在 Web 用户界面测试中取得成功？

> ID：147767
> 
> 赞同：3
> 
> 时间：2008-09-29T07:03:28.407
> 
> 标签：user-interface, testing, selenium, automated-tests

我们正在一个大型 Web 应用程序上设置[Selenium测试活动。](http://selenium.openqa.org/)我们做的第一件事是建立一个框架，在测试前初始化数据库中的 SQL 数据，启动测试，归档结果，然后清除数据。

[我们已将其集成到 Maven 2 进程中，由TeamCity](http://www.jetbrains.com/teamcity/)每天在专用数据库上运行。

我们现在已经设置了几个 Selenium 测试，但它没有按计划使用。

原因是测试有时会因为回归以外的其他原因而中断（数据可能已更改，存储过程可能已重新编译等）。

我想知道用户界面测试是否取得了巨大的成功，如果是的话，原因是什么。Commons 错误也可能让我感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T07:36:34.053

如果你想要可靠的单元测试，你需要有相同的输入。数据库的起始状态*是输入*。因此，您每次都需要具有相同的起始数据库。当然，如果您希望使用不同的*输入*进行测试，则需要创建另一个单元测试（因为结果显然不会相同）。

当我做这样的事情时，我总是使用同一个数据库作为起点。当然，有些测试可能会在不修改数据库的情况下失败，这是正确的方法，因此其他一些后续测试也可能会失败，即使它们不会以其他方式失败。如果您的单元测试工具允许，您应该定义测试之间的依赖关系，以确保在“父”测试失败时根本不会运行这些测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:24:55.767

可测试性有很大帮助。Web 应用程序中可测试性的最大优势在于，您需要在页面上与之交互的所有 HTML 元素是否具有**独特且一致的属性**。如果您用来识别 HTML 元素的属性（Selenium 使用 xpath）在构建到构建或会话到会话中不一致/可靠，那么您的测试脚本将失败。此外，这些属性必须是唯一的，以便自动化工具（在本例中为 Selenium）可以可靠地找到网页上的对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T07:30:19.950

我使用 http-unit，它具有在将任何样式添加到页面之前工作的额外好处。

[http://httpunit.sourceforge.net/](http://httpunit.sourceforge.net/) 您可以附加测试以在 maven2 的集成测试阶段运行。

从网站

> 用 Java 编写的 HttpUnit 模拟浏览器行为的相关部分，包括表单提交、JavaScript、基本 http 身份验证、cookie 和自动页面重定向，并允许 Java 测试代码检查返回的页面作为文本、XML DOM 或表单容器、表格和链接。

# mfc - MS VC++ 6 类向导

> ID：147777
> 
> 赞同：2
> 
> 时间：2008-09-29T07:08:11.657
> 
> 标签：mfc, visual-c++-6, classwizard

好的，我正在开发一个在过去 16 年中一直在持续开发的应用程序，从 DOS 中的 C 到各种风格的 C++，现在主要基于 C++，带有 MFC 和 StingRay GUI 以及各种其他 SDK。

虽然我使用 VS 2005 构建发布版本，但我仍然使用 MSVC 6 构建大部分 GUI，因为 ClassWizard 在这种环境中比随后的弱等效工具快得多。请注意，我正在使用 ClassWizard 为我自己的用户定义类型自动生成代码（请参阅[自定义 DDX](http://msdn.microsoft.com/en-us/library/57weza95%28VS.71%29.aspx)），并且我喜欢一次性添加很多成员变量和方法。根据 Visual Studio 的更高版本一次创建一个对我来说是一个很大的倒退。同时，使用多个 IDE 也很痛苦。

我的问题分为两部分；

1.  有什么方法可以让 ClassWizard 工作是 VS 2005 还是 VS 2008？

2.  是否有任何替代 IDE 或替代 IDE 可以为像我这样的旧 C++ hack 提供类似水平的生产力？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T16:40:54.510

对感兴趣的人进行跟进。类向导可能会在 VS2010 中重新引入，来自 Tarek Madkour [VC++ 团队]

> '我们正在考虑将类向导添加回 VS10。我们希望这将使 DDX/DDV 函数创建更加以键盘为中心，就像在 VC6 中一样。我们需要克服一些进度挑战才能完成该功能，但我很乐观，您会在我们发布 VS10 时看到它。

[点击此处查看完整讨论](http://blogs.msdn.com/somasegar/archive/2008/11/21/c-enhancements-in-vs-2010.aspx)

编辑：[VS2010 的发行说明](http://download.microsoft.com/download/C/0/9/C0965791-049B-4200-9008-F07A783026F6/VisualStudio2010_ProductOverview.pdf)确认 MFC 类向导又回来了。因此，与普遍的看法相反，MS 的人确实会倾听他们的用户。

> Visual Studio 2010 提供了 C++ IDE 体验，其中包括 MFC 类向导的返回、通过 Source Outline 查看大型源文件的能力、集成的快速搜索以查找信息而不会混淆当前的“在文件中查找”方法以及轻松通过新的托管可扩展性框架 (MEF) 可扩展 IDE 模型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-28T09:55:06.727

同意 Shane 的观点，vs2008 中的 CW 替代方案非常糟糕；这让你想知道微软是否有人还在使用 MFC。由于 afx/mfc 集成普遍较差，我已经开始提高我的估计值。它还没有完成，那里有很多错误。当然你可以手动输入代码，没有人声称它很难但认真，它的咕噜声，它的 2010 年，你不应该再手动编写这些东西了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T07:17:48.920

我建议完全避免代码生成，并使用您最喜欢的编辑器手动创建新代码。如果我理解正确，您是该领域的专家，并且我确定您知道手动创建的代码将比生成的代码更干净、更简单。
此外，代码生成器是代码审查的噩梦，它改变了无数根本不应该改变的地方，而且很难集中精力进行有意义的改变。
恕我直言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T07:41:25.103

我还建议您将必要的 DDX/DDV（以及消息处理）宏（和成员变量）手动放入您的类中。起初似乎有点难以找出一个人应该如何以及在哪里写条目，但过了一会儿就很容易了。在将 VC6 项目移植到 VS2005 后，我开始这样做，原因与您给出的完全相同：ClassWizard 没有合适的替代品。然而，两年后我可以说我一点也不怀念它了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-07T09:02:00.153

您可以在表单上编写单击控件并添加变量或事件处理程序。它不如VC6，但仍然。我认为手动编写 DDX 没有任何意义。

# parallel-processing - 多核的 MPI？

> ID：147784
> 
> 赞同：25
> 
> 时间：2008-09-29T07:12:30.070
> 
> 标签：parallel-processing, distributed, multicore, multiprocessing, mpi

随着最近关于多核编程的热议，有人在探索使用[MPI](http://www-unix.mcs.anl.gov/mpi/)的可能性吗？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-12-12T16:17:56.223

我在具有多核节点的大型集群上广泛使用了 MPI。我不确定这对于单个多核机器是否正确，但如果您预计您的代码有一天可能会比单个芯片更大，您可能会考虑在 MPI 中实现它。现在，没有什么比 MPI 更大。我不确定提到不可接受的开销的海报来自哪里，但我试图在下面概述相关的权衡。继续阅读以了解更多信息。

MPI 是大规模科学计算的事实标准，并且已经在多核机器上广泛使用。它非常快。看看[最近的 500 强名单](http://top500.org/lists/2008/11)。在某些情况下，该列表中的顶级机器拥有数十万个处理器，具有多插槽双核和四核节点。这些机器中的许多具有非常快速的自定义网络（Torus、Mesh、Tree 等）和感知硬件的优化 MPI 实现。

如果你想在单芯片多核机器上使用 MPI，它会工作得很好。事实上，最新版本的 Mac OS X 预装了[OpenMPI](http://www.open-mpi.org/)，您可以在普通的多核 Linux 机器上轻松下载安装 OpenMPI。[洛斯阿拉莫斯](http://lanl.gov)的大部分系统 都在使用 OpenMPI 。[Livermore](http://llnl.gov)在他们的 Linux 集群上使用[mvapich 。](http://mvapich.cse.ohio-state.edu/)*在深入研究之前你应该记住的是，MPI 是为解决分布式内存*系统上的大规模科学问题而设计的。您正在处理的多核机器可能具有*共享内存*。

OpenMPI 和其他实现默认使用共享内存进行本地消息传递，因此当您将消息传递给本地进程时，您不必担心网络开销。它非常透明，我不确定其他海报从哪里得到他们对高开销的担忧。需要注意的是，MPI 并不是您可以用来在单个多核机器上获得并行性的*最简单的方法。*在 MPI 中，所有消息传递都是显式的。由于这个原因，它被称为并行编程的“汇编语言”。如果您不是经验丰富的[HPC](http://en.wikipedia.org/wiki/High-performance_computing)人员，则进程之间的显式通信并不容易，并且还有其他更适合共享内存的范例（[UPC](http://upc.lbl.gov/)、[OpenMP](http://openmp.org/wp/)、[Erlang](http://www.erlang.org/)仅举几例），您可能会先尝试。

如果您预计编写一个可能需要多台机器来解决的并行应用程序，我的建议是使用 MPI。您将能够使用常规的多核机器进行测试并正常运行，并且一旦您在那里工作，迁移到集群将非常轻松。如果您正在编写一个只需要一台机器的应用程序，请尝试其他方法。有更简单的方法可以利用这种并行性。

最后，如果您真的很喜欢冒险，请尝试将 MPI 与线程、OpenMP 或其他一些本地共享内存范例结合使用。您可以使用 MPI 进行分布式消息传递，并使用其他方式进行节点并行。这就是大型机器的发展方向；未来拥有数十万个或更多处理器的机器预计将具有可扩展到所有*节点*但不是所有内核的 MPI 实现，HPC 人员将被迫构建混合应用程序。这不适合胆小的人，在这个领域有一个公认的范式之前还有很多工作要做。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-17T01:27:59.870

我不得不同意 tgamblin。您可能不得不卷起袖子，真正深入研究使用 MPI 的代码，自己明确地处理消息传递的组织。如果这是您喜欢或不介意做的事情，我希望 MPI 在多核机器上的工作与在分布式集群上一样好。

从个人经验来说……我在研究生院编写了一些 C 代码，以便在每个节点本身都是多核机器的集群上对电生理模型进行大规模建模。因此，我想到了几种不同的并行方法来解决这个问题。

1）我可以单独使用 MPI，将每个处理器视为它自己的“节点”，即使它们中的一些在同一台机器上组合在一起。

2）我可以使用 MPI 来处理多核节点之间的数据移动，然后在每个多核机器中使用线程（POSIX 线程），处理器共享内存。

对于我正在研究的特定数学问题，我首先在一台多核机器上测试了两种公式：一种使用 MPI，另一种使用 POSIX 线程。事实证明，MPI 实现效率更高，双核机器的加速比接近 2，而线程实现的加速为 1.3-1.4。对于 MPI 代码，我能够组织操作，使处理器很少空闲，在它们之间传递消息时保持忙碌，并掩盖传输数据的大部分延迟。使用线程代码，我最终遇到了许多互斥瓶颈，迫使线程经常坐下来等待，而其他线程完成它们的计算。保持线程之间的计算负载平衡似乎无助于这一事实。

这可能仅针对我正在处理的模型，并且对于其他类型的并行问题，线程与 MPI 的有效性可能会有很大差异。尽管如此，我不同意 MPI 的开销很大。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T08:10:33.550

不，在我看来，它不适合您在多核系统上进行的大多数处理。开销太高，你传递的对象必须被深度克隆，传递大对象图然后运行非常小的计算是非常低效的。它实际上是为了在不同的进程之间共享数据，通常在单独的内存空间中运行，并且通常运行长时间的计算。
多核处理器是共享内存机器，因此有更有效的并行处理方法，不涉及复制对象，并且大多数线程运行时间很短。例如，考虑一个多线程快速排序。**使用 MPI 和无限制**分配内存和将数据复制到线程之前，它可以被分区的开销会慢得多**处理器数量比在单个处理器上运行的 Quicksort 多。
例如，在 Java 中，我会使用 BlockingQueue（一种共享内存结构）在线程之间传递对象**引用**，而且开销很小。
并不是说它没有它的位置，例如使用消息传递的谷歌搜索集群。但这可能不是您要解决的问题。**

 *** * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-12T17:02:57.507

MPI 并不是低效的。您需要将问题分解成块并传递块并在每个块的结果完成时重新组织。当每个线程只处理部分问题时，没有人会通过 MPI 传递整个对象。不是接口或设计模式的低效，而是程序员在如何分解问题方面知识的低效。

当您使用锁定机制时，互斥体的开销不能很好地扩展。这是因为下划线的 runqueue 不知道您接下来何时要锁定线程。与消息传递设计模式相比，您将使用互斥锁执行更多的内核级抖动。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T08:29:37.547

MPI 的开销非常大，主要用于处理进程间通信和异构系统。我在传递少量数据并且计算与数据的比率很大的情况下使用它。这不是大多数消费者或业务任务的典型使用场景，无论如何，正如之前的回复所提到的，在像多核机器这样的共享内存架构上，有更快的方法来处理它，比如内存指针。

如果您对上面描述的属性有某种问题，并且希望能够将工作分散到其他机器上，而这些机器必须与您在同一个高速网络上，那么 MPI 可能是有意义的。不过，我很难想象这样的场景。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T09:13:36.397

我个人已经使用了 Erlang（到目前为止我很喜欢）。基于消息的方法似乎适合大多数问题，我认为这将成为多核编程的关键项目之一。我从来不知道 MPI 的开销，感谢您指出

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-12T17:49:19.900

您必须决定是要低级线程还是高级线程。如果您想要低级别，请使用 pThread。您必须小心不要引入竞争条件并使线程性能对您不利。

我使用了一些用于（C 和 C++）的 OSS 包，它们可扩展并优化任务调度。TBB（线程构建块）和 Cilk Plus 非常好，易于编码和获得应用。我也相信他们足够灵活，如果需要，可以在以后将其他线程技术集成到其中（OpenMP 等）

www.threadingbuildingblocks.org www.cilkplus.org

# php - 是否有用于支持 thttpd Web 服务器的 PHP 5 的 SAPI 模块？

> ID：147798
> 
> 赞同：1
> 
> 时间：2008-09-29T07:20:21.190
> 
> 标签：php, sapi, thttpd

是否有用于支持 thttpd Web 服务器的 PHP 5 的 SAPI 模块？奇怪的是，包含在 PHP 5.2.6 源代码中的是 PHP 4.x。

谢谢，肯尼斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T22:00:12.307

PHP 5 附带的 thttpd SAPI 有效。忽略上面写着“PHP 4”的自述文件。

但是，请了解用于 thttpd 的 PHP 是单线程的。当 PHP 正在执行时，所有其他请求都将停止。这对于低流量站点或嵌入式应用程序可能是可以接受的。如果没有，我建议尝试[nginx](http://nginx.net/)，这是另一个通过 FastCGI 在单独进程中运行 PHP 的轻量级 Web 服务器。

# c# - 解析浮点数的最佳方法？

> ID：147801
> 
> 赞同：44
> 
> 时间：2008-09-29T07:23:43.803
> 
> 标签：c#, parsing, floating-point, currentculture

在 CSharp 中解析浮点数的最佳方法是什么？我知道 TryParse，但我特别想知道的是点、逗号等。

我的网站有问题。在我的开发服务器上，“，”代表小数，“。” 为分隔符。但是在产品服务器上，情况正好相反。我怎样才能最好地捕捉到这一点？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-29T07:30:13.773

我同意leppie的回答；用代码来表示：

```
string s = "123,456.789";
float f = float.Parse(s, CultureInfo.InvariantCulture); 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-29T07:31:11.120

取决于输入的来源。

如果您的输入来自用户，您应该使用用户/页面正在使用的 CultureInfo ( [Thread.CurrentThread.CurrentUICulture](http://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture.aspx) )。

您可以通过查看[HttpRequest.UserLanguages](http://msdn.microsoft.com/en-us/library/system.web.httprequest.userlanguages.aspx)属性来获取和指示用户的文化。（不是 100% 正确，但我发现这是一个很好的初步猜测）有了这些信息，您可以在页面开头设置[Thread.CurrentThread.CurrentUICulture 。](http://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture.aspx)

如果您的输入来自内部来源，您可以使用[InvariantCulture](http://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.invariantculture.aspx)来解析字符串。

如果您的输入来自受控源，则 Parse 方法更易于使用。也就是说，您已经验证了字符串。如果失败，Parse 会抛出（慢）异常。

如果输入不受控制，（来自用户或其他 Internet 来源）[TryParse](http://msdn.microsoft.com/en-us/library/system.double.tryparse.aspx)对我来说看起来更好。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-29T07:28:37.927

如果您想为内部目的保留值（数字、日期、时间等）。每次使用“InvariantCulture”来格式化和解析值。“InvariantCulture”在每台计算机上都是相同的，每个操作系统都有任何用户的文化/语言/等等......

```
string strFloat = (15.789f).ToString(System.Globalization.CultureInfo.InvariantInfo);
float numFloat  = float.Parse(System.Globalization.CultureInfo.InvariantInfo, strFloat);
string strNow   = DateTime.Now.ToString(System.Globalization.CultureInfo.InvariantInfo);
DateTime now    = DateTime.Parse(System.Globalization.CultureInfo.InvariantInfo, strNow); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T07:30:45.580

[您总是可以使用Parse](http://msdn.microsoft.com/en-us/library/t9ebt447.aspx)的重载，其中包括要使用的文化？

例如：

```
double number = Double.Parse("42,22", new CultureInfo("nl-NL").NumberFormat); // dutch number formatting 
```

如果您可以控制所有数据，则应在所有代码中使用“CultureInfo.InvariantCulture”。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T07:26:56.697

使用 Try/Parse 解析时使用中性文化（或您知道的文化）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T07:29:42.247

传入一个[CultureInfo](http://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.aspx)或[NumberFormatInfo](http://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.aspx)，它代表您要将浮点数解析为的文化；这控制了用于小数、组分隔符等的字符。

例如确保'.' 字符被视为您可以在 CultureInfo.InvariantCulture 中传递的十进制指示符（这在服务器应用程序中通常非常有用，您倾向于希望事物保持相同而与环境的文化无关）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T07:37:54.643

尽量避免使用 float.Parse，改用 TryParse，因为它的性能要好得多，但工作相同。这也适用于 double、DateTime 等...

（某些类型还提供 TryParseExact，它的性能也更好！）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T07:59:48.250

来源是来自网站的输入。我不能相信它是有效的。因此，如前所述，我选择了 TryParse。但我不知道如何给它 currentCulture。

此外，这会给我它当前运行的服务器的文化，但由于它是万维网，用户可以来自任何地方......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T08:26:20.043

您可以通过一个简单的语句了解您服务器的当前 Cuklture：

```
System.Globalization.CultureInfo culture = System.Globalization.CultureInfo.CurrentCulture; 
```

请注意，有一个 CurrentUICulture 属性，但 UICulture 是从 ResourceMeanager 表单多语言应用程序中使用的。对于数字格式，您必须考虑 CurrentCulture。

我希望这能帮到您

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-03-19T07:20:11.137

一种方法是强制本地化使用点而不是逗号分隔符 - 这样您的代码将在所有 Windows 机器上以相同的方式工作，而与所选语言和设置无关。

这种方法适用于小型应用程序，如测试应用程序、控制台应用程序等。对于使用本地化的应用程序，这不是很有用，但取决于应用程序的要求。

```
var CurrentCultureInfo = new CultureInfo("en", false);
CurrentCultureInfo.NumberFormat.NumberDecimalSeparator = ".";
CurrentCultureInfo.NumberFormat.CurrencyDecimalSeparator = ".";
Thread.CurrentThread.CurrentUICulture = CurrentCultureInfo;
Thread.CurrentThread.CurrentCulture = CurrentCultureInfo;
CultureInfo.DefaultThreadCurrentCulture = CurrentCultureInfo; 
```

此代码强制使用点 ( `'.'`) 而不是逗号，需要在应用程序启动时放置。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-30T08:24:23.260

由于您不了解网络用户的文化，您可以做一些猜测。TryParse 具有使用 , 作为分隔符和 . 对于十进制，并且 TryParse 具有使用 . 用于分隔符， , 用于小数。如果他们都成功但产生不同的答案，那么您将不得不询问用户他们的意图。否则，你可以正常进行，给定两个相等的结果或一个可用的结果或没有可用的结果。

# java - 为什么我的 Java Applet 中的 Swing 在快速鼠标悬停时闪烁？

> ID：147802
> 
> 赞同：2
> 
> 时间：2008-09-29T07:25:14.393
> 
> 标签：java, swing, applet

我制作了一个带有一些标准 GUI 组件的 Java Applet。我使用了[MigLayout](http://www.miglayout.com/)管理器。

如果我将鼠标缓慢移动到各种 GUI 组件上，一切似乎都很好，但如果我快速移动鼠标，它就会闪烁。

是什么让那个讨厌的丑陋重绘？（酷睿 2 双核 6300、2GB 内存、Windows XP）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T08:14:40.967

一种想法是检查您的代码（和/或 MigLayout 代码）是否有不必要的`repaint()`操作。

自定义 UI 和布局有时会导致奇怪的问题......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T08:10:34.567

您可以在 Java 小程序中使用双缓冲来提高屏幕刷新速度。询问更多是否需要详细信息..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T08:26:42.420

我发现了问题：我使用了一个自定义的[ClosableTabbedPaint](http://www.koders.com/java/fidA4A2ADA8513A83E2024E550ADF906CAE16A4EDFB.aspx?s=cdef%3Aaccount)类。

# python - 保留装饰函数的签名

> ID：147816
> 
> 赞同：121
> 
> 时间：2008-09-29T07:32:55.873
> 
> 标签：python, decorator

假设我写了一个装饰器，它做了一些非常通用的事情。例如，它可能会将所有参数转换为特定类型、执行日志记录、实现记忆等。

这是一个例子：

```
def args_as_ints(f):
    def g(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)
    return g

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x*y + 2*z

>>> funny_function("3", 4.0, z="5")
22 
```

到目前为止一切都很好。然而，有一个问题。修饰函数不保留原始函数的文档：

```
>>> help(funny_function)
Help on function g in module __main__:

g(*args, **kwargs) 
```

幸运的是，有一个解决方法：

```
def args_as_ints(f):
    def g(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)
    g.__name__ = f.__name__
    g.__doc__ = f.__doc__
    return g

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x*y + 2*z 
```

这一次，函数名称和文档是正确的：

```
>>> help(funny_function)
Help on function funny_function in module __main__:

funny_function(*args, **kwargs)
    Computes x*y + 2*z 
```

但是还有一个问题：函数签名是错误的。信息“*args, **kwargs”几乎没用。

该怎么办？我可以想到两个简单但有缺陷的解决方法：

1 -- 在文档字符串中包含正确的签名：

```
def funny_function(x, y, z=3):
    """funny_function(x, y, z=3) -- computes x*y + 2*z"""
    return x*y + 2*z 
```

由于重复，这很糟糕。签名仍不会在自动生成的文档中正确显示。更新函数并忘记更改文档字符串或打错字很容易。[*是的，我知道文档字符串已经复制了函数体。请忽略这个；funny_function 只是一个随机的例子。*]

2 -- 不使用装饰器，或为每个特定签名使用专用装饰器：

```
def funny_functions_decorator(f):
    def g(x, y, z=3):
        return f(int(x), int(y), z=int(z))
    g.__name__ = f.__name__
    g.__doc__ = f.__doc__
    return g 
```

这适用于具有相同签名的一组函数，但通常没用。正如我一开始所说，我希望能够完全通用地使用装饰器。

我正在寻找一种完全通用且自动的解决方案。

所以问题是：有没有办法在创建装饰函数签名后对其进行编辑？

否则，我可以编写一个装饰器来提取函数签名并在构造装饰函数时使用该信息而不是“*kwargs，**kwargs”吗？我如何提取这些信息？我应该如何构造装饰函数——使用 exec？

还有其他方法吗？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-09-29T08:08:30.187

1.  安装[装饰器](http://www.phyast.pitt.edu/~micheles/python/documentation.html#the-solution)模块：

    ```
    $ pip install decorator 
    ```

2.  调整 的定义`args_as_ints()`：

    ```
    import decorator

    @decorator.decorator
    def args_as_ints(f, *args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)

    @args_as_ints
    def funny_function(x, y, z=3):
        """Computes x*y + 2*z"""
        return x*y + 2*z

    print funny_function("3", 4.0, z="5")
    # 22
    help(funny_function)
    # Help on function funny_function in module __main__:
    # 
    # funny_function(x, y, z=3)
    #     Computes x*y + 2*z 
    ```

* * *

### Python 3.4+

[`functools.wraps()`自 Python 3.4 以来，stdlib](https://docs.python.org/3/library/functools.html#functools.wraps)保留了签名：

```
import functools

def args_as_ints(func):
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return func(*args, **kwargs)
    return wrapper

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x*y + 2*z

print(funny_function("3", 4.0, z="5"))
# 22
help(funny_function)
# Help on function funny_function in module __main__:
#
# funny_function(x, y, z=3)
#     Computes x*y + 2*z 
```

`functools.wraps()`[至少从 Python 2.5 开始](https://docs.python.org/2.5/lib/module-functools.html)可用，但它不保留那里的签名：

```
help(funny_function)
# Help on function funny_function in module __main__:
#
# funny_function(*args, **kwargs)
#    Computes x*y + 2*z 
```

注意：`*args, **kwargs`而不是`x, y, z=3`.

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2015-07-21T13:31:45.450

这可以通过 Python 的标准库`functools`和专门的[`functools.wraps`](https://docs.python.org/3.5/library/functools.html#functools.wraps)函数来解决，该函数旨在“*更新包装函数以使其看起来像被包装的函数*”。但是，它的行为取决于 Python 版本，如下所示。应用于问题中的示例，代码如下所示：

```
from functools import wraps

def args_as_ints(f):
    @wraps(f) 
    def g(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)
    return g

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x*y + 2*z 
```

在 Python 3 中执行时，这将产生以下结果：

```
>>> funny_function("3", 4.0, z="5")
22
>>> help(funny_function)
Help on function funny_function in module __main__:

funny_function(x, y, z=3)
    Computes x*y + 2*z 
```

它唯一的缺点是在 Python 2 中，它不会更新函数的参数列表。在 Python 2 中执行时，它将产生：

```
>>> help(funny_function)
Help on function funny_function in module __main__:

funny_function(*args, **kwargs)
    Computes x*y + 2*z 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-29T07:49:23.960

您可以使用带有装饰器的[装饰器模块：](http://www.phyast.pitt.edu/~micheles/python/documentation.html)`decorator`

```
@decorator
def args_as_ints(f, *args, **kwargs):
    args = [int(x) for x in args]
    kwargs = dict((k, int(v)) for k, v in kwargs.items())
    return f(*args, **kwargs) 
```

然后保留方法的签名和帮助：

```
>>> help(funny_function)
Help on function funny_function in module __main__:

funny_function(x, y, z=3)
    Computes x*y + 2*z 
```

编辑：JF Sebastian 指出我没有修改`args_as_ints`功能 - 现在已修复。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-29T07:43:19.747

看一下[装饰器](http://www.phyast.pitt.edu/~micheles/python/documentation.html)模块——特别是[装饰](http://www.phyast.pitt.edu/~micheles/python/documentation.html#decorator-is-a-decorator)器装饰器，它解决了这个问题。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-08-28T18:15:30.613

第二种选择：

1.  安装包装模块：

$ easy_install 包装

wrapt 有一个奖励，保留类签名。

```
 import wrapt
import inspect `@wrapt.decorator
def args_as_ints(wrapped, instance, args, kwargs):
    if instance is None:
        if inspect.isclass(wrapped):
            # Decorator was applied to a class.
            return wrapped(*args, **kwargs)
        else:
            # Decorator was applied to a function or staticmethod.
            return wrapped(*args, **kwargs)
    else:
        if inspect.isclass(instance):
            # Decorator was applied to a classmethod.
            return wrapped(*args, **kwargs)
        else:
            # Decorator was applied to an instancemethod.
            return wrapped(*args, **kwargs)

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x * y + 2 * z

>>> funny_function(3, 4, z=5))
# 22

>>> help(funny_function)
Help on function funny_function in module __main__:

funny_function(x, y, z=3)
    Computes x*y + 2*z` 

            回答 #6

赞同：4

时间：2019-03-14T13:29:19.313

正如上面在[jfs 的回答](https://stackoverflow.com/a/147878/7262247)中所评论的那样；如果您关心外观（`help`和`inspect.signature`）方面的签名，那么使用`functools.wraps`非常好。

如果您关心行为方面的签名（特别是`TypeError`在参数不匹配的情况下），请`functools.wraps`不要保留它。你应该使用`decorator`它，或者我对其核心引擎的概括，命名为[`makefun`](https://smarie.github.io/python-makefun/).

```
from makefun import wraps

def args_as_ints(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        print("wrapper executes")
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return func(*args, **kwargs)
    return wrapper

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x*y + 2*z

print(funny_function("3", 4.0, z="5"))
# wrapper executes
# 22

help(funny_function)
# Help on function funny_function in module __main__:
#
# funny_function(x, y, z=3)
#     Computes x*y + 2*z

funny_function(0)  
# observe: no "wrapper executes" is printed! (with functools it would)
# TypeError: funny_function() takes at least 2 arguments (1 given) 
```

另请参阅[这篇关于`functools.wraps`](https://stackoverflow.com/a/55102697/7262247).

            回答 #7

赞同：0

时间：2021-10-04T10:13:33.620

```
def args_as_ints(f):
    def g(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)
    g.__name__ = f.__name__
    g.__doc__ = f.__doc__
    return g 
```

这修复了名称和文档。为了保留函数签名，`wrap`在与`g.__name__ = f.__name__, g.__doc__ = f.__doc__`.
本身就是`wraps`一个装饰器。我们将闭包内部函数传递给该装饰器，它将修复元数据。但是，如果我们只将内部函数传递给`wraps`，它不会知道从哪里复制元数据。它需要知道需要保护哪个函数的元数据。它需要知道原始功能。

```
def args_as_ints(f):
    def g(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)
    g=wraps(f)(g)
    return g 
```

`wraps(f)`将返回一个函数，该函数将`g`作为其参数。这将返回闭包并将分配给`g`然后我们返回它。

            回答 #8

赞同：0

时间：2021-12-13T07:12:51.217

```
from inspect import signature

def args_as_ints(f):
    def g(*args, **kwargs):
        args = [int(x) for x in args]
        kwargs = dict((k, int(v)) for k, v in kwargs.items())
        return f(*args, **kwargs)
    sig = signature(f)
    g.__signature__ = sig
    g.__doc__ = f.__doc__
    g.__annotations__ = f.__annotations__
    g.__name__ = f.__name__
    return g

@args_as_ints
def funny_function(x, y, z=3):
    """Computes x*y + 2*z"""
    return x*y + 2*z

>>> funny_function("3", 4.0, z="5")
22 
```

我想添加那个答案（因为这首先出现在谷歌中）。检查模块能够获取函数的签名，以便可以将其保存在装饰器中。但这还不是全部。如果要修改签名，可以这样做：

```
from inspect import signature, Parameter, _ParameterKind

def foo(a: int, b: int) -> int:
    return a + b

sig = signature(foo)
sig._parameters = dict(sig.parameters)
sig.parameters['c'] = Parameter(
    'c', _ParameterKind.POSITIONAL_OR_KEYWORD, 
    annotation=int
)
foo.__signature__ = sig

>>> help(foo)
Help on function foo in module __main__:

foo(a: int, b: int, c: int) -> int 
```

为什么要改变函数的签名？
有足够的关于你的函数和方法的文档是非常有用的。如果您使用该`*args, **kwargs`语法，然后从 kwargs 弹出参数用于装饰器中的其他用途，则该关键字参数将不会被正确记录，因此会修改函数的签名。

        php - 从 PHP 中加载 .sql 文件

ID：147821

赞同：74

时间：2008-09-29T07:38:09.323

标签：php, sql, mysql, import, scripting

我正在为我正在开发的应用程序创建一个安装脚本，并且需要从 PHP 中动态创建数据库。我有它来创建数据库，但现在我需要加载几个 .sql 文件。我曾计划一次打开文件并 mysql_query 一行 - 直到我查看模式文件并意识到它们不仅仅是每行一个查询。

那么，我如何从 PHP 中加载一个 sql 文件（就像 phpMyAdmin 使用它的 import 命令所做的那样）？

            回答 #1

赞同：79

时间：2011-08-24T16:23:37.407

```
$db = new PDO($dsn, $user, $password);

$sql = file_get_contents('file.sql');

$qr = $db->exec($sql); 
```

            回答 #2

赞同：61

时间：2011-07-07T08:02:40.167

phpBB 使用一些函数来解析他们的文件。他们的评论相当好（多么例外！）所以你可以很容易地知道他们做了什么（我从[http://www.frihost.com/forums/vt-8194.html](http://www.frihost.com/forums/vt-8194.html)得到了这个解决方案）。这是我经常使用的解决方案：

```
<?php
ini_set('memory_limit', '5120M');
set_time_limit ( 0 );
/***************************************************************************
*                             sql_parse.php
*                              -------------------
*     begin                : Thu May 31, 2001
*     copyright            : (C) 2001 The phpBB Group
*     email                : support@phpbb.com
*
*     $Id: sql_parse.php,v 1.8 2002/03/18 23:53:12 psotfx Exp $
*
****************************************************************************/

/***************************************************************************
 *
 *   This program is free software; you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation; either version 2 of the License, or
 *   (at your option) any later version.
 *
 ***************************************************************************/

/***************************************************************************
*
*   These functions are mainly for use in the db_utilities under the admin
*   however in order to make these functions available elsewhere, specifically
*   in the installation phase of phpBB I have seperated out a couple of
*   functions into this file.  JLH
*
\***************************************************************************/

//
// remove_comments will strip the sql comment lines out of an uploaded sql file
// specifically for mssql and postgres type files in the install....
//
function remove_comments(&$output)
{
$lines = explode("\n", $output);
$output = "";

// try to keep mem. use down
$linecount = count($lines);

$in_comment = false;
for($i = 0; $i < $linecount; $i++)
{
    if( preg_match("/^\/\*/", preg_quote($lines[$i])) )
    {
        $in_comment = true;
    }

    if( !$in_comment )
    {
        $output .= $lines[$i] . "\n";
    }

    if( preg_match("/\*\/$/", preg_quote($lines[$i])) )
    {
        $in_comment = false;
    }
}

unset($lines);
return $output;
}

//
// remove_remarks will strip the sql comment lines out of an uploaded sql file
//
function remove_remarks($sql)
{
$lines = explode("\n", $sql);

// try to keep mem. use down
$sql = "";

$linecount = count($lines);
$output = "";

for ($i = 0; $i < $linecount; $i++)
{
    if (($i != ($linecount - 1)) || (strlen($lines[$i]) > 0))
    {
        if (isset($lines[$i][0]) && $lines[$i][0] != "#")
        {
            $output .= $lines[$i] . "\n";
        }
        else
        {
            $output .= "\n";
        }
        // Trading a bit of speed for lower mem. use here.
        $lines[$i] = "";
    }
}

return $output;

}

//
// split_sql_file will split an uploaded sql file into single sql statements.
// Note: expects trim() to have already been run on $sql.
//
function split_sql_file($sql, $delimiter)
{
// Split up our string into "possible" SQL statements.
$tokens = explode($delimiter, $sql);

// try to save mem.
$sql = "";
$output = array();

// we don't actually care about the matches preg gives us.
$matches = array();

// this is faster than calling count($oktens) every time thru the loop.
$token_count = count($tokens);
for ($i = 0; $i < $token_count; $i++)
{
    // Don't wanna add an empty string as the last thing in the array.
    if (($i != ($token_count - 1)) || (strlen($tokens[$i] > 0)))
    {
        // This is the total number of single quotes in the token.
        $total_quotes = preg_match_all("/'/", $tokens[$i], $matches);
        // Counts single quotes that are preceded by an odd number of backslashes,
        // which means they're escaped quotes.
        $escaped_quotes = preg_match_all("/(?<!\\\\)(\\\\\\\\)*\\\\'/", $tokens[$i], $matches);

        $unescaped_quotes = $total_quotes - $escaped_quotes;

        // If the number of unescaped quotes is even, then the delimiter did NOT occur inside a string literal.
        if (($unescaped_quotes % 2) == 0)
        {
            // It's a complete sql statement.
            $output[] = $tokens[$i];
            // save memory.
            $tokens[$i] = "";
        }
        else
        {
            // incomplete sql statement. keep adding tokens until we have a complete one.
            // $temp will hold what we have so far.
            $temp = $tokens[$i] . $delimiter;
            // save memory..
            $tokens[$i] = "";

            // Do we have a complete statement yet?
            $complete_stmt = false;

            for ($j = $i + 1; (!$complete_stmt && ($j < $token_count)); $j++)
            {
            // This is the total number of single quotes in the token.
            $total_quotes = preg_match_all("/'/", $tokens[$j], $matches);
            // Counts single quotes that are preceded by an odd number of backslashes,
            // which means they're escaped quotes.
            $escaped_quotes = preg_match_all("/(?<!\\\\)(\\\\\\\\)*\\\\'/", $tokens[$j], $matches);

            $unescaped_quotes = $total_quotes - $escaped_quotes;

            if (($unescaped_quotes % 2) == 1)
            {
                // odd number of unescaped quotes. In combination with the previous incomplete
                // statement(s), we now have a complete statement. (2 odds always make an even)
                $output[] = $temp . $tokens[$j];

                // save memory.
                $tokens[$j] = "";
                $temp = "";

                // exit the loop.
                $complete_stmt = true;
                // make sure the outer loop continues at the right point.
                $i = $j;
            }
            else
            {
                // even number of unescaped quotes. We still don't have a complete statement.
                // (1 odd and 1 even always make an odd)
                $temp .= $tokens[$j] . $delimiter;
                // save memory.
                $tokens[$j] = "";
            }

            } // for..
        } // else
    }
}

return $output;
}

$dbms_schema = 'yourfile.sql';

$sql_query = @fread(@fopen($dbms_schema, 'r'), @filesize($dbms_schema)) or die('problem ');
$sql_query = remove_remarks($sql_query);
$sql_query = split_sql_file($sql_query, ';');

$host = 'localhost';
$user = 'user';
$pass = 'pass';
$db = 'database_name';

// mysql_* is deprecated, prefer using mysqli_* instead
// mysql_connect($host,$user,$pass) or die('error connection');
// mysql_select_db($db) or die('error database selection');
$connection = mysqli_connect($host,$user,$pass) or die('error connection');
mysqli_select_db($connection, $db) or die('error database selection');

$i=1;
foreach($sql_query as $sql){
    echo $i++;
    echo "<br />";
    // mysql_* is deprecated, prefer using mysqli_* instead
    // mysql_query($sql) or die('error in query');
    mysqli_query($connection, $sql) or die('error in query');
} 
```

            回答 #3

赞同：52

时间：2008-09-29T18:48:05.033

我感觉这里回答这个问题的每个人都不知道成为允许人们在自己的服务器上安装应用程序的 Web 应用程序开发人员是什么感觉。尤其是共享主机不允许您使用像前面提到的“加载数据”查询那样的 SQL。大多数共享主机也不允许您使用 shell_exec。

现在，要回答 OP，最好的办法是构建一个 PHP 文件，该文件在变量中包含您的查询，并且可以运行它们。如果您决定解析 .sql 文件，您应该查看 phpMyAdmin 并获得一些想法，以便以这种方式从 .sql 文件中获取数据。环顾其他具有安装程序的 Web 应用程序，您会发现，它们并没有使用 .sql 文件进行查询，而是将它们打包在 PHP 文件中，然后通过 mysql_query 或他们需要执行的任何操作来运行每个字符串.

            回答 #4

赞同：30

时间：2008-09-29T16:23:31.197

最简单的解决方案是使用 shell_exec() 以 SQL 脚本作为输入来运行 mysql 客户端。这可能会运行得慢一些，因为它必须分叉，但是您可以在几分钟内编写代码，然后重新开始处理有用的事情。编写 PHP 脚本来运行任何 SQL 脚本可能需要数周时间。

支持 SQL 脚本比人们在这里描述的要复杂，除非您确定您的脚本仅包含脚本功能的子集。下面是一些可能出现在普通 SQL 脚本中的示例，这些示例使得编写脚本来逐行解释它变得很复杂。

```
-- Comment lines cannot be prepared as statements
-- This is a MySQL client tool builtin command.  
-- It cannot be prepared or executed by server.
USE testdb;

-- This is a multi-line statement.
CREATE TABLE foo (
  string VARCHAR(100)
);

-- This statement is not supported as a prepared statement.
LOAD DATA INFILE 'datafile.txt' INTO TABLE foo;

-- This statement is not terminated with a semicolon.
DELIMITER //

-- This multi-line statement contains a semicolon 
-- but not as the statement terminator.
CREATE PROCEDURE simpleproc (OUT param1 INT)
BEGIN
  SELECT COUNT(*) INTO param1 FROM foo;
END
// 
```

如果只支持 SQL 脚本的一个子集，不包括上面的一些极端情况，那么编写一个读取文件并在文件中执行 SQL 语句的 PHP 脚本相对容易。但是，如果您想支持任何有效的 SQL 脚本，那就要复杂得多了。

另请参阅我对这些相关问题的回答：

*   [在 PHP 中运行 MySQL *.sql 文件](https://stackoverflow.com/questions/4027769/running-mysql-sql-files-in-php/4028289#4028289)
*   [是否可以从另一个 sql 脚本中的存储过程调用 sql 脚本？](https://stackoverflow.com/questions/547915/is-it-possible-to-call-a-sql-script-from-a-stored-procedure-in-another-sql-script/548119#548119)
*   [PHP：一个 mysql_query 语句中的多个 SQL 查询](https://stackoverflow.com/questions/345637/php-multiple-sql-queries-in-one-mysql-query-statement/345712#345712)

            回答 #5

赞同：11

时间：2013-03-12T06:04:19.873

在我的项目中，我使用了下一个解决方案：

```
<?php

/**
 * Import SQL from file
 *
 * @param string path to sql file
 */
function sqlImport($file)
{

    $delimiter = ';';
    $file = fopen($file, 'r');
    $isFirstRow = true;
    $isMultiLineComment = false;
    $sql = '';

    while (!feof($file)) {

        $row = fgets($file);

        // remove BOM for utf-8 encoded file
        if ($isFirstRow) {
            $row = preg_replace('/^\x{EF}\x{BB}\x{BF}/', '', $row);
            $isFirstRow = false;
        }

        // 1\. ignore empty string and comment row
        if (trim($row) == '' || preg_match('/^\s*(#|--\s)/sUi', $row)) {
            continue;
        }

        // 2\. clear comments
        $row = trim(clearSQL($row, $isMultiLineComment));

        // 3\. parse delimiter row
        if (preg_match('/^DELIMITER\s+[^ ]+/sUi', $row)) {
            $delimiter = preg_replace('/^DELIMITER\s+([^ ]+)$/sUi', '$1', $row);
            continue;
        }

        // 4\. separate sql queries by delimiter
        $offset = 0;
        while (strpos($row, $delimiter, $offset) !== false) {
            $delimiterOffset = strpos($row, $delimiter, $offset);
            if (isQuoted($delimiterOffset, $row)) {
                $offset = $delimiterOffset + strlen($delimiter);
            } else {
                $sql = trim($sql . ' ' . trim(substr($row, 0, $delimiterOffset)));
                query($sql);

                $row = substr($row, $delimiterOffset + strlen($delimiter));
                $offset = 0;
                $sql = '';
            }
        }
        $sql = trim($sql . ' ' . $row);
    }
    if (strlen($sql) > 0) {
        query($row);
    }

    fclose($file);
}

/**
 * Remove comments from sql
 *
 * @param string sql
 * @param boolean is multicomment line
 * @return string
 */
function clearSQL($sql, &$isMultiComment)
{
    if ($isMultiComment) {
        if (preg_match('#\*/#sUi', $sql)) {
            $sql = preg_replace('#^.*\*/\s*#sUi', '', $sql);
            $isMultiComment = false;
        } else {
            $sql = '';
        }
        if(trim($sql) == ''){
            return $sql;
        }
    }

    $offset = 0;
    while (preg_match('{--\s|#|/\*[^!]}sUi', $sql, $matched, PREG_OFFSET_CAPTURE, $offset)) {
        list($comment, $foundOn) = $matched[0];
        if (isQuoted($foundOn, $sql)) {
            $offset = $foundOn + strlen($comment);
        } else {
            if (substr($comment, 0, 2) == '/*') {
                $closedOn = strpos($sql, '*/', $foundOn);
                if ($closedOn !== false) {
                    $sql = substr($sql, 0, $foundOn) . substr($sql, $closedOn + 2);
                } else {
                    $sql = substr($sql, 0, $foundOn);
                    $isMultiComment = true;
                }
            } else {
                $sql = substr($sql, 0, $foundOn);
                break;
            }
        }
    }
    return $sql;
}

/**
 * Check if "offset" position is quoted
 *
 * @param int $offset
 * @param string $text
 * @return boolean
 */
function isQuoted($offset, $text)
{
    if ($offset > strlen($text))
        $offset = strlen($text);

    $isQuoted = false;
    for ($i = 0; $i < $offset; $i++) {
        if ($text[$i] == "'")
            $isQuoted = !$isQuoted;
        if ($text[$i] == "\\" && $isQuoted)
            $i++;
    }
    return $isQuoted;
}

function query($sql)
{
    global $mysqli;
    //echo '#<strong>SQL CODE TO RUN:</strong><br>' . htmlspecialchars($sql) . ';<br><br>';
    if (!$query = $mysqli->query($sql)) {
        throw new Exception("Cannot execute request to the database {$sql}: " . $mysqli->error);
    }
}

set_time_limit(0);

$mysqli = new mysqli('localhost', 'root', '', 'test');
$mysqli->set_charset("utf8");

header('Content-Type: text/html;charset=utf-8');
sqlImport('import.sql');

echo "Peak MB: ", memory_get_peak_usage(true)/1024/1024; 
```

测试 sql 文件 (41Mb) 内存峰值使用量：3.25Mb

            回答 #6

赞同：10

时间：2008-09-29T17:40:16.367

`mysqli`可以运行由 a 分隔的多个查询`;` 

您可以读取整个文件并使用[`mysqli_multi_query()`](http://us3.php.net/manual/en/mysqli.multi-query.php)

但是，我会第一个说这不是最优雅的解决方案。

            回答 #7

赞同：9

时间：2015-04-02T20:05:50.483

由于我无法评论答案，请注意使用以下解决方案：

```
$db = new PDO($dsn, $user, $password);

$sql = file_get_contents('file.sql');

$qr = $db->exec($sql); 
```

PHP PDO 中有一个错误[https://bugs.php.net/bug.php?id=61613](https://bugs.php.net/bug.php?id=61613)

```
db->exec('SELECT 1; invalidstatement; SELECT 2'); 
```

不会出错或返回 false（在 PHP 5.5.14 上测试）。  

            回答 #8

赞同：5

时间：2008-09-29T09:49:52.703

我的建议是查看 PHPMyBackup 的源代码。它是一个自动化的 PHP SQL 加载器。您会发现 mysql_query 一次只加载一个查询，而 PHPMyAdmin 和 PHPMyBackup 等项目已经为您完成了正确解析 SQL 的艰苦工作。请不要重新发明那个轮子：P

            回答 #9

赞同：4

时间：2008-09-29T07:48:19.703

```
mysql_query("LOAD DATA LOCAL INFILE '/path/to/file' INTO TABLE mytable"); 
```

            回答 #10

赞同：4

时间：2012-07-17T14:54:40.110

Plahcinski 解决方案的更新解决方案。或者，您可以将 fopen 和 fread 用于更大的文件：

```
$fp = file('database.sql', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
$query = '';
foreach ($fp as $line) {
    if ($line != '' && strpos($line, '--') === false) {
        $query .= $line;
        if (substr($query, -1) == ';') {
            mysql_query($query);
            $query = '';
        }
    }
} 
```

            回答 #11

赞同：4

时间：2015-05-21T10:13:08.423

简而言之，我这样做的方式是：

1.  读取文件（数据库转储，例如`$ mysqldump db > db.sql`）

    ```
    $sql = file_get_contents(db.sql); 
    ```

2.  使用 mysqli::multi_query 导入它

    ```
    if ($mysqli->multi_query($sql)) {
        $mysqli->close();
    } else {
        throw new Exception ($mysqli->error);
    } 
    ```

注意 mysqli_query 支持异步查询。更多在这里： http: [//php.net/manual/en/mysqli.multi-query.php](http://php.net/manual/en/mysqli.multi-query.php)和这里[https://stackoverflow.com/a/6652908/2002493](https://stackoverflow.com/a/6652908/2002493)

            回答 #12

赞同：3

时间：2008-09-29T08:21:16.553

您确定不是每行一个查询吗？您的文本编辑器可能会换行，但实际上每个查询可能都在一行上。

无论如何，olle 的方法似乎是最好的。如果您有理由一次运行一个查询，您应该能够逐行读取文件，然后在每个查询末尾使用分号进行分隔。与尝试拆分巨大的字符串相比，逐行读取文件要好得多，因为它对服务器的内存更友好。例子：

```
$query  = '';
$handle = @fopen("/sqlfile.sql", "r");

if ($handle) {
    while (!feof($handle)) {
        $query.= fgets($handle, 4096);

        if (substr(rtrim($query), -1) === ';') {
            // ...run your query, then unset the string
            $query = '';
        }
    }

    fclose($handle);
} 
```

显然，如果您要批量运行大量查询，则需要考虑事务和其余部分，但这对于新安装脚本可能没什么大不了的。

            回答 #13

赞同：3

时间：2017-01-29T22:50:16.117

我注意到 PostgreSQL PDO 驱动程序不允许您运行以分号分隔的脚本。为了使用 PDO 在任何数据库上运行 .sql 文件，有必要自己在 PHP 代码中拆分语句。这是一个似乎效果很好的解决方案：

[https://github.com/diontruter/migrate/blob/master/src/Diontruter/Migrate/SqlScriptParser.php](https://github.com/diontruter/migrate/blob/master/src/Diontruter/Migrate/SqlScriptParser.php)

引用的类以独立于数据库的方式为我完成了技巧，如果有任何问题，请给我留言。以下是在将脚本添加到项目后如何使用它：

```
$pdo = new PDO($connectionString, $userName, $password);
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$parser = new SqlScriptParser();
$sqlStatements = $parser->parse($fileName);
foreach ($sqlStatements as $statement) {
    $distilled = $parser->removeComments($statement);
    if (!empty($distilled)) {
        $statement = $pdo->prepare($sql);
        $affectedRows = $statement->execute();
    }
} 
```

            回答 #14

赞同：2

时间：2008-09-29T08:41:08.813

除非您打算导入*巨大的*.sql 文件，否则只需将整个文件读入内存，然后将其作为查询运行。

我已经有一段时间没有使用 PHP 了，所以，伪代码：

```
all_query = read_file("/my/file.sql")
con = mysql_connect("localhost")
con.mysql_select_db("mydb")
con.mysql_query(all_query)
con.close() 
```

除非文件很大（例如，超过几兆字节），否则没有理由一次执行它，或者尝试将其拆分为多个查询（通过拆分 using `;`，正如我在 cam8001 的回答中所评论的那样，它将中断如果查询在字符串中有分号）..

            回答 #15

赞同：2

时间：2011-04-28T20:29:20.157

适用于 Navicat 转储。可能需要转储 Navicat 放入的第一个 /* */ 注释。

```
$file_content = file('myfile.sql');
$query = "";
foreach($file_content as $sql_line){
  if(trim($sql_line) != "" && strpos($sql_line, "--") === false){
    $query .= $sql_line;
    if (substr(rtrim($query), -1) == ';'){
      echo $query;
      $result = mysql_query($query)or die(mysql_error());
      $query = "";
    }
  }
 } 
```

            回答 #16

赞同：2

时间：2011-10-24T17:55:11.020

这是通过 php 恢复 sql 的最佳代码可以使用 100% Goooood！非常感谢   

```
$file_content = file('myfile.sql');
$query = "";
foreach($file_content as $sql_line){
if(trim($sql_line) != "" && strpos($sql_line, "--") === false){
 $query .= $sql_line;
 if (substr(rtrim($query), -1) == ';'){
   echo $query;
   $result = mysql_query($query)or die(mysql_error());
   $query = "";
  }
 }
} 
```

            回答 #17

赞同：2

时间：2011-11-01T21:15:11.857

试试这个：

```
// SQL File
$SQLFile = 'YourSQLFile.sql';

// Server Name
$hostname = 'localhost';

// User Name
$db_user = 'root';

// User Password
$db_password = '';

// DBName
$database_name = 'YourDBName';

// Connect MySQL
$link = mysql_connect($hostname, $db_user, $db_password);

if (!$link) {
die("MySQL Connection error");
}

// Select MySQL DB
mysql_select_db($database_name, $link) or die("Wrong MySQL Database");

// Function For Run Multiple Query From .SQL File
function MultiQuery($sqlfile, $sqldelimiter = ';') {
set_time_limit(0);

if (is_file($sqlfile) === true) {
$sqlfile = fopen($sqlfile, 'r');

if (is_resource($sqlfile) === true) {
$query = array();
echo "<table cellspacing='3' cellpadding='3' border='0'>";

while (feof($sqlfile) === false) {
$query[] = fgets($sqlfile);

if (preg_match('~' . preg_quote($sqldelimiter, '~') . '\s*$~iS', end($query)) === 1) {
$query = trim(implode('', $query));

if (mysql_query($query) === false) {
echo '<tr><td>ERROR:</td><td> ' . $query . '</td></tr>';
} else {
echo '<tr><td>SUCCESS:</td><td>' . $query . '</td></tr>';
}

while (ob_get_level() &gt; 0) {
ob_end_flush();
}

flush();
}

if (is_string($query) === true) {
$query = array();
}
}
echo "</table>";

return fclose($sqlfile);
}
}

return false;
}

/* * * Use Function Like This: ** */

MultiQuery($SQLFile); 
```

            回答 #18

赞同：2

时间：2012-05-22T22:14:06.723

加载和解析 phpmyadmin 转储或 mysql 转储文件的最简单和最快的方法..

```
$ mysql -u username -p -h localhost dbname < dumpfile.sql 
```

            回答 #19

赞同：1

时间：2010-06-01T03:14:22.643

我在这里看到的所有解决方案都没有处理在我无法访问 LOAD DATA INFILE 的服务器上创建存储过程时需要更改分隔符的问题。我希望发现有人已经解决了这个问题，而无需搜索 phpMyAdmin 代码来解决这个问题。和其他人一样，我也在寻找其他人的 GPL 方法，因为我自己正在编写 GPL 代码。

            回答 #20

赞同：1

时间：2010-09-01T13:38:52.207

一些 PHP 库可以解析由多个 SQL 语句组成的 SQL 文件，将其正确分解（自然不是使用简单的“;”分解），然后执行它们。

例如，检查[Phing](http://www.phing.info/trac/)的[PDOSQLExecTask](http://phing.info/docs/guide/stable/chapters/appendixes/AppendixC-OptionalTasks.html#PDOSQLExecTask)

            回答 #21

赞同：1

时间：2011-09-10T20:10:49.863

只是为了向大家重申这个问题：

PHP 的 mysql_query 会自动对每个 SQL 命令进行结束分隔，并且在其手册中对这样做非常模糊。超出一个命令的所有内容都会产生错误。

另一方面，mysql_query 可以使用包含 SQL 样式注释的字符串，\n, \r..

mysql_query 的局限性在于 SQL 解析器将问题直接报告为下一个命令，例如

```
 You have an error in your SQL syntax; check the manual that corresponds to your
 MySQL server version for the right syntax to use near 'INSERT INTO `outputdb:`
 (`intid`, `entry_id`, `definition`) VALUES... 
```

**这是一个快速的解决方案：（**
假设 SQL 格式正确；

```
$sqlCmds = preg_split("/[\n|\t]*;[\n|\t]*[\n|\r]$/", $sqlDump); 
```

            回答 #22

赞同：1

时间：2011-10-30T09:01:41.420

许多主机不允许您通过 PHP 创建自己的数据库，但您似乎已经解决了这个问题。

创建数据库后，您可以简单地操作和填充它：

mysql_connect("本地主机"); 

  mysql_query("源文件.sql");

            回答 #23

赞同：1

时间：2013-09-19T11:08:05.847

有些人（Plahcinski）建议了这个代码：

```
$file_content = file('myfile.sql');
$query = "";
foreach($file_content as $sql_line){
  if(trim($sql_line) != "" && strpos($sql_line, "--") === false){
    $query .= $sql_line;
    if (substr(rtrim($query), -1) == ';'){
      echo $query;
      $result = mysql_query($query)or die(mysql_error());
      $query = "";
    }
  }
 } 
```

但我会用对我有用的更新它：

```
 //selecting my database
    $database = 'databaseTitleInFile';
    $selectDatabase = mysql_select_db($database, $con);
    if(! $selectDatabase )
    {
      die('Could not select the database: ' . mysql_error());
    }
    echo "The database " . $database . " selected successfully\n";
//reading the file
    $file_path='..\yourPath\to\File';
    if(!file_exists($file_path)){
        echo "File Not Exists";
    }
    $file_content = file_get_contents($file_path);
    $array = explode("\n", $file_content)
//making queries
    $query = "";
        foreach($array as $sql_line){
$sql_line=trim($sql_line);
          if($sql_line != "" && substr($sql_line, 0, 2) === "--" && strpos($sql_line, "/*") === false){
            $query .= $sql_line;
            if (substr(rtrim($query), -1) == ';'){
              $result = mysql_query($query)or die(mysql_error());
              $query = "";
            }
          }
         } 
```

因为它更全面。;-)

            回答 #24

赞同：1

时间：2013-10-23T15:18:14.433

这可能会有所帮助-->

它所做的或多或少是首先获取给函数的字符串（file.sql 的 file_get_contents() 值）并删除所有换行符。然后它用“;”分割数据 特点。接下来它进入一个while循环，查看创建的数组的每一行。如果该行包含“`”字符，它将知道这是一个查询并为给定的行数据执行 myquery() 函数。

代码：

```
function myquery($query) {

mysql_connect(dbhost, dbuser, dbpass);

mysql_select_db(dbname);

$result = mysql_query($query);

if (!mysql_errno() && @mysql_num_rows($result) > 0) {
}

else {

$result="not";
}
mysql_close();

return $result;

}

function mybatchquery ($str) {

$sql = str_replace("\n","",$str)

$sql = explode(";",$str);

$x=0;

while (isset($str[$x])) {

if (preg_match("/(\w|\W)+`(\w|\W)+) {

myquery($str[$x]);

}

$x++

}

return TRUE;

}

function myrows($result) {

$rows = @mysql_num_rows($result);

return $rows;
}

function myarray($result) {

$array = mysql_fetch_array($result);

return $array;
}

function myescape($query) {

$escape = mysql_escape_string($query);

return $escape;
}

$str = file_get_contents("foo.sql");
mybatchquery($str); 
```

            回答 #25

赞同：1

时间：2020-10-18T03:13:11.507

```
 $sql = file_get_contents("sql.sql"); 
```

似乎是最简单的答案

            回答 #26

赞同：0

时间：2011-01-12T15:43:13.640

我经常用这个：

```
$sql = explode(";",file_get_contents('[your dump file].sql'));// 

foreach($sql as $query)
 mysql_query($query); 
```

            回答 #27

赞同：0

时间：2012-01-09T12:29:12.960

我希望下面的代码能很好地解决你的问题。

```
//Empty all tables' contents

$result_t = mysql_query("SHOW TABLES");
while($row = mysql_fetch_assoc($result_t))
{
mysql_query("TRUNCATE " . $row['Tables_in_' . $mysql_database]);
}
// Temporary variable, used to store current query
$templine = '';
// Read in entire file
$lines = file($filename);
// Loop through each line
foreach ($lines as $line)
{
// Skip it if it's a comment
if (substr($line, 0, 2) == '--' || $line == '')
    continue;

// Add this line to the current segment
$templine .= $line;
// If it has a semicolon at the end, it's the end of the query
if (substr(trim($line), -1, 1) == ';')
{
    // Perform the query
    mysql_query($templine) or print('Error performing query \'<strong>' . $templine . '\': ' . mysql_error() . '<br /><br />');
    // Reset temp variable to empty
    $templine = '';
}
}

?> 
```

            回答 #28

赞同：0

时间：2013-09-18T16:47:41.640

这实际上对我有用：

```
/* load sql-commands from a sql file */
function loadSQLFromFile($url)
{
    // ini_set ( 'memory_limit', '512M' );
    // set_time_limit ( 0 );

    global $settings_database_name;
    global $mysqli_object; global $worked; $worked = false;

    $sql_query = "";

    // read line by line
    $lines = file($url);
    $count = count($lines);

    for($i = 0;$i<$count;$i++)
    {
        $line = $lines[$i];
        $cmd3 = substr($line, 0, 3);
        $cmd4 = substr($line, 0, 4);
        $cmd6 = substr($line, 0, 6);
        if($cmd3 == "USE")
        {
            // cut away USE ``;
            $settings_database_name = substr($line, 5, -3);
        }
        else if($cmd4 == "DROP")
        {
            $mysqli_object->query($line); // execute this line
        }
        else if(($cmd6 == "INSERT") || ($cmd6 == "CREATE"))
        {
            // sum all lines up until ; is detected
            $multiline = $line;
            while(!strstr($line, ';'))
            {
                $i++;
                $line = $lines[$i];
                $multiline .= $line;
            }
            $multiline = str_replace("\n", "", $multiline); // remove newlines/linebreaks
            $mysqli_object->query($multiline); // execute this line
        }       
    }

    return $worked;
}
?> 
```

            回答 #29

赞同：0

时间：2015-01-21T09:26:24.437

我有一个没有 mysql 工具或 phpmyadmin 的环境，只有我的 php 应用程序连接到不同主机上的 mysql 服务器，但我需要运行由 mysqldump 或 myadmin 导出的脚本。为了解决这个问题，我创建了一个脚本，正如我在[这里](https://stackoverflow.com/questions/4027769/running-mysql-sql-files-in-php/28051527#28051527 "here")`multi_query`提到的

它可以在没有 mysql 命令行工具的情况下处理 mysqldump 输出和 phpmyadmin 导出。我还根据存储在数据库中的时间戳（如 Rails）制定了一些逻辑来处理多个迁移文件。我知道它需要更多的错误处理，但目前为我完成了这项工作。

看看：[https ://github.com/kepes/php-migration](https://github.com/kepes/php-migration)

它是纯 php，不需要任何其他工具。如果您不使用它仅处理由开发人员制作的脚本或导出工具的用户输入，您可以安全地使用它。

            回答 #30

赞同：0

时间：2019-03-30T00:59:27.367

这是来自我正在从事的一个项目。基本上采用任何文本文件并提取 SQL 语句，同时忽略注释和无故换行符。

```
<?php

  /*
     ingestSql(string) : string

     Read the contents of a SQL batch file, stripping away comments and
     joining statements that are broken over multiple lines with the goal
     of producing lines of sql statements that can be successfully executed
     by PDO exec() or execute() functions.

     For example:
       -- My SQL Batch
       CREATE TABLE foo(
         bar VARCHAR(80),
         baz INT NOT NULL);

     Becomes:
       CREATE TABLE foo(bar VARCHAR(80), baz INT NOT NULL);
  */

  function ingestSql($sqlFilePath=__DIR__ . "/create-db.sql") {
    $sqlFile = file($sqlFilePath);
    $ingestedSql = "";
     $statement = "";
    foreach($sqlFile as $line) {

      // Ignore anything between a double-dash and the end of the line.
      $commentStart = strpos($line, "--");
      if ($commentStart !== false) {
        $line = substr($line, 0, $commentStart);
      }

      // Only process non-blank lines.
      if (strlen($line)) {

        // Remove any leading and trailing whitespace and append what's
        // left of the line to the current statement.
        $line = trim($line);
        $statement .= $line;

        // A semi-colon ends the current statement.  Otherwise what was a
        // newline becomes a single space;
        if (substr($statement, -1) == ";") {
          $ingestedSql .= $statement;
          $statement = "\n";
        }
        else {
          $statement .= " ";
        }
      }
    }

    return $ingestedSql;
  }

?> 
```

        javascript - 如何查找特定字符串是否具有 unicode 字符（尤其是双字节字符）

ID：147824

赞同：33

时间：2008-09-29T07:39:58.600

标签：javascript, unicode, double-byte

更准确地说，我需要知道我是否（如果可能的话，如何）找到给定的字符串是否有双字节字符。基本上，我需要打开一个弹出窗口来显示可以包含双字节字符的给定文本，例如中文或日文。在这种情况下，我们需要调整窗口大小而不是英语或 ASCII。有人有线索吗？

            回答 #1

赞同：43

时间：2009-11-08T20:06:34.373

我在这个问题上使用了 Mikesamuel 的答案。`u`但是我注意到也许是因为这种形式，例如，之前应该只有一个转义斜线，`\u`而不是`\\u`使它正常工作。

```
function containsNonLatinCodepoints(s) {
    return /[^\u0000-\u00ff]/.test(s);
} 
```

为我工作:)

            回答 #2

赞同：32

时间：2008-09-29T13:18:00.100

JavaScript 在内部将文本保存为 UCS-2，它可以编码相当广泛的 Unicode 子集。

但这与您的问题并不密切相关。一种解决方案可能是遍历字符串并检查每个位置的字符代码：

```
function isDoubleByte(str) {
    for (var i = 0, n = str.length; i < n; i++) {
        if (str.charCodeAt( i ) > 255) { return true; }
    }
    return false;
} 
```

这可能没有您希望的那么快。

            回答 #3

赞同：13

时间：2017-10-12T21:30:51.560

我已经对最佳答案中的两个函数进行了基准测试，并认为我会分享结果。这是我使用的测试代码：

```
const text1 = `The Chinese Wikipedia was established along with 12 other Wikipedias in May 2001\. 中文維基百科的副標題是「海納百川，有容乃大」，這是中国的清朝政治家林则徐（1785年－1850年）於1839年為`;

const regex = /[^\u0000-\u00ff]/; // Small performance gain from pre-compiling the regex
function containsNonLatinCodepoints(s) {
    return regex.test(s);
}

function isDoubleByte(str) {
    for (var i = 0, n = str.length; i < n; i++) {
        if (str.charCodeAt( i ) > 255) { return true; }
    }
    return false;
}

function benchmark(fn, str) {
    let startTime = new Date();
    for (let i = 0; i < 10000000; i++) {
        fn(str);
    }   
    let endTime = new Date();

    return endTime.getTime() - startTime.getTime();
}

console.info('isDoubleByte => ' + benchmark(isDoubleByte, text1));
console.info('containsNonLatinCodepoints => ' + benchmark(containsNonLatinCodepoints, text1)); 
```

运行时我得到：

```
isDoubleByte => 2421
containsNonLatinCodepoints => 868 
```

因此，对于这个特定的字符串，正则表达式解决方案的速度大约快 3 倍。

但是请注意，对于第一个字符为 unicode 的字符串，会`isDoubleByte()`立即返回，因此比正则表达式（仍然具有正则表达式的开销）要快得多。

例如对于 string `中国`，我得到了这些结果：

```
isDoubleByte => 51
containsNonLatinCodepoints => 288 
```

为了两全其美，最好将两者结合起来：

```
var regex = /[^\u0000-\u00ff]/; // Small performance gain from pre-compiling the regex
function containsDoubleByte(str) {
    if (!str.length) return false;
    if (str.charCodeAt(0) > 255) return true;
    return regex.test(str);
} 
```

在这种情况下，如果第一个字符是中文（如果整个文本都是中文的话很可能），该函数将很快并立即返回。如果没有，它将运行正则表达式，这仍然比单独检查每个字符要快。

            回答 #4

赞同：6

时间：2008-09-29T08:10:28.887

实际上，所有字符都是 Unicode，至少从 Javascript 引擎的角度来看是这样。

不幸的是，仅存在特定 Unicode 范围内的字符不足以确定您需要更多空间。有许多字符占用的空间与其他字符的 Unicode 代码点远高于 ASCII 范围的字符大致相同。印刷引号、带变音符号的字符、某些标点符号和各种货币符号都超出了低 ASCII 范围，并且在 Unicode 基本多语言平面上分配在完全不同的位置。

通常，我从事的项目选择为所有语言提供额外的空间，或者有时使用 javascript 来确定具有自动滚动条 css 属性的窗口是否实际上具有会触发滚动条的高度的内容。

如果检测 CJK 字符的存在或数量足以确定您需要一些额外的空间，则可以使用以下范围构造正则表达式：[\u3300-\u9fff\uf900-\ufaff]，并使用以提取匹配字符数的计数。（这有点过于粗略，并且遗漏了所有非 BMP 情况，可能排除了一些其他相关范围，并且很可能包括一些不相关的字符，但这是一个起点）。

同样，您只能在没有全文渲染引擎的情况下管理粗略的启发式算法，因为您真正想要的是像 GDI 的 MeasureString（或任何其他文本渲染引擎的等效项）之类的东西。自从我这样做以来已经有一段时间了，但我认为最接近的 HTML/DOM 等效项是在 div 上设置宽度并请求高度（剪切和粘贴重用，如果其中包含错误，请道歉）：

```
o = document.getElementById("test");

document.defaultView.getComputedStyle(o,"").getPropertyValue("height")) 
```

            回答 #5

赞同：5

时间：2018-11-21T21:29:54.480

这是基准测试：http: [//jsben.ch/NKjKd](http://jsben.ch/NKjKd)

这要快得多：

```
function containsNonLatinCodepoints(s) {
    return /[^\u0000-\u00ff]/.test(s);
} 
```

比这个：

```
function isDoubleByte(str) {
    for (var i = 0, n = str.length; i < n; i++) {
        if (str.charCodeAt( i ) > 255) { return true; }
    }
    return false;
} 
```

            回答 #6

赞同：0

时间：2008-09-29T07:53:59.770

为什么不让窗口根据运行时高度/宽度自行调整大小？

在弹出窗口中运行类似的内容：

```
window.resizeTo(document.body.clientWidth, document.body.clientHeight); 
```

        database-design - 多用户的 CouchDB 建模

ID：147837

赞同：7

时间：2008-09-29T07:43:53.663

标签：database-design, couchdb

我已经对文档数据库感到兴奋，尤其是对 CouchDB 的简单性感到兴奋。但是我很难理解这样的数据库是否是多用户系统的可行选择。因为这些系统需要文档数据库不提供的记录之间的某种关系。

对于这种情况，它完全是错误的工具吗？或者一些标记和临时视图是实现这一点的方法？要不然...

更新：

到目前为止，我了解答案。但是让我重新表述一下这个问题。假设我有大量半结构化数据，通常适合 CouchDB。我可以将它们标记为“type=post”和“year=2008”。我的问题是这种类型的标记我能走多远？假设我可以创建一个包含 10.000 个名称的数组字段吗？或者有没有更好的方法来做到这一点？这是一个理解如何在这种基于文档的意义上思考的问题。

            回答 #1

赞同：9

时间：2008-09-29T15:09:09.490

[不久前在邮件列表](http://couchdb.markmail.org/search/?q=twitter%20follower#query:twitter%20follower+page:1+mid:l4ibup6xoftffvrs+state:results)上有一个讨论非常适合这个问题。经验法则是只将数据存储在可能会发生变化和增长的文档中。如果数据更有可能增长，那么您很可能希望存储单独的文档。

因此，在多用户系统的情况下，实现基于 ACL 的权限的一种方法可能是创建“权限文档”，它是 user_id 到 doc_id 的映射，并指示了适当的权限。

```
{
    _id: "permission_doc_1",
    type: "acl",
    user: "John",
    docid: "John's Account Info",
    read: true,
    write: true
} 
```

你的观点将类似于

```
function(doc)
{
    emit([doc.user, doc.docid], {"read": doc.read, "write": doc.write});
} 
```

给定一个 docid 和用户 ID，检查权限将是：

```
http://localhost:5984/db/_view/permissions/all?key=["John", "John's Account Info"] 
```

显然，这需要在客户端和沙发之间有一些中介，以确保执行权限。

            回答 #2

赞同：3

时间：2008-09-29T08:26:09.567

多用户系统*不需要*关系数据库，尽管 RDBMS 是用于大量（尤其是 CRUD）应用程序的数据存储/检索的主要技术。

如果您想阅读过去的面向文档/面向对象的分布式数据库解决方案，请搜索“Lotus Notes/Domino”（这是该领域的成熟技术/产品，对如何在文档中设计应用程序有很好的背景知识-based 范例。传统上，它非常适合工作流类型的应用程序）。

具体在 CouchDB 上，请查看：

[http://wiki.apache.org/couchdb/](http://wiki.apache.org/couchdb/)（这应该不足为奇）

[http://seanoc.wordpress.com/2007/10/12/more-on-couchdb/](http://seanoc.wordpress.com/2007/10/12/more-on-couchdb/)（易读描述概述）

[http://twit.tv/floss36](http://twit.tv/floss36)（关于 CouchDB 的播客采访）

            回答 #3

赞同：2

时间：2008-09-29T08:38:38.540

@micahwittman 说了什么。只是一个快速的补充：临时视图不应该在生产系统中使用，它们仅用于开发。永久视图可以做临时视图可以做的所有事情，而且速度要快得多。

        javascript - Cognos 8 Javascript 在多选列表框提示中选择值

ID：147839

赞同：0

时间：2008-09-29T07:45:42.817

标签：javascript, business-intelligence, cognos

我在 Cognos 8.3 中有一个多选列表框值提示。

它包含值：

阿德莱德北

阿德莱德南

阿德莱德东

阿德莱德东

悉尼北

悉尼南

悉尼东  

悉尼西

等。

我希望能够在我的提示页面上添加一个按钮，单击该按钮可以选择预定选项，例如阿德莱德北部、东南部和西部。

例如：一个阿德莱德按钮选择阿德莱德北、阿德莱德南、阿德莱德东和阿德莱德西，而不是让用户选择多选列表框中的 4 个选项。

有没有办法我可以做到这一点？我在属性的杂项区域中将我的列表框命名为 cboFSA。

非常感谢任何帮助。

            回答 #1

赞同：3

时间：2008-10-02T22:16:41.213

我假设这是一个基于 Web 的 Cognos 界面？如果是这样，这应该为你做：

如果名称 cboFSA 被指定为使用的 ID 属性`<select>`：

```
<select size="6" id="cboFSA" multiple="multiple">
<option>Adelaide North</option>
<option>Adelaide South</option>
<option>Adelaide East</option>
<option>Adelaide East</option>
<option>Sydney North</option>
<option>Sydney South</option>
<option>Sydney East</option>
<option>Sydney West</option>
</select>
<input type="button" value="Select all Adelaide" onclick="selectCity('adelaide', 'cboFSA');">
<input type="button" value="Select all Sydney" onclick="selectCity('sydney', 'cboFSA');">
<script type="text/javascript">
function selectCity(city, list) {
    if ('string' === typeof city) {
        city = city.toLowerCase();
        if (document.getElementById) {
            var sel = document.getElementById(list);
            if (sel && (sel = sel.options)) {
                for (var ii = 0, iiLen = sel.length; ii < iiLen; ++ii) {
                    sel[ii].selected = (sel[ii].text.toLowerCase().indexOf(city) !== -1);
                }
            }
        }
    }
}
</script> 
```

如果名称 cboFSA 被指定为使用的 NAME 属性`<select>`：

```
<select size="6" name="cboFSA" multiple="multiple">
<option>Adelaide North</option>
<option>Adelaide South</option>
<option>Adelaide East</option>
<option>Adelaide East</option>
<option>Sydney North</option>
<option>Sydney South</option>
<option>Sydney East</option>
<option>Sydney West</option>
</select>
<input type="button" value="Select all Adelaide" onclick="selectCity('adelaide', 'cboFSA', this);">
<input type="button" value="Select all Sydney" onclick="selectCity('sydney', 'cboFSA', this);">
<script type="text/javascript">
function selectCity(city, list, btn) {
    if ('string' === typeof city) {
        city = city.toLowerCase();
        var sel;
        if (btn && btn.form && (sel = btn.form[list]) && (sel = sel.options)) {
            for (var ii = 0, iiLen = sel.length; ii < iiLen; ++ii) {
                sel[ii].selected = (sel[ii].text.toLowerCase().indexOf(city) !== -1);
            }
        }
    }
}
</script> 
```

您可以在浏览器中使用 View > Source 来确定 Cognos 是否分配了您指定为 ID 或 NAME 属性的值。

        java - Java 中最好的“可关闭 TabbedPane”组件是什么？

ID：147845

赞同：4

时间：2008-09-29T07:49:28.157

标签：java, swing, tabs, components

解决了我的[闪烁问题后，我想知道是否有更好的可关闭选项卡式窗格，然后是通过谷歌搜索](https://stackoverflow.com/questions/147802/why-does-swing-in-my-java-applet-flicker-on-fast-mouse-over)[closabletappedpane](http://www.google.ch/search?q=closeabletabbedpane)弹出的？[（您可以通过它的processMouseEvents 方法](http://www.koders.com/java/fidA4A2ADA8513A83E2024E550ADF906CAE16A4EDFB.aspx?s=cdef%3Aaccount#L125)识别它）

我特别需要一个，永远不会闪烁的:-)

请在此处发布您的经验，以及您自己的可关闭选项卡式窗格的链接。

            回答 #1

赞同：4

时间：2008-09-29T10:02:29.210

在 JDK 中有一个使用[JTabbedPane](http://java.sun.com/docs/books/tutorial/uiswing/components/tabbedpane.html)[的可关闭选项卡的示例实现。](http://java.sun.com/docs/books/tutorial/uiswing/examples/components/index.html#TabComponentsDemo)

            回答 #2

赞同：3

时间：2008-09-29T13:58:24.447

[JideTabbedPane](http://www.jidesoft.com/products/oss.htm)非常棒，它位于公共层（开源）。它支持各种甜蜜的功能，使 Java 应用程序看起来不那么硬。我们在我的项目中取得了巨大的成功。

            回答 #3

赞同：0

时间：2008-09-29T13:50:12.003

我真的建议按照上面提到的教程进行操作。创建这样的选项卡很简单，您可以*完全*控制其行为。

        logging - 通过 RSS 订阅 log4j 日志？

ID：147847

赞同：3

时间：2008-09-29T07:50:46.283

标签：logging, log4j

是否可以使用 log4j 日志订阅 url？我了解许多应用程序确实通过电子邮件收到每日错误日志通知。但是这种方法的一个问题是托管应用程序的服务器可能不提供 smtp 功能。因此，RSS 订阅方法看起来更加灵活。

有人知道这是怎么做到的吗？

            回答 #1

赞同：4

时间：2008-11-05T19:04:58.337

已经编写了 log4j RSS 附加程序。看看[http://code.google.com/p/rssappender/](http://code.google.com/p/rssappender/)

            回答 #2

赞同：1

时间：2008-10-01T12:44:37.277

最简单的做法是编写一个自定义 Log4J appender（不难，只是子类 WriterAppender），它将 LoggingEvents 转换为 RSS 格式，并将它们存储在磁盘文件中。每次它收到一个新事件时，加载现有文件，解析它，添加新的 RSS 条目，然后将其写回。然后使用 Web 服务器来提供 RSS。

它不会很好地扩展，但是如果您有大量的日志事件，那么 RSS 本身就不是一个好的选择。

            回答 #3

赞同：1

时间：2008-09-29T08:58:50.423

一个非常简单的解决方案是使用 log4j（或我的例子中的 log4net）将日志信息保存到某个存储（数据库或文件）。然后，您可以轻松地创建一个服务，将该日志公开为 RSS 提要。

        java - 使用 ANT 时，如果我有一些特定的 java 版本，如何定义任务？

ID：147850

赞同：5

时间：2008-09-29T07:52:36.370

标签：java, ant, conditional

我的问题是，只有在构建计算机中安装了 Java 1.5 时，才能执行 Ant 中的特定步骤。任务定义使用使用 1.5 编译的 jar 文件，因此使用 1.4 虚拟机运行会抛出 IncompatibleClassVersion 异常。

我必须同时找到一个解决方案才能让这个任务为这个需要 1.4 的特定项目工作，但是我遇到了一个问题。如果我没有特定的 java 版本，如何避免定义此任务并执行此可选步骤？

我可以在目标标签上使用“if”或“unless”标签，但它们只检查是否设置了属性。我也想有一个不需要额外库的解决方案，但我不知道标准中的内置功能是否足以执行这样的任务。

            回答 #1

赞同：10

时间：2008-09-29T08:10:54.627

Java 版本通过*ant.java.version*属性公开。使用*条件*设置属性并仅在其为真时执行任务。

```
<?xml version="1.0" encoding="UTF-8"?>

<project name="project" default="default">

    <target name="default" depends="javaCheck" if="isJava6">
        <echo message="Hello, World!" />
    </target>

    <target name="javaCheck">
        <echo message="ant.java.version=${ant.java.version}" />
        <condition property="isJava6">
            <equals arg1="${ant.java.version}" arg2="1.6" />
        </condition>
    </target>

</project> 
```

            回答 #2

赞同：2

时间：2008-09-29T08:18:19.990

在构建文件中检查的属性是`${ant.java.version}`.

[`<condition>`](http://ant.apache.org/manual/Tasks/conditions.html)当属性等于某个值时，您可以使用该元素使任务有条件：

```
<condition property="legal-java">
  <matches pattern="1.[56].*" string="${ant.java.version}"/>
</condition> 
```

        java - Hibernate序列生成的自定义

ID：147859

赞同：2

时间：2008-09-29T07:56:45.677

标签：java, hibernate

我有一个休眠序列，它在我的应用程序中生成所有序列号。当我从休眠（目标 Oracle10）生成模式时，它会生成：

```
create sequence hibernate_sequence; 
```

我想更改序列的配置。我必须使用类似的东西：

```
create sequence hibernate_sequence order nocache; 
```

每次创建脚本时，我都不喜欢更改生成的脚本。在哪里可以自定义hibernate生成的序列？

            回答 #1

赞同：2

时间：2008-09-29T11:32:55.063

您可以创建自定义序列生成器。有关详细信息，请参阅[http://www.hibernate.org/296.html](http://www.hibernate.org/296.html)。

        javascript - 您最喜欢的 Java Script WYSIWYG 编辑器组件是什么？

ID：147867

赞同：5

时间：2008-09-29T08:03:46.487

标签：javascript, html, editor, textarea, wysiwyg

我绝对喜欢 stackoverflow 上的那个，因为它干净简单。此外，带有代码/语法高亮显示的实时预览真的很有帮助（并且激励人心）。

你最喜欢的 Javascript 编辑器框架是什么，为什么？

            回答 #1

赞同：4

时间：2008-09-29T09:00:07.193

我喜欢[widgEditor](http://themaninblue.com/experiment/widgEditor/)，因为它非常简单，而且只做最少的事情。TinyMCE 或 FCKeditor 是商品，但它们对于我的需要来说太大了。

            回答 #2

赞同：3

时间：2008-09-29T08:06:39.787

[TinyMCE](http://tinymce.moxiecode.com/index.php)看起来不错，有很多有用的功能。

            回答 #3

赞同：3

时间：2008-09-29T08:36:16.000

我只是对[MarkItUp 感到困惑](http://markitup.jaysalvat.com/home/)，它基于 JQuery 并且适用于不同类型的标记。

如果您的标记不仅仅是 HTML，而是模板、论坛或“任何样式”标记，则可能是一种选择。

我找到了一个[编辑列表](http://blog.webdistortion.com/2008/03/09/9-of-the-best-rich-text-editors-reviewed/)及其功能。

            回答 #4

赞同：2

时间：2008-09-29T08:08:42.400

[简单文本编辑器](http://code.gosu.pl/dl/STE/demo/STE.html)是一个很好的（[STE 1.0](http://code.gosu.pl/dl/STE/STE.1.0.0.zip)）。

            回答 #5

赞同：2

时间：2008-09-29T08:13:32.843

在我的网络黑客时代，我经常使用新[哈](http://trac.xinha.org/)。

            回答 #6

赞同：1

时间：2008-09-29T08:16:56.187

我喜欢[FCKeditor](http://www.fckeditor.net/)，因为它很灵活，并且在我测试过的所有浏览器上都能正常工作。

            回答 #7

赞同：1

时间：2011-05-20T08:03:46.310

真的取决于你的需要，这里有你的选择：TinyMCE、NicEdit、FreeRichTextEditor、TinyEditor、openWYSIWYG、WYMeditor、jHtmlArea、uEditor、CLEditor、jQRTE、jQuery Simple WYSIWYG Editor、xinha、ckedit

            回答 #8

赞同：0

时间：2008-09-29T08:08:30.203

我爱[tiny_mce](http://tinymce.moxiecode.com/)

戈兰

        .net - 如何在不枚举的情况下将泛型字典转换为非泛型？

ID：147875

赞同：9

时间：2008-09-29T08:07:27.710

标签：.net, collections

我想将泛型[IDictionary](http://msdn.microsoft.com/en-us/library/s4ys34ea.aspx)的实例转换为非泛型[IDictionary](http://msdn.microsoft.com/en-us/library/system.collections.idictionary.aspx)。我可以在不创建[IDictionary](http://msdn.microsoft.com/en-us/library/system.collections.idictionary.aspx)的新实例的情况下做到这一点吗？是否有任何框架支持此任务？

我尝试在实现非遗传 IDictionary 的类中包装泛型 IDictionary 但是我发现我还必须以某种方式将泛型 ICollection 转换为非泛型，所以我使用 Mark Gravell 解决方案。

            回答 #1

赞同：20

时间：2008-09-29T08:16:29.823

这完全取决于您使用的*具体实现。*

例如， Dictionary<TKey,TValue> 实现了泛型 IDictionary<TKey,TValue> 和非泛型 IDictionary - 因此，如果您有 Dictionary<TKey,TValue> ，则可以毫无问题地使用它：

```
 Dictionary<int, string> lookup = new Dictionary<int,string>();
        IDictionary<int,string> typed = lookup;
        IDictionary untyped = lookup; 
```

但是，这不一定适用于所有 IDictionary<TKey,TValue> 实施，因为 IDictionary<TKey,TValue> : IDictionary 并非如此。如果您深入了解一些通用代码，您可以测试当前字典：

```
 IDictionary<int,string> typed  = ...
        IDictionary untyped = typed as IDictionary;
        if(untyped == null) {/* create by enumeration */} 
```

        javascript - Javascript 异常堆栈跟踪

ID：147891

赞同：98

时间：2008-09-29T08:11:04.267

标签：javascript, exception

在 Firefox 中，我可以使用`exception.stack`.

有没有办法在其他浏览器中也能做到这一点？

**编辑：**我实际上想自动保存堆栈跟踪（如果可能的话）而不是当时调试它（即我知道如何在调试器中获取堆栈跟踪）。

            回答 #1

赞同：83

时间：2013-01-28T13:02:59.993

将此行放在要打印堆栈跟踪的位置：

```
console.log(new Error().stack); 
```

**注意：**我在**Chrome 24**和**Firefox 18上测试过**

可能也值得看看[这个工具](https://github.com/ebobby/tracing.js)。

            回答 #2

赞同：23

时间：2011-04-21T10:48:36.110

Webkit 现在具有提供堆栈跟踪的功能：

[Web Inspector：了解堆栈跟踪](http://www.webkit.org/blog/1544/web-inspector-understanding-stack-traces/)，由 Yury Semikhatsky 于 2011 年 4 月 20 日星期三上午 7:32 发布 (webkit.org)

从那个帖子：

![](https://www.webkit.org/blog-files/inspector/stack-traces-img/4.png)

            回答 #3

赞同：3

时间：2014-04-22T22:30:42.093

如果你想要字符串堆栈跟踪，我会选择 insin 的答案：[stacktrace.js](http://www.stacktracejs.com/)。如果您想访问堆栈跟踪的各个部分（行号、文件名等）[stackinfo](https://github.com/fresheneesz/stackinfo)，它实际上在后台使用了 stacktrace.js。

            回答 #4

赞同：1

时间：2015-09-29T06:49:07.830

您必须尝试优秀的开源库[TraceKit](https://github.com/csnover/TraceKit/)，它尝试为所有主流浏览器中未处理的 JavaScript 异常创建堆栈跟踪。您可以阅读有关 Tracekit 的更多信息
[https://github.com/csnover/TraceKit/](https://github.com/csnover/TraceKit/)
**PS**：如果您正在寻找具有良好 UI 的服务（使用 Tracekit），您可以尝试[Atatus](https://www.atatus.com)。
[披露] 我在 Atatus 工作。

            回答 #5

赞同：0

时间：2008-09-29T08:13:08.117

不是真的，至少不容易。

在 IE 中，您可以使用 MS Script Debugger（由于某种原因是 Office 组件）或 Visual Studio 调试浏览器进程，然后您可以在断点处查看堆栈。

        sql-server - 在 SQL Server 中，我可以将多个节点从表中插入 XML 吗？

ID：147897

赞同：2

时间：2008-09-29T08:13:50.673

标签：sql-server, xml, tsql, insert, xquery

我想根据表中的数据在存储过程中生成一些 XML。

以下插入允许我添加许多节点，但它们必须进行硬编码或使用变量（sql:variable）：

```
SET @MyXml.modify('
      insert
         <myNode>
            {sql:variable("@MyVariable")}
         </myNode>
      into (/root[1]) ') 
```

所以我可以遍历表中的每条记录，将我需要的值放入变量中并执行上面的语句。

但是有没有一种方法可以通过结合 select 语句并避免循环来做到这一点？

**编辑**我以前`SELECT FOR XML`  做过类似的事情，但是在处理来自多个表的数据层次结构时，我总是觉得很难阅读。`modify`我希望使用生成的 XML 更明确、更可控的地方会有一些东西。

            回答 #1

赞同：7

时间：2008-09-29T14:21:17.107

您是否尝试过**嵌套**FOR XML PATH 标量值函数？使用嵌套技术，您可以将 SQL 分解为非常易于管理/可读的元素片段

免责声明：以下内容虽然改编自一个工作示例，但本身并未经过实际测试

一些供普通观众参考的链接

*   [http://msdn2.microsoft.com/en-us/library/ms178107(SQL.90).aspx](http://msdn2.microsoft.com/en-us/library/ms178107(SQL.90).aspx)
*   [http://msdn2.microsoft.com/en-us/library/ms189885(SQL.90).aspx](http://msdn2.microsoft.com/en-us/library/ms189885(SQL.90).aspx)

最简单、最底层的嵌套节点示例

考虑以下调用

```
DECLARE  @NestedInput_SpecificDogNameId int
SET @NestedInput_SpecificDogNameId = 99
SELECT [dbo].[udfGetLowestLevelNestedNode_SpecificDogName] 
(@NestedInput_SpecificDogNameId) 
```

假设在没有 FOR XML PATH 子句的情况下编写了 udfGetLowestLevelNestedNode_SpecificDogName，并且对于 @NestedInput_SpecificDogName = 99 它返回单个行集记录：

```
@SpecificDogNameId 狗名
99 天文

```

但是使用 FOR XML PATH 子句，

```
CREATE FUNCTION dbo.udfGetLowestLevelNestedNode_SpecificDogName
(
@NestedInput_SpecificDogNameId
)
    RETURNS XML
    AS
    BEGIN

        -- Declare the return variable here
        DECLARE @ResultVar XML

        -- Add the T-SQL statements to compute the return value here
        SET @ResultVar =
            (
            SELECT 
                  @SpecificDogNameId as "@SpecificDogNameId",
                  t.DogName 
            FROM tblDogs t
            FOR XML PATH('Dog')
            )

        -- Return the result of the function
        RETURN @ResultVar

END 
```

用户定义的函数生成以下 XML（@ 符号导致 SpecificDogNameId 字段作为属性返回）

```
<Dog SpecificDogNameId=99>Astro</Dog> 
```

嵌套 XML 类型的用户定义函数 

可以嵌套用户定义的函数，例如上面的 udfGetLowestLevelNestedNode_SpecificDogName，以提供强大的方法来生成复杂的 XML。

例如，函数

```
CREATE FUNCTION [dbo].[udfGetDogCollectionNode]()
    RETURNS XML
    AS
    BEGIN

        -- Declare the return variable here
        DECLARE @ResultVar XML

        -- Add the T-SQL statements to compute the return value here
        SET @ResultVar =
            (
                SELECT  
                [dbo].[udfGetLowestLevelNestedNode_SpecificDogName]
                        (t.SpecificDogNameId)
                FROM tblDogs t

                FOR XML PATH('DogCollection') ELEMENTS
            )
        -- Return the result of the function
        RETURN @ResultVar

END 
```

当被调用为

```
SELECT [dbo].[udfGetDogCollectionNode]() 
```

可能会产生复杂的 XML 节点（给定适当的基础数据）

```
<DogCollection>
    <Dog SpecificDogNameId="88">Dino</Dog>
    <Dog SpecificDogNameId="99">Astro</Dog>
</DogCollection> 
```

从这里开始，您可以继续在嵌套树中向上工作，以构建任意复杂的 XML 结构

```
CREATE FUNCTION [dbo].[udfGetAnimalCollectionNode]()
RETURNS XML
AS
BEGIN

DECLARE @ResultVar XML

SET @ResultVar =
(
SELECT 
dbo.udfGetDogCollectionNode(),
dbo.udfGetCatCollectionNode()
FOR XML PATH('AnimalCollection'), ELEMENTS XSINIL
)

RETURN @ResultVar

END 
```

当被调用为

```
SELECT [dbo].[udfGetAnimalCollectionNode]() 
```

udf 可能会生成更复杂的 XML 节点（给定适当的基础数据）

```
<AnimalCollection>
  <DogCollection>
    <Dog SpecificDogNameId="88">Dino</Dog>
    <Dog SpecificDogNameId="99">Astro</Dog>
  </DogCollection>
  <CatCollection>
    <Cat SpecificCatNameId="11">Sylvester</Cat>
    <Cat SpecificCatNameId="22">Tom</Cat>
    <Cat SpecificCatNameId="33">Felix</Cat>
  </CatCollection>
</AnimalCollection> 
```

            回答 #2

赞同：1

时间：2008-09-29T09:40:03.540

您能否详细说明您打算做什么。它是简单地根据表的内容生成 XML 数据，还是将表中的一些数据添加到现有的 xml 结构中？

Jacob Sebastian 撰写了关于 SQLServer 中 XML 主题的[精彩系列文章，它从](http://www.sqlservercentral.com/Authors/Articles/Jacob_Sebastian/212008/)[从表中的数据生成 XML 的基础知识开始](http://www.sqlservercentral.com/articles/SS2K5+-+XML/3022/)

            回答 #3

赞同：1

时间：2010-03-15T14:36:33.317

使用 sql:column 而不是 sql:variable。您可以在此处找到详细信息：http: [//msdn.microsoft.com/en-us/library/ms191214.aspx](http://msdn.microsoft.com/en-us/library/ms191214.aspx)

        c++ - Linux 配置文件库

ID：147902

赞同：27

时间：2008-09-29T08:17:25.297

标签：c++, c, linux, configuration, file

是否有任何好的配置文件读取 C\C++ 库，可用于在 linux 平台上编写的应用程序。我想为我的应用程序提供一个简单的配置文件。充其量我想避开可能会使用户感到困惑的 XML 文件。

            回答 #1

赞同：25

时间：2008-09-29T08:26:59.720

我会推荐' [libconfig](http://www.hyperrealm.com/libconfig/) '。

            回答 #2

赞同：11

时间：2008-09-29T08:21:25.617

你可以试试[glib 的 key-value-file-parser](http://library.gnome.org/devel/glib/unstable/glib-Key-value-file-parser.html)

            回答 #3

赞同：8

时间：2008-09-29T16:59:54.903

另一种选择是[Boost.PropertyTree](http://svn.boost.org/trac/boost/browser/trunk/boost/property_tree) ( [doc](http://kaalus.atspace.com/ptree/doc/index.html) )。它允许读/写 XML、INI、JSON 和 Info 文件。而且您可以免费获得便携性。

            回答 #4

赞同：6

时间：2008-09-29T08:21:43.587

[Boost program_options](http://www.boost.org/doc/libs/1_36_0/doc/html/program_options.html)这允许您从配置文件、环境变量和命令行中读取程序选项。它是便携式的，非常易于使用。

            回答 #5

赞同：1

时间：2008-09-29T08:45:13.390

如果您只想要一个简单的配置文件，其中包含命令列表和/或变量设置，那么编写自己的解析器非常容易，如此简单以至于可能不值得使用库。如果您需要更复杂的东西，那么解析器会迅速变得更加复杂，并且现有的库值得使用。

我从未尝试过使用 libconfig，但它看起来是个不错的选择，而且我喜欢它使用的配置文件的格式。

您需要决定是否希望您的程序能够编写配置文件。如果它是一个 GUI 程序，您可能会这样做。这将影响哪些库是合适的。

            回答 #6

赞同：1

时间：2012-11-09T05:29:31.030

对于单个应用程序，您可以考虑[libconfuse](http://www.nongnu.org/confuse/)。

如果您需要能够处理多种配置文件格式（例如，对于系统的 Web 门户，它需要从许多应用程序中读取和写入多种格式的配置文件），可以[使用 Augeas](http://augeas.net/)。

            回答 #7

赞同：0

时间：2008-12-08T23:07:53.023

问题是您想到的文件格式是什么？属性“simple”有点不规范。如果您正在寻找可以使用“windows .ini 格式”配置文件的库，您可能需要查看 ACE [http://www.cs.wustl.edu/~schmidt/ACE/](http://www.cs.wustl.edu/~schmidt/ACE/)。

        toad - 用于导航的选项卡式 VS 树。哪个是首选方法？

ID：147906

赞同：0

时间：2008-09-29T08:18:04.923

标签：toad

我意识到在 TOAD 书籍中，它证明了为什么它使用选项卡式窗格的原因是树视图涉及太多滚动。

但对我来说，我更喜欢树视图。因为它只向您显示顶层。我看到 TOAD 用户界面。我认为选项卡式面板让我无法切换。

您对此有何看法？

            回答 #1

赞同：1

时间：2008-09-29T14:42:23.860

我认为一般来说，如果您正在设计界面，我认为这取决于您尝试显示的项目数量。

在您的 TOAD 示例中。（我假设是来自 www.quest.com 的 Toad）选项卡仅用于从树中删除 1 级（顶层）。

树结构的优点是您可以“向下钻取”从方案到表再到触发器等。

所以这真的取决于你想要达到的目标，或者你想要使用的风格。

        wpf - 如何对 ColumnDefinition 的 Width 或 RowDefinition 的 Height 进行数据绑定？

ID：147908

赞同：38

时间：2008-09-29T08:18:32.457

标签：wpf, data-binding, grid, column-width, row-height

在 WPF 的 View-Model-ViewModel 模式下，我试图对网格控件的各种定义的高度和宽度进行数据绑定，以便在使用 GridSplitter 后存储用户设置的值。但是，正常模式似乎不适用于这些特定属性。

*注意：我将此作为参考问题发布，因为谷歌让我失望了，我不得不自己解决这个问题。我自己的答案要遵循。*

            回答 #1

赞同：46

时间：2011-09-09T07:32:58.940

创建`IValueConverter`如下：

```
public class GridLengthConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        double val = (double)value;
        GridLength gridLength = new GridLength(val);

        return gridLength;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        GridLength val = (GridLength)value;

        return val.Value;
    }
} 
```

然后，您可以在 Binding 中使用转换器：

```
<UserControl.Resources>
    <local:GridLengthConverter x:Key="gridLengthConverter" />
</UserControl.Resources>
...
<ColumnDefinition Width="{Binding Path=LeftPanelWidth, 
                                  Mode=TwoWay,
                                  Converter={StaticResource gridLengthConverter}}" /> 
```

            回答 #2

赞同：22

时间：2008-09-29T08:25:28.990

我发现了一些陷阱：

1.  尽管它在 XAML 中可能看起来像双精度，但 *Definition 的高度或宽度的实际值是一个“GridLength”结构。
2.  GridLength 的所有属性都是只读的，每次更改时都必须创建一个新属性。
3.  与 WPF 中的所有其他属性不同，Width 和 Height 不会将它们的数据绑定模式默认为“TwoWay”，您必须手动设置它。

因此，我使用了以下代码：

```
private GridLength myHorizontalInputRegionSize = new GridLength(0, GridUnitType.Auto)
public GridLength HorizontalInputRegionSize
{
    get
    {
        // If not yet set, get the starting value from the DataModel
        if (myHorizontalInputRegionSize.IsAuto)
            myHorizontalInputRegionSize = new GridLength(ConnectionTabDefaultUIOptions.HorizontalInputRegionSize, GridUnitType.Pixel);
        return myHorizontalInputRegionSize;
    }
    set
    {
        myHorizontalInputRegionSize = value;
        if (ConnectionTabDefaultUIOptions.HorizontalInputRegionSize != myHorizontalInputRegionSize.Value)
        {
            // Set the value in the DataModel
            ConnectionTabDefaultUIOptions.HorizontalInputRegionSize = value.Value;
        }
        OnPropertyChanged("HorizontalInputRegionSize");
    }
} 
```

和 XAML：

```
<Grid.RowDefinitions>
    <RowDefinition Height="*" MinHeight="100" />
    <RowDefinition Height="Auto" />
    <RowDefinition Height="{Binding Path=HorizontalInputRegionSize,Mode=TwoWay}" MinHeight="50" />
</Grid.RowDefinitions> 
```

            回答 #3

赞同：7

时间：2015-05-06T17:17:07.787

最简单的解决方案是简单地为这些属性使用字符串设置，以便 WPF 使用 GridLengthConverter 自动支持它们，而无需任何额外工作。

            回答 #4

赞同：4

时间：2008-09-29T21:33:25.993

另一种可能性，因为您提出了在`GridLength`and之间进行转换`int`，所以在绑定到 时创建`IValueConverter`并使用它`Width`。`IValueConverter`s 也处理双向绑定，因为它们同时具有`ConvertTo()`和`ConvertBack()`方法。

        asp.net - 我的 ASP.NET 状态服务消失在哪里了？

ID：147909

赞同：0

时间：2008-09-29T08:18:33.657

标签：asp.net, webserver

前几天，我将 ASP.NET State 服务设置为在托管的 VSP Win 2003 服务器上自动启动。我今天回来了，服务完全不见了！？

任何想法为什么它已经消失以及如何取回它？谢谢！

            回答 #1

赞同：1

时间：2008-09-29T08:23:37.967

您应该询问您的托管服务提供商，他们可能已将其删除（出于某种原因）。

            回答 #2

赞同：0

时间：2011-01-25T10:26:24.650

我遇到了同样的问题，ASP.NET 状态服务从管理工具/服务列表中消失了。并且命令“net start aspnet_state”也不起作用。

对我来说，在对当前最新的 .net 版本进行修复后，它运行良好。就我而言，Net 4.0。

        toad - 如何使用 Toad 检查数据库的整体运行状况？

ID：147910

赞同：0

时间：2008-09-29T08:19:11.143

标签：toad

有人知道吗？还有任何开源软件也可以执行这种功能？

            回答 #1

赞同：1

时间：2008-09-29T08:25:14.217

Toad 的 DBA 版本具有这样的功能。在我的版本中，它位于 DBA 菜单下，称为“健康检查”。

截图[http://toadsoft.com/get2know96/Web/](http://toadsoft.com/get2know96/Web/)

            回答 #2

赞同：1

时间：2013-09-05T22:43:26.617

来自 Quest Software：[http ://www.youtube.com/watch?v=02LmtxyRVJ8](http://www.youtube.com/watch?v=02LmtxyRVJ8)

在 Toad 11 中，主菜单 -> 数据库 -> 诊断 -> 数据库运行状况检查。您可以[在 ToadWorld](http://www.toadworld.com/products/toad-for-oracle/b/weblog/archive/2013/07/07/toad-database-health-check.aspx)了解更多信息，尽管这可能是针对较新版本的。

        toad - 使用 Toad 监控当前在共享池中的 SQL

ID：147913

赞同：1

时间：2008-09-29T08:21:04.307

标签：toad

有人知道吗？还有任何开源软件也可以执行这种功能？

            回答 #1

赞同：2

时间：2008-09-29T08:38:02.177

蟾蜍做到了。它位于工具|SGA 跟踪/优化下。

这是您的开源解决方案:-)

```
 select distinct
       vs.sql_text, vs.sharable_mem, vs.persistent_mem, vs.runtime_mem, vs.sorts, vs.executions,
       vs.parse_calls, vs.module, vs.action, vs.buffer_gets, vs.disk_reads, vs.version_count,
       vs.loaded_versions, vs.open_versions, vs.users_opening, vs.loads, vs.users_executing,
       vs.invalidations, vs.serializable_aborts, vs.command_type,
       to_char(to_date(vs.first_load_time,'YYYY-MM-DD/HH24:MI:SS'),'MM/DD  HH24:MI:SS') first_load_time,
       rawtohex(vs.address) address, vs.hash_value hash_value, vs.parsing_user_id
       ,rows_processed 
       ,optimizer_mode
       ,vs.is_obsolete, vs.elapsed_time, vs.cpu_time
       ,vs.Child_latch, vs.fetches
       ,vs.program_id,vs.java_exec_time,vs.plsql_exec_time,vs.user_io_wait_time,
       vs.cluster_wait_time, vs.concurrency_wait_time, vs.application_wait_time,
       vs.direct_writes,  vs.end_of_fetch_count
from   v$sqlarea vs 
```

        database - 监控数据库实例

ID：147917

赞同：0

时间：2008-09-29T08:21:53.057

标签：database, monitoring, toad

有人知道吗？还有任何开源软件也可以执行这种功能？

            回答 #1

赞同：1

时间：2008-09-29T08:35:50.277

我不确定您需要什么，但[http://www.nagios.org/](http://www.nagios.org/)是否足以满足您的目的？

            回答 #2

赞同：0

时间：2008-10-01T15:55:48.753

你看过[OpenNMS](http://opennms.org)吗？

            回答 #3

赞同：0

时间：2009-09-01T08:06:02.450

纳吉奥斯呢？以下是 MySQL、MS-SQL、Oracle 的一些推荐脚本：http:
 [//www.consol.de/opensource/nagios/](http://www.consol.de/opensource/nagios/)

            回答 #4

赞同：0

时间：2009-09-01T08:16:05.143

+1 建议您向我们提供有关您要监控的内容和平台的更多详细信息。

我使用[Hyperic](http://www.hyperic.com/)并且非常满意

[我也看过OpenNMS](http://www.opennms.org/wiki/Main_Page)，与[Nagios](http://www.nagios.org/)一样，我建议下载其中的 3 个，或者稍微阅读一下它们，然后选择一个并继续使用。[在我看来， Hyperic比](http://www.hyperic.com/)[Nagios](http://www.nagios.org/)更容易实现，[OpenNMS](http://www.opennms.org/wiki/Main_Page)我没有为自己尝试。据我所知，这三个是大型开源监控解决方案。

            回答 #5

赞同：0

时间：2008-09-29T08:53:26.817

什么数据库？什么平台？

如果是 MySQL，周围有很多监控应用程序 - 例如，[MySQL GUI 工具](http://dev.mysql.com/downloads/gui-tools/5.0.html)包括一个 Health Monitor 小部件（在 OS X 上）

此外，phpMyAdmin 显示来自 MySQL 服务器的统计信息。

您还可以编写一个连接到数据库的简单脚本，执行一些简单的命令并检查它是否返回一个已知值。如果没有，请在某处发送警报。

            回答 #6

赞同：0

时间：2008-10-13T07:14:05.580

您可能想查看 cacti ( [http://www.cacti.net/what_is_cacti.php](http://www.cacti.net/what_is_cacti.php) )，它是用于提供任何类型数据的图形表示的通用工具。我们用它来查看我们的网络服务器和 mysql 服务器的健康程度。但据我所知，它没有任何警报系统（以防万一发生紧急情况并且您需要立即采取行动），您可能希望将 nagios 视为已经有人指出的。请参阅下面的屏幕截图以了解下面的 mysql。屏幕截图显示了各种图表，用于显示一段时间内 mysql 服务器的各种状态：

[http://www.xaprb.com/blog/2008/05/25/screenshots-of-improved-mysql-cacti-templates/](http://www.xaprb.com/blog/2008/05/25/screenshots-of-improved-mysql-cacti-templates/)

如果您的数据库不是 mysql，则 google 搜索“your_database_name cacti”以查找您的数据库的模板。

            回答 #7

赞同：0

时间：2008-10-15T10:13:10.240

我不确定我是否理解你的问题，但我使用 nagios 来监控我服务器上的任何东西......

            回答 #8

赞同：0

时间：2008-09-29T11:15:23.450

这在很大程度上取决于什么样的数据库以及您正在监视什么。

您可能正在监视的事情：

*   数据库还在吗？  
*   数据库的负载有多大？
*   死锁？
*   安全事件？
*   例外？

也许您可以编辑您的问题以填写更多信息？  

        windows-vista - Vista 上的 SBCL 崩溃。你知道如何让它工作吗？

ID：147918

赞同：3

时间：2008-09-29T08:22:13.710

标签：windows-vista, lisp, crash, sbcl

我在网上搜索了很多关于这个问题的答案：他们说这是真的，SBCL 在 Vista 下不起作用。但是我真的需要在我的家用 Vista 笔记本电脑上使用 lisp，而 VM 并没有真正的帮助......而且 CL 并不是那么有趣，因为速度......

如果你有什么建议，请分享！

            回答 #1

赞同：5

时间：2008-09-29T09:52:01.203

你看过这些文章吗？

[http://robert.zubek.net/blog/2008/04/09/sbcl-emacs-windows-vista/](http://robert.zubek.net/blog/2008/04/09/sbcl-emacs-windows-vista/)

[http://brainrack.wordpress.com/2008/05/29/running-sbcl-on-windows/](http://brainrack.wordpress.com/2008/05/29/running-sbcl-on-windows/)

            回答 #2

赞同：0

时间：2009-10-03T01:03:27.133

确保您为 SBCL 关闭了 DEP。

        c++ - 您可以在 VS 2008 中的 C++ 中创建类似 #Region 的可折叠范围吗？

ID：147920

赞同：9

时间：2008-09-29T08:23:20.433

标签：c++, visual-studio, visual-studio-2008, pragma, readability

我非常想念它（在 C# 中经常使用它）。你能用 C++ 做吗？

            回答 #1

赞同：18

时间：2008-09-29T08:34:24.727

是的你可以。见[这里](http://msdn.microsoft.com/en-us/library/b6xkz944(VS.80).aspx)。

```
#pragma region Region_Name
//Your content.
#pragma endregion Region_Name 
```

            回答 #2

赞同：1

时间：2008-09-29T10:24:10.063

用于 VC 的 Visual Assist 加载项支持 C++ 区域。不知道 2008 年是否已经为 C++ 构建了区域。

            回答 #3

赞同：1

时间：2015-05-22T14:11:28.283

对于 VBers：

```
#Region "identifier_string" 
' Your content
#End Region 
```

[https://msdn.microsoft.com/en-us/library/sd032a17.aspx](https://msdn.microsoft.com/en-us/library/sd032a17.aspx)

        sql - 如何使用 SQLab Xpert Tuning 调整 SQL 以获得更好的性能？

ID：147921

赞同：0

时间：2008-09-29T08:23:21.103

标签：sql, oracle, performance

有人知道吗？还有任何开源软件也可以执行这种功能？

            回答 #1

赞同：1

时间：2008-09-29T08:46:48.440

我不确定你在问什么，这很简单，你输入你的 SQL，SQLLab Xpert 会尝试多种组合来重写你的查询并运行它们，选择最快的。我发现这种方法有点可疑，您可能会得到比原来运行得更快的东西，但可能不是最快的（除非它是非常简单的 SQL）。

我更喜欢手动调优，Oracle 性能手册[http://download.oracle.com/docs/cd/B28359_01/server.111/b28274/toc.htm](http://download.oracle.com/docs/cd/B28359_01/server.111/b28274/toc.htm)第 11-20 章包含您需要的所有信息，在我的意见比 SQLLab Xpert 采用的霰弹枪方法更好。

        svn - 任何人都有提交通知挂钩脚本，将在提交代码时发送电子邮件？

ID：147924

赞同：2

时间：2008-09-29T08:24:31.833

标签：svn, email

可以和我分享这个脚本吗？

            回答 #1

赞同：2

时间：2008-09-29T08:37:42.753

默认的被称为 commit-email.pl 并且在您安装 Subversion 时包含在内。但[这里](http://blog.hungrymachine.com/2007/11/5/pretty-svn-commit-emails)有一个红宝石：

```
#!/usr/bin/ruby -w

# A Subversion post-commit hook. Edit the configurable stuff below, and
# copy into your repository's hooks/ directory as "post-commit". Don't
# forget to "chmod a+x post-commit".

# ------------------------------------------------------------------------

# You *will* need to change these.

address="FOO@SOME_DOMAIN.com"
sendmail="/usr/sbin/sendmail"
svnlook="/usr/bin/svnlook"

# ------------------------------------------------------------------------

require 'cgi'

# Subversion's commit-email.pl suggests that svnlook might create files.
Dir.chdir("/tmp")

# What revision in what repository?
repo = ARGV.shift()
rev = ARGV.shift()

# Get the overview information.
info=`#{svnlook} info #{repo} -r #{rev}`
info_lines=info.split("\n")
author=info_lines.shift
date=info_lines.shift
info_lines.shift
comment=info_lines

# Output the overview.
body = "<p><b>#{author}</b> #{date}</p>"
body << "<p>"
comment.each { |line|  body << "#{CGI.escapeHTML(line)}<br/>\n" }
body << "</p>"
body << "<hr noshade>"

# Get and output the patch.
changes=`#{svnlook} diff #{repo} -r #{rev}`
body << "<pre>"
changes.each do |top_line|
  top_line.split("\n").each do |line|
    color = case
      when line =~ /^Modified: / || line =~ /^=+$/ || line =~ /^@@ /: "gray"
      when line =~ /^-/: "red"
      when line =~ /^\+/: "blue"
      else "black"
    end
    body << %Q{<font style="color:#{color}">#{CGI.escapeHTML(line)}</font><br/>\n}
 end
end
body << "</pre>"

# Write the header.
header = ""
header << "To: #{address}\n"
header << "From: #{address}\n"
header << "Subject: [SVN] #{repo} revision #{rev}\n"
header << "Reply-to: #{address}\n"
header << "MIME-Version: 1.0\n"
header << "Content-Type: text/html; charset=UTF-8\n"
header << "Content-Transfer-Encoding: 8bit\n"
header << "\n"

# Send the mail.
begin
    fd = open("|#{sendmail} #{address}", "w")
    fd.print(header)
    fd.print(body)
rescue
    exit(1)
end
fd.close

# We're done.
exit(0) 
```

            回答 #2

赞同：2

时间：2008-09-29T08:59:03.950

出于某种原因，ruby 脚本和默认的钩子脚本对我不起作用。这可能是由于我们的邮件服务器有些奇怪，但无论如何我都会在这里包含重要的部分：

```
#!/bin/sh

REPOS="$1"
REV="$2"

svnnotify --repos-path "$REPOS" --revision "$REV" --with-diff --to mailinglist@server.domain --smtp mailserver.domain --from svn@server.domain -VVVVVVVVV -P "[repository_name]" 
```

如果您想在脚本之外测试命令，-VVVVVVV 部分会显示非常详细的消息。它应该在实际脚本中删除。

当然，要让它工作，你需要安装 svnnotify。您可以通过首先安装 cpan 来安装它，它应该随 perl 一起提供。然后你需要启动 cpan 并安装 SVN::Notify 库。

```
$ cpan
cpan> install SVN::Notify 
```

请注意，'$' 和 'cpan>' 部分只是提示，您不需要输入它们。

这个解决方案对我来说更有吸引力，因为它提供了详细的错误消息，有助于解决我提到的邮件服务器的这些问题。我们还有多个存储库，因此将整个程序/脚本复制到每个目录中是多余的。你的旅费可能会改变。

顶部代码块中的文本应放在名为“post-commit”的文本文件中。该文件应位于 /path/to/svn/repos/repository_name/hooks 并标记为可执行文件。

            回答 #3

赞同：1

时间：2008-09-29T08:43:18.497

在 svn 存储库的 hooks 目录中，您会找到一个 post-commit.tmpl 脚本。将其复制以命名为“post-commit”并对其进行编辑以适应。通常它会运行 subversion 自带的 commit-email.pl 脚本；这还需要编辑以设置您想要的东西。

            回答 #4

赞同：1

时间：2011-03-10T00:53:49.733

```
#!/bin/ksh
#
# This is a custom post-commit for sending email
# when an svn repo is changed.
#

rcpts="foo@bar.edu, baz@bar.edu"

repodir=$1
revision=$2

author=`/usr/bin/svnlook author  -r $revision $repodir`
date=`/usr/bin/svnlook   date    -r $revision $repodir`
log=`/usr/bin/svnlook    log     -r $revision $repodir`
info=`/usr/bin/svnlook   changed -r $revision $repodir`

repo=${repodir##*/}

subject="$repo svn updated by $author"

url="https://myserver.bar.edu/svn/$repo"

/usr/bin/mail -s "$subject" "$rcpts"<<EOM
repository: $url
date:       $date
username:   $author
revision:   $revision
comment:    $log

$info
EOM 
```

            回答 #5

赞同：0

时间：2015-04-18T09:43:10.967

尝试这个

`/usr/bin/svnnotify --revision "$REV" --repos-path "$REPOS" \
  --subject-cx --subject-prefix "[Project:commit] " --max-sub-length 128 \
 --with-diff --handler Alternative --alt HTML::ColorDiff \
 --to 'abc@xyz.com' --from 'svn@xyz.com' --set-sender`

        c# - 获取不存在的文件夹名称的最佳方法是什么？

ID：147925

赞同：3

时间：2008-09-29T08:24:56.263

标签：c#, directory

获取包含我可以确定不存在的文件夹名称的字符串的最佳方法是**什么**？也就是说，如果我调用`DirectoryInfo.Exists`给定的路径，它应该返回 false。

编辑：其背后的原因是我正在为错误检查器编写测试，错误检查器测试路径是否存在，所以我想知道获得不存在路径的最佳方法。

            回答 #1

赞同：9

时间：2008-09-29T08:29:48.387

以 GUID 命名 -~~只需去掉非法字符。~~

            回答 #2

赞同：6

时间：2008-09-29T08:29:12.867

没有任何方法可以精确地按照您想要的方式做。如果您考虑一下，您会发现即使在调用`DirectoryInfo.Exists`返回 false 之后，其他一些程序也可能继续创建目录 - 这是一个竞争条件。

处理此问题的常规方法是创建一个新的临时目录 - 如果创建成功，那么您就知道它在创建之前不存在。

            回答 #3

赞同：5

时间：2008-09-29T08:28:10.450

好吧，如果不创建目录，您可以确定的是它在几微秒前并不存在。这是一种可能足够接近的方法：

```
 string path = Path.GetTempFileName();
        File.Delete(path);
        Directory.CreateDirectory(path); 
```

请注意，这会创建目录以阻止线程竞争（即另一个进程/线程从您下面窃取目录）。

            回答 #4

赞同：4

时间：2008-09-29T09:13:13.963

我最终使用的是：

```
using System.IO;

string path = Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString()); 
```

（此外，您似乎不需要从 guid 中删除字符 - 它们会生成合法的文件名）

            回答 #5

赞同：0

时间：2008-09-29T08:27:53.680

好吧，一个不错的选择是将用户名、今天的日期和时间等字符串连接到毫秒。

不过我很好奇：你为什么要这样做？它应该是为了什么？

            回答 #6

赞同：0

时间：2008-09-29T08:31:04.953

这是创建一个临时文件夹还是什么？我经常使用 Guid.NewGuid 来获取一个字符串，用于您想要确定的文件夹名称不存在。

            回答 #7

赞同：0

时间：2008-09-29T08:32:13.063

我认为你可以足够接近：

字符串目录名 = Guid.NewGuid.ToSrtring();

由于 Guid 是相当随机的，你不应该得到 2 个相同的目录。

            回答 #8

赞同：0

时间：2008-09-29T08:32:57.833

在名称空间中使用新生成的 GUID 也有点独特（例如，您的应用程序/产品的名称）应该可以得到您想要的。例如，以下代码*极*不可能失败：

```
string ParentPath = System.IO.Path.Combine(Environment.GetEnvironmentVariable("TEMP"), "MyAppName");
string UniquePath = System.IO.Path.Combine(ParentPath, Guid.NewGuid().ToString());
System.IO.Directory.CreateDirectory(UniquePath); 
```

        c# - C# - 从 C# 应用程序向 Google Chrome 发送消息

ID：147929

赞同：19

时间：2008-09-29T08:25:35.480

标签：c#, google-chrome, message

我一直在四处寻找，但我还没有找到如何从 C# 中做到这一点。

我想这样做，这样我就可以告诉 Google Chrome从我的 C# 应用程序中**前进**、**后退**、**打开新选项卡**、**关闭选项卡**、**打开新窗口**和**关闭窗口。**

我使用 WinAmp 做了类似的事情

```
[DllImport("user32", EntryPoint = "SendMessageA")]
private static extern int SendMessage(int Hwnd, int wMsg, int wParam, int lParam); 
```

和其他一些人。但我不知道要发送什么消息或如何找到将其传递到哪个窗口或任何东西。

那么有人可以告诉我如何将这 6 个命令从 C# 发送到 Chrome 吗？谢谢

编辑：好的，我被否决了，所以也许我不够清楚，或者人们认为我没有试图自己解决这个问题。

首先，我对整个 DllImport 的东西不是很好。我仍在学习这一切是如何运作的。

几年前我发现了如何在winamp中做同样的想法，我正在查看我的代码。我这样做是为了让我可以从我的 C# 代码中跳过一首歌曲、返回、播放、暂停和停止 winamp。我从导入开始：

```
 [DllImport("user32.dll", CharSet = CharSet.Auto)]
    public static extern IntPtr FindWindow([MarshalAs(UnmanagedType.LPTStr)] string lpClassName, [MarshalAs(UnmanagedType.LPTStr)] string lpWindowName);
    [DllImport("user32.dll", CharSet = CharSet.Auto)]
    static extern int SendMessageA(IntPtr hwnd, int wMsg, int wParam, uint lParam);
    [DllImport("user32.dll", CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    public static extern int GetWindowText(IntPtr hwnd, string lpString, int cch);
    [DllImport("user32", EntryPoint = "FindWindowExA")]
    private static extern int FindWindowEx(int hWnd1, int hWnd2, string lpsz1, string lpsz2);
    [DllImport("user32", EntryPoint = "SendMessageA")]
    private static extern int SendMessage(int Hwnd, int wMsg, int wParam, int lParam); 
```

然后我发现使用它的代码将这些常量用于我发送的消息。

```
 const int WM_COMMAND = 0x111;
    const int WA_NOTHING = 0;
    const int WA_PREVTRACK = 40044;
    const int WA_PLAY = 40045;
    const int WA_PAUSE = 40046;
    const int WA_STOP = 40047;
    const int WA_NEXTTRACK = 40048;
    const int WA_VOLUMEUP = 40058;
    const int WA_VOLUMEDOWN = 40059;
    const int WINAMP_FFWD5S = 40060;
    const int WINAMP_REW5S = 40061; 
```

我将通过以下方式获取*hwnd*（将消息发送到的程序）：

```
IntPtr hwnd = FindWindow(m_windowName, null); 
```

然后我会向该程序发送一条消息：

```
SendMessageA(hwnd, WM_COMMAND, WA_STOP, WA_NOTHING); 
```

我假设我会为 Google Chrome 做一些与此非常相似的事情。但我不知道其中一些值应该是什么，我四处搜索试图找到答案，但我做不到，这就是我在这里问的原因。所以我的问题是如何获得以下值：

**m_windowName**和**WM_COMMAND**

然后，不同命令的值，**前进**，**后退**，**新标签**，**关闭标签**，**新窗口**，**关闭窗口**？

            回答 #1

赞同：10

时间：2008-09-29T08:33:26.303

[在http://dev.chromium.org/developers](http://dev.chromium.org/developers)开始您的研究

**编辑**：向窗口发送消息只是工作的一半。窗口必须响应该消息并采取相应措施。如果该窗口不知道消息或根本不在乎，您就没有机会通过发送窗口消息来控制它。

您正在查看有关如何远程控制 Winamp 的实现细节。发送消息只是其中一种方式，也是 Winamp 开发人员选择的方式。您使用的那些消息是用户定义的消息，*仅对*Winamp 具有特定含义。

第一步你要做的是找出Chromium*是否*支持某种远程控制以及这些机制是什么。

            回答 #2

赞同：7

时间：2008-09-29T09:08:02.367

您可以使用 Visual Studio 的 Spy++ 并按 CTRL+F 轻松获取窗口名称，然后找到 chrome。我试过了，得到了

外窗的“Chrome_VistaFrame”。包含网页的实际窗口是“Chrome_RenderWidgetHostHWND”。

就 WM_COMMAND 而言 - 您需要进行试验。您显然想要发送按钮点击（我头顶的 WM_MOUSEDOWN）。由于后退，前进按钮不是它们自己的窗口，因此您需要弄清楚如何通过在某个 x，y 位置模拟鼠标单击来做到这一点，以便 chrome 知道您在做什么。或者您可以发送等效于后退/前进等的键盘快捷键。

我前段时间写的一个例子是用 trillian 和 winamp 做的：[通过 c# 和 winapi 向 windows 发送消息](http://www.sloppycode.net/code-snippets/cs/sendmessage.aspx)

还有一些工具可以使用脚本语言来宏处理这种事情——我用过 autoit：[autoit.com](http://www.autoitscript.com/)

            回答 #3

赞同：4

时间：2008-09-29T18:59:34.023

好的，这就是我到目前为止所得到的......我有点知道我需要做什么，但这只是现在做的问题......

这是 Spy++ 的窗口，我锁定了***Chrome_RenderWidgetHostHWND***并单击了键盘上的后退按钮。这是我得到的：
![替代文字](https://i17.photobucket.com/albums/b92/xahrepap/MessagesToChrome.jpg)

所以这是我的假设，我现在一直在玩这个，我只是无法弄清楚这些*值*。

```
IntPtr hWnd = FindWindow("Chrome_RenderWidgetHostHWND", null);
SendMessage(hWnd, WM_KEYDOWN, VK_BROWSER_BACK, 0);
SendMessage(hWnd, WM_KEYUP,   VK_BROWSER_BACK, 0); 
```

现在，我只是不知道应该使 WM_KEYDOWN/UP 值或 VK_BROWSER_BACK/FORWARD 值做什么......我试过这个：

```
const int WM_KEYDOWN = 0x100;
const int WM_KEYUP = 0x101;
const int VK_BROWSER_BACK = 0x6A;
const int VK_BROWSER_FORWARD = 0x69; 
```

我从刚刚展示的图像中获得的后两个值，即这两个键的 ScanCodes。我不知道我是否做得对。我在谷歌搜索 WM_KEYDOWN 值后得到的前两个值，有人使用 &H100 和 &H101 作为这两个值。我尝试了其他几个我见过的随机想法。我就是想不通。

哦，这是 SendMessage 方法

```
 [DllImport("user32.dll", CharSet = CharSet.Auto)]
    static extern int SendMessage(IntPtr hwnd, int wMsg, int wParam, uint lParam); 
```

            回答 #4

赞同：4

时间：2008-09-30T09:25:09.900

这是一个很好的互操作常量站点：

[呼唤](http://www.pinvoke.net/default.aspx/Constants/WM.html)

另一种查找值的方法是搜索 koders.com，使用 C# 作为语言，查找 WM_KEYDOWN 或您所追求的常量：

[Koders.com 搜索](http://www.koders.com/csharp/fid8BD335C635A86401444DEA430B544BDBBA054183.aspx?s=WM_KEYDOWN+%3d#L94)

&H 值看起来像是来自 VB(6)。pinvoke 和 koders 都返回 VK_BROWSER_FORWARD 的结果，

```
private const UInt32 WM_KEYDOWN        = 0x0100;
private const UInt32 WM_KEYUP          = 0x0101;

public const ushort VK_BROWSER_BACK = 0xA6;
public const ushort VK_BROWSER_FORWARD = 0xA7;
public const ushort VK_BROWSER_REFRESH = 0xA8;
public const ushort VK_BROWSER_STOP = 0xA9;
public const ushort VK_BROWSER_SEARCH = 0xAA;
public const ushort VK_BROWSER_FAVORITES = 0xAB;
public const ushort VK_BROWSER_HOME = 0xAC; 
```

（有趣的是，考虑到 VK_* 是 1 个字节的 0-255 值，并且人们已经将它们设为 uint，有多少 VK 常量的错误定义在浮动，这很有趣）。

看起来与您的常量略有不同。我认为您所追求的功能是 SendInput （但我没有尝试过），因为它是一个虚拟键。

```
[DllImport("User32.dll")]
private static extern uint SendInput(uint numberOfInputs, [MarshalAs(UnmanagedType.LPArray, SizeConst = 1)] KEYBOARD_INPUT[] input, int structSize); 
```

参数说明：

参数

*   nInputs - pInputs 数组中的结构数。
*   pInputs - 指向 INPUT 结构数组的指针。每个结构代表一个要插入键盘或鼠标输入流的事件。
*   cbSize - 指定 INPUT 结构的大小（以字节为单位）。如果 cbSize 不是 INPUT 结构的大小，则函数失败。

这需要一个 KEYBOARD_INPUT 类型：

```
[StructLayout(LayoutKind.Sequential)] 
public struct KEYBOARD_INPUT
{ 
    public uint type; 
    public ushort vk; 
    public ushort scanCode; 
    public uint flags; 
    public uint time; 
    public uint extrainfo; 
    public uint padding1; 
    public uint padding2; 
} 
```

最后是一个样本，我没有测试它是否有效：

```
/*
typedef struct tagKEYBDINPUT {
    WORD wVk;
    WORD wScan;
    DWORD dwFlags;
    DWORD time;
    ULONG_PTR dwExtraInfo;
} KEYBDINPUT, *PKEYBDINPUT;
*/
public static void sendKey(int scanCode, bool press)
{
        KEYBOARD_INPUT[] input = new KEYBOARD_INPUT[1];
        input[0] = new KEYBOARD_INPUT();
        input[0].type = INPUT_KEYBOARD;
        input[0].vk = VK_BROWSER_BACK;

    uint result = SendInput(1, input, Marshal.SizeOf(input[0]));
} 
```

您还需要使用[SetForegroundWindow聚焦 Chrome 窗口](http://www.pinvoke.net/default.aspx/user32/SetForegroundWindow.html)

        svn - 在每次构建应用程序时创建一个标签？

ID：147933

赞同：2

时间：2008-09-29T08:26:34.947

标签：svn

有人在 ANT Build 中这样做吗？这意味着每个特定目标都被称为例如 build-sit。将在 svn respositoyr 中创建一个标签来引用该特定的坐版本。

知道该怎么做吗？

            回答 #1

赞同：1

时间：2008-09-29T08:31:30.833

[http://subclipse.tigris.org/svnant/svn.html](http://subclipse.tigris.org/svnant/svn.html)

很容易整合。

        c# - 如何在 C# 中两次读取 Http 响应流？

ID：147941

赞同：40

时间：2008-09-29T08:29:14.600

标签：c#, stream

我正在尝试通过以下方式读取 Http 响应流两次：

```
HttpWebResponse response = (HttpWebResponse)request.GetResponse();
stream = response.GetResponseStream();
RssReader reader = new RssReader(stream);
do
{
  element = reader.Read();
  if (element is RssChannel)
  {
    feed.Channels.Add((RssChannel)element);
  }
} while (element != null);

StreamReader sr = new StreamReader(stream);
feed._FeedRawData = sr.ReadToEnd(); 
```

但是，当 StreamReader 代码执行时，不会返回任何数据，因为流现已到达末尾。我试图通过 stream.Position = 0 重置流，但这会引发异常（我认为是因为流无法手动更改其位置）。

基本上，我想解析 XML 流并访问原始数据（字符串格式）。

有任何想法吗？

            回答 #1

赞同：71

时间：2008-09-29T08:36:32.523

首先将其复制到新的 MemoryStream 中。然后，您可以根据需要多次重新读取 MemoryStream：

```
Stream responseStream = CopyAndClose(resp.GetResponseStream());
// Do something with the stream
responseStream.Position = 0;
// Do something with the stream again

private static Stream CopyAndClose(Stream inputStream)
{
    const int readSize = 256;
    byte[] buffer = new byte[readSize];
    MemoryStream ms = new MemoryStream();

    int count = inputStream.Read(buffer, 0, readSize);
    while (count > 0)
    {
        ms.Write(buffer, 0, count);
        count = inputStream.Read(buffer, 0, readSize);
    }
    ms.Position = 0;
    inputStream.Close();
    return ms;
} 
```

            回答 #2

赞同：2

时间：2019-11-26T05:33:10.290

[按照Iain](https://stackoverflow.com/a/147961/2484903)的建议，将流复制到[MemoryStream](https://docs.microsoft.com/en-us/dotnet/api/system.io.memorystream?view=netframework-4.0)是正确的方法。但自从 .NET Framework 4（2010 年发布）以来，我们有了[Stream.CopyTo](https://docs.microsoft.com/en-us/dotnet/api/system.io.stream.copyto?view=netframework-4.0)。文档中的示例：

```
// Create the streams.
MemoryStream destination = new MemoryStream();

using (FileStream source = File.Open(@"c:\temp\data.dat",
    FileMode.Open))
{

    Console.WriteLine("Source length: {0}", source.Length.ToString());

    // Copy source to destination.
    source.CopyTo(destination);
}

Console.WriteLine("Destination length: {0}", destination.Length.ToString()); 
```

之后，您可以随意阅读`destination`：

```
// re-set to beginning and convert stream to string
destination.Position = 0;
StreamReader streamReader = new StreamReader(destination);
string text = streamReader.ReadToEnd();
// re-set to beginning and read again
destination.Position = 0;
RssReader cssReader = new RssReader(destination); 
```

（我看过[Endy 的评论](https://stackoverflow.com/questions/147941/how-can-i-read-an-http-response-stream-twice-in-c#comment-19788214)，但由于它是一个合适的当前答案，它应该有自己的答案条目。）

            回答 #3

赞同：-1

时间：2008-09-29T08:32:13.077

您是否尝试过重置流位置？如果这不起作用，您可以将流复制到 MemoryStream 并在那里您可以根据需要随时重置位置（即为 0）。

        mdx - 在 MDX 中列出成员及其所有后代的最佳方式是什么？

ID：147953

赞同：3

时间：2008-09-29T08:34:20.280

标签：mdx

在我使用的 OLAP 数据库中，有一个“位置”层次结构，由公司、地区、区域、站点、房间、直到这些级别组成。对于特定的公司，我需要编写一些 MDX，列出所有区域、区域和站点（但不是站点以下的任何级别）。目前我正在使用以下 MDX 实现这一目标

```
HIERARCHIZE({
[Location].[Test Company], 
Descendants([Location].[Test Company], [Location].[Region]), 
Descendants([Location].[Test Company], [Location].[Area]), 
Descendants([Location].[Test Company], [Location].[Site])
}) 
```

因为我对 MDX 的了解有限，我想知道是否有更简单的方法来做到这一点，用一个命令而不是四个？是否有一种不那么冗长的方法来实现这一目标，或者我的例子是实现这一目标的唯一真正方法？

            回答 #1

赞同：5

时间：2008-09-29T08:47:04.900

```
DESCENDANTS([Location].[Test Company],[Location].[Site], SELF_AND_BEFORE) 
```

            回答 #2

赞同：2

时间：2008-09-29T08:43:25.080

您想要的命令是 DESCENDANTS。记住“家谱”的类比，你可以看到这将列出一个成员的后代，尽可能地向下。

您可以指定与所选成员的“距离”（以级别为单位），在您的情况下为 3。

您可以使用第三个参数指定一些奇怪的选项，您需要 SELF_AND_AFTER，请参阅[http://msdn.microsoft.com/en-us/library/ms146075.aspx](http://msdn.microsoft.com/en-us/library/ms146075.aspx)

编辑 - 哎呀，正如 santiiiii 所注意到的，它应该是 SELF_AND_BEFORE

        algorithm - 动态搜索和显示

ID：147962

赞同：1

时间：2008-09-29T08:37:04.940

标签：algorithm, search

我有大量文档、文本文件，我想搜索相关内容。我见过一个搜索工具，不记得在哪里，它实现了一个很好的方法，正如我在下面的要求中描述的那样。

我的要求如下：

*   我需要一个优化的搜索功能：我为这个搜索功能提供了一个列表（一个或多个）部分完整（或完整）的单词，用空格分隔。
*   然后该函数查找包含与第一个单词开头或等于第一个单词的单词的所有文档，然后使用第二个单词以相同的方式搜索这些找到的文档，依此类推，最后它返回一个列表，其中包含找到的实际单词链接包含它们的文件（名称和位置），以获取完整的单词列表。
*   文件必须包含列表中的**所有**单词。
*   我想使用此功能进行即时搜索，以便我可以实时显示和更新树状结构中的结果。

我想出的解决方案的一种可能方法如下：我创建了一个包含三个表的数据库（很可能使用 mysql）：'Documents'、'Words' 和 'Word_Docs'。

*   “文档”将包含所有文档的（idDoc、名称、位置）。
*   'Words' 将具有 (idWord, Word) ，并且是所有文档中唯一单词的列表（特定单词仅出现一次）。
*   'Word_Docs' 将具有 (idWord, idDoc) ，并且是它出现的每个单词和文档的唯一 id 组合列表。

然后在每次击键时使用编辑框的内容调用该函数（空格除外）：

*   字符串被标记化
*   （这里我的轮子旋转了一下）：我确信可以构造一条 SQL 语句来返回所需的数据集：（actual_words，doc_name，doc_location）；（我不是 SQL 的热门号码），或者对每个令牌进行一系列调用并解析出非重复的 idDocs？
*   然后返回此数据集（/list/array）

然后显示返回的列表内容：

例如：调用：“seq sta cod”显示：

```
sequence - start - code - Counting Sequences [file://docs/sample/con_seq.txt]
         - stop - code - Counting Sequences [file://docs/sample/con_seq.txt]
sequential - statement - code - SQL intro [file://somewhere/sql_intro.doc] 
```

（等等）

这是一种最佳的做法吗？该函数需要快速，还是应该仅在命中空格时调用？它应该提供单词完成吗？（得到数据库中的单词）至少这可以防止对不存在的单词的函数进行无用的调用。如果单词完成：将如何实施？

（也许 SO 也可以使用这种类型的搜索解决方案来浏览标签？（在主页的右上角））

            回答 #1

赞同：2

时间：2008-09-29T09:31:58.723

最快的方法当然是根本不使用数据库，因为如果您使用优化的数据手动进行搜索，您可以轻松击败选择搜索的性能。假设文档不经常更改，最快的方法是构建索引文件并使用它们来查找关键字。索引文件是这样创建的：

1.  查找文本文件中的所有唯一词。即按空格将文本文件拆分为单词，并将每个单词添加到列表中，除非已在该列表中找到。

2.  把你找到的所有单词按字母顺序排序；最快的方法是使用[三向基数快速排序](http://www.ddj.com/184410724)。在对字符串进行排序时，这种算法在性能上很难被击败。

3.  将排序后的列表写入磁盘，一行一个字。

4.  当您现在要搜索文档文件时，完全忽略它，而是将索引文件加载到内存中并使用二进制搜索来找出索引文件中是否存在单词。在搜索大型排序列表时，二进制搜索很难被击败。

或者，您可以在一个步骤中合并步骤 (1) 和步骤 (2)。如果您使用 InsertionSort（它使用二进制搜索来找到正确的插入位置以将新元素插入到已排序的列表中），您不仅有一个快速算法来确定单词是否已经在列表中，以防万一不是，您会立即获得插入它的正确位置，如果您总是像这样插入新的，当您进入步骤 (3) 时，您将自动获得一个排序列表。

问题是每当文档更改时您都需要更新索引......但是，这对于数据库解决方案是否也是如此？另一方面，数据库解决方案为您带来了一些优势：您可以使用它，即使文档包含这么多单词，索引文件也不再适合内存（不太可能，因为即使是所有英文单词的列表也会适合任何普通用户 PC 的内存）；但是，如果您需要加载大量文档的索引文件，那么内存可能会成为问题。好的，您可以使用巧妙的技巧来解决这个问题（例如，直接在使用 mmap 等映射到内存的文件中搜索），但这些技巧与数据库已经用于执行快速查找的技巧相同，那么为什么要重新发明轮子呢？此外，您还可以防止在文档更改时搜索单词和更新索引之间的锁定问题（即，如果数据库可以为您执行锁定，或者可以将更新或更新作为原子操作执行）。对于使用 AJAX 调用列表更新的 Web 解决方案，使用数据库可能是更好的解决方案（如果这是用 C 等低级语言编写的本地运行应用程序，我的第一个解决方案非常合适）。

如果您想在一次选择调用中完成所有操作（这可能不是最佳的，但是当您使用 AJAX 动态更新 Web 内容时，它通常被证明是最不让人头疼的解决方案），您需要将所有三个表连接在一起。可能 SQL 有点生疏，但我会试一试：

```
SELECT COUNT(Document.idDoc) AS NumOfHits, Documents.Name AS Name, Documents.Location AS Location 
FROM Documents INNER JOIN Word_Docs ON Word_Docs.idDoc=Documents.idDoc 
INNER JOIN Words ON Words.idWord=Words_Docs.idWord
WHERE Words.Word IN ('Word1', 'Word2', 'Word3', ..., 'WordX')
GROUP BY Document.idDoc HAVING NumOfHits=X 
```

好吧，也许这不是最快的选择......我想它可以做得更快。无论如何，它会找到所有匹配的文档，其中至少包含一个单词，然后将所有相等的文档按 ID 分组在一起，统计有多少已被分组 togetehr，最后只显示 NumOfHits（IN 语句找到的单词数）的结果等于 IN 语句中的字数（如果搜索 10 个字，则 X 为 10）。

            回答 #2

赞同：2

时间：2008-09-29T10:11:22.917

您所说的内容称为[倒排索引](http://en.wikipedia.org/wiki/Inverted_index)或发布列表，其运作方式与您的建议和 Mecki 的建议类似。有很多关于倒排索引的文献。维基百科文章是一个很好的起点。

更好的是，与其尝试自己构建它，不如使用现有的倒排索引实现。默认情况下，MySQL 和最新版本的 PostgreSQL 都具有全文索引。您可能还想查看[Lucene](http://lucene.apache.org/)以获得独立的解决方案。*编写一个好的*倒排索引需要考虑很多事情，包括标记化、词干提取、多词查询等，而预构建的解决方案将为您完成所有这些工作。

            回答 #3

赞同：0

时间：2008-09-29T08:47:51.683

不确定语法（这是 sql server 语法），但是：

```
-- N is the number of elements in the list

SELECT idDoc, COUNT(1)
FROM Word_Docs wd INNER JOIN Words w on w.idWord = wd.idWord
WHERE w.Word IN ('word1', ..., 'wordN')
GROUP BY wd.idDoc
HAVING COUNT(1) = N 
```

也就是说，不使用like。类似的事情要复杂得多。

            回答 #4

赞同：0

时间：2008-09-29T09:45:05.307

[Google 桌面搜索](http://desktop.google.com/features.html)或类似工具可能会满足您的要求。

        ruby - 将 assert() 方法添加到 Ruby 的 Kernel 类中是惯用的 Ruby 吗？

ID：147969

赞同：82

时间：2008-09-29T08:39:16.180

标签：ruby, assert, xunit

我正在通过在 Ruby 中编写与 Kent Beck 的 xUnit 等效的代码来扩展我对 Ruby 的理解。Python（由 Kent 编写）在广泛使用的语言中有一个 assert() 方法。红宝石没有。我认为添加它应该很容易，但是内核是放置它的正确位置吗？

顺便说一句，*我知道 Ruby 中存在各种 Unit 框架*——这是一个学习 Ruby 习语的练习，而不是“完成某事”。

            回答 #1

赞同：117

时间：2009-08-11T16:08:15.127

不，这不是最佳做法。与 Ruby 中的 assert() 最好的类比就是提高

```
 raise "This is wrong" unless expr 
```

如果您想提供更具体的异常处理，您可以实现自己的异常

            回答 #2

赞同：32

时间：2011-09-20T07:05:37.670

我认为在 Ruby 中使用断言是完全有效的。但是您提到了两件事：

*   xUnit 框架使用`assert`方法来检查您的测试期望。它们旨在用于您的测试代码，而不是您的应用程序代码。
*   某些语言（如 C、Java 或 Python）包含`assert`旨在用于程序代码内部的构造，以检查您对其完整性所做的假设。这些检查是在代码本身内部构建的。它们不是测试时实用程序，而是开发时实用程序。

我最近写了[solid_assert：一个实现 Ruby 断言实用程序的小型 Rub​​y 库](https://github.com/jorgemanrubia/solid_assert)，并且[在我的博客中发表了一篇解释其动机的文章](http://jorgemanrubia.net/2011/09/19/solid_assert-a-simple-ruby-assertion-utility/)。它让您可以编写以下形式的表达式：

```
assert some_string != "some value"
assert clients.empty?, "Isn't the clients list empty?"

invariant "Lists with different sizes?" do
    one_variable = calculate_some_value
    other_variable = calculate_some_other_value
    one_variable > other_variable
end 
```

并且它们可以被停用`assert`并被`invariant`评估为空语句。这可以让您避免生产中的任何性能问题。但请注意，[实用程序员](https://rads.stackoverflow.com/amzn/click/com/020161622X)建议不要停用它们。只有当它们确实影响性能时，您才应该停用它们。

关于回答说惯用的Ruby方式是使用普通`raise`语句的答案，我认为它缺乏表现力。断言编程的黄金法则之一是不使用断言进行正常的异常处理。它们是两种完全不同的东西。如果你对它们两个使用相同的语法，我认为你的代码会更加晦涩难懂。当然，您将失去停用它们的能力。

您可以确信使用断言是一件好事，因为两本必读的经典书籍，如[The Pragmatic Programmer From Journeyman to Master](https://rads.stackoverflow.com/amzn/click/com/020161622X)和[Code Complete](https://rads.stackoverflow.com/amzn/click/com/0735619670)将整个部分专门用于它们并推荐使用它们。还有一篇名为[Programming with assertions](https://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html)的好文章很好地说明了断言编程的内容以及何时使用它（它基于 Java，但概念适用于任何语言）。

            回答 #3

赞同：15

时间：2008-09-29T14:34:07.640

您将 assert 方法添加到内核模块的原因是什么？为什么不直接使用另一个名为`Assertions`或其他的模块？

像这样：

```
module Assertions
  def assert(param)
    # do something with param
  end

  # define more assertions here
end 
```

**如果您真的需要您的断言随处**可用，请执行以下操作：

```
class Object
  include Assertions
end 
```

免责声明：我没有测试代码，但原则上我会这样做。

            回答 #4

赞同：9

时间：2010-06-03T13:02:59.133

这不是特别地道，但我认为这是一个好主意。特别是如果这样做：

```
def assert(msg=nil)
    if DEBUG
        raise msg || "Assertion failed!" unless yield
    end
end 
```

这样，如果您决定不使用 DEBUG（或其他一些方便的开关，我过去使用过 Kernel.do_assert）设置运行，则不会产生任何影响。

            回答 #5

赞同：5

时间：2008-09-29T21:04:54.500

我的理解是，您正在编写自己的测试套件，以此来更加熟悉 Ruby。因此，虽然 Test::Unit 可能作为指南有用，但它可能不是您想要的（因为它已经完成了工作）。

也就是说，python 的 assert （至少对我而言）更类似于 C 的[assert(3)](http://www.manpagez.com/man/3/assert/)。它不是专门为单元测试设计的，而是为了捕捉“这永远不会发生”的情况。

那么，Ruby 的内置单元测试如何看待问题是，每个单独的测试用例类都是[TestCase](http://www.ruby-doc.org/stdlib/libdoc/test/unit/rdoc/classes/Test/Unit/TestCase.html)的子类，其中包括一个“断言”语句，该语句检查传递给它的内容的有效性并记录它报告。

        .net - .NET 远程处理和服务器 2008（64 位）

ID：147973

赞同：2

时间：2008-09-29T08:41:50.887

标签：.net, windows-server-2008, network-share

我有一个要在本地 PC 上运行并从 LAN 上的文件共享启动的 .NET 应用程序。

它在 32 位 Windows XP 和 Vista 工作站上运行良好。

但它在 64 位 Windows Server 2008 上出现 System.InvalidOperationException 失败。

它在所有三种配置上本地运行良好。

可能是什么原因？

.NET 2.0 安装在所有涉及的机器上。

概括：

32 位 XP：在本地和远程运行 32 位 Vista：在本地和远程运行 64 位 2008：在本地运行，远程失败

“远程”意味着在本地运行，但从文件共享而不是本地驱动器启动。

在所有涉及的机器（包括 64 位 2008 机器）上，区域安全设置为“本地 Intranet”的“完全信任”。

有任何想法吗？

            回答 #1

赞同：1

时间：2008-09-29T13:12:01.533

项目是否设置为在 x86 模式下运行？使用配置管理器进行检查。

            回答 #2

赞同：0

时间：2008-09-29T09:02:15.127

我的第一个猜测是 Internet Explorer 安全设置。尝试将您的服务器添加为受信任的站点。

            回答 #3

赞同：0

时间：2008-09-29T09:07:33.617

这听起来像是一个安全问题，我不认为 CPU 的指令集有什么不同。从网络驱动器运行应用程序时，我曾经遇到过同样的问题。

我相信这应该可以解决您的问题。
[卡斯波尔](http://msdn.microsoft.com/en-us/library/cb6t8dtz(VS.80).aspx)

        javascript - .html() jQuery 方法奇怪的错误 - 在本地解析为空白空间，但不是在生产中

ID：147976

赞同：3

时间：2008-09-29T08:43:01.790

标签：javascript, jquery, html, google-app-engine

我正在制作一个简单的 jquery 命令：

`element.html("&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;");`

使用属性/html 方法：   [http ://docs.jquery.com/Attributes/html](http://docs.jquery.com/Attributes/html)

它适用于我的本地应用程序引擎服务器，但一旦我推送到 Google 服务器，它就不起作用。元素清空但不填充空格。

因此，而不是`"      "` *（6 个空格）*它只是`""`.

再一次，这是在 App Engine 上运行的，但我认为这无关紧要......

            回答 #1

赞同：3

时间：2008-10-06T04:27:27.757

这可能不是您问题的直接答案，但是您为什么还要放入一堆空格？您可能只需更改该元素的`padding-left`or即可获得相同的结果。`text-indent`

```
element.css("textIndent", "3em"); 
```

使用`&nbsp;`s 堆是一种非常狡猾的缩进方式。

            回答 #2

赞同：3

时间：2008-10-06T07:34:26.443

您可以尝试在运行时生成空间，这样它就不会被修剪或在传输过程中发生任何事情：

```
element.html(String.fromCharCode(32)); 
```

            回答 #3

赞同：2

时间：2008-09-29T12:03:24.910

你的 jQuery 应该是这样的：

```
$('element').html('&nbsp;&nbsp;'); 
```

...其中 ' `&nbsp;`' 等于一次空格。

（当然，你想要多少空间）

            回答 #4

赞同：1

时间：2008-09-29T11:57:57.077

您是否尝试过使用`&nbsp;`而不是空格？该`html()`方法只是将字符串泵入元素的 innerHTML 中。

            回答 #5

赞同：0

时间：2008-10-06T04:19:08.397

作为部署到 App Engine 的过程的一部分，代码是否有可能被缩小？

我不希望保留任何空白字符串，也许您实际上可以逃避空白并强制任何缩小离开它：

例子：

```
element.html('\ \ \ \ \ \ \ \ \ \ \ \ ');
```

        java - 战斧和滚动标签

ID：147981

赞同：1

时间：2008-09-29T08:44:39.273

标签：java, jsf, tomahawk

是否有启用“可滚动标签”的战斧组件？我的意思是针对以下情况：

如果我有很多选项卡，选项卡栏的侧面会出现一个小箭头，以滚动浏览所有打开的选项卡（就像在 Firefox 中一样）。

![图片](https://dl.getdropbox.com/u/165601/arrow.png)

是否有用于创建类似内容的战斧组件？

            回答 #1

赞同：1

时间：2008-10-08T10:34:33.287

您/您是否尝试过使用[panelTabbedPane](http://www.roseindia.net/jsf/apache-myfaces-tomahawk/tomahawk_pannelTabbedPane_tag.shtml)标签？

        php - 标记字符串的标准算法，保留分隔符（在 PHP 中）

ID：147988

赞同：2

时间：2008-09-29T08:47:36.053

标签：php, algorithm, parsing

我想将算术表达式拆分为标记，将其转换为 RPN。

Java 有 StringTokenizer，它可以选择保留分隔符。这样，我可以使用运算符作为分隔符。不幸的是，我需要在具有 strtok 的 PHP 中执行此操作，但这会丢弃分隔符，所以我需要自己酿造一些东西。

这听起来像是 Compiler Design 101 的经典教科书示例，但恐怕我在这里缺乏一些正规教育。您可以指出我的标准算法吗？

我的其他选择是阅读[词法分析](http://en.wikipedia.org/wiki/Lexical_analysis)或使用可用的字符串函数快速汇总一些内容。

            回答 #1

赞同：2

时间：2008-09-29T08:59:59.407

这可能会有所帮助。

[Tokenizer 的实际使用](http://c7y.phparch.com/c/entry/1/art,practical_uses_tokenizer)

            回答 #2

赞同：1

时间：2008-09-29T11:01:44.403

通常，我只会使用正则表达式来执行此操作：

```
$expr = '(5*(7 + 2 * -9.3) - 8 )/ 11';
$tokens = preg_split('/([*\/^+-]+)\s*|([\d.]+)\s*/', $expr, -1,
        PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
$tts = print_r($tokens, true);
echo "<pre>x=$tts</pre>"; 
```

它需要更多的工作来接受具有指数的数字（如 -9.2e-8）。

            回答 #3

赞同：0

时间：2008-09-29T13:39:22.247

好的，感谢 PhiLho，我的最终代码是这样的，如果有人需要的话。它甚至不是很脏。:-)

```
static function rgTokenize($s)
{
    $rg = array();

    // remove whitespace
    $s = preg_replace("/\s+/", '', $s);

    // split at numbers, identifiers, function names and operators
    $rg = preg_split('/([*\/^+\(\)-])|(#\d+)|([\d.]+)|(\w+)/', $s, -1, PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);

    // find right-associative '-' and put it as a sign onto the following number
    for ($ix = 0, $ixMax = count($rg); $ix < $ixMax; $ix++) {
        if ('-' == $rg[$ix]) {
            if (isset($rg[$ix - 1]) && self::fIsOperand($rg[$ix - 1])) {
                continue;
            } else if (isset($rg[$ix + 1]) && self::fIsOperand($rg[$ix + 1])) {
                $rg[$ix + 1] = $rg[$ix].$rg[$ix + 1];
                unset($rg[$ix]);
            } else {
                throw new Exception("Syntax error: Found right-associative '-' without operand");
            }
        }
    }
    $rg = array_values($rg);

    echo join(" ", $rg)."\n";

    return $rg;
} 
```

        .net - 如何从使用它的应用程序内部获取 WCF 统计信息？

ID：147990

赞同：0

时间：2008-09-29T08:48:32.073

标签：.net, wcf, performance, networking, monitoring

是否可以从 WCF 应用程序内部以编程方式收集性能统计信息？例如，打开的连接数或收到的请求数。

            回答 #1

赞同：0

时间：2008-09-29T10:17:33.043

查看[WCF 性能计数器](http://msdn.microsoft.com/en-us/library/ms735098.aspx)。您可以使用相应的  [.NET Framework 类](http://msdn.microsoft.com/en-us/library/system.diagnostics.performancecounter.aspx)查询性能计数器。

此外，您可以为您的 WCF 服务启用 WMI 并从应用程序内部查询此信息。

可能取决于您需要获取的信息类型。

        mysql - 为不同类型的查询设置不同的用户是一种好习惯吗？

ID：147992

赞同：3

时间：2008-09-29T08:49:55.500

标签：mysql

我正在为我正在工作的项目使用 MySQL 和 PHP。我创建了单独的用户来执行不同的功能（一个用于运行选择查询，一个用于运行更新查询等）以提供额外的安全层。这样，我认为如果有人确实设法进行了注入攻击（这不太可能，因为我使用的是准备好的语句），他们能够做的任何事情都将限于最初打算运行的查询类型。这是一个好习惯还是不值得麻烦？  

            回答 #1

赞同：6

时间：2008-09-29T08:59:46.630

除了扩展逻辑之外，您还将在该区域拥有不同的连接和基本开销。

恕我直言，明智的做法是不要在 webapp 中使用 root 用户进行所有查询，如果数据*太热*，请确保指定用户没有 DROP、DELETE 等权限。如果您的应用程序有必要，您可以实施软删除。

最后但同样重要的是，确保清理所有 GPC 并确保在查询中正确引用/转义文件。使用准备好的语句可能是一回事，但最终它可以像使用[mysql_real_escape_string()](http://php.net/manual/en/function.mysql-real-escape-string.php)或 DBAL/ORM 提供的任何引用方法一样简单。

            回答 #2

赞同：1

时间：2008-09-29T08:54:52.447

我个人认为这不值得费心，因为编码、测试和部署都比较棘手。确保您的软件对 SQL 注入免疫。

        cakephp - 当我转到第 2 页时，为什么分页器不记得我的自定义参数？

ID：147995

赞同：12

时间：2008-09-29T08:51:20.270

标签：cakephp, pagination, paginator

在 cakephp 视图中使用分页器助手时，它不记得为我的使用自定义的部分 url。

例如：

```
http://example.org/users/index/moderators/page:2/sort:name/dir:asc 
```

这里的**主持人**是一个参数，可以帮助我按该类型进行过滤。但是按分页器链接将不包括此链接。

            回答 #1

赞同：11

时间：2008-09-29T08:52:18.520

秘诀是将这一行添加到您的视图中：

**$paginator->options(array('url'=>$this->passedArgs));**

（我创建了这个问题和答案，因为这是一个被问得很多的问题，我一直不得不挖掘答案，因为我不记得了。）

            回答 #2

赞同：4

时间：2011-05-19T09:19:25.750

要添加到上面 Alexander Morland 的答案，值得记住的是，CakePHP 1.3 中的语法已经改变，现在是：

```
$this->Paginator->options(array('url' => $this->passedArgs)); 
```

这在 CakePHP 书[的视图分页](http://book.cakephp.org/1.3/en/The-Manual/Common-Tasks-With-CakePHP/Pagination.html#pagination-in-views)部分有进一步的描述。

            回答 #3

赞同：0

时间：2008-12-09T17:03:05.067

$this->passedArgs 是从视图中执行此操作的首选方式。

            回答 #4

赞同：0

时间：2008-12-28T21:38:59.147

你救了我！这对我帮助很大，谢谢。

我需要一种方法将最初通过 post ($this->data) 发送的参数传递给分页组件，因此我的自定义查询将继续使用它们。

这是我所做的：

在我看来，我把

```
$paginator->options(array('url'=>$this->data['Transaction'])); 
```

在 $paginator->prev('<< Previous ' 的东西之前。

这样做会使分页器上的下一个链接像“ .../page:1/start_date:2000-01-01%2000:00:00/end_date:3000-01-01%2023:59:59/payments_recieved:1 "

然后在我的控制器上，我只需要获取参数并将它们放在 $this->data 中，这样我的函数就会像往常一样继续：

```
foreach($this->params['named'] as $k=>$v)
{
    /*
     * set data as is normally expected
     */
    $this->data['Transaction'][$k] = $v;
} 
```

就是这样。分页适用于我的自定义查询。:)

            回答 #5

赞同：0

时间：2009-06-01T17:52:09.527

这里的选项是一个很好的线索......您还可以在 cakephp.org/view/166/Pagination-in-Views 查看有关 cakePHP 分页的更多信息

            回答 #6

赞同：-1

时间：2009-06-21T16:42:46.207

使用该参数“url”，您只能将首选字符串放在 url 中的字符串分页之前。

如果我使用这种技术：

```
$urlpagin = '?my_get1=1&my_get2=2';
$paginator->options = array('url'=>$urlpagin); 
```

我只获得：

```
url/controller/action/?my_get1=1&my_get2=2/sort:.../... 
```

蛋糕丢失了我的获取参数

你有替代技术吗？

        winapi - 你如何写一个用 FILE_FLAG_NO_BUFFERING 打开的文件的结尾？

ID：147996

赞同：4

时间：2008-09-29T08:51:41.830

标签：winapi, vb6, file-io, buffer

我正在使用 VB6 和 Win32 API 将数据写入文件，此功能用于导出数据，因此写入磁盘的性能是我考虑的关键因素。因此，我在通过调用打开文件时使用`FILE_FLAG_NO_BUFFERING`和选项。`FILE_FLAG_WRITE_THROUGH``CreateFile`

`FILE_FLAG_NO_BUFFERING`要求我使用自己的缓冲区并将数据以磁盘扇区大小的倍数写入文件，这通常没有问题，除了数据的最后一部分，如果它不是扇区大小的精确倍数将包括字符零填充文件，一旦写入最后一个块以不包含这些字符零，如何设置文件大小？

我可以使用`SetEndOfFile`，但这需要我关闭文件并重新打开它而不使用`FILE_FLAG_NO_BUFFERING`. 我见过有人谈论`NtSetInformationFile`但是我找不到如何在 VB6 中使用和声明它。`SetFileInformationByHandle`可以做我想要的，但是它只在 Windows Vista 中可用，我的应用程序需要与以前版本的 Windows 兼容。

            回答 #1

赞同：4

时间：2008-09-29T09:57:24.980

我相信 SetEndOfFile 是唯一的方法。

我同意 Mike G. 的观点，即您应该在有和没有 FILE_FLAG_NO_BUFFERING 的情况下对代码进行基准测试。现代操作系统上的 Windows 文件缓冲非常有效。

            回答 #2

赞同：2

时间：2008-09-29T09:39:18.970

我不确定，但您确定该设置`FILE_FLAG_NO_BUFFERING`并`FILE_FLAG_WRITE_THROUGH`为您提供最佳性能吗？

它们肯定会导致您的数据尽快进入磁盘，但这种事情实际上并不能帮助提高性能 - 它只会帮助您希望在发生以下情况时尽可能完整的日志文件的可靠性崩溃。

对于您描述的数据导出例程，允许操作系统缓冲您的数据可能会导致更好的性能，因为写入将根据其他磁盘活动安排，而不是强制磁盘每次写入都跳回您的文件.

如果没有这些选项，您为什么不对代码进行基准测试？保留零字节填充逻辑以使其成为公平测试。

如果事实证明跳过这些选项更快，那么您可以删除 0 填充逻辑，并且您的文件大小问题会自行修复。

            回答 #3

赞同：0

时间：2011-06-15T17:00:09.803

对于 1 GB 的文件，Windows 缓冲确实可能会更快，尤其是在执行许多小型 I/O 时。如果您正在处理比可用 RAM 大得多的文件，并且进行大块 I/O，那么您设置的标志将产生更好的吞吐量（对于重线程和/或随机大块，速度提高三倍输入/输出）。

```**********