# StackOverflow 问答 000372000-000372999

# c# - Unit Testing Application_Start

> ID：372003
> 
> 赞同：16
> 
> 时间：2008-12-16T17:19:12.710
> 
> 标签：c#, asp.net-mvc, unit-testing

I am looking for any kind of information (prefer Moq) on how to unit test the Application_Start method in Global.asax. I am using ASP.NET MVC and trying to get to that elusive 100% code coverage!

The fact that I'm using MVC is not the point. And saying that not testing Start is not necessary isn't really the answer either. What if I had other code in there? I need to know how to test it.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-06-19T22:49:10.557

一些组织确实需要这些无意义的数字，并且存在成本以外的问题。对于处理敏感信息的公司来说，“足够好”还不够好。我遇到了完全相同的问题，就像 Klas Mellbourn 一样，需要达到 100%（如果不是更高的话！）以下对我有用。虽然，我更愿意将其标记为“从代码覆盖范围中排除”

```
public class Global : HttpApplication
{
    public override void Init()
    {
        AreaRegistration.RegisterAllAreas(); //will error out on app_start
        base.Init();
    }

    /// <summary>
    /// Application_Start method.
    /// </summary>
    /// <param name="sender">The caller</param>
    /// <param name="e">The event arguments</param>
    [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "KMM: This method is called dynamically by the framework.")]
    protected void Application_Start(object sender, EventArgs e)
    {
        var container = StructureMapRegistry.Initialize();
        GlobalConfiguration.Configuration.DependencyResolver = new StructureMapResolver(container);
        GlobalConfiguration.Configure(WebApiConfig.Register);
        RouteConfig.RegisterRoutes(RouteTable.Routes);
    }
} 
```

然后单元测试看起来像这样：

```
 public class GlobalTest : Global
    {
        private HttpRequestMessage FakeRequest;

        DateTime? effectiveDate = DateTime.Now.AddYears(-4);
        private string policyNumber = "1234567890";

        [TestMethod]
        public void ApplicationStart()
        {
            var sender = new object();
            var e = new EventArgs();
            try
            {
                Application_Start(sender, e); // this will error b/c not fully loaded yet.
            }
            catch (InvalidOperationException)
            {
                Thread.Sleep(2000); // give the app time to launch

                Application_Start(sender, e);
            }
            Assert.IsTrue(true);
        }
    } 
```

最后，我需要在我的 WebApiConfig 中设置一个标志，以防止路由被注册两次。

```
 public static class WebApiConfig
    {
        private static bool isRegistered;
        /// <summary>
        /// Registers the configuration.
        /// </summary>
        /// <param name="config">The Http Configuration.</param>
        public static void Register(HttpConfiguration config)
        {
            if (isRegistered)
            {
                return;
            }
            config.MapHttpAttributeRoutes(); 
```

现在，在仇恨者和纯粹主义者开始标记它之前，任务是测试所有代码。我个人讨厌修改代码以适应测试。这与使代码可测试不同。添加 isRegistered 标志是支持需要调用 app_start 2x 的测试所必需的工件类型的示例。这是一件小事，因为该代码仅在 app_start 上调用，所以我不会对此大惊小怪。我当然会对其他人在这方面所做的事情感兴趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T18:47:39.177

在典型的 ASP.NET MVC 应用程序中，Application_Start 事件通常用于注册自定义路由。这是一篇很好[的文章](http://stephenwalther.com/archive/2008/07/02/asp-net-mvc-tip-13-unit-test-your-custom-routes)，解释了如何对自定义路由进行单元测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T18:14:02.163

第一次访问您的站点时调用此函数。回收应用程序池会导致它再次被触发

在大多数情况下，这个*事件处理程序没有代码*，所以不要浪费时间去追求无意义的数字！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T20:57:53.703

If you want to test the actions of an event-based item like this, separate the actions into a separate, testable method and just call it from the handler. Or, as darin suggested, test the *effects* of the method - in this particular case, that your routing table got registered correctly.

BTW, I've never reached 100% coverage on a non-trivial app... We generally target 80% as "good enough". Some modules are 100% testable, but many aren't practical to do so.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T04:40:07.813

我发现在 Global.asax 中对内容进行单元测试的最佳方法是确保整个事情都在可测试的静态方法中。

然后将 Global.asax 所需的一切传递给该方法。

例如，如果您在应用程序启动时检查 Session，您可以使用如下方法：

```
public static void CheckSession(HttpSessionStateBase session)
{
...
} 
```

然后，您的应用程序开始将是这样的：

```
protected void Application_Start(object sender, EventArgs e)
{
    CheckSession(new HttpSessionStateWrapper(Session));
} 
```

这个例子显然有点傻，因为你可能会在 Session Start 中做这样的事情 :) 你可以将任何需要的东西传递给该方法，请求、响应、缓存等。

然而，它抓住了重点。唯一不会涉及的代码是 Application_Start 中的实际单行调用。使用 Moq 的测试可以涵盖其他所有内容，如下所示：

```
var session = new Moq<HttpSessionStateBase>();
...Set Expectations...
Global.CheckSession(session.Object);
...Do Asserts... 
```

你不会达到你正在寻找的 100% 的代码覆盖率，但你会非常接近，如果不完全是字母，你将实现 TDD 法律的“精神”:)

# python - 什么时候空格在 Python 中不重要？

> ID：372007
> 
> 赞同：3
> 
> 时间：2008-12-16T17:21:05.983
> 
> 标签：python, whitespace

什么时候空格在 Python 中不重要？

它似乎在列表中被忽略，例如：

```
for x in range(5):
    list += [x, 1
,2,3,

     4,5] 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-16T17:26:39.793

空格仅对语句的缩进很重要。您有一个跨多行的语句，只有第一行语句开头的缩进很重要。有关更多信息，请参阅*[Python：关于缩进的神话](http://www.secnetix.de/~olli/Python/block_indentation.hawk)*。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T17:52:23.110

您的问题实际上是关于 Python 何时隐式连接代码行。

Python 将隐式连接包含在（括号）、{braces} 和 [brackets] 中的行，如您的示例代码中所示。您还可以在行尾使用反斜杠 (\) 显式连接行。

更多关于[隐式续行](http://docs.python.org/reference/lexical_analysis.html#implicit-line-joining)的信息：

Gamble 先生的回答对于缩进是正确的。

# c# - 没有单个字母分隔符的正则表达式匹配

> ID：372009
> 
> 赞同：2
> 
> 时间：2008-12-16T17:21:08.853
> 
> 标签：c#, regex, lookahead, negative-lookahead

[Medicare 资格 EDI 示例响应](https://medifacd.relayhealth.com/Pharmacies/MediFacD_Pharmacies_PayerSheet_E1December2006.htm#Examples "医疗保险资格 EDI 示例响应")是我想要匹配的内容。

我有一个看起来像这样的字符串：

```
LN：SMITHbbbbbbbbFN：SAMANTHAbbBD：19400515PD：1BN：123456PN：9876543210GP：ABCDEFGHIJKLMNOID：123456789012345bbbbbPC：123PH：8005551212CD：123456PB：123ED：20060101TD：2070101LC：NFI：12345678FE：20070101FT：20080101
```

我需要一组看起来像这样的匹配：

```
钥匙 | 价值
------------------
LN | SMITHbbbbbbbb
FN | 萨曼莎
BD | 19400515
... ETC

```

我整天都在处理这个问题，我似乎无法得到一个可接受的匹配方案。如果我想不通，我将使用 for 循环对它进行程序化编程并查找冒号索引。

我尝试过使用[负前瞻](http://yacsharpblog.blogspot.com/2008/09/regular-expressions-in-c-negative-look.html "C# 负前瞻")，但我一无所获。这是 C#，我在测试时使用[这个测试器](http://regexlib.com/RETester.aspx ".Net 在线正则表达式测试器")(.Net) 以及[Regex Coach](http://www.weitz.de/regex-coach/ "正则表达式教练") (非 .Net)。

我试过用这个：

```
([\w]{2})\:(?![\w]{2}\:) 
```

但这仅匹配键及其冒号，例如“LN：”，“FN：”等。

如果我使用：

```
([\w]{2})\:(.+?)([\w]{2})\: 
```

它也消耗下一个匹配的两个字符键和冒号，导致我只匹配每个其他键/值对。

有没有办法让我在 .Net 中正确使用 RegEx 匹配这些，还是我坚持使用更程序化的解决方案？请记住，我不能假设键总是大写字母。它们可能包含数字，但它们始终是两个字符，然后是一个冒号。

提前感谢我能得到的任何帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T17:31:20.470

我认为你想要的是积极的前瞻，而不是消极的，这样你就可以在当前位置之前找到键冒号组合，但你不会消耗它。这似乎适用于您的测试示例：

```
([\w]{2})\:(.+?)(?=[\w]{2}\:|$) 
```

产量：

```
LN: SMITHbbbbbbbb
FN：萨曼莎布
BD: 19400515
PD：1
国行号：123456
电话：9876543210
...

```

注意：我在测试输出中添加了冒号，它们没有被正则表达式捕获。

编辑：谢谢，道格拉斯，我已经编辑了正则表达式以捕获字符串结尾，因此最后一个条目也被捕获。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T17:35:57.980

这在 JavaScript 中有效（我总是在 Firefox 中启动错误控制台来使用正则表达式），但它在 .NET 中也应该可以正常工作：

```
([^:]{2}):((?:[^:](?!(?:[^:]:)))+)
```

它使用负前瞻：

```
( -> 开始捕获第一个标记（标签）
    [^:]{2} -> 两个非冒号字符
) -> 结束捕获第一个令牌
: -> 跳过冒号
( -> 开始捕获第二个标记（值）
    (?: -> 不要将此组捕获为令牌
        [^:](?! -> 一个非冒号字符，后面不跟：
                (?: -> 不要捕获这个组
                    [^:]: -> 一个非冒号，后跟一个冒号
                ) -> 结束组
            ) -> 结束负前瞻
    )+ -> 该组中的一个或多个
) -> 结束捕获第二个标记

```

测试：

```
"LN:SMITHbbbbbbbbFN:SAMANTHAbbBD:19400515"
    .replace(
        /([^:]{2}):((?:[^:](?!(?:[^:]:)))+)/g,
        "[$1] = [$2]\n") 
```

产量：

```
[LN] = [SMITHbbbbbbbb]
[FN] = [SAMANTHAbb]
[BD] = [19400515]

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T21:09:57.970

查看链接每个字段的长度都是固定的，因此您可以执行以下操作：

```
int pos = 0;
Dictionary<string, string> parsedResults = new Dictionary<string, string>();

foreach (int length in new int[] { 13, 10, 8, 1, 6, 10, 15, 20, 3, 10, 6, 3, 8, 8, 1, 8, 8, 8, })
{
    string fieldId = message.Substring(pos, 2);
    string fieldValue = message.Substring(pos + 3, length);
    parsedResults.Add(fieldId, fieldValue);
    pos += length + 3;
} 
```

# c# - How do I get the start index and number of visible items in a ListView?

> ID：372011
> 
> 赞同：5
> 
> 时间：2008-12-16T17:21:14.720
> 
> 标签：c#, listview

I have a listview working in virtual mode, in the LargeIcons view. Retrieves are expensive, so I want to ask for the data for all the visible items. How do I get the start index and total number of the visible items?

Update: I am aware of the CacheVirtualItems event. The third-party database we're using takes ~3s to retrieve a single record, but ~4s to retrieve a thousand records, so I have to do them in large blocks. I need to make sure the visible records are among those we retrieve, so I need to know the start index and total number of the visible items. If that's not feasible, I'll have to find a workaround (which will probably involve using a DataGridView with a load of image cells to imitate the LargeIcons view) but I would like to do this properly if possible.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-06-25T16:15:47.790

真正的答案是：
* 获取 ListView 的 ScrollViewer。
* ScrollViewer.VerticalOffset 是第一个显示项目的索引。
* ScrollViewer.ViewportHeight 是显示的项目数。

要获取 ScrollViewer，您需要一个函数 FindDescendant(FrameworkElement, Type)，它将在 ListView 的子项中进行搜索。在加载 Window 后调用它。

VB.Net 和 C# 中的代码：

```
Public Function FindDescendant(ByVal MyElementToSeek As FrameworkElement, _
                                  ByVal TypeToFind As Type) As FrameworkElement
    If MyElementToSeek Is Nothing Then Return Nothing
    If MyElementToSeek.GetType() = TypeToFind Then Return MyElementToSeek
    For i = 0 To VisualTreeHelper.GetChildrenCount(MyElementToSeek) - 1
        Dim OneChild = TryCast(VisualTreeHelper.GetChild(MyElementToSeek, i), FrameworkElement)
        Dim Result = FindDescendant(OneChild, TypeToFind)
        If Result IsNot Nothing Then Return Result
    Next
    Return Nothing
End Function 
```

.

```
public FrameworkElement FindDescendant(FrameworkElement MyElementToSeek, 
                                         Type TypeToFind) 
{
    if (MyElementToSeek == null) return null;
    if (MyElementToSeek.GetType() == TypeToFind) return MyElementToSeek;
    for (i = 0; 
               (i<= (VisualTreeHelper.GetChildrenCount(MyElementToSeek) - 1)); i++) 
      {
        object OneChild = TryCast(VisualTreeHelper.GetChild(MyElementToSeek, i),
                                                         FrameworkElement);
        object Result = FindDescendant(OneChild, TypeToFind);
        if (Result) return Result;
        }
     return null;
    }
}

    ' MyScrollViewer = FindDescendant(MyListView, ScrollViewer) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T17:24:45.477

You could iterate through subsequent items, checking their visibility until you reach the one that isn't visible. This would give you a count of the visible items.

For example, something like:

```
 for (int index = 0; index < list.Items.Count; index++)
        {
            if (list.ClientRectangle.IntersectsWith(item.GetBounds(ItemBoundsPortion.Entire)))
            {
                // Add to the list to get data.
            }
            else
            {
                // We got them all.
                break;
            }
        } 
```

I'm not sure what effect sorting would have on this though.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T11:31:17.857

就在我的脑海中，我还没有测试过，但你能做到：

```
private void GetIndexes(ListView vv, out int startidx, out int count)
{
            ListViewItem lvi1 = vv.GetItemAt(vv.ClientRectangle.X+6, vv.ClientRectangle.Y + 6); 
            ListViewItem lvi2 = vv.GetItemAt(vv.ClientRectangle.X+6, vv.ClientRectangle.Bottom-10); 
            startidx = vv.Items.IndexOf(lvi1); 
            int endidx = vv.Items.IndexOf(lvi2);
            if (endidx == -1) endidx = vv.Items.Count;
            count = endidx - startidx;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T20:09:01.900

你见过 CacheVirtualItems 事件吗？控件将要求一系列项目而不是一个接一个。但是，如果滚动，它仍然可能一次只要求一个。但是pagedown/up会触发缓存机制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-10-16T19:07:26.787

我知道这篇文章很旧......错了

```
MyScrollViewer = FindDescendant(MyListView, ScrollViewer) 
```

正确的是：

```
Dim Myscrollviwer As ScrollViewer

Myscrollviwer = FindDescendant(myListView3, GetType(ScrollViewer))
MsgBox(Myscrollviwer.VerticalOffset) 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-05-30T14:18:54.690

```
foreach (var t in listView1.Items)
{                        

    var lvitem = listView1.ItemContainerGenerator.ContainerFromItem(t) as ListViewItem;                   
    if (lvitem == null) continue;
    //lvitem will = null if it is not visible 

    // otherwise do stuff with lvitem such as:
    lvitem.Foreground = Brushes.Green;

} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-01-10T04:29:01.743

尝试这个：

```
If ListView.Items.Count > 0 Then
    Dim lvi As ListViewItem = ListView.TopItem
    If lvi Is Nothing Then Return
    Dim startIndex As Integer = lvi.Index
    Dim lastVisible As Integer = startIndex
    While ListView.Items(lastVisible).Bounds.Bottom < Me.lvRes.Bounds.Bottom
        lastVisible += 1
    End While
    lastVisible -= 1
End If 
```

# cocoa - Core Animation/Cocoa 中的小部件“翻转”行为

> ID：372018
> 
> 赞同：9
> 
> 时间：2008-12-16T17:22:48.990
> 
> 标签：cocoa, macos, core-animation, transform

我正在尝试制作一个 Card 类，它可以复制仪表板小部件的行为，您可以在卡片的两侧放置控件或图像或其他任何东西并在它们之间翻转。

支持图层的视图有一个变换属性，但改变它并没有做我期望它做的事情（围绕 y 轴旋转图层会将其折叠到左侧）。

我被指出了一些未记录的功能和一个名为 cgsprivate.h 的 .h 文件，但我想知道是否有官方方法可以做到这一点？这个软件必须交付，我不想看到它以后失败，因为苹果人把它拉进了 10.6。

任何人都知道如何做到这一点？对我来说很奇怪，一个简单的小部件在 Core Animation 中很难做到。

提前致谢！

编辑：我可以使用图层上的图像来完成此行为，但我不知道如何获得更高级的控件/视图/图层上的任何内容。卡片示例使用图像。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-16T19:37:49.590

~~Mike Lee 有[一个翻转效果的](http://atomicwang.org/motherfucker/Index/B4E5D81C-A9A0-403C-B7A3-62FEB81DE777.html)实现，他已经发布了一些[示例代码](http://boondoggle.atomicwang.org/lemurflip/)。~~（不幸的是，这不再在线提供，但 Drew McCormack[在他自己的实现中构建了](http://www.mentalfaculty.com/mentalfaculty/Blog/Entries/2010/9/22_FLIPPIN_OUT_AT_NSVIEW.html)它。）看起来他抓住了要交换的“背景”和“前景”视图的图层，使用 CATransform3D 旋转动画中的两个视图，然后在动画完成后交换视图。

通过使用视图中的图层，您可以避免需要缓存到位图中，因为这就是图层正在做的事情。无论如何，他的视图控制器看起来是一个很好的解决方案，可以满足您的需求。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-02-22T19:35:06.543

使用像 e.James 概述的核心动画......注意，这是使用垃圾收集和托管层：

```
#import "AnimationWindows.h"

@interface AnimationFlipWindow (PrivateMethods)

NSRect RectToScreen(NSRect aRect, NSView *aView);
NSRect RectFromScreen(NSRect aRect, NSView *aView);
NSRect RectFromViewToView(NSRect aRect, NSView *fromView, NSView *toView);

@end

#pragma mark -

@implementation AnimationFlipWindow

@synthesize flipForward = _flipForward;

- (id) init {

    if ( self = [super init] ) { 
        _flipForward = YES; 
    }

    return self;
}

- (void) finalize {

    // Hint to GC for cleanup
    [[NSGarbageCollector defaultCollector] collectIfNeeded];
    [super finalize];
}

- (void) flip:(NSWindow *)activeWindow 
       toBack:(NSWindow *)targetWindow {

    CGFloat duration = 1.0f * (activeWindow.currentEvent.modifierFlags & NSShiftKeyMask ? 10.0 : 1.0);
    CGFloat zDistance = 1500.0f;

    NSView *activeView = [activeWindow.contentView superview];
    NSView *targetView = [targetWindow.contentView superview];

    // Create an animation window
    CGFloat maxWidth  = MAX(NSWidth(activeWindow.frame), NSWidth(targetWindow.frame)) + 500;
    CGFloat maxHeight = MAX(NSHeight(activeWindow.frame), NSHeight(targetWindow.frame)) + 500;

    CGRect animationFrame = CGRectMake(NSMidX(activeWindow.frame) - (maxWidth / 2), 
                                       NSMidY(activeWindow.frame) - (maxHeight / 2), 
                                       maxWidth, 
                                       maxHeight);

    mAnimationWindow = [NSWindow initForAnimation:NSRectFromCGRect(animationFrame)];

    // Add a touch of perspective
    CATransform3D transform = CATransform3DIdentity; 
    transform.m34 = -1.0 / zDistance;
    [mAnimationWindow.contentView layer].sublayerTransform = transform;

    // Relocate target window near active window
    CGRect targetFrame = CGRectMake(NSMidX(activeWindow.frame) - (NSWidth(targetWindow.frame) / 2 ), 
                                    NSMaxY(activeWindow.frame) - NSHeight(targetWindow.frame),
                                    NSWidth(targetWindow.frame),
                                    NSHeight(targetWindow.frame));

    [targetWindow setFrame:NSRectFromCGRect(targetFrame) display:NO];

    mTargetWindow = targetWindow;

    // New Active/Target Layers
    [CATransaction begin];
    CALayer *activeWindowLayer = [activeView layerFromWindow];
    CALayer *targetWindowLayer = [targetView layerFromWindow];
    [CATransaction commit];

    activeWindowLayer.frame = NSRectToCGRect(RectFromViewToView(activeView.frame, activeView, [mAnimationWindow contentView]));
    targetWindowLayer.frame = NSRectToCGRect(RectFromViewToView(targetView.frame, targetView, [mAnimationWindow contentView]));

    [CATransaction begin];
    [[mAnimationWindow.contentView layer] addSublayer:activeWindowLayer];
    [CATransaction commit];

    [mAnimationWindow orderFront:nil];  

    [CATransaction begin];
    [[mAnimationWindow.contentView layer] addSublayer:targetWindowLayer];
    [CATransaction commit];

    // Animate our new layers
    [CATransaction begin];
    CAAnimation *activeAnim = [CAAnimation animationWithDuration:(duration * 0.5) flip:YES forward:_flipForward];
    CAAnimation *targetAnim = [CAAnimation animationWithDuration:(duration * 0.5) flip:NO  forward:_flipForward];
    [CATransaction commit];

    targetAnim.delegate = self;
    [activeWindow orderOut:nil];

    [CATransaction begin];
    [activeWindowLayer addAnimation:activeAnim forKey:@"flip"];
    [targetWindowLayer addAnimation:targetAnim forKey:@"flip"];
    [CATransaction commit];
}

- (void) animationDidStop:(CAAnimation *)animation finished:(BOOL)flag {

    if (flag) {
        [mTargetWindow makeKeyAndOrderFront:nil];
        [mAnimationWindow orderOut:nil];

        mTargetWindow = nil;
        mAnimationWindow = nil;
    }
}

#pragma mark PrivateMethods:

NSRect RectToScreen(NSRect aRect, NSView *aView) {
    aRect = [aView convertRect:aRect toView:nil];
    aRect.origin = [aView.window convertBaseToScreen:aRect.origin];
    return aRect;
}

NSRect RectFromScreen(NSRect aRect, NSView *aView) {
    aRect.origin = [aView.window convertScreenToBase:aRect.origin];
    aRect = [aView convertRect:aRect fromView:nil];
    return aRect;
}

NSRect RectFromViewToView(NSRect aRect, NSView *fromView, NSView *toView) {

    aRect = RectToScreen(aRect, fromView);
    aRect = RectFromScreen(aRect, toView);

    return aRect;
}

@end

#pragma mark -
#pragma mark CategoryMethods:

@implementation CAAnimation (AnimationFlipWindow)

+ (CAAnimation *) animationWithDuration:(CGFloat)time flip:(BOOL)bFlip forward:(BOOL)forwardFlip{

    CABasicAnimation *flipAnimation = [CABasicAnimation animationWithKeyPath:@"transform.rotation.y"];

    CGFloat startValue, endValue;

    if ( forwardFlip ) {
        startValue = bFlip ? 0.0f : -M_PI;
        endValue = bFlip ? M_PI : 0.0f;
    } else {
        startValue = bFlip ? 0.0f : M_PI;
        endValue = bFlip ? -M_PI : 0.0f;
    }

    flipAnimation.fromValue = [NSNumber numberWithDouble:startValue];
    flipAnimation.toValue = [NSNumber numberWithDouble:endValue];

    CABasicAnimation *shrinkAnimation = [CABasicAnimation animationWithKeyPath:@"transform.scale"];
    shrinkAnimation.toValue = [NSNumber numberWithFloat:1.3f];
    shrinkAnimation.duration = time * 0.5;
    shrinkAnimation.autoreverses = YES;

    CAAnimationGroup *animationGroup = [CAAnimationGroup animation];
    animationGroup.animations = [NSArray arrayWithObjects:flipAnimation, shrinkAnimation, nil];
    animationGroup.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
    animationGroup.duration = time;
    animationGroup.fillMode = kCAFillModeForwards;
    animationGroup.removedOnCompletion = NO;

    return animationGroup;
}

@end

#pragma mark -

@implementation NSWindow (AnimationFlipWindow)

+ (NSWindow *) initForAnimation:(NSRect)aFrame {

    NSWindow *window =  [[NSWindow alloc] initWithContentRect:aFrame 
                                                    styleMask:NSBorderlessWindowMask 
                                                      backing:NSBackingStoreBuffered 
                                                        defer:NO];
    [window setOpaque:NO];
    [window setHasShadow:NO];
    [window setBackgroundColor:[NSColor clearColor]];
    [window.contentView setWantsLayer:YES];

    return window;
}

@end

#pragma mark -

@implementation NSView (AnimationFlipWindow)

- (CALayer *) layerFromWindow {

    NSBitmapImageRep *image = [self bitmapImageRepForCachingDisplayInRect:self.bounds];
    [self cacheDisplayInRect:self.bounds toBitmapImageRep:image];

    CALayer *layer = [CALayer layer];
    layer.contents = (id)image.CGImage;
    layer.doubleSided = NO;

    // Shadow settings based upon Mac OS X 10.6
    [layer setShadowOpacity:0.5f];
    [layer setShadowOffset:CGSizeMake(0,-10)];
    [layer setShadowRadius:15.0f];

    return layer;
}

@end 
```

头文件：

```
@interface AnimationFlipWindow : NSObject {

    BOOL _flipForward;

    NSWindow *mAnimationWindow;
    NSWindow *mTargetWindow;
}

// Direction of flip animation (property)
@property (readwrite, getter=isFlipForward) BOOL flipForward;

- (void) flip:(NSWindow *)activeWindow 
       toBack:(NSWindow *)targetWindow;
@end

#pragma mark -
#pragma mark CategoryMethods:

@interface CAAnimation (AnimationFlipWindow)
+ (CAAnimation *) animationWithDuration:(CGFloat)time 
                                   flip:(BOOL)bFlip // Flip for each side
                                forward:(BOOL)forwardFlip; // Direction of flip
@end

@interface NSWindow (AnimationFlipWindow)
+ (NSWindow *) initForAnimation:(NSRect)aFrame;
@end

@interface NSView (AnimationFlipWindow)
- (CALayer *) layerFromWindow;
@end 
```

编辑：这将动画从一个窗口翻转到另一个窗口。您可以将相同的主体应用于视图。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T17:31:56.867

就您的目的而言，这太过分了（因为它包含一个基本完整的棋盘和纸牌游戏参考应用程序），但请查看[ADC 中的此示例](http://developer.apple.com/samplecode/GeekGameBoard/index.html)。它附带的纸牌游戏很好地完成了翻转效果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T18:58:07.473

如果您能够对图像执行此操作，也许您可​​以将所有控件保留在一个`NSView`对象中（像往常一样），然后在执行翻转效果之前将其渲染`NSView`为位图图像。[`cacheDisplayInRect:toBitmapImageRep:`](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/cacheDisplayInRect:toBitmapImageRep:)步骤是：

1.  渲染`NSView`到位图
2.  在适合翻转效果的图层中显示该位图
3.  隐藏`NSView`和暴露图像层
4.  执行翻转效果

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-03T12:21:52.747

我知道这已经很晚了，但是 Apple 在这里有一个示例项目，可能对仍然遇到这个问题的任何人都有帮助。

[https://developer.apple.com/library/mac/#samplecode/ImageTransition/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010277](https://developer.apple.com/library/mac/#samplecode/ImageTransition/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010277)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-27T15:48:47.317

Mizage 的人有一个完整的开源实现。

你可以在这里查看：[https ://github.com/mizage/Flip-Animation](https://github.com/mizage/Flip-Animation)

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2015-01-30T22:42:34.363

2008 年问这个问题时可能不是这种情况，但现在这很容易：

```
[UIView animateWithDuration:0.5 animations:^{
    [UIView setAnimationTransition:UIViewAnimationTransitionFlipFromRight forView:self.iconView cache:YES];
    /* changes to the view made here will be reflected on the flipped to side */
}]; 
```

注意：显然，这仅适用于 iOS。

# c# - 运行时 C# 知道是否正在使用 32 位或 64 位版本的 COM 接口

> ID：372023
> 
> 赞同：3
> 
> 时间：2008-12-16T17:25:16.020
> 
> 标签：c#, interop, x86, 64-bit, regsvr32

我想构建一个 DLL 类库，使用 COM 互操作，使用 C#，以任何 CPU 为目标，并将其注册为 32 位和 64 位接口。

我希望能够在运行时显示使用的接口——如果我使用的是 32 位版本或 64 位版本。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T17:38:16.527

为了让进程加载 32 位 DLL，该进程必须是 32 位的。对于 64 位也是如此。所以要找出已经加载的内容，假设它已经工作了，你只需要找出 CLR 的位数：

```
if (System.IntPtr.Size == 8)
{
    // 64-bit
}
else
{
    // 32-bit
} 
```

PS。有关是否需要检查 16 大小的讨论，请参阅[我对这个问题的回答](https://stackoverflow.com/questions/342433/what-is-going-to-happen-to-our-primative-types-when-128-bit-processors-come-out#342486)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-04T15:27:23.470

再说一次，在 win64 上运行的 32 位进程呢？

[https://stackoverflow.com/a/3461562/1498669](https://stackoverflow.com/a/3461562/1498669)

如果您使用的是 .Net 4.0，则它是当前流程的单线：

`Environment.Is64BitProcess`

[http://msdn.microsoft.com/en-us/library/system.environment.is64bitprocess.aspx](http://msdn.microsoft.com/en-us/library/system.environment.is64bitprocess.aspx)

# asp-classic - MSXML2.ServerXMLHTTP 的默认 Content-Type 是什么？

> ID：372030
> 
> 赞同：3
> 
> 时间：2008-12-16T17:28:29.010
> 
> 标签：asp-classic, content-type, serverxmlhttp

在我[之前的问题](https://stackoverflow.com/questions/369226/receiving-xml-from-another-websites-call-to-serverxmlhttp-post-in-classic-asp)中，我不小心发送了带有`text/xml`Content-Type 的令牌/值对，导致没有发送任何内容。Tim C 对这个问题的洞察力非常有帮助。再次感谢蒂姆！

回顾最初的发送代码，我现在意识到将`ServerXMLHTTP`Content-Type 设置`text/xml`为是最近的错误添加。我在问题中发布的发送代码如下所示：

```
url = "www.receivingwebsite.com\asp\receivingwebpage.asp"
information = "UserName=Colt&PassWord=Taylor&Data=100"
Set xmlhttp = server.Createobject("MSXML2.ServerXMLHTTP")
xmlhttp.Open "POST", url, false
xmlhttp.setRequestHeader "Content-Type", "text/xml"
xmlhttp.send information 
```

实际的发送代码真的是：

```
url = "www.receivingwebsite.com\asp\receivingwebpage.asp"
information = "UserName=Colt&PassWord=Taylor&Data=100"
Set xmlhttp = server.Createobject("MSXML2.ServerXMLHTTP")
xmlhttp.Open "POST", url, false
xmlhttp.send information 
```

...在发送之前不尝试设置 Content-Type。

不幸的是，最初导致我寻求帮助的问题仍然存在。我的接收经典 asp 页面看不到该`ServerXMLHTTP`对象发布的信息。该信息不在请求对象的`querystring`或`form`数组中。无论我做什么，我都找不到信息，但我知道它正在发送，因为当我将 content-type 更改为 时，我可以在数组`application/x-www-form-urlencoded`中看到它。`request.form`

那么`MSXML2.ServerXMLHTTP`该类的默认内容类型是什么？

当发送类使用该默认内容类型时，我的信息在哪里？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-18T10:18:25.257

如果 POST 的内容类型是“application/x-www-form-urlencoded”，ASP 只会填充表单数组。通常 ServerXMLHTTP 不会设置内容类型标头，因此如果您不手动设置，则不会发送内容类型标头。

一个例外是您将 XML 文档作为要发送的参数传递，在这种情况下，ServerXMLHTTP 会将内容类型设置为“text/xml；charset=UTF-8”。

# sql - 在.NET/SQL 中参数化表名？

> ID：372033
> 
> 赞同：11
> 
> 时间：2008-12-16T17:30:24.873
> 
> 标签：sql, .net, sql-server, parameters

正如主题所暗示的那样，我希望能够使用 .NET（实际上与哪种语言无关）和 SQL Server 将表名作为参数传递。

我知道如何对值执行此操作，例如在查询中`command.Parameters.AddWithValue("whatever", whatever)`使用来表示参数。`@whatever`问题是我处于希望能够对查询的其他部分（例如列名和表名）执行此操作的情况。

这不是一个理想的情况，但它是我必须使用的，它不太容易发生 SQL 注入，因为只有使用代码的人才能设置这些表名，而不是最终用户。然而它很乱。

那么，我要问的可能吗？

编辑：为了清楚说明 SQL 注入，表名仅由源代码传入，具体取决于具体情况。指定这一点的是开发人员。无论如何，开发人员都可以访问数据库层，所以我问的原因不是为了安全，而是为了让代码更干净。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T17:39:13.293

您不能直接参数化表名。您可以通过 间接执行此操作`sp_ExecuteSQL`，但您也可以在 C# 中构建（参数化）TSQL（连接表名但不连接其他值）并将其作为命令发送。您将获得相同的安全模型（即您需要明确的 SELECT 等，并假设它未签名等）。

另外 - 请务必将表名列入白名单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T17:35:54.517

您可以像任何其他参数一样将表名作为参数传递。关键是您必须构建一个动态 sql 语句，然后您应该考虑在您的应用程序层或 procs 中构建它是否更容易。

```
create procedure myProc

@tableName nvarchar(50)

as

sp_executesql N'select * from ' + @tablename 
```

仅供参考，此代码示例来自内存，请查看 BOL 以了解 sp_executesql 的正确语法。

此外，这很容易受到 SQL 注入的影响，因为您指出这对您来说不是问题，但任何阅读本文的人都应该非常警惕接受用户的输入以生成这样的查询。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-16T17:37:09.210

SQL 查询参数只能代替文字值。您不能将参数用于表名、列名、值列表或其他 SQL 语法。这是所有品牌数据库的标准 SQL 行为。

使表名动态化的唯一方法是在将该字符串准备为语句之前将变量插入到 SQL 查询中。

顺便说一句，如果您认为这不是 SQL 注入的风险，那您就是在自欺欺人。如果将表名动态插入到查询中，则需要在表名周围使用*[分隔标识符](https://stackoverflow.com/questions/214309/do-different-databases-use-different-name-quote#214344)*，就像在从变量中插入的字符串文字周围使用引号一样。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-16T17:38:02.720

我*认为*我从未在我见过的任何 SQL 方言中看到过这种能力，但这不是一个专业领域。

我建议将字符限制为 AZ、az、0-9、'.'、'_' 和 '' - 然后对数据库使用任何适当的括号（例如，我相信 SQL Server 的 []）来换行围绕整个事情。然后直接放在SQL里面就行了。

不完全清楚你的意思是它不是 SQL 注入风险 - 你的意思是名称将在源代码中并且仅在源代码中？如果是这样，我同意这会让事情变得更好。*如果*您相信您的开发人员不是白痴（有意或无意），您甚至可能不需要自动进行包围。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-16T18:14:43.410

认为它不容易发生 SQL 注入的想法是错误的。它可能**不太**容易受到前端用户的 SQL 注入，但它仍然很容易受到 SQL 注入的影响。大多数对数据库的攻击来自被攻击的公司内部，而不是来自最终用户。

员工可能怀恨在心，他们可能不诚实，他们可能心怀不满，或者他们可能只是不够聪明，并认为绕过安全性去做**他们**认为应该对数据库做的任何事情都是可以的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-11T14:40:56.420

请参阅用户 Vimvq1987 的此帖子回答： [MySqlParameter as TableName](https://stackoverflow.com/questions/6041496/mysqlparameter-as-tablename)

本质上，您首先根据模式检查表名，其中表名以参数化方式使用。然后，如果一切正常，表名是合法的。

转述的基本思想是：

```
 SELECT table_name
    FROM information_schema.tables
    WHERE table_schema = 'databasename'
    AND table_name = @table;

    cmd.Parameters.AddWithValue("@table",TableName); 
```

如果这与表名返回 ok，请继续您的主查询...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-27T21:57:26.683

我只是检查 `select OBJECT_ID(@tablename)` 这个想法是为了防止注入你知道它必须是表名这是如果它返回一个数字那么我将运行实际查询，

# c# - 如何监听 ListView 中的滚动？

> ID：372034
> 
> 赞同：2
> 
> 时间：2008-12-16T17:30:32.547
> 
> 标签：c#, winforms, listview

ListView 似乎不支持 Scroll 事件。每当滚动列表时，我都需要调用一个函数；我该怎么做呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T19:50:50.283

为什么滚动列表时需要调用函数？

如果您在滚动时更改项目，我建议将列表视图设置为虚拟。

或者您可以覆盖列表视图并执行以下操作：

```
public class TestListView : System.Windows.Forms.ListView
{
    private const int WM_HSCROLL = 0x114;
    private const int WM_VSCROLL = 0x115;
    public event EventHandler Scroll;

    protected void OnScroll()
    {

        if (this.Scroll != null)
            this.Scroll(this, EventArgs.Empty);

    }

    protected override void WndProc(ref System.Windows.Forms.Message m)
    {
        base.WndProc(ref m);
        if (m.Msg == WM_HSCROLL || m.Msg == WM_VSCROLL)
            this.OnScroll();
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-08-05T13:03:12.527

似乎最好的方法是布赖恩的解决方案。但是，它只响应滚动条生成的事件，而不响应来自鼠标中键的事件。

如果您更改条件：

```
 if (m.Msg == WM_HSCROLL || m.Msg == WM_VSCROLL) 
             this.OnScroll(); 
```

经过：

```
 if (m.Msg == 0x000c2c9) 
             this.OnScroll(); 
```

现在它响应列表视图中的所有滚动事件。

# asp.net - 如何使用 Linq To Sql 将记录保存到关系表

> ID：372040
> 
> 赞同：0
> 
> 时间：2008-12-16T17:31:59.783
> 
> 标签：asp.net, linq-to-sql, transactions

我有三个这样的表：

**文章**编号文章 标题内容

**标签** IdTag标签名

**ContentTag** IdContentTag Idtag IdContent

当我网站中的用户撰写带有添加标签的文章并提交时，我想将其保存到上面的表格中。

在传统方式中，我曾经使用事务并且我可以做到。但是我怎样才能通过使用 linq to sql 来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T17:53:37.697

我想你正在寻找这样的东西。

[http://hookdonlinq.com/LINQtoSql5MinuteOverview.ashx](http://hookedonlinq.com/LINQtoSql5MinuteOverview.ashx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T17:55:27.753

首先定义一个 linq 到 sql 的映射。假设您将其称为“LtoS”。
在代码中使用它看起来像这样

```
using(var ts = new TransactionScope())
using(var dc = new LtoSDataContext())
{

  var _article = new article
  {
    Title="someTitle",
    Content="someContent"
  };
  dc.articles.InsertOnSubmit(_article);

  var _tag = new tag
  {
    TagName="someTagName"
  };
  dc.articles.InsertOnSubmit(_tag);

  var _contentTag = new contentTag
  {
    Tag = _tag,
    Article = _article
  };
  dc.articles.InsertOnSubmit(_tag);

  dc.SubmitChanges();
} 
```

我假设 contentTag 是其他两个表的外键。

请参阅[事务范围](http://msdn.microsoft.com/en-us/library/bb387002.aspx)。

# c# - 如何让 StructureMap 返回请求类型的特定实例

> ID：372041
> 
> 赞同：3
> 
> 时间：2008-12-16T17:32:07.567
> 
> 标签：c#, structuremap

我想为结构映射中的类型注册对象的特定实例，我该怎么做？

例如，

当我做：

```
var myObj = ObjectFactory.GetInstance(typeof(MyAbstractClass)); 
```

我希望它返回一个以前构造的具体类，我是这样创建的：

```
var myClass = new MyConcreteClass("bla"); // MyConcreteClass : MyAbstractClass 
```

所以

```
myObj == myClass 
```

我如何使用结构图注册 myClass 以促进这一点？

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T18:14:07.747

我相信你会在初始化时这样做

```
 ObjectFactory.Initialize(x =>
        {
            x.ForRequestedType<MyAbstractClass>().TheDefault.IsThis(myClass);
        }); 
```

其中 myClass 是您要返回的对象的实例。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-20T23:21:04.127

您可以通过以下方式注入一个具体实例作为默认实例

```
ObjectFactory.Inject(typeof(MyAbstractClass), myClass); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-30T20:16:55.977

在 StructureMap 中，3 方法已更改，此代码现在可以工作：

```
var emailService = new EmailService(ConfigurationManager.AppSettings[mykey]);

ObjectFactory.Initialize(x =>
{                
    x.For<IEmailService>().Use(emailService);
}); 
```

# python - Python中抽象类和接口的区别

> ID：372042
> 
> 赞同：599
> 
> 时间：2008-12-16T17:32:27.833
> 
> 标签：python, interface, abstract-class

Python中的抽象类和接口有什么区别？

* * *

## 回答 #1

> 赞同：650
> 
> 时间：2008-12-16T17:59:23.253

您有时会看到以下内容：

```
class Abstract1:
    """Some description that tells you it's abstract,
    often listing the methods you're expected to supply."""

    def aMethod(self):
        raise NotImplementedError("Should have implemented this") 
```

因为 Python 没有（也不需要）正式的接口契约，所以不存在抽象和接口之间的 Java 风格区别。如果有人努力定义一个正式的接口，它也将是一个抽象类。唯一的区别在于文档字符串中声明的意图。

当你有鸭子打字时，抽象和接口之间的区别是一件令人毛骨悚然的事情。

Java 使用接口是因为它没有多重继承。

因为Python有多重继承，你可能还会看到这样的东西

```
class SomeAbstraction:
    pass  # lots of stuff - but missing something

class Mixin1:
    def something(self):
        pass  # one implementation

class Mixin2:
    def something(self):
        pass  # another

class Concrete1(SomeAbstraction, Mixin1):
    pass

class Concrete2(SomeAbstraction, Mixin2):
    pass 
```

这使用一种带有混合的抽象超类来创建不相交的具体子类。

* * *

## 回答 #2

> 赞同：214
> 
> 时间：2015-07-15T19:15:20.010

> # Python中的抽象类和接口有什么区别？

一个对象的接口是该对象上的一组方法和属性。

在 Python 中，我们可以使用抽象基类来定义和实施接口。

## 使用抽象基类

例如，假设我们想使用`collections`模块中的抽象基类之一：

```
import collections
class MySet(collections.Set):
    pass 
```

如果我们尝试使用它，我们会得到一个，`TypeError`因为我们创建的类不支持集合的预期行为：

```
>>> MySet()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Can't instantiate abstract class MySet with abstract methods
__contains__, __iter__, __len__ 
```

*所以我们至少* 需要实现`__contains__`,`__iter__`和 `__len__`。让我们使用[文档](https://docs.python.org/2/library/collections.html#collections-abstract-base-classes)中的这个实现示例：

```
class ListBasedSet(collections.Set):
    """Alternate set implementation favoring space over speed
    and not requiring the set elements to be hashable. 
    """
    def __init__(self, iterable):
        self.elements = lst = []
        for value in iterable:
            if value not in lst:
                lst.append(value)
    def __iter__(self):
        return iter(self.elements)
    def __contains__(self, value):
        return value in self.elements
    def __len__(self):
        return len(self.elements)

s1 = ListBasedSet('abcdef')
s2 = ListBasedSet('defghi')
overlap = s1 & s2 
```

## 实现：创建一个抽象基类

`abc.ABCMeta`我们可以通过将元类设置为并在相关方法上使用`abc.abstractmethod`装饰器来创建自己的抽象基类。元类将被添加到`__abstractmethods__`属性中，防止实例化，直到这些被定义。

```
import abc 
```

例如，“可言”被定义为可以用文字表达的东西。假设我们想在 Python 2 中定义一个可实现的抽象基类：

```
class Effable(object):
    __metaclass__ = abc.ABCMeta
    @abc.abstractmethod
    def __str__(self):
        raise NotImplementedError('users must define __str__ to use this base class') 
```

或者在 Python 3 中，元类声明略有变化：

```
class Effable(object, metaclass=abc.ABCMeta):
    @abc.abstractmethod
    def __str__(self):
        raise NotImplementedError('users must define __str__ to use this base class') 
```

现在，如果我们尝试在不实现接口的情况下创建一个 effable 对象：

```
class MyEffable(Effable): 
    pass 
```

并尝试实例化它：

```
>>> MyEffable()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Can't instantiate abstract class MyEffable with abstract methods __str__ 
```

我们被告知我们还没有完成这项工作。

现在，如果我们通过提供预期的接口来遵守：

```
class MyEffable(Effable): 
    def __str__(self):
        return 'expressable!' 
```

然后我们可以使用从抽象类派生的具体版本：

```
>>> me = MyEffable()
>>> print(me)
expressable! 
```

我们可以用它做其他事情，比如注册已经实现这些接口的虚拟子类，但我认为这超出了这个问题的范围。但是，此处演示的其他方法必须使用该`abc`模块来调整此方法。

## 结论

我们已经证明，抽象基类的创建定义了 Python 中自定义对象的接口。

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2008-12-16T17:51:35.343

Python >= 2.6 有[Abstract Base Classes](http://docs.python.org/library/abc.html)。

> 抽象基类（缩写为 ABCs）通过提供一种定义接口的方法来补充鸭子类型，而其他技术（如 hasattr()）会很笨拙。Python 为数据结构（在 collections 模块中）、数字（在 numbers 模块中）和流（在 io 模块中）提供了许多内置的 ABC。您可以使用 abc 模块创建自己的 ABC。

还有[Zope 接口](http://pypi.python.org/pypi/zope.interface)模块，它被 zope 之外的项目使用，比如 twisted。我对它不是很熟悉，但是这里有一个 wiki 页面[可能](http://wiki.zope.org/Interfaces/FrontPage)会有所帮助。

通常，您不需要抽象类的概念或 python 中的接口（已编辑 - 有关详细信息，请参阅 S.Lott 的答案）。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2013-05-08T17:51:11.153

用更基本的方式来解释：界面有点像一个空的松饼盘。它是一个类文件，其中包含一组没有代码的方法定义。

抽象类是同样的东西，但并非所有函数都需要为空。有些可以有代码。它不是严格为空的。

为什么要区分：Python 没有太大的实际差异，但在大型项目的规划层面上，谈论接口可能更常见，因为没有代码。尤其是当您与习惯该术语的 Java 程序员一起工作时。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2008-12-16T17:38:22.687

Python 并没有这两个概念。

它使用[鸭子打字](https://stackoverflow.com/q/4205130)，这消除了对接口的需求（至少对于计算机:-)）

Python <= 2.5：基类显然存在，但没有明确的方法将方法标记为“纯虚拟”，因此该类并不是真正抽象的。

Python >= 2.6：抽象基类确实[存在](http://www.python.org/dev/peps/pep-3119/)（[http://docs.python.org/library/abc.html](http://docs.python.org/library/abc.html)）。并允许您指定必须在子类中实现的方法。我不太喜欢语法，但功能就在那里。大多数时候，从“使用”客户端使用鸭子打字可能会更好。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-12-16T18:19:55.660

通常，接口仅用于使用单继承类模型的语言中。在这些单继承语言中，如果任何类可以使用特定方法或方法集，则通常使用接口。同样在这些单继承语言中，抽象类用于在没有或更多方法之外定义类变量，或者利用单继承模型来限制可以使用一组方法的类的范围。

支持多重继承模型的语言倾向于只使用类或抽象基类而不是接口。由于 Python 支持多重继承，它不使用接口，您可能希望使用基类或抽象基类。

[http://docs.python.org/library/abc.html](http://docs.python.org/library/abc.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-07-23T06:40:44.877

抽象类是包含一个或多个抽象方法的类。除了抽象方法，抽象类还可以有静态、类和实例方法。但是在接口的情况下，它只有抽象方法，没有其他方法。因此，继承抽象类不是强制性的，但继承接口是强制性的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-04-05T18:17:00.063

为了完整起见，我们应该提到 引入 ABC 并与接口进行比较的[PEP3119 ，以及原始](https://www.python.org/dev/peps/pep-3119/#abcs-vs-interfaces)[Talin 的](https://mail.python.org/pipermail/python-3000/2007-April/006614.html)评论。

抽象类不是完美的接口：

*   属于继承层次
*   是可变的

但是，如果您考虑以自己的方式编写它：

```
def some_function(self):
     raise NotImplementedError()

interface = type(
    'your_interface', (object,),
    {'extra_func': some_function,
     '__slots__': ['extra_func', ...]
     ...
     '__instancecheck__': your_instance_checker,
     '__subclasscheck__': your_subclass_checker
     ...
    }
)

ok, rather as a class
or as a metaclass
and fighting with python to achieve the immutable object
and doing refactoring
... 
```

你会很快意识到你正在发明轮子以最终实现 `abc.ABCMeta`

`abc.ABCMeta`被提议作为缺少接口功能的有用添加，这在像 python 这样的语言中是公平的。

当然，在编写第 3 版时能够更好地增强它，并添加新的语法和不可变接口概念......

结论：

```
The abc.ABCMeta IS "pythonic" interface in python 
```

# .net - 如何评估在 F# 中存储为字符串的表达式

> ID：372043
> 
> 赞同：13
> 
> 时间：2008-12-16T17:32:53.447
> 
> 标签：.net, f#

我想做这样的事情：

```
let x = 5
let y = 10

let expr = Console.ReadLine()

expr 
```

可以在控制台中键入`"x+y"`以存储在 expr 中的位置。

如何在 F# 中评估这样的语句？

最终，我希望用户能够在网页上输入表达式或系统的一组规则，并将它们保存在数据库中，以便在适当的时间在 F# 库中应用。我只是不知道如何将输入的字符串转换为 F# 中的函数值。

感谢您提供的任何帮助！

亚当

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T17:14:25.207

[我刚刚看到 Joh 在他的F# 游戏开发页面](http://sharp-gamedev.blogspot.com/2008/09/tutorial-10-generic-programming-using.html)上使用报价评估

```
 open Microsoft.FSharp.Linq.QuotationEvaluation
      ...
      let mk_gravity scale_func (up: 'Vec): 'Vec =
      let q = <@ let (*) = %scale_func in -9.81 * up @>
      q.Eval() 
```

或者，如果您在进行简单的数学评估，您可以从他的 codeplex plage - [Symbolic Differentiation in C#/F#下载 Edmonodo 的 Expression parser and evaluator](http://www.codeplex.com/SymbDifferentiation)

祝你好运 - 吉日

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T17:48:45.257

如前所述，F# 没有 eval，但如果您可以定义语法，则可以利用 F# 中的 Lex 和 Yacc 实现（fslex 和 fsycc）。

*编辑：*

作为快速跟进，我知道在 ocaml 中，您可以使用`ocamlmktop`. 我不确定 F# 中的等价物。不过，这似乎与您想要的 Web 界面不匹配（对吗？）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T20:08:30.623

没有什么是开箱即用的。

我不确定您的需求是什么，但您可以考虑 Dynamic LINQ 示例。它有一个小解析器来生成表达式树，然后您可以编译或操作它。[ScottGu在这里](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)谈论它。

虽然它看起来主要用于扩展 LINQ 查询，但它充当了一个很好的解析器。我们改进了它以支持 do/let 绑定以获得更多灵活性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T17:37:26.730

F# 没有像 Lisp (AFAIK) 这样的 eval 函数，如果你想知道的话。不过，您可以根据字符串输入自己构建表达式树。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-01T21:16:53.830

或者您可以查看我的实现数学表达式求值器[的 F# 代码。](https://github.com/0x69/coding-experiments/blob/master/Fsharp/MathEvaluator.fs)

# nhibernate - 如何编写涉及多个联接的条件查询

> ID：372047
> 
> 赞同：2
> 
> 时间：2008-12-16T17:34:39.590
> 
> 标签：nhibernate, hql, criteria

我正在尝试使用 Criteria API 编写以下 HQL 查询：

```
var userList = _session
                .CreateQuery("select u from User u where u.Role.ID=3 and u.Customer.ID=:cID")
                .SetInt32("cID", 1)
                .List<User>(); 
```

（3 个 NHibernate 对象：用户（ID，名称，角色，客户），角色（ID，名称）和客户（ID，名称）。

我尝试了以下方法，但它不起作用，因为 NHibernate 试图找到与角色关联的客户：

```
var userList = _session
            .CreateCriteria(typeof(User))
            .CreateCriteria("Role")
            .Add(Restrictions.Eq("ID", 3) )
            .CreateCriteria("Customer")
            .Add(Restrictions.Eq("ID", 1) )
            .List<User>(); 
```

还有其他方法（可行！）吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T07:31:25.283

您可以使用别名

```
var userList = _session
        .CreateCriteria(typeof(User), "u")
        .CreateAlias("u.Role", "r")
        .Add(Restrictions.Eq("r.ID", 3) )
        .CreateAlias("u.Customer", "c")
        .Add(Restrictions.Eq("c.ID", 1) )
        .List<User>(); 
```

希望能帮助到你

# css - 用于定位和设计的表格与 CSS

> ID：372050
> 
> 赞同：3
> 
> 时间：2008-12-16T17:35:16.500
> 
> 标签：css, html-table

**复制：[表而不是 DIV](https://stackoverflow.com/questions/30251/tables-instead-of-divs#30271)和 [为什么不在 HTML 中使用表格进行布局？](https://stackoverflow.com/questions/83073/div-vs-table#83121)**

我正在使用 ASP .NET MVC 构建一个 Web 应用程序（需要在 IE 7、FF 3.0 上运行），如果我使用表格而不是 css 进行定位和设计是否重要？

作为一名开发人员，我没有机会使用 css。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T17:41:17.597

是的，这很重要。我用来支持 CSS 而不是表格的最有说服力的论点是屏幕阅读器（针对视障人士）会跳过表格布局。这本身就是一个很好的论据，但是当您考虑到*Google 像屏幕阅读器一样阅读您的网站*这一事实时，它会变得更好。如果您希望 Google 更轻松地为您的网站编制索引，请使用 CSS 进行布局。表格用于表格数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T17:39:04.340

当您确实想要显示表格数据时，请使用表格。

否则你真的应该在你的布局中使用 CSS。

主要原因是 CSS 更适用于“不寻常”的浏览器，如下所示：

*   移动浏览器/智能手机
*   搜索引擎
*   视障人士的屏幕阅读器

如果您为美国政府工作，则最后一项是法律要求。

另请参阅以下问题：
[表格而不是 DIV](https://stackoverflow.com/questions/30251/tables-instead-of-divs)
[为什么不在 HTML 中使用表格进行布局？](https://stackoverflow.com/questions/83073/div-vs-table)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T17:40:24.290

除了所有“表格是邪恶的”思想流派之外，如果您使用纯 css 布局，您会发现将来更改设计会容易得多。

此外，您的标记将更简单、更易于“阅读”。

看看css。加快速度应该不会超过一天。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T17:43:04.720

是的，如果您的应用程序 UI 需要达到高标准。不，如果您只是学习掌握一些临时概念或想出一个快速原型。CSS vs. Tables 的好处得到了很好的讨论。使用 CSS，网站变得更加灵活和易于访问，看看 CSSZen garden。

附带说明一下，HTML DOCTYPE 声明和验证同样重要。以免您花时间为每个浏览器修复样式

# .net - 谁能给我一个关于 InsertOnSubmit 和 InsertAllOnSubmit 的解释性例子

> ID：372075
> 
> 赞同：2
> 
> 时间：2008-12-16T17:40:43.167
> 
> 标签：.net, linq-to-sql

我试图了解这两者之间的区别，并且确实需要一个解释性的简单示例。

提前致谢..

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T17:44:57.090

在 MSDN 论坛上有一个[很好的问答。](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2747627&SiteID=1)最有趣的一点：

> InsertAllOnSubmit() 简单地循环遍历 IEnumerable 集合中的所有元素，并为每个元素调用 InsertOnSubmit()。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T17:43:11.523

[`InsertOnSubmit`](http://msdn.microsoft.com/en-us/library/bb763516.aspx)添加一条记录。[`InsertAllOnSubmit`](http://msdn.microsoft.com/en-us/library/system.data.linq.itable.insertallonsubmit.aspx)做同样的事情，但对于一组 ( `IEnumerable<T>`) 记录。就是这样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T19:04:17.307

[我在此页面](http://www.scip.be/index.php?Page=ArticlesNET02)的最底部找到了 InsertAllOnSubmit() 的示例。只需记住为 System.Collections.Generic 添加 using 语句

```
// Create list with new employees
List<Employee> employeesToAdd = new List<Employee>();

employeesToAdd.Add(new Employee() { EmployeeID = 1000, FirstName = "Jan", LastName = "Jansen", Country = "BE" });
employeesToAdd.Add(new Employee() { EmployeeID = 1001, FirstName = "Piet", LastName = "Pieters", Country = "BE" });
employeesToAdd.Add(new Employee() { EmployeeID = 1002, FirstName = "John", LastName = "Johnson", Country = "BE" });

// Add all employees to the Employees entityset 
dc.Employees.InsertAllOnSubmit(employeesToAdd);

// Apply changes to database
dc.SubmitChanges(); 
```

# performance - 在 IIS6 应用程序池上查看特定于进程的性能统计信息的可靠方法

> ID：372080
> 
> 赞同：1
> 
> 时间：2008-12-16T17:42:28.793
> 
> 标签：performance, iis, statistics, worker-process

在 Windows Server 2003 的 perfmon 中，有一些计数器对象可以获取每个进程的处理器时间和内存工作集统计信息。唯一的问题是，在具有多个应用程序池的环境中，没有办法可靠地识别正确的工作进程。在perfmon中，它们都被称为“w3wp”，如果有多个，它们是w3wp、w3wp#1、w3wp#2，以此类推。即使这些名称也不可靠 - 数量取决于哪个最先启动，并且在应用程序池被回收时显然会发生变化，因为进程被破坏并重新启动。

我没有找到任何特定于 ASP.NET 的计数器，并且由于某种原因，我的 IIS 对象没有分隔实例——只有一个“全局”实例。

最终，我只想要特定 IIS 应用程序池的“% Processor Time”和“Working Set”计数器。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T17:47:59.063

我们总是收集所有 w3wp 进程的统计信息，并且我们会捕获 PID。这是进程组中的计数器之一。

在 Server 2003 的 system32 文件夹中有一个名为 IISApp.vbs 的脚本，它将列出所有进程及其 PID。您将需要运行它来捕获 PID。

我确信必须有更好的方法，但是当我们需要进行临时监控时，这很有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-17T14:38:02.440

w3wp 实例可能不会出现，如果工作进程长时间处于空闲状态。UI 界面必须使用一小段时间，以便工作进程 (w3wp) 可以显示在实例中。

# sql-server - 在 SQL Server 2005 中，是否有一种简单的方法可以将对象的权限从一个用户/角色“复制”到另一个用户/角色？

> ID：372086
> 
> 赞同：2
> 
> 时间：2008-12-16T17:44:36.810
> 
> 标签：sql-server, scripting, permissions

我问[了另一个](https://stackoverflow.com/questions/370024/sql-server-2005-public-database-role-doesnt-seem-to-apply)关于角色和权限的问题，这主要是为了暴露我的无知。其他结果之一是建议人们通常应该远离“公共”角色的权限。

好的，很好，但是如果我已经这样做了并且想将相同的权限重新分配给自定义/“灵活”角色，那么最好的方法是什么？到目前为止，我所做的是运行脚本向导，并告诉它在没有 CREATE 或 DROP 的情况下编写对象权限脚本，然后运行 ​​find-replace 以便我得到很多`"GRANT DELETE on [dbo.tablename] TO [newRole]"`. 它完成了工作，但我觉得它可能更漂亮/更容易。任何“最佳实践”建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T19:44:07.580

从内存中工作（我的游戏'pooter 上没有 SQL），您可以使用[`sys.database_permissions`](http://msdn.microsoft.com/en-us/library/ms188367(SQL.90).aspx)

运行此命令并将结果粘贴到新查询中。

编辑，2012 年 1 月。添加了 OBJECT_SCHEMA_NAME。
~~您可能需要通过加入 sys.objects 来支持模式 (dbo.)~~

```
SET NOCOUNT ON;
DECLARE @NewRole varchar(100), @SourceRole varchar(100);

-- Change as needed
SELECT @SourceRole = 'Giver', @NewRole = 'Taker';

SELECT
    state_desc + ' ' + 
          permission_name + ' ON ' + 
          OBJECT_SCHEMA_NAME(major_id) + '.' + OBJECT_NAME(major_id) +
          ' TO ' + @NewRole
FROM
    sys.database_permissions
WHERE
    grantee_principal_id = DATABASE_PRINCIPAL_ID(@SourceRole) 
    AND
    -- 0 = DB,  1 = object/column, 3 = schema. 1 is normally enough
    class <= 3; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T21:01:01.373

拥有一个角色的想法是您只需要设置一次权限。然后，您可以将用户或用户组分配给该角色。

也可以嵌套角色，以便一个角色可以包含其他角色。

不确定它是否是最佳实践，但如果您拥有一组复杂的权限，并且需要访问多个应用程序的用户组，您可以这样做：

NT 用户 -> NT 安全组 -> SQL Server 角色 -> SQL Server 角色 A、角色 B ...

# vb.net - vb.net 中 LINQ 的新手问题

> ID：372087
> 
> 赞同：2
> 
> 时间：2008-12-16T17:44:48.167
> 
> 标签：vb.net, linq, exists

这是我的一个函数中的一行，用于测试我的数组中的任何对象是否具有具有匹配值的给定属性

```
Return ((From tag In DataCache.Tags Where (tag.FldTag = strtagname) Select tag).Count = 1) 
```

在哪里....

`DataCache.Tags` 是一组自定义对象

`strtagname = "brazil"`

brazil 绝对是存储在数组中的自定义对象之一中的标记名称。

但是，该函数不断返回 false。

有人可以向我确认以上应该或不应该工作。

如果它不起作用，有人可以告诉我测试数组中的任何对象是否包含具有特定值的属性的最佳方法。

我想总而言之，我正在寻找相当于 SQL EXISTS 语句的东西。

非常感谢希望。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T17:48:38.690

您的代码当前正在检查计数是否*正好是*一。

LINQ 中 EXISTS 的等价物是[Any](http://msdn.microsoft.com/en-us/library/system.linq.queryable.any.aspx)。你想要这样的东西：

```
Return DataCache.Tags.Any(Function(tag) tag.FldTag = strtagname) 
```

（奇迹般地看起来语法可能是正确的......它看起来像文档示例......）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T19:59:25.040

非常感谢您的回复。

您的代码不起作用。然后我意识到我正在与一个数组值进行比较，所以它是区分大小写的。

不过很高兴我问了这个问题，因为我找到了比我更好的方法。

再次感谢！

# c++ - 在 qt/kdelibs 应用程序上显示后更改终端接口命令

> ID：372094
> 
> 赞同：1
> 
> 时间：2008-12-16T17:47:25.260
> 
> 标签：c++, qt, kde, kparts

我的 qt/kde 应用程序上有这个终端

```
KLibFactory* factory = KLibLoader::self()->factory("libkonsolepart");
KParts::Part* p = static_cast<KParts::Part*> (factory->create(this,"terminal",QStringList() << "terminal"));
assert(p);
TerminalInterface* terminalInterface= qobject_cast<TerminalInterface*> (p);
terminalInterface->showShellInDir(QDir::home().path());
QWidget* terminal = p->widget(); 
```

所以，我在窗口中看到的小部件是“终端”，但是当定义的事件发生时（显然，当终端已经显示时）我如何更改它的内部命令？我试过：

```
terminalInterface->startProgram( QString::fromUtf8( "/usr/bin/python" ), QStringList() << "python"); 
```

但只有当我在最后一行之前这样做时它才有效：

```
QWidget* terminal = p->widget(); 
```

即代替 ->showShellInDir(QDir::home().path()); 方法。

一些帮助？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T21:33:34.833

哈拉阿米戈！您可以使用以下命令将任何命令发送到 TerminalInterface 提示符

```
 terminalInterface->sendInput("/usr/bin/python\n"); 
```

我希望它会有用：D

# python - Python 正则表达式中的 UTF

> ID：372102
> 
> 赞同：7
> 
> 时间：2008-12-16T17:49:12.587
> 
> 标签：python, regex

我知道 Python 3 修复了很多 UTF 问题，但是我无法使用 Python 3，我使用的是 2.5.1

我正在尝试对文档进行正则表达式，但该文档中包含 UTF 连字符 - 而不是 -。Python 无法匹配这些，如果我将它们放在正则表达式中，它会引发不稳定。

如何强制 Python 使用 UTF 字符串或以某种方式匹配这样的字符？

谢谢你的帮助

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T18:01:19.163

您必须转义有问题的字符 (–) 并将 au 放在字符串文字的前面以使其成为 unicode 字符串。

因此，例如，这个：

```
re.compile("–") 
```

变成这样：

```
re.compile(u"\u2013") 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T18:20:34.443

在快速测试并访问[PEP 0264：Defining Python Source Code Encodings](http://www.python.org/dev/peps/pep-0263/)之后，我看到您可能需要通过在第一行添加这样的注释来告诉 Python 整个文件是 UTF-8 编码的。

```
# encoding: utf-8 
```

这是我在 Python 2.5.1 / OS X 10.5.6 上创建并运行的测试文件

```
# encoding: utf-8
import re
x = re.compile("–") 
print x.search("xxx–x").start() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T18:27:38.750

不要在正则表达式中使用 UTF-8。UTF-8 是一种多字节编码，其中一些 unicode 代码点由 2 个或更多字节编码。您可以匹配您不打算匹配的部分字符串。而是按照建议使用 unicode 字符串。

# php - strspn 的意义何在？

> ID：372105
> 
> 赞同：7
> 
> 时间：2008-12-16T17:50:40.680
> 
> 标签：php, function, built-in

在今天的工作中，我们试图想出任何你会使用[strspn](http://www.php.net/strspn)的理由。

我搜索了谷歌代码，看看它是否曾经以一种有用的方式实现过，结果是空白的。我只是无法想象一种情况，我真的需要知道一个字符串的第一段的长度，它只包含另一个字符串中的字符。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T18:08:04.530

虽然您链接到 PHP 手册，但该`strspn()`函数来自 C 库，以及`strlen()`, `strcpy()`,`strcmp()`等。

`strspn()`是一种方便的替代方法，可以替代逐个字符地挑选字符串，测试字符是否与一组值中的一个匹配。在编写分词器时很有用。替代方案`strspn()`将是大量重复且容易出错的代码，如下所示：

```
for (p = stringbuf; *p; p++) {
  if (*p == 'a' || *p == 'b' || *p = 'c' ... || *p == 'z') {
    /* still parsing current token */
  }
} 
```

你能发现错误吗？:-)

当然，在内置支持正则表达式匹配的语言中，`strspn()`这没什么意义。但是，当用 C 为 DSL 编写一个基本的解析器时，它非常漂亮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T18:02:00.003

它基于 ANSI C 函数`strspn()`。它在没有高级字符串类的低级 C 解析代码中很有用。它在 PHP 中用处不大，它有很多有用的字符串解析函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T18:04:47.110

好吧，据我了解，它与此正则表达式相同：

```
^[set]* 
```

其中 set 是包含要查找的字符的字符串。

您可以使用它来搜索字符串开头的任何数字或文本并进行拆分。

将代码移植到 php 时似乎很有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-14T11:00:27.443

I think its great for blacklisting and letting the user know from where the error started. Like MySQL returns part of the query from where the error occured.

Please see this function, that lets the user know which part of his comment is not valid:

```
function blacklistChars($yourComment){

$blacklistedChars = "!@#$%^&*()";
$validLength = strcspn($yourComment, $blacklistedChars);
if ($validLength !== strlen($yourComment))
{

    $error = "Your comment contains invalid chars starting from here: `" . 
        substr($yourComment, (int) '-' . $validLength) . "`";

    return $error;
}

return false;
}

$yourComment = "Hello, why can you not type and $ dollar sign in the text?"; 
$yourCommentError = blacklistChars($yourComment);

if ($yourCommentError <> false)
echo $yourCommentError; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T18:22:13.440

It is useful specificaly for functions like atoi - where you have a string you want to convert to a number, and you don't want to deal with anything that isn't in the set "-.0123456789"

But yes, it has limited use.

-Adam

# oracle - 在 Oracle 中将对象序列化为 BLOB

> ID：372114
> 
> 赞同：1
> 
> 时间：2008-12-16T17:55:12.247
> 
> 标签：oracle, serialization, blob

我有一个 HashMap，我在 BLOB 数据类型字段中对 Oracle 数据库进行序列化和反序列化。我想使用此字段执行查询。例如，应用程序将创建一个新的 HashMap，并具有一些键值对。我想查询数据库以查看数据库中是否已存在具有此数据的 HashMap。我不知道该怎么做，如果我必须去数据库中的每条记录，反序列化它，然后比较，这似乎很奇怪，SQL 是否处理比较 BLOB，所以我可以...从 PROCESSES where foo = ?....而且 foo 是 BLOB 类型，而 ? 是新HashMap的一个实例吗？谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T18:30:15.500

这里有一篇文章供您阅读：[敲钉子：旧鞋或玻璃瓶](http://weblogs.asp.net/alex_papadimoulis/archive/2005/05/25/408925.aspx)

我没有听说太多关于您的应用程序的底层架构，但我可以立即告诉您，您*没有*理由需要以这种方式使用 HashMap。这是一种糟糕的技术，简单明了。

您的问题的答案不是一个聪明的 Oracle 查询，而是对您的应用程序架构的重新设计。

首先，您不应该将 HashMap 序列化到数据库（更一般地说，您不应该序列化需要查询的任何内容）。在您的应用程序中创建一个表来表示哈希图要容易得多，如下所示：

```
哈希映射
--------
MapID (pk int)
密钥（pk varchar）
价值

```

一旦您在数据库中获得了 hashmap 的内容，查询数据库以查看数据是否已经存在或生成任何其他类型的聚合数据就很简单了：

```
SELECT Count(*) FROM HashMaps where MapID = ? AND Key = ? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T18:42:32.747

将序列化对象存储在数据库中*几乎*总是一个坏主意，除非您提前知道不需要查询它们。

你是如何序列化 HashMap 的？有很多方法可以序列化数据和像 HashMap 这样的对象。比较两个映射，尤其是序列化形式的映射，并非易事，除非您的序列化技术保证两个等效映射始终以相同的方式序列化。

解决这种混乱的一种方法是对一些很少需要查询的对象使用 XML 序列化。例如，在我工作的地方，我们有一个日志表，其中某个日志消息作为 XML 文件存储在 CLOB 字段中。此 xml 数据表示一个序列化的 Java 对象。通常我们查询记录中的其他列，并且仅以单个原子步骤读取/写入 blob。然而，有一次或两次需要对 blob 进行深入检查，而使用 XML 允许这种情况发生（Oracle 支持在 varchar2 或 CLOB 字段中查询 XML 以及本机 XML 对象）。如果谨慎使用，这是一项有用的技术。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T22:37:56.827

查看 dbms_crypto.hash 以对您的 blob 进行哈希处理。将散列存储在 blob 旁边，它可以让您将搜索范围缩小到可管理的范围内。我不建议存储散列映射，但这是搜索 blob 之间完全匹配的通用技术。另请参阅[SQL - 你如何比较 CLOB](https://stackoverflow.com/questions/110587/sql-how-do-you-compare-a-clob)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T18:35:58.187

我不能不同意，但有人告诉我这样做。我很欣赏你的解决方案，这就是我以前所拥有的。谢谢

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T18:02:27.257

我不需要比较 BLOB，但它似乎是通过`dbms_lob`包支持的。

[请](http://www.psoug.org/reference/dbms_lob.html)参阅`dbms_lob.compare()`http://www.psoug.org/reference/dbms_lob.html

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-23T13:45:14.097

Oracle 可以使用 Java（或 Windows 上的 .net）定义新的数据类型，您可以为序列化对象定义数据类型并定义查询如何处理它。

如果你试试这个，那就太缺乏了......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-23T13:51:27.060

如果将数据序列化为 xml，并将数据存储在 xml 中，则可以在 sql 查询中使用 xpath。（对不起，因为我是一个 SqlServer 人，我不知道如何在 Oracle 中执行此操作的详细信息。）

*   **如果您只需要更新部分序列化数据，请不要这样做。**
*   **同样，如果任何数据被其他数据指向或指向其他数据，则不要这样做。**

# bash - 编写运行命令并记录其退出代码的包装函数的最佳方法是什么

> ID：372116
> 
> 赞同：20
> 
> 时间：2008-12-16T17:55:40.390
> 
> 标签：bash, unix, shell

我目前使用这个函数来包装执行命令并记录它们的执行，并返回代码，并在非零返回代码的情况下退出。

然而，这显然是有问题的，它会进行双重插值，使带有单引号或双引号的命令破坏脚本。

你能推荐一个更好的方法吗？

这是功能：

```
do_cmd()
{
    eval $*
    if [[ $? -eq 0 ]]
    then
        echo "Successfully ran [ $1 ]"
    else
        echo "Error: Command [ $1 ] returned $?"
        exit $?
    fi
} 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-16T17:59:09.480

```
"$@" 
```

来自[http://www.gnu.org/software/bash/manual/bashref.html#Special-Parameters](http://www.gnu.org/software/bash/manual/bashref.html#Special-Parameters)：

> @
> 
> 扩展到位置参数，从一个开始。当扩展出现在双引号内时，每个参数都扩展为一个单独的单词。即“$@”等价于“$1”“$2”……。如果双引号扩展出现在一个单词中，第一个参数的扩展与原单词的开头部分连接，而最后一个参数的扩展与原始单词的最后一部分相连。当没有位置参数时，"$@" 和 $@ 扩展为空（即，它们被删除）。

这意味着参数中的空格被正确地重新引用。

```
do_cmd()
{
    "$@"
    ret=$?
    if [[ $ret -eq 0 ]]
    then
        echo "Successfully ran [ $@ ]"
    else
        echo "Error: Command [ $@ ] returned $ret"
        exit $ret
    fi
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T18:08:22.143

除了`"$@"`道格拉斯所说的，我会用

```
return $? 
```

而不是`exit`。它会退出你的 shell 而不是从函数返回。如果您想在出现问题时退出 shell，您可以在调用者中执行此操作：

```
do_cmd false i will fail executing || exit
# commands in a row. exit as soon as the first fails
do_cmd one && do_cmd && two && do_cmd three || exit 
```

（这样，您可以处理失败，然后优雅地退出）。

# java - 为什么要细分为内部项目的 maven-modules？

> ID：372119
> 
> 赞同：3
> 
> 时间：2008-12-16T17:58:08.233
> 
> 标签：java, maven-2

在我们的项目中，我们一直在讨论我们的 Maven 模块的粒度。我们已经同意，框架（如 spring）和始终以单片方式部署的内部应用程序的需求可能存在差异。

我们也同意将适配器的实现细节隐藏到一个单独的 API 模块后面是相当明智的，这样实现类就不会渗入主要实现的类路径中。但是，这就是我们所能做到的。这是一个网络项目，所以我们有“网络”、“核心”和“适配器”等模块。我们有多个后端，但我们不需要可插入性。

您在 maven 中使用什么标准进行模块化？您为 Web 项目制作了哪些模块？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T18:42:30.873

在我看来，项目部门应该是非常细粒度的，即使是“只有一个 webapp”。

我会为数据访问层接口和实现、业务层接口和实现以及 webapp 本身创建单独的项目。我还将制作至少一个“公共”项目，以包含与多个其他项目相关的代码。但这仅仅是开始。无论正在开发的应用程序（字符串、日期、反射等）如何，我都会毫不犹豫地为相关的实用程序类提取一个 commons-util 项目。在进行测试（commons-test）时，我还会为有用的实用程序创建一个项目。这只是下一步... ;)

如果我编写了与 hibernate 相关的一般有用的代码，我会将它放在 hibernate-utils 项目中。有用的 Spring 实用程序将放在 spring-utils 项目等中。这样做时，许多项目将只包含一个或几个包，并且包通常包含几个类。

我这样做的理由是，它可以帮助我思考我编写的代码。这真的是业务逻辑，还是一般的字符串操作、日期操作、Hibernate 特定逻辑等？我的层变得更干净，并且在包和项目之间获得循环依赖变得更加困难（我们不想要那些）。此外，在其他项目中重用代码变得更加容易。总会有其他项目...

我还发现新开发人员更容易掌握结构，因为项目变得更小更易于管理；当您觉得不必了解所有内容时，开始编码会更容易。

作为细粒度方法的最后一个优势，构建时间减少了，因为您不必每次都构建所有内容。

# sql - T-SQL：比较两个表 - 第二个表中不存在的记录

> ID：372126
> 
> 赞同：10
> 
> 时间：2008-12-16T18:00:29.600
> 
> 标签：sql, sql-server-2005, tsql

If`UNION ALL`是T-SQL 中的一个*附加项。*减法的等价物是什么？

例如，如果我有一张桌子`PEOPLE`和一张桌子`EMPLOYEES`。而且我知道如果我删除`EMPLOYEES`记录，`PEOPLE`我将留在我的公司`CONTRACTORS`。

有没有一种类似于的方法`UNION ALL`？一个我不必指定任何字段名称的地方？我问的原因是这只是一个假设的例子。我需要对许多不同的表多次执行此操作。假设 和 的模式`EMPLOYEES`相同`PEOPLE`。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-16T18:13:25.597

您可以使用[EXCEPT 运算符](http://msdn.microsoft.com/en-us/library/ms188055.aspx)从一组中减去一组。这是使用 EMPLOYEES 和 PEOPLE 临时表的代码示例。据我所知，您需要将字段名称与 EXCEPT 运算符一起使用。

```
CREATE TABLE #PEOPLE
(ID INTEGER,
 Name NVARCHAR(50))

CREATE TABLE #EMPLOYEE
(ID INTEGER,
 Name NVARCHAR(50))
GO

INSERT #PEOPLE VALUES (1, 'Bob')
INSERT #PEOPLE VALUES (2, 'Steve')
INSERT #PEOPLE VALUES (3, 'Jim')
INSERT #EMPLOYEE VALUES (1, 'Bob')
GO

SELECT ID, Name
FROM #PEOPLE
EXCEPT 
SELECT ID, Name
FROM #EMPLOYEE
GO 
```

最终查询将返回 PEOPLE 表中不存在于 EMPLOYEE 表中的两行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-16T18:06:29.293

```
SELECT
     P.*
FROM
     People P
LEFT OUTER JOIN Employees E ON
     E.ID = P.ID     -- Or whatever your PK-FK relationship is
WHERE
     E.ID IS NULL 
```

对于 SQL Server，这可能是您可以做到的最高效的方式。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-16T18:07:22.690

如中所述，不要使用 UNION，而是使用 EXCEPT，（或 INTERSECT 仅获取两者中的记录）

[msdn 除了 Sql2k8 的链接](http://msdn.microsoft.com/en-us/library/ms188055.aspx)

[msdn 除了 Sql2k5 的链接](http://msdn.microsoft.com/en-us/library/ms188055(SQL.90).aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-16T18:05:31.010

```
SELECT * FROM Table1
WHERE Table1.Key NOT IN (SELECT Table2.Key FROM Table2 WHERE Table2.Key IS NOT NULL) 
```

添加 IS NOT NULL 让人们开心。

我同意汤姆的观点。他的版本很可能更有效。使用我的唯一可能的原因可能是它更漂亮。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T18:16:55.293

不幸的是，您的设计存在问题。而不是有两个表 PEOPLE 和 CONTRACTOR。您应该有一个表 PEOPLE 和另一个表 TYPE（如果某些人可以担任多个角色，则可能需要另一个表）。在您的 PEOPLE 表中，您可以参考 TYPE 表。

那么你的要求变成

```
SELECT * from PEOPLE, TYPE
WHERE PEOPLE.type_id = TYPE.id 
AND TYPE.name = 'CONTRACTOR'

SELECT * from PEOPLE, TYPE
WHERE PEOPLE.type_id = TYPE.id 
AND TYPE.name = 'EMPLOYEE' 
```

（未经测试）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-26T17:36:38.213

当我比较表以查找不在另一个中的数据时，我通常使用 SQL Division。

```
select *(or selected matching field) 
from tableA as A
where not exist
(select *(or selected matching field) 
from tableB as B 
where A.key = B.key) 
```

此查询将通过除法过程返回不在 tableA 中的结果。

```
select *(or selected matching field) 
from tableA as A
where exist
(select *(or selected matching field) 
from tableB as B 
where A.key = B.key) 
```

此查询将返回两个表中匹配的所有数据行，因此如果 tableA 中的行数据不在 tableB 中，则不会检索该数据行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-05T07:05:34.457

我发现使用 SQLMerger 之类的工具为您执行此操作要容易得多。结果以更好的方式显示，之后您可以轻松地继续处理您需要对数据执行的任何操作。

www.auisoft.com/SQLMerger <= 便于比较数据的工具

比较两个表的示例：http: [//auisoft.com/SQLMerger/How-to/visualize-differences-in-2-databases/](http://auisoft.com/SQLMerger/How-to/visualize-differences-in-2-databases/)

# com - C# COM DLL：我使用 Regasm 还是 Regsvr32？

> ID：372140
> 
> 赞同：24
> 
> 时间：2008-12-16T18:04:11.217
> 
> 标签：com, interop, x86, 64-bit, activex

我正在构建一个 C# ActiveX DLL……我是使用 REGASM 还是 REGSVR32 来注册它？

如何注册 64 位接口与 32 位接口？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-16T18:22:24.970

您需要使用[`regasm.exe`](http://msdn.microsoft.com/en-us/library/tzat5yw6%28v=vs.80%29.aspx)注册 32 位和 64 位接口我相信您需要运行每个`regasm.exe`'s in：

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727 
```

和

```
C:\Windows\Microsoft.NET\Framework64\v2.0.50727 
```

所以......在你的情况下，你需要`regasm.exe`在`Framework64\v2.0.50727`文件夹中运行。

这是我们用来为我们的一个旧 ASP 应用程序注册 COM 互操作 DLL 的示例：

```
regasm.exe Hosting.DeviceManager.Power.dll /register /codebase /tlb 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-19T09:20:41.037

如果 DLL 以“Any CPU”的格式构建，无论您是否选择 regasm

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727 
```

或者

```
C:\Windows\Microsoft.NET\Framework64\v2.0.50727 
```

DLL 将注册为 32 位。

# java - 正则表达式在字符串中查找整数

> ID：372148
> 
> 赞同：21
> 
> 时间：2008-12-16T18:05:47.967
> 
> 标签：java, regex, integer

我想在 Java 中使用正则表达式。

我想要做的是找到字符串中的第一个整数。

例子：

```
String = "the 14 dogs ate 12 bones" 
```

将返回 14。

```
String = "djakld;asjl14ajdka;sdj" 
```

也将返回 14。

这就是我到目前为止所拥有的。

```
Pattern intsOnly = Pattern.compile("\\d*");
Matcher makeMatch = intsOnly.matcher("dadsad14 dssaf jfdkasl;fj");
makeMatch.find();
String inputInt = makeMatch.group();
System.out.println(inputInt); 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-12-16T18:08:23.547

您要求 0 个或更多数字。您需要要求 1 个或多个：

```
"\\d+" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-09-10T21:23:20.233

看起来其他解决方案无法处理`+/-`以及支持的情况`2e3`，`java.lang.Integer.parseInt(String)`所以我会解决这个问题。我对正则表达式有点缺乏经验，所以我可能犯了一些错误，使用了 Java 的正则表达式解析器不支持的东西，或者让它过于复杂，但这些语句似乎在[Kiki 0.5.6](http://code.google.com/p/kiki-re/)中有效。

*所有正则表达式都以非转义格式提供以供阅读，以及可以在 Java 中用作字符串文字的转义格式。*

**要从字符串中获取 byte、short、int 或 long：**

```
unescaped: ([\+-]?\d+)([eE][\+-]?\d+)?
  escaped: ([\\+-]?\\d+)([eE][\\+-]?\\d+)? 
```

...以及奖励积分...

**从字符串中获取双精度或浮点数：**

```
unescaped: ([\+-]?\d(\.\d*)?|\.\d+)([eE][\+-]?(\d(\.\d*)?|\.\d+))?
  escaped: ([\\+-]?\\d(\\.\\d*)?|\\.\d+)([eE][\\+-]?(\\d(\\.\\d*)?|\\.\\d+))? 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-22T20:08:14.610

这是我用泛型为 C# 制作的一个方便的。它将根据您的正则表达式进行匹配并返回您需要的类型：

```
public T[] GetMatches<T>(string Input, string MatchPattern) where T : IConvertible
    {
        List<T> MatchedValues = new List<T>();
        Regex MatchInt = new Regex(MatchPattern);

        MatchCollection Matches = MatchInt.Matches(Input);
        foreach (Match m in Matches)
            MatchedValues.Add((T)Convert.ChangeType(m.Value, typeof(T)));

        return MatchedValues.ToArray<T>();
    } 
```

然后，如果您只想获取数字并将它们返回到 string[] 数组中：

```
string Test = "22$data44abc";
string[] Matches = this.GetMatches<string>(Test, "\\d+"); 
```

希望这对某人有用...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-20T19:11:16.770

除了 PiPeep 所说的之外，如果您尝试匹配表达式中的整数，那么它`1 + 2 - 3`只会匹配`1`, `2`, and `3`, 而不是`1`, `+ 2`and `- 3`，您实际上需要使用lookbehind语句，并且您想要的部分实际上会被返回由`Matcher.group(2)`而不只是`Matcher.group()`。

```
unescaped: ([0-9])?((?(1)(?:[\+-]?\d+)|)(?:[eE][\+-]?\d+)?)
  escaped: ([0-9])?((?(1)(?:[\\+-]?\\d+)|)(?:[eE][\\+-]?\\d+)?) 
```

此外，对于诸如变量名`someNumber - 3`在哪里之类的东西，您可以使用`someNumber`

```
unescaped: (\w)?((?(1)(?:[\+-]?\d+)|)(?:[eE][\+-]?\d+)?)
  escaped: (\\w)?((?(1)(?:[\\+-]?\\d+)|)(?:[eE][\\+-]?\\d+)?) 
```

虽然如果你正在解析一个字符串，当然这不会起作用`The net change to blahblah was +4`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-02T19:24:54.717

java规范实际上给出了一个用于解析双精度的正则表达式怪物。然而，这被认为是不好的做法，只是尝试使用预期的类型进行解析并捕获错误，往往更具可读性。

```
DOUBLE_PATTERN = Pattern
        .compile("[\\x00-\\x20]*[+-]?(NaN|Infinity|((((\\p{Digit}+)(\\.)?((\\p{Digit}+)?)"
                + "([eE][+-]?(\\p{Digit}+))?)|(\\.((\\p{Digit}+))([eE][+-]?(\\p{Digit}+))?)|"
                + "(((0[xX](\\p{XDigit}+)(\\.)?)|(0[xX](\\p{XDigit}+)?(\\.)(\\p{XDigit}+)))"
                + "[pP][+-]?(\\p{Digit}+)))[fFdD]?))[\\x00-\\x20]*"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-12-26T14:53:20.497

使用其中之一：

```
Pattern intsOnly = Pattern.compile("[0-9]+"); 
```

或者

```
Pattern intsOnly = Pattern.compile("\\d+"); 
```

# http - IIS 文件下载挂起/超时 - sc-win32-status = 64

> ID：372149
> 
> 赞同：26
> 
> 时间：2008-12-16T18:06:09.590
> 
> 标签：http, iis, download

根据以下内容，关于尝试通过 HTTP 下载文件时为什么我可能会遇到大量“挂起”的任何想法？

*   服务器是 IIS 6
*   正在下载的文件是二进制文件，而不是网页
*   几个客户端挂起，包括 TrueUpdate 和 FlexNet Web 更新包，以及仅执行基本 HttpWebRequest/HttpWebResponse 逻辑和使用响应流下载的自定义 .NET 应用程序
*   成功时的 IIS 日志文件签名为 200 0 0 (sc-status sc-substatus sc-win32-status)
*   对于失败，错误签名是 200 0 64
*   sc-win32-status of 64 是“指定的网络名不再可用”
*   我可以将 firefox 指向 URL 并每次都成功下载（也许某些重试逻辑正在后台发生）

在这一点上，似乎我的服务器出现了一些奇怪的问题，它抛出了这些错误，或者这只是正常的网络行为，我需要使用（或编写）一个对故障更有弹性的客户端。

有什么想法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-08-14T22:57:37.640

正如您在回复评论中推测的那样，您的问题可能是与 ISP 的低级别网络问题。我遇到了与 IIS 类似的问题，并且日志文件中出现了一些神秘的 200 0 64 行，这就是我找到这篇文章的方式。记录一下，这是我对 sc-win32-status=64; 的理解 如果我错了，我希望有人能纠正我。

*   sc-win32-status 64 表示“指定的网络名称不再可用。”</li>
*   在 IIS 向客户端发送最终响应后，它会等待来自客户端的 ACK 消息。
*   有时客户端会重置连接，而不是将最终的 ACK 发送回服务器。这不是一个正常的连接关闭，因此 IIS 记录“64”代码以指示中断。
*   许多客户端在完成连接后会重置连接，以释放套接字而不是将其留在 TIME_WAIT/CLOSE_WAIT 中。
*   代理人可能比个人客户更倾向于这样做。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-06-22T23:15:26.677

我花了两周时间调查这个问题。对我来说，我遇到过间歇性随机请求被过早终止的情况。这导致 IIS 日志的状态代码为 200，但 win32 状态为 64。

我们的基础架构在 HA 模式下的两个 NetScaler 负载平衡器后面包括两个 Windows IIS 服务器。

在我的特殊情况下，问题在于 NetScaler 启用了一个名为“集成缓存”的功能（[http://support.citrix.com/proddocs/topic/ns-optimization-10-5-map/ns-IC- gen-wrapper-10-con.html](http://support.citrix.com/proddocs/topic/ns-optimization-10-5-map/ns-IC-gen-wrapper-10-con.html)）。

禁用此功能后，请求中断停止。并且网站正常运行。我不确定这如何或为什么会导致问题，但确实如此。

如果您使用代理或负载均衡器，请调查一下它们打开了哪些功能。对我来说，原因是客户端和服务器之间中断了请求。

我希望这个解释至少可以节省别人的时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T23:10:47.420

检查来自服务器的标头，尤其是内容类型和内容长度，您的客户端可能无法识别二进制文件的格式并在等待永远不会到来的字节时挂起，或者他们可能关闭底层 TCP 连接，这可能会导致 IIS 记录 win32 状态 64。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-12-17T10:47:49.373

为此花了三天时间。超时设置为 4 秒（curl php 请求）。解决方案是增加超时设置：

```
//curl_setopt($ch, CURLOPT_TIMEOUT, 4); // times out after 4s
curl_setopt($ch, CURLOPT_TIMEOUT, 60); // times out after 60s 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T20:25:13.380

您将不得不使用有线共享或网络监视器来收集有关此问题的更多数据。我想。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T14:56:47.303

我建议您将[Fiddler](http://www.fiddlertool.com/fiddler/)放在服务器和下载客户端之间。这应该揭示 Firefox 和其他 cient 之间的差异。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-02-01T23:05:42.457

所有 sc-win32-status 代码的说明以供参考
[https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-](https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-)

ERROR_NETNAME_DELETED
64 (0x40)
指定的网络名称不再可用。

# c# - LoginView 中 RoleGroup 中的 FindControl

> ID：372158
> 
> 赞同：0
> 
> 时间：2008-12-16T18:10:29.707
> 
> 标签：c#, asp.net

我似乎无法在登录视图中找到控件。

该aspx是：

```
<asp:LoginView ID="SuperUserLV" runat="server">
    <RoleGroups>
            <asp:RoleGroup Roles="SuperUser">
                    <ContentTemplate>       
                            <asp:CheckBox ID="Active" runat="server" /><br />
                            <asp:CheckBox ID="RequireValidaton" runat="server" />
            </ContentTemplate>
        </asp:RoleGroup>
    </RoleGroups>
</asp:LoginView> 
```

后面的代码是：

```
if (Context.User.IsInRole("SuperUser"))
{
    CheckBox active = (CheckBox) SuperUserLV.FindControl("Active");
    if (active != null)
    {
        active.Checked = this.databaseObject.Active;
    }

    CheckBox require = (CheckBox) SuperUserLV.FindControl("RequireValidaton");
    if (require != null)
    {
        require.Checked = this.databaseObject.RequiresValidation;
    }
} 
```

使用正确角色的用户，我可以看到复选框，但后面的代码没有填充它们，findcontrol 的结果为空。

我错过了什么？谢谢。

**编辑**：看起来我的问题是当我在做`.FindControl`登录视图时没有呈现到屏幕上并且返回空值。将我的代码放在一个按钮上并在页面呈现到屏幕后调用它，它可以按我的预期工作。

**编辑2**：似乎放置代码的最佳位置是`SuperUserLV_ViewChanged`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T18:39:04.173

内置的 FindControl 方法只搜索直接子控件。您需要编写该方法的递归版本来搜索所有后代。以下是一个未经测试的示例，可能需要一些优化：

```
public Control RecursiveFindControl(Control parent, string idToFind)
{
    for each (Control child in parent.ChildControls)
    {
        if (child.ID == idToFind)
        {
            return child;
        }
        else
        {
            Control control = RecursiveFindControl(child, idToFind);
            if (control != null)
            {
                return control;
            }
        }
    }
    return null;
} 
```

# javascript - 您是否需要在 onclick 中指定“javascript:”？

> ID：372159
> 
> 赞同：46
> 
> 时间：2008-12-16T18:11:17.643
> 
> 标签：javascript, google-api

AFAIK，您永远不需要在 onclick 中指定协议：

`onclick="javascript:myFunction()"` **坏的**

`onclick="myFunction()"` **好的**

今天我在[这篇](http://web.archive.org/web/20080428095515/http://www.google.com/support/analytics/bin/answer.py?answer=55527)关于谷歌分析的文章中注意到*他们*正在使用它：

```
<a href="http://www.example.com" onClick="javascript: pageTracker._trackPageview('/outgoing/example.com');"> 
```

这个例子是完全错误的，还是有理由`javascript:`在 a 以外的任何地方指定`href`？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-12-16T18:53:36.157

这里的一些回复声称“javascript:”前缀是“从旧时代遗留下来的”，暗示它是故意的，由浏览器专门处理以实现向后兼容性。是否有确凿的证据表明情况如此（有没有人检查过源代码）？

```
<span onclick="javascript:alert(42)">Test</span> 
```

对我来说，这只是读作：

```
javascript:
    alert(42); 
```

意思是，“javascript:”只是一个标签，没有任何作用。这也有效：

```
<span onclick="foobar:alert(42)">Test</span> 
```

**更新：**

我做了一个小实验，结果证明，是的，“javascript:”是由 IE 专门处理的，但 Firefox、Safari、Opera 或 Chrome 绝对不是这样：

```
<span onclick="javascript:while (true) { alert('once'); break javascript; }">Test</span> 
```

在非 IE 上，这只会提醒“一次”，一次然后跳出循环。在 IE 上，我收到“找不到标签”错误。以下在所有浏览器中都可以正常工作：

```
<span onclick="foo:while (true) { alert('once'); break foo; }">Test</span> 
```

**更新 2：**

我刚刚意识到上面的答案之一中的链接[http://crisp.tweakblogs.net/blog/the-useless-javascript-pseudo-protocol.html](http://crisp.tweakblogs.net/blog/the-useless-javascript-pseudo-protocol.html)几乎谈到了同样的事情。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-16T18:22:06.467

锚上从来不需要它，也不是好的做法。锚点仅用于导航。关于这个主题的一篇文章是*[The useless JavaScript: pseudo-protocol](http://crisp.tweakblogs.net/blog/the-useless-javascript-pseudo-protocol.html)*。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-16T18:22:54.110

一开始，您也可以在 Internet Explorer 中使用[VBScript](http://en.wikipedia.org/wiki/VBScript)而不是 JavaScript，因此指定“javascript: ...”是标准的。

今天，好吧，它并没有什么坏处……将来总会有其他一些想要成为浏览器脚本语言的东西。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-16T18:43:39.950

我一直认为这是不好的用法，因为您可以在带有前缀的[URL中调用 JavaScript：](http://en.wikipedia.org/wiki/Uniform_Resource_Locator)`javascript:`

```
<a href="javascript:void(alert('really bad usage!'))"> 
```

（[网络表单](https://en.wikipedia.org/wiki/ASP.NET#Characteristics)，有人吗？）

只有无知的 Web 开发人员从未意识到事件声明和 href 声明之间的区别才会使用它。

我想说的是，在当今大多数情况下，即使是事件属性也是不好的做法，附加事件的首选方法是使用 .attachEvent （Internet Explorer）和 addEventListener （其余的浏览器，像往常一样）。

最后......谷歌并不总是全能的上帝。他们往往更关心东西是否有效，而不是一直遵循标准。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-16T18:28:16.953

请参阅*[指定脚本语言](http://www.w3.org/TR/html4/interact/scripts.html#h-18.2.2)*（在*HTML 4.01 规范*中的 18.2.2 中，*脚本*）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-16T18:20:25.177

我认为“javascript:”前缀是过去遗留下来的，当时仍然存在一种模糊的可能性，即除了 JavaScript 之外的*任何东西*都可以处理该事件。

今天它是可选的并且出于向后兼容性的原因而保留。但我不会说这很*糟糕*，这只是不必要的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-16T18:22:54.657

在 Internet Explorer 中，可以将页面的默认语言设置为[VBScript](http://en.wikipedia.org/wiki/VBScript)。在早期，人们总是认为另一种语言可以用于在浏览器中编写脚本。事实证明，没有这样的语言以实质形式实现。

我自己并不关心这种语言前缀。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T18:16:58.180

对于您的维护程序员来说，这是一个很好的做法。编译器知道其中的区别，但那个年轻、刚毕业的 Web 开发人员可能不知道。

# scalability - 将图像请求重定向到不同的网络服务器的最佳方法？

> ID：372162
> 
> 赞同：5
> 
> 时间：2008-12-16T18:12:45.723
> 
> 标签：scalability, webserver, firewall, load-balancing, iptables

我试图通过添加“图像服务器”（用于处理图像请求的专用服务器）并将所有对 .gif、.jpg、.png 等的请求重定向到它来减少我的网络服务器上的负载。

我的问题是，处理重定向的最佳方法是什么？

*   在防火墙级别？（我可以使用 iptables 做到这一点吗？）
*   在负载均衡器级别？（ldirectord 能处理这个吗？）
*   在 apache 级别 - 使用重写规则？

感谢您提供有关执行此操作的最佳方法的任何建议。

- 更新 -

我要补充的一件事是，这些域是为第 3 方托管的，因此我不能指望所有开发人员都修改他们的代码并将他们的图像指向另一台服务器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T18:18:52.370

你能做的越远越好。

理想情况下，通过为您的图像使用不同的域（例如 imgs.example.com）在 DNS 级别执行此操作

如果您负担得起，请使用 CDN（内容交付网络）让其他人来做。

-更新-

您可能还想查看 apache 的 mod_rewrite 的 2 个功能。它们在[http://httpd.apache.org/docs/1.3/misc/rewriteguide.html](http://httpd.apache.org/docs/1.3/misc/rewriteguide.html)都有很好的描述。

第一个位于上述文档中的“动态镜像”标题下，它使用了 mod_rewrite 代理标志 [p]。这使您的服务器可以静默地从另一个域中获取文件并返回它们。

第二种是将请求重定向到新域。第二个选项对您的服务器施加的压力较小，但仍然需要进入请求，并且会减慢页面的最终呈现速度，因为每个请求都需要首先向您的服务器发出本质上冗余的请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T18:39:44.343

我同意里克的观点。如果您希望从不同的网络服务器提供图像，请在不同的网络服务器上提供它们。例如：

```
<IMG src="images/Brett.jpg"> 
```

变成

```
<IMG src="http://brettnesbitt.akamia-technologies.com/images/Brett.jpg"> 
```

任何类型的负载均衡器仍会从 Web 服务器的管道中提供图像，这是您要避免的。

* * *

我当然知道你真正想要什么。您真正想要的是任何请求，例如：

```
GET images/Brett.jpg HTTP/1.1 
```

自动转换为：

```
HTTP/1.1 307 Temporary Redirect
Location: http://brettnesbitt.akamia-technologies.com/images/Brett.jpg 
```

这样您就不必做任何工作，除了将图像复制到其他网络服务器。

我真的不知道该怎么做。

* * *

通过使用短语“NAT”，它意味着防火墙/路由器接收 HTTP 请求，如果 HTTP 请求是针对图像文件的，您希望将请求转发到不同的内部服务器。

这就引出了一个问题，即您实际上要保存什么。无论哪个内部 Web 服务器为 HTTP 请求提供服务，数据仍然必须通过防火墙/路由器的管道。

我提出这个问题的原因是，当有人想要从不同的服务器提供图像时，常见的场景是因为他们想要从他们的实际逻辑中分离出高带宽、大部分是静态的、低 CPU 成本的内容。

仅使用 NAT 重写数据包并将其发送到不同的服务器将无法解决该常见问题。

另一个原因可能是因为图像不是系统上的静态内容，并且请求

```
GET images/Brett.jpg HTTP/1.1 
```

实际上是动态构建映像，CPU 成本很高，或者仅使用 ServerB 可用的数据（即 SQL Server 数据库）。

如果是这种情况，那么我仍然会在图像请求上使用不同的服务器名称：

```
GET http://www.brettsoft.com/default.aspx HTTP/1.1
GET http://imageserver.brettsoft.com/images/Brett.jpg HTTP/1.1 
```

* * *

我了解您的*期望*，通过网络数据包检查来覆盖 NAT 规则并将其发送到另一台服务器 - 我从未见过任何可以做到这一点的事情。

这听起来更像是“代理式”，网络代理就是这样做的。（即 pfSense 和 m0n0wall 做不到）

这导致了我们曾经使用过的一种解决方案：一个自定义的 Web 服务器，它分析请求，从某个内部服务器发出适当的请求，然后二进制将响应写入客户端。

一位“安全顾问”坚持认为解决方案中的痛苦，显然他相信[通过默默无闻来确保安全](http://en.wikipedia.org/wiki/Security_through_obscurity)。

我知道 IIS 不能为您自己做这些事情——我不知道其他网络服务器产品。

* * *

我只是四处询问，显然如果您想为基于 linux 的路由器编写一个自定义内核模块，您可以让它检查数据包并采取适当的措施。这样的模块可能存在。显然，还有许多其他开源模块可以用作起点。

但我宁愿朝自己的脑袋开枪。

# delphi - 知道如何解决 BDE 错误 $251e 吗？

> ID：372175
> 
> 赞同：4
> 
> 时间：2008-12-16T18:16:12.813
> 
> 标签：delphi, bde

情况如下：

我们程序的用户在尝试启动应用程序时突然开始收到来自 Borland 数据库引擎 (BDE) 的错误。错误消息说它无法初始化 BDE 并给出错误代码 $251e。用户使用 BDE 5.2.0.2。

我找不到关于错误 $251e 的任何官方文档。我可以在 Google 上获得的唯一有用的信息[并不是很有启发](http://www.mombu.com/microsoft/comp-databases-paradox/t-notes-bde-error-251e-and-other-25xx-codes-576309.html)性，而且那里的建议也没有什么好处。

以下是我们尝试/发现的一些事情：

1.  以完全相同的方式访问 BDE 的其他应用程序没有任何抱怨。
2.  错误发生在我们在 TDatabase 组件上设置 Connected := True 的行上。
3.  重新安装 BDE 没有任何区别。
4.  关闭除有问题的 BDE 应用程序之外的所有 BDE 应用程序没有任何区别。
5.  从使用 MSSQL 数据库更改为 Paradox 数据库没有任何区别。
6.  使登录用户成为工作站上管理员组的成员没有任何区别。
7.  通常登录的用户是域用户。
8.  以最初在机器上设置为最后的管理帐户的工作站管理员（非域）帐户登录，一切正常。
9.  创建具有本地管理员权限的新工作站用户，问题再次出现。

用户暂时被允许使用一个实际工作的工作站管理员帐户，但这不是一个可接受的长期解决方案。知道我们可以从这里去哪里吗？关于 $251e 真正含义的任何线索？

我知道 BDE 已经过时并且不再受支持，但是现在不能选择更改 BDE 的使用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T18:48:18.240

你可能有更好的运气在这里搜索错误..

[http://www.fulltextsearch.com/](http://www.fulltextsearch.com/)

一个常见的罪魁祸首似乎是设备驱动程序冲突。

祝你好运

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T18:51:26.907

我不确定，因为我已经很多年没有使用 BDE，但这里有一些提示和链接：

*   错误可能与 BDE 参数有关（如您链接的文章声称）
*   以下是一些对最佳 BDE 配置有一些建议的网站
    *   [http://www.kennedysoftware.ie/oldapps.htm](http://www.kennedysoftware.ie/oldapps.htm) - 检查 BDE 部分，了解有关 BDE 配置的信息以及有关在 Vista 中使用 BDE 的一些建议
    *   [http://www.thedbcommunity.com/index.php](http://www.thedbcommunity.com/index.php) - 关于 Paradox 和 BDE 的社区站点
    *   [Codegear 质量中心](http://qc.codegear.com/wc/qcmain.aspx?da=1717)的 BDE 问题
    *   搜索新闻组[borland.public.bde](http://groups.google.com/group/borland.public.bde/topics?pli=1) - 有很多关于 #251E 的问题

错误 $251E 表示“可用共享内存不足”

建议的解决方案：

*   将 SharedMemSize 增加到 4096 或 8192
*   将 SharedMemLocation 更改为 0x5BDE。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T15:46:34.083

在使用[www.fulltextsearch.com](http://www.fulltextsearch.com)阅读了数百条有关 251e 的消息后（感谢 KevinRF 的指针），我们列出了大约六种新事物的列表来尝试。

原来用户已经为有问题的程序打开了兼容模式（右键单击 exe 文件，选择属性，兼容性选项卡）。关闭应用程序的兼容模式可解决该错误。

感谢大家的建议！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-16T02:58:35.880

关闭 uac 并将 setup.exe 和 regsvr32.exe 添加到 DEP。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T19:28:28.113

查看 codegear 的网站。前段时间我看到一篇关于此共享内存的内存布局以及解决此类问题的方法的文章。这是一个丑陋的行业，但有一篇很好的文章。对不起，我不能随便找到它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-02T10:49:16.673

哇，我尝试了很多策略来尝试解决这个问题，结果都是一样的。兼容模式。禁用兼容模式，问题就消失了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-22T20:32:38.657

如果您的可执行文件与表（同一目录）一起，请尝试将其放在另一个位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-15T09:41:50.787

您也可以尝试重命名可执行文件名，遇到同样的问题，我知道这听起来很奇怪，但它对我有用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-27T14:24:39.450

看起来路径以某种方式导致了问题。
我通过重命名包含项目文件的文件夹来解决它。

# .net - .NET 2.0+ 中的简单 Active Record 实现

> ID：372176
> 
> 赞同：3
> 
> 时间：2008-12-16T18:16:24.640
> 
> 标签：.net, activerecord

我正在寻找.NET中一个非常简单的活动记录示例（老实说代码示例）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T18:20:09.500

大卫海登解释得很好，我不想重复他的工作：

*   [在 .NET 中使用 Active Record 进行领域驱动设计](http://davidhayden.com/blog/dave/archive/2006/06/21/2995.aspx)

# .net - 如何在 .NET 中读取“驱动器标签”或“卷名”？

> ID：372186
> 
> 赞同：4
> 
> 时间：2008-12-16T18:18:57.690
> 
> 标签：.net, wmi

您能否展示在 .NET 中读取驱动器标签或卷名的示例代码？我觉得这需要 WMI，但我讨厌“下拉”到 WMI，因为它就像下拉到基于字符串的 SQL 查询中，因为某些对象可能不存在于某些版本的操作系统或用户上可能无权查询某些数据。我很高兴确信我对 WMI 的看法是错误的......

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-16T18:23:13.453

不需要 WMI。以下将获取所有卷标：

```
var labels = from drive in DriveInfo.GetDrives()
             select drive.VolumeLabel 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T18:26:47.550

调用 DriveInfo.GetDrives 以获取驱动器信息数组。然后看DriveInfo.VolumeLabel

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T18:49:41.077

您可以使用 System.IO.DriveInfo 来获取驱动器列表。请参见以下示例：

注意：CDRom 驱动器类型没有卷名。

```
Using System.IO;
.
.
.
DriveInfo[] driveInfoList = DriveInfo.GetDrives();
foreach (DriveInfo drive in driveInfoList)
{
    if (drive.DriveType != DriveType.CDRom)
       textBox1.Text += String.Format("Name:{0} Volume:{1}\r\n", drive.Name, drive.VolumeLabel);
    else
       textBox1.Text += String.Format("Name:{0}\r\n", drive.
} 
```

# c++ - C++中进程间通信的最佳方式

> ID：372198
> 
> 赞同：43
> 
> 时间：2008-12-16T18:22:53.470
> 
> 标签：c++, memory, boost, ipc, shared

我有两个进程，一个将查询另一个数据。在有限的时间内（每秒 10000 次）将有大量查询，每秒将传输数据（>100 mb）。数据类型将是整数类型（双,int) 我的问题是用哪种方式连接这个过程？

共享内存、消息队列、lpc（本地过程调用）或其他......

我还想问你推荐哪个图书馆？顺便说一句，请不要建议 MPI。编辑：在 windows xp 32 位下

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-16T18:26:31.857

一个词：[Boost.InterProcess](https://www.boost.org/doc/libs/1_74_0/doc/html/interprocess.html)。如果它真的需要快速，共享内存就是要走的路。您的开销几乎为零，因为操作系统在虚拟地址和物理地址之间进行通常的映射，并且不需要复制数据。您只需要注意并发问题。

对于实际发送*关闭*和*查询*等命令，我会使用消息队列。在我知道 boost 之前，我以前使用 localhost 网络编程来做到这一点，并使用手动共享内存分配。该死的，如果我需要重写应用程序，我会立即选择 boost。Boost.InterProcess 使您更容易做到这一点。看看这个。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T18:56:38.007

我会使用共享内存来存储数据，并使用消息队列来发送查询。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-16T19:05:55.037

我会赞同 Marc 的建议——除非您有可移植性问题或想做一些很酷的事情，例如在共享内存上映射标准容器类型（在这种情况下，我肯定会使用 boost）。

否则，消息队列和共享内存很容易处理。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-07-21T23:59:29.233

如果您的数据包含多种类型和/或您需要诸如互斥锁之类的东西，请使用 Boost。否则，使用#pragma data_seg 或内存映射文件使用内存的共享部分。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-16T19:08:13.940

如果您确实使用共享内存，您将不得不决定是否旋转。我希望，如果您使用信号量进行同步并将数据存储在共享内存中，与使用消息队列（清晰度明显下降）相比，您不会获得太多性能优势，但是如果您使用原子变量进行同步，那么您不得不承受这样的后果。

# javascript - 为什么在 JavaScript 中函数既是构造函数又是对象？

> ID：372202
> 
> 赞同：5
> 
> 时间：2008-12-16T18:23:37.917
> 
> 标签：javascript, object, constructor

我最近对此做了很多研究，但还没有得到一个很好的可靠答案。我在某处读到，当 JavaScript 引擎遇到一个函数语句时，会创建一个新的 Function() 对象，这让我相信它可能是一个对象的子对象（从而成为一个对象）。所以我给 Douglas Crockford 发了邮件，他的回答是：

> 不完全是，因为函数语句不调用编译器。
> 
> 但它会产生类似的结果。

此外，据我所知，您不能在函数构造函数上调用成员，除非它已被实例化为新对象。所以这不起作用：

```
function myFunction(){
    this.myProperty = "Am I an object!";
}
myFunction.myProperty; // myFunction is not a function
myFunction().myProperty; // myFunction has no properties 
```

但是，这将起作用：

```
function myFunction(){
    this.myProperty = "Am I an object!";
}
var myFunctionVar = new myFunction();
myFunctionVar.myProperty; 
```

这只是语义问题吗……在整个编程世界中，对象何时真正成为对象，以及如何映射到 JavaScript？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-16T21:03:55.237

函数和构造函数没有什么神奇之处。JavaScript 中的所有对象都是……嗯，对象。但是有些对象比其他对象更特殊：即内置对象。区别主要在于以下几个方面：

1.  对象的一般处理。例子：
    *   数字和字符串是不可变的（⇒ 常量）。没有定义任何方法来在内部更改它们——结果总是产生新的对象。虽然它们有一些先天方法，但您无法更改它们或添加新方法。任何这样做的尝试都将被忽略。
    *   `null`并且`undefined`是特殊的对象。任何对这些对象使用方法或定义新方法的尝试都会导致异常。
2.  适用的运算符。JavaScript 不允许（重新）定义运算符，所以我们坚持使用可用的。
    *   数字对算术运算符有一种特殊的方式：`+`, `-`, `*`, `/`。
    *   字符串有一种特殊的方式来处理连接运算符：`+`.
    *   函数有一种特殊的方式来处理“调用”操作符:`()`和`new`操作符。后者具有关于如何使用构造函数的`prototype`属性、构造具有与原型的适当内部链接的对象以及调用构造函数对其`this`正确设置的先天知识。

如果您查看 ECMAScript 标准 ( [PDF](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf) )，您会发现所有这些“额外”功能都被定义为方法和属性，但其中许多功能不能直接供程序员使用。其中一些将在标准 ES3.1 的新修订版中公开（截至 2008 年 12 月 15 日的草案：[PDF](http://wiki.ecmascript.org/lib/exe/fetch.php?id=es3.1%3Aes3.1_proposal_working_draft&cache=cache&media=es3.1:tc39-es31-draft15dec08.pdf)）。一个属性 ( `__proto__`)[已在 Firefox 中公开](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Property_Inheritance_Revisited/Determining_Instance_Relationships)。

现在我们可以直接回答您的问题了。是的，函数对象具有属性，我们可以随意添加/删除它们：

```
var fun = function(){/* ... */};
fun.foo = 2;
console.log(fun.foo);  // 2
fun.bar = "Ha!";
console.log(fun.bar);  // Ha! 
```

函数实际上做什么并不重要——它永远不会发挥作用，因为我们没有调用它！现在让我们定义它：

```
fun = function(){ this.life = 42; }; 
```

它本身不是一个构造函数，它是一个在其上下文中运行的函数。我们可以很容易地提供它：

```
var context = {ford: "perfect"};

// now let's call our function on our context
fun.call(context);

// it didn't create new object, it modified the context:
console.log(context.ford);           // perfect
console.log(context.life);           // 42
console.log(context instanceof fun); // false 
```

如您所见，它向现有对象添加了一个属性。

为了将我们的函数用作构造函数，我们必须使用`new`运算符：

```
var baz = new fun();

// new empty object was created, and fun() was executed on it:
console.log(baz.life);           // 42
console.log(baz instanceof fun); // true 
```

正如你所看到`new`的，我们的函数是一个构造函数。以下行动由`new`：

1.  创建了新的空对象 ( `{}`)。
2.  它的内部原型属性设置为`fun.prototype`. 在我们的例子中，它将是一个空对象 ( `{}`)，因为我们没有以任何方式修改它。
3.  `fun()`以这个新对象作为上下文调用。

修改新对象由我们的函数决定。通常它设置对象的属性，但它可以做任何它喜欢的事情。

有趣的琐事：

*   因为构造函数只是一个对象，我们可以计算它：

    ```
    var A = function(val){ this.a = val; };
    var B = function(val){ this.b = val; };
    var C = function(flag){ return flag ? A : B; };

    // now let's create an object:
    var x = new (C(true))(42);

    // what kind of object is that?
    console.log(x instanceof C); // false
    console.log(x instanceof B); // false
    console.log(x instanceof A); // true
    // it is of A

    // let's inspect it
    console.log(x.a); // 42
    console.log(x.b); // undefined

    // now let's create another object:
    var y = new (C(false))(33);

    // what kind of object is that?
    console.log(y instanceof C); // false
    console.log(y instanceof B); // true
    console.log(y instanceof A); // false
    // it is of B

    // let's inspect it
    console.log(y.a); // undefined
    console.log(y.b); // 33

    // cool, heh? 
    ```

*   构造函数可以返回一个覆盖新创建对象的值：

    ```
    var A = function(flag){
      if(flag){
        // let's return something completely different
        return {ford: "perfect"};
      }
      // let's modify the object
      this.life = 42;
    };

    // now let's create two objects:
    var x = new A(false);
    var y = new A(true);

    // let's inspect x
    console.log(x instanceof A); // true
    console.log(x.ford);         // undefined
    console.log(x.life);         // 42

    // let's inspect y
    console.log(y instanceof A); // false
    console.log(y.ford);         // perfect
    console.log(y.life);         // undefined 
    ```

    正如你所看到`x`的`A`，原型和所有的`y`都是我们从构造函数返回的“裸”对象。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-16T18:47:58.070

你的理解是错误的：

```
myFunction().myProperty; // myFunction has no properties 
```

它不起作用的原因是因为“.myProperty”应用于“myFunction()”的返回值，而不是对象“myFunction”。以机智：

```
$ js
js> function a() { this.b=1;return {b: 2};}
js> a().b
2
js> 
```

请记住，“()”是一个运算符。“myFunction”与“myFunction()”不同。使用 new 实例化时不需要“返回”：

```
js> function a() { this.b=1;}
js> d = new a();
[object Object]
js> d.b;
1 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-16T18:41:14.573

为了回答您的具体问题，技术上的功能始终是对象。

例如，您总是可以这样做：

```
function foo(){
  return 0;
}
foo.bar = 1;
alert(foo.bar); // shows "1" 
```

`this`Javascript 函数在使用指针时的行为有点像其他 OOP 语言中的类。它们可以用 new 关键字*实例化为对象：*

```
function Foo(){
  this.bar = 1;
}
var foo = new Foo();
alert(foo.bar); // shows "1" 
```

现在这种从其他 OOP 语言到 Javascript 的映射将很快失败。例如，实际上 Javascript 中没有类之类的东西——对象使用原型链来代替继承。

如果你打算用 Javascript 进行任何类型的重要编程，我强烈推荐[Javascript: The Good Parts](http://oreilly.com/catalog/9780596517748/) by Crockford，你发邮件的那个人。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-16T18:37:46.437

Javascript 的“全局”范围（至少在浏览器中）是`window`对象。

这意味着当您这样做`this.myProperty = "foo"`并以普通方式调用该函数时，`myFunction()`您实际上是在设置`window.myProperty = "foo"`

第二点`myFunction().myProperty`是，在这里您正在查看 的*返回值*，`myFunction()`因此自然不会有任何属性，因为它返回 null。

你在想的是这样的：

```
function myFunction()
{
    myFunction.myProperty = "foo";
}

myFunction();
alert(myFunction.myProperty); // Alerts foo as expected 
```

这（几乎）与

```
var myFunction = new Function('myFunction.myProperty = "foo";');
myFunction(); 
```

当您在`new`上下文中使用它时，“返回值”是您的新对象，“this”指针更改为您的新对象，因此它可以按预期工作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-16T19:35:38.130

事实上，函数是“一等公民”：它们是一个对象。

每个对象都有一个Prototype，但只能直接引用一个函数的原型。当`new`以函数对象作为参数调用时，以函数对象的原型为原型构造一个新对象，并`this`在输入函数之前将其设置为新对象。

因此，您*可以*将每个函数称为构造函数，即使它不理会`this`。

那里有关于构造函数、原型等的非常好的教程……我个人从[JavaScript 中的面向对象编程](http://mckoss.com/jscript/object.htm)中学到了很多东西。它显示了“继承”其原型但用于`this`填充新对象属性的函数和使用特定原型的函数对象的等价性：

```
function newA() { this.prop1 = "one"; } // constructs a function object called newA
function newA_Too() {} // constructs a function object called newA_Too
newA_Too.prototype.prop1 = "one";

var A1 = new newA();
var A2 = new newA_Too();
// here A1 equals A2. 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-16T18:41:45.150

首先，JavaScript 对对象的行为方式与 C++/Java 不同，因此您需要抛开这些想法，才能理解 javascript 的工作原理。

当此行执行时：

```
var myFunctionVar = new myFunction(); 
```

然后`this`inside`myFunction()`指的是您正在创建的这个新对象 - `myFunctionVar`。因此这行代码：

```
 this.myProperty = "Am I an object!"; 
```

基本上有以下结果

```
 myFunctionVar.myProperty = "Am I an object!"; 
```

它可能会帮助您查看有关[`new`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/new_Operator)操作员的一些文档。在 JS 中，`new`操作符本质上允许你从一个函数中创建一个对象——任何普通的旧函数。与将其标记为构造函数的运算符一起使用的函数没有什么特别之处`new`，就像在 C++ 或 Java 中一样。正如文档所说：

> 创建用户定义的对象类型需要两个步骤：
> 
> 1.  通过编写函数来定义对象类型。
> 2.  使用 new 创建对象的实例。

所以你对代码做了什么

```
function myFunction(){
    this.myProperty = "Am I an object!";
} 
```

是创建一个可用作构造函数的函数。代码失败的原因`myFunction.myProperty`是没有*引用*named `myFunction`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T18:40:09.800

JavaScript 基于 ECMA 脚本。它的规范使用原型模型使其成为 OOP。然而，ECMA 脚本并不强制执行严格的数据类型。需要实例化对象的原因与 ECMA 脚本需要“新”调用的原因相同，该调用将为属性分配内存，否则它将保持为函数，您可以根据需要调用它，在这种情况下，属性将初始化然后在函数结束时被销毁。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T19:00:35.003

只有当您使用 new 关键字进行实例化时，该函数才会充当构造函数。

结果是一个可以使用“this”关键字访问成员属性的对象。当函数以任何其他方式使用时，方法中的 this 关键字没有任何意义。

# sql - 使用 CGI 的模板架构

> ID：372203
> 
> 赞同：0
> 
> 时间：2008-12-16T18:23:49.693
> 
> 标签：sql, html, cgi

我有一个需要显示 sqlite 数据库的网页。现在我正在通过 CGI 动态创建整个页面。但是，我宁愿拥有一个 html 文件，并在文件中使用数据库内容填充一个表。最好的方法是什么？我仅限于 C 语言中的 html、javascript 和 CGI​​。

非常感谢任何帮助。

谢谢！汤姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T18:49:16.820

If your content is updated once a day (or hour, etc) then you could schedule the C code as a standalone application via cron to run. It reads in a "header" html template file, generated the table from the database, then copies the "footer" html template file. This generated file gets copied to the web server location you want it, then the webserver can simply serve the HTML file.

If you have no cron, you could move the C into a CGI C code that you can call manually via a "hidden" URL that generates the HTML file in the same way.

If the table updates all the time, then just do the above but return the data to the user rather than creating a file to serve statically.

I assume you don't have access to server-side includes of any sort (embedded web server?).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T18:52:39.777

How much of this do you have working? Do you have your sqlite connection working in your C code? Writing a plain CGI app isn't difficult, just output your headers, especially Content-Type and preferably Content-Length(if you know it), and then just output the page.

As for a templating system, you can write html files and replace certain tags with the dynamic content. Take a look at some templating systems like Smarty for some inspiration perhaps.

# .net - 从 VSTO 的角度来看 Excel 2003 和 2007 之间的差异

> ID：372217
> 
> 赞同：0
> 
> 时间：2008-12-16T18:31:54.733
> 
> 标签：.net, excel, vsto

在为 excel 2003/2007 开发插件或文档级自定义时需要注意哪些主要区别？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-05T19:07:27.987

几个项目：

VSTO 2SE - 可用于 Excel 2003 和 Excel 2007 插件。（安装时需要代码访问安全性）

VSTO 3 - 只能用于 Excel 2007 加载项。（不需要代码访问安全性）

Excel 2003 - 可以为所有用户或每个用户安装加载项。

Excel 2007 - 只能按/用户安装加载项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-27T21:41:45.280

供参考。上面提到的博客文章在文档级自定义方面并不准确。也许在当时是这样，但它不再准确。

Excel 2007 文档级自定义在 Visual Studio 2008 中完全受支持，但它们使用 Visual Studio Tools For Office 2007（又名 VSTO 3.0）。

# xcode - 在 Xcode 中插入 Subversion 修订号

> ID：372218
> 
> 赞同：25
> 
> 时间：2008-12-16T18:31:56.683
> 
> 标签：xcode, svn

我想将当前的 Subversion 修订号（由 报告`svnversion`）插入到我的 Xcode 项目中。我设法将修订号插入到`Info.plist`中`$PROJECT_DIR`，但这不是一个好的解决方案，因为文件是版本化的。我试图将修订版插入到`Info.plist`构建目录中，但是在代码签名阶段出现错误（这是一个 iPhone 应用程序）。

有没有一种简单的方法可以使用一些构建文件将修订号输入应用程序，以便更改的修订不会更改版本化文件？我想也许我可以创建一个临时源文件，该文件将与其他文件链接并提供获取修订号的功能。但我不知道该怎么做。

我对其他解决方案不太感兴趣，即。`agvtool`. _ 我想要的只是应用程序可用的修订号，没有太多魔法。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-06-30T05:38:36.337

有一个更简单的解决方案：使用Leopard中包含的[**PlistBuddy**](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man8/PlistBuddy.8.html)`/usr/libexec/PlistBuddy`。有关详细信息，请参阅[我对相关 SO 问题的回答](https://stackoverflow.com/questions/877128/#1061864)。

PlistBuddy 可用于 Xcode 中的运行脚本构建阶段，并且可用于仅影响已处理的 plist 文件。只需将它放在复制资源阶段之后，您甚至不必每次都清理目标以使其运行。您甚至不必将值打印到头文件并让 SVN 忽略它。

```
echo -n ${TARGET_BUILD_DIR}/${INFOPLIST_PATH} \
    | xargs -0 /usr/libexec/PlistBuddy -c "Set :CFBundleVersion `svnversion -n`" 
```

假设您在代码签名发生之前添加了构建阶段，您的 plist 应该使用替换值进行签名。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-05T22:50:35.727

对于后人，我为 iPhone 应用程序做了类似于 zoul 的事情，通过在我的项目中添加一个 revision.h，然后添加以下内容作为运行脚本构建阶段：

```
REV=`/usr/bin/svnversion -nc ${PROJECT_DIR} | /usr/bin/sed -e 's/^[^:]*://;s/[A-Za-z]//'`
echo "#define kRevisionNumber @\"$REV\"" > ${PROJECT_DIR}/revision.h 
```

我这样做是为了获取一个简单的修订号，而不是 svnversion 在 zoul 的解决方案中生成的更详细的字符串。

对于 Mac 应用程序，我的方法基于[这篇文章](http://www.latenightcode.com/devblog/automated-build-numbering-in-xcode/)，而是创建了一个 buildnumber.xcconfig 文件。在目标的构建设置下，我将对话框右下角的 Based On 值更改为 buildnumber.xcconfig。在 Info.plist 中，我编辑了以下几行：

```
<key>CFBundleVersion</key>
<string>${BUILD_NUMBER}</string>
<key>CFBundleShortVersionString</key>
<string>Version 1.0</string> 
```

这样我的 About 对话框将显示类似于 Version 1.0 (1234) 的版本字符串，其中 1234 是 Subversion 修订号。最后，我使用以下代码创建了一个运行脚本构建阶段：

```
REV=`/usr/bin/svnversion -nc ${PROJECT_DIR} | /usr/bin/sed -e 's/^[^:]*://;s/[A-Za-z]//'`
echo "BUILD_NUMBER = $REV" > ${PROJECT_DIR}/buildnumber.xcconfig 
```

这可能不是最干净的方式，因为它需要一个干净的周期，然后才能构建新版本以在应用程序中占据一席之地，但它确实有效。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-12-07T22:16:54.807

作为 Stack Overflow 的新用户，我无法对 Quinn 的帖子发表评论，但如果您使用的是同时进行多个项目的 SVN 存储库，我有一个小改动可以使他的解决方案更加准确。

使用他的方法，返回的 svnversion 号是整个存储库的最后一次签入，不一定是您的代码库。此调整允许更新特定于您的代码库。

```
REV=`svnversion -nc | /usr/bin/sed -e 's/^[^:]*://;s/[A-Za-z]//'`
/usr/libexec/PlistBuddy -c "Set :CFBundleVersion $REV" "${TARGET_BUILD_DIR}"/${INFOPLIST_PATH} 
```

使用 -c 标志将以 : 的形式收集在活动分支/标记/主干中为您的代码库完成的最后一次提交，然后将您不想存储为修订号的位切掉。

另外，请注意 ${TARGET_BUILD_DIR} 周围的双引号。对于决定将项目放置在名称中带有空格的目录结构中的用户来说，这些是必需的。

希望这对其他人有帮助！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-01-13T00:35:36.953

我在尝试为我的 iPhone 应用程序做类似的事情时发现了这个页面，并认为分享我决定的代码可能会有所帮助。我试图在我的目标信息中设置一个基本版本号（例如 0.9.5），然后在它的末尾附加我的 SVN 修订号。我需要将其存储在 CFBundleVersion 中，以便 AdHoc 用户能够通过 iTunes 进行更新，即使我不记得在我的目标信息窗格中修改版本号。这就是为什么我不能使用“revision.h”方法，否则它工作得很好。这是我在“复制捆绑资源”构建阶段之后作为运行脚本阶段放置的最终代码：

```
BASEVERNUM=`/usr/libexec/PlistBuddy -c "Print :CFBundleVersion" "${INFOPLIST_FILE}" | sed 's/,/, /g'`
REV=`svnversion -n`
SVNDATE=`LC_ALL=C svn info | awk '/^Last Changed Date:/ {print $4,$5}'`
/usr/libexec/PlistBuddy -c "Set :CFBundleVersion $BASEVERNUM.$REV" "${TARGET_BUILD_DIR}"/${INFOPLIST_PATH}
/usr/libexec/PlistBuddy -c "Set :BuildDateString $SVNDATE" "${TARGET_BUILD_DIR}"/${INFOPLIST_PATH} 
```

它应该将 svnversion 的结果附加到基本 Info.plist 中设置为版本的任何内容的末尾。这样，您可以在 info plist 中包含类似 0.9.5 的内容，并且在末尾附加 .189 修订号，最终版本号为 0.9.5.189

希望这对其他人有帮助！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-31T11:21:22.890

```
# Xcode auto-versioning script for Subversion
# by Axel Andersson, modified by Daniel Jalkut to add
# "--revision HEAD" to the svn info line, which allows
# the latest revision to always be used.
#
# modified by JM Marino to change only [BUILD] motif
# into CFBundleGetInfoString key.
#
# HOW TO USE IT: just add [BUILD] motif to your Info.plist key :
#       CFBundleVersion
#
# EXAMPLE: version 1.3.0 copyright 2003-2009 by JM Marino
# with [BUILD] into CFBundleVersion key

use strict;

die "$0: Must be run from Xcode" unless $ENV{"BUILT_PRODUCTS_DIR"};

# Get the current subversion revision number and use it to set the CFBundleVersion value
#my $REV = `/usr/local/bin/svnversion -n ./`;
my $REV = `/usr/bin/svnversion -n ./`;
my $INFO = "$ENV{BUILT_PRODUCTS_DIR}/$ENV{WRAPPER_NAME}/Contents/Info.plist";

my $version = $REV;

# (Match the last group of digits without optional letter M | S):
($version =~ m/(\d+)[MS]*$/) && ($version = "" . $1);

die "$0: No Subversion revision found" unless $version;

open(FH, "$INFO") or die "$0: $INFO: $!";
my $info = join("", <FH>);
close(FH);

#$info =~ s/([\t ]+<key>CFBundleVersion<\/key>\n[\t ]+<string>.+)\[BUILD\](<\/string>)/$1$version$2/;
$info =~ s/([\t ]+<key>CFBundleVersion<\/key>\n[\t ]+<string>)\[BUILD\](<\/string>)/$1$version$2/;

open(FH, ">$INFO") or die "$0: $INFO: $!";
print FH $info;
close(FH); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-12-20T13:48:47.693

由于我无法评论奎因的回答：

如果您使用的是 MacPorts svn 客户端，则可能需要包含 svnversion 命令的完整路径，在我的例子中是 /opt/local/bin/svnversion。我还在 svnversion 中添加了 -c 选项。

此外，如果您只对混合修订的第二个版本号感兴趣，请在调用中添加一个“剪切”命令，如下所示：

```
echo -n "${TARGET_BUILD_DIR}/${INFOPLIST_PATH}" \
| xargs -0 /usr/libexec/PlistBuddy -c "Set :CFBundleVersion `/opt/local/bin/svnversion -nc | cut -f2 -d:`" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-14T10:31:14.047

另一个版本，用 Apple 脚本编写。previousValue 的正则表达式可以更改，目前它仅支持 XX.XX.XX 格式的版本（主要、次要、svn rev）。

由......运营`/usr/bin/osascript`

```
set myVersion to do shell script "svn info | grep \"^Revision:\""
set myVersion to do shell script "echo " & quoted form of myVersion & "| sed 's/Revision: \\([0-9]\\)/\\1/'" as string

set myFile to do shell script "echo ${BUILT_PRODUCTS_DIR}/${WRAPPER_NAME}/"
set theOutputFolder to myFile as string
set thePListPath to POSIX path of (theOutputFolder & "Info.plist")
tell application "System Events"
   tell property list file thePListPath
      tell contents
         set previousValue to value of property list item "CFBundleVersion"

         set previousValue to do shell script "echo " & quoted form of previousValue & "| sed 's/\\([0-9]*\\.[0-9]*\\)\\(\\.[0-9]*\\)*/\\1/'" as string

         set value of property list item "CFBundleVersion" to (previousValue & "." & myVersion)
      end tell
   end tell
end tell 
```

# .net - .NET 处理生成问题

> ID：372220
> 
> 赞同：6
> 
> 时间：2008-12-16T18:34:18.580
> 
> 标签：.net, process, accurev

我有一个可以从命令提示符立即运行的可执行文件，但在使用 System.Diagnostics.Process 生成时似乎不会返回：

基本上，我正在围绕 Accurev CLI 接口编写一个 .NET 库包装器，因此每个方法调用都会产生 CLI 进程以执行命令。

这适用于除一个命令之外的所有命令：

```
 accurev.exe show depots 
```

但是，当从控制台运行它时，它运行良好，当我使用 .net 进程调用它时，它挂起......我使用的进程生成代码是：

```
 public static string ExecuteCommand(string command)
    {

        Process p = createProcess(command);

        p.Start();            
        p.WaitForExit();

        // Accurev writes to the error stream if ExitCode is non zero.
        if (p.ExitCode != 0)
        {
            string error = p.StandardError.ReadToEnd();
            Log.Write(command + " failed..." + error);
            throw new AccurevException(error);                 
        }
        else
        {
            return p.StandardOutput.ReadToEnd();
        }

    }

    /// Creates Accurev Process 
    /// </summary>
    /// <param name="command"></param>
    /// <returns></returns>
    private static Process createProcess(string command)
    {
        Log.Write("Executing Command: " + command);

        ProcessStartInfo startInfo = new ProcessStartInfo();
        Process p = new Process();

        startInfo.CreateNoWindow = false;
        startInfo.RedirectStandardOutput = true;
        startInfo.RedirectStandardInput = true;
        startInfo.RedirectStandardError = true;

        startInfo.UseShellExecute = false;
        startInfo.Arguments = command;
        startInfo.FileName = _accurev;

        p.StartInfo = startInfo;

        return p;
    } 
```

它挂在 p.WaitForExit() 处。

有什么建议吗？

**编辑**：解决了！

如果输出缓冲区溢出，.NET 进程会挂起，我切换到使用异步读取方法并且一切正常：

```
 public static string ExecuteCommand(string command)
    {
        StringBuilder outputData = new StringBuilder();

        Process p = createProcess(command);

        p.OutputDataReceived += delegate(object sender, DataReceivedEventArgs e)
        {
            outputData.AppendLine(e.Data);
        };

        p.Start();
        p.BeginOutputReadLine();

        p.WaitForExit();

        // Accurev writes to the error stream if ExitCode is non zero.
        if (p.ExitCode != 0)
        {
            string error = p.StandardError.ReadToEnd();
            Log.Write(command + " failed..." + error);
            throw new AccurevException(error);                 
        }
        else
        {
            return outputData.ToString();
        }

    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T18:58:05.133

It is seeking for input? In particular, I notice that you are redirecting stdin, but not closing it - so if it is reading from stdin it will hang.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T18:44:12.010

WaitForExit() 执行时，生成的进程是否仍然存在？你能附加一个调试器吗？

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-12-16T19:01:32.550

try replacing the WaitForExit() with something like this:

```
while (!p.WaitForExit(100))
    Console.Write("."); 
```

The other thing to try is setting UseShellExecute to true, and watching the console window be spawned. See this page for the intricacies of that parameter: [http://blogs.msdn.com/jmstall/archive/2006/09/28/CreateNoWindow.aspx](http://blogs.msdn.com/jmstall/archive/2006/09/28/CreateNoWindow.aspx)

# html - 关于宽度和填充的 div/CSS 问题

> ID：372224
> 
> 赞同：2
> 
> 时间：2008-12-16T18:35:54.537
> 
> 标签：html, css

我在使用这段代码时遇到了一些问题：

CSS：

```
div#header
{
    width: 100%;
    background-color: #252525;
    padding: 10px 0px 10px 15px;
    position: relative;
}

div#login
{
    float: right;
    position: absolute;
    right: 10px;
    top: 5px;
} 
```

HTML：

```
<div id="header">
    <img src="./img/logo.jpg" />
    <div id="login">
        <form id="header-login" action="#">
            <input type="text" /> <input type="text" /> <input type="submit" value="LOGIN" />
        </form>
    </div>
</div> 
```

div id=header 标签的左边距为 15px。正因为如此，div 本身拉伸了页面的宽度，再加上向右额外的 15px，导致我有一个水平滚动条。我尝试将标题 div 放在具有相对定位的容器 div 中，但填充导致标题 div 仅在容器上方溢出 15px，仍然让我留下侧边栏。有人可以帮助我更好地理解吗？谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T18:47:23.437

尝试删除标题的 100% 宽度。由于 div 是线元素，因此不需要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T18:51:10.607

试试这个 div 标题。

```
div#header { width: 100%; height:15px; background-color: #252525; padding: 10px 0px 10px; position: relative; } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T18:52:07.220

我不太确定您要完成什么：但这是一个开胃菜：

块元素（例如 div）总是扩展到容器的宽度，除非您在 IE 中使用 quirks 模式。

在同一个元素上使用绝对位置和正确浮动是没有意义的。使用边距获得适当的距离。浮动元素确实需要一些尺寸，例如宽度。

如果要将浮动元素置于“顶部”，则需要首先在其父元素中指定它。意思是，将 div 放在 img 之前。

```
div#header {
   背景颜色：#252525；
   填充：10px 0px 10px 15px；
}

div#登录{
   宽度：100px；/* 在这里使用首选大小。*/
   浮动：对；
   右边距：10px；
   边距顶部：5px；
}

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T18:42:51.560

适当大小的容器 div 上的“溢出：隐藏”会起作用吗？

# c# - 简化在大型可视监视器上为团队显示构建状态的软件？

> ID：372227
> 
> 赞同：2
> 
> 时间：2008-12-16T18:36:44.737
> 
> 标签：c#, asp.net, rss

年底时我还有一点预算，我想开始一个小小的臭鼬工程项目，以显示每个人都在做什么的构建状态（我们的团队大约有 10 个人）。我正在考虑购买一台 47 英寸 LCD 高清电视，并通过浏览器/.NET Web 应用程序从小型 PC 驱动它。

由于我们从本周五开始关闭 2 周，因此我打算在圣诞节假期期间构建软件。我想我会就其他团队所做的事情征求建议/反馈。我们使用 SVN 的很多工具，Mantis 都有我想渲染的 RSS 提要。这是要走的路吗？

感谢您提前提供任何反馈。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T18:50:33.773

它真的会以任何方式使您的团队受益吗？
我宁愿带上曲棍球机之类的东西，让午餐时间更有趣。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T19:36:46.410

我的一个朋友正在自学如何与 Arduino 合作，这样他就可以在明年为 Burning Man 制作一个计算机控制的 LED 雕塑。他的第一个项目？使用 Arduino 控制红色和绿色 LED 的小阵列，以便团队中的每个人都可以查看它，看看构建是否损坏以及是谁损坏了它。

但实际上，除非您有兴趣走这条路，否则在您的情况下，我会编写一个简单的 WinForms 应用程序，该应用程序使用 FileSystemWatcher 检查 RSS 文件中的更改，使用 XSLT 转换将其转换为 HTML，以及WebBrowser 来显示它。如果您了解 XSLT 并了解您的 RSS 提要的内容，那大约需要 2-3 小时的工作时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-18T00:43:37.757

我会先检查现有的解决方案。[在http://www.build-doctor.com/2009/08/18/big-visible-continuous-integration/](http://www.build-doctor.com/2009/08/18/big-visible-continuous-integration/)和[http://www.lostechies.com/blogs/joshuaflanagan/archive/2009](http://www.lostechies.com/blogs/joshuaflanagan/archive/2009/08/28/big-visible-teamcity.aspx)有一个很好的总结[/08/28/big-visible-teamcity.aspx](http://www.lostechies.com/blogs/joshuaflanagan/archive/2009/08/28/big-visible-teamcity.aspx)看起来很有趣。

这完全取决于您拥有的持续集成服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T18:52:07.373

我会说坚持使用RSS。久经考验且真正易于使用，尤其是在 .NET 环境中。

# sql-server - 优雅替换只读 SQL Server 数据库的最佳实践

> ID：372230
> 
> 赞同：1
> 
> 时间：2008-12-16T18:38:11.757
> 
> 标签：sql-server, database-restore

我有一个只读数据库，其中包含用于在网站上显示页面的缓存信息。有一些进程运行以生成数据库，而这些进程在不同的服务器上运行。当我需要更新实时数据库时，我会将这个数据库恢复到实时服务器，恢复到一个新的名称和文件。然后我删除实时数据库并将其重命名为原始名称。目前我使用存储过程来执行此操作，该过程通过“sp_who”和“kill”终止所有连接，然后是 drop database 命令，然后是“sp_renamedb”。现在，当我终止所有连接时，它会在网站上为当前访问这些页面的人和爬虫引发错误，是否有更好的方法来执行此过程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T19:07:18.250

您可能想要做的是使用以下命令使实时数据库脱机：

```
ALTER DATABASE name SET OFFLINE 
```

[你可以在这里](http://www.blackwasp.co.uk/SQLOffline.aspx)阅读更多，但它说：

> 上述命令尝试立即使命名数据库脱机。如果用户或后台进程当前连接到数据库，则无法完成该命令。在这种情况下，ALTER DATABASE 语句将被阻塞并等待所有连接关闭。这可确保不会意外回滚任何事务。在阻塞期间，不允许新的数据库连接。

数据库脱机后，您应该能够安全地进行还原/重命名操作，并在完成后将其重新联机。当数据库处于脱机状态时，您可能需要进行一些操作以查看允许的内容。

如果您在离线时无法进行恢复/重命名，您需要在单用户模式下将其恢复在线。

在这种情况下，连接池或其他长时间运行的连接可能会导致问题。您可能希望设置一个脚本以在发出 ALTER DATABASE SET OFFLINE 命令后等待一段时间（例如 15 分钟），如果数据库仍未脱机，您可以使用 WITH NO_WAIT 重新发出该命令强制它离线的选项。

如果这对您来说功能不够强大，您还可以正常关闭 SQL Server……这也将等到服务器中的所有工作完成后再停止。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T19:42:29.347

设置事务复制，将数据生成服务器作为发布者，将实时服务器作为订阅者。客户端连接不会注意到任何事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T19:19:00.473

为 Mike Sharek +1 - 我喜欢你的解决方案，它非常整洁，可以防止用户突然断开连接（而且非常粗鲁）。

另一种选择，如果您不想坐等用户注销数小时。您可以通过您构建到站点中的 AJAX 机制向连接的客户端发送警报，该机制基本上处于“打开”状态，并在超时并重新连接之前等待来自服务器的通知一段时间，因此基本上 XmlHttpObject 始终在等待响应. 在收到响应时，它会在屏幕上显示它，然后打开另一个连接。然后，您将拥有一个管理员界面，该界面将消息推送到等待的 AJAX 组件。

这将允许您以与 Microsoft 的 Outlook Mobile Access 工作方式类似的方式近似实时地发送消息，允许用户在 10 分钟内收到通知，该站点将停止维护。

我不确定是否有任何预构建的组件可以做到这一点，但我确信实现起来不会太难。

它并不能直接帮助您，但是对于您网站的未来版本值得考虑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T19:33:41.457

如果您想为您的用户做一些真正无缝的事情。我会做这样的事情。

当您复制数据库的新版本时，给它一个新名称，可能以日期时间命名，具体取决于您更新它的频率。一旦它在那里，告诉您的 Web 应用程序开始使用新数据库。这可以通过更改 web.config 中的连接字符串或使其成为配置数据库来完成。

过了一定时间后，根据您站点的使用特性删除旧数据库。

# sql - 在 SQL Server 2000 中对 OR 强制使用 UNION 以进行优化

> ID：372246
> 
> 赞同：2
> 
> 时间：2008-12-16T18:41:45.757
> 
> 标签：sql, tsql, optimization, sql-server-2000, union

如何在编译期间使用 WHERE 子句中的 OR 将自身拆分为两个带有 UNION 的查询的查询？如果我手动重写它，使用 UNION 的查询比单个查询快 100 倍，因为它可以有效地在联合的每个查询中使用不同的索引。有什么办法可以让优化器使用这种方法？

我有一个看起来像这样的查询：

```
select columnlist
from table1
join table2 on joincond2
join table3 on joincond3
where conditions1 
    and ((@param1 is null and cond3a) or (cond3b)) 
```

其中 columnlist、joincond2、joincond3 和 conditions1 都是较长的表达式。更重要的是，OR 中只有一个条件永远为真。

我一开始以为我可以重写它来做联合，但后来我重复了 columnlist、joincond2、joincond3 和 conditions1，这是 20 行左右的 SQL，将来可能需要大量维护。有没有我可以提供的提示或更好的方法来编写 WHERE 子句？提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T19:18:24.093

你可以分组

```
select columnlist
from table1
join table2 on joincond2
join table3 on joincond3 
```

进入一个视图，然后使用union。

但是如果可以迁移到sql2005/8，可以使用公用表表达式。

```
with cte ( columnlist )
as (
    select columnlist
    from table1
    join table2 on joincond2
    join table3 on joincond3 )
select columnlist from cte where ...
union
select columnlist from cte where ... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T19:33:22.317

尝试将 OPTION (RECOMPILE) 添加到查询中。如果它在存储过程中，那么也将 WITH RECOMPILE 添加到其中。可能是您第一次运行查询时 SQL Server 提出了一个计划并将其缓存，但第二次通过它仍然使用旧的（现在很差）查询计划。

您将受到轻微影响，因为每次使用查询时都需要重新编译，但与使用糟糕的计划相比，这将是微不足道的。

编辑：我读过在 SQL 2000 的存储过程中使用 WITH RECOMPILE 并不总是能正常工作。据说该错误已在 SQL 2005 中修复。不过，我个人从未遇到过该错误，所以我不知道具体的处理方式是什么。试试看吧。

# java - 泛型、数组和 ClassCastException

> ID：372250
> 
> 赞同：16
> 
> 时间：2008-12-16T18:42:50.840
> 
> 标签：java, arrays, generics, classcastexception

我认为这里一定有一些我不知道的微妙之处。考虑以下：

```
public class Foo<T> {
  private T[] a = (T[]) new Object[5];

  public Foo() {
    // Add some elements to a
  }

  public T[] getA() {
    return a;
  }
} 
```

假设您的 main 方法包含以下内容：

```
Foo<Double> f = new Foo<Double>();
Double[] d = f.getA(); 
```

您将收到一条无法强制转换为`CastClassException`的消息。`java.lang.Object``java.lang.Double`

谁能告诉我为什么？我的理解`ClassCastException`是，当您尝试将对象强制转换为无法强制转换的类型时，它会被抛出。也就是说，对于它不是实例的子类（引用文档）。例如：

```
Object o = new Double(3.);
Double d = (Double) o; // Working cast
String s = (String) o; // ClassCastException 
```

看来我可以做到这一点。如果`a`只是 a`T`而不是 array `T[]`，我们可以`a`毫无问题地获取和转换它。为什么数组会破坏这个？

谢谢。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-16T18:46:18.417

```
Foo<Double> f = new Foo<Double>(); 
```

当您使用此版本的泛型类 Foo 时，对于成员变量`a`，编译器基本上采用以下代码：

```
private T[] a = (T[]) new Object[5]; 
```

并替换`T`为`Double`：

```
private Double[] a = (Double[]) new Object[5]; 
```

您不能从 Object 转换为 Double，因此 ClassCastException。

**更新和澄清：**实际上，在运行一些测试代码之后，ClassCastException 比这更微妙。例如，这个 main 方法可以正常工作，没有任何异常：

```
public static void main(String[] args) {
    Foo<Double> f = new Foo<Double>();
    System.out.println(f.getA());
} 
```

当您尝试分配`f.getA()`给 type 的引用时会出现问题`Double[]`：

```
public static void main(String[] args) {
    Foo<Double> f = new Foo<Double>();
    Double[] a2 = f.getA(); // throws ClassCastException
    System.out.println(a2);
} 
```

这是因为有关成员变量的类型信息`a`在运行时被删除。泛型仅在*编译时*提供类型安全（我在最初的帖子中不知何故忽略了这一点）。所以问题不

```
private T[] a = (T[]) new Object[5]; 
```

因为在运行时这段代码真的

```
private Object[] a = new Object[5]; 
```

当`getA()`在运行时实际返回 an的方法的结果`Object[]`被分配给类型的引用时，就会出现问题`Double[]`- 此语句抛出 ClassCastException，因为 Object 不能强制转换为 Double。

**更新 2**：回答你的最后一个问题“为什么数组会破坏这个？” 答案是因为语言规范不支持泛型数组创建。[有关更多信息，请参阅此论坛帖子](http://forums.sun.com/thread.jspa?threadID=530823)- 为了向后兼容，对运行时 T 的类型一无所知。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T04:21:45.993

@mattb 的解释中可能存在一些小错误。

错误*不是*

> java.lang.Object 不能强制转换为 java.lang.Double。

这是：

> [Ljava.lang.Object; 不能转换为 [Ljava.lang.Double

[L 表示数组。也就是说，错误是无法将Objects*数组强制转换为Double数组。*这与以下情况相同：

```
Object[] oarr = new Object[10];
Double[] darr = (Double[]) oarr; 
```

这显然是不允许的。

对于创建类型安全数组的问题，另一种选择是在 init 中排除类对象并使用 Array.newInstance：

```
import java.lang.reflect.Array;

class Foo<T> {
  private T[] a ;

  public Foo(Class<T> tclass) {
    a = (T[]) Array.newInstance(tclass, 5);
  }

  public T[] getA() {
    return a;
  }

  public static <T> Foo<T> create(Class<T> tclass) {
    return new Foo<T>(tclass);
  }
}

class Array1
{
  public static final void main(final String[] args) {
    Foo<Double> f = Foo.create(Double.class);
    Double[] d = f.getA();
  }

} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T20:04:25.060

@matt b：感谢您的回答！很有帮助。

我为那些感兴趣的人找到了一个解决方法：给 getA 方法一个初始化的数组来填充。这样类型信息就可用了。

```
public class Foo<T> {
  private T[] a = (T[]) new Object[5];

  public Foo() {
    // Add some elements to a
  }

  public T[] getA(T[] holdA) {
    // Check whether holdA is null and handle it...then:
    holdA = (T[]) Array.newInstance(holdA.getClass().getComponentType(), a.length);
    System.arraycopy(a, 0, holdA, 0, a.length);
    return holdA;
  }
} 
```

然后对于您的主要方法：

```
public static void main(String[] args) {
  Foo<Double> f = new Foo<Double>();
  Double[] a2 = new Double[1];
  a2 = f.getA(a2);
} 
```

# asp.net - 在 ASP.NET MVC 应用程序中放置域对象的最佳位置？

> ID：372254
> 
> 赞同：3
> 
> 时间：2008-12-16T18:43:57.547
> 
> 标签：asp.net, asp.net-mvc

我刚刚开始我在 ASP.NET MVC 中的第一个项目。在我的 webforms 经验中，我通常会有一个单独的项目专门用于我的领域层。在这里，我将拥有我的域特定对象以及我的 NHibernate 映射文件和一些业务逻辑。我在网上看到的大多数示例都是将这些类与业务逻辑一起放入 MVC 应用程序的 Models 文件夹中，然后从控制器调用它。根据我的经验，如果需要的话，这似乎会使将逻辑转移到不同的平台变得更加困难。具体来说，我正在考虑是否需要将其移动到网络表单应用程序中，如果环境要求的话。这可能是一个幼稚的问题，但是将域数据放在自己的项目中还是在模型文件夹中更好？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T18:48:53.980

如果您计划在 MVC 应用程序之外重用模型，则单独的类库仍然是可接受的设置。我这样做了，但保留 Models 文件夹并将模型放入其中以用于我的视图。

如果您将 DAL 放入 Webforms 项目的 App_Code 中，那么我会将其放入您的 MVC 项目中的模型中。否则，请像以前一样继续使用单独的项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T18:53:50.290

我以类似的方式布局我的解决方案——业务逻辑、数据访问、域对象都驻留在一个项目中。视图（Web、Web 服务、Windows 窗体、WPF..）都进入它们自己的单独项目。

这样，特定于 UI 的代码就不会过滤到应用程序的较低层。在大多数 Web 项目中，我不得不拼凑一个 Windows 窗体以将新数据注入数据库或管理某种在 Web 媒体中不可行的应用程序。

如果我在业务级别使用 HttpCaching，我将无法在视图之间切换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T19:28:59.313

我使用类似的方法。我也在使用 MVC，我喜欢在单独的项目中使用 POCO 域模型。对于我现在正在构建的应用程序，我有以下项目：

*   厘米数据
*   管理服务
*   域名
*   CMS网站

Cms.Data 是一个数据访问项目，可将 LinqToSql 或实体框架模型转换为 Cms.Domain 中的 POCOs 模型，反之亦然。Cms.Services 是一个具有业务逻辑的服务项目，它将 POCO 从/发送到数据层。最后，Cms.Web 是 MVC 项目，它使用来自控制器和 POCO 的服务作为模型。

我喜欢接受批评:)

# java - Java密码短语加密

> ID：372268
> 
> 赞同：6
> 
> 时间：2008-12-16T18:49:30.813
> 
> 标签：java, encryption, passphrase

我正在尝试学习如何使用 Java 进行基于密码的加密。我在网上找到了几个例子，但在 Stack Overflow 上还没有（还）。这些例子对我来说有点解释，特别是关于算法选择。似乎有很多传递字符串来说明使用什么算法，但很少有关于字符串来自哪里以及它们的含义的文档。而且似乎不同的算法可能需要 KeySpec 类的不同实现，所以我不确定哪些算法可以使用我正在查看的 PBEKeySpec 类。此外，这些示例似乎都有些过时，许多示例都要求您获取以前不属于 JDK 的一部分的较旧的加密包，甚至是第三方实现。

有人可以简单介绍一下我需要做什么来实现加密（字符串数据，字符串密码）和解密（字节 [] 数据，字符串密码）吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-17T06:33:17.570

我会谨慎地从论坛提供或接受与安全相关的建议……细节非常复杂，而且经常很快就过时了。

话虽如此，我认为 Sun 的[Java Cryptography Architecture (JCA) Reference Guide](http://java.sun.com/javase/6/docs/technotes/guides/security/crypto/CryptoSpec.html)是一个很好的起点。查看说明基于密码的加密 (PBE)的随附[代码示例。](http://java.sun.com/javase/6/docs/technotes/guides/security/crypto/CryptoSpec.html#PBEEx)

顺便说一句，标准 JRE 只为 PBE 提供了几个开箱即用的选项（“PBEWithMD5AndDES”就是其中之一）。如需更多选择，您将需要“强大的加密包”或一些第三方提供商，如[Bouncy Castle](http://www.bouncycastle.org/)。另一种选择是使用 JRE 中提供的散列和密码算法来实现您自己的 PBE。您可以通过这种方式使用 SHA-256 和 AES-128 实现 PBE（[示例加密/解密方法](http://gmailassistant.sourceforge.net/src/org/freeshell/zs/common/Encryptor.java.html)）。

简而言之，PBE的加密方法可能涉及以下步骤：

1.  从用户那里获取密码和明文，并将它们转换为字节数组。
2.  生成一个安全的随机[salt](http://en.wikipedia.org/wiki/Salt_(cryptography))。
3.  将盐附加到密码并计算其加密[哈希](http://en.wikipedia.org/wiki/Cryptographic_hash_function)。重复多次。
4.  使用生成的哈希作为[初始化向量](http://en.wikipedia.org/wiki/Initialization_vector)和/或[密钥](http://en.wikipedia.org/wiki/Key_(cryptography))加密明文。
5.  保存盐和生成的密文。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-09T07:34:25.867

使用[RFC2898](http://www.ietf.org/rfc/rfc2898.txt)从密码生成密钥。据我所知，这不包含在 JRE 或 JCE 中，但它包含在[JBoss](http://docs.jboss.com/seam/latest/api/org/jboss/seam/security/crypto/PBKDF2.html)、Oracle 和[WebSphere](http://download.oracle.com/docs/cd/E12839_01/apirefs.1111/e10668/oracle/security/crypto/core/PBEAlgorithmIdentifier.html)等 J2EE 服务器中。它也包含在 .NET 基类库 ( [Rfc2898DeriveBytes](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rfc2898derivebytes.aspx) ) 中。

Java 中有一些 LGPL 实现，但快速浏览一下，[这个](http://www.rtner.de/software/PBKDF2.html)实现看起来有点过于复杂。还有一个很好的[javascript 版本](http://anandam.name/pbkdf2/pbkdf2.js.txt)。（我制作[了该版本的修改版本](http://cheeso.members.winisp.net/srcview.aspx?dir=AES-example&file=Ionic.Com.PBKDF2.wsc)并将其打包为 Windows 脚本组件）

由于缺乏具有适当许可证的良好实现，我从 Mattias Gartner 打包了一些代码。这是完整的代码。简短，简单，易于理解。它是根据[MS Public License](http://www.opensource.org/licenses/ms-pl.html)获得许可的。

```
// PBKDF2.java
// ------------------------------------------------------------------
//
// RFC2898 PBKDF2 in Java.  The RFC2898 defines a standard algorithm for
// deriving key bytes from a text password.  This is sometimes
// abbreviated "PBKDF2", for Password-based key derivation function #2.
//
// There's no RFC2898-compliant PBKDF2 function in the JRE, as far as I
// know, but it is available in many J2EE runtimes, including those from
// JBoss, IBM, and Oracle.
//
// It's fairly simple to implement, so here it is. 
// 
// Created Sun Aug 09 01:06:57 2009
//
// last saved: 
// Time-stamp: <2009-August-09 02:19:50>
// ------------------------------------------------------------------
//
// code thanks to Matthias Gartner
//
// ------------------------------------------------------------------

package cheeso.examples;

import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class PBKDF2
{
    public static byte[] deriveKey( byte[] password, byte[] salt, int iterationCount, int dkLen )
        throws java.security.NoSuchAlgorithmException, java.security.InvalidKeyException
    {
        SecretKeySpec keyspec = new SecretKeySpec( password, "HmacSHA1" );
        Mac prf = Mac.getInstance( "HmacSHA1" );
        prf.init( keyspec );

        // Note: hLen, dkLen, l, r, T, F, etc. are horrible names for
        //       variables and functions in this day and age, but they
        //       reflect the terse symbols used in RFC 2898 to describe
        //       the PBKDF2 algorithm, which improves validation of the
        //       code vs. the RFC.
        //
        // dklen is expressed in bytes. (16 for a 128-bit key)

        int hLen = prf.getMacLength();   // 20 for SHA1
        int l = Math.max( dkLen, hLen); //  1 for 128bit (16-byte) keys
        int r = dkLen - (l-1)*hLen;      // 16 for 128bit (16-byte) keys
        byte T[] = new byte[l * hLen];
        int ti_offset = 0;
        for (int i = 1; i <= l; i++) {
            F( T, ti_offset, prf, salt, iterationCount, i );
            ti_offset += hLen;
        }

        if (r < hLen) {
            // Incomplete last block
            byte DK[] = new byte[dkLen];
            System.arraycopy(T, 0, DK, 0, dkLen);
            return DK;
        }
        return T;
    } 

    private static void F( byte[] dest, int offset, Mac prf, byte[] S, int c, int blockIndex ) {
        final int hLen = prf.getMacLength();
        byte U_r[] = new byte[ hLen ];
        // U0 = S || INT (i);
        byte U_i[] = new byte[S.length + 4];
        System.arraycopy( S, 0, U_i, 0, S.length );
        INT( U_i, S.length, blockIndex );
        for( int i = 0; i < c; i++ ) {
            U_i = prf.doFinal( U_i );
            xor( U_r, U_i );
        }

        System.arraycopy( U_r, 0, dest, offset, hLen );
    }

    private static void xor( byte[] dest, byte[] src ) {
        for( int i = 0; i < dest.length; i++ ) {
            dest[i] ^= src[i];
        }
    }

    private static void INT( byte[] dest, int offset, int i ) {
        dest[offset + 0] = (byte) (i / (256 * 256 * 256));
        dest[offset + 1] = (byte) (i / (256 * 256));
        dest[offset + 2] = (byte) (i / (256));
        dest[offset + 3] = (byte) (i);
    } 

    // ctor
    private PBKDF2 () {}

} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-02-22T08:15:21.713

在上面 Cheeso 非常有用的答案中，有一个糟糕的性能错误。

线

```
int l = Math.max( dkLen, hLen) 
```

不应该计算最大值，而是计算除法的上限，所以

```
int l = ((dkLen - 1) / hLen) + 1; // >= ceil(dkLen / hLen), == for dkLen =>1 
```

这将使 16 字节密钥的计算速度提高 20 倍。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T21:00:41.593

您需要一个加密库，它将告诉您如何设置它。
我碰巧喜欢 bouncycastle.org 上的东西。[您可以在此处](http://www.bouncycastle.org/specifications.html#install)找到他们的操作方法 5.1 示例中提到的 DES 是他们提供的加密之一。实际字符串的含义取决于提供者。基本上你加载库。

```
Security.addProvider(new BouncyCastleProvider()); 
```

然后*只*使用 JCE 接口做任何你想做的事情：

```
 keyGen = KeyGenerator.getInstance("DES", "BC"); 
```

Java 为您处理库和接口的绑定，您不必这样做。如果您有任何问题，我会更乐意解释更多。不幸的是，目前我患有“我不记得我是如何学会它的”疾病，所以请随时提问。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T21:51:01.977

您可以使用哈希算法（必要时多次）从密码短语中获取一些可以用作密钥的原始数据（如果算法需要，则为初始化向量）。

然后，您可以将该密钥与任何对称算法一起使用——例如 3DES-CBC 或 AES-CBC（DES 现在被认为已过时）。

根据您可用的 JCE，您可能有不同的算法可供您使用，但 AES 可能是您想要的。然而，算法的选择以及如何使用它在某种程度上是一个宗教问题，并且不建议您尝试使用自己的算法，甚至尝试使用标准算法构建自己的加密方案。如果你没有研究过它，你几乎肯定会弄错，即使你有过。

如果安全性对您来说非常重要以至于您正在考虑加密，那么您还应该考虑查看安全工程书籍，例如 Bruce Schneier 的 Applied Cryptography 或 Ross Anderson 的 Security Engineering - 存在很多实现陷阱。例如，首先使用密码作为密钥并不是一个好主意，因为它从本质上减小了密钥的大小。

您还可以查看其他人所做的设计，IETF 有很多，例如： [https ://datatracker.ietf.org/doc/html/draft-mcgrew-aead-aes-cbc-hmac-sha1-00](https://datatracker.ietf.org/doc/html/draft-mcgrew-aead-aes-cbc-hmac-sha1-00)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T23:05:53.160

如果您不需要解密密码，而只是根据密码/密码生成加密密钥，则可以使用 JCE Cipher 和 MessageDigest 类实现[PKCS#5 标准。](http://www.ietf.org/rfc/rfc2898.txt)

# c# - C# 中的异常处理：多次尝试/捕获与一次

> ID：372282
> 
> 赞同：4
> 
> 时间：2008-12-16T18:53:55.077
> 
> 标签：c#, exception

每种方法有多个`try{} catch{}`语句是一种好习惯吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-16T18:58:19.140

在我看来，让每个方法只处理一个任务是一种很好的做法。因此，您很少需要在一个方法中包含多个 try/catch 块。但是，我认为它没有任何问题。

正如 Lisa 指出的那样，您应该捕获特定的异常，并且*只*捕获该方法可以实际处理的异常。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-16T18:55:38.257

最好有一个 try/catch 和多个 catch 以不同方式处理每种类型的异常。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-16T18:56:44.213

如果您事先知道可能发生的异常类型，则可以尝试一次并捕获每个异常，如果您想以不同的方式处理它们。例如：

```
try
{
    // a bunch of risky code
}
catch (SpecificException1 ex1)
{
     // handle Specific Exception 1
}
catch (SpecificException2 ex2)
{
     // handle Specific Exception 2
}
catch (SpecificException3 ex3)
{
     // handle Specific Exception 3
}
catch (Exception ex)
{
     // handle an exception that isn't specific
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-16T19:11:37.070

IMO 如果您事先知道可能发生的异常，则不应使用 try...catch 来获取错误。

不要用异常编程......所以我认为倍数不是一个好主意。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-16T19:01:42.097

`finally`一般来说，我往往有很多`catch`。通常，除了例外，您无能为力，所以让它冒泡吧*。*但是`finally`确保您可以干净地关闭事物等。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-18T04:33:41.507

对于复杂的生产级场景，拥有多个 try-catch 语句是一种可怕的做法，而将这些语句放在业务逻辑中是非常不灵活的做法。

Windows 云计算团队（他们的代码必须高效可靠）似乎坚持使用[异常处理行动策略](http://rabdullin.com/journal/2008/12/1/net-exception-handling-action-policies-application-block.html)。

此代码是更好的替代品：

```
// perform action within the policy
policy.Do(() => repository.AddMessages(someMessages)); 
```

虽然较旧的代码块看起来像：

```
try
{
  repository.AddMessages(someMessages);
}
catch (Exception1 ex)
{
  // dosomething...
}
catch (Exception2 ex)
{
  // second handler
}
catch (Exception3 ex)
{
  // third handler
} 
```

或（这是 Microsoft Enterprise Library 在硬编码操作策略中提供可配置异常处理程序的方式）：

```
try
{
  repository.AddMessages(someMessages);
}
catch (Exception ex)
{
  bool rethrow = ExceptionPolicy
    .HandleException(ex, "Global Policy");
  if (rethrow)
  {
    throw;
  }
} 
```

另外，如果您有[操作策略](http://rabdullin.com/journal/2008/11/29/what-is-an-action-policy.html)，您可以告诉它（配置）记录、休眠、重试某些类型的异常，而不是简单地失败或执行一些其他硬编码操作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-16T19:02:53.860

根据经验，每个方法都应该处理一个任务——这种最佳实践源自测试驱动的环境，这使得生成测试变得更加容易。为“上帝”程序编写测试计划本质上更难。

因此，最好的做法是仅在可能失败的项目周围使用 try{} catch{}，并且仅在通常捕获异常以进行有用处理的地方使用。

不要使用单个 try{} catch{} 来包装方法的全部内容，从而消除对良好编码实践的责任。

处理异常是一项昂贵的操作——在必要时捕获它们并编写代码来防止在其他地方发生异常。在某些情况下，防止异常本身并不简单，但可以使用 try/catch 捕获并有效地使用它 - 例如检查文件操作的排他性。

当你使用 try/catch 时做出一个有意识的决定，不要因为你可以就扔掉它，那是懒惰的。问问自己“我在这里需要它吗？”或“我可以使用更便宜和/或更结构化的方法来做到这一点吗？”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-16T18:56:34.043

我会说这取决于。对我来说，到处都是这些尝试捕获的东西看起来有点草率。我尝试合并到一个包含许多捕获的 try 块。有时这不起作用，您可能需要将它们分开，但为了保持可读性，至少我喜欢这样。

当然，如果您的方法太长，您可以提取方法来分发您的尝试捕获。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-16T19:01:00.477

这取决于。异常处理的目的就是在运行时异常发生时处理它们。

我通常有一个 catch all tr​​y/catch，然后我将 try catch 块放置在我知道有可能引发异常（类型转换等）的代码区域周围。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-16T19:02:30.897

我发现合并多行代码，每行代码都可以将自己的异常抛出到一个带有许多捕获的 try 块中，这使得代码难以阅读。仅查看代码并不能明显看出哪一行代码抛出了什么异常。在我看来，try catch 应该包含尽可能少的代码；只有可以抛出给定异常的代码。如果您正在编写的方法包含多个尝试捕获，则应将它们分别提取到自己的方法中。

如果您的方法中有多个引发相同异常的方法调用，这将变得更加重要。然后它们真的应该在单独的尝试捕获中，因为当您捕获异常时，您通常希望将其包装在适合当前抽象的新异常中，并带有相关的错误消息。如果您在同一个 try catch 中有两个语句，您将失去为不同错误提供不同错误消息的机会。

```
Object operationResult;
try {
  operationResult = remoteService.performRemoteOperation();
} catch (RemoteException ex) {
  throw new BusinessException("An error occured when getting ...", ex);
}

// use operation result 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-16T19:26:32.047

使用多个 try/catch 块的优点是它清楚地将您正在尝试的操作与预期的异常配对。一般来说，如果引发异常的条件不可恢复，您将不会捕获异常（除非您正在执行诸如记录特定异常以进行诊断的操作）。像这样的代码：

```
try
{
   Operation1();
}
catch (MySpecificException1)
{
   RecoverFromExpectedException1();
}
try
{
  Operation2();
}
catch (MySpecificException2)
{
   RecoverFromExpectedException2();
} 
```

可能有点冗长，但这是使用异常进行流控制的结果。重要的是您可以通过查看此代码来判断第一个操作可能会引发特定异常，并且您的代码知道如何从该异常中恢复并继续执行第二个操作。并且 try/catch 块没有做任何其他*事情*。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-16T20:38:44.883

甚至每个方法都有 1 次尝试/捕获是不好的做法。

完全发明了异常，以便我们可以编写更少的错误处理代码，而不是像其他一些答案所建议的那样。

在出现异常之前，您必须通过测试返回值来检查每行代码是否成功，如果出现问题，则必须通过返回值将其传回调用堆栈。这意味着每个方法都必须测试并返回。发明了异常，以便方法不必在所有地方都要求这些检查，并且您可以拥有一系列可读的直接代码行，因为它们不会被错误处理所掩盖。

所以...建议是，您应该拥有最少的尝试/捕获量，这应该意味着大多数方法都不需要。

但是，这里有一些地方应该使用它们：

*   当操作失败（写入日志文件或向用户显示错误消息）时，仅当您知道程序可以继续并且由于该操作失败而现在不处于损坏状态时才执行此操作。操作必须彼此隔离。
*   在您的 Main 方法中记录在您的程序因此而终止之前未在其他地方处理的任何异常。
*   在您可以采取行动的地方，例如重试操作或回退到较低的操作模式。
*   有一个糟糕的 API 不允许您测试您需要处理的条件。例如，如果你想打开一个文件，而 API 没有提供 DoesFileExist() 你可以先调用。

我现在无法想到其他任何地方......那是因为尝试/捕获应该很少而且相距甚远！

当抛出任何异常时，我总是将调试器设置为中断。它很少中断，因为异常是例外的。

# excel - 如何在 excel 2007 中禁用 ms 查询对列别名的自动换行和引号？

> ID：372285
> 
> 赞同：0
> 
> 时间：2008-12-16T18:54:52.097
> 
> 标签：excel, ms-office, ms-query

我正在处理通过 MS Query 访问旧数据源的工作表。我试图为一些可笑的丑陋的列名加上别名，但数据源不支持用引号包裹别名。由于 excel 会自动将别名用引号括起来，因此查询错误/失败。我似乎被困住了。

如何停止这种默认行为？

在这种情况下，我宁愿不使用 VBA。我真的只是想弄清楚我是否可以让 MS Query 为这些列起别名而不用单引号括起来。

我发现了一些关于注册表项/热修复的文章。但它们都引用了早期版本的 excel，并且 07 的 reg 条目不存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T19:49:06.993

我找到了解决办法。

如果我直接从 Connection Properties -> Definition 选项卡（而不是从 MS Query 中）编辑 SQL，则生成的查询将没有自动包装的别名。

可以使用的小盒子，但没有任何复制粘贴解决不了:)

# eclipse - 如何在 Aptana Studio for Eclipse 中关闭自动更新？

> ID：372287
> 
> 赞同：4
> 
> 时间：2008-12-16T18:56:10.800
> 
> 标签：eclipse, aptana, updates

我为 Eclipse 安装了 Aptana Studio 插件，现在 Eclipse 启动比以往任何时候都慢，因为 Aptana Studio 总是在启动时检查更新——而且它真的很慢！

如何在 Aptana 中关闭自动更新？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-16T19:03:07.743

Window->Preferences，在树中找到 Install/Update 项并找到 Automatic Updates。您可以在此处更改更新行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T22:38:05.817

对于 Aptana 更新，请转到 Window->Preferences。然后打开 Aptana->Install/Update->Automatic_Updates 首选项面板。在那里取消选中“自动查找新更新并通知我”复选框。

# visual-studio-2008 - VS2008 Testrunner 能否运行 MbUnit 测试？

> ID：372291
> 
> 赞同：4
> 
> 时间：2008-12-16T18:56:54.683
> 
> 标签：visual-studio-2008, unit-testing, tfs, mbunit

好的，所以我一直看到 VS2008 有这么好的单元测试显示，我可以看到人们在 Dimecasts.net 上运行 NUnit 测试，[这篇文章](http://weblogs.asp.net/astopford/archive/2008/07/03/mbunit-v3-in-visual-studio-team-system-2008.aspx)似乎暗示 MbUnit v3 应该支持使用 Visual Studio 的测试运行器。但是我无法让它识别我的测试。

有没有其他人能够让 Visual Studio 运行他们的 MbUnit 测试，如果是这样，你是否需要做任何特别的事情来配置它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-30T03:31:28.250

我必须从[http://www.gallio.org](http://www.gallio.org)安装 Gallio 3.0.5 或更高版本。它自动安装在 Visual Studio Professional 或 Team Edition 中。注意：VS Standard 不支持测试项目。安装 Gallio 后，您可以创建应该可以正常工作的 MbUnit 测试项目。我能够使用此设置运行 Xunit.NET 测试（在 VS 2008 Professional 中）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T21:09:37.627

它受支持，但您必须通过添加正确的 ProjectTypeGuid 稍微修改您的项目文件，以便 VSTS 将其识别为测试项目：

[http://alexduggleby.com/2008/02/19/turning-a-class-library-project-into-a-mstest-project-or-using-mbunit-mstest-and-other-frameworks-in-one-项目/](http://alexduggleby.com/2008/02/19/turning-a-class-library-project-into-a-mstest-project-or-using-mbunit-mstest-and-other-frameworks-in-one-project/)

请注意，我们仍在解决 VSTS 中大型测试项目的一些性能问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T16:43:19.190

尝试使用 MbUnit v3 alpha 3（如果您还没有），看看这篇文章是否有帮助：

[http://weblogs.asp.net/astopford/archive/2008/07/03/mbunit-v3-in-visual-studio-team-system-2008.aspx](http://weblogs.asp.net/astopford/archive/2008/07/03/mbunit-v3-in-visual-studio-team-system-2008.aspx)

# c# - 有没有办法在 c# 中获取日期更改通知？

> ID：372309
> 
> 赞同：9
> 
> 时间：2008-12-16T19:02:44.420
> 
> 标签：c#, date

有没有办法在 c# 中获取日期更改通知？

我有一个要求，当系统日期更改时我必须做一些事情。

我发现 SystemsEvent.TimeChanged 是一个可以挂钩的事件，但是只有在用户更改时间时才会触发它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T19:05:14.633

有一个在午夜运行的计划任务/cron 作业会更好地处理这个问题吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T19:12:36.757

您可以按如下方式实现此（诚然很糟糕）：

编写一个非常轻量级的类，它只存储当前日期。在一个单独的线程中启动它并让它定期检查日期，然后休眠很长一段时间（事实上，你可以让它休眠的时间比午夜之前的时间长）。如果日期已更改，请使其在应用程序的主要部分中调用回调函数。

就像我说的那样，这似乎不是解决您问题的绝妙方法，并且可能有更好的方法来解决。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T19:40:34.767

您可能正在寻找[System.Threading.Timer](http://msdn.microsoft.com/en-us/library/system.threading.timer.aspx)。它将以您设置的间隔触发。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T18:45:15.010

当用户更改系统日期/时间时，系统会广播[WM_TIMECHANGE 消息。](http://msdn.microsoft.com/en-us/library/ms725498.aspx#)处理此问题的正确方法是处理该消息。我怀疑.net 事件 SystemEvents.TimeChanged 只是对此的一个包装。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T22:54:41.190

假设您要知道用户何时更改其 PC 的日期\时间，我知道这样做的唯一方法是监视事件日志，如下所示：

```
 static System.Diagnostics.EventLog log = new EventLog("System");

    public Form1()
    {
        log.EntryWritten += new EntryWrittenEventHandler(log_EntryWritten);
        log.EnableRaisingEvents = true;
    }

    void log_EntryWritten(object sender, EntryWrittenEventArgs e)
    {
        if (e.Entry.InstanceId == 1 && e.Entry.EntryType == EventLogEntryType.Information)
            Console.WriteLine("Test");
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T19:12:41.810

您的应用程序可以运行一个休眠一分钟的循环，然后检查日期。如果它与上次不同，请运行您的逻辑。

但我同意通过计划任务更好地处理这种情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T19:13:19.390

不确定是否有此事件，但如果没有，可用的解决方法是每分钟触发一个计时器，如果两次通话之间的时间更改超过 5 分钟，那么您可以确定时间已更改以某种方式。如果您愿意，可以通过每秒触发事件并检查超过 10 秒的时间差来进行更精细的处理，但每分钟可能就足够了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-06T18:36:31.410

或将其用于 DST 信息：TimeZone.CurrentTimeZone.GetDaylightChanges(DateTime.Today.Year)

# php - Using OOP for combining lots of functions (sort of namespace) in PHP?

> ID：372316
> 
> 赞同：4
> 
> 时间：2008-12-16T19:04:46.490
> 
> 标签：php, oop, class, performance

I am working with PHP and I am wondering how bad practise it is to combine lots of functions into a class. I am aware of it's not the purpose of classes, but the reason why I would do this is to provide a namespace. How big impact does it make to initiate let's say 10 classes at the execution of a PHP script instead of let's say 2 or 3?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T19:19:40.533

If you're using a php version < 5.3 (and you are probably, so you can't use namespaces) than you could use something like:

```
<?php
class Foo {
   public static function aStaticMethod() {
       // ...
   }
}

Foo::aStaticMethod();
?> 
```

(copied from [the php manual](http://theserverpages.com/php/manual/en/language.oop5.static.php))

I'd say it a function of a class in a way - grouping of functionality.

This won't have any performance related problems with it (you could do it millions of times and you won't even notice - there should be no runtime cost, only a minute extra parsing cost and this is negligible). Modern php frameworks bring in loads of code and internally create a lot of objects - I wouldn't worry about php performance, database performance will almost always hit you first. Make sure your code is readable and maintainable (yes, especially php code ;)) and if that means grouping functions then do it.

"97% of the time premature optimization is the root of all evil", especially when you're doing web pages and not nuclear simulations ;)

Edit: public and static are php5 only, in php<5 you could try:

```
<?php
class Foo {
   function aStaticMethod() {
       // don't touch $this
   }
}

Foo::aStaticMethod();
?> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T19:45:18.500

如果您非常担心加载 10 个类太慢的性能，那么您不应该使用 PHP。

至少，使用像 APC 这样的操作码缓存，然后加载类根本不应该成为负担。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T19:07:37.797

You may not be aware that PHP, as of recently, has first class namespace support: [http://php.net/language.namespaces](http://php.net/language.namespaces).

# actionscript-3 - 如何在 Actionscript 中获取对象的属性列表？

> ID：372317
> 
> 赞同：31
> 
> 时间：2008-12-16T19:05:07.863
> 
> 标签：actionscript-3, flex3, filterfunction

我有一个 dataprovider 和一个分配给我的 dataprovider 的数组的 filter 函数。

当数据提供者 (item.data) 传递给过滤器函数时，如何获取其每一行中的属性列表？

例如，如果我的对象包含：

*   目的
    *   姓名
    *   电子邮件
    *   地址

然后我希望在我的过滤器功能中能够查看姓名、电子邮件和地址。不幸的是，我事先不知道这些属性是什么。

有任何想法吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-12-16T19:40:36.777

如果它是一个动态对象，我相信你可以这样做：

```
var obj:Object; // I'm assuming this is your object

for(var id:String in obj) {
  var value:Object = obj[id];

  trace(id + " = " + value);
} 
```

这就是它在 AS2 中的完成方式，我相信这仍然适用于 AS3 中的动态对象。我认为它将显示的属性在非动态对象上更加有限。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-10-28T22:36:59.240

[`flash.utils.describeType(value:*)`](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/utils/package.html#describeType())还将为您提供对象的属性列表。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-07-17T14:08:43.003

for-in 仅适用于动态对象。对于类型化的对象，您需要使用某种反射来获取属性名称（例如[http://www.as3commons.org/as3-commons-reflect/index.html](http://www.as3commons.org/as3-commons-reflect/index.html)）

/安德烈。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-10-28T22:26:34.213

您可能正在寻找

```
ObjectUtil.getClassInfo(object) 
```

，看：

[http://livedocs.adobe.com/flex/3/langref/mx/utils/ObjectUtil.html#getClassInfo%28%29](http://livedocs.adobe.com/flex/3/langref/mx/utils/ObjectUtil.html#getClassInfo%28%29)

请注意，其中存在一个错误，导致它将 XML 视为非动态数据类型。有关该错误的更多信息：bugs.adobe.com/jira/browse/SDK-17712

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-09-11T23:14:07.040

对我来说只有这个有用：

```
trace('obj = '+getProperties(obj));

        public static function getProperties(obj:*):String  {
            var p:*;
            var res:String = '';
            var val:String;
            var prop:String;
            for (p in obj) {
                prop = String(p);
                if (prop && prop!=='' && prop!==' ') {
                    val = String(obj[p]);
                    if (val.length>10) val = val.substr(0,10)+'...';
                    res += prop+':'+val+', ';
                }
            }
            res = res.substr(0, res.length-2);
            return res;
        } 
```

你会得到这样的东西：

```
obj = m:email@ra..., r:true 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-11T23:24:43.827

```
// this method will work for retrieving properties of a *non-dynamic* (typed) object

// @return - all object properties
public function getProperties(_obj : *) : Array
{
        var _description : XML = describeType(_obj);
        var _properties : Array = new Array();
        for each (var prop:XML in _description.accessor)
        {
                var _property : Object = new Object();
                _property.name = String(prop.@name);
                _property.type = String(simple_type(prop.@type));
                _property.access = String(prop.@access);
                _property.declaredBy = String(prop.@declaredBy);
                try
                {
                   _property.value = _obj[_property.name];
                }
                catch (e : Error)
                {
                   _property.value = "";
                }
                _properties.push(_property)
        }
        _properties.sortOn("name");
        return _properties;
}

// better format for object class information
private function simple_type(_type : String) : String
{
        var lastIndex : int = _type.lastIndexOf("::");
        _type = lastIndex > 0 ? _type.substr(lastIndex + 2) : _type;
        return _type;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T21:21:35.507

您可以使用 for .. in 循环来获取属性名称，或者使用 for each .. in 循环来获取属性值...

```
 for( var o : * in object){
    trace( o + " = " + object[o] );
}
/************* OR ******************/
for each( var o : * in object ){
    trace( "object has property: " + o );
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-02-13T05:52:45.373

这也将帮助您..
1\. for 循环 - 将基于索引
2\. for each - 递归调用，长度
不超过 3\. for in - 用于读取属性值

```
 for( var obj : String in objectData ) //here objectData is your object
     {
        trace( "Object Name Is : " + obj );
        var data : Object = objectData[obj]; //here we get the object value by using the property name
        trace( "Value Is : " + data ); //Converts object to string
     } 
```

# svn - Best practice for SVN tags?

> ID：372321
> 
> 赞同：13
> 
> 时间：2008-12-16T19:07:09.577
> 
> 标签：svn, version-control, collaboration

Should I use them as separate releases? Do I check them back into trunk or branches? Is this all in the red book and I've just wasted your time?

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-16T19:41:47.213

不要忘记标签和[分支](https://stackoverflow.com/questions/333785#333809)在 SVN 中本质上是相同的：两者都是`svn copy`

诀窍是，因为一个标签代表一个快照，它应该是一个“不可变”的，因为你不应该对它进行任何修改。

该快照（标签）代表什么完全取决于您。有可能：

*   发展中的稳定状态
*   复杂合并之前的标记（如果合并太复杂而无法快速解决，则返回到该标记）
*   发布或补丁
*   等等...

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-16T19:21:00.873

Not sure what you mean by "separate releases", but we copy from the trunk or branch we are making a build of into the tags folder with a descriptive name, like Proj-1.20.33

This way, for each build we have made, we can go back to that specific version. Generally, you would not want to make any real changes in a tag. For us, we go ahead and change some version numbers for the code and installer via our automated build process, so only those changes get merged back, and even then, that is the only thing that would be modifying those particular files.

The SVN Book talks about this a bit in [Common Branching Patterns](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.commonpatterns.html) and the [Tags](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.tags.html) entries.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-16T19:25:06.263

Most people I know who are still on SVN tag their trunk (or current production branch) right before every release.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-11T21:12:09.123

我更喜欢以下*标签*存储库目录的结构：

```
/tags
    /builds
        /PA
        /A
        /B
    /releases
        /AR
        /BR
        /RC
        /ST 
```

`PA`表示**pre-alpha** `A` 表示**alpha** `B` 表示**beta** `AR`表示**alpha-release** `BR`表示**beta-release** `RC`表示**候选版本** `ST`表示**稳定**

*构建*和*发布*之间存在差异。

*   *builds*文件夹下的标签具有对应于模式的版本号**`N.x.K`**，其中`N`和`K`是整数。示例：`1.x.0`, `5.x.1`,`10.x.33`
*   *发布*文件夹下的标签具有对应于模式的版本号，**`N.M.K`**其中和是整数。例子：, , .`N``M``K``1.0.0``5.3.1``10.22.33`

`tags`在存储库结构演变过程中某个特定时刻生成的存储库目录结构示例如下：

```
/tags
    /builds
        /PA
            /1.x.0
            /1.x.1
        /A
            /1.x.2
        /B
            /1.x.3
            /1.x.4
    /releases
        /AR
            /1.0.0
            /1.1.0
        /BR
            /1.0.1
            /1.0.2
            /1.1.1
        /RC
            /1.0.3
            /1.1.2
        /ST
            /1.0.4
            /1.1.3 
```

实际上，这种标记原则只是存储库结构方法的一部分。您可能会发现说明我描述的标记原理的[图表很有用。](http://scm.altern.kiev.ua/images/branches_naming_A3.en.jpg)它还包含更复杂的配置管理过程概述，包括分支和版本编号。

# jquery - 未在 jQuery 中选中的单选按钮

> ID：372325
> 
> 赞同：54
> 
> 时间：2008-12-16T19:08:52.303
> 
> 标签：jquery

我有这行代码用于页面加载：

```
if ($("input").is(':checked')) { 
```

当检查单选按钮输入时，它工作正常。但是，我想要相反的结果。类似的东西

```
if ($("input").not(.is(':checked'))) { 
```

这样我的 if 语句就会在没有选择任何单选按钮时运行。解决此问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-12-16T19:22:19.497

```
if ( ! $("input").is(':checked') ) 
```

不工作？

您也可以尝试像这样迭代元素：

```
var iz_checked = true;
$('input').each(function(){
   iz_checked = iz_checked && $(this).is(':checked');
});
if ( ! iz_checked ) 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-12-17T08:08:51.540

```
if ($("input").is(":not(:checked)")) 
```

AFAIK，这应该可以工作，针对最新的稳定 jQuery (1.2.6) 进行测试。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-17T09:16:16.303

如果我的萤火虫探查器工作正常（而且我知道如何使用它），这个：

```
$('#communitymode').attr('checked') 
```

比

```
$('#communitymode').is('checked') 
```

您可以在此页面上尝试:)

然后你可以像这样使用它

```
if($('#communitymode').attr('checked')===true) { 
// do something
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-10-28T14:30:49.340

```
$("input").is(":not(':checked')")) 
```

这是 jquery 1.3，注意 ' 和 " 符号！

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-05-14T19:44:25.203

```
$('input:radio[checked=false]'); 
```

这也可以

```
input:radio:not(:checked) 
```

或者

```
:radio:not(:checked) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-11-01T11:46:45.257

```
(!$('#radio').is(':checked')) 
```

这对我有用

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2017-12-25T07:27:44.693

这也有效。它似乎是最短的工作符号： `!$('#selector:checked')`

# asp.net - ASP.Net 无法查看共享文件夹

> ID：372326
> 
> 赞同：1
> 
> 时间：2008-12-16T19:10:03.190
> 
> 标签：asp.net, shared-directory, windows-security

我在以前没有工作过的网络中编写了一个新应用程序，但遇到了问题。

如果我有以下 C# 代码：

```
FileStream fs = File.Create(@"\\MyServer\MyShare\testing.txt");
fs.Close(); 
```

在控制台应用程序中，此代码可以正确执行。

在 ASP.Net 应用程序中，我收到此错误：**登录失败：未知用户名或密码错误。**

在 ASP.Net 应用程序中，如果我添加身份 impersonate="true"，则会收到此错误：**拒绝访问路径 '\MyServer\MyShare\testing.txt'。**

我以前从未遇到过登录失败消息；这是从哪里来的？如果我在服务器上创建一个应用程序并将其写入物理位置，它工作正常（所以安全性很好），似乎共享的安全性不起作用（即使它设置了“所有人”完全写入），或者在服务器级别缺少某些东西，我一般不允许查看任何内容。

有谁知道我在这里想念什么？我已经编写了其他类似的应用程序并且从未遇到过这个问题

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T19:42:02.110

**更新：**

所以我认为我发布的太早了......它在我的本地主机上失败的原因是由于目录被设置为允许匿名访问（所以页面没有模拟；用户是''）。

It also started working on the server as well; however, nothing was changed there... I don't know if something was triggered during the app's downtime/shutdown or what, but everything's working as expected.

Thanks for the comments!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T19:14:25.270

问题在于，在身份模拟设置为 false 的情况下，ASP.NET 工作进程帐户正在尝试写入共享，通常是 NETWORK SERVICE 或 ASPNET 帐户。取决于您正在运行的 Windows 版本。

将 impersonate 设置为 true，而不指定用户名或密码将使用当前用户身份验证来尝试发出请求。

您将需要 A 授予工作进程帐户权限，这很可能是不可能的。或者 B 创建您的应用程序可以模拟的特定帐户，然后在身份标记中的 web.config 中指定凭据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T19:18:04.360

默认情况下，ASP.NET 应用程序作为*YourMachine* \ *IUSR_YourMachine 运行。* 您要么必须向Everyone 主体开放共享的权限（如果机器不在同一个域中，这仍然可能无法工作），或者以有权访问共享的人的身份运行您的IIS 应用程序。

您可以通过以下方式更改运行 ASP.NET 应用程序的用户：

.打开**管理工具 -> Internet 信息服务**，然后右键单击包含应用程序的网站或虚拟目录，然后单击**属性**。选择**目录安全**选项卡并单击**编辑**。最后，在**匿名访问**部分输入有权访问共享的用户的用户名和密码。

麦克风

# ruby-on-rails - Ruby/Rails 和 Sharepoint Web 服务

> ID：372327
> 
> 赞同：6
> 
> 时间：2008-12-16T19:10:53.733
> 
> 标签：ruby-on-rails, ruby, web-services, sharepoint, soap4r

我正在尝试使用 ruby​​ 来使用 Sharepoint 网络服务。我基本上放弃了尝试使用 NTLM 进行身份验证，并暂时更改了 Sharepoint 服务器以使用基本身份验证。我已经使用soap4r 成功获得了WSDL，但在尝试使用实际的Web 服务调用时仍然无法进行身份验证。

有没有人有过让 ruby​​ 和 Sharepoint 说话的经验？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-03-17T19:44:38.817

我是一个完全的新手。但经过大量时间并在更多经验丰富的编码人员的帮助下，我能够让 ruby​​ 与 Sharepoint 2010 一起工作。下面的代码需要“ntlm/mechanize”gem。

我已经能够使用列表 GUID 和列表视图 GUID 从指定的列表（下面）下载共享点 xml。

编辑（2011 年 5 月 23 日）。我应该指出，这段代码需要 ruby​​-ntlm gem。这是一个不错的链接，应该会有所帮助。这绝对有效。

[http://rubydoc.info/gems/ruby-ntlm/0.0.1/file/README.markdown](http://rubydoc.info/gems/ruby-ntlm/0.0.1/file/README.markdown)

```
agent = Mechanize.new
agent.auth('domain\\USERNAME', 'PASSWORD')
page = agent.get('http://URL/DIRECTORY/SITE/LIST/_vti_bin/owssvr.dll?Cmd=Display&List={LIST_GUID}&View={VIEW_GUID}&XMLDATA=TRUE') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T20:01:47.280

您如何将 SP 服务器更改为使用基本身份验证？您是通过 IIS 配置站点，还是通过 SP Central Admin 配置站点？

如果您使用的是 SP 2007/MOSS，则需要通过 Central Admin 进行更改；如果是 2003，则需要通过 IIS 进行。

请求失败时会出现什么错误？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-23T14:35:59.337

不知何故，soap4r 不支持 NTLM，尽管 httpclient 确实支持它。

当启用基本身份验证不是一个选项时，您可以考虑使用 kerberos 即协商身份验证方法。在 sharepoint 中启用此功能有点棘手，但基本上归结为在服务器的命令行上执行以下操作：

```
cscript adsutil.vbs set w3svc/1/NTAuthenticationProviders "Negotiate,NTLM" 
```

看起来可能有一些奇怪的后果，[请查看此论坛帖子以获取更多信息](http://www.issociate.de/board/post/4918/Kerberos_not_being_used,_only_NTLM_-_Login_failed_for_user_'(null)'.html)。最后，您需要在soap4r 中使用 auth= 而不是 basic_auth= 我认为设置身份验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T15:15:21.617

这可能无济于事，但 micorosoft 只是发布了 Sharepoint 和 WSRP 的工具包，[http://blogs.msdn.com/sharepoint/archive/2008/12/15/announcing-the-wsrp-toolkit-for-sharepoint.aspx](http://blogs.msdn.com/sharepoint/archive/2008/12/15/announcing-the-wsrp-toolkit-for-sharepoint.aspx)，因为RoR 支持该标准，它可以提供一种更简单的获取数据的方法。

# web-crawler - How would someone download a website from Google Cache?

> ID：372330
> 
> 赞同：2
> 
> 时间：2008-12-16T19:12:13.230
> 
> 标签：web-crawler, googlebot

A friend accidentally deleted his forum database. Which wouldn't normally be a huge issue, except for the fact that he neglected to perform backups. 2 years of content is just plain gone. Obviously, he's learned his lesson.

The good news, however, is that Google keeps backups, even if individual site owners are idiots. The bad news is, that traditional crawling robots would choke on the Google Cache version of the website.

Is there anything existing that would help trawl the Google Cache, or how would I go about rolling my own?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T19:17:42.317

You may want to consider looking at crawling the archive.org cache as well. If you're in there, it's generally better structured.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-18T02:15:27.083

如果网站足够小以至于您可以手动抓取它，那么[这个](http://userscripts.org/scripts/show/30878)无缝导航 Google 缓存的用户脚本非常有用。

# .net - 如何使用 ado.net 查找表的主键列？

> ID：372334
> 
> 赞同：4
> 
> 时间：2008-12-16T19:13:08.517
> 
> 标签：.net, ado.net

有没有一种纯粹的 .net 方法可以可靠地做到这一点？我一直在寻找的解决方案要么需要猜测，要么他们有特定于数据库提供商的解决方案。通常查询一些内部系统表来获取这些信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T19:16:35.937

每个 DataTable 对象都有一个 PrimaryKey 属性，它是一个 DataColumns 数组，表示表的主键。

例如：

```
string[] GetPrimaryKeys(SqlConnection connection, string tableName)
{
    using(SqlDataAdapter adapter = new SqlDataAdapter("select * from " + tableName, connection))
    using(DataTable table = new DataTable(tableName))
    {
        return adapter
            .FillSchema(table, SchemaType.Mapped)
            .PrimayKey
            .Select(c => c.ColumnName)
            .ToArray();
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T19:32:55.747

唯一的方法[错误] 正如 Igor 在评论中提到的，您可以调用 FillSchema() 这是一个链接... [FillSchema()](http://msdn.microsoft.com/en-us/library/152bda9x.aspx)

是查询Database的schema信息，这将取决于数据库供应商...

这是特定于 SQL Server 的，例如...

```
select kcu.TABLE_SCHEMA, kcu.TABLE_NAME, 
  kcu.CONSTRAINT_NAME, tc.CONSTRAINT_TYPE, kcu.COLUMN_NAME, kcu.ORDINAL_POSITION
from INFORMATION_SCHEMA.TABLE_CONSTRAINTS as tc
  join INFORMATION_SCHEMA.KEY_COLUMN_USAGE as kcu
    on kcu.CONSTRAINT_SCHEMA = tc.CONSTRAINT_SCHEMA
   and kcu.CONSTRAINT_NAME = tc.CONSTRAINT_NAME
   and kcu.TABLE_SCHEMA = tc.TABLE_SCHEMA
   and kcu.TABLE_NAME = tc.TABLE_NAME
 where tc.CONSTRAINT_TYPE in ( 'PRIMARY KEY', 'UNIQUE' )
 order by kcu.TABLE_SCHEMA, kcu.TABLE_NAME, 
      tc.CONSTRAINT_TYPE, kcu.CONSTRAINT_NAME, kcu.ORDINAL_POSITION; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T19:29:12.387

只是为了增加伊戈尔的答案。您实际上不需要查询整个数据子集，只需使用 adapter.FillSchema(table, SchemaType.Mapped) ，然后从数据表中获取主键。

[连锁](http://msdn.microsoft.com/en-us/library/system.data.common.dbdataadapter.fillschema(VS.71).aspx)

（如果你使用 SQL，你可以从系统视图中获取它们，但我假设你已经知道了。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T09:04:09.090

只是标记到这个查询。ADO.Net 中是否有一种方法可以从选择的表中提取通用（即数据库供应商独立）模式。我不仅在考虑列名、类型和主键（我知道这很容易获得），而且还考虑外键集合。我可以使用 sqlserver2005 特定的逻辑相当容易地完成所有这些工作，但我希望看到一种与数据库无关的对象模型方法。

我会看这个空间:)

祝各位大师好运...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-21T17:58:24.820

有一个库，[Kailua - ADO.NET API 中被遗忘的方法。](http://kailua.codeplex.com/)，这确实为前 5 名供应商提供了此元数据和其他元数据。此信息是特定于供应商的。

# microcontroller - Gadzooks! Architectures abound! Looking for an embedded processor/controller taxonomy

> ID：372347
> 
> 赞同：5
> 
> 时间：2008-12-16T19:16:14.907
> 
> 标签：microcontroller, taxonomy, microprocessors, embedded

I am looking for a taxonomy of embedded processors. Which processors belong to which families? Who decends from whom?

Does anyone here know of a simple article that describes it?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T23:50:32.413

维基百科上的[通用微控制器](http://en.wikipedia.org/wiki/List_of_common_microcontrollers)页面可能是一个起点，或者微控制器文章中的[这个较短的列表](http://en.wikipedia.org/wiki/Microcontroller#Types_of_microcontrollers)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T17:37:40.617

[Instructables](http://www.instructables.com/id/ESICJ1VA2EEWIJKVP2/) has a nice overview.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-18T00:25:53.820

如果您想要一个分类法来对许多非常不同类型的处理器进行分类，您可能会喜欢[“什么是不同类型的计算机体系结构？”](https://electronics.stackexchange.com/questions/4185/what-are-different-types-of-computer-architectures) .

如果您想了解一个处理器对另一个处理器的影响的历史信息，您可能会喜欢

*   [《计算机年表》](http://longstreet.typepad.com/thesciencebookstore/computer-chronology-short.html)
*   [“有史以来最具影响力的 11 款微处理器”](http://www.pcworld.com/article/171171/the_11_most_influential_microprocessors_of_all_time.html)
*   [《震惊世界的 25 个微芯片》](http://spectrum.ieee.org/semiconductors/processors/25-microchips-that-shook-the-world/0)和续集[《更多惊天动地的芯片》](http://spectrum.ieee.org/semiconductors/devices/the-runnersup-more-earthshaking-chips/0)
*   [“英特尔的 CPU 家族树”](http://cpucharts.wallsoferyx.net/intelall.html)（[镜像](http://cpucharts.info/)？）

# .net - 字符串不变性

> ID：372354
> 
> 赞同：12
> 
> 时间：2008-12-16T19:18:42.110
> 
> 标签：.net, string, immutability

字符串不变性是通过语句起作用，还是通过语句中的字符串起作用？

例如，我了解以下代码将在堆上分配两个字符串。

```
string s = "hello ";
s += "world!"; 
```

"hello" 将保留在堆上，直到垃圾收集；并且 s 现在引用“hello world！” 在堆上。但是，以下行在堆上分配了多少个字符串...1 或 2？另外，是否有工具/方法来验证结果？

```
string s = "goodbye " + "cruel world!"; 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-16T19:22:12.853

编译器对字符串连接有特殊处理，这就是为什么第二个例子只有**一个**字符串。而“实习”意味着即使你运行这条线 20000 次，仍然只有 1 个字符串。

重新测试结果......最简单的方法（在这种情况下）可能是查看反射器：

```
.method private hidebysig static void Main() cil managed
{
    .entrypoint
    .maxstack 1
    .locals init (
        [0] string s)
    L_0000: ldstr "goodbye cruel world!"
    L_0005: stloc.0 
    L_0006: ldloc.0 
    L_0007: call void [mscorlib]System.Console::WriteLine(string)
    L_000c: ret 
} 
```

如您所见 ( `ldstr`)，编译器已经为您完成了这项工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T19:26:52.953

文字字符串被[实习](http://en.wikipedia.org/wiki/String_intern_pool)，这意味着它`"hello "`不驻留在堆上，而是驻留在程序的数据段*[*^(参见注释])中（因此不符合垃圾收集的条件），同样适用于`"world"`，因为`"hello world"`它也可能被实习，如果编译器足够聪明。

`"goodbye cruel world"` *将*被实习，因为字符串文字连接是编译器处理的东西。

* * *

**编辑：**我不确定数据段声明，请参阅[此问题](https://stackoverflow.com/questions/372547/where-do-java-and-net-string-literals-reside)以获取更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T19:25:15.793

实际上，可能 3\. 一个 const 字符串表示“goodbye”，一个 const 字符串表示“cruel world”，然后一个新字符串表示结果。

您可以通过查看生成的代码来确定。这取决于编译器，（实际上，取决于语言，这并不明显）但您可以通过使用 -a 标志（我认为，查看手册页）来读取 g++ 的输出以获取中间代码.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T19:26:00.083

不要相信你对字符串的“了解”。您可能会查看源代码以了解字符串的实现。例如你的例子：

```
string s = "goodbye " + "cruel world!"; 
```

在java中会分配一个字符串。Java 玩了一些非常可爱的技巧，而且很难被超越——除非你需要，否则永远不要优化！

然而，目前，据我所知，使用这个：

```
String s="";
for(int i=0;i<1000;i++)
    s+=" "; 
```

创建一个 1000 个空格的字符串仍然往往效率极低

在循环中追加非常糟糕，但除此之外它可能与 StringBuilder 一样有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T20:13:40.563

这里要小心，因为在编译时知道字符串值时，编译器可以进行一些非常不同的优化。如果您使用的字符串直到运行时才知道（从配置文件、数据库或用户输入中提取），您将看到一些非常不同的 IL。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T20:29:18.100

如果您只是要做一两个字符串连接，我不会担心。

但是，如果你有很多连接，或者你有一个循环，那么你肯定要采取预防措施。在 Java 世界中，这意味着您使用 StringBuffer 而不是连接字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T20:44:05.167

如果不只是在一行中，则可以通过将第一个字符串放入 StringBuffer，进行连接并返回结果字符串来完成两个字符串的连接。

自己创建 StringBuffer 可能看起来有点矫枉过正，但无论如何都会发生这种情况。-

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T21:05:48.323

无论如何不要过早地优化，但不要低估字符串连接的性能有多差。这不是对象的创建，而是它导致的 GC 工作。

（ASP.NET 升级工程师）[Tess Ferrnandez 的博客上有一个实验室，它展示](http://blogs.msdn.com/tess/)[了字符串连接如何使服务器瘫痪](http://blogs.msdn.com/tess/archive/2008/02/27/net-debugging-demos-lab-4-high-cpu-hang-review.aspx)的（相当极端的，理所当然的）示例。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-16T19:22:49.823

如果编译器是“智能”的，它只会是一个带有“再见残酷世界！”的字符串。

# visual-studio - Merging vcproj files - SCM's hell

> ID：372357
> 
> 赞同：26
> 
> 时间：2008-12-16T19:19:11.033
> 
> 标签：visual-studio, version-control, merge

Merging project/solution files is a well-known disaster among developers/SCM admins performing merges in their source control.

Take, for example, a common scenario: development is done on a project/solution in two different branches. When time comes to merge back into a main development line, there is a very small resemblance between the VCPROJ's (and SLNs).

The reason is, Visual Studio may change (and DOES change) location of the various XML-like elements within these files. E.g., Configurations Debug and Release may swap order upon every save operation on the proj file. This makes it impossible to easily incorporate changes from each development branch, not even considering an automatic merge.

I can assume that Microsoft are using some perl hashing system to hold the vcproj structures, hence the rendering of the files upon a save operation is not ordered.

I'd first like to ask: did anyone found some elegant method to workaround this?

Second, I'd like to make two suggestions:

*   Have Microsoft please reimplement the above files and restrict them to some rigid ordering of elements.

*   find a tool (or write one) that sorts vcproj (xml format) and sln (sln format...) files alphabetically, recursively (all elements within elements etc.). Using this tool on both source and target files would enable to easily point (and merge) the changes, hoping that Visual Studio reads the sorted, merged project or sln file.

Any other ideas and thoughts are welcome.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T04:00:08.627

我创建了一个工具来比较和合并解决方案文件（[http://slntools.codeplex.com](http://slntools.codeplex.com)）。与“通用合并”相比，将解决方案与该工具合并要容易得多。它无法处理项目文件的想法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-14T20:46:06.673

[项目：Merge](http://www.projectmerge.com)是我用来比较和合并 XML 文件的工具。我最初写它是因为我在使用 Visual Studio 项目文件时遇到了这个问题。

它可以正确检测 XML 文件中重新排序的元素和/或属性，并自动正确解决几乎所有“冲突”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-13T15:58:53.823

检查安装选项 - 确保您的所有同事都安装了 x64 编译器组件（或都没有）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T19:24:29.477

You might want to consider associating your tool with a trigger within your SCM (like a re-commit hook for SVN), in order to enforce the re-ordering within those files.

Then you would stand a chance to efficiently merging these elements together.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T19:29:38.580

I typically try to avoid putting automatically-generated files under SCM. Automatically-generated files should be generated from source files that a developer controls, and those can be put under SCM. If a particular tool stores data in an opaque and fragile format, this is the tool's problem.

Regarding Visual Studio, although I think it has decent compilers, libraries, and a debugging environment, I believe that the files in generates (PRJ, SLN, RC) are highly problematic. Apart from the problems you mention, they also change a lot between different VS versions. For this reason, we write our own makefiles, and build the programs externally, using make. Furthermore, we split the resource files into parts for which we are forced to rely on VS, and those we can sanely handle with a normal editor. We generate many resource files automatically from high-level description, written in custom domain-specific languages. We thus minimize the impact of changes that are difficult to handle under SCM.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-25T13:38:40.043

我们对资源文件所做的（对项目文件没有那么麻烦）是在合并之前对它们进行排序。我们已经在 Plastic 上配置了合并命令，以便在合并之前实际运行排序（我们为此开发了一个不同的应用程序，如果您有兴趣，我们可以分享代码，没什么特别的），因此所有随机重定位都消失了。 .. 希望能帮助到你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-29T07:50:01.217

有一个名为 gyp 的谷歌项目，它生成 Visual Studio 解决方案和项目，非常类似于 CMake。该项目的一部分是 python 工具，用于分别对 .sln 和 .vcproj 文件的 xml 节点和属性进行排序：pretty_sln 和 pretty_vcproj。[您可以从http://gyp.googlecode.com/svn/trunk/tools/](http://gyp.googlecode.com/svn/trunk/tools/)独立下载它们

到目前为止我只看了pretty_vcproj，它还扩展了导入vcproj的.vsprop文件，可能是为了比较两个vcprojs的确切内容。虽然生成的 vcproj 不符合 Microsoft 提供的架构，但它可能会正常工作，或者可以将其更改为仅对“配置”和“平台”节点进行排序，而其他所有内容都保持不变。不确定是否值得付出努力，因为似乎已经有其他项目旨在规范化 vcprojs ......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-06T13:36:37.797

我编写了一个小的 Perl 脚本来合并解决方案文件：
[http ://blog.tedd.no/index.php/2011/01/06/merging-multiple-visual-studio-solution-sln-files-into-一/](http://blog.tedd.no/index.php/2011/01/06/merging-multiple-visual-studio-solution-sln-files-into-one/)

可以修改脚本以满足您的需要。

# .net-2.0 - Windows 98 上的 .net 2.0 sp1

> ID：372360
> 
> 赞同：0
> 
> 时间：2008-12-16T19:19:49.003
> 
> 标签：.net-2.0, windows-98

我一直在寻找这个，似乎找不到一个可靠的答案。我知道Windows98支持2.0版本的.net框架，但是包括SP1吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T19:28:14.667

[Microsoft .NET Framework Version 2.0 Redistributable Package (x86)](http://www.microsoft.com/downloads/details.aspx?familyid=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&displaylang=en)似乎 支持 Windows 98：

支持的操作系统：Windows 2000 Service Pack 3；视窗 98；Windows 98 第二版；视窗我；视窗服务器 2003；Windows XP 服务包 2

但是[Microsoft .NET Framework 2.0 Service Pack 1 (x86)](http://www.microsoft.com/downloads/details.aspx?FamilyId=79BC3B77-E02C-4AD3-AACF-A7633F706BA5&displaylang=en)没有：

支持的操作系统：Windows 2000 Service Pack 4；视窗服务器 2003；Windows XP 服务包 2

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T19:23:40.493

根据[微软的下载页面](http://www.microsoft.com/downloads/details.aspx?FamilyId=79BC3B77-E02C-4AD3-AACF-A7633F706BA5&displaylang=en)：否

> 支持的操作系统：Windows 2000 Service Pack 4；视窗服务器 2003；Windows XP 服务包 2

您也可以查看[这个](https://stackoverflow.com/questions/310246/installer-for-net-20-application-for-windows98)SO question。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T19:29:22.620

[不，不是的。](http://www.microsoft.com/downloads/details.aspx?FamilyId=79BC3B77-E02C-4AD3-AACF-A7633F706BA5&displaylang=en#Requirements)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T20:09:23.240

我认为主要区别在于 .Net 2.0 出现 (1/22/2006) 和 .Net 2.0 sp1 出现 (11/19/2007) 之间，Microsoft[终止了对 Windows 98 的所有支持](http://www.microsoft.com/windows/support/endofsupport.mspx)(7/11/2006) .

这意味着它可能会像普通的 2.0 一样工作，但不会做出任何保证，运行它需要您自担风险。

这也意味着他们不再为 Windows 98 做安全更新之类的事情，所以如果您有一个仍在运行 '98 或 ME 的特定客户，您可能会建议他们升级该机器。

# python - Set timeout for xmlrpclib.ServerProxy

> ID：372365
> 
> 赞同：24
> 
> 时间：2008-12-16T19:22:27.297
> 
> 标签：python, xml-rpc

I am using xmlrpclib.ServerProxy to make RPC calls to a remote server. If there is not a network connection to the server it takes the default 10 seconds to return a socket.gaierror to my program.

This is annoying when doing development without a network connection, or if the remote server is down. Is there a way to update the timeout on my ServerProxy object?

I can't see a clear way to get access to the socket to update it.

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-11-19T20:09:22.953

更直接的解决方案是： http: [//www.devpicayune.com/entry/200609191448](http://www.devpicayune.com/entry/200609191448)

```
import xmlrpclib 
import socket

x = xmlrpclib.ServerProxy('http:1.2.3.4')  
socket.setdefaulttimeout(10)        #set the timeout to 10 seconds 
x.func_name(args)                   #times out after 10 seconds
socket.setdefaulttimeout(None)      #sets the default back 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-01-22T11:10:29.617

干净的非全球版本。

```
import xmlrpclib
import httplib

class TimeoutHTTPConnection(httplib.HTTPConnection):
    def connect(self):
        httplib.HTTPConnection.connect(self)
        self.sock.settimeout(self.timeout)

class TimeoutHTTP(httplib.HTTP):
    _connection_class = TimeoutHTTPConnection

    def set_timeout(self, timeout):
        self._conn.timeout = timeout

class TimeoutTransport(xmlrpclib.Transport):
    def __init__(self, timeout=10, *l, **kw):
        xmlrpclib.Transport.__init__(self, *l, **kw)
        self.timeout = timeout

    def make_connection(self, host):
        conn = TimeoutHTTP(host)
        conn.set_timeout(self.timeout)
        return conn

class TimeoutServerProxy(xmlrpclib.ServerProxy):
    def __init__(self, uri, timeout=10, *l, **kw):
        kw['transport'] = TimeoutTransport(
            timeout=timeout, use_datetime=kw.get('use_datetime', 0))
        xmlrpclib.ServerProxy.__init__(self, uri, *l, **kw)

if __name__ == "__main__":
    s = TimeoutServerProxy('http://127.0.0.1:9090', timeout=2)
    s.dummy() 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-11-26T17:20:22.330

我想要一个小而干净但又明确的版本，所以根据这里的所有其他答案，这就是我想出的：

```
import xmlrpclib

class TimeoutTransport(xmlrpclib.Transport):

    def __init__(self, timeout, use_datetime=0):
        self.timeout = timeout
        # xmlrpclib uses old-style classes so we cannot use super()
        xmlrpclib.Transport.__init__(self, use_datetime)

    def make_connection(self, host):
        connection = xmlrpclib.Transport.make_connection(self, host)
        connection.timeout = self.timeout
        return connection

class TimeoutServerProxy(xmlrpclib.ServerProxy):

    def __init__(self, uri, timeout=10, transport=None, encoding=None, verbose=0, allow_none=0, use_datetime=0):
        t = TimeoutTransport(timeout)
        xmlrpclib.ServerProxy.__init__(self, uri, t, encoding, verbose, allow_none, use_datetime)

proxy = TimeoutServerProxy(some_url) 
```

起初我没有意识到`xmlrpclib`有老式的类，所以我发现它对它的评论很有用，否则一切都应该是不言自明的。

我不明白为什么`httplib.HTTP`还必须进行子类化，如果有人可以就此启发我，请这样做。上述解决方案已尝试并有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-10-27T11:46:37.323

这是适用于 Python 2.7 的代码（可能适用于 Python 的其他 2.x 版本）而不引发*AttributeError，instance has no attribute 'getresponse'*。

```
 class TimeoutHTTPConnection(httplib.HTTPConnection):
    def connect(self):
        httplib.HTTPConnection.connect(self)
        self.sock.settimeout(self.timeout)

class TimeoutHTTP(httplib.HTTP):
    _connection_class = TimeoutHTTPConnection

    def set_timeout(self, timeout):
        self._conn.timeout = timeout

class TimeoutTransport(xmlrpclib.Transport):
    def __init__(self, timeout=socket._GLOBAL_DEFAULT_TIMEOUT, *args, **kwargs):
        xmlrpclib.Transport.__init__(self, *args, **kwargs)
        self.timeout = timeout

    def make_connection(self, host):
        if self._connection and host == self._connection[0]:
            return self._connection[1]

        chost, self._extra_headers, x509 = self.get_host_info(host)
        self._connection = host, httplib.HTTPConnection(chost)
        return self._connection[1]

transport = TimeoutTransport(timeout=timeout)
xmlrpclib.ServerProxy.__init__(self, uri, transport=transport, allow_none=True) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T15:53:56.157

这是来自[http://code.activestate.com/recipes/473878/的逐字副本](http://code.activestate.com/recipes/473878/)

```
def timeout(func, args=(), kwargs={}, timeout_duration=1, default=None):
    import threading
    class InterruptableThread(threading.Thread):
        def __init__(self):
        threading.Thread.__init__(self)
        self.result = None

        def run(self):
            try:
                self.result = func(*args, **kwargs)
            except:
                self.result = default

    it = InterruptableThread()
    it.start()
    it.join(timeout_duration)
    if it.isAlive():
        return default
    else:
        return it.result 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-11-06T07:58:16.107

基于 antonylesuisse 的一个，但适用于 Python 2.7.5，解决了问题：`AttributeError: TimeoutHTTP instance has no attribute 'getresponse'`

```
class TimeoutHTTP(httplib.HTTP):
    def __init__(self, host='', port=None, strict=None,
                timeout=socket._GLOBAL_DEFAULT_TIMEOUT):
        if port == 0:
            port = None
        self._setup(self._connection_class(host, port, strict, timeout))

    def getresponse(self, *args, **kw):
        return self._conn.getresponse(*args, **kw)

class TimeoutTransport(xmlrpclib.Transport):
    def __init__(self,  timeout=socket._GLOBAL_DEFAULT_TIMEOUT, *l, **kw):
        xmlrpclib.Transport.__init__(self, *l, **kw)
        self.timeout=timeout

    def make_connection(self, host):
        host, extra_headers, x509 = self.get_host_info(host)
        conn = TimeoutHTTP(host, timeout=self.timeout)
        return conn

class TimeoutServerProxy(xmlrpclib.ServerProxy):
    def __init__(self, uri, timeout= socket._GLOBAL_DEFAULT_TIMEOUT, *l, **kw):
        kw['transport']=TimeoutTransport(timeout=timeout, use_datetime=kw.get('use_datetime',0))
        xmlrpclib.ServerProxy.__init__(self, uri, *l, **kw)

proxy = TimeoutServerProxy('http://127.0.0.1:1989', timeout=30)
print proxy.test_connection() 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-26T10:15:16.033

基于来自 antonylesuisse 的工作版本（在 python >= 2.6 上）。

```
# -*- coding: utf8 -*-
import xmlrpclib
import httplib
import socket

class TimeoutHTTP(httplib.HTTP):
   def __init__(self, host='', port=None, strict=None,
                timeout=socket._GLOBAL_DEFAULT_TIMEOUT):
        if port == 0:
            port = None
        self._setup(self._connection_class(host, port, strict, timeout))

class TimeoutTransport(xmlrpclib.Transport):
    def __init__(self, timeout=socket._GLOBAL_DEFAULT_TIMEOUT, *args, **kwargs):
        xmlrpclib.Transport.__init__(self, *args, **kwargs)
        self.timeout = timeout

    def make_connection(self, host):
        host, extra_headers, x509 = self.get_host_info(host)
        conn = TimeoutHTTP(host, timeout=self.timeout)
        return conn

class TimeoutServerProxy(xmlrpclib.ServerProxy):
    def __init__(self, uri, timeout=socket._GLOBAL_DEFAULT_TIMEOUT,
                 *args, **kwargs):
        kwargs['transport'] = TimeoutTransport(timeout=timeout,
                                    use_datetime=kwargs.get('use_datetime', 0))
        xmlrpclib.ServerProxy.__init__(self, uri, *args, **kwargs) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-12T10:36:02.727

以下示例适用于 Python 2.7.4。

```
import xmlrpclib
from xmlrpclib import *
import httplib

def Server(url, *args, **kwargs):
    t = TimeoutTransport(kwargs.get('timeout', 20))
    if 'timeout' in kwargs:
       del kwargs['timeout']
    kwargs['transport'] = t
    server = xmlrpclib.Server(url, *args, **kwargs)
    return server

TimeoutServerProxy = Server

class TimeoutTransport(xmlrpclib.Transport):

    def __init__(self, timeout, use_datetime=0):
        self.timeout = timeout
        return xmlrpclib.Transport.__init__(self, use_datetime)

    def make_connection(self, host):
        conn = xmlrpclib.Transport.make_connection(self, host)
        conn.timeout = self.timeout
        return connrpclib.Server(url, *args, **kwargs) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-18T11:05:39.927

这是另一个使用 Python语句的智能且非常**Pythonic的解决方案：**`with`

```
import socket
import xmlrpc.client

class MyServerProxy:
    def __init__(self, url, timeout=None):
        self.__url = url
        self.__timeout = timeout
        self.__prevDefaultTimeout = None

    def __enter__(self):
        try:
            if self.__timeout:
                self.__prevDefaultTimeout = socket.getdefaulttimeout()
                socket.setdefaulttimeout(self.__timeout)
            proxy = xmlrpc.client.ServerProxy(self.__url, allow_none=True)
        except Exception as ex:
            raise Exception("Unable create XMLRPC-proxy for url '%s': %s" % (self.__url, ex))
        return proxy
    def __exit__(self, type, value, traceback):
        if self.__prevDefaultTimeout is None:
            socket.setdefaulttimeout(self.__prevDefaultTimeout) 
```

这个类可以这样使用：

```
with MyServerProxy('http://1.2.3.4', 20) as proxy:
    proxy.dummy() 
```

# regex - 如何在 Perl 中将字符串拆分为两个字符的块？

> ID：372370
> 
> 赞同：35
> 
> 时间：2008-12-16T19:24:04.050
> 
> 标签：regex, arrays, perl, split

如何在 Perl 中获取一个字符串并将其拆分为一个数组，其中每个条目有两个字符长？

我试过这个：

```
@array = split(/../, $string); 
```

但没有得到预期的结果。

最终我想变成这样

```
F53CBBA476 
```

在包含的数组中

```
F5 3C BB A4 76 
```

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-12-16T19:29:49.670

```
@array = ( $string =~ m/../g ); 
```

模式匹配运算符在 Perl 的列表上下文中以一种特殊的方式运行。它迭代地处理操作，将模式与上一次匹配后的文本剩余部分进行匹配。然后列表由在每次应用模式匹配期间匹配的所有文本形成。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-12-16T21:18:35.597

如果你真的必须使用`split`，你可以做一个：

```
grep {length > 0} split(/(..)/, $string); 
```

但我认为最快的方法是`unpack`：

```
unpack("(A2)*", $string); 
```

这两种方法都有一个“优点”，如果字符串有奇数个字符，它将自己输出最后一个。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-16T22:07:09.337

实际上，要捕捉奇数字符，您需要将第二个字符设为可选：

```
@array = ( $string =~ m/..?/g ); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-05-19T16:28:15.277

传递给的模式识别*出*`split`你想要的东西。如果你想使用拆分，你会使用类似的东西

 *```
my @pairs = split /(?(?{ pos() % 2 })(?!))/, $string; 
```

或者

```
my @pairs = split /(?=(?:.{2})+\z)/s, $string; 
```

这些都是相当糟糕的解决方案。更好的解决方案包括：

```
my @pairs = $string =~ /..?/sg;  # Accepts odd-length strings.

my @pairs = $string =~ /../sg;

my @pairs = unpack '(a2)*', $string; 
```

# asp.net - 如何在数据绑定控件中使用 Eval 调用扩展方法

> ID：372382
> 
> 赞同：12
> 
> 时间：2008-12-16T19:27:18.693
> 
> 标签：asp.net, data-binding, extension-methods, late-bound-evaluation

我对 int 类型有一个简单的扩展方法，因此我可以执行以下操作：

```
string timeLength = 61.ToTime() // timeLength will be "1:01" 
```

这在代码中效果很好，但我想在中继器模板中使用这个扩展方法。数据绑定时，我想做以下事情：

```
<%# Eval("LengthInSeconds").ToTime() %> 
```

那没有用，所以我尝试了：

```
<%# ((int) Eval("LengthInSeconds")).ToTime() %> 
```

它仍然没有工作。JIT 编译器没有看到我的扩展方法，我在页面中有正确的导入语句。

我解决这个问题的唯一想法是用 Literal 控件替换 Eval 并在代码隐藏中调用扩展方法，但无论哪种方式，我仍然想知道为什么这不起作用。

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-28T08:42:47.473

我遇到了同样的问题，最终找到了解决方案。

就我而言，我忘记导入我的 Extensionmethod 类的命名空间。即使页面背后的代码包含命名空间，aspx-page 却没有。

我刚刚在 web.config 文件中添加了命名空间：

```
<pages styleSheetTheme="Default">
  <namespaces>
    <add namespace="MyNameSpace"/>
  </namespaces> 
```

瞧！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-16T19:49:23.470

看来我可以回答我自己的问题了！Asp.Net 使用 .Net 2.0 编译器编译 .aspx,.ascx 模板。我需要将以下内容添加到我的 web.config 以使其工作

```
 <system.codedom>
    <compilers>
      <compiler language="c#;cs;csharp" extension=".cs" type="Microsoft.CSharp.CSharpCodeProvider,System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" warningLevel="4">
        <providerOption name="CompilerVersion" value="v3.5"/>
        <providerOption name="WarnAsError" value="false"/>
      </compiler>
    </compilers>
  </system.codedom> 
```

我仍然需要在 Eval 中对 (int) 进行强制转换，但这至少对我来说是有意义的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-02-24T11:13:06.947

为我解决它的另一个解决方案（类似于 Patrik 的）是在该特定控件或 aspx 页面上导入命名空间。

```
<%@ Import Namespace="My.Namespace.Containing.MyExtensions.Class" %> 
```

这个解决方案更适合我的问题，因为扩展方法仅适用于一个控件中使用的类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T19:48:34.703

Eval("LengthInSeconds") 自己工作吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T08:44:13.337

命名空间声明在 web.config 文件中的 pages 元素下完成，如下所示：

```
<pages styleSheetTheme="Default">
      <namespaces>
        <add namespace="MyNamespace"/>
      </namespaces> 
```

# asp.net - ASP.NET 兼容模式下的 WCF 服务 - 传递用户名/密码的最简单方法是什么

> ID：372383
> 
> 赞同：2
> 
> 时间：2008-12-16T19:27:26.023
> 
> 标签：asp.net, wcf, web-services, security, http-headers

我有一个 Web 服务（WCF 或 ASMX 无关紧要）...我做了一个控制台应用程序，右键单击，添加了服务引用。到现在为止还挺好。

但是，我不能终生将“安全”凭据传递给我的服务。这是我的客户代码：

```
var client = new MyClient();

client.ClientCredentials.UserName.UserName = "bob";
client.ClientCredentials.UserName.Password = "123!!";

client.HelloWorld();

client.Close(); 
```

但是在服务器上，无论我做什么（打开和关闭 aspnetcompant 模式、wcf 服务、asmx 服务、自定义 http 处理程序等）......我都找不到 'bob:123!!' 任何地方。不在标头中，不在 HttpContext.Current.User.Identiy.Name 中，不在 Thread.CurrentPrincipal 中……什么都没有。

我在这里想念什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T18:00:00.600

您是否检查过这篇关于自定义验证器的文章：http: [//www.leastprivilege.com/FinallyUsernamesOverTransportAuthenticationInWCF.aspx](http://www.leastprivilege.com/FinallyUsernamesOverTransportAuthenticationInWCF.aspx)？

此外，在我处理此问题时对我有帮助的一件事是禁用对 Web 服务器的该目录的匿名访问。当您未通过身份验证时，HttpContext.Current.User.Identity.Name 始终返回一个空字符串。因此，看起来您正在正确地进行身份验证，只是无法“找到”用户名，但实际上您是匿名登录的。至少在禁用匿名访问的情况下，您会得到一个异常并且可以更容易地找出身份验证方面，这是最难的部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T15:46:34.857

是的，我有，显然如果您不使用 SSL，.Net 会引发异常。显然，如果没有 SSL，您**将无法**做我想做的事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T00:48:33.047

请参阅：http: [//developers.de/blogs/damir_dobric/archive/2006/07/31/890.aspx](http://developers.de/blogs/damir_dobric/archive/2006/07/31/890.aspx)了解有关 TransportCredentialOnly 的信息，以便能够在没有 SSL 的情况下传递用户名和密码。

这应该只在 TESTING 环境中完成，因为您以纯文本形式公开用户的密码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T11:51:00.260

您是否在端点绑定上配置了 UserName（消息安全）或 Basic（传输安全）客户端凭据类型？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T10:56:29.090

据我了解，WCF 进行消息级别身份验证，而不是集成身份验证。无论哪种情况，我都不确定传递凭据是否可以在没有 SSL 的情况下完成...

您是否尝试过在端点上打开匿名身份验证（通过 IIS）？据我了解，WCF 使用消息级别安全性（在消息头中传递的用户名/密码）而不是 HTTP 头（用于集成的身份验证方法，如 Windows Integrated、SPNego 等）

我找到的一些链接...

*   WCF 身份验证服务概述 ( [http://msdn.microsoft.com/en-us/library/bb386582.aspx](http://msdn.microsoft.com/en-us/library/bb386582.aspx) )
*   Howto：启用 WCF 身份验证服务 ( [http://msdn.microsoft.com/en-us/library/bb398990.aspx](http://msdn.microsoft.com/en-us/library/bb398990.aspx) )

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T08:21:35.573

如果我正确理解了您的问题，您已经成功地为 WCF 服务配置了用户名身份验证（抱歉 - 我将专注于 WCF）并且您希望在您的服务方法中访问用户名和密码。

您可以通过 访问用户名`ServiceSecurityContext.Current.PrimaryIdentity`，我不相信您可以轻松访问密码。

我在网上找到的一个我不太喜欢的建议是让您的自定义验证器保留用户名和密码的字典，稍后您可以在给定用户名的代码中访问该字典。

我不喜欢这个有几个原因 - 一 - 你真的不应该访问密码，二 - 我不确定这有多安全，三 - 如果可能有重复的用户名（我知道一些在这种情况下的系统）您最终可能会得到错误的系统。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-22T11:21:40.020

你试过访问这个吗？（特别是如果您使用自己的身份验证系统和自己的 UsernamePasssword 和证书验证器。

```
System.ServiceModel.ServiceSecurityContext.Current.PrimaryIdentity.Name 
```

您可以获取呼叫者的姓名，但不能获取密码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-22T11:51:44.750

[如何：使用自定义用户名和密码验证器](http://msdn.microsoft.com/en-us/library/aa702565.aspx)。

# mysql - MySQL SELECT LAST_INSERT_ID() for compound key. Is it possible?

> ID：372388
> 
> 赞同：3
> 
> 时间：2008-12-16T19:28:16.617
> 
> 标签：mysql, last-insert-id, compound-key

Can I get the LAST INSERT ID() for a compound key in MySQL?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T19:33:29.443

Yes. You can't have multiple auto-increment fields in a single table.

```
CREATE TABLE foo (
  id1 int(11) NOT NULL auto_increment,
  id2 int(11) NOT NULL default '0',
  PRIMARY KEY  (id1, id2)
);

INSERT INTO foo VALUES (DEFAULT, 2);

SELECT LAST_INSERT_ID(); -- returns 1, the value generated for id1 
```

`LAST_INSERT_ID()` returns the value only for a column declared `AUTO_INCREMENT`. There's no function to return the value in a compound primary key that *wasn't* generated by the system. You ought to know that value already, since you just gave it in an `INSERT` statement. The tricky case would be when a trigger or something overrides the value.

# c++ - 如何自动对 QTreeWidget 列进行排序？

> ID：372391
> 
> 赞同：14
> 
> 时间：2008-12-16T19:28:54.930
> 
> 标签：c++, qt, sorting, qtreewidget

我正在使用 a`QTreeWidget`来显示一些简单的项目。我已经通过`.setSortingEnabled(true)`调用设置了可排序的列表。这样，列表仅在用户按下标题列时排序，而不是在插入新项目时自动排序。

有没有办法强制在指定列中自动排序，而无需`.sortItems(column)`在每次插入项目时调用？
如果可能的话，我会突出显示整个排序的列。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-18T12:53:12.077

为此，请使用[QTreeView::setSortingEnabled()](http://doc.qt.io/qt-4.8/qtreeview.html#sortingEnabled-prop)和[QTreeView::sortByColumn](http://doc.qt.io/qt-4.8/qtreeview.html#sortByColumn)。只要记住在您最初填充小部件之后/之后/打开它，然后在/之前/进行任何批量更新以提高效率时再次关闭它。

# .net - Looking for a .NET "text" editor control

> ID：372395
> 
> 赞同：9
> 
> 时间：2008-12-16T19:29:37.393
> 
> 标签：.net, winforms, controls, textbox

My boss is looking for a .NET text control to build a custom editor on. Here’s what we need it to do:

*   Supports embedded tables, with easily editing (like Word tables).
*   Supports different text styles (font, size, color, background, etc).
*   Ability to programmatically set styles, both on first load, and as file is edited.
*   Supports key/mouse catching events and changing behavior.
*   Supports *large* documents (10's to 100's of klocs) without losing performance.
*   Not a full up word processing control, but more an advanced text control.
*   We don’t need to support .rtf, .html, etc. Instead, we need to be able to on the fly translate our data into the text editor control and back out as well, presumably by dynamically creating tables, indentation levels, etc.

We have looked at and rejected a few options including [TX Text Control](http://www.textcontrol.com/) (because its table editing is not good enough, specifically its column editing abilities)

* * *

edit:

*   must support stand alone use.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T19:37:55.333

试试[telerik的](http://www.telerik.com/)[编辑器](http://www.telerik.com/products/aspnet-ajax/editor.aspx)控件。看看[演示](http://demos.telerik.com/aspnet-ajax/Editor/Examples/Overview/DefaultCS.aspx)，看看它是否对你有好处。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T16:20:12.780

如何[在 WinForms 中托管](http://msdn.microsoft.com/en-us/library/system.windows.forms.integration.elementhost.aspx)[WPF RichTextBox](http://msdn.microsoft.com/en-us/library/system.windows.controls.richtextbox.aspx)控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-09T22:29:42.223

与 Telerik 的回答在精神上相似......您是否考虑过 DevExpress 丰富的编辑控件？他们还提供了一个不错的应用程序框架来构建您的应用程序。

# sql - 您如何进行多对多表外连接？

> ID：372399
> 
> 赞同：14
> 
> 时间：2008-12-16T19:30:31.120
> 
> 标签：sql, join, many-to-many, operator-precedence

我有 3 张桌子，foo、foo2bar 和 bar。foo2bar 是 foo 和 bar 之间的多对多映射。以下是内容。

```
select * from foo
+------+
| fid  |
+------+
|    1 |
|    2 |
|    3 |
|    4 |
+------+

select * from foo2bar
+------+------+
| fid  | bid  |
+------+------+
|    1 |    1 |
|    1 |    2 |
|    2 |    1 |
|    2 |    3 |
|    4 |    4 |
+------+------+

select * from bar
+------+-------+------+
| bid  | value | zid  |
+------+-------+------+
|    1 |     2 |   10 |
|    2 |     4 |   20 |
|    3 |     8 |   30 |
|    4 |    42 |   30 |
+------+-------+------+ 
```

我要请求的是，“给我一份所有 fid 和 zid 为 30 的值的列表”

我希望得到所有 fid 的答案，因此结果如下所示：

```
+------+--------+
| fid  | value  |
+------+--------+
|    1 |   null |
|    2 |      8 |
|    3 |   null |
|    4 |     42 |
+------+--------+ 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-16T19:39:56.030

```
SELECT * FROM foo
  LEFT OUTER JOIN (foo2bar JOIN bar ON (foo2bar.bid = bar.bid AND zid = 30))
  USING (fid); 
```

在 MySQL 5.0.51 上测试。

这不是子查询，它只是使用括号来指定连接的优先级。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-16T19:36:07.083

```
SELECT * FROM
        foo LEFT JOIN
        (
        Foo2bar JOIN bar
             ON foo2bar.bid = bar.bid AND zid = 30
        )
        ON foo.fid = foo2bar.fid; 
```

未经测试

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T19:43:06.727

解决它，您可以从您的选择开始。不要包含您最终不想看到的列。

```
SELECT foo.fid, bar.value 
```

然后我们可以做WHERE子句，可以看到正如你所说的那样。

```
SELECT foo.fid, bar.value  
WHERE bar.zid = 30 
```

现在棘手的部分是为我们的 FROM 子句连接事物，使用 LEFT JOIN，因为我们想查看每个 fid，无论是否有中间匹配：

```
SELECT foo.fid, bar.value  
FROM foo  
LEFT JOIN foo2bar ON foo.fid = foo2bar.fid  
LEFT JOIN bar ON foo2bar.bid = bar.bid  
WHERE bar.zid = 30
OR bar.zid IS NULL 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T19:47:55.373

如果您没有为 fid = 3 返回一行，那么您的服务器已损坏。

这段代码应该做我认为你想要的：

```
SELECT
    F.fid,
    SQ.value
FROM
    dbo.Foo F
LEFT OUTER JOIN
     (
     SELECT F2B.fid, B.value
     FROM dbo.Bar B
     INNER JOIN dbo.Foo2Bar F2B ON F2B.bid = B.bid WHERE B.zid = 30
     ) SQ ON SQ.fid = F.fid 
```

请记住，如果 fid 与 zid 为 30 的两个柱线相关，则可以返回两个值。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-16T23:00:29.980

FWIW，这个问题实际上并不是关于多对多：这可以很简单地作为一个工会来完成。

SQL 中真正的多对多是[CROSS JOIN](http://en.wikipedia.org/wiki/Join_(SQL)#Cross_join)

# oracle - Oracle 上动态 SQL 与存储过程的性能对比

> ID：372401
> 
> 赞同：4
> 
> 时间：2008-12-16T19:31:59.510
> 
> 标签：oracle, stored-procedures

有很多关于 SQL Server 中的缓存执行计划如何消除存储过程相对于动态 sql 的性能优势（如果不是大部分的话）的信息。但是，对于 Oracle 数据库是否也是如此，我还没有发现太多。有没有人有关于 Oracle 中动态 sql 处理的信息或指针？最好是真实的性能数字，而不是一般的“sp 很好”/“sp 很差”的讨论。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T19:35:37.723

Oracle 也有一个缓存的执行工具。如果查询命中哈希表，则查询将被哈希并匹配到计划。您还可以使用此机制来强制执行特定查询的计划。与 SQL Server 一样，您需要使用参数化查询来执行此操作，而不是将值替换到字符串中 - 因为后者将生成不同的哈希值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T22:30:11.927

Oracle 从不需要用于缓存计划的存储过程，所以这就是为什么没有太多关于它的说法。存储过程的主要性能优势是游标缓存。假设是，如果会话执行了一次 PL/SQL，则会话很有可能再次运行它。因此，当存储的 PL/SQL 代码告诉会话关闭游标时，它通常不会立即关闭它。相反，它会一直分配它，直到代码说“我需要（再次）打开这个游标”或者它需要内存。

这样做的主要好处在于 OLTP 处理，但实际数字在站点之间会有很大差异。但是请看这里的“A Parse Is a Parse Is a Parse”文章： [http ://www.oracle.com/technology/oramag/oracle/07-jul/o47asktom.html](http://www.oracle.com/technology/oramag/oracle/07-jul/o47asktom.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-04T15:10:14.987

有一种叫做客户端语句缓存的东西：[http ://www.oracle.com/technology/oramag/oracle/06-jul/o46odp.html](http://www.oracle.com/technology/oramag/oracle/06-jul/o46odp.html)

请注意，客户端结果缓存和客户端语句缓存是不同的野兽。

# c# - Code is only executing in the debugger - MS Visual C#

> ID：372409
> 
> 赞同：2
> 
> 时间：2008-12-16T19:33:46.090
> 
> 标签：c#, visual-studio-2008, deployment, catch-block

I'm using Microsoft Visual C# 2008 Express Edition. (And I apologize - this is more of a MS Vis C# usability question than a strict programming question...)

I wrote a little program. when I run it in MS VC# with the debugger, all is well. When I use the "click Once" to generate something to deploy (I'm using the "from a CD-ROM" option as opposed to "from a website) , and then I install it on my machine (or a different machine) and all is well except a piece of the code doesn't run!

The code that isn't running is the "catch" part of a try/catch loop. I intentionally have a bug I know generates an exception still in the application so I can test this catch. The catch brings up a GUI and asks the user to send data back to me. In the debugger - this works fine. In the standalone, published app, this doesn't work.

any ideas?

I point out that I'm running the "Express edition" because a friend mentioned that I might have a deployment "issue" and it appears that the Express Edition is limited in deployment options and that maybe the Standard edition is what I need... (since I can use Windows Installer instead of the "click once" publish method).

Does any of this make sense?

Appreciate the help!

-Adeena (an old command line unix C++ programmer who's struggling to make sense of this Microsoft "Visual" world)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T19:36:32.840

Is this code in the constructor/OnLoad of a form, by any chance? There are known differences in this area between with / without debugger. The fix is usually to defer the code until the UI thread is processing events. For example:

```
 protected override void OnLoad(EventArgs e)
    {
        base.OnLoad(e);
        BeginInvoke((Action)LoadStuff);
    }
    void LoadStuff()
    {
        // todo...
    } 
```

# wcf - Hitting a default RSS or ATOM Path from WCF, Client Only

> ID：372412
> 
> 赞同：0
> 
> 时间：2008-12-16T19:35:28.583
> 
> 标签：wcf, syndication

I'm trying to write a simple WCF Wrapper to load a SyndicationFeed as a client.

Contract

```
[ServiceContract]
public interface IFeedService
{
    [OperationContract]
    [WebGet(UriTemplate="")]
    SyndicationFeed GetFeed();
} 
```

Usage

```
using (var cf = new WebChannelFactory<IFeedService>(new Uri("http://channel9.msdn.com/Feeds/RSS")))
{
    IFeedService s = cf.CreateChannel();
    this.FeedItemsList.DataSource = s.GetFeed().Items;
} 
```

**Question** The problem is that the service is appending the method name to the url (ie. the above url would call [http://channel9.msdn.com/Feeds/RSS/GetFeed](http://channel9.msdn.com/Feeds/RSS/GetFeed)), and since I want this to be extended to any feed I don't always know the name of the feed. Is there an attribute or property that I can specify that will use the default endpoint address instead of appending a method name?

**Update** Adding the [WebGet(UriTemplate="")] only gets me part of the way there. It works for [http://channel9.msdn.com/Feeds/RSS](http://channel9.msdn.com/Feeds/RSS), changes it to [http://channel9.msdn.com/Feeds/RSS/](http://channel9.msdn.com/Feeds/RSS/), but it doesn't work for other feeds like [http://weblogs.asp.net/scottgu/atom.aspx](http://weblogs.asp.net/scottgu/atom.aspx) which gets changed to [http://weblogs.asp.net/scottgu/atom.aspx/](http://weblogs.asp.net/scottgu/atom.aspx/)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T20:00:29.157

我认为将 WebGetAttribute 上的 UriTemplate 更改为空字符串即可。

[http://msdn.microsoft.com/en-us/library/system.servicemodel.web.webgetattribute.uritemplate.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.webgetattribute.uritemplate.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T15:14:08.017

我认为有一种方法可以使用 OperationContext/WebOperationContext。我忘记了确切的细节，但请参见例如这个在通道上创建 OperationContextScope 的示例

[http://social.msdn.microsoft.com/forums/en-US/wcf/thread/8f9f276a-e13f-4d06-8c1e-0bb6abd8f5fe](http://social.msdn.microsoft.com/forums/en-US/wcf/thread/8f9f276a-e13f-4d06-8c1e-0bb6abd8f5fe)

此时您可以访问例如 OperationContext.Current.OutgoingMessageProperties （可能将 .Via 设置为所需的 Uri），或 WebOperationContext.Current.OutgoingWebRequest 如果您想设置 HTTP 标头或“方法”（http 动词） . 我想也许戳 OperationContext.Current.OutgoingMessageProperties.Via 可以满足您的需要。

# c++ - c++ 预期的主表达式

> ID：372428
> 
> 赞同：0
> 
> 时间：2008-12-16T19:41:28.290
> 
> 标签：c++, expression

我正在开发一个非常简单的游戏（本质上是一个冰滑拼图），现在所有东西都在一个文件中，唯一的关卡完全没有任何形式的障碍。它引发了一些错误。我目前的烦恼是预期的主要表达错误，谁能告诉我如何解决它（它在第 99 行抛出）？

这是整个事情，

```
#include <allegro.h>

BITMAP* buffer;

int x = 15;
int y = 11;

int tempX = 15;
int tempY = 11;

//This will be our background, 1 = clouds, 2 = brick, 3 = floor
int map[24][32] = {{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
                   {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}};

//This will contain all the objects, 100 = player
int objMap[24][32] = {{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}};

void setupGame(){

     buffer = create_bitmap( 640, 480);

    for (int i = 0; i <= 24; i++){

        for( int t = 0; t <= 32; t++){

            if( map[i][t] == 1) rectfill( buffer, t * 20, i * 20, (t + 1) * 20, (i + 1) * 20, makecol( 128, 255, 255));
            else if( map[i][t] == 2) rectfill( buffer, t * 20, i * 20, (t + 1) * 20, (i + 1) * 20, makecol( 255, 128, 0));
            else if( map[i][t] == 3) rectfill( buffer, t * 20, i * 20, (t + 1) * 20, (i + 1) * 20, makecol( 0, 0, 255));

           }       

    }

    for (int i = 0; i <= 24; i++){

        for( int t = 0; t <= 32; t++){

            if( objMap[i][t] == 100) circlefill( buffer, (t * 20) + 10, (i * 20) + 10, 10, makecol( 255, 255, 0));

           }       

    }

    draw_sprite( screen, buffer, 0, 0);

}

void movePlayer(){

     tempX = x;
     tempY = y;

     if ( key[KEY_UP] && map[y - 1][x] == 3){
          for ([y - 1][x] == 3; --y){  // these lines are the ones            
              }
              }

     else if( key[KEY_DOWN] && map[y + 1][x] == 3){
          for ([y + 1][x] == 3; ++y){
              }
              }

     else if( key[KEY_RIGHT] && map[y][x + 1] == 3){
          for ([y][x + 1] == 3; ++x){
              }
              }

     else if( key[KEY_LEFT] && map[y][x - 1] == 3){
          for ([y][x - 1] == 3; --x){
              }
              }

     acquire_screen();

     rectfill( buffer, tempX * 20, tempY * 20, (tempX + 1) * 20, (tempY + 1) * 20, makecol( 255, 0, 0));

     circlefill( buffer, (x * 20) + 10, (y * 20) + 10, 10, makecol( 255, 255, 0));

     draw_sprite( screen, buffer, 0, 0);
     release_screen();

     rest(20);
}

int main(){

    allegro_init();
    install_keyboard();
    set_color_depth(16);
    set_gfx_mode( GFX_AUTODETECT, 640, 480, 0, 0);

    setupGame();

    while( !key[KEY_ESC]){

           modePlayer();

    }

    return 0;

}

END_OF_MAIN(); 
```

这是中断的部分；

```
void movePlayer(){

     tempX = x;
     tempY = y;

     if ( key[KEY_UP] && map[y - 1][x] == 3){
          for ([y - 1][x] == 3; --y){              
              }
              }

     else if( key[KEY_DOWN] && map[y + 1][x] == 3){
          for ([y + 1][x] == 3; ++y){
              }
              }

     else if( key[KEY_RIGHT] && map[y][x + 1] == 3){
          for ([y][x + 1] == 3; ++x){
              }
              }

     else if( key[KEY_LEFT] && map[y][x - 1] == 3){
          for ([y][x - 1] == 3; --x){
              }
              } 
```

这是它不喜欢的 for 行。

谢谢，如果你能帮忙。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T19:50:37.710

这里发生了什么？

```
[y - 1][x] == 3 
```

你的意思是：

```
 map[y - 1][x] == 3 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T19:48:20.257

for() 语句包含由 ';' 分隔的三个部分

```
for(<init>;<test>;<post>)
{
} 
```

这三个部分中的任何一个都可以为空，但 ';' 必须在那里。

您还缺少应该在每个 for() 语句的测试部分中索引的对象。

```
for(; map[BLA][BLA] == <VALUE>;<INC>) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T19:49:06.667

这可能会有所帮助：

```
void movePlayer(){

    tempX = x;
    tempY = y;

    if (key[KEY_UP] && map[y - 1][x] == 3)
        for ( ; map[y - 1][x] == 3; --y){              
        }

    else if(key[KEY_DOWN] && map[y + 1][x] == 3)
        for ( ; map[y + 1][x] == 3; ++y){
        }

    else if(key[KEY_RIGHT] && map[y][x + 1] == 3)
        for ( ; map[y][x + 1] == 3; ++x){
        }

    else if(key[KEY_LEFT] && map[y][x - 1] == 3)
        for ( ; map[y][x - 1] == 3; --x){
        } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T19:53:49.077

您的“for”循环缺少一个部分。通常分为三个部分：初始化、条件和后迭代操作。据我所知，你有最后两个，但没有初始化。编译器当前正在解释您的第一个“for”循环，例如：

1.  对照 [y-1][x] 检查 3
2.  而 0 != (递减 y 的结果)...
3.  做任何事

我认为你的意思是：

1.  假设一切都已初始化
2.  而 3 == [y-1][x]...
3.  做任何事情，并在每次迭代后递减 y

如果是这样，这应该如下所示：

```
for (; [y-1][x]==3; --y)
{
    // do whatever
} 
```

这适用于所有“for”循环。

另一个问题是您没有使用数组变量，而只是使用索引偏移量。你是说“map[y-1][x]”吗？

# javascript - jQuery 自动完成 - 如何处理额外的数据？

> ID：372434
> 
> 赞同：6
> 
> 时间：2008-12-16T19:42:57.553
> 
> 标签：javascript, jquery, autocomplete

我正在努力解决以下问题。我使用[jQuery 自动完成插件](http://docs.jquery.com/Plugins/Autocomplete/autocomplete)从服务器获取建议值列表。该列表如下所示：

```
用户名1|用户ID1
用户名 2|用户 ID2

```

`"Username1"`因此，如果我开始键入“U” ，则会`"Username2"`按预期弹出一个列表。我可以选择第一项并且`<input>`' 的值将变为`"Username1"`，但我*真正*想要发送到服务器的是用户 ID。

我能以某种方式获取用户名后面的 ID 吗？我打算在更改文本框时进行表单发布。也许我太盲目了，无法在文档中看到它或在 Google 上找到它？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T21:39:58.550

使用插件的`result`方法来处理这个。`autocomplete`数据作为数组传递给回调，你只需要保存在`data[1]`某个地方。像这样的东西：

```
$("#my_field").autocomplete(...).result(function(event, data, formatted) {
    if (data) {
        $("#the_id").attr("value", data[1]);
    }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T19:54:44.643

我打算在这里列出一些方法，但除了一个之外都是垃圾。在服务器上执行字符串-> 用户转换，就像您为自动完成生成列表一样。

无论如何都要保持自动完成并进行 AJAX 验证，但是如果您尝试通过 JS 在表单中走私重要的表单数据（像这样），有时*会*出现问题。

此外，如果您需要处理非 js 用户代理，则需要以任何方式编写此方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-03T06:29:31.183

仅供参考，这篇文章[http://vivien-chevallier.com/Articles/use-bing-maps-rest-services-with-jquery-to-build-an-autocomplete-box-and-find-a-location-dynamically](http://vivien-chevallier.com/Articles/use-bing-maps-rest-services-with-jquery-to-build-an-autocomplete-box-and-find-a-location-dynamically)一个很好的方法是通过作者的函数 'displaySelectedItem' 来实现，该函数通过 jQuery 自动完成 'select' 事件调用（完整代码参见文章）。

干杯

马特

# asp.net - Set table cell color from database

> ID：372446
> 
> 赞同：0
> 
> 时间：2008-12-16T19:46:19.963
> 
> 标签：asp.net, html, code-behind

I'm overthinking this. I have colors stored in a database table, and I want to set the background of specific cells in a table to those colors. In other words:

```
<table>
    <tr>
        <td ???set color here???>
            ...content...
        </td>
        <td ???next color here???>
            ...next content...
        </td>
    </tr>
</table> 
```

Originally I had Panels surrounding each piece of content and I set their background color in the code-behind, which worked fine until I had varying size panels, which threw off the layout. What's the easiest way to feed the color values from the database to the `<td>` element? Note that the colors are user-configurable, so I can't have them pre-defined in a CSS file.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T19:55:01.880

You can make a custom CSS file with database data by creating a custom HttpHandler.
But the simple way woud be:

```
<td style="background-color:#000000">
...
</td> 
```

with

```
<td style='background-color:<%= GetCellColor() %>'>
...
</td> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T19:54:11.260

Why not have the DB populate the CSS?

```
.dark {
   background-color:[database field]
}

<td class='dark'></td> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T19:55:09.103

Is this a table with fixed number of rows/columns?

You might use ASP style of code here.
td backcolor="<%= MyColorProvider.FirstCellColor %>" .....

Where MyColorProvider.FirstCellColor is the string representation of color (it could be a hex string as well).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T15:22:12.830

You could output a css file fromt the database when the application starts up, and then include the css file in the master page.

# gmail - gmail中的标题用于线程提示

> ID：372449
> 
> 赞同：4
> 
> 时间：2008-12-16T19:46:41.227
> 
> 标签：gmail

有没有办法帮助 gmail 制作线程？我们目前正在使用相同的主题来执行此操作，但这确实使主题非常难看。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-16T19:51:18.270

其他邮件客户端使用一些邮件标头来帮助处理线程 - 不确定 gmail 是否支持它们。第一个是标准的 RFC-822“ `In-Reply-To: <messageid>`”，第二个是非标准的（从 Usenet 窃取的）“ `References: <messageid>,<messageid>,...`”。

# c++ - 填充向量 来自 char * 中的整数

> ID：372453
> 
> 赞同：3
> 
> 时间：2008-12-16T19:47:38.340
> 
> 标签：c++, stl, vector

```
char *values = "   3   1   4 15";

vector<int> array; 
```

我想用值填充数组，

3,1,4,15

有没有一种巧妙的方法可以使用 stl 复制算法来做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-16T19:54:11.570

确实有：

```
std::istringstream iss(values);
std::copy(std::istream_iterator<int>(iss), 
          std::istream_iterator<int>(), 
          std::back_inserter(array)); 
```

# windows - 反向 SSH 隧道监控

> ID：372462
> 
> 赞同：12
> 
> 时间：2008-12-16T19:49:27.633
> 
> 标签：windows, ssh, monitoring, tunnel

我已经使用 PuTTY 设置了一个反向 ssh 隧道，以允许我将 VNC 连接到家用计算机，而无需启用 NAT 端口转发。效果很好，没问题。

我想将隧道设置为“持久服务”，它将在启动时连接并在丢弃时重新连接。PS。这是在 Windows 上。

详尽的谷歌搜索发现了一些产品，但许多产品似乎已被放弃，而且似乎没有一个具有主要的“街头信誉”。

*   [eztunnel ssh](http://llemarie.wordpress.com/2007/11/25/programming-eztunnel-ssh-port-forwarding-made-easy/)
*   [简易隧道](http://www.easyvbapps.com/2008/07/03/easytunnel-21-out-now/comment-page-1)
*   [SSH 隧道](http://www.softpedia.com/get/Others/Miscellaneous/SSH-Tunnel.shtml)
*   [持久隧道](http://jclement.ca/software/ptunnel/)
*   [我的隧道](http://nemesis2.qx.net/software-myentunnel.php)
*   [打电话回家](http://callinghome.sourceforge.net/files.html)

有没有人有过这类事情或任何这些产品的经验？我不需要所有的花里胡哨，只需要可靠性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T20:33:20.183

[维基百科对 ssh 客户端的比较](http://en.wikipedia.org/wiki/Comparison_of_SSH_clients)有关于隧道、SOCKS 等的列，可以帮助您找到合适的东西

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-23T04:53:47.523

使用 PuTTY 中的 plink 并在批处理文件中运行。当连接真的挂掉时，plink 将退出，这意味着您可以循环运行 plink。

像这样：

```
 :: This is a batch file. Save with file name: plink_forever.bat
  :restart
  plink saved_session_name
  goto restart 
```

最后用 srvany 包装它，让它在登录时开始。

或者更简单：将 .bat 放入 Windows 调度程序并设置为每次启动时运行一次。

文档：[http ://the.earth.li/~sgtatham/putty/0.58/htmldoc/Chapter7.html](http://the.earth.li/~sgtatham/putty/0.58/htmldoc/Chapter7.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T20:21:03.373

您是否考虑过使用 plink 并将其作为[srvany](http://support.microsoft.com/kb/137890)的服务？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-04T17:50:22.807

您只需将任何应用程序设置为从 Windows 启动并在启动时自动连接您的隧道。我个人使用Easytunnel ...刚刚检查了启动时连接所有隧道的选项，并设置了启动时启动Easytunnel的窗口。它工作得很好，但您需要设置服务器的不活动超时，否则您将每 10 分钟左右断开连接。

希望你让它工作！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-03-19T03:52:09.953

我经常使用 ssh 隧道，但所有管理器都对我不方便（UI 屏幕太多，不太稳定）。我想要一个可以轻松配置和维护的脚本，所以我想出了一个 PowerShell 脚本。张贴[在这里](http://tsherlock.tech/2019/03/13/simple-ssh-tunnel-auto-reconnect-using-putty-and-powershell/)。SO规则要求我也发布解决方案作为答案，很高兴这样做：

要开始使用它，您需要这样的配置：

```
# LocalPort TargetHost  TargetPort  SshHost SshUsername SshKeyPath 
18080   google.com  80  bastion.example.com User    D:\secure\path\to\private_key.ppk 
```

将其保存为 config.csv。并使用 powershell 脚本来保持它是：

```
<#
.SYNOPSIS
  Powershell script for keeping ssh tunnel up and running

.DESCRIPTION
  This script uses configuration of tunnels located in config.csv. For more information visit http://tsherlock.tech/2019/03/13/simple-ssh-tunnel-auto-reconnect-using-putty-and-powershell/

.NOTES
  Version:        1.0
  Author:         Anton Shkuratov
  Creation Date:  2019-03-13
  Purpose/Change: Initial script development

#>

$currentDir = $PSScriptRoot
if (-not $env:PATH.Contains($currentDir)) {
  $env:PATH="$env:PATH;$currentDir"
}

# Check plink is accessible
try {
  Start-Process plink.exe -WindowStyle Hidden
} catch {
  Write-Host Error running plink.exe Please make sure its path is in PATH environment variable
  EXIT 1
}

# Parse config
$config = [System.IO.File]::ReadAllLines("$currentDir\config.csv");
$bindings = New-Object System.Collections.ArrayList
$regex = New-Object System.Text.RegularExpressions.Regex("(\d)+\s([^ ]+)\s(\d+)\s([^ ]+)\s([^ ]+)\s([^ ]+)", [System.Text.RegularExpressions.RegexOptions]::IgnoreCase);
$keyPasswords = @{}
$procs = @{}

foreach($line in $config) {
  $match = $regex.Match($line)

  if ($match.Success) {
    $sshKey = $match.Groups[6];

    $bindings.Add(@{
      LocalPort = $match.Groups[1];
      TargetHost = $match.Groups[2];
      TargetPort = $match.Groups.Groups[3];
      SshHost = $match.Groups[4];
      SshUser = $match.Groups[5];
      SshKey = $match.Groups[6];
    });

    if (-not $keyPasswords.ContainsKey($sshKey)) {
      $pass = Read-Host "Please enter password for key (if set): $sshKey" -AsSecureString
      $keyPasswords.Add($sshKey, $pass);
    }
  }
}

# Starting Processes
function EnsureRunning($procs, $keyPasswords, $binding) {

  if ($procs.ContainsKey($binding) -and $procs[$binding].HasExited) {

    $proc = $procs[$binding]
    $sshKey = $binding.sshKey
    $out = $proc.StandardError.ReadToEnd()

    if ($out.Contains("Wrong passphrase")) {
      Write-Host "Wrong pass phrase for $sshKey, please re-enter"
      $pass = Read-Host "Please enter password for key: $sshKey" -AsSecureString
      $keyPasswords[$sshKey] = $pass;
    } else {
      $exitCode = $proc.ExitCode
      $tHost = $binding.sshHost

      Write-Host "Connection to $tHost is lost, exit code: $exitCode"
    }
  }

  if (-not $procs.ContainsKey($binding) -or $procs[$binding].HasExited) {
    $sshUser = $binding.SshUser
    $sshHost = $binding.SshHost
    $sshKey = $binding.SshKey
    $lPort = $binding.LocalPort
    $tPort = $binding.TargetPort
    $tHost = $binding.TargetHost
    $sshKeyPass = [Runtime.InteropServices.Marshal]::PtrToStringAuto([Runtime.InteropServices.Marshal]::SecureStringToBSTR($keyPasswords[$sshKey]))

    $psi = New-Object System.Diagnostics.ProcessStartInfo;
    $psi.FileName = "plink.exe";
    $psi.UseShellExecute = $false;

    $psi.CreateNoWindow = $true;
    $psi.RedirectStandardInput = $true;
    $psi.RedirectStandardError = $true;

    $psi.Arguments = "-ssh $sshUser@$sshHost -i `"$sshKey`" -batch -pw $sshKeyPass -L $lPort`:$tHost`:$tPort"

    $proc = [System.Diagnostics.Process]::Start($psi);

    Start-Sleep 1

    if (-not $proc.HasExited) {
      Write-Host Connected to $sshUser@$sshHost
    }

    $procs[$binding] = $proc;
  }
}

function EnsureAllRunning($procs, $keyPasswords, $bindings) {
  while($true) {
    foreach($binding in $bindings) {
      EnsureRunning $procs $keyPasswords $binding
    }
    Start-Sleep 1
  }
}

try {
  # Waiting for exit command
  Write-Host Working... Press Ctrl+C to stop execution...
  EnsureAllRunning $procs $keyPasswords $bindings
} finally {
  # Clean up
  Write-Host Clean up

  foreach($proc in $procs.Values) {
    if ($proc -ne $null -and -not $proc.HasExited) {
      $proc.Kill();
    }
  }
} 
```

然后只需运行它：

```
powershell -File autossh.ps1 
```

要在 Windows 启动时自动启动它，请使用 Windows 调度程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-09-04T22:09:45.273

永久隧道是安全漏洞。只要您在网络上，我就已经设置了一个安全的开放服务并打开。它也有内置超时，没有活动 2 分钟，否则 10。超过 https 并且顶部有一些 XTEA 加密。可在 mylinuz.com 获得

[![截屏](https://i.stack.imgur.com/qLMw0.png)](https://i.stack.imgur.com/qLMw0.png)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-29T13:44:58.773

我有两个主要建议：

*   [Teleport](https://goteleport.com/)：很棒的工具，开源且相对易于使用
*   [Ngrok](https://ngrok.com/)：简单，做你想做的事

我建议使用其中一项服务，而不是自己做。自行设置此类设置可能很危险，因为任何错误配置都会导致攻击者获得对所有连接设备的完全访问权限。

# python - 保护在线静态内容

> ID：372465
> 
> 赞同：0
> 
> 时间：2008-12-16T19:50:23.717
> 
> 标签：python, security, apache, download, lighttpd

我如何只允许通过 Python 代码进行身份验证的用户访问服务器上的某些文件？

例如，假设我有`/static/book.txt`我想要保护的东西。当用户访问`/some/path/that/validates/him`时，Python 脚本认为他值得访问`/static/book.txt`并将他重定向到该路径。

我将如何阻止绕过脚本并直接访问的用户`/static/book.txt`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T19:54:29.793

Lighttpd为此提供了[mod_secdownload](http://redmine.lighttpd.net/wiki/lighttpd/Docs:ModSecDownload)。基本上，除非您为其生​​成短暂的静态 URL，否则它不会直接提供静态内容。

请注意，您可以在 S3 上对静态内容执行类似的操作。这是一个非常有用的功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T19:55:15.187

如果用户通过了正确的身份验证，您可能只想让您的 Python 脚本打开文件并将内容作为其输出转储。将要保护的文件放在网络服务器根目录之外的文件夹中。

# c# - Visual Studio 中的 Crystal Reports 数据源

> ID：372474
> 
> 赞同：0
> 
> 时间：2008-12-16T19:51:42.653
> 
> 标签：c#, visual-studio, crystal-reports

在默认安装 Crystal Reports 的情况下使用 Visual Studio 2005。

当我创建一个报表时，Crystal 要求提供数据库，然后我将我的开发数据库提供给它。在应用程序中，我创建了一个 DataTable 并将其传递给报告，然后将其传递给 CR 查看器。在运行时，报表对象和查看器都不需要查看数据库，因为我已经检索了表。

当应用程序交给用户时，一切正常。他们看不到开发数据库。

有一次，在生产办公室，我在生产现场创建了一个报表，我没有通过指定开发数据库来创建水晶报表，而是给它生产数据库。回到我自己的办公室，在 VS 中运行，报告尝试连接到开发数据库，​​但失败了。（它不可见。）

所以，他们看不到我的开发数据库不是问题，但我看不到生产数据库是一个问题。

问题是：出现这种情况是因为在 VS 中运行与运行已安装的应用程序不同吗？为什么报告仍然尝试连接到数据库？我该如何控制它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-17T17:48:16.357

When you create the report you should be able to do report.SetDataSouce(DataSet) and pass it your dataset that contains the tables that the report uses.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T20:20:12.300

我觉得我跟...

当您在 VS 中查看 .rpt 时，右键单击字段资源管理器窗口中的数据库字段，然后转到“设置数据源位置”。它对您的连接有何影响？它是否指向生产数据库服务器？此设置将存储在 .rpt 文件中，因此这可能会解释您的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-14T08:02:46.710

问题是：出现这种情况是因为在 VS 中运行与运行已安装的应用程序不同吗？为什么报告仍然尝试连接到数据库？我该如何控制它？

您可以根据您的报告内容进行控制

如果您的报告包含一个表格，并且您使用 DataTable 将此表格传递给您的报告，则报告将正常工作

但是当您的数据表未提供所有报告数据时，通常当您的报告包含 2 个或更多表时，报告会尝试连接到原始数据库位置

在这种情况下，您需要传递 DATASET 以报告包含所有表

这里我的代码使用 2 个表格表单作者和标题作者

```
'Build a SQL statement to query for the authors table 

Dim sqlString As String = "SELECT * FROM authors"

'Retrieve the data using the SQL statement 

adoOleDbDataAdapter = New OleDbDataAdapter(sqlString, adoOleDbConnection)

'Build a SQL statement to query for the titleauthor table 

sqlString = "SELECT * FROM titleauthor" 

'Retrieve the data using the SQL statement 

adoOleDbDataAdapter2 = New OleDbDataAdapter(sqlString, adoOleDbConnection) 

'Create a instance of a Dataset 

DataSet1 = New DataSet() 

'Fill the dataset with the data with author information 

adoOleDbDataAdapter.Fill(DataSet1, "authors") 

'Fill the dataset with the data with titleauthor information. 
'The table name used in the Fill method must be identical to the name 
'of the table in the report. 

adoOleDbDataAdapter2.Fill(DataSet1, "titleauthor") 

'Pass the dataset to the report 

crReportDocument.Database.Tables(0).SetDataSource(DataSet1) 

'View the report 

CrystalReportViewer1.ReportSource = crReportDocument 
```

# asp.net - 可以在asp.net 3.5 中用ajax 开发整个页面吗？

> ID：372475
> 
> 赞同：0
> 
> 时间：2008-12-16T19:53:46.330
> 
> 标签：asp.net, ajax

我的要求是开发一个有 4 个部分的页面，不能有回发。第 1 节. 可以在用户单击时更改的内容 第 2 节. 在线查看页面的用户列表（用户离开或访问页面时自动更新） 第 3 节. 为用户在线聊天 第 4 节. 为内容和其他功能评分第 1 节

请告诉我该怎么做？也让我知道在这种情况下是否还有其他简单的选择。考虑的选项之一是 GWT，由于整个应用程序是在 .nET 中开发的事实而被放弃

对此的任何帮助将不胜感激。愿意为此工作的自由职业者将获得丰厚的回报。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T20:03:37.950

是的，这完全可以使用 MS Ajax。

看看这本书，它描述了如何在不使用任何回发的情况下编写整个 Web 应用程序：

[http://www.amazon.com/Developing-Service-Oriented-Applications-Microsoft%C2%AE-PRO-Developer/dp/0735625913/ref=sr_1_9?ie=UTF8&s=books&qid=1229457728&sr=8-9](https://rads.stackoverflow.com/amzn/click/com/0735625913)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T20:32:01.090

这取决于您如何定义术语“回发”。当然，您可以设计整个应用程序而无需单个回发，我不确定它到底有多大用处，除非它用于文字处理或其他用途。

有些人评论说使用 UpdatePanel 没问题 - 嗯......这并不是没有回发。UpdatePanel 将整个页面回发到后台，ASP.NET 网络服务器使用整个页面生命周期处理整个页面，因此它不是严格意义上的无回发。

我有一个我编写的应用程序没有回发（如果你的意思是没有回发，没有可见的整页刷新），它使用页面的每个部分的多个 UpdatePanel 与服务器通信。您还可以使用 JavaScript XmlHttpObject 编写您自己的对服务器的 AJAX 调用 - 再一次，严格地说，这仍然是一个回发，它只是不会明显地更新用户浏览器中的整个页面。如果您使用的是 JavaScript XmlHttpObject，那么进行 Web 服务调用相当简单。

一些很好的阅读是：

*   [http://msdn.microsoft.com/en-us/library/ms972326.aspx](http://msdn.microsoft.com/en-us/library/ms972326.aspx)
*   [http://debasishpramanik.wordpress.com/2007/08/17/calling-web-service-using-xmlhttp-object/](http://debasishpramanik.wordpress.com/2007/08/17/calling-web-service-using-xmlhttp-object/)

# c++ - 如何以相当可移植的方式以编程方式检查内存使用情况？(C/C++)

> ID：372484
> 
> 赞同：15
> 
> 时间：2008-12-16T19:54:52.833
> 
> 标签：c++, memory, portability

我正在编写跨平台 C++ 代码（Windows、Mac）。有没有办法检查当前进程正在使用多少内存？一个非常人为的片段来说明：

```
unsigned long m0 = GetMemoryInUse();
char *p = new char[ random_number ];
unsigned long m1 = GetMemoryInUse();
printf( "%d bytes used\n", (m1-m0) ); 
```

当然 (m1-m0) 应该等于 random_number，但我试图在更复杂的级别上执行此操作，包括可能分配内存的库调用。

以下是不可取的：

1.  使用 Valgrind（或其同类）
2.  使用自定义内存分配器来跟踪分配的内存。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-16T20:11:07.450

这是我编写的一些代码，试图以可移植的方式执行此操作。它并不完美，但我认为它至少应该指出如何在多个平台上执行此操作。

（PS 我经常使用 OSX 和 Linux，并且知道这很好用。我很少使用 Windows，所以注意事项适用于 Windows 条款，但我认为这是正确的。）

```
#ifdef __linux__
# include <sys/sysinfo.h>
#endif

#ifdef __APPLE__
# include <mach/task.h>
# include <mach/mach_init.h>
#endif

#ifdef _WINDOWS
# include <windows.h>
#else
# include <sys/resource.h>
#endif

/// The amount of memory currently being used by this process, in bytes.
/// By default, returns the full virtual arena, but if resident=true,
/// it will report just the resident set in RAM (if supported on that OS).
size_t memory_used (bool resident=false)
{
#if defined(__linux__)
    // Ugh, getrusage doesn't work well on Linux.  Try grabbing info
    // directly from the /proc pseudo-filesystem.  Reading from
    // /proc/self/statm gives info on your own process, as one line of
    // numbers that are: virtual mem program size, resident set size,
    // shared pages, text/code, data/stack, library, dirty pages.  The
    // mem sizes should all be multiplied by the page size.
    size_t size = 0;
    FILE *file = fopen("/proc/self/statm", "r");
    if (file) {
        unsigned long vm = 0;
        fscanf (file, "%ul", &vm);  // Just need the first num: vm size
        fclose (file);
       size = (size_t)vm * getpagesize();
    }
    return size;

#elif defined(__APPLE__)
    // Inspired by:
    // http://miknight.blogspot.com/2005/11/resident-set-size-in-mac-os-x.html
    struct task_basic_info t_info;
    mach_msg_type_number_t t_info_count = TASK_BASIC_INFO_COUNT;
    task_info(current_task(), TASK_BASIC_INFO, (task_info_t)&t_info, &t_info_count);
    size_t size = (resident ? t_info.resident_size : t_info.virtual_size);
    return size;

#elif defined(_WINDOWS)
    // According to MSDN...
    PROCESS_MEMORY_COUNTERS counters;
    if (GetProcessMemoryInfo (GetCurrentProcess(), &counters, sizeof (counters)))
        return counters.PagefileUsage;
    else return 0;

#else
    // No idea what platform this is
    return 0;   // Punt
#endif
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T20:33:37.403

我已经使用[SIGAR API](http://support.hyperic.com/display/SIGAR/Home)在主要平台上非常便携地获取各种与系统相关的信息。它也是开源的（Apache）。在这些相对琐碎但乏味的工作上，真的没有必要重新发明轮子。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T19:57:27.367

*   没有便携的方法可以做到这一点。
*   对于大多数操作系统，甚至没有一种可靠的方法可以针对该操作系统进行操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T20:00:00.593

你可以使用“内存池”模式。程序中的所有对象都从这个池中分配/释放内存，这样你就可以了解你消耗了多少内存。

# git - 如何在 Git 分支中搜索文件或目录？

> ID：372506
> 
> 赞同：383
> 
> 时间：2008-12-16T20:02:03.863
> 
> 标签：git, branch

在 Git 中，我如何通过多个分支的路径搜索文件或目录？

我在一个分支中写了一些东西，但我不记得是哪一个。现在我需要找到它。

**澄清**：我正在寻找我在我的一个分支上创建的文件。我想通过路径而不是内容来查找它，因为我不记得内容是什么。

* * *

## 回答 #1

> 赞同：526
> 
> 时间：2008-12-16T22:17:50.643

`git log`+`git branch`会为您找到它：

```
% git log --all -- somefile

commit 55d2069a092e07c56a6b4d321509ba7620664c63
Author: Dustin Sallings <dustin@spy.net>
Date:   Tue Dec 16 14:16:22 2008 -0800

    added somefile

% git branch -a --contains 55d2069
  otherbranch 
```

也支持通配符：

```
% git log --all -- '**/my_file.png' 
```

单引号是必需的（至少在使用 Bash shell 时），因此 shell 将 glob 模式原封不动地传递给 git，而不是扩展它（就像 Unix 一样`find`）。

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-12-16T20:47:14.007

git ls-tree 可能会有所帮助。要搜索所有现有分支：

```
for branch in `git for-each-ref --format="%(refname)" refs/heads`; do
  echo $branch :; git ls-tree -r --name-only $branch | grep '<foo>'
done 
```

这样做的好处是您还可以使用正则表达式搜索文件名。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2013-06-01T03:13:29.743

尽管[ididak 的响应](https://stackoverflow.com/a/372654/848072)非常酷，而且*Handyman5*提供了一个脚本来使用它，但我发现使用这种方法有点受限。

有时您需要搜索可以随时间出现/消失的内容，那么为什么不搜索所有提交呢？除此之外，有时你需要一个详细的响应，而其他时候只提交匹配。以下是这些选项的两个版本。将这些脚本放在您的路径上：

**git 查找文件**

```
for branch in $(git rev-list --all)
do
  if (git ls-tree -r --name-only $branch | grep --quiet "$1")
  then
     echo $branch
  fi
done 
```

**git-find-file-verbose**

```
for branch in $(git rev-list --all)
do
  git ls-tree -r --name-only $branch | grep "$1" | sed 's/^/'$branch': /'
done 
```

现在你可以做

```
$ git find-file <regex>
sha1
sha2

$ git find-file-verbose <regex>
sha1: path/to/<regex>/searched
sha1: path/to/another/<regex>/in/same/sha
sha2: path/to/other/<regex>/in/other/sha 
```

看到使用[getopt](http://linux.die.net/man/1/getopt)您可以修改该脚本以交替搜索所有提交、参考、参考/头、冗长等。

```
$ git find-file <regex>
$ git find-file --verbose <regex>
$ git find-file --verbose --decorated --color <regex> 
```

查看[https://github.com/albfan/git-find-file](https://github.com/albfan/git-find-file)以获取可能的实现。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-16T21:31:20.377

您可以使用`gitk --all`并搜索提交“接触路径”和您感兴趣的路径名。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-05-13T14:33:04.647

复制并粘贴此以使用`git find-file SEARCHPATTERN`

打印所有搜索到的分支：

```
git config --global alias.find-file '!for branch in `git for-each-ref --format="%(refname)" refs/heads`; do echo "${branch}:"; git ls-tree -r --name-only $branch | nl -bn -w3 | grep "$1"; done; :' 
```

仅打印带有结果的分支：

```
git config --global alias.find-file '!for branch in $(git for-each-ref --format="%(refname)" refs/heads); do if git ls-tree -r --name-only $branch | grep "$1" > /dev/null; then  echo "${branch}:"; git ls-tree -r --name-only $branch | nl -bn -w3 | grep "$1"; fi; done; :' 
```

这些命令会将一些最小的 shell 脚本直接添加到您`~/.gitconfig`的[全局 git 别名](https://git-scm.com/book/tr/v2/Git-Basics-Git-Aliases)中。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2016-06-13T22:17:15.600

`find`可以在这里找到一个相当不错的Git 存储库命令实现：

[https://github.com/mirabilos/git-find](https://github.com/mirabilos/git-find)

# python - 什么是面向对象编程的计算开销成本？

> ID：372511
> 
> 赞同：2
> 
> 时间：2008-12-16T20:04:06.620
> 
> 标签：python, oop, data-analysis

我有一大组数据（一个 250,000 X 1,000 双倍的数据立方体，大约 4 gig 文件），我想使用我以前用 Python 编写的一组 OOP 类来操作它。目前，数据集已经非常大，要读入我的机器内存，我至少必须将其分成两半，因此计算开销是一个问题。我的 OOP 类创建新对象（在这种情况下，我需要 250,000 个新对象，每个对象是一个包含 1,000 个双精度数的数组）来处理数据。为通用 OOP 语言创建对象所需的内存和计算开销是多少？在蟒蛇？在 C++ 中呢？

是的，我意识到我可以创建一个新的数组类。但是 1）我已经完成了这些类，并且 2）我将创建的每个对象放回数组中，以便以后访问。这个问题是教学问题

*更新：我想在时间、我的时间和计算机上保持高效。我不想重写我已经拥有的程序，如果我不需要的话，花时间优化代码会浪费我的时间，如果我浪费计算机时间，我也*不在乎*。我实际上确实有一台带有 4Gig ram 的 64 位机器。数据是一个图像，我需要对每个像素做几个过滤器。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T20:24:58.250

对于过程/函数式编程语言，您会遇到类似的问题。你如何在内存中存储这么多数据？结构或数组也不起作用。

您需要采取特殊步骤来管理这种规模的数据。

顺便说一句：我不会以此作为选择 OO 语言或不选择的理由。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T20:48:12.727

见[http://code.activestate.com/recipes/546530/](http://code.activestate.com/recipes/546530/)

这是 Python 对象的近似大小。

OO 大小的“惩罚”通常被以下能力所抵消：（a）简化处理和（b）首先在内存中保留更少的东西。

没有 OO 性能开销。零。在 C++ 中，类定义经过优化，不存在了，剩下的就是 C。在 Python 中——像所有动态语言一样——动态编程环境增加了一些运行时查找。大多数情况下，这些是直接散列到字典中。它比编译器为您完成所有解析的代码要慢。然而，它仍然非常快，开销相对较低。

C 中的错误算法很容易比 Python 中的正确算法慢。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T21:15:02.250

有点 OT：当您处理大型数据集时，[享元设计模式](http://en.wikipedia.org/wiki/Flyweight_pattern)可用于最大限度地减少开销。在不知道您的问题的详细信息的情况下，我不确定它的适用性如何，但是值得一看...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T20:10:28.700

我认为将您的设计的任何缺点归咎于 OOP 是不公平的。就像那里的任何其他编程平台一样，OO 既可以用于良好的设计，也可以用于次优设计。这很少是编程模型本身的错。

但是要尝试回答您的问题：分配 250000 个新对象需要我知道的所有 OO 语言的一些开销，因此如果您可以通过同一实例流式传输数据，那么您可能会更好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T21:24:38.957

实际的 C++ OO 内存开销是每个具有虚拟方法的对象一个指针（4-8 个字节，具体取决于）。但是，正如其他答案中所提到的，动态分配的默认内存分配开销可能会明显大于此。

如果你在合理的情况下做事，那么与 1000*8 字节的双精度数组相比，这两种开销都不大。如果你真的担心分配开销，你可以编写自己的分配器——但是，首先检查它是否真的会给你带来显着的改进。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T20:06:48.753

如果不知道数据的形状和您为包含它而设计的结构，就无法回答。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T20:34:36.920

“开销”在很大程度上取决于您选择的平台和实现。

现在，如果您在从多个 Gb 文件中读取数百万数据时遇到内存问题，那么您将遇到算法问题，其中对象的内存消耗绝对不是最大的问题，您更关心的是如何获取、处理和存储数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T20:43:57.273

就像其他海报所说的那样。我不相信对象会给您的流程带来大量开销。它将需要存储一个指向该对象的指针，但其余的“双打”将占用程序 99% 的内存。

你能把这些数据分成更小的子集吗？您要完成的任务是什么？我很想看看你需要内存中的所有数据做什么。也许你可以序列化它，或者在 haskell 中使用惰性求值之类的东西。

请发布后续信息，以便我们更好地了解您的问题域。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-16T20:48:41.353

我不认为这个问题是来自 OO 的开销。

如果我们接受 C++ 作为 OO 语言，并记住 C++ 编译器是 C 的预处理器（至少在我使用 C++ 时曾经是），那么在 C++ 中完成的任何事情实际上都是在 C 中完成的。C 的开销很小。所以这将取决于图书馆。

我认为任何开销都来自解释、托管执行或内存管理。对于那些拥有工具和专业知识的人来说，很容易找出哪个最有效，C++ 还是 Python。

我看不出 C++ 会在哪里增加很多可避免的开销。我对 Python 了解不多。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-16T21:03:58.450

与数据集的大小相比，250K 对象的开销可以忽略不计

我认为你走错了路；不要为此责备对象;-)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-16T21:09:31.123

请定义“操纵”。如果你真的想操纵 4 场数据，为什么要立即将其全部拉入内存来操纵它？

我的意思是，谁需要 4 gig 的 RAM？:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-16T21:28:39.120

如果你必须定期处理这么大的数据集，你能不能得到一台带有大量 RAM的[64 位机器？](http://h10010.www1.hp.com/wwpc/us/en/sm/WF05a/12454-12454-296719-307907-296721-3211286.html)出于各种原因，我发现自己在使用相当资源匮乏的软件（在本例中为 SQL Server Analysis Services）。这类较旧的 64 位机器可能会占用大量 RAM，并配备 CPU，虽然不是最先进的，但仍然相当快。

我买了一些二手的惠普工作站，并为它们安装了几个快速 SCSI 磁盘。2007 年年中，这些配备 4 或 8GB RAM 和 5 个 10K 或 15K SCSI 磁盘的机器的购买成本在 1,500 至 2,000 英镑之间。磁盘成本是机器成本的一半，而且您可能不需要 I/O 性能，因此您可能不需要花这么多钱。 我购买的那种[XW9300现在可以在 ebay 上以相当便宜的价格购买——我的](http://h10010.www1.hp.com/wwpc/ca/en/sm/WF06b/12132708-12132710-12132712-12132712-12132712-12132804-77987465.html)[这篇文章介绍](https://stackoverflow.com/questions/181050/can-you-allocate-a-very-large-single-chunk-of-memory-4gb-in-c-or-c#188564)了使用 ebay 以便宜的价格获得高规格 64 位盒子的各种选择。您可以在 ebay 上将这些机器的内存升级到 16 或 32GB，而价格仅为零件标价的一小部分。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-16T21:29:24.093

我的一个朋友是麻省理工学院的教授，一个学生问他为什么他的图像分析程序运行这么慢。它是如何建造的？每个像素都是一个对象，并且会向它的邻居发送消息！

如果我是你，我会在一次性程序中尝试。我的怀疑是，除非您的类被非常仔细地编码，否则您会发现它会花费大量时间分配、初始化和取消分配对象，并且正如 Brian 所说，您可能能够通过一组假脱机数据重复使用的对象。

编辑：对不起。您说您正在重用对象，这很好。无论如何，当你让它运行时，你可以对其进行分析，或者（如果你是我的话）只是随机读取调用堆栈几次，这将回答关于时间去向的任何问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-16T21:37:35.670

由于您可以将数据分成两半并对其进行操作，我假设您正在单独处理每条记录？在我看来，您需要更改解串器以一次读取一条记录，对其进行操作，然后存储结果。

基本上你需要一个字符串解析器类，它执行一个返回字符的 Peek()，知道如何跳过空格等。围绕理解你的数据格式的类包裹一个类，你应该能够让它吐出一个对象它读取文件的时间。

# unit-testing - Rhinomocks 3.5 for dummy...即我

> ID：372531
> 
> 赞同：0
> 
> 时间：2008-12-16T20:12:31.223
> 
> 标签：unit-testing, rhino-mocks

我正在尝试使用 Rhinomocks 3.5 和新的 lambda 表示法来模拟一些测试。我读过 [这个](http://ayende.com/Wiki/Rhino+Mocks+3.5.ashx)，但还有很多问题。有没有完整的例子，特别是对于 MVC 类型的架构？

例如，模拟这个的最佳方法是什么。

```
 public void OnAuthenticateUnitAccount()
    {
        if(AuthenticateUnitAccount != null)
        {
            int accountID = int.Parse(_view.GetAccountID());
            int securityCode = int.Parse(_view.GetSecurityCode());
            AuthenticateUnitAccount(accountID, securityCode);
        }
    } 
```

有一个视图界面和一个演示者界面。它在控制器上调用一个事件。

我想出的是这个。

```
[TestMethod()]
    public void OnAuthenticateUnitAccountTest()
    {
        IAuthenticationView view = MockRepository.GenerateStub<IAuthenticationView>();
        IAuthenticationPresenter target = MockRepository.GenerateMock<IAuthenticationPresenter>();

        target.Raise(x => x.AuthenticateUnitAccount += null, view.GetPlayerID(), view.GetSecurityCode());
        target.VerifyAllExpectations();
    } 
```

它通过了，但我不知道它是否正确。

是的，我们正在开发后进行测试……需要快速完成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T20:35:24.297

我假设这是在您的一个控制器中。此外，我假设您可以通过构造函数或设置器传递视图数据，并且您可以注册 AuthenticateUnitAccount 处理程序。鉴于此，我会执行以下操作：

```
[TestMethod]
public void OnAuthenticateUnitAccountSuccessTest()
{
    IAuthenticationView view = MockRepository.GenerateStub<IAuthenticationView>();
    view.Stub( v => GetPlayerID() ).Returns( 1 );
    view.Stub( v => GetSecurityCode() ).Returns( 2 );

    FakeAuthenticator authenticator = MockRepository.GenerateMock<FakeAuthenticator>();
    authenticator.Expect( a => a.Authenticate( 1, 2 ) );

    Controller controller = new Controller( view );
    controller.AuthenticateUnitAccount += authenticator.Authenticate;

    controller.OnAuthenicateAccount()

    authenticator.VerifyAllExpectations();
} 
```

FakeAuthenticator 类包含一个与处理程序签名匹配的 Authenticate 方法。因为您需要知道是否调用了此方法，所以您需要模拟它而不是存根它以确保使用正确的参数等调用它。您会注意到我直接调用该方法而不是引发事件. 由于您只需要在这里测试您的代码，因此无需测试引发事件时会发生什么。您可能想在其他地方进行测试。在这里，我们只想知道使用正确的参数调用正确的方法。

对于失败，您可以执行以下操作：

```
[TestMethod]
[ExpectedException(typeof(UnauthorizedException))]
public void OnAuthenticateUnitAccountFailureTest()
{
    IAuthenticationView view = MockRepository.GenerateStub<IAuthenticationView>();
    view.Stub( v => GetPlayerID() ).Returns( 1 );
    view.Stub( v => GetSecurityCode() ).Returns( 2 );

    FakeAuthenticator authenticator = MockRepository.GenerateMock<FakeAuthenticator>();
    authenticator.Expect( a => a.Authenticate( 1, 2 ) )
                 .Throw( new UnauthorizedException() );

    Controller controller = new Controller( view );
    controller.AuthenticateUnitAccount += authenticator.Authenticate;

    controller.OnAuthenicateAccount()

    authenticator.VerifyAllExpectations();
} 
```

# iphone - 横向的 UITextField

> ID：372537
> 
> 赞同：0
> 
> 时间：2008-12-16T20:14:16.663
> 
> 标签：iphone, objective-c, cocoa-touch

对于我的生活，我无法弄清楚我应该如何设置`UITextField`垂直显示文本（横向模式）而不是水平显示文本（纵向模式）。键盘显示正确，但是当按下按键时，输入的文本方向错误。

这是[窗口的屏幕截图](http://img74.imageshack.us/my.php?image=picture11zj8.png)

这是视图控制器的代码

```
#import "HighScoreViewController.h"

@implementation HighScoreViewController

 //Implement loadView if you want to create a view hierarchy programmatically
- (void)loadView {

    UIView *contentView = [[UIView alloc] initWithFrame:[[UIScreen mainScreen] applicationFrame]];
    contentView.backgroundColor = [UIColor whiteColor];
    contentView.autoresizesSubviews = YES;
    contentView.autoresizingMask = (UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight);    
    self.view = contentView;
    [contentView release];

    self.view.backgroundColor = [UIColor blackColor];

    CGRect frame = CGRectMake(180.0, 7, 27.0, 120);
    UITextField * txt = [[UITextField alloc] initWithFrame:frame];

    txt.borderStyle = UITextBorderStyleBezel;
    txt.textColor = [UIColor blackColor];
    txt.font = [UIFont systemFontOfSize:17.0];
    txt.placeholder = @"<enter name>";
    txt.backgroundColor = [UIColor whiteColor];
    txt.autocorrectionType = UITextAutocorrectionTypeNo;    // no auto correction support
    //txt.delegate = self;
    txt.keyboardType = UIKeyboardTypeDefault;   // use the default type input method (entire keyboard)
    txt.returnKeyType = UIReturnKeyDone;

    txt.clearButtonMode = UITextFieldViewModeWhileEditing;  // has a clear 'x' button to the right

    txt.text = @"test";

    [self.view addSubview:txt];
    [txt release];
}

- (BOOL) shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {

    return (interfaceOrientation == UIDeviceOrientationLandscapeRight);
}

@end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T20:25:50.447

iPhone OS 通过对视图应用变换来处理方向变化。您是否在应用自己的可能会干扰的转换？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T20:35:51.283

我们在应用启动时通过 setStatusBarOrientation 手动设置状态栏方向。

-杰里米

# itextsharp - ITextSharp 并将富文本放在特定位置

> ID：372542
> 
> 赞同：1
> 
> 时间：2008-12-16T20:16:32.713
> 
> 标签：itextsharp

我使用 Adob​​e LiveCycle 创建了一个 pdf 文档。我面临的问题是我需要在文档的特定位置添加一些格式化文本。

我怎样才能做到这一点？

```
 overContent.BeginText();
    overContent.SetTextMatrix(10, 400);
    overContent.ShowText("test"); 
```

这只会在指定的位置添加基本文本，我真的需要在文档中添加换行符、项目符号等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-25T20:19:48.413

我在 Java 中使用 iText，也遇到了类似的情况。我只是想用非格式化文本插入一个简单的换行符。换行符 (\n) 不会飞。我想出的解决方案（它并不漂亮）是：

```
// read in the sourcefile
reader = new PdfReader(path + sourcefile);

// create a stamper instance with the result file for output
stamper = new PdfStamper(reader, new FileOutputStream(path + resultfile));

// get under content (page)
cb = stamper.getUnderContent(page);
BaseFont bf = BaseFont.createFont();

// createTemplate returns a PdfTemplate (subclass of PdfContentByte)
// (width, height)
template = cb.createTemplate(500, 350);

Stack linelist = new Stack();
linelist.push("line 1 r");
linelist.push("line 2 r");
linelist.push("line 3 r");
int lineheight = 15;
int top = linelist.size() * lineheight;

for (int i = 0; i < linelist.size(); i++) {
    String line = (String) linelist.get(i);
    template.beginText();
    template.setFontAndSize(bf, 12);
    template.setTextMatrix(0, top - (lineheight * i));
    template.showText(line);
    template.endText();
}

cb.addTemplate(template, posx, (posy-top));
stamper.close(); 
```

1.  我将我的行分成一个数组/堆栈/列表
2.  我循环遍历该列表和 setText 一次一行

必须有更好的方法，但这适用于我的情况（暂时）。

# java - Java 和 .NET 字符串文字驻留在哪里？

> ID：372547
> 
> 赞同：29
> 
> 时间：2008-12-16T20:18:29.977
> 
> 标签：java, .net, string-literals, string-table

最近[一个关于](https://stackoverflow.com/questions/372354/string-immutability).NET 中字符串文字的问题引起了我的注意。我知道字符串文字是[实习](http://en.wikipedia.org/wiki/String_intern_pool)的，因此具有相同值的不同字符串引用同一个对象。我也知道可以在运行时实习字符串：

```
string now = DateTime.Now.ToString().Intern(); 
```

显然，在运行时实习的字符串驻留在堆上，但我假设文字被放置在程序的数据段中（并在我对上述问题的[回答](https://stackoverflow.com/questions/372354/string-immutability#372380)中这么说）。但是我不记得在任何地方看到过这个。我认为是这种情况，因为我会这样做，并且`ldstr`IL 指令用于获取文字并且似乎没有发生分配的事实似乎支持了我。

长话短说，字符串字面量在哪里？它是在堆上、数据段上还是我没有想到的某个地方？

* * *

**编辑：**如果字符串文字*确实*驻留在堆上，它们是什么时候分配的？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-12-16T20:22:05.710

.NET 中的字符串是引用类型，因此它们总是在堆上（即使它们被实习）。您可以使用诸如 WinDbg 之类的调试器来验证这一点。

如果你有以下课程

```
 class SomeType {
      public void Foo() {
         string s = "hello world";
         Console.WriteLine(s);
         Console.WriteLine("press enter");
         Console.ReadLine();
      }
   } 
```

你调用`Foo()`一个实例，你可以使用 WinDbg 来检查堆。

引用很可能存储在小程序的寄存器中，因此最简单的方法是通过执行`!dso`. 这为我们提供了相关字符串的地址：

```
0:000> !dso
OS Thread Id: 0x1660 (0)
ESP/REG  Object   Name
002bf0a4 025d4bf8 Microsoft.Win32.SafeHandles.SafeFileHandle
002bf0b4 025d4bf8 Microsoft.Win32.SafeHandles.SafeFileHandle
002bf0e8 025d4e5c System.Byte[]
002bf0ec 025d4c0c System.IO.__ConsoleStream
002bf110 025d4c3c System.IO.StreamReader
002bf114 025d4c3c System.IO.StreamReader
002bf12c 025d5180 System.IO.TextReader+SyncTextReader
002bf130 025d4c3c System.IO.StreamReader
002bf140 025d5180 System.IO.TextReader+SyncTextReader
002bf14c 025d5180 System.IO.TextReader+SyncTextReader
002bf15c 025d2d04 System.String    hello world             // THIS IS THE ONE
002bf224 025d2ccc System.Object[]    (System.String[])
002bf3d0 025d2ccc System.Object[]    (System.String[])
002bf3f8 025d2ccc System.Object[]    (System.String[]) 
```

现在使用`!gcgen`来找出实例在哪一代：

```
0:000> !gcgen 025d2d04 
Gen 0 
```

它处于零代——即它刚刚被分配。谁在扎根？

```
0:000> !gcroot 025d2d04 
Note: Roots found on stacks may be false positives. Run "!help gcroot" for
more info.
Scan Thread 0 OSTHread 1660
ESP:2bf15c:Root:025d2d04(System.String)
Scan Thread 2 OSTHread 16b4
DOMAIN(000E4840):HANDLE(Pinned):6513f4:Root:035d2020(System.Object[])->
025d2d04(System.String) 
```

ESP 是我们`Foo()`方法的堆栈，但请注意我们也有一个`object[]`。那是实习生表。让我们来看看。

```
0:000> !dumparray 035d2020
Name: System.Object[]
MethodTable: 006984c4
EEClass: 00698444
Size: 528(0x210) bytes
Array: Rank 1, Number of elements 128, Type CLASS
Element Methodtable: 00696d3c
[0] 025d1360
[1] 025d137c
[2] 025d139c
[3] 025d13b0
[4] 025d13d0
[5] 025d1400
[6] 025d1424
...
[36] 025d2d04  // THIS IS OUR STRING
...
[126] null
[127] null 
```

我稍微减少了输出，但你明白了。

**总之**：字符串在堆上 - 即使它们被实习。实习表保存对堆上实例的引用。即在 GC 期间不收集实习字符串，因为实习表将它们作为根。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-16T20:38:19.843

在 Java 中（来自[Java 词汇表](http://mindprod.com/jgloss/interned.html#UNDERTHEHOOD)）：

> 在 Sun 的 JVM 中，内部字符串（包括字符串文字）存储在称为 perm gen 的特殊 RAM 池中，JVM 还加载类并存储本地编译的代码。但是，intered String 的行为与它们存储在普通对象堆中的行为没有什么不同。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T20:21:27.850

如果我错了，请纠正我，但在 Java 和 .NET 中并非所有对象都驻留在堆上？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T20:23:21.620

在 .Net 中，“实习”时的字符串文字存储在称为“实习表”的特殊数据结构中。这与堆和堆栈是分开的。然而，并不是所有的字符串都被保留了......我很确定那些不是存储在堆上的。

不了解Java

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T07:08:04.037

我在 MSDN 的网站上发现了这个关于[`ldstr`IL 指令](http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.ldstr.aspx)的内容：

> 该`ldstr`指令将对象引用（类型 O）推送到表示存储在元数据中的特定字符串文字的新字符串对象。该`ldstr`指令**分配必要的内存量**并执行将字符串文字从文件中使用的形式转换为运行时所需的字符串格式所需的任何格式转换。
> 
> 公共语言基础结构 (CLI) 保证引用两个具有相同字符序列的元数据标记的 ldstr 指令的结果返回完全相同的字符串对象（称为“字符串实习”的过程）。

这意味着字符串文字实际上存储在 .NET 的堆中（与[mmyers](https://stackoverflow.com/users/13531/mmyers)[指出](https://stackoverflow.com/questions/372547/where-do-java-and-net-string-literals-reside#372610)的Java 不同）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T20:44:54.760

在 Java 中，像所有对象一样的字符串都驻留在堆中。只有局部原始变量（整数、字符和对对象的引用）驻留在堆栈中。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-17T13:53:37.680

Java 中的实习字符串位于一个单独的池中，称为字符串池。该池由 String 类维护并驻留在普通堆上（不是上面提到的用于存储类数据的 Perm 池）。

据我了解，并非所有字符串都是实习的，但调用 myString.intern() 会返回一个字符串，该字符串由字符串池保证。

另请参阅： [http](http://www.javaranch.com/journal/200409/ScjpTipLine-StringsLiterally.html) ://www.javaranch.com/journal/200409/ScjpTipLine-StringsLiterally.html 和 javadoc [http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String .html#intern()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#intern())

# labview - LabVIEW的哪些特定功能让您感到沮丧？

> ID：372557
> 
> 赞同：17
> 
> 时间：2008-12-16T20:21:44.167
> 
> 标签：labview

请耐心等待：这不是语言辩论或火焰。这是一个真正的征求意见。

有时，我必须帮助教育传统的文本编码人员如何在 LabVIEW (LV) 中进行思考。在这个过程中，我经常会听到关于 LV 的糟糕之处。除了“语言 X 好得多！”之外，这种洞察力很少伴随理性观察。虽然这句话让他们满意，但它并不能帮助我理解是什么让他们感到沮丧。

那么，对于那些有 LabVIEW*和*文本语言经验的人来说，关于 LV的哪些**具体内容让您抓狂？**

------ 总结------

感谢所有的答案！有些问题在下面的评论中得到了回答，有些在其他网站上存在，有些只是 LV 的真正问题。本着最初问题的精神，我不打算在这里回答所有这些问题：查看[LAVA](http://www.lavag.org)或[NI](http://www.ni.com/labview)的网站，你会惊喜地发现其中有多少是可以克服的。

*   无意并发
*   无法使用传统的文本操作工具
*   仅二进制源代码控制
*   难以分支和合并
*   打开的窗户太多
*   文本具有更清晰/更清晰/更具表现力的语法
*   干净的编码需要大量的时间和操作
*   大型、难以访问的 API/调色板系统
*   需要鼠标
*   文件命名空间：内存中没有同名的重复文件
*   LV 对象本身只是按值的
*   需要开发环境才能查看代码
*   缺乏变焦
*   启动缓慢
*   记忆猪
*   “巨型”代码难以使用
*   UI锁定很容易做到
*   触控板和 LV 不能很好地混合
*   字符串操作在图形上很臃肿
*   有限的 UI 定制
*   “隐藏”原语（是的，这些存在）
*   缺乏官方元编程能力（不过不会太久）
*   缺乏 unicode 支持

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-07T15:31:13.897

LabVIEW 使*实现*并发/并行编程更容易、更真实。然而，它并*没有*使调试、测试或*考虑*并发/并行性变得更容易。您仍然可以在 LabVIEW 中编写错误的并发代码，并且（与*任何*语言、平台或工具集一样）没有灵丹妙药或魔杖可以让并发“正常工作”。

如果有的话，您必须更加小心并发性，因为如果您不明确考虑（并声明）它，LabVIEW 可能会使事情发生您不希望的并发。

其他牛肉：这不是文字。以一种有意义的方式表示数据流意味着一种图形语言，这意味着您不能使用我们几十年来拥有的工具来操作文本，从 sed 到 emacs。这也意味着源代码控制应用程序必须将您的代码视为不透明的二进制文件，而不是...源代码。反过来，这使得分支和合并成为一种痛苦的练习。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-11T19:11:34.660

我在很多方面都欣赏 LabView，尤其是轻松驱动硬件的能力（当然，当它是 National Instruments 的硬件时），以及并发编程功能。但是在代码导航中对基于文本的编程语言很糟糕：

*   当你浏览代码时，你最终会打开大量的窗口，因为你一次又一次地打开 subVis
*   因为文字比图标更具表现力，与文本语言相比，你在一个屏幕上看到的指令更少，尤其是在表现力语法中，如 python
*   没有我们在其他语言中所知道的异常处理；错误以结构表示，从一个 VI 传输到另一个 VI，您必须为每个 VI 添加一个`if error return; else do stuff`代码。
*   当出现错误时，调试期间无法停止

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-16T20:53:43.837

Labview is great for controlling hardware. I have written several Labview apps for collecting data (analog voltage from various sensors) and control hardware (mostly piezoelectric motors). Labview makes it fairly easy to perform several tasks in parallel.

Now to answer your question. What do I find frustrating about Labview.

1.  Time spent organizing block diagram

    *   moving wires around
    *   organizing nodes

    Perhaps, since I am self taught I spend too much time trying to clean up wires and trying to follow them in an attempt to deciphers what data they are carrying and where it is going.

2.  Point and clicking through the toolbox thing looking for the node/function that I want to place in the block diagram or front panel.

I should just be able to type the name of the function/method I need with the parameters and get going instead of...

> "hmmm... I need the calculate RMS vi now where would that be? now I need an AND operation. OK back up to top level, to logical functions, which one of these is AND oh right it's that one. Drop on diagram wire it up and test! Well that only took 15 minutes!."

But there probably is a more efficient way to work with Labview, I just don't know it!

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-11T10:03:10.723

1.LabVIEW objects are not passed by reference.
2.No other viewer exist(especially free one) for viewing the block diagrams.
3\. Need to open up a large number of windows to view a project. Would like it to be MDI so that number of windows gets reduced.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-16T21:12:34.393

The thing I was most frustrated with was that it took my hands off the keyboard. I'm a touch typist, and can code fairly quickly in a text language. LabVIEW forces you to use the mouse to select VIs and program nodes from its menus, and to wire the nodes together. While this is really fast and convenient if you're an electrical engineer, used to designing circuits in a graphical environment, it's a pain if you're used to typing in your code.

* * *

Disclosure: It's been about two years now since I last used LabVIEW, so these next two may be fixed by now.

The next annoyance was source control. One of the things you do most often with your source control repository is diff your current version with a previous version to find the changes. You can't do that with a graphical language like LabVIEW. Popular revision control systems like CVS and SVN use text-based diff tools behind the scenes. I hope National Instruments has come up with their own revision control solution for all of you guys who are still using LabVIEW.

The last annoyance I had was a lack of real object-oriented language features. LabVIEW 6i, the last version I used, was object-*based* at best. No one could really make an accurate claim that it was object-oriented. I couldn't create a real class hierarchy using inheritance, and polymorphism was reserved for only a few built-in types. I realize that 6i was two versions ago, so I really hope that this is fixed.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-12-08T04:41:37.150

**GUI 中缺乏 Unicode 支持**

这使我们日本公司的发展变得困难。

**更新：**显然在 8.6 中有一些支持。请参见[在 LabVIEW 中使用 Unicode 的技巧和工具列表](http://decibel.ni.com/content/docs/DOC-10153)。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-20T22:19:36.230

*   几十扇打开的窗户是一种绝对的痛苦。
*   由具有更大显示器的人编辑的 vi 必须调整大小。
*   UI 在处理其他东西时会暂时锁定（也许我还没有弄清楚 labview 的多线程潜力）
*   在带有触控板的笔记本电脑上编辑是可怕的，（不要忘记小显示器问题）。
*   复杂的字符串操作需要数英亩的空间（方程有一个函数节点，为什么不是字符串操作的正则表达式节点？）
*   我有时会在其他人的代码中找到我在菜单中任何地方都找不到的原始 vi。
*   UI 只能定制到一个点。

我想补充一点，我认为labview 非常强大且设计精良。我很少遇到让我希望我有不同的语言的东西。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-23T00:24:47.087

**缺乏差异和合并**（“专业”许可除外）

我们在工作中使用 SVN 和 TortoiseSVN。我很沮丧，我无法通过差异来查看文件中发生了什么变化。在使用 SVN 时，做“差异”是日常工作流程的一部分，所以看到文件发生了变化是令人沮丧的，但不知道它是微不足道的还是重要的。做差异也可以系统地审查变化。

我听说“专业”有某种差异工具。不过，我很难说服管理层我们需要专业人士来实现“差异”功能。而且我无法确定地阅读它实际上与 TortoiseSVN 顺利集成。

使用源代码控制被认为是行业最佳实践之一，因此 NI 完全支持它会很好，而不仅仅是在“专业”许可证中，以免 NI 被视为阻碍采用最佳实践。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-06T17:34:14.883

无法放大和缩小框图。是的，设计应该保持在一个屏幕上或只向一个方向滚动，但我从第三方供应商那里获得了代码，他们必须使用 50 英寸显示器进行开发——代码在各个方向上永远存在！

（2009 年 1 月 23 日）：使用**View->Navigation Window**查看整个图表（前面板和图表面板）的鸟瞰图。当 LabVIEW 决定将根据程序框图创建的新控件放置在前面的随机位置时，这可能很有用。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-05-12T16:20:39.917

就个人而言，我认为 LabView 是一个出色的程序，它的设计目的是。除了继承糟糕的代码（这在任何语言中都是一个问题）之外，通过良好的实践，它可以非常有效且快速地将各种过程控制、自动化、测试和测量系统组合在一起。与文本编码一样，LabView 也存在良好的实践——如果你有一个乱七八糟的 VI，那么这真的是编码器的错，而不是语言的错。文本编码的语言也会变得非常混乱 - 程序员有责任不创建不必要的混乱或混淆代码。

如果您开始编写代码时考虑到未来的扩展，那么创建可以随程序需求增长而不会变得麻烦的 VI 一点也不难。就像糟糕的文本代码很快就会变得一团糟，如果你用短期的眼光来破解它，只会让它自己长大并变得无法维护。但是，这确实意味着您必须花时间学习 LabView，就像您必须花时间学习任何语言或 IDE 一样。

如果 LabView 让您的工作受挫，您可能应该使用其他东西来创建程序，或者至少为程序的这些组件使用其他东西。

例如，如果你需要做大量的字符串处理——比使用 LabView 的字符串函数更方便破解——但你真的想要或需要使用 LabView 来处理你的应用程序，那么有很多选项可供你选择. 您可以轻松地用 C 或任何您喜欢的语言编写 DLL，然后通过 LabView 的 DLL 接口访问这些函数。这适用于使用基本 LabView 工具难以实现的任何类型的高级或抽象功能。

这有两大优势 - 首先，您可以将文本编码集中在简单地编写函数或过程上。围绕您的函数构建应用程序的任务变得不存在。通过将它与 LabView 混合，您可以获得 LabView 快速而强大的 UI 构建器和仪器连接的第二个优势。

在源代码控制方面，您可以做的最大的事情就是发挥 LabView 固有的模块化能力。虽然您没有文本工具来帮助您，例如在尝试整理未知的继承代码时，但它确实具有其他非常强大的功能，这些功能以抽象的方式可以做许多相同的事情。它可能是现存的最容易重构的语言，这意味着，一般来说，重构继承的代码可以在您学习它的作用时完成。

例如，如果您转到数据源并断开线路，您会立即看到它连接到的所有内容。错误列表将为您提供因依赖该数据源而损坏的所有内容的完整列表，您可以立即创建包和集群以清理 LabView 意大利面条。它甚至会在后面板上突出显示损坏的数据连接，以便您跟踪所有内容的去向。如果很明显它们在主进程中乱扔垃圾等，您可以快速将它们封装在子 VI 中。当您弄清楚代码的作用时，它已经干净整洁并且突然可以重新维护。

最大的例外是程序使用了很多不必要的全局变量。惊喜 - 全局变量也使 LabView 中的事情变得复杂。在那种情况下，除了诅咒让你一团糟的笨蛋，别无他法。尽管如此，这还不是世界末日。

我想，简而言之，我想说的是 LabView 是一种非常不同的语言。如果这看起来令人沮丧，那并不是因为没有工具来完成您在文本编码中习惯的事情，而仅仅是因为它们通常以完全不同的方式实现。例如，Grepping 代码本身并不是目的，而只是达到目的的一种手段——目的是发现整个程序的链接和引用。虽然您无法 grep LabView 代码，但您可以发现链接和参考资料——只是以完全不同的方式完成。学习曲线的东西。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-12-16T20:36:46.820

我写了一个程序（用 C++）从计算机控制一个 rs232 设备，但被要求为 labview 提供驱动程序或 Vi 或任何东西。我满怀信心地下载了labview，相信我可以在短时间内完成一些事情。（我是常春藤学校的计算机科学专业毕业生，使用 C++ 编程 15 年，学习和使用过 C、Scheme、C#、Java 等 - 这应该是显而易见的）

我还下载了 labview 的示例应用程序和文档。

我被结果吓坏了。Labview 是巨大的、缓慢的和不直观的。它不遵循我在 MFC 或 Visio 或 Rational Rose 或 VB 等方面习惯的范式。试图找到正确的文档也是一个艰难的经历。那里有太多东西需要了解 Labview 才能知道从哪里开始。

这是一个可以做很多事情的大型程序。没有人教你如何使用它是非常困难的。我自学了很多东西，但到目前为止，labview 让我望而却步。（当然我没有花尽可能多的时间在这上面，但到目前为止这是一次令人沮丧的经历）

总而言之——它巨大、缓慢且不直观。文档是压倒性的。

（我仍然希望有一天能完成这个项目）

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-13T03:22:11.380

一项高于一切：

**缺乏进行测试驱动开发的工具**

如果我能说一说，现在这已经是一件大事了，因为我不写测试就不会去洗手间。

编辑:: 我把它全部收回，看看[http://forums.jkisoft.com/index.php?showtopic=973](http://forums.jkisoft.com/index.php?showtopic=973)。到目前为止效果很好！

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-20T22:43:23.217

一个功能漏洞：IIRC 没有元编程工具可言。它非常适合构建东西，只要您构建的任何东西都处于 LV 设计师认为您想要的抽象级别。

在过去的 20 年里，我已经（通常）移动到越来越高的抽象级别。大约有一年的时间，LV 很整洁，因为它比我使用的略高。然后我就吹过去了，LV看起来一年比一年老。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-07T21:44:08.467

关于LabVIEW的“图形差异”的说明：

LabVIEW 不能同时在内存中拥有同名 VI 的多个副本。

在 8.5 版之前，这意味着如果我想区分我的 VI.vi 版本 2 和版本 1，我必须（手动）创建一个不同名称的副本，打开它，然后告诉 LabVIEW 将它与我的比较原来的。

我的理解是，他们在 8.5 中自动化了这个过程，为您提供了一个 3 路合并工具。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-12-27T09:20:43.647

阿齐姆，

您会对 8.6 版感到满意，它有两个可以解决您的挫败感的功能：

*   自动清理图表
    清理杂乱代码的工具。
    但是请注意，此工具不应用于干净的代码（[LAVA](http://forums.lavag.org/86-Block-Diagram-Cleanup-Comparisons-t11906.html&st=15&start=15)和[NI 论坛](http://forums.ni.com/ni/board/message?board.id=170&view=by_date_ascending&message.id=373796#M373796)）。
*   Quick Drop
    使用键盘快捷键选择节点和 VI 的工具，[Youtube 上](http://www.youtube.com/watch?v=UXsWlJT1hLQ)的视频显示了快速拖放操作。1:07 之后，您会看到自动清理工具。

蒂姆，你的意思是什么

> Labview 巨大、缓慢且不直观

如果您有示例和改进，请告知。
如果您在构建驱动程序时遇到问题，请查看随附的驱动程序（例如万用表）。尝试找到带有驱动程序的类似仪器并根据需要对其进行调整，我确信 NI 愿意帮助您或其他人愿意。将您的问题带到[LAVA](http://www.lavag.org "独立论坛")或[NI 论坛](http://forums.ni.com "官方支持论坛")。
LabVIEW 使用的不同范式（数据流）可能是并行编程的解决方案（至少 NI 是这样告诉我们的），Visio 不是编程语言，很抱歉爆料。使用初学者书籍（适用于所有人的 LabVIEW）是一个很好的开始。

吨

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-12-29T00:56:16.783

Labview 可用于创作大型、复杂的软件项目。Labview 无疑比基于语法的语言更有趣。我使用labview编写了数学密集的动态模拟程序。较新版本的 Labview 包含许多令人兴奋的功能，尤其是在使用多个处理器方面。我非常喜欢 Labview。但我不推荐给任何人。

不幸的是，除了简单的采集和显示之外，这绝对是一场噩梦。有朝一日，它可能会得到充分发展，被视为基于文本的语言的可行替代方案。然而，NI 的开发人员一直选择忽略困扰 labview 的三个基本问题。

1）它不稳定并且充满了错误。有数以千计的 bug 已发布到 labview 支持论坛尚未修复。其中一些是相当严重的，例如内存泄漏，或基本函数中的数学错误。

2）文档很糟糕。通常情况下，当您在本地帮助文件中寻找有关 labview 功能的帮助时，您会发现一个孤立的句子，它只是重述了您试图查找某些细节的项目的名称。例如，用户查找有关纹理过滤器模式设置的帮助文件，帮助文件中唯一写的是“纹理过滤器模式 - 选择用于纹理过滤的模式”。哎，谢谢。这样就可以解决问题了，不是吗？问题远不止于此。很多时候，当您要求国家仪器的技术代表提供有关 labview 功能或数学函数特定行为的关键细节时，他们根本不知道他们自己的库中的函数是如何工作的。这听起来可能有些夸张，但相信我，事实并非如此。

3) 虽然保持图形代码干净和有据可查并非不可能，但 Labview 旨在使这些任务既困难又低效。为了防止您的代码变得混乱、混乱，您必须定期（每隔几个操作）使用集群、子可见和巨型类型定义控件（可以在大型项目中跨越多个屏幕）等结构。这些结构通过迫使labview在内存中制作多个数据副本并执行无偿操作来消耗内存并破坏性能——所有这些都是为了防止图形图看起来像彩虹色的意大利面条，在任何地方都看不到任何评论或文本。在labview 中编程就像和魔鬼玩图画一样。想象一下你的大型软件项目写成一个墙壁大小的流程图，上面根本没有任何文字。现在想象一下，所有的线相互交叉一千次，因此完全不可能追踪数据流。您刚刚设想了在labview 中最自然、最有效的编程方式。

Labview很酷。Labview 的每一个新版本都会变得更好。如果 National Instruments 不断改进它，有一天它会成为一种通用的编程语言。现在，作为大型或逻辑复杂项目的软件开发平台，这是一个非常糟糕的选择。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2011-08-10T08:03:48.387

我是LabVIEW的新手。类似 Photoshop（空格键按住、左键单击和拖动）的鼠标平移功能将非常直观。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2012-05-02T06:16:58.527

难以分支和合并：diff 在隔离变化方面做得不好，一个案例结构中一个案例的微小变化可能会给您带来许多“差异”。据我所知，合并必须手动完成。

构建简单逻辑耗时：我发现简单的逻辑可能需要大量的布线和绘图，一旦你想改变它，你必须重新绘制所有东西。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-03-22T09:18:55.353

在 Labview 中，如果没有先打开 VI，我将找不到 VI 的调用者。

# asp.net - 服务器端 Cookie 注入

> ID：372561
> 
> 赞同：0
> 
> 时间：2008-12-16T20:22:47.053
> 
> 标签：asp.net, cookies, isapi

我有一个结合了 asp/asp.net 的应用程序，并且双方都依赖于相同的 cookie（它们在同一个域中）。出于安全考虑，我不想再访问客户端的 cookie 中有一些值。我希望完成的是取出这些值，使它们不再发送到客户端，然后在每个服务器请求中，以某种方式将这些值“注入”回 cookie，以便应用程序仍能正常运行。

这甚至可能吗？我认为这可能是通过 ISAPI，但我不太了解 C++。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T20:34:35.093

使用 Set-Cookie 标头。

```
"Set-Cookie:Test=test_value; expires=Sat, 01-Jan-2000 00:00:00 GMT; path=/;" 
```

为“过期”提供回溯日期将从客户端删除 cookie。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T21:03:42.290

我认为 isapi 过滤器是您唯一的选择。如果您不想使用 c++，则可以在[python](http://docs.activestate.com/activepython/2.6/pywin32/html/isapi/doc/isapi.html)中完成。

其他选择是将服务器升级到 Windows 2008。在 IIS 7 中，可以用 .net 语言编写 isapi 过滤器。

更改应用程序是更明智的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T22:08:25.777

只是一个猜测，因为问题并不具体，但如果您不希望 cookie 中的信息是为了阻止某人阅读它并将其用于其他目的，您可能需要查看某种可逆加密或其他一些混淆技术，以防止信息被人类阅读。

我不知道 ASP 和 ASP.NET 是否可以读取 Session 或 App 变量，但您可能还想研究使用数据库表来存储信息并给他们一个用于查找的会话 ID . 有点像临时会话变量。

To get a better answer, you might want to edit the question to be more specific about what "security issues" you are worried about. They may be non-issues or there may be a way of dealing with the issue itself that doesn't involve odd hacks.

As much as I'd like to say "Just change it all to one or the other" I understand that that isn't always an option. ;)

# svn - 颠覆协议性能

> ID：372569
> 
> 赞同：6
> 
> 时间：2008-12-16T20:25:45.110
> 
> 标签：svn

我刚刚开始/熟悉 Subversion，想知道在通过网络访问 Subversion 存储库时哪个协议提供最佳性能 file:// 或 svn://？如果我们不使用 svn:// 协议，是否会错过任何我们无法使用 file:// 协议缓解的功能？我们都在同一个 NT 域上，并计划使用 Windows Auth 并使用 NTFS/UNC 安全性。

蒂亚！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-16T20:33:41.820

SVN Book 建议*不要*对多个用户使用 file:// 协议

[选择服务器配置](http://svnbook.red-bean.com/en/1.8/svn.serverconfig.choosing.html)：

> 不要被让所有用户直接通过 file:// URL 访问存储库的简单想法所诱惑。即使每个人都可以通过网络共享随时使用存储库，这也是一个坏主意。它消除了用户和存储库之间的任何保护层：用户可能意外（或故意）损坏存储库数据库，使存储库脱机以进行检查或升级变得困难，并且可能导致文件权限问题混乱（请参阅名为“支持多种存储库访问方法”的部分）。请注意，这也是我们警告不要通过 svn+ssh:// URL 访问存储库的原因之一——从安全角度来看，它实际上与本地用户通过 file:// 访问相同，并且可能会带来所有相同的问题如果管理员不小心

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T20:43:56.680

如果要使用 Windows 身份验证，请使用 http(s) 协议和 apache。设置起来有点困难，而且不一定更快，但允许您使用标准的 apache 身份验证方法进行身份验证。包括各种基于 Windows 的身份验证方案或 kerberos。

顺便提一句。通常协议速度不是 svn 速度的一个因素。svn 将信息缓存在磁盘上，因此大多数常规操作都基于本地缓存。其次，速度因素在存储库和网络带宽中，而不是在协议中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-17T18:18:09.517

通过 svn:// 结帐/更新大约比通过 http(s):// 快 4-12 倍。该因素取决于文件/文件夹的数量和文件大小。Apache 在处理许多小文件时要慢得多，因为每个文件都是一个完整的 http-request-response 循环。在 Tortoise 中，您可以很容易地看到速度下降：

签出大型 java 项目 如果您传输一个巨大的 .jar，传输正在上升，在获取源 java 文件和创建包结构时，它将下降。

同样重要的是客户端上的**svn checkout**比**svn export**慢，而且 eclipse(java) 比 tortoise/CMD 慢得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T21:01:04.533

我同意其他人的观点，即 svn:// 比 http:// 快得多。话虽如此，我在我的存储库中使用 http://，因为我喜欢 mod_authz_svn 的访问控制文件，而且我还没有升级到 1.5。

由于我的主存储库很大，我们保持 svn:// 以只读方式运行。我向用户建议的是将您的初始结帐设置为 svn:// 然后使用`svn relocate`将其转换为 http:// url 提交。svn:// 的更新在我们可接受的时间内运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T21:05:25.173

正如 Paul de Vrieze 所说，SVN 使用的协议不会像其他因素那样影响性能。如果您在小型局域网上，那么 SVN 协议可能会让您满意。在所有其他情况下，最好将 HTTPS:// 与 Apache 一起使用。我一直在 SVN:// 的性能比 HTTPS:// 连接到互联网的性能差的 LAN 上。

您还会发现 Apache 在安全性或 SVN 存储库查看方面也可能是一个更易于管理的解决方案。

# .net - 如何阻止另一个线程的 UI 线程或强制表单在 UI 线程中运行

> ID：372572
> 
> 赞同：2
> 
> 时间：2008-12-16T20:27:38.790
> 
> 标签：.net, winforms, multithreading

我的应用程序的一个要求是，如果它失去数据库连接，那么它必须弹出一个大模式“无连接。稍后再试”对话框，阻止所有用户交互，直到重新连接连接。

我通过在应用程序开始时启动 DeviceMonitor 类的实例来实现这一点。此类创建一个 System.Threading.Timer 和每个 Tick（通常为 1 秒）以及它尝试从数据库中提取数据的一些其他内容。如果抽签失败并且确定原因是由于缺乏连接，则通过弹出上述对话框来处理异常。同样，如果数据获取成功并且对话框当前处于打开状态，则它会被强制关闭。

问题是，虽然这一切正常，但 ConnectionLost 对话框并没有阻止用户与 UI 交互。这是有道理的，因为 Timer.Elapsed 事件是在它自己的线程中引发的，并且 noConnectionDialog.ShowDialog() 从回调中调用它会阻塞它所在的线程，而不是 UI 线程。

据我了解，我需要强制 noConnectionDialog.ShowDialog() 在 UI 线程中运行或阻塞 UI 线程，直到调用 noConnectionDialog.Hide() 但我也不知道该怎么做。

也许还有其他补救措施，或者我在这里遗漏了一些东西。任何建议表示赞赏。

**编辑：**更多信息 - 这是一个程式化的对话框，而不仅仅是一个消息框。它是在我的应用程序由 Castle Windsor 启动并注入到传递的 DialogFactory 类时创建的。因此，该对话框由

```
var d = _dialogFactory.GetNoConnectionDialog();
d.ShowDialog(); 
```

我已经尝试将此代码放在计时器经过的回调之外 - 例如，当单击 UI 界面上的按钮时 - 它会从那里很好地阻止 UI，因此这与创建表单的位置无关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T03:31:48.823

我很确定 Marc 的建议应该有效。这就是我将如何编写它以使用您的对话框而不是`MessageBox`：

```
someControl.Invoke((Action)delegate {
    var d = _dialogFactory.GetNoConnectionDialog();
    d.ShowDialog();
}, null); 
```

如果这真的不起作用，我过去曾`System.Windows.Forms.Timer`在我的表单上使用 Timer 控件 () 和一个带有 Tick 函数的操作队列，如下所示：

```
void timer_Tick(object sender, System.EventArgs e)
{
    lock(queue)
    {
        while(queue.Count > 0)
        {
            Action a = queue.Dequeue();
            a();
        }
    }
} 
```

当您的 DeviceMonitor 类需要显示 UI 时，它会这样做：

```
lock(queue)
{
    queue.Enqueue((Action)delegate 
    {
        var d = _dialogFactory.GetNoConnectionDialog();
        d.ShowDialog();
    });
} 
```

`Control.Invoke`话虽如此，我真的想重申一下，我认为 Marc 的方法应该可以正常工作，并且如果您绝对确定它不适合您，我只会使用我的 Timer + queue 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T20:28:55.260

如果您有权访问 UI 元素，则可以使用以下方式推送到 UI 线程：

```
someControl.Invoke((Action)delegate {
    MessageBox.Show(someControl, "Foo");
    // could also show a form here, etc
}); 
```

（`someControl`在 MessageBox.Show 帮助父消息框）

如果您无权访问 UI 控件，也可以使用同步上下文：

```
SynchronizationContext.Current.Post(delegate {
    MessageBox.Show("Foo");
}, null); 
```

但是保持控制更容易；-p

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T00:52:04.343

这称为编组，一旦您阅读了一些关于它的好材料（Google 是您的朋友），这是一个非常简单的概念。

如果您的后台线程有一个委托调用 UI 线程拥有的对象，那么该方法（在委托的调用端）只需将自身编组回拥有其对象的线程（这将是UI 线程）然后阻塞。这是非常简单的代码（IsInvokeRequired），您只需要了解如何布局即可。（这基本上是在重申 Marc 所说的，但从更高的层面。）

# c# - 如何使用非字符串参数创建 MarkupExtension？

> ID：372578
> 
> 赞同：1
> 
> 时间：2008-12-16T20:30:42.713
> 
> 标签：c#, .net, wpf, xaml, markup-extensions

我正在 WPF 应用程序中处理自定义 MarkupExtension。我看到的每个文档示例都使用 XAML 中的字符串参数来构造新对象。是否可以使用非字符串参数？

换句话说，我怎么能做这样的事情？

```
[MarkupExtensionReturnType(typeof(Uri))]
public class RefPackUriExtension : MarkupExtension
{
    object _assembly = null;

    public RefPackUriExtension() { }

    public RefPackUriExtension(object assembly)
    {
        this._assembly = assembly;
    }

    public override object ProvideValue(IServiceProvider serviceProvider)
    {
        //return an object by using the "_assembly" member somehow
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T21:26:20.043

您的任何参数`MarkupExtension`都受到与 CLR 对象上的属性相同的解析行为。您可以使用 a`TypeConverter`来允许用户提供`string`转换为目标类型的 a，也可以使用另一个`MarkupExtension`.

作为前者的示例，请参见`ColorConverter`类。作为后者的示例，请参见`RelativeSource`类（在 中使用`Binding` `MarkupExtension`）。

# arrays - 为什么“数组”在 Visual-C++ 中被标记为保留字？

> ID：372580
> 
> 赞同：34
> 
> 时间：2008-12-16T20:31:13.510
> 
> 标签：arrays, visual-studio, visual-c++, c++-cli

Visual Studio 语法高亮将此单词着色为蓝色，就好像它是关键字或保留字一样。我尝试在网上搜索它，但是“数组”这个词会导致搜索失败，我得到的主要是解释数组是什么的页面。它是干什么用的？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-12-16T20:36:24.653

它不是 ISO 标准下的保留字。微软的[C++/CLI](http://en.wikipedia.org/wiki/C%2B%2B/CLI)在[cli 命名空间](http://msdn.microsoft.com/en-us/library/d87eee3k(VS.85).aspx)中定义了[数组](http://msdn.microsoft.com/en-us/library/ts4c4dw6(VS.85).aspx)，Visual Studio 的语法高亮将其视为保留字。这种用法将被视为供应商扩展，而不是任何国际 C 或 C++ 标准的一部分。

[ISO C99](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1256.pdf)关键字：

```
自动枚举限制无符号
打破外部返回无效
案例浮动空头易失
用于签名的字符
const goto sizeof _Bool
如果静态 _Complex 则继续
默认内联结构 _Imaginary
做int切换
双长类型定义
否则注册工会

```

ISO C++98 关键字：

```
而不是这个
and_eq dynamic_cast not_eq 抛出
asm else 运算符为真
自动枚举或尝试
位和显式 or_eq 类型定义
bitor 导出私有类型标识
布尔外部受保护的类型名
打破虚假的公会
大小写浮点寄存器无符号
捕捉 reinterpret_cast 使用
char朋友返回虚拟
类转到短空
compl 如果有符号 volatile
const inline sizeof wchar_t
const_cast int 静态 while
继续 long static_cast xor
默认可变结构 xor_eq
删除命名空间开关     
做新模板

```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-16T21:02:18.250

It's used in C++/CLI.

[Visual C++ Language Reference:](http://msdn.microsoft.com/en-us/library/ts4c4dw6(VS.85).aspx) "The array keyword lets you create a dynamic array that is allocated on the common language runtime heap."

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-16T20:33:14.660

它不是。至少不是在标准 C/C++ 中。

现在你可能会[问为什么“entry”是 K&R 中的 C 中的保留字，](https://stackoverflow.com/questions/254395/what-ever-happened-to-the-entry-keyword)但不是 C99 中的保留字——有人认为他们可能会在某个时候添加该功能，但最终决定反对。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T11:07:25.410

Visual Studio 从不为他们漂亮的打印机定义不同的 C++ 语法而烦恼。ISO C++、VC++、C++/CLI 或只是旧的 C - 都共享相同的语法。因此，像数组和接口这样的名称都被视为关键字。

漂亮的打印机也很难发现 foo.cpp 中使用的 C++ 方言。您需要为此编译代码。目前漂亮的打印机可以对令牌进行操作，这意味着它只需要解析代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T20:36:34.607

在哪个版本？谷歌搜索“c++ 保留字”没有显示这种用法。

我经常在示例代码中使用“数组”。

[http://cs.smu.ca/~porter/csc/ref/cpp_keywords.html](http://cs.smu.ca/~porter/csc/ref/cpp_keywords.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-24T15:47:28.697

它不是保留字，但 Microsoft Visual Studio 决定将其标记为蓝色，就好像它是保留字一样，但绝对不是根据 DD Malik 的“C++ Programming 5th Edition”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-08-27T05:38:13.053

在 MSVC 中突出显示一个词的事实并不意味着它是 C 或 C++ 关键字。如您所见，它还突出显示了许多非标准的东西，例如`__int64`，或者[即使`__int128`MSVC 中没有 128 位 int 类型](https://stackoverflow.com/q/6759592/995714)。

# vba - 无法访问 MSWord ActiveDocument

> ID：372581
> 
> 赞同：1
> 
> 时间：2008-12-16T20:31:30.747
> 
> 标签：vba, ms-word

当我尝试以编程方式访问 Word 对象模型时，我收到一条错误消息，提示没有文档处于活动状态。这似乎是因为我正在使用 Word 自动化将文档加载为不可见，并且我必须使其保持不可见。

我将如何对打开的宏进行编码，以便在这种情况下它什么都不做？

`If Not ActiveDocument is Nothing Then`

没用。

```
Private Sub Document_Open()

   If (ActiveDocument.SaveFormat = wdFormatRTF) Then
      'Do some stuff
   End If

End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T20:54:27.517

Instead of using ActiveDocument you could remember the document that you open (some schematic code):

```
dim word as new Word.Application
dim doc as Word.Document

doc = word.Documents.Open(fileName)
MsgBox doc.FullName 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-06T05:58:09.813

```
If Documents.Count > 0 Then 
```

# java - 自动异常处理

> ID：372589
> 
> 赞同：8
> 
> 时间：2008-12-16T20:33:46.890
> 
> 标签：java, exception, exception-handling, jvm, agent

我想知道是否存在（在 Java 世界中）能够使用以下功能拍摄 JVM 当前状态的快照：

*   在抛出异常时执行此操作。
*   捕获局部变量、方法的参数等。
*   将它放在一个方便的文件中，该文件可用于在 IDE 中提取或重现源代码中的情况。

前两个功能是必需的（第三个会很棒）。并且它必须适合生产使用（因此，调试器没有办法）。

在问这个之前，我已经搜索了万维网（尽可能长），我发现了一些指针：

*   [Cajoon Interceptor](http://www.cajoon.com)：正如[Dzone 帖子](http://www.dzone.com/links/java_production_errors_rapid_resolution.html)中所说，它是一个满足三个要求的被动 JVM 代理！但是，它有两个缺点：您必须为此付费，并且网站已关闭（也许没有机会支付任何费用）。
*   [AviCode Intercept Studio](http://www.avicode.com/)：Cajoon 的 .NET 等价物。只是为了提供一些见解。
*   [JavaFrame](http://twitter.com/thobe/status/1012650896)：好的，这是一条推文，但它指向一个可用的 SVN 存储库，其中包含看起来不错的 JVM 代理的源代码（在 MIT 许可下）（我将尝试一下）。

那么，也许我正在寻找一个不存在的解决方案？这并不紧急，但我有一个项目的想法，探索这条“未知”（？）路径并获得真实的东西会很棒。

似乎很清楚它将是一个 JVM 代理（[例如](http://java.sun.com/developer/technicalArticles/Programming/jvmti/)，来自 JVMTI 的异常事件）。

[最后，我将重点介绍 Wikipedia 异常处理文章](http://en.wikipedia.org/wiki/Exception_handling)中的以下段落：

> 在 Java 或 .NET 等运行时引擎环境中，存在附加到运行时引擎的工具，每次发生感兴趣的异常时，它们都会记录在引发异常时内存中存在的调试信息（调用堆栈和堆值）。这些工具称为自动异常处理或错误拦截工具，并为异常提供“根本原因”信息。

这就是想法。我希望有人能给我一些见解，或者将来有人会从这篇不起眼的帖子中得到启发:)

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-18T19:21:02.900

我看一下[JavaFrame](http://kenai.com/projects/jvm-frame-introspect)，它似乎是一个很好的起点。只需安装 Apache Ant，`ant`在 javaframe 目录中执行并启动测试套件（在测试目录中）：

```
LD_LIBRARY_PATH=../build/native/ java -agentlib:frameintrospect -classpath ../build/classes/:. org.thobe.frame.Test 
```

它没有得到任何局部变量，但它会尝试。所以，正如我所说，这可以作为一个起点。我希望进一步了解它的用法，但是没有时间也没有文档（有很多名为 JavaFrame 的项目）是不好的情况。

也许有一天它可以再次完成。是的，再次。有 Cajoon，它看起来很有前途和闪亮，但它的网站已经关闭，并且没有任何可下载的 jar 的痕迹可供尝试。

谢谢大家！

PD.：仅供参考，我在研究时发现的一些链接：

*   [VM 代理的工作原理](http://blogs.oracle.com/kto/entry/using_vm_agents)
*   [JVM 选项](http://blogs.oracle.com/watt/resource/jvm-options-list.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T01:07:52.437

您可能想查看 NetBeans 所做的关于自动使用日志记录的工作：[http](http://wiki.netbeans.org/UsageLoggingSpecification) ://wiki.netbeans.org/UsageLoggingSpecification 。

至于转储局部变量，我想您可以简单地使用调试器，例如 bajafresh4life 提到的调试器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T13:30:47.147

也许可以用[AspectJ](http://www.eclipse.org/aspectj/)来完成？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T20:46:02.950

不确定这在生产环境中是否可行，但有 Omniscient 调试器：

> 如果您的调试器可以“及时倒退”怎么办？这会让调试更容易吗？通过简单地记录所有变量分配，基本上可以做到这一点。这是无所不知的调试的基本思想。令人惊奇的是，可以用这种方式调试非常大的程序——Ant、JUnit、调试器本身。

[http://www.lambdacs.com/debugger/](http://www.lambdacs.com/debugger/)

# c# - C# DateTime：当我只使用“时间”时使用什么“日期”？

> ID：372601
> 
> 赞同：31
> 
> 时间：2008-12-16T20:35:55.683
> 
> 标签：c#, datetime, time

我`DateTime`在 C# 中使用 a 来显示时间。每个人在构建时间时都使用哪个日期部分？

例如，以下内容无效，因为没有第零个月或第零天：

```
// 4:37:58 PM
DateTime time = new DateTime(0, 0, 0, 16, 47, 58); 
```

我使用 COM 的零日期吗？

```
// 4:37:58 PM
DateTime time = new DateTime(1899, 12, 30, 16, 47, 58); 
```

或者也许是 SQL Server 的？

```
//4:37:58 PM
DateTime time = new DateTime(1900, 1, 1, 16, 47, 58); 
```

我意识到这是任意的，因为我将忽略代码中的日期部分，但能够使用它仍然很好：

```
DateTime duration = time2 - time1; 
```

* * *

# 回答

我想我喜欢**MinValue**

```
 DateTime time = DateTime.MinValue.Date.Add(new TimeSpan(16, 47, 58)); 
```

* * *

**注意：**我不能使用 a `TimeSpan`，因为它不存储一天中的时间。我知道的原因是因为无法将其内容显示为时间。

也就是说，`TimeSpan`记录的*是时间跨度*，而不是*一天中的时间*，例如：

```
TimeSpan t = new TimeSpan(16, 47, 58);
t.ToString(); 
```

返回格式为*hours* : *minutes* : *seconds*的时间跨度，例如：

```
16:47:58 
```

而不是时间：

```
4:47:58 PM    (United States)
04:47:58 nm   (South Africa)
4:47:58.MD    (Albania)
16:47:58      (Algeria)
04:47:58 م    (Bahrain)
PM 4:47:58    (Singapore)
下午 04:47:58  (Taiwan)
04:47:58 PM   (Belize)
4:47:58 p.m.  (New Zealand)
4:47:58 μμ    (Greece)
16.47.58      (Italy)
오후 4:47:58   (Korea)
04:47:58 ب.ظ  (Iran)
ਸ਼ਾਮ 04:47:58   (India)
04:47:58 p.m. (Argentina)
etc 
```

换句话说，时间跨度和时间之间存在差异。并且还要意识到这`TimeSpan`并没有提供将时间跨度转换为一天中的时间的机制——这是有原因的。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-16T20:40:35.800

DateTime.MinValue 呢？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-18T23:07:49.260

让我们帮助那些想要时间结构的人：

```
/// <summary>
/// Time structure
/// </summary>
public struct Time : IComparable
{
    private int minuteOfDay;
    public static Time Midnight = "0:00";
    private static int MIN_OF_DAY = 60 * 24;

    public Time(int minuteOfDay)
    {
        if (minuteOfDay >= (60 * 24) || minuteOfDay < 0)
            throw new ArgumentException("Must be in the range 0-1439", "minuteOfDay");
        this.minuteOfDay = minuteOfDay;
    }

    public Time(int hour, int minutes)
    {
        if (hour < 0 || hour > 23)
            throw new ArgumentException("Must be in the range 0-23", "hour");
        if (minutes < 0 || minutes > 59)
            throw new ArgumentException("Must be in the range 0-59", "minutes");

        minuteOfDay = (hour * 60) + minutes;
    }

    #region Operators
    public static implicit operator Time(string s)
    {
        var parts = s.Split(':');
        if (parts.Length != 2)
            throw new ArgumentException("Time must be specified on the form tt:mm");
        return new Time(int.Parse(parts[0]), int.Parse(parts[1]));
    }

    public static bool operator >(Time t1, Time t2)
    {
        return t1.MinuteOfDay > t2.MinuteOfDay;
    }
    public static bool operator <(Time t1, Time t2)
    {
        return t1.MinuteOfDay < t2.MinuteOfDay;
    }
    public static bool operator >=(Time t1, Time t2)
    {
        return t1.MinuteOfDay >= t2.MinuteOfDay;
    }
    public static bool operator <=(Time t1, Time t2)
    {
        return t1.MinuteOfDay <= t2.MinuteOfDay;
    }
    public static bool operator ==(Time t1, Time t2)
    {
        return t1.GetHashCode() == t2.GetHashCode();
    }
    public static bool operator !=(Time t1, Time t2)
    {
        return t1.GetHashCode() != t2.GetHashCode();
    }

    /// Time
    /// Minutes that remain to
    /// Time conferred minutes
    public static Time operator +(Time t, int min)
    {
        if (t.minuteOfDay + min < (24 * 60))
        {
            t.minuteOfDay += min;
            return t;
        }
        else
        {
            t.minuteOfDay = (t.minuteOfDay + min) % MIN_OF_DAY;
            return t;
        }
    }

    public static Time operator -(Time t, int min)
    {
        if (t.minuteOfDay - min > -1)
        {
            t.minuteOfDay -= min;
            return t;
        }
        else
        {
            t.minuteOfDay = MIN_OF_DAY + (t.minuteOfDay - min);
            return t;
        }
    }

    public static TimeSpan operator -(Time t1, Time t2)
    {
        return TimeSpan.FromMinutes(Time.Span(t2, t1));
    }
    #endregion

    public int Hour
    {
        get
        {
            return (int)(minuteOfDay / 60);
        }
    }
    public int Minutes
    {
        get
        {
            return minuteOfDay % 60;
        }
    }

    public int MinuteOfDay
    {
        get { return minuteOfDay; }
    }

    public Time AddHours(int hours)
    {
        return this + (hours * 60);
    }

    public int CompareTo(Time other)
    {
        return this.minuteOfDay.CompareTo(other.minuteOfDay);
    }

    #region Overrides
    public override int GetHashCode()
    {
        return minuteOfDay.GetHashCode();
    }

    public override string ToString()
    {
        return string.Format("{0}:{1:00}", Hour, Minutes);
    }
    #endregion

    /// 
    /// Safe enumerering - whatever interval applied max days 
    /// 
    /// Start time
    /// Spring in minutes
    /// 
    public static IEnumerable Range(Time start, int step)
    {
        return Range(start, start, step);
    }

    /// 
    /// Safe enumeration - whatever interval applied max days
    /// 
    public static IEnumerable Range(Time start, Time stop, int step)
    {
        int offset = start.MinuteOfDay;
        for (var i = 0; i < Time.Span(start, stop); i += step)
        {
            yield return Time.Midnight + (i + offset);
        }
    }

    /// 
    /// Calculates the number of minutes between t1 and t2
    /// 
    public static int Span(Time t1, Time t2)
    {
        if (t1 < t2) // same day
            return t2.MinuteOfDay - t1.MinuteOfDay;
        else // over midnight
            return MIN_OF_DAY - t1.MinuteOfDay + t2.MinuteOfDay;
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-16T20:41:08.280

TimeSpan 肯定可以存储一天中的时间 - 您只需将该值视为自午夜以来经过的时间量，基本上与我们读取时钟的方式相同。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-16T21:53:23.623

就我个人而言，我会创建一个`Time` `struct`包含`DateTime`实例的自定义，它具有类似的属性、构造函数等，但不暴露天/月/等。只需让您的所有公共访问者都传递到包含的实例。然后你可以简单地将时代作为一个`private static readonly DateTime`字段，你选择什么值并不重要，因为它都整齐地包含在你的自定义结构中。在您的代码的其余部分可以简单地编写：

```
var time = new Time(16, 47, 58); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-16T20:40:51.150

鉴于 DateTime.TimeOfDay 返回一个 TimeSpan，我会使用它。

为什么不能使用 TimeSpan？我不明白你的评论，它不存储一天中的时间。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-16T20:39:10.497

怎么样`DateTime.Now.TimeOfDay`，和使用`TimeSpan`？

重新“因为它不存储一天中的时间。” - 好吧，如果您将 a`TimeSpan`视为自午夜以来的时间，它确实如此。

例如，“持续时间”是尖叫声`TimeSpan`。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-16T21:32:17.987

要显示使用当地文化格式化的 TimeSpan，只需将其添加到 DateTime.Today 之类的日期即可。像这样的东西：

(DateTime.Today + timeSpan).ToString();

由于您的值实际上并不代表日期，因此最好将其存储为 TimeSpan 直到显示它的时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-16T20:41:26.623

我建议`DateTime.MinValue`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-16T21:47:06.070

您可以使用字符串文字创建一个新的 DateTime 。

时间的字符串文字：

```
DateTime t = new DateTime("01:00:30"); 
```

日期的字符串文字：

```
DateTime t = new DateTime("01/05/2008"); // english format
DateTime t = new DateTime("05.01.2008"); // german format 
```

对于具有日期和时间值的 DateTime：

```
DateTime t = new DateTime("01/05/2008T01:00:30"); 
```

在大多数情况下，在创建 DateTime 时，我将其设置为 DateTime.Now，如果它实际上没有设置为其他任何值。如果您手动实例化 DateTime，则应注意正确设置的 DateTimeKind，否则可能会导致意外。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-17T00:47:28.827

我可以建议在某些情况下自定义结构可以吗？它可能有一个 Int32 支持值（一天有 8600 万毫秒；这适合 Int32）。

可能有 get-only 属性：

时分秒毫秒

您还可以重载 +、- 等运算符。实现 IEquatable、IComparable 和任何可能的情况。重载等于，==。重载和覆盖 ToString。

您还可以提供更多方法来从 DateTime 构造或附加到 datetime 等等。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-16T23:10:34.793

如果您有 TimeZone 问题，请使用 TimeSpan，并将其设为 UTC。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-03-31T03:25:29.000

与接受的答案相比没有太大区别。只是为了实现这个想法。

```
public class TimeOfDay
{
    public DateTime time;
    public TimeOfDay(int Hour, int Minute, int Second)
    {
        time = DateTime.MinValue.Date.Add(new TimeSpan(Hour, Minute, Second));
    }
} 
```

# html - HTML 输入框 - 禁用

> ID：372604
> 
> 赞同：52
> 
> 时间：2008-12-16T20:36:35.603
> 
> 标签：html, input

禁用 HTML 的 INPUT 文本框的代码是什么？

谢谢

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-12-16T20:38:56.490

```
<input type="text" disabled="disabled" /> 
```

有关更多信息，请参阅有关[输入标记的 W3C HTML 规范](http://www.w3.org/TR/html-markup/input.text.html)。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2012-11-27T00:46:33.863

```
<input type="text" required="true" value="" readonly="true"> 
```

这将使文本框处于只读模式，可能有助于生成密码和日期选择器。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-16T20:39:02.837

禁用 HTML 输入的语法如下：

```
<input type="text" id="input_id" DISABLED /> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-04-26T11:39:17.317

您可以同时使用 input 的 disabled 或 readonly 属性。使用禁用属性将在表单提交时省略该值，因此如果您希望在提交事件中使用该值，请将它们设为只读而不是禁用。

```
<input type="text" readonly> 
```

或者

```
 <input type="text" disabled> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-03-20T11:35:15.320

```
<input type="text" required="true" value="" readonly> 
```

**不是。**

```
<input type="text" required="true" value="" readonly="true"> 
```

# c# - MDI 的优点和缺点

> ID：372622
> 
> 赞同：4
> 
> 时间：2008-12-16T20:40:19.013
> 
> 标签：c#, .net, winforms, mdi

我从我现在工作的以前的开发人员那里继承了一个应用程序框架。该框架利用多个父/子关系。在许多情况下，父母/父母/孩子会发生。我问他为什么不使用 MDI，他说几年前，当他开始时，MDI 在前面提到的关系场景方面存在重大缺陷。特别是与多个父母。

我的实际问题是；MDI还有这些缺点吗？& 那些曾与 MDI 合作过的人，您遇到过哪些问题以及您是如何克服这些问题的？

谢谢你！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T22:59:05.987

我真的认为这是您继承的应用程序的一个缺点，它需要多个父母（你好紧密耦合的应用程序！）。

我曾经开发过一个应用程序（敲木头，我很快就不必再去支持它了），它的耦合可能很像你现在的样子。如果原作者简单地使用委托而不是“this.Parent.Parent.Parent.functionX”，我们可能已经能够在修复该应用程序的缺点方面取得更大的进步（委托甚至可能不是要走的路......） .

至于 MDI，我个人更喜欢它，但我不能说你的原始开发人员发现的缺点，因为我试图围绕他/她需要的关系进行设计。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T23:07:26.440

毫无疑问，所有 MDI 都是一种将应用程序的所有窗口包含在一个明确标识的屏幕区域中的一种方式。现在，如果您的应用程序是一个应用程序，它有多个文档并且人们使用它并希望在不使用时将其“收起来”，那么 MDI 可能适合您。如果不是，那么不，它不是。

托尼

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T11:13:41.840

MDI 接口的一个问题是您无论如何都不能在您的 MDI 容器中注册无限的窗口（请参阅[此 Microsoft 知识库项目](http://support.microsoft.com/kb/126962)）。我想我把它贴出来是因为我看到很多 MDI 应用程序在大量使用时遇到了这个错误。

我通常喜欢 SDI 接口，并使其在多个“某物”实例上共享相同的控件和窗口，而不是为每个“某物”实例生成一个新窗口。

我不知道程序界面的细节，但我还没有找到无法重新设计为 SDI 界面和一些模式对话框（如果真的需要）的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T20:44:42.843

我当然有时会在 MDI 中看到一些故障，但老实说，如果您想要复杂的东西，我可能会建议您查看 WPF 而不是 winforms。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T15:32:47.887

听起来我需要进一步研究 MDI。我对 WPF 的评论很好奇，因为这与我迄今为止所学的相反。

此外，有趣的是，框架开发人员将他的架构称为 HDI（主机文档接口）。

谢谢！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-09T01:21:20.543

当你打开一个无模式的子屏幕，并且你的父屏幕被最大化时，你只能以最大化的尺寸打开子屏幕，你不能像正常尺寸的屏幕一样打开它。

# java - 需要模式建议（Hibernate + Guice）

> ID：372631
> 
> 赞同：3
> 
> 时间：2008-12-16T20:42:22.380
> 
> 标签：java, dependency-injection, design-patterns

我正在寻找有关如何将运行时依赖项注入从 Hibernate 检索的 JPA 实体的建议。我的问题本质上是这样的：

我有许多不同的 Transaction 对象子类。每个 Transaction 子类在执行时都有不同的行为，并且需要与环境不同的一组依赖项。这些 Transaction 对象由 Hibernate 作为 JPA 实体进行管理，因此我无法像在应用程序的其余部分中那样有效地使用 Guice 进行依赖注入来使用它们的环境依赖项填充实例。

为了解决这个问题，我采用了一种类似于访问者模式的方法，如下所示：

```
public abstract class Transaction {
    // ...snip...
    public abstract void apply(Transactor transactor);
}

public class TransactionA extends Transaction {
    public void apply(Transactor transactor) {
        transactor.execute(this);
    }
}

public class TransactionB extends Transaction {
    public void apply(Transactor transactor) {
        transactor.execute(this);
    }
}
// other Transaction subclasses with the same boilerplate

public interface Transactor {
    public void execute(TransactionA trans);
    public void execute(TransactionB trans);
    // corresponding methods for other transaction types.
}

public class BeginTransactor {
     @Inject
     private Foo execAdep;
     public void execute(TransactionA trans) {
         execAdep.doSomething(...)    
     }

     @Inject
     private Bar execBdep;
     public void execute(TransactionB trans) {
         execBdep.doOther(...)    
     }
 } 
```

对于事务生命周期的不同部分，我有各种 Transactor 实现。可以使用 Guice 将这些依赖注入到我想要处理事务的上下文中，我只需调用：

```
 Transactor transactor = injector.getInstance(BeginTransactor.class); //Guice injection
 Transaction t = ... //get a transaction instance
 t.apply(transactor); 
```

我不喜欢这种方法的是（1）并非每种类型的事务都应该在每个生命周期阶段都可以执行，但是每个 Transactor 都必须为每个事务子类实现一个 execute() 方法以及（2）基本上没有注入的依赖项用于处理一种以上的交易类型。

本质上，我的 Transactor 接口和实现有很多不相关的 crud 放在一起。理想情况下，我只在事务对象本身上有 execute() 方法，但我不希望调用代码必须知道事务的类型或它所需的依赖项。此外，这可能会使测试变得更加困难，因为如果 execute() 方法是 Transaction 对象上的具体方法，我将无法轻松模拟它。使用 Transactor 接口意味着我可以根据需要轻松地对其进行模拟。

任何人都可以建议如何以类型安全的方式解决这个问题，这种方式不会导致一堆大部分不相关的行为在 Transactor 中聚集在一起，而是保持可测试性并允许依赖注入？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T01:18:32.913

我使用 guice 进行交易，但我使用 AOP 来执行它们。我几乎没有样板，以牺牲一点“魔法”为代价。只要您截获的课程是“在俱乐部中”，它就可以很好地工作。

```
class BusinessLogic {
    @Inject public EntityManager em;

    @Transactional
    publc void doSomething() {
       //...
       em.persist(myObj);
    }

    @Transactional
    public void doSomethingElse() {
       //...
       em.delete(myObj);
    }
}

class TransactionalInterceptor implements MethodInterceptor {
    @Inject static Injector injector;
    public Object intercept(MethodInvocation invocation) {
        EntityManager em = injector.getInstance(EntityManager.class);
        em.getTransaction().begin();
        Object result = invocation.proceed();
        em.getTransaction().commit();
        return result;
    }
}
class TransactionalModule extends AbstractModule {
    public void configure() {
        requestStaticInjection(TransactionalInterceptor.class);
        bindInterceptor(Matchers.any(), Matchers.annotatedWith(Transactional.class),
                 new TransactionalInterceptor());
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T12:54:32.243

检查：[http ://www.hibernate.org/hib_docs/v3/api/org/hibernate/Interceptor.html](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/Interceptor.html)

将您的休眠配置为使用拦截器。方法

```
public Object instantiate(String entityName,
                      EntityMode entityMode,
                      Serializable id) 
```

将被调用

```
Instantiate the entity class. Return null to indicate that Hibernate
should use the default constructor of the class. The identifier property
of the returned instance should be initialized with the given identifier. 
```

你可以从那里调用你的 injector.getInstance() 。

也许，您可以使用 getEntity() 或 onLoad() 方法。您可以从 onLoad() 方法调用 injector.injectMembers()。

# java - 动态加载具有非默认包且没有嵌套文件夹的类文件

> ID：372639
> 
> 赞同：2
> 
> 时间：2008-12-16T20:43:35.077
> 
> 标签：java, reflection, classloader

我正在为刚接触 Java 的学生编写一个课程项目。它具有这样的文件夹结构。

```
myjar.jar
solutions/my/really/long/package/MySolution.class 
```

我明白了，所以 jar 可以加载 Solutions/my/really/long/package/ 目录中的所有类。通过将“解决方案/”添加到类路径。

我的问题是是否可以设置它，以便在不使用默认包的情况下不存在用于包的长嵌套文件夹。

由此产生的结构将是

```
myjar.jar
solutions/MySolution.class 
```

但是 MySolution 类没有默认包。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T20:45:55.633

好吧，您可以编写自己的类加载器。这可能会奏效——但这真的不是一件好事，特别是你的学生会习惯一些在现实世界中行不通的东西。

为什么不只使用一个简短的包名？

# import - Problems importing SQL script from Oracle 9i to Oracle 10g express

> ID：372643
> 
> 赞同：1
> 
> 时间：2008-12-16T20:44:06.760
> 
> 标签：import, oracle10g, ddl, oracle9i

I am currently running into a problem when trying to import an Oracle 9i SQL script into my local Oracle 10g Express database. I am trying to import the [DDL](http://en.wikipedia.org/wiki/Data_Definition_Language) from the 9i database to the 10g express database. I keep getting "Not compatible - Your export file is not supported". Has someone been able to get this working? Please let me know what I can do to get this working.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-04T13:28:36.173

确保您使用相同版本的 exp 和 imp 导出和导入，并确保该版本对应于两个数据库的较低版本，在您的情况下：9i。

也许，您应该明确说明 imp 和 exp 的路径，例如 /path/to/oracle/bin/exp 。

希望这可以帮助雷内

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-08T17:59:32.387

您是否尝试在 .sql 脚本上运行导入实用程序？或导入导出的文件？

如果是后者，之前的答案是可以接受的。如果是前者，请通过 SQLPLUS、PlsqlDeveloper、TOAD、SQLDeveloper 或您用来运行 ddl 语句的任何工具运行您的创建脚本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-22T04:59:32.607

今天早上，我成功地将 Oracle 9 导出（使用“exp”实用程序创建）导入了 Oracle 10 数据库（使用“imp”实用程序）。它工作得很好。

你能提供更多信息吗？例如，您运行的命令集的输出、文件示例或更多详细信息？

# ruby - 新手应该注意哪些 Ruby 陷阱？

> ID：372652
> 
> 赞同：109
> 
> 时间：2008-12-16T20:46:18.610
> 
> 标签：ruby

我最近学习了 Ruby 编程语言，总的来说它是一门很好的语言。但我很惊讶地发现它并不像我想象的那么简单。更准确地说，“最小惊喜规则”对我来说似乎不太受尊重（当然这是相当主观的）。例如：

```
x = true and false
puts x  # displays true! 
```

和著名的：

```
puts "zero is true!" if 0  # zero is true! 
```

您会警告 Ruby 新手的其他“陷阱”是什么？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-12-25T13:08:32.973

[维基百科红宝石陷阱](http://en.wikipedia.org/wiki/Ruby_(programming_language)#.22Gotchas.22)

来自文章：

*   以大写字母开头的名称被视为常量，因此局部变量应以小写字母开头。
*   字符`$`和`@`不表示 Perl 中的可变数据类型，而是用作范围解析运算符。
*   要表示浮点数，后面必须跟零位 ( `99.0`) 或显式转换 ( `99.to_f`)。附加一个点 ( `99.`) 是不够的，因为数字容易受到方法语法的影响。
*   非布尔数据的布尔评估是严格的：`0`，`""`并且`[]`都被评估为`true`。在C 中，表达式的`0 ? 1 : 0`计算结果为`0`（即假）。然而，在 Ruby 中，它产生`1`，因为所有数字都计算为`true`; 只有`nil`并`false`评估为`false`。这条规则的一个推论是，Ruby 方法按照约定——例如，正则表达式搜索——在成功时返回数字、字符串、列表或其他非假值，但`nil`在失败时（例如，不匹配）。这个约定也用在 Smalltalk 中，其中只有特殊对象`true`可以`false`在布尔表达式中使用。
*   1.9 之前的版本缺少字符数据类型（与提供`char`字符类型的 C 相比）。这在对字符串进行切片时可能会引起意外：`"abc"[0]`yield `97`（一个整数，表示字符串中第一个字符的 ASCII 码）；获取`"a"`使用`"abc"[0,1]`（长度为 1 的子字符串）或`"abc"[0].chr`.
*   符号`statement until expression`与其他语言的等效语句（例如`do { statement } while (not(expression));`在 C/C++/...中）不同，如果表达式已经是 ，则实际上永远不会运行该语句`true`。这是因为`statement until expression`实际上是语法糖

    ```
    until expression
      statement
    end 
    ```

    , 在 C/C++ 中的等价物`while (not(expression)) statement;`就像`statement if expression`是等价于

    ```
    if expression
      statement
    end 
    ```

    然而，符号

    ```
    begin
      statement
    end until expression 
    ```

    在 Ruby 中，即使表达式已经为真，实际上也会运行该语句一次。

*   因为常量是对对象的引用，所以更改常量引用的内容会产生警告，但修改对象本身不会。例如，`Greeting << " world!" if Greeting == "Hello"`不生成错误或警告。这类似于Java 中的`final`变量，但与 Java 不同，Ruby 也具有“冻结”对象的功能。

与其他语言显着不同的一些功能：

*   条件表达式的常用运算符`and`和`or`不遵循正常的优先规则：`and`不比 绑定更紧`or`。Ruby 也有表达式操作符`||`，`&&`可以按预期工作。

*   `def`inside`def`不符合 Python 程序员的预期：

    ```
    def a_method
        x = 7
        def print_x; puts x end
        print_x
    end 
    ```

    这给出了一个关于`x`未定义的错误。您需要使用`Proc`.

语言特点

*   如果方法采用多个参数，则在方法参数周围省略括号可能会导致意外结果。Ruby 开发人员表示，在未来的 Ruby 版本中可能不允许省略多参数方法的括号；当前（2007 年 11 月）Ruby 解释器会发出警告，鼓励作者不要省略`()`，以避免代码含义模糊。不使用`()`仍然是常见的做法，并且将 Ruby 作为一种人类可读的特定于领域的编程语言本身以及名为`method_missing()`.

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-12-25T12:06:13.097

**新手在使用相等方法**时会遇到麻烦：

*   **a == b**：检查 a 和 b 是否相等。这是最有用的。
*   **a.eql? b** ：还检查 a 和 b 是否相等，但有时更严格（例如，它可能检查 a 和 b 是否具有相同的类型）。它主要用于哈希。
*   **a.相等？b**：检查 a 和 b 是否是同一个对象（身份检查）。
*   **a === b**：用于 case 语句（我将其读为“ *a 匹配 b* ”）。

这些示例应阐明前 3 种方法：

```
a = b = "joe"

a==b       # true
a.eql? b   # true
a.equal? b # true (a.object_id == b.object_id)

a = "joe"
b = "joe"

a==b       # true
a.eql? b   # true
a.equal? b # false (a.object_id != b.object_id)

a = 1
b = 1.0

a==b       # true
a.eql? b   # false (a.class != b.class)
a.equal? b # false 
```

请注意**==** , **eql?** 和**平等？**应该总是对称的：如果 a==b 那么 b==a。

还要注意**==**和**eql?** 都在类 Object 中实现为**等于的别名？**，所以如果你创建一个新类并想要**==**和**eql？**要表示除普通身份之外的其他内容，那么您需要同时覆盖它们。例如：

```
class Person
    attr_reader name
    def == (rhs)
      rhs.name == self.name  # compare person by their name
    end
    def eql? (rhs)
      self == rhs
    end
    # never override the equal? method!
end 
```

**===**方法的行为不同。首先它***不是***对称的（a===b 并不***意味着***b===a）。正如我所说，您可以将 a===b 解读为“a 匹配 b”。这里有一些例子：

```
# === is usually simply an alias for ==
"joe" === "joe"  # true
"joe" === "bob"  # false

# but ranges match any value they include
(1..10) === 5        # true
(1..10) === 19       # false
(1..10) === (1..10)  # false (the range does not include itself)

# arrays just match equal arrays, but they do not match included values!
[1,2,3] === [1,2,3] # true
[1,2,3] === 2       # false

# classes match their instances and instances of derived classes
String === "joe"   # true
String === 1.5     # false (1.5 is not a String)
String === String  # false (the String class is not itself a String) 
```

**case**语句基于===**方法**：

```
case a
  when "joe": puts "1"
  when 1.0  : puts "2"
  when (1..10), (15..20): puts "3"
  else puts "4"
end 
```

相当于：

```
if "joe" === a
  puts "1"
elsif 1.0 === a
  puts "2"
elsif (1..10) === a || (15..20) === a
  puts "3"
else
  puts "4"
end 
```

如果您定义了一个新类，其实例表示某种容器或范围（如果它有类似**include?**或**match?方法），那么您可能会发现重写****===**方法很有用，如下所示：

```
class Subnet
  [...]
  def include? (ip_address_or_subnet)
    [...]
  end
  def === (rhs)
    self.include? rhs
  end
end

case destination_ip
  when white_listed_subnet: puts "the ip belongs to the white-listed subnet"
  when black_listed_subnet: puts "the ip belongs to the black-listed subnet"
  [...]
end 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-12-16T21:09:51.763

*   [猴子补丁](http://en.wikipedia.org/wiki/Monkey_patch)。Ruby 有开放的类，所以它们的行为可以在运行时动态改变......

*   如果或已被覆盖，对象可能会[响应未定义的方法。](http://www.java2s.com/Code/Ruby/Reflection/RespondingtoCallstoUndefinedMethods.htm)这利用了 Ruby 的基于消息的方法调用。[Rails](http://www.rubyonrails.org/)的[ActiveRecord](http://wiki.rubyonrails.org/rails/pages/ActiveRecord) 系统使用这个效果很好。`method_missing``send`

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2010-07-13T19:01:00.650

下面的代码让我吃惊。我认为这是一个危险的陷阱：既容易遇到，也很难调试。

```
(1..5).each do |number|
  comment = " is even" if number%2==0
  puts number.to_s + comment.to_s
end 
```

这打印：

```
1
2 is even
3
4 is even
5 
```

但是如果我只是在块之前添加`comment =`*任何东西*......

```
comment = nil
(1..5).each do |number|
  comment = " is even" if number%2==0
  puts number.to_s + comment.to_s
end 
```

然后我得到：

```
1
2 is even
3 is even
4 is even
5 is even 
```

基本上，当一个变量只在一个块内定义时，它会在块的末尾被销毁，然后`nil`在每次迭代时被重置。这通常是您所期望的。但是如果变量**是**在块之前定义的，那么外部变量会在块内部使用，因此它的值在迭代之间是持久的。

一种解决方案是改写这个：

```
comment = number%2==0 ? " is even" : nil 
```

我认为很多人（包括我）倾向于写“ `a = b if c`”而不是“ `a = (c ? b : nil)`”，因为它更具可读性，但显然它有副作用。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-12-17T08:27:14.983

当`super`不带参数调用时，被覆盖的方法实际上是用与覆盖方法相同的参数调用的。

```
class A
  def hello(name="Dan")
    puts "hello #{name}"
  end
end

class B < A
  def hello(name)
    super
  end
end

B.new.hello("Bob") #=> "hello Bob" 
```

要真正`super`不带参数地调用，你需要说`super()`.

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-06-11T14:11:25.613

块和方法默认返回最后一行的值。出于调试目的将`puts`语句添加到末尾可能会导致令人不快的副作用

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-12-16T21:06:36.870

[继承在确定](http://weblog.jamisbuck.org/2007/2/23/method-visibility-in-ruby)Ruby 中的方法可见性方面没有任何作用。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-12-17T10:13:20.417

我在理解类变量、类属性和类方法时遇到了很多麻烦。此代码可能对新手有所帮助：

```
class A
  @@classvar = "A1"
  @classattr = "A2"
  def self.showvars
    puts "@@classvar => "+@@classvar
    puts "@classattr => "+@classattr
  end
end

A.showvars
  # displays:
  # @@classvar => A1
  # @classattr => A2

class B < A
  @@classvar = "B1"
  @classattr = "B2"
end

B.showvars
  # displays:
  # @@classvar => B1
  # @classattr => B2

A.showvars
  # displays:
  # @@classvar => B1   #Class variables are shared in a class hierarchy!
  # @classattr => A2   #Class attributes are not 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-12-17T03:00:30.087

*   块对于理解非常重要，它们无处不在。

*   您不需要方法参数周围的括号。是否使用它们取决于您。[有人说你应该经常使用它们](http://www.pathf.com/blogs/2008/10/elements-of-ruby-style/)。

*   使用 raise 和 rescue 进行异常处理，而不是 throw 和 catch。

*   你可以使用`;`，但你不必这样做，除非你想把多个东西放在一行上。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-12-18T21:04:31.850

我学到的一件事是小心使用运算符 ||=。如果您正在处理布尔值，请特别注意。我通常使用 a ||= b 作为 catch all 来给 'a' 一个默认值，如果其他一切都失败并且 'a' 仍然为零。但如果 a 为假且 b 为真，则 a 将被赋值为真。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-12-17T11:32:26.670

我在使用包含实例方法**和**类方法的 mixins 时遇到了麻烦。此代码可能对新手有所帮助：

```
module Displayable
  # instance methods here
  def display
    puts name
    self.class.increment_displays
  end
  def self.included(base)
    # This module method will be called automatically
    # after this module is included in a class.
    # We want to add the class methods to the class.
    base.extend Displayable::ClassMethods
  end
  module ClassMethods
    # class methods here
    def number_of_displays
      @number_of_displays # this is a class attribute
    end
    def increment_displays
      @number_of_displays += 1
    end
    def init_displays
      @number_of_displays = 0
    end
    # this module method will be called automatically
    # after this module is extended by a class.
    # We want to perform some initialization on a
    # class attribute.
    def self.extended(base)
      base.init_displays
    end
  end
end

class Person
  include Displayable
  def name; @name; end
  def initialize(name); @name=name; end
end

puts Person.number_of_displays # => 0
john = Person.new "John"
john.display # => John
puts Person.number_of_displays # => 1
jack = Person.new "Jack"
jack.display # => Jack
puts Person.number_of_displays # => 2 
```

起初，我认为我可以通过简单地执行以下操作来拥有具有实例方法**和**类方法的模块：

```
module Displayable
  def display
    puts name
    self.class.increment_displays
  end
  def self.number_of_displays  # WRONG!
    @number_of_displays
  end
  [...]
end 
```

不幸的是，方法*number_of_displays*永远不会被包含或扩展，因为它是一个“模块类方法”。只有“模块实例方法”可以包含在类中（作为实例方法）或扩展到类中（作为类方法）。这就是为什么你需要把你的 mixin 的实例方法放到一个模块中，而你的 mixin 的类方法放到另一个模块中（你通常把类方法放到一个“ClassMethods”子模块中）。由于*包含*的魔术方法，您可以轻松地在一个简单的“包含 Displayable”调用中同时包含实例方法和类方法（如上例所示）。

这个 mixin 将按*类*计算每个显示。计数器是一个类属性，因此每个类都有自己的（如果您从 Person 类派生一个新类，您的程序可能会失败，因为派生类的*@number_of_displays*计数器永远不会被初始化）。您可能希望将*@number_of_displays*替换为*@@number_of_displays*以使其成为全局计数器。在这种情况下，每个类层次结构都有自己的计数器。如果您想要一个全局且唯一的计数器，您可能应该将其设为模块属性。

当我开始使用 Ruby 时，所有这些对我来说绝对不是直观的。

我仍然无法弄清楚如何干净地将其中一些 mixin 方法设为私有或受保护（只有*display*和*number_of_displays*方法应该作为公共方法包含在内）。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-04-23T19:08:06.723

### 注意范围符号。

**（至少，比我**最初做的更关注！）

**`0..10`** （两个点）和**`0...10`**（三个点）之间是有区别的。

*   [http://www.ruby-doc.org/core/classes/Range.html](http://www.ruby-doc.org/core/classes/Range.html "http://www.ruby-doc.org/core/classes/Range.html")

我非常喜欢 Ruby。但是这个点点与点点的事情让我很烦恼。我认为这样一个微妙的双语法“功能”是：

*   容易打错，并且
*   浏览代码时很容易被你的眼睛错过

应该不能在我的程序中造成毁灭性的错误。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-12-17T09:31:49.220

我认为 " `and`" 和 " `or`" 是对 Perl 的致敬，Perl 是 Ruby 最明显的“父母”之一（最突出的另一个是 Smalltalk）。它们的优先级都比你应该使用的运算符低得多（实际上低于赋值，这是所指出的行为的来源）`&&`。`||`

其他需要注意的事情并不是很明显：

您并没有真正调用方法/函数，尽管它看起来有点像。相反，就像在 Smalltalk 中一样，您向对象发送消息。所以`method_missing`真的更像`message_not_understood`。

```
some_object.do_something(args) 
```

相当于

```
some_object.send(:do_something, args) # note the : 
```

符号的使用非常广泛。这就是那些开始的事情，`:`它们并不是立即显而易见的（对我来说它们不是），但你越早掌握它们越好。

Ruby 非常重视“鸭子类型”，遵循“如果它像鸭子一样走路和像鸭子一样嘎嘎叫……”的原则，它允许用通用方法子集非正式地替换对象，而无需任何显式继承或混合关系。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2011-01-04T18:50:22.500

如果您使用`attr_writer`or `attr_accessor`(or `def foo=`) 声明一个 setter (aka mutator)，请小心从类内部调用它。由于变量是隐式声明的，解释器总是必须解析`foo = bar`为声明一个名为 foo 的新变量，而不是调用方法`self.foo=(bar)`。

```
class Thing
  attr_accessor :foo
  def initialize
    @foo = 1      # this sets @foo to 1
    self.foo = 2  # this sets @foo to 2
    foo = 3       # this does *not* set @foo
  end
end

puts Thing.new.foo #=> 2 
```

这也适用于 Rails ActiveRecord 对象，它获取基于数据库中的字段定义的访问器。由于它们甚至不是 @-style 实例变量，因此单独设置这些值的正确方法是使用`self.value = 123`or `self['value'] = 123`。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-12-17T02:31:08.227

了解 Time 和 Date 类之间的区别。两者都是不同的，并且在 Rails 中使用它们时产生了问题。Time 类有时会与标准 ruby​​/rails 库中的其他 Time 类库发生冲突。我个人花了很多时间来了解我的 Rails 应用程序中到底发生了什么。后来，我想我什么时候做的

`Time.new`

它指的是一个我什至不知道的位置的图书馆。

抱歉，如果我不清楚我想说什么。如果其他人遇到过类似的问题，请重新解释。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-12-16T20:52:14.713

过去让我感到困惑的是，单引号内的字符串不支持换行符 ( `\n`) 转义序列以及其他转义序列。反斜杠本身被转义。您必须使用双引号才能使转义按预期工作。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-12-16T21:44:59.257

```
x = (true and false) # x is false 
```

正如你所指出的，0 和 '' 是真的。

您可以拥有同名的方法和模块/类（这是有道理的，因为该方法实际上被添加到 Object 并因此具有自己的命名空间）。

没有多重继承，但经常使用“mixin 模块”将公共方法添加到多个类中。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2011-04-01T02:52:05.943

方法可以重新定义，并且在您发现原因之前可能会令人费解。（*诚​​然，当 Ruby on Rails 控制器的操作被错误地重新定义时，这个错误可能有点“难以”检测到！*）

```
#demo.rb
class Demo

  def hello1
    p "Hello from first definition"
  end

  # ...lots of code here...
  # and you forget that you have already defined hello1

  def hello1
    p "Hello from second definition"
  end

end
Demo.new.hello1 
```

### 跑：

```
$ ruby demo.rb
=> "Hello from second definition" 
```

### 但是在启用警告的情况下调用它，您可以看到原因：

```
$ ruby -w demo.rb
demo.rb:10: warning: method redefined; discarding old hello1
=> "Hello from second definition" 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-12-17T18:57:55.913

我认为在事物上使用 .length 总是好的......因为几乎所有东西都支持 size 并且 Ruby 有动态类型，当你有错误的类型时调用 .size 会得到非常奇怪的结果......我宁愿得到NoMethodError: undefined method `length'，所以我通常从不在 Ruby 中的对象上调用 size。

不止一次咬我。

还要记住对象有 id，所以我尽量不要使用变量调用 id 或 object_id 以避免混淆。如果我需要用户对象上的 id，最好将其命名为 user_id。

只是我的两分钱

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-12-17T10:17:24.510

我是 ruby​​ 新手，在第一轮我遇到了一个关于将浮点数/字符串更改为整数的问题。我从浮点数开始并将所有内容编码为**f.to_int**。但是当我继续对字符串使用相同的方法时，我在运行程序时被抛出了一条曲线。

显然，字符串没有**to_int**方法，但浮点数和整数有。

```
irb(main):003:0* str_val = '5.0'
=> "5.0"
irb(main):006:0> str_val.to_int
NoMethodError: undefined method `to_int' for "5.0":String
        from (irb):6
irb(main):005:0* str_val.to_i
=> 5

irb(main):007:0> float_val = 5.0
=> 5.0
irb(main):008:0> float_val.to_int
=> 5
irb(main):009:0> float_val.to_i
=> 5
irb(main):010:0> 
```

任意括号起初也让我感到震惊。我看到了一些代码和一些没有。我花了一段时间才意识到这两种风格都可以接受。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-02-24T11:54:21.647

与蒙库特的回应有关，Ruby 的`to_foo`方法暗示了他们将进行的转换有多严格。

简短的`to_i`,`to_s`告诉它是惰性的，并将它们转换为目标类型，即使它们无法以该格式准确表示。例如：

```
"10".to_i == 10
:foo.to_s == "foo" 
```

较长的显式函数（如`to_int`, ）`to_s`意味着对象可以本地表示为该类型的数据。例如，`Rational`该类表示所有有理数，因此可以通过调用直接将其表示为 Fixnum（或 Bignum）整数`to_int`。

```
Rational(20,4).to_int == 5 
```

如果您不能调用更长的方法，则意味着该对象不能以该类型本地表示。

所以基本上，在转换时，如果你对方法名称很懒惰，Ruby 也会对转换很懒惰。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2010-09-06T23:38:31.290

From [In Ruby 为什么不`foo = true unless defined?(foo)`做作业？](https://stackoverflow.com/questions/2291646/in-ruby-why-wont-foo-true-unless-definedfoo-make-the-assignment)

```
foo = true unless defined?(foo) #Leaves foo as nil 
```

因为`foo`被定义为何`nil`时`defined?(foo)`被调用。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2010-02-11T13:00:17.733

不能保证以任何特定顺序对 ruby​​ 哈希进行迭代。（这不是一个错误，这是一个功能）

`Hash#sort`如果您需要特定的订单，这很有用。

相关问题：[为什么 Ruby 的 1000 个哈希键和值对数组总是按特定顺序排列？](https://stackoverflow.com/questions/3516125/why-rubys-array-of-1000-hashes-key-and-value-pairs-are-always-in-a-particular-o)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-08-02T07:48:49.340

```
1..5.each {|x| puts x} 
```

不起作用。您必须将范围放入括号中，例如

```
(1..5).each {|x| puts x} 
```

所以它不认为你在打电话`5.each`。我认为这是一个优先问题，就像问题一样`x = true and false`。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-07-09T16:39:30.113

这一次让我很生气：

```
1/2 == 0.5 #=> false
1/2 == 0   #=> true 
```

# css - 在同一个html文件中使用两个css文件

> ID：372655
> 
> 赞同：7
> 
> 时间：2008-12-16T20:48:01.137
> 
> 标签：css, css-specificity

是否可以在同一个 HTML 文件中使用 2 个具有相同名称的选择器等 CSS 类？如果是这样，在设计元素时如何区分两者？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-16T20:52:48.427

是的，这是可能的，只需在文档的 HEAD 部分中包含两个 css 文件。第一个中设置的任何样式都将在第二个中被覆盖，所以假设你有这个：
第一个文件：

```
 #something{
  background-color: #F00;
  color: #FFF;
 } 
```

然后在第二个文件中：

```
 #something{
  background-color: #000;
 } 
```

然后 #something 的背景颜色将在第二个文件中被覆盖为黑色，但颜色将保持不变，因为第二个文件没有说明任何内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T20:49:03.847

是的，有可能。第二个文件中的定义将覆盖第一个文件的定义。没有办法区分两者，只能根据文件添加类名。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-16T12:27:55.250

这应该可以，试试吧。

```
<style>
  .foo{
    border:1px solid blue;
    color:red;
  }
  .foo{
    border:4px solid orange !important;
  }
</style>
<div class="foo">this will have an orange border and red text (no blue border)</div> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T20:50:27.370

> ...具有**相似**名称的选择器

如果名称确实**相似**且不**相同**，那么应该没有问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T20:49:27.013

你的意思是同一类的2个定义？或元素上的2个类名？

第一种情况，没有。

```
<style>
  .foo{
    border:1px solid blue;
    color:red;
  }
  .foo{
    border:4px solid orange;
  }
</style>
<div class="foo">this will have an orange border and red text (no blue border)</div> 
```

第二种情况，是的

```
<div class="class1 class2">this is valid</div> 
```

# wpf - WPF MVVM 中的两个“自我更新”属性

> ID：372660
> 
> 赞同：4
> 
> 时间：2008-12-16T20:48:56.093
> 
> 标签：wpf, architecture, mvvm

考虑到您在 WPF 中有一个 MVVM 架构，例如[Josh Smith 的示例](http://joshsmithonwpf.wordpress.com/2008/11/14/using-a-viewmodel-to-provide-meaningful-validation-error-messages/)

您将如何实现两个相互更新的“同步”属性？我的模型中有一个 Price 属性和一个 PriceVatInclusive 属性。

- 当价格发生变化时，我希望看到含增值税的价格自动变为“价格 * 1.21”。

- 反之亦然，当 PriceVatInclusive 发生变化时，我希望价格为“PriceVatInclusive / 1.21”

有什么想法吗？

如果您的模型是实体框架实体怎么办？你不能使用上面的方法......不是吗？您应该将计算代码放在 ViewMODEl 中还是...？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T20:58:32.003

单程：

```
 public class Sample : INotifyPropertyChanged
    {
        private const double Multiplier = 1.21;
        #region Fields
        private double price;
        private double vat;
        #endregion

        #region Properties
        public double Price
        {
            get { return price; }
            set
            {
                if (price == value) return;
                price = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Price"));
                Vat = Price * Multiplier;
            }
        }

        public double Vat
        {
            get { return vat; }
            set
            {
                if (vat == value) return;
                vat = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Vat"));
                Price = Vat / Multiplier;
            }
        }
        #endregion

        #region INotifyPropertyChanged Members
        protected void OnPropertyChanged(PropertyChangedEventArgs e)
        {
            PropertyChangedEventHandler ev = PropertyChanged;
            if (ev != null)
            {
                ev(this, e);
            }
        }
        public event PropertyChangedEventHandler PropertyChanged;

        #endregion
    } 
```

如果可以从 DependencyObject 派生，则可以使用 Dependency Properties。

```
public class Sample : DependencyObject
{
    private const double Multiplier = 1.21;

    public static readonly DependencyProperty VatProperty =
        DependencyProperty.Register("Vat", typeof(double), typeof(Sample), 
        new PropertyMetadata(VatPropertyChanged));

    public static readonly DependencyProperty PriceProperty =
        DependencyProperty.Register("Price", typeof(double), typeof(Sample), 
        new PropertyMetadata(PricePropertyChanged));

    private static void VatPropertyChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e)
    {
        Sample sample = obj as Sample;
        sample.Price = sample.Vat / Multiplier;
    }

    private static void PricePropertyChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e)
    {
        Sample sample = obj as Sample;
        sample.Vat = sample.Price * Multiplier;
    }

    #region Properties
    public double Price
    {
        get { return (double)GetValue(PriceProperty); }
        set { SetValue(PriceProperty, value); }
    }

    public double Vat
    {
        get { return (double)GetValue(VatProperty); }
        set { SetValue(VatProperty, value); }
    }
    #endregion
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-26T05:39:17.943

看看[Polymod.NET](http://polymod.codeplex.com/)。如果您在域对象上有“Price”属性，则可以为该域类创建模型，定义公式“PriceVat”= Price * 0.1。该模型将知道 PriceVat 在 Price 变化时发生变化，并将其告知 UI。

您的域类甚至不必是 INotifyable！

# c# - 如何使用 HTML 表格实现分页？

> ID：372664
> 
> 赞同：0
> 
> 时间：2008-12-16T20:49:46.263
> 
> 标签：c#, html

我有一个 html 表，我在 C# 的服务器端动态绑定数据。问题是我有一个搜索按钮，它根据来自的信息调用数据库搜索（在服务器端的搜索方法中）客户页面。此搜索方法从数据库加载信息并更新 html 表（这是动态绑定信息的地方）

```
for (int i = 0; i < data.Count; i++)
{   
  FirstCell.Controls.Add(lbl1);

  SecondCell.Controls.Add(lbl2);

  ThirdCell.Controls.Add(lbl3);      
  row.Cells.Add(FirstCell);

  row.Cells.Add(SecondCell);

  row.Cells.Add(ThirdCell);

  Table.Rows.Add(row);
} 
```

...完成此操作后，我将数据库中加载的对象存储在会话变量中，例如： Session{"data"]=data;

我的问题是如何在表格下方的视图页面底部显示每页具有一定数量记录的 html 表格？当我遍历页面时，保持数据可见且不会丢失？我不是在尝试使用 ASP.net 数据控件！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T20:53:03.480

我知道这并不能完全回答您的问题，但标准 ASP.NET DataGrid 不支持开箱即用的分页吗？或者您不想使用 ASP.NET 控件。只是好奇....

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T21:35:02.477

您是否看过这篇关于如何[使用 JQuery 在 Gridview 控件中实现客户端分页的](http://code.geekonweb.com/post/Add-client-side-paging-in-GridView-control-using-jQuery.aspx)帖子？这里有一个例子 - [Datagrid paging using JQuery example](http://samples.geekonweb.com/GridViewJqueryPaging.aspx)

这可以修改为使用 html 表。

# c++ - C++ 实例初始化语法

> ID：372665
> 
> 赞同：13
> 
> 时间：2008-12-16T20:49:56.077
> 
> 标签：c++, initialization

给定这样的类：

```
class Foo {
public:
    Foo(int);

    Foo(const Foo&);

    Foo& operator=(int);

private:
    // ...
}; 
```

这两行是完全等价的，还是它们之间有细微的差别？

```
Foo f(42);

Foo f = 42; 
```

* * *

编辑：我通过在原始问题中使 Foo 构造函数“显式”来混淆问题。我已将其删除，但感谢您的回答。

我还添加了复制构造函数的声明，以明确复制可能不是一个简单的操作。

我真正想知道的是，根据 C++ 标准，“Foo f = 42”会直接调用 Foo(int) 构造函数，还是会调用复制构造函数？

看起来 fasih.ahmed 有我正在寻找的答案（除非它是错误的）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-16T21:09:28.877

```
class Foo {
public:
    Foo(explicit int);

    Foo& operator=(int);
}; 
```

That's invalid. The syntax is

```
class Foo {
public:
    explicit Foo(int);

    Foo& operator=(int);
}; 
```

The difference is that the *conversion constructor* cannot be used for implicit conversions when you put *explicit* before it:

```
Foo f(10); // works
Foo f = 10; // doesn't work 
```

The above doesn't have anything to do with an assignment operator you declared there. It is not used since that is an initialization (only constructors are used). The following will use the assignment operator:

```
Foo f;
f = 10; 
```

And will use the default constructor of Foo (the one taking no arguments).

* * *

**Edit**: The questioner changed his question to the specific ways of whether

```
Foo f = 1; // called "copy initialization" 
Foo f(1);  // called "direct initialization" 
```

Are the same. The answer is that they are equivalent to the following:

```
Foo f(Foo(1));
Foo f(1); 
```

If and only if the conversion constructor taking the int is not declared with keyword `explicit`, otherwise the first is a compiler error (see above). The compiler is allowed to elide (optimize out) the temporary passed to the copy constructor of Foo in the first case **if all semantic restrictions are still safisfied, and even if the copy constructor has side effects**. That especially includes a visible copy constructor.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-16T20:53:07.303

```
Foo f = 42; 
```

该语句将为值“42”创建一个临时对象。

```
Foo f(42); 
```

该语句将直接分配值，因此减少了一次函数调用。

# asp.net - 什么是 ASP.NET MVC？

> ID：372667
> 
> 赞同：2
> 
> 时间：2008-12-16T20:50:28.213
> 
> 标签：asp.net, asp.net-mvc, visual-studio-2005

谁能解释一下，什么是 MVC，我们为什么使用它以及如何使用它。使用这个的好处？我们可以在 ASP.NET 2.0 (VS 2005) 中使用 ASP.NET MVC

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T20:54:13.727

当您需要完全控制来自 ASP.NET 的 HTML 输出时，您将使用 MVC。它还允许更好/更轻松的单元测试。它基于模型视图控制器架构。

Scott Gutherie 在这里很好地介绍了它： [Scott Gu 的博客](http://weblogs.asp.net/scottgu/archive/2007/10/14/asp-net-mvc-framework.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-16T20:59:07.697

ASP.NET MVC 是用于创建 Web 应用程序的[模型-视图-控制器模式](http://en.wikipedia.org/wiki/Model-view-controller)的 Microsoft 标记实现，它允许将关注点与您的业务层（模型）和表示层（由控制器提供的视图）完全分离。它是使用 Microsoft 的 Webforms 技术的替代方案，并且允许简单的单元测试，这在使用 Webforms 方法时几乎是不可能的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-16T20:55:51.913

模型视图控制器 ( [MVC](http://en.wikipedia.org/wiki/Model-view-controller) ) 也是 Microsoft [ASP.NET MVC 框架。](http://www.asp.net/mvc/)它是使用 VS.NET 2008 中的东西构建的。最好部署在 Windows 2008 Server 上。它可以在 Windows 2003 Server 上运行，但您会丢失一些很酷的部分。

ASP.NET MVC 框架的优点包括：

*   像 REST 一样的 url，即 /products/1/456
*   您的网站上没有显示 aspx 文件扩展名。
*   非常干净的输出模型，更像 Classic ASP 然后 ASP.NET WebForms。
*   与使用 WebForms 相比，创建可测试站点要容易得多。

ASP.NET MVC 的缺点

*   它处于测试阶段
*   它应该在 Windows 2008 上运行，如果您使用 Windows 2005，则需要为所有页面提供扩展名。
*   这是非常新的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-16T21:16:11.000

MVC 是一种将程序分成三个独立单元的方法：

*   模型：处理数据访问、业务逻辑等。

*   查看：生成用户界面。

*   控制器：处理来自用户界面的输入，可能从模型中检索信息，并根据该信息将视图返回给用户。

好处：

*   当数据访问逻辑与用户界面分开时更易于维护

*   可以分别对不同的部分进行单元测试

*   特定于 ASP.NET MVC：与 ASP.NET Web 表单相比，通常呈现较小的页面大小

ASP.NET MVC 是 Microsoft 用于在网站中实现 MVC 模式的技术。它是 ASP.NET web 表单的替代品，它在某种程度上是 web 的 win 表单。ASP.NET MVC 被许多人认为比 Web 表单更干净、更快速，但通常需要更深入地了解 html、javascript...

这里有更多细节：[ASP.NET MVC](http://www.asp.net/mvc)。当前的 ASP.NET MVC Beta 版本需要 .NET 3.5。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-16T21:18:07.643

[MVC](http://en.wikipedia.org/wiki/Model-view-controller)是一种设计模式，其中显示数据的职责委托给 View 组件，处理用户和系统输入的职责委托给 Controller 组件，处理业务逻辑和数据的职责委托给 Model 组件. [ASP.NET MVC](http://www.codeplex.com/aspnet)是用于 ASP.NET Web 编程的 MVC 模式的实现。

ASP.NET MVC 与 ASP.NET WebForms 形成对比，ASP.NET WebForms 没有明确的职责分工（尽管好的设计通常会尝试强制执行类似 MVC 的设计）。在 WebForms 中，视图呈现、I/O 处理（Web 请求）和业务逻辑职责通常混合在 ASPX 页面中的标记和代码隐藏之间。例如，在 WebForms 中，您可以将带有选择逻辑的 SqlDataSource 直接嵌入到您的标记中，并将其绑定到 GridView。使用单元测试很难测试选择逻辑是否正常工作。在 ASP.NET MVC 中，数据的选择将由控制器操作处理，该控制器操作生成要传递给视图并由视图呈现的视图数据。使用单元测试可以更轻松地检查此控制器操作的正确操作（它只是控制器类上的一个方法）。

ASP.NET MVC 使用基于 REST 的 url，而不是 WebForm PostBack 模型进行用户交互。MVC 可以使用任何 HTTP 方法，标准期望 RESTful url 是规范。在 WebForms 中，通常只看到使用了 GET/POST 方法。

虽然 ASP.NET WebForms 相对成熟，并为其开发了许多控件，包括第三方控件，但 ASP.NET MVC 仍处于 Beta 版（截至 12/2008）并且可用的控件要少得多。有些人会争辩说这是完全可以接受的，因为 MVC 的一个方面是让开发人员更好地控制视图渲染。其他人可能会发现这是一个严重的缺点，并可能希望等到开发出更多适用于 MVC 模型的控件。

要与其他语言/框架进行比较，请参阅 Ruby on Rails (Ruby)、Java Struts 或 Spring MVC (Java) 和 Django (Python) 等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-29T05:08:38.727

**Asp.net MVC**基于 MVC 设计模式。现在提出一个问题，什么是**MVC 设计模式**。MVC 设计模式允许您使用松散耦合的组件开发应用程序。它将应用程序分成不同的层，如**数据**、**业务逻辑**和**表示逻辑**。要了解有关 Asp.net MVC 的更多信息。请转到以下链接。

[https://youtu.be/m_9FnAc5k8c](https://youtu.be/m_9FnAc5k8c)

# tomcat - 如何在启动时在 Tomcat 配置中指定系统属性？

> ID：372686
> 
> 赞同：76
> 
> 时间：2008-12-16T20:59:21.440
> 
> 标签：tomcat, properties, system-properties, context.xml

我知道我可以通过使用 -D 参数传递参数来为 Tomcat 指定系统属性，例如“ **-Dmy.prop=value** ”。

我想知道是否有一种更简洁的方法可以通过在 context.xml 文件或其他一些 tomcat 配置文件中指定属性值来执行此操作。我想这样做是因为，首先，更容易跟踪我的属性，其次，我有多个上下文正在运行，我不知道如何通过 -D 参数指定特定于上下文的属性。

我正在使用 Tomcat 5.5 版。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-26T23:01:09.163

*当仅使用*System.getProperty*`<env-entry>` ()*

 *根据 Tomcat 6.0 文档[`<env-entry>`是针对 JNDI 的](http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html)。所以这意味着它不会对`System.getProperty()`.

以`<env-entry>`来自*悬崖.meyers*的例子，下面的代码

```
System.getProperty("SMTP_PASSWORD"); 
```

将返回 null，而不是值“abc123ftw”。

根据 Tomcat 6 文档，要使用`<env-entry>`你必须编写这样的代码才能使用`<env-entry>`：

```
// Obtain our environment naming context
Context initCtx = new InitialContext();
Context envCtx = (Context) initCtx.lookup("java:comp/env");

// Look up our data source
String s = (String)envCtx.lookup("SMTP_PASSWORD"); 
```

警告：我实际上并没有尝试过上面的例子。但是我**已经**尝试过`<env-entry>`使用 System.getProperty()，但这绝对行不通。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-18T03:22:56.767

（更新：如果我可以删除这个答案，我会删除，虽然因为它被接受了，但我不能。我正在更新描述以提供更好的指导，并阻止人们使用我在原始答案中概述的不良做法）。

您可以通过上下文或环境参数指定这些参数，例如在 context.xml 中。请参阅此页面上标题为“上下文参数”和“环境条目”的部分：

[http://tomcat.apache.org/tomcat-5.5-doc/config/context.html](http://tomcat.apache.org/tomcat-5.5-doc/config/context.html)

正如@netjeff 指出的那样，这些值将通过 Context.lookup(String) 方法获得，而不是作为系统参数。

指定这些值的另一种方法是在您正在部署的 Web 应用程序的 web.xml 文件中定义变量（见下文）。正如@Roberto Lo Giacco 指出的那样，这通常被认为是一种糟糕的做法，因为部署的工件不应该是特定于环境的。但是，如果您真的想这样做，下面是配置片段：

```
<env-entry>
    <env-entry-name>SMTP_PASSWORD</env-entry-name>
    <env-entry-type>java.lang.String</env-entry-type>
    <env-entry-value>abc123ftw</env-entry-value>
</env-entry> 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-28T14:49:59.147

通常，您不应该依赖系统属性来配置 webapp - 它们可能用于配置容器（例如 Tomcat），但不能用于配置在 tomcat 中运行的应用程序。

悬崖.meyers 已经提到了你应该为你的 web 应用程序使用的方式。这是标准方式，也适合您通过 context.xml 或 server.xml 方式进行配置的问题。

也就是说，如果您真的需要在 tomcat 中使用系统属性或其他 jvm 选项（如最大内存设置），您应该创建一个名为“bin/setenv.sh”或“bin/setenv.bat”的文件。这些文件在您下载的标准存档中不存在，但如果它们存在，则内容会在启动期间执行（如果您通过 startup.sh/startup.bat 启动 tomcat）。这是将您自己的设置与标准 tomcat 设置分开的好方法，并使更新变得更加容易。无需调整 startup.sh 或 catalina.sh。

（如果将tomcat作为windows servive执行，通常使用tomcat5w.exe、tomcat6w.exe等配置服务的注册表设置。）

编辑：另外，另一种可能性是选择[JNDI Resources](http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html)。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-02-25T15:49:48.837

也可以让 ServletContextListener 设置系统属性：

```
import java.util.Enumeration;
import javax.servlet.*;

public class SystemPropertiesHelper implements
        javax.servlet.ServletContextListener {
    private ServletContext context = null;

    public void contextInitialized(ServletContextEvent event) {
        context = event.getServletContext();
        Enumeration<String> params = context.getInitParameterNames();

        while (params.hasMoreElements()) {
          String param = (String) params.nextElement();
          String value = 
            context.getInitParameter(param);
          if (param.startsWith("customPrefix.")) {
              System.setProperty(param, value);
          }
        }
    }

    public void contextDestroyed(ServletContextEvent event) {
    }
} 
```

然后把它放到你的 web.xml 中（对于 context.xml 也应该是可能的）

```
<context-param>
        <param-name>customPrefix.property</param-name>
        <param-value>value</param-value>
        <param-type>java.lang.String</param-type>
</context-param>

<listener>
    <listener-class>servletUtils.SystemPropertiesHelper</listener-class>    
</listener> 
```

它对我有用。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-09-25T23:27:20.043

在 tomcat 配置上设置系统属性的另一种方法是使用 CATALINA_OPTS 环境变量

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-07-20T16:49:23.250

这个问题在 Apache wiki 中得到解决。

问题：“我可以为每个 webapp 设置不同的 Java 系统属性吗？”

答：不可以。如果您可以编辑 Tomcat 的启动脚本（或者最好创建一个 setenv.sh 文件），您可以在 Java 中添加“-D”选项。但是 Java 中没有办法为同一个 JVM 中的不同类设置不同的系统属性值。还有一些其他方法可用，例如使用 ServletContext.getContextPath() 来获取 Web 应用程序的上下文名称并相应地定位一些资源，或者在 Web 应用程序的 WEB-INF/web.xml 文件中定义元素，然后设置它们在 Tomcat 上下文文件 (META-INF/context.xml) 中的值。请参阅[http://tomcat.apache.org/tomcat-7.0-doc/config/context.html](http://tomcat.apache.org/tomcat-7.0-doc/config/context.html)。

[http://wiki.apache.org/tomcat/HowTo#Can_I_set_Java_system_properties_differently_for_each_webapp.3F](http://wiki.apache.org/tomcat/HowTo#Can_I_set_Java_system_properties_differently_for_each_webapp.3F)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-11-09T21:13:25.423

您可以将必要的属性添加到`catalina.properties`目录中的`<tomcat installation directory>/conf`文件。

参考：[https ://tomcat.apache.org/tomcat-8.0-doc/config/index.html](https://tomcat.apache.org/tomcat-8.0-doc/config/index.html)

> 所有系统属性都可用，包括使用 -D 语法设置的属性、JVM 自动提供的属性以及在 $CATALINA_BASE/conf/catalina.properties 文件中配置的属性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-04-24T08:21:53.553

如果您想根据文档在上下文中定义环境变量，您应该将它们定义如下

```
<Context ...>
  ...
  <Environment name="maxExemptions" value="10"
         type="java.lang.Integer" override="false"/>
  ...
</Context> 
```

还可以如下使用它们：

```
((Context)new InitialContext().lookup("java:comp/env")).lookup("maxExemptions") 
```

你应该得到`10`作为输出。

# jquery - Submit with JQuery in firefox 3 & opera in a modal dialog box from SimpleModal

> ID：372691
> 
> 赞同：0
> 
> 时间：2008-12-16T21:00:42.700
> 
> 标签：jquery, jquery-plugins, submit, fckeditor, simplemodal

I'm trying to submit a form who is rendered in a SimpleModal dialog, but my submit is never called when I'm using FF3 & Opera (Chrome, Safari and IE works). I use the following code:

```
function ShowModal(rendercontainerid, modalcontainerid, url) {
    if (url == '')
        return;
    $.get(url, function(data) {
        $(rendercontainerid).html(data);
        $(rendercontainerid).modal({ 
            close: false,
            containerId: modalcontainerid,
            onOpen: function(dialog) {
                dialog.overlay.fadeIn('slow', function() {
                    dialog.container.slideDown('slow', function() {
                        dialog.data.fadeIn('slow');
                    });
                });
            },
            onClose: function(dialog) {
                dialog.data.fadeOut('slow', function() {
                    dialog.container.slideUp('slow', function() {
                        dialog.overlay.fadeOut('slow', function() {
                            $.modal.close(); // must call this!
                        });
                    });
                });
            }
        });
    });
}

function CloseDialog() {
    $.modal.close();
}

function SubmitAndClose(rendercontainerid) {
    $(rendercontainerid).find('form').submit();
    CloseDialog();
    window.location = window.location;
}

function AjaxSubmitAndClose(rendercontainerid) {
    var form = $(rendercontainerid).find('form');
    var url = $(form).attr('action');
    var postData = $(form).serializeArray();

    var options = {
        dataType: 'json',
        success: AjaxSubmitSucces
    };

    $(form).ajaxSubmit(options);
}

function AjaxSubmitSucces(data) {
    if (data.ErrorMessage != '') {
        alert(data.ErrorMessage);
    }
    else if (data.RedirectUrl != '') {
        CloseDialog();
        window.location = data.RedirectUrl;
    }
} 
```

I also tried to the jquery.form plugin for ajax posting but then you will see the formdata(An fckeditor) is in the initial values(it looks like it is cached).

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-28T17:15:47.993

尝试使用 onShow 回调：

```
onShow: function (dialog) {
  // bind form submit in dialog
  dialog.data.find('form').submit(function (e) {
    e.preventDefault();
    // do stuff here
  });
} 
```

# c# - 在 C# 中将字符串转换为画笔/画笔颜色名称

> ID：372693
> 
> 赞同：40
> 
> 时间：2008-12-16T21:01:04.837
> 
> 标签：c#, .net, graphics, colors, brush

我有一个配置文件，开发人员可以通过传入一个字符串来指定文本颜色：

```
 <text value="Hello, World" color="Red"/> 
```

与其使用巨大的 switch 语句来查找所有可能的颜色，不如只使用 System.Drawing.Brushes 类中的属性，这样在内部我可以这样说：

```
 Brush color = Brushes.Black;   // Default

 // later on...
 this.color = (Brush)Enum.Parse(typeof(Brush), prasedValue("color")); 
```

除了 Brush/Brushes 中的值不是枚举之外。所以 Enum.Parse 没有给我带来快乐。建议？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-05-22T20:24:44.597

回顾所有以前的答案，将字符串转换为颜色或画笔的不同方法：

```
// best, using Color's static method
Color red1 = Color.FromName("Red");

// using a ColorConverter
TypeConverter tc1 = TypeDescriptor.GetConverter(typeof(Color)); // ..or..
TypeConverter tc2 = new ColorConverter();
Color red2 = (Color)tc.ConvertFromString("Red");

// using Reflection on Color or Brush
Color red3 = (Color)typeof(Color).GetProperty("Red").GetValue(null, null);

// in WPF you can use a BrushConverter
SolidColorBrush redBrush = (SolidColorBrush)new BrushConverter().ConvertFromString("Red"); 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-05-22T19:55:04.733

要刷的字符串：

```
myTextBlock.Foreground = new BrushConverter().ConvertFromString("#FFFFFF") as SolidColorBrush; 
```

这就是我的情况！

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-10-09T05:08:03.800

可以像这样声明一个画笔

```
Brush myBrush = new SolidBrush(Color.FromName("Red")); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-16T21:04:35.343

哦。看了一会儿，我发现：

```
 Color.FromName(a.Value) 
```

点击“发布”后。从那里只需一小步即可：

```
 color = new SolidBrush(Color.FromName(a.Value)); 
```

我会把这个问题留给其他人......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-16T21:07:56.867

您可以为此使用反射：

```
Type t = typeof(Brushes);
Brush b = (Brush)t.GetProperty("Red").GetValue(null, null); 
```

当然，如果字符串错误，您将需要一些错误处理/范围检查。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T20:55:25.783

我同意使用 TypeConverters 是最好的方法：

```
 Color c = (Color)TypeDescriptor.GetConverter(typeof(Color)).ConvertFromString("Red");
 return new Brush(c); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T21:10:30.933

如果您愿意，您可以进一步扩展它并允许他们指定 R、G 和 B 值的值。然后你只需调用 Color.FromArgb(int r, int g, int b);

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-16T21:03:51.883

尝试使用`TypeConverter`. 例子：

```
var tc = TypeDescriptor.GetConverter(typeof(Brush)); 
```

另一种选择是使用反射，并检查`SystemBrushes`.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2020-06-30T03:13:12.980

在尝试解决此问题时，我遇到了命名空间冲突。事实证明`Brush`，`Color`类存在于两个不同的命名空间中`System.Windows.Media`，`System.Drawing`并且它们具有相似的函数名称，但也存在差异。

如果您使用如下所示的控件，它会使用 Media 命名空间，因此请确保在使用此对象的任何位置都添加了正确的命名空间。

```
<Button Content="Change Color" Background="AliceBlue"/> 
```

已接受答案中的这部分确实是正确的（最佳）答案，但很高兴了解命名空间。

```
Brush color = (SolidColorBrush)new BrushConverter().ConvertFromString("Green"); 
```

请注意，以下内容（如已接受的答案中所建议）不会在此命名空间中编译。

```
Color red1 = Color.FromName("Red"); // don't even try, its wrong namespace 
```

因为`Color`类中`System.Windows.Media`没有`FromName()`成员所以它甚至不适用。

上面有这么多的解决方案，但没有人提到命名空间，答案真的取决于这个。这个问题实际上是关于 Media 命名空间的，因为它有颜色名称，但没有提到可能会使尝试这些解决方案的新读者感到困惑。

像我这样的许多人甚至可能不需要转换并使用问题本身中提到的枚举。

```
Brush color = Brushes.Red; 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2016-11-22T15:07:36.930

您可以使用[System.Drawing.KnownColor](https://msdn.microsoft.com/en-us/library/system.drawing.knowncolor(v=vs.110).aspx)枚举。它指定所有已知的系统颜色。

# javascript - Drawing a caret between a point and a draggable div

> ID：372694
> 
> 赞同：0
> 
> 时间：2008-12-16T21:01:20.577
> 
> 标签：javascript, html, popup, draggable

I have a draggable div that represents a little info popup that the user can drag around the screen. But this div is anchored to a point on the screen, and I would like there to be a caret drawn between the div and the point that it is anchored to.

An example of this can be found on Google maps, when you hover over a store or point of interest that you've searched for. You'll see a caret drawn between the point and the popup. This is simple enough, but their popup is not draggable while mine is.

So what is the best way to implement this? I'm thinking of using a series of caret images that are resized depending on the orientation of the popup relative to the anchor point. It'll get tricky in that I'll have to use a different type of caret depending on the angle at which the popup is placed relative to the anchor. Is there a better way to do this?

Thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T22:04:18.657

所以你实际上是在尝试在屏幕上的两点之间绘制动态图像？我不确定这在 HTML 中有多实用。dom 不支持图像旋转，并且图像大小的质量受到限制。您可以进行服务器大小的图像生成，但这会很慢并且会给您带来很高的服务器负载。

一些较新的浏览器（不是 IE）支持 Canvas 对象，如果您愿意排除 80% 的用户，则可以这样做。

最后，我不确定是否有比您已经在想的更好的解决方案 - 我不确定它的效果如何。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T18:10:55.003

[这篇关于在 JavaScript 中绘制线条的](http://www.p01.org/releases/Drawing_lines_in_JavaScript/)教程可能对您有所帮助，因为它向您展示了如何使用 JavaScript 进行相对高效的动态线条绘制（参见页面底部的示例）。

此外，我还使用[jsgraphics](http://www.walterzorn.com/jsgraphics/jsgraphics_e.htm)库通过清除当前行并在用户每次移动线的端点时绘制一个新行来实现类似的效果。

# c++ - 是否有一个标准的 C++ 函数对象用于拆分 std::pair？

> ID：372695
> 
> 赞同：10
> 
> 时间：2008-12-16T21:01:42.900
> 
> 标签：c++, boost, std, tr1, std-pair

有谁知道是否存在用于访问 std::pair 元素的事实上的标准（即 TR1 或 Boost）C++ 函数对象？在过去的 24 小时内，我曾两次希望拥有类似`keys`Perl 哈希函数的东西。例如，最好在 std::map 对象上运行 std::transform 并将所有键（或值）转储到另一个容器。我当然可以编写这样一个函数对象，但我更愿意重用一些吸引眼球的东西。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-16T22:03:10.377

`boost::bind`就是你要找的。

```
boost::bind(&std::pair::second, _1); // returns the value of a pair 
```

例子：

```
typedef std::map<std::string, int> map_type;

std::vector<int> values; // will contain all values
map_type map;
std::transform(map.begin(), 
               map.end(), 
               std::back_inserter(values), 
               boost::bind(&map_type::value_type::second, _1)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T21:08:31.390

从您提出问题的方式来看，我不确定这是一个正确的回答，但请尝试`boost::tie`（Boost::tuple 库的一部分）。它也适用于`std::pair`s。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T22:03:41.403

[boost::bind](http://www.boost.org/doc/libs/1_37_0/libs/bind/bind.html)通常用于调整 std::map 容器以用于算法。[这](http://www.informit.com/articles/article.aspx?p=412354&seqNum=4)是一个例子：

```
void print_string(const std::string& s) {
  std::cout << s << '\n';
}

std::map<int,std::string> my_map;
my_map[0]="Boost";
my_map[1]="Bind";

std::for_each(my_map.begin(), my_map.end(),
              boost::bind(&print_string, boost::bind(
              &std::map<int,std::string>::value_type::second,_1))); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-21T17:16:27.533

使用不同容器的组合怎么样。

例如，当我想将向量划分为包含在补充地图中的项目和未包含在补充地图中的项目时，我使用了以下内容：

```
typedef int DWORD; 
typedef std::pair<std::string, bool> user_info; 
typedef std::map<DWORD, user_info> USER_MAP; 
typedef std::vector<DWORD> VEC_STAFF; 

VEC_STAFF::iterator it = std::partition(Staff.begin(), Staff.end(), (bind(&USER_MAP::find, m_Users, _1) != m_Users.end())); 
```

现在我有第二个问题 - 在应用程序运行期间，user_info 的状态布尔值可以更改，稍后我想用状态布尔值为 true 的项目重新分区向量，而不仅仅是包含在补充地图中.

但是，我似乎在访问嵌套对的第二项时遇到了问题。

我尝试了以下方法，但似乎无法访问嵌套对！

```
CActiveUsers::VEC_STAFF::const_iterator itCurEnd = partition(Staff.begin(), Staff.end(), bind(&USER_MAP::value_type::second::second, bind(&USER_MAP::find, &m_Users, _1)) == true); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-17T17:14:33.893

看看 boost::adaptors。有预定义的适配器用于迭代映射键或值而不将它们复制到中间容器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-18T18:15:33.827

未建议的一个选项是`std::tr1::get`. [请参阅n1745](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1745.pdf)的第 6.1.2 和 6.1.4节。

```
std::pair< std::string, int > p( "foo", 1729 );

int hr = std::tr1::get< 1 >( p ); 
```

绝对不像你提到`bind`的`map`提取案例那么容易使用，但仍然值得了解。改编 Johannes 的代码：

```
typedef std::map<std::string, int> map_type;

std::vector<int> values; // will contain all values
map_type map;

// std::tr1::get is overloaded so we need to help the compiler choose
const map_type::value_type::second_type & (*get)( const map_type::value_type & ) =
  &std::tr1::get< 1, map_type::value_type::first_type, map_type::value_type::second_type >;

std::transform(map.begin(), 
               map.end(), 
               std::back_inserter(values), 
               get); 
```

# sql-server - Funky Line feeds in MS SQL

> ID：372696
> 
> 赞同：1
> 
> 时间：2008-12-16T21:02:04.243
> 
> 标签：sql-server

When I inserted text from one SQL Server VARCHAR(MAX) field in one database to another, I get question mark symbols - "?" - in the target database (in addition to line feeds) whenever there are line feeds in the source database.

Text in the target database looks like this:

Line one.?
?
Line two.?
?

Any ideas about what could cause this, and how to fix it?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T21:19:25.347

两个数据库是否具有相同的排序规则？也许他们使用不同的编码，当你粘贴它给你这样奇怪的结果？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T06:36:28.450

您如何插入数据以及如何读取数据？

如果您确实有不同的排序规则，则可以根据需要在输入（或输出）的方式上进行转换。
[http://msdn.microsoft.com/en-us/library/ms179886.aspx](http://msdn.microsoft.com/en-us/library/ms179886.aspx)

此外，您可能需要检查输入数据的质量和来源。可能需要清除特殊字符。

# c++ - Get/Set in the c++ world, faux-pas?

> ID：372700
> 
> 赞同：15
> 
> 时间：2008-12-16T21:03:31.183
> 
> 标签：c++, oop

I notice that get/set is not the c++ way as far as I can tell by looking at boost/stl, and even reading the writings of some of the top c++ experts.

Does anyone use get/set in their c++ class design, and can someone suggest a rule of thumb on where if at all this paradigm belongs in the c++ world?

It is obviously very popular in Java, and imitated by c# using Property syntactic sugar.

EDIT:

Well after reading more about this in one of the links provided in an answer below, I came across at least one argument for keeping the accessors of a member field the same name as the member field. Namely that you could simply expose the member field as public, and instead make it an instance of a class, and then overload the () operator. By using set/get, you'd force clients to not only recompile, but to actually change their code.

Not sure I love the idea, seems a bit too fine grained to me, but more details are here:

[C++ Killed the Getter/Setter](http://www.kirit.com/C%2B%2B%20killed%20the%20get%20%26%20set%20accessors)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-16T21:17:55.163

C++ 没有像 C# 这样的属性。可以编写名称中带有“get”和“set”的方法，但它们不会自动创建属性。那么使用 get 和 set 方法是一种好习惯吗？

在 C++ 中使用 get 和 set 方法对于访问类属性并不坏。STL 和 boost（受 STL 影响）只是选择了一种设计——为你的类有不同的设计是完全可以的。

在我的工作中，我们确实使用 get 和 set。原因主要是它可以编写解析器以通过其他接口自动包装 C++ 类——ActiveX、.NET、LabVIEW、Python 等。当使用 Visual Studio 的智能（以及其他 IDE 上的类似技术）时，我发现使用 get 和 set 方法可以更轻松地找到我想要的东西。因此，有时使用 get 和 set 方法是有益的。

最重要的是为你的库选择一个代码风格标准并与之保持一致。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T21:26:01.853

封装是一个 OOP 概念，它适用于所有 OOP 语言。公共数据成员会破坏封装。如果您有一个不需要封装的非常简单的对象，这可能很好，但是这些情况是例外的，一旦您做出决定，就很难返回并撤消它。

对于大多数对象，您将希望拥有 getter 和 setter，但您应该始终考虑在编写它们时如何实际使用该对象。Boost 和 STL 充满了 getter 和 setter，它们只是不使用名称“get”和“set”，而是使用“length”、“end”、“reserve”、“capacity”等名称。不要使用 get 或 set 这两个词，因为这些函数的目的不仅仅是在对象中设置一个值。

你的 getter 和 setter 也应该这样做。与其根据对象的工作方式来设计界面，不如根据对象的使用方式来定义它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-16T21:24:45.740

一般来说，get/set 方法通过暴露内部实现和状态来颠覆封装。如果您发现自己对类中的每条数据都使用 get/set，则最好将其设置为仅包含公共数据且没有方法的简单聚合类型。

我并不真正购买 get/set 可以更轻松地执行诸如使您的类线程安全之类的事情，因为您可以提供的有限同步可以防止所有错误类型的竞争条件。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-16T21:29:46.947

您绝对可以在 C++ 中使用访问器。这是[一篇](http://www.kirit.com/C%2B%2B%20killed%20the%20get%20%26%20set%20accessors)关于提出好的访问器方案的好文章。[相关文章](http://www.kirit.com/C%2B%2B%20killed%20the%20get%20%26%20set%20accessors/A%20simple%20meta-accessor)还向您展示了一个简单的元访问器助手类，以帮助您轻松定义这些智能访问器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-18T20:35:44.013

我几乎总是使用 get/set 方法，主要是因为您可以在它们上设置断点并找出正在设置（或访问，尽管这不太常见）的数据成员的位置。此外，您可以在 setter 例程（和 getter 例程，尽管这不太有用）中添加调试断言，以确保在设置值时对象处于有效状态。

如果您创建一个子类，它也很有用；有时子类想要进行一些计算，而不仅仅是重新调整值。将 getter 例程设为虚拟，然后在子类中覆盖它，这很容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-16T21:10:43.897

I don't know whether it's recommended usage or not, but I use get/set functions in my C++ classes regularly, and I've been writing C++ code for more than two decades now. I've never looked at Java or C#, so I didn't pick up the habit from those languages.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-16T21:13:16.653

I tend to have getters and setters, i just don't tend to call them "getX and "setX", usually i'll do something like this for example:

```
int x = o->x() // getter
o->setX(5); // setter 
```

i find that having the getter simply be the name of the "property" just reads better.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-01T16:34:40.567

在这里有点说教...

访问器有两个方面：

*   在语言的语法范围内工作
*   沟通意图

还有第三个方面经常被忽略，那就是优雅地处理变化。您链接到的我的文章解决了最后一点，但没有告诉您有关其他两个的任何信息。

尝试在您使用的语言的语法范围内处理更改主要是一个技术问题，可以将一些技巧放在一个网页上，并用一些代码来支持它。

最难的方面是传达意图，而做到这一点的方法是坚持语言的习语。不幸的是，在 C++ 中，语法在某种程度上阻碍了这一点，所以我们在集合上有 .size() ，在对上有 .first 和 .second 。它们都是访问器，但语法会根据实现而变化——哎呀。

现在，eJames 谈到了打破封装的公共成员。成员是否公开与封装无关。封装是对象和控件设计的产物，类设计者在他们使用的语言中可用。这是我在“Encapsulation is a Good Thing™”中更深入地探索的内容（这个网站还不允许我添加链接，但我想这对 Google 来说并不太难）。

这给我们留下的是，在 C++ 中，派生属性*必须*使用方法调用语法。非派生字段不是必须的，但如果您愿意，可以选择。如果您确实使用方法调用语法，那么您必须自己编写包装方法。不难，但它肯定会增加行数。我试图展示的是一种使用 C++ 模板语言抽象出访问器代码的方法。它并不完全成功，但它确实处理了许多用例。

至于我们是否应该使用访问器，问题在于 C++ 语法将普通成员访问和方法访问之间的区别强加给了我们作为开发人员。这很烦人，但我们确实有一些工具可以解决这个问题。

作为库开发人员，我发现始终使用方法调用语法有助于我构建更强大的 API，因为如果我发现我想用更复杂的东西替换普通成员，那么它会给我更多不需要的选项很多语法。请记住，我可以通过适当使用强制转换运算符和赋值运算符来抽象另一种方式并让“函数”看起来像一个值——实际上也许我会尝试一下，看看我对它的感觉:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-16T21:26:55.847

我的经验是通过 C++ 和 Java，虽然现在我在 PHP 中工作。我用于 PHP 和 C++ 的一般经验法则是：

1.  如果您需要一个成员变量可以从类外部读取但不可写：仅使用 getVariableX()。

2.  如果您想允许在类之外更改/读取成员变量，但需要在更改其值之前/之后对它们执行额外的工作：使用 setVariableX() 和 getVariableX()。

3.  如果可以从类外部更改成员变量，并且 set/get 方法只是简单的赋值：只需将变量设为 public，因为这就是您使用 set/gets 所做的事情（只是以更模糊的方式）。

请注意，如果您的 get 和 set 方法所做的不仅仅是简单地获取和设置，那么您可能应该重命名它们以更准确地描述它们的功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-16T21:29:03.737

我只在别无选择时使用 getter/setter。如果可以，我会使用这种模式（不是说这是一种好习惯，而是说我始终如一地这样做）：更改属性不会影响对象的行为，直到真正需要它。例如：

```
myWnd->Title = "hello"; // not a setter, just a LPCSTR member
myWnd->Title = "world";
myWnd->ShowWindow();    // perhaps updates a WNDCLASS structure
                        // and other complicated things that
                        // the user of the class doesn't want to know 
```

我知道这意味着我将不得不编写一些人为的私有方法来更新对象的内部状态，但如果需要努力向类用户隐藏复杂性，我将不得不这样做。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-16T21:30:34.450

我会做一些猜测。

*   C 甚至没有 getter/setter 的可能性，因此有使用直接访问成员的习惯，就像在结构中一样。这个习惯停留在 C++ 中。
*   C/C++ 一直偏爱速度，如果旧编译器有可能无法正确内联，那么 getter/setter 会降低速度。

这些都不是令人信服的理由。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-18T00:14:43.057

即使 c++ 不通过模拟它们来支持属性访问器，我们不仅可以提高可读性或提供封装，而且我们提供控制机制来为变量设置值或获得变量的计算值。所以这是访问者的最终目的。为了实现这些目标，语言必须直接支持访问器。时期。

# c# - 让 log4net 使用应用程序配置文件获取配置数据

> ID：372703
> 
> 赞同：53
> 
> 时间：2008-12-16T21:03:47.623
> 
> 标签：c#, logging, log4net

我想将 log4net 配置数据存储在我的 application.config 文件中。根据我对文档的理解，我做了以下事情：

1.  添加对 log4net.dll 的引用

2.  在 AssemblyInfo.cs 中添加以下行：

    ```
    [assembly: log4net.Config.XmlConfigurator(Watch = true)] 
    ```

3.  初始化记录器如下：

    ```
    private static readonly ILog log = LogManager.GetLogger(typeof(frmWizard)); 
    ```

4.  我的 app.config 中有以下代码：

```
 <configSections>
      <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
    </configSections>
    <log4net>
      <appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" >
        <layout type="log4net.Layout.PatternLayout">
          <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
        </layout>
      </appender>
      <root>
        <level value="INFO" />
        <appender-ref ref="ConsoleAppender" />
      </root>
    </log4net> 
```

但是，当我运行应用程序时，控制台上出现以下错误：

> 找不到名为 [Consoleappender] 的附加程序。

如何让 log4net 从配置文件中读取设置？

谢谢！

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-16T21:13:04.843

在 configSections 元素的 app.config 中添加一行

```
<configSections>
 <section name="log4net" 
   type="log4net.Config.Log4NetConfigurationSectionHandler, log4net, Version=1.2.10.0, 
         Culture=neutral, PublicKeyToken=1b44e1d426115821" />
</configSections> 
```

然后稍后添加 log4Net 部分，但委托给其他地方的实际 log4Net 配置文件......

```
<log4net configSource="Config\Log4Net.config" /> 
```

在您的应用程序代码中，当您创建日志时，编写

```
private static ILog GetLog(string logName)
{
    ILog log = LogManager.GetLogger(logName);
    return log;
} 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2012-10-20T14:13:19.863

从问题中显示的配置中，只配置了一个附加程序，它被命名为“EventLogAppender”。但是在 root 的配置中，作者引用了一个名为“ConsoleAppender”的附加程序，因此出现了错误消息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-01-20T14:46:25.163

我完全支持@Charles Bretana 的回答。但是，如果它不起作用，请确保**只有一个`<section>`**元素并且它`configSections`是**根元素的第一个子元素**：

`configsections`必须是您`app.Config`配置后的第一个元素：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="log4net"  type="log4net.Config.Log4NetConfigurationSectionHandler, log4net, Version=1.2.10.0, Culture=neutral, PublicKeyToken=1b44e1d426115821" />
  </configSections>
  <!-- add log 4 net config !-->
  <!-- add others e.g. <startup> !-->
</configuration> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-16T21:09:32.807

您是否尝试将`configsection`处理程序添加到您的 app.config？例如

```
<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-12-30T17:36:57.827

所有附加程序名称都必须反映在根部分中。
在您的情况下，附加程序名称是**EventLogAppender**但在该`<root> <appender-ref ..`部分中它被命名为**ConsoleAppender**。他们需要匹配。

您可以将多个附加程序添加到您的日志配置中，但您需要在该`<root>`部分中注册每个附加程序。

```
<appender-ref ref="ConsoleAppender" />
<appender-ref ref="EventLogAppender" /> 
```

您还可以参考 apache[文档](http://logging.apache.org/log4net/release/manual/configuration.html)配置 log4net。

# jstl - c:import 或 c:url - 指定超时值

> ID：372712
> 
> 赞同：4
> 
> 时间：2008-12-16T21:06:14.967
> 
> 标签：jstl

我想使用 c:import 或 c:url 来获取页面的内容（广告服务器）。此外，我需要指定一个超时时间，如果调用超时或页面不可访问，我需要一些默认文本作为我的值返回。

有没有一个jstl标签库来做到这一点？还是我需要自己创建？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-25T02:42:46.443

有点儿。

c:import 打开一个到服务器的套接字并简单地返回连接的作用（在你的例子中是原始的 html）。如果服务器返回的页面是 404，那么这就是将显示的内容，一个 500，那么你会得到错误页面。

因为它是一个套接字，所以它可以访问所有套接字错误。对于超时：

```
 java.net.ConnectException: Operation timed out 
```

未知主机：

```
 java.net.UnknownHostException: www.googasdasdasdassdle.com 
```

这意味着您可以将导入包装在 catch 语句中并在页面上处理。

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<c:catch var="socketExceptionVariable">
    <c:import url="www.googasdasdasdassdle.com"/>
</c:catch>

<c:if test="${socketExceptionVariable != null}">
    <p>There was an error here</p>
    <c:out value="${socketExceptionVariable}"/>
</c:if> 
```

如果导入发生，那么它会按预期工作，但如果出现问题（任何事情），则会显示您的错误页面。

您可以编写自己的导入标签，但它封装了这一点，但与此解决方案相比，它的工作量相当大。

# c++ - 构造函数c ++的问题

> ID：372714
> 
> 赞同：4
> 
> 时间：2008-12-16T21:07:24.997
> 
> 标签：c++

所以我有这些武器类的构造函数的代码：

```
Weapon(const WeaponsDB * wepDB);
Weapon(const WeaponsDB * wepDB_, int * weaponlist);
~Weapon(void); 
```

我不断收到错误消息：

```
1>c:\users\owner\desktop\bosconian\code\bosconian\weapon.h(20) : error C2062: type 'int' unexpected 
```

和随之而来的错误（超过列出的）：

```
1>c:\users\owner\desktop\bosconian\code\bosconian\weapon.h(21) : error C2059: syntax error : '('
1>c:\users\owner\desktop\bosconian\code\bosconian\weapon.h(21) : error C2238: unexpected token(s) preceding ';'
1>c:\users\owner\desktop\bosconian\code\bosconian\weapon.h(33) : error C2327: '<unnamed-tag>::maxWeapons' : is not a type name, static, or enumerator
1>c:\users\owner\desktop\bosconian\code\bosconian\weapon.h(33) : error C2065: 'maxWeapons' : undeclared identifier
1>c:\users\owner\desktop\bosconian\code\bosconian\weapon.h(38) : warning C4094: untagged 'class' declared no symbols 
```

我是一个半新手，我无法弄清楚。

第 21 行是第二个构造函数，第一个不会导致错误。此外，如果我注释掉这个构造函数，我仍然会得到该构造函数之后列出的所有错误。知道问题可能是什么吗？

以下是前面的代码供参考：

```
#ifndef Weapon
#define Weapon
#include <allegro.h>
#include <stdio.h>
#include <iostream>

using namespace std;

class WeaponsDB;
class MenuDriver;
class Ammo;

class Weapon
{
public:
..... 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-16T21:17:03.230

```
#ifndef Weapon
#define Weapon 
```

这几乎肯定会引起怪异。改为调用常量 WEAPON_H。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T21:14:51.487

因此，您将类命名为与预处理器指令相同？这是我会避免的。

尝试更改您的预处理器 Weapon 或制作不同的类名。我认为它会更好地工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-16T21:17:59.500

我认为问题出在#define Weapon - 代码中稍后出现的任何“Weapon”都将被删除或替换为您不想要的东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-16T21:26:06.597

补充蒂姆的答案。你会看到这样的代码：

```
#ifndef Weapon
#define Weapon
#include <allegro.h>
#include <stdio.h>
#include <iostream>

using namespace std;

class WeaponsDB;
class MenuDriver;
class Ammo;

class Weapon
{
public:
   Weapon(const WeaponsDB * wepDB);
   Weapon(const WeaponsDB * wepDB_, int * weaponlist);
   ~Weapon(void);
} 
```

但是您已将预处理器宏定义`Weapon`为空字符串，因此编译器会看到：

```
#ifndef Weapon
#define Weapon
#include <allegro.h>
#include <stdio.h>
#include <iostream>

using namespace std;

class sDB;
class MenuDriver;
class Ammo;

class 
{
public:
   (const sDB * wepDB);
   (const sDB * wepDB_, int * weaponlist);
   ~(void);
} 
```

只需更改包含保护以使用不作为名称出现的字符串（例如`WEAPON_H_INCLUDED`）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-17T18:44:03.333

像已经提供的其他答案一样，我也怀疑预处理器指令。

要确认，比如在 GCC 上，您可以要求它只运行预处理器并将输出保存在某处。您使用的编译器可能有类似的功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T21:31:52.793

我不知道这是否是 Microsoft 特有的（我最近只使用过 VS2005），但这有效。我开始我所有的头文件：

```
#pragma once 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T23:16:41.630

GCC 也支持“#pragma once”，但它不是标准的，如果您使用传统的包含保护 #ifndef _MYFILE_H_ 或一些变体，代码会更便携。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-17T11:19:56.880

快速说明：在 C++ 中，与 C 不同，当函数（或析构函数，在这种情况下）没有任何参数时，您不需要使用 (void)，只需使用 ()。

# asp.net - AJAX calendar extender display issue in Safari

> ID：372715
> 
> 赞同：1
> 
> 时间：2008-12-16T21:07:40.003
> 
> 标签：asp.net, ajax, controls

Ok, this is not a CSS issue, I removed all styling from the page. This is a calendar extender that has a target id of a textbox and the popupbutton is the same text box.

The month name is displaying lower than the days, so it's not usable.

it's fine in IE.

I am using Safari in Windows Vista.

Does anyone know what is causing this?

Thank you.

I don't know why this was voted down, is there some information I'm missing? This isn't a duplicate question.

UPDATE:

here is the c0dez:

```
 <label>date</label>
                    <asp:TextBox ID="txtDate" CssClass="field" runat="server" />
                    <asp:RequiredFieldValidator ID="RequiredFieldValidator2" runat="server" ControlToValidate="txtDate" Text="*" />
                <ajaxtoolkit:CalendarExtender ID="CalendarExtender1" runat="server"
                    TargetControlID="txtDate"
                    Format="MMMM d, yyyy"
                    PopupButtonID="txtDate" PopupPosition="BottomLeft" /> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T21:23:39.393

我认为它被否决是因为您没有在问题中输入任何代码，所以看起来您是在寻求对 Safari 浏览器的支持，而不是就 safari 如何处理 AJAX 的特殊性寻求帮助。换句话说，您需要更加具体和清晰。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T13:58:24.427

菜单控件和 Safari 也有类似的问题。我必须在 App_Browser 文件夹中创建一个 safari.browser 文件。此文件夹包含 ASP.NET 用于识别各个浏览器并确定其功能的浏览器定义文件。这是我必须放入 safari.browser 文件中的内容。

```
<browsers>
    <browser refID="safari1plus">
        <controlAdapters>
            <adapter controlType="System.Web.UI.WebControls.Menu" adapterType="" />
        </controlAdapters>
    </browser>
</browsers> 
```

您可以尝试的另一件事是修改日历的基本 css 样式。Ajax 日历扩展器有一组预定义的可以被覆盖的 CSS 类。

如果您访问[http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Calendar/Calendar.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Calendar/Calendar.aspx)并且在页面底部有一个关于日历主题的主题，列出了所有日历 Css 类。

希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-18T13:39:57.627

我今天遇到了同样的问题。

该解决方案虽然在网络上有些难以找到，但相当简单

创建一个新的 Div，其位置设置为 relative (style="position:relative;")

并将您的文本框和 calendarExtender 放在 Div 中。

这解决了我面临的问题，我希望它也对你有用

类似问题： [CalendarExtender 定位问题](https://stackoverflow.com/questions/958555/calendarextender-positioning-problem/3512636#3512636)

# c# - 显示没有最大化按钮的恢复按钮

> ID：372718
> 
> 赞同：1
> 
> 时间：2008-12-16T21:08:13.903
> 
> 标签：c#, winforms, restore, maximize

我想阻止用户将 Windows 窗体最大化到全屏，所以我禁用了最大化按钮。但是，我希望能够让用户“恢复”表单。当他们单击“恢复”按钮时，我希望它显示一个不同的、较小的、缩小的表单，这将向他们显示一个最大化按钮，该按钮会将使用返回到原始表单。

有没有办法做到这一点？

谢谢。

编辑：你不明白，我并没有阻止用户调整表单的大小。发生的事情是当单击恢复按钮时，它将隐藏表单并打开一个控件较少的新表单。当他们在较小的表单上单击最大化时，它将返回到原始表单。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T15:52:59.047

我在工作中看到了与此类似的问题，我能找到的唯一解决方案涉及设置未记录的窗口样式，我不倾向于这样做。

因此，我认为解决您的问题的最佳方法是隐藏当前的最小化/最大化/恢复按钮，并使用一些 ownerdraw 或其他命令添加您自己的按钮。

从用户交互的角度来看，我希望最小化/最大化/恢复按钮对您的应用程序执行与对所有其他应用程序执行完全相同的操作。覆盖该功能会给您的用户造成混乱，因此我建议在标题栏或界面上的其他位置创建不同的按钮来执行此功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T21:15:25.260

您可以设置MaximumSize和MinimumSize并启用最大化按钮来获得这种效果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T22:16:49.240

FWIW，正确的答案是使您的表单正确调整大小，以适应任何窗口大小，而不是将用户限制在*您的*显示器上以*您的*分辨率和字体大小显示*的正确内容。*不可调整大小的窗口是我在应用程序中遇到的最烦人的事情之一（Windows 本身就充满了它们）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-16T16:35:28.693

我最近遇到了类似的情况，从 UI 设计的角度来看，在 Windows Media Player 中找到了一个很好的例子。它保留了“最小化”、“最大化”和“恢复”按钮，并在右下角有一个单独的按钮，用于“切换到紧凑模式”。在迷你/紧凑模式下，相同的按钮切换到“切换到完整模式”。另一个替代示例是 Skype，它在标准最小化按钮的左侧有一个额外的系统图标按钮，可以在紧凑模式和标准模式之间切换。

（如果我有特权，我更愿意将此作为评论添加到 Daemin 接受的答案中，对于 StackOverflow 来说仍然相对较新）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-23T18:27:21.707

“恢复”表单会触发`Resize`事件，您可以在该事件中检查父表单是否不再是`FormWindowState.Maximized`。如果没有，您可以打开子窗体并隐藏父窗体。

要扭转这种情况，您可以通过隐藏（或处置）子表单来“最大化”子表单，然后取消隐藏并将父表单设置为`FormWindowState.Maximized`.

我可以使用此方法看到的唯一问题是该`Resize`事件可能会在表单达到最大化状态之前触发多次。可能需要一个标志来忽略这些，直到表单从当前状态变为所需状态，这可能导致无限循环。

# perl - What is the smallest program possible to parse an email message header?

> ID：372721
> 
> 赞同：4
> 
> 时间：2008-12-16T21:08:37.363
> 
> 标签：perl, email, header

the homework: [http://www.cs.rit.edu/~waw/networks/prob1.082.html](http://www.cs.rit.edu/~waw/networks/prob1.082.html)

Ok, I am still confused why this question was asked for my data communications and networks class, but here is the question from my homework:

> 8.  Write a computer program that reads the header on an e-mail message and deletes all lines except those that begin with
>     
>     
>     
>     From:, To:, Subject: and Cc:.
>     
>     
> 
> CONTEST -- Who can write the shortest program that does this.

So after thinking for a bit I decided that the following Perl code was as small as I could do this.

```
#!/usr/bin/perl

while (<>) { print "$_" if ($_ =~ m/^(To:|From:|Subject:|Cc:)/); } 
```

All this does is act like a filter for which the only output is lines that start with From:, To:, Subject: and Cc: as specified in the question. Since there aren't any specific details I think that the above code works to at least correctly answer the question.

Now, I wonder how small a program could possibly written for this? I can understand if no one wants to post code because they think I will use it for the assignment, but I am more or less looking for suggestions and techniques that could help me write the shortest program possible.

Also, I am quite sure by shortest he is referring to actual code length. He did mention that scripting languages were the way to go so I doubt he is considering something like the overhead involved with an interpreter. This also means that he does not care which language is used.

Thanks for looking!

EDIT: Thanks for the suggestions! I had been reading questions here for quite a while, hopefully in the future I can contribute more. Also, some of the suggestions I trimmed my Perl code down to 55 bytes. I don't think we will need to deal with something like a multi-line header.

BONUS: Who can identify a good reason why this was asked in a class where we are discussing things like packet switching and client/server architectures?

EDIT2: For the record, my professor said that someone did this with something like 55 bytes. The only way I see that as being possible is if he was only asking for a simple implementation like the one above.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-16T21:18:59.997

一些提示：

*   `print "$_"`等于`print`
*   while(<>) {...} 可以通过将 -n 添加到该`#!`行的选项来替换/
*   $_ =~ m// 等于 //
*   您正在输入四个`:`，其中一个就足够了。

就像是

```
#!/usr/bin/perl -n
print if /^(To|From|Subject|Cc):/; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-16T22:59:27.203

好的，这是一个多行匹配程序：

```
$/="";$_=<>;print$&while/^(To|From|Subject|Cc):.*\n( .*\n)*/mg 
```

你想要短，不漂亮，对吧 ;-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T22:25:24.247

你为什么要首先获得**最短**的程序？从正确的解决方案开始，然后将其编辑为您无法再删除。语法和类型不会成为正确解决方案的瓶颈。即使你的程序比其他人的程序长，如果你是唯一一个做对的人，你仍然会赢。:)

阅读[RFC 2822，“Internet 消息格式”](http://www.faqs.org/rfcs/rfc2822.html)以了解您必须处理的内容。

然后，查看已经存在的现有电子邮件解析库，以了解它们必须处理的恶作剧。一旦你认为你有一个解决方案，因为你遵循 RFC，就开始处理所有损坏的邮件。

如果您只是想完成工作，请使用正确的工具。如果您只想处理消息，这是 formail 的工作，但是您必须编写紧凑的代码来运行通过您的网络的所有消息，然后像[qsmtp](http://opensource.sf-tec.de/Qsmtp/)（MTA 的 mod_perl）之类的东西可能就是您想要的.

至于你为什么要这样做，当你问的时候，教练是怎么说的？您应该养成为任何作业指定所需的最终状态和约束的习惯，无论是在学校还是在“真正的”工作中。

* * *

这是一个正确完成任务的正确程序。我的有点长，因为我还阅读了源中的所有电子邮件（几乎可以是任何常见的电子邮件存储格式，例如 mbox、maildir 等），并且我只从每封邮件中提取标题。这只有 51 个字符：

```
 formail -s formail -c -XTo: -XFrom: -XCc: <my_inbox 
```

如果您希望有一个 Perl 解决方案，以便对输出有更多的控制，这也是：

```
#!/usr/bin/perl

使用电子邮件::文件夹；

我的 $folder = 电子邮件::文件夹->new($ARGV[0]);

foreach 我的 $message ( $folder->messages )
    {
    打印
        加入“\n”，
        地图 {
            我的 $h = $message->header( $_ );
            定义 $h ? "$_: $h" : ();
            }
        qw（从到抄送）；

    打印“\n\n”；
    }   

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T21:19:22.147

好吧，假设你的标题在一个字符串中，每行一个项目（To:、From: 等）命名为 $head，那么在 Powershell 中它将是：

$head.Split("`n") | ?{$_ -match "[To|From|Subject|Cc]:"}

# iphone - How can I set a button background color on iPhone?

> ID：372731
> 
> 赞同：37
> 
> 时间：2008-12-16T21:10:59.623
> 
> 标签：iphone, cocoa-touch

How can I set a custom background color of a button?

Interface Builder doesn't seem to have an interface to do this.

Is it only available programmatically? If so, can you provide an example, please?

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-08T22:05:14.040

我读了您的问题，**要求**（就像我一样）以**编程**方式设置按钮颜色。这是 UIKit 的一个明显遗漏，我无法让未记录的 UIGlassButton 工作。

我已经用一个段**解决**`UISegmentedControl`了这个问题，它允许你设置`tintColor`：

```
UISegmentedControl * btn = [[UISegmentedControl alloc] initWithItems:[NSArray arrayWithObject:name]];
btn.momentary = YES;
btn.segmentedControlStyle = UISegmentedControlStyleBar;
btn.tintColor = color;
[btn addTarget:self action:@selector(action:) forControlEvents:UIControlEventValueChanged]; 
```

请注意`momentary`和`segmentedControlStyle`属性确实很重要，并且可以使用图像代替`NSString *`名称。

如果您可以使用有限的固定图像集，则带有端盖的可拉伸图像可以正常工作，但这不符合要求！例如，

```
buttonImage   = [[UIImage imageNamed:@"button.png"] stretchableImageWithLeftCapWidth:26 topCapHeight:16]; 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-17T03:29:07.847

我发现我需要使用可拉伸的图像来完成此操作。Apple 的 UICatalog 示例有一个或多个以这种方式绘制的彩色按钮。您可以使用他们的模板图像并重新着色以适合您的按钮需求。

我不确定是否在 Interface Builder 中执行此操作，但我能够使用以下代码创建一个按钮并为其内容使用图像：

```
downloadButton = [[UIButton alloc] initWithFrame:CGRectMake(36, 212, 247, 37)];

downloadButton.contentVerticalAlignment = UIControlContentVerticalAlignmentCenter;
downloadButton.contentHorizontalAlignment = UIControlContentHorizontalAlignmentCenter;

[downloadButton setTitle:NSLocalizedStringFromTable(@"Download", @"Localized", nil) forState:UIControlStateNormal]; 
[downloadButton setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
[downloadButton setFont:[UIFont boldSystemFontOfSize:14.0]];

UIImage *newImage = [[UIImage imageNamed:@"greenButton.png"] stretchableImageWithLeftCapWidth:12.0f topCapHeight:0.0f];
[downloadButton setBackgroundImage:newImage forState:UIControlStateNormal];

[downloadButton addTarget:self action:@selector(downloadNewItem) forControlEvents:UIControlEventTouchDown];

downloadButton.backgroundColor = [UIColor clearColor];
[downloadDisplayView addSubview:downloadButton]; 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-25T09:33:01.847

Setting the background color of the view for a rounded-rect button will not change the background color of the button. Try making the button a custom button (the first drop-down in the inspector) and then setting the background color. You will get the desired effect :)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-12-17T19:39:00.150

看来，按钮颜色仍然是一个问题。以下类别通过采用 UIColor 参数的实例方法完全以编程方式设置按钮的背景图像。无需创建按钮背景图像文件。它保留基于 UIControlState 的按钮行为。它保留了圆角。

头文件 UIButton+ColoredBackground.h

```
#import <UIKit/UIKit.h>

@interface UIButton (ColoredBackground)

- (void)setBackgroundImageByColor:(UIColor *)backgroundColor forState:(UIControlState)state;

@end 
```

以及 UIButton+ColoredBackground.m 的内容

```
#import "UIButton+ColoredBackground.h"
#import <QuartzCore/QuartzCore.h>

@implementation UIButton (ColoredBackground)

- (void)setBackgroundImageByColor:(UIColor *)backgroundColor forState:(UIControlState)state{

    // tcv - temporary colored view
    UIView *tcv = [[UIView alloc] initWithFrame:self.frame];
    [tcv setBackgroundColor:backgroundColor];

    // set up a graphics context of button's size
    CGSize gcSize = tcv.frame.size;
    UIGraphicsBeginImageContext(gcSize);
    // add tcv's layer to context
    [tcv.layer renderInContext:UIGraphicsGetCurrentContext()];
    // create background image now
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    // set image as button's background image for the given state
    [self setBackgroundImage:image forState:state];
    UIGraphicsEndImageContext();

    // ensure rounded button
    self.clipsToBounds = YES;
    self.layer.cornerRadius = 8.0;

    [tcv release];

}

@end 
```

在每个 UIButton 实例上都会调用新方法，例如：

```
[myButton setBackgroundImageByColor:[UIColor greenColor] forState:UIControlStateNormal]; 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-07-14T14:04:32.900

[http://github.com/dermdaly/ButtonMaker](http://github.com/dermdaly/ButtonMaker)

您可以使用此应用程序生成 UIbutton 图像...并可以将其设置为按钮的背景图像

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-01T16:52:26.447

在按钮属性面板中将按钮类型设置为“自定义”。这将为您提供一个方形按钮，其中包含您为背景选择的任何颜色。

如果您想要一个看起来更像传统按钮但颜色不同的按钮，您需要进入某种图像编辑软件并创建它（我使用 Photoshop 自定义按钮）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-06-24T23:50:05.527

为了使按钮保持圆形，如何使用

```
view.layer.cornerRadius = 8; 
```

这里描述

[如何在 iPhone 上创建圆角 UILabel？](https://stackoverflow.com/questions/510382/how-do-i-create-a-round-cornered-uilabel-on-the-iphone)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-02-02T13:34:41.333

我稍微修改了@Patch 的代码版本。对我来说，问题是旧版本在从纵向模式切换到横向模式时会拉伸角半径有点脏。所以我让这个版本使用了 stretchableImageWithLeftCapWidth:topCapHeight 方法。

```
#import "UIButton+ColoredBackground.h"
#import <QuartzCore/QuartzCore.h>

#define kCornerRadius 8.0f
#define kStrokeColor [UIColor blackColor]
#define kStrokeWidth 1.0f

@implementation UIButton (ColoredBackground)

- (void)setBackgroundImageByColor:(UIColor *)backgroundColor forState:(UIControlState)state{

CGSize gcSize = CGSizeMake(2*kCornerRadius +1, self.bounds.size.height);
UIGraphicsBeginImageContext(gcSize);
CGContextSetBlendMode(UIGraphicsGetCurrentContext(), kCGBlendModeOverlay);

CGColorSpaceRef rgb = CGColorSpaceCreateDeviceRGB();

UIColor *gradientStart = [UIColor colorWithRed:0.80 green:0.80 blue:0.80 alpha:0.2];
UIColor * gradientEnd = [UIColor colorWithRed:0.0 green:0.0 blue:0.0 alpha:0.2];
NSArray *colors = [NSArray arrayWithObjects:(id)gradientStart.CGColor, (id)gradientEnd.CGColor, nil];
CGFloat locations[2] = { 0.0f, 1.0f };
CGGradientRef _gradient = CGGradientCreateWithColors(rgb, (__bridge CFArrayRef)colors, locations);
CGColorSpaceRelease(rgb);
CGContextDrawLinearGradient(UIGraphicsGetCurrentContext(), _gradient, CGPointMake(0.0, kStrokeWidth), CGPointMake(0.0, self.bounds.size.height-kStrokeWidth), 0);

UIBezierPath *outsideEdge = [UIBezierPath bezierPathWithRoundedRect:CGRectMake(0.0, 0.0, gcSize.width, gcSize.height) cornerRadius:kCornerRadius];
[backgroundColor setFill];
[kStrokeColor setStroke];
outsideEdge.lineWidth = kStrokeWidth;
[outsideEdge stroke];
[outsideEdge fill];

// Create the background image
UIImage *image = UIGraphicsGetImageFromCurrentImageContext();    
UIGraphicsEndImageContext(); 

// Set image as button's background image (stretchable) for the given state
[self setBackgroundImage:[image stretchableImageWithLeftCapWidth:kCornerRadius topCapHeight:0.0] forState:state];

// Ensure rounded button
self.clipsToBounds = YES;
self.layer.cornerRadius = kCornerRadius;

}

@end 
```

用法没有改变。现在边缘看起来更清晰了，我还添加了一个渐变来制作更多的塑料。但你也可以删除它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-01-19T23:36:28.137

这是@user200212 解决方案的一个变体（http://stackoverflow.com/a/8547424）。它使用`UIBezierCurve`类来填充按钮并在其周围绘制一个 1px 的黑色边框：

UIButton+ColoredBackground.h

```
//  UIButton+ColoredBackground.h

#import <UIKit/UIKit.h>

@interface UIButton (ColoredBackground)

- (void)setBackgroundColor:(UIColor *)backgroundColor forState:(UIControlState)state;
+ (UIColor *) silverColor;

@end 
```

UIButton+ColoredBackground.m

```
//  UIButton+ColoredBackground.m
#import "UIButton+ColoredBackground.h"
#import <QuartzCore/QuartzCore.h>

@implementation UIButton (UIButton_ColoredBackground)

- (void)setBackgroundColor:(UIColor *)backgroundColor forState:(UIControlState)state{

    CGSize gcSize = self.bounds.size;
    UIGraphicsBeginImageContext(gcSize);

    // Create a Bezier Path around the button, and fill it with the background color
    UIBezierPath *outsideEdge = [UIBezierPath bezierPathWithRoundedRect:self.bounds cornerRadius:8.0f];
    [backgroundColor setFill];
    [[UIColor blackColor] setStroke];
    outsideEdge.lineWidth = 1.0;
    [outsideEdge fill];
    [outsideEdge stroke];

    // Create the background image
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();    

    UIGraphicsEndImageContext(); 

    // Set image as button's background image for the given state
    [self setBackgroundImage:image forState:state];

    // Ensure rounded button
    self.clipsToBounds = YES;
    self.layer.cornerRadius = 8.0;
}

@end 
```

用法：

```
[myButton setBackgroundImageByColor:[UIColor greenColor] forState:UIControlStateNormal]; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-16T08:16:00.000

我通过在 Fireworks 中创建自己的按钮解决了这个问题。我用我想要的填充颜色和边框颜色画了一个大约我想要的大小的圆角矩形。修剪画布，并保存为 PNG。在 XCode 中，将文件添加到 Resources 文件夹。您可以在 Interface Builder 中使用自定义按钮并将图像指定为该 PNG。它会根据需要调整它的大小，将文本放在顶部等。如果您必须从原始大小调整它的大小，拐角的曲线可能会扭曲。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-12-23T05:58:46.730

我按如下方式创建按钮，如 uitableview 中的系统删除按钮

```
 UIButton *h=[[UIButton  alloc]init];
[[h layer] setCornerRadius:8.0f];
[[h layer] setMasksToBounds:YES];
[[h layer] setBorderWidth:1.0f];
CAGradientLayer *gradientLayer = [[CAGradientLayer alloc] init];
[gradientLayer setBounds:[h bounds]];
[gradientLayer setPosition:CGPointMake([h bounds].size.width/2, [h bounds].size.height/2)];
[gradientLayer setColors:[NSArray arrayWithObjects:
(id)[[UIColor darkGrayColor]CGColor],(id)[[UIColor blackColor] CGColor], nil]];
[[h layer] insertSublayer:gradientLayer atIndex:0]; 
```

释放所有对象并导入 QuartzCore/QuartzCore.h 并将此框架添加到您的项目中。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-12-15T19:43:13.647

这是我创建的一个免费应用程序，用于创建 UIGlassButton 图像。将按钮类型设置为自定义。 [http://itunes.apple.com/us/app/uibutton-builder/id408204223?mt=8](http://itunes.apple.com/us/app/uibutton-builder/id408204223?mt=8)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-08-18T20:51:20.133

当我想要一个简单的“保存”按钮和一个不错的蓝色渐变背景时，蒂姆詹姆斯的解决方案（一个单段分段控件）对我有用。我只是在 nib 中创建了一个 2 段控件，根据需要设置第一个段，然后使用 [mySegmentedControl removeSegmentAtIndex:1 animated:NO] 以编程方式删除 -viewWillAppear 下的第二个段。出于我的目的，需要为分段控件在笔尖中的第一个段启用（勾选）“瞬间”，而“选定”对于任何一个段都没有激活。'Value Changed' 是分段控件的连接动作。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-07-08T17:22:58.907

在@Denny1989 的基础上进一步构建，我解决了在 viewDidLoad 中设置按钮时出现错误（无效上下文 0x0）的问题。按钮需要在它具有大小之前进行布局，因此在视图出现之前不能依赖它。此类别为 UIControlStateNormal 添加颜色。如果您的应用需要其他控制状态，您需要将它们添加到类别中。

```
//  UIButton+ColoredBackground.h

#import <UIKit/UIKit.h>

@interface UIButton (ColoredBackground)

@property (nonatomic, retain) UIColor *buttonColorNormal;

@property (nonatomic, retain) NSNumber *madeBackgroundImages;

- (void)setBackgroundColor:(UIColor *)backgroundColor forState:(UIControlState)state;

- (void)drawRect:(CGRect)rect;

- (void)awakeFromNib;

@end 
```

和

```
//  UIButton+ColoredBackground.m

#import "UIButton+ColoredBackground.h"
#import <QuartzCore/QuartzCore.h>
#import <objc/runtime.h>

#define kCornerRadius 8.0f
#define kStrokeColor [UIColor darkGrayColor]
#define kStrokeWidth 1.0f

@implementation UIButton (ColoredBackground)

static char UIB_ButtonColorNormal_KEY;
static char UIB_MadeBackgroundImages_KEY;

@dynamic buttonColorNormal;

-(void)setButtonColorNormal:(NSObject *)buttonColorNormal
{
    objc_setAssociatedObject(self, &UIB_ButtonColorNormal_KEY, buttonColorNormal, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

-(NSObject*)buttonColorNormal
{
    return (NSObject*)objc_getAssociatedObject(self, &UIB_ButtonColorNormal_KEY);
}

@dynamic madeBackgroundImages;

-(void)setMadeBackgroundImages:(NSObject *)madeBackgroundImages
{
    objc_setAssociatedObject(self, &UIB_MadeBackgroundImages_KEY, madeBackgroundImages, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

-(NSObject*)madeBackgroundImages
{
    return (NSObject*)objc_getAssociatedObject(self, &UIB_MadeBackgroundImages_KEY);
}
- (void)awakeFromNib {
    [self setMadeBackgroundImages:[NSNumber numberWithBool:FALSE]];
    [super awakeFromNib];
}

- (void)drawRect:(CGRect)rect {
    // if background images were not created from color do so here
    // if self.buttonColorNormal is not set behaves like normal button
    if ((self.buttonColorNormal)&&(![[self madeBackgroundImages] boolValue])) {
        [self setBackgroundColor:[self buttonColorNormal] forState:UIControlStateNormal];
        [self setMadeBackgroundImages:[NSNumber numberWithBool:TRUE]];
    }
    [super drawRect:rect];
}

- (void)setBackgroundColor:(UIColor *)backgroundColor forState:(UIControlState)state {

    gcSize = CGSizeMake(2*kCornerRadius +1, self.bounds.size.height);
    UIGraphicsBeginImageContext(gcSize);

    CGColorSpaceRef rgb = CGColorSpaceCreateDeviceRGB();

    UIColor *gradientStart = [UIColor colorWithRed:0.80 green:0.80 blue:0.80 alpha:0.2];
    UIColor * gradientEnd = [UIColor colorWithRed:0.0 green:0.0 blue:0.0 alpha:0.5];
    NSArray *colors = [NSArray arrayWithObjects:(id)gradientStart.CGColor, (id)gradientEnd.CGColor, nil];
    CGFloat locations[2] = { 0.0f, 1.0f };
    CGGradientRef _gradient = CGGradientCreateWithColors(rgb, (__bridge CFArrayRef)colors, locations);
    CGColorSpaceRelease(rgb);
    CGContextSetBlendMode(UIGraphicsGetCurrentContext(), kCGBlendModeOverlay);
    CGContextDrawLinearGradient(UIGraphicsGetCurrentContext(), _gradient, CGPointMake(0.0, kStrokeWidth), CGPointMake(0.0, self.bounds.size.height-kStrokeWidth), 0);

    UIBezierPath *outsideEdge = [UIBezierPath bezierPathWithRoundedRect:CGRectMake(0.0, 0.0, gcSize.width, gcSize.height) cornerRadius:kCornerRadius];
    [backgroundColor setFill];
    [kStrokeColor setStroke];
    outsideEdge.lineWidth = kStrokeWidth;
    [outsideEdge stroke];
    [outsideEdge fill];
    CFRelease(_gradient);

    // Create the background image
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    // Set image as button's background image (stretchable) for the given state
    [self setBackgroundImage:[image stretchableImageWithLeftCapWidth:kCornerRadius topCapHeight:0.0] forState:state];

    // Ensure rounded button
    self.clipsToBounds = YES;
    self.layer.cornerRadius = kCornerRadius;

    // add colored border
    self.layer.borderColor = kStrokeColor.CGColor;
    self.layer.borderWidth = kStrokeWidth;
}

@end 
```

用法

```
- (void)viewDidLoad
{
        [myButton setButtonColorNormal:[UIColor redColor]];
} 
```

确保自定义按钮类型，否则 drawRect 可能不会被调用。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-11-22T22:11:05.020

![彩色 UIButton](https://i.stack.imgur.com/DPk3e.png)

如果您不想使用图像，并且希望它看起来与圆角矩形样式完全一样，试试这个。只需在 UIButton 上放置一个 UIView，具有相同的框架和自动调整大小的掩码，将 alpha 设置为 0.3，并将背景设置为一种颜色。然后使用下面的代码片段将圆形边缘从彩色叠加视图中剪掉。此外，取消选中 UIView 上 IB 中的“用户交互已启用”复选框，以允许触摸事件向下级联到下方的 UIButton。

一个副作用是您的文本也会被着色。

```
#import <QuartzCore/QuartzCore.h>

colorizeOverlayView.layer.cornerRadius = 10.0f;
colorizeOverlayView.layer.masksToBounds = YES; 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-12T21:15:32.460

当您单击按钮并进入检查器时，keremk 说要更改“视图”背景颜色是正确的。这会将小角落更改为您选择的任何颜色。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-08-09T07:33:41.517

因此，我找到了一个使用类别的非常简单的解决方案。（如此简单以至于我认为我一定是在做一些 hacky 的事情，但我没有看到它！）

为 UIButton 定义一个类别（如果你不知道那是什么，总而言之：它是一种最小程度地“扩展”类的方法；即向类添加方法但没有属性），并创建一个方法“调用 UIButton 的超类 (UIControl) setBackgroundColor 方法的 setBackgroundColor"。

```
@implementation UIButton (coloredBackgroundButton)

-(void)setBackgroundColor:(UIColor *)backgroundColor {
    [super setBackgroundColor:backgroundColor];
} 
```

无论你在哪里使用UIButtons，只要导入声明这个类别的头文件，在这种情况下，

```
#import "coloredBackgroundButton.h" 
```

您可以在它们上调用 setBackgroundColor。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2008-12-16T21:31:31.920

可能是我误解了你的问题，但下面对你不起作用吗？

![](https://i.stack.imgur.com/I7i5W.png)

# c# - Coderush 和 resharper，他们一起工作吗？

> ID：372738
> 
> 赞同：16
> 
> 时间：2008-12-16T21:12:34.907
> 
> 标签：c#, visual-studio-2008, resharper, coderush

有人有一起使用它们的经验吗？效果如何？还是太悲伤了？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-07-31T13:32:06.760

我成功地使用了这两种工具。是的，他们都想要键盘，但他们想要的方式不同。您可以将它们配置为一起工作而不会出现太多问题。一切都与配置和学习曲线有关。

我面临的主要问题是：管理括号和方括号（只需选择哪个会执行此操作）、模板（不是真正的问题：一个使用制表符，另一个使用空格）、建议（为每个工具配置不同的键）。

CodeRush 插件和 Resharper 插件可以很好地协同工作，结果是真正的喜悦。工具之间没有冲突。只需两周时间即可轻松使用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-21T15:58:51.837

我使用 Resharper 已经有一段时间了，最​​近也安装了免费的 Coderush Express。大约一周后，我可以说 Coderush 丝毫没有妨碍我，两个工具之间也没有发生争执。诚然，我对 Resharper 更加熟悉，并且不知道 Coderush 的一半是否无法运行，但我对目前的设置感到满意。

更新：在 CodeRush 中转到其他用法的 tab 键有时会在尝试完成模板中的类型时受到干扰。例如，输入 foreach 会创建一个 foreach 模板。如果在编辑模板字段时，点击了选项卡，比如完成输入，CodeRush 会将您拉到其他地方。谢天谢地，Esc 从中恢复了。

有关重新映射键的建议，请参阅评论。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-17T04:02:30.307

你不想那样做。ReSharper 和 CodeRush 都需要键盘。具体来说，CodeRush 出于自身目的重新映射了转义键 (ESC)。ReSharper 不喜欢这样（注意：ReSharper 没有对转义键做任何特别的事情，但它仍然不喜欢它）。

至于他们之间的选择……他们都有自己的观点。CodeRush 有更好的模板和更多的重构。ReSharper 为 NUnit 内置了单元测试，以及一组健康的插件。ReSharper 还具有模板和大量键盘快捷键。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-16T21:19:06.407

我是够贪心的。我的 VS2008 花了很长时间才启动。一切都慢了下来。我有 1 Gig 的 ram。不知道是不是这样。我删除了 coderush，因为我更习惯于 resharper 键盘布局。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-08-27T13:45:10.963

将 Resharper 与 CodeRush 一起使用完全不是问题。我曾经以这种方式工作过一段时间。但为什么？恕我直言，CodeRush 与 Refactorpro 结合在性能和可用性方面比 resharper 更好。resharper 也会降低性能。几乎所有希望 nunit 集成的功能都是相同的，尝试在 resharper 或 codeRush 中找到它们并仅使用其中一个。我更喜欢coderush

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-10-10T08:39:04.243

有一个[相关的问题](https://stackoverflow.com/questions/4080511/how-to-install-coderush-and-resharper-coderush-shortcut-missing)。在对该问题的一个答案中，有人提出了一篇似乎很有用的文章：

> Jim Holmes 有一篇很棒的博客文章，介绍了如何使这两种产品在同一个安装中工作。
> 
> [http://frazzleddad.blogspot.com/2010/01/making-devexpress-resharper-play-nicely.html](http://frazzleddad.blogspot.com/2010/01/making-devexpress-resharper-play-nicely.html)
> 
> 我什至不想考虑想出这个序列需要多少小时和安装排列。

我没有尝试。

# c# - 我可以在调用 client.Send() 之前测试 SmtpClient 吗？

> ID：372742
> 
> 赞同：23
> 
> 时间：2008-12-16T21:13:58.837
> 
> 标签：c#, email, smtpclient

这与我前几天问的一个关于[如何发送电子邮件](https://stackoverflow.com/questions/366629/how-do-i-send-an-email-message-from-my-c-application)的问题有关。

我的新相关问题是……如果我的应用程序的用户位于防火墙后面或其他原因导致线路 client.Send(mail) 不起作用怎么办……

行后：

```
SmtpClient client = new SmtpClient("mysmtpserver.com", myportID);
client.Credentials = new System.Net.NetworkCredential("myusername.com", "mypassword"); 
```

在我尝试发送之前，我可以做些什么来测试客户端吗？

我想过把它放在一个 try/catch 循环中，但我宁愿做一个测试，然后弹出一个对话框说：无法访问 smtp 或类似的东西。

（我假设我和潜在的我的应用程序用户都没有能力调整他们的防火墙设置。例如......他们在工作中安装应用程序并且无法在工作中控制他们的互联网）

-阿迪娜

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2010-05-18T20:29:04.893

我认为，如果您正在寻找测试 SMTP，那么您正在寻找一种方法来验证您的配置和网络可用性，而无需实际发送电子邮件。任何方式都是我需要的，因为没有有意义的虚拟电子邮件。

在我的开发人员同事的建议下，我想出了这个解决方案。一个小的帮助类，用法如下。我在发送电子邮件的服务的 OnStart 事件中使用了它。

注意：TCP 套接字内容的功劳归于 Peter A. Bromberg，网址为[http://www.eggheadcafe.com/articles/20030316.asp](http://www.eggheadcafe.com/articles/20030316.asp)，配置在这里向这些人读了一些东西：[Access system.net settings from app.config在 C# 中以编程方式](https://stackoverflow.com/questions/625262/c-access-programatically-system-net-settings-from-app-config)

**帮手：**

```
public static class SmtpHelper
{
    /// <summary>
    /// test the smtp connection by sending a HELO command
    /// </summary>
    /// <param name="config"></param>
    /// <returns></returns>
    public static bool TestConnection(Configuration config)
    {
        MailSettingsSectionGroup mailSettings = config.GetSectionGroup("system.net/mailSettings") as MailSettingsSectionGroup;
        if (mailSettings == null)
        {
            throw new ConfigurationErrorsException("The system.net/mailSettings configuration section group could not be read.");
        }
        return TestConnection(mailSettings.Smtp.Network.Host, mailSettings.Smtp.Network.Port);
    }

    /// <summary>
    /// test the smtp connection by sending a HELO command
    /// </summary>
    /// <param name="smtpServerAddress"></param>
    /// <param name="port"></param>
    public static bool TestConnection(string smtpServerAddress, int port)
    {
        IPHostEntry hostEntry = Dns.GetHostEntry(smtpServerAddress);
        IPEndPoint endPoint = new IPEndPoint(hostEntry.AddressList[0], port);
        using (Socket tcpSocket = new Socket(endPoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp))
        {
            //try to connect and test the rsponse for code 220 = success
            tcpSocket.Connect(endPoint);
            if (!CheckResponse(tcpSocket, 220))
            {
                return false;
            }

            // send HELO and test the response for code 250 = proper response
            SendData(tcpSocket, string.Format("HELO {0}\r\n", Dns.GetHostName()));
            if (!CheckResponse(tcpSocket, 250))
            {
                return false;
            }

            // if we got here it's that we can connect to the smtp server
            return true;
        }
    }

    private static void SendData(Socket socket, string data)
    {
        byte[] dataArray = Encoding.ASCII.GetBytes(data);
        socket.Send(dataArray, 0, dataArray.Length, SocketFlags.None);
    }

    private static bool CheckResponse(Socket socket, int expectedCode)
    {
        while (socket.Available == 0)
        {
            System.Threading.Thread.Sleep(100);
        }
        byte[] responseArray = new byte[1024];
        socket.Receive(responseArray, 0, socket.Available, SocketFlags.None);
        string responseData = Encoding.ASCII.GetString(responseArray);
        int responseCode = Convert.ToInt32(responseData.Substring(0, 3));
        if (responseCode == expectedCode)
        {
            return true;
        }
        return false;
    }
} 
```

**用法：**

```
if (!SmtpHelper.TestConnection(ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None)))
{
    throw new ApplicationException("The smtp connection test failed");
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-16T21:16:49.643

我认为这是异常处理将是首选解决方案的情况。在你尝试之前你真的不知道它会起作用，失败是一个例外。

编辑：

您需要处理 SmtpException。这有一个 StatusCode 属性，它是一个枚举，它会告诉您 Send() 失败的原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T21:28:00.773

您可以尝试发送 HELO 命令来测试服务器是否处于活动状态并在发送电子邮件之前运行。如果您想检查用户是否存在，您可以尝试使用 VRFY 命令，但由于安全原因，这通常在 SMTP 服务器上被禁用。进一步阅读： [http](http://the-welters.com/professional/smtp.html) ://the-welters.com/professional/smtp.html 希望这会有所帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T21:30:16.650

捕获 SmtpException 异常，它会告诉您是否因为无法连接到服务器而失败。

如果您想在任何尝试之前检查是否可以打开与服务器的连接，请使用 TcpClient 并捕获 SocketExceptions。虽然我认为这样做与从 Smtp.Send 中捕获问题相比没有任何好处。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-11-14T04:54:36.560

```
 private bool isValidSMTP(string hostName)
    {
        bool hostAvailable= false;
        try
        {
            TcpClient smtpTestClient = new TcpClient();
            smtpTestClient.Connect(hostName, 25);
            if (smtpTestClient.Connected)//connection is established
            {
                NetworkStream netStream = smtpTestClient.GetStream();
                StreamReader sReader = new StreamReader(netStream);
                if (sReader.ReadLine().Contains("220"))//host is available for communication
                {
                    hostAvailable= true;
                }
                smtpTestClient.Close();
            }
        }
        catch
        {
          //some action like writing to error log
        }
        return hostAvailable;
    } 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2015-06-30T14:59:14.077

我也有这个需求。

[这是我创建的库](https://github.com/tallesl/SMTPConnectionTester)（它发送`HELO`并检查 200、220 或 250）：

```
using SMTPConnectionTest;

if (SMTPConnection.Ok("myhost", 25))
{
   // Ready to go
}

if (SMTPConnectionTester.Ok()) // Reads settings from <smtp> in .config
{
    // Ready to go
} 
```

# emacs - TextMate's Dawn color theme for Emacs

> ID：372747
> 
> 赞同：7
> 
> 时间：2008-12-16T21:15:01.970
> 
> 标签：emacs, themes, textmate

Does anybody know if there is a color theme like the TextMate Dawn theme, for Emacs ? I simply don't like the way the fonts look on my dark emacs theme and I am not sure if it's emacs's fault or just the theme.

Here's a comparison:

[http://mixandgo.com/emacs_textmate.png](http://mixandgo.com/emacs_textmate.png)

Thanks, Cezar

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T21:51:18.463

嗯，为什么你有一个黑暗的 Emacs？

执行`M-x color-theme-select`（也许您需要先安装`color-theme`：执行`sudo apt-get install emacs-goodies-el`或查看[Emacswiki 页面](http://www.emacswiki.org/cgi-bin/wiki?ColorTheme)），然后选择一个轻量级的。有很多; 许多名称中带有“浅色”或“灰色”。（我喜欢 Greiner、Wheat、Snow 等）

另外，也许你想打开/关闭抗锯齿？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-23T05:42:06.077

为 Emacs 安装颜色主题后：

[http://www.emacswiki.org/emacs/ColorTheme](http://www.emacswiki.org/emacs/ColorTheme)

您可以下载这个类似于 TextMate 配色方案的主题：

[http://blog.jdhuntington.com/2008/11/emacs-color-theme-blackboard.html](http://blog.jdhuntington.com/2008/11/emacs-color-theme-blackboard.html)

# emacs - Getting started with SLIME and SWANK: Lisp connection closed unexpectedly: connection broken by remote peer

> ID：372750
> 
> 赞同：9
> 
> 时间：2008-12-16T21:15:50.843
> 
> 标签：emacs, common-lisp, slime, sbcl, swank

I was trying to use the slime-connect function to get access to a remote server with sbcl. I followed all the steps from the slime.mov movie from [Marco Baringer,](http://www.guba.com/watch/30000548671) but I got stuck when creating the ssh connection for slime. This is after already starting the swank server on the remote machine. I did it like this:

`ssh -L 4005:127.0.0.1:4005 user@server.com`

And I got this errors, on local SLIME:

Lisp connection closed unexpectedly: connection broken by remote peer

...and on the remote server:

channel 3: open failed: connect failed: Connection refused

What could possibly be wrong?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T09:25:06.790

你检查过你使用的 SLIME 和 SWANK 的版本是一样的吗？当我使用 SLIME 会话的这两个部分的不匹配版本时，我发生了奇怪的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-05T16:54:22.203

最容易错过的是 swank 服务器侦听的 tcp 端口。我最近没有做很多远程开发，但我记得第一次做的时候，我在理解如何告诉 swank 绑定哪个端口，或者找出它选择了哪个端口时遇到了一些麻烦。

你介意扩展一下你是如何实际启动 swank 服务器的吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T16:44:17.173

我不知道，但是您可以尝试在本地连接到远程计算机上的 swank。

```
ssh user@server.com
telnet 127.0.0.1:4005 
```

可能在那里你会发现错误。您也可以尝试使用 localhost:4005 而不是 127.0.0.1 并检查 localhost 接口是否配置正确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-27T11:41:18.330

对我来说，问题是`slime`Emacs 的 (v2.22) 函数以不支持 (v2.22) 的附加参数`from-emacs t`开始`swank-loader.lisp`。

对我有用的是编辑`slime-v2.22/swank-loader.lisp:init`接受一个新参数`from-emacs`，该参数在函数体中没有使用，因为我不知道应该以什么方式处理这个参数。但是`slime`现在开始很好并且可行。

此外，在开始时，`slime`我收到有关不兼容版本的警告：slime v2.23 和 swank v2.22，但正如我检查`list-packages`并简单地通过文件夹名称 - 我有`slime`两个`swank`版本 v2.22。这对我来说是一个困惑。

如果有人知道它的详细信息，请发表评论。

# java - Does anyone know of any good tutorials for the Slick 2D lib?

> ID：372755
> 
> 赞同：10
> 
> 时间：2008-12-16T21:17:01.310
> 
> 标签：java, graphics, applet, 2d

There is a 2D java graphics library called Slick 2D ([http://slick.cokeandcode.com/](http://slick.cokeandcode.com/)) that seems to be used by a bunch of indie games (mostly applets), but the documentation is a little lacking. Does anyone know of any good tutorials for this lib?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T21:24:18.013

最肯定检查他们的论坛，并提出问题。他们过去对我很有帮助。

# visual-studio - 合并 Visual Studio 解决方案文件

> ID：372770
> 
> 赞同：2
> 
> 时间：2008-12-16T21:20:23.910
> 
> 标签：visual-studio, merge, solution

Microsoft Visual Studio（2005 和 2008）似乎在每次我们对解决方案进行一点更改时都会对项目 ID (GUID) 进行改组。我们发现，每次有人必须在源代码控制中合并分支时，这个小细节都会让人感到沮丧......

我们考虑编写一个小工具来在签入之前对这些项目 ID 进行排序。这样，合并会更容易。是否有一些我在 Visual Studio 选项中错过的选项可以做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T21:41:01.027

不幸的是，到目前为止它看起来并不好。

看到这个问题： [Merging vcproj files - SCM's hell](https://stackoverflow.com/questions/372357/merging-vcproj-files-scms-hell#372448)

关闭，因为这似乎是重复的。

# java - org.jgroups.protocols.UDP - 向 null 发送消息失败

> ID：372771
> 
> 赞同：5
> 
> 时间：2008-12-16T21:21:34.297
> 
> 标签：java, networking, jgroups

```
[hannel,192.168.0.46:40014] 15:08:03,642 - ERROR - org.jgroups.protocols.UDP - failed sending message to null (61 bytes)
java.lang.Exception: dest=/225.1.2.46:30446 (64 bytes)
    at org.jgroups.protocols.UDP._send(UDP.java:333)
    at org.jgroups.protocols.UDP.sendToAllMembers(UDP.java:283)
    at org.jgroups.protocols.TP.doSend(TP.java:1327)
    at org.jgroups.protocols.TP.send(TP.java:1317)
    at org.jgroups.protocols.TP.down(TP.java:1038)
    at org.jgroups.protocols.PING.sendMcastDiscoveryRequest(PING.java:220)
    at org.jgroups.protocols.PING.sendGetMembersRequest(PING.java:214)
    at org.jgroups.protocols.Discovery$PingSenderTask$1.run(Discovery.java:385)
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:417)
    at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:280)
    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:135)
    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:65)
    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:142)
    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:166)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)
    at java.lang.Thread.run(Thread.java:595)
Caused by: java.io.InterruptedIOException: operation interrupted
    at java.net.PlainDatagramSocketImpl.send(Native Method)
    at java.net.DatagramSocket.send(DatagramSocket.java:612)
    at org.jgroups.protocols.UDP._send(UDP.java:324)
    ... 16 more 
```

这是在服务器负载测试期间发生的。我应该担心吗。除了在日志中收到该消息外，一切似乎都正常。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T06:20:10.740

作为对 matt b 的响应，“发送消息失败”消息具有误导性。真正的问题是 InterruptedIOException。这意味着有人在发送 UDP 的线程上调用了 interrupt()。最有可能的是，中断是在 JGroups 中生成的。（除非您启动，然后停止 JGroups 频道。）

查看堆栈跟踪，中断的 I/O 来自发现协议。它试图发现其他集群成员。因此，此异常不会丢失您的任何消息。

我们必须了解更多才能真正弄清楚这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-13T12:50:51.860

发送到“null”意味着发送到整个集群，而不是向单个成员发送消息。我同意，这有点误导，所以我在以后的版本中改变了这个：IIRC“null”被替换为“cluster”或“group”。

这里的“null”指的是目的地：一个空的目的地地址意味着发送到整个集群。

InterruptedIOException 来自被 JGroups 停止的发送者线程；例如，当我们在发现阶段已经有足够的响应返回时，就会发生这种情况，因此发送任务被停止（即中断）。

这在 JGroups 的更高版本中也得到了修复。贝拉

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T21:29:34.983

是否有可能因为您正在向“null”发送消息而收到错误？

> 错误 - org.jgroups.protocols.UDP - 将消息发送到 null 失败

否则，如果没有代码示例、网络信息、问题发生的具体情况等，其他人可能很难帮助您解决问题。

# java - java枚举构造函数中是否允许使用可变参数？

> ID：372773
> 
> 赞同：4
> 
> 时间：2008-12-16T21:22:10.333
> 
> 标签：java, enums, constructor

```
enum MyEnum {
     A( 1, 2, 3, 4),
     B(1, 2),
     C(4, 5, 8, 8, 9);

    private MyEnum( int firstInt, int... otherInts ) {
     // do something with arguments, perhaps initialize a List
    }
} 
```

这有什么问题吗？有什么理由不这样做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T21:23:55.977

当然，这是完全合法的。如果您的程序需要，没有理由不这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T22:52:27.420

它确实有效。你应该尝试

```
private MyEnum(int... Ints ) 
```

对于枚举，您需要确保以初始化它们的方式访问它们。很多时候，只需要访问即可

```
MyEnum bob = MyEnum.A; 
```

# css - 在 IE6 中使用“>”选择器

> ID：372778
> 
> 赞同：0
> 
> 时间：2008-12-16T21:23:56.833
> 
> 标签：css, internet-explorer-6

我已经编写了一些 CSS，它们使用 parent > child 选择器来定位元素。专门针对表格，所以我可以像这样将某些样式应用于页眉和页脚

```
table > thead > tr > th ...
table > tbody > tr > td ...
//there are other uses in the css as well 
```

这很好用，除了在 IE6 中。分解这个 CSS 以支持 IE6 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T21:37:35.233

如果我想选择 E > F，我使用

```
E F {
    set-some-style: value;
}

E * F {
    unset-some-style: 0;
} 
```

只是，当您有很多 > 选择器时，它的效果并不好。

更多阅读： [http ://www.sitepoint.com/blogs/2005/06/20/erics-universal-child-selector/](http://www.sitepoint.com/blogs/2005/06/20/erics-universal-child-selector/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T21:31:29.270

通常您只需删除“>”即可。这取决于您的 CSS 和 HTML 是如何编写的。我会试一试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-04T08:27:31.900

IE6 不支持`>`选择器。

在某些情况下，您可以将其替换为空格选择器并获得大致相同的结果，但这并不总是有效；有时您只*需要*.`>`

我的第一个建议是放弃对 IE6 的支持。在过去的几年里，它几乎失去了所有剩余的市场份额，所以真的没有必要支持它。

如果你必须支持 IE6，并且你想使用`>`选择器，那么你唯一的选择就是 Javascript hacks。

有两个技巧可以帮助你：

*   [Dean Edwards 的 IE7.js](http://dean.edwards.name/weblog/2010/03/ie7js-update/) - 这是尝试使用 Javascript 将尽可能多的 CSS 和 JS 功能反向移植到旧版本的 IE 中，包括 IE6。它做得相当好，并且已经存在了很长时间。

*   Selectivizr - 这是一个 JS 库，旨在为旧版本的 IE 提供对现代 CSS 选择器的全面支持。它还要求您使用另一个库，例如 jQuery，因为它从该库挂钩到选择器引擎。这意味着如果您已经在使用其中一个受支持的库，那么它是对您的代码的一个小而有效的补充。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T21:30:03.173

你可以使用 JavaScript 来定位它们，但这几乎不是一个真正的解决方案，因为它需要 JavaScript 来完成应该由 CSS 完成的事情。您还可以修改您的 HTML 以具有特定的类，但这意味着修改您的 HTML。我真的不认为有任何“好”的解决方案，如果是我必须处理这个问题，或者如果我有权访问 HTML 或 HTML 创建脚本使用类，我可能会使用 JavaScript 将它们全部破解那些特定的孩子。

# c# - 使用反射添加事件处理程序

> ID：372780
> 
> 赞同：0
> 
> 时间：2008-12-16T21:24:40.453
> 
> 标签：c#, asp.net, events, user-controls

我正在使用 LoadControl 和 Controls.Add 向页面添加动态控件。我需要以某种方式将此加载的控件的 Init 和 Load 事件处理程序包装到我的代码中。所以它应该是这样的事件顺序*SomeMyCode() -> Control.Init() -> AnotherMyCode()*和相同的 Load *SomeMyCode() -> Control.Load() -> AnotherMyCode()*。
我的想法是获取 Init 和 Load 事件的 Control 事件处理程序列表，并使用我应该运行的代码添加第一个和最后一个事件处理程序。但我无法弄清楚如何做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T10:00:14.327

Here is a draft of a working solution:

```
 protected void Page_Load(object sender, EventArgs e)
    {
        Control ctrl = this.LoadControl("WebUserControl1.ascx");
        PropertyInfo propertyInfo = typeof(Control).GetProperty("Events", BindingFlags.NonPublic | BindingFlags.Static | BindingFlags.Instance);
        EventHandlerList eventHandlerList = propertyInfo.GetValue(ctrl, new object[]{}) as EventHandlerList;
        FieldInfo fieldInfo = typeof(Control).GetField("EventLoad", BindingFlags.NonPublic | BindingFlags.Static);

        if(fieldInfo == null)
            return;

        object eventKey = fieldInfo.GetValue(ctrl);
        Delegate eventHandler = eventHandlerList[eventKey] as Delegate;

        foreach(EventHandler item in eventHandler.GetInvocationList()) {
            ctrl.Load -= item;
        }

        ctrl.Load += ctrl_Load;
        foreach (EventHandler item in eventHandler.GetInvocationList()){
            ctrl.Load += item;
        }
        ctrl.Load += ctrl_Load;

        this.Controls.Add(ctrl);
    }

    void ctrl_Load(object sender, EventArgs e)
    {
        //throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T08:24:44.007

您*不能*在已订阅事件的其他处理程序之前强制注入事件处理程序。如果您需要首先调用方法 A，那么您需要先订阅 A。

* * *

重新发表您的评论，这太骇人听闻了。首先，您甚至不能依赖具有委托字段支持者的事件；它可以是一个`EventHandlerList`或其他 - 它不会暴露出方便的钩子而不是逆转移除。

其次（也是更重要的），它打破了所有的封装规则。

一般来说，如果你想成为第一，*最好*的方法是重写`OnFoo()`方法。第二好的是先订阅。

# animation - 有没有免费的工具来创建 SWF / Flash 动画？

> ID：372792
> 
> 赞同：12
> 
> 时间：2008-12-16T21:27:29.620
> 
> 标签：animation, flash, 2d

有没有像 Flash 这样的竞争工具来创建 SWF 动画？我 8 岁的儿子想学习 2D 动画，但我怀疑他预期的注意力广度是否值得购买 Flash。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T21:37:04.187

这里有一个关于使用 InkScape 和 SWFTools 制作动画的简短视频教程：

[http://screencasters.heathenx.org/episode-031/](http://screencasters.heathenx.org/episode-031/)

或者，您可以查看（现已停产）PowerBullet，它具有类似 PowerPoint 的界面。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-06T12:31:11.310

有一个很棒的 Flash 工具，它可以让你制作各种 Flash 动画。因此，对于[免费的 swf 制作，请查看 Vectorian Giotto。](http://vectorian.com)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-16T21:30:25.120

以下 URL 包含一个相当全面的开源 Flash 项目列表。看一看，你可能会找到你需要的东西。

[https://web.archive.org/web/20130814051528/http://osflash.org/open_source_flash_projects](https://web.archive.org/web/20130814051528/http://osflash.org/open_source_flash_projects)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T08:47:13.647

它本身并不是“免费”的，但在 adobes 网站上有一个 Flash CS4 的 30 天试用版。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-24T08:13:05.923

对于孩子们来说，有一个叫做[ANIMATIONISH](http://www.toonboom.com/products/animationish/)的软件。然而，它不是免费的。这是由创建 ToonBoom 工作室（用于 2d 动画的专业软件）的人制作的。

# asp.net - 单元/集成测试，它们应该有多细？

> ID：372797
> 
> 赞同：4
> 
> 时间：2008-12-16T21:28:31.880
> 
> 标签：asp.net, unit-testing, integration-testing

我正在使用 NUnit/Watin 测试我的 ASP.Net Web Forms 应用程序的 UI。我了解有关 TDD、单元测试、集成测试等的高级概念，但直到现在还没有太多机会使用它们。

因此，当我在数据输入表单上测试验证逻辑时，我应该编写一个测试来触发我的每个验证错误（即字段 x 是必需的），还是针对应该抛出的每个验证错误单独测试通过表格。这仅仅是一个样式问题，还是有正当理由编写多个测试而不是一个针对我的验证逻辑的所有可能组合的测试？

伪代码：

```
 [Test]
    public void Validation()
    {
       //Do some stuff to test that username is required.
       Assert.AreEqual(true, ie.ContainsText("Username is required.");

       //Do some stuff to test that passwword is required.
       Assert.AreEqual(true, ie.ContainsText("Password is required.");
    } 
```

对比

```
[Test]
public void ValidateUserName()
{
   //Do some stuff to test that username is required.
   Assert.AreEqual(true, ie.ContainsText("Username is required.");
}

[Test]
public void ValidatePassword()
{
   //Do some stuff to test that passwword is required.
   Assert.AreEqual(true, ie.ContainsText("Password is required.");
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T22:12:09.983

我倾向于每次验证进行一项测试：

*   如果你完全破坏了验证，两个测试会失败，所以你会立即知道你破坏的一切。如果他们在同一个测试中，那么第一个失败将掩盖第二个，直到第一个被修复。

*   一旦你破坏了任何东西，你就会得到一个关于失败方法名称中的确切内容的描述。许多单元测试 GUI 会在每个失败的测试旁边给你一个小红灯，这些会自然地突出和描述你所有的错误。

话虽如此，重要的是您要进行测试-在课程中出现的特定测试是次要的细节...

# c# - .NET 将数字转换为时区值

> ID：372799
> 
> 赞同：1
> 
> 时间：2008-12-16T21:28:45.920
> 
> 标签：c#, timezone

假设我有值：-5 表示时区 (GMT-5)。

如何将其转换为：“Central DST”或使用 C# 和 .NET 框架的类似文本？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T21:38:18.023

使用 .NET 3.5，您可以使用 TimeZoneInfo.GetSystemTimeZones()，然后遍历直到使用 BaseUtcOffset 找到匹配项。

请注意，每个偏移量可能有多个条目，因此您的结果会有些随意。

# bash - 避免在 bash 内置函数 let 中扩展 *

> ID：372807
> 
> 赞同：4
> 
> 时间：2008-12-16T21:30:17.587
> 
> 标签：bash, scripting, expansion, let

我的 bash 脚本有问题。我必须使用运算符 * 进行乘法运算。相反，脚本通过扩展和使用脚本本身的名称作为运算符来困扰我。我尝试使用单引号，但它不起作用:(这是代码

```
#!/bin/bash -x

# Bash script that calculates an arithmetic expression
# NO PRECEDENCE FOR OPERATORS
# Operators: + - * 

if [ "$#" -lt "3" ]
then 
    echo "Usage: ./calcola.scr <num> <op> <num> ..."
    exit 1
fi

result=0
op=+
j=0

for i in "$@"
do
    if [ "$j" -eq "0" ]
    then
        # first try
        #result=$(( $result $op $i )) 

        # second try
        let "result$op=$i"

        j=1
    else
        op=$i
        j=0
    fi
done

echo "Result is $result"

exit 0 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T18:39:24.773

如果您的脚本根本不需要“* 扩展”（通常称为“通配符”），只需以“-f”开头即可；您还可以在运行时更改它：

```
mat@owiowi:/tmp/test$ echo *
A B
mat@owiowi:/tmp/test$ set -f
mat@owiowi:/tmp/test$ echo *
*
mat@owiowi:/tmp/test$ set +f
mat@owiowi:/tmp/test$ echo *
A B 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-16T21:35:45.143

如果 "op" 是 "*"，它会在你的脚本看到它之前被 shell 扩展。您需要为乘法运算符选择其他内容，例如“x”，或者通过将其放在单引号中或在其前面加上反斜杠来强制用户对其进行转义。

如果练习的条件允许，也许您应该尝试使用“read”从标准输入中获取表达式，而不是从命令行获取它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T21:43:59.290

它有效，你只是没有`*`正确地逃避。尝试使用反斜杠：

```
$ ./calcola.scr 2 \* 3
+ '[' 3 -lt 3 ']'
+ result=0
+ op=+
+ j=0
+ for i in '"$@"'
+ '[' 0 -eq 0 ']'
+ let result+=2
+ j=1
+ for i in '"$@"'
+ '[' 1 -eq 0 ']'
+ op='*'
+ j=0
+ for i in '"$@"'
+ '[' 0 -eq 0 ']'
+ let 'result*=3'
+ j=1
+ echo 'Result is 6'
Result is 6
+ exit 0
$ 
```

虽然，正如 Paul Tomblin[提到](https://stackoverflow.com/questions/372807/avoid-expansion-of-in-bash-builtin-function-let#372841)`x`的，使用乘法运算符可能会更好。

# ruby-on-rails - Dir.glob 在 site5 托管的站点上不起作用？

> ID：372808
> 
> 赞同：0
> 
> 时间：2008-12-16T21:30:19.023
> 
> 标签：ruby-on-rails, ruby

我已将一些文件上传到公共目录下，并尝试使用 Dir.glob 访问它们。但我没有得到任何结果。

Dir.glob 在开发服务器 (mongrel) 上运行良好，并且在安装在 site5 上的站点上使用脚本/控制台时也运行良好

有没有办法让这个工作或不同的方式来获取文件列表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T21:38:34.480

我的猜测是 site5 禁止执行 shell，或者您无权访问 /bin/sh。通配符通常是通过运行一个 shell 来实现的……试试

```
Dir.entries("public").each do |f|
  puts(f)
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T22:54:15.310

结果证明 glob 是允许的，但是在 mongrel 上，我需要在路径前加上 public，而在 site5 托管的站点上，我需要跳过它。

在杂种中有效：

```
Dir.glob('public/files/images/*.jpg') 
```

在站点 5 中有效：

```
Dir.glob('files/images/*.jpg') 
```

奥利维尔的回答让我走上了正轨。

# c# - 如何在没有 Linq 的情况下从列表中获取一些对象？

> ID：372812
> 
> 赞同：4
> 
> 时间：2008-12-16T21:30:48.973
> 
> 标签：c#, .net, .net-2.0, c#-2.0

我正在运行 C# 框架 2.0，我想从列表中获取一些数据？该列表是一个列表<>。如果不对 List<> 的每个元素进行循环和手动比较，我该如何做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T21:32:45.133

如果我正确地遵循了您的问题，您只需调用`Find()`or`FindAll()`方法即可将数据项从列表中取出。例如：

```
List<string> myList = ..;
List<string> startingWithA = myList.FindAll(delegate(string s) { return s.StartsWith("A"); }); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-16T21:32:33.870

你可以试试谓词。这是我为说明这一点而编写的代码。当然，正如您在此示例中所看到的，您可以将 Predicate 移到调用类之外并对其进行控制。如果您需要更多选择，这很有用。在谓词中，您可以与对象的所有属性/功能进行许多比较。

```
 static void Main()
    {
        List<SimpleObject> list = new List<SimpleObject>();
        list.Add(new SimpleObject(1,"Jon"));
        list.Add(new SimpleObject( 2,  "Mr Skeet" ));
        list.Add(new SimpleObject( 3,"Miss Skeet" ));
        Predicate<SimpleObject> yourFilterCriteria = delegate(SimpleObject simpleObject)
        {
            return simpleObject.Name.Contains("Skeet");
        };
        list = list.FindAll(yourFilterCriteria);//Get only name that has Skeet : Here is the magic
        foreach (SimpleObject o in list)
        {
            Console.WriteLine(o);
        }
        Console.Read();
    }
    public class SimpleObject
    {
        public int Id;
        public string Name;

        public SimpleObject(int id, string name)
        {
            this.Id=id;
            this.Name=name;
        }

        public override string ToString()
        {
            return string.Format("{0} : {1}",Id, Name);
        }
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T21:35:27.793

如果没有 LINQ，您的主要选择是对列表的每个元素进行循环和比较。不过，有一些方法可能会对您有所帮助。

`List<T>.FindAll()`接受一个`Predicate`委托并将返回所有符合条件的项目。 `List<T>.CopyTo()`并`List<T>.GetRange()`让您提取一系列元素。除此之外，您真的无法在 LINQ 之外的特定选择方式上做太多事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T21:49:22.807

事实是，即使您最终通过 Find 或 FindAll 使用了谓词，它在内部所做的只是遍历列表，并运行您的谓词来测试匹配项。就性能而言，您不会获得任何好处，但它肯定会使代码更整洁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T21:35:18.717

不幸的是， List 数据结构需要迭代才能找到数据（请注意，上面的 FindAll 方法将在幕后迭代您的集合 - 以防万一您不惜一切代价试图避免这种情况），除非您知道该数据的索引，否则您可以做这个：

```
List<String> list = new List<String>();
list.Add("andrew");
list.Add("nicole");

String value = list[1]; // returns "nicole" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T22:45:35.657

我认为上面的大多数答案都只是提供了替代方法来做你想要避免的事情。给定数据结构，无论您选择哪种实现，您/它都必须比较每个项目并挑选出匹配的项目。

根据您的匹配条件，SortedList 可以帮助您避免为每个查询搜索整个列表。如果您的列表包含您创建的对象，覆盖 GetHashCode 和 Equals 将帮助您。

如果匹配条件相当复杂，则可能需要完全不同的数据结构，例如字符串的[trie](http://en.wikipedia.org/wiki/Trie)。

# delphi - delphi循环的一点帮助

> ID：372815
> 
> 赞同：0
> 
> 时间：2008-12-16T21:31:26.413
> 
> 标签：delphi

```
 for m := 0 to 300 do
       if Pos(certain_String, string(arrayitem(m)) <> 0 then
        begin
          randomize;
          x := random(100);
        begin
            case x of
             0..69  : function(m); //  70 percent
            70..79 : function(m+1); // 10 percent
            80..84 : function(m+2); // 5 percent
            85..88 : function(m+3); //  5 percent
            89..91 : function(m+4); //  2 percent
            92..94 : function(m+5); //  3 percent
            95..97 : function(m+6); //  3 percent
            98..98 : function(m+7); //  1 percent
            99..99 : function(m+8); //  1 percent

           end;
           m := 300;

    end; 
```

试图让这个东西循环通过一个相当大的数组，但是如果它在其中找到某个字符串完全停止并转到下一个东西，不得不取出一些专有函数名称，但 m := 300; 似乎是问题所在，不喜欢我在 for 循环中间分配 ma 值。抱歉这里缺乏知识，有一个半完成的帕斯卡项目落在我的腿上，以前从未见过这些东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T21:39:38.800

稍微改了一下代码：

```
randomize;
for m := 0 to 300 do begin
  if Pos(certain_String, string(arrayitem(m)) <> 0 then begin
    x := random(100);
    case x of
       0..69 : function(m); //  70 percent
      70..79 : function(m+1); // 10 percent
      80..84 : function(m+2); // 5 percent
      85..88 : function(m+3); //  5 percent
      89..91 : function(m+4); //  2 percent
      92..94 : function(m+5); //  3 percent
      95..97 : function(m+6); //  3 percent
          98 : function(m+7); //  1 percent
          99 : function(m+8); //  1 percent
    end;
    break;
  end;
end; 
```

会成功的。

不应在每个循环中调用 Randomize。

为什么字符串转换？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T22:39:04.220

除了其他问题，结束 for 循环的方法是**Break**。只需更换**m := 300;** 带**休息；**它会做你想做的事。

另外调用 randomize 不止一次是一个坏主意，但你现在知道了，因为它在[你昨天接受](https://stackoverflow.com/questions/368762/delphi2006-loop-help#368875)的这个问题的答案中提到过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T21:35:45.017

`break`在 Object Pascal 中必须有 C 的等价物。这是摆脱循环的一种更清洁的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T21:46:47.600

带有 while 循环的示例：

```
m := 0;

while m<=300 do begin
  if condition do begin
    // Do something

    m := 300; // Will be 301 at end of loop.
  end;
  Inc(m);
end; 
```

# .net - 如何将数据绑定到 System.Windows.Forms.Treeview 控件？

> ID：372820
> 
> 赞同：14
> 
> 时间：2008-12-16T21:32:24.510
> 
> 标签：.net, winforms, data-binding, treeview

我正在查看这个控件，它似乎缺少用于数据绑定的标准 .net“数据源”和“数据成员”属性。这个控件不可绑定吗？我想我可以编写一些自定义函数，从给定的数据源填充树视图，并根据需要嵌入数据对象，但这是“最佳实践”吗？还是每个人都只是使用 3rd 方树形视图控件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-16T23:38:24.597

您是正确的，因为没有数据绑定。原因是 TreeViews 是分层数据结构。也就是说，不是一个直接的列表。因此，databind 选项对于说 List 结构是无效的。

可悲的是，它正在创建您自己的填充方法或购买第 3 方控件（最终将拥有自己的填充方法。）

[这是一篇关于Binding Hierarchical Data](http://msdn.microsoft.com/en-us/library/aa478959.aspx)的不错的 MSDN 文章。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T02:46:58.010

我使用 Developer's Express 中的树形控件。它将获取一个数据表并以分层方式显示/编辑它。
它所需要的只是表中的一个主键字段和一个父 id 字段，它可以找出去哪里。

如果您滚动自己的代码并使用自己的类，则可以做同样的事情。

```
class Node
{
    System.Collections.Generic.List<Node> _Children;
    String Description;

    void Node()
    {
      _Children = new System.Collections.Generic.List<Node>();
    }

    public System.Collections.Generic.List<Node> Children()
    {
      return (_Children);
    }
}

class Program
{
    static void Main(string[] args)
    {
      System.Collections.Generic.List<Node> myTree = new System.Collections.Generic.List<Node>();
      Node firstNode = new Node();
      Node childNode = new Node();
      firstNode.Children().Add(childNode);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T23:47:27.060

如果只有几个级别，我喜欢用几个表填充数据集并在列上设置 DataRelation。然后你使用一些嵌套循环并创建你的树节点。

# sql-server - 在 Sql Server 2005 表上插入需要更长的时间

> ID：372825
> 
> 赞同：0
> 
> 时间：2008-12-16T21:32:58.830
> 
> 标签：sql-server, database, sql-server-2005, database-design

我有一个大约 45 列的表，随着更多数据进入，插入发生的时间越长。我增加了数据和日志文件的大小，减少了该表上所有索引的填充因子，但插入时间仍然越来越慢。任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T21:42:22.850

*   对于插入，您希望减少表上索引的填充因子以减少页面拆分。

*   预计随着更多数据的进入，插入需要更长的时间，因为您的索引只会变得更大。

*   尝试分批而不是逐行输入数据。SQL Server 这样更有效。

*   确保您的表上没有太多索引。

*   如果您只是在索引中包含列，请考虑在索引中使用 SQL Server 2005 的 INCLUDE 语句，因为您希望在查询中涵盖它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T22:04:30.480

桌子有多大？

上下文是什么？这是一批许多新记录吗？

您可以发布包含索引定义的架构吗？

您可以设置统计 IO ON、设置统计时间并发布一次迭代的显示吗？

数据或上下文有什么病态的吗？这是在服务器还是笔记本电脑上（测试）？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T22:48:59.673

为什么不在插入索引之前删除索引并将索引重新创建回表，这样您就无需更新统计信息

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-07T14:46:33.223

您还可以确保对该表上的索引进行碎片整理

# jquery - JQuery 的双击功能不适用于 FireFox 中的无线电输入

> ID：372828
> 
> 赞同：0
> 
> 时间：2008-12-16T21:33:43.150
> 
> 标签：jquery, firefox

我写了下面的代码，通过双击从我的表单中的单选组中删除选中的项目。

```
$("input[type='radio']").each(function(){
            $(this).dblclick(function(){
                $(this).removeAttr("checked");
            });
        }); 
```

但此代码在 FireFox 中不起作用，但在 IE 中起作用。有人知道有什么问题吗？

坦克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-19T08:47:36.553

无论哪种方式，您可能都想以不同的方式连接它。

```
$("input[type='radio']").dblclick(function(){
  $(this).removeAttr("checked");
}); 
```

学习 jQuery 时可以帮助的一件事是基于集合的思考，比如 SQL。选择器可以选择一个或一组元素。您在组中调用的任何函数或事件都适用于整个组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T21:39:42.700

我很抱歉，它有效。我认为缓存会导致这个问题。

# visual-studio-2008 - 在带有 TFS 的 VS2008 解决方案中隐藏/阻止使用/访问/下载文件/文件夹？

> ID：372831
> 
> 赞同：1
> 
> 时间：2008-12-16T21:34:32.990
> 
> 标签：visual-studio-2008, tfs

如果解决方案在 TFS 下，是否可以隐藏/阻止各种用户（通过他们的 NTDomainName）在 VS2008 解决方案中的文件/文件夹？

我有一些文件和一个包含秘密信息的文件夹（例如 release.web.config 等），作为我们的 RELEASE 构建的一部分，我需要这些信息，但我不希望一些新的承包商能够看到/动手，出于安全原因。

这可能吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T09:04:26.953

如果您打开源代码管理资源管理器并右键单击文件/文件夹，您可以编辑文件的安全权限并控制谁可以读取或编辑文件。请注意，如果用户没有读取文件的权限，那么他们甚至不会看到它存在。

如果您这样做，那么您可能不希望将 release.web.config 作为您的解决方案/项目的一部分包含在内，因为解决方案资源管理器随后会将其显示为无权访问的人丢失。

请注意，由于在您没有读取权限时文件会消失，因此有一些关于对话框的警告。删除每个人（包括您自己）读取此文件的权限非常容易，如果您想再次授予自己权限，这会让您有点卡住，因为您将无法看到该文件以再次设置权限（请参阅[http://www.woodwardweb.com/vsts/dont_do_that.html](http://www.woodwardweb.com/vsts/dont_do_that.html)）。

如果使用安全设置您不小心删除了自己查看文件的访问权限，解决此问题的方法是作为具有本地管理员权限和 TFS 管理员权限的帐户（tfssetup 用户）登录到 TFS 服务器，然后您将能够看到该文件以再次更改权限。

# sql-server - SQL Server 2005 中的“创建用户”所需的权限？

> ID：372834
> 
> 赞同：4
> 
> 时间：2008-12-16T21:34:54.380
> 
> 标签：sql-server, sql-server-2005, login, permissions

我正在尝试从我的应用程序中创建一个 SQL 服务器登录名和数据库用户，以及一个自定义应用程序用户行。我希望这些用户能够创建其他用户——即应用程序将控制谁可以/不能创建用户，但我需要所有用户都拥有创建 SQL 服务器登录名和数据库用户的权限。

我已经使服务器登录权限正常工作-即现有用户/登录名可以创建新登录名-通过将登录名添加到“securityadmin”服务器角色-授予“ALTER ANY LOGIN”权限。

我尝试对数据库用户做同样的事情——将它们添加到“db_accessadmin”数据库角色中——这应该授予 CREATE USER 所需的 ALTER ANY USER 权限。

但是，每当我尝试使用具有上述权限的用户创建新的数据库用户时，都会出现权限异常。

我已经尝试手动将 ALTER ANY USER 权限授予特定用户（GRANT ALTER ANY USER TO demouser），但这也不起作用。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-18T12:05:05.870

从技术上讲，是的。不管是对是错……不予置评。

无论如何，数据库安全分为两个功能：

*   db_accessadmin 管理用户（或您提到的“ALTER ANY USER”权限）
*   [db_securityadmin](http://msdn.microsoft.com/en-us/library/ms188685.aspx)允许您管理角色成员资格和对象权限（或“ALTER ANY ROLE 权限）

[sp_addrolemember](http://msdn.microsoft.com/en-us/library/ms187750(SQL.90).aspx)提到了这一点。

您实际上是通过运行 sp_addrolemember 来更改角色，而不是用户，因此“ALTER ANY ROLE”就足够了，无需拥有完整的 db_owner 权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T22:27:59.623

我的错 - 我发现了问题 - 不是 CREATE USER 失败了，而是随后对“sp_addrolemember”的调用。这需要我没有分配的更多权限。

特别是我需要将我的用户添加到 db_owner 数据库角色中，以允许他们将其他/新用户分配给固定的数据库角色。

有没有一种更简洁的方法可以让我在这里实现我想要做的事情 - 即创建允许创建其他用户的用户？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-10T21:19:33.293

```
/* 
TOPIC: create a login ,who can add other logins to databases  (securityadmin server role)
*/

USE MASTER 
GO 

Create login securityTestLogin with password = '@@somepassword123'

-----add this to server , this is server level security role ------- 

EXEC master..sp_addsrvrolemember @loginame = N'securityTestLogin', @rolename = N'securityadmin'

--- first this login should be a user in database where we want to give other users access 

USE HTDBA
GO 
Create user securityTestLogin for login securityTestLogin 

EXEC sp_addrolemember N'db_accessadmin', N'securityTestLogin'

-- depends on your requriemtnt you might also want this permission too 
--EXEC sp_addrolemember N'db_securityadmin', N'securityTestLogin'

GO

------ Now we think about adding other users to different database roles  ------------- 
/* 
There is one gottcha , db_securityadmin role cannot add users to the fixed database roles ,only 
db_owner can perform this action , but for security we don't want to give this permission .
so we need a work around 
Create a role with required permission and then add users to that role.
*/ 

--Create user defined database role Readers
EXEC sp_addrole DBUser

-- Add this role to fixeddbroles to get database level permission 
EXEC sp_addrolemember db_datareader, DBUser
EXEC sp_addrolemember db_datawriter, DBUser 
GO

--------READY TO TEST --------
------ we are using this sample login for test 
use master 
Go 
Create login testlogin1 with password='@@somepassword123' 

use HTDBA 
go 
Create user testlogin1 for login testlogin1 

--- now add this user to user created DBUser role . 
EXEC sp_addrolemember DBUser, testlogin1 
```

关于 SQL 权限的一篇非常好的文章：

[http://www.sqlservercentral.com/articles/Security/sqlserversecurityfixeddatabaseroles/1231/](http://www.sqlservercentral.com/articles/Security/sqlserversecurityfixeddatabaseroles/1231/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-16T22:42:27.940

这看起来很危险，很容易成为安全噩梦。不知道为什么您认为这是实现目标的最佳解决方案，我真的不能告诉您不要这样做，但是哇！- 我会认真思考这是否真的有必要。从 DBA 的角度来看，用户的蜘蛛网似乎很快就无法管理。

您不能只拥有一个有权添加用户的 SQL 帐户，而应用程序每次都使用它来添加新用户吗？然后，这些用户将不需要添加其他用户的能力。也许这不适用于您的特定目标，但肯定还有其他方法。

但是说了这么多……不，真的没有更清洁的方法。必须为用户分配正确的角色，以便以后能够添加其他用户。

# eclipse - Eclipse 语法高亮首选项保存和恢复

> ID：372837
> 
> 赞同：96
> 
> 时间：2008-12-16T21:35:14.037
> 
> 标签：eclipse, ide, syntax-highlighting

我花了一些时间在 Eclipse（Java、JSP、HTML、CSS 等）中自定义语法突出显示的颜色，但是每当我尝试通过文件|导出|常规|首选项导出这些设置并重新导入它们时，这些设置永远不会完全导入背部。有些颜色恢复了，有些颜色保持不变，让我处于“介于两者之间”的状态——非常令人沮丧。

顺便说一句，我正在使用 Eclipse 3.4 Ganymede。

有没有人找到一种可靠的方法来保存和恢复 Eclipse 语法突出显示设置？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-02-28T15:19:24.007

我终于想出了如何做到这一点。

我只是想提前提一下，我确实尝试从全新的 Eclipse 安装开始，将首选项导出到`.epf`文件，只更改一个设置，再次导出，然后比较文件。令我惊讶的是，尝试从最小`.epf`文件导入设置也不能可靠地工作。

对我有用的解决方案是复制这些文件：`{Eclipse workspace directory}/.metadata/.plugins/org.eclipse.core.runtime/.settings/*.prefs`

我在另一台机器上尝试了全新的 Eclipse 安装，将这些文件复制过来后，我的所有设置都完美恢复了。

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2011-03-09T19:31:57.420

解决方案是将部分（不是全部）文件复制`{workspace}/.metadata/.plugins/org.eclipse.core.runtime/.settings/*.prefs`到我的另一个工作区中。

特别是（根据[https://stackoverflow.com/questions/96981/color-themes-for-eclipse](https://stackoverflow.com/questions/96981/color-themes-for-eclipse)线程）：

```
org.eclipse.jdt.ui.prefs = Syntax Coloring    
org.eclipse.ui.editors.prefs = Text Editors 
```

复制其他文件导致事情中断。

有几点需要补充：

1.  在获得正确的语法着色之前，我必须多次复制上述文件对。
2.  如果工作区在 Eclipse 中打开，请确保在复制文件之前关闭工作区。

这适用于 Eclipse Helios。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2017-02-23T15:48:21.490

我正在使用带有 Eclipse Neon 4.6 引擎的 JBoss Developer Studio 10。

所有`.prefs`文件都在此路径内：

```
/workspace/.metadata/.plugins/org.eclipse.core.runtime/.sett‌​ings 
```

> **更新：**我在这条路径上也发现了类似的结构：
> 
> `\RedHat\JBossDev\studio\configuration\.settings`
> 
> 这是我的 IDE 文件夹加上`\configuration\.settings`

我建议`org.eclipse.*ui*.prefs`改为搜索`*.prefs`以优化您的结果。

主要的配置文件是：

*   org.eclipse。**jdt** .ui.prefs
    *   Java 语法颜色设置
*   org.eclipse.ui。**编辑器**.prefs
    *   文本编辑器设置
*   org.eclipse。**cdt** .ui.prefs
    *   格式化程序设置
*   org.eclipse.wst。**jsdt** .ui.prefs
    *   JavaScript 语法颜色设置
*   org.eclipse.jst。**jsp** .ui.prefs
*   org.eclipse.wst。**css** .ui.prefs
*   org.eclipse.wst。**html** .ui.prefs
*   org.eclipse.wst。**json** .ui.prefs
*   org.eclipse.wst。**dtd** .ui.prefs
*   org.eclipse.wst。**xml** .ui.prefs
*   org.eclipse.wst。**xsl** .ui.prefs

* * *

如果工作区有问题：

1.  `Copy`上面的文件
2.  `Create`一个**新的工作空间**
3.  `Copy and Replace`**新工作区**中的文件

 **这将完美地恢复您的自定义编辑器颜色设置。对我来说工作得很好。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-06-28T21:47:13.257

如果您想对迁移的内容更加细化，语法突出显示规则是在 workspace-indigo/.metadata/.plugins/org.eclipse.core.runtime/.settings/org.eclipse 上以 semanticHighlighting 开头的行.jdt.ui.prefs

这样做，我能够将我的语法突出显示从 Helios 迁移到 Indigo

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-25T21:05:37.570

Eclipse CDT 将“语法着色”存储在文件*org.eclipse.cdt.ui.prefs中*

例如，它位于：*C:\eclipse\workspace.metadata.plugins\org.eclipse.core.runtime.settings\*

复制并粘贴到新 Eclipse 实例中的顶部。从 3.4 迁移到 3.5 时，这对我有用

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-16T22:39:06.620

我会在修改颜色之前导出首选项，然后再导出。

这样，您就可以将 eclipse 首选项文件的特定规则隔离到一个较小的文件中，并且：

*   检查某些未恢复的颜色是否确实由规则表示
*   较小首选项的导入对先前未更改的设置有任何影响。

这种策略可以进一步细化为几个小的设置文件（一个用于 Java，一个用于 JSP、HTML、CSS 等），以便在重新导入这些设置时更好地分析潜在的副作用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-09-22T17:51:58.650

我通过复制文件成功导入了 Eclipse Helios 的语法高亮规则：

```
.metadata/.plugins/org.eclipse.core.runtime/.settings/org.eclipse.jdt.ui.prefs 
```

从源工作区到目标工作区。该文件似乎还包含 Eclipse 的代码格式化程序配置文件和代码模板。

环境：

```
Version: Helios Release
Build id: 20100617-1415
(on linux) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-07-20T10:15:14.427

一旦迈克尔博斯沃思的回答在一定程度上帮助了我，我就投了赞成票。但现在我看到有义务自己回答，因为复制这两个文件是不够的。让我解释一下为什么。

*   首先，这些文件包含与语法着色无关的行。
*   其次，其他编辑器的语法着色位于别处，例如 XML 文件的语法着色位于

    `org.eclipse.wst.xml.ui.prefs`

和那些`HTML`文件：

```
 org.eclipse.wst.html.ui.prefs 
```

JSP 页面？

```
 org.eclipse.jst.jsp.ui.prefs 
```

， ETC。

*   第三，当我们更改字体颜色时，通常我们会更改背景颜色、行高亮颜色等，以获得更清晰的代码视图。这涉及更多文件。

如果我们`*.pref`在路径中搜索文件

```
/workspace/.metadata/.plugins 
```

我们可以找到所有首选项文件，我们可以在其中找到所有颜色设置行。但是通过将所有这些文件复制粘贴到另一个工作区也可能引发问题，因为它们不仅仅与语法着色相关。而且，当我们在两个Eclipse 版本之间切换时，可能会出现意想不到的问题。

所以，最安全的方法是：

*   如果您没有工作区，请创建一个新工作区。
*   将我们在工作区中找到的所有`*.pref`文件一一打开，
*   复制那些包含颜色代码的行，
*   在新工作区中找到相同的文件，
*   用现有的替换颜色部分。或者，在 Eclipse 中设置颜色，根据属性的名称假设相应的选项。所有颜色代码均基于 RGB。

**编辑**：（2017.02.24）

Eclipse Mars 有一个插件[Oomph](https://projects.eclipse.org/projects/tools.oomph)，它可以记录您的偏好设置，以提供您的偏好的无缝传输。当您激活它时，每次更改值时，它都会提示您询问是否要将其记录在 Oomph 中，并在相应文件中为您提供存储新值的确切行。因此，当您安装 Oomph 时，您可以：

1.  更改字体、字体大小、背景颜色等的设置。
2.  在 Oomph 的提示窗口中，记下新设置的位置。（因为如果你告诉 Oomph 记住你的设置，它就不会再提示了，所以你可能只会看到这个窗口一次。）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-26T03:07:10.317

我从以下 dreictory \myworkspace.metadata.plugins\org.eclipse.core.runtime.settings\ 中删除了最近更改的 *.prefs 文件，并导入了现有的导出首选项。

我是第一个根据我的知识回答这个问题的人:)，因为即使我也很挣扎。

谢谢

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-09-26T09:22:13.803

几天前我遇到了同样的问题。恢复默认值的最简单方法是再次导入默认主题，您可以在以下位置找到： [http ://eclipsecolorthemes.org/?view=theme&id=790](http://eclipsecolorthemes.org/?view=theme&id=790)

# c++ - C++ 编程风格

> ID：372862
> 
> 赞同：13
> 
> 时间：2008-12-16T21:41:46.003
> 
> 标签：c++, windows, oop

我是一个老（但不是太老）Java 程序员，决定学习 C++。但是我已经看到了很多 C++ 编程风格，是......好吧，真是丑陋！

将类定义放在头文件中的所有内容，以及将方法放在不同的源文件中的所有内容——突然调用函数，而不是使用**类**中的方法。这一切似乎……错了！

所以最后，我有什么理由继续对 OOP 进行这场大屠杀，以及编程中任何好的和正义的东西，还是我可以忽略那些老式的 C++ 约定，并使用我良好的 Java 编程风格？

顺便说一句，我正在学习 C++，因为我想做游戏编程。

这是一个例子：

在一个 C++ 网站中，我找到了一个 Windows 实现：

```
class WinClass
{
    public:

        WinClass (WNDPROC wndProc, char const * className, HINSTANCE hInst);
        void Register ()
        {
            ::RegisterClass (&_class);
        }

    private:

        WNDCLASS _class;
}; 
```

该类位于头文件和构造函数中：

```
WinClass::WinClass (WNDPROC wndProc, char const * className, HINSTANCE hInst)
{
    _class.style = 0;
    _class.lpfnWndProc = wndProc;  // Window Procedure: mandatory
    _class.cbClsExtra = 0;
    _class.cbWndExtra = 0;
    _class.hInstance = hInst;           // Owner of the class: mandatory
    _class.hIcon = 0;
    _class.hCursor = ::LoadCursor (0, IDC_ARROW); // Optional
    _class.hbrBackground = (HBRUSH) (COLOR_WINDOW + 1); // Optional
    _class.lpszMenuName = 0;
    _class.lpszClassName = className;   // Mandatory
} 
```

位于 .cpp 源文件中。

我能做的是：

```
class WinClass
{
    public:
        WinClass (WNDPROC wndProc, char const * className, HINSTANCE hInst)
        {
            _class.style = 0;
            _class.lpfnWndProc = wndProc;  // Window Procedure: mandatory
            _class.cbClsExtra = 0;
            _class.cbWndExtra = 0;
            _class.hInstance = hInst;           // Owner of the class: mandatory
            _class.hIcon = 0;
            _class.hCursor = ::LoadCursor (0, IDC_ARROW); // Optional
            _class.hbrBackground = (HBRUSH) (COLOR_WINDOW + 1); // Optional
            _class.lpszMenuName = 0;
            _class.lpszClassName = className;   // Mandatory
        }

        void Register ()
        {
            ::RegisterClass (&_class);
        }

    private:
        WNDCLASS _class;
}; 
```

现在构造函数在它的类中。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-16T22:12:42.447

除了这里别人说的，还有更重要的问题：

1) 大型翻译单元导致更长的编译时间和更大的目标文件大小。

2）循环依赖！这是最大的一个。它几乎总是可以通过拆分标题和源来修复：

```
// Vehicle.h
class Wheel {
    private:
        Car& m_parent;
    public:
        Wheel( Car& p ) : m_parent( p ) {
            std::cout << "Car has " << m_parent.numWheels() << " wheels." << std::endl;
        }
};

class Car {
    private:
        std::vector< Wheel > m_wheels;
    public:
        Car() {
            for( int i=0; i<4; ++i )
                m_wheels.push_back( Wheel( *this ) );
        }

        int numWheels() {
            return m_wheels.size();
        }
} 
```

不管你把它们放在什么顺序，一个总是缺少另一个的定义，即使使用前向声明它也不起作用，因为在函数体中使用每个类符号的细节。

但是，如果您将它们拆分为正确的 .h 和 .cpp 文件并使用前向声明，它将满足编译器的要求：

```
//Wheel.h
//-------
class Car;

class Wheel {
private:
    Car& m_parent;
public:
    Wheel( Car& p );
};

//Wheel.cpp
//---------
#include "Wheel.h"
#include "Car.h"

Wheel::Wheel( Car& p ) : m_parent( p ) {
        std::cout << "Car has " << m_parent.numWheels() << " wheels." << std::endl;
}

//Car.h
//-----
class Wheel;

class Car {
private:
    std::vector< Wheel > m_wheels;
public:
    Car();
    int numWheels();
}

//Car.cpp
//-------
#include "Car.h"
#include "Wheel.h"

Car::Car() {
        for( int i=0; i<4; ++i )
            m_wheels.push_back( Wheel( *this ) );
}

int Car::numWheels() {
        return m_wheels.size();
} 
```

现在，实际上必须知道第二类细节的代码可以只包含不需要知道第一类细节的头文件。

头文件只提供*声明*，而源文件提供*定义*。或者换一种说法：标题告诉你那里有什么（*哪些符号是有效的*），源代码告诉编译器这些符号实际做了什么。在 C++ 中，您只需要一个有效符号即可开始使用它。

相信 C++ 有这个成语的原因，因为如果你不这样做，你将会给自己带来很多麻烦。我知道 ：/

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-16T22:07:55.607

当代码构建时，C++ 预处理器构建一个翻译单元。它从一个 .cpp 文件开始，解析 #includes 从标题中获取文本，然后生成一个包含所有标题和 .cpp 代码的大文本文件。然后这个翻译单元被编译成可以在你的目标平台上运行的代码。每个翻译单元最终成为一个目标文件。

因此，.h 文件包含在多个翻译单元中，而 .cpp 文件只包含在一个翻译单元中。

如果 .h 文件包含很多东西（包括实现），那么翻译单元会相应地更大。编译时间会增加，并且当您更改标头中的任何内容时……每个使用它的翻译单元都需要重新编译。

所以.. 最小化 .h 文件中的内容大大提高了编译时间。您可以编辑 .cpp 文件来更改功能，并且只需要重建一个翻译单元。

完成关于编译的故事......
一旦所有翻译单元都构建到目标文件中（您平台的本机二进制代码）。链接器完成其工作，并将它们拼接到您的 .exe、.dll 或 .lib 文件中。一个 .lib 文件可以链接到另一个构建，因此它可以在多个 .exe 或 .dll 中重复使用。

我想 Java 编译模型更高级，而你把代码放在哪里的意义就更小了。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-16T21:59:55.170

.h 和 .cpp 文件通常将声明与定义分开，这里有某种顺序和概念封装。头文件有“什么”，实现文件有“如何”。

我发现在java中的一个文件中的所有内容都杂乱无章。所以，各有各的。

C++ 约定和习语都有经过深思熟虑的推理，就像任何其他语言对其社区采用的习语所做的那样。

我认为最好在编写 Java 时使用 java（作为动词），而在使用 C++ 时使用 C++！你会明白为什么与语言的经验。与切换到任何新语言相同。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-16T22:44:35.533

大多数答案都是关于头文件和编译单元的分离。我同意大多数人的观点，你必须使用它，因为它更高效、更干净、对同事更友好，或者仅仅是因为……（你会在不久之后注意到编译时间的优势）。

无论如何，我只是想发布问题的另一部分：C++ 是 OOP 大屠杀吗？

C++ 是一种多范式语言。它允许[过程](http://en.wikipedia.org/wiki/Procedural_programming)式、[面向对象](http://en.wikipedia.org/wiki/Object-oriented_programming)和[通用](http://en.wikipedia.org/wiki/Generic_programming)编程。这是一种美德，而不是一种缺陷。如果您愿意，您仍然可以使用纯 OOP，但是您的代码肯定会从学习和知道何时使用其他范例中受益。

例如，我不喜欢[实用程序类](http://en.wikipedia.org/wiki/Utility_class)，其中所有成员函数都是静态的，并且没有数据。没有理由创建一个实用程序类，而不仅仅是将一组自由函数组合在一个通用名称下。您必须在 Java 中执行此操作，因为它坚持纯 OO 语法，正如[Tom](https://stackoverflow.com/users/40620/tom)所言，它与真正的 OO 不同。在 C++ 中，定义命名空间和一组自由函数提供了类似的解决方案，您无需通过声明私有构造函数或允许用户从空类实例化无意义的对象来锁定对象的创建。

对我来说，经验（我曾经是一名纯 Java 程序员）告诉我，有不同的工具可以更好地解决不同的问题。我还没有找到一把[金锤子](http://en.wikipedia.org/wiki/Golden_hammer) ，而 C++ 的优点是您可以为每个不同的任务选择不同的锤子，即使在同一个编译单元中也是如此。

**更正**：[litb](https://stackoverflow.com/users/34509/litb)在评论中告诉我 WNDCLASS 是 win32 API 中的一个结构。因此，对不使用初始化列表的类的批评纯属无稽之谈，因此我将其删除。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-16T21:46:50.283

像其他人一样，找到适合您的风格。没有人会强迫你使用其中一种“丑陋”的风格，除非是你的雇主在执行指导文件。;-)

尽管请记住，将成员函数定义放在类内部而不是外部具有不同的语义。当您在类中定义成员函数时，无论好坏，它都是隐式内联的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-12-16T22:00:45.823

这称为分离接口和实现。这使客户能够弄清楚如何调用您的类，而不必费力地浏览所有代码。坦率地说，我认为人们认为它“错误”实际上是*疯狂的。*

但是，您会很高兴地发现许多 C++ 开发人员在这一点上同意您的观点。所以继续把你的整个实现放在 *.h 文件中。有一个风格学校与你一致。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-16T23:25:28.167

> 突然调用函数，而不是使用**类**中的方法；这一切似乎……错了！
> 
> 所以最后，我有什么理由继续对 OOP 进行这场大屠杀

好吧，调用不属于类的函数不是 OOP——它是过程编程。因此，我相信你真的很难摆脱 OOP 思维模式。（当然 C++ 有很多弊端，但过程式编程不是其中之一。）

C++ 是一种多范式语言，而不仅仅是一种 OO 语言。模板是一种通用编程形式，可应用于 C++ 的过程、OOP 和元编程范式。在下一个 C++ 标准中，您还会看到添加了一些功能范式。

> 将类定义放在头文件中，将方法放在不同的源文件中的所有内容；

这起源于 70 年代的 C 编程语言。C++ 被设计为向后兼容 C。

D 编程语言试图修复 C++ 的许多弊端（正如我之前所说，存在许多弊端），但保持 C++ 的良好特性——包括 C++ 支持的所有各种范式：过程、OOP、元编程和功能性的。

**如果你想打破 OOP 思维模式，试试 D！** 然后，当您对如何混合和匹配不同的范式有所了解时，您可以（如果您愿意）回到 C++ 并学习处理它的语法和其他弊端。

PS 我每天都使用 C++，我是它的粉丝——它是我最喜欢的编程语言。但是任何有经验的 C++ 程序员都知道，C++ 确实有它的弊端。但是，一旦您掌握了不同的范式并知道如何解决 C++ 的弊端，您将拥有一个非常强大的工具（因为这是一门语言的全部内容）供您使用。

祝你的冒险好运！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-16T21:51:47.887

如果你想在你的类定义中实现你的所有方法，你将拥有巨大的头文件（在 cpp 文件中声明类不是一个好主意）并且可能只有一个 cpp 文件（具有你的 main 函数的那个​​）。

所以这是一个方便的问题。

* * *

编辑：

我发现声明-实现分离实际上很有帮助。当我有大约 150 种方法的怪物类，其实现是使用大量预处理器技巧生成的时，我经常希望能够区分......

*   类可以做什么（它的接口，由它的声明给出）
*   类是如何做到的（它的实现）

在 C# 或 Java 中无法做到这一点非常令人沮丧，尤其是当我手头没有 Intellisense 时。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-16T22:17:15.573

这一点也不丑。我会说它是......嗯不同。把你的旧风格带到一个新平台上，这很丑（我和斯基特先生就这个问题进行了很多讨论）。

请记住， [Java](http://en.wikipedia.org/wiki/Java_%28programming_language%29)是在 C++ 之后数年定义的，因此它们修复了一些构造是合理的（以 C# 向 Java 学习的相同方式）。

所以，我建议保持这种 C++ 风格。

想想这个。头文件就像接口声明，cpp 文件是实现。

我认为 C++ 没有“interface”关键字，这是将类的接口与其实现分开的方式。与 Java 中的类似：

```
public interface Some { 
    public void method();
}

public class SomeImpl implements Some { 
    public void method(){}
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-16T22:34:00.000

如果您正在编写一个 C++ DLL 并且您将任何代码放在头文件中，那么您最终会遇到一个难以调试的混乱局面。DLL 将包含来自 .cpp 文件的代码，但 DLL 的**用户**将拥有一些内联到自己的代码。

这在 Windows 中非常糟糕，您在程序的不同部分会遇到不同的堆分配器，如果您更改实现，则 DLL 的调用者将使用内联标头中的旧代码。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-12-17T08:19:30.210

单独的声明和定义是 C++ 和 Java 之间最小的区别。现代 C++ 的主要区别在于“值语义”的重要性。

由于缺乏垃圾收集但对构建行为类似于自包含值的类型的出色支持，良好的 C++ 风格涉及编写行为良好的值类型，具有一致的构造、复制构造、赋值、交换和销毁。

特别是交换是一个非常重要的记住，因为它不直接被语言支持，但它确实应该存在于任何类似值的类型中。

看看标准 C++ 库是如何工作的，以及它期望你的类型如何表现。

尝试瞄准（并非总是可能）完全没有裸指针或使用 new 运算符。将这些细节隐藏在确保它们被正确使用的类中，将它们包装在值语义中。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-12-17T18:56:00.517

就像一个在特定范式中编程的典型程序员一样，您认为某些您不熟悉的东西只是丑陋的。

C++ 是一种不同的语言，它是多范式的，它有很多 C 的继承。正如其他人所说，它就是这样。

Header files are there for the compiler to check basic syntax without knowing the implementation. If you're a heavy Java programmer, you should be fairly familiar with the whole program to an interface concept. Think of the header file is where the interface is.

If you don't believe me, go look at some Mods out there for games. It's entirely possible to find the CryEngine2's header file somewhere because Crysis mods would need to talk to it, but it doesn't need to understand how it works. The header files will define how ultimately a calling function should setup the stack to call another function.

Not to be condensending, but I think what you really need is to program in something completely different. Research other paradigms, and find some languages, and start writing some toy applications. At first, things would look ugly, but you'll eventually see the advantages.

I said the same thing about functional programming too. Now I complain about how PHP butchered functional programming with arrays.

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-17T07:37:38.423

我认为许多程序员使用 Microsoft 产品（及其示例代码）和/或 Windows API 编程以及您问题的代码片段中使用的早期 Microsoft 编码约定（即匈牙利符号、定义类型的大写等..)。我讨厌查看来自 MicroSoft 的源代码，它看起来像是通过横切碎纸机运行并重新粘在一起。但是丑陋的编码约定不是 C++ 语言的函数或反映，我发现它并不比大多数其他语言更漂亮或更丑陋。

实际上，我发现带有最少关键字、花括号和丰富的符号运算符集的 C++ 语法不会分散或排挤重要的东西：我的变量、我的类型定义、我的方法；当然，这让我可以制作出最漂亮的代码 :-)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-16T21:53:53.357

我从你的问题的语气中担心你可能在学习 C++ 时阅读了一些糟糕的 C++ 代码。编写良好的代码在任何语言中通常都不难看。作为起点，您可以尝试[在线 C++ 常见问题解答](http://www.parashift.com/c++-faq-lite/index.html)，尤其是关于学习 C++ 的章节。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-16T21:57:12.617

你编程的风格取决于你。只要确保您了解其他人使用的“丑陋”风格。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-16T21:58:13.007

如果您想做游戏编程，您可能想与其他 C++ 开发人员一起工作，这意味着您必须以他们能够理解的方式做事。如果您希望进行任何协作，您的代码必须采用合理的 C++ 风格。如果您打算成为一个孤独的开发人员，并且您的代码基本上与您同在，请使用您喜欢的任何样式。

此外，C++ 和 Java 是两种不同的语言，需要以不同的方式使用。例如，头文件是有原因的（将其视为声明接口）。

# c# - 用于 URL 的 Path.Combine？

> ID：372865
> 
> 赞同：1394
> 
> 时间：2008-12-16T21:42:26.937
> 
> 标签：c#, .net, asp.net, url, path

[Path.Combine](https://msdn.microsoft.com/en-us/library/system.io.path.combine%28v=vs.110%29.aspx)很方便，但是 .NET 框架中是否有类似的[URL](http://en.wikipedia.org/wiki/Uniform_resource_locator)功能？

我正在寻找这样的语法：

```
Url.Combine("http://MyUrl.com/", "/Images/Image.jpg") 
```

这将返回：

`"http://MyUrl.com/Images/Image.jpg"`

* * *

## 回答 #1

> 赞同：1270
> 
> 时间：2009-10-06T19:37:12.203

[`Uri`](https://docs.microsoft.com/en-us/dotnet/api/system.uri)有一个应该为您执行此操作的构造函数：`new Uri(Uri baseUri, string relativeUri)`

这是一个例子：

```
Uri baseUri = new Uri("http://www.contoso.com");
Uri myUri = new Uri(baseUri, "catalog/shownew.htm"); 
```

编者注：请注意，此方法无法按预期工作。在某些情况下，它可以削减 baseUri 的一部分。查看评论和其他答案。

* * *

## 回答 #2

> 赞同：195
> 
> 时间：2009-09-25T10:29:57.050

这可能是一个适当简单的解决方案：

```
public static string Combine(string uri1, string uri2)
{
    uri1 = uri1.TrimEnd('/');
    uri2 = uri2.TrimStart('/');
    return string.Format("{0}/{1}", uri1, uri2);
} 
```

* * *

## 回答 #3

> 赞同：157
> 
> 时间：2011-11-03T10:20:37.333

这里已经有一些很好的答案。根据 mdsharpe 的建议，当您想要处理 Uri 实例时，可以轻松使用以下扩展方法：

```
using System;
using System.Linq;

public static class UriExtensions
{
    public static Uri Append(this Uri uri, params string[] paths)
    {
        return new Uri(paths.Aggregate(uri.AbsoluteUri, (current, path) => string.Format("{0}/{1}", current.TrimEnd('/'), path.TrimStart('/'))));
    }
} 
```

以及用法示例：

```
var url = new Uri("http://example.com/subpath/").Append("/part1/", "part2").AbsoluteUri; 
```

这将产生[http://example.com/subpath/part1/part2](http://example.com/subpath/part1/part2)

如果您想使用字符串而不是 Uris，那么以下内容也将产生相同的结果，只需对其进行调整以适应您的需要：

```
public string JoinUriSegments(string uri, params string[] segments)
{
    if (string.IsNullOrWhiteSpace(uri))
        return null;

    if (segments == null || segments.Length == 0)
        return uri;

    return segments.Aggregate(uri, (current, segment) => $"{current.TrimEnd('/')}/{segment.TrimStart('/')}");
}

var uri = JoinUriSegements("http://example.com/subpath/", "/part1/", "part2"); 
```

* * *

## 回答 #4

> 赞同：153
> 
> 时间：2008-12-16T21:49:56.253

您使用`Uri.TryCreate( ... )`：

```
Uri result = null;

if (Uri.TryCreate(new Uri("http://msdn.microsoft.com/en-us/library/"), "/en-us/library/system.uri.trycreate.aspx", out result))
{
    Console.WriteLine(result);
} 
```

将返回：

> **[http://msdn.microsoft.com/en-us/library/system.uri.trycreate.aspx](http://msdn.microsoft.com/en-us/library/system.uri.trycreate.aspx)**

* * *

## 回答 #5

> 赞同：121
> 
> 时间：2018-04-13T06:00:13.173

上面有[Todd Menier 的评论](https://stackoverflow.com/questions/372865/path-combine-for-urls/43582421#comment33212350_372865)，[Flurl](http://tmenier.github.io/Flurl/fluent-url/)包含一个`Url.Combine`.

更多细节：

> Url.Combine 基本上是 URL 的 Path.Combine，确保部分之间只有一个分隔符：

```
var url = Url.Combine(
    "http://MyUrl.com/",
    "/too/", "/many/", "/slashes/",
    "too", "few?",
    "x=1", "y=2"
// result: "http://www.MyUrl.com/too/many/slashes/too/few?x=1&y=2" 
```

在 NuGet 上获取[Flurl.Http](https://www.nuget.org/packages/Flurl.Http/)：

PM> Install-Package Flurl.Http

或者获取没有 HTTP 功能[的独立 URL 构建器：](https://www.nuget.org/packages/Flurl/)

PM> Install-Package Flurl

* * *

## 回答 #6

> 赞同：102
> 
> 时间：2010-05-10T21:53:04.547

Ryan Cook 的回答接近我所追求的，可能更适合其他开发人员。但是，它将 http:// 添加到字符串的开头，并且通常它的格式比我所追求的要多一些。

此外，对于我的用例，解析相对路径并不重要。

mdsharp 的答案还包含一个好主意的种子，尽管实际实现需要更多细节才能完成。这是一种充实它的尝试（我在生产中使用它）：

**C＃**

```
public string UrlCombine(string url1, string url2)
{
    if (url1.Length == 0) {
        return url2;
    }

    if (url2.Length == 0) {
        return url1;
    }

    url1 = url1.TrimEnd('/', '\\');
    url2 = url2.TrimStart('/', '\\');

    return string.Format("{0}/{1}", url1, url2);
} 
```

**VB.NET**

```
Public Function UrlCombine(ByVal url1 As String, ByVal url2 As String) As String
    If url1.Length = 0 Then
        Return url2
    End If

    If url2.Length = 0 Then
        Return url1
    End If

    url1 = url1.TrimEnd("/"c, "\"c)
    url2 = url2.TrimStart("/"c, "\"c)

    Return String.Format("{0}/{1}", url1, url2)
End Function 
```

此代码通过了以下测试，恰好在 VB 中：

```
<TestMethod()> Public Sub UrlCombineTest()
    Dim target As StringHelpers = New StringHelpers()

    Assert.IsTrue(target.UrlCombine("test1", "test2") = "test1/test2")
    Assert.IsTrue(target.UrlCombine("test1/", "test2") = "test1/test2")
    Assert.IsTrue(target.UrlCombine("test1", "/test2") = "test1/test2")
    Assert.IsTrue(target.UrlCombine("test1/", "/test2") = "test1/test2")
    Assert.IsTrue(target.UrlCombine("/test1/", "/test2/") = "/test1/test2/")
    Assert.IsTrue(target.UrlCombine("", "/test2/") = "/test2/")
    Assert.IsTrue(target.UrlCombine("/test1/", "") = "/test1/")
End Sub 
```

* * *

## 回答 #7

> 赞同：45
> 
> 时间：2011-07-15T08:17:25.430

Path.Combine 对我不起作用，因为可以有像“|”这样的字符 在 QueryString 参数和 URL 中，这将导致 ArgumentException。

我首先尝试了新`Uri(Uri baseUri, string relativeUri)`方法，但由于以下 URI 而失败了`http://www.mediawiki.org/wiki/Special:SpecialPages`：

```
new Uri(new Uri("http://www.mediawiki.org/wiki/"), "Special:SpecialPages") 
```

将导致 Special:SpecialPages，因为后面的冒号`Special`表示一个方案。

所以我最终不得不采用 mdsharpe/Brian MacKays 路线并进一步开发它以处理多个 URI 部分：

```
public static string CombineUri(params string[] uriParts)
{
    string uri = string.Empty;
    if (uriParts != null && uriParts.Length > 0)
    {
        char[] trims = new char[] { '\\', '/' };
        uri = (uriParts[0] ?? string.Empty).TrimEnd(trims);
        for (int i = 1; i < uriParts.Length; i++)
        {
            uri = string.Format("{0}/{1}", uri.TrimEnd(trims), (uriParts[i] ?? string.Empty).TrimStart(trims));
        }
    }
    return uri;
} 
```

用法：`CombineUri("http://www.mediawiki.org/", "wiki", "Special:SpecialPages")`

* * *

## 回答 #8

> 赞同：34
> 
> 时间：2010-03-28T00:21:37.617

根据您提供的示例[URL](https://en.wikipedia.org/wiki/Uniform_resource_locator)，我将假设您想要组合与您的站点相关的 URL。

基于这个假设，我将提出这个解决方案作为对您的问题的最合适的回答：“Path.Combine 很方便，URL 框架中是否有***类似的功能？”***

由于URL 框架中有***类似的功能，我建议正确的是：“VirtualPathUtility.Combine”方法。***这是 MSDN 参考链接：[VirtualPathUtility.Combine Method](https://docs.microsoft.com/en-us/dotnet/api/system.web.virtualpathutility.combine)

有一个警告：我相信这仅适用于与您的网站相关的 URL（也就是说，您不能使用它来生成指向另一个网站的链接。例如，`var url = VirtualPathUtility.Combine("www.google.com", "accounts/widgets");`）。

* * *

## 回答 #9

> 赞同：25
> 
> 时间：2011-01-11T21:41:18.130

```
Path.Combine("Http://MyUrl.com/", "/Images/Image.jpg").Replace("\\", "/") 
```

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2010-11-25T08:43:19.760

我只是整理了一个小的扩展方法：

```
public static string UriCombine (this string val, string append)
        {
            if (String.IsNullOrEmpty(val)) return append;
            if (String.IsNullOrEmpty(append)) return val;
            return val.TrimEnd('/') + "/" + append.TrimStart('/');
        } 
```

它可以这样使用：

```
"www.example.com/".UriCombine("/images").UriCombine("first.jpeg"); 
```

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2009-07-30T15:08:28.870

诙谐的例子，Ryan，以函数的链接结束。做得好。

一个建议 Brian：如果您将此代码包装在一个函数中，您可能希望在 TryCreate 调用之前使用 UriBuilder 来包装基本 URL。

否则，基本 URL 必须包含方案（UriBuilder 将假定 http://）。只是一个想法：

```
public string CombineUrl(string baseUrl, string relativeUrl) {
    UriBuilder baseUri = new UriBuilder(baseUrl);
    Uri newUri;

    if (Uri.TryCreate(baseUri.Uri, relativeUrl, out newUri))
        return newUri.ToString();
    else
        throw new ArgumentException("Unable to combine specified url values");
} 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2010-05-12T21:42:32.000

将它们组合并确保其始终正确的一种简单方法是：

```
string.Format("{0}/{1}", Url1.Trim('/'), Url2); 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2014-04-30T22:21:05.780

组合 URL 的多个部分可能有点棘手。您可以使用双参数构造函数`Uri(baseUri, relativeUri)`，也可以使用`Uri.TryCreate()`实用程序函数。

在任何一种情况下，您最终都可能返回一个不正确的结果，因为这些方法不断地从第一个参数中截断相关部分`baseUri`，即从类似于`http://google.com/some/thing`to的东西中截断`http://google.com`。

为了能够将多个部分组合成最终 URL，您可以复制以下两个函数：

```
 public static string Combine(params string[] parts)
    {
        if (parts == null || parts.Length == 0) return string.Empty;

        var urlBuilder = new StringBuilder();
        foreach (var part in parts)
        {
            var tempUrl = tryCreateRelativeOrAbsolute(part);
            urlBuilder.Append(tempUrl);
        }
        return VirtualPathUtility.RemoveTrailingSlash(urlBuilder.ToString());
    }

    private static string tryCreateRelativeOrAbsolute(string s)
    {
        System.Uri uri;
        System.Uri.TryCreate(s, UriKind.RelativeOrAbsolute, out uri);
        string tempUrl = VirtualPathUtility.AppendTrailingSlash(uri.ToString());
        return tempUrl;
    } 
```

可以在[https://uricombine.codeplex.com/SourceControl/latest#UriCombine/Uri.cs找到带有单元测试的完整代码以演示用法](https://uricombine.codeplex.com/SourceControl/latest#UriCombine/Uri.cs)

我有单元测试来涵盖三种最常见的情况：

![在此处输入图像描述](https://i.stack.imgur.com/gidEj.png)

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2019-11-07T22:37:47.450

正如在其他答案中发现的那样，要么是新的，`Uri()`要么`TryCreate()`可以打勾。但是，基本 Uri 必须以 ; 结尾，而相对不能以;`/`开头。`/`否则它将删除基本 URL 的尾随部分

我认为这是最好的扩展方法，即

```
public static Uri Append(this Uri uri, string relativePath)
{
    var baseUri = uri.AbsoluteUri.EndsWith('/') ? uri : new Uri(uri.AbsoluteUri + '/');
    var relative = relativePath.StartsWith('/') ? relativePath.Substring(1) : relativePath;
    return new Uri(baseUri, relative);
} 
```

并使用它：

```
var baseUri = new Uri("http://test.com/test/");
var combinedUri =  baseUri.Append("/Do/Something"); 
```

在性能方面，这消耗的资源比它需要的要多，因为 Uri 类做了很多解析和验证；一个非常粗略的分析（调试）在大约 2 秒内完成了一百万次操作。这适用于大多数场景，但是为了更高效，最好将所有内容都作为字符串进行操作，100 万次操作需要 125 毫秒。IE

```
public static string Append(this Uri uri, string relativePath)
{
    //avoid the use of Uri as it's not needed, and adds a bit of overhead.
    var absoluteUri = uri.AbsoluteUri; //a calculated property, better cache it
    var baseUri = absoluteUri.EndsWith('/') ? absoluteUri : absoluteUri + '/';
    var relative = relativePath.StartsWith('/') ? relativePath.Substring(1) : relativePath;
    return baseUri + relative;
} 
```

如果你仍然想返回一个 URI，100 万次操作大约需要 600 毫秒。

```
public static Uri AppendUri(this Uri uri, string relativePath)
{
    //avoid the use of Uri as it's not needed, and adds a bit of overhead.
    var absoluteUri = uri.AbsoluteUri; //a calculated property, better cache it
    var baseUri = absoluteUri.EndsWith('/') ? absoluteUri : absoluteUri + '/';
    var relative = relativePath.StartsWith('/') ? relativePath.Substring(1) : relativePath;
    return new Uri(baseUri + relative);
} 
```

我希望这有帮助。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2020-04-19T09:18:20.357

我认为这应该为您提供更大的灵活性，因为您可以处理任意数量的路径段：

```
public static string UrlCombine(this string baseUrl, params string[] segments)
=> string.Join("/", new[] { baseUrl.TrimEnd('/') }.Concat(segments.Select(s => s.Trim('/')))); 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2013-05-22T12:19:12.343

我发现`UriBuilder`这种事情非常有效：

```
UriBuilder urlb = new UriBuilder("http", _serverAddress, _webPort, _filePath);
Uri url = urlb.Uri;
return url.AbsoluteUri; 
```

有关更多构造函数和文档，请参阅[UriBuilder 类 - MSDN](https://docs.microsoft.com/en-us/dotnet/api/system.uribuilder)。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2020-06-20T10:15:12.680

如果你不想像 Flurl 这样的依赖，你可以使用它的源代码：

```
 /// <summary>
    /// Basically a Path.Combine for URLs. Ensures exactly one '/' separates each segment,
    /// and exactly on '&amp;' separates each query parameter.
    /// URL-encodes illegal characters but not reserved characters.
    /// </summary>
    /// <param name="parts">URL parts to combine.</param>
    public static string Combine(params string[] parts) {
        if (parts == null)
            throw new ArgumentNullException(nameof(parts));

        string result = "";
        bool inQuery = false, inFragment = false;

        string CombineEnsureSingleSeparator(string a, string b, char separator) {
            if (string.IsNullOrEmpty(a)) return b;
            if (string.IsNullOrEmpty(b)) return a;
            return a.TrimEnd(separator) + separator + b.TrimStart(separator);
        }

        foreach (var part in parts) {
            if (string.IsNullOrEmpty(part))
                continue;

            if (result.EndsWith("?") || part.StartsWith("?"))
                result = CombineEnsureSingleSeparator(result, part, '?');
            else if (result.EndsWith("#") || part.StartsWith("#"))
                result = CombineEnsureSingleSeparator(result, part, '#');
            else if (inFragment)
                result += part;
            else if (inQuery)
                result = CombineEnsureSingleSeparator(result, part, '&');
            else
                result = CombineEnsureSingleSeparator(result, part, '/');

            if (part.Contains("#")) {
                inQuery = false;
                inFragment = true;
            }
            else if (!inFragment && part.Contains("?")) {
                inQuery = true;
            }
        }
        return EncodeIllegalCharacters(result);
    }

    /// <summary>
    /// URL-encodes characters in a string that are neither reserved nor unreserved. Avoids encoding reserved characters such as '/' and '?'. Avoids encoding '%' if it begins a %-hex-hex sequence (i.e. avoids double-encoding).
    /// </summary>
    /// <param name="s">The string to encode.</param>
    /// <param name="encodeSpaceAsPlus">If true, spaces will be encoded as + signs. Otherwise, they'll be encoded as %20.</param>
    /// <returns>The encoded URL.</returns>
    public static string EncodeIllegalCharacters(string s, bool encodeSpaceAsPlus = false) {
        if (string.IsNullOrEmpty(s))
            return s;

        if (encodeSpaceAsPlus)
            s = s.Replace(" ", "+");

        // Uri.EscapeUriString mostly does what we want - encodes illegal characters only - but it has a quirk
        // in that % isn't illegal if it's the start of a %-encoded sequence https://stackoverflow.com/a/47636037/62600

        // no % characters, so avoid the regex overhead
        if (!s.Contains("%"))
            return Uri.EscapeUriString(s);

        // pick out all %-hex-hex matches and avoid double-encoding 
        return Regex.Replace(s, "(.*?)((%[0-9A-Fa-f]{2})|$)", c => {
            var a = c.Groups[1].Value; // group 1 is a sequence with no %-encoding - encode illegal characters
            var b = c.Groups[2].Value; // group 2 is a valid 3-character %-encoded sequence - leave it alone!
            return Uri.EscapeUriString(a) + b;
        });
    } 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2017-02-28T02:11:23.357

我发现以下有用并具有以下功能：

*   抛出空或空白
*   `params`为多个 Url 段采用多个参数
*   抛出 null 或空

**班级**

```
public static class UrlPath
{
   private static string InternalCombine(string source, string dest)
   {
      if (string.IsNullOrWhiteSpace(source))
         throw new ArgumentException("Cannot be null or white space", nameof(source));

      if (string.IsNullOrWhiteSpace(dest))
         throw new ArgumentException("Cannot be null or white space", nameof(dest));

      return $"{source.TrimEnd('/', '\\')}/{dest.TrimStart('/', '\\')}";
   }

   public static string Combine(string source, params string[] args) 
       => args.Aggregate(source, InternalCombine);
} 
```

**测试**

```
UrlPath.Combine("test1", "test2");
UrlPath.Combine("test1//", "test2");
UrlPath.Combine("test1", "/test2");

// Result = test1/test2

UrlPath.Combine(@"test1\/\/\/", @"\/\/\\\\\//test2", @"\/\/\\\\\//test3\") ;

// Result = test1/test2/test3

UrlPath.Combine("/test1/", "/test2/", null);
UrlPath.Combine("", "/test2/");
UrlPath.Combine("/test1/", null);

// Throws an ArgumentException 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2015-05-17T07:52:20.983

我的通用解决方案：

```
public static string Combine(params string[] uriParts)
{
    string uri = string.Empty;
    if (uriParts != null && uriParts.Any())
    {
        char[] trims = new char[] { '\\', '/' };
        uri = (uriParts[0] ?? string.Empty).TrimEnd(trims);

        for (int i = 1; i < uriParts.Length; i++)
        {
            uri = string.Format("{0}/{1}", uri.TrimEnd(trims), (uriParts[i] ?? string.Empty).TrimStart(trims));
        }
    }

    return uri;
} 
```

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2015-11-01T18:34:51.633

这是 Microsoft 的 (OfficeDev PnP) 方法[UrlUtility.Combine](https://github.com/OfficeDev/PnP-Sites-Core/blob/master/Core/OfficeDevPnP.Core/Utilities/UrlUtility.cs)：

```
 const char PATH_DELIMITER = '/';

    /// <summary>
    /// Combines a path and a relative path.
    /// </summary>
    /// <param name="path"></param>
    /// <param name="relative"></param>
    /// <returns></returns>
    public static string Combine(string path, string relative) 
    {
        if(relative == null)
            relative = String.Empty;

        if(path == null)
            path = String.Empty;

        if(relative.Length == 0 && path.Length == 0)
            return String.Empty;

        if(relative.Length == 0)
            return path;

        if(path.Length == 0)
            return relative;

        path = path.Replace('\\', PATH_DELIMITER);
        relative = relative.Replace('\\', PATH_DELIMITER);

        return path.TrimEnd(PATH_DELIMITER) + PATH_DELIMITER + relative.TrimStart(PATH_DELIMITER);
    } 
```

来源：[GitHub](https://github.com/OfficeDev/PnP-Sites-Core/blob/master/Core/OfficeDevPnP.Core/Utilities/UrlUtility.cs)

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2019-09-04T13:40:30.097

所以我有另一种方法，类似于所有使用 UriBuilder 的人。

我不想像 javajavajavajavajava 那样拆分我的 BaseUrl（它可以包含路径的一部分 -[例如](https://stackoverflow.com/users/831918/javajavajavajavajava)[http://mybaseurl.com/dev/](http://mybaseurl.com/dev/)）。

以下代码段显示了代码 + 测试。

**注意：**此解决方案将主机小写并附加一个端口。如果不希望这样做，可以通过例如利用 的`Uri`属性来编写字符串表示`UriBuilder`。

```
 public class Tests
  {
         public static string CombineUrl (string baseUrl, string path)
         {
           var uriBuilder = new UriBuilder (baseUrl);
           uriBuilder.Path = Path.Combine (uriBuilder.Path, path);
           return uriBuilder.ToString();
         }

         [TestCase("http://MyUrl.com/", "/Images/Image.jpg", "http://myurl.com:80/Images/Image.jpg")]
         [TestCase("http://MyUrl.com/basePath", "/Images/Image.jpg", "http://myurl.com:80/Images/Image.jpg")]
         [TestCase("http://MyUrl.com/basePath", "Images/Image.jpg", "http://myurl.com:80/basePath/Images/Image.jpg")]
         [TestCase("http://MyUrl.com/basePath/", "Images/Image.jpg", "http://myurl.com:80/basePath/Images/Image.jpg")]
         public void Test1 (string baseUrl, string path, string expected)
         {
           var result = CombineUrl (baseUrl, path);

           Assert.That (result, Is.EqualTo (expected));
         }
  } 
```

在 Windows 10 上使用 .NET Core 2.1 进行测试。

**为什么这行得通？**

尽管`Path.Combine`会返回反斜杠（至少在 Windows 上），但 UriBuilder 在`Path`.

取自[https://github.com/dotnet/corefx/blob/master/src/System.Private.Uri/src/System/UriBuilder.cs](https://github.com/dotnet/corefx/blob/master/src/System.Private.Uri/src/System/UriBuilder.cs)（注意调用`string.Replace`）

```
[AllowNull]
public string Path
{
      get
      {
          return _path;
      }
      set
      {
          if ((value == null) || (value.Length == 0))
          {
              value = "/";
          }
          _path = Uri.InternalEscapeString(value.Replace('\\', '/'));
          _changed = true;
      }
 } 
```

**这是最好的方法吗？**

当然，这个解决方案是非常自我描述的（至少在我看来）。但是您依赖于 .NET API 中未记录的（至少我通过快速的 google 搜索一无所获）“功能”。这可能会随着未来的版本而改变，所以请用测试覆盖方法。

[https://github.com/dotnet/corefx/blob/master/src/System.Private.Uri/tests/FunctionalTests/UriBuilderTests.cs](https://github.com/dotnet/corefx/blob/master/src/System.Private.Uri/tests/FunctionalTests/UriBuilderTests.cs) ( `Path_Get_Set`) 中有测试`\`是否正确转换。

**旁注：**`UriBuilder.Uri`如果 uri 将用于`System.Uri`ctor ，也可以直接使用该属性。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2016-07-21T18:19:05.380

我创建了这个功能，让您的生活更轻松：

```
 /// <summary>
    /// The ultimate Path combiner of all time
    /// </summary>
    /// <param name="IsURL">
    /// true - if the paths are Internet URLs, false - if the paths are local URLs, this is very important as this will be used to decide which separator will be used.
    /// </param>
    /// <param name="IsRelative">Just adds the separator at the beginning</param>
    /// <param name="IsFixInternal">Fix the paths from within (by removing duplicate separators and correcting the separators)</param>
    /// <param name="parts">The paths to combine</param>
    /// <returns>the combined path</returns>
    public static string PathCombine(bool IsURL , bool IsRelative , bool IsFixInternal , params string[] parts)
    {
        if (parts == null || parts.Length == 0) return string.Empty;
        char separator = IsURL ? '/' : '\\';

        if (parts.Length == 1 && IsFixInternal)
        {
            string validsingle;
            if (IsURL)
            {
                validsingle = parts[0].Replace('\\' , '/');
            }
            else
            {
                validsingle = parts[0].Replace('/' , '\\');
            }
            validsingle = validsingle.Trim(separator);
            return (IsRelative ? separator.ToString() : string.Empty) + validsingle;
        }

        string final = parts
            .Aggregate
            (
            (string first , string second) =>
            {
                string validfirst;
                string validsecond;
                if (IsURL)
                {
                    validfirst = first.Replace('\\' , '/');
                    validsecond = second.Replace('\\' , '/');
                }
                else
                {
                    validfirst = first.Replace('/' , '\\');
                    validsecond = second.Replace('/' , '\\');
                }
                var prefix = string.Empty;
                if (IsFixInternal)
                {
                    if (IsURL)
                    {
                        if (validfirst.Contains("://"))
                        {
                            var tofix = validfirst.Substring(validfirst.IndexOf("://") + 3);
                            prefix = validfirst.Replace(tofix , string.Empty).TrimStart(separator);

                            var tofixlist = tofix.Split(new[] { separator } , StringSplitOptions.RemoveEmptyEntries);

                            validfirst = separator + string.Join(separator.ToString() , tofixlist);
                        }
                        else
                        {
                            var firstlist = validfirst.Split(new[] { separator } , StringSplitOptions.RemoveEmptyEntries);
                            validfirst = string.Join(separator.ToString() , firstlist);
                        }

                        var secondlist = validsecond.Split(new[] { separator } , StringSplitOptions.RemoveEmptyEntries);
                        validsecond = string.Join(separator.ToString() , secondlist);
                    }
                    else
                    {
                        var firstlist = validfirst.Split(new[] { separator } , StringSplitOptions.RemoveEmptyEntries);
                        var secondlist = validsecond.Split(new[] { separator } , StringSplitOptions.RemoveEmptyEntries);

                        validfirst = string.Join(separator.ToString() , firstlist);
                        validsecond = string.Join(separator.ToString() , secondlist);
                    }
                }
                return prefix + validfirst.Trim(separator) + separator + validsecond.Trim(separator);
            }
            );
        return (IsRelative ? separator.ToString() : string.Empty) + final;
    } 
```

它适用于 URL 以及普通路径。

用法：

```
 // Fixes internal paths
    Console.WriteLine(PathCombine(true , true , true , @"\/\/folder 1\/\/\/\\/\folder2\///folder3\\/" , @"/\somefile.ext\/\//\"));
    // Result: /folder 1/folder2/folder3/somefile.ext

    // Doesn't fix internal paths
    Console.WriteLine(PathCombine(true , true , false , @"\/\/folder 1\/\/\/\\/\folder2\///folder3\\/" , @"/\somefile.ext\/\//\"));
    //result : /folder 1//////////folder2////folder3/somefile.ext

    // Don't worry about URL prefixes when fixing internal paths
    Console.WriteLine(PathCombine(true , false , true , @"/\/\/https:/\/\/\lul.com\/\/\/\\/\folder2\///folder3\\/" , @"/\somefile.ext\/\//\"));
    // Result: https://lul.com/folder2/folder3/somefile.ext

    Console.WriteLine(PathCombine(false , true , true , @"../../../\\..\...\./../somepath" , @"anotherpath"));
    // Result: \..\..\..\..\...\.\..\somepath\anotherpath 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2017-11-17T13:11:56.543

为什么不只使用以下内容。

```
System.IO.Path.Combine(rootUrl, subPath).Replace(@"\", "/") 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2018-09-30T10:43:22.743

我发现`Uri`构造函数将“\”翻转为“/”。因此，您也可以将`Path.Combine`, 与`Uri`构造函数一起使用。

```
 Uri baseUri = new Uri("http://MyUrl.com");
 string path = Path.Combine("Images", "Image.jpg");
 Uri myUri = new Uri(baseUri, path); 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2019-03-25T17:29:24.773

对于它的价值，这里有几个扩展方法。第一个将组合路径，第二个将参数添加到 URL。

```
 public static string CombineUrl(this string root, string path, params string[] paths)
    {
        if (string.IsNullOrWhiteSpace(path))
        {
            return root;
        }

        Uri baseUri = new Uri(root);
        Uri combinedPaths = new Uri(baseUri, path);

        foreach (string extendedPath in paths)
        {
           combinedPaths = new Uri(combinedPaths, extendedPath);
        }

        return combinedPaths.AbsoluteUri;
    }

    public static string AddUrlParams(this string url, Dictionary<string, string> parameters)
    {
        if (parameters == null || !parameters.Keys.Any())
        {
            return url;
        }

        var tempUrl = new StringBuilder($"{url}?");
        int count = 0;

        foreach (KeyValuePair<string, string> parameter in parameters)
        {
            if (count > 0)
            {
                tempUrl.Append("&");
            }

            tempUrl.Append($"{WebUtility.UrlEncode(parameter.Key)}={WebUtility.UrlEncode(parameter.Value)}");
            count++;
        }

        return tempUrl.ToString();
    } 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2019-08-28T00:01:25.160

如果您不想在 ASP.NET Core（也可在 Microsoft.Owin 中使用）中添加第三方依赖项（例如 Flurl）或创建自定义扩展方法，则可以使用`PathString`旨在构建 URI 的路径。然后，您可以使用此组合`Uri`和`UriBuilder`.

在这种情况下，它将是：

```
new Uri(new UriBuilder("http", "MyUrl.com").Uri, new PathString("/Images").Add("/Image.jpg").ToString()) 
```

这为您提供了所有组成部分，而无需在基本 URL 中指定分隔符。不幸的是，`PathString`要求`/`在每个字符串前面加上它，否则它实际上会抛出一个`ArgumentException`! 但至少您可以以一种易于单元测试的方式确定性地构建您的 URI。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2021-12-01T16:21:24.553

我有一个无分配的字符串创建版本，我一直在使用它并取得了巨大的成功。

笔记：

1.  对于第一个字符串：它使用`TrimEnd(separator)`- 因此仅从字符串的末尾修剪分隔符。
2.  对于其余部分：它使用`Trim(separator)`- 修剪分隔符，因此路径的开始和结束
3.  它不附加尾部斜杠/分隔符。尽管可以进行简单的修改来添加此功能。

希望你觉得这个有用！

```
/// <summary>
/// This implements an allocation-free string creation to construct the path.
/// This uses 3.5x LESS memory and is 2x faster than some alternate methods (StringBuilder, interpolation, string.Concat, etc.).
/// </summary>
/// <param name="str"></param>
/// <param name="paths"></param>
/// <returns></returns>
public static string ConcatPath(this string str, params string[] paths)
{
    const char separator = '/';
    if (str == null) throw new ArgumentNullException(nameof(str));

    var list = new List<ReadOnlyMemory<char>>();
    var first = str.AsMemory().TrimEnd(separator);

    // get length for intial string after it's trimmed
    var length = first.Length;
    list.Add(first);

    foreach (var path in paths)
    {
        var newPath = path.AsMemory().Trim(separator);
        length += newPath.Length + 1;
        list.Add(newPath);
    }

    var newString = string.Create(length, list, (chars, state) =>
    {
        // NOTE: We don't access the 'list' variable in this delegate since 
        // it would cause a closure and allocation. Instead we access the state parameter.

        // track our position within the string data we are populating
        var position = 0;

        // copy the first string data to index 0 of the Span<char>
        state[0].Span.CopyTo(chars);

        // update the position to the new length
        position += state[0].Span.Length;

        // start at index 1 when slicing
        for (var i = 1; i < state.Count; i++)
        {
            // add a separator in the current position and increment position by 1
            chars[position++] = separator;

            // copy each path string to a slice at current position
            state[i].Span.CopyTo(chars.Slice(position));

            // update the position to the new length
            position += state[i].Length;
        }
    });
    return newString;
} 
```

使用基准点网输出：

```
|                Method |     Mean |    Error |   StdDev |   Median | Ratio | RatioSD |  Gen 0 | Allocated |
|---------------------- |---------:|---------:|---------:|---------:|------:|--------:|-------:|----------:|
| ConcatPathWithBuilder | 404.1 ns | 27.35 ns | 78.48 ns | 380.3 ns |  1.00 |    0.00 | 0.3347 |   1,400 B |
|            ConcatPath | 187.2 ns |  5.93 ns | 16.44 ns | 183.2 ns |  0.48 |    0.10 | 0.0956 |     400 B | 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2012-12-10T15:31:30.493

用这个：

```
public static class WebPath
{
    public static string Combine(params string[] args)
    {
        var prefixAdjusted = args.Select(x => x.StartsWith("/") && !x.StartsWith("http") ? x.Substring(1) : x);
        return string.Join("/", prefixAdjusted);
    }
} 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2013-08-03T03:39:54.637

这是我的方法，我也会自己使用它：

```
public static string UrlCombine(string part1, string part2)
{
    string newPart1 = string.Empty;
    string newPart2 = string.Empty;
    string seperator = "/";

    // If either part1 or part 2 is empty,
    // we don't need to combine with seperator
    if (string.IsNullOrEmpty(part1) || string.IsNullOrEmpty(part2))
    {
        seperator = string.Empty;
    }

    // If part1 is not empty,
    // remove '/' at last
    if (!string.IsNullOrEmpty(part1))
    {
        newPart1 = part1.TrimEnd('/');
    }

    // If part2 is not empty,
    // remove '/' at first
    if (!string.IsNullOrEmpty(part2))
    {
        newPart2 = part2.TrimStart('/');
    }

    // Now finally combine
    return string.Format("{0}{1}{2}", newPart1, seperator, newPart2);
} 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2016-04-05T05:04:15.623

**将 URL 与 URI 组合时的规则**

为了避免奇怪的行为，需要遵循一条规则：

*   路径（目录）必须以“/”结尾。如果路径没有“/”结尾，则最后一部分被视为文件名，并且在尝试与下一个 URL 部分组合时将被连接起来。
*   有一个例外：基本 URL 地址（没有目录信息）不需要以 '/' 结尾
*   路径部分不能以“/”开头。如果它以“/”开头，则从 URL 中删除所有现有的相关信息……添加`string.Empty`部分路径也会从 URL 中删除相对目录！

**如果您遵循上述规则，您可以将 URL 与下面的代码结合起来。**根据您的情况，您可以将多个“目录”部分添加到 URL...

```
 var pathParts = new string[] { destinationBaseUrl, destinationFolderUrl, fileName };

        var destination = pathParts.Aggregate((left, right) =>
        {
            if (string.IsNullOrWhiteSpace(right))
                return left;

            return new Uri(new Uri(left), right).ToString();
        }); 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2017-11-06T12:41:07.183

一个简单的衬里：

```
public static string Combine(this string uri1, string uri2) => $"{uri1.TrimEnd('/')}/{uri2.TrimStart('/')}"; 
```

受@Matt Sharpe 回答的启发。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2019-09-19T10:17:09.823

对于任何正在寻找单线并且只想加入部分路径而不创建新方法或引用新库或构造 URI 值并将其转换为字符串的人，然后...

```
string urlToImage = String.Join("/", "websiteUrl", "folder1", "folder2", "folder3", "item"); 
```

这是非常基本的，但我看不出你还需要什么。如果你害怕加倍的'/'那么你可以简单地做一个`.Replace("//", "/")`之后。如果您害怕替换“https://”中的双引号“//”，请改为一次加入，替换双引号“/”，然后加入网站网址（但我很确定大多数浏览器会自动将前面带有“https：”的任何内容转换为以正确格式读取）。这看起来像：

```
string urlToImage = String.Join("/","websiteUrl", String.Join("/", "folder1", "folder2", "folder3", "item").Replace("//","/")); 
```

这里有很多答案可以处理上述所有问题，但就我而言，我只需要在一个位置使用它一次，并且不需要严重依赖它。此外，很容易看到这里发生了什么。

请参阅：[https ://docs.microsoft.com/en-us/dotnet/api/system.string.join?view=netframework-4.8](https://docs.microsoft.com/en-us/dotnet/api/system.string.join?view=netframework-4.8)

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2020-02-16T12:11:41.590

最近在**Energy.Core包中添加了****Combine**方法，因此您可能希望使用它来连接 URL 部分。

 **```
 string url;
    url = Energy.Base.Url.Combine("https://www.youtube.com", "watch?v=NHCgbs3TcYg");
    Console.WriteLine(url);
    url = Energy.Base.Url.Combine("https://www.youtube.com", "watch?v=NHCgbs3TcYg", "t=150");
    Console.WriteLine(url); 
```

此外，它会识别参数部分，因此它会像您预期的那样工作（用斜杠连接路径，用 & 符号连接参数）。

> [https://www.youtube.com/watch?v=NHCgbs3TcYg](https://www.youtube.com/watch?v=NHCgbs3TcYg)
> 
> [https://www.youtube.com/watch?v=NHCgbs3TcYg&t=150](https://www.youtube.com/watch?v=NHCgbs3TcYg&t=150)

[Energy.Base.Url 类的文档](https://energy-core.readthedocs.io/en/latest/base-url.html)

[NuGet 库上的包](https://www.nuget.org/packages/Energy.Core/)

[代码示例](https://dotnetfiddle.net/SxbF46)

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2021-04-02T05:23:56.640

// 阅读以上所有示例，结果创建了我自己：

```
static string UrlCombine(params string[] items)
{
    if (items?.Any() != true)
    {
        return string.Empty;
    }

    return string.Join("/", items.Where(u => !string.IsNullOrWhiteSpace(u)).Select(u => u.Trim('/', '\\')));
} 
```

// 用法

```
UrlCombine("https://microsoft.com","en-us") 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2014-02-18T15:31:39.553

采用：

```
 private Uri UriCombine(string path1, string path2, string path3 = "", string path4 = "")
    {
        string path = System.IO.Path.Combine(path1, path2.TrimStart('\\', '/'), path3.TrimStart('\\', '/'), path4.TrimStart('\\', '/'));
        string url = path.Replace('\\','/');
        return new Uri(url);
    } 
```

它的好处是表现得完全一样`Path.Combine`。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2013-04-25T10:51:01.590

我结合了所有以前的答案：

```
 public static string UrlPathCombine(string path1, string path2)
    {
        path1 = path1.TrimEnd('/') + "/";
        path2 = path2.TrimStart('/');

        return Path.Combine(path1, path2)
            .Replace(Path.DirectorySeparatorChar, Path.AltDirectorySeparatorChar);
    }

    [TestMethod]
    public void TestUrl()
    {
        const string P1 = "http://msdn.microsoft.com/slash/library//";
        Assert.AreEqual("http://msdn.microsoft.com/slash/library/site.aspx", UrlPathCombine(P1, "//site.aspx"));

        var path = UrlPathCombine("Http://MyUrl.com/", "Images/Image.jpg");

        Assert.AreEqual(
            "Http://MyUrl.com/Images/Image.jpg",
            path);
    } 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2014-05-15T23:49:12.660

好吧，我只是连接两个字符串并使用正则表达式来完成清理部分。

```
 public class UriTool
    {
        public static Uri Join(string path1, string path2)
        {
            string url = path1 + "/" + path2;
            url = Regex.Replace(url, "(?<!http:)/{2,}", "/");

            return new Uri(url);
        }
    } 
```

因此，您可以像这样使用它：

```
 string path1 = "http://someaddress.com/something/";
    string path2 = "/another/address.html";
    Uri joinedUri = UriTool.Join(path1, path2);

    // joinedUri.ToString() returns "http://someaddress.com/something/another/address.html" 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2015-12-03T23:17:16.043

我用这段代码解决了这个问题：

```
string[] brokenBaseUrl = Context.Url.TrimEnd('/').Split('/');
string[] brokenRootFolderPath = RootFolderPath.Split('/');

for (int x = 0; x < brokenRootFolderPath.Length; x++)
{
    //if url doesn't already contain member, append it to the end of the string with / in front
    if (!brokenBaseUrl.Contains(brokenRootFolderPath[x]))
    {
        if (x == 0)
        {
            RootLocationUrl = Context.Url.TrimEnd('/');
        }
        else
        {
            RootLocationUrl += String.Format("/{0}", brokenRootFolderPath[x]);
        }
    }
} 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2017-04-24T07:43:08.960

这两项工作：

```
 Uri final = new Uri(Regex.Replace(baseUrl + "/" + relativePath, "(?<!http:)/{2,}", "/")); 
```

或者

```
 Uri final =new Uri(string.Format("{0}/{1}", baseUrl.ToString().TrimEnd('/'), relativePath.ToString().TrimStart('/'))); 
```

即如果

```
baseUrl = "http://tesrurl.test.com/Int18" 
```

和

```
relativePath = "To_Folder"

output = http://tesrurl.test.com/Int18/To_Folder 
```

下面的代码会出现一些错误：

```
 // If you use the below code, some issues will be there in the final URI
 Uri final = new Uri(baseUrl, relativePath); 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2018-03-22T14:19:05.500

我们使用以下简单的辅助方法将任意数量的 URL 部分连接在一起：

```
public static string JoinUrlParts(params string[] urlParts)
{
    return string.Join("/", urlParts.Where(up => !string.IsNullOrEmpty(up)).ToList().Select(up => up.Trim('/')).ToArray());
} 
```

请注意，它不支持 '../../something/page.htm' 样式的相对 URL！

* * *

## 回答 #41

> 赞同：-2
> 
> 时间：2010-07-01T16:02:14.943

我必须指出`Path.Combine`，至少在 .NET 4 上，这似乎也可以直接起作用。

* * *

## 回答 #42

> 赞同：-2
> 
> 时间：2013-02-28T03:40:03.857

我还没有使用以下代码，但是在我的互联网旅行中发现它来解决 URL 组合问题 - 希望它是一个简洁（并且成功！）的答案：

```
VirtualPathUtility.Combine 
```

# .net - VS 2008 中的重构工具？

> ID：372867
> 
> 赞同：3
> 
> 时间：2008-12-16T21:42:57.560
> 
> 标签：.net, visual-studio, visual-studio-2008

在大学，我们有 VS 2005，它有一些重构工具，如重命名、提取方法、提取类等。

我决定从 MSDN 下载 VS 2008，它只有 Rename 和 Extract 方法，如何激活另一个？

编辑：我已经下载了 Microsoft VS 2008 C# Express Edition。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-16T21:43:29.633

你下载了快捷版吗？Express Edition 没有全部重构。在大学里，你可能有 Express 以外的版本。

## 更新：

由于您发布了您拥有 Express Edition 的信息：您无法使用您在学校拥有的 Visual Studio 中的那些重构工具。Express Edition 限制了您的功能。请参阅此图表：[此处](http://msdn.microsoft.com/en-us/vs2005/aa700921.aspx)。去你的学校检查以下载学术版本（通常提供给大学）。这样您就可以获得包含所有重构工具的完整版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T21:52:02.550

您可以安装免费版的 Refactor！来自[DevExpress](http://www.devexpress.com/)

[重构！用于 VB](http://www.devexpress.com/Products/Visual_Studio_Add-in/VBRefactor/)

[重构！对于 ASP.NET](http://www.devexpress.com/Products/Visual_Studio_Add-in/RefactorASP/)

[重构！对于 C++](http://www.devexpress.com/Products/Visual_Studio_Add-in/RefactorCPP/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T22:37:32.460

如果您通过 Uni MS Academy 访问 MSDN（我认为这就是我在 uni 时所说的），您应该可以访问 VS 2008 Pro 的完整版本（以及其他操作系统和 IDE），所以我会去为了那个原因。在圣诞节期间使用 Resharper 4.1 试用版，当您的学生贷款在 1 月份到来时，您可以购买完整许可证（应该能够获得学术许可证）。Resharper 非常有用，我在工作和家庭中使用它（与 2005 年和 2008 年相比）:-)

# bash - Get name of a variable as input and change the variable with that name

> ID：372869
> 
> 赞同：6
> 
> 时间：2008-12-16T21:43:05.063
> 
> 标签：bash

I get the name of a variable from the script user as the first argument and I echo the value of said variable back to the console:

```
#!/bin/bash
variablename=$1
echo "The value of $variablename is: " ${!variablename} 
```

This works great!

What I can't get to work is if I want to change that variable into the value of the second argument from the user. An example with a syntax error is:

```
#!/bin/bash
variablename=$1
echo "The value of $variablename is: " ${!variablename}
echo "I will now try to change the value into $2."
(!variablename}=$2
# The above line generates: {!variablename}=2: command not found 
```

In other words: If it is possible, how do I get a variable *name* from the user and both read (already solved) and write to said variable?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T21:46:22.577

I had a flash all of a sudden, minutes after asking for help, and I think I have a solution:

```
#!/bin/bash
variablename=$1
echo "The value of $variablename is: " ${!variablename}
echo "I will now try to change the value into $2."
eval "$variablename=$2"
echo "Success! $variablename now has the value ${!variablename}!" 
```

It works. Is there a better way?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T21:54:56.257

Your solution will work but the variable will only have that value within your script. It won't affect the "calling" application's variable.

When you run a script or program it spawns a new shell with a copy of the environment. This is by design so your script doesn't modify things like `PATH`.

If you want your script to be able to modify environment variables for the calling shell you need to either `source scriptname` or `. scriptname`. This is how .bashrc works.

# imagemagick - 如何在 MagickWand 中设置透明像素的背景颜色？

> ID：372872
> 
> 赞同：1
> 
> 时间：2008-12-16T21:44:57.137
> 
> 标签：imagemagick, magickwand

使用 MagickWand API 从 PNG 转换为 JPG 时，如何将透明像素的背景设置为白色？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-30T21:37:34.370

```
if(current_wand && IsMagickWand(current_wand)){
    status=MagickReadImage(current_wand, "test.png");
    if (status == MagickFalse) {
        ThrowWandException(current_wand);
    }
    PixelWand *color = NewPixelWand();
    PixelSetColor(color, "white");
    MagickSetImageBackgroundColor(current_wand, color);
    MagickWand *newwand = MagickMergeImageLayers(current_wand, FlattenLayer);
    MagickWriteImage(newwand, "test.jpg");
    DestroyMagickWand(newwand);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T01:28:11.040

使用 MagickMergeImageLayers

# asp.net - Response.Redirect 未结束执行

> ID：372877
> 
> 赞同：16
> 
> 时间：2008-12-16T21:46:23.420
> 
> 标签：asp.net, response.redirect

我有 Default.aspx 页面，它继承自 BasePage.cs，继承自 System.Web.UI.Page。BasePage 是我在每个页面加载时必须做的一些常见事情的地方。

在 BasePage 中，假设我正在检查 X。如果 X=1，那么我将立即重定向到我的“Discontinued.aspx”页面并停止执行 BasePage。如果我发现 X=1，我会说：

HttpContext.Current.Response.Redirect("Discontinued.aspx", true);

我希望重定向停止执行 BasePage 并立即跳出 - 因此上述语句中的“真” - 据我所知，这应该停止当前页面的执行。问题是，它没有。我期待重定向抛出“线程中止异常”。

当我在调试模式下运行时，它会继续单步执行，就好像它不只是重定向并离开一样。

但是重定向仍然开始 - 一旦我完成了 BasePage 的其余部分，“Discontinued”页面就会作为重定向的结果开始加载。

我的重定向不会终止 BasePage 的执行是否有原因？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-16T22:33:57.833

Response.Redirect 的第二个参数是`endResponse`，但工具提示显示“指示当前页面的执行是否应终止”。这是一种误导，因为当变量为真时，页面的执行实际上并没有终止。它将完成运行任何代码。然而，不同的是，Render 事件被取消，并且响应立即与对象移动的标题一起刷新。

您需要手动退出任何方法， Response.Redirect / Response.End 不会为您执行此操作。此外，如果您需要条件来查看页面是否已被重定向，请查看 Response.IsRequestBeingRedirected。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-16T22:05:27.750

您是否正在退出调用重定向的函数，例如

```
...redirect(stopit,true);
return; 
```

?

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-16T22:05:38.593

可能您在 try{}catch{} 块内调用 Response.Redirect 方法，通过在该块外调用来尝试它，您会发现它不会失败。更多信息： [http](http://www.velocityreviews.com/forums/t72105-responseredirect-in-a-trycatch.html) ://www.velocityreviews.com/forums/t72105-responseredirect-in-a-trycatch.html 希望这会有所帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-02-19T21:23:23.413

您可以抛出异常，该异常将退出代码执行，但仍会重定向：

```
HttpContext.Current.Response.Redirect("/login", true);
throw new Exception("Unauthorized Access"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T22:26:20.017

我要为此投反对票！诅咒我的无知...

显然，您可以尝试在重定向之后添加以下行（如递归所指出的那样），

```
response.end() 
```

但也许 response.redirect 没有立即导致重定向的原因是您有响应缓冲（默认）并且页面处理直到缓冲区被刷新后才结束。如果这是真的（诚然我也懒得尝试），那么添加以下行也可以解决您的问题。

```
response.flush() 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T22:08:02.737

对于无条件终止，您可以尝试

```
Response.End() 
```

# python - 如何在 Python 中连接到 MySQL 数据库？

> ID：372885
> 
> 赞同：1238
> 
> 时间：2008-12-16T21:49:09.687
> 
> 标签：python, mysql

如何使用 python 程序连接到 MySQL 数据库？

* * *

## 回答 #1

> 赞同：1280
> 
> 时间：2009-03-07T18:57:34.597

## 三步使用 Python 2 连接到 MYSQL

**1 - 设置**

在执行任何操作之前，您必须安装 MySQL 驱动程序。与 PHP 不同，Python 默认只安装 SQLite 驱动程序。最常用的包是[MySQLdb](http://pypi.python.org/pypi/MySQL-python/)，但很难使用 easy_install 安装它。请注意 MySQLdb 仅支持 Python 2。

对于 Windows 用户，您可以获得[MySQLdb 的 exe](http://sourceforge.net/project/showfiles.php?group_id=22307)。

对于 Linux，这是一个临时包（python-mysqldb）。（您可以在命令行中使用`sudo apt-get install python-mysqldb`（对于基于 debian 的发行版）、`yum install MySQL-python`（对于基于 rpm 的发行版）或`dnf install python-mysql`（对于现代 fedora 发行版）进行下载。）

对于 Mac，您可以[使用 Macport 安装 MySQLdb](https://stackoverflow.com/questions/1448429/how-to-install-mysqldb-python-data-access-library-to-mysql-on-mac-os-x#1448476)。

**2 - 用法**

安装后，重启。这不是强制性的，但如果出现问题，它将阻止我在这篇文章中回答 3 或 4 个其他问题。所以请重启。

然后就像使用任何其他包一样：

```
#!/usr/bin/python
import MySQLdb

db = MySQLdb.connect(host="localhost",    # your host, usually localhost
                     user="john",         # your username
                     passwd="megajonhy",  # your password
                     db="jonhydb")        # name of the data base

# you must create a Cursor object. It will let
#  you execute all the queries you need
cur = db.cursor()

# Use all the SQL you like
cur.execute("SELECT * FROM YOUR_TABLE_NAME")

# print all the first cell of all the rows
for row in cur.fetchall():
    print row[0]

db.close() 
```

当然，有上千种可能性和选择；这是一个非常基本的例子。您将不得不查看文档。[一个好的起点](http://www.mikusa.com/python-mysql-docs/)。

**3 - 更高级的用法**

一旦您知道它是如何工作的，您可能希望使用[ORM](https://en.wikipedia.org/wiki/Object-Relational_Mapping)来避免手动编写 SQL 并像操作 Python 对象一样操作您的表。Python 社区中最著名的 ORM 是[SQLAlchemy](http://www.sqlalchemy.org/)。

我强烈建议您使用它：您的生活会轻松很多。

我最近发现了 Python 世界中的另一颗宝石：[peewee](http://peewee.readthedocs.org/en/latest/index.html)。这是一个非常精简的 ORM，设置和使用非常简单快捷。对于小型项目或独立应用程序，我很高兴，因为使用 SQLAlchemy 或 Django 之类的大型工具是矫枉过正的：

```
import peewee
from peewee import *

db = MySQLDatabase('jonhydb', user='john', passwd='megajonhy')

class Book(peewee.Model):
    author = peewee.CharField()
    title = peewee.TextField()

    class Meta:
        database = db

Book.create_table()
book = Book(author="me", title='Peewee is cool')
book.save()
for book in Book.filter(author="me"):
    print book.title 
```

此示例开箱即用。除了有 peewee ( `pip install peewee`) 之外没有其他要求。

* * *

## 回答 #2

> 赞同：197
> 
> 时间：2008-12-16T21:51:56.357

这是一种使用[MySQLdb](https://pypi.org/project/MySQL-python/)的方法，它只支持 Python 2：

```
#!/usr/bin/python
import MySQLdb

# Connect
db = MySQLdb.connect(host="localhost",
                     user="appuser",
                     passwd="",
                     db="onco")

cursor = db.cursor()

# Execute SQL select statement
cursor.execute("SELECT * FROM location")

# Commit your changes if writing
# In this case, we are only reading data
# db.commit()

# Get the number of rows in the resultset
numrows = cursor.rowcount

# Get and display one row at a time
for x in range(0, numrows):
    row = cursor.fetchone()
    print row[0], "-->", row[1]

# Close the connection
db.close() 
```

[参考这里](http://it.toolbox.com/blogs/lim/connecting-to-mysql-from-python-4529)

* * *

## 回答 #3

> 赞同：136
> 
> 时间：2014-01-06T21:32:15.543

如果您不需要 MySQLdb，但会接受任何库，我会非常非常推荐 MySQL 中的 MySQL Connector/Python：http: [//dev.mysql.com/downloads/connector/python/](http://dev.mysql.com/downloads/connector/python/)。

它是一个包（大约 110k），纯 Python，因此它独立于系统，而且安装起来非常简单。您只需下载、双击、确认许可协议即可。无需Xcode、MacPorts、编译、重启……</p>

然后你像这样连接：

```
import mysql.connector    
cnx = mysql.connector.connect(user='scott', password='tiger',
                              host='127.0.0.1',
                              database='employees')

try:
   cursor = cnx.cursor()
   cursor.execute("""
      select 3 from your_table
   """)
   result = cursor.fetchall()
   print result
finally:
    cnx.close() 
```

* * *

## 回答 #4

> 赞同：127
> 
> 时间：2013-05-28T15:39:22.043

Oracle (MySQL) 现在支持纯 Python 连接器。这意味着无需安装二进制文件：它只是一个 Python 库。它被称为“连接器/Python”。

[http://dev.mysql.com/downloads/connector/python/](http://dev.mysql.com/downloads/connector/python/)

[安装后，您可以在此处](https://dev.mysql.com/doc/connector-python/en/connector-python-example-connecting.html)查看一些使用示例

* * *

## 回答 #5

> 赞同：122
> 
> 时间：2015-12-29T02:52:13.920

> 如果您想避免安装 mysql 标头只是为了从 python 访问 mysql，请停止使用 MySQLDb。

使用[pymysql](https://github.com/PyMySQL/PyMySQL)。它完成了 MySQLDb 所做的所有事情，但它纯粹是在 Python 中实现的，***没有 External Dependencies***。这使得所有操作系统上的安装过程一致且容易。 `pymysql`是 MySQLDb 的替代品，恕我直言，没有理由将 MySQLDb 用于任何事情......永远！- *`PTSD from installing MySQLDb on Mac OSX and *Nix systems`*，但那只是我。

**安装**

`pip install pymysql`

> 就是这样......你准备好玩了。

**来自 pymysql Github repo 的示例用法**

```
import pymysql.cursors
import pymysql

# Connect to the database
connection = pymysql.connect(host='localhost',
                             user='user',
                             password='passwd',
                             db='db',
                             charset='utf8mb4',
                             cursorclass=pymysql.cursors.DictCursor)

try:
    with connection.cursor() as cursor:
        # Create a new record
        sql = "INSERT INTO `users` (`email`, `password`) VALUES (%s, %s)"
        cursor.execute(sql, ('webmaster@python.org', 'very-secret'))

    # connection is not autocommit by default. So you must commit to save
    # your changes.
    connection.commit()

    with connection.cursor() as cursor:
        # Read a single record
        sql = "SELECT `id`, `password` FROM `users` WHERE `email`=%s"
        cursor.execute(sql, ('webmaster@python.org',))
        result = cursor.fetchone()
        print(result)
finally:
    connection.close() 
```

> **ALSO - 快速透明地替换现有代码中的 MySQLdb**

如果您有使用 MySQLdb 的现有代码，您可以使用以下简单过程轻松地将其替换为 pymysql：

```
# import MySQLdb << Remove this line and replace with:
import pymysql
pymysql.install_as_MySQLdb() 
```

所有后续对 MySQLdb 的引用都将透明地使用 pymysql。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-12-16T21:52:49.320

尝试使用[MySQLdb](https://pypi.org/project/MySQL-python/)。MySQLdb 仅支持 Python 2。

这里有一个如何页面：[http ://www.kitebird.com/articles/pydbapi.html](http://www.kitebird.com/articles/pydbapi.html)

* * *

从页面：

```
# server_version.py - retrieve and display database server version

import MySQLdb

conn = MySQLdb.connect (host = "localhost",
                        user = "testuser",
                        passwd = "testpass",
                        db = "test")
cursor = conn.cursor ()
cursor.execute ("SELECT VERSION()")
row = cursor.fetchone ()
print "server version:", row[0]
cursor.close ()
conn.close () 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2019-06-21T15:31:11.093

在终端中运行此命令以安装 mysql 连接器：

```
pip install mysql-connector-python 
```

并在您的 python 编辑器中运行它以连接到 MySQL：

```
import mysql.connector

mydb = mysql.connector.connect(
      host="localhost",
      user="yusername",
      passwd="password",
      database="database_name"
) 
```

执行 MySQL 命令的示例（在您的 python 编辑器中）：

```
mycursor = mydb.cursor()
mycursor.execute("CREATE TABLE customers (name VARCHAR(255), address VARCHAR(255))")    
mycursor.execute("SHOW TABLES")

mycursor.execute("INSERT INTO customers (name, address) VALUES ('John', 'Highway 21')")    
mydb.commit() # Use this command after insert, update, delete commands 
```

更多命令：[https ://www.w3schools.com/python/python_mysql_getstarted.asp](https://www.w3schools.com/python/python_mysql_getstarted.asp)

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2012-10-15T21:25:05.673

## 对于较新版本的 Python (>=3.6)

使用[mysqlclient](https://pypi.org/project/mysqlclient/)或[pymysql](https://pypi.org/project/PyMySQL/)（*推荐*）。

## 对于旧版本的 Python (<3.7, 2.4 <= Python <= 2.7)

如果您正在使用旧版本的 Python（*不幸*的是），那么您也可以尝试 -> [oursql](https://pypi.org/project/oursql/)。

**但是请注意，该项目不再维护，并且错误修复也不会被推送。**

* * *

作为 db 驱动程序，还有[oursql](http://packages.python.org/oursql/index.html "http://packages.python.org/oursql/index.html")。该链接上列出的一些原因说明了为什么我们的sql更好：

> *   oursql 具有真正的参数化，将 SQL 和数据完全分开发送到 MySQL。

*   oursql 允许将文本或二进制数据流式传输到数据库中并从数据库中流出，而不是要求将所有内容都缓存在客户端中。
*   oursql 既可以延迟插入行，也可以延迟获取行。
*   默认情况下，oursql 支持 unicode。
*   oursql 支持 python 2.4 到 2.7，在 2.6+ 上没有任何弃用警告（参见 PEP 218），并且在 2.7 上没有完全失败（参见 PEP 328）。
*   oursql 在 python 3.x 上本机运行。

### 那么如何用oursql连接mysql呢？

与 mysqldb 非常相似：

```
import oursql

db_connection = oursql.connect(host='127.0.0.1',user='foo',passwd='foobar',db='db_name')
cur=db_connection.cursor()
cur.execute("SELECT * FROM `tbl_name`")
for row in cur.fetchall():
    print row[0] 
```

文档中的[教程](http://packages.python.org/oursql/index.html "http://packages.python.org/oursql/index.html")相当不错。

当然对于 ORM SQLAlchemy 是一个不错的选择，正如其他答案中已经提到的那样。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2018-04-11T16:13:25.720

# SqlAlchemy

* * *

> SQLAlchemy 是 Python SQL 工具包和对象关系映射器，它为应用程序开发人员提供了 SQL 的全部功能和灵活性。SQLAlchemy 提供了一整套众所周知的企业级持久性模式，专为高效和高性能的数据库访问而设计，适用于简单的 Python 领域语言。

## 安装

```
pip install sqlalchemy 
```

## 原始查询

```
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, scoped_session

engine = create_engine("mysql://<user_name>:<password>@<host_name>/<db_name>")
session_obj = sessionmaker(bind=engine)
session = scoped_session(session_obj)

# insert into database
session.execute("insert into person values(2, 'random_name')")
session.flush()
session.commit() 
```

## ORM方式

```
from sqlalchemy import Column, Integer, String
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, scoped_session

Base = declarative_base()
engine = create_engine("mysql://<user_name>:<password>@<host_name>/<db_name>")
session_obj = sessionmaker(bind=engine)
session = scoped_session(session_obj)

# Bind the engine to the metadata of the Base class so that the
# declaratives can be accessed through a DBSession instance
Base.metadata.bind = engine

class Person(Base):
    __tablename__ = 'person'
    # Here we define columns for the table person
    # Notice that each column is also a normal Python instance attribute.
    id = Column(Integer, primary_key=True)
    name = Column(String(250), nullable=False)

# insert into database
person_obj = Person(id=12, name="name")
session.add(person_obj)
session.flush()
session.commit() 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2018-08-04T08:53:41.950

从 python 连接到 MySQL 的最佳方法是使用 MySQL 连接器/Python，因为它是用于 MySQL 的官方 Oracle 驱动程序，用于与 Python 一起使用，它适用于 Python 3 和 Python 2。

按照下面提到的步骤连接 MySQL

1.  使用 pip 安装连接器

    `pip install mysql-connector-python`

或者您可以从[https://dev.mysql.com/downloads/connector/python/下载安装程序](https://dev.mysql.com/downloads/connector/python/)

2.  使用`connect()`mysql连接器python的方法连接到MySQL。将所需的参数传递给`connect()`方法。即主机、用户名、密码和数据库名称。

3.  从方法返回的连接对象创建`cursor`对象`connect()`以执行 SQL 查询。

4.  工作完成后关闭连接。

**示例**：

```
import mysql.connector
 from mysql.connector import Error
 try:
     conn = mysql.connector.connect(host='hostname',
                         database='db',
                         user='root',
                         password='passcode')
     if conn.is_connected():
       cursor = conn.cursor()
       cursor.execute("select database();")
       record = cursor.fetchall()
       print ("You're connected to - ", record)
 except Error as e :
    print ("Print your error msg", e)
 finally:
    #closing database connection.
    if(conn.is_connected()):
       cursor.close()
       conn.close() 
```

参考 - [https://pynative.com/python-mysql-database-connection/](https://pynative.com/python-mysql-database-connection/)

**MySQL 连接器 Python 的重要 API**

*   对于 DML 操作 - 使用`cursor.execute()`和`cursor.executemany()`运行查询。并在此使用后将`connection.commit()`您的更改持久保存到数据库

*   获取数据 -`cursor.execute()`用于运行查询和`cursor.fetchall()`,`cursor.fetchone()`来`cursor.fetchmany(SIZE)`获取数据

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2016-06-22T14:18:47.903

尽管有上述所有答案，但如果您不想预先连接到特定数据库，例如，如果您仍想创建数据库 (!)，则可以使用`connection.select_db(database)`，如下所示。

```
import pymysql.cursors
connection = pymysql.connect(host='localhost',
                         user='mahdi',
                         password='mahdi',
                         charset='utf8mb4',
                         cursorclass=pymysql.cursors.DictCursor)
cursor = connection.cursor()
cursor.execute("CREATE DATABASE IF NOT EXISTS "+database)
connection.select_db(database)
sql_create = "CREATE TABLE IF NOT EXISTS "+tablename+(timestamp DATETIME NOT NULL PRIMARY KEY)"
cursor.execute(sql_create)
connection.commit()
cursor.close() 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2019-12-01T22:33:05.313

尽管你们中的一些人可能会将其标记为重复并且对我复制别人的答案感到不安，但我*真的*很想强调 Napik 先生的回应的一个方面。因为我错过了这个，我造成了全国性的网站停机（9分钟）。如果只有某人共享此信息，我本可以阻止它！

这是他的代码：

```
import mysql.connector    
cnx = mysql.connector.connect(user='scott', password='tiger',
                              host='127.0.0.1',
                              database='employees')
try:
   cursor = cnx.cursor()
   cursor.execute("""select 3 from your_table""")
   result = cursor.fetchall()
   print(result)
finally:
    cnx.close() 
```

这里重要的是**Try**和**finally**子句。这允许*始终*关闭与代码的游标/sqlstatement 部分中发生的情况的连接。大量活动连接会导致 DBLoadNoCPU 达到峰值，并可能导致数据库服务器崩溃。

我希望这个警告有助于节省服务器并最终节省工作！:D

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2008-12-16T22:29:06.487

[MySQLdb](http://pypi.python.org/pypi/MySQL-python/)是直接的方法。您可以通过连接执行 SQL 查询。时期。

我的首选方式（也是 pythonic）是使用强大的[SQLAlchemy](http://www.sqlalchemy.org/)代替。这是一个[查询相关](http://www.sqlalchemy.org/docs/05/sqlexpression.html)的教程，这里是一个关于SQLALchemy 的[ORM 功能](http://www.sqlalchemy.org/docs/05/ormtutorial.html)的教程。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2018-08-18T11:15:20.090

对于 Python3.6，我找到了两个驱动程序：pymysql 和 mysqlclient。我测试了它们之间的性能并得到了结果：mysqlclient更快。

下面是我的测试过程（需要安装python lib profilehooks来分析时间流逝：</p>

原始sql：`select * from FOO;`

立即在 mysql 终端中执行： `46410 rows in set (0.10 sec)`

pymysql（2.4s）：

```
from profilehooks import profile
import pymysql.cursors
import pymysql
connection = pymysql.connect(host='localhost', user='root', db='foo')
c = connection.cursor()

@profile(immediate=True)
def read_by_pymysql():
    c.execute("select * from FOO;")
    res = c.fetchall()

read_by_pymysql() 
```

这是 pymysql 配置文件： [![在此处输入图像描述](https://i.stack.imgur.com/73xiO.png)](https://i.stack.imgur.com/73xiO.png)

mysqlclient (0.4s)

```
from profilehooks import profile
import MySQLdb

connection = MySQLdb.connect(host='localhost', user='root', db='foo')
c = connection.cursor()

@profile(immediate=True)
def read_by_mysqlclient():
    c.execute("select * from FOO;")
    res = c.fetchall()

read_by_mysqlclient() 
```

这是 mysqlclient 配置文件： [![在此处输入图像描述](https://i.stack.imgur.com/Ozf0B.png)](https://i.stack.imgur.com/Ozf0B.png)

所以，似乎 mysqlclient 比 pymysql 快得多

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2015-09-21T04:31:40.703

只是对上述答案的修改。只需运行此命令即可为 python 安装 mysql

```
sudo yum install MySQL-python
sudo apt-get install MySQL-python 
```

记住！它区分大小写。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2018-01-28T14:35:33.910

mysqlclient 是最好的，因为其他人只提供对特定版本的 python 的支持

```
 pip install mysqlclient 
```

示例代码

```
 import mysql.connector
    import _mysql
    db=_mysql.connect("127.0.0.1","root","umer","sys")
    #db=_mysql.connect(host,user,password,db)
    # Example of how to insert new values:
    db.query("""INSERT INTO table1 VALUES ('01', 'myname')""")
    db.store_result()
    db.query("SELECT * FROM new1.table1 ;") 
    #new1 is scheme table1 is table mysql 
    res= db.store_result()
    for i in range(res.num_rows()):
        print(result.fetch_row()) 
```

见[https://github.com/PyMySQL/mysqlclient-python](https://github.com/PyMySQL/mysqlclient-python)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2015-06-03T12:20:16.710

还要看看[Storm](https://storm.canonical.com)。它是一个简单的 SQL 映射工具，可让您轻松编辑和创建 SQL 条目，而无需编写查询。

这是一个简单的例子：

```
from storm.locals import *

# User will be the mapped object; you have to create the table before mapping it
class User(object):
        __storm_table__ = "user" # table name
        ID = Int(primary=True) #field ID
        name= Unicode() # field name

database = create_database("mysql://root:password@localhost:3306/databaseName")
store = Store(database)

user = User()
user.name = u"Mark"

print str(user.ID) # None

store.add(user)  
store.flush() # ID is AUTO_INCREMENT

print str(user.ID) # 1 (ID)

store.commit() # commit all changes to the database 
```

查找和对象使用：

```
michael = store.find(User, User.name == u"Michael").one()
print str(user.ID) # 10 
```

用主键查找：

```
print store.get(User, 1).name #Mark 
```

有关详细信息，请参阅[教程](https://storm.canonical.com/Tutorial)。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2019-01-19T10:14:31.857

这是 Mysql 数据库连接

```
from flask import Flask, render_template, request
from flask_mysqldb import MySQL

app = Flask(__name__)

app.config['MYSQL_HOST'] = 'localhost'
app.config['MYSQL_USER'] = 'root'
app.config['MYSQL_PASSWORD'] = 'root'
app.config['MYSQL_DB'] = 'MyDB'

mysql = MySQL(app)

@app.route('/', methods=['GET', 'POST']) 
def index():
    if request.method == "POST":
        details = request.form
        cur = mysql.connection.cursor()
        cur.execute ("_Your query_")
        mysql.connection.commit()
        cur.close()
        return 'success'
    return render_template('index.html')

if __name__ == '__main__':
    app.run() 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-11-10T02:48:27.093

获取库的第一步：打开终端并执行`pip install mysql-python-connector`. 安装后进行第二步。

导入库的第二步：打开您的 python 文件并编写以下代码： `import mysql.connector`

第三步连接服务器：编写如下代码：

> conn = mysql.connector.connect(host= `you host name like localhost or 127.0.0.1`, username= `your username like root`, password = `your password`)

第三步 制作游标：制作游标让我们很容易运行查询。要使光标使用以下代码： `cursor = conn.cursor()`

执行查询：要执行查询，您可以执行以下操作： `cursor.execute(query)`

如果查询更改了表中的任何内容，则需要在执行查询后添加以下代码： `conn.commit()`

从查询中获取值：如果要从查询中获取值，则可以执行以下操作： `cursor.excecute('SELECT * FROM` table_name`') for i in cursor: print(i) #Or for i in cursor.fetchall(): print(i)`

fetchall() 方法返回一个包含许多元组的列表，这些元组逐行包含您请求的值。

关闭连接：要关闭连接，您应该使用以下代码： `conn.close()`

处理异常：要处理异常，您可以使用以下方法： `try: #Logic pass except mysql.connector.errors.Error: #Logic pass` 使用数据库：例如，您是一个帐户创建系统，您将数据存储在名为 blabla 的数据库中，您只需将数据库参数添加到连接() 方法，如

`mysql.connector.connect(database =` 数据库名称`)`

不要删除主机、用户名、密码等其他信息。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-07-14T19:04:53.723

您可以通过这种方式将您的 python 代码连接到 mysql。

```
import MySQLdb
db = MySQLdb.connect(host="localhost",
                 user="appuser",
                 passwd="",
                 db="onco")

cursor = db.cursor() 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-10-24T14:08:16.967

`PyMySQL 0.10.1`- 发布：2020 年 9 月 10 日，也支持 python3。

```
python3 -m pip install PyMySQL 
```

简单代码：

```
import pymysql

# Connect to the database
conn = pymysql.connect(host='127.0.0.1',user='root',passwd='root',db='fax')

# Create a Cursor object
cur = conn.cursor()

# Execute the query
cur.execute("SELECT * FROM fax.student")

# Read and print records
for row in cur.fetchall():
    print(row) 
```

输出：

```
(1, 'Petar', 'Petrovic', 1813, 'Njegusi')
(2, 'Donald', 'Tramp', 1946, 'New York')
(3, 'Bill', 'Gates', 1955, 'Seattle') 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-09-11T10:04:37.243

对于python 3.3

CyMySQL [https://github.com/nakagami/CyMySQL](https://github.com/nakagami/CyMySQL)

我在我的 Windows 7 上安装了 pip，只需 pip install cymysql

（你不需要 cython）快速无痛

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2017-08-21T18:18:11.227

首先安装驱动

```
pip install MySQL-python 
```

然后一个基本的代码是这样的：

```
#!/usr/bin/python
import MySQLdb

try:
    db = MySQLdb.connect(host="localhost",      # db server, can be a remote one 
                     db="mydb"                  # database
                     user="mydb",               # username
                     passwd="mydb123",          # password for this username
                     )        

    # Create a Cursor object
    cur = db.cursor()

    # Create a query string. It can contain variables
    query_string = "SELECT * FROM MY_TABLE"

    # Execute the query
    cur.execute(query_string)

    # Get all the rows present the database
    for each_row in cur.fetchall():
        print each_row

    # Close the connection
    db.close()
except Exception, e:
    print 'Error ', e 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-08-01T05:43:33.760

**首先安装驱动程序（Ubuntu）**

*   sudo apt-get 安装 python-pip

*   sudo pip install -U pip

*   sudo apt-get install python-dev libmysqlclient-dev

*   sudo apt-get 安装 MySQL-python

**MySQL数据库连接代码**

```
import MySQLdb
conn = MySQLdb.connect (host = "localhost",user = "root",passwd = "pass",db = "dbname")
cursor = conn.cursor ()
cursor.execute ("SELECT VERSION()")
row = cursor.fetchone ()
print "server version:", row[0]
cursor.close ()
conn.close () 
```

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2018-06-08T15:14:31.503

[首先，从https://dev.mysql.com/downloads/connector/python/](https://dev.mysql.com/downloads/connector/python/)安装 python-mysql 连接器

在 Python 控制台上输入：

```
pip install mysql-connector-python-rf
import mysql.connector 
```

# shell-extensions - Shell 扩展 - 虚拟文件创建

> ID：372893
> 
> 赞同：1
> 
> 时间：2008-12-16T21:51:46.997
> 
> 标签：shell-extensions, ramdisk

我想创建一个仅驻留在内存中的文件...在查看一些文档时，我看到了使用 shell 扩展作为虚拟文件的建议。我不确定这是一个可行的解决方案，但我想知道

1.  这是一个好方法（或者我应该使用 ramdisk 代替）
2.  哪里是开始阅读它的好地方

注意：这是在 Windows 平台上

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T21:56:12.497

你没有说你在哪个平台上，但我猜是 Windows。mmap() 可用吗？如果没有，我认为[BerkeleyDB](http://www.oracle.com/database/berkeley-db/index.html)已经移植到 Windows，所以你应该可以使用它。Win32 API 可能有类似于 mmap() 的东西，但我不知道。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T22:55:51.440

据我了解，您希望您的程序创建一个“文件”，该文件仅驻留在内存中，您可以将其传递给另一个外部程序（例如 Microsoft Word）。

AFAIK 这是不可能的，缺少冲压驱动器。我建议使用临时文件夹。但是，您必须想出一个策略，以便在不再需要文件时将其删除。

**补充：**不过，第二次，您可能想查看[Reparse points](http://msdn.microsoft.com/lv-lv/library/aa365503(en-us,VS.85).aspx)。我自己对它们并不熟悉，它们只适用于 NTFS 格式的磁盘，但也许它们可以为您提供您想要的东西。不过，这将是很多编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T01:57:19.700

如果您想要一个仅驻留在内存中的文件，请使用命名管道或其他东西，尽管我质疑您的方案 - 您可以提升一个级别并描述您想要做什么吗？

# sql-server - 如何定义具有可寻址成员的用户定义数据类型？

> ID：372898
> 
> 赞同：1
> 
> 时间：2008-12-16T21:52:15.000
> 
> 标签：sql-server, sql-server-2005, user-defined-types

我在 MS SQL Server 数据库中建模有一个不寻常的情况：表的主键是由 5 个外键（固定大小）组成的多段“自然”键。

我希望能够定义一个用户定义的数据类型来实现基于 CHAR(8) 原语的数据结构，从而使元素可以作为单独的字段进行寻址。

例如（在错误的伪代码中）：

```
UDT seggy
(
    seg1 char(2),
    seg2 char(1),
    seg3 char(1),
    seg4 char(2),
    seg5 char(2)
)

create table yotable
(
    pkfield seggy NOT NULL,
    etc varchar(14),   --whatever etc.
)
with pkfield as the primary key,
and also with seg1 as a foreign key to tableseg1,
and also with seg2 as a foreign key to tableseg2,
and so on 
```

然后能够做这样的事情：

```
insert into yotable (pkfield, etc) values ('abcdefgh','whatever')
select * from yotable where seg2 = 'c'
insert into yotable (seg1,seg2,seg3,seg4,seg5,etc)
    values ('ab','c','d','ef','gh', 'whatever') 
```

到目前为止，我发现的只是这篇[CodeProject 文章](http://www.codeproject.com/KB/database/UserDefDataTypes.aspx)，它还不够深入，也没有提供更多信息的链接，还有这个基本的[MSDN 链接](http://msdn.microsoft.com/en-us/library/aa933121(SQL.80).aspx)。

显然我的 google-fu 今晚很弱，非常感谢任何链接/提示！

替代标题：如何在 SQL SERVER 中模拟“覆盖”字段？

假定/首选 MS SQL SERVER 2005 或更高版本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T23:24:35.907

您可以定义具有所需结构的 CLR UDT，但是 (1) 您将无法保留外键（外键必须位于列级别，而不是列中 UDT 中的字段）， (2) 实现 CLR UDT 并非易事（至少与伪代码中的内容相比）。另外，根据您的描述，听起来它们在语义上确实是单独的列，而您正在寻找的只是方便的快捷方式；无论如何，IMO UDT 可能不是这种情况下的最佳方法。

我建议保留单独的列，但创建一个视图，该视图具有将字段连接在一起的列，或者表中的计算列执行相同操作。这将允许使用组合符号或单独符号进行搜索。然后，您可以使用 INSTEAD OF 触发器将组合列上的插入/更新分解为组件部分。

# javascript - 在 Javascript window.open() 中保持滚动位置

> ID：372907
> 
> 赞同：4
> 
> 时间：2008-12-16T21:56:23.260
> 
> 标签：javascript

使用 window.open() 打开新窗口时，如何保持父页面的滚动位置？父页面返回到页面顶部。

这是我当前的代码：

```
<a href="#" onclick="javascript: window.open('myPage.aspx');">
   Open New Window
</a> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-16T22:04:08.877

```
<a href="#" onclick="window.open('myPage.aspx');return false;">Open New Window</a> 
```

*   `javascript:`事件属性中不需要。
*   您没有从事件处理程序返回 false，因此链接正在跟踪，它相当于`<a href="#">Scroll to top</a>`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T22:11:54.943

```
<a href="javascript:void()" onclick="window.open('myPage.aspx');">Open New Window</a> 
```

应该这样做。正如其他人所提到的，# 试图转到一个不存在的锚点，这将导致浏览器滚动到顶部。您不想删除 href 属性，因为某些浏览器不会将`<a>`没有 href 属性的标签视为样式链接，并且您必须定义额外的 CSS 规则以使链接看起来像您网站上的其他链接。

另外，为什么要有一个 href 属性，然后尝试通过始终从处理程序返回 false 来阻止事件。在我看来，这种方式比这里提出的其他方式更干净。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T22:04:48.220

我认为问题在于您的链接指向一个空的 # ( `href="#"`)，浏览器会将其解释为“页面顶部”。

尝试从锚标记中删除 href 属性。onclick 属性应该足以满足您的需要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-01T06:55:38.110

最好让那些没有 javascript 或禁用它的人可以访问该页面：

```
<a href="myPage.aspx" target="_blank" onclick="window.open('myPage.aspx');return false;">Open New Window</a> 
```

target="_blank" 是在新窗口（或选项卡）中打开。如果客户端没有 JS，那么它仍然会打开页面，只是不在 JS 调用的窗口中。

# xslt - 计算 local-name() 等于 'FootNoteReference' 的先前元素

> ID：372909
> 
> 赞同：1
> 
> 时间：2008-12-16T21:57:17.143
> 
> 标签：xslt

我如何计算这样的 xml 文档中有多少先前的**FootNoteReference节点...**

```
<MyDoc>
<title>&lt;Big Title&gt;</title>
<head>Objective</head>
<head2>&lt;Heading&gt;</head2>
<head>Introduction</head>
<Para>
    asdf asdf asdf asd<FootNoteReference />asdf asdf asfd asfd 
</Para>
<head>Overview</head>
<Para>
    &lt;Begin with a definition of the class to which<FootNoteReference /> the categories belong, if required.&gt;
</Para>
<Para>&lt;List the different categories to be taught.&gt;</Para>
<Heading1>&lt;Category 1&gt;</Heading1>
<Para>&lt; som neodolal a celé ozdobené spústou prachu v jednom preso&gt;</Para>
<Para>&lt;Provide examples, if required.&gt;</Para>
<Heading1>&lt;Category 2&gt;</Heading1>
<Para>&lt; som neodolal a celé ozdobené spústou prachu v jednom preso&gt;</Para>
<Para>&lt;Provide examples, if required.&gt;</Para>
<Heading1>&lt;Category 3&gt;</Heading1>
<Para>
    &lt;Provide a description<FootNoteReference /> of the third category as outlined in the list.&gt;
</Para>
<Para>&lt;Provide examples, if required.&gt;</Para>
<head>Summary</head>
<ListItem type="ul">&lt;Summarize the definition, if applicable.&gt;</ListItem>
<ListItem type="ul">&lt; som neodolal a celé ozdobené spústou prachu v jednom preso<FootNoteReference />.&gt;</ListItem>
<ListItem type="ul">&lt; som neodolal a celé ozdobené spústou prachu v jednom preso&gt;</ListItem></MyDoc> 
```

请注意**FootNoteReference**节点是如何嵌套在不同级别的。我知道它们是否都嵌套在我可以做的同一级别：`count(preceding-sibling::*[local-name() = 'FootNoteReference'])`

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T00:03:13.223

使用[**“ `preceding`”轴**](http://www.w3.org/TR/xpath#axes)：

        **`count($vNode/preceding::FootNoteReference)`**

是`FootNoteReference`引用的节点之前的元素数`$vNode`。

如果节点是任何`FootNoteReference`元素的后代，并且您还想计算其祖先`FootNoteReference`元素，则还应考虑`FootNoteReference`元素在[**" `ancestor`" 轴上**](http://www.w3.org/TR/xpath#axes)的出现次数，这将通过以下 XPath 表达式完成：

     **`count($vNode/preceding::FootNoteReference`
             `|`
               `$vNode/ancestor::FootNoteReference)`**

# asp.net - 压缩文件并使用 SaveAs 对话框下载它们

> ID：372914
> 
> 赞同：1
> 
> 时间：2008-12-16T22:00:09.977
> 
> 标签：asp.net

我有以下代码来压缩所有文件，然后将其保存到硬盘。我想要压缩所有文件（已完成），然后将 zip 文件附加到响应流，以便用户可以选择保存它！

```
protected void DownloadSelectedFiles_Click(object sender, EventArgs e)
        {
            string path = String.Empty;
            string zipFilePath = @"C:\MyZipFile.zip";

            ZipOutputStream zipStream = new ZipOutputStream(File.Create(zipFilePath));
            byte[] buffer = new byte[4096];

            foreach (GridViewRow row in gvFiles.Rows)
            {
                bool isSelected = (row.FindControl("chkSelect") as CheckBox).Checked;

                if (isSelected)
                {
                    path = (row.FindControl("lblUrl") as Label).Text;

                    ZipEntry entry = new ZipEntry(Path.GetFileName(path));
                    entry.DateTime = DateTime.Now;

                    zipStream.PutNextEntry(entry);

                    using (FileStream fs = File.OpenRead(path))
                    {
                        int sourceBytes;
                        do
                        {
                            sourceBytes = fs.Read(buffer, 0, buffer.Length);
                            zipStream.Write(buffer, 0, sourceBytes);
                        } while (sourceBytes > 0);
                    }
                }
            }

            zipStream.Finish();
            zipStream.Close();

            Response.ContentType = "application/x-zip-compressed";
            Response.AppendHeader("Content-Disposition", "attachment; filename=SS.zip");
            Response.WriteFile(zipFilePath);
            Response.End();

        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T00:05:07.383

如果您使用的是 IE，请检查它是否不是旧的“缓存已满”——显示其丑陋面孔的错误。

而且，如果您将 IE 设置为自动或在 IE 启动时刷新 Cashe，并且第一次下载了损坏的 zip 文件，那么它可能是在您修复了您的例程并获得了之后使用该 zip 文件的缓存版本好拉链。

尝试添加：

```
 Response.Buffer = true;
  Response.Clear();
  Response.ClearContent();
  Response.ClearHeaders(); 
```

在您的 Response.ContentType 之前并添加以下内容：

```
Response.Flush()
Response.Close() 
```

在 response.end 之前，看看是否有任何改变。

所以结果是这样的：

```
Response.Buffer = true;
Response.Clear();
Response.ClearContent();
Response.ClearHeaders();
Response.ContentType = "application/x-zip-compressed";  
Response.AppendHeader("Content-Disposition", "attachment; filename=SS.zip");  
Response.WriteFile(zipFilePath);  
Response.Flush()
Response.Close()
Response.End(); 
```

只是从头脑的顶部只是一些提示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T18:10:15.077

不久前，我写了一篇关于发送这样的文件的博客。你可能会在那里找到一些有用的东西。

[http://absolutecobblers.blogspot.com/2008/02/downloading-and-deleting-temporary.html](http://absolutecobblers.blogspot.com/2008/02/downloading-and-deleting-temporary.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T00:27:32.800

远射，尝试将 mime 类型设置为 application/unknown，在这篇文章中似乎有解决海报问题的一部分：

[http://jamesewelch.com/2008/12/03/sharpziplib-and-windows-extraction-wizard-errors/](http://jamesewelch.com/2008/12/03/sharpziplib-and-windows-extraction-wizard-errors/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T16:52:29.910

我还尝试将 zip 文件保存到服务器文件夹，然后为用户提供下载链接，但它显示相同的“文件已损坏”。这很奇怪，因为如果我访问我的服务器文件夹并手动打开它，我可以打开同一个文件夹！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T19:17:43.093

这是我发现的另一件事。如果我将 zip 文件保存在服务器的文件夹中，然后使用 url 引用它：[http://localhost/MyApplication/ServerFolder/MyZipFile.zip](http://localhost/MyApplication/ServerFolder/MyZipFile.zip)。

如果我转到 url 并下载 zip 文件，我会收到相同的错误“文件已损坏”。但是，如果我使用文件资源管理器手动转到文件夹并打开文件，那么它会按预期工作。

为什么和如何？

# xml - XML 文件中的游戏逻辑

> ID：372915
> 
> 赞同：22
> 
> 时间：2008-12-16T22:00:36.760
> 
> 标签：xml

我正在处理游戏对话文件（玩家和不可玩角色之间的对话），其中对话选择及其结果取决于某些条件并导致某些动作。现在，我可以编写一个简单的解析器来处理某种语言来指定前置条件和后置条件，但是我的一个朋友建议使用 XML。条件可以存储为对话元素的属性，而选择和动作是内部元素。然后我会使用 eval 函数来解析这些条件和语句（我使用 Ruby 来制作这个游戏）。为了使这种方法更简单，我可以编写一个简单的 GUI 来操作这些文件，而不用担心丑陋的 XML。

但在我看来，处理 XML 文件中的逻辑是一个奇怪的选择。我的理解是 XML 文件是用于存储和交换数据的，而且我总是读到关于人们如何过度使用 XML 来完成各种非设计用途的咆哮。我的朋友们回应说，XML 是如何用于一切的，包括 XHTML 和[这种子弹描述语言](http://www.asahi-net.or.jp/~cs8k-cyu/bulletml/index_e.html)（这也说明了一些逻辑）。

老实说，使用 XML 会为我简化很多事情。编写解析器可能会很痛苦而且很耗时，而且我的要求通常很简单。但这真的可以吗，还是我以后会后悔这样的选择？

对于对细节感兴趣的人，以下是 XML 文件中基本对话交换的样子：

```
<dialogue id="101" condition="!npc.carsFixed">
  <message>Man, fix my car!</message>
  <choices>
    <choice condition="hero.carFixingSkill > 5" priority="7" id="Sure!">
      <command>hero.carFixingSkills += 1</command>
      <command>npc.carFixed = true</command>
      <command>hero.playSmokeAnimation()</command>
      <command>nextDialogue = 104</command>
    </choice>
    <choice condition="hero.carFixingSkill <= 5" id="I can't...">
      <command>nextDialogue = 105</command>
    </choice>
    <choice id="Fix it yourself">
      <command>npc.likesHero -= 1</command>
    </choice>
  </choices>
</dialogue> 
```

如果用 Ruby 编写，相应的代码将是：

```
def dialogue101
  if !npc.carsFixed
    showMessage("Man, fix my car!")
    choices = []
    if hero.carFixingSkill > 5
      choices.push(Choice.new("Sure!", 7)) 
    else
      choices.push(Choice.new("I can't"))
    end
    choices.push(Choice.new("Fix it yourself"))
    choices = selectTopPriority(choices) if choices.size > 4
    result = showChoices(choices)
    case result
    when "Sure"
      hero.carFixingSkills += 1
      npc.carFixed = true
      hero.playSmokeAnimation
      dialogue104
    when "I can't"
      dialogue105
    when "Fix it yourself"
      npc.likesHero -= 1
    end
  end
end 
```

likesHero 和 carFixingSkills 之类的东西是玩家和 NPC 可以拥有的知识片段，在实际实现中可能会存储在哈希中。我发现对话文件方法更灵活，因为我可以制作一个编辑器来轻松编辑对话和条件/动作，并且因为游戏对话树的复杂性。像 Ruby 或 Lua 这样的脚本语言会有所帮助，但它需要复杂的结构来处理这些树的逻辑。

回到最初的问题，XML 是适合这项工作的工具还是我错过了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T02:51:50.840

除非你的游戏只有不到六个独特的对话，否则你绝对应该把这些信息放在某种数据文件中。XML 是该格式的有力竞争者。我不会说 Ruby，所以在这种情况下它可能不起作用，但另一种选择是直接在 Ruby 代码中将对话框定义为数据。（我知道这在 Lua、Python 和 Javascript 中会很好地工作......我假设在 Ruby 中定义嵌套数据结构也很容易。）

我们使用 XML 文件来定义火海海盗中的所有静态数据，这是一个很好的方法。拥有这样的数据格式可以让非程序员控制数据，并让程序员腾出时间来处理功能而不是数据输入。将这些数据文件设为文本意味着您可以将它们置于源代码控制之下，这样您就可以知道它们何时发生变化。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-16T23:30:11.540

如果您还没有听说过 YAML，请查看它。它就像 XML，但 XML 并不是真正要由手工编写的——它是一个碰巧是人类可读的机器-机器接口（所以你真的应该为它创建一个编辑器）。YAML 是一个人机界面，可写性更高。

我不会为 DSL 烦恼，YAML 映射完美。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T22:35:37.830

DSL 将是梅赛德斯-奔驰对此的实现，并且用 Ruby 编写会很有趣。你是对的，这需要大量的工作，但如果写得好并且这款游戏真正起飞，它可能会得到回报。

如果采用 XML 路由，要考虑的一件事是您将用于呈现它的解析器/引擎。最后我检查了一下，[REXML](http://www.germane-software.com/software/rexml/)是 Rubyists 在城里唯一的节目。如果您喜欢 REXML，那么 XML 听起来是个不错的选择，但如果您还没有尝试过，我建议您在做出此决定之前先尝试一下。我不是在挑选 REXML，只是建议你小心一点，因为无论你使用什么，你都将完全依赖这个库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T23:16:07.060

因为您是用 Ruby 编写的，所以我认为用 XML 编写就足够了。这样您就可以制作一个 Web 应用程序，让您可以在任何地方处理对话和游戏逻辑。其他人可以与您合作，或者可能创建用户模组——这总是一个加分项。

只要您将 XML 文件组织得井井有条（纸上的流程图​​会有所帮助），您就不会遇到任何问题，甚至可能会感谢您自己经历了解析它的痛苦:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T23:25:02.737

要获得灵感，甚至是采用，请查看 AIML 和 BuddyScript。AIML 是用于聊天机器人的 XML，BuddyScript 是另一种变体 - 现在归微软所有。

以下是来自[http://www.alicebot.org/aiml.html的 AIML 示例](http://www.alicebot.org/aiml.html)

```
<category>
<pattern>WHAT ARE YOU</pattern>
<template>
    <think><set name="topic">Me</set></think> 
    I am the latest result in artificial intelligence,
    which can reproduce the capabilities of the human brain
    with greater speed and accuracy.
</template> 
```

如果您将 AIML 技术（我认为是免费的）集成到您的游戏中，您的 NPC 将拥有您的玩家可以与之交谈的 AI。那不是很有趣吗？

AIML 是模块化的，因此您的所有 NPC 都可以有一个通用文件来描述有关其世界的所有标准知识。然后，您可以为每个种族、班级、地点、个人或任务的典型内容添加特定文件。有很多有趣的示例 AIML 文件，例如 Eliza。

情境信息，可以在对话开始时添加，并且您可能有一些 AIML 引擎之外的软件侦听来自 NPC 的“魔术”词，表明 NPC 希望在“真实”游戏世界中发生某些事情。比如“***给玩家 20 个水牛翅膀”。

# sql - 从 LINQ 方法返回 IEnumerables 的最佳实践

> ID：372916
> 
> 赞同：0
> 
> 时间：2008-12-16T22:00:38.617
> 
> 标签：sql, linq

好的，

这个问题之前可能已经回答过，但我不知道如何用词标题。

我有一个类，它具有返回许多复合 LINQ 查询的方法。这些查询中的大多数都形成匿名类型，以获取我需要的数据。我发现我无法从方法返回匿名类型，所以我一直在创建子类并将它们填充到查询的“选择新”部分。

有没有更好的方法来做到这一点？所有这些方法都返回某种类型的 IEnumerable，我真的很想保留提取的内容。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T22:05:50.633

您可以明确地将您使用的匿名类型定义为类，而是返回这些类。

通常，如果您正在编写一个库供其他人使用，则显式定义的类是最佳实践。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T05:51:54.283

或者你可以在这篇[文章中使用](https://stackoverflow.com/questions/9033/hidden-features-of-c)[dp技术](https://stackoverflow.com/users/748/dp)

```
// Useful? probably not.
private void foo()
{
    var user = AnonCast(GetUserTuple(), new { Name = default(string), Badges = default(int) });
    Console.WriteLine("Name: {0} Badges: {1}", user.Name, user.Badges);
}

object GetUserTuple()
{
    return new { Name = "dp", Badges = 5 };
}    

// Using the magic of Type Inference...
static T AnonCast<T>(object obj, T type)
{
   return (T) obj;
} 
```

# sql - SQL Server BCP 插入附加列

> ID：372925
> 
> 赞同：2
> 
> 时间：2008-12-16T22:04:12.650
> 
> 标签：sql, sql-server, bcp

我的要求：

输入文件：

1,abc,xyx

2,def,mno

3，吉，SUV

数据库表结构：

Col1 字符

col2 字符

col3 字符

col4 字符

col5 字符

BCP后表中数据：

col1 col2 col3 col4 col5

1 abc xyz ab xy

2 def mno de mn

3 ghi suv gh su

基本上 col4 和 col5 是从 col2 和 col3 值计算的值。

SQL Server BCP 实用程序是否支持此类操作？任何指针将不胜感激。

干杯GT

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-29T08:19:50.500

您可以使用格式文件来指定哪个数据字段映射到哪个列

使用 bcp 导入时可以使用格式文件：

为您的表创建一个格式文件：

```
 bcp [table_name] format nul -f [format_file_name.fmt] -c -T 
```

这将创建一个像这样的文件：

```
 9.0
5
1       SQLCHAR       0       100     ","      1     Col1             SQL_Latin1_General_CP1_CI_AS
2       SQLCHAR       0       100     ","      2     Col2             SQL_Latin1_General_CP1_CI_AS
3       SQLCHAR       0       100     ","      3     Col3           SQL_Latin1_General_CP1_CI_AS
4       SQLCHAR       0       100     ","      3     Col4           SQL_Latin1_General_CP1_CI_AS
5       SQLCHAR       0       100     ","      3     Col5           SQL_Latin1_General_CP1_CI_AS 
```

编辑导入文件。诀窍是删除不需要的列（本例中的字段 4 和 5）并更新列数：这是格式文件中的第二行。在本例中，将 5 更改为 3。然后使用此格式文件导入数据，指定您的输入文件、此格式文件和分隔符：

```
bcp [table_name] in [data_file_name] -t , -f [format_file_name.fmt] -T 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T03:02:17.713

您可以 BCP 进入一个临时表，然后以适当的结构从临时表插入到另一个表。

您还可以`BULK INSERT`在 SQL 中使用与外部 BCP 命令相同的格式文件和源文件，以便您可以在 SQL 中运行整个批处理：`BULK INSERT`匹配输入的表，然后是`INSERT INTO`最终表。

另一个预处理选项，如 Perl（或任何其他命令行工具）是 PowerShell 在使用 BCP（可能使用 XML 选项）之前通过管道传输数据：[http ://www.sqlservercentral.com/articles/powershell/ 65196/](http://www.sqlservercentral.com/articles/powershell/65196/)

我的首选选项可能是 SSIS，它为您提供了整个转换库，包括派生列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T22:11:48.627

不，您不能使用 BCP 执行此操作，尽管您可以使用 BCP 从查询中提取数据集并转储到文件中。

如果您想在不使用源查询的情况下执行此操作，则必须将 bcp 输出到文件，使用 perl 脚本或类似脚本对文件进行后处理以生成计算列，然后将文件重新导入目标带有适当格式的 BCP 控制文件。

**编辑：** BCP 相当简单。如果您不能使用客户端工具，您可以插入临时表，然后在存储过程中计算派生值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T03:18:18.790

SQL Server 集成服务和转换将是我选择的方法。它是一个非常简单的包来构建所需的转换——而且 SSIS 非常快，易于安排等。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-07-03T08:43:23.163

如果您不怕编程一点，您可以使用 ADO.NET 来完成。通过实现自定义 IDataReader，可以轻松完成此操作以及您希望即时进行的任何其他转换。SqlBulkCopy 采用 IDataReader 并批量插入它提供的数据。然后，您的读者可以使用输入文件并提供其他列、转换数据、查找键值等等。

# wpf - 使控件“透明”以单击事件

> ID：372928
> 
> 赞同：8
> 
> 时间：2008-12-16T22:04:33.587
> 
> 标签：wpf, events, listbox

我有一个 ListBox 显示一些项目，在某些模式下，我在它的顶部“加盖”了一种水印。我已经使用包含不透明度为 0.5 的 TextBlock 的边框来完成此操作。这一切都很好。

但是，我仍然希望用户能够单击 ListBox 中的项目，但是如果我单击“stamp”，它显然会吃掉单击事件，并且 ListBox 看不到它们。

我该怎么做才能防止这种情况发生？（即允许 ListBox 看到 Click 事件）

谢谢，

克雷格

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-16T22:14:00.913

您可以使用[IsHitTestVisible](http://msdn.microsoft.com/en-us/library/system.windows.uielement.ishittestvisible.aspx)属性执行此操作：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ListBox>
        <ListBoxItem>a</ListBoxItem>
        <ListBoxItem>b</ListBoxItem>
        <ListBoxItem>c</ListBoxItem>
    </ListBox>
    <Border Opacity="0.2" Background="Cyan" BorderBrush="Black" BorderThickness="5" IsHitTestVisible="False" >
        <TextBlock Text="EXAMPLE" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
    </Border>
</Grid> 
```

# security - 通过在查询中附加没有空格的输入，我是否容易受到 SQL 注入的攻击？

> ID：372933
> 
> 赞同：3
> 
> 时间：2008-12-16T22:05:54.957
> 
> 标签：security, sql-injection

我从用户输入中获取一个字符串，并将其在空格上（使用 \w）拆分为一个字符串数组。然后我循环遍历数组，并像这样附加 where 子句的一部分：

```
 query += " AND ( "

                 + "field1 LIKE '%" + searchStrings[i] +"%' "
                 + " OR field2 LIKE '%" + searchStrings[i] +"%' "
                 + " OR field3 LIKE '%" + searchStrings[i] +"%' "
                 + ") "; 
```

我觉得这很危险，因为我将用户输入附加到我的查询中。但是，我知道任何搜索字符串中都没有任何空格，因为我将初始输入拆分为空格。

是否可以通过 SQL 注入来攻击它？给予`Robert');DROP TABLE students;--`实际上不会丢弃任何东西，因为那里需要有空格。在该示例中，它不会正常运行，但不会造成任何损坏。

任何有更多对抗 SQL 注入经验的人都可以帮助我解决这个问题，或者让我放心吗？

谢谢！

**编辑：**

哇，这是很多很棒的输入。感谢所有回复的人。我将研究全文搜索，并至少参数化我的查询。

**只是为了让我能更好地理解这个问题，如果所有空格和**单引号都被转义了，是否可以注入？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-16T22:16:48.240

每当您允许用户将数据输入到这样的查询字符串中时，您都容易受到 SQL 注入的攻击，应该像瘟疫一样避免它！

您应该非常小心如何允许您的 searchStrings[] 数组被填充。您应该始终使用参数对象将变量数据附加到查询中：

```
+ field1 like @PropertyVal Or field2 like @PropertyVal Or field3 like @PropertyVal etc... 
```

例如，如果您使用的是 SQL Server

```
Query.Parameters.Add(new SqlParameter("PropertyVal", '%' + searchStrings[i] + '%')); 
```

要非常小心如何构建要针对生产服务器运行的查询字符串，尤其是如果其中包含任何重要数据！

在您的示例中，您提到了 Little Bobby Tables

Robert');DROP TABLE 学生;--

并指出因为它需要空格，所以你不能这样做 - 但是如果恶意用户使用这样的东西对其进行编码：

```
Robert');Exec(Replace('Drop_Table_students','_',Char(32)));-- 
```

我会说 - 最好是安全并以正确的方式做。没有简单的方法可以确保您捕捉到所有场景，否则......

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-16T22:17:39.083

是的，这个脚本不包含任何空格，只是 SQL 解码并执行的编码字符： [http ://www.f-secure.com/weblog/archives/00001427.html](http://www.f-secure.com/weblog/archives/00001427.html)

注入的脚本是这样的：

> DECLARE％20 @ S％20NVARCHAR（4000）; SET％20 @ S = CAST（0x440045004300 4C00410052004500200040005400200076006100720063006800610072 00280032003500350029002C0040004300200076006100720063006800 610072002800320035003500290020004400450043004C004100520045 0020005400610062006C0065005F0043007500720073006F0072002000 43005500520053004F005200200046004F0052002000730065006C0065 0063007400200061002E006E0061006D0065002C0062002E006E006100 6D0065002000660072006F006D0020007300790073006F0062006A0065 00630074007300200061002C0073007900730063006F006C0075006D00 6E00730020006200200077006800650072006500200061002E00690064 003D0062002E0069006400200061006E006400200061002E0078007400 7900700065003D00270075002700200061006E0064002000280062002E 00780074007900700065003D003900390020006F007200200062002E00 780074007900700065003D003300350020006 ... </ P>

将 SQL 解码为：

> DECLARE @T varchar(255)'@C varchar(255) DECLARE Table_Cursor
> CURSOR FOR select a.name'b.name from sysobjects a'syscolumns b where a.id=b.id and a.xtype='u' and ( b.xtype=99 或 b.xtype=35 或 b...</p>

依此类推，因此可以在不使用任何空格的情况下对数据库中的每个表执行任何操作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-16T22:13:54.317

弄错的方法太多了，如果有人告诉我“不，这将是安全的，因为……”，我不会依赖。

以某种形式（URL-Encode 或 somethign）转义空格怎么样。使用简单测试不检查的非显而易见的 Unicode 空白字符怎么样。如果您的数据库支持一些不需要空格的恶意操作怎么办？

做正确的方法：使用 PreparedStatement（或您的平台用于注入安全参数化的任何内容），将“%”附加并添加到用户输入并将其用作参数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T22:20:11.433

经验法则是：如果您要附加的字符串不是 SQL，则**必须**使用准备好的语句或 DB 客户端库中的正确“转义”函数对其进行转义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-16T22:25:42.250

我完全同意查询参数是绝对安全的方法。有了它们，您就没有任何 SQL 注入的风险（除非您对参数做了一些愚蠢的事情），并且没有转义的开销。

如果您的 DBMS 不支持查询参数，那么它必须支持字符串转义。在最坏的情况下，您可以尝试自己转义单引号，尽管仍有一个 Unicode 漏洞可以规避这一点。但是，如果您的 DBMS 不支持查询参数，它可能也不支持 Unicode。:)

**补充：**还有。像你写的查询是性能杀手 - 不能使用索引。我建议查看您的 DBMS 的全文索引功能。它们完全适用于此类情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-16T22:14:57.810

是的，他们仍然可以注入项目，没有空格它可能不会做太多，但它仍然是一个漏洞。

一般来说，盲目地将用户输入添加到查询中并不是一个好主意。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-16T22:19:48.703

这是一个简单的注入，如果我将 field1 设置为此我已经列出了数据库中的所有行。这可能不利于安全...

```
'+field1+' 
```

您应该使用参数（这些在内联 SQL 中也有效），例如

```
AND Field1 = @Field1 
```

# sql - 如何加入 SQL 中的“固定向量”？

> ID：372934
> 
> 赞同：0
> 
> 时间：2008-12-16T22:06:33.660
> 
> 标签：sql, ms-access

“固定向量”是指一个静态值列表，例如 1 到 24。

当前查询看起来像这样（简化）

```
SELECT Period, Profit FROM Projections 
```

但是数据是“稀疏的”——所以不是每个时期都有一行。

什么查询每次都会给我一行 1-24 的行，在没有数据的地方用零（或 NULL）？

我想只用查询来做到这一点，以避免客户端代码混乱。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T22:18:40.140

为什么不创建一个 'Periods' 查找表，其值为 1 - 24（以及任何其他可能相关的列，如期间的描述或其名称），然后在 Periods 查找表和您的预测之间进行左外连接桌子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T22:23:57.603

您可以创建一个名为 udfRange(start int,count int) 或类似名称的 udf，然后左连接到函数的输出。

或者对于一些非常快速和肮脏的事情，你可以加入一个看起来像的子选择

```
SELECT DATA.Period, P.Profit
FROM (
SELECT 1 AS Period
UNION SELECT 2
...
UNION SELECT 24) AS DATA 
LEFT JOIN Projections P ON DATA.Period = P.Period 
```

# wcf - 使用 Windows 服务通过 WCF 处理 MSMQ 消息

> ID：372935
> 
> 赞同：2
> 
> 时间：2008-12-16T22:06:40.133
> 
> 标签：wcf, msmq, msmq-wcf

我们有一个解决方案，我们使用 Windows 服务来挑选消息。

Windows 服务每 2 分钟触发一次，并检索 MSMQ 消息以将其传递给 Web 服务。

1.  我可以创建一个 WCF 服务，它会自动从 MSMQ 队列中提取消息吗？
2.  如果 WCF 服务支持自动调用，我可以避免使用 Windows 服务吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T02:29:52.957

Q1：你可以自动从 MSMQ 中获取消息，你需要查看 netmsmqbinding，但是有一些设计考虑你必须考虑，如果你习惯了原生 MSMQ，你知道你有能力偷看消息。但是，当您使用 WCF 时，您就失去了窥视的能力。WCF 将拦截 MSMQ 中的消息，您负责保持 WCF 服务和窥视应用程序同步。您还需要查看是否需要事务性队列或非事务性队列，并且必须基于此修改绑定。

Q2：您需要将 WCF 服务托管在 windows 服务或 IIS7 中。如果您在 IIS7 中托管，请查看启用 MSMQ WAS 侦听器

这是一篇不错的文章：http: [//blogs.msdn.com/tomholl/archive/2008/07/12/msmq-wcf-and-iis-getting-them-to-play-nice-part-1.aspx](http://blogs.msdn.com/tomholl/archive/2008/07/12/msmq-wcf-and-iis-getting-them-to-play-nice-part-1.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T19:27:10.210

将消息从 MSMQ 传输到 Web 服务调用的一种方法是使用支持相同协定的 netMsmqBinding 服务端点和 basicHttpBinding 客户端端点。netMsmq 服务将自动从队列中抓取消息并将它们反序列化为一个对象。在您的 netMsmq 服务实现中，只需实例化您的 basicHttp 客户端代理并调用相同的方法。基本上是从 Web 服务到 MSMQ 的传递或代理模式，反之亦然。在 Juval Lowy 的“Programming WCF”中，他称这种模式为队列的“HTTP Bridge”。

# sql-server - SQL Server 内存使用量大是否会导致错误？

> ID：372937
> 
> 赞同：2
> 
> 时间：2008-12-16T22:07:09.417
> 
> 标签：sql-server, sql-server-2005, memory

刚开始在我们的 C# .Net 应用程序上遇到一堆错误，这些错误似乎是无缘无故发生的。SqlDataReader 对象上的 System.IndexOutOfRangeException 之类的东西应该返回并且现在已经返回了一段时间。

无论如何，我查看了任务管理器，发现 sqlservr.exe 以大约 1,500,000 K 的内存使用量运行。我绝不是 DBA，但在配备 Intel Xeon 3.33Ghz 和 4GB ram 的 Win Server 2003 R2 Enterprise 上，大量使用内存对我来说是错误的。所以我重新启动了 SQL Server 实例。重启后，一切恢复正常。错误突然停止发生。**那么这么大的主内存使用最终会导致错误吗？**

此外，我对[高内存使用率进行了快速谷歌 mssql](http://www.google.com/search?q=high+memory+usage+mssql)。我发现如果保留默认设置；SQL Server 可以增长到那么大。此外，还找到了关于[如何通过使用 SQL Server 中的配置选项调整内存使用情况的](http://support.microsoft.com/default.aspx?scid=kb;en-us;321363)MS 链接。

现在的问题是...... **SQL Server 应该限制在多少主内存？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T23:19:02.343

如果它是数据库本身，我当然会感到*非常*惊讶，SQLServer 是一个非常可靠的产品 - 比 Office 或 Windows 本身的任何产品都要好，并且通常可以绝对和完全依赖。

1.5Gb对于 rdbms 来说不算*什么*——而且所有这些都将继续用缓存的数据填充它们的可用缓冲区。内核中的读取通常比磁盘访问快 1000 倍或更多，因此使用可用的每一块内存是最佳设计。事实上，如果您查看任何 RDBMS 设计理论，您会发现用于决定从核心中丢弃什么的算法非常重要，因为它对性能产生重大影响。

大多数专用数据库服务器将运行 4Gb 内存（假设为 32 位），其中 90% 专用于 SQL Server，因此您当然不会在这里看到任何类型的边缘条件。

到目前为止，您最可能的问题是编码错误或结构问题（例如锁定）

不过，我确实有一个警告。非常（非常非常 - 就像 10 年内两次）偶尔我看到 SQL Server 由于其数据库文件损坏而返回页面撕裂错误，这两次都是由潜在的间歇性硬件故障引起的。幸运的是，这两种情况都在保存索引的页面中，通过删除索引、修复数据库、备份和恢复到新磁盘，我能够在不回退到备份的情况下恢复。我不确定页面撕裂错误将如何传递给 C# API，但可以想象，如果您有一个磁盘错误，它仅在核心已满后才表现出来（即它位于某个交换空间的某个位置），那么索引越界错误确实看起来像我期望的那种表现形式，因为调用可能会返回垃圾 - 因此超出了数组范围。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T22:12:53.960

关于设置什么限制，有很多不同的因素可以发挥作用。通常，您希望以某种方式限制它，以防止它耗尽系统上过多的内存。

如果该框是专用的 SQL 框，则将其设置为使用框上 90% 左右的 RAM 并不少见。...

但是，如果是有其他用途的共享盒子，可能还有其他考虑。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T22:23:20.913

> MSSQL 应该限制在多少主内存？

尽你所能，同时确保其他系统服务能够正常运行。是的，这是一个模糊的答案，但是在专用的 DB 盒上，MSSQL 会对 90% 左右的 RAM 感到非常满意。按照设计，它将尽可能多地占用 RAM。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T23:49:08.133

1.5GB 和 4.0GB 几乎不费力……我们的一台服务器通常运行在 1.6GB 和 2.5GB 上，没有任何问题。我想如果它不使用那么多，我会更担心。

我并不是说听起来很苛刻，但我不会这么快就将应用程序错误归咎于 SQL Server。根据我的经验，每次我试图将责任推卸给 SQL Server 时，都会让我很头疼。通常是系统管理员或恶意查询使我们的服务器瘫痪。

有好几次运行缓慢的查询的解决方案是重新启动服务器而不是检查查询，这几乎总是有问题的。我知道我个人重写了大约十几个查询，其成本远高于 100。

这听起来确实像是“'选择'被破坏”的情况，所以我很好奇您是否可以在代码中找到任何改进。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T22:47:40.380

SQL 需要它占用的内存。如果它使用 1.5 gig，则将其用于数据缓存、过程缓存等。通常最好不要管它——如果你将上限设置得太低，最终会损害性能。如果它在 4 gig 网络盒子上使用 1.5 gigs，我根本不会称之为异常。

您的错误很可能是由锁定引起的 - 我很难说您在问题中定义的 SQL 内存使用导致了您遇到的错误。

# c# - LINQ、迭代器、选择和投影

> ID：372945
> 
> 赞同：7
> 
> 时间：2008-12-16T22:12:04.583
> 
> 标签：c#, linq

我想做的是在维护迭代器的同时使用 LINQ 的优雅......

本质上

```
Class A
{
  int Position;
  string Name;
} 
```

如果我有一个字符串列表，我想将它们投影到`List<A>`但在投影中填充位置...

```
List<string> names; //filled with strings 
```

就像是

```
List<A> foo = (from s in names select s).ToList(); 
```

但让它也迭代并填充位置..

这可能吗？

```
{{Position:0,Name: "name1"},{Position:1, Name: "name2"}, {Position:2, Name: "name3"}....} 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-16T22:17:39.130

你可以这样做：

```
 var listOfStrings = new List<string> {"name1", "name2", "name3", "name4"};
    var foo = listOfStrings.Select((value, position) => new {position, value}).ToList(); 
```

位置将作为从 0 开始的索引递增，请检查[Select Method](http://msdn.microsoft.com/en-us/library/bb534869.aspx)重载。

# asp.net-mvc - 在 ASP.NET MVC 应用程序中为 json 输出过滤域对象的最佳方法

> ID：372955
> 
> 赞同：8
> 
> 时间：2008-12-16T22:14:09.293
> 
> 标签：asp.net-mvc, json

如果我在 asp.net mvc 中呈现常规视图，那么在我的页面中显示的唯一域对象属性就是我专门写出的那些。例如：

```
<div><%= Customer.FirstName %></div> 
```

但是，如果我为 json 序列化域对象，它将包含每个属性。例子：

```
public JsonResult Customer (int? id)
{
    Customer customer = _serviceLayer.GetCustomer (id.Value);

    return Json (customer);
} 
```

由于我不希望每个 Customer 属性都暴露出来，在这种情况下过滤 json 的输出属性的最佳方法是什么？您可以使用像 UpdateModel() 这样的包含/排除列表吗？使用公共类 JsonCustomer 等代理类？你会推荐什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-16T22:20:06.410

我为此使用匿名类型：

```
var customer = from c in serviceLayer.GetCustomers()
               where c.Id == id.Value
               select new { FirstName = c.FirstName }; 
```

这不仅仅是一个好主意。相反，如果您的对象图包含循环引用，它可以防止您在调用 Json() 时遇到异常。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-10-08T06:38:32.380

您可以使用 [ScriptIgnore] 属性（在 System.Web.Extensions 中）。有关示例，请参见[http://www.creave.dk/post/2009/10/07/Excluding-properties-from-being-serialized-in-ASPNET-MVC-JsonResult.aspx 。](http://www.creave.dk/post/2009/10/07/Excluding-properties-from-being-serialized-in-ASPNET-MVC-JsonResult.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-01T03:35:03.577

请使用视图模型。视图模型是 UI 用来在屏幕上表示域对象的对象。每个屏幕都有自己的视图模型。

当您制作视图模型时，它是一个 DTO，它是域对象的扁平化、空安全投影，不要映射您不希望在屏幕上显示的属性。

序列化视图模型，而不是您的域对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T00:31:53.820

您可以使用[Newtonsoft](http://james.newtonking.com/pages/json-net.aspx)库和 [JsonIgnore] 属性来标记您不想公开的类的属性。还有其他库（可能具有不同的属性忽略属性名称），我个人更喜欢这个，因为它在 JSON 转换器扩展等方面非常灵活 + 它可以轻松序列化匿名对象。

```
public class Customer
{
    ...
    [JsonIgnore]
    public string UrlIn { get; set; }
    public string FirstName { get; set; }
    // following example of a converter, you could write your own as well
    [JsonConverter(typeof(Newtonsoft.Json.Converters.JavaScriptDateTimeConverter))]
    public DateTime Created { get { return _created; } }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-17T17:43:48.427

我遇到了同样的问题，解决方案之一是

使用 [ScriptIgnore] 属性 .. 它会解决问题。

添加 system.web.extensions 引用并添加命名空间：

使用 System.Web.Script.Serialization。

如果您仍有疑问..请继续阅读..了解详细说明..

我有一个用户类..

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using Iesi.Collections.Generic;
using System.Runtime.Serialization;

namespace RAPortal.Core.Entities

{
 public class User {
  private int _userId;
  private string _firstName;
  private string _lastName;
  private IList < Application > _applications;
  private IList < Group > _groups;
  private IList < ApplicationRequest > _applicationRequests; 
```

....特性..

```
 public virtual int UserId {
  get { return _userId; }
  set { _userId = value; }
 }
 public virtual string Title {
  get { return _title; }
  set {
   _title = !String.IsNullOrEmpty(value) ? value.ToUpper().Trim() : null;
  }
 }
 public virtual IList < Group > Groups {
  get { return _groups; }
  set { _groups = value; }
 }
 public virtual IList < UserPrivilege > UserPrivileges
 {
  get { return _userPrivileges; }
  set { _userPrivileges = value; }
 }
 public virtual IList < UserRole > UserRoles {
  get { return _userRoles; }
  set { _userRoles = value;}
 } 
```

...很快...

我有小组课..

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Script.Serialization;
using System.Runtime.Serialization;

namespace RAPortal.Core.Entities {
 public class Group {
  private int _groupId;
  private string _name;
  private IList < User > _users;
  public virtual int GroupId {
   get { return _groupId; }
   set { _groupId = value; }
  }
  public virtual string Name {
   get { return _name; }
   set {
    _name = !String.IsNullOrEmpty(value) ? value.ToUpper().Trim() : null;
   }
  }
  [ScriptIgnore]

  public virtual IList < User > Users {
   get { return _users; }
   set { _users = value; }
  }
 }
} 
```

由于用户在组中被引用.. json 认为它是循环引用并且它会抛出异常..所以修复是在用户之上添加 [ScriptIgnore]。并像它一样将引用和命名空间添加到此类..

它解决了我的问题..我相信那里有更好的方法！干杯...

请记住，您应该只在组类中添加 [scriptIgnore] 而不是在用户类中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-02T18:21:51.087

根据我的经验，JavaScriptSerializer 也尊重一些 XmlSerialization 属性，例如 XmlIgnore。

# sql-server - 表格上的全文搜索

> ID：372958
> 
> 赞同：-1
> 
> 时间：2008-12-16T22:14:54.470
> 
> 标签：sql-server, full-text-search

如何在 SQL Server 2005 中的表上启用和执行“全文”搜索？

我不太了解解决方案：[如何在多个表中使用全文搜索，SQL Server 2005](https://stackoverflow.com/questions/206142/how-do-i-use-full-text-search-accross-multiple-tables-mssql-2005)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T22:17:37.647

我认为这个[视频教程](http://www.venexus.com/Support/Tutorials/SQLServerFullTextIndexing.aspx)应该让你在其中取得很大的进步。

您必须先设置索引，然后才能对其进行搜索。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T22:18:27.520

[将全文搜索与 SQL Server 结合起来有多难？](https://stackoverflow.com/questions/202440/how-hard-is-it-to-incorporate-full-text-search-with-sql-server#202474)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-11-30T18:53:00.273

您还可以查看[http://msdn.microsoft.com/en-us/library/ms142583.aspx](http://msdn.microsoft.com/en-us/library/ms142583.aspx)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-11-03T10:08:50.027

开始[设置 SQL Server 2005 全文搜索](http://www.forta.com/blog/index.cfm/2007/1/4/Setting-Up-SQL-Server-2005-FullText-Searching)。

然后概述您可以使用的功能：

[http://forta.com/blog/index.cfm/2007/1/4/Performing-SQL-Server-CONTAINS-Searches](http://forta.com/blog/index.cfm/2007/1/4/Performing-SQL-Server-CONTAINS-Searches)

[http://forta.com/blog/index.cfm/2007/1/4/Performing-SQL-Server-FREETEXT-Searches](http://forta.com/blog/index.cfm/2007/1/4/Performing-SQL-Server-FREETEXT-Searches)

[http://www.forta.com/blog/index.cfm/2007/1/5/Ranking-SQL-Server-2005-FullText-Search-Results](http://www.forta.com/blog/index.cfm/2007/1/5/Ranking-SQL-Server-2005-FullText-Search-Results)

# php - PHP/CURL/其他 - 资源密集程度如何？

> ID：372960
> 
> 赞同：0
> 
> 时间：2008-12-16T22:15:10.537
> 
> 标签：php, resources, curl, curl-multi

我将有一个将在 FreeBSD 服务器上运行的守护程序，它将每分钟与 URI 列表交换少量数据。

我正在考虑使用 curl_multi 函数一次或分组运行它们，每分钟使用一个帖子。不过，我对其他想法持开放态度。

稍后我将不得不做一些基准测试，但现在，有谁知道使用 curl 制作许多小帖子需要多少资源？

有没有一种不那么密集的方法来做到这一点？也许是肥皂？一开始，每分钟只会有几个，但它可能会快速增长。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T22:21:17.717

我会说 SOAP 处理（生成查询、发送查询、处理它然后得到答复）可能比 POST 甚至“多线程”更耗费资源。无论如何，分析或基准测试可能是唯一确定的方法。

# mysql - MySQL：在聚合函数中使用别名字段

> ID：372961
> 
> 赞同：4
> 
> 时间：2008-12-16T22:16:25.887
> 
> 标签：mysql, alias, aggregate-functions

我有一个类似这样的 SQL 语句：

```
SELECT COUNT(*) AS foo, SUM(foo) AS foo_sum FROM bar 
```

但是 MySQL 不允许这样做，因为 foo 是一个别名。有谁知道如何在 SQL 中实现这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-16T22:27:23.290

不，您不能在选择列表或 WHERE 子句中使用别名。您只能在 GROUP BY、HAVING 或 ORDER BY 中使用别名。

您还可以使用在子查询中定义的别名：

```
SELECT foo, SUM(foo) AS foo_sum
FROM (
  SELECT COUNT(*) AS foo
  FROM bar
); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T22:22:45.763

```
SELECT SUM(foo) as foo_sum
FROM 
(
    SELECT COUNT(*) AS foo
    FROM bar
    GROUP BY baz
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-16T13:27:22.103

我认为这不是一个好主意。如果要进行大查询，最好不使用子查询。`COUNT(*)`如果需要，请使用不带别名的更大功能。

我用别名和子查询进行了查询。花了大约一个小时！然后我复制了没有别名的查询。它下降到大约45分钟。在这种情况下忘记子查询。它不那么难而且更漂亮，但它会使您的查询变慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-24T11:04:46.217

我不知道您要做什么，但是使用上述解决方案，您在别名表上运行子查询效率不高。

```
SELECT foo 
FROM (SELECT COUNT(*) AS foo FROM employees) AS T; 
```

基本上 T 是您的别名表，它返回带有 count 的 foo 列，这是单条记录，并且没有使用 SUM(foo) 函数的意义，因为它是单条记录。

无论如何简单的答案：

```
SELECT Count(1) AS foo from employees; 
```

由于 COUNT 函数将返回相同的结果，无论您包含哪些 NOT NULL 字段作为 COUNT 函数参数（即：在括号内），您可以使用 COUNT(1) 来获得更好的性能。现在数据库引擎将不必获取任何数据字段，而只需检索整数值 1。

# .net - WinForms：如何以编程方式触发事件处理程序？

> ID：372974
> 
> 赞同：19
> 
> 时间：2008-12-16T22:19:24.710
> 
> 标签：.net, winforms, events

我想以编程方式调用控件的事件处理程序。例如：

```
DateTimePicker dtpLastConsummated; 
```

我想触发 TextChanged 的​​事件处理程序，我该`dtpLastConsummated`怎么做？

在其他语言中，我会称其为：

```
dtpLastConsummated.TextChanged(this, new EventArgs()); 
```

但在 .NET 中，您可以拥有多个事件处理程序：

```
dtpLastConsummated.Click +=new EventHandler(dtpLastConsummated_TextChanged);
dtpLastConsummated.Click +=new EventHandler(dtpLastConsummated_AnotherHandler);
dtpLastConsummated.Click +=new EventHandler(dtpLastConsummated_MoreHandlers);
...
dtpLastConsummated.Click +=new EventHandler(dtpLastConsummated_Nminus1); 
```

所以你需要一种方法来触发所有附加的事件处理程序。

* * *

## 回答

以下代码将触发该事件：

```
Toolkit.FireEvent(dtpLastConsummated, "TextChanged", new EventArgs()); 
```

这是静态工具包函数的代码：

```
/// <summary>
/// Programatically fire an event handler of an object
/// </summary>
/// <param name="targetObject"></param>
/// <param name="eventName"></param>
/// <param name="e"></param>
public static void FireEvent(Object targetObject, string eventName, EventArgs e)
{
   /*
    * By convention event handlers are internally called by a protected
    * method called OnEventName
    * e.g.
    *     public event TextChanged
    * is triggered by
    *     protected void OnTextChanged
    * 
    * If the object didn't create an OnXxxx protected method,
    * then you're screwed. But your alternative was over override
    * the method and call it - so you'd be screwed the other way too.
    */

   //Event thrower method name //e.g. OnTextChanged
   String methodName = "On" + eventName;

   MethodInfo mi = targetObject.GetType().GetMethod(
         methodName, 
         BindingFlags.Instance | BindingFlags.NonPublic);

   if (mi == null)
      throw new ArgumentException("Cannot find event thrower named "+methodName);

   mi.Invoke(targetObject, new object[] { e });
} 
```

* * *

**注意：**我不会为 .NET 框架中的每个控件和每个第 3 方控件创建一个子类，并说服企业级的开发人员改造每个表单以使用我的自定义控件。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-17T14:53:38.650

触发 TextChanged 事件的 3 条建议：

手动更改文本：

```
 string s = dateTimePicker1.Text;
        dateTimePicker1.Text = String.Empty;
        dateTimePicker1.Text = s; 
```

或者

从 DateTimePicker 继承并创建一个公开/调用 DateTimePicker 的受保护 OnTextChanged 的​​新方法

```
public class MyDateTimePicker : DateTimePicker
{
    public void OnTextChanged(EventArgs e)
    {
        base.OnTextChanged(e);
    }
} 
```

或者

如果你不喜欢 OOP 并且想打破封装，你可以通过反射访问受保护的 OnTextChanged 方法：

```
 MethodInfo onTextChanged = dateTimePicker1.GetType().GetMethod("OnTextChanged", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance);
        onTextChanged.Invoke(dateTimePicker1, new object[] { new EventArgs() }); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-16T22:25:05.277

Windows 窗体中的 Button 是一种特殊情况，因为它有一个[PerformClick](http://msdn.microsoft.com/en-us/library/system.windows.forms.button.performclick.aspx)方法来完全执行您所说的操作。但是，对于其他控件中的其他事件，实际上并没有什么相似之处。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-17T03:25:50.210

您可以从该类继承并创建一个调用受保护的 OnSomeEvent() 方法的新方法。

```
class MyButton : Button
{
    public void CauseClick()
    {
        this.OnClick();
    }
} 
```

正如马特指出的那样，您可以在这个特定示例中使用 PerformClick()。但是，大多数事件没有相应的公共函数来触发它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-28T10:57:30.880

**以下代码帮助我触发事件**

```
ddlTopic_SelectedIndexChanged(this, new EventArgs()); 
```

**实际事件**

```
private void ddlTopic_SelectedIndexChanged(object sender, EventArgs e)
{
   // do something
} 
```

# c - 您是否使用 TR 24731 的“安全”功能？

> ID：372980
> 
> 赞同：82
> 
> 时间：2008-12-16T22:21:00.200
> 
> 标签：c, security, coding-style, tr24731

ISO C 委员会 ( [ISO/IEC JTC1/SC21/WG14](http://www.open-std.org/JTC1/SC22/WG14/) ) 已发布[TR 24731-1](http://www.open-std.org/JTC1/SC22/WG14/www/projects#24731-1)并正在研究[TR 24731-2](http://www.open-std.org/JTC1/SC22/WG14/www/projects#24731-1)：

> ### TR 24731-1：C 库扩展第一部分：边界检查接口
> 
> WG14 正在研究更安全的 C 库函数的 TR。此 TR 旨在修改现有程序，通常通过添加带有缓冲区长度的额外参数。最新的草案在文件 N1225 中。文件 N1173 中有一个基本原理。这将成为技术报告类型 2。
> 
> ### TR 24731-2：C 库的扩展 - 第 II 部分：动态分配函数
> 
> WG14 正在研究更安全的 C 库函数的 TR。此 TR 面向使用动态分配而不是缓冲区长度的额外参数的新程序。最新草案在文件 N1337 中。这将成为技术报告类型 2。

## 问题

*   您是否使用支持 TR24731-1 功能的库或编译器？
*   如果是这样，哪个编译器或库以及在哪个平台上？
*   您是否因为修复代码以使用这些功能而发现任何错误？
*   哪些功能提供最大价值？
*   有没有提供没有价值或负价值的东西？
*   您打算将来使用图书馆吗？
*   您是否在跟踪 TR24731-2 的工作？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-12-16T22:59:57.390

自这些 TR 成立以来（当时它还是一个 TR），我一直是他们的直言不讳的批评者，并且永远不会在我的任何软件中使用它们。它们掩盖症状而不是解决原因，我认为如果有的话，它们将对软件设计产生负面影响，因为它们提供了一种错误的安全感，而不是促进可以更有效地实现相同目标的现有实践。我并不孤单，事实上，在开发这些 TR 的委员会之外，我不知道有哪个主要支持者。

我使用 glibc，因此我知道我将不必处理这种废话，正如 glibc 的首席维护者 Ulrich Drepper[关于这个话题所说的](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1106.txt)那样：

> 提议的 safe(r) ISO C 库未能完全解决问题。... 提议让程序员的生活更加艰难并没有帮助。但这正是所提议的。...他们都需要做更多的工作，或者只是很傻。

他继续详细说明了一些建议功能的问题，并在其他地方表示 glibc 永远不会支持这一点。

奥斯汀集团（负责维护 POSIX）对 TR 进行了非常严格的审查，他们的评论和委员会的回应可[在此处](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1118.htm)获得。Austin Group 的评论很好地详细说明了 TR 的许多问题，所以我不会在这里详细介绍。

所以底线是：我不使用支持或将支持这一点的实现，我不打算使用这些功能，而且我认为 TR 没有积极价值。我个人认为，TR 仍然以任何形式存在的唯一原因是因为它受到了微软的大力推动，尽管受到广泛反对，微软最近证明了它非常有能力通过标准委员会来解决问题。如果这些功能被标准化，我认为它们不会被广泛使用，因为该提案已经存在了几年并且未能获得任何真正的社区支持。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-12-17T07:43:09.330

### 直接回答问题

我喜欢罗伯特的回答，但我对我提出的问题也有一些看法。

*   您是否使用支持 TR24731-1 功能的库或编译器？

    > 不，我没有。

*   如果是这样，哪个编译器或库以及在哪个平台上？

    > 我相信这些功能是由 MS Visual Studio（例如 MS VC++ 2008 版）提供的，并且有警告鼓励您使用它们。

*   您是否因为修复代码以使用这些功能而发现任何错误？

    > 还没有。而且我不希望在我的代码中发现很多。我使用的其他一些代码 - 也许。但我还没有被说服。

*   哪些功能提供最大价值？

    > 我喜欢 printf_s() 系列函数不接受 ' `%n`' 格式说明符的事实。

*   有没有提供没有价值或负价值的东西？

    > 和函数`tmpfile_s()`令人`tmpnam_s()`非常失望。他们确实需要更像`mkstemp()`是创建文件并打开文件以确保不存在 TOCTOU（检查时间，使用时间）漏洞。就目前而言，这两个提供的价值很小。
    > 
    > 我也认为这`strerrorlen_s()`提供的价值很小。

*   您打算将来使用图书馆吗？

    > 我对此有两种看法。我开始在一个库上工作，该库将在标准 C 库上实现 TR 24731 的功能，但被证明它工作正常所需的大量单元测试所困扰。我不确定是否继续这样做。我有一些代码想移植到 Windows（主要是出于在所有平台上提供支持的不正当愿望——它已经在 Unix 衍生产品上工作了几十年）。不幸的是，为了让它在没有来自 MSVC 编译器的警告的情况下编译，我必须在代码中添加一些东西，以防止 MSVC 使用完全可靠（小心使用时）标准 C 库函数对我胡说八道。这并不开胃。我不得不处理在此期间发展起来的系统的大部分价值，这已经够糟糕的了。不得不处理某人的有趣想法（让人们在不需要时采用 TR 24731）很烦人。这也是我开始开发库的部分原因——允许我在 Unix 和 Windows 上使用相同的接口。但我不确定我会从这里做什么。

*   您是否在跟踪 TR24731-2 的工作？

    > 直到我在收集问题数据时访问标准站点时，我才开始跟踪它。和函数可能很有价值`asprintf()`；`vasprintf()`我会用那些。我不确定内存流 I/O 功能。在`strdup()`C 级别进行标准化将是向前迈出的一大步。这对我来说似乎比第 1 部分（边界检查）接口更具争议性。

总的来说，我不相信第 1 部分“边界检查接口”。第 2 部分“动态分配函数”的草稿中的材料更好。

如果由我决定，我会沿着第 1 部分的路线移动，但我还修改了 C99 标准 C 库中返回 a`char *`到字符串开头的接口（例如`strcpy()`and `strcat()`），而不是返回一个指向开始的指针，它们将返回一个指向新字符串末尾的空字节的指针。这将使一些常见的习惯用法（例如重复将字符串连接到另一个字符串的末尾）更有效，因为它可以避免重复使用的代码表现出的二次行为变得微不足道`strcat()`。替换都将确保输出字符串的空终止，就像 TR24731 版本一样。我并不完全反对检查接口的想法，也不反对异常处理功能。这是一项棘手的业务。

* * *

### 微软的实现与标准规范不一样

^(*更新 (2011-05-08)*)

另请参阅此[问题](https://stackoverflow.com/questions/2169016/mac-solution-for-safe-alternatives-to-unsafe-c-c-standard-library-functions)。可悲的是，对于 TR24731 函数的有用性而言，这是致命的，Microsoft 实现和标准之间的某些函数的定义不同，使它们无用（对我来说）。我的回答引用了`vsnprintf_s()`。

> 例如，TR 24731-1 说接口`vsnprintf_s()`是：
> 
> ```
> #define __STDC_WANT_LIB_EXT1__ 1
> #include <stdarg.h>
> #include <stdio.h>
> int vsnprintf_s(char * restrict s, rsize_t n,
>                 const char * restrict format, va_list arg); 
> ```
> 
> 不幸的是，[MSDN](http://msdn.microsoft.com/en-us/library/d3xd30zz%28VS.80%29.aspx)说接口`vsnprintf_s()`是：
> 
> ```
> int vsnprintf_s(
>    char *buffer,
>    size_t sizeOfBuffer,
>    size_t count,
>    const char *format,
>    va_list argptr 
> ); 
> ```
> 
> 参数
> 
> *   缓冲区 - 输出的存储位置。
> *   sizeOfBuffer - 输出缓冲区的大小。
> *   count - 要写入的最大字符数（不包括终止的 null），或 _TRUNCATE。
> *   格式 - 格式规范。
> *   argptr - 指向参数列表的指针。
> 
> 请注意，这不仅仅是类型映射的问题：固定参数的数量是不同的，因此是不可调和的。我也不清楚（可能也是标准委员会）同时拥有“sizeOfBuffer”和“count”有什么好处；它看起来像两次相同的信息（或者，至少，代码通常会为两个参数写入相同的值）。

`scanf_s()`同样，与它的亲属 也有问题。[微软](http://msdn.microsoft.com/en-us/library/w40768et.aspx)表示缓冲区长度参数的类型是`unsigned`（明确说明'大小参数是类型`unsigned`，而不是`size_t`'）。相比之下，在附件 K 中，size 参数的类型是`rsize_t`，它是`size_t`(`rsize_t`的另一个名称`size_t`，但`RSIZE_MAX`小于`SIZE_MAX`) 的受限变体。因此，再次，对于 Microsoft C 和标准 C，代码调用`scanf_s()`必须以不同的方式编写。

最初，我打算使用“安全”函数作为让一些代码在 Windows 和 Unix 上干净编译的一种方式，而无需编写条件代码。由于 Microsoft 和 ISO 的功能并不总是相同，因此失败了，因此几乎是时候放弃了。

* * *

### 微软`vsnprintf()`在 Visual Studio 2015中的变化

在 Visual Studio 2015 文档中[`vsnprintf()`](https://msdn.microsoft.com/en-us/library/1kt27hek.aspx)，它指出界面已更改：

> 从 Visual Studio 2015 和 Windows 10 中的 UCRT 开始，`vsnprintf`不再与`_vsnprintf`. `vsnprintf`功能符合C99标准；`_vnsprintf`为向后兼容而保留。

但是，微软的界面[`vsnprintf_s()`](https://msdn.microsoft.com/en-us/library/d3xd30zz.aspx)并没有改变。

* * *

### Microsoft 和 Annex K 之间差异的其他示例

的 C11 标准变体`localtime_s()`在 ISO/IEC 9899:2011 附件 K.3.8.2.4 中定义为：

```
struct tm *localtime_s(const time_t * restrict timer,
                       struct tm * restrict result); 
```

与[`localtime_s()`](https://msdn.microsoft.com/en-us/library/a442x3ye.aspx)定义为的 MSDN 变体相比：

```
errno_t localtime_s(struct tm* _tm, const time_t *time); 
```

POSIX 变体[`localtime_r()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/localtime_r.html)定义为：

```
struct tm *localtime_r(const time_t *restrict timer,
                       struct tm *restrict result); 
```

除了名称之外，C11 标准和 POSIX 函数是等价的。Microsoft 函数在接口上有所不同，尽管它与 C11 标准同名。

另一个不同的例子是[Microsoft](https://msdn.microsoft.com/en-us/library/ftsafwz3.aspx)`strtok_s()`和 Annex K 的`strtok_s()`：

```
char *strtok_s(char *strToken, const char *strDelimit, char **context); 
```

与：

```
char *strtok_s(char * restrict s1, rsize_t * restrict s1max, const char * restrict s2, char ** restrict ptr); 
```

请注意，Microsoft 变体有 3 个参数，而 Annex K 变体有 4 个。这意味着 Microsoft 的参数列表`strtok_s()`与 POSIX 兼容[`strtok_r()`](http://pubs.opengroup.org/onlinepubs/9699919799/functions/strtok_r.html)——因此，如果您更改函数名称（例如通过宏），对这些参数的调用实际上是可互换的——但是标准 C（附件 K）版本与两者都不同，带有额外的参数。

[Mac 和 Linux 上的](https://stackoverflow.com/questions/39560773/different-declarations-of-qsort-r-on-mac-and-linux/39561369#39561369)[不同声明的`qsort_r()`](https://stackoverflow.com/questions/39560773/different-declarations-of-qsort-r-on-mac-and-linux/39561369#39561369)问题有一个答案，该答案也讨论`qsort_s()`了 Microsoft`qsort_s()`定义的和 TR24731-1 定义的 - 再次，接口是不同的。

* * *

### *ISO/IEC 9899:2011 — C11 标准*

C11 标准（[2010 年 12 月草案](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1548.pdf)；您可以一次从 ANSI 网上商店以 30 美元的价格获得最终标准[ISO/IEC 9899:2011](http://webstore.ansi.org/RecordDetail.aspx?sku=INCITS/ISO/IEC%209899-2012)的 PDF 副本）确实具有 TR24731-1 功能作为可选功能标准的一部分。它们在附件 K（边界检查接口）中定义，它是“规范性的”而不是“信息性的”，但它是可选的。

C11 标准中没有 TR24731-2 函数——这很可悲，因为该`vasprintf()`函数及其相关函数可能真的很有用。

快速总结：

*   C11 包含 TR24731-1
*   C11 不含 TR24731-2
*   C18 与 TR24731 中的 C11 相同。

* * *

### 从 C11 的继任者中删除附件 K 的提案

[Deduplicator在对另一个问题的](https://stackoverflow.com/users/3204551/deduplicator)[评论](https://stackoverflow.com/questions/906599/why-cant-i-use-fopen/907549?noredirect=1#comment55009555_907549)中指出，在ISO C 标准委员会（ISO/IEC JTC1/SC22/WG14）之前有一个提案

*   N1967[附件 K 现场经验 — 边界检查接口](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1967.htm)

它包含对附件 K 函数的一些现有实现的引用——它们都没有被广泛使用（但如果您有兴趣，可以通过文档找到它们）。

该文件以建议结尾：

*因此，我们建议附录 K 要么从 C 标准的下一个修订版中删除，要么弃用然后删除。*

我支持该建议。

C18 标准并没有改变 Annex K 的状态。有一篇论文[N2336](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2336.pdf)主张对 Annex K 进行一些更改，修复其缺陷而不是完全删除它。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-06-27T21:42:19.043

好的，现在是*TR24731-2*的支架：

是的，自从我在 glibc 中看到它们以来，我就一直在使用`asprintf()`/ ，是的，我是它们的坚定拥护者。`vasprintf()`

为什么？
因为它们一次又一次地准确地提供了我需要的东西：一种强大、灵活、安全且（相对）易于使用的方法，可以将任何文本格式化为新分配的字符串。

我也非常赞成这些`memstream`功能：像`asprintf()`，`open_memstream()`（不是`fmemopen()`!!!）为您分配足够大的缓冲区并为您提供`FILE*`打印功能，因此您的打印功能可能完全不知道它们是否打印成字符串或文件，您可以简单地忘记您需要多少空间。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-15T16:10:05.173

> 您是否使用支持 TR24731-1 功能的库或编译器？如果是这样，哪个编译器或库以及在哪个平台上？

是的，Visual Studio 2005 和 2008（显然是用于 Win32 开发）。

> 您是否因为修复代码以使用这些功能而发现任何错误？

有点.... 我编写了自己的安全函数库（我们经常使用的只有大约 15 个），可以在多个平台上使用——Linux、Windows、VxWorks、INtime、RTX 和 uItron。创建安全函数的原因是：

*   由于不正确地使用标准 C 函数，我们遇到了大量的错误。
*   我对传入或从 TR 函数返回的信息不满意，或者在某些情况下，对它们的 POSIX 替代方案不满意。

一旦编写了函数，就会发现更多的错误。所以是的，使用这些功能是有价值的。

> 哪些功能提供最大价值？

更安全的 vsnprintf、strncpy、strncat 版本。

> 有没有提供没有价值或负价值的东西？

fopen_s 和类似的功能对我个人来说几乎没有什么价值。如果 fopen 返回 NULL，我很好。您应该始终检查函数的返回值。如果有人忽略了 fopen 的返回值，是什么让他们检查 fopen_s 的返回值？我知道 fopen_s 将返回更具体的错误信息，这在某些情况下可能很有用。但是对于我正在做的事情，这并不重要。

> 您打算将来使用图书馆吗？

我们现在正在使用它——在我们自己的“安全”库中。

> 您是否在跟踪 TR24731-2 的工作？

不。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-02-11T19:02:13.660

不，这些函数绝对没用，除了鼓励编写代码以使其只能在 Windows 上编译之外，没有任何其他用途。

snprintf 是完全安全的（如果正确实施），所以 snprintf_s 毫无意义。如果缓冲区溢出， strcat_s 将*销毁数据*（通过清除连接到的字符串）。还有许多其他完全不了解事物如何运作的例子。

真正有用的函数是 BSD strlcpy 和 strlcat。但微软和 Drepper 都出于自私的原因拒绝了这些，这让世界各地的 C 程序员很恼火。

# javascript - 在Javascript中将x倒计时到0？

> ID：372982
> 
> 赞同：0
> 
> 时间：2008-12-16T22:21:13.163
> 
> 标签：javascript

我从后端获得了 00:12:54 格式的时间，并将其显示在屏幕上。但是，我想有这个时间继续下去。我不得不在 javascript 中创建一个变量，该变量将旧时间并`setTimeout`循环以使用 document.getElementById 显示新值。我认为如果我有很多时间同时下去，那可能会出现问题。我可能需要一个数组？

你会怎么做？如果我没有其他建议，我会尝试我的方式，但我很想知道它是否有更安全的方式来做到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T22:22:28.713

你知道 jQuery 框架吗？它是一个 Javascript 框架，具有许多实用方法和函数，可让您更轻松地执行 Javascript 工作。

这是一个[倒计时插件](http://keith-wood.name/countdown.html)（尚未测试）。

我建议你[下载 JQuery](http://docs.jquery.com/Downloading_jQuery)而不是[下载插件](http://keith-wood.name/countdown.html)。检查网站上“相对”选项卡中的代码示例。你可以有类似的东西：

```
 $('#until2d4h').countdown({until: '+12M +54S'}); 
```

*我建议您的唯一缺点是您需要添加 2 个 .js。仅在需要时尝试添加它们，您会找到的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T22:29:02.290

通用算法：

1.  从服务器读取时间。
2.  读取当前时间。
3.  调用一个函数。
4.  在您的函数中，读取当前时间，从您在步骤 2 中读取的初始时间获取增量。
5.  从您在步骤 1 中从服务器读取的初始时间减去增量并显示余数。
6.  `window.setTimeout`如果要继续倒计时，该函数应在 1000 毫秒内调用自身（或根据函数内经过的时间进行调整）。

这是一个粗略的剪辑：

```
window.onload = function () {
    var countdown_start_in_ms = 6000; // from server

    function tick() {
        var now = new Date().getTime();
        var disp = start - now;

        if (disp < 0) {
            disp = 0;
        }

        var el = document.getElementById("countdown");

        el.innerHTML =
            // quick hack to format time
            /(\d\d:\d\d:\d\d) ...$/.exec(new Date(disp).toUTCString())[1];

        if (disp > 1000) {
            var elapsed = new Date().getTime() - now;
            window.setTimeout(tick, 1000 - elapsed);
        } else {
            // stop countdown and set color to light grey
            el.style.color = "#ccc";
        }
    }

    var start = new Date().getTime() + countdown_start_in_ms;
    tick();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T22:28:54.287

你不会喜欢这个的味道，但它会对你有好处：

谷歌搜索“ [javascript timer](http://www.google.com/search?q=javascript+timer) ”，并通过该搜索返回的各种示例和教程让您的双手脏兮兮的。

您将学到的不仅仅是如何编写倒数计时器。:-)

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T01:24:38.253

看看[Grab hands and set your own time。](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx/demos/clock.html)并检查其代码。虽然它是用 Dojo 编写的，但“时钟”部分是用纯 JavaScript 编写的。在您的情况下，唯一的区别是如何推进计数器 - 减少而不是增加它。

# database-design - 在 2 列上创建索引和在每列上分别创建索引有什么区别？

> ID：372988
> 
> 赞同：4
> 
> 时间：2008-12-16T22:23:11.067
> 
> 标签：database-design, indexing

我是数据库索引的新手，如果表中有 2 列是索引的好选择，例如，

```
[Posts](    
   [PostID] [int] IDENTITY(1,1) NOT NULL,
   [UserName] [nvarchar](64) NOT NULL,
   [ApplicationType] [smallint] NOT NULL,
   ...
) 
```

在这种情况下 PostID 将是 PRIMARY KEY CLUSTERED 索引，然后我想做更多的索引，因为它是一个大表，我想在 UserName 和 ApplicationType 上做，现在我应该单独索引每个（一个在 UserName 上，一个在 ApplicationType 上）或将它们作为一个整体索引（用户名、应用程序类型上的一个索引）？在成为不好的做法之前，我可以拥有的索引数量是否有限制？这方面的经验法则是什么？

谢谢，

射线。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T22:36:06.550

请记住复合索引的电话簿规则：电话簿有效地按姓氏、名字进行索引。这是一个复合索引。

如果您搜索名为“Smith, John”的人，那么名字是索引的一部分会很有帮助。找到姓氏为“Smith”的条目后，您可以快速找到“John”。

但是，如果您需要搜索*每个*名为“John”的人，那么电话簿的索引就没有帮助——您无论如何都必须搜索整本书。

因此，如果您在索引中命名的第一列以及可选的第二列等上进行搜索，那么复合索引非常有用。但是如果您的搜索跳过了索引中最左边的列，那么该搜索就没有用了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T22:33:08.193

这个问题的答案实际上取决于您将如何在桌子上进行搜索。如果您的搜索几乎总是包含这两列，那么在这两列上创建索引是合适的。如果您将经常单独搜索每个字段，那么为每个字段创建单独的索引是合适的。最后，您可以拥有所有 3 个索引（一个复合索引，2 个单列） - 取决于您如何使用这些列进行搜索。把它想象成电话簿——如果你总是用姓氏和名字搜索，你会找到你要找的东西。但是，如果您想在电话簿中搜索名字为 Scott 的每个人，您会需要一个不是 (LName, FName) 的新索引。如果您想找到具有给定姓氏的每个人，

每个数据库对每个表的索引数、每个索引的列数等都有自己的限制。它们通常足够高，如果您在这里查看 3 个索引，则不必担心它们。另外，请记住，您拥有的索引越多，维护它们的成本就越高（插入、更新、删除等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T22:33:55.757

IIRC，经验法则是索引只能用于从某个点和左侧使用所有列的查找。例如，如果您查询 (a)、(a,b)、(a,b,c) 或 (a,b,c,d)，则可以使用列 (a,b,c,d) 上的索引但不是在 (a,c) 例如。

这是索引构建方式的结果；最左边的列被索引，然后为该列的每个值创建下一列的索引，依此类推。

* * *

编辑：正如 BQ 指出的那样，DBMS 可以扫描`a`索引的完整 ' ' 部分并查找 ' `b`' 部分（我不知道这是实际完成的）。但是，这不如可以使用上述规则的索引快（OTOH，它可能比全表扫描更快）。

就个人而言，我认为不应该故意利用这一点。如果性能对于您正在考虑需要哪些索引的给定查询足以引起关注，那么您不妨给它正确的索引。

# compact-framework - .NET CF 2.0：可能的单线程重入

> ID：372990
> 
> 赞同：0
> 
> 时间：2008-12-16T22:23:40.660
> 
> 标签：compact-framework, .net-2.0, reentrancy

一个简单的应用程序是用 CF 2.0 编写的。就我而言，它是单线程的。

该应用程序的两个部分很有趣：一个事件处理程序处理由代表 PDA 的条形码扫描仪（由制造商提供）的类引发的“条形码扫描”事件，以及一个每 30 秒运行一次的 Windows.Forms.Timer 事件处理程序。

最近，该应用程序遇到了一个错误，正如我所见，唯一可能的原因是在 Timer_Tick 事件中间处理 Barcode Scanned 事件。我绝对确定这是不可能的，并且其中一个事件将在队列中等待，直到第一个事件被完全处理。MSDN 中的 Windows.Forms.Timer 页面还确保它是一个常规的单线程计时器。由 Barcode Scanned 触发的代码会更改界面的某些部分，不会导致异常，因此我假设它也是单线程的。不，我们没有使用 DoEvents 等。

任何人都可以肯定地告诉我，这种重入是不可能的，我应该更加努力地寻找其他可能的原因，反之亦然，他们遇到了同样的问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T02:07:57.400

Windows.Forms 计时器将通过调用 PostMessage 在 UI 线程上发生。那是一种保证。“条形码扫描”如何进入完全取决于为您提供事件的库的开发人员。您当然**不**应该假设它将在与您的计时器相同的上下文中运行，除非您特别强制它（通过调用 Control.Invoke）。即使这样，我也不相信您可以保证呼叫订单。

如果您认为重入可能是一个原因，则解决方案相对简单 - 在两个处理程序（计时器进程和事件）中使用 Monitor 并锁定同一个对象。这将排除这是一个可重入问题的可能性。如果问题消失了，您就知道原因并且已经有了解决办法。如果问题仍然存在，那么您可以确定这不是可重入，您可以将注意力集中在其他地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T20:33:59.957

我使用过的几乎每个条形码扫描组件都运行在后台线程上，所以我会更仔细地研究一下。******