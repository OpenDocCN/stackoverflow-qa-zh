# StackOverflow 问答 000690000-000690999

# reporting-services - Reporting Services RangeBar Chart X 轴仅标注日期时间值的时间部分

> ID：690005
> 
> 赞同：1
> 
> 时间：2009-03-27T14:32:27.763
> 
> 标签：reporting-services, ssrs-2008

我在 Visual Studio 2008 中有一个商业智能项目。我添加了一个报表并在其中放置了一个 RangeBar 图表。数据集如下：

```
dbName         dbStartTime             dbEndTime               
-------------- ----------------------- ----------------------- 
Unit2-Room2    2009-02-01 09:00:00.000 2009-02-01 13:30:00.000 
Unit2-Room1    2009-02-01 09:00:00.000 2009-02-01 13:00:00.000 
Unit1-Room2    2009-02-01 17:00:00.000 2009-02-01 19:30:00.000 
Unit1-Room2    2009-02-01 10:00:00.000 2009-02-01 15:00:00.000 
Unit1-Room2    2009-02-01 10:00:00.000 2009-02-01 15:00:00.000 
Unit1-Room2    2009-02-01 10:00:00.000 2009-02-01 15:00:00.000 
Unit1-Room1    2009-02-01 14:00:00.000 2009-02-01 16:30:00.000 
Unit1-Room1    2009-02-01 14:00:00.000 2009-02-01 16:30:00.000 
Unit1-Room1    2009-02-01 09:00:00.000 2009-02-01 13:00:00.000 
Unit1-Room1    2009-02-01 09:00:00.000 2009-02-01 13:00:00.000 
```

dbName 是类别字段，MIN(dbStart) 和 MAX(dbEnd) 字段是该系列的高/低值。这些值总是只有一天。

如何获取 X_Axis 中的标签以仅显示值的时间部分？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T17:20:07.377

啊哈！

1.  右键单击 X_Axis 区域并从上下文菜单中选择“轴属性...”。
2.  单击左侧列表中的“数字”。
3.  在类别列表框中选择“自定义”。
4.  在自定义格式文本框中键入 hh:mm（上午/下午）或 HH:mm（24 小时）。
5.  单击确定。

# c - wait((int *)0) 的含义

> ID：690015
> 
> 赞同：7
> 
> 时间：2009-03-27T14:35:26.760
> 
> 标签：c, pipe, fork

一个使用这样的等待功能的程序是这样的：

```
#include<stdio.h> 
#include<stdlib.h> 
int main() 
{ 
    int pid,fd[2]; int n; char line[20];        
    if(pipe(fd)<0) { 
        printf("Error creating pipe"); 
    } else { 
        pid=fork(); 
        if(pid<0) { 
            printf("Error while forking"); 
        } else { 
            if(pid>0) { 
                close(fd[0]); 
                write(fd[1],"Hello\n",6); 
                while(wait((int *)0)!=pid);
            } else { 
                close(fd[1]); 
                n=read(fd[0],line,20); 
                if(n<0) 
                printf("Error reading a file"); 
                write(1,line,n); 
            } 
        } 
    } 
    return 0; 
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T14:38:51.087

见[man wait(2)](http://linux.die.net/man/2/wait)。

`wait((int *)0)`来电`waitpid(-1, (int *)0, 0)`。手册页指出：

> 如果 status 不为 NULL，wait() 和 waitpid() 将状态信息存储在它指向的 int 中。

这里，`status`是 NULL (0)。因此，您的调用`wait`等待任何子进程中的状态更改，并且不返回状态。`pid`该调用仅检查特定子进程（在您的情况下）是否发生状态更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T14:44:58.500

stager的答案是正确的。尽管应该注意强制转换是完全没有必要的，因为根据标准，指针上下文中使用的 0 是 NULL 指针。

# .net - 在.NET中将复杂的布尔条件从字符串转换为布尔

> ID：690017
> 
> 赞同：5
> 
> 时间：2009-03-27T14:36:05.900
> 
> 标签：.net, string, parsing, boolean

我需要将复杂的表达式从字符串解析为布尔值。

它只能包含：
* 布尔值（true/false）、
* 括号、
* AND/OR 操作数（&&、||）

例如：

```
bool.Parse("((true || false) && (false || false)) || (true || false)" 
```

知道如何实现这一目标吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T14:42:03.467

这是一个巧妙的评估器类，它在 C# 代码中为您提供 JScript.NET Eval 函数：

```
static public class Evaluator
{
    private const string _jscriptSource =
        @"package Evaluator
        {
           class Evaluator
           {
              public function Eval(expr : String) : String 
              { 
                 return eval(expr); 
              }
           }
        }";

    static private object _evaluator;
    static private Type _evaluatorType;

    [SuppressMessage("Microsoft.Performance", "CA1810:InitializeReferenceTypeStaticFieldsInline",
        Justification = "Can't be done inline - too complex")]
    static Evaluator()
    {
        InstantiateInternalEvaluator();
    }

    static private void InstantiateInternalEvaluator()
    {
        JScriptCodeProvider compiler = new JScriptCodeProvider();

        CompilerParameters parameters;
        parameters = new CompilerParameters();
        parameters.GenerateInMemory = true;

        CompilerResults results;
        results = compiler.CompileAssemblyFromSource(parameters, _jscriptSource);

        Assembly assembly = results.CompiledAssembly;
        _evaluatorType = assembly.GetType("Evaluator.Evaluator");

        _evaluator = Activator.CreateInstance(_evaluatorType);
    }

    static public int EvaluateToInteger(string statement)
    {
        string s = EvaluateToString(statement);
        return int.Parse(s);
    }

    static public double EvaluateToDouble(string statement)
    {
        string s = EvaluateToString(statement);
        return double.Parse(s);
    }

    static public decimal ForceEvaluateToDecimal(string statement)
    {
        decimal result;
        bool s = Decimal.TryParse(statement, out result);
        return result;
    }

    static public decimal EvaluateToDecimal(string statement)
    {
        string s = EvaluateToString(statement);
        return decimal.Parse(s);
    }

    static public string EvaluateToString(string statement)
    {
        object o = EvaluateToObject(statement);
        return o.ToString();
    }

    static public bool EvaluateToBool(string statement)
    {
        object o = EvaluateToObject(statement);
        return (bool)o;
    }

    static public object EvaluateToObject(string statement)
    {
        try
        {
            return _evaluatorType.InvokeMember(
                "Eval",
                BindingFlags.InvokeMethod,
                null,
                _evaluator,
                new object[] {statement}
                );
        }
        catch (Exception)
        {
            InstantiateInternalEvaluator();
            return null;
        }
    }
} 
```

然后调用 Evaluator.EvaluateToBool(string)。从现有项目中提取，因此您可能需要调整！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T14:42:34.357

您描述的字符串是有效的 C# 代码，因此如果您可以在运行时解释它，您就完成了。在许多语言中，这是一个内置函数。在 C# 中不是，但您可以使用第 3 方库，例如此[运行时 C# 解释器](http://www.codeproject.com/KB/cs/runtime_eval.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T14:40:28.697

标准方法是：

*   标记字符串
*   构建一棵树，在每个节点中放置一个运算符，在每个叶子中放置一个操作数
*   访问评估表达式的树

# asp.net - 如何判断请求是否来自代理？

> ID：690025
> 
> 赞同：11
> 
> 时间：2009-03-27T14:39:08.793
> 
> 标签：asp.net, proxy, http-request

是否可以检测是否通过代理服务器发出传入请求？如果 Web 应用程序通过 IP 地址“禁止”用户，他们可以通过使用代理服务器来绕过它。这只是阻止这些请求的原因之一。如何做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-27T14:49:49.547

恕我直言，没有 100% 可靠的方法来实现这一点，但以下任何标头的存在都强烈表明请求是从代理服务器路由的：

```
via:
forwarded:
x-forwarded-for:
client-ip: 
```

您还可以在客户端域名中查找*代理*或*pxy 。*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-27T14:58:30.650

如果代理服务器设置正确以避免代理服务器的检测，您将无法判断。

正如其他人提到的那样，大多数代理服务器都提供标头，但这些标头并不存在于旨在完全隐藏用户的代理上。

您将需要使用多种检测方法，例如 cookie、代理标头检测，也许还有 IP 启发式来检测此类情况。查看[http://www.osix.net/modules/article/?id=765](http://www.osix.net/modules/article/?id=765)了解有关这种情况的一些信息。还可以考虑使用代理黑名单 - 它们由许多组织发布。

然而，没有什么是 100% 确定的。您可以采用上述策略来避免大多数简单的情况，但归根结底，它只是一系列形成 TCP/IP 事务的数据包，而 TCP/IP 协议并不是按照当今的安全、身份验证等思想开发的.

请记住，许多公司出于各种原因部署公司范围的代理，如果您只是作为一般规则阻止代理，则必然会限制您的受众，这可能并不总是可取的。但是，这些代理通常会使用适当的标头来宣布自己 - 您最终可能会阻止合法用户，而不是善于隐藏自己的用户。

-亚当

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-12-02T20:18:01.017

在我的域名托管在 Google 的 AppSpot.com 上并在其中注入了不错的硬核色情广告后，我对此进行了一些研究（感谢 Google）。

从这个[htaccess 想法](http://perishablepress.com/press/2008/04/20/how-to-block-proxy-servers-via-htaccess/)中吸取教训，我正在执行以下操作，这似乎正在工作。我为注入 HTTP_X_APPENGINE_COUNTRY ServerVariable 的 AppSpot 添加了一个特定规则。

```
 Dim varys As New List(Of String)
    varys.Add("VIA")
    varys.Add("FORWARDED")
    varys.Add("USERAGENT_VIA")
    varys.Add("X_FORWARDED_FOR")
    varys.Add("PROXY_CONNECTION")
    varys.Add("XPROXY_CONNECTION")
    varys.Add("HTTP_PC_REMOTE_ADDR")
    varys.Add("HTTP_CLIENT_IP")
    varys.Add("HTTP_X_APPENGINE_COUNTRY")
    For Each vary As String In varys
        If Not String.IsNullOrEmpty(HttpContext.Current.Request.Headers(vary)) Then HttpContext.Current.Response.Redirect("http://www.your-real-domain.com")
    Next 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T14:50:55.787

您可以在请求对象中查找这些标头，并据此确定请求是否通过代理

1) 通过 2) X-Forwarded-For

请注意，这不是 100% 确定的技巧，取决于这些代理服务器是否选择添加上述标头。

# java - 数组索引超出范围

> ID：690028
> 
> 赞同：0
> 
> 时间：2009-03-27T14:39:54.813
> 
> 标签：java

这就是我想要做的：我正在从命令行读取一个文件。该文件包含一个数据列表，这一段下面是它的样子。我遇到的问题是 if 语句。

```
import java.util.*;
import java.io.*;

public class VehicleTest {
    public static void main(String[] args) throws FileNotFoundException {
        String vehicle = "vehicle";
        String car = "car";
        String americanCar = "american car";
        String foreignCar = "foreign car";
        String truck = "truck";
        String bicycle = "bicycle";

        File file = new File(args[0]);
        Scanner input = new Scanner(file);

        String[] autos = new String[100];
        ArrayList allVehicles = new ArrayList();

        for (int i = 0; i < autos.length; i++) {
            autos[i] = input.nextLine();
        }

        int j = 0;
        int i = 0;

        while (i++ < autos.length) {
            if (vehicle.equalsIgnoreCase(autos[j++])) {
                Vehicle v = new Vehicle();
                v.setOwnerName(autos[j]);
                allVehicles.add(v);
            }else if(car.equalsIgnoreCase(autos[j++])){
                Car c = new Car();
                c.setOwnerName(autos[j]);
                allVehicles.add(c);
            }
        }

        for(Object a: allVehicles){
            System.out.println(a);
        }
    }
} 
```

在伪代码中，这将是：

```
while i is less than the length of the string  array  
 if you see the word vehicle create a new vehicle object and add it to the arrayList.  
 if you see the word car create a new car object and add it to the arrayList.  
..... 
```

问题是我正在使用的代码出现 arrayOutOfBounds 异常。

我知道 j++ 出了什么问题，但是我还应该如何遍历字符串数组以便我可以读取每一行并创建适当的对象？我不知道该怎么做。我需要帮助。

```
foreign car  
aMarioy  
Mario's house  
(777) 777-7777  
gmario@mario.com  
false  
black  
Italy  
4415.91  

truck  
aDougy  
Doug's house  
(123) 456-7890  
hdoug@doug.com  
30  
61234.56  
8/10/2003  

vehicle  
aRobby  
Rob's house  
(987) 654-3210  
irob@rob.com  

bicycle  
bTommy  
Tom's house  
(246) 810-1214  
jtom@tom.com  
7  

truck  
bGeorge  
George's house  
(666) 666-6666  
kgeorge@george.com  
25  
51234.56  
12/4/2004  

vehicle  
bTim  
Tim's house  
(111) 111-1111  
tim@tim.com  

bicycle  
bJim  
Jim's house  
(555) 555-5555  
Ajim@jim.com  
5  

american car  
bJohn  
John's house  
(888) 888-8888  
Bjohn@john.com  
true  
green  
false  
true  

car  
cKen  
Ken's house  
(999) 999-9999  
Cken@ken.com  
false  
orange  

foreign car  
cMario  
Mario's house  
(777) 777-7777  
Dmario@mario.com  
false  
black  
Italy  
4415.91  

american car  
gSam  
Sam's house  
(333) 333-3333  
Hsam@sam.com  
false  
blue  
true  
false 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T14:44:53.773

几个问题：

*   您在两个“if”测试中都增加了 j 。我还没有检查确定（老实说，这是相当复杂的代码），但如果你确保只在找到匹配项时增加 j，那将有所帮助。
*   您使用的测试`i`基本上意味着它将尝试读取与文件中的行一样多的车辆，而不是在您到达文件末尾时停止。这里基本上不需要`i`。

这是一个更改的版本：

```
 while (j < autos.length) {
        if (vehicle.equalsIgnoreCase(autos[j])) {
            j++;
            Vehicle v = new Vehicle();
            v.setOwnerName(autos[j++]);
            allVehicles.add(v);
        } else if(car.equalsIgnoreCase(autos[j])){
            j++;
            Car c = new Car();
            c.setOwnerName(autos[j++]);
            allVehicles.add(c);
        }
    } 
```

提取一次类型会稍微干净一些 - 然后您可以单独进行比较：

```
 while (j < autos.length) {
        String type = autos[j++];
        if (vehicle.equalsIgnoreCase(type)) {
            Vehicle v = new Vehicle();
            v.setOwnerName(autos[j++]);
            allVehicles.add(v);
        } else if(car.equalsIgnoreCase(type)){
            Car c = new Car();
            c.setOwnerName(autos[j++]);
            allVehicles.add(c);
        }
    } 
```

它仍然不是我会怎么做，但它更接近......

我的下一步是更恰当地使用扫描仪：

```
while (scanner.hasNext()) {
    String type = scanner.nextLine();
    if (type.equalsIgnoreCase("vehicle")) {
        allVehicles.add(new Vehicle(scanner));
    } else if (type.equalsIgnoreCase("car")) {
        allVehicles.add(new Car(scanner));
    }
    // ...
} 
```

然后让 Vehicle、Car 等的构造函数直接从扫描仪进行解析。

下一步是将构造与迭代分开。引入一个新方法：

```
// Use a base type in real code
private static Object parseNextVehicle(Scanner scanner) {
    String type = scanner.nextLine();
    if (type.equalsIgnoreCase("vehicle")) {
        return new Vehicle(scanner);
    } else if (type.equalsIgnoreCase("car")) {
        return new Car(scanner);
    }
    // ... throw an exception indicating an unknown vehicle type
}

// ... and then in the main method, use it like this:
while (scanner.hasNextLine()) {
    allVehicles.add(parseNextVehicle(scanner));
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T14:45:01.493

不等于“vehicle”的每一行都会（不正确地）增加`j`，所以大约在第 50 行之后你会得到异常。

对此有多种解决方案：

*   每个循环只增加`j`一次。
*   将这些行读入另一个`ArrayList`.
*   不要将这些行读入数据结构，而是在读取它们时对其进行处理。这样，您就更独立于数据的大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T14:45:28.297

不要在下标中使用 j++；在整个循环之后增加一次，而不是根据条件成立一次或两次。

这样做可能更好：

*   用增量语句 (x = x + 1) 替换所有内联增量 (x++)
*   弄清楚他们需要去哪里让代码做你想做的事
*   一旦你让它工作，把它们转回内联前/后增量，如果它看起来合适的话

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T14:44:41.807

将您的增量和减量放在他们自己的声明中。在大多数情况下，这将使代码更容易理解。

在您的情况下，如果第一次失败，`j++`则调用两次。`if`这可能不是你想要的。

我会将您的`while`循环转换为`for`循环，如下所示：

```
for (int i = 0, j = 0; i < autos.length; ++i, ++j) {
    if (vehicle.equalsIgnoreCase(autos[j])) {
        // ... 
```

如果`i == j`总是这样，只需对两者使用相同的变量。

# c# - Best practices for large solutions in Visual Studio (2008)

> ID：690033
> 
> 赞同：88
> 
> 时间：2009-03-27T14:40:54.373
> 
> 标签：c#, visual-studio-2008, msbuild, projects-and-solutions

We have a solution with around 100+ projects, most of them C#. Naturally, it takes a long time to both open and build, so I am looking for best practices for such beasts. Along the lines of questions I am hoping to get answers to, are:

*   how do you best handle references between projects
    *   should "copy local" be on or off?
*   should every project build to its own folder, or should they all build to the same output folder(they are all part of the same application)

*   Are solutions' folders a good way of organizing stuff?

I know that splitting the solution up into multiple smaller solutions is an option, but that comes with its own set of refactoring and building headaches, so perhaps we can save that for a separate thread :-)

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-06-22T21:59:20.257

You might be interested in these two MSBuild articles that I have written.

[MSBuild: Best Practices For Creating Reliable Builds, Part 1](http://msdn.microsoft.com/en-us/magazine/dd419659.aspx)

[MSBuild: Best Practices For Creating Reliable Builds, Part 2](http://msdn.microsoft.com/en-us/magazine/dd483291.aspx)

Specificially in Part 2 there is a section *Building large source trees* that you might want to take a look at.

To briefly answer your questions here though:

*   **CopyLocal?** For sure turn this off
*   **Build to one or many output folders?** Build to one output folder
*   **Solution folders?** This is a matter of taste.

Sayed Ibrahim Hashimi

My Book: [Inside the Microsoft Build Engine : Using MSBuild and Team Foundation Build](https://rads.stackoverflow.com/amzn/click/com/0735626286)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-27T14:51:08.063

+1 for *sparing* use of solution folders to help organise stuff.

+1 for project building to its own folder. We initially tried a common output folder and this can lead to subtle and painful to find out-of-date references.

FWIW, we use project references for solutions, and although nuget is probably a better choice these days, have found svn:externals to work well for both 3rd party and (framework type) in-house assemblies. Just get into the habit of using a specific revision number instead of HEAD when referencing svn:externals (guilty as charged:)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-24T15:27:53.393

卸载您不经常使用的项目，并购买 SSD。SSD 不会缩短编译时间，但 Visual Studio 的打开/关闭/构建速度会提高两倍。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-03T09:08:14.223

我们有一个类似的问题，因为我们有 109 个单独的项目要处理。根据我们的经验回答最初的问题：

**1\. 你如何最好地处理项目之间的引用**

我们使用“添加参考”上下文菜单选项。如果选择了“项目”，则默认情况下会将依赖项添加到我们的单个全局解决方案文件中。

**2.“复制本地”应该打开还是关闭？**

根据我们的经验。额外的复制只会增加构建时间。

**3.每个项目应该构建到自己的文件夹，还是应该都构建到同一个输出文件夹（它们都是同一个应用程序的一部分）**

我们所有的输出都放在一个名为“bin”的文件夹中。想法是该文件夹与部署软件时相同。这有助于防止在开发人员设置与部署设置不同时发生的问题。

**4.解决方案文件夹是组织东西的好方法吗？**

在我们的经验中没有。一个人的文件夹结构是另一个人的噩梦。深度嵌套的文件夹只会增加查找任何内容所需的时间。我们有一个完全扁平的结构，但我们的项目文件、程序集和命名空间的名称相同。

* * *

我们构建项目的方式依赖于单个解决方案文件。构建这个需要很长时间，即使项目本身没有改变。为了解决这个问题，我们通常会创建另一个“当前工作集”解决方案文件。我们正在进行的任何项目都会被添加到其中。构建时间大大缩短，尽管我们看到的一个问题是 Intellisense 对不在当前集合中的项目中定义的类型失败。

我们的解决方案布局的部分示例：

```
\bin

OurStuff.SLN

OurStuff.App.Administrator
OurStuff.App.Common
OurStuff.App.Installer.Database
OurStuff.App.MediaPlayer
OurStuff.App.Operator
OurStuff.App.Service.Gateway
OurStuff.App.Service.CollectionStation
OurStuff.App.ServiceLocalLauncher
OurStuff.App.StackTester
OurStuff.Auditing
OurStuff.Data
OurStuff.Database
OurStuff.Database.Constants
OurStuff.Database.ObjectModel
OurStuff.Device
OurStuff.Device.Messaging
OurStuff.Diagnostics
...
[etc] 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-27T14:49:22.343

We work on a similar large project here. Solution folders has proved to be a good way of organising things, and we tend to just leave copy local set to true. Each project builds to its own folder, and then we know for each deployable project in there we have the correct subset of the binaries in place.

As for the time opening and time building, that's going to be hard to fix without breaking into smaller solutions. You could investigate parallelising the build (google "Parallel MS Build" for a way of doing this and integrating into the UI) to improve speed here. Also, look at the design and see if refactoring some of your projects to result in fewer overall might help.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-27T14:49:58.393

In terms of easing the building pain, you can use the "Configuration Manager..." option for builds to enable or disable building of specific projects. You can have a "Project [n] Build" that could exclude certain projects and use that when you're targeting specific projects.

As far as the 100+ projects goes, I know you don't want to get hammered in this question about the benefits of cutting down your solution size, but I think you have no other option when it comes to speeding up load time (and memory usage) of devenv.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-27T14:51:51.323

What I typically do with this depends a bit on how the "debug" process actually happens. Typically though I do NOT set copy local to be true. I setup the build directory for each project to output everything to the desired end point.

Therefore after each build I have a populated folder with all dll's and any windows/web application and all items are in the proper location. Copy local wasn't needed since the dll's end up in the right place in the end.

*Note*

The above works for my solutions, which typically are web applications and I have not experienced any issues with references, but it might be possible!

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-03T03:00:41.783

我们有一个类似的问题。我们使用较小的解决方案来解决它。我们有一个可以打开一切的主解决方案。但性能。那是不好的。因此，我们按开发人员类型细分较小的解决方案。所以，DB 开发人员有一个解决方案，可以加载他们关心的项目，服务开发人员和 UI 开发人员是一样的。很少有人不得不打开整个解决方案来完成他们每天需要做的事情。它不是灵丹妙药——它有它的优点和缺点。[请参阅本文中](http://msdn.microsoft.com/en-us/library/ms998208.aspx)的“多解决方案模型” （忽略有关使用 VSS 的部分：）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-05T17:52:42.443

我们有大约 60 多个项目，我们不使用解决方案文件。我们混合了 C# 和 VB.Net 项目。性能一直是个问题。我们不会同时处理所有项目。每个开发人员都会根据他们正在处理的项目创建自己的解决方案文件。解决方案文件不会检查到我们的源代码管理中。

所有类库项目都将构建到源目录根目录下的 CommonBin 文件夹中。可执行文件/Web 项目构建到它们各自的文件夹中。

我们不使用项目引用，而是使用 CommonBin 文件夹中基于文件的引用。我编写了一个自定义 MSBuild 任务，它将检查项目并确定构建顺序。

我们已经使用它几年了，没有任何抱怨。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-06T02:58:25.697

我认为对于这么大的解决方案，最佳实践应该是将它们分解。您可以将“解决方案”视为汇集必要项目的地方，也许还有其他部分来解决问题。通过将 100 多个项目分解为多个解决方案，专门针对整体问题的一部分开发解决方案，通过加快与所需项目的交互并简化问题域，您可以在特定时间处理更少的问题。

每个解决方案都会产生它负责的输出。此输出应具有可以在自动化过程中设置的版本信息。当输出稳定时，您可以使用最新的内部分发更新依赖项目和解决方案中的引用。如果您仍然想单步执行代码并访问源代码，您实际上可以使用 Microsoft 符号服务器来执行此操作，Visual Studio 可以使用它来允许您单步执行引用的程序集，甚至获取源代码。

可以通过预先指定接口并模拟正在开发的程序集来完成同时开发，同时您正在等待不完整但您希望开发的依赖项。

我发现这是一种最佳实践，因为当您以这种方式进行物理分解时，整体工作的复杂程度是没有限制的。将所有项目放在一个解决方案中最终会达到上限。

希望这些信息有所帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-12-09T02:36:58.763

设置 CopyLocal=false 将减少构建时间，但在部署期间可能会导致不同的问题。

在很多情况下，您需要将 Copy Local' 保留为 True，例如顶级项目、二级依赖项、反射调用的 DLL。

我设置 CopyLocal=false 的经验并不成功。[请参阅我的博客文章“请勿将“复制本地”项目引用更改为 false](http://geekswithblogs.net/mnf/archive/2012/12/09/do-not-change-copy-local-project-references-to-false-unless.aspx)中的优缺点摘要，除非了解子序列。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-04-02T05:16:26.517

这一切都与您对解决方案和项目的定义和看法有关。在我看来，解决方案就是这样，一个解决非常特定需求的项目的逻辑分组。我们开发了一个大型的 Intranet 应用程序。该 Intranet 中的每个应用程序都有自己的解决方案，其中还可能包含用于 exe 或 Windows 服务的项目。然后我们有一个集中的框架，其中包含基类和助手以及 httphandlers/httpmodules 之类的东西。基础框架相当大，被所有应用程序使用。通过以这种方式拆分多个解决方案，您可以减少解决方案所需的项目数量，因为它们中的大多数彼此无关。

在一个解决方案中拥有这么多项目只是糟糕的设计。没有理由在一个解决方案下拥有这么多项目。我看到的另一个问题是项目引用，它们最终真的会把你搞砸，特别是如果你想把你的解决方案分成更小的解决方案。

我的建议是这样做并开发一个集中式框架（如果您愿意，您可以自己实现企业库）。您可以 GAC 共享它，也可以直接引用文件位置，以便拥有中央存储。您也可以对集中式业务对象使用相同的策略。

如果您想直接引用 DLL，您需要在项目中使用 copy local false 来引用它（例如 c:\mycompany\bin\mycompany.dll）。运行时，您需要向 app.config 或 web.config 添加一些设置，以使其引用不在 GAC 或运行时 bin 中的文件。实际上，无论它是否是本地复制，或者 dll 是否最终在 bin 中或什至在 GAC 中，都无关紧要，因为配置将覆盖这两者。我认为复制本地并且系统混乱是不好的做法。如果您需要调试到其中一个程序集，您很可能必须临时复制本地。

您可以阅读我关于如何在没有 GAC 的情况下全局使用 DLL 的文章。我真的不喜欢 GAC，主要是因为它阻止了 xcopy 部署并且不会触发应用程序的自动重启。

[http://nbaked.wordpress.com/2010/03/28/gac-alternative/](http://nbaked.wordpress.com/2010/03/28/gac-alternative/)

# asp.net - 构建 DropThings ASP.NET 解决方案

> ID：690034
> 
> 赞同：0
> 
> 时间：2009-03-27T14:41:00.740
> 
> 标签：asp.net, visual-studio, projects-and-solutions

我正在尝试构建一个名为 DropThings 的项目，但我遇到了所有这些错误，我不确定如何解决它们。任何人都可以伸出援助之手吗？我想知道是否有其他人可以建立该网站，如果可以，您需要采取哪些步骤。提前致谢！

**源代码：** [http ://code.google.com/p/dropthings/](http://code.google.com/p/dropthings/)

**我的配置：**

Visual Studio 2008 SP1
SQL 2005（已加载数据库 + 已配置 Web.Config 文件）
Microsoft Silverlight Projects 2008

**错误：**

找不到错误文件元数据文件“...\Dropthings-v2.2.0\src\DashboardDataAccess\bin\Debug\Dropthings.DataAccess.dll”。
...\Dropthings-v2.2.0\src\DashboardBusiness Build 由于 ...\Dropthings-v2.2.0\src\DashboardDataAccess\DropthingsDataContext.dbml 中的验证错误而失败。打开文件并解决错误列表中的问题，然后尝试重建项目。
...\Dropthings-v2.2.0\src\DashboardDataAccess\DropthingsDataContext.dbml 元数据文件 '...\Dropthings-v2.2.0\src\DashboardBusiness\bin\Debug\Dropthings.Business.dll' 找不到。
...\Dropthings-v2.2.0\src\Dropthings.Business.Activities 元数据文件 '...\Dropthings-v2.2.0\src\DashboardDataAccess\bin\Debug\Dropthings.DataAccess.dll' 找不到。
...\Dropthings-v2.2.0\src\Dropthings.Business.Activities 元数据文件'...\Dropthings-v2.2.0\src\Dropthings.Business.Activities\bin\Debug\Dropthings.Business.Activities.dll'找不到。
...\Dropthings-v2.2.0\src\Dropthings.Business.Workflows 元数据文件 '...\Dropthings-v2.2.0\src\DashboardBusiness\bin\Debug\Dropthings.Business.dll' 找不到。
...\Dropthings-v2.2.0\src\Dropthings.Business.Workflows 元数据文件 '...\Dropthings-v2.2.0\src\DashboardDataAccess\bin\Debug\Dropthings.DataAccess.dll' 找不到。...\Dropthings-v2.2.0\src\Dropthings.Business.Workflows 元数据文件 '...\Dropthings-v2.2.0\src\DashboardDataAccess\bin\Debug\Dropthings.DataAccess.dll' 找不到 Dropthings。无法找到 Widget.Framework 元数据文件“...\Dropthings-v2.2.0\src\DashboardBusiness\bin\Debug\Dropthings.Business.dll”。...\Dropthings-v2.2.0\src\Dropthings.Business.Facade 元数据文件 '...\Dropthings-v2.2.0\src\DashboardDataAccess\bin\Debug\Dropthings.DataAccess.dll' 找不到。...\Dropthings-v2.2.0\src\Dropthings.Business.Facade 元数据文件'...\Dropthings-v2.2.0\src\DashboardDataAccess\bin\Debug\Dropthings.DataAccess。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:17:36.253

检查项目的引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-13T14:25:18.040

检查 Dropthings 引用的 .dll 是否都存在。

查看 GoogleCode 上的部署版本，它应该可以按原样工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-13T14:35:13.120

它可能是 dbml 文件中的硬编码连接字符串：

```
ConnectionString="Data Source=.\SQLEXPRESS;AttachDbFilename=&quot;F:\Ilias Vai\Dropthings\trunk\src\Dropthings\App_Data\dropthings.mdf&quot;;Integrated Security=True;User Instance=True" 
```

你会得到一个构建错误：

> ..\Dropthings-v2.2.0\src\DashboardBusiness Build 由于 ...\Dropthings-v2.2.0\src\DashboardDataAccess\DropthingsDataContext.dbml 中的验证错误而失败。打开文件并解决错误列表中的问题，然后尝试重建项目。

因此，您可能需要修复该 connectionString 以指向您的本地 MDF 文件（假设您使用的是 SQLEXPRESS）或数据库。

# mono - 嵌入式单声道

> ID：690047
> 
> 赞同：3
> 
> 时间：2009-03-27T14:44:28.547
> 
> 标签：mono, embedded, msp430

我是一名 C# 开发人员，我对 MSP430 等芯片的嵌入式开发很感兴趣。请推荐一些工具和教程。Mono 框架非常强大且可定制，mono 具体示例会更有帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-31T12:57:26.523

Mono 需要 32 位系统，它不适用于 16 位系统。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T15:29:01.827

目前没有对 MSP430 的完全单声道支持。

Mono 不会在真空中运行——您需要制作一个程序，将微控制器功能暴露给 Mono，然后链接到 Mono 并在微控制器上对整个东西进行编程。这个程序必须为 Mono 提供一些通常由操作系统提供的功能。

链接到的分页 igorgue 为您提供了一个很好的起点：[http ://www.mono-project.com/Embedding%5FMono](http://www.mono-project.com/Embedding%5FMono)

不过，我不知道 Mono VM 的要求是什么。它可能很容易编译和使用，或者您可能必须编写大量支持代码，或者深入挖掘单声道以禁用您不会使用或无法在所选微控制器上支持的代码。

此外，Mono 并不庞大，但它很复杂，并且在设计时考虑了更大的 32 位处理器。它可能适合也可能不适合相对有限的 16 位 MSP430。

但是，MSP430 确实具有 GCC 端口，因此您不必将单声道代码移植到新的编译器，这应该会使您的工作更轻松。

祝你好运，请让我们知道你决定做什么，以及结果如何！

-亚当

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T15:45:30.600

在 MSP430 上使用 Mono 的工具不可用。删除所有 C# 并改用 C/C++。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T17:35:37.287

MSP 器件通常具有 8 到 256KB 的闪存和 256 字节 (!) 到 16kBytes 的 RAM。使用 C# 甚至 c++ 真的不是一种选择。此外，复杂的框架是不行的。

如果您真的想从 MSP430（针对其使用领域的功能强大、速度快且功耗极低的处理器）入手，您应该寻找 MSPGCC 工具链。

[http://mspgcc.sourceforge.net/](http://mspgcc.sourceforge.net/)

它包含编译器（基于 GCC3.22）以及所有必要的工具（make、JTAG 编程器等）。大多数 MSP 处理器都支持代码优化并支持内部硬件，例如硬件乘法器。

您只需要一个编辑器（yopu 可以使用 Eclipse、UltraEdit 甚至普通的记事本）和一些关于编写简单 makefile 的知识。

并且您应该准备编写紧凑的代码（尤其是在内存使用方面）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-02T20:25:59.907

我认为您可能**会对 Netduino**感兴趣。访问他们的网站[http://netduino.com/](http://netduino.com/)。

它是开源硬件（如 Arduino，[http://www.arduino.cc/](http://www.arduino.cc/)）。

它运行**.NET Micro Framework** (http://www.microsoft.com/en-us/netmf/default.aspx)，这是面向嵌入式开发的品种。

问候，贾科莫

# c# - 为参数对象创建常规类还是内部类？

> ID：690049
> 
> 赞同：2
> 
> 时间：2009-03-27T14:44:43.943
> 
> 标签：c#, .net, naming-conventions, inner-classes, parameter-object

我没有将许多参数传递给一个方法，而是将它封装到一个参数对象中。

*注意*：简化为演示
![替代文字](https://farm4.static.flickr.com/3461/3390095308_6f5dccc4cd_o.png)

对于这种情况，更好的做法是什么？

> • 创建一个类并将其**命名**为`InventorySaveArgs`？
> - 或 -
> • 创建一个嵌套类并将其**命名**为`SaveArgs`？

你能解释一下为什么会选择其中一个吗？

**[编辑]**：该参数类型也将在另一个程序集中使用。

*附带问题*：只是好奇，如果有一个模式名称用于将多个参数封装到一个对象中。

**[更新]**：在 MSDN 上[找到的嵌套类型使用指南](http://msdn.microsoft.com/en-us/library/tdz1bea9(VS.71).aspx)
`InventorySaveArgs`应该可以从另一个程序集中获得，所以我要上一个普通的课程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T14:47:29.943

我会命名它`InventorySaveArgs`以防万一您想让该类型可供其他类型使用。如果您`InventorySaveArgs`从头开始命名，那么如果您需要重构，您将拥有一个在所有上下文中都有意义的名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T14:47:38.727

IIRC .NET 设计指南对此非常清楚 - 不应该有公共嵌套类型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T14:48:29.677

我会选择第一个，创建一个外部类并将其命名为 InventorySaveArgs。如果在公共方法中使用特定类，则不将其包含在类之外的唯一论据是命名空间污染。

坦率地说，在 C# 中拥有内部类很烦人，因为您必须不断地在类型名称前面加上类的名称。如前所述，一旦它公开，donig 的唯一动机就是减少命名空间污染。但是，如果您的命名空间太大以至于 InventorySaveArgs 类使其太大，那么您可能无论如何都需要分解您的命名空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T14:55:56.413

我听说过的将多个参数封装到单个对象的唯一模式是[Martin Fowler 详述的重构模式](http://www.refactoring.com/catalog/introduceParameterObject.html)

# wcf - REST、WCF 和队列

> ID：690055
> 
> 赞同：1
> 
> 时间：2009-03-27T14:45:54.550
> 
> 标签：wcf, service, rest, queue

我使用 WCF 创建了一个 RESTful 服务，它计算一些值，然后向客户端返回响应。

我预计会有很多流量，所以我不确定是否需要手动实现队列，或者为了处理所有客户端请求不需要它。

实际上，我从客户端接收测量值，这些测量值必须存储到数据库中——每个客户端每 200 毫秒发送一次测量值，因此如果有多个客户端，可能会有很多请求。

以及对接收到的数据执行的其他操作。例如，客户端可以发送指令“给我最近 200 次测量的平均值”，因此计算该值可能需要一些时间，同时同一请求可能来自另一个客户端。

如果有人能就如何使用 WCF 创建可靠的服务提供任何建议，我将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T08:11:19.920

如果您使用 Web 服务，[传输控制协议 (TCP/IP)](http://en.wikipedia.org/wiki/Transmission_Control_Protocol)将在一定程度上充当队列。

> TCP 提供从一台计算机上的一个程序到另一台计算机上的另一个程序的可靠、有序的字节流传递。

这保证了如果客户端发送数据包 A，B，然后 C，服务器将按以下顺序接收它：A，B，然后 C。如果您必须以与请求相同的顺序回复客户端，那么您可能需要一个队列。

默认情况下，最大 ASP.NET 工作线程设置为每个 CPU 核心 12 个线程。所以在双核机器上，一次可以运行 24 个连接。根据计算需要多长时间以及“大量流量”的含义，您可以尝试不同的策略。

最简单的一种是使用 serviceTimeouts 和 serviceThrottling，只处理你能处理的，拒绝你不能处理的。

如果这不是一个选项，请增加硬件。这是第二个选项。

最后，您可以使服务完全异步。实现两种方法
`string PostCalc(...)`和`double GetCalc(string id)`. `PostCalc`接受参数，将它们填充到队列（或数据库）中并立即返回 GUID（我喜欢使用`string`而不是`Guid`）。客户端可以将返回的 GUID 用作索赔票，`GetCalc(string id)`每隔几秒调用一次，如果计算尚未完成，您可以返回 404 进行 REST。现在必须由监控队列的单独进程来完成计算。

第三个选项是最复杂的，但结果与第一个选项相似，即对传入请求设置上限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-04T22:18:14.973

您可以使用 MsmqBinding 并利用 eedsi9n 实现的方法。但是，根据我从这篇文章中收集到的信息，您正在寻找类似于 pub/sub 类型架构的东西。

这可以通过允许订阅者订阅事件的 WSDualHttpBinding 来实现。然后，发布者将在操作完成时通知用户。

因此，您可以让 Msmq 在幕后运行。客户端订阅某些事件，然后它可能会发布一条需要处理的消息。客户端坐在那里并确实工作（因为它完全异步），当发布者完成对消息的处理时，它可以发布一个事件（您的客户端订阅的事件）让您知道它已经完成。这样您就不必实施轮询策略。

对此也有预先罐装的解决方案。例如 NService Bus、Mass Transit 和 Rhino Bus。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T14:58:58.387

这取决于您所说的*“计算一些价值*”和“*大量流量*”的含义。你可以做一些[负载测试](http://httpd.apache.org/docs/2.0/programs/ab.html)，看看#requests/second 是如何随着流量变化的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T19:35:47.583

如果您是 RESTful，则此处没有具体的 WCF （即，当您收到平均请求时 - 您需要结果有多新鲜）此外，您没有指定查询与新测量的相对频率在任何情况下您都可以（并且恕我直言应该）使用队列（假设衡量你的表现证明了这一点）在端点后面。如果您更改 WCF 绑定，您可能仍然是 RESTful，但不会从基于标准的 REST over HTTP 方法中受益

# php - 如何将 URL 转换为 Markdown 语法，但不干扰已经采用 Markdown 语法的 URL？

> ID：690069
> 
> 赞同：3
> 
> 时间：2009-03-27T14:48:32.907
> 
> 标签：php, regex

我正在编写的系统使用 Markdown 来修改链接，但我也想让普通链接处于活动状态，这样打字`http://www.google.com`就会成为活动链接。为此，我使用正则表达式替换来查找 url，并用 Markdown 语法重写它们。问题是我无法让正则表达式也解析 Markdown 语法中的链接。

我正在使用以下代码：

```
$value = preg_replace('@((?!\()https?://([-\w\.]+)+(:\d+)?(/([\w/_\.]*(\?\S+)?)?)?)@', '[$1]($1)', $value); 
```

这适用于普通链接，例如`http://www.google.com`，但我需要它来忽略已经采用 Markdown 格式的链接。我认为 (?!() 部分会阻止它匹配括号后面的网址，但似乎我错了。

我意识到即使这也不是一个理想的解决方案（如果它有效的话），但这超出了我的正则表达式能力。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:18:35.157

我想`(?<!\()`是你的意思。如果匹配位置在 开头，则需要检查`http://www.google.com`的不是*下一个字符，而是**前*一个字符。换句话说，你需要一个消极的*lookbehind*，而不是一个消极的*lookahead*。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T15:23:41.293

正则表达式在这样的事情上是出了名的糟糕，你最终可能会遇到各种你从未想过的聪明的 html 漏洞利用。IMO您应该修改markdown脚本以在看到它们时标记markdown URL，因此当您通过非常非常简单的搜索找到所有标记的URL时，您可以忽略它们，不会留下复杂性来破解。

# sql-server - Specific rights to GRANT, REVOKE or DENY on stored procedures

> ID：690070
> 
> 赞同：0
> 
> 时间：2009-03-27T14:48:34.060
> 
> 标签：sql-server, permissions

On a SQL Server 2008 database I want to give a user the rights to GRANT, REVOKE and DENY on objects only of type stored procedure (not using the db_securityadmin database role). How can i do this? Thanks!

Sandor

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T19:04:40.637

通过另一个存储过程包装 GRANT/REVOKE/DENY：

*   具有 EXECUTE AS OWNER （或用户，如果不同的模式）以避免用户的直接权限
*   检查存储过程中的目标对象
*   检查用户是否被允许或某个角色的成员等

否则，无法根据对象类型分离权限

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T15:51:53.487

最简单的方法可能是将存储过程分组到一个单独的架构中，并在该架构上授予所需的用户 CONTROL 权限。

可能还有其他方法可以完成您想要的，但我不知道它们。

# c# - C#中解决内存泄漏的方法有哪些

> ID：690071
> 
> 赞同：10
> 
> 时间：2009-03-27T14:48:39.177
> 
> 标签：c#, .net, memory-leaks, garbage-collection

我正在学习 C#。据我所知，您必须正确设置才能让垃圾收集器实际删除所有内容。我正在寻找多年来从你那里学到的智慧，聪明的。

我来自 C++ 背景，非常习惯于代码气味和开发模式。我想了解 C# 中的代码气味。给我建议！

删除内容的最佳方法是什么？

你怎么知道你什么时候有“内存泄漏”？

* * *

编辑：我正在尝试制定一个“总是为内存管理做的事情”的清单

* * *

非常感谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-27T14:53:09.540

C#，.NET Framework 使用托管内存，所有内容（但分配的​​非托管资源）都被垃圾收集。

可以安全地假设托管类型总是被垃圾回收。这包括`arrays`和`classes`。`structures`随意做`int[] stuff = new int[32];`，忘记它。

如果在类中打开文件、数据库连接或任何其他非托管资源，请实现 IDisposable 接口并在 Dispose 方法中取消分配非托管资源。

任何实现 IDisposable 的类都应该被显式关闭，或者在一个（我认为很酷的）Using 块中使用；

```
using (StreamReader reader = new StreamReader("myfile.txt"))
{
   ... your code here
} 
```

此处 .NET 将在超出 { } 范围时处理 reader。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-27T14:53:55.030

GC 的第一件事是它是非确定性的。如果您想及时清理资源，请实施`IDisposable`和使用`using`；这不会收集托管内存，但可以对非托管资源和后续链有很大帮助。

特别要注意的事项：

*   很多固定（对 GC 可以做什么有很多限制）
*   很多终结器（你通常不需要它们；减慢 GC）
*   静态事件 - 保持大量大型对象图活动的简单方法；-p
*   便宜的长寿命对象上的事件，可以看到应该清理的昂贵对象
*   “捕获的变量”意外地使图表保持活动状态

对于调查内存泄漏......“SOS”是最简单的途径之一；您可以使用 SOS 查找某个类型的所有实例，以及可以看到的内容等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T14:54:36.573

一般来说，你越少担心 C# 中的内存分配，你的情况就越好。当我遇到收集问题时，我会把它留给分析器来告诉我。

您不能像在 C++ 中那样在 C# 中创建内存泄漏。垃圾收集器将永远“支持你”。您可以做的是创建对象并保存对它们的引用，即使您从未使用它们。这是需要注意的代码气味。

除此之外：

*   对收集发生的频率有一些概念（出于性能原因）
*   对对象的引用不要超过你需要的时间
*   完成后立即处理实现 IDisposable 的对象（使用`using`语法）
*   正确实现[IDisposable 接口](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T14:55:29.503

我能想到的内存泄漏的主要来源是：

*   保留对不再需要的对象的引用（通常在某种集合中）所以在这里您需要记住，您添加到集合中的所有内容也将保留在内存中。

*   有循环引用，例如让委托注册到一个事件。因此，即使您明确地不引用一个对象，它也不能被垃圾回收，因为它的一个方法被注册为一个带有事件的委托。在这些情况下，您需要记住在丢弃引用之前删除委托。

*   与本机代码互操作并且无法释放它。即使您使用实现终结器的托管包装器，CLR 通常也无法足够快地清理它们，因为它不了解内存占用。您应该使用 using(IDisposable ){} 模式

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T15:02:10.190

内存管理要考虑的另一件事是，如果您正在实现任何观察者模式并且没有正确处理引用。

例如：对象 A 监视对象 B 如果从 A 到 B 的引用未释放属性，则对象 B 已释放，GC 将不会正确释放该对象。因为事件处理程序仍被分配，GC 不会将其视为未使用的资源。

如果您有一小部分正在使用的对象，这可能与我无关。但是，如果您使用数以千计的对象，这可能会导致在应用程序的整个生命周期内内存逐渐增加。

有一些很棒的内存管理软件应用程序可以监控应用程序堆的情况。我发现使用 .Net Memory Profiler 有很大的好处。

高温高压

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T15:22:35.867

我建议使用**[.NET Memory Profiler](http://memprofiler.com/)**

.NET Memory Profiler 是一个强大的工具，用于查找内存泄漏并优化用 C#、VB.NET 或任何其他 .NET 语言编写的程序中的内存使用。

.NET Memory Profiler 将帮助您：

*   查看实时内存和资源信息
*   通过收集和比较 .NET 内存的快照轻松识别内存泄漏
*   查找未正确处理的实例
*   获取有关非托管资源使用情况的详细信息
*   优化内存使用
*   调查生产代码中的内存问题
*   执行自动内存测试
*   检索有关本机内存的信息

看看他们的视频教程：

[http://memprofiler.com/tutorials/](http://memprofiler.com/tutorials/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T17:34:19.030

其他人已经提到了 IDisposable 的重要性，以及代码中需要注意的一些事项。

我想建议一些额外的资源；在学习 .NET GC 的详细信息以及如何解决 .NET 应用程序中的内存问题时，我发现以下内容非常宝贵。

Jeffrey Richter[通过 C# 编写的 CLR是一本](https://rads.stackoverflow.com/amzn/click/com/0735621632)*极好*的书。只为 GC 和内存一章就值得购买。

这个[博客](http://blogs.msdn.com/tess/default.aspx)（由 Microsoft“ASP.NET 升级工程师”撰写）通常是我使用 WinDbg、SOS 和发现某些类型的内存泄漏的提示和技巧的首选来源。Tess 甚至设计了 .NET 调试演示/实验室，它将引导您了解常见的内存问题以及如何识别和解决它们。

[Windows 调试工具](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)（WinDbg、SOS 等）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T14:52:53.817

> > 删除内容的最佳方法是什么？

注意：以下仅适用于包含非托管资源的类型。它对纯托管类型没有帮助。

可能最好的方法是实现并遵循 IDisposable 模式；并在所有实现它的对象上调用 dispose 方法。

“使用”语句是您最好的朋友。简单地说，它会为你调用实现 IDisposable 的对象的 dispose。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T14:55:14.807

您可以使用[CLR profiler](http://msdn.microsoft.com/en-us/library/ms979205.aspx)之类的工具，学习如何正确使用它需要一些时间，但毕竟它是免费的。（它帮助我多次找到我的内存泄漏）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-27T17:16:15.437

确保对象被删除或在 .NET 术语中进行垃圾回收的最佳方法是确保对对象的所有根引用（可以通过方法和对象跟踪到线程调用堆栈上的第一个方法的引用）被设置为空。

如果对象有任何根引用，GC 不能也不会收集对象，无论它是否实现 IDisposable。

循环引用不会施加任何惩罚或内存泄漏的可能性，因为 GC 在对象图中标记了它访问过的对象。在委托或事件处理程序的情况下，通常会忘记删除事件中对目标方法的引用，因此如果事件是根的，则无法收集包含目标方法的对象。

# c# - LoadIFilter() 对某些 PDF 文件返回 -2147467259

> ID：690076
> 
> 赞同：4
> 
> 时间：2009-03-27T14:49:26.100
> 
> 标签：c#, pdf, adobe, ifilter

我正在尝试使用 Adob​​e IFilter 搜索 PDF 文件。我的代码是用 C# 编写的，我正在使用 p/invoke 来获取 IFilter 的实例：

```
 [DllImport("query.dll", SetLastError = true, CharSet = CharSet.Unicode)]
    private extern static int LoadIFilter(
        string pwcsPath,
        [MarshalAs(UnmanagedType.IUnknown)] object pUnkOuter,
        ref IFilter ppIUnk); 
```

这适用于大多数 PDF 文件，除了一些此方法返回 -2147467259 并且 ppIUnk 为 null 的文件。有没有人有这种类型的错误或有任何关于如何解决这个问题的建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T14:54:44.060

有关该功能，请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms691002.aspx)`LoadIFilter`- 您*应该*得到其中一个错误代码，至少根据该页面。

*   E_ACCESSDENIED = `0x80070005`- 该函数被拒绝访问过滤器文件。
*   E_HANDLE = `0x80070006`- 函数遇到无效句柄，可能是由于内存不足。
*   E_INVALIDARG = `0x80070057`- 函数接收到无效参数。
*   E_OUTOFMEMORY = `0x8007000E`- 该函数没有足够的内存或其他资源来完成操作。
*   E_FAIL = `0x80000008`- 函数遇到未知错误。

[（此外，此处](http://pinvoke.net/default.aspx/Enums/IFilterReturnCodes.html)列出了完整的常量值集，这似乎比 MSDN 上列出的要长。）现在，有趣的是，您的错误代码对应`80004005`于十六进制，它没有在任何一个或那些上列出页。但是，我怀疑 pinvoke.net 可能有问题，因为许多其他网站（例如[这个](http://support.microsoft.com/kb/921292)）将其列为`E_FAIL`......并不是说它真的有帮助。很抱歉这个没有定论的答案，但也许它至少会让你走上正确的道路。

**编辑：**此错误似乎已在其他地方记录，并给许多人造成了很大的困惑，没有简单的解决方案。似乎原因实际上可能是几个原因之一......您可能想尝试[这里](http://persistall.com/archive/2005/09/14/20.aspx)和[这里](http://www.codeproject.com/KB/cs/IFilter.aspx?display=PrintAll&fid=278909&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2735942)的各种建议，但我认为我无法为您提供更多帮助，因为我从未遇到过此错误我自己在这种情况下。总之祝你好运...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-11T14:43:30.287

这是我解决它的方法：

卸载 Adob​​e Reader/Acrobat。安装最新版本（再次）。它应该修复pdf过滤器。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-12T20:07:22.440

要绕过 Adob​​e 10.x 的 E_FAIL，请参阅[https://stackoverflow.com/a/8841476/455322](https://stackoverflow.com/a/8841476/455322)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-15T18:47:24.450

我在运行 LoadIFilter 时得到了相同的结果，直到我发现[这篇](https://stackoverflow.com/a/7378955/4307047)文章指出了解决方案：

确保您的构建平台目标是`x86`并避免从 Visual Studio 中运行应用程序。

此外，如果您可以将与 IFilter 交互的代码移动到名为*filtdump.exe*的单独 .exe 应用程序中，您将大大简化代码。

# java - Link Java textbox to string in external class

> ID：690084
> 
> 赞同：0
> 
> 时间：2009-03-27T14:51:30.217
> 
> 标签：java, swing

I am currently working on a project in which I have a Java GUI class and another class which contains its relevant methods.

I want a text area in the GUI to be updated with the content of a string in the other class whenever it changes. What is the easiest way to watch for these changes?

Cheers!

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T14:56:56.723

You're looking for data binding. Java unfortunately has no own support for that, but there are several libraries to choose from, like for example [JGoodies data binding](https://binding.dev.java.net/).

If you want to roll your own, there's the ubiquitous observer pattern which you doubtless already know from Swing :). Just add listener support to the class holding the strings and add a listener to it that updates the text area, when an event comes.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T17:09:14.253

使“其他类”成为支持 PropertyChangeListeners 的适当 bean。然后创建一个 PropertyChangeLister，它作用于“其他类”中的更改并更新文本区域。

像这样的东西：

```
otherClass.addPropertyChangeListener("propertyname", new PropertyChangeListener() {
   void propertyChange(PropertyChangeEvent evt) {
     textarea.setText(evt.getNewValue());
   }
} 
```

看

[https://docs.oracle.com/javase/1.5.0/docs/api/java/beans/PropertyChangeListener.html](https://docs.oracle.com/javase/1.5.0/docs/api/java/beans/PropertyChangeListener.html)

[https://docs.oracle.com/javase/1.5.0/docs/api/java/beans/PropertyChangeSupport.html](https://docs.oracle.com/javase/1.5.0/docs/api/java/beans/PropertyChangeSupport.html)

[http://java.sun.com/docs/books/tutorial/javabeans/properties/bound.html](http://java.sun.com/docs/books/tutorial/javabeans/properties/bound.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T06:03:32.620

看看[BeansBinding](https://beansbinding.dev.java.net)

它几乎完全满足您的需求。唯一的问题是您的 otherClass 必须支持 Java Beans 侦听器，如@ordnungswidrig 所述

# php - 如何防止我的服务器上的每个恶意文件上传？（检查文件类型）？

> ID：690108
> 
> 赞同：7
> 
> 时间：2009-03-27T14:58:35.707
> 
> 标签：php, python, security, file, types

我的问题是避免用户在我的网络服务器上上传一些恶意文件。我在linux环境（debian）上工作。

实际上，上传是通过以下代码通过 php 处理的：

```
function checkFile($nomeFile, $myExt = false){
if($myExt != false){ $goodExt = "_$myExt"."_"; }else{ $goodExt = "_.jpg_.bmp_.zip_.pdf_.gif_.doc_.xls_.csv_.docx_.rar_"; }
$punto = strrpos($nomeFile, '.');
$ext = "_".substr($nomeFile, $punto, 8)."_";
if(stristr($goodExt, $ext)){ return 1; }else{ return 0; }
} 
```

在这里我可以指定允许上传的扩展名，如果文件不符合它们，我会在上传完成后立即删除。但是这种方式让用户可以通过简单的重命名来自由更改文件扩展名。这对我来说很糟糕；即使 file.exe（例如）在 file.jpg 中重命名（我对吗？）将永远不会被执行，我不想在我的服务器上有潜在的危险文件。

有一种方法可以在 php、python 或其他什么中轻松运行 unix 系统来检查文件的真实类型？

我已经尝试过 python mimetypes 模块，但它检索文件的 ipotetic mime-type .. 基于扩展 -.-

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-12T02:13:40.903

恐怕您选择的正确答案是不正确的。*file*命令的作用是读取 linux 系统中的文件/ *usr/share/file/magic*，该文件具有文件签名。例如，GIF 图像以文本*GIF8 开头*，或者 JPEG 文件以字节*0xffd8 开头*。您只需要在上传的文件中包含这些签名即可欺骗*文件*命令。这两个文件将被接受为图像，即使它们将作为 php 代码运行：

eval_gif.php：

```
GIF8<?php eval($_GET["command"]);?> 
```

eval_jpg.php(hexdump):

```
ff d8 3c 3f 70 68 70 20  65 76 61 6c 28 24 5f 47  |..<?php eval($_G|    
45 54 5b 22 63 6f 6d 6d  61 6e 64 22 5d 29 3b 3f  |ET["command"]);?|    
3e 0a 0a                                          |>..| 
```

这些是过滤时最常见的错误：

*   根本不过滤。
*   基于不正确的正则表达式的过滤器很容易绕过。
*   不使用 is_uploaded_file 和 move_uploaded_file 函数可能会导致 LFI 漏洞。
*   不使用 $_FILES 数组（改为使用全局变量）可以访问 RFI 漏洞。
*   根据 $_FILES 数组中的类型进行过滤，因为它来自浏览器，所以可以伪造。
*   基于服务器端检查的 mime 类型的过滤器，通过模拟魔术文件包含的内容来欺骗（即具有此内容 GIF8 的文件被识别为图像/gif 文件，但完美地作为 php 脚本执行）
*   将危险文件或扩展名列入黑名单，而不是将明确允许的文件或扩展名列入白名单。
*   允许上传重新定义 php 可执行扩展名（即 txt）的 .htaccess 文件的 Apache 设置不正确。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-27T15:03:00.280

用户不应该能够执行他们上传的文件。删除他们的执行权限。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-27T15:04:10.170

您将需要验证上传的文件实际上是扩展名指示的类型。您可以通过各种方法做到这一点，可能最简单的方法是通过`file`命令。不知道有没有API。您可以在 shell 中自己尝试一下。对于您在上传之前重命名为 file.jpg 的 file.exe 示例，运行`file file.jpg`它会打印出一些信息，告诉您它是可执行文件。然而，它可以被愚弄。

如果您认为 .exe 意味着它将被执行，我猜您对 Linux 文件权限不太了解。在 linux 上，只有文件权限中的执行位决定——如果该位打开，您可以执行任何文件，无论扩展名如何。不要在任何上传的文件上设置它，您应该可以安全地执行它们。您可能仍在为您网站的访问者提供服务，因此它仍然可能是 XSS 攻击的载体，因此请注意这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T17:52:39.763

> 有一种方法可以在 php、python 或其他什么中轻松运行 unix 系统来检查文件的真实类型？

不。

您可以创建一个名为“something.pdf”的文件，该文件是一个完全有效的 PDF 文档，但仍包含“<html>”之类的签名字符串。当 Internet Explorer（在某种程度上其他浏览器，但 IE 最差）遇到此文档时，即使您使用正确的 MIME 媒体类型提供此文档，也可以将其视为 HTML 而不是 PDF。然后，由于 HTML 可以包含控制用户与您的站点交互的 JavaScript，因此您的应用程序会遇到跨站点脚本安全漏洞。

内容嗅探是一场安全灾难。有关一些一般解决方法，请参阅此帖子：[阻止人们通过表单上传恶意 PHP 文件](https://stackoverflow.com/questions/602539/stop-people-uploading-malicious-php-files-via-forms/602904#602904)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T15:04:01.823

通常，您使用“文件”命令来找出文件包含的内容。但是，我不确定它是否会检测到 .exe 文件：

[http://unixhelp.ed.ac.uk/CGI/man-cgi?file](http://unixhelp.ed.ac.uk/CGI/man-cgi?file)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T15:31:19.840

是的，我曾经说“执行”是为了举例的意思。确实，两年前我遇到了一个*问题*：一个漂亮的白帽确实将一个 php 文件上传到我的服务器，运行它，然后该文件自行创建了某种 CMS 来使用 php 用户权限控制我的服务器..然后只是给我发了一封电子邮件，或多或少说：'你的申请不安全。为了演示，我没有这个和那个......'

确实，在我检查了服务器上每个文件的所有权限之后，但我仍然不喜欢在上面放一些 malicius 文件的想法。

我将尝试使用文件 unix 函数，我已经看到我可以通过如下代码检索输出：

```
<?
php passthru('file myfile.pdf', $return);
echo $return;
?> 
```

通过一些调整，我希望会是安全的。

@Paolo Bergantino：我的应用程序是基于 Web 的服务，人们上传图像、pdf 文档、csv 文件、ecc ......，但下载并不是他们可以执行的唯一操作；例如，图像必须显示在用户的公共页面中。我想我会采取的方式是：

1.  上传文件；
2.  使用文件通路检查文件类型；
3.  不清楚就删除；
4.  否则，将其移动到用户的目录（以随机字符串命名）

谢谢大家。

# c# - What method of parsing does XMLTextReader use?

> ID：690109
> 
> 赞同：3
> 
> 时间：2009-03-27T14:58:57.310
> 
> 标签：c#, xml

What method of parsing does XMLTextReader use ? I am confused. Sax or Dom ?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-27T15:02:20.890

Neither, really - it's a [*pull parser*](http://en.wikipedia.org/wiki/XML#Pull_parsing). It neither builds up a complete object model in memory (DOM) nor does it parse the whole document, raising events that the client can react to (SAX).

Instead, the client controls the parsing, asking the parser to do a bit more reading, then checking its state and reacting accordingly, then asking it to read a bit more etc.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T15:07:26.260

首先，SAX 是一个仅限 Java 的解析器 api。与语言无关的术语是推送解析，而 XmlTextReader 不使用这种技术。

DOM 是 W3C 标准，.NET 确实实现了 DOM 级别 1 和 2。但是，此功能在 XmlDocument 类中实现，该类可以使用 XmlTextReader 加载文档。

XmlTextReader 使用拉式解析（Java 等效于 StAX）解析 XML，这基本上是 SAX/推式解析的逆。不是在读取新实体时收到通知，而是在准备好时请求文档中的下一个实体（顺便说一句，可以在拉式解析器之上实现 SAX 样式解析器，但不是其他方式大约）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T15:03:32.183

DOM 解析器读取整个 XML 文档并将其构建为内存中对象的层次结构。

SAX 解析器一次读取一个 XML 标记。您提供解析器在遇到文档中的某些类型时应该调用的回调方法。

XMLTextReader 一次读取一个 XML 标记，因此它更接近 SAX，但它不提供回调。

# php - PHP脚本使用共享网络文件夹 - 这可能来自域外吗？

> ID：690114
> 
> 赞同：0
> 
> 时间：2009-03-27T15:00:17.870
> 
> 标签：php, networking, filesystems, dns, system-administration

我有以下困难：三台服务器A，B，C：A，B在同一个网络域中；C 在另一个。在服务器 A 上执行的 PHP 脚本写入服务器 B 上的共享文件夹。在服务器 C 上执行的相同脚本无法写入服务器 B。

PHP 看起来像这样：

```
oject->Output('\\\\serverB\\sharedfolder\\file.dummy'); 
```

有什么办法可以让这个脚本在服务器 C 上优雅地工作？

当我远程桌面到服务器 C 并想查看 的内容时`\\serverB\sharedfolder`，会弹出一个登录提示并要求输入用户名和密码。我可以提供并随后访问服务器 B 上的共享文件夹。但是我怎么能从 PHP 脚本中做到这一点呢？是否可以？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:13:23.783

格式为：

*   北卡罗来纳州—`\\servername\sharename%username:password`
*   网址——`smb://[[domain;]username[:password]@]server[/share[/path]]`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T07:59:53.563

我认为考虑到安全性的最简单的选择是将服务器 C 中的内容写入服务器 A、B 所在的套接字，并有一个附加脚本将从套接字写入的内容保存到您的共享文件夹中...... .

[http://www.php.net/manual/en/function.fsockopen.php](http://www.php.net/manual/en/function.fsockopen.php)

# .net - .Net vs SSIS：SSIS 应该用于什么？

> ID：690123
> 
> 赞同：65
> 
> 时间：2009-03-27T15:03:15.163
> 
> 标签：.net, sql-server, ssis

如果我可以选择使用`.Net`并且可以`transformations`在 .Net 中很好地处理数据，我什么时候需要`SSIS`？有特定的任务`SSIS`会更好吗？透明度带来的额外好处值得吗？这只是我更舒服的吗？确定这一点的最佳实践是什么？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-03-27T15:10:51.587

好问题。

如果传输的数据量巨大？您是否正在处理多个数据文件并需要事务（在文件系统级别和数据库级别）？您是否在处理不同位置的多个数据源（例如 ftp、本地文件系统、数据库）？

如果上面的答案是肯定的，那么继续 ssis。基本上 .net 对于小数据导入/导出工作很酷，但是当你有更复杂的事情时，ssis 绝对是赢家

我看到的另一件事是 - 当 ssis 中的所有内容都可用时，是否值得编写 .net 代码。（不要误会我 - 我喜欢编码）但是，任何你编码的东西，你都需要维护 :-)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-18T12:47:20.640

我认为项目时间/预算限制和使用标准工具是使用 SSIS 的一些最大论据。大多数情况下，创建 SSIS 包比尝试在 .NET 中编写类似代码要快得多。

但话虽如此，SSIS 似乎有很多[痛点](http://ayende.com/Blog/archive/2007/07/15/SSIS-15-Faults.aspx)，有时可能会使这一论点无效。在开发需要在许多不同客户的不同环境中运行的解决方案时，它对我有用。我对项目的评估越多，SSIS 看起来就太痛苦了。正确架构的 .NET 解决方案更易于部署、更可靠、更灵活、更易于理解，并且还可以获得非常好的性能。

恕我直言：考虑将 SSIS 用于只需要部署到一个或两个内部 SQL Server 环境的项目。否则，.NET 方法将很快变得更具吸引力。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2016-10-07T16:01:23.057

我不使用 SSIS 的论点是：

*   设计新产品，以便它们具有 RESTful 数据馈送，用于报告和提取内置到项目计划和预算中，最好是像 OData 这样的标准，以便其他工具可以直接插入。

*   数据馈送应从上游系统和按需馈送中提取和转换；这样调度任务、调度任务的配置、任务运行器虚拟机和运行所有这些不可靠调度内容的人员都会被否定。

*   RESTful 数据馈送利用 HTTP 缓存。

*   提要/服务/API 可以轻松迁移到弹性规模的云。

*   SSIS 需要找到具有 SSIS 技能的人，他们喜欢在几周内做这些事情。以我的经验，寻找和留住 SSIS 开发人员既困难又昂贵，而且找到的人往往低于标准。

*   SSIS 不适用于源代码控制和协作工作。

*   与微服务和传统代码库不同，SSIS 不适合代码重用。

*   与 REST 服务不同，SSIS 不容易版本化。

*   SSIS 不适合模块化设计和许多小变化的持续部署，它往往是大批量和可怕的版本。

*   SSIS 提倡使用存储过程，这对作为热点的 SQL 提出了很多要求。偏爱对可扩展、无状态的中间层提出要求的设计。

*   工具笨重且不可靠。

*   你受制于 Microsoft 的 SSIS 路线图。

*   考虑在数据进入应用程序后立即写入支持分析、报告和视图的表/服务；请参阅事件溯源和其他应用程序架构模式。

*   永远不要使用 Excel 作为数据*源*；培训员工。

*   代码为王。

最终，我将 SSIS 视为企业 IT 的遗物。我想问，“Google 会使用 SSIS 吗？” 还有什么办法可以解决这个问题？创造性思考。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-27T15:13:56.777

我想这取决于你在做什么。SSIS 非常强大，就像旧的 DTS 一样。如果您要加载大量项目并期望不断变化，我会一直使用 SSIS。如果您只想加载几个项目并且它适用于很多客户，我会将其放入代码中。我更喜欢将 SSIS 用于内部 ETL 流程，但当我需要将数据从遗留系统加载到 SQL 数据库中时，我会在客户商店使用 .Net。现在，正如我之前所说，如果你有很多转换和很多不同的数据孤岛要加载，我认为你在 .Net 中这样做会很疯狂，我会去 SSIS。如果您只有几个项目要加载并且它用于单个应用程序并且可能作为应用程序的一部分安装在各种客户端上，那么我会一直使用 .Net。只是我的2美分。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-01-22T11:26:59.513

从小型项目到大型复杂 ETL，我在 SSIS 方面拥有丰富的经验。在不详细说明的情况下，这是我对您的指导：

*   如果您是 DBA 并且您不熟悉 .NET，或者您是非常熟悉 SSIS 的开发人员，那么您可以使用 SSIS 执行小型、简单、相当直接的提取、转换、加载 (ETL) 任务。

*   SSIS 非常古怪，有许多陷阱、陷阱和可能被认为是彻头彻尾的错误。如果您非常熟悉，它会非常强大。

*   C# 现在有 TPL 数据流。简单的性能测试使其领先于 SSIS。（例如[http://mymemoryleaks.blogspot.cz/2013/10/ssis-vs-tpldataflow.html](http://mymemoryleaks.blogspot.cz/2013/10/ssis-vs-tpldataflow.html)）

*   如果您想做一些琐碎的事情，并且如果您可以使用 .NET 技能，请使用 .NET 而不是 SSIS。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T16:34:33.307

SSIS 有许多内置方法可以从不同的数据源进行转换，您可以将它们串在一起，使其非常可定制。他们已经内置优化，使他们快速。

您还可以使用 .NET 进行自己的自定义转换，以利用 SSIS 作业的速度和可重复性。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-10-16T19:41:35.940

我认为主要优点是可视化地定义整个编程结构。任何人看一下 SSIS 包都是自我解释器。与 SSIS 与 SQL 的紧密集成允许您成为 SQL 的一部分，以进行备份调度和巨大的优势。

正如每个人所解释的那样，如果您正在进行大量数据操作，它是一个很好的工具。它是免费的，如果你已经准备好使用 SQL 并且使用 VS 2008 BIDS 很容易学习

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-28T15:38:39.743

回答这个问题有点晚，但我希望它值得，

与编程语言相比，SSIS 经常被误解。SSIS 是一个框架，而 C# 是 .NET Framework 上的一种语言。我在使用（MSBI 套件）处理和开发大型数据仓库解决方案方面拥有丰富的经验，并且还开发了大型网站（ASP.NET）——所以我不能有偏见。

如果使用不当，SSIS 会降低性能。SSIS 包有三种转换：

1.  阻塞转换 - 只有在上述转换完成获取所有行并完成所需的计算时才能传递数据。
2.  半阻塞转换 - 可以传递部分数据
3.  非阻塞 - 一旦准备好就处理该行

通过对控制流和数据流进行适当设置，SSIS 在非阻塞转换方面工作得非常好。我已经在更大（超过 2 TB 的数据仓库）上使用过它，我可以保证这是最快的加载体验。你可以查看微软博客关于[We Loaded 1TB in 30 Minutes with SSIS, So Can You](https://technet.microsoft.com/en-us/library/dd537533(v=sql.100).aspx)

我同意 SSIS 在处理阻塞转换时会降低性能，并且它们应该在需要时由 T-SQL 携带。

谈到 C#，我接受 SSIS 使用 .NET 框架和数据提供程序来完成任务。但是 C# 作为一门语言更符合逻辑，必须处理业务逻辑。例如，如果我们必须根据条件运行具有不同参数的exe，您可以编写一个包，它会考虑参数，然后在逻辑上决定需要传递什么参数来运行一个exe文件。在 SSIS 中执行此操作将是一个漫长的过程，而我可以在 C# 中轻松执行此操作，因为逻辑事情可以很容易地用语言而不是框架来完成。

现在这里的重点是解决问题陈述的更方便的方法。SSIS 无疑是加载大量记录的赢家，将数据从源加载到目标，而 C# 非常适合编写逻辑。即使你喜欢 C#，我也不建议你选择在大型数据仓库系统上进行 ETL（Extract Transform Load）操作。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-06-17T19:19:25.330

SSIS 通常用于 ETL（Extract Transform Load）。具体用例是 SSAS（SQL Server Analysis Services）多维数据集的预处理；并使用 Data Change Capture 增强提取。

它可以进行典型的自动化，包括 FTP 和电子邮件。有使用脚本任务（C# 或 Visual Basic）的编程方面，因此 SSIS 具有超出其包含控件的功能......

可以对包进行编程以使用条件控制流路径。例如，周一到周五执行某项任务，周六和周日执行不同的任务。或者在某些条件不满足的情况下拒绝执行 ETL。

SSIS 包可以调用其他 SSIS 包。这使代码保持模块化，允许重用。

它可以与各种数据源一起工作，并使用派生列控件执行简单的转换。这与在源服务器上进行转换（例如，可能是 Oracle 或 Hadoop - 您无法通过本地 SQL Server 控制的东西）进行转换。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-08-17T20:23:34.563

顾名思义，SSIS 是一个集成系统。在 .net 中处理连接到不同数据源（如 excel、teradata、oracle 等）的连接器以及履行优雅关闭这些连接、垃圾收集、处理内存问题的责任可能非常困难。

因此，SSIS 是开箱即用的产品，非常适合以下场景：数据不仅需要从两个不同的来源中提取，而且还需要在将其写入之前执行一系列查找、转换、合并、推导和计算。目标位置（无论是 sql server、平面文件还是其他数据库系统）。

SSIS 也有检查点，如果包由于任何原因失败，它将从停止的地方继续（需要配置，因为这不是默认行为）。

此外，SSIS 将为您节省大量时间，因为它的任务是可重用的，并且它的部署过程相当容易实施和安排，并得到出色的事件处理的支持。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-06-07T12:52:31.030

基本上，SSIS 具有许多优点，例如将数据从 A 点传输到 B 点以较小的块进行拆分并单独调试它们，能够轻松访问 SQL Server 表，处理 XML 数据，使用 c# 脚本进行 API 调用以及将数据保存在 DB 上，读取 DB远程服务器上的数据和 FTP 等等。
除了一堆已经存在的 BI 块之外，您还可以使用自己的参数和输出创建自己的自定义任务。
希望我能够为已经存在的答案添加一些要点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-04-25T07:48:06.077

**由 SSIS 开发人员使用并且与 .Net 相比相对容易的日常任务可以包括**：

表之间的数据比较。

Conditional Splitting，根据某种逻辑对数据进行数据分块。

数据转换，查找，合并，联合，比较好用。

文件处理（修改、验证）。

错误处理，电子邮件警报。

Containers , FOR/FOReach 循环很容易使用。

使用 WebService 任务很容易在 Web 服务上发布数据。

检查点，数据加载的可重新运行性很容易处理。

ssis 中的调试很容易 - 可以在容器级别、包级别上完成。

如果任务不可用，也可以编写脚本。此外，您可以自定义您自己的任务。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-05-25T00:20:18.467

无论人们在以前的答案中说什么都是正确的，但我认为使用 SSIS 而不是编码的最重要方面是具有易于维护的过程以及可重用的产品。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-05-25T00:31:12.527

SSIS 非常适合 BI 应用程序，您可以在 Stage Table 上操作数据，而不是在 DataWarehouse 表上提供可用于 BI 的数据。

我可以连接 SAP、Oracle 以获取员工信息并在 PowerBI、QlikView 等上可用...

如果您知道在哪里以及为什么使用它，它是一个很好的工具。使用 ir 因为它很酷，你会遇到麻烦。

# sql - 不等连接的使用

> ID：690126
> 
> 赞同：2
> 
> 时间：2009-03-27T15:03:53.307
> 
> 标签：sql, join

在我编写的所有数千个查询中，我可能一方面可以数出我使用非等值连接的次数。例如：

```
SELECT * FROM tbl1 INNER JOIN tbl2 ON tbl1.date > tbl2.date 
```

并且大多数情况下使用另一种方法可能会更好地解决。您遇到过的非等值连接有什么好的/聪明的实际用途吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T15:08:03.403

位掩码浮现在脑海中。在我的一项工作中，我们对存储在数据库中的“对象”（通常对应于代码中的表单或类）拥有特定用户或组的权限。我们通常不会为每个特定权限（读取、写入、读取其他权限、写入其他权限等）包括一行或一列，而是为每个权限分配一个位值。从那里，我们可以使用按位运算符加入以获取具有特定权限的对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T15:16:48.733

如何检查重叠？

```
select ...
from   employee_assignments ea1
,      employee_assignments ea2
where  ea1.emp_id = ea2.emp_id
and    ea1.end_date >= ea2.start_date
and    ea1.start_date <= ea1.start_date 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:17:50.647

date_time 字段中的全天间隔：

date_time_field >= begin_date 和 date_time_field < end_date_plus_1

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-07-14T02:42:33.813

刚刚在 MCTS 70-433（SQL Server 2008 数据库开发）培训工具包书上发现了另一个有趣的不等连接用法。下面逐字逐句。

*通过将派生表与不等连接结合起来，您可以计算各种累积聚合。以下查询返回每个销售人员的订单的运行聚合*（我的注释 - 参考无处不在的 AdventureWorks 示例数据库）：

```
select
    SH3.SalesPersonID,
    SH3.OrderDate,
    SH3.DailyTotal,
    SUM(SH4.DailyTotal) RunningTotal
from
    (select SH1.SalesPersonID, SH1.OrderDate, SUM(SH1.TotalDue) DailyTotal
    from Sales.SalesOrderHeader SH1
    where SH1.SalesPersonID IS NOT NULL
    group by SH1.SalesPersonID, SH1.OrderDate) SH3
join
    (select SH1.SalesPersonID, SH1.OrderDate, SUM(SH1.TotalDue) DailyTotal
    from Sales.SalesOrderHeader SH1
    where SH1.SalesPersonID IS NOT NULL
    group by SH1.SalesPersonID, SH1.OrderDate) SH4
on SH3.SalesPersonID = SH4.SalesPersonID AND SH3.OrderDate >= SH4.OrderDate
group by SH3.SalesPersonID, SH3.OrderDate, SH3.DailyTotal
order by SH3.SalesPersonID, SH3.OrderDate 
```

*派生表用于合并一天内有多个订单的销售人员的所有订单。SalesPersonID 上的联接确保您只为单个销售人员累积行。不等连接允许聚合仅考虑订单日期早于结果集中当前正在考虑的订单日期的销售人员的行。*

在此特定示例中，不等连接正在 SH4 中的每日总计列上创建“滑动窗口”类型的总和。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T15:08:53.153

复制；

```
SELECT
  *
FROM
  table a, (
    SELECT
      id,
      min(rowid)
    FROM 
      table
    GROUP BY
      id
  ) b
WHERE
  a.id = b.id
  and a.rowid > b.rowid; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T16:12:33.810

如果您想将所有产品提供给客户并且不想向他们提供他们已经拥有的产品：

```
SELECT
     C.customer_id,
     P.product_id
FROM
     Customers C
INNER JOIN Products P ON
     P.product_id NOT IN
          (
               SELECT
                    O.product_id
               FROM
                    Orders O
               WHERE
                    O.customer_id = C.customer_id
          ) 
```

但大多数情况下，当我使用非等值连接时，是因为我正在对数据进行某种手动修复。例如，业务告诉我应该为用户表中的一个人提供他们尚未拥有的所有访问角色，等等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T16:15:55.847

如果要对两个不相关的表进行脏连接，可以使用 <> 进行连接。

例如，您可以有一个 Product 表和一个 Customer 表。假设，如果你想向每个客户展示每个产品的列表，你可以这样做：

SELECT * FROM Product p JOIN Customer c on p.SKU <> c.SSN

它可能很有用。但是要小心，因为它可以创建巨大的结果集。

# datetime - 在经典asp中将字符串转换为日期时间

> ID：690132
> 
> 赞同：0
> 
> 时间：2009-03-27T15:06:45.297
> 
> 标签：datetime, asp-classic, vbscript

我有一串“DD/MM/YYYY HH:MM:SS”，我需要将其转换为日期，问题是默认转换为“MM/DD/YYYY HH:MM:SS”，除非日期> 12 在这种情况下它会切换。我想确保我的一天进入日期/时间的一天部分。

有一个简单的解决方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T22:57:16.107

```
' Parse a date in ISO 8601 "universal combined" format: YYYY-MM-DDTHH:MM:SSZ
' This function ALSO accepts SQL date format:  YYYY-MM-DD HH:MM:SS
Function CDateFromUniversal( s )

    CDateFromUniversal = CDate(Mid(s, 1, 10) & " " & Mid(s, 12, 8))

End Function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T15:08:59.300

使用[格式化](http://www.techonthenet.com/excel/formulas/format_date.php)功能

[这也可以](http://classicasp.aspfaq.com/date-time-routines-manipulation/can-i-make-vbscript-format-dates-for-me.html)

# internet-explorer - 如何将 IE7 错误消息“此程序无法显示网页”展开为 Debug？

> ID：690135
> 
> 赞同：0
> 
> 时间：2009-03-27T15:07:49.083
> 
> 标签：internet-explorer, http, fiddler

有没有办法让ie7扩展错误信息“这个程序无法显示网页”？

我已经关闭了友好的错误消息，但这并没有帮助。

背景是间歇性地我在使用 IE7 导航到特定网站时遇到错误。但是我知道服务器已经返回了带有 200 OK HTTP 代码的网页，因为我可以在 fiddler 中看到这一点。如果我从提琴手中取出返回页面的 HTML 代码并保存它，我可以在 IE 中毫无问题地加载它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-17T12:40:09.890

你也可以试试[提琴手](http://www.fiddlertool.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:27:17.060

我不知道如何在 IE7 中调试（我不是 MS 人）。如果它有帮助，听起来您可能遇到[了计时问题](http://www.bsalsa.com/forum/showthread.php?t=373)或干扰了某些防病毒软件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:30:51.530

您可以尝试使用[HttpWatch](http://www.httpwatch.com)。免费的基本版会显示 IE 中出现的错误代码，它可以帮助您诊断此问题。

免责声明：此答案由 HttpWatch 的制造商 Simtec Limited 提供

# javascript - ActionScript3 中的奇怪事件侦听

> ID：690146
> 
> 赞同：0
> 
> 时间：2009-03-27T15:11:30.090
> 
> 标签：javascript, actionscript-3, events

我在 ActionScript 中有一个奇怪的怪癖。我需要将索引传递给回调函数。

这是我的代码

```
for (var i:Number = 0; ((i < arrayQueue.length) && uploading); i++)
{
    var lid:ListItemData=ListItemData(arrayQueue[i]);
    var localI:Number= new Number(i); // to copy?
    var errorCallback:Function = function():void { OnUploadError(localI); };
    var progressCallback:Function = function(e:ProgressEvent):void { lid.progress = e; OnUploadProgress(localI); };
    var completeCallback:Function = function():void { Alert.show('callback'+localI.toString()); OnUploadComplete(localI); }; // localI == arrayQueue.length - 1 (when called)
    Alert.show(localI.toString());  // shows current i as expected
    lid.fileRef.addEventListener(Event.COMPLETE, completeCallback);
    lid.fileRef.addEventListener(ProgressEvent.PROGRESS, progressCallback);
    lid.fileRef.addEventListener(HTTPStatusEvent.HTTP_STATUS, errorCallback);
    lid.fileRef.addEventListener(IOErrorEvent.IO_ERROR, errorCallback);
    lid.fileRef.addEventListener(SecurityErrorEvent.SECURITY_ERROR, errorCallback);

    lid.fileRef.upload(url, 'File');
} 
```

关于如何将索引传递给我的回调的任何想法？`.upload`不阻塞。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T15:15:57.287

可以通过某种委托函数或闭包为回调传递附加参数。然而，这通常被认为是一种不好的做法。您可以改用 event`target`属性来确定基于`FileReference`.

**编辑：**这是使用闭包的示例：

```
function getTimerClosure(ind : int) : Function {
    return function(event : TimerEvent) {
        trace(ind);
    };
}

for (var i = 0; i < 10; i++) {
    var tm : Timer = new Timer(100*i+1, 1);
    tm.addEventListener(TimerEvent.TIMER, getTimerClosure(i));
    tm.start();
} 
```

这将连续跟踪从 0 到 9 的数字。

**Edit2：**这是一个基于函数闭包创建委托的示例：

```
function timerHandler(event : Event, ...rest) : void {
    trace(event, rest);
}

function Delegate(scope : Object, func : Function, ...rest) : Function {
    return function(...args) : void {
        func.apply(scope, args.concat(rest));
    }
}

var tm : Timer = new Timer(1000, 1);
tm.addEventListener(TimerEvent.TIMER, Delegate(this, this.timerHandler, 1, 2, 3));
tm.start(); 
```

然而，这是一种不好的方法，因为取消订阅这样的听众是一种地狱般的痛苦。这反过来可能会导致一些内存泄漏，从而降低应用程序的整体性能。*所以，慎用！*

* * *

**底线：**如果您知道如何使用闭包，请使用它们 - 这是一件很棒的事情！如果您从长远角度不关心您的应用程序性能，请使用闭包 - 这很简单！

但是，如果您不确定闭包，请使用更传统的方法。例如，在您的情况下，您可以创建一个将您的对象与适当的索引`Dictionary`相匹配的。`FileReference`像这样的东西：

```
var frToInd : Dictionary = new Dictionary(false);
// false here wouldn't prevent garbage collection of FileReference objects

for (var i : int = 0; i < 10; i++) {
    // blah-blah stuff with `lib` objects
    frToInd[lib.fileRef] = i;
    // another weird stuff and subscription 
}

function eventListener(event : Event) : void {
    // in the event listener just look up target in the dictionary
    if (frToInd[event.target]) {
        var ind : int = frToInd[event.target];
    } else {
        // Shouldn't happen since all FileReferences should be in 
        // the Dictionary. But if this happens - it's an error.
    }
} 
```

*-- 快乐编码！*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T17:47:50.667

> 我在 ActionScript 中有一个奇怪的怪癖

这不是一个怪癖，它是可变范围。您应该阅读这篇文章：[http ://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7f9d.html#WS5b3ccc516d4fbf351e63e3d118a9b90204-7f8c](http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7f9d.html#WS5b3ccc516d4fbf351e63e3d118a9b90204-7f8c)

而且你真的不应该使用匿名，它只会让一切变得更加混乱。您实际上是在制作同一对象的多个副本。

如果**arrayQueue**在范围内，您可以使用此代码获取索引：

```
GetArrayIndex(e.currentTarget);

function GetArrayIndex(object:Object):Number
{
    for(var i:Number = 0; 0 < arrayQueue.length; i++)
    {
        if(object === arrayQueue[i])
            return i;
    }
} 
```

您应该考虑使用 uint 作为索引。

# html - 为什么 IE 使密码框比文本框小？

> ID：690147
> 
> 赞同：52
> 
> 时间：2009-03-27T15:11:38.777
> 
> 标签：html, css, internet-explorer, rendering

请参阅下面的简单表格。它只是密码框顶部的文本框。如果您在 Internet Explorer 7（和 8，可能还有其他）中查看它，文本框比密码框宽 10 像素。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>IE Text vs. Password test</title>
</head>
<body>                 

<form action="test"> 
  <p>
    <input type="text"><br>  
    <input type="password">      
  </p>
</form>          

</body>
</html> 
```

有没有办法通过CSS或向HTML添加一些东西来全局“修复”这个问题？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-03-27T15:13:59.397

因为在这些类型的字段中使用了不同的字体。

修复只是指定所有输入使用相同的字体。

```
<style type="text/css">
  input {
      font-family: sans-serif;                
  }
</style> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T15:15:08.693

您可以为当前页面上的所有输入附加一个固定宽度：

```
<style type="text/css">
input {
    width: 10em;    
}
</style> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-18T15:22:33.763

问题在于 Internet Explorer 的默认编码。Internet Explorer 在使用 UTF-8 编码时显示字段长度相同时出现问题。在 IE 中，在查看问题页面时尝试将编码更改为“Windows”（IE 8 中的页面-> 编码），您就会明白我的意思。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T15:26:46.480

如果您在页面中包含 jQuery 库，则可以使用以下代码：

“当文档完全加载时，获取 type='text' 的第一个输入元素，并将其高度和宽度应用于 type='password' 的所有输入元素”。

我只在 IE7 上测试过它，它就像一个魅力。

```
<script type="text/javascript" src="jquery-1.3.2.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){

$("input[type='password']").height($("input[type='text']").height());
$("input[type='password']").width($("input[type='text']").width());

});
</script> 
```

这是一个概括的答案（取与 input[type='text'] 匹配的第一个元素）。您可以获取对要匹配的特定元素的引用，然后使用其他一些 jQuery 选择器获取对一个或多个密码框的引用。查看通过 id 获取元素或通过通用 css 类或 xpath 类型表达式获取一组元素的文档：

[http://docs.jquery.com/Selectors](http://docs.jquery.com/Selectors)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T15:15:06.257

设置文本框的宽度可以解决，但我认为这不是你想要的。

尝试将 input[type=text], input[type=password] 的最小宽度设置为大于文本框的默认值。您可能需要[http://deanedwards.me.uk](http://deanedwards.me.uk)的 IE8 脚本来使这些选择器工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T15:21:41.953

字体大小无关紧要。如此处测试所示：http: [//build.jhousemedia.com/ie_test.php](http://build.jhousemedia.com/ie_test.php)

我希望我能给你一个可靠的答案，但解决方法是对其应用固定宽度。

# c# - 删除绑定到控件的图像

> ID：690150
> 
> 赞同：3
> 
> 时间：2009-03-27T15:12:33.037
> 
> 标签：c#, wpf, file-io

我正在编写一个图像管理器 WPF 应用程序。我有一个带有以下 ItemsTemplate 的 ListBox：

```
 <Grid x:Name="grid" Width="150" Height="150" Background="{x:Null}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="27.45"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="150"/>
            </Grid.ColumnDefinitions>
            <Border Margin="5,5,5,5.745" Grid.RowSpan="2" Background="#FF828282" BorderBrush="{DynamicResource ListBorder}" CornerRadius="5,5,5,5" BorderThickness="1,1,2,2" x:Name="border">
                <Grid>
                    <Viewbox Margin="0,0,0,21.705">
                        <Image Width="Auto" Height="Auto" x:Name="picture" Source="{Binding Path=FullName}" />
                    </Viewbox>
                    <TextBlock Height="Auto" Text="{Binding Path=Name}" TextWrapping="Wrap" x:Name="PictureText" HorizontalAlignment="Left" Margin="70,0,0,0" VerticalAlignment="Bottom" />
                </Grid>
            </Border>
        </Grid> 
```

请注意，“Image”控件绑定到“FullName”属性，该属性是表示 JPG 绝对路径的字符串。

一些应用程序功能需要我更改 JPG 文件（移动、重命名或删除）。当我尝试这样做（当前正在尝试移动文件）时，我收到一个 IOException：“该进程无法访问该文件，因为它正在被另一个进程使用。” 锁定文件的进程是我的 WPF 应用程序。

我在网上做了一些搜索，发现有几个帖子表明图像特别难以释放他们的资源。我尝试了以下方法：

1.  将 ListBox.Source 设置为 null
2.  在尝试移动之前添加 10 秒的等待时间。
3.  发出 GC.Collect()。
4.  将操作移动到不同的线程。

我还能尝试什么？我想在 ItemsTemplate 中找到对 Image 对象的引用并尝试处理 Image，但我不知道如何获取该引用。

我读到的一种可能的解决方案是创建图像的副本而不是实际图像，但由于绑定是文件名而不是实际图像，我不知道我是否可以完成这项工作。

任何帮助或建议将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T19:10:42.480

我的[Intuipic](http://intuipic.codeplex.com)应用程序也允许用户删除图像。我必须编写[这个转换器](http://intuipic.codeplex.com/SourceControl/changeset/view/7348#114513)来实现它。相关代码：

```
//create new stream and create bitmap frame
BitmapImage bitmapImage = new BitmapImage();
bitmapImage.BeginInit();
bitmapImage.StreamSource = new FileStream(path, FileMode.Open, FileAccess.Read);
bitmapImage.DecodePixelWidth = (int) _decodePixelWidth;
bitmapImage.DecodePixelHeight = (int) _decodePixelHeight;
//load the image now so we can immediately dispose of the stream
bitmapImage.CacheOption = BitmapCacheOption.OnLoad;
bitmapImage.EndInit();

//clean up the stream to avoid file access exceptions when attempting to delete images
bitmapImage.StreamSource.Dispose(); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-04T15:12:11.717

我将 Kent 的回复标记为答案，我也会标记 Bendewey 的回复，因为我在最终解决方案中使用了它们。

该文件肯定被锁定了，因为文件名是所有被绑定的，所以 Image 控件打开了实际的文件来生成图像。

为了解决这个问题，我创建了一个像 Bendewey 建议的值转换器，然后我使用（大部分）代码形式 Kent 的建议返回一个新的 BitmapImage：

```
 [ValueConversion(typeof(string), typeof(BitmapImage))]
public class PathToBitmapImage : IValueConverter
{
    public static BitmapImage ConvertToImage(string path)
    {
        if (!File.Exists(path))
            return null;

        BitmapImage bitmapImage = null;
        try
        {
            bitmapImage = new BitmapImage();
            bitmapImage.BeginInit();
            bitmapImage.StreamSource = new FileStream(path, FileMode.Open, FileAccess.Read);
            bitmapImage.CacheOption = BitmapCacheOption.OnLoad;
            bitmapImage.EndInit();
            bitmapImage.StreamSource.Dispose();
        }
        catch (IOException ioex)
        {
        }
        return bitmapImage;
    }

    #region IValueConverter Members

    public virtual object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        if (value == null || !(value is string))
            return null;

        var path = value as string;

        return ConvertToImage(path);
    }

    public virtual object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    #endregion
} 
```

然而，正如上面的评论所暗示的，这并没有解决问题。我一直在做其他项目，最近又回到了这个项目，重新振作起来寻找解决方案。

我创建了另一个仅测试此代码的项目，当然它确实有效。这告诉我原来的程序有更多的错误。

长话短说，图像是在三个地方生成的，我认为这已经解决了：

1) ImageList，现在使用转换器绑定。2) 绑定到 ImageList SelectedItem 属性的主图像。3) 使用转换器绑定的 DeleteImage 弹出窗口。

原来问题出在#2。通过绑定到 SelectedItem，我错误地认为我正在绑定到新渲染的图像（基于转换器）。实际上，SelectedItem 对象实际上就是文件名。这意味着通过直接访问文件再次构建主图像。

所以解决方案是将主图像控件绑定到 SelectedItem 属性并使用转换器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T15:25:41.897

在这里查看这篇文章。

[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/dee7cb68-aca3-402b-b159-2de933f933f1/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/dee7cb68-aca3-402b-b159-2de933f933f1/)

**样本**

基本上，您必须使用流预加载图像。我会创建一个 PreLoadImageConverter，像这样，我还没有测试过。

```
<Grid>
  <Grid.Resources>
    <local:PreLoadImageConverter x:Key="imageLoadingConverter" />
  </Grid.Resources>
  <Image Width="Auto" Height="Auto" x:Name="picture" Source="{Binding Path=FullName, Converter={StaticResource imageLoadingConverter}}" />
</Grid> 
```

**PreLoadImageConverter.cs**

```
public class PreLoadImageConverter : IValueConverter
{
  public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
  {
    if (value == null) return null;
    string imagePath = value.ToString();

    ImageSource imageSource;
    using (var stream = new MemoryStream())
    {
      Bitmap bitmap = new Bitmap(imagePath);
      bitmap.Save(stream, System.Drawing.Imaging.ImageFormat.Png);   
      PngBitmapDecoder bitmapDecoder = new PngBitmapDecoder(stream, BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.OnLoad);
      imageSource = bitmapDecoder.Frames[0];
      imageSource.Freeze();
    }
    return imageSource;
  }

  public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
  {
    throw new Exception("The method or operation is not implemented.");
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-09-09T17:57:10.170

这已经很老了，但框架已经改变，解决这个问题要容易得多，至少在 .NET Core 中是这样。

据我所知，BitmapImage.UriSource 过去不是可绑定的。就是现在。只需在 xaml 中明确指定您的图像源。绑定你的 UriSource 并将缓存模式设置为 OnLoad。完毕。无需转换器。

```
<Image Grid.Row="1">
    <Image.Source>
        <!-- specify the source explicitly and set CacheOption to OnLoad to avoid file locking-->
        <BitmapImage UriSource="{Binding ImagePath}" CacheOption="OnLoad" />
    </Image.Source>
</Image> 
```

# ruby - 在 Ruby 中获取 system() 调用的输出

> ID：690151
> 
> 赞同：335
> 
> 时间：2009-03-27T15:12:54.343
> 
> 标签：ruby, system, call

[如果我在 Ruby 中使用Kernel#system](http://ruby-doc.org/core-2.2.0/Kernel.html#method-i-system)调用命令，我如何获得它的输出？

```
system("ls") 
```

* * *

## 回答 #1

> 赞同：372
> 
> 时间：2009-10-14T00:06:15.900

我想稍微扩展和澄清[混乱的答案。](https://stackoverflow.com/a/690174/56763)

如果你用反引号包围你的命令，那么你根本不需要（明确地）调用 system() 。反引号执行命令并将输出作为字符串返回。然后，您可以将值分配给一个变量，如下所示：

```
output = `ls`
p output 
```

或者

```
printf output # escapes newline chars 
```

* * *

## 回答 #2

> 赞同：251
> 
> 时间：2011-05-11T21:25:34.450

请注意，将包含用户提供的值的字符串传递给等的所有解决方案`system`都是`%x[]`不安全的！不安全实际上意味着：用户可以触发代码在上下文中运行，并具有程序的所有权限。

据我所知，`system`并且`Open3.popen3`确实在 Ruby 1.8 中提供了一个安全/转义变体。在 Ruby 1.9`IO::popen`中也接受一个数组。

只需将每个选项和参数作为数组传递给这些调用之一。

如果您不仅需要退出状态，还需要您可能想要使用的结果`Open3.popen3`：

```
require 'open3'
stdin, stdout, stderr, wait_thr = Open3.popen3('usermod', '-p', @options['shadow'], @options['username'])
stdout.gets(nil)
stdout.close
stderr.gets(nil)
stderr.close
exit_code = wait_thr.value 
```

请注意，块形式将自动关闭标准输入、标准输出和标准错误——否则它们必须被[显式关闭](http://www.ruby-doc.org/stdlib-2.0/libdoc/open3/rdoc/Open3.html#method-c-popen3)。

更多信息在这里：[在 Ruby 中形成卫生 shell 命令或系统调用](https://stackoverflow.com/questions/4650636/forming-sanitary-shell-commands-or-system-calls-in-ruby)

* * *

## 回答 #3

> 赞同：177
> 
> 时间：2010-10-17T00:10:39.780

只是为了记录，如果你想要（输出和操作结果）你可以这样做：

```
output=`ls no_existing_file` ;  result=$?.success? 
```

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2013-11-15T12:53:05.603

正确且安全地执行此操作的直接方法是使用[`Open3.capture2()`](http://www.ruby-doc.org/stdlib-2.0.0/libdoc/open3/rdoc/Open3.html#method-c-capture2)、[`Open3.capture2e()`](http://www.ruby-doc.org/stdlib-2.0.0/libdoc/open3/rdoc/Open3.html#method-c-capture2e)或[`Open3.capture3()`](http://www.ruby-doc.org/stdlib-2.0.0/libdoc/open3/rdoc/Open3.html#method-c-capture3)。

如果与不受信任的数据一起使用，在**任何**情况下使用 ruby​​ 的反引号及其`%x`别名都是不安全的。这是**危险**的，简单明了：

 ****```
untrusted = "; date; echo"
out = `echo #{untrusted}`                              # BAD

untrusted = '"; date; echo"'
out = `echo "#{untrusted}"`                            # BAD

untrusted = "'; date; echo'"
out = `echo '#{untrusted}'`                            # BAD 
```

`system`相反，**如果使用正确**，该函数会正确转义参数：

```
ret = system "echo #{untrusted}"                       # BAD
ret = system 'echo', untrusted                         # good 
```

麻烦的是，它返回退出代码而不是输出，并且捕获后者是复杂和混乱的。

到目前为止，该线程中的最佳答案提到了 Open3，但没有提到最适合该任务的功能。`Open3.capture2`,`capture2e`并`capture3`像 一样工作`system`，但返回两个或三个参数：

```
out, err, st = Open3.capture3("echo #{untrusted}")     # BAD
out, err, st = Open3.capture3('echo', untrusted)       # good
out_err, st  = Open3.capture2e('echo', untrusted)      # good
out, st      = Open3.capture2('echo', untrusted)       # good
p st.exitstatus 
```

另一个提到[`IO.popen()`](http://www.ruby-doc.org/core-2.0.0/IO.html#method-c-popen). 语法可能很笨拙，因为它需要一个数组作为输入，但它也可以：

```
out = IO.popen(['echo', untrusted]).read               # good 
```

* * *

为方便起见，您可以包装`Open3.capture3()`一个函数，例如：

```
#
# Returns stdout on success, false on failure, nil on error
#
def syscall(*cmd)
  begin
    stdout, stderr, status = Open3.capture3(*cmd)
    status.success? && stdout.slice!(0..-(1 + $/.size)) # strip trailing eol
  rescue
  end
end 
```

例子：

```
p system('foo')
p syscall('foo')
p system('which', 'foo')
p syscall('which', 'foo')
p system('which', 'which')
p syscall('which', 'which') 
```

产生以下结果：

```
nil
nil
false
false
/usr/bin/which         <— stdout from system('which', 'which')
true                   <- p system('which', 'which')
"/usr/bin/which"       <- p syscall('which', 'which') 
```

* * *

## 回答 #5

> 赞同：62
> 
> 时间：2010-11-25T16:04:59.043

您可以使用 system() 或 %x[] 取决于您需要什么样的结果。

如果命令找到并成功运行，system() 返回 true，否则返回 false。

```
>> s = system 'uptime'
10:56  up 3 days, 23:10, 2 users, load averages: 0.17 0.17 0.14
=> true
>> s.class
=> TrueClass
>> $?.class
=> Process::Status 
```

另一方面，%x[..] 将命令的结果保存为字符串：

```
>> result = %x[uptime]
=> "13:16  up 4 days,  1:30, 2 users, load averages: 0.39 0.29 0.23\n"
>> p result 
"13:16  up 4 days,  1:30, 2 users, load averages: 0.39 0.29 0.23\n"
>> result.class
=> String 
```

Jay Fields[的博客文章](http://blog.jayfields.com/2006/06/ruby-kernel-system-exec-and-x.html)详细解释了使用 system、exec 和 %x[..] 之间的区别。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2012-07-04T10:36:15.203

如果您需要转义参数，在 Ruby 1.9 中[IO.popen](http://www.ruby-doc.org/core-1.9.3/IO.html#method-c-popen)也接受一个数组：

```
p IO.popen(["echo", "it's escaped"]).read 
```

在早期版本中，您可以使用[Open3.popen3](http://www.ruby-doc.org/stdlib-1.9.3/libdoc/open3/rdoc/Open3.html#method-c-popen3)：

```
require "open3"

Open3.popen3("echo", "it's escaped") { |i, o| p o.read } 
```

如果您还需要传递标准输入，这应该适用于 1.9 和 1.8：

```
out = IO.popen("xxd -p", "r+") { |io|
    io.print "xyz"
    io.close_write
    io.read.chomp
}
p out # "78797a" 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2009-03-27T15:17:37.750

您使用反引号：

```
`ls` 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-03-27T15:23:20.810

另一种方法是：

```
f = open("|ls")
foo = f.read() 
```

请注意，这是打开时“ls”之前的“管道”字符。这也可用于将数据输入程序标准输入以及读取其标准输出。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2010-03-02T02:11:23.757

如果您需要返回值，我发现以下内容很有用：

```
result = %x[ls]
puts result 
```

我特别想列出我机器上所有 Java 进程的 pid，并使用了这个：

```
ids = %x[ps ax | grep java | awk '{ print $1 }' | xargs] 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2013-05-16T22:47:47.690

虽然使用反引号或 popen 通常是您真正想要的，但它实际上并不能回答所提出的问题。捕获输出可能有正当理由`system`（可能是为了自动化测试）。一点谷歌搜索[出现了一个答案](http://www.velocityreviews.com/forums/t812652-redirect-stdout-for-kernel-system.html)，我想我会在这里发布以造福他人。

因为我需要这个来测试我的示例使用块设置来捕获标准输出，因为实际`system`调用隐藏在被测试的代码中：

```
require 'tempfile'

def capture_stdout
  stdout = $stdout.dup
  Tempfile.open 'stdout-redirect' do |temp|
    $stdout.reopen temp.path, 'w+'
    yield if block_given?
    $stdout.reopen stdout
    temp.read
  end
end 
```

此方法使用临时文件捕获给定块中的任何输出以存储实际数据。示例用法：

```
captured_content = capture_stdout do
  system 'echo foo'
end
puts captured_content 
```

您可以用`system`内部调用的任何内容替换调用`system`。如果需要，您也可以使用类似的方法进行捕获`stderr`。

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2014-01-12T05:20:05.277

正如[Simon Hürlimann 已经解释](https://stackoverflow.com/a/5970819/165673)的那样，[Open3](http://www.ruby-doc.org/stdlib-2.0/libdoc/open3/rdoc/Open3.html#method-c-popen3)比反引号等更安全。

```
require 'open3'
output = Open3.popen3("ls") { |stdin, stdout, stderr, wait_thr| stdout.read } 
```

请注意，块形式将自动关闭标准输入、标准输出和标准错误——否则它们必须被[显式关闭](http://www.ruby-doc.org/stdlib-2.0/libdoc/open3/rdoc/Open3.html#method-c-popen3)。

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2013-05-26T04:58:41.497

如果您希望使用 将输出重定向到文件`Kernel#system`，您可以像这样修改描述符：

以附加模式将 stdout 和 stderr 重定向到文件（/tmp/log）：

`system('ls -al', :out => ['/tmp/log', 'a'], :err => ['/tmp/log', 'a'])`

对于长时间运行的命令，这将实时存储输出。您还可以使用 IO.pipe 存储输出并将其从 Kernel#system 重定向。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2010-03-04T14:24:58.507

作为直接的 system(...) 替代品，您可以使用 Open3.popen3(...)

进一步讨论： [http ://tech.natemurray.com/2007/03/ruby-shell-commands.html](http://tech.natemurray.com/2007/03/ruby-shell-commands.html)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-12-06T19:00:10.277

将标准输出捕获到名为**val**的变量中的最简单解决方案：

```
val = capture(:stdout) do
  system("pwd")
end

puts val 
```

缩短版：

```
val = capture(:stdout) { system("ls") } 
```

**捕获**方法由 *active_support/core_ext/kernel/reporting.rb 提供*

同样，我们也可以捕获标准错误`:stderr`

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-02-27T15:39:15.493

我在这里没有找到这个，所以添加它，我在获得完整输出时遇到了一些问题。

> 如果要使用反引号捕获 STDERR，可以将 STDERR 重定向到 STDOUT。
> 
> 输出 = `grep hosts /private/etc/* 2>&1`

来源：[http ://blog.bigbinary.com/2012/10/18/backtick-system-exec-in-ruby.html](http://blog.bigbinary.com/2012/10/18/backtick-system-exec-in-ruby.html)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2016-03-08T02:35:52.040

```
puts `date`
puts $?

Mon Mar  7 19:01:15 PST 2016
pid 13093 exit 0 
```

# java - 使应用程序从 MySQL 数据库中检索数据

> ID：690152
> 
> 赞同：0
> 
> 时间：2009-03-27T15:13:06.810
> 
> 标签：java, mysql, database, delphi

我正在寻找一个应用程序来显示 MySQL 数据库中的某些内容。他们应该按照接下来的顺序排列。用户将设置事件应该发生的时间，以及它的名称。然后，该信息将进入 MySQL 数据库，并与应用程序中的其他事件一起显示。我打算把它做成 Java 或 Delphi。有什么想法更适合这种项目吗？有人有这方面的好教程吗？

编辑：我也应该说明这一点。UI 并没有什么花哨的东西，而是一个说明接下来要发生的几个事件的框，以及一个提交事件按钮，用户可以将他们自己的事件提交到数据库中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T15:59:01.347

[下面](http://delphi.about.com/od/mysql/MySQL_with_Delphi.htm)是一些关于如何从 Delphi 连接到 MySQL 的教程。Delphi 优于 Java 的优势在于它不需要在客户端机器上安装任何额外的软件（Java 本身）。除此之外，您可能应该选择您最喜欢的那个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T15:34:31.390

如果您想在 Java 中快速（如快速开发），您可以查看[本教程](http://www.netbeans.org/kb/60/java/gui-db.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T15:46:03.533

很确定 NetBeans IDE 有一个用于数据库驱动应用程序的项目模板。我自己从未使用过它，但 NetBeans 示例通常非常好，因此可能值得一试。就像 Elie 说的，我怀疑如果你使用 Java 或 Delphi 会有很大的不同。如果您没有 Java 经验，请使用您最熟悉的那个。显然有偏见:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T21:29:50.693

如果您想知道语言选择，我会说选择 Delphi，原因有两个。

1.  正如 Lars 提到的，它没有外部依赖项。
2.  数据库连接一直是 Delphi 的强项之一。哎呀，这就是名字的由来！他们这样称呼它，因此人们很容易将它与 Oracle 联系起来，Oracle 是 Delphi 全新时最流行的数据库系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T15:24:31.180

您的描述听起来像是小型数据库模式的基本 UI 前端。使用您更熟悉的语言。一旦你选择了一种语言，对一些 ORM 框架的基本搜索将为你提供一些相当简单的方法来将你的数据库连接到 UI。几乎任何关于 Java 或 Delphi 的书都会有一个如何做到这一点的例子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T18:27:36.170

您应该首先决定使用哪种语言，因为它们都有完全不同的方式连接到 MySQL 数据库。（当然，在某些层面上它们基本相同:)）

即使仅在 Delphi [仅限 Java] 中，也有多种方法可以从数据库中读取。（ORM、纯 JDCB、TDataSet、原生 MySQL 库，...）

然后你应该问两个具体的（=新的）问题：

1.  如何使用 Java 从 MySQL 数据库加载数据。
2.  如何使用 Delphi 从 MySQL 数据库中加载数据。

# java - JPA 映射文件教程

> ID：690155
> 
> 赞同：4
> 
> 时间：2009-03-27T15:13:57.667
> 
> 标签：java, jakarta-ee, jpa, mapping

是否有关于如何使用 JPA 映射文件的精彩教程？附带映射文件的相关源代码也很棒。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T15:51:01.133

[简单教程](http://www.roseindia.net/hibernate/hibernateannotations/hibernate-annotations-tutorial.shtml)

[更深入的教程](http://schuchert.wikispaces.com/JPA+Tutorial+1+-+Getting+Started)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-12T20:11:39.247

还有一个很好的文档。关于这里的不同实体配置：http: [//docs.jboss.org/hibernate/stable/entitymanager/reference/en/html_single/#configuration](http://docs.jboss.org/hibernate/stable/entitymanager/reference/en/html_single/#configuration)

# c# - iTunes SDK：加载共享音乐

> ID：690157
> 
> 赞同：6
> 
> 时间：2009-03-27T15:14:07.867
> 
> 标签：c#, .net, itunes-sdk

我一直在用 C# 弄乱 .NET 3.5 下的 iTunes SDK，但我还没有找到从网络上的另一台计算机加载共享音乐库的方法。有谁知道我如何从 iTunes SDK 访问共享音乐？如果这是不可能的，那么任何人都可以提出替代方案吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T19:08:28.967

这是一些获取共享库的示例 C# 代码。

```
iTunesLib.IiTunes iTunesApp;
iTunesApp = new iTunesLib.iTunesAppClass();
iTunesLib.IITSourceCollection iSources = iTunesApp.Sources;
foreach (iTunesLib.IITSource iSource in iSources)
{
  if (iSource.Kind.Equals(iTunesLib.ITSourceKind.ITSourceKindSharedLibrary))
  {
    //Do AwesomeStuffHere!
  }
} 
```

# automation - 使用 C# 自动化两个不同浏览器应用程序之间的功能和移动？

> ID：690160
> 
> 赞同：1
> 
> 时间：2009-03-27T15:15:03.700
> 
> 标签：automation, webbrowser-control

我是新手。因此，如果我含糊不清或不够具体而无法提供帮助，请原谅我，请告诉我，以便我澄清。

我使用 2 个不同的应用程序来工作，并且会对一个小工具来自动化某些功能感兴趣。1\. 我们使用的基于 IP 的电话系统。我们必须从一个网络浏览器复制和粘贴数字（始终位于同一字段，文本区域）并选择几个按钮 2\. 抵押申请终端通过网络浏览器运行。

我想单击一个按钮，让它从抵押服务应用程序的字段中复制文本（即数字），然后将该信息粘贴到我们电话系统的另一个浏览器上的文本框中，并从几个不同的单选按钮中进行选择，点击下一个按钮，然后它会拨号。

我们的系统如此缓慢，点击次数过多，我希望如果没有超高级的编程知识，这将是可行的。尖端？

我从 VBScript 中查看的一个脚本显示了摘录......（我做过温和的 VBA，但不是 Vbscript 大师！）

这是可能的，还是我坚持单独点击所有内容？

```
Dim at99999Tool, atlDirectorObject   
Dim strErrMsg   
Dim strScreenName   
Dim strLoanNumber   

Const S_OK=0  
Const DELAY=60  
Const QUOTES = """"   

subGetSession   
strScreenName=Wscript.Arguments(0)   
strLoanNumber=Wscript.Arguments(1)   
subGoToScreen strScreenName, "********", strLoanNumber   

subTerminateScript 3, ""   

more functions etc...   

Sub subGetSession()   

  Set atlDirectorObject = CreateObject("atlDirectorObject.atlDirector")   
  If atlDirectorObject.CreateTool("9999", 1, True, True, 0, atl3299Tool, strErrMsg) <> S_OK Then   
     subTerminateScript 2, strErrMsg   
  End If   
End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:19:22.957

查看这篇关于使用 PowerShell 实现 Web 界面自动化的文章。

[MSDN 杂志：使用 Windows PowerShell 实现 Web UI 自动化](http://msdn.microsoft.com/en-us/magazine/cc337896.aspx?pr=blog)

# php - PHP中是否存在此功能？

> ID：690164
> 
> 赞同：5
> 
> 时间：2009-03-27T15:15:30.250
> 
> 标签：php, string

我发现自己需要这个函数，并且想知道它是否已经存在于 PHP 中。

```
/**
 * Truncates $str and returns it with $ending on the end, if $str is longer
 * than $limit characters
 *
 * @param string $str
 * @param int $length
 * @param string $ending
 * @return string
 */
function truncate_string($str, $length, $ending = "...")
{
    if (strlen($str) <= $length)
    {
        return $str;
    }
    return substr($str, 0, $length - strlen($ending)).$ending;
} 
```

因此，如果限制为 40 并且字符串是“The quick fox jumped over the lazy brown dog”，则输出将是“The quick fox jumped over the lazybrow ...”。这似乎是 PHP 中存在的那种东西，所以当我找不到它时我很惊讶。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T15:19:32.427

```
$suffix = '...';
$maxLength = 40;

if(strlen($str) > $maxLength){
  $str = substr_replace($str, $suffix, $maxLength);
} 
```

您的实现可能会略有不同，具体取决于后缀的长度是否应计入总字符串长度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T15:22:41.513

这是有兴趣的人的单行版本

```
<?php 
    echo (strlen($string) > 40 ? substr($string, 0, 37)."..." : $string);
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T15:18:12.287

不，它不存在。但是，许多库都提供了它，因为您不是第一个需要它的人。例如聪明的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T15:18:27.577

它没有。

# c# - Oracle + C# 图片

> ID：690166
> 
> 赞同：0
> 
> 时间：2009-03-27T15:16:11.933
> 
> 标签：c#, oracle, oracle10g

如何将图片插入 Oracle 数据库 Oracle ？

我可以获得 C# 示例代码吗？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T15:23:45.833

有[一篇文章](http://www.c-sharpcorner.com/UploadFile/ehanth/Csharpdatabse03142006093738AM/Csharpdatabse.aspx?ArticleID=c3fef0d2-f165-4384-a788-cdb860922d8a)展示了如何做到这一点。

# gwt - GWT：如何避免在生成的 JavaScript 代码中调用 dynamicCast 和 canCastUnsafe？

> ID：690169
> 
> 赞同：7
> 
> 时间：2009-03-27T15:16:54.710
> 
> 标签：gwt

我正在用 Java 编写一些用于浏览器的特殊用途数据结构（使用 GWT 编译为 JavaScript）。

我正在尝试匹配一些内置 JDK 类的性能我注意到事情运行得相当快，但是当我将我的代码跟踪与一些模拟的 JDK 代码进行比较时，我有很多对 dynamicCast 和 canCastUnsafe 的调用，而 JDK 模拟的类没有。它也只是解释了性能的差异......

那里有任何 GWT 大师知道如何避免这种情况吗？这相当于 20% 的开销:-(

细节：

这是将 0 到 100,000 之间的 10,000 次随机整数插入两种不同数据结构的配置文件输出（在 Firebug 中捕获）：

谷歌的 java.util.TreeMap 的 TreeMap 实现（红黑树）：

```
Profile (4058.602ms, 687545 calls)
Function              Calls      Percent   Own Time
$insert_1             129809     41.87%    1699.367ms
$compare_0            120290     16%        649.209ms
$isRed                231166     13.33%     540.838ms
compareTo_0           120290      8.96%     363.531ms
$put_2                 10000      6.02%     244.493ms
wrapArray              10000      3.46%     140.478ms
createFromSeed         10000      2.91%     118.038ms
$TreeMap$Node          10000      2.38%      96.706ms   
initDim                10000      1.92%      77.735ms   
initValues             10000      1.49%      60.319ms   
$rotateSingle           5990      0.73%      29.55ms  
TreeMap$Node           10000      0.47%      18.92ms 
```

我的代码（AVL 树）：

```
Profile (5397.686ms, 898603 calls)
Function              Calls      Percent   Own Time
$insert               120899     25.06%    1352.827ms
$compare              120899     17.94%      968.17ms
dynamicCast           120899     14.12%     762.307ms <--------
$balanceTree          120418     13.64%     736.096ms
$setHeight            126764      8.93%     482.018ms
compareTo_0           120899      7.76%     418.716ms
canCastUnsafe         120899      6.99%     377.518ms <--------
$put                   10000      2.59%     139.936ms
$AVLTreeMap$Node        9519      1.04%      56.403ms   
$moveLeft               2367      0.36%      19.602ms   
AVLTreeMap$State        9999      0.36%      19.429ms   
$moveRight              2378      0.34%      18.295ms   
AVLTreeMap$Node         9519      0.34%      18.252ms   
$swingRight             1605      0.26%      14.261ms   
$swingLeft              1539      0.26%      13.856ms 
```

其他意见：

*   我制作的另一个数据结构（SkipList）也存在同样的问题。
*   在比较函数中应用了 dynamicCast：

    cmp = dynamicCast(right.key, 4).compareTo$(key);

*   如果类没有实现 Map，dynamicCast 就会消失（即：只是从类中删除“implements Map”。无论是通过接口访问还是直接访问它都没有关系。这会导致同一行编译为：

    cmp = right.key.compareTo$(key);

这是 SkipList 中 Java 源代码的相关部分：

```
private int compare(Node a, Object o) {
    if (comparator != null)
        return comparator.compare((K) a.key, (K) o);

    return ((Comparable<K>) a.key).compareTo((K) o);
}

public V get(Object k) {
    K key = (K) k;
    Node<K, V> current = head;

    for (int i = head.height - 1; i >= 0; i--) {
        Node<K, V> right;

        while ((right = current.right[i]) != null) {
            int cmp = compare(right, key);

            ...
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T15:12:24.167

不幸的是，我仍然不清楚原因，但根据我的经验，它似乎来自明确的演员，例如：

```
((Comparable) obj).compareTo(other) 
```

生成的 Javascript 如下所示：

```
dynamicCast(obj, 1).compareTo(other); 
```

其中 1 是生成的 typeId，表示演员表的目标。dynamicCast 依次调用 canCastUnsafe，如果为 false，则抛出 ClassCastException。this 的价值一直存在[争议](http://groups.google.com/group/Google-Web-Toolkit-Contributors/browse%5Fthread/thread/141fa4dc51d3a6f6/a89c9616b69efd54)，因为这已经被托管模式捕获了。

可以使用 JSNI 避开它：

```
public static native int compare(Object a, Object b) /*-{
    return a.@java.lang.Comparable::compareTo(Ljava/lang/Object;)(b); 
}-*/; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T20:53:56.677

不知道你是否在 GWT 贡献者的论坛中看到过[这个帖子......](http://groups.google.com/group/Google-Web-Toolkit-Contributors/browse_thread/thread/141fa4dc51d3a6f6/a89c9616b69efd54)

基本上，它从您发现的相同问题开始，提出了一些新的编译器标志，然后继续展示如何使用一些 JSNI 来绕过强制转换。

**编辑**在 GWT 主干中有一个新的编译器标志。见[维基](http://code.google.com/p/google-web-toolkit/wiki/NoCastCheckingOptimization)...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-27T10:25:59.280

*GWT 2.1 及更高版本的更新答案：*

从 GWT 2.1 开始（至少这是第一次提到），GWT 编译器有一个新的编译器参数`-XdisableCastChecking`，称为禁用所有运行时强制转换检查。注意，这个选项被标记为实验性的（可能是因为这会使类转换异常很难调试）。

在我的应用程序`dynamicCast`中，在简短的配置文件运行中被调用了数千次，并且是 Firebug 分析器中第三大最耗时的方法。使用此编译器参数可显着减少 Chrome Speed Tracer 中“长时间事件”消息的数量。

有关此参数和其他编译器参数，请参阅[GWT 编译器选项](http://code.google.com/webtoolkit/doc/latest/DevGuideCompilingAndDebugging.html#DevGuideCompilerOptions)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-14T22:04:35.433

这绝对是一个编译器问题：我在以下行有问题：

```
final DefaultIconedSuggestBox<SuggestValueProxy, IconedValueHolderItem<SuggestValueProxy>> fieldValueWidget = getCategoryWidget().getFieldValueWidget(); 
```

我真的不知道如何解决它：这条线发生在我从一个模块更改为另一个模块的那一刻（它可能与代码拆分器问题有关：即使我没有使用代码拆分：我我只是用另一个模块加载另一个页面）

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-31T15:04:04.050

使用 java 1.5 泛型和通配符可以避免这种情况吗？

# python - 为什么在 django 1.0.2 和 Python 2.5 中不能识别关键字 DateField.input_formats？

> ID：690171
> 
> 赞同：6
> 
> 时间：2009-03-27T15:17:13.087
> 
> 标签：python, django

使用 django 1.0.2 和 Python 2.5，当我使用关键字时`DateField.input_formats`，我收到错误，即`__init__()`得到了一个意想不到的关键字参数`'input_formats'`。当我查看`__init__`文件时，我不认为`input_formats`这是可接受的关键字参数之一。

我认为它`input_formats`已经存在了足够长的时间，它应该在那里。`input_formats`此配置不支持关键字吗？如果没有，我如何获得`__init__`支持它的更新？谢谢你。

正如评论中所建议的，我在下面添加了代码。我怀疑问题是我混淆了`DateField`表格和`DateField`模型，但如果有人能证实这一点，我会很高兴。

```
from django.db import models

class Payment(models.Model):
    date_paid = models.DateField(blank=True, db_index=True, input_formats=['%m/%d/%y']) 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-31T14:11:30.760

看过文档后，就像您怀疑的那样，[models.DateField](http://docs.djangoproject.com/en/dev/ref/models/fields/#datefield)没有 input_formats，但[forms.DateField](http://docs.djangoproject.com/en/dev/ref/forms/fields/#datefield)有（就像 forms.DateTimeField 一样）

# c++ - C/C++：优化指向字符串常量的指针

> ID：690176
> 
> 赞同：15
> 
> 时间：2009-03-27T15:17:56.393
> 
> 标签：c++, c, optimization, string, constants

看看这段代码：

```
#include <iostream>
using namespace std;

int main()
{
    const char* str0 = "Watchmen";
    const char* str1 = "Watchmen";
    char* str2 = "Watchmen";
    char* str3 = "Watchmen";

    cerr << static_cast<void*>( const_cast<char*>( str0 ) ) << endl;
    cerr << static_cast<void*>( const_cast<char*>( str1 ) ) << endl;
    cerr << static_cast<void*>( str2 ) << endl;
    cerr << static_cast<void*>( str3 ) << endl;

    return 0;
} 
```

产生这样的输出：

```
0x443000
0x443000
0x443000
0x443000 
```

这是在*Cygwin下运行的**g++*编译器上。即使没有开启优化，指针也都指向同一个位置 ( )。*`-O0`*

 *编译器是否总是优化得如此之多，以至于它会搜索所有字符串常量以查看它们是否相等？可以依赖这种行为吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-27T15:47:30.703

不能依赖它，它是一种优化，不是任何标准的一部分。

我已将您的代码的相应行更改为：

```
const char* str0 = "Watchmen";
const char* str1 = "atchmen";
char* str2 = "tchmen";
char* str3 = "chmen"; 
```

-O0 优化级别的输出是：

```
0x8048830
0x8048839
0x8048841
0x8048848 
```

但对于 -O1 它是：

```
0x80487c0
0x80487c1
0x80487c2
0x80487c3 
```

如您所见，GCC (v4.1.2) 在所有后续子字符串中重用了第一个字符串。编译器选择如何在内存中排列字符串常量。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-27T15:36:19.327

这是一个非常简单的优化，可能如此之多以至于大多数编译器编写者甚至根本不认为它是一种优化。毕竟，将优化标志设置为最低级别并不意味着“完全天真”。

编译器在合并重复字符串文字方面的积极程度会有所不同。它们可能会将自己限制在一个子例程中——将这四个声明放在不同的函数中而不是单个函数中，您可能会看到不同的结果。其他人可能会做一个完整的编译单元。其他人可能依赖链接器在多个编译单元之间进行进一步合并。

你不能依赖这种行为，除非你的特定编译器的文档说你可以。语言本身在这方面没有任何要求。即使不关心可移植性，我也会对在自己的代码中依赖它持谨慎态度，因为即使在单个供应商编译器的不同版本之间，行为也可能发生变化。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-27T15:28:18.207

您当然*不应该*依赖这种行为，但大多数编译器都会这样做。任何文字值（“Hello”、42 等）都将存储一次，任何指向它的指针都会自然地解析为该单一引用。

如果您发现需要依赖它，请确保安全并重新编码如下：

```
char *watchmen = "Watchmen";
char *foo = watchmen;
char *bar = watchmen; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-27T16:04:00.493

你当然不应该指望这一点。优化器可能会对您做一些棘手的事情，应该允许它这样做。

然而，这*很*常见。我记得在 87 年，一位同学在使用 DEC C 编译器时遇到了一个奇怪的错误，他所有的字面值 3 都变成了 11（数字可能已经改变以保护无辜者）。他甚至做了一个`printf ("%d\n", 3)`并打印了`11.`

他打电话给我，因为这太奇怪了（为什么这会让人们想起我？），经过大约 30 分钟的挠头，我们找到了原因。大致是这样的一行：

```
if (3 = x) break; 
```

注意单个“=”字符。是的，那是一个错字。编译器有一个小错误并允许这样做。其效果是将他在整个程序中的所有字面值 3 变成当时恰好在 x 中的任何内容。

无论如何，很明显 C 编译器将所有文字 3 放在同一个地方。如果 80 年代的 C 编译器能够做到这一点，那也不会太难做到。我希望它会很常见。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-27T15:37:02.040

我不会依赖这种行为，因为我怀疑 C 或 C++ 标准是否会明确这种行为，但编译器这样做是有道理的。即使在没有为编译器指定任何优化的情况下，它也表现出这种行为也是有道理的；没有任何取舍。

C 或 C++ 中的所有字符串文字（例如“字符串文字”）都是只读的，因此是常量。当你说：

```
char *s = "literal"; 
```

从某种意义上说，您将字符串*向下转换*为非常量类型。然而，您不能取消字符串的只读属性：如果您尝试操作它，您将在运行时而不是在编译时被捕获。`const char *`（在将字符串文字分配给您的变量时，这实际上是一个很好的理由。）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T15:21:09.630

不，不能依赖它，但是将只读字符串常量存储在池中是一种非常简单且有效的优化。只需存储按字母顺序排列的字符串列表，然后在最后将它们输出到目标文件中。想想平均代码库中有多少“\n”或“”常量。

如果编译器想要更加花哨，它也可以重用后缀：“\n”可以通过指向“Hello\n”的最后一个字符来表示。但这可能对复杂性的显着增加几乎没有好处。

无论如何，我不相信标准说明了任何东西的真正存储位置。这将是一个非常特定于实现的事情。如果您将其中两个声明放在单独的 .cpp 文件中，那么情况也可能会发生变化（除非您的编译器进行重要的链接工作。）

# java - 保证 Java 客户端可以使用 .NET WCF 服务

> ID：690177
> 
> 赞同：14
> 
> 时间：2009-03-27T15:18:11.383
> 
> 标签：java, .net, wcf

我正在创建将由 .NET 和 Java 客户端应用程序使用的 WCF 服务。

我们在团队中没有任何 Java 经验，因此正在寻找要遵循的指南或规则，以确保我们不会意外在 WCF 服务接口中包含任何类型或做任何其他会阻止它被 Java 客户端使用的事情应用。

我们的担心有根据吗？如果是这样，我们应该警惕什么？

## 编辑

一个值得关注的例子是 .NET`DateTime`值是否以 Java 客户端可以正确理解的方式在服务接口中表示。

## 编辑2

第二个问题的例子是使用任何可以为空的值类型（`bool?`等`int?`）。

## 编辑3

目前我们的一些开发团队正在手写.xsd 文件来定义WCF 接口方法将作为参数并作为返回值返回的各种对象。然后他们使用 xsd.exe 从这些文件中自动生成 C# 类。

这背后的基本原理是它保证生成的类不会包含任何特定于 .NET 的内容。

缺点是这增加了开发负担，也使我们无法使用`<summary>`标记（.NET 等效于 javadoc 注释）记录这些类。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-29T01:21:38.820

从 XSD 开始的建议是一个很好的建议。这并不能保证双方的兼容性，因为 XML Schema 非常大，而且没有 Web 服务堆栈支持所有这些。（例如：列表）。

因此，从 XSD 开始，但仅限于主流类型。基元，由基元组成的复杂类型，相同的数组。您可以安全地嵌套复杂类型和数组。（复杂类型的数组、包含数组或复杂类型的复杂类型等）。

远离限制、替换组、列表、派生和任何其他 XSD 秘密。甚至应该避免使用 XSD 枚举。

关于日期时间：仅使用可为空的日期时间是不够的。还有格式问题。.NET DateTime 比 Java 日历具有更高的分辨率，因此，将 .NET 时间传送到 Java 可能会导致 Java 端出现反序列化异常。（**编辑：**在.NET 端的 XmlElement 属性中使用 DataType="dateTime" 装饰器可以确保您正确序列化）

[一些旧的建议](http://blogs.msdn.com/dotnetinterop/archive/2005/12/06/interop-and-datetime-formatting.aspx)。

最后，不能在生成的类上使用代码内 XML 文档是不正确的。使用 C# 的部分类，您可以使用所需的代码内文档从生成的类中编写单独的代码。即使您重新生成代码，您的部分类代码也将保持不变。**编辑：**编译时，文档将出现在类中。

**编辑：**有人问，如果使用 XSD-first 不足以保证互操作，为什么要使用它？我的回答：这不是保证，但这是一个很好的步骤，它有帮助。它使您远离在代码中设计接口（Java 或 C# 或 VB 等），这些接口暴露了特定于平台的东西，如 .NET 数据集、通用字典、Java ResultSet 等，所有这些都存在互操作问题。XSD 的边缘部分仍然存在缺陷，但您通常可以避免那些经过深思熟虑的设计。

我应该在我的原始答案中提到，您可以将迭代过程应用于接口的开发。在 XSD 中设计，然后从 XSD+WSDL 生成（客户端）存根和（服务器）骨架代码，然后调整并再次执行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T15:25:58.043

使用[basicHttpBinding](http://msdn.microsoft.com/en-us/library/ms731361.aspx)端点将保证任何 SOAP 1.1 兼容的客户端都能够使用您的服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T15:53:52.123

使用 DateTime?，即可以为空的结构。Java 没有复杂值类型（即结构）的概念。我相信有一些方法可以在 WSDL 中指定不允许空值，但我认为 WCF 并没有开箱即用。

使用数组而不是集合。如果我没记错的话，集合类型在 SOAP 上的转换效果不是很好，但数组类型做得很好。

您应该得到一份 Eclispe 或 Netbeans 的副本。创建原型 WCF 服务后，运行 Web 服务向导来创建代理。检查对象模型是否存在任何重大缺陷，特别强调复杂对象或非原始类型（将字符串视为原始类型）。

使用 Netbeans 或 Eclipse 做这件事的学习曲线相当平坦，所以这不是一个巨大的负担。

编辑：其他潜在问题与绑定有关。如果你坚持使用 HTTP(S)，你应该会很好......开始使用 TCP 或 MSMQ 等替代方案，你将不得不在 Java 中做很多工作。此外，某些安全功能并非在所有情况下都可以互操作，例如使用 NTLM 令牌……采用迭代方法。从没有安全性的简单 HTTP w/SOAP 绑定开始，然后从那里开始。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T15:22:17.987

WCF 是否提供标准的 SOAP 接口？如果是这样，让 Java 与之对话应该是轻而易举的事。

回复：Edit1：WSDL / XSD 将使用标准日期时间格式（Java 端的日历、SOAP 中的格式化日期时间字符串、.NET 中的日期时间），或者您可以将其强制转换为您自己选择的字符串格式。

阅读有关 Java Web 服务的 Apache Axis（1.4 和 2.0）文档。从 Web 服务将提供的 wsdl/xsd 设置 Java Web 服务客户端非常容易使用。

Edit3：在 Java 中，您将定义一个 Java 模型（包含所有您喜欢的文档），然后运行 ​​Java2WSDL（最好作为 ANT/Maven 任务）来创建您的 WSDL（但是我发现您需要手动重新排序其中的字段） . Axis 2 很好地支持集合和枚举，Axis 1.4 喜欢数组和手动 Java 1.4 风格的枚举。通过这个 WSDL，您将使用 WSDL2Java 创建一个服务器端框架，您唯一需要做的就是实现您的业务逻辑。

# actionscript-3 - 如何引用一个对象，为其添加补间并将其放入 AS3 的 Eventlistener 中？

> ID：690182
> 
> 赞同：0
> 
> 时间：2009-03-27T15:18:47.217
> 
> 标签：actionscript-3, animation, reference, event-listener

我在尝试获取我在[AS2](http://en.wikipedia.org/wiki/ActionScript#ActionScript_2.0)到[AS3](http://en.wikipedia.org/wiki/ActionScript#ActionScript_3.0)中编写的应用程序时遇到了一些麻烦。我需要去 AS3 的原因有点恶心，所以我不会详细介绍它。

我有 90% 的应用程序使用新代码运行。现在我已经到了必须从 AS2 转换此代码的地步，

```
function setAnimation(theObject,id)
{
    theObject.vensterid=id;
    theObject.onEnterFrame = function()
    {
        var myHoriTween:Tween = new Tween (this,"_x",Strong.easeOut,this._x,(130+((theObject.vensterid-frameno)*260)),1,true);
    }
}

setAnimation(venster0,0); 
```

, 到 AS3。我这样做的尝试最终像

```
function setAnimation(anObject,id) {
    var theObject = this[anObject];
    theObject.vensterid=id;
    function slideHorizontal(event:Event)
    {
            var myTween:Tween = new Tween (theObject,"x",Strong.easeOut,this.x,(130+((theObject.vensterid-frameno)*260)),1,true);
    }
    theObject.addEventListener(Event.ENTER_FRAME,slideHorizontal);
}

setAnimation(venster0,0); 
```

并给我以下非错误（它不显示为编译器错误，而是作为输出）：

```
TypeError: Error #1010: A term is undefined and has no properties.
    at sliding_windows_as3_fla::SlideMenu_1/setAnimation()
    at sliding_windows_as3_fla::SlideMenu_1/frame1() 
```

我认为这很奇怪，因为它没有说明哪个术语（并且有很多）并且谷歌搜索也没有找到我的解释。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T15:29:31.653

我没有机会测试您的代码，因为很难为其设置上下文，但我的想法是：

1.  您应该声明参数类型：`function setAnimation(anObject:Object,id:uint):void`. 这至少是一种很好的做法。
2.  `var theObject = this[anObject];``anObject`如果您的变量是对象，则完全没有必要。我认为`var theObject = this[anObject];`不起作用，`theObject`最终为空，这就是你得到错误的原因。如果您声明了一个名为 venster0 的变量，即扩展 Object 的类的实例，那么您可以将引用传递给它而不会遇到任何其他麻烦。
3.  根据您使用的对象，`theObject.vensterid=id;`可能无法正常工作。Object 实例必须具有“vensterid”属性的类，否则您将获得“1119：通过静态类型的引用访问可能未定义的属性 vensterid ...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:11:54.797

我认为您的问题是以下字符串：

```
var theObject = this[anObject]; 
```

只需将其替换为

```
var theObject = anObject; 
```

我希望这就是你所需要的。

或者代替

```
setAnimation(venster0,0); 
```

你可以传递一个实例名称（即字符串）：

```
setAnimation("venster0",0); 
```

这将起作用，因为`this['propertyname']`您实际上是按名称访问 Object 的属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-03T17:03:28.807

只是要抛弃在 Flash/Flex 中使用内置的 Tween 类是一种痛苦。考虑改用 Tweening 库：Tweener、TweenLite 等。它们更容易使用，并且您不必担心在 Tween 完成之前维护引用。

# asp.net - 电子邮件上的 CSS

> ID：690189
> 
> 赞同：8
> 
> 时间：2009-03-27T15:21:31.593
> 
> 标签：asp.net, css, email, smtp

有没有人找到一种在以编程方式生成的电子邮件中嵌入 CSS 的好方法。我发现最好的方法是将样式代码放入资源文件中并将其调用到代码中。

一个例子是

```
Dim objBuilder
objBuilder = New StringBuilder

objBuilder.Append(Resources.SystemEmail.CSSStyle)
objBuilder.Append("My Styled Email")

Dim _Body As String = objBuilder.ToString() 
```

这将构建电子邮件的正文

有什么方法可以为电子邮件制作模板文件，或者有更好的方法将样式表调用到一个模板文件中。

我的 .resx 文件中的代码是

```
<STYLE TYPE="text/css">
<!--
body
{

    font-family: Tahoma, Verdana, Arial;
    font-size: 10pt;
    padding: 3px 0px 0px 0px;
    margin: 0px 0px 0px 0px;

}
-->
</STYLE> 
```

并将其调用到字符串中将调用此内联

并通过以下答案发送消息，我将使用它

```
Dim client As New SmtpClient("localhost")
Dim toAddr As New MailAddress(MailRecipients)
Dim fromAddr As New MailAddress(MailFrom)
Dim message As New MailMessage(fromAddress, toAddress)

message.Subject = "The Subject"
message.Body =  _Body 
message.IsBodyHtml = True
message.BodyEncoding = System.Text.Encoding.UTF8

client.Send(message) 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T15:24:21.463

我们成功的唯一方法是包含 CSS 内联。文档标题样式 CSS 包含不一致或不可靠。

另外，请确保您的电子邮件标题设置为： Content-type: text/html; 字符集=ISO-8859-1

**编辑** UTF-8 也是一个不错的选择。该语句的关键点是将 Content-type 设置为 text/html

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-27T18:11:14.010

以下是每个电子邮件客户端支持的 CSS 样式的综合指南：http: [//www.campaignmonitor.com/css/](http://www.campaignmonitor.com/css/)

关于您需要了解的指南：http: [//www.campaignmonitor.com/design-guidelines/](http://www.campaignmonitor.com/design-guidelines/)

还有大量免费的预建模板可供您参考： http: [//www.campaignmonitor.com/templates/](http://www.campaignmonitor.com/templates/)

最后，同一家公司提供了一个测试工具，以合理的费用向您展示您的消息将如何显示在每个电子邮件客户端中：http: [//www.campaignmonitor.com/testing/](http://www.campaignmonitor.com/testing/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T15:39:07.637

不幸的是，您需要在元素中包含 CSS 内联，以便在电子邮件客户端之间具有任何模糊的兼容性。此外，您应该使用表格进行布局（列等），因为 CSS div 布局经常失败。附加的图像也主要用于 cid: URLs。Thunderbird 是关于兼容性最好的邮件客户端（很明显，因为它使用 Gecko 渲染器）。前景是最糟糕的。

此外，使用带有纯文本替代方案的多部分 mime。我使用数据库来存储电子邮件模板，并且有纯文本和 html 模板，具有 {{replaceable}} 值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T15:26:20.957

内联 CSS 是确保最大兼容性的必要条件。

像 MailChimp 这样的一些系统会获取你的元素类，解析你的 CSS，并用内联样式替换类属性。您可以编写自己的代码来执行此操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T16:27:41.483

除了每个人都推荐的内联 CSS 之外，请记住，电子邮件通常在另一个网页中在线显示，例如通过 Yahoo! 邮件、Hotmail 或 Gmail。`body`如果允许样式声明或随机类名，您可以想象会发生的混乱。您应该计划任何未内联定义的内容都将被丢弃的可能性，尽管某些系统可能会尝试以不可预知的成功保留这些规则。

# algorithm - 遮挡算法集合

> ID：690192
> 
> 赞同：7
> 
> 时间：2009-03-27T15:21:40.470
> 
> 标签：algorithm, graphics, occlusion

遮挡算法在 CAD 和游戏行业是必不可少的。我认为它们在两个行业中是不同的。我的问题是：

1.  这两个行业分别应用了什么样的遮挡算法？
2.  有什么区别？

我正在做CAD软件开发，我们采用的遮挡算法是——将物体标识符设置为它的颜色（一个整数），然后渲染场景，最后读取像素找出可见物体。性能不是很好，所以我想在这里得到一些好的想法。谢谢。

* * *

在阅读了回答者之后，我想澄清一下，这里的*遮挡算法*意味着“遮挡剔除”——在将它们发送到管道之前找出可见的表面或实体。

通过谷歌，我在[gamasutra](https://mail.google.com/mail/?hl=en&zx=zb0vm6qx6y8o&shva=1#search/occlusion/118e65a38a55d919)找到了一个算法。还有其他好的想法或发现吗？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T15:30:54.690

在游戏中，遮挡是在幕后使用两个 3D 库之一完成的：DirectX 或 OpenGL。具体来说，遮挡是使用[Z 缓冲区](http://en.wikipedia.org/wiki/Z-buffer)完成的。每个点都有一个 Z 分量，距离较近的点会遮挡较远的点。

遮挡算法通常由实现 DirectX 或 OpenGL 功能的专用 3D 图形处理芯片在硬件中完成。使用 DirectX 或 OpenGL 的游戏程序将在 3D 空间中绘制对象，并让 OpenGL/DirectX 库在考虑投影和遮挡的情况下渲染场景。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T17:38:06.210

到目前为止，大多数答案都只讨论图像顺序遮挡，这让我很困惑。我不完全确定 CAD，但在游戏中，遮挡从更高级别开始，使用 BSP 树、八叉树和/或门户渲染来快速确定出现在视锥体中的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T15:40:09.380

您应该搜索的术语是[隐藏表面去除](http://en.wikipedia.org/wiki/Hidden_surface_determination)。

实时渲染通常利用一种简单的隐藏表面去除方法：背面剔除。每个多边形都有一个“表面法线”点，该点在距表面一定距离处预先计算。通过检查表面法线相对于相机的角度，您会知道表面背对着，因此不需要渲染。

这是一些基于 Flash 的交互式[演示和说明](http://www.ibiblio.org/e-notes/3Dapp/Hidden.htm)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T15:52:50.257

硬件像素 Z 缓冲是迄今为止最简单的技术，但是在高密度对象场景中，您仍然可以尝试多次渲染同一个像素，这在某些情况下可能会成为性能问题。- 你当然需要确保你没有映射和纹理数千个不可见的对象。

我目前正在我的一个项目中考虑这个问题，我发现这激发了一些想法： [http ://www.cs.tau.ac.il/~dcor/Graphics/adv-slides/short-image -基于剔除.pdf](http://www.cs.tau.ac.il/~dcor/Graphics/adv-slides/short-image-based-culling.pdf)

# internet-explorer-8 - 在 IE8 中是否有切换文本大小的键盘快捷键？

> ID：690204
> 
> 赞同：2
> 
> 时间：2009-03-27T15:24:31.120
> 
> 标签：internet-explorer-8, keyboard-shortcuts, accessibility

IE 6+ 可以按住**ctrl** +**鼠标滚轮**来增加和减少页面上的文本大小。然而，现在 IE 8 已经用广泛接受的整页缩放 +- 取代了该功能。有没有人找到一个可以再次增加和减小文本大小的键盘快捷键？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T15:27:53.373

这不完全是*快捷方式*，但可以通过键盘完成。

*   `ALT`-`V`将调出查看菜单
*   `x`将弹出文本大小子菜单
*   `Up`和`down`箭头键选择大小
*   `Enter`选择。

即使菜单栏不可见，这也有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T15:30:21.387

飞涨：

增加：

**`CTRL`+`+`**

和

减少

**`CTRL`+`-`或`CTRL`+`=`**

字体大小：

**`alt`+`v`**

**`x`**

**`g`**或**`l`**或**`m`**或**`s`**或**`a`**

# c# - 如何从 ASP.NET MVC 视图中动态添加和删除行项目？

> ID：690211
> 
> 赞同：1
> 
> 时间：2009-03-27T15:25:23.487
> 
> 标签：c#, asp.net, asp.net-mvc

我有一个 PurchaseOrder 模型：

```
public class PurchaseOrder
{ 
    public string OrderNumber { get; set; }
    public string Customer { get; set; }
    public IList<LineItem> Lines { get; set; }
} 
```

和一个 LineItem 类：

```
public class LineItem
{ 
   public string PartNumber { get; set; }
   public int Quantity { get; set; }
} 
```

我想要做的是对 PurhcaseOrder Create 操作的看法，我需要一个用于行项目的部分。用户应该能够添加新行、删除行，然后提交。一个警告是 PartNumber 需要是有效部件的下拉列表。

我能做些什么来完成我正在寻找的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-01-28T04:22:00.450

[http://knockoutjs.com/](http://knockoutjs.com/)非常适合这个。

[http://knockoutjs.com/examples/cartEditor.html](http://knockoutjs.com/examples/cartEditor.html)显示了一个可以添加/删除行并包含下拉列表的编辑器。

还有一篇过时的文章讨论了将 Knockoutjs 与 asp.net mvc 一起使用 - [http://blog.stevensanderson.com/2010/07/12/editing-a-variable-length-list-knockout-style/](http://blog.stevensanderson.com/2010/07/12/editing-a-variable-length-list-knockout-style/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:28:40.217

如果你想在没有 js 的情况下做所有事情，那么创建一个新的操作/视图来添加和编辑一个行项目。对于删除，让操作链接删除项目是不好的做法，GET 永远不应该更改数据。所以一个好的模式是让删除链接进入确认页面。并从该页面发布到删除操作（或取消并返回）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-27T15:28:49.453

我会用 jQuery 创建这个功能（在客户端）

* * *

零件编号 1345 - 124 件 [移除]
零件编号 1489 - 101 件 [移除]

[选择零件名称/] [_数量_] [添加]

* * *

另外，您可以为禁用 JS 的客户端复制此功能（完全相同的 UI）和服务器端代码。为此，您可以将临时 LineItems 存储在 TempData 中（在每次回发时，当用户单击 Add Line Item 时）。

# python - 将代码放在 python 配置文件中是否有礼貌？

> ID：690221
> 
> 赞同：9
> 
> 时间：2009-03-27T15:26:56.697
> 
> 标签：python, django

关于 python，我最喜欢的特性之一是您可以在 python 中编写易于阅读和理解的配置文件。如果你给自己设置一些界限，你可以非常自信地让非 Python 爱好者确切地知道你的意思，并且完全有能力重新配置你的程序。

我的问题是，这些界限到底是什么？我自己的个人启发式是

1.  避免流量控制。没有函数、循环或条件。这些不会出现在文本配置文件中，人们也不希望能够理解它们。通常，您的语句执行顺序可能无关紧要。
2.  坚持文字分配。在对象上调用的方法和函数更难思考。任何隐含的东西都会变得一团糟。如果您的参数必须发生一些复杂的事情，请更改它们的解释方式。
3.  语言关键字和错误处理是正确的。

我想我问这个是因为我在 Django 配置文件中遇到了一种情况，打破这些规则似乎很有用。我碰巧喜欢它，但我觉得有点内疚。基本上，我的项目是通过 svn checkouts 部署到几个不同的服务器上，这些服务器的配置并不相同（例如，有些会共享一个数据库，有些则不会）。所以，我在最后抛出一个钩子：

```
try:
    from settings_overrides import *
    LOCALIZED = True
except ImportError:
    LOCALIZED = False 
```

其中 settings_overrides 在 python 路径上但在工作副本之外。对于这个例子，或者一般的 python 配置边界，你怎么看？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-27T15:36:19.547

有一个 Django wiki 页面，它准确地解决了您要问的问题。 [http://code.djangoproject.com/wiki/SplitSettings](http://code.djangoproject.com/wiki/SplitSettings)

不要重新发明轮子。使用[configparser](http://docs.python.org/library/configparser.html)和 INI 文件。Python 文件很容易被不懂 Python 的人破解。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T15:40:56.383

你的启发式方法很好。制定规则是为了设定界限，只有在它显然是比替代方案好得多的解决方案时才打破界限。

尽管如此，我还是不禁想知道站点检查代码应该在解析器中，并且添加了一个额外的配置项来选择应该采用哪个选项。

我不认为在这种情况下，替代方案是如此糟糕以至于打破规则是有意义的......

-亚当

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T15:41:31.110

我认为这是一个痛苦与快乐的争论。

将代码放在 Python 配置文件中并没有*错*，因为它都是有效的 Python，但这确实意味着您可能会混淆进入重新配置应用程序的用户。如果您对此感到担心，请用注释将其拉开，大致解释它的作用以及用户不应编辑它，而应编辑 settings_overrides.py 文件。

至于您的示例，这对于开发人员测试然后部署他们的应用程序来说几乎是**必不可少的。**肯定比痛苦更快乐。但是你真的应该这样做：

```
LOCALIZED = False

try:
    from settings_overrides import *
except ImportError:
    pass 
```

在您的 settings_overrides.py 文件中：

```
LOCALIZED = True 
```

...如果只是为了弄清楚该文件的作用..您在那里所做的会将覆盖分成两个地方。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T15:42:34.150

作为一般做法，请参阅页面上的其他答案；这一切都取决于。然而，特别是对于 Django，我认为在 settings.py 文件中编写代码并没有根本性的问题......毕竟，设置文件是代码:-)

设置本身的[Django 文档](http://docs.djangoproject.com/en/dev/topics/settings/#topics-settings)说：

> 设置文件只是一个带有模块级变量的 Python 模块。

并举个例子：

```
assign settings dynamically using normal Python syntax. For example:
MY_SETTING = [str(i) for i in range(30)] 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-28T22:33:45.307

设置为代码也是一种安全风险。您导入“配置”，但实际上您正在执行该文件中的任何代码。将配置放入您首先解析的文件中，您可以拒绝无意义或恶意的值，即使它对您来说更有用。我在 2008 年 12 月写了[一篇博客](http://www.heikkitoivonen.net/blog/2008/12/07/configuration-options-in-code-or-ini-files/)。

# windows - 如何在 CMake (Windows) 中检索用户环境变量

> ID：690223
> 
> 赞同：115
> 
> 时间：2009-03-27T15:27:13.017
> 
> 标签：windows, environment-variables, cmake

我知道如何使用 CMAKE 检索正常的机器范围的环境变量

```
$ENV{EnvironmentVariableName} 
```

但我无法检索用户特定的环境变量。有可能吗？怎么做？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2014-10-13T08:48:55.693

## 将变量放入您的 CMake 脚本

您可以使用 cmake 调用在行上传递一个变量：

```
FOO=1 cmake 
```

或通过在 BASH 中导出变量：

```
export FOO=1 
```

然后您可以使用以下命令在 cmake 脚本中获取它：

```
$ENV{FOO} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2017-04-09T19:06:56.280

您还可以调用[cmake](/questions/tagged/cmake "显示标记为“cmake”的问题")本身以跨平台的方式执行此操作：

```
cmake -E env EnvironmentVariableName="Hello World" cmake .. 
```

> `env [--unset=NAME]... [NAME=VALUE]... COMMAND [ARG]...`
> 
> 在修改后的环境中运行命令。

* * *

*请注意*，这可能只在第一次工作。如果 CMake 使用连续构建之一重新配置（您只需调用例如`make`，一个`CMakeLists.txt`已更改并且 CMake 再次运行生成过程），则用户定义的环境变量可能不再存在（与系统范围的环境变量相比）。

因此，我将项目中的那些用户定义的环境变量转移到 CMake 缓存变量中：

```
cmake_minimum_required(VERSION 2.6)

project(PrintEnv NONE)

if (NOT "$ENV{EnvironmentVariableName}" STREQUAL "")
    set(EnvironmentVariableName "$ENV{EnvironmentVariableName}" CACHE INTERNAL "Copied from environment variable")
endif()

message("EnvironmentVariableName = ${EnvironmentVariableName}") 
```

**参考**

*   [CMake - 命令行工具模式](https://cmake.org/cmake/help/latest/manual/cmake.1.html#command-line-tool-mode)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-10-18T19:59:15.087

您需要导出变量。因此，例如在 Linux 中：

```
export EnvironmentVariableName=foo 
```

CMAKE 中未导出的变量为空。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-07-01T23:52:39.950

环境变量（您使用系统属性修改的）仅在您创建新的子外壳时传播到子外壳。

如果您在更改用户环境变量时打开了命令行提示符（DOS 或 cygwin），那么它们将不会显示。

更改用户设置后，您需要打开一个新的命令行提示符。

Unix/Linux 中的等价物是在你的 .bash_rc 中添加一行：你需要启动一个新的 shell 来获取这些值。

# javascript - 将 html 表单输入限制在某个浮点范围内

> ID：690230
> 
> 赞同：0
> 
> 时间：2009-03-27T15:28:56.943
> 
> 标签：javascript, filtering

有没有办法将表单输入字段限制在某个数字范围之间，比如（0,100）

我正在过滤 onkeydown 事件中的输入，只接受数字，问题是我想拒绝一个数字，如果该数字会使输入超出范围

所以我需要一种方法来查看输入的当前值加上用户按下的键是否会在范围之间求和。

我尝试使用：

```
if((parseFloat(this.value) + parseFloat(String.fromCharCode(e.keyCode)) > 100){
    return false;
} 
```

问题是 e.keyCode 可以为同一个数字返回不同的代码，现在为数字 9 返回 57，但如果我按下数字键盘上的数字，则返回 105。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T15:33:42.437

就个人而言，我只会在字段失去焦点时（或提交表单时）检查它。在用户键入时弹出错误（或阻止他们的击键在该字段中注册）通常只会惹恼他们。

当然，您可能已经知道这一点，但请确保在提交表单后检查服务器端的值。永远不要依赖 javascript 验证！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T17:20:31.823

试图预测结果值会比你想象的更难。请记住，用户可能正在按下退格键，或者光标可能不在字段的末尾，或者用户可能选择了部分值，以便在下次按键时被替换，等等。也可以通过鼠标操作来操纵文本字段，您不会有任何发言权。

传统方法是将验证放在“keyup”事件而不是“keypress”上。然后，您将获得该字段的完整更改后值。您没有机会拒绝按键，但您可以将该字段重置为上次已知的正确值。

但无论哪种方式，最好不要试图将输入限制得太紧，因为这会使输入变得非常困难。例如，“12”。是一个您可能想要拒绝的无效数字……但如果您这样做了，输入“12.3”将变得非常困难！最好允许任何输入，但在当前输入超出范围时通过某种机制发出信号（例如，将文本变为红色很常见）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T15:44:00.510

添加当前值加上键入的字符的浮点值不是您想要的。想想如果当前值为 99.0 并且用户键入“5”，实际值为 99.05，但您的表达式将计算为 104.0。在将任何内容解析为浮点数之前，您需要将键字符附加到当前值。

至于键码，[这里](http://www.cambiaresearch.com/c4/702b8cd1-e5b0-42e6-83ac-25f0306e3e25/Javascript-Char-Codes-Key-Codes.aspx)是对javascript键码的参考。使用它，您可以编写自己的函数，如下所示：

```
function fromKeyCode(code) {
  var asciiCode = code;
  if (code > 95 && code < 106) {
    asciiCode -= 48;
  }
  return String.fromCharCode(asciiCode);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T15:59:16.027

```
var total = new Number(20.00);

alert(total.toFixed(2)); 
```

这将允许您在小数点后 2 位的精度上设置固定宽度。在这种情况下，我确保使用 js 必填字段检查 money 在 2 之后只有 2 个位置。

我不确定我是否完全理解您的问题，但请检查 Number() 方法，那里必须有一些东西可以帮助您。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T18:44:10.187

在值包含新输入**之后**，您可以在 keyup 上捕获输入。

然后只看价值-

```
inputelement.onkeyup= function(e){
    e= window.event? event.srcElement: e.target;
    var val= parseFloat(e.value) || 0;
    e.value= Math.max(0, Math.min(100, val));
} 
```

# c# - 如何最好地等待文件锁释放

> ID：690242
> 
> 赞同：9
> 
> 时间：2009-03-27T15:32:20.023
> 
> 标签：c#, .net, ioexception, filelock

我有一个应用程序，有时我需要从正在写入的文件中读取并因此被锁定。正如我从其他[问题](https://stackoverflow.com/questions/50744/wait-until-file-is-unlocked-in-net)中了解到的那样，我应该捕获 IOException 并重试，直到我可以阅读为止。

但我的问题是我如何确定该文件已被锁定并且它不是另一个 IOExcetpion 发生。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T16:06:58.753

当您打开文件以在 .NET 中读取时，它会在某个时候尝试使用[CreateFile](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx) API 函数创建文件句柄，该函数设置[错误代码](http://help.netop.com/support/errorcodes/win32_error_codes.htm)，可用于查看失败的原因：

```
const int ERROR_SHARING_VIOLATION = 32;
try
{
    using (var stream = new FileStream("test.dat", FileMode.Open, FileAccess.Read, FileShare.Read))
    {
    }
}
catch (IOException ex)
{
    if (Marshal.GetLastWin32Error() == ERROR_SHARING_VIOLATION)
    {
        Console.WriteLine("The process cannot access the file because it is being used by another process.");
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T16:11:23.657

[有一个关于谷歌群组](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/e1c077cddc823339/b0d9b54636e72ea1)的有用讨论，你真的应该阅读。其中一个选项接近达林的；然而，为了保证你得到正确的 win32 错误，你真的应该自己调用 win32 OpenFile() API（否则，你真的不知道你正在检索哪个错误）。

另一个是解析错误消息：如果您的应用程序在其他语言版本上运行，这将失败。

第三种选择是通过反射破解异常类以找出实际的 HRESULT。

没有一个替代品真的那么有吸引力：IOException 层次结构将受益于更多的子类恕我直言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T15:45:01.897

要读取数据，您可以执行以下操作：

> 使用 (FileStream fs = new FileStream(fileName, FileMode.Open, FileAccess.Read, FileShare.ReadWrite | FileShare.Delete)) { .... }

并保存到文件中：

> 使用 (FileStream fs = new FileStream(fileName, FileMode.Append, FileAccess.Write, FileShare.Read | FileShare.Delete)) { ... }

构造函数末尾的标志描述了其他进程可以对文件执行的操作。当然，如果您同时控制写入和读取，那也没关系...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T15:45:47.230

您可以与 IOException 类型进行比较以检查它是否不是别的东西

如

```
if (ex is FileNotFoundException) 
```

您可能想查找有关 System.IO 的帮助。该类中的许多异常都继承自[IOException](http://msdn.microsoft.com/en-us/library/system.io.ioexception.aspx)。除了检查它是否是另一种类型的异常之外，您可能必须查看描述消息，或者您可能会考虑对 shell32.dll 进行 Win32 API 调用。那里可能有一个功能可以检查文件是否被锁定。

此外，如果您绝对需要等待，您可以使用循环，但如果您想在等待时执行其他操作，请使用异步线程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T15:54:54.180

您可以打开它（如 bezieur 所述）然后尝试锁定部分（或整个文件）： [http ://www.java2s.com/Code/VB/File-Directory/Lockandunlockafile.htm](http://www.java2s.com/Code/VB/File-Directory/Lockandunlockafile.htm)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T15:59:13.330

你的意思是你正在读取和写入文件？或者外部应用程序正在写入它。

如果您正在读取和写入，那么我假设您是在不同的线程上执行此操作，在这种情况下，请查看 ReaderWriteLock 类，该类将为您执行此管理，并允许您提供超时。

[http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx)

否则，您需要做的就是以只读模式打开文件。那么你应该没有任何问题：

```
fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read)); 
```

# ruby-on-rails - 我的 Rails 和 Cocoa 应用程序之间的 SHA1 哈希值不匹配

> ID：690246
> 
> 赞同：14
> 
> 时间：2009-03-27T15:33:42.360
> 
> 标签：ruby-on-rails, objective-c, ruby, cocoa, sha1

我有一个 Cocoa 应用程序将一些数据连同该数据的 SHA1 哈希发送到 Rails 应用程序，该应用程序验证数据和哈希是否匹配，但它们不匹配。

为了确保我已经记录了在 Rails 和 Cocoa 端散列到控制台的数据的十六进制版本，并且它们完全匹配。

这是可可部分：

```
#import <CommonCrypto/CommonDigest.h>

//...

- (NSData *)dataOfSHA1Hash
{
    unsigned char hashBytes[CC_SHA1_DIGEST_LENGTH];
    CC_SHA1([self bytes], CC_SHA1_DIGEST_LENGTH, hashBytes);

    return [NSData dataWithBytes:hashBytes length:CC_SHA1_DIGEST_LENGTH];
}

//...

NSData *signatureData = [signedData dataOfSHA1Hash];
NSString *signature = [signatureData hexadecimalString]; 
```

..和Rails：

```
Digest::SHA1.hexdigest(signed_data) 
```

请注意，-hexadecimalString 是我测试过的 NSData 的自定义扩展（似乎没有内置）。这种方法似乎不是问题。

那么，为什么我的 SHA1 哈希值在相同的数据上不匹配？有任何想法吗？

**编辑：示例**

对于字符串“Hello World！”

```
可可：f98ee9c814c2f3c66ccdca641298d12cd26741ec
导轨：2ef7bde608ce5404e97d5f042f95f89f1c232871
```

可可：

```
NSMutableData *signedData = [[NSMutableData alloc] init];
[signedData appendData:[@"Hello World!" dataUsingEncoding:NSUTF8StringEncoding]];

NSData *signatureData = [signedData dataOfSHA1Hash];
[signedData release];
NSString *signature = [signatureData hexadecimalString];

NSLog(@"Signature: %@", signature);
// output: Signature: f98ee9c814c2f3c66ccdca641298d12cd26741ec 
```

红宝石：

```
>> Digest::SHA1.hexdigest("Hello World!")
=> "2ef7bde608ce5404e97d5f042f95f89f1c232871" 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T16:18:03.237

发现错误，愚蠢的小东西：

```
-CC_SHA1([self bytes], CC_SHA1_DIGEST_LENGTH, hashBytes);
+CC_SHA1([self bytes], [self length], hashBytes); 
```

我发送了摘要的长度而不是数据的长度。不知道我怎么会犯这样的错误——然后忽略它几个小时。

# linq - 更新您的 edmx 以反映您的数据库中所做的更改（.net linq-to-entities）

> ID：690248
> 
> 赞同：45
> 
> 时间：2009-03-27T15:34:21.843
> 
> 标签：linq, entity-framework, .net-3.5, linq-to-entities

*   所以我制作了我的 edmx。
*   然后我稍微更改了我的数据库，将列从 NOT NULL 更改为允许 NULL。
*   我进入我的 edmx，右键单击并选择“从数据库更新模型”

现在我进入我的程序，它实际上并没有更新......我不能在列中放置一个空值。我该怎么做才能正确更新 edmx？谢谢你。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-10-08T01:33:46.380

从 EDMX 更新/删除并不总是有效。如果模型在单击从数据库中更新模型时没有更新，假设您在数据库中更新了视图/表，请执行以下操作：

1）从模型图中删除视图/表
2）将 EDMX 切换到 xml 视图（右键单击 edmx 文件并选择“打开方式”）
3）搜索并删除 xml 实体元素
4）切换回 EDMX 视图
5）单击从数据库更新模型

这应该反映您对数据库所做的任何类型的更改到您的 EDMX。这很麻烦，但可以完美运行。

在一个理想的世界中，我希望数据库中的更新模型能够将数据库中的更改同步到 EDMX。但是，它在大多数情况下都不起作用。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2012-10-09T12:42:09.493

我成功完成的是这个（VB.Net）。

1.  根据需要/需要对数据库进行更新
2.  在 EDMX 模型中选择“从数据库更新”，图形模型将正确显示新的结构/表
3.  展开项目，使其显示所有相关文件
4.  扩展名为“tt”的两个文件很重要：首先取一个没有.Context 的文件。在 tt 扩展之前。右键单击它并选择运行自定义工具：

[![运行自定义工具](https://i.stack.imgur.com/WUtB4.jpg)](https://i.stack.imgur.com/WUtB4.jpg)

5.  对带有 .Context 的 .tt 文件执行相同的操作。以其名义。您的所有代码和逻辑模型类都将更新。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-27T15:52:05.733

从数据库中选择更新模型是更新 EDMX 的最佳方法。某些属性不会在概念层上更新。

通过在 Model Viewer 工具箱中查看 Store 层，确保其已更新。如果 Store 已正确更新，那么您就可以了，并且您的数据库已同步。如果是这样，请进入可视化设计器，单击该字段，转到属性，然后更新概念侧的 NotNull 属性。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-12-15T15:48:41.110

是的，它大部分时间都不起作用：-/

“最好的方法”（因为它可以系统地工作）是删除 EDMX 文件并重新生成它。但是不要忘记在 App.config 中移除连接字符串（否则 VS2008 wizzard 会在默认实体名称后添加一个后缀），并清除缓存。

我希望这些工具在下一个版本中能更好地工作，因为它大大降低了生产力......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-06-13T21:39:52.070

这是最快最简单的方法：

1.  从 .edmx 图表中删除视图/表格。
2.  现在使用从数据库中更新模型重新添加表。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-04-24T11:35:37.963

1.更新EDMX文件后编译工程。

2.在解决方案资源管理器中右键单击您的 .tt 文件。

3.选择“运行自定义工具”选项。

这将更新 .tt 文件。

来源：[这里](https://social.msdn.microsoft.com/Forums/en-US/49a87c1b-897b-4d12-a939-2237bdb5ce3d/refreshing-edmx-model-did-not-update-model-classes?forum=adodotnetentityframework)！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-01-14T19:01:12.463

在 VS 的 XML 编辑器中打开 edmx 文件并检查尝试更新时是否产生了错误。

```
 <!--Errors Found During Generation:
      warning 6013: The table/view 'foo.dbo.snafu' does not have a primary key   
      defined and no valid primary key could be inferred. This table/view has  
      been excluded. To use the entity you will need to review your schema,  
      add the correct keys and uncomment it.

  <EntityType Name="snafu">
    <Property Name="snafu_column" Type="smallint" />
  </EntityType>--> 
```

在上述情况下......向相关表添加主键导致“从数据库更新模型”工作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-10-02T16:46:23.320

这个答案更好：[https ://stackoverflow.com/a/23886016/1014884](https://stackoverflow.com/a/23886016/1014884)

任何手动编辑都可能出现错误，或者当有人使用任何工具（如向导）时会丢失。使用向导删除和更新要好得多。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-10-27T20:09:25.707

例如，它不会更新字符串属性的最大长度！

如果您使用 TFS，删除文件是不好的，您希望保留历史记录而不影响其他人。

对我来说，它有一个单独的小项目，我可以用它来完全重新创建 edmx 文件，我在 xml 中打开它，将粘贴复制到现有的，然后在模型中移动一个形状，以便 VS 重新创建 .cs 文件. 瞧，它现在已更新。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-07-25T13:17:17.053

我在数据库中创建的视图没有出现在设计器中（在选择“从数据库更新模型...”并在视图名称旁边添加一个检查之后）。在将 EDMX 切换到 xml 视图之前，我没有看到任何错误消息：

*   右键单击 edmx 文件
*   选择“打开方式...”
*   选择“自动编辑器选择器 (XML)”
*   单击查找并搜索您的视图名称

在 edmx xml 中我发现：

> “在生成过程中发现错误：警告 6013：表/视图'（视图名称）'没有定义主键，并且无法推断出有效的主键。此表/视图已被排除。要使用实体，您将需要检查您的架构，添加正确的键，然后取消注释。”

我修改了视图以具有主键。然后我打开 edmx 设计器并运行“从数据库更新模型...”，然后视图按预期出现在设计器中，没有错误。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-09-19T08:38:12.410

从设计器视图中删除所有表格并在之后更新对我有用

# javascript - IE8 中的 console.log 发生了什么？

> ID：690251
> 
> 赞同：256
> 
> 时间：2009-03-27T15:34:57.147
> 
> 标签：javascript, logging, internet-explorer-8, console

根据[这篇文章](http://readerszone.com/microsoft/internet-explorer/ie8-beta2-jscript-features.html)，它是在测试版中，但它不在版本中？

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2009-03-27T15:47:21.203

console.log 仅在您打开开发者工具后可用（F12 切换它的打开和关闭）。有趣的是，在你打开它之后，你可以关闭它，然后仍然通过 console.log 调用发布到它，当你重新打开它时会看到这些。我认为这是某种错误，可能会被修复，但我们将拭目以待。

我可能会使用这样的东西：

```
function trace(s) {
  if ('console' in self && 'log' in console) console.log(s)
  // the line below you might want to comment out, so it dies silent
  // but nice for seeing when the console is available or not.
  else alert(s)
} 
```

甚至更简单：

```
function trace(s) {
  try { console.log(s) } catch (e) { alert(s) }
} 
```

* * *

## 回答 #2

> 赞同：230
> 
> 时间：2011-05-11T16:33:17.263

更好的后备是这样的：

```
 var alertFallback = true;
   if (typeof console === "undefined" || typeof console.log === "undefined") {
     console = {};
     if (alertFallback) {
         console.log = function(msg) {
              alert(msg);
         };
     } else {
         console.log = function() {};
     }
   } 

```

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2013-01-09T20:51:28.457

这是我对各种答案的看法。我想实际查看记录的消息，即使在它们被触发时我没有打开 IE 控制台，所以我将它们推送到`console.messages`我创建的数组中。我还添加了一个功能`console.dump()`，方便查看整个日志。`console.clear()`将清空消息队列。

该解决方案还“处理”其他控制台方法（我相信它们都源自[Firebug 控制台 API](http://getfirebug.com/wiki/index.php/Console_API)）

最后，该解决方案采用[IIFE](http://benalman.com/news/2010/11/immediately-invoked-function-expression/)的形式，因此不会污染全局范围。回退函数参数在代码底部定义。

我只是将它放在我的主 JS 文件中，该文件包含在每个页面上，然后忘记它。

```
(function (fallback) {    

    fallback = fallback || function () { };

    // function to trap most of the console functions from the FireBug Console API. 
    var trap = function () {
        // create an Array from the arguments Object           
        var args = Array.prototype.slice.call(arguments);
        // console.raw captures the raw args, without converting toString
        console.raw.push(args);
        var message = args.join(' ');
        console.messages.push(message);
        fallback(message);
    };

    // redefine console
    if (typeof console === 'undefined') {
        console = {
            messages: [],
            raw: [],
            dump: function() { return console.messages.join('\n'); },
            log: trap,
            debug: trap,
            info: trap,
            warn: trap,
            error: trap,
            assert: trap,
            clear: function() { 
                  console.messages.length = 0; 
                  console.raw.length = 0 ;
            },
            dir: trap,
            dirxml: trap,
            trace: trap,
            group: trap,
            groupCollapsed: trap,
            groupEnd: trap,
            time: trap,
            timeEnd: trap,
            timeStamp: trap,
            profile: trap,
            profileEnd: trap,
            count: trap,
            exception: trap,
            table: trap
        };
    }

})(null); // to define a fallback function, replace null with the name of the function (ex: alert) 
```

### 一些额外的信息

该行从对象`var args = Array.prototype.slice.call(arguments);`创建一个数组。`arguments`这是必需的，因为[arguments 并不是真正的 Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/arguments)。

`trap()`是任何 API 函数的默认处理程序。我将参数传递给，`message`以便您获得传递给任何 API 调用（不仅仅是`console.log`）的参数的日志。

### 编辑

我添加了一个额外的数组`console.raw`，它完全按照传递给`trap()`. 我意识到将对象转换为有时可能不受欢迎`args.join(' ')`的字符串。`"[object Object]"`感谢[bfontaine](https://stackoverflow.com/users/735926/bfontaine)的[建议](https://stackoverflow.com/review/suggested-edits/3077446)。

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2009-08-11T18:20:43.893

值得注意的是，`console.log`在 IE8 中并不是真正的 Javascript 函数。它不支持`apply`or`call`方法。

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2012-01-22T04:07:31.363

假设您不关心警报的后备，这里有一个更简洁的方法来解决 Internet Explorer 的缺点：

```
var console=console||{"log":function(){}}; 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2011-09-12T01:22:59.013

我真的很喜欢“orange80”发布的方法。它很优雅，因为您可以设置一次并忘记它。

其他方法要求您做一些不同的事情（`console.log()`每次都调用非普通的东西），这只是自找麻烦……我知道我最终会忘记。

我更进一步，将代码包装在一个实用函数中，您可以在 javascript 的开头调用一次，只要它在任何日志记录之前就可以调用。（我将其安装在我公司的事件数据路由器产品中。它将有助于简化其新管理界面的跨浏览器设计。）

```
/**
 * Call once at beginning to ensure your app can safely call console.log() and
 * console.dir(), even on browsers that don't support it.  You may not get useful
 * logging on those browers, but at least you won't generate errors.
 * 
 * @param  alertFallback - if 'true', all logs become alerts, if necessary. 
 *   (not usually suitable for production)
 */
function fixConsole(alertFallback)
{    
    if (typeof console === "undefined")
    {
        console = {}; // define it if it doesn't exist already
    }
    if (typeof console.log === "undefined") 
    {
        if (alertFallback) { console.log = function(msg) { alert(msg); }; } 
        else { console.log = function() {}; }
    }
    if (typeof console.dir === "undefined") 
    {
        if (alertFallback) 
        { 
            // THIS COULD BE IMPROVED… maybe list all the object properties?
            console.dir = function(obj) { alert("DIR: "+obj); }; 
        }
        else { console.dir = function() {}; }
    }
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-10-20T19:56:09.957

如果您的所有 console.log 调用都“未定义”，这可能意味着您仍然加载了旧的 firebuglite (firebug.js)。它将覆盖 IE8 的 console.log 的所有有效功能，即使它们确实存在。无论如何，这就是发生在我身上的事情。

检查覆盖控制台对象的其他代码。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-06-03T19:29:43.987

任何缺少控制台的浏览器的最佳解决方案是：

```
// Avoid `console` errors in browsers that lack a console.
(function() {
    var method;
    var noop = function () {};
    var methods = [
        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
        'timeStamp', 'trace', 'warn'
    ];
    var length = methods.length;
    var console = (window.console = window.console || {});

    while (length--) {
        method = methods[length];

        // Only stub undefined methods.
        if (!console[method]) {
            console[method] = noop;
        }
    }
}()); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-03-20T14:05:56.740

有这么多的答案。我的解决方案是：

```
globalNamespace.globalArray = new Array();
if (typeof console === "undefined" || typeof console.log === "undefined") {
    console = {};
    console.log = function(message) {globalNamespace.globalArray.push(message)};   
} 
```

简而言之，如果 console.log 不存在（或者在这种情况下，未打开），则将日志存储在全局命名空间数组中。这样，您就不会受到数百万条警报的困扰，并且您仍然可以在打开或关闭开发人员控制台的情况下查看您的日志。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-11-13T02:02:41.120

这是我的“IE请不要崩溃”

```
typeof console=="undefined"&&(console={});typeof console.log=="undefined"&&(console.log=function(){}); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-04-01T13:50:18.187

```
if (window.console && 'function' === typeof window.console.log) {
    window.console.log(o);
}

```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-08-23T11:44:05.617

我在[github](https://gist.github.com/sx/1793447)上找到了这个：

```
// usage: log('inside coolFunc', this, arguments);
// paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/
window.log = function f() {
    log.history = log.history || [];
    log.history.push(arguments);
    if (this.console) {
        var args = arguments,
            newarr;
        args.callee = args.callee.caller;
        newarr = [].slice.call(args);
        if (typeof console.log === 'object') log.apply.call(console.log, console, newarr);
        else console.log.apply(console, newarr);
    }
};

// make it safe to use console.log always
(function(a) {
    function b() {}
    for (var c = "assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","), d; !! (d = c.pop());) {
        a[d] = a[d] || b;
    }
})(function() {
    try {
        console.log();
        return window.console;
    } catch(a) {
        return (window.console = {});
    }
} ()); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-12-06T21:40:29.550

我从上面使用沃尔特的方法（见：[https](https://stackoverflow.com/a/14246240/3076102) ://stackoverflow.com/a/14246240/3076102 ）

我混合了我在这里找到的解决方案[https://stackoverflow.com/a/7967670](https://stackoverflow.com/a/7967670)以正确显示对象。

这意味着陷阱函数变为：

```
function trap(){
    if(debugging){
        // create an Array from the arguments Object           
        var args = Array.prototype.slice.call(arguments);
        // console.raw captures the raw args, without converting toString
        console.raw.push(args);
        var index;
        for (index = 0; index < args.length; ++index) {
            //fix for objects
            if(typeof args[index] === 'object'){ 
                args[index] = JSON.stringify(args[index],null,'\t').replace(/\n/g,'<br>').replace(/\t/g,'&nbsp;&nbsp;&nbsp;');
            }
        }
        var message = args.join(' ');
        console.messages.push(message);
        // instead of a fallback function we use the next few lines to output logs
        // at the bottom of the page with jQuery
        if($){
            if($('#_console_log').length == 0) $('body').append($('<div />').attr('id', '_console_log'));
            $('#_console_log').append(message).append($('<br />'));
        }
    }
} 
```

我希望这是有帮助的：-）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-04-22T14:38:53.067

我喜欢这种方法（使用 jquery 准备好的文档）......它甚至可以让你在 ie 中使用控制台......唯一的问题是，如果你在页面加载后打开 ie 的开发工具，你需要重新加载页面......

通过考虑所有功能，它可能会更流畅，但我只使用日志，所以这就是我所做的。

```
//one last double check against stray console.logs
$(document).ready(function (){
    try {
        console.log('testing for console in itcutils');
    } catch (e) {
        window.console = new (function (){ this.log = function (val) {
            //do nothing
        }})();
    }
}); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-10-02T00:41:10.007

这是一个在开发人员工具打开而不是关闭时将登录到控制台的版本。

```
(function(window) {

   var console = {};
   console.log = function() {
      if (window.console && (typeof window.console.log === 'function' || typeof window.console.log === 'object')) {
         window.console.log.apply(window, arguments);
      }
   }

   // Rest of your application here

})(window) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-10-13T15:34:06.163

在 html 中制作自己的控制台 .... ;-) 这可以改进，但您可以从以下开始：

```
if (typeof console == "undefined" || typeof console.log === "undefined") {
    var oDiv=document.createElement("div");
    var attr = document.createAttribute('id'); attr.value = 'html-console';
    oDiv.setAttributeNode(attr);

    var style= document.createAttribute('style');
    style.value = "overflow: auto; color: red; position: fixed; bottom:0; background-color: black; height: 200px; width: 100%; filter: alpha(opacity=80);";
    oDiv.setAttributeNode(style);

    var t = document.createElement("h3");
    var tcontent = document.createTextNode('console');
    t.appendChild(tcontent);
    oDiv.appendChild(t);

    document.body.appendChild(oDiv);
    var htmlConsole = document.getElementById('html-console');
    window.console = {
        log: function(message) {
            var p = document.createElement("p");
            var content = document.createTextNode(message.toString());
            p.appendChild(content);
            htmlConsole.appendChild(p);
        }
    };
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-27T15:40:23.483

它适用于 IE8。按 F12 打开 IE8 的开发者工具。

```
>>console.log('test')
LOG: test 
```

# asp.net - 使用 xml 响应附加条件 html 文件输出

> ID：690254
> 
> 赞同：0
> 
> 时间：2009-03-27T15:36:46.457
> 
> 标签：asp.net, xml, performance, compression

嘿伙计们，我有一个安静的 xml 服务，客户端通过他们正在查看的当前版本的 html。如果服务器上的版本与客户端相同，我只需使用 xml 中的当前服务器版本进行响应。例子：`<Response ServerHTMLVersion="1" />`

但是，如果服务器 html 版本大于当前客户端版本，我仍然会像上面一样吐出相同的响应`<Response ServerHTMLVersion="2" />`。但问题是我的客户端应用程序需要执行单独的 http 请求来下载 html 文件，以防响应 xml 版本大于客户端版本

出于性能原因，我想减少这个 http 请求，我想知道什么是最好的方法。我是否应该简单地对 html 进行编码以使其 xml 安全并将其附加到 xml 响应中 - 这是 html 的问题是 FAT 并且编码使它更胖

或者

有没有更好的方法来管理这个？请注意，我现在已经在压缩我对 xml 和 html 的响应

我想知道如何做到这一点，同时牢记性能。restful xml 服务是通过 asp.net 3.5 和 iis 7 实现的

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:46:15.933

您是否考虑过使用 HTTP 标头？因为这里真正的主要数据是 HTML，而 ServerHTMLVersion 是一种关于该 html 的“元数据”，它应该可以工作。

就个人而言，我会对请求做出响应：1）版本匹配时为空白，2）不匹配版本的 HTML；然后，使用 Pragma HTTP 标头发送类似 Pragma: "ServerHTMLVersion=2" 的内容。通过这样做，您可以轻松检查客户端和服务器版本是否不同，如果它们不同，只需获取完整响应。

有些人会争论从 REST 服务返回 HTML 的想法，但我个人认为这是完全有效的，并且是一种将元数据与实际用户数据分离的好方法。

-杰罗德

# php - 我怎样才能创建这样的肥皂标题？

> ID：690262
> 
> 赞同：3
> 
> 时间：2009-03-27T15:40:22.767
> 
> 标签：php, soap

对第 3 方应用程序进行一些 SOAP 调用。他们提供这个soap头作为应用程序期望的一个例子。如何在 PHP 中创建这样的 SOAP 标头？

```
<SOAP-ENV:Header>
    <NS1:Security xsi:type="NS2:Security" xmlns:NS1="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:NS2="urn:dkWSValueObjects">
        <NS2:UsernameToken xsi:type="NS2:TUsernameToken">
            <Username xsi:type="xsd:string">XXXX</Username> 
            <Password xsi:type="xsd:string">XXX</Password> 
        </NS2:UsernameToken>
    </NS1:Security>
</SOAP-ENV:Header> 
```

我做了我认为是正确的调用，并不断得到没有发送标题的回报。

这是我的代码中的一个示例。

```
class SOAPStruct 
{
    function __construct($user, $pass) 
    {
        $this->Username = $user;
        $this->Password = $pass;
    }
}

$client = new SoapClient("http://www.example.com/service");

$auth = new SOAPStruct("username", "password");
$header = new SoapHeader("http://example.com/service", "TUsernameToken", $auth);

$client->__setSoapHeaders(array($header));
$client->__soapCall("GetSubscriptionGroupTypes", array(), NULL, $header) 
```

这是我返回的 SOAP 标头。（它更多，但我剥离了可能敏感的信息）

```
<SOAP-ENV:Header>
    <ns2:TUsernameToken>
        <Username>username</Username> 
        <Password>password</Password> 
    </ns2:TUsernameToken>
</SOAP-ENV:Header> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T17:28:46.030

PHP 中的 SOAP 标头处理实际上不是很灵活，我想说的是，尤其是在标头中使用两个名称空间将使得不可能仅通过使用`SoapHeader`某种类型的 -construct 来注入标头。

我认为处理这个问题的最好方法是通过覆盖`SoapClient::__doRequest()`扩展的自定义类来自己塑造 XML 请求`SoapClient`。

```
class My_SoapClient extends SoapClient
{
    public function __doRequest($request, $location, $action, $version, $one_way = 0)
    {
        $xmlRequest = new DOMDocument('1.0');
        $xmlRequest->loadXML($request);

        /*
         * Do your processing using DOM 
         * e.g. insert security header and so on
         */

        $request = $xmlRequest->saveXML();
        return parent::__doRequest($request, $location, $action, $version, $one_way);
    }
} 
```

请参阅[`SoapClient::__doRequest`](http://de.php.net/manual/en/soapclient.dorequest.php)以获取更多信息和一些示例。

# bash - 为什么我不能在 bash 脚本中使用作业控制？

> ID：690266
> 
> 赞同：54
> 
> 时间：2009-03-27T15:40:33.810
> 
> 标签：bash, job-control

在[这个](https://stackoverflow.com/questions/687948#688836)对另一个[问题](https://stackoverflow.com/questions/687948)的回答中，有人告诉我

> 在脚本中你没有工作控制（并且试图打开它是愚蠢的）

这是我第一次听到这个，我仔细研究了作业控制（第 7 章）的 bash.info 部分，发现没有提到任何一个断言。[**更新：**手册页稍微好一点，提到了“典型”使用、默认设置和终端 I/O，但没有真正的理由说明作业控制对脚本特别不明智。]

那么为什么基于脚本的作业控制不起作用，是什么使它成为一种不好的做法（又名“愚蠢”）？

**编辑：**有问题的脚本启动一个后台进程，启动第二个后台进程，然后尝试将第一个进程放回前台，以便它具有正常的终端 I/O（就像直接运行一样），然后可以*从脚本之外*。不能对后台进程执行此操作。

正如另一个问题的[公认答案](https://stackoverflow.com/questions/687948#687994)所指出的，存在其他脚本可以解决该特定问题而无需尝试作业控制。美好的。被抨击的脚本使用了一个硬编码的工作编号——显然很糟糕。但我试图了解工作控制是否是一种从根本上注定要失败的方法。似乎它仍然*可以*工作......

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-27T15:46:21.020

他的意思是在非交互模式下（即在脚本中）**默认关闭作业控制。**

从`bash`手册页：

```
JOB CONTROL
       Job  control refers to the ability to selectively stop (suspend)
       the execution of processes and continue (resume) their execution at a
       later point.
       A user typically employs this facility via an interactive interface
       supplied jointly by the system’s terminal driver and bash. 
```

和

```
 set [--abefhkmnptuvxBCHP] [-o option] [arg ...]
      ...
      -m      Monitor mode.  Job control is enabled.  This option is on by
              default for interactive shells on systems that support it (see
              JOB CONTROL above).  Background processes run in a separate
              process group and a line containing their exit status  is
              printed  upon  their completion. 
```

当他说“很愚蠢”时，他的意思不仅是：

1.  是作业控制*，*主要用于促进交互式控制（而脚本可以直接与 pid 一起工作），但也
2.  我引用他的原始答案，*... 取决于您之前没有在脚本中开始任何其他工作的事实，这是一个不好的假设*。这是完全正确的。

**更新**

*回答您的评论：是的，没有人会阻止您在 bash 脚本中使用作业控制 -强制禁用* 没有硬性案例`set -m`（即，是的，如果您愿意，脚本中的作业控制将起作用。）请记住最后，特别是在脚本中，总是有不止一种方法可以给猫剥皮，但有些方法更便携、更可靠、更容易处理错误情况、解析输出等。

您的特定情况可能会或可能不会保证与`lhunath`（和其他用户）认为的“最佳实践”不同的方式。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2012-10-02T08:54:06.577

`bg`使用和的作业控制`fg`仅在交互式 shell 中有用。但`&`与 结合`wait`在脚本中也很有用。

在多处理器系统上，生成后台作业可以大大提高脚本的性能，例如在构建脚本中，您希望每个 CPU 至少启动一个编译器，或者使用 ImageMagick 工具并行处理图像等。

以下示例运行多达 8 个并行 gcc 来编译数组中的所有源文件：

```
#!bash
...
for ((i = 0, end=${#sourcefiles[@]}; i < end;)); do
    for ((cpu_num = 0; cpu_num < 8; cpu_num++, i++)); do
        if ((i < end)); then gcc ${sourcefiles[$i]} & fi
    done
    wait
done 
```

这没有什么“愚蠢”的。但是您将需要该[`wait`](http://en.wikipedia.org/wiki/Wait_%28command%29)命令，该命令在脚本继续之前等待所有后台作业。最后一个后台作业的 PID 存储在`$!`变量中，因此您也可以`wait ${!}`. 还要注意[`nice`](http://en.wikipedia.org/wiki/Nice_%28Unix%29)命令。

有时这样的代码在 makefile 中很有用：

```
buildall:
    for cpp_file in *.cpp; do gcc -c $$cpp_file & done; wait 
```

这提供了比 更精细的控制`make -j`。

请注意，它`&`是一个行终止符，例如`;`(write `command&` not `command&;`)。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-27T15:55:05.337

作业控制仅在您运行交互式 shell 时有用，即您知道标准输入和标准输出连接到终端设备（Linux 上的 /dev/pts/*）。然后，在前台放置一些东西，在后台放置一些其他东西等是有意义的。

另一方面，脚本没有这样的保证。脚本可以是可执行的，并且可以在不连接任何终端的情况下运行。在这种情况下，拥有前台或后台进程是没有意义的。

但是，您可以在后台以非交互方式运行其他命令（将“&”附加到命令行）并使用`$!`. 然后你`kill`用来杀死或挂起它们（在终端上模拟 Ctrl-C 或 Ctrl-Z，它的 shell 是交互式的）。您也可以使用`wait`（而不是`fg`）等待后台进程完成。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-04-14T20:30:13.123

在脚本中打开作业控制以在 SIGCHLD 上设置陷阱可能很有用。手册中的作业控制部分说：

> 每当作业更改状态时，shell 都会立即学习。通常，bash 会等到它即将打印提示时才会报告作业状态的变化，以免中断任何其他输出。如果启用了 set 内置命令的 -b 选项，bash 会立即报告此类更改。 **SIGCHLD 上的任何陷阱都会针对每个退出的子节点执行。**

（重点是我的）

以下面的脚本为例：

```
dualbus@debian:~$ cat children.bash 
#!/bin/bash

set -m
count=0 limit=3
trap 'counter && { job & }' CHLD
job() {
  local amount=$((RANDOM % 8))
  echo "sleeping $amount seconds"
  sleep "$amount"
}
counter() {
  ((count++ < limit))
}
counter && { job & }
wait
dualbus@debian:~$ chmod +x children.bash 
dualbus@debian:~$ ./children.bash 
sleeping 6 seconds
sleeping 0 seconds
sleeping 7 seconds 
```

*注意：从 bash 4.3 开始，CHLD 捕获似乎已被破坏*

但是，在 bash 4.3 中，您可以使用 'wait -n' 来实现相同的目的：

```
dualbus@debian:~$ cat waitn.bash 
#!/home/dualbus/local/bin/bash

count=0 limit=3
trap 'kill "$pid"; exit' INT
job() {
  local amount=$((RANDOM % 8))
  echo "sleeping $amount seconds"
  sleep "$amount"
}
for ((i=0; i<limit; i++)); do
  ((i>0)) && wait -n; job & pid=$!
done
dualbus@debian:~$ chmod +x waitn.bash 
dualbus@debian:~$ ./waitn.bash 
sleeping 3 seconds
sleeping 0 seconds
sleeping 5 seconds 
```

您可能会争辩说还有其他方法可以以更便携的方式执行此操作，即无需 CHLD 或等待 -n：

```
dualbus@debian:~$ cat portable.sh 
#!/bin/sh

count=0 limit=3
trap 'counter && { brand; job & }; wait' USR1
unset RANDOM; rseed=123459876$$
brand() {
  [ "$rseed" -eq 0 ] && rseed=123459876
  h=$((rseed / 127773))
  l=$((rseed % 127773))
  rseed=$((16807 * l - 2836 * h))
  RANDOM=$((rseed & 32767))
}
job() {
  amount=$((RANDOM % 8))
  echo "sleeping $amount seconds"
  sleep "$amount"
  kill -USR1 "$$"
}
counter() {
  [ "$count" -lt "$limit" ]; ret=$?
  count=$((count+1))
  return "$ret"
}
counter && { brand; job & }
wait
dualbus@debian:~$ chmod +x portable.sh 
dualbus@debian:~$ ./portable.sh 
sleeping 2 seconds
sleeping 5 seconds
sleeping 6 seconds 
```

因此，总而言之，set -m在脚本中并**没有**那么有用，因为它为脚本带来的唯一有趣的特性就是能够使用 SIGCHLD。还有其他方法可以实现同样的事情，或者更短（等待 -n）或更便携（自己发送信号）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T15:46:51.067

正如您所说，Bash 确实支持作业控制。在编写 shell 脚本时，通常假设您不能依赖于您拥有 bash 的事实，而是拥有 vanilla Bourne shell ( `sh`)，它在历史上没有作业控制。

这些天我很难想象一个系统，其中你真的被限制在真正的 Bourne shell 中。大多数系统`/bin/sh`将链接到`bash`. 不过，这是可能的。您可以做的一件事是而不是指定

```
#!/bin/sh 
```

你可以做：

```
#!/bin/bash 
```

那，以及您的文档，将清楚您的脚本需要`bash`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-29T09:22:09.053

可能是 o/t，但我经常在 ssh 进入长期运行的工作的服务器时使用 nohup，这样如果我退出，工作仍然可以完成。

我想知道人们是否会混淆从主交互式 shell 停止和启动并产生后台进程？wait 命令允许你生成很多东西，然后等待它们全部完成，就像我说的那样，我一直使用 nohup。它比这更复杂，也没有得到充分利用 - sh 也支持这种模式。看看手册。

你也有

```
kill -STOP pid 
```

如果我想暂停当前正在运行的 sudo，我经常会这样做，例如：

```
kill -STOP $$ 
```

但是，如果您从编辑器跳出到外壳，那么您就有祸了——它只会坐在那里。

我倾向于使用助记符 -KILL 等，因为有打字的危险

```
kill - 9 pid # note the space 
```

在过去，您有时可以将机器关闭，因为它会杀死 init！

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-05-24T11:29:49.727

工作确实在 bash 脚本中工作

但是，您...需要注意生成的员工，例如：

```
ls -1 /usr/share/doc/ | while read -r doc ; do ... done 
```

工作将在 | 的每一侧都有不同的上下文

绕过这个可能会使用 for 而不是 while：

```
for `ls -1 /usr/share/doc` ; do ... done 
```

这应该演示如何在脚本中使用作业......并提到我的评论是......真实的（不知道为什么这种行为）

```
 #!/bin/bash

for i in `seq 7` ; do ( sleep 100 ) &  done

jobs

while [ `jobs | wc -l` -ne 0 ] ; do

    for jobnr in `jobs | awk '{print $1}' | cut -d\[ -f2- |cut -d\] -f1` ; do
        kill %$jobnr
    done
    #this is REALLY ODD ... but while won't exit without this ... dunno why
    jobs >/dev/null 2>/dev/null
done

sleep 1
jobs 
```

# ruby-on-rails - 使用 Rails 验证助手 :message 但不希望在消息中列出列名

> ID：690267
> 
> 赞同：21
> 
> 时间：2009-03-27T15:40:41.783
> 
> 标签：ruby-on-rails, validation

使用 Rails 验证助手——

```
validates_xxx_of :the_column, :message => "my message" 
```

将生成一条验证消息：

*the_column 我的消息*

有没有办法关闭列名的包含？（用任何验证辅助方法替换 xxx）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-11-24T15:22:39.240

我知道这个问题很老了。但仅供参考，以防其他人像我一样绊倒它。

至少在 Rails 3.0.x（不确定早期版本）中，您可以使用前导 ^ ，如 RadBrad 所示，无需任何 gem/插件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-12-03T01:42:44.237

## 铁轨 4个答案

看看这里的代码：

[https://github.com/rails/rails/blob/master/activemodel/lib/active_model/errors.rb#L374](https://github.com/rails/rails/blob/master/activemodel/lib/active_model/errors.rb#L374)

因此，您可以在 en.yml 文件中设置：

```
en:
  errors:
    format: '%{message}' 
```

这意味着您还需要在其他任何地方设置完整的错误消息，但我想这更可取。请注意，我发现这令人困惑，错误格式不在 ActiveRecord 命名空间中，我通常将其余的错误消息放在其中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-07-24T15:33:56.607

有一个客户错误消息宝石应该做你想做的事

[https://github.com/jeremydurham/custom-err-msg](https://github.com/jeremydurham/custom-err-msg)

它允许您覆盖正常的消息构造，并自己定义完整的消息，如下所示：

:message=> "^ 你的邮箱地址好像有点乱，请再试一次"

注意 ^ 字符，它告诉 rails 不要在前面添加任何内容，只需完全按照定义使用消息（除了它删除了 ^）

如果你不放一个前导 ^，那么你会得到正常的 rails 生成的错误消息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-07T22:49:00.390

这是我能找到的最好的解释。

[http://adamhooper.com/eng/articles/5](http://adamhooper.com/eng/articles/5)

本质上，在初始化程序中，如果您在验证中提供 :message 属性，则更改 ActiveRecord.Errors 中的 full_messages 方法以返回完整的句子（不是 column_name、消息连接）。

**更新**- 如果您尝试 Adam 的代码，则必须使用 en.yml 属性文件，否则将无法按预期工作。您可以执行此操作，也可以通过进一步修改 full_messages 方法来绕过它。这对我有用。我将以下内容添加到初始化程序（/imitializers/active_record_errors.rb）

```
if RAILS_GEM_VERSION =~ /^2\.3/
  ActiveRecord::Errors.class_eval do
    # Remove complicated logic
    def full_messages
      returning full_messages = [] do
        @errors.each_key do |attr|
          @errors[attr].each do |message|
            next unless message
            if attr == "base"
              full_messages << message
            elsif message =~ /^\^/
              full_messages << $'            #' Grabs the text after the '^'
            else 
              attr_name = @base.class.human_attribute_name(attr)
              full_messages << attr_name + I18n.t('activerecord.errors.format.separator', :default => ' ') + message 
            end  
          end 
        end 
      end 
    end 
  end 
end 
```

Adam 还为修改 Rails 以支持国际化工作提出了很好的论据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-28T22:14:53.163

在 rails 2 中，您可以在模型上执行以下操作：

```
validate :test_validation

private

def test_validation
  if error_condition
    errors.add_to_base("Message")
  end
end 
```

在 Rails 3 或更高版本中：

```
validate :test_validation

private

def test_validation
  if error_condition
    errors[:base] << "Message"
  end
end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-20T18:00:47.930

为什么不简单地使用@object.errors 哈希？！

在验证部分中更改消息：

> validates_uniqueness_of :foobar, :message => "foobar 不是唯一的。"

接着，

> @foo.errors.to_a

你会得到一个很好的数组，其中第二个条目是错误消息本身。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-17T23:35:44.423

rubyforge 的链接不起作用，这是 github 上的自定义错误消息插件：

[http://github.com/gumayunov/custom-err-msg](http://github.com/gumayunov/custom-err-msg)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-20T23:59:32.943

我这样做的方法是覆盖所有消息，而不是使用 Rails 表单助手来显示错误消息。

这看起来像是很多工作，但它实际上有一些不错的好处。您可以完全控制消息，然后您可以实现一个自定义表单构建器，该构建器可以将错误消息内联，这对用户来说更好。

你像这样使用它：

`validates_uniqueness_of :foobar, :message => "The foobar isn't unique."`

`full_messages`然后在打印错误信息时不要使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-28T20:57:12.373

我对 RoR 3.0.3 也有同样的问题。如果没有属性名称，我找不到显示验证消息的方法。Swards 之前发布的代码对我不起作用，但这是一个好的开始。

我将以下代码放在 config/initializers 文件夹中的 RB 文件中：

```
ActiveModel::Errors.class_eval do
  # Remove complicated logic
  def full_messages
    full_messages = []

    each do |attribute, messages|
      messages = Array.wrap(messages)
      next if messages.empty?

      if attribute == :base
        messages.each {|m| full_messages << m }
      else
        attr_name = attribute.to_s.gsub('.', '_').humanize
        attr_name = @base.class.human_attribute_name(
          attribute,
          :default => attr_name
        )

        options = { :default => "%{message}", :attribute => attr_name }

        messages.each do |m|
          full_messages << I18n.t(:"errors.format", options.merge(:message => m))
        end
      end
    end
    full_messages      
  end 
end 
```

*这将从所有*消息中删除属性的名称，这正是我想要做的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-09-14T19:29:40.010

## Rails 3.2 面向未来的解决方案

对于那些在这里偶然发现（并且可能滚动到底部）寻找如何在更高版本的 Rails 中执行此操作的人，这里有一些好消息：在合并此[拉取请求后，在 Rails 4 中执行此操作将非常简单。](https://github.com/rails/rails/pull/7369)对于某些场景，它可能需要一些额外的修饰，但这里已经取得了进展。

在那之前，您可以使用拉取请求在您的项目中对 Rails 进行猴子补丁 :)

```
class ActiveModel::Errors
  def full_message(attribute, message)
    return message if attribute == :base
    attr_name = attribute.to_s.tr('.', '_').humanize
    attr_name = @base.class.human_attribute_name(attribute, :default => attr_name)
    I18n.t(:"errors.formats.attributes.#{attribute}", {
      :default   => [:"errors.format","%{attribute} %{message}"],
      :attribute => attr_name,
      :message   => message
    })
  end
end 
```

并将以下内容添加到您的语言环境文件中：

```
en:
  errors:
    formats:
      attributes:
        name: '%{message}' 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-02-06T14:22:33.110

我发现这个答案更有用：

[使用单表继承验证多个子类之间的唯一性](https://stackoverflow.com/questions/3018482/validate-uniqueness-amongst-multiple-subclasses-with-single-table-inheritance)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-02-03T21:20:51.150

这是一个相当简单的实现，应该可以解决问题。值得注意的是，它只影响单个模型（与我见过的大多数基于语言环境的技巧不同）并且不是太笨拙......它只是修改了一个对象：

```
class Widget < ActiveRecord::Base
  validates_numericality_of :quantity, greater_than: 0, message: "numericality"

  def errors
    super.tap do |e|
      e.extend(FixQuantityErrorMessage)
    end
  end

  module FixQuantityErrorMessage
    def full_message(attribute, message)
      if attribute.to_s == 'quantity' && message == "numericality"
        "You need at least one!"
      else
        super
      end
    end
  end
end 
```

# javascript - SVG 鼠标指针位置

> ID：690283
> 
> 赞同：2
> 
> 时间：2009-03-27T15:44:03.647
> 
> 标签：javascript, pointers, svg, location, mouseevent

我想知道当鼠标指针在 SVG viewBox 的范围内时，如何使用 JavaScript 找出鼠标指针的位置。我是否需要使用事件模型来跟踪所有各种鼠标运动事件，或者有没有办法可以轮询鼠标指针，让它在我需要的时候告诉我它在哪里？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T11:17:59.393

您可以挂钩`onmousemove`事件并访问事件对象：

```
function on_mouse_move(evt) {
  var
    x = evt.clientX,
    y = evt.clientY;
} 
```

（这假设`on_mouse_move`连接到`onmousemove`您的 SVG 文档的事件）。

# ruby-on-rails - Rails STI 控制器

> ID：690284
> 
> 赞同：2
> 
> 时间：2009-03-27T15:44:16.873
> 
> 标签：ruby-on-rails, ruby

我有一个使用具有以下类的 STI 的 Rails 站点：

页面

首页 < 页数

登陆页面 < 页面

在前端，所有请求都由 Pages 控制器处理。但是，如果检测到的对象实际上是 LandingPage 的一个实例，我希望调用 LandingPages 控制器上的操作。（例如，子控制器类中的 show 方法将引入一些并不总是相关的特定查找）。

关于如何最好地做到这一点的任何建议？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T16:04:07.233

这听起来有点像你在混淆 MVC 的区别，但它应该是可行的。

我会在 Pages 模型上添加一系列测试（例如`supports_buzzbar_foo?`或`wiggums_itemization_controller`，然后在子类中根据需要覆盖它们）并在视图中使用这些测试有条件地生成指向所需控制器方法的适当链接。

这样，您就可以（大致）保持每个部分都在工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T20:58:28.310

Markus 的解决方案应该有效。您还可以将链接保留在指向 Pages 的视图中，评估传入对象，然后根据对象类重定向到适当的控制器。

但是，除非您对每种类型的对象执行完全不同的操作，否则您最终会在控制器中使用重复的代码。因此，您最好还是坚持使用 Pages 控制器并添加一些方法来处理该对象所需的额外查找。

# java - OpenGL、Java 和内存管理

> ID：690293
> 
> 赞同：2
> 
> 时间：2009-03-27T15:45:56.917
> 
> 标签：java, opengl, garbage-collection

在 Java 中使用 openGL（在 jogl 之类的绑定中）时，您是否需要担心内存管理？JVM 是否对创建的 openGL 对象进行垃圾收集？如果是这样，进行清理的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T17:19:34.243

在像 JOGL 这样的 OpenGL 的低级绑定中（但对于像 Java3D 这样的库可能不是那么多），您必须通过调用`glDelete`函数自己管理诸如纹理和缓冲区之类的资源。

OpenGL 会在渲染需要时将纹理移入和移出显存。Java 垃圾收集器没有实用的方法来收集这些资源，因为一旦它们被移交给 OpenGL，它们就不会被表示为 Java 对象。是的，这意味着您必须保留 OpenGL 使用的资源列表。

好消息是，您可以将比您想象的更多的资源加载到 OpenGL 中，因为它会在需要时将它们交换到视频内存并在不需要时将它们交换回主内存。坏消息是，在没有这种“抖动”的情况下，可用于渲染帧的资源（例如纹理）的大小和数量仍然存在实际限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T15:55:10.343

我认为这有点依赖于“胶水”或绑定，它如何选择实现所有权。

一般来说，我希望绑定坚持 OpenGL 语义，这意味着 JVM 不参与垃圾收集由 OpenGL 库保存的数据。

在许多情况下，例如纹理上传，我认为这是唯一可行的方法。

# asp.net - 系统未定义 IE8 中的 HTTPS url

> ID：690295
> 
> 赞同：0
> 
> 时间：2009-03-27T15:46:11.287
> 
> 标签：asp.net, ajax, internet-explorer-8

我刚刚在 IE8 中发现了一个相当特殊的 HTTPS 链接问题。每次页面尝试访问 HTTPS 链接时，都会产生错误。这只发生在 IE8 中，没有别的。知道发生了什么吗？我发现一些项目说这意味着文件没有加载，因此问题并尝试了一些建议的修复程序，但到目前为止它们还没有工作。顺便说一下，这是一个 .NET 站点。 [https://www.beckshoes.com/cart/cart.aspx](https://www.beckshoes.com/cart/cart.aspx)

```
Message: 'Sys' is undefined
Line: 70
Char: 1
Code: 0
URI: https://www.beckshoes.com/cart/cart.aspx

Message: 'Sys' is undefined
Line: 319
Char: 1
Code: 0
URI: https://www.beckshoes.com/cart/cart.aspx 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T18:02:02.597

看起来是 JavaScript 错误。Firefox 处理得很好，但 Sys 在 IE8 中未定义，所以我猜测它通常被定义的部分在 IE 中丢失了？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T21:50:46.697

使用视图 > 源。

是`<script src="...">`来自`https`服务器，还是来自`http`？IE8 可能不会加载脚本，因为它不是来自与页面其余部分相同的安全源。将`<script src="...">`（如果它不包括协议和服务器，使用与页面来源相同的）并将其粘贴到新选项卡的地址栏中，脚本是否加载/下载？

加载适当库的`<script src="...">`标签是否甚至列在源代码中？也许它没有被添加，因为 ASP.NET 不识别用户代理并且不认为它有能力或其他什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T10:08:47.423

Sys 是 Microsoft 脚本库的一部分，通过 WebResource.axd 文件加载。

对我来说，您的页面似乎主要在 IE 8 中运行 - 您修复了吗？

我看到您正在页面底部加载 WebResource - 如果在加载脚本之前发生初始化调用，那么这将是导致它的原因 - 您是否故意将其移至页脚？脚本管理器具有正确执行此操作的属性：[LoadScriptsBeforeUI](http://msdn.microsoft.com/en-us/library/system.web.ui.scriptmanager.loadscriptsbeforeui.aspx)。将此设置为 false 会将那些可以移动到页面底部的脚本移动。

我注意到您还将视图状态推到了那里，因此您显然正在对 html 进行一些后期处理。

我唯一能想到的另一件事是，查看您的页面，您有一个 IFrame 持有品牌旋转器，即从[http://www.beckshoes.com/brands.aspx请求它的内容](http://www.beckshoes.com/brands.aspx)

您也确实希望在 https 下也能做到这一点-这可能无济于事。

# c# - 如何轻松地将 DbDataReader 对象转换为有用的东西？

> ID：690299
> 
> 赞同：0
> 
> 时间：2009-03-27T15:46:53.110
> 
> 标签：c#, entity-framework, datareader, dbdatareader

我正在使用实体框架 EntityConnection 手动调用存储过程，如下所示：

```
DbConnection storeConnection = entityConnection.StoreConnection;
DbCommand command = storeConnection.CreateCommand();
command.CommandText = "sp_GetMyComplexData";
command.CommandType = CommandType.StoredProcedure;

DbDataReader reader = command.ExecuteReader(); 
```

这样做的原因是实体框架不容易支持不直接映射到表或视图的实体。我找到了这篇文章 ( [http://dotnet.dzone.com/news/mapping-stored-procedure](http://dotnet.dzone.com/news/mapping-stored-procedure) )，但它需要编辑 XML，我想避免这种情况。

就我而言，我只是在运行一个使用 LEFT JOIN 连接两个表的查询。这样做的原因是因为我试图将结果绑定到 Telerik RadGrid，它不支持分层数据导出，但似乎支持分组数据导出。

问题是，如何将 DbDataReader 对象转换为可以绑定到 RadGrid 的有用对象？我一直在我的 DAL 方法中传递单个对象或 IQueryable 对象。有任何想法吗？提前致谢？

**编辑：**

我只需要数据。之后我不需要做任何插入、更新、删除。它是一个只读视图。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:51:15.703

我不了解 RadGrid，但您可以将该数据读取器绑定到内置网格控件，如 GridView。您只是不能将其用于更新、删除或插入。

否则，您可以使用数据表的 .Load() 方法将其转换为数据表。但是您仍然需要知道如何手动进行插入/更新/删除。

# html - 处理内联 ul 时如何填充剩余空间？

> ID：690301
> 
> 赞同：1
> 
> 时间：2009-03-27T15:47:26.820
> 
> 标签：html, css

我用这个 CSS 让我的 UL 看起来很漂亮

```
ul, li
{
  padding: 0px;
  margin-left: 0px;
  margin-bottom: 0px;
  display: inline;
}

li
{
  border: solid 1px #333333;
  margin-right: 5px;
  padding: 2px;
  background-color: #222222;
  color: #999999;
} 
```

我想要一个具有相同图形样式的最终空列表项来填充内联的剩余空间。就像是

[A项] [B项] [C项] [-----大空一个---------]

有可能算出你还剩下多少空间吗？您能否将列表项之一设置为宽度为 100% 或其他内容？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:49:46.877

您可以在 UL 上使用背景颜色/图像，并使 UL 和 LI 具有相同的高度以产生这种效果

# java - 学术合作的开源平台

> ID：690303
> 
> 赞同：5
> 
> 时间：2009-03-27T15:47:34.760
> 
> 标签：java, php, open-source, forum, collaboration

我正在计划一个协作平台，供来自 20 个不同国家的学者在同一研究领域进行合作。理想情况下，我想将我的工作建立在可以扩展以满足所有要求的现有开源平台上。

最终平台有以下要求：

*   综合留言板
*   支持文件上传，分享新的研究论文等。
*   即将举行的会议等的共享日历。
*   具有提醒支持的任务列表
*   邮件列表支持

此外，该平台将托管在 Linux 环境中。理想情况下，它将使用 MySQL 作为底层数据库。编程语言可以是 Java 或 PHP，其中 Java 是首选。

我的问题：**是否有任何开源协作平台可以满足上述要求？你有什么建议？**

提前非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:48:58.937

*   [Zoho.com](http://www.zoho.com) - 免费托管解决方案（如果您需要比维护自己的协作门户更简单的解决方案）

*   [PHPCollab](http://www.php-collab.org/) - 开源项目，可扩展。

*   [Dimdim](http://www.dimdim.com/products/dimdim_features.html)是一款简单、开放且价格合理的 Web 协作软件，并带有一组强大的强大功能，并且不断变得更好。Dimdim 可扩展到数千名与会者，提供世界一流的可用性，并提供多种托管和现场配置，包括可下载的开源和免费托管版本。

*   [Mindquarry](http://www.mindquarry.com/)是一个开源协作软件平台，用于文件共享（文档、图像、媒体文件等）、任务和项目管理、团队协作和 Wiki 编辑，它融合了简单性和功能性。因此，知识工作者能够与团队成员联系并从任何地方共享信息，从而有效地改善团队合作并提高公司内部的生产力。

以防万一，这里是[Wikipedia.org 上的协作软件列表](http://en.wikipedia.org/wiki/List_of_collaborative_software)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T15:51:19.120

[Plone](http://plone.org/)可能会满足您的许多要求，尽管您可能需要获取一些插件。

# .net - 将 app.config 与类库一起使用

> ID：690313
> 
> 赞同：54
> 
> 时间：2009-03-27T15:52:25.153
> 
> 标签：.net, configuration

我经常需要创建一个 .Net 类库，该类库需要一个 app.config 来处理数据库连接字符串等内容。但是，这些设置必须在调用应用程序的 app.config 或 web.config 中。如果我想将 DLL 分布在多个应用程序中，这将变得很痛苦，因为我必须将这些设置复制到每个应用程序的 app.config 中。

我考虑过通过类库中的代码手动读取配置设置，但这也是一个主要的痛苦。有没有人对在类库中加载 app.config 设置的最佳方式有任何建议？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-27T16:08:32.090

我知道这不是您想听到的，但入口点的配置文件是放置这些设置的合理位置。如果每个库都需要自己的配置文件，那么必须编辑每个文件而不是一个文件会很乏味。

我会有一个包含默认设置的文本文件，作为库的一部分（以及项目的一部分），它可以与库一起分发以进行默认设置配置（可以复制并粘贴到配置文件中）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-27T16:14:04.557

您可以做的一件事是为您的库创建一个单独的设置文件，然后您只需在您的入口应用程序配置文件中引用它即可。

有关这方面的信息，请参阅[此问题](https://stackoverflow.com/questions/396139/create-your-own-settings-in-xml)中已[接受的答案](https://stackoverflow.com/questions/396139/create-your-own-settings-in-xml/396144#396144)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T16:19:06.790

让每个类库在自定义 ConfigurationSection 中定义配置设置。

然后将自定义部分处理程序添加到您的 process.exe.config 文件。

[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)的解释非常全面，包括 VB 和 C# 中的示例。

它涉及编写一些非常重复的代码 - Dmitryr 创建了[这个工具](http://blogs.msdn.com/dmitryr/archive/2005/10/02/476245.aspx)来从 XML 配置的片段生成配置部分，这可能会有所帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-25T15:17:58.967

这是一个替代方案。

首先不要试图找到“合并”你的 app.configs 的方法，或者甚至将配置项放在你的 DLL 中（并试图解决“设计”的问题），试试这个：

创建您的 DLL，但在您需要配置项的地方，创建一个公共属性。当您在 DLL 中实例化该类时，您使用来自拥有应用程序的配置项填充这些属性。

现在配置在所有者级别进行管理，并且 DLL 是可移植的，因为您必须在运行时将所需的内容传递给它。

没有更多的 DLL.config！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-03-28T08:46:52.857

转到应用程序属性-> 设置选项卡；在那里添加您的设置。

用于`Properties.Settings.Default.<SettingName>`访问设置。就是这样！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-23T17:11:32.767

为每个类库使用自己的配置文件不是（大）问题。如果您使用 vb.net，您可以通过“设置”页面上的“我的项目”面板添加值。

您唯一需要做的就是在您的类库设置上调用“My.Settings.Save”（而不仅仅是在您的主应用程序设置文件上）。

这也适用于 c#（但可能需要更多的手动工作）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-02T21:45:33.920

如果您使用的是**NUnit**，请将 app.config 文件命名为与 *.nunit 项目文件名相同的名称。例如，如果您将项目命名为“ClassLibraryA.nunit”，则将您的类库配置文件命名为“ClassLibraryA.config”。它们还需要驻留在同一文件夹/目录中。NUnit 实际上就是使用这个作为主要的配置文件。

如果您有**自定义代码**，那么您需要确保您的 app.config（或 web.config）引用了类库的 app.config 文件。应用程序只关心根 app.config 或 web.config。因此，您需要添加一个指向类库 app.config 的自定义配置部分。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-07-31T19:36:26.357

您可以创建自己的 XML 文件（如果需要，可以将其称为 appConfig.xml 或其他名称），使用 System.Xml 而不是 System.Configuration 来读取它，并将其与您的 dll 一起包含。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-08-07T14:04:40.057

在不同的解决方案中创建您的类库。如果将它们保留在同一个解决方案中，则将读取最高层次结构的 app.config。

# c# - lucene .net 在哪里缓存搜索结果？

> ID：690318
> 
> 赞同：1
> 
> 时间：2009-03-27T15:53:32.563
> 
> 标签：c#, asp.net, lucene.net

我试图弄清楚 Lucene 将缓存的查询结果存储在哪里，以及它是如何配置的——以及它缓存了多长时间。

这是针对 ASP.NET 3.5 解决方案的。

我遇到了这个问题：
如果我运行搜索并按特定产品字段对结果进行排序，它似乎在第一次使用每个搜索和排序组合时起作用。如果我然后进入并更改一些产品属性，重新索引并运行相同的搜索和排序，我会以与第一个结果相同的顺序返回产品。

## 例子

产品 A 被命名为： foo
产品 B 被命名为： bar

对于第一次搜索，按名称 desc 排序。这导致：

1.  产品A
2.  产品B

现在稍微混合一下数据：

1.  将名称更改为：
    产品 A 命名： bar
    产品 B 命名： foo
2.  重新索引
3.  验证索引是否包含这两个产品的更改。
4.  搜索

结果：

1.  产品A
2.  产品B

由于我更改了名称的字母顺序，因此我期望：

1.  产品B
2.  产品A

所以我认为 Lucene 正在缓存搜索结果。（顺便说一句，这是一件非常*好的*事情。）我只需要知道在哪里/如何清除这些结果。我尝试删除索引文件并执行 IISreset 以清除内存，但似乎没有效果。所以我认为在 Lucene 用于缓存的索引之外还有另一组 Lucene 文件。

# 编辑

我刚刚发现您必须为要作为未标记化排序的字段创建索引。我将该字段标记为标记，因此排序不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T16:25:05.717

Lucene.net 通过使用 QueryFilters 有一个简单的缓存机制。当您的索引发生更改并且您想要反映它的更改时，您需要关闭并重新打开 IndexSearcher

# lamp - 虚拟 PC LAMP 服务器

> ID：690320
> 
> 赞同：0
> 
> 时间：2009-03-27T15:54:42.043
> 
> 标签：lamp, redhat, virtual-pc

我在我的开发机器（XP pro）上本地设置了一个 RedHat6 LAMP 服务器的镜像以进行测试。

我正在尝试对其进行配置，以便可以连接到它。但是我遇到了问题。

我给图像分配了一个静态 IP 地址 192.168.1.5。httpd 服务正在运行，在 RH6 中我可以通过访问[http://192.168.1.5/](http://192.168.1.5/)查看 apache 测试页面。

我也可以从 windows cmd 行成功 ping virtualpc。但是，当我尝试从 Windows 访问测试页面时，它最终会超时。

我已经尝试过共享网络、仅限本地和 VirtualPC 设置中的物理适配器。只有物理适配器允许我 ping 虚拟 PC。

我需要做什么才能成功地将其用作测试服务器？

**注意**：我不能用 < *insert-your-favourite-distro-here* > 替换 RH6，但如果你能证明从 VirtualPC 切换的好处，那么我可能会这样做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T18:48:57.867

也许你需要在 RH6 中通过防火墙打开 80 端口。我面前没有运行 RH6，但我认为它在系统设置 -> 安全或其他菜单中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T15:56:48.060

您在 windows 中的浏览器是否使用代理服务器？如果是这样，请确保 192.168.1.5 在排除列表中。

# unit-testing - 你如何测试你自己写的代码？

> ID：690325
> 
> 赞同：3
> 
> 时间：2009-03-27T15:55:17.580
> 
> 标签：unit-testing, testing

您如何有效地测试您编写的代码？我发现很难对我为我的网站编写的代码进行老虎测试，因为我的一部分人觉得我不想在我的代码中找到错误，因为这表明我并不完美。（即使写我可能不完美也让我有点烦恼。）

我相信单元测试，但最近我变得有点像枪手，并且一直在将大量代码部署到生产环境中（这对新的网络创业公司来说并不总是坏事，但通常是。）

在过去的几周里，我被我自己的测试得到的严重错误所困扰。我有一个合作伙伴，我推动黑盒测试我自己的代码，但由于我对实现细节的了解，我真的应该是使用白盒测试测试代码弱点的最佳人选。

那么有哪些方法和工具可以帮助您测试自己编写的代码呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T15:58:15.030

在代码之前编写测试会有所帮助，因为我可以思考（没有头脑中的实现设置的偏见）代码在各种条件下的行为应该是什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T16:00:58.317

好的，这就去。

1.  你并不完美。我并不完美。没有人是完美的。所以不用担心暴露错误。你发现自己越多，而不是让别人为你找到他们，你就越接近完美。

2.  尽可能养成在代码之前编写测试的习惯。定义代码应该对一组有意义的测试做什么，然后编写代码以使测试通过。然后重构 - 经典的 TDD。

3.  如果有错误，则立即编写一个暴露错误的测试（即应该通过，但由于错误而失败）。然后让测试通过，你就修复了这个错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T16:44:25.187

总结一下：

TDD：

1.  在编写代码之前，编写一个单元测试来接收输入并检查输出。
2.  编写代码*只是*为了使单元测试通过——不多也不少。
3.  对您正在使用的每种方法重复此操作。

回归：

1.  每次提交更改/功能/修复时，运行所有单元测试。
2.  对于每个失败的单元测试，请转到 BUG FIX

错误修复：

1.  每次发现错误时，编写一个单元测试来揭示错误。
2.  实施导致单元测试通过的修复程序。

功能测试：

1.  找到一个不错的功能测试框架（例如用于 web 测试的[selenium ）](http://seleniumhq.org/)
2.  创建一些测试，帮助您锻炼应用的端到端功能
3.  使用 REGRESSION 和 BUG FIX 过程查找和修复测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T16:00:32.607

我已经开始为我所有大于 20 行代码的个人项目编写代码之前的单元测试。它有很大帮助。

现在，当人们说他们讨厌单元测试和 TDD 时，我总是感到惊讶。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T16:06:53.980

首先你应该注意输入的所有可能性，然后你必须测试所有的可能性。您可以找到我们的错误，它会清除很多错误。我只使用这种方式，到目前为止我对工具一无所知

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T07:55:11.570

1.  如果你做 TDD，你可能会写测试代码，忘记它一周，然后再写生产代码。因此，您将重新考虑您的方法是否正确。
2.  避免尴尬。如果您在代码中发现错误并且能够修复它，那么没有人可以指责您编写了糟糕的代码。

# cocoa - 如何在我的 Cocoa 应用程序中获得系统时间更改的通知？

> ID：690326
> 
> 赞同：11
> 
> 时间：2009-03-27T15:55:40.483
> 
> 标签：cocoa, nsnotifications

我有一个记录事件日期戳的 Cocoa 应用程序。我需要知道系统时间何时重置以及重置多少，但我似乎无法在任何地方通知我这样的事情发生了。由于 NTP 重置时钟或用户重置（例如从系统偏好设置），可能会发生此更改。如果只有一个`NSNotification`我可以注册接收，那就太好了，但我愿意接受任何建议。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-10-26T02:39:28.807

Apple在 Snow Leopard (10.6) 中添加了 NSDate 的一部分[**NSSystemClockDidChangeNotification 。**](https://developer.apple.com/documentation/foundation/nssystemclockdidchangenotification)在 Leopard (10.5) 或更早版本中似乎没有办法做到这一点。根据[Apple NSDate 文档](http://developer.apple.com/mac/library/documentation/Cocoa/Reference/Foundation/Classes/NSDate_Class/Reference/Reference.html)：

> 每当更改系统时钟时发布。这可以通过调用 settimeofday() 或用户更改 Date and Time Preference 面板中的值来启动。通知对象为空。此通知不包含 userInfo 字典。

这似乎并没有告诉你“多少”时间发生了变化。您可以通过定期（例如，在 a 中每 5 秒`NSTimer`）捕获系统时间`[NSDate date]`，将其保存到变量中，然后在`NSSystemClockDidChangeNotification`触发后，获取新日期并使用 NSDate 的**`timeIntervalSinceDate:`**方法将两者进行比较以获得差异来计算。

不是毫秒甚至秒精度，但非常接近。

**编辑：** 见[这篇文章](https://stackoverflow.com/questions/1627764/calculating-number-of-seconds-between-two-points-in-time-in-cocoa-even-when-sys)。您可以使用`UpTime()`C 命令来获取 CPU 抽动中的系统正常运行时间（稍后您可以将其转换为秒）。您可以使用它来计算更改了多少时间（假设没有系统重新启动或睡眠）。即使系统时钟由用户或网络时间协议更改，这仍然有效。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-07-29T14:08:12.793

如果有人正在寻找解决方案，请从 10.4 开始了解系统日期更改更改事件

* * *

```
OSStatus DateChangeEventHandler(EventHandlerCallRef nextHandler, EventRef theEvent, void *userData) 
{
    NSLog(@"Event received!\n");    
    return 0;
}

- (void)SystemTimeChangeHandler
{
    EventTypeSpec eventType;
    eventType.eventClass = kEventClassSystem;
    eventType.eventKind = kEventSystemTimeDateChanged;

    EventHandlerUPP eventHandlerUPP =
    NewEventHandlerUPP(DateChangeEventHandler);
    EventHandlerRef eventHandlerRef = NULL;
    (void)InstallApplicationEventHandler(
                                         eventHandlerUPP,
                                         1,
                                         &eventType,
                                         self,
                                         &eventHandlerRef);

} 
```

* * *

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:24:09.290

时间不断地移动。每次当前时间更改时的通知将是一个持续的、占用 CPU 的通知流。

您需要做的是在您的事件处理程序中获取当前时间——接收您正在添加日期戳的事件的处理程序。您可以通过调用获取当前时间`[NSDate date]`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T20:27:19.423

我认为没有单一的方法可以做到这一点，因为时间可能会改变不同的机制。但它不会很贵（太贵了？不知道，你有没有分析过它？;-) 设置`NSTimer`每秒一次来检查时间并将其与之前的值进行比较。如果它没有提前大约一秒钟，就会发生一些有趣的事情，您可以通知您的审计对象。

# ruby-on-rails - 具有远程文件支持 (FTP/sFTP) 的 Windows Rails-IDE

> ID：690327
> 
> 赞同：2
> 
> 时间：2009-03-27T15:55:45.520
> 
> 标签：ruby-on-rails, ruby, ide, aptana

我目前在本地系统上使用[Aptana RadRails](http://www.aptana.com/rails)进行 Ruby on Rails 开发。现在我想在我的专用服务器上托管的 Rails 应用程序上工作，但不幸的是 RadRails 不提供对远程文件访问的支持（除了 SVN）。

是否有适用于 Rails-Applications 的 IDE 让我能够透明地处理远程服务器上的应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T15:58:59.803

这是[你](http://www.aptana.com/docs/index.php/Editing_a_file_from_a_remote_site)要找的吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T20:51:38.273

你这样做是错的！

说真的，您应该使用源代码控制，并且应该使用诸如 vlad 或 capistrano 之类的部署工具来发布您的软件。

您在本地运行您的应用程序，提交更改，然后运行部署到您的服务器。一旦设置好，您甚至不需要登录到您的服务器。

开发你正在做的事情会引起很多麻烦并降低你的工作效率。现在，snide rails 开发人员评论说，如果您真的关心生产力，那么您一开始就不会使用 Windows ......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-13T03:30:42.603

它尚不可用，但[Haven](http://www.wikidlabs.com/products/haven/)将允许您在浏览器中通过 FTP/SFTP 编辑文件。如果您的东西在哪里，它还允许您插入源代码控制。它应该是当前胖客户端选项的不错选择。

免责声明：我是 Wikid Labs 的联合创始人。

# php - 上传合并的图像，然后用 PHP 分解

> ID：690328
> 
> 赞同：0
> 
> 时间：2009-03-27T15:56:18.547
> 
> 标签：php, vb6

寻找一种使某人能够上传单个文件的方法，该文件将一系列图像文件（所有 gif）合并为一个大文件。这是我需要做的：

1.  使用VB6，想将图像文件（可能有几十个）合并到一个文件中
2.  将文件上传到 PHP 脚本（很简单）
3.  让 PHP 分解单个文件并写入图像文件

我知道如何处理文件的上传。我也知道如何用 PHP 编写图像文件。我不确定的是合并/取消合并操作。

理论上，我应该能够使用 VB6 使用二进制读/写来合并所有图像。但是，有没有人知道为每个 .gif 文件添加前缀的一系列二进制代码，以便 PHP 可以接受它，或者我是否需要在每个合并图像之间编写某种二进制分隔符？

我自己当然可以修补这个，但我认为你们中的一些比我更聪明的编码人员可能已经这样做了，和/或可以提供一个链接、一些代码或一些“需要考虑的事情”。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T15:59:39.957

如果整个目的是避免发送数十个文件的开销，而不是合并/取消合并，为什么不压缩它们并在 PHP 中解压缩呢？

这应该比您提出的合并操作容易得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T16:07:50.327

*   这是适用于 Windows 的免费 Zip/Unzip 库：[Info-ZIP](http://www.info-zip.org/)
*   下面是一些使用 Info-ZIP 的示例代码：[Zip and Unzip Using VB5 or VB6](http://www.codeguru.com/vb/gen/vb_graphics/fileformats/article.php/c6743)
*   这是关于 ZIP 模块的 PHP 文档：[php.net/zip](http://us3.php.net/zip)
*   这是一个如何通过 PHP 使用“解压缩”命令而不是使用 Zip 模块的示例：使用 PHP[压缩和解压缩文件](http://www.jimmyr.com/blog/Zipping_and_Unzipping_Files_PHP_166_2006.php)

谷歌是你的朋友 :)

# c# - 这个 switch 语句闻起来很臭吗？

> ID：690330
> 
> 赞同：5
> 
> 时间：2009-03-27T15:56:39.887
> 
> 标签：c#, switch-statement

```
Switch(some case) {
    case 1:
           // compute something ...
           return something;
           break;
    case 2:
           // compute something ...
           return something;
           break;

/* some more cases ... */

    case X:
           // compute something ...
           return something;
           break;
    default:
           // do something
           return something;
           break;
} 
```

在我看来：

> 假设这个 switch 语句是合理的，return 和 break 看起来不正确或感觉不正确。

中断显然是多余的，但遗漏是糟糕的风格（还是这种糟糕的风格开始？）？

* * *

我个人不这样做，但是代码库中有一些在工作。不，我不会自以为是并纠正代码库。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-27T16:00:04.433

不，遗漏不是糟糕的风格 -*包含*是糟糕的风格。这些是无法到达的陈述。摆脱他们。

我喜欢 case 直接返回而不是设置局部变量然后只在底部返回的事实——这意味着当您阅读代码时它非常清楚它只*需要*返回，仅此而已。

首先在切换方面的旁注：

至于在这里使用switch语句是否正确，这真的取决于其他事情。改用多态类型有意义吗？如果您使用 Java，您可以使用智能枚举吗？（您可以在 C# 中模仿这些，但没有那么多支持。）

我想说这至少应该提示*考虑*不同的设计——但这很可能是做你想做的最简单的方法。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-27T16:01:44.773

如果您这样做，C# 编译器会发出警告，说明中断是无法访问的代码。所以在我的书中，既有返回又有休息是不好的形式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-27T15:59:40.597

在我看来，我会省略“break”关键字。我个人认为这有助于提醒人们‘执行已经结束！这里没什么可看的了！'。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T15:59:59.287

我会做一个小改动：

```
switch(some case) {
    case 1:
           // compute something ...
           break;
    case 2:
           // compute something ...
           break;
/* some more cases ... */
    case X:
           // compute something ...
           break;
    default:
           // do something
           break;
}
return something; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T16:03:17.233

我不确定该代码的字面意思如何，因此其中一些观察结果可能不适用...

“案例 1” 如果你真的像这样对数字进行硬编码，我认为它的风格很差，你应该考虑使用枚举。

如果您只是简单地返回一些东西并且在一部分案例中没有额外的逻辑，您可以考虑将“一些东西”放在一个数组或字典中，并简单地通过它们的索引而不是使用 switch 语句来寻址它们......

返回一些东西[索引]

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T16:01:31.297

代码异味意味着设计问题。这只是格式问题。我想大多数人都会同意省略断点的版本更好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T16:02:13.417

休息是多余的。

一些经验法则，只在一个地方退出一个函数总是好的，但是自从这个规则被制定后，Try-Catch 被发明了（oop goto）。

如果您在整个应用程序中保持相同的样式，我想您可以接受 switch 中的返回。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-03T07:35:15.550

这里的代码气味是 case 语句中的硬编码值。

至于回报，更多的是品味和判断力的问题。当然，如果您的案例跨越多个页面，那么如果退货在案例中，则更容易阅读，但问题是开始时的大开关。

我个人更喜欢单一返回选项，因为如果您需要添加更多处理，那么重构比访问所有案例更便宜。此外，如果让其他人进行重构，他们不会有在每种情况下复制粘贴代码的诱惑，至少我希望如此......如果他们这样做，他们最好希望我不是进行代码审查的人（对于复制粘贴明显）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-20T17:33:35.197

Switch 语句本身就是一种代码味道。

就像 l99057j 所说的那样，如果您所做的只是将输入映射到常量值，那么这是一个适合查找结构的地方，例如用于顺序输入的数组/列表或用于稀疏输入的字典/映射，不是 switch 语句。如果您正在计算某些东西，那么该值将是您使用输入调用的委托。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-10T21:11:42.480

其他人对其他方面发表了评论。至于返回后多余的中断：我会保留它们，与 { } 围绕单个语句 if 主体的推理相同：每个程序员都应该将这些刹车放在那里。最好有 100 个这样的冗余中断，而不是无意丢失一个。

# teradata - 如何在 Teradata 中将字符串转换为二进制？

> ID：690331
> 
> 赞同：1
> 
> 时间：2009-03-27T15:56:41.650
> 
> 标签：teradata

我在 Teradata Database 手册-SQL 参考 - 函数和运算符中找不到将字符串转换为二进制的任何函数。将字符串转换为字节也不起作用。

SELECT C1, C2 FROM table WHERE C1 < (cast( ('QREPI.\k'||'00'XC||'00'XC||'00'XC||'00'XC||'00' XC| |'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||' ..') 作为 byte(24)) )); *** 失败 3532 BYTE 数据与其他类型之间的转换是非法的。语句# 1，信息 =0

有人知道 Teradata 是否提供了一种转换方式吗？

任何意见都受到高度赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T17:44:43.837

如果你只需要一个文字，你可以得到你的字符串的二进制等价物，如下所示：

```
SELECT C1, C2 FROM table
WHERE C1 < '51524550492e5c6b000000000000000000000000'xb 
```

否则，对于以十六进制存储在表中的数据，可以通过编写新的 UDF 在 Teradata 中完成。或者您可以将其导出到文件中，使用程序对其进行转换，然后将其加载回来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:16:52.053

根据[他们的博客](http://readvitamin.com/2007/08/03/%E2%80%98implicit%E2%80%99-and-%E2%80%98explicit%E2%80%99-casting-in-teradata/)，您应该能够通过隐式转换（但不是显式）来做到这一点。我认为这意味着：

```
SELECT C1, C2 
  FROM table 
  WHERE C1 < ('QREPI.\k'||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||
     '00'XC||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||'00'XC||' ..'); 
```

你试过吗？

# javascript - IE8 不再允许在不使用 substr 函数的情况下访问单个字符？

> ID：690337
> 
> 赞同：1
> 
> 时间：2009-03-27T15:58:38.183
> 
> 标签：javascript, internet-explorer-8

我曾经使用 string[n] 访问字符串的单个字符。

但是当我在 IE8 中执行此操作时，它总是返回 undefined。

我可以使用 string.substr(n, 1) 来做同样的事情，但语法要长得多。他们为什么这么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T16:09:19.357

这种形式的字符访问不是 ECMAScript 标准的一部分，而是由一些 VM 实现的。我会按照 RoBorg 的建议使用 charAt，并避免使用非标准化的功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T16:03:29.323

您可以使用[`string.charAt(n)`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String/charAt)- 我不确定何时`string[n]`生效或为什么将其删除。

编辑：我已经在 IE 6 和 7 中进行了测试，`string[n]`但没有在其中任何一个中工作。

# perl - 为什么我需要知道我将使用 Test::More 运行多少测试？

> ID：690342
> 
> 赞同：25
> 
> 时间：2009-03-27T15:59:25.950
> 
> 标签：perl, unit-testing, testing

如果我使用，我是一个坏人`use Test::More qw(no_plan)`吗？

测试::More [POD](http://search.cpan.org/~mschwern/Test-Simple-0.86/lib/Test/More.pm)说

> 首先，您需要一个测试计划。这基本上声明了您的脚本将运行多少测试以防止过早失败......
> 
> `use Test::More tests => 23;`
> 
> 在极少数情况下，您事先不知道脚本要运行多少测试。在这种情况下，您可以声明您没有计划。（尽量避免使用它，因为它会削弱你的测试。）
> 
> `use Test::More qw(no_plan);`

但是，如果在测试运行结束时没有打印任何结果，则很容易看到过早的故障。它似乎没有那么有帮助。

所以我有3个问题：

1.  默认情况下需要测试计划的原因是什么？
2.  从长远来看，有没有人发现这是一个有用且节省时间的功能？
3.  其他语言的其他测试套件是否支持这种事情？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-28T07:38:58.453

## 默认情况下需要测试计划的原因是什么？

ysth 的[答案](https://stackoverflow.com/questions/690342/why-do-i-need-to-know-how-many-tests-i-will-be-running-with-testmore/691880#691880)链接到对此问题的精彩[讨论](http://www.nntp.perl.org/group/perl.qa/2009/03/msg12104.html)，其中包括 Michael Schwern 和 Ovid 的评论，他们分别是维护者`Test::More`和`Test::Most`维护者。[显然，这在perl-qa](http://qa.perl.org/)列表中每隔一段时间就会出现一次，这是一个有争议的问题。以下是重点：

### 不使用测试计划的原因

1.  它很烦人，需要时间。
2.  它不值得花时间，因为测试脚本不会在没有测试工具注意到的情况下死掉，除非在极少数情况下。
3.  `Test::More`可以在测试发生时计算测试
4.  如果您使用测试计划并需要跳过测试，那么您需要一个`SKIP{}`块的额外痛苦。

### 使用测试计划的原因

1.  只需几秒钟即可完成。如果需要更长的时间，您的测试逻辑就太复杂了。
2.  如果代码中某处存在 exit(0)，则您的测试将成功完成，而无需运行剩余的测试用例。细心的人可能会注意到屏幕输出看起来不正确，但在自动化测试套件中它可能会被忽视。
3.  开发人员可能不小心编写了测试逻辑，因此某些测试永远不会运行。
4.  如果不提前知道将运行多少测试，您就无法真正拥有进度条。[仅靠内省很难](http://perl-qa.hexten.net/wiki/index.php/Why_can%27t_a_program_count_its_own_tests)做到这一点。

### 替代方案

`Test::Simple`, [`Test::More`](http://search.cpan.org/~mschwern/Test-Simple-0.86/lib/Test/More.pm), 并且`Test::Most`有一个[`done_testing()`](http://search.cpan.org/~mschwern/Test-Simple-0.87%5F01/lib/Test/Builder.pm#done%5Ftesting)应该在测试脚本结束时调用的方法。这是我目前采取的方法。

这解决了代码中包含的问题`exit(0)`。它并不能解决无意跳过测试的逻辑问题。

简而言之，使用计划更安全，但是除非您的测试套件很复杂（而且它们不应该很复杂），否则实际上节省一天的机会很低。

所以使用`done_testing()`是一个中间立场。无论您喜欢什么，它可能都不是什么大不了的事。

## 这个功能对现实世界中的任何人都有用吗？

一些人提到这个功能在现实世界中对他们很有用。这包括拉里沃尔。Michael Schwern[说](http://www.nntp.perl.org/group/perl.qa/2009/03/msg12104.html)这个功能起源于 20 多年前的 Larry。

## 其他语言有这个功能吗？

xUnit 类型的测试套件都没有测试计划功能。我还没有遇到任何其他编程语言中使用此功能的示例。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-28T03:13:05.127

我不确定您真正要问的是什么，因为文档摘录似乎回答了它。我想知道我的所有测试是否都运行了。但是，直到测试套件稳定下来，我才发现这很有用。

在开发过程中，我使用 no_plan，因为我不断地添加到测试套件中。随着事情的稳定，我验证应该运行的测试数量并更新计划。有些人已经提到了“测试工具”，但没有“测试工具”这样的东西。大多数模块默认使用一个，因为这是 MakeMaker 或 Module::Build 指定的，但 TAP 输出独立于任何特定的 TAP 使用者。

一些人提到了测试数量可能会有所不同的情况。我弄清楚了测试但是我需要计算数字然后在计划中使用它。它还有助于拥有针对非常特定功能的小型测试文件，因此测试数量很少。

```
使用 vars qw( $tests );

开始 {
  $测试 = ...; ＃ 想办法

  使用 Test::More 测试 => $tests;
  }

```

您还可以将计数与加载分开：

```
使用测试::更多；

计划测试 => $tests;

```

最新的 TAP 也可以让您将计划放在最后。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-28T00:18:06.047

在一条评论中，您似乎认为过早退出将被视为失败，因为计划不会在最后输出，但事实并非如此 - 除非您以 POSIX::_exit 或致命信号等。特别是， die() 和 exit() 将导致计划被输出（尽管测试工具应该检测到 exit(0) 以外的任何东西作为过早终止的测试）。

您可能想查看 Test::Most 的延期计划选项，该选项很快就会出现在 Test::More 中（如果还没有的话）。

最近在 perl-qa 列表上也对此进行了讨论。一个线程：[http ://www.nntp.perl.org/group/perl.qa/2009/03/msg12121.html](http://www.nntp.perl.org/group/perl.qa/2009/03/msg12121.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T18:20:28.200

做任何测试都比不做测试要好，但测试是要经过深思熟虑的。说明预期的测试数量使您能够查看测试脚本中是否存在阻止测试执行（或执行太多次）的错误。如果您不在特定条件下运行测试，您可以使用 skip 函数来声明：

```
 SKIP: {
      skip $why, $how_many if $condition;

      ...normal testing code goes here...
  } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T17:03:59.523

我认为当制定计划的人力成本太高时，可以改变规则并使用 no_plan，但是这个成本很好地表明了测试套件的设计不佳。

明确定义 test_plan 很有用的另一种情况是，当您进行此类测试时：

```
$coderef = sub { my $arg = shift; isa_ok $arg, 'MyClass' };
do(@args, $coderef); 
```

和

```
## hijack our interface to test it's called.
local *MyClass::do = $coderef; 
```

如果您不指定计划，很容易错过测试失败以及某些断言未按预期运行的情况。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-09-28T19:02:48.510

明确计划中的测试数量是一个好主意，除非检索这个数字太昂贵。这个问题已经得到了正确的回答，但我想强调两点：

*   比 no_plan 更好的是使用`done_testing()`

    `use Test::More;`
    `... run your tests ...;`
    `done_testing( $number_of_tests_run );`
    `# or done_testing() if not number of test is known`

*   这个 Matt Trout 博客文章很有趣，并且抱怨添加计划与 cvs 冲突以及其他使计划有问题的问题：[为什么数字测试计划是坏的、错误的，并且无论如何都没有实际帮助](http://www.shadowcat.co.uk/blog/matt-s-trout/a-cunning-no_plan/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-28T12:59:19.040

我也觉得这很烦人，而且我通常在一开始就忽略这个数字，直到测试套件稳定下来。然后我只是手动更新它。我*确实*喜欢知道随着时间的推移有多少总测试，作为一种进度指示器。

为了使计数更容易，我在每次测试之前都添加了以下内容：

```
#----- load non-existant record -----
....
#----- add a new record -----
....
#----- load the new record (by name) -----
....
#----- verify the name -----
etc. 
```

然后我可以快速扫描文件并轻松计算测试，只需查找`#-----`行。我想我什至可以在 Emacs 中编写一些东西来为我做这件事，但老实说，这并不是一件苦差事。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-27T17:38:48.863

进行 TDD 时会很痛苦，因为您是在投机取巧地编写新测试。当我教 TDD 并且商店使用 Perl 时，我们决定以无计划的方式使用我们的测试套件。我想我们本可以从 no_plan 更改为锁定测试数量。当时我认为它是障碍多于帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-30T09:05:04.627

埃里克约翰逊的回答是完全正确的。我只是想补充一点`done_testing`，一个更好的替代品`no_plan`，最近在[Test-Simple 0.87_1](http://search.cpan.org/~mschwern/Test-Simple-0.87_01/)中发布。这是一个实验版本，但您可以直接从上一个链接下载它。

`done_testing`允许您在测试脚本结束时声明您认为已运行的测试数量，而不是在脚本开始之前尝试猜测它。您可以[在此处阅读文档](http://search.cpan.org/~mschwern/Test-Simple-0.87_01/lib/Test/Builder.pm#done_testing)。

# javascript - 如何向 ExtJS 处理程序添加其他参数？

> ID：690343
> 
> 赞同：7
> 
> 时间：2009-03-27T15:59:30.397
> 
> 标签：javascript, extjs, handler

我正在使用 ExtJS 框架，并且我有以下处理程序，它仅用作按钮的处理程序：

```
var myButtonHandler = function(button, event){
   //code goes here
}; 
```

我的按钮定义如下所示：

```
var myButton = new Ext.Button({
       id : 'myButton',
       renderTo : 'mybutton',
       text : 'Save',
       handler : myButtonHandler,
       scope : this
    }); 
```

如您所见，处理程序接收到预期的“按钮”和“事件”。但是，我想将一些附加信息传递给我的处理程序。我该怎么做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-25T01:00:14.603

我实际上会使用 Exts createDelegate 原型。

```
var appendBooleanOrInsertionIndex = 0; // Inserts the variables into the front of the function.
    appendBooleanOrInsertionIndex = true; // Appends the variables to the end of the arguments

var myButton = new Ext.Button({
   id : 'myButton',
   renderTo : 'mybutton',
   text : 'Save',
   handler : myButtonHandler.createDelegate(this, [param1, param2], appendBooleanOrInsertionIndex),
   scope : this
}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-11T22:51:10.787

在 Ext JS 4 中：

```
Ext.bind(myButtonHandler, this, [params array], true); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-02-15T18:19:29.863

您可以使用 Bradley 建议的好的解决方案。这是一个例子。其中 repeatsStore - 这是我要传递给按钮处理程序的附加参数。

```
Ext.create('Ext.panel.Panel', {
    name: 'panelBtn',
    layout: 'hbox',
    border: 0,
    items:[
        {xtype: 'button', text: 'Add', name:'addBtn',
         handler : Ext.bind(this.addBtnHandler, this, repeatsStore, true)
        }
    ]
}); 
```

你的处理程序应该有三个参数——前两个是标准的，最后一个是你的。

```
addBtnHandler:function(button, event, repeatsStore)
{
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T16:03:18.653

我不知道您要传递什么，但使用包装器可能会有所帮助：

```
var myButtonHandler = function (button, event, additionalData){
   //code goes here
};

var myButton = new Ext.Button({
  id : 'myButton',
  renderTo : 'mybutton',
  text : 'Save',
  handler : handlerWrapper,
  scope : this
});

var handlerWrapper = function (button, event){
  // Fetch additional data
  var additionalData = "whatever";
  myButtonHandler(button, event, additionalData);
}; 
```

# java - Java Profiling：私有属性 Getter 具有较大的基础时间

> ID：690348
> 
> 赞同：3
> 
> 时间：2009-03-27T16:00:23.467
> 
> 标签：java, performance, profiling, eclipse-tptp

我正在使用 TPTP 来分析一些运行缓慢的 Java 代码，我遇到了一些有趣的事情。我的一个私有属性 getter 在执行时间分析结果中具有很大的基准时间值。公平地说，这个属性被调用了很多次，但我从来没想过这样的属性会花费很长时间：

```
public class MyClass{
    private int m_myValue;    
    public int GetMyValue(){
        return m_myValue;
    }
} 
```

好的，所以类中显然有更多的东西，但是正如您所看到的，当调用 getter 时没有其他任何事情发生（只是返回一个 int）。给你一些数字：

*   大约 30% 的运行调用都在 getter 上（我正在努力减少这种情况）
*   运行的大约 25% 的基本时间都花在了这个 getter 上
*   平均基准时间为 0.000175s

为了比较，我在不同的类中有另一个方法使用这个getter：

```
private boolean FasterMethod(MyClass instance, int value){
    return instance.GetMyValue() > m_localInt - value;
} 
```

它的平均基准时间要低得多，为 0.000018 秒（低一个数量级）。

这是怎么回事？我认为有些东西我不明白或我遗漏了一些东西：

1.  返回本地原语真的比返回计算值需要更长的时间吗？
2.  我应该查看基准时间以外的指标吗？
3.  这些结果是否具有误导性，我需要考虑其他一些分析工具吗？

**编辑1：**根据下面的一些建议，我将该方法标记为最终并重新运行测试，但我得到了相同的结果。

**编辑 2：**我安装了 YourKit 的演示版来重新运行我的性能测试，YourKit 结果看起来更接近我的预期。我将继续测试 YourKit 并报告我的发现。

**编辑 3：**更改为 YourKit 似乎解决了我的问题。我能够使用 YourKit 来确定我的代码中的*实际*慢点。下面有一些很好的评论和帖子（适当地赞成），但我接受第一个建议 YourKit 为“正确”的人。（我不以任何方式隶属于 YourKit / YMMV）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T16:12:48.727

如果可能，请尝试使用另一个分析器（Netbeans 运行良好）。这可能很难做到，具体取决于您的代码是如何设置的。

就像许多其他工具一样，不同的分析器可能会产生不同的信息。

> 返回本地原语真的比返回计算值需要更长的时间吗？

返回实例变量比返回局部变量（取决于 VM）花费更长的时间。您拥有的 getter 很简单，因此它应该被内联，因此它变得与访问公共实例变量一样快（同样，它比访问局部变量慢）。

但是您没有本地值（方法中的本地含义，而不是类中的本地含义）。

“本地”到底是什么意思？

> 我应该查看基准时间以外的指标吗？

我没有使用 Eclipse 工具，所以我不确定它是如何工作的……如果它是跟踪或采样分析器，它可能会有所不同（两者可以为这样的事情提供不同的结果）。

> 这些结果是否具有误导性，我需要考虑其他一些分析工具吗？

我会考虑另一种工具，只是看看结果是否相同。

根据评论编辑：

如果它是一个采样分析器，那么本质上，每个“n 时间单位”都会对程序进行采样以查看程序的位置。如果您调用一种方法的方式多于另一种方法，它将显示为在被调用更多的方法中（很可能该方法正在运行）。

跟踪分析器将代码添加到您的程序（称为检测的过程），以从本质上记录正在发生的事情。

跟踪分析器速度较慢但更准确，它们还需要更改程序（检测过程），这可能会引入错误（我没有听说过它发生......但我相信至少在他们正在开发时会这样做探查器）。

采样分析器更快但不太准确（它们只是猜测一行代码的执行频率）。

因此，如果 Eclipse 使用采样分析器，您可能会看到您认为奇怪的行为。更改为跟踪分析器将显示更准确的结果。

如果 Eclipse 使用跟踪分析器，那么更改分析器应该显示相同的结果（但是它们新的分析器可能会让您更清楚地了解正在发生的事情）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T16:08:08.813

听起来确实有点误导 - 也许分析器正在删除一些优化？

只是为了好玩，尝试使方法最终，这将更容易内联。这很可能是属性和 FasterMethod 之间的区别。在实际使用中，HotSpot 甚至会内联虚拟方法，直到它们第一次被覆盖（IIRC）。

编辑：回应布赖恩的评论：是的，*通常*情况下，制作最终的东西不会帮助性能（尽管它在设计方面可能是一件好事:)因为热点通常会根据它是否可以内联来确定它是否可以内联无论它是否被覆盖。我的意思是这个分析器可能已经搞砸了。

编辑：我现在已经设法重现 HotSpot“撤消”尚未扩展的类（或尚未覆盖的方法）的优化的方式。对于服务器 VM，这比客户端更难做到，但我已经做到了 :)

```
public class Test
{
    public static void main(String[] args)
        throws Exception
    {
        final long iterations = 1000000000L;
        Base b = new Base();
        // Warm up Hotspot
        time(b, 1000);

        // Before we load Derived
        time(b, iterations);

        // Load Derived and use it quickly
        // (Just loading is enough to make the client VM
        // undo its optimizations; the server VM needs more effort)
        Base d = (Base) Class.forName("Derived").newInstance();
        time(d, 1);

        // Time it again with Base
        time(b, iterations);
    }

    private static void time(Base b, long iterations)
    {
        long total = 0;
        long start = System.currentTimeMillis();
        for (long i = 0; i < iterations; i++)
        {
            total += b.getValue();
        }
        long end = System.currentTimeMillis();
        System.out.println("Time: " + (end-start));
        System.out.println("Total: " + total);
    }
}

class Base
{
    public int getValue() { return 1; }
}

class Derived extends Base
{
    @Override
    public int getValue() { return 2; }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T16:10:39.073

这听起来很奇特。您不会错误地调用覆盖方法，是吗？

我很想下载[YourKit 的演示版本](http://www.yourkit.com/)。设置起来很简单，它应该可以指示真正发生的事情。如果 TPTP 和 YourKit 都同意，那么就会发生一些奇怪的事情（我知道这并没有多大帮助！）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T18:17:55.617

曾经对这类方法的性能产生很大影响的东西（尽管这可能在*某种程度上*是历史性的）是调用方法的大小可能是一个问题。HotSpot（和严重的竞争对手）会很乐意内联小方法（有些可能会在同步/最终尝试时窒息）。但是，如果调用方法很大，则可能不会。这对于旧版本的 HotSpot C1/客户端来说尤其是一个问题，它有一个非常糟糕的寄存器分配算法（它现在有一个非常好的和快速的算法）。

# c++ - 重新分配“auto_ptr”并管理内存

> ID：690356
> 
> 赞同：1
> 
> 时间：2009-03-27T16:02:03.260
> 
> 标签：c++, memory-management, memory-leaks, auto-ptr

我有这样的情况：

```
class MyClass
{
private:
  std::auto_ptr<MyOtherClass> obj;

public:
  MyClass()
  {
    obj = auto_ptr<MyOtherClass>(new MyOtherClass());
  }

  void reassignMyOtherClass()
  {
    // ... do funny stuff
    MyOtherClass new_other_class = new MyOtherClass();
    // Here, I want to:
    //  1) Delete the pointer object inside 'obj'
    //  2) Re-assign the pointer object of 'obj' to 'new_other_class'
    //     so that 'obj' now manages 'new_other_class' instead of the
    //     object that just got deleted manually
  }
}; 
```

有没有办法做到这一点？下面的代码会做我想要的吗？

```
void MyClass::reassignMyOtherClass()
{
  // ... still, do more funny stuff (flashback humor :-)
  MyOtherClass new_other_class = new MyOtherClass();
  obj.reset(new_other_class);
} 
```

的内存`new_other_class`会在 的默认析构函数中被取消分配`MyClass`吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T16:05:17.543

是的，它会。您可以使用

```
obj.reset( new MyOtherClass() ); 
```

我最好使用这样的构造函数

```
 MyClass():
     obj( new MyOtherClass() )
 {
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T16:09:46.547

来自[MSDN](http://msdn.microsoft.com/en-us/library/b84a89af(VS.80).aspx)的描述`reset`

> 成员函数计算表达式 delete myptr，但前提是存储的指针值 myptr 由于函数调用而发生更改。然后它用 ptr 替换存储的指针。

它会做你想做的事。

# c# - MbUnit 回滚

> ID：690357
> 
> 赞同：0
> 
> 时间：2009-03-27T16:02:04.070
> 
> 标签：c#, tdd, mbunit

我正在测试 MbUnit 框架，并希望在每次测试后将我的测试数据库保持在持久状态。我怎样才能做到这一点？

这就是我正在尝试的，但是测试完成后我的桌子被填满了。

* * *

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;
using Gallio.Framework;
using MbUnit.Framework;

using NHibernate;
using NHibernate.Cfg;

namespace BusinessLayer.Tests
{
    [TestFixture]
    public class PersonNHibernateTests
    {
        [Test] 
        [Rollback]
        public void CanSavePerson()
        {
            Configuration config = new Configuration();
            config.Configure();
            ISessionFactory factory = config.BuildSessionFactory();

            using (ISession session = factory.OpenSession())
            {
                using (ITransaction tx = session.BeginTransaction())
                {

                    const string CONST_STR_FIRSTNAME = "Stephen";
                    const string CONST_STR_LASTNAME = "Manga";
                    DateTime birthdate = new DateTime(1974, 6, 20);

                    Person p = new Person
                    {
                        FirstName = CONST_STR_FIRSTNAME,
                        LastName = CONST_STR_LASTNAME,
                        Birthdate = birthdate
                    };

                    session.SaveOrUpdate(p);
                    session.Flush();

                    tx.Commit();

                }

            }
        }

    }
} 
```

编辑：

经过一番阅读，我了解到必须启用分布式事务协调器。启动此服务并测试后仍然没有成功:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:37:58.803

您的代码中有一个 COMMIT 语句。也许你应该删除它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:03:38.560

为什么不让 System.Transactions.TransactionScope 处理它呢？

```
using (new TransactionScope())
{
    // do stuff that gets automatically rolled back
} 
```

或者，这似乎正是 MbUnit Rollback2 属性所做的（回滚使用 EnterpriseServices/COM+ 并且针对 .NET 1.1）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T16:12:15.590

我用[Proteus](http://unhandled-exceptions.com/blog/index.php/2009/03/16/proteus-unit-test-utility-and-domain-foundation-code-goes-oss/)就很好。易于设置和使用。您只需在 Setups TearDowns 中添加一些代码，并使用数据库的“快照”准备文件夹。

# javascript - IE 和客户端事件处理中的托管用户控制

> ID：690358
> 
> 赞同：0
> 
> 时间：2009-03-27T16:02:10.373
> 
> 标签：javascript, user-controls, event-handling

我刚刚将托管控件升级到 .NET 2.0，我必须启用 ComVisible 才能使用 javascript 从客户端访问方法。

启用 ComVisible 后是否也可以访问事件？我以前处理过这样的事件，没有任何问题：

```
<OBJECT id="foo" ...></OBJECT>

<script language="javascript">
     function document.all.foo::SampleEvent(res){
     //do stuff here
     }
</script> 
```

这也不起作用：

```
<script language="javascript" for="foo" event="SampleEvent(res)">
     alert(res);
</script> 
```

出于某种原因，我现在无法捕捉到我的事件。如果我在 WinForms 项目中使用我的 DLL，则事件处理得很好，所以我知道我已经正确设置了它。

如何正确地将其公开给客户端？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-08T15:31:57.533

只是跟进这一点，以防将来有人遇到它。我在用户控件中有 2 个不匹配的数据类型，导致事件无法正常触发。

**检查您的数据类型！**

# json - 如何在 Grails 中将特定日期格式返回为 JSON？

> ID：690370
> 
> 赞同：19
> 
> 时间：2009-03-27T16:06:52.657
> 
> 标签：json, grails, groovy, converters

在 Grails 中，您可以使用 JSON 转换器在控制器中执行此操作：

```
render Book.list() as JSON 
```

渲染结果是

```
[
{"id":1,
 "class":"Book",
 "author":"Stephen King",
 "releaseDate":'2007-04-06T00:00:00',
 "title":"The Shining"}
] 
```

您可以通过在 Config.groovy 中进行设置来控制输出日期

```
grails.converters.json.date = 'javascript' // default or Javascript 
```

然后结果将是一个原生 javascript 日期

```
[
{"id":1,
 "class":"Book",
 "author":"Stephen King",
 "releaseDate":new Date(1194127343161),
 "title":"The Shining"}
] 
```

如果我想获得这样的特定日期格式：

```
"releaseDate":"06-04-2007" 
```

我必须使用“收集”，这需要大量输入：

```
return Book.list().collect(){
  [
      id:it.id,
      class:it.class,
      author:it.author,
      releaseDate:new java.text.SimpleDateFormat("dd-MM-yyyy").format(it.releaseDate),
      title:it.title
  ]
} as JSON 
```

有没有更简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-29T15:50:04.050

有一个简单的解决方案：从 Grails 1.1 开始，转换器已被重写为更加模块化。不幸的是，我没有完成文档。它现在允许注册所谓的 ObjectMarshallers（实现`org.codehaus.groovy.grails.web.converters.marshaller.ObjectMarshaller`接口的简单 Pogo/Pojo）。

为了实现您想要的输出，您可以通过这种方式在 BootStrap.groovy 中注册这样的 ObjectMarshaller：

```
import grails.converters.JSON;

class BootStrap {

     def init = { servletContext ->
         JSON.registerObjectMarshaller(Date) {
            return it?.format("dd-MM-yyyy")
         }
     }
     def destroy = {
     }
} 
```

还有其他几种方法可以自定义转换器的输出，我会尽我所能尽快赶上文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-01T05:45:25.200

或者您可以在日期级别本身工作。这可能不是您想要的，但它可能会激发一个想法，让您的整个应用程序始终如一地工作。

```
def doWithDynamicMethods = {ctx ->

  def customDateToString = {->
        def dateFormat = "dd MMM yyyy"
        def timeFormat = "hh:mm:ss a"

        def timeCheck = new java.text.SimpleDateFormat("hh:mm:ss SSS a")
        def formattedTime = timeCheck.format(delegate)
        def formatString = dateFormat
        if (formattedTime != "12:00:00 000 AM") 
                              formatString = "$formatString $timeFormat"
        def formatter = new java.text.SimpleDateFormat("$formatString")
        formatter.format(delegate)
    }

    Date.metaClass.toString = customDateToString;
    java.sql.Timestamp.metaClass.toString = customDateToString;
} 
```

# c# - 无效什么都不做

> ID：690378
> 
> 赞同：0
> 
> 时间：2009-03-27T16:09:27.937
> 
> 标签：c#, winforms

我在带有关联的 SelectionChanged 事件的表单上有一个 datagridview。

当所选行包含“附件”时，btnComments 控件的背景色应变为黄色，如下所示：

```
 int noAttachments = 1;

   if (noAttachments > 0)
       btnAttachments.BackColor = Color.Yellow;
   else
       btnAttachments.BackColor = normalColour;

   btnAttachments.Invalidate(); 
```

代码按预期工作，只是 Invalidate() 调用什么都不做！即按钮的颜色不会改变！

任何想法为什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T16:20:22.200

我不相信这是对 Invalidate 的调用。如果有的话，这里不需要 Invalidate，假设这个按钮是一个控件。当您更改任何控件的状态时，该控件负责使其自身无效。因此，当您更改控件的 BackColor 属性时，它应该使自身失效，从而触发重绘。

您确定 btnAttachments 是控件是否支持 BackColor 属性（我假设它是常规按钮，但可能不是）？

**索取更多信息：**

我还想到，因为这是一个 DataGridView，所以您实际上并没有对用于呈现按钮的正确控件的引用。DataGridView 有一个用于控制行/列/单元格的模板概念，然后是它使用的实际实例。

您需要展示如何获取该特定行/单元格/列的按钮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:21:41.747

那应该行得通。理想情况下，您在更改 BackColor 属性时不需要调用 Invalidate。

你确定 normalColor != Color.Yellow 吗？

# c# - 如何在 C# 中将数组放入结构中？

> ID：690382
> 
> 赞同：2
> 
> 时间：2009-03-27T16:09:43.757
> 
> 标签：c#, c++, pointers, code-translation

C++ 代码：

```
struct tPacket
{
    WORD word1;
    WORD word2;
    BYTE byte1;
    BYTE byte2;
    BYTE array123[8];
}

static char data[8192] = {0};
...
some code to fill up the array
...
tPacket * packet = (tPacket *)data; 
```

我们不能在 C# 中那么简单地做到这一点。

请注意 C++ 结构中有一个数组。

或者，使用[这个源文件](http://varjabedian.net/archive/2008/07/29/casting-a-byte-array-into-structures-in-c.aspx)可以为我们完成这项工作，但如果结构中有一个数组，则不能。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T16:15:35.723

我不确定你在问什么。您是否尝试在 C# 中为普通的旧 C# 用法或互操作（PInvoke）目的获得等效的结构定义？如果是用于 PInvoke，则后续结构将起作用

```
[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct tPacket {

    /// WORD->unsigned short
    public ushort word1;

    /// WORD->unsigned short
    public ushort word2;

    /// BYTE->unsigned char
    public byte byte1;

    /// BYTE->unsigned char
    public byte byte2;

    /// BYTE[8]
    [System.Runtime.InteropServices.MarshalAsAttribute(System.Runtime.InteropServices.UnmanagedType.ByValArray, SizeConst=8, ArraySubType=System.Runtime.InteropServices.UnmanagedType.I1)]
    public byte[] array123;
} 
```

如果您正在寻找具有相同特征的普通旧 C# 结构，那么很遗憾不可能使用结构。您不能在 C# 结构中定义一个恒定大小的内联数组，也不能通过初始化程序强制该数组为特定大小。

在托管世界中有两种备选方案。

使用具有填充数组的创建方法的结构

```
[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct tPacket {
    public ushort word1;
    public ushort word2;
    public byte byte1;
    public byte byte2;
    public byte[] array123;
    public static tPacket Create() { 
      return new tPacket() { array123 = new byte[8] };
    }
} 
```

或者使用一个可以直接初始化 array123 成员变量的类。

**编辑**OP watns 以了解如何将 byte[] 转换为 tPacket 值

不幸的是，在 C# 中没有很好的方法来做到这一点。C++ 非常适合这种任务，因为它的类型系统非常弱，您可以选择将字节流视为特定结构（邪恶指针转换）。

这在 C# 不安全代码中可能是可能的，但我不相信它是。

本质上，您要做的就是手动解析字节并将它们分配给结构中的各种值。或者编写一个本地方法，将 C 样式转换和 PInvoke 放入该函数中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T16:44:46.230

我认为您正在寻找的内容（如果您使用类似 JaredPar 发布的结构定义）是这样的：

```
tPacket t = new tPacket();
byte[] buffer = new byte[Marshal.SizeOf(typeof(tPacket))];
socket.Receive(buffer, 0, buffer.length, 0);

GCHandle pin = GCHandle.Alloc(buffer, GCHandleType.Pinned);
t = (tPacket)Marshal.PtrToStructure(pin.AddrOfPinnedObject(), typeof(tPacket));
pin.free();

//do stuff with your new tPacket t 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:08:15.020

它也可以使用不安全的代码来完成，尽管它限制了程序可以运行的上下文，并且自然会引入安全漏洞的可能性。优点是您可以使用指针直接从数组转换为结构，并且如果您只想从结构中添加或删除字段，它也是免维护的。但是，访问数组需要使用固定语句，因为当结构包含在对象中时，GC 仍然可以在内存中移动结构。

这是我用于解释 UDP 数据包的不安全结构的一些修改代码：

```
using System;
using System.Runtime.InteropServices;

[StructLayout(LayoutKind.Sequential)]
public unsafe struct UnsafePacket
{
    int time;
    short id0;
    fixed float acc[3];
    short id1;
    fixed float mat[9];

    public UnsafePacket(byte[] rawData)
    {
        if (rawData == null)
            throw new ArgumentNullException("rawData");
        if (sizeof(byte) * rawData.Length != sizeof(UnsafePacket))
            throw new ArgumentException("rawData");

        fixed (byte* ptr = &rawData[0])
        {
            this = *(UnsafePacket*)rawPtr;
        }
    }

    public float GetAcc(int index)
    {
        if (index < 0 || index >= 3)
            throw new ArgumentOutOfRangeException("index");
        fixed (UnsafePacket* ptr = &acc)
        {
            return ptr[index];
        }
    }

    public float GetMat(int index)
    {
        if (index < 0 || index >= 9)
            throw new ArgumentOutOfRangeException("index");
        fixed (UnsafePacket* ptr = &mat)
        {
            return ptr[index];
        }
    }

            // etc. for other properties
} 
```

对于这种代码，检查数组的长度是否与结构的大小完全匹配非常重要，否则您将打开一些令人讨厌的缓冲区溢出。由于*unsafe*关键字已应用于整个结构，因此您无需将每个方法或代码块标记为单独的*不安全*语句。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-01T19:20:55.273

您可以通过在结构中编写函数以供访问，将外部世界看起来像固定大小的数组放置在安全结构中。例如，这是一个安全结构中的固定 4 x 4 双精度数组：

```
public struct matrix4 //  4 by 4 matrix  
{  
    //  
    //  Here we will create a square matrix that can be written to and read from similar  
    //  (but not identical to) using an array.  Reading and writing into this structure  
    //  is slower than using an array (due to nested switch blocks, where nest depth  
    //  is the dimensionality of the array, or 2 in this case).  A big advantage of this  
    //  structure is that it operates within a safe context.  
    //  
    private double a00; private double a01; private double a02; private double a03;  
    private double a10; private double a11; private double a12; private double a13;  
    private double a20; private double a21; private double a22; private double a23;  
    private double a30; private double a31; private double a32; private double a33;  
    //
    public void AssignAllZeros()                    //  Zero out the square matrix  
    { /* code */}               
    public double Determinant()                     //  Common linear algebra function  
    { /* code */}  
    public double Maximum()                         //  Returns maximum value in matrix  
    { /* code */}  
    public double Minimum()                         //  Minimum value in matrix  
    { /* code */}  
    public double Read(short row, short col)        //  Outside read access   
    { /* code */}  
    public double Read(int row, int col)            //  Outside read access overload  
    { /* code */}  
    public double Sum()                             //  Sum of 16 double precision values  
    {  
        return a00 + a01 + a02 + a03 + a10 + a11 + a12 + a13 + a20 + a21 + a22 + a23 + a30 + a31 + a32 + a33;  
    }  
    public void Write(short row, short col, double doubleValue)  //  Write access to matrix  
    { /* code */}  
    public void Write(int row, int col, double doubleValue)      //  Write access overload  
    { /* code */}              
} 
```

# function - 编写一个vim函数来插入一个静态文本块

> ID：690386
> 
> 赞同：52
> 
> 时间：2009-03-27T16:10:37.187
> 
> 标签：function, vim

我希望能够在 vim 中做这样的事情（如果有帮助，你可以假设 v7+）。

输入这样的命令（或类似的命令）

```
:inshtml 
```

并让 vim 将以下内容转储到当前光标位置的当前文件中

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title></title>
    </head>
    <body>
    </body>
</html> 
```

我可以写一个vim函数吗？有没有更好的办法？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-27T16:23:55.343

我通过在我的 vim 文件夹下保存一组文件来做到这一点，然后我使用`r`某个函数的命令（如果没有传递行号，则在当前位置插入文件的内容）插入这些文件：

```
function! Class()
    " ~/vim/cpp/new-class.txt is the path to the template file
    r~/vim/cpp/new-class.txt
endfunction 
```

当您想要插入多行文本时，这非常实用 - 在我看来。然后，例如，您可以映射一个键盘快捷键来调用您的函数：

```
nmap ^N :call Class()<CR> 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2011-05-27T13:57:16.777

迟到，仅供参考，但另一种方法是创建一个命令，例如

```
:command Inshtml :normal i your text here^V<ESC> 
```

你可以称之为

```
:Inshtml 
```

说明：命令在命令模式下运行，您使用 :normal 切换到普通模式，然后使用“i”切换到插入模式，“i”后面是您的文本，您以转义结束，通过输入作为字符输入^V

也可以添加参数，例如

```
:command -nargs=1 Inshtml :normal i You entered <args>^V<ESC> 
```

where `<args>`（按原样输入）将被实际参数替换，您可以使用

```
:Inshtml blah 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2016-01-22T16:13:06.267

我在**~/.vim/plugins/** 中使用以下代码创建了一个新文件**generate_html.vim**

 **```
"
" <This plugin generates html tags to new html files>
"

autocmd BufNewFile  *.html  call    Generate_html()

function! Generate_html()
    call append(0, "<!DOCTYPE HTML>")
    call append(1, "<html><head>")
    call append(2, "    <title></title>")
    call append(3, '    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />')
    call append(4, '    <style type="text/css">')
    call append(5, '    </style>')
    call append(6, '</head>')
    call append(7, '<body>')
    call append(8, '</body>')
    call append(9, '</html>')
endfunction 
```

这样，每次我在 vim 中打开一个新的 .html 文件时，它都会将该文本打印到新文件中

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-27T16:13:05.527

你能定义一个缩写吗？例如

```
:ab insh 'your html here' 
```

因为上面似乎没有任何参数化？

事实上，查看我的 VIM 配置，我检测到一个新的 .html 文件正在加载：

```
autocmd BufNewFile *.html call GenerateHeader() 
```

并定义一个函数`GenerateHeader()`来插入我所需的模板（我对 Java/Perl 等做同样的事情）。

为这类东西[买一本 Vim Cookbook](http://www.oualline.com/vim-cook.html)是值得的。这是一项合理的投资。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-27T16:24:37.650

## 片段鸸鹋

我喜欢使用[snippetsEmu](http://vim.sourceforge.net/scripts/script.php?script_id=1318) vim 插件来插入像你这样的代码片段。

snippetsEmu 的优点是您可以指定占位符并直接跳转到它们以插入值。*例如，在您的情况下，您可以在标题*标签之间添加一个占位符，以便在插入此片段时可以轻松地向文档添加标题。

snippetsEmu 带有各种片段（也适用于 HTML），并且可以轻松添加新的片段。

* * *

**编辑**

## 截图伴侣

今天我重新审视了我的 VIM 配置 + 安装的插件，发现了[snipMate](http://www.vim.org/scripts/script.php?script_id=254)插件~~，恕我直言，它甚至比 snippetsEmu 更好~~。*snipMate 会*像 TextMate 一样即时更新所有占位符。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-27T16:13:59.923

这应该是可能的。我使用自动替换。在我的 .vimrc 我有这一行：

```
iab _perls #!/usr/bin/perl<CR><BS><CR>use strict;<CR>use warnings;<CR> 
```

每当我启动 Perl 脚本时，我只需键入 _perls 并按 Enter。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-02-24T02:49:57.210

如果你像我一样还没有完全掌握 vimScript，你可以使用 Python（或任何其他程序）

[这家伙](http://www.derekwyatt.org/vim/vim-tutorial-videos/vim-advanced-tutorial-videos/)谈论vim表达式寄存器。基本上你把这样的东西放在你的`.vimrc`文件中

```
:imap <C-j> <C-r>=system('/home/BennyHill/htmlScript.py')<CR> 
```

这样每次在插入模式下按下`Ctrl``j`它都会调用其中包含类似内容的脚本`htmlScript.py`（**注意**我还没有实际测试过这个）

```
#!/usr/bin/env python
import sys

snippet="""<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title></title>
    </head>
    <body>
    </body>
</html>"""

sys.stdout.write(snippet) 
```

然后只需记住使文件可执行（`chmod 0755 /home/BennyHill/htmlScript.py`）。这可能有点矫枉过正，但我​​对 Python 比对 vim 的语法更舒服。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-27T16:15:29.967

您可以将此文本复制到某个（例如 'a' ）寄存器。并在每次需要时粘贴它，除非您覆盖寄存器“a”。

在可视模式下复制到寄存器 a：“ay
在正常模式下
从寄存器 a 粘贴：”ap 在插入模式下从寄存器 a 粘贴：a

或者，如果您已经复制了此模板，您可以使用

```
let @a = @* 
```

把这个模板注册一个。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-27T17:36:35.810

vim有很多[模板扩展插件](http://vim.wikia.com/wiki/Category:Automated_Text_Insertion#Related_scripts)。

注意：我正在维护[muTemplate](http://code.google.com/p/lh-vim/wiki/muTemplate)的分支。只需将您的代码转储 `{rtp}/template/html.template`到`$VIMTEMPLATES/html.template`. 就这样。如果您不希望在打开新 HTML 文件时隐式加载该片段，则命名模板文件`html/whatever.template`（而不是），并在 INSERT 模式下（在 HTML 缓冲区中）使用of with`html.template`加载它。`:MuTemplate html/whatever``whatever^r<tab>`

所有的路径问题、可移植性问题等都已经得到处理。与在同一个片段定义文件中支持（并且以某种方式期望）多个（[难以维护](http://code.google.com/p/snippetsemu/source/browse/trunk/after/ftplugin/html_snippets.vim)，IMO）片段的snippetEmu 不同，Mu-template 每个片段需要一个模板文件。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-02-23T17:58:28.800

将您的文本放入文件中（例如，`html`）。然后将以下内容放入您的`.vimrc`.
`command Inshtml r html`

我使用`Inshtml`而不是`inshtml`因为 vim 不支持以小写字母开头的用户定义命令。

然后如果可以输入`Inshtml`命令模式（即，`:Inshtml`）。

# sql-server-ce - 如何从 SQL Server Compact Edition 中获得最高记录？

> ID：690388
> 
> 赞同：1
> 
> 时间：2009-03-27T16:10:43.130
> 
> 标签：sql-server-ce, limit

我试过了

```
 select top 1 * from tbl
 select top(1) * from tbl
 select * from tbl limit 1 
```

没有任何效果。

SQL Server Compact Edition 是否支持获取前 x 行？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T16:12:19.287

是的，你的第二个语法应该是正确的。当你尝试它时会发生什么？

但是，该关键字是在 3.5 版本中添加的，因此如果您使用的是早期版本，那么答案是否定的。对不起。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-16T05:35:03.930

如果您的 SQL CE 与 VS 兼容，则有一篇[Visual Studio Magazine 帖子](http://visualstudiomagazine.com/columns/article.aspx?editorialsid=2515)讨论了如何正确重新安装它。

这不好玩，但它确实有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T16:19:49.440

MSDN 的文档似乎表明它应该可以工作。

[http://msdn.microsoft.com/en-us/library/bb686896.aspx](http://msdn.microsoft.com/en-us/library/bb686896.aspx)

也许发布更多你的脚本？你在里面做别的吗。

# c# - 在某些情况下，使用 StructureMap 向构造函数注入不同的对象

> ID：690389
> 
> 赞同：5
> 
> 时间：2009-03-27T16:11:03.283
> 
> 标签：c#, .net, inversion-of-control, structuremap

我有 IRepository<T> 和实现 SqlRepository<T>。SqlRepository 在构造函数中有 DataContext 参数。

SM 配置如下所示：

```
x.ForRequestedType(typeof(IRepository<>))
.TheDefaultIsConcreteType(typeof(SqlRepository<>));

x.ForRequestedType<DataContext>().CacheBy(InstanceScope.Hybrid)
.TheDefault.Is.ConstructedBy(()=>{
                        var dc = new FirstDataContext();
                        dc.Log = new DebuggerWriter();
                        return dc;
                    }); 
```

但是对于 IRepository<SpecificObject> 的构造，我想注入不同的 DataContext。我怎么说 SM 当我要求 IReposiotry<SpecificObject> 我想要不同的 DataContext，而不是 FirstDataContext 而是 SecondDataContext（那个 DC 去不同的数据库）。

例如，当我要求 IRepository<T> 时，我希望注入 FirstDataContext，但是当我明确要求 IRepository<Product> 时，我希望注入 SecondDataContext。

此外，该 SecondDC 应该由 SM 混合缓存！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T18:47:02.927

就像是...

```
ForRequestedType<DataContext>()
    .CacheBy(InstanceScope.Hybrid)
    .AddInstances(inst => inst.ConstructedBy(() => 
        new SecondDataContext { Log = new DebuggerWriter() })
        .WithName("secondDataContext"))
    .TheDefault.Is
    .ConstructedBy(() => new FirstDataContext {Log = new DebuggerWriter()});

ForRequestedType<IRepository<SpecificObject>>()
    .TheDefault.Is
    .OfConcreteType<SqlRepository<SpecificObject>>()
    .CtorDependency<DataContext>()
    .Is(inst => inst.TheInstanceNamed("secondDataContext")); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-15T20:18:51.290

这对我也很有帮助。在构造函数中使用一个具体类，该类又在其构造函数中获取不同的连接字符串，具体取决于哪个“父”类正在使用它。谢谢。

```
 ObjectFactory.Initialize(x=>
                                     {
                                         // Different connection string for each usage
                                         // of the RelationalGateway class
                                         x.ForRequestedType<RelationalGateway>()
                                             .AddInstances(r =>
                                                 r.ConstructedBy(() => 
                                                     new RelationalGateway(ConfigRepository.DataSourceName))
                                             .WithName("config"))
                                             .TheDefault.Is.ConstructedBy(
                                             () => new RelationalGateway(OracleSpatialRepository.DataSourceName));

                                         // Inject the right RelationalGateway
                                         x.ForRequestedType<IConfigRepository>()
                                             .TheDefault.Is.OfConcreteType<ConfigRepository>()
                                             .CtorDependency<RelationalGateway>().Is(inst => 
                                                 inst.TheInstanceNamed("config"));

                                         x.ForRequestedType<ISpatialRepository>()
                                             .TheDefault.Is.OfConcreteType<OracleSpatialRepository>()
                                             .CtorDependency<RelationalGateway>().IsTheDefault();

                                         // Other simple types
                                         x.ForRequestedType<IIdGenerator>().TheDefaultIsConcreteType<IdGenerator>();
                                     }); 
```

# sharepoint - 列表中的 Sharepoint 计算列

> ID：690396
> 
> 赞同：0
> 
> 时间：2009-03-27T16:12:22.877
> 
> 标签：sharepoint

我在共享点列表中添加了一个新的计算列 A。如果另一列 B 的值发生更改并且列 A 仍然为空，则应更新此列 A！我很难实现公式的“如果 A 列仍然为空”部分。

这是我的公式：

```
=IF([Issue Status]="Active",Today) 
```

此外，我添加了一个名为“今天”的列，并在输入公式后再次将其删除。这样可行！

有人知道谁来实施“仍然是空的”部分吗？

谢谢丹尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-15T12:03:19.997

您将使用 ISBLANK() 函数。[在 ObjectMix](http://objectmix.com/sharepoint/317409-moss-list-check-list-null-calculated-column-formula.html#post1135466)向Primo 致敬。

Office 帮助网站上列出了一些[可用的常用功能，它们也可能有所帮助。](http://office.microsoft.com/en-us/sharepointtechnology/HA011609471033.aspx)

从本质上讲，您最终会得到一个公式：

=IF(OR([Issue Stats]="Active",ISBLANK([B])), "真值", "假值")

# css - CSS，居中的 div，缩小以适应？

> ID：690397
> 
> 赞同：76
> 
> 时间：2009-03-27T16:12:28.617
> 
> 标签：css

这就是我想要的：

```
text text text text text text text text text text text
text text text text text text text text text text text
                   +-----------+
                   | some text |
                   +-----------+
text text text text text text text text text text text
text text text text text text text text text text text 
```

...其中“一些文本”块是一个 div。我希望 div 是包含其文本而不换行所需的最小宽度。如果文本太长而无法不换行，则可以换行。

我不想为 div 设置显式宽度。我也不想设置最小宽度或最大宽度；就像我说的那样，如果一行中包含太多文本而无需换行，那么可以换行。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-03-27T16:21:02.480

DIV 元素默认是块级的，这意味着它们会自动获得 100% 的宽度。要改变这一点，请使用这个 CSS...

```
.centerBox {
  display:inline-block;
  text-align:center;
}

<div class="centerBox">
  Some text
</div> 
```

**编辑**：更新为使用 CSS 类而不是内联属性并将“块”更改为“内联块”

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-06-15T08:29:31.657

我不知道，这里的解决方案似乎部分正确，但实际上并没有奏效。根据 Josh Stodola 的回答，这是一个在 Firefox、Safari、Chrome 和 IE 7、8 和 9 中测试的跨浏览器解决方案

CSS：

```
body {
    text-align: center;
}

#centered-div {
    text-align: left;
    background: #eee;

    display: inline-block;

    /* IE7 bs - enables inline-block for div-elements*/
    *display: inline;
    zoom: 1;
} 
```

标记：

```
<div id="centered-div">
    Cum sociis natoque penatibus et magnis dis<br />
    parturient montes, nascetur ridiculus mus.
</div> 
```

要添加 IE6 支持（叹​​气），请添加`_height: [yourvalue]`到 div。是的，带有下划线。

在 JSFiddle 上自己测试一下：http: [//jsfiddle.net/atp4B/2/](http://jsfiddle.net/atp4B/2/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-27T16:15:45.193

```
<style type="text/css">
    /* online this CSS property is needed */
    p.block {
        text-align: center;
    }
    /* this is optional */
    p.block cite {
        border: solid 1px Red;
        padding: 5px;
    }    
</style>

<p>Some text above</p>
<p class="block"><cite>some text</cite></p>
<p>Some text below</p> 
```

**提示**：不要将 DIV 用于文本块（用于 SEO 和更好的语义目的）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-27T17:00:36.630

乔什·斯托多拉的道具，尽管他并不完全正确。需要的属性是：

```
display: inline-block; 
```

这解决了我的问题。耶！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-06-23T17:43:29.107

我推荐**flexbox**！看看这个网站有什么可能，[由 flexbox 解决](http://philipwalton.github.io/solved-by-flexbox/demos/vertical-centering/)。

它很新，但适用于所有主要的现代浏览器（IE10 使用`-ms-`前缀、IE11+、Firefox 31+、Chrome 31+、Safari 7+，...） - 请参阅[此图表](http://caniuse.com/#feat=flexbox)。

基本上，垂直和水平居中，连同动态尺寸，可以在 4 个语句中完成：

```
parent {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
} 
```

**确保**这个父级实际上是 100% 的高度。`body`您可能还需要设置`html`100% 高度。

我的实现可以在我自己的个人网站[http://pgmann.cf](http://pgmann.cf)上看到。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-02T08:22:20.393

这是我根据您正在寻找的内容制作的示例：
（jsFiddled 此处：http: [//jsfiddle.net/yohphomu/](http://jsfiddle.net/yohphomu/)）

警告：

> 我是一个CSS狂热者！！！

如果我正确理解您的问题，则无需设置高度或宽度，因为它们的默认设置是自动（据说您可以使用自动），但唯一的问题是如果您想更改背景或放置一个边框，它将使它超出所需的字段。为什么会这样以及我们如何解决它，请继续阅读。

> 或者只是复制并研究这个例子。

任何有这个问题的人都没有意识到事情（假设你有这个问题并且正在使用 div） div 标签之间的任何东西都被认为（为了理解目的）是一个完整的集合，这意味着在那个 div 中是你想要的所有东西代表（计算机做他们被告知的事情，而不是你想让他们做的事情）所以（例如）为了将 text-align 设置为居中，它需要整个行空间，并且（最终）如果它有边框，它将与它使用的所有空间接壤。如果您理解这一点，请继续阅读，如果不是很好，则无法帮助您。

所以现在我们了解了发生了什么，我们如何解决它？好吧，我们需要一个部分来居中，另一个来着色。在我的示例中，我使用 div 将其居中并跨越到颜色。我需要 div 吗？我很肯定我没有。我可以通过使用 p 居中来实现同样的效果（或者我可以摆脱 p 并只使用 div）。我这样做的原因是为了保持井井有条。

> 实际上只是因为我没有意识到，直到我想到它，但又不想修复它。

希望这回答了你的问题。你花了 4 年才得到答案，但我却花了 30 分钟才弄明白（而且我已经学习 CSS 几天了）。

这个例子：

```
<div class='container'>
    <div class="text">
        text text text text text text text text text text text
text text text text text text text text text text text text text text text text text
    </div>
    <div class="holder">
        <p><span>text here</span></p>
    </div>
    <div>
        text text text text text text text text text text text
text text text text text text text text text text text text text text text text text
    </div>
    </div> 
```

然后css看起来像：

```
.container {
width: 500px;
height: 500px;
}
.text {
    font-size: 20px;
}
.holder {
text-align: center;

}
span {
background-color: blue;
    border: 1px solid black;
} 
```

注意：我将容器设置为宽度和高度，因为我同时在做一个项目，并用文本模拟全屏。

另请注意，我已经使文本具有带边框的单独背景颜色。我这样做是为了表明它的测量是独立的，并在需要时重新调整。

> 不客气，我也认为人们不理解你的问题。希望我做到了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T16:19:12.657

像这样的东西？

```
<html>
<head>
</head>
<body style="text-align: center;">

   <div style="width: 500px; margin: 0 auto;">

       <p>text text text text text text text text text text text text text text text text text text text text text text</p>

       <div>hello</div>

       <p>text text text text text text text text text text text text text text text text text text text text text text</p>

   </div>

</body> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-12-19T11:25:28.183

```
<style>
p.one
{
border-style:solid;
border-width:2px;
border-color:red;
display:inline-block;
}
</style>

<p class="one">some text</p> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-19T18:01:41.837

**HTML**

```
<div class="outerdiv">
<div class="innerdiv">
++++TEXT+++
</div>
</div> 
```

**CSS**

```
.outerdiv{
text-align: center;
}
.innerdiv{
display: inline-block;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-23T13:27:13.947

`display: inline-block`如果块没有在所需的居中文本之前和之后关闭，则将不起作用。您真正需要的是`width: fit-content; margin: auto;`在块元素上设置，请参阅代码段。

```
.center {
  display: block;
  width: fit-content;
  margin: 1em auto;
  padding: .5em;
  text-align: right;
  background: yellow;
}
```

```
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce fringilla diam sagittis, scelerisque ipsum ac, imperdiet tortor. Curabitur dapibus metus eu neque consectetur hendrerit. Cras interdum faucibus malesuada.

<div class="center">
  Lorem ipsum yourself, buddy!<br>
  Try to align this!
</div>

In auctor aliquam erat in pharetra. Suspendisse potenti. Pellentesque vehicula interdum sem vel tristique. Nullam erat nisl, imperdiet et turpis ut, ornare vulputate erat.
```

# wpf - 如何在 WPF 网格中隐藏标签或文本块

> ID：690401
> 
> 赞同：8
> 
> 时间：2009-03-27T16:12:58.147
> 
> 标签：wpf, grid, label, textblock

我试图隐藏放置在网格内的 TextBlock 和 Label，如下所示：

```
<TextBlock Grid.Column="3" Grid.Row="2" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Hidden">Text inside TextBlock</TextBlock>
<Label Grid.Column="4" Grid.Row="2" HorizontalAlignment="Center" Visibility="Hidden">Text inside Label</Label> 
```

但文字并没有消失。任何想法为什么会这样？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-06-27T05:51:40.157

在代码中，您可以使用如下内容：

```
Label1.Visibility = Visibility.Hidden; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-27T16:17:47.560

试试[Visibility.Collapsed](http://msdn.microsoft.com/en-us/library/system.windows.visibility.aspx)

```
<TextBlock Visibility="Collapsed"> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-02-03T11:42:52.417

@Laxman Singhare 你确定 Visibility.Hidden 吗？它应该是

```
this.TextBlock.Visibility = Visibility.Collapsed; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T16:24:09.120

没关系，当你运行它时它确实有效，只是设计器没有正确显示它。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-27T16:19:58.553

你也可以用 and height == 0 来设置

# c# - 向 Facebook 用户发送通知的可用功能有哪些？

> ID：690404
> 
> 赞同：1
> 
> 时间：2009-03-27T16:13:24.917
> 
> 标签：c#, asp.net, facebook, facebooktoolkit

目前我正在为我的 ASP.net Facebook 应用程序使用 Codeplex 的 Facebook Developer Toolkit 版本 2。我希望能够向用户的收件箱或应用程序墙发送通知，并且想知道有哪些可用功能可以做到这一点？如果 API 中没有，请提供 Facebook 主库中的示例函数。这将有很大帮助。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T17:45:13.573

经过简短的搜索，我找到了一个使用该工具包发送通知的示例：

> facebook.Components.FacebookService fs = new facebook.Components.FacebookService(); fs.ApplicationKey = ConfigurationManager.AppSettings["APIKey"]; fs.Secret = ConfigurationManager.AppSettings["Secret"]; 字符串 sessionKey = dict["facebook_session_key"]; fs.SessionKey = sessionKey; fs.uid = long.Parse(member.FacebookId); fs.notifications.send(member.FacebookId, "通知消息");

（来自： http: [//facebooktoolkit.codeplex.com/Thread/View.aspx?ThreadId=49876](http://facebooktoolkit.codeplex.com/Thread/View.aspx?ThreadId=49876)）

在查看 Codeplex 源之后，很明显这会发送用户到用户的通知，因此需要发送者的活动用户会话。

Codeplex 似乎不支持不需要会话的应用程序到用户的通知，但添加此功能将是微不足道的。将类型变量添加到 send 方法并根据此处的 API 文档进行相应设置：[http ://wiki.developers.facebook.com/index.php/Notifications.send](http://wiki.developers.facebook.com/index.php/Notifications.send)

Codeplex Developer Toolkit 中的 notifications.send 方法的源代码在这里：http: [//facebooktoolkit.codeplex.com/SourceControl/changeset/view/28656#233852](http://facebooktoolkit.codeplex.com/SourceControl/changeset/view/28656#233852)

请记住，Codeplex 开发人员工具包源代码已超过 3 个月未更新。这意味着它不支持许多新的 Facebook API 功能和更改。您可能需要浏览客户端库 wiki 页面以查找更新的库：[http ://wiki.developers.facebook.com/index.php/Client_Libraries](http://wiki.developers.facebook.com/index.php/Client_Libraries)

# ruby-on-rails - ActiveRecord：我可以复制关联吗？

> ID：690405
> 
> 赞同：19
> 
> 时间：2009-03-27T16:13:35.197
> 
> 标签：ruby-on-rails, ruby, activerecord

有没有办法将一个模型的关联复制到另一个模型...

```
template_model = MyModel.find(id)
new_model = template_model.clone
new_model.children << template_model.children # I want to *copy* children 
```

...这样我将孩子从模板复制到新模型？（事实上​​，这段代码将子模板从模板移动到新模型）。

我知道我可以手动循环，但是有更简洁的方法吗？

谢谢

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-27T16:23:30.680

问题是您正在克隆模板，但没有克隆它的子模板。尝试类似：

```
template_model = MyModel.find(id)
new_model = template_model.clone
new_model.children << template_model.children.collect { |child| child.clone } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-10-18T14:53:11.640

在 /lib 下的某个位置添加此内容。例如 clone_deep.rb。

```
module CloneDeep
  def clone_deep
    kopy = clone
    self.class.reflect_on_all_associations.each do |association|
      next if association.macro == :belongs_to
      cloned_object = case association.macro
                        when :has_many
                          self.send(association.name).collect { |item| item.clone_deep }
                        when :has_one
                          self.send(association.name) && self.send(association.name).clone_deep
                        else
                          clone
                      end
      kopy.send("#{association.name}=", cloned_object)
    end
    return kopy
  end
end 
```

在 config/initializers/ 文件夹下创建新的初始化程序。在这个文件里面粘贴

```
ActiveRecord::Base.send(:include, CloneDeep) 
```

现在您可以使用所有 has_one 和 hos_many 关联来克隆模型。

```
cloned_person = person.clone_deep
cloned_person.save 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-09-29T23:53:12.417

`#dup`应该使用而不是`#clone`，因为在后者的情况下不会复制属性。

```
module Promotion
  class Banner
    has_many :localizations
    has_many :images

    def deep_dup!
      duplicate = dup
      duplicate.save

      duplicate.localizations = localizations.collect { |localization| localization.dup }
      duplicate.images = images.collect { |image| image.dup }

      duplicate
    end
  end
end 
```

[http://api.rubyonrails.org/classes/ActiveRecord/Core.html#method-i-clone](http://api.rubyonrails.org/classes/ActiveRecord/Core.html#method-i-clone) [http://api.rubyonrails.org/classes/ActiveRecord/Core.html#method-i-dup](http://api.rubyonrails.org/classes/ActiveRecord/Core.html#method-i-dup)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T16:23:56.810

好吧，这不是真正的副本。

但你可以做

```
new_model.child_ids = template_model.child_ids 
```

# asp.net - IE7不自动显示滚动条？

> ID：690412
> 
> 赞同：0
> 
> 时间：2009-03-27T16:16:25.377
> 
> 标签：asp.net, css, internet-explorer, overflow

我想知道是否有办法解决我在使用 IE7 时遇到的滚动条问题。

这是我的CSS：

```
.gridContainer {
    height: 500px; 
    width: 410px;
    overflow: auto;
    background-color: #fff;
    border: 1px solid #6699CC;
}
.Grid {
    width: 100%;
    background-color: #fff;
}
.Grid td {
    height: 13px;
    min-width: 30px;
    padding-left: 5px;
    text-align: left;
    border-top: 1px solid #C4DDFF;
}
.GridHeader {
    font-weight: bold;
    height: 20px;
    min-width: 30px;
    padding-left: 10px;
    text-align: left;
    background-color: #F0F0F0;
    border-bottom: #999;
} 
```

这是HTML：

```
<div class="gridContainer">
    <asp:GridView ID="GridView2" runat="server" GridLines="None" CssClass="Grid"  AutoGenerateColumns="False"
        AllowSorting="True" onsorting="GridView2_Sorting">
        <RowStyle CssClass="GridItem" />
        <Columns>
            <asp:TemplateField>
            <ItemTemplate>
                <asp:CheckBox ID="chkSelect" runat="server" />
            </ItemTemplate>
            <HeaderTemplate>
                <asp:CheckBox ID="chkSelectAll" runat="server" onclick="SelectAll2(this);" />
            </HeaderTemplate>
        </asp:TemplateField>
            <asp:BoundField DataField="Name" HeaderText="Name" ReadOnly="True"
                SortExpression="Name" />
            <asp:BoundField DataField="Position Type" HeaderText="Position Type"
                SortExpression="Position Type" />
        </Columns>
        <HeaderStyle CssClass="GridHeader" />
        <AlternatingRowStyle CssClass="GridAltItem" />
    </asp:GridView>
</div> 
```

它在其他浏览器中运行良好，但由于某种原因在 IE7 中无法运行。

*为澄清而编辑：*

这就是我想要完成的事情：有`div`一个固定的`width`，`height`并且里面有一个`gridview`. 如果`gridview`的宽度或高度超过 的固定大小`div`，我希望滚动条出现在`div`.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-05T03:17:33.550

在您的 .gridContainer 类中设置溢出：滚动；

如果内部内容增长超过其设置的宽度或高度，这将向 div 添加滚动条。

# bash - 我应该按什么顺序向正常关闭进程发送信号？

> ID：690415
> 
> 赞同：107
> 
> 时间：2009-03-27T16:17:23.003
> 
> 标签：bash, signals, job-control, sigterm

在对另一个[问题](https://stackoverflow.com/questions/526782)的[这个答案的](https://stackoverflow.com/questions/526782#526815)[*评论*](https://stackoverflow.com/questions/526782/how-do-i-limit-the-running-time-of-a-bash-script#comment340090_526815)中，评论者说：

> 除非绝对必要，否则不要使用 kill -9 ！SIGKILL 不能被捕获，因此被杀死的程序不能运行任何关闭例程来例如擦除临时文件。首先尝试 HUP (1)，然后是 INT (2)，然后是 QUIT (3)

我原则上同意`SIGKILL`，但其余的对我来说都是新闻。`kill`鉴于is发送的默认信号`SIGTERM`，我希望它是正常关闭任意进程的最常见的预期信号。此外，我还看到`SIGHUP`用于非终止原因，例如告诉守护进程“重新读取您的配置文件”。在我看来`SIGINT`（与 Ctrl-C 相同的中断，对吗？）并没有得到应有的广泛支持，或者终止得相当不优雅。

鉴于这`SIGKILL`是最后的手段——你应该将**哪些信号以及以什么顺序**发送到任意进程，以便尽可能优雅地关闭它？

如果可以的话，请用支持事实（超出个人偏好或意见）或参考来证实您的答案。

注意：我对包括考虑 bash/Cygwin 的最佳实践特别感兴趣。

**编辑：**到目前为止，似乎没有人提到 INT 或 QUIT，而且很少提到 HUP。是否有任何理由将这些包含在有序的进程终止中？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2009-03-27T17:07:51.527

**SIGTERM 告诉应用程序终止。** 其他信号告诉应用程序其他与关闭无关但有时可能具有相同结果的事情。不要使用那些。如果您希望应用程序关闭，请告诉它。不要给它误导性信号。

有些人认为终止进程的智能标准方法是向它发送一系列信号，例如 HUP、INT、TERM 和最后的 KILL。这是荒唐的。终止的正确信号是 SIGTERM，如果 SIGTERM 没有立即终止进程，正如您可能更喜欢的那样，那是因为应用程序已选择处理该信号。这意味着它有一个很好的理由不立即终止：它有清理工作要做。如果您使用其他信号中断清理工作，则无法确定内存中的哪些数据尚未保存到磁盘，哪些客户端应用程序处于挂起状态，或者您是否在“句子中间”中断它，这实际上是数据损坏。

有关信号真正含义的更多信息，请参阅 sigaction(2)。不要将“默认操作”与“描述”混淆，它们不是一回事。

SIGINT 用于发出进程的交互式“键盘中断”信号。某些程序可能会出于终端用户的目的以特殊方式处理这种情况。

SIGHUP 用于表示终端已经消失并且不再查看进程。就这些。一些进程选择关闭作为响应，通常是因为没有终端它们的操作没有意义，一些选择做其他事情，例如重新检查配置文件。

SIGKILL 用于从内核中强制删除进程。它的特殊之处在于它实际上不是进程的信号，而是直接由内核解释。

**不要发送 SIGKILL。** SIGKILL 绝对不应该由脚本发送。如果应用程序处理 SIGTERM，清理可能需要一秒钟，可能需要一分钟，**可能需要一小时**。取决于应用程序在准备结束之前必须完成的工作。*任何“假定*”应用程序的清理序列已经花费了足够长的时间并且需要在 X 秒后使用快捷方式或 SIGKILLed 的任何逻辑都是**完全错误**的。

*应用程序需要*SIGKILL 终止的唯一原因是，如果在其清理过程中出现问题。在这种情况下，您可以打开一个终端并手动 SIGKILL 它。除此之外，您要 SIGKILL 某些东西的唯一另一个原因是因为您*想*阻止它自行清理。

即使世界上一半的人在 5 秒后盲目地发送 SIGKILL ，这仍然是非常错误的事情。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2016-06-08T02:47:28.507

**简短回答**：发送`SIGTERM`，30 秒后，`SIGKILL`。即发送`SIGTERM`，稍等（可能因程序而异，您可能更了解您的系统，但 5 到 30 秒就足够了。关闭机器时，您可能会看到它自动等待长达 1'30 秒。毕竟为什么这么着急？），然后发送`SIGKILL`.

**合理答案**：`SIGTERM`，，，`SIGINT`这`SIGKILL` 绰绰有余。该过程**很**可能会在之前终止`SIGKILL`。

**长**答案**：,,,,,, `SIGTERM`_ `SIGINT`_`SIGQUIT``SIGABRT``SIGKILL`**

 **这是不必要的，但至少您不会误导有关您的消息的过程。所有这些信号*确实*意味着您希望进程停止正在执行的操作并退出。

无论您从这个解释中选择什么答案，请记住这一点！

如果您发送一个意味着其他东西的信号，该过程可能会以非常不同的方式处理它（一方面）。另一方面，如果进程不处理信号，那么无论你发送什么都无关紧要，进程无论如何都会退出（当然，当默认操作是终止时）。

因此，您必须将自己视为程序员。你会编写一个函数处理程序，比如说，`SIGHUP`退出与某物连接的程序，还是循环它以尝试再次连接？这是这里的主要问题！这就是为什么只发送意味着你想要的信号很重要的原因。

**几乎愚蠢的长答案**：

下表包含相关信号，以及程序不处理它们时的默认操作。

我按照我建议使用的顺序订购了它们（顺便说一句，我建议您使用*合理的答案*，而不是这里的这个），如果您真的需要全部尝试（如果说桌子是按照以下顺序排列的，那会很有趣它们可能造成的破坏，但这并不*完全*正确）。

**不**推荐使用带星号 (*) 的信号。关于这些的重要一点是，您可能永远不知道它被编程做什么。特别`SIGUSR`！它可能会开始启示录（对于程序员来说这是一个自由信号，可以做任何他/她想做的事情！）。但是，如果不处理**或**在不太可能的情况下处理终止，程序将终止。

在表中，带有用于终止和生成核心转储的默认选项的信号留在最后，就在`SIGKILL`.

```
Signal     Value     Action   Comment
----------------------------------------------------------------------
SIGTERM      15       Term    Termination signal
SIGINT        2       Term    Famous CONTROL+C interrupt from keyboard
SIGHUP        1       Term    Disconnected terminal or parent died
SIGPIPE      13       Term    Broken pipe
SIGALRM(*)   14       Term    Timer signal from alarm
SIGUSR2(*)   12       Term    User-defined signal 2
SIGUSR1(*)   10       Term    User-defined signal 1
SIGQUIT       3       Core    CONTRL+\ or quit from keyboard
SIGABRT       6       Core    Abort signal from abort(3)
SIGSEGV      11       Core    Invalid memory reference
SIGILL        4       Core    Illegal Instruction
SIGFPE        8       Core    Floating point exception
SIGKILL       9       Term    Kill signal 
```

然后我会建议这个*几乎*愚蠢的长答案： `SIGTERM`,,,,,,,,,`SIGINT``SIGHUP``SIGPIPE``SIGQUIT``SIGABRT``SIGKILL`

最后，

**绝对是愚蠢的长长的答案**：

不要在家里尝试这个。

`SIGTERM`, `SIGINT`, `SIGHUP`, `SIGPIPE`, `SIGALRM`, `SIGUSR2`, `SIGUSR1`, , , , , , , , , , , , , , , , , , `SIGQUIT`, `SIGABRT`, `SIGSEGV`, , .`SIGILL``SIGFPE``SIGKILL`

`SIGUSR2`应该先尝试一下，`SIGUSR1`因为如果程序不处理信号，我们会更好。`SIGUSR1`如果它只处理其中一个，它更有可能处理。

**顺便说一句， KILL**`SIGKILL` ：正如其他答案所述，发送到进程并没有错。好吧，想想当你发送`shutdown`命令时会发生什么？`SIGTERM`它只会尝试`SIGKILL`。你认为为什么会这样？`shutdown`如果命令只使用这两个，为什么还需要任何其他信号？

* * *

现在，回到**长答案**，这是一个不错的单行：

```
for SIG in 15 2 3 6 9 ; do echo $SIG ; echo kill -$SIG $PID || break ; sleep 30 ; done 
```

它在信号之间休眠 30 秒。为什么还需要*oneliner*？;)

另外，建议：仅使用`15 2 9`来自**合理答案**的信号进行尝试。

*安全性*`echo`：当你准备好时，移除第二个。我称它为我`dry-run`的*网民*。总是用它来测试。

* * *

**优雅地编写脚本**

实际上我对这个问题很感兴趣，所以我决定创建一个小脚本来做到这一点。请随时在此处下载（克隆）它：

[Killgracefully 存储库](https://github.com/drbeco/killgracefully)的 GitHub 链接

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-27T16:24:54.453

通常你会发送`SIGTERM`，默认的 kill。这是默认设置是有原因的。只有当程序在合理的时间内没有关闭时，您才应该求助于`SIGKILL`. 但请注意，`SIGKILL`该程序无法清理数据，数据可能已损坏。

至于`SIGHUP`，`HUP`代表“挂断”，历史上意味着调制解调器断开连接。它本质上等同于`SIGTERM`. 守护程序有时用于`SIGHUP`重新启动或重新加载配置的原因是守护程序与任何控制终端分离，因为守护程序不需要这些，因此永远不会收到`SIGHUP`，因此该信号被视为“释放”以供一般使用。并非所有守护进程都使用它来重新加载！SIGHUP 的默认操作是终止，许多守护进程都是这样运行的！因此，您不能盲目地将`SIGHUP`s 发送到守护进程并期望它们能够生存。

**编辑：** `SIGINT`终止进程可能不合适，因为它通常与`^C`终端设置相关或中断程序。许多程序出于自己的目的捕获它，因此它很常见以至于它不起作用。`SIGQUIT`通常具有创建核心转储的默认设置，除非您希望将核心文件放在它周围，否则也不是一个好的选择。

摘要：如果您发送`SIGTERM`并且程序没有在您的时间范围内死亡，那么发送它`SIGKILL`。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-27T16:53:43.183

**`SIGTERM`**实际上是指给应用程序发送一条消息：“*你会这么好心去自杀吗*”。它可以被应用程序捕获和处理以运行清理和关闭代码。

**`SIGKILL`**不能被应用程序捕获。应用程序被操作系统杀死，没有任何清理的机会。

通常先发送`SIGTERM`，休眠一段时间，然后发送`SIGKILL`。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-27T16:20:28.567

*   SIGTERM 相当于在窗口中“单击'X'”。
*   SIGTERM 是 Linux 在关闭时首先使用的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-01-26T19:36:42.810

在这里进行所有讨论，没有提供任何代码。这是我的看法：

```
#!/bin/bash

$pid = 1234

echo "Killing process $pid..."
kill $pid

waitAttempts=30 
for i in $(seq 1 $waitAttempts)
do
    echo "Checking if process is alive (attempt #$i / $waitAttempts)..."
    sleep 1

    if ps -p $pid > /dev/null
    then
        echo "Process $pid is still running"
    else
        echo "Process $pid has shut down successfully"
        break
    fi
done

if ps -p $pid > /dev/null
then
    echo "Could not shut down process $pid gracefully - killing it forcibly..."
    kill -SIGKILL $pid
fi 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T16:26:16.227

HUP对我来说听起来很垃圾。我会把它发送给一个守护进程来重新读取它的配置。

SIGTERM 可以被拦截；您的守护程序在收到该信号时可能会运行清理代码。对于 SIGKILL，您不能这样做。因此，使用 SIGKILL 您不会给守护进程的作者任何选项。

更多关于[维基百科的信息](http://en.wikipedia.org/wiki/Kill_(Unix))

# java - Java 项目的构建和版本编号（ant、cvs、hudson）

> ID：690419
> 
> 赞同：137
> 
> 时间：2009-03-27T16:18:51.300
> 
> 标签：java, build, build-process, versioning

Java 项目中系统构建编号和版本号管理的当前最佳实践是什么？具体来说：

*   如何在分布式开发环境中系统地管理内部版本号

*   如何在源代码中维护版本号/对运行时应用程序可用

*   如何与源存储库正确集成

*   如何更自动地管理版本号与存储库标签

*   如何与持续构建基础架构集成

有很多可用的工具，ant（我们正在使用的构建系统）有一个任务会维护一个内部版本号，但目前尚不清楚如何与使用 CVS、svn 或类似工具的多个并发开发人员一起管理它.

[编辑]

下面出现了几个好的和有用的部分或特定答案，所以我将总结其中的一些。在我看来，这方面并没有真正强大的“最佳实践”，而是一系列重叠的想法。下面，找到我的总结和一些人们可能会尝试回答的后续问题。[stackoverflow 的新手......如果我做错了，请提供评论。]

*   如果您使用的是 SVN，那么特定结帐的版本控制就会随之而来。内部编号可以利用这一点来创建一个唯一的内部编号，以标识特定的检查/修订。[我们出于遗留原因而使用的 CVS 并没有提供这种水平的洞察力......使用标签的手动干预可以让您部分实现。]

*   如果您使用 maven 作为构建系统，则支持从 SCM 生成版本号，以及用于自动生成版本的发布模块。[由于各种原因，我们不能使用 maven，但这有助于那些可以使用的人。[感[谢马塞洛-莫拉莱斯](https://stackoverflow.com/users/83674/marcelo-morales)]]

*   如果您使用[ant](http://ant.apache.org)作为构建系统，以下任务描述可以帮助生成一个 Java .properties 文件来捕获构建信息，然后可以通过多种方式将其折叠到您的构建中。[我们扩展了这个想法，包括了哈德逊派生的信息，感谢[marty-lamb](https://stackoverflow.com/users/79194/marty-lamb) ]。

*   Ant 和 maven（以及 hudson 和 Cruise Control）提供了将内部版本号放入 .properties 文件或 .txt/.html 文件的简单方法。这是否足够“安全”以防止它被有意或无意地篡改？在构建时将其编译成“版本控制”类会更好吗？

*   断言：构建编号应该在像[hudson](http://hudson-ci.org/)这样的持续集成系统中定义/制定。[感谢[marcelo-morales](https://stackoverflow.com/users/83674/marcelo-morales) ] 我们采纳了这个建议，但它确实解决了发布工程问题：发布是如何发生的？一个版本中是否有多个版本号？来自不同版本的内部版本号之间是否存在有意义的关系？

*   问题：内部版本号背后的目标是什么？它用于质量检查吗？如何？它主要是由开发人员在开发期间用于消除多个构建之间的歧义，还是更多地用于 QA 来确定最终用户获得了什么构建？如果目标是可重复性，理论上这就是发布版本号应该提供的——为什么不提供呢？（请在下面回答这个问题，这将有助于阐明您做出/建议的选择......）

*   问题：手动构建中是否有构建编号的位置？这是不是每个人都应该使用 CI 解决方案的问题？

*   问题：是否应将内部版本号签入 SCM？如果目标是可靠且明确地识别特定构建，如何应对可能崩溃/重启/等的各种连续或手动构建系统......

*   问题：内部版本号应该短而甜美（即，单调递增的整数），以便易于粘贴到文件名中以进行存档，易于在通信中引用等......还是应该长且充满用户名，日期戳，机器名称等？

*   问题：请提供有关内部版本号分配如何适合您更大的自动化发布流程的详细信息。是的，专家爱好者，我们知道这已经完成了，但并不是我们所有人都已经喝了酷爱酒……

我真的很想把它充实成一个完整的答案，至少对于我们的 cvs/ant/hudson 设置的具体示例，所以有人可以基于这个问题构建一个完整的策略。我将标记为“答案”任何可以为这个特殊情况提供简单描述的人（包括 cvs 标记方案、相关的 CI 配置项以及将内部版本号折叠到版本中以便以编程方式进行的发布过程可访问。）如果您想询问/回答另一个特定配置（例如，svn/maven/cruise control），我将从此处链接到该问题。--JA

[编辑 2009 年 10 月 23 日] 我接受了票数最高的答案，因为我认为这是一个合理的解决方案，而其他几个答案也包括好主意。如果有人想尝试用[marty-lamb](https://stackoverflow.com/users/79194/marty-lamb)合成其中的一些，我会考虑接受不同的。我对 marty-lamb 的唯一担心是它不会产生可靠的序列化内部版本号——它依赖于构建器系统中的本地时钟来提供明确的内部版本号，这不是很好。

[编辑 7 月 10 日]

我们现在包括一个如下所示的类。这允许将版本号编译到最终的可执行文件中。不同形式的版本信息在日志数据、长期存档的输出产品中发出，并用于跟踪我们（有时几年后）对输出产品的分析到特定的构建。

```
public final class AppVersion
{
   // SVN should fill this out with the latest tag when it's checked out.

   private static final String APP_SVNURL_RAW = 
     "$HeadURL: svn+ssh://user@host/svnroot/app/trunk/src/AppVersion.java $";
   private static final String APP_SVN_REVISION_RAW = "$Revision: 325 $";  

   private static final Pattern SVNBRANCH_PAT = 
     Pattern.compile("(branches|trunk|releases)\\/([\\w\\.\\-]+)\\/.*");
   private static final String APP_SVNTAIL = 
     APP_SVNURL_RAW.replaceFirst(".*\\/svnroot\\/app\\/", "");

  private static final String APP_BRANCHTAG;
  private static final String APP_BRANCHTAG_NAME;
  private static final String APP_SVNREVISION = 
    APP_SVN_REVISION_RAW.replaceAll("\\$Revision:\\s*","").replaceAll("\\s*\\$", "");

  static {
    Matcher m = SVNBRANCH_PAT.matcher(APP_SVNTAIL);
    if (!m.matches()) {
      APP_BRANCHTAG = "[Broken SVN Info]";
      APP_BRANCHTAG_NAME = "[Broken SVN Info]";
    } else {
      APP_BRANCHTAG = m.group(1);
      if (APP_BRANCHTAG.equals("trunk")) {
        // this isn't necessary in this SO example, but it 
        // is since we don't call it trunk in the real case
        APP_BRANCHTAG_NAME = "trunk";
      } else {
        APP_BRANCHTAG_NAME = m.group(2);
      }
    }
  }

  public static String tagOrBranchName()
  { return APP_BRANCHTAG_NAME; }

  /** Answers a formatter String descriptor for the app version.
   * @return version string */
  public static String longStringVersion()
  { return "app "+tagOrBranchName()+" ("+
    tagOrBranchName()+", svn revision="+svnRevision()+")"; }

  public static String shortStringVersion()
  { return tagOrBranchName(); }

  public static String svnVersion()
  { return APP_SVNURL_RAW; }

  public static String svnRevision()
  { return APP_SVNREVISION; }

  public static String svnBranchId()
  { return APP_BRANCHTAG + "/" + APP_BRANCHTAG_NAME; } 

  public static final String banner()
  {
    StringBuilder sb = new StringBuilder();
    sb.append("\n----------------------------------------------------------------");
    sb.append("\nApplication -- ");
    sb.append(longStringVersion());
    sb.append("\n----------------------------------------------------------------\n");
    return sb.toString();
  }
} 
```

如果这值得成为 wiki 讨论，请留下评论。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-03-28T17:30:41.103

对于我的几个项目，我捕获了 subversion 修订号、时间、运行构建的用户和一些系统信息，将它们填充到包含在应用程序 jar 中的 .properties 文件中，并在运行时读取该 jar。

蚂蚁代码如下所示：

```
<!-- software revision number -->
<property name="version" value="1.23"/>

<target name="buildinfo">
    <tstamp>
        <format property="builtat" pattern="MM/dd/yyyy hh:mm aa" timezone="America/New_York"/>
    </tstamp>        
    <exec executable="svnversion" outputproperty="svnversion"/>
    <exec executable="whoami" outputproperty="whoami"/>
    <exec executable="uname" outputproperty="buildsystem"><arg value="-a"/></exec>

    <propertyfile file="path/to/project.properties"
        comment="This file is automatically generated - DO NOT EDIT">        
        <entry key="buildtime" value="${builtat}"/>
        <entry key="build" value="${svnversion}"/>
        <entry key="builder" value="${whoami}"/>
        <entry key="version" value="${version}"/>
        <entry key="system" value="${buildsystem}"/>
    </propertyfile>
</target> 
```

扩展它以包含您可能想要添加的任何信息很简单。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2010-01-11T04:56:26.020

你的*build.xml*

```
...
<property name="version" value="1.0"/>
...
<target name="jar" depends="compile">
    <buildnumber file="build.num"/>
    <manifest file="MANIFEST.MF">
        ...
        <attribute name="Main-Class" value="MyClass"/>
        <attribute name="Implementation-Version" value="${version}.${build.number}"/>
        ...
    </manifest>
</target>
... 
```

你的java代码

```
String ver = MyClass.class.getPackage().getImplementationVersion(); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-27T16:51:43.483

*   内部版本号应该与像[hudson](http://hudson-ci.org/)这样的持续集成服务器相关联。为不同的分支机构/团队/分布使用不同的工作。
*   为了在最终构建中保留版本号，我建议只使用[maven](http://maven.apache.org)构建系统。它将创建一个 .properties 文件，归档到最终的 .jar/.war/.whatever-ar 中`META-INF/maven/<project group>/<project id>/pom.properties`。.properties 文件将包含版本属性。
*   由于我推荐 maven，我会敦促您检查[发布插件](http://maven.apache.org/plugins/maven-release-plugin/index.html)以准备源存储库上的发布并保持版本同步。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-27T18:06:19.497

软件：

*   SVN
*   蚂蚁
*   Hudson，用于持续集成
*   svntask，一个用于查找 SVN 版本的 Ant 任务：http://code.google.com/p/svntask/

Hudson 有三个构建/作业：Continuous、Nightly 和 Release。

对于连续/夜间构建：内部版本号是 SVN 修订版，使用 svntask 找到。

对于发布版本/作业：版本号是 Ant 从属性文件中读取的版本号。属性文件也可以与版本一起分发，以便在运行时显示内部版本号。

Ant 构建脚本将构建号放在构建期间创建的 jar/war 文件的清单文件中。适用于所有构建。

发布构建的构建后操作，使用 Hudson 插件轻松完成：使用构建号标记 SVN。

好处：

*   对于jar/war 的dev 版本，开发者可以从jar/war 中找到SVN 的版本，并在SVN 中查找对应的代码
*   对于一个版本，SVN 版本是对应于其中包含版本号的 SVN 标记的版本。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-30T18:29:07.560

我也在使用 Hudson，虽然场景更简单：

我的 Ant 脚本中有一个目标，如下所示：

```
<target name="build-number">
    <property environment="env" />
    <echo append="false" file="${build.dir}/build-number.txt">Build: ${env.BUILD_TAG}, Id: ${env.BUILD_ID}, URL: ${env.HUDSON_URL}</echo>
</target> 
```

每当我的工作运行时，Hudson 都会为我设置这些环境变量。

就我而言，这个项目是一个 webapp，我将这个`build-number.txt`文件包含在 webapp 的根文件夹中 - 我真的不在乎谁看到它。

完成后我们不会标记源代码控制，因为我们已经设置了 Hudson 作业，以便在构建成功时使用构建号/时间戳对其进行标记。

我的解决方案仅涵盖用于开发的增量构建编号，我们在涵盖发布编号的项目中还远远不够。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-22T23:33:43.467

您可能还想在[http://code.google.com/p/codebistro/wiki/BuildNumber](http://code.google.com/p/codebistro/wiki/BuildNumber)的一个 jar 中查看 BuildNumber Maven 插件和 Ant 任务。我试图让它简单明了。这是一个非常小的 jar 文件，仅依赖于安装的命令行 Subversion。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-11-19T20:09:17.970

这就是我解决这个问题的方法：

*   源代码被复制到构建目录
*   然后应用anttask“versioninfo”
*   编译修改后的源

这是存储版本信息的 java 文件：

```
public class Settings {

    public static final String VERSION = "$VERSION$";
    public static final String DATE = "$DATE$";

} 
```

这是 anttask “versioninfo”：

```
 <!-- ================================= 
     target: versioninfo              
     ================================= -->
    <target name="versioninfo"
            depends="init"
            description="gets version info from svn"
    >

        <!-- 
        get svn info from the src folder 
        -->
        <typedef resource="org/tigris/subversion/svnant/svnantlib.xml"
                 classpathref="ant.classpath"
        />
        <svnSetting id="svn.setting"
                    javahl="false"
                    svnkit="true"
                    dateformatter="dd.MM.yyyy"
        />
        <svn refid="svn.setting">
            <info target="src" />
        </svn>

        <!-- 
        if repository is a taged version use "v <tagname>"
        else "rev <revisionnumber> (SVN)" as versionnumber
         -->
        <taskdef resource="net/sf/antcontrib/antcontrib.properties"
                 classpathref="ant.classpath"
        />
        <propertyregex property="version"
                       input="${svn.info.url}"
                       regexp=".*/tags/(.*)/${ant.project.name}/src"
                       select="v \1"
                       defaultvalue="rev ${svn.info.lastRev} (SVN)"
                       override="true"
        />

        <!-- 
        replace date and version in the versionfile ()
         -->
        <replace file="build/${versionfile}">
            <replacefilter token="$DATE$" value="${svn.info.lastDate}" />
            <replacefilter token="$VERSION$" value="${version}" />
        </replace>

    </target> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-27T16:27:58.283

这是我的 2 美分：

*   每次构建应用程序时，我的构建脚本都会创建一个构建号（带有时间戳！）。这会产生太多的数字，但不会太少。如果我对代码进行了更改，则内部版本号将至少更改一次。

*   我对每个版本的内部版本号进行版本化（尽管不是介于两者之间）。当我更新项目并获得新的内部版本号（因为其他人发布了版本）时，我会覆盖我的本地版本并重新开始。这可能会导致较低的内部版本号，这就是我包含时间戳的原因。

*   当发布发生时，内部版本号将作为单个提交中的最后一项提交，并带有消息“build 1547”。之后，当它正式发布时，整棵树都会被标记。这样，构建文件始终包含所有标签，并且标签和构建号之间存在简单的 1:1 映射。

[编辑] 我在我的项目中部署了一个 version.html，然后，我可以使用刮板来简单地收集安装在哪里的准确地图。如果您使用的是 Tomcat 或类似工具，请将内部版本号和时间戳放在[web.xml](http://e-docs.bea.com/wls/docs81/webapp/web_xml.html#1013555)`description`的元素中。请记住：当您可以让计算机为您完成任何事情时，永远不要记住任何事情。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-27T16:25:18.210

我们通过 CruiseControl 运行我们的构建（在此处插入您最喜欢的构建管理器），并执行主要构建和测试。

然后，我们使用 Ant 和[BuildNumber](http://ant.apache.org/manual/Tasks/buildnumber.html)增加版本号，并使用此信息以及构建日期和其他元数据创建一个属性文件。

我们有一个专门用于阅读此内容并将其提供给 GUI/日志等的课程。

然后，我们将所有这些打包并构建一个可部署的，将内部版本号和相应的内部版本联系在一起。我们所有的服务器在启动时都会转储此元信息。我们可以返回 CruiseControl 日志并将内部版本号与日期和签入联系起来。

# asp.net - 将悬停图像 (CSS) 添加到 DataPager 中的 ASP.NET 链接按钮

> ID：690420
> 
> 赞同：0
> 
> 时间：2009-03-27T16:18:59.957
> 
> 标签：asp.net

我使用以下方法将悬停图像添加到 .Net LinkBut​​tons：

```
.rollover a 
{
  background-image:url(/images/shoppingcart/butpill_continue.gif);
}

.rollover a:hover 
{
  background-image:url(/images/shoppingcart/butpill_continue_over.gif);
}

<div class="rollover">
<asp:LinkButton ID="btnContinue" runat="server"></asp:LinkButton>
</div> 
```

这适用于常规链接按钮。

我需要将此添加到 DataPager 中的下一个/上一个按钮中。我尝试将 ButtonType 设置为“Link”并应用 ButtonCssClass="rollover" 但这不起作用。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T16:20:55.227

尝试将您的 CSS 更改为

```
a.rollover { background-image:url(/images/shoppingcart/butpill_continue.gif); }

a.rollover:hover { background-image:url(/images/shoppingcart/butpill_continue_over.gif); } 
```

要不就

```
.rollover { background-image:url(/images/shoppingcart/butpill_continue.gif); }

.rollover:hover { background-image:url(/images/shoppingcart/butpill_continue_over.gif); } 
```

您还必须将其他图像更改为这样的图像

```
<asp:LinkButton ID="btnContinue" runat="server" CssClass="rollover" /> 
```

# email - 在 Outlook 中收到电子邮件时的 ATTnnnnn.txt 附件

> ID：690430
> 
> 赞同：7
> 
> 时间：2009-03-27T16:21:29.483
> 
> 标签：email, outlook, smtp, mime

我编写了一个发送带有附件的电子邮件的 SMTP 客户端。一切都很好，除了当 Outlook 接收到我的程序发送的电子邮件时，它会显示两个附件 - 实际发送的文件和一个包含两个字符 CR 和 LF 的文件，该文件的名称为 ATT?????.txt。

我已经完成了搜索 - 找到了很多类似问题的匹配项[，](https://stackoverflow.com/questions/92196/why-does-my-d2009-exe-produce-emails-with-attachments-named-attnnnnn-dat)并检查了我能做的一切。甚至更多 - 我比较了两封电子邮件 - 由我的程序发送和由 Opera 发送，我无法推断出差异。但是 Opera 发送的内容被正确解释，但我的程序发送的内容却不是。我的程序发送的内容由一组其他邮件客户端正确解释，但不是由 Outlook。

我已经远程登录到 SMTP 服务器，将两封电子邮件检索到一个文本文件中——一封来自我的程序，另一封来自 Opera，然后并排比较它们。我没有看到任何可能影响电子邮件客户端解释的差异。

这是一个示例消息（地址被替换，文件内容被裁剪，空白行与真实消息中的完全一样，行数从不超过 80 个字符）：

```
收件人：user1@host.com、user2@host.com
主题：主题
内容类型：多部分/混合；边界="------------边界"
MIME 版本：1.0

-  -  -  -  -  -  - 边界
内容类型：文本/纯文本；字符集="utf-8"
内容传输编码：base64

这里是 Base64 编码的文本部分 - 它可能是本地化的，所以
最好是 UTF8 并做 Base64

-  -  -  -  -  -  - 边界
内容处置：附件；文件名="文件.jpg"
内容类型：应用程序/八位字节流；名称="文件.jpg"
内容传输编码：base64

这是 Base64 编码的文件数据

-  -  -  -  -  -  - 边界

```

我尝试在最后一个边界之后使用换行符 - 尝试无，一，二，三，但这并没有改善情况。

邮件客户端是否必须遵循一些奇怪的限制才能生成 Outlook 正确解释的邮件？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T17:36:26.653

MIME 部分的最后一个边界必须通过附加两个破折号来表示：

```
MIME 版本：1.0
内容类型：多部分/混合；边界="------------边界"

-  -  -  -  -  -  - 边界
...

-  -  -  -  -  -  - 边界
...

-  -  -  -  -  -  - 边界 - 

```

更多阅读：[RFC1341 / 7.2 The Multipart Content-Type](http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html)

# logging - 发生错误时如何配置 log4j 转储调试信息？

> ID：690431
> 
> 赞同：2
> 
> 时间：2009-03-27T16:21:41.217
> 
> 标签：logging, log4j

我有一个使用 log4j RollingFileAppender 将日志信息转储到文件中的 Web 应用程序。该应用程序当前配置为仅转储 WARN 和更高的日志信息，以便磁盘 I/O 不会影响服务器的性能。

但是，我想知道发生错误时的最后一次X调试信息。有没有办法配置 log4j 将最后 25 行调试信息以及错误信息转储到文件中？

我认为这可以使用自定义附加程序来完成。我尝试搜索示例但找不到。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T16:54:07.923

我认为自己编写是要走的路。您可以实现[Appender](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Appender.html)并将对它的每个调用委托给底层 RollingFileAppender 吗？

在您的实现中，只需存储最新的“n”条日志消息，并写入滚动文件附加程序。如果遇到错误消息，则将存储的调试消息转储到滚动文件附加程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T00:08:02.640

是的，我知道的唯一方法是编写自己的`Appender`. 扩展`RollingFileAppender`或编写`Appender`委托给`RollingFileAppender`. 在您的 new`Appender`中，保留最后 N 个日志记录事件的历史记录，当某些内容以 ERROR 级别记录时，转储您的日志记录事件历史记录。我自己开始实现这样的东西，但从未完成过。

# msbuild - 如何解决：自定义 MSBuild 任务需要在 AppBase 之外进行组装

> ID：690432
> 
> 赞同：6
> 
> 时间：2009-03-27T16:21:41.480
> 
> 标签：msbuild, task, assembly-resolution, fusion

我有一个自定义任务，我想在构建我的 C# 项目时执行。此任务位于 MyTask.dll 中，它引用另一个程序集 MyCommon.DLL。

问题是 MyCommon.dll 相对于 MyTask.dll 位于“..\Common\MyCommon.dll”，这将其置于 MSBuild 进程的 AppBase 目录之外。通过分析 MSBuild 的日志并查看 Fusion 关于绑定失败的报告，我已经确认这确实是问题所在。

如何让 Fusion 在构建过程中找到 MyCommon.dll？请注意，移动程序集会破坏我的应用程序，这也取决于它。

**更新：好吧，看来我还是会使用副本。其他解决方案都需要在系统范围内进行修改，这在这里并不真正保证。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T16:23:59.073

所以改为复制它？只是一个想法。在那里有一个副本，以支持您在完成后删除的构建。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T16:52:13.700

我看到了多种解决方案：

**第一：**在 GAC 中添加程序集（您的程序集必须具有强名称）

```
gacutil /I <assembly name> 
```

**第二：**通过代码库[或探测](http://msdn.microsoft.com/en-us/library/15hyw9x3.aspx)，在您的[machine.config](http://msdn.microsoft.com/en-us/library/ms229697(VS.71).aspx)文件中或在`msbuild.exe.config`.

```
<configuration>
   <runtime>
      <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
         <dependentAssembly>
            <assemblyIdentity name="MyCommon"
                              publicKeyToken="32ab4ba45e0a69a1"
                              culture="neutral" />
            <codeBase version="2.0.0.0"
                      href="file://C:/yourpath/MyCommon.DLL"/>
         </dependentAssembly>
      </assemblyBinding>
   </runtime>
</configuration> 
```

**第三：**复制之前在同一目录中的程序集并在之后删除它，就像大卫 M 说的那样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-20T20:54:45.813

所有这些“解决方案”都会产生更多的依赖关系，从而使环境复杂化。应该有一种更简单的方法来在运行时更新探测路径..

具体来说，MSBuild 应该允许您在 .proj 文件中添加探测路径，或指定依赖的 dll

您可以定义自定义 UsingTask：

`<UsingTask TaskName="Task" AssemblyFile="Assembly.dll" />`

但你不能添加依赖项？它应该被包括在内......这里有类似的东西

```
<UsingTask TaskName="Task" AssemblyFile="Assembly.dll">
<DependantAssembly AssemblyFile="dependant.dll"/>
</UsingTask> 
```

但是，不，这不受支持...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-11T05:47:23.907

一种选择是使用[ILMerge](http://www.microsoft.com/en-us/download/details.aspx?id=17630)将依赖项合并到任务程序集中。

# iphone - iPhone UITextView 相对位置

> ID：690435
> 
> 赞同：0
> 
> 时间：2009-03-27T16:22:28.483
> 
> 标签：iphone, layout, position, uitextview

我在我的应用程序中有一个新闻页面（视图），它有新闻的图像和文本。文本在 UITextView 中，我希望我的文本从图像旁边开始，当图像结束时从图像的下方继续，就像文本围绕图像一样。我尝试了 autoResizingMask，但据我所知，这是针对子视图和父视图之间的关系，所以它不起作用。有什么办法吗？

提前感谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T16:25:53.407

AFAIK，`UITextView`不支持环绕其他视图。你可以：

1.  将文本拆分成`UITextView`两个
2.  用一个`UIWebView`
3.  `NSString`使用's`drawInRect`或`drawAtPoint`方法进行自己的绘图。

# visual-studio-2008 - 有没有办法在两个 Visual Studio 2008 实例之间拖放复制文件？

> ID：690436
> 
> 赞同：35
> 
> 时间：2009-03-27T16:22:37.330
> 
> 标签：visual-studio-2008

有没有办法在两个 Visual Studio 2008 实例之间复制文件？插件、设置或其他东西？目前，将文件从一个实例拖到另一个实例没有任何作用（鼠标显示它是无效操作）。

右键单击文件并从实例 1 中选择“复制”，然后粘贴到实例 2 中会导致以下错误：

> 在此解决方案中找不到此操作的源文件。

任何想法或解决方案？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-27T16:24:35.700

关于您可以做到这一点的唯一方法是右键单击，添加现有项目并浏览文件。荒谬，我知道，但事实就是这样；）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2017-05-15T08:28:00.477

让我[在资源管理器中打开](https://marketplace.visualstudio.com/items?itemName=tux.OpenInExplorer)Visual Studio 扩展，它提供了一个上下文菜单选项“复制文件”。这样您就不必浏览 Windows 资源管理器窗口。

[![复制文件](https://i.stack.imgur.com/ct7aQ.png)](https://i.stack.imgur.com/ct7aQ.png)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-07-01T13:41:59.180

非常令人沮丧，我知道。

问题是，如果你直接将它复制到文件系统中，它可能不会包含在 TSF 中。我的建议是：

1.  从文件系统复制或拖动文件（即 Windows 资源管理器）
2.  在 Visual Studio 解决方案资源管理器中粘贴或拖放它们

为我工作:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T16:27:28.143

没有直接的方法。一种方法是右键单击解决方案资源管理器中的文件夹，在资源管理器中打开文件夹，然后从那里拖到 Visual Studio 的另一个实例中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-09-18T17:06:40.760

只需将您的源*项目*添加到您的目标*解决方案中*。这将允许您在 Visual Studio 的两个实例之间复制/粘贴。这是因为 Visual Studio 的复制文件的剪贴板数据必须具有与项目标识符相关的表示。

此外，将源项目添加到目标解决方案后，您甚至不需要在实例之间进行复制，因为您的源项目与您要复制到的解决方案相同。您甚至可以 CTRL+拖动文件来复制它们，这样您就不会丢失剪贴板中的文本。完成后，您可以删除该项目。这比打开多个资源管理器窗口、复制文件、在解决方案资源管理器中单击“显示所有文件”以及手动添加新文件要简单得多。

当您的源项目不在您的目标解决方案中并且您尝试在实例之间复制文件时，您将收到类似这样的错误。

[![在此解决方案中找不到此操作的源文件。](https://i.stack.imgur.com/tiKdT.png)](https://i.stack.imgur.com/tiKdT.png)

如果您的源项目（在一个实例中）也在 Visual Studio 的目标解决方案（在另一个实例中）中，则不会发生这种情况。一旦你明白发生了什么，你就会做一个手掌，因为错误实际上是在告诉你问题是什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-20T08:45:24.193

转到文件资源管理器，然后您要将哪些文件放入项目中，只需选择它们即可。现在复制这些文件并将它们粘贴到项目中。您还可以将带有子文件夹和文件的文件夹粘贴到项目中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-12-17T20:40:55.737

我发现的最简单的内置方式（对于 VS2019）是：

1.  右键单击源文件
2.  选择*复制完整路径*
3.  切换到目标解决方案/项目
4.  右键单击目标文件夹
5.  选择*添加 -> 现有项目*
6.  粘贴
7.  点击确定

这会将文件从源复制到目标。（留下原件）。

我更喜欢这个，因为它避免了任何繁琐的文件夹浏览。

# c# - LinqPad 功能 - VS 会这样做吗？

> ID：690451
> 
> 赞同：3
> 
> 时间：2009-03-27T16:25:46.650
> 
> 标签：c#, visual-studio, visual-studio-2008, linq, linqpad

Linqpad，在 C# 中编码时，将在大括号之间画一条垂直线。

天哪，天哪，我当然希望 Visual Studio 能做到这一点。可以？有没有让它做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T16:29:19.870

[C# 的 CodeRush Xpress](http://msdn.microsoft.com/en-us/vcsharp/dd218053.aspx)可以做到这一点，微软免费提供。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T16:28:55.270

获取[CodeRush 工具](http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)- 它们可以满足您的需求，甚至更多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:49:23.267

CodeRush 是事实……

# .net - Asp.net“全局”变量

> ID：690452
> 
> 赞同：3
> 
> 时间：2009-03-27T16:25:49.457
> 
> 标签：.net, asp.net, postback, page-lifecycle

我正在 ASP.NET 中编写一个页面，并且在回发初始化周期之后遇到问题：

我有（类似于）以下内容：

```
public partial class MyClass : System.Web.UI.Page
{
    String myString = "default";

    protected void Page_Init(object o, EventArgs e)
    {
        myString = Request["passedString"];
        //note that I've tried to set the default here in Init on NULL...
    }

    protected void Page_Load(object o, EventArgs e)
    {
         if(!Postback)
         {
             //code that uses myString....
         }
         else
         {
            //more code that uses myString....
         }
    }
} 
```

发生的事情是我的代码很好地拾取了“passedString”，但由于某种原因，在回发时，它重置为默认值 - 即使我将默认值的分配放在 Page_Init 代码中......这让我想知道怎么回事。。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T16:34:25.553

一旦响应发送到浏览器，您的类成员变量就不会继续存在。尝试改用 Session 对象：

```
public partial class MyClass : System.Web.UI.Page
{    

    protected void Page_Init(object o, EventArgs e)
    {
        Session["myString"] = Request["passedString"];
        //note that I've tried to set the default here in Init on NULL...
    }

    protected void Page_Load(object o, EventArgs e)
    {
         string myString = (string) Session["myString"];

         if(!Postback)
         {
             // use myString retrieved from session here
         }
         else
         {
            //more code that uses myString....
         }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T16:29:41.103

我感觉到你的痛苦，马特。不久前我问了一个类似的问题：

要进一步了解页面生命周期，请查看以下问题：[ASP.NET WebForm 的“页面生命周期”是什么？](https://stackoverflow.com/questions/597042/what-is-the-page-lifecycle-of-an-asp-net-webform)

# iphone - 有没有比这更好的方法来隐藏 backBarButtonItem？

> ID：690456
> 
> 赞同：9
> 
> 时间：2009-03-27T16:27:39.547
> 
> 标签：iphone, uinavigationbar

我有一种隐藏导航控制器使用的后退按钮的方法。它是由前一个控制器设置的，而不是管理当前视图的控制器，这使得访问变得很棘手。我需要在编辑模式下执行此操作，以防止用户离开屏幕。

```
if(self.editing) {
    // Get rid of the back button   
    UIView *emptyView = [[UIView alloc] init];;
    UIBarButtonItem *emptyButton = [[[UIBarButtonItem alloc] initWithCustomView:emptyView] autorelease];
    [self.navigationItem setLeftBarButtonItem:emptyButton animated:YES];
} else {
    // Restore the back button
    [self.navigationItem setLeftBarButtonItem:nil animated:YES];        
} 
```

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-03-27T16:39:57.333

用它来隐藏后退按钮

```
[self.navigationItem setHidesBackButton:YES] 
```

用它来显示后退按钮

```
[self.navigationItem setHidesBackButton:NO] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-23T15:11:45.073

这是我在视图控制器中使用的方法，用于在启用和禁用编辑时显示和隐藏后退按钮：

```
- (void)setEditing:(BOOL)editing animated:(BOOL)animated
{
    if (editing) {
        // Disable the back button
        [self.navigationItem setHidesBackButton:YES animated:YES];
    }
    else {
        // Enable the back button
        [self.navigationItem setHidesBackButton:NO animated:YES];
    }

    [super setEditing:editing animated:animated];
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-12-25T14:03:45.503

**斯威夫特5：**

```
self.navigationItem.setHidesBackButton(true, animated: false) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-14T08:24:06.970

从情节提要到您的视图控制器，使用强（默认不弱）的条形按钮创建一个出口。当您将左/右栏按钮设置为 nil 时，目的是不丢失参考。

# sql - 重新索引大表 - 我怎么搞砸了？

> ID：690458
> 
> 赞同：5
> 
> 时间：2009-03-27T16:27:53.680
> 
> 标签：sql, sql-server, sql-server-2005, database-design, indexed

我有一个 1 TB、600m 行的表，它错误地选择了索引列，特别是主键列上的聚集索引，它从未在选择查询中使用。

我想从这一行中删除聚集索引并在许多其他行上创建它。

表目前是这样的：

*   colA (PK, nvarchar(3)) [聚集索引 pt b]

*   colB (PK, bigint) [聚集索引 pt a]

*   colC (DateTime) [非聚集索引]

*   colD (Money) [非聚集索引]

*   colE（位）[无索引]

*   colF（位）[无索引]

*   colG (int) [无索引]

*   更多非索引列

我想把它改成这样：

*   colA (PK, nvarchar(3)) [聚集索引 pt a]

*   colB (PK, bigint) [非聚集索引]

*   colC (DateTime) [非聚集索引]

*   colD (Money) [聚集索引 pt d]

*   colE (bit) [聚集索引 pt b]

*   colF (bit) [聚集索引 pt c]

*   colG (int) [聚集索引 pt e]

*   更多非索引列

两个问题：1）您估计这种更改需要多长时间（消息末尾的服务器规范）。不幸的是，它是一个实时数据库，如果不知道它会停机多长时间，我就无法停机。

2) 将这么多列添加到聚集索引中是不是一个糟糕的主意？几乎从不执行更新。有许多插入和许多选择总是使用所有建议的索引行作为选择参数。

服务器规格：RAID 5 中的 5 个 15kRPM 驱动器，MS-SQL Sever 2005 和一些保持它们运行的​​位。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T16:38:28.663

一方面，我会避免使聚集索引比它绝对必须的更宽。把它分成五个部分似乎适得其反。这个复合聚集索引中的所有列是否稳定，例如从不改变？

如果没有，我会不惜一切代价避免它们。聚集索引应该是：

*   独特的
*   稳定的
*   尽可能窄

您可以更改非聚集索引 - 没问题。但要避免使聚集索引混乱！那肯定会降低你的表现！

查看 Kimberly Tripp 关于索引的优秀博客文章：

*   [主链接在这里](http://sqlskills.com/BLOGS/KIMBERLY/category/Indexes.aspx)
*   [此处聚集索引的最佳实践](http://sqlskills.com/BLOGS/KIMBERLY/post/The-Clustered-Index-Debate-Continues.aspx)

马克

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-05T00:32:58.157

我进行了更改，并没有花费太长时间。以下是每个操作的时间，第一次是在具有单个 7200RPM 驱动器的备份服务器上运行，第二次是在具有 15k RAID 驱动器的主服务器上运行。

```
ALTER TABLE Table DROP CONSTRAINT [PK_Table] 
```

2:39 小时 / 19 分钟

```
CREATE CLUSTERED INDEX [IX_Clustered] ON [Table] 
(
 [a] ASC,
 [b] ASC,
 [c] ASC,
 [d] ASC,
 [e] ASC,
 [f] ASC
)WITH (PAD_INDEX  = ON, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, IGNORE_DUP_KEY = OFF, FILLFACTOR = 90, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = OFF) ON [PRIMARY] 
```

15:30 / 2 小时

```
ALTER TABLE Table ADD CONSTRAINT
PK_hands PRIMARY KEY NONCLUSTERED 
(
 e,
 h
) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] 
```

4 小时 / 1 小时

最常用的选择查询现在需要 < 10 秒，而以前通常需要 10 到 15 分钟。不错的改进！插入时间似乎也快了一些。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T16:35:52.663

您应该有一个具有类似规格的开发环境，您可以使用它来尝试使用实时数据库的副本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T17:09:07.560

虽然更改聚集索引听起来肯定会有所帮助，但您为什么不先尝试添加（非聚集）覆盖索引呢？

在构建新索引时不应该关闭表，并且应该告诉您哪些性能改进（如果有）将导致这种重组。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T16:34:34.243

您可能无需担心停机时间，因为可以[实时进行更改](http://www.eggheadcafe.com/software/aspnet/32645981/how-to-change-a-live-clus.aspx)（无需*任何*停机时间）。适用于 SQL Server 2005 企业版。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T16:36:27.373

如果您有磁盘空间，您可以做的一件事是使用正确的聚集索引创建第二个表，通过增量过程在几天内将行复制到新表中。一旦所有行都存在，在两个表上执行 sp_rename （这将只需要几分钟的停机时间。如果您的应用程序引用的是视图而不是物理表，那么您可以在零停机时间的情况下完成此操作。我希望这会有所帮助.

[编辑]您还必须处理对行的更新，您需要在源表上有一个时间戳或最后更新的字段，以便在复制所有行后同步更新。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T16:41:23.947

**1）您估计此更改需要多长时间（消息末尾的服务器规范）。不幸的是，它是一个实时数据库，如果不知道它会停机多长时间，我就无法停机。**

这真的，*真的*取决于数据。仅表参数并不能提供足够的信息。可能是几分钟（不太可能）到几天（不太可能），最有可能的时间介于两者之间。

**2) 将这么多列添加到聚集索引中是不是一个糟糕的主意？几乎从不执行更新。有许多插入和许多选择总是使用所有建议的索引行作为选择参数。**

不，这不应该造成任何问题。只有在您进行少量更新时，性能才会有所提高。但是，当这些更新发生时，修复索引需要一段时间，并且在此期间性能会受到影响，具体取决于数据。

-亚当

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T17:31:42.030

我同意布赖恩的观点，您应该有一个具有相同数据量的测试数据库并运行索引更改。但是，我认为您正在进行此更改，因为您认为它会加快查询速度。您应该运行基准测试（在索引更改之前和之后）并确保您的优化不会变得悲观。

# c# - C# 微优化查询：IEnumerable 替换

> ID：690461
> 
> 赞同：0
> 
> 时间：2009-03-27T16:28:35.910
> 
> 标签：c#, optimization

注意：由于过去的经验和分析器软件的建议，我正在优化。我意识到另一种优化是减少调用`GetNeighbors`频率，但目前这是次要问题。

我有一个非常简单的功能，如下所述。一般来说，我在 foreach 循环中调用它。我经常调用这个函数（大约每秒 100,000 次）。不久前，我用 Java 编写了这个程序的一个变体，对它的速度感到非常厌恶，我最终用 4 个 if 语句替换了几个使用它的 for 循环。循环展开看起来很难看，但它确实对应用程序速度产生了显着影响。因此，我提出了一些潜在的优化，并认为我会就它们的优点征求意见并提出建议：

*   使用四个 if 语句，完全忽略 DRY 原则。我相信这将根据过去的经验提高性能，但这让我感到难过。澄清一下，这 4 个 if 语句将被粘贴到我过于频繁地调用 getNeighbors() 的任何地方，然后将 foreach 块的内部粘贴在其中。
*   以某种神秘的方式记忆结果。
*   将“邻居”属性添加到所有方块。在初始化时生成其内容。
*   作为编译的一部分，使用代码生成实用程序将对 GetNeighbors 的调用转换为 if 语句。

    ```
    public static IEnumerable<Square> GetNeighbors(Model m, Square s)
    {
        int x = s.X;
        int y = s.Y;        
        if (x > 0) yield return m[x - 1, y];
        if (y > 0) yield return m[x, y - 1];
        if (x < m.Width - 1) yield return m[x + 1, y];
        if (y < m.Height - 1) yield return m[x, y + 1];
        yield break;
    }

    //The property of Model used to get elements.
    private Square[,] grid;
    //...
    public Square this[int x, int y]
    {
        get
        {
            return grid[x, y];
        }
    } 
    ```

注意：GetNeighbors 函数花费 20% 的时间用于调用 m.get_Item，另外 80% 用于方法本身。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T16:57:26.263

布莱恩，

我在我的代码中遇到了类似的事情。

我在 C# 中发现对我帮助最大的两件事：

首先，不必害怕分配。C# 内存分配非常非常快，因此动态分配数组通常比创建枚举器更快。但是，这是否有帮助在很大程度上取决于您如何使用结果。我看到的唯一缺陷是，如果您返回一个固定大小的数组 (4)，您将不得不在使用您的结果的例程中检查边缘情况。

根据您的模型中 Squares 矩阵的大小，您最好预先进行 1 次检查以查看您是否处于边缘，如果不是，则预先计算整个数组并返回它。如果您处于优势地位，您可以单独处理这些特殊情况（根据需要制作一个 1 或 2 元素数组）。这将在那里放一个更大的声明，但根据我的经验，这通常更快。如果模型很大，我会避免预先计算所有的邻居。Squares 的开销可能超过收益。

根据我的经验，预分配和返回与使用 yield 相比，JIT 更有可能内联您的函数，这会在速度上产生很大差异。如果您可以利用 IEnumerable 结果并且您并不总是使用每个返回的元素，那就更好了，否则，预计算可能会更快。

要考虑的另一件事-在您的情况下，我不知道 Square 中保存了哪些信息，但是如果 hte 对象相对较小，并且在大型矩阵中使用并迭代了很多次，请考虑将其设为结构。我有一个类似的例程（在循环中调用数十万或数百万次），在我的例子中，将类更改为结构体，将例程加快了 40% 以上。不过，这是假设您使用的是 .net 3.5sp1，因为 JIT 在最新版本中对结构进行了更多优化。

当然，切换到结构与类还有其他潜在的陷阱，但它可能会对性能产生巨大影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T16:40:55.600

我建议制作一个 Squares 数组（容量为四个）并返回它。我会非常怀疑在性能敏感的上下文中使用迭代器。例如：

```
// could return IEnumerable<Square> still instead if you preferred.
public static Square[] GetNeighbors(Model m, Square s)
{
    int x = s.X, y = s.Y, i = 0;
    var result = new Square[4];

    if (x > 0) result[i++] = m[x - 1, y];
    if (y > 0) result[i++] = m[x, y - 1];
    if (x < m.Width  - 1) result[i++] = m[x + 1, y];
    if (y < m.Height - 1) result[i++] = m[x, y + 1];

    return result;
} 
```

如果这更快，我不会感到惊讶。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:42:15.627

我在一个滑坡上，所以在这里插入免责声明。

我会选择选项 3。懒洋洋地填写邻居引用，你就有了一种记忆。

另一种 memoization 是返回一个数组而不是惰性 IEnumerable，GetNeighbors 成为一个纯函数，对于 memoize 来说是微不足道的。不过，这大致相当于选项 3。

无论如何，但你知道这一点，分析并重新评估每一步。例如，我不确定惰性 IEnumerable 或直接返回结果数组之间的权衡。（您避免了一些间接但需要分配）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T17:26:29.563

为什么不让 Square 类负责返回它的邻居呢？然后你就有了一个很好的地方来做惰性初始化，而不需要额外的记忆开销。

```
public class Square {

    private Model _model;
    private int _x;
    private int _y;
    private Square[] _neightbours;

    public Square(Model model, int x, int y) {
        _model = model;
        _x = x;
        _y = y;
        _neightbours = null;
    }

    public Square[] Neighbours {
        get {
            if (_neightbours == null) {
                _neighbours = GetNeighbours();
            }
            return _neighbours;
        }
    }

    private Square[] GetNeightbours() {
        int len = 4;
        if (_x == 0) len--;
        if (_x == _model.Width - 1) len--;
        if (_y == 0) len--;
        if (-y == _model.Height -1) len--;
        Square [] result = new Square(len);
        int i = 0;
        if (_x > 0) {
            result[i++] = _model[_x - 1,_y];
        }
        if (_x < _model.Width - 1) {
            result[i++] = _model[_x + 1,_y];
        }
        if (_y > 0) {
            result[i++] = _model[_x,_y - 1];
        }
        if (_y < _model.Height - 1) {
            result[i++] = _model[_x,_y + 1];
        }
        return result;
    }

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T17:45:21.607

根据 GetNeighbors 的使用，也许一些控制反转可能会有所帮助：

```
public static void DoOnNeighbors(Model m, Square s, Action<s> action) {
  int x = s.X;
  int y = s.Y;        
  if (x > 0) action(m[x - 1, y]);
  if (y > 0) action(m[x, y - 1]);
  if (x < m.Width - 1) action(m[x + 1, y]);
  if (y < m.Height - 1) action(m[x, y + 1]);
} 
```

但我不确定这是否有更好的性能。

# linux - 在不同版本的 Linux 下以编程方式提升权限的最佳方法？

> ID：690463
> 
> 赞同：1
> 
> 时间：2009-03-27T16:28:40.467
> 
> 标签：linux, root

有一种标准方法（跨 Linux 发行版工作）来启动一个进程（从另一个应用程序），要求输入 root 密码以提升权限？

我尝试使用 gksudo（它默认安装在 ubuntu 中），但在其他发行版下（或在其他桌面管理器下）可能无法安装。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T18:05:46.863

我建议查看[PolicyKit](http://en.wikipedia.org/wiki/PolicyKit)，它是大多数现代发行版用来完成此任务的工具。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T16:34:42.603

这适用于任何地方，但不缓存密码并要求*root*而不是用户密码（就像`sudo`那样）：

```
su - -c command 
```

**编辑**：不在禁用*root帐户的 ubuntu 上。*可能你需要这样的东西：

```
test -x /usr/bin/sudo && sudo command || su - -c command 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:35:54.987

唯一的默认设置是文本模式[**su**](http://en.wikipedia.org/wiki/Su_(Unix))。大多数发行版还安装了[**sudo**](http://en.wikipedia.org/wiki/Sudo)。

现在，在基于 KDE 的发行版中，您将拥有**kdesu**，而在基于 GNOME 的发行版中，它将是**gksu**和**gksudo**。Kerberized 域中的机器具有**ksu**。

您可以尝试使用`/etc/sysconfig/desktop`来查看哪个是默认桌面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T18:20:56.217

传统上，如果您的应用程序需要允许用户提升权限，它会安装自己的单一用途[`setuid`](http://en.wikipedia.org/wiki/Setuid)可执行文件——单一用途意味着它执行所需的任务，而不是充当通用启动器。

```
$ su -
# cp `type -p id` /usr/local/bin/root-id
# chown root:users /usr/local/bin/root-id
# chmod 4750 /usr/local/bin/root-id
$ /usr/local/bin/root-id
... euid=0(root) ... 
```

OTOH setuid 可执行文件也是安全漏洞的常见来源，因此请务必小心。

# sql-server - 哪个性能更高，CTE 还是临时表？

> ID：690465
> 
> 赞同：157
> 
> 时间：2009-03-27T16:28:49.077
> 
> 标签：sql-server, performance, sql-server-2008, temp-tables, common-table-expression

哪个性能更高，`CTE`或者`Temporary Tables`？

* * *

## 回答 #1

> 赞同：230
> 
> 时间：2014-10-05T17:09:30.690

这取决于。

首先

**什么是公用表表达式？**

（非递归）CTE 的处理方式与其他可用作 SQL Server 中的内联表表达式的构造非常相似。派生表、视图和内联表值函数。请注意，虽然 BOL 说 CTE“可以被认为是临时结果集”，但这是一个纯粹的逻辑描述。通常情况下，它本身并没有具体化。

**什么是临时表？**

这是存储在 tempdb 数据页上的行集合。数据页可以部分或全部驻留在内存中。此外，临时表可能会被索引并具有列统计信息。

**测试数据**

```
CREATE TABLE T(A INT IDENTITY PRIMARY KEY, B INT , F CHAR(8000) NULL);

INSERT INTO T(B)
SELECT TOP (1000000)  0 + CAST(NEWID() AS BINARY(4))
FROM master..spt_values v1,
     master..spt_values v2; 
```

**示例 1**

```
WITH CTE1 AS
(
SELECT A,
       ABS(B) AS Abs_B,
       F
FROM T
)
SELECT *
FROM CTE1
WHERE A = 780 
```

![计划一](https://i.stack.imgur.com/fmGvO.png)

注意在上面的计划中没有提到 CTE1。它只是直接访问基表并被视为相同

```
SELECT A,
       ABS(B) AS Abs_B,
       F
FROM   T
WHERE  A = 780 
```

通过在此处将 CTE 实现为中间临时表进行重写将大大适得其反。

将 CTE 定义具体化

```
SELECT A,
       ABS(B) AS Abs_B,
       F
FROM T 
```

将涉及将大约 8GB 的​​数据复制到临时表中，然后仍然存在从中进行选择的开销。

**示例 2**

```
WITH CTE2
     AS (SELECT *,
                ROW_NUMBER() OVER (ORDER BY A) AS RN
         FROM   T
         WHERE  B % 100000 = 0)
SELECT *
FROM   CTE2 T1
       CROSS APPLY (SELECT TOP (1) *
                    FROM   CTE2 T2
                    WHERE  T2.A > T1.A
                    ORDER  BY T2.A) CA 
```

上面的例子在我的机器上大约需要 4 分钟。

1,000,000 个随机生成的值中只有 15 行与谓词匹配，但代价高昂的表扫描发生 16 次以定位这些值。

![在此处输入图像描述](https://i.stack.imgur.com/AJp2Y.png)

这将是实现中间结果的一个很好的候选。等效的临时表重写需要 25 秒。

```
INSERT INTO #T
SELECT *,
       ROW_NUMBER() OVER (ORDER BY A) AS RN
FROM   T
WHERE  B % 100000 = 0

SELECT *
FROM   #T T1
       CROSS APPLY (SELECT TOP (1) *
                    FROM   #T T2
                    WHERE  T2.A > T1.A
                    ORDER  BY T2.A) CA 
```

![有计划](https://i.stack.imgur.com/QiOEU.png)

将查询的一部分中间物化到临时表中有时会很有用，即使它只被评估一次 - 当它允许利用物化结果的统计信息重新编译查询的其余部分时。[SQL Cat 文章When To Break Down Complex Queries](https://techcommunity.microsoft.com/t5/datacat/when-to-break-down-complex-queries/ba-p/305154)中提供了这种方法的一个示例。

在某些情况下，SQL Server 将使用假脱机来缓存中间结果，例如 CTE，并避免重新评估该子树。这在（迁移的）连接项中进行了讨论，[提供提示以强制 CTE 或派生表的中间实现](https://feedback.azure.com/forums/908035-sql-server/suggestions/32891374-provide-a-hint-to-force-intermediate-materializati)。但是，没有对此创建统计信息，即使假脱机行的数量与估计的有很大不同，正在进行的执行计划也无法动态适应响应（至少在当前版本中。自适应查询计划可能在未来）。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-03-30T19:10:54.997

我会说它们是不同的概念，但说“粉笔和奶酪”并没有太大的不同。

*   临时表非常适合重复使用或对一组数据执行多次处理。

*   CTE 可用于递归或简单地提高可读性。
    并且，像视图或内联表值函数也可以像宏一样在主查询中进行扩展

*   临时表是另一个表，其中包含一些关于范围的规则

我已经存储了我同时使用的过程（以及表变量）

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2010-04-30T01:28:30.520

CTE 有它的用途——当 CTE 中的数据很小并且可读性得到很大改进时，就像递归表中的情况一样。但是，它的性能肯定不比表变量好，当处理非常大的表时，临时表的性能明显优于 CTE。这是因为您无法在 CTE 上定义索引，并且当您有大量数据需要与另一个表连接时（CTE 就像一个宏）。如果您要连接多个表，每个表都有数百万行记录，CTE 的性能将比临时表差得多。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2009-03-27T17:22:11.710

临时表总是在磁盘上——所以只要你的 CTE 可以保存在内存中，它很可能会更快（也像一个表变量）。

但是话又说回来，如果您的 CTE（或临时表变量）的数据负载太大，它也会存储在磁盘上，因此没有太大的好处。

一般来说，我更喜欢 CTE 而不是临时表，因为它在我使用后就消失了。我不需要考虑明确放弃它或任何东西。

所以，最终没有明确的答案，但就个人而言，我更喜欢 CTE 而不是临时表。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2016-09-14T18:59:58.910

所以我被分配优化的查询是用 SQL server 中的两个 CTE 编写的。花了28秒。

我花了两分钟将它们转换为临时表，查询花了 3 秒

我在它正在加入的字段上的临时表中添加了一个索引，并将其缩短到 2 秒

三分钟的工作，现在通过删除 CTE，它的运行速度提高了 12 倍。我个人不会使用 CTE，因为它们也更难调试。

疯狂的是，CTE 都只使用了一次，并且仍然在它们上放置一个索引，事实证明速度快了 50%。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-09-01T14:21:02.987

我都使用过，但是在大量复杂的过程中，我总是发现临时表更易于使用且更有条理。CTE 有其用途，但通常用于小数据。

例如，我创建了在 15 秒内返回大型计算结果的存储过程，但将此代码转换为在 CTE 中运行，并且已经看到它运行超过 8 分钟才能达到相同的结果。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-05-30T13:16:45.530

CTE 不会占用任何物理空间。它只是一个我们可以使用 join 的结果集。

临时表是临时的。我们可以像普通表一样创建索引和约束，为此我们需要定义所有变量。

临时表的范围仅在会话内。EX：打开两个SQL查询窗口

```
create table #temp(empid int,empname varchar)
insert into #temp 
select 101,'xxx'

select * from #temp 
```

在第一个窗口中运行此查询，然后在第二个窗口中运行以下查询，您可以找到不同之处。

```
select * from #temp 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-05-18T15:26:33.593

派对迟到了，但是...

我工作的环境受到高度限制，支持一些供应商产品并提供报告等“增值”服务。由于政策和合同的限制，我通常不允许拥有单独的表/数据空间和/或创建永久代码的能力[它会变得更好，取决于应用程序]。

IOW，我通常*不能*开发存储过程或 UDF 或临时表等。我几乎必须通过我的应用程序界面来完成所有事情（Crystal Reports - 添加/链接表，从 w/in CR 中设置 where 子句等。 ）。一个小小的优点是 Crystal 允许我使用命令（以及 SQL 表达式）。一些通过常规添加/链接表功能效率不高的事情可以通过定义 SQL 命令来完成。我通过它使用 CTE，并“远程”获得了非常好的结果。CTE 还有助于报告维护，不需要开发代码、交给 DBA 编译、加密、传输、安装，然后需要多级测试。我可以通过本地界面进行 CTE。

使用带 CR 的 CTE 的缺点是，每个报告都是独立的。必须为每个报告维护每个 CTE。在我可以做 SP 和 UDF 的地方，我可以开发一些可以被多个报告使用的东西，只需要链接到 SP 并传递参数，就好像你在处理一个普通的表一样。CR 并不擅长将参数处理为 SQL 命令，因此可能缺少 CR/CTE 方面的这方面。在这些情况下，我通常会尝试定义 CTE 以返回足够的数据（但不是所有数据），然后使用 CR 中的记录选择功能对其进行切片和切块。

所以......我的投票是 CTE（直到我得到我的数据空间）。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-09-06T00:32:59.173

我发现 CTE 的出色性能的一个用途是我需要将一个相对复杂的查询加入到几个表中，每个表都有几百万行。

我使用 CTE 首先选择基于索引列的子集，首先将这些表减少到每个相关的几千行，然后将 CTE 加入到我的主查询中。这成倍地减少了我的查询的运行时间。

虽然 CTE 的结果没有被缓存，并且表变量可能是一个更好的选择，但我真的只是想尝试一下，发现它们适合上述场景。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-06-09T21:39:34.903

我刚刚对此进行了测试——CTE 和非 CTE（为每个联合实例输入查询）都花费了大约 31 秒。CTE 使代码更具可读性——将其从 241 行减少到 130 行，这非常好。另一方面，临时表将其减少到 132 行，并用了五秒钟来运行。不是开玩笑。所有这些测试都被缓存了——查询之前都运行了多次。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-27T16:32:09.193

这是一个非常开放的问题，这完全取决于它的使用方式和临时表的类型（表变量或传统表）。

传统的临时表将数据存储在临时数据库中，这会降低临时表的速度；但是表变量没有。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-09-07T10:08:41.217

根据我在 SQL Server 中的经验，我发现了 CTE 优于 Temp 表的场景之一

我需要在我的存储过程中使用一次来自复杂查询的 DataSet(~100000)。

*   临时表在我的过程执行缓慢的情况下导致 SQL 开销（因为临时表是存在于 tempdb 中的真实物化表，并且在我当前过程的生命周期内持续存在）

*   另一方面，对于 CTE，CTE 仅持续到运行以下查询。因此，CTE 是一种方便的内存结构，作用域有限。CTE 默认不使用 tempdb。

在这种情况下，CTE 可以真正帮助您简化代码并超越临时表。我用过 2 个 CTE，比如

```
WITH CTE1(ID, Name, Display) 
AS (SELECT ID,Name,Display from Table1 where <Some Condition>),
CTE2(ID,Name,<col3>) AS (SELECT ID, Name,<> FROM CTE1 INNER JOIN Table2 <Some Condition>)
SELECT CTE2.ID,CTE2.<col3>
FROM CTE2
GO 
```

# c# - 代码隐藏生成的 DataTemplate 中的 EventBinding

> ID：690466
> 
> 赞同：0
> 
> 时间：2009-03-27T16:28:54.240
> 
> 标签：c#, .net, silverlight-2.0, datatemplate, xmlwriter

让我们从场景开始：

我在 UserControl 中有一个 ItemsControl。在这个 ItemsControl 中，我有一个动态创建的 DataTemplate，它是在代码隐藏中创建和添加的。由于似乎没有在代码隐藏中创建 DataTemplate 的好方法，因此我必须以编程方式将 DataTemplate 的 xaml 代码生成为字符串，然后通过 XamlReader 从中创建 DataTemplate 对象：

```
StringBuilder stringBuilder = new StringBuilder();
XmlWriter xmlWriter = XmlWriter.Create(stringBuilder);

... // use xmlWrite to generate desired xaml

// substring is use to cut out the xml declaration
DataTemplate template = (DataTemplate)XamlReader.Load(stringBuilder.ToString().Substring(39));
myItemsControl.ItemTemplate    = template; 
```

生成的 XAML 代码如下所示并且实际使用（项目按预期呈现）：

```
<DataTemplate xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation">
<Grid HorizontalAlignment="Stretch" Margin="0,0,0,0">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="100" />
        <ColumnDefinition Width="100" />
        <ColumnDefinition Width="100" />
    </Grid.ColumnDefinitions>

    <TextBlock Text="{Binding b0}" Grid.Column="0" />
    <TextBox Text="{Binding b1, Converter={StaticResource customConverter}}" HorizontalAlignment="Stretch" Grid.Column="1" LostFocus="TxtAttribute_LostFocus" />
    <TextBox Text="{Binding b2, Converter={StaticResource customConverter}}" HorizontalAlignment="Stretch" Grid.Column="2" LostFocus="TxtAttribute_LostFocus" />
    <TextBox Text="{Binding b3, Converter={StaticResource customConverter}}" HorizontalAlignment="Stretch" Grid.Column="3" LostFocus="TxtAttribute_LostFocus" IsReadOnly="True" />
</Grid> 
```

如果您想知道：XamlReader 需要 xmlns 属性来呈现控件，否则在访问代码时会出现异常。

我的问题：

现在，虽然项目看起来像预期的那样并且数据被正确绑定，但我的 customConverter 应该重新格式化绑定的数据，也没有正确应用 LostFocus 事件。我没有收到任何错误消息或警告，转换器和事件只是没有被调用。任何人都知道为什么以及如何让它发挥作用？

更新：

我到了必须解决这个问题或尝试不同方法的地步。在我上次的测试中，我尝试直接在 DataTemplate 中添加转换器，但我没有运气。生成的代码现在如下所示：

```
<DataTemplate xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:Conv="clr-namespace:my.Namespace" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation">
    <Grid HorizontalAlignment="Stretch" Margin="0,0,0,0">   
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="80" />
            <ColumnDefinition Width="80" />
            <ColumnDefinition Width="80" />
        </Grid.ColumnDefinitions>

        <Grid.Resources>
            <Conv:DecimalConverter x:Name="cnvDecimalConverter" />
        </Grid.Resources>

        <TextBlock Text="{Binding b0}" Grid.Column="0" />
        <TextBox Text="{Binding b1, Converter={StaticResource cnvItemsDecimalConverter}}" HorizontalAlignment="Stretch" Grid.Column="1" LostFocus="TxtAttribute_LostFocus" />
        <TextBox Text="{Binding b2, Converter={StaticResource cnvItemsDecimalConverter}}" HorizontalAlignment="Stretch" Grid.Column="2" LostFocus="TxtAttribute_LostFocus" />
        <TextBox Text="{Binding b3, Converter={StaticResource cnvItemsDecimalConverter}}" HorizontalAlignment="Stretch" Grid.Column="3" LostFocus="TxtAttribute_LostFocus" IsReadOnly="True" />
    </Grid>
</DataTemplate> 
```

有任何想法吗？

更新 2：

正如我刚刚发现 XamlReader.Load() 只是无法连接事件。在 Silverlight 论坛中查看[此主题](http://silverlight.net/forums/t/17513.aspx)

转换器应该可以工作，我想我仍然有某种我没有看到的命名空间问题。我对我的“简单” ItemsControl 方法有点选择，所以我认为是时候寻找另一种方法来满足我的需求了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T09:49:11.673

只是为了澄清情况：不可能通过生成 xaml 字符串来生成带有事件的动态 DataTemplates 并从中提取控件。使用事件解析 xaml 代码的唯一选择是通过 Application.LoadComponent ，它需要一个 URI 才能工作。

我最终使用嵌套的 ItemControls 来创建我的“动态”行为。

# vb.net - 将数据集导出到 Excel

> ID：690468
> 
> 赞同：0
> 
> 时间：2009-03-27T16:29:10.463
> 
> 标签：vb.net, excel, stored-procedures, dataset, firebird

我过去使用以下代码将存储过程“HISTORICAL_COSTS”生成的数据集导出到 Excel。

```
 Dim c As Long = 1
        For Each dc As DataColumn In Me.WOCostDataSet. & _
        HISTORICAL_COSTS.Columns
            .Cells(1, c).Value = dc.ColumnName.ToString
            .Cells(1, c).Font.Bold = True
            c += 1
        Next

        Dim i As Long = 2
        For Each dr As DataRow In Me.WOCostDataSet.HISTORICAL_COSTS.Rows
            c = 1
            For Each dc As DataColumn In Me.WOCostDataSet. & _
            HISTORICAL_COSTS.Columns
                .Cells(i, c).Value = dr.Item(dc.ColumnName).ToString
                c += 1
            Next
            i += 1
        Next 
```

我正在尝试将此代码重新用于不同但相似的应用程序，但是，我遇到了问题。之前对这段代码的使用是在存储过程生成的 dBase 中的静态表上使用的。虽然这对于新应用程序基本上保持不变，但现在要求存储过程有一个输入参数，以便用户在执行之前（通过 VB.net）输入。对于一些背景故事，您可以在此处遵循已完成的过程 -[将参数注入存储过程。](https://stackoverflow.com/questions/656263/problem-injecting-a-vb-parameter-into-a-stored-procedure-firebird/686603#686603)

应用程序本身确实返回了一个完全填充的数据集，我希望我们的用户能够将生成的数据集导出到 Excel。所以，我设置了你的原型“EXPORT ME”按钮来开始这项肮脏的工作。

在提出事件时；Excel 打开，整个工作表中**只重复了我的列名。**但是，这就是问题所在，代表行数据的单元格是空白的。

我得出的结论是（我承认我在这个假设中可能是错误的）行没有被填充，因为存储过程需要一个输入参数来做这件事，没有那个参数就没有t 为每一行返回的任何数据。基本上意味着我的代码不适用于我正在尝试做的事情。

如果我的假设是正确的，那么关于如何将该参数放入上面的代码中以便正确生成行的任何想法。

如果我错了，那么任何关于我的逻辑或代码本身有什么问题的输入都将不胜感激。

谢谢，

雅苏米安

* * *

斯坦，

这是生成数据集的代码：

```
Try
        Dim FBConn As FbConnection
        Dim MyConnectionString As String

        MyConnectionString = "datasource=" _
                        & MyServer & ";database=" _
                        & TextBox4.Text & ";user id=SYSDBA;password=" _
                        & MyPassword & ";initial catalog=;Charset=NONE"

        FBConn = New FbConnection(MyConnectionString)
        Dim FBCmd As New FbCommand("HISTORICAL_COSTS", FBConn)

        FBCmd.CommandType = CommandType.StoredProcedure
        FBCmd.Parameters.Add("@I_PN", FbDbType.VarChar, 40)
        FBCmd.Parameters("@I_PN").Value = TextBox1.Text.ToUpper

        Dim FBadapter As New FbDataAdapter(FBCmd)
        Dim dsResult As New DataSet
        FBadapter.Fill(dsResult)

        Me.HISTORICAL_COSTSDataGridView.DataSource = dsResult.Tables(0)

        Dim RecordCount As Integer
        RecordCount = Me.HISTORICAL_COSTSDataGridView.RowCount
        Label4.Text = RecordCount

    Catch ex As System.Exception
        System.Windows.Forms.MessageBox.Show _
        ("There was an error in generating the DataStream, " & _
        "please check the system credentials and try again.  " & _
        "If the problem persists, please contact your friendly " & _
        "local IT department.")
    End Try 
```

* * *

Stackoverflow 好心地建议我向任何回答我问题的人提供赏金，但是，由于我没有足够的 REP 来创造足够的赏金 - 我无所不包的感激之情是否会获得任何编码的爱？

一些快速更新：

我通过更改存储过程将结果注入到一个新的单独表中来测试我的应用程序，然后针对该表运行我的 excel 导出 - 它工作正常。但是，由于许多人将同时使用该应用程序，因此这不是一个可行的解决方案。

所以，我重新相信这个数据集实例存在问题，需要一个参数才能正确运行以进行导出。

很高兴尽我所能回答任何问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T17:32:39.593

您的结论肯定是错误的——一旦填充了数据集，参数就不再是一个因素。我看不出您的代码有任何明显错误，正如您所说，它在其他地方也有效。我将首先设置一个断点并确保数据集包含您期望的行。

# c - 有没有办法找出在 c 中使用 malloc 时可用的最大字节数是多少？

> ID：690472
> 
> 赞同：1
> 
> 时间：2009-03-27T16:30:59.430
> 
> 标签：c, memory, memory-management, malloc

还是您只需要检查 errno 和/或指针以查看您是否成功？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-27T16:35:08.577

您是在问是否可以在调用 malloc 之前找出有多少字节可供您使用？

如果是这样，答案是否定的。即使你可以，答案对你来说也可能不是很有价值。原因是你永远不知道有多少内存可用，你只能知道有多少内存**可用**。这是一个非常重要的区别，因为它会影响您正确使用 API 的方式。

例如，假设有一个名为 available_memory 的函数。这段代码看起来是正确的，但被严重破坏了

```
size_t size = GetSizeToAllocate();
if ( size < available_memory() ) {
  // No need to check the answer because there is enough memory
  SomeType* p = malloc(size);
} 
```

原因是其他线程可能会进入 if 语句和 malloc 语句之间并进行自己的分配。这可能会减少系统中的整体内存，从而改变可用内存的回报。

更糟糕的是系统中的可用内存量并不能决定使用malloc可以分配多少内存。对于 malloc（以及任何其他内存分配操作）来说，重要的是有多少连续内存可用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T16:38:26.417

尝试不一定有帮助，因为某些操作系统（如 Linux）使用乐观的内存分配策略 - 即使您从中获得非 NULL 结果`malloc()`也不意味着您有请求的内存供您使用。

更多[在这里](http://www.linuxdevcenter.com/pub/a/linux/2006/11/30/linux-out-of-memory.html)

似乎没有办法做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:33:27.817

在 C 中没有办法做到这一点。任何解决方案都是特定于操作系统的，我不知道它是否足够有用以实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T16:51:31.627

如果您在程序开始时就知道需要多少内存，并且程序在运行时不能失败，通常只需将开始时所需的所有内存分配为一个大块，然后自己管理它。

# asp.net - 如何让 ASPNET 被 SQL Server 2005 识别为可信连接

> ID：690473
> 
> 赞同：0
> 
> 时间：2009-03-27T16:31:06.123
> 
> 标签：asp.net, sql-server, security, database-connection, sqlconnection

这是情况。我正在开发一个新网站来访问旧数据库。这是 DoD 安装，因此周围有很多安全措施。

当前的应用程序是用经典的 ASP、VBScript 和一些 javascript 编写的。新系统是 ASP.NET。

在旧系统中访问数据库意味着使用您自己的凭据（域名\用户名）访问服务器。现在我正在尝试测试我所做的一些早期开发。当我使用 Cassini（在 VS2008 下）时，我可以毫无困难地访问数据库，因为 ourdomain\myusername 在 SQL Server 实例中注册为受信任的连接。由于我必须编写安全方面的内容，Cassini 不能再用作测试服务器 - 我必须使用 IIS（我们这里有安全读卡器）。卡西尼无法处理它们。

因此，当我解决了将适当帐户添加到本地 PC 上的管理员以便我可以在使用 IIS 时在 VS2008 中进行调试的所有问题时，我尝试连接到数据库并被拒绝，因为 MYPC\ASPNET 不是受信任的联系。

改变现有的数据库是不可能的。用于访问数据库的硬编码用户名和密码是不可能的。

我问 DBA 是否可以将 MYPC\ASPNET 添加到域组中，以便 SQL Server 可以将其视为可信连接（因为 MYDOMAIN\MYNAME 位于被视为可信连接的组中）。他告诉我这在技术上是不可能的。

最终会有三四台机器（我的、另一位开发人员、最终的实时 Web 服务器和未来的测试 Web 服务器）的 ASPNET 帐户将访问我们的两台 SQL 服务器（实时和测试）。

我必须做些什么才能使现有的 SQL 服务器将我视为朋友而不是敌人？我查看了模拟，但我得到的印象是它与我们的系统不兼容 - 业务规则调用一个通用例程来创建一个 SqlConnection 对象并打开它（甚至可能是一个 SqlTransaction 对象与之一起使用）并且使用了这个对象其余的业务规则和数据访问层，直到完成。一旦打开 SqlConnection （并通过 ByRef 返回调用例程），模拟似乎不会持续存在

提前感谢您的任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T16:37:49.693

你有两个选择：

1.  在配置为在域帐户上下文中运行的应用程序池中运行您的 Web 应用程序
2.  使用模拟并将您的 Web 应用程序配置为仅使用 Windows 身份验证

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:34:02.340

使用[模拟](http://msdn.microsoft.com/en-us/library/aa292118(VS.71).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T16:34:32.307

听起来您想冒充访问您网站的客户对吗？您是否尝试过使用模拟，或者您认为它不起作用？

# 编辑

正如 Albert 指出的那样，模拟要求用户使用 Windows 身份验证进行身份验证。您需要禁用匿名访问，并在 IIS 管理工具中启用 Windows 身份验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T16:47:37.627

正如已经建议的那样，您应该使用模拟。

但是，如果您的 SQL Server 运行在与您的 Web 服务器不同的计算机上，那么模拟将不够，因为用户的凭据不会被委派给 SQL Server（服务器跃点）。在这种情况下，您将不得不在 AD 中启用委派或在您的 SQL Server 上创建一个非 Windows 登录并改用它（如果您的 SQL Server 实际使用 Windows 登录来控制对表等的访问控制，这将不起作用） .

# sql - SQL 选择不同的行

> ID：690474
> 
> 赞同：4
> 
> 时间：2009-03-27T16:31:14.623
> 
> 标签：sql

我有这样的数据（col2 是日期类型）

```
| col1 | col2 |
------------------------------
| 1 | 17/10/2007 07:19:07 |
| 1 | 17/10/2007 07:18:56 |
| 1 | 2070 年 12 月 31 日 |
| 2 | 28/11/2008 15:23:14 |
| 2 | 2070 年 12 月 31 日 |

```

如何选择 col1 不同且 col2 的值最大的行。像这样

```
| col1 | col2 |
------------------------------
| 1 | 2070 年 12 月 31 日 |
| 2 | 2070 年 12 月 31 日 |

```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-27T16:33:11.500

```
SELECT col1, MAX(col2) FROM some_table GROUP BY col1; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T16:33:14.807

```
 select col1, max(col2)
 from table
 group by col1 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-27T16:35:16.550

我想会是

select col1, max(col2) from DemoTable group by col1

除非我错过了一些明显的东西

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T16:35:35.333

```
select col1, max(col2) from MyTable
group by col1 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T16:34:01.903

SELECT Col1, MAX(Col2) 从 YourTable GROUP BY Col1

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T16:33:22.247

在`Oracle`和`MS SQL`：

```
SELECT  *
FROM    (
        SELECT  t.*, ROW_NUMBER() OVER (PARTITION BY col1 ORDER BY col2 DESC) rn
        FROM    table t
        ) q
WHERE rn = 1 
```

这将选择其他列`col1`以及`col2`

# web-services - 使用 Delphi 2007 将 Base64 字符串作为二进制文件保存到磁盘

> ID：690475
> 
> 赞同：1
> 
> 时间：2009-03-27T16:32:01.080
> 
> 标签：web-services, delphi, base64, delphi-2007

我有一个 Base64 二进制字符串，它是由第 3 方供应商发送给我们的 XML 文档的一部分，我希望能够将其保存回其原始文件格式 (jpg)。

使用这个问题[“使用 php 将 base64 字符串作为二进制文件保存到磁盘”](https://stackoverflow.com/questions/380922/saving-a-base64-string-to-disk-as-a-binary-using-php)中接受的答案，我可以毫不费力地将字符串保存为 jpg，所以我知道该字符串的格式很好并且是一个 JPG 文件。

但是我如何在 Delphi 2007 中做到这一点？

在网上我找到了一个关于如何将 Base64 转换为 TByteDynArray 的教程，并保存它，但它不能正常工作。我也玩过 Indy 的 IdDecoderMIME，但没有成功。

有谁知道如何做到这一点，或者我应该在哪里寻找？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T16:55:11.057

[OmniXML](http://www.omnixml.com/)项目中的OmniXMLUtils.pas包含以下函数：

```
function  Base64Decode(encoded, decoded: TStream): boolean; overload;
function  Base64Decode(const encoded: string; decoded: TStream): boolean; overload;
function  Base64Decode(const encoded: string; var decoded: string): boolean; overload;
function  Base64Decode(const encoded: string): string; overload;
procedure Base64Encode(decoded, encoded: TStream); overload;
procedure Base64Encode(decoded: TStream; var encoded: string); overload;
function  Base64Encode(decoded: TStream): string; overload;
function  Base64Encode(const decoded: string): string; overload;
procedure Base64Encode(const decoded: string; var encoded: string); overload; 
```

Base64Decode(string, TStream) 应该可以解决问题。对于 TStream 参数，您可以像这样传递 TFileStream ：

```
procedure SaveBase64ToFile(const encoded, fileName: string);
var
  fs: TFileStream;
begin
  fs := TFileStream.Create(fileName, fmCreate);
  try
    if not Base64Decode(encoded, fs) then
      raise Exception.Create('Invalid data!');
  finally FreeAndNil(fs); end;
end; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T19:04:30.060

Internet Direct (Indy) 库包含 IdCoderMIME.pas 中支持 Base64 编码且易于使用的类：TIdEncoderMIME 和 TIdDecoderMIME。

# debugging - 针对不受支持的 Vault SCM 应用程序配置 Visual Studio 源服务器/符号存储

> ID：690492
> 
> 赞同：1
> 
> 时间：2009-03-27T16:35:05.537
> 
> 标签：debugging, symbols, pdb-files, source-server

我正在尝试将我们的内部开发代码配置为符号服务器，在 Visual Studio 2008 中调试时可以访问源代码控制文件。我们可以在引用我们核心库集的其他项目上使用它。

遗憾的是，我们将 SourceGear Vault 用于我们的 SCM 系统，目前不支持使用其源代码控制引用来索引我们的 .PDB 文件。

我真的不需要直接的源代码控制访问，我对网络共享访问感到满意，但我看不到如何更新 PDB 文件中的引用。

我配置了符号服务器并添加了对原始构建源代码的正确引用，但是，当我在 Visual Studio 中调试并尝试进入引用的代码时，它不会从源服务器加载 PDB 并且因此没有可用的源代码。

此外，Visual Studio 可以通过 Load Symbols 命令下载核心 .NET PDB 文件，但当我单击模块时，我没有该选项。

有没有人有任何设置这种事情的个人经验？

如果有人可以提供帮助，非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T22:20:21.773

这个问题已经[在这个其他相关问题](https://stackoverflow.com/questions/694665/ms-source-server-source-stream-is-apparently-not-there-when-viewing-with-srctoo)上得到了解决。

整个过程中缺少源索引，因此 PDB 符号服务器现在应该可以正常工作。

# windows - 我可以使用 mSysGit 和 Cygwin 的 git 吗？

> ID：690502
> 
> 赞同：8
> 
> 时间：2009-03-27T16:36:40.977
> 
> 标签：windows, git, cygwin, msysgit

迁移到 Windows 后，我使用 msysgit 及其附带的 bash shell，这对我来说效果很好。但我有问题：我们的 ant 构建过程不会在那个 shell 中运行，我想使用 Cygwin 的 xterms 而不是 Windows 命令窗口，因为终端兼容性不足以运行我想要的所有其他东西那个窗口，等等。

实际上，我已经在 Windows 命令 shell 中坚持使用 msysgit，这样我就不必使用单独的窗口来构建，但这会带来更多问题：缺少`cd`- 和文件完成正在杀死我，大多数我想通过管道传输的命令不存在，等等。

因此，如果我切换到使用 Cygwin 的 git，或者更糟糕的是，在不同时间同时使用这两种方式，行尾会咬我吗？Cygwin 的 git 是否会期望一切都会发生`\n`并认为它正在看到变化，因为 mSysGit 在结帐时转换为`\r\n`？Cygwin 的 git 是否会检查`\n`并混淆我的 Windows Eclipse，我确信这一切都是如此`\r\n`？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T17:37:36.477

最简单的方法是将任何 git（msysGit 或 Cygwin git）设置为忽略 crlf 样式。

```
core.autocrlf=false 
```

这样，您就没有蚂蚁不需要的冲突。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T17:45:31.560

> Will Cygwin's git check out as \n and confuse my Windows Eclipse, which I'm sure wants everything to be \r\n?

Most modern applications (including Eclipse) are perfectly capable of using \n only.

There are a few annoying exceptions (e.g. email protocol), but in most cases you can stick to just using \n for everything.

So, as VonC says, just disable the autocrlf setting and it'll be fine.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-05T12:35:26.943

从这篇文章 - “在 Windows 上使用 Msysgit 设置 GIT 服务器” - 一位用户建议了这个链接 - [http://www.timdavis.com.au/git/setting-up-a-msysgit-server-with-copssh-on-视窗/](http://www.timdavis.com.au/git/setting-up-a-msysgit-server-with-copssh-on-windows/)

我使用此设置并在 Windows for Me 上完美运行。

希望能帮助到你

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T18:00:37.187

Actually, just sticking with msysGit won't save you. I had one issue where every single source file showed as changed because of the line-ending issue when using different versions of msysGit. Setting core.autocrlf in the git config file fixed it.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-25T07:59:15.350

我对行尾感到头疼。我正在使用 cygwin git，它总是将一些新签出的文本文件报告为“已修改”。当我将“core.autocrlf”从“true”更改为“input”时，15 个文件中有 10 个从修改列表中消失了，其余 5 个在我将“core.autocrlf”设置为“false”后消失了。

由于声誉低，我不能投票支持 VonC 的解决方案，但我会说它对我有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-02T19:09:10.050

在调试了一段时间后，我为我的情况解决了这个问题。我以迂回的方式从 Linux 分区复制了 id_rsa 文件，将行尾保留为 LF (Unix) 格式。在 eclipse 中打开文件并将行尾转换为 Windows 修复了这个问题。另外，我按照以下说明将 GIT_SSH 设置为 Plink（来自 Putty）：http: [//www.mainelydesign.com/blog/view/git-plink-for-ssh-on-windows](http://www.mainelydesign.com/blog/view/git-plink-for-ssh-on-windows)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-30T15:18:33.640

我在 msysgit 中将 core.autocrlf 设置为 false 并采用默认安装的任何 cygwin。

由于文件模式的明显变化（每个文件中的 755 似乎更改为 644），我在使用 cygwin 工具和 msysgit 附带的 mingw 工具从命令提示符签出时遇到了问题。这似乎是关于可执行位的问题。git reset 没有帮助。

但是，从 msysgit GUI 窗口进行初始克隆并没有产生这个问题，而且我现在似乎可以从它自己的 bash shell 或命令提示符中自由使用 cygwin，或者从它的 bash shell 中使用 msysgit。换句话说，一切似乎都很快乐。

因此，最重要的是，如果您看到每个文件似乎都发生了变化，并且行尾似乎不是问题的原因，请尝试从 GUI 中签出。

# scrum - 我在哪里可以找到 Scrum 开发的示例图表？

> ID：690503
> 
> 赞同：0
> 
> 时间：2009-03-27T16:36:51.570
> 
> 标签：scrum

我在哪里可以找到 Scrum 开发的示例图表？

例如：烧毁或积压图表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T21:52:59.687

我总是发现 ScrumForTeamSystem 流程指南可以作为任何 scrum 的参考，例如：

[http://scrumforteamsystem.com/processguidance/v2/ProcessGuidance.aspx](http://scrumforteamsystem.com/processguidance/v2/ProcessGuidance.aspx)

当事情按原样进行时，冲刺燃尽图将是一个很好的接近零的线性图：

[http://scrumforteamsystem.com/processguidance/v2/Images/SBBurndown.html](http://scrumforteamsystem.com/processguidance/v2/Images/SBBurndown.html)

产品 backlog 应该看起来像一个很好的、明确优先级的用户故事列表，由您的产品负责人提供，您可以在此列表上进行高级估计并用作创建小型开发工作项目的基础，否则称为 sprint backlog 项目：

[http://scrumforteamsystem.com/processguidance/v2/Artefacts/ProductBacklog/ProductBacklogContents.aspx](http://scrumforteamsystem.com/processguidance/v2/Artefacts/ProductBacklog/ProductBacklogContents.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T13:06:55.147

[Mike Cohn 在他的博客](http://www.mountaingoatsoftware.com/resources/5-sample-burndown-tracking-excel-sheet-for-scrumxp)上有一个很好的燃尽图示例。我觉得他的写作风格简洁明了。

特别是我喜欢他的[替代燃尽图](http://www.mountaingoatsoftware.com/scrum/alt-releaseburndown)，它在正 y 轴上跟踪团队完成的工作，在负 y 轴上跟踪添加/重新调整范围的新工作。通过使用已完成工作和添加工作的趋势，您可以合理地估计项目的结束日期。

# inversion-of-control - Windsor Fluent 界面生活方式

> ID：690517
> 
> 赞同：0
> 
> 时间：2009-03-27T16:42:31.057
> 
> 标签：inversion-of-control, castle-windsor, fluent-interface

这些是用于设置组件生活方式的等效语法吗？

```
Component.For<IFoo>()
         .ImplementedBy<Foo>()
         .LifeStyle.Is(LifestyleType.Transient)

Component.For<IBar>()
         .ImplementedBy<Bar>()
         .LifeStyle.Transient 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T16:47:33.913

是的，他们是。

在 fluent 界面有完整的文档之前，最好的信息来源是[测试](http://svn.castleproject.org:8080/svn/castle/trunk/InversionOfControl/Castle.MicroKernel.Tests/Registration/)。

另一个信息来源是这个[wiki 页面](http://using.castleproject.org/display/IoC/Fluent+Registration+API)。

# .net - 是否有一个 .NET 控件来模拟 Word 2007 选择工具栏？

> ID：690519
> 
> 赞同：2
> 
> 时间：2009-03-27T16:42:50.323
> 
> 标签：.net, winforms, controls, user-interface

[上下文工具栏 http://img14.imageshack.us/img14/9729/word2007toolbar.gif](http://img14.imageshack.us/img14/9729/word2007toolbar.gif)

我希望在突出显示文本时显示类似于 Word 2007 中的悬停工具栏（[见图）的工具栏。](http://img14.imageshack.us/img14/9729/word2007toolbar.gif)这个控件是否存在（免费或其他）或者我是否可以自己破解它？

谢谢！

如果有人对如何将其组合在一起有任何提示，也将不胜感激。我不需要该栏具有的淡入/淡出效果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T16:55:38.717

我不知道有什么免费的方法可以做到这一点，但我确实在网上找到了一个组件，它允许您在 .NET WinForm 中创建功能区控件。查看此站点了解详细信息：http: [//www.devcomponents.com/dotnetbar/](http://www.devcomponents.com/dotnetbar/)

不幸的是，该组件不是免费的，但有一个试用版，因此您可以在花 234 美元购买它之前对其进行测试。

# c# - XSLT 中的 C# 脚本：“msxsl：脚本不能为空”错误

> ID：690520
> 
> 赞同：1
> 
> 时间：2009-03-27T16:42:55.783
> 
> 标签：c#, xslt

我有一个带有 C# 脚本的 XSLT：

```
<msxsl:script language="C#" implements-prefix="user">
  <msxsl:using namespace="System.Xml"/>
  <msxsl:using namespace="System.Xml.XPath"/>
  <![CDATA[
    public string GetMenuPath(XPathNodeIterator node)
    {       
      XPathNavigator dataSourceNode = node.Current;
      return dataSourceNode.Name;
    }
  ]]>
</msxsl:script> 
```

在 XSLT 的某个地方调用了这个函数：

```
<xsl:value-of select="user:GetMenuPath(current())"/> 
```

但是当我尝试在 XML 输入上运行 XSLT 转换时（输入无关紧要），它立即停止并出现错误“msxsl：脚本不能为空”。

我完全不知道为什么...我将 nxslt 与 .NET Framework 一起使用。

谢谢你的帮助 ！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T12:54:24.763

感谢您的回答，我现在找到了问题的根源。这是因为我使用“style”标签而不是“nxslt”来调用 XSLT 转换。只要没有扩展脚本，“样式”就可以工作。

```
<nxslt style="transformation.xsl" in="input.xml" out="output.xls" verbose="true"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T16:49:27.530

它是否为您提供了转换停止的路线？它是从哪里调用还是在脚本标签中？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T17:49:28.993

您是否尝试过将扩展方法放入单独的程序集中并以这种方式引用它？

马克

# apache - 如何在 Apache 中向 302 重定向添加额外的标头？

> ID：690521
> 
> 赞同：5
> 
> 时间：2009-03-27T16:43:04.033
> 
> 标签：apache, redirect, cdn, http-status-code-302

我在 Apache 配置中有一个重定向，例如

重定向临时 /foo.xml [http://www.baz.com/foo.xml](http://www.baz.com/foo.xml)

我正在尝试将 CDN 的 Expire 和 m-cache 标头添加到此 302。这在 php 中是微不足道的，但我需要在 Apache 配置文件中执行此操作。

通常这样做是这样的：

ExpiresActive On ExpiresDefault "access plus 10 minutes"

但这似乎不适用于 302 重定向。有什么建议么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-11-15T15:45:44.993

```
<Location /foo.xml>
   Redirect temp /foo.xml http://www.baz.com/foo.xml
   Header always set ExpiresActive On
   Header always set ExpiresDefault "access plus 10 minutes"
</Location> 
```

即使使用 HTTP 302 响应（实际上，使用任何 HTTP 响应）也可以让它工作；如果没有关键字“ **always** ”，指令“Header set”仅适用于成功响应，即 HTTP 2xx 响应。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-01-08T14:02:26.233

请注意 Apache 2.2 中的一个奇怪的错误（在 Apache 2.2.15 中观察到），如果您`env=HTTPS`用于控制何时设置 Header，这会使这变得困难。由于某种原因`env=HTTPS`，在重定向期间无法触发，即使使用`RewriteCond %{HTTPS}`on 来控制重定向。因此，在启用 HTTP 严格传输安全 (HSTS) 的配置中，我使用 RewriteRule 创建一个名为的环境变量，该变量`X_HTTPS`具有与 相同的值，但在评估`HTTPS`时未设置为 null ：`env=X_HTTPS`

```
SetEnv HSTS "max-age=31536000; includeSubDomains; preload"

# For some reason in Apache 2.2, HTTPS env variable is not available during redirects
RewriteCond %{HTTPS} on
RewriteRule ^.*$ - [ENV=X_HTTPS:%{HTTPS}]
# Set HSTS Header if the page is delivered via SSL
Header always set Strict-Transport-Security %{HSTS}e env=X_HTTPS

# Redirect SSL-only non-www page to www and quit
RewriteCond %{HTTPS} on
RewriteCond %{HTTP_HOST} ^example\.com$
RewriteRule ^(.*)$ https://www.%{SERVER_NAME}%{REQUEST_URI} [R=303,L]

# Redirect ANY non-SSL page to SSL
RewriteCond %{HTTPS} !on
RewriteCond %{HTTP_HOST} ^(www\.)?example\.com$
RewriteRule ^(.*)$ https://%{SERVER_NAME}%{REQUEST_URI} [R=303,L] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:12:14.277

查看 Apache 的 mod_headers 模块。

也许是这样的：

```
<Location /foo.xml>
   Redirect temp /foo.xml http://www.baz.com/foo.xml
   Header always set ExpiresActive On
   Header always set ExpiresDefault "access plus 10 minutes"
</Location> 
```

我已经编辑了这个答案（因为它被接受了），添加了**always**关键字，以反映下面 Fix 正确指出的内容。

# javascript - 是否有 JavaScript DOM 无法访问的 CSS 属性？

> ID：690522
> 
> 赞同：1
> 
> 时间：2009-03-27T16:43:21.773
> 
> 标签：javascript, css, dom

如果我要删除我的 CSS 样式表并通过 JavaScript 文件设置所有属性，这可能吗？也就是说，有什么我无法通过 JS DOM API 访问的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T16:47:06.257

CSS 中的所有内容都可以通过 JS 访问，但请记住，禁用 JS 的用户根本不会获得任何样式！

*   CSS 用于样式
*   JavaScript 用于改变功能

除非绝对必要，否则不要合并它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T16:46:52.917

我唯一能想到的可能是 IE CSS 表达式（例如在 IE6 中常用于修复 PNG 的表达式）。

但是我认为这通常不是一个好主意，因为出于可维护性的原因，您希望将内容 (HTML)、布局 (CSS) 和逻辑 (javascript) 分开。更不用说人们是否在禁用 javascript 的情况下访问您的网站。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-28T13:40:29.877

事实证明，即使 CSS 完全支持它们，我们也无法访问多个背景。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T16:46:30.453

我不确定您是否可以在 javascript 中设置不同的媒体类型，例如“打印”。

**[编辑]**
实际上，我收回了这一点。您也许可以使用 cssText 来做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T17:03:08.760

可以从[W3C 文档对象模型 CSS2 规范中阅读很多关于 DOM 到 CSS 接口的有趣信息。](http://www.w3.org/TR/DOM-Level-2-Style/css.html)对于 CSS3，他们仍在[努力](http://www.w3.org/Style/CSS/current-work#CSS3)。

因此可以通过 CSS DOM 样式表操作任何 css 属性，但这取决于浏览器支持的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T23:49:54.117

我很确定让浏览器执行所有 JS 来设置样式会比应用样式表慢得多，并且可能更容易出现跨浏览器问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T04:43:27.987

好问题：“会不会有我无法通过 JS DOM API 访问的东西？”

我认为答案是肯定的。见下文：

IE8 现在需要这个 opacity 属性：-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)"

那么有人知道如何使用 Javascript DOM 访问 (DHTML) 动态更改此属性吗？

拿点了吗？

# python - 是否可以访问通过 POP 发送电子邮件的用户？

> ID：690527
> 
> 赞同：0
> 
> 时间：2009-03-27T16:45:50.813
> 
> 标签：python, email, pop3, fetchmail

我被要求引用一个他们希望看到使用 POP 发送的电子邮件的项目。我很确定这是不可能的，但我想如果是的话。

那么是否有可能给用户 POP 电子邮件服务器详细信息来访问他们发送的邮件？

如果是这样，Python 或 fetchmail 中的任何示例？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T16:48:27.360

POP3 只处理接收电子邮件；在这些情况下，发送的邮件通过 SMTP 发送，并且可能通过不同的 ISP 发送到接收者（例如，当您托管自己的电子邮件服务器，但使用当前的 ISP 发送时）。因此，这不是直接可能的。

IMAP 可以做到这一点，因为它提供服务器端电子邮件文件夹以及让服务器处理接口以发送和接收 SMTP 流量

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T16:47:20.500

Pop 不支持发送电子邮件。Pop 只是一个收件箱，发送的邮件将存储在 IMAP、Exchange 或其他专有系统中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:48:12.713

电子邮件不是使用 POP 发送的，而是使用 POP 从服务器收集的。它们是使用 SMTP 发送的，一旦它们消失，它们就不会在服务器上闲逛。

您可能想研究 IMAP？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T16:48:25.363

smtp（邮件发送）服务器可以将所有已发送邮件的副本转发回发件人，然后他们可以通过 pop 访问它。

# mysql - 选择同时包含多个条件的行

> ID：690545
> 
> 赞同：1
> 
> 时间：2009-03-27T16:49:21.553
> 
> 标签：mysql, conditional-statements

我有这样的表结构：

```
ID   cond
1    5
1    2
1    6
8    2
9    1
9    5 
```

当我想选择包含一个或多个条件的行时，我使用 OR (...WHEN cond=2 OR cond=6 GROUP BY ID...)

但是如何选择包含多个同时按 ID 分组的条件的行呢？例如，当我想查找包含 cond 2 和 6 的行时，它只返回 ID 1

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T16:51:18.680

您可以为此使用连接：

```
SELECT  ID
FROM    tbl t1
        INNER JOIN
                tbl t2
                ON t1.ID = t2.ID
WHERE   t1.cond = 2
AND     t2.cond = 6 
```

或者，如果 ID/cond 对是唯一的：

```
SELECT  ID
FROM    tbl
WHERE   cond IN (2, 6)
GROUP BY ID
HAVING COUNT(cond) = 2 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T17:03:12.770

有多种方法可以做到这一点。

使用`COUNT`（最快）：

> `SELECT id FROM tbl WHERE tbl.cond IN ( 2, 6 ) HAVING COUNT(DISTINCT cond) = 2 GROUP BY id`

使用`EXISTS`（使用嵌套循环，在非常大的表上速度较慢，但​​比变体更不神秘且更可扩展`COUNT`）：

> `SELECT DISTINCT id FROM tbl AS tbl1 WHERE EXISTS (SELECT * FROM tbl AS tbl2 WHERE tbl1.id = tbl2.id AND tbl2.cond = 2) AND EXISTS (SELECT * FROM tbl AS tbl2 WHERE tbl1.id = tbl2.id AND tbl2.cond = 6)`

使用`GROUP_CONCAT`（COUNT 主题上的 MySql 特定变体，但如果您想要完全匹配，例如 cond=2 和 cond=6 没有其他条件，那么下面的更改为 read`SELECT id, GROUP_CONCAT(DISTINCT cond ORDER BY cond) AS conds ... WHERE conds='2,6'`将表现最佳）

> `SELECT id, ','||GROUP_CONCAT(DISTINCT cond)||',' AS conds FROM tbl WHERE INSTR(conds, ',2,') > 0 AND INSTR(conds, ',6,') > 0 GROUP BY id`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T16:58:46.120

您可以使用子查询和组来执行此操作。假设您知道需要查找的值的数量，您可以这样做：

```
select
    t.ID
from
    (
        select distinct
            ID, cond
        from
            tbl
        where
            tbl.cond in (2, 6)
    ) as t
group by
    t.ID
having
    count(t.cond) = 2 
```

对于一般情况，您只需更新必须存在的条件列表（即“(2, 6)”）以包含新值，然后更新 having 子句（即“have count(t.cond) = 2") 等于值的总数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T16:52:04.013

```
SELECT DISTINCT(ID) WHERE (cond = 2) OR (cond = 6) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T16:56:09.557

这是另一种语法，它对它的作用更加透明（尽管性能不高）。

```
SELECT DISTINCT ID 
FROM MyTable T
WHERE 
  EXISTS(SELECT ID FROM MyTable T1 WHERE Cond=2 AND T1.ID=T.ID) AND
  EXISTS(SELECT ID From MyTable T2 WHERE Cond=6 AND T2.ID=T.ID) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T17:03:08.277

如果每个 id 没有重复，这可能会更灵活一些。

```
SELECT id
FROM tbl 
GROUP BY id
HAVING SUM(CASE cond 
    WHEN 2 THEN 1
    WHEN 6 THEN 1
    ELSE 0 END) > 1 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T17:13:50.700

您是否考虑过使用 UNION 子句？

从 MyTable 中选择 ID WHERE cond = 2 UNION 从 MyTable 中选择 ID WHERE cond = 6

如果您可以指定您正在寻找的确切输出，这也会有所帮助。但据我了解，UNION 将是要走的路。

# full-text-search - 使用 sql server 2008 进行全文搜索

> ID：690555
> 
> 赞同：5
> 
> 时间：2009-03-27T16:51:52.343
> 
> 标签：full-text-search, sql-server-2008-express

我已经使用工具安装了 sql server 2008 express edition，但我需要使用全文搜索，我知道我拥有的版本中缺少这种搜索。

如何升级以获得全文搜索功能？由于它是在线安装，因此我的计算机上没有存储任何安装介质

我可以用别的东西吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T16:53:23.340

有一个带有高级工具的 SQL Server 2008 Express Edition 的可下载版本，其中包括全文索引。可从 Microsoft 网站免费下载。

[http://www.microsoft.com/downloads/details.aspx?FamilyID=b5d1b8c3-fda5-4508-b0d0-1311d670e336&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=b5d1b8c3-fda5-4508-b0d0-1311d670e336&displaylang=en)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T16:55:06.470

您应该运行“SQL Server 2008 Express Edition with Advanced Tools”安装并指定“配置现有安装”选项。

# .net - 椭圆曲线密码学的 .NET 实现（库）

> ID：690566
> 
> 赞同：18
> 
> 时间：2009-03-27T16:54:44.147
> 
> 标签：.net, encryption, cryptography, public-key-encryption, elliptic-curve

请您建议在.NET平台上使用椭圆曲线密码学的任何实现吗？

另外，如果您使用过它们，您能告诉我应该使用的推荐曲线吗？

[编辑]

正如@FatCat 提到的，它的实现在 .NET 框架 3.5 中可用，但仅在 windows vista 上可用。您能否建议另一种使用方式/库？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T17:17:15.310

.NET Framework 已经包含 Diffie-Hellman，它是一种椭圆曲线加密算法。查看[System.Security.Cryptography.ECDiffieHellmanCng](http://msdn.microsoft.com/en-us/library/system.security.cryptography.ecdiffiehellmancng.aspx)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-13T18:10:30.907

查看 C# 的[Bouncy Castle](http://www.bouncycastle.org/csharp/)库，它有 ECDH 和 ECDSA。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-30T06:33:06.940

通常使用 ECC 进行加密的方式是使用“Ephemeral-Static Diffie-Hellman”。

它是这样工作的：

*   获取预期的接收者公钥（可能来自证书）。这是静态键。
*   生成临时 ECDH 密钥对。这是临时密钥对。
*   使用密钥生成共享对称密钥。
*   使用对称密钥加密数据。
*   将加密数据与来自临时密钥对的公钥一起传输。

接收者现在可以使用临时公钥和他自己的静态私钥来重新创建对称密钥并解密数据。

您可以在[“高效密码学标准”中了解更多信息：SEC 1：椭圆曲线密码学](http://www.secg.org/sec1-v2.pdf)第 5.1.3 节。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T15:19:58.963

查看[SecureBlackBox](http://www.eldos.com/sbb/desc-pki-spec.php)组件

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-01-20T08:09:28.517

> 伟大的！我试过了，但找不到如何使用它来加密消息。似乎没有任何“加密”功能

这是[`System.Security.Cryptography.ECDiffieHellmanCng`](http://msdn.microsoft.com/en-us/library/system.security.cryptography.ecdiffiehellmancng.aspx).

```
using System;
using System.IO;
using System.Security.Cryptography;
using System.Text;

class Alice
{
    public static byte[] alicePublicKey;

    public static void Main(string[] args)
    {
        using (ECDiffieHellmanCng alice = new ECDiffieHellmanCng())
        {

            alice.KeyDerivationFunction = ECDiffieHellmanKeyDerivationFunction.Hash;
            alice.HashAlgorithm = CngAlgorithm.Sha256;
            alicePublicKey = alice.PublicKey.ToByteArray();
            Bob bob = new Bob();
            CngKey k = CngKey.Import(bob.bobPublicKey, CngKeyBlobFormat.EccPublicBlob);
            byte[] aliceKey = alice.DeriveKeyMaterial(CngKey.Import(bob.bobPublicKey, CngKeyBlobFormat.EccPublicBlob));
            byte[] encryptedMessage = null;
            byte[] iv = null;
            Send(aliceKey, "Secret message", out encryptedMessage, out iv);
            bob.Receive(encryptedMessage, iv);
        }

    }

    private static void Send(byte[] key, string secretMessage, out byte[] encryptedMessage, out byte[] iv)
    {
        using (Aes aes = new AesCryptoServiceProvider())
        {
            aes.Key = key;
            iv = aes.IV;

            // Encrypt the message 
            using (MemoryStream ciphertext = new MemoryStream())
            using (CryptoStream cs = new CryptoStream(ciphertext, aes.CreateEncryptor(), CryptoStreamMode.Write))
            {
                byte[] plaintextMessage = Encoding.UTF8.GetBytes(secretMessage);
                cs.Write(plaintextMessage, 0, plaintextMessage.Length);
                cs.Close();
                encryptedMessage = ciphertext.ToArray();
            }
        }
    }

}
public class Bob 
{
    public byte[] bobPublicKey;
    private byte[] bobKey;
    public Bob()
    {
        using (ECDiffieHellmanCng bob = new ECDiffieHellmanCng())
        {

            bob.KeyDerivationFunction = ECDiffieHellmanKeyDerivationFunction.Hash;
            bob.HashAlgorithm = CngAlgorithm.Sha256;
            bobPublicKey = bob.PublicKey.ToByteArray();
            bobKey = bob.DeriveKeyMaterial(CngKey.Import(Alice.alicePublicKey, CngKeyBlobFormat.EccPublicBlob));

        }
    }

    public void Receive(byte[] encryptedMessage, byte[] iv)
    {

        using (Aes aes = new AesCryptoServiceProvider())
        {
            aes.Key = bobKey;
            aes.IV = iv;
            // Decrypt the message 
            using (MemoryStream plaintext = new MemoryStream())
            {
                using (CryptoStream cs = new CryptoStream(plaintext, aes.CreateDecryptor(), CryptoStreamMode.Write))
                {
                    cs.Write(encryptedMessage, 0, encryptedMessage.Length);
                    cs.Close();
                    string message = Encoding.UTF8.GetString(plaintext.ToArray());
                    Console.WriteLine(message);
                }
            }
        }
    }

} 
```

# windows-xp - 如何在 WindowsXP 中运行“tar”命令？

> ID：690573
> 
> 赞同：1
> 
> 时间：2009-03-27T16:55:39.730
> 
> 标签：windows-xp, tar

我需要在 WindowsXP 中运行“tar”命令（解压缩文件）。我需要一个ie Linux 模拟器吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T16:58:08.943

[谷歌搜索tar windows](http://www.google.ca/search?q=tar+windows)时的第一次点击似乎相关..[适用于 Windows 的 Tar](http://gnuwin32.sourceforge.net/packages/gtar.htm)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-27T16:58:51.843

[GNU Tar 可](http://gnuwin32.sourceforge.net/packages/gtar.htm)作为本机 Windows 应用程序使用。但是，许多适用于 Windows 的归档实用程序都可以处理 Tar 格式，包括我个人最喜欢的[7-Zip](http://www.7-zip.org/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-27T16:59:44.383

不，你有很多选择；这里有两个：

1.  [适用于 Windows 的 Unix 实用程序](http://unxutils.sourceforge.net/)
2.  [7-邮编](http://www.7-zip.org/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T16:57:43.377

是的你可以。它包含在[Cygwin](http://www.cygwin.com/)中。

[但我认为更简单的方法是使用7-Zip](http://www.7-zip.org/)打开 tar 存档，它带有 LGPLd 库。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T16:58:49.863

或者在这里下载 Win32 版本的 tar：http: [//gnuwin32.sourceforge.net/packages/gtar.htm](http://gnuwin32.sourceforge.net/packages/gtar.htm)

只需单击显示“二进制文件”的部分。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T16:58:23.500

[WinZip](http://www.winzip.com/index.htm)可以读取 tar 文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-27T17:09:06.173

[http://sourceforge.net/projects/unxutils](http://sourceforge.net/projects/unxutils)是包含 tar 的二进制 Unix 实用程序的集合。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-27T16:57:48.757

如果你需要 Linux “模拟器”，你可以使用 Cygwin[链接文本](http://www.cygwin.com)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-27T17:01:15.753

如果你只想要**tar**那么 Ryan Graham's 是最好的解决方案。如果您需要其他一些 UNIX 工具，但又不想让 Cygwin 变得如此臃肿，请参阅[Minmalist GNU for Windows](http://www.mingw.org/)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-27T17:08:29.903

我对[TugZip](http://www.tugzip.com/)印象深刻。它处理一堆压缩格式，包括 tar 和 tgz（而且它是免费的）。

# c++ - What is the scope of variables declared in a class constructor?

> ID：690579
> 
> 赞同：4
> 
> 时间：2009-03-27T16:56:46.030
> 
> 标签：c++, constructor, scope

I was curious, what is the scope of variables declared inside a class constructor which are not data members of that class?

For example, if a constructor needs an iterating int `i`, will this variable be destroyed after the constructor finishes, or is it then global for the program?

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-27T16:59:45.493

In this sense a constructor is like any other function - any variable declared inside has usual scope limitations and they all surely go out of scope and get destroyed once constructor is finished.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T16:59:42.137

Like any other function, if it's a local variable it will be "destroyed" at the end of the function. Local scope.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-01-13T16:54:12.370

As it often happens, you could be mixing the notions of scope and lifetime, so I'll address both.

The *scope* of a name declared inside a constructor is the same as the scope of any local name (the fact that it is a *constructor* makes no difference whatsoever): the scope of the name extends to the end of the block in which the name is declared (and it can have "holes" when the name is *hidden* by a declaration of an even "more local" entify with the same name).

The lifetime of am object defined inside a constructor is governed by the same rules as the lifetime of any locally-defined object (the fact that it is a *constructor* makes no difference whatsoever): an object with automatic storage duration is destroyed at the end of its scope, while an object with static storage duration lives forever.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T16:59:24.353

Variables declared in the class constructor are available inside the scope of the class constructor and nowhere higher.

```
public MyClass() {
   int i = 0; // i is only available inside this constructor.
              // It can't be used in any other function of this class or any other.
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T17:00:11.637

Local variables, regardless of the function, are destroyed when they go out of scope. They do not become 'global.'

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T17:01:38.157

Scope can either be static (lexical) or dynamic. Most languages use lexical scope, which means scope is determined by the text of the program (e.g. "inside the set of braces where it's defined"), not by the meaning of what you wrote.

[http://en.wikipedia.org/wiki/Scope_(programming)](http://en.wikipedia.org/wiki/Scope_(programming))

# visual-studio-2008 - 在 VS 2008 SDK 中使用文本模板引擎时出现“找不到入口点”错误

> ID：690585
> 
> 赞同：1
> 
> 时间：2009-03-27T16:57:50.007
> 
> 标签：visual-studio-2008, t4

我正在使用`Microsoft.VisualStudio.TextTemplating.Engine`VS 2008 SDK 中的类以及`Microsoft.Practices.RecipeFramework.VisualStudio.Library.Templates`命名空间中的对象来自动化从 T4 模板创建 C# 类的过程。

这是我的代码。它直接取自[Oleg Sych](http://www.olegsych.com/2008/04/t4-property-directive/)博客上的示例......

```
using System;
using System.Collections.Generic;
using System.Drawing;
using System.IO;
using Microsoft.Practices.RecipeFramework.VisualStudio.Library.Templates;
using Microsoft.VisualStudio.TextTemplating; 

namespace PropertyDirectivePot
{
  class Program
  {
    static void Main(string[] args)
    {
      // Prepare template parameters
      var arguments = new Dictionary<string, PropertyData>();
      arguments.Add(“MyProperty”,
        new PropertyData(Color.AntiqueWhite, typeof(Color))); 

      // Initialize GAX template host
      string currentDirectory = Directory.GetCurrentDirectory();
      TemplateHost host = new TemplateHost(currentDirectory, arguments);
      host.TemplateFile = Path.Combine(currentDirectory, “PropertyTest.tt”); 

      // Transform template
      string template = File.ReadAllText(host.TemplateFile);
      ITextTemplatingEngine engine = new Engine();
      string output = engine.ProcessTemplate(template, host); 

      // Save output
      string outputFile = Path.ChangeExtension(host.TemplateFile, “.txt”);
      File.WriteAllText(outputFile, output);
    }
  }
} 
```

## 问题

我`System.EntryPointNotFoundException`在处理模板并且应该返回输出代码文件的地方得到一个...

```
string output = engine.ProcessTemplate(template, host); 
```

此异常表明我在某处存在组件版本不匹配，[谷歌搜索](http://social.msdn.microsoft.com/Forums/en-US/vsgatk/thread/e9080b59-3d8a-4cff-afc7-0c3ef2be4da8/)显示其他人也遇到过此问题，但我正在使用的组件版本要旧得多。我的版本是...

***Visual Studio*** SP1 9.0.30729.1
***Microsoft.VisualStudio.TextTemplating*** 9.0.0.0
***Microsoft.Practices.RecipeFramework.VisualStudio.Library*** 1.4.0.0

我有最新版本的 GAX、GAT 和 VS2008 SDK（今天全部下载并安装）。

有谁知道发生了什么，或者我可以如何进一步调查？

如果可能的话，我真的想避免必须开始使用跟踪器来跟踪调用堆栈:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T11:47:08.723

找到了答案...

我引用了错误版本的`Microsoft.VisualStudio.TextTemplating`程序集。

我的机器上安装了两个版本...

*   8.1.0.0
*   9.0.0.0

我使用的特定版本`Microsoft.Practices.RecipeFramework.VisualStudio.Library`需要两个版本中的较早版本。

# c# - 在 C# 中使用 WebClient 有没有办法在重定向后获取站点的 URL？

> ID：690587
> 
> 赞同：41
> 
> 时间：2009-03-27T16:58:12.517
> 
> 标签：c#, .net, regex, http

使用 WebClient 类，我可以很容易地获得网站的标题：

```
WebClient x = new WebClient();    
string source = x.DownloadString(s);
string title = Regex.Match(source, 
    @"\<title\b[^>]*\>\s*(?<Title>[\s\S]*?)\</title\>",
    RegexOptions.IgnoreCase).Groups["Title"].Value; 
```

我想存储 URL 和页面标题。但是，当点击以下链接时：

[http://tinyurl.com/dbysxp](http://tinyurl.com/dbysxp)

我显然想要获得重定向到的 Url。

**问题**

有没有办法使用类来做到这一点`WebClient`？

我将如何使用`HttpResponse`and`HttpRequest`呢？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-03-29T10:51:01.587

如果我理解这个问题，这比人们说的要容易得多 - 如果你想让 WebClient 完成请求的所有细节（包括重定向），但最后得到*实际*的响应 URI，你可以继承 WebClient像这样：

```
class MyWebClient : WebClient
{
    Uri _responseUri;

    public Uri ResponseUri
    {
        get { return _responseUri; }
    }

    protected override WebResponse GetWebResponse(WebRequest request)
    {
        WebResponse response = base.GetWebResponse(request);
        _responseUri = response.ResponseUri;
        return response;
    }
} 
```

只需在您会使用 WebClient 的任何地方使用 MyWebClient。在你完成任何你需要做的 WebClient 调用之后，你就可以使用 ResponseUri 来获取实际的重定向 URI。 *如果您使用的是异步内容，您还需要为 GetWebResponse(WebRequest request, IAsyncResult result) 添加类似的覆盖。*

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-12-17T23:06:41.887

我知道这已经是一个已回答的问题，但这对我来说很有效：

```
 HttpWebRequest request = (HttpWebRequest)WebRequest.Create("http://tinyurl.com/dbysxp");
 request.AllowAutoRedirect = false;
 HttpWebResponse response = (HttpWebResponse)request.GetResponse();
 string redirUrl = response.Headers["Location"];
 response.Close();

 //Show the redirected url
 MessageBox.Show("You're being redirected to: "+redirUrl); 
```

干杯。！;)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-27T17:06:39.687

使用[`HttpWebRequest`](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)，您可以将[`AllowAutoRedirect`属性](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.allowautoredirect.aspx)设置为`false`。发生这种情况时，任何状态码在 300-399 之间的响应都不会被自动重定向。

然后，您可以从响应标头中获取新 url，然后为新 url 创建一个新`HttpWebRequest`实例。

对于[`WebClient`class](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)，我怀疑您是否可以开箱即用地对其进行更改，以使其不允许重定向。您可以做的是从类派生一个类`WebClient`，然后覆盖[`GetWebRequest`](http://msdn.microsoft.com/en-us/library/system.net.webclient.getwebrequest.aspx)和[`GetWebResponse`](http://msdn.microsoft.com/en-us/library/a3xa6ys0.aspx)方法以更改基本实现返回的[`WebRequest`](http://msdn.microsoft.com/en-us/library/system.net.webrequest.aspx)/实例；[`WebResponse`](http://msdn.microsoft.com/en-us/library/system.net.webresponse.aspx)如果是`HttpWebRequest`，则将`AllowAutoRedirect`属性设置为`false`。在响应中，如果状态码在 300-399 范围内，则发出新请求。

但是，我不知道您可以从`GetWebRequest`/`GetWebResponse`方法中发出新请求，因此最好只使用一个循环执行`HttpWebRequest`/[`HttpWebResponse`](http://msdn.microsoft.com/en-us/library/system.net.httpwebresponse.aspx)直到所有重定向都被执行。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-01-19T06:34:04.093

我得到了重定向页面和页面内容的 Uri。

```
HttpWebRequest request = (HttpWebRequest)WebRequest.Create(strUrl);
request.AllowAutoRedirect = true;

HttpWebResponse response = (HttpWebResponse)request.GetResponse();
Stream dataStream = response.GetResponseStream();

strLastRedirect = response.ResponseUri.ToString();

StreamReader reader = new StreamReader(dataStream);              
string strResponse = reader.ReadToEnd();

response.Close(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-04-15T11:49:52.420

如果您只对重定向 URI 感兴趣，可以使用以下代码：

```
public static string GetRedirectUrl(string url)
{
     HttpWebRequest request = (HttpWebRequest) HttpWebRequest.Create(url);
     request.AllowAutoRedirect = false;

     using (HttpWebResponse response = HttpWebResponse)request.GetResponse())
     {
         return response.Headers["Location"];
     }
} 
```

该方法将返回

*   null - 如果没有重定向
*   相对 url - 在重定向的情况下

**请注意**：`using`声明（或最终声明`response.close()`）是必不可少的。有关详细信息，请参阅[MSDN 库](https://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getresponse(v=vs.110).aspx)。否则，您可能会在多次执行此代码时用完连接或超时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T17:07:16.223

HttpWebRequest.AllowAutoRedirect 可以设置为 false。然后你必须手动 http 状态码在 300 范围内。

```
// Create a new HttpWebRequest Object to the mentioned URL.
HttpWebRequest myHttpWebRequest=(HttpWebRequest)WebRequest.Create("http://www.contoso.com");    
myHttpWebRequest.MaximumAutomaticRedirections=1;
myHttpWebRequest.AllowAutoRedirect=true;
HttpWebResponse myHttpWebResponse=(HttpWebResponse)myHttpWebRequest.GetResponse(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-27T17:07:13.977

WebClient 类有一个跟随重定向的选项。设置该选项，你应该没问题。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-27T17:17:38.040

好的，这确实是 hackish，但关键是使用 HttpWebRequest，然后将 AllowAutoRedirect 属性设置为 true。

这是一个非常复杂的例子

```
 HttpWebRequest req = (HttpWebRequest)WebRequest.Create("http://tinyurl.com/dbysxp");
        req.Method = "GET";
        req.AllowAutoRedirect = true;
        WebResponse response = req.GetResponse();

        response.GetResponseStream();
        Stream responseStream = response.GetResponseStream();

        // Content-Length header is not trustable, but makes a good hint.
        // Responses longer than int size will throw an exception here!
        int length = (int)response.ContentLength;

        const int bufSizeMax = 65536; // max read buffer size conserves memory
        const int bufSizeMin = 8192;  // min size prevents numerous small reads

        // Use Content-Length if between bufSizeMax and bufSizeMin
        int bufSize = bufSizeMin;
        if (length > bufSize)
            bufSize = length > bufSizeMax ? bufSizeMax : length;

        StringBuilder sb;
        // Allocate buffer and StringBuilder for reading response
        byte[] buf = new byte[bufSize];
        sb = new StringBuilder(bufSize);

        // Read response stream until end
        while ((length = responseStream.Read(buf, 0, buf.Length)) != 0)
            sb.Append(Encoding.UTF8.GetString(buf, 0, length));

        string source = sb.ToString();string title = Regex.Match(source, 
        @"\<title\b[^>]*\>\s*(?<Title>[\s\S]*?)\</title\>",RegexOptions.IgnoreCase).Groups["Title"].Value; 
```

`enter code here`

# php - 有什么方法可以在 PHP 中指定可选参数值？

> ID：690599
> 
> 赞同：24
> 
> 时间：2009-03-27T17:00:00.483
> 
> 标签：php, function, optional-parameters

假设我有一个 PHP 函数 foo：

```
function foo($firstName = 'john', $lastName = 'doe') {
    echo $firstName . " " . $lastName;
}
// foo(); --> john doe 
```

有没有办法只指定第二个可选参数？

例子：

```
foo($lastName='smith'); // output: john smith 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-27T17:08:49.340

PHP 本身不支持函数的命名参数。但是，有一些方法可以解决这个问题：

1.  使用数组作为函数的唯一参数。然后您可以从数组中提取值。这允许在数组中使用命名参数。
2.  如果要根据上下文允许可选数量的参数，则可以使用 func_num_args 和 func_get_args 而不是在函数定义中指定有效参数。然后根据参数数量、字符串长度等，您可以确定要做什么。
3.  将空值传递给您不想指定的任何参数。并没有真正绕过它，但它确实有效。
4.  如果您在对象上下文中工作，那么您可以使用魔术方法 __call() 来处理这些类型的请求，以便您可以根据传递的参数路由到私有方法。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-27T17:29:09.120

数组技术的一种变体，可以更轻松地设置默认值：

```
function foo($arguments) {
  $defaults = array(
    'firstName' => 'john',
    'lastName' => 'doe',
  );

  $arguments = array_merge($defaults, $arguments);

  echo $arguments['firstName'] . ' ' . $arguments['lastName'];
} 
```

用法：

```
foo(array('lastName' => 'smith')); // output: john smith 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-27T17:48:20.430

您可以稍微重构您的代码：

```
function foo($firstName = NULL, $lastName = NULL)
{
    if (is_null($firstName))
    {
        $firstName = 'john';
    }
    if (is_null($lastName ))
    {
        $lastName = 'doe';
    }

    echo $firstName . " " . $lastName;
}

foo(); // john doe
foo('bill'); // bill doe
foo(NULL,'smith'); // john smith
foo('bill','smith'); // bill smith 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-27T17:09:33.190

如果您有多个可选参数，一种解决方案是传递一个散列数组参数：

```
function foo(array $params = array()) {
    $firstName = array_key_exists("firstName", $params) ?
      $params["firstName"] : "";
    $lastName = array_key_exists("lastName", $params) ?
      $params["lastName"] : "";
    echo $firstName . " " . $lastName;
}

foo(['lastName'=>'smith']); 
```

当然，在这个解决方案中，没有验证哈希数组的字段是否存在或拼写正确。这完全取决于您来验证。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T17:02:45.733

不，通常的做法是使用一些启发式方法来确定隐含的参数，如字符串长度、类型等。

一般来说，您会编写函数以按照最需要到最不需要的顺序获取参数。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-27T17:08:09.903

你想要的方式：不。

您可以使用一些特殊标记，例如 NULL 来注意未提供值：

```
function foo($firstName, $lastName = 'doe') {
    if (is_null($firstName))
        $firstName = 'john';
    echo $firstName . " " . $lastName;
}

foo(null, 'smith'); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-12-18T18:10:50.537

PHP 8 引入了命名参数，因此现在可以指定传递给函数的参数。

PHP 8 之前：

```
htmlspecialchars($string, ENT_COMPAT | ENT_HTML401, 'UTF-8', false); 
```

PHP 8 之后：

```
htmlspecialchars($string, double_encode: false); 
```

[参考](https://www.php.net/releases/8.0/en.php#named-arguments)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-08-19T14:54:28.770

我希望这个解决方案在我 2.5 年前开始使用 PHP 时就已经存在了。它在我创建的示例中效果很好，我不明白为什么它不应该是完全可扩展的。与之前提出的那些相比，它提供了以下好处：

(i) 函数内对参数的所有访问都是通过命名变量进行的，就好像参数已完全声明一样，而不需要数组访问

(ii) 调整现有功能非常快速和容易

(iii) 任何函数只需要一行额外的代码（除了不可避免地需要定义默认参数，无论如何您都将在函数签名中执行此操作，而是在数组中定义它们）。额外线路的功劳完全归功于 Bill Karwin。这条线对于每个功能都是相同的。

方法

使用强制参数和可选数组定义您的函数

将可选参数声明为局部变量

症结：使用您通过数组传递的参数替换任何可选参数的预先声明的默认值。

```
extract(array_merge($arrDefaults, array_intersect_key($arrOptionalParams, $arrDefaults))); 
```

调用函数，传递它的强制参数，并且只传递你需要的那些可选参数

例如，

```
function test_params($a, $b, $arrOptionalParams = array()) {

$arrDefaults = array('c' => 'sat',

                     'd' => 'mat');

extract(array_merge($arrDefaults, array_intersect_key($arrOptionalParams, $arrDefaults)));

echo "$a $b $c on the $d";

} 
```

然后这样称呼它

```
test_params('The', 'dog', array('c' => 'stood', 'd' => 'donkey'));
test_params('The', 'cat', array('d' => 'donkey'));
test_params('A', 'dog', array('c' => 'stood')); 
```

结果：

狗站在驴子上

猫坐在驴子上

一只狗站在垫子上

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-04-11T06:34:16.993

这里提到了一些“选项”样式的实现。如果您打算将它们用作标准，那么到目前为止，没有一个是非常防弹的。试试这个模式：

```
function some_func($required_parameter, &$optional_reference_parameter = null, $options = null) {
    $options_default = array(
        'foo' => null,
    );
    extract($options ? array_intersect_key($options, $options_default) + $options_default : $options_default);
    unset($options, $options_default);

    //do stuff like
    if ($foo !== null) {
        bar();
    }
} 
```

这为您提供了函数局部变量（仅`$foo`在此示例中）并防止创建任何没有默认值的变量。这样就不会有人意外覆盖函数中的其他参数或其他变量。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-08-26T09:11:41.407

参数需要*按位置顺序传递，*不能跳过参数本身；您必须提供默认参数值才能跳过它。可以说，这违背了你想要达到的目的。

在不重写函数以不同方式接受参数的情况下，这是一种解决此问题的调用时方法：

```
$func = 'foo';
$args = ['lastName' => 'Smith'];

$ref = new ReflectionFunction($func);
$ref->invokeArgs(array_map(function (ReflectionParameter $param) use ($args) {
    if (array_key_exists($param->getName(), $args)) {
        return $args[$param->getName()];
    }
    if ($param->isOptional()) {
        return $param->getDefaultValue();
    }
    throw new InvalidArgumentException("{$param->getName()} is not optional");
}, $ref->getParameters())); 
```

换句话说，您使用反射来检查函数的参数并按名称将它们映射到可用参数，跳过带有默认值的可选参数。是的，这既丑陋又麻烦。您可以使用此示例创建一个函数，例如：

```
call_func_with_args_by_name('foo', ['lastName' => 'Smith']); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-27T17:11:47.147

可悲的是，您尝试做的事情没有“语法糖”的方式。它们都是不同形式的 WTF。

如果您需要一个带有未定义数量的任意参数的函数，

```
function foo () { 
     $args = func_get_args(); 
     # $args = arguments in order 
} 
```

会成功的。尽量避免使用太多，因为对于 PHP，这有点神奇。

然后，您可以选择应用默认值并根据参数计数做一些奇怪的事情。

```
function foo() { 
   $args = func_get_args();
   if (count($args) < 1 ) { 
       return "John Smith"; 
   }
   if (count($args) < 2 ) { 
       return "John " . $args[0];
   }
   return $args[0] . " " . $args[1];
} 
```

此外，您可以选择模拟 Perl 样式参数，

```
function params_collect($arglist){ 
    $config = array();
    for ($i = 0; $i < count($arglist); $i+=2) { 
        $config[$i] = $config[$i+1];
    }
    return $config; 
}
function param_default($config, $param, $default){ 
    if (!isset($config[$param])) { 
        $config[$param] = $default;
    }
    return $config;
}

function foo() { 
   $args = func_get_args();
   $config = params_collect($args); 
   $config = param_default($config, 'firstname', 'John'); 
   $config = param_default($config, 'lastname', 'Smith'); 
   return $config['firstname'] . ' ' . $config['lastname'];   
}

foo('firstname', 'john', 'lastname', 'bob'); 
foo('lastname', 'bob', 'firstname', 'bob'); 
foo('firstname', 'smith'); 
foo('lastname', 'john'); 
```

当然，在这里使用数组参数*会*更容易，但是您可以选择（甚至是不好的方式）做事。

[值得注意的是，这在 Perl 中更好，因为你可以只做 foo(firstname => 'john');]

*   [php.net 上的 func_get_args](http://nz.php.net/func_get_args)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-11-15T09:33:23.247

如果经常使用，只需定义一个新的专用函数：

```
function person($firstName = 'john', $lastName = 'doe') {
    return $firstName . " " . $lastName;
}

function usualFirtNamedPerson($lastName = 'doe') {
    return person('john', $lastName);
}

print(usualFirtNamedPerson('smith')); --> john smith 
```

请注意，如果您愿意，您还可以在此过程中更改 $lastname 的默认值。

当一个新函数估计过大时，只需调用带有所有参数的函数即可。如果你想让它更清楚，你可以将你的文字预先存储在 fin 命名变量中或使用注释。

```
$firstName = 'Zeno';
$lastName = 'of Elea';
print(person($firstName, $lastName));
print(person(/* $firstName = */ 'Bertrand', /* $lastName = */ 'Russel')); 
```

好的，这不像 那样简短优雅`person($lastName='Lennon')`，但似乎你不能在 PHP 中拥有它。这不是最性感的编码方式，使用超级元编程技巧或其他方式，但您希望在维护过程中遇到什么解决方案？

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-27T17:09:55.607

不，没有，但您可以使用数组：

```
function foo ($nameArray) {
    // Work out which values are missing?
    echo $nameArray['firstName'] . " " . $nameArray['lastName'];
}

foo(array('lastName'=>'smith')); 
```

# c# - Server 2008 / Vista 上的 ADODB 2.8 在哪里？

> ID：690609
> 
> 赞同：2
> 
> 时间：2009-03-27T17:02:35.063
> 
> 标签：c#, visual-studio-2008, windows-server-2008, adodb

我一直在开发一个在 Windows 2005 机器上引用 ADODB 2.8 COM 的 C# 项目。（不，我没有将它用于数据访问，我需要它，因为 CDO 需要返回 ADODB.Streams）。

现在我尝试在 Server 2008 机器上打开这个解决方案，但我被告知 ADOB 2.8 丢失了，果然在 COM 引用列表和 /programs files/Common Files/microsoft shared/ 文件夹中没有任何 ADODB 项目缺少 ado 文件夹。

现在我知道 Vista / Server 2008 具有 Windows DAC 6.0，这就是 MDAC 现在所称的，所以我不愿意继续安装 MDAC。

其他人遇到或解决了这个问题吗？还有其他地方我可以获取 ADODB.Stream 的互操作吗？我应该使用 MDAC 2.8 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T17:16:11.333

[DAC](http://msdn.microsoft.com/en-us/library/ms692877(VS.85).aspx)状态的文档（强调我的）：

> Windows DAC 包括一些与 Windows Vista 一起使用的更改，但在功能上**几乎**完全等同于 MDAC 2.8。

正是因为“几乎”这让我在需要使用 ADO 2.8 而不是 Windows DAC 时使用 MDAC 2.8。

有兴趣的可以[下载 MDAC 2.8](http://www.microsoft.com/download/en/details.aspx?id=5793)。

# python - 在 python 中执行无操作的标准方法是什么？

> ID：690622
> 
> 赞同：186
> 
> 时间：2009-03-27T17:04:19.867
> 
> 标签：python

我经常发现自己在 python 中编写 if / elif / else 结构，并且我想包含可能出现的选项，但相应的操作是什么都不做。我意识到我可以排除那些 if 语句，但为了便于阅读，我发现将它们全部包含在内是有帮助的，这样如果您查看代码，您可以看到每个选项的结果。我如何编码无操作？目前，我正在这样做：

```
no_op = 0

if x == 0:
    y = 2 * a
elif x == 1:
    z = 3 * b
elif x == 3:
    no_op 
```

（代码实际上比这长一点，而且更复杂。这只是为了说明结构）。

我不喜欢将变量用作无操作，但这是我能想到的最简洁的方式。有没有更好的办法？

* * *

## 回答 #1

> 赞同：340
> 
> 时间：2009-03-27T17:05:17.040

使用[pass](http://docs.python.org/reference/simple_stmts.html#the-pass-statement)进行无操作：

```
if x == 0:
  pass
else:
  print "x not equal 0" 
```

这是另一个例子：

```
def f():
  pass 
```

或者：

```
class c:
  pass 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-27T17:05:35.820

怎么样`pass`？

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2017-06-12T16:10:57.093

如果您需要一个充当 nop 的函数，请尝试

```
nop = lambda *a, **k: None
nop() 
```

有时当我将依赖项设为可选时，我会做这样的事情：

```
try:
    import foo
    bar=foo.bar
    baz=foo.baz
except:
    bar=nop
    baz=nop

# Doesn't break when foo is missing:
bar()
baz() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-11-11T11:56:00.470

您可以在标准输出中打印空字符串且不换行。如果 linter 禁止您`pass`在不需要的地方使用 a ，这会很方便，但您需要一行注释：

```
print('', end='')  # This does next to nothing 
```

除了浪费 CPU 周期外，使用这个空`print`的副作用很小：

```
$ echo "print('', end='')  # This does next to nothing" > main.py
$ python3 main.py
$ 
```

请注意，`pass`在此处使用在语法上是正确的，但 linter 可能会抱怨：

```
$ echo "pass  # This does next to nothing" > main.py
$ python3 main.py
$ 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-04-18T11:58:44.817

我桌上的一个简单练习就是使用这样的一行：

```
dummy = 0 
```

普通的编码器（甚至那些来自其他常见编程语言的编码器）会立即理解它。

# mysql - 我如何更新表中的一行或如果它不存在则插入它？

> ID：690632
> 
> 赞同：86
> 
> 时间：2009-03-27T17:07:57.720
> 
> 标签：mysql, sql, sqlite, postgresql, upsert

我有以下计数器表：

```
CREATE TABLE cache (
    key text PRIMARY KEY,
    generation int
); 
```

我想增加一个计数器，或者如果相应的行尚不存在，则将其设置为零。有没有办法在标准 SQL 中没有并发问题的情况下做到这一点？该操作有时是事务的一部分，有时是单独的。

如果可能，SQL 必须在 SQLite、PostgreSQL 和 MySQL 上未经修改地运行。

搜索产生了几个想法，这些想法要么存在并发问题，要么特定于数据库：

*   尝试`INSERT`一个新的行，`UPDATE`如果有错误。不幸的是，错误`INSERT`中止当前事务。

*   `UPDATE`行，如果没有行被修改，则为`INSERT`新行。

*   MySQL 有一个`ON DUPLICATE KEY UPDATE`子句。

编辑：感谢所有伟大的答复。看起来 Paul 是对的，而且没有一种单一的、可移植的方式来做到这一点。这让我很惊讶，因为这听起来像是一个非常基本的操作。

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-03-27T17:15:03.427

MySQL（以及随后的 SQLite）也支持 REPLACE INTO 语法：

```
REPLACE INTO my_table (pk_id, col1) VALUES (5, '123'); 
```

这会自动识别主键并找到要更新的匹配行，如果没有找到则插入新行。

文档：[https ://dev.mysql.com/doc/refman/8.0/en/replace.html](https://dev.mysql.com/doc/refman/8.0/en/replace.html)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-27T17:19:10.577

SQLite 支持[替换](http://www.sqlite.org/lang_insert.html)已经存在的行：

```
INSERT OR REPLACE INTO [...blah...] 
```

您可以将其缩短为

```
REPLACE INTO [...blah...] 
```

添加此快捷方式是为了与 MySQL`REPLACE INTO`表达式兼容。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-03-27T17:45:40.997

我会做类似以下的事情：

```
INSERT INTO cache VALUES (key, generation)
ON DUPLICATE KEY UPDATE (key = key, generation = generation + 1); 
```

在代码或 sql 中将生成值设置为 0，但使用 ON DUP... 来增加值。无论如何，我认为这就是语法。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-28T22:47:50.280

ON DUPLICATE KEY UPDATE 子句是最好的解决方案，因为：REPLACE 执行 DELETE，后跟 INSERT，因此在很短的时间内删除了记录，从而产生很小的可能性，即如果页面被跳过，查询可能会返回在 REPLACE 查询期间查看。

出于这个原因，我更喜欢 INSERT ... ON DUPLICATE UPDATE ...。

jmoz 的解决方案是最好的：虽然我更喜欢 SET 语法而不是括号

```
INSERT INTO cache 
SET key = 'key', generation = 'generation'
ON DUPLICATE KEY 
UPDATE key = 'key', generation = (generation + 1)
; 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-27T17:10:43.127

我不知道你会找到一个平台中立的解决方案。

这通常称为“UPSERT”。

查看一些相关讨论：

*   [SQL Server 上的 INSERT OR UPDATE 解决方案](https://stackoverflow.com/questions/108403/solutions-for-insert-or-update-on-sql-server)
*   [SQL Server 2005 执行 MySQL REPLACE INTO？](https://stackoverflow.com/questions/234)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-27T17:41:43.317

在 PostgreSQL 中没有合并命令，实际上编写它并不是微不足道的——实际上有一些奇怪的边缘情况使任务“有趣”。

最好的（如：在最可能的条件下工作）方法是使用函数 - 例如[手册](http://www.postgresql.org/docs/current/interactive/plpgsql-control-structures.html#PLPGSQL-ERROR-TRAPPING)（merge_db）中显示的函数。

如果你不想使用函数，你*通常*可以逃脱：

```
updated = db.execute(UPDATE ... RETURNING 1)
if (!updated)
  db.execute(INSERT...) 
```

请记住，它不是防错的，它最终**会**失败。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-27T17:27:11.650

标准 SQL 为此任务提供了 MERGE 语句。并非所有 DBMS 都支持 MERGE 语句。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T17:11:07.680

如果您没有一种通用的方式来自动更新或插入（例如，通过事务），那么您可以回退到另一个锁定方案。一个 0 字节的文件、系统互斥体、命名管道等……

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T17:12:25.557

你可以使用插入触发器吗？如果失败，请进行更新。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-05T15:06:17.627

如果您可以使用为您编写 SQL 的库，那么您可以使用[Upsert](https://github.com/seamusabshere/upsert)（目前仅限 Ruby 和 Python）：

```
Pet.upsert({:name => 'Jerry'}, :breed => 'beagle')
Pet.upsert({:name => 'Jerry'}, :color => 'brown') 
```

这适用于 MySQL、Postgres 和 SQLite3。

它在 MySQL 和 Postgres 中编写存储过程或用户定义函数 (UDF)。它`INSERT OR REPLACE`在 SQLite3 中使用。

# postgresql - 您如何向用户公开区分大小写？

> ID：690643
> 
> 赞同：1
> 
> 时间：2009-03-27T17:09:07.687
> 
> 标签：postgresql

好的，我明白了。PostgreSQL 中的数据区分大小写。而且我知道我可以使用 LOWER() 使我的查询不区分大小写。我知道在 PostgreSQL 的未来版本中甚至可能会有一个“ [citext](http://developer.postgresql.org/pgdocs/postgres/citext.html) ”类型。我的问题是，今天，您在设计用户界面时如何处理这个问题？我正在特别考虑唯一性约束。

假设我的应用程序的数据看起来或多或少像一个文件系统（想想 Google Docs，除了 Google Docs 实际上允许重复名称 :-P）。如果情况不同，我怎样才能让我们的用户更容易理解他们可以有重名的事实？我想对大多数人来说，这看起来*很奇怪*。

让我们先发制人地解决一些问题：

1.  我来自 Windows 背景，所以不区分大小写是我的“想法”。我现在主要使用 Mac OS X，它（你知道吗？）[也是不区分大小写的](http://davidwinter.me.uk/articles/2008/05/17/mac-os-xhfs-case-insensitive-why/)。我们的大多数用户都属于这两个相同的类别。

2.  我是 PostgreSQL 新手。我的大部分经验是使用 MySQL，但我也使用过 Oracle，它像 PostgreSQL 一样区分大小写。我当时也对这个问题想了很多，但最终还是让一切保持原样，让我们​​的用户自己弄清楚。

3.  我对技术解决方案（即让这个问题消失）和 UI 设计解决方案（即帮助用户对系统感到舒适）都感兴趣。

概括：

*   在设计用户界面时如何处理不区分大小写的问题？
*   如果情况不同，我怎样才能让我们的用户更容易理解他们可以有重名的事实？

**编辑**：我感谢到目前为止的所有反馈。但是，如果答案是“如果大小写不同，则不允许重复名称”，那么**我该如何**在 PostgreSQL 中实现呢？我考虑过的一个解决方案是默默地维护一个单独的列，该列始终是数据的 LOWER() 版本，并将唯一约束放在该列上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T17:27:15.427

您现在可以使用[citext](http://pgfoundry.org/projects/citext/)数据类型。虽然它可能比未来的内置版本有更多的限制。

**编辑**至于[唯一约束](http://www.postgresql.org/docs/current/static/sql-createindex.html)：

```
CREATE UNIQUE INDEX
    example_unique_idx
ON
    example_table ((LOWER(case_insensitive_field))); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:24:26.287

也许您不知道这一事实，但您可以在函数上创建唯一索引。甚至使它们成为部分索引。

例如：

```
create unique index some_name on users (lower(username)); 
```

无论大小写如何，都会使用户名唯一。

您还可以进一步移动 1 步（例如，这在您的环境中可能不是一个好主意），以便仅对活动用户强制执行唯一性：

```
create unique index some_name on users (lower(username)) where is_active = true; 
```

另外，请注意，对于不区分大小写的搜索，您**不应**使用 ILIKE。问题是 ILIKE 不能（由于某种我不太明白的原因）使用索引。

因此，虽然可以使用功能索引来加快查询速度：

```
select * from users where lower(username) = '...' 
```

或者

```
select * from users where lower(username) like '...' 
```

（至少对于“...”的某些值）

index 不会用于（据我所知）：

```
select * from users where username ilike '...' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T17:28:14.410

区分大小写迫使您的用户处理计算机世界中的问题。

不要暴露区分大小写！

您刚刚告诉我 Windows 和 Mac 都不区分大小写，它们是为了减少用户的混淆。

你处理这个问题的方法是，你保留用户选择的大小写（用户输入是神圣的），但是当你进行搜索或比较时，它总是不区分大小写。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:36:21.503

*   在设计用户界面时如何处理不区分大小写的问题？

在不区分大小写的情况下，您不允许用户创建具有相同名称的对象，除非您有一个非常具体的目标受众已经“了解它”。普通计算机用户 Emily Executive 不会理解为什么她有两个“季度报告”和“季度报告”文件——这只会损害产品的可用性，除非应用程序或使用场景需要区分大小写。

换句话说，除非它是一个要求，否则假定不区分大小写。

*   如果情况不同，我怎样才能让我们的用户更容易理解他们可以有重名的事实？

如果必须这样做，请强制使用一种字体，使名称明显不同。提供一个打开和关闭警告的用户选项框，“此文件的名称与其他文件相似，您确定要将其保存为此名称吗？” 它在开始时自动打开（选择退出，不选择加入一般警告）

-亚当

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-29T19:47:37.333

实现不区分大小写的另一个技术解决方案是[创建您自己的类型](http://www.postgresql.org/docs/current/interactive/xtypes.html)，并内置折叠为小写。这样，用户（和应用程序）就不会出错。

# feed - 用于查询 Google 阅读器“共享”以获取博客文章的 API

> ID：690646
> 
> 赞同：2
> 
> 时间：2009-03-27T17:09:19.167
> 
> 标签：feed, google-reader

对于给定的博客文章，是否有 API（官方或非官方），让我看看有多少人在 Google 阅读器上分享/加注星标？我订阅了一个特定的博客，这对于我的阅读习惯来说有点多产，所以我想制作一个新的提要，其中只包含达到某个众包质量阈值的帖子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T17:37:06.667

[Google Reader 没有官方 API，但是这里](http://code.google.com/p/pyrfeed/wiki/GoogleReaderAPI)有一些基于逆向工程的非官方文档。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T17:26:00.313

Google 拥有大量客户端 API，可以轻松查询 google reader、blogger 以及他们提供的所有其他服务。Google Data API 可能有您正在寻找的内容。他们的 api 可从[http://code.google.com/apis/gdata/ 获得](http://code.google.com/apis/gdata/)

# apache-flex - 如何使用 ActionScript 3.0 打印舞台上的所有元素？

> ID：690651
> 
> 赞同：1
> 
> 时间：2009-03-27T17:11:04.827
> 
> 标签：apache-flex, actionscript-3

我有一个 flex/as3 项目，其中有一个位图背景，然后在该背景之上绘制 Sprite。它创建地图和通往地图上位置的路线。我正在实现一个打印功能来打印该地图（闪存屏幕），然后将其他信息添加到同一页面。地图在计算机屏幕上以 800 像素的宽度和 480 像素的高度显示。

我查看了 AS3 中的 PrintJob 类，并找到了一种打印单独位图或精灵的方法，但我真的只想创建 Flash 文件的屏幕截图，然后将其保存为 png。在新页面上单独显示附加信息。我知道将屏幕截图另存为 .png 是一个不同的问题，但如果我能弄清楚如何首先捕获舞台，第二个问题将不复存在。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T23:40:54.170

您需要将舞台上的所有内容包装在 Sprite 实例中，然后将该 Sprite 传递给 PrintJob.addPage() 方法。

如果您使用的是 Flex，那么您还可以使用[FlexPrintJob](http://livedocs.adobe.com/flex/3/langref/mx/printing/FlexPrintJob.html)类来为您处理一些布局和分页。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-22T17:40:26.640

我试图打印舞台，但在让舞台正确调整大小时遇到​​了很多问题，因此我使用了多种解决方案，包括将舞台转换为位图。

这是我的来源：

```
function PrintStage(evt:MouseEvent) {
   var printJob:PrintJob = new PrintJob();
   var options:PrintJobOptions = new PrintJobOptions();
   options.printAsBitmap = true;
   trace("print called!");
   if (printJob.start()) {
    var printSprite = new Sprite();

    var bitmapData:BitmapData = new BitmapData(stage.stageWidth,stage.stageHeight);
    bitmapData.draw(stage);
    var screenShot:Bitmap = new Bitmap(bitmapData);

    printSprite.addChild(screenShot);

    //========== printjob bug fix - prevent blank pages: ==========
    printSprite.x = 2000; //keep it hidden to the side of the stage
    stage.addChild(printSprite); //add to stage - prevents blank pages
    //=============================================================

    trace("before printSprite width: " + printSprite.width + " printJob.pageWidth: " + printJob.pageWidth);

    //scale it to fill the page (portrait orientation):
    var myScale:Number;
    myScale = Math.min(printJob.pageWidth/printSprite.width, printJob.pageHeight/printSprite.height);
    printSprite.scaleX = printSprite.scaleY = myScale;
    var printArea:Rectangle = new Rectangle(0, 0, printJob.pageWidth/myScale, printJob.pageHeight/myScale);

    trace("after printSprite width: " + printSprite.width + " printJob.pageWidth: " + printJob.pageWidth);

    printJob.addPage(printSprite,printArea,options);
    printJob.send();

    stage.removeChild(printSprite);
    printSprite = null;
   }
  } 
```

希望它可以帮助某人....

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-17T01:38:48.200

我今天有同样的问题。我很震惊（震惊！）Adobe 不会让你做像打印舞台这样简单的事情。我选择从舞台实例简单地创建一个位图图像，将其添加到应用程序实例，然后打印它。我认为这比试图在另一个组件中包装东西、弄乱布局等更简单。由于整个屏幕只有一个图像，你只需要定位这一个图像。如果使用绝对布局，甚至不需要定位。它将完全重叠您的实际内容。打印应用程序实例。删除位图的容器实例，您就完成了。

现在，可以使用 PrintJob 而不是 FlexPrintJob 以更少的代码行打印舞台，但我不相信舞台实例是 Sprite，所以无论如何，以下类似的东西是必要的。

此方法假定“this”是应用程序。

```
private function printScreen():void {
    var printJob:FlexPrintJob = new FlexPrintJob();
    if (printJob.start()) {
        var bitmapData:BitmapData = new BitmapData(stage.width, stage.height, false);
        bitmapData.draw(stage);
        var bitmap:FlexBitmap = new FlexBitmap(bitmapData);
        //Wrap the bitmap into a class that can be added to the framework display list.
        //I chose mx:Image arbitrarily.
        //Really, anything will do as long as it is an IVisualElement
        //Note that the application's layout is absolute so this image gets
        //temporarily added on top of the actual application's elements. 
        var image:Image = new Image();
        image.source = bitmap;
        addElement(image);

        printJob.addObject(this);

        removeElement(image);
    }
    // Send the job to the printer.
    printJob.send();
} 
```

对于这种方法，我只能想到一个限制。那是 Flash 的最大位图图像大小限制。但是对于高达高清的显示器，我认为没有问题。

# asp.net - ASP.NET 部署工具

> ID：690661
> 
> 赞同：4
> 
> 时间：2009-03-27T17:14:22.227
> 
> 标签：asp.net, deployment, automation

在我重新发明轮子之前，我想看看是否已经存在类似的工具。我想自动部署我们的各种网站、Web 服务和多个数据库。

我正在考虑编写一个 NAnt 脚本和一个简单的 GUI 应用程序，它将枚举 NAnt 脚本中的目标并显示一个任务列表，然后可以打开/关闭并执行这些任务。这样的工具是否已经存在？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T17:25:56.600

看看[MsDeploy](http://weblogs.asp.net/steveschofield/archive/2008/01/23/msdeploy-exe-tool-for-content-replication-sync-iis-settings-and-more.aspx)和[Web 部署工具](http://learn.iis.net/page.aspx/346/web-deployment-tool/)，不过我会使用 MSBuild 将它们捆绑在一起。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T21:30:22.800

我过去使用过[CruiseControl](http://cruisecontrol.sourceforge.net/)。他们也有[.NET 风格](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)。对我们来说，设置/配置很长，但是一旦设置好，它就运行得很好。

# ruby-on-rails - Rails“validates_uniqueness_of”区分大小写

> ID：690664
> 
> 赞同：101
> 
> 时间：2009-03-27T17:14:47.407
> 
> 标签：ruby-on-rails, validation, model

这是模型（我使用的是 SQLLite3）：

```
class School < ActiveRecord::Base

  validates_uniqueness_of :name

end 
```

例如，我加了“耶鲁”后，不能加“耶鲁”，但*可以*加“耶鲁”。如何使验证不区分大小写？

编辑：找到它 -[活动记录验证](http://api.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html)

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2009-03-27T18:03:07.447

`validates_uniqueness_of :name, :case_sensitive => false`可以解决问题，但您应该记住，如果您有多个服务器/服务器进程（例如，运行 Phusion Passenger、多个 Mongrel 等）或多线程服务器，`validates_uniqueness_of`则*不能保证唯一性。*那是因为您可能会得到以下事件序列（顺序很重要）：

1.  进程 A 收到创建名为“foo”的新用户的请求
2.  过程 B 做同样的事情
3.  进程 A 通过询问数据库该名称是否存在并且数据库说该名称尚不存在来验证“foo”的唯一性。
4.  进程 B 做同样的事情并得到同样的响应
5.  流程A提交`insert`新记录的语句并成功
6.  如果您有一个要求该字段具有唯一性的数据库约束，进程 B 将提交`insert`新记录的语句并*失败*，并从 SQL 适配器返回一个丑陋的服务器异常。如果您没有数据库约束，则插入将成功，并且您现在有两行以 'foo' 作为名称。

另请参阅[`validates_uniqueness_of`](http://api.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#M002110)Rails 文档中的“并发性和完整性”。

来自[Ruby on Rails 第 3 版](http://pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition)：

> ...尽管它的名字， validates_uniqueness_of 并不能真正保证列值是唯一的。它所能做的就是验证没有列与执行验证时正在验证的记录中的值相同。有可能同时创建两条记录，每条记录都具有相同的列值，这应该是唯一的，并且两条记录都通过验证。强制唯一性的最可靠方法是使用数据库级别的约束。”

另请参阅[此程序员](http://blog.insoshi.com/2008/06/26/working-around-the-validates_uniqueness_of-bug-in-ruby-on-rails/)使用`validates_uniqueness_of`.

这种情况通常发生的一种方式是在创建新帐户时从网页意外重复提交。这是一个很难解决的问题，因为用户将得到的是第二个（丑陋的）错误，这会让他们认为他们的注册失败，而实际上它成功了。我发现防止这种情况的最好方法就是使用 javascript 来防止重复提交。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2011-07-27T05:42:36.920

在 rails 3 中，您可以在模型中执行此操作：

```
validates :name, :uniqueness => true 
```

或不区分大小写

```
validates :name, :uniqueness => {:case_sensitive => false} 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-03-27T17:24:28.320

有一个选项可以指定不区分大小写

```
 validates_uniqueness_of :name, :case_sensitive => false 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-22T19:21:52.163

有一个类似的问题，但答案更有趣：[https ://stackoverflow.com/a/6422771](https://stackoverflow.com/a/6422771)

基本上， using`:case_sensitive => false`执行非常低效的数据库查询。

# c# - 如何使用 ADO.net Entity Framework 正确加载对象引用

> ID：690666
> 
> 赞同：1
> 
> 时间：2009-03-27T17:15:23.863
> 
> 标签：c#, linq, entity-framework

我正在做的工作，但这是错误的，我知道。

```
 public Profile GetProfile(int id)
    {
        Profile profile = (
            from u in en.User where u.UserID == id 
                select u.Profile.FirstOrDefault()
            ).First();

        if (profile.UserReference.Value == null)
            profile.UserReference.Load();

        return profile;
    } 
```

Profile.UserID 是绑定到 User.UserID 的 FK。因此，实体框架不将 Profile.UserID 包含在实体模型中，这就是为什么我的 linq 查询首先查找 User 对象，然后选择相关的 Profile 对象（这对我来说感觉很脏）。

谁能提供更好的解决方案：

1.  通过 User.UserID 查找 Profile 对象。
2.  在返回的 Profile 对象中加载 User 对象引用。

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T17:26:17.457

尝试使用[Include](http://msdn.microsoft.com/en-us/library/bb738708.aspx)方法

```
public Profile GetProfile(int id)
{
  return (from p in db.Profiles.Include("User")
          where p.User.UserId == id
          select p).FirstOrDefault();
} 
```

此方法返回配置文件对象，其中已加载用户引用。

# javascript - JavaScript 准备好可视化大型数据集了吗？

> ID：690671
> 
> 赞同：12
> 
> 时间：2009-03-27T17:17:06.200
> 
> 标签：javascript, dom, browser, visualization, flot

我们有一些数据（10-50 列，数十万行），我们通常在 Excel 中将其可视化为折线图或堆积条形图。
用户希望能够放大和缩小图表以深入了解各个样本，但这些操作确实让 Excel 陷入了困境。

我正在考虑将数据嵌入到 HTML 页面中，使用内联 JavaScript 来处理浏览器中的可视化。类似 flotr JS 图表库之类的东西将被用于图表。

1.  这是一个愚蠢的想法吗？
2.  浏览器准备好承受这种负载了吗？
3.  这是一个已解决的问题，我应该在问之前更彻底地搜索一下吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-27T17:22:11.617

Javascript 可能已经为它做好了准备，因为 javascript 本身已经变得非常快。根据我的经验，浏览器通常*还没有*准备好处理非常大的 DOM 结构。至少您可以预期会花费大量时间来找出运行缓慢的原因。您还会发现许多“标准”javascript 库（想到原型/jquery）不适合使用“过大”的大型 DOM 结构。

准备好发现一个给定的操作在*所有*浏览器上都很慢，但最终在不同的浏览器上会出现 3-4 个不同的原因。这是基于使用中等超大 DOM 的经验。虽然肯定有可能，但要获得体面的结果需要花费大量的工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T14:09:51.967

我强烈推荐亚当的建议来执行一些基准测试和优化。我最近在使用 Flot 绘制大型数据集方面做了一些工作，并且在使用 Internet Explorer 时遇到了低于可接受的性能（例如，在绘制图表时，整个浏览器在我的开发人员框中挂了大约 20 秒）。

Flot 使用[`canvas`](http://en.wikipedia.org/wiki/Canvas_(HTML_element))仅 Internet Explorer 9+ 支持的图表元素。[Flot 使用ExplorerCanvas](http://code.google.com/p/explorercanvas/)库为旧版本的 Internet Explorer 提供支持。该库使用[VML](http://en.wikipedia.org/wiki/Vector_Markup_Language)，通过 DOM 操作 VML 元素来绘制图形。

使用[Internet Explorer 8 脚本分析器](http://msdn.microsoft.com/en-nz/library/dd565629(en-us,VS.85).aspx)，我发现渲染绘图所花费的大部分时间都用于调用本机[insertAdjacentHTML 方法](http://msdn.microsoft.com/en-us/library/ms536452.aspx)来创建 VML 元素。因为无法提高调用本机方法的性能，所以我转而致力于减少绘制的数据点的数量（进而减少在 DOM 中创建的 VML 元素）以获得可接受的性能。

如果您不需要或不关心对旧版本 Internet Explorer 的支持，那么您应该会发现 Flot/Flotr 非常有能力处理大型数据集。但是，如果您确实需要支持这些版本，请准备好在绘制大型数据集时遇到性能问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T17:18:30.300

**Javascript 准备好可视化大型数据集了吗？**

是的 - 该语言已经到了可以毫不费力地在正确的环境中处理重要记录集并对其进行操作、可视化等的程度。语言本身很好。

**这是一个愚蠢的想法吗？**

不，事实上，您几乎可以指望每台计算机都能够运行这种强大的跨平台语言。

**浏览器准备好承受这种负载了吗？**

有些可能是 - 取决于您实际采取的处理和操作。随着 Chrome 使用快速的 javascript 引擎，以及越来越多的人严重依赖它，javascript 速度之战被点燃。我认为这是一个完全有效的使用场景。

您需要为基准测试和优化做好准备，这意味着深入了解 javascript。请公开您的结果，以便可以弥补不足。

-亚当

# seam - 使用 Intellij-idea 实现接缝热部署

> ID：690676
> 
> 赞同：3
> 
> 时间：2009-03-27T17:18:23.793
> 
> 标签：seam, intellij-idea, hotdeploy

如何使用 Intellij-IDEA 和 Seam 2 实现热部署？

我已经设置了一个单独的模块来将可热部署的类文件部署到 WEB-INF/dev/，但它仍然作为一个大块部署。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T23:11:54.910

使用 Intellij-IDEA 和 Jboss 进行热部署的步骤：（这是假设您的 WAR 项目已经从展开的目录成功部署）

1.  创建一个新模块并将您的热源文件夹移动到其中。
2.  打开您的主模块设置并将您的新热模块添加为新的依赖项。
3.  打开主模块的 web-facet，然后在要打包的模块和库中单击“添加”、“添加模块”。将其“输出相对路径”更改为 WEB-INF/dev
4.  编辑您的运行配置并启用“在帧停用时构建”。
5.  运行服务器。

现在，每当您从 IDEA 中按 alt-tab 键时，您的视图和接缝 POJO 控制器都会自动重新部署。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-04-17T02:15:01.873

我使用插件进行热部署。

*   下载 JReable 并安装它。
*   重启智能。

**注意：**插件是收费的。

# c# - 在 ASP.NET 2.0 中管理设置（配置）的最佳方式是什么？

> ID：690678
> 
> 赞同：2
> 
> 时间：2009-03-27T17:18:30.703
> 
> 标签：c#, asp.net, settings

我有一个项目，我们正在将一些功能从现有客户端扩展到 ASP.NET 2.0 中的 Web 门户。客户端是基于 Windows 窗体的（在 .NET 2.0 中）。它有一些设置保存在 Project > Properties > Settings.settings 系统中，包括生成的 settings.Designer.cs 文件。该文件为每个设置提供了很好的自动包装器。

在尝试建立网站时，我对这个功能明显缺乏平等感到沮丧。我有一个 web.config，它可以有一个部分。这意味着通过带有字符串的代码进行访问，例如：

```
WebConfigurationManager.AppSettings["mySetting"]; 
```

我什至可以通过这种方式让设置引用另一个文件，提供一点抽象，并且更容易签入源代码控制：

```
<appSettings configSource="web.settings.config"/> 
```

但最终这缺乏客户端项目设置系统的一些功能。

特别是如果可能的话，我非常喜欢这些功能：

*   自动生成的访问器类（为了方便，智能感知..）
    *   方便的
    *   强类型
    *   提供智能感知
    *   代码不会针对设置名称中的拼写错误/错误进行编译
*   简单的界面
    *   之前的 settings.Settings 提供了一个不错的网格
    *   代表的所有选项
    *   显示某些选项的下拉选项
    *   不必编辑 XML
    *   不能指尖尖括号

我知道可以创建一个包装这些的类，但它不会自动与设置保持同步，并且必须在任何更改时手动编辑。然而，它将提供上述一些。

我可以像我们在客户中所做的那样与项目设置保持一致吗？

管理 ASP.NET 2.0 网站设置的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T17:33:32.073

您应该使用 Web 应用程序，而不是网站，并且您可以像 Windows 应用程序一样访问设置

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T17:55:18.090

默认情况下，使用 web.config 中的 appSettings 部分是管理 Web 应用程序设置的最简单方法。您可以根据需要在应用程序设置中转换值。但是，在这种情况下，您将失去强类型，这对您来说听起来像是破坏交易。

如果您确实需要保留强类型，请进入项目设置（类似于 WinForms 应用程序）并在那里设置您的值。您会注意到 settings.settings 文件存在于 MyProjects 文件夹中，但您还会在 web.config 文件的底部找到以下代码片段（从我的一个应用程序中滑动）：

```
<applicationSettings>
   <EAF.My.MySettings>
      <setting name="EAF_AS400EmployeeServices_EmployeeServices" serializeAs="String">                                          
      <value>http://countynetappsdev/AS400DataService/EmployeeServices.asmx</value>
  </setting>
</applicationSettings> 
```

请注意本节中的 serializeAs 属性。一旦掌握了本节中的内容，就可以使用 VB.NET 通过 My.Settings 库访问设置。但是，由于您使用的是 C#，因此您需要做更多的工作，但可以在[此处](http://www.knowdotnet.com/articles/accessappconfigfromdll.html)找到一个简单的代码解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T17:59:03.027

我创建了包装我的 web.config 的类，以提供对设置的强类型、智能感知友好访问。

此外，支持人员在实施时最有可能在 XML 中更改设置，因此 VS 中的网格没有区别。当然，它不是自动生成的，但复制/粘贴是你的朋友:)

# sql-server - 如何从另一个存储过程中执行 SQL 存储过程？

> ID：690680
> 
> 赞同：1
> 
> 时间：2009-03-27T17:19:24.587
> 
> 标签：sql-server, tsql, stored-procedures

每次我用备份文件刷新我的数据库。我必须单独运行大约 10 个存储过程，因为备份文件不包含它们。

有没有办法让一个 sql 脚本引用所有这 10 个存储的过程，并且只运行一个文件而不是 10 个文件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-27T17:31:02.173

这不检查任何错误..

```
CREATE PROCEDURE RUN_ALL
AS 

SET NOCOUNT ON

EXEC YourProcedureA

EXEC YourProcedureB

EXEC YourProcedureC

RETURN 0
GO 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T07:12:16.463

我所做的是创建一个批处理文件，该文件使用 isql 命令行调用在特定文件夹中执行所有 SQL 脚本。批处理文件简单地遍历文件夹中的所有文件并执行脚本。此过程的优点是还能够生成脚本结果的输出文件以供参考。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:24:03.127

如果您询问是否可以编写引用本地文件系统中文件的 SQL 脚本，那么不能。但是，您可以创建一个脚本文件，将创建脚本组合成单独的批次，或者使用外部批处理工具（如 SQL 命令行）批量运行这些脚本文件。

# javascript - ajax分页后点击事件不起作用

> ID：690687
> 
> 赞同：2
> 
> 时间：2009-03-27T17:20:40.373
> 
> 标签：javascript, jquery

我真的希望有人可以帮助解决这个问题。我有一个 ajax 分页脚本，它在第一页上效果很好，但点击事件在分页中的任何其他页面上都不起作用。

这就是我的设置方式：

jQuery 脚本

```
<script type="text/javascript">
// prepare when the DOM is ready 
$().ready(function() {
//popup div
$(".wsbutton_pop").click(function(e){ 
//getting height and width of the message box

      var height = $('#popuup_div').height();
      var width = $('#popuup_div').width();
      //calculating offset for displaying popup message
      leftVal=e.pageX-(width/2)+"px";
      topVal=e.pageY-(height/2)+"px";
      //show the popup message and hide with fading effect
      $('#popuup_div').css({left:leftVal,top:topVal}).show();
      $('#popuup_div').html("<img src='images/ajaximg.gif' border='0'>");

       $.ajax({ 
          type: "get", 
          url: $(this).attr("href"), 
          success: function(r){ 
           $('#popuup_div').html("")   
           $('#popuup_div').prepend(r);
             }
     });

  });

//close div on mouse click

$(".popup_msg").click(function(e){ 
      $('#popuup_div').fadeOut();
  }); 

}); 
</script> 
```

这应该会弹出一个 div，其中包含来自另一个页面的内容。

现在我的链接： `<a href="http://mysite.com/file.php?content=1" class="wsbutton_pop">Load content</a>`

这在初始页面上效果很好，但现在的问题是当我单击访问具有完全相同链接的第 2 页时，该链接不再起作用。

请注意，我的页面应该加载到 id="paging" 的 div 中。ajax 分页本身工作得很好，只是结果页面上的任何 jquery 点击事件都不起作用。我认为问题可能是我需要重新绑定脚本，但我不知道如何完成。

感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T17:28:20.493

我猜您正在用分页覆盖链接，因此不再绑定单击事件。如果您使用的是 jquery 1.3，则可以使用[实时事件](http://docs.jquery.com/Events/live)来解决此问题。

```
$(".wsbutton_pop").live("click", function(e) { ... 
```

或者，如果您使用的是早期版本的 jQuery，您可以在获取新页面数据时重新附加事件处理程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T17:30:00.740

您对重新绑定脚本是正确的。原因是页面上的元素在 ajax 回发期间被重新创建。

如果您使用的是 jQuery 1.3 或更高版本，您可以像这样使用实时事件（点击）：

```
$(".wsbutton_pop").live("click", function(e){ 
    ...
}); 
```

请注意，实时事件不适用于以下事件：change、blur、focus、mouseenter、mouseleave 和 submit。

如果您不使用 jQuery 1.3，或者您需要使用上述事件之一，则应遵循以下文章中的建议以避免内存泄漏： [代码项目文章](http://www.codeproject.com/KB/ajax/jqmemleak.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T17:28:12.820

根据您的描述，听起来您正在生成一个包含 .wsbutton_pop 的新页面。如果是这种情况，您需要将 onclick 功能附加到它。您的初始脚本仅在首次加载时运行，因此注册仅适用于当时存在的 .wsbutton_pop。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:30:45.310

您只绑定了最初的 .wsbutton_pop 元素。如果这些被删除，并且类 .wsbutton_pop 的新元素被添加，它们将不会自动接收您一次连接的单击事件处理程序。

你正在寻找的是

```
$(".wsbutton_pop").live("click", function(e) {...}); 
```

这将适用于当前页面上的所有 .wsbutton_pop 实例，以及任何被创建的实例。

-=-=-=-=-=-=-=-=-=-

当我写这篇文章时，其他答案出现了，我想说如果我们得到 Brian Fisher 的帖子和 Jimmie R. Houts 的混搭，我们会有最好的答案，并且可能会提到只有当前在 DOM 中的元素才会收到使用 $(..).click(...) 时的事件处理程序

# python - Django：管理员的永久链接

> ID：690688
> 
> 赞同：0
> 
> 时间：2009-03-27T17:20:51.073
> 
> 标签：python, django, django-admin, reverse, permalinks

我知道到达对象的链接模板如下所示：

```
"{{ domain }}/{{ admin_dir }}/{{ appname }}/{{ modelname }}/{{ pk }}" 
```

有没有内置方法来获取对象的永久链接？

```
from django.contrib import admin

def get_admin_permalink(instance, admin_site=admin.site):
    # returns admin URL for instance change page
    raise NotImplemented 
```

### 编辑

似乎在 v1.1[`admin`中已命名 URLs](http://www.codekoala.com/blog/2009/feb/24/pluggable-django-apps-and-djangos-admin/)。不幸的是，它还没有发布。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-11T00:06:51.233

1.1 出来了，文档就在这里： http: [//docs.djangoproject.com/en/dev/ref/contrib/admin/#admin-reverse-urls](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#admin-reverse-urls) [http://docs.djangoproject.com/en/dev/参考/模板/内置/#url](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#url)

我也使用了一点，每当您获取现有的管理 url 时，都必须指定管理命名空间。

```
# in urls.py, assuming you have a customized view
url(r'foo/$', 'foo', name='foo_index'),

# in the template, to get the admin url
{% url admin:foo_index %} 
```

在 1.1 中，每当获取管理 URL 时，您都必须指定“管理”命名空间。

# c# - 什么时候使用代码块？

> ID：690711
> 
> 赞同：4
> 
> 时间：2009-03-27T17:27:42.210
> 
> 标签：c#, .net, coding-style, codeblocks, curly-braces

你什么时候在 C/C++/C# 等中使用代码块？我知道它们背后的理论原因，但是你什么时候在实际程序中使用它们呢？

**编辑**：我刚刚意识到我在`switch`语句中使用它们，否则变量将在同一范围内（grr 用于类似的东西`i`）：

```
switch (x) { case "abc": { /* code */ } break; } 
```

等（为了澄清，在 switch 语句中，不需要额外的大括号*。*）

* * *

有关的：

*   [您是否使用花括号进行额外的范围界定？（https://stackoverflow.com/questions/249009/do-you-use-curly-braces-for-additional-scoping）](https://stackoverflow.com/questions/249009/do-you-use-curly-braces-for-additional-scoping)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T17:59:35.317

I sometimes, but rarely, use naked code blocks to limit scope. For example, take the following code:

```
double bedroomTemperature = ReadTemperature(Room.Bedroom);
database.Store(Room.Bedroom, bedroomTemperature);

double bathroomTemperature = ReadTemperature(Room.Bathroom);
database.Store(Room.Bedroom, bedroomTemperature); 
```

The code looks fine at first glance, but contains a subtle copy-pasta error. In the database we have stored the bedroom temperature for both readings. If it had been written as:

```
{
    double bedroomTemperature = ReadTemperature(Room.Bedroom);
    database.Store(Room.Bedroom, bedroomTemperature);
}

{
    double bathroomTemperature = ReadTemperature(Room.Bathroom);
    database.Store(Room.Bedroom, bedroomTemperature);
} 
```

Then the compiler (or even IDE if it is intelligent enough) would have spotted this.

However, 90% of the time the code can be refactored to make the naked blocks unnecessary, e.g. the above code would be better written as a loop or two calls to a method that reads and stores the temperature:

```
foreach (Room room in [] { Room.Bedroom, Room.Bathroom })
{
    double temperature = ReadTemperature(room);
    database.Store(room, temperature);
} 
```

Naked blocks are useful on occasion though.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T17:32:22.217

我对开关块做同样的事情，即使它不是必需的。一般来说，我使用代码块，它们要么使代码更具可读性（无论是通过为相似的代码块提供相似的外观还是仅仅获得缩进），或者它们正确地作用域变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:31:03.983

`finally`您可以通过使用代码块和 RAII 对象在 C++中获得类似的行为。

```
{
   std::fstream f(filename)
   ...
} 
```

无论是什么导致我们离开块，都会在析构函数中释放文件描述符。

（就我个人而言，我仍在努力实践这一点。我的 c 根牢牢地抓住了我的习惯......）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:31:07.210

除了显而易见的（“当语法需要时”，例如在 switch 或 try catch finally 中）之外，
每当您需要将 2 个或更多语句的块视为一个原子单元时

# nhibernate - 使用 Fluent NHibernate 的自动映射的“具有具体类的表”映射

> ID：690714
> 
> 赞同：0
> 
> 时间：2009-03-27T17:28:05.830
> 
> 标签：nhibernate, fluent-nhibernate

有人是否可以将 Fluent NHibernate 配置为使用“具有具体类的表”继承自动映射对象。在查看自动映射（我已写入文件）时，我有许多从 EntityBase 派生的实体，但我希望 Id 列位于每个表上而不是 EntityBase 表上。

```
<class name="EntityBase" table="EntityBase" xmlns="urn:nhibernate-mapping-2.2">
    <id name="Id" type="Int32" column="EntityBaseID">
      <generator class="identity" />
    </id>
    <joined-subclass name="CategoryType, ..., Version=1.0.0.0, Culture=neutral, PublicKeyToken=null">
      <key column="EntityBaseId" />
      <property name="CategoryTypeGUID">
        <column name="CategoryTypeGUID" />
      </property>
    </joined-subclass>
</class> 
```

我搜索了 Fluent 文档，但看不到与此相关的任何内容。

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T21:54:24.957

您是否在自动映射中设置了`IsBaseType`约定？这个特定的约定定义了在您的代码中被视为简单基类的东西，而不是被视为实体继承层次结构的一部分的东西。

```
AutoPersistenceModel
  /* regular config */
  .WithSetup(s =>
    s.IsBaseType = (type => type == typeof(EntityBase))); 
```

# python - 将所有错误记录到控制台或 Django 站点上的文件

> ID：690723
> 
> 赞同：15
> 
> 时间：2009-03-27T17:30:45.090
> 
> 标签：python, django, facebook

在调试模式下运行 runserver 时， 如何让 Django 1.0 将**所有错误写入控制台或日志文件？**

我尝试使用带有 process_exception 函数的中间件类，如该问题的接受答案中所述：

[你如何在 django 网站上记录服务器错误](https://stackoverflow.com/questions/238081/how-do-you-log-server-errors-on-django-sites)

某些异常会调用 process_exception 函数（例如：views.py 中的 assert(False)），但不会因为 ImportErrors 等其他错误调用 process_exception（例如：urs.py 中的 import thisclassdoesnotexist）。我是 Django/Python 的新手。这是因为运行时错误和编译时错误之间存在一些区别吗？但是我希望 runserver 会抱怨它是否是编译时错误，而事实并非如此。

我看过 Simon Willison 关于 Django 调试的精彩演示（[http://simonwillison.net/2008/May/22/debugging/](http://simonwillison.net/2008/May/22/debugging/)），但我没有看到适合我的选项。

万一它是相关的，我正在编写一个 Facebook 应用程序，Facebook 用他们自己的消息掩盖 HTTP 500 错误，而不是显示 Django 信息丰富的 500 页面。所以我需要一种将**所有**类型的错误写入控制台或文件的方法。

**编辑：**我想我的期望是，当我在 urls.py 中有错误的导入 (ImportError) 时，如果 Django 可以返回一个包含大量详细信息的 500 错误页面，它应该能够将相同的详细信息写入控制台或没有的文件必须在代码中添加任何额外的异常处理。我从未见过围绕 import 语句的异常处理。

谢谢，杰夫

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T19:51:37.123

有点极端，不过为了调试，可以开启[`DEBUG_PROPAGATE_EXCEPTIONS`](http://docs.djangoproject.com/en/dev/ref/settings/#debug-propagate-exceptions)设置。这将允许您设置自己的错误处理。设置上述错误处理的最简单方法是覆盖[sys.excepthook](http://docs.python.org/library/sys.html#sys.excepthook)。这将终止您的应用程序，但它会起作用。您可能可以采取一些措施来使其不会杀死您的应用程序，但这将取决于您为其部署的平台。无论如何，永远不要在生产中使用它！

对于生产，您几乎必须进行广泛的错误处理。我使用的一种技术是这样的：

```
>>> def log_error(func):
...     def _call_func(*args, **argd):
...         try:
...             func(*args, **argd)
...         except:
...             print "error" #substitute your own error handling
...     return _call_func
...
>>> @log_error
... def foo(a):
...     raise AttributeError
...
>>> foo(1)
error 
```

如果您在视图上使用 log_error 作为装饰器，它将自动处理其中发生的任何错误。

> 进程`_`异常函数会为某些异常调用（例如：views.py 中的 assert(False)），但`_`不会为其他错误（例如 ImportErrors）调用进程异常（例如：在 urs.py 中导入 thisclassdoesnotexist）。我是 Django/Python 的新手。这是因为运行时错误和编译时错误之间存在一些区别吗？

在 Python 中，所有错误都是运行时错误。这导致问题的原因是，在调用视图之前导入模块时，这些错误会立即发生。我发布的第一种方法将捕获此类错误以进行调试。您可能能够为生产解决一些问题，但我认为如果您在生产应用程序中遇到 ImportErrors（并且您没有进行任何动态导入），您会遇到更严重的问题。

不过，像[pylint](http://www.logilab.org/857)这样的工具可以帮助您消除这些问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-30T04:53:02.687

> 某些异常会调用 process_exception 函数（例如：views.py 中的 assert(False)），但不会因为 ImportErrors 等其他错误调用 process_exception（例如：urs.py 中的 import thisclassdoesnotexist）。我是 Django/Python 的新手。这是因为运行时错误和编译时错误之间存在一些区别吗？

不，这只是因为[process_exception 中间件仅在视图中引发异常时才被调用](http://docs.djangoproject.com/en/dev/topics/http/middleware/?#process-exception)。

我认为[DEBUG_PROPAGATE_EXCEPTIONS](http://docs.djangoproject.com/en/dev/ref/settings/#debug-propagate-exceptions)（正如 Jason Baker 首先提到的）是你在这里需要的，但我认为你不需要做任何额外的事情（即 sys.excepthook 等），如果你只想将回溯转储到控制台。

如果你想对错误做任何更复杂的事情（即将它转储到文件或数据库），最简单的方法是[got_request_exception 信号](http://docs.djangoproject.com/en/dev/ref/signals/#got-request-exception)，Django 为任何与请求相关的异常发送该信号，无论它是否在视图中引发。

django.core.handlers.BaseHandler的[get_response](http://code.djangoproject.com/browser/django/trunk/django/core/handlers/base.py#L66)和[handle_uncaught_exception](http://code.djangoproject.com/browser/django/trunk/django/core/handlers/base.py#L136)方法是该领域的指导性（和简短）阅读。

> 无需向代码添加任何额外的异常处理。我从未见过围绕 import 语句的异常处理。

再看看周围，你会看到它完成了（通常在你想以某种特定方式处理缺少依赖的情况下）。也就是说，如果您必须在整个代码中添加额外的 try-except 块以对异常处理方式进行全局更改，那当然会非常难看！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T18:51:16.193

首先，通过异常日志可以看到的编译时错误非常少。如果你的 Python 代码没有有效的语法，它会在日志被打开写入之前很久就死掉了。

在 Django 运行服务器模式下，“打印”语句写入标准输出，您可以看到。然而，这不是一个好的长期解决方案，所以不要指望它。

但是，当 Django 在 Apache 下运行时，这取决于您使用的是哪个插件。mod_python 不容易处理。可以强制 mod_wsgi 将 stdout 和 stderr 发送到日志文件。

但是，您最好的选择是[日志记录](http://www.python.org/doc/2.5.2/lib/module-logging.html)模块。将初始化放入顶层`urls.py`以配置日志记录。（或者，也许，你的`settings.py`）

确保每个模块都有一个可用于写入日志消息的记录器。

确保您进行的每个 Web 服务调用都有一个 try/except 块，并将异常写入日志。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-13T05:24:22.497

[http://groups.google.com/group/django-nashville/browse_thread/thread/b4a258250cfa285a?pli=1](http://groups.google.com/group/django-nashville/browse_thread/thread/b4a258250cfa285a?pli=1)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-28T22:03:55.627

如果你在 *nix 系统上，你可以

在 python 中写入日志（例如 mylog.txt），然后在控制台中运行“tail -f mylog.txt”

这是一种近乎实时查看任何类型日志的便捷方式

# javascript - 使用 JavaScript 调用 Flash ExternalInterface

> ID：690730
> 
> 赞同：1
> 
> 时间：2009-03-27T17:32:28.253
> 
> 标签：javascript, flash, actionscript-3, actionscript

我正在尝试使用 JavaScript 在 Flash swf 中调用使用 ExternalInterface 声明的函数。它曾经工作过，但突然之间，它停止了工作。

我有 Flash Player 的调试版本，但在 Flash 中没有出现错误。甚至没有“安全沙盒错误”之类的。我得到的唯一错误是 JavaScript 中的以下错误`Error: Error in Actionscript. Use a try/catch block to find error.`

我正在使用 AS3，为 Flash Player 10 导出并在 Mac 上的 Firefox 3/Safari 4 上进行测试。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T19:36:51.277

查看[ExternalInterface.marshallExceptions](https://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/external/ExternalInterface.html#marshallExceptions)。它应该允许您查看有关错误的更多详细信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T17:42:17.417

帮助您解决“曾经有效”的问题有点棘手。但是使用 ExternalInterface 非常简单——这就是我所做的：

在 AS3 中：类似

```
...
if (ExternalInterface.available) ExternalInterface.addCallback("search", jsSearch);
...
private function jsSearch(term:String):void 
{
    new Search(data);
} 
```

在 JS 中：类似

```
...
var term = $('input#search').val();
$("#swfobject").get(0).search(term);
.... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-29T01:45:00.870

*   确保 javascript 和 SWF 在同一个域上，否则使用**crossdomain.xml**
*   确保您已将**allowScriptAccess**参数添加到 Flash 嵌入
*   如果您在本地运行它，您可以（但不认为它会改变任何东西）将该位置添加到 Flash 播放器受信任的播放器（在安全面板中）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-29T02:05:48.573

在你的 as

```
import flash.external.*;
ExternalInterface.call("return_me_some_value()"); 
```

在你的 html 中

```
<script>
var super_var = 'something';

function return_me_some_value() {
  return super_var;
}
</script> 
```

# sql - MS Access 查询：为什么从 VB6 应用程序调用 LIKE 时表现不同？

> ID：690731
> 
> 赞同：2
> 
> 时间：2009-03-27T17:32:31.327
> 
> 标签：sql, ms-access, vb6

我没有用 VB6 做很多编码，但我现在正在更新一个现有的应用程序，只是遇到了一个障碍。

我解决了这个问题。在 VB6 中，查询使用**LIKE**时必须使用**%** **通配符**，但在 MS Access 中，您必须使用 *******通配符**。

 ****我正在查询同一个数据库 - （它在 MS Access 中）。

从 MS Access 中查询时，以下查询有效：

```
SELECT * FROM table WHERE field LIKE '*something*' 
```

当我在 VB6 中构建该查询时，我必须这样做：

```
SELECT * FROM table WHERE field LIKE '%something%' 
```

发生了什么？这正常吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T17:38:22.920

Access 曾经有自己不兼容的 SQL 版本，所以我认为它使用 * 是出于遗留原因。

当您使用 VB6 时，您通常使用 ODBC 和更标准化的 SQL，因此更常见的通配符适用。请记住，VB6 并不关心您使用哪个数据库，因此如果您使用其他东西（例如，SQL 服务器），它可能只会理解百分比符号。

我猜 Access-ODBC 连接器会为您转换东西。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-27T17:46:32.010

默认情况下，Access 将使用 ANSI-89 通配符的子集，VB6，通过 ADO 连接将使用 ANSI-92。

[算子比较](http://oit.osu.edu/shortcourse/office2007/access_operators.htm)

[更改 Access 使用的模式](http://office.microsoft.com/en-us/access/HP030704831033.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-28T01:19:44.730

我不知道这是否适用于 VB6，但在 Access 中，您可以使用

```
ALIKE '%something%' 
```

并且 % 字符将被视为通配符，无论您是使用带有 DAO 或 ADO 的 VBA，还是在查询编辑器中创建查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:38:16.897

我从未见过将星号字符用作 like 语句的通配符（仅在其他任何地方）——一般来说，百分号是您需要使用的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T17:39:27.550

是的，这很正常。

我认为这是 DAO（Access 内部使用的内容）和 ADO（VB6 用来与 Access 对话的内容）之间的区别。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-29T17:57:55.587

是的，您可以在 Jet 4.0 OLE DB 查询中使用 ALIKE（即从 VB6 使用 ADO）：

```
JeTTY version 0.5.68
>open booksale.mdb;
#Opened database booksale.mdb (Jet3X "97")
>select * from authors where author like "ba*";
#No rows to display
>select * from authors where author like "ba%";
               Page 1 of 1
Au_ID Author     Year Born
───── ────────── ─────────
10    Bard, Dick 1941
>select * from authors where author alike "ba%";
               Page 1 of 1
Au_ID Author     Year Born
───── ────────── ─────────
10    Bard, Dick 1941
> 
```

当然，您获得了与 Access 的兼容性，但随后*失去了*对 ANSI SQL-92 的兼容性，以便以后升级到 SQL Server 等，最终为自己做更多的工作。

# javascript - jQuery动态调用函数的问题

> ID：690736
> 
> 赞同：2
> 
> 时间：2009-03-27T17:35:03.537
> 
> 标签：javascript, jquery

```
for(n=0;n < 20;n++){
     $('#button' + n).click(function () { newAction(n); });
}

function newAction(x){
     alert(x);
} 
```

这段代码的问题是，当我按下按钮时，他们的点击动作不知何故与他们的号码无关，所以通过按下 button5 我可能会得到警报 6 或类似的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T17:54:40.057

This looks weird but this would be more appropriate way to create the closure so you can access the loop-scope variable per iteration...

```
 for(var n = 0; n < 20; n++) {
    $('#button' + n).click((function(i) {
      return function(e) { newAction(i) }
    })(n));
  }

  function newAction(x){
    alert(x);
  } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T18:06:57.453

[幸运先生](https://stackoverflow.com/questions/690736/problem-with-jquery-dynamically-calling-functions/690815#690815)走在正确的轨道上，但我发现他的例子有点难以阅读。

```
function button_bind( num ){ 
     $("#button" + num ).click(function(){
         newAction(num);
     });
}

for(var n = 0; n < 20; n++) {
     button_bind(n);
}

function newAction(x){
     alert(x);
} 
```

这应该可以解决您的范围界定问题。

以上可以转换为内联：

```
for(var n = 0; n < 20; n++) {

     (function(num){ 

        $("#button" + num ).click(function(){
         newAction(num);
        });

     })(n);

}

function newAction(x){
     alert(x);
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-27T17:54:34.690

i can think of easier ways to do what you are trying, but this'll work for you:

EDIT: Sorry i thought it was clear i was supplying a replacement for the line inside your loop. Here the entire functioning program

EDIT 2: Okay here's the outer $(document).ready() wrapper also that isn't even in the original question. This has been tested. this works. Even on 1.3+ .. It's the best answer given.

I've put up a functioning version of this program you can try out by [**visiting here**](http://enjoy3d.com/690736.html)

```
$(function() {
  for (n = 0; n < 20; n++){
    $('#button' + n).bind('click', n, function (e) { newAction(e.data); });
  }

});

function newAction(x){
  alert(x);
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-27T17:40:11.090

尝试以下操作：

```
for(n=0;n < 20;n++){
     $('#button' + n).click(function (n) { newAction(n); });
}

function newAction(x){
     alert(x);
} 
```

原因是关闭。当您不将 n 与匿名函数一起传递时，javascript 会在其自己的范围和父范围中查找变量。父作用域有一个'n'，但这个n 是for 循环后n 的值。通过传递 n，您可以在函数范围内创建一个新的 n，并且在 for 循环运行时不会更改此 n。

# .net - 是否应该将“Action”委托重构为新方法？

> ID：690738
> 
> 赞同：1
> 
> 时间：2009-03-27T17:35:13.160
> 
> 标签：.net, generics, refactoring

我有以下方法

```
 private void SetProcessDocumentStatus(string status)
    {
        var setStatusWith = new Action<string>(
            statusValue => processDocumentStatusLabel.Text = statusValue);
        if (processDocumentStatusLabel.InvokeRequired)
            processDocumentStatusLabel.Invoke(
                (MethodInvoker)(() => setStatusWith(status)));
        else
            setStatusWith(status);
    } 
```

从上面的代码中，我将 action 封装到`setStatusWith`. 是否应该将该操作重构为另一种方法，如下所示？

```
 private void SetProcessDocumentStatusWith(string status)
    {
        processDocumentStatusLabel.Text = status;
    }

    private void SetProcessDocumentStatus(string status)
    {
        if (processDocumentStatusLabel.InvokeRequired)
            processDocumentStatusLabel.Invoke(
                (MethodInvoker)(() => SetProcessDocumentStatusWith(status)));
        else
            SetProcessDocumentStatusWith(status);
    } 
```

我想知道是否应该在代码中谨慎使用“Action”委托。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T17:47:54.957

你所拥有的对我来说似乎非常清楚。将 lambda 移动到单独的函数会增加代码行，但不清晰。

我可能会将第一行写为：

```
 Action<string> setStatusWith = 
    statusValue => processDocumentStatusLabel.Text = statusValue; 
```

但我不知道通常首选哪种方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T20:24:24.407

在示例中，您使操作接受一个参数：`Action<string>`但您只传递相同的参数，即`status`. 所以它不需要接受参数——也许你不知道 lambda 捕捉变量的能力？

```
private void SetProcessDocumentStatus(string status)
{
    Action setStatusWith = () => processDocumentStatusLabel.Text = status;

    if (processDocumentStatusLabel.InvokeRequired)
        processDocumentStatusLabel.Invoke(() => setStatusWith());
    else
        setStatusWith();
} 
```

或者调整艾伦杰克逊的优秀答案：

```
private void SetProcessDocumentStatus(string status)
{
    processDocumentStatusLabel.Run(ctrl => ctrl.Text = status);
}

public static class ControlExtensions
{
    public static void Run<T>(this TControl control, Action<TControl> action)
        where TControl : Control
    {
        if (control.InvokeRequired)
            control.Invoke(() => action(control));
        else
            action(control);
    }
} 
```

在这里，我使 Action 将控件作为参数。另外我已经将辅助方法变成了一个扩展，这似乎是合理的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:49:01.817

使用 Action 委托本身并没有错。我要说在这里应该有两个单独的方法的唯一原因是，如果您觉得需要绕过检查以查看 InvokeRequired 属性是否为 true 并且必须对调用进行编组。但是，我认为没有明确的理由这样做。

就个人而言，我认为检查 InvokeRequired 然后编组对自身的调用的代码是一个坏主意。我更喜欢调用者必须了解他们所处的环境（是否是 UI 线程），然后决定是否编组调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T18:39:23.710

如果有的话，我会包装逻辑以在函数中执行调用，因为这是将被多次使用的逻辑（基本上所有可以设置为异步的函数）。

```
 private void SetProcessDocumentStatus(string status)
    {
        RunOnControl<string>(
            processDocumentStatusLabel, 
            statusValue => processDocumentStatusLabel.Text = statusValue,
            status);
    }

    private void RunOnControl<T>(Control control, Action<T> action, T param)
    {
        if (control.InvokeRequired)
            control.Invoke(action, param);
        else
            action(param);
    } 
```

# delphi - 无论本地时区如何，都将 TDateTime 转换为另一个时区

> ID：690739
> 
> 赞同：4
> 
> 时间：2009-03-27T17:35:32.160
> 
> 标签：delphi, timezone

无论用户的本地时区设置为什么，使用 Delphi 2007，我都需要确定东部时区的时间 (TDateTime)。

我怎样才能做到这一点？当然，需要注意夏令时。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-04T23:43:36.170

如果我理解正确，您需要与当前系统时间等效的东部时间。

为此，请使用 WiNAPI 函数`GetSystemTime()`以 UTC 格式获取计算机的当前时间。UTC 独立于时区，始终为您提供本初子午线的时间。

然后，您可以使用 WinAPI 函数`SystemTimeToTzSpecificLocalTime()`从 UTC 时间计算任何其他给定时区的本地时间。为了`SystemTimeToTzSpecificLocalTime()`使它起作用，您需要为其提供一条`TTimeZoneInformation`记录，其中填充了您要转换到的时区的正确信息。

根据 2005 年能源政策法案，以下示例将始终为您提供东部时间的当地时间。

```
function GetEasternTime: TDateTime;
var
  T: TSystemTime;
  TZ: TTimeZoneInformation;
begin
  // Get Current time in UTC
  GetSystemTime(T);

  // Setup Timezone Information for Eastern Time
  TZ.Bias:= 0;

  // DST ends at First Sunday in November at 2am
  TZ.StandardBias:= 300;
  TZ.StandardDate.wYear:= 0;
  TZ.StandardDate.wMonth:= 11; // November
  TZ.StandardDate.wDay:= 1; // First
  TZ.StandardDate.wDayOfWeek:= 0; // Sunday
  TZ.StandardDate.wHour:= 2;
  TZ.StandardDate.wMinute:= 0;
  TZ.StandardDate.wSecond:= 0;
  TZ.StandardDate.wMilliseconds:= 0;

  // DST starts at Second Sunday in March at 2am
  TZ.DaylightBias:= 240;
  TZ.DaylightDate.wYear:= 0;
  TZ.DaylightDate.wMonth:= 3; // March
  TZ.DaylightDate.wDay:= 2; // Second
  TZ.DaylightDate.wDayOfWeek:= 0; // Sunday
  TZ.DaylightDate.wHour:= 2;
  TZ.DaylightDate.wMinute:= 0;
  TZ.DaylightDate.wSecond:= 0;
  TZ.DaylightDate.wMilliseconds:= 0;

  // Convert UTC to Eastern Time
  Win32Check(SystemTimeToTzSpecificLocalTime(@TZ, T, T));

  // Convert to and return as TDateTime
  Result := EncodeDate(T.wYear, T.wMonth, T.wDay) + 
   EncodeTime(T.wHour, T.wMinute, T.wSecond, T.wMilliSeconds);
end;

procedure TForm1.Button1Click(Sender: TObject);
begin
  Label1.Caption:= 'In New York Citiy, it is now ' + DateTimeToStr(GetEasternTime);
end; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T20:27:01.193

TDateTime 没有任何时区信息（它只是一个双日期作为整数，时间作为十进制），因此您需要单独使用。您还需要自己的 DST 逻辑，我不相信 Delphi 中有任何逻辑。然后使用 DateUtils.pas 中的 IncHour 函数将 TDateTime 更改为东部时区。

可能有一些 Web 服务可以为您执行此操作。您的应用程序是否需要自包含，或者它可以连接到网络来完成它？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T20:28:49.720

具体来说，`TDateTime`不是`object`，它只是`double`.

# vb.net - 显示时 DataGridView 未完全绘制

> ID：690742
> 
> 赞同：1
> 
> 时间：2009-03-27T17:36:28.040
> 
> 标签：vb.net, datagridview

我有一个在两个不同位置使用 DataGridView 的应用程序。在一个位置，DataGridView 显示一切正常。在另一个位置，每当最初加载包含 DataGridView 的表单时，实际上只绘制了大约一半的 DataGridView 可见部分；通过其余的DataGridView，可以看到底层的windows图形；如果您向下滚动浏览其余数据，您会看到与向下滚动的每一行向上滚动对应的内容的断断续续的视图。让 DataGridView 显示正确值的唯一方法是选择一个单元格，强制重绘该特定单元格；或使窗口的某个区域无效，导致该区域重绘（它确实正确）。

我已经比较了每个 DataGridView 的设置方式：对于运行良好的，DataGridView 静态绑定到 BindingSource，后者静态绑定到 DataSet；有绘制问题的一个静态绑定到绑定源，该绑定源在创建表单期间*动态*绑定到 DataTable。

什么可能导致我的 DataGridView 无法正确显示？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-22T15:02:48.763

有一种透明的颜色是为了让图形引擎知道绘制某物背后的东西而保留的

您是否更改了表单或 datagridview 的背景色或前景色属性？也许是与透明色的碰撞？有没有在运行时或设计时更改颜色的地方？

您是否尝试过删除 datagridview 并重新添加它？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-09-01T09:00:03.033

`AutoSizeColumnsMode`将 的属性更改`DataGridView`为`Fill`。

# php - 何时以及如何在 PHP (PDO) 中使用多个 MySQL 查询

> ID：690744
> 
> 赞同：5
> 
> 时间：2009-03-27T17:37:01.470
> 
> 标签：php, mysql, pdo

除了最小化代码之外，在一个语句中使用多个 MySQL 查询有什么好处。

您如何使用 PHP（最好是 PDO）执行、检索和显示在一条语句中发送的多个 MySQL 查询的结果。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-27T18:10:36.367

mysql_query() 不支持多个查询。但是，有一些解决方法：

[http://www.dev-explorer.com/articles/multiple-mysql-queries](http://www.dev-explorer.com/articles/multiple-mysql-queries)
[http://php.net/function.mysql-query](http://php.net/function.mysql-query)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T18:08:36.497

无论您使用哪个数据库，将多个查询放在一个语句中会更有效。如果单独执行查询，则必须通过网络（或者至少在同一台机器上的进程之间）调用数据库，获取到它的连接（包括验证），传入查询，返回结果集，并为每个查询释放连接。

即使您使用连接池，您仍然需要来回传递更多的请求。

因此，例如，如果您将两个查询合并为一个，则您已经为第二个查询保存了所有来回的额外调用。您组合的查询越多，您的应用程序就会变得越高效。

再举一个例子，许多应用程序在启动时会填充列表（例如下拉列表）。这可以是许多查询。在一个呼叫中执行所有这些可以加快启动时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-23T01:13:30.660

今晚我正在做一些研究，偶然发现了这个线程。上面的答案都没有为这个简单的问题提供可行的解决方案。

使用 OO 方法，您可以使用 multi_query() 方法在单个连接中执行多个查询语句。

```
$db_connection->multi_query($query); 
```

查询应该格式正确并用分号 -> 分隔；

有关如何处理 SELECT 数据的更多详细信息，请参阅[PHP 手册](http://php.net/manual/en/mysqli.quickstart.multiple-statement.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-12T12:50:24.383

当您需要使用会话变量和临时表时，同一调用中的多个查询特别有用：

```
select somecol, @somevar := group_concat( distinct somecol2 separator '|')
from sometbl
where
    somecol LIKE "fueh"
group by somecol;

select somecol2
from  sometbl
where
    somecol LIKE "nyan"
and
    vc_wp regexp concat( '(', @somevar, ')' )
order by somecol; 
```

# objective-c - How to cast an object in Objective-C

> ID：690748
> 
> 赞同：130
> 
> 时间：2009-03-27T17:37:48.990
> 
> 标签：objective-c

Is there a way to cast objects in objective-c much like the way objects are cast in VB.NET?

For example, I am trying to do the following:

```
// create the view controller for the selected item
FieldEditViewController *myEditController;
switch (selectedItemTypeID) {
    case 3:
        myEditController = [[SelectionListViewController alloc] init];
        myEditController.list = listOfItems;
        break;
    case 4:
        // set myEditController to a diff view controller
        break;
}

// load the view
[self.navigationController pushViewController:myEditController animated:YES];
[myEditController release]; 
```

However I am getting a compiler error since the 'list' property exists in the SelectionListViewController class but not on the FieldEditViewController even though SelectionListViewController inherits from FieldEditViewController.

This makes sense, but is there a way to cast myEditController to a SelectionListViewController so I can access the 'list' property?

For example in VB.NET I would do:

```
CType(myEditController, SelectionListViewController).list = listOfItems 
```

Thanks for the help!

* * *

## 回答 #1

> 赞同：228
> 
> 时间：2009-03-27T17:40:34.770

Remember, Objective-C is a superset of C, so typecasting works as it does in C:

```
myEditController = [[SelectionListViewController alloc] init];
((SelectionListViewController *)myEditController).list = listOfItems; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2015-07-18T12:03:26.867

Typecasting in Objective-C is easy as:

```
NSArray *threeViews = @[[UIView new], [UIView new], [UIView new]];
UIView *firstView = (UIView *)threeViews[0]; 
```

However, what happens if first object is not `UIView` and you try to use it:

```
NSArray *threeViews = @[[NSNumber new], [UIView new], [UIView new]];
UIView *firstView = (UIView *)threeViews[0];
CGRect firstViewFrame = firstView.frame; // CRASH! 
```

It will crash. And it's easy to find such crash for this case, but what if those lines are in different classes and the third line is executed only once in 100 cases. I bet your customers find this crash, not you! A plausible solution is to [crash early](https://pragprog.com/the-pragmatic-programmer/extracts/tips), like this:

```
UIView *firstView = (UIView *)threeViews[0];
NSAssert([firstView isKindOfClass:[UIView class]], @"firstView is not UIView"); 
```

Those assertions doesn't look very nice, so we could improve them with this handy category:

```
@interface NSObject (TypecastWithAssertion)
+ (instancetype)typecastWithAssertion:(id)object;
@end

@implementation NSObject (TypecastWithAssertion)

+ (instancetype)typecastWithAssertion:(id)object {
    if (object != nil)
        NSAssert([object isKindOfClass:[self class]], @"Object %@ is not kind of class %@", object, NSStringFromClass([self class]));
    return object;
}

@end 
```

This is *much* better:

```
UIView *firstView = [UIView typecastWithAssertion:[threeViews[0]]; 
```

P.S. For collections type safety Xcode 7 have a much better than typecasting - [generics](https://stackoverflow.com/questions/848641/are-there-strongly-typed-collections-in-objective-c)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-27T17:40:48.903

```
((SelectionListViewController *)myEditController).list 
```

More examples:

```
int i = (int)19.5f; // (precision is lost)
id someObject = [NSMutableArray new]; // you don't need to cast id explicitly 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T17:41:24.270

Sure, the syntax is exactly the same as C - `NewObj* pNew = (NewObj*)oldObj;`

In this situation you may wish to consider supplying this list as a parameter to the constructor, something like:

```
// SelectionListViewController
-(id) initWith:(SomeListClass*)anItemList
{
  self = [super init];

  if ( self ) {
    [self setList: anItemList];
  }

  return self;
} 
```

Then use it like this:

```
myEditController = [[SelectionListViewController alloc] initWith: listOfItems]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-14T04:21:55.407

Casting for inclusion is just as important as casting for exclusion for a C++ programmer. Type casting is not the same as with RTTI in the sense that you can cast an object to any type and the resulting pointer will not be nil.

# sql-server - 如何在导入 SQL Server 2000 的数据库上设置 Windows 身份验证

> ID：690754
> 
> 赞同：0
> 
> 时间：2009-03-27T17:38:55.040
> 
> 标签：sql-server

在 .NET 中创建数据源时无法看到数据库 - 可以看到预先存在的数据库。

如何设置导入数据库的权限？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T17:47:05.550

如果您从另一个 SQL Server 实例导入数据库，则数据库中的用户可能未正确映射到服务器上的登录名。即使它们可能具有相同的名称，SQL Server 也会为每个用户提供该特定服务器的唯一 ID。

[解决此问题的最快方法是使用SQL](http://msdn.microsoft.com/en-us/library/ms173463.aspx)或企业管理器为您的数据库删除并重新创建用户。

# mysql - MySQL 逻辑运算符

> ID：690763
> 
> 赞同：2
> 
> 时间：2009-03-27T17:40:55.160
> 
> 标签：mysql

给定查询`'SELECT foo FROM bar WHERE a = x AND b = y OR c = z'`，它如何解析这个查询？

`(a = x AND b = y) OR c = z`?
`a = x AND (b = y OR c = z)`?

这是一个简单的示例，但是如果您将 AND / OR 与更多搜索词混合并匹配呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T17:43:25.357

(a = x AND b = y) OR c = z

[http://dev.mysql.com/doc/refman/5.0/en/operator-precedence.html](http://dev.mysql.com/doc/refman/5.0/en/operator-precedence.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T17:53:48.187

As already answered, `AND` would have precedence and be parsed first.

I think the answer you're really looking for here is: don't write a query like `SELECT foo FROM bar WHERE a = x AND b = y OR c = z`.

If what you mean is `SELECT foo FROM bar WHERE ((a = x AND b = y) OR c = z)` or you meant to have `SELECT foo FROM bar WHERE (a = x AND (b = y OR c = z))` then write it that way from the beginning.

It will save you having to figure it out when you look at the query again next week (or month, or year) and it will make things easier on future maintainers as well.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T17:44:35.527

AND is higher [precedence](http://dev.mysql.com/doc/refman/5.0/en/operator-precedence.html).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:45:09.113

from the MySQL manual section 11.2.1\. Operator Precedence: [http://dev.mysql.com/doc/refman/5.0/en/operator-precedence.html](http://dev.mysql.com/doc/refman/5.0/en/operator-precedence.html)

AND has precedence over OR. (a = x AND b = y) OR c = z is the equivalent expression.

# datatemplate - 如何同时使用 ControlTemplate 和 DataTemplate 来指定 TabItem

> ID：690764
> 
> 赞同：0
> 
> 时间：2009-03-27T17:41:12.897
> 
> 标签：datatemplate

我需要同时使用 ControlTemplate 和 DataTemplate - 我想。

我有一个 TabControl，它的 TabItems 由 ObservableCollection 提供 - 我可以根据自己的选择设计 ObservableCollection 项目。

TabItems 需要使用 ControlTemplate，因为它们具有选中、未选中和禁用状态，因此它们需要有事件触发器来切换状态 - 选中的标签有一个橙色玻璃按钮，未选中的标签有一个蓝色玻璃按钮. 每个选项卡都需要有一个位于相应玻璃按钮内的图标（图像）以及一个选项卡标签，每个选项卡都不同，由 ObservableCollection 提供。

如果我理解正确，可以使用 ControlTemplate 或 DataTemplate 但不能同时使用同一可视树级别。

我能想到的唯一可能的解决方案是在 TabItem ControlTemplate 中定义一个 ContentPresenter - ContentPresenter（带有图像和标签）将由 DataTemplate 定义，该 DataTemplate 将从 ObservableCollection 接收数据。

我的理解中的任何指示、建议和/或更正将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-17T14:57:40.070

有两个步骤可以做到这一点。

在选项卡控件中，您可以使用 ItemContainerStyle <- 甚至在列表框和项目控件中使用，您可以在其中指定“ContentPresenter”周围的“周围”UI，这可以为您提供状态绑定工具，如启用、选择等。

您也可以继续使用 DataTemplate。您的数据模板将在 Item Container 的 Style 的“ContentPresenter”中呈现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-13T21:48:42.957

您能否更具体一点，您想要实现什么行为？通常，您可以根据绑定的数据项单独设置选项卡标题和选项卡内容的样式。正如您可以轻松推断的那样，itemtemplate 描述了标题，而 contenttemplate 定义了它的内容。下面的示例显示了如何：（包括

```
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
xmlns:sys="clr-namespace:System;assembly=mscorlib" 
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
```

在周围的页面/窗口中）

```
<Grid>
  <Grid.Resources>
     <x:Array x:Key="data" Type="{x:Type sys:Type}">
        <x:Type TypeName="Visual"/>
        <x:Type TypeName="UIElement"/>
        <x:Type TypeName="FrameworkElement"/>
     </x:Array>
  </Grid.Resources>
  <TabControl ItemsSource="{StaticResource data}">
     <TabControl.ItemTemplate>
        <DataTemplate>
           <TextBlock Text="{Binding Name}">
              <TextBlock.Style>
                 <Style TargetType="{x:Type TextBlock}">
                    <Setter Property="Background" Value="DimGray"/>
                    <Setter Property="Foreground" Value="White"/>
                 </Style>
              </TextBlock.Style>
           </TextBlock>
        </DataTemplate>
     </TabControl.ItemTemplate>
     <TabControl.ContentTemplate>
        <DataTemplate>
           <TextBlock Text="{Binding FullName}">
           <TextBlock.Style>
              <Style TargetType="{x:Type TextBlock}">
                 <Setter Property="Background" Value="LightCoral"/>
                 <Setter Property="Foreground" Value="Navy"/>
              </Style>
              </TextBlock.Style>
           </TextBlock>
        </DataTemplate>
     </TabControl.ContentTemplate>
  </TabControl>
</Grid> 
```

# vbscript - VBScript 800a005e 错误

> ID：690765
> 
> 赞同：0
> 
> 时间：2009-03-27T17:41:15.750
> 
> 标签：vbscript, replace

我在我的 ASP 应用程序中使用旧的 VBScript。尝试使用 Replace(wholeText, textToSearch, textToReplace) 函数搜索和替换字符串，但出现以下错误：

```
Microsoft VBScript runtime  error '800a005e'

Invalid use of Null: 'Replace'

/instance/inst_spam_gen_4.asp, line 25 
```

这是我的功能：

```
Function cleanUpText(txt)

        txt = Replace(txt, "“", """")
        txt = Replace(txt, "”", """")
        txt = Replace(txt, "’", "'")
        txt = Replace(txt, "®", "&reg;")

    cleanUpText = txt
End Function 
```

我怎么解决这个问题？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T17:47:15.020

问题不在于您显示的函数，而在于调用该函数的代码。

您已从包含`Null`值的数据库中获得结果。然后，您使用该值调用函数，这会导致错误。

如果`Null`值应该在数据中有效，您可以使用该`IsNull()`函数来检查这些值，这样您就不会将该值用于无法处理它们的任何内容。

# .net - .Net 项目的 VSS 或 SVN？

> ID：690766
> 
> 赞同：16
> 
> 时间：2009-03-27T17:41:20.883
> 
> 标签：.net, svn, version-control, visual-sourcesafe, project-planning

在工作中，一位负责人让我研究将我的项目的当前源代码控制服务器（Visual Source Safe）更改为 SVN 可能有什么好处。

我真的没有反对 SVN，其实我有点挖，但在我看来，改成 SVN 不会给项目带来任何显着的好处，并且会迫使我们使用一些第三方工具来管理来自 Visual Studio 的源代码控制（我们主要使用 Microsoft 工具进行开发）。

所以，作为我研究的第一步，我问你：从 VSS 切换到 SVN 有什么好处？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-27T17:42:39.803

SVN 比 VSS 更受欢迎，并且有很多优点。VSS 是旧的和过时的。

*   [为什么不 VSS](http://www.subversionary.org/propaganda/why-not-vss)
*   [Visual SourceSafe：微软的源代码销毁系统](http://www.highprogrammer.com/alan/windev/sourcesafe.html)
*   [源代码控制：除 SourceSafe 之外的任何东西](http://www.codinghorror.com/blog/archives/000660.html)
*   [Visual SourceSafe 版本控制：任何速度都不安全？](http://www.developsense.com/testing/VSSDefects.html)

现在许多开发人员正在从 VSS 迁移到 SVN。如果您在 Google 中搜索“SVN”和“VSS”，它会显示很多与[VSS 到 SVN 迁移](http://www.google.com/search?q=VSS+to+SVN+migration)相关的文章。

*   VSS 的 lock-modify-unlock 模型使得在快速变化的文件上的协作成为一个令人头疼的问题。加上需要管理员解锁某人在度假时签出的文件的开销。
*   使用 VSS，这不是您是否会丢失数据的问题，而是何时丢失。您的源存储库应该是一块石头 - 如果开发人员的工作站崩溃，您应该只丢失 HIS 更改。您不应该丢失存储库中的随机文件和数据
*   MS 已超过 6 年没有维护 VSS。你还能得到它的支持吗？
*   根据您的备份工具，如果您只有一个人登录到服务器（这意味着他们让他们的开发工具保持打开状态，或者让 VSS 客户端保持运行），您可能无法获得 VSS 存储库的完整备份。
*   VSS 要求所有用户在文件系统级别（NTFS 权限）几乎完全控制组成存储库的文件。
*   没有用于 VSS 的好的、可用的、易于使用的已发布 API，并且第 3 方工具在大多数情况下都很薄弱。
*   合并在 VSS 中很糟糕。
*   VSS：如果您的开发人员分布在多个时区，如果他们以错误的顺序签入太靠近，他们签入的行为本身就会损坏数据库。

现在，这并不是说 Subversion 是完美无缺的——它肯定有一些事情可以做得更好，而它根本没有做一些事情。但是所有使用 VSS 和 SVN 的人很可能永远不会回到 VSS。

* * *

如果你会选择SVN。以下是您可能需要的工具列表：

*   **[AnkhSVN](http://ankhsvn.open.collab.net/)**是 Visual Studio 的 Subversion SourceControl 提供程序。
*   **[RapidSVN](http://rapidsvn.tigris.org/)**是一个跨平台的 Subversion 客户端。
*   **[TortoiseSVN](http://tortoisesvn.net/)**是一个易于使用的 SCM / 源代码控制软件，适用于 Microsoft Windows，并且可能是最好的独立 Subversion 客户端。
*   **[VisualSVN](http://www.visualsvn.com/visualsvn/)**是一个 Visual Studio 插件，它将 Subversion 和 TortoiseSVN 与 Visual Studio 无缝集成。
*   **[VisualSVN Server](http://www.visualsvn.com/server/)**是一个包，其中包含您在 Windows 平台上为您的团队安装、配置和管理 Subversion 服务器所需的一切。它包括 Subversion、Apache 和一个管理控制台。

* * *

这是一本关于这个主题的好书：C Pilato 的[带有 Subversion 的版本控制](https://rads.stackoverflow.com/amzn/click/com/0596510330)

[使用 Subversion 进行版本控制 http://ecx.images-amazon.com/images/I/51iwjNGkQdL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/51iwjNGkQdL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg)

* * *

VSS 和 SVN 的另一个很好的替代品是[SourceGear Fortress](http://www.sourcegear.com/fortress/)，它除了源代码控制之外还具有问题跟踪系统 - 多合一。或[SourceGear Vault](http://www.sourcegear.com/vault/) - 仅限源代码控制。还有[SourceAnyWhere](http://www.dynamsoft.com/Products/Products.aspx)解决方案。如果您需要 Microsoft 解决方案而不是使用 TFS 而不是 VSS。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-27T18:02:08.713

微软承认从未在他们的任何内部项目中使用过 VSS（虽然现在找不到参考资料：/）。我用了两年，它是愚蠢的坏。数据库每周至少损坏一次。

此外，我最喜欢引用 VSS 用户的话之一是[Eric Wadworth](http://wadhome.org/svn_vs_vss.html)页面上的第一句话，据报道来自微软的某人：

> ```
> "Visual SourceSafe?  It would be safer to print out all your code,
> run it through a shredder, and set it on fire." 
> ```

绝对选择SVN。VSS 就像 1000 个恶魔的噩梦。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-27T18:13:35.550

考虑一个更现代的工具，如[Git](http://git-scm.com/)、[Mercurial](http://www.selenic.com/mercurial/wiki/)或[Darcs](http://darcs.net/)。有很多优点，我将把谷歌搜索作为练习留给读者。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T18:14:14.237

我们在我工作的地方使用 SVN，并使用正确的文档、正确的客户端和工具，这很容易——到目前为止，它的使用非常可靠。在与 VSS 一起度过了过去 10 年之后，我可以说我一点也不怀念它。

我非常喜欢 SVN，我写了一篇关于我认为是最有价值的客户（有些不是）和其他工具的评论。这是一篇新文章，所以非常及时：[http ://codertools.wordpress.com/2009/03/24/svn-subversion-clients-and-other-tools/](http://codertools.wordpress.com/2009/03/24/svn-subversion-clients-and-other-tools/)

我会毫不犹豫地向任何人推荐 SVN - GIT 是我要查看的下一个列表。希望这会有所帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T17:43:54.607

避免 Source Safe 数据库崩溃带来的令人头疼的问题是占用您的整个代码库。

不必担心谁签出了文件是另一回事。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T17:44:22.967

我发现用 VSS 合并文件非常麻烦，但用 SVN 就很好。另外，我没有任何证据，但 SVN 似乎更快。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-27T17:51:53.213

VSS 是旧的和过时的。数据库经常损坏。MS 也构建 TFS 是有原因的。

SVN 非常流行（意味着大量的社区支持，意味着免费支持），有许多与之挂钩的工具（例如用于持续集成的 CruiseControl）并且使用起来相当简单。

如果您已经在使用 VSS，则必须考虑有一个学习曲线，这是您在研究中必须权衡的事情。如果其他开发人员没有使用过 SVN（或 CVS），那么它的成本可能会很高，尽管您所需要的只是一个真正了解系统的人，然后指导其余的人。

4 年前我们确实从 VSS 更改为 SVN，从那以后我们就再也没有回头。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-27T17:55:31.553

顺便说一句，我们多年来一直非常愉快地使用 Sourcegear Vault。拥有存储库和中央 SQL Server 数据库以及通过 Internet 进行的良好访问使其成为我们组织的灌篮高手。

我认为它的价格合理，至少值得一看。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-27T18:07:52.707

[AnkhSVN 2.0](http://ankhsvn.open.collab.net/)真的很不错。

如果您将 Visual Studio 集成作为一项要求，我什至会在一年前就对 SVN 发出警告，但这已经发生了很大的变化。它仍然不如 VS Team System，但它比旧的基于 MSSCCI 的 VSS 集成要好得多。没有理由不将 SVN 与 .NET 一起使用。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-27T18:13:17.280

另一个“绝对是 SVN”投票在这里。在之前的工作中，我是迁移团队的一员。我无法告诉你摆脱 VSS 有多好。

*   不再有损坏的存储库
*   更好的合并
*   *快得多*_**
**   便宜又容易的分支*   不再有排他锁*   非常容易地检查源到多个位置*

 *我可以继续，但VSS镣铐的记忆太痛苦了。拒绝吧。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-27T17:53:41.557

SourceGear Vault 是 VSS 的绝佳替代品。它开始是“VSS 功能但使用真实数据库”，并从那里发展而来。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-27T17:57:38.880

几乎肯定是SVN。SVN 采用不同的工作方式（复制-修改-合并而不是锁定-修改-解锁）。这是一条学习曲线，但这是几年来一直如此，所以大多数开发人员无论如何都必须在某个时间或其他时间学习它。Lock-Modify-Unlock 太痛苦了，它实际上会导致严重的协作问题，如果您好奇，我很乐意解释。

附议关于 VSS 有多糟糕的评论。以下是涵盖该主题的各种链接：

[http://www.codinghorror.com/blog/archives/000660.html](http://www.codinghorror.com/blog/archives/000660.html)

[http://www.developsense.com/testing/VSSDefects.html](http://www.developsense.com/testing/VSSDefects.html)

[http://wadhome.org/svn_vs_vss.html](http://wadhome.org/svn_vs_vss.html)

编辑：另请参阅： [源代码控制 - 锁定与合并？](https://stackoverflow.com/questions/283221/source-control-lock-vs-merge#283236)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-27T18:16:11.300

作为一个经历过 VSS -> SVN 转换过程的大型代码库的人，我想说最大的好处是能够安然入睡，因为知道您的 SCM 系统不会突然出现损坏数据库并且您必须返回的问题到昨天的备份。你每天都备份你的数据库，对吧？

使用 VSS，每个月至少会发生一次损坏。使用 SVN（相同的硬件和操作系统）——两年多一次。

哦，分支/合并功能很不错！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-12-10T15:53:18.863

当然，出于上述所有原因，请使用 SVN。你可以试试[ankhsvn](http://ankhsvn.open.collab.net/)，它是 Visual Studio 的 svn 插件。这样您就可以两全其美：使用 SVN 并且所有工作仍然在 Visual Studio 中完成。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-08T14:42:10.580

只是对 Koista Navin 答案的补充。

他说：这是一本关于这个主题的好书：C Pilato 的带有 Subversion 的版本控制

有一个免费的在线版本：

[http://svnbook.red-bean.com/](http://svnbook.red-bean.com/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-12-10T16:02:57.083

Team Foundation Server 是在 .NET 世界中进行开发的最佳选择。然而，它不是免费的，而且对于当前版本 2008，它可能非常昂贵。如果你有更高级别的 Visual Studio 包，你可以免费获得 TFS 工作组版，它允许 5 个用户访问，无需额外费用。

工作组版本有一些主要的警告，您必须使用 TFS 服务帐户的 5 个插槽之一，除非您将其设置为在将包含在 TFS 成员列表中的用户帐户下运行。另一个是一旦你达到了 5 个用户的限制，跳到 6 个用户是一个相当惊人的成本，因为当前的许可证要求包括需要为团队的每个成员购买服务器（几千美元）和 CAL。为团队增加一名成员，这是相当高的成本。

但是，Microsoft 已经意识到这一点，并将在 2010 年改变这一点。您将不再需要购买服务器本身，而只需要购买 CAL。[TFS 2010 服务器许可：它包含在 MSDN 订阅中](http://blogs.msdn.com/buckh/archive/2009/10/20/tfs-2010-server-licensing-it-s-included-in-msdn-subscriptions.aspx)

# mocking - Moq 和 Rhino.mocks 的功能是什么？

> ID：690769
> 
> 赞同：44
> 
> 时间：2009-03-27T17:42:13.113
> 
> 标签：mocking, rhino-mocks, moq, typemock, nmock2

我找不到 Moq 和 Rhino 的具体功能比较。所有的问题都是“你更喜欢哪个以及为什么”，或者“这是你如何在 rhino 中做一个简单的模拟以及它是如何在 moq 中完成的”。

我在任何地方都找不到深入的比较。我知道语法差异，我不是在寻找答案。 ***我正在寻找能力比较***。例如：

*   Rhino 有 Expect.On() 用于线程模拟。起订量可以吗？

*   多模拟（用一个模拟实现多个接口）怎么样。起订量可以吗？

*   我相信 Moq 现在可以模拟受保护的成员。犀牛能做到吗？

**编辑**：我最后也看了一些其他的 .Net 框架。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-04-27T17:05:11.307

感谢过去几周做出回应的人。我最终写了一篇关于我的发现的博客文章，因为我不得不做这么多的挖掘工作，似乎我不妨总结一下，希望能帮助别人。我发布的图表整理了我的发现：

![替代文字](https://i.stack.imgur.com/SAsrJ.png)

我在博客文章中提到的一个警告是，图表对于检查功能很有用，但大多数框架的真正优势在于它们的独特功能。我最终选择了 Moq，因为 API 易于使用。此外，所有信息都可能出现错误和更改 - 如果您不同意图表上的某些内容，请发表评论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:17:27.257

我无论如何都不是专家，但我相信 Rhino 添加了一些 Moq 语法，因此学习曲线已经减少到您对 MoQ 的期望。我在测试中都使用过，其中一些语法几乎相同。我最初打算使用 MoQ，因为它更容易，但后来我的 bud 向我展示了最新的更新以及它们有多相似。只是让你知道。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T17:02:06.500

Rhino 有 GetArgumentsForCallsMadeOn() ，在某些情况下，IMO 可以更轻松地验证参数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-20T20:17:31.227

为了完整起见，我会注意到[CodePlex](http://nmock3.codeplex.com/)现在有 NMock3 。它可以从 NMock2 轻松迁移，只需将 NMock2.dll 的引用替换为对 NMock3.dll 的引用即可。它增加了类型安全和对重构的支持。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-06-12T20:57:23.147

我可能会在其中添加“行为验证”。这似乎是 Moq 的最大限制，Rhino（不确定其他人）对此没有任何问题。

# ssis - 在 SSIS 包中，如何插入主从记录？

> ID：690772
> 
> 赞同：4
> 
> 时间：2009-03-27T17:42:54.843
> 
> 标签：ssis, insert, identity, master-detail

我有一个数据流任务，它从一个数据库中提取数据并插入到 SQL Server 数据库中。在主行中插入每条记录后，我还需要将行插入到明细表中。明细表的数据非常简单，可以计算。

1.  插入后如何检索标识列的值？
2.  如何生成必须插入第二个表的行？我可以在脚本中执行此操作吗？

我是否需要在控制流级别使用 Foreach 循环来传输数据流任务中的父行，然后再使用另一个 Foreach 循环来插入详细记录？

我可以在脚本中执行所有详细信息行插入吗？这可能比放入 Foreach 循环更容易。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T18:21:26.310

这是一种方法..

创建一个对象类型的变量。

创建一个“执行 SQL 任务”来获取源数据并将其加载到变量 (ADO.NET) 中。

创建一个“ForEach 循环容器。

将 Success 连接器（绿色）从“Execute SQL Task”拖到“ForEach 循环容器”。将循环容器上的枚举器更改为“foreach ADO 枚举器”并从“ADO 对象源变量”中选择您的变量。

在您的循环中，您应该能够添加一个可以使用的“执行 SQL 任务”。

插入主表后，您应该能够使用 SCOPE_IDENTITY() 获取每个 ID，并使用该 ID 插入明细表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:24:43.167

我遇到了这个问题，规模更大（导入深度嵌套的 XML）。我能够利用 XML Source 的一个特性，它在主“表”中创建一个代理键，然后在“子”表中作为“外键”重复。

这个想法是允许每个“表”到达数据库中的一个单独的临时表。在处理完所有行之后，您可以使用这些“外键”进行任何需要同时创建主行和明细行的最终处理——必要时甚至在事务中。

这允许执行数据流任务，并结合数据的主从性质。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-01-06T20:23:30.383

当我迁移在源中具有 ID 字段的数据时，我经常使用的一种技术是在目标主表中拥有一个名为“OldID”的列。使用将原始 id 字段放入 OldID 的 SSIS 控件填充它。然后是后续的 SSIS 控件对已填充的主记录执行查找，其中 OldID 与源 ID 匹配，并以这种方式获取新创建的 ID。

# c# - 通过网关发送的 SMS 消息中编码 £ 无法正常工作

> ID：690773
> 
> 赞同：1
> 
> 时间：2009-03-27T17:43:11.940
> 
> 标签：c#, .net, sms, gsm

我在使用名为 Cymba 的提供商发送的 SMS 消息时遇到问题。

基本上，我会根据他们的规范 URL 编码将消息发布给他们。

但是，当消息发送到我的手机时，£ 会在前面显示一个 A，即 £A

现在 C# 字符串默认是 Unicode，所以我切换到 ASCII 编码，而 £ 变成了 ?。

我已经尝试将消息字符串转换为从 Unicode 和 ASCII 版本开始的十六进制（因为通过此网关，您也可以将消息提交为十六进制）。然而，同样的行为也会发生。

我怀疑这与字符串编码有关，因为 SMS 支持 7 位编码格式：GSM 03.38

我还怀疑，如果我通过 Unicode 发送，我只会收到 70 或 140 字符的消息，而不是标准的 160。

我对 SMS 发送很陌生，因此我们将不胜感激任何帮助或建议。

所以问题是，我怎样才能让我的 C# 字符串变成这种格式？

**更新：**看起来网关的问题不是我的代码，因为我尝试用 7 位等效十六进制值替换有问题的 £，但这也不起作用。请参阅下面的我的测试代码，这可能会在未来帮助其他人：

```
byte pound = 0xA3;
byte GSMPound = 0x01;
string hexxedMsg = "";
System.Text.UnicodeEncoding encoder = new System.Text.UnicodeEncoding();
byte[] msgBytes = encoder.GetBytes(message);

foreach (byte byt in msgBytes)
{
    if(byt == pound)
        hexxedMsg += GSMPound.ToString("X");
    else
        hexxedMsg += byt.ToString("X2"); ;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T17:55:44.063

有一个可用的[GSM 03.38 到 Unicode](http://www.unicode.org/Public/MAPPINGS/ETSI/GSM0338.TXT)映射表，这表明 £ 应该被编码为 0x01，所以你可以尝试（只需硬编码一次尝试）。但是，您真的应该向网关运营商检查所有这些。网关是否真的希望您以 URL 编码的 GSM 03.38 发布？如果是这样，那么该映射表可能是要走的路 - 您可能需要编写自己的实现以从字符串映射到字节（完全实现`System.Text.Encoding`将是矫枉过正）。不过，我会先尝试使用硬编码消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T18:02:13.860

[此页面](http://www.dreamfabric.com/sms/)包含有关[“7 位默认字母表”的](http://www.dreamfabric.com/sms/default_alphabet.html)信息。

最简单的解决方案可能是创建一个字典，将由 GSM 03.38 标准编码的 Unicode 代码点（大约 140 个字形）映射为 1 或 2 个字节（0x27、0x?? 对需要 2 个字节）。

一旦完成（取决于您的提供商），您可能还必须将 8 位字节压缩成 7 位序列流。这里有一个[视觉样本](http://www.dreamfabric.com/sms/hello.html)。

在你完成了所有这些（并且喝了几杯啤酒！）之后，你可能想把它变成一个 System.Text.Encoding 实现。

* * *

您可能还想查看CodeProject 上的[PDUDecoder](http://www.codeproject.com/KB/IP/PDUDecoder.aspx)以进行反向操作。还有一个在线版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-16T00:55:48.323

你应该看看这个：[https ://github.com/mediaburst/.NET-GSM-Encoding/blob/master/GSMEncoding.cs](https://github.com/mediaburst/.NET-GSM-Encoding/blob/master/GSMEncoding.cs)

# windows - How to create directory with all rights granted to everyone

> ID：690780
> 
> 赞同：12
> 
> 时间：2009-03-27T17:44:45.133
> 
> 标签：windows, security, winapi, directory, directory-security

I need to programmatically create a directory that grants "Full Control" to the group "Everyone". If I use

```
CreateDirectory(path, NULL); 
```

This will, according to the Win32 SDK [documentation](http://msdn.microsoft.com/library/aa363855.aspx), create a directory that inherits from its parent directory. I do not want to inherit the access rights of the parent directory I need to ensure that "Everyone" has full control over the directory.

Obviously, this will require setting up the `SECURITY_ATTRIBUTES` structure with the appropriate security descriptor. How do I do that?

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-27T19:58:56.030

这是一种似乎有效的技术：

```
SID_IDENTIFIER_AUTHORITY SIDAuthWorld = SECURITY_WORLD_SID_AUTHORITY;
PSID everyone_sid = NULL;
AllocateAndInitializeSid(&SIDAuthWorld, 1, SECURITY_WORLD_RID, 
   0, 0, 0, 0, 0, 0, 0, &everyone_sid);

EXPLICIT_ACCESS ea;
ZeroMemory(&ea, sizeof(EXPLICIT_ACCESS));
ea.grfAccessPermissions = SPECIFIC_RIGHTS_ALL | STANDARD_RIGHTS_ALL;
ea.grfAccessMode = SET_ACCESS;
ea.grfInheritance = NO_INHERITANCE;
ea.Trustee.TrusteeForm = TRUSTEE_IS_SID;
ea.Trustee.TrusteeType = TRUSTEE_IS_WELL_KNOWN_GROUP;
ea.Trustee.ptstrName  = (LPWSTR)everyone_sid;

PACL acl = NULL;
SetEntriesInAcl(1, &ea, NULL, &acl);

PSECURITY_DESCRIPTOR sd = (PSECURITY_DESCRIPTOR)LocalAlloc(LPTR, 
                                   SECURITY_DESCRIPTOR_MIN_LENGTH);
InitializeSecurityDescriptor(sd, SECURITY_DESCRIPTOR_REVISION);
SetSecurityDescriptorDacl(sd, TRUE, acl, FALSE);

SECURITY_ATTRIBUTES sa;
sa.nLength = sizeof(SECURITY_ATTRIBUTES);
sa.lpSecurityDescriptor = sd;
sa.bInheritHandle = FALSE;

CreateDirectory(path, &sa);

FreeSid(everyone_sid);
LocalFree(sd);
LocalFree(acl); 
```

请注意，此示例代码绝对没有错误检查——您必须自己提供。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-30T08:02:07.163

我更喜欢以下代码片段，因为它创建了一个继承默认权限的文件夹 - 这似乎是正确的做法 - 其他软件/用户可能出于正当原因在目录上设置了特定的可继承权限 - 然后添加了完全控制显式访问条目对于内置的“用户”组。

```
BOOL CreateDirectoryWithUserFullControlACL(LPCTSTR lpPath)
{
  if(!CreateDirectory(lpPath,NULL))
    return FALSE;

  HANDLE hDir = CreateFile(lpPath,READ_CONTROL|WRITE_DAC,0,NULL,OPEN_EXISTING,FILE_FLAG_BACKUP_SEMANTICS,NULL);
  if(hDir == INVALID_HANDLE_VALUE)
    return FALSE; 

  ACL* pOldDACL;
  SECURITY_DESCRIPTOR* pSD = NULL;
  GetSecurityInfo(hDir, SE_FILE_OBJECT , DACL_SECURITY_INFORMATION,NULL, NULL, &pOldDACL, NULL, (void**)&pSD);

  PSID pSid = NULL;
  SID_IDENTIFIER_AUTHORITY authNt = SECURITY_NT_AUTHORITY;
  AllocateAndInitializeSid(&authNt,2,SECURITY_BUILTIN_DOMAIN_RID,DOMAIN_ALIAS_RID_USERS,0,0,0,0,0,0,&pSid);

  EXPLICIT_ACCESS ea={0};
  ea.grfAccessMode = GRANT_ACCESS;
  ea.grfAccessPermissions = GENERIC_ALL;
  ea.grfInheritance = CONTAINER_INHERIT_ACE|OBJECT_INHERIT_ACE;
  ea.Trustee.TrusteeType = TRUSTEE_IS_GROUP;
  ea.Trustee.TrusteeForm = TRUSTEE_IS_SID;
  ea.Trustee.ptstrName = (LPTSTR)pSid;

  ACL* pNewDACL = 0;
  DWORD err = SetEntriesInAcl(1,&ea,pOldDACL,&pNewDACL);

  if(pNewDACL)
    SetSecurityInfo(hDir,SE_FILE_OBJECT,DACL_SECURITY_INFORMATION,NULL, NULL, pNewDACL, NULL);

  FreeSid(pSid);
  LocalFree(pNewDACL);
  LocalFree(pSD);
  LocalFree(pOldDACL);
  CloseHandle(hDir);

  return TRUE;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:01:21.210

See if you can use [SetSecurityInfo()](http://msdn.microsoft.com/en-us/library/aa379588(VS.85).aspx)

In the description of the optional *pDacl* argument:

> ... If the value of the SecurityInfo parameter includes the DACL-SECURITY-INFORMATION flag and the value of this parameter is set to NULL, full access to the object is granted to everyone.

# javascript - 通过 jQuery getScript 函数添加的调试脚本

> ID：690781
> 
> 赞同：52
> 
> 时间：2009-03-27T17:44:56.820
> 
> 标签：javascript, jquery, visual-studio, debugging

`$.getScript`我有一个通过 jQuery函数动态添加脚本引用的页面。脚本加载并执行良好，所以我知道引用是正确的。但是，当我向任何脚本添加“调试器”语句以允许我在调试器（例如 VS.Net、Firebug 等）中单步执行代码时，它不起作用。似乎 jQuery 加载脚本的方式阻止了调试器找到文件。

有人可以解决这个问题吗？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-03-27T22:14:59.447

好的，事实证明，`$.getScript()`函数的默认实现会根据引用的脚本文件是否在同一个域中而有所不同。外部参考，例如：

```
$.getScript("http://www.someothersite.com/script.js") 
```

将导致 jQuery 创建一个外部脚本引用，可以毫无问题地对其进行调试。

```
<script type="text/javascript" src="http://www.someothersite.com/script.js"></script> 
```

但是，如果您引用本地脚本文件，例如以下任何内容：

```
$.getScript("http://www.mysite.com/script.js")
$.getScript("script.js")
$.getScript("/Scripts/script.js"); 
```

然后 jQuery 将异步下载脚本内容，然后将其添加为内联内容：

```
<script type="text/javascript">{your script here}</script> 
```

后一种方法不适*用于*我测试过的任何调试器（Visual Studio.net、Firebug、IE8 调试器）。

解决方法是重写该`$.getScript()`函数，以便它始终创建外部引用而不是内联内容。这是执行此操作的脚本。我已经在 Firefox、Opera、Safari 和 IE 8 中对此进行了测试。

```
<script type="text/javascript">
// Replace the normal jQuery getScript function with one that supports
// debugging and which references the script files as external resources
// rather than inline.
jQuery.extend({
   getScript: function(url, callback) {
      var head = document.getElementsByTagName("head")[0];
      var script = document.createElement("script");
      script.src = url;

      // Handle Script loading
      {
         var done = false;

         // Attach handlers for all browsers
         script.onload = script.onreadystatechange = function(){
            if ( !done && (!this.readyState ||
                  this.readyState == "loaded" || this.readyState == "complete") ) {
               done = true;
               if (callback)
                  callback();

               // Handle memory leak in IE
               script.onload = script.onreadystatechange = null;
            }
         };
      }

      head.appendChild(script);

      // We handle everything using the script element injection
      return undefined;
   },
});
</script> 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-09-21T01:57:01.437

使用 JQuery 1.6（可能是 1.5），您可以切换到不使用 getScript，而是使用 jQuery.ajax()。然后设置 crossDomain:true 你会得到同样的效果。

错误回调将不起作用。所以你最好不要像下面这样设置它。

但是，我确实设置了一个计时器并成功清除它。因此，如果我没有听到任何声音，那么在 10 秒后说，我认为文件是错误的。

```
 jQuery.ajax({
            crossDomain: true,
            dataType: "script",
            url: url,
            success: function(){
                _success(_slot)
            },
            error: function(){
                _fail(_slot);
            }
        }) 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2014-02-07T20:27:35.643

对于那些想要调试脚本并将它们与 $.when 一起使用的人（James Messinger 的回答不适用于 $.when），我建议使用以下代码：

```
var loadScript = function (path) {
  var result = $.Deferred(),
  script = document.createElement("script");
  script.async = "async";
  script.type = "text/javascript";
  script.src = path;
  script.onload = script.onreadystatechange = function (_, isAbort) {
      if (!script.readyState || /loaded|complete/.test(script.readyState)) {
         if (isAbort)
             result.reject();
         else
            result.resolve();
    }
  };
  script.onerror = function () { result.reject(); };
  $("head")[0].appendChild(script);
  return result.promise();
}; 
```

所有的功劳和荣耀归于 Benjamin Dumke-von der Ehe 和他的文章：[jQuery 脚本插入及其对调试的影响](http://balpha.de/2011/10/jquery-script-insertion-and-its-consequences-for-debugging/)

**这适用于 $.when 并且脚本是完全可见和可调试的。** 谢谢。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-19T16:27:38.490

试试这个，

```
jQuery.extend({
getScript: function(url, callback) {
    var head = document.getElementsByTagName("head")[0];

    var ext = url.replace(/.*\.(\w+)$/, "$1");

    if(ext == 'js'){
        var script = document.createElement("script");
        script.src = url;
        script.type = 'text/javascript';
    } else if(ext == 'css'){
        var script = document.createElement("link");
        script.href = url;
        script.type = 'text/css';
        script.rel = 'stylesheet';
    } else {
        console.log("Неизветсное расширение подгружаемого скрипта");
        return false;
    }

    // Handle Script loading
    {
        var done = false;

        // Attach handlers for all browsers
        script.onload = script.onreadystatechange = function(){
            if ( !done && (!this.readyState ||
            this.readyState == "loaded" || this.readyState == "complete") ) {
                done = true;
                if (callback)
                callback();

                // Handle memory leak in IE
                script.onload = script.onreadystatechange = null;
            }
        };
    }

    head.appendChild(script);

    // We handle everything using the script element injection
    return undefined;

} 
   }); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-05-08T19:52:01.250

有一种简单的方法可以使用 Chrome 进行调试。

1- 在要调试的行上写一个 console.log("something") 。

2- 观察该日志的控制台。

![样本日志](https://i.stack.imgur.com/0bcpi.png)

3- 单击日志前面的地址链接。

4-在那条线上设置断点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-01-12T19:10:23.053

所有的答案都在这个页面的某个地方，但我想为未来的读者总结一下。

**检查（动态添加的）文件下载**

**使用 Chrome，您可以在 XHR 选项卡的网络面板**下看到使用 $.getScript ( [http://api.jquery.com/jQuery.getScript/](http://api.jquery.com/jQuery.getScript/) )添加的 Javascript 文件；请注意，它们不会出现在 JS 选项卡下。

 ****调试文件**

1）在代码中设置*断点。*如其他答案\评论中所述，您可以插入

```
debugger; 
```

Javascript 代码中的语句。这将调用浏览器的调试器。有关更多信息，请参阅[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger)。

2) 使用*Source Map*使其出现在浏览器的 Sources 面板中（在 Chrome 中测试）。添加

```
//# sourceURL=whatevername.js 
```

到文件的末尾。[该文件出现在 Chrome 源代码面板中的 (no-domain) 下]。

请参阅： [如何在浏览器的调试器本身中调试动态加载的 JavaScript（使用 jQuery）？](https://stackoverflow.com/questions/9092125/how-to-debug-dynamically-loaded-javascript-with-jquery-in-the-browsers-debugg)和[https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map](https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map)了解更多信息。

3）根据接受的答案覆盖 $.getScript 以始终​​使用外部引用（我尚未测试）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-13T14:26:23.223

为了避免大量额外的编码，你可以试试这个。在您声明 $('document').ready() 的文件（*或您的调试器将访问的任何其他文件*）中，添加类似...

```
$.debug = function(name) {
   var n = name;
} 
```

在调试器的分配行中添加断点。然后，在您使用 $.getScript() 加载的任何其他 js 文件中，您可以添加...

```
$.debug("some string to identify this point of code"); 
```

每当执行此行时，您的调试器将停止并等待您的命令。跳出 $.debug 函数，就是这样！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-02-25T17:21:03.237

在带有 Firebug 2.0.14 的 Firefox 38.6.0 中，当我转到“脚本”选项卡时，我在下拉菜单中看到一个条目，`jquery-1.11.1.js line 338 > eval`其中包含已加载的脚本。另外，查看这个版本的 jQuery 中的代码，内部看起来像是`$.getScript()`在使用`$.get()`和最终`$.ajax()`，唯一的区别是`eval()`脚本部分，它由 jQuery`globalEval()`函数处理：

```
// Evaluates a script in a global context
// Workarounds based on findings by Jim Driscoll
// http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context
globalEval: function( data ) {
    if ( data && jQuery.trim( data ) ) {
        // We use execScript on Internet Explorer
        // We use an anonymous function so that context is window
        // rather than jQuery in Firefox
        ( window.execScript || function( data ) {
            window[ "eval" ].call( window, data );
        } )( data );
    }
}, 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-04-07T14:41:39.603

这将 OP 解决方案与 Eric 的解决方案相结合。覆盖必要的 jquery 以将 get 视为始终跨域，它们将完美显示而不会破坏 jquery 承诺实现中的任何事情。

```
jQuery.extend({
get: function (url, data, callback, type) {
 // shift arguments if data argument was omitted
 if (jQuery.isFunction(data)) {
    type = type || callback;
    callback = data;
    data = undefined;
 }

 return jQuery.ajax({
    url: url,
    type: "GET":,
    dataType: type,
    data: data,
    success: callback,
    crossDomain: true
 });
}

}); 
```

# ruby - Ruby 数组：%w 与 %W

> ID：690794
> 
> 赞同：163
> 
> 时间：2009-03-27T17:47:49.543
> 
> 标签：ruby, arrays

有什么不同？

* * *

## 回答 #1

> 赞同：254
> 
> 时间：2009-03-27T17:55:49.930

%w 引号像单引号`''`（没有变量插值，更少的转义序列），而 %W 引号像双引号`""`。

```
irb(main):001:0> foo="hello"
=> "hello"
irb(main):002:0> %W(foo bar baz #{foo})
=> ["foo", "bar", "baz", "hello"]
irb(main):003:0> %w(foo bar baz #{foo})
=> ["foo", "bar", "baz", "\#{foo}"] 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-01-08T21:19:31.167

我为 %W 与 %w 找到的应用程序：

```
greetings = %W(hi hello #{"how do you do"})
# => ["hi", "hello", "how do you do"] 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-03-27T17:50:51.517

%W 执行正常的双引号替换。%w 没有。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-05-29T18:03:29.413

虽然是一篇旧文章，但问题不断出现，我的答案似乎并不总是很清楚。所以，这是我的想法。

%w 和 %W 是与数组相关的通用分隔输入*类型*的示例。还有其他类型，包括 %q、%Q、%r、%x 和 %i。

大写和小写的区别在于它使我们可以访问单引号和双引号的功能。使用单引号和小写 %w，我们没有代码插值（例如 #{someCode} ）和有限范围的转义字符（例如 \、\n ）。使用双引号和大写 %W，我们*确实*可以访问这些功能。

使用的分隔符可以是任何字符，而不仅仅是左括号。使用上面的示例来查看效果。

有关 %w 示例和完整列表、转义字符和分隔符的完整记录 - 请查看：[http ://cyreath.blogspot.com/2014/05/ruby-w-vs-w-secrets-revealed .html](http://cyreath.blogspot.com/2014/05/ruby-w-vs-w-secrets-revealed.html)

标记

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-04-12T17:15:04.643

百分比字符串的文档：[http ://ruby-doc.org/core-2.2.0/doc/syntax/literals_rdoc.html#label-Percent+Strings](http://ruby-doc.org/core-2.2.0/doc/syntax/literals_rdoc.html#label-Percent+Strings)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-11-04T04:19:31.133

`%W`用于双引号数组元素`%Q`，例如，

```
foo = "!"
%W{hello world #{foo}} # => ["hello", "world", "!"] 
```

`%w`用于单引号数组元素，如`%q`.

```
%w(hello world #{foo})
# => ["hello","world", "\#{foo}"] 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-19T13:17:15.857

```
array = %w(a b c d) 
```

**如同**

```
array = ["a", "b", "c", "d"] 
```

`%w`是字符串的引号的快捷符号！

# windows - What is Windows Event Logging

> ID：690803
> 
> 赞同：1
> 
> 时间：2009-03-27T17:49:49.163
> 
> 标签：windows, event-log

Can anyone explain what is Windows Event Logging?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T17:54:44.720

Try this related stack overflow [question](https://stackoverflow.com/questions/655592/what-is-event-logging-and-how-do-i-write-an-event-log-file).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T17:58:06.757

I think everything you need to know would be here:

[Event Logging (Windows)](http://msdn.microsoft.com/en-us/library/aa363652(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T17:54:24.783

When you send log messages to the Windows Event Logger. You can see the messages by going to the Control Panel -> Administrative Tools -> Event Viewer.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:54:52.927

Since this is homework I'm assuming you just want the basic idea of it. If your program encounters a serious error, you write it to the Windows event log so you can keep a record and look at it later to figure out what went wrong. Look it up on [MSDN](http://msdn.microsoft.com/en-us/library/aa385780(VS.85).aspx) or [Wikipedia](http://en.wikipedia.org/wiki/Event_Viewer#Windows_Event_Log)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T17:55:16.607

Windows Event Log is a component of Microsoft's Windows NT line of operating systems that lets administrators and users view the event logs on a local or remote machine. Windows Event Logging is the process of writing applications' events into that centrolized log storage.

# java - 任何可以限制内存缓存的内存使用的Java缓存，而不仅仅是实例计数？

> ID：690805
> 
> 赞同：13
> 
> 时间：2009-03-27T17:51:01.110
> 
> 标签：java, caching, memory-management, ehcache

我正在寻找一个简单的内存（和进程内）缓存，用于查询数据的短期缓存（但短期含义超出请求/响应，即会话边界）。EhCache 可能会起作用，但看起来它可能无法提供我需要的一件事：不是对缓存对象数量的限制，而是对缓存数据消耗的内存量的（近似）限制。

我知道在没有序列化的情况下很难计算出给定对象的确切内存使用情况（在一般情况下，我想避免这种情况，因为它的速度很慢，违背了我的使用目的），我可以自己提供大小估计。

那么：是否有一个简单的开源 Java 缓存允许定义缓存对象的“权重”，以限制缓存的内容数量？

编辑（2010 年 11 月）：值得一提的是，有一个名为[Java CacheMate](https://github.com/cowtowncoder/java-cachemate)的新项目试图解决这个问题，以及其他一些改进想法（多级内存进程内缓存）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-28T20:54:15.687

我同意 Paul 的观点，这通常可以通过使用软引用缓存来解决，尽管它可能会比您喜欢的更早地驱逐条目。通常可以接受的解决方案是使用一个普通的缓存，它驱逐到软缓存，并在可能的情况下恢复未命中的条目。这种受害者缓存方法效果很好，给你一个较低的标准，但如果可用内存可用，则会有额外的好处。

内存大小可以通过启用 Java 代理来确定，使用 SizeOf 实用程序 ( [http://sourceforge.net/projects/sizeof](http://sourceforge.net/projects/sizeof) ) 时使用非常简单。我只将它用于调试目的，我建议在将其用于正常使用之前对开销进行基准测试。

在我的缓存库中，我计划在实现核心算法后添加插入评估器的功能。这样，您可以将集合存储为值，但通过所有集合大小的总和来绑定缓存。我已经看到无限集合作为缓存中的值会导致 OutOfMemoryExceptions，因此控制非常方便。

如果你真的需要这个，我建议不要这样做，我们可以增强我当前的实现来支持这个。你可以给我发电子邮件，ben.manes-at-gmail.com。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T00:03:47.407

如何使用启用 LRU 算法的简单 LinkedHashMap 并将所有带有 SoftReference 的数据放入其中......例如 cache.out(key, new SoftReference(value)) ？

这会将您的缓存限制为可用内存量，但不会杀死程序的其余部分，因为Java会在有内存需求时删除软引用......不是全部......通常是最旧的...... 如果您将引用队列添加到您的实现中，您还可以从映射中删除停顿条目（只有键，没有值）。

这将使您免于计算条目的大小并跟踪总和。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-13T19:19:32.067

EhCache V2.5 目前提供了一种可以根据缓存的内存大小进行封顶的解决方案。有关更多详细信息，请查看[EhCache 2.5 文档](http://www.ehcache.org/documentation/user-guide/configuration#memory-based-cache-sizing-ehcache-25-and-higher)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T17:58:46.210

这不仅难以衡量——也难以定义。

假设两个缓存条目引用同一个字符串 - 它们是否*都*计算该字符串的大小，尽管从缓存中删除它们中的任何一个都不会使字符串符合垃圾回收条件？它们都不计算大小，尽管如果*它们*都从缓存中删除，则字符串可能有资格被收集？如果不在缓存中的另一个对象引用了该字符串怎么办？

如果您可以准确地描述您感兴趣的尺寸，则*可以*通过编程方式确定它 - 但我怀疑您会发现甚至很难确定您想要什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T18:09:54.607

除了猜测对象的内存使用情况外，对于一个合理的算法，您还需要猜测重新创建它的成本。一个合理的猜测是娱乐成本大致与内存大小成正比。所以这些因素相互抵消，你不需要。一个简单的算法可能会更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T18:33:35.017

如果您无法做出任何估计 - 编写一个缓存驱逐策略，该策略基于 JVM 堆大小（从系统轮询）或由来自孤立对象（在 GC 上）的 finalize() 调用触发。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-30T08:16:06.270

可以为缓存的内存使用定义一个有意义的度量。您可以计算 : ["retained size"](http://kohlerm.blogspot.com/2009/02/how-to-really-measure-memory-usage-of.html)。不幸的是，计算保留大小的成本大致与完整 GC 一样高，因此可能不是一种选择。在某些 JVM 语言（clojure？）中，理论上您可以确保缓存中的任何对象都不会被外部对象引用，然后您可以监控缓存的实际大小。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-27T19:09:35.650

完成这项工作的是 java.lang.ref.SoftReference 。通常，您扩展 SoftReference 类，以便子类包含键。

# jquery - 使用jQuery隐藏然后显示一个div

> ID：690809
> 
> 赞同：4
> 
> 时间：2009-03-27T17:53:07.750
> 
> 标签：jquery, css-selectors, callback

我想*滑动*一些 div，然后*滑动*1 个 div。但是，我遇到了一些问题。

```
$("#divDocument,#divLocation").slideUp("normal", function()
    { $("#divSearch").slideDown("normal", doStuff()); }); 
```

使用此代码，*divDocument*可见，*而 divLocation*不可见。因为*divLocation*已经隐藏，所以*doStuff()*事件会立即触发，即使*divDocument*尚未隐藏。

```
$("#divDocument).slideUp("normal", function()
    { $("#divSearch").slideDown("normal", doStuff()); }); 
```

这段代码运行良好，因为它会等到*divDocument*完全隐藏后再调用*doStuff()*。我在这里使用了错误的多元素选择器吗？我做错了什么吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T17:55:37.557

如果 divLocation 已经可见，为什么不先隐藏它呢？

```
$("#divDocument,#divLocation").hide().slideUp("normal", function() { 
    $("#divSearch").slideDown("normal", doStuff()); 
}); 
```

**编辑**：
对不起，我很困惑。slideUp 旨在隐藏元素。出于某种原因，我认为这是为了向他们展示。在这种情况下，您可以这样做：

```
$("#divDocument,#divLocation").filter(':visible').slideUp("normal", function() { 
    $("#divSearch").slideDown("normal", doStuff()); 
}); 
```

使用`:visible`过滤器，它只会`slideUp`在任何可见的元素上执行，然后可以用`slideUp`. 我猜这就是您要寻找的东西，因为隐藏已经隐藏的元素是没有意义的。如果你想暂时显示隐藏的然后`slideUp`它，你可以把我原来的答案从 切换`hide()`到`show()`然后做`slideUp`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T18:13:07.360

这是我最终使用的代码。谢谢，Paolo，用过滤器为我指明了正确的方向。

```
var o = $("#divDocument,#divLocation").filter(':visible');
if (o.length > 0) {
    o.slideUp("normal",
    function() {
        $("#divSearch").slideDown("normal", doStuff);
    });
}
else {
    doStuff();
} 
```

# flash - 如何在 Flash 的文本字段中允许制表符？

> ID：690816
> 
> 赞同：1
> 
> 时间：2009-03-27T17:54:40.447
> 
> 标签：flash, actionscript-3, string, tabs

我正在开发一个最初从条形码扫描仪获取输入的 AS3 Flash 游戏。它扫描的数据以一个长字符串的形式出现，使用制表符分隔数据段。扫描仪充当键盘并将字符串输入到隐藏的文本字段中，以便我可以抓取字符串并将其拆分以获取数据。

输入和一切都很好。我遇到的问题是，当文本字段接收到制表符时，它不会将字符插入到文本字段中，而是突出显示文本字段中的任何内容。然后下一组字符会覆盖文本字段中已有的内容。

有没有办法解决？有没有办法让文本字段接受标签作为文字字符？我无法更改条形码分隔字符串中数据的方式。

谢谢你提供的所有帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-03-22T03:44:49.197

以下内容允许用户在 TextField 的任何位置（不仅仅是结尾）键入选项卡。

```
someTextField.addEventListener(FocusEvent.KEY_FOCUS_CHANGE, TextKeyFocusChange);
private function TextKeyFocusChange(e:FocusEvent):void
{
    e.preventDefault();         
    var txt:TextField = TextField(e.currentTarget);
    txt.replaceText(txt.caretIndex, txt.caretIndex, "\t");
    txt.setSelection(txt.caretIndex + 1, txt.caretIndex + 1);
} 
```

注意：此解决方案比使用 appendText 慢一些，并且仅应在可以在 TextField 中的任何位置输入选项卡时使用，而不仅仅是结尾。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T19:02:28.957

（更新的解决方案）

这确实是可以预防的。您可以使用以下文本停止它（假设 Text 是文本字段）。

```
Text.addEventListener(FocusEvent.KEY_FOCUS_CHANGE, TextKeyFocusChange);

private function TextKeyFocusChange(e:FocusEvent):void
{
    e.preventDefault();

    var txt:TextField = TextField(e.currentTarget);

    txt.appendText("\t");
    txt.setSelection(txt.length, txt.length);
} 
```

# php - PDO 故障排除：执行准备好的语句时未捕获错误

> ID：690827
> 
> 赞同：4
> 
> 时间：2009-03-27T17:55:57.743
> 
> 标签：php, mysql, pdo, try-catch

我在使用 PDO 时遇到了问题，因为没有发现错误。

代码很简单，工作得很好，我只包含一个示例以避免混淆：

```
$sql = 'INSERT INTO somedatetable (something) 
        VALUES (:something) 
        ON DUPLICATE KEY UPDATE something=:something';

$values = array(":something" => $something);

try {
    $stmt = $dbh->prepare($sql);    
    $stmt->execute($values);    
} catch (PDOException $e) {
    echo "Error: " . $e->getMessage() . "<br />\n";
} 
```

代码工作正常，但是在处理新模块时，我遇到了一个问题，即没有添加或修改任何记录，也没有发现任何错误。

`$stmt`返回`false`但我不知道为什么或如何找到错误。

最后的解决方案很简单，我使用的是一个没有表写入权限的受限 MySQL 用户。这些错误在使用 mysql 时总是会立即显示，但使用 PDO 我不知道如何找到它们。

如何让 PHP / PDO 显示或捕获此类数据库错误？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-27T18:00:54.783

[`PDO::errorInfo()`](http://php.net/pdo.errorinfo)或者[`PDOStatement->errorInfo()`](http://php.net/pdostatement.errorinfo)

至于异常，请查看文档以了解[PDO中的](http://php.net/pdo.error-handling)[*“错误和错误处理”*](http://php.net/pdo.error-handling)。默认情况下不会抛出异常，这就是您可能想要启用它们的原因。

另见：

*   [我的 PDO 语句不起作用？](https://stackoverflow.com/q/32648371/367456)

# sql-server - Is connection pooling working correctly in Subsonic?

> ID：690828
> 
> 赞同：1
> 
> 时间：2009-03-27T17:56:31.627
> 
> 标签：sql-server, subsonic

I am getting reports that connection pooling is not working in the Subsonic orm when used with sql server on a remote machine. I'm not sure how they are monitoring this, maybe with the profiler.

Subsonic opens late, closes early as you are supposed to do in an orm layer, but is there any problem with the implementation that would cause too many connections?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-30T19:19:46.487

使用 SubSonic 时，有一种方法可以使连接保持打开状态。许多人认为，当您加载集合时，阅读器将为您关闭 - 但事实并非如此（一个类不应该在未经许可的情况下对另一个类进行操作）。正是出于这个原因，有一个名为“LoadAndCloseReader()”的方法。

如果你能发现更多，那就太好了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T10:19:52.317

Does this mean that SubSonic's connections are persistent by default?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-31T14:08:54.187

我不确定早期版本，但在 2.1 中，AbstractList.Load() 已经使用包装在 using 语句中的 LoadAndCloseReader(rdr)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-30T04:58:05.003

这是我最近在遇到类似问题后才发现的。

正如 Rob 所说，它不应该这样使用：

```
MyTableCollection objCol = new MyTableCollection().Load(); 
```

它应该像这样使用：

```
MyTableCollection objCol = new MyTableCollection();
objCol.LoadAndCloseReader(MyTable.FetchAll()); 
```

# mvvm - MVVM - ViewModel which is also a region?

> ID：690836
> 
> 赞同：1
> 
> 时间：2009-03-27T17:59:24.630
> 
> 标签：mvvm

I have a "DataRegion" that is an ItemsControl. I add ViewModels to it and through DataTemplating the views are rendered.

My question is that this ItemsControl now needs logic to do with setting up Commands in menus for the Items (they can't do it themselves as it the logic is dependendant on the number of items, i.e. there must be one item visible all the time)

I want it to be a ViewModel, but can't work out how to instaniate it and associate it to the items control?

I can't bind it to the items control as the region will throw an error. I have added it as a property to the shell and it currently accesses the region views to get to the child viewmodels that it needs to control.

Any better ideas?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-30T08:42:58.283

这类似于[Prism 2 SL：单击按钮时从区域中删除视图](https://stackoverflow.com/questions/651460/prism-2-sl-remove-view-from-region-when-button-clicked)

我也将为此使用一个控制器类。

# .net - 是否有概述通用 .NET 错误消息原因的地方？

> ID：690839
> 
> 赞同：0
> 
> 时间：2009-03-27T18:00:12.163
> 
> 标签：.net, exception

我得到的具体错误是 System.ArgumentException，带有“值不在预期范围内”的消息。

我想具体知道是什么导致了这个错误（我怀疑是某种溢出），但我也想知道是否有一个地方列出了这些通用的 .NET 消息及其原因。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T18:10:49.923

如果您知道类和方法（如堆栈跟踪所示），那么您应该能够使用[Reflector](http://www.red-gate.com/products/reflector/)找出问题所在（假设异常消息没有告诉您）。

要回答您问题的后面部分，您可以使用 Reflector->F3->ArgumentException，双击结果并按 Ctrl+R 来分析它在哪里使用。这样，您可以指定 BCL（各种版本）或您喜欢的任何程序集（只需在 Reflector 中加载）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:03:00.583

您需要查看堆栈跟踪 - 堆栈跟踪 + 消息的组合通常足以使异常易于理解。

如果是框架类型抛出异常，在 sdtack 跟踪中找到第一个公共方法调用，并在 MSDN 上查找。这应该解释该方法期望什么以及可能导致异常的其他内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:04:06.697

不幸的是，我们需要更多信息来提供帮助。

使用的异常和特定的错误消息是库创建者的责任。不幸的是，这种类型的“非常通用”的异常消息在许多编写不佳的库中很常见。

异常消息*应该*非常具体，所以很明显是什么导致了异常。在这种情况下，由于它是一个 ArgumentException，堆栈跟踪应该为您提供足够的信息来破译哪个方法引发了异常。更好的消息会明确哪个参数是无效的，但这取决于库的作者来实现。

# compact-framework - OpenNetCF SDF 与 .Net CF 3.5

> ID：690840
> 
> 赞同：1
> 
> 时间：2009-03-27T18:00:14.880
> 
> 标签：compact-framework, smart-device-framework

通过 SDF 的文档，我发现了许多类，例如 BitmapEx 类或 TextBox2 类。我可以看到他们的成员，但我找不到任何文字向我解释为什么我需要使用它们而不是 .Net CF 3.5 中给出的内容

所以，我要求的是 [一份文件] 或某人来解释**SDF 类如何或为什么比它们的 CF 类更好。**现在，位图和文本框只是示例。如果我能更多地了解框架本身以及如何使用它，那就更好了。

仅作为背景：

我正在为手机开发 OCR 解决方案。它使用手机功能进行整个处理和检测。该应用程序能够在 HTC Diamond 上在大约 80 秒内将包含 7 行文本的 800x600 图像区域分割 [成字符]。我相信我应该能够提高性能。现在我完全没有做任何性能优化。我正在阅读很多关于优化等的文章......当我遇到我无法解决的问题时，会发布一些关于这些主题的单独问题......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-08T22:58:10.660

SDF 类的设计并不比 CF 类“更好”——它们在很大程度上是 CF 提供的类的扩展。在许多情况下，它们提供了完整框架可能具有但 CF 省略的方法、属性等。

显然，这是一种过度简化 - 例如，整个 OpenNETCF.WindowsCE 命名空间纯粹是 FFx 或 CF 中不存在的功能，但作为一般答案，它就是这样工作的。

SDF 不是 CF 的替代品，而是它的扩展。

# regex - 用于验证 URL 的 preg

> ID：690849
> 
> 赞同：1
> 
> 时间：2009-03-27T18:02:53.000
> 
> 标签：regex

我正在寻找用于验证 url 的“防弹”preg 表达式。以下地址的正则表达式应该为真

```
ftp://usernam@someurl.com
http://hh-1hallo.msn.blabla.com:80800/test/test/test.aspx?dd=dd&id=dki
http://twitter.com/test
http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd
远程登录：//example.org:8888
http://www.google.com/search?q=good+url+regex&rls=com.microsoft:*&ie=UTF-8&oe=UTF-8&startIndex=&startPage=1
ftp://joe:password@ftp.filetransferprotocal.com
https://some-url.com?query=&name=joe?filter=*.*#some_anchor

```

但应该返回 false 到以下：

```
http    .org    /TR/xhtml1/DTD/xhtml1-transitional.dtd
http://hh-1hallo. msn.blablabla.com:80800/test/test.aspx?dd=dd&id=dki 
google.com
example.org 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T18:37:35.867

干得好：

```
\^(https?|ftp|telnet):\/\/((?:[a-z0-9@:.-]|%[0-9A-F]{2}){3,})(?::(\d+))?((?:\/(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\?((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?$/i 
```

这是基于在此处找到的代码：[http](http://snipplr.com/view/6889/regular-expressions-for-uri-validationparsing/) ://snipplr.com/view/6889/regular-expressions-for-uri-validationparsing/并进行了多次编辑。

您可以在此页面上对其进行测试： [http](http://regexpal.com/) ://regexpal.com/ （将正则表达式粘贴为：

```
^(https?|ftp|telnet):\/\/((?:[a-z0-9@:.-]|%[0-9A-F]{2}){3,})(?::(\d+))?((?:\/(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\?((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))? 
```

并选择“不区分大小写”）

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:19:15.833

[像RegExLib.com](http://regexlib.com/Search.aspx?k=url)（“url”部分）这样的网站有什么问题？

你应该找到你需要的东西并在那里自己测试它。

无论如何，这个正则表达式验证你想要什么并排除你不想要的。

```
(?ms)^(https?|ftp|telnet):\/\/((?:(?:(?=[^\r\n]*@)\w|-)+(?:(?::)(?:\w|-)+)?)?)@?((?:(?:(?:\w|-)+)\.)+(?:\w|-)+)(\:\d+)?((?:(?:/(?:\w|-)+(?:\.(?:\w|-)+)?)+)?)((?:\?(?:(?:\w|-)+\=(?:\w|[\.\-\*\:\+\#])*\&?)+)*)$ 
```

和：

*   第一组：协议
*   第 2 组：用户名[:密码]
*   第 3 组：域 (www.xxx)
*   第 4 组：空
*   第 5 组：地址 (XX/yyy/zzzz)
*   第 6 组：参数 (?key1a=value1a&key2a=value2a?key1b=value1b&key2b=value2b...)

# sql-server-2005 - 更新 SQL Server 中的自动增量列

> ID：690855
> 
> 赞同：10
> 
> 时间：2009-03-27T18:05:12.557
> 
> 标签：sql-server-2005

我需要更改 SQLSERVER 2005 数据库表的一行中的一个 PK 值。PK 当前是自动递增的。

一种可能性是暂时从密钥中删除自动增量，进行修改，然后将其放回原处。

该数据库正在生产中。有没有办法在不关闭数据库的情况下安全地进行此更改？

为什么？我的客户想要其中一条记录的特定 ID。

我害怕什么？我担心在修改密钥时将记录添加到数据库中，并且它会以某种方式弄乱另一个使用该字段作为 FK 的表上的索引？我疯了吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-27T18:16:09.023

更新不起作用 - 您必须插入新记录并删除旧记录...

```
set identity_insert mytable on

insert mytable (myidentitycolumn, someothercolumn) 
select 42, someothercolumn
from mytable
where myidentitycolumn = 1;

delete mytable where myidentitycolumn = 1;

set identity_insert mytable off 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T18:13:49.480

您只能通过删除身份并重新创建它来进行更新。但是，您也可以将身份插入设置为 ON（[http://msdn.microsoft.com/en-us/library/aa259221(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa259221(SQL.80).aspx)）并使用所需的身份 val 插入新行，打开 ident insert关闭，然后删除旧的。你为什么要这样做？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T18:20:54.487

```
SET IDENTITY_INSERT yourTable ON

INSERT INTO yourTable (col1, col2, col3)
select newID, col2, col3
FROM yourTable
WHERE currentID = xxx

SET IDENTITY_INSERT yourTable OFF 
```

您可能希望锁定表以防止在 IDENTITY_INSERT 开启时其他插入失败。

编辑：废话，我忘记了关于删除原始记录的明显一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-29T17:05:32.147

```
DECLARE @counter int
SET @counter = 0
UPDATE #tmp_Users
SET @counter = counter = @counter + 1 
```

# php - 用于 Turn-Key Web 应用程序的 Django 或 CodeIgniter

> ID：690856
> 
> 赞同：8
> 
> 时间：2009-03-27T18:05:22.760
> 
> 标签：php, python, django, codeigniter

我将为垂直市场构建一个交钥匙解决方案，并希望提供两种选择：软件即服务，并让他们有机会自行托管应用程序。换句话说，我的目标是拥有与 Joel 的 FogBugz 类似的部署选项。

我是一名 Python 程序员，我可以用 Django 飞越这个项目。不过，我更喜欢 PHP 有几个原因：

1) Django 安装和配置假定您可以访问 shell（我的目标不是程序员类型）。虽然我可以提供安装服务，但不能在他们的服务器上。

2) Django 只在一些必须特别注意启用它的特定主机上运行。安装 mod_python/mod_wsgi，很可能我的少数潜在客户将拥有 root 访问权限，甚至是 cpanel。

3) 使用 PHP 意味着我可以在他们现有的服务器上运行它。在 DNS 更新时，我无需将它们移动到支持 Django 的服务器上，也无需为他们的电子邮件停机。

另一方面，我对 PHP 的经验很少。Smarty 作为一种模板语言看起来不错，并且与 Django 模板类似。但是它不提供模板继承，除非我不希望以一种非常骇人听闻的方式使用它，因为如果设计者把它们弄乱了，它可能会破坏应用程序。你怎么看？提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T19:46:19.960

对于所有非基于 PHP 的 Web 应用程序来说，部署显然是一个问题，但我认为使用提供 Ruby/Python 等开箱即用的 DreamHost/Engineyard 类型的 ISP 会变得更好。看起来本周 PyCon 上将会有很多关于解决部署问题的方法的讨论。Django、Turbogears 和 Pylons 的普及正在推动对更好的部署解决方案的需求。

也就是说，如果您的目标市场是托管在非常低端的每年 12 美元类型的 ISP 上的人，那么我认为您除了 PHP 之外别无选择。

最后，我不同意你的一件事是在同一台服务器上运行 PHP 和 Django。我在我的服务器上使用 Apache 运行了一些 PHP 应用程序，并在守护程序模式下使用 mod_wsgi 运行了数十个 Django 站点。以这种方式运行它意味着 Python 解释器不会在 Apache 工作人员中用完 ram，反之亦然，PHP 解释器不会污染我的 mod_wsgi 守护进程 :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T21:34:50.650

如果您希望您的应用程序成为主流，那么您几乎被迫使用 PHP。从 Django 到 PHP 比从 PHP 到 Django 容易得多。你知道标准，你只需要学习 PHP 的语法和函数。

我肯定会使用 PHP 框架。Symfony 和 akelos 与 Rails 非常相似（接近 Django）。另一方面，Code Igniter 会做它应该做的事情——组织你的代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T15:06:57.610

根据您自己的结论，我会选择 CodeIgniter。似乎需要做大量工作来帮助您的客户安装您的网络应用程序，而我认为您不希望这样做。

构建一个易于安装的 Web 应用程序，以便您可以集中精力改进和销售它，而不是作为系统管理员额外工作或编写大量安装教程。

（话虽如此，FogBugz 并不容易安装在我们的 Linux 服务器上，即使它是用 PHP 编写的。我和我的同事（都是程序员！）花了一个多工作日的时间来安装。所以我认为会有安装自托管 Web 应用程序总是有问题。）

# javascript - 如何在Javascript中进行“软”条件检查

> ID：690858
> 
> 赞同：4
> 
> 时间：2009-03-27T18:05:41.870
> 
> 标签：javascript

就像你在 php 中所做的那样：

```
if (@$some_var_exists)
    // do stuff 
```

你如何在 Javascript 中做这样的事情而不会出错？

谢谢

编辑：感谢您的回答。但是，我要解决的问题是如何检查变量是否存在于对象深处，例如：

```
if (someObj.something.foo.bar)
  // This gives an error in the browser if "someObj.something.foo" is not defined. 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-27T18:07:55.873

要检查是否定义了变量，您可以执行以下操作：

```
if(self.somevar) {
    ...
} 
```

正如 Mister 在评论中指出的那样，这`self`部分在这里很重要。

或者，如果您希望更明确，您可以这样做：

```
if(typeof somevar != "undefined") {
    ...
} 
```

您检查 PHP var 的方式也不是很整洁，也不是最佳实践，因为`@`错误抑制器很昂贵，在这种情况下不是必需的。你可以这样使用[`isset`](http://www.php.net/isset)：

```
if(isset($some_var_here)) {
    ...
} 
```

**编辑**：
对于您更具体的问题，我认为@Ryan Watkins 的回答是解决问题的方法，尽管我不得不想知道您为什么将自己置于这样的位置。:)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-27T18:30:12.687

检查链的每个部分：

```
if (someObj && someObj.something && someObj.something.foo && someObj.something.foo.bar) {
   // stuff
} 
```

因为表达式是从左到右求值的，一旦发现为假就返回，所以不会报错。因此，如果 "someObj" 存在，但 "sometObj.something" 不存在，它将返回 false 并且永远不会为 someObj.something.foo 执行会引发错误的测试。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T19:48:03.933

@Scott Evernden 和 @Andrew Hedges 有迄今为止唯一完全正确的答案。只是做类似的事情

```
if (variable) 
```

或者

```
if (someObj && someObj.something && ... && someObj.something.foo.bar) 
```

通常是不正确的，因为如果`someObj.something.foo.bar`存在，但为零或为假，则条件将为假。只有当**所有属性都是对象**（不是数字、布尔值，甚至是字符串）并且**`someObj`存在时**，它才会起作用。

通常检查存在的唯一正确方法是`typeof variable !== "undefined"`，`variable !== undefined`（如果您知道它已被声明）`"property" in variable`，或，取决于您所说的“存在”，`object !== null`。`try/catch`也可以工作，但这似乎很乱。

当你有一个长链时，没有必要检查*每个*步骤的正确类型/空/未定义/等；只要每个中间值都是一个对象（不是碰巧有额外属性的数字、字符串或布尔值），它们就会评估为真。

```
if (typeof someObj !== "undefined" && someObj &&
    someObj.something &&
    someObj.something.foo &&
    typeof someObj.something.foo.bar !== "undefined") {
    // someObj.something.foo.bar exists, but you may need to check for null
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-27T19:23:07.753

以下应该是防弹的，但是很麻烦，并且只有在您提前了解整个链条时才有效：

```
if ('undefined' !== typeof someObj &&
    'undefined' !== typeof someObj.something &&
    'undefined' !== typeof someObj.something.foo &&
    'undefined' !== typeof someObj.something.foo.bar) {
    // do some stuff
} 
```

您最好按照 Chetan 的建议做，并使用 try/catch 块代替：

```
try {
    if ('undefined' !== typeof someObj.something.foo.bar) {
        // do some stuff
    }
}
catch (e) {} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-27T18:08:50.663

比那个简单..

```
if(varname){
      ...
} 
```

这适用于变量，而不是对象。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T18:30:41.950

在测试变量是否存在时，您永远不应该*盲目地*使用该变量名称进行测试。在查找深度嵌套对象的属性和方法时也是如此。

考虑到这一点：

```
// error will occur if someObj has not ever been defined in your code.
if (someObj) {
  // someObj has been defined
} 
```

您可以通过针对全局范围（在浏览器中为窗口级别）进行测试来解决此问题并使用最少的代码。

```
// safe way to test for global variable.
if (window.someObj) {
  // someObj has been defined
} 
```

对全局变量的另一个很好的测试是使用内置的*typeof*方法，但是如果你必须经常这样做，它会有点乏味。

```
// another safe method for testing a global variable
if (typeof someObj != "undefined") {
  // someObj has been defined
} 
```

现在用于测试深层嵌套对象（通常在 JS 中用作伪命名空间）。

```
// testing deep nested object
if (self.someObj && 
    someObj.something && 
    someObj.something.foo && 
    someObj.something.foo.bar) {
  // do something ...
} 
```

**给高级编码员的最后两个快速说明：**

有时在 IE 中我注意到，如果我正在测试它，那么执行这种类型的查找/存在测试实际上已经调用了该方法。例如：

```
// this is an example, I can't recall which actual methods did this off-hand
if (document.execCommand) {
  // resultant value of execCommand method gets used to pass/fail the conditional
} 
```

最后，此类存在查找的一个非常轻微的副作用是，当您将一个 getter 应用于该属性时，它实际上会在条件测试期间运行该 getter。

```
// this code only runs in Firefox 2+
// and is provided for instructional purposes only
var foo = {
  get bar() { alert("bar getter was executed") }
};
if (foo.bar) {
  // a foo.bar property is defined
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-27T18:37:30.907

```
if (typeof somevar === "undefined") {
    // then the variable doesn't exist 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T18:09:03.297

如果对象不存在，Javascript 将在 if 语句中返回 false

```
var myObj = {};
if (myObj.someUnknown)
{
  // will not get here if someUnknown doesn't exist.
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-27T18:35:29.350

```
function isVarDefined(str) {
    try { 
        return (typeof eval(str) !== 'undefined');
    }
    catch(e) {
        return false;
    }
} 
```

将变量名称作为字符串传递。例如：

```
isVarDefined('someObj.something.foo.bar') 
```

PS：评估是邪恶的。您应该清理 str 的值，使其仅包含一个变量名，而不是一些任意的可执行代码。作为练习留给你！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-27T21:05:10.097

如果你需要做很多事情，如果属性存在则获取属性并返回 undefined 的函数版本是：

```
function propertyChain(root, chain) {
    var properties = chain.split(".");
    var obj = root;
    while (properties.length) {
        if (typeof obj === "undefined" || obj === null)
            return undefined;
        obj = obj[properties.shift()];
    }
    return obj;
} 
```

以便：

```
if (propertyChain(someObj, 'something.foo.bar')) 
```

本质上是以下的非抛出版本（假设您已声明 someObj）：

```
if (someObj.something.foo.bar) 
```

# bash - 从 sh 到 Bash 的替换和新做法是什么？

> ID：690868
> 
> 赞同：2
> 
> 时间：2009-03-27T18:08:06.560
> 
> 标签：bash, unix, shell

作为一个在 20 年前编写了大量 sh 脚本的人，现在又回到了它，我发现我正在使用被认为已经过时的技术。我应该花时间阅读“最新消息”，但我没有。而且效率不是很高。例子：

```
 Instead of             use 

 tmpfile=/tmp/me$$      tmpfile=`mktemp`

 [ ]                     [[ ]] 
```

将原始 Bourne shell 与 BASH 进行比较，您认为哪些变化很重要？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T19:06:27.840

只是一个味道：

*   忘记**[**，学习**[[**：

    *   [[ 中未引用的变量不会发生分词或路径名扩展。
    *   您可以使用 = 进行 glob 模式匹配： [[ $foo = *.txt ]] （foo 以 .txt 结尾）
    *   您可以使用 =~ 进行 ereg 模式匹配： ereg='.*.txt'; [[ $foo =~ $ereg ]]
    *   你可以使用 &&, || 和 ( ) 在测试中： [[ $bar && ( $foo = *.txt || $foo = *.bar ) ]]
    *   问题：= 的 RHS 被认为是一个全局模式： bar='I pinch??'; [[ "I pinched" = $bar ]] # 测试通过。
*   使用 (( )) 表示所有数字。

例如。

```
(( ++count ))
(( $# )) || { echo "Expected an argument to the script." >&2; exit 1; } 
```

*   一些可爱的 IO 操作符，如 <()、<<< 等。

例如。

```
read filesize _ < <(wc -c myfile)
openssl base64 <<< "Bar!" # as opposed to the more expensive: echo "Bar!" | openssl base64
content=$(<file) # as opposed to the more expensive: content=$(cat file) 
```

*   忘记不推荐使用的语法，例如 `` 。新语法通常具有重要的优势。$() 很容易嵌套（只是你尝试巧妙地嵌套 ``），在 $() 中引用很容易（再次，它在 `` 中是一团糟）等等。

例如。

```
rm "$(grep -l foo <<< "$(</my/file.list)")" 
```

*   数组，数组，数组。每当您需要保留多个字符串（如文件名！）时，请将它们保存在数组中。不要将它们放在使用某种分隔符来分隔单独字符串的单个字符串中，这种方法总是有缺陷的。

例如。

```
files=(/foo/*); for file in "${files[@]}"; do pinch "$file"; done 
```

更多信息，请查看以下地点。它们可能是最有用和最值得信赖的 Bash 资源：

*   [http://mywiki.wooledge.org/BashGuide](http://mywiki.wooledge.org/BashGuide)
*   [http://mywiki.wooledge.org/BashSheet](http://mywiki.wooledge.org/BashSheet)
*   [http://mywiki.wooledge.org/BashFAQ](http://mywiki.wooledge.org/BashFAQ)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:19:10.870

这可能不是您问题的直接答案，但我认为其中一些“陷阱”来自 sh 习惯：

[http://wooledge.org:8000/BashPitfalls](http://wooledge.org:8000/BashPitfalls)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T18:20:43.097

对于脚本，除非有特殊原因，否则我将自己限制在 Bourne 构造中。它们具有最大的可移植性，并且应该在使用 bash、ksh 甚至 sh 作为其默认 shell 的系统上运行。

我发现任何实际的性能差异都很小（秒表计时）；如果性能既重要又受外壳限制，我会将时间关键部分移至编译语言。更现代的 shell 的额外功能非常棒，我以交互方式使用它们，或者可能用于临时快速脚本。但是，如果我要分发和维护代码，我发现忽略扩展可以节省我的时间和精力。

如果您对 Bourne shell 语法感到满意，并且可以使用 Bourne shell 使脚本执行您想要的操作，那么请不要为扩展而烦恼。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T18:23:46.460

代替

```
tmpfile=`mktemp` 
```

采用

```
tmpfile=$(mktemp) 
```

一般推荐的做法（它嵌套更好）

我在 bash4.0 的发布中还注意到一些脚本中的这种情况。

```
foo="$( some   
          multiline 
          command  in a string)" 
```

自 4.0 以来我一直发现的问题是在这种情况下也需要明确转义换行符，所以

```
foo="$( some \ 
          multiline \
          command  in a string)" 
```

被推荐。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T16:10:42.670

添加到这里已经存在的内容：

现代 shell 中的字符串处理更好。使用较旧的 sh，您可以使用`${var##pattern}`and`${var%%pattern}`构造，但是使用 bash 和 ksh93（以及其他不太常见的 shell），您可以获得可以进行字符串替换的运算符（例如`${var/source/replace}`）。

extglob 正则表达式支持也相当方便，虽然不是全新的，但老派 shell 程序员通常没有充分利用它

```
[[ "$str" = @(+([a-z])?([0-9])) ]] 
```

匹配所有字母数字或以一个数字结尾的字母数字的字符串。我一直在 ksh88 中使用它...

然后是变量变量 ( `var=hello; hello=hi; echo $$var`) 和数组，它们大到可以实际使用。数组是另一种老派 shell 开发人员经常利用不足的东西，部分原因是旧 shell 中存在 1024 个元素的限制——现代 shell 至少支持 4096 个元素，其中大多数支持关联数组（perl 称它们为哈希）。

# oop - 初学者的松散耦合和 OO 实践

> ID：690869
> 
> 赞同：7
> 
> 时间：2009-03-27T18:08:20.320
> 
> 标签：oop, loose-coupling

保持类松散耦合是编写易于理解、修改和调试的代码的一个重要方面——我明白这一点。然而，作为一个新手，几乎任何时候我都会超越我所苦苦挣扎的最简单的例子。

我或多或少地了解如何将字符串、整数和简单数据类型封装在它们自己的类中。然而，当我开始处理诸如富文本格式之类的信息时，事情变得非常复杂——除非我只使用组件中已经存在的各种方法。继续这个例子，假设我正在编写一些在 UI 中包含 RTF 备忘录组件的东西。在 Delphi 中，该组件具有用于执行诸如保存格式化文本之类的内置方法。此外，有时似乎唯一（或至少是最好的）处理 RTF 文本本身的方法是通过再次内置到组件中的方法。

当我已经有一个组件为我完成所有这些工作时，我将如何（或为什么）在另一个类中完成保存、加载和格式化文本的所有工作？

就我自己而言，我通常最终要么 (a) 做一些看起来比需要复杂得多的事情，重新发明已经存在的方法，或者 (b) 创建仍然彼此紧密耦合的糟糕的类。正如他们在非正式广告中所说的那样，“必须有更好的方法！”

我只是在概念上迷失了“更好的方式”是如何工作的。有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T18:24:35.100

我会建议两个概念，接口和依赖注入，作为解耦类的一种方式。接口为您提供了一种定义独立于任何实现的契约或一组预期行为的方法。当你有一个类依赖于一个接口而不是一个类时，你可以自由地替换实现该接口的其他类，而不必重写依赖于它的类。

当您使用具有依赖注入的接口时，即为类提供它要处理的实际实现而不是让它自己创建特定的实现，您可以在应用程序中实现更多的解耦。现在这个类只知道接口，甚至不知道如何创建它，只是使用它。依赖注入通常与创建模式（例如 Builder 或 Factory）一起使用，在这些模式中，您将对象的构造本地化在单个类中，以便在使用其他类扩展应用程序时只需要更改该类。

另外，请记住耦合（及其孪生兄弟内聚）是一种相对度量。您无法消除所有耦合，否则您的对象将无法交互。有一定程度的依赖是必要的。您还需要平衡它与易用性和实施​​。

至于您的特定示例，没有实际代码很难说。我怀疑您过度设计了解决方案并违反了 DRY 原则（不要重复自己）。您可能需要研究使用接口的方法，也许还需要一个轻量级包装器来将您的类与框架组件分离，而不是完全重新实现。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-27T18:30:05.680

我相信你错过了一些基本概念。

[OOP](http://en.wikipedia.org/wiki/Object-oriented_programming)背后的想法始于离散的、可重用的逻辑单元。强调创建自给自足的模块。

对于 RTF 备忘录组件，它通过处理给定的一组数据（备忘录）来满足上述标准，这样您的程序和程序中的其他对象就不会关心它是如何工作的。它的目的是显示一个界面，接受数据，操作该特定数据，并将该数据传递给程序的另一部分。

[松散耦合](http://en.wikipedia.org/wiki/Loosely_Coupled)背后的想法很简单，就是您可以用另一个满足相同接口规范的控件替换该备忘录控件。也就是说，您可以实例化它，让用户与之交互，并在必要时提取数据。

松散耦合与**[关注点分离](http://en.wikipedia.org/wiki/Separation_of_concerns)**(SoC) 的理念密不可分；这是将程序分解为不同功能以减少重叠功能并使管理更容易的过程。但它们不是一回事。顺便说一句，这也是从程序化编程风格转向 OOP 背后的主要驱动力之一。由于 OOP 迫使编程根据相关和离散的功能进行思考。

听起来你真的在问 SoC。

实现SoC的方法有很多。有时它涉及将 UI、处理逻辑和持久层分开（例如，考虑 MVC 设计模式）。有时只是将相关功能放在一起以降低复杂性；RTF 控件已经通过包含操作数据所需的所有函数来实现这一点，这样您就没有进一步的依赖关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:11:35.757

好吧，我对这个问题并不完全清楚，但似乎策略模式在这里可以工作。

基于您的父 RTF 对象构建一个对象，但将用于存储等的处理方法设置为具有自己方法的已定义对象。

这可以在不严格继承所有父方法的情况下启用组合功能，并且您不必构建巨大的自定义对象，只需替换您需要的方法即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T22:57:03.747

您选择的示例相当复杂。

当您说 rtf 备忘录组件非常松散耦合时，您是对的。如此松散，以至于它实际上是不可扩展的，并且只能按原样使用，因为它集成了表示/视图、控制器和模型。

如果您想查看设计良好、可扩展的富文本系统的示例，请查看[OS X 文本系统](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/TextArchitecture/TextArchitecture.html)（或 Gnustep，如果您想阅读代码）的文档。它很复杂，因为需要做出很多设计决策，并且需要从一个模块隐藏到另一个模块。在那里，您可以直接以良好的结构工作。

rtf memo 组件的使用范围有限，您可能必须使用设计良好的类来解决这个问题：

*   仅当您不必将程序中的其他数据保存在同一文件/数据库中时，组件数据的加载和保存才有意义。
*   它也不能很好地处理大量数据。
*   而且它只理解 rtf 的一小部分。

# java - AffineTransform：从中心缩放形状

> ID：690871
> 
> 赞同：7
> 
> 时间：2009-03-27T18:08:39.680
> 
> 标签：java, swing, geometry, shape, affinetransform

我正在尝试使用 AffineTransform 从其中心缩放一个矩形。我确信解决方案是显而易见的，但我无法让它发挥作用！这是我到目前为止测试过的...

```
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Rectangle;
import java.awt.geom.AffineTransform;

import javax.swing.JOptionPane;
import javax.swing.JPanel;

public class Test extends JPanel {
    Test()
        {
        super(null);
        setOpaque(true);
        setBackground(Color.WHITE);
        setPreferredSize(new Dimension(200,200));
        }
    @Override
    protected void paintComponent(Graphics g1) {
        super.paintComponent(g1);
        Rectangle r= new Rectangle(5,5,getWidth()-10,getHeight()-10);
        double cx= r.getCenterX();
        double cy= r.getCenterY();
        Graphics2D g=(Graphics2D)g1;
        g.setColor(Color.BLACK);
        AffineTransform old= g.getTransform();
        for(double zoom=0.9; zoom>=0.5; zoom-=0.1)
            {
            AffineTransform tr2= new AffineTransform(old);
            tr2.translate(-cx, -cy);
            tr2.scale(zoom, zoom);
            tr2.translate(cx/zoom,cy/zoom);
            g.setTransform(tr2);
            g.draw(r);
            g.setTransform(old);
            }
        }

    public static void main(String[] args) {
        JOptionPane.showMessageDialog(null, new Test());
        }
    } 
```

但它不起作用....有什么建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T18:24:56.240

假设缩放固定矩形左上角的位置（我认为这是正确的，但自从我用 Java 完成图形以来已经很长时间了），您需要将矩形平移到与缩放相反的方向。

```
tr2.translate(
    r.getWidth()*(1-zoom)/2,
    r.getHeight()*(1-zoom)/2
);
tr2.scale(zoom,zoom);
g.setTransform(tr2); 
```

因此，您将矩形向左和向上移动宽度和高度变化的一半。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-30T22:18:16.030

当您处理矩形时，我明白您的意思。原因是翻译的初始计算没有考虑容器对象的大小。

改用这个：

```
tr2.translate(
    (this.getWidth()/2) - (r.getWidth()*(zoom))/2,
    (this.getHeight()/2) - (r.getHeight()*(zoom))/2
);
tr2.scale(zoom,zoom);
g.setTransform(tr2); 
```

这样做是在缩放之前将矩形平移到面板的中心。在我的测试中，它工作得很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-08-04T13:43:04.797

我正在开发一个桌面应用程序来裁剪布兰妮斯皮尔的脸（白天）裁剪矩形必须围绕其中心点进行缩放：

```
import javafx.scene.Cursor;
import javafx.scene.Group;
import javafx.scene.input.MouseEvent;
import javafx.scene.input.ScrollEvent;
import javafx.scene.paint.Color;
import javafx.scene.paint.Paint;
import javafx.scene.shape.Rectangle;

class ResizableRectangle extends Rectangle {

 ResizableRectangle(double x, double y, double width, double height, Group group) {

  super(x, y, width, height);

  // Set scroll listener for crop selection
  group.addEventHandler(ScrollEvent.SCROLL, event -> {
   double zoomFactor = 1.10;
   double deltaY = event.getDeltaY();
   if (deltaY > 0) {
    zoomFactor = 2.0 - zoomFactor;
   }

   super.setX(getX() + (super.getWidth() * (1 - zoomFactor) / 2)); // Set new X position
   super.setWidth(getWidth() * zoomFactor); // Set new Width

   super.setY(getY() + (super.getHeight() * (1 - zoomFactor) / 2)); // Set new Y position
   super.setHeight(getHeight() * zoomFactor); // Set new Height

   event.consume();
  });
 });
} 
```

一般来说，算法是这样工作的：

*   转换矩形 x 值：`x + (width * (1 - zoomFactor) / 2)`
*   转换 y 值：`y + (height * (1 - zoomFactor) / 2)`
*   将新宽度设置为：`width * zoomFactor`
*   将新高度设置为：`height * zoomFactor`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T19:06:28.993

这涉及一个称为共轭变换的过程。

如果 S 是您想要进行的缩放，而 T 是将点 (0,0) 带到要成为缩放中心的点的变换，那么完成这项工作的变换是

T(S(逆(T)))

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-23T12:36:30.797

（稍后）这是一个解决方案，无需事先了解面板的维度。

```
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Shape;
import java.awt.geom.AffineTransform;
import java.awt.geom.Ellipse2D;

import javax.swing.JOptionPane;
import javax.swing.JPanel;

public class Test extends JPanel
    {
    private static final long serialVersionUID = 1L;
    private Test()
        {
        super(null);
        setOpaque(true);
        setBackground(Color.WHITE);
        setPreferredSize(new Dimension(600,600));
        }

    @Override
    protected void paintComponent(Graphics g1) {
        super.paintComponent(g1);
        Shape r= new Ellipse2D.Double(5,380,400,200);
        double cx= r.getBounds2D().getCenterX();
        double cy= r.getBounds2D().getCenterY();
        Graphics2D g=(Graphics2D)g1;
        g.setColor(Color.BLACK);
        AffineTransform old= g.getTransform();
        g.drawLine((int)cx-10, (int)cy, (int)cx+10, (int)cy);
        g.drawLine((int)cx, (int)cy-10, (int)cx, (int)cy+10);
        for(double zoom=1; zoom>=0.1; zoom-=0.1)
                {

                AffineTransform tr2 =AffineTransform.getTranslateInstance(-cx, -cy);
                AffineTransform  tr= AffineTransform.getScaleInstance(zoom,zoom);
                tr.concatenate(tr2); tr2=tr;
                tr =AffineTransform.getTranslateInstance(cx, cy);
                tr.concatenate(tr2); tr2=tr;

                tr= new AffineTransform(old);
                tr.concatenate(tr2);  tr2=tr;

                g.setTransform(tr2);

                g.draw(r);
                g.setTransform(old);
                }
        }

    public static void main(String[] args) {
        JOptionPane.showMessageDialog(null, new Test());
        }
    } 
```

# c# - InvalidArgument=“3”的值对“rowIndex”无效

> ID：690872
> 
> 赞同：0
> 
> 时间：2009-03-27T18:08:44.390
> 
> 标签：c#

这是我的代码它适用于如果 1 个终端具有 3 个服务，但当我这样做时它不能用于超过 3 个服务，那么我收到以下错误消息：

InvalidArgument=“3”的值对“rowIndex”无效

我很累找到这个问题，但找不到任何解决方案。任何人请帮助我。

```
MySqlCommand command = new MySqlCommand("VTerminalsLoad");//Procedure
MySqlDataAdapter terminalAdapter = this.Database.ExecuteCommand(command);
terminalAdapter.Fill(dataSet, "Terminals");

command = new MySqlCommand("VTServicesLoad");//Procedure
command.Parameters.Add(new MySqlParameter("pVesselID", 1));
MySqlDataAdapter serviceAdapter = this.Database.ExecuteCommand(command);//Return Adaptor
serviceAdapter.Fill(dataSet, "Services");

DataColumn[] parentColumns = { dataSet.Tables[0].Columns["SerialNo"], 
             dataSet.Tables[0].Columns["VesselID"], 
             dataSet.Tables[0].Columns["TerminalID"] };

DataColumn[] childColumns = { dataSet.Tables[1].Columns["SerialNo"], 
             dataSet.Tables[1].Columns["VesselID"], 
             dataSet.Tables[1].Columns["TerminalID"] };

DataRelation relationTS = new DataRelation("TerminalsServices", parentColumns, childColumns);
dataSet.Relations.Add(relationTS);

//Parent Table
ListTerminal.DataSource = dataSet;      //ListTerminal Parent datagridview  
ListTerminal.DataMember = "Terminals";

//Child Table
ListServices.DataSource = dataSet;// ListServices Child datagridview
ListServices.DataMember = "Terminals.TerminalsServices"; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-07T04:31:41.590

请参阅[http://connect.microsoft.com/VisualStudio/feedback/details/116413/datagridview-exception-with-readonly-cells](http://connect.microsoft.com/VisualStudio/feedback/details/116413/datagridview-exception-with-readonly-cells)

在以下情况下会出现此问题： 1\. DataGridView 绑定到 DataRelation 2\. 您尝试在“BindingCompleted”之前将第一行中的 DataGridViewCell 设置为 ReadOnly（例如：DataGridView 的 On RowsAdded 事件）

您可以通过将 ReadOnly-Setting 操作延迟到 BindingCompleted 来解决此问题

希望这可以帮到你。

# c# - 为什么只有在设置了两个参数时，以下才会带回数据？

> ID：690878
> 
> 赞同：1
> 
> 时间：2009-03-27T18:10:08.943
> 
> 标签：c#, asp.net, sqldatasource

如果我在 Sql Management Studio 中运行 SearchMaster 和 SearchDetails 这两个过程，当我在设计视图中设置存储过程时测试查询时，SearchMaster 甚至运行良好，但是当我运行它时，如果我没有创建行只输入 frn 或业务的信息。如果我同时输入，如果匹配，我会得到数据。参数设置是否正确？另外，如果我在程序中将参数初始化为null，是否还需要使用ConvertEmptyStringToNull？

这是 SearchMaster 存储过程：

```
CREAETE PROCEDURE SearchMaster
@business nvarchar(300) = NULL,
@frn nvarchar(10) = NULL
AS
SELECT h.Business,
       hrl.frn
FROM registration hrl
INNER JOIN holder h on h.call = hrl.call
WHERE (@business IS NULL OR h.Business like '%' + @business + '%') 
AND (@frn IS NULL OR hrl.frn = @frn) 
```

这是 SearchDetails 存储过程：

```
CREATE PROCEDURE SearchDetails
@business nvarchar(300) = NULL,
@frn nvarchar(10) = NULL
AS
SELECT hrl.call 
FROM registration hrl 
INNER JOIN holder h ON h.call = hrl.call
WHERE (@business IS NULL OR h.Business LIKE '%' + @business + '%') 
  AND (@frn IS NULL OR hrl.frn = @frn) 
```

这是 SearchMaster 过程的 SqlDataSource：

```
<asp:SqlDataSource ID="sqlDsDetails" 
               runat="server" 
               ConnectionString="<%$ ConnectionStrings:cnxString %>
               SelectCommandType="StoredProcedure" 
               SelectCommand="SearchMaster">
<SelectParameters>
<asp:ControlParameter Name="business" ControlID="txtBusiness" 
                  Type="String" PropertyName="Text"  
                  ConvertEmptyStringToNull="true" />
<asp:ControlParameter Name="frn" ControlID="txtFRN" 
                  Type="String" PropertyName="Text"
                  ConvertEmptyStringToNull="true"/>
</SelectParameters>
</asp:SqlDataSource> 
```

这是 SearchDetails 过程的 SqlDataSource：

```
<asp:SqlDataSource ID="sqlDsDetails" 
               runat="server" 
               ConnectionString="<%$ ConnectionStrings:cnxString %>
               SelectCommandType="StoredProcedure" 
               SelectCommand="SearchDetails">
<SelectParameters>
<asp:Parameter Name="frn" Type="String" DefaultValue="" 
           ConvertEmptyStringToNull="true" />
<asp:Parameter Name="business" Type="String" DefaultValue="" 
           ConvertEmptyStringToNull="true" />
</SelectParameters>
</asp:SqlDataSource> 
```

这是绑定 SqlDsMaster 的按钮单击：

```
protected void btnSearch_Click(object sender, EventArgs e)
{
    sqlDsMaster.DataBind();
} 
```

这是为详细信息创建行的 gvMaster_RowCreated：

```
protected void gvMaster_RowCreated(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        SqlDataSource ctrl = 
        e.Row.FindControl("sqlDsDetails") as SqlDataSource;

        if (ctrl != null && e.Row.DataItem != null)
        {
            ctrl.SelectParameters["frn"].DefaultValue = 
            ((DataRowView)e.Row.DataItem)["frn"].ToString();

            ctrl.SelectParameters["business"].DefaultValue = 
            ((DataRowView)e.Row.DataItem)["business"].ToString();
         }
     }
 } 
```

我运行了 SQL 探查器，当只输入一个参数时，探查器甚至没有显示过程正在运行。当我输入两个参数时，程序显示在分析器中运行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T18:15:55.637

我的猜测是，对于您认为为 null 的情况，它仍在传递一个空字符串。您可以通过以下方式排除这种情况：

```
CREATE PROCEDURE SearchDetails
@business nvarchar(300) = NULL,
@frn nvarchar(10) = NULL
AS

SELECT @business = NULLIF(@business, ''),
       @frn = NULLIF(@frn, '')

 SELECT hrl.call // etc 
```

如果它开始工作，它传递的是空字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T18:54:18.260

我怀疑 Marc Gravell 是对的。

尝试以下测试：

```
 SearchMaster @business = null        , @frn = null
 SearchMaster @business = 'something' , @frn = null
 SearchMaster @business = 'something' , @frn = 'something'
 SearchMaster @business = null        , @frn = 'something'
 SearchMaster @business = 'something' , @frn = 'something'
 SearchMaster @business = 'something' , @frn = ''
 SearchMaster @business = ''          , @frn = 'something' 
```

请注意，最后 2 个不会返回任何内容 - 除非您在数据库中有空白业务和 frn ;)

如果您将来自 Marc 的 select 语句放在 AS 行之后，您的语句应该可以按预期工作。

所以是这样的：

```
CREATE PROCEDURE SearchMaster
@business nvarchar(300) = NULL,
@frn nvarchar(10) = NULL
AS
SELECT @business = NULLIF(@business,'') , @frn = NULLIF(@frn,'')

SELECT h.Business,
       hrl.frn
FROM registration hrl
INNER JOIN holder h on h.call = hrl.call
WHERE (@business IS NULL OR h.Business like '%' + @business + '%') 
AND (@frn IS NULL OR hrl.frn = @frn) 
```

**并确保在您的 DataSource 上设置 CancelSelectOnNullParameter="False"**

# javascript - 我的 html 页面上的 Javascript 冲突

> ID：690890
> 
> 赞同：1
> 
> 时间：2009-03-27T18:13:16.190
> 
> 标签：javascript, jquery, conflict, lightwindow

我的网页上有一个手风琴菜单和一个 lightwindow 脚本。由于手风琴脚本，lightwindow 脚本不起作用，因为如果我删除后者，lightwindow 脚本就会起作用。一定有冲突，但是什么？

这是我页面的头部：

```
<!-- lightwindow files -->
<script type="text/javascript" src="lightwindow/javascript/prototype.js"></script>
<script type="text/javascript" src="lightwindow/javascript/scriptaculous.js?load=effects"></script>
<script type="text/javascript" src="lightwindow/javascript/lightwindow.js"></script>
<link rel="stylesheet" href="lightwindow/css/lightwindow.css" type="text/css" media="screen" />

<!-- accordion scripts -->
<script src="js/jquery-1.2.1.min.js" type="text/javascript"></script>
<script src="js/menu.js" type="text/javascript"></script>
<script src="js/jquery.cookie.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="css/accordion.css" /> 
```

感谢您的时间。

干杯

鸟郎

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T18:22:33.857

您需要使用[http://docs.jquery.com/Core/jQuery.noConflict](http://docs.jquery.com/Core/jQuery.noConflict)中描述的 jQuery.noConflict 方法。

不确定版本 1.2.1 是否会有它。

只需阅读该页面上的说明，了解如何连接它。首先，您需要将 jQuery 放在其他库之前。

更新：添加了以下代码以帮助您应用修复程序。如果 jQuery.noConflict() 行导致错误，那么您可能需要尝试更新版本的 jQuery。

```
<script src="js/jquery-1.2.1.min.js" type="text/javascript"></script>
<script type="text/javascript"> jQuery.noConflict() </script>

<!-- lightwindow files -->
<script type="text/javascript" src="lightwindow/javascript/prototype.js"></script>
<script type="text/javascript" src="lightwindow/javascript/scriptaculous.js?load=effects"></script>
<script type="text/javascript" src="lightwindow/javascript/lightwindow.js"></script>
<link rel="stylesheet" href="lightwindow/css/lightwindow.css" type="text/css" media="screen" />

<!-- accordion scripts -->
<script src="js/menu.js" type="text/javascript"></script>
<script src="js/jquery.cookie.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="css/accordion.css" /> 
```

另外，注意您可能需要将一些代码从 $(...) 交换为 jQuery(...)

从 jQuery 文档页面：

*在你以前做 $("div p") 的地方，你现在必须做 jQuery("div p")。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-11T02:08:59.400

```
<script type="text/javascript"> jQuery.noConflict() </script> 
```

只是想说这个小把戏为我创造了奇迹，谢谢。如果您使用 chronoforms，这可能是您的 javascript 问题的答案。

最后没有更多“完成但页面上有错误”。

再次感谢

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-12T20:03:44.573

当您添加 jQuery.noConflict(); - 您还需要进入 jQuery 脚本并将所有 $ 变量交换为 jQuery

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T18:18:08.347

您可能在两个库中都定义了同名的方法/函数。

如果不是重复的方法/函数名称，请检查重复的全局变量名称。

尝试向文档添加相互覆盖的方法时，我多次遇到冲突。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T18:21:37.183

您几乎可以肯定 JQuery 和 Prototype 之间存在冲突。例如，他们都定义了 $ 。

JQuery 有一个兼容模式，您可以启用它来避免冲突。

# networking - 当通过 SFTP 的连接中断时，文件会发生什么情况？

> ID：690897
> 
> 赞同：2
> 
> 时间：2009-03-27T18:14:22.350
> 
> 标签：networking, ftp, sftp, file-transfer

我需要实现从 Web 服务器到 SFTP 服务器的文件传输。当文件传输过程中连接中断时，已经传输的字节怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T18:34:25.157

简短答案：已传输的文件部分丢失/垃圾收集/标记为删除

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:24:00.110

除非 SFTP 服务器具有恢复中断传输的内置功能（不确定是否存在，如果存在，它可能是一个插件），文件根本不会被传输。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T01:18:12.963

最可能的情况是服务器上现在将存在部分传输的文件。

很少有服务器会将此类文件标记为删除 - 这意味着您永远无法恢复中断的传输，而必须从头开始。

# objective-c - 为什么 Objective-C 使用 YES 和 NO 而不是 1 和 0？

> ID：690903
> 
> 赞同：26
> 
> 时间：2009-03-27T18:16:41.377
> 
> 标签：objective-c

Objective-C 使用 YES 和 NO 而不是 1 和 0 是否有任何技术原因，或者仅仅是为了使其更具可读性？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-03-27T18:20:05.440

使其更具可读性*是*技术原因。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-27T20:02:34.773

```
typedef signed char        BOOL; 
// BOOL is explicitly signed so @encode(BOOL) == "c" rather than "C" 
// even if -funsigned-char is used.
#define OBJC_BOOL_DEFINED

#define YES             (BOOL)1
#define NO              (BOOL)0 
```

（以供参考）

```
[button setAttr:YES]; 
```

那么听起来更好恕我直言......

```
[button setAttr:TRUE]; 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-03-27T19:13:03.440

[C](http://en.wikipedia.org/wiki/Boolean_datatype#C)（Objective-C 所基于）直到 C99 才具有布尔类型。

[Objective-C](http://en.wikipedia.org/wiki/Objective-C)创建于 80 年代，并定义了它自己的布尔类型。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-03-27T22:20:52.397

因为程序员的*意思* **是 yes**和**no**，而不是**1**和**0**。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-27T18:23:17.600

*大多数*语言使用`true`和的原因相同`false`......如果您愿意，您可以使用 1 和 0，与任何其他语言相同。

真的，如果您考虑一下，我们正在谈论：

```
#define YES 1
#define NO  0 
```

它只是更好地阅读。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-27T18:21:42.673

这只是语法，没有技术原因。他们只是使用 YES/NO 作为 BOOL 而不是像 c++ 那样的 true/false。

# .net - 在 DoubleClick 事件上获取鼠标点击的位置/按钮

> ID：690904
> 
> 赞同：7
> 
> 时间：2009-03-27T18:16:43.687
> 
> 标签：.net, winforms, double-click

有没有一种方法可以在控件 DoubleClick 事件中获取鼠标光标的 (x, y) 坐标？

据我所知，该位置必须从全局获得：

```
Windows.Forms.Cursor.Position.X、Windows.Forms.Cursor.Position.Y

```

另外，有没有办法获得哪个按钮产生了双击？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-08-04T04:18:48.573

使用***MouseDoubleClick***事件而不是 DoubleClick 事件。MouseDoubleClick 提供 MouseEventArgs 而不是普通的 EventArgs。这适用于“MouseClick”而不是“Click”......以及所有其他处理鼠标的事件。

MouseDoubleClick 确保鼠标确实在那里。DoubleClick 可能是由其他原因引起的，鼠标坐标可能没有用 - MSDN：“DoubleClick 事件在逻辑上是控件的更高级别事件。它们可能由其他用户操作引发，例如快捷键组合。”

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-27T18:25:41.510

注意：正如 danbruc 所指出的，这不适用于 UserControl，因为 e 不是 MouseEventArgs。另请注意，并非所有控件都会给您一个 DoubleClick 事件 - 例如，一个 Button 只会给您发送两个 Click 事件。

```
 private void Form1_DoubleClick(object sender, EventArgs e)
   {
       MouseEventArgs me = e as MouseEventArgs;

       MouseButtons buttonPushed = me.Button;
       int xPos = me.X;
       int yPos = me.Y;
   } 
```

获取相对于表单的 x,y..

在 MouseEventArgs 中也有左键或右键。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-27T18:18:37.003

Control.MousePosition 和 Control.MouseButtons 是您正在寻找的。使用 Control.PointToClient() 和 Control.PointToScreen() 在屏幕和控件的相对坐标之间进行转换。

有关详细信息，请参阅 MSDN [Control.MouseButtons Property](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.mousebuttons.aspx)、[Control.MousePosition Property](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.mouseposition.aspx)、[Control.PointToClient Method](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.pointtoclient.aspx)和[Control.PointToScreen Method](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.pointtoscreen.aspx)。

* * *

**更新**

不要只见树木不见森林...... :D 查看[Moose 的](https://stackoverflow.com/users/19032/moose)回答并查看事件参数。

此[MSDN 文章](http://msdn.microsoft.com/de-de/library/system.windows.forms.control.doubleclick.aspx)列出了哪些鼠标操作会根据控件触发哪些事件。

**更新**

我错过了 Moose 的演员阵容，所以这行不通。您必须使用 Control.DoubleClick() 内部的静态控件属性。因为按钮信息被编码为位字段，所以您必须使用所需的按钮进行如下测试。

```
(Control.MouseButtons & MouseButtons.Left) == MouseButtons.Left 
```

# asp.net - 在应用程序级别之外使用注册为 allowDefinition='MachineToApplication' 的部分是错误的

> ID：690909
> 
> 赞同：0
> 
> 时间：2009-03-27T18:18:11.873
> 
> 标签：asp.net, iis, iis-6

```
Configuration Error 
Description: An error occurred during the processing of a configuration file
required to service this request. Please review the specific error details 
below and modify your configuration file appropriately. 

Parser Error Message: It is an error to use a section registered as
allowDefinition='MachineToApplication' beyond application level.  
This error can be caused by a virtual directory not being configured 
as an application in IIS.

Source Error: 

Line 36:             ASP.NET to identify an incoming user. 
Line 37:         -->
Line 38:        <authentication mode="Windows"/>
Line 39:        <!--
Line 40:             The <customErrors> section enables configuration 
```

网上有很多关于这个错误的参考资料，但他们都重复了同样的 2 条建议，这两条建议都不适用于我的情况。

这是我的场景。

我有一个带有 IIS 6 的 Server 2003。默认网站有 4 个虚拟目录，它们都被配置为单独的应用程序。有些是 Web 服务，有些是普通的 ASP.NET 站点。其中 3 个工作正常，一个不能 - 从外部（当我登录到服务器并浏览本地主机时，我没有收到此错误）。

所有应用程序共享同一个应用程序池，并且它们都有自己的 web.configs。我详细查看了这些属性，但没有发现可以解释错误的差异。安全设置相同。我检查了 MMC 和文件系统中文件和文件夹的权限。应用程序池帐户 (NETWORK SERVICE) 和匿名 Web 用户都具有所需的访问权限，并且它们在所有应用程序中都是相同的。这两个应用程序都启用了匿名访问并打开了集成安全性。

同样，当我以匿名用户身份从防火墙外部访问页面时，我只会收到上述错误。当我在本地登录时，该页面就可以正常使用。这让我认为问题与安全/模拟有关。

不起作用的应用程序是使用 VS 2008 和 .Net 3.5 构建和部署的。它在 web.config 中有其他旧应用程序没有的东西。但是，我尝试逐渐从 web.config 中删除设置，直到该站点不再工作为止，但无济于事。

这是怎么回事？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T18:58:34.973

通常情况下，我忽略了一个小细节——一条防火墙规则，它将我的请求转发到不同端口上的不同网站。外部请求实际上命中了此服务器上的另一个站点。此其他站点没有*为*虚拟目录配置应用程序。一旦我关闭了另一个站点，这立即变得明显。

# actionscript-3 - Flash 编译器/解释器优化

> ID：690911
> 
> 赞同：3
> 
> 时间：2009-03-27T18:18:27.440
> 
> 标签：actionscript-3, flash, optimization

我最近开始使用 ActionScript 3 / Flash 9，来自“真正的”编程背景，我对它最终会得到什么样的机器代码有点好奇。我想知道编译器在将 SWF 与优化标志放在一起时会进行什么样的优化（如循环展开、常量值解析为立即数等），以及解释器将生成什么样的机器代码（将矩阵乘法在有能力的处理器上使用 SSE 指令，它使用什么 FPU 模式，数据结构是否自动对齐等）。

有人有这方面的文档链接吗？谷歌只是不断地把我送到第三方产品。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-29T00:32:43.243

从 AS3 开始，[出现了使用 JIT 的新虚拟机](http://www.mozilla.org/projects/tamarin/ "狨猴（开源）")。

另外，我不是许可证专家，但如果我没记错的话， [Flex SDK 编译器](http://opensource.adobe.com/wiki/display/flexsdk/Flex+SDK)也是开源的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-20T18:18:11.850

我最近检查了 Flash 编译器。太奇妙了！这是简单的类代码：

```
 var A : Number = 0.0;
    A = A*2*4; 
```

这是反汇编代码：

```
5       pushdouble      0
7       convert_d
8       setlocal1
9       getlocal1
10      pushbyte        2
12      multiply
13      pushbyte        4
15      multiply
16      convert_d
17      setlocal1 
```

哇！在 21 世纪，我们拥有 1980 年级别的编译器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T21:04:30.600

我会开始查看 Nicolas Cannasse 的[博客](http://www.ncannasse.fr/)和[工作（](http://blog.haxe.org/) *MTASC* AS2 编译器和[*Haxe*](http://haxe.org/)背后的人）......以及所有相关的内容。

另外——但有点肤浅——最近在 Peter Elst 博客上有一个关于这个主题的非常有趣的广播：

[http://www.peterelst.com/blog/2009/03/10/flash-player-internals/](http://www.peterelst.com/blog/2009/03/10/flash-player-internals/)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-27T21:51:48.427

我可能错了，但我的印象是 Actionscript 不是编译的，而是解释的，就像 php.ini 一样。唯一不同的是，Actionscript 与其他资产一起封装到 .swf 中。我在使用一些反编译器时看到，您也可以将代码视为某种字节码，但我不会以任何方式将其与机器代码进行比较。

如果您正在寻找性能提升，我建议您看看[Alchemy](http://labs.adobe.com/technologies/alchemy/)。我从来没有使用过它，但是这个实验性的 Adob​​e 产品应该允许您将 C/C++ 代码移植到 Flash Player 上，同时将性能损失降到最低。

# vim - 如何在 vim 搜索中找到“-s”

> ID：690916
> 
> 赞同：1
> 
> 时间：2009-03-27T18:19:44.520
> 
> 标签：vim

我使用 Vim 来阅读手册页。但是我在搜索变量时遇到了麻烦。例如我使用：

```
/\<-s\> 
```

搜索“-s”，但什么也没找到。嗯。我在文件中看到了。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-27T18:26:20.480

`\<`匹配单词的开头，`-`通常不被视为单词字符。`:set iskeyword?`看看哪些字符被认为是单词字符。

试试这个：

```
:set iskeyword+=-
/\<-s\> 
```

那时应该工作。见`:h /\<`和`:h 'iskeyword'`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:24:42.933

`/-s`对我来说很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-12T16:36:27.490

您是否正在寻找手册页中描述 -s 功能的位置？用于`^\s*-s\>`搜索行首、任意数量的空格，然后是您的标志。

否则，如果您不想更改您的`iskeyword`，那么您可以为分隔符尝试不同的正则表达式。您可以使用`\s-s\>`，尽管这不会找到“-s”（引号中）。

也可以看看`:help pattern-overview`

# iphone - 多个视图控制器，我搞砸了吗？

> ID：690919
> 
> 赞同：1
> 
> 时间：2009-03-27T18:20:37.733
> 
> 标签：iphone, uiviewcontroller

当我第一次启动这个 iPhone 应用程序时，我还是个初学者，所以我从示例中获取代码。

我有 4 个视图 (UIView) 和 4 个视图控制器 (UiViewContorllers)。它们都位于 Interface Builder 中的同一级别。

UiViewA 是主菜单，它有按钮，按下时通过 addSubView:ViewB(c/d/etc) 加载 ViewB,C,D。现在我遇到了一个问题，即只有 ViewA 的 ViewController 正在获取所有消息和通知。

我在这里搞砸了吗？我不应该直接从 ViewA 添加 ViewB、C、D 的子视图吗？我应该一直加载 ViewController 吗？

我有什么解决办法？

到目前为止，如果我想要旋转，我一直在直接转换其他视图。

任何帮助表示赞赏

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T18:44:40.903

您走在正确的轨道上：加载 UIViewController 而不是 UIView 应该可以为您解决这个问题。您可以按如下方式完成此操作（来自您的第一个 UIViewController）：

```
[self presentModalViewController:anotherViewController animated:YES]; 
```

这会将另一个 UIViewController 向上滑动到您当前的视图上并保留其生命周期和逻辑。希望这可以帮助！

# .net - 通过呈现“文件系统”。.NET 网络服务

> ID：690922
> 
> 赞同：0
> 
> 时间：2009-03-27T18:20:47.793
> 
> 标签：.net, web-services

我需要生成一个看起来像文件系统的客户端的 Web 服务。我需要客户能够：

*   加载文件
*   保存文件
*   访问有关文件的元数据
*   使用用户名/密码

我不想只托管静态内容的原因是：

*   一些内容将是虚拟的。
*   一些元数据将是非标准的。
*   我将需要添加自定义挂钩、访问控制和错误处理。
*   有计划对在线数据进行一些处理/过滤，因此我需要能够在两端添加自定义代码。

如果有任何区别，所有内容都是相同类型的，并且在加载/保存时将被反序列化/序列化。

有这样做的标准方法吗？有没有更好的方法来做到这一点？

* * *

*编辑：*我有 bean 与 Visual Web Developer 一起玩，它允许远程调用（通过 SOAP，它认为）给出如下代码：

```
public class HelloWorld : System.Web.Services.WebService
{
    [WebMethod]
    public string HelloWorldMethod(int x)
    {
        return "Hello World" + " " + (x * 2).ToString();
    }
} 
```

这得到了我想要的大约 90% 的东西。剩下的就是让一个实例为整个子目录提供服务（并获取路径），让 IIS 处理我所有的安全性和其他一些细节。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T21:28:28.857

我建议检查 WCF 而不是 .NET webservices - 它为您提供更多灵活性、更多选项，例如“可靠会话”（它将处理短暂的网络故障），它为您提供对大型消息的 MTOM 编码的轻松支持，以及如果您计划提供例如视频或其他内容，甚至支持流媒体。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:29:18.007

可能值得研究[WebDav](http://www.webdav.org/)协议，其中有与元数据相关的扩展。不确定这是否就是您所说的 web 服务的意思，如果您指的是 SOAP，那么您可能会遵循协议但将其包装在 SOAP 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:29:26.620

您是否考虑过实现 WebDAV 甚至 FTP 之类的协议？已经设计了文件服务和文件传输协议。即使您不能使用其中之一的第三方实现，您至少可以实现该协议并避免重新发明特定的轮子。

如有必要，您可以将其中一种协议转换为 Web 服务接口——但至少在您的设计过程中您将有一个完整的协议可供选择。

# unit-testing - 您如何对 Subsonic 延迟加载属性进行单元测试？

> ID：690937
> 
> 赞同：1
> 
> 时间：2009-03-27T18:24:08.333
> 
> 标签：unit-testing, orm, subsonic, tdd

假设我有以下要测试的功能：

```
public void CancelOrder(Order order)
{
    order.Status = "Cancelled";

    _emailService.SendEmail(order.User.Email, "Your order has been cancelled!");
} 
```

现在，Order 类是 SubSonic 生成的类，并且其上的 User 属性是延迟加载的，这意味着当我调用 order.User.Email 时，它实际上会运行一条 SQL 语句来获取用户。

如果我想对此进行单元测试，我会遇到问题，因为我真的不希望我的单元测试访问我的数据库。

我当前的解决方案是将 CancelOrder 函数重构为如下所示：

```
public void CancelOrder(Order order)
{
    order.Status = "Cancelled";

    User user = _userRepository.GetByUserID(order.UserID);

    _emailService.SendEmail(user.Email, "Your order has been cancelled!");
} 
```

然后我可以存根 _userRepository.GetUserByID() 调用以返回硬编码的用户对象。

这是最好的方法吗？我猜你可能会说第二种实现更干净，因为所有数据访问都是通过存储库完成的，而不是隐藏在属性中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T14:14:35.473

为什么您不希望您的单元测试访问您的数据库？如果您使用 MBUnit 编写测试用例，您只需使用 RollBack 属性标记单元测试，对数据库的任何更改都将回滚。

我一直更喜欢编写针对业务层但实际上 ping 数据库的单元测试用例，以便单元测试与应用程序本身将使用的最相似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T09:05:06.717

定义您自己的类似 Order 的接口，该接口提供您需要的基本功能，并将其用作 CancelOrder 方法的参数类型：

```
interface Order {
  public void Status(...); // or property
  public string UserEmail():
} 
```

然后创建该接口的委托实现，例如 SubsonicOrder，它调用数据库。在测试中使用存根实现。我意识到您可能需要一个更丰富的 Order 接口模型；这只是一个例子。

如果需要，对电子邮件服务执行相同的操作（可能通过构造函数或服务定位器进行依赖注入）。

# ajax - 何时实施 Ajax 的最佳实践？

> ID：690942
> 
> 赞同：4
> 
> 时间：2009-03-27T18:24:46.583
> 
> 标签：ajax

在本[Microsoft 教程](http://www.asp.net/learn/mvc/#MVC_SampleApp)中，他们在最后一步实现 Ajax：“步骤 7。实现 Ajax”

我知道这只是一个教程，所以它保持简单，但我在其他地方也看到过这个想法，构建应用程序，然后在适当的地方撒上 ajax。

我边走边实现了 ajax，但我想知道人们觉得这方面的最佳实践是什么。最好在最后使用 ajax 还是应该在执行过程中实现它？任何人都以一种或另一种方式遇到了麻烦？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T18:32:17.267

如果您的核心用户交互将依赖 Ajax（例如，Google Docs），那么您应该尽早实现这些位。

否则，如果您的核心交互依赖于可靠地存储和检索数据，那么最后添加 Ajax。这样，您就可以强迫自己和您的团队测试您的应用程序的行为，就好像 JavaScript 在您的用户浏览器上不可用一样。在这种情况下，Ajax 将是用户界面优点的额外层​​。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T18:31:26.910

最后做 AJAX 的理由是，如果你先让它在没有 AJAX 的情况下工作，你更有可能开发一个优雅降级的网站。

这对某些人来说无关紧要——我见过（内部）网站是为特定浏览器的特定*版本*设计的，并打开了一组明确的功能。但是，如果它对您很重要，那么将 AJAX 添加到一个没有它就可以正常工作的站点要比从一开始就依赖它的站点中删除 AJAX 要容易得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T18:27:12.007

'as you go' 是什么意思？我从一个设计开始，所以很清楚最终产品会是什么。所以，是的，你需要从一开始就知道 ajax 发生在哪里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T18:31:55.037

我边走边做，在哪里有意义。从第一天开始，我们很少有完整的设计规范，所以有时你必须做出决定。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T18:32:07.487

忽略您期望 Ajax 的需求不属于用户界面规范需求（如果您有这样的东西）这一事实，我会考虑尽快实现它（或实现挂钩）。

1) 将其改装为旨在返回完整页面的东西并不一定很简单

2）它可能会影响您的解决方案的部署模式，因为它将提供页面和页面片段/对象，并且这些片段将导致对您的服务器的更多点击（想象一下您的服务器会额外点击如果您引入了诸如 Google [Suggest](http://www.google.co.uk/webhp?hl=en&complete=1)之类的东西，则可能每次按键都可能导致新的服务器请求）。

因此，您可能不想立即实现 Ajaxness。但我会敦促你尽快考虑（如果需要的话）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T18:49:42.233

尽早实现 Ajax 的另一个理由是，每当您在项目后期添加任何功能时，您通常都必须拆除并重建一些现有代码或设计以使其工作。当您从一开始就计划该功能时，需要的重新编码要少得多。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-11T16:57:25.037

在我看来，当谈到 ajax 时，有两个阵营。一个阵营希望通过大量简洁的 UX 好东西来创建这种丰富的用户体验，并且可能会将他们的大多数网站功能仅实现为 ajax。另一个阵营希望添加很好的便利功能，但项目的核心和大多数主要功能将在服务器端实现。在第一个阵营中，您的大部分功能都将在 ajax 中实现，我将尽早处理 ajax 并将其提前纳入您的设计决策过程。对于第二种情况，我将在服务器端实现所有功能，然后添加 ajax 以添加一些不错的 UX 感觉。

我记得很早就阅读了 ajax，以实现您的网站，就像您的用户浏览器没有 javascript 一样，然后在所有功能正常工作后添加 ajax 以改善用户体验。但是自从 ajax 的早期阶段以来，Google 无疑已经突破了极限，很多人都希望使用 ajax 在他们的网站上创建这些令人惊叹的丰富用户体验。我曾与很多真正喜欢在 ajax 中实现很多功能的人一起工作，但他们中很少有人有能力完成它。我自己当然没有排骨，并且对看起来非常酷的错误测试功能感到非常沮丧......如果你以某种方式使用它们......交叉你的手指。很多都与测试有关，单元测试是一回事，

你必须决定你希望你的用户体验是什么样的，ajax 如何适应这些决定，然后选择何时实现 ajax。早期用于仅在 ajax 中实现主要功能的站点，稍后用于 ajax 仅添加 UX 糖的站点。那是我的 0.02 美元，我敢肯定有人持相反意见。

# sql - Informix SQL count() 比较

> ID：690948
> 
> 赞同：1
> 
> 时间：2009-03-27T18:26:23.287
> 
> 标签：sql, count, grouping, informix

我正在尝试构建一个 SQL 查询，该查询将计算每个 id 的总行数，以及按 id 分组的“FN%”和“W%”等级的数量。如果这些数字相等，则学生只有全部“FN%”或全部“W%”或两者的组合。

**我需要一个只有“FN%”或“W%”统计数据的所有 id 的列表**

例如 id # 683 & 657 会进入查询的结果集，但 603、781 和 694 不会

```
 id stat
  683 WF
  683 WF
  683 WF
  683 WF
  683 W
  683 W
  657 W
  657 W
  657 W
  657 W
  781 B+
  781 IP
  781 WP
  781 WP
  603 FN
  603 FN
  603 F
  603 FN
  603 FN
  694 B
  694 B+
  694 CI
  694 LAB
  694 WF
  694 WF 
```

样本输出：

683
657

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T19:27:24.687

这是我能想到的两种可能的解决方案。我不确定它们是否可以在 Informix 中工作：

```
SELECT  id
FROM    foo a
GROUP   BY id
HAVING  COUNT(*) = (
                SELECT  COUNT(*)
                FROM    foo b
                WHERE   a.id = b.id
                AND     (b.stat LIKE 'FN%' OR b.stat LIKE 'W%')
        ); 
```

如果`HAVING`子句中的子查询是禁止的，也许这会起作用：

```
SELECT  id
FROM    (
                SELECT  id, COUNT(*) stat_count
                FROM    foo
                WHERE   (stat LIKE 'FN%' OR stat LIKE 'W%')
                GROUP   BY id
        ) a
WHERE   stat_count = (SELECT COUNT(*) FROM foo b WHERE a.id = b.id); 
```

更新：我刚刚在 Oracle 中尝试过这些，并且都可以工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:39:24.817

其中 xxxx 是保存要处理的信息的临时表.....

```
select id, fullname, count(id) ttl 
from xxxx 
group by id, fullname 
into temp www with no log;

select id, fullname, count(id) ttl_f 
from xxxx 
where grd like 'FN%' or grd like 'W%' 
group by id, fullname 
into temp wwww with no log;

select www.id, www.fullname 
from www, wwww 
where www.id = wwww.id and www.ttl = wwww.ttl_f; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T18:39:56.313

这个解释让我头疼。你在寻找这两组的结合吗？

*   仅具有与“W%”匹配的统计信息的 ID
*   仅具有与“FN%”匹配的统计信息的 ID

如果是这种情况，请将其设为一个 UNION 查询，其中每个集合都有一个子查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T19:19:36.810

这是针对原始问题编写的：

```
select first 50
c.id,
(select trim(fullname) from entity where id = c.id) fullname,
count(*),
(select count(*) from courses where id = c.id and grd like 'FN%') FN,
(select count(*) from courses where id = c.id and grd like 'W%') W
from courses c
group by 1 
```

出于某种原因，检索名称的子查询比使用连接要快得多。

编辑：以下将与 yukondude 的答案具有相同的行为，但在我们的 HPUX / Informix v10.00.HC5 机器上表现更好。

```
select c.id
from courses c
where not exists (
        select id
        from courses
        where (grd not like 'W%' and grd not like 'FN%')
        and id = c.id
)
group by 1 
```

# perl - 如何减少 Perl CGI 脚本的启动时间？

> ID：690964
> 
> 赞同：5
> 
> 时间：2009-03-27T18:30:24.167
> 
> 标签：perl, performance, initialization, cgi

我正在开发一些 CGI 脚本，并试图找到一种解决方案来减少当我导入大量带有“使用”的模块时产生的“启动时间”。

**更新：**

提供的解决方案很好，但我正在工作的脚本在控制台和 CGI​​ 模式下运行，检查是否存在一些典型的 HTTP 环境变量。

在“控制台模式”中，它们“正常”转储数据，在“html 模式”中，它们进行一些实时替换并将其他 HTTP 标头发送到客户端。

我想在这两种情况下改善启动时间。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T18:36:01.563

考虑使用[CGI::Fast](http://search.cpan.org/perldoc?CGI::Fast)来启动一个 perl 进程来处理多个请求。将我的一些大型 CGI 脚本更改为 CGI::Fast 花费了我很少的精力。与 mod_perl 不同，在托管站点上运行 CGI::Fast 非常容易，因为您可以在不重新启动 Apache 的情况下重新启动脚本（至少当我要求 mod_perl 时，我的托管人告诉我）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-27T18:35:50.707

使用[mod_perl](http://perl.apache.org/start/tips/registry.html)来运行你的脚本怎么样？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-27T18:34:51.707

*   确保这实际上是您的瓶颈
*   只导入你需要的模块
*   确保您无需搜索无数个地方即可找到它们
*   考虑让启动成本高昂的进程热运行（例如作为守护进程）并使用重量更轻的 CGI 脚本来启动它们
*   查看各种加速器，而不是从 shell 执行完整的 CGI（取决于您用于提供页面的内容）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-27T18:45:14.193

你总是可以尝试[less](http://perldoc.perl.org/less.html) pragma：

```
use less 'starttime'; 
```

当然，这取决于系统`*`。您最好的选择是使用[mod_perl](http://perl.apache.org/)或 FastCGI 模块之一：[CGI::](http://search.cpan.org/dist/CGI.pm/CGI/Fast.pm) [Fast](http://search.cpan.org/search?query=FastCGI&mode=all)、[FCGI](http://search.cpan.org/dist/FCGI/FCGI.PL)等。

如果需要从命令行快速运行，您可能需要迁移到客户端/服务器架构（这就是 FastCGI 的全部内容）。

`*`警告目前没有系统为 less pragma 实现 starttime 选项。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-28T18:54:45.193

好吧，其他人已经建议 CGI 可能是你的问题，所以我认为你*不能*从图片中删除 CGI。

您可能要考虑[这篇旧文章](http://www.perl.com/lpt/a/968)。显然，启动时间缓慢的一个原因是巨大的@INC，因此将所有内容整合到一个简短的 PERL5LIB 中似乎有很大帮助（这似乎是一个公平的假设，但我从未尝试过）。

或者（或另外），如果您不介意在运行时支付一些价格，您可以使用[Class::Autouse](http://search.cpan.org/~adamk/Class-Autouse-1.99_02/lib/Class/Autouse.pm)

享受！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-30T13:11:43.907

尝试使用 SpeedyCGI 或 Persistent Perl。

两者都实现了大致相同的想法：它们不是 Perl 解释器，而是一个解析程序并将其保存在内存中的包装器，从而节省了每次运行时初始化解释器和解析所需的时间。

这应该适用于您描述的双环境设置，使用 CGI::Fast 或 mod_perl 时可能/可能不是这种情况。

**编辑**如果这有帮助，很好。如果没有，您将不得不测量您的脚本在哪里花费其运行时间。

# facebook - Facebook Toolkit 2.0 - 在安装了 asp.net 2.0 的服务器上运行时出错

> ID：690967
> 
> 赞同：0
> 
> 时间：2009-03-27T18:31:10.920
> 
> 标签：facebook, asp.net-2.0, asp.net-3.5

尝试在安装了 ASP.Net 2.0 的服务器上运行 Facebook Connect 工具包时出现以下错误 - 我手动将 System.Core 和 System.xml.Linq 从 3.5 DLL 移至服务器。

大多数其他事情似乎都在运行，直到我尝试访问“用户”对象——更具体地说，是 getinfo() 方法。

这是错误 - 有人有什么想法吗？谢谢！

找不到方法：“无效 System.Xml.XmlReaderSettings.set_MaxCharactersFromEntities(Int64)”。

[MissingMethodException：找不到方法：'Void System.Xml.XmlReaderSettings.set_MaxCharactersFromEntities(Int64)'。] System.Xml.Linq.XNode.GetXmlReaderSettings(LoadOptions o) +0 System.Xml.Linq.XElement.Parse(String text, LoadOptions 选项）+60 System.Xml.Linq.XElement.Parse（字符串文本）+7 Microsoft.Xml.Schema.Linq.XTypedServices.Parse（字符串 xml）+23 facebook.users.getInfo（字符串 uids）+201 facebook。 users.getInfo(Int64 uid) +34 content_FBLoggedIn.Page_Load(Object sender, EventArgs e) +481 System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +15 System.Web.Util .CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +34 System.Web.UI.Control.OnLoad(EventArgs e) +99 System.Web.UI.Control.LoadRecursive() +47 System.Web.UI.Page。ProcessRequestMain（布尔includeStagesBeforeAsyncPoint，布尔includeStagesAfterAsyncPoint）+1061

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T14:56:04.220

谷歌搜索*set_MaxCharactersFromEntities* [表明](http://social.technet.microsoft.com/Forums/en-US/sqlnetfx/thread/3b770032-85be-45d7-8316-ee7cb120c174/#b6321089-410a-4e0b-9680-f3e89f9e2639)这可能是服务器上的 64 位 dll 与本地开发机器上的 32 位 dll 的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T18:06:58.893

只是一个更新——我实际上最终在服务器上安装了 3.5 DLL——我找不到任何其他可行的解决方案。

一旦我这样做了，所有的问题都消失了。

感谢 Ax 的提示——尽管服务器运行在 32 位。

# c# - 使用反射和集合来编写对象 Rational 数据库

> ID：690977
> 
> 赞同：0
> 
> 时间：2009-03-27T18:35:13.423
> 
> 标签：c#, database, ado.net, dataset, objectdatasource

有 C# 问题；

我一直在寻找一种方法，可以在运行时通过迭代它们和属性/方法来说动态创建的对象。到目前为止，我一直在使用 Reflections 和 foreach 来不了解类属性。这是为了在数据网格视图上显示各种表中的所有记录。然而，我认为一种方法是使用对象理性映射来连接、填充数据集，然后能够将其显示在数据网格视图上进行编辑等。

**编辑：*也许迭代类的实际命名空间，所有类都继承一个名为 Table 的类，所以我想应该有一个方法在运行时调用所有类以从数据库中获取数据*

到目前为止，我主要完成了 Java 编程，所以对 OO 编程有一个很好的想法，只是对 .NET 不太熟悉，所以在这方面寻找最好的方法。

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T18:44:15.383

.NET 中有可用的对象关系库。如果您的目标是 SQL Server，请使用 Linq to SQL，或者如果您需要跨数据库支持，请尝试使用实体框架。

# c# - 什么 SQL 查询或 LINQ 代码会得到以下数据？

> ID：690983
> 
> 赞同：1
> 
> 时间：2009-03-27T18:36:17.243
> 
> 标签：c#, sql, linq, linq-to-sql

首先，这是我的数据库架构相关部分的图片：

[数据库架构 http://ewal.net/stuff/schema.png](http://ewal.net/stuff/schema.png)

我有几个越来越复杂的概念查询。目前，我正在使用一系列 SQL 查询（即从 C# 代码到 SQL Server 的多次往返行程）来执行这些操作，并且我想找到一种方法在单个查询中获取这些查询，但是这样做有点超出我个人的 TSQL/LINQ 能力。以下是我试图弄清楚如何编写的查询：

1.  为每个用户返回最近的工作计划记录的查询（不是针对特定用户——针对所有用户）。
2.  为每个指定的一组用户返回最新工作计划的查询（即我在客户端上有一个用户 ID 列表（即在一个数组中）
3.  用于检索每个指定用户集的所有“当前”项目记录的查询。“当前”是指项目附加到的工作计划记录是关联用户的最新工作计划记录。

作为参考，我在 C# 中使用 SQL Server 2005 和 LINQ to SQL，并且很乐意找到基于存储过程的解决方案或完成每个查询的直接 LINQ 代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T19:15:06.680

所有用户的最新工作计划：

```
SELECT
     WP1.*
FROM
     Workplans WP1
LEFT OUTER JOIN dbo.Workplans WP2 ON
     WP2.UserID = WP1.UserID AND
     WP2.Date > WP1.Date
WHERE
     WP2.WorkplanID IS NULL 
```

对于给定的一组用户，编写一个表值函数，将分隔的 ID 列表转换为这些 ID 的表。如果您四处搜索，我知道我之前已经在此处发布了该代码。然后你可以使用：

```
SELECT
     WP1.*
FROM
     dbo.GetTableFromIDList(@id_list) U
INNER JOIN Workplans WP1 ON
     WP1.UserID = U.ID
LEFT OUTER JOIN dbo.Workplans WP2 ON
     WP2.UserID = WP1.UserID AND
     WP2.Date > WP1.Date
WHERE
     WP2.WorkplanID IS NULL 
```

对于给定的一组用户，返回他们当前的所有项目：

```
SELECT
     P.*
FROM
     dbo.GetTableFromIDList(@id_list) U
INNER JOIN Workplans WP1 ON
     WP1.UserID = U.ID
LEFT OUTER JOIN dbo.Workplans WP2 ON
     WP2.UserID = WP1.UserID AND
     WP2.Date > WP1.Date
INNER JOIN dbo.Projects P ON
     P.WorkplanID = WP1.WorkplanID
WHERE
     WP2.WorkplanID IS NULL 
```

当然，您实际上应该列出列名，而不是使用“*”。

# c# - 为什么添加 @ 符号会使这项工作有效？

> ID：690985
> 
> 赞同：19
> 
> 时间：2009-03-27T18:36:39.597
> 
> 标签：c#, asp.net-mvc

我正在使用 asp.net mvc 并创建一个表单。我想向表单标签添加一个类属性。

[我在这里](https://stackoverflow.com/questions/216600/htmlbeginform-and-adding-properties)找到了一个添加 enctype 属性的示例，并尝试用 class 替换掉。访问视图时出现编译错误。

然后我找到了一个例子，有人在属性名称的开头添加了一个 @ 符号，这很有效。很好用，但我是一个需要知道原因的人，快速的谷歌搜索没有帮助。我知道 C# 允许将 @ 添加到字符串以忽略转义字符。为什么它在这种情况下有效？@ 告诉编译器什么？

产生编译错误的代码？

```
 <% Html.BeginForm("Results", "Search", 
    FormMethod.Get, new{class="search_form"}); %> 
```

有效的代码：

```
 <% Html.BeginForm("Results", "Search", 
    FormMethod.Get, new{@class="search_form"}); %> 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-27T18:38:08.127

在 C# 中，'class' 是一个保留关键字——在保留关键字前面添加一个 '@' 符号允许您使用该关键字作为标识符。

这是一个直接来自 C# 规范的示例：

```
class @class {
    public static void @static(bool @bool) {
        if (@bool) System.Console.WriteLine("true");
        else System.Console.WriteLine("false");
    }
} 
```

注意：这当然是一个例子，而不是推荐的做法。

# c# - 给定类型的名称作为字符串，我将如何使用反射构造一个泛型？

> ID：690986
> 
> 赞同：1
> 
> 时间：2009-03-27T18:37:07.753
> 
> 标签：c#, generics, reflection

假设我有字符串“List”和“Socket”，我将如何创建 List<Socket>？

我需要的答案同样适用于 Queue 和 XmlNodeList，更不用说 MyCustomGeneric 和 MyCustomClass。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T18:45:26.363

```
Type t=Type.GetType("System.Collections.Generic.List`1[System.Net.Sockets.Socket]");
object o=Activator.CreateInstance(t); 
```

# mysql - sql中的多个总计

> ID：690987
> 
> 赞同：0
> 
> 时间：2009-03-27T18:37:26.833
> 
> 标签：mysql, grouping

我有下面的代码

```
 $sql = "SELECT 
               date1, 
               date2, 
               userid, 
               jobid, 
               result, 
               price, 
               total, 
              (SELECT distinct SUM(total1) FROM Jobs) as total2
        FROM 
               Jobs 
          WHERE 
              total <= total1 
          GROUP BY 
              '$newphrase', '$newphrase1', '$user', '$job', result 
          ORDER BY 
              jobid DESC, userid DESC";
    $result = mysql_query($sql); 
```

它输出总计，但输出低于输出的 3 倍

```
SN01 0.17 15 2.55 25.05
SN01 0.50 15 7.5  25.05
SN01 1    15 15   25.05 
```

25.05 输出 3 次，我只需要一次。我已经尝试过不同的和我能想到的一切请帮助它让我发疯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T19:10:16.833

这就是 SQL 的工作原理——我建议您阅读它。

您的主要 SELECT 正在返回三个记录，并且对于这些记录中的每一个，它都会为 total2 运行内联 SELECT SUM() - 这就是您获得三个总数的原因。

阻止这种情况的唯一方法是使主 SELECT 返回一条记录，该记录有多种技术。

如果您仍然需要多条记录，您将不得不忽略多个总计，只使用返回的第一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T19:15:26.087

将除总计之外的所有内容都放入一个临时表中，其中包含所有列（包括总计）。您最终应该得到一个已加载的表，但总列中有空值。然后进行最终查询，将总数插入临时表。最后，从临时表中选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:50:57.717

SELECT DISTINCT 指的是 ROW。由于您有不同的 ROW，因此您将全部取回。

如果您想要的只是总数，那么您为什么要返回其他列？注意：您可能想返回并编辑您的问题：SELECT 中有 8 列，但示例输出中只有 5 列（除非点以某种方式分隔列输出）？

如果它真的要了你的命，你可以重写查询以返回类似的行，如下所示：

```
SELECT DISTINCT
    date1, // Maps to column 1: SN01, 
    userid, // Maps to column 3: 15, 
    (SELECT distinct SUM(total1) 
     FROM Jobs) as total2 // Maps to Column 5: 25.05
FROM 
    Jobs 
WHERE 
    total <= total1 
GROUP BY 
    '$newphrase', '$newphrase1', '$user', '$job', result 
ORDER BY 
    jobid DESC, 
    userid DESC 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-25T15:09:15.530

如果您需要这样的格式化输出，您可能应该使用报告工具。

如果您想要破解，请使用 sql case 语句仅获取第一行的值，如下所示：

```
SELECT 
           date1, 
           date2, 
           userid, 
           jobid, 
           result, 
           price, 
           total, 
           case when rownum = 1 then
              (SELECT distinct SUM(total1) FROM Jobs)
           else
               null
           end as total2
    FROM 
           Jobs 
      WHERE 
          total <= total1 
      GROUP BY 
          '$newphrase', '$newphrase1', '$user', '$job', result 
      ORDER BY 
          jobid DESC, userid DESC 
```

警告：这是未经测试的、依赖于数据库的代码。

# styles - 有人在 PDF 或 XPS 生成中使用 page-break-before 样式吗？

> ID：690991
> 
> 赞同：2
> 
> 时间：2009-03-27T18:38:18.017
> 
> 标签：styles

我正在使用来自 ActivePDF 的名为 WebGrabber 的产品，它以编程方式从网页生成 PDF。这个工具有两个渲染引擎，一个不支持 CSS 样式表的原生引擎，所以它不能用于我的应用程序和 IE，这是我使用的那个。我需要生成一些有意的分页符，并且添加了一些

```
<p style="page-break-before:always"></p> 
```

在需要的地方，但无论是使用此工具还是使用 Microsoft XPS Document Writer 打印出来，都不会尊重这种风格。

有没有人有这样做的经验？

提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T19:06:17.980

找到了！

我需要在这里添加一个空格

```
<p style="page-break-before:always">&nbsp;</p> 
```****************