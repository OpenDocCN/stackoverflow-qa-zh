# StackOverflow 问答 000804000-000804999

# wpf - 如何将 wpf 应用程序转换为 exe

> ID：804011
> 
> 赞同：10
> 
> 时间：2009-04-29T20:00:01.900
> 
> 标签：wpf

如何将 wpf 应用程序转换为可在所有 Microsoft Windows 操作系统上运行的 .exe。 

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-29T20:02:38.023

如果您在视觉工作室，请按 F7。

该应用程序将被编译成一个可执行的 exe 文件。它通常位于您的解决方案目录下：

```
SolutionDir\Bin\(Debug|Release)\Solution.exe 
```

此文件只能在安装了必要版本的 CLR 的 Windows 计算机上运行。据我所知，没有办法绕过这个要求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T20:04:52.870

:) 在 VS2008 中编译，记得查看项目位置的 Bin{Debug|Release} 文件夹以查看 exe

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T20:02:43.670

在 Visual Studio 中构建它。它应该在安装了正确框架的任何 Windows 系统上运行。（可能是 .NET 3.5sp1，具体取决于您包含的内容。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T20:14:11.037

WPF 默认为 .exe，但需要 .NET 3+。您不能创建 WPF .exe 并期望它适用于所有 Windows 版本，无论您编译应用程序的平台是否已安装。

它就像 C/C++ 中的库依赖项。某些库不适用于旧版本的 Windows。

# c# - 如何使 Web 用户控件的子控件的事件在每次回发时在父控件上触发一次 Catchall 事件

> ID：804012
> 
> 赞同：0
> 
> 时间：2009-04-29T20:00:04.690
> 
> 标签：c#, asp.net, visual-studio-2008, events

假设我有一个 Web 用户控件，其中包含多个下拉列表。它们都设置为 AutoPostBack = true，但我控件中的每个 SelectedIndexChanged 事件处理程序将触发/链接我为其他 DDL 定义的其他 SelectedIndexChanged 处理程序。这意味着当用户更改单个 DDL 时，事件处理程序将链接/触发几个其他 DDL。链接事件的逻辑非常复杂，由数据驱动，并且可以根据用户实际更改的列表进行更改。因此，很难确定哪个事件处理程序会最后触发。

从页面的角度来看，我想订阅用户控件上的单个 SelectionChanged 事件，该事件每次回发只会触发一次，直到所有事件处理程序都被触发。我不在乎触发了哪些事件处理程序，只是整个控件的状态发生了变化。

我正在使用 C# 3.5/ASP.NET 2.0/VisualStudio 2008

我该怎么做呢？

编辑：将说明移到原始描述中。我认为我指定 AutoPostBack=true 而不指定正在发生链接的事实具有误导性。我为混乱道歉。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T20:06:20.683

这取决于您何时需要在页面生命周期中触发事件处理程序。

这是一种策略：

1）在您的用户控件中，跟踪下拉列表的选择更改。如果事件处理程序被执行，请更新您的本地跟踪变量。

2) 在您的用户控件的 PreRender 处理程序中，检查您的跟踪变量，如果需要，触发用户控件的 SelectionChangedEvent。

此策略将保证页面生命周期的事件处理阶段已完成，但缺点是您的主页在 PreRender 阶段之前不会收到用户控件上的“SelectionChanged”。这可能适用于您的情况，也可能不适用于您的情况。

如果您需要更早地为您的用户控件处理 SelectionChanged 事件，那么您可能必须在下拉列表处理程序中放入更复杂的跟踪逻辑，并添加一个跟踪变量以确保用户控件的“SelectionChanged”事件只被触发一次。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T20:02:23.127

我认为您需要在子控件中创建一个委托，然后将该委托引用到父控件中。

# javascript - 取消绑定 jQuery 偶数处理程序

> ID：804021
> 
> 赞同：8
> 
> 时间：2009-04-29T20:03:09.737
> 
> 标签：javascript, jquery, jquery-events

几分钟前我尝试回答[这个问题，并为自己准备了这个例子：](https://stackoverflow.com/questions/803936/clear-remove-javascript-event-handler)

```
<script>
  function trialMethod()
  {
    alert('On Submit Run!'); return true;
  }
  function trialMethod2()
  {
    alert('On Submit Run trialMethod2!'); return true;
  }
</script>

<form id="aspnetForm" onsubmit="trialMethod();">
    <input type="submit">
</form> 
```

为什么第一次取消绑定不起作用：

```
<input type="button" id="btnTrial1" value="UNBIND 1" 
   onclick="$('#aspnetForm').unbind('submit', trialMethod);"> 
```

但是这个适用于 trialMethod2 方法：

```
<input type="button" id="btnTrial2" value="UNBIND 2" 
   onclick="$('#aspnetForm').bind('submit', trialMethod2).unbind('submit', trialMethod2);"> 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-29T20:37:44.523

由于 jQuery 的事件模型，第一个取消绑定方案不起作用。jQuery 将每个事件处理函数存储在一个数组中，您可以通过`$("#foo").data('events')`. 该`unbind`函数仅在此数组中查找给定函数。因此，您只能使用`unbind()`添加的事件处理程序`bind()`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T20:28:42.563

**如果他们使用 jQuery，任何人都不应该将他们的标记与他们的交互代码混为一谈。**

像这样向页面添加一些javascript：

```
$(function() {
    $('#aspnetForm').bind('submit',function() {
        trialMethod();
    });
    $('#btnTrial2').bind('click',function() {
        $('#aspnetForm').unbind('submit');
    });
    $('#btnTrial2').bind('click',function() {
        $('#aspnetForm').bind('submit', trialMethod2).unbind('submit');
    });
}); 
```

现在，把它排除在外......现在一切都应该工作了（即使你现在将`#aspnetForm`在按下第二个按钮时完全解除绑定之前对它进行双重绑定）。问题是表格从一开始就没有真正“绑定”过。您可以取消绑定`onsubmit`标记中的参数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-25T00:02:20.540

您可以通过删除相应的属性来解除绑定：

```
 $('#aspnetForm').removeAttr('onsubmit'); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T20:20:18.713

我之前遇到过类似的问题。我得出的结论是，您只能取消绑定已绑定的方法。由于 trialmethod() 没有通过 jquery 绑定，因此在该方法上调用 unbind 将不起作用。

如果您有任何机会，请告诉我们。

谢谢。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-17T16:30:39.247

绑定、取消绑定和表单提交操作存在错误：

如果绑定然后取消绑定，并且要提交表单，则不能使用`$(form).submit()`，但是`$(form INPUT[type=submit]).click()`！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-06T14:33:30.683

据我在 jQuery API 文档中看到的，`unbind()`已被弃用： [https ://api.jquery.com/unbind/](https://api.jquery.com/unbind/)

> 从 jQuery 3.0 开始，.unbind() 已被弃用。自 jQuery 1.7 起，它被 .off() 方法所取代，因此已经不鼓励使用它。

`off()`应该改用方法。

# java - 如何从 Applet 中模拟模式对话框？

> ID：804023
> 
> 赞同：4
> 
> 时间：2009-04-29T20:03:27.787
> 
> 标签：java, applet, opera, securitymanager

在 setVisible(true) 上，我调用以下代码来启动模式对话框：

```
private synchronized void startModal () {
  try {
    if (SwingUtilities.isEventDispatchThread()) {
      EventQueue theQueue = getToolkit().getSystemEventQueue();
      while (isVisible()) {
        AWTEvent event = theQueue.getNextEvent();
        Object source = event.getSource();
        if (event instanceof ActiveEvent) {
          ((ActiveEvent) event).dispatch();
        } else if (source instanceof Component) {
          ((Component) source).dispatchEvent(event);
        } else if (source instanceof MenuComponent) {
          ((MenuComponent) source).dispatchEvent(event);
        } else {
          System.err.println("Unable to dispatch: " + event);
        }
      }
    } else {
      while (isVisible()) {
        wait();
      }
    }
  } catch (InterruptedException ignored) { }
} 
```

这在大多数浏览器中都非常有效。但是，在 Windows 的 Opera 和 Safari 中，我遇到了以下严重的异常：

```
java.security.AccessControlException: access denied (java.awt.AWTPermission accessEventQueue)
    at java.security.AccessControlContext.checkPermission(Unknown Source)
    at java.security.AccessController.checkPermission(Unknown Source)
    at java.lang.SecurityManager.checkPermission(Unknown Source)
    at java.lang.SecurityManager.checkAwtEventQueueAccess(Unknown Source)
    at java.awt.Toolkit.getSystemEventQueue(Unknown Source) 
```

是否有在这些浏览器中生成假模态对话框的解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T16:10:04.270

Opera 出现问题的原因可能是 Opera 有自己的名为 opera.policy 的 java.policy 文件（位于 Opera_installation_directory\classes 文件夹下）。但是，在我的 Opera 安装中，我看不到任何未在 Opera 中授予但在默认 java.policy 文件中授予的权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T20:59:22.443

除非您有一个奇怪的实现，否则应该授予该权限（Sun PlugIn 自 1.2.2，IIRC 以来一直授予它）。我们在谈论哪些版本？

这可能不是最好的调度循环。

您可能应该`isVisible`取消 EDT。

模态界面通常很讨厌。

模态对话框有什么问题？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T12:09:48.827

如果我可以提供一种可行的不同方法，而不是拦截事件线程中的事件，[您可以使用玻璃窗格来阻止所有输入请求](http://www.java2s.com/Code/Java/Swing-JFC/Showhowaglasspanecanbeusedtoblockmouseandkeyevents.htm)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T14:37:00.220

你不需要签署你的小程序才能让它工作吗？

签署小程序

允许小程序完成所有这些事情的方法是对其进行数字签名。实际上，签名者说“这个小程序可以安全使用，如果你信任我，你就可以信任这个小程序，因为通过我的签名，你可以确保它在我签名后没有被篡改过。” 然后将询问用户她是否要信任签名者（通常在一个小对话框中），如果她愿意，则小程序可以以完全权限继续。如果信任被拒绝，小程序将继续在沙箱内以有限的权限运行。

是否信任小程序的决定应该非常明智，因为受信任的小程序具有与本地启动的应用程序相同的权限：它可以读取和删除文件，以及通过网络传输数据。

可以在此处找到有关小程序安全模型的更全面的说明。这包括小程序限制的完整列表。

有关小程序签名的介绍和更多信息的链接，请阅读此内容，尤其是此内容。Internet Explorer（和 MS JVM）有点不标准；阅读此内容以了解该做什么的概述。

如果，即使在签署小程序之后，您仍然收到 SecurityException，请尝试将代码作为特权代码运行：

AccessController.doPrivileged(new PrivilegedAction() { public Object run() { // 这里执行安全敏感操作 return null; } });

JavaDoc:java.security.AccessController

政策文件

授予小程序附加功能的另一种方法是使用策略文件，Sun 有一篇介绍性文章，这里还有一篇专门针对小程序的文章。使用策略可以以更细粒度的方式控制授予小程序的权限。例如，可以授予小程序访问本地文件系统的权限，但不能授予它们被拒绝的任何其他功能。这是一个例子。

使用策略文件的缺点是它们驻留在本地文件系统上，因此用户必须对通常不在他们视线范围内的文件进行更改，并且其内容不容易理解。

以下示例显示了如何撤销大多数小程序限制。任何权限都可以变得更具体，例如 FilePermission 可以只授予选定的文件，并且具有只读访问权限。每个 Permission 类的 javadocs 详细解释了可能的情况。最好使用最受限制的设置。特别是 RuntimePermission 可用于创建 ClassLoaders 和 SecurityManagers，它们可以规避更多的小程序限制。

```
 grant codeBase "http://geosim.cs.vt.edu/geosim/-" {
   permission java.io.FilePermission "<<ALL FILES>>", "read, write, execute, delete";
   permission java.net.SocketPermission "*", "accept, connect, listen, resolve";
   permission java.util.PropertyPermission "*", "read, write";
   permission java.lang.RuntimePermission "*";
   permission java.awt.AWTPermission "showWindowWithoutWarningBanner";
 }; 
```

Javadocs

JavaDoc:java.awt.AWTPermission JavaDoc:java.io.FilePermission JavaDoc:java.lang.RuntimePermission JavaDoc:java.net.SocketPermission JavaDoc:java.util.PropertyPermission

# .net - .NET 的 BLOB 分布式存储？

> ID：804034
> 
> 赞同：15
> 
> 时间：2009-04-29T20:07:00.603
> 
> 标签：.net, database, storage, distributed, dht

我正在寻找一个经过合理测试的库+服务器来存储持久分布式哈希表。

我对使用基于 SQL 的解决方案犹豫不决，因为数据是高度面向文档的，由数百万个 ~64KB 的 blob 组成，只有一个索引（由所述 BLOB 的哈希计算） - 并且需要能够分布以进行长期扩展前景。

由于费用和带宽方面的考虑，S3 等外部解决方案不是一种选择。

像 CouchDB 或 Project Voldemort 这样的东西是理想的——但是两者都明显缺乏 .NET 绑定（PV 可以是来自 Java 的 IKVMC——但是有“问题”。）。key和value都是字节数组（key为16字节，value最大2048KB平均64KB）

到目前为止，我已经搜索了 Dynamo、Chord 和类似的某种 .NET 端口 - 但是大多数结果似乎是纯粹的内存缓存，并且缺乏任何形式的持久性或复制。

有人有任何想法或建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T00:00:17.563

看看 Ayende 的[Rhino DHT](http://ayende.com/Blog/category/555.aspx)。可能更符合您正在寻找的内容。来源可以在[这里](http://sourceforge.net/scm/?type=svn&group_id=173824)获取。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-17T17:35:09.850

[DryadLINQ](http://research.microsoft.com/en-us/projects/dryadlinq/default.aspx)或[Hadoop.Net](http://code.google.com/p/hadoopdotnet/)可能会有所帮助。

Hadoop.Net 是 Hadoop 的 dotnet 版本。更多关于 Hadoop 的信息可以在[这里找到](http://hadoop.apache.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-17T18:01:17.147

我实际上认为您应该考虑使用 SQL Server 2008。将数据存储在具有 varbinary(max) 列的表中，以及包含该列哈希的列中。按照您的建议，索引哈希。

然后，您将能够使用该产品的各种分发功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T20:21:16.713

考虑[MS 速度](http://blogs.msdn.com/velocity/)。

简介：“Velocity”是一个分布式内存应用程序缓存平台，用于开发可扩展、可用和高性能的应用程序。“速度”融合多台计算机的内存，为应用程序提供一个统一的缓存视图。应用程序可以存储任何可序列化的 CLR 对象，而不必担心对象的存储位置。只需按需添加更多计算机即可实现可扩展性。“速度”还允许跨集群存储数据副本，从而保护数据免受故障影响。“Velocity”可以配置为作为通过网络访问的服务运行，也可以嵌入分布式应用程序中运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-15T07:44:28.193

您可以尝试 StorageEdge，它在后端具有 NCache 技术，因此通过使用它，您将获得分布式缓存的支持，这将提高 SharePoint 的性能、可靠性、可扩展性并同时优化其存储。

这是 StorageEdge 主页的链接[http://www.alachisoft.com/storageedge/](http://www.alachisoft.com/storageedge/)我希望它有所帮助:)

Rest for .NET 你可以随时尝试 NCache 在分布式缓存中的大牌，你可以在[http://www.alachisoft.com/ncache/上找到它的详细信息](http://www.alachisoft.com/ncache/)

# c# - 通用类文件名约定

> ID：804036
> 
> 赞同：57
> 
> 时间：2009-04-29T20:07:23.113
> 
> 标签：c#, generics

我希望能够区分一个类的通用版本和常规（非通用）版本。就像 .NET 框架对它的几个接口和集合类的通用和非通用版本所做的那样。（[队列](http://msdn.microsoft.com/en-us/library/system.collections.queue.aspx)，[队列（T）](http://msdn.microsoft.com/en-us/library/7977ey2c.aspx)）

我通常喜欢遵循每个文件一个类的约定（如在 Java 中）。是否有命名包含单个泛型类的文件的通用约定？我对Windows（特别是NTFS）最感兴趣，但似乎一个好的约定（至少有点）是可移植的。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-29T20:26:22.320

在 Microsoft，他们使用`ClassNameOfT.cs`.

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-07-24T19:09:51.457

在查找其他人用于通用类文件名的约定后发现了这个问题。

最近我一直在使用`ClassName[T].cs`. 我真的很喜欢这个约定，我认为它优于其他约定，原因如下：

*   `ClassNameOfT.cs`与 Microsoft 约定（例如， ）相比，类型参数对您的影响要大一些 。
*   它允许您拥有多个类型参数而不会造成太多混乱：`Dictionary[TKey, TValue].cs`
*   它不需要您创建任何特殊文件夹，或将您的泛型类放在特殊的命名空间中。如果您只有几个泛型类，那么拥有一个专用于它们的特殊命名空间是不切实际的。

[我从Boo](http://boo.codehaus.org/)的通用语法中借用了这个约定，尽管稍作修改（Boo 使用`ClassName[of T]`）。

一些开发人员似乎对包含字母和下划线以外的任何内容的文件名有恐惧症，但是一旦您能够克服这种约定，这种约定似乎就非常有效。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-01-13T10:01:54.330

我看到这个话题在一年多前就被放弃了，但我仍然想分享我对这个公约的看法。

首先，拥有多个具有相同名称但类型参数数量不同的类并不总是向后兼容的情况。当然，您不会经常看到它，但是 .NET 的新 Action 和 Func 类就是这样设计的，我目前正在实现类似的东西。

为了清晰和可区分，我使用以下约定，仅指定给定类型的泛型参数的数量：

*   我的类.cs
*   MyClass.T1.cs
*   MyClass.T2.cs

这样，我的文件名保持简短，同时仍然清楚地传达类名和不同数量的类型参数，代价是一个简单的额外点（根据我的经验，这是在文件名和看起来比逗号和其他非字母数字字符好得多，但这只是我猜的口味问题）。输入类型参数的名称（或首字母缩写词）只会延长文件名，而在这个级别上，我对类型参数的实际名称并不感兴趣......

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-09-07T20:23:50.417

如果您正在运行 Visual Studio 2008，请不要在通用文件名中使用重音符号 `。它们有一个已知问题会导致断点失败：

[http://connect.microsoft.com/VisualStudio/feedback/details/343042/grave-accent-in-filename-causes-failure-to-recognize-target-language-breakpoints-fail](http://connect.microsoft.com/VisualStudio/feedback/details/343042/grave-accent-in-filename-causes-failure-to-recognize-target-language-breakpoints-fail)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2016-10-11T13:51:32.707

就个人而言，我不会使用重音符号：

```
Foo.cs
Foo`1.cs 
```

原因很简单，我害怕重音。它不仅有一个可怕的名字，而且我不确定不同的文件系统、版本控制系统和 URL 将如何处理它。因此，我更愿意坚持使用常见的字母数字字符。

`NameOfT.cs`根据在 GitHub 上的搜索，似乎在 ASP.NET Core 中使用。40 个结果。[参考](https://github.com/aspnet/AspNetCore/search?q=ofT+in%3Apath&type=Code)。

也用于 .NET Core 运行时。36 个结果。[参考](https://github.com/dotnet/runtime/search?utf8=%E2%9C%93&q=ofT%20in%3Apath&type=Code)。

例子：

```
Foo.cs
FooOfT.cs 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-05-18T13:58:23.817

有时我也看到`ClassName{T}.cs`，但命名它很常见`ClassNameOfT.cs`（就像微软使用它之前提到的那样）

EntityFrameworkCore 项目（也是微软的）使用`ClassName`.cs`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T20:09:09.177

怎么样：

```
Type.cs 
```

和

```
TypeGeneric.cs 
```

每当我过去这样做时，我总是将这两种类型放在一个文件中，并以非泛型类型作为文件名。我认为这让事情变得非常清楚，因为 .NET 没有像 Java 那样对每个文件的一种类型进行约定/限制。

但是如果你必须那么我会建议像我上面所说的那样，使用后缀将使文件一起显示在任何按字母顺序排列的列表中（解决方案资源管理器、Windows 资源管理器等）。

这是另一个想法：

```
Type`1.cs 
```

这将允许您通过它们接受的泛型类型参数的数量来分解不同的泛型类型。这只是一个想法，因为我仍然认为将所有类型放在一个文件中会更简单。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T20:11:14.930

所有新的 Microsoft 类都使用泛型。在仿制药问世之前，and 就已经存在了`Queue`。`ArrayList`泛型是前进的方向。

每个文件一个类的约定是在类名之后命名文件名（无论是通用的还是非通用的）。对于 MyClass，您将拥有 MyClas.cs。对于每个新命名空间，您都需要创建一个新文件夹。这也是 Visual Studio 的工作方式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-29T20:16:54.167

我可能会将它们放在文件夹中并改用命名空间机制。您可以将 System.Collections 与 System.Collections.Generic 进行比较。另一方面，如果类使用泛型比不使用泛型更常见，那么最好指出那些不使用泛型的类。也就是说，如果您真的想将泛型类与其他类分开。就我个人而言，我通常不会费心去做，因为我并没有真正看到它有什么实际好处。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T20:18:53.973

从目前的反应来看，似乎没有达成共识。

在子命名空间（和子文件夹）“Generics”（如 System.Collections.Generics）中使用相同的文件名是一个选项。但并不总是需要创建一个新的命名空间。

例如，在具有为向后兼容而维护但标有 ObsoleteAttribute 的非泛型类的现有命名空间中，最好将泛型版本保留在同一命名空间中。

我认为后缀是一种合理的方式。我采用了使用类型参数作为后缀的约定（因此：MyClassT 代表 MyClass<T>，或 MyDictionaryKV 代表 MyDictionary<K,V>。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-29T20:10:04.683

我可能在项目中有两个文件夹，比如 Gereric、NonGeneric 或类似的东西。它们仍然可以在同一个命名空间中，然后它们都可以具有相同的文件名。只是一个想法...

# design-patterns - 身份映射中的空键

> ID：804041
> 
> 赞同：1
> 
> 时间：2009-04-29T20:08:59.443
> 
> 标签：design-patterns, data-modeling, orm

我有一个在身份映射中使用的域对象（键是对象的`Id`属性）。

伪代码：

```
map = new Mapping();
map[domainObj.Id] = 'foo'; 
```

我观察对象告诉我它何时保存到数据库中：

```
domainObj.bind('saved', function() {
    map[domainObj.Id] = 'new foo!'
}) 
```

对于新对象，该`Id`字段为空并且在保存到数据库之前不会填充。

这就是我的问题。在新对象的情况下，查找“ `map[domainObj.Id]`”失败，因为对象的身份在保存后发生了变化！

在这样的身份图中使用对象的最佳方法是什么？

**约束**：

1.  我使用的语言不允许对象作为映射中的键 [JavaScript]
2.  保存新对象时*必须*在服务器上生成该`Id`字段

 ** * *

**更新**

感谢您的反馈。我真的很想让值对象以与实体相同的方式映射：仅仅因为值对象尚未保存并不意味着它没有要映射到我的应用程序的值。事实上，我误解了身份映射是什么（在重新阅读模式定义后，我发现我并没有真正使用它）。

我想出的解决方案几乎直接来自 Igor 的回答：每个对象在实例化时都会获得一个分配给它的随机 id。它在对象所在的上下文的生命周期内是唯一的、不可变的和不变的。它适用于数据库中的实体和新的实例化。实体的调整是它被设置为匹配对象的真实身份。这使得调试更容易一些。这是我在映射中用作键的值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T20:22:39.817

好吧，您必须找到一种方法来推迟将对象添加到地图中，直到*它*被保存并分配一个 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T05:25:26.610

在对象获得身份之前，它只是一个**值对象**。只有在身份确立之后，它才成为一个**实体**。

在对象成为实体之前，您不能真正将其放入像您这样的身份映射中 - 这没有任何意义，因为您无法将其拉出（因为您没有唯一的密钥来找到它）。

一种可能的方法：

1.  向类添加一个标志，指示对象的状态（新/已保存）。
2.  为这些对象实现一个临时（客户端）ID
3.  选修的：
    1.  将“新”对象保存在**单独**的身份映射中（如果您**无法**避免客户端 ID 和服务器 ID 之间的 ID 冲突）
    2.  将“新”对象保留在**同一个**身份映射中（如果您**可以避免**客户端 ID 和服务器 ID 之间的 ID 冲突）
4.  保存对象后，将客户端 ID 替换为服务器 ID，将状态设置为已保存，移动到主身份映射（如有必要）。

有关[实体与值对象的信息，请参见此处](http://calenlegaspi.blogspot.com/2007/02/entity-vs-value-object_27.html)

# c# - 有没有办法在 C# 的 LINQ Where 方法中捕获索引值？

> ID：804043
> 
> 赞同：6
> 
> 时间：2009-04-29T20:09:21.190
> 
> 标签：c#, linq

我的以下 C# 代码显然是一个 hack，那么如何在 Where 方法中捕获索引值？

```
 string[] IntArray = { "a", "b", "c", "b", "b"};
                    int index=0;
                    var query = IntArray.Where((s,i) => (s=="b")&((index=i)==i));

    //"&" and "==i" only exists to return a bool after the assignment ofindex

    foreach (string s in query)
                {
                    Console.WriteLine("{0} is the original index of {1}", index, s);
                }
//outputs...
//1 is the original index of b
//3 is the original index of b
//4 is the original index of b 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T20:25:43.443

该`Where`方法*仅*返回该项目是否应包含在结果中。该函数无法以合理的方式提供更多信息（它*可以*捕获一个局部变量并对其进行处理，但这太可怕了）。

如果您希望在最终结果中包含索引，则需要创建一个包含该索引的投影。如果您想在最终结果中使用*原始*索引，则需要将该投影放在任何`Where`子句之前。

这是一个例子：

```
using System;
using System.Collections.Generic;
using System.Linq;

public class Test
{
    static void Main()
    {
        IEnumerable<char> letters = "aBCdEFghIJklMNopQRsTUvWyXZ";

        var query = letters.Select((c, i) => 
                                   new { Char=c, OriginalIndex=i })
                           .Where(x => char.IsLower(x.Char))
                           .Select((x, i) =>
                                   new { x.Char,
                                         x.OriginalIndex,
                                         FinalIndex=i});

        foreach (var result in query)
        {
            Console.WriteLine(result);
        }
    }
} 
```

结果：

```
{ Char = a, OriginalIndex = 0, FinalIndex = 0 }
{ Char = d, OriginalIndex = 3, FinalIndex = 1 }
{ Char = g, OriginalIndex = 6, FinalIndex = 2 }
{ Char = h, OriginalIndex = 7, FinalIndex = 3 }
{ Char = k, OriginalIndex = 10, FinalIndex = 4 }
{ Char = l, OriginalIndex = 11, FinalIndex = 5 }
{ Char = o, OriginalIndex = 14, FinalIndex = 6 }
{ Char = p, OriginalIndex = 15, FinalIndex = 7 }
{ Char = s, OriginalIndex = 18, FinalIndex = 8 }
{ Char = v, OriginalIndex = 21, FinalIndex = 9 }
{ Char = y, OriginalIndex = 23, FinalIndex = 10 } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T20:22:13.827

你要哪个索引？你有三倍 B. 如果你想要 b 的所有索引，那么：

```
 string[] IntArray = { "a", "b", "c", "b", "b" }; 

        var query = IntArray
                    .Select((x, i) => new { value = x, idx = i })
                    .Where(s => s.value == "b"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T20:27:21.927

您当前的代码捕获变量中“b”的最后一个索引`index`。要使用 LINQ 复制您的功能，请使用：

```
int index = IntArray.LastOrDefault(s => s == "b"); 
```

我不知道这是否是你真正想要的。

# php - 存储 PHP 数组的首选方法（json_encode 与序列化）

> ID：804045
> 
> 赞同：636
> 
> 时间：2009-04-29T20:09:43.560
> 
> 标签：php, performance, arrays, json, serialization

我需要将多维关联数据数组存储在平面文件中以进行缓存。我可能偶尔会遇到需要将其转换为 JSON 以在我的 Web 应用程序中使用，但绝大多数时间我将直接在 PHP 中使用该数组。

在这个文本文件中将数组存储为 JSON 或 PHP 序列化数组会更有效吗？我环顾四周，似乎在最新版本的 PHP（5.3）中，`json_decode`实际上比`unserialize`.

我目前倾向于将数组存储为 JSON，因为我觉得如果必要的话它更容易被人类阅读，它可以在 PHP 和 JavaScript 中使用，而且几乎不需要付出任何努力，而且根据我的阅读，它甚至可能是解码速度更快（但不确定编码）。

有谁知道任何陷阱？任何人都有很好的基准来展示这两种方法的性能优势吗？

* * *

## 回答 #1

> 赞同：587
> 
> 时间：2009-04-29T20:21:24.343

取决于你的优先级。

如果性能是您的绝对驾驶特性，那么一定要使用最快的。在做出选择之前，请确保您对差异有充分的了解

*   不像`serialize()`您需要添加额外的参数来保持 UTF-8 字符不变：（`json_encode($array, JSON_UNESCAPED_UNICODE)` 否则它将 UTF-8 字符转换为 Unicode 转义序列）。
*   JSON 将不记得对象的原始类是什么（它们总是作为 stdClass 的实例恢复）。
*   你不能利用`__sleep()`和`__wakeup()`使用 JSON
*   默认情况下，只有公共属性使用 JSON 序列化。（在`PHP>=5.4`你可以实现[JsonSerializable](http://php.net/manual/en/class.jsonserializable.php)来改变这种行为）。
*   JSON 更便携

可能还有其他一些我目前无法想到的差异。

一个简单的速度测试来比较两者

```
<?php

ini_set('display_errors', 1);
error_reporting(E_ALL);

// Make a big, honkin test array
// You may need to adjust this depth to avoid memory limit errors
$testArray = fillArray(0, 5);

// Time json encoding
$start = microtime(true);
json_encode($testArray);
$jsonTime = microtime(true) - $start;
echo "JSON encoded in $jsonTime seconds\n";

// Time serialization
$start = microtime(true);
serialize($testArray);
$serializeTime = microtime(true) - $start;
echo "PHP serialized in $serializeTime seconds\n";

// Compare them
if ($jsonTime < $serializeTime) {
    printf("json_encode() was roughly %01.2f%% faster than serialize()\n", ($serializeTime / $jsonTime - 1) * 100);
}
else if ($serializeTime < $jsonTime ) {
    printf("serialize() was roughly %01.2f%% faster than json_encode()\n", ($jsonTime / $serializeTime - 1) * 100);
} else {
    echo "Impossible!\n";
}

function fillArray( $depth, $max ) {
    static $seed;
    if (is_null($seed)) {
        $seed = array('a', 2, 'c', 4, 'e', 6, 'g', 8, 'i', 10);
    }
    if ($depth < $max) {
        $node = array();
        foreach ($seed as $key) {
            $node[$key] = fillArray($depth + 1, $max);
        }
        return $node;
    }
    return 'empty';
} 
```

* * *

## 回答 #2

> 赞同：253
> 
> 时间：2009-04-29T20:13:32.100

**JSON**比 PHP 的序列化格式更简单、更快，**除非**：

*   您正在存储深度嵌套的数组：： [`json_decode()`](http://www.php.net/json_decode)“如果 JSON 编码的数据深度超过 127 个元素，此函数将返回 false。”
*   您将需要反序列化的对象存储为正确的类
*   您正在与不支持 json_decode 的旧 PHP 版本进行交互

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-07-07T14:20:05.883

我写了一篇关于这个主题的博文：“[缓存一个大数组：JSON、序列化还是 var_export？](http://web.archive.org/web/20150906085640/http://techblog.procurios.nl/k/n618/news/view/34972/14863/cache-a-large-array-json-serialize-or-var_export.html) ”。在这篇文章中，表明序列化是小型到大型数组的最佳选择。对于非常大的数组 (> 70MB)，JSON 是更好的选择。

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2011-01-27T18:53:54.420

您可能还对[https://github.com/phadej/igbinary](https://github.com/phadej/igbinary)感兴趣- 它为 PHP 提供了不同的序列化“引擎”。

我的随机/任意“性能”数据，在 64 位平台上使用 PHP 5.3.5 显示：

JSON：

*   JSON 在 2.180496931076 秒内编码
*   JSON 在 9.8368630409241 秒内解码
*   序列化的“字符串”大小：13993

原生 PHP：

*   PHP 在 2.9125759601593 秒内序列化
*   PHP 在 6.4348418712616 秒内反序列化
*   序列化的“字符串”大小：20769

二进制：

*   *WIN* igbinary 在 1.6099879741669 秒内序列化
*   *WIN* igbinrary 在 4.7737920284271 秒内反序列化
*   *WIN*序列化“字符串”大小：4467

因此，igbinary_serialize() 和 igbinary_unserialize() 更快，并且使用更少的磁盘空间。

我使用了上面的 fillArray(0, 3) 代码，但使数组键更长的字符串。

igbinary 可以存储与 PHP 的本机序列化相同的数据类型（因此对象等没有问题），如果您愿意，可以告诉 PHP5.3 将其用于会话处理。

另请参阅[http://ilia.ws/files/zendcon_2010_hidden_](http://ilia.ws/files/zendcon_2010_hidden_features.pdf) ​​features.pdf - 特别是幻灯片 14/15/16

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2010-07-10T23:44:29.750

Y 刚刚测试了序列化和 json 编码和解码，加上它将存储的字符串的大小。

```
JSON encoded in 0.067085981369 seconds. Size (1277772)
PHP serialized in 0.12110209465 seconds. Size (1955548)
JSON decode in 0.22470498085 seconds
PHP serialized in 0.211947917938 seconds
json_encode() was roughly 80.52% faster than serialize()
unserialize() was roughly 6.02% faster than json_decode()
JSON string was roughly 53.04% smaller than Serialized string 
```

我们可以得出结论，JSON 编码更快并产生更小的字符串，但反序列化更快地解码字符串。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-04-29T23:04:23.953

如果您正在缓存您最终想要在以后“包含”的信息，您可能需要尝试使用[var_export](http://us2.php.net/var_export)。这样，您只会在“序列化”中受到打击，而不是在“反序列化”中受到打击。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-11-23T19:14:59.107

我增加了测试以包括反序列化性能。这是我得到的数字。

```
Serialize

JSON encoded in 2.5738489627838 seconds
PHP serialized in 5.2861361503601 seconds
Serialize: json_encode() was roughly 105.38% faster than serialize()

Unserialize

JSON decode in 10.915472984314 seconds
PHP unserialized in 7.6223039627075 seconds
Unserialize: unserialize() was roughly 43.20% faster than json_decode() 
```

所以 json 似乎编码速度更快，但解码速度慢。因此，这可能取决于您的应用程序以及您最期望做的事情。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2014-04-17T14:35:58.077

非常好的话题，在阅读了几个答案之后，我想分享我在这个主题上的实验。

我有一个用例，几乎每次我与数据库交谈时都需要查询一些“巨大”的表（不要问为什么，只是一个事实）。数据库缓存系统不合适，因为它不会缓存不同的请求，所以我想到了 php 缓存系统。

我试过`apcu`了，但它不适合需要，在这种情况下内存不够可靠。下一步是通过序列化缓存到文件中。

表有 18 列的 14355 个条目，这些是我在读取序列化缓存时的测试和统计信息：

## JSON：

正如大家所说，`json_encode`/的主要不便之处`json_decode`在于它将所有内容都转换为`StdClass`实例（或对象）。如果你需要循环它，将它转换为一个数组是你可能会做的，是的，它增加了转换时间

> 平均时间：780.2 毫秒；内存使用：41.5MB；缓存文件大小：3.8MB

## 消息包

@hutch 提到[msgpack](http://msgpack.org/)。漂亮的网站。让我们试一试好吗？

> 平均时间：497 毫秒；内存使用：32MB；缓存文件大小：2.8MB

这更好，但需要新的扩展；编译有时害怕的人......

## 二进制

@GingerDog 提到[igbinary](https://github.com/phadej/igbinary)。请注意，我设置了 是`igbinary.compact_strings=Off`因为我更关心阅读性能而不是文件大小。

> 平均时间：411.4 毫秒；内存使用：36.75MB；缓存文件大小：3.3MB

比味精包好。不过，这个也需要编译。

### `serialize`/`unserialize`

> 平均时间：477.2 毫秒；内存使用：36.25MB；缓存文件大小：5.9MB

比 JSON 更好的性能，数组越大，速度越慢`json_decode`，但你已经是新的了。

这些外部扩展正在缩小文件大小，并且在纸上看起来很棒。数字不会说谎*。如果您获得与使用标准 PHP 函数几乎相同的结果，那么编译扩展的意义何在？

我们还可以推断，根据您的需求，您会选择与其他人不同的东西：

*   IgBinary 真的很好，性能比 MsgPack 好
*   Msgpack 更擅长压缩数据（请注意，我没有尝试过 igbinary compact.string 选项）。
*   不想编译？使用标准。

就是这样，另一种序列化方法比较来帮助您选择一个！

*使用 PHPUnit 3.7.31、php 5.5.10 测试 - 仅使用标准硬盘和旧双核 CPU 解码 - 10 次相同用例测试的平均数，您的统计数据可能不同

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2010-06-27T00:46:40.957

似乎序列化是我要使用的一个，原因有两个：

*   有人指出，反序列化比 json_decode 更快，“读”的情况听起来比“写”的情况更有可能。

*   当字符串包含无效的 UTF-8 字符时，我遇到了 json_encode 问题。发生这种情况时，字符串最终为空，导致信息丢失。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2010-11-17T00:14:31.000

我已经在一个相当复杂的、温和嵌套的多重哈希上对此进行了非常彻底的测试，其中包含各种数据（字符串、NULL、整数），并且序列化/反序列化最终比 json_encode/json_decode 快得多。

json 在我的测试中的唯一优势是它的“打包”尺寸更小。

这些是在 PHP 5.3.3 下完成的，如果您需要更多详细信息，请告诉我。

这是测试结果，然后是生成它们的代码。我无法提供测试数据，因为它会泄露我不能在野外泄露的信息。

```
JSON encoded in 2.23700618744 seconds
PHP serialized in 1.3434419632 seconds
JSON decoded in 4.0405561924 seconds
PHP unserialized in 1.39393305779 seconds

serialized size : 14549
json_encode size : 11520
serialize() was roughly 66.51% faster than json_encode()
unserialize() was roughly 189.87% faster than json_decode()
json_encode() string was roughly 26.29% smaller than serialize()

//  Time json encoding
$start = microtime( true );
for($i = 0; $i < 10000; $i++) {
    json_encode( $test );
}
$jsonTime = microtime( true ) - $start;
echo "JSON encoded in $jsonTime seconds<br>";

//  Time serialization
$start = microtime( true );
for($i = 0; $i < 10000; $i++) {
    serialize( $test );
}
$serializeTime = microtime( true ) - $start;
echo "PHP serialized in $serializeTime seconds<br>";

//  Time json decoding
$test2 = json_encode( $test );
$start = microtime( true );
for($i = 0; $i < 10000; $i++) {
    json_decode( $test2 );
}
$jsonDecodeTime = microtime( true ) - $start;
echo "JSON decoded in $jsonDecodeTime seconds<br>";

//  Time deserialization
$test2 = serialize( $test );
$start = microtime( true );
for($i = 0; $i < 10000; $i++) {
    unserialize( $test2 );
}
$unserializeTime = microtime( true ) - $start;
echo "PHP unserialized in $unserializeTime seconds<br>";

$jsonSize = strlen(json_encode( $test ));
$phpSize = strlen(serialize( $test ));

echo "<p>serialized size : " . strlen(serialize( $test )) . "<br>";
echo "json_encode size : " . strlen(json_encode( $test )) . "<br></p>";

//  Compare them
if ( $jsonTime < $serializeTime )
{
    echo "json_encode() was roughly " . number_format( ($serializeTime / $jsonTime - 1 ) * 100, 2 ) . "% faster than serialize()";
}
else if ( $serializeTime < $jsonTime )
{
    echo "serialize() was roughly " . number_format( ($jsonTime / $serializeTime - 1 ) * 100, 2 ) . "% faster than json_encode()";
} else {
    echo 'Unpossible!';
}
    echo '<BR>';

//  Compare them
if ( $jsonDecodeTime < $unserializeTime )
{
    echo "json_decode() was roughly " . number_format( ($unserializeTime / $jsonDecodeTime - 1 ) * 100, 2 ) . "% faster than unserialize()";
}
else if ( $unserializeTime < $jsonDecodeTime )
{
    echo "unserialize() was roughly " . number_format( ($jsonDecodeTime / $unserializeTime - 1 ) * 100, 2 ) . "% faster than json_decode()";
} else {
    echo 'Unpossible!';
}
    echo '<BR>';
//  Compare them
if ( $jsonSize < $phpSize )
{
    echo "json_encode() string was roughly " . number_format( ($phpSize / $jsonSize - 1 ) * 100, 2 ) . "% smaller than serialize()";
}
else if ( $phpSize < $jsonSize )
{
    echo "serialize() string was roughly " . number_format( ($jsonSize / $phpSize - 1 ) * 100, 2 ) . "% smaller than json_encode()";
} else {
    echo 'Unpossible!';
} 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2012-11-12T10:18:39.947

我也做了一个小基准测试。我的结果是一样的。但我需要解码性能。我注意到的地方，就像上面的一些人所说的那样，`unserialize`比`json_decode`. `unserialize`大约需要 60-70% 的`json_decode`时间。所以结论相当简单：当你需要编码性能时，使用`json_encode`，当你需要解码性能时，使用`unserialize`. 因为您不能合并这两个功能，所以您必须在需要更高性能的地方做出选择。

我的伪基准：

*   使用一些随机键和值定义数组 $arr
*   对于 x < 100；x++; 序列化和 json_encode $arr 的 array_rand
*   对于 y < 1000；是++；json_decode json 编码的字符串 - 计算时间
*   对于 y < 1000；是++；反序列化序列化的字符串 - 计算时间
*   回显更快的结果

平均而言：反序列化赢得了 96 次超过 json_decode 的 4 倍。在 2.5 毫秒内平均大约 1.5 毫秒。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2020-07-24T19:52:49.003

我知道这已经很晚了，但是答案已经很老了，我认为我的基准测试可能会有所帮助，因为我刚刚在 PHP 7.4 中进行了测试

Serialize/Unserialize 比 JSON 快得多，占用更少的内存和空间，并且在 PHP 7.4 中完全胜出，但我不确定我的测试是最有效还是最好的，

我基本上创建了一个 PHP 文件，它返回一个我编码、序列化、然后解码和反序列化的数组。

```
$array = include __DIR__.'/../tests/data/dao/testfiles/testArray.php';

//JSON ENCODE
$json_encode_memory_start = memory_get_usage();
$json_encode_time_start = microtime(true);

for ($i=0; $i < 20000; $i++) { 
    $encoded = json_encode($array);
}

$json_encode_time_end = microtime(true);
$json_encode_memory_end = memory_get_usage();
$json_encode_time = $json_encode_time_end - $json_encode_time_start;
$json_encode_memory = 
$json_encode_memory_end - $json_encode_memory_start;

//SERIALIZE
$serialize_memory_start = memory_get_usage();
$serialize_time_start = microtime(true);

for ($i=0; $i < 20000; $i++) { 
    $serialized = serialize($array);
}

$serialize_time_end = microtime(true);
$serialize_memory_end = memory_get_usage();
$serialize_time = $serialize_time_end - $serialize_time_start;
$serialize_memory = $serialize_memory_end - $serialize_memory_start;

//Write to file time:
$fpc_memory_start = memory_get_usage();
$fpc_time_start = microtime(true);

for ($i=0; $i < 20000; $i++) { 
    $fpc_bytes = 
    file_put_contents(
        __DIR__.'/../tests/data/dao/testOneBigFile',
        '<?php return '.var_export($array,true).' ?>;'
    );
}

$fpc_time_end = microtime(true);
$fpc_memory_end = memory_get_usage();
$fpc_time = $fpc_time_end - $fpc_time_start;
$fpc_memory = $fpc_memory_end - $fpc_memory_start;

//JSON DECODE
$json_decode_memory_start = memory_get_usage();
$json_decode_time_start = microtime(true);

for ($i=0; $i < 20000; $i++) { 
    $decoded = json_encode($encoded);
}

$json_decode_time_end = microtime(true);
$json_decode_memory_end = memory_get_usage();
$json_decode_time = $json_decode_time_end - $json_decode_time_start;
$json_decode_memory = 
$json_decode_memory_end - $json_decode_memory_start;

//UNSERIALIZE
$unserialize_memory_start = memory_get_usage();
$unserialize_time_start = microtime(true);

for ($i=0; $i < 20000; $i++) { 
    $unserialized = unserialize($serialized);
}

$unserialize_time_end = microtime(true);
$unserialize_memory_end = memory_get_usage();
$unserialize_time = $unserialize_time_end - $unserialize_time_start;
$unserialize_memory = 
$unserialize_memory_end - $unserialize_memory_start;

//GET FROM VAR EXPORT:
$var_export_memory_start = memory_get_usage();
$var_export_time_start = microtime(true);

for ($i=0; $i < 20000; $i++) { 
    $array = include __DIR__.'/../tests/data/dao/testOneBigFile';
}

$var_export_time_end = microtime(true);
$var_export_memory_end = memory_get_usage();
$var_export_time = $var_export_time_end - $var_export_time_start;
$var_export_memory = $var_export_memory_end - $var_export_memory_start; 
```

结果：

Var 导出长度：11447 序列化长度：11541 Json 编码长度：11895 文件放置内容字节：11464

Json编码时间：1.9197590351105 序列化时间：0.160325050354 FPC时间：6.2793469429016

Json 编码内存：12288 序列化内存：12288 FPC 内存：0

JSON 解码时间：1.7493588924408 反序列化时间：0.19309520721436 Var 导出和包含：3.1974139213562

JSON 解码内存：16384 反序列化内存：14360 Var 导出和包含：192

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-02-05T04:10:23.143

首先，我更改了脚本以进行更多基准测试（并且还进行了 1000 次运行而不是仅 1 次）：

```
<?php

ini_set('display_errors', 1);
error_reporting(E_ALL);

// Make a big, honkin test array
// You may need to adjust this depth to avoid memory limit errors
$testArray = fillArray(0, 5);

$totalJsonTime = 0;
$totalSerializeTime = 0;
$totalJsonWins = 0;

for ($i = 0; $i < 1000; $i++) {
    // Time json encoding
    $start = microtime(true);
    $json = json_encode($testArray);
    $jsonTime = microtime(true) - $start;
    $totalJsonTime += $jsonTime;

    // Time serialization
    $start = microtime(true);
    $serial = serialize($testArray);
    $serializeTime = microtime(true) - $start;
    $totalSerializeTime += $serializeTime;

    if ($jsonTime < $serializeTime) {
        $totalJsonWins++;
    }
}

$totalSerializeWins = 1000 - $totalJsonWins;

// Compare them
if ($totalJsonTime < $totalSerializeTime) {
    printf("json_encode() (wins: $totalJsonWins) was roughly %01.2f%% faster than serialize()\n", ($totalSerializeTime / $totalJsonTime - 1) * 100);
} else {
    printf("serialize() (wins: $totalSerializeWins) was roughly %01.2f%% faster than json_encode()\n", ($totalJsonTime / $totalSerializeTime - 1) * 100);
}

$totalJsonTime = 0;
$totalJson2Time = 0;
$totalSerializeTime = 0;
$totalJsonWins = 0;

for ($i = 0; $i < 1000; $i++) {
    // Time json decoding
    $start = microtime(true);
    $orig = json_decode($json, true);
    $jsonTime = microtime(true) - $start;
    $totalJsonTime += $jsonTime;

    $start = microtime(true);
    $origObj = json_decode($json);
    $jsonTime2 = microtime(true) - $start;
    $totalJson2Time += $jsonTime2;

    // Time serialization
    $start = microtime(true);
    $unserial = unserialize($serial);
    $serializeTime = microtime(true) - $start;
    $totalSerializeTime += $serializeTime;

    if ($jsonTime < $serializeTime) {
        $totalJsonWins++;
    }
}

$totalSerializeWins = 1000 - $totalJsonWins;

// Compare them
if ($totalJsonTime < $totalSerializeTime) {
    printf("json_decode() was roughly %01.2f%% faster than unserialize()\n", ($totalSerializeTime / $totalJsonTime - 1) * 100);
} else {
    printf("unserialize() (wins: $totalSerializeWins) was roughly %01.2f%% faster than json_decode()\n", ($totalJsonTime / $totalSerializeTime - 1) * 100);
}

// Compare them
if ($totalJson2Time < $totalSerializeTime) {
    printf("json_decode() was roughly %01.2f%% faster than unserialize()\n", ($totalSerializeTime / $totalJson2Time - 1) * 100);
} else {
    printf("unserialize() (wins: $totalSerializeWins) was roughly %01.2f%% faster than array json_decode()\n", ($totalJson2Time / $totalSerializeTime - 1) * 100);
}

function fillArray( $depth, $max ) {
    static $seed;
    if (is_null($seed)) {
        $seed = array('a', 2, 'c', 4, 'e', 6, 'g', 8, 'i', 10);
    }
    if ($depth < $max) {
        $node = array();
        foreach ($seed as $key) {
            $node[$key] = fillArray($depth + 1, $max);
        }
        return $node;
    }
    return 'empty';
} 
```

我使用了 PHP 7 的这个版本：

> PHP 7.0.14 (cli) (built: Jan 18 2017 19:13:23) (NTS) Copyright (c) 1997-2016 The PHP Group Zend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies with Zend OPcache v7.0.14，版权所有 (c) 1999-2016，由 Zend Technologies 提供

我的结果是：

> serialize() (wins: 999) 比 json_encode() 快大约 10.98% unserialize() (wins: 987) 大约比 json_decode() 快 33.26% unserialize() (wins: 987) 比数组 json_decode 快大约 48.35% ()

很**明显**，serialize/unserialize 是**最快**的方法，而 json_encode/decode 是**最便携的。**

如果您考虑读取/写入序列化数据的频率是向非 PHP 系统发送或接收数据的 10 倍或更多的场景，那么您最好使用序列化/反序列化并在序列化之前使用 json_encode 或 json_decode在时间方面。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-10-21T03:34:54.743

在做出最终决定之前，请注意 JSON 格式对于关联数组是不安全的 -`json_decode()`会将它们作为对象返回：

```
$config = array(
    'Frodo'   => 'hobbit',
    'Gimli'   => 'dwarf',
    'Gandalf' => 'wizard',
    );
print_r($config);
print_r(json_decode(json_encode($config))); 
```

输出是：

```
Array
(
    [Frodo] => hobbit
    [Gimli] => dwarf
    [Gandalf] => wizard
)
stdClass Object
(
    [Frodo] => hobbit
    [Gimli] => dwarf
    [Gandalf] => wizard
) 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-09-07T18:51:42.160

在此处查看结果（对于将 PHP 代码放入 JS 代码框中的黑客行为感到抱歉）：

**[http://jsfiddle.net/newms87/h3b0a0ha/embedded/result/](http://jsfiddle.net/newms87/h3b0a0ha/embedded/result/)**

**结果：在 PHP 5.4 中，在不同大小的数组`serialize()`上`unserialize()`都明显更快。**

我针对真实世界的数据制作了一个测试脚本，用于比较 json_encode 与 serialize 以及 json_decode 与 unserialize。测试在生产中电子商务网站的缓存系统上运行。它只是获取已经在缓存中的数据，并测试对所有数据进行编码/解码（或序列化/反序列化）的时间，并将其放在一个易于查看的表中。

我在 PHP 5.4 共享主机服务器上运行它。

结果非常明确，对于这些从大到小的数据集，序列化和反序列化是明显的赢家。特别是对于我的用例，json_decode 和 unserialize 对缓存系统来说是最重要的。反序列化在这里几乎是无处不在的赢家。它通常是 json_decode 的 2 到 4 倍（有时是 6 或 7 倍）。

注意到@peter-bailey 的结果差异很有趣。

这是用于生成结果的 PHP 代码：

```
<?php

ini_set('display_errors', 1);
error_reporting(E_ALL);

function _count_depth($array)
{
    $count     = 0;
    $max_depth = 0;
    foreach ($array as $a) {
        if (is_array($a)) {
            list($cnt, $depth) = _count_depth($a);
            $count += $cnt;
            $max_depth = max($max_depth, $depth);
        } else {
            $count++;
        }
    }

    return array(
        $count,
        $max_depth + 1,
    );
}

function run_test($file)
{
    $memory     = memory_get_usage();
    $test_array = unserialize(file_get_contents($file));
    $memory     = round((memory_get_usage() - $memory) / 1024, 2);

    if (empty($test_array) || !is_array($test_array)) {
        return;
    }

    list($count, $depth) = _count_depth($test_array);

    //JSON encode test
    $start            = microtime(true);
    $json_encoded     = json_encode($test_array);
    $json_encode_time = microtime(true) - $start;

    //JSON decode test
    $start = microtime(true);
    json_decode($json_encoded);
    $json_decode_time = microtime(true) - $start;

    //serialize test
    $start          = microtime(true);
    $serialized     = serialize($test_array);
    $serialize_time = microtime(true) - $start;

    //unserialize test
    $start = microtime(true);
    unserialize($serialized);
    $unserialize_time = microtime(true) - $start;

    return array(
        'Name'                   => basename($file),
        'json_encode() Time (s)' => $json_encode_time,
        'json_decode() Time (s)' => $json_decode_time,
        'serialize() Time (s)'   => $serialize_time,
        'unserialize() Time (s)' => $unserialize_time,
        'Elements'               => $count,
        'Memory (KB)'            => $memory,
        'Max Depth'              => $depth,
        'json_encode() Win'      => ($json_encode_time > 0 && $json_encode_time < $serialize_time) ? number_format(($serialize_time / $json_encode_time - 1) * 100, 2) : '',
        'serialize() Win'        => ($serialize_time > 0 && $serialize_time < $json_encode_time) ? number_format(($json_encode_time / $serialize_time - 1) * 100, 2) : '',
        'json_decode() Win'      => ($json_decode_time > 0 && $json_decode_time < $serialize_time) ? number_format(($serialize_time / $json_decode_time - 1) * 100, 2) : '',
        'unserialize() Win'      => ($unserialize_time > 0 && $unserialize_time < $json_decode_time) ? number_format(($json_decode_time / $unserialize_time - 1) * 100, 2) : '',
    );
}

$files = glob(dirname(__FILE__) . '/system/cache/*');

$data = array();

foreach ($files as $file) {
    if (is_file($file)) {
        $result = run_test($file);

        if ($result) {
            $data[] = $result;
        }
    }
}

uasort($data, function ($a, $b) {
    return $a['Memory (KB)'] < $b['Memory (KB)'];
});

$fields = array_keys($data[0]);
?>

<table>
    <thead>
    <tr>
        <?php foreach ($fields as $f) { ?>
            <td style="text-align: center; border:1px solid black;padding: 4px 8px;font-weight:bold;font-size:1.1em"><?= $f; ?></td>
        <?php } ?>
    </tr>
    </thead>

    <tbody>
    <?php foreach ($data as $d) { ?>
        <tr>
            <?php foreach ($d as $key => $value) { ?>
                <?php $is_win = strpos($key, 'Win'); ?>
                <?php $color = ($is_win && $value) ? 'color: green;font-weight:bold;' : ''; ?>
                <td style="text-align: center; vertical-align: middle; padding: 3px 6px; border: 1px solid gray; <?= $color; ?>"><?= $value . (($is_win && $value) ? '%' : ''); ?></td>
            <?php } ?>
        </tr>
    <?php } ?>
    </tbody>
</table> 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-04-12T12:40:22.523

仅供参考——如果您想将数据序列化为易于阅读和理解的内容，例如 JSON，但具有更高的压缩率和更高的性能，您应该查看[messagepack。](http://msgpack.org/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-07-28T13:34:13.370

THX - 对于这个基准代码：

我在用于配置的数组上的结果如下所示：JSON 编码为 0.0031511783599854 秒
PHP 序列化 0.0037961006164551 秒
`json_encode()`比`serialize()` JSON 编码 0.0070841312408447 秒快大约 20.47%
PHP 序列化 0.0035839080810547 秒
`unserialize()`大约快 97%。`json_encode()`

所以 - 在您自己的数据上进行测试。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-11-26T10:31:43.467

如果您想备份数据并在另一台机器上或通过 FTP 恢复数据，JSON 会更好。

例如，如果您将数据存储在 Windows 服务器上，通过 FTP 下载并在 Linux 上恢复它，则使用序列化，由于字符重新编码，它无法再工作，因为序列化存储字符串的长度和 Unicode > UTF-8 对一些 1 字节字符进行转码可能会变成 2 字节长，从而导致算法崩溃。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-07-30T19:51:27.600

如果总结人们在这里所说的话，json_decode/encode 似乎比 serialize/unserialize 更快，但是如果你做 var_dump，序列化对象的类型就会改变。如果出于某种原因您想保留类型，请使用序列化！

（尝试例如 stdClass 与数组）

序列化/反序列化：

```
Array cache:
array (size=2)
  'a' => string '1' (length=1)
  'b' => int 2
Object cache:
object(stdClass)[8]
  public 'field1' => int 123
This cache:
object(Controller\Test)[8]
  protected 'view' => 
```

json编码/解码

```
Array cache:
object(stdClass)[7]
  public 'a' => string '1' (length=1)
  public 'b' => int 2
Object cache:
object(stdClass)[8]
  public 'field1' => int 123
This cache:
object(stdClass)[8] 
```

如您所见，json_encode/decode 将所有内容都转换为 stdClass，这不是很好，对象信息丢失了...所以根据需要决定，特别是如果它不仅是数组...

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2018-06-19T08:10:47.677

我建议你使用 Super Cache，这是一种文件缓存机制，不会使用`json_encode`or `serialize`。与其他 PHP 缓存机制相比，它使用简单且速度非常快。

[https://packagist.org/packages/smart-php/super-cache](https://packagist.org/packages/smart-php/super-cache)

前任：

```
<?php
require __DIR__.'/vendor/autoload.php';
use SuperCache\SuperCache as sCache;

//Saving cache value with a key
// sCache::cache('<key>')->set('<value>');
sCache::cache('myKey')->set('Key_value');

//Retrieving cache value with a key
echo sCache::cache('myKey')->get();
?> 
```

# c# - 这段代码会破解吗？

> ID：804056
> 
> 赞同：0
> 
> 时间：2009-04-29T20:14:21.223
> 
> 标签：c#, nullable

业务对象正在返回`short?`数据类型。

我如何将此值放入变量中？

```
short? myShort = SomeBusinessObject.UserBlah; 
```

那是对的吗？如果它为空，它会中断吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T20:18:41.493

这是正确的。您只需担心将 myShort 分配给不可为空的 short，在这种情况下您必须检查 HasValue，如下所示：

```
short s = myShort.HasValue ? myShort.Value : (short) 0; // or some other short value 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T20:18:43.350

要将其放入变量中，请在检查 myShort.HasValue 后使用 myShort.Value

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T20:17:26.473

您是否真的试图防止 SomeBusinessObject 为空？如果是这样，可空类型将无济于事。您仍然需要检查您的 SomeBusinessObject 是否为空。

我假设是这种情况，因为如果 UserBlah 返回一个 short 那么它永远不会为 null （因为 short 不是可为 null 的类型）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T20:22:26.883

不要忘记空合并运算符。

```
short myShort = SomeBusinessObject.UserBlah ?? 0; 
```

如果 SomeBusinessObject.UserBlah 为空，它只是将值传递到 ?? 所以你可以把它默认为某事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T20:16:39.767

对，那是正确的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T20:18:23.773

`myShort`如果`null`业务对象返回`null`.

您不能`myShort`直接引用为值类型，所以这没关系。

您可以使用`myShort.HasValue`来查看是否`myShort`存在`null`。

用于`myShort.Value`获取值。如果没有定义值，它将抛出异常。

`GetValueOrDefault()`即使没有定义 ( `null`) ，您也可以使用并传入默认值来获取值。如果可空类型为 ，则此函数返回您传入的值`null`。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T20:18:33.117

myShort 只有在`UserBlah`隐式转换为`Nullable<Int16>`null 并且设置为 null 时才会为 null，在这种情况下，除非您尝试访问`myShort.Value`.

你也可以这样做：

```
short defaultValue = 0;
short myShort      = SomeBusinessObject.UserBlah ?? defaultValue; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T20:19:40.587

[可空类型（C# 编程指南）](http://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx)

[使用可空类型（C# 编程指南）](http://msdn.microsoft.com/en-us/library/2cf62fcy.aspx)

# sql - 当 DB2 存储过程满足 ASUTIME LIMIT 时，该过程将 ROLLBACK 还是 COMMIT？

> ID：804067
> 
> 赞同：0
> 
> 时间：2009-04-29T20:17:13.497
> 
> 标签：sql, stored-procedures, db2, limit, commit

在网上找不到任何答案，有人试过吗？我的存储过程处理在多个表中发现的令牌的删除，并通过使用 ASUTIME LIMIT*整数*存储过程定义/特征设置为针对指定数量的“cpu 服务单元”运行。当满足这个限制时，存储过程会提交或回滚为当前令牌执行的语句吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T14:51:39.233

谢谢..无论如何，我的一个同事说：

“使用 ASUTIME，我们控制了存储过程在其生命周期中将使用的 CPU 单元数。如果存储过程使用的服务单元数超过允许的数量，则存储过程将取消。这意味着只要应用程序停留在在其范围内，SP 将继续。

在存储过程运行时，可能会启动另一个应用程序（如报表运行）。无法保证 SP 将在此时或之后的任何时间停止，因为只要两个应用程序都在其允许的范围内，SP 就不会终止。这可能不是预期的行为 - 大多数这种性质的 SP 在休息日（即星期日）运行，这样它们就不会在常规日干扰或与更高优先级的工作竞争。简而言之，它们旨在结束，而不是与其他工作共同运行。

ASUTIME 是为失控的存储过程而设计的，而不是作为对过程中循环的严格控制。WLM 优先级和服务目标应该用于此，而不是 ASUTIME。

使用 ASUTIME 可能不会节省大量成本，因为存储过程还必须检查系统资源和 RLST 表。”

发布，因为它可能对其他人有帮助。

# java - Java 集合中的 Queue 类在哪里？

> ID：804078
> 
> 赞同：26
> 
> 时间：2009-04-29T20:19:30.090
> 
> 标签：java, data-structures, queue

我只看到一个 Queue 接口，Java Collections 中没有 Queue 类吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-29T20:20:45.530

[Javadocs](http://java.sun.com/javase/6/docs/api/java/util/Queue.html)给出了实现`Queue`.

> **所有已知的实现类：**
> 
> [AbstractQueue](http://java.sun.com/javase/6/docs/api/java/util/AbstractQueue.html "java.util 中的类") , [ArrayBlockingQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ArrayBlockingQueue.html "java.util.concurrent 中的类") , [ArrayDeque](http://java.sun.com/javase/6/docs/api/java/util/ArrayDeque.html "java.util 中的类") , [ConcurrentLinkedQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html "java.util.concurrent 中的类") , [DelayQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/DelayQueue.html "java.util.concurrent 中的类") , [LinkedBlockingQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/LinkedBlockingDeque.html "java.util.concurrent 中的类") , [LinkedBlockingDeque](http://java.sun.com/javase/6/docs/api/java/util/concurrent/LinkedBlockingQueue.html "java.util.concurrent 中的类") , [LinkedList](http://java.sun.com/javase/6/docs/api/java/util/LinkedList.html "java.util 中的类") , [PriorityBlockingQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/PriorityBlockingQueue.html "java.util.concurrent 中的类") , [PriorityQueue](http://java.sun.com/javase/6/docs/api/java/util/PriorityQueue.html "java.util 中的类") , [SynchronousQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/SynchronousQueue.html "java.util.concurrent 中的类")

还有一些您可能会觉得有用的子接口：

> **所有已知的子接口：**
> 
> [BlockingDeque](http://java.sun.com/javase/6/docs/api/java/util/concurrent/BlockingDeque.html "java.util.concurrent 中的接口") <E>、[BlockingQueue](http://java.sun.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html "java.util.concurrent 中的接口") <E>、[双端队列](http://java.sun.com/javase/6/docs/api/java/util/Deque.html "java.util 中的接口")<E>

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-29T20:21:35.777

队列有多种实现：来自 API：

**所有已知的实现类：**

```
AbstractQueue, ArrayBlockingQueue, ArrayDeque, ConcurrentLinkedQueue, 
DelayQueue, LinkedBlockingDeque, LinkedBlockingQueue, LinkedList, 
PriorityBlockingQueue, PriorityQueue, SynchronousQueue 
```

请注意， AbstractQueue 不是一个具体的类。

其中一些来自concurrent包，所以如果你正在实现一个jobqueue或类似的东西，你应该选择ConcurrentLinkedQueue或PriorityBlockingQueue（用于堆）ex。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-29T20:20:35.703

文档[`Queue`](http://java.sun.com/javase/6/docs/api/java/util/Queue.html)列出了各种实现，包括

*   [`ArrayDeque`](http://java.sun.com/javase/6/docs/api/java/util/ArrayDeque.html)
*   [`LinkedList`](http://java.sun.com/javase/6/docs/api/java/util/LinkedList.html)
*   [`PriorityQueue`](http://java.sun.com/javase/6/docs/api/java/util/PriorityQueue.html)

选择适合您需求的实现。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-01-15T22:35:53.303

```
 Queue<Integer> queue = new ArrayDeque<>();

    queue.add(1);
    queue.add(2);
    queue.add(3);

    while (!queue.isEmpty()) {
        System.out.println(queue.remove());// prints 1 2 3
    } 
```

您也可以使用 LinkedList。但通常，对于队列，ArrayDeque 优于 LinkedList。因为 ArrayDeque 消耗更少的内存，速度更快并且不允许空值。不允许 null 是好的，因为如果您确实允许 null，那么当您执行 peek() 或 poll() 时，即使队列不为空，您也可以获得 null。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-29T20:51:54.440

除了使用 API 文档查找“所有已知的实现类”外，通常还有其他非公共实现仍然可以通过公共 API 获得（仅不需要大量无意义的文档）。如果您单击“[使用](http://file:///C:/Users/tackline/sun/docs/api/java/util/class-use/Queue.html)”，您还会发现[Collections.asLifoQueue](http://file:///C:/Users/tackline/sun/docs/api/java/util/Collections.html#asLifoQueue(java.util.Deque))（`Deque`已经是 a `Queue`，但它是 FIFO 而不是堆栈）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-12-12T17:47:02.477

不，没有`Queue`类，因为实现队列的方法有很多种，您必须选择适合您用例的方法。集合框架中的任何其他集合也是如此 - 例如，`ArrayList`它们`LinkedList`都实现了`List`. 很好地使用对象继承的一般模式是：

例如，**接口**`Queue`定义了您希望对象扮演的角色；

**子接口**，例如`Deque`，进一步扩展或专门化角色 - 在这种情况下，“双端队列”或双端队列允许您从队列的两端添加和删除元素，而不是仅添加到后面和删除从前面;

**类**提供对象如何执行角色的实现。例如，一个`ArrayDeque`使用可调整大小的数组来实现一个双端队列，`LinkedList`它使用链表具有不同的优点和缺点。

要详细说明接口作为角色的概念，请注意，即使`ArrayDeque`implements `Deque`，您也可以将其用作 a`Queue`而不必担心，因为实现两个接口意味着它可以同时扮演两个角色。同样，`LinkedList`可以戴`List`，`Queue`或`Deque`帽子。

出于这个原因，使用 Collections 框架之类的东西的正常（推荐）方式是对*接口进行编程*，即在使用类时使用接口而不是类名本身。例如，您将像这样实例化一个对象：

```
Queue<String> logQueue = new ConcurrentLinkedQueue<String>();
...
logQueue.add("Log message"); 
```

这样你是

*   不绑定到特定类，如果需要，可以使用直接替换，而无需修改太多代码，并且
*   通过命名它所扮演的角色来记录你对一个类所做的事情。这有帮助的一般原则是*自记录代码*，本质上是让代码本身是不言自明的，而不必使用注释等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-29T20:21:51.660

[http://java.sun.com/javase/6/docs/api/java/util/Queue.html](http://java.sun.com/javase/6/docs/api/java/util/Queue.html) - 请参阅“所有已知的实现类”部分。有多种实现方式适用于不同的目的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-29T21:12:18.637

虽然答案听起来有点轻蔑，但他们实际上很酷，教你如何钓鱼。队列只是查看集合的一种方式，因此许多集合都可能实现它。同样，行为类似于集合但具有特定其他逻辑（如线程队列）的事物可能使用相同的接口。

知道在哪里查看 javadocs 是一个很大的帮助。我确定您看过但只是没想到要查看实现。活到老，学到老。

有时您可能还必须查找子类/扩展列表。就像您查看 Queue 并看到 AbstractQueue 一样，您可能想看看哪些类实现了它。

我会为你摆脱你的一个 -1 :)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-22T19:10:41.330

```
import java.util.Queue; 
```

只是

```
Enqueue function == Queue_Object.add(input_value);

Dequeue function == Queue_Object.pull();   //return the value and delete it from queue 
```

# javascript - 消除 jQuery 脚本中的冗余代码

> ID：804087
> 
> 赞同：3
> 
> 时间：2009-04-29T20:20:53.847
> 
> 标签：javascript, jquery, css, ajax

我已经设置了一个页面来通过 AJAX 加载数据，利用 jQuery`.load`函数。

通过单击选项卡栏上的链接加载每个新文件后，我使用 jQuery 将所选选项卡的颜色设置为黄色。我尝试使用一个`.toggleClass`函数将元素的类设置`li`为活动的，这样它就会是黄色的，但没有骰子，所以我每次都求助于重置 CSS。

如何消除冗余代码，或大修脚本？

无论如何，这里是 jQuery 脚本。欢迎任何帮助！

```
$(document).ready(function () {
    $('a#catalog').click(function() {
        $("#nav ul li a").css("color","white");
        $(this).css("color","yellow");
        $("#content").load("files/catalog.html");   
    });
    $('a#request').click(function() {
        $("#nav ul li a").css("color","white");
        $(this).css("color","yellow");      
        $("#content").load("files/request.html");
    });
    $('a#publisher').click(function() {
        $("#nav ul li a").css("color","white");
        $(this).css("color","yellow");
        $("#content").load("files/publisher.html");
      });
    $('a#incoming').click(function() {
        $("#nav ul li a").css("color","white");
        $(this).css("color","yellow");
        $("#content").load("files/incoming.html");
    });
    $('a#finished').click(function() {
        $("#nav ul li a").css("color","white");
        $(this).css("color","yellow");
        $("#content").load("files/finished.html");
    });
    $('a#shipments').click(function() {
        $("#nav ul li a").css("color","white");
        $(this).css("color","yellow");
        $("#content").load("files/shipments.html");
    });
}); 
```

和导航栏：

```
<div class="bar" id="nav">
            <ul class="left">
                <li><a href="#" id="request">Request Search</a></li>
                <li><a href="#" id="catalog">Catalog Search</a></li>        
                <li><a href="#" id="publisher">Request from Publisher</a></li>
                <li><a href="#" id="incoming">Catalog Incoming Files</a></li>
                <li><a href="#" id="finished">Send Finished Files</a></li>      
                <li><a href="#" id="shipments">Shipments</a></li>
            </ul>
        </div> 
```

最后但并非最不重要的一点是 CSS：

```
.bar { margin: 5px 0; position: relative; height: 20px; background-color: #515e6c; }
.bar a { color: #fff; }
.bar ul li a:hover { color: yellow; }
/* .bar ul li.active { color: yellow; } */
ul { margin: .3em 0; }
ul li { display: inline; padding: 0 5px; border-right: 1px solid #fff; }
ul li:last-child { border-right: none; } 
```

提前致谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-29T20:22:52.093

这应该这样做：

```
$(document).ready(function () {
    var $links = $('#nav ul li a');
    $links.click(function() {
        $links.css("color","white");
        $(this).css("color","yellow");
        $("#content").load("files/" + $(this).attr('id') + ".html");       
    });
}); 
```

就您选择的规则而言，将其更改为：

```
.bar ul li a.active { color: yellow; } 
```

然后你可以把 c​​lick 函数的前两行改成这样：

```
$links.removeClass('active');
$(this).addClass('active'); 
```

The style was originally being applied to the `<li>` itself instead of the `<a>`.

# c# - .Net 线程安全中的静态字典

> ID：804092
> 
> 赞同：2
> 
> 时间：2009-04-29T20:21:54.467
> 
> 标签：c#, dictionary, thread-safety

阅读字典的[msdn 文档](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)时说：“这种类型的公共静态（在 Visual Basic 中共享）成员是线程安全的。不保证任何实例成员都是线程安全的。”

这意味着使用这样的字典：

```
 static object syncObject = new object();
static Dictionary<string,MyObject> mydictionary= new Dictionary<string, MyObject>(); 
```

不需要做类似下面的代码的事情吗？

```
 lock (syncObject)
{
   context = new TDataContext();
   mydictionary.Add("key", myObject);
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T20:23:00.923

它指的是类本身的静态方法。该语句实际上是添加到大多数类的样板文档。Dictionary<> 类实际上并不公开任何静态方法。

您必须自己使用 lock 关键字甚至 ReaderWriterLock 序列化对字典类的访问。线程虽然是一个非常复杂的主题，并且 lock 关键字并不总是合适的。Joe Duffy 有一本很棒的书“ [Windows 上的并发编程](https://rads.stackoverflow.com/amzn/click/com/032143482X)”，它深入探讨了保护共享应用程序资源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T20:26:20.540

您将“这种类型的公共静态**成员**”误解为“这种类型的公共静态**实例**”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T20:25:56.720

这意味着如果您调用 Add 方法（一个实例方法），您最好通过使用自己的锁定或序列化语义来确保您拥有对 Dictionary 的独占访问权限。如果两个线程同时修改 Dictionary 的状态，则可能会发生不好的事情，您有责任确保不会发生这种情况。Dictionary 的 Add 方法中没有任何内容可以为您执行此锁定操作。

但是，如果您在 Dictionary 上调用一些静态方法（其中没有任何有用的方法），那么没有锁就可以了。

这是 BCL 中所有 .NET 类型的一般规则。

# java - 用Java实现用户管理对话框

> ID：804109
> 
> 赞同：0
> 
> 时间：2009-04-29T20:24:46.643
> 
> 标签：java, user-interface

我的应用程序需要一个窗口，允许用户：

*   查看当前现有用户
*   创建新用户
*   更改权限
*   删除用户
*   查看用户详细信息

在试图找到一种创造良好用户体验的完美方法时，我偶然发现了各种不同的方法：基于对话框、基于树等......

我决定这样做：

```
--------------------
|list   | setting1 |
|of     | setting2 |
|users  | setting3 |
|       |          |
-------------------- 
```

左侧有一个列表框，用户可以在其中选择一个人，该人的信息显示在右侧（他也可以对其进行更改）。但是，我所有的测试人员都给了我负面的反馈——他们想要更简单的东西。

有人知道更好地解决这个问题的程序吗？（最好在 Java 中）任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T20:27:25.297

考虑有一个在表格中列出用户的主窗口，可能提供额外的上下文信息，例如他们的全名、角色等，并带有用于添加用户、编辑选定用户的属性或删除选定用户的按钮。

用户属性将出现在一个单独的对话框中，允许在适用的情况下对其进行编辑。

我在[http://img91.imageshack.us/img91/91/usermanagermockup.png](http://img91.imageshack.us/img91/91/usermanagermockup.png)放了一个快速模型。

# sql - PLSQL 按问题排序

> ID：804110
> 
> 赞同：0
> 
> 时间：2009-04-29T20:24:57.563
> 
> 标签：sql, plsql

### 回滚到第一个修订版，然后进行了一些编辑。请参阅修订后的[问题](https://stackoverflow.com/questions/805568/sql-order-by-issue-continued-please-help)。

我对下面的 SELECT 有一个有趣的问题。

它关于 ORDER BY 子句；我正在尝试使用名为“p_sortby”的变量进行排序。

排序依据可以按列名或列位置（1、2、...等）使用。
不知何故，如果我在 PL/SQL 中使用位置，它就不起作用。所以我必须使用列名，我们不能简单地在那里传递一个 varchar2 字符串，我们需要使用真实的列名。我注意到它只适用于 varchar2 类型的列。它不适用于例如数字列。

大家能不能就这种问题告诉我如何解决。

```
/*I am sorry as I cannot paste the format correct here*/. 
```

请大家编辑 SELECT 并输入所需的格式。

```
select distinct gl.group_id, gl.group_name
     from test_group gl
    where gl.group_org_id = p_orgid
      and (   gl.group_name_key like '%' || p_name || '%' 
              or p_name is null
              or p_name = ''
          )
      and (   gl.group_description_key like '%' || p_description || '%' 
              or p_description is null
              or p_description = ''
          )
      and (   gl.status_code = p_statuscode
              or p_statuscode is null
              or p_statuscode = 99
          )
      and gl.group_id in (
                  select gm.group_id
                      from test_group_member gm join test_org_person op
                                on gm.person_id = op.o_person_id
                           join test_person pp
                                on op.o_person_id = pp.person_id
                      where (   upper(pp.firstname) like
                                 '%' || upper(p_adminfirstname) || '%'
                                or p_adminfirstname is null
                                or p_adminfirstname = ''
                            )
                        and (   upper(pp.lastname) like
                                '%' || upper(p_adminlastname) || '%'
                                or p_adminlastname is null
                                or p_adminlastname = ''
                            )
                        and (   upper(op.emplid) like
                                '%' || upper(p_adminemployeeid) || '%'
                                or p_adminemployeeid is null
                                or p_adminemployeeid = ''
                            )
                        and gm.isadmin = 1)
     and gl.group_id in (
              select gm.group_id
                  from test_group_member gm join test_org_person op
                           on gm.person_id = op.o_person_id
                       join test_person pp
                           on op.o_person_id = pp.person_id
                  where (   upper(pp.firstname) like
                            '%' || upper(p_memberfirstname) || '%'
                            or p_memberfirstname is null
                            or p_memberfirstname = ''
                        )
                    and (   upper(pp.lastname) like
                            '%' || upper(p_memberlastname) || '%'
                            or p_memberlastname is null
                            or p_memberlastname = ''
                        )
                    and (   upper(op.emplid) like
                            '%' || upper(p_memberemployeeid) || '%'
                            or p_memberemployeeid is null
                            or p_memberemployeeid = ''
                        )
                    and gm.isadmin = 0) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T20:43:54.400

尝试使用 DECODE() 函数将 ORDER BY 子句选择为单独的列：

```
SELECT DECODE(p_sortby, 'ID', gl.group_id, 'NAME', group_name) AS sort, ...
...
ORDER BY 1 
```

编辑：

我不确定您所说的“不起作用”是什么意思。如果您的意思是 member_count 未按预期排序，请使用 TO_CHAR(gl.member_count, '000000') 强制格式化字符串转换。（将格式掩码调整为预期的位数）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:50:13.180

似乎动态 SQL 是您想要的。

当您执行以下操作时：

... and (gl.group_name_key like '%' || p_name || '%' or p_name is null or p_name = '')

优化器不能在 group_name_key 列上使用索引。你确定要这样做吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T20:46:19.727

如果您想这样做，您将不得不使用 PL/SQL 执行动态 SQL。

```
DECLARE
  sql_str VARCHAR2(500);
  sortby  VARCHAR2(30) := 'your_column_name';
BEGIN
 -- Dynamic PL/SQL block invokes subprogram:
  sql_str := 'select * from your_table where a = 1 order by :a';

  OPEN CURSOR v_your_cursor for sql_str USING sortby;

  -- Then iterate your cursor.
END;
/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T20:47:55.357

非常感谢您的投入。我必须使用带有变量 p_sortby 的 ORDER BY 进行排序，其中 p_sortby 可以采用任何 column_name 或列位置。

# git - 你什么时候使用 Git rebase 而不是 Git merge？

> ID：804115
> 
> 赞同：1948
> 
> 时间：2009-04-29T20:26:35.767
> 
> 标签：git, version-control, git-merge, git-rebase

什么时候推荐使用 Git rebase vs. Git merge？

成功变基后我还需要合并吗？

* * *

## 回答 #1

> 赞同：1353
> 
> 时间：2009-04-29T20:38:30.417

## 精简版

*   合并将一个分支中的所有更改合并到一个提交中的另一个分支中。
*   Rebase 说我希望我分支的点移动到一个新的起点

那么你什么时候使用其中之一呢？

### 合并

*   假设您创建了一个分支来开发单个功能。当您想将这些更改带回主控时，您可能需要**合并**（您不关心维护所有临时提交）。

### 变基

*   第二种情况是，如果您开始进行一些开发，然后另一个开发人员进行了不相关的更改。您可能想要拉取然后**rebase**以基于存储库中当前版本的更改。

* * *

## 回答 #2

> 赞同：494
> 
> 时间：2012-02-05T06:28:44.827

这很简单。使用 rebase，您可以说使用另一个分支作为您工作的新**基础**。

例如，如果你有一个分支`master`，你创建一个分支来实现一个新特性，并说你命名它`cool-feature`，当然，主分支是你的新特性的基础。

现在，在某个时刻，您想要添加您在`master`分支中实现的新功能。您可以切换到`master`并合并`cool-feature`分支：

```
$ git checkout master
$ git merge cool-feature 
```

但是这样添加了一个新的虚拟提交。如果你想避免意大利面条历史，你可以**rebase**：

```
$ git checkout cool-feature
$ git rebase master 
```

然后将其合并到`master`：

```
$ git checkout master
$ git merge cool-feature 
```

这一次，由于主题分支具有相同的 master 提交以及具有新功能的提交，因此合并将只是一个快进。

* * *

## 回答 #3

> 赞同：361
> 
> 时间：2016-04-13T02:16:03.773

# TL;博士

如果您有任何疑问，请使用合并。

## 简答

变基和合并之间的唯一区别是：

*   生成的历史树结构（通常仅在查看提交图时才明显）是不同的（一个会有分支，另一个没有）。
*   合并通常会创建一个额外的提交（例如树中的节点）。
*   合并和变基将以不同的方式处理冲突。Rebase 会一次提交一个冲突，而 merge 会同时显示所有冲突。

所以简短的回答是*根据你希望你的历史看起来像什么来选择变基或合并*。

## 长答案

在选择要使用的操作时，您应该考虑几个因素。

### 您获得更改的分支是否与团队外部的其他开发人员共享（例如开源、公共）？

如果是这样，请不要变基。Rebase 会破坏分支，除非他们使用`git pull --rebase`. 这是快速让其他开发人员感到不安的好方法。

### 你的开发团队有多熟练？

Rebase 是一种破坏性操作。这意味着，如果您没有正确应用它，**您可能会丢失已提交的工作和/或破坏其他开发人员存储库的一致性。**

我曾在开发人员都来自公司能够负担得起专门人员来处理分支和合并的时代工作过。那些开发人员对 Git 了解不多，也不想知道太多。在这些团队中，我不会冒险以任何理由推荐 rebase。

### 分支本身是否代表有用的信息

一些团队使用每个功能分支模型，其中每个分支代表一个功能（或错误修复或子功能等）。在此模型中，分支有助于识别相关提交集。例如，可以通过恢复该分支的合并来快速恢复功能（公平地说，这是一种罕见的操作）。或者通过比较两个分支来区分一个特征（更常见）。变基会破坏分支，这并不简单。

我还曾在使用每个开发人员分支模型的团队工作过（我们都去过那里）。在这种情况下，分支本身不会传达任何其他信息（提交已经有作者）。重新定位不会有任何害处。

### 您可能出于任何原因想要恢复合并吗？

与还原合并相比，还原（如撤消）变基相当困难和/或不可能（如果变基有冲突）。如果您认为有可能想要还原，请使用合并。

### 你在团队中工作吗？如果是这样，你愿意在这个分支上采取全有或全无的方法吗？

Rebase 操作需要使用相应的`git pull --rebase`. 如果您自己工作，您可能会记住在适当的时候应该使用哪个。如果你在一个团队中工作，这将很难协调。这就是为什么大多数 rebase 工作流程建议对所有合并（以及`git pull --rebase`所有拉取）使用 rebase。

## 常见的神话

### 合并破坏历史（压缩提交）

假设您有以下合并：

```
 B -- C
   /      \
  A--------D 
```

有些人会说合并“破坏”了提交历史，因为如果你只查看主分支（A-D）的日志，你会错过 B 和 C 中包含的重要提交消息。

如果这是真的，我们就不会有这样的[问题了](https://stackoverflow.com/questions/15875253/git-log-to-return-only-the-commits-made-to-the-master-branch)。基本上，您会看到 B 和 C，除非您明确要求不要看到它们（使用 --first-parent）。这很容易自己尝试。

### Rebase 允许更安全/更简单的合并

这两种方法以不同的方式合并，但尚不清楚一种总是比另一种更好，它可能取决于开发人员的工作流程。例如，如果开发人员倾向于定期提交（例如，他们可能每天提交两次，因为他们从工作过渡到家），那么给定分支可能会有很多提交。其中许多提交可能看起来不像最终产品（我倾向于对每个功能重构我的方法一次或两次）。如果其他人正在处理相关的代码区域并且他们试图重新调整我的更改，这可能是一个相当乏味的操作。

### Rebase 更酷/更性感/更专业

如果您喜欢别名`rm`为`rm -rf`“节省时间”，那么 rebase 可能适合您。

# 我的两分钱

我一直认为总有一天我会遇到这样一个场景，即 Git rebase 是解决问题的绝佳工具。就像我想我会遇到这样一个场景，Git reflog 是一个很棒的工具，可以解决我的问题。我已经使用 Git 工作了五年多了。它没有发生。

凌乱的历史对我来说从来都不是问题。我从来不会像阅读一本激动人心的小说一样阅读我的提交历史。大多数时候我需要一个历史记录，无论如何我都会使用 Git blame 或 Git bisect。在这种情况下，合并提交实际上对我有用，因为如果合并引入了问题，那对我来说是有意义的信息。

# 更新 (4/2017)

我觉得有义务提到我个人对使用 rebase 的态度有所缓和，尽管我的一般建议仍然有效。我最近与[Angular 2 Material](https://github.com/angular/material2)项目进行了很多互动。他们使用 rebase 来保持非常干净的提交历史。这让我可以很容易地看到哪些提交修复了给定的缺陷，以及该提交是否包含在发布中。它是正确使用 rebase 的一个很好的例子。

* * *

## 回答 #4

> 赞同：285
> 
> 时间：2009-04-29T20:44:52.460

为了补充[TSamper](https://stackoverflow.com/questions/804115/git-rebase-vs-git-merge/804119#804119)提到的[我自己的答案](https://stackoverflow.com/questions/457927/git-workflow-and-rebase-vs-merge-questions)，

*   在合并之前做一个 rebase 通常是一个好主意，因为这个想法是你在你的分支中集成你将要合并的分支`Y`的工作。 但同样，在合并之前，您解决分支中的任何冲突*（*即：“rebase”，如“从分支的最近点开始在我的分支中重播我的工作）。 如果正确完成，则从分支的后续合并到分支可以快进。`B`
    *`B`
    `B`*

**   合并直接影响目标分支`B`，这意味着合并最好是微不足道的，否则该分支`B`可能很长时间才能恢复到稳定状态（解决所有冲突的时间）* 

 ** * *

> 变基后的合并点？

在我描述的情况下，我重新定位`B`到我的分支，只是为了有机会从最近的时间点重播我的工作`B`，但同时留在我的分支中。
在这种情况下，仍然需要合并才能将我的“重播”作品带到`B`.

另一种情况（例如[在 Git Ready](http://www.gitready.com/intermediate/2009/01/31/intro-to-rebase.html)中描述的）是`B`通过变基直接将您的工作带入（这确实保留了所有不错的提交，甚至让您有机会通过交互式变基重新排序它们）。
在那种情况下（你在 B 分支中变基），你是对的：不需要进一步的合并：

**当我们没有合并也没有重新定位时，默认的 Git 树**

![变基1](https://i.stack.imgur.com/7vsGZ.png)

**我们通过变基得到：**

![变基3](https://i.stack.imgur.com/yCxOO.png)

第二种情况是关于：我如何让新功能回到主控。

我的意思是，通过描述第一个 rebase 场景，是为了提醒大家，rebase 也可以用作一个初步步骤（即“将新功能恢复为 master”）。
您可以使用 rebase 首先将 master “引入”新功能分支：rebase 将重播来自 的新功能提交`HEAD master`，但仍在新功能分支中，从而有效地将您的分支起点从旧的 master 提交移动到`HEAD-master`.
这使您可以解决分支中的任何冲突*（*这意味着，如果您的冲突解决阶段花费的时间太长，则允许 master 继续并行发展）。然后你可以切换到
master 并合并`new-feature`（或者如果你想保留在你的`new-feature``master``new-feature`分支）。

所以：

*   “rebase vs. merge”可以看作是导入作品的两种方式，比如`master`.
*   但是“rebase then merge”可能是一个有效的工作流程，首先单独解决冲突，然后恢复你的工作。

* * *

## 回答 #5

> 赞同：215
> 
> 时间：2014-02-03T22:17:39.537

这里的很多答案都说合并会将您的所有提交合二为一，因此建议使用 rebase 来保留您的提交。**这是不正确的。如果你已经推送了你的提交，那是个坏主意**。

合并不会*消除*您的提交。合并保留历史！（只看 gitk） Rebase 重写历史，在你*推送*它之后这是一件坏事。

**使用合并——**当你已经推送时不要变基。

[这是 Linus （Git 的作者）对它的看法](http://blog.nerdbank.net/2020/01/should-i-merge-or-rebase-in-git.html)（现在托管在我自己的博客上，[由 Wayback Machine 恢复](https://web.archive.org/web/20190110131909/http://thread.gmane.org/gmane.comp.video.dri.devel/34739/focus=34744)）。这真是一本好书。

或者你可以在下面阅读我自己版本的相同想法。

在 master 上重新建立一个分支：

*   提供了关于如何创建提交的错误想法
*   一堆可能没有经过良好测试的中间提交污染了 master
*   实际上可能会在这些中间提交上引入构建中断，因为在创建原始主题分支和重新建立基础分支之间对 master 进行了更改。
*   使得在 master 中找到好地方结帐变得困难。
*   导致提交的时间戳与其在树中的时间顺序不一致。所以你会看到提交 A 在 master 中的提交 B 之前，但提交 B 是首先编写的。（什么？！）
*   产生更多的冲突，因为主题分支中的每个提交都可能涉及必须单独解决的合并冲突（在历史中进一步说明每个提交中发生了什么）。
*   是历史的改写。如果要重新设置的分支已被推送到任何地方（与您以外的任何人共享），那么自从您改写历史以来，您已经搞砸了拥有该分支的所有其他人。

相反，将主题分支合并到主分支：

*   保留创建主题分支的历史记录，包括从主分支到主题分支的任何合并，以帮助使其保持最新。您确实可以准确了解开发人员在构建时使用的代码。
*   master 是一个主要由合并组成的分支，这些合并提交中的每一个通常都是历史上可以安全检查的“好点”，因为那是主题分支准备好集成的地方。
*   主题分支的所有单独提交都被保留，包括它们在主题分支中的事实，因此隔离这些更改是很自然的，您可以在需要的地方进行钻取。
*   合并冲突只需解决一次（在合并时），因此在主题分支中进行的中间提交更改不必独立解决。
*   可以顺利完成多次。如果您定期将您的主题分支集成到主控，人们可以继续在主题分支上构建，并且可以保持独立合并。

* * *

## 回答 #6

> 赞同：156
> 
> 时间：2020-10-12T14:20:50.020

我刚刚用我自己的话为我的团队创建了一个常见问题解答，它回答了这个问题。让我分享：

## 什么是`merge`?

提交，将不同分支的所有更改组合到当前。

## 什么是`rebase`?

将当前分支的所有提交重新提交到不同的基本提交。

## `merge`和之间的主要区别是`rebase`什么？

1.  `merge`只执行**一个**新的提交。`rebase`通常执行**多个**（当前分支中的提交数）。
2.  `merge`产生一个**新**的生成提交（所谓的合并提交）。`rebase`只移动**现有的**提交。

## 在什么情况下我们应该使用 a `merge`？

`merge`每当您想将分支分支的更改添加**回**基本分支时使用。

通常，您可以通过单击 Pull/Merge Requests 上的“Merge”按钮来执行此操作，例如在 GitHub 上。

## 在什么情况下我们应该使用 a `rebase`？

`rebase`每当您要将**基本分支的更改**添加回分支分支时使用。

通常，`feature`只要分支发生变化，您就会在分支中执行此操作`main`。

## 为什么不使用`merge`将基础分支中的更改合并到功能分支中呢？

1.  git 历史将包括许多**不必要的合并提交**。如果在一个特性分支中需要多次合并，那么特性分支甚至可能比实际提交包含更多的合并提交！

2.  这会创建一个循环，**破坏 Git 设计的心智模型，**这会导致 Git 历史的任何可视化出现问题。

    想象有一条河（例如“尼罗河”）。水流向一个方向（Git 历史中的时间方向）。时不时地，想象那条河有一个分支，并假设这些分支中的大多数会汇回河流中。这就是河流的自然流动。这说得通。

    但是再想象一下那条河的一个小支流。然后，由于某种原因，**河流汇入分支**，分支从那里继续。从技术上讲，这条河现在已经消失了，它现在在分支中。但随后，不知何故神奇地，那根树枝又汇回了河里。你问哪条河？我不知道。河流现在实际上应该在分支中，但不知何故它仍然存在，我可以将分支合并回河流中。所以，河在河中。有点没有意义。

    这正是当您`merge`将基本分支合并到一个`feature`分支时发生的情况，然后当`feature`分支完成后，您再次将其合并回基本分支。心智模式被打破。正因为如此，您最终会得到一个不是很有帮助的分支可视化。

## 使用时的示例 Git 历史记录`merge`：

[![使用合并时的示例 Git 历史记录](https://i.stack.imgur.com/Oqqmm.png)](https://i.stack.imgur.com/Oqqmm.png)

请注意以 . 开头的许多提交`Merge branch 'main' into ...`。如果您变基，它们甚至都不存在（在那里，您只会有拉取请求合并提交）。还有许多视觉分支合并循环（`main`into `feature`into `main`）。

## 使用时的示例 Git 历史记录`rebase`：

[![使用变基时的示例 Git 历史记录](https://i.stack.imgur.com/0ZVla.png)](https://i.stack.imgur.com/0ZVla.png)

更清晰的 Git 历史记录，更少的合并提交，也没有杂乱的视觉分支合并循环。

## 有什么缺点/陷阱`rebase`吗？

是的：

1.  因为一个`rebase`移动提交（技术上重新执行它们），所有移动提交的提交日期将是变基的时间，并且**git 历史失去了初始提交时间**。因此，如果出于某种原因需要提交的确切日期，那么`merge`是更好的选择。但通常情况下，干净的 git 历史记录比准确的提交日期有用得多。
2.  如果重新建立的分支有多个提交更改了同一行，并且该行在基础分支中也发生了更改，则您可能需要多次解决同一行的合并冲突，而在合并时您永远不需要这样做。因此，平均而言，有更多的合并冲突需要解决。

## 使用时减少合并冲突的提示`rebase`：

1.  **经常变基**。我通常建议每天至少做一次。
2.  尽量将同一行上的**更改压缩到一个提交中。**

* * *

## 回答 #7

> 赞同：87
> 
> 时间：2012-02-05T06:47:08.570

TLDR：**这取决于什么是最重要的——整洁的历史或发展顺序的真实表现**

如果整洁的历史记录是最重要的，那么您将首先变基，然后合并您的更改，这样新代码到底是什么就很清楚了。**如果你已经推送了你的分支，除非你能处理后果，否则不要变基。**

如果序列的真实表示是最重要的，那么您将在没有变基的情况下合并。

合并意味着：创建一个新的提交，将我的更改合并到目标中。**注意：**这个新提交将有两个父提交 - 您的提交字符串中的最新提交和您正在合并的另一个分支的最新提交。

Rebase 意味着：使用我当前的一组提交作为提示，创建一个全新的提交系列。换句话说，计算如果我从我要重新定位的点开始进行更改，我的更改会是什么样子。因此，在 rebase 之后，您可能需要重新测试您的更改，并且在 rebase 期间，您可能会遇到一些冲突。

鉴于此，你为什么要变基？只是为了保持发展历史清晰。假设您正在处理功能 X，当您完成后，您将更改合并到其中。目标现在将有一个提交，它会说出类似于“添加的功能 X”的内容。现在，如果您重新定位然后合并，而不是合并，目标开发历史将包含单个逻辑进程中的所有单个提交。这使得以后审查更改变得更加容易。想象一下，如果 50 位开发人员一直在合并各种功能，您会发现回顾开发历史是多么困难。

也就是说，如果你已经将你正在处理的分支推送到上游，你不应该变基，而是合并。对于尚未推送到上游的分支，进行 rebase、test 和 merge。

另一个你可能想要变基的时候是当你想在向上游推送之前从你的分支中删除提交。例如：在早期引入一些调试代码的提交和在清理该代码时进一步的其他提交。唯一的方法是执行交互式变基：`git rebase -i <branch/commit/tag>`

更新：当您使用 Git 连接到不支持非线性历史的版本控制系统（例如[Subversion](http://en.wikipedia.org/wiki/Apache_Subversion) ）时，您还想使用 rebase 。使用 git-svn 桥时，合并回 Subversion 的更改是主干中最新更改之上的更改顺序列表，这一点非常重要。只有两种方法可以做到这一点：（1）手动重新创建更改和（2）使用 rebase 命令，这要快得多。

更新 2：考虑变基的另一种方法是，它可以实现从您的开发风格到您正在提交的存储库中接受的风格的一种映射。假设你喜欢以小块的方式提交。你有一个提交来修复一个错字，一个提交来摆脱未使用的代码等等。当你完成你需要做的事情时，你有一系列的提交。现在假设您提交的存储库鼓励大型提交，因此对于您正在做的工作，人们会期望进行一次或两次提交。你如何接受你的提交字符串并将它们压缩到预期的值？您将使用交互式 rebase 并将您的微小提交压缩成更少的大块。如果需要相反的情况也是如此 - 如果您的风格是一些大型提交，但是存储库需要一长串的小提交。你也可以使用变基来做到这一点。如果您已经合并，那么您现在已经将您的提交样式移植到主存储库中。如果有很多开发人员，您可以想象一段时间后要跟踪具有多种不同提交样式的历史是多么困难。

更新 3：`Does one still need to merge after a successful rebase?`是的，你知道。原因是变基本质上涉及提交的“转移”。正如我上面所说，这些提交是计算出来的，但是如果你从分支点开始有 14 次提交，那么假设你的变基没有问题，那么你将提前 14 个提交（在你变基之后）变基完成。在变基之前你有一个分支。之后你将有一个相同长度的分支。在发布更改之前，您仍然需要合并。换句话说，根据需要多次变基（同样，仅当您没有将更改推送到上游时）。只有在你变基后才合并。

* * *

## 回答 #8

> 赞同：77
> 
> 时间：2017-10-12T11:52:29.437

虽然合并绝对是集成更改的最简单和最常见的方式，但它并不是唯一的：***Rebase***是一种替代的集成方式。

**更好地理解合并**

当 Git 执行合并时，它会查找三个提交：

*   (1) 共同祖先提交。如果你跟踪一个项目中两个分支的历史，它们总是至少有一个共同的提交：在这个时间点，两个分支具有相同的内容，然后演变不同。
*   (2) + (3) 每个分支的端点。集成的目标是结合两个分支的当前状态。因此，它们各自的最新修订版具有特殊意义。结合这三个提交将导致我们的目标是集成。

**快进或合并提交**

在非常简单的情况下，两个分支之一在分支发生后没有任何新的提交——它的最新提交仍然是共同的祖先。

[![在此处输入图像描述](https://i.stack.imgur.com/57Wt0.gif)](https://i.stack.imgur.com/57Wt0.gif)

在这种情况下，执行集成非常简单：Git 可以将其他分支的所有提交添加到共同祖先提交之上。在 Git 中，这种最简单的集成形式称为“快进”合并。然后，两个分支共享完全相同的历史记录。

[![在此处输入图像描述](https://i.stack.imgur.com/f1VTv.gif)](https://i.stack.imgur.com/f1VTv.gif)

然而，在很多情况下，两个分支都各自向前发展。

[![在此处输入图像描述](https://i.stack.imgur.com/GlAgx.gif)](https://i.stack.imgur.com/GlAgx.gif)

为了进行集成，Git 必须创建一个包含它们之间差异的新提交——合并提交。

[![在此处输入图像描述](https://i.stack.imgur.com/e3xJE.gif)](https://i.stack.imgur.com/e3xJE.gif)

**人工提交和合并提交**

通常，提交是由人类精心创建的。这是一个有意义的单元，它只包装相关的更改并用注释对其进行注释。

合并提交有点不同：它不是由开发人员创建的，而是由 Git 自动创建的。而不是包装一组相关的变化，它的目的是连接两个分支，就像一个结。如果你以后想了解一个合并操作，你需要看一下两个分支的历史和相应的提交图。

**与 Rebase 集成**

*有些人更喜欢不使用这种自动合并提交。相反，他们希望项目的历史看起来好像是在一条直线上发展的。*没有迹象表明它在某个时候被分成了多个分支。

[![在此处输入图像描述](https://i.stack.imgur.com/b1nud.gif)](https://i.stack.imgur.com/b1nud.gif)

让我们一步一步地完成一个 rebase 操作。场景与前面的示例相同：我们希望将分支 B 的更改集成到分支 A，但现在使用 rebase。

[![在此处输入图像描述](https://i.stack.imgur.com/Az5LO.gif)](https://i.stack.imgur.com/Az5LO.gif)

我们将分三步完成

1.  `git rebase branch-A // Synchronises the history with branch-A`
2.  `git checkout branch-A // Change the current branch to branch-A`
3.  `git merge branch-B // Merge/take the changes from branch-B to branch-A`

首先，Git 将“撤消”分支 A 上在行开始分支之后（在共同祖先提交之后）发生的所有提交。但是，当然，它不会丢弃它们：相反，您可以将这些提交视为“暂时保存”。

[![在此处输入图像描述](https://i.stack.imgur.com/To3Iq.gif)](https://i.stack.imgur.com/To3Iq.gif)

接下来，它应用来自我们想要集成的分支 B 的提交。此时，两个分支看起来完全一样。

[![在此处输入图像描述](https://i.stack.imgur.com/Vrfmo.gif)](https://i.stack.imgur.com/Vrfmo.gif)

在最后一步中，现在重新应用分支 A 上的新提交 - 但在新位置上，在来自分支 B 的集成提交之上（它们是重新基于的）。

**结果看起来就像直线发展一样。保留了原始提交结构，而不是包含所有组合更改的合并提交。**

[![在此处输入图像描述](https://i.stack.imgur.com/4IKL0.gif)](https://i.stack.imgur.com/4IKL0.gif)

最后，你得到一个干净的分支**分支-A**，没有不需要的和自动生成的提交。

**注意**：取自. [_](https://www.git-tower.com/learn/git/ebook/en/desktop-gui/advanced-topics/rebase) [`git-tower`](https://www.git-tower.com/windows/)的*缺点*也是`rebase`在同一篇文章中很好阅读。

* * *

## 回答 #9

> 赞同：68
> 
> 时间：2012-06-07T06:19:16.200

在合并/变基之前：

```
A <- B <- C    [master]
^
 \
  D <- E       [branch] 
```

之后`git merge master`：

```
A <- B <- C
^         ^
 \         \
  D <- E <- F 
```

之后`git rebase master`：

```
A <- B <- C <- D' <- E' 
```

（A、B、C、D、E 和 F 是提交）

可以在*[Git The Basics Tutorial](http://excess.org/article/2008/07/ogre-git-tutorial/)*中找到这个示例以及更多关于 Git 的详细说明信息。

* * *

## 回答 #10

> 赞同：34
> 
> 时间：2017-02-10T17:26:28.100

这个答案广泛面向[Git Flow](http://nvie.com/posts/a-successful-git-branching-model/)。这些表是用漂亮的[ASCII Table Generator 生成](https://ozh.github.io/ascii-tables/)的，历史树是用这个美妙的命令（[别名](https://githowto.com/aliases)为`git lg`）生成的：

```
git log --graph --abbrev-commit --decorate --date=format:'%Y-%m-%d %H:%M:%S' --format=format:'%C(bold blue)%h%C(reset) - %C(bold cyan)%ad%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n''          %C(white)%s%C(reset) %C(dim white)- %an%C(reset)' 
```

表格按时间倒序排列，以便与历史树更加一致。`git merge`另请参阅和first之间的区别`git merge --no-ff`（您通常希望使用`git merge --no-ff`它，因为它使您的历史看起来更接近现实）：

### `git merge`

命令：

```
Time          Branch "develop"             Branch "features/foo"
------- ------------------------------ -------------------------------
15:04   git merge features/foo
15:03                                  git commit -m "Third commit"
15:02                                  git commit -m "Second commit"
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
* 142a74a - YYYY-MM-DD 15:03:00 (XX minutes ago) (HEAD -> develop, features/foo)
|           Third commit - Christophe
* 00d848c - YYYY-MM-DD 15:02:00 (XX minutes ago)
|           Second commit - Christophe
* 298e9c5 - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

### `git merge --no-ff`

命令：

```
Time           Branch "develop"              Branch "features/foo"
------- -------------------------------- -------------------------------
15:04   git merge --no-ff features/foo
15:03                                    git commit -m "Third commit"
15:02                                    git commit -m "Second commit"
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
*   1140d8c - YYYY-MM-DD 15:04:00 (XX minutes ago) (HEAD -> develop)
|\            Merge branch 'features/foo' - Christophe
| * 69f4a7a - YYYY-MM-DD 15:03:00 (XX minutes ago) (features/foo)
| |           Third commit - Christophe
| * 2973183 - YYYY-MM-DD 15:02:00 (XX minutes ago)
|/            Second commit - Christophe
* c173472 - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

* * *

# `git merge`对比`git rebase`

第一点：**总是将 features 合并到 develop 中，永远不要 rebase development from features**。这是变[基黄金法则的结果](https://www.atlassian.com/git/tutorials/merging-vs-rebasing#the-golden-rule-of-rebasing)：

> 的黄金法则`git rebase`是永远不要在*公共*分支上使用它。

[换句话说](https://git-scm.com/book/en/v2/Git-Branching-Rebasing)：

> 永远不要改变你推到某个地方的任何东西。

我会亲自补充：*除非它是一个功能分支并且您和您的团队都知道后果*。

所以`git merge`vs的问题`git rebase`几乎只适用于特征分支（在下面的例子中，`--no-ff`一直在合并时使用）。请注意，由于我不确定是否有更好的解决方案（[存在争议](https://www.atlassian.com/git/articles/git-team-workflows-merge-or-rebase)），我将只提供这两个命令的行为方式。就我而言，我更喜欢使用它，`git rebase`因为它会产生更好的历史树:)

## 特征分支之间

### `git merge`

命令：

```
Time           Branch "develop"              Branch "features/foo"           Branch "features/bar"
------- -------------------------------- ------------------------------- --------------------------------
15:10   git merge --no-ff features/bar
15:09   git merge --no-ff features/foo
15:08                                                                    git commit -m "Sixth commit"
15:07                                                                    git merge --no-ff features/foo
15:06                                                                    git commit -m "Fifth commit"
15:05                                                                    git commit -m "Fourth commit"
15:04                                    git commit -m "Third commit"
15:03                                    git commit -m "Second commit"
15:02   git checkout -b features/bar
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
*   c0a3b89 - YYYY-MM-DD 15:10:00 (XX minutes ago) (HEAD -> develop)
|\            Merge branch 'features/bar' - Christophe
| * 37e933e - YYYY-MM-DD 15:08:00 (XX minutes ago) (features/bar)
| |           Sixth commit - Christophe
| *   eb5e657 - YYYY-MM-DD 15:07:00 (XX minutes ago)
| |\            Merge branch 'features/foo' into features/bar - Christophe
| * | 2e4086f - YYYY-MM-DD 15:06:00 (XX minutes ago)
| | |           Fifth commit - Christophe
| * | 31e3a60 - YYYY-MM-DD 15:05:00 (XX minutes ago)
| | |           Fourth commit - Christophe
* | |   98b439f - YYYY-MM-DD 15:09:00 (XX minutes ago)
|\ \ \            Merge branch 'features/foo' - Christophe
| |/ /
|/| /
| |/
| * 6579c9c - YYYY-MM-DD 15:04:00 (XX minutes ago) (features/foo)
| |           Third commit - Christophe
| * 3f41d96 - YYYY-MM-DD 15:03:00 (XX minutes ago)
|/            Second commit - Christophe
* 14edc68 - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

### `git rebase`

命令：

```
Time           Branch "develop"              Branch "features/foo"           Branch "features/bar"
------- -------------------------------- ------------------------------- -------------------------------
15:10   git merge --no-ff features/bar
15:09   git merge --no-ff features/foo
15:08                                                                    git commit -m "Sixth commit"
15:07                                                                    git rebase features/foo
15:06                                                                    git commit -m "Fifth commit"
15:05                                                                    git commit -m "Fourth commit"
15:04                                    git commit -m "Third commit"
15:03                                    git commit -m "Second commit"
15:02   git checkout -b features/bar
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
*   7a99663 - YYYY-MM-DD 15:10:00 (XX minutes ago) (HEAD -> develop)
|\            Merge branch 'features/bar' - Christophe
| * 708347a - YYYY-MM-DD 15:08:00 (XX minutes ago) (features/bar)
| |           Sixth commit - Christophe
| * 949ae73 - YYYY-MM-DD 15:06:00 (XX minutes ago)
| |           Fifth commit - Christophe
| * 108b4c7 - YYYY-MM-DD 15:05:00 (XX minutes ago)
| |           Fourth commit - Christophe
* |   189de99 - YYYY-MM-DD 15:09:00 (XX minutes ago)
|\ \            Merge branch 'features/foo' - Christophe
| |/
| * 26835a0 - YYYY-MM-DD 15:04:00 (XX minutes ago) (features/foo)
| |           Third commit - Christophe
| * a61dd08 - YYYY-MM-DD 15:03:00 (XX minutes ago)
|/            Second commit - Christophe
* ae6f5fc - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

## 从`develop`到功能分支

### `git merge`

命令：

```
Time           Branch "develop"              Branch "features/foo"           Branch "features/bar"
------- -------------------------------- ------------------------------- -------------------------------
15:10   git merge --no-ff features/bar
15:09                                                                    git commit -m "Sixth commit"
15:08                                                                    git merge --no-ff develop
15:07   git merge --no-ff features/foo
15:06                                                                    git commit -m "Fifth commit"
15:05                                                                    git commit -m "Fourth commit"
15:04                                    git commit -m "Third commit"
15:03                                    git commit -m "Second commit"
15:02   git checkout -b features/bar
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
*   9e6311a - YYYY-MM-DD 15:10:00 (XX minutes ago) (HEAD -> develop)
|\            Merge branch 'features/bar' - Christophe
| * 3ce9128 - YYYY-MM-DD 15:09:00 (XX minutes ago) (features/bar)
| |           Sixth commit - Christophe
| *   d0cd244 - YYYY-MM-DD 15:08:00 (XX minutes ago)
| |\            Merge branch 'develop' into features/bar - Christophe
| |/
|/|
* |   5bd5f70 - YYYY-MM-DD 15:07:00 (XX minutes ago)
|\ \            Merge branch 'features/foo' - Christophe
| * | 4ef3853 - YYYY-MM-DD 15:04:00 (XX minutes ago) (features/foo)
| | |           Third commit - Christophe
| * | 3227253 - YYYY-MM-DD 15:03:00 (XX minutes ago)
|/ /            Second commit - Christophe
| * b5543a2 - YYYY-MM-DD 15:06:00 (XX minutes ago)
| |           Fifth commit - Christophe
| * 5e84b79 - YYYY-MM-DD 15:05:00 (XX minutes ago)
|/            Fourth commit - Christophe
* 2da6d8d - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

### `git rebase`

命令：

```
Time           Branch "develop"              Branch "features/foo"           Branch "features/bar"
------- -------------------------------- ------------------------------- -------------------------------
15:10   git merge --no-ff features/bar
15:09                                                                    git commit -m "Sixth commit"
15:08                                                                    git rebase develop
15:07   git merge --no-ff features/foo
15:06                                                                    git commit -m "Fifth commit"
15:05                                                                    git commit -m "Fourth commit"
15:04                                    git commit -m "Third commit"
15:03                                    git commit -m "Second commit"
15:02   git checkout -b features/bar
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
*   b0f6752 - YYYY-MM-DD 15:10:00 (XX minutes ago) (HEAD -> develop)
|\            Merge branch 'features/bar' - Christophe
| * 621ad5b - YYYY-MM-DD 15:09:00 (XX minutes ago) (features/bar)
| |           Sixth commit - Christophe
| * 9cb1a16 - YYYY-MM-DD 15:06:00 (XX minutes ago)
| |           Fifth commit - Christophe
| * b8ddd19 - YYYY-MM-DD 15:05:00 (XX minutes ago)
|/            Fourth commit - Christophe
*   856433e - YYYY-MM-DD 15:07:00 (XX minutes ago)
|\            Merge branch 'features/foo' - Christophe
| * 694ac81 - YYYY-MM-DD 15:04:00 (XX minutes ago) (features/foo)
| |           Third commit - Christophe
| * 5fd94d3 - YYYY-MM-DD 15:03:00 (XX minutes ago)
|/            Second commit - Christophe
* d01d589 - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

* * *

# 旁注

### `git cherry-pick`

当您只需要一个特定的提交时，`git cherry-pick`这是一个不错的解决方案（该`-x`选项会在原始提交消息正文中附加一行“ *（从提交中挑选的樱桃...）* ”，因此使用它通常是一个好主意 -`git log <commit_sha1>`查看它）：

命令：

```
Time           Branch "develop"              Branch "features/foo"                Branch "features/bar"
------- -------------------------------- ------------------------------- -----------------------------------------
15:10   git merge --no-ff features/bar
15:09   git merge --no-ff features/foo
15:08                                                                    git commit -m "Sixth commit"
15:07                                                                    git cherry-pick -x <second_commit_sha1>
15:06                                                                    git commit -m "Fifth commit"
15:05                                                                    git commit -m "Fourth commit"
15:04                                    git commit -m "Third commit"
15:03                                    git commit -m "Second commit"
15:02   git checkout -b features/bar
15:01   git checkout -b features/foo
15:00   git commit -m "First commit" 
```

结果：

```
*   50839cd - YYYY-MM-DD 15:10:00 (XX minutes ago) (HEAD -> develop)
|\            Merge branch 'features/bar' - Christophe
| * 0cda99f - YYYY-MM-DD 15:08:00 (XX minutes ago) (features/bar)
| |           Sixth commit - Christophe
| * f7d6c47 - YYYY-MM-DD 15:03:00 (XX minutes ago)
| |           Second commit - Christophe
| * dd7d05a - YYYY-MM-DD 15:06:00 (XX minutes ago)
| |           Fifth commit - Christophe
| * d0d759b - YYYY-MM-DD 15:05:00 (XX minutes ago)
| |           Fourth commit - Christophe
* |   1a397c5 - YYYY-MM-DD 15:09:00 (XX minutes ago)
|\ \            Merge branch 'features/foo' - Christophe
| |/
|/|
| * 0600a72 - YYYY-MM-DD 15:04:00 (XX minutes ago) (features/foo)
| |           Third commit - Christophe
| * f4c127a - YYYY-MM-DD 15:03:00 (XX minutes ago)
|/            Second commit - Christophe
* 0cf894c - YYYY-MM-DD 15:00:00 (XX minutes ago)
            First commit - Christophe 
```

### `git pull --rebase`

我不确定我能不能比[Derek Gourlay](https://www.derekgourlay.com/blog/git-when-to-merge-vs-when-to-rebase/)更好地解释它......基本上，使用`git pull --rebase`而不是`git pull`:) 虽然文章中缺少的是，[您可以默认启用它](https://coderwall.com/p/tnoiug/rebase-by-default-when-doing-git-pull)：

```
git config --global pull.rebase true 
```

### `git rerere`

再次，很好地解释[here](https://git-scm.com/docs/git-rerere)。但简而言之，如果启用它，您将不再需要多次解决相同的冲突。

* * *

## 回答 #11

> 赞同：33
> 
> 时间：2015-01-05T13:50:13.780

这句话明白了：

> 一般来说，两全其美的方法是在你推送它们以清理你的故事之前，对你所做但尚未共享的本地更改进行 rebase，但永远不要对你推送的任何内容进行 rebase .

资料来源：[3.6 Git 分支 - 变基、变基与合并](http://www.git-scm.com/book/en/v2/Git-Branching-Rebasing#_rebase_vs_merge)

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2012-12-20T21:41:03.207

*[Pro Git](https://git-scm.com/book/en/v2)*书在变[基页面](http://git-scm.com/book/en/Git-Branching-Rebasing)上有很好的解释。

基本上，合并将需要两次提交并将它们组合起来。

一个 rebase 将转到两者的共同祖先，并在彼此之上逐步应用更改。这使得历史更清晰、更线性。

但是当你变基时，你会放弃以前的提交并创建新的提交。因此，您永远不应该对公开的存储库进行变基。在存储库上工作的其他人会讨厌你。

仅出于这个原因，我几乎完全合并。99% 的情况下，我的分支并没有那么大的差异，所以如果有冲突，它只会在一两个地方发生。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-09-24T06:11:26.247

Git rebase 用于使历史中的分支路径更清晰和存储库结构线性。

它还用于保持您创建的分支的私密性，因为在重新设置基础并将更改推送到服务器之后，如果您删除了您的分支，则不会有您曾经处理过的分支的证据。因此，您的分支机构现在是您当地的关注点。

在做 rebase 之后，我们还摆脱了一个额外的提交，我们曾经用它来查看我们是否进行了正常的合并。

是的，一个成功的 rebase 后仍然需要进行合并，因为 rebase 命令只是将你的工作放在你在 rebase 期间提到的分支之上，比如 master，并将你的分支的第一次提交作为 master 分支的直接后代. 这意味着我们现在可以进行快进合并，将更改从这个分支带到主分支。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-02-23T06:13:16.403

[一些实际示例，在某种程度上与使用Gerrit](https://en.wikipedia.org/wiki/Gerrit_(software))进行审查和交付集成的大规模开发有关：

当我将我的功能分支提升到一个新的远程主控时，我会合并。这提供了最小的提升工作，并且很容易遵循例如[gitk](https://git-scm.com/docs/gitk)中的功能开发历史。

```
git fetch
git checkout origin/my_feature
git merge origin/master
git commit
git push origin HEAD:refs/for/my_feature 
```

我在准备交付提交时合并。

```
git fetch
git checkout origin/master
git merge --squash origin/my_feature
git commit
git push origin HEAD:refs/for/master 
```

当我的交付提交由于某种原因无法集成时，我会重新设置基准，并且我需要将其更新为新的远程主机。

```
git fetch
git fetch <gerrit link>
git checkout FETCH_HEAD
git rebase origin/master
git push origin HEAD:refs/for/master 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2019-02-07T11:50:01.257

多次解释了什么是变基和什么是合并，但是什么时候应该使用呢？

**什么时候应该使用变基？**

变基“解除”您的更改并将变基分支的所有更改放入您当前的分支，然后将您的更改放在它之上。因此，它会更改您分支的历史记录。

*   当您还没有推送分支/没有其他人在处理它时
*   您希望在合并回源分支时同时查看所有更改
*   你想避免自动生成的“merged ..”提交消息

我说“您希望在一个地方查看所有更改”，因为有时合并操作会将您的所有更改放在一个提交中（一些：合并自...消息）。Rebase 使您的更改看起来像您一个接一个地提交，中间没有其他人做任何事情。这使您更容易看到您对功能所做的更改。

但请确保您使用 git merge feature-branch --ff-only 来确保在将功能合并回开发/主时不会创建单个提交。

**什么时候应该使用合并？**

*   当您推送分支/其他人也在处理它时（如果其他人也在该分支上工作，rebase 会变得非常复杂！）
*   您不需要完整的历史记录（*）/您的功能不必将其全部提交到一个地方。

(*) 您可以通过首先将开发分支合并到您的功能然后将您的功能合并回开发来避免您的功能仅获得一个“合并的..”提交。这仍然为您提供“合并的 ..”提交，但至少您的功能的所有提交仍然可见。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-01-19T21:01:38.880

我什么时候使用`git rebase`？几乎从来没有，因为它改写了历史。`git merge`几乎总是更可取的选择，因为它尊重您项目中实际发生的情况。

# excel - CSV/Excel 的最佳时间戳格式？

> ID：804118
> 
> 赞同：122
> 
> 时间：2009-04-29T20:27:36.433
> 
> 标签：excel, formatting, csv, timestamp

我正在写一个 CSV 文件。我需要编写至少精确到秒的时间戳，最好精确到毫秒。CSV 文件中时间戳的最佳格式是什么，以便 Excel 可以在最少的用户干预下准确、明确地解析它们？

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2009-04-29T20:33:10.697

对于第二个精度， yyyy-MM-dd HH:mm:ss 应该可以解决问题。

我相信 Excel 在几分之一秒内不是很好（与 COM 对象 IIRC 交互时会丢失它们）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-01T03:52:32.317

早期使用“yyyy-MM-dd HH:mm:ss”的建议很好，尽管我相信 Excel 的时间分辨率比这要好得多。我觉得[这篇文章](http://www.tech-archive.net/Archive/Excel/microsoft.public.excel.misc/2009-03/msg04040.html)相当可信（按照这个帖子，你会看到很多算术和 Excel 实验），如果它是正确的，你会得到你的毫秒数。您可以在末尾添加小数位，即“yyyy-mm-dd hh:mm:ss.000”。

您应该知道，Excel 可能不一定以您将看到所有这些精度的方式格式化数据（无需人工干预）。在我工作的计算机上，当我使用“yyyy-mm-dd hh:mm:ss.000”数据（手动使用记事本）设置 CSV 时，我在单元格中得到“mm:ss.0”和“m /d/yyyy hh:mm:ss AM/PM”在公式栏中。

对于在没有人工干预的情况下在单元格中传达的最大信息 [1]，您可能希望将您的时间戳拆分为日期部分和时间部分，时间部分仅为秒。在我看来，Excel 希望在任何给定单元格中最多为您提供三个可见的“级别”（其中几分之一秒是他们自己的级别），而您需要七个：年、月、日、小时、分钟、秒，和几分之一秒。

或者，如果您不需要人类可读的时间戳，但您希望它尽可能准确，您可能更喜欢只存储一个大数字（在内部，Excel 只使用天数，包括小数天，从“纪元”日期开始）。

* * *

[1]即数字信息。如果您想查看尽可能多的信息但不关心用它进行计算，您可以编写一些 Excel 肯定会解析为字符串的格式，因此不用管它；例如“yyyymmdd.hhmmss.000”。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-03-16T16:44:32.037

“yyyy-MM-dd hh:mm:ss.000”格式不适用于所有语言环境。对于某些（至少是丹麦语）“yyyy-MM-dd hh:mm:ss,000”会更好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T20:30:37.097

我相信如果你使用`double`数据类型，在 Excel 中重新计算就可以了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-04-21T11:33:17.207

转到控制面板中的语言设置，然后转到格式选项，选择一个区域设置，然后查看 Windows 默认使用的所选区域设置的实际日期格式。是的，该时间戳格式是区域敏感的。Excel 在解析 CSV 时使用这些格式。

更进一步，如果语言环境使用 ASCII 以外的字符，您必须在相应的 pre-Unicode Windows“ANSI”代码页中发出 CSV，例如 CP1251。Excel 不接受 UTF-8。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-12-13T16:40:30.623

> “yyyy-mm-dd hh:mm:ss.000”格式不适用于所有语言环境。对于某些（至少是丹麦语）“yyyy-mm-dd hh:mm:ss,000”会更好。

正如用户662894所回答的那样。

我想补充一点：不要试图从 SQL Server 的 datetime2 数据类型中获取微秒数：Excel 不能处理超过 3 个小数秒（即毫秒）。

所以 "yyyy-mm-dd hh:mm:ss.000000" 不起作用，当 Excel 输入这种字符串（来自 CSV 文件）时，它将执行*舍入*而不是*截断*。

这可能没问题，除非微秒精度很重要，在这种情况下，最好不要触发自动数据类型识别，而是将字符串保留为字符串......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-14T22:58:11.990

至于时区。我必须将 UTC 偏移量存储为距 UTC 的秒数，这样 Excel/OpenOffice 中的公式最终可以本地化日期时间。我发现这比存储任何前面有 0 的数字更容易。-0900 在任何电子表格系统中都不能很好地解析，并且导入它几乎不可能训练人们去做。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-11-08T17:05:21.057

因此，奇怪的是，excel 以不同的方式导入 csv 日期。*并且*，根据 csv 文件中使用的格式以不同方式显示它们。不幸的是，ISO 8061 格式以字符串形式出现。这会阻止您自己重新格式化日期。

所有这些确实以日期形式出现...包含全部信息...但它们的格式不同...如果您不喜欢它，您可以为 excel 中的列选择一种新格式，它会起作用。（注意：你可以告诉它是作为一个有效的日期/时间进来的，因为它会右对齐......如果它作为一个字符串进来，它会左对齐）

以下是我测试的格式：

在 Excel 中打开时，“yyyy-MM-dd”当然会显示为日期。（也可以使用“MM/dd/yyyy”）

“yyyy-MM-dd HH:mm:ss”默认显示格式为“MM/dd/yyyy HH:mm”（日期和时间不包括秒）

“yyyy-MM-dd HH:mm:ss.fff”默认显示格式为“HH:mm:ss”（仅时间 w/秒）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-08T06:05:17.743

尝试 MM/dd/yyyy hh:mm:ss 格式。

用于创建 XML 文件的 Java 代码。

> > xmlResponse.append("mydate>").append(this.formatDate(resultSet.getTimestamp("date"), "MM/dd/yyyy hh:mm:ss a")).append("");

```
public String formatDate(Date date, String format)
{
    String dateString = "";
    if(null != date)
    {
        SimpleDateFormat dateFormat = new SimpleDateFormat(format);
        dateString = dateFormat.format(date);
    }
    return dateString;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-16T06:01:40.070

我将时间戳写入 CSV 文件，格式为 yyyy-mm-dd hh:mm:ss。

在 Excel 365 中，我创建了一个空白工作簿，转到“数据”选项卡并选择“来自文本/CSV。

打开一个带有预览的对话框，奇怪的是，它只保留了第一列时间戳，但显示它将转换第二列。

您可以“加载”数据，也可以“转换数据”，这是我的选择。

现在您在“Power Query 编辑器”中，您可以了解 Excel 如何将列引入。

就我而言，我撤消了它所做的任何自动更改，并使用功能区上的一个小按钮告诉它两列都是数据类型“日期/时间”。

按 Close & Load 将其作为数据源导入 Excel，您可以对其进行排序等。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-04-29T20:30:38.673

我猜想[ISO 格式](http://www.w3.org/QA/Tips/iso-date)是个好主意。（[维基百科文章](http://en.wikipedia.org/wiki/ISO_8601)，还有时间信息）

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2020-05-24T16:45:06.430

给定一个包含以下格式的日期时间列的 csv 文件：yyyy-mm-dd hh:mm:ss

Excel 以这种格式显示它：dd/mm/yyyy hh:mm

例如 2020-05-22 16:40:55 显示为 22/05/2020 16:40

这显然是由 Windows 中选择的短日期和短时间格式决定的；例如，如果我将 Windows 中的短日期格式更改为 yyyy-mm-dd，Excel 会显示 2020-05-22 16:40。

烦人的是，我找不到任何方法让 Excel 自动显示秒数（我必须在 Excel 中手动格式化列）。但是，如果 csv 文件包含 hh:mm:ss 格式的时间列（例如 16:40:55），那么 Excel 中就会显示，包括秒数。

# timestamp - 无法读取 Zsh 历史的时间戳

> ID：804120
> 
> 赞同：17
> 
> 时间：2009-04-29T20:27:56.653
> 
> 标签：timestamp, zsh

**问题：**了解以下时间戳

```
1241036430 
```

在 ~/.history

```
: 1241036336:0;vim ~/.zshrc
: 1241036379:0;vim ~/bin/HideTopBar
: 1241036421:0;ls
: 1241036430:0;cat ~/.history 
```

当我有

```
setopt EXTENDED_HISTORY
HISTFILE=~/.history 
```

在 .zshrc 中。

**如何读取时间戳？**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-29T20:32:54.923

试试`history -d`。或者只需键入`history -`并按 control-D 即可获得所有各种选项：

```
% history -
-D  -- print elapsed times
-E  -- dd.mm.yyyy format time-stamps
-d  -- print time-stamps
-f  -- mm/dd/yyyy format time-stamps
-i  -- yyyy-mm-dd format time-stamps
-m  -- treat first argument as a pattern
-n  -- suppress line numbers
-r  -- reverse order of the commands 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-07-30T23:58:51.613

[您可以使用从zsh 邮件列表上的答案中](http://www.zsh.org/mla/users/2007/msg00955.html)获取的单行代码，以人类可读的时间戳显示整个历史记录：

```
perl -lne 'm#: (\d+):\d+;(.+)# && printf "%s :: %s\n",scalar localtime $1,$2' $HISTFILE 
```

我建议将输出通过管道传输到寻呼机（`less`例如）以使其更具可读性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-09-17T04:04:17.060

这个简单的[util](http://perl.plover.com/classes/mybin/samples/source/localtime)被称为`localtime`是读取带有时间戳的文件的黄金：

```
#!/usr/bin/perl
# http://perl.plover.com/classes/mybin/samples/source/localtime

if ($ARGV[0] eq '-f') {
  *show_localtime = \&show_localtime_list;
  shift;
}

if (@ARGV) {
  for (@ARGV) {
    print show_localtime($_), "\n";
  }
} else {
  while (<>) {
    s/^(\d+)/show_localtime($1)/e;
    print;
  }
}

sub show_localtime {
  my $t = shift;
  scalar localtime $t;
}

sub show_localtime_list {
  my $t = shift;
  my @a = localtime $t;
  "@a\n"
} 
```

*   （还有一个小[介绍](http://perl.plover.com/classes/mybin/samples/slide017.html)：））

它处理了很多情况，并且似乎理解以秒和微秒为单位的时间戳等。

```
$ localtime < ~/.histfile
<snip>
: Sat Sep 17 05:55:17 2016:0;cat localtime 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-10-07T20:28:47.793

**使用 awk 转换时间戳**

如果您想读取文件本身，例如与`grep`任何其他过滤器一起使用，您需要转换时间戳。

我制作了这个脚本，将它保存在我的 .bashrc 中`/usr/local/bin`，它适用于**bash**和**zshell**：

**脚本 uhistory.awk**在 /usr/local/bin/uhistory.awk

```
#!/usr/bin/awk -f
{ 
        if (match($0,/^#/)) # bash
        {
                nlin++
                #adata="@"substr($0,2) 
                #printf("%s ", adata)
                cmdata = "date -d \"@" substr($0,2) "\" +\"%F %H:%M:%S\"" 
                cmdata | getline datado
                close(cmdata)
                printf("%d %s ", nlin, datado)
        }
        else
        if (match($0,/^:/)) # zshell
        {
            nlin++
            split($0, arr, ":|;")
            cmdata = "date -d \"@" substr(arr[2],2) "\" +\"%F %H:%M:%S\"" 
            cmdata | getline datado
            close(cmdata)
            printf("%d : %s ; %ss % ", nlin, datado, arr[3])
            for (i in arr)
            {
                if (i < 4)
                    continue
                printf("%s ", arr[i])
            }
            printf("\n")
        }
        else
        {
            print $0
        }
} 
```

**用法**：您可以通过过滤器管道历史记录。假设 的历史文件`zsh`具有以下格式：

```
:timestamp:duration;commands 
```

没有**uhistory.awk**过滤器将是：

```
% head ~/.config/zsh/zhistfile

: 1570482839:0;la
: 1570482839:0;cd zsh
: 1570482839:0;ls
: 1570482839:1;cat verybigaliasfile.txt
: 1570482839:0;alias
: 1570482839:0;ls -la
: 1570482839:0;vi .zshrc
: 1570482839:0;alias 
```

使用**uhistory.awk**过滤器，它将显示为：

```
% head ~/.config/zsh/zhistfile | uhistory.awk | grep alias

4 : 2019-10-07 18:13:59 ; 1s % cat verybigaliasfile.txt
5 : 2019-10-07 18:13:59 ; 0s % alias 
9 : 2019-10-07 18:13:59 ; 0s % alias 
```

但是，如果您的使用不涉及处理文件本身，那么您真正需要的只是一个别名。

将此行添加到您的`.zsh_aliases`或您为别名设置的其他地方。

```
alias history='fc -il 1' 
```

`fc`或命令中的其他选项。检查与`man zshbuiltins`

* * *

更好的是使用相同的命令，因此如果您想在最后添加另一个键/选项，它不会造成混淆。在这种情况下，我建议：

```
alias history='history -i' 
```

当然，您也可以通过管道传输结果，例如：

```
% history | grep alias

4   2019-10-07 18:13:59  cat verybigaliasfile.txt
5   2019-10-07 18:13:59  alias 
9   2019-10-07 18:13:59  alias 
```

在这种情况下，不会出现*持续时间，但其余部分相同。*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-11-01T12:09:57.120

附录：您也可以使用`history`命令本身来翻译保存的历史文件中的时间戳：

Nicholas Riley 解释的命令选项`history`同样适用于保存的历史文件，因此`history -d < historyfile`（或任何其他选项）可以很好地转换时间戳。

如果您使用的不仅仅是一个历史文件，这会派上用场 - 我已设置`zsh`为每个 pty 保留一个历史文件，以避免混淆同一系统上并行运行的 shell 的历史（因为通常每个窗口/屏幕/. .. 是特定于某项任务的，因此从正常使用中出现的历史最终会成为某种主题）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-10-23T06:53:05.640

```
: 1241036430:0;cat ~/.history

‘: <beginning time>:<elapsed seconds>;<command>’. 
```

extendedhistory - 以秒为单位节省时间。开始时间是从纪元开始。

来源：http: [//zsh.sourceforge.net/Doc/Release/Options.html#index-EXTENDEDHISTORY](http://zsh.sourceforge.net/Doc/Release/Options.html#index-EXTENDEDHISTORY)

# javascript - 如何验证 javascript？

> ID：804121
> 
> 赞同：0
> 
> 时间：2009-04-29T20:28:00.927
> 
> 标签：javascript, jquery, validation, append

我正在使用一小段 JS 向我的块引用添加一个表示元素（如此[处所示](http://net.tutsplus.com/videos/screencasts/fun-with-css-shapes/)）：

```
<script type="text/javascript"> 
    $('blockquote.message').append('<span class="arrow" />');   
</script> 
```

但是 W3C 验证器讨厌这种废话：

> **文档类型在此处不允许元素“span”**

我究竟做错了什么？有没有办法纠正这个错误，同时保持功能？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T20:46:56.857

我假设您使用的是 XHTML？您需要将 JavaScript 包装在 CDATA 中：

```
<script type="text/javascript">
//<![CDATA[
        $('blockquote.message').append('<span class="arrow" />');       
//]]>
</script> 
```

请参阅此处的 XHTML 参考：http: [//xhtml.com/en/xhtml/reference/script/](http://xhtml.com/en/xhtml/reference/script/) -“如果脚本元素包含嵌入式脚本并且该脚本包含 XHTML 标记字符，例如 <、>、& 和”，则脚本应包含在 CDATA 中”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T20:34:50.863

[blockquote标签](http://www.w3.org/TR/html4/struct/text.html#h-9.2.2)只能包含P、 H1..n 、OL/UL、PRE、DL、DIV、NOSCRIPT、BLOCKQUOTE、FORM、HR、TABLE、FIELDSET、ADDRESS等[块元素](http://www.w3.org/TR/html4/sgml/dtd.html#block)

# c++ - const unsigned char * 到 std::string

> ID：804123
> 
> 赞同：49
> 
> 时间：2009-04-29T20:28:18.883
> 
> 标签：c++, std

sqlite3_column_text 返回一个 const unsigned char*，如何将其转换为 std::string？我试过 std::string()，但我得到一个错误。

代码：

```
temp_doc.uuid = std::string(sqlite3_column_text(this->stmts.read_documents, 0)); 
```

错误：

```
1>.\storage_manager.cpp(109) : error C2440: '<function-style-cast>' : cannot convert from 'const unsigned char *' to 'std::string'
1>        No constructor could take the source type, or constructor overload resolution was ambiguous 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-29T20:31:59.153

你可以试试：

```
temp_doc.uuid = std::string(reinterpret_cast<const char*>(
      sqlite3_column_text(this->stmts.read_documents, 0)
  )); 
```

虽然`std::string`可以有一个构造函数，`const unsigned char*`但显然它没有。

那为什么不呢？你可以看看这个有点相关的问题：[为什么 C++ 流使用 char 而不是 unsigned char？](https://stackoverflow.com/questions/277655/why-do-c-streams-use-char-instead-of-unsigned-char)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-29T20:46:53.360

如果您实际上想要一串无符号字符，则可以创建自己的类型：

```
typedef std::basic_string <unsigned char> ustring; 
```

然后你应该可以说：

```
ustring s = sqlite3_column_text(this->stmts.read_documents, 0); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-30T23:25:03.240

人们通常使用 (unsigned char *) 类型的原因是表明数据是二进制而不是纯 ASCII 文本。我知道 libxml 可以做到这一点，从外观上看，sqlite 也在做同样的事情。

您从 sqlite 调用返回的数据可能是 UTF-8 编码的 Unicode 文本。虽然 reinterpret_cast 可能看起来有效，但如果有人在非纯 ASCII 字段中存储文本，您的程序可能不会表现良好。

std::string 类在设计时并未考虑到 Unicode，因此如果您询问字符串的 length()，您将得到字节数，在 UTF-8 中，这不一定是同一件事作为字符数。

简短的回答：如果您确定数据只是 ASCII，那么简单的转换可能会起作用。如果它可以是任何 UTF-8 数据，那么您需要以更智能的方式处理编码/解码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T20:33:52.660

我不熟悉 sqlite3_column_text，但您可能想要做的一件事是当您调用 std:string 构造函数时，您需要转换为 (const char*)。我相信它应该有该类型的构造函数。

然而，奇怪的是这个 sqlite 函数返回一个无符号字符 *，它返回一个帕斯卡字符串（第一个字符是字符串的长度）吗？如果是这样，那么您必须使用字节和长度创建 std::string 。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-29T20:34:20.130

如果 temp_doc.uuid 是 std::string 尝试：

```
temp_doc.uuid = static_cast<const char*>(sqlite3_column_text(this->stmts.read_documents, 0)); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T20:40:30.117

尝试：

```
temp_doc.uuid = std::string(reinterpret_cast<const char*>(sqlite3_column_text(this->stmts.read_documents, 0))); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-29T20:34:11.880

您不能`std::string`从 c构造 a `onst unsigned char*`- 您必须`const char*`先将其转换为：

```
temp_doc.uuid = std::string( reinterpret_cast< const char* >(
  sqlite3_column_text(this->stmts.read_documents, 0) ) ); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-04-15T17:12:10.047

我不是专家，但这里的这个例子似乎更简单：

```
string name = (const char*) (sqlite3_column_text(res, 0)); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-07-30T17:53:21.240

一个古老但重要的问题，如果您必须保留 unsigned char 序列中的完整信息。在我看来，reinterpret_cast 并非如此。[我在将字符串转换为](https://bytes.com/topic/c/answers/626633-convert-std-string-std-vector-unsigned-char-vice-versa) 我修改为的向量下找到了一个有趣的解决方案

```
basic_string<unsigned char> temp = sqlite3_column_text(stmt, 0);
string firstItem( temp.begin(), temp.end() ); 
```

由于我正在为 gtkmm 编程，您可以通过以下方式实现转换为 Glib::ustring

```
basic_string<unsigned char> temp = sqlite3_column_text(stmt, 0);
Glib::ustring firstItem = string( temp.begin(), temp.end() ); 
```

# security - 客户端和服务器之间的 SSL 连接持续多长时间？

> ID：804130
> 
> 赞同：2
> 
> 时间：2009-04-29T20:31:46.923
> 
> 标签：security, iis, ssl

我刚开始学习 SSL，男孩是不是很困惑

Q1 - 客户端和服务器之间的 SSL 连接持续多长时间？直到客户端浏览到其他 URL 或……？

第二季度

A) 假设客户端（浏览器）与 IIS 服务器建立 SSL 连接。

现在 IIS 如何在每次回发时确定它正在处理相同的经过身份验证的客户端/浏览器，因此它已经与该客户端建立了 SSL 连接？

B）假设如果浏览器浏览到其他 URL，SSL 连接不会丢失：

假设在 SSL 连接建立后的片刻，客户端浏览到某个其他 URL，不久之后它再次请求（通过 https）原始页面（与它建立 SSL 连接的页面）。

IIS 服务器如何能够确定对页面的当前请求来自已经与该页面建立 SSL 连接并因此将使用已经建立的 SSL 连接的客户端？

谢谢

**编辑：**

*   假设浏览器浏览到其他 URL，如果在返回原始页面时 SSL 连接仍然建立，浏览器将如何“记住”双方用于通信的对称加密密钥的值？

*   我意识到这取决于您使用的浏览器，但是对于 IE 和 Firefox，我假设当您关闭浏览器时，它会将 Connection.Close() （或类似的东西）发送到服务器，因此 SSL 连接会立即关闭？

*   但是，如果您浏览到其他 URL，那么如果浏览器不向服务器发送任何通知，那么 SSL 连接不会在相当长的一段时间内保持建立（甚至 10 分钟或更长时间），因此浏览器可以轻松地冲浪回到那一页好像什么都没发生过？！

我很感激

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T20:50:47.893

Q1。SSL 连接仅适用于客户端和服务器之间的单个 TCP 连接。当前的浏览器（任何支持 HTTP/1.1 的浏览器）可以重用单个连接来下载多个资源。当前的浏览器还与服务器建立多个 TCP 连接，以便并行下载多个资源。因此，您会在一个页面视图中看到多个 SSL 连接。

Q2A。如果浏览器仍然与该服务器打开 TCP 连接，它可以重用该连接。否则，将协商一个具有 SSL 和 IIS 身份验证的新 TCP 连接。

Q2B。与 Q2A 相同。你不能依赖这个，但是 TCP 连接不会立即被处理掉。根据您的浏览器，您有可能重用现有的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T20:51:45.893

A1。SSL 连接将持续存在，直到客户端或服务器将其关闭。何时发生取决于所使用的协议。对于 HTTP，大多数现代客户端将与服务器建立一些并行连接以获取页面及其资源，并重用这些连接直到页面加载。

A2A。如果身份验证使用 HTTP 身份验证，则客户端必须在每个请求上对自己进行身份验证。如果客户端使用 SSL 证书授权，那么这显然是在每个连接的基础上维护的，以便同一连接上的后续请求保留相同的凭据。

A2B。服务器会知道这一点，因为该请求可能会通过已经建立的 SSL 连接进入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T15:25:54.177

编辑后答案：

我认为您可能缺少的是 SSL 本质上链接到 TCP。您不能与不在 TCP 连接之上的服务器建立 SSL“连接”。你打破一个，你打破另一个。

大多数 SSL 实现包括“快捷方式”协商，其中后续的新连接可以利用已经发生的公钥加密，而是直接使用最近协商的对称密钥。然而，这方面的细节隐藏在 SSL 实现中。从用户和/或客户端软件的角度来看，假设整个协商就像在第一次连接上一样发生。

1.  如果 SSL 连接仍然建立，那么对称密钥信息仍然保持在两端。

2.  是的。

3.  是的，尽管客户端一旦导航到其他站点就不可能保持与服务器的连接。

# c# - 运行 C# exe 文件

> ID：804132
> 
> 赞同：2
> 
> 时间：2009-04-29T20:32:18.013
> 
> 标签：c#, .net

### 复制：

> [为什么我的 .NET 应用程序从网络驱动器运行时会崩溃？](https://stackoverflow.com/questions/148879/why-does-my-net-application-crash-when-run-from-a-network-drive)

* * *

有人能帮我吗？对于一个学校项目，我在 Visual Studio 2005 中编写了一个 C# windows 应用程序。它工作得很好，没有问题。我希望能够与我所在部门的其他人分享这个程序。因此，我将 exe 文件复制到了网络驱动器。当我们尝试从网络运行 exe 时，它​​会失败并显示“程序名称...遇到问题并需要关闭”。如果我让同事将 exe 文件复制到他们的 c:\ 驱动器然后尝试运行，它可以工作。为什么我的程序不能从网络驱动器运行？

苏珊

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-29T20:35:20.737

默认情况下，.NET 不允许应用程序在网络驱动器上运行。将其复制到本地驱动器或更改 .NET 的安全设置。

[这个讨论](https://stackoverflow.com/questions/148879/why-does-my-net-application-crash-when-run-from-a-network-drive)应该给你你需要的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T20:41:55.277

微软终于意识到阻止应用程序从网络驱动器运行的默认行为是错误的。从[.NET 3.5 SP1 下载页面](http://www.microsoft.com/downloads/details.aspx?FamilyID=AB99342F-5D1A-413D-8319-81DA479AB0D7&displaylang=en)：

“此外，通过完全信任运行，从网络共享打开的托管应用程序具有与本机应用程序相同的行为。”

这种变化早就应该发生了：阻止托管应用程序从网络共享运行几乎没有安全优势，因为黑客可以很容易地使用非托管应用程序。

# powershell - 如何在 PowerShell 中遍历数据集？

> ID：804133
> 
> 赞同：25
> 
> 时间：2009-04-29T20:32:21.383
> 
> 标签：powershell, dataset, loops

我正在尝试从 a 输出每一行的值`DataSet`：

```
for ($i=0;$i -le $ds.Tables[1].Rows.Count;$i++)
{
  Write-Host 'value is : ' + $i + ' ' + $ds.Tables[1].Rows[$i][0]
} 
```

给出输出...

```
value is :  +0+ +System.Data.DataSet.Tables[1].Rows[0][0] 
value is :  +1+ +System.Data.DataSet.Tables[1].Rows[1][0] 
value is :  +2+ +System.Data.DataSet.Tables[1].Rows[2][0] 
value is :  +3+ +System.Data.DataSet.Tables[1].Rows[3][0] 
value is :  +4+ +System.Data.DataSet.Tables[1].Rows[4][0] 
value is :  +5+ +System.Data.DataSet.Tables[1].Rows[5][0] 
value is :  +6+ +System.Data.DataSet.Tables[1].Rows[6][0] 
```

如何从列中获取实际值？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-29T23:11:10.020

PowerShell 字符串评估在 DataSet 上调用 ToString()。为了评估任何属性（或方法调用），您必须通过将表达式包含在`$()`

```
for($i=0;$i -lt $ds.Tables[1].Rows.Count;$i++)
{ 
  write-host "value is : $i $($ds.Tables[1].Rows[$i][0])"
} 
```

此外`foreach`，您还可以遍历集合或数组，而无需计算长度。

重写（和编辑编译） -

```
foreach ($Row in $ds.Tables[1].Rows)
{ 
  write-host "value is : $($Row[0])"
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-03T14:25:02.903

这是一个实际示例（从您当前位置构建数据集）：

```
$ds = new-object System.Data.DataSet
$ds.Tables.Add("tblTest")
[void]$ds.Tables["tblTest"].Columns.Add("Name",[string])
[void]$ds.Tables["tblTest"].Columns.Add("Path",[string])

dir | foreach {
    $dr = $ds.Tables["tblTest"].NewRow()
    $dr["Name"] = $_.name
    $dr["Path"] = $_.fullname
    $ds.Tables["tblTest"].Rows.Add($dr)
}

$ds.Tables["tblTest"] 
```

`$ds.Tables["tblTest"]` is an object that you can manipulate just like any other Powershell object:

```
$ds.Tables["tblTest"] | foreach {
    write-host 'Name value is : $_.name
    write-host 'Path value is : $_.path
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T21:06:25.280

解析器无法连接您的字符串。试试这个：

```
write-host 'value is : '$i' '$($ds.Tables[1].Rows[$i][0]) 
```

**编辑：**使用双引号也可能更清楚，因为您可以在带引号的字符串中包含表达式：

```
write-host "value is : $i $($ds.Tables[1].Rows[$i][0])" 
```

# java - Ant compile 不会复制资源

> ID：804150
> 
> 赞同：37
> 
> 时间：2009-04-29T20:35:35.073
> 
> 标签：java, ant

我创建了自己的 build.xml，其中包含：

```
<target name="compile">
    <mkdir dir="build"/> 
    <javac destdir="build"> 
        <src path="src"/> 
    </javac>
</target>

<target name="build" depends="compile">
    <mkdir dir="dist"/>
    <jar destfile="dist/app.jar" basedir="build" />
</target>

<target name="run" depends="compile">
    <java classname="webserver.Loader" classpath="build" fork="true" />      
</target> 
```

它工作得很好。当我调用 ant run 以编译并运行我的应用程序时，但我的应用程序有一个带有图标的包，它没有移动到“build”文件夹，所以我的应用程序以无法找到我的图标的异常结束。当我自己移动它们时，它就起作用了。

我试着用

```
<copy todir="build/app/icons">
    <fileset dir="src/app/icons"/>
</copy> 
```

它有效，但我想在没有复制命令的情况下这样做。javac有参数吗？或者是其他东西？

谢谢你的答案。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-04-29T20:41:56.883

没有这样的参数。您可以使用以下命令在目录之间复制各种文件：

```
<copy todir="build">
    <fileset dir="src"
             includes="**/*.xml,**/*.properties,**/*.txt,**/*.ico" />
</copy> 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-29T20:38:39.963

抱歉，您需要手动复制非 java 文件。资源在技术上不是“来源”。命令行 javac 不会将资源文件从源目录复制到输出目录，ant 的 javac 任务也不会。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-07-09T21:06:34.873

您可以使用任务`fileset`元素来执行此操作，`jar`而不是手动复制文件。例如：

```
<jar destfile="dist/app.jar" basedir="build">
    <fileset dir="src" includes="app/icons/**" />
</jar> 
```

这会将所有内容复制到.jar 文件`src/app/icons/`中的路径中。`app/icons`

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T20:38:54.927

不，没有。复制任务是将资源复制到构建文件夹的正确方法。

# web-applications - 如何将我的软件应用程序转换为软件设备？

> ID：804151
> 
> 赞同：2
> 
> 时间：2009-04-29T20:37:11.637
> 
> 标签：web-applications, hardware, vmware

假设我想出售一个只有我的软件的硬件设备，我需要做什么？

*   我在哪里可以找到硬件？
*   如果需要，我如何远程进入机器进行修复？

Google 曾经使用 Search Appliance 执行此操作（不知道他们是否仍然这样做）。VMWare 应该有一个像 cafepress 这样的网站，您可以在其中上传徽标、选择规格，然后给他们一张图片，然后他们会直接向您运送一个带有该图片的服务器。

对于我忘记的所有事情，鼓励对这个问题进行编辑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T20:52:11.680

Goolge 仍然有它在这里检查一下[这](http://www.google.com/enterprise/search/gsa.html) 是另一个例子，[trixbox](http://www.trixbox.com/products/appliance?utm_source=trixboxOrg&utm_medium=link&utm_content=products-appliance&utm_campaign=fonalitysites)。

你需要做出一些决定。例如：

你会提供硬件支持吗？你想定价多少？软件要求？品牌是什么？

然后建立一个原型，你可以前往[newegg.com](http://www.newegg.com)并购买一些零件。看看客户的反应，如果这是一个好主意。如果一切顺利，那么您可以联系 ODM，并检查他们需要什么来开发您的设备并推广您的品牌。

但首先，采取婴儿步骤。定义规格、设计系统、开发各种原型并查看客户的反应。实际上 VMWARE 映像可能是第一个原型，并且可能是要走的路。只需将图像卖给他们，让您的客户处理硬件即可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T20:51:03.587

在硬件方面，[MBX](http://www.mbx.com/)或[Rackable](http://www.rackable.com/)几乎可以满足您的需求。至于在部署后远程进入盒子，您需要将其作为用户设置的一部分电话回家，或者让用户在有支持电话时向您提供信息。

远程处理的实际机制取决于您使用的操作系统。Linux 将是最简单的（在我看来），因为我只需使用[autossh](http://www.harding.motd.ca/autossh/)设置一个反向 ssh 隧道到跳转主机。

您还需要充分考虑强化盒子，以及您将允许最终用户拥有的访问级别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T22:42:41.943

可能也有帮助的一件事是，您是否可以让我们知道该设备是什么？例如，有许多公司提供基于 PC 的收银台，您可以在其中安装自己的操作系统。

您还需要考虑操作系统，其中有许多可以满足您的需求，从 Windows CE 和 XP Embedded 到定制的 linux 发行版。

# c# - HttpContext.Current 表示用户的当前上下文......当前上下文是什么意思？

> ID：804155
> 
> 赞同：2
> 
> 时间：2009-04-29T20:38:22.773
> 
> 标签：c#, asp.net, security

`HttpContext.Current`返回一个`IPrincipal`表示当前用户的安全上下文的对象。我了解主体对象将用户的身份与其他信息（例如角色、权限等）结合在一起。

但是为什么我们说它代表了用户的**当前上下文**呢？为什么不直接说它代表一个用户呢？**我们使用术语当前上下文**有什么特别的原因吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T20:41:56.010

HttpContext 对象包含对许多其他有用项的访问，例如提供将路径映射到物理路径和其他路径的能力的 Server 对象。不仅仅是用户信息。

它是当前 HTTP 请求的真实上下文。这也有请求、响应和其他可用的对象。

# c# - 是否有支持命令行操作的免费 .NET 混淆器？

> ID：804158
> 
> 赞同：5
> 
> 时间：2009-04-29T20:38:40.637
> 
> 标签：c#, .net, obfuscation

是否有满足以下所有要求的 .NET 混淆器？

**严格要求：**

*   混淆器必须可以免费使用
*   混淆器必须支持命令行操作
*   混淆器本身必须用 .NET 语言编写，以便可以使用 Mono 运行

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-27T19:49:41.663

[Obfuscar](http://code.google.com/p/obfuscar/)可以免费使用，支持命令行操作，可以使用 Mono 运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-13T22:51:32.780

也试试 babel 混淆器

[http://code.google.com/p/babelobfuscator/](http://code.google.com/p/babelobfuscator/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T20:59:03.050

我想提一下[Babel 混淆](http://code.google.com/p/babelobfuscator/)器。它是开源的（较少的 GPL），但不支持 Mono。我还没有这方面的经验，但它看起来很有希望。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-16T12:08:08.930

[http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx#downloads](http://www.foss.kharkov.ua/g1/projects/eazfuscator/dotnet/Default.aspx#downloads)

# jquery - 如何使用 jQuery 从 DIV 中删除高度样式？

> ID：804161
> 
> 赞同：93
> 
> 时间：2009-04-29T20:39:37.030
> 
> 标签：jquery, html, css, layout

默认情况下，DIV 的高度由其内容决定。

但是，我覆盖它并使用 jQuery 显式设置高度：

```
$('div#someDiv').height(someNumberOfPixels); 
```

我怎样才能扭转它？我想删除高度样式并让它回到它的自动/自然高度？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2010-02-13T14:49:32.713

删除高度：

```
$('div#someDiv').css('height', '');
$('div#someDiv').css('height', null); 
```

就像约翰指出的那样，将高度设置为`auto`：

```
$('div#someDiv').css('height', 'auto'); 
```

（使用 jQuery 1.4 检查）

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2011-07-04T17:28:21.640

```
$('div#someDiv').height('auto'); 
```

我喜欢使用它，因为它与您首先明确使用 .height(val) 设置它的方式是对称的，并且可以跨浏览器工作。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2014-07-17T16:45:36.837

你可以试试这个：

```
$('div#someDiv').height(''); 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-04-29T20:53:28.290

也许像

```
$('div#someDiv').css("height", "auto"); 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-04-30T05:13:57.917

要重置 div 的高度，只需尝试

`$("#someDiv").height('auto');`

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-05-09T12:27:27.323

```
$('div#someDiv').css('height', ''); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-30T16:10:39.817

只是为了在这里添加答案，我将高度用作具有两个选项的函数，如果高度小于窗口高度，则指定高度，或者将其设置回自动

```
var windowHeight = $(window).height();
$('div#someDiv').height(function(){
    if ($(this).height() < windowHeight)
        return windowHeight;
    return 'auto';
}); 
```

如果内容小于窗口高度，我需要将内容垂直居中，否则让它自然滚动，这就是我想出的

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-01-09T23:22:51.560

感谢大家展示所有这些示例。在尝试了您的示例后，我在 480 像素以下的小型媒体屏幕上的联系页面仍然**存在问题。**引导程序不断插入`height: auto`。

Element Inspector / Devtools 将在以下位置显示高度：

```
element.style {

} 
```

就我而言，我看到的是：`section#contact.contact-container | 303 x 743`在浏览器窗口中。

因此，以下全长作品可以消除该问题：

`$('section#contact.contact-container').height('');`

* * *

## 回答 #9

> 赞同：-5
> 
> 时间：2009-04-30T05:03:06.850

```
$('div#someDiv').removeAttr("height"); 
```

# c++ - 是否有一种 STL 方法来验证（文本）文件是否首先是只读的？

> ID：804172
> 
> 赞同：2
> 
> 时间：2009-04-29T20:43:19.563
> 
> 标签：c++, stl

另外，是否有一种跨平台的方法可以将文件的属性从只读更改为可写？

非常感谢，伯特

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T20:46:34.423

查看[boost::filesystem](http://www.boost.org/doc/libs/1_38_0/libs/filesystem/doc/index.htm)。它会做你需要的。我相信这是~~将包含在下一版 C++ 中的 boost 部分之一，届时它将成为 STL 的一部分，但现在它是~~一个（免费的）第 3 方库。它是如此普遍，以至于它几乎可以被认为是标准的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T20:54:17.180

做到这一点的唯一方法是使用操作系统特定的功能——C++ 在这方面没有功能。

# regex - 如何在 lex 中选择内部匹配

> ID：804175
> 
> 赞同：0
> 
> 时间：2009-04-29T20:44:02.760
> 
> 标签：regex, syntax, flex-lexer

我是 lex 新手，我想获取特定于正则表达式的所有匹配项

例如在以下文本中：

```
/* text text

text 
text

text */

text text
/* text text text text text text

text text */ 
```

我想选择 /* 和 */ 之间的两个匹配项

但是 lex 匹配整个外部匹配并且不返回两个！我使用这个表达式：

```
\/\*(.|\n)*\*\/ 
```

如何选择内部匹配而不是整个外部匹配？谢谢你

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T20:51:42.477

```
\/\*([^*]|\n|\*+[^*/])*\*+\/ 
```

发生的事情是 * 是贪婪的——它会匹配尽可能长的字符串。前面的表达式通过确保正则表达式只有在它后面没有字符 / 时才能继续，来单独处理字符 *。这是通过使正则表达式的内部单元成为以下之一来实现的

*   一个不是 * 的字符
*   换行
*   一串 *s 后跟一个不是 / 的字符

最后，有一串 *s 后跟 /。（注意：以前的版本没有正确处理这种情况。我真的希望 flex 有 *? 运算符。）

# dom - 我可以一次性将 Ajax requestXML 对象附加到我的文档树吗？

> ID：804180
> 
> 赞同：1
> 
> 时间：2009-04-29T20:45:11.837
> 
> 标签：dom, xmlhttprequest

问候。这是我的服务器在 responseXML 对象中返回的 XML 对象：

```
<tableRoot>
   <table>
      <caption>howdy!</caption>
      <tr>
         <td>hello</td>
         <td>world</td>
      </tr>
      <tr>
         <td>another</td>
         <td>line</td>
      </tr>
   </table> 
```

现在我将此片段附加到我的文档树中，如下所示：

getElementById('entryPoint').appendChild(responseXML.firstChild.firstChild);

但是，我没有被呈现为表格，而是得到以下*文本*：

你好！helloworldanotherline

同样的结果发生在我只用 firstChild 替换 firstChild.firstChild 时。好像我只是得到了nodeValues，所有的标签都被剥离了？！我从根本上误解了 responseXML 对象应该代表什么吗？顺便说一句，如果我取出“根”标签并将innerHTML设置为responseText，这可行。
有人可以告诉我使用responseXML的正确方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-04T19:59:01.687

您将获得文本而不是表格，因为您使用纯 DOM 进行操作，并且您的响应 XML 没有名称空间声明。因此，当添加 XML 元素时，浏览器不知道您的“table”标签是来自 HTML、XUL、SVG 还是来自其他。

1）添加命名空间声明：

```
<table xmlns="http://www.w3.org/1999/xhtml"> 
```

2）您应该首先将该节点导入您的 HTML DOM 文档，而不是直接插入引用的 XML DOM 元素：

```
var element = document.importNode(responseXML.firstChild.firstChild, true);
document.getElementById('entryPoint').appendChild(element); 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:00:44.607

您可以在要插入的位置创建一个元素，而不是这样做

element.innerHTML = request.responseText

# c# - Visual Studio“发布”命令失败

> ID：804186
> 
> 赞同：6
> 
> 时间：2009-04-29T20:46:49.663
> 
> 标签：c#, asp.net, visual-studio, visual-studio-2008, publishing

我正在开发一个中等规模的 WebForms 项目。由于这里管理的特殊性，我必须将站点上传到远程服务器才能进行测试（没有本地主机测试）。我在 Visual Studio 2008 中使用“发布”命令。有时，它甚至可以工作。大多数时候，我莫名其妙地在左下角得到一个“发布失败”，没有更多细节。

我阅读的几篇 google 文章/论坛帖子建议使发布操作的目标本地文件夹对每个人都可读/可写。没有帮助。

有没有办法获得关于为什么在 VS2008 中发布失败的更多详细信息，如果没有，是否有更好的方法来进行这些部署？与实际调试相比，我花费更多时间构建/推送到 Web 服务器。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-09-16T09:36:17.607

值得检查输出窗口。我刚刚发布失败，因为我删除了 VS 之外的图像，所以 VS 抱怨找不到图像，但此信息仅显示在输出窗口中。

有关更多信息，请参阅此链接：http: [//ericvickes.com/2009/08/find-out-why-visual-studios-publish-fails/](http://ericfickes.com/2009/08/find-out-why-visual-studios-publish-fails/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T21:25:15.453

当标记（！）中有错误时，它会发生在我们身上。坏事是 VS 只会吞下错误并告诉你失败。

我的建议是使用 MSBuild 从命令行运行您的发布。它不是那么简单，但它有效（一旦你进入它）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-04T05:59:47.440

从那以后，我发现这些特定发布失败的原因是由于选中了“删除现有文件”选项。在 Windows Vista 上以非管理员帐户使用 Visual Studio 2008 可能会在尝试删除现有文件时导致权限错误。遇到 Visual Studio 没有足够权限删除的文件后，发布将静默失败。在 Vidual Studio 之外手动删除文件后，发布功能正常。

我在 Windows 7 上没有遇到过这个问题；我假设 Windows 7 中的 UAC 更改解决了这个问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-01T00:43:08.463

我主要使用 Web 表单，每天都会遇到这个问题。在我看来，当它无法删除它试图替换的文件时，发布失败。即使我没有打开任何文件，有时它仍然会失败。不知道为什么。不仅 VS 发布经常失败，而且速度也非常缓慢。我只是发布到空的本地目录并使用单独的 FTP 客户端上传文件。这是更多的工作，但有效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-01T03:20:09.117

您可能不是这种情况，但我在发布网站时看到过这种情况。如果[app_offline.htm](http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx)文件未从您的项目中排除（如果您使用此文件），则发布将失败。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-10T12:41:56.087

我也发生了同样的事情。我所做的是包含项目中未包含的图像文件并删除未使用的图像。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-02T06:56:19.087

在与类似问题苦苦挣扎约 30 分钟后，不知道是什么原因导致它关闭了 VS 并重新打开了我的项目。开始工作正常。不知道为什么，但它奏效了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-13T19:40:52.687

您应该**始终**停止在您要发布到的机器上运行的 IIS 实例。谷歌“ *iisreset* ”这个词。其他托管服务提供商，如 DiscountAsp 和 Arvixe，为您提供远程“停止”和“启动”其 IIS 上的应用程序池的工具。这是非常必要的，因为 IIS 可能已将某些文件锁定为“*正在使用*”，因此当它尝试覆盖它们时，您的发布会失败。发布完成后，只需重新启动 IIS（如果您使用的是第 3 方托管服务提供商，则从 Web 工具中按“开始”）。

当所有其他方法都失败时，请检查您的“输出”窗口（Visual Studio 底部“错误列表”右侧的选项卡）。在发布失败后滚动浏览所有内容并查找任何显示“无法添加”的内容。如果您在同一次发布中仍然看到相同的“无法添加”错误，则 ftp 进入该文件夹，手动删除有问题的文件，然后再次尝试发布。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-11-27T13:09:30.720

当我的 ProjectName.Publish.xml 文件是只读文件时，我得到了这个。一旦我从源代码管理中检查了文件，我就不再收到错误并且可以发布了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-02-20T12:04:33.517

只是为了添加到这个线程中，我发现出于某种奇怪的原因，只有 Mercurial 文件被发布到服务器，其他所有内容都没有被复制。

另一个奇怪的事情是只有**Debug**配置可用；**释放**无处可见。

在阅读了围绕 SO 的其他线程后，我发现 VS 2010 和 2012 有很多，但对于 2008 年的相同问题来说并没有太多。

我发现解决方法是删除*[solution]*。**suo**文件，然后尝试发布。这似乎完成了这项工作，尽管它需要很长时间才能完成。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-10-28T22:50:41.863

我发现并在我的情况下工作。它是使用不同版本的VS。

我最近遇到了这个问题，该解决方案在 VS2015 构建、编译和测试中完美运行。

但是，当我尝试发布时默默地失败了。 [![在此处输入图像描述](https://i.stack.imgur.com/m9Z7j.png)](https://i.stack.imgur.com/m9Z7j.png) 因此，我关闭了解决方案并使用 VS2017 打开它，它对项目/解决方案使用相同的文件结构。然后重建它并发布没有任何问题。

[![在此处输入图像描述](https://i.stack.imgur.com/VuExF.png)](https://i.stack.imgur.com/VuExF.png)

我相信它可能与VS相关并且调试起来很复杂。

如果您在本地计算机上使用多个 Vs 实例，这是一种解决方法。

# .net - 如何获取程序集的最后修改日期？

> ID：804192
> 
> 赞同：40
> 
> 时间：2009-04-29T20:48:00.630
> 
> 标签：.net, asp.net, reflection, file-properties, modified-date

我想呈现（用于内部调试/信息）程序集的最后修改日期，所以我会知道某个网站何时部署。

是否有可能通过反射得到它？

我得到这样的版本：

```
Assembly.GetExecutingAssembly().GetName().Version.ToString(); 
```

我正在寻找类似的东西——我不想打开物理文件、获取它的属性或类似的东西，因为我将在母版页中呈现它，并且不想要那种开销.

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-04-29T21:14:17.507

我将支持 pYrania 的回答：

```
System.Reflection.Assembly assembly = System.Reflection.Assembly.GetExecutingAssembly();
System.IO.FileInfo fileInfo = new System.IO.FileInfo(assembly.Location);
DateTime lastModified = fileInfo.LastWriteTime; 
```

但是添加这个：

您提到您不想访问文件系统，因为它位于您的母版页中，并且您不想为每个页面都点击额外的文件系统。所以不要，只需在应用程序加载事件中访问它一次，然后将其存储为应用程序级变量。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-30T00:21:11.070

如果您在 AssemblyInfo 中默认修订和内部版本号：

```
[assembly: AssemblyVersion("1.0.*")] 
```

您可以通过以下方式获得大致的构建日期：

```
Version version = typeof(MyType).Assembly.GetName().Version;
DateTime date = new DateTime(2000, 1, 1)
    .AddDays(version.Build)
    .AddSeconds(version.Revision * 2); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-29T21:01:23.700

这个怎么样？

```
System.Reflection.Assembly assembly = System.Reflection.Assembly.GetExecutingAssembly();
System.IO.FileInfo fileInfo = new System.IO.FileInfo(assembly.Location);
DateTime lastModified = fileInfo.LastWriteTime; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-01-10T05:22:21.263

有些人认为Assembly 不保存构建日期，但您知道他们错了，您可以从嵌入在可执行文件中的[PE 标头](http://en.wikipedia.org/wiki/Portable_Executable)中检索链接器时间戳，如下所示可能有效（我自己没有测试过代码）

```
private DateTime RetrieveLinkerTimestamp()
{
    string filePath = System.Reflection.Assembly.GetCallingAssembly().Location;
    const int c_PeHeaderOffset = 60;
    const int c_LinkerTimestampOffset = 8;
    byte[] b = new byte[2048];
    System.IO.Stream s = null;

    try
    {
        s = new System.IO.FileStream(filePath, System.IO.FileMode.Open, System.IO.FileAccess.Read);
        s.Read(b, 0, 2048);
    }
    finally
    {
        if (s != null)
        {
            s.Close();
        }
    }

    int i = System.BitConverter.ToInt32(b, c_PeHeaderOffset);
    int secondsSince1970 = System.BitConverter.ToInt32(b, i + c_LinkerTimestampOffset);
    DateTime dt = new DateTime(1970, 1, 1, 0, 0, 0);
    dt = dt.AddSeconds(secondsSince1970);
    dt = dt.AddHours(TimeZone.CurrentTimeZone.GetUtcOffset(dt).Hours);
    return dt;
} 
```

或者如果组装是您自己的更好，您可以使用以下简单易行的方法

在预构建事件命令行中添加以下内容：

```
echo %date% %time% > "$(ProjectDir)\Resources\BuildDate.txt" 
```

将此文件添加为资源，现在您的资源中有“BuildDate”字符串。

我已经从[这个问题中得到了两个答案](https://stackoverflow.com/questions/1600962/displaying-the-build-date)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-02-01T00:45:02.570

由于使用from ，该`RetrieveLinkerTimestamp`解决方案在一年后将不起作用。我建议使用以下内容（尽管这可能也有其局限性）：`2038``int32``1970`

```
IO.File.GetLastWriteTime(Reflection.Assembly.GetExecutingAssembly().Location) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-29T20:54:47.943

我不相信程序集包含最后修改的信息，因为这是操作系统属性。我相信获取此信息的唯一方法是通过文件句柄。

# sql-server - 根据日期从表中删除

> ID：804193
> 
> 赞同：43
> 
> 时间：2009-04-29T20:48:02.593
> 
> 标签：sql-server

任何人都可以帮助我使用脚本来删除早于特定日期的数据。

谢谢

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-04-29T20:49:12.653

```
delete from YOUR_TABLE where your_date_column < '2009-01-01'; 
```

这将删除`YOUR_TABLE`日期`your_date_column`早于 2009 年 1 月 1 日的行。即`2008-12-31`删除日期。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-29T20:50:33.633

删除 30 天或更早的数据

```
 DELETE FROM Table
   WHERE DateColumn < GETDATE()- 30 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-29T20:53:51.253

你可以使用：

```
DELETE FROM tableName
where your_date_column < '2009-01-01'; 
```

但请记住，以上是真的

```
DELETE FROM tableName
    where your_date_column < '2009-01-01 00:00:00'; 
```

不是

```
 DELETE FROM tableName
        where your_date_column < '2009-01-01 11:59'; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-29T20:53:50.973

或 ORACLE 版本：

```
delete
  from table_name
 where trunc(table_name.date) > to_date('01/01/2009','mm/dd/yyyy') 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-29T20:49:18.630

这很模糊。你的意思是像SQL：

```
DELETE FROM myTable
WHERE dateColumn < '2007' 
```

# asp.net - 如何让 Visual Studio 的设计器在 ASP.NET Web 用户控件中正确呈现 CSS？

> ID：804194
> 
> 赞同：1
> 
> 时间：2009-04-29T20:48:07.353
> 
> 标签：asp.net, visual-studio, designer, webusercontrol

在开发 Web 用户控件时，我使用 CSS 设置所有样式。每当我在设计器中查看控件时，都不会呈现任何 CSS，或者当然，因为我没有在我的链接元素声明到我的 CSS 文件的页面上下文中查看它。此外，Visual Studio 将包含一个警告：

> 未定义类或 CssClass 值。

对于我使用的每个类属性。

如果我在控件本身中包含一个链接元素，我可以让设计器呈现 CSS，但是我的页面中散布着重复的链接元素。

有什么方法可以让设计人员在 Web 控件中很好地使用我的 CSS，而不会到处注入重复的链接元素？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:40:42.357

可悲的是，我认为这是你在[这里看到](https://stackoverflow.com/questions/34390/how-to-make-user-controls-know-about-css-classes-in-asp-net)的最好的。

我能看到的唯一好消息是“已关闭 - 推迟”的[Connect 问题](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=290450)，所以他们很可能正在考虑它。

您遇到的问题是，您可以根据样式应用的 CSS 规则使控件显示非常不同 - 因此一个样式表或父标记的组合可以使（例如）标签出现在其表单元素上方，并且旁边的另一个 - 当您在页面上下文之外查看用户控件时，您希望显示哪个？

# apache-flex - E4X：在表达式中使用字符串作为属性名称？

> ID：804195
> 
> 赞同：2
> 
> 时间：2009-04-29T20:48:17.913
> 
> 标签：apache-flex, actionscript-3, e4x

我有一个具有这一行的函数：

```
var returnString:String = items[0].@month; 
```

@month 是 XML 节点上的一个属性，如下所示：

```
<xmlnode month="JAN"/> 
```

好的，但我需要抽象属性名称，以便我可以将字符串传递给函数并获取名称与我传递的字符串匹配的属性的内容。例如，如果我调用这个函数（“stone”）这样的函数，它会返回 items[0].@stone。我希望这很清楚。

有谁知道怎么做我所追求的？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T21:05:50.507

你会想要使用属性（'stone'）而不是@stone，它是一样的，@stone 只是一种简写方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-01T18:14:42.530

你可以这样写：

```
var attrName:String = "month";
return items[0].@[ attrName ]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-13T15:46:41.970

不仅如此，如果您想使用属性名称的变量为属性分配值，您可以这样做（尽管没有记录），如下所示：

```
  公共函数 setAttr(obj:XML, attrName:String, value:String):void{
     obj.@[attrName] = 值；
  }

```

# c# - 在 C# 中，在哪里使用“ref”在参数前面？

> ID：804196
> 
> 赞同：17
> 
> 时间：2009-04-29T20:48:54.667
> 
> 标签：c#, ref

关于“ref”和“out”参数的定义已经存在许多问题，但它们似乎是糟糕的设计。是否存在您认为 ref 是正确解决方案的情况？

似乎您总是可以做其他更清洁的事情。有人可以给我一个例子，说明这将是解决问题的“最佳”解决方案吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T20:52:22.007

在我看来，这在`ref`很大程度上弥补了声明新实用程序类型的困难以及将信息“附加”到现有信息的困难，这是 C# 自通过 LINQ、泛型和匿名类型诞生以来已采取巨大步骤解决的问题。

所以不，我认为它不再有很多明确的用例了。我认为这在很大程度上是该语言最初设计方式的遗留物。

我确实认为在您需要从函数返回某种错误代码以及返回值的情况下它仍然是有意义的（如上所述），但没有别的（所以更大的类型并不是真正合理的。 ) 如果我在一个项目的所有地方都这样做，我可能会为 thing-plus-error-code 定义一些通用的包装器类型，但在任​​何给定的实例`ref`中`out`都可以。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-29T22:10:54.953

好吧，`ref`通常用于特殊情况，但我不会将其称为冗余或 C# 的遗留功能。例如，您会看到它（和`out`）在 XNA 中被大量使用。在 XNA 中，a`Matrix`是一个`struct`并且相当大的一个（我相信 64 字节），通常最好将它传递给函数使用`ref`以避免复制 64 字节，但只有 4 或 8 个。一个专业的 C# 功能？当然。没有太多用处或表明设计不佳？我不同意。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-29T21:21:00.283

一个领域是使用小型实用功能，例如：

```
void Swap<T>(ref T a, ref T b) { T tmp = a; a = b; b = tmp; } 
```

我在这里看不到任何“更清洁”的选择。当然，这不完全是架构级别。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T20:58:03.677

P/Invoke 是我唯一能真正想到必须使用 ref 或 out 的地方。在其他情况下，它们可能很方便，但是就像您说的那样，通常还有另一种更清洁的方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-29T20:56:16.070

如果您想**返回多个对象**怎么办，由于某种未知的原因没有将它们绑定到一个对象中。

```
void GetXYZ( ref object x, ref object y, ref object z); 
```

编辑：*[divo](https://stackoverflow.com/users/40347/divo)建议使用 OUT 参数更适合于此。我不得不承认，他说得有道理。我将把这个答案留在这里，作为记录，这是一个不合适的解决方案。在这种情况下，OUT 胜过 REF。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T20:52:19.293

我认为最好的用途是您通常看到的用途；您需要同时拥有一个值和一个“成功指标”，这不是函数的例外。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T20:54:47.023

**真正的用途**是在创建结构时。C# 中的结构是值类型，因此在按值传递时总是被完全复制。如果您需要通过引用传递它，例如出于性能原因或因为函数需要对变量进行更改，您将使用 ref 关键字。

我可以查看是否有人有一个具有 100 个值的结构（显然已经存在问题），您可能希望通过引用传递它以防止 100 个值被复制。那并返回那个大结构并覆盖旧值可能会出现性能问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T22:42:57.623

一种有用的设计模式`ref`是双向访问者。

假设您有一个`Storage`可用于加载或保存各种原始类型值的类。它处于`Load`模式或`Save`模式。它有一组称为 的重载方法`Transfer`，这里有一个处理`int`值的示例。

```
public void Transfer(ref int value)
{
    if (Loading)
        value = ReadInt();
    else
        WriteInt(value);
} 
```

其他原始类型会有类似的方法 - `bool`,`string`等。

然后在需要“可转移”的类上，您将编写如下方法：

```
public void TransferViaStorage(Storage s)
{
    s.Transfer(ref _firstName);
    s.Transfer(ref _lastName);
    s.Transfer(ref _salary);
} 
```

这个相同的方法既可以从 加载字段，也可以将字段`Storage`保存到`Storage`，具体取决于`Storage`对象所处的模式。

实际上，您只是列出了所有需要传输的字段，因此它非常接近声明式编程而不是命令式编程。这意味着您不需要编写两个函数（一个用于读取，一个用于写入）并且考虑到我在这里使用的设计是依赖于顺序的，那么确定这些字段将始终被读取非常方便/以相同的顺序编写。

一般的一点是，当一个参数被标记为 时`ref`，您不知道该方法是读取它还是写入它，这允许您设计在两个方向之一工作的访问者类，旨在被调用以对称的方式（即访问方法不需要知道访问者类在哪个方向模式下运行）。

**比较：属性+反射**

为什么这样做而不是归因于字段并使用反射来自动实现等效的`TransferViaStorage`？因为有时反射慢到足以成为瓶颈（但总是要分析以确保这一点 - 这几乎不是真的，并且属性更接近声明式编程的理想）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-29T21:52:22.673

使用“ref”关键字的明显原因是当您想通过引用传递变量时。例如，将 System.Int32 之类的值类型传递给方法并更改其实际值。更具体的用途可能是当您想要交换两个变量时。

```
public void Swap(ref int a, ref int b)
{
   ...
} 
```

使用“out”关键字的主要原因是从一个方法返回多个值。就我个人而言，我更喜欢将值包装在专门的结构或类中，因为使用 out 参数会产生相当丑陋的代码。使用“out”传递的参数 - 就像“ref”一样 - 通过引用传递。

```
public void DoMagic(out int a, out int b, out int c, out int d)
{
   ...
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-23T20:16:01.240

当您必须使用“ref”关键字时，有一种明显的情况。如果对象已定义但未在您打算调用的方法范围之外创建，并且您要调用的方法应该执行`'new'`创建它，则必须使用`'ref'`. eg`{object a; Funct(a);} {Funct(object o) {o = new object; o.name = "dummy";}`不会做任何事情，`object 'a'`也不会在编译或运行时抱怨它。它只是不会做任何事情。 `{object a; Funct(ref a);} {Funct(object ref o) {o = new object(); o.name = "dummy";}`将导致`'a'`成为一个名为`"dummy`" 的新对象。但如果`'new'`已经完成，则不需要 ref （但如果提供，则可以使用）。 `{object a = new object(); Funct(a);} {Funct(object o) {o.name = "dummy";}`

# ajax - Telerik RadDock - ajax 更新返回 JSON 错误

> ID：804200
> 
> 赞同：1
> 
> 时间：2009-04-29T20:50:19.610
> 
> 标签：ajax, json, telerik, radgrid

尝试通过将其放入 UpdatePanel 来更新 RadDock（打开/关闭它）但是没有运气......我得到了以下响应。

```
189|error|500|Invalid JSON primitive: {"Top":179,"Left":583,"DockZoneID":"","Collapsed":false,"Pinned" 
```

:false,"Resizable":false,"Closed":false,"Width":"300px","Height":null,"ExpandedHeight":0,"Index":-1} .|

这是代码：

```
<asp:UpdatePanel ID="upanelDock" runat="server">
    <ContentTemplate>
        <telerik:RadDock ID="RadDock1" runat="server" Width="300px">
            <TitlebarTemplate>
                <h2>
                    this is a dock</h2>
            </TitlebarTemplate>
            <ContentTemplate>
                some content here
                <br />
                some content here
                <br />
                some content here
                <br />               
            </ContentTemplate>
        </telerik:RadDock>
    </ContentTemplate>
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="lbtnUpdate" EventName="Click" />
    </Triggers>
</asp:UpdatePanel>
<asp:LinkButton ID="lbtnUpdate" runat="server" OnClick="lbtnUpdate_Click">update</asp:LinkButton> 
```

后面的代码：

```
 protected void lbtnUpdate_Click(object sender, EventArgs e)
{

    if (this.RadDock1.Closed)
        this.RadDock1.Closed = false;
    else
        this.RadDock1.Closed = true;
} 
```

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T15:22:42.020

**更新：**您的代码没有做错任何事情。我能够使用 UpdatePanel 和 RadAjaxManager 复制这个问题。根据 Telerik 支持，这是 RadDock 控件中的“限制”。在我看来更像是一个错误。

这是他们在支持页面论坛中所说的：[克隆的非停靠码头加上无效的 JSON 原语](http://www.telerik.com/community/forums/aspnet-ajax/docking/non-docked-docks-cloned-plus-invalid-json-primitive.aspx)

> RadDock 控件不是标准控件，在通过 ajax 更新时存在一些限制。如果您想通过 ajax 更新 RadDock，您应该更新所有 RadDockZones 并且所有 RadDocks 都应该停靠。
> 
> 您遇到的错误是由于您使用 AJAX 更新了浮动 RadDock。拖动停靠栏时，您将其移到更新面板之外，这会导致 AJAX 无法正常工作，因为它试图在之前所在的位置重新创建停靠栏。这样，页面上会出现两个具有相同 id 的停靠点，这会导致异常。这是所有可以在 DOM 中移动的控件的常见问题。

通过将 RadDock 包装在 RadDockZone 中并将 DockMode 属性设置为“Docked”，我能够使您的代码正常工作。但是，如果我将扩展坞拖出该区域，使其处于浮动状态并单击“更新”按钮，错误会再次出现。

```
<asp:UpdatePanel ID="upanelDock" runat="server">
    <ContentTemplate>
       <telerik:RadDockZone runat="server">
        <telerik:RadDock ID="RadDock1" runat="server" Width="300px" 
                                                      DockMode="Docked">
            <TitlebarTemplate>
                <h2>
                    this is a dock
                </h2>
            </TitlebarTemplate>
            <ContentTemplate>
                some content here
                <br />
                some content here
                <br />
                some content here
                <br />               
            </ContentTemplate>
        </telerik:RadDock>
      </telerik:RadDockZone>
    </ContentTemplate>
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="lbtnUpdate" EventName="Click" />
    </Triggers>
</asp:UpdatePanel>
<asp:LinkButton ID="lbtnUpdate" runat="server"
           OnClick="lbtnUpdate_Click">update</asp:LinkButton> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-27T20:18:00.480

我有几个 RadDocks 漂浮在 RadDockLayout 中。如果我通过 RadAjaxManager 对象更新 RadDock、RadDockLayout 或包装 RadDockLayout 的主面板，Ajax 就可以工作。

前任：

```
<telerik:AjaxSetting AjaxControlID="RadAjaxManager1">
    <UpdatedControls>
        <telerik:AjaxUpdatedControl ControlID="mainPanel" />
    </UpdatedControls>
</telerik:AjaxSetting> 
```

# c++ - 函数模板声明顺序会影响可见性（有时）

> ID：804217
> 
> 赞同：3
> 
> 时间：2009-04-29T20:53:10.663
> 
> 标签：c++, templates, lookup, argument-dependent-lookup

我正在尝试创建一个函数：

```
template <typename T>
void doIt( T*& p )
{
   if ( !p ) { return; }
   T& ref = *p;
   getClassName( ref );
} 
```

其中行为根据`p`传入的类型而有所不同。特别是，被`getClassName`调用的版本应该取决于`p`. 在以下示例中，我可以成功调用：

```
doIt<myClass1>( myClass1*& )
doIt<myClass1<int> >( myClass1*& )
doIt<myClass2>( myClass2*& )
doIt<myClass2<int> >( myClass2*& ) 
```

但是当我打电话时它失败了：

```
doIt< std::vector<int, std::allocator<int> > >( std::vector<int, std::allocator<int>>*& ) 
```

出现错误：

```
a.cxx: In function ‘void doIt(T*&) [with T = std::vector<int, std::allocator<int> >]’:
ba.cxx:87:   instantiated from here
a.cxx:33: error: invalid initialization of reference of type ‘MyClass1&’ from expression of type ‘std::vector<int, std::allocator<int> >’
a.cxx:16: error: in passing argument 1 of ‘const char* getClassName(MyClass1&)’ 
```

（GCC 4.2.4）。

如果我移动以下声明：

```
template<typename T, typename A>
char const* getClassName( std::vector<T,A>& ) { printf("std::vector<T,A>\n"); return NULL; } 
```

在 doIt 之前 - 然后它编译。所以，

*   为什么需要`getClassName( std::vector<T,A>& )`出现在之前`doIt`而不是`getClassName( MyClass2T<T>& )`
*   我该怎么做才能`doIt`独立`std::vector`？（我希望能够放置`doIt`在自己的标题中，而不必了解`std::vector`或任何专业化，这将是用户定义的）。

.

```
#include <stdio.h>
#include <assert.h>
#include <vector>

//template<typename T>
//char const* getClassName( T& );

//template<typename T, typename A>
////char const* getClassName( std::vector<T,A>& ) { printf("std::vector<T,A>\n"); return NULL; }

#if 1
// ---------  MyClass2
struct MyClass1
{};

char const* getClassName( MyClass1& ) { printf("MyClass1\n"); return NULL; }

// ---------  MyClass1T
template< typename T>
struct MyClass1T
{};

template<typename T>
char const* getClassName( MyClass1T<T>& ) { printf("MyClass1T<T>\n"); return NULL; }
#endif

template <typename T>
void doIt( T*& p )
{
   if ( !p ) { return; }
   T& ref = *p;
   getClassName( ref );
}

// ---------  MyClass2
struct MyClass2
{};

// declared after doIt, OK.
char const* getClassName( MyClass2& ) { printf("MyClass2\n"); return NULL; }

// ---------  MyClass2T
template< typename T>
struct MyClass2T
{};

// declared after doIt, OK.
template<typename T>
char const* getClassName( MyClass2T<T>& ) { printf("MyClass2T<T>\n"); return NULL; }

template<typename T, typename A>
char const* getClassName( std::vector<T,A>& ) { printf("std::vector<T,A>\n"); return NULL; }

void test()
{
#if 1
   MyClass1 mc1;
   MyClass1* mc1p = &mc1;
   doIt( mc1p );

   MyClass2 mc2;
   MyClass2* mc2p = &mc2;
   doIt( mc2p );

   MyClass1T<int> mc1t;
   MyClass1T<int>* mc1tp = &mc1t;
   doIt( mc1tp );

   MyClass2T<int> mc2t;
   MyClass2T<int>* mc2tp = &mc2t;
   doIt( mc2tp );

   // Nested templates are OK.
   MyClass2T<MyClass1> mc2t2;
   MyClass2T<MyClass1>* mc2tp2 = &mc2t2;
   doIt( mc2tp2 );
#endif

#if 1
   std::vector<int> v;
   std::vector<int>* vp = &v;
   doIt( vp );                   // FAIL!
#endif
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T21:05:16.017

> 为什么要求 getClassName( std::vector& ) 出现在 doIt 之前而不是 getClassName( MyClass2T& )

任何函数都需要范围内的声明。当您使用 a 实例化模板函数时，`vector<int>`它期望存在具有签名的函数`getClassName(vector<int>&)`（至少是原型）以使编译成功。

> 我该怎么做才能使 doIt 独立于 std::vector？（我希望能够将 doIt 放在它自己的标题中，而不必了解 std::vector 或任何用户定义的专业化）

阅读[有关模板的常见问题解答](http://www.parashift.com/c++-faq-lite/templates.html)。尝试将所有`doIt`依赖模板函数的原型放在`doIt`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T23:05:08.287

失败的原因是在实例化时，没有发生对函数的非限定名称查找（但只有 ADL - Argument Dependent Lookup）。实例化上下文是（取自`14.6.4.1/6`C++ 标准）：

> 依赖于模板参数的表达式的实例化上下文是在同一翻译单元中模板特化的实例化点之前声明的具有外部链接的声明集。

在这种情况下，您调用的所有模板特化的实例化点就在`test`(read `14.6.4.1/1`) 的定义之后。因此，您声明的所有函数在`test`使用非限定查找的函数中都是可见的，但是对于函数调用，它们的查找实际上是不同的：

在模板中查找依赖于模板参数的函数调用如下：

*   来自模板定义上下文的名称被普通查找和 ADL 考虑。
*   实例化上下文中的名称仅适用于 ADL。

这意味着因为`getClassName`在模板的定义上下文中没有声明合适的函数，所以必须使用 ADL 在实例化上下文中找到合适的函数 - 否则调用将失败并且找不到任何声明。

### 参数相关查找 (ADL)

对于类型的参数`std::vector<T>`，ADL 搜索命名`std`空间中的函数和`T`. 将`getClassName`函数放入`std`命名空间将为此工作（但标准不允许这样做，因为这会导致未定义的行为 - 这应该仅作为最后的手段）。

要查看`ADL`尝试`doIt`使用向量`MyClass2`而不是调用的效果`int`。从那时起`T = MyClass2`，ADL 将在命名空间中搜索`MyClass2`接受 a 的合适函数`std::vector<MyClass2>`并成功 - 与您使用时相反`int`，它只会查找`std`。

对于其他函数调用，也都找到了它们各自的声明，因为它们都声明在全局命名空间中，其中也定义了函数调用的参数类型（`MyClass1`等`MyClass2`）。

C++ FAQ 很好，但它没有深入到模板中（没有发现任何关于 ADL 的提及）。有一个专门的[模板常见问题解答](http://womble.decadentplace.org.uk/c++/template-faq.html)可以处理一些更复杂的陷阱。

* * *

### 小心未定义的行为

请注意，即使您将我显示的声明放在函数之后（而不是之前），许多编译器也会接受*代码*`test`。但是正如上面的标准引用所说，那么声明将不会成为实例化上下文的一部分，并且`14.6.4.2/1`要观察其中的规则：

> 如果调用格式错误或找到更好的匹配，则在关联命名空间中的查找考虑所有翻译单元中这些命名空间中引入的具有外部链接的所有函数声明，而不仅仅是考虑在模板定义和模板中找到的那些声明实例化上下文，则程序具有未定义的行为。

因此，似乎起作用的是未定义的行为。编译器接受它是有效的，但拒绝它或崩溃和终止也同样有效。因此请注意，在实例化上下文中确实可以看到所需的任何名称，如解释的那样。

希望这可以帮助。

# sql - 访问查询？

> ID：804219
> 
> 赞同：0
> 
> 时间：2009-04-29T20:53:22.770
> 
> 标签：sql, ms-access

我在 MS-Access 中有两个表，U 和 R。我已将它们连接在一起并想比较两个字段。但是，因为两者都有 X 个标签来比较，所以我得到 X 行。正如您在 ID 4 和 2 上看到的，每个表中有两个标签，它们都是相同的，但是由于我的查询，我得到了四行，因为它比较了所有组合。我确实将唯一值设置为是。对于以下示例，我如何才能使这项工作仅返回两行。

```
ID  U Tag1   R Tag2  Comp
1   100XX7   100XX7  SAME
2   11646L   11644   DIFFERENT
2   11646L   1X05X   DIFFERENT
2   15650    11644   DIFFERENT
2   15650    1X05X   DIFFERENT
3   5981X    598X0   DIFFERENT
4   19103    19103   SAME
4   19103    19X95   DIFFERENT
4   19X95    19103   DIFFERENT
4   19X95    19X95   SAME 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T23:00:20.607

您是否正在寻找以下方面的内容：

```
SELECT u.ID, u.Tag, r.ID, r.Tag
FROM u INNER JOIN r ON (u.ID = r.ID) AND (u.Tag = r.Tag)

UNION ALL

SELECT u.ID, u.Tag, r.ID, r.Tag
FROM u LEFT JOIN r ON (u.ID = r.ID) AND (u.Tag = r.Tag)
WHERE r.Tag Is Null 
```

第一部分显示匹配的标签，第二部分（Union All 之后）显示 u 中未在 r 中找到的标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:04:02.540

添加一个

`GROUP BY id, U.Tag1, R.Tag2, (Comp? perhaps if you need that in your output)`

您现在使用的任何查询的子句:)

# c# - 泛型问题

> ID：804237
> 
> 赞同：0
> 
> 时间：2009-04-29T20:56:20.577
> 
> 标签：c#, generics

我会让标题更具体，但我不知道该怎么说。我试图推断泛型泛型的类型。

```
public class BaseAction<T>
{
   public virtual void Commit(T t1, T t2){ //do something };
}

public class SpecificAction : BaseAction<int>
{
   // I would have specific code in here dealing with ints
   // public override void virtual Commit(int t1, int t2)
}

public static class DoSomething
{
    // this obviously doesn't compile
    // I want this method to know what K is based off of T.
    // eg. T is SpecificAction of type BaseAction<int>
    // can I get int from T ?
    public static void Execute<T>(K oldObj, K newObj) where T : BaseAction<K>, new()
    {
        T action = new T();
        action.Commit(oldObj, newObj);
    }
} 
```

我希望能够用有用的智能感知写出这样的东西。是否可以？

```
DoSomething.Execute<SpecificAction>(5,4); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T21:04:28.343

我认为您可以实现的最佳情况是这样的：

```
public static class DoSomething
{
    public static void Execute<T,K>(K oldObj, K newObj) 
                                      where T : BaseAction<K>, new()
    {
        T action = new T();
        action.Commit(oldObj, newObj);
    }
} 
```

你必须指定：

```
DoSomething.Execute<SpecificAction, int>(5,4); 
```

我怀疑会有一种编译时方法来推断基类的泛型参数。

我有另一个想法（我不建议，但为了记录）：

```
public static void Execute<T, K>(Func<T> constructor, K oldObj, K newObj) 
                            where T : BaseAction<K> // no `new()` necessary
{
    T action = constructor();
    action.Commit(oldObj, newObj);
} 
```

您可以使用：

```
DoSomething.Execute(() => new SpecificAction(), 4, 5); 
```

# java - Java：循环泛型类型关系不允许从超类型进行强制转换（javac 错误）

> ID：804247
> 
> 赞同：5
> 
> 时间：2009-04-29T20:59:05.080
> 
> 标签：java, generics, casting, types

我遇到了 Java 编译器的一个完全奇怪的行为。**当涉及循环泛型类型关系**
时，我不能将超类型转换为子类型。

 ****JUnit 测试用例**重现问题：

```
public class _SupertypeGenericTest {

    interface ISpace<S extends ISpace<S, A>, A extends IAtom<S, A>> {
    }

    interface IAtom<S extends ISpace<S, A>, A extends IAtom<S, A>> {
    }

    static class Space
            implements ISpace<Space, Atom> {
    }

    static class Atom
            implements IAtom<Space, Atom> {
    }

    public void test() {
        ISpace<?, ?> spaceSupertype = new Space();
        IAtom<?, ?> atomSupertype = new Atom();

        Space space = (Space) spaceSupertype;  // cast error
        Atom atom = (Atom) atomSupertype;  // cast error
    }
} 
```

**编译器错误输出：**

```
_SupertypeGenericTest.java:33: inconvertible types
found   : pinetag.data._SupertypeGenericTest.ISpace<capture#341 of ?,capture#820 of ?>
required: pinetag.data._SupertypeGenericTest.Space
                Space space = (Space) spaceSupertype;
                                    ^

_SupertypeGenericTest.java:34: inconvertible types
found   : pinetag.data._SupertypeGenericTest.IAtom<capture#94 of ?,capture#48 of ?>
required: pinetag.data._SupertypeGenericTest.Atom
                Atom atom = (Atom) atomSupertype;
                                ^
2 errors 
```

注意：我使用的是 Netbeans 最新的主干、捆绑的 Ant、最新的 Java 6 版本。
我尝试从命令行使用 Ant（Netbeans 生成一个 build.xml 文件），但它会导致相同的错误。

**怎么了？**
有没有优雅的方法解决问题？

奇怪的是：Netbeans 不会在给定代码中标记错误（甚至没有警告）。

**编辑：**
不，现在我**什么都**不懂！
Eclipse 3.4.1 既不标记警告也不标记错误，并且编译代码没有问题！！！
怎么会这样？我认为，从命令行使用 Ant 以及 Netbeans 提供的 build.xml 将是中立的。
**我错过了什么吗？**

**编辑 2：**
使用**JDK7**库和 JDK7 代码格式，netbeans 编译没有错误/警告！
**（我使用的是 1.7.0-ea-b55）**

**编辑 3：**
更改标题以表明我们正在处理 javac 错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T21:24:31.447

我并没有声称很容易理解那些复杂的泛型类型，但是如果您发现某些代码可以`javac`在（eclipse 编译器）中编译和不编译，那么请向[Sun](http://bugs.sun.com/)和[Eclipse](https://bugs.eclipse.org/bugs/)`ecj`提交错误报告并清楚地描述情况（最好如果您还提到您提交了两个错误报告并提及了它们各自的 URL，尽管对于 Sun 可能需要一段时间才能公开访问该错误）。

我过去做过，并且在哪里得到了很好的回应

1.  其中一个团队弄清楚了正确的方法是什么（给出编译错误、警告或什么都没有）
2.  并且修复了错误的编译器

由于两个编译器都实现了相同的规范，因此如果只有一个编译器编译代码，那么其中一个根据定义是错误的。

作为记录：

我尝试使用`javac`(javac 1.6.0_13) 和`ecj`(Eclipse Java Compiler 0.894_R34x, 3.4.2 release) 编译示例代码并`javac`大声抱​​怨并未能生成任何`.class`文件，而`ecj`只抱怨一些未使用的变量（警告）并生成了所有预期的`.class`文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:14:00.333

我最终为此使用了非泛型：

```
 @Test
    public void test() {
            ISpace spaceSupertype = new Space();
            IAtom atomSupertype = new Atom();

            Space space = (Space) spaceSupertype;  // ok
            Atom atom = (Atom) atomSupertype;  // ok
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:36:43.757

是什么阻碍了您使用没有通配符的类型？

```
public void test() {
    ISpace<Space, Atom> spaceSupertype = new Space();
    IAtom<Space, Atom> atomSupertype = new Atom();

    Space space = (Space) spaceSupertype;  // no error
    Atom atom = (Atom) atomSupertype;  // no error
} 
```

这样它读起来更清晰，而且它可以编译和运行:)我认为这将是“一种解决问题的优雅方式”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-02T01:48:26.990

问题可能是您正在尝试转换`IAtom<?, ?>`为`Atom`（这是一个`Atom<Atom, Space>`）。系统到底是如何知道`?`可能是 Atom 和 Space 的？

当您不知道要在泛型填充的位置插入的类型时，您通常会省略整个内容，例如

```
ISpace spaceSupertype = new Space(); 
```

这会生成编译器警告（不是错误），但您的代码仍将执行（尽管如果实际类型不兼容，您将收到运行时错误）。

不过，这整件事看起来没有意义。你说你需要强类型，然后你坚持`?`类型去哪里。然后你转身尝试施放它们。

如果您需要能够将它们投射到 Space 和 Atom，您可能应该从使用它们开始。如果你不能，因为你最终会在这些变量中加入其他类型，那么当你改变运行时类型时，你的代码将会崩溃，除非你使用一堆 if/then 语句（比如在本评论结束）。

不过，真的，如果你在做这么奇怪的事情，我认为我们正在寻找糟糕的代码设计。重新考虑你是如何构建这个的。也许您需要其他类或接口来实现您在此处获得的功能。

问问自己，“我真的需要强类型吗？它对我有什么好处？” 由于您使用的是接口，因此最好不要添加字段。（请记住，如果仅通过方法访问字段，那么您只是将方法添加到公共接口。）如果它添加方法，那么使用单个接口`IAtom`，`ISpace`这是一个坏主意，因为您只能`test()`无论如何都要与该子类型一起使用。`test()`不会推广到`ISpace`/的其他实现`IAtom`。如果您将在此处放入的所有实现都具有您需要的相同方法，`test()`但并非所有`IAtom`/的实现`ISpace`都具有它们，则您需要一个中间子接口：

```
public interface IAtom2 extends IAtom
{
    [additional methods]
} 
```

然后你可以使用`IAtom2`而不是`IAtom`in `test()`。然后你会自动得到你需要的类型并且不需要泛型。请记住，如果一组类都有一个公共的公共接口（一组方法和字段），那么该公共接口是超类型或接口的一个很好的候选者。我所描述的是类似于平行四边形、矩形、正方形的关系，您试图跳过矩形部分。

如果您不打算重新设计，另一个想法是您放弃循环泛型并通过以下方式进行实例测试`instanceof`：

```
if (spaceSupertype instanceof Space)
{
    Space space = (Space)spaceSupertype;
    ...
}
else
... 
```

# asp.net - 为什么这个 div 不能正确浮动？

> ID：804249
> 
> 赞同：1
> 
> 时间：2009-04-29T21:00:04.187
> 
> 标签：asp.net, html, css

我有两个列表框和两个按钮。每个列表框都在自己的 div 中，两个按钮在自己的 div 中。一个列表框应该在左边，两个按钮应该在右边，另一个列表框在按钮的右边。这是我正在使用的标记，但它将第二个列表框放在“删除”按钮下方。

```
<p>Available Colors</p>
    <div style="float:left; margin:5px;">
        <asp:ListBox ID="lstAvailableColors" runat="server"></asp:ListBox>
    </div>
    <div>
        <asp:Button ID="btnAdd" runat="server" Text="Add" /><br />
        <asp:Button ID="btnRemove" runat="server" Text="Remove" />
    </div>
    <div style="margin:5px;">
        <asp:ListBox ID="lstSelectedColors" runat="server"></asp:ListBox>
    </div> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T21:02:22.997

您可能应该将它们全部浮动以获取您描述的布局。`div`s 默认使用块显示渲染，如果你不浮动它们，它将在#2 和#3 之间放置一个换行符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T21:04:12.370

将所有三个 div 浮动到左侧。

此外，您必须为浮动元素设置显式宽度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:06:45.280

带有列表框的第一个 div 将向左浮动，其他 div 将占用页面上的剩余空间，该空间将位于向左浮动的 div 的右侧。

它是您需要的 3 列布局吗？如果是这样，你需要这样的东西

```
<div style="float:left; width:66%">
    <div style="float:left; width:50%"></div> 
    <div style="float:right; width:50%"></div> 
</div>
<div style="float:right; width:33%"></div> 
```

# c# - 使用 Linq 获取目录结构？

> ID：804251
> 
> 赞同：1
> 
> 时间：2009-04-29T21:01:13.310
> 
> 标签：c#, .net, linq

我有一个应用程序，我可以在其中获取计算机上的驱动器列表，当您选择一个时，我会使用目录和文件填充树控件。

我正在考虑尝试使用 linq 循环每个目录并获取其子目录。

有没有人做过这样的事情？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T21:12:58.900

这是一个如何做到这一点的示例：**[Using-LINQ-to-access-the-file-system](http://devlicio.us/blogs/derik_whittaker/archive/2008/03/30/using-linq-to-access-the-file-system.aspx)**

这是另一个：[How-to-search-the-file-system-using-linq-queries](http://www.dev102.com/2008/07/15/how-to-search-the-file-system-using-linq-queries/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T21:16:51.167

您可以毫无问题地使用 LINQ，尽管这是一项足够简单的任务，文件系统相关的代码可能比 LINQ 相关的代码长：

```
 private static TreeNode AddDirectory(DirectoryInfo directory)
{
    DirectoryInfo[] subdirs = directory.GetDirectories();
    FileInfo[] files = directory.GetFiles();
    IEnumerable<TreeNode> subdirNodes = from subdir in subdirs select AddDirectory(subdir);
    IEnumerable<TreeNode> fileNodes = from file in files select new TreeNode(file.Name);
    return new TreeNode(
        directory.Name, 
        subdirNodes.Concat(fileNodes).ToArray());
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T07:11:10.710

顺便说一句 - 您可能有兴趣知道 .NET 4.0 正在内置支持 LINQ 的文件操作（显然是适当的懒惰操作 - 不只是迭代数组）。[在此BCL 团队博客](http://blogs.msdn.com/bclteam/archive/2008/11/04/what-s-new-in-the-bcl-in-net-4-0-justin-van-patten.aspx)条目中查找“文件系统枚举改进” 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T07:58:17.273

通常，当 UI 显示文件和文件夹树时，它不会一次扫描整个层次结构。相反，它为扩展的节点收集足够的信息。然后，当用户展开一个节点时，它会努力找出需要放置在该节点下的内容。

原因很简单，因为许多人的系统驱动器上的文件和目录的数量可能会变得非常大，因此如果他们要求查看驱动器 C: 的根目录，您的应用程序将冻结一段时间。

根据您使用的是 WPF 还是 Windows 窗体，它会略有不同。在 WPF 中，Expanded 事件在其`TreeViewItem`自身上，而在 Windows 窗体中，有几个展开事件`TreeView`（并且没有事件 on `TreeNode`）。但模式大致相同。

添加代表文件夹的树节点时，请在其下创建一个虚拟节点。给它一些特殊的标识（Tag 属性中的特殊标志，或者可能是包含无效文件系统字符的唯一名称）。这将允许用户展开该节点。然后在您的扩展事件处理程序中，查看第一个子节点 - 如果它是特殊的虚拟节点，请将其删除，然后为该节点创建真正的子节点集。这将确保每个目录只收集一次真实节点。

这是 WPF 的一个粗略想法：

```
TreeViewItem folderNode = new TreeViewItem { Header = Path.GetFileName(folderPath) };
parentNode.Items.Add(folderNode);

// create the dummy item under it
TreeViewItem dummy = new TreeViewItem { Tag = _dummyTag };
folderNode.Items.Add(dummy);

folderNode.Expanded += delegate
    {
        if (folderNode.Items.Count == 1)
        {
            if (((TreeViewItem)folderNode.Items[0]).Tag == _dummyTag)
            {
                folderNode.Items.Clear();
                CreateFolderChildren(folderNode, folderPath);
            }
        }
    }; 
```

_dummyTag 可以只是一个字段：

```
private static readonly object _dummyTag = new object(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T08:05:17.210

让我再次拉皮条我的[树扩展](http://xacc.wordpress.com/2009/03/05/tree-traversal-extension-methods/):)

样本：

```
var di = new DirectoryInfo("foo");
var q = di.TraverseDepthFirst( x => x.GetFiles(), x => x.GetDirectories());
var nq = from fs in q
         from f in fs
         select f;

foreach (FileInfo dirfiles in nq)
{
  ...
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-12T19:13:40.793

如果您使用 GetFiles，您将启动一个返回数组的阻塞操作。如果您改为使用[EnumerateFiles](http://msdn.microsoft.com/en-us/library/dd413232.aspx)，您将获得延迟评估，允许您在所有文件从文件系统返回之​​前开始工作。更多 LINQy。

例如：

```
var files = directory.EnumerateFiles();
foreach (var file in files)
{
    // do stuff
} 
```

# javascript - 如何将 target="_blank" 添加到指定 div 中的链接？

> ID：804256
> 
> 赞同：66
> 
> 时间：2009-04-29T21:02:16.443
> 
> 标签：javascript, hyperlink, external-links

假设我有以下代码：

```
<div id="link_other">
    <ul>
        <li><a href="http://www.google.com/">google</a></li>
        <li>
            <div class="some_class">
                dsalkfnm sladkfm
                <a href="http://www.yahoo.com/">yahoo</a>
            </div>
        </li>
    </ul>
</div> 
```

在这种情况下，JavaScript 将添加`target="_blank"`到 div 中的所有链接`link_other`。

我怎样才能使用 JavaScript 做到这一点？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-04-29T21:28:22.560

```
/* here are two different ways to do this */
//using jquery:
$(document).ready(function(){
  $('#link_other a').attr('target', '_blank');
});

// not using jquery
window.onload = function(){
  var anchors = document.getElementById('link_other').getElementsByTagName('a');
  for (var i=0; i<anchors.length; i++){
    anchors[i].setAttribute('target', '_blank');
  }
}
// jquery is prettier. :-) 
```

您还可以添加一个标题标签来通知用户您正在这样做，以警告他们，因为正如已经指出的那样，这不是用户所期望的：

```
$('#link_other a').attr('target', '_blank').attr('title','This link will open in a new window.'); 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-04-29T21:08:37.770

非jquery：

```
// Very old browsers
// var linkList = document.getElementById('link_other').getElementsByTagName('a');

// New browsers (IE8+)
var linkList = document.querySelectorAll('#link_other a');

for(var i in linkList){
 linkList[i].setAttribute('target', '_blank');
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-29T21:26:04.500

请记住，Web 开发人员和可用性专家通常认为这样做是不好的做法。Jakob Nielson 对取消对用户浏览体验的控制有这样的说法：

> 尽可能避免产生多个浏览器窗口——将“后退”按钮从用户手中移开会让他们的体验变得如此痛苦，以至于它通常远远超过你试图提供的任何好处。支持生成第二个窗口的一个常见理论是它可以防止用户离开您的网站，但具有讽刺意味的是，它可能会产生相反的效果，因为它会阻止他们在他们想要的时候返回。

我相信这是 W3C 从 XHTML 1.1 规范中删除 target 属性的理由。

如果您执意采用这种方法，Pim Jager 的解决方案很好。

一个更好、对用户更友好的想法是将图形附加到所有外部链接，向用户表明点击链接会将它们带到外部。

你可以用 jquery 做到这一点：

```
$('a[href^="http://"]').each(function() {
    $('<img width="10px" height="10px" src="/images/skin/external.png" alt="External Link" />').appendTo(this)

}); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-29T21:04:20.590

使用 jQuery：

```
 $('#link_other a').each(function(){
  $(this).attr('target', '_BLANK');
 }); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-03-15T15:09:24.887

我将它用于每个外部链接：

```
window.onload = function(){
  var anchors = document.getElementsByTagName('a');
  for (var i=0; i<anchors.length; i++){
    if (anchors[i].hostname != window.location.hostname) {
        anchors[i].setAttribute('target', '_blank');
    }
  }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-16T20:17:47.320

排队：

```
$('#link_other').find('a').attr('target','_blank'); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-09-24T12:27:35.273

将此用于每个外部链接

```
$('a[href^="http://"], a[href^="https://"]').attr('target', '_blank'); 
```

# django-models - 为什么 mysql 忽略在这个简单的连接查询中使用的“明显”键？

> ID：804258
> 
> 赞同：5
> 
> 时间：2009-04-29T21:02:43.433
> 
> 标签：django-models, mysql, indexing

我有我认为是一个简单的查询，但它需要“永远”。我对 SQL 优化不是很好，所以我想我可以问你们。

这是查询，带有解释：

```
EXPLAIN SELECT *
    FROM `firms_firmphonenumber`
    INNER JOIN `firms_location` ON (
        `firms_firmphonenumber`.`location_id` = `firms_location`.`id`
    )
    ORDER BY
         `firms_location`.`name_en` ASC,
         `firms_firmphonenumber`.`location_id` ASC LIMIT 100; 
```

结果：

```
id, select_type,       table,           type,  possible_keys,                     key,                           key_len, ref, rows, Extra
1,  'SIMPLE',     'firms_location',    'ALL',  'PRIMARY',                        '',                            '',             '', 73030, 'Using temporary; Using filesort'
1,  'SIMPLE', 'firms_firmphonenumber', 'ref', 'firms_firmphonenumber_firm_id', 'firms_firmphonenumber_firm_id', '4', 'citiadmin.firms_location.id', 1, '' 
```

公司位置上的键：

```
Keyname                 Type    Unique  Packed  Field   Cardinality
PRIMARY                    BTREE    Yes     No      id      65818
firms_location_name_en     BTREE    No      No      name_en 65818 
```

公司_公司电话号码上的键：

```
Keyname                     Type  Unique Packed  Field       Cardinality
PRIMARY                         BTREE Yes    No      id          85088
firms_firmphonenumber_firm_id   BTREE No     No      location_id 85088 
```

似乎（对我来说）mySQL 拒绝使用firms_location 表的主键——但我不知道为什么。

任何帮助将*不胜*感激。

* * *

## 发布解决方案后编辑

使用更改的顺序：

```
EXPLAIN SELECT *
    FROM `firms_firmphonenumber`
    INNER JOIN `firms_location` ON (
        `firms_firmphonenumber`.`location_id` = `firms_location`.`id`
    )
    ORDER BY
         `firms_location`.`name_en` ASC,
         `firms_location`.id ASC LIMIT 100;
         #`firms_firmphonenumber`.`location_id` ASC LIMIT 100; 
```

结果：

```
"id","select_type","table","type","possible_keys","key","key_len","ref","rows","Extra"
1,"SIMPLE","firms_location","index","PRIMARY","firms_location_name_en","767","",100,""
1,"SIMPLE","firms_firmphonenumber","ref","firms_firmphonenumber_firm_id","firms_firmphonenumber_firm_id","4","citiadmin.firms_location.id",1,"" 
```

为什么它现在决定使用这些？mySQL 做出了一些奇怪的选择......任何见解都会再次帮助:)

* * *

## 使用 django 的详细信息进行编辑

最初，我有这些（缩写）模型：

```
class Location(models.Model):
    id = models.AutoField(primary_key=True)
    name_en = models.CharField(max_length=255, db_index=True)
    class Meta:
        ordering = ("name_en", "id")

class FirmPhoneNumber(models.Model):
    location = models.ForeignKey(Location, db_index=True)
    number = PhoneNumberField(db_index=True)
    class Meta:
        ordering = ("location", "number") 
```

更改 Locaion 类的 Meta.ordering 字段以`("name_en", )`修复查询，使其不具有虚假排序依据。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T21:08:58.393

这些事情往往是反复试验，但请尝试根据公司_location.id 而不是公司_公司电话号码.location_id 进行排序。它们是相同的值，但 MySQL 可能会选择索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T21:10:33.977

它正在使用它来连接；这就是列`'citiadmin.firms_location.id'`中的值`ref`。它没有出现，`possible_keys`因为`key`您没有 WHERE 子句，它只反映它可用于 ORDER BY 子句的键。

如果您想加快查询速度，请尝试索引`name_en`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T08:38:04.197

因为没有where，并且因为join field的基数比joining field的基数高，所以它计算它还不如得到所有东西。在连接上使用索引不会加快速度，因此它采用了使用索引进行排序的较小优化。

首先，您可以使用 USE 强制它使用您指定的索引。此外，尝试进行优化以确保正确估计基数。（我猜你正在使用 INNO，它在一系列随机“潜水”中估计它；如果这是实际上知道的 MyISAM，那么我想知道为什么基数看起来像这样。）

不要费心索引名称等。MySQL每次连接每个表只使用一个索引，永远，索引只会增加它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T21:07:03.780

多少数据？如果只有几行，无论您有什么索引，大多数数据库都只会进行表扫描

# sql-server - 钻石关系表的最佳实践和/或建议（Linq to SQL）

> ID：804260
> 
> 赞同：0
> 
> 时间：2009-04-29T21:03:11.107
> 
> 标签：sql-server, linq, sql-server-2005, linq-to-sql

我必须将 4 个表的内容从旧数据库导入 SQL 2005 以便于报告。

**Products**包含 id 和产品名称，**ProductProperties**包含每个产品的可变数量的属性，**Ingredients**包含每个产品的可变数量的成分，并且**IngredientProperties**包含与产品相同的属性，为每种成分指定。

[替代文字 http://www.freeimagehosting.net/uploads/15068ece48.png](http://www.freeimagehosting.net/uploads/15068ece48.png)

我用黑色标记了当前设计中的表之间的关系，用红色和绿色标记了**IngredientProperties**表的可能外键。

目前，我正在从 给定**IdProduct的****IngredientProperties**中检索所有行并从中生成报告，但我想使用外键来允许将来更新数据。

 **为了更好地与 Linq 一起使用，推荐的**IngredientProperties**表的关系设计是什么？

两个样本报告：

```
// IdProduct = 1

        Price  Density
A1   25       10
A2   56       14

// IdProduct = 2

        Price  Density  Opacity
B1   87       21          60
B2   50       31          70
B3   12       10          90 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-13T23:10:04.617

*您的红色箭头表示产品在IngredientProperties*中不能有任何行，除非该产品在*ProductProperties*中至少有一个匹配行。在产品具有密度之前，产品的成分不能具有密度是否有意义？只有“黑色箭头”FK 不存在此限制。

（重复每种产品的特性是否有意义？成分 A1 的密度、不透明度或价格是否会因所加入的产品而异？）

*从成分*属性到*成分*的 FK是有意义的，但它应该是一个聚合键，而不是两个单独的 FK，这意味着*成分*上的 PK也应该是一个聚合键，这同样适用于*ProductProperties*。

编辑：

感谢更新。正如我之前暗示的那样，添加外键以匹配图表中的红色/绿色箭头将在数据库中创建当前不存在的约束，这反过来可能会破坏使用数据库的现有代码，例如，插入到*ProductProperties*之前插入成分。

通过使用聚合键，您基本上是在说成分表中只能存在一个（ *ProdID*、*IngredientID ）。*看起来这已经完成了。如果带圆圈的标题项指示索引，则数据已经索引良好。

实际上，我怀疑“顶部”红色箭头不正确。有两个*PropertyKey*行，但我认为它们代表的不是同一件事，因为每个表中都有一个单独的*PropertyValue*。一对代表产品的属性，另一对代表成分的其他属性，因此将它们联系在一起只会引起混淆。

我仍然不能 100% 确定您在寻找什么，但以下是我的建议：

1.  在每个表上设置（或保留）PK/索引，如带圆圈的标题项所示。
2.  设置 FK 以匹配 Ingredients 和*PropductProperties*中的黑色箭头。
3.  设置 FK 以匹配绿色箭头。

索引是表之间高效连接查询所需的全部。外键用于维护“参照完整性”。例如，它们会阻止您为不存在的成分插入属性。

你也可以做几件事来规范这个数据库，但除非你有需要修复的特定问题，否则我不会更改它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-14T16:40:43.167

看起来您的`IngredientProperties`表中有一个实体-属性-值设计。如果您在创建约束时没有一丝不苟，那么这些类型的设计可能会非常危险。到目前为止，从您对手头问题的描述来看，您可以自由更改架构，并且您没有指定需要支持任意属性。

如果属性列表确实是预先定义的并且很少更改，我会将它们变成列，对于看起来像这样的模式，在风格上采取一些自由：

```
CREATE TABLE Ingredients(
    ProductID int IDENTITY NOT NULL PRIMARY KEY,
    SerialNum varchar(15) NOT NULL UNIQUE,
    Opacity int,
    Density int
);

CREATE TABLE Ingredients(
    IngredientID int IDENTITY NOT NULL PRIMARY KEY,
    ProductID int NOT NULL FOREIGN KEY REFERENCES Products (ProductID),
    SerialNum varchar(15) NOT NULL UNIQUE,
    Price money NOT NULL,
    Opacity int,
    Density int
); 
```

当然，这并不能直接回答您的问题。相反，它使问题消失了。如果上述假设是正确的，那么这应该可以满足您的需求，并且使用起来会更加愉快。

# flash - 是否有解决选择不停止的 Flash 错误的方法？

> ID：804265
> 
> 赞同：2
> 
> 时间：2009-04-29T21:04:35.940
> 
> 标签：flash, selection

如果将鼠标拖到电影之外，Flash 电影没有收到鼠标向上事件的 Adob​​e Flash 问题是否有任何解决方法？

***编辑：这个问题似乎只影响 Firefox***

请参阅：[http ://bugs.adobe.com/jira/browse/FP-234](http://bugs.adobe.com/jira/browse/FP-234)

基本上问题是，我有一个包含文本框的 Flash 电影，如果用户单击文本框并拖动以选择（突出显示）文本，然后他们拖动到 Flash 电影之外并释放鼠标，那么 Flash 移动不会收到鼠标释放事件，即使鼠标已启动，在页面上移动光标也会继续更改 Flash 中的选定文本。

许多人建议使用 ActinScript 来监听 MOUSE_LEAVE 事件，但有两个问题。第一，我使用的是 AS2 而不是 AS3，第二，如果鼠标在离开舞台时按住不放，似乎 MOUSE_LEAVE 不会触发。

**编辑 2：** George Profenza 的“肮脏黑客”已经为我工作了几个月……但截至 2010 年 8 月 24 日，我现在看到 Adob​​e 终于将此问题标记为已解决！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T11:44:11.490

我可以想象问题是什么，但我似乎无法在简单的上下文中重现。

这是一个基于 MOUSE_LEAVE 的“肮脏黑客”...as2 风格。

```
input.onKillFocus = function(newFocus:Object) {
    trace(this._name+" lost focus. New focus changed to: "+newFocus._name);
    delete input._parent.onEnterFrame;
};
input.onSetFocus = function(oldFocus:Object) {
    trace(this._name+" gained focus. Old focus changed from: "+oldFocus._name);
    input._parent.onEnterFrame = trackMouse;
}

function trackMouse():Void{
    if(input._xmouse < 0 || input._xmouse > (input._x + input._width)) onMouseOut();
    if(input._ymouse < 0 || input._ymouse > (input._y + input._height)) onMouseOut();
}

function onMouseOut():Void{
    Selection.setFocus(dummyBtn);
} 
```

假设输入是一个可选择的文本字段。如果文本字段被聚焦，我添加一个 enterFrame 侦听器来检查鼠标是否在文本字段上方或外部（使用 input._xmouse，而不是全局的 _xmouse）。如果鼠标在文本区域之外，我将焦点更改为一个虚拟对象（一个名为 dummyBtn 的按钮）。如果您在 Firefox 中并且您在 swf 之外有选择和释放，则此方法有效，因为一旦您离开文本字段，焦点就会转移到 dummyBtn。

我承认这有点粗糙，如果您仍然需要选择或其他东西，请告诉我。

祝你好运。

# c# - ASP.NET 应用程序对程序加载程序集中的程序集的引用

> ID：804267
> 
> 赞同：2
> 
> 时间：2009-04-29T21:05:03.223
> 
> 标签：c#, assemblies

我的 ASP.NET 应用程序加载一个程序集并从其中的对象创建一个类实例。程序集本身引用了一个名为“Aspose.Cells.dll”的 dll，它可以毫无问题地访问它，并且与程序集文件本身位于同一路径上。但是，当我对其方法之一进行方法调用时，我收到此错误：

> 无法加载文件或程序集 'Aspose.Cells, Version=4.1.2.0, Culture=neutral, PublicKeyToken=9a40d5a4b59e5256' 或其依赖项之一。

我想我需要让我的 ASP.NET 应用程序也引用这个 DLL，但到目前为止我尝试的一切都失败了。加载的程序集 DLL 不位于 Web 应用程序的根目录中，我希望它不必位于。

我可以像这样加载程序集：

```
Assembly asm = Assembly.LoadFile(@"D:\Dev\EasyFlow\Plugins\ImportExportLibrary\bin\Debug\Aspose.Cells.dll"); 
```

但我不能这样使用它：

```
AppDomain newDomain = AppDomain.CreateDomain("testAspose");
Assembly asm = newDomain.Load(System.IO.File.ReadAllBytes(@"D:\Dev\EasyFlow\Plugins\ImportExportLibrary\bin\Debug\Aspose.Cells.dll")); 
```

有更好的方法吗？

### 更新：

感谢您的回复。

我忘了提到我无法将程序集复制到 bin 文件夹或 GAC，因为我希望它作为插件系统工作，可以通过更改配置文件中程序集的路径轻松替换程序集，而不必手动复制文件进入主项目。

但是，该`AssemblyResolve`事件似乎很有趣，我稍后会尝试一下。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T01:33:32.377

有几种方法可以做到这一点。Microsoft 知识库文章“[如何在运行时加载位于不是应用程序 bin 文件夹的文件夹中的程序集](http://support.microsoft.com/kb/837908)”中描述了一种方法。它提供了一个非常好的分步方法来说明如何做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:10:09.220

您可以将依赖程序集复制到 Bin 文件夹中或将其安装在 GAC 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:12:52.753

我想您可以在 <compilation> 部分中添加对 web.config 的程序集引用，如下所示：

```
<compilation debug="true">
  <assemblies>
     <add assembly="Aspose.Cells, Version=4.1.2.0, Culture=neutral,  PublicKeyToken=9a40d5a4b59e5256"/>
  </assemblies>
</compilation> 
```

我不完全确定这会起作用，它可能需要在 <configuration> 下的 <configSections> 节点中对应 web.config 条目。

# c - 在 C 和 OpenGL 中移动粒子

> ID：804268
> 
> 赞同：1
> 
> 时间：2009-04-29T21:05:13.037
> 
> 标签：c, opengl, 3d, particles

我希望能够在 3D 环境中沿直线移动粒子，但我想不出如何根据 3D 空间中的两个点计算出下一个位置？

我创建了一个结构，它代表一个具有位置和下一个位置的粒子？这也适合计算下一个移动位置吗？我知道如何使用以下方法初始设置下一个位置：

```
// Set particle's direction to a random direction
void setDirection(struct particle *p)
{
    float xnm = (p->location.x * -1) - p->velocity;
    float xnp = p->location.x + p->velocity;
    float ynm = (p->location.y * -1) - p->velocity;
    float ynp = p->location.y + p->velocity;
    float znm = (p->location.z * -1) - p->velocity;
    float znp = p->location.z + p->velocity;

    struct point3f nextLocation = { randFloat(xnm, xnp), randFloat(ynm, ynp), randFloat(znm, znp) };
    p->nextLocation = nextLocation;
} 
```

我使用的结构是：

```
// Represents a 3D point
struct point3f
{
    float x;
    float y;
    float z;
};

// Represents a particle
struct particle
{
    enum TYPES type;
    float radius;
    float velocity;
    struct point3f location;
    struct point3f nextLocation;
    struct point3f colour;
}; 
```

我会以完全错误的方式解决这个问题吗？

这是我所有的代码[http://pastebin.com/m469f73c2](http://pastebin.com/m469f73c2)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T21:14:40.517

我建议一个粒子应该只有一个位置成员——当前位置。此外，理想情况下，速度本身应该是 3 个分量的向量。创建一个需要 a和 time duration的函数（调用它`move`，无论如何） 。这将计算单位时间过去后的最终位置：`displace``particle``t``t`

```
struct point3f move(struct *particle, int time) {
    particle->location->x = particle->velocity->x * t;
    /* and so on for the other 2 dimensions */
    return particle->location;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T21:17:15.520

另一个答案有点数学，实际上很简单。

你需要一个你正在移动的“速度”。它还具有 x、y 和 z 坐标。

在一个时间段内，要移动您只需将 x 速度添加到您的 x 位置以获得新的 x 位置，重复 y 和 z。

最重要的是，你可以有一个“加速度”（也是 x，y，z）例如，你的 z 加速度可以是重力，一个常数。

每个时间段你的速度都应该以同样的方式重新计算，调用速度 x“vx”，所以 vx 应该变成 vx + ax，对 y 和 z 重复（再次）。

自从数学以来已经有一段时间了，但这就是我记得的方式，非常简单，除非你需要跟踪单位，然后它会变得更有趣（但仍然不错）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T21:41:25.727

我会推荐两件事：

1.  阅读一两篇关于动画基本矢量数学的文章。例如，[这](http://www.tonypa.pri.ee/vectors/tut01.html)是一个解释 flash 的 2d 矢量的网站。

2.  开始简单，从一维点开始，即仅沿 x 移动的点。然后尝试添加第二维（二维空间中的二维点）和第三维。这可能有助于您更好地了解底层机制。希望这可以帮助

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T21:13:38.943

想想物理学。一个对象有一个位置 (x, y, z) 和一个运动向量 (a, b, c)。你的对象应该存在于它的位置；它有一个与之关联的运动矢量来描述它的动量。在物体上没有任何附加力的情况下，并假设您的运动矢量描述了时间段 t 内的运动，您的物体在时间 x 的位置将是 (x + (a *t), y + (b* t) , z + (c*t))。

简而言之; 不要存储当前位置和下一个位置。存储当前位置和对象的动量。只需将动量添加到位置，就可以很容易地“计时”并更新对象的位置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T21:14:04.233

将velocity存储为struct point3f，然后你有这样的东西：

```
void move(struct particle * p)
{
  p->position.x += p->velocity.x;
  p->position.y += p->velocity.y;
  p->position.z += p->velocity.z;
} 
```

本质上，速度是您希望位置每秒/滴答声/任何改变的程度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T21:09:33.680

你想实现向量数学`X_{i+1} = X_{i} + Vt`。对于`X`s和`V`vectors，分别代表位置和速度，`t`代表时间。因为我是物理学家，所以我已经按时间参数化了沿轨道的距离，但这确实是很自然的事情。如果你想给出轨道距离（即比例`V`为`V.x*V.x + V.y*V.y + V.z*V.z = 1`），则归一化速度矢量。

使用`struct`上面的方法可以很自然地访问元素，但做加法并不那么方便：数组更适合这个。像这样：

```
double X[3];
double V[3];

// initialize

for (int i=0; i<3 ++1){
  X[i] = X[i] + V[i]*t;
} 
```

使用联合，您可以获得两者的优势：

```
struct vector_s{
  double x;
  double y;
  double z;
}
typedef
union vector_u {
  struct vector_s s; // s for struct
  double a[3];       // a for array
} vector; 
```

* * *

如果您想将 的位置和速度与粒子相关联（这是一件非常合理的事情），您可以构建一个支持两个向量的结构

```
typedef
struct particle_s {
  vector position;
  vector velocity;
  //...
} particle_t; 
```

并运行一个大致如下所示的更新例程：

```
void update(particle *p, double dt){
  for (int i=0; i<3 ++i){
    p->position.a[i] += p->velocity.a[i]*dt;
  }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T08:29:55.793

Afaik，主要有两种方法可以计算新位置。一个就像另一个解释使用显式速度一样。另一种可能性是存储最后和当前位置并使用[Verlet 集成](http://en.wikipedia.org/wiki/Verlet_integration)。两种方式都有其优点和缺点。你也可以看看这个有趣的[页面](http://www.teknikus.dk/tj/gdc2001.htm)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-01T18:45:26.787

如果您试图沿着两点之间的直线移动，您可以使用插值公式：

```
P(t) = P1*(1-t) + P2*t 
```

P(t)是点的计算位置，t是0到1的标量，P1和P2是端点，上面的加法是向量加法（所以你把这个公式分别应用到x，y和你的点的z分量）。当 t=0 时，得到 P1；当 t=1 时，您会得到 P2，对于中间值，您会在 P1 和 P2 之间的连线上得到一个点。因此 t=.5 为您提供 P1 和 P2 之间的中点，t=.333333 为您提供从 P1 到 P2 的 1/3 点，依此类推。 [0, 1] 范围之外的 t 值外推到沿线的点从 P1 到 P2 的线段外的线。

如果速度与点之间的距离相比较小，则使用插值公式可能比计算速度并重复添加它更好，因为您限制了舍入误差。

# c# - 到 Lambda 的 LINQ 查询语法

> ID：804273
> 
> 赞同：9
> 
> 时间：2009-04-29T21:06:39.740
> 
> 标签：c#, linq

想知道是否有任何方法可以获取由 LINQ“查询”语法表达式产生的 lambda 表达式。

鉴于：

```
var query = from c in dc.Colors
            where c.ID == 213
            orderby c.Name, c.Description
            select new {c.ID, c.Name, c.Description }; 
```

有没有办法获得生成的“lambda”代码/表达式？

```
var query = dc.Colors
    .Where(c => c.ID == 213)
    .OrderBy(c => c.Name)
    .ThenBy(c => c.Description)
    .Select(c => new {c.ID, c.Name, c.Description, }); 
```

我知道这些是非常简单的示例，并且 C# 编译器在编译代码时会从查询表达式生成 lambda 表达式。有没有办法获得该表达式的副本？

我希望将其用作一些对 lambda 表达式不太熟悉的团队成员的培训工具。此外，我使用了 Linq Pad，但理想情况下，这可以在没有 3rd 方工具的情况下完成。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-01T01:22:22.643

简单地去：

```
string lambdaSyntax = query.Expression.ToString(); 
```

与 LINQPad 相比的缺点是结果全部格式化为一行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T21:14:05.823

您可以尝试编译程序集，然后使用反射器查看它。

不过，这可能比您想要的要复杂一些，因为编译器会将事情直接编译到直接方法调用（一切都将是静态方法调用，而不是扩展方法，并且 lambdas 将被编译成它们自己的函数，这些函数通常是称为类似`<ClassName>b_88f`）

你肯定会弄清楚发生了什么:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T21:17:01.120

[ReSharper](http://www.jetbrains.com/resharper/)具有该功能。它需要一个 LINQ 到 Lambda，然后按一下键再返回。对其他事情也非常（非常）有用。

# c# - 需要从 asmx Web 服务覆盖 Http 响应代码

> ID：804274
> 
> 赞同：2
> 
> 时间：2009-04-29T21:06:43.267
> 
> 标签：c#, apache-flex, http, exception, soap

我的 Web 服务支持 flex/flash 客户端，并且在出现未处理的异常时，会抛出扩展 System.ServiceModel.FaultException 的自定义错误。

我被告知，如果 http 响应代码不同于 200，则 flex/flash 无法读取这些自定义错误。这被记录为 flex/flash 错误：[http ://bugs.adobe.com/jira/browse/SDK -11841](http://bugs.adobe.com/jira/browse/SDK-11841)

我需要在未处理的异常时覆盖 http 返回代码。我试图通过在 global.asax 中包含此代码来做到这一点（此 hack 已被记录为解决方法）：

```
protected void Application_PreSendRequestHeaders(object sender, EventArgs e)
{
    if (Response.StatusCode != 200)
    { // fix response code for flex
        Response.StatusCode = 200;
    }
}

protected void Application_PreSendRequestHeaders(object sender, EventArgs e)
{    
    if (Response.StatusCode != 200)    
    { // fix response code for flex        
         Response.StatusCode = 200;
     }
} 
```

但是，当遇到未处理的异常时，我的 http 返回码返回为 500

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T03:29:45.623

在更改响应状态代码之前，您可能需要添加以下代码：

```
HttpContext.Current.ClearError() 
```

这应该可以防止您的状态代码更改被覆盖。

# c# - LLBLGen - TransactionScope 或 DataAccessAdapter.StartTransaction

> ID：804275
> 
> 赞同：2
> 
> 时间：2009-04-29T21:06:43.593
> 
> 标签：c#, transactions, llblgenpro

我看到使用 llblgen 管理事务有两个主要选项。

方法一：

```
using(DataAccessAdapter adapter = new DataAccessAdapter())
{
    adapter.StartTransaction(IsolationLevel.ReadCommitted, "TR");
    try
    {
        // ...
        adapter.Commit();
    }
    catch
    {
        adapter.Rollback();
        throw;
    }
} 
```

方法二：

```
using(TransactionScope scope = new TransactionScope())
{
    // ...
    scope.Complete();
} 
```

你最喜欢的方法是什么，为什么？（我正在使用适配器/2.6 .net/3.5）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T00:38:42.027

我倾向于使用 TransactionScope 来管理事务，因为这是它的设计目的，而 DataAccessAdapter，虽然它具有创建事务的能力，但主要是为 DataAccess 设计的。

为了更清楚一点，您可以使用 TransactionScope 跨多个 DataAccessAdapter 管理多个事务，而单个 DataAccessAdapter 似乎具有特定范围。

例如：

```
using(TransactionScope ts = new TransactionScope())
{
    using(DataAccessAdapter d1 = new DataAccessAdapter())
    {
        //do some data access stuff
    }
    using(DataAccessAdapter d2 = new DataAccessAdapter())
    {
        //do some other data access stuff  
    }
    ts.complete();
} 
```

另一个注意事项是 TransactionScope 是线程安全的，而 DataAdapter 不是。

# c++ - c++中的auto_ptr问题

> ID：804279
> 
> 赞同：2
> 
> 时间：2009-04-29T21:07:33.483
> 
> 标签：c++

我刚来这地方。我也是 C++ 的新手所以这是我写的类和函数。但是我得到了编译器错误我的类：

```
class fooPlayer
{
public:
       void fooPlayerfunc(){}//doing something here
       char askYesNo(std::string question);
};

class fooPlayerFactory
{
public:
   virtual std::auto_ptr<fooPlayer> MakePlayerX() const;
   virtual std::auto_ptr<fooPlayer> MakePlayerO() const;
private:
   std::auto_ptr<fooPlayer> MakePlayer(char letter) const;
   std::auto_ptr<fooPlayer> my_player;

}; 
```

实现我的课程：

```
auto_ptr<fooPlayer> fooPlayerFactory:: MakePlayer(char letter) const
{
       my_player->fooPlayerfunc();
       return my_player;
}

auto_ptr<fooPlayer> fooPlayerFactory::MakePlayerX() const
{
      char go_first = my_player->askYesNo("Do you require the first move?");
      MakePlayer(go_first);
      return my_player;
}

auto_ptr<fooPlayer> fooPlayerFactory::MakePlayerO() const
{
    return my_player;
} 
```

我的 main() 函数在这里：

```
int main()
{
          fooPlayerFactory factory;
          factory.MakePlayerX();
          factory.MakePlayerO();
} 
```

我收到错误：错误 C2558：类 'std::auto_ptr<_Ty>'：没有可用的复制构造函数或复制构造函数被声明为“显式”

[即使在阅读此](http://msdn.microsoft.com/en-us/library/7xcz0y39(VS.71).aspx)链接上的文档后，我也不知道如何更改它：

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T00:12:04.163

错误的原因是您在 fooPlayerFactory::MakePlayerO() 中调用 auto_ptr my_player 的复制构造函数，这是一个 const 方法。这意味着它不能修改它的成员。

但是 auto_ptr 的复制构造函数确实修改了右侧，因此返回 my_player 会尝试将其指针更改为 0 (NULL)，同时将原始指针分配给返回值中的 auto_ptr。

复制构造函数的签名是

```
auto_ptr<T>::auto_ptr<T>(auto_ptr<T> & rhs) 
```

不是

```
auto_ptr<T>::auto_ptr<T>(const auto_ptr<T> & rhs) 
```

auto_ptr 的复制构造函数将指针的所有权分配给左侧，而右侧则什么也没有。

我不认为你想在这里使用 auto_ptr，你可能想要 boost::smart_ptr

看起来你混淆了 auto_ptr 的两种用途

第一个是穷人的 boost::scoped_ptr。这是在一个类中管理一个指针的单个实例，该类管理指针的生命周期。在这种情况下，你通常不会在你的类之外返回这个指针（你可以它是合法的，但是 boost::smart_ptr / boost::weak_ptr 会更好，这样客户就可以参与指针的生命周期）

第二个是它的主要目的，即以异常安全的方式将新创建的指针返回给函数的调用者。

例如

```
auto_ptr<T> foo() {
    return new T;
}

void bar() {
    auto_ptr<T> t = foo();
} 
```

正如我所说，我认为你已经混合了这两种用途 auto_ptr 是一个微妙的野兽，你应该仔细阅读 auto_ptr 文档。[Scott Meyers](https://rads.stackoverflow.com/amzn/click/com/0201749629)在 Effective STL 中也很好地介绍了它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T21:09:39.330

在您的代码中：

```
auto_ptr<fooPlayer> fooPlayerFactory:: MakePlayer(char letter) const
{
       my_player->fooPlayerfunc();
       return my_player;
} 
```

这是一个 const 函数，但`fooPlayerfunc`不是 const - 我的编译器报告了这个错误，而不是你说的那个错误。您发布的是真实代码吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T22:35:25.253

我认为您实际上并不想在这里构造动态对象。
工厂对象创建并返回一个对象，它通常在创建后不会保留对它的引用（除非您正在共享它），而且我实际上看不到您正在创建播放器的任何地方。

如果您只在 (fooPlayerFactory) 内部创建一个播放器。然后创建一个对象并返回对它的引用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T21:12:46.887

编辑：作为对评论的回应（这是正确的，我的错），我只留下了建议部分。

最佳实践是让工厂方法只返回一个指向底层对象的普通旧指针，并让调用者决定如何管理所有权（auto_ptr、scoped_ptr 或其他）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T08:07:54.987

您的代码也有问题，任何实现虚拟方法的类都应该有一个虚拟析构函数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T23:16:08.917

我没有看到你构造的任何地方`my_player`，所以我感觉有些代码丢失了。具体来说，我认为您的构造函数有这一行：

```
my_player = new fooPlayer() 
```

对象与`fooPlayer`对象并不完全相同`auto_ptr<fooPlayer>`，并且`auto_ptr`有意设计为防止从一个分配给另一个，因为坦率地说，替代方案更糟。有关详细信息，请查找 (1) 转换构造函数，(2)`explicit`关键字，以及 (3) 复制构造函数和破坏性复制语义。

您应该将构造函数更改为：

```
class fooPlayerFactory {
    public:
    fooPlayerFactory()
    {
        my_player = std::auto_ptr<fooPlayer>(new fooPlayer());
    } 
```

或者（使用成员初始化列表）：

```
class fooPlayerFactory {
    public:
    fooPlayerFactory() : my_player(std::auto_ptr<fooPlayer>(new fooPlayer()) { } 
```

解决方案并不漂亮，但正如我所说，由于一些非常神秘的细节，替代方案更糟糕。

* * *

不过，作为一点建议，你让生活变得比需要的更艰难。并且实际上可能会导致奇怪的错误。 `auto_ptr`存在来管理对象的生命周期，但您需要担心生命周期的唯一原因`my_player`是您已经为它分配了`new`. 但是没有必要打电话`new`，实际上也没有必要保留`my_player`。除非`fooPlayerFactory`打算成为其他工厂的基类，否则不需要标记 functions `virtual`。

最初我认为你可以简单地返回`my_player`对象的副本，但有一个问题：在`my_player`从`MakePlayer()`你返回之前调用它的方法，我假设该方法改变了`my_player`. 进一步的调用`MakePlayer()`将再次改变状态，我认为你最终会`my_player`处于错误的状态。相反，`fooPlayer`每个请求都返回一个不同的对象。不做内存管理，只承诺构造对象。这样用户就可以决定内存分配：

```
fooPlayerFaclotry factory;
fooPlayer on_stack = factory.MakePlayerX();
fooPlayer* on_heap_raw_pointer = new fooPlayer(factory.MakePlayerO());
std::auto_ptr<fooPlayer> on_heap_managed_scope
                         = std::auto_ptr<fooPlayer>(factory.MakePlayerX()); 
```

我会变成`fooPlayerFactory`这样：

```
class fooPlayerFactory
{
private:
   fooPlayer MakePlayer(const char letter) const
   {
       fooPlayer result;
       result.fooPlayerfunc();
       return result;
   }

public:
   fooPlayer* MakePlayerX() const
   {
       char go_first = askYesNo("Do you require the first move?");
       return MakePlayer(go_first);
   }

   fooPlayer MakePlayerO() const
   {
       return fooPlayer();
   }
}; 
```

# .net - 如何写入自定义 Windows 事件日志？

> ID：804284
> 
> 赞同：4
> 
> 时间：2009-04-29T21:09:24.837
> 
> 标签：.net, event-log, custom-eventlog

我正在尝试通过 .net 将基本日志记录设置到 .net 中的 Windows 事件日志[`System.Diagnostics.EventLog`](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlog.aspx)，但我没有看到任何实际写入日志的事件。考虑以下代码：

```
// Elsewhere in the class
private static readonly string EventLogName = "LogName";
private static readonly string EventLogSource = "AppName";

// In the only function that does something
if (!EventLog.Exists(EventLogName))
{
    EventLog.CreateEventSource(EventLogSource, EventLogName);
    return;
}
else
{
    Trace.TraceInformation("Attempting log");

    // This doesn't write anything
    EventLog.WriteEntry(EventLogSource, 
        "StaticWriteEntry", 
        EventLogEntryType.Error);

    // Neither does this
    using (var log = new EventLog())
    {
        log.Log = EventLogName;
        log.Source = EventLogSource;
        log.WriteEntry("WriteEntry?", EventLogEntryType.Error);
    }
}
return; 
```

根据 MSDN 示例，我第一次创建日志并退出应用程序。当然，此日志创建最终将进入设置。随后的运行尝试将消息记录到创建的事件日志中。

没有异常被抛出。日志似乎已成功创建（我可以在 Windows 事件查看器中打开它）。没有任何相关内容被记录到安全日志中。

任何一个都不会记录任何消息`WriteEntry()`。由于名称不匹配，它们也不会放在应用程序日志中。在这种特殊情况下，我在禁用 UAC 的管理员帐户中在 Server2008 上运行。（这是需要不幸环境的较大遗留产品的一小部分。）我做错了什么？

（我这样做是因为我想[`EventLogTraceListener`](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlogtracelistener.aspx)在我的 app.config 中使用 an，而且它没有写任何东西，所以这是解决该问题的一部分。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T14:09:22.933

问题似乎与源名称有关。具体来说，如果我更改源名称，我可以成功编写。[`EventLog.Source`](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlog.source(VS.80).aspx)这是由于文档底部的以下行：

> 如果源已映射到日志并且您将其重新映射到新日志，则必须重新启动计算机才能使更改生效。

在开发过程中，日志名称和日志源已经创建和销毁了几次，我可能在没有更改源名称的情况下更改了日志名称。

假设我的原始来源和日志是`"OldSource"`and `"OldLog"`。我通过更改代码以尝试写入`"NewSource"`和确定这可能是问题的根源`"NewLog"`。当我更改两者时，我成功创建并写入`"NewLog"`. 但是，当我尝试`"NewLog"`通过创建它来写入`"OldSource"`时，它失败了。

我确认这是问题所在，然后重新启动我的开发系统并运行完全相同的代码（使用`"NewLog"`and `"OldSource"`）并且它有效。

我想这是重新启动确实修复它的一次！:)

# c - 创建 C 格式的字符串（不打印它们）

> ID：804288
> 
> 赞同：128
> 
> 时间：2009-04-29T21:10:03.570
> 
> 标签：c, string

我有一个接受字符串的函数，即：

```
void log_out(char *); 
```

在调用它时，我需要动态创建一个格式化的字符串，例如：

```
int i = 1;
log_out("some text %d", i); 
```

如何在 ANSI C 中执行此操作？

* * *

只是，由于`sprintf()`返回一个 int，这意味着我必须编写至少 3 个命令，例如：

```
char *s;
sprintf(s, "%d\t%d", ix, iy);
log_out(s); 
```

有什么办法可以缩短这个？

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-04-29T21:12:28.790

使用[sprintf](http://www.cplusplus.com/reference/clibrary/cstdio/sprintf/)。（这不安全，但 OP 要求提供 ANSI C 答案。请参阅评论以获取安全版本。）

```
int sprintf ( char * str, const char * format, ... ); 
```

> 将格式化数据写入字符串 使用与 printf 上使用 format 时将打印的相同文本组成字符串，但不是打印，而是将内容作为 C 字符串存储在 str 指向的缓冲区中。
> 
> 缓冲区的大小应该足够大以包含整个结果字符串（请参阅 snprintf 以获得更安全的版本）。
> 
> 内容后会自动附加一个终止空字符。
> 
> 在格式参数之后，该函数至少需要格式所需的附加参数。

## 参数：

```
str 
```

> 指向存储结果 C 字符串的缓冲区的指针。缓冲区应该足够大以包含结果字符串。

```
format 
```

> 包含格式字符串的 C 字符串，该格式字符串遵循与 printf 中的格式相同的规范（有关详细信息，请参阅 printf）。

```
... (additional arguments) 
```

> 根据格式字符串，该函数可能需要一系列附加参数，每个参数都包含一个值，用于替换格式字符串中的格式说明符（或指向存储位置的指针，对于 n）。这些参数的数量至少应与格式说明符中指定的值的数量一样多。该函数会忽略其他参数。

## 例子：

```
// Allocates storage
char *hello_world = (char*)malloc(13 * sizeof(char));
// Prints "Hello world!" on hello_world
sprintf(hello_world, "%s %s!", "Hello", "world"); 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2014-05-24T08:32:34.927

如果您有一个 POSIX-2008 兼容系统（任何现代 Linux），您可以使用安全方便的`asprintf()`功能：它会`malloc()`为您提供足够的内存，您无需担心最大字符串大小。像这样使用它：

```
char* string;
if(0 > asprintf(&string, "Formatting a number: %d\n", 42)) return error;
log_out(string);
free(string); 
```

这是以安全方式构造字符串的最小努力。您在问题中提供的`sprintf()`代码存在严重缺陷：

*   指针后面没有分配的内存。您正在将字符串写入内存中的随机位置！

*   即使你写过

    ```
    char s[42]; 
    ```

    你会遇到很大的麻烦，因为你不知道括号里应该放什么数字。

*   即使您使用了“安全”变体`snprintf()`，您仍然会面临字符串被截断的危险。写入日志文件时，这是一个相对较小的问题，但它有可能精确地切断本来有用的信息。此外，它会切断尾随的结束行字符，将下一个日志行粘贴到您未成功写入的行的末尾。

*   如果你尝试在所有情况下使用`malloc()`和的组合`snprintf()`来产生正确的行为，你最终得到的代码大约是我给出的代码的两倍`asprintf()`，并且基本上重新编程了`asprintf()`.

* * *

如果您正在考虑提供一个`log_out()`可以采用`printf()`样式参数列表本身的包装器，则可以使用`vasprintf()`将 a`va_list`作为参数的变体。这是这样一个包装器的一个完全安全的实现：

```
//Tell gcc that we are defining a printf-style function so that it can do type checking.
//Obviously, this should go into a header.
void log_out_wrapper(const char *format, ...) __attribute__ ((format (printf, 1, 2)));

void log_out_wrapper(const char *format, ...) {
    char* string;
    va_list args;

    va_start(args, format);
    if(0 > vasprintf(&string, format, args)) string = NULL;    //this is for logging, so failed allocation is not fatal
    va_end(args);

    if(string) {
        log_out(string);
        free(string);
    } else {
        log_out("Error while logging a message: Memory allocation failed.\n");
    }
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-29T22:00:25.243

在我看来，您希望能够轻松地将使用 printf 样式格式创建的字符串传递给您已经拥有的采用简单字符串的函数。`stdarg.h`您可以使用工具和`vsnprintf()`（可能不容易获得，具体取决于您的编译器/平台）创建包装函数：

```
#include <stdarg.h>
#include <stdio.h>

// a function that accepts a string:

void foo( char* s);

// You'd like to call a function that takes a format string 
//  and then calls foo():

void foofmt( char* fmt, ...)
{
    char buf[100];     // this should really be sized appropriately
                       // possibly in response to a call to vsnprintf()
    va_list vl;
    va_start(vl, fmt);

    vsnprintf( buf, sizeof( buf), fmt, vl);

    va_end( vl);

    foo( buf);
}

int main()
{
    int val = 42;

    foofmt( "Some value: %d\n", val);
    return 0;
} 
```

对于不提供`snprintf()`例程系列的良好实现（或任何实现）的平台，我已经成功地使用了[Holger Weiss](http://www.jhweiss.de/software/snprintf.html)[的几乎公共域`snprintf()`](http://www.jhweiss.de/software/snprintf.html)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-12-31T17:16:29.087

不要使用 sprintf。
它会溢出你的字符串缓冲区并使你的程序崩溃。
始终使用[snprintf](http://www.cplusplus.com/reference/cstdio/snprintf/?kw=snprintf)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-29T23:09:29.400

如果你有代码`log_out()`，重写它。最有可能的是，您可以这样做：

```
static FILE *logfp = ...;

void log_out(const char *fmt, ...)
{
    va_list args;

    va_start(args, fmt);
    vfprintf(logfp, fmt, args);
    va_end(args);
} 
```

如果需要额外的日志信息，可以在显示的消息之前或之后打印。这节省了内存分配和可疑的缓冲区大小等等。您可能需要初始化`logfp`为零（空指针）并检查它是否为空并酌情打开日志文件 - 但现有代码`log_out()`无论如何都应该处理这个问题。

此解决方案的优点是您可以简单地调用它，就好像它是`printf()`; 的变体一样。实际上，它是`printf()`.

如果您没有 的代码`log_out()`，请考虑是否可以将其替换为上述变体。是否可以使用相同的名称将取决于您的应用程序框架和当前`log_out()`功能的最终来源。如果它与另一个必不可少的函数在同一个目标文件中，则必须使用新名称。如果您无法弄清楚如何准确地复制它，您将不得不使用一些变体，就像其他答案中给出的那样，分配适当的内存量。

```
void log_out_wrapper(const char *fmt, ...)
{
    va_list args;
    size_t  len;
    char   *space;

    va_start(args, fmt);
    len = vsnprintf(0, 0, fmt, args);
    va_end(args);
    if ((space = malloc(len + 1)) != 0)
    {
         va_start(args, fmt);
         vsnprintf(space, len+1, fmt, args);
         va_end(args);
         log_out(space);
         free(space);
    }
    /* else - what to do if memory allocation fails? */
} 
```

显然，您现在调用了`log_out_wrapper()`而不是`log_out()`- 但内存分配等只完成了一次。我保留将空间过度分配一个不必要的字节的权利 - 我没有仔细检查返回的长度是否`vsnprintf()`包括终止的空值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T21:54:33.073

我没有这样做，所以我只想指出正确的答案。

C 使用标头对采用未指定数量的操作数的函数进行了规定`<stdarg.h>`。您可以将函数定义为`void log_out(const char *fmt, ...);`，并获取`va_list`函数内部。然后您可以分配内存并`vsprintf()`使用分配的内存、格式和`va_list`.

或者，您可以使用它来编写一个类似于`sprintf()`分配内存并返回格式化字符串的函数，或多或少地像上面那样生成它。这将是内存泄漏，但如果您只是注销，则可能无关紧要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-09T09:42:16.950

验证和总结：

# sprintf 与 asprintf

`asprintf`= `malloc`+`sprintf`

## 示例代码

### 冲刺

```
int largeEnoughBufferLen = 20;

char *someStr = (char*)malloc(largeEnoughBufferLen * sizeof(char));

sprintf(someStr, "formatted string: %s %s!", "Hello", "world");

// do what you want for formatted string: someStr

free(someStr); 
```

### asprintf

```
char *someStr;

int formattedStrResult = asprintf(&someStr, "formatted string: %s %s!", "Hello", "world");

if(formattedStrResult > 0){
    // do what you want for formatted string: someStr

    free(someStr);
} else {
    // some error
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-29T22:00:55.213

[http://www.gnu.org/software/hello/manual/libc/Variable-Arguments-Output.html](http://www.gnu.org/software/hello/manual/libc/Variable-Arguments-Output.html)提供了以下示例以打印到 stderr。您可以修改它以使用您的日志功能：

```
 #include <stdio.h>
 #include <stdarg.h>

 void
 eprintf (const char *template, ...)
 {
   va_list ap;
   extern char *program_invocation_short_name;

   fprintf (stderr, "%s: ", program_invocation_short_name);
   va_start (ap, template);
   vfprintf (stderr, template, ap);
   va_end (ap);
 } 
```

您需要使用 vsprintf 而不是 vfprintf，您需要提供足够的缓冲区来打印。

# c# - 使用带有对象属性的 ASP.NET 中继器

> ID：804291
> 
> 赞同：1
> 
> 时间：2009-04-29T21:10:26.707
> 
> 标签：c#, asp.net, nested-repeater

我正在尝试使用 ASP.NET 的 Repeater 对象来循环对象的属性。

例如...我有一个 ObjectDataSource 来按 ID 抓取对象“程序”...

Program 具有诸如 Program.Stakeholders 和 Program.Outcomes 之类的属性，它们是“Stakeholder”和“Outcome”对象的列表。

现在......我真正想做的是使用中继器来定位这些属性并遍历它们包含的列表。但是，据我所知，我必须为每个数据源设置一个单独的数据源，并绑定到一个单独的方法来检索每个列表。

谁能提供更好的方法来使用这些中继器对象，或者向我指出一些有用的资源？如果这没有意义，我可以尝试进一步澄清。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T21:32:31.100

使用内置`ObjectDataSource`映射为每个项目建立一个单独的数据源可能是唯一直接的方法（也是唯一值得付出努力的简单方法......）。

这是您使用 的要求`ObjectDataSource`，还是您可以选择不同的方式从存储中获取数据？我建议使用实体框架（恕我直言）或创建您自己的自定义类型，您可以使用自定义设计的 DAL 获取数据（这比使用 EF 做更多的工作，但如果您像某些人一样担心EF 仍处于起步阶段，这可能是您的选择）。

无论哪种情况，您最终都会得到一个名为 的 C# 类`Program`，它分别具有 type`IEnumerable<Stakeholder>`和`IEnumerable<Outcome>`called`Stakeholders`和的属性`Outcomes`。然后，您可以将它们用作项目中继器的数据源，并在`ItemDataBound`事件中设置它们`ProgramRepeater`，可能是这样的：

```
protected void ProgramRepeater_ItemDataBound(object sender, ItemDataBoundEvent e) {
    Program dataItem = (Program)e.DataItem;
    Repeater stakeholderRptr = (Repeater)e.Item.FindControl("ProgramRepeater");
    Repeater outecomeRptr = (Repeater)e.Item.FindControl("OutcomeRepeater");

    stakeholderRptr.DataSource = dataItem.Stakeholders;
    stakeholderRptr.DataBind();
    outecomeRptr.DataSource = dataItem.Outcomes;
    outecomeRptr.DataBind();
} 
```

当然，这是假设您使用的是 ASP.Net WebForms。在 ASP.Net MVC 中它更容易 - 您只需将对象作为`Program`对象发送到`View`，`Model`然后直接在.`Stakeholders``Outcomes``for``View`

* * *

**Note:** All code is provided as is, and I do not guarantee that it will run as expected or even compile. It is just to give you an idea of what to make your code do - not necessarily the exact code you need to solve your problem.

# ruby - 何时在 Ruby 中使用 `require`、`load` 或 `autoload`？

> ID：804297
> 
> 赞同：65
> 
> 时间：2009-04-29T21:12:38.277
> 
> 标签：ruby, module

我理解 Ruby和Ruby 之间`require`的细微差别，但我的问题是，你怎么知道要使用哪一个？`load``autoload`

除了能够`load`在匿名模块中“包装” a 之外，`require`似乎是首选。

但是随后`autoload`允许您延迟加载文件-这听起来很棒，但我不确定您实际上获得了什么`require`

一种方法优于另一种方法吗？是否存在一种方法脱颖而出的情况？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-04-29T23:08:11.633

通常，您应该使用`require`. `load`每次都会重新加载代码，所以如果你从几个模块中加载，你会做很多额外的工作。理论上，惰性`autoload`听起来不错，但许多 Ruby 模块会做猴子修补其他类之类的事情，这意味着程序中不相关部分的行为可能取决于给定类是否已被使用。

如果您想制作自己的自动重新加载器，在每次代码更改或每次有人点击 URL 时加载代码（出于开发目的，因此您不必每次都重新启动服务器），那么使用`load`for 是合理的。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-12-16T10:46:55.283

**图书馆.rb**

```
puts "I was loaded!"

class MyLibrary
end 
```

试试 irb

```
irb(main):001:0> require 'mylibrary'
I was loaded!
=> true

irb(main):001:0> autoload :MyLibrary, 'mylibrary'
=> nil
irb(main):002:0> MyLibrary.new
I was loaded!
=> #<MyLibrary:0x0b1jef> 
```

看到不同。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-10-17T06:36:37.017

这就是你得到的`autoload`over `require`：

`autoload`主要用于加速 Ruby 程序或 Rails 应用程序的初始化阶段。通过在需要资源之前不加载资源，它可以大大加快速度。

另一个优点是，如果用户不使用某些功能，您可能不需要加载代码的某些部分——从而缩短加载时间并减少内存占用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-06-14T12:16:36.910

除了别人已经告诉你的，未来`autoload`是不确定的。它计划在 Ruby 2.0 中被弃用，但在 2.0 特性冻结时没有及时弃用。现在预计`autoload`它将在 Ruby 2.1 中被弃用，[但这甚至还不确定](http://bugs.ruby-lang.org/issues/5653)。

# .net - 如何从代码中触发 Google Analytics？

> ID：804309
> 
> 赞同：9
> 
> 时间：2009-04-29T21:14:16.323
> 
> 标签：.net, javascript, google-analytics

我的应用程序从我的网站读取一个 (html) 文件，我想使用 Google Analytics 跟踪对该文件的访问。由于读取文件时不会执行 GA Javascript，因此不会对其进行跟踪。有没有办法直接从代码触发 GA，或者从 .NET 应用程序执行 Javascript 而无需添加一堆依赖项？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T21:22:04.120

谷歌分析的工作原理是通过 javascript 向谷歌服务器发出网络请求。如果您想以编程方式执行此操作，您只需自己发出此 Web 请求。当您在浏览器中加载页面时，我会使用 Fiddler 或 FireBug 来捕获请求的样子。然后，您可以在 .Net 应用程序中使用相同的 URL。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-07-05T12:26:57.163

我最近发布了一个 .net 库，它允许您通过代码使用 Google Analytics 本地记录页面视图。它是在 GNU 下作为开源发布的，因此所需的只是适当的归属。

你可以在这里获得图书馆：[http ://www.diaryofaninja.com/projects/details/ga-dot-net](http://www.diaryofaninja.com/projects/details/ga-dot-net)

API 的示例用法：

```
GooglePageView pageView = new GooglePageView("My page title",
                                "www.mydomain.com",
                                "/my-page-url.html");
TrackingRequest request = new RequestFactory().BuildRequest(pageView);
GoogleTracking.FireTrackingEvent(request); 
```

还有一个内置的 HTTP 处理程序，允许您通过在页面上简单地包含跟踪像素来触发跟踪事件：

```
<img src="/tracker.asmx?domain=mydomain.com&pagetitle=My%20Page%20Title&url=/my-page.aspx" /> 
```

或者，您可以使用 jquery 来跟踪使用 Google Analytics（zip、jpg 等）的页面内的链接 - 不久前在此处发布了有关它的博客：

[http://www.diaryofaninja.com/blog/2009/09/17/random-file-zip-and-pdf-tracking-using-jquery-amp-google-analytics](http://www.diaryofaninja.com/blog/2009/09/17/random-file-zip-and-pdf-tracking-using-jquery-amp-google-analytics)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-15T04:25:49.320

```
private void analyticsmethod4(string trackingId, string pagename)
{
    Random rnd = new Random();

    long timestampFirstRun, timestampLastRun, timestampCurrentRun, numberOfRuns;

    // Get the first run time
    timestampFirstRun = DateTime.Now.Ticks;
    timestampLastRun = DateTime.Now.Ticks-5;
    timestampCurrentRun = 45;
    numberOfRuns = 2;

    // Some values we need
    string domainHash = "123456789"; // This can be calcualted for your domain online
    int uniqueVisitorId = rnd.Next(100000000, 999999999); // Random
    string source = "Shop";
    string medium = "medium123";
    string sessionNumber = "1";
    string campaignNumber = "1";
    string culture = Thread.CurrentThread.CurrentCulture.Name;
    string screenRes = Screen.PrimaryScreen.Bounds.Width + "x" + Screen.PrimaryScreen.Bounds.Height;

    string statsRequest = "http://www.google-analytics.com/__utm.gif" +
        "?utmwv=4.6.5" +
        "&utmn=" + rnd.Next(100000000, 999999999) +
    //  "&utmhn=hostname.mydomain.com" +
        "&utmcs=-" +
        "&utmsr=" + screenRes +
        "&utmsc=-" +
        "&utmul=" + culture +
        "&utmje=-" +
        "&utmfl=-" +
        "&utmdt=" + pagename +
        "&utmhid=1943799692" +
        "&utmr=0" +
        "&utmp=" + pagename +
        "&utmac=" +trackingId+ // Account number
        "&utmcc=" +
            "__utma%3D" + domainHash + "." + uniqueVisitorId + "." + timestampFirstRun + "." + timestampLastRun + "." + timestampCurrentRun + "." + numberOfRuns +
            "%3B%2B__utmz%3D" + domainHash + "." + timestampCurrentRun + "." + sessionNumber + "." + campaignNumber + ".utmcsr%3D" + source + "%7Cutmccn%3D(" + medium + ")%7Cutmcmd%3D" + medium + "%7Cutmcct%3D%2Fd31AaOM%3B";

    using (var client = new WebClient())
    {
        client.DownloadData(statsRequest);
        //Stream data = client.OpenRead(statsRequest);
        //StreamReader reader = new StreamReader(data);
        //string s = reader.ReadToEnd();
    }

} 
```

参考这个 - [http://tilr.blogspot.com/2012/10/google-analytics-use-google-analytics.html](http://tilr.blogspot.com/2012/10/google-analytics-use-google-analytics.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T09:54:04.670

Google Analytics 提供了两种方法来跟踪自定义操作、事件或您处理的任何事情。在您的情况下，简单的解决方案是为您的应用程序读取的 HTML 文件生成一个虚拟网页浏览量。调用适当的[JavaScript 函数](http://www.google.com/support/googleanalytics/bin/answer.py?hl=en&answer=55521)：

```
pageTracker._trackPageview("/Foo.html"); 
```

这样每次处理*Foo.html*时，都会为其生成一个页面浏览量，就像它是对您的应用程序的正常查询一样。

如果您想将这些*Foo.html*与普通浏览量区分开来，GA 有一个很好的功能，称为[事件跟踪](http://code.google.com/apis/analytics/docs/tracking/eventTrackerOverview.html)，那么您应该看看。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T21:14:18.233

我最终使用 WebBrowser 组件来加载 .html 文件，从而触发 GA 跟踪器。WebBrowser 组件执行嵌入的 JavaScript。

```
using (WebBrowser wb = new WebBrowser())
{
    wb.Url = new Uri(@"mytrackingpage.html");
    while (wb.ReadyState != WebBrowserReadyState.Complete)
    {
        Application.DoEvents();
    }
} 
```

现在我所要做的就是添加一些错误处理，摆脱丑陋的 DoEvents 并将 WebBrowser 移动到一个单独的线程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-03-20T23:00:14.103

谷歌有几种不同语言的库（alpha 版），用于访问各种谷歌 API，包括分析——这里有一个很好的描述——https: [//developers.google.com/analytics/devguides/collection/](https://developers.google.com/analytics/devguides/collection/)和 .NET 库是[https://developers.google.com/api-client-library/dotnet/apis/analytics/v3](https://developers.google.com/api-client-library/dotnet/apis/analytics/v3)

还请记住他们在使用时必须遵守的隐私政策：[https ://developers.google.com/analytics/devguides/collection/protocol/policy](https://developers.google.com/analytics/devguides/collection/protocol/policy)

# nhibernate - 不知所措，如何在 Nhibernate 中映射两个类

> ID：804311
> 
> 赞同：0
> 
> 时间：2009-04-29T21:14:21.487
> 
> 标签：nhibernate, nhibernate-mapping

请原谅这个笨拙的问题（如果你能找到更好的方式来表达这个问题，请随时编辑）。

我有两个类 SupportTicketCategory 和 SupportTicket （分别）：

```
 public class SupportTicketCategory
{
    public SupportTicketCategory()
    { }

    private int _supportTicketCategoryID;
    public virtual int SupportTicketCategoryID
    {
        get { return _supportTicketCategoryID; }
        set
        {
            _supportTicketCategoryID = value;
        }
    }

    private string _supportTicketCategoryName;
    public virtual string SupportTicketCategoryName
    {
        get { return _supportTicketCategoryName; }
        set
        {
            _supportTicketCategoryName = value;
        }
    }

} 
```

和

```
 public SupportTicket()
    { }

    private int _supportTicketID;
    public virtual int SupportTicketID
    {
        get { return _supportTicketID; }
        set
        {
            _supportTicketID = value;
        }
    }

    private SupportTicketCategory _supportTicketCategory;
    public virtual SupportTicketCategory SupportTicketCategory { get; set; } 
```

我的表结构如下：

```
CREATE TABLE [dbo].[supporttickets](
[supportticketid] [int] IDENTITY(1,1) NOT NULL,
[supportticketcategoryid] [int] NOT NULL,
 CONSTRAINT [PK_supporttickets] PRIMARY KEY CLUSTERED 
(
    [supportticketid] ASC
)
) ON [PRIMARY]

ALTER TABLE [dbo].[supporttickets]  
WITH CHECK ADD CONSTRAINT
[FK_supporttickets_supportticketcategories] 
FOREIGN KEY([supportticketcategoryid])
REFERENCES [dbo].[supportticketcategories] ([supportticketcategoryid])

ALTER TABLE [dbo].[supporttickets] CHECK CONSTRAINT  [FK_supporttickets_supportticketcategories]

CREATE TABLE [dbo].[supportticketcategories](
    [supportticketcategoryid] [int] IDENTITY(1,1) NOT NULL,
    [supportticketcategoryname] [varchar](50) NOT NULL,
 CONSTRAINT [PK_supportticketcategories] PRIMARY KEY CLUSTERED 
(
    [supportticketcategoryid] ASC
)
) ON [PRIMARY] 
```

所以基本上，我想将 SupportTicketCategory 映射到 SupportTicket 上，就像在我的课堂上一样，但是我无法弄清楚什么是正确的映射类型，也无法在互联网上找到这样的示例。

**更新：** 我将 SupportTicketCategory 属性更改为老式的 getter 和 setter，它起作用了……语法糖以防丢失。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T21:16:18.877

如果您将[MyGeneration](http://www.mygenerationsoftware.com/portal/default.aspx)与[NHibernate 模板](http://vucetica.blogspot.com/2009/01/nhibernate-template-for-mygeneration.html)一起使用，您可以将它指向您的数据库，它会为您制作映射，因此您可以看到它应该如何完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:19:55.933

我认为您正在寻找的是“多对一”元素。（这在 SupportTicket 的类元素中）

```
<many-to-one name="SupportTicketCategory" column="SupportTicketCategoryId" update="false" insert="false" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:28:12.013

多对一映射可以这样完成：

```
<many-to-one name="SupportTicketCategory" class="SupportTicketCategory" not-null="false" column="SupportTicketCategoryId" /> 
```

# ruby-on-rails - 如何在 Rails 中创建表单而无需使用 form_for 和模型实例？

> ID：804313
> 
> 赞同：18
> 
> 时间：2009-04-29T21:14:45.730
> 
> 标签：ruby-on-rails, ruby, forms

首先，我是 Rails 新手。我可以使用 Ruby，但 Rails 对我来说是一个完全不同的故事。我喜欢 Rails 为我提供的开发速度，但我似乎无法接受现有文档。

到目前为止，我的所有表单都使用了**form_for**，并带有我需要创建的模型的实例（例如，提交一本新书）。我真的很想能够写出类似的东西：

```
 <% form(:action => "whatever") %>
  <% text_field ... %>
  <% file_field ... %>
<% end %> 
```

从我在网上阅读的文章中，我了解到这是在 Rails < 2.0 中完成工作的方式。无论如何在 Rails > 2.0 或类似的东西中这样做？你能发一个片段吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-29T21:18:52.067

看看[`form_tag`](http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-form_tag)。

```
<% form_tag '/posts' do %>
  <div><%= submit_tag 'Save' %></div>
<% end %> 
```

# math - MIPS 程序确定测试成绩的通过/失败

> ID：804315
> 
> 赞同：2
> 
> 时间：2009-04-29T21:15:28.677
> 
> 标签：math, assembly, mips

我正在编写一个 MiPS 程序，它将检查 15 个测试分数的列表。它将从终端输入。通过标准是 50 分。终端的输出将包括每个类别的分数以及通过和失败的学生人数。我应该使用输入提示和输出语句。请我需要一些帮助，只需要一些建议如何去做。

```
main:
 li $t1,15         #load 15 into $t1

 la $a1,array      #load a pointer to array into $a1 
```

我有一个循环：

```
addi $t1,$t1,-1

li $v0,4

la $a0,prompt

syscall 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:37:02.287

我不想放弃它，所以我会提出一些指导方针。

你应该阅读[汇编器、链接器和 Spim 模拟器](http://pages.cs.wisc.edu/~larus/HP_AppA.pdf)。这很有帮助。

就这样吧。

创建两个 15 字数组。

```
 .data
 fail_vector: .word  -1,-1,-1 ...    #15 invalid words 
 passed_vector: .word  -1,-1,-1 ...  #15 invalid words 
```

在某个寄存器上加载循环控制变量。

```
 li $t1,15
 beq $t1,$zero,END
 addiu $t1,$t1,-1 
```

现在在这个循环中读取值

```
 syscall...     #SYS_READ 
```

然后读取这个值（假设你有它在寄存器 t4 中）并决定是将它存储在失败向量中，还是通过向量。

```
 addiu t4,t4,-50     #subtract 50 from input value. 
     blez  t4,FAILED     #If its lower than 0, then read value is lower than 50 ->FAIL
PASSED:
     #STORE VALUE INTO passed_vector

FAILED:
     #STORE VALUE INTO failed_vector 
```

完成所有 15 个值后，打印出向量。这有点棘手。在使用您的程序之前，您应该用一些无效值填充两个向量，例如 -1。因此，当您将矢量打印到屏幕时，当您发现其中一个无效值时应该停止。当你在做的时候，保持一个计数器来显示有多少通过/失败。

在伪代码中

```
for both arrays
   for (i in (0,15) and array[i] not -1)
        print array[i]
        add 1 to scores count //to count passed - failed test scores. 
```

组装（填空）

```
END:
     li $t4,15
     li $t1,0
     beq $t1,$t4,EXIT   #condition. While ( i < 15) kind of thing.
     addiu $t1,$t1,-1

     #print out vectors and keep count on other registers
     #then print them out.

     syscall... #SYS_WRITE

EXIT: #exit syscall here. 
```

另一个棘手的问题是这些向量的索引。由于它们是字数组，因此您应该将循环控制变量（C 中的经典 i 变量）乘以 4（假设为 32 位字）来索引向量。如果它们是字节数组，则不需要乘法。如果它们是短数组......（好吧，你明白我的意思）

例如：

```
passed_vector[i] #(C style sintax) 
```

并让变量 i 存储在寄存器 $t1 中，结果如下：

```
 sll $t2,$t1,2             #i * sizeof(word)
  la  $a0,passed_vector     #$a0 points to passed_vector
  add $a0,$a0,$t2           #$a0 now points to passed_vector + i 
```

所以现在你可以加载/存储到passed_vector[i]

```
 sw  $t3,0($a0)            #0($a0) is passed_vector[0]
  lw  $t3,0($a0) 
```

解决这类问题（即用汇编语言编写）的一种方法是用 C（或您知道的其他语言）编写程序，然后逐条指令将其翻译成汇编语言。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T03:51:21.133

好的，这是加载两个整数数组的方法（仅此而已）

```
.data
#These are two integer arrays. Each position is 32 bits long.
passed_vector: .word -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1
failed_vector: .word -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1

.text

         #
         # Previous code here.
         #

         li $t5,50             #For comparing test_scores against.

         li $t0,0              # for (0..15)
         li $t6,15             #

LOOP:    beq $t0,$t6,CONTINUE  # loops while i<15

         li  $v0,5
         syscall      
         move $t1,$v0           #read test score and move it to register $t1

         bge $t1,$t5,PASSED    #if score >=50, load into passed_vector
FAILED:                        # else: test score lower than 50\. Loads into failed vector

         #dont forget to increment the failed counter here
         sll $t2,$t0,2         
         sw  $t1,failed_vector($t2) 

         addiu $t0,$t0,1       #i++
         b     LOOP

PASSED:

         #dont forget to increment the passed counter here.
         sll $t2,$t0,2         
         sw  $t1,passed_vector($t2) 

         addiu $t0,$t0,1       #i++
         b     LOOP

CONTINUE: #other code 
```

# java - Spring Web Flow - 如何使用conversationScope中已有的值设置单元测试？

> ID：804326
> 
> 赞同：5
> 
> 时间：2009-04-29T21:19:19.947
> 
> 标签：java, spring-webflow, spring-webflow-2

我正在使用 Spring Web Flow 2.0 开发一个项目。

我正在尝试对以决策状态开头的流程进行单元测试。决策状态检查位于`conversationScope`. `conversationScope`我不知道如何在单元测试中插入一个值。

我试过了：

```
getConversationScope().put("someName", value);
MockExternalContext context = new MockExternalContext();
startFlow(context); 
```

但是，似乎当我调用`startFlow(context)`该值时，该值已被清除。

我也试过：

```
MockExternalContext context = new MockExternalContext();
setCurrentState("someDecisionState");
resumeFlow(context) 
```

但是测试失败并出现错误，告诉我我不能从决策状态恢复，只能从视图状态恢复。

有谁知道我如何插入模拟值`conversationScope`以便我可以测试这些案例？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-24T22:56:15.900

这并不明显，但我想出了这个：

```
public void testFoo() {
    FlowExecution flowExecution = getFlowExecutionFactory().createFlowExecution(getFlowDefinition());
    updateFlowExecution(flowExecution);
    flowExecution.getConversationScope().put("fooBar", "goo");
    flowExecution.start(null, new MockExternalContext());        
    assertCurrentStateEquals("fooView");
} 
```

我不得不深入研究底层`AbstractXmlFlowExecutionTests.startFlow()`以查看它是如何实例化的`FlowExecution`，并将其中的一些复制并粘贴到单元测试中。

这是测试网络流程。

```
<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/webflow
        http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

    <action-state id="decideFoo">
        <evaluate expression="conversationScope.fooBar" />
        <transition on="goo" to="fooView" />
        <transition on="gar" to="barView" />
    </action-state>

    <view-state id="fooView" />

    <view-state id="barView" />

</flow> 
```

# c# - F5 有效，CTRL + F5 无效...？

> ID：804329
> 
> 赞同：0
> 
> 时间：2009-04-29T21:20:14.577
> 
> 标签：c#, web-services, debugging

我有一个带有 Windows 客户端和网站的简单解决方案。该网站公开了 Windows 客户端使用的 Web 服务。到目前为止，一切都很好。这是奇怪的部分。`CTRL` `F5`在 VS 中运行我的解决方案时，除非我先简单地运行它，否则当我点击时，对 Web 服务的调用不起作用`F5`。因此，每次我在新的 VS 会话中打开解决方案时，我都必须在调试 ( `F5`) 中运行它至少一次，然后它才能在不调试 ( `CTRL` `F5`) 的情况下工作。

这对我来说毫无意义。有没有其他人遇到过这样的问题？任何想法将不胜感激！

谢谢！

伊恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T03:05:22.157

对于您的网络服务（我假设它在它自己的项目中），您是否将其设置为使用本地 Web 开发服务器或 IIS？这可以在项目属性中找到。

听起来您正在使用 Web 开发服务器（称为 Casini），并且在您使用调试运行它之前不会启动。当您这样做时，系统托盘中是否会出现一个小图标？它应该。这表明 Web 服务器现在正在运行，并且您的客户端应用程序可以访问 Web 服务。

客户端应用程序项目可能设置为您的启动项目。您还可以将解决方案设置为具有多个启动项目。通过这样做，您可以确保两个项目在调试时启动（这是您在示例中想要的）。您可以通过右键单击解决方案，转到属性，然后转到通用属性 - 启动项目来设置它。在那里，选择“多个启动项目”单选按钮并选择两个项目来启动。这也将确保 Visual Studio 附加到调试所需的两个正在运行的进程。

这些说明假设您使用的是 VS2008。希望这可以帮助！

# amazon-s3 - 用于获取大量小文件的 S3 到 EC2 性能

> ID：804333
> 
> 赞同：0
> 
> 时间：2009-04-29T21:20:55.760
> 
> 标签：amazon-s3, amazon-ec2, amazon-web-services

我有大量 1kB 的数据块（大约几亿），并且需要一种方法来存储和查询这些数据块。数据块被添加，但从未被删除或更新。我们的服务部署在S3、EC2平台上。

我知道 Amazon SimpleDB 存在，但我想要一个与平台无关的解决方案（例如，如果我们需要离开 AWS）。

所以我的问题是，这两个存储和检索数据块的选项的优缺点是什么。性能比较如何？

*   将数据块作为文件存储在 S3 上，并在需要时获取它们
*   将数据块存储在 MySQL 服务器集群上

会有这么大的性能差异吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T04:19:16.750

我尝试使用 S3 作为一种“数据库”，使用微小的 XML 文件来保存我的结构化数据对象，并依靠 S3“键”来查找这些对象。

性能是不可接受的，即使从 EC2 上也是如此——到 S3 的延迟太高了。

即使有这么多记录，在 EBS 设备上运行 MySQL 也会快一个数量级。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T21:32:58.947

您是否需要直接向应用程序的用户提供对这些数据块的访问权限？如果不是，那么 S3 和 HTTP GET 请求就显得过分了。还要记住 S3 是一项安全服务，每个 GET 请求（仅 1KB 的数据）的开销将相当大。

MySQL 服务器集群会是一个更好的主意，但要在 EC2 中运行，您需要使用 Elastic Block Storage。最后，不排除 SimpleDB。这可能是您问题的最佳解决方案。仔细设计您的系统，您将能够在未来轻松迁移到其他数据库系统（分布式或关系）。

# python - 在 Python 中将 Unicode URL 转换为 ASCII（UTF-8 百分比转义）的最佳方法？

> ID：804336
> 
> 赞同：29
> 
> 时间：2009-04-29T21:21:25.603
> 
> 标签：python, url, unicode, utf-8

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-29T21:36:32.523

## Code:

```
import urlparse, urllib

def fixurl(url):
    # turn string into unicode
    if not isinstance(url,unicode):
        url = url.decode('utf8')

    # parse it
    parsed = urlparse.urlsplit(url)

    # divide the netloc further
    userpass,at,hostport = parsed.netloc.rpartition('@')
    user,colon1,pass_ = userpass.partition(':')
    host,colon2,port = hostport.partition(':')

    # encode each component
    scheme = parsed.scheme.encode('utf8')
    user = urllib.quote(user.encode('utf8'))
    colon1 = colon1.encode('utf8')
    pass_ = urllib.quote(pass_.encode('utf8'))
    at = at.encode('utf8')
    host = host.encode('idna')
    colon2 = colon2.encode('utf8')
    port = port.encode('utf8')
    path = '/'.join(  # could be encoded slashes!
        urllib.quote(urllib.unquote(pce).encode('utf8'),'')
        for pce in parsed.path.split('/')
    )
    query = urllib.quote(urllib.unquote(parsed.query).encode('utf8'),'=&?/')
    fragment = urllib.quote(urllib.unquote(parsed.fragment).encode('utf8'))

    # put it back together
    netloc = ''.join((user,colon1,pass_,at,host,colon2,port))
    return urlparse.urlunsplit((scheme,netloc,path,query,fragment))

print fixurl('http://\xe2\x9e\xa1.ws/\xe2\x99\xa5')
print fixurl('http://\xe2\x9e\xa1.ws/\xe2\x99\xa5/%2F')
print fixurl(u'http://Åsa:abc123@➡.ws:81/admin')
print fixurl(u'http://➡.ws/admin') 
```

## Output:

> `http://xn--hgi.ws/%E2%99%A5`
> `http://xn--hgi.ws/%E2%99%A5/%2F`
> `http://%C3%85sa:abc123@xn--hgi.ws:81/admin`
> `http://xn--hgi.ws/admin`

## Read more:

*   [urllib.quote()](http://docs.python.org/library/urllib.html#urllib.quote)
*   [urlparse.urlparse()](https://docs.python.org/2/library/urlparse.html#urlparse.urlparse)
*   [urlparse.urlunparse()](https://docs.python.org/2/library/urlparse.html#urlparse.urlunparse)
*   [urlparse.urlsplit()](https://docs.python.org/2/library/urlparse.html#urlparse.urlsplit)
*   [urlparse.urlunsplit()](https://docs.python.org/2/library/urlparse.html#urlparse.urlunsplit)

## Edits:

*   Fixed the case of already quoted characters in the string.
*   Changed `urlparse`/`urlunparse` to `urlsplit`/`urlunsplit`.
*   Don't encode user and port information with the hostname. (Thanks Jehiah)
*   When "@" is missing, don't treat the host/port as user/pass! (Thanks hupf)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-20T21:52:29.000

the code given by MizardX isnt 100% correct. This example wont work:

example.com/folder/?page=2

check out django.utils.encoding.iri_to_uri() to convert unicode URL to ASCII urls.

[http://docs.djangoproject.com/en/dev/ref/unicode/](http://docs.djangoproject.com/en/dev/ref/unicode/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T21:44:08.497

there's some RFC-3896 *url parsing* work underway (e.g. as part of the Summer Of Code) but nothing in the standard library yet AFAIK -- and nothing much on the *uri encoding* side of things either, again AFAIK. So you might as well go with MizardX's elegant approach.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T02:43:17.997

Okay, with these comments and some bug-fixing in my own code (it didn't handle fragments at all), I've come up with the following `canonurl()` function -- returns a canonical, ASCII form of the URL:

```
import re
import urllib
import urlparse

def canonurl(url):
    r"""Return the canonical, ASCII-encoded form of a UTF-8 encoded URL, or ''
    if the URL looks invalid.

    >>> canonurl('    ')
    ''
    >>> canonurl('www.google.com')
    'http://www.google.com/'
    >>> canonurl('bad-utf8.com/path\xff/file')
    ''
    >>> canonurl('svn://blah.com/path/file')
    'svn://blah.com/path/file'
    >>> canonurl('1234://badscheme.com')
    ''
    >>> canonurl('bad$scheme://google.com')
    ''
    >>> canonurl('site.badtopleveldomain')
    ''
    >>> canonurl('site.com:badport')
    ''
    >>> canonurl('http://123.24.8.240/blah')
    'http://123.24.8.240/blah'
    >>> canonurl('http://123.24.8.240:1234/blah?q#f')
    'http://123.24.8.240:1234/blah?q#f'
    >>> canonurl('\xe2\x9e\xa1.ws')  # tinyarro.ws
    'http://xn--hgi.ws/'
    >>> canonurl('  http://www.google.com:80/path/file;params?query#fragment  ')
    'http://www.google.com:80/path/file;params?query#fragment'
    >>> canonurl('http://\xe2\x9e\xa1.ws/\xe2\x99\xa5')
    'http://xn--hgi.ws/%E2%99%A5'
    >>> canonurl('http://\xe2\x9e\xa1.ws/\xe2\x99\xa5/pa%2Fth')
    'http://xn--hgi.ws/%E2%99%A5/pa/th'
    >>> canonurl('http://\xe2\x9e\xa1.ws/\xe2\x99\xa5/pa%2Fth;par%2Fams?que%2Fry=a&b=c')
    'http://xn--hgi.ws/%E2%99%A5/pa/th;par/ams?que/ry=a&b=c'
    >>> canonurl('http://\xe2\x9e\xa1.ws/\xe2\x99\xa5?\xe2\x99\xa5#\xe2\x99\xa5')
    'http://xn--hgi.ws/%E2%99%A5?%E2%99%A5#%E2%99%A5'
    >>> canonurl('http://\xe2\x9e\xa1.ws/%e2%99%a5?%E2%99%A5#%E2%99%A5')
    'http://xn--hgi.ws/%E2%99%A5?%E2%99%A5#%E2%99%A5'
    >>> canonurl('http://badutf8pcokay.com/%FF?%FE#%FF')
    'http://badutf8pcokay.com/%FF?%FE#%FF'
    >>> len(canonurl('google.com/' + 'a' * 16384))
    4096
    """
    # strip spaces at the ends and ensure it's prefixed with 'scheme://'
    url = url.strip()
    if not url:
        return ''
    if not urlparse.urlsplit(url).scheme:
        url = 'http://' + url

    # turn it into Unicode
    try:
        url = unicode(url, 'utf-8')
    except UnicodeDecodeError:
        return ''  # bad UTF-8 chars in URL

    # parse the URL into its components
    parsed = urlparse.urlsplit(url)
    scheme, netloc, path, query, fragment = parsed

    # ensure scheme is a letter followed by letters, digits, and '+-.' chars
    if not re.match(r'[a-z][-+.a-z0-9]*$', scheme, flags=re.I):
        return ''
    scheme = str(scheme)

    # ensure domain and port are valid, eg: sub.domain.<1-to-6-TLD-chars>[:port]
    match = re.match(r'(.+\.[a-z0-9]{1,6})(:\d{1,5})?$', netloc, flags=re.I)
    if not match:
        return ''
    domain, port = match.groups()
    netloc = domain + (port if port else '')
    netloc = netloc.encode('idna')

    # ensure path is valid and convert Unicode chars to %-encoded
    if not path:
        path = '/'  # eg: 'http://google.com' -> 'http://google.com/'
    path = urllib.quote(urllib.unquote(path.encode('utf-8')), safe='/;')

    # ensure query is valid
    query = urllib.quote(urllib.unquote(query.encode('utf-8')), safe='=&?/')

    # ensure fragment is valid
    fragment = urllib.quote(urllib.unquote(fragment.encode('utf-8')))

    # piece it all back together, truncating it to a maximum of 4KB
    url = urlparse.urlunsplit((scheme, netloc, path, query, fragment))
    return url[:4096]

if __name__ == '__main__':
    import doctest
    doctest.testmod() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T21:36:42.103

You might use [`urlparse.urlsplit`](http://docs.python.org/library/urlparse.html#urlparse.urlsplit) instead, but otherwise you seem to have a very straightforward solution, there.

```
protocol, domain, path, query, fragment = urlparse.urlsplit(url) 
```

(You can access the domain and port separately by accessing the returned value's named properties, but as port syntax is always in ASCII it is unaffected by the IDNA encoding process.)

# sql-server - SQL Server 2005 - 有没有办法在事务中锁定 SELECT？

> ID：804338
> 
> 赞同：2
> 
> 时间：2009-04-29T21:21:53.137
> 
> 标签：sql-server

有没有办法在事务中锁定 SELECT？如果发生 SELECT，则在第一个未完成时不再执行 SELECT。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T21:24:45.313

可能想查看[隔离级别而不是](http://msdn.microsoft.com/en-us/library/ms173763.aspx)提示

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T21:38:10.650

不确定我是否正确理解了您的问题，但是如果您想施加比 SQL Server 的默认值更严格的锁定，那么您可以提高隔离级别或使用锁定提示。如果您首先需要 SELECT 某些内容，然后稍后根据 SELECTed 的值执行 UPDATE，这将很有用。为避免来自另一个事务的幻像 UPDATE（其中您之前选择的值在 SELECT 和 UPDATE 中已更改），您可以在 SELECT 语句上施加更新锁。

例如：

```
 select * from mytable with (holdlock, xlock) 
```

请注意，上面的 SELECT 语句使用更严格的更新锁并在事务期间持有该锁。您还希望将语句包装在显式事务中，如：

```
begin transaction
select * from mytable with (holdlock, xlock) -- exclusive lock held for the entire transaction
-- more code here...
update mytable set col='whatever' where ...
commit transaction 
```

当然，对于长时间运行的交易要小心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:33:40.613

您需要一个隔离级别`SERIALIZABLE`：

```
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE 
```

在这种情况下，其他`SELECT`查询将阻塞，直到事务完成。默认级别通常是 READ COMMITTED。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T21:46:21.253

看来您正在寻找一种悲观的锁定策略，但实际上并没有锁定您的数据。查看sql server 中的[应用程序锁](http://www.sqlteam.com/article/application-locks-or-mutexes-in-sql-server-2005)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T18:16:33.120

更改隔离级别通常是您的最佳选择。

但是，如果出于某种原因这不是您的选择-您也可以执行独占表锁...

```
select * from MyTable with (tablockx) 
```

这将阻止表上的任何其他选择，直到您的事务完成。

# wpf - WPF自定义绘制多个进度条

> ID：804347
> 
> 赞同：3
> 
> 时间：2009-04-29T21:23:29.547
> 
> 标签：wpf, custom-controls, progress-bar

在处理一组项目时，我想显示一个组状态的统一图像，所以我基本上在同一个单元格中制作了一个由多个具有透明背景和各种彩色前景的进度条组成的网格。

[![示例图像](https://i.stack.imgur.com/u7RJ4.png)](https://i.stack.imgur.com/u7RJ4.png)

我遇到了一些透明度伪影（紫色条实际上是绿色下面的紫色，有时它会在顶部绘制等），这似乎有点浪费。所以，我决定自己做，但现在我对如何做有点不知所措。我是在 FrameworkElement 的 OnRender 中使用 DrawingContext，还是有更简单的方法？在进行自己的控制时，是否有一套通用规则？

我考虑改用饼图，因为这些很容易获得，但现在是我做一些非现成的事情的时候了。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-21T18:14:08.093

我不太确定你打算如何让进度条组合不同的进度，但是如果说最远的进度在 z-index 的底部，而最少的进度在顶部，那么我会在这行：

1）我可能会为这个新的进度条创建一个用户控件。

2) 它将有一个名为 NumberOfProgresses 的属性，该属性与包含所述进度状态的数组相关联。

3) 每个进度都将由一个边框项（或者可能更适合可视树的东西）表示，因为它是一个具有背景属性的简单 wpf 控件。background 属性将设置为漂亮的进度样式，进度颜色可以绑定在样式中，以表示边框的borderbrush 属性。使设置进度的颜色变得容易。

4) 用户控件将有一个 UpdateProgress 方法，该方法将数组中的百分比值和进度索引作为参数。

5）随着进度的更新，您可以只计算边框的适当宽度（用户控制实际宽度 * 百分比）并使用 Z 索引使其显示在顶部/底部，或者水平堆叠边框，设置首先是最少的进度，然后对于其余的进度，您必须减去以前的进度长度才能获得相同的效果。

这样就不会出现透明度引起的伪影，也不会出现 OnRender()...请注意，在 WPF 中，没有理由将 OnRender this 和 OnRender that 搞乱，就像 WinForms 和 OnPaint 一样。只需通过代码设置元素以获得您想要的外观，然后让 WPF 进行渲染；）

不过，我可以想象这个用户控件存在一个问题。您必须向用户提供关于哪种颜色属于哪个进度的反馈。但这可能会让你回到第一方，这意味着只显示多个进度条会更好/更简单。

# .net - 额外进程文件锁

> ID：804356
> 
> 赞同：1
> 
> 时间：2009-04-29T21:26:02.317
> 
> 标签：.net, access-control, file-locking

我有一个 .NET 系统，我需要在其中允许跨进程边界锁定和解锁文件。我打算使用的模型是这样的：

1.  用户生成锁定令牌
2.  使用令牌锁定文件并刷新令牌
3.  根据需要在 #2 重复
4.  使用通过释放令牌来解锁所有文件
5.  如果使用在某个时间范围内无法刷新令牌，#4 会自动发生

每个步骤都可以从不同的过程中完成。

问题有两个：*这是一个合理的模型吗？是否有任何现成的工具可以实现它？*如果这不能直接在操作系统中完成，我正在考虑使用`.file`s 等进行某种咨询锁定。

*编辑：此模式获得非独占读锁，但其他模式可以获得独占写锁，但它们总是由获得它们的同一进程释放。*

# objective-c - 说 Getter 是实例变量的所有者是否有效？或者谁拥有它？

> ID：804361
> 
> 赞同：-1
> 
> 时间：2009-04-29T21:28:35.383
> 
> 标签：objective-c, cocoa, cocoa-touch, uikit

实际上我会说：是的，Getter 是所有者。因此，任何调用 Getter 的人都不负责释放内存。或者更准确地说，对象本身就是拥有者，但Getter充当了将实例变量传递给其他人的机制。这是对的，还是我弄错了？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T23:42:51.287

谈论*对象*而不是方法，拥有对象更有意义。

很多时候，调用 getter 的对象是被返回对象的所有者，因为返回值是一个实例变量：

*   (Foo*) foo { 返回 _foo; // 我的实例变量 }

但是，getter 创建一个已自动释放的临时对象并将其返回也很常见：

*   (NSString*) sizeStr { return [NSString stringWithFormat: @"%d", self.size]; }

在这种情况下，该对象（NSString）实际上并没有所有者，除了当前的自动释放池，它会在它退出时释放它。

在（非 GC）Cocoa 编程中要记住的重要规则与所有权本身无关，但与何时引用对象（您必须在某个时候释放）以及何时不相关不。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T21:58:49.727

由于您询问的是使用引用计数系统的 Cocoa，因此不存在“所有者”之类的东西。每个拥有保留引用的人都是部分所有者，负责释放他们的引用。当最后一个引用被释放时，对象被释放。

按照惯例，getter 不会给调用者保留引用，但这并不意味着调用者不能选择显式保留对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:34:52.030

本质上您是正确的，但这只是惯例问题。只要您的约定始终如一地应用，并且从事该项目的每个人都同意这一点，那么您就是黄金。

你可能会遇到麻烦的地方是，如果调用者缓存了一个指向它从访问器获取的内存的指针，然后对象被破坏，现在指针悬空。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T21:43:29.683

这取决于。

您应该决定对象所有权策略。但一般来说，如果一个对象是另一个对象的子对象（成员），则它所属的对象对其生命周期负责，并且（通常）将其清理为析构函数。

分发内存以由调用者清理通常是不受欢迎的。在 C 中，必须为调用者分配内存的库（例如，X Windows 库或用于数据库客户端的 C API）将分发一个不透明的指针，调用者必须通过调用另一个库函数来销毁该指针：

```
 Window foo = APIcreateWindow();
 APIsetupWindow(foo, x, y, z );
 AOIshowWindow(foo);
 APIdestroyWindow(foo);  //forgetting to call this leaks memory 
```

在那个（假设的）代码中，`Window`实际上是指向结构的指针的 typedef；APICreateWindow 为结构分配内存，APIdestroyWindow 在做其他 API 簿记之后对其进行免费调用。

在 C++ 中，我们可能会交还一个智能指针，当没有其他东西引用它时它会自行销毁。

# .net - ASP.NET Web 服务 WebMethod

> ID：804363
> 
> 赞同：0
> 
> 时间：2009-04-29T21:29:53.540
> 
> 标签：.net, web-services, asmx

我有一个从 jquery.ajax 成功调用的 .asmx web 服务 webmethod。网络方法运行正常。但是，它的执行速度非常慢。

该方法本身现在做的工作很少。我添加了 CacheDuration = 120。这没有帮助。我真正关心的是实际调用该方法需要多长时间。在本地运行网站并在 Web 方法的第一行使用断点启动 VS2008 调试器时，甚至需要将近 5 秒才能到达第一行。然后在调试器中点击继续，响应立即发生。所以 webmethod 似乎不是慢的“东西”。

有没有人经历过类似的行为？是否需要为 web 服务/方法设置一些东西才能更快地调用？

代码：

```
[WebService(Namespace = "http://intranet/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[ToolboxItem(false)]
[System.Web.Script.Services.ScriptService]
public class DocumentService : System.Web.Services.WebService
{

  [System.Web.Script.Services.ScriptMethod(ResponseFormat = ResponseFormat.Json)]
  [System.Web.Services.WebMethod(EnableSession = true, CacheDuration = 120)]
  public Tree[] GetDocumentTree(string root)
  {........ 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T04:06:00.907

确保您的问题不仅仅是 JIT 或加载时间。在第一次调用时，Web 服务必须编译和加载可能很昂贵的程序集。如果问题在以后的调用中仍然存在，请检查您的代理设置。

我们遇到了同样的问题。我们的延迟比你的要严重得多（每次通话总共 2 分钟）。我们从作为域用户运行的 Windows 服务内部调用 Web 服务。该用户帐户显然已打开其代理设置。因此，对于本地 Web 服务的每个 HttpRequest，支持 ServicePoint 都尝试从不存在的代理服务器获取 wpad.dat 文件。该呼叫需要 20 秒才能超时。更糟糕的是，在 .net 库中获取代理的代码周围存在全局锁定。所以调用堆栈等待网络超时。进行调用的服务是我们的队列进程，它处理我们所有的异步行为。所以整个系统都备份了。

如果您想查看代码，请查看 Reflector 中的 System.Net.AutoWebProxyScriptEngine.GetProxies。

由于我没有相关用户帐户的权限，我今天通过添加到 app.config 文件来解决我们的问题。

如果您的方法打算使用 ajax 调用，那么您必须正确设置浏览器。尝试在 Connections\Lan 设置中禁用自动检测设置。发现问题后，我在网上浏览了一下，显然 IE7 在此设置开启时会出现延迟问题。如果您确实有代理服务器，则在同一对话框中手动输入服务器地址。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:37:06.377

您可以使用 Fiddler 或 FireBug 找出慢的部分。确保您已经访问过一次 Web 服务，以便在计时之前对其进行编译。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:34:10.437

还要在服务器端使用 JetBrains dotTrace。一旦我这样做了，发现某个 .asmx 页面需要很长时间才能加载，因为在其构造函数中初始化了变量。（特别是 Web 服务引用需要很长时间来构建。）

# visual-studio-2008 - 来自 VS2008 的 C++ 类型信息

> ID：804372
> 
> 赞同：3
> 
> 时间：2009-04-29T21:33:11.317
> 
> 标签：visual-studio-2008, visual-c++

编译 C++ 时是否可以让 Visual Studio 输出任何类型信息？GCC 有 GCC-XML，我想知道 VS2008 有类似的东西。

谢谢

本

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-04T15:36:13.720

这个问题有很多解决方案；

1.  当然还有 XML 文档。
2.  您可以在“C/C++”-> 输出文件、“扩展属性源”以及各种级别的汇编器输出列表下启用属性源输出。

    *不幸的是，这些方法相当费力且非结构化（即手动破解语法）。*

3.  所有 C/C++ 项目默认启用 RTTI。这是 C# 反射的先驱，您可以使用它来提取[结构](http://www.cpptalk.net/1-vt58273.html?start=0)良好且准确的信息。
4.  Name Mangling，即使在 RTTI 不可用时也会出现。C++ 二进制文件可能依赖于原始代码减速的这种打包公式，以启用运行时多态性或其他 oo'ness 模板化功能；）。无论如何，尽管名称修饰没有很好的文档记录，但在调试 SDK 中甚至实际上在 Windows Win32 APi 中都存在一个 API 调用，它将为您“取消修饰”修饰的表示。然后，您可能仍然需要转换未修饰的格式，无论如何，在这一点上它是相当微不足道的。
5.  PDB 文件，您可以使用 DIA SDK 来查询您编译的 PDB。PDB 中包含的信息有多个级别的详细信息（公共与私人），但通常绰绰有余。
6.  看看 MSR 的新一代编译器 Phoenix，它具有令人印象深刻的二进制/源代码自省能力。
7.  CodeDom，您可以使用 MSVC SDK 和领域特定语言 (DSL) 库来相当轻松地编写自己的代码解析器。
8.  实际上，MSVC 中还有其他几个自动化和非 DSL API，您可以使用它来完成某些事情，可能不那么全面，但这取决于您的需求。无论如何，您可以找到的有关这些其他 API 的大多数示例和信息都是用 BASIC 编写的，因此除非您了解 VB（每次我必须查看 VB 代码时我都真的被难住了），您的能力可能会有所不同。
9.  我可以继续.... ;) 但我对 9 很好。

# c# - 从每个组件捕获鼠标事件

> ID：804374
> 
> 赞同：30
> 
> 时间：2009-04-29T21:33:42.110
> 
> 标签：c#, winforms, mouseevent

我的 WinForm C# 应用程序上的 MouseEvents 有问题。

我想在我的应用程序上获得*所有*鼠标点击，但我不想在每个子组件中都放置一个侦听器，也不使用 Windows 鼠标钩子。

在 Flash 上，我可以在舞台上放置一个侦听器来获取电影中的所有 MouseEvent。

C#上有这样的东西吗？一个全局鼠标监听器？

* * *

**编辑：**

我从 IMessageFilter 和使用的 Application.AddMessageFilter 创建这个类。

```
public class GlobalMouseHandler : IMessageFilter{

    private const int WM_LBUTTONDOWN = 0x201;

    public bool PreFilterMessage(ref Message m){
        if (m.Msg == WM_LBUTTONDOWN) {
            // Do stuffs
        }
        return false;
    }
} 
```

并将这段代码放在需要监听全局点击的控件上：

```
GlobalMouseHandler globalClick = new GlobalMouseHandler();
Application.AddMessageFilter(globalClick); 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-29T21:42:52.447

一种直接的方法是通过调用`Application.AddMessageFilter`和编写实现`IMessageFilter`接口的类来添加消息循环过滤器。

通过`IMessageFilter.PreFilterMessage`，您的班级可以看到通过应用程序消息循环的任何输入消息。`PreFilterMessage`还可以决定是否将这些消息传递给它们所指定的特定控件。

这种方法引入的一个复杂性是必须通过传递给您的`PreFilterMessage`方法的 Message 结构来处理 Windows 消息。这意味着参考 Win32 文档等`WM\_LBUTTONDOWN, WM\_MOUSEMOVE`，`WM\_LBUTTONUP`而不是传统的`MouseDown`,`MouseMove`和`MouseUp`事件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-10T16:39:47.127

**样本类**

```
class CaptureEvents : IMessageFilter
{
    #region IMessageFilter Members
    public delegate void Callback(int message);
    public event Callback MessageReceived;

    IntPtr ownerWindow;
    Hashtable interestedMessages = null;
    CaptureEvents(IntPtr handle, int[] messages)
    {
        ownerWindow = handle;
        for(int c = 0; c < messages.Length ; c++)
        {
            interestedMessages[messages[c]] = 0;
        }
    }
    public bool PreFilterMessage(ref Message m)
    {
        if (m.HWnd == ownerWindow && interestedMessages.ContainsKey(m.Msg))
        {
            MessageReceived(m.Msg);
        }
        return true;
    }

    #endregion
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T21:49:08.453

[看看这篇文章](http://www.codeproject.com/KB/cs/event_broadcast.aspx)。它递归地挂钩所有控制事件并广播它们。您还可以在表单中覆盖[WndProc](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.wndproc(vs.71).aspx)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-29T21:53:51.517

如果您不想通过覆盖 Form.PreProcessMessage 或 Form.WndProc 来处理消息，那么您可以将 Form 子类化以将事件处理程序挂钩到来自表单上各种控件的所有 MouseClick 事件。
编辑：忘记通过表单上控件的子控件进行递归。

```
 public class MousePreviewForm : Form
    {
      protected override void OnClosed(EventArgs e)
      {
         UnhookControl(this as Control);
         base.OnClosed(e);
      }

      protected override void OnLoad(EventArgs e)
      {
         base.OnLoad(e);

         HookControl(this as Control);
      }

      private void HookControl(Control controlToHook)
      {
         controlToHook.MouseClick += AllControlsMouseClick;
         foreach (Control ctl in controlToHook.Controls)
         {
            HookControl(ctl);
         }      
      }

      private void UnhookControl(Control controlToUnhook)
      {
         controlToUnhook.MouseClick -= AllControlsMouseClick;
         foreach (Control ctl in controlToUnhook.Controls)
         {
            UnhookControl(ctl);
         }
      }

      void AllControlsMouseClick(object sender, MouseEventArgs e)
      {
         //do clever stuff here...
         throw new NotImplementedException();
      }
   } 
```

然后，您的表单将需要从 MousePreviewForm 而不是 System.Windows.Forms.Form 派生。

# mysql - “=”的MySQL通配符 - 有没有

> ID：804381
> 
> 赞同：19
> 
> 时间：2009-04-29T21:36:39.187
> 
> 标签：mysql, wildcard

所以，

```
SELECT * FROM table WHERE col LIKE '%' 
```

将返回一切。查询是否有通配符

```
SELECT * FROM table WHERE col = '*' 
```

显然`*`不起作用，我只是把它放在那里表明我想要一个通配符。我从中选择的列包含 1 到 12 之间的整数，并且我希望能够选择具有特定数字的所有记录或具有通配符的所有记录。

谢谢，

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-29T21:43:39.933

LIKE 与 = 基本相同，除了 LIKE 允许您使用通配符。

这两个查询将返回相同的结果：

```
SELECT * FROM table WHERE col LIKE 'xyz';
SELECT * FROM table WHERE col='xyz'; 
```

LIKE 查询中没有“%”，它实际上与“=”相同。

如果您在整数列上进行选择，则应考虑使用 IN() 或 BETWEEN 运算符。听起来您有两个单独的条件应该在代码中处理，而不是在查询中处理，因为您的条件要求您至少需要两种不同类型的查询。

编辑：我应该澄清 LIKE 和 = 仅在正常的、单调的字符串比较用法中相似。您应该查看[MySQL 手册](http://dev.mysql.com/doc/refman/5.0/en/string-comparison-functions.html)以了解其工作原理的详细信息，因为在某些情况下它并不相同（例如语言集）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-29T21:40:28.350

如果要选择所有内容，为什么要附加 WHERE 子句？只需有条件地将其关闭，而不是将通配符放入其中。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-29T21:39:20.850

使用 LIKE 的原因是因为 = 不提供通配符支持。否则不会有 LIKE 的理由

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T21:40:25.153

```
SELECT * FROM table WHERE col RLIKE '.*' 
```

即正则表达式LIKE。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T21:42:35.583

假设您的查询是参数驱动的，case 语句可能是合适的

```
select * from mytable
where col like case when @myvariable is null then % else myvariable end 
```

如果`@myvariable`您不想要一个值，则为 null ，否则它将使用您传入的整数值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T22:43:47.403

zombat 的回答很棒，但我只在他的回答中注意到您正在选择整数。他提到了 IN() 和 BETWEEN()。下面是使用这些语法的示例，以及整数字段的其他一些选项。

```
SELECT * FROM table WHERE col = 1;
SELECT * FROM table WHERE col BETWEEN 1 AND 12;
SELECT * FROM table WHERE col BETWEEN 6 AND 12;
SELECT * FROM table WHERE col <= 6;
SELECT * FROM table WHERE col < 6;
SELECT * FROM table WHERE col >= 6;
SELECT * FROM table WHERE col > 6;
SELECT * FROM table WHERE col <> 6;
SELECT * FROM table WHERE col IN (1,2,5,6,10);
SELECT * FROM table WHERE col NOT IN (1,2,5,6,10); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-12T09:50:46.320

我在为报告构建存储过程时遇到过这种情况以下是我的解决方案，希望这是您的想法:)

```
set @p = "ALL"; 
```

询问：

```
select * from fact_orders
where
dim_country_id = if(@p is null or @p="ALL", dim_country_id, @p)
limit 10
; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-26T22:46:23.960

如果您的值在 (1,12) 范围内，则：

select * from table where col>=5 and col<=5; //这等于col=5

select * from table where col>=0 and col<=12; //这等于 col=any 值

通过适当地选择 2 个参数，同一行可以产生两种效果。当我需要一个准备好的语句时，我遇到了类似的问题，它应该以两种不同的方式工作，要么检查列中的特定值，要么完全忽略该列。

# jquery - 更改右键单击另存为的 HREF 属性？

> ID：804388
> 
> 赞同：2
> 
> 时间：2009-04-29T21:39:07.090
> 
> 标签：jquery, attributes, href

所以我有这个...

```
$(this).attr("href", "http://site.com/images/downloads/wp-" + $(this).parent().parent().attr("id") + "-1024x768.jpg"); 
```

问题是当我右键单击 > 将链接另存为...时，它没有链接到正确的图像。我不确定是否可以这样做，但如果有人可以帮助我，我将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T22:14:39.377

使用 Firebug 或 DOM Inspector 之类的诊断工具来检查属性的实际最终值。

对于不同的点击和保存行为，最简单的解释是事件是否被拦截。“另存为”使用实际的 href 值，而选择链接可能会被截获（键盘、鼠标向下和向上、单击）以将位置设置为其他内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T21:50:44.697

您可能正在设置它，`$(document).ready()`但您使用的事实表明您`$(this)`的代码绑定`onclick`到`<a>`. 这可以解释为什么将鼠标悬停在链接上不会显示更改的 href，在访问者单击链接之前该值不会更改。

你能应该你的相关部分`$(document).ready()`来证实我的怀疑吗？

如果我是正确的，那么解决方案应该是更改 href 作为您`ready()`处理的一部分，而不是当时绑定到 onclick 事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-20T15:26:32.273

这是一个想法...将“真实”位置放在php生成的html中

然后添加一个带有“假”位置的额外属性，然后使用 jquery 在页面加载时切换它们。这可以根据情况工作（即，如果用户禁用了 js 并且它使用“真实”位置，它不会破坏一切）

这将解决您的问题，并使几乎所有用户的最终结果都相同:)

# sql - SQL 查询问题：X 有很多 Y。获取所有 X 并仅获取每个 X 中最新的 Y

> ID：804397
> 
> 赞同：1
> 
> 时间：2009-04-29T21:41:21.967
> 
> 标签：sql, mysql, database, join

假设我们有两张桌子。发布和评论。帖子有很多评论。假装他们有点填满，所以每个帖子的评论数量是不同的。我想要一个查询，它将获取所有帖子，但只有每个帖子的最新评论。

我已被定向到联接和子查询，但我无法弄清楚。

示例输出：

帖子 1：评论 4（帖子 1 的最新）

Post2：Comment2（post2 的最新版本）

Post3：评论 10（post3 的最新）

ETC...

任何帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T21:44:41.757

该答案假定您对每条评论都有一个唯一标识符，并且数量不断增加。也就是说，后面的帖子比以前的帖子有更多的数字。不必是顺序的，只需与输入的顺序相对应。

首先，执行一个查询，提取最大评论 ID，按帖子 ID 分组。

像这样的东西：

```
SELECT MAX(ID) MaxCommentID, PostID
FROM Comments
GROUP BY PostID 
```

这将为您提供一个帖子 ID 列表，以及每个帖子的最高（最新）评论 ID。

然后你加入这个，从评论中提取其余数据，用于那些 id。

```
SELECT C1.*, C2.PostID
FROM Comments AS C1
     INNER JOIN (
         SELECT MAX(ID) MaxCommentID, PostID
         FROM Comments
         GROUP BY PostID
     ) AS C2 ON C1.CommentID = C2.MaxCommentID 
```

然后，您加入帖子，以获取有关这些帖子的信息。

```
SELECT C1.*, P.*
FROM Comments AS C1
     INNER JOIN (
         SELECT MAX(ID) MaxCommentID, PostID
         FROM Comments
         GROUP BY PostID
     ) AS C2 ON C1.CommentID = C2.MaxCommentID
     INNER JOIN Posts AS P ON C2.PostID = P.ID 
```

* * *

另一种方法根本不使用内部查询的 PostID。首先，选择所有唯一帖子的最大评论 ID，但不要关心哪个帖子，我们知道它们是唯一的。

```
SELECT MAX(ID) AS MaxCommentID
FROM Comments
GROUP BY PostID 
```

然后执行一个 IN 子句，以获取这些注释的其余数据：

```
SELECT C1.*
FROM Comments
WHERE C1.ID IN (
    SELECT MAX(ID) AS MaxCommentID
    FROM Comments
    GROUP BY PostID
) 
```

然后只需加入帖子：

```
SELECT C1.*, P.*
FROM Comments AS C1
     INNER JOIN Posts AS P ON C1.PostID = P.ID
WHERE C1.ID IN (
    SELECT MAX(ID) AS MaxCommentID
    FROM Comments
    GROUP BY PostID
) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T21:45:46.963

从子查询中选择最新的评论

例如

```
Select * 
from Posts po
Inner Join
(
Select CommentThread, CommentDate, CommentBody, Post from comments a
inner join 
(select commentthread, max(commentdate)
from comments b
group by commentthread)
on a.commentthread = b.commentthread
and a.commentdate = b.commentdate
) co
on po.Post = co.post 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T21:51:11.477

```
 select *
   from post
      , comments
  where post.post_id = comments.post_id
    and comments.comments_id = (select max(z.comments_id) from comments z where z.post_id = post.post_id) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T21:56:44.253

如果你仍然坚持使用旧的 mysql 版本，那不知道子查询，你可以使用类似的东西

```
选择
  p.id, c1.id
从
  帖子为 p
左连接
  评论为 c1
在
  p.id = c1.postId
左连接
  评论为 c2
在
  c1.postId = c2.postId
  和 c1.id < c2.id
在哪里
  isnull(c2.id)
订购方式
  p.id
```

[无论哪种方式，请使用EXPLAIN](http://dev.mysql.com/doc/refman/5.0/en/using-explain.html)检查您的查询是否存在性能问题。

# php - CodeIgniter：创建新的助手？

> ID：804399
> 
> 赞同：187
> 
> 时间：2009-04-29T21:41:29.080
> 
> 标签：php, codeigniter, codeigniter-helpers

我需要以不同的方式循环大量数组并将其显示在页面中。数组由模块类生成。我知道最好不要在“视图”中包含函数，我想知道在哪里插入函数文件。

我知道我可以“扩展”助手，但我不想扩展助手。我想用我的循环函数创建一个助手。让我们称之为 loops_helper.php

* * *

## 回答 #1

> 赞同：391
> 
> 时间：2009-04-29T22:16:24.643

CodeIgniter 助手是一个具有多个函数的 PHP 文件。*这不是一堂课*

创建一个文件并将以下代码放入其中。

```
<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

if ( ! function_exists('test_method'))
{
    function test_method($var = '')
    {
        return $var;
    }   
} 
```

将此保存到**application/helpers/**。我们称之为“new_helper.php”

第一行的存在是为了确保文件不能被包含并从 CodeIgniter 范围之外运行。这之后的一切都是不言自明的。

# 使用助手

* * *

这可以在您的**控制器**、**模型**或**视图**中（不推荐）

```
$this->load->helper('new_helper');

echo test_method('Hello World'); 
```

如果您在很多位置使用此帮助程序，您可以通过将其添加到自动加载配置文件（即`<your-web-app>\application\config\autoload.php`.

```
$autoload['helper'] = array('new_helper'); 
```

-马修

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2009-05-15T13:44:07.787

一些允许您在帮助程序中使用 CI 实例的代码：

```
function yourHelperFunction(){
    $ci=& get_instance();
    $ci->load->database(); 

    $sql = "select * from table"; 
    $query = $ci->db->query($sql);
    $row = $query->result();
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-05-20T20:32:53.720

对我来说，只适用`"_helper"`于在 php 文件中添加文本，例如：

![Codeiginiter 助手](https://i.stack.imgur.com/02BqC.png)

并自动加载文件夹**aplication -> 文件 autoload.php**中的助手，在数组助手的名称中添加不带“_helper”的名称，如：

> $autoload['helper'] = array('comunes');

有了它，我可以使用所有助手的功能

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-30T09:51:47.373

要创建一个新的助手，您可以按照[The Pixel Developer 的说明](https://stackoverflow.com/questions/804399/codeigniter-create-new-helper/804520#804520)进行操作，但我的建议是不要仅为特定应用程序的特定部分所需的逻辑创建助手。相反，在控制器中使用该逻辑将数组设置为其最终预期值。[一旦你得到它，你就可以使用模板解析器类](http://ellislab.com/codeigniter/user-guide/libraries/parser.html)将它们传递给视图，并且（希望）你可以使用简单的变量或变量标记对而不是 echo 和 foreachs 来保持视图与任何看起来像 PHP 的东西无关。IE：

```
{blog_entries}
<h5>{title}</h5>
<p>{body}</p>
{/blog_entries} 
```

代替

```
<?php foreach ($blog_entries as $blog_entry): ?>
<h5><?php echo $blog_entry['title']; ?></h5>
<p><?php echo $blog_entry['body']; ?></p>
<?php endforeach; ?> 
```

这种方法的另一个好处是，您不必担心添加 CI 实例，就像使用自定义帮助程序来完成所有工作一样。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-07T07:57:28.577

**在/application/helpers**中使用您的助手名称创建一个文件，并将其添加到自动加载配置文件/手动加载它。

例如，在**/application/helpers**中放置一个名为**user_helper.php**的文件，其中包含以下内容：

 **```
<?php
  function pre($var)
  {
    echo '<pre>';
    if(is_array($var)) {
      print_r($var);
    } else {
      var_dump($var);
    }
    echo '</pre>';
  }
?> 
```

现在您可以通过加载帮助程序`$this->load->helper(‘user’);`或将其添加到**application/config/autoload.php**配置。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-04-17T11:40:27.473

只需在应用程序助手目录中定义一个助手，然后从您的控制器调用函数名称，如

```
helper name = new_helper.php
function test_method($data){
 return $data
} 
```

在控制器中加载助手

```
$this->load->new_helper();
$result =  test_method('Hello world!');
if($result){
 echo $result
} 
```

输出将是

```
Hello World! 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-05-02T08:00:00.997

要从配置文件中检索项目，请使用以下函数：

`$this->config->item('item name');` 其中 item name 是您要检索的 $config 数组索引。例如，要获取您的语言选择，您将执行以下操作：

`$lang = $this->config->item('language');` 如果您尝试获取的项目不存在，该函数将返回 FALSE（布尔值）。

如果您使用 $this->config->load 函数的第二个参数来将配置项分配给特定索引，您可以通过在 $this->config- 的第二个参数中指定索引名称来检索它>item() 函数。例子：

// 加载名为 blog_settings.php 的配置文件并将其分配给名为“blog_settings”的索引

```
$this->config->load('blog_settings', TRUE); 
```

// 检索 blog_settings 数组中包含的名为 site_name 的配置项

```
$site_name = $this->config->item('site_name', 'blog_settings'); 
```

// 另一种指定相同项目的方法：

```
$blog_config = $this->config->item('blog_settings'); 
```

$site_name = $blog_config['site_name'];

# amazon-s3 - 从 S3 向 EC2 请求对象的延迟

> ID：804406
> 
> 赞同：17
> 
> 时间：2009-04-29T21:43:39.950
> 
> 标签：amazon-s3, amazon-ec2, latency

从 EC2 实例从 S3 获取对象的延迟是多少。

例如，当通过完整路径请求对象时，该对象的实际数据流开始流回之前多少毫秒。

*   如果对象存在于 S3
*   如果对象不存在并发送404

延迟，而不是吞吐量。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-05-14T04:22:30.750

从 EC2 到 S3，我们通常会遇到大约 200-300 毫秒的延迟。它比您预期的要慢得多。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-29T22:02:34.897

我不认为 AWS 对延迟做出保证，但使用 EC2 中的 S3 肯定会比通过 Web 更快。如果您想了解 S3 在实践中的表现如何，请查看[http://www.cloudstatus.com/](http://www.cloudstatus.com/)。不幸的是，该站点仅提供吞吐量统计信息，但我认为您可能对此感兴趣。您可能还对他们的可用性保证感兴趣： http: [//aws.amazon.com/s3-sla/](http://aws.amazon.com/s3-sla/)

# c# - 解释失败原因的最佳方法

> ID：804413
> 
> 赞同：2
> 
> 时间：2009-04-29T21:46:18.023
> 
> 标签：c#

假设我在一个对象中有以下方法：

```
public class foo
{
    public bool DoSomethingAwesome()
    {
        bool bar = DidSomething() //suppose this sends an email;
        return bar;
    }

} 
```

如果我想提供更多关于为什么 DidSomething 返回 false 的详细信息，最佳做法是将消息分配给 foo 的属性，或者将 Out 参数分配给 DoSomethingAwesome？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T21:49:28.187

我认为这在很大程度上取决于您使用的框架（即这是一个约定）。

*   对于 Win32 - 你有 SetLastError、GetLastError。
*   对于 .NET，它通常会引发异常，但可以根据您的情况进行更改。

可能一个输出参数就可以了。

如果您决定使用 Exception 路线，MSDN 有一个带有“ [Design Guidelines for Exceptions](http://msdn.microsoft.com/en-us/library/ms229014.aspx) ”的条目。[在“框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321545613)”一书中有一个很好的讨论——第 7 章，我强烈推荐！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T21:52:31.723

这在很大程度上取决于你在做什么，但在给定的情况下——发送电子邮件——我会根据出现的问题抛出不同的异常。由于每次发送电子邮件都应该正常工作，当发生不好的事情时，我想强制调用者处理它而不是默认忽略它。

在其他情况下，失败的可能性很高，失败可以忽略，或者`false`不一定意味着失败，我会创建一个`enum`为每种类型的失败和一个成功的值，并返回它而不是`bool`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T22:00:44.930

看看我的回答：

[在 BLL 中处理异常并返回给客户端（winforms 或 webforms）？](https://stackoverflow.com/questions/800161/handing-exception-in-bll-and-return-to-client-either-winforms-or-webforms/800202#800202)

也许它有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T23:45:28.610

如果错误条件不是“异常”（*不是很少但均匀发生*），那么您不应该使用异常。在这种情况下，使用 out 参数要好得多。

# c# - 删除列表中的最后一项时数据绑定出现 InvalidOperationException

> ID：804414
> 
> 赞同：6
> 
> 时间：2009-04-29T21:46:19.473
> 
> 标签：c#, winforms, data-binding, bindingsource, bindinglist

当我尝试删除 datagridview 中的最后一项时，我收到以下消息。

> DataBinding 在列表中找不到适合所有绑定的行。

我的绑定设置如下。

```
ExtendedBindingList<MyClass> bl = new ExtendedBindingList<MyClass>(GetDataFromDB());
BindingSource bs = new BindingSource();
bs.DataSource = bl;
dgv.DataSource = bs; 
```

ExtendedBindingList 只是我拼凑起来的一个简单的东西，用于实现排序和过滤以及一些基本的状态持久性。dgv 是 DataGridView。GetDataFromDB 返回 MyClass 的列表。

仅当我尝试使用以下方法从 datagridview 中删除最后一项时才会出现此问题：

```
bs.RemoveCurrent(); 
```

在所有其他时间都有效。我对解决方案的唯一提示是删除所有绑定并重新应用它们，但这似乎不是一个理想的解决方案。

**编辑** 只有在 BindingList 成功删除最后一个有问题的项目后才会引发异常。它被抛出在外部代码中，所以我无法确切地知道是什么抛出了它。

所以，我在这里，向SO寻求帮助:)。

在此先感谢，贾斯汀

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T21:53:49.287

这是我从网格中删除选定行的方法：

```
private void btnDelete_Click(object sender, EventArgs e)
{
  if (grid.CurrentRow == null) return;
  var selectedItem = grid.CurrentRow.DataBoundItem as PartGroup;
  if (selectedItem != null && 
    UIHelper.ShowQuestion("Are you sure you want to delete selected row?") == System.Windows.Forms.DialogResult.Yes)
  {
    groups.Remove(selectedItem);
  }
}
```

组是我的 BindingListEx(Of T)。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-15T22:56:39.097

[对不起，不是真正的答案，但我觉得这很有价值，因为没有给出答案。]

我在使用 .NET Compact Framework 2.0 时遇到了完全相同的情况。测试将其跟踪到使用 NumericUpDown.DataBindings.Add() 将控件绑定到源的点。此后，如果该项是源中的最后一项，则使用 RemoveCurrent() 将产生错误。在该绑定之前（或者如果它被跳过），错误将永远不会出现。

其他控件绑定到同一个源——TextBox 和 ComboBox——但它们不会导致这种行为。只有 NumericUpDown 控件。

# asp.net - 如果网站的某些部分出现编译错误，网站还能运行吗？

> ID：804418
> 
> 赞同：0
> 
> 时间：2009-04-29T21:47:17.040
> 
> 标签：asp.net, deployment, compilation

如果网站的某些部分出现编译错误，网站还能运行吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-30T17:15:26.120

> 这取决于您如何部署您的网站。
> 部署asp.net 应用程序基本上有两种主要策略。

***1.) 预编译部署***

在预编译部署中，您会将所有代码隐藏文件编译到程序集中。此外，如果您使用的是 Web 部署项目，那么所有这些已编译的程序集都将合并到一个程序集中。

因此，在预编译部署中，您的网站无法在项目中的任何位置部署而不会出现任何错误。

***2.) XCopy 部署***

在 XCopy 部署中，您只需将整个网站复制粘贴到生产服务器，无需编译。在这种情况下，只有那些通过 HttpClient 请求的页面被编译、加载和提供。如果您的 asp.net 页面有一些错误，则在通过任何 HttpClient 请求之前，您的网站不会显示这些错误。剩余的网站继续工作，不受那些有错误的人的影响。

# visual-studio-2008 - 如何调试在无线网络上运行的 Pocket PC 应用程序？

> ID：804420
> 
> 赞同：2
> 
> 时间：2009-04-29T21:48:12.327
> 
> 标签：visual-studio-2008, windows-mobile, compact-framework, pocketpc

如何通过无线网络 (802.11) 调试在远程设备 Pocket PC 4.2 (2003) 上运行的应用程序？当设备处于支架状态（57K 波特）时，我可以使用 ActiveSync 进行远程调试。我正在使用 Visual Studio 2008。

我熟悉 Windows Mobile 5 中的无线调试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T00:47:29.553

从 Visual Studio 2008 通过网络调试 Pocket PC 2003：

*   转到工具/选项以打开选项对话框。
*   在树中选择设备工具/设备在顶部的下拉列表和中间的列表框中选择 Pocket PC 2003，
*   按属性按钮
*   取消选中设备断开连接时检测

您需要将设备放在支架上才能开始第一次调试。Visual Studio 连接到设备后，您应该能够从底座中移除设备。

需要的另一个步骤是在设备处于支架时启用无线或数据连接

如果在 XP 上，则在 ActiveSync 中

*   转到文件/连接设置
*   选中允许设备上的无线连接复选框

在 Vista 上的 Windows Mobile 设备中心中

*   转到移动设备设置/连接设置
*   选中允许数据连接复选框

在这两种情况下，您都需要重新同步您的设备。

同样，您不能再使用 PPP_PEER 机器名。

# xslt - 如何计算 XSLT 中数字的绝对值？

> ID：804421
> 
> 赞同：15
> 
> 时间：2009-04-29T21:48:13.730
> 
> 标签：xslt, xslt-1.0, xslt-2.0

我有

```
<xsl:value-of select="DifferenceInDays" /> 
```

`DifferenceInDays`有一个可以是负数或正数的值，我想显示它的绝对值。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-29T23:18:56.383

**在 XPath 1.0 中使用以下表达式**：

```
 $vNum*($vNum >=0) - $vNum*($vNum < 0) 
```

如果此表达式嵌入在 XSLT (XML) 属性中，则`<`必须对字符进行转义：

```
 $vNum*($vNum >=0) - $vNum*($vNum &lt; 0) 
```

**在 XPath 2.0 (XSLT 2.0) 中使用[`abs()`](http://www.w3.org/TR/xpath-functions/#func-abs)函数**.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-29T22:45:27.820

这可以使用 xpath abs 函数来实现。

```
<xsl:value-of select="abs(DifferenceInDays)"/> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-08-22T07:40:01.210

一些答案对于 XSLT 1.0 来说太复杂了，实际上它要简单得多。使用数字格式，您可以定义正数和负数的结构，默认负数是`-0`但是您可以定义自己的。

```
<xsl:value-of select='format-number(DifferenceInDays,"0;0")'/> 
```

上面的代码将通过使用提供的格式化函数显示天差的绝对值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-04T10:08:48.423

diffInDays * (1 - 2*(diffInDays < 0))

# asp.net - 将 SMTP 存储在 Web.Config 文件之外

> ID：804427
> 
> 赞同：16
> 
> 时间：2009-04-29T21:49:14.053
> 
> 标签：asp.net, smtp, web-config

一段时间以来，我一直将我的连接和应用程序设置存储在一个外部文件中，并通过我的 web.config 引用该文件。这非常有效，因为它允许我保留单独的连接字符串和应用程序设置。这真的很方便，因为我发现在开发过程中我经常会对 webconfig 进行很多更改，而且我讨厌每次需要更新 web.config 时都必须管理环境特定的值。

无论如何，我可以通过 web.config 中的 SMTP 配置部分来实现这一点。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-29T21:59:30.597

当然，您可以使用 configSource 属性。

例子：

```
<system.net>
  <mailSettings>
   <smtp configSource="MailSettings.config"/>
  </mailSettings>
</system.net> 
```

然后将你的 mailSettings 配置数据放入 MailSettings.config

因此，您的 MailSettings.config 文件将具有以下内容：

```
 <network 
    host="relayServerHostname" 
    port="portNumber"
    userName="username"
    password="password" /> 
```

**更新**：看起来它可能需要实际进入 smtp 节点才能正常工作，所以我更新了上面的代码以表明 - 同样的想法，只有这个应该工作。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-03-23T22:09:22.847

我不确定我在这里所拥有的是否仅适用于较新版本的 .NET。使用接受的答案时出现运行时错误。

如果使用较新版本的 .NET，请使用下面的代码块更新已接受的答案。smtp 节点也应该在单独的文件中——不仅仅是网络节点。实际 Web.config 文件中的整个 smtp 节点被您放在那里的文件替换 - 不像 appSettings 中它似乎添加到它的地方。

Web.config -

```
 <system.net>
        <mailSettings>
          <smtp configSource="your-source-file">
          </smtp>
        </mailSettings>
    </system.net> 
```

你的档案——

```
 <smtp from="noreply@example.com">
      <network
        host="your-host"
        port="your-port"
        userName="your-user-name"
        password="your-password"/>
    </smtp> 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-29T21:53:31.500

我的软件将其存储在注册表中，即使在生产中也是如此。

# java - 如何在java中获取用户的IP地址

> ID：804428
> 
> 赞同：2
> 
> 时间：2009-04-29T21:49:17.800
> 
> 标签：java

虽然这看起来很简单，但我已经尝试了通常的 request.getRemoteAddr()、request.getRemoteHost()，但我一直在获取我的服务器地址。关于我的配置，我正在获取我的网关 IP。有谁知道如何获得实际用户的IP地址？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T21:51:43.987

如果您和用户之间有一些代理，那么您可能需要查看[`X-Forwarded-For`header](http://en.wikipedia.org/wiki/X-Forwarded-For)。请注意，这也不能保证有效，但如果您只需要“足够好”，那么它可能就足够了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-17T22:15:19.467

Apache Http 将集成一个安全机制来处理带有 mod_remoteip (1) 的 X-Forwarded-For 标头。

这里有一个 Tomcat 阀门 RemoteIpValve (2) 和一个 servlet 过滤器 XForwardedFilter (3)，分别在 Tomcat 和 WAR 级别集成 X-Forwarded-For 和 X-Forwarded-Proto 标头，并具有与 mod_remoteip 相同的安全机制。

多亏了这个，`request.getRemoteAddr()`, `request.getRemoteHost()`, `request.isSecure()`,`request.getScheme()`和`request.getServerPort()`将暴露 X-Forwarded-For 和 X-Forwarded-Proto 传输的值，而不是前面的代理/负载均衡器的值。

希望这可以帮助，

西里尔

cleclerc@xebia.fr

(1) http://httpd.apache.org/docs/trunk/mod/mod_remoteip.html

(2) http://code.google.com/p/xebia-france/wiki/RemoteIpValve

(3) [http://code.google.com/p/xebia-france/wiki/XForwardedFilter](http://code.google.com/p/xebia-france/wiki/XForwardedFilter)

# sql - 存储过程中数据集的表名

> ID：804443
> 
> 赞同：1
> 
> 时间：2009-04-29T21:53:04.153
> 
> 标签：sql, ado.net

我正在使用存储过程来填充数据集。我需要做的是强制填充时创建的 DataTable 的名称。存储过程返回了多个表。最后一张表是我需要确保在返回时具有特定名称的表。它是通过返回一个变量的值而不是从任何表中提取来创建的。

选择 @Phone 作为 My_800Number

如何将此返回为名为“D1Header”的表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T22:02:36.567

没有 ADO.NET Native 方法可以做到这一点；[ADO.Net 根据这个](http://msdn.microsoft.com/en-us/library/bh8kx08z(VS.80).aspx)为生成的名称分配一个序列号

你可以解决它......如果你说你需要最后一个具有特定名称的表，你可以这样做：

```
if (ds.Tables.Count > 0) {
  ds.Tables[ds.Tables.Count - 1].TableName = "name";
} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-29T22:06:48.973

可以使用表名的枚举并在表引用中引用它而不是表本身。

ds.tables(myEnum.Contacts).rows ？

# mysql - 如何在 Web 应用程序中记录用户操作？

> ID：804449
> 
> 赞同：1
> 
> 时间：2009-04-29T21:54:06.180
> 
> 标签：mysql, hibernate, logging, report, trace

我的应用环境：基于web、Spring MVC+Security、Hibernate、MySQL(InnoDB)

我正在开发一个从 Web 界面操作的小型数据库应用程序。有特定和已知的用户处理存储的数据。现在我需要跟踪用户在数据库上执行的每个创建/更新/删除操作，并从中生成简单的“类似列表”的报告。截至目前，我正在考虑一个“日志”表（列：userId + timestamp + description 等）。我猜想在这个表中插入日志行的任何 C(R)UD 操作都会触发一个方面。但我不确定这是应该如何做的。

我也知道通常的 MySQL 日志以及 log4j。至于日志文件，我可能需要比 MySQL 可用的信息更多的信息。Log4j 可能是一个解决方案，但我看不到它是如何写入 MySQL 表的。另外，我希望在我的日志表中保留一些关联（例如用户 ID），以让数据库进行基本过滤等。对此表示赞赏。

你会推荐什么？Hibernate/Spring 中是否有任何内置支持，或者 log4j 是正确的方法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T21:58:28.713

1.  Log4j 是模块化的，如果您愿意，您可以编写自己的后端，将日志写入数据库；事实上，它甚至还附带了一个开箱即用的[JDBC 附加程序，尽管请注意那里的大红色警告。](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/jdbc/JDBCAppender.html)
2.  对于 Hibernate，您可能可以在[拦截器和事件](http://docs.jboss.org/hibernate/stable/core/reference/en/html/events.html)上构建一些东西来跟踪所有修改并将它们记录到特殊的审计表中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T22:22:42.930

您是否考虑过使用 MappedSuperclass 进行 C(R)UD 操作日志记录？

```
@MappedSuperclass
public class BaseEntity {
@Basic
@Temporal(TemporalType.TIMESTAMP)
public Date getLastUpdate() { ... }
public String getLastUpdater() { ... }
...
}

@Entity class Order extends BaseEntity {
@Id public Integer getId() { ... }
...
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:01:59.953

如果您寻求日志记录解决方案并自己寻找，请尝试搜索 JDBCAppender，它并不完美，但应该可以工作。

如果您想要现成的集中式日志记录产品 - 考虑尝试[logFaces](http://www.moonlit-software.com) - 它可以直接写入您自己的数据库（**披露**：我是该产品的作者。）

# xml - 枚举每个元素的属性及其值的简单代码 [XML]

> ID：804450
> 
> 赞同：1
> 
> 时间：2009-04-29T21:54:12.590
> 
> 标签：xml

我是 JS/XML 的初学者。

我有这个简单的代码需要扩展以在屏幕上列出 XML 文件的每个元素的属性及其值。

```
 function printElement(indent, node) 
      {
         var i;
         if (node.nodeType == 3) 
          {
              document.write("<br />" +indent + node.nodeValue);
          }
         else 
          {  document.write("<br />" +indent + "[" + node.nodeName + "]");
             for (i = 0; i < node.childNodes.length; i++) 
               {
                  printElement(indent+tab, node.childNodes[i]);
               }
             document.write("<br />" +indent + "[/" + node.nodeName + "]");
          }
      } 
```

我想我应该使用 node.attributes 但我不知道具体如何。我不知道属性的名称。

这也不起作用：

```
document.write("<br />" +indent + node.attributes[0].nodeValue); 
```

如果（node.nodeType == 3），浏览器会说“需要对象”。如果 (node.nodeType == 2) 代码列出了一些东西，但没有列出属性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:46:11.153

试试这个：

```
for (var i = 0; i < element.attributes.length; i++)
{
   var att = element.attributes[i];
   document.write(att.nodeName) + "=" + att.nodeValue + "<br/>");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T22:29:24.973

尝试

```
node.attributes.getNamedItem("id").nodeValue 
```

其中 id 是属性名称。

或者

```
node.attributes[0].nodeValue 
```

# c# - 在 C# 中使用内部类

> ID：804453
> 
> 赞同：28
> 
> 时间：2009-04-29T21:55:11.043
> 
> 标签：c#, inner-classes

关于 C# 中内部类的使用和结构的最佳实践是什么。

例如，如果我有一个非常大的基类和两个大的内部类，我应该将它们拆分为单独的（部分类）代码文件还是将它们保留为一个非常大且笨重的代码文件？

拥有一个带有公共继承内部类的抽象类也是不好的做法吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-29T22:12:55.323

通常我为以下两个目的之一保留内部类：

1.  从其父类派生的公共类，其中父类是具有一个或多个抽象方法的抽象基实现，每个子类都是服务于特定实现的实现。*在阅读框架设计和指南后，我看到这被标记为“避免”，但是我在类似于枚举的场景中使用它——尽管这也可能给人留下不好的印象*

2.  内部类是私有的，是业务逻辑单元，或者以其他方式与父类紧密耦合，当它们被任何其他类消费或使用时，它们会从根本上被破坏。

对于所有其他情况，我尝试将它们保持在与其使用者/逻辑父级相同的名称空间和相同的可访问性级别——通常使用的名称比“主”类不太友好。

在大型项目中，您会惊讶地发现自己最初构建强耦合组件的频率仅仅是因为它的首要或主要目的使它看起来合乎逻辑——但是除非您有很好的或技术上的理由来锁定和隐藏它从视觉上看，暴露该类以使其他组件可以使用它几乎没有害处。

**编辑**请记住，即使我们谈论的是子类，它们也应该或多或少是设计良好且松散耦合的组件。即使它们是私有的并且对外部世界不可见，在类之间保持最小的“表面积”也将大大简化代码的可维护性，以便将来扩展或更改。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-29T22:06:59.957

我手头没有这本书，但框架设计指南建议使用`public`内部类，只要客户不必引用类名。`private`内部类很好：没有人会注意到这些。

**坏的：** `ListView.ListViewItemCollection collection = new ListView.ListViewItemCollection();`

**好的：** `listView.Items.Add(...);`

关于你的大类：通常值得将这样的东西分成更小的类，每个类都有一个特定的功能。一开始很难打破它，但我预测它会让你以后的生活更轻松......

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-29T22:00:56.273

通常内部类应该是私有的并且只能由包含它们的类使用。如果它们的内部类非常大，则表明它们应该是自己的类。

通常当你有一个大的内部类时，这是因为内部类与它的包含类紧密耦合，并且需要访问它的私有方法。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-29T22:01:19.703

我认为这是相当主观的，但我可能会通过使“主机”类部分化，将它们分成单独的代码文件。

[通过这样做，您可以通过编辑项目文件](http://aspnetresources.com/blog/partial_class_files_in_vs2k5.aspx)以使文件组就像 Windows 窗体中的设计器类一样获得更多概览。我想我已经看到了一个 Visual Studio 插件，它会自动为您执行此操作，但我不记得在哪里。

**编辑：**
经过一番查看，我发现了用于执行此操作的 Visual Studio 加载项，称为 VSCommands

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-29T22:44:47.510

仅关于如何构造这样的野兽...

您可以使用分部类来拆分主类和嵌套类。当您这样做时，建议您适当地命名文件，以便清楚地知道发生了什么。

```
// main class in file Outer.cs
namespace Demo
{
  public partial class Outer
  {
     // Outer class
  }
}

// nested class in file Outer.Nested1.cs
namespace Demo
{
  public partial class Outer
  {
    private class Nested1
    {
      // Nested1 details
    }
  }
} 
```

以同样的方式，您经常在自己的文件中看到（显式）接口。例如`Outer.ISomeInterface.cs`，而不是编辑器默认设置`#region`它们。

您的项目文件结构然后开始看起来像

```
   /Project/Demo/ISomeInterface.cs
   /Project/Demo/Outer.cs
   /Project/Demo/Outer.Nested1.cs
   /Project/Demo/Outer.ISomeInterface.cs

```

通常，当我们这样做时，它是针对 Builder 模式的变体。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T22:08:49.857

我个人喜欢每个文件有一个类，内部类作为该文件的一部分。我相信内部类通常（几乎总是）应该是私有的，并且是类的实现细节。将它们放在单独的文件中会使事情变得混乱，IMO。

在这种情况下，使用代码区域包裹内部类并隐藏它们的细节对我来说效果很好，并且可以防止文件难以处理。代码区域保持内部类“隐藏”，因为它是一个私有的实现细节，这对我来说很好。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-29T22:17:31.630

我个人使用内部类来封装一些仅在类内部使用的概念和操作。这样我就不会污染该类的非公共 api 并保持 api 干净和紧凑。

您可以利用部分类将这些内部类的定义移动到不同的文件中，以便更好地进行组织。VS 不会自动为您分组部分类文件，除了一些模板化项目，如 ASP.NET、WinForm 表单等。您需要编辑项目文件并在其中进行一些更改。您可以查看其中的现有分组之一以了解它是如何完成的。我相信有一些宏允许您在解决方案资源管理器中为您分组部分类文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-17T09:15:47.723

在我看来，内部类，如果需要的话，应该保持很小，并且只由该类在内部使用。如果您在 .NET 框架上使用 Relfector，您会看到它们大量用于此目的。

如果您的内部类变得太大，我肯定会以某种方式将它们移到单独的类/代码文件中，如果只是为了可维护性。我必须支持一些现有的代码，有人认为在内部类中使用内部类是个好主意。它导致了一个运行 4 到 5 层深度的内部类层次结构。不用说代码是难以理解的，需要很长时间才能理解你在看什么。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-05-07T23:45:39.110

这里看一个嵌套类的实际示例，可以让您了解它们的使用（添加了一些单元测试）

```
namespace CoreLib.Helpers
{
    using System;
    using System.Security.Cryptography;

    public static class Rnd
    {
        private static readonly Random _random = new Random();

        public static Random Generator { get { return _random; } }

        static Rnd()
        {
        }

        public static class Crypto
        {
            private static readonly RandomNumberGenerator _highRandom = RandomNumberGenerator.Create();

            public static RandomNumberGenerator Generator { get { return _highRandom; } }

            static Crypto()
            {
            }

        }

        public static UInt32 Next(this RandomNumberGenerator value)
        {
            var bytes = new byte[4];
            value.GetBytes(bytes);

            return BitConverter.ToUInt32(bytes, 0);
        }
    }
}

[TestMethod]
public void Rnd_OnGenerator_UniqueRandomSequence()
{
    var rdn1 = Rnd.Generator;
    var rdn2 = Rnd.Generator;
    var list = new List<Int32>();
    var tasks = new Task[10];
    for (var i = 0; i < 10; i++)
    {
        tasks[i] = Task.Factory.StartNew((() =>
        {
            for (var k = 0; k < 1000; k++)
            {
                lock (list)
                {
                    list.Add(Rnd.Generator.Next(Int32.MinValue, Int32.MaxValue));
                }
            }
        }));
    }
    Task.WaitAll(tasks);
    var distinct = list.Distinct().ToList();
    Assert.AreSame(rdn1, rdn2);
    Assert.AreEqual(10000, list.Count);
    Assert.AreEqual(list.Count, distinct.Count);
}

[TestMethod]
public void Rnd_OnCryptoGenerator_UniqueRandomSequence()
{
    var rdn1 = Rnd.Crypto.Generator;
    var rdn2 = Rnd.Crypto.Generator;
    var list = new ConcurrentQueue<UInt32>();
    var tasks = new Task[10];
    for (var i = 0; i < 10; i++)
    {
        tasks[i] = Task.Factory.StartNew((() =>
        {
            for (var k = 0; k < 1000; k++)
            {
                    list.Enqueue(Rnd.Crypto.Generator.Next());
            }
        }));
    }
    Task.WaitAll(tasks);
    var distinct = list.Distinct().ToList();
    Assert.AreSame(rdn1, rdn2);
    Assert.AreEqual(10000, list.Count);
    Assert.AreEqual(list.Count, distinct.Count);
} 
```

# javascript - 按确定后如何停止显示javascript警报

> ID：804454
> 
> 赞同：3
> 
> 时间：2009-04-29T21:55:34.990
> 
> 标签：javascript, facebook, greasemonkey, alert

如果我的 Facebook 收件箱中有内容，我想显示提醒。我认为使用用户脚本可以很容易地完成......这就是我到目前为止所拥有的（感谢用户[脚本](http://userscripts.org/forums)论坛的人）：

```
document.addEventListener("DOMNodeInserted", function() {
  var count;
  if ((count=parseInt(document.getElementById("fb_menu_inbox_unread_count").textContent)) > 0)
  alert("You have "+count+" new message"+(count==1 ? "" : "s")+".");
}, true); 
```

这很好用，除了单击“确定”后消息卡在一个循环中，并不断弹出。单击关闭警报后，有没有办法停止消息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T21:59:41.610

添加一个变量来跟踪上次警报的消息数量，并且不显示该变量是否未更改。

就像是：

```
document.addEventListener(
  "DOMNodeInserted", 
  function() { 
    var count = parseInt(document.getElementById("fb_menu_inbox_unread_count").textContent);
    if (count > 0 && count != lastCount) {
      alert("You have "+count+" new message"+(count==1 ? "" : "s")+"."); }, true);
    }
    lastCount = count;  // Remember count to avoid continuous alerts. 
```

另外，我会避免像您在原始帖子中所做的那样将代码全部写成一体。如果需要，它会使阅读和更改变得更加困难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T22:18:38.523

使用 document.cookie 设置自定义 cookie 以保存计数，然后进行定期检查

# security - GUID 是好的密码吗？

> ID：804456
> 
> 赞同：29
> 
> 时间：2009-04-29T21:57:29.540
> 
> 标签：security, guid

优点：

1.  ***无论如何，我都不记得“好”密码，***所以记住它们不是问题。
2.  它们看起来不像密码
3.  他们几乎不可能猜到（128位熵）
4.  易于生成（卸载“良好的 PRNG”问题）

缺点：

1.  ？？？

尤其; 对于某些设置上的数据库登录密码，计算机输入的密码又如何呢？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-29T22:10:10.587

一个主要缺点是您不一定具有原始问题中所述的“128 位熵”。

许多 GUID 算法以可预测的模式嵌入其中的信息，例如计算机的 MAC 地址、日期/时间或递增序列。WinAPI GUID 的密码分析表明，在初始状态下，可以预测函数 UuidCreate 返回的下一个 250,000 个 GUID

例如，我有大约 50% 的机会猜测第三组数字的第一个位置的第一个数字，因为它将是 1（对于 V1 guids）或 4（对于 V4 guids）

来源：[http ://en.wikipedia.org/wiki/Globally_Unique_Identifier](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-29T22:02:27.673

缺点：

1.  你会把它们写下来。
2.  如果您需要告诉其他人，您可能会通过电子邮件发送给他们，或者再次将其写下来。
3.  对于某些系统，它们可能太长了。
4.  它们实际上是不可能记住的，所以你可能会比想要的更频繁地改变它们。

因此，除非它们是很少更改的系统密码，否则我怀疑它们是好的密码。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-29T22:00:37.770

缺点：

记住一个 32 字节的字母数字字符串几乎是不可能的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-29T22:11:21.630

如果您真的想要一个安全的密码，请考虑使用[密码](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FPassphrase&ei=gdD4SYC1Fob8swPm343JCg&usg=AFQjCNHiODnmMgikMyGXjBWr_ycyweomcA)。很长的密码很容易记住，而且很难暴力破解。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-29T22:01:42.213

缺点：

*   某些系统对密码的最大长度有限制。如果您只使用十六进制数字，这可能会将您的熵限制在 32 位。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-29T22:15:02.510

缺点：

1.  密码字段并不总是足够长。
2.  更难输入 - 您可能会将密码存储在程序中，而不是在您的脑海中。这有点安全问题...

...优点：

1.  没有人可以强迫您输入密码。

大随机数密码之前已经完成。它们被称为[OTP](https://datatracker.ietf.org/doc/html/draft-mraihi-totp-timebased-01)，并且比您建议的要安全得多，因为它们会随着时间而变化，并且往往由安全设备生成。当然，这仅在*您*设计密码系统时才有意义。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T22:01:40.110

有没有人需要输入它作为密码？还是您想一次性使用它？因为说真的，没有人愿意在密码字段中输入 GUID。人们已经很麻烦了，输入 WEP/WPA2 wifi 网络密钥。大多数时候，这些都是一次性的。

@Miyagi：这是最明显的骗局。他们必须把它写下来。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T22:04:04.237

从技术上讲，它们将是很好的密码在现实生活中，它们将是可怕的密码

您最终将不得不写下密码，使用密码管理器或其他形式来实际使用密码......以某种方式将故障点从密码转移到另一个方面。

考虑使用密码。替换某些字母或其他字符的句子，以及数字，用 SHIFT 键入它们，将易于记忆的数字转换为明确定义的字符序列。

例如**bcs19850101bcs**将是**bcs!(*%)!)!bcs**

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-29T22:18:58.040

如果您想要一个安全密码，并希望将其留给类 UNIX 系统上的密码管理器，您最好从 /dev/random 中提取一个并将其编码为可读的内容。对于 128 位的熵，你可以使用一些简单的东西，比如

```
head -c 16 /dev/random | openssl enc -a -e 
```

这给出了一个密码`5eqIviKu4pFTqSPnYosVKg==`

没有不合理的长，安全，随机，自杀试图记住。

编辑：这种方法相对于 UUID 的额外好处包括 PRNG (/dev/random) 中的额外安全性和更短的密码，类似的不足

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T22:56:19.290

我最近编写了代码，将校验和的前 64 位转换为四个英文单词的序列。这是一个很好的校验和（比十六进制更容易记住），但我不确定我是否会相信它作为密码。如果您要保护一些安全的东西，您应该使用一个您记住并且不要写下来的强密码。如果没有，那么任何旧密码都可以。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-29T23:05:05.790

我认为您真正想要的是*加密随机数*，而不是 GUID。GUID 和 UUID 不是随机的——正如 JohnFx 所说，它们倾向于包含可发现的值，例如 MAC 地址或当前时间戳，以保证唯一性。

相反，您应该查看可用的任何加密 API，并找到高熵随机数的来源。确保文档承诺输出适用于密码学，而不仅仅是常规 PRNG。例如，Unix 系统上的 /dev/random 是一个很好的来源。然后只需展开任意数量的随机字节即可。

个人觉得这有点太硬核了。我宁愿生成每个字符包含更少熵的字符串，但更容易输入和记忆。例如，有几种算法可以结合随机音节来创建可发音的无意义词；穿插一些数字和标点符号，你就有了一个好的密码。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-29T22:07:52.683

我喜欢我的密码[强且发音清晰](http://www.adel.nursat.kz/apg/)（尝试[此处列出](http://www.adel.nursat.kz/apg/online/index.php)的网站之一进行在线演示，请务必选择“v2”网站以获取发音指南）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-29T22:37:05.517

缺点：你不能重新输入它，这意味着你必须复制和粘贴。如果您的系统上有密码管理程序，那不是问题。但是，如果您最终使用了一个您不知道的系统，那么仅重新输入内容将非常困难。

然后在你尝试几次之后，你就被锁定了......

生活会变得非常烦人。

即使您把它写下来，一个好的密码也是您可以始终如一地输入而不会出错的密码。

# c# - 是否可以使用 WCF 通过 TCP/IP 与外部系统进行通信？

> ID：804460
> 
> 赞同：3
> 
> 时间：2009-04-29T21:58:41.723
> 
> 标签：c#, .net, wcf, tcp, fix-protocol

[我们正在构建一个使用FIX 协议](http://en.wikipedia.org/wiki/FIX_protocol)通过 TCP/IP 与外部系统交互的系统。我使用 WCF 从客户端到服务器进行通信，我可以控制客户端和服务器，但从不控制外部基于 TCP/IP 的系统。WCF可以做到这一点吗？如果是这样，社区是否可以提供链接让我开始并面对正确的方向？

不幸的是，我没有上面提供的更多信息，因为我们仍处于早期规划阶段。我们所知道的是，我们有一个外部供应商，其系统将通过 TCP/IP 与我们的系统进行通信。我们想以此为契机，学习 WCF。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T23:36:23.017

可能的？可能是的，但这需要一些工作。

对于初学者，您需要编写一个自定义的 WCF 传输通道来处理基于 TCP/IP 的协议的细节（即，您需要编写所有套接字处理代码并将其挂接到 WCF 通道模型中）。这是因为 WCF 中的 TCP 通道不适用于此类工作，而是使用相对专有且未记录的有线协议。

我对 FIX 不太熟悉，无法说出它有多复杂，但是在编写 WCF 通道时存在一些问题，并且该领域的文档不是很好。

您需要处理的第二部分是消息编码。对于 WCF，所有消息都是 XML。也就是说，一旦将消息传递到 WCF 堆栈，它必须在运行时看起来像一个 XML 信息集。FIX 不使用 XML (afaik)，因此您需要对其进行一些调整。

有两种方法可以绕过它：

1.  简单的方法：假设服务器/客户端将使用特定的接口和数据格式，并让您的频道完成将 FIX 消息转换为/从该格式转换的所有艰苦工作。最简单的示例是让您的 WCF 代码使用简单的服务合同，其中一种方法采用字符串，然后将 FIX 消息字符串封装为满足该合同的数据合同序列化程序的 XML 格式。不过，用户代码稍后仍需要处理解码 FIX 格式。

2.  在自定义 WCF MessageEncoder 中完成所有艰苦的工作。它有点复杂，但可能更清洁和更可重用（你可以做更复杂的事情，比如更好的流媒体等等）。

不过，最大的问题是这是否值得。您想为此使用 WCF 的原因是什么？利用编程模型？我认为这是一个重要的考虑因素，但也要记住 WCF 提供的抽象是有代价的。特别是，如果您有非常实时的需求，WCF 的某些方面可能会出现问题，据我所知，这在您正在查看的金融环境中很常见。

如果是这种情况，很可能您最好跳过 WCF 并贴近金属一点。无论如何，你都需要做套接字工作，所以这是需要考虑的事情。

希望这可以帮助 ：）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T22:01:11.373

我认为不可能，至少设置起来并不容易，因为你不知道另一端的通信协议，除了它是TCP并接受FIX标签。

为什么不在 WCF 应用程序中打开 TCP 连接 SOCKET。那应该以更简单的方式解决问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:02:15.177

我*想*是的。我有一个*几乎*可以正常工作的系统，它应该几乎完全做到这一点（来自互联网的基于 HTTP 的 WCF）。服务器提供商似乎不想让它思考，因此您需要在这方面获得正确的权限才能使其正常工作。

上镜头：我不明白为什么不。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T23:39:11.263

不是真的 - Ms 没有让 TCP/IP 连接处理程序与非 WCF 服务通信，他们认为你会编写一个 Web 服务来做到这一点。

这[在 SO 上](https://stackoverflow.com/questions/546004/how-to-use-socket-based-client-with-wcf-net-tcp-service)进行了讨论。

# java - 这里的内存分配是怎么回事？

> ID：804465
> 
> 赞同：1
> 
> 时间：2009-04-29T21:59:54.700
> 
> 标签：java, memory

在尝试发现我机器上 Java 字符串数组的最大大小时，我遇到了一些有趣的结果，这里是代码，

```
 String [] max;
   int i = 15444000;
   while(true){
      try{
         max = new String[i];
         System.gc();
         Thread.sleep(10);
      }catch(InterruptedException e){}
   i += 1;
   System.out.println(i);
   } 
```

每当我运行此代码时，输​​出都会在抛出 OutOfMemoryError 之前使其*变为 15444038 。*这让我认为我机器上 Java String 数组的最大大小是*15444038*，但是如果我替换

```
int i = 15444000; 
```

和

```
int i = 15444037; // or any i between 15444037 and 15444002 
```

OutOfMemoryError 立即发生。为什么会这样，我的机器上 Java 字符串数组的真正最大大小是多少？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:06:12.297

您将能够分配的最大阵列大小取决于为 VM 配置的最大内存有多大。*您可以使用-Xmx* [命令行参数](http://java.sun.com/j2se/1.3/docs/tooldocs/solaris/java.html#nonstandard)更改最大值。

还有[http://java.sun.com/j2se/1.4.2/docs/api/java/lang/System.html#gc()](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/System.html#gc())状态

> 调用 gc 方法表明 Java 虚拟机花费精力回收未使用的对象，以使它们当前占用的内存可用于快速重用。当控制从方法调用返回时，Java 虚拟机已尽最大努力从所有丢弃的对象中回收空间。

因此，您的差异可能是因为 GC 每次都没有以相同的方式清理（*Java 虚拟机已尽最大努力回收空间*）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T22:08:58.873

我认为可能会发生什么，这只是一个猜测，JIT（即时编译器）是否可能正在优化一些内存？第二个猜测是垃圾收集在循环再次运行之前只释放了一点内存。在分配数组之前尝试添加垃圾收集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:13:59.033

当您以稍小的大小运行时，GC 可以从年轻/伊甸园/幸存者代收集内存并将其移动到终身代。大型阵列的分配是在终身代中进行的。因为 GC 之前已将对象移动到永久区域中，所以它现在的容量较小。

可能。这完全取决于实施和时间安排。像这样的大分配可能最好通过 NIO 直接分配的缓冲区来完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T22:19:09.287

不，您发布的代码没有任何洞察力或真相。如果您增加可用的最大堆空间，则可以使该数组长度大大增加。

另一件值得知道的事情：调用 System.gc() 并不意味着垃圾收集器运行。这只是一个建议。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-29T22:10:03.753

好吧，你可以争论很多事情，但我认为正确的答案是“谁在乎？”。您的配置的最大值是多少的问题的答案是“大约 1500 万”。如果您真的想担心最后 4 个字节的堆分配，请在汇编程序中编程...

PS*可能*发生的事情包括早期在维护线程中使用的对象，一旦程序运行一段时间，这些对象就会变成垃圾回收。另一张海报暗示的另一种 JIT 优化现象也可能是可能的：有一些线程开始在堆上分配小对象，然后在某些时候进行 JIT 优化以在寄存器/堆栈中“分配”它们。但老实说，除非你发现你可以分配的数组大小突然减半，否则我真的不会太担心。

# java - 如何创建可执行的 Java 程序？

> ID：804466
> 
> 赞同：64
> 
> 时间：2009-04-29T21:59:55.433
> 
> 标签：java, jar, executable, jcreator

我已经在 J​​Creator 中编写了一个 Java 程序，一切都完成了，但是我想从中创建一个可执行文件，即我不想通过加载 java 类并编译然后执行来运行程序，而是将它作为一个独立的可执行文件。

最快的方法是什么？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-04-30T00:18:28.593

您可以使用与 SDK 捆绑的[jar 工具](http://java.sun.com/javase/6/docs/technotes/guides/jar/index.html)并创建程序的可执行版本。

这就是它的完成方式。

我从命令提示符发布结果，因为它更容易，但在使用 JCreator 时也应该适用。

首先创建你的程序：

```
$cat HelloWorldSwing.java
    package start;

    import javax.swing.*;

    public class HelloWorldSwing {
        public static void main(String[] args) {
            //Create and set up the window.
            JFrame frame = new JFrame("HelloWorldSwing");
            frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

            JLabel label = new JLabel("Hello World");
            frame.add(label);

            //Display the window.
            frame.pack();
            frame.setVisible(true);
        }
    }
    class Dummy {
        // just to have another thing to pack in the jar
    } 
```

很简单，只显示一个带有“Hello World”的窗口

然后编译它：

```
$javac -d . HelloWorldSwing.java 
```

在“start”文件夹*Dummy.class*和*HelloWorldSwing.class*中创建了两个文件。

```
$ls start/
Dummy.class     HelloWorldSwing.class 
```

下一步，创建 jar 文件。每个 jar 文件都有一个清单文件，其中包含与可执行文件相关的属性。

这是我的清单文件的内容。

```
$cat manifest.mf
Main-class: start.HelloWorldSwing 
```

只需描述主类是什么（具有 public static void main 方法的类）

一旦清单准备就绪，就会调用 jar 可执行文件。

它有很多选项，这里我使用 -c -m -f （ -c 来创建 jar， -m 来指定清单文件， -f = 文件应该被命名.. ）和我想要 jar 的文件夹。

```
$jar -cmf manifest.mf hello.jar start 
```

这会在系统上创建 .jar 文件

![在此处输入图像描述](https://i.stack.imgur.com/keuIN.png)

您稍后可以双击该文件，它将按预期运行。

![在此处输入图像描述](https://i.stack.imgur.com/Zb2wW.png)

要在 JCreator 中创建 .jar 文件，您只需使用“工具”菜单，创建 jar，但我不确定清单是如何到达那里的。

这是我发现的一个视频：[在 Jcreator 中创建一个 Jar 文件](http://www.youtube.com/watch?v=u5fF3oldcrQ)。

一旦您熟悉了这种“.jar”方法，我认为您可以继续使用此线程中发布的其他链接。

您也可以使用[jnlp](http://java.sun.com/developer/technicalArticles/Programming/jnlp/)（Java 网络启动器协议）。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2014-08-11T08:56:12.320

如果您使用的是 Eclipse，您可以尝试以下 7 个步骤来获取适用于 Windows 的 .exe 文件。

![步骤1](https://i.stack.imgur.com/0ZsAw.jpg)![第2步](https://i.stack.imgur.com/5CV4I.jpg)![第三步](https://i.stack.imgur.com/6zYeL.jpg)

现在你有了一个 JAR 文件。使用 java -jar path/jarname.jar 执行。

![在此处输入图像描述](https://i.stack.imgur.com/FwwOH.jpg)

* * *

如果要将其转换为 .exe，可以尝试[http://sourceforge.net/projects/launch4j/files/launch4j-3/](http://sourceforge.net/projects/launch4j/files/launch4j-3/)

![STEP5](https://i.stack.imgur.com/58E06.jpg)![STEP6](https://i.stack.imgur.com/QybPS.jpg)

STEP7：给 .xml 文件起一个适当的名称，然后单击“保存”。.xml 文件是标准的，不用担心。现在将创建您的可执行文件！

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-29T23:40:48.200

我不太清楚你的意思。

但我假设你的意思是两件事中的一件。

*   您想创建一个可执行的 .jar 文件

Eclipse 可以很容易地做到这一点 File --> Export 并创建一个 jar 并选择适当的 Main-Class，它会为您生成 .jar。在 Windows 中，您可能必须将 .jar 与 java 运行时相关联。又名按住shift，右键单击“打开方式”浏览到您的jvm并将其与javaw.exe关联

*   创建一个实际的 .exe 文件，然后您需要使用一个额外的库，例如

[http://jsmooth.sourceforge.net/](http://jsmooth.sourceforge.net/)或[http://launch4j.sourceforge.net/](http://launch4j.sourceforge.net/)将创建一个带有漂亮图标的本机 .exe 存根，基本上可以引导您的应用程序。他们甚至会判断您的客户是否没有安装 JVM，并提示您安装一个。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-29T22:11:31.740

在命令行上，导航到要使其可执行的 Java 文件的根目录。

使用这个命令：

```
jar -cvf [name of jar file] [name of directory with Java files] 
```

这将在 jar 存档中创建一个名为 META-INF 的目录。在这个 META-INF 中有一个名为 MANIFEST.MF 的文件，在文本编辑器中打开这个文件并添加以下行：

```
Main-Class: [fully qualified name of your main class] 
```

然后使用这个命令：

```
java -jar [name of jar file] 
```

你的程序将运行:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-29T23:59:10.717

看看[WinRun4J](http://winrun4j.sourceforge.net/)。它只是 windows，但那是因为 unix 具有看起来（对用户）像 bin 的可执行脚本。您还可以轻松修改 WinRun4J 以在 unix 上编译。

它确实需要一个配置文件，但再次使用硬编码选项重新编译它，它就像一个无配置的 exe 一样工作。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-06T04:23:58.443

Jexecutable 可以为 Java 程序创建 Windows exe。它将 jar 嵌入到 exe 文件中，您可以像 Windows 程序一样运行它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-29T23:34:35.953

您可以使用[GCJ](http://gcc.gnu.org/java/)将您的 Java 程序[编译为本机代码。](http://gcc.gnu.org/java/compile.html)
有时他们甚至将[Eclipse](http://www.eclipse.org)编译为本[机版本](http://www.linuxjournal.com/article/7413)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-29T23:38:07.880

看看[launch4j](http://launch4j.sourceforge.net/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-03-05T12:15:30.533

Java Web Start 是一种很好的技术，可以将 Java 富客户端从 Internet 直接安装到最终用户的桌面（无论操作系统是 Windows、Mac 还是 *nix）。它配备了桌面集成和自动更新以及许多其他好东西。

有关 JWS 的更多信息，请参阅[JWS 信息页面](https://stackoverflow.com/tags/java-web-start/info)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T22:06:09.910

编写脚本并使其可执行。该脚本应该看起来像您通常在命令行中使用的那样：

```
java YourClass 
```

这假设您已经编译了 .java 文件并且 java 可以找到您的 .class 文件。如果 java 找不到您的 .class 文件，您可能需要查看使用 -classpath 选项或设置您的 CLASSPATH 环境变量。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-29T23:57:51.623

如前所述，您可以查看 launch4j 来为您的 JAR 文件创建可执行文件。此外，还有一个叫做“JExePack”的东西可以在你的 jar 文件周围放置一个 .exe 包装器，以便你可以重新分发它（注意：客户端无论如何都需要一个 JRE 来在他的电脑上运行程序）用 GCJ 创建的 Exes 不会具有这种依赖性，但过程涉及更多。

# mercurial - 如何使用 Mercurial 进行基于变更集的合并，而不是基于文件的合并？

> ID：804487
> 
> 赞同：8
> 
> 时间：2009-04-29T22:04:12.070
> 
> 标签：mercurial, merge

在使用 Mercurial 执行合并时，它希望一次合并一个冲突文件，这在大型合并集上不是一个高效的工作流程。相反，我想做的是合并两个头的整个变更集（比如使用 kdiff3 来区分 2 个头）。对我来说，这听起来很简单，但我不知道如何实现它。

到目前为止，我能得到的最接近的方法是以通常的方式进行合并，让所有冲突未解决（一次一个文件......），然后`hg vdiff -rHead1 -rHead2`- 但 vdiff（使用 kdiff3）似乎没有选项用于向工具传递输出目录（当前工作目录），而是将输出目录作为临时目录启动（可能 -o 是答案？）。

让我换一种说法 - 我想使用 kdiff 将两个头合并到我的工作目录中。我希望我的工作目录中的结果成为我可以提交的合并。

我一定遗漏了一些明显的东西，我不能是唯一一个想要这样做的人。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-17T13:13:12.750

我想出了一个可以实现我想要的解决方案，但我仍然觉得它是一个杂项。

*   从一个有 2 个头的空工作目录开始：我的和他们的。
*   将工作目录更新为我的：
    `hg update [My head's rev here]`
*   执行合并，但在没有启动合并工具的情况下 Merc 无法自动处理的所有文件失败，并在冲突时保留“我的”文件：
    `hg --config "ui.merge=internal:fail" merge`

有关如何合并/失败的详细信息， 请参阅[https://www.mercurial-scm.org/wiki/TipsAndTricks#head-9f405488b6d3b3d092a09aafa28db515ba44c742 。](https://www.mercurial-scm.org/wiki/TipsAndTricks#head-9f405488b6d3b3d092a09aafa28db515ba44c742)

现在我已经有了一个 auto 可以计算的工作目录，但是我的任何未处理的文件仍然没有被触及。（使用 hg resolve -l 查看 Mercurial 对当前文件的解析状态）

*   现在我可以将我的工作目录与他们的头进行对比，这为我提供了我正在寻找的高级别的变更集到变更集的合并。

`hg vdiff -r [Theirs head's rev here]`

注意：如果您将 WinMerge 用于 vdiffs ，请确保它有一个 /r 开关作为选项，它将进行子目录比较，并且 - 如果 WinMerge 配置设置为使用树视图 - 将提供一个很好的树比较。来自 Mercurial.ini：

`[extdiff]
cmd.vdiff = C:\Program Files\WinMerge\WinMergeU.exe
opts.vdiff = /e /ub /r /dl other /dr local`
现在我可以处理包含未解析文件的整个目录，并根据需要进行项目范围的更改（即，解析一个文件可能需要对另一个文件进行额外的更改）。

*   完成后，使用 resolve 标记为 Merc 解析的所有文件，然后提交。
    `hg resolve -m`

哇！希望这对其他人有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-03T09:41:16.740

`#mercurial`几天前，我在 irc.freenode.net 上转发了这个问题。`mpm`（Mercurial 的作者）给出了一个答案（这只是一半的答案，所以我没有立即在这里传递它）。他说可以做一些事情，让 Mercurial 自动合并文件（并在有冲突的地方插入`<<<<`和合并标记）。`>>>>`

然后使用了解这些标记的合并工具：这将让您一次解决所有问题，而不是逐个文件地进行。一个起点是[合并工具配置](http://www.selenic.com/mercurial/wiki/MergeToolConfiguration)页面。它解释说

```
[用户界面]
合并 = 内部：合并

```

将使 Mercurial 插入合并标记。在这里，我通过制作两个文件对其进行了测试，`x.txt`然后`y.txt`在两个克隆中进行了相互冲突的更改对其进行了修改。合并只是给出了：

```
% 汞合并
合并 x.txt
警告：合并期间的冲突。
合并 x.txt 失败！
合并 y.txt
警告：合并期间的冲突。
合并 y.txt 失败！
0 个文件已更新，0 个文件已合并，0 个文件已删除，2 个文件未解决
使用“hg resolve”重试未解析的文件合并或“hg up --clean”放弃

```

所有文件都是一次性处理的，我不需要像你描述的那样确认每个文件的任何内容。

这些文件现在包含如下合并标记：

```
% cat x.txt
foo
<<<<<<< local
hehe
=======
foobar
>>>>>>> other 
```

下一步是找到一个工具，该工具可以获取包含此类文件的目录树并让您解决它们。我查看了kdiff3，但没有弄清楚如何使用它单独对单个文件进行操作，它似乎非常专注于比较文件/目录对。

我不确定这半个答案对您有多大帮助-也许您此时也陷入困境？但我希望它可以帮助其他想要将合并标记插入所有文件然后手动解决冲突的人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-03T00:58:33.257

我认为[这](http://kevin-berridge.blogspot.com/2009/04/what-mercurial-cant-do-merge-by.html)回答了你的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-09T08:45:56.373

听起来你想要`extdiff`命令：

我的 ~/.hgrc 中有这些（我更喜欢融合，但你可以将其更改为 kdiff3 等）

```
[extensions]
hgext.extdiff =

[extdiff]
# add new command called meld, runs meld (no need to name twice)
cmd.meld = 
```

随着`extdiff`您的合并发生在您的工作目录中，此外，您可以使用 -o 将任何额外参数传递给您的 diff 程序：

```
$ hg help extdiff 
```

> hg extdiff [选择]... [文件]...
> 
> 使用外部程序来区分存储库（或选定的文件）
> 
> ```
> Show differences between revisions for the specified files, using
> an external program.  The default program used is diff, with
> default options "-Npru".
> 
> To select a different program, use the -p option.  The program
> will be passed the names of two directories to compare.  To pass
> additional options to the program, use the -o option.  These will
> be passed before the names of the directories to compare.
> 
> When two revision arguments are given, then changes are
> shown between those revisions. If only one revision is
> specified then that revision is compared to the working
> directory, and, when no revisions are specified, the
> working directory files are compared to its parent. 
> ```
> 
> 选项：
> 
> -p --program 要运行的比较程序
> -o --option 将选项传递给比较程序
> -r --rev revision
> -I --include 包含与给定模式匹配的
> 名称 -X --exclude 排除与给定模式匹配的名称

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T22:43:40.803

尝试设置 ui.merge。有关详细信息，请参阅[此页面。](https://www.mercurial-scm.org/wiki/MergeProgram)

# http - 在一页上清除会话

> ID：804496
> 
> 赞同：0
> 
> 时间：2009-04-29T22:07:28.893
> 
> 标签：http, jsp

我有两个页面，当用户从页面来回导航时，都使用用户输入的内容重新填充页面的字段。

有什么办法可以清除一页的字段。

我在看 .invalidate 方法......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-04-03T16:08:11.083

`.Invalidate()`方法应该这样做。

# sql-server - 使用 Sqlite InMemory DB 对 MSSQL-DB 进行单元测试

> ID：804502
> 
> 赞同：6
> 
> 时间：2009-04-29T22:09:41.337
> 
> 标签：sql-server, unit-testing, nhibernate, sqlite, in-memory

我正在尝试实施此解决方案： [NHibernate-20-SQLite-and-In-Memory-Databases](http://www.codethinked.com/post/2008/10/19/NHibernate-20-SQLite-and-In-Memory-Databases.aspx "NHibernate-20-SQLite-and-In-Memory-Databases")

唯一的问题是我们有这样的 hbms：

```
<class name="aTable" table="[dbo].[aTable]" mutable="true" lazy="false"> 
```

with`[dbo]`在表名中，因为我们使用的是 mssql，而这不适用于 Sqlite。

我在 rhino-tools-dev 小组上发现[了这篇帖子](http://groups.google.com/group/rhino-tools-dev/browse_thread/thread/618f4be5ab739323)，他们谈论只是从映射中删除模式，但在 NH2 上似乎没有`classMapping.Schema`.

有一个`classMapping.Table.Schema`，但它似乎是只读的。例如，这不起作用：

```
 foreach (PersistentClass cp in configuration.ClassMappings)            {
  // Does not work - throws a 
  //System.IndexOutOfRangeException: Index was outside the bounds of the array.
        cp.Table.Schema = "";
    } 
```

*   有没有办法告诉 Sqlite 忽略`[dbo]`（我试过了`attach database :memory: as dbo`，但这似乎没有帮助）？
*   或者，我可以以编程方式将其从类映射中删除（不幸的是，现在无法更改 hbms）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T00:41:39.507

我们在使用 SQLite 时遇到了太多问题，最终促使我们切换到 SQL Express。我记得的问题：

1.  SQLite，在内存中使用时，会在 Session 关闭时丢弃数据库
2.  SQLite 不支持诸如 ISNULL 之类的基本 SQL 构造，但也支持更高级的 SQL 构造，例如公共表表达式和 SQL 2005 和 2008 中添加的其他构造。当您开始编写复杂的命名查询时，这一点变得很重要。
3.  SQLite 的日期时间比 SQL Server 的可能值范围更大
4.  在事务范围内使用时，用于 SQLite 的 API NHibernate 的行为与用于 MS SQL Server 的 ADO.NET 不同。一个例子是 hbm-to-ddl 工具，它的 Execute 方法在 SQL Server 的事务中不起作用，但在 SQLite 中可以正常工作。

总而言之，基于 SQLite 的单元测试远不能最终代表您在 PROD 中使用 MS SQL Server 时遇到的问题，因此会破坏整体单元测试的可信度。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T00:12:13.070

我们正在使用 Sqlite 运行 NH 2.0.1 的单元测试。其实我没有遇到这个问题。我只是没有指定 dbo，我认为它是 SqlServer 上的默认值。

顺便说一句，配置文件中有一个default_schema参数。这实际上是数据库名称，但您可以尝试将 dbo 放在那里，当然仅用于 SqlServer 配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T10:36:38.717

在查看了 NH 的来源并进行了一些实验后，我想我找到了一个简单的解决方法 -

```
 foreach (PersistentClass cp in configuration.ClassMappings)
    {
        // Input : [dbo].[Tablename] Output : Tablename
        cp.Table.Name = Regex.Replace(cp.Table.Name, @"^\[.*\]\.\[", "");
        cp.Table.Name = Regex.Replace(cp.Table.Name, @"\]$", "");
        // just to be sure
        cp.Table.Schema = null;                
    } 
```

请注意，当空字符串引发异常时，我可以将 Table.Schema 设置为 null ...

感谢您的回答！

# multithreading - 中间件应用程序中的线程数

> ID：804509
> 
> 赞同：1
> 
> 时间：2009-04-29T22:11:32.283
> 
> 标签：multithreading, middleware

我正在编写一个应用程序服务器（同样，与我已经在这里发布的问题无关）并且我想知道在创建在数据库上工作的工作线程时要使用什么策略。一些初步日期：服务器接收 xml 并发送回 xml，所有请求都查询数据库 - 每个请求可能需要几毫秒到几秒钟。

例如，假设您的服务器为少量到中等数量的客户端提供服务，而这些客户端又在每个连接中发送少量请求。每个连接有一个工作线程是否安全，还是应该每个请求都安全？还应该使用线程池来限制服务器使用的资源，还是应该在每次建立新的连接/请求时添加一个工作者？

服务器是否应该将它创建的线程数限制为上限？

希望我不是太含糊……我几乎睁不开眼睛。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:29:59.620

如果您没有丰富的经验，编写应用程序服务器是一项艰巨的任务。可以通过使用像[ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)这样的框架来简化它，它允许您构建应用程序服务基础设施的不同配置，例如*每个连接*的线程、*线程池*、*领导者追随者*，然后使用可扩展的服务框架加载适当的配置。

我建议在 ACE 上阅读这些书籍以获得

*   [C++ 网络编程：使用 ACE 和模式掌握复杂性](http://www.cs.wustl.edu/~schmidt/ACE/book1/)
*   [C++ 网络编程：ACE 和框架的系统重用](http://www.cs.wustl.edu/~schmidt/ACE/book2/)

了解该框架可以为您做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T22:19:30.253

我编写这样的应用程序的方式是通过命令行和/或配置文件使线程数可配置。然后我使用不同数量的线程进行一些负载测试 - 总是有一个最佳数量，超过该数量性能开始下降。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:31:15.623

如果您遵循 Java EE 应用程序服务器开发人员采用的模型，就会有一个用于传入请求的队列和一个工作线程池来为它们提供服务。每个请求一个线程。当工作线程完成请求时，它会返回到池中。如果传入请求的显示速度快于工作线程池可以为它们提供服务的速度，则队列允许它们堆叠，直到释放工作线程。队列大小和线程池都可以根据您的情况进行调整。

我想知道为什么有人会觉得有必要从头开始编写自己的服务器，尤其是当您描述的场景被其他人很好地解决时。如果你的愿望是教育，祝你好运。如果你认为你会改进过去所做的事情，我会重新审视这个假设。

# objective-c - 如何解决未定义符号错误？

> ID：804510
> 
> 赞同：2
> 
> 时间：2009-04-29T22:11:44.530
> 
> 标签：objective-c, iphone, shared-libraries

我收到此错误

```
Undefined symbols:
".objc_class_name_MyClass", referenced from:
  literal-pointer@__OBJC@__cls_refs@MyClass in infoViewController.o
ld: symbol(s) not found
collect2: ld returned 1 exit status 
```

引用下面的静态方法时：

```
[MyClass ClickComment:self.navigationController]; 
```

MyClass 在我的应用程序项目中引用的静态库中定义。当我开始输入“[MyClass”...时，我会收到消息提示。应用程序项目知道 MyClass 存在以及在其上定义了哪些方法。然而，我得到了上述错误。注释掉这个调用允许项目无错误地构建。

在静态库中，我有一个引用库的所有 .h 文件的 .h 文件。这样，应用程序项目只需从静态库中引用一个 .h 文件。静态库项目也有一个应用程序。我用它来测试静态库。我可以很好地完成上述通话。当静态库构建了设备/调试版本并且应用程序项目构建了模拟器/调试时，我通常会看到这些类型的错误。但是，两个构建是同步的。

我知道有一个参考问题，但我不确定如何解决它。有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T22:56:22.550

这意味着在编译期间找到了头文件，但链接器不知道静态库。确保您的静态库在项目视图中的“Targets -> YourMainTarget > Link Binary with Libraries”下列出。

请参阅[http://developer.apple.com/tools/XCode/XCodeprojects.html](http://developer.apple.com/tools/XCode/XCodeprojects.html)

# linux - 在 Linux 下使用 Wireshark 捕获时的以太网 FCS

> ID：804512
> 
> 赞同：2
> 
> 时间：2009-04-29T22:12:59.300
> 
> 标签：linux, ethernet, wireshark

在 Linux 下使用 Wireshark 捕获数据包时，是否有某种方法可以从以太网帧中获取帧校验序列 (FCS)？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-13T14:25:52.173

The FCS is generated by the sender's ethernet device and decoded by the recipients ethernet device. If the FCS is correct, the payload is passed up to higher layers. If it's not, then the potential frame is discarded.

Because it's added for the exclusive use of the ethernet layer, there's no reason to pass the data up to the operating system. There's no reason for the hardware to include additional capabilities of moving that data out of the card. All modern ethernet devices do onboard FCS processing (and often much more). The only exception would be devices intended to analyze ethernet performance and function.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T23:29:14.517

[Wireshark](http://www.wireshark.org)上的[以太网](http://wiki.wireshark.org/Ethernet)维基页面指出：

> 大多数以太网接口也不向 Wireshark 或其他应用程序提供 FCS

所以我认为答案是*否定*的。

# java - 休眠：“字段 'id' 没有默认值”

> ID：804514
> 
> 赞同：148
> 
> 时间：2009-04-29T22:13:58.567
> 
> 标签：java, hibernate, jpa, persistence

我正面临我认为 Hibernate 的一个简单问题，但无法解决（无法访问 Hibernate 论坛当然无济于事）。

我有一个简单的课程我想坚持，但不断得到：

```
SEVERE: Field 'id' doesn't have a default value
Exception in thread "main" org.hibernate.exception.GenericJDBCException: could not insert: [hibtest.model.Mensagem]
    at org.hibernate.exception.SQLStateConverter.handledNonSpecificException(SQLStateConverter.java:103)
    at org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:91)
    [ a bunch more ]
Caused by: java.sql.SQLException: Field 'id' doesn't have a default value
    [ a bunch more ] 
```

持久类的相关代码是：

```
package hibtest.model;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;

@Entity
@Inheritance(strategy = InheritanceType.JOINED)
public class Mensagem  {
    protected Long id;

    protected Mensagem() { }

    @Id
    @GeneratedValue
    public Long getId() {
        return id;
}

    public Mensagem setId(Long id) {
        this.id = id;
        return this;
    }
} 
```

实际运行的代码很简单：

```
SessionFactory factory = new AnnotationConfiguration()
    .configure()
    .buildSessionFactory();

{
    Session session = factory.openSession();
    Transaction tx = session.beginTransaction();

    Mensagem msg = new Mensagem("YARR!");

    session.save(msg);

    tx.commit();
    session.close();
} 
```

我在注释中尝试了一些“策略”，`GeneratedValue`但它似乎不起作用。初始化`id`也无济于事！（例如`Long id = 20L`）。

任何人都可以解释一下吗？

**编辑2：**确认：搞乱`@GeneratedValue(strategy = GenerationType.XXX)`并不能解决它

**已解决：**重新创建数据库解决了问题

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2009-05-11T03:52:23.847

有时，即使在执行`SchemaUpdate`.

如果错误实际上似乎缺乏合理的解释，请尝试重新创建数据库（或至少创建一个新数据库）并使用`SchemaExport`.

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2011-05-28T11:48:20.993

如果您希望 MySQL 自动生成主键，那么您必须在创建表时告诉它。您不必在 Oracle 中执行此操作。

在主键上，您必须包含`AUTO_INCREMENT`. 请参见下面的示例。

```
CREATE TABLE `supplier`  
(  
  `ID` int(11) NOT NULL **AUTO_INCREMENT**,  
  `FIRSTNAME` varchar(60) NOT NULL,  
  `SECONDNAME` varchar(100) NOT NULL,  
  `PROPERTYNUM` varchar(50) DEFAULT NULL,  
  `STREETNAME` varchar(50) DEFAULT NULL,  
  `CITY` varchar(50) DEFAULT NULL,  
  `COUNTY` varchar(50) DEFAULT NULL,  
  `COUNTRY` varchar(50) DEFAULT NULL,  
  `POSTCODE` varchar(50) DEFAULT NULL,  
  `HomePHONENUM` bigint(20) DEFAULT NULL,  
  `WorkPHONENUM` bigint(20) DEFAULT NULL,  
  `MobilePHONENUM` bigint(20) DEFAULT NULL,  
  `EMAIL` varchar(100) DEFAULT NULL,  
  PRIMARY KEY (`ID`)  
) 

ENGINE=InnoDB DEFAULT CHARSET=latin1; 
```

这是实体

```
package com.keyes.jpa;  

import java.io.Serializable;
import javax.persistence.*;
import java.math.BigInteger;

/**
 * The persistent class for the parkingsupplier database table.
 * 
 */
@Entity
@Table(name = "supplier")
public class supplier implements Serializable
{
  private static final long serialVersionUID = 1L;

  @Id
  **@GeneratedValue(strategy = GenerationType.IDENTITY)**
  @Column(name = "ID")
  private long id;

  @Column(name = "CITY")
  private String city;

  @Column(name = "COUNTRY")
  private String country;

  @Column(name = "COUNTY")
  private String county;

  @Column(name = "EMAIL")
  private String email;

  @Column(name = "FIRSTNAME")
  private String firstname;

  @Column(name = "HomePHONENUM")
  private BigInteger homePHONENUM;

  @Column(name = "MobilePHONENUM")
  private BigInteger mobilePHONENUM;

  @Column(name = "POSTCODE")
  private String postcode;

  @Column(name = "PROPERTYNUM")
  private String propertynum;

  @Column(name = "SECONDNAME")
  private String secondname;

  @Column(name = "STREETNAME")
  private String streetname;

  @Column(name = "WorkPHONENUM")
  private BigInteger workPHONENUM;

  public supplier()
  {
  }

  public long getId()
  {
    return this.id;
  }

  public void setId(long id)
  {
    this.id = id;
  }

  public String getCity()
  {
    return this.city;
  }

  public void setCity(String city)
  {
    this.city = city;
  }

  public String getCountry()
  {
    return this.country;
  }

  public void setCountry(String country)
  {
    this.country = country;
  }

  public String getCounty()
  {
    return this.county;
  }

  public void setCounty(String county)
  {
    this.county = county;
  }

  public String getEmail()
  {
    return this.email;
  }

  public void setEmail(String email)
  {
    this.email = email;
  }

  public String getFirstname()
  {
    return this.firstname;
  }

  public void setFirstname(String firstname)
  {
    this.firstname = firstname;
  }

  public BigInteger getHomePHONENUM()
  {
    return this.homePHONENUM;
  }

  public void setHomePHONENUM(BigInteger homePHONENUM)
  {
    this.homePHONENUM = homePHONENUM;
  }

  public BigInteger getMobilePHONENUM()
  {
    return this.mobilePHONENUM;
  }

  public void setMobilePHONENUM(BigInteger mobilePHONENUM)
  {
    this.mobilePHONENUM = mobilePHONENUM;
  }

  public String getPostcode()
  {
    return this.postcode;
  }

  public void setPostcode(String postcode)
  {
    this.postcode = postcode;
  }

  public String getPropertynum()
  {
    return this.propertynum;
  }

  public void setPropertynum(String propertynum)
  {
    this.propertynum = propertynum;
  }

  public String getSecondname()
  {
    return this.secondname;
  }

  public void setSecondname(String secondname)
  {
    this.secondname = secondname;
  }

  public String getStreetname()
  {
    return this.streetname;
  }

  public void setStreetname(String streetname)
  {
    this.streetname = streetname;
  }

  public BigInteger getWorkPHONENUM()
  {
    return this.workPHONENUM;
  }

  public void setWorkPHONENUM(BigInteger workPHONENUM)
  {
    this.workPHONENUM = workPHONENUM;
  }

} 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-29T23:06:07.630

看看`GeneratedValue`的策略。它通常看起来像：

```
@GeneratedValue(strategy=GenerationType.IDENTITY) 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2015-02-10T20:02:29.157

您必须在 hbm2ddl 属性中使用更新。进行更改并将其更新为 Create 以便它可以创建表。

```
<property name="hbm2ddl.auto">create</property> 
```

它对我有用。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2018-07-01T21:34:47.300

手动从数据库中删除表，然后重新运行应用程序对我有用。在我的情况下，我猜表没有正确创建（有约束）。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2019-04-25T16:35:30.993

我有这个问题。我的错误是我将可插入和可更新的文件设置为 false，并试图在请求中设置该字段。该字段在 DB 中设置为 NON NULL。

```
@ManyToOne
@JoinColumn(name="roles_id",  referencedColumnName = "id", insertable = false, updatable = false, nullable=false)
@JsonBackReference
private Role role; 
```

后来我把它改成了——可插入=真，可更新=真

```
@ManyToOne
@JoinColumn(name="roles_id",  referencedColumnName = "id", insertable = true, updatable = true, nullable=false)
@JsonBackReference
//@JsonIgnore
private Role role; 
```

后来效果很好。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-11-09T19:06:58.053

我来到这里是因为错误消息，原来我有两个同名的表。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-07-19T17:47:28.340

另一个建议是检查您是否为自动生成的字段使用了有效类型。请记住，它不适用于 String，但它适用于 Long：

```
@Id
@GeneratedValue(strategy=GenerationType.AUTO)
public Long id;

@Constraints.Required
public String contents; 
```

上述语法适用于使用 Hibernate 作为 JPA 2.0 提供程序在 MySQL 中生成表。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-10-15T17:31:01.767

我有同样的问题。我找到了教程[Hibernate One-To-One Mapping Example using Foreign key Annotation](http://javabycode.com/java-frameworks/hibernate-4-tutorial/hibernate-one-to-one-mapping-example-using-foreign-key-annotation.html)并一步一步地遵循它，如下所示：

使用此脚本创建数据库表：

```
create table ADDRESS (
   id INT(11) NOT NULL AUTO_INCREMENT,
   street VARCHAR(250) NOT NULL,
   city  VARCHAR(100) NOT NULL,
   country  VARCHAR(100) NOT NULL,
   PRIMARY KEY (id)
);

create table STUDENT (
    id            INT(11) NOT NULL AUTO_INCREMENT, 
    name          VARCHAR(100) NOT NULL, 
    entering_date DATE NOT NULL, 
    nationality   TEXT NOT NULL, 
    code          VARCHAR(30) NOT NULL,
    address_id INT(11) NOT NULL,
    PRIMARY KEY (id),
    CONSTRAINT student_address FOREIGN KEY (address_id) REFERENCES ADDRESS (id)   
); 
```

这是带有上表的实体

```
@Entity
@Table(name = "STUDENT")
public class Student implements Serializable {

    private static final long serialVersionUID = 6832006422622219737L;

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;

 }

@Entity
@Table(name = "ADDRESS")
public class Address {

    @Id @GeneratedValue
    @Column(name = "ID")
    private long id;
} 
```

问题已解决。

注意：主键必须设置为AUTO_INCREMENT

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-02-22T10:59:14.210

**只需添加非空约束**

我有同样的问题。我刚刚在 xml 映射中添加了非空约束。**有效**

```
<set name="phone" cascade="all" lazy="false" > 
   <key column="id" not-null="true" />
   <one-to-many class="com.practice.phone"/>
</set> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-12-14T15:15:38.730

也许这就是表模式的问题。**删除表**并重新运行应用程序。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-07-22T06:48:47.780

除了上面提到的之外，**不要忘记**在创建 sql 表时进行**AUTO INCREMENT**，如本例所示

```
CREATE TABLE MY_SQL_TABLE (

  USER_ID INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
  FNAME VARCHAR(50) NOT NULL,
  LNAME VARCHAR(20) NOT NULL,
  EMAIL VARCHAR(50) NOT NULL
); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-11-13T11:40:19.943

当您的字段不可为空时，它需要在创建表时指定默认值。使用正确初始化的 AUTO_INCREMENT 重新创建一个表，因此 DB 不需要默认值，因为它会自行生成它并且永远不会将 NULL 放在那里。

```
CREATE TABLE Persons (
Personid int NOT NULL AUTO_INCREMENT,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Age int,
PRIMARY KEY (Personid) 
```

);

[https://www.w3schools.com/sql/sql_autoincrement.asp](https://www.w3schools.com/sql/sql_autoincrement.asp)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-12-21T09:54:19.217

请检查特定表中列 id 的默认值是否为默认值。如果不设为默认值

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-06-23T16:30:03.683

我有同样的问题。我正在使用一个连接表，而我所拥有的只有一个行 ID 字段和两个外键。我不知道确切的原因，但我做了以下

1.  将 MySQL 升级到社区 5.5.13
2.  重命名类和表
3.  确保我有 hashcode 和 equals 方法

    ```
    @Entity 
    @Table(name = "USERGROUP")
    public class UserGroupBean implements Serializable {
    private static final long serialVersionUID = 1L;

    @Id
    @GeneratedValue(strategy=GenerationType.AUTO)
    @Column(name = "USERGROUP_ID")
    private Long usergroup_id;

    @Column(name = "USER_ID")   
    private Long user_id;

    @Column(name = "GROUP_ID")
    private Long group_id; 
    ```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-02-27T11:30:32.873

如果数据库表有一个旧的未删除列，则会引发相同的异常。

例如： `attribute_id NOT NULL BIGINT(20),`和`attributeId NOT NULL BIGINT(20),`

删除未使用的属性后，在我的情况下为**contractId**，问题得到解决。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-06-24T13:27:13.723

我遇到了这个问题，我错误地`@Transient`在该特定属性上方放置了注释。在我的情况下，这个错误是有道理的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-07-20T14:53:04.970

这发生在我的`@ManyToMany`关系中。我用 注释了关系中的一个字段`@JoinTable`，我删除了它并改用了`mappedBy`@ManyToMany 上的属性。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-07-29T10:00:54.660

我尝试了代码，在我的情况下，下面的代码解决了这个问题。我没有正确解决架构

```
@Entity
    @Table(name="table"
         ,catalog="databasename"
      ) 
```

请尝试添加 `,catalog="databasename"` 与我相同的内容。

```
,catalog="databasename" 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-12-05T09:46:17.877

就我而言，我更改了有问题的表和有问题的字段“id”，我将其设置为 AUTO_INCREMENT，我仍然需要弄清楚为什么在部署时它没有设置为“AUTO_INCREMENT”，所以我必须自己做！

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-12-05T09:56:54.353

那这个呢：

```
<set name="fieldName" cascade="all"> 
   <key column="id" not-null="true" />
   <one-to-many class="com.yourClass"/>
</set> 
```

我希望它对你有帮助。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-01-17T07:46:22.110

尝试将`Long`对象类型更改为`long`原始类型（如果您可以使用原始类型）。

我有同样的问题，改变类型对我有帮助。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-07-12T19:54:47.370

“字段 'id' 没有默认值”，因为您没有`GenerationType.IDENTITY`在`GeneratedValue`Annotation 中声明。

```
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private int id; 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-09-05T12:36:20.883

这个问题是因为有时您需要再次更新/创建数据库，或者有时如果您在 db 表中添加了字段但不是实体类，那么它无法插入任何空值或零，因此出现此错误。所以检查 side.Db 和 Entity 类。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-06-16T18:13:14.170

当模型字段与数据库中的正确表字段不匹配时，我在 GCP 云 sql 中遇到此类错误。示例：当模型字段是`fieldName`
数据库中的表时，应该有字段`field_name` 修复表字段名称帮助我。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-10-07T17:28:24.100

我通过***@GeneratedValue(strategy = GenerationType.AUTO)***改变了***@GeneratedValue(strategy = GenerationType.IDENTITY)***

顺便说一句，我不需要把它创建，只是：

```
spring.jpa.hibernate.ddl-auto: update 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2022-02-06T14:58:21.177

当我更改数据库列类型并且没有添加 auto_increment 时，我解决了类似的问题。在 alter table 命令中添加回 auto_increment 后（就像在我的原始表创建中一样）它起作用了

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2010-05-16T19:36:34.397

向您的实体 Bean 类添加一个方法`hashCode()`并重试

# winforms - Windows 窗体应用程序中的 OOP 与 case 语句

> ID：804521
> 
> 赞同：3
> 
> 时间：2009-04-29T22:16:46.500
> 
> 标签：winforms, oop, software-design

我有一个软件设计问题。假设我有一个包含一些元素的 Windows 窗体，并且我有一个客户对象。例如，客户可以是企业、私人或公司。

现在，表格中将要发生的所有决定都将取决于客户类型。例如，某些元素将被隐藏，某些标签文本会有所不同，等等......事件将有不同的响应。

显然，一种编码方式是在每次需要做出决定时使用 CASE 语句。另一种方法是从基类继承一个 Customer 类和 3 个其他类，例如 BusinessCustomer、PrivateCustomer 和 CorporateCustomer。在后者中，就会出现一个问题：您将如何将窗户合并到其中......

## 已编辑

我有一个想法：我可以在表单中嵌入表单吗？我的要求并没有规定同时显示两个窗口，所以我不必使用 MDI。但是为了根据这里的一些 ppl 评论简化我的设计，我想维护 3 个不同的客户表单，并动态嵌入到主表单中。这样，三个 GUI 是分开的，我不必处理每个控件的可见性。

我假设我可以将一个表单添加到另一个表单，例如：

```
Form child_form = new Form();
parent_form.Controls.Add(child_form); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:39:03.747

这些决定真的不应该在 GUI 中做出。你应该在你的 GUI 后面有一个 ViewModel 来做出这些决定，并为它编写单元测试。（或者一个 Presenter，或者一个 Controller——不同的名字都意味着大致相同的东西：把决定从 GUI 类中取出，放到你可以单元测试的东西中。）

然后，您的 ViewModel 将具有例如 GUI 将禁用的每个元素的布尔属性，以及您可以采取的每个操作的方法（CloseCustomerAccount() 或其他）。

只要表单是为特定类型的客户创建的，并且客户在表单的生命周期内不会更改为不同类型的客户，您就可以传递您的客户对象（存储所有实际客户数据) 到 ViewModel 的构造函数，然后将 ViewModel 传递给 Form 的构造函数。窗体可以在调用 InitializeComponent() 后立即设置其所有 Enabled 属性。另一方面，如果客户类型可能发生变化，那么您的 ViewModel 需要公开一些事件以供表单挂钩，以便表单知道何时重新运行其启用逻辑。

然后，您的问题将移出 Form 并进入 ViewModel。你有一个 ViewModel 类和一堆 case 语句，还是三个 ViewModel 类（可能有第四个是基类）使用多态性，还有一个工厂方法根据特定客户决定要实例化哪个 ViewModel 类?

我会让你的代码成为那里的指南。从最简单的方法开始，这可能是案例陈述。为你关心的每一个行为写一个单元测试。如果 case 语句开始变得太笨拙，则为每个客户类型添加一个 ViewModel 后代，并开始将 case 语句提取到虚拟方法中。如果你在重构过程中犯了错误，你的测试会抓住你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T22:22:26.033

如果您确实有 3 个不同的窗口，每个窗口都处理特定类型的客户，那么使用基类或合同就没有多大意义了。尽管工厂类接受客户类并确定要使用的正确屏幕，但您可能会很聪明。

我遇到了很多。我最终得到一个处理通用内容的基本窗口，然后为每个具体类型扩展它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T22:57:03.673

我同意 Joshua Belden 的回答。为不同类型的客户提供三种不同的表格可能是最容易维护的。

此外，如果您还不知道，您可以从 Form 类派生并在派生的 Form 类中对其进行调整。这甚至得到了设计师的支持。

但是，我想提供一个替代方案：

**桥接模式**：将抽象与其实现分开，因此两者可以独立变化。

你***可以***做的是：

创建三个单独的`UIImplementation`类。这些类可以调整 UI 和`Customer`表单的事件。为了访问表单的私有成员，您需要将`UIImplementation`类声明为嵌套在`CustomerForm`类中。（使用部分类将它们分成不同的文件）。如果表单本身很重要，并且调整微不足道，这可能是一个不错的选择。很难说。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T22:23:28.403

只需选择实现一些抽象客户接口的三个类。在您的应用程序中，您将有一个客户类型的变量*客户*，并且特定客户类型的对象将存储在那里。然后，您的 GUI 可以仅依赖接口并调用*客户*变量上的方法，而不管客户实际与 GUI 交互的是什么。

看看[这篇文章](http://www.artima.com/lejava/articles/designprinciplesP.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T22:54:00.123

我将采用 MVP 类型方法并定义 CustomerPresenter 类，该类公开一个布尔属性，该属性将通过绑定派生您的 UI 控件的启用/禁用状态。

```
public class CustomerPresenter
{
  private Customer _customer;

  public CustomerPresenter(Customer customer)
  {
    _customer = customer;        
  }

  public bool EnableUI
  {
     get
     {
       //TODO: put your customer type basic logic here (switch statement or if/else)
       return _customer.Type == CustomerType.Business;
     }
  } 
}

public CustomerForm: WinForm
{
   private CustomerPresenter _customerPresenter;

   public CustomerForm(){};

   public CustomerForm(Customer customer)
   {
      _customerPresenter = new CustomerPresenter(customer);
   }      

   private void CustomerForm_Load(object sender, EventArgs e)
   {
      _someButton.DataBindings.Add("Enabled",_customerPresenter,"EnableUI");
   }

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T23:01:34.677

解决方案应该由数据驱动，而不是你的代码。

因此，如果您将各种控件标记为在状态“A”、“B”或“C”中可见，则单个方法可以查看其状态并知道哪些控件使可见或不可见。

您知道在为状态“D”添加新控件时您做对了，除了添加控件本身所需的代码更改之外，不需要更改任何代码。

您还可以考虑将表单分解为 4 个子表单、共享、子表单 a、子 b，然后在父表单上同时显示“共享”和“子 a”...

# sql - 导入 mysql 损坏

> ID：804528
> 
> 赞同：1
> 
> 时间：2009-04-29T22:19:01.410
> 
> 标签：sql, mysql, database, csv, import

我正在尝试使用以下行将 CSV 文件导入 MySQL 5.0：

```
LOAD DATA LOCAL INFILE 'file' INTO TABLE MYTABLE FIELDS TERMINATED BY ';' ENCLOSED BY '"' ESCAPED BY '\\' 
```

我的表架构如下

```
CREATE TABLE AUCTIONS (
  ARTICLE_NO      VARCHAR(20),
  ARTICLE_NAME    VARCHAR(100),
  SUBTITLE        VARCHAR(20),
  CURRENT_BID     DECIMAL(5,2),
  START_PRICE     DECIMAL(5,2),
  BID_COUNT       VARCHAR(20),
  QUANT_TOTAL     VARCHAR(20),
  QUANT_SOLD      VARCHAR(20),
  ACCESSSTARTS    VARCHAR(20),
  ACCESSENDS      VARCHAR(20),
  ACCESSORIGIN_END VARCHAR(20),
  USERNAME       VARCHAR(20),
  BEST_BIDDER_ID  VARCHAR(20),
  FINISHED        TINYINT,
  WATCH           TINYINT,
  BUYITNOW_PRICE  DECIMAL(5,2),
  PIC_URL         VARCHAR(120),
  PRIVATE_AUCTION TINYINT,
  AUCTION_TYPE    VARCHAR(20),
  ACCESSINSERT_DATE     VARCHAR(20),
  ACCESSUPDATE_DATE     VARCHAR(20),
  CAT_DESC        VARCHAR(20),
  CAT_PATH       VARCHAR(20),
  ARTICLE_DESC    TEXT,
  COUNTRYCODE     VARCHAR(20),
  LOCATION        VARCHAR(20),
  CONDITIONS      VARCHAR(20),
  REVISED         TINYINT,
  PAYPAL_ACCEPT   TINYINT,
  PRE_TERMINATED  TINYINT,
  SHIPPING_TO     VARCHAR(20),
  FEE_INSERTION   DECIMAL(5,2),
  FEE_FINAL       DECIMAL(5,2),
  FEE_LISTING     DECIMAL(5,2),
  PIC_XXL         TINYINT,
  PIC_DIASHOW     TINYINT,
  PIC_COUNT       VARCHAR(20),
  ITEM_SITE_ID    VARCHAR(20),
  STARTS          DATETIME,
  ENDS            DATETIME,
  ORIGIN_END      DATETIME,
  PRIMARY KEY ( `ARTICLE_NO` )); 
```

我尝试导入的数据示例，其中包含有意为该`ARTICLE_NAME`字段截断的 HTML：

```
"160330609276","Ed Hardy White Tiger Panther Schuhe Gr.40 18ER103W Neu","",Â£40.50,Â£1.00,5,1,0,24/04/2009 14:41:16,27/04/2009 14:41:16,27/04/2009 14:41:16,"brand-leader-europe",0,0,0,Â£0.00,"http://www.modestern.de/ebay/18ER103W/Galeriebild.jpg",0,1,27/04/2009 13:43:30,27/04/2009 13:43:46,"Damenschuhe","Kleidung & Accessoires","
<!DOCTYPE html PUBLIC ""-//W3C//DTD HTML 4.01 Transitional//EN""
   ""http://www.w3.org/TR/html4/loose.dtd"">

<html>
<head>
  <title>Brand-Leader-Europe - Because Fashion is our Business</title>
  <meta http-equiv=""Content-Type"" content=""text/html; charset=iso-8859-1"">
</head>

<style type=""text/css"">
body {
    background-color: #E2E3E0;
}
</style>

<script language=""Javascript"">
function showArtikel() {
  if(document.getElementById)
  document.getElementById(""artikelbeschreibung"").style.display = ""block"";
  document.getElementById(""bezahlung"").style.display = ""none"";
  document.getElementById(""widerrufsrecht"").style.display = ""none"";
  document.getElementById(""ueberuns"").style.display = ""none"";
  document.getElementById(""kontakt"").style.display = ""none"";
  document.getElementById(""agb"").style.display = ""none"";
  document.getElementById(""impressum"").style.display = ""none"";
}
<!-- AfterbuyListing -->",77,"Berlin",1,0,1,0,77,Â£0.25,Â£0.00,Â£0.25,0,0,1,77 
```

我不对正在导入的数据负责。

此数据在没有网络连接的机器上导出为 CSV 文件，因此不能直接导入数据库。我已经尝试过使用该`ESCAPED BY`子句，但这并没有多大帮助。

我想知道如何正确导入数据，或者以可以直接导入的方式将数据导出到 CSV 文件。CSV 文件是从 Microsoft Access 2003 数据库中导出的，使用 UTF-8、逗号作为分隔符以及用“ `"`”括起来的字段。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:40:38.360

你的 LOAD 是说 FIELDS TERMINATED BY ';' 而其他一切都表明终止符是“，”，这可能是问题吗？

# java - JavaEE 5，WAS 6.0 JSP 的奇怪问题包括

> ID：804537
> 
> 赞同：1
> 
> 时间：2009-04-29T22:20:49.173
> 
> 标签：java, jsf, jakarta-ee, websphere

我们目前正在将我们的应用程序从生产环境迁移到全新的数据中心。

*   当前生产环境：Java 1.4、Java EE 3、WAS 5.1、JSF 2.1
*   新数据中心环境：Java 1.5、Java EE 5、WAS 6.1、JSF 2.1

我们的应用程序基于 JSF 2.1 构建，并在其中一个 AJAX 调用中包含以下代码：

```
request.getSession().getServletContext().getRequestDispatcher(
                    “/results.faces”）.include（请求，响应）；
```

这就是我们遇到问题的地方。

案例 1：EAR 结构符合标准规范
。EAR -> WAR -> WEB-INF -> lib -> *.jar（所有应用程序特定的 jar 都在 WEB-INF/lib 下）。这不起作用，我们继续获取类加载器未找到的类的异常。此外，上述 AJAX 调用失败（未生成输出）

案例 2：EAR 包含根目录上的所有应用程序 JAR 文件（MANIFEST.MF 具有手动指定的类路径）。
这种方法非常有效，并且所有 JAR 文件都被加载，没有任何问题。此外，AJAX 调用也很顺利。

任何想法为什么会发生这种情况。

- 阿什什

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T22:25:53.950

是的，这是因为 Java EE 应用服务器有一个类加载器的层次结构，如下所示：首先调用引导类加载器；接下来是 EAR 级别的类加载器，然后是 WAR 级别的类加载器。更高级别的类加载器不会在下面查找他们需要的类。如果他们没有找到他们需要的东西，则会抛出 ClassNotFoundException。

所以 WEB-INF/lib 中的 JAR 对 EAR 级别的类加载器是不可见的。当您将这些 JAR 向上移动时，您就可以解决问题。它也使所有这些 JAR 对您 EAR 中的所有 WAR 可见。

您可能要检查的一件事是 web.xml 和其他文件的规范。servlet 和 JSP 规范在此过程中发生了变化，因此像 JSTL 之类的 JAR 从 1.0 版到 1.1 版。您可能需要仔细检查您的 web.xml 和所有 JAR，以确保它们与您的 Java EE 应用服务器支持的规范相匹配。

不幸的是，升级应用服务器并不像插入 EAR 或 WAR 那样简单。

# python - 确定所需 Python 最低版本的工具？

> ID：804538
> 
> 赞同：52
> 
> 时间：2009-04-29T22:21:12.497
> 
> 标签：python, code-analysis

有没有类似于 Pylint 的东西，它会查看 Python 脚本（或运行它），并确定每行（或函数）需要哪个版本的 Python？

例如，理论用法：

```
$ magic_tool <EOF
with something:
    pass
EOF
1: 'with' statement requires Python 2.6 or greater

$ magic_tool <EOF
class Something:
    @classmethod
    def blah(cls):
        pass
EOF
2: classmethod requires Python 2.2 or greater
$ magic_tool <EOF
print """Test
"""
EOF
1: Triple-quote requires Python 1.5 of later 
```

这样的事情可能吗？我想最简单的方法是将所有 Python 版本放在光盘上，对每个版本运行脚本，看看会发生什么错误。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-04T10:55:39.980

受这个优秀问题的启发，我最近编写了一个尝试执行此操作的脚本。你可以在 github 上的[pyqver](http://github.com/ghewgill/pyqver/tree/master)上找到它。

它相当完整，但有些方面尚未处理（如 README 文件中所述）。随意分叉和改进它！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-30T00:35:46.027

不是一个实际有用的答案，但无论如何它都在这里。我认为这应该是可行的（尽管可能是一个相当大的练习），例如，您可以确保您拥有要检查的版本的所有官方语法，例如[这个](http://docs.python.org/reference/grammar.html)。

然后从第一个语法版本开始解析那段代码。接下来，您需要所有内置模块名称空间的类似映射，并从最早的版本开始再次解析代码，尽管区分内置模块和外部模块或介于两者之间的模块（如 ElementTree）可能很棘手。

结果应该是支持代码语法的版本的概述和模块的概述以及使用它需要哪个版本（如果有的话）。使用该结果，您可以计算出最佳的最低和最高版本。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2019-10-22T09:07:28.760

Greg Hewgill 的工具 pyqver 已经有一段时间没有更新了。

[vermin](https://pypi.org/project/vermin/)是一个类似的实用程序，它以详细模式 ( `-vvv`) 显示决策中考虑了哪些行。

```
% pip install vermin
% vermin -vvv somescript.py
Detecting python files..
Analyzing using 8 processes..
!2, 3.6      /path/to/somescript.py
  L13: f-strings require 3.6+
  L14: f-strings require 3.6+
  L15: f-strings require 3.6+
  L16: f-strings require 3.6+
  print(expr) requires 2+ or 3+

Minimum required versions: 3.6
Incompatible versions:     2 
```

奖励：使用该参数`-t=V`，您可以定义`V`要兼容的目标版本。如果不满足此版本要求，脚本将退出并退出代码`1`，使其易于集成到测试套件中。

# iphone - Apple 在内存管理编程指南中谈论的是哪些“顶级对象”？

> ID：804539
> 
> 赞同：6
> 
> 时间：2009-04-29T22:21:36.520
> 
> 标签：iphone, uikit, nib, xib

在[Cocoa 的内存管理编程指南中，](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/MemoryMgmt/Articles/mmNibObjects.html#//apple_ref/doc/uid/TP40004998-SW4) Apple 谈到了顶级对象。他们说，我需要为他们每个人提供一个奥特莱斯。

> 但是，如果有任何顶级对象未存储在 outlet 中，则必须保留 loadNibNamed:owner:options: 方法返回的数组或数组中的对象，以防止这些对象过早释放。

那么“顶级对象”到底是什么意思呢？我会说他们谈论根视图和窗口。还有什么？这个提示是否仅适用于我想手动加载笔尖的情况？或者它适用于任何笔尖和任何情况？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T00:28:48.883

顶级对象是出现在 Interface Builder 的主 nib 窗口中的对象，而不是文件的所有者和应用程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T22:36:13.660

是的，这是关于手动加载 Nib 的情况，否则您不会调用**loadNibNamed:owner:options:**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-10T03:31:22.157

带有文件所有者、第一响应者、视图的窗口中出现的对象是顶级对象。您添加到视图中的任何内容都将成为子视图 - 所有子视图都由它们的直接父视图保留，因此它们不需要在其他地方保留。视图本身由视图控制器保留，因此不需要保留。

如果您添加非视图对象，或者您没有立即放入主视图的视图（例如当前未显示的工具栏按钮），您需要保留它们，否则它们将被释放。我首选的方法是使用 @property 使用 IBOutlets，如下所示：

```
@property(nonatomic, retain) IBOutlet UIBarButtonItem * myButton; 
```

这会导致 -setMyButton: 在文件所有者上被调用（如果此代码在文件所有者中），并且通过 IB 连接的对象被发送以存储在此属性中。

# php - 在 mvc Web 应用程序的这些场景中，我的控制器会是什么？

> ID：804544
> 
> 赞同：6
> 
> 时间：2009-04-29T22:23:04.597
> 
> 标签：php, model-view-controller, codeigniter

1）您网站的主页在哪里适合“控制器”？我见过一些人使用“页面”控制器来处理静态页面，如关于、主页、联系方式等，但对我来说这似乎不是一个好主意。为您的主页创建一个独特的控制器会是更好的选择吗？毕竟，它可能需要访问多个模型并且不能很好地与整个模型一起使用，每个模型理论一个控制器，某些人使用。

2）如果您需要针对多种类型的用户的仪表板，那是一个仪表板控制器，它的切换代码取决于哪个用户，或者您会在每个用户的每个控制器中说一个仪表板操作？例如，admin/dashboard、account/dashboard 等。

3) 在我看来，在尝试解释控制器时，使用整个简单的 CRUD 示例就像一个魅力，但是一旦你超越了这些简单的功能，它就会崩溃并且可能导致你的控制器变得笨拙。为什么有些人选择创建登录控制器，而其他人在用户控制器中制作登录功能？我认为的一个原因是我们很多人都来自页面方法背景，很难将控制器视为“对象”或“名词”，因为页面并不总是以这种方式工作。举个例子，你到底为什么要创建一个“页面”控制器来处理实际上彼此无关的页面，只是为了有一个“容器”来适应动作。只是对我来说似乎不合适。

4）控制器是否应该更多地与用例有关，而不是与可以执行操作的“对象”有关？出于所有密集目的，您可以创建一个用户控制器来执行整个应用程序中的每个操作。或者您可以像某些人所说的那样为每个“关注区域”创建一个控制器。或者，您可以根据需要为每个视图创建一个控制器。有太多的余地，以至于很难找出一致的使用方法。

控制器可能不应该如此混乱，但出于某种原因，它们让我感到困惑。任何有用的意见将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T23:40:36.283

**1）** 我为我的一些 MVC 东西使用了一组简单的自制类，它将控制器名称与操作和视图名称相关联（它是前端控制器样式，类似于 Zend）。对于一个通用网站，我们假设它有一个主页、隐私政策、联系页面和一个关于页面。我真的不想为所有这些东西制作单独的控制器，所以我会把它们放在我`IndexController`的.`actionIndex()``actionPrivacy()``actionContact()``actionAbout()`

为此，在我的 Views 目录中，我有一个与每个操作关联的模板目录。默认情况下，任何操作都会自动查找关联的模板，但您可以根据需要指定一个。所以`actionPrivacy()`会寻找模板文件`index/privacy.php`，`actionContact()`会寻找`index/contact.php`，等等。

当然，这也与 URL 相关。所以一个 url hit to`http://www.example.com/index/about`会运行`actionAbout()`​​，它会加载 About 页面模板。由于 about 页面是完全静态的内容，我`actionAbout()`除了为 Front Controller 提供一个公共操作来查看和运行之外，什么都不做。

因此，为了回答您问题的核心，我确实将多个“页面”放入一个控制器中，它可以很好地满足我的目的。每个控制器一个模型是我认为在使用 Web MVC 时不会尝试遵循的理论，因为它似乎更适合具有状态的应用程序。

**2）** 为此，我将有多个控制器。按照我上面使用的相同方法，我会`/admin/dashboard`按照`/account/dashboard`您的建议使用，尽管没有理由他们不能使用相同的（或相同的部分）模板。

我想如果我有大量不同类型的用户，我会让事情变得更通用并且只使用一个控制器，并且有一个 mod_rewrite 规则来处理加载。这可能取决于仪表板的功能复杂程度以及帐户设置的情况。

**3)**我发现 CRUD 功能很难直接实现到 MVC 的任何层中，并且仍然保持干净、灵活和高效。我喜欢将 CRUD 功能抽象到任何对象都可以调用的服务层中，并拥有一个基对象类，我可以从中扩展任何需要 CRUD 的对象。

我建议将一些 PHP ORM 框架用于 CRUD。他们可以省去很多获得良好实现的麻烦。

就登录控制器与用户控制器而言，我想这取决于您的应用程序域。以我的编程风格，我倾向于将“登录”视为用户模型域中的一个简单操作，因此在用户控制器中对其进行单一操作。更准确地说，我将`UserController`实例化一个用户模型并在模型上调用一个登录例程。我不能告诉你这是正确的方式，因为我不能确定正确的方式应该是什么。这是一个上下文问题。

**4）** 你是对的。您可以轻松创建一个控制器来处理您的应用程序/网站想要做的所有事情。但是，我认为您会同意这将成为维护的噩梦。想起我在一家市场研究公司的上一份工作时，我仍然会有些笨拙地思考，那里的内部 PHP 应用程序是由一个海外团队完成的，我只能假设几乎没有培训。我们说的是处理整个站点的 10,000 行脚本。这是不可能维持的。

因此，我建议您将您的应用程序/网站分解为业务域，并基于此创建控制器。找出你的应用程序的核心概念，然后从那里开始。

## 例子

假设我有一个关于海牛的网站，因为显然海牛很摇滚。我想要一些普通的网站页面（关于、联系方式等）、用户帐户管理、论坛、图片库，也许还有一个研究文档资料区（关于海牛的最新科学）。很简单，很多都是静态的，但你可以开始看到故障。

`IndexController`- 处理页面、隐私政策、通用静态内容。

`UserController`- 处理帐户创建、登录/注销、偏好

`PictureController`- 显示图片，处理上传

`ForumController`- 可能不多，我会尝试集成一个外部论坛，这意味着我在这里不需要太多功能。

`LibraryController`- 显示最近的新闻和研究列表

`HugAManateeController`- 通过 HTTP 实时拥抱的虚拟海牛

这可能至少给你一个基本的分离。如果您发现控制器变得非常大，则可能是时候将业务域分解为单独的控制器了。

每个项目都会有所不同，所以一点点的规划对于你将拥有什么样的建筑结构大有帮助。

Web MVC 可能会变得非常主观，因为它与应用程序具有状态的 MVC 模型完全不同。在处理 Web 应用程序时，我尝试将主要功能排除在控制器之外。我喜欢他们实例化一些对象或模型，根据正在执行的操作运行几个方法，并在完成后收集一些视图数据以传递给视图。越简单越好，我将核心业务逻辑放入模型中，模型应该代表应用程序的状态。

希望有帮助。

# git - 将更改推送到远程存储库时，此 Git 警告消息是什么？

> ID：804545
> 
> 赞同：77
> 
> 时间：2009-04-29T22:23:14.207
> 
> 标签：git, version-control

描述有点简洁。我只是在本地主分支上添加了一个文件，然后将其推送回远程仓库。知道为什么会这样吗？

```
警告：更新当前分支
警告：更新当前签出的分支可能会导致混乱，
警告：因为索引和工作树不反映 HEAD 中的更改。
警告：因此，您可能会看到刚刚推入其中的更改
警告：当你在那里运行'git diff'时恢复，你可能想要
警告：在开始恢复之前运行“git reset --hard”。
警告：
警告：您可以将“receive.denyCurrentBranch”配置变量设置为
警告：远程存储库中的“拒绝”禁止推送到其
警告：当前分支。
警告：要允许推入当前分支，您可以将其设置为“忽略”；
警告：但除非您安排更新其工作，否则不建议这样做
警告：树以匹配您以其他方式推送的内容。
警告：
警告：要压制此消息，您可以将其设置为“警告”。
警告：
警告：请注意，默认值将在未来版本的 git 中更改
警告：拒绝更新当前分支，除非你有
警告：配置变量设置为“忽略”或“警告”。   

```

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2015-02-01T11:20:02.900

## 使用 Git 2.3.0（2015 年 2 月之后）

如果没有人在该远程非裸仓库中工作，那么应该可以推送到已签出的分支。

但为了在该操作中更安全，您现在可以（使用 Git 2.3.0，2015 年 2 月）在该远程存储库中执行以下操作：

```
git config receive.denyCurrentBranch updateInstead 
```

它比 config 更安全`receive.denyCurrentBranch=ignore`：只有当您没有覆盖正在进行的修改时，它才会允许推送。

请参阅[Johannes Schindelin (](https://github.com/dscho) [)](https://github.com/dscho)的[提交 1404bcb](https://github.com/git/git/commit/1404bcbb6b3bdb248d32024430644e55faec91ce)：[`dscho`](https://github.com/dscho)

> ### `receive-pack`: 添加另一个选项`receive.denyCurrentBranch`
> 
> 在工作目录之间同步时，通过 ' `push`' 而不是 ' `pull`' 来更新当前分支会很方便，例如从 VM 内部推送修复程序时，或推送在用户机器上进行的修复程序时（开发人员不在安装 ssh 守护进程的自由，更不用说知道用户的密码了）。
> 
> 这个补丁不再需要常见的解决方法——推入一个临时分支，然后在另一台机器上合并。
> 
> 新选项是：
> 
> ```
> updateInstead 
> ```
> 
> 相应地更新工作树，但如果有任何未提交的更改，则拒绝这样做。

* * *

[提交 4d7a5ce](https://github.com/git/git/commit/4d7a5ceacc97e69c4ab5e1543f61fafafb963a9c)添加了更多测试，并提到：

> 前一个仅测试通过推送部署更新的路径在已添加到索引的目标工作树中具有不兼容更改的情况，但功能本身希望要求工作树为比测试的要干净得多。
> 
> 添加更多测试以保护功能免受将来错误地（从功能发明者的角度）放宽清洁度要求的更改，即：
> 
> *   仅对工作树而不是对索引的更改仍然是需要保护的更改；
> *   需要保护工作树中将被推送部署覆盖的未跟踪文件；
> *   碰巧使文件与被推送的文件相同的更改仍然是需要保护的更改（即功能的清洁度要求比检出的要求更严格）。
> 
> 此外，测试对工作树的仅统计更改不是拒绝推送部署的理由。

## 使用 Git < 2.3.0（2015 年 2 月之前）

最常见的方法是从非裸存储库创建一个裸存储库，并将远程/本地非裸 git 存储库都指向新创建的裸存储库。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-04-30T01:21:00.677

实际上，它的意思几乎与它所说的完全一样：有人在你推送到的存储库中工作，并且有人当前已经检查了你推送到的完全相同的分支。

这很令人困惑，因为现在他们认为他们已经签出了分支的最新版本，而实际上，您刚刚将分支更新到了较新的版本。因此，当它们现在运行时`git commit`，*它们的*提交基本上会还原您刚刚推送的所有提交。当他们运行时，`git diff`他们会看到与你刚刚推动的一切相反的情况，即使他们可能甚至没有改变任何东西。

出于这个原因，通常认为推送到非裸存储库是不好的做法；您应该只推送到裸存储库，即没有附加工作副本的存储库。至少你应该确保你不推送到当前签出的分支，但通常你不应该只是将你的代码推到别人的存储库中，你应该让他们从你那里拉取。

在某些特殊情况下，例如当您从 Git 存储库为网站提供服务并且您想通过推送来更新网站时，推送到当前签出的分支实际上是有意义的，但在这种情况下，您必须确保你安装了一个真正*更新*签出工作副本的钩子，否则你的网站将永远不会更新。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-08-24T04:41:20.217

[This question与This question](https://stackoverflow.com/questions/738154/what-does-git-updating-currently-checked-out-branch-warning-mean)相同，解决方案是使用`git init --bare`or `git clone --bare`。

# wpf - WPFToolKit DataGrid中的动画行消失

> ID：804549
> 
> 赞同：7
> 
> 时间：2009-04-29T22:23:55.080
> 
> 标签：wpf, animation, datagrid, wpftoolkit

我已经下载了 WPFToolkit，我正在使用这个包中提供的 DataGrid。当行被删除时，我试图为行消失设置动画，但我不知道该怎么做。有谁知道怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T19:30:33.513

这在 WPF 中可能很棘手——尽管你的老板会认为这应该很容易——因为 WPF 应该启用动画和引人注目的视觉效果。毕竟，网上有各种很棒的 Silverlight/WPF 演示，它们看起来很棒，而且真正销售技术。当然，您的老板不知道的是，这些演示只是为了炫耀简单、华丽的功能而编写的。然而，与标准略有不同的事情有一种非常困难的令人讨厌的方式。

但是足够的咆哮，我会给你一个可能的方法，尽管可能有一个更好的方法：

假设您已将 DataGrid 绑定到某种集合，并且为了论证，我们假设它是一个`Foo`对象列表，即`List<foo> MyFoos`. 然后，您可以向名为 BeingDeleted 的 FOO 类添加一个属性。然后在您的 DataRowView 的模板中，触发此属性以启动一个故事板，该故事板为该特定行的淡出或折叠设置动画。这有点粗俗，因为它意味着向 Foo 对象添加一个可能与它无关的属性。您也可以创建一个特殊的包装器或 Foo 的子类。

# iphone - 在 iPhone 上创建 ADTS 框架....问题

> ID：804552
> 
> 赞同：1
> 
> 时间：2009-04-29T22:24:45.903
> 
> 标签：iphone, audio, core-audio, aac, adts

我从网络流中获取原始 aac 数据并尝试将其放入 ADTS 帧中以便在 iPhone 上播放。

它工作 10 秒，然后声音停止并重新启动，但似乎加速或与其他音频数据混合。

Quicktime 和其他音频应用程序无法打开我的文件。

看来我的 ADTS 标头是错误的，但我找不到在哪里。那里有可以帮助我的 ADTS 大师吗？

[这是我的广告文件](http://www.jesuswillsaverockstarstoo.com/show/page/number/1)

非常感谢你的帮助。

蒂埃里

PS：你知道检查和报告音频文件问题的工具吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:56:44.610

成立。

帧大小无效。

我还在 os x 上找到**了 afinfo**，这对于获取文件信息非常有用。

# iphone - 如何在iphone上触摸空白区域时隐藏键盘

> ID：804563
> 
> 赞同：71
> 
> 时间：2009-04-29T22:28:39.887
> 
> 标签：iphone, iphone-softkeyboard

通常触摸文本输入区域时，键盘会弹出，而当您触摸屏幕的空白区域时，键盘会消失。如何做到这一点？

就像我们在 iphone safari 上所经历的一样......

谢谢

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-04-30T02:35:18.500

更新方式（推荐）：

```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event 
{
   [self.view endEditing:YES];
} 
```

这将结束对所有子视图的编辑并辞去第一响应者的职务。

其他方式（枚举所有文本视图）：

这是它的一步一步：

将 IBAction 添加到您的视图控制器，例如 - (IBAction)backgroundTouch:(id)sender

在 backgroundTouch 操作中，您需要将 resignFirstResponder 消息发送到视图中的所有文本框。这是不幸的，但这是必要的，因为目前无法检索当前具有 FirstResponder 状态的对象。它应该看起来像这样：

```
- (IBAction)backgroundTouch:(id)sender {
  [someTextBox resignFirstResponder];
  [anotherTextBox resignFirstResponder];
} 
```

向视图添加一个按钮控件，调整其大小以覆盖整个可见区域（状态栏或任何选项卡或导航控制器除外）。选择 按钮，然后转到布局菜单并选择发送到后面。还将按钮的类型设置为自定义，如果您没有专门为其提供任何绘图代码，则它是不可见的。

将 Button 的 Touch Up Inside 事件连接到 backgroundTouch: 动作并尝试一下。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2012-03-08T14:10:20.540

使用这个简单的解决方案

对于斯威夫特 4：

```
 override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {
        self.view.endEditing(true)
   } 
```

对于斯威夫特 2：

```
 override func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {
        self.view.endEditing(true)
    } 
```

对于目标 C：

```
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event 
{
   [self.view endEditing:YES];
} 
```

适用于 UITextField、UITextView 和所有子视图。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-11-19T17:39:46.733

忘记在后台放一个按钮简单的解决方案

```
(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    [self.textfieldName resignFirstResponder];
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-12-27T15:38:51.607

对于 > iOS 4.0，还有另一种解决方案（也许更好） 使用此代码，单击视图中的任意位置以隐藏键盘。

```
// single tap to resign keyboard
UITapGestureRecognizer *singleTapRecognizer = [[UITapGestureRecognizer alloc] initWithBlock:^(UIGestureRecognizer *rec){
            [input_text resignFirstResponder];
        }];
self.singleTapRecognizer.numberOfTapsRequired = 1;
self.singleTapRecognizer.cancelsTouchesInView = NO;
[self.view addGestureRecognizer:singleTapRecognizer]; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-07-29T11:05:30.930

有一个关于这个问题的教程（也关于没有 DONE 键的数字键盘）在[这里](http://jcdeveloperworld.blogspot.com/2009/06/image-by-snapp-via-flickr-let-me.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-29T23:44:11.330

发送`resignFirstResponder`到控件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-02-02T11:40:07.197

以下代码适用于 xamarin iOS 项目：

```
public override void TouchesBegan (NSSet touches, UIEvent evt){
    View.EndEditing (true);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-08-05T08:03:19.067

你也可以这样做

通过在视图中触摸背景来隐藏键盘

```
- (void) touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    [[self view] endEditing:YES];
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-12T02:51:23.650

我无法使用 'initWithBlock:' 选择器编译 Val 上面的答案。

这段代码对我有用。将此添加到定义视图的方法中 - 请注意，我的视图是组合的，我想要响应单击的子视图是“chatView”。使用键盘的输入字段视图名为“chatInput”。

```
 // single tap to resign (hide) the keyboard
    UITapGestureRecognizer *singleTapRecognizer = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handleTapFrom:)];
    singleTapRecognizer.numberOfTouchesRequired = 1;
    singleTapRecognizer.cancelsTouchesInView = NO;
    [chatContent addGestureRecognizer:singleTapRecognizer]; 
```

然后添加点击处理方法。

```
/**
 * Handles a recognized single tap gesture.
 */
- (void) handleTapFrom: (UITapGestureRecognizer *) recognizer {
    // hide the keyboard
    NSLog(@"hiding the keyboard");
    [chatInput resignFirstResponder]; 
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-26T23:13:27.737

我也遇到了这个问题，很烦。但我想出了如何在意外中摆脱键盘。假设您正在给 John 发短信，并且有一个键盘妨碍您查看对话，因此减少了您可以看到的屏幕。然后点击左上角的消息，然后选择另一个你有发短信记录的人，然后再次点击左上角的消息。然后返回并选择 John。不，你又回到了与约翰的对话中，键盘不见了。接缝很多，但速度很快。你会认为他们只是在键盘上放了一个隐藏按钮 lol 希望有帮助，或者足够清楚。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-06-12T21:35:00.423

如果您使用 swift 和 iOS 8/9，此解决方案应该可以正常工作：

```
 override func touchesBegan(touches: Set<NSObject>, withEvent event: UIEvent) {
         self.view.endEditing(true)
    } 
```

# asp-classic - 我在哪里可以管理服务器对象？

> ID：804568
> 
> 赞同：0
> 
> 时间：2009-04-29T22:30:52.160
> 
> 标签：asp-classic, odbc

如何将 odbc 对象链接到我编写的存储过程。请看下面的例子：

以下代码执行一个名为 DEPT_Add 的存储过程，但对象函数的名称是 AddDepartment。

```
Set oDept = Server.CreateObject("JTQTMS.JTDept")
bReturn = oDept.AddDepartment(CStr(sDeptName)) 
```

我的问题是，如果我添加一个名为 PROPERTY_Add 的新存储过程，我将如何进入并添加一个名为 AddProperty 的对象函数。

下面的代码似乎不起作用，因为我找不到在哪里创建 AddProperty 方法并将其链接到我存储的 proc PROPERTY_Add。

```
Set oProp = Server.CreateObject("JTQTMS.JTProperty")
bReturn = oProp.AddProperty(CStr(sDeptName), CStr(sDeptDescription)) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T22:41:49.450

这在我看来就像 JTQTMS.JTDept 是一个 COM 组件类。
类是 JTDept，COM 组件是 JTQTMS。

查看组件服务（如果我没记错的话），看看是否可以在那里找到对它的任何引用。

我相信正在发生的事情是 COM 组件的 AddDepartment 方法在内部调用 Dept_Add 存储过程。

要对 Property__Add 执行相同操作，您需要将 AddProperty 方法添加到 COM 组件，该组件又调用 Property_Add 存储过程。

# unit-testing - 为什么我应该使用测试驱动开发？

> ID：804569
> 
> 赞同：12
> 
> 时间：2009-04-29T22:31:01.957
> 
> 标签：unit-testing, tdd, agile

### 复制：

*   [为什么我应该练习测试驱动开发，我应该如何开始？](https://stackoverflow.com/questions/4303/)

对于不了解测试驱动开发的开发人员，采用 TDD 可以解决哪些问题？

[编辑] 假设开发人员已经（ab）使用了单元测试框架。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-29T23:11:26.523

以下是 TDD 可能帮助开发人员/团队的三个原因：

*   更好地理解你要写的内容
*   更好地执行编写测试的策略
*   加速发展

首先编写测试的一个原因是在编写代码之前更好地理解实际代码。对我来说，这是测试驱动开发的主要好处。当您首先编写测试用例时，您会更加批判性地考虑极端案例。当您编写代码并确保它们是准确的时，更容易解决它们。

另一个原因是实际上强制编写测试。通常，当人们在没有 TDD 的情况下进行单元测试时，他们会设置一个测试框架，编写一些新代码，然后退出。他们认为代码已经可以正常工作了，那为什么还要编写测试呢？它很简单，不会损坏，对吧？但是现在您已经失去了首先进行单元测试的优势（完全不同的讨论）。先写它们，它们已经在那里了。

首先编写这些测试可能意味着您不需要在调试环境中启动程序（缓慢——尤其是对于较大的项目）来测试一些小事情是否有效。当然，在提交更改之前没有理由不这样做。

说服自己或其他人先编写测试可能很困难。你可能有更好的运气让他们同时写两者，这可能同样有益。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T22:37:28.493

假设您在将其提交到存储库之前测试了您编写的代码。

如果这不是真的，那么您还有其他问题需要处理。

如果这是真的，您可以将使用框架编写测试作为自动化您当前编写的那些主要例程或驱动程序的一种方式，以便您只需按一下按钮即可自动运行所有它们。您不必仔细研究输出来决定测试是通过还是失败；您将测试的成功或失败嵌入代码中，并立即做出赞成或反对的决定。一次运行所有测试可以减少“重击”情况的机会，即您在一个类中修复某些东西并破坏其他东西。所有的测试都必须通过。

到目前为止听起来不错，是吗？

TDD 人员只是更进一步，要求您在编写课程之前先编写测试。当然，它失败了，因为您还没有编写课程。这是他们保证您编写测试类的方式。

如果您已经在使用测试框架，从您编写的测试中获得良好的价值，并且有意义的代码覆盖率达到 70% 左右，那么我认为您做得很好。我不确定 TDD 是否会给您带来更多价值。是否要加倍努力由您决定。就个人而言，我不这样做。我在课后编写测试，如果我觉得有必要进行重构。有些人可能会发现在知道它会失败的情况下先编写测试很有帮助，但我没有。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-29T23:38:02.717

（这更像是同意 duffymo 的回答的评论，而不是它自己的回答。）

达菲莫回答：

> TDD 人员只是更进一步，要求您在编写课程之前先编写测试。当然，它失败了，因为您还没有编写课程。这是他们保证您编写测试类的方式。

我认为这实际上是在迫使编码人员思考他们的代码在做什么。必须考虑一个测试让我们考虑代码应该做什么：前置条件和后置条件是什么，哪些函数是原始的，哪些是由原始函数组成的，最小必要的公共接口是什么，以及什么是一个实现细节。

这些都是我经常想到的事情，所以像你一样，“先测试”*对我来说*并没有增加很多。坦率地说（我知道这在某些圈子里是异端邪说）我喜欢通过首先勾勒出公共接口来“锚定”一个类的核心思想；这样我就可以看着它，在精神上使用它，看看它是否像我想象的那样干净。（类或库应该易于客户端程序员使用且直观。）

换句话说，我做 TDD 试图通过首先编写测试来确保发生的事情，但就像 duffymo 一样，我以不同的方式到达那里。

“测试优先”的真正意义在于让编码人员停下来像设计师一样思考。迷恋程序员如何进入那种状态是愚蠢的。对于那些不自然地做到这一点的人，“先测试”是一种让他们到达那里的仪式。对于那些这样做的人来说，“先测试”并没有增加太多——而且会妨碍程序员习惯性地进入那种状态。

同样，我们想看结果，而不是仪式。如果一个低年级的人需要一个仪式、一个“十字架站”或一个念珠*来“进入状态”，“先测试”就可以达到这个目的。如果有人也有自己的方式到达那里，那也很好。

请注意，我并不是说不应该测试代码。它应该。它为我们提供了一个安全网，这反过来又使我们能够将注意力集中在编写好的代码，甚至是*大胆*的代码上，因为我们知道网络是用来捕捉错误的。

我要说的是，对“测试优先”的恋物癖坚持将*方法*（众多方法之一）与*目标*混淆，让程序员思考他在编码什么。

*为了普世，我会注意到天主教徒和穆斯林都使用念珠。再说一次，这是一种*机械*的、肌肉记忆的方式，可以让自己进入某种思维框架。这是一种恋物癖（原始意义上的魔法物品，而不是“性恋物癖”的意思）或幸运符。所以说“Om mani padme hum”，或者坐禅，或者抚摸一只“幸运”兔子的脚，（兔子就没那么幸运了。）哲学家杰瑞福多在思考难题时，也有类似的仪式：他重复对自己说，“来吧，杰瑞，你能做到的！” （我也试过了，但是因为我的名字不是杰瑞，所以它对我不起作用。；））

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T22:41:14.320

理想情况下：

您不会浪费时间编写不需要的功能。您将拥有一个全面的单元测试套件，作为重构的安全网。您将获得有关如何使用您的代码的可执行示例。您的开发流程将更加顺畅和快捷；您将在调试器上花费更少的时间。

但最重要的是，您的设计会更好。您的代码将被更好地分解 - 松散耦合、高度内聚 - 并且形成更好 - 更小、更好命名的方法和类。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-29T23:11:26.477

对于我当前的项目（运行在一个相对重量级的流程上），我采用了一种特殊形式的 TDD，它包括基于需求文档和 GUI 模型编写框架测试用例。在开始实现任何东西之前，我写了几十个，有时是几百个（这完全违背了“纯” TDD，它说你应该写一些测试，然后立即开始一个框架实现）。

我发现这是查看需求文档的绝佳方式。我必须更深入地思考其中描述的行为，而不是仅仅阅读它们。结果，我发现了更多的不一致和差距，否则我只会在实施过程中发现。这样，我可以更早地要求澄清，并在开始实施时有更好的要求。

然后，在实施过程中，测试是衡量我还没有走多远的一种方式。它们可以防止我忘记任何事情（别笑，当您处理更大的用例时，这是一个真正的问题）。

寓意是：即使您的开发流程并不真正支持 TDD，它仍然可以以某种方式完成，并提高质量和生产力。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T23:17:48.397

我个人不使用 TDD，但我可以看到的最大的专业人士之一是**客户满意度**保证。基本上，这个想法是您的开发过程的步骤如下：

1) 与客户讨论应用程序应该做什么，以及它应该如何应对不同的情况。

2) 将 1) 的结果转化为单元测试，每个单元测试测试一个特性或场景。

3) 编写简单、“草率”的代码，（勉强）通过测试。完成此操作后，您就满足了客户的期望。

4) 重构你在 3) 中编写的代码，直到你认为你已经以最有效的方式完成了它。

完成此操作后，您有望生成满足客户需求的高质量代码。如果客户现在想要一个新特性，你就重新开始循环——讨论这个特性，编写一个确保它工作的测试，编写通过测试的代码，重构。

正如其他人所说，每次运行测试时，都要确保旧代码仍然有效，并且可以添加新功能而不会破坏旧功能。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-29T22:38:15.997

与我交谈过的大多数人都没有使用完整的 TDD 模型。他们通常会找到最适合他们的测试模型。找到你的 TDD 并找到你最有效率的地方。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T22:43:54.580

我努力学习 TDD 以用于 Ruby on Rails 开发。我花了几天的时间才真正进入它。我很怀疑，但我做出了努力，因为我尊重的程序员支持它。

在这一点上，我觉得这绝对值得付出努力。我相信其他人会很乐意为您列出一些好处。对我来说，最重要的优势是它有助于避免在项目后期出现噩梦般的情况，即在没有明显原因的情况下突然发生故障，然后您将花费一天半的时间使用调试器。当您向其中添加越来越多的逻辑时，它有助于防止您的代码库恶化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-30T11:55:49.887

TDD（测试驱动开发/设计）提供以下优势

*   确保您在开始之前了解故事卡的接受标准
*   确保您知道何时停止编码（即，何时满足验收标准，从而防止镀金）

结果，您最终得到的代码是

1.  可测试的
2.  干净的设计
3.  能够自信地重构
4.  满足故事卡所需的最少代码
5.  代码如何工作的活规范
6.  能够支持新功能的可持续发展步伐

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T02:21:48.347

众所周知，编写测试并拥有大量自动化测试是一件好事。

但是，如果没有 TDD，它通常会变得乏味。人们编写测试，然后离开它，测试没有得到应有的更新，新功能也没有得到应有的测试频率。

其中很大一部分是因为代码变得难以测试 - TDD 会影响您的设计，因此更*容易*测试。因为您使用过 TDD，所以您有大量的测试，这使得在您的代码或需求发生变化时更容易找到回归，极大地简化了调试，引起对良好 TDD 的欣赏，并鼓励在发生变化时编写更多测试需要——我们又回到了循环的开始。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-04-29T22:36:25.720

有很多优点：

*   **更高的代码质量**
*   更少的错误
*   减少浪费的时间

仅这些中的任何一个都足以证明实施 TDD。

# php - 如何减去两个日期，忽略 PHP 中的夏令时？

> ID：804571
> 
> 赞同：1
> 
> 时间：2009-04-29T22:34:08.703
> 
> 标签：php, datetime, dst

我正在尝试计算两天之间的天数，但我遇到了夏令时问题。这是我的代码：

```
function date_diff($old_date, $new_date) {
    $offset = strtotime($new_date) - strtotime($old_date);
    return $offset/60/60/24;
} 
```

只要这几天都在同一 DST 期间，就可以正常工作：

```
echo date_diff('3/15/09', '3/18/09'); // 3 
```

但如果它们相距更远，则不会：

```
echo date_diff('11/15/08', '3/18/09'); // 122.95833333333 
```

我想要偶数天，不关心 DST。我想我可以对结果进行四舍五入，但这感觉很笨拙。有没有更好（简单）的方法？如果可以避免的话，我不想写一整天的解析和计数避免闰年的事情。

（注意：这必须在 php 5.1.6 下运行，因此 5.3 中的某些日期功能可能不可用。）

更多信息：我将获取偏移量并将其添加到数据库中的其他日期时间，并且我只想更改日期部分，而不是时间部分。无论如何，四舍五入是行不通的，因为当我进行添加时，它会在另一个方向下降一小时。也许有一个更好的方法来解决整个问题......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T22:59:27.740

强制日期进入没有夏令时，GMT/UTC 的时区：

```
function date_diff($old_date, $new_date) {
  $offset = strtotime($new_date . " UTC") - strtotime($old_date . " UTC");
  return $offset/60/60/24;
}

echo date_diff('3/15/09', '3/18/09'); // 3
echo date_diff('11/15/08', '3/18/09'); // 123 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T22:42:15.643

您可以使用[http://ca3.php.net/date_default_timezone_set](http://ca3.php.net/date_default_timezone_set)将时区设置为 GMT，这样就不会有偏移。

或者，您可以使用`date('I',$timetamp)`

```
if ( date("I") == 1 ) {      // "WE ARE MDT";  
        $timeZone = "MDT";  
} else {  
        $timeZone = "MST";  
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:51:57.367

[`floor()`](http://php.net/floor)您可以使用或强制在特定方向进行舍入[`ceil()`](http://php.net/ceil)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-18T18:56:11.607

我尝试了上面的“UTC”代码。没有为我工作。我得到十进制值。

当日期范围内有夏令时日期时，差值序列小数部分将低于 0.5 或更大。当日期范围有夏令时进行 3/15 时，十进制值 > .5 当日光关闭时，日期十进制 < .5。所以我只是将差异序列放在一个 round() 函数中，我得到了我需要的天数的整数。

# java - Spring-MVC 控制器重定向到“上一个”页面？

> ID：804581
> 
> 赞同：31
> 
> 时间：2009-04-29T22:36:58.400
> 
> 标签：java, spring-mvc

假设我有一个用于编辑 Pony 属性的表单，并且在我的 Web 应用程序中有多个位置可以选择编辑 Pony。例如，在小马列表中，每个小马旁边可能有一个“编辑”链接，当用户查看小马时，该视图中可能还有一个“编辑”链接。

当用户在编辑 Pony 后单击“提交”时，我想将用户返回到他或她在单击“编辑”链接时所在的页面。

如何编写控制器以将用户重定向回他们开始的地方？当然，我可以通过将参数传递给控制器​​来做到这一点，但这似乎有点愚蠢。我是不是在想这一切都是错的，或者这几乎就是我必须做的？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-10-06T13:44:32.660

这是男孩的做法（注意这是 RESTful Spring 3 MVC 语法，但它适用于较旧的 Spring 控制器）：

```
@RequestMapping(value = "/rate", method = RequestMethod.POST)
public String rateHandler(HttpServletRequest request) {
    //your controller code
    String referer = request.getHeader("Referer");
    return "redirect:"+ referer;
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-05T20:02:46.287

当然，一种选择是在新窗口中打开编辑表单，因此用户所要做的就是关闭它，然后他们就会回到原来的位置。

在我当前的应用程序中有几个地方我需要做一些复杂的事情，然后将用户传递给一个表单，然后让他们返回到起点。在这些情况下，我在传递它们之前将起点存储在会话中。这可能对你正在做的事情来说太过分了。

其他选项：1）您可以存储“Referer”标头并使用它，但这可能不可靠；并非所有浏览器都设置该标题。2）您可以在调用“”的表单提交后的确认页面上有javascript `history.go(-2)`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-08-24T15:21:32.090

我的回答与 Sam Brodkins 的相似（我也推荐过）。但是考虑到“Referer”值可能不可用，我让这个函数在我的控制器中使用它

```
/**
* Returns the viewName to return for coming back to the sender url
*
* @param request Instance of {@link HttpServletRequest} or use an injected instance
* @return Optional with the view name. Recomended to use an alternativa url with
* {@link Optional#orElse(java.lang.Object)}
*/
protected Optional<String> getPreviousPageByRequest(HttpServletRequest request)
{
   return Optional.ofNullable(request.getHeader("Referer")).map(requestUrl -> "redirect:" + requestUrl);
} 
```

因此，在您的控制器调用函数中，您应该返回如下内容：

```
@RequestMapping(value = "/upload", method = RequestMethod.POST)
public @ResponseBody
String testRedirection(HttpServletRequest request)
{
      //Logic....
      //Returns to the sender url
      return getPreviousPageByRequest(request).orElse("/"); //else go to home page
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-05T15:35:58.117

是的，我认为 Jacob 对新窗口中的表单的想法可能是一个不错的选择。或在隐藏的 div 中。就像一个道场对话。[http://dojocampus.org/explorer/#Dijit_Dialog_Basic](http://dojocampus.org/explorer/#Dijit_Dialog_Basic)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-15T15:22:31.007

另一种选择是设计您的网址，以便它们揭示您正在做的事情的上下文，并且按照惯例，可以让您“知道”操作的开始位置。

例如，你可以有这样的网址

```
site/section1/pony/edit
site/section1/pony/delete

site/somewhere/else/entirely/pony/edit
site/somewhere/else/entirely/pony/delete 
```

这两个网址都允许小马编辑和删除。要回到他们两个的起点，您只需“向上”2个文件夹。这可以通过一个查看当前 url 的 javascript 函数来完成，并且只增加 2 个文件夹，或者您可以在服务器端 2 上找出它，并进行类似的重定向。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-03T10:10:14.273

您还可以使用拦截器跟踪上次呈现给用户的 ModelAndView（或仅视图）。此示例仅跟踪最后一个模型和视图，但您可以使用列表导航回更多级别。

```
package com.sample;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class LastModelAndViewInterceptor extends HandlerInterceptorAdapter {

    public static final String LAST_MODEL_VIEW_ATTRIBUTE = LastModelAndViewInterceptor.class.getName() + ".lastModelAndView";

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        request.getSession(true).setAttribute(LAST_MODEL_VIEW_ATTRIBUTE, modelAndView);
        super.postHandle(request, response, handler, modelAndView);
    }

} 
```

使用 Spring XML 配置：

```
<bean id="handlerMapping" class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
    <property name="interceptors">
        <bean class="com.sample.LastModelAndViewInterceptor"/>
    </property>
</bean> 
```

然后使用以下代码返回控制器中的该视图：

```
ModelAndView mv = (ModelAndView)request.getSession().getAttribute(LastModelAndViewInterceptor.LAST_MODEL_VIEW_ATTRIBUTE);
return mv; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-04T04:54:07.823

```
response.sendRedirect(request.getHeader("Referer")); 
```

# javascript - 如何删除现有的类名并使用 jQuery 和 cookie 添加一个新的类名？

> ID：804584
> 
> 赞同：3
> 
> 时间：2009-04-29T22:37:20.367
> 
> 标签：javascript, jquery, css, cookies

如何删除一个类名并用一个新的类名替换它？

```
<style>
    .red {background-color: #FF0000;}
    .green{background-color: #00FF00;}
    .blue {background-color: #0000FF;}
</style>

<body class="red">
    <ul>
        <li><a href="">red</a></li>
        <li><a href="">green</a></li>
        <li><a href="">blue</a></li>
    </ul>
</body> 
```

在这种情况下，当您单击红色或绿色或蓝色时，body 类名称将相应更改。它还会制作一个 cookie 来保存选择。

我尝试了 jQuery .addClass 并且它正在工作，但它在现有的基础上添加了一个类。我也无法保存cookie。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-29T22:41:02.883

采用：

```
$('.red').removeClass('red').addClass('blue'); 
```

[这是完整的工作代码](http://jsbin.com/ugufi)：

```
$(function() {
    $("a").click(function() {
        var color = $(this).text();
        $("body").removeClass().addClass(color);
        return false;
    });
}); 
```

现在是饼干部分

```
$(function() {
    $("a").click(function() {
        var color = $(this).text();
        $("body").removeClass().addClass(color);
        createCookie("color",color);
        return false;
    });

    if (readCookie("color") != null) {
      $("body").removeClass().addClass(readCookie("color"));

    }
    else {
      $("body").removeClass().addClass("red");
    }
});

function createCookie(name,value,days) {
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*24*60*60*1000));
        var expires = "; expires="+date.toGMTString();
    }
    else
        var expires = "";
        document.cookie = name+"="+value+expires+"; path=/";
    }

    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ')
                c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0)
                return c.substring(nameEQ.length,c.length);
        }
        return null;
    }

    function eraseCookie(name) {
    createCookie(name,"",-1);
} 
```

[这里的工作示例](http://jsbin.com/usucu)。感谢[QuirksMode](http://www.quirksmode.org/js/cookies.html)提供的预制 cookie 代码（cookie-cutter cookie 代码？）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T23:28:16.127

如果没有 jQuery，您可以使用如下简单的代码来做到这一点：

```
document.getElementsByTagName("body")[0].className = "red"; 
```

这有效地删除了分配给元素的类并将其替换为您想要的任何内容。

对于 cookie，[PPK 有一些简单的方法来读取/写入/擦除 cookie](http://www.quirksmode.org/js/cookies.html)。

```
createCookie("mySiteCookie", "red", 7); // Set the cookie to expire in 7 days.
readCookie("mySiteCookie"); // Should yield "red" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T22:41:36.440

您还需要[removeClass](http://docs.jquery.com/Attributes/removeClass#class)。

# vb.net - Office 2007/2003 VSTO 共享加载项设计查询

> ID：804587
> 
> 赞同：1
> 
> 时间：2009-04-29T22:38:59.723
> 
> 标签：vb.net, ms-office, vsto, add-in

我正在使用 VB.Net 2008 和 VSTO 设计一个共享加载项，该加载项必须在任何 MS Office 应用程序启动时启动。它必须适用于 2002、2003 和 2007 应用程序。我已经设法组装了一个工作加载项，它会弹出一条测试消息，说明 Office 版本和应用程序名称，并在所有应用程序中进行了测试。

解决方案的下一部分是对需要运行以进行文档审核和公司保护标记的应用程序特定代码进行编码，例如；在 Excel 中检查所有加载项是否链接到网络加载项文件夹。

从现在开始，我的方法将是后期绑定应用程序对象，并将代码中存在的我的类型（例如 Excel）应用程序对象引用之一设置为该对象。

我对 VSTO 还是比较陌生，所以如果我做一些奇怪的事情，请告诉我！:)

塔。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T10:56:38.053

我已经完成了这个项目，并按照我使用后期 bindig 指定的方式完成了它。它适用于 XP 和 2007 的所有办公应用程序。:) 我觉得我是在向自己宣布这一点，因为我没有收到一个答案或评论。也许你应该把标题性感化一点。是的，也许我应该。

# java - Java 中初始化器与构造器的使用

> ID：804589
> 
> 赞同：106
> 
> 时间：2009-04-29T22:39:11.267
> 
> 标签：java, constructor, initializer, static-initializer, initialization-block

所以我最近一直在复习我的 Java 技能，并发现了一些我以前不知道的功能。静态和实例初始化器就是两种这样的技术。

我的问题是什么时候会使用初始化程序而不是在构造函数中包含代码？我想到了几个明显的可能性：

*   静态/实例初始化器可用于设置“最终”静态/实例变量的值，而构造函数不能

*   静态初始化器可用于设置类中任何静态变量的值，这应该比在每个构造函数的开头使用“if (someStaticVar == null) // do stuff”代码块更有效

这两种情况都假设设置这些变量所需的代码比简单的“var = value”更复杂，否则似乎没有任何理由使用初始化程序而不是在声明变量时简单地设置值。

然而，虽然这些并不是微不足道的收获（尤其是设置最终变量的能力），但似乎确实有相当有限的情况应该使用初始化程序。

一个人当然可以使用初始化器来完成构造函数中所做的很多事情，但我真的不明白这样做的原因。即使一个类的所有构造函数共享大量代码，对我来说，使用私有 initialize() 函数似乎比使用初始化器更有意义，因为它不会锁定你在编写新代码时运行该代码构造函数。

我错过了什么吗？是否还有许多其他情况需要使用初始化程序？或者它真的只是在非常特定的情况下使用的一个相当有限的工具？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-29T22:56:54.673

静态初始化器就像提到的 cletus 一样有用，我以相同的方式使用它们。如果您有一个要在加载类时初始化的静态变量，那么静态初始化程序就是要走的路，特别是因为它允许您进行复杂的初始化并且仍然拥有静态变量 be `final`。这是一个很大的胜利。

我发现“if (someStaticVar == null) // do stuff”很混乱且容易出错。如果它是静态初始化并声明`final`的，那么您就避免了它的可能性`null`。

但是，当您说：

> 静态/实例初始化器可用于设置“最终”静态/实例变量的值，而构造函数不能

我假设你说的是：

*   静态初始值设定项可用于设置“最终”静态变量的值，而构造函数不能
*   实例初始值设定项可用于设置“最终”实例变量的值，而构造函数不能

而且您在第一点上是正确的，在第二点上是错误的。例如，您可以这样做：

```
class MyClass {
    private final int counter;
    public MyClass(final int counter) {
        this.counter = counter;
    }
} 
```

此外，当构造函数之间共享大量代码时，处理此问题的最佳方法之一是链接构造函数，提供默认值。这很清楚正在做什么：

```
class MyClass {
    private final int counter;
    public MyClass() {
        this(0);
    }
    public MyClass(final int counter) {
        this.counter = counter;
    }
} 
```

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-04-29T22:55:48.450

匿名内部类不能有构造函数（因为它们是匿名的），所以它们非常适合实例初始化器。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-29T22:44:47.277

我最常使用静态初始化程序块来设置最终的静态数据，尤其是集合。例如：

```
public class Deck {
  private final static List<String> SUITS;

  static {
    List<String> list = new ArrayList<String>();
    list.add("Clubs");
    list.add("Spades");
    list.add("Hearts");
    list.add("Diamonds");
    SUITS = Collections.unmodifiableList(list);
  }

  ...
} 
```

现在这个例子可以用一行代码完成：

```
private final static List<String> SUITS =
  Collections.unmodifiableList(
    Arrays.asList("Clubs", "Spades", "Hearts", "Diamonds")
  ); 
```

但是静态版本可以更整洁，尤其是当项目初始化时。

幼稚的实现也可能不会创建不可修改的列表，这是一个潜在的错误。上面创建了一个不可变的数据结构，您可以愉快地从公共方法等返回。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-30T13:29:34.683

只是在这里添加一些已经很出色的观点。静态初始化器是线程安全的。它在类加载时执行，因此与使用构造函数相比，静态数据初始化更简单，在构造函数中，您需要一个同步块来检查静态数据是否已初始化，然后实际初始化它。

```
public class MyClass {

    static private Properties propTable;

    static
    {
        try 
        {
            propTable.load(new FileInputStream("/data/user.prop"));
        } 
        catch (Exception e) 
        {
            propTable.put("user", System.getProperty("user"));
            propTable.put("password", System.getProperty("password"));
        }
    } 
```

相对

```
public class MyClass 
{
    public MyClass()
    {
        synchronized (MyClass.class) 
        {
            if (propTable == null)
            {
                try 
                {
                    propTable.load(new FileInputStream("/data/user.prop"));
                } 
                catch (Exception e) 
                {
                    propTable.put("user", System.getProperty("user"));
                    propTable.put("password", System.getProperty("password"));
                }
            }
        }
    } 
```

不要忘记，您现在必须在类而不是实例级别进行同步。这会为每个构造的实例带来成本，而不是加载类时的一次性成本。另外，它很丑;-)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-01-30T01:35:59.173

我阅读了整篇文章来寻找初始化程序与其构造函数的初始化顺序的答案。我没有找到它，所以我写了一些代码来检查我的理解。我想我会添加这个小演示作为评论。为了测试您的理解，请在阅读底部之前查看您是否可以预测答案。

```
/**
 * Demonstrate order of initialization in Java.
 * @author Daniel S. Wilkerson
 */
public class CtorOrder {
  public static void main(String[] args) {
    B a = new B();
  }
}

class A {
  A() {
    System.out.println("A ctor");
  }
}

class B extends A {

  int x = initX();

  int initX() {
    System.out.println("B initX");
    return 1;
  }

  B() {
    super();
    System.out.println("B ctor");
  }

} 
```

输出：

```
java CtorOrder
A ctor
B initX
B ctor 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-29T23:31:01.203

静态初始化器相当于静态上下文中的构造器。你肯定会比实例初始化器更频繁地看到它。有时您需要运行代码来设置静态环境。

一般来说，实例初始化器最适合匿名内部类。查看[JMock 的说明书](http://www.jmock.org/expectations.html)，了解使用它使代码更具可读性的创新方法。

有时，如果你有一些在构造函数之间链接起来很复杂的逻辑（比如你是子类化并且你不能调用 this()，因为你需要调用 super()），你可以通过在实例中做常见的事情来避免重复初始化器。然而，实例初始化器是如此罕见，以至于它们对许多人来说是一种令人惊讶的语法，所以我避免使用它们，如果我需要构造函数行为，我宁愿让我的类具体而不是匿名。

JMock 是一个例外，因为这就是框架的用途。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2018-05-30T17:27:22.667

您在选择时必须考虑一个重要方面：

**初始化块是**类/对象的成员，而**构造函数不是**。这在考虑**扩展/子类化**时很重要：

1.  **初始化器**由子类继承。（虽然，可以被遮蔽）
    这意味着基本上可以保证子类按照父类的意图进行初始化。
2.  **但是，构造函数*不是*继承**的。（它们仅隐式调用[即无参数]，或者您必须手动`super()`进行特定调用。） 这意味着隐式或显式调用可能不会按照父类的预期初始化子类。`super(...)`
    `super(...)`

考虑这个初始化块的例子：

```
 class ParentWithInitializer {
        protected String aFieldToInitialize;

        {
            aFieldToInitialize = "init";
            System.out.println("initializing in initializer block of: " 
                + this.getClass().getSimpleName());
        }
    }

    class ChildOfParentWithInitializer extends ParentWithInitializer{
        public static void main(String... args){
            System.out.println(new ChildOfParentWithInitializer().aFieldToInitialize);
        }
    } 
```

输出：

```
initializing in initializer block of: ChildOfParentWithInitializer
init 
```

-> 无论子类实现什么构造函数，该字段都会被初始化。

现在考虑这个带有构造函数的例子：

```
 class ParentWithConstructor {
        protected String aFieldToInitialize;

        // different constructors initialize the value differently:
        ParentWithConstructor(){
            //init a null object
            aFieldToInitialize = null;
            System.out.println("Constructor of " 
                + this.getClass().getSimpleName() + " inits to null");
        }

        ParentWithConstructor(String... params) {
            //init all fields to intended values
            aFieldToInitialize = "intended init Value";
            System.out.println("initializing in parameterized constructor of:" 
                + this.getClass().getSimpleName());
        }
    }

    class ChildOfParentWithConstructor extends ParentWithConstructor{
        public static void main (String... args){
            System.out.println(new ChildOfParentWithConstructor().aFieldToInitialize);
        }
    } 
```

输出：

```
Constructor of ChildOfParentWithConstructor inits to null
null 
```

-> 这将`null`默认初始化字段，即使它可能不是您想要的结果。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-06-18T14:29:46.403

除了以上所有精彩的答案，我还想补充一点。当我们使用 Class.forName("") 在 JDBC 中加载驱动程序时，会发生类加载，驱动程序类的静态初始化程序被触发，其中的代码将驱动程序注册到驱动程序管理器。这是静态代码块的重要用途之一。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-29T22:44:22.487

正如您所提到的，它在很多情况下都没有用，并且与任何较少使用的语法一样，您可能希望避免它只是为了阻止下一个人查看您的代码花费 30 秒将其从保管库中拉出。

另一方面，这是做一些事情的唯一方法（我认为你几乎涵盖了这些）。

无论如何都应该避免静态变量本身——并非总是如此，但如果你使用了很多，或者你在一个类中使用了很多，你可能会找到不同的方法，你未来的自己会感谢你的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-24T13:41:23.723

请注意，执行一些副作用的静态初始化程序的一个大问题是它们不能在单元测试中被模拟。

我见过图书馆这样做，这是一个很大的痛苦。

所以最好只保留那些静态初始化器。

# git - Git：接收电子邮件后挂钩，包括差异补丁？

> ID：804601
> 
> 赞同：22
> 
> 时间：2009-04-29T22:42:45.080
> 
> 标签：git

经过一番谷歌搜索后，我发现了一个 Git 的接收后挂钩，我使用电子邮件将所有提交通过电子邮件发送到远程/共享存储库。

这个[post-receive 钩子](http://git.kernel.org/?p=git/git.git;a=blob_plain;f=contrib/hooks/post-receive-email;h=41368950d6b29121089ee9239b8e07ece209a31e)的问题在于它只能提供提交者、日志消息、日期、受影响的文件。我还想在电子邮件中查看受影响的文件生成的补丁，以了解对代码进行了哪些更改。Subversion 做得很好。

有没有人有可能传递给执行此操作的 post-receive 钩子的 env 变量的解决方案？或者更好的是，一个已经熟透的例子？

谢谢大家！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-30T13:18:40.810

最近的 Git 版本应该安装一个`post-receive-email`脚本。其中，它说：

> 钩子.showrev
> 
> 用于格式化电子邮件中每个修订版的 shell 命令，其中“%s”替换为提交 ID。默认为“git rev-list -1 --pretty %s”，显示提交 ID、作者、日期和日志消息。要列出以空行分隔的完整补丁，您可以将其设置为“git show -C %s; echo”。

所以只需设置`hooks.showrev`为“git show -C %s; 使用电子邮件挂钩在存储库中回显“，一切就绪。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-24T13:44:30.137

我在这里遇到了类似的问题：

[Git hook 发送关于 repo 更改的电子邮件通知](https://stackoverflow.com/questions/552360/git-push-email-notification/1728717#1728717)

实际上有不同版本的 post-receive-email 脚本——在 git.kernel.org 上可用的那个通知并尊重 hooks.showrev，而我没有的那个。

不过这个讨论很酷，谢谢，一定会看的！上面链接的另一个脚本也有 gitweb 链接功能和东西，你其他人怎么样？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T22:58:46.570

我已经有一段时间没有运行它了，但是（我相信）[我以前使用](http://gist.github.com/32058)的那个是在线的。我拿了过去随 git 一起发布的东西，并根据自己的喜好重新排列了它。我很久没有尝试运行类似的东西了。

我有一些它所做的截图：

*   [正常推送](http://skitch.com/dlsspy/7kx7/caring-git-email)（两次提交）
*   [标签创建](http://skitch.com/dlsspy/7ktr/caring-tag-email)（替换之前的标签）
*   [推送变基](http://skitch.com/dlsspy/7ktc/caring-pushed-rebase)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T23:01:13.150

请参阅本节。

```
echo ""
echo "Summary of changes:"
git diff-tree --stat --summary --find-copies-harder $oldrev..$newrev 
```

这里 git 被要求提供差异，但随后也被要求对其进行总结。删除 --stat 和 --summary 标志，您将看到差异。

```
git diff-tree --find-copies-harder $oldrev..$newrev 
```

这是显示所有修订的另一种方式，包括从 $oldrev 到 $newrev 的差异

```
git --no-pager log --find-copies-harder $oldrev..$newrev 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-07T03:56:56.213

尽管这个问题已经有了一个公认的答案，但我认为这是我遇到的更好的 post-receive 邮件挂钩之一：

[http://github.com/brasse/post_receive_email.py](http://github.com/brasse/post_receive_email.py)

通过作者的博客文章发现：

[http://copypasteprogrammer.blogspot.com/2010/03/git-post-receive-hook-in-python.html](http://copypasteprogrammer.blogspot.com/2010/03/git-post-receive-hook-in-python.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-27T21:31:35.317

如果您对颜色等感兴趣，这里还有另一个： [https ://github.com/nacho/email-hook](https://github.com/nacho/email-hook)

# xna - 可用的游戏网络协议定义语言和代码生成

> ID：804603
> 
> 赞同：11
> 
> 时间：2009-04-29T22:43:08.293
> 
> 标签：xna, network-protocols, real-time, protocol-buffers

我一直在寻找一个好的通用二进制网络协议定义框架，以提供一种以多种语言（例如 Java 后端服务器和 iPhone 前端）编写实时游戏服务器和客户端（想想魔兽世界或雷神之锤 III）的方法用 Objective-C 和 Cocoa 编写的客户端）。

我想支持 Windows 上的 Java Flash 客户端、iPhone 客户端和 C# 客户端（以及 XBOX 上的 XNA 客户端）。

我正在寻找一种通过 TCP/IP 或 UDP 套接字流连接有效发送/接收消息的方法。我不是在寻找可以通过 HTTP Web 服务发送的东西，比如 JSON 或 XML 编组对象。虽然 Hessian 的二进制 web 服务协议是一个非常有趣的解决方案

我想要一种网络协议格式和客户端/服务器基本实现，它允许客户端连接到服务器并在定义的协议中发送任何消息并在协议中接收任何消息，而无需绑定到某种 RPC 端点。我想要在我的协议传入和传出的任何消息的通用流。这样我就可以支持服务器每 100 毫秒向所有客户端发送游戏中各种实体的位置之类的东西。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-06T22:50:42.943

我发现的网络协议框架如下：

1.  [Google 的协议缓冲区](http://code.google.com/p/protobuf/)- 但它不支持从给定协议发送/接收任意消息之类的事情。
2.  [Apache Thrift](http://incubator.apache.org/thrift/) - 一个有趣的选项，但它主要面向 RPC 而不是通用游戏客户端/服务器套接字类型的连接，客户端或服务器可以随时发送消息，而不仅仅是响应客户端 RPC 请求。
3.  [Raknet Multiplayer](http://www.jenkinssoftware.com/) - Raknet 提供完整的多人网络库（独立开发免费，收入低于 25 万美元）

**更新**：OculusVR 现在收购了 RakNet 及其免费/开源。[你可以在Github](https://github.com/OculusVR/RakNet)上找到它

4.  [Hessian Binary Web Service Protocol](http://hessian.caucho.com/) - 是一种 HTTP Web 服务二进制协议，它非常适合发送二进制数据，无需使用附件扩展协议。

Raknet 提供了一个很好的面向游戏/模拟的多人游戏库。

Apache Thrift 和 Google 的协议缓冲区似乎是在游戏网络协议客户端/服务器架构中使用的最简单方法。

[如果您想使用某种类型的服务器推送技术（如COMET](http://alex.dojotoolkit.org/2006/03/comet-low-latency-data-for-the-browser/)）创建带有 Java 或 Flash 客户端的基于 Web 的游戏服务器，Hessian 似乎非常适合。Hessian 可能会提供一种非常有趣的方式来支持网络上的实时游戏，甚至能够将它们托管在虚拟机网络解决方案上，比如谷歌的 App 引擎或亚马逊的 EC2。

有一些关于将各种协议定义框架用于游戏和其他用途的讨论：

*   [各种序列化框架的比较](http://code.google.com/p/thrift-protobuf-compare/wiki/Benchmarking)
*   [Thrift vs Protocol Buffers](http://stuartsierra.com/2008/07/10/thrift-vs-protocol-buffers) - Thrift 被宣布为更好的框架，因为它具有完全支持的 RPC 客户端/服务器实现
*   [为客户端服务器游戏 API 使用协议缓冲区来确定要解码的消息类型](http://groups.google.com/group/protobuf/browse_thread/thread/c2b514f50554c910/6849f9539a030d3f?hl=en#6849f9539a030d3f)
*   [使用 Thrift 的双向 RPC](http://mail-archives.apache.org/mod_mbox/incubator-thrift-user/200904.mbox/%3Cfba570180904032145j32beb3darb18d276025b033fe@mail.gmail.com%3E)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-28T17:56:09.663

[DIS](http://en.wikipedia.org/wiki/Distributed_Interactive_Simulation)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-26T19:44:23.343

如果您确实走上了编写自己的协议的路线，您可能想阅读我在[此处](https://stackoverflow.com/questions/284885/multi-client-async-sockets-in-c-best-practices/285986#285986)发布的答案。

总之，它讨论了编写协议时应该考虑的内容，并列出了一些用于版本控制和保持向后和向前兼容性的技巧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T16:46:29.220

如果您真的很关心多平台和多语言，请务必考虑[字节序](http://en.wikipedia.org/wiki/Endianness)问题。为此目的设计的二进制协议必须使用网络字节顺序，因此它需要自定义每个数据类型的序列化函数；您不能只是盲目地将 C 结构推入网络缓冲区。

游戏公司针对这个问题的一个常见解决方案是使用 XML、python 或 lua 等简单格式的协议描述语言或规范，然后为每种目标语言生成代码，生成具有数据结构和序列化的数据包类。该规范可以使用从基本类型开始的类型系统，然后扩展到包含具有语义信息、枚举或更复杂结构的游戏特定类型。例如，数据文件可能如下所示：

```
Attack = {
  source = 'objectId',
  target = 'objectId',
  weapon = 'weapon::WEAP_MAIN',
  seed = 'int'
} 
```

这可以生成如下代码：

```
#define PT_ATTACK 10002

class PacketAttack : public Packet {
  public:
    PacketAttack () : m_packetType(PacketAttack::s_packetType) {}

    ObjectId m_source;
    ObjectId m_target;
    WeaponType m_weapon;
    int m_seed;

   bool Write(Stream* outStream) {
       Packet::Write(outStream);
       outStream << m_source;
       outStream << m_target;
       outStream << m_weapon
       outStream << m_seed;
   }

   bool Read(Stream* inStream);

 static const int s_packetType;
}; 
```

这确实需要更多的基础设施......流，数据包基类，安全序列化功能......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T23:03:11.007

我想回应比尔 K 的建议。推出自己的协议并不难。

对于 iPhone 端，看看[AsyncSocket](http://www.cocoadev.com/index.pl?AsyncSocket)，它支持内置的基于分隔符的 TCP 数据包，构建使用数据包标头的解决方案并不难。

如果您很快想在 iPhone 上拥有一个测试服务器来对抗 AsyncSocket，您可以查看[Naga](http://naga.googlecode.com)（用于 java 服务器部分），它已经为基于分隔符的数据包和带有标头的数据包做好了准备。Naga 在编写时部分考虑了网络游戏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T18:34:04.930

我不同意“用简单的分隔字符串方法滚动你”：问题是，究竟有什么好处？开始编写和维护更多代码？我能看到的唯一原因是缺乏工具支持（为一些奇怪的平台编写），或者特定（非常）硬性能或消息大小限制。或者，有时，真的想写一个格式——没关系，但它必须是一个明确的原因。

根据具体需要，我建议考虑 JSON，因为它可以读取和写入任意消息；具有良好的 Java 对象绑定器（就像 xml），比二进制格式更容易阅读，并且对于许多用例来说“足够好”。

如果消息大小非常重要，Protobuf 可以很好地工作——虽然它的大小并不总是像 gzipped 替代品（gzip+xml、gzip+json 压缩得很好）那么小，但它通常很接近。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T20:43:40.893

[ASN.1](http://en.wikipedia.org/wiki/ASN.1)符合“良好的通用二进制网络协议定义框架”的定义。它也是由 ITU-T 标准化的，因此有很多针对各种语言的现有工具和库。

DER 编码适用于高效的网络通信，XER 编码适用于人类可读（和可写）的永久存储。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-23T14:57:21.160

因为你想使用不同的语言，也因为你想要一些干净/小的东西，我建议谷歌的协议缓冲区。您需要 RPC 的预编译部分，但我真的认为这是您开始混合不同语言时的最佳选择。这是链接：[http ://code.google.com/apis/protocolbuffers/docs/overview.html](http://code.google.com/apis/protocolbuffers/docs/overview.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-26T19:38:36.490

为什么不直接实现UDP呢？您的问题主要提到了您不想要的内容。您希望在 UDP 之上进一步进行什么形式的抽象**？**下载 Quake III 源代码，看看他们如何通过 UDP 构建游戏更新？

IP 协议旨在以统一的方式支持多个设备/操作系统，这不正是您所要求的吗？什么协议在大量系统中实现，嗯，也许是 IP？

# java - 为什么对同一方法的两次连续调用会产生不同的执行时间？

> ID：804620
> 
> 赞同：2
> 
> 时间：2009-04-29T22:48:31.183
> 
> 标签：java, benchmarking, microbenchmark

这是一个示例代码：

```
public class TestIO{
public static void main(String[] str){
    TestIO t = new TestIO();
    t.fOne();
    t.fTwo();
    t.fOne();
    t.fTwo();
}

public void fOne(){
    long t1, t2;
    t1 = System.nanoTime();
    int i = 10;
    int j = 10;
    int k = j*i;
    System.out.println(k);
    t2 = System.nanoTime();
    System.out.println("Time taken by 'fOne' ... " + (t2-t1));
}

public void fTwo(){
    long t1, t2;
    t1 = System.nanoTime();
    int i = 10;
    int j = 10;
    int k = j*i;
    System.out.println(k);
    t2 = System.nanoTime();
    System.out.println("Time taken by 'fTwo' ... " + (t2-t1));
} 
```

}

这给出了以下输出： 100 'fOne' 花费的时间 ... 390273 100 'fTwo' 花费的时间 ... 118451 100 'fOne' 花费的时间 ... 53359 100 'fTwo' 花费的时间 ... 115936按任意键继续 。. .

为什么第一次执行相同的方法比连续调用需要更多的时间（明显更多）？

我尝试给`-XX:CompileThreshold=1000000`命令行，但没有区别。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T22:51:00.660

有几个原因。JIT（即时）编译器可能没有运行。JVM 可以在调用之间进行不同的优化。您正在测量经过的时间，因此您的机器上可能正在运行 Java 以外的其他东西。在随后的调用中，处理器和 RAM 缓存可能是“温暖的”。

您确实需要进行多次调用（数千次）才能获得准确的每个方法执行时间。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T23:19:28.800

[Andreas](https://stackoverflow.com/questions/804620/java-why-do-two-consecutive-calls-to-the-same-method-yield-different-times-for-e/804694#804694)提到的问题和 JIT 的不可预测性是正确的，但还有一个问题是**类加载器**：

第一次调用`fOne`与后者完全不同，因为这是第一次调用的原因`System.out.println`，这意味着当类加载器将从磁盘或文件系统缓存（通常是缓存）中打印所需的所有类时文本。把参数`-verbose:class`给JVM看看这个小程序实际加载了多少个类。

我在运行单元测试时注意到了类似的行为 - 调用大型框架的第一个测试需要更长的时间（如果 Guice 在 C2Q6600 上大约需要 250 毫秒），即使测试代码是相同的，因为第一次调用是在类加载器加载了数百个类。

由于您的示例程序很短，因此开销可能来自早期的 JIT 优化和类加载活动。垃圾收集器可能甚至在程序结束之前都不会启动。

* * *

**更新：**

现在我找到了一种可靠的方法来找出*真正*需要时间的东西。还没有人发现它，尽管它与类加载密切相关——它是**本地方法的动态链接**！

我按如下方式修改了代码，以便日志显示测试开始和结束的时间（通过查看这些空标记类的加载时间）。

```
 TestIO t = new TestIO();
    new TestMarker1();
    t.fOne();
    t.fTwo();
    t.fOne();
    t.fTwo();
    new TestMarker2(); 
```

运行程序的命令，带有显示实际情况的正确[JVM 参数：](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp)

```
java -verbose:class -verbose:jni -verbose:gc -XX:+PrintCompilation TestIO 
```

和输出：

```
* snip 493 lines *
[Loaded java.security.Principal from shared objects file]
[Loaded java.security.cert.Certificate from shared objects file]
[Dynamic-linking native method java.lang.ClassLoader.defineClass1 ... JNI]
[Loaded TestIO from file:/D:/DEVEL/Test/classes/]
  3       java.lang.String::indexOf (166 bytes)
[Loaded TestMarker1 from file:/D:/DEVEL/Test/classes/]
[Dynamic-linking native method java.io.FileOutputStream.writeBytes ... JNI]
100
Time taken by 'fOne' ... 155354
100
Time taken by 'fTwo' ... 23684
100
Time taken by 'fOne' ... 22672
100
Time taken by 'fTwo' ... 23954
[Loaded TestMarker2 from file:/D:/DEVEL/Test/classes/]
[Loaded java.util.AbstractList$Itr from shared objects file]
[Loaded java.util.IdentityHashMap$KeySet from shared objects file]
* snip 7 lines * 
```

时差的原因是这样的：`[Dynamic-linking native method java.io.FileOutputStream.writeBytes ... JNI]`

我们还可以看到，JIT 编译器不会影响这个基准。只有三个方法被编译（例如`java.lang.String::indexOf`上面的代码片段），它们都发生在`fOne`方法被调用之前。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-29T23:07:14.147

1.  测试的代码非常简单。采取的最昂贵的行动是

    ```
     System.out.println(k); 
    ```

    所以你要测量的是调试输出的写入速度。这变化很大，甚至可能取决于调试窗口在屏幕上的位置，是否需要滚动其大小等。

2.  JIT/Hotspot 以增量方式优化常用代码路径。

3.  处理器针对预期的代码路径进行优化。经常使用的路径执行得更快。

4.  你的样本量太小了。这样的微基准测试通常会做一个热身阶段，您可以看到这应该做多广泛，就像[Java 真的很快就什么都不](http://www.javaspecialists.eu/archive/Issue158.html)做一样。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-29T23:11:18.350

除了 JITting，其他因素可能是：

*   调用 System.out.println 时进程的输出流阻塞
*   您的进程被另一个进程调度
*   垃圾收集器在后台线程上做一些工作

如果你想获得好的基准，你应该

*   运行您要进行大量基准测试的代码，至少数千次，然后计算平均时间。
*   忽略前几次调用的次数（由于 JITting 等）
*   如果可以，请禁用 GC；如果您的代码生成大量对象，这可能不是一个选项。
*   从被基准测试的代码中取出日志记录（println 调用）。

有几个平台上的基准测试库可以帮助您完成这些工作；他们还可以计算标准偏差和其他统计数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T22:51:23.763

最可能的罪魁祸首是[JIT](http://www.java-tips.org/java-se-tips/java.lang/what-is-java-just-in-time-compiler.html)（即时）热点引擎。基本上，第一次执行代码时，机器代码会被 JVM “记住”，然后在以后的执行中重用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T22:52:17.210

我认为这是因为第二次生成的代码已经在第一次运行之后进行了优化。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T23:12:59.157

正如已经建议的那样，JIT 可能是罪魁祸首，但如果机器上的其他进程当时正在使用资源，则 I/O 等待时间和资源等待时间也可能是罪魁祸首。

这个故事的寓意是，microbenchmarking 是一个难题，尤其是对于 Java。我不知道您为什么要这样做，但是如果您要在解决问题的两种方法之间进行选择，请不要以这种方式衡量它们。使用策略设计模式并使用两种不同的方法运行整个程序并测量整个系统。从长远来看，这在处理时间上几乎没有什么影响，并且让您可以更真实地了解当时整个应用程序的性能有多少瓶颈（提示：它可能比您想象的要少。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-30T07:37:20.567

那么最可能的答案是初始化。JIT 肯定不是正确的答案，因为它需要更多的周期才能开始优化。但在第一次可能有：

*   查找类（已缓存，因此无需第二次查找）
*   加载类（一旦加载就留在内存中）
*   从本机库获取附加代码（本机代码被缓存）
*   最后它加载要在 CPU 的 L1 缓存中执行的代码。在您的意义上，这是加速的最可能的案例，同时也是基准（作为微基准）没有说太多的原因。如果您的代码足够小，则循环的第二次调用可以完全从 CPU 内部运行，这非常快。在现实世界中，这不会发生，因为程序更大，而 L1 缓存的重用远没有那么大。

# ruby-on-rails - 我应该将 SQL 查询放在 Rails 的什么位置？

> ID：804622
> 
> 赞同：5
> 
> 时间：2009-04-29T22:49:42.443
> 
> 标签：ruby-on-rails

我应该在 Rails 中的何处放置 SQL 查询的最佳实践是什么？

*   我是否应该在模型中创建方法，例如： find_all_public_items 我在所有条件下使用 find 方法，然后在控制器中使用它们。就像我将所有查询放在一个地方一样，但我错过了每个查询都应该完全适合需求的灵活性。

*   我是否应该只在控制器中使用 find/find_by_sql - 像这样我没有创建数千种方法，但我正在失去对控制器如何从数据库中吸取数据的控制。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T22:54:26.207

将与模型相关的所有内容都放在模型中。时期。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T12:57:55.180

你应该把它们放在你的模型中。您可能还想调查[命名范围](http://railscasts.com/episodes/108-named-scope)。

# django - 通知客户有关过期会话 - 网络编程

> ID：804624
> 
> 赞同：1
> 
> 时间：2009-04-29T22:50:30.880
> 
> 标签：django, web-applications, session, browser, client-server

是否可以通知用户会话已过期？浏览器可以充当服务器并接收此类通知吗？

一种解决方案是生成在客户端进行倒计时并最终通知客户端的 JavaScript，但我是否可以通过第一种方式进行发布？

第一种方法的后果是什么？有任何安全问题吗？

例如，django 中的可行实现是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T23:00:36.567

您可以让 JavaScript 定期轮询服务器以获取通知（例如每 30 秒），`XMLHTTPRequest`用于检查 URL。如果会话超时，服务器可以在那个 URL 上放一些东西来表明它，然后会弹出一个通知。如果您正在撰写答案，这就是 Stackoverflow 实现其他人已经回答问题的通知的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T22:59:13.217

您可能希望查看[comet](http://en.wikipedia.org/wiki/Comet_(programming))，尽管我认为 javascript 计时器将是一个更好的解决方案，它不太可能中断，并且更容易实现。

我想不出任何安全隐患，因为您只是提供过期通知，实际上并未在该步骤中进行任何身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:59:54.353

你正在寻找某种[彗星](http://en.wikipedia.org/wiki/Comet_(programming))类型的东西。您可以做的最简单的“服务器推送”可能是轮询服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T07:49:32.503

事实上，在 Django 中，如果您使用文件系统或数据库引擎，则没有服务器端过期 => 是您的客户端 cookie 会话 ID 过期。否则，如果您使用基于缓存的会话，则可以将缓存过期设置为大于会话 cookie 过期的值。

然后，只需声明一个没有过期的 cookie 以在登录时标记客户端浏览器，并在每个页面中检查会话 id：如果没有会话 id cookie 但您的“cookie 标记”，则会话已过期。无需检查服务器。

# database - 用于基于 Web 的应用程序的快速应用程序开发工具

> ID：804628
> 
> 赞同：2
> 
> 时间：2009-04-29T22:51:01.143
> 
> 标签：database, rad, web-based

我想推荐一种易于学习的工具或编程语言来开发基于 Web 的应用程序。

它应该提供快速应用程序开发（RAD），跨平台并能够连接到各种数据库。

一个例子可以是 Ruby、TurboGears 等。最好是开源的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-11-30T23:29:14.560

我会说我遇到的最容易学习和最强大的 RAD 之一是 WaveMaker ...

看看[www.wavemaker.com](http://www.wavemaker.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T23:06:45.397

Ruby on Rails 是开源的，非常容易学习，可与大量数据库一起使用，并且从头开始设计，让您可以快速构建 Web 应用程序：

[http://rubyonrails.org/](http://rubyonrails.org/)

Ruby 是语言，Rails 是框架。这种组合非常RAD。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T22:28:11.363

RAD 但不是开源的 :(

[莫菲克](http://www.morfik.com/)

[德尔福 PHP](http://www.embarcadero.com/products/delphi_for_php/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T23:06:50.530

有点相关：

*   [Ruby 或 C# 作为第一个 Web 开发语言](https://stackoverflow.com/questions/694238/ruby-or-c-as-first-web-development-language)；
*   [哪种 Web 开发语言最适合 C 程序员？](https://stackoverflow.com/questions/723925/which-web-development-language-is-best-for-a-c-programmer)

你的问题有点太笼统了。基本上有很多面向 Web 的平台，包括 PHP、Python/Django、Ruby 甚至 Java 或 C#/ASP.NET。每一个都有特别的优点或理由，在某些情况下你可能会选择一个而不是其他的。

就我个人而言，我推荐 PHP 具有极低的进入门槛、托管成本低、易于运行（只需在 Windows 上安装 XAMPP 之类的东西就可以了）并且非常灵活。但其他平台也可以很好地工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T23:10:09.773

您可以使用 Mono（.NET 开发平台的开源 *nix 版本；您知道，Unix、Linux 等）。语言：C#（非常类似于 Java）。有一个 IDE：MonoDevelop。

[ [http://www.mono-project.com][1]](http://www.mono-project.com][1])

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-08T09:50:27.480

3 年的 PHP，但我希望我改为学习 RubyOnRails。90% 的编程是关于数据验证和数据库访问的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-06-30T14:56:31.740

[试试 Vaadin 它是一个基于 java 的 Web APP 开发框架](https://vaadin.com/demo)

如果您了解 Java，那么对于基于 Web 的应用程序开发来说，最好的可能是 Vaadin

# .net - Microsoft 同步框架与 WCF

> ID：804636
> 
> 赞同：4
> 
> 时间：2009-04-29T22:53:23.557
> 
> 标签：.net, wcf, compact-framework, microsoft-sync-framework

我可以选择为我的下一个项目使用 WCF 或 Microsoft Sync Framework。这将是一个需要同步到移动 (.net cf) 前端的 SQL Server 后端。

我有几个问题，1.两个数据库之间的数据库模式将不一样。
2\. 在服务器端，我实际上需要调用 .net dll 来进行更新 3\. 我们希望对服务器数据库进行最小的更改。它已经在生产中，我们不想把它搞砸。

我知道我可以在两个端点之间执行与 WCF 的同步，但是同步框架真的会在这里给我买任何东西吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T00:17:45.413

您是否允许在移动设备和服务器上进行更改？如果是这样，如果移动设备上的用户 A 和服务器上的用户 B 更改了相同的数据记录，您将如何处理冲突？

同步框架和 WCF 的最大区别在于，同步框架是为检测此类冲突而构建的，并提供了处理它们的例程，而 WCF 没有。

话虽如此，您声明“在服务器端，我实际上需要调用 .net dll 来进行更新”。如果您所说的是这必须是您的公司已经拥有或正在开发的特定 DLL，那么这似乎排除了允许同步框架直接更新 SQL Server 的可能性。当您使用同步框架时，它直接与服务器和移动设备上的数据库进行通信。

# google-app-engine - 使用 Google App Engine SDK 在 Windows 上本地运行的 Jaikuengine

> ID：804638
> 
> 赞同：1
> 
> 时间：2009-04-29T22:54:01.043
> 
> 标签：google-app-engine

有没有人使用 Google App Engine SDK 和最新的 jaikuengine SVN 代码成功地让 jaikuengine 实例在 Windows 上本地运行？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T07:47:42.793

刚刚启动并运行 - 轻而易举...

Python 2.54，最新的 svn，GAE SDK 和 docutils.. 就是这样..

//哑光

# asp.net - System.FormatException：指定的字符串不是电子邮件地址所需的格式

> ID：804642
> 
> 赞同：1
> 
> 时间：2009-04-29T22:55:29.217
> 
> 标签：asp.net, xml, vb.net, formatexception

net 和 xml 我正在制作一个发送电子邮件的表单，但它给了我一个错误

> 电子邮件地址来自 xml 文件

```
 The specified string is not in the form required for an e-mail address.
Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: System.FormatException: The specified string is not in the form required for an e-mail address.

Source Error:

Line 82:             client.Host = "mail.host"
Line 83:             client.Port = 25
Line 84:             client.Send("from", txtTo.Text, txtSubject.Text, txtMessage.Text)
Line 85:             
Line 86:             lblMsg2.Text = "Email has been successfully sent"

Stack Trace:

[FormatException: The specified string is not in the form required for an e-mail address.]
   System.Net.Mime.MailBnfHelper.ReadMailAddress(String data, Int32& offset, String& displayName) +934335
   System.Net.Mail.MailAddress.ParseValue(String address) +245
   System.Net.Mail.MailAddress..ctor(String address, String displayName, Encoding displayNameEncoding) +87
   System.Net.Mail.Message..ctor(String from, String to) +127
   System.Net.Mail.MailMessage..ctor(String from, String to) +117
   System.Net.Mail.SmtpClient.Send(String from, String recipients, String subject, String body) +31
   ASP.adminpanel_admincontact_aspx.btnSend_Click(Object s, EventArgs e) in C:\Users\Farnu\Desktop\xmlproject\adminpanel\AdminContact.aspx:84
   System.Web.UI.WebControls.Button.OnClick(EventArgs e) +105
   System.Web.UI.WebControls.Button.RaisePostBackEvent(String eventArgument) +107
   System.Web.UI.WebControls.Button.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument) +7
   System.Web.UI.Page.RaisePostBackEvent(IPostBackEventHandler sourceControl, String eventArgument) +11
   System.Web.UI.Page.RaisePostBackEvent(NameValueCollection postData) +33
   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1746 
```

AdminContact.aspx

```
<%@ Page Language="VB" MasterPageFile="ContentMasterPage.master" Debug="true"%>  
<%@ Import Namespace="System.Data" %>
<%@ Import Namespace="System.Xml" %>
<%@ Import Namespace="System.Net.Mail" %>

<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" Runat="Server">
<script runat="server">
    Sub Page_Load()
        If Not IsPostBack Then
            BindEmailList()
            pnlWriteEmail.Visible = False
        End If
        Dim Item As ListItem

        If chkSelectAll.Checked Then
            For Each Item In chklGuests.Items
                Item.Selected = True
            Next
        End If
    End Sub

    Sub BindEmailList()
        Dim dsGuestbookData As DataSet = New DataSet()
        Dim xmlDataDoc As XmlDataDocument
        Dim alGuest As ArrayList = New ArrayList()

        dsGuestbookData.ReadXml(Server.MapPath("../App_Data/Contact.xml"))
        xmlDataDoc = New XmlDataDocument(dsGuestbookData)

        Dim xnlGuests As XmlNodeList
        Dim xnGuest As XmlNode

        Dim xnlGuests1 As XmlNodeList
        Dim xnGuest1 As XmlNode

        xnlGuests = xmlDataDoc.GetElementsByTagName("contactmessage")
        xnlGuests1 = xmlDataDoc.GetElementsByTagName("contactmessage")

        For Each xnGuest In xnlGuests
            chklGuests.Items.Add(New ListItem(xnGuest.ChildNodes.Item(0).InnerXml))
            'lblGuests.Items.Add(New ListItem("<b>" & xnGuest.ChildNodes.Item(0).InnerXml & "</b><br/><b>" & "Msg:</b>" & xnGuest.ChildNodes.Item(1).InnerXml & "<br/><b>" & "Subject:</b>" & xnGuest.ChildNodes.Item(2).InnerXml & "<br/><br/>"))

            'lblGuests.Items.Add(New ListItem("<b>" & xnGuest.ChildNodes.Item(0).InnerXml & "</b><br/><b>" & "Msg:</b>" & xnGuest.ChildNodes.Item(1).InnerXml & "<br/><b>" & "Subject:</b>" & xnGuest.ChildNodes.Item(2).InnerXml & "<br/><br/>"))
        Next
    End Sub

    Sub btnNext_Click(ByVal s As Object, ByVal e As EventArgs)
        Dim item As ListItem
        Dim isSelected As Boolean = False

        For Each item In chklGuests.Items
            If item.Selected Then
                isSelected = True
                Exit For
            End If
        Next
        If isSelected Then
            lblMsg.Visible = False
            pnlSelectEmail.Visible = False
            pnlWriteEmail.Visible = True

            Dim strTo As String = ""

            For Each item In chklGuests.Items
                If item.Selected Then
                    strTo &= item.Value & ","
                End If
            Next

            strTo = Left(strTo, Len(strTo) - 1)
            txtTo.Text = strTo
        Else
            lblMsg.Visible = True
            lblMsg.Text = "Please select person(s)"
        End If
    End Sub

    Sub btnSend_Click(ByVal s As Object, ByVal e As EventArgs)
        If IsValid Then
            Dim client As New SmtpClient()
            client.Host = "mail.host"
            client.Port = 25
            client.Send(txtTo.Text, txtSubject.Text, txtMessage.Text, "Company Name")

            lblMsg2.Text = "Email has been successfully sent"
            pnlEmailForm.Visible = False
        End If
    End Sub

</script>

<html>
<head><title>Contact</title></head>
<div id="content">
    <div class="about">
<body>
    <p>Contact messages</p>
    <p>List of all the users that contacted us</p>
    <p>Select user to send email, and then click the 'Next' button.</p>
    <br />
    <%--<asp:HyperLink ID="hlAdmin" Text="Go back to admin home" NavigateUrl="admindefault.aspx" runat="server"/>
    <br /><br />--%>
    <asp:Label ID="lblMsg" runat="server" />

<%--    <form runat="server">--%>
        <asp:Panel ID="pnlSelectEmail" runat="server">
            <asp:CheckBox ID="chkSelectAll" AutoPostBack="true" Text="Select All" runat="server" />
            <div style="margin-left:-3px;">
                <asp:CheckBoxList ID="chklGuests" runat="server" />
                <asp:CheckBoxList ID="lblGuests" runat="server" />
            </div>
            <p>
                <asp:Button ID="btnNext" type="Submit" OnClick="btnNext_Click" Text="Next" runat="server" />
            </p>
        </asp:Panel>

        <asp:Panel ID="pnlWriteEmail" runat="server">
        <br />
        <asp:HyperLink ID="hlSelectEmail" Text="Go back to select email list" NavigateUrl="AdminContact.aspx" runat="server" />
        <br /><br /><br />

        <asp:Label ID="lblMsg2" runat="server" />

        <asp:Panel ID="pnlEmailForm" runat="server">
            <table cellpadding="3px" cellspacing="0px" border="0px">
                <tr>
                    <td>To</td>
                    <td><asp:TextBox ID="txtTo" Text="" Columns="50" runat="server" /></td>
                </tr>
                <tr>
                    <td>Subject</td>
                    <td><asp:TextBox ID="txtSubject" Columns="50" runat="server" /></td>
                </tr>
                <tr>
                    <td>Message</td>
                    <td><asp:TextBox ID="txtMessage" TextMode="MultiLine" Columns="50" Rows="7" runat="server" /></td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;</td>
                    <td>
                        <p>
                            <asp:Button ID="btnSend" type="submit" OnClick="btnSend_Click" Text="Send" runat="server" />
                        </p>
                    </td>
                </tr>
            </table>
        </asp:Panel>

        </asp:Panel>

<%--    </form>
--%>    

</body>

</html>

   </div>
        <img src="../App_Themes/theme/html/images/phone.jpg" alt="" width="953" height="87" /><br />
    </div>
</asp:Content> 
```

联系人.xml

```
<?xml version="1.0" encoding="utf-8"?>
<contactmessages>
  <contactmessage>
    <useremail>username@yahoo.com</useremail>
    <subject>hello</subject>
    <message>Good Job!</message>
    <date>4/13/2009 8:03:25 PM</date>
  </contactmessage> 
 <contactmessage>
    <useremail>user@yahoo.com</useremail>
    <subject>hello</subject>
    <message>Good Job!</message>
    <date>4/13/2009 8:03:25 PM</date>
  </contactmessage>
<contactmessages> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T23:00:38.813

您对发件人地址的论点不是有效的电子邮件地址。

```
client.Send("from", 
```

From 应该是一个有效的电子邮件地址。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T23:01:04.320

在 `Sub btnSend_Click`（第 84 行附近）：

```
client.Send("from", txtTo.Text, txtSubject.Text, txtMessage.Text) 
```

应该是格式正确的`"from"`电子邮件地址。

# windows - 如何从 Windows 批处理文件中的 ECHO 字符串中去除引号？

> ID：804646
> 
> 赞同：46
> 
> 时间：2009-04-29T22:56:41.427
> 
> 标签：windows, batch-file, sed, quotes, echo

我有一个正在创建的 Windows 批处理文件，但我必须 ECHO 一个大的复杂字符串，所以我必须在两端加上双引号。问题是引号也被回显到我正在写入的文件中。你如何回显这样的字符串并去掉引号？

**更新：**

在过去的两天里，我一直在努力解决这个问题，终于能够将一些东西拼凑在一起。理查德的回答去掉了引号，但即使我把 ECHO 放在子程序中并直接输出字符串，Windows 仍然挂断在字符串中的字符上。我会接受理查德的回答，因为它回答了所提出的问题。

我最终使用了 Greg 的 sed 解决方案，但由于 sed/windows 错误/功能而不得不对其进行修改（它没有提供文档并没有帮助）。在 Windows 中使用 sed 有一些注意事项：你必须使用双引号而不是单引号，你不能直接转义字符串中的双引号，你必须结束引用字符串，使用 ^ (so ^" ) 然后 beqin 引用下一节。此外，有人指出，如果您将输入通过管道传输到 sed，则字符串中存在管道错误（我没有得到验证，因为在我的最终解决方案中，我刚刚发现一种不在字符串中间包含所有引号的方法，并且只是删除了所有引号，**我永远无法自行删除 endquote。**）感谢所有帮助。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-04-29T23:36:25.967

call 命令内置了这个功能。引用 call 的帮助：

```
 Substitution of batch parameters (%n) has been enhanced.  You can
 now use the following optional syntax:

 %~1         - expands %1 removing any surrounding quotes (") 
```

这是一个原始示例：

```
@echo off
setlocal
set mystring="this is some quoted text"
echo mystring=%mystring%
call :dequote %mystring%
echo ret=%ret%
endlocal
goto :eof

:dequote
setlocal
rem The tilde in the next line is the really important bit.
set thestring=%~1
endlocal&set ret=%thestring%
goto :eof 
```

输出：

```
C:\>dequote
mystring="this is some quoted text"
ret=this is some quoted text 
```

我应该将 '环境变量隧道' 技术 (endlocal&set ret=%thestring%) 归功于 Tim Hill, ['Windows NT Shell Scripting'](https://rads.stackoverflow.com/amzn/click/com/1578700477)。这是我发现的唯一一本深入探讨批处理文件的书。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2016-12-22T01:22:22.187

以下方法可用于打印不带引号的字符串：

```
echo|set /p="<h1>Hello</h1>" 
```

将此字符串推送到文件中：

```
echo|set /p="<h1>Hello</h1>" > test.txt 
```

将此字符串推入文件并附加 CR/LF：

```
echo|(set /p="<h1>Hello</h1>" & echo.) > test.txt` 
```

去检查：

```
type test.txt 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-09-06T11:21:51.907

您可以使用`%var:x=y%`将 all 替换`x`为的结构`y`。

请参阅此示例它可以做什么：

```
set I="Text in quotes"
rem next line replaces " with blanks
set J=%I:"=%
echo original %I%
rem next line replaces the string 'in' with the string 'without' 
echo stripped %J:in=without% 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-04-25T13:27:53.000

要从集合变量中删除所有引号，您需要延迟变量扩展来安全地扩展变量并对其进行处理。使用百分号（即`%VAR%`和`%1`）的扩展本质上是不安全的（它们容易受到命令注入的影响；[请阅读此处了解详细信息](http://www.robvanderwoude.com/battech_inputvalidation_setp.php)）。

```
SETLOCAL EnableDelayedExpansion
SET VAR=A ^"quoted^" text.
REM This strips all quotes from VAR:
ECHO !VAR:^"=!
REM Really that's it. 
```

要从文本文件或命令输出中去除引号，事情会变得复杂，因为使用延迟扩展，`!VAR!`文本文档中的字符串会在不应该被扩展时（在`%%i`扩展中`FOR /F`）。（这是另一个漏洞——信息泄露——在其他地方没有记录。）

为了安全地解析文档，需要在启用延迟扩展和禁用环境之间进行切换。

```
REM Suppose we fetch the text from text.txt

SETLOCAL DisableDelayedExpansion
REM The FOR options here employs a trick to disable both "delims"
REM characters (i.e. field separators) and "eol" character (i.e. comment
REM character).
FOR /F delims^=^ eol^= %%L IN (text.txt) DO (

    REM This expansion is safe because cmd.exe expands %%L after quotes
    REM parsing as long as DelayedExpansion is Disabled. Even when %%L
    REM can contain quotes, carets and exclamation marks.
    SET "line=%%L"

    CALL :strip_quotes
    REM Print out the result. (We can't use !line! here without delayed
    REM expansion, so do so in a subroutine.)
    CALL :print_line
)
ENDLOCAL
GOTO :EOF

REM Reads !line! variable and strips quotes from it.
:strip_quotes
    SETLOCAL EnableDelayedExpansion
    SET line=!line:^"=!

    REM Make the variable out of SETLOCAL
    REM I'm expecting you know how this works:
    REM (You may use ampersand instead:
    REM `ENDLOCAL & SET "line=%line%"`
    REM I just present another way that works.)
    (
    ENDLOCAL
    SET "line=%line%"
    )
GOTO :EOF

:print_line
    SETLOCAL EnableDelayedExpansion
    ECHO !line!
    ENDLOCAL
GOTO :EOF 
```

上面的`delims^=^ eol^=`代码可能需要解释一下：这有效地禁用了“delims”字符（即字段分隔符）和“eol”字符（即注释字符）。没有它，“delims”将默认为制表符和空格，“eol”默认为分号。

*   `eol=`令牌总是读取等号之后的下一个字符。要禁用它，此标记必须位于选项字符串的末尾，这样“eol”就不能使用任何字符，从而有效地禁用它。如果选项字符串被引用，它可能使用引号（“）作为“eol”，所以我们不能引用选项字符串。
*   该`delims=`选项不是选项字符串中的最后一个选项时，将被一个空间终止。（要在“delims”中包含空格，它必须是选项的最后一个`FOR /F`选项。）因此`delims=`后跟一个空格，然后另一个选项禁用“delims”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T23:17:08.103

这将`"C:\Program Files\somefile.txt"`变成`C:\Program Files\somefile.txt` 同时仍然保留诸如`Height=5'6"`和`Symbols="!@#`

```
:DeQuote

SET _DeQuoteVar=%1
CALL SET _DeQuoteString=%%!_DeQuoteVar!%%
IF [!_DeQuoteString:~0^,1!]==[^"] (
IF [!_DeQuoteString:~-1!]==[^"] (
SET _DeQuoteString=!_DeQuoteString:~1,-1!
) ELSE (GOTO :EOF)
) ELSE (GOTO :EOF)
SET !_DeQuoteVar!=!_DeQuoteString!
SET _DeQuoteVar=
SET _DeQuoteString=
GOTO :EOF 
```

例子

```
SetLocal EnableDelayedExpansion
set _MyVariable = "C:\Program Files\ss64\"
CALL :dequote _MyVariable
echo %_MyVariable% 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-29T23:33:48.420

上面的答案（以 :DeQuote 开头）假设延迟的环境变量扩展设置为打开。从 cmd /?:

默认情况下不启用延迟环境变量扩展。您可以使用 /V:ON 或 /V:OFF 开关为 CMD.EXE 的特定调用启用或禁用延迟的环境变量扩展。您可以通过使用 REGEDT32.EXE 在注册表中设置以下任一或两个 REG_DWORD 值来启用或禁用计算机和/或用户登录会话上对 CMD.EXE 的所有调用的完成：

```
HKEY_LOCAL_MACHINE\Software\Microsoft\Command Processor\DelayedExpansion

    and/or

HKEY_CURRENT_USER\Software\Microsoft\Command Processor\DelayedExpansion 
```

到 0x1 或 0x0。用户特定设置优先于机器设置。命令行开关优先于注册表设置。

如果启用了延迟环境变量扩展，则感叹号可用于在执行时替换环境变量的值。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-04-22T15:44:25.760

以下批处理文件启动一系列程序，每个程序都有延迟。

问题是为每个程序传递带有参数的命令行。这需要在程序参数周围加上引号，在调用时将其删除。这说明了批处理文件处理中的一些技术。

查看本地子例程 :mystart 以了解如何传入引号中的参数，并删除引号。

```
@echo off

rem http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/if.mspx?mfr=true

rem Start programs with delay

rem  Wait n seconds
rem  n number retries to communicate with the IP address
rem  1000 milliseconds between the retries
rem  127.0.0.1 is the LocalHost
rem  start /b (silent)  /min (minimized) /belownormal (lower priority)
rem  /normal provides a no-op switch to hold the place of argument 1

rem  start  /normal "Opinions"  %SystemRoot%\explorer.exe /e,d:\agar\jobs\opinion
rem  ping 127.0.0.1 -n 8 -w 1000 > nul

rem   Remove quotes in Batch
rem     http://ss64.com/nt/syntax-dequote.html
rem   String manipulation in Batch
rem     http://www.dostips.com/DtTipsStringManipulation.php
rem   ^ line continuation
rem   
rem   set p="One Two"      p has the exact value  "One Two" including the quotes           
rem   set p=%p:~1,-1%      Removes the first and last characters
rem   set p=%p:"=%         Removes all double-quotes
rem   set p=%p:cat=mouse%  Replaces cat with mouse

rem  ping 127.0.0.1 -n 12 -w 1000 > nul
rem        1       2            3                                                         4

@echo on
call :mystart /b/min  "Opinions"   "%SystemRoot%\explorer.exe  /e,d:\agar\jobs\opinion"   8  
@echo on
call :mystart /b/min  "Notepad++"  D:\Prog_D\Notepad++\notepad++.exe  14
@echo on
call :mystart /normal "Firefox"    D:\Prog_D\Firefox\firefox.exe      20
@rem call :mystart /b/min "ProcessExplorer"  D:\Prog_D\AntiVirus\SysInternals\procexp.exe  8
@echo on
call :mystart /b/min/belownormal "Outlook" D:\Prog_D\MSOffice\OFFICE11\outlook.exe  2
@echo off
goto:eof

:mystart
@echo off
 rem  %3 is "program-path  arguments" with the quotes. We remove the quotes
 rem  %4 is seconds to wait after starting that program
 set p=%3
 set p=%p:"=%
 start  %1  %2  %p% 
 ping 127.0.0.1 -n %4 -w 1000 > nul
 goto:eof 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-03-16T23:21:06.993

使用 FOR 命令去除周围的引号是我发现的最有效的方法。在紧凑形式（示例 2）中，它是单行的。

示例 1：5 行（已注释）解决方案。

```
REM Set your string
SET STR=" <output file>    (Optional) If specified this is the name of your edited file"

REM Echo your string into the FOR loop
FOR /F "usebackq tokens=*" %%A IN (`ECHO %STR%`) DO (
    REM Use the "~" syntax modifier to strip the surrounding quotation marks
    ECHO %%~A
) 
```

示例 2：1 线现实世界示例。

```
SET STR=" <output file>    (Optional) If specified this is the name of your edited file"

FOR /F "usebackq tokens=*" %%A IN (`ECHO %STR%`) DO @ECHO %%~A 
```

我发现有趣的是，内部回声忽略了重定向字符“<”和“>”。
如果您执行`ECHO asdfsd>asdfasd`，您将写入文件而不是标准输出。

希望这可以帮助 ：）

**编辑：**

我想了想，意识到有一种更简单（而且不那么老套）的方式来完成同样的事情。像这样使用增强的变量替换/扩展（参见 参考资料`HELP SET`）：

```
SET STR=" <output file>    (Optional) If specified this is the name of your edited file"

ECHO %STR:~1,-1% 
```

这将打印除第一个和最后一个字符（您的引号）之外的所有字符。我也建议使用`SETLOCAL ENABLEDELAYEDEXPANSION`。如果您需要找出引号在字符串中的位置，您可以使用 FINDSTR 来获取字符 #s。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-05-29T08:51:01.740

我知道它实际上并不适合作者，但如果您需要将一些文本发送到不带引号的文件 - 下面的解决方案对我有用。您不需要在 echo 命令中使用引号，只需将完整的命令用方括号括起来即可。

```
(
    echo first very long line
    echo second very long line with %lots% %of% %values%
) >"%filename%" 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-04-20T21:56:21.290

这对我有用：

```
SET "SOMETHING=Complex (String) (of stuff!)"
echo !SOMETHING! >> file.txt 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-10-23T20:12:24.090

Daniel Budzyński 的反应非常出色。它甚至在输出中有特殊字符的情况下也有效。例如：

```
C:\> for /f "usebackq tokens=2 delims=:" %i in (`%comspec%\..\ping -n 1 -w 200 10.200.1.1 ^| \
     findstr /c:"TTL="`) do echo|set /p="%i"

bytes=32 time<1ms TTL=255 
```

如果您尝试尝试不带引号的简单回显，由于变量中的“<”，您会收到错误：

```
C:\> set "output=bytes=32 time<1ms TTL=255"
C:\> echo %output%
The system cannot find the file specified.

C:\> echo|set /p="%output%"
bytes=32 time<1ms TTL=255 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-29T23:02:52.613

蛮力法：

```
echo "foo <3 bar" | sed -e 's/\(^"\|"$\)//g' 
```

当然，这需要找到合适的 Win32 版本`sed`。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-29T23:11:41.547

[http://unxutils.sourceforge.net/](http://unxutils.sourceforge.net/)是一堆 GNU 实用程序的原生 win32 端口，包括 sed、gawk、grep 和 wget。（对不起，我没有足够的代表发表评论！）

# maven-2 - 如何为 IntelliJ 中的运行配置分配键盘快捷键？

> ID：804650
> 
> 赞同：6
> 
> 时间：2009-04-29T22:58:42.950
> 
> 标签：maven-2, intellij-idea

似乎您可以为几乎所有其他内容分配键盘快捷键，但我看不到为运行/调试配置执行此操作的选项？

“运行配置”列在 IntelliJ 工具栏的下拉列表中。我想设置一个运行配置，可以顺序执行两个 maven 任务（如果您有兴趣，可以使用 jetty:stop 和 jetty:run），并为此操作分配键盘快捷键。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-08T22:15:00.240

最后！JetBrains 已在 IntelliJ IDEA v9中[实现了此功能。](http://blogs.jetbrains.com/idea/2009/10/invoking-rundebug-actions-in-intellij-idea-9/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:03:45.617

无论如何，在 Idea 8 中，您可以指定任何文件菜单项的快捷方式——甚至是 Maven 目标。尝试设置- Keymap 并寻找 Maven 目标。您可能仍然需要两把钥匙。每个动作一个。

# java - 在 SWT 项目中嵌入 SVG 画布的示例代码？

> ID：804660
> 
> 赞同：7
> 
> 时间：2009-04-29T22:59:54.370
> 
> 标签：java, swt, svg

有没有一个很好的例子来说明如何将 SVG 画布包含到 Java SWT 项目中（特别是[Holongate](http://www.holongate.org/contents.html)，尽管我会对任何其他选项感兴趣）？此外，我需要在 Mac OS X、Windows 和 Linux 客户端上支持这个 SVG 画布，以防实现依赖于本机库。感谢您的任何指示。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-04T17:18:18.733

使用蜡染 ( [http://xmlgraphics.apache.org/batik/](http://xmlgraphics.apache.org/batik/) )。将 SVG 渲染到图像中。在 SWT 容器中显示它。便携的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-18T16:11:21.690

我们通过将 Batik Swing 画布嵌入到 SWT 组合中来实现此功能，请参见[此处](http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.ohf/plugins/org.eclipse.ohf.h3et.mif.ui/src/org/eclipse/ohf/h3et/mif/ui/viewers/MIFCanvas.java?revision=1.3&root=Technology_Project)。它在 Windows 上运行良好，但我们无法在 Mac OS X 上滚动画布。
然而，我们的绝大多数用户都在 Windows 上，所以我们没有花太多时间来修复 Mac OS X 错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-06T08:37:08.713

看：[eclipse GMF](http://www.mail-archive.com/batik-users@xmlgraphics.apache.org/msg02782.html)他们写了一个通过org.eclipse.gmf.runtime.draw2d.ui.render.awt.internal.graphics.Graphics2DToGraphicsAdaptor渲染的类，源代码在org.eclipse.gmf.runtime.draw2d.ui .render.awt.internal.svg。SWTImageTranscoder。

# visual-studio - 在不改变焦点的情况下调用 Visual Studio 2005 外部工具

> ID：804661
> 
> 赞同：0
> 
> 时间：2009-04-29T23:00:14.320
> 
> 标签：visual-studio, visual-studio-2005

在编辑文件时，我想使用热键来调用我已设置为使用“输出”选项卡的外部工具。目前，当我使用热键时，焦点会离开编辑窗格并转到“输出”窗口 - 我希望焦点不会从编辑窗格中改变。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T17:32:02.760

使用 Visual Studio 宏（来自 Stephen Nutt 的灵感）一个可接受的（对我而言）解决方法是：

```
Public Module RunTestExternalTool
    Sub RunExternalTool1andReturnFocusToEdit()
        DTE.ExecuteCommand("Tools.ExternalCommand1")
        DTE.ExecuteCommand("View.ViewCode")
    End Sub
End Module 
```

这假设用户希望将焦点返回到 ViewCode 窗格（无论他们从哪里开始）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T00:03:30.613

尝试为您的热键分配一个宏并从宏执行外部工具。您可以通过按 Alt-F11 使用宏编辑器创建新宏。

# c++ - 在 C 中返回堆栈数据；它是否正确取消分配？

> ID：804665
> 
> 赞同：4
> 
> 时间：2009-04-29T23:00:45.163
> 
> 标签：c++, c, stack, release, allocation

我正在查看朋友的代码，并就 C/C++ 如何在堆栈上分配内存并管理其释放进行了有趣的辩论。如果我要在一个函数中创建一个包含 10 个对象的数组，但返回该数组，它是在函数弹出时释放（因此使给定数据无效）还是放入堆中（这引发了我们如何释放它？）。

示例代码如下：

```
Gene* GetTopTen()
{
    // Create 10 genes (or 10 objects, doesn't matter)
    Gene Ten[10];

    // Sort out external pool data
    Sort();

    // Copy over data to the array of 10 objects
    for(int i = 0; i < 10; Ten[i++] = pool[i]);

    // Here is the core of my question:
    return Ten;
} 
```

非常感谢任何帮助，这变成了一个非常有趣的问题，我的朋友们，我无法回答。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-29T23:03:23.783

那是一个堆栈分配的数组，所以返回的指针是无效的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-29T23:07:34.320

一旦函数返回，数据不会被破坏，但可能会被下一个函数调用覆盖。您可能会很幸运，它可能仍然存在，但这是未定义的行为。你不应该依赖它。

以下是可能发生的情况：在函数执行期间，堆栈如下所示：

```
"---------------------------
| caller function's data   |
----------------------------
| Ten[9]                   |
| Ten[8]                   |
| ...                      |
| Ten[0]                   |
---------------------------" 
```

函数退出后，它可能立即看起来相同。但是如果调用者像这样调用另一个函数，

```
void some_func() {
    Gene g;
    ...
} 
```

堆栈现在看起来像这样：

```
"---------------------------
| caller function's data   |
----------------------------
| g                        |
----------------------------
| Ten[8]                   |
| ...                      |
| Ten[0]                   |
---------------------------" 
```

某些数据可能会被静默覆盖（​​在这种情况下是`Ten[9]`），而您的代码将不知道它。您应该使用 分配堆上的数据`malloc()`并使用 显式释放它`free()`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T23:05:19.923

这会导致***未定义的行为***。十个数组存储在堆栈中。一旦 GetTopGene 函数结束，该堆栈就会被销毁，因此您不应该使用指向该部分内存的指针。

您要做的是在堆中分配空间。

```
Gene* GetTopTen(){
        Gene* genes = (Gene*) malloc (10*sizeof(Gene));
        //do stuff.
         return genes;
} 
```

完成后，您必须记住释放该内存。

```
 Gene* genes = GetTopTen();
   //do stuff with it.
   free(genes); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T23:29:25.937

另一种无需分配堆内存而正确执行此操作的方法是更改​​函数的原型以获取指向数组的指针以将结果写入：

无效GetTopTen（基因十[]）{...}

然后只需删除函数体中 Ten 的声明，因为它现在是一个参数。

调用者现在需要声明自己的十元素数组并将其作为参数传递：

... 基因顶部[10]; GetTopTen(顶部); ...

请注意调用者声明一个足够大的数组！不幸的是，C 没有一个好的方法让函数指定应该传入的数组的大小，所以如果调用者声明的数组太小，编译器不会警告你；它只会在运行时覆盖堆栈。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T23:17:15.747

这是最可怕的错误的原因！有时它会起作用，有时它不会。

这是一个错误，而不是“聪明的代码”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T23:06:45.600

如果你想从一个函数返回一个数组，你必须自己把它放在堆上：

在 C 中

```
Gene* GetTopTen()
{
    // Create 10 genes (or 10 objects, doesn't matter)
    Gene *Ten = malloc(sizeof(Gene)*10);
    ....    
    // Now it's ok to return
    return Ten;
}

int main()
{
    Gene *genes = GetTopTen();
    free (genes);
} 
```

在 C++ 中：

```
Gene* GetTopTen()
{
    // Create 10 genes (or 10 objects, doesn't matter)
    Gene *Ten = new Gene[10];
    ....    
    // Now it's ok to return
    return Ten;
}

int main()
{
    Gene *genes = GetTopTen();
    delete [] genes;
} 
```

当然，您也可以通过在指针/引用参数中从 GetTopTen 返回一个长度，或者通过某种常量来跟踪该数组的长度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T23:08:14.503

你的函数说它返回一个指针，所以当你的函数被调用时，只有指针的空间会在堆栈上分配给返回值。因此，您的返回值是一个指针，它指向堆栈上的某个位置，当您的函数退出时该位置将无效。

将您的返回值包装在一个`struct`.

```
typedef struct
{
    int Array[10];
} ArrayOfTen;

ArrayOfTen SomeFunction ()
{
    ArrayOfTen array = {{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}};
    return array;
}

int main (int argc, char *argv[])
{
    ArrayOfTen array = SomeFunction ();
    int i;

    for (i = 0; i < 0; i++)
        fprintf (stdout, "%d\n", array.Array[i]);

    return 0;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-07-11T17:44:19.260

这不是错误，这只是一种低级语言。您（几乎）不能堆栈分配数组并在同一个函数中返回它 - 直到您不是（不）幸运的人之一。而且，你不应该在任何情况下都调用 malloc。

为了使您的程序对内存友好，请在调用者的堆栈中分配此数组并将其作为参数传递。

GetTopTen 函数将如下所示：

```
void GetTopTen(Gene* genes) {
   /*
    Do something
    Do not allocate new Gene array, you already have one - modify values at "genes" pointer
    */
} 
```

叫它：

```
Gene genes[10];
GetTopTen(genes);
/*
 Now, do whatever you want with top ten "genes", which are safe until return from this function
 */ 
```

正如我现在看到的那样，这种风格没有被使用，很遗憾我不是在开玩笑，因为这是低级语言与垃圾收集的不同`malloc()`之处，而且比一直调用要快得多；这些变量会自动释放并占用更少的内存。但请注意，它取决于结构的大小和元素的数量 - 如果它真的很大，请通过 malloc 分配它，否则可能会导致堆栈溢出。

# keyboard-shortcuts - TextMate：如何找到与键盘快捷键关联的命令？

> ID：804668
> 
> 赞同：3
> 
> 时间：2009-04-29T23:01:04.770
> 
> 标签：keyboard-shortcuts, textmate

我很确定我记得 TextMate 中有一个命令告诉我哪个包和/或菜单项与特定的键盘快捷键相关联？我在哪里可以找到它？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T23:07:42.603

`Ctrl`++ ，然后单击`Cmd`放大镜`T`，选择“Key Equivalent”，然后键入快捷方式。

# silverlight - Silverlight Usercontrol Onload 事件在另一个 Usercontrol 中生成时，应用远见物理

> ID：804672
> 
> 赞同：0
> 
> 时间：2009-04-29T23:01:48.000
> 
> 标签：silverlight, farseer

不知道如何更好地表达这个问题，但基本上我有一个用户控件，我动态添加到另一个用户控件中。子用户控件有一组图像，基本上我需要知道它们是否已完全加载到父用户控件中，因为我需要方法的尺寸（不仅仅是高度和宽度）。

当子用户控件中的所有图像都加载到父控件中时，是否有一种类型的事件可以触发？

为了进一步解释我的场景，我需要这个，因为我使用 farseer 物理引擎进行 silverlight 并且它获取图像的形状以用于碰撞检测，并且当我尝试将图像转换为物理对象时，它不会找到形状，因为图像仍在屏幕上生成，因此引发异常。

更新：这是我到目前为止想出的

```
void currImg_ImageOpened(object sender, RoutedEventArgs e)
{

    var ImagesLoaded = true;
    for (int i = 0; i < ImageLoaded.Count-1; i++)
    {
        if (!ImageLoaded[i])
        {
            ImagesLoaded = false;
            ImageLoaded[i] = true;
            break;
        }
    }

    if (ImagesLoaded)
    {
        addPuppetPhysics(pg.currPuppet);
    }

} 
```

where`ImageLoaded`是一个布尔值列表，该方法`addPuppetPhysics`将 farseer 物理应用到 usercontrol `pg.currPuppet`。事情是物理引擎找到了图像的前半部分，然后就找不到了（在同一个图像上崩溃）。如果我只是加载用户控件，然后通过单击按钮应用物理，它会完美运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T23:11:32.110

你能检测到图像何时在子控件中完成加载吗？如果是这样，您也许可以创建自己的事件——例如：`ImagesLoaded`——并在父级中处理它。

# linux - 使用硬件令牌登录

> ID：804676
> 
> 赞同：3
> 
> 时间：2009-04-29T23:02:50.930
> 
> 标签：linux, pam, pkcs#11

我是密码学的新手，正在研究 PKI 和 PKCS 等。我了解 PKI 的基本概念以及它如何用于加密/解密。但是，我对如何使用 USB 令牌或智能卡等硬件令牌来安全登录您的计算机感到困惑。以下是我理解的步骤以及我感到困惑的部分（对于问题长度，请提前抱歉）：

场景：网络上的计算机 xyz 包含只有属于 SECRET 组的用户才能访问的数据。用户 Bob 和 Joe 属于该组，并已获得 USB 令牌，他们可以使用这些令牌提供凭据，使他们能够访问这些资源。USB 令牌采用双因素身份验证，需要输入密码。该令牌符合 PKCS11。

1.  Bob 将 USB 令牌插入 Linux 机器
2.  PAM-PKCS11 模块识别此事件并提示 Bob 输入他的密码。
3.  一旦 Bob 正确输入了他的 4 位 PIN，模块将通过以下方式检查 Bob 令牌上证书的有效性**（这会有所不同，但最低要求是多少？）**：
    *   查找根证书以检查受信任的 CA
    *   检查证书有效期和撤销列表
    *   将令牌上的 ID 与用户文件**（在哪里？，缺少步骤）**或目录（LDAP 等）匹配
4.  如果一切正常，模块会通知 PAM 成功的结果。
5.  此行被标记为足够，因此 PAM 接受身份验证，并且 Bob 已登录并且可以查看仅限于 SECRET 组用户的信息。

我缺少的部分是关于 Bob 是否可以访问这台机器以及他与网络（甚至桌面）用户 Bob 的关系的信息存储在哪里。我了解有关 Bob 的其他识别数据将存储在 USB 上，包括 ID（例如，电子邮件地址）。但是，这种强大的安全性如何？如果有的话，在登录过程中在哪里使用加密（或者这不是这些令牌的真正目的）？如果有人拿到 USB 并知道 4 位数的 pin，这似乎就是所需要的，对吧？此外，CA 的信任本质上是否允许信任另一个用户无法获得新的 USB 令牌并使用受信任的 CA 来获取新证书，但指定所有识别数据与 Bob 的相同？我知道我缺少一些关键部分.. 但是在阅读了几十篇文章之后，这方面的解释似乎被掩盖了。使用硬件令牌作为身份验证登录到包含敏感数据的机器的充分手段是个好主意吗？或者此类令牌的目的主要是为了安全地存储在其他应用程序中使用的密钥对？感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T00:01:15.530

PAM（顾名思义）只处理身份验证。身份验证是关于证明用户是谁，即“向我证明你说你是谁”。这与授权是分开的，即“您有权访问此资源吗？”。

认证有三个方面：
1.我知道
2.我有
3.我是

典型的用户名/密码组合适合 1。而令牌或其他 PKCS 设备适合 2，而虹膜识别或指纹读取等生物识别技术适合 3。

您在安全性中拥有的这些方面越多，安全性就越好/越严格。在这种情况下，登录适合 1 和 2，因此比仅使用用户名和密码更安全。如果有人要从他身上取出他的别针并偷走他的设备，那么是的，它不会证明这是鲍勃在使用它。但是，如果 Bob 将他的用户名和密码也提供给某人，也不会这样做。

令牌的重点是引入“拥有”某些东西的第二个因素，您还需要 PIN 的事实意味着也需要“知道”某些东西。因此，系统可以更有信心地相信这个人就是他们声称的那个人。

您所指的缺少的部分是*授权*，如上所述，这是一个单独的身份验证过程，并且仅在用户进行身份验证后才会发生。在这种情况下，PAM 已对 Bob 进行了身份验证，并向操作系统确认 Bob 确实在使用该系统。但是，操作系统随后必须在步骤 5 中执行一些其他检查，以确认 Bob 有权访问该资源。

# xml - 将reportviewer数据转换为xml

> ID：804684
> 
> 赞同：0
> 
> 时间：2009-04-29T23:04:54.950
> 
> 标签：xml, reportviewer

我们如何将报表查看器中显示的数据转换为 xml 文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T23:37:12.750

调用 .Render 方法，第一个参数（格式）等于“XML”。就像[http://msdn.microsoft.com/en-us/library/microsoft.reporting.webforms.localreport(VS.80).aspx](http://msdn.microsoft.com/en-us/library/microsoft.reporting.webforms.localreport(VS.80).aspx)中的示例一样——除了使用“XML”而不是“Excel”作为格式（当然还有类似 .xml 而不是 .xsl 作为您编写的文件的格式；-)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T18:13:00.047

如果您在本地模式下运行 ReportViewer，您的 XML 文件就是 RDLC 文件。只需在 XML 查看器中打开 RDLC 文件。

# c# - 如何在 C#/.NET 中查找本地机器的 FQDN？

> ID：804700
> 
> 赞同：92
> 
> 时间：2009-04-29T23:08:16.190
> 
> 标签：c#, localhost, fqdn

如何在 C# 中获取本地计算机的 FQDN？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-04-29T23:12:03.963

*注意：此解决方案仅适用于 .NET 2.0（和更新的）框架。*

```
using System;
using System.Net;
using System.Net.NetworkInformation;
//...

public static string GetFQDN()
{
    string domainName = IPGlobalProperties.GetIPGlobalProperties().DomainName;
    string hostName = Dns.GetHostName();

    domainName = "." + domainName;
    if(!hostName.EndsWith(domainName))  // if hostname does not already include domain name
    {
        hostName += domainName;   // add the domain name part
    }

    return hostName;                    // return the fully qualified name
} 
```

**更新**

由于很多人评论说[山姆的答案](https://stackoverflow.com/a/17079669/63074)更简洁，我决定在答案中添加一些评论。

最需要注意的是，我给出的代码**并不等同**于下面的代码：

```
Dns.GetHostEntry("LocalHost").HostName 
```

虽然在机器联网并且属于域的一般情况下，这两种方法通常会产生相同的结果，但在其他情况下，结果会有所不同。

当机器不属于域时，输出会有所不同。在这种情况下，`Dns.GetHostEntry("LocalHost").HostName`将返回`localhost`，而`GetFQDN()`上面的方法将返回主机的 NETBIOS 名称。

当查找机器 FQDN 的目的是记录信息或生成报告时，这种区别很重要。大多数时候，我在日志或报告中使用此方法，这些日志或报告随后用于将信息映射回特定机器。如果机器没有联网，则`localhost`标识符是无用的，而名称提供了所需的信息。

因此，最终取决于每个用户，哪种方法更适合他们的应用程序，具体取决于他们需要的结果。但是说这个答案不够简洁是错误的，充其量是肤浅的。

查看输出不同的示例：http: [//ideone.com/q4S4I0](http://ideone.com/q4S4I0)

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2009-05-18T20:58:11.267

Miky D 代码的轻微简化

```
 public static string GetLocalhostFqdn()
    {
        var ipProperties = IPGlobalProperties.GetIPGlobalProperties();
        return string.Format("{0}.{1}", ipProperties.HostName, ipProperties.DomainName);
    } 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2013-06-13T05:14:35.623

本文对此进行[了介绍](http://support.microsoft.com/kb/303902)。这种技术比公认的答案更简短，并且可能比下一个投票最多的答案更可靠。请注意，据我了解，这**不**使用 NetBIOS 名称，因此它应该适合 Internet 使用。

## .NET 2.0+

```
Dns.GetHostEntry("LocalHost").HostName 
```

## .NET 1.0 - 1.1

```
Dns.GetHostByName("LocalHost").HostName 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-09-14T19:26:53.050

这是在PowerShell中，为了它：

```
$ipProperties = [System.Net.NetworkInformation.IPGlobalProperties]::GetIPGlobalProperties()
"{0}.{1}" -f $ipProperties.HostName, $ipProperties.DomainName 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2010-05-14T10:29:33.070

对于 Framework 1.1，就这么简单：

```
System.Net.Dns.GetHostByName("localhost").HostName 
```

然后删除机器的 NETBIOS 名称以仅检索 domainName

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-01-24T20:12:11.893

您可以尝试以下方法：

```
return System.Net.Dns.GetHostEntry(Environment.MachineName).HostName; 
```

这应该为您提供当前本地机器的 FQDN（或者您可以指定任何主机）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-02-12T09:15:52.950

对马特 Z 的回答略有改进，因此如果计算机不是域的成员，则不会返回尾随句号：

```
public static string GetLocalhostFqdn()
{
    var ipProperties = IPGlobalProperties.GetIPGlobalProperties();
    return string.IsNullOrWhiteSpace(ipProperties.DomainName) ? ipProperties.HostName : string.Format("{0}.{1}", ipProperties.HostName, ipProperties.DomainName);
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-05-16T17:04:08.397

将此作为我的选项之一，将主机名和域名结合起来构建报告，添加通用文本以在未捕获域名时填写，这是客户要求之一。

**我使用 C# 5.0、.Net 4.5.1 对此进行了测试**

```
private static string GetHostnameAndDomainName()
{
       // if No domain name return a generic string           
       string currentDomainName = IPGlobalProperties.GetIPGlobalProperties().DomainName ?? "nodomainname";
       string hostName = Dns.GetHostName();

    // check if current hostname does not contain domain name
    if (!hostName.Contains(currentDomainName))
    {
        hostName = hostName + "." + currentDomainName;
    }
    return hostName.ToLower();  // Return combined hostname and domain in lowercase
} 
```

使用来自 Miky Dinescu 解决方案的想法构建。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-01-18T12:37:39.917

我们已经实现了建议的结果以使用这种方式：

```
return System.Net.Dns.GetHostEntry(Environment.MachineName).HostName; 
```

然而，事实证明，当计算机名称超过 15 个字符并使用 NetBios 名称时，这不起作用。Environment.MachineName 仅返回部分名称，解析主机名返回相同的计算机名称。

经过一番研究，我们找到了解决此问题的解决方案：

```
System.Net.Dns.GetHostEntry(System.Net.Dns.GetHostName()).HostName 
```

这解决了包括计算机名称在内的所有问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-12-23T18:22:08.520

我测试的所有答案都没有提供我正在寻找的 DNS 后缀。这就是我想出的。

```
public static string GetFqdn()
{
    var networkInterfaces = NetworkInterface.GetAllNetworkInterfaces();
    var ipprops = networkInterfaces.First().GetIPProperties();
    var suffix = ipprops.DnsSuffix;
    return $"{IPGlobalProperties.GetIPGlobalProperties().HostName}.{suffix}";
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-12-04T12:14:49.907

我用过这种方法：

```
private static string GetLocalhostFQDN()
{
    var ipProperties = IPGlobalProperties.GetIPGlobalProperties();
    return $"{ipProperties.HostName}.{ipProperties.DomainName}";
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-12-02T06:48:47.110

我收集的处理 FQ 主机名/主机名/NetBIOS 机器名/域名周围所有情况的方法

```
 /// <summary>
    /// Get the full qualified hostname
    /// </summary>
    /// <param name="throwOnMissingDomainName"></param>
    /// <returns></returns>
    public static string GetMachineFQHostName(bool throwOnMissingDomainName = false)
    {
        string domainName = GetMachineFQDomainName();
        string hostName = GetMachineHostName();

        if (string.IsNullOrEmpty(domainName) && throwOnMissingDomainName) throw new Exception($"Missing domain name on machine: { hostName }");
        else if (string.IsNullOrEmpty(domainName)) return hostName;
        //<----------

        return $"{ hostName }.{ domainName }";
    }

    /// <summary>
    /// Get the NetBIOS name of the local machine
    /// </summary>
    /// <returns></returns>
    public static string GetMachineName()
    {
        return Environment.MachineName;
    }

    /// <summary>
    /// Get the Hostname from the local machine which differs from the NetBIOS name when 
    /// longer than 15 characters
    /// </summary>
    /// <returns></returns>
    public static string GetMachineHostName()
    {
        /// I have been told that GetHostName() may return the FQName. Never seen that, but better safe than sorry ....
        string hostNameRaw = System.Net.Dns.GetHostName();
        return hostNameRaw.Split('.')[0];
    }

    /// <summary>
    /// Check if hostname and NetBIOS name are equal
    /// </summary>
    /// <returns></returns>
    public static bool AreHostNameAndNetBIOSNameEqual()
    {
        return GetMachineHostName().Equals(GetMachineName(), StringComparison.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Get the domain name without the hostname
    /// </summary>
    /// <returns></returns>
    public static string GetMachineFQDomainName()
    {
        return IPGlobalProperties.GetIPGlobalProperties().DomainName;
    } 
```

* * *

## 回答 #13

> 赞同：-9
> 
> 时间：2011-05-15T23:42:47.547

如果你想整理它并处理异常，试试这个：

```
public static string GetLocalhostFQDN()
        {
            string domainName = string.Empty;
            try
            {
                domainName = NetworkInformation.IPGlobalProperties.GetIPGlobalProperties().DomainName;
            }
            catch
            {
            }
            string fqdn = "localhost";
            try
            {
                fqdn = System.Net.Dns.GetHostName();
                if (!string.IsNullOrEmpty(domainName))
                {
                    if (!fqdn.ToLowerInvariant().EndsWith("." + domainName.ToLowerInvariant()))
                    {
                        fqdn += "." + domainName;
                    }
                }
            }
            catch
            {
            }
            return fqdn;
        } 
```

# c# - 如何在 C# 中实现类之间的共享行为（当然没有多重继承）

> ID：804702
> 
> 赞同：1
> 
> 时间：2009-04-29T23:09:23.020
> 
> 标签：c#, design-patterns, inheritance, multiple-inheritance, code-reuse

更新：几乎这里的每个人都告诉我，我只需要重新开始我如何设计我的课程（顺便感谢你们的出色回答！）。得到提示后，我开始广泛阅读[策略模式](http://www.dofactory.com/Patterns/PatternStrategy.aspx)。我想创建从一个或多个抽象基类继承的行为类（或策略类）。然后，候选类将具有带有不同抽象基类/类的属性作为`Type`行为或策略。也许是这样的：

```
public abstract class SalaryStrategy {
    public abstract decimal Salary { get; set; }
    public abstract decimal Min { get; set; }
    public abstract decimal Mid { get; set; }
    public decimal CompaRatio {
        get {
            if (this.Mid == 0) { return 0; }
            else { return this.Salary / this.Mid; }
        }
    }
}

public class InternalCurrentSalaryStrategy {
    public override decimal Salary { get; set; }
    public override decimal Min {
        get { return this.Salary * .25m; }
        set { }
    }
    public override decimal Mid { get; set; }
}

public class Candidate {
    public int Id { get; set; }
    public string Name { get; set; }
    public SalaryStrategy CurrentSalaryStrategy { get; set; }
}

public static void Main(string[] args) {
    var internal = new Candidate();
    internal.CurrentSalaryStrategy = new InternalCurrentSalaryStrategy();
    var internalElp = new Candidate();
    internalElp.CurrentSalaryStrategy = new InternalCurrentSalaryStrategy();
    var elp = new Candidate();
    // elp.CurrentSalaryStrategy can stay null cause it's not used for elps
} 
```

有什么意见或建议吗？

* * *

原始问题：

我正在努力学习并更加精通设计模式和原则。我目前正在为一些让我难过的课程进行设计。这是代码的非常精简的版本：

```
public class Candidate {
    public int Id { get; set; }
    public string Comments { get; set; }
    // lots more properties and behaviors...
}

public class InternalCandidate : Candidate {
    public decimal CurrentMid { get; set; }
    public decimal CurrentMax {
         get { return this.CurrentMin * 1.3m;
    }
    // lots more properties and behaviors...
}

public class EntryLevelCandidate : Candidate {
    public string Gpa { get; set; }
    // lots more properties and behaviors...
}

public class InternalEntryLevelCandidate /* what do I inherit here??? */ {
    // needs all of the properties and behaviors of
    // EntryLevelCandidate but also needs the CurrentMin and
    // CurrentMax (and possibly more) in InternalCandidate
} 
```

InternalEntryLevelCandidate 类主要是一个EntryLevelCandidate，但需要共享InternalCandidate 的一些*实现*。我说实现是因为我不希望实现不同或重复，否则我会使用通用合同的接口并在每个类中都有具体的实现。InternalCandidate 属性和行为的一些实现需要通用或共享。我已经阅读了 C++ 和 Ruby mixins，这似乎与我想做的类似。我还阅读了这篇有趣的博客文章，其中讨论了一种行为类型的想法，其中一个类能够继承多个行为，同时仍然保持单一的“是”关系：[http://www.deftflux.net/blog/post/A-good-design-for-multiple-implementation-inheritance.aspx](http://www.deftflux.net/blog/post/A-good-design-for-multiple-implementation-inheritance.aspx)。这似乎传达了我想要的东西。谁能给我一些指导，告诉我如何使用良好的设计实践来实现这一目标？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T23:45:06.007

**不可变的数据值类。** 如果您的各种候选子类中的任何**属性**代表某种有意义的数据值，请为其创建一个不可变类，并具有您需要的行为。然后，每个不同的 Candidate 子类都可以使用该数据类型，但您的代码仍封装在数据类中。

**扩展方法。** 这些可以重载以与任何类一起使用。

我会避免使用装饰器模式并坚持编译/反射功能。

**作品。** 立即在单独的类中开发独特的行为，并围绕它们构建候选类，而不是在候选类中编写独特的行为并尝试提取它们的功能以供以后在相关类中使用。

根据您使用类的方式，您还可以实现并使用显式和隐式转换运算符到相关类型，因此您可以实际将对象转换为类型/实现，而不是重新实现接口（您想避免）无论出于何种目的，您都需要。

我刚刚想到的与最后一段相关的另一件事是拥有一个租赁系统，您的类在其中产生和适当类型的对象，允许对其进行操作，然后稍后使用它以吸收更新的信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T23:31:39.470

这是一篇我认为非常有趣的关于该主题的学术论文（[PDF 链接](http://users.jyu.fi/~sakkinen/inhws/papers/Crespo.pdf)）。

但是，我认为您正试图在概括中强加*业务逻辑*。您碰巧知道内部候选人永远不会查看他的 GPA。但是，内部候选人肯定有 GPA。所以，你已经破解了这个叫做 InternalEntryLevelCandidate 的奇怪家伙，因为你碰巧知道你想查看这个家伙的 GPA。在架构上，我认为 EntryLevelCandidate 是不正确的。我会为候选人添加一个“级别”概念并给他一个 GPA。由*业务逻辑*决定他们是否查看 GPA。

编辑：另外，[Scott Meyers](http://www.aristeia.com/effective-c++.html)在他的书中很好地剖析了这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T23:28:13.723

**免责声明**：

根据我的经验，需要多重继承是例外而不是规则，仔细设计类层次结构通常可以避免需要这个特性。我同意 JP 的观点，即可以在您的样本中避免此要求。

回到问题，没有干净的解决方案，但是您有几个选择：

*   使用扩展方法，缺点是右键Resolve不起作用，还有一些人真的不喜欢这些小狗。

*   创建一个聚合对象，其中包含您想要组合的每个类的实例，重新实现委托的存根方法。

*   为每个行为定义一个接口，并让基础中的方法在`this is IInterface`执行行为之前检查是否。（允许您将行为定义拉到基础）

近乎重复： [C# 中的多重继承](https://stackoverflow.com/questions/178333/multiple-inheritance-in-c)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T23:16:01.380

我同意继承在这里似乎不是正确的事情。我不确定我是否知道完美的答案，但也许[装饰器模式](http://www.primos.com.au/primos/Default.aspx?PageContentID=25&tabid=65)是合适的。

另一个更深奥的想法是考虑面向方面的编程。你可以用方面做一些非常了不起的事情，但这是一个我还没有掌握的非常高级的话题。像 Rikard Oberg 和他的[Qi4J](http://www.qi4j.org/)同伙这样的人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T23:46:20.480

我只是使用[委托模式](http://en.wikipedia.org/wiki/Delegation_pattern)。最终我会为每个不同的功能使用一个接口，然后有一个具体的类作为每个接口的委托。然后你的最终类只使用他们需要的委托，并且可以从多个接口继承。

```
public class InternalEntryLevelCandidate : EntryLevelCandidate {
    private  InternalCandidate internalCandidateDelegate
        = new InternalCandidate();

    public decimal CurrentMid { 
        get { return internalCandidateDelegate.CurrentMid; }
        set { internalCandidateDelegate.CurrentMid = value; }
    }

    public decimal CurrentMax {
        get { return internalCandidateDelegate.CurrentMax }
    }
} 
```

# c# - 在不使用临时变量的情况下交换两个变量

> ID：804706
> 
> 赞同：88
> 
> 时间：2009-04-29T23:09:31.163
> 
> 标签：c#, algorithm, swap

我希望能够在不使用 C# 中的临时变量的情况下交换两个变量。这可以做到吗？

```
decimal startAngle = Convert.ToDecimal(159.9);
decimal stopAngle = Convert.ToDecimal(355.87);

// Swap each:
//   startAngle becomes: 355.87
//   stopAngle becomes: 159.9 
```

* * *

## 回答 #1

> 赞同：229
> 
> 时间：2016-08-28T11:29:46.530

[C# 7 引入了**元组**](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#tuples)，可以在没有临时变量的情况下交换两个变量：

```
int a = 10;
int b = 2;
(a, b) = (b, a); 
```

这分配`b`给`a`和`a`给`b`。

* * *

## 回答 #2

> 赞同：226
> 
> 时间：2009-04-30T02:05:39.773

交换两个变量的*正确*方法是：

```
decimal tempDecimal = startAngle;
startAngle = stopAngle;
stopAngle = tempDecimal; 
```

换句话说，*使用临时变量。*

你有它。没有聪明的技巧，没有你的代码维护者在未来几十年里诅咒你，没有进入[The Daily WTF 的](http://thedailywtf.com/)条目，也没有花费太多时间试图找出你为什么需要它在一个操作中，因为在最低级别，即使是最复杂的语言特征是一系列简单的操作。

只是一个非常简单，可读，易于理解的`t = a; a = b; b = t;`解决方案。

在我看来，尝试使用技巧的开发人员，例如，“不使用临时变量交换变量”或“Duff 的设备”只是试图展示他们有多聪明（并且失败得很惨）。

我把他们比作那些仅仅为了在聚会上看起来更有趣（而不是扩大你的视野）而阅读高雅书籍的人。

您添加和减去的解决方案或基于 XOR 的解决方案的可读性较差，并且很可能比简单的“临时变量”解决方案（算术/布尔运算而不是装配级别的简单移动）更慢。

通过编写高质量的可读代码为自己和他人提供服务。

那是我的吐槽。感谢收听 ：-）

顺便说一句，我很清楚这并不能回答你的具体问题（我会为此道歉），但是有很多关于 SO 的先例，人们问如何做某事，正确的答案是“不要做”。

* * *

## 回答 #3

> 赞同：133
> 
> 时间：2009-04-29T23:20:58.437

首先，在 C# 语言中不使用临时变量进行交换是一个**非常糟糕的主意**。

但为了回答，您可以使用以下代码：

```
startAngle = startAngle + stopAngle;
stopAngle = startAngle - stopAngle;
startAngle = startAngle - stopAngle; 
```

但是，如果两个数字相差很大，则四舍五入可能会出现问题。这是由于浮点数的性质。

如果要隐藏临时变量，可以使用实用方法：

```
public static class Foo {

    public static void Swap<T> (ref T lhs, ref T rhs) {
        T temp = lhs;
        lhs = rhs;
        rhs = temp;
    }
} 
```

* * *

## 回答 #4

> 赞同：74
> 
> 时间：2009-04-29T23:31:00.643

是的，使用以下代码：

```
stopAngle = Convert.ToDecimal(159.9);
startAngle = Convert.ToDecimal(355.87); 
```

对于任意值，问题更难。:-)

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2009-12-29T07:34:49.230

```
int a = 4, b = 6;
a ^= b ^= a ^= b; 
```

适用于所有类型，包括字符串和浮点数。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2013-03-05T18:17:23.437

BenAlabaster 展示了一种进行变量切换的实用方法，但不需要 try-catch 子句。这段代码就够了。

```
static void Swap<T>(ref T x, ref T y)
{
     T t = y;
     y = x;
     x = t;
} 
```

用法和他展示的一样：

```
float startAngle = 159.9F
float stopAngle = 355.87F
Swap(ref startAngle, ref stopAngle); 
```

您还可以使用扩展方法：

```
static class SwapExtension
{
    public static T Swap<T>(this T x, ref T y)
    {
        T t = y;
        y = x;
        return t;
    }
} 
```

像这样使用它：

```
float startAngle = 159.9F;
float stopAngle = 355.87F;
startAngle = startAngle.Swap(ref stopAngle); 
```

两种方式都在方法中使用临时变量，但您不需要在进行交换时使用临时变量。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2013-10-27T13:53:44.600

带有详细示例的二进制 XOR 交换：

*异或真值表*：

```
a b a^b
0 0  0
0 1  1
1 0  1
1 1  0 
```

**输入：**

```
a = 4;
b = 6; 
```

**第 1 步**：*a = a ^ b*

```
a  : 0100
b  : 0110
a^b: 0010 = 2 = a 
```

**第 2 步**：*b = a ^ b*

```
a  : 0010
b  : 0110
a^b: 0100 = 4 = b 
```

**第 3 步**：*a = a ^ b*

```
a  : 0010
b  : 0100
a^b: 0110 = 6 = a 
```

**输出：**

```
a = 6;
b = 4; 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2009-04-29T23:13:58.547

不在 C# 中。在本机代码中，您可能能够使用三异或交换技巧，但不能在高级类型安全语言中使用。（无论如何，我听说 XOR 技巧实际上最终比在许多常见的 CPU 架构中使用临时变量要慢。）

你应该只使用一个临时变量。没有理由不能使用它；这不像是供应有限。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2014-07-18T16:28:57.480

为了未来的学习者和人类，我将这个更正提交给当前选择的答案。

如果你想避免使用临时变量，**只有两个明智的选择**，首先考虑性能，然后考虑可读性。

*   `Swap`在泛型方法中使用临时变量。（绝对最佳性能，在 inline temp 变量旁边）
*   使用[`Interlocked.Exchange`](http://msdn.microsoft.com/en-us/library/system.threading.interlocked.exchange.aspx). （在我的机器上慢 5.9 倍，但如果多个线程同时交换这些变量，这是你唯一的选择。）

你**永远**不应该做的事情：

*   永远不要使用浮点运算。（缓慢、舍入和溢出错误，难以理解）
*   永远不要使用非原始算术。（缓慢，溢出错误，难以理解）[`Decimal`](http://msdn.microsoft.com/en-us/library/364x0z75.aspx)不是 CPU 原语，导致的代码比您意识到的要多得多。
*   切勿使用算术周期。[或位黑客。](https://www.bing.com/search?q=xor%20vs%20temp%20performance)（缓慢，难以理解）这是编译器的工作。它可以针对许多不同的平台进行优化。

因为每个人都喜欢硬数字，所以这里有一个程序可以比较您的选择。从 Visual Studio 外部以发布模式运行它，以便`Swap`内联。我的机器上的结果（Windows 7 64 位 i5-3470）：

```
Inline:      00:00:00.7351931
Call:        00:00:00.7483503
Interlocked: 00:00:04.4076651 
```

代码：

```
class Program
{
    static void Swap<T>(ref T obj1, ref T obj2)
    {
        var temp = obj1;
        obj1 = obj2;
        obj2 = temp;
    }

    static void Main(string[] args)
    {
        var a = new object();
        var b = new object();

        var s = new Stopwatch();

        Swap(ref a, ref b); // JIT the swap method outside the stopwatch

        s.Restart();
        for (var i = 0; i < 500000000; i++)
        {
            var temp = a;
            a = b;
            b = temp;
        }
        s.Stop();
        Console.WriteLine("Inline temp: " + s.Elapsed);

        s.Restart();
        for (var i = 0; i < 500000000; i++)
        {
            Swap(ref a, ref b);
        }
        s.Stop();
        Console.WriteLine("Call:        " + s.Elapsed);

        s.Restart();
        for (var i = 0; i < 500000000; i++)
        {
            b = Interlocked.Exchange(ref a, b);
        }
        s.Stop();
        Console.WriteLine("Interlocked: " + s.Elapsed);

        Console.ReadKey();
    }
} 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2017-09-29T13:39:25.020

在 C# 7 中：

```
(startAngle, stopAngle) = (stopAngle, startAngle); 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2009-04-29T23:32:01.780

<已弃用>

您可以使用基本数学在 3 行中完成 - 在我的示例中，我使用了乘法，但简单的加法也可以。

```
float startAngle = 159.9F;
float stopAngle = 355.87F;

startAngle = startAngle * stopAngle;
stopAngle = startAngle / stopAngle;
startAngle = startAngle / stopAngle; 
```

编辑：如评论中所述，如果 y = 0 这将不起作用，因为它会产生除以零的错误，这是我没有考虑过的。因此，另外提出的 +/- 解决方案将是最好的方法。

</弃用>

* * *

为了让我的代码立即被理解，我更有可能做这样的事情。[总是想想那些不得不维护你的代码的可怜人]：

```
static bool Swap<T>(ref T x, ref T y)
{
    try
    {
        T t = y;
        y = x;
        x = t;
        return true;
    }
    catch
    {
        return false;
    }
} 
```

然后你*可以*在一行代码中做到这一点：

```
float startAngle = 159.9F
float stopAngle = 355.87F
Swap<float>(ref startAngle, ref stopAngle); 
```

或者...

```
MyObject obj1 = new MyObject("object1");
MyObject obj2 = new MyObject("object2");
Swap<MyObject>(ref obj1, ref obj2); 
```

像晚餐一样完成...您现在可以传入任何类型的对象并切换它们...

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-05-01T09:42:37.077

为了完整起见，这里是二进制 XOR 交换：

```
int x = 42;
int y = 51236;
x ^= y;
y ^= x;
x ^= y; 
```

这适用于所有原子对象/引用，因为它直接处理字节，但可能需要不安全的上下文来处理小数，或者，如果你感觉真的很扭曲，指针。在某些情况下，它也可能比临时变量慢。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-07-30T07:39:45.383

如果您可以从 using 更改`decimal`为`double`您可以使用`Interlocked`该类。据推测，这将是交换变量性能的好方法。也比 XOR 更具可读性。

```
var startAngle = 159.9d;
var stopAngle = 355.87d;
stopAngle = Interlocked.Exchange(ref startAngle, stopAngle); 
```

[Msdn: Interlocked.Exchange Method (Double, Double)](http://msdn.microsoft.com/en-us/library/3sh52ebc.aspx)

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2017-07-22T01:12:41.430

使用 C# 7，您可以使用元组解构在一行中实现所需的交换，并且很清楚发生了什么。

```
decimal startAngle = Convert.ToDecimal(159.9);
decimal stopAngle = Convert.ToDecimal(355.87);

(startAngle, stopAngle) = (stopAngle, startAngle); 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-07-05T17:40:44.277

```
a = a + b
b = a - b
a = a - b 
```

⎎

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-10-08T03:21:26.077

**小心你的环境！**

例如，这似乎不适用于 ECMAscript

```
y ^= x ^= y ^= x; 
```

但这确实

```
x ^= y ^= x; y ^= x; 
```

我的建议？尽可能少地假设。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2016-05-05T20:58:29.863

**在一行中交换 2 个数字的简单方法：**

```
a=(a+b)-(b=a); 
```

例如：a=1, b=2

第 1 步：a=(1+2) - (b=1)

第 2 步：a=3-1

=> a=2 和 b=1

* * *

**有效的方法是使用：**

C 编程： `(x ^= y), (y ^= x), (x ^= y);`

爪哇： `x = x ^ y ^ (y = x);`

Python：`x, y = y, x`

**注意：**人们最常犯的错误： *//Swap using bitwise XOR (Wrong Solution in C/C++)*

```
x ^= y ^= x ^= y; 
```

资料来源：[GeeksforGeek](http://www.geeksforgeeks.org/how-to-swap-two-variables-in-one-line/)

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-04-29T23:25:57.020

对于二进制类型，您可以使用这个时髦的技巧：

```
a %= b %= a %= b; 
```

只要 a 和 b 不是完全相同的变量（例如，同一内存的别名），它就可以工作。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2016-03-15T23:49:20.827

我希望这可能会有所帮助...

```
using System;

public class Program
{
    public static void Main()
    {
        int a = 1234;
        int b = 4321;

        Console.WriteLine("Before: a {0} and b {1}", a, b);

        b = b - a;
        a = a + b;
        b = a - b;

        Console.WriteLine("After: a {0} and b {1}", a, b);
    }
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-02-14T09:30:18.783

```
startAngle = (startAngle + stopAngle) - (stopAngle = startAngle); 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-06-30T17:37:17.387

我们可以通过一个简单的技巧来做到这一点

```
a = 20;
b = 30;
a = a+b; // add both the number now a has value 50
b = a-b; // here we are extracting one number from the sum by sub
a = a-b; // the number so obtained in above help us to fetch the alternate number from sum
System.out.print("swapped numbers are a = "+ a+"b = "+ b); 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2017-08-30T14:07:17.817

如果要交换 2 个字符串变量：

```
a = (a+b).Substring((b=a).Length); 
```

相应的辅助方法：

```
public static class Foo {
    public static void SwapString (ref string a, ref string b) {
       a = (a+b).Substring((b=a).Length);
    }
} 
```

用法将是：

```
string a="Test 1";
string b="Test 2";
Foo.SwapString(a, b); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2021-01-30T23:33:17.430

有时我希望可以在 C# 中使用 MSIL 内联编写函数，类似于在 C 中编写内联汇编程序。

作为记录，我曾经为 C# 编写了一个帮助程序库，其中包含各种函数，这些函数无法用 C# 编写，但*可以*用 MSIL 编写（例如，非从零开始的数组）。我有这个功能：

```
.method public hidebysig static void Swap<T> (
        !!T& a,
        !!T& b
    ) cil managed 
{
    .maxstack 4

    ldarg.1      // push a& reference
    ldarg.2      // push b& reference
    ldobj !!T    // pop b&, push b
    ldarg.2      // push b& reference
    ldarg.1      // push a& reference
    ldobj !!T    // pop a&, push a
    stobj !!T    // store a in b&
    stobj !!T    // store b in a&
    ret
} 
```

而且不需要当地人。当然，这只是我的愚蠢...

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-03-24T12:46:34.417

这里有另一种方法：

```
decimal a = 159.9m;
decimal b = 355.87m;

a = b + (b = a) - b; 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-08-11T19:16:40.603

这是交换两个变量的一些不同过程

```
//process one
a=b+a;
b=a-b;
a=a-b;
printf("a= %d  b=  %d",a,b);

//process two
a=5;
b=10;
a=a+b-(b=a);
printf("\na= %d  b=  %d",a,b);

//process three
a=5;
b=10;
a=a^b;
b=a^b;
a=b^a;
printf("\na= %d  b=  %d",a,b);

//process four
a=5;
b=10;
a=b-~a-1;
b=a+~b+1;
a=a+~b+1;
printf("\na= %d  b=  %d",a,b); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-09-11T14:42:02.373

只为答题

```
 var a = 10;
        var b = 20;

        var c = new int[] { a, b };

        a = c[1];
        b = c[0]; 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2013-03-30T13:52:05.427

```
var a = 15;
var b = -214;
a = b | !(b = a); 
```

这很好用。

* * *

## 回答 #28

> 赞同：-4
> 
> 时间：2015-08-09T08:07:37.447

用于交换两个变量的非常简单的代码：

```
static void Main(string[] args)
{
    Console.WriteLine("Prof.Owais ahmed");
    Console.WriteLine("Swapping two variables");

    Console.WriteLine("Enter your first number ");
    int x = Convert.ToInt32(Console.ReadLine());

    Console.WriteLine("Enter your first number ");
    int y = Convert.ToInt32(Console.ReadLine());

    Console.WriteLine("your vlaue of x is="+x+"\nyour value of y is="+y);

    int z = x;
    x = y;
    y = z;

    Console.WriteLine("after Swapping value of x is="+x+"/nyour value of y is="+y);
    Console.ReadLine();
} 
```

* * *

## 回答 #29

> 赞同：-5
> 
> 时间：2016-06-23T08:48:23.727

你可以试试下面的代码。它比其他代码要好得多。

```
a = a + b;
b = a - b;
a = a - b; 
```

# database - Oracle 在 Windows 或 Linux 上运行更好？根据你的经验给出你的答案

> ID：804721
> 
> 赞同：5
> 
> 时间：2009-04-29T23:13:05.053
> 
> 标签：database, oracle

在大多数情况下，我习惯使用 Windows，几周前我开始使用 Oracle，我有使用 SQL 和 MySql 等其他 DBMS 的经验，并且我曾在 Windows 中使用过它们。

现在我正在学习甲骨文，但我不知道**甲骨文在哪个操作系统中效果更好**。我已经在windows中安装了它，但在Linux中没有。我还下载了 Oracle Enterprise Linux，它是 Oracle 的 Linux 操作系统（类似于 RedHat）。

我想知道**Oracle Enterprise Linux 是否是唯一**可以安装 Oracle 的 Linux 操作系统，或者我们甚至可以在 RedHat、Ubuntu 等中安装 Oracle。

此外，如果有人有此问题的经验，请让我们知道 Oracle 在哪个操作系统中工作得更好。我对这个问题感到困惑，专业 DBA 的回答对我很有帮助。

* * *

那么谁能告诉我们哪个版本的 Oracle 11 适用于 linux，因为我想在 RedHat 上安装 Oracle，如果有人告诉我适用于 Linux（redhat）的 Oracle 版本是什么，那就太好了。如果我有一些链接显示在redhat上逐步安装Oracle，那也会很好。感谢您的回答。您帮助我决定在哪个操作系统中运行 Oracle。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T23:17:34.730

在我们公司，我们管理着数十个数据库。它们在 Windows 服务器和 *nix（UNIX 或 Linux）之间以 50/50 的比例划分。两者都在运行重要的应用程序（健康和金融部门）。我想这是个人喜好的问题（和许可费！）。你应该安全地选择任何一个。请注意，Oracle Enterprise Linux 几乎是 Red Hat 的重新打包版本。如果您想免费试用 Red Hat 衍生产品~~，~~请尝试 CentOS。但是，CentOS 并未得到 Oracle 的正式支持。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-29T23:22:39.617

根据我的经验，Windows 上的 Oracle 的主要问题是 Windows 文件锁定的结果。例如，如果数据库正在运行，而 Oracle 的数据文件被另一个进程（即文件系统备份代理）锁定，我们就会遇到文件损坏的情况。

另一方面，Unix/Linux 似乎没有这些问题（根据我们的 DBA）。

一般来说，如果采取措施确保文件不会被其他进程锁定，我在 Windows 平台上使用 Oracle 并没有什么大问题。我们现在使用 RMAN 执行在线备份并从文件系统备份中排除所有 Oracle 数据文件。2年多来一直非常稳定。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-12-02T15:26:44.423

我已经在这两个平台上使用 Oracle 好几年了。我更喜欢 Linux，因为：

1.  甲骨文在 Windows 上发布补丁、新版本，有时甚至是 Linux 的安全更新，但这些更新在 Windows 上可用 - 通常大约有两个月的延迟。
2.  我们的 Windows 服务器偶尔会崩溃或锁定，并且经常需要重新启动才能安装补丁。Oracle 本身运行良好，但 Oracle 无法在停机的机器上继续运行。在 Linux 上，这对我来说不是问题。
3.  Oracle 与 Vista 的用户访问控制的交互是一场噩梦。我经常发现用于安装 Oracle 的专用 Oracle 用户帐户仍然缺乏编辑甚至查看 Oracle 生成的文件（例如新生成的日志文件）的权限。可能是我犯了一些错误，但权限不应该令人困惑；在 Linux 上，它们不是。（大多数服务器不运行 Vista，但我担心这预示着未来版本的 Windows Server。）
4.  多亏了 Windows 注册表，从 Windows 中干净地删除安装的 Oracle 既棘手又乏味。不过，自 10g 版以来，Oracle 安装程序在这方面做得更好。
5.  更好的工具。Linux *find*比任何本地 Windows 搜索工具都要好得多。此外，Oracle 使用并生成大量纯文本文件，Linux 提供了更好的处理文本文件的工具——良好的文本编辑器（不像记事本）、shell 命令（如 grep）。您可以尝试通过在 Windows 机器上安装 Geanie、Cygwin、Google Desktop 等来赶上 Windows，但最好不必这样做（特别是因为 Cygwin 安装对新手并不完全友好）。

我只能想到一个 Windows 优于 Linux 的优势：

1.  在 Oracle 的命令行工具（如 sqlplus、rman 等）中，您可以使用向上和向下箭头键滚动并重新运行过去的命令 - 但仅限于 Windows。您可以在 Linux 上通过安装*rlwrap*并始终调用 rlwrap 下的 Oracle 工具来解决此问题：“rlwrap sqlplus me/mypassword@myinstance”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-18T16:15:35.567

我在 Windows 和 Linux 上都安装过 Oracle，它们都按预期工作。从技术上讲，您几乎可以在每个版本的 Linux 上安装 Oracle，但如果您想要官方支持，您必须遵守 Oracle 支持的发行版列表。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-02-18T18:41:54.420

早在 2008 年，CS​​C 研究员 Steve Ries 就写了一篇关于这个主题的论文“头对头：Windows 和 Linux 作为 Oracle 数据库平台的比较”。

本质上，他在相同的硬件上构建了两台服务器（戴尔 6800、16 GB RAM、四个具有超线程的 3166 MHz 处理器），安装了 Windows Server 2003 和 RHEL 3（更新 4）。在安装 Oracle 10g 并导入相同的数据集后，他进行了一系列旨在测试吞吐量和资源利用率的实验。

他的发现表明，Linux 上的 Oracle 经历了：

> *   SQL 转换语句运行速度提高 30%，CPU 减少 6%
> *   运行速度提高 160% 的高 I/O 插入/选择
> *   使用具有几乎线性可扩展性的并行性的语句导致两倍的性能
> *   出口速度提高了 300%

当然，该实验是在 5 年前使用已经（当时）4 或 5 岁的软件进行的。所以把它当作它的价值，但它至少给你一些指标来观察，以确定 11g 在今天每个操作系统的更新版本上的表现如何。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-30T06:56:08.937

当我在 Oracle 的开发 + 支持部门工作时（尽管现在已经超过 7 年了），我所知道的一切都在 Solaris 上运行。我知道他们现在运行 Solaris/Linux 混合。

我希望 Oracle 会选择最合适的 O/S 来运行他们自己的系统来运行......

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-30T15:20:51.843

在这里您可以下载适用于 linux 的 Oracle 11 安装文件。32 和位可用。RedHat 是安装 oracle 最简单的发行版之一，但 RedHat 的不同版本（以及 Fedora 核心的不同版本）之间存在一些差异，因此请搜索您没有任何正确的“逐步”文档设置过程中的经验。

[http://www.oracle.com/technology/software/products/database/index.html](http://www.oracle.com/technology/software/products/database/index.html)

祝你好运 ;）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-30T18:39:26.903

你也会成为 DBA 吗？还是开发一个应用程序会影响甲骨文而其他人不得不担心管理职责？

如果是前者，那么您可以在 Windows 上使用 Oracle 更快地启动和运行。

如果是后者，那么在 linux 上使用 Oracle。你必须习惯命令行，但是一旦你习惯了，在 linux 上管理你的数据库将会更容易和更强大。保持其平稳运行、归档数据、导入数据的日常任务——所有这些都通过命令行变得更容易。

我的团队有 100 多台服务器要管理，Windows 和 unix 变体上混合了 SQL、Sybase 和 Oracle。到目前为止，Linux 上的 Oracle 给我们带来的问题最少。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-29T23:18:13.217

您可以在任何版本的 Linux 上安装 Oracle。RPM（RedHat 包管理器）中只有一个版本，便于安装。对于其他变体，安装稍微手动一些。

我要提到的另一件事是，除非您需要成熟的 Oracle，否则请坚持使用 Oracle XE（快捷版）。您实际上可以在限制范围内将其用于商业用途（例如，我认为它仅使用一个内核和最多 4GB 的数据）。但特别是对于 Windows，它带有一个简单的安装过程和基于 HTML 的管理工具（有点类似于 MySQLAdmin）。

对于高端平台，Linux/Unix 往往比 Windows 更受欢迎，但这对您来说可能不是问题。如果您只是在开发并且对 Oracle 还不熟悉，请尽可能让自己轻松并坚持使用 Windows 和 Oracle XE。

我的经验是，我们使用 Windows 作为服务器平台只是因为我们不得不这样做（例如运行 SQL Server、Exchange 或其他），而不是因为我们想要这样做。这同样适用于 Oracle，我曾经使用过的每个 Oracle 安装都在 Solaris 或 Linux 变体（主要是 Red Hat，但也有 Ubuntu）上。

操作系统的成本是这样做的唯一理由。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T23:41:42.223

我的最后一项工作是，我们从 Windows 迁移到 OpenSuse 11。

我在安装过程中花了一天时间（仅 4 小时才出现 oracle 设置的第一个屏幕）但现在用户确认我所有查询的时间现在更好，所以我推荐它。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-11-18T16:11:20.940

我们在我们的商店中同时在 Windows 和 Linux 上运行 Oracle 实例，Oracle 在 Linux 上的响应速度肯定比 Windows 上更快。我在本地运行 Oracle XE，我不得不转移到 Linux，因为在 Windows 上，Oracle 瘫痪了我的机器。

我们还遇到了与在 Windows 上运行的 Oracle 进行 SSL 连接的问题。在 Windows 上使用 SSL 的网络流量（经常导致应用程序挂起）比在 Linux 上慢至少 20 倍。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-04T11:50:18.740

我认为只要该平台得到 Oracle 的支持，可能不会有太大的不同。但是，如果您需要扩展 - 就像非常非常大 - 没有什么可以与 Solaris 相比。不过，没有太多公司需要它。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-04-30T20:39:44.510

这里有一些关于在 linux 上安装 oracle 的很好的参考。

[http://www.oracle-base.com/articles/10g/Articles10g.php#DB10gInstallations](http://www.oracle-base.com/articles/10g/Articles10g.php#DB10gInstallations)

[http://www.oracle-base.com/articles/11g/Articles11g.php#db11g_release_1_installations](http://www.oracle-base.com/articles/11g/Articles11g.php#db11g_release_1_installations)

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2009-05-04T11:44:48.740

ORACLE可以安装在linux上……但是不支持rhel 4……应该是rhel 5

# .net - .NET WebRequest/WebResponse 能否正确翻译重音符号、变音符号和实体？

> ID：804722
> 
> 赞同：0
> 
> 时间：2009-04-29T23:13:29.920
> 
> 标签：.net, string, screen-scraping, translation, webrequest

我使用 .NET 的 WebRequest 将自己的页面作为临时黑客“屏幕抓取”。

这很好用，但重音字符和变音字符不能正确翻译。

我想知道是否有一种方法可以使用.NET 的许多内置属性和方法使它们正确翻译。

这是我用来抓取页面的代码：

```
private string getArticle(string urlToGet)
{

    StreamReader oSR = null;

    //Here's the work horse of what we're doing, the WebRequest object 
    //fetches the URL
    WebRequest objRequest = WebRequest.Create(urlToGet);

    //The WebResponse object gets the Request's response (the HTML) 
    WebResponse objResponse = objRequest.GetResponse();

    //Now dump the contents of our HTML in the Response object to a 
    //Stream reader
    oSR = new StreamReader(objResponse.GetResponseStream());

    //And dump the StreamReader into a string...
    string strContent = oSR.ReadToEnd();

    //Here we set up our Regular expression to snatch what's between the 
    //BEGIN and END
    Regex regex = new Regex("<!-- content_starts_here //-->((.|\n)*?)<!-- content_ends_here //-->",
        RegexOptions.IgnoreCase);

    //Here we apply our regular expression to our string using the 
    //Match object. 
    Match oM = regex.Match(strContent);

    //Bam! We return the value from our Match, and we're in business. 
    return oM.Value;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T23:25:21.437

尝试使用：

System.Net.WebClient client = new System.Net.WebClient();
字符串 html = client.DownloadString(urlToGet);
字符串解码 = System.Web.HttpUtility.HtmlDecode(html);

另外，请查看 client.Encoding

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-08T19:18:18.497

还有另一种处理方法，使用 StreamReader 构造函数的第二个参数，如下所示：

```
new StreamReader(webRequest.GetResponse().GetResponseStream(), 
                 Encoding.GetEncoding("ISO-8859-1")); 
```

那会成功的。

# .net - Path.Combine 的安全版本

> ID：804735
> 
> 赞同：2
> 
> 时间：2009-04-29T23:17:24.733
> 
> 标签：.net, relative-path, path-manipulation

我有一个`rootPath`我信任的和一个`relativePath`我不信任的。我想以这样一种方式组合它们，以便我可以确定结果低于`rootPath`并且用户不能使用`..`返回起点。我*确实*希望相对路径允许以下内容：`hello\..\world`==`world`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T23:31:06.760

[System.IO.Path.GetFullPath](http://msdn.microsoft.com/en-us/library/system.io.path.getfullpath.aspx)？

扩展：使用 Path.Combine，然后对结果调用 GetFullPath 并检查该结果是否以 rootPath 开头。

它不会保护您免受硬链接的影响，但它应该可以捕获简单的东西，例如双点。

以上代码：

```
string Resolve(string fileName)
{
    string root = FileRoot();
    string ret = Path.GetFullPath(Path.Combine(root, fileName));
    if (ret.StartsWith(root.TrimEnd(Path.DirectorySeparatorChar) + Path.DirectorySeparatorChar)) return ret;
    throw new ArgumentException("path resolved to out of accesable directroy");
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T23:33:15.397

您可以致电`Path.GetFullPath()`并检查它是否以您信任的开头`rootPath`。如果您倾向于偏执，请检查是否`rootPath`有根。

```
public Boolean IsPathSafe(String rootPath, String relativePath)
{
  return rootPath.EndsWith(Path.DirectorySeparatorChar.ToString()) &&
    Path.IsPathRooted(rootPath) &&
    Patch.Combine(rootPath, relativePath).GetFullPath().StartsWith(rootPath);
} 
```

有关第一个测试的解释，请参阅 Alex Martelli 对 technophile 回答的评论。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-29T23:26:10.170

您可以做的一件事是计算反斜杠 ( `\`) 和双点 ( `..`) 的数量，并确保双点的数量小于反斜杠的数量。为了超越`rootPath`文件夹结构中的 s ，您至少需要与双点一样多的反斜杠 - 因此，如果您只允许`relativePath`s 至少多了一个反斜杠，那么您应该是安全的。

# mysql - 使用 JMeter 在 Web 应用程序中测试并发和/或事务完整性

> ID：804740
> 
> 赞同：1
> 
> 时间：2009-04-29T23:18:55.413
> 
> 标签：mysql, concurrency, transactions, myisam, data-integrity

我对在数据库中使用多个线程相当陌生（我的大部分职业生涯都花在了前端）。

今天我尝试测试我编写的一个简单的 php 应用程序，该应用程序使用 ISAM 表模拟使用表锁定的事务将值存储在 mysql 数据库中。

我刚刚写了一篇关于这里的程序的博客文章：

[使用 JMeter 进行测试](http://leeand00.tiddlyspot.com/#[[Testing%20With%20JMeter]])

从我的结果来看，我的简单 php 应用程序似乎保持了事务完整性（从我的 csv 文件中的数据与我从数据库中重新提取的数据相同）：

# CSV 文件：

![al 的 alt csv](https://i9.photobucket.com/albums/a58/Maskkkk/AL_CSV_Data.png) ![用于 bl 的 alt csv](https://i9.photobucket.com/albums/a58/Maskkkk/BL_CSV_Data.png)

# JMeter测试运行后查询两个用户的数据：

![alt](https://i9.photobucket.com/albums/a58/Maskkkk/AL_Query_Result.png) ![alt](https://i9.photobucket.com/albums/a58/Maskkkk/BL_Query_Result.png)

我是否正确地假设事务数据完整性是完整的？

你如何测试并发性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T02:51:54.170

为什么不使用 InnoDB 并在没有手动表锁的情况下获得相同的效果？

另外，你在保护什么？考虑两个用户（Bill 和 Steve）：

1.  比尔加载记录 1234
2.  史蒂夫加载记录 1234
3.  Steve 更改记录 1234 并提交
4.  Bill 稍等片刻，然后更新陈旧记录 1234 并提交。这些变化重创了比尔。

表锁定不提供比本地 MyISAM 表锁定更高的数据完整性。当需要停止数据损坏时，MyISAM 将本机锁定表文件。

事实上，使用 InnoDB 而不是 MyISAM 的原因是它会做行锁定而不是表锁定。它还支持事务。对不同记录的多次更新不会相互阻塞，对多条记录的复杂更新将被阻塞，直到事务完成。

您需要考虑在您的应用程序中同时发生对同一记录的两次更新的可能性。如果有可能，表/行锁定不会阻止第二次更新，它只会推迟它直到第一次更新完成。

*编辑*

据我记得，MyISAM 对插入有一种特殊的行为。它根本不需要为插入锁定表，因为它只是附加到表的末尾。对于具有唯一索引或非自动增量主键的表，这可能不是真的。

# c# - 数据映射器、表数据网关（网关）、数据访问对象（DAO）和存储库模式有什么区别？

> ID：804751
> 
> 赞同：139
> 
> 时间：2009-04-29T23:25:29.207
> 
> 标签：c#, repository, dao, datamapper, table-data-gateway

我正在努力提高我的设计模式技能，我很好奇这些模式之间有什么区别？它们看起来都是一样的——封装特定实体的数据库逻辑，因此调用代码不知道底层持久层。根据我的简短研究，它们通常都实现了您的标准 CRUD 方法并抽象出特定于数据库的细节。

除了命名约定（例如 CustomerMapper vs. CustomerDAO vs. CustomerGateway vs. CustomerRepository）之外，有什么区别（如果有的话）？如果有区别，你什么时候会选择一个而不是另一个？

在过去，我会编写类似于以下的代码（自然是简化了 - 我通常不会使用公共属性）：

```
public class Customer
{
    public long ID;
    public string FirstName;
    public string LastName;
    public string CompanyName;
}

public interface ICustomerGateway
{
    IList<Customer> GetAll();
    Customer GetCustomerByID(long id);
    bool AddNewCustomer(Customer customer);
    bool UpdateCustomer(Customer customer);
    bool DeleteCustomer(long id);
} 
```

并有一个`CustomerGateway`为所有方法实现特定数据库逻辑的类。有时我不会使用接口并将 CustomerGateway 上的所有方法都设为静态（我知道，我知道，这使得它的可测试性降低）所以我可以这样称呼它：

```
Customer cust = CustomerGateway.GetCustomerByID(42); 
```

这似乎与 Data Mapper 和 Repository 模式的原则相同；DAO 模式（我认为这与网关相同？）似乎也鼓励特定于数据库的网关。

我错过了什么吗？有 3-4 种不同的方式来做同样的事情似乎有点奇怪。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-05-02T09:12:16.080

您的示例条款；DataMapper、DAO、DataTableGateway 和 Repository，都有类似的目的（当我使用一个时，我希望得到一个 Customer 对象），但不同的意图/含义和结果实现。

**存储库** *“就像一个集合，除了具有更精细的查询能力”* [埃文斯[，领域驱动设计](http://domaindrivendesign.org/books/evans_2003)]并且可以被视为*“内存外观中的对象”*（[存储库讨论](http://geekswithblogs.net/gyoung/archive/2006/05/03/77171.aspx)）

DataMapper “在对象和数据库**之间** *移动数据，同时保持它们彼此独立以及映射器本身”*（[Fowler，PoEAA，Mapper](http://martinfowler.com/eaaCatalog/dataMapper.html)）

**TableDataGateway**是“到数据库表的*网关（封装对外部系统或资源的访问的对象）。一个实例处理表中的所有行*”（[Fowler，PoEAA，TableDataGateway](http://martinfowler.com/eaaCatalog/tableDataGateway.html)）

**DAO** “将*数据资源的客户端接口与其数据访问机制分离/将特定数据资源的访问 API 适配为通用客户端接口”*，允许*“数据访问机制独立于使用数据的代码进行更改”*（[Sun Blueprints](http://www.oracle.com/technetwork/java/dao-138818.html)）

存储库似乎非常通用，没有暴露数据库交互的概念。DAO 提供了一个接口，可以使用不同的底层数据库实现。TableDataGateway 特别是单个表的瘦包装器。DataMapper 充当中介，使模型对象能够独立于数据库表示（随着时间的推移）而发展。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-05-02T08:41:33.017

软件设计界有一种趋势（至少，我是这么认为的）为众所周知的旧事物和模式发明新名称。当我们有一个新的范式（可能与已经存在的东西略有不同）时，它通常会为每一层提供一整套新名称。所以“业务逻辑”变成了“服务层”，因为我们说我们做 SOA，而 DAO 变成了存储库，因为我们说我们做 DDD（实际上每一个都不是新的和独特的东西，但同样：新名称对于收集在同一本书中的已知概念）。所以我并不是说所有这些现代范式和首字母缩略词都意味着完全相同的东西，但你真的不应该对此过于偏执。这些大多是相同的模式，只是来自不同的家庭。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2013-06-24T14:41:50.777

[数据映射器与表数据网关](https://github.com/willdurand-edu/php-slides/blob/master/src/common/09_databases.md) 长话短说：

*   数据映射器将接收域模型对象（实体）作为参数，并将使用它来实现 CRUD 操作*   表数据网关将接收方法的所有参数（作为原语），并且不会知道有关域模型对象（实体）的任何信息。

    最后，它们都将充当内存对象和数据库之间的中介。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-30T00:03:33.047

你有一个很好的观点。选择一个你最熟悉的。我想指出一些可能有助于澄清的事情。

表数据网关主要用于单个表或视图。它包含所有的选择、插入、更新和删除。因此，在您的情况下，客户是表或视图。因此，表数据网关对象的一个​​实例处理表中的所有行。通常这与每个数据库表的一个对象有关。

虽然 Data Mapper 更独立于任何域逻辑并且耦合较少（尽管我相信存在耦合或不耦合）。它只是一个中间层，用于在对象和数据库之间传输数据，同时保持它们彼此独立以及映射器本身。

因此，通常在映射器中，您会看到诸如插入、更新、删除之类的方法，而在表数据网关中，您会发现 getcustomerbyId、getcustomerbyName 等。

数据传输对象与上述两种模式不同，主要是因为它是一种分布模式，而不是上述两种模式的数据源模式。主要在您使用远程接口并且需要减少通话时使用它，因为每次通话都会变得昂贵。因此，通常设计一个可以通过线路进行序列化的 DTO，可以将所有数据传回服务器以应用进一步的业务规则或处理。

我不精通存储库模式，因为直到现在我还没有机会使用，但会查看其他答案。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-04-13T18:35:51.230

以下只是我的理解。

**TableGateWay/RowDataGateWay**：在这种情况下，网关是指一个特定的实现，它具有每个“域对象”映射到每个“域对象网关”。例如，如果我们有*Person*，那么我们将有一个*PersonGateway*来将域对象 Person 存储到数据库中。如果我们有 Person、Employee、Customer 等，我们将有 PersonGateway、EmployeeGateway 和 CustomerGateway。每个网关都会对该对象具有特定的 CRUD 功能，并且与其他网关无关。这里没有可重用的代码/模块。网关可以进一步分为 RowDataGateway 或 TableGateway，取决于您传递的是“id”还是“object”。网关通常与活动记录进行比较。它将您的域模型与数据库模式联系起来。

**Repository/DataMapper/DAO**：它们是一样的。它们都指将数据库实体传输到域模型的持久层。与网关不同，Repository/DataMapper/DAO 隐藏了实现。你不知道Person后面是否有PersonGateway。它可能会，也可能不会，你不在乎。您所知道的是它必须为每个域对象支持 CRUD 操作。它将数据源和域模型解耦。

# regex - 当我在 PowerShell 中选择字符串（grep）时，如何只返回匹配的正则表达式？

> ID：804754
> 
> 赞同：55
> 
> 时间：2009-04-29T23:26:33.273
> 
> 标签：regex, powershell, grep

我正在尝试在文件中查找模式。当我使用`Select-String`我不想要整行得到匹配时，我只想要匹配的部分。

有没有我可以用来执行此操作的参数？

例如：

如果我这样做了

```
select-string .-.-. 
```

该文件包含一行：

```
abc 1-2-3 abc 
```

我想得到一个只有**1-2-3**的结果，而不是返回整行。

我想知道 Powershell 相当于`grep -o`

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-01T18:06:59.423

要不就：

```
Select-String .-.-. .\test.txt -All | Select Matches 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-04-30T00:25:46.270

大卫走在正确的道路上。[regex] 是 System.Text.RegularExpressions.Regex 的类型加速器

```
[regex]$regex = '.-.-.'
$regex.Matches('abc 1-2-3 abc') | foreach-object {$_.Value}
$regex.Matches('abc 1-2-3 abc 4-5-6') | foreach-object {$_.Value} 
```

如果太冗长，您可以将其包装在一个函数中。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-04-30T06:52:02.113

我尝试了其他方法： Select-String 返回可以使用的属性匹配项。要获取所有匹配项，您必须指定 -AllMatches。否则它只返回第一个。

我的测试文件内容：

```
test test1 alk atest2 asdflkj alj test3 test
test test3 test4
test2 
```

剧本：

```
select-string -Path c:\temp\select-string1.txt -Pattern 'test\d' -AllMatches | % { $_.Matches } | % { $_.Value } 
```

返回

```
test1 #from line 1
test2 #from line 1
test3 #from line 1
test3 #from line 2
test4 #from line 2
test2 #from line 3 
```

[在 technet.microsoft.com 上选择字符串](http://technet.microsoft.com/en-us/library/dd315403.aspx)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-30T15:19:28.943

本着[教人钓鱼](https://en.wikiquote.org/wiki/Chinese_proverbs#Sh)的精神...

您要做的是将 select-string 命令的输出通过管道传输到**Get-member**，这样您就可以看到对象具有哪些属性。完成此操作后，您将看到“匹配项”，您可以通过将输出管道传输到`| **Select-Object** Matches`.

我的建议是使用类似的东西：选择行号，文件名，匹配

例如：关于 stej 的样本：

```
sls .\test.txt -patt 'test\d' -All |select lineNumber,fileName,matches |ft -auto

LineNumber Filename Matches
---------- -------- -------
         1 test.txt {test1, test2, test3}
         2 test.txt {test3, test4}
         3 test.txt {test2} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2018-06-25T19:36:24.467

以上答案都不适合我。下面做了。

```
Get-Content -Path $pathToFile | Select-String -Pattern "'test\d'" | foreach {$_.Matches.Value}

Get-Content -Path $pathToFile | # Get-Content will divide into single lines for us

Select-String -Pattern "'test\d'" | # Define the Regex 
```

foreach {$_.Matches.Value} # 只返回 Object 的 Matches 字段的值。（这允许多个结果匹配。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2021-06-23T18:00:57.107

代替管道，`%`或者`select`您可以使用更简单的`.prop` [成员枚举](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_arrays#member-enumeration)语法，它神奇地适用于多个元素：

```
(Select-String .-.-. .\test.txt -All).Matches.Value 
```

或更少的括号：

```
$m = Select-String .-.-. .\test.txt -All
$m.Matches.Value 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-05-11T17:32:35.330

如果您不想使用 ForEach 运算符，则只能使用管道和`Select -Expand`

例如，要仅获取 之后的路径`C:\`，您可以使用：

```
Get-ChildItem | Select-String -Pattern "(C:\\)(.*)" | Select -Expand Matches | Select -Expand Groups | Where Name -eq 2 | Select -Expand Value 
```

`Where Name -eq 2`只选择指定的正则表达式模式的第二个匹配项。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T23:42:22.770

您可以使用 System.Text.RegularExpressions 命名空间：

[http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.aspx](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.aspx)

# vb.net - 时间的背包算法

> ID：804755
> 
> 赞同：0
> 
> 时间：2009-04-29T23:27:36.160
> 
> 标签：vb.net, algorithm, collections, knapsack-problem

我正在使用 VB.NET，我正在尝试提出一些算法或一些伪代码，或者一些 VB.NET 代码，它们可以让我执行以下操作（希望我能很好地解释这一点）：

我有 2 个集合对象，Cob1 和 Cob2。这些集合对象存储实现称为 ICob 的接口的对象。ICob 有 3 个属性。一个布尔值 IsSelected 属性、一个名为 Length 的属性，它返回一个 TimeSpan，以及一个 Rating 属性，它是一个短整数。

好的，现在 Cob1 有大约 100 个对象存储在集合中，而 Cob2 是一个空集合。我想要做的是从 Cob1 中选择对象并将它们复制到 Cob2。我希望在选择对象时遵守以下规则：

1.  我希望能够指定一个时间跨度，并且我希望选择足够多的对象以适应我指定的时间跨度（基于 Length 属性）。例如，如果我将 10 分钟的时间跨度传递给我的函数，它应该选择足够多的对象来填满整个 10 分钟的窗口，或者尽可能接近填满它。

2.  不应选择任何对象两次。

3.  具有较高等级（通过等级属性）的对象应该比其他对象更有可能被拾取。

4.  不应再次选择在过去 30 分钟内已选择的任何对象（以便每个对象最终将至少被选择一次），无论评级如何。

谁能给我一些关于如何实现这一目标的提示？提示可以是心理过程、VB.NET 示例代码、伪代码或任何其他可能对我有帮助的形式。

谢谢

编辑：

如果我透露我在现实生活中想要做的事情，也许这会对每个人都有帮助。

我正在为一个广播电台编写软件，它会自动选择要播放的音乐和广告，有点像计算机化的程序管理器。

长度表示声音字节（歌曲或广告）的长度，评级就是这样。如果这首歌很受欢迎，它会获得更多的播放时间。如果广告商支付更多的钱，那么它也会获得更多的播出时间。

所以我的程序应该选择播放20分钟左右的歌曲，然后选择一些广告播放5分钟左右。

希望这会有所帮助。

感谢大家的投入！

艾伦

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T23:40:21.243

注意：

限制 1 来自经典的[背包问题](http://en.wikipedia.org/wiki/Knapsack_problem)，该问题适用于集合，如限制 2 所要求的。

限制 3 相当模糊。是价值高还是寿命覆盖率高？如果您没有指定最大化的目标函数（或者，准确地说，有两个：寿命本身和速率），则有一些帕累托最优解。

限制 4 可以通过制作地图对象 -> last time selected. 来实现，以黑名单的形式。

长话短说：首先我会通过限制 4 将对象列入黑名单来过滤集合，然后应用背包算法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T23:34:13.397

为了实施 4.，我相信您需要保存上次选择 Cob 的日期/时间。然后，我将按以下步骤进行：

1.  过滤掉过去 30 分钟内没有被选中的那些。

2.  按评级排序并将您的“光标”设置在列表中的第一项上。

3.  检查项目的时间跨度。如果足够短以适应指定的时间，请选择它。如果没有，请转到 3 并继续下一项。

4.  检查您的时间跨度是否已填满。如果是，你就完成了。如果否，请转到 3 并继续下一项。

# ruby-on-rails - 在资源有限的情况下使用 Ruby on Rails 开发是否可行？

> ID：804760
> 
> 赞同：1
> 
> 时间：2009-04-29T23:29:17.497
> 
> 标签：ruby-on-rails

我不知道 Ruby on Rails，我想学习它做一些事情。有人向我提出了一个非常小的项目，我想知道是否可以在 Ruby on Rails 中实现它，因为我的资源有限。

我应该编程的办公室根本没有互联网连接，而且硬件已经使用了几年（Intel Celeron 2.63 GZ，512 MB RAM，80 GB 硬盘）。另外，操作系统是WinXP，使用Linux的机会很小。无法更新这些资源，所以我必须尽我所能。

由于我从来没有对 Rails 做过任何事情，考虑到有限的资源，你认为用它来实现系统是否可行？

我可以选择用我想要的任何东西进行开发，但我真的很想用 Rails 来做。我要做的系统是传统的学校系统，在第三世界的公立学校管理学生档案、他们的帮助和评分。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T23:33:39.373

你应该没事的。

最坏的情况是你的内存用完了，要解决这个问题，你可能会在那台机器上加载 Linux。

如果您正在从事涉及大量 Web 工作和数据库工作的工作，那么使用 rails 是一个不错的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T23:36:06.670

这取决于服务器的繁忙程度。硬件听起来很适合轻量级使用，每秒可能有几个查询。除非它是一所巨大的学校，否则这似乎是合理的。

您当然可以使用运行速度更快的不同平台（也许是 PHP），但是一旦您熟悉了 Rails 的开发方式，Rails 的开发速度会更快、更友好，而且我认为性能不会成为小型系统的问题。

（哦，如果可以的话，安装 Linux。像许多开源系统一样，Ruby 在 Unix 操作系统上比在 Windows 上得到更多的使用和开发关注，所以它往往在它们上工作得更好。Linux 也可以更有效地使用较少的硬件。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T23:40:46.877

查看[Baobab 项目](http://www.baobabhealth.org/)。他们一直在非常硬件和带宽受限的情况下使用 Rails——马拉维的健康诊所。

# mysql - 从其他机器连接到 MySQL

> ID：804772
> 
> 赞同：2
> 
> 时间：2009-04-29T23:33:31.450
> 
> 标签：mysql, windows-server-2003, database-connection

我在我们域的 Windows 2003 服务器上安装了 MySQL。我无法从域中的其他机器连接到它。我打开 MySQL 管理员面板并尝试将服务器名称从 localhost 更改为它无法识别的机器名称。我也尝试过完全限定名称。有什么想法我需要改变吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T23:39:15.913

什么样的错误，完全无法连接？Windows 防火墙是我要查看的第一个地方，以确保端口 3306 已打开。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T23:41:43.037

你有没有使用类似的东西仔细检查数据库的权限

`grant all priviliges on 'database'.'*' to 'username'@'remote_machine_ip' identified by 'password';`

就像 Sukasa 提到的那样，还要仔细检查您可能已配置的任何防火墙

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T23:41:39.353

您需要查看 my.cnf 文件并查找`bind-address`设置和`skip-networking`设置。您希望后者被删除或注释掉，而前者是机器的 IP 地址。进行更改后重新启动 MySQL。

许多 MySQL 安装包默认为仅本地套接字安装，这有助于安全性，但会大大削弱网络连接性。:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T01:49:44.023

我试图使用默认的 root 用户 ID 连接到数据库。我创建了一个新用户并授予该用户对所需表的读取权限。

# c++ - 在 for 循环中倒计时

> ID：804777
> 
> 赞同：9
> 
> 时间：2009-04-29T23:35:24.003
> 
> 标签：c++, for-loop

我相信（从一些研究阅读中）在 for 循环中倒计时实际上在运行时更有效和更快。我的完整软件代码是 C++

我目前有这个：

```
for (i=0; i<domain; ++i) { 
```

我的“我”是未签名的注册整数，“域”也是未签名的整数

在 for 循环中 i 用于遍历数组，例如

```
array[i] = do stuff 
```

将其转换为倒计时会打乱我例程的预期/正确输出。

我可以想象答案是微不足道的，但我无法理解它。

更新：“做事”不依赖于之前或之后的迭代。for 循环中的计算与 i 的迭代无关。（我希望这是有道理的）。

更新：为了使用我的 for 循环实现运行时加速，我是否要倒计时，如果是这样，在删除我的 int 时删除无符号部分，或者其他什么方法？

请帮忙。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-30T00:20:48.043

只有一种使用无符号计数器向后循环的正确方法：

```
for( i = n; i-- > 0; )
{
    // Use i as normal here
} 
```

这里有一个技巧，对于最后一次循环迭代，你将在循环顶部有 i = 1，i--> 0 通过，因为 1 > 0，然后 i = 0 在循环体中。在下一次迭代中 i-- > 0 失败，因为 i == 0，所以后缀减量在计数器上滚动并不重要。

我知道非常不明显。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-29T23:44:16.587

我猜你的向后 for 循环看起来像这样：

```
for (i = domain - 1; i >= 0; --i) { 
```

在这种情况下，因为`i`是**unsigned**，它**总是**大于或等于零。当你减少一个等于零的无符号变量时，它会环绕到一个非常大的数字。解决方案是进行`i`签名或更改 for 循环中的条件，如下所示：

```
for (i = domain - 1; i >= 0 && i < domain; --i) { 
```

`domain`或从to`1`而不是 from `domain - 1`to计数`0`：

```
for (i = domain; i >= 1; --i) {
    array[i - 1] = ...; // notice you have to subtract 1 from i inside the loop now
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-29T23:47:44.783

这不是您问题的答案，因为您似乎没有问题。

这种优化完全无关紧要，应该留给编译器（如果有的话）。

您是否分析过您的程序以检查您的 for 循环是否是瓶颈？如果没有，那么您无需花时间担心这一点。更重要的是，从性能的角度来看，将“i”作为“寄存器”int，就像你写的那样，没有真正的意义。

即使不知道您的问题域，我也可以向您保证，反向循环技术和“注册”int 计数器对您的程序性能的影响可以*忽略不计。*请记住，“过早的优化是万恶之源”。

也就是说，更好的优化时间应该是考虑整体程序结构、使用的数据结构和算法、资源利用率等。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-29T23:39:15.537

检查一个数字是否为零可能比比较更快或更有效。但这是你真正不应该担心的那种微优化——几个时钟周期将与几乎任何其他性能问题相形见绌。

在 x86 上：

```
dec eax
jnz Foo 
```

代替：

```
inc eax
cmp eax, 15
jl Foo 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-30T02:44:16.637

*它与向上*或*向下*计数无关。可以更快的是**向零**计数。[Michael 的回答](https://stackoverflow.com/questions/804777/counting-down-in-for-loops/804792#804792)说明了原因——x86 为您提供了与零的比较，这是许多指令的隐含副作用，因此在调整计数器后，您只需根据结果进行分支，而不是进行显式比较。（也许其他架构也这样做；我不知道。）

Borland 的 Pascal 编译器因执行该优化而臭名昭著。编译器转换此代码：

```
for i := x to y do
  foo(i); 
```

变成更类似于这样的内部表示：

```
tmp := Succ(y - x);
i := x;
while tmp > 0 do begin
  foo(i);
  Inc(i);
  Dec(tmp);
end; 
```

（我说臭名昭著不是因为优化影响循环的结果，而是因为调试器错误地显示了计数器变量。当程序员检查`i`时，调试器可能会显示的值`tmp`相反，给那些认为他们的循环正在向后运行。）

这个想法是，即使有额外的`Inc`或`Dec`指令，在运行时间方面，它仍然是一个净胜，超过了明确的比较。**你是否真的能*注意到*这种差异还有待商榷。**

但请注意，转换是编译器会*自动*执行的操作，具体取决于它是否认为转换值得。**编译器通常比你更擅长优化代码，所以不要花太多精力与它竞争。**

无论如何，你问的是 C++，而不是 Pascal。C++“for”循环不像Pascal“for”循环那样容易应用优化，因为Pascal循环的边界总是在循环运行之前完全计算，而C++循环有时取决于停止条件和循环内容。C++ 编译器需要做一些静态分析来确定任何给定的循环是否可以满足 Pascal 循环无条件适用的转换类型的要求。如果 C++ 编译器进行分析，那么它可以进行类似的转换。

没有什么能阻止您以自己的方式编写循环：

```
for (unsigned i = 0, tmp = domain; tmp > 0; ++i, --tmp)
  array[i] = do stuff 
```

这样做*可能*会使您的代码运行得更快。不过，就像我之前说的，你可能不会注意到。像这样手动安排循环所付出的更大代价是你的代码不再遵循既定的习惯用法。你的循环是一个非常普通的“for”循环，但它不再*像*一个循环——它有两个变量，它们以相反的方向计数，其中一个甚至没有在循环体中使用——所以任何阅读你的人代码（包括你，一个星期，一个月或一年后你忘记了你希望实现的“优化”）将需要花费额外的努力向自己证明循环确实是一个普通的循环变相。

（你有没有注意到我上面的代码使用了无符号变量，没有回零的危险？使用两个单独的变量可以做到这一点。）

从这一切中带走三件事：

1.  让优化器完成它的工作；总的来说，它比你更擅长。
2.  让普通代码看起来很普通，这样特殊代码就不必为了获得审查、调试或维护它的人的注意而竞争。
3.  在测试和分析表明它是必要的之前，不要以性能的名义做任何花哨的事情。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T23:39:12.137

如果你有一个体面的编译器，它会优化“向上计数”，就像“向下计数”一样有效。只需尝试一些基准测试，您就会看到。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-29T23:50:02.250

所以你“读到”计算下来更有效率？除非您向我展示一些分析器结果和代码，否则我很难相信这一点。我可以在某些情况下购买它，但在一般情况下，不能。在我看来，这是一个过早优化的经典案例。

您对“register int i”的评论也很有说服力。如今，编译器总是比你更清楚如何分配寄存器。除非您已经对代码进行了概要分析，否则不要使用 register 关键字。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-29T23:51:45.197

当您循环访问任何类型的数据结构时，缓存未命中的影响远大于您前进的方向。关注内存布局和算法结构的大局，而不是琐碎的微优化。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-12-09T22:14:02.460

您可以尝试以下方法，哪个编译器将非常有效地优化：

```
#define for_range(_type, _param, _A1, _B1) \
    for (_type _param = _A1, _finish = _B1,\
    _step = static_cast<_type>(2*(((int)_finish)>(int)_param)-1),\
    _stop = static_cast<_type>(((int)_finish)+(int)_step); _param != _stop; \
_param = static_cast<_type>(((int)_param)+(int)_step)) 
```

现在你可以使用它了：

```
for_range (unsigned, i, 10,0)
{
    cout << "backwards i: " << i << endl;
}

for_range (char, c, 'z','a')
{
    cout << c << endl;
}

enum Count { zero, one, two, three }; 

for_range (Count, c, three, zero)
{
    cout << "backwards: " << c << endl;
} 
```

您可以向任何方向迭代：

```
for_range (Count, c, zero, three)
{
    cout << "forward: " << c << endl;
} 
```

循环

```
for_range (unsigned,i,b,a)
{
   // body of the loop
} 
```

将产生以下代码：

```
 mov esi,b
L1:
;    body of the loop
   dec esi
   cmp esi,a-1
   jne L1 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T23:39:23.883

给出的信息很难说，但是......反转你的数组，倒计时？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-30T03:24:39.427

Jeremy Ruten 正确地指出，使用无符号循环计数器是危险的。据我所知，这也是不必要的。

其他人也指出过早优化的危险。他们是绝对正确的。

话虽如此，这是我多年前在嵌入式系统编程时使用的一种风格，当时每个字节和每个周期都有意义。这些表格**在**我使用的特定 CPU 和编译器上对我很有用，但你的情况可能会有所不同。

```
// Start out pointing to the last elem in array
pointer_to_array_elem_type p = array + (domain - 1);
for (int i = domain - 1; --i >= 0 ; ) {
     *p-- = (... whatever ...)
} 
```

这种形式利用了在算术运算之后在**某些**处理器上设置的条件标志——在某些架构上，分支条件的递减和测试可以组合成一条指令。请注意，使用`--i`predecrement ( ) 是这里的关键 - 使用 postdecrement ( `i--`) 不会很好。

或者，

```
// Start out pointing *beyond* the last elem in array
pointer_to_array_elem_type p = array + domain;
for (pointer_to_array_type p = array + domain; p - domain > 0 ; ) {
     *(--p) = (... whatever ...)
} 
```

第二种形式利用了指针（地址）算法。这些天我很少看到这种形式`(pointer - int)`（有充分的理由），但是语言保证当你从指针中减去一个 int 时，指针会减少`(int * sizeof (*pointer))`.

我将再次强调，这些形式是否适合您取决于您​​使用的 CPU 和编译器。他们在摩托罗拉 6809 和 68000 架构上为我提供了很好的服务。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-30T07:58:25.557

在一些后来的 arm 内核中，递减和比较只需要一条指令。这使得递减循环比递增循环更有效。

我不知道为什么也没有增量比较指令。

我很惊讶这篇文章在它是一个真正的问题时被投票为-1。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-08-26T07:36:35.270

这里的每个人都专注于性能。实际上有一个合乎逻辑的理由向零迭代，这可以产生更清晰的代码。

当您通过与数组末尾交换来删除无效元素时，首先迭代最后一个元素很方便。对于不相邻的坏元素，我们可以交换到结束位置，减少数组的结束边界，并继续迭代。如果您要迭代到最后，那么与结尾交换可能会导致交换坏为坏。通过将 end 迭代为 0，我们知道数组末尾的元素已经被证明对这次迭代有效。

如需进一步解释...

如果：

1.  通过与数组的一端交换并更改数组边界以排除坏元素来删除坏元素。

然后很明显：

2.  您将换用一个好的元素，即已经在本次迭代中测试过的元素。

所以这意味着：

3.  如果我们从变量边界迭代，那么变量边界和当前迭代指针之间的元素就被证明是好的。迭代指针是 ++ 还是 -- 无关紧要。重要的是我们正在远离变量边界进行迭代，因此我们知道与其相邻的元素是好的。

所以最后：

4.  向 0 迭代允许我们仅使用一个变量来表示数组边界。这是否重要是您和您的编译器之间的个人决定。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-04-27T21:35:44.513

比你增加或减少计数器更重要的是你是增加内存还是减少内存。大多数缓存都针对增加内存而不是减少内存进行了优化。由于内存访问时间是当今大多数程序面临的瓶颈，这意味着更改程序以增加内存可以提高性能，即使这需要将计数器与非零值进行比较。在我的一些程序中，通过将代码更改为增加内存而不是减少内存，我看到了性能的显着提高。

持怀疑态度？这是我得到的输出：

```
sum up   = 705046256
sum down = 705046256
Ave. Up Memory   = 4839 mus
Ave. Down Memory =  5552 mus
sum up   = inf
sum down = inf
Ave. Up Memory   = 18638 mus
Ave. Down Memory =  19053 mus 
```

从运行这个程序：

```
#include <chrono>
#include <iostream>
#include <random>
#include <vector>

template<class Iterator, typename T>
void FillWithRandomNumbers(Iterator start, Iterator one_past_end, T a, T b) {
  std::random_device rnd_device;
  std::mt19937 generator(rnd_device());
  std::uniform_int_distribution<T> dist(a, b);
  for (auto it = start; it != one_past_end; it++)
    *it = dist(generator);
  return ;
}

template<class Iterator>
void FillWithRandomNumbers(Iterator start, Iterator one_past_end, double a, double b) {
  std::random_device rnd_device;
  std::mt19937_64 generator(rnd_device());
  std::uniform_real_distribution<double> dist(a, b);
  for (auto it = start; it != one_past_end; it++)
    *it = dist(generator);
  return ;
}

template<class RAI, class T>
inline void sum_abs_up(RAI first, RAI one_past_last, T &total) {
  T sum = 0;
  auto it = first;
  do {
    sum += *it;
    it++;
  } while (it != one_past_last);
  total += sum;
}

template<class RAI, class T>
inline void sum_abs_down(RAI first, RAI one_past_last, T &total) {
  T sum = 0;
  auto it = one_past_last;
  do {
    it--;
    sum += *it;
  } while (it != first);
  total += sum;
}

template<class T> std::chrono::nanoseconds TimeDown(
                      std::vector<T> &vec, const std::vector<T> &vec_original,
                      std::size_t num_repititions, T &running_sum) {
  std::chrono::nanoseconds total{0};
  for (std::size_t i = 0; i < num_repititions; i++) {
    auto start_time = std::chrono::high_resolution_clock::now();
    sum_abs_down(vec.begin(), vec.end(), running_sum);
    total += std::chrono::high_resolution_clock::now() - start_time;
    vec = vec_original;
  }
  return total;
}

template<class T> std::chrono::nanoseconds TimeUp(
                      std::vector<T> &vec, const std::vector<T> &vec_original,
                      std::size_t num_repititions, T &running_sum) {
  std::chrono::nanoseconds total{0};
  for (std::size_t i = 0; i < num_repititions; i++) {
    auto start_time = std::chrono::high_resolution_clock::now();
    sum_abs_up(vec.begin(), vec.end(), running_sum);
    total += std::chrono::high_resolution_clock::now() - start_time;
    vec = vec_original;
  }
  return total;
}

int main() {
  std::size_t num_repititions = 1 << 10;
  {
  typedef int ValueType;
  auto lower = std::numeric_limits<ValueType>::min();
  auto upper = std::numeric_limits<ValueType>::max();
  std::vector<ValueType> vec(1 << 24);

  FillWithRandomNumbers(vec.begin(), vec.end(), lower, upper);
  const auto vec_original = vec;
  ValueType sum_up = 0, sum_down = 0;

  auto time_up = TimeUp(vec, vec_original, num_repititions, sum_up).count();
  auto time_down = TimeDown(vec, vec_original, num_repititions, sum_down).count();
  std::cout << "sum up   = " << sum_up   << '\n';
  std::cout << "sum down = " << sum_down << '\n';
  std::cout << "Ave. Up Memory   = " << time_up/(num_repititions * 1000) << " mus\n";
  std::cout << "Ave. Down Memory =  "<< time_down/(num_repititions * 1000) << " mus"
            << std::endl;
  }
  {
  typedef double ValueType;
  auto lower = std::numeric_limits<ValueType>::min();
  auto upper = std::numeric_limits<ValueType>::max();
  std::vector<ValueType> vec(1 << 24);

  FillWithRandomNumbers(vec.begin(), vec.end(), lower, upper);
  const auto vec_original = vec;
  ValueType sum_up = 0, sum_down = 0;

  auto time_up = TimeUp(vec, vec_original, num_repititions, sum_up).count();
  auto time_down = TimeDown(vec, vec_original, num_repititions, sum_down).count();
  std::cout << "sum up   = " << sum_up   << '\n';
  std::cout << "sum down = " << sum_down << '\n';
  std::cout << "Ave. Up Memory   = " << time_up/(num_repititions * 1000) << " mus\n";
  std::cout << "Ave. Down Memory =  "<< time_down/(num_repititions * 1000) << " mus"
            << std::endl;
  }
  return 0;
} 
```

两者都`sum_abs_up`做`sum_abs_down`同样的事情，并且以相同的方式计时，唯一的区别是`sum_abs_up`内存增加而`sum_abs_down`内存减少。我什至通过`vec`引用传递，以便两个函数访问相同的内存位置。然而，`sum_abs_up`始终比`sum_abs_down`. 自己运行一下（我用 g++ -O3 编译它）。

FYI`vec_original`在那里进行实验，让我更容易改变`sum_abs_up`，并`sum_abs_down`以一种使它们改变的方式，`vec`同时不允许这些改变影响未来的时间安排。

重要的是要注意我计时的循环有多紧。如果一个循环的主体很大，那么它的迭代器是否会增加或减少内存可能并不重要，因为执行循环主体所需的时间可能会完全占主导地位。此外，重要的是要提到，对于一些罕见的循环，下降内存有时比上升内存要快。但即使有这样的循环，上升总是比下降慢的情况很少发生（不像上升内存的循环，它通常总是比等效的内存下降循环快；少数几次甚至是 40 +% 更快）。

关键是，根据经验，如果你有选择，如果循环的主体很小，如果让你的循环增加内存而不是减少内存之间没有什么区别，那么你应该增加内存。

# c# - 需要 LINQ OrderBy 帮助

> ID：804789
> 
> 赞同：1
> 
> 时间：2009-04-29T23:39:03.823
> 
> 标签：c#, linq, sql-order-by

我正在尝试按照另一个数组定义的顺序创建一个字符串集合。我知道听起来很混乱，所以让我解释一下

**requiredOrderOfElements**

```
{  
[0] category1,  
[1] categoryX,  
[2] something else  
} 
```

我的客户传递了一个包含键和值的字符串数组，即

**从客户端传递**

```
{  
[0][0] categoryX,  
[0][1] value from Category X,  
[1][0] something else,  
[1][1] value for something else,  
[2][0] category1,  
[2][1] value from Category 1  
} 
```

我想要的是按所需键顺序的“值”文本

**我想要的是**

```
[0]value from Category 1  
[1]value from Category X  
[2]value for something else 
```

我查看了 OrderBy / IComparer 并且看不到实现我需要的明显方法。我目前的解决方案是一个丑陋的嵌套 for 循环

任何关于更优雅方式的想法将不胜感激。

更新： - 这是测试

```
[TestFixture]
public class GL_Linq_Test
{
    [Test]
    public void CanOrderByAnotherArray()
    {
        var requiredOrder=new[]{"my","required","order"};
        var passedFromClient = new[]
                                   {
                                       new[] {"required", "cat"},
                                       new[] {"order", "dog"},
                                       new[] {"my", "bird"}
                                   };

        var ordered = FunkyOrderer.Order(requiredOrder, passedFromClient);

        Assert.That(ordered.First()[1],Is.EqualTo("bird"));
        Assert.That(ordered.Skip(1).First()[1], Is.EqualTo("cat"));
        Assert.That(ordered.Skip(2).First()[1], Is.EqualTo("dog"));
    }
}

public static class FunkyOrderer
{
//returns order bird,dog,cat not bird,cat,dog        
public static IEnumerable<string[]> Order(string[] requiredOrder, IEnumerable<string[]>passedFromClient)
    {
        return from o in requiredOrder
                     join f in passedFromClient on o equals f[0]
                     orderby o
                     select f;
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T04:16:33.140

问题是您假设字符串数组将按其索引排序（它们不会）。`"my", "order", "required"`使用内置字符串比较器的顺序是正确的。最简单的解决方案是修改您的 LINQ 查询，以便在订购时考虑索引。

```
return from o in requiredOrder.Select((o, i) => new { Value = o, Index = i })
       join f in passedFromClient on o.Value equals f[0]
       orderby o.Index
       select f; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T02:47:21.543

```
 var orderByThese = new string[] { "category1", "categoryX", "something else" };

    var fromClient = new string[][] 
    {
        new string[] { "categoryX", "value from Category X" },
        new string[] { "something else", "value for something else" },
        new string[] { "category1", "value from Category 1" }
    };

    var joined = from o in orderByThese
                 join f in fromClient on o equals f[0]
                 orderby o
                 select f; 
```

# msbuild - 通过 API 在 Msbuild 中启用 multiproc

> ID：804803
> 
> 赞同：1
> 
> 时间：2009-04-29T23:41:35.330
> 
> 标签：msbuild, multicore

使用 Msbuild v3.5，我可以包含[“/m”开关](http://msdn.microsoft.com/en-us/library/bb651793.aspx)以启用多处理器支持。但是，我找不到与[Microsoft.Build.BuildEngine](http://msdn.microsoft.com/en-us/library/microsoft.build.buildengine.aspx)中的任何内容相关的等效属性。如何通过 API 启用此设置？

我试图通过反思 Msbuild.exe 自己发现这一点（感谢 Lutz！），但它不使用 BuildEngine 而是直接使用 System.Threading.Thread 。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T00:02:28.557

做这个...

[http://blogs.msdn.com/msbuild/archive/2007/10/22/enabling-multiprocessor-support-in-an-msbuild-host.aspx](http://blogs.msdn.com/msbuild/archive/2007/10/22/enabling-multiprocessor-support-in-an-msbuild-host.aspx)

...回答你的问题？

本质上，它看起来好像您使用 Engine 的构造函数，该构造函数接受一个参数来表示要使用的 CPU 数量。

[http://msdn.microsoft.com/en-us/library/bb300140.aspx](http://msdn.microsoft.com/en-us/library/bb300140.aspx)

```
public Engine(
    BuildPropertyGroup globalProperties,
    ToolsetDefinitionLocations locations,
    int numberOfCpus,
    string localNodeProviderParameters
) 
```

# asp.net - ASP.NET 缓存和文件依赖关系

> ID：804808
> 
> 赞同：3
> 
> 时间：2009-04-29T23:42:28.633
> 
> 标签：asp.net, caching

我希望在触摸特定文件时回收 ASP.NET 缓存项，但以下代码不起作用：

```
 HttpContext.Current.Cache.Insert(
                            "Key",
                            SomeObject,
                            new CacheDependency(Server.MapPath("SomeFile.txt")),
                            DateTime.MaxValue,
                            TimeSpan.Zero,
                            CacheItemPriority.High,
                            null); 
```

“SomeFile.txt”在我打缓存的时候似乎没有被检查，修改它不会导致这个项目失效。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-04T23:46:34.370

# 问题解决了：

这是一个独特而有趣的问题，因此我将在此处记录原因和解决方案作为答案，以供将来的搜索者使用。

我在问题中遗漏的一点是，这种缓存插入发生在实现单例模式的服务类中。

简而言之：

```
public class Service 
{
        private static readonly Service _Instance = new Service();
        static Service () { }
        private Service () { }

        public static Service Instance
        {
            get { return _Instance; }
        }

        // The expensive data that this service exposes      
        private someObject _data = null;

        public someObject Data
        {
            get
            {
                 if (_data == null)
                     loadData();
                 return _data;
            }
        }

        private void loadData()
        {
            _data = GetFromCache();
            if (_data == null)
            {
                 // Get the data from our datasource
                 _data = ExpensiveDataSourceGet();

                 // Insert into Cache
                 HttpContext.Current.Cache.Insert(etc);
            }
        }
} 
```

这对某些人来说可能很明显，但这里的罪魁祸首是单例模式中的延迟加载。我被认为缓存没有失效，以至于我忘记了只要工作进程还活着，单例的状态就会持续存在。

Cache.Insert 有一个重载，允许您为删除缓存项时指定一个事件处理程序，我的第一个测试是创建一个虚拟处理程序并在其中设置一个断点。一旦我看到缓存被清除，我意识到“_data”没有被重置为空，所以下一个对单例的请求加载了延迟加载的值。

从某种意义上说，我是双重缓存，虽然单例缓存的寿命很短，但足够长得令人讨厌。

解决方案？

```
 HttpContext.Current.Cache.Insert(
     "Key",
      SomeObject,
      new CacheDependency(Server.MapPath("SomeFile.txt")),
      DateTime.MaxValue,
      TimeSpan.Zero,
      CacheItemPriority.High,
      delegate(string key, object value, CacheItemRemovedReason reason)
      {
          _data = null;
      }
 ); 
```

当缓存被清除时，单例中的状态也必须被清除……问题解决了。

在这里吸取教训？不要将状态放在单例中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T16:49:47.667

ASP.NET 是否在对 CacheDependency 中指定的文件具有适当权限的帐户下运行？如果不是，那么这可能是 CacheDependency 无法正常工作的原因之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T00:12:44.660

我认为您需要指定路径：

```
var d = new CacheDependency(Server.MapPath("SomeFile.txt")); 
```

根据`~\App_Data`需要添加。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T02:49:43.113

你的代码对我来说看起来不错。然而，除了这个片段之外，任何事情都可能发生。

*   您是否有机会重新插入每个回发？

*   尝试使您的缓存依赖项成为类字段，并在每次回发时检查它。修改中间的文件，看看它是否曾经注册为“已更改”。例如：

    ```
    public partial class _Default : System.Web.UI.Page
    {
       CacheDependency dep;

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            dep = new CacheDependency(Server.MapPath("SomeFile.txt"));
            HttpContext.Current.Cache.Insert(
                        "Key",
                        new Object(),
                        dep,
                        DateTime.MaxValue,
                            TimeSpan.Zero, CacheItemPriority.High, null);
        }

        if (dep.HasChanged)
            Response.Write("changed!");
        else
            Response.Write("no change :(");   }} 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-04T22:28:25.993

我能够重现此行为的唯一方法是，如果提供给 CacheDependency 的构造函数的路径不存在。如果路径不存在，CacheDependency 不会抛出异常，所以它可能有点误导。

# perl - 为什么 Perl 的 Inline::C 在 4.4e-5 之后排序 4.0e-5？

> ID：804810
> 
> 赞同：3
> 
> 时间：2009-04-29T23:43:16.790
> 
> 标签：perl, sorting

我构建了一个 Perl [Inline::C](http://search.cpan.org/dist/Inline-C)模块，但排序有些奇怪。有谁知道为什么会这样排序？为什么4.0e-5不是第一个？

```
my $ref = [ 5.0e-5,4.2e-5,4.3e-5,4.4e-5,4.4e-5,4.2e-5,4.2e-5,4.0e-5]; 

use Inline C => <<'END_OF_C_CODE';

void test(SV* sv, ...) {

  I32 i;
  I32 arrayLen;
  AV* data;
  float retval;
  SV** pvalue;

  Inline_Stack_Vars;
  data = SvUV(Inline_Stack_Item(0));

  /* Determine the length of the array */
  arrayLen = av_len(data);

  // sort 
  sortsv(AvARRAY(data),arrayLen+1,Perl_sv_cmp_locale);

  for (i = 0; i < arrayLen+1; i++) {

    pvalue = av_fetch(data,i,0);  /* fetch the scalar located at i .*/
    retval = SvNV(*pvalue);  /* dereference the scalar into a number. */

    printf("%f \n",newSVnv(retval));
  }
}

END_OF_C_CODE 
```

> 测试（$参考）；

0.000042
0.000042
0.000042
0.000043
0.000044
0.000044
0.000040
0.000050

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T00:01:55.343

因为您是按词法排序的，请尝试以下代码：

```
#!/usr/bin/perl

use strict;
use warnings;

my $ref = [ 5.0e-5,4.2e-5,4.3e-5,4.4e-5,4.4e-5,4.2e-5,4.2e-5,4.0e-5]; 

print "Perl with cmp\n";
for my $val (sort @$ref) {
    printf "%f \n", $val;
}

print "Perl with <=>\n";
for my $val (sort { $a <=> $b } @$ref) {
    printf "%f \n", $val;
}

print "C\n";

test($ref);

use Inline C => <<'END_OF_C_CODE';

void test(SV* sv, ...) {

  I32 i;
  I32 arrayLen;
  AV* data;
  float retval;
  SV** pvalue;

  Inline_Stack_Vars;
  data = SvUV(Inline_Stack_Item(0));

  /* Determine the length of the array */
  arrayLen = av_len(data);

  // sort 
  sortsv(AvARRAY(data),av_len(data)+1,Perl_sv_cmp_locale);

  arrayLen = av_len(data);
  for (i = 0; i < arrayLen+1; i++) {

    pvalue = av_fetch(data,i,0);  /* fetch the scalar located at i .*/
    retval = SvNV(*pvalue);  /* dereference the scalar into a number. */

    printf("%f \n",newSVnv(retval));
  }
}

END_OF_C_CODE 
```

当然，词法上`0.00040`也小于`0.00042`，但你不是在`0.00040`比较`0.00042`; 您正在将`0.00040`转换为字符串的数字与转换为字符串的数字进行比较`0.00042`。当一个数字变得太大或太小时，Perl 的字符串化逻辑求助于使用科学记数法。所以你正在对字符串集进行排序

```
"4.2e-05", "4.2e-05", "4.2e-05", "4.3e-05", "4.4e-05", "4.4e-05", "4e-05", "5e-05" 
```

正确排序。当您`%f`使用`printf`. 您可以自己对数字进行字符串化，但既然您已经说过希望这更快，那将是一个错误。你不应该在知道程序慢的地方之前尝试优化程序（过早的优化是万恶之源`*`）。编写您的代码，然后针对它运行[Devel::NYTProf](http://search.cpan.org/dist/Devel-NYTProf/)以找出它慢的地方。如有必要，在[XS](http://perldoc.perl.org/perlxstut.html)或`Inline::C`（我更喜欢 XS）中重写这些部分。你会发现选择正确的数据结构比像这样的微优化更快。

`*` [克努斯，唐纳德](http://www-cs-faculty.stanford.edu/~knuth/)。[带有 go to Statements 的结构化编程](http://portal.acm.org/citation.cfm?id=356640)，[ACM Journal Computing Surveys](http://surveys.acm.org/)，第 6 卷，第 4 期，1974 年 12 月。第 268 页。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T07:59:20.547

`Perl_sv_cmp_locale`是您的排序功能，我怀疑它是词法比较。寻找数字排序之一或编写自己的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T20:06:35.500

在[http://www.perlmonks.org/?node_id=761015的人们的帮助下获得答案](http://www.perlmonks.org/?node_id=761015)

我运行了一些分析 (DProf)，它的速度提高了 4 倍

总经过时间 = 0.543205 秒
用户+系统时间 = 0.585454 秒
独占时间
%Time ExclSec CumulS #Calls sec/call Csec/c Name
100\. 0.590 0.490 100000 0.0000 0.0000 test_inline_c_pkg ::percent2

总经过时间 = 2.151647 秒
用户+系统时间 = 1.991647 秒
独占时间
%Time ExclSec CumulS #Calls sec/call Csec/c Name
104\. 2.080 1.930 100000 0.0000 0.0000 main::percent2

这是代码

```
use Inline C => <<'END_OF_C_CODE';

#define SvSIOK(sv) ((SvFLAGS(sv) & (SVf_IOK|SVf_IVisUV)) == SVf_IOK)
#define SvNSIV(sv) (SvNOK(sv) ? SvNVX(sv) : (SvSIOK(sv) ? SvIVX(sv) : sv_2nv(sv)))

static I32 S_sv_ncmp(pTHX_ SV *a, SV *b) {

  const NV nv1 = SvNSIV(a);
  const NV nv2 = SvNSIV(b);
  return nv1 < nv2 ? -1 : nv1 > nv2 ? 1 : 0;
}

void test(SV* sv, ...) {

  I32 i;
  I32 arrayLen;
  AV* data;
  float retval;
  SV** pvalue;

  Inline_Stack_Vars;
  data = SvUV(Inline_Stack_Item(0));

  /* Determine the length of the array */
  arrayLen = av_len(data);

  /* sort descending (send numerical sort function S_sv_ncmp) */
  sortsv(AvARRAY(data),arrayLen+1, S_sv_ncmp);

  for (i = 0; i < arrayLen+1; i++) {

    pvalue = av_fetch(data,i,0);  /* fetch the scalar located at i .*/
    retval = SvNV(*pvalue);  /* dereference the scalar into a number. */

    printf("%f \n",newSVnv(retval));
  }
}

END_OF_C_CODE 
```

# java - 拥有仅在Java中使用内存的自定义文件实现的最简单方法是什么

> ID：804814
> 
> 赞同：1
> 
> 时间：2009-04-29T23:44:43.810
> 
> 标签：java, file, memory

我有一个代码库，它广泛使用文件来表示单个数据对象。我已经重构了代码，因此数据对象现在是一个显式的 java 对象，它主要隐藏与底层文件系统的交互。但是，我们使用一些外部工具（如 Weka）来读取和写入文件。

理想情况下，我希望有一个 File 的子类，我可以将它传递给这些其他库，这些库由内存中的字节数组支持——用于读取或写入。

我的谷歌搜索出现了内存映射文件，但这不是我遇到的问题，因为我不希望文件系统上有任何实际文件。是否已经有任何解决方案，或者我应该自己继承 File 并覆盖所有引用真实文件系统的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T00:12:01.217

这通常是为什么你不应该编写方法来获取文件，除非它真的有必要。您的库不提供采用任意 InputStream 的方法吗？在这种情况下，传递一个 ByteArrayInputStream 或任何从内存读取的输入流是微不足道的。

覆盖 File 的问题在于您不太可能以对您有帮助的方式覆盖它。例如，如果库使用 FileInputStream 打开它，那么此时字节的来源实际上是由 FileInputStream 实现控制的，而不是由您的文件控制的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T00:03:34.263

`java.io.File`本质上是`String`代表文件路径的 a 的包装器（它应该是一个`final`类，但你去了）。所以你对这种方法不走运。当然，您可以在“RAM 磁盘”上创建临时文件和文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T00:09:03.377

您应该注意 OutputStreams/InputStreams 的内存实现，例如[ByteArrayOutputStream](http://java.sun.com/javase/6/docs/api/java/io/ByteArrayOutputStream.html)及其 toByteArray() 方法，或[ByteArrayInputStream](http://java.sun.com/javase/6/docs/api/java/io/ByteArrayInputStream.html)与 byte[] 构造函数。如果您的数据表示更复杂，您可以直接实现接口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T00:37:36.740

您必须找出您的第 3 方正在使用哪些 File 方法并为它们提供自定义实现。

几乎可以肯定您将无法成功，因为 java.io.File 对象不负责文件内容的读取/写入。

最好的方法是重构代码，使其不依赖于 File 对象，而是依赖于该文件返回的字节数组。

可以创建文件的子类。

```
public class InMemoryFile extends File { 
    public InMemody() { 
         super( "/dev/null" );
    }
    // find out what methods should be overwritten ?????
} 
```

# ruby-on-rails - 红宝石开发环境

> ID：804817
> 
> 赞同：5
> 
> 时间：2009-04-29T23:45:45.477
> 
> 标签：ruby-on-rails, ruby, development-environment

在 a) windows b) linux 或 c) mac 中开发 ruby​​ on rails 更好吗？为什么 ？

编辑：

我问这个问题的原因是我听说在 Windows 中开发 ruby​​ on rails 与在 mac 中使用 ruby​​ on rails 相比并不稳定/好。（不确定这是否属实）。

再加上 David Heinemeier Hansson（Ruby on Rails 的创建者）似乎正在使用 Mac，所以最初的印象似乎是 Ruby on Rails 应用程序和 Mac 配合得很好。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-30T09:02:56.213

我强烈建议你不要在 Windows 上开发。为什么？首先，每次升级都会在 Windows 上出现很多问题，并且大多数 gem 或插件创建者不使用 Windows，因此他们不关心 Windows，也不在其上运行测试（有几个大牌平淡无奇的人说窗户不是他们的问题，而是你的）。你会发现 *nix 与 Windows 的问题会一次又一次地咬你。路径名斜线、ssh 实现的细微差别、控制台和字体问题、rubygems、capistrano 等...

一段时间后最终会发生的事情是，每次您必须调试“这只是 Windows 上的问题吗？”时，您的脑后总会有这个声音。那个小声音对你来说是一种代价……每天都会消耗你的一些电池。

Mac 的前期成本更高（遗憾的是我没有），而 linux 平台则更昂贵，要花一两天时间让你的无线设备工作，但这些都是一次性的前期成本。使用 Windows 进行 Rails 开发的不安全性是一个持续的成本。至少在社区开始拒绝那些不是真正跨平台的东西之前。

以黄瓜为例。由于某种原因，测试框架依赖于 Windows 中不可用的特定控制台配置。因此，要在 Windows 中使用它，您必须更改控制台中的字体并更改控制台中的代码页。否则，字母“a”将从所有输出中消失。为什么？因为它适用于 *nix 系统并为您提供漂亮的颜色（我认为这是一个巨大的缺陷和非常糟糕的设计选择，即使您忽略 Windows）。

每次你提出窗户问题时，你也会觉得自己像在电梯里放屁的那个人。

我说这一切是作为一些目前必须使用 Windows 作为他的开发平台的人。嘿，那是什么味道？

[后期编辑：Ruby 在 Windows 上的速度也慢了大约 3 倍。这将影响您始终运行测试的意愿，并损害您的 TDD 反馈周期]

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T23:52:20.093

没关系，你最舒服的。我已经完成了这三个。

我想 Windows 由于不是基于 unix 的，所以有点不舒服，CLI 有点笨拙。

（但如果你使用像 NetBeans 这样的工具，你甚至不需要 CLI 太多）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T03:53:46.330

我建议在开发稍后将部署在 linux 系统上的应用程序时不要使用 windows。如果您正在开发用于练习的应用程序，Windows 很好。

问题是，如果你的目标是 linux，那么你会希望在你的开发机器上有一个完整的堆栈：一个 web 服务器、一个 dbms，也许还有 memcached 等等。虽然可以将所有这些加载到 windows （我已经做到了），它会比在 linux 机器上花费更长的时间，会更慢，当某些东西不起作用时，你会更难找到帮助。

此外，您可能会在 Windows 上遇到 gem 和插件支持问题。例如 \ 而不是 / 用于目录路径和其他怪异。虽然 ruby​​ists 会尽力提供帮助，但 Windows 支持有时会受到限制，因为大多数 RoR 工作都是在 Mac 或 Linux 机器上完成的。例如 Capistrano 在 Windows 上运行时遇到了问题（现在可能已修复）。

**作为替代方案**，您可以将 Windows 用作桌面计算机，但将 linux 计算机用作运行应用程序的开发服务器。任何旧电脑都可以正常运行 linux。使用 samba 从您的 Windows 机器远程访问和编辑文件。linux机器不需要显示器，你只能远程使用它。

只需更改您的应用程序的 config/environments/development.rb 以包含

```
config.action_controller.consider_all_requests_local = true 
```

这样您就可以从您的 Windows 机器上运行的浏览器中看到堆栈跟踪。

问候，

拉里

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T00:03:41.860

Ruby on Rails 在所有平台上都运行良好，但工具支持各不相同。例如，TextMate 是 Ruby 爱好者最喜欢的编辑器，而且它仅适用于 Mac。您将能够在 TextMate 中找到许多使用 RoR 的有用工具，因此最好在 Mac 上进行 RoR 开发。

我自己使用 Mac 和 Linux。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T00:18:01.780

基于 Unix 的系统将为您提供一条阻力最小的路径，因为所有 gem 在这些系统上都可用/可编译，这在 Windows 机器上并不容易。在 Windows 上这并非不可能，但在某些情况下，您将花费更多时间让它工作而不是工作。

在那些 Unix 系统中，我最喜欢的是 Mac，它拥有 Unix 的所有功能以及你的 linux 系统可能缺少的所有界面细节，当然，如果没有我每天服用的 TextMate，我就无法生存，所以 Mac 吧是。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-05T15:52:49.390

1981 年，我开始了早期 Unix 系统的程序员生涯。到 1995 年，我一直是一个纯粹的 Unix 人。然后“事情”发生了，（企业所有权），Windows 进入了我的生活。

所以在 2007 年我开始学习 RoR，纯 Windows。我部署在 Joyent 上，即 Solaris。我已经成功开发了两个大型应用程序，在 Windows 上开发，并在 Solaris/Apache/Mongrel 上部署，没有发生重大事故。

我记得的唯一 Windows 问题是我不得不强制文件系统读写进入二进制模式以解决“开发”与“部署”问题。

老实说，我认为在 Windows 上开发和在 Unix 上部署没有任何问题。但我有广泛的 Unix 背景，如果我不了解 Unix，我不确定故事会不会是一样的。

此外，我只会在为我的业务构建的 RoR 应用程序上工作。我永远不需要构建任何其他 RoR 应用程序，我永远不会开发任何插件，永远不必接管另一个项目，永远不会有任何人坚持我包含一些仅在不适用于我的 Windows 开发环境的东西中可用的东西， ETC...

我会这样说：

如果您负责为您的雇主开发 Web 应用程序，并且该雇主是基于 Windows 的，则不应阻止您将 RoR 视为平台。该应用程序必须由第三方部署，除非您的雇主足够大并且项目足够重要以保证内部 Unix 系统。

所以如果你知道关于 Unix 的 SQUAT，你可能需要一点帮助。如果您使用第三方 Rails 主机，请查看他们的支持论坛，确保有人愿意并且能够通过任何部署/设置和维护问题与非 Unix 人员交谈。

我给你举个例子，在 Joyent 上，如果我想运行迁移，我必须通过他们的数据库 GUI，登录到数据库，然后“执行”一个命令。好的，所以我得到了一个简单的 text_field，我在其中输入了用于 Unix shell 的输入，即：

cd /user/myhome/sites/mysite && rake db:migrate RAILS_ENV=production

如果我没有 Unix 背景，这可能不会那么容易弄清楚。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-16T03:18:37.147

从 Ruby 1.9.2 和 Rails 3.2 开始，Windows 的 autotest 和 spork 速度要慢得多（一个完整的周期平均需要大约 15 秒，而 Linux 上同一项目只需几秒），但我喜欢更好的以 gui 为中心的 git 工具和功能（TortoiseGit、WinSCP）等等，因为我更熟悉 Windows。我已经验证了我需要的基本功能在两个平台上都可以使用，所以我发现与速度相比，破损是一个较小的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T23:55:59.913

没关系，如果您是一个纯粹主义者，那么您的开发环境应该尽可能与您的生产环境在操作系统和 Ruby 和 Rails 版本方面相匹配。但实际上这并不重要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-30T02:32:04.360

一些 gems 在 Mac 上工作，但在一些 Linux 上不工作（比如我上次尝试时的 gitjour）。

使用 Mac 可能是好是坏，这取决于您是否想知道您开发的任何东西都可以在任何其他操作系统上运行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-02T02:15:13.477

我已经在 OSX 和 Linux (Ubuntu) 上进行了轻轨开发，我发现差异几乎是难以察觉的（就 ruby​​ 和 rails 而言......显然桌面环境在两个操作系统之间有很大不同）。

正如其他人所说，大多数 ruby​​/rails 教程、gem、插件等都是面向 Unix 类型系统的，所以我认为在 Windows 中进行 ruby​​/rails 开发可能会遇到一些烦人的问题，除非你当然是使用 IronRuby。:-)

为 Rails 开发设置 Unix 环境的一种简单的替代方法是在 VMWare、VirtualBox、VirtualPC 等虚拟化软件下运行更易于使用的 Linux 发行版之一，如 Ubuntu 或 Fedora。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-03T18:52:46.020

我同意以前的许多帖子，即 Windows 上的 Rails 可能是一个问题。很简单，很多为 Rails 开发的人都在 Mac 或 Linux 上，因此没有发现 Windows 错误，这尤其是插件的问题。

Rails 的一个问题是 IDE。Mac 上的 TextMate 似乎是一个流行的选择，但 Linux 和 Windows 选项相当分散。通常我不会担心这一点，但我发现当你有 IDE 支持时，Rails 变得更易于管理。一般来说，有很多文件位于相当复杂的目录结构中，因此拥有一个 IDE 可以让您轻松找到所需的文件，这将极大地提高生产力。

您可能要考虑的另一件事是您的部署环境是什么样的。例如，人们可能会在 Linux 服务器上部署 Rails 应用程序。在这种情况下，您可以通过在 OS X 上进行开发来避开错误，但不幸的是，当您部署新软件时，这些错误会突然出现。那是您要调试代码的最后一个地方。当然，您应该首先在暂存环境中测试您的代码，但是人们常常会跳过这一步。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-20T17:56:30.690

在寻找这个问题的答案时，由于在使用 Ruby 开发时总是不得不在 Windows 上破解我的工作方式，我可以说，如果你有选择，请使用 Linux 或 Mac。从今天开始，我已经正式开始使用 Ubuntu 9.04，原因如下：

1) 不能做任何 ssh 的事情，比如使用 Capistrano、vlad、为 ruby​​forge 创建 gems 等。你可以使用 cygwin 来做这些事情，但是使用 cygwin 和 windows 来做所有事情是一件很痛苦的事情。

2）最后一根稻草是当试图在rails应用程序中启动后台任务时才意识到windows不能分叉进程......甚至没有为这个而烦恼cygwin，只是切换到Ubuntu所以我没有'不必继续解决这些问题。

不过 Ubuntu 9.0.4 非常热，给人留下了深刻的印象，所以它可能还不错。

# c++ - 为什么 std::ends 会导致字符串比较失败？

> ID：804826
> 
> 赞同：4
> 
> 时间：2009-04-29T23:53:58.247
> 
> 标签：c++, stl, boost

我昨天花了大约 4 个小时试图在我的代码中解决这个问题。我将问题简化为下面的示例。

这个想法是将字符串存储在以`stringstream`结尾`std::ends`，然后稍后检索它并将其与原始字符串进行比较。

```
#include <sstream>
#include <iostream>
#include <string>

int main( int argc, char** argv )
{
    const std::string HELLO( "hello" );

    std::stringstream testStream;

    testStream << HELLO << std::ends;

    std::string hi = testStream.str();

    if( HELLO == hi )
    {
        std::cout << HELLO << "==" << hi << std::endl;
    }

    return 0;
} 
```

正如您可能猜到的那样，上面的代码在执行时不会打印任何内容。

虽然，如果打印出来，或者在调试器（VS2005）中查看，`HELLO`并且`hi`看起来相同，它们`.length()`实际上相差 1。这就是我猜测导致`==`操作员失败的原因。

我的问题是为什么。我不明白为什么即使它们具有相同的内容，也会`std::ends`将一个不可见的字符添加到 string `hi`、 make`hi`和不同的长度。`HELLO`此外，这个不可见的角色不会被增强修剪修剪。但是，如果您用于`strcmp`比较`.c_str()`两个字符串，则比较可以正常工作。

我首先使用的原因`std::ends`是因为我过去`stringstream`在流的末尾保留垃圾数据时遇到过问题。`std::ends`为我解决了这个问题。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-30T00:08:17.073

`std::ends`在流中插入一个空字符。将内容作为 a`std::string`将保留该空字符并在相应位置创建一个带有该空字符的字符串。

所以确实 std::string 可以包含嵌入的空字符。以下 std::string 内容*不同*：

```
ABC
ABC\0 
```

二进制零不是空格。但它也不能打印，所以你不会看到它（除非你的终端特别显示它）。

比较 using`strcmp`将在您传递时将 a 的内容解释`std::string`为 C 字符串`.c_str()`。它会说

> 嗯，第一个`\0`（终止空字符）之前的字符是*ABC*，所以我认为字符串是*ABC*

因此，它不会看到上述两者之间有任何区别。您可能遇到了这个问题：

```
std::stringstream s;
s << "hello";
s.seekp(0);
s << "b";
assert(s.str() == "b"); // will fail! 
```

断言将失败，因为字符串流使用的序列仍然是包含“hello”的旧序列。你所做的只是覆盖第一个字符。你想这样做：

```
std::stringstream s;
s << "hello";
s.str(""); // reset the sequence
s << "b";
assert(s.str() == "b"); // will succeed! 
```

另请阅读此答案：[如何重用 ostringstream](https://stackoverflow.com/questions/624260/how-to-reuse-an-ostringstream/624291#624291)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T00:08:54.360

`std::ends`只是一个空字符。传统上，C 和 C++ 中的字符串以 null (ascii 0) 字符结尾，但事实证明这`std::string`并不真正需要这个东西。无论如何，要逐点执行您的代码，我们会看到一些有趣的事情发生：

```
int main( int argc, char** argv )
{ 
```

字符串文字`"hello"`是传统的以零结尾的字符串常量。我们将整个复制到`std::string`HELLO 中。

```
 const std::string HELLO( "hello" );

    std::stringstream testStream; 
```

我们现在将`string`HELLO（包括尾随的 0）放入`stream`，然后是第二个 null ，它通过调用 放在那里`std::ends`。

```
 testStream << HELLO << std::ends; 
```

我们提取出我们放入的内容的副本`stream`（文字字符串“hello”，加上两个空终止符）。

```
 std::string hi = testStream.str(); 
```

`operator ==`然后我们使用类上的比较这两个字符串`std::string`。该运算符（可能）比较`string`对象的长度 - 包括有多少尾随空字符。请注意，`std::string`该类不要求底层字符数组以尾随空字符结尾——换句话说，它允许字符串包含空字符，因此两个尾随空字符中的第一个被视为字符串的一部分`hi`。

由于两个字符串的尾随空值数量不同，因此比较失败。

```
 if( HELLO == hi )
    {
        std::cout << HELLO << "==" << hi << std::endl;
    }

    return 0;
} 
```

> 虽然，如果打印出来，或者在调试器（VS2005）中查看，HELLO 和 hi 看起来相同，但它们的 .length() 实际上相差 1。我猜这就是导致“==”运算符失败的原因。

原因是，长度相差一个尾随空字符。

> 我的问题是为什么。我不明白为什么 std::ends 是添加到字符串 hi 的不可见字符，即使 hi 和 HELLO 具有相同的内容，它们的长度也会不同。此外，这个不可见的角色不会被增强修剪修剪。但是，如果您使用 strcmp 比较两个字符串的 .c_str()，则比较可以正常进行。

`strcmp`不同于`std::string`- 它是在早期以空值终止字符串时写的 - 所以当它到达第一个尾随空值时`hi`它停止查找。

> 我首先使用 std::ends 的原因是因为我过去遇到过 stringstream 在流末尾保留垃圾数据的问题。std::ends 为我解决了这个问题。

有时，了解底层表示是一个好主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T00:09:44.793

您正在使用 std::ends 向 HELLO 添加一个 NULL 字符。当您使用 str() 初始化 hi 时，您将删除 NULL 字符。琴弦不一样。strcmp 不比较 std::strings，它比较 char* （它是一个 C 函数）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T00:12:30.777

std::ends 添加一个空终止符，(char)'\0'。您可以将它与已弃用的 strstream 类一起使用，以添加空终止符。

stringstream 不需要它，实际上它搞砸了，因为 null 终止符不是 stringstream 的“结束字符串的特殊 null 终止符”，对于 stringstream 它只是另一个字符，第零个字符。stringstream 只是添加它，这会将字符数（在您的情况下）增加到七个，并使与“hello”的比较失败。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-07T14:25:20.820

我认为有一个比较字符串的好方法是使用`std::find`方法。不要混合 C 方法和`std::string`那些！

# vb.net - 我可以从泛型类继承而不指定类型吗？

> ID：804827
> 
> 赞同：2
> 
> 时间：2009-04-29T23:54:12.023
> 
> 标签：vb.net, generics, inheritance

我在 VB.NET 控制台应用程序中有以下示例代码。它编译和工作，但感觉就像一个黑客。有没有办法定义 EmptyChild 以便它从 Intermediate(Of T As Class) 继承而不使用虚拟 EmptyClass？

```
Module Module1
Sub Main()

    Dim Child1 = New RealChild()
    Child1.Content = New RealClass()
    Dim Child2 = New EmptyChild()

    Console.WriteLine("RealChild says: " & Child1.Test)
    Console.WriteLine("EmptyChild says: " & Child2.Test)
    Console.ReadLine()
End Sub

Public Class EmptyClass

End Class

Public Class RealClass

    Public Overrides Function ToString() As String
        Return "This is the RealClass"
    End Function

End Class

Public MustInherit Class Base(Of T As Class)

    Private _content As T = Nothing
    Public Property Content() As T
        Get
            Return _content
        End Get
        Set(ByVal value As T)
            _content = value
        End Set
    End Property

    Public Overridable Function Test() As String
        If Me._content IsNot Nothing Then
            Return Me._content.ToString
        Else
            Return "Content not initialized."
        End If
    End Function

End Class

Public MustInherit Class Intermediate(Of T As Class)
    Inherits Base(Of T)

    'some methods/properties here needed by Child classes

End Class

Public Class RealChild
    Inherits Intermediate(Of RealClass)

    'This class needs all functionality from Intermediate.

End Class

Public Class EmptyChild
    Inherits Intermediate(Of EmptyClass)

    'This class needs some functionality from Intermediate,
    ' but not the Content as T property.

    Public Overrides Function Test() As String
        Return "We don't care about Content property or Type T here."
    End Function

End Class
End Module 
```

另一种方法是将通用代码移出基类，然后创建 2 个中间类，如下所示：

```
Public MustInherit Class Intermediate
    Inherits Base

    'some methods/properties here needed by Child classes

End Class

Public MustInherit Class Intermediate(Of T As Class)
    Inherits Intermediate

    'implement generic Content property here

End Class 
```

然后 RealChild 将从通用中间体继承，而 EmptyChild 将从非通用中间体继承。我对该解决方案的问题是 Base 类在一个单独的程序集中，我需要在该程序集中保留处理泛型类型的代码。中间类中有一些不属于基类程序集的功能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T00:09:56.510

是的，您需要在继承时指定类型参数，或者您的 EmptyChild 也必须是泛型的。但是，您不必虚设一个 EmptyClass - 只需使用 Object 作为您的类型参数：

```
 Public Class EmptyClass
    Inherits Intermediate(Of Object)
 End Class 
```

# asp.net - 为 cookie 序列化字典？

> ID：804834
> 
> 赞同：-1
> 
> 时间：2009-04-29T23:58:23.713
> 
> 标签：asp.net

将字典序列化以在单个 Cookie 中使用的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T00:07:22.723

我不认为 Dictionary 被标记为 [Serializable]。如果键和值是原始类型（int、string 等），您可以使用逗号/分号分隔的列表：

键 1，值 1；键 2，值 2；键 3，值 3

如果您的键/值中有复杂的类型，我建议您不要进行序列化。不想处理 50K cookie，你永远不知道它在浏览器之间是如何工作的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T00:07:46.437

我不推荐它，在每个请求上序列化/反序列化 cookie 的性能很糟糕。

找出一种方法来表示自己与字符串之间的结构。

如果你绝对必须序列化它：

[http://petesbloggerama.blogspot.com/2006/07/binary-serialization-to-from-string.html](http://petesbloggerama.blogspot.com/2006/07/binary-serialization-to-from-string.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T00:06:18.873

有一些[XML 可序列化字典](http://weblogs.asp.net/pwelter34/archive/2006/05/03/444961.aspx)的示例，它们适用于非常小的字典对象。然而，由于大小*是*cookie 的一个问题，我建议探索一些不太灵活但更紧凑的东西。

您是否还考虑过将数据存储在服务器上并仅将数据的密钥存储在 cookie 中？

# windows-vista - Vista/Win2008 上的关键部分泄漏内存？

> ID：804848
> 
> 赞同：5
> 
> 时间：2009-04-30T00:06:34.927
> 
> 标签：windows-vista, memory-leaks, windows-server-2008, critical-section

似乎在 Vista/Windows Server 2008 中大量使用关键部分会导致操作系统无法完全恢复内存。我们在 Delphi 应用程序中发现了这个问题，这显然是因为使用了 CS API。（见这个[问题](https://stackoverflow.com/questions/780073/is-the-memory-not-reclaimed-for-delphi-apps-running-on-windows-server-2008-sp1)）

有没有其他人在使用其他语言（C++，...）开发的应用程序中看到它？

示例代码只是初始化 10000000 CS，然后删除它们。这在 XP/Win2003 中运行良好，但在应用程序结束之前不会释放 Vista/Win2008 中的所有峰值内存。
您使用 CS 的次数越多，您的应用程序就会越多地保留内存。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-20T19:42:25.690

Microsoft 确实改变了`InitializeCriticalSection`在 Vista、Windows Server 2008 和可能还有 Windows 7 上的工作方式。
他们添加了一个“功能”，以便在分配一堆 CS 时保留一些用于调试信息的内存。您分配的越多，保留的内存就越多。它可能是渐近的并最终变平（没有完全购买这个）。
为了避免这个“特性”，你必须使用新的 API [InitalizeCriticalSectionEx](http://msdn.microsoft.com/en-us/library/ms683477(VS.85).aspx)并传递 flag `CRITICAL_SECTION_NO_DEBUG_INFO`。
这样做的好处是它可能会更快，因为通常只使用旋转计数而无需实际等待。
缺点是**您的旧应用程序可能不兼容**，您需要更改您的代码，并且它现在依赖于平台（您必须检查版本以确定使用哪个版本）。如果需要，您也会失去调试能力。

**冻结 Windows Server 2008 的测试工具包：**
- 将此 C++ 示例构建为 CSTest.exe

```
#include "stdafx.h" 
#include "windows.h" 
#include <iostream> 

using namespace std; 

void TestCriticalSections() 
{ 
  const unsigned int CS_MAX = 5000000; 
  CRITICAL_SECTION* csArray = new CRITICAL_SECTION[CS_MAX];  

  for (unsigned int i = 0; i < CS_MAX; ++i)  
    InitializeCriticalSection(&csArray[i]);  

  for (unsigned int i = 0; i < CS_MAX; ++i)  
    EnterCriticalSection(&csArray[i]);  

  for (unsigned int i = 0; i < CS_MAX; ++i)  
    LeaveCriticalSection(&csArray[i]);  

  for (unsigned int i = 0; i < CS_MAX; ++i)  
    DeleteCriticalSection(&csArray[i]); 

  delete [] csArray; 
} 

int _tmain(int argc, _TCHAR* argv[]) 
{ 
  TestCriticalSections(); 

  cout << "just hanging around..."; 
  cin.get(); 

  return 0; 
} 
```

-...运行这个批处理文件（需要来自服务器 SDK 的 sleep.exe）

```
@rem you may adapt the sleep delay depending on speed and # of CPUs 
@rem sleep 2 on a duo-core 4GB. sleep 1 on a 4CPU 8GB. 

@for /L %%i in (1,1,300) do @echo %%i & @start /min CSTest.exe & @sleep 1 
@echo still alive? 
@pause 
@taskkill /im cstest.* /f 
```

-...在启动 300 个实例之前看到一个 8GB 和四核 CPU 的 Win2008 服务器冻结。
-...在 Windows 2003 服务器上重复，看看它处理它就像一个魅力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T08:31:20.033

您的测试很可能不能代表问题。临界区被认为是“轻量级互斥体”，因为在初始化临界区时不会创建真正的内核互斥体。这意味着您的 10M 关键部分只是具有几个简单成员的结构。然而，当两个线程同时访问一个 CS 时，为了使它们同步，确实创建了一个互斥锁——这是另一回事。

我假设在您的真实应用程序线程中确实发生了冲突，而不是您的测试应用程序。现在，如果您真的将临界区视为轻量级互斥体并创建大量它们，那么您的应用程序可能会分配大量真正的内核互斥体，它们比轻量级临界区对象重得多。而且由于互斥体是内核对象，因此创建过多的互斥体确实会损害操作系统。

如果确实如此，您应该减少预期会发生大量冲突的关键部分的使用。这与Windows版本无关，所以我的猜测可能是错误的，但仍然需要考虑。尝试监控操作系统句柄数，看看你的应用程序是如何运行的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T00:51:10.200

你看到的是别的东西。

我刚刚构建并运行了这个测试代码。每个内存使用统计都是恒定的——私有字节、工作集、提交等等。

```
int _tmain(int argc, _TCHAR* argv[])
{
    while (true)
    {
        CRITICAL_SECTION* cs = new CRITICAL_SECTION[1000000];
        for (int i = 0; i < 1000000; i++) InitializeCriticalSection(&cs[i]);
        for (int i = 0; i < 1000000; i++) DeleteCriticalSection(&cs[i]);
        delete [] cs;
    }

    return 0;
} 
```

# php - 通过字符串获取 PHP 类属性

> ID：804850
> 
> 赞同：164
> 
> 时间：2009-04-30T00:07:06.157
> 
> 标签：php, string, oop, properties

如何根据字符串获取 PHP 中的属性？我会打电话`magic`的。那么是什么`magic`？

```
$obj->Name = 'something';
$get = $obj->Name; 
```

会像...

```
magic($obj, 'Name', 'something');
$get = magic($obj, 'Name'); 
```

* * *

## 回答 #1

> 赞同：268
> 
> 时间：2009-04-30T00:13:39.747

像这样

```
<?php

$prop = 'Name';

echo $obj->$prop; 
```

或者，如果您可以控制该类，请实现[ArrayAccess](http://us3.php.net/manual/en/class.arrayaccess.php)接口并执行此操作

```
echo $obj['Name']; 
```

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2012-08-09T03:53:28.210

如果您想在不创建中间变量的情况下访问该属性，请使用以下`{}`表示法：

```
$something = $object->{'something'}; 
```

这也允许您在循环中构建属性名称，例如：

```
for ($i = 0; $i < 5; $i++) {
    $something = $object->{'something' . $i};
    // ...
} 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-30T00:17:34.837

您要问的是所谓的[Variable Variables](http://us2.php.net/manual/en/language.variables.variable.php)。您需要做的就是将您的字符串存储在一个变量中并像这样访问它：

```
$Class = 'MyCustomClass';
$Property = 'Name';
$List = array('Name');

$Object = new $Class();

// All of these will echo the same property
echo $Object->$Property;  // Evaluates to $Object->Name
echo $Object->{$List[0]}; // Use if your variable is in an array 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-30T00:13:47.700

像这样的东西？没有测试过，但应该可以正常工作。

```
function magic($obj, $var, $value = NULL)
{
    if($value == NULL)
    {
        return $obj->$var;
    }
    else
    {
        $obj->$var = $value;
    }
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-30T00:14:27.700

只需将属性名称存储在一个变量中，并使用该变量来访问该属性。像这样：

```
$name = 'Name';

$obj->$name = 'something';
$get = $obj->$name; 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-11-23T05:07:59.140

这个问题可能有答案，但您可能希望看到这些迁移到 PHP 7

![向后不兼容的变化](https://i.stack.imgur.com/kWI7i.png)

来源：[php.net](http://php.net/manual/en/migration70.incompatible.php#migration70.incompatible.variable-handling.indirect)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-02-13T17:44:32.007

很简单，$obj->{$obj->Name} 大括号会将属性包裹起来，就像变量变量一样。

这是一个热门搜索。但没有解决我使用 $this 的问题。在我的情况下，使用大括号也有帮助......

使用 Code Igniter 获取实例的示例

在带有父类实例的源库类中

```
$this->someClass='something';
$this->someID=34; 
```

需要从另一个类中获取源的库类也与父实例一起使用

```
echo $this->CI->{$this->someClass}->{$this->someID}; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-30T00:22:41.503

作为补充：通过这种方式，您可以使用原本无法使用的名称访问属性

```
$x = 新标准类；$prop = 'a b';
$x->$prop = 1;
$x->{'x y'} = 2;
var_dump($x);
```

```
对象（stdClass）#1（2）{
  ["a b"]=>
  整数（1）
  [“x y”]=>
  整数（2）
}
```

（不是你应该这样做，但如果你必须这样做）。
如果你想做更花哨的事情，你应该考虑[反思](http://de.php.net/reflection)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-01-15T13:41:06.363

万一其他人想找到一个未知深度的深层属性，我想出了下面的内容，而无需遍历所有孩子的所有已知属性。

例如，要查找`$foo->Bar->baz->bam`，给定一个对象 ( `$foo`) 和一个类似“Bar->baz->bam”的字符串。

```
trait PropertyGetter {
    public function getProperty($pathString, $delimiter = '->') {

        //split the string into an array
        $pathArray = explode($delimiter, $pathString);

        //get the first and last of the array
        $first = array_shift($pathArray);
        $last = array_pop($pathArray);

        //if the array is now empty, we can access simply without a loop
        if(count($pathArray) == 0){
            return $this->{$first}->{$last};
        }

        //we need to go deeper
        //$tmp = $this->Foo
        $tmp = $this->{$first};

        foreach($pathArray as $deeper) {
            //re-assign $tmp to be the next level of the object
            // $tmp = $Foo->Bar --- then $tmp = $tmp->baz
            $tmp = $tmp->{$deeper};
        }

        //now we are at the level we need to be and can access the property
        return $tmp->{$last};

    }
} 
```

然后用类似的东西打电话：

```
$foo = new SomeClass(); // this class imports PropertyGetter trait
echo $foo->getProperty("bar->baz->bam"); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T00:32:15.817

这是我的尝试。它内置了一些常见的“愚蠢”检查，确保您不会尝试设置或获取不可用的成员。

您可以将这些“property_exists”检查分别移动到 __set 和 __get 并直接在 magic() 中调用它们。

```
<?php

class Foo {
    public $Name;

    public function magic($member, $value = NULL) {
        if ($value != NULL) {
            if (!property_exists($this, $member)) {
                trigger_error('Undefined property via magic(): ' .
                    $member, E_USER_ERROR);
                return NULL;
            }
            $this->$member = $value;
        } else {
            if (!property_exists($this, $member)) {
                trigger_error('Undefined property via magic(): ' .
                    $member, E_USER_ERROR);
                return NULL;
            }
            return $this->$member;
        }
    }
};

$f = new Foo();

$f->magic("Name", "Something");
echo $f->magic("Name") , "\n";

// error
$f->magic("Fame", "Something");
echo $f->magic("Fame") , "\n";

?> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-05-27T13:11:41.160

该函数的作用是检查该属性是否存在于他孩子的任何此类中，如果存在则获取值，否则返回 null。所以现在属性是可选的和动态的。

```
/**
 * check if property is defined on this class or any of it's childes and return it
 *
 * @param $property
 *
 * @return bool
 */
private function getIfExist($property)
{
    $value = null;
    $propertiesArray = get_object_vars($this);

    if(array_has($propertiesArray, $property)){
        $value = $propertiesArray[$property];
    }

    return $value;
} 
```

用法：

```
const CONFIG_FILE_PATH_PROPERTY = 'configFilePath';

$configFilePath = $this->getIfExist(self::CONFIG_FILE_PATH_PROPERTY); 
```

* * *

## 回答 #12

> 赞同：-6
> 
> 时间：2009-04-30T00:32:11.213

```
$classname = "myclass";
$obj = new $classname($params);

$variable_name = "my_member_variable";
$val = $obj->$variable_name; //do care about the level(private,public,protected)

$func_name = "myFunction";
$val = $obj->$func_name($parameters); 
```

为什么编辑：之前：使用评估（邪恶）之后：根本没有评估。在这种语言中变老了。

# .net - WPF：当最终高度未知时，ListView 的动画高度

> ID：804852
> 
> 赞同：4
> 
> 时间：2009-04-30T00:07:46.233
> 
> 标签：.net, wpf, listview, animation

我有一个 ListView，它在我的 XAML 中非常简单地定义，就像这样

```
<ListView Name="myListVew" MaxHeight="200" Visibility="Collapsed">
    <ListView.View>
        <GridView>
            <GridViewColumn Header="Line" Width="Auto" DisplayMemberBinding="{Binding Line}" />
            <GridViewColumn Header="Error" Width="Auto" DisplayMemberBinding="{Binding Error}" />
        </GridView>
    </ListView.View>
</ListView> 
```

当我希望 ListView 出现时，我想从 0 开始对列表视图的高度进行动画处理。问题是，我不知道 ListView 的最终高度，因为它取决于其中显示了多少项目。反正有这样做吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T00:18:38.143

当您花费数小时寻找解决方案，将问题发布到论坛然后在 10 分钟后自己找到答案时，您不讨厌它吗？

无论如何，我通过像这样应用布局比例变换来让它工作

```
<DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="ErrorDisplay" Storyboard.TargetProperty="(FrameworkElement.LayoutTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)">
    <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0"/>
    <SplineDoubleKeyFrame KeyTime="00:00:00.3000000" Value="1"/>
</DoubleAnimationUsingKeyFrames> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-16T19:14:18.467

这不是完全相同的情况，但它可能会帮助其他人。

我有一个高度为 Auto 的边框，我希望它动画到一个特定的高度。

我的边界看起来像这样：

```
<Border Name="ContainerBorder">
  <!-- Stuff... -->
</Border> 
```

我创建了这个故事板：

```
<Storyboard x:Key="EditIn">
  <DoubleAnimation Storyboard.TargetProperty="Height"
                   Storyboard.TargetName="ContainerBorder"
                   Name="BorderAnimation"
                   To="45"
                   Duration="0:0:0.8" />
</Storyboard> 
```

触发动画的按钮有一些代码隐藏：

```
private void Edit_Click(object sender, RoutedEventArgs e) {
  Storyboard sb = (Storyboard)FindResource("EditIn");
  //Find the border animation
  DoubleAnimation da = (DoubleAnimation)sb.Children.Where(t => t.Name == "BorderAnimation").FirstOrDefault();
  if (da != null) { da.From = ContainerBorder.ActualHeight; }
  sb.Begin(this);
} 
```

所以，我简单地找到了边框，并将动画的“From”属性设置为 FrameworkElement 的 ActualHeight。

# c# - 如果查询没有返回值，在返回的对象中使用“-1”的标记值是否被认为是不好的做法？

> ID：804866
> 
> 赞同：1
> 
> 时间：2009-04-30T00:12:07.143
> 
> 标签：c#

我的 DataModel.cs 类中有以下代码：

```
 public User ValidateUser(string Username, string Password)
    {
        DataContext db = new DataContext();

                var query = from u in db.Users where (u.Username == Username && u.Password == Password) select u;

                if (query.Count() != 0)
                {
                    return query.First();
                }
                else
                {
                    return new User { UserID = -1 };
                }
    } 
```

我有一个登录类在我的 DataModel 上调用它，检查用户是否有效。如果用户有效，我希望在我的登录类中引用该“登录”用户（这就是 ValidateUser 返回用户对象的原因）。

现在，如果该用户不存在或密码错误，我只需返回一个空的 User 对象，并将 id 设置为 -1 以将其标记为不是真实用户。

这是不好的做法吗？

我该如何处理这种情况？如果 ValidateUser 只是返回一个布尔值，那不会有问题，但是因为我还需要对该用户的引用，所以我不知道该怎么做。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T00:14:14.860

IMO，这是不好的做法，因为它是隐含的。如果未返回任何内容，则该方法应返回 null。这是不言自明的。

或者，如果它需要与正常情况完全不同的处理或需要额外的信息，您可以考虑抛出异常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T00:38:09.843

我可能只会返回 null 但如果你想要一个标记值，至少让它成为 User 对象上的一个值：

```
public class User
{
    // ... User class goes here

    public static readonly User NullUser = new User();
}

public User ValidateUser(string Username, string Password)
{
    DataContext db = new DataContext();

    var user = db.Users FirstOrDefault(u.Username == Username);

    return user ?? User.NullUser;
} 
```

使用此级别的标记值，您无需查看结果内部以检查其是否无效。这是[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)的一个版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T00:15:02.707

您可以返回 null 或抛出异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T00:15:25.123

您通常会返回`null`以指示搜索失败，但如果您返回`int`索引（例如`Array.Find`或其他内容），则返回 -1 是合理的。

但是，在这种情况下，您的方法名称是`ValidateUser`- 这意味着`bool`结果。所以，我会使用`TryParse`out 参数的约定：

```
 bool ValidateUser(string username, string password, out User user);

 User u;
 if (!ValidateUser(username, password, out u)) {
    // user does not validate, and u is still null
 } 
```

或者，将方法名称更改为类似`GetUser`或`LoginUser`以明确表示它不是一个`true/false`命题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T00:19:07.610

从技术上讲，这是一种被称为幻数的反模式

[http://en.wikipedia.org/wiki/Magic_number_（编程）](http://en.wikipedia.org/wiki/Magic_number_(programming))

另一个程序员可以很容易地使用您的方法并认为这是有效的：

```
public bool DoesUserExist(string u, string p)
{
     return ValidateUser(u,p) != null;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T00:18:29.810

我会坚持使用更传统的方法，比如让我的 User 类实现[IIdentity](http://msdn.microsoft.com/en-us/library/system.security.principal.iidentity_members.aspx)，这样消费者就可以对我的用户调用 IsAuthenticated，而不是从我的 DAL 中检查一些哨兵值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T00:33:44.800

返回 -1 仅在您返回索引时才有意义。

# winapi - winapi - 无意义的文件时间戳？

> ID：804881
> 
> 赞同：0
> 
> 时间：2009-04-30T00:17:06.740
> 
> 标签：winapi, file, timestamp

我似乎无法使用 winapi 函数获得可靠的时间戳。例如：

```
int main(int argc, char *argv[])
{
处理文件；
BY_HANDLE_FILE_INFORMATION 信息；
SYSTEMTIME 系统时间；

文件 = CreateFile("test.txt",GENERIC_READ,FILE_SHARE_READ,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL);
GetFileInformationByHandle(file,&finfo);
FileTimeToSystemTime(&finfo.ftLastWriteTime, &systime);
printf(" %s %02d:%02d:%02d %d/%d/%d\n", "test.txt", systime.wHour,systime.wMinute,systime.wSecond,systime.wDay,systime.wMonth ,systime.w 年）；
}

```

对我的所有文件都毫无意义，例如：

```
测试.txt 00:03:30 33/5/3

```

wDay 的值似乎超出了 1-31 的范围，并且时间和日期完全错误。BY_HANDLE_FILE_INFORMATION 中的所有其他值（如名称和大小）都是正确的，在我的完整代码中，我检查所有函数的错误，但它们都返回通过。有人知道我在做什么错吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T00:21:46.357

我认为问题在于您使用`filesize.QuadPart`. 尝试从格式字符串和参数列表中删除它，看看它是否有效。

如果这有帮助，请查找正确的格式字符串以用于`printf()`.

# php - 帮我结合这些条件来确定此列表项是否以新字母开头

> ID：804887
> 
> 赞同：0
> 
> 时间：2009-04-30T00:18:33.027
> 
> 标签：php

也许我今天过得很糟糕，但我似乎无法将这两个条件合二为一。它们显然应该是，因为它们输出完全相同的数据。以下代码创建一个带有 AZ 的列表作为锚链接，然后用于遍历格式为 的数组`'word'=>'definition'`。我希望 PHP 在每次检测到新字母时输出带有当前字母的 h3 元素。

这是我所拥有的

```
 $letters = range('A', 'Z');
    echo '<em>Jump to:</em><ul class="letters">';
    // anchors
    foreach ($letters as $letter) {            
        echo '<li><a href="#botany-words-' . $letter . '">' . $letter . '</a></li>';      
    }        
    echo '</ul>';        
    // start listing them!        
    $currentLetter = 0;        
    echo '<dl id="botany-words">';

    foreach($content as $botanyWord=>$definition) {

         if ($botanyWord == key(array_slice($content, 0, 1))) { // must be first, aka 'A'

             echo '<h3 id="botany-words-' . $letters[$currentLetter] . '">' . $letters[$currentLetter] . '</h3>';

         } 

        if (substr($botanyWord, 0, 1) != $letters[$currentLetter]) {  // if the first character of this botany word is different to the last              
            echo '<h3 id="botany-words-' . $letters[$currentLetter] . '">' . $letters[$currentLetter] . '</h3>';

            $currentLetter++;
        }
    ?>

        <dt><?php echo $botanyWord; ?></dt>
        <dd><?php // echo $definition; ?></dd>

    <?
    }
    echo '</dl>'; 
```

每次我尝试做

```
if ($botanyWord == key(array_slice($content, 0, 1)) || substr($botanyWord, 0, 1) != $letters[$currentLetter]) 
```

它工作不正常，并且出错，因为它溢出了第 26 个索引（显然是字母表中的 26 个字符）。

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T00:43:53.090

```
$currentLetter = '';
foreach($content as $botanyWord=>$definition) {
  if ( $currentLetter !== $botanyWord[0] ) {
    $currentLetter = $botanyWord[0];
    // 下一个字母 ...如果您的数组在 lex 中。命令
    ...
  }
  ...
}
```

# subsonic - 认证是保留字吗？

> ID：804891
> 
> 赞同：0
> 
> 时间：2009-04-30T00:20:11.103
> 
> 标签：subsonic, reserved-words

使用 Subsonic 2.2 最新的 SVN。

SQL Server 2008 表有一个名为**Accreditation的列**

此列的 Subsonic 生成的属性名为**AccreditationX**

谁能告诉我为什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T02:18:25.297

猜猜它和你的桌子同名......

# integration-testing - WatiN test data reset/clean up

> ID：804892
> 
> 赞同：3
> 
> 时间：2009-04-30T00:20:27.887
> 
> 标签：integration-testing, watin, watir, functional-testing

I'm wondering how people are currently resetting their data / cleaning up test remnants for their WatiN/Wartir tests?

For example, lets say there's a test to add a user into the system and the username has to be unique. Obviously the first run without any users should work fine, but the second run will fail without manual intervention.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T22:56:40.753

There are a couple of strategies that you could do for this, I am assuming that you are using WatiN, with Nunit or VS Unit tests to run your tests.

**Use transactions** An approach that is used when unit testing is that you "wrap" the whole test in a transaction and at the completion of the test roll the transaction back. In .net you can use System.Transactions for this.

**Build a "stub page"** Build a page in your applicaiton that uses the existing business logic to delete your data. This page would need to be secured and ideally not even deployed in to production. This is the approach that I would recommend.

**Call a web service** Develop a web service, or call one directly from the app tier of the applicaiton to perform the delete. You will probably need to develop this as well.

**Clean up directly** Build some classes in your test code to access the data and clean it up.

With any of these you will need to cleanup before and after you run your test, i.e. in the test setup and test cleanup methods. The reason to do it twice is that you should assume that your test has failed and not cleaned up properley.

**Use Linq to Sql** AFAIK if you are using Linq to sql, it works in-memory and wraps the whole update in a transaction for you automatically. If you simply don't call the SubmitChanges(); method then you should be fine, but I haven't tested this myself.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T08:35:32.237

I have asked a developer to make a script that will reset database. After a suite of tests, I just call that script and start from clean database.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T14:40:19.083

Mike - your question isn't unique for Watir/WatiN. It applies for any UI testing, so search around for similar solutions for Selenium, Windmill, and even headless integration tests (HtmlUnit, API tests, etc). I've answered this question a couple times personally on StackOverflow.

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-30T00:58:28.700

WatiN is for UI testing.

In order to test the scenario you are looking for, you can generate user id using the c# code that will make it unique (as against the way it is stored when you created the test).

# c++ - C++ 中 typedef 的前向声明

> ID：804894
> 
> 赞同：263
> 
> 时间：2009-04-30T00:21:06.263
> 
> 标签：c++, typedef, forward-declaration

为什么编译器不让我转发声明 typedef？

假设这是不可能的，保持我的包含树小的最佳做法是什么？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2009-04-30T00:55:33.467

你可以做前向typedef。但是要做

```
typedef A B; 
```

您必须先转发声明`A`：

```
class A;

typedef A B; 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2010-01-19T18:06:37.263

对于像我这样希望在某些 C++ 代码中向前声明使用 typedef 定义的 C 风格结构的人来说，我找到了一个解决方案，如下所示...

```
// a.h
 typedef struct _bah {
    int a;
    int b;
 } bah;

// b.h
 struct _bah;
 typedef _bah bah;

 class foo {
   foo(bah * b);
   foo(bah b);
   bah * mBah;
 };

// b.cpp
 #include "b.h"
 #include "a.h"

 foo::foo(bah * b) {
   mBah = b;
 }

 foo::foo(bah b) {
   mBah = &b;
 } 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2011-08-05T02:01:02.477

要“fwd 声明 typedef”，您需要 fwd 声明一个类或结构，然后您可以 typedef 声明类型。编译器可以接受多个相同的 typedef。

长表：

```
class MyClass;
typedef MyClass myclass_t; 
```

简写：

```
typedef class MyClass myclass_t; 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-04-30T01:04:10.920

在 C++（但不是纯 C）中，对一个类型进行两次 typedef 是完全合法的，只要两个定义*完全相同*：

```
// foo.h
struct A{};
typedef A *PA;

// bar.h
struct A;  // forward declare A
typedef A *PA;
void func(PA x);

// baz.cc
#include "bar.h"
#include "foo.h"
// We've now included the definition for PA twice, but it's ok since they're the same
...
A x;
func(&x); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-30T00:25:24.990

因为要声明一个类型，需要知道它的大小。您可以转发声明一个指向该类型的指针，或者 typedef 一个指向该类型的指针。

如果你真的想要，你可以使用 pimpl idiom 来减少包含。但是如果你想使用类型而不是指针，编译器必须知道它的大小。

编辑：j_random_hacker 为这个答案添加了一个重要的限定条件，基本上需要知道大小才能*使用*类型，但是如果我们只需要知道类型*存在*，则可以进行前向声明，以便创建指向类型。由于 OP 没有显示代码，但抱怨它无法编译，我假设（可能正确）OP 正在尝试*使用*该类型，而不仅仅是引用它。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-01-02T10:34:12.353

仅当您*不*打算使用类型本身（在此文件的范围内）而是使用指针或引用 时，才可以使用前向声明*而不是*完整的 s。`#include`

 *要使用类型本身，编译器必须知道它的大小——因此必须看到它的完整声明——因此`#include`需要一个完整的。

但是，无论指针对象的大小如何，编译器都知道指针或引用的大小，因此前向声明就足够了——它声明了一个类型标识符名称。

有趣的是，当使用指针或引用`class`或`struct`类型时，编译器可以处理*不完整的类型*，从而节省您转发声明指针类型的需要：

```
// header.h

// Look Ma! No forward declarations!
typedef class A* APtr; // class A is an incomplete type - no fwd. decl. anywhere
typedef class A& ARef;

typedef struct B* BPtr; // struct B is an incomplete type - no fwd. decl. anywhere
typedef struct B& BRef;

// Using the name without the class/struct specifier requires fwd. decl. the type itself.    
class C;         // fwd. decl. type
typedef C* CPtr; // no class/struct specifier 
typedef C& CRef; // no class/struct specifier 

struct D;        // fwd. decl. type
typedef D* DPtr; // no class/struct specifier 
typedef D& DRef; // no class/struct specifier 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-10-05T13:30:30.877

我有同样的问题，不想弄乱不同文件中的多个 typedef，所以我通过继承解决了它：

曾是：

```
class BurstBoss {

public:

    typedef std::pair<Ogre::ParticleSystem*, bool> ParticleSystem; // removed this with... 
```

做过：

```
class ParticleSystem : public std::pair<Ogre::ParticleSystem*, bool>
{

public:

    ParticleSystem(Ogre::ParticleSystem* system, bool enabled) : std::pair<Ogre::ParticleSystem*, bool>(system, enabled) {
    };
}; 
```

像魅力一样工作。当然，我不得不从

```
BurstBoss::ParticleSystem 
```

简单地

```
ParticleSystem 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-06-25T15:12:38.803

我用继承和构造函数继承（？）替换了`typedef`（`using`具体来说）。

原来的

```
using CallStack = std::array<StackFrame, MAX_CALLSTACK_DEPTH>; 
```

更换

```
struct CallStack // Not a typedef to allow forward declaration.
  : public std::array<StackFrame, MAX_CALLSTACK_DEPTH>
{
  typedef std::array<StackFrame, MAX_CALLSTACK_DEPTH> Base;
  using Base::Base;
}; 
```

这样我就可以转发声明`CallStack`：

```
class CallStack; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-05-23T13:28:59.740

正如 Bill Kotsias 所指出的，保持点的 typedef 详细信息私有并转发声明它们的唯一合理方法是继承。不过，您可以使用 C++11 做得更好。考虑一下：

```
// LibraryPublicHeader.h

class Implementation;

class Library
{
...
private:
    Implementation* impl;
}; 
```

```
// LibraryPrivateImplementation.cpp

// This annoyingly does not work:
//
//     typedef std::shared_ptr<Foo> Implementation;

// However this does, and is almost as good.
class Implementation : public std::shared_ptr<Foo>
{
public:
    // C++11 allows us to easily copy all the constructors.
    using shared_ptr::shared_ptr;
}; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-06-12T01:11:48.470

像@BillKotsias 一样，我使用了继承，它对我有用。

我改变了这个烂摊子（这需要我的声明 *.h 中的所有 boost 标头）

```
#include <boost/accumulators/accumulators.hpp>
#include <boost/accumulators/statistics.hpp>
#include <boost/accumulators/statistics/stats.hpp>
#include <boost/accumulators/statistics/mean.hpp>
#include <boost/accumulators/statistics/moment.hpp>
#include <boost/accumulators/statistics/min.hpp>
#include <boost/accumulators/statistics/max.hpp>

typedef boost::accumulators::accumulator_set<float,
 boost::accumulators::features<
  boost::accumulators::tag::median,
  boost::accumulators::tag::mean,
  boost::accumulators::tag::min,
  boost::accumulators::tag::max
 >> VanillaAccumulator_t ;
std::unique_ptr<VanillaAccumulator_t> acc; 
```

进入此声明 (*.h)

```
class VanillaAccumulator;
std::unique_ptr<VanillaAccumulator> acc; 
```

并且实施（* .cpp）是

```
#include <boost/accumulators/accumulators.hpp>
#include <boost/accumulators/statistics.hpp>
#include <boost/accumulators/statistics/stats.hpp>
#include <boost/accumulators/statistics/mean.hpp>
#include <boost/accumulators/statistics/moment.hpp>
#include <boost/accumulators/statistics/min.hpp>
#include <boost/accumulators/statistics/max.hpp>

class VanillaAccumulator : public
  boost::accumulators::accumulator_set<float,
    boost::accumulators::features<
      boost::accumulators::tag::median,
      boost::accumulators::tag::mean,
      boost::accumulators::tag::min,
      boost::accumulators::tag::max
>>
{
}; 
```

# php - 每次我包含同一个文件时都会对其进行标记吗？

> ID：804897
> 
> 赞同：2
> 
> 时间：2009-04-30T00:22:25.793
> 
> 标签：php, parsing

这个问题是关于 PHP 解析引擎的。

当我在一个运行时多次包含一个文件时，PHP 是每次都对其进行标记，还是保留一个缓存并在后续包含时运行编译后的代码？

**编辑：**更多细节：我没有使用外部缓存机制，我正在处理在*同一个请求*期间多次包含*同一个*文件。

 ***编辑 2：**我试图包含的文件包含程序代码。我希望它每次都执行`include()`，我只是好奇 PHP 是否出于速度原因在内部跟踪文件的标记化版本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T00:32:48.060

您应该使用 PHP 字节码缓存，例如 APC。这将完成您想要的，在后续请求中重新使用 PHP 页面的编译版本。否则，PHP 会在每次请求时读取文件、标记并编译它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T00:24:05.087

查看[include_once()](http://is.php.net/manual/en/function.include-once.php)。它将再次包含它。

此外，如果您正在使用对象。看看[__autoload()](http://is.php.net/autoload)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T00:32:14.053

默认情况下，每次（真正）包含该文件时都会对其进行解析，即使在同一个 php 实例中也是如此。但是有操作码缓存，例如[apc](http://de.php.net/apc)

```
<?php
$i = 'include_test.php';

file_put_contents($i, '<?php $x = 1;');
包括$i；
回声 $x, ' ';

file_put_contents($i, '<?php $x = 2;');
包括$i；
回声 $x, ' '
```

```
1 2
```

（好的，弱证明。PHP 可以检查文件的 mtime 是否已更改。我认为 apc 所做的。但没有缓存 PHP 真的不会）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T00:59:06.530

我刚刚写了一个基本的测试，很像 VolkerK 的。这是我测试的：

```
<?php
file_put_contents('include.php','<?php echo $i . "<br />"; ?>');

for($i = 0; $i<10; $i++){
    include('include.php');
    if($i == 5){
        file_put_contents('include.php','<?php echo $i+$i; echo "<br />"; ?>');
    }
}

?> 
```

这产生了以下内容：

```
0
1
2
3
4
5
12
14
16
18 
```

因此，除非它基于文件的 mtime 进行缓存，否则它似乎会解析每个包含。您可能希望使用[include_once()](http://ca3.php.net/include_once)而不是标准的 include()。希望有帮助！

# python - mod_wsgi 产生输出缓冲区而不是返回

> ID：804898
> 
> 赞同：4
> 
> 时间：2009-04-30T00:22:32.250
> 
> 标签：python, mod-wsgi, yield

现在我有一个结构如下的 mod_wsgi 脚本..

```
def application(environ, start_response):
    status = '200 OK'
    output = 'Hello World!'

    response_headers = [('Content-type', 'text/plain'),
                    ('Content-Length', str(len(output)))]
    start_response(status, response_headers)

    return [output] 
```

我想知道是否有人知道一种方法可以将其更改为在`yield`基础上操作而不是`return`，这样我就可以在页面生成时发送页面，而不仅仅是在完成后发送，因此页面加载对用户来说可以更快。

但是，每当我将输出交换为列表并在 application() 中生成它时，它都会引发错误：

```
TypeError: sequence of string values expected, value of type list found 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T00:24:28.940

```
def application(environ, start_response):
    status = '200 OK'
    output = 'Hello World!'

    response_headers = [('Content-type', 'text/plain'),
                    ('Content-Length', str(len(output)))]
    start_response(status, response_headers)

    yield output 
```

> *“但是，每当我将输出交换为列表并在 application() 中生成它时，它都会引发错误：”*

好吧，不要产生列表。生成每个元素：

```
for part in mylist:
    yield part 
```

或者如果列表是全部内容，只需：

```
return mylist 
```

因为列表已经是一个迭代器并且可以自己产生。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-24T11:31:38.113

请注意，除非绝对必要，否则应避免“屈服”。特别是如果产生大量小字符串，'yield' 将是低效的。这是因为 WSGI 规范要求在每个字符串产生后必须刷新响应。对于 Apache/mod_wsgi，刷新意味着每个字符串都被强制通过 Apache 输出桶旅和过滤系统并进入套接字。忽略 Apache 输出过滤器系统的开销，将大量的小字符串写入套接字简直是糟糕的开始。

当从应用程序返回字符串数组时也存在此问题，因为还必须在数组中的每个字符串之间执行刷新。这是因为字符串被视为可迭代而不是列表。因此，对于预先形成的字符串列表，最好将各个字符串连接成一个大字符串并返回一个仅包含该字符串的列表。这样做还允许 WSGI 实现自动为响应生成 Content-Length（如果没有显式提供）。

只需确保在将列表中的所有字符串合并为一个时，结果会在列表中返回。如果不这样做，而是返回字符串，则该字符串被视为可迭代的，其中字符串中的每个元素都是单个字符串。这会导致在每个字符之后都进行刷新，这将比没有连接字符串时更糟。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-04T18:20:40.050

不要发送内容长度并在派生时发送输出。如果您根本不发送 Content-Length 标头，则无需知道输出的大小。这种方式可以在您计算其余部分之前发送部分响应。

```
def application(environ, start_response):
    status = '200 OK'
    output = 'Hello World!'

    response_headers = [('Content-type', 'text/html')]
    start_response(status, response_headers)

    yield head()
    yield part1()
    yield part2()
    yield part3()
    yield "<!-- bye now! -->" 
```

否则，您将不会从块中发送任何好处，因为计算输出可能是缓慢的部分，并且互联网协议无论如何都会以块的形式发送输出。

遗憾的是，这在以下情况下不起作用，例如，part2() 的计算决定您确实需要更改标题（如 cookie）或需要构建其他页面全局数据结构 - 如果这种情况发生，您需要在发送标头之前计算整个输出，还不如使用`return [output]`

例如[http://aaron.oirt.rutgers.edu/myapp/docs/W1200_1200.config_template](http://aaron.oirt.rutgers.edu/myapp/docs/W1200_1200.config_template) 需要为显示在页面顶部的小节的链接构建页面全局数据结构——所以最后一个小节必须是在第一个输出块交付给客户端之前呈现。[](http://aaron.oirt.rutgers.edu/myapp/docs/W1200_1200.config_template)

# c# - XNA 模拟游戏对象或解耦你的游戏

> ID：804904
> 
> 赞同：10
> 
> 时间：2009-04-30T00:27:20.617
> 
> 标签：c#, unit-testing, mocking, xna

如果可以模拟 Game 对象以测试我的 DrawableGameComponent 组件，我在徘徊吗？

我知道模拟框架需要一个接口才能运行，但我需要模拟实际的[Game](http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.aspx)对象。

编辑：这里是XNA 社区论坛上各自讨论的[链接。](http://forums.xna.com/forums/t/30645.aspx)有什么帮助吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T06:02:10.433

该论坛上有一些关于单元测试主题的好帖子。这是我个人在 XNA 中进行单元测试的方法：

*   忽略 Draw() 方法
*   在您自己的类方法中隔离复杂的行为
*   测试棘手的东西，其余的不要出汗

这是一个测试示例，以确认我的 Update 方法将实体移动到 Update() 调用之间的正确距离。（我正在使用[NUnit](http://en.wikipedia.org/wiki/NUnit)。）我用不同的移动向量修剪了几行，但你明白了：你不应该需要一个游戏来驱动你的测试。

```
[TestFixture]
public class EntityTest {
    [Test]
    public void testMovement() {
        float speed = 1.0f; // units per second
        float updateDuration = 1.0f; // seconds
        Vector2 moveVector = new Vector2(0f, 1f);
        Vector2 originalPosition = new Vector2(8f, 12f);

        Entity entity = new Entity("testGuy");
        entity.NextStep = moveVector;
        entity.Position = originalPosition;
        entity.Speed = speed;

        /*** Look ma, no Game! ***/
        entity.Update(updateDuration);

        Vector2 moveVectorDirection = moveVector;
        moveVectorDirection.Normalize();
        Vector2 expected = originalPosition +
            (speed * updateDuration * moveVectorDirection);

        float epsilon = 0.0001f; // using == on floats: bad idea
        Assert.Less(Math.Abs(expected.X - entity.Position.X), epsilon);
        Assert.Less(Math.Abs(expected.Y - entity.Position.Y), epsilon);
    }
} 
```

编辑：评论中的其他一些注释：

**我的实体类**：我选择将我所有的游戏对象包装在一个集中的实体类中，看起来像这样：

```
public class Entity {
    public Vector2 Position { get; set; }
    public Drawable Drawable { get; set; }

    public void Update(double seconds) {
        // Entity Update logic...
        if (Drawable != null) {
            Drawable.Update(seconds);
        }
    }

    public void LoadContent(/* I forget the args */) {
        // Entity LoadContent logic...
        if (Drawable != null) {
            Drawable.LoadContent(seconds);
        }
    }
} 
```

这给了我很大的灵活性来制作可能覆盖 Update() 的实体（AIEntity、NonInteractiveEntity...）的子类。它还让我可以自由地对 Drawable 进行子类化，而无需像`AnimatedSpriteAIEntity`,`ParticleEffectNonInteractiveEntity`和`AnimatedSpriteNoninteractiveEntity`. 相反，我可以这样做：

```
Entity torch = new NonInteractiveEntity();
torch.Drawable = new AnimatedSpriteDrawable("Animations\litTorch");
SomeGameScreen.AddEntity(torch);

// let's say you can load an enemy AI script like this
Entity enemy = new AIEntity("AIScritps\hostile");
enemy.Drawable = new AnimatedSpriteDrawable("Animations\ogre");
SomeGameScreen.AddEntity(enemy); 
```

**我的 Drawable 类**：我有一个抽象类，我所有的绘制对象都是从该类派生的。我选择了一个抽象类，因为其中一些行为将被共享。如果您的代码不是这样，那么将其定义为[接口是完全可以接受的。](http://msdn.microsoft.com/en-us/library/ms173156.aspx)

```
public abstract class Drawable {
    // my game is 2d, so I use a Point to draw...
    public Point Coordinates { get; set; }
    // But I usually store my game state in a Vector2,
    // so I need a convenient way to convert. If this
    // were an interface, I'd have to write this code everywhere
    public void SetPosition(Vector2 value) {
        Coordinates = new Point((int)value.X, (int)value.Y);
    }

    // This is overridden by subclasses like AnimatedSprite and ParticleEffect
    public abstract void Draw(SpriteBatch spriteBatch, Rectangle visibleArea);
} 
```

子类定义了它们自己的 Draw 逻辑。在您的坦克示例中，您可以执行以下操作：

*   为每个项目符号添加一个新实体
*   创建一个 TankEntity 类，它定义了一个列表，并覆盖 Draw() 以迭代子弹（它定义了自己的 Draw 方法）
*   制作一个 ListDrawable

这是 ListDrawable 的一个示例实现，忽略了如何管理列表本身的问题。

```
public class ListDrawable : Drawable {
    private List<Drawable> Children;
    // ...
    public override void Draw(SpriteBatch spriteBatch, Rectangle visibleArea) {
        if (Children == null) {
            return;
        }

        foreach (Drawable child in children) {
            child.Draw(spriteBatch, visibleArea);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T16:06:16.823

[MOQ](http://code.google.com/p/moq/)和[Rhino Mocks](http://ayende.com/projects/rhino-mocks.aspx)等框架并不特别需要接口。他们也可以模拟任何非密封和/或抽象类。Game 是一个抽象类，所以你不应该有任何问题来模拟它:-)

至少这两个框架需要注意的一件事是，要对方法或属性设置任何期望，它们必须是虚拟的或抽象的。原因是它生成的模拟实例需要能够覆盖。我相信 IAmCodeMonkey 提到的 typemock 可以解决这个问题，但我不认为 typemock 是免费的，而我提到的两个是免费的。

顺便说一句，您还可以查看我的一个项目，它可以帮助为 XNA 游戏创建单元测试，而无需制作模拟：[http ://scurvytest.codeplex.com/](http://scurvytest.codeplex.com/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-05T17:31:58.100

你不必嘲笑它。为什么不制作一个假游戏对象？

从 Game 继承并覆盖您打算在测试中使用的方法，以便为您需要的任何方法/属性返回预设值或快捷计算。然后将假货传递给您的测试。

在模拟框架之前，人们推出了他们自己的模拟/存根/假货——也许它没有那么快速和容易，但你仍然可以。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-04T12:46:36.907

你可以使用一个名为 TypeMock 的工具，我相信它不需要你有一个界面。您的另一个更常用的方法是创建一个继承自 Game 的新类，并实现您创建的与 Game 对象匹配的接口。然后，您可以针对该接口进行编码并传入您的“自定义”游戏对象。

```
public class MyGameObject : Game, IGame
{
    //you can leave this empty since you are inheriting from Game.    
}

public IGame
{
    public GameComponentCollection Components { get; set; }
    public ContentManager Content { get; set; }
    //etc...
} 
```

它有点乏味，但它可以让你实现可模拟性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T07:48:17.247

如果你不介意的话，我会背上你的帖子，因为[我](https://stackoverflow.com/questions/799869/unit-testing-xna-do-i-need-to-mock-my-graphicsdevice)的帖子似乎不太活跃，而且你已经把你的代表放在了线上；）

当我阅读您的帖子（包括此处和 XNAForum）时，我认为这既是框架可能更平易近人，也是我（我们的）设计并非完美无缺。

该框架可以设计得更容易扩展。我很难相信[肖恩](http://forums.xna.com/forums/p/30645/173406.aspx#173406)[关于接口性能命中](https://stackoverflow.com/questions/828476/does-coding-towards-an-interface-rather-then-an-implementation-imply-a-performanc)的主要论点。为了支持我，[他的同事](http://forums.xna.com/forums/p/30645/173421.aspx#173421)说性能命中可以很容易地规避。
请注意，该框架已经具有 IUpdatable 和 IDrawable 接口。为什么不一路走？

另一方面，我也认为我（和你）的设计确实不是完美无缺的。在我不依赖 Game 对象的地方，我确实非常依赖 GraphicsDevice 对象。我要看看我怎么能绕过这个。它会使代码变得更复杂，但我认为我确实可以打破这些依赖关系。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T06:34:58.937

对于这样的事情的起点，我会点击[XNA WinForms Sample](http://creators.xna.com/en-US/sample/winforms_series1)。使用此示例作为模型，在 WinForm 中可视化组件的一种方法似乎是为它创建一个控件，其样式与示例中的 SpinningTriangleControl 相同。这演示了如何在没有 Game 实例的情况下呈现 XNA 代码。游戏真的不重要，重要的是它为你做了什么。因此，您要做的是创建一个库项目，该项目在一个类和您的其他项目中具有组件的加载/绘制逻辑，创建一个控件类和一个组件类，它们是各自环境中库代码的包装器。这样，您的测试代码就不会重复，您不必担心编写在两种不同场景中始终可行的代码。

# css - 在窗口调整大小时调整页眉和页脚宽度

> ID：804914
> 
> 赞同：1
> 
> 时间：2009-04-30T00:34:07.310
> 
> 标签：css

我已经将自己编码到一个角落，或者我正在监督这里明显的事情。我有一个设计如下的半流体 CSS 布局：

标题 - 始终为 100% 宽度，包含 x 次重复的背景图像

容器 - 流体（960px 到 1200px，居中，包含两列）

页脚 - 始终为 100% 宽度，包含 x 次重复的背景图像

在几乎所有情况下，这都可以正常工作。

总之，整个设计可以缩放到任何宽度，但内容部分最大只能到 1200px。但是，由于这涉及照片网站，有时图像比容器宽度 1200 像素宽，并且图像会脱离它。这很好，我希望显示完整的图像。但是，我希望页眉和页脚缩放到最宽的元素，在这种情况下是图像。当我将窗口大小调整为小于图像的宽度然后使用水平滚动条向右滚动时，这不会发生并且特别麻烦：它在页眉和页脚上留下了明显的间隙，而我希望它们拉伸到至少图像/内容宽度。

仅将宽度设置为 100% 是不够的，因为这涉及视口，而不是内容宽度。我可以对页眉和页脚强制使用具有较大值的 min-width，但这会在正常分辨率下留下水平滚动条。我可以使用 overflow:hidden 隐藏该滚动条，但是当窗口很小时，这会截断内容并且不显示滚动条。

长话短说，我想我想要的是这种布局可以像表格一样工作：如果一列的内容比它的大小更宽，它会将所有其他行推到相同的宽度。最大宽度决定总宽度。我更喜欢没有 javascript 的解决方案，但我认为这是不可能的，或者我正在监督一些非常明显的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T00:53:08.170

100% width 将元素的宽度设置为包含它的元素宽度的 100%。在您的情况下，这似乎是窗口本身（或 body 元素）。要使页眉和页脚 div（我假设您在这里使用 div）随图像缩放，它们可能需要包含在图像所在的同一 div 中，或者包含在图像 div 的 div 中也在，假设 div 正在缩放到正确的宽度（不要假设它正在缩放以适合图像）。

但是，在许多情况下，使用表格进行布局会更干净，并且可以处理您正在寻找的水平缩放类型，而无需求助于 css hack。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T00:41:58.350

> 长话短说，我想我想要的是这种布局可以像桌子一样工作

display: table 在这些元素的公共容器上， display: table-row 或 table-cell 在其子元素上。这在 IE6 中不起作用，但可以通过其 CSS 表达式 () hack 来模拟这一点。

但是，我宁愿建议您根本不要设置最大宽度，并根据用户所需的窗口大小让设计更好地流动。

# button - aSlot.click do |按钮，左，上| ＃ 帮助？

> ID：804922
> 
> 赞同：0
> 
> 时间：2009-04-30T00:38:18.797
> 
> 标签：button, click, shoes

“按钮”以什么格式存储？

```
if button == 1 
```

不适用于测试鼠标左键单击。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T00:42:58.380

在您的处理程序中尝试调用 debug(button)

但是点击做|按钮，左，上| ... end 似乎给了我 1 = 鼠标左键，2 = 鼠标中键，3 = 鼠标右键，所以也许你做错了什么；）

# api - 短信 API 建议

> ID：804924
> 
> 赞同：0
> 
> 时间：2009-04-30T00:40:15.377
> 
> 标签：api, sms

我正在寻找几个 SMS api。基本上是从手机接收短信。有什么建议么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-04-23T18:33:28.057

有两个基本的“SMS API”：SMPP 和 HTTP。

SMPP 接口是蜂窝电话公司内部以及 SMS 发送/接收客户端与那些电信公司和[SMS 聚合器](http://itlaw.wikia.com/wiki/SMS_aggregator)之间使用的全球标准。我建议阅读[SMPP v5.0](http://www.csoft.co.uk/documents/smppv50.pdf "SMPP v5.0")规范。对 SMPP 的一般国际支持声称“符合 SMPP v3.4”，但在操作上，SMPP v5.0 与 3.4 相比几乎没有变化，只是文档要好得多。SMPP v3.4 规范文档有点稀疏，SMS 论坛用 5.0 版本大大增强了规范文档。

SMPP 是记录在两个节点之间发送和接收 SMS 的方法的规范：ESME 或客户端，即您，以及 MC 或“电信”端，即您与之签约的电话公司或 SMS 聚合器连接到国际短信基础设施。

如果您要实现大容量，则需要 SMPP，即：每秒多条 SMS。SMPP 协议是在 TCP 上运行的二进制 PDU 请求/响应对协议。基本的请求/响应对协议相对简单，但 SMPP 规范有许多扩展，在现实世界中，由于扩展的数量庞大以及各种软件和电信公司实现 SMPP 的各种功能的方式不一致，事情变得相当复杂. 使用 SMPP 要求您有一个持续运行的守护程序/服务以提供实时 SMPP 对等通信设施，并且不能仅在 Web 应用程序代码中实现。将 SMPP 集成到 Web 应用程序中需要开发一个守护程序/服务来处理 SMPP ESME / MC 对的 ESME 部分，

SMPP 库的一个示例是[Logica](http://opensmpp.logica.com)。Logica 是开发 SMPP SMSC 的先驱，并将该库作为开源发布。在 Windows 上运行的极少数之一。大多数开源 SMPP 代码在 *nix 上运行。

或者，可以使用第三方[SMPP 网关](http://en.wikipedia.org/wiki/SMS_gateway)软件。到目前为止，最广泛采用的开源 SMPP 服务器是[Kannel](http://www.kannel.org/)。我知道有几个使用它的 SMS 聚合器。当您询问 PHP 并且我认为 Linux 时，与 Kannel 集成可能是您最好的选择。我确实警告您，配置起来很重要。还有一些非开源的可用，例如[Ozeki Message Server](http://www.ozeki.hu/index.php?owpn=419)和[Nordic Messaging Technologies 的 Enterprise Message Server (EMG)。](http://www.nordicmessaging.se/tech-notes/emg/emg-and-smpp-33-vs-smpp-34.html) 这两种产品都提供了比 Kannel 更“交钥匙”的解决方案，并且可能更适合您的使用。

对于容量较小的应用程序，实现到 SMS 聚合器的 HTTP 接口要简单得多*。*有许多 SMS 聚合器提供 HTTP 接口。没有通用标准，但几乎所有标准都提供了一个相对简单的 GET/POST HTTP 接口，该接口很容易集成到 Web 应用程序或任何支持 HTTP GET/POST 的软件环境中。SMS 聚合器通常还提供一些基于文件或 XML 的接口，用于更高容量的发送。正如上面的读者所提到的，[Clickatell](http://www.clickatell.com/)是 SMS Aggregator 的一个例子，他们被认为是“行业的先驱”。另一个例子，我使用的是[Routo Messaging](http://www.routomessaging.com)。

每个 SMS Aggregator 都有自己的 HTTP API，但大多数都支持相同的服务。此外，他们中的大多数都提供一些免费的测试学分。我已经编写了代码来测试其中的几个，这是一个简单的几个小时的过程，一旦你编写了一个，通常不到一个小时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T01:13:16.123

如果您正在寻找短信服务提供商？你可以试试[Clickatell](http://www.clickatell.com/developers.php)

如果你想创建一个 sms api，请查看[Twitter API](http://apiwiki.twitter.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-12T04:19:52.253

您可以使用[SMSSync](http://smssync.ushahidi.com/)，一个免费和开源的 Android 短信网关。

它将在您的 Android 手机上接收 SMS，然后对您在应用程序中指定的 URL 执行 HTTP POST。

但是，像这样的笔记服务会有吞吐量限制（大约每 6 秒 1 条短信），您必须管理“短信网关”的“托管”。如果您负担得起，您可能需要考虑虚拟 SMS 提供商，例如[Nexmo](http://nexmo.com/)和[Hoiio API](http://developer.hoiio.com/docs/sms_receive.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-29T13:24:57.983

我们正在使用[smsapi.pl](http://www.smsapi.pl/)，但到目前为止只有波兰语支持（它可能很快就会改变）。也许你应该检查[这个](http://www.hqsms.com/help-api/https-api-interface)- 你会在那里找到 https 规范。他们也有邮件到短信接口。

# css - 使外部 div 自动与其浮动内容高度相同

> ID：804926
> 
> 赞同：95
> 
> 时间：2009-04-30T00:41:09.180
> 
> 标签：css, html, css-float

我想要黑色的外部`div`，将其`div`s 包裹在其中浮动。我不想在 id 中使用`style='height: 200px`，`div`因为`outerdiv`我希望它自动成为其内容的高度（例如，浮动`div`s）。

```
<div id='outerdiv' style='border: 1px solid black;background-color: black;'>
<div style='width=300px;border: red 1px dashed;float: left;'>
    <p>xxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
</div>

<div style='width=300px;border: red 1px dashed;float: right;'>
    <p>zzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p>
</div> 
```

如何做到这一点？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-04-30T00:44:10.263

您可以将`outerdiv`'s CSS 设置为此

```
#outerdiv {
    overflow: hidden; /* make sure this doesn't cause unexpected behaviour */
} 
```

您也可以通过在末尾添加一个元素来做到这一点`clear: both`。这可以正常添加，使用 JS（不是一个好的解决方案）或使用`:after`CSS 伪元素（在较旧的 IE 中不广泛支持）。

问题是容器不会自然地扩展到包含浮动的孩子。请注意使用第一个示例，如果您在父元素之外有任何子元素，它们将被隐藏。您也可以使用 'auto' 作为属性值，但如果任何元素出现在外部，这将调用滚动条。

您也可以尝试浮动父容器，但根据您的设计，这可能是不可能/困难的。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-30T00:53:13.270

首先，我强烈建议您在外部 CSS 文件中进行 CSS 样式设置，而不是内联。它更容易维护，并且可以使用类更可重用。

解决亚历克斯的“在末尾添加一个带有 clear: both 的元素”的答案（和 Garret 的 clearfix），你可以这样做：

```
 <div id='outerdiv' style='border: 1px solid black; background-color: black;'>
        <div style='width: 300px; border: red 1px dashed; float: left;'>
            <p>xxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
        </div>

        <div style='width: 300px; border: red 1px dashed; float: right;'>
            <p>zzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p>
        </div>
        <div style='clear:both;'></div>
    </div> 
```

这行得通（但你可以看到内联 CSS 不是那么漂亮）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-30T00:48:04.873

您可能想尝试自动关闭浮动，详情请参阅[http://www.sitepoint.com/simple-clearing-of-floats/](http://www.sitepoint.com/simple-clearing-of-floats/)

所以也许尝试任何一个`overflow: auto`（通常有效），或者`overflow: hidden`，正如亚历克斯所说。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-10-11T20:51:21.450

我知道有些人会恨我，但我发现`display:table-cell`在这种情况下可以提供帮助。

它真的更干净。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-30T00:51:07.877

首先，您不要使用`width=300px`标签的属性设置而不是 CSS，`width: 300px;`而是使用它。

我建议`clearfix`在`#outerdiv`. [Clearfix](http://www.webtoolkit.info/css-clearfix.html)是清除 2 个浮动 div 的通用解决方案，因此父 div 将扩展以容纳 2 个浮动 div。

```
<div id='outerdiv' class='clearfix' style='width:600px; background-color: black;'>
    <div style='width:300px; float: left;'>
        <p>xxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
    </div>

    <div style='width:300px; float: left;'>
        <p>zzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p>
    </div>
</div> 
```

这是您的情况的[示例](http://www.webtoolkit.info/demo/css/clearfix/demo.html)以及 Clearfix 为解决该问题所做的工作。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-12-20T12:09:59.233

使用 jQuery：

设置父高度 = 子偏移高度。

```
$(document).ready(function() {
    $(parent).css("height", $(child).attr("offsetHeight"));
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-07T20:30:15.087

采用`clear: both;`

我花了一个多星期试图弄清楚这一点！

# .net - 我可以直接从 BackgroundWorker 的 DoWork 处理程序触发事件吗？

> ID：804927
> 
> 赞同：1
> 
> 时间：2009-04-30T00:41:18.790
> 
> 标签：.net, winforms, multithreading

我是第一次使用BackgroundWorker，使用还不完全清楚。我可以直接从 DoWork 处理程序发送事件，还是我必须改为调用 ReportEvents 并从 ProgressChanged 处理程序发送事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T01:37:10.153

虽然在技术上可以从内部引发事件并使用 UI `DoWork`，但您必须像在任何其他线程中一样（通过使用`Invoke()`或`BeginInvoke()`用于 UI 交互，或为其他跨线程操作进行适当的线程同步）这样做，这将违背`BackgroundWorker`.

更好的选择是调用`ReportProgress()`，然后`ProgressChanged`以线程安全的方式引发事件。您传递一个`int`表示完成百分比的参数（尽管实际操作取决于您），以及（可选）`object`您需要获取有关事件或进度的特定信息的任何参数。在 ProgressChanged 中，您可以与 UI 交互、引发事件等。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2013-01-29T17:39:28.910

只需将其添加到代码中。

```
void new control.CheckForIllegelCrossPathThreads == false; 
```

# usability - 阅读网页时如何让光标跟随文本？

> ID：804929
> 
> 赞同：0
> 
> 时间：2009-04-30T00:41:26.417
> 
> 标签：usability

我知道这与程序并不*严格*相关，但我想我之前已经在 SO 上看到过这个答案并且忘记了它。

具体问题与阅读电子文档有关。我发现在阅读单词时将光标移动到单词上很有帮助。这适用于 Word 文档，但我无法使用网页。有没有办法让网页看到并响应光标移动？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T00:57:42.090

我不确定当光标移动时您实际上想要做什么，但是您可以使用所述元素的**onMouseMove**事件捕获鼠标在元素上的移动。

像这样：

```
<div id="a" onMouseMove="doSomething(event.clientX, event.clientY)">
   Mouse over me!
</div> 
```

当鼠标移到 DIV 上时，这会将当前 X 和 Y 坐标发送到“doSomething()”函数

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T01:02:40.360

在 Firefox 中，您可以通过转到 about:config 并修改accessibility.browsewithcaret 设置来完成此操作。（在过滤器字段中键入“插入符号”，然后右键单击以更改布尔设置的值）

# language-agnostic - 从任何基数的比率展开中获取特定数字（x/y 的第 n 位）

> ID：804934
> 
> 赞同：7
> 
> 时间：2009-04-30T00:43:53.777
> 
> 标签：language-agnostic, math, puzzle

有没有一种算法可以计算重复小数比的位数而无需从头开始？

我正在寻找一种不使用任意大小整数的解决方案，因为这应该适用于十进制扩展可能任意长的情况。

例如，33/59 扩展为 58 位的重复小数。如果我想验证这一点，我如何计算从第 58 位开始的数字？

已编辑 - 比率为 2124679 / 2147483647，如何获得第 2147484600 到第 2147484700 位的百位数字。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-03T14:20:22.837

好的，第三次尝试是一个魅力:)

我不敢相信我忘记了模幂运算。

因此，从我的第二个答案中窃取/总结，x/y 的第 n 个数字是 (10 ^(n-1) x mod y)/y = floor(10 * (10 ^(n-1) x mod y) / y)的第一个数字模式 10。

一直占用的部分是 10 ^(n-1) mod y，但我们可以通过快速 (O(log n)) 模幂运算来做到这一点。有了这个，就不值得尝试循环查找算法了。

但是，您确实需要执行 (a * b mod y) 的能力，其中 a 和 b 是可能与 y 一样大的数字。（如果 y 需要 32 位，那么您需要执行 32x32 乘法，然后执行 64 位 % 32 位模数，或者您需要一个绕过此限制的算法。请参阅下面的清单，因为我在 Javascript 中遇到了这个限制。 )

所以这里有一个新版本。

```
function abmody(a,b,y)
{
  var x = 0;
  // binary fun here
  while (a > 0)
  {
    if (a & 1)
      x = (x + b) % y;
    b = (2 * b) % y;
    a >>>= 1;
  }
  return x;
}

function digits2(x,y,n1,n2)
{
  // the nth digit of x/y = floor(10 * (10^(n-1)*x mod y) / y) mod 10.
  var m = n1-1;
  var A = 1, B = 10;
  while (m > 0)
  {
    // loop invariant: 10^(n1-1) = A*(B^m) mod y

    if (m & 1)
    {
      // A = (A * B) % y    but javascript doesn't have enough sig. digits
      A = abmody(A,B,y);
    }
    // B = (B * B) % y    but javascript doesn't have enough sig. digits
    B = abmody(B,B,y);
    m >>>= 1;
  }

  x = x %  y;
  // A = (A * x) % y;
  A = abmody(A,x,y);

  var answer = "";
  for (var i = n1; i <= n2; ++i)
  {
    var digit = Math.floor(10*A/y)%10;
    answer += digit;
    A = (A * 10) % y;
  }
  return answer;
} 
```

（您会注意到 的结构`abmody()`和模幂运算是相同的；两者都基于[俄罗斯农民乘法](http://en.wikipedia.org/wiki/Ancient_Egyptian_multiplication#Peasant_multiplication)。）结果：

```
js>digits2(2124679,214748367,214748300,214748400)
20513882650385881630475914166090026658968726872786883636698387559799232373208220950057329190307649696
js>digits2(122222,990000,100,110)
65656565656
js>digits2(1,7,1,7)
1428571
js>digits2(1,7,601,607)
1428571
js>digits2(2124679,2147483647,2147484600,2147484700)
04837181235122113132440537741612893408915444001981729642479554583541841517920532039329657349423345806 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T15:02:02.683

**编辑：（**我在这里为后代留下帖子。但*请*不要再投票了：它在理论上可能有用，但实际上并不实用。我发布了另一个从实际角度来看更有用的答案，不'不需要任何因式分解，也不需要使用 bignums。）

* * *

我认为@Daniel Bruckner 的方法是正确的。（需要一些额外的扭曲）

也许有一种更简单的方法，但以下方法总是有效的：

除了 33/59 之外，让我们使用示例 q = x/y = 33/57820 和 44/65，原因可能很快就会清楚。

**第 1 步：分解分母**（特别是分解出 2 和 5）

写出 q = x/y = x/(2 ^(a [2]) 5 ^(a [5]) z)。分母中的因数 2 和 5 不会导致小数重复。所以剩下的因子 z 是 10 的互质数。事实上，下一步需要对 z 进行因子分解，所以你不妨考虑整个事情。

计算 a [10] = max(a [2] , a [5] )，它是 10 的最小指数，它是 y 中 2 和 5 的因子的倍数。

在我们的示例中，57820 = 2 * 2 * 5 * 7 * 7 * 59，所以 a [2] = 2，a [5] = 1，a [10] = 2，z = 7 * 7 * 59 = 2891。

在我们的示例 33/59 中，59 是一个素数并且不包含 2 或 5 的因数，因此 a [2] = a [5] = a [10] = 0。

在我们的示例中，44/65，65 = 5*13，a [2] = 0，a [5] = a [10] = 1。

仅供参考，我在[这里](http://www.alpertron.com.ar/ECM.HTM)找到了一个很好的在线保理计算器。（甚至对下一步很重要的totients）

**第 2 步：使用[欧拉定理](http://en.wikipedia.org/wiki/Euler%27s_theorem)或[卡迈克尔定理](http://en.wikipedia.org/wiki/Carmichael_function)。**

我们想要的是一个数 n，使得 10 ^n - 1 可以被 z 整除，或者换句话说，10 ^n ≡ 1 mod z。Euler 函数 φ(z) 和 Carmichael 函数 λ(z) 都将为您提供有效的 n 值，其中 λ(z) 为您提供较小的数字，而 φ(z) 可能更容易计算。这并不难，它只是意味着分解 z 并做一些数学运算。

φ(2891) = 7 * 6 * 58 = 2436

λ(2891) = lcm(7*6, 58) = 1218

这意味着 10 ^(2436) ≡ 10 ^(1218) ≡ 1 (mod 2891)。

对于更简单的分数 33/59，φ(59) = λ(59) = 58，所以 10 ^(58) ≡ 1 (mod 59)。

对于 44/65 = 44/(5*13)，φ(13) = λ(13) = 12。

**所以呢？**嗯，重复小数的周期必须同时除以 φ(z) 和 λ(z)，因此它们有效地为您提供了重复小数周期的上限。

**第 3 步：更多数字运算**

让我们使用 n = λ(z)。如果我们从 Q'' = 10 ^((a) ^([10]) ^(+ n) x/y 中减去 Q' = 10) ^(a [10]) x /y，我们得到：

m = 10 ^(a [10]) (10 ^n - 1)x/y

**这是一个整数**，因为 10 ^(a [10])是 y 的 2 和 5 的因数的倍数，而 10 ^n -1 是 y 的其余因数的倍数。

我们在这里所做的是将原始数字q左移[10]位得到Q'，并将q左移[10] + n位得到Q''，它们是重复小数，但它们之间的区别是我们可以计算的整数。

然后我们可以将 x/y 重写为 m / 10 ^(a [10]) / (10 ^n - 1)。

考虑示例 q = 44/65 = 44/(5*13)

a [10] = 1，λ(13) = 12，所以 Q' = 10 ¹ q 和 Q'' = 10 ^(12+1) q。

m = Q'' - Q' = (10 ^(12) - 1) * 10 ¹ * (44/65) = 153846153846*44 = 6769230769224

所以 q = 6769230769224 / 10 / (10 ^(12) - 1)。

其他分数 33/57820 和 33/59 导致更大的分数。

**第 4 步：找出不重复和重复的小数部分。**

请注意，对于介于 1 和 9 之间的 k，k/9 = 0.kkkkkkkkkkkkk...

同样请注意，1 到 99 之间的两位数 kl，k/99 = 0.klklklklklkl...

这概括了：对于 k 位模式 abc...ij，这个数字 abc...ij/(10 ^k -1) = 0.abc...ijabc...ijabc...ij...

如果你遵循这个模式，你会发现我们要做的就是把我们在上一步中得到的这个（可能的）巨大整数 m，写成 m = s*(10 ^n -1) + r，其中 1 ≤ r < 10 ^n -1。

这导致了最终的答案：

*   s 是非重复部分
*   r 是重复部分（必要时在左边补零以确保它是 n 位）
*   [10] = 0 ，小数点在非重复部分和重复部分之间；如果 a [10] > 0 则它位于s 和 r 之间的连接点左侧[10 个位置。]

对于 44/65，我们得到 6769230769224 = 6 * (10 ^(12) -1) + 769230769230

s = 6, r = 769230769230, and 44/65 = 0.6769230769230 其中下划线表示重复部分。

您可以通过在步骤 2 中找到 n 的最小值来减小数字，方法是从 Carmichael 函数 λ(z) 开始，并查看它的任何因子是否导致 n 值满足 10 ^n ≡ 1 (mod z)。

**更新：**对于好奇的人，Python interpeter 似乎是使用 bignums 进行计算的最简单方法。（pow(x,y) 计算 x ^y， // 和 % 分别是整数除法和余数。）这是一个例子：

```
>>> N = pow(10,12)-1
>>> m = N*pow(10,1)*44//65
>>> m
6769230769224
>>> r=m%N
>>> r
769230769230
>>> s=m//N
>>> s
6
>>> 44/65
0.67692307692307696

>>> N = pow(10,58)-1
>>> m=N*33//59
>>> m
5593220338983050847457627118644067796610169491525423728813
>>> r=m%N
>>> r
5593220338983050847457627118644067796610169491525423728813
>>> s=m//N
>>> s
0
>>> 33/59
0.55932203389830504

>>> N = pow(10,1218)-1
>>> m = N*pow(10,2)*33//57820
>>> m
57073676928398478035281909373919059149083362158422691110342442061570390868211691
45624351435489450017295053614666205465236942234520927014873746108612936700103770
32168799723279142165340712556208924247665167762020062262193012798339674852992044
27533725354548599100657212037357315807679003804911795226565202352127291594603943
27222414389484607402282947077135939121411276374956762365963334486336907644413697
68246281563472846765824974057419578000691802144586648218609477689380837080594949
84434451746800415081286751988931165686613628502248356969906606710480802490487720
51193358699411968177101349014181943964026288481494292632307160152196471809062608
09408509166378415773088896575579384296091317883085437564856451054998270494638533
37945347630577654790729851262538913870632998962296783120027672085783465928744379
10757523348322379799377378069872016603251470079557246627464545140089934278796264
26841923209961950882047734347976478727084053960567277758561051539259771705292286
40608785887236250432376340366655136630923555863023175371843652715323417502594258
04219993081978554133517813905223106191629194050501556554825319958491871324801106
88343133863714977516430300933932895191975095122794880664130058803182289865098581
80560359737115185
>>> r=m%N
>>> r
57073676928398478035281909373919059149083362158422691110342442061570390868211691
45624351435489450017295053614666205465236942234520927014873746108612936700103770
32168799723279142165340712556208924247665167762020062262193012798339674852992044
27533725354548599100657212037357315807679003804911795226565202352127291594603943
27222414389484607402282947077135939121411276374956762365963334486336907644413697
68246281563472846765824974057419578000691802144586648218609477689380837080594949
84434451746800415081286751988931165686613628502248356969906606710480802490487720
51193358699411968177101349014181943964026288481494292632307160152196471809062608
09408509166378415773088896575579384296091317883085437564856451054998270494638533
37945347630577654790729851262538913870632998962296783120027672085783465928744379
10757523348322379799377378069872016603251470079557246627464545140089934278796264
26841923209961950882047734347976478727084053960567277758561051539259771705292286
40608785887236250432376340366655136630923555863023175371843652715323417502594258
04219993081978554133517813905223106191629194050501556554825319958491871324801106
88343133863714977516430300933932895191975095122794880664130058803182289865098581
80560359737115185
>>> s=m//N
>>> s
0
>>> 33/57820
0.00057073676928398479 
```

`%`使用可用于零填充的重载 Python字符串运算符，以查看完整的重复数字集：

```
>>> "%01218d" % r
'0570736769283984780352819093739190591490833621584226911103424420615703908682116
91456243514354894500172950536146662054652369422345209270148737461086129367001037
70321687997232791421653407125562089242476651677620200622621930127983396748529920
44275337253545485991006572120373573158076790038049117952265652023521272915946039
43272224143894846074022829470771359391214112763749567623659633344863369076444136
97682462815634728467658249740574195780006918021445866482186094776893808370805949
49844344517468004150812867519889311656866136285022483569699066067104808024904877
20511933586994119681771013490141819439640262884814942926323071601521964718090626
08094085091663784157730888965755793842960913178830854375648564510549982704946385
33379453476305776547907298512625389138706329989622967831200276720857834659287443
79107575233483223797993773780698720166032514700795572466274645451400899342787962
64268419232099619508820477343479764787270840539605672777585610515392597717052922
86406087858872362504323763403666551366309235558630231753718436527153234175025942
58042199930819785541335178139052231061916291940505015565548253199584918713248011
06883431338637149775164303009339328951919750951227948806641300588031822898650985
8180560359737115185' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T01:07:39.430

作为一种通用技术，有理分数有一个非重复部分，后面跟着一个重复部分，如下所示：

```
nnn.xxxxxxxxxrrrrrr
```

`xxxxxxxx`是非重复部分，`rrrrrr`是重复部分。

1.  确定非重复部分的长度。
2.  如果有问题的数字在非重复部分，则直接使用除法计算。
3.  如果有问题的数字在重复部分中，请计算其在重复序列中的位置（您现在知道所有内容的长度），并挑选出正确的数字。

以上是一个粗略的大纲，需要更精确才能在实际算法中实现，但它应该可以帮助您入门。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-01T14:05:23.327

啊哈！caffiend：您对我的其他（较长）答案（特别是“重复余数”）的评论使我得到了一个非常简单的解决方案，即 O(n) 其中 n = 非重复部分的长度之和 + 重复部分，并且只需要整数数字介于 0 和 10*y 之间的数学，其中 y 是分母。

这是一个 Javascript 函数，用于获取有理数 x/y 小数点右侧的第 n 位：

```
function digit(x,y,n) 
{ 
   if (n == 0) 
      return Math.floor(x/y)%10; 
   return digit(10*(x%y),y,n-1);
} 
```

它是递归的而不是迭代的，并且不够聪明，无法检测循环（1/3 的第 10000 位显然是 3，但这一直持续到第 10000 次迭代），但它至少可以工作到堆栈用完记忆。

基本上这是因为两个事实：

*   x/y 的第 n 位是 10x/y 的第 (n-1) 位（例如：1/7 的第 6 位是 10/7 的第 5 位是 100/7 的第 4 位等）
*   x/y 的第 n 位是 (x%y)/y 的第 n 位（例如：10/7 的第 5 位也是 3/7 的第 5 位）

我们可以将其调整为一个迭代例程，并将其与[Floyd 的循环查找算法](http://en.wikipedia.org/wiki/Floyd%27s_cycle-finding_algorithm#Tortoise_and_hare)（我从 Martin Gardner 的专栏中学习为“rho”方法）结合起来，以获得一些可以简化这种方法的方法。

这是一个使用这种方法计算解决方案的 javascript 函数：

```
function digit(x,y,n,returnstruct)
{
  function kernel(x,y) { return 10*(x%y); }

  var period = 0;
  var x1 = x;
  var x2 = x;
  var i = 0;
  while (n > 0)
  {
    n--;
    i++;
    x1 = kernel(x1,y); // iterate once
    x2 = kernel(x2,y);
    x2 = kernel(x2,y); // iterate twice  

    // have both 1x and 2x iterations reached the same state?
    if (x1 == x2)
    {
      period = i;
      n = n % period;
      i = 0; 
      // start again in case the nonrepeating part gave us a
      // multiple of the period rather than the period itself
    }
  }
  var answer=Math.floor(x1/y);
  if (returnstruct)
    return {period: period, digit: answer, 
      toString: function() 
      { 
        return 'period='+this.period+',digit='+this.digit;
      }};
  else
    return answer;
} 
```

以及运行 1/700 的第 n 个数字的示例：

```
js>1/700
0.0014285714285714286
js>n=10000000
10000000
js>rs=digit(1,700,n,true)
period=6,digit=4
js>n%6
4
js>rs=digit(1,700,4,true)
period=0,digit=4 
```

33/59 也是一样：

```
js>33/59
0.559322033898305
js>rs=digit(33,59,3,true)
period=0,digit=9
js>rs=digit(33,59,61,true)
period=58,digit=9
js>rs=digit(33,59,61+58,true)
period=58,digit=9 
```

和 122222/990000（长不重复部分）：

```
js>122222/990000
0.12345656565656565
js>digit(122222,990000,5,true)
period=0,digit=5
js>digit(122222,990000,7,true)
period=6,digit=5
js>digit(122222,990000,9,true)
period=2,digit=5
js>digit(122222,990000,9999,true)
period=2,digit=5
js>digit(122222,990000,10000,true)
period=2,digit=6 
```

这是另一个查找一段数字的函数：

```
// find digits n1 through n2 of x/y
function digits(x,y,n1,n2,returnstruct)
{
  function kernel(x,y) { return 10*(x%y); }

  var period = 0;
  var x1 = x;
  var x2 = x;
  var i = 0;
  var answer='';
  while (n2 >= 0)
  {
    // time to print out digits?
    if (n1 <= 0) 
      answer = answer + Math.floor(x1/y);

    n1--,n2--;
    i++;
    x1 = kernel(x1,y); // iterate once
    x2 = kernel(x2,y);
    x2 = kernel(x2,y); // iterate twice  

    // have both 1x and 2x iterations reached the same state?
    if (x1 == x2)
    {
      period = i;
      if (n1 > period)
      {
        var jumpahead = n1 - (n1 % period);
        n1 -= jumpahead, n2 -= jumpahead;
      }
      i = 0; 
      // start again in case the nonrepeating part gave us a
      // multiple of the period rather than the period itself
    }    
  }
  if (returnstruct)
    return {period: period, digits: answer, 
      toString: function() 
      { 
        return 'period='+this.period+',digits='+this.digits;
      }};
  else
    return answer;
} 
```

我已经包含了您的答案的结果（假设 Javascript # 没有溢出）：

```
js>digit(1,7,1,7,true)
period=6,digits=1428571
js>digit(1,7,601,607,true)
period=6,digits=1428571
js>1/7
0.14285714285714285
js>digit(2124679,214748367,214748300,214748400,true)
period=1759780,digits=20513882650385881630475914166090026658968726872786883636698387559799232373208220950057329190307649696
js>digit(122222,990000,100,110,true)
period=2,digits=65656565656 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T00:57:49.017

特设我没有好主意。也许[连分数](http://en.wikipedia.org/wiki/Continued_fraction)会有所帮助。我会考虑一下...

**更新**

~~根据[费马小定理](http://en.wikipedia.org/wiki/Fermat's_little_theorem)，并且因为 39 是素数，所以以下成立。（`=`表示一致）~~

 ~~```
10^39 = 10 (39) 
```~~ 

因为 10 与 39 互质。

```
10^(39 - 1) = 1 (39)

10^38 - 1 = 0 (39)

[to be continued tomorow] 
```

 ~~我要分层以认识到 39 不是素数... ^^ 我将在接下来的几天内更新答案并提出整个想法。感谢您注意到 39 不是素数。

`a/b`with`a < b`和假定的周期长度的简短答案`p`...

*   计算`k = (10^p - 1) / b`并验证它是一个整数，否则`a/b`没有一个周期`p`
*   计算`c = k * a`
*   转换`c`为其十进制表示并用零填充它，总长度为`p`
*   小数点后的第 i 个数字是填充十进制表示的第 (i mod p) 位（i = 0 是小数点后的第一个数字 - 我们是开发人员）

例子

```
a = 3
b = 7
p = 6

k = (10^6 - 1) / 7
  = 142,857

c = 142,857 * 3
  = 428,571 
```

填充不是必需的，我们得出结论。

```
3     ______
- = 0.428571
7 
```

# java - 如何扩展由另一个类实例化的 java 类？

> ID：804937
> 
> 赞同：2
> 
> 时间：2009-04-30T00:44:49.047
> 
> 标签：java, inheritance

给定两个 java 类 A 和 B，其中 A 通常通过 B 实例化，例如：

```
 A myA = B.createA(); 
```

我可以创建 A 的子类（我们称它为 SubA）并以某种方式通过 B.createA() 方法对其进行实例化吗？

（请注意，我不能修改 A 和 B....）

我知道并非 A 的所有实例都是 SubA 的实例，因此我不能这样做：

```
 SubA mySubA = B.createA(); 
```

同样，我也不能这样投射：

```
 SubA mySubA = (SubA) (B.createA()); 
```

出于同样的原因——它会得到一个 ClassCastException。

我是不是很密集而忘记了一些基本的东西，还是没有办法做到这一点？

（后期添加：很抱歉，我应该提到 A 和 B 各有大约 50 个方法，而我要做的就是向 SubA 添加一个属性，以及一个 getter 和一个 setter。我真的而不是实现 A 的所有 50 个方法来调用超类对象中的相应方法。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T00:49:18.800

这通常通过代理完成：

```
class SubA extends A {
    private A proxiedClass;

    public SubA(A a) {
        proxiedClass = a;
    }

    public int anyMethodInA() {
        return proxiedClass.anyMethodInA();
    }
} 
```

...

```
SubA mySubA = new SubA(B.createA()); 
```

手动执行此操作相当冗长，因此大多数人使用某种 AOP 库（如 AspectJ）来仅拦截他们感兴趣的方法调用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T01:01:26.540

听起来您真正想要的是修改原始`A`和`B`. 在这种情况下，您可以尝试扩展这两个类（其中扩展`B`纯粹是为了指定一个稍微不同的工厂方法来创建`SubA`s）。

```
class SubA extends A {
    /** This is the one special aspect of SubA justifying a sub-class.
        Using double purely as an example. */
    private double specialProperty;

    public double getSpecialProperty() { return specialProperty; }
    public void setSpecialProperty(double newSP) { specialProperty = newSP; }

    public SubA() {
        super();
        // Important differences between SubAs and As go here....
        // If there aren't any others, you don't need this constructor.
    }

    // NOTE: you don't have to do anything else with the other methods of
    // A.  You just inherit those.
}

class SubB extends B {
    // Purely for the purposes of a slightly different factory method
    public A createA() {
        return new SubA();
    }

    // Or if you need a static method 
    // (this is usually instead of the first choice)
    public static A createA() {
        return new SubA();
    }
} 
```

请注意，此时，您可以创建一个`SubB`工厂对象并使其看起来像原始对象，如下所示`B`：

```
B myNewB = new SubB();
A myA = myNewB.createA(); 
```

或者，如果您使用的是静态工厂，则它的匹配度并不高（但它很接近）。

```
A myA = SubB.createA(); 
```

现在，如果你真的需要对子属性做一些事情，你可以通过子界面访问它。即，如果您像这样创建对象：

```
SubA mySubA = SubB.createA();
mySubA.setSpecialProperty(3.14);
double special = mySubA.getSpecialProperty(); 
```

*编辑讨论“后期添加”：*

此时，您的 SubA 对象应该正是您想要的。它将继承父级 (A) 的 50 个方法，您可以将附加属性添加到子级，以及 getter 和 setter。我更改了上面的代码以说明我的意思。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T00:49:40.767

您可以围绕它创建一个包装器，并使用一个作为参数`SubA`的构造函数。`A`

像这样：

```
SubA mySubA = new SubA(B.createA()); 
```

由于 的所有实例`SubA`都是 的实例`A`，因此您可以将其分配给现有`A`变量并覆盖任何必要的方法。

```
A myA = new SubA(B.createA()); 
```

我想不出任何其他干净的方式来做到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T01:23:20.420

如果您只是想在`A`没有面向对象的情况下添加一个字段（例如更改行为），则可以将其添加为“外部字段”。使用 a`WeakHashMap`从实例映射`A`到字段值（只要字段值不直接或间接引用`A`，否则您将遇到对象生命周期争用问题）：

```
private static final Map<A,FieldType> map =
    new java.util.WeakHashMap<A,FieldType>(); // thread-safe from 1.6, IIRC

public static FieldType getField(A a) {
    return map.get(a);
}
public static void setField(A a, FieldType value) {
    map.set(a, value);
} 
```

我们真的应该使用`WeakIdentityHashMap`，但它在 Java 库中不存在！

# jquery - 提交表单不会在 jquery ajax 调用中停止

> ID：804946
> 
> 赞同：8
> 
> 时间：2009-04-30T00:49:34.573
> 
> 标签：jquery, forms, submit

我得到以下代码：

```
$.ajax({
    type: "POST",
    async: false,              
    url: "CheckIdExist",
    data: param,
    success: function(result) {
        if (result == true){
            return false;
        }                                 
    },
    error: function(error) {
        alert(error);
        return false;
    }
}); 
```

如果 ajax 返回值为 true，则表单需要停止提交。

但它不会停止提交表单。

请提供任何帮助。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-30T00:55:53.777

我假设你有类似的东西：

```
form.submit(function(event) {
    $.ajax(...);
}); 
```

您希望`return false`（或调用`event.preventDefault()`）在事件处理函数本身中，而不是在 AJAX 调用中，例如：

```
form.submit(function(event) {
    event.preventDefault();
    $.ajax(...);
}); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-27T17:03:16.150

这个问题的一个细微变化是：我想使用 jquery 和 ajax 向用户显示错误消息，但如果没有错误则进行正常处理。

假设方法“check”返回一个响应，如果没有错误，则该响应为空，如果有错误，则其中包含错误。

然后你可以在你的 ready 函数中做这样的事情：

```
$("#theform").submit(function() {
    var data = { ... }
    $.get('/check', data,
        function(resp) {
            if (resp.length > 0) {
                $("#error").html(resp);
            } else {
                $("#theform").unbind('submit');
                $("#theform").submit();
            }
    });
    event.preventDefault();
}); 
```

那么它是怎样工作的？当外部提交函数被触发时，它会构建 AJAX 调用所需的数据（这里是更高级别的函数 get）。调用被安排，操作的主线程立即继续，但提交被无条件停止，所以没有明显的事情发生。

一段时间过去了，AJAX 调用返回了请求的结果。如果非空，则向用户显示结果。

但是，如果响应为空，则提交函数未绑定。这可以防止系统通过外部提交函数进行额外调用。调用内部提交函数。这会触发对表单目标的实际表单提交，并且生活会按预期进行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T00:54:48.727

您需要进行回调。

[当我遇到这个确切的问题时，FAQ 中的这个条目](http://docs.jquery.com/Frequently_Asked_Questions#How_do_I_get_and_use_the_server_response_from_an_AJAX_request.3F)帮助了我很多。

```
getUrlStatus('getStatus.php', function(status) {
    alert(status);
});

function getUrlStatus(url, callback) {
    $.ajax({
        url: url,
        complete: function(xhr) {
            callback(xhr.status);
        }
    });
} 
```

原因是您不能在 AJAX 函数中返回。

> 由于异步编程的性质，上面的代码不能按预期工作。提供的成功处理程序不会立即调用，而是在将来某个时间从服务器接收到响应时调用。所以当我们在 $.ajax 调用之后立即使用 'status' 变量时，它的值仍然是未定义的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T00:53:20.587

在这种情况下，您需要执行同步 http 请求，即您必须将[async 选项](http://docs.jquery.com/Ajax/jQuery.ajax#options)设置为 false。
在您的版本中，httpxmlrequest 是异步的。它可能在您的 onsubmit 处理程序返回并且在 onsubmit 处理程序的上下文之外调用 onsuccess 回调很长时间后完成。
“return false”将是匿名函数 function(result) {... } 的返回值，而不是 onsubmit 处理程序的返回值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T00:55:51.873

您不能将此代码放在函数中或表单的 onsubmit 中，成功函数将其结果返回到 jQuery ajax 上下文，而不是表单提交上下文。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-12T09:49:22.033

我也遇到了这个问题，但通过将输入 type="submit" 更改为 type="button" 然后只做你的 ajax 请求来解决它

```
 $("input#submitbutton")
    {
                          $.ajax(
                        {                         type: "POST",
                             async: false,              
                            url: "CheckIdExist",
                             data: param,
                            success: function(result) {
                                 if (result == true){
                                    //TODO: do you magic
                                 }                      
                                 else
                                  $("form").submit();           
                             },
                             error: function(error) {
                                alert(error);
                                return false;
                            }
                        });
    }); 
```

# ubuntu - debian/rules makefile 中的变量

> ID：804948
> 
> 赞同：5
> 
> 时间：2009-04-30T00:50:29.237
> 
> 标签：ubuntu, rpm, dpkg

我必须将一个 RPM（为 Fedora 制作）作为 deb 包移植到 Ubuntu。

在 RPM .spec 文件中，我使用了几个变量 ( `$RPM_BUILD_ROOT, %{_libdir}, %{name}, %{version}`) 来创建符号链接：

```
%install
...
(cd $RPM_BUILD_ROOT/%{_bindir}; ln -sf %{_libdir}/%{name}-%{version}/%{name} . ) 
```

（禁止使用相对符号链接（请不要问为什么）——这就是`ln`命令看起来很奇怪的原因。）

`debian/rules`那么， makefile中这些变量的等价物是什么？

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T04:06:14.630

（旁白：这似乎是上游 Makefile 应该做的事情，而不是下游打包。）

取决于您为`rules`文件使用的框架。

在[CDBS](http://build-common.alioth.debian.org/)中，这样的东西应该可以工作......

```
#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
# probably what you want (automagic happens),
# but I don't know details of your package
#include /usr/share/cdbs/1/class/automake.mk

DEBVERS := $(shell dpkg-parsechangelog | sed -n -e 's/^Version: //p')
VERSION := $(shell echo '$(DEBVERS)' | sed -e 's/^[[:digit:]]*://' -e 's/[~-].*//')

install/$(DEB_ALL_PACKAGES)::
        dh_link -p$(cdbs_curpkg) \
                /usr/lib/$(cdbs_curpkg)-$(VERSION)/$(cdbs_curpkg) \
                /usr/bin/$(cdbs_curpkg) 
```

如果您有更好的获取版本的方法（例如`$(shell cat version.txt))`），请使用它。Debian 版本并不总是源包版本；在这里，我去掉了时代和包装版本，如果有的话，但这并不总是正确的。

其他 CDBS 类可能会定义`$${libdir}`and `$${bindir}`，但我没有看到任何常见的东西。

请注意`dh_link`，即使给定绝对路径，也会尽可能建立相对链接。如果这是一个问题，你可能不得不求助于一些非常讨厌的东西，比如

```
 cd debian/$(cdbs_curpkg) && ln -s ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-03-21T22:48:34.573

在较新版本的 dpkg (1.17.0+) 中，您可以获得完整版本：

```
DEBVER := $(shell dpkg-parsechangelog -SVersion) 
```

假设您有`SHELL := /bin/bash`. 只需像这样使用 bash 字符串插值：

```
DEBVERSION := $(shell debver="$(DEBVER)"; echo "$${debver%-*}") 
```

# java - 是否可以从超时的 InputStream 中读取？

> ID：804951
> 
> 赞同：159
> 
> 时间：2009-04-30T00:52:53.380
> 
> 标签：java, timeout, inputstream

具体来说，问题是要写一个这样的方法：

```
int maybeRead(InputStream in, long timeout) 
```

如果数据在 'timeout' 毫秒内可用，则返回值与 in.read() 相同，否则返回 -2。在方法返回之前，任何衍生的线程都必须退出。

为了避免争论，这里的主题是 java.io.InputStream，由 Sun（任何 Java 版本）记录。请注意，这并不像看起来那么简单。以下是 Sun 文档直接支持的一些事实。

1.  in.read() 方法可能是不可中断的。

2.  将 InputStream 包装在 Reader 或 InterruptibleChannel 中没有帮助，因为所有这些类都可以调用 InputStream 的方法。如果可以使用这些类，就可以编写一个直接在 InputStream 上执行相同逻辑的解决方案。

3.  in.available() 返回 0 总是可以接受的。

4.  in.close() 方法可能会阻塞或什么都不做。

5.  没有一般的方法可以杀死另一个线程。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2013-05-01T06:32:10.440

**使用 inputStream.available()**

> *System.in.available() 返回 0 总是可以接受的。*

我发现相反 - 它总是返回可用字节数的最佳值。Javadoc 用于`InputStream.available()`：

```
Returns an estimate of the number of bytes that can be read (or skipped over) 
from this input stream without blocking by the next invocation of a method for 
this input stream. 
```

由于时间/陈旧性，估计是不可避免的。这个数字可能是一次性的低估，因为新数据不断出现。然而，它总是在下一次呼叫时“赶上”——它应该考虑所有到达的数据，除了在新呼叫时到达的数据。当有数据不满足上述条件时，永久返回 0。

**第一个警告： InputStream 的具体子类负责 available()**

`InputStream`是一个抽象类。它没有数据源。拥有可用数据对它来说毫无意义。因此，javadoc for`available()`还指出：

```
The available method for class InputStream always returns 0.

This method should be overridden by subclasses. 
```

实际上，具体的输入流类确实会覆盖 available()，提供有意义的值，而不是常量 0。

**第二个警告：确保在 Windows 中输入时使用回车。**

如果使用`System.in`，您的程序仅在您的命令外壳移交时接收输入。如果您使用文件重定向/管道（例如 somefile > java myJavaApp 或 somecommand | java myJavaApp ），则输入数据通常会立即移交。但是，如果您手动键入输入，则可能会延迟数据交接。例如，使用 windows cmd.exe shell，数据在 cmd.exe shell 中缓冲。数据仅在回车（control-m 或`<enter>`）之后传递给正在执行的 java 程序。这是执行环境的限制。当然，只要 shell 缓冲数据， InputStream.available() 就会返回 0 - 这是正确的行为；那时没有可用的数据。一旦数据从 shell 中可用，该方法就会返回一个 > 0 的值。注意：Cygwin 使用 cmd。

## 最简单的解决方案（没有阻塞，所以不需要超时）

只需使用这个：

```
 byte[] inputData = new byte[1024];
    int result = is.read(inputData, 0, is.available());  
    // result will indicate number of bytes read; -1 for EOF with no data read. 
```

或等效地，

```
 BufferedReader br = new BufferedReader(new InputStreamReader(System.in, Charset.forName("ISO-8859-1")),1024);
    // ...
         // inside some iteration / processing logic:
         if (br.ready()) {
             int readCount = br.read(inputData, bufferOffset, inputData.length-bufferOffset);
         } 
```

## 更丰富的解决方案（在超时时间内最大限度地填充缓冲区）

声明：

```
public static int readInputStreamWithTimeout(InputStream is, byte[] b, int timeoutMillis)
     throws IOException  {
     int bufferOffset = 0;
     long maxTimeMillis = System.currentTimeMillis() + timeoutMillis;
     while (System.currentTimeMillis() < maxTimeMillis && bufferOffset < b.length) {
         int readLength = java.lang.Math.min(is.available(),b.length-bufferOffset);
         // can alternatively use bufferedReader, guarded by isReady():
         int readResult = is.read(b, bufferOffset, readLength);
         if (readResult == -1) break;
         bufferOffset += readResult;
     }
     return bufferOffset;
 } 
```

然后使用这个：

```
 byte[] inputData = new byte[1024];
    int readCount = readInputStreamWithTimeout(System.in, inputData, 6000);  // 6 second timeout
    // readCount will indicate number of bytes read; -1 for EOF with no data read. 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2012-03-23T00:39:39.703

假设您的流不受套接字支持（因此您不能使用`Socket.setSoTimeout()`），我认为解决此类问题的标准方法是使用 Future。

假设我有以下执行程序和流：

```
 ExecutorService executor = Executors.newFixedThreadPool(2);
    final PipedOutputStream outputStream = new PipedOutputStream();
    final PipedInputStream inputStream = new PipedInputStream(outputStream); 
```

我有编写器写入一些数据，然后等待 5 秒钟，然后再写入最后一条数据并关闭流：

```
 Runnable writeTask = new Runnable() {
        @Override
        public void run() {
            try {
                outputStream.write(1);
                outputStream.write(2);
                Thread.sleep(5000);
                outputStream.write(3);
                outputStream.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    };
    executor.submit(writeTask); 
```

正常的阅读方式如下。读取将无限期地阻塞数据，因此这在 5 秒内完成：

```
 long start = currentTimeMillis();
    int readByte = 1;
    // Read data without timeout
    while (readByte >= 0) {
        readByte = inputStream.read();
        if (readByte >= 0)
            System.out.println("Read: " + readByte);
    }
    System.out.println("Complete in " + (currentTimeMillis() - start) + "ms"); 
```

输出：

```
Read: 1
Read: 2
Read: 3
Complete in 5001ms 
```

如果有更根本的问题，比如作者没有回应，读者将永远阻塞。如果我在将来包装读取，则可以按如下方式控制超时：

```
 int readByte = 1;
    // Read data with timeout
    Callable<Integer> readTask = new Callable<Integer>() {
        @Override
        public Integer call() throws Exception {
            return inputStream.read();
        }
    };
    while (readByte >= 0) {
        Future<Integer> future = executor.submit(readTask);
        readByte = future.get(1000, TimeUnit.MILLISECONDS);
        if (readByte >= 0)
            System.out.println("Read: " + readByte);
    } 
```

输出：

```
Read: 1
Read: 2
Exception in thread "main" java.util.concurrent.TimeoutException
    at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:228)
    at java.util.concurrent.FutureTask.get(FutureTask.java:91)
    at test.InputStreamWithTimeoutTest.main(InputStreamWithTimeoutTest.java:74) 
```

我可以捕获 TimeoutException 并进行任何我想要的清理。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2011-09-06T05:36:23.013

如果您的 InputStream 由 Socket 支持，您可以使用[setSoTimeout](http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#setSoTimeout%28int%29)设置 Socket 超时（以毫秒为单位） 。如果 read() 调用没有在指定的超时时间内解除阻塞，它将抛出 SocketTimeoutException。

只需确保在调用 read() 之前在 Socket 上调用 setSoTimeout。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-10-19T23:17:18.740

我会质疑问题陈述，而不是盲目地接受它。您只需要来自控制台或网络的超时。如果您拥有后者`Socket.setSoTimeout()`并且`HttpURLConnection.setReadTimeout()`两者都完全符合要求，只要您在构建/获取它们时正确设置它们。当您所拥有的只是 InputStream 时，将其留在应用程序中的任意点是糟糕的设计，导致非常尴尬的实现。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-30T01:44:25.143

I have not used the classes from the Java NIO package, but it *seems* they might be of some help here. Specifically, [java.nio.channels.Channels](http://java.sun.com/javase/6/docs/api/java/nio/channels/Channels.html) and [java.nio.channels.InterruptibleChannel](http://java.sun.com/javase/6/docs/api/java/nio/channels/InterruptibleChannel.html).

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-30T20:09:14.083

这是一种从 System.in 获取 NIO FileChannel 并使用超时检查数据可用性的方法，这是问题中描述的问题的一种特殊情况。在控制台运行它，不要输入任何输入，然后等待结果。它在 Windows 和 Linux 上的 Java 6 下成功测试。

```
import java.io.FileInputStream;
import java.io.FilterInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.nio.ByteBuffer;
import java.nio.channels.ClosedByInterruptException;

public class Main {

    static final ByteBuffer buf = ByteBuffer.allocate(4096);

    public static void main(String[] args) {

        long timeout = 1000 * 5;

        try {
            InputStream in = extract(System.in);
            if (! (in instanceof FileInputStream))
                throw new RuntimeException(
                        "Could not extract a FileInputStream from STDIN.");

            try {
                int ret = maybeAvailable((FileInputStream)in, timeout);
                System.out.println(
                        Integer.toString(ret) + " bytes were read.");

            } finally {
                in.close();
            }

        } catch (Exception e) {
            throw new RuntimeException(e);
        }

    }

    /* unravels all layers of FilterInputStream wrappers to get to the
     * core InputStream
     */
    public static InputStream extract(InputStream in)
            throws NoSuchFieldException, IllegalAccessException {

        Field f = FilterInputStream.class.getDeclaredField("in");
        f.setAccessible(true);

        while( in instanceof FilterInputStream )
            in = (InputStream)f.get((FilterInputStream)in);

        return in;
    }

    /* Returns the number of bytes which could be read from the stream,
     * timing out after the specified number of milliseconds.
     * Returns 0 on timeout (because no bytes could be read)
     * and -1 for end of stream.
     */
    public static int maybeAvailable(final FileInputStream in, long timeout)
            throws IOException, InterruptedException {

        final int[] dataReady = {0};
        final IOException[] maybeException = {null};
        final Thread reader = new Thread() {
            public void run() {                
                try {
                    dataReady[0] = in.getChannel().read(buf);
                } catch (ClosedByInterruptException e) {
                    System.err.println("Reader interrupted.");
                } catch (IOException e) {
                    maybeException[0] = e;
                }
            }
        };

        Thread interruptor = new Thread() {
            public void run() {
                reader.interrupt();
            }
        };

        reader.start();
        for(;;) {

            reader.join(timeout);
            if (!reader.isAlive())
                break;

            interruptor.start();
            interruptor.join(1000);
            reader.join(1000);
            if (!reader.isAlive())
                break;

            System.err.println("We're hung");
            System.exit(1);
        }

        if ( maybeException[0] != null )
            throw maybeException[0];

        return dataReady[0];
    }
} 
```

有趣的是，当在 NetBeans 6.5 中而不是在控制台中运行程序时，超时根本不起作用，实际上需要调用 System.exit() 来杀死僵尸线程。发生的情况是中断器线程在调用 reader.interrupt() 时阻塞 (!)。另一个测试程序（此处未显示）另外尝试关闭通道，但这也不起作用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-30T09:13:49.230

正如 jt 所说，NIO 是最好的（也是正确的）解决方案。如果你真的被 InputStream 困住了，你可以

1.  生成一个线程，其唯一工作是从 InputStream 中读取并将结果放入缓冲区中，该缓冲区可以从原始线程中读取而不会阻塞。如果您只有一个流实例，这应该可以很好地工作。否则，您可以使用 Thread 类中已弃用的方法终止线程，但这可能会导致资源泄漏。

2.  依靠 isAvailable 表示可以不阻塞读取的数据。但是，在某些情况下（例如使用 Sockets），可能需要进行一次潜在的阻塞读取，以便 isAvailable 报告 0 以外的内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-01-23T00:32:32.710

[在这个答案](https://stackoverflow.com/a/16313762/9465588)的启发下，我想出了一个更面向对象的解决方案。

**这仅在您打算读取字符时才有效**

您可以覆盖 BufferedReader 并实现如下内容：

```
public class SafeBufferedReader extends BufferedReader{

    private long millisTimeout;

    ( . . . )

    @Override
    public int read(char[] cbuf, int off, int len) throws IOException {
        try {
            waitReady();
        } catch(IllegalThreadStateException e) {
            return 0;
        }
        return super.read(cbuf, off, len);
    }

    protected void waitReady() throws IllegalThreadStateException, IOException {
        if(ready()) return;
        long timeout = System.currentTimeMillis() + millisTimeout;
        while(System.currentTimeMillis() < timeout) {
            if(ready()) return;
            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                break; // Should restore flag
            }
        }
        if(ready()) return; // Just in case.
        throw new IllegalThreadStateException("Read timed out");
    }
} 
```

**这是一个几乎完整的例子。**

我在某些方法上返回 0，您应该将其更改为 -2 以满足您的需求，但我认为 0 更适合 BufferedReader 合同。没有发生任何错误，它只是读取了 0 个字符。readLine 方法是一个可怕的性能杀手。如果你真的想使用 readLin e **，你应该创建一个全新的 BufferedReader 。**现在，它不是线程安全的。如果有人在 readLines 等待一行的时候调用了一个操作，将会产生意想不到的结果

我不喜欢在我所在的地方返回 -2。我会抛出一个异常，因为有些人可能只是在检查 int < 0 是否考虑 EOS。无论如何，这些方法声称“不能阻止”，您应该检查该语句是否真的是真的并且不要覆盖它们。

```
import java.io.BufferedReader;
import java.io.IOException;
import java.io.Reader;
import java.nio.CharBuffer;
import java.util.concurrent.TimeUnit;
import java.util.stream.Stream;

/**
 * 
 * readLine
 * 
 * @author Dario
 *
 */
public class SafeBufferedReader extends BufferedReader{

    private long millisTimeout;

    private long millisInterval = 100;

    private int lookAheadLine;

    public SafeBufferedReader(Reader in, int sz, long millisTimeout) {
        super(in, sz);
        this.millisTimeout = millisTimeout;
    }

    public SafeBufferedReader(Reader in, long millisTimeout) {
        super(in);
        this.millisTimeout = millisTimeout;
    }

    /**
     * This is probably going to kill readLine performance. You should study BufferedReader and completly override the method.
     * 
     * It should mark the position, then perform its normal operation in a nonblocking way, and if it reaches the timeout then reset position and throw IllegalThreadStateException
     * 
     */
    @Override
    public String readLine() throws IOException {
        try {
            waitReadyLine();
        } catch(IllegalThreadStateException e) {
            //return null; //Null usually means EOS here, so we can't.
            throw e;
        }
        return super.readLine();
    }

    @Override
    public int read() throws IOException {
        try {
            waitReady();
        } catch(IllegalThreadStateException e) {
            return -2; // I'd throw a runtime here, as some people may just be checking if int < 0 to consider EOS
        }
        return super.read();
    }

    @Override
    public int read(char[] cbuf) throws IOException {
        try {
            waitReady();
        } catch(IllegalThreadStateException e) {
            return -2;  // I'd throw a runtime here, as some people may just be checking if int < 0 to consider EOS
        }
        return super.read(cbuf);
    }

    @Override
    public int read(char[] cbuf, int off, int len) throws IOException {
        try {
            waitReady();
        } catch(IllegalThreadStateException e) {
            return 0;
        }
        return super.read(cbuf, off, len);
    }

    @Override
    public int read(CharBuffer target) throws IOException {
        try {
            waitReady();
        } catch(IllegalThreadStateException e) {
            return 0;
        }
        return super.read(target);
    }

    @Override
    public void mark(int readAheadLimit) throws IOException {
        super.mark(readAheadLimit);
    }

    @Override
    public Stream<String> lines() {
        return super.lines();
    }

    @Override
    public void reset() throws IOException {
        super.reset();
    }

    @Override
    public long skip(long n) throws IOException {
        return super.skip(n);
    }

    public long getMillisTimeout() {
        return millisTimeout;
    }

    public void setMillisTimeout(long millisTimeout) {
        this.millisTimeout = millisTimeout;
    }

    public void setTimeout(long timeout, TimeUnit unit) {
        this.millisTimeout = TimeUnit.MILLISECONDS.convert(timeout, unit);
    }

    public long getMillisInterval() {
        return millisInterval;
    }

    public void setMillisInterval(long millisInterval) {
        this.millisInterval = millisInterval;
    }

    public void setInterval(long time, TimeUnit unit) {
        this.millisInterval = TimeUnit.MILLISECONDS.convert(time, unit);
    }

    /**
     * This is actually forcing us to read the buffer twice in order to determine a line is actually ready.
     * 
     * @throws IllegalThreadStateException
     * @throws IOException
     */
    protected void waitReadyLine() throws IllegalThreadStateException, IOException {
        long timeout = System.currentTimeMillis() + millisTimeout;
        waitReady();

        super.mark(lookAheadLine);
        try {
            while(System.currentTimeMillis() < timeout) {
                while(ready()) {
                    int charInt = super.read();
                    if(charInt==-1) return; // EOS reached
                    char character = (char) charInt;
                    if(character == '\n' || character == '\r' ) return;
                }
                try {
                    Thread.sleep(millisInterval);
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt(); // Restore flag
                    break;
                }
            }
        } finally {
            super.reset();
        }
        throw new IllegalThreadStateException("readLine timed out");

    }

    protected void waitReady() throws IllegalThreadStateException, IOException {
        if(ready()) return;
        long timeout = System.currentTimeMillis() + millisTimeout;
        while(System.currentTimeMillis() < timeout) {
            if(ready()) return;
            try {
                Thread.sleep(millisInterval);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt(); // Restore flag
                break;
            }
        }
        if(ready()) return; // Just in case.
        throw new IllegalThreadStateException("read timed out");
    }

} 
```

# html - 调整图像大小并添加覆盖图像而不使用表格并且不会丢失 xml 中的样式

> ID：804960
> 
> 赞同：0
> 
> 时间：2009-04-30T00:56:08.520
> 
> 标签：html, xml, css, self-contained

我正在构建一个系统来创建带有缩略图和播放按钮的“假视频嵌入”。图像来自标准尺寸的服务，因此别无选择，只能在 HTML 中调整它们的大小。另一个限制是，代码块必须是自包含的（如嵌入代码）并且不依赖于任何外部样式表。我将播放按钮覆盖为透明 PNG。我的第一个解决方案是使用内联 css 在覆盖图像上设置负边距，如下所示：

```
<div style="width:340px;height:280px;">
<img src="thumbnail.jpg" width="340" height="280"/>
<div style="margin-top:-280px;"><a href="link-to.video.html">
<img src="transparent-embed-overlay.png" 
border="0"></a></div></div> 
```

但是在博客的 XML 提要中，透明的播放按钮会从“嵌入”中“脱落”，因为它无法识别内联样式。这迫使我不得不编写一个以图像作为背景图像的单格表格。但是后来我无法调整给定的标准图像缩略图的大小，将我硬塞到默认的缩略图大小。

FWIW，这是我正在使用的代码：

```
<table width="320" height="240" background="thumbnail.jpg">
<tr><td><a href="link-to-video.html">
<img src="transparent-overlay.jpg" border="0"></a></td></tr></table> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-15T19:46:49.483

您可以发送一个示例的链接吗？

据我了解，您正在动态更改背景标签，但如果不使用 CSS 3，您将无法调整背景图像的大小，因此兼容性会受到影响。

CSS Background 属性可以包含颜色、url、位置 x、y 和重复。

IE。

```
background: white url("mypic.jpg") 0 0 no-repeat; 
```

[Quirksmode CSS 3 背景](http://www.quirksmode.org/css/background.html)

为什么您不能在表格中使用 img 标签，您可以动态地将其源更改为新图像并将高度和宽度设置为任何值？

或者，如果您的问题是用户拖动图像，您可以简单地使用 div 而不是图像，设置其高度和宽度，并将其放在图像上。

# ruby-on-rails - 如何在 ruby on rails 应用程序中使用 CSS？

> ID：804961
> 
> 赞同：64
> 
> 时间：2009-04-30T00:57:16.350
> 
> 标签：ruby-on-rails, css, ruby

如何将 CSS 与 RoR 结合使用？当我从外部链接时，我永远无法看到这些文件。我将 .css 文件复制到我能想到的每个文件夹中……视图、控制器、模板，但似乎没有任何效果。

我需要做什么才能使用 Rails 应用程序启用外部 CSS 文件？我是rails新手，如果这是基本的，请原谅我。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-30T01:00:55.123

将 CSS 文件放在 public/stylesheets 中，然后使用：

```
<%= stylesheet_link_tag "filename" %> 
```

链接到布局中的样式表或视图中的 erb 文件。

同样，您将图像放在 public/images 中，将 javascript 文件放在 public/javascripts 中。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2013-02-12T03:55:03.770

如果您使用的是 rails > 3 版本，那么有一个名为`asset pipeline`. 您可以将您的 CSS 添加到

```
app/assets/stylesheets 
```

然后它将被应用程序自动拾取。（这很有用，因为 rails 会自动压缩 CSS 文件）

[在此处阅读](http://guides.rubyonrails.org/asset_pipeline.html)有关资产管道的更多信息

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2016-01-18T11:51:18.840

使用 rails 样式表标签来链接你的 main.css 像这样

```
<%= stylesheet_link_tag "main" %> 
```

去

```
config/initializers/assets.rb 
```

一旦在里面`assets.rb`添加下面的代码片段就在下面`Rails.application.config.assets.version = '1.0'`

```
Rails.application.config.assets.version = '1.0'
Rails.application.config.assets.precompile += %w( main.css ) 
```

重新启动您的服务器。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-02-12T03:49:11.633

我做了以下...

1.  将您的css文件放在`app/assets/stylesheets`文件夹中。
2.  `<%= stylesheet_link_tag "filename" %>`在默认布局文件中添加样式表链接（很可能`application.html.erb`）

我建议使用您的公用文件夹。您还可以引用内联样式表，例如在您的索引页面中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-06-12T23:03:02.240

最初的帖子在 2009 年可能是正确的，但现在它实际上是不正确的，正如我在其他一些回复中提到的那样，样式表甚至不需要链接。Rails 现在会默认为您执行此操作。

*   将任何新工作表 .css（或其他）放在 app/assets/stylesheets
*   使用 rails-root/scripts/rails server 测试您的服务器，您会看到链接是由 rails 本身添加的。

您可以使用浏览器中的路径进行测试，例如 testserverpath:3000/assets/filename_to_test.css?body=1

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-30T02:40:08.083

添加到上述内容中，添加 stylesheet_link_tag 最明显的位置是在您的全局应用程序布局中 - application.html.erb。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-11-26T09:59:29.423

**使用 Rails 6.0.0，在app/assets/stylesheets**创建您的“stylesheet.css”样式表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T00:58:53.007

你试过把它放在你的公用文件夹中吗？每当我有需要从外部引用的图像或类似内容时，我都会将其全部放在那里。

# php - Mysql：使用Like获取逗号分隔值的计数

> ID：804967
> 
> 赞同：0
> 
> 时间：2009-04-30T00:59:37.840
> 
> 标签：php, mysql, csv, explode

我决定使用 favs（将该帖子标记为收藏的用户的 ID）作为 favs 列中的逗号分隔列表，该列也在带有发件人、url、内容等的消息表中。

但是，当我尝试使用以下查询来计算这些行时：

```
select count(id) 
from messages 
where favs like '%userid%' 
```

当然它会返回错误的结果，因为所有 id 都可能是另一个的一部分

例如，在查询 id=1 时，它还会增加用户 id 11 收藏的任何其他内容的计数器...

您能否告诉我您的想法或使该系统正常工作的任何解决方案？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T01:17:11.043

有几个或，你可以有一个丑陋的解决方案：

```
select count(id) from messages where favs like 'userid,%' or favs like '%,userid,%' or favs like '%,userid' 
```

可能有一个更优雅的解决方案，但我相信至少会返回您正在寻找的结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T03:13:55.227

是否可以更改您的数据模型，以便将用户与其喜欢的消息之间的关联存储在另一个表中？

将关联存储在单个列中否定了关系数据库的优势。使用 like 功能会付出性能成本，您不能再存储有关关系的额外数据，并且数据更难查询。

另一种模型可能看起来像这样（不能包含图像，因为我是新用户，但我在[这里](http://img257.imageshack.us/img257/9904/picture2bpf.png)做了一个）：

```
users
 - id

messages
 - id

favorite_messages
 - user_id (foreign key to users.id)
 - message_id (foreign key to messages.id) 
```

有了这些，您的原始查询将简化为以下内容：

```
select count(1) from favorite_messages where user_id = userid 
```

此外，您可以执行以下操作，例如获取用户最喜欢的消息列表：

```
select 
    * 
from 
    messages 
    inner join favorite_messages 
        on messages.id = favorite_messages.message_id
where
    user_id = userid 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-02T03:27:27.590

应该使用这个：

```
SELECT count(id) FROM messages WHERE FIND_IN_SET('userid',favs) > 0 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T01:15:52.543

您可能必须获取值，用 PHP 分解它，然后计算数组。

在 MySQL 中有很多方法可以做到这一点，但据我所见，它们很麻烦。

# c# - 后台线程如何挂掉UI线程？

> ID：804968
> 
> 赞同：5
> 
> 时间：2009-04-30T01:00:06.250
> 
> 标签：c#, winforms, multithreading

我正在使用后台线程通过 USB 初始化仪器。当我尝试打开设备时 UI 挂起。我希望后台线程在设备上调用 Open 时暂停，而不是 UI 线程。我正在测试这个，没有来自后台线程的 UI 交互。我不知道如何调试这个问题，而且这个问题太宽泛了，但也许有人以前见过这样的东西。据我所知，ActiveX 互操作没有任何问题，设备工作正常。这是一般方法：

```
using System;
using FancyVoltmeterLibrary;

namespace SOQuestion
{
    public class MeterClass
    {
        private FancyVoltmeter meter;
        private Thread meterThread;

        public MeterClass()
        {
            // Create instance of ActiveX/COM object.
            meter = new FancyVoltmeter();

            meterThread = new Thread(UpdateMeter);
            meterThread.Name = "Meter Thread";
            meterThread.Priority = ThreadPriority.Normal;
            meterThread.IsBackground = true;
            meterThread.Start();
        }

        private void UpdateMeter()
        {
            while(true)
            {
                Thread.Sleep(1000);
                if(!meter.IsOpen())
                {
                    // Meter may be powered off here.
                    // The call to Open takes about 1 second. 
                    // UI hangs during the call???
                    meter.Open();
                }
                // code to read meter goes here.
            }
        }
    }
} 
```

编辑：也许不清楚我的意思。通过“挂起”，我应该说“暂时冻结”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T01:13:18.480

仪表是否需要在 STA 中运行？出于这个原因，对 Open() 的调用实际上是否被编组回 UI 线程？

您可以通过查看调试器中挂起的 UI 线程的调用堆栈来验证这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T03:41:12.960

FancyVoltmeter 的实例化需要多长时间？会不会是导致 UI 冻结的不是 Open 方法，而是创建 COM 对象（在 UI 线程上完成）？

如果事实证明是这种情况，那么将这个对象的创建移动到新的、单独的工作线程上应该可以解决这个问题。

编辑：我现在看到你已经在对迈克尔的评论中发现了这一点......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T02:59:51.063

我建议您将对meter.open() 的调用包装在一个单独的方法中，并在表单或父控件上使用 Invoke() 或 BeginInvoke() 构造从 updateMeter() 方法中调用该方法。这样做会将动作编组回 UI 线程，并且应该优雅地执行。我希望这有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T03:30:55.043

考虑为此任务使用 BackgroundWorker。

# php - 不是 XSS 漏洞的 UTF-8 字符

> ID：804969
> 
> 赞同：6
> 
> 时间：2009-04-30T01:00:11.333
> 
> 标签：php, utf-8, xss

我正在研究编码字符串以防止 XSS 攻击。现在我们想使用白名单方法，白名单之外的任何字符都将被编码。现在，我们正在使用 '(' 并输出 '(' 代替。据我们所知，这将阻止大多数 XSS。

问题是我们有很多国际用户，当整个网站都是日文时，编码就成了主要的带宽消耗。是否可以肯定地说基本 ASCII 集之外的任何字符都不是漏洞并且它们不需要编码，或者 ASCII 集之外的字符是否仍需要编码？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T01:05:06.797

[如果您只是将编码传递给htmlentities()](http://php.net/htmlentities) / [htmlspecialchars](http://php.net/htmlentities)可能会（很多）容易

```
echo htmlspecialchars($string, ENT_QUOTES, 'utf-8');
```

但是，这是否足够取决于您要打印的内容（以及打印位置）。

另见：
[http ://shiflett.org/blog/2005/dec/googles-xss-vulnerability](http://shiflett.org/blog/2005/dec/googles-xss-vulnerability)
[http://jimbojw.com/wiki/index.php?title=Sanitizing_user_input_against_XSS](http://jimbojw.com/wiki/index.php?title=Sanitizing_user_input_against_XSS)
[http://www.erich-kachel.de /?p=415](http://www.erich-kachel.de/?p=415)（德语。如果我在英语中找到类似的东西-> 更新）编辑：好吧，我想您可以在不流利的德语的情况下获得要点；）字符串

```
javascript:eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))
```

通过 htmlentities() 不变。现在考虑类似

```
<a href="<?php echo htmlentities($_GET['homepage']); ?>"
```

这将发送

```
<a href="javascript:eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))">
```

到浏览器。这归结为

```
href="javascript:eval(\"alert('XSS')\")"
```

虽然 htmlentities() 完成了元素内容的工作，但它对属性并不是那么好。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-19T12:14:12.027

一般来说，是的，你可以依赖任何非 ascii 的东西来“安全”，但是有一些*非常重要的*警告需要考虑：

1.  始终确保您发送给客户端的内容被标记为 UTF-8。*这意味着在每个页面*上都有一个明确表示“Content-Type: text/html; charset=utf-8”的标题，如果这些错误页面上的任何内容是从用户输入生成的，则包括所有错误页面。（许多人忘记测试他们的 404 页面，并让该页面逐字包含未找到的 URL）
2.  始终确保您发送给客户端的内容是有效的 UTF-8。这意味着您 **不能**简单地将从用户收到的字节再次传递给用户。您需要将字节解码为 UTF-8，应用您的 html 编码 XSS 防护，然后在将它们写回时将它们编码为 UTF-8。

这两个警告中的第一个是防止客户端的浏览器看到一堆东西，包括高字母字符和回退到一些本地多字节字符集。该本地多字节字符集可能有多种方法来指定您不会防御的有害 ascii 字符。与此相关，某些浏览器的一些旧版本*-**咳咳*咳*- 在检测页面是 UTF-7 时有点过于急切；这开辟了无限的 XSS 可能性。为了防止这种情况，您可能需要确保对任何传出的“+”符号进行 html 编码；当您生成正确的 Content-Type 标头时，这是过度的偏执狂，但是当将来有人打开关闭您的自定义标头的开关时，这会为您节省。（例如，通过在您的应用程序前面放置一个配置不当的缓存反向代理，或者通过做一些事情来插入一个额外的横幅标头 - 如果任何输出已经写入，php 将不允许您设置任何 HTTP 标头）*

 *第二个是因为在 UTF-8 中可以指定“过短”的序列，虽然在当前规范下无效，但旧浏览器会将其解释为 ASCII 字符。（[看看维基百科怎么说](http://en.wikipedia.org/wiki/UTF-8#Invalid_byte_sequences)）另外，有人可能会在请求中插入一个坏字节；如果您将此包传递给用户，它可能会导致某些浏览器将坏字节及其后面的一个或多个字节替换为“？” 或其他一些“无法理解”的角色。也就是说，一个坏字节可能会导致一些好字节也被吞掉。如果您仔细查看您正在输出的内容，则可能在某个地方，能够从输出中擦除一两个字节的攻击者可以执行一些 XSS。

# svn - 是否有 Subversion Checkout Hook 或类似的东西？

> ID：804970
> 
> 赞同：16
> 
> 时间：2009-04-30T01:00:45.107
> 
> 标签：svn, hook, svn-checkout, svn-hooks

我正在使用 subversion 存储库，我想知道何时有人要求我的存储库结帐；像“svn co”或“svn up”。每当有人从我的 svn 服务器请求信息时，是否可以使用挂钩或其他方法来运行脚本或发送电子邮件？如何在不依赖 apache 日志的情况下实现这一目标？

顺便说一句，它是一个非常简单的存储库，仅用于教育目的。

（如果您需要更多信息，请询问。提前致谢。）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T01:11:53.083

以下是 Subversion 1.5 中所有受支持的钩子，来自《[带有 Subversion 的版本控制](http://svnbook.red-bean.com/en/1.5/index.html)》一书：

*   开始提交
*   预提交
*   提交后
*   pre-revprop-change
*   post-revprop-change
*   预锁
*   后锁
*   预解锁
*   解锁后

没有您描述的预结帐或预更新挂钩。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T01:31:50.383

如果您使用 TortoiseSVN，您可以访问[客户端 hooks](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-settings.html#tsvn-dug-settings-hooks)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-29T11:33:49.463

您可以使用 Apache 作为 SVN 服务器和（例如）mod_perl 来挂钩请求，做任何您想做的事情。也许日志文件已经显示了您想要的信息。

通过 SSH 的 SVN 也应该是可能的：分析 SVN 客户端启动的命令并将它们包装（例如，通过使用“.orig”扩展名重命名原始二进制文件并将（shell）脚本放入该位置。

# authentication - 带身份验证的 MPMoviePlayerController

> ID：804971
> 
> 赞同：0
> 
> 时间：2009-04-30T01:00:52.783
> 
> 标签：authentication, mpmovieplayercontroller

我正在尝试从受基本身份验证保护的 IIS 播放视频。任何人都可以帮助如何通过身份验证播放视频。

MPMoviePlayerController 只有这些参数。

contentURL 属性
backgroundColor 属性
scalingMode 属性
movieControlMode 属性

如何提供身份验证详细信息？任何人都可以帮我解决这个问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-09T16:45:23.567

该`contentURL`属性是类[NSURL](http://developer.apple.com/IPhone/library/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSURL)的一个实例，其中可以包含用户和密码，根据 RFC 2396、1738、1808。因此，根据这些 URL，在`initWithString`您构建 NSURL 实例的调用中使用一个字符串，例如：

```
http://theusername:thepassword@www.yourhost.com/path/to/the/video 
```

这应该可以满足您的基本身份验证需求！

# ruby - Ruby 异常处理问题

> ID：804977
> 
> 赞同：3
> 
> 时间：2009-04-30T01:02:56.100
> 
> 标签：ruby, exception-handling

我正在阅读 Programming Ruby 这本书，但在理解以下概念时遇到了问题：

1.  作者讨论了代码中可能出现的“瞬态异常”，然后建议创建您自己的异常对象来处理它们。我认为我不完全理解什么是暂时性错误以及何时适合制作自己的 Exception 对象。他在[第 6 章](http://ruby-doc.com/docs/ProgrammingRuby/)谈到定义异常时谈到了这一点：

> 例如，某些类型的网络错误可能是暂时的。*第 6 章。第 97 页。向异常添加信息。*

2.  我也很难在 ruby​​ 中使用 Catch and Throw。什么时候比提出和拯救更好？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T01:07:05.280

你能给我们一个关于“瞬态异常”行的页面参考吗？

在任何情况下，您都可以随时创建一个新的异常，这样做通常很好，这样您就可以传输有关该故障的更多信息。当您有低级别异常并希望将其变成对用户更有意义的东西时，这特别好。

Ruby 中的 Throw/Catch 确实是一种非本地 goto，就像 C 中的 setjmp/longjmp，但表现更好。您可以在任何时候使用它来转移执行很长的路要走。

显然，出于同样的原因，您不想使用`goto`太多，您也不想这样做。您可能会使用它的一个重要原因是在程序需要保持运行的情况下，因此如果您发现某些类型的错误，您可能会放弃您正在做的整个工作并重新开始。

* * *

好吧，这似乎不在我所拥有的镐书的任何一个版本的第 97 页上，但我明白它的意思。...哦，这是第三版的第 157 页。

首先，关于“瞬态”的业务，可能会出现一些网络问题，然后自己解决，比如当 BOFH 拔下网线再重新插入时。所以，在某些情况下，您可能想要给它几秒钟安定下来，然后在恐慌之前再试一次。你会怎么做？

在这种情况下，他们让您定义一种新的异常。这仅通过继承完成：

```
class RetryException < RuntimeError
  # so this is a kind of RuntimeError which is a kind of Exception
  attr: ok_to_retry
  def initialize(ok_to_retry)
     @ok_to_retry
  end
end 
```

因此，如果出现问题，您可以提出这些新的可重试异常

```
raise RetryException.new(true), "transient read error" 
```

它现在向堆栈发送某种 RuntimeError 的东西，但现在附加了附加信息，即一个标志，上面写着“是的，这可以重试”。

现在，Ruby 中有一个*非常漂亮*的东西：它具有重试某些东西的内置功能。所以，在堆栈的某个地方，你有这个代码：

```
begin
   # do something that raises this exception
   do_something()
rescue RetryException => detail 
   # if the exception is one of these retryable ones, 
   # catch it here, but it in detail
   if detail.ok_to_retry  
      retry
   end
   # this means exactly the same as 'retry if detail.ok_to_retry`
   # from the book, btw

   # if it STILL doesn't work, send the exception on
   raise # just re-raises the last exception
end 
```

# actionscript-3 - AS3 阵列问题

> ID：804985
> 
> 赞同：1
> 
> 时间：2009-04-30T01:09:14.103
> 
> 标签：actionscript-3

```
[Bindable] private var arr_activities:Array; 
var test: _Aktivitaet;
arr_activities = event.result as Array;
test = arr_activities.pop() as _Aktivitaet; 
```

为什么测试总是保持为空？？？

_Aktivitaet 是一个自定义类：

```
package at.moschitz.topfive
{
  [RemoteClass(alias="Aktivitaet")]
  [Bindable]
  public dynamic class _Aktivitaet extends MyEntity
  {
    public var AktID:int;
    public var AktName:String;
    public var AktMindAlter:int;
    public var AktMaxAlter:int;
    public var AktKategorie:_AktKategorie;
    public var AktIsActive:Number;
  }
} 
```

谢谢马丁

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T01:36:41.560

Either event.result is the empty array "[]", or the last value is not an _Aktivitaet. Check the method dispatching event is correct.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-01T09:44:34.450

代替

```
test = arr_activities.pop() as _Aktivitaet; 
```

试试这个，看看你得到了什么错误：

```
test = _Aktivitaet(arr_activities.pop()); 
```

正如 Simon Buchnan 所说 - 如果数组为空或数组中的最后一个对象不是一个，`_Aktivitaet`您将返回一个空值 - 如果您使用`_Aktvitaet(arr_activities.pop())`flash 进行转换，则会抛出一个错误，可以帮助您调试问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-15T15:25:19.807

您可以使用“断点”功能检查变量的值。\n 您发布的代码不完整，我无法理解。\n 事件来自哪里？这是您的自定义事件类的实例？\n 事件的目标是什么？

# python - 如何使用 Django / Python 从 RESTful Web 服务中使用 XML？

> ID：804992
> 
> 赞同：3
> 
> 时间：2009-04-30T01:13:48.400
> 
> 标签：python, xml, django, rest

我应该使用 PyXML 还是标准库中的内容？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T01:19:00.853

ElementTree 作为标准 Python 库的一部分提供。ElementTree 是纯 python，而 cElementTree 是更快的 C 实现：

```
# Try to use the C implementation first, falling back to python
try:
    from xml.etree import cElementTree as ElementTree
except ImportError, e:
    from xml.etree import ElementTree 
```

这是一个示例用法，我正在使用 RESTful Web 服务中的 xml：

```
def find(*args, **kwargs):
    """Find a book in the collection specified"""

    search_args = [('access_key', api_key),]
    if not is_valid_collection(kwargs['collection']):
        return None
    kwargs.pop('collection')
    for key in kwargs:
        # Only the first keword is honored
        if kwargs[key]:
            search_args.append(('index1', key))
            search_args.append(('value1', kwargs[key]))
            break

    url = urllib.basejoin(api_url, '%s.xml' % 'books')
    data = urllib.urlencode(search_args)
    req = urllib2.urlopen(url, data)
    rdata = []
    chunk = 'xx'
    while chunk:
        chunk = req.read()
        if chunk:
            rdata.append(chunk)
    tree = ElementTree.fromstring(''.join(rdata))
    results = []
    for i, elem in enumerate(tree.getiterator('BookData')):
        results.append(
               {'isbn': elem.get('isbn'),
                'isbn13': elem.get('isbn13'),
                'title': elem.find('Title').text,
                'author': elem.find('AuthorsText').text,
                'publisher': elem.find('PublisherText').text,}
             )
    return results 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T01:17:45.893

我总是喜欢尽可能使用标准库。ElementTree 在 pythonistas 中是众所周知的，所以你应该能够找到很多例子。它的一部分也已经在 C 中进行了优化，因此速度非常快。

[http://docs.python.org/library/xml.etree.elementtree.html](http://docs.python.org/library/xml.etree.elementtree.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-27T13:43:16.820

还有[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)，它有一个有些人可能更喜欢的 API。这是一个示例，说明如何从 Twitter 的公共时间线中提取所有已收藏的推文：

```
from BeautifulSoup import BeautifulStoneSoup
import urllib

url = urllib.urlopen('http://twitter.com/statuses/public_timeline.xml').read()
favorited = []

soup = BeautifulStoneSoup(url)
statuses = soup.findAll('status')

for status in statuses:
    if status.find('favorited').contents != [u'false']:
        favorited.append(status) 
```

# python - 当多个参数包含空格时如何使用子进程？

> ID：804995
> 
> 赞同：23
> 
> 时间：2009-04-30T01:17:04.413
> 
> 标签：python, subprocess

我正在开发一个包装脚本，它将运行一个 vmware 可执行文件，允许虚拟机启动/关闭/注册/注销操作的自动化。我正在尝试使用子进程来处理调用可执行文件，但是子进程未正确处理可执行文件路径和可执行文件参数中的空格。下面是一个代码片段：

```
vmrun_cmd = r"c:/Program Files/VMware/VMware Server/vmware-cmd.bat"
def vm_start(target_vm):
    list_arg = "start"
    list_arg2 = "hard"
    if vm_list(target_vm):
            p = Popen([vmrun_cmd, target_vm, list_arg, list_arg2],   stdout=PIPE).communicate()[0]
            print p
    else:
            vm_register(target_vm)
            vm_start(target_vm)
def vm_list2(target_vm):
    list_arg = "-l"
    p = Popen([vmrun_cmd, list_arg], stdout=PIPE).communicate()[0]
    for line in p.split('\n'):
            print line 
```

如果我调用 vm_list2 函数，我会得到以下输出：

```
$ ./vmware_control.py --list                                                
C:\Virtual Machines\QAW2K3Server\Windows Server 2003 Standard Edition.vmx
C:\Virtual Machines\ubunturouter\Ubuntu.vmx
C:\Virtual Machines\vacc\vacc.vmx
C:\Virtual Machines\EdgeAS-4.4.x\Other Linux 2.4.x kernel.vmx
C:\Virtual Machines\UbuntuServer1\Ubuntu.vmx
C:\Virtual Machines\Other Linux 2.4.x kernel\Other Linux 2.4.x kernel.vmx
C:\Virtual Machines\QAClient\Windows XP Professional.vmx 
```

如果我调用需要 path-to-vm 参数的 vm_start 函数，我会得到以下输出：

```
$ ./vmware_control.py --start "C:\Virtual Machines\ubunturouter\Ubuntu.vmx"
'c:\Program' is not recognized as an internal or external command,
operable program or batch file. 
```

显然，带有嵌入空格的第二个参数的存在正在改变子进程解释第一个参数的方式。关于如何解决这个问题的任何建议？

python2.5.2/cygwin/winxp

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T13:41:10.677

如果路径中有空格，我发现正确解释它们的最简单方法是这样。

```
subprocess.call('""' + path + '""') 
```

我不知道为什么它需要双双引号，但这就是有效的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T01:46:59.037

```
'c:\Program' is not recognized as an internal or external command,
operable program or batch file. 
```

To get this message, you are either:

1.  Using `shell=True`:

    ```
    vmrun_cmd = r"c:\Program Files\VMware\VMware Server\vmware-cmd.bat"
    subprocess.Popen(vmrun_cmd, shell=True) 
    ```

2.  Changing vmrun_cmd on other part of your code

3.  Getting this error from something inside vmware-cmd.bat

Things to try:

*   Open a python prompt, run the following command:

    ```
    subprocess.Popen([r"c:\Program Files\VMware\VMware Server\vmware-cmd.bat"]) 
    ```

If that works, then quoting issues are out of the question. If not, you've isolated the problem.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T02:00:13.203

I believe that list2cmdline(), which is doing the processing of your list args, splits any string arg on whitespace unless the *string* contains double quotes. So I would expect

```
vmrun_cmd = r'"c:/Program Files/VMware/VMware Server/vmware-cmd.bat"' 
```

to be what you want.

You'll also likely want to surround the other arguments (like `target_vm`) in double quotes on the assumption that they, too, each represent a distinct arg to present to the command line. Something like

```
r'"%s"' % target_vm 
```

(for example) should suit.

See [the list2cmdline documentation](http://codespeak.net/py/dist/apigen/api/compat.subprocess.list2cmdline.html)

D'A

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T04:11:00.313

在 MS Windows 上的 Python 中， subprocess.Popen 类使用 CreateProcess API 来启动进程。CreateProcess 采用字符串而不是参数数组之类的东西。Python 使用 subprocess.list2cmdline 将 args 列表转换为 CreateProcess 的字符串。

如果我是你，我会看到 subprocess.list2cmdline(args) 返回什么（其中 args 是 Popen 的第一个参数）。看看它是否在第一个参数周围加上引号会很有趣。

当然，这种解释可能不适用于 Cygwin 环境。

说了这么多，我没有MS Windows。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-14T15:09:33.527

一个问题是，如果命令用引号括起来并且没有空格，这也会使 shell 混淆。

所以我这样做：

```
if ' ' in raw_cmd:
    fmt = '"%s"'
else:
    fmt = '%s'

cmd = fmt % raw_cmd 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-04-08T14:48:01.507

对于我们的最后三个问题来说，这是一个相当困难的问题......到目前为止，没有任何说明有效，既没有使用 r"" 也没有使用带有列表的 Popen 等等。最终起作用的是格式字符串和 r"" 的组合。所以我的解决方案是这样的：

```
subprocess.Popen("{0} -f {1}".format(pathToExe, r'"%s"' % pathToVideoFileOrDir)) 
```

其中两个变量 pathToExe 和 pathToVideoFileOrDir 在其路径中都有空格。在格式化字符串中使用 \" 不起作用，并导致不再正确检测到第一个路径的相同错误。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-30T01:49:23.947

2 things

1)

You probably don't want to use Pipe If the output of the subprogram is greater than 64KB it is likely your process will crash. [http://thraxil.org/users/anders/posts/2008/03/13/Subprocess-Hanging-PIPE-is-your-enemy/](http://thraxil.org/users/anders/posts/2008/03/13/Subprocess-Hanging-PIPE-is-your-enemy/)

2) Subprocess.Popen has a keyword argument shell, making it as if the shell has been parsing your arguments, setting shell=True should do what you want.

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-30T13:19:59.277

这是我不喜欢的

```
vmrun_cmd = r"c:/Program Files/VMware/VMware Server/vmware-cmd.bat" 
```

命令本身的名称中有空格——这让你的 shell 感到困惑。因此，“'c:\Program' 不被识别为内部或外部命令、可运行程序或批处理文件。”

选项 1 - 将您的 .BAT 文件放在其他地方。事实上，将所有 VMWare 放在其他地方。规则如下： **不要对任何东西使用“程序文件”目录。** 这是错误的。

选项 2——引用`vmrun_cmd`值

```
vmrun_cmd = r'"c:/Program Files/VMware/VMware Server/vmware-cmd.bat"' 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-04-30T01:22:40.157

Why are you using r""? I believe that if you remove the "r" from the beginning, it will be treated as a standard string which may contain spaces. Python should then properly quote the string when sending it to the shell.

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-04-30T03:17:30.817

可能是愚蠢的建议，但也许可以尝试以下方法，从等式中删除 subprocess + 空格：

```
import os
from subprocess Popen, PIPE

os.chdir(
    os.path.join("C:", "Program Files", "VMware", "VMware Server")
)

p = Popen(
    ["vmware-cmd.bat", target_vm, list_arg, list_arg2],
    stdout=PIPE
).communicate()[0] 
```

或许也值得一试。。

```
p = Popen(
    [os.path.join("C:", "Program Files", "VMware", "VMware Server", "vmware-cmd.bat"), ... 
```*~~**********