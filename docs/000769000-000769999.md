# StackOverflow 问答 000769000-000769999

# rss - 延迟外部 RSS 提要

> ID：769008
> 
> 赞同：8
> 
> 时间：2009-04-20T16:23:32.147
> 
> 标签：rss

我订阅了许多 RSS 提要，大部分来自我自己的时区（英国：目前为 GMT+1，又名 BST）。不过，我也对来自新西兰的新闻（目前为 GMT+12）感兴趣。

我的问题是由于我沉迷于需要将未读计数保持在或接近于零。当我早上加载我的 RSS 阅读器时，它一次收集了所有新西兰新闻（通常大约 100 条），我觉得有必要要么全部阅读，要么将它们全部标记为已读，以满足我对零未读的需求——数数。

我想一个很好的解决方案是以某种方式延迟 RSS 提要的时间，所以我会在他们的时间 +12 小时内滴灌这些故事，这样我就可以在他们进来时读一整天。

所以我的问题（或者，更确切地说，问题）：目前是否存在这样的事情以及它是什么？（没有必要重新加工轮子）如果不是：我自己做这件事的最佳方法是什么？我可以访问一个 Linux Web 服务器，我可以在该服务器上运行脚本、创建数据库、存储文件等，所以应该有一种方法......

我最熟悉 perl 并且在其中对 XML 做了一些摆弄，所以自然会处理......或者是否有一些我错过的更简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T16:32:10.050

这听起来像是您可以使用 Yahoo! Pipes ( [http://pipes.yahoo.com](http://pipes.yahoo.com) )，您可能想探索一下。熟悉那里后，请查看日期生成器和过滤选项。

# mysql - 如何将 MySQL 数据库移动到外部硬盘？

> ID：769010
> 
> 赞同：2
> 
> 时间：2009-04-20T16:23:44.797
> 
> 标签：mysql, macos

我正在运行 OS X 10.5，但我对 MySQL 配置知之甚少。我正在使用本地 MySQL 数据库从应用程序中存储数据，但它已接近我的硬盘容量。我需要做什么才能将数据库存储在我的外部硬盘上？我在哪里可以获得文档以了解如何执行此操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T16:32:27.040

一种方法是使用 mysqldump 在您的外部磁盘上创建一个新数据库。

将您的应用程序指向该数据库实例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T16:41:32.417

如果你想要更图形化的东西，你可以使用像[Sequel Pro这样的应用程序，连接到本地数据库然后点击导出。](http://www.sequelpro.com/)然后您将拥有它们的 .sql 备份，您可以稍后使用它来恢复它。

# jquery - 实现 jquery 自定义过滤器（基于父类进行选择）的巧妙方法？

> ID：769011
> 
> 赞同：4
> 
> 时间：2009-04-20T16:23:50.897
> 
> 标签：jquery

我想在其父母中选择每个**没有**类*red*的 DIV 的 textarea，对每个文本区域执行某些操作，然后对页面上的其余 textareas执行**其他操作。**换句话说，选择一组元素，只处理其中的一些，然后对其余部分做其他事情。

我知道我可以做类似下面的事情，但是有没有更笨拙的方法呢？

```
$('textarea').filter(function() {
    return $(this).parents("div.red").length > 0;
}).css('border','1px solid red').end().filter(function() {
    return $(this).parents("div.red").length == 0;
}).css('border','1px solid green'); 
```

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T16:52:04.653

这种方式有什么问题？jQuery 是强大的，但是要保持代码的干净和可读性，而不是试图太聪明，还有一些话要说。

```
$('textarea').each(function() {
  if ($(this).parent('div.red').length > 0) {
    $(this).css('border', 'solid 1px red');
  } else {
    $(this).css('border', 'solid 1px green');
  }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T16:52:17.443

也许不是最有效的，但相当直观的是

```
$('textarea').css('border', '1px solid green');
$('div.red textarea').css('border', '1px solid red'); 
```

尽管如果您始终尝试将其应用于每个文本区域，则此类内容可能更多地属于 css：

```
textarea {
    border: 1px solid green;
}

div.red textarea {
    border: 1px solid red;
} 
```

编辑：

正如 Paolo Bergantino 所提到的，如果你想在 textareas 上做一些比一个 css 命令更复杂的事情，你可以使用

```
var redAreas = $('div.red textarea');
var otherAreas = $('textarea').not(redAreas); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T16:56:36.077

```
$("textarea").not("div.Red textarea"); /* textareas which do not have a div with class Red among its parents */
$("div.Red textarea"); /* textareas which have a div with class Red amoung its parents */ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T16:46:36.350

不知道有没有更好的，你可以试试。

```
$('textarea').each(function() {
  var borderColor = $(this).parents('div.red').length > 0 ? 'red' : 'green';
  $(this).css('border', '1px solid ' + borderColor);
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T17:32:56.270

只使用 CSS 有什么问题？

```
textarea 
{
    border: 1px solid green;
}

div.red textarea 
{
    border: 1px solid red;
} 
```

# .net - 是否有适用于 Visual Studio 2008 的更好的第 3 方“查找”/“搜索”插件？

> ID：769014
> 
> 赞同：6
> 
> 时间：2009-04-20T16:24:13.643
> 
> 标签：.net, visual-studio-2008, search, find

我无法忍受 Visual Studio 2008 的“查找”或“查找和替换”功能，有人知道集成到 Visual Studio 中的更好的第 3 方解决方案吗？在这一点上，我很乐意使用任何“查找”实用程序，无论是否集成视觉工作室。

VS.net 08 不会做的一些我想做的事情：

*   让您指定文件类型（“*.sql”会很好）
*   让您指定哪个解决方案或文件夹，“当前项目”似乎是浪费或经过深思熟虑

如果有其他问题，只需发布​​您最喜欢的“查找”应用程序，我会查看它们

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-20T16:27:42.403

Find 在 VS 2008 中非常出色。

执行`CTRL`++以`SHIFT`调`F`出高级查找窗口。

然后你可以做你所要求的一切，甚至更多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T21:30:35.217

Entrian Source Search [http://entrian.com/source-search/](http://entrian.com/source-search/)是 Visual Studio 的搜索插件。它为您的文件建立全文索引，因此搜索总是近乎即时的。结果是语法高亮的，它支持按文件类型、文件名和目录过滤。

全面披露：我是作者（我写它是因为我也对 Visual Studio 自己的搜索功能感到沮丧；-）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T16:28:07.237

“在文件中查找”命令允许您指定文件类型，并允许您准确指定要搜索的文件夹。它甚至允许使用正则表达式。

请尝试一下，并相应地编辑您的问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-04-02T21:01:57.073

**[Sando 代码搜索工具](http://visualstudiogallery.msdn.microsoft.com/06f39a31-20ce-408c-afee-8a02b484db1c)**是一个免费的开源 Visual Studio 扩展，可以搜索您的**C、C++ 和 C#**代码。它以程序元素列表（例如，方法、元素、字段、枚举等）的形式返回结果，使用类似 Google 的搜索引擎来识别相关结果，而不是使用典型的基于正则表达式的方法。它支持排除（例如，'add file -test'）、文件类型限制（例如，'add file filetype:cs'）和精确匹配（例如，'"AddFile(File);"'）并包括概念性自动完成。

Sando 在一个 roguelike 游戏中搜索“添加武器”。

![在此处输入图像描述](https://i.stack.imgur.com/gysWs.png)

Sando 使用引号搜索完全匹配并使用代码片段预览查看结果。

![在此处输入图像描述](https://i.stack.imgur.com/gy5Ut.png)

支持：VS2010（所有版本）、VS2012（所有版本）
语言：C、C++、C#

**完全披露：**我是这个扩展的项目负责人，所以我可能有偏见:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-20T16:36:01.087

[更清晰](http://www.google.si/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.jetbrains.com%2Fresharper%2Fdocs%2FReSharper40DefaultKeymap.pdf&ei=UaTsSeDlJ4e5jAel-_2aCg&usg=AFQjCNGQM0WzhBKP_Qyh7rd8t__v_zBdrQ&sig2=e9HIGK9g6Fp-GEcRp10Pzg)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-30T23:13:39.973

我使用的是 VS2008 标准版，并且“在文件中查找”没有**作为**“编辑”菜单中的选项之一出现！

我必须通过“自定义...”添加它。也必须通过“键盘...”添加 Ctrl+Shift+F 快捷键。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T16:32:01.113

如果您想按文件名搜索，SonicFileFinder 使用起来非常方便。允许您键入部分文件名，并查看所有匹配的文件名。

# sql - 在简单查询中摆脱被零除

> ID：769015
> 
> 赞同：0
> 
> 时间：2009-04-20T16:24:32.097
> 
> 标签：sql, database

这是我的查询的简化版本。假设每个下订单的客户，我想知道他们的订单总额中有多少百分比是用于绿色物品的。

订单中不能有多个项目，但订单值可能为零，所以我想避免除法错误。（不，我无法以任何方式更改数据库。）

最好的方法是什么？编辑：忽略零总数实际上很好，因此接受了答案。

```
SELECT order.customer,
  SUM
  (
    CASE items.color WHEN 'Green' THEN order.value
    ELSE 0 END
  ) * 100 / sum(order.value) AS percentage,
  SUM(order.value) AS total_value
FROM orders
  INNER JOIN item
    ON order.item_id = item.item_id
GROUP BY order.customer 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T16:27:52.293

请参见此处：[SQL Server 高效处理除以零](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/sql-server-efficient-handling-of-divide)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T16:28:01.730

你能过滤掉order.value = 0的订单吗？

```
Where
  order.value <> 0 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T16:27:02.637

```
SELECT order.customer,
  SUM
  (
    CASE items.color WHEN 'Green' THEN order.value
    ELSE 0 END
  ) * 100 / CASE sum(order.value) WHEN 0 THEN 1 ELSE SUM(order.value) END AS percentage,
  SUM(order.value) AS total_value
FROM orders
  INNER JOIN item
    ON order.item_id = item.item_id
GROUP BY order.customer 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T16:27:03.357

添加

```
having sum(order.value) <> 0 
```

在你的分组之后

# c++ - 课堂上的stl算法

> ID：769026
> 
> 赞同：2
> 
> 时间：2009-04-20T16:26:55.897
> 
> 标签：c++, stl

有没有办法在对象容器中使用像 find() 和 find_if() 这样的 stl 算法？例如：使用 find() 在 Alfhabetic 类的向量中找到名称为“abc”的元素。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T16:32:39.597

您可以定义一个比较谓词（函子）。这是一个通用的实现：

```
struct AlphabeticNameComp
{
   AlphabeticNameComp( const std::string& toCompare)
      : toCompare_( toCompare) { }

   bool operator()( const Alphabetic& obj) const
   {
       return toCompare_ == obj.name();
   }

private:
   const std::string toCompare_;
}; 
```

在字母元素的向量中

```
std::vector< Alphabetic> vect; 
```

您可以运行如下搜索：

```
std::find_if( vect.begin(), vect.end(), AlphabeticNameComp( "abc")); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:32:45.697

您可以定义一个仅匹配数据成员的`operator==()`for 类`Alfhabetic``abc`

类似的东西：

```
bool operator==(const Alfhabetic& a, const Alfhabetic& b)
{
    return (a.abc == b.abc);
} 
```

然后找到一个`Alfhabetic`初始化`abc`为您想要的值的实例。

# asynchronous - 在异步操作方面需要帮助

> ID：769040
> 
> 赞同：1
> 
> 时间：2009-04-20T16:28:50.620
> 
> 标签：asynchronous, design-patterns

我对异步和面向服务的编程比较陌生，并且想做以下事情：

1.  在数据库中启动一个可以运行几分钟甚至几小时的存储过程。
2.  将代码返回给作业 ID 的调用者，客户端可以使用该代码来跟踪作业的进度。

这似乎是一项简单的任务，但对于异步编码来说，我很担心未知的陷阱。这种类型的功能是否有明确定义的模式？如果是这样，它有名称吗？什么是好的资源？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-26T13:24:09.623

在您的情况下，您需要使用回调方法。这将异步启动 sql SP 执行，并在执行完成时通知您的代码。此外，您可以使用 AsynResult 对象来轮询操作是否已完成。

回调方法参考链接[SqlCommand..::.BeginExecuteReader Method (AsyncCallback, Object)](http://msdn.microsoft.com/en-us/library/7szdt0kc.aspx)。

如果您也需要轮询，可以对 IAsyncResult 进行轮询：

```
// Make the asynchronous call
IAsyncResult result = command.BeginExecuteReader(callback, command);

// Poll to see if complete
while (!result.IsCompleted)
{    
// Do more work here if the call isn't complete    
Thread.Sleep(100);
} 
```

请参阅我对[什么是 AsyncCallback 的回答？](https://stackoverflow.com/questions/1047662/what-is-asynccallback/1047677#1047677)对于以简单方式解释的所有不同类型的异步技术。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T13:03:17.787

当运行异步调用是一个很好的自定义设置某种回调来处理过程的结果（我不是严格谈论存储过程，可以是任何异步调用的调用） - 这可能是一个结果集或只是一个成功/失败指标。

如果您充分利用异步调用设置某种安全网来捕捉结果并以适当的方式做出反应，我看不出这种方法有任何缺陷（这种方法实际上在许多情况下通常是必要的）。

有关对存储过程的异步调用的实际示例（.NET）（这似乎与您的特定情况相关），请查看[此处](http://nayyeri.net/blog/Asynchronous-command-execution-in-NET-2-0/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T13:07:16.077

如果您想异步执行此操作，您有两种主要方法：

使用您正在使用的任何资源注册一个回调函数，它将在完成时调用。

或者

如果您的资源没有这样的功能，请启动一个线程来跟踪所有请求并定期轮询请求的完成情况。每次任务完成时，通过回调通知所有者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-29T03:50:46.943

这个答案是在我提出最初的问题 2 年多之后才出现的，但直到最近，当我遇到《服务设计模式》这本书时，我才找到我特别要寻找的东西。

请求确认模式

[http://servicedesignpatterns.com/ClientServiceInteractions/RequestAcknowledge](http://servicedesignpatterns.com/ClientServiceInteractions/RequestAcknowledge)

客户想要操作文件或文档、启动业务任务或通知系统有关有趣的事件。不需要立即处理请求。如果需要响应，则无需在处理请求后立即交付。

当服务接收到请求时，将其转发到后台进程，然后返回包含唯一请求标识符的确认。

![在此处输入图像描述](https://i.stack.imgur.com/SGAFZ.jpg)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-20T16:34:06.990

查看[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)。

来自维基百科：

> 观察者模式（异步发布/订阅模式的一个子集）是一种软件设计模式，其中一个称为主体的对象维护其依赖项（称为观察者）的列表，并自动通知它们任何状态更改，通常通过调用他们的方法之一。它主要用于实现分布式事件处理系统。

可以在[此处](http://msdn.microsoft.com/en-us/library/ms954621.aspx)找到另一篇关于观察者模式的优秀 MSDN 文章。

# html - 如何判断 HTML 元素是否超出页面底部？

> ID：769042
> 
> 赞同：2
> 
> 时间：2009-04-20T16:29:32.273
> 
> 标签：html, layout, pdf-generation, paging

我有一个系统可以获取动态数据，将其放入 HTML 中进行布局，然后将其转换为 PDF。但是我遇到的问题是，如果一个元素对于剩余的页面空间变得太大或将其他东西从底部推开，我该如何检测到这一点并将元素自己移动到下一页的正确位置？（目前它妨碍了页脚元素。）

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:03:39.600

您是否考虑过只为数据编写两个视图？

这将允许您解决 PDF 版本上的 PDF 问题并解决 HTML 版本上的任何 html 问题。

编辑：由于 HTML 本身没有“页面大小”的真正概念，除了它自己的视口（通过 javascript）之外，这将是困难的。

您可以使用 javascript 找出给定 DOM 元素的计算高度：

```
document.getelementById("anElement").clientheight 
```

然后，如果您知道给定页面中的像素数，则可以根据需要添加换行符以将其向下推（如果它太大）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T13:00:25.677

Guss：我/我们正在使用[winover 库](http://www.winnovative-software.com/?gclid=CLLw7tiehJoCFRSRZgodsGMoGA)(wnvhtmlconvert.dll) 进行转换。这些位置不是绝对的（页眉和页脚除外），因为如果它们上方的元素展开，它们需要向下洗牌。这一切都需要是动态的，因为元素的内容会随着用户输入而变化。每个元素可能需要拆分或移动，具体取决于“页面”上有多少可用空间。

zack：我正在创建 HTML 以便将其转换为仅用于模板布局的 PDF。HTML 将永远不会被看到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T13:12:43.260

我会取消您页脚上的绝对定位，让它在内容之后流动。

如果您将其呈现为一个大页面，则 PDF 可以在需要的位置打破页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T04:23:45.310

我将假设您可以控制生成的 html 并且可以在那里进行一些更改。您需要凭经验确定 pdf 的确切高度和宽度。您还需要确定一个 html 页面将填充的 pdf 页面的最大数量。

基本计划是将 html 内容放在其自己的包含 div 中，并为您可能填充的许多页面重复该 div。然后每个 div 将被设置样式和大小以适合一页，溢出被隐藏（我们可以将每个 div 视为一个“窗口”）。重复的 div 将改变它们的内容，以便内容的不同部分在窗口中。在以下示例中，我将假设 pdf 页面尺寸为 500 像素 x 500 像素（我知道这是不现实的），内容将占用的最大页面数为 3，并且您的 html 正在由 pdf 呈现转换器以符合标准的方式。

```
<!DOCTYPE html>
<html>
<head>
  <title>PDF Pagination Example</title>
  <style>
    .header {background:blue; height:25px}
    .footer {background:green; height:25px}
    .window {height:500px; width:500px}
    #window1, #window2, #window3 {height:450px; overflow:hidden}
    #spacer2 {height:0; margin-top:-450px}
    #spacer3 {height:0; margin-top:-900px}
    li {font-size:30px; padding:10px}
  </style>
</head>
<body>

<div class='window'>
<div class='header'>A header</div>
  <div id='window1'>
    <ol>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
    </ol>
  </div>
<div class='footer'>A footer</div>
</div>

<div class='window'>
<div class='header'>A header</div>
  <div id='window2'>
  <div id='spacer2'></div>
    <ol>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
    </ol>
  </div>
<div class='footer'>A footer</div>
</div>

<div class='window'>
<div class='header'>A header</div>
  <div id='window3'>
  <div id='spacer3'></div>
    <ol>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
      <li>Content of variable height that may or may not overflow.</li>
    </ol>
</div>
<div class='footer'>A footer</div>
</div>

</body>
</html> 
```

字体大小为 30 像素时，内容在两页之间拆分。如果将字体大小增加到 50 像素，则内容将散布以填充所有三个。

最后一块拼图是一点 javascript。您将需要编写一个片段来计算内容的高度并在每个窗口的底部添加填充，这样您就不会像示例中那样被截断。javascript 还应该将没有内容的窗口设置为显示：无。我不确定这是否是您正在寻找的 css，所以我不会解决 javascript，但我也确信如果您需要帮助，您可以在 SO 上找到它：)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T18:02:23.377

根据您的问题，我假设您对所有内容元素都使用静态定位（位置：绝对）？

如果您的内容中断了 HTML 中的页脚元素，那么您很可能可以通过让 HTML 在所有内容下呈现页脚来解决此问题，就像在 HTML 中通常所做的那样。

不过，如果您能描述如何将 HTML 转换为 PDF，那将非常有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T16:42:06.500

您必须跟踪页面上所有项目（甚至是动态项目）的特定高度，并确定何时需要插入分页符。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T13:44:34.510

考虑一些 CSS 打印属性可能会有所帮助，但如果没有进一步的信息，很难说

[http://www.w3schools.com/Css/css_ref_print.asp](http://www.w3schools.com/Css/css_ref_print.asp)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-19T16:15:23.830

我发现通过使用**WebBrowser**控件并检查相关元素的**OffsetRectangle.Bottom**属性，我可以判断它是否低于页脚的顶部，然后我可以判断元素是否溢出以及溢出了多少。

无论如何，感谢您的帮助。

# c# - 当我通过 tcp 发送一个数据包时，它被分成两个数据包

> ID：769045
> 
> 赞同：7
> 
> 时间：2009-04-20T16:30:38.650
> 
> 标签：c#, tcp, packets, mtu

我正在使用服务器-客户端模型在 C# 中开发一个应用程序，其中服务器向客户端发送一个带有位图的字节数组，客户端将其加载到屏幕中，向服务器发送“OK”，然后服务器发送另一个图像，依此类推。

图像缓冲区的长度取决于，通常在 60kb 和 90kb 之间，但我已经看到这并不重要。如果我将客户端和服务器放在同一台计算机上，使用 localhost，一切正常。服务器执行 beginSend，客户端执行 endReceive 并传输整个缓冲区。

但是，我现在正在无线网络中对此进行测试，结果是：

*   服务器发送图像。
*   调用客户端上的回调函数 data_received，但只有 1460 个字节要读取（MTU - 为什么？不应该只在 UDP 中？）
*   再次调用客户端上的回调函数 data_received，现在使用缓冲区的其余部分（它是 1000 字节或 100 KB）...

总是这样，收到第一个 1460 字节的数据包，然后第二个数据包包含其余部分。

我可以通过加入接收到的两个字节数组来解决这个问题，但这似乎不对。我什至不确定为什么会这样。是不是对网络有一些限制？那么为什么 C# 不等待整个数据被传输呢？我的意思是，它是 TCP，我不应该担心它，对吧？

无论如何，任何帮助都会很棒！
干杯

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-20T16:32:46.103

它是 TCP - 您应该将数据视为*流*。你不应该关心流是如何分解成数据包的，或者对它做出假设。

如果您需要接收单个“块”数据，可靠地做到这一点的最简单方法是在其前面加上长度（例如，作为 32 位值）。您读取长度（注意即使是这些字节*也*可以拆分为多个数据包），然后重复读取（无论是同步还是异步），记下您每次读取了多少，直到您读取了所有数据。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T16:33:18.317

阅读[9.2.4](http://www.wireshark.org/docs/wsdg_html_chunked/ChDissectReassemble.html)

> 在剖析应用层协议时，您不能假设每个 TCP 数据包只包含一个应用层消息。一个应用层消息可以拆分为多个 TCP 数据包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-06T22:21:46.980

添加到约翰的答案：

```
int offset = 0;
int imagesize = 512;
byte[] buffer = new byte[512];

tcpChannel.Read(buffer, offset, imagesize); 
```

# php - PHP/MySQLi：将 lc_time_names 和 DATE_FORMAT() 设置为 mysqli 查询？

> ID：769060
> 
> 赞同：1
> 
> 时间：2009-04-20T16:33:14.930
> 
> 标签：php, mysql, database, mysqli

我使用下面的代码从数据库中的表中检索数据：

```
$check_sql = 'SELECT personID, name, DATE_FORMAT(persons.birthdate, "%d de %M, %Y"), birthplace, countryID FROM persons WHERE personID = ?';
    if ($stmt->prepare($check_sql)) {
        $stmt->bind_param('i', $pid);
        $stmt->bind_result($personDB, $name, $birthdate, $birthplace, $countryID);
        $stmt->execute();
        $stmt->fetch();
    } 
```

如您所见，同时我使用 DATE_FORMAT() MySQL 函数将“生日”列中的日期格式化为更友好的显示。现在，我想用西班牙语显示月份全名，所以我想插入`SET lc_time_names = 'es_ES'`到查询中..

我该怎么做？？？我可以添加`SET lc_time_names`到 $check_sql 变量吗？

谢谢！！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T17:16:59.320

```
$mysqli = new mysqli("localhost", "my_user", "my_password", "world");
$mysqli->query("SET lc_time_names = 'es_ES'");
$check_sql = 'SELECT personID, name, DATE_FORMAT(persons.birthdate, "%d de %M, %Y"), birthplace, countryID FROM persons WHERE personID = ?';
        if ($stmt = $mysqli->prepare($check_sql)) {
                $stmt->bind_param('i', $pid);
                $stmt->bind_result($personDB, $name, $birthdate, $birthplace, $countryID);
                $stmt->execute();
                $stmt->fetch();
        } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:46:31.373

另一种选择是返回原始日期/时间，然后用 PHP 对其进行格式化。

在格式化日期之前，您可以使用 PHP 中的 setlocale() 函数来获取西班牙语输出。

这有一个额外的好处，那就是不在 mysql 中运行函数，这可能会更慢。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2019-06-06T16:47:59.030

```
SET lc_time_names = 'es_PE';
SELECT *, DATE_FORMAT(fecha,'%d de') AS dia,
DATE_FORMAT(fecha,'%M  %Y') AS mes
 FROM t_eventos4 
```

# visual-studio-2008 - 当我使用 WCF 测试客户端时，如何更新我的 wcf 服务？

> ID：769063
> 
> 赞同：1
> 
> 时间：2009-04-20T16:33:20.283
> 
> 标签：visual-studio-2008, wcf, wcftestclient

我创建了一个基本的 wcf 服务，它并不比 helloworld 更复杂。我已经使用 WCF 测试客户端和我自己的客户端应用程序对其进行了测试，它运行良好。

所以我想给它添加一个方法，看看我是否可以尝试一些更复杂的东西。但是，现在当我尝试使用 WCF 测试客户端进行调试时，我的新方法并没有显示唯一存在的方法是原始方法。所以我尝试完全删除原始方法并再次测试，它仍然存在，我的新方法仍然丢失。

因此，很明显，我修改后的服务并未更新 WCF 测试客户端用于测试的任何内容。

VS 2008 为允许 WCF 测试客户端工作而生成的临时文件在哪里。或者有人可以向我解释在我修改服务时如何刷新服务。

谢谢，乔什

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T16:52:49.267

检查以确保您的新服务和您的服务接口正确地装饰了该`OperationContract`属性。

更新：看看[WCF Test Client](http://msdn.microsoft.com/en-us/library/bb552364.aspx)，看看您是否可以使用它来显示操作？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:37:45.467

您是否构建了修改后的服务？如果你不构建它，那么就没有什么可更新的了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T19:05:52.880

我尝试了上述两种解决方案都没有成功，尽管我很欣赏这两个答案，因为它们是非常好的检查方法。

我发现最终解决问题的答案是简单地更新项目的版本号。我不知道为什么要修复它，但是在我这样做之后，我的新方法出现了，并且从那以后每次构建都继续出现。

看起来这可能是 VS 2008 中的一个错误。

# iis - 创建 IIS 网站的代码

> ID：769064
> 
> 赞同：3
> 
> 时间：2009-04-20T16:33:22.967
> 
> 标签：iis, iis-7

我需要以编程方式创建一个 IIS 网站。任何人都可以告诉我这样做的代码吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-03-03T02:12:16.507

面向 IIS 7 或更高版本时，请尽可能不要使用 WMI ( `DirectoryEntry`)。( ) 中调用[`ServerManager`](http://msdn.microsoft.com/en-us/library/microsoft.web.administration.servermanager%28v=VS.90%29.aspx)了一个 API ，使这变得非常简单：`Microsoft.Web.Administration.dll``windows\system32\inetsrv`

```
ServerManager serverManager = new ServerManager();
serverManager.Sites.Add("Mysite", "c:\temp\", 8080); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T16:37:41.270

这适用于 IIS 6.0 及更高版本，它是用 VB.Net 编写的（它足够小，可以在需要时轻松转换为 C#）。我也没有写这个，我在这里找到了它（我确实编译了它以确保它会构建）：[http ://www.gafvert.info/notes/VBNET-Create-Website-IIS6.htm](http://www.gafvert.info/notes/VBNET-Create-Website-IIS6.htm)

### VB版

```
Imports System.DirectoryServices
Imports System

Public Class IISAdmin
    Public Shared Function CreateWebsite(webserver As String, serverComment As String, serverBindings As String, homeDirectory As String) As Integer
        Dim w3svc As DirectoryEntry
        w3svc = New DirectoryEntry("IIS://localhost/w3svc")

        'Create a website object array
        Dim newsite() As Object
        newsite = New Object(){serverComment, new Object(){serverBindings}, homeDirectory}

        'invoke IIsWebService.CreateNewSite
        Dim websiteId As Object
        websiteId = w3svc.Invoke("CreateNewSite", newsite)

        Return websiteId

    End Function

    Public Shared Sub Main(args As String())
        Dim a As Integer
        a = CreateWebsite("localhost", "Testing.com", ":80:Testing.com", "C:\\inetpub\\wwwroot")
        Console.WriteLine("Created website with ID: " & a)
    End Sub

End Class 
```

### C#版本

```
public static int CreateWebsite(string webserver, string serverComment, string serverBindings, string homeDirectory)
{
   DirectoryEntry w3svc = new DirectoryEntry("IIS://localhost/w3svc");

   //Create a website object array
   object[] newsite = new object[]{serverComment, new object[]{serverBindings}, homeDirectory};

   //invoke IIsWebService.CreateNewSite
   object websiteId = (object)w3svc.Invoke("CreateNewSite", newsite);

   return (int)websiteId;
} 
```

# sql - 查找表中大于某个值的最小值

> ID：769069
> 
> 赞同：6
> 
> 时间：2009-04-20T16:34:17.707
> 
> 标签：sql, oracle

说我有以下数据

```
Name      Value
===============
Small        10
Medium      100
Large      1000 
```

想象一下，这些代表盒子的体积。我有一些物品想放在盒子里，我想要尽可能小的盒子。我需要一个 SQL 查询，它将：

1.  返回最小行大于我的查询参数的行
2.  如果没有这样的行，则返回最大的行。

很容易将其拆分为两个查询（即首先查询点 1，如果没有返回行，则从表中选择最大的数字）。但是，如果可能的话，我喜欢在一个查询中做一些事情以消除开销（代码和上下文切换），而且看起来应该可以做到。这可能很明显，但是太阳一整天都在照耀着我，我无法思考！

例如，如果您使用 5 的参数，我希望查询返回 10，如果您使用 15 的参数，则返回 100，如果您使用大于 100 的任何值（包括大于 1000 的数字），则返回 1000。

我在 Oracle 11g 上，所以任何特殊的 Oracle 优点都可以。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T16:46:07.567

```
SELECT  *
FROM    (
        SELECT  *
        FROM    (
                SELECT  *
                FROM    mytable
                WHERE   value > 10000
                ORDER BY
                        value
                )
        UNION ALL
        SELECT  *
        FROM    (
                SELECT  *
                FROM    mytable
                ORDER BY
                        value DESC
                )
        )
WHERE   rownum = 1 
```

这将有效地使用 和 上的`mytable(value)`索引`COUNT(STOPKEY)`。

有关性能详细信息，请参阅我的博客中的这篇文章：

*   [**选择最低值**](http://explainextended.com/2009/04/24/selecting-lowest-value/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:38:45.090

```
SELECT MAX(Value)
FROM Table
WHERE Value <= LEAST(@param,(SELECT MAX(Value) FROM Table)) 
```

我对 Oracle 不太熟悉，但我确信它具有 LEAST 功能或等效功能。

在任何情况下，这个查询的子查询都会在`Value`列上使用正确的索引。

严肃地说，您确实应该在两个查询中执行此操作（或者如果您想将它们保持在同一个位置，则在一个存储过程中执行两个步骤），因为如果第一个查询有效，则第二个查询是不必要的。将它们组合在一个查询中必然会为您提供无条件的第二个（或子）查询。您必须查询该表两次，所以问题是您是*始终*查询两次还是仅在必要时查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T17:05:45.587

只是为了好玩，我假设目标尺寸来自包裹表，而您想找到一堆包裹的盒子。如果第一个值为 NULL，COALESCE 选择第二个值。

> ```
> SELECT  
>     p.pkgid,  
>     p.pkgsize,  
>     COALESCE(MIN(b1.size), MAX(b2.size) AS boxsize    
> FROM packages AS p  
> LEFT JOIN boxes AS b1 ON p.pkgsize < b1.boxsize  
> LEFT JOIN boxes AS b2  -- yes, a cartesian join 
> GROUP BY p.pkgid, p.pkgsize 
> ```

作为与其他解决方案进行比较的单个语句，请使用

> ```
> SELECT  
>     COALESCE(MIN(b1.size), MAX(b2.size) AS boxsize    
> FROM Table AS t1,  
>      Table AS t2   
> WHERE targetsize < t1.Value 
> ```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T17:50:38.223

```
WITH ranges_table AS
     (SELECT     LEVEL * 100 AS range_value
            FROM DUAL
      CONNECT BY LEVEL <= 20)
SELECT MIN (range_value)
  FROM ranges_table
 WHERE range_value >= 5 OR range_value = (SELECT MAX (range_value)
                                            FROM ranges_table) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T17:14:38.217

这行得通。用您的参数替换“5”。

```
select min(basket_value) as basket_value
from baskets
where basket_value > 5 
   or basket_value = (select max(basket_value) from baskets) 
```

生成测试数据的简单脚本：

```
create table baskets(
  basket_name varchar2(20)
 ,basket_value number
);

insert into baskets(basket_name,basket_value) values('Small',10);
insert into baskets(basket_name,basket_value) values('Medium',100);
insert into baskets(basket_name,basket_value) values('Large',1000);
commit;

--drop table baskets;  --run when finished 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-20T16:40:25.490

```
select a.newvalue from (
select MIN(value) as newvalue, 1 as order  From table where value > @param
union select MAX(value) as newvalue, 2 as order from table) A
order by a.order 
```

# visual-studio-2008 - 无法创建 Microsoft Visual C# 2008 编译器。请重新安装 Visual Studio

> ID：769071
> 
> 赞同：14
> 
> 时间：2009-04-20T16:34:48.140
> 
> 标签：visual-studio-2008, intellisense

知道如何在 Visual Studio 中修复此错误吗？尝试创建新的 C# 控制台应用程序时会发生此错误。我可以创建和构建 C# 网站，但 Intellisense 不起作用。VB 应用程序正常工作。我尝试升级到 SP1，但没有帮助。我不想重新安装 Visual Studio 并再次出现错误。

“无法创建 Microsoft Visual C# 2008 编译器。请重新安装 Visual Studio。”

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-21T17:51:20.163

在命令提示符下，我运行：

```
C:\Program Files\Microsoft Visual Studio 9\Common7\IDE\devenv.exe /resetsettings 
```

现在一切正常！这为我节省了重新安装。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-10-20T08:30:39.290

我尝试了“resetsettings”和修复安装表单添加/删除程序，都没有工作。
通过删除以下注册表项解决了该问题。

`HKEY_CURRENT_USER\Software\Microsoft\VisualStudio`

当您再次打开 Visual Studio 时，它会要求您选择语言首选项。（*确保从 HKCU 而不是 HKLM 中删除密钥*）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-11-30T05:08:20.963

我重新安装了 VS2008 但问题仍然存在。然后在运行时

```
C:\Program Files\Microsoft Visual Studio 9\Common7\IDE\devenv.exe /ResetSkipPkgs 
```

我的问题解决了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-29T15:49:49.643

我使用 deven.exe /ResetSkipPkgs 并解决问题我想这就像在[http://social.msdn.microsoft.com/Forums/en-US/Vsexpressinstall/thread/04be49aa-de6b-4f45-中删除密钥一样9a27-86e3f214a0fe](http://social.msdn.microsoft.com/Forums/en-US/Vsexpressinstall/thread/04be49aa-de6b-4f45-9a27-86e3f214a0fe)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-01-21T10:33:22.407

以上解决方案都没有对我有用。也许是因为我们正在使用 TFS 2010？

为我解决问题的是重新安装[KB974558](http://www.microsoft.com/en-us/download/details.aspx?id=10834)

也许是上面提到的所有注册表内容和重新应用补丁的组合——谁知道呢？

虽然这个帖子有点过时了，但可能还有其他一些人不得不继续使用 VS 2008，因为他们必须让 Compact Framework 应用程序保持活力

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-15T14:55:01.637

我无法投票，但重新启动和重置设置对我不起作用。但是删除 HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\8.0 确实对我有用。谢谢 NimsDotNet，遗憾的是，由于某种原因，我无法投票支持该答案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-03T11:52:11.413

在 Visual Studio 2008 的命令提示符下运行此命令，否则，转到此路径并运行`devenv.exe /resetsettings`

```
C:\Program Files\Microsoft Visual Studio 9\Common7\IDE\devenv.exe /resetsettings 
```

并且视觉工作室将重新启动。

如果问题仍然存在，请**尝试从控制面板修复文件**， **这可行**

谢谢你

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-20T16:39:12.593

您是否尝试过按照要求重新安装 Visual Studio？

# sql - 将文件存储在不同的数据库中？

> ID：769073
> 
> 赞同：2
> 
> 时间：2009-04-20T16:35:50.620
> 
> 标签：sql, sql-server, sql-server-2005

将文件存储在不同的 SQL Server 2005 数据库“FileDb”中并通过“FileId”在“AppDb”中指向它（文件）是一个好主意。

请考虑到我有一个专用服务器，我可以创建任意数量的 Sql 数据库。

# 更新：

哪个执行更好的单个数据库或多个数据库？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T16:41:48.810

您可以使用[文件组](http://www.mssqltips.com/tip.asp?tip=1112)来分隔数据文件。您可以创建一个单独的文件组来存储文件数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T16:42:09.917

我更喜欢有一列存储文件路径+文件名我从不喜欢将它存储在数据库中的想法，原因如下：

使数据库膨胀...备份和恢复需要更长的时间

图像和文本数据类型令人头疼

在 SQL Server 2008 中，您可以使用 FILESTREAM，它仍然是事务性的，但将其存储为文件

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:10:58.310

另一种方法是使用表分区将文件表放在不同的磁盘分区上，甚至出于性能原因甚至服务器上，但仍将表放在一个数据库中。

*   [SQL Server 2005 分区表和索引](http://www.sqlskills.com/resources/Whitepapers/Partitioning%20in%20SQL%20Server%202005%20Beta%20II.htm)
*   [数据库表分区教程](http://blog.sqlauthority.com/2008/01/25/sql-server-2005-database-table-partitioning-tutorial-how-to-horizontal-partition-database-table/)
*   [用于非常大的表的表和索引分区的性能和可伸缩性](http://www.sqljunkies.com/article/f4920050-6c63-4109-93ff-c2b7eb0a5835.scuk)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T16:45:46.367

如果您想为不同的数据集制定不同的备份策略，它会非常有用。

比如说你只需要每周备份文件/邮件/附件，而App数据需要每天备份。

这使您可以轻松地做到这一点。

我强烈建议您将任何您认为具有不同持久策略的东西放在不同的数据库上。

# c# - 独立的 WPF 过滤器控件

> ID：769081
> 
> 赞同：1
> 
> 时间：2009-04-20T16:38:14.157
> 
> 标签：c#, wpf, linq, user-controls

大多数 WPF 数据网格控件都具有过滤显示数据的内置功能。我有兴趣使用该功能，但与数据网格的使用断开连接。

我希望找到一个用户控件，它将返回一个`Expression<Func<T, bool>>`我可以在 LINQ 查询中使用的控件。有谁知道这样的用户控件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T17:14:04.567

在 WPF 中，内置控件的筛选是使用`CollectionView`. 然后`CollectionView`将其分配为`ItemsSource`集合控件的 （从 派生的任何内容`ItemsControl`）。

从 .NET 3.5 SP1 开始，`CollectionView`类的 filter 属性采用类型为 的委托`Predicate<object>`。`Predicate<object>`看起来与 基本相同`Func<object, bool>`，但两者并不直接兼容。您应该能够轻松地创建一个`Func<object, bool>`委托来包装`Predicate<object>`委托。

```
public static Func<object, bool> GetFuncFromPred(Predicate<object> pred)
{
    return (obj => pred.Invoke(obj));
} 
```

您可以在 中的过滤器上调用它`CollectionView`，然后在 LINQ 查询中使用它们。

例子：

```
List<object> list = GetList();
CollectionView colView = new CollectionView(list);
ListBox lb = GetListBox();
lb.ItemsSource = colView;
colView.Filter = GetFilter();
var filteredItems = list.Where(GetFuncFromPred(colView.Filter)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-08T17:59:17.553

您可能想尝试一下：[http ://dotnetexplorer.blog.com/2011/04/07/wpf-itemscontrol-generic-staticreal-time-filter-custom-control-presentation/](http://dotnetexplorer.blog.com/2011/04/07/wpf-itemscontrol-generic-staticreal-time-filter-custom-control-presentation/)

这是一个通用的、动态的、完整的 XAML 声明性 itemscontrol 过滤器用户控件。它可以过滤数据网格、列表框、组合框等...

该组件使用预编译的链接表达式来检索和比较对象值，因此它提供了非常好的性能。

希望这可以帮助 ！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:29:00.367

我一个都不知道。我们必须自己建造。

我们使用了 CollectionViewSource 并添加了默认过滤器以及用自定义过滤器替换默认值的能力。

# database - 实施审计追踪——Spring AOP vs.Hibernate Interceptor vs DB Trigger

> ID：769084
> 
> 赞同：14
> 
> 时间：2009-04-20T16:38:33.967
> 
> 标签：database, hibernate, audit, spring-aop

我在这方面找到了几个讨论线程——但没有什么可以将所有三种机制的比较放在一个线程下。

所以这是我的问题...

我需要审核数据库更改-插入\更新\删除到业务对象。

我可以想到三种方法来做到这一点

1) 数据库触发器

2）休眠拦截器

3) 春季AOP

（这个问题特定于 Spring\Hibernate\RDBMS - 我想这对 java\c# 或 hibernate\nhibernate 是中性的 - 但如果您的答案取决于 C++ 或 Java 或特定的休眠实现 - 请指定）

选择其中一种策略的优缺点是什么？

我不是在询问实现细节。-这是一个设计讨论。

我希望我们可以将其作为社区 wiki 的一部分

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T17:10:46.713

我只能谈谈Triggers和NHibernate，因为我对Spring AOP不太了解。

一如既往，这取决于对您来说最重要的是什么。

数据库触发器

*   很快
*   总是被调用，即使是从本机 SQL、脚本、外部应用程序。
*   在 NH 不知道的数据库中写入数据。它将在当前会话中丢失。（这可能会导致意想不到的结果）
*   通常对您的会话一无所知（例如：登录名）。

NHibernate 拦截器/事件

*   不是特定于 DBMS 的。
*   允许您轻松访问您的业务信息，例如用户会话、客户端机器名称、某些计算或解释、本地化等。
*   允许您进行声明性配置，例如实体上的属性，它定义是否需要记录实体以及如何记录。
*   允许您关闭日志记录，这对于升级、导入、非用户触发的特殊操作可能很重要。
*   允许您查看业务模型的实体视图。您可能更接近用户的观点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-05-29T08:46:10.687

我知道这与问题不是 100% 相关，但它确实通过新选项增加了价值。

还有另外两种方法可以审核正在发生的事情。

读取事务日志：如果数据库处于完全恢复模式，则有关 INSERT、UPDATE、DELETE 和 DDL 语句的所有详细信息都将记录到事务日志中。

问题是它阅读起来非常复杂，因为它本身不受支持，并且您需要第三方事务日志阅读器，例如[ApexSQL Log](http://www.apexsql.com/sql_tools_log.aspx)或[SQL Log Rescue](http://www.red-gate.com/products/dba/sql-log-rescue/)（后者是免费的，但仅支持 sql 2000）。

这种方法的优点是，除了将数据库置于完全恢复模式之外，您实际上不必进行任何更改。

SQL Server 跟踪：跟踪将捕获跟踪文件中的所有内容，包括某些合规性方案也可能需要的 select 语句。缺点是跟踪是需要解析和组织的文本文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T17:02:33.410

我想不出任何不使用数据库触发器来审计对数据库的更改的充分理由。插入、更新和删除可能会从各种来源命中数据库——触发器会捕获所有这些；休眠等不会。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T21:40:15.677

我认为当您考虑审计时，您需要考虑它的用途。首先，它是记录谁更改了什么以及更改了什么，这样您就可以撤消错误的更改，您可以识别系统的问题（我们可以看到几个不同的应用程序中的哪个导致了更改，这有助于快速识别哪个应用程序损坏了）这样您就可以确定是谁进行了更改。在检测欺诈方面，最后一个可能非常关键。如果您从用户界面做所有事情，您将永远不会看到用户进行欺诈，他们更改后端的数据以给自己写一张支票。如果您从界面执行所有操作，则可能您必须在表级别设置权限，从而为欺诈打开大门。如果你从界面做所有事情，你会' 不知道哪个心怀不满的员工删除了整个用户表以获取纯粹的烦恼值。如果您从前端做所有事情，您将不知道哪个不称职的 dba 不小心将所有客户订单更新到同一客户。除了触发器之外，我不支持使用任何东西进行审计，因为您首先失去了为什么需要审计的很大一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-18T23:38:28.163

使用 Hibernate 拦截器执行审计日志存在严重缺陷。我对推荐这种方法的博客数量感到震惊，但没有指出它最明显的缺陷——拦截器必须使用新事务来记录审计。这意味着您可以成功保存主要交易，但系统崩溃无法记录审计交易！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-29T20:39:01.467

我现在偶然发现的一个老问题。还有一个可用的选项，那就是 Envers，从 3.6 版开始，它与休眠一起可用。

# visual-studio-2008 - Visual Studio 2008 仅在解决方案中运行一个 Web 应用程序而不是全部

> ID：769089
> 
> 赞同：3
> 
> 时间：2009-04-20T16:39:00.690
> 
> 标签：visual-studio-2008

我在 VS 2008 中有一个由多个 Asp.net Web 应用程序组成的解决方案。每次我启动其中任何一个的新实例时，它们都会打开开发服务器上的端口，并且系统托盘上到处都是 asp.net 开发服务器图标。

这在 vs 2005 中从未发生过，只有启动实例的 Web 应用程序才会出现。如何阻止所有 Web 应用程序在 vs 2008 中打开端口？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T16:46:55.040

VS2008 中有两种类型的 Web 项目，Web Sites 和 Web Applications。我使用 Web 应用程序对此进行了测试（尽管它们可能相同）。我在一个解决方案中有两个网站，正如您所说，打开了两个 IIS 端口。这是我修复它的方法。

单击解决方案资源管理器中的网站，然后查看其属性。如果它是一个 Web 应用程序，它应该有一个名为“调试时始终启动”的属性。当您开始调试过程（例如单击播放）时，将所有您不想启动的网站设置为 false。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:41:58.827

尝试使用文件 -> 浏览网站而不是运行解决方案。

# c++ - 选择具有唯一性并保持插入顺序的 STL 容器

> ID：769097
> 
> 赞同：9
> 
> 时间：2009-04-20T16:41:46.940
> 
> 标签：c++, stl

在以下情况下，我无法决定使用哪个 STL 容器：

1.  我想保留元素的插入顺序
2.  容器中的元素必须是唯一的。

有没有现成的容器可用于此？我不想使用向量，然后在每次执行`std::find`之前执行 a 。`push_back`

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-20T16:54:19.327

[`Boost MultiIndex`](http://www.boost.org/doc/libs/1_38_0/libs/multi_index/doc/index.html)应该能够完全按照您的意愿行事 - 您可以只使用一个排序索引来获得“按插入顺序排序”要求，并使用 a`hashed_unique`或`ordered_unique`索引来获得唯一性要求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T16:44:21.847

可能有一种很好的内置方法可以做到这一点，但一种相当简单的方法是同时使用 hash_map 和列表。在每次插入之前检查 hash_map，然后插入两者。您可能希望将其封装在一个类中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T16:52:16.557

没有标准库容器可以直接为您提供您想要的东西。我将从 std::vector 开始并编写一个自由函数来执行插入，它为您执行查找和 push_back。如果这足够了，那就不要再进一步了。如果您有性能问题，请考虑更复杂的解决方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T23:34:29.147

你可以这样做：

*   使用两个成员围绕您的元素类创建一个包装器：您的元素和一个索引。我们称它为“InsertedElement”。索引将是插入顺序。

*   为这个类定义比较运算符，它只考虑你的元素，而不考虑索引。这将确保元素的唯一性，同时记住它们的插入顺序。

*   在另一个类中包装一个 std::set 和一个插入计数器。然后，当您要插入新元素时，可以：

*   已经存在了，没什么可做的。
*   它没有：将它插入到地图中，同时给它当前的最大索引 + 1。

就像是：

```
class CMagicContainer
{
  public:
    std::set<InsertedElement> collection;
    int indexGenerator;

    ...
}; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T16:46:35.710

在您选择的容器（例如列表、向量、双端队列）上实现一个包装类，并重写插入/push_back 方法以在插入元素之前检查插入的元素是否唯一。

不幸的是，我不知道有任何 STL 容器符合您的条件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T17:49:18.290

正如其他人所说，没有一个 STL 容器可以做到这一点。我喜欢尼尔巴特沃思的回答。另一种选择是同时使用集合和向量。当你去插入时，检查元素是否在集合中。如果是，则不能插入，因为这会违反您的唯一性要求。如果不是，请将其添加到集合中，然后将其插入向量中。这很容易实现，可以封装到一个类中。权衡是增加了内存开销。但是您可以通过在单个向量上进行查找来换取增加的计算时间。这完全取决于您在问题域中处理的数据量以及您的时间和内存限制（如果有的话）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T18:13:25.220

如果您已经安装了 boost，我喜欢这个选项。否则，为什么不只使用列表或向量并添加`(find(k) == std::npos)`插入检查？我想它在一个非常非常大的列表上可能会变得有点慢，但在大多数情况下它会工作得很好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T04:38:34.110

嗯，我曾经有过类似的情况。我想到的一件事是'我可以使用多键'吗？我用谷歌搜索了一会儿，找到了一个使用 std::set 的示例。因此，如果您无法使用 boost（我推荐它，重新发明轮子是没有意义的）；您可以尝试以下示例。我认为您可以使用辅助键作为插入位置（自动增量）。从我在互联网上找到的例子；我根据我的需要定制了它。这是相同的修改版本。

Cavaet：它正在使用宏。我知道它们通常是邪恶*的*，但我猜这种用途是可以的。

```
#include <set>
#include <functional>
#include <iostream>
#include <algorithm>
#include <iterator>
#include <string>

#define MULTIKEYDEF(NAME,TYPE) \
    inline TYPE const & NAME() const { return d_##NAME; } \
    inline void NAME(TYPE const & t) { d_##NAME = t; } \
    TYPE d_##NAME; \
class T##NAME \
    : public std::unary_function<Tmultikey*,bool> { \
private: \
    TYPE d_compare; \
public: \
    T##NAME(TYPE t) : d_compare(t) {} \
    T##NAME(T##NAME const & self) \
    : d_compare(self.d_compare) {} \
    bool operator()(Tmultikey * mk) { \
    return d_compare == mk->##NAME(); \
    } \
   inline TYPE const& name() const { return d_compare; } \
    }

class Tmultikey {
public:
    // Actual keys
    // Can be accessed through d_primary and d_secondary,
    // or primary() and secondary()
    MULTIKEYDEF(primary , std::string);
    MULTIKEYDEF(secondary, unsigned int);
    // Mandatory
    bool operator < (Tmultikey const& mk) const {
        if(primary() < mk.primary()) return true;
        else if(primary() == mk.primary()) {
            return secondary() < mk.secondary();
        }
        return false;
    }
    // Constructor
    Tmultikey(std::string p, unsigned int s)
        : d_primary(p), d_secondary(s) {}

    // Eraser for std::set
    template<typename Compare>
        static void erase(std::set<Tmultikey> & c, Compare op) {
            typename std::set<Tmultikey>::iterator pos = c.begin();
            while(pos != c.end()) {
                if(op(&(*pos))) {
                    c.erase(pos++);
                } else ++pos;
            }
        }
      // Eraser for std::set
      template<typename Compare>
      static std::set<Tmultikey>::iterator find_ex(std::set<Tmultikey> & c, Compare op) {
         typename std::set<Tmultikey>::iterator pos = c.begin();
         while(pos != c.end()) {
            if(op(&(*pos))) {
               break;
            } else ++pos;
         }
         return pos;
      }
};

int main(int argc, char* argv[])
{
    std::set<Tmultikey> mkset;

    mkset.insert(Tmultikey("1",5));
    mkset.insert(Tmultikey("6",4));
    mkset.insert(Tmultikey("3",7));
    mkset.insert(Tmultikey("1",6));

   std::set<Tmultikey>::iterator bg = mkset.begin();
   for (;bg != mkset.end(); ++bg)
   {
      std::cout<<(*bg).primary()<<std::endl;
   }

    Tmultikey::erase(mkset,Tmultikey::Tsecondary(4));
    //Tmultikey::erase(mkset,Tmultikey::Tprimary("1"));

   std::cout<<"After erase ....\n";
   bg = mkset.begin();
   for (;bg != mkset.end(); ++bg)
   {
      std::cout<<(*bg).primary()<<std::endl;
   }
   bg = mkset.find(Tmultikey("3",7));
   if (bg != mkset.end())
   {
      std::cout<<"Absolute Find:"<<(*bg).primary()<<" "<<(*bg).secondary()<<std::endl;
   }
   //bg = Tmultikey::find_ex(mkset,Tmultikey::Tprimary("1"));
   bg = Tmultikey::find_ex(mkset,Tmultikey::Tsecondary(5));
   if (bg != mkset.end())
   {
      std::cout<<"Partial Find:"<<(*bg).primary()<<" "<<(*bg).secondary()<<std::endl;
   }
   else {
      std::cout<<"Partial Find: FAILED\n";
   }

   return 0;
} 
```

高温下，

# math - 枫树和子串

> ID：769104
> 
> 赞同：0
> 
> 时间：2009-04-20T16:42:19.387
> 
> 标签：math, encoding, maple

也许这是要问的错误网站，但希望有人知道...

如何打破 Maple 中的字符串并将其存储在子字符串列表中？

即我的字符串是：“我喜欢周末”

我想把它分成大小为2的子串......所以我看起来像这样

子；

substrs = [[i][lo][ve][t][he][w][ee][ke][nd][s]]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:14:47.810

`LengthSplit`在`StringTools`包中似乎做你想做的事：

```
substrs := StringTools[LengthSplit]("i love the weekends", 2); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-21T21:23:38.117

> 这很好用！但是，您如何将其转换为列表？– user69514 2009 年 4 月 20 日 17:36

很简单，只需在其周围放置一个列表构造函数：

```
substrs := [StringTools[LengthSplit]("i love the weekends", 2)]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-10T11:09:49.323

```
s := "abcdefghijklmnopqrstuvwxyz";
s[1..2];
seq(s[i..i+1], i=1..length(s), 2); 
```

# .net - 启动“Click-Once”发布的应用程序不断尝试安装 .NET Framework

> ID：769105
> 
> 赞同：2
> 
> 时间：2009-04-20T16:43:33.813
> 
> 标签：.net, windows-vista, clickonce, installation, cycle

从 Internet URL 启动“Click-Once”发布的应用程序时，我的计算机上不断弹出以下对话框窗口：

> [Microsoft .NET Framework 安装] - 您要下载并安装 Microsoft .NET Framework 吗？
> 
> 您尝试访问的内容需要 Microsoft .NET Framework。您想立即从 Microsoft 下载中心下载并安装它吗？
> 
> ……

“Click-Once”过去运行良好，没有尝试安装 .NET Framework，但在（我猜）我的 MS Windows Vista Ultimate System 安装了以下自动更新之后：

> Windows 更新 (KB936448 - .Net Framework 3.0 RTM x86 ru-RU)
> 
> Windows 更新 (KB936403 - .Net Framework 2.0 RTM x86 ru-RU)

“Click-Once”每次都在尝试安装 .NET Framework 时停止工作，即使我运行此安装，它也会继续尝试在后续“Click-Once”激活时安装 .NET Framework...

我已经从我的系统中删除了上述更新，并且我已经安装了 .NET Framework 3.5 SP1 - 但我仍然遇到同样的问题。

我希望应该可以手动修补一些系统注册表项来解决这个问题，但我不知道是哪些。

请告知如何解决此问题。

PS 仅供参考：我的系统上*未*安装Windows Vista SP1

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T16:51:25.980

也许语言环境是原因？您有 ru-RU 的运行时，ClickOnce 应用程序的语言环境是什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T12:16:57.637

> [Microsoft .NET Framework 安装] - 您要下载并安装 Microsoft .NET Framework 吗？

它是否说明了应用程序需要什么版本的框架？

你自己写的应用程序？也许在 Visual Studio 项目属性中有些东西。在**Publish** > **Prerequisites**下有应用程序将尝试安装的先决条件列表（如果被告知这样做）。那里列出了 .NET Framework 的版本吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T16:22:28.690

我也有一段时间有这个问题。

这是当我在记事本中打开一个 .application 文件并将记事本设置为 .application 文件的默认处理程序时引起的。（它需要是 ClickOnce 客户端运行时组件）。

将此重置回默认处理程序可以解决问题

# asp.net - NHibernate继承类但不需要坚持

> ID：769107
> 
> 赞同：5
> 
> 时间：2009-04-20T16:43:51.507
> 
> 标签：asp.net, nhibernate, inheritance, persistence

我有一个类 Order，我使用 NHibernate 将其持久化到数据库中。在 Web 应用程序的下方有一个文件夹，其中包含一个继承自 Order 的对象，出于我们的目的，我们可以将其称为 CustomOrder。出于 UI 目的，我使用 CustomOrder 将一些属性放置到 Order 对象上。这些属性实际上不必保存到数据库中。

当我将 CustomOrder 类传递给只接受 Order 对象的通用保存方法时，NHibernate 抱怨：

未知实体类：CustomOrder。

我不需要将自定义字段持久化到数据库中，但我想保留这种继承结构。我是在用错误的方式思考还是在做我不应该做的事情？

**保存代码**

```
public object Save(Order obj, object userID) {
        Order o = (Order)obj;  
        ISession session = NHibernateHelper.GetCurrentSession();
        ITransaction tx = session.BeginTransaction();

        session.Save(o); 
```

在方法的第一行中的 case 之后，.NET 仍将其标识为 CustomerOrder。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T19:46:39.693

1.  **您不能在 .NET 中更改实例的类型。**没有铸造或任何使之成为可能的东西。
2.  **从数据库加载实例时，NHibernate 想要创建与您存储的类型相同的类型。**这就是为什么它需要一个 CustomOrder 的映射。

你如何实现它：你需要创建一个新的 Order 实例。

```
// get the CustomOrder from somewhere
CustomOrder customOrder;
// create an instance of Order and store it.
session.Save(customOrder.GetOrder());

class CustomOrder
{

    // just one of many ways: a method on the CustomOrder to create 
    // instance of Order
    public GetOrder()
    {
        return new Order()
        {
            property1 = this.property1,
            property2 = this.property2,
            property3 = this.property3
        }
    }
} 
```

您可以使用反射自动执行此操作。或者看看[MemberwiseClone()](http://msdn.microsoft.com/de-de/library/system.object.memberwiseclone(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T16:55:53.643

已经有一段时间了，但我相信您应该能够指定派生类应该作为基类的对象保存在休眠映射文件中。

# .net - 为什么自定义会员提供程序文件必须位于我的 Web 应用程序的 app_code 文件夹中？

> ID：769120
> 
> 赞同：0
> 
> 时间：2009-04-20T16:46:28.533
> 
> 标签：.net, asp.net, provider, app-code

我正在编写一个基于 SQL 提供程序源的自定义 memberhsip 提供程序，我首先尝试将 SQL 提供程序设为一个单独的项目。然而，除非我将所有源代码放在我的网络应用程序的 APP_Code 文件夹中，否则网络应用程序将无法识别它。

这是您实现自定义提供程序的方式吗？我想我可以简单地从网络应用程序中引用提供者项目并继续前进。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T17:00:32.260

如果您的提供程序在已编译的程序集中，请确保将类型指定为“Namespace.Type，Assembly.Name”。像“System.String，mscorlib”或“System.Web.UI.Design.ControlDesigner，System.Design”。

例子：

```
<membership defaultProvider="OlaMembershipProvider">  
  <providers>  
    <add name="OlaMembershipProvider" type="OpenAccess.Web.OlaMembershipProvider, OpenAccess.ClientSide" />  
  </providers>
</membership> 
```

# php - 将php系统命令输出转储到文件

> ID：769125
> 
> 赞同：3
> 
> 时间：2009-04-20T16:46:37.800
> 
> 标签：php, system, command, background-process

在php系统命令中我们使用以下

```
system("ffmpeg -i test.avi -ab 56 -ar 44100 -b 200 -r 15 -s 320x240 -f flv output_file.flv 2>&1 &"). 
```

请解释上述系统命令的用法。'2>&1 &' 代表什么？我想将流程详细信息转储到文件中，我该怎么做？

非常感谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T16:49:03.740

`2>&1`[将« `stderr`»](http://en.wikipedia.org/wiki/Standard_streams#Standard_error_.28stderr.29)重定向到[« `stdout`»](http://en.wikipedia.org/wiki/Standard_streams#Standard_output_.28stdout.29)，`&`最后使命令在[后台](http://www.astro.ku.dk/comp-phys/tutorials/background.shtml)运行。

为了使它完整，它应该是

```
«command» 2>&1 > /tmp/somefile.log & 
```

如果不将 « » 重定向到在后台运行`stdout`的文件（或到） from没有多大意义，因为您的命令会在 PHP 终止后立即被终止（例如达到时间限制）。[`/dev/null`](http://en.wikipedia.org/wiki/Data_sink)`system()`

从[`system()`](http://www.php.net/system)手册：

> 注意：如果使用此功能启动程序，为了使其继续在后台运行，程序的输出必须重定向到文件或另一个输出流。否则将导致 PHP 挂起，直到程序执行结束。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:49:17.297

2>&1 将标准错误 (2) 日志重定向到标准输出 (1)。

不确定最后的额外 & 是做什么的。

如果您想通过管道将 stderr 或 stdout 传输到文件，您可以轻松地做到这一点。

要将 stderr 通过管道传输到文件，请将 2>&1 更改为 2>filepath

文件路径最好是绝对文件路径（例如：2>/home/user/output.mpg）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T16:53:19.360

每个 UNIX 程序都有两个输出流：stdout 和 stderr。出于重定向目的，> 符号将 stdout（文件描述符 1）重定向到文件。“2>”将stderr（文件描述符2）重定向到一个文件，在这种情况下由“&1”表示，它告诉shell使用文件描述符1（即stdout）。在 php 上下文中，这意味着这两个流都将打印在您的脚本输出中，您现在怀疑是否已经弄清楚了。

命令末尾的 & 告诉 shell 在后台运行作业。我不知道您为什么要在这种环境中执行此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T17:01:04.770

如果您想通过 PHP 写入文件，您还可以使用`[exec()][1]`or `[passthru()][2]`which have options 从命令中返回所有内容。`system()`只会返回最后一行。

# cocoa - 更改 Cocoa 中的文本光标（插入符号）颜色？

> ID：769127
> 
> 赞同：6
> 
> 时间：2009-04-20T16:47:02.510
> 
> 标签：cocoa, text, colors, caret

有谁知道是否可以更改 Cocoa 中的文本光标（又名插入符号）颜色？我需要创建一个文本字段，它会根据某些内容更改其插入符号颜色。

请注意，我说的不是鼠标指针图片，而是闪烁的垂直线，它可以帮助您了解您在哪里输入 :-)

我正在浏览 Cocoa 文档，但找不到任何有趣的东西。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-20T17:12:20.923

哦，这是一个术语不匹配，就像苹果一样:-)

他们将插入符号称为“插入点”，因此可以在 NSTextView 上使用此方法（或“选择器”）：

```
- (void)setInsertionPointColor:(NSColor *)aColor 
```

请参阅[http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/nstextview_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextView/setInsertionPointColor](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/nstextview_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextView/setInsertionPointColor)：

# sql - SqlDataAdapter.Fill() 超时 - 底层 Sproc 快速返回

> ID：769128
> 
> 赞同：5
> 
> 时间：2009-04-20T16:47:57.190
> 
> 标签：sql, timeout, dataadapter, fill

我有一个 SqlDataAdapter 正在填充 21 行数据（4 列）。驱动它的存储过程在 SQL Mgmt Studio 中会在几秒钟内返回，但 .Fill() 需要 5 分钟。

```
 ArrayList ret = new ArrayList();
    SqlDataAdapter da = null;
    SqlCommand cmd = null;  
        cmd = base.GetStoredProc("usp_dsp_Stuff"); //Returns immediately in MSSMS.
        cmd.CommandTimeout = 3600; // Set to 6 min - debug only
        base.AddParameter(ref cmd, "@Param1", ParameterDirection.Input, SqlDbType.BigInt, 8, 19, 0, theParam1);
        base.AddParameter(ref cmd, "@Param2", ParameterDirection.Input, SqlDbType.BigInt, 8, 19, 0, theParam2);
        base.AddParameter(ref cmd, "@Param3", ParameterDirection.Input, SqlDbType.Char, 1, 'C');
        da = new SqlDataAdapter(cmd);
        DataTable dt = new DataTable();
        da.Fill(dt); //Takes 5 minutes. 
```

有任何想法吗？

提前致谢！-克里斯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2017-08-03T02:51:44.523

```
da = new SqlDataAdapter(cmd);
da.SelectCommand.CommandTimeout = 1800; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-07-17T09:48:00.660

最近，我遇到了这样的情况：`.Fill`超时，但同一个 SP 在 SQL Server Management Studio 中速度超快。这是因为您的 .NET 应用程序创建 SQL 连接并使用`SET ARITHABORT OFF`，而 SQL Server Management Studio`SET ARITHABORT ON`默认使用。这会导致使用两个不同的执行计划，因此您无法在 SQL Server Management Studio 中重现此超时。我建议您查看您的 SP 并进行一些更改。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T18:40:23.473

感谢您的帮助。解决方案是在 sproc 使用的连接上添加 with (nolock) 语句：

FROM category_tbl c INNER JOIN dbo.categoryItem_LNK cl WITH (NOLOCK) ON c.categoryid = cl.categoryid

我不知道为什么我们在使用 SqlDataAdapter 时只看到降级，但这种改变立即解决了问题。

再次感谢，克里斯

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-02-17T11:20:01.397

我知道这太晚了，就像晚了7年！但我今天遇到了这个问题，想分享我的解决方法。在我的例子中，从 SQL 中提取的数据是一个表值函数。表值函数只返回了大约 3500 行，用时不到 1 秒，但在 c# 代码中的 Fill() 上超时。我不知道它是谁或如何工作的，但删除并重新创建该功能修复了它。我认为这与 .NET 如何读取 SQL 给出的数据有关，例如，如果在报告中使用它之后对其进行更改，则需要重新创建视图的方式。再说一次，我不是 100% 确定幕后发生了什么，但对我来说这是一个快速修复

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-03T15:53:55.047

错误的查询计划和参数嗅探。对于存储过程，尤其是参数会大幅调整读取行的过程，原因是查看传入参数的错误执行计划。由于 SET 参数不同，在 SQL Management Studio 中不会发生这种情况。

该线程很好地总结了您的问题：http: [//social.msdn.microsoft.com/Forums/en-US/transactsql/thread/9fd72536-f714-422a-b4c9-078e2ef365da/](http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/9fd72536-f714-422a-b4c9-078e2ef365da/)

> 这是参数嗅探的典型案例。您的应用程序很可能使用不同的 SET 选项（由客户端 API 设置）运行，并使用与 SSMS 中创建的执行计划不同的执行计划。当您的程序第一次通过您的应用程序调用时会发生什么情况，它会根据传递的参数创建执行计划。但是，该执行计划可能对另一组参数不利，这可能导致在与另一组参数一起执行时性能不佳。有关更多详细信息和不同的解决方案，请参见以下内容：http: [//pratchev.blogspot.com/2007/08/parameter-sniffing.html](http://pratchev.blogspot.com/2007/08/parameter-sniffing.html)
> 
> 这里有更多关于计划缓存和查询计划重用的内部信息：
> [http ://technet.microsoft.com/en-us/library/cc966425.aspx](http://technet.microsoft.com/en-us/library/cc966425.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T19:03:47.533

我讨厌爆料，但 (NOLOCK) 不是解决方案，它只会产生[新问题](http://blogs.sqlsentry.com/aaronbertrand/bad-habits-nolock-everywhere/)，例如脏读、丢失/重复数据，甚至中止查询。SQL 数据库中的锁是您的朋友。

如果锁定（或更糟糕的是，阻塞）导致它变慢，您可以比较通过 SSMS 运行的连接选项和应用程序使用的连接选项。使用 SQL Profiler 查看代码是如何执行的。

如果这些字段中的任何一个是大对象，请记住 SSMS 默认只自动检索几百个字符。返回的额外数据可能是一个因素。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T17:04:50.627

Fill() 有时会很慢，因为 .NET 正在分析从该过程返回的数据。

使用 SQL Profiler 计算出在 Fill() 执行时 SQL .NET 实际发送的内容。

如果它正在发送大量的 SET 语句，例如

```
将 concat_null_yields_null 设置为
设置 cursor_close_on_commit 关闭
设置implicit_transactions 关闭

ETC...

```

..然后将这些相同的集合语句放入您的存储过程*中可能会*加快速度。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-01-27T09:03:05.457

我使用了以下代码，其持续时间是我在 da.Fill (dt) 之前添加的 sqlCommclass.CommandTimeout，因为请求时间超过 10 分钟

```
 using (SqlConnection myADONETConnection = new SqlConnection(vendor.Value))
     {
        using (SqlDataAdapter da = new SqlDataAdapter("", myADONETConnection))
         {
          ..
          ..
          ..
         da.SelectCommand = sqlCommclass;
                sqlCommclass.CommandTimeout = 30000;
                 da.Fill(dt);
          }
    } 
```

# c# - 学习 .NET Web 服务的最佳资源是什么？

> ID：769132
> 
> 赞同：3
> 
> 时间：2009-04-20T16:49:20.633
> 
> 标签：c#, .net, asp.net, web-services

我想跟上网络服务的速度——

我发现我真的很喜欢这种视频格式；我在阅读时倾向于略读（坏习惯），而且我通常不会从视频中获得全部价值。不过，我希望看到您可以推荐的任何好的资源；最好的办法是收集最好的资源。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:03:41.253

MSDN 上的[WCF 开发人员中心](http://msdn.microsoft.com/wcf)是一个很好的起点。

一定要远离 ASMX Web 服务和 WSE Web 服务。它们分别是旧的和过时的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:49:28.820

您可以查看以下教程：

[http://quickstarts.asp.net/QuickStartv20/webservices/](http://quickstarts.asp.net/QuickStartv20/webservices/)

我还建议您了解更多有关 Web 开发和数据访问层的信息，因为您说过您的大部分经验都在桌面端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T18:38:19.047

这里有一些好的开始

*   [http://www.asp.net/learn/videos/video-280.aspx](http://www.asp.net/learn/videos/video-280.aspx)
*   [http://www.dnrtv.com/default.aspx?showNum=33](http://www.dnrtv.com/default.aspx?showNum=33)
*   [http://www.pnpguidance.net/Screencast/DayOfPatternsPracticesScreencastWCSFAJAXDynamicDataMVCFramework.aspx](http://www.pnpguidance.net/Screencast/DayOfPatternsPracticesScreencastWCSFAJAXDynamicDataMVCFramework.aspx)
*   [http://www.pnpguidance.net/Screencast/CreateDataAccessLayerUsingDataAccessGuidancePackageScreencast.aspx](http://www.pnpguidance.net/Screencast/CreateDataAccessLayerUsingDataAccessGuidancePackageScreencast.aspx)

如果您喜欢屏幕投射，这些是开始寻找的地方，也请查看[http://www.dimecasts.net/](http://www.dimecasts.net/)，但他们没有任何关于网络服务的内容

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T19:04:34.333

如果您想查看 WCF 网络服务世界（我肯定会推荐），请查看 Aaron Skonnard 在 Channel9 的“端点电视”上的多部分介绍：

[http://channel9.msdn.com/shows/Endpoint/](http://channel9.msdn.com/shows/Endpoint/)

他有很多从非常基础到相当高级的介绍性截屏教程，他涵盖了所有 WCF，甚至是最新最好的 REST 接口和东西 - 强烈推荐！

马克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T16:51:33.437

[Channel9](http://channel9.msdn.com/)是一个很好的起点。此外，[Mix](http://videos.visitmix.com/)站点也值得一看。

# javascript - 当元素失去焦点时运行 JavaScript

> ID：769135
> 
> 赞同：137
> 
> 时间：2009-04-20T16:50:34.890
> 
> 标签：javascript, html, dom-events

我有一个标准的 HTML 输入，我想在它失去焦点时运行 JavaScript 代码。可悲的是，我的谷歌搜索没有揭示如何做到这一点。

为了清楚起见，我正在寻找一种方法来做到这一点：

```
<input type="text" name="name" value="value" onlosefocus="alert(1);"/> 
```

* * *

## 回答 #1

> 赞同：261
> 
> 时间：2009-04-20T16:51:59.723

onblur 事件怎么样：

```
<input type="text" name="name" value="value" onblur="alert(1);"/> 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-04-20T16:53:17.800

`onblur`是相反的`onfocus`。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2009-04-20T16:52:15.073

您想使用[onblur](https://developer.mozilla.org/En/DOM:element.onblur)事件。

```
<input type="text" name="name" value="value" onblur="alert(1);"/> 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-04-20T16:52:33.263

您正在寻找`onblur`活动。看[这里](http://homepage.ntlworld.com/kayseycarvey/jss3p3.html)，了解更多详情。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-01-08T22:16:04.140

来自[w3schools.com：2016](http://www.w3schools.com/jsref/event_onfocusout.asp)年*9 月与 Firefox 兼容*

```
<input type="text" onfocusout="myFunction()"> 
```

# latex - 小矩阵不会出现在 LaTeX 的同一行

> ID：769137
> 
> 赞同：2
> 
> 时间：2009-04-20T16:51:15.137
> 
> 标签：latex, matrix

我有两个矩阵的乘积，我想在同一行上彼此相邻出现。即使我将它们缩小以留出空间，LaTeX 也会自动将第二个矩阵发送到下一行，这样它们就不会作为产品出现。街上说什么？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T16:58:28.567

大街上的消息是，您尝试做的事情应该可以正常工作。我都试过了

```
\begin{equation}
 \begin{pmatrix} 1 & 2 \\ 3 & 4\end{pmatrix}
 \begin{pmatrix} 1 & 2 \\ 3 & 4\end{pmatrix}
\end{equation} 
```

和

```
 $\bigl(\begin{smallmatrix} 1 & 2 \\ 3 & 4\end{smallmatrix}\bigr) \bigl(\begin{smallmatrix} 1 & 2 \\ 3 & 4\end{smallmatrix}\bigr)$ 
```

在这两种情况下，矩阵都出现在同一行。如果那不适合您，请发布代码示例...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T16:55:57.857

您可能真正应该做的是在显示数学中做它们；内联的大东西看起来很难看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-31T21:03:19.733

```
$\begin{bmatrix}54 & 77 & 6F & 20\\ 4F & 6E & 65 & 20\\ 4E & 69 & 6E & 65\\ 20 & 54 & 77 & 6F\\ \end{bmatrix}$
$\begin{bmatrix}54 & 68 & 61 & 74\\ 73 & 20 & 6D & 79\\20 & 4B & 75 & 6E\\67 & 20 & 46 & 75\end{bmatrix}$ This matrix multiplication works well. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T22:46:46.450

要防止 MATRICES 中的换行，请使用 `\hbox{M​​ATRICES}' 。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-20T08:50:08.643

这可能发生的原因是因为您有 2 个不同的方程环境。方程环境“ `\[ \]`”将把矩阵推到不同的线上。

# maven-2 - 定义关于项目版本类型的 POM 属性

> ID：769147
> 
> 赞同：0
> 
> 时间：2009-04-20T16:52:18.333
> 
> 标签：maven-2, properties

如果我要打包我的项目的 SNAPSHOT 或 RELEASE（非 SNAPSHOT），我想在 maven2 POM 中定义具有不同值的属性。

我知道我可以编写一个简单的 Mojo 插件来定义关于 project.version 的属性（是否包含 SNAPSHOT），但我无法想象在 Maven 的现有插件地狱中还没有一个我可以使用。

如果你知道这样做的方法，我会很感激你的帮助。

马蒂厄

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T06:31:15.183

您需要使用 Maven2 配置文件管理来完成。正如您[在此处](http://maven.apache.org/ref/2.0.4/maven-model/maven.html#class_activation)看到的，在 Maven2 中激活配置文件有多种方法：

*   使用特定的 JDK，
*   使用特定的操作系统，
*   在命令行中给出一个参数，
*   用一个文件...

因此，据我所知，如果不创建（简单）Mojo 插件，就无法做你想做的事......

# erlang - ejabberd 编译错误

> ID：769148
> 
> 赞同：1
> 
> 时间：2009-04-20T16:52:19.597
> 
> 标签：erlang, ejabberd

我是一个巨大的 erlang 菜鸟，在编译 ejabberd 时，我收到了这个错误：

```
make[1]: Entering directory `/usr/src/ejabberd-2.0.5/src/mod_muc'
/usr/local/bin/erlc -W -I .. -pz .. -o .. mod_muc_room.erl
Function: '-process_admin_items_set/4-fun-0-'/2
./mod_muc_room.erl:none: internal error in v3_codegen;
crash reason: {{case_clause,
                   {'EXIT',
                       {function_clause,
                           [{v3_codegen,longest,
                                [[{ker39},{ker38},{ker37},{ker36},{cor36}],
                                 []]},
                            {v3_codegen,longest,2},
                            {v3_codegen,sr_merge,2},
                            {v3_codegen,match_cg,5},
                            {v3_codegen,guard_match_cg,6},
                            {v3_codegen,guard_cg,5},
                            {v3_codegen,'-guard_cg_list/6-anonymous-0-',4},
                            {v3_codegen,flatmapfoldl,3}]}}},
               [{compile,'-select_passes/2-anonymous-2-',2},
                {compile,'-internal_comp/4-anonymous-1-',2},
                {compile,fold_comp,3},
                {compile,internal_comp,4},
                {compile,internal,3}]}
make[1]: *** [../mod_muc_room.beam] Error 1
make[1]: Leaving directory `/usr/src/ejabberd-2.0.5/src/mod_muc'
make: *** [all-recursive] Error 1 
```

什么会导致这个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T18:55:22.033

这是 R13A 中的一个内部编译器错误 - 截至 2009-04-15_18，它已在 R13B 快照中修复。R13B-0 将于 2009 年 4 月 22 日星期三发布，并且 mod_muc 将可以正常编译。

但是，ejabberd 还不是完全兼容 R13B - ram_file_io 服务器不支持 IO 服务器协议中的新 unicode 选项，因此在修复之前，您将无法使用 R13B 成功启动 ejabberd。你现在最好的选择是 R12B-5。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T18:23:05.527

这是**内部**Erlang**编译器错误**。请升级您的 Erlang 运行时。可能 Erlang **R12B-5**是最好的选择。

快速搜索显示来自 Erlang/OTP 团队的[这封电子邮件。](http://erlang.org/pipermail/erlang-questions/2008-January/032388.html)它指出该错误存在于 R12B-0 之前，因此它可能已在较新的版本中修复。

Erlang R12B-5 在这里可用：

*   Ubuntu - 使用 Jaunty 包
*   Debian - 使用 Sid 的软件包
*   Windows - 使用来自[http://erlang.org/download.html的包](http://erlang.org/download.html)
*   其他 - 自己弄清楚:)

# delphi - 如何暂停程序执行直到按下按钮？

> ID：769152
> 
> 赞同：2
> 
> 时间：2009-04-20T16:52:45.307
> 
> 标签：delphi

我有一个算法。我想在某个时候暂停它，然后在用户按下按钮后继续。我怎么做？我浏览了文档，并搜索了互联网，但还没有运气。

这是一个相关的代码片段：

```
 if A[i]>A[i+1]
        then
          begin
            Zameni(i,i+1);
            done:=true;

            sleep(pauza);

            br:=br+1;
          end; 
```

现在，我使用睡眠（pauza 只是一个常数，在塞尔维亚语中表示暂停）。理想情况下，我想用一个程序替换该行，该程序会在间隔内休眠，或者根据配置设置等待按钮按下。

EDIT1：啊，是的，如果不是很明显 - 它是一个图形应用程序，而不是控制台，所以拍打“readln”是行不通的（很遗憾）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T16:57:05.687

这不是您进行事件驱动编程的方式。您应该一直处理到暂停点并在该点结束您的功能。在按钮按下事件处理程序中，您然后执行剩余的处理 - 这只会在用户按下按钮时发生。您可以从 OnTimer 事件调用相同的代码以在给定时间后继续处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T22:36:48.067

使用线程和 TThread 类的内置挂起/恢复函数。Jens Borrisholt 在 about.com 上写了一篇很好的小示例文章，在[这里](http://delphi.about.com/od/kbthread/a/thread-gui.htm)做这种事情。

如果您在应用程序中引入多个 ProcessMessage 位置，您可能会遇到在表单关闭时其他事件仍在运行的代码执行问题。例如，如果表单在 ProcessMessage “睡眠”模式下关闭，则没有很好的方法来展开堆栈。

如果您使用的是 DirectX/OpenGL，MessageDialog 可能无法工作，因为您不会打开正常显示。调用 MessageDialog 可能会将视图从 DirectX 视图切换到普通桌面视图（丑陋但可行），或者它可能会在普通桌面视图上显示消息，而无需从 DirectX 更改显示模式（使用户无法看到提示）。自从我与 Dx 合作以来已经有很长时间了，但我记得无法更改视图模式的问题是一种痛苦。

编辑：正如 Alexander 指出的那样，您不应该从任何地方挂起线程，而是在线程中（即，线程 A 可以挂起线程 A，但不能挂起线程 B）。如果您希望 GUI 线程挂起排序线程，请向排序线程发送消息并在排序线程内处理挂起。他的链接包含一个很好的讨论为什么会这样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T17:36:24.047

我不会推荐它作为好的应用程序设计，但如果其他建议都不适合你，你可能更喜欢这个。

在您的课程/表单中添加一个“暂停：布尔”字段，以及一个“继续”按钮。

开始操作时，将 Paused 设置为 False，并将 Continue.Enabled := False;

当您的代码到达您要暂停的部分时：

```
Paused := True;
Continue.Enabled := True;
while Paused do
begin
  sleep(100);
  Application.ProcessMessages;
end; 
```

在您的继续按钮事件处理程序中：

```
procedure Form1.ContinueClick(Sender: TObject);
begin
  Paused := False;
  Continue.Enabled := False;
end; 
```

正如我之前所说，不漂亮，但它应该可以完成工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T17:38:36.740

将 i 存储在静态变量中。在循环内添加对暂停标志的检查（由暂停按钮设置）。如果标志为真，则退出函数。当再次单击暂停按钮时，再次调用该函数。检查 i 的值，如果它已经 > 0，只需进入你离开的循环。

当循环成功完成时，将 i 重置为 0；

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T16:57:41.970

您可以启动一个对话框，这就是我们所做的，一个简单的消息框就可以了，即

```
 procedure TForm1.Pause1Click(Sender: TObject);
  begin
    // A dialog box will halt thread execution
    Windows.MessageBox(0, 'Paused ...' + sLineBreak + 'Press Enter to Continue',
      '', MB_OK);
  end; 
```

不过，这可能只会暂停当前线程，如果您有多个线程，您可能想尝试更多涉及的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T06:01:27.673

虽然我同意线程方法，但我认为使用挂起/恢复是一个非常糟糕的主意。原因如下：http: [//blogs.msdn.com/oldnewthing/archive/2003/12/09/55988.aspx](http://blogs.msdn.com/oldnewthing/archive/2003/12/09/55988.aspx)

创建一个线程并使用事件来暂停/恢复线程。简单的。顺便说一句，您还可以使用 AsyncCalls 之类的东西来简化线程创建（您不需要 TThread 类）。

另一个原因是创建一个单独的线程是好的：您可以在后台进行大量计算，因此它们不会干扰 UI。您的应用程序将有平稳的反应。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-20T16:54:18.283

只需使用 ReadLn;

```
 ShowConsole("Enter to continue.");
 ReadLn; 
```

# c# - c#中的http库

> ID：769156
> 
> 赞同：5
> 
> 时间：2009-04-20T16:53:15.570
> 
> 标签：c#, http

我正在将一个小型 Web 服务器嵌入到我的程序中。它相对简单——只需要提供原始 html 文件和 javascript。

我有一些异步网络代码可用于获取基本管道。但是有没有可以理解 http 的现成库？

我只需要能够解析 http 请求以提取路径、查询字符串、发布变量并能够做出相应的响应。

无需 SSL 或 cookie 或身份验证。

我尝试了几个 Web 服务器库，但并不满意，主要是因为它们使用工作线程，使与程序 UI 的交互变得烦人。

理想情况下，我只想要一个库，它可以接收一些 http 请求 string\stream 并返回一个结构或对象。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T16:57:54.390

我认为[HttpListener](http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx)可能会做你想做的事。

编辑：（添加代码示例以防万一）

这是一个小代码来展示如何使用它（使用异步方法）。

```
HttpListener _server = new HttpListener();

// add server prefix (this is just one sample)
_server.Prefixes.Add("http://*:8080");

// start listening
_server.Start();

// kick off the listening thread
_Server.BeginGetContext(new AsyncCallback(ContextCallback), null); 
```

然后在`ContextCallback(IAsyncResult result)`

```
// get the next request
HttpListenerContext context = _server.EndGetContext(result);

// write this method to inspect the context object
// and do whatever logic you need
HandleListenerContext(context);

// is the server is still running, wait for the next request
if (_Server.IsListening)
{
    _server.BeginGetContext(new AsyncCallback(ServerThread), null);
} 
```

查看[HttpListenerContext](http://msdn.microsoft.com/en-us/library/system.net.httplistenercontext.aspx)以获取有关您可用的详细信息，但主要的可能是[`Request`](http://msdn.microsoft.com/en-us/library/system.net.httplistenercontext.request.aspx)属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T17:01:35.347

为什么不使用`System.Net`命名空间中的类？特别是[HttpListener](http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx)。

# python - PyGTK 中的持久化窗口

> ID：769175
> 
> 赞同：1
> 
> 时间：2009-04-20T16:57:57.367
> 
> 标签：python, gtk, pygtk, x11

有没有办法强制 gtk.Window 对象忽略窗口管理器的显示/隐藏命令，例如“iconify”和“显示桌面”？

我正在尝试创建一个固定在桌面上的持久窗口，当桌面暴露时，它不会与所有其他窗口一起消失。

**编辑：**我想我特别想知道的是是否可以使用 PyGTK 重现在应用程序中发现的行为，例如码头、桌面小部件、系统托盘等？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T07:21:36.747

你把它弄反了；不是窗口管理器通过发送命令来告诉窗口最小化。窗口管理器**拥有**该窗口，如果它想停止映射一个窗口，它会执行此操作，而无需请求该窗口的许可。

所以我认为答案是“不”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T22:03:24.740

尝试[`GdkWindowTypeHint`](http://library.gnome.org/devel/gdk/unstable/gdk-Windows.html#GdkWindowTypeHint)设置`GtkWindow`：

```
gtk_window_set_type_hint(the_window, GDK_WINDOW_TYPE_HINT_UTILITY); 
```

还有多种方法可以让您的窗口不在寻呼机或任务栏中列出，并让它显示在所有桌面上。请记住，所有这些行为都取决于窗口管理器的支持。除非您使用非常旧的东西，否则这不应该造成问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-10-08T18:07:54.703

从[窗口类型提示列表中](https://developer.gnome.org/gdk3/stable/gdk3-Windows.html#GdkWindowTypeHint)，当您单击显示桌面按钮时，仍然只显示两个：

*   gtk.gdk.WINDOW_TYPE_HINT_DESKTOP
*   gtk.gdk.WINDOW_TYPE_HINT_DOCK

这两种情况都会导致您的窗口失去装饰（即没有边框或标题栏），因此移动/调整大小取决于您的应用程序。DESKTOP 使窗口始终位于其他窗口之后。DOCK 使它总是在前面。

选择 SPLASHSCREEN 会为您提供一个未装饰的窗口，当您单击显示桌面时该窗口仍然隐藏。

如果您想要一个在用户单击“显示桌面”时仍然显示的无边界、固定窗口，请使用：

```
window.set_type_hint(gtk.gdk.WINDOW_TYPE_HINT_DOCK) 
```

在调用 window.show() 之前。显示窗口后，您将无法更改其类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-23T02:40:24.667

没有收到“这是如何做到这一点”的答案并且做了更多的研究，我可以说 - 据我所知 - 没有简单的方法可以使用 PyGTK 实现这种功能。最好的选择是设置窗口管理器提示并将其留给 WM 来做你想做的事情（希望如此）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-29T14:23:44.253

我想`gtk_window_set_type_hint(window, GDK_WINDOW_TYPE_HINT_SPLASHSCREEN)`这就是你想要的。它也是`GDK_WINDOW_TYPE_HINT_DOCK`，但随后窗口始终处于最重要的位置，您无法将其发送回去。

# nunit - 如何通过记录测试名称在 NUnit 中记录哪些测试失败以及哪些测试成功？

> ID：769182
> 
> 赞同：0
> 
> 时间：2009-04-20T17:00:28.393
> 
> 标签：nunit

如何使用 NUnit 记录哪些测试失败以及哪些测试成功？我希望能够在所有测试运行后将所有 NUnit 输出写入文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T17:08:52.100

```
nunit-console nunit.tests.dll /out:TestResult.txt 
```

取自 NUnit 手册，[http:](http://www.nunit.org/index.php?p=consoleCommandLine&r=2.4) //www.nunit.org/index.php?p=consoleCommandLine&r=2.4 。

# c# - WinForm UI 验证

> ID：769184
> 
> 赞同：45
> 
> 时间：2009-04-20T17:00:36.473
> 
> 标签：c#, .net, winforms, validation, user-interface

我需要在我的 winform 应用程序中实现输入验证。有许多不同的表单可以输入数据，我不想通过表单来控制并为每个项目创建 isValid 等。其他人是如何处理这个问题的？

我看到大多数相关帖子都涉及 Web Apps 和/或提到[Enterprise Library Validation Application Block](http://msdn.microsoft.com/en-us/library/cc309509.aspx)。现在我承认我还没有彻底研究过 ELVAB，但对于我需要的东西来说，这*似乎有点矫枉过正。*我目前的想法是编写一个具有各种要求的类库并将控件作为参数传递给它。我已经有一个 RegEx 函数库，用于诸如*isValidZipCode 之*类的东西，所以这可能是我开始的地方。

我想要的是一个验证按钮，onClick 循环遍历该表单页面上的所有控件并执行所需的验证。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-04-20T19:58:04.657

验证已内置到 WinForms 库中。

每个`Control`派生对象都有两个名为`Validating`和的事件`Validated`。它还有一个名为[`CausesValidation`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.causesvalidation.aspx). 当此设置为 true（默认为 true）时，控件将参与验证。否则，它不会。

验证作为焦点的一部分发生。当您将注意力从控件上移开时，将触发其验证事件。事实上，焦点事件是按特定顺序触发的。来自[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.lostfocus.aspx)：

> 当您通过使用键盘（TAB、SHIFT+TAB 等）、调用 Select 或 SelectNextControl 方法或将 ContainerControl..::.ActiveControl 属性设置为当前窗体来更改焦点时，焦点事件发生在以下顺序：
> 
> 1.  进入
> 2.  获得焦点
> 3.  离开
> 4.  证实
> 5.  已验证
> 6.  失去焦点
> 
> 当您使用鼠标或调用 Focus 方法更改焦点时，焦点事件按以下顺序发生：
> 
> 1.  进入
> 2.  获得焦点
> 3.  失去焦点
> 4.  离开
> 5.  证实
> 6.  已验证
> 
> 如果 CausesValidation 属性设置为 false，则会抑制 Validating 和 Validated 事件。
> 
> 如果在 Validating 事件委托中将 CancelEventArgs 的 Cancel 属性设置为 true，则通常在 Validating 事件之后发生的所有事件都将被抑制。

ContainerControl 也有一个方法调用[`ValidateChildren()`](http://msdn.microsoft.com/en-us/library/system.windows.forms.containercontrol.validatechildren.aspx)，它将遍历包含的控件，并验证它们。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2010-09-25T11:41:00.750

我意识到这个线程已经很老了，但我想我会发布我想出的解决方案。

WinForms 上验证的最大问题是仅当控件“失去焦点”时才执行验证。因此，用户必须在文本框内实际单击，然后单击其他地方才能执行验证例程。如果您只关心输入的数据是否正确，这很好。但是，如果您试图确保用户不会通过跳过文本框而将其留空，则此方法效果不佳。

在我的解决方案中，当用户单击表单的提交按钮时，我会检查表单上的每个控件（或指定的任何容器）并使用反射来确定是否为控件定义了验证方法。如果是，则执行验证方法。如果任何验证失败，则例程返回失败并允许进程停止。此解决方案效果很好，特别是如果您有多个要验证的表单。

1）只需将这部分代码复制并粘贴到您的项目中。我们正在使用反射，因此您需要将 System.Reflection 添加到您的 using 语句中

```
class Validation
{
    public static bool hasValidationErrors(System.Windows.Forms.Control.ControlCollection controls)
    {
        bool hasError = false;

        // Now we need to loop through the controls and deterime if any of them have errors
        foreach (Control control in controls)
        {
            // check the control and see what it returns
            bool validControl = IsValid(control);
            // If it's not valid then set the flag and keep going.  We want to get through all
            // the validators so they will display on the screen if errorProviders were used.
            if (!validControl)
                hasError = true;

            // If its a container control then it may have children that need to be checked
            if (control.HasChildren)
            {
                if (hasValidationErrors(control.Controls))
                    hasError = true;
            }
        }
        return hasError;
    }

    // Here, let's determine if the control has a validating method attached to it
    // and if it does, let's execute it and return the result
    private static bool IsValid(object eventSource)
    {
        string name = "EventValidating";

        Type targetType = eventSource.GetType();

        do
        {
            FieldInfo[] fields = targetType.GetFields(
                 BindingFlags.Static |
                 BindingFlags.Instance |
                 BindingFlags.NonPublic);

            foreach (FieldInfo field in fields)
            {
                if (field.Name == name)
                {
                    EventHandlerList eventHandlers = ((EventHandlerList)(eventSource.GetType().GetProperty("Events",
                        (BindingFlags.FlattenHierarchy |
                        (BindingFlags.NonPublic | BindingFlags.Instance))).GetValue(eventSource, null)));

                    Delegate d = eventHandlers[field.GetValue(eventSource)];

                    if ((!(d == null)))
                    {
                        Delegate[] subscribers = d.GetInvocationList();

                        // ok we found the validation event,  let's get the event method and call it
                        foreach (Delegate d1 in subscribers)
                        {
                            // create the parameters
                            object sender = eventSource;
                            CancelEventArgs eventArgs = new CancelEventArgs();
                            eventArgs.Cancel = false;
                            object[] parameters = new object[2];
                            parameters[0] = sender;
                            parameters[1] = eventArgs;
                            // call the method
                            d1.DynamicInvoke(parameters);
                            // if the validation failed we need to return that failure
                            if (eventArgs.Cancel)
                                return false;
                            else
                                return true;
                        }
                    }
                }
            }

            targetType = targetType.BaseType;

        } while (targetType != null);

        return true;
    }

} 
```

2) 在要验证的任何控件上使用标准验证事件。 **验证失败时请务必使用 e.Cancel ！**

```
private void txtLastName_Validating(object sender, CancelEventArgs e)
    {
        if (txtLastName.Text.Trim() == String.Empty)
        {
            errorProvider1.SetError(txtLastName, "Last Name is Required");
            e.Cancel = true;
        }
        else
            errorProvider1.SetError(txtLastName, "");
    } 
```

3）**不要跳过这一步！** 将表单上的**AutoValidate**属性设置为**EnableAllowFocusChange**。即使验证失败，这也将允许切换到另一个控件。

4) 最后，在您的 Submit Button 方法中，调用 Validation 方法并指定要检查的容器。它可以是整个表单，也可以只是表单上的一个容器，例如 Panel 或 Group。

```
private void btnSubmit_Click(object sender, EventArgs e)
    {
        // the controls collection can be the whole form or just a panel or group
        if (Validation.hasValidationErrors(frmMain.Controls))
            return;

        // if we get here the validation passed
        this.close();
    } 
```

快乐编码！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-20T17:16:20.897

在我自己的应用程序中，我需要在输入尺寸时验证它们。我使用的顺序如下

1.  用户选择或键入然后离开控件。
2.  控件失去焦点并通知 View 发送它的 ID 和条目文本。
3.  视图检查是什么形状程序（实现接口的类）创建了表单并将 ID 和条目文本传递给它
4.  形状程序返回响应。
5.  如果响应正常，则视图会更新形状类的正确条目。
6.  如果响应正常，则视图通过接口告诉表单可以将焦点转移到下一个条目。
7.  如果响应不正确，视图会查看响应并使用表单界面告诉表单要做什么。这通常意味着焦点会转移回有问题的条目，并显示一条消息，告诉用户发生了什么。

这种方法的优点是验证集中在给定形状程序的一个位置。我不必去修改每个控件，甚至不必真正担心表单上不同类型的控件。早在我设计软件时，我就决定了 UI 如何为文本框、列表框、组合框等工作。此外，不同级别的严重性处理方式也不同。

视图负责通过接口指示表单做什么。它的实际实现方式由表单本身在其接口的实现中处理。视图不关心表单是否显示黄色表示警告和红色表示错误。只有它处理这两个级别。稍后，如果出现了显示警告与错误的更好想法，我可以在表单本身中进行更改，而不是使用 View 逻辑或 Shape Program 中的验证。

如果您正在考虑创建一个类来保存您的验证逻辑，那么您已经完成了一半，这将使您在新设计中走得更远。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-20T17:09:11.193

> 我希望不必通过表单进行控制并为每个项目创建 isValid 等。

在某种程度上，您必须定义`valid`每个控件的含义，除非您只关心控件具有某种值。

也就是说，您可以使用一个运行良好的[ErrorProvider 组件。](http://msdn.microsoft.com/en-us/library/system.windows.forms.errorprovider.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-20T17:08:26.750

我们在[Noogen ValidationProvider](http://www.codeproject.com/KB/validation/validationprovider.aspx)上运气不错。对于简单的案例（数据类型检查和必填字段）很简单，并且很容易为更复杂的案例添加自定义验证。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-20T17:53:13.833

在我的所有表单中，我为有问题的特定控件实现 isValidating 事件，如果数据未验证，我在表单上有一个 errorProvider，我使用它的 SetError(...) 方法将错误设置为控件与相关信息一起质疑为什么它是错误的。

编辑>我应该注意，我通常在执行此操作时使用 mvc 模式，因此模型的该控件/成员的特定验证发生在模型中，因此 isValidating 看起来有点像这样：

```
private uicontrol_isValidating(...)
{
    if(!m_Model.MemberNameIsValid())
    {
        errorProvider.SetError(...);
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-20T17:59:03.290

不管怎样。或者，您可以将单个验证事件与需要类似验证的所有或控件相关联。这将从代码中删除循环。假设您有四个只能包含整数的文本框。您可以做的是为每个人设置一个事件。我没有任何 IDE，所以下面的代码是我能想到的最好的。

```
this.textbox1.Validated += <ValidatedEvent>
this.textbox2.Validated += <ValidatedEvent>
this.textbox3.Validated += <ValidatedEvent>
this.textbox4.Validated += <ValidatedEvent> 
```

在事件中：

1.  将发件人投射为文本框。
2.  检查文本框中的值是否为数字。

等等，你有事件排队。

希望这可以帮助。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-10T05:10:47.277

如果您将上述想法与这个通用的验证事件处理程序结合起来，您将获得一个很好的验证错误“框架”，其中包含业务类中的所有验证方法。我只是用丹麦的想法扩展了布鲁斯代码。已为 Entity Framework 和 Dev Express 组件完成，但可以轻松删除这些依赖项。享受！

```
public class ValidationManager
{
    /// <summary>
    /// Call this method to validate all controls of the given control list 
    /// Validating event will be called on each one
    /// </summary>
    /// <param name="controls"></param>
    /// <returns></returns>
    public static bool HasValidationErrors(System.Windows.Forms.Control.ControlCollection controls)
    {
        bool hasError = false;

        // Now we need to loop through the controls and deterime if any of them have errors
        foreach (Control control in controls)
        {
            // check the control and see what it returns
            bool validControl = IsValid(control);
            // If it's not valid then set the flag and keep going.  We want to get through all
            // the validators so they will display on the screen if errorProviders were used.
            if (!validControl)
                hasError = true;

            // If its a container control then it may have children that need to be checked
            if (control.HasChildren)
            {
                if (HasValidationErrors(control.Controls))
                    hasError = true;
            }
        }
        return hasError;
    }

    /// <summary>
    /// Attach all youe Validating events to this event handler (if the controls requieres validation)
    /// A method with name Validate + PropertyName will be searched on the binded business entity, and if found called
    /// Throw an exception with the desired message if a validation error is detected in your method logic
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    public static void ValidationHandler(object sender, CancelEventArgs e)
    {
        BaseEdit control = sender as BaseEdit;

        if (control.DataBindings.Count > 0) //control is binded
        {
            string bindedFieldName = control.DataBindings[0].BindingMemberInfo.BindingField;

            object bindedObject = control.BindingManager.Current;

            if (bindedObject != null) //control is binded to an object instance
            {
                //find and call method with name = Validate + PropertyName

                MethodInfo validationMethod = (from method in bindedObject.GetType().GetMethods()
                                               where method.IsPublic &&
                                                     method.Name == String.Format("Validate{0}",bindedFieldName) &&
                                                     method.GetParameters().Count() == 0
                                               select method).FirstOrDefault();

                if (validationMethod != null) //has validation method
                {
                    try
                    {
                        validationMethod.Invoke(bindedObject, null);

                        control.ErrorText = String.Empty; //property value is valid
                    }
                    catch (Exception exp)
                    {
                        control.ErrorText = exp.InnerException.Message;
                        e.Cancel = true;
                    }
                }
            }
        }
    }

    // Here, let's determine if the control has a validating method attached to it
    // and if it does, let's execute it and return the result
    private static bool IsValid(object eventSource)
    {
        string name = "EventValidating";

        Type targetType = eventSource.GetType();

        do
        {
            FieldInfo[] fields = targetType.GetFields(
                 BindingFlags.Static |
                 BindingFlags.Instance |
                 BindingFlags.NonPublic);

            foreach (FieldInfo field in fields)
            {
                if (field.Name == name)
                {
                    EventHandlerList eventHandlers = ((EventHandlerList)(eventSource.GetType().GetProperty("Events",
                        (BindingFlags.FlattenHierarchy |
                        (BindingFlags.NonPublic | BindingFlags.Instance))).GetValue(eventSource, null)));

                    Delegate d = eventHandlers[field.GetValue(eventSource)];

                    if ((!(d == null)))
                    {
                        Delegate[] subscribers = d.GetInvocationList();

                        // ok we found the validation event,  let's get the event method and call it
                        foreach (Delegate d1 in subscribers)
                        {
                            // create the parameters
                            object sender = eventSource;
                            CancelEventArgs eventArgs = new CancelEventArgs();
                            eventArgs.Cancel = false;
                            object[] parameters = new object[2];
                            parameters[0] = sender;
                            parameters[1] = eventArgs;
                            // call the method
                            d1.DynamicInvoke(parameters);
                            // if the validation failed we need to return that failure
                            if (eventArgs.Cancel)
                                return false;
                            else
                                return true;
                        }
                    }
                }
            }

            targetType = targetType.BaseType;

        } while (targetType != null);

        return true;
    }

} 
```

样品验证方法：

```
partial class ClientName
{
    public void ValidateFirstName()
    {
        if (String.IsNullOrWhiteSpace(this.FirstName))
            throw new Exception("First Name is required.");
    }

    public void ValidateLastName()
    {
        if (String.IsNullOrWhiteSpace(this.LastName))
            throw new Exception("Last Name is required.");
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T17:15:56.123

循环通过控件可以工作，但容易出错。我在一个使用该技术的项目上工作（假设它是一个 Delphi 项目，而不是 C#），它确实按预期工作，但如果添加或更改控件，则很难更新。这可能是可以纠正的。我不知道。

无论如何，它通过创建一个事件处理程序来工作，然后将其附加到每个控件。然后处理程序将使用 RTTI 来确定控件的类型。然后它会在一个大的 select 语句中使用控件的 name 属性来查找要运行的验证代码。如果验证失败，则会向用户发送一条错误消息并赋予控件焦点。为了使事情变得更复杂，表单被分成几个选项卡，并且正确的选项卡必须是可见的，它的子控件才能获得焦点。

这就是我的经验。

我更愿意使用被动视图设计模式从表单中删除所有业务规则并将它们推送到 Presenter 类中。根据您的表格状态，这可能比您愿意投资的工作量更大。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-20T17:35:57.697

只是一个粗略的想法：

```
 void btnValidate_Click(object sender, EventArgs e)
{
  foreach( Control c in this.Controls )
  {
    if( c is TextBox )
    {
      TextBox tbToValidate = (TextBox)c;
      Validate(tbToValidate.Text);
    }
  }
} 

```

如果您想避免循环通过其他控件，您可以将文本框粘贴在面板内，并且仅循环通过其中的控件。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-20T17:45:14.570

你为什么不使用验证事件？您可以有一个验证事件并在那里验证控件。无需使用循环，每个控件将在输入数据时进行验证。

# ssis - SSIS 设计器运行非常缓慢

> ID：769193
> 
> 赞同：2
> 
> 时间：2009-04-20T17:03:19.213
> 
> 标签：ssis

我正在开发一个 SQL Server 集成服务包。我一直在对这个包进行一些重大的重构，现在设计器运行得很慢。即使在屏幕上移动组件也会导致设计人员挂起 2-3 分钟。查看任务管理器 Visual Studio 在此期间消耗了大约 80% 的 CPU。

有人对这种缓慢的性能有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T13:39:38.857

你的包裹有多大？您是否尝试在单个包中执行整个 ETL？

它有助于使您的包保持较小，并在主包中管理编排。

这也有助于 SCC。

编辑：要从另一个包中调用一个包，标准方法是使用工具箱中的“执行包任务”。然而，对于非常大的包集，这也会变得很麻烦，并且使用 NAnt/MSbuild 来管理编排会变得更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T16:41:26.143

您在使用 BIDS 助手吗？

我发现它有时会损坏并减慢整个视觉工作室的速度。

卸载并重新安装 BIDS helper 已经为我解决了这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:14:20.760

BIDS 总是有点“臃肿”，您的机器上至少需要 2GB 的 RAM 才能做事。一旦启动，我通常没有问题，有时会打开 2 个实例

我会说开始关闭您在使用 BIDS 时不需要的任何程序和服务

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-12T16:09:41.597

[http://sqlblog.com/blogs/jorg_klein/archive/2010/01/04/ssis-package-design-pattern-for-loading-a-data-warehouse.aspx](http://sqlblog.com/blogs/jorg_klein/archive/2010/01/04/ssis-package-design-pattern-for-loading-a-data-warehouse.aspx)

“这种用于加载数据仓库的父/子包设计模式为您提供了所需的所有灵活性和功能。”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-23T18:20:02.103

查看开发人员中出现的错误。也许您有一个元素会增加错误计数，并且元素之间的交叉验证正在耗尽您的资源。

这个问题我只是针对手中的问题打开的，也许它可以提供帮助：

[SSIS 在设计器视图中运行非常缓慢](https://stackoverflow.com/questions/42423158/ssis-is-running-extremely-slow-in-designer-view/42423159#42423159)

# c# - DataTable 列按 ASCII 顺序排序，而不是

> ID：769208
> 
> 赞同：2
> 
> 时间：2009-04-20T17:07:09.733
> 
> 标签：c#, datatable, sorting, ascii

如果我有两个字符串，并且我需要按 ASCII 顺序（而不是不变的文化顺序）比较它们，我通常可以使用：

```
int c = String.Compare(a, b, StringComparison.Ordinal); 
```

如果我有一个 DataTable，并且我希望使用 DataView 的 Ordinal 字符串比较对其中一列进行排序，我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:35:01.977

不幸的是，在 ; 中没有内置任何东西来促进自定义排序逻辑`DataView`。这是我的主要抱怨之一，也是我们决定在我以前的工作中推出自己的数据访问层的原因之一。

虽然我不知道这对您来说有多可行，但要真正实现这一点，您需要将另一列作为 int 添加到表中，然后根据您自己的比较逻辑对数组中的行进行排序，然后将索引存储在`int`列中的数组中。然后，而不是按`string`列排序`int`。

但是，我确实认识到，这不能满足诸如由 a 完成的自动排序之类的要求，`GridView`并且它不考虑在计算排序位置后发生的数据更改。不幸的是，我认为没有什么可以真正帮助解决这个问题。

如果您希望对其进行可视化排序，请检查您的可视化控件是否支持自定义排序机制。这就是我所能建议的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-13T21:20:34.400

如果可能，当您`DataTable`使用查询创建时，让查询将该列转换为数字列：

```
SELECT *, CAST(your_column AS int) AS your_column_int
FROM your_table
ORDER BY your_column_int 
```

# javafx - JavaFX 中的深度链接

> ID：769210
> 
> 赞同：1
> 
> 时间：2009-04-20T17:08:50.277
> 
> 标签：javafx, deep-linking

Silverlight 在最新版本中支持深度链接。有 JavaFX 吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T18:31:30.723

因为还没有任何答案，所以回答没有答案...

我没有在 JavaFX 中看到任何对深度链接的引用。

因为我在 JavaFX 中找不到任何对深度链接的引用，所以我很好奇 JavaFX Web 应用程序在加载到网页时是否可以访问 URL 参数。令人惊讶的是，我也找不到任何对此的参考。我还没有准备好相信 JavaFX 应用程序无法访问 URL 参数。我希望我只是搜索的时间不够长，因为如果这是真的，那将是该语言的巨大劣势。

# vim - : 命令历史存储在哪里？

> ID：769214
> 
> 赞同：19
> 
> 时间：2009-04-20T17:09:36.590
> 
> 标签：vim

我想知道 : 命令历史记录存储在特定 vim 会话的位置。我知道我们可以滚动和搜索历史。我的目标是获取我使用试错法执行的部分命令并创建一个 vim 源文件。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-20T17:11:16.027

它存储在 $HOME/.viminfo

从 vim 帮助命令：

```
The viminfo file is used to store:
- The command line history.
- The search string history.
- The input-line history.
- Contents of registers.
- Marks for several files.
- File marks, pointing to locations in files.
- Last search/substitute pattern (for 'n' and '&').
- The buffer list.
- Global variables. 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T19:41:27.240

您还可以使用`q:`or`:<CTRL-F>`命令在 minibuffer 中打开您最近的命令历史记录

```
 OPEN

 There are two ways to open the command-line window:
 1\. From Command-line mode, use the key specified with the 'cedit' option.
    The default is CTRL-F when 'compatible' is not set.
 2\. From Normal mode, use the "q:", "q/" or "q?" command.  *q:* *q/* *q?*
    This starts editing an Ex command-line ("q:") or search string ("q/" or
    "q?").  Note that this is not possible while recording is in progress (the
    "q" stops recording then).

 When the window opens it is filled with the command-line history.  The last
 line contains the command as typed so far.  The left column will show a
 character that indicates the type of command-line being edited, see
 |cmdwin-char|. 
```

You can move around this window, and copy just like a normal buffer. Hitting `<Enter>` over a command will execute it.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T17:12:55.443

您正在寻找函数`histget()`和。`histadd()``histdel()`

编辑：viminfo 文件将包含来自多个会话的历史数据，我猜你已经知道了，根据你提出问题的方式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-20T17:13:31.747

```
:h viminfo-file-name 
```

HTH :-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T17:11:44.667

它位于 .viminfo 文件中（如果您在 Windows 上，则为 _viminfo）。它应该在您的主目录中。

# excel - SqlBulkCopy 不复制长度大于 255 个字符的字符串

> ID：769220
> 
> 赞同：0
> 
> 时间：2009-04-20T17:11:52.093
> 
> 标签：excel, sqlbulkcopy

我正在尝试将大型 Excel 电子表格复制到 SQL Server 数据库中。我正在打开一个到 Excel 电子表格的 OldDbConnection 并从 [Sheet1$] 中读取所有内容。然后，我使用 OleDbCommand 来获取带有电子表格数据的 IDataReader。

Excel 工作表中有几个单元格的文本内容超过 256 个字符。但是，一旦使用 SqlBulkCopy 将其上传到数据库表，我只能看到数据库中这些 excel 单元格的前 255 个字符。数据库表字段的长度为 5000 个字符。

SqlBulkCopy 是否限制字段大小？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T20:02:16.130

根据我对 ADO 数据连接的经验，在将记录集的光标位置更改为客户端时，检索和发送大文本字符串可能会更好。

这里有一个简短的例子：

```
Dim rstADO As ADODB.Recordset
Set rstADO = New ADODB.Recordset
rstADO.CursorLocation = adUseClient 
```

但更仔细地查看您的帖子，我认为您目前没有使用 ADO，如果您决定尝试在您的方法中使用 ADO，无论如何可能值得一看。祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T21:12:39.813

我不知道 SqlBulkCopy 和 OldDbConnection。
但是 Excel 可能会给出前 255 个字符。
在 Excel 中，如果您使用 .value 属性访问单元格值，您将获得前 255 个字符，如果您使用 .text 属性访问它，您将获得全文。希望这会给你一些想法。

# nhibernate - nHibernate 需要延迟加载吗？

> ID：769227
> 
> 赞同：6
> 
> 时间：2009-04-20T17:13:02.043
> 
> 标签：nhibernate, lazy-loading

我花了很长时间，但我终于让 nHibernate 的 Hello World 工作了。在我进行“延迟加载”之后它起作用了。老实说，我无法告诉你为什么这一切都有效，但它确实有效，现在我正在阅读你不需要延迟加载。有没有人拥有一个让 nHibernate 正常工作的你好世界？你必须有延迟加载吗？我问是因为我想使用 nHibernate，但我需要了解事情是如何工作的。

谢谢你。

你知道没有那么多开销的 hello world 吗？

使用延迟加载更好吗？

编辑：我正在使用 asp.net 3.5。网络应用项目。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-20T20:07:48.707

我不明白您所说的“我做了延迟加载”是什么意思。延迟加载是一项功能，默认开启，不喜欢可以关闭。

有两种延迟加载：用于引用其他实体和用于列表。

给定这个实体：

```
class Entity
{
  // pk
  int id { get; private set; }

  // reference to another entity
  User MyUser { get; set; }

  // list to other entities
  IList<Comments> MyComments { get; set; }
} 
```

**延迟加载对 User 的引用**

如果对 User 进行延迟加载，则需要定义 User 类的所有成员 virtual。NHibernate 将创建一个所谓的代理。代理是在运行时定义的一个类，它派生自 User。您的代码以用户身份访问它，并且不知道它是一个子类。但是当您第一次访问它的一个成员时，属性是从数据库中加载的。

如果要关闭 User 类的延迟加载，则需要在其映射中执行此操作：

```
<class name="User" lazy="false"> ... 
```

然后 NHibernate 总是创建用户类型的实例，没有代理。你不需要任何虚拟的东西。

**评论列表的延迟加载**

如果您在评论列表上使用延迟加载，那么实现延迟加载的是列表本身。如果您第一次访问该列表，它会从数据库中加载。NHibernate 使用实现 IList 的列表，但不是 List。

如果要关闭列表中的延迟加载，请在 Entity 的映射中执行此操作：

```
<class name="Entity">
    <bag name="MyComments" lazy="false" >
        ... 
```

通常，延迟加载是一件好事，您的应用程序不必太在意它。但也存在一些风险。例如，如果您序列化一个实例，并且它是一个代理，您将得到一个未初始化的代理，而不是任何有用的东西。延迟加载仅在会话打开时才有效。使用延迟加载并不总是更快。如果您无论如何都需要加载所有数据，那么将其加载到一块会更快。

所以配置需要仔细。

* * *

**编辑：**

回答您最初的问题：NHibernate 需要延迟加载吗？不可以。但是：我的应用程序需要延迟加载吗？很可能是的。

我认为，只有小型且相当琐碎的应用程序才不需要延迟加载。如果您有一个包含许多持久类的系统，则需要延迟加载。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-20T17:17:47.447

如果您使用 hbm.xml 文件进行映射，只需将 a 添加`lazy="false"`到`<class>`元素即可让您对所有简单属性进行非延迟加载。默认情况下，外部实体仍然是惰性的。为了让他们渴望添加`lazy="false"`到映射元素。急切加载的一个好处是您将不再需要实体类上的虚拟属性。

编辑：如果您真的想了解幕后发生的事情，NHibernate 使用 log4net 记录所有内容。添加

```
<configSections>
  <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/>
  <!-- Rest of config sections here -->
</configSections>
<log4net>
  <appender name="SQLFileAppender" type="log4net.Appender.RollingFileAppender, log4net">
    <param name="File" value="C:\Logs\SQL.log" />
    <param name="AppendToFile" value="true" />
    <layout type="log4net.Layout.PatternLayout">
      <param name="ConversionPattern" value="%date [%thread] %-5level %logger - %message%newline" />
    </layout>
  </appender>
  <logger name="NHibernate.SQL" additivity="false">
    <level value="DEBUG" />
    <appender-ref ref="SQLFileAppender" />
  </logger>
</log4net> 
```

在你的 web.config里面`<configuration>`会吐出所有的 SQL NHibernate 生成的文件`c:\logs\sql.log`

# php - 如何str_pad这个PHP日期选择月份数组？

> ID：769229
> 
> 赞同：0
> 
> 时间：2009-04-20T17:13:47.220
> 
> 标签：php, arrays, date, padding

需要对此进行填充： str_pad($Month, 2, "0", STR_PAD_LEFT) 但是如何/在哪里？？？

```
/*******creates the month selection dropdown array****/

 function createMonths($id='month_select', $selected=null)
    {
        /*** array of months ***/
        $months = array(
                1=>'Jan',
                2=>'Feb',
                3=>'Mar',
                4=>'Apr',
                5=>'May',
                6=>'Jun',
                7=>'Jul',
                8=>'Aug',
                9=>'Sep',
                10=>'Oct',
                11=>'Nov',
                12=>'Dec');

        /*** current month ***/
        $selected = is_null($selected) ? date('m') : $selected;

        $select = '<select name="'.$id.'" id="'.$id.'">'."\n";
        foreach($months as $key=>$mon)
        {
            $select .= "<option value=\"$key\"";
            $select .= ($key==$selected) ? ' selected="selected"' : '';
            $select .= ">$mon</option>\n";

        }
        $select .= '</select>';
        return $select;
    }

/********displays the month selection with current month selected/*******</br>
 echo createMonths('Month', date ('m')); 

/******DISPLAYS MONTH AS (4) INSTEAD OF REQUIRED (O4) --- @:( /*****</br>
echo $_POST['Month']; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:19:43.073

好吧，假设它是您想要填充的值，它就在这里：

```
$select .= "<option value=\"$key\""; 
```

变成

```
$select .= '<option value="'.str_pad($key, 2, "0", STR_PAD_LEFT).'"'; 
```

这假设您在对 进行检查时不希望它被填充`$selected`，如果这样做，则需要在循环开始时进行，覆盖 中的值`$key`，然后您可以使用原始代码，例如所以：

```
foreach($months as $key=>$mon)
{
    $key = str_pad($key, 2, "0", STR_PAD_LEFT);
    $select .= "<option value=\"$key\"";
    $select .= ($key==$selected) ? ' selected="selected"' : '';
    $select .= ">$mon</option>\n";
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:20:26.207

您可以使用[`printf()`](http://uk.php.net/printf)或[`sprintf()`](http://uk.php.net/sprintf)与格式字符串一起使用：

```
$m = sprintf('%02d', (int) $_POST['Month']); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:22:28.323

当你说：

```
$select .= ">$mon</option>\n"; 
```

您应该使用 str_pad 函数，如下所示：

```
$select .= ">" . str_pad($mon, 2, "0", STR_PAD_LEFT) . "</option>\n"; 
```

# jquery - 用于悬停在 Div 上的 jQuery 图像交换

> ID：769231
> 
> 赞同：1
> 
> 时间：2009-04-20T17:14:16.690
> 
> 标签：jquery, image, swap

```
$(document).ready(function () {
    // Hide all large images except the first one
    $('#imageContainer img').hide().filter(':first').show();
    // Select all thumb links
    $('#thumbContainer a').hover(function (event) {
        // Hide all large images except for the one with the same hash as our thumb link
        $('#imageContainer img').hide().filter(this.hash).show();
    },
        function () { } // Because the hover method has a mouseout state we need to define too
    );
}); 
```

此 .js 脚本适用于锚标记上的鼠标悬停。但是，我希望这个函数可以在整个 div 上工作。

如何更改这部分： `.filter(this.hash).show();`

对此：`.filter(this.(id or unique name).show();`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T17:19:11.013

如果您仍然想使用哈希，您可以使用以下代码获取它（假设这`this`是您的 div）：

```
var hash = $(this).find('a').get(0).hash; 
```

如果你想对 div 使用一些独特的东西，我之前使用的 div 的 id 等于 img 的 className。

如果你有这个 html：

```
<div id="container1" class="thumbContainer"></div>
<div id="imageContainer">
  <img src="" alt="" class="container1" />
</div> 
```

你可以使用这样的东西，（我把你的悬停改为鼠标悬停，因为你只使用它）：

```
$(document).ready(function(){
    // Hide all large images except the first one
    $('#imageContainer img').hide().filter(':first').show();
    // Select all thumb links
    $('.thumbContainer').mouseover(function(event) {
            // Hide all large images except for the one with the same hash as our thumb link
            $('#imageContainer img').hide().filter("." + this.id).show();
        }
    );
}); 
```

# svn - 如何在命令行中跨多个外部执行单个 SVN 提交？

> ID：769236
> 
> 赞同：23
> 
> 时间：2009-04-20T17:15:26.953
> 
> 标签：svn

这可能是不可能的，但我还是要问。

在不详细说明为什么会这样的情况下，我有两个主要的检查，一个用于生产发布分支，一个用于主干。它们中的每一个都是对子项目的 svn:externals 引用的小集合，在签出的 svn 目录下没有直接内容。

也就是说，四个 svn:externals 指令添加了每个结帐目录中的所有内容。

当我通过 Eclipse(/Subclipse) 进行提交时，我可以一次性提交所有外部项目的更改，这很好，因为它们只是同一存储库中的单独子项目，这使我可以避免做 4 个单独的项目连续提交到同一个仓库。

不能从命令行做同样的事情吗？每个外部的提交当然可以编写脚本并别名为一个命令，但如果可能的话，我宁愿避免将提交日志与相关更改的单独提交混淆。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-20T18:24:35.647

您可以在命令行客户端中指定要提交的所有文件和文件夹，包括外部文件。由于 CL 不会递归到外部，因此您必须在提交命令中单独指定它们：

```
svn ci working_copy externals1 externals2 -m "log message" 
```

不过没试过这个。如果它不起作用，您必须单独指定所有修改过的文件和文件夹，而不仅仅是外部的“根”文件夹。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2016-09-02T09:49:41.147

使用最新的 SVN，您可以：`--include-externals`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-20T17:45:48.207

不幸的是，你的假设是正确的。当前的颠覆命令行工具在提交期间不会递归到脱节的外部工作副本。Eclipse 可能会发现它的所有根基都相同，并调整了所有内容，以便它只执行一个提交事务。

客户端的这个缺点实际上被列为在项目中定义外部时要注意的问题之一。对于 1.6.1 客户端，此限制仍然存在。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-28T11:25:09.580

如果你只有内容而没有属性修改，你可以做一些事情：

```
svn st | egrep "^M" | awk '{print $2}' | xargs svn ci -m 'your message' 
```

如果您已添加/删除，... 文件，您可以修改`egrep`正则表达式以满足您的需要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-13T17:53:51.917

我遍历所有外部，并在每个外部执行“svn commit”，例如：

```
for dir in $(svn propget svn:externals . | awk '{print $2}'); do svn commit $dir; done 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2010-11-26T14:38:19.223

你可以做：

```
svn ci -m"my comment" * 
```

# asp.net-mvc - 在视图中使用 MVC Html.RadioButton

> ID：769238
> 
> 赞同：0
> 
> 时间：2009-04-20T17:15:43.317
> 
> 标签：asp.net-mvc

我在视图上有许多动态创建的字段。让我们说

```
Car Payment [1] [2] [3]
House Payment [1] [2] [3]
CC Payment [1] [2] [3] 
```

在我的控制器中，我想查看用户为每个选项选择的值，但我发现使用 FormCollection 我只能返回“汽车付款”、“房屋付款”和“CC 付款”。除非我将这些输入明确定义为控制器变量，否则我不会取回与这些单选按钮选择相关的实际值。不幸的是，这些单选按钮是动态生成的，包括它们的名称，所以这不是一个选项。在处理这个问题方面有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:52:48.033

我认为你真的应该在控制器上使用 ValueProvider 而不是在请求本身中引用参数。使用 value provider 将使单元测试更容易，因为您不必模拟请求，只需向控制器提供 ValueProvider 实现。

```
 ...
  var provider = new FormCollection();
  provider["CarPayment"] = "1";

  var controller = new PaymentController();
  controller.ValueProvider = provider.ToValueProvider();

  var result = controller.Create();
  ...

  public ActionResult Create()
  {
      int carPaymentType = (int)this.ValueProvider["CarPayment"].ConvertTo(typeof(int));
      ...
  } 
```

显然，您需要添加错误检查等。您还可以像在 Request.Form 上一样遍历 ValueProvider 上的键。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T17:38:45.587

好的，我想出了如何在控制器中执行此操作，我想我会分享。

在我的示例中，Request["CarPayment"] 将能够从 RadioButton 集合中动态提取值。

# ruby-on-rails - Ruby on Rails time_select 插件？

> ID：769249
> 
> 赞同：4
> 
> 时间：2009-04-20T17:18:02.517
> 
> 标签：ruby-on-rails, ruby, plugins, datetime-select

有人知道任何只有一个选择框的 Ruby on Rails time_select 插件吗？所以选择框有“9:00 AM”、“9:15 AM”等条目？

我见过一些插件，但没有这样的。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T21:39:16.240

我在我的应用程序中使用了 time_selects ALOT，并通过两个小调整解决了时间选择问题。

第一个是 minute_step：

```
f.time_select :start_of_shift, :minute_step => 15 
```

这会将那个令人发指的分钟选择框切割成一个非常易于管理的大小（选择你自己的！）

另外，我发现了一个 ruby​​ 模块，我将它放在我所有基于时间的应用程序的初始化文件夹中：

```
module ActionView
module Helpers
class DateTimeSelector
def select_hour_with_twelve_hour_time 
  datetime = @datetime
  options = @options
  return select_hour_without_twelve_hour_time(datetime, options) unless options[:twelve_hour].eql? true
  if options[:use_hidden]
    build_hidden(:hour, hour)
  else
    val = datetime ? (datetime.kind_of?(Fixnum) ? datetime : datetime.hour) : ''
    hour_options = []
    0.upto(23) do |hr|
      ampm = hr <= 11 ? ' AM' : ' PM'
      ampm_hour = hr == 12 ? 12 : (hr / 12 == 1 ? hr % 12 : hr)              
      hour_options << ((val == hr) ?               
      %(<option value="#{hr}" selected="selected">#{ampm_hour}#{ampm}</option>\n) :               
      %(<option value="#{hr}">#{ampm_hour}#{ampm}</option>\n)             
      )
    end           

    build_select(:hour, hour_options)         
  end       
  end       
  alias_method_chain :select_hour, :twelve_hour_time     
  end   
end
end 
```

我希望我能记住我在哪里找到它，这样我就可以相信它的来源，但简而言之，它允许我指定 12 小时的时间，将我的 time_select 字段分解为两个非常容易管理的简单选择。

```
f.time_select :start_of_shift, :twelve_hour => true, :minute_step => 15 
```

编辑：找到 ruby​​ 文件的来源！在这里找到它：http: [//brunomiranda.com/past/2007/6/2/displaying_12_hour_style_time_select/](http://brunomiranda.com/past/2007/6/2/displaying_12_hour_style_time_select/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-08T20:01:32.220

这是一个非常基本的助手，把它放在你的应用程序助手中。您必须使用 Time.parse(params[:your_field]) 转换控制器/模型中的时间。这可能无法解决您的问题，但它至少应该为您指明正确的方向。

```
def time_select_tag(name)
  times = []
  (00..23).each do |i|
    (0..3).each { |inc| times << Time.parse("#{i}:#{inc * 15}") }
  end
  return select_tag name, options_for_select(times.map{|t| t.strftime('%I:%M%p')})
end 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-08T17:14:59.400

你看过[12_hour_time](http://code.google.com/p/rails-twelve-hour-time-plugin/)吗？这在过去对我有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-10-26T08:31:27.493

Rails [ActionView::Helpers::DateHelper](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-time_select)类对此有一个解决方案

```
<%= f.time_select :attribute_name, :minute_step => 15, :ampm => true %> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T17:22:10.883

所以你想在一个选择列表中以 15 分钟为增量的每一个可能的时间？我真的建议使用标准的 time_select 插件来做。

**编辑添加**我不知道这样的事情，我不认为它会在那里，你可能必须自己做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-13T04:28:34.363

如果您希望使用 Rails 3 执行此操作，则需要分配`html_options`一个空字符串 ( `html_options = ""`)。`build_select`要求选择选项为 html。否则你会收到`can't convert Array into String`。

请参阅[build_select](https://github.com/rails/rails/blob/master/actionview/lib/action_view/helpers/date_helper.rb#L985.)文档。

只是一个友好的更新。享受。

# c++ - gdb 不接受 Emacs 中的标准输入重定向

> ID：769250
> 
> 赞同：2
> 
> 时间：2009-04-20T17:18:19.597
> 
> 标签：c++, emacs, gdb, cygwin, stdin

我正在尝试在 emacs 中使用 gdb 模式调试程序。它是用 g++ 编译的，我使用的是 cygwin。我的程序接受一个命令行参数，并且还接受来自我从文件重定向的标准输入的输入，如下所示：

```
program.exe inputFile.dat <otherInput.dat 
```

问题是，gdb 正在发送字符串

```
"<otherInput.dat" 
```

作为命令行参数而不是重定向标准输入。如何强制 gdb 重定向标准输入？

编辑：

在 gdb 中，我使用以下命令：

```
run inputFile.dat <otherInput.dat 
```

当我在 emacs 之外使用 gdb 时，它也不起作用。

编辑＃2：

dfa 指出了一个类似的问题：[How to load program reading stdin and take parameters in gdb?](https://stackoverflow.com/questions/455544/how-to-load-program-reading-stdin-and-taking-parameters-in-gdb)

不幸的是，该问题的公认答案对我不起作用……这可能是与 cygwin 相关的错误吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T17:22:04.860

看来您必须使用以下`run`命令：

> 您可以使用带有 run > 命令的 shell 重定向来重定向程序的输入和/或输出。例如，
> 
> ```
> run > outfile 
> ```

[http://sourceware.org/gdb/current/onlinedocs/gdb_5.html#SEC24](http://sourceware.org/gdb/current/onlinedocs/gdb_5.html#SEC24)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T00:10:11.697

如果您使用的是 bash，您可以立即通过执行将 gdb 附加到该进程`PROGRAM ARGS < FILE & jobs -x gdb PROGRAM %1`。根据您使用的 shell，您可能会发现自己必须使用更多创造性的方法（可能涉及将输出`ps -C`重定向到 gdb 的命令行）。

# asp.net - 存储帐户/密码

> ID：769258
> 
> 赞同：1
> 
> 时间：2009-04-20T17:21:02.820
> 
> 标签：asp.net, asp.net-membership

我正在开发一个需要存储用户名和密码的基于 Web 的应用程序。代表用户执行二次身份验证需要帐户信息，因此我不能简单地使用盐等单向哈希存储用户名和密码。

假设我的基本要求不能改变，关于如何处理这些帐户的存储有什么建议吗？使用机器密钥进行对称加密？在 web.config 中使用随机密钥？使用基于 SQL 的加密？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T17:22:55.920

为什么不使用内置的 MembershipProviders？ [http://msdn.microsoft.com/en-us/library/yh26yfzy.aspx](http://msdn.microsoft.com/en-us/library/yh26yfzy.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:28:25.657

[SqlMemebershipProvider](http://msdn.microsoft.com/en-us/library/system.web.security.sqlmembershipprovider.aspx)拥有您需要的一切。甚至还有一个 .NET 附带的内置应用程序可以准备您的数据库。

这是db prep 工具上的[MSDN 页面](http://msdn.microsoft.com/en-us/library/x28wfk74.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T17:29:52.533

此处的最佳做法是在您将其传递给外部提供商之前不要询问此信息。然后只保留外部提供者的身份验证令牌，这样您只需要在用户直接访问外部资源需要它们的地方再次请求凭据。

# apache-flex - Flex中的三次曲线面积图，可以吗？

> ID：769259
> 
> 赞同：0
> 
> 时间：2009-04-20T17:21:33.647
> 
> 标签：apache-flex, charts

一个例子是 pchart 可以创建的填充三次曲线图：http: [//pchart.sourceforge.net/](http://pchart.sourceforge.net/)

是否可以在 flex 中重新创建类似的东西？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T17:29:36.963

是的，您可以使用 Flex 的默认图表来做到这一点。 [折线图类型](http://livedocs.adobe.com/flex/3/html/help.html?content=charts_types_08.html)

如果你想要一个更自由的替代品，你也可以使用 Flare。 [耀斑](http://flare.prefuse.org/)

# flash - ExternalInterface.addCallback 不起作用？

> ID：769260
> 
> 赞同：0
> 
> 时间：2009-04-20T17:21:38.917
> 
> 标签：flash, actionscript-3, callback, externalinterface

我有一个 Flash/AS3 项目，我正在尝试添加回调，我添加了回调，如下所示：

```
ExternalInterface.addCallback('force_refresh',force_refresh); 
```

我是这样从 JS 调用的：

```
function thisMovie(movieName) {
    if (navigator.appName.indexOf("Microsoft") != -1) {
        return window[movieName];
    } else {
        return document[movieName];
    }
}
function forceRefresh() {
    thisMovie("monthly_goals").force_refresh();
} 
```

我确保我正在导入 ExternalInterface 类，我将 allowScriptAccess 设置为“always”，我提醒 thisMovie("monthly_goals") 并确认 JS 看到了该对象。

不知道为什么它不会工作？有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T18:58:37.173

所以我的回调方法需要一个参数，而从 JS 调用它时我没有传递一个参数，所以我猜它只是默默地失败了。

# html - 如何有一个多行输入或换行的文本区域？

> ID：769263
> 
> 赞同：2
> 
> 时间：2009-04-20T17:22:21.817
> 
> 标签：html, css

我正在尝试在 html 中实现打印时看起来完全一样的布局：

```
注释： _____________________________________________
_______________________________________________________
```

...其中带下划线的部分是某种类型的单个输入标签——这意味着它也可以是文本区域或其他东西，只要用户可以输入文本并打印出来。

要求：

*   " `Comments`" 文本*必须*与输入文本的第一行在同一行
*   我不能只将“评论”一词放在文本区域中。
*   我不能使用多个文本输入
*   打印时两行输入都要加下划线
*   我不能指望在打印之前提交的页面：我已经做了几乎所有客户端的事情。

原因是当从浏览器打印页面时，我必须在视觉上重新创建来自外部公司的纸质文档以完全匹配。这是我加入这家公司之前的内部“表格”系统的一部分。它的设置是为了让这些表单在浏览器中自动调整页边距和页眉，所以这不是问题。按照我需要的方式获取这个 html 格式*是*.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T17:36:59.833

您可能希望有一个单独的样式表用于打印，并且当他们开始打印时，丢失文本区域并为打印显示设置所有内容。

需要一些 javascript 来执行此操作，它可以通过更改新页面上的元素进行打印，但这没什么大不了的。

然后，您可以拥有多个具有您想要的格式的 div，以及所有内容的位置。

另一种选择是让他们单击打印按钮，将页面转换为 pdf。有几个选项取决于您在服务器端拥有的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:29:33.877

尝试使用相对定位的 div，它将包含一个文本区域以及另一个绝对定位的 div。

```
<div id="outer" style="position: relative">
    <textarea id="txtArea" style="text-decoration: underline;"></textarea>
    <div style="position: absolute; left: 5px; top: 5px;">Comments:</div>
</div> 
```

您必须对 textarea 进行一些样式设置才能获得您想要的效果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T19:10:36.410

没有简单的方法，但您可以尝试绝对定位标签以显示在文本字段的顶部并为文本字段提供文本缩进。或者通过 JavaScript 给它一个默认值。

最简单的方法需要 JavaScript 或者 CSS ":before" 伪选择器，这两种方法都不是完美的跨浏览器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T18:58:23.490

您不能在包含您需要的文本框上放置一个背景图像（“评论：”和下划线），然后执行以下操作：

```
text-indent:5em; /* or whatever works... */ 
```

在元素上？人们将打印设置设置为不允许背景图像可能存在问题。我不确定这是否是个问题。另外，我不确定 text-indent 是否适用于 IE——我目前在 Mac 上，它适用于 FF 和 Safari。

编辑：它确实适用于 IE7 和 IE8。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T17:32:11.623

我相当确定仅使用 HTML 和 CSS 是不可能的（假设您希望有人能够在这两行上输入文本）。唯一的多行输入是一个文本区域，它必须是一个正方形。

您可能可以使用一些 javascript 技巧来做到这一点，使用[TinyMCE](http://tinymce.moxiecode.com/)样式的编辑器框，并使用 javascript 强制文本“评论：”停留在开头，然后在输入时自动为文本添加下划线，以模拟外观.

# metrics - 错误指标——我可以从我的错误数据库中得到什么？

> ID：769267
> 
> 赞同：4
> 
> 时间：2009-04-20T17:23:15.543
> 
> 标签：metrics

作为内部研究项目的一部分，我们正在尝试从 Bugzilla 数据库中收集一些指标；我们已经找到了一个工具来帮助我们从中收集一些指标（[BugzillaMetrics](http://www.bugzillametrics.org/)），但我们现在问自己应该收集哪些指标？

现在，这就是为什么我想问你：

**

## 您收集了哪些关于错误的指标？

**

在我们的办公室，团队很小（2 到 5 名开发人员），我们考虑了每个开发人员的错误、每个开发冲刺、每个类别的错误（GUI、业务逻辑、数据库）等指标，但我们想听听其他一些想法。

提前感谢=）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T17:34:24.690

相关度量之一是在一个时间单位（例如，周、测试迭代等）上发现的缺陷数量。这可能是一个很好的指标，表明何时可以停止测试和修复。当然，这个指标也可以考虑 bug 的优先级（如果每周报告 10 个微不足道的 bug，你可能会比每周报告 1-2 个主要缺陷更不感兴趣）。

您可能会发现另一个有用的指标是修复缺陷的平均时间（报告和修复/关闭错误之间的时间）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T17:33:14.523

每个类别的错误肯定。我还会对实际花费的时间进行时间估算。这一点给开发人员一个工具来学习如何做出准确的估计。估计时间是一个出了名的模糊过程，你最好的来源是经验。使用此指标，您可以获得对每个人给出的估计的信心。

但是请注意，您仍然不能只说 Bug X 应该花费 Y 时间，因为它类似于 Z Bug。但是您可以让开发人员贝克查看它，当“需要 2 天才能修复”时，您可以判断他的准确程度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-30T05:48:30.743

我建议以下指标列表：

*   整个产品中当前未解决的缺陷数。
*   迭代燃尽图的指标：打开的错误/任务数，为给定迭代计划的已解决错误/任务数
*   [每个产品版本的缺陷检测百分比](http://blog.programeter.com/post/970852944/sdlc-metric-defect-detection-percentage)。该指标显示了在开发和 QA 期间检测到的缺陷与版本已经发布时在 QA 之后发现的缺陷之间的比率

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-16T12:59:54.590

以下是比较有用的：

1.  每次迭代发现的 CRITICAL 和 MAJOR 错误的比率，以及解决这些错误所花费的平均时间。例如，对于 CRITICAL，可以在几小时内确定目标，对于 MAJOR，可以在几天内确定目标，可以根据历史数据修改目标，使其具有现实的挑战性。

2.  发布时产品中剩余的主要错误数。根据产品/行业/客户的不同，发布 3 或 5 或 7 MAJOR 可能是可以接受的。{{ 假设 CRITICAL Bugs = 0 即不可接受。}}。

3.  高优先级生命周期比率：P1 解决时间与所有优先级的平均解决时间的比率。

4.  Reopened Rate : CRs 重新打开的案例占迭代中已修复案例的百分比。

5.  2 天内无评论/答案的 CR：创建后 2 天内研发未回复的案例比例。

6.  严重错误的优先级 阻止程序和关键 CR 的平均优先级

7.  已解决的案例与解决方案 INVALID 的比率 | 或重复。

苏希尔·贾拉利

# c# - 如何在 .NET 中验证 LDAP

> ID：769268
> 
> 赞同：15
> 
> 时间：2009-04-20T17:23:29.257
> 
> 标签：c#, ldap, novell

我想在具有任何目录服务的 Windows 操作系统上验证我的应用程序的用户名和密码。例如，它可以是 microsoft Active Directory、Novell eDirecotry 或 SunOne。我已经知道如何使用 c# 为 Microsoft Active Direcotry 本地执行此代码。（我完全放弃了使用 ADSI 并创建了一个低级 com 组件）

我尝试使用 Novel eDirecotory 进行身份验证的方式是我安装了 Mono 项目。在 mono 项目中，他们为您提供 Novell.Directory.ldap.dll 代码看起来与 Microsoft Active Directory 的代码有些相同。( [http://www.novell.com/coolsolutions/feature/11204.html](http://www.novell.com/coolsolutions/feature/11204.html) )

对于 SunOne，我被告知使用与活动目录相同的代码，但 ldap 连接字符串有点不同。（[http://forums.asp.net/t/354314.aspx](http://forums.asp.net/t/354314.aspx)）（[http://technet. microsoft.com/en-us/library/cc720649.aspx](http://technet.microsoft.com/en-us/library/cc720649.aspx)）

为了使我的项目复杂化，大多数客户使用“服务帐户：”，这意味着我需要绑定管理用户名和密码，然后才能验证常规用户名和密码。我的问题分为两部分。

1）根据我上面的解释，这是我应该针对每个单独的目录服务进行身份验证的正确方向吗？

2）我觉得我根本不需要做任何这段代码。我也觉得使用服务帐户的规定根本不重要。如果我关心的只是在 Windows 机器上验证用户名和密码，为什么我什至需要使用 ldap？我想说的是，考虑一下。当您早上登录机器时，您无需提供服务帐户即可登录。我可以使用 runas 功能在 DOS 提示符下轻松验证用户名和密码，我将被拒绝或不被拒绝，并且可以解析文本文件。我确定还有其他方法可以将用户名和密码传递给我所在的 Windows 操作系统，并会告诉我用户名和密码是否对它所在的域有效。我对吗？如果是这样，你们有什么建议的方法？

Michael Evanchik www.MikeEvanchik.com

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-20T17:36:56.493

我不确定我是否完全理解这个问题，但在某些情况下，我发现通过简单地搜索他们的帐户并将他们的凭据用作用户名和密码来验证用户很容易。

成功的查询意味着提供的一切都是正确的，没有找到帐户意味着有问题。

```
//use the users credentials for the query
DirectoryEntry root = new DirectoryEntry(
    "LDAP://dc=domain,dc=com", 
    loginUser, 
    loginPassword
    );

//query for the username provided
DirectorySearcher searcher = new DirectorySearcher(
    root, 
    "(sAMAccountName=" + loginUser + ")"
    );    

//a success means the password was right
bool success = false; 
try {
    searcher.FindOne();
    success = true;
}
catch {
    success = false;
} 
```

可能不是“最佳实践”，但可能会解决您遇到的问题......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T19:54:19.677

所有这些都可以通过 System.DirectoryServices.Protocols 完成。如果创建到目录的 LdapConnection，则可以使用服务帐户进行绑定，然后进行后续绑定以验证凭据。

服务帐号一般用于限制访问服务器的认证机制。这样，街上的任何人都无法尝试使用您的 LDAP 服务器进行身份验证。

另外，您是否希望每个用户在登录时都提供他们的专有名称？使用 Active Directory，只需要 sAMAccountName，而其他提供商（如 eDirectory 和 SunONE）需要可分辨名称进行身份验证。

要执行这种类型的身份验证，您需要使用提供的服务帐户来对服务器进行身份验证，使用给定的用户名搜索用户，并获取该用户的专有名称。然后，您可以使用该专有名称和提供的密码进行身份验证。

这将适用于所有 LDAP 系统，Active Directory 除外，它只对 sAMAccountName 感到满意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:54:05.220

我们有一个网站需要根据域凭据验证用户名和密码，并使用 LogonUser API 函数。将它用于网络登录（它的参数之一是登录类型），它所做的只是验证凭据，它不会像 runas 那样加载用户配置文件。唯一需要注意的是，服务帐户确实需要足够的访问权限才能调用 LogonUser。我建议您查看 MSDN 文档以了解该访问是什么，因为它因操作系统而异。

# delphi - 如何更改 TPageControl 上标签的方向？

> ID：769285
> 
> 赞同：3
> 
> 时间：2009-04-20T17:29:05.280
> 
> 标签：delphi, delphi-2009, tabcontrol, orientation, tpagecontrol

我是 Delphi 的新手（同样——我在 1994 年使用过 Delphi）。我现在有 Delphi 2009 Pro。

来自Java，我发现对象继承非常模糊。

我的用户想要带有左侧选项卡的选项卡式页面。但是，TPageControl 不允许更改选项卡标签方向或方向。他们希望标签上的单词从上到下阅读，字母旋转，使它们处于“正常”方向。使用左侧的标签，标签从底部向上读取，字母旋转 90 度。向左倾斜，并且倾向于将头向左倾斜以阅读标签。我发现标准 TPageControl VCL 的一些增强功能为悬停和活动添加了图像、文本和颜色更改，但没有允许在选项卡上操纵字体方向或方向。

页面控制选项卡应类似于：

第
1
页
_
_

第 2 页
_ _

第 3 页
_ _

等等...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T18:23:03.497

1.) 设置 TPageControl 属性：

```
TabPosition := tpLeft;
OwnerDraw := True;
TabWidth := 180;    //set to any adequate value because
                    // TPageControl doesn't have a measure event handler 
```

2.) 使用以下 OnDrawTab 代码：

```
procedure TForm1.PageControl1DrawTab(Control: TCustomTabControl;
  TabIndex: Integer; const Rect: TRect; Active: Boolean);
var
  I: Integer;
  PageControl: TPageControl;
  TextFormat: TTextFormat;
  Text: string;
  TextRect: TRect;
begin
  PageControl := Control as TPageControl;

  Text := PageControl.Pages[TabIndex].Caption;

  for I := Length(Text) - 1 downto 1 do
  begin
    Text := Copy(Text, 1, I) + sLineBreak + Copy(Text, I+1, MaxInt);
  end;

  TextRect := Rect;
  TextRect.Left := TextRect.Left + 5;
  TextRect.Top := TextRect.Top + 3;

  TextFormat := [tfCenter];

  PageControl.Canvas.TextRect(
    TextRect,
    Text,
    TextFormat
    );
end; 
```

3.) 编译、[开始和享受](http://img26.imageshack.us/img26/2714/clipboard01kju.png)！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T18:45:33.710

与其说是 DIY 答案，还想指出 Delphi 是一个基于组件的开发平台，并且有几个第三方 VCL 控件在渲染和主题控制方面提供了一些非常灵活的选项。

我自己用过的并会推荐：

*   [提高控制](http://www.raize.com/DevTools/RzComps/Default.asp)。
*   [JVCL](http://sourceforge.net/project/showfiles.php?group_id=45786)包含大量控件并且是开源的（MPL 许可证）。

HTH 祝你好运

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T18:14:30.930

正如 X-Ray 所说：您需要所有者绘制标签。这并不难，我以前做过，但我还没有准备好发布任何代码。您将需要获取选项卡的画布并使用 TextOut 方法。

# asp.net - 我的自定义 sql 角色/成员资格提供程序必须在多大程度上符合示例？

> ID：769286
> 
> 赞同：0
> 
> 时间：2009-04-20T17:29:33.767
> 
> 标签：asp.net, roleprovider, asp.net-membership

我正在使用 Microsoft SQLProvider 和 SQLRoleProvider 示例中的成员资格和角色提供程序代码，我对如何将我自己的架构集成到源代码感到有些不知所措。

例如，GetAllUsers 方法从 ASP.NET 数据库中的特定表加载数据并将它们放入一个非常特定的数据结构中。我的桌子看起来不像那样。

我是否必须调整我的表格以包含这些字段，或者我可以用我自己的结构替换？

换句话说，我必须与 SQL 提供程序实现的过程的接口有多接近？这些 proc 也都有 pagesize 和 pagenumber 参数。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T17:38:30.593

提供者上的返回必须是一样的，你在数据库中实际做什么都无所谓，关键是外在的行为必须是一样的。

我强烈建议像他们一样实现 SQL Paging 解决方案，因为它使代码能够处理更大的负载。

# visual-c++ - 在 VS2005 中使用 stl 时出现链接问题

> ID：769289
> 
> 赞同：0
> 
> 时间：2009-04-20T17:29:43.033
> 
> 标签：visual-c++, stl, visual-studio-2005, linker

我刚刚在一些代码中添加了 STL 用法，我收到了这个链接错误：

错误 LNK2019：未解析的外部符号“公共：__thiscall std::_Lockit::~_Lockit(void)”

我一定在链接中遗漏了一些东西，我以前做过 - 到目前为止，谷歌搜索没有帮助。唔......

这是代码片段：

```
#pragma once
#include "Observer.h"
#include <list>

class NGE_Observable
{
public:
    Observable(void);
    virtual ~Observable(void);
    void    RegisterObserver(Observer *pObserver, void *user);
    void    UnRegisterObserver(Observer *pObserver);
    void    NotifyObservers();

private:
    std::list<Observer *>    observers;
}; 
```

**已回答！：**操作员错误 - 呃。我已将项目属性设置为忽略所有默认库，因此未链接 stl 库。我很困惑，因为我只收到一条错误消息，但是当我添加 stl 调用时，链接错误增加了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T17:32:25.273

一个可能的原因是您声明了类_Lockit 的析构函数，但您没有实现它。

_Lockit 是你实现的吗？

**后期编辑：**[这](http://debugq.org/showthread.php?t=12)对你有帮助吗 ？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T17:39:28.347

也许您将编译器选项设置为多线程，而链接器尝试链接到单线程标准库。线程模型或线程相关`#define`的不一致通常是名称中带有“锁定”的类中出现问题的原因......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:39:56.377

如果可能，请发布您的代码。还可以在 MSDN 论坛上查看[这个](http://social.msdn.microsoft.com/forums/en-US/vcgeneral/thread/98037b6e-f51a-4574-99fe-de10b4a76bd5/)看似相关的问题。您是否使用任何旧式标题等？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T18:21:36.933

析构函数实际上是否在任何地方实现？如果不是，那是你的问题。该列表尝试在删除包含的元素时调用它们的析构函数，如果析构函数实际上不存在于任何地方，则会出现链接器错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T18:27:37.450

错误清除说： std::_Lockit 已**声明**但**未定义**。

**如果您实现**了“std::_Lockit”，请发布它的定义。如果**其他人**实现了它，那么您忘记链接**库**文件而只包含**头**文件。

# sql - SQL TABLE DEFAULT 中的时间算术

> ID：769291
> 
> 赞同：0
> 
> 时间：2009-04-20T17:30:15.480
> 
> 标签：sql, firebird

在我的表格中，我想将一列的默认值设置为从现在起 30 天。这需要是一个真实的，而不是计算的列。就像是

> alter table T_NAME alter column EXPIRATION set default CURRENT_TIMESTAMP + 2592000

无效，但你明白了。我确信我可以使用插入前触发器来做到这一点，但我只是想知道在默认子句中是否有一个我不知道的算术技巧。

我的数据库是火鸟 2.1.2

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T04:34:01.063

我认为没有，因为语言参考为[CREATE TABLE](http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=ibp_60_sqlref#RSf13665)和[ALTER TABLE](http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=ibp_60_sqlref#RSf47768)提供了：

> [默认{字面| 空 | 用户}]

我想触发器确实是你唯一的选择。

# sql-server - 如何在数据库项目中使用 SqlFunctionAttribute 生成 SQL 以自行部署函数？视觉工作室失败

> ID：769292
> 
> 赞同：2
> 
> 时间：2009-04-20T17:30:46.557
> 
> 标签：sql-server, reflection, deployment, clr, user-defined-functions

**背景：**

Visual Studio 无法部署数据库项目。它试图删除已经引用的函数（例如在检查约束中），而不是仅仅添加新函数并更新现有函数，因此部署总是失败。

因此，我正在编写自己的代码来更新程序集并添加/更新任何功能。

我假设编译器/部署器使用反射和 SqlFunction 属性的属性，所以我也使用反射来收集具有 SqlFunction 属性的静态方法的 MethodInfo 列表。

**问题/任务：**

我需要知道如何将 SqlFunctionAttribute 的属性（例如 IsDeterministic、DataAccess、Name、IsPrecise 等）和函数的方法签名转换为适当的 T-SQL“CREATE FUNCTION”语句。

**我已经发现没有帮助的现有信息：**

“创建函数”的[文档](http://msdn.microsoft.com/en-us/library/ms186755.aspx)令人困惑且不完整。在底部，它最后提到了一些 SqlFunction 属性，如 IsDeterministic，但它谈论它们就像它们是 C# 属性，而不是 T-SQL 参数，所以我不知道如何在创建函数语句中使用它们。

```
//CLR Functions
CREATE FUNCTION [ schema_name. ] function_name 
( { @parameter_name [AS] [ type_schema_name. ] parameter_data_type 
        [ = default ] } 
    [ ,...n ]
)
RETURNS { return_data_type | TABLE <clr_table_type_definition> }
    [ WITH <clr_function_option> [ ,...n ] ]
    [ AS ] EXTERNAL NAME <method_specifier>
[ ; ] 
```

我希望该`clr_function_option`参数能够处理诸如 IsDeterministic 之类的事情，但它没有被列为选项。

同时，在 IBM DB2 的文档中，我看到类似以下的语句，而 MSDN 文档中没有任何类似的语句：

```
 CREATE FUNCTION countUp(INTEGER) 
  RETURNS INTEGER
  LANGUAGE CLR
  PARAMETER STYLE SQL
  SCRATCHPAD 10
  FINAL CALL
  NO SQL
  FENCED
  THREADSAFE
  NOT DETERMINISTIC
  EXECUTION CONTORL SAFE
  EXTERNAL NAME 'gwenUDF.dll:bizLogic.empOps!CountUp' ; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T22:47:33.647

在意识到拥有程序集本身的 SQL Server 可以访问 SqlFunctionAttribute 的属性值之后，我最终解决了这个问题。在这种情况下，无需（也没有语法）在“CREATE FUNCTION”T-SQL 语句中指定此类属性。

我构建了一个实用程序来自动枚举和部署函数和检查约束，其工作原理如下：

1.  它通过使用反射搜索具有 SqlFunction 属性的函数来枚举我指定的类中的所有可部署静态方法。它还运行一个查询来枚举所有已部署的现有标量和表值汇编函数。然后它将这些列表合并到一个列表中，其中每个函数要么存在，要么不存在。有一个更新程序集的按钮，以及一个切换每个功能存在的按钮，使添加/删除/更新功能变得轻而易举。

2.  此外，我在界面中添加了第二个选项卡来创建/启用/检查/禁用检查约束。我创建了一个名为 SqlFunctionCheck 的新属性，它可以多次应用于一个函数。该属性具有“表”属性和“字段”属性，可帮助实用程序构建检查约束。它按表聚合所有检查，为每个名为“CK_”+ table_name 的表创建一个检查，并创建一个约束表达式，通过“and”将所有方法调用与该表的关联字段名称传递给函数。如果约束已经存在，它会显示生成的约束表达式以及从 sql server 查询的约束表达式。

IMO，这是使用 SQL CLR 集成来强制管理工作室中的数据类型约束、代码中的 SQL 查询以及整个代码本身使用的来自集中数据（约束）类的数据的最终解决方案。

[![界面截图和相关函数头](https://i.stack.imgur.com/Wrdv7.png)](https://i.stack.imgur.com/Wrdv7.png)

# sql - 获取列的特定“版本”

> ID：769293
> 
> 赞同：0
> 
> 时间：2009-04-20T17:31:57.677
> 
> 标签：sql, sqlite

我有一个使用 SQLite 在本地存储数据的应用程序。可能有多个文件存储数据。所有文件都包含一个项目列表，但其中只有一个具有当前用户的“正确”状态（基本上，在 $HOME 中有一个“用户”数据库，在 /etc 中有一个“系统范围”数据库）。

通常，这两个文件将包含相同的项目列表，只有状态列会有所不同。但是，如果其中任何一个包含两者都不包含的项目，我也想要该数据。

SQLite 没有完全外连接。

我想出的一个解决方案是：

```
SELECT item, group_concat(status) AS status FROM (SELECT item,status FROM items UNION SELECT item,status FROM otherdb.items) GROUP BY item; 
```

然后解析逗号分隔的“状态”输出以获得“正确”状态。但是，我想要一个纯 SQL 解决方案。

我想要的状态值是：

```
If any = 1, status = 1
elif any = -1, status = -1
elif any = 2, status = 2
elif any = -2, status = -2
else status = 0 or NULL 
```

status 只能（在 db 中）为 -2,-1,0,NULL,1,2 所以这涵盖了所有数据。

如果有一个解决方案只给出非零和非空的一个，那也可以工作，尽管我更喜欢上面的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T14:35:13.023

我建议您采用一种方法：

1\. 创建一个临时表，一个附加列用于标记“otherbd”；
2\. 把两张桌子上的所有东西都扔进去；
3.删除不想要的行；

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-11T16:16:50.003

使用以下值创建状态优先级表

```
status  priority
  1       5
 -1       4
  2       3
 -2       2
  0       1
 NULL     0 
```

这个概念是将您的两个表与此 StatusPriorty 表连接起来，对记录进行分组并使用 MAX(Priority) 来获取您的结果

# eclipse-plugin - 如何将我的片段添加到现有插件的必需插件列表中

> ID：769305
> 
> 赞同：1
> 
> 时间：2009-04-20T17:34:06.470
> 
> 标签：eclipse-plugin, fragment

我目前有一个现有的插件，它引用了所需插件中的一个类。我已将此代码替换为对属于我的片段的一部分的类的引用。

我面临两个问题。如果我将片段作为 jar 文件导入，我将看不到我所做的更改，因为作为 Eclipse 应用程序运行的插件会导致 ClassNotFoundException

为了克服这个问题，我将一个额外的源（片段）链接到现有的插件项目。但是，该链接使用绝对路径，使其不适合部署。

我希望能够将插件与代码修改一起打包，并能够“依赖”我的片段代码。有没有办法可以将我的片段添加为依赖项？

例如：

```
Plugin Project I am changing : org.eclipse.*.editor
it depends on org.eclipse.*.edit

I have a fragment mydomain.*.edit which has org.eclipse.*.edit as host plugin

I want org.eclipse.*.editor to pick up mydomain.*.edit 
instead of org.eclipse.*.edit 
```

ps：我也尝试将mydomain.*.edit的jar文件打包到plugins目录中并尝试从那里提取它，当我单击插件依赖选项卡上的add required plugins时它没有显示在列表中org.eclipse.*.editor 的 .xml 文件

如果我不够清楚，请告诉我，我会尝试改写它。

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T11:10:39.647

如果我正确理解您想要做什么，我认为这是不可能的。您将不得不尝试其他方式。

插件依赖于其他插件。片段不作为单独的运行时实体存在，而仅作为插件的扩展存在。所以你的插件只能引用“编辑器”插件。

片段提供的类不能（也不应该）直接访问。如果它们正在实现插件 A 提供的可执行扩展，则它们可以由原始插件 (A) 返回。

如果您从另一个插件 (B) 引用片段的代码，则这些类将由插件 B 的类加载器加载，并且与插件 A 加载的类不同。

你的片段的目的是什么？您想访问插件 A 中的内部代码吗？你想扩展一个 Eclipse 编辑器吗？

如果您想扩展原始插件未公开为可扩展的功能，我认为唯一的方法是编写一个插件，从原始插件扩展编辑器类，将其与原始插件一起注册并改用它。

[编辑] 也许这个链接会更好地解释：[Eclipse FAQ](http://wiki.eclipse.org/FAQ_Can_fragments_be_used_to_patch_a_plug-in%3F)

希望这会有所帮助，弗拉德

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-18T14:06:17.980

谢谢弗拉德，你的解释很有帮助。与真正适用于片段的基于扩展的架构不同，我必须在编辑器中修改某个未作为扩展的一部分公开的组件。这个修改引用了我作为片段创建的外部项目，但可能是一个普通的 java 项目，它打包了一个我可以放在编辑器的类路径中的 jar 文件。

我可以通过将 jar 文件放在类路径中来解决依赖问题，但是当我将插件和相关插件导出为 jar 文件并将其放在 dropin 目录中时，它无法正确安装。（也不会将 jar 文件放在 plugins 目录中）

我尝试修改的 Eclipse 编辑器使用 EMF 项目。我将 EMF 项目保留在工作区中，以解决编辑器的依赖关系。但是，当我将与 eclipse 捆绑的 EMF jar 文件替换为工作区中的 EMF jar 文件时，无法正确识别我要编辑的文件。

还有另一种方法吗？

# .net - VB.Net 中的 WebBrowser.Refresh 问题

> ID：769309
> 
> 赞同：1
> 
> 时间：2009-04-20T17:35:03.113
> 
> 标签：.net, vb.net, browser, web-crawler

我正在 VB.net 中开发一个网络爬虫，并使用 System.Forms.WebBrowser 对象来处理使用 javascript 或表单帖子的网站上的导航，但我遇到了问题。当我向后导航 (WebBrowser.GoBack()) 到加载了表单帖子的页面时，该页面已过期，我必须刷新才能重新发送请求。当我调用刷新 (WebBrowser.Refresh()) 时，会弹出一个对话框进行确认。有没有办法可以在代码中绕过这个模态对话框？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T17:42:35.437

您可以传入 System.Windows.Forms.WebBrowserRefreshOption 类型的刷新选项。

有几个选项，这里描述：http:
[//msdn.microsoft.com/en-us/library/system.windows.forms.webbrowserrefreshoption.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowserrefreshoption.aspx)

这些选项似乎是您以编程方式控制 Web 浏览器刷新的唯一方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-20T13:42:44.783

我有一个类似的问题，弹出一个带有 javascript 警告的弹出窗口。我设法使用`window_error`事件来抑制它。

我将此行添加到`browser_completed`事件处理程序：

```
((WebBrowser)sender).Document.Window.Error +=
    new HtmlElementErrorEventHandler(Window_Error); 
```

这是我的`window_error`事件处理程序：

```
void Window_Error(object sender, HtmlElementErrorEventArgs e)
{
    e.Handled = true;
} 
```

另一个需要考虑的选择是玩弄`this._browser.ScriptErrorsSuppressed`. 我很确定您没有收到脚本错误，但值得一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-20T12:52:39.427

我在这里找到了解决此问题的解决方法[/hack：http://www.experts-exchange.com/Programming/Languages/.NET/Q_25160302.html](http://www.experts-exchange.com/Programming/Languages/.NET/Q_25160302.html)

基本上你这样做：

```
Browser.Refresh(WebBrowserRefreshOption.Completely);
SendKeys.Send("{Enter}"); 
```

该`SendKeys.Send("{Enter}");`行向活动窗口发送一个 Enter 键，这是我们想要摆脱的模式对话框。

# c# - 使用 C# 将 Html 表（文本）转换为图像

> ID：769310
> 
> 赞同：11
> 
> 时间：2009-04-20T17:35:57.450
> 
> 标签：c#, asp.net, html, css

谁能指出我在 C# 中用于将 html 表转换为图像的一些示例代码？我知道如何将文本转换为图像，但我需要创建格式良好的文本图像。整个文本格式为 html 表格。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T21:44:37.587

您可以使用 WebBrowser.DrawToBitmap 方法。这是一个[例子](http://pietschsoft.com/post/2008/07/C-Generate-WebPage-Thumbmail-Screenshot-Image.aspx)。所以我要做的是使用您想要的表格动态创建一个页面，除了表格之外什么都没有，然后使用 DrawToBitmap 方法将其保存到图像文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-30T11:12:47.013

最好是使用[http://iecapt.sourceforge.net/](http://iecapt.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:49:59.053

将 HTML 转换为位图是一项艰巨的任务。您首先需要一个能够处理 HTML 以及可选的 javascript 和 css 的渲染引擎（如果您想支持它们）。可以使用[WebBrowser](http://www.dreamincode.net/code/snippet2539.htm)控件，但可能有更好的方法。

# sql-server - 有没有办法重置 sql server 中的 IDENTIY 列？这会是不使用身份列的理由吗？

> ID：769312
> 
> 赞同：0
> 
> 时间：2009-04-20T17:36:03.267
> 
> 标签：sql-server, sql-server-2005

我有一个包含费用的开发数据库。它有一个feeid，它是一个唯一的key，即标识符。我遇到的问题是在生产服务器上更新表时，feeid/fee 金额可能不匹配。这显然会导致一些不好的事情发生，比如对某样东西充电过度或充电不足。有没有办法匹配 sql server 中的重置身份或匹配它们，或者这是您不想使用它们的示例？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T17:46:24.507

1.  除了识别唯一记录之外，不要让您的主键“有意义”。如果您需要在某处对 ID 进行硬编码，请为其创建另一列。所谓的“自然键”比它们的价值更麻烦
2.  如果出于某种原因，您决定不遵循或不能遵循第一条规则，请不要使用任何自动生成的键值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:45:42.900

那是标识列的行为，这也是它如此快速的原因，因为它不会锁定表

使用 DBCC CHECKIDENT 或 TRUNCATE TABLE 重置身份

将 ID 从一个表插入到另一个表并保持您需要做的相同值

```
SET IDENTITIY_INSERT ON

--upddate/insert rows

SET IDENTITIY_INSERT OFF 
```

请记住，在您的常规插入将失败的两个 SET IDENTITIY_INSERT 语句之间的时间段内！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T17:38:30.657

您可以将 IDENTITIY INSERT 设置为 ON，更新 ID（确保没有冲突），然后将其关闭。

# objective-c - 如何在 Objective-C 中检测属性返回类型

> ID：769319
> 
> 赞同：19
> 
> 时间：2009-04-20T17:38:37.940
> 
> 标签：objective-c, runtime, properties, types, key-value-observing

我在运行时在objective-c中有一个对象，从中我只知道KVC键，我需要检测这个属性的返回值类型（例如我需要知道它是NSArray还是NSM​​utableArray），我该怎么做?

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-21T00:09:34.243

您说的是运行时属性自省，这恰好是 Objective-C[非常擅长的](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html).

在您描述的情况下，我假设您有这样的课程：

```
@interface MyClass
{
    NSArray * stuff;
}
@property (retain) NSArray * stuff;
@end 
```

它在 XML 中编码，如下所示：

```
<class>
    <name>MyClass</name>
    <key>stuff</key>
</class> 
```

根据这些信息，您希望重新创建该类并为其赋予适当的`stuff`.

以下是它的外观：

```
#import <objc/runtime.h>

// ...

Class objectClass;       // read from XML (equal to MyClass)
NSString * accessorKey;  // read from XML (equals @"stuff")

objc_property_t theProperty =
    class_getProperty(objectClass, accessorKey.UTF8String);

const char * propertyAttrs = property_getAttributes(theProperty);
// at this point, propertyAttrs is equal to: T@"NSArray",&,Vstuff
// thanks to Jason Coco for providing the correct string

// ... code to assign the property based on this information 
```

Apple 的文档（上面链接）包含所有关于您可以在`propertyAttrs`.

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-11T21:40:09.683

便宜的答案：[在这里使用 NSObject+Properties 源](http://github.com/AlanQuatermain/aqtoolkit/tree/367b73a47e1a459a3758e138024d68dd92c7f33b/Extensions)。

它实现了与上述相同的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T18:20:20.603

首选方法是使用[NSObject 协议](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Protocols/NSObject_Protocol/Reference/NSObject.html)中定义的方法。

具体来说，要确定某物是某个类的实例还是该类的子类的实例，请使用`-isKindOfClass:`. 要确定某物是否是特定类的实例，并且仅是该类（即：不是子类），请使用`-isMemberOfClass:`

因此，对于您的情况，您需要执行以下操作：

```
// Using -isKindOfClass since NSMutableArray subclasses should probably
// be handled by the NSMutableArray code, not the NSArray code
if ([anObject isKindOfClass:NSMutableArray.class]) {
    // Stuff for NSMutableArray here
} else if ([anObject isKindOfClass:NSArray.class]) {
    // Stuff for NSArray here

    // If you know for certain that anObject can only be
    // an NSArray or NSMutableArray, you could of course
    // just make this an else statement.
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-05-07T23:01:55.443

这实际上是针对 Greg Maletic 为回应 e.James 21APR09 提供的回答而提出的问题的评论。

同意 Objective-C 可以使用更好的实现来获取这些属性。下面是我快速组合起来检索单个对象属性的属性的方法：

```
- (NSArray*) attributesOfProp:(NSString*)propName ofObj:(id)obj{

    objc_property_t prop = class_getProperty(obj.class, propName.UTF8String);
    if (!prop) {
       // doesn't exist for object
       return nil;
    }
    const char * propAttr = property_getAttributes(prop);
    NSString *propString = [NSString stringWithUTF8String:propAttr];
    NSArray *attrArray = [propString componentsSeparatedByString:@","];
    return attrArray;
} 
```

属性键的部分列表：

*   R 只读
*   C 分配的最后一个值的副本
*   & 引用最后分配的值
*   N 非原子性质
*   W 弱参考

[Apple](https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html)的完整列表

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T17:40:58.637

您可以使用 isKindOfClass 消息

```
if([something isKindOfClass:NSArray.class])
     [somethingElse action]; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-07-15T09:26:48.333

如果您知道该属性已定义：

```
 id vfk = [object valueForKey:propertyName];
        Class vfkClass = vfk.class; 
```

并与 isKindOfClass、isSubClass 等进行比较。

# android - 如何在 Android 中的另一个视图上为文本设置动画？

> ID：769326
> 
> 赞同：5
> 
> 时间：2009-04-20T17:40:43.880
> 
> 标签：android, animation, android-animation

我正在尝试在另一个视图之上为一些文本“缩小”设置动画。我的代码看起来像：

```
class BoardView extends View {

private TextView animText;

...

private void animText(String text, int color, int xBlocks, int yBlocks) {
    animText.setText(text);
    animText.setTextColor(color);
    animText.setVisibility(View.VISIBLE);
    final int x = BOARD_X_OFFSET + xBlocks * xBlockSize;
    final int y = BOARD_Y_OFFSET + yBlocks * yBlockSize;
    final float SCALE_FROM = (float) 0.25;
    final float SCALE_TO = (float) 5.0;
    ScaleAnimation anim = new ScaleAnimation(SCALE_FROM, SCALE_TO, SCALE_FROM, SCALE_TO, x, y);
    anim.setDuration(500);
    animText.setAnimation(anim);
    this.setAnimation(null);
    startAnimation(anim);
}

} 
```

在. `onDraw()`_ `BoardView`然而，我看到的是*板子*缩小，而不是文本，尽管上面调用了`setAnimation()`.

我查看了主要的 android 文档和另一个[示例](http://stuffthathappens.com/blog/2008/11/13/android-animation-101/)。即使是正确方向的指针也会有所帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T04:01:58.547

好吧，我很高兴我不是唯一一个很难找到上述非常微妙的错误的人。错误是：

```
startAnimation(anim); 
```

在您将其扩展为：

```
this.startAnimation(anim); 
```

在这一点上，为什么外部视图（即“this”）和文本一样具有动画效果就很清楚了。

# delphi - 绕过（禁用）Delphi 对接口的引用计数

> ID：769329
> 
> 赞同：11
> 
> 时间：2009-04-20T17:41:18.107
> 
> 标签：delphi

对于我正在处理的应用程序架构中的一个特定问题，接口似乎是一个不错的解决方案。具体来说，一些“业务对象”依赖于从实际应用程序中的数据库中提取的一系列设置。让这些业务对象请求一个接口（通过*控制反转*），并让一个中心`TDatabaseSettings`对象实现这些接口，可以实现更好的隔离，从而更容易进行单元测试。

然而，在 Delphi 中，接口似乎带有一个，在这种情况下，令人不快的好处：引用计数。这意味着如果我做这样的事情：

```
type
IMySettings = interface
    function getMySetting: String;
end;

TDatabaseSettings = class(..., IMySettings)
    //...
end;

TMyBusinessObject = class(TInterfacedObject, IMySettings)
    property Settings: IMySettings read FSettings write FSettings;
end;

var
  DatabaseSettings: TDatabaseSettings; 
    // global object (normally placed in a controller somewhere)

//Now, in some function...
O := TMyBusinessObject.Create;
O.Settings := DatabaseSettings; 
// ... do something with O
O.Free; 
```

在最后一行 ( `O.Free`)，我的全局`DatabaseSettings`对象现在也被释放了，因为最后一个对它的接口引用（包含在 中`O`）丢失了！

一种解决方案是使用接口存储“全局”`DatabaseSettings`对象；另一种解决方案是覆盖`TDatabaseSettings`类的引用计数机制，这样我就可以继续将其`DatabaseSettings`作为普通对象进行管理（这与应用程序的其余部分更加一致）。

**所以，总而言之，我的问题是：如何禁用特定类的接口引用计数机制？**

我已经能够找到一些建议覆盖`IInterface`方法`_AddRef`和`_Release`类的信息（`TDatabaseSettings`在示例中）；有没有人这样做过？

Or would you say I shouldn't do this (confusing? just a bad idea?), and find a different solution to the architectural problem?

Thanks a lot!

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-20T18:13:30.620

Ok, you can bypass it, but the question is if you really want that. If you want to use interfaces, you better use them completely. So as you have experienced it, you get problems if you mix class and interface variables.

```
var
  // DatabaseSettings: TDatabaseSettings; 
  DatabaseSettings : IMySettings;

//Now, in some function...
O := TMyBusinessObject.Create;
O.Settings := DatabaseSettings; 
// ... do something with O
O.Free; 
```

You now have a second reference to the interface and losing the first will not free the object.

It as also possible to keep both the class and the object:

```
var
  DatabaseSettings: TDatabaseSettings; 
  DatabaseSettingsInt : IMySettings; 
```

Be sure to set the interface right after the object has been created.

If you really want to disable reference counting, you just have to create a new descendant of TObject that implements IInterface. I have tested the example below in D2009 and it works:

```
// Query Interface can stay the same because it does not depend on reference counting.
function TMyInterfacedObject.QueryInterface(const IID: TGUID; out Obj): HResult;
begin
  if GetInterface(IID, Obj) then
    Result := 0
  else
    Result := E_NOINTERFACE;
end;

constructor TMyInterfacedObject.Create;
begin
  FRefCount := 1;
end;

procedure TMyInterfacedObject.FreeRef;
begin
  if Self = nil then
    Exit;
  if InterlockedDecrement(FRefCount) = 0 then
    Destroy;    
end;

function TMyInterfacedObject._AddRef: Integer;
begin
  Result := InterlockedIncrement(FRefCount);
end;

function TMyInterfacedObject._Release: Integer;
begin
  Result := InterlockedDecrement(FRefCount);
  if Result = 0 then
    Destroy;
end; 
```

FreeRef just lowers the refcount just like _Release. You can use it where you normally use Free.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-04-21T14:41:17.753

Don't descend from [TInterfacedObject](http://docwiki.embarcadero.com/RADStudio/en/TInterfacedObject), instead descend from [TSingletonImplementation](http://docwiki.embarcadero.com/Libraries/en/System.Generics.Defaults.TSingletonImplementation) from standard [System.Generics.Defaults](http://docwiki.embarcadero.com/Libraries/en/System.Generics.Defaults) unit.

*   **TSingletonImplementation** is a base for simple classes that need a basic IInterface implementation, with reference counting disabled.
*   **TSingletonImplementation** is a thread-safe base class for Delphi classes that support interfaces. Unlike TInterfacedObject, TSingletonImplementation does not implement reference counting.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-20T17:49:04.937

`_AddRef`, `_Release` and `_QueryInterface` are, in fact, what you want to override. You should be very clear about what you're doing, however, as this can cause memory leaks or strange, hard-to-find bugs.

Don't descend from `TInterfacedObject`, instead descend from `TObject`, and implement your own versions of the first two of those methods that return 1.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-20T20:44:01.427

To disable reference counting, AddRef and Release should do nothing but return -1

```
function TMyInterfacedObject._AddRef: Integer;
begin
  Result := -1;
end;

function TMyInterfacedObject._Release: Integer;
begin
  Result := -1;
end; 
```

There is quite a lot of utility in interfaces without reference counting. If you use reference counting, then you cannot mix object and interface references as bad things will happen. By disabling ref counts, you can happily mix interface and object references without worrying about your objects suddenly getting auto destroyed.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-20T18:23:34.200

Disabling reference counting for this kind of problem smells bad. A much nicer and architectural solution would be to use some kind of "singleton" pattern. The easiest way to implement this would look like:

```
interface 

type

TDatabaseSettings = class(..., IMySettings)
end;

function DatabaseSettings: IMySettings;

implementation

var
  GDatabaseSettings: IMySettings; 

function DatabaseSettings: IMySettings;
begin
 if GDatabaseSettings = nil then GDatabaseSettings := TDatabaseSettings.Create;
 Result := GDatabaseSettings;
end;

O := TMyBusinessObject.Create;
O.Settings := DatabaseSettings; 
O.Free; 
```

By the way: when you use interfaces: always use interface variables! Do not mix both class en interface vars (use "var Settings: IMySettings" instead of "var Settings: TDatabaseSettings"). Otherwise reference counting will get in your way (auto destroy, invalid pointer operations, etc). In the above solution, GDatabaseSettings is also of type "IMySettings", so it gets a proper reference count, and will last till your program terminates.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-07T10:45:46.077

Or just use the code below:

```
    var
      I: IMyInterface;
    begin
      I := ...;
      ...
      Do whatever you want in a scope;
      Initialize(I); //- this will clear the interface variable without calling the _release.
    end.

```

# c# - 如何从 VBScript 调用 C# DLL 函数

> ID：769332
> 
> 赞同：11
> 
> 时间：2009-04-20T17:41:37.717
> 
> 标签：c#, dll, vbscript, function-calls

我在服务器上有我的脚本，所以我没有可用的 UI 交互，必须使用 DLL 而不是控制台应用程序。

如何从 VBScript 调用 C# DLL 中的函数？

如何使我的 DLL 成为`COMVisible`？我必须注册吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-20T17:45:33.573

您需要通过将[COMVisibleAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.comvisibleattribute.aspx)设置为 true 将您的程序集标记为 COM 可见（如果您只想公开一种类型，则在程序集级别或类级别）。

接下来你注册它：

```
regasm /codebase MyAssembly.dll 
```

最后从 VBScript 调用它：

```
dim myObj
Set myObj = CreateObject("MyNamespace.MyObject") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T17:49:08.040

是的，您需要将该`ComVisible`属性设置为 true，然后使用 regasm 或 regsvcs 以及 tlbexp 注册程序集。然后你可以使用`Server.CreateObject`和航行。

# c# - 为什么在高流量网站中使用 Session 存储状态是个坏主意？

> ID：769338
> 
> 赞同：21
> 
> 时间：2009-04-20T17:43:17.960
> 
> 标签：c#, .net, asp.net

我在 asp.net/learn 上观看 ASP.NET 学习视频。在本教程中，他们正在构建一个测验引擎。有一次，叙述者解释说我们将使用 Session 对象来维护每个页面之间的状态（每个页面包含一个问题和四个答案）。他说“因为这是一个低流量的网站”，所以可以使用 Session 并且他没有时间实施更复杂的方法。

我只是想知道他在暗示什么替代方法？为什么会话对于高流量网站来说是一个糟糕的选择？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-20T17:46:59.917

将数据存储在数据库、cookie 或其他不直接占用 Web 服务器内存的方法中。

除了负载之外，会话还会引发使用场的能力问题，因为您需要在场中同步会话，或者使会话具有粘性，这会影响可伸缩性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-28T00:10:33.793

对于替代方案，您可以阅读文章[在 ASP.NET 应用程序中管理持久用户状态的九个选项](http://msdn.microsoft.com/en-us/magazine/cc300437.aspx)。

在文章中，作者解释了每种方法的优缺点。

从总结：

> ASP.NET 提供了许多不同的方法来在用户请求之间保存数据。您可以使用 Application 对象、cookie、隐藏字段、Session 或 Cache 对象以及许多其他方法。有时很难决定何时使用其中的每一个。本文将介绍上述技术并提供一些关于何时使用它们的指南。尽管这些技术中有许多存在于经典 ASP 中，但随着 .NET Framework 的引入，何时使用它们的最佳实践发生了变化。要在 ASP.NET 中持久化数据，您必须调整您之前了解的有关在 ASP 中处理状态的内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T17:51:58.173

会话数据存储在服务器的 RAM 中，如果您有一个高流量的站点，该站点将很快就满了，而您最不想要的是将数据交换到磁盘。

正如 gaijin42 所说，cookie 或 DB 是另一种选择。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-20T18:10:40.797

由于几个原因，会话作为一种状态存储方法在高流量系统中是粗糙的。

首先，默认的会话存储方法是进程内的，这意味着如果您有一个负载平衡的网络场，您将不断地“丢失”会话信息，因为用户从不同的服务器获取页面。

当应用程序池被回收时，进程内会话服务器也会死掉，这在更高流量的服务器上更常见。

会话数据的可扩展性选项是

1.  使用免费提供的 ASP.NET 会话服务器并将所有应用程序指向它
2.  使用 SQL Server 存储 Session 数据。

由于会话数据的一般性质，对于流量非常大的站点来说，这些都不是一个很好的选择（除非你有无限的钱可以投入到硬件上）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-20T17:59:00.077

对于高流量网站，您可能正在查看 Memcached。它是一种缓存机制，存储在远程计算机的 RAM 中。就在最近，该库制作了一个 win32 端口（以前只有 linux 才有可能）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T17:59:49.200

我不会重复这里已经提到的内容，但另一种选择是使用应用程序哈希。它应该谨慎使用，因为正如 Adam 已经提到的那样，它会消耗您的 Web 服务器上的内存，但它确实提供了一种缓存所有用户共有的东西的好方法。

这使您不必返回数据库来检索很可能已经被其他人要求的信息。

另一个类似于 Application 的替代方案是 Cache，它在发布时间、持续时间等方面具有更大的灵活性。

如果您有兴趣，这里有一些链接： [ASP NET Caching](http://msdn.microsoft.com/en-us/library/ms178597.aspx) [Application State](http://msdn.microsoft.com/en-us/library/bf9xhdz4(vs.71).aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T13:54:29.343

我们将数据库用于任何高流量或将导致大会话状态的情况。相反，我们将指针存储在指向我们数据库记录的真实会话状态中。那么我们唯一的开销是 Web 服务器和数据库服务器之间的带宽，这将比任何给定用户和 Web 服务器之间的带宽小得多。

# java - 集合的延迟初始化

> ID：769341
> 
> 赞同：2
> 
> 时间：2009-04-20T17:44:31.967
> 
> 标签：java, collections

什么是延迟初始化集合的最佳方法，我专门研究 Java。我见过一些人决定在修改方法中这样做（这看起来有点恶心），如下：

```
public void addApple(final Apple apple) {       

    if (this.apples == null) {
        apples = new LinkedList<Apple>();
    }
    this.apples.add(apple);
} 
```

您可以将初始化重构为一个方法并从添加/删除/更新等中调用它......但这似乎有点糟糕。人们还通过以下方式公开集合本身，这往往使情况更加复杂：

```
public Collection<Apple> getApples() {
    return apples;
} 
```

这会破坏封装并导致人们直接访问 Collection。

延迟初始化的目的纯粹是与性能有关。

我很想知道其他人为此提出的方法是什么。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T17:49:43.920

我将惰性实例化放入给定函数的 getter 中。通常我会懒惰地实例化一个列表，以尽可能避免 DB 命中。例子：

```
public final Collection<Apple> getApples() {
    if (apples == null) {
        // findApples would call the DB, or whatever it needs to do
        apples = findApples();
    return apples;
}

public void addApple(final Apple apple) {       
    //we are assured that getApples() won't return 
    //null since it's lazily instantiated in the getter
    getApples().add(apple);
} 
```

这种方法意味着其他函数（例如 removeApples()）也不需要担心实例化。他们也只会调用 getApples()。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T17:54:30.523

为了在多线程环境中安全地延迟初始化成员，您需要一些并发机制来使初始化原子化并且对其他线程可见。*在初始化期间和*每次访问延迟初始化的成员时都会支付此费用。这种持续的费用可能会严重影响性能。分析延迟初始化的效果非常重要。正确的选择会因应用而异。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T17:49:22.707

> 您可以将初始化重构为一个方法并从添加/删除/更新中调用它

这就是我会做的，但我会将方法设为私有/受保护

```
protected Collection<Apple> getApples() {
  if (apples == null) {
    apples = new LinkedList<Apple>();
  }
  return apples;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T17:51:51.810

对于添加案例，我会说在您的构造函数中对其进行初始化，至于在不知情的情况下直接公开集合，您可能会考虑：

```
public Collection<Apple> getApples() {
    return Collections.unmodifiableCollection(apples);
} 
```

防止人们使用 getter 做更多的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T18:20:51.833

第二个选项没问题：

> *初始化为方法并从添加/删除/更新中调用它*

```
 private Collection<Apple> apples;
 ....
 private final Collection<Apple> getApples() { 
     if( apples == null ) {
          apples = new LinkedList<Apple>();
     }
     return apples;
 }

 public final void addApple( Apple a ) { 
      getApples().add( a );
 }
 public final void removeApple( Apple a ) { 
      getApples().remove( a );
 }

 public Iterator<Apple> iterator() { 
     return getApples().iterator;
  } 
```

> *...事实上，人们还通过...公开收藏本身*

没有惰性初始化策略可以阻止这种情况。如果您不想暴露底层集合（这是一个非常好的主意），您必须将其设为私有，将其设为最终集合（如上面的示例中所示）并提供一个迭代器来访问集合的元素，而不是自行传递集合。

我想你已经有了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T17:51:24.790

首先，您必须确定函数调用的开销是否值得。我的猜测是您担心内存占用而不是原始速度。

首先我会添加这个。请注意，它是班级私有的

```
private Collection<Apple> myApples() {
  if (this.apples == null) {
      this.apples = new LinkedList<Apple>();
  }
  return this.apples;
} 
```

现在你的 addApples 看起来像这样。

```
public void addApple(final Apple apple) {       

    myApples.add(apple);
} 
```

以及在您的班级内部使用该集合的任何其他内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T18:02:08.510

我会在设置器中保留延迟初始化。如果支持集合为空，getter 可以简单地返回一个空集合。

```
public Collection<Apple> getApples() {
    return apples==null ? Collections.emptyList() : apples;
} 
```

以这种方式，如果调用 getter 而没有调用 setter，则永远不会实例化支持集合。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T18:06:47.360

把它放在一个同步块中，或者通过其他一些机制（例如 compareAndSet、并发容器等）使其成为线程安全的：

```
if (this.apples == null) {
    apples = new LinkedList<Apple>();
} 
```

因为就目前而言，如果多个线程同时进入该 if 块，您将破坏苹果。

# .net - 重构 LINQ IQueryable 表达式以删除查询的重复部分

> ID：769351
> 
> 赞同：7
> 
> 时间：2009-04-20T17:47:10.837
> 
> 标签：.net, linq, linq-to-sql, iqueryable

我有一些冗余的 linq 查询我想分解出一段代码。这些是 IQueryable 的连接 experssions，重要的是我不会使查询在没有重构的情况下被更早地评估。

这是一个简化的查询：

```
var result = 
from T in db.Transactions
join O in db.Orders on T.OrderID equals O.OrderID
join OD in db.OrderDetails on O.OrderID equals OD.OrderID into OrderDetails
let FirstProductBought = OrderDetails.First().Select(OD => OD.Product.ProductName)
select new
{
  TransactionID = T.TransactionID,
  OrderID = O.OrderID,
  FirstProductBought = FirstProductBought
}; 
```

我要考虑的是“给定订单，购买的第一个产品是什么”的逻辑。我在其他查询中使用相同的逻辑。如何将其分解为共享方法？

通常，对于代码重用和 IQueryables，我能够做的是接受 IQueryable 并生成 IQueryable/IOrderedQueryable 作为输出的代码。使用这些函数，我可以使用可重用代码构建 LINQ 表达式，这些代码仍然推迟查询，直到查询完全构造。在这里，因为我只有一个 int（orderID），所以我不确定如何使它工作。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T04:20:10.893

很抱歉回答我自己的问题，但我找到了一个很好的解决方案。我认为，尽管根据您要执行的操作，有不同的方法可以在不评估 IQueryable 的情况下分解出不同的 LINQ 表达式。所以我希望人们分享替代解决方案。

我的解决方案是为分解出的查询创建一个“视图”。我称它为视图是因为它与 SQL 视图有很多共同点（从 LINQ 客户端的角度来看）。但与 SQL 视图不同的是，它不能被索引或保留列。所以使用这个视图成为一个瓶颈，使用一个实际的 SQL 视图是合适的。

```
static public class MyDataContextExtension
{
    // The view exposes OrderSummary objects
    public class OrderSummary
    {
        public OrderID { get; set; }
        public string FirstProductListed { get; set; }
    }

    static public IQueryable<OrderSummary> OrderySummaryView(this MyDataContext db)
    {
         return (
              from O in db.Orders
              join OD in db.OrderDetails on O.OrderID equals OD.OrderID into OrderDetails
              let AProductBought = OrderDetails.First().Select(OD => OD.Product.ProductName)
              let TotalCost = OrderDetails.Aggregate(0
              select new OrderSummary()
              {
                  OrderID = OD.OrderID,
                  FirstProductListed = AProductBought.FirstOrDefault()
              };
    }
} 
```

有了这个，我可以排除查询的重复部分，将原始查询替换为以下内容：

```
var result = 
from T in db.Transactions
join OS in db.OrderSummaryView() on T.OrderID equals OS.OrderID
select new
{
  TransactionID = T.TransactionID,
  OrderID = T.OrderID,
  FirstProductBought = OS.FirstProductListed
}; 
```

您可以想象添加了其他列...我认为一件很酷的事情是，如果您添加额外的列但不在最终选择中使用它们，LINQ 实际上不会从数据库中查询这些内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-15T08:56:25.873

我们遇到了同样的问题。它不支持开箱即用，它是 LOB 应用程序的主要问题。我最终写了一篇关于 LINQ 表达式重用的代码项目文章，其中包括一个名为 LinqExpressionPrjection 的非常小的实用程序，它可以在投影中重用（包括匿名类型）。

[在这里](http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=4620566)找到文章。

您可以将用于投影重用的程序集作为[nuget 包](http://nuget.org/packages/LinqExpressionProjection)获取，源代码位于[CodePlex](http://linqexprprojection.codeplex.com/)上。

你的帖子已经过去了一段时间。我希望它仍然对你有帮助。如果没有，也许对于其他阅读此主题的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-03T19:17:00.863

分解 linq 表达式的另一个重要方法是传递表达式，例如：

```
X GetSomeX(Expression<Func<Y, X>> map)
{
    return SourceOfYs.Select(map);
} 
```

我通过查看 Barak 的文章获得了这个想法——尽管他在这个主题上做了更多的工作，但我想我在这里再次提到了这篇文章。直接指出似乎是显而易见的第一件事。

# mmap - mmap() 内部结构

> ID：769364
> 
> 赞同：5
> 
> 时间：2009-04-20T17:50:32.873
> 
> 标签：mmap, system-calls

众所周知，mmap() 最重要的特性是文件映射在许多进程之间共享。但众所周知，每个进程都有自己的地址空间。

问题是内存映射文件（更具体地说，它的数据）真正保存在哪里，以及进程如何访问该内存？我的意思不是 *(pa+i) 和其他高级别的东西，而是指流程的内部。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T18:00:32.570

这发生在操作系统的虚拟内存管理层。当您对文件进行内存映射时，内存管理器基本上将该文件视为进程的交换空间。当您访问虚拟内存地址空间中的页面时，内存映射器必须解释它们并将它们映射到物理内存。当你越过页面边界时，这可能会导致页面错误，此时操作系统必须将一块磁盘空间映射到一块物理内存并解析内存映射。使用 mmap，它只是从您的文件而不是它自己的交换空间中执行此操作。

如果您想详细了解这是如何发生的，您必须告诉我们您使用的是*哪个*操作系统，因为实现细节会有所不同。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T18:03:43.200

这是非常依赖于实现的，但以下是一种可能的实现：

当文件是第一个内存映射时，数据一开始并没有存储在任何地方，它仍然在磁盘上。虚拟内存管理器 (VMM) 为文件的进程分配一系列虚拟内存地址，但这些地址不会立即添加到页表中。

当程序第一次尝试读取或写入其中一个地址时，会发生[页面错误](http://en.wikipedia.org/wiki/Page_fault)。操作系统捕获页面错误，确定该地址对应于内存映射文件，并将适当的磁盘扇区读入内部内核缓冲区。然后，它将内核缓冲区映射到进程的地址空间，并重新启动导致页面错误的用户指令。如果错误指令是读取，我们现在都完成了。如果是写入，则将数据写入内存，并将页面标记为脏页。对同一页内的数据的后续读取或写入不需要从磁盘读取/写入/从磁盘读取/写入，因为数据在内存中。

当文件被刷新或关闭时，任何被标记为脏的页面都会被写回磁盘。

使用内存映射文件对于以非常随意的方式读取或写入磁盘扇区的程序是有利的。您只读取实际使用的磁盘扇区，而不是读取整个文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T18:02:37.900

内核具有表示内存块的内部缓冲区。任何给定的进程都在其自己的地址空间中分配了一个内存映射，该地址空间引用该缓冲区。许多进程可能有自己的映射，但它们最终都解析为同一个块（通过内核缓冲区）。

这是一个足够简单的概念，但在进程写入时可能会有点棘手。为了在只读情况下保持简单，通常有一个仅在需要时使用的写时复制功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T18:01:26.593

我不太确定你在问什么，但是 mmap() 预留了一块虚拟内存来保存给定数量的数据（通常。它有时可以是文件支持的）。

进程是操作系统实体，它通过操作系统禁止的方法获得对内存映射区域的访问权限：调用 mmap()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-27T12:09:42.797

任何数据都将存储在某种形式的内存或其他形式中，在 HDD 中的某些情况下，在嵌入式系统中可能是一些闪存甚至 RAM（initramfs），除非最后一个，内存中的数据经常缓存在 RAM 中， RAM 在逻辑上被划分为页面，内核维护一个唯一标识页面的描述符列表。

因此，充其量访问数据将是访问物理页面。进程到达那里自己的进程地址空间，该地址空间由许多 vm_are_struct 组成，这些 vm_are_struct 标识地址空间中的映射部分。在对 mmap 的调用中，可能会创建新的 vm_area_struct，或者如果地址相邻，则可能与现有的 vm_area_struct 合并。

一个新的虚拟地址被返回给对 mmap 的调用。还创建了新的页表，其中包括将新创建的虚拟地址映射到真实数据所在的物理地址。映射可以在文件上完成，也可以像 malloc 一样匿名。进程地址空间结构mm_struct使用pgd_t（Page global directory）的指针到达物理页并访问数据。

# nunit - 如果测试抛出异常，您如何知道 NUnit TearDown 以及该异常是什么？

> ID：769366
> 
> 赞同：0
> 
> 时间：2009-04-20T17:50:44.107
> 
> 标签：nunit

> **可能重复：**
> [在 NUnit 测试期间的拆卸事件中，我如何才能获得应用于刚刚测试的方法的属性？](https://stackoverflow.com/questions/762278/in-the-teardown-event-during-an-nunit-test-how-can-i-get-to-the-attribute-applie)

我有一堆 NUnit 测试，它们都继承自一个实现 NUnit Teardown 函数的类。

[TearDown] 公共无效 TeardownTest() { }

每当其中一个测试产生异常时，它就会直接跳转到 TearDown 函数。我怎么知道生成的异常是什么导致它进入该异常？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T17:53:37.250

这已经在[这里](https://stackoverflow.com/questions/762278/in-the-teardown-event-during-an-nunit-test-how-can-i-get-to-the-attribute-applied)讨论过了。

# search - Lucene号码提取

> ID：769367
> 
> 赞同：2
> 
> 时间：2009-04-20T17:51:08.020
> 
> 标签：search, lucene, numbers, extract

我有这个数字提取问题。我想获得所有没有特定数字的匹配，例如：125501874、125001873 每个在位置 2 处为 55 的数字都不被考虑。

第一个数字范围是 0 到 9，第二个数字范围是 1-9，所以实际范围是 [01-99]（我们不能将 00 作为前两个数字）

使用 Lucene，我想添加 NOT 字段：[01-99]55*

但这似乎不起作用。有没有一种简单的方法可以找到 ??55* 并在 Search("NOT field:[01-99]55*") 中忽略它？

谢谢Lucene大师

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T18:01:18.497

如果创建一个只有第三个和第四个数字的“仅索引”字段，Lucene 可以非常有效地做到这一点。完整的值可以在原始字段中“存储”（或者如果其他查询使用整数，则存储和索引）。

* * *

*更新：*后续评论问：“[有] 一种方法可以仅在第二个数字上创建临时索引吗？”

使用[`ParallelReader`](http://lucene.apache.org/java/2_3_2/api/org/apache/lucene/index/ParallelReader.html)“垂直分区”索引的字段。一个分区可以保存当前索引及其字段，而另一个分区是带有新字段的临时索引，可能存储在`RAMDirectory`.

假设数字“存储”在原始索引中，遍历原始索引中的每个文档，检索存储的字段，解析出关键数字，并`Document`使用新字段将 a 添加到临时索引中。正如`ParallelReader`文档所述，两个索引中的文档编号必须匹配。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T13:30:10.630

谢谢埃里克森，您的解决方案可能是最好的，如果我可以使用临时索引，请使用 ParallelReader，因为我们缓存了搜索查询，我们稍后会需要它们。

但就像你之前说的，最好从相关数字的索引开始。

我有另一个解决方案。

```
NOT field:0?55*
NOT field:1?55*
...
NOT field:9?55* 
```

它对于我正在做的搜索来说足够有效，它绕过了第一个字符通配符的限制。如果他们有更多的数字要检查，或者他们离开始的地方更远，我不会使用它。现在我正在测试一百万行，它对我们的需求非常有效。

# java - Java：为什么不收集垃圾？

> ID：769368
> 
> 赞同：29
> 
> 时间：2009-04-20T17:51:08.147
> 
> 标签：java, garbage-collection

关于 GCing 理论的快速问题。我有以下方法。它运行并退出该方法。为什么GC运行后，计时器仍然存在并保持“滴答”？在此方法存在之后，我不相信仍然有对 timer 或 timertask 的引用，所以我希望计时器被 GCed 并导致异常。请帮助我理解这个概念。

谢谢，jbu

```
private void startTimer()
    {
        Timer timer= new Timer();
        TimerTask timerTask= new TimerTask()
        {

            @Override
            public void run()
            {
                System.out.println("TICK");
            }
        };

        timer.scheduleAtFixedRate(timerTask,
                0,
                500);
    } 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-20T17:56:11.270

[Timer](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Timer.html)对象实际上调度要在后台线程中执行的任务，以便后台线程维护对 Timer（和 TimerTask）的引用，从而防止两者都被垃圾收集。

这是来自文档的适当引用：

> 在对 Timer 对象的最后一个实时引用消失并且所有未完成的任务都已完成执行后，计时器的任务执行线程优雅地终止（并成为垃圾回收的对象）。但是，这可能需要任意长的时间才能发生。默认情况下，任务执行线程不作为守护线程运行，因此它能够防止应用程序终止。如果调用者想要快速终止定时器的任务执行线程，调用者应该调用定时器的取消方法。

所以“所有未完成的任务都执行完毕”的条件不满足，线程永远不会终止，所以 Timer/TimerTask 永远不会被 GC'd。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-20T17:57:07.147

因为 Timer 有一个[继续运行的后台线程](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Timer.html)：

> 对应于每个 Timer 对象的是单个后台线程，用于按顺序执行所有计时器的任务。定时器任务应该很快完成。如果一个定时器任务花费了过多的时间来完成，它就会“占用”定时器的任务执行线程。反过来，这可以延迟后续任务的执行，这些任务可能会在（如果）有问题的任务最终完成时“聚集”并快速连续执行。

由于它是一个后台线程，它会一直持续到 JVM 退出或停止。

更新：关于这一点的更多信息。“后台线程”与守护线程相同——命名方式与 BSD 守护进程类似。如果您在[Thread](http://java.sun.com/j2se/1.3/docs/api/java/lang/Thread.html#setDaemon(boolean))上看到 javadocs ，您会发现：

> 将此线程标记为守护线程或用户线程。当唯一运行的线程都是守护线程时，Java 虚拟机退出。

当您的 main 终止时，所有用户线程都会停止，只留下守护线程。JVM 然后关闭。一段美好的时光——如果短暂的话——`Thread.currentThread().setDaemon(true);`从 main 调用。

更新：确认。我*几乎*是对的。您必须在构建时使计时器成为守护进程。（这改变了，还是我只是脑衰竭？）

无论如何，这是示例代码：

```
import java.util.*;

class Chatter extends TimerTask {
    public void run(){
        System.err.println("Timer run.");
    }
}

public class TryThread {
    public static void main(String[] argv){
        // If argument is true, only runs a few times.
        Timer t = new Timer(false);
        t.schedule(new Chatter(), 1L, 1L);
        return ;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T17:56:20.863

计时器没有被垃圾收集，因为它仍在运行——其他一些对象（例如线程调度程序）仍然有对​​它的引用，这可能是在`scheduleAtFixedRate()`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T17:55:19.430

你怎么知道GC跑了？一般来说，垃圾收集不是确定性的事情，它绝对不是由方法范围触发的。它不像 C++，你离开函数的作用域并触发析构函数。如果 GC 喜欢它，它会收集内存。

# asp.net - ASP.Net 中特定页面的自定义错误处理

> ID：769372
> 
> 赞同：5
> 
> 时间：2009-04-20T17:52:01.590
> 
> 标签：asp.net, error-handling, web-config

在我运行的站点上，我映射了 404 和 500 错误，以重定向到最终用户的自定义错误页面；在我的 web.config 中使用以下代码：

```
 ...
 ...

 <system.web>
  <customErrors defaultRedirect="/404/default.aspx" mode="RemoteOnly">

     <error statusCode="404" redirect="/404/default.aspx" />

  </customErrors>

  ...
  ... 
```

但是，我有一个不想重定向的特定页面；一个健康检查页面，以确保网站 100% 可运行。我尝试使用 web.config 中的以下代码设置特定于位置的自定义错误处理程序：

```
 ...
 ...

   </system.web>
  <location path="health.aspx">
    <system.web>
      <customErrors defaultRedirect="" mode="RemoteOnly"></customErrors>
    </system.web>
  </location>
 ...
 ... 
```

但是，它似乎不起作用。当我将 health.aspx 重命名为 badhealth.aspx 之类的其他名称，然后发出请求时，我希望通过“黄屏死机”页面收到一般的 404 错误。同样，通过故意更改代码以引发错误，我应该通过 YSOD 页面得到 500 错误。在这两种情况下，我最终都会被重定向到我们的自定义 404 页面，然后得到一个 YSOD。想法？

非常感谢任何帮助。

谢谢大家 - 弗兰克

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T18:51:57.843

没关系，我们解决了这个问题。似乎当您有一个特定于位置的 customError 指令时；如果您将 defaultRedirect 保留为“”，它将默认为站点范围的 defaultRedirect URL。

解决方案只是关闭此特定路径的 CustomError 处理，如下所示：

```
<system.web>
    <customErrors defaultRedirect="/404/default.aspx" mode="RemoteOnly">
        <error statusCode="404" redirect="/404/default.aspx" />
    </customErrors>
</system.web>
<location path="health.aspx">
    <system.web>
        <customErrors mode="Off"/>
    </system.web>
</location> 
```

无论如何，谢谢，何塞。

# c# - 使用 Linq 将 DataTable 分解为固定大小的块的干净方法是什么？

> ID：769373
> 
> 赞同：9
> 
> 时间：2009-04-20T17:52:01.700
> 
> 标签：c#, linq, c#-3.0, ienumerable

**更新：**这是一个[类似的问题](https://stackoverflow.com/questions/419019/split-list-into-sublists-with-linq)

* * *

假设我有一个里面`DataTable`有几千个`DataRows`。

我想将表分解成小行进行处理。

我认为 C#3 改进的数据处理能力可能会有所帮助。

这是我到目前为止的骨架：

```
DataTable Table = GetTonsOfData();

// Chunks should be any IEnumerable<Chunk> type
var Chunks = ChunkifyTableIntoSmallerChunksSomehow; // ** help here! **

foreach(var Chunk in Chunks)
{
   // Chunk should be any IEnumerable<DataRow> type
   ProcessChunk(Chunk);
} 
```

关于应该替换什么的任何建议`ChunkifyTableIntoSmallerChunksSomehow`？

我真的很感兴趣有人会如何通过访问 C#3 工具来做到这一点。如果试图应用这些工具是不合适的，请解释！

* * *

更新 3（修改了分块，因为我真的想要表，而不是 ienumerables；使用扩展方法——感谢 Jacob）：

最终实现：

处理分块的扩展方法：

```
public static class HarenExtensions
{
    public static IEnumerable<DataTable> Chunkify(this DataTable table, int chunkSize)
    {
        for (int i = 0; i < table.Rows.Count; i += chunkSize)
        {
            DataTable Chunk = table.Clone();

            foreach (DataRow Row in table.Select().Skip(i).Take(chunkSize))
            {
                Chunk.ImportRow(Row);
            }

            yield return Chunk;
        }
    }
} 
```

该扩展方法的示例使用者，带有来自临时测试的示例输出：

```
class Program
{
    static void Main(string[] args)
    {
        DataTable Table = GetTonsOfData();

        foreach (DataTable Chunk in Table.Chunkify(100))
        {
            Console.WriteLine("{0} - {1}", Chunk.Rows[0][0], Chunk.Rows[Chunk.Rows.Count - 1][0]);
        }

        Console.ReadLine();
    }

    static DataTable GetTonsOfData()
    {
        DataTable Table = new DataTable();
        Table.Columns.Add(new DataColumn());

        for (int i = 0; i < 1000; i++)
        {
            DataRow Row = Table.NewRow();
            Row[0] = i;

            Table.Rows.Add(Row);
        }

        return Table;
    }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T18:41:57.930

这是非常可读的，并且只遍历序列一次，也许可以为您节省重复冗余`Skip()`/`Take()`调用的相当糟糕的性能特征：

```
public IEnumerable<IEnumerable<DataRow>> Chunkify(DataTable table, int size)
{
    List<DataRow> chunk = new List<DataRow>(size);

    foreach (var row in table.Rows)
    {
        chunk.Add(row);
        if (chunk.Count == size)
        {
            yield return chunk;
            chunk = new List<DataRow>(size);
        }
    }

    if(chunk.Any()) yield return chunk;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T18:12:36.113

这似乎是 Linq 的 Skip 和 Take 方法的理想用例，具体取决于您希望通过分块实现的目标。这是完全未经测试的，从未在 IDE 代码中输入过，但您的方法可能看起来像这样。

```
private List<List<DataRow>> ChunkifyTable(DataTable table, int chunkSize)
{
    List<List<DataRow>> chunks = new List<List<DataRow>>();
    for (int i = 0; i < table.Rows.Count / chunkSize; i++)
    {
        chunks.Add(table.Rows.Skip(i * chunkSize).Take(chunkSize).ToList());
    }

    return chunks;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-26T17:31:05.683

这是一种可能有效的方法：

```
public static class Extensions
{
    public static IEnumerable<IEnumerable<T>> InPages<T>(this IEnumerable<T> enumOfT, int pageSize)
    {
        if (null == enumOfT) throw new ArgumentNullException("enumOfT");
        if (pageSize < 1) throw new ArgumentOutOfRangeException("pageSize");
        var enumerator = enumOfT.GetEnumerator();
        while (enumerator.MoveNext())
        {
            yield return InPagesInternal(enumerator, pageSize);
        }
    }
    private static IEnumerable<T> InPagesInternal<T>(IEnumerator<T> enumeratorOfT, int pageSize)
    {
        var count = 0;
        while (true)
        {
            yield return enumeratorOfT.Current;
            if (++count >= pageSize) yield break;
            if (false == enumeratorOfT.MoveNext()) yield break;
        }
    }
    public static string Join<T>(this IEnumerable<T> enumOfT, object separator)
    {
        var sb = new StringBuilder();
        if (enumOfT.Any())
        {
            sb.Append(enumOfT.First());
            foreach (var item in enumOfT.Skip(1))
            {
                sb.Append(separator).Append(item);
            }
        }
        return sb.ToString();
    }
}
[TestFixture]
public class Tests
{
    [Test]
    public void Test()
    {
        // Arrange
        var ints = new[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
        var expected = new[]
        {
            new[] { 1, 2, 3 },
            new[] { 4, 5, 6 },
            new[] { 7, 8, 9 },
            new[] { 10      },
        };

        // Act
        var pages = ints.InPages(3);

        // Assert
        var expectedString = (from x in expected select x.Join(",")).Join(" ; ");
        var pagesString = (from x in pages select x.Join(",")).Join(" ; ");

        Console.WriteLine("Expected : " + expectedString);
        Console.WriteLine("Pages    : " + pagesString);

        Assert.That(pagesString, Is.EqualTo(expectedString));
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-28T23:40:35.940

雅各布写道

> 这似乎是 Linq 的 Skip 和 Take 方法的理想用例，具体取决于您希望通过分块实现的目标。这是完全未经测试的，从未在 IDE 代码中输入过，但您的方法可能看起来像这样。

```
private List<List<DataRow>> ChunkifyTable(DataTable table, int chunkSize)
{
    List<List<DataRow>> chunks = new List<List<DaraRow>>();
    for (int i = 0; i < table.Rows.Count / chunkSize; i++)
    {
        chunks.Add(table.Rows.Skip(i * chunkSize).Take(chunkSize).ToList());
    }

    return chunks;
} 
```

感谢这个 Jacob - 对我有用，但我认为您示例中的测试应该是 <= 而不是 <。如果您使用 < 并且行数小于*chunkSize*则永远不会进入循环。类似地，最后的部分块没有被捕获，只有完整的块。正如你所说，这个例子是未经测试的，等等，所以这只是一个仅供参考，以防其他人逐字使用你的代码;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-07-25T22:30:54.847

这是一种完全不同的方法。没有为块分配内存。

```
public static IEnumerable<IEnumerable<DataRow>> Chunkify(
    this DataTable dataTable, int chunkSize)
{
    for (int i = 0; i < dataTable.Rows.Count; i += chunkSize)
    {
        yield return GetChunk(i, Math.Min(i + chunkSize, dataTable.Rows.Count));
    }
    IEnumerable<DataRow> GetChunk(int from, int toExclusive)
    {
        for (int j = from; j < toExclusive; j++)
        {
            yield return dataTable.Rows[j];
        }
    }
} 
```

使用示例：

```
var dataTable = GetTonsOfData();
foreach (var chunk in dataTable.Chunkify(1000))
{
    Console.WriteLine($"Processing chunk of {chunk.Count()} rows");
    foreach (var dataRow in chunk)
    {
        Console.WriteLine(dataRow[0]);
    }
} 
```

# sql-server - 如何使用 VB 在 live word 文档中多次插入 SQL Server 结果

> ID：769376
> 
> 赞同：0
> 
> 时间：2009-04-20T17:53:13.350
> 
> 标签：sql-server, vba, ms-office, ms-word

好的，我一直在试图弄清楚如何进行邮件合并，使用该信息进行 MS SQL 调用并在 Word 文档中获取字符串。我猜是VB，但我没有VB经验。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T15:39:24.053

如果您想使用 SQL Server 中的数据进行邮件合并（无论如何在 Word 2003 中），邮件合并向导的第 3 步有一个选项：

使用现有列表 > 浏览 > 新建 SQL Server 连接

如果您想从其他数据源获取邮件合并的结果，然后使用这些结果查询 SQL Server，那么您将需要 VBA。除了研究如何在 Word 对象模型中操作数据之外，您还需要一些类似[ActiveX 数据对象](http://msdn.microsoft.com/en-us/library/ms681025(VS.85).aspx)(ADO) 的东西来进行数据库查询

# c# - 表示星期几的 DateTime 对象

> ID：769378
> 
> 赞同：2
> 
> 时间：2009-04-20T17:53:32.600
> 
> 标签：c#, datetime, dayofweek

如何将 1 到 7 之间的数字转换为 C# 中代表星期几的 DateTime 对象？这些数字来自我正在解析的 XML 文件。我正在检索包含 1 到 7 之间数字的字段的每个实例，该数字代表星期天和星期六之间的一周中的一天。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T18:02:21.630

我会假设投射到 DayOfWeek 对象会给你一周中的一天

```
DayOfWeek day = (DayOfWeek)myInt; 
```

就 DateTime 对象而言，该对象表示特定的一天，不一定是一周中的随机一天。如果这是您想要实现的目标，您可以尝试将 # 天添加到特定日期。

[http://msdn.microsoft.com/en-us/library/system.dayofweek.aspx](http://msdn.microsoft.com/en-us/library/system.dayofweek.aspx "DayOfWeek MSDN")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:57:59.440

为了获得 a `DateTime`，您需要一个特定的日期范围，您希望工作日属于该日期范围（因为 a`DateTime`是特定的日期和时间，而工作日不是）。

有一个`DayOfWeek`枚举（其值实际上在 0-6 之间）。如果您只需要一些东西来代表一周中的哪一天，那么您应该能够将您的 int 转换为`DayOfWeek`like..

```
DayOfWeek myDay = (DayOfWeek)yourInt; 
```

如果你需要一个实际的`DateTime`，你需要一个开始日期。那你可以做...

```
DateTime myDate = startDate.AddDays(
    (int)startDate.DayOfWeek >= yourInt ? 
        (int)startDate.DayOfWeek - yourInt : 
        (int)startDate.DayOfWeek - yourInt + 7); 
```

这将为您提供您所描述的星期几的下一个发生实例的 DateTime。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T17:58:57.470

一个`DateTime`实例总是代表一个完整的日期，而不能只代表一周中的一天。如果实际日期无关紧要，则取任意一个星期一（假设 0 代表星期一），然后加上当天的数字。

```
Int32 dayOfWeek = 3;

// date represents a thursday since 2009/04/20 is a monday
DateTime date = new DateTime(2009, 04, 20).AddDays(dayOfWeek); 
```

否则，我同意 Adam Robinson 的回答 - 如果您只想保留一周中的某一天，请坚持使用[DayOfWeek 枚举](http://msdn.microsoft.com/en-us/library/system.dayofweek.aspx)（零是星期日）而不是使用整数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T18:00:06.627

DayOfWeek.Sunday 为零，因此您可以从已知为星期日的任意固定日期开始，并添加一个介于 0 和 6 之间的值：

```
public DateTime GetDayOfWeek(int dayOfWeek)
{
    if (dayOfWeek < 0 || dayOfWeek > 6) throw new ArgumentOutOfRangeException(...);

    // 4 January 2009 was a Sunday
    return new DateTime(2009,1,4).AddDays(dayOfWeek);
} 
```

我不确定你为什么想要这个。

如果您只希望它获得星期几的本地化版本，如下所示：

```
GetDayOfWeek(3).ToString("dddd"); // Gets name of day of week for current culture 
```

另一种方法是使用 DateTimeFormatInfo.DayNames 或 DateTimeFormatInfo.AbbreviatedDayNames 作为您想要的文化。

# sql - Postgres XML 数据类型

> ID：769380
> 
> 赞同：15
> 
> 时间：2009-04-20T17:53:45.363
> 
> 标签：sql, xml, postgresql

使用“xml”数据类型与将 xml 内容存储在“文本”数据类型中有什么好处？

我可以通过某些特定的 xml 属性或元素进行查询吗？

索引和查询性能如何？

除了 postgresql 手册，你还能指点我哪些其他在线资源？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-20T18:13:37.140

现在，您从原始文本的 XML 字段中获得的最大好处是 XPath。所以如果你有类似的东西

```
CREATE TABLE pages (id int, html xml); 
```

您可以通过以下方式获得第 4 页的标题

```
SELECT xpath('/html/head/title/text()', html) FROM pages WHERE id = 4; 
```

目前 XML 支持相当有限，但在 8.3 中变得更好，当前文档位于[链接文本中](http://www.postgresql.org/docs/current/static/functions-xml.html)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-30T13:15:41.283

一般来说，好处与任何其他数据类型的好处是相同的，以及为什么你有文本以外的数据类型：

*   **数据完整性**
    您只能在 xml 类型的列中存储有效的（格式良好的）XML 值。
*   **类型安全**
    您只能对对 XML 有意义的 XML 值执行操作。

一个例子是[`xpath()`](http://www.postgresql.org/docs/current/static/functions-xml.html#FUNCTIONS-XML-PROCESSING)函数（[XML 路径语言](https://en.wikipedia.org/wiki/XPath)），它只对 xml 类型的值进行操作，而不是文本。

目前，索引和查询性能特征并不比文本类型好或差。

# svn - 如何告诉 SVN 忽略所有团队成员的文件

> ID：769383
> 
> 赞同：17
> 
> 时间：2009-04-20T17:54:44.360
> 
> 标签：svn, tortoisesvn

我有各种文件在提交时希望被 SVN 忽略。我知道我可以进入 TortoiseSVN 并以各种方式忽略它们。我知道我可以从命令行运行 svn propedit svn:ignore 来做同样的事情。

问题是我必须让团队中的每个人都这样做，这很痛苦。有没有办法可以将一些文件放在文件夹中或在我的 SVN 存储库中设置一些东西，告诉它永远不要签入某个文件？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-20T17:58:02.233

一旦你设置了你的 svn:ignore 属性（使用 TortoiseSVN 或命令行），你应该提交这些更改。

一旦您的团队成员更新他们的工作副本，他们还将设置 svn:ignore 属性，并且属性中列出的文件/文件夹将被排除在提交之外。

有关详细信息，请参阅此页面：[TortoiseSVN - 忽略文件和目录](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-ignore.html)

笔记：

如果您已经提交了一些应该被忽略的文件，那么您首先必须[从存储库中删除它们，](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-howto-unversion.html)然后才能忽略它们（参见 rmeador 的评论）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T19:21:16.713

我使用的另一种方法是，因为我不想在我的存储库中乱扔*一些*文件（如 IDE 文件、操作系统文件、要在多个项目中忽略的文件等）的 svn:ignore 属性，所以将配置文件保存在不同的存储库。在该文件中，我在 global-ignores 列表中设置了某些模式。然后，我将该配置文件检出到 ~/.subversion，并让我的团队成员也这样做。

通过这样做，我们都拥有相同的全局配置文件，并且可以根据`svn update`需要进行配置。当我有多个项目（几乎总是如此）并且它们共享许多相同的策略时，我发现这种方式很有用。

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-04-20T17:57:16.960

在 SVN 中准备一个适当的干净结构，然后要求所有用户重新结帐。

# nhibernate - 如果我得到一本关于 Hibernate 的书，这对 nHIbernate 有用吗？

> ID：769384
> 
> 赞同：1
> 
> 时间：2009-04-20T17:55:12.630
> 
> 标签：nhibernate, hibernate

除了使用的语言（Java、C# 等）之外，Hibernate 的文章和书籍是否同样适用于 nHibernate？现在我正在学习，我想研究，但我不想在错误的信息上浪费时间。

谢谢你。

我有一个非常基本的 CRUD 数据库项目，用于学习是否有人在一篇文章中拥有所有内容。

编辑：我买了 nHibernate in Action 这本书，但我也发现这个网站上有有用的 nHibernate 视频： [http ://www.summerofnhibernate.com/](http://www.summerofnhibernate.com/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T18:02:50.067

确实，我的一个朋友刚刚写完[NHibernate in Action](http://www.manning.com/kuate/)，我强烈推荐它。至于网络参考，我推荐[Billy MCatherty 的最佳实践文章](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)，当然还有 NHibernate 文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T17:58:09.283

绝对地。我会向您推荐[Hibernate in Action](http://www.manning.com/bauer/)。

# c# - FindControl 不适用于绑定服务器标签，为什么？

> ID：769396
> 
> 赞同：3
> 
> 时间：2009-04-20T17:57:59.503
> 
> 标签：c#, asp.net

我在 OnLoad 事件中有一个 FindControl 来在页面上找到我的按钮，即：

```
protected override void OnLoad(EventArgs e)
{
    DataBind();
    control button = Page.FindControl("myButton");
} 
```

在我的 aspx 页面上，我有

```
<asp:Button runat="server" ID="myButton" /> 
```

如果我只有这个，一切正常，当我传入 OnLoad 时，按钮不为空，我可以执行我想要的。问题是当我在我的 aspx 中添加动态文本时：

```
<asp:Button runat="server" ID="myButton" Text='<%# "Here is my dynamic text pulled from a XML" %>' /> 
```

然后 FindControl 什么也没找到，并且按钮为空。

在 aspx 上添加绑定服务器标签不会延迟任何事情吗？当我检查 Page 对象时，我在 Controls 集合中有一些控件，但我找不到 myButton。

知道我做错了什么吗？

**编辑**

人们似乎认为我的代码示例是我的真实代码，但事实**并非**如此，所以我使用 FindControl 是因为我需要这样做，因为我有嵌套控件并且我无法直接访问它并且我使用绑定，因为我放置的动态文本是在 ContentTemplate 中，我可以在其他页面 aspx 中覆盖它。

我问的问题更具体地是因为我已经跟踪了我的 FindControl 返回 null 的问题，因为新实现的行为是绑定。

改进代码示例不是解决方案，也不是解释如果我在我的 aspx 页面中放置 <%# %> 标记，则 OnLoad 事件中的 FindControl 将返回 null。

**编辑 2**

单独的绑定标签似乎不是罪魁祸首，而是填充它们的 DataBind() 。无论我是否有绑定标签，将 DataBind() 放在 FindControl 之前都会使 myButton 为空。在代码示例中进行了更正。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T20:06:19.130

Page.FindControl() 方法将仅搜索与 Page 关联的控件的即时集合。它不会递归整个控件树，因此如果您的按钮包含在另一个控件中，它将不会被找到。您需要在包含控件上调用 FindControl 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T20:20:56.163

[在这里](http://msdn.microsoft.com/en-us/library/ms178472.aspx#databindingevents)MSDN 说：

> **PreRender ：**每个设置了 DataSourceID 属性的数据绑定控件调用其 DataBind 方法。

看起来您没有使用数据绑定控件的 DataSourceID，但将 FindControl 代码移动到 PreRender 事件可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T18:05:24.600

如果要访问页面上的按钮，可以直接将按钮称为 -

```
this.myButton 
```

就分配值而言，您可以在服务器代码中这样做 -

```
this.myButton.Text = "Dynamic Text"; 
```

<%# xyz %> 仅在您对控件进行数据绑定时使用，例如在 DataGrid、GridView 等中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T18:14:01.273

在您的覆盖中，您不想先在您的方法中调用 base.OnLoad(e) 吗？

# testing - 点击几个链接部分动态生成

> ID：769400
> 
> 赞同：0
> 
> 时间：2009-04-20T17:58:35.100
> 
> 标签：testing, selenium, dynamic

我是 Selenium 的新手，测试很重要。我正在尝试捕获部分动态生成的超链接元素的 id。当我在 selenium 中单击时，单击动作记录如下，粗体部分是动态生成的，我的页面上有很多，并且可能因站点而异（我正在测试 cms）。我想捕获并单击任何一个。这就是我从那时起尝试做的事情：

商店属性 | //button@class onclick="setLocation(javascript{baseUrlSelection()}['/checkout/cart/add/uenc/(a-zA-Z0-9) */product/(0-9)* ]'')" | 我的身份

回声 | ${myid} |

点击并等待 | ${myid[0]}

它不起作用当点击动作记录在 selenium 中时，我的链接看起来像这样：buton[@onclick="setLocation(' **http** [://localhost/mydomaine/index.php/checkout/cart/add/uenc/aHR0cDovL2xvY2FsaG9zdC9NYWdlbnRvSGls](http://localhost/mydomaine/index.php/checkout/cart/add/uenc/)

 ****YWlyZURlbW9WMi9tYWdlbnRvZGVtb0hpbGFpcmVWMi9pbmRleC5waHAvY2F0ZWdvcmllMS5odG1sP19fX1NJRD1V** /product/ **1** /')">请帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T21:35:21.103

你在使用 Selenium IDE 吗？使用其他开发环境做一些事情可能会容易得多，但是如果你真的想做循环： [从这个页面获取循环用户扩展](http://51elliot.blogspot.com/2008/02/selenium-ide-goto.html) 并运行这样的脚本。

```
store | 0 | myCurrent
storeEval | var pattern=new RegExp("\\w*http://localhost/mydomaine/index.php/checkout/cart/add\\w*");var i=0;var total=0;while(i<window.document.getElementsByTagName('input').length){if (window.document.getElementsByTagName('input')[i].id.match(pattern)){window.document.getElementsByTagName('input')[i].id = 'testID_' + total;total=total+1;}i=i+1;}total; | myTotal
while | storedVars.myCurrent < storedVars.myTotal
storeAttribute | //input[contains(@id,'testID_${myCurrent}')]@class | myid
echo | ${myid}
clickAndWait | //input[contains(@id,'testID_${myCurrent}')]
store | javascript{storedVars.myCurrent++}
endWhile 
```

点击这些按钮有什么作用？它是否回发页面或类似的东西？如果是这样，您需要移动 storeEval | var 模式.... 在 while 循环中。javascript 所做的是将页面上与 RegEx 模式（您可能需要更改以匹配您的按钮 ID）匹配的所有输入重命名为顺序 ID，以便您可以轻松地遍历它们。如果您可以利用不同的模式，请随意这样做。

[Javascript 从这里](http://devio.wordpress.com/2008/10/24/crawling-all-links-with-selenium-and-nunit/)改编

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:00:08.197

您可以使用 xpath contains() 函数来定位项目：

```
storeAttribute | //input[contains(@onclick,"setLocation('http://localhost/mydomaine/index.php/checkout/cart/add/uenc/")]@class | myid
echo | ${myid}
clickAndWait | //input[contains(@onclick,"setLocation('http://localhost/mydomaine/index.php/checkout/cart/add/uenc/")]@class 
```

通过 onclick 属性以外的其他方式引用元素也是一个好主意。Id 或 name 将是不错的选择。

# database-design - 在数据库中，键和索引之间有什么区别？

> ID：769407
> 
> 赞同：13
> 
> 时间：2009-04-20T17:59:35.100
> 
> 标签：database-design

例如，在 SQLServer 中，如果我有一个设置了“唯一”的索引，那么它与键有什么不同？

我如何知道何时要使用 Key 与 Indexed 字段？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-20T18:02:36.090

具有唯一值的字段本质上是一个键。但是，键用于唯一标识表中的行，而索引用于对表中的行进行排序或分组。最初设置的密钥不应更改，因为它可能会在数据库的其他地方被引用。但是，索引字段可以自由更改。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-20T18:06:27.237

键标识存储在数据库中的行。索引是一种类似于书末的结构。在书的末尾，您会看到几页带有单词的页面以及在哪里可以找到这些单词。这些页面是索引，数据库也是如此。索引包含键及其位置。它可以帮助您找到行的位置。如果是一本书，索引会告诉您在哪个页面上可以找到该单词。数据库索引具有相同的功能。

正如许多人提到的那样，索引是用 b-trees 实现的。然而，这只是一个实现细节。实现索引的方法有很多。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T19:58:53.767

键（声明）是一个约束。如果缺少任何关键数据，或者如果关键数据与表中已有的行重复，它会阻止将行输入到表中。

索引是一种数据结构，允许在给定索引中使用的列（字段）的值的情况下快速查找一行或多行。索引也可用于加速某些其他类型的查询。例如，合并连接使用构成连接条件的两列上的索引，如果这些索引都存在的话。您的 DBMS 是否会执行合并连接取决于查询优化器、表的大小以及所需索引的存在。

为了稍微混淆这个问题，一些文献将索引用作“索引键”的列。同一文献通常将主键和外键称为“逻辑键”。相同的文献通常将键称为表的逻辑特征，而索引称为表的物理特征。

当您声明主键时，大多数 DBMS 都会为您创建索引。这种行为有两个原因。首先是在大表上检测没有索引的重复项需要很长时间。第二个是您可能会根据主键进行大量查找，并且这些查找使用索引运行得更快。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-20T18:02:58.507

键用于维护数据完整性，索引用于维护数据库性能。想想你试图解决的任何问题，这将引导你朝着正确的方向前进。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-20T18:00:49.463

键唯一地标识表中的一行。索引是基于表中字段的行顺序。一个表可以有多个索引，因为索引可以只是系统用来搜索然后查找实际行的一组字段的特定顺序。从技术上讲，系统只能使用一个键来识别一行。大多数时候，这也是主索引，但并非必须如此。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-20T18:01:54.203

唯一性是对数据施加的约束，而索引将有助于在数据库中对行进行物理（聚集索引）或逻辑（非聚集索引）排序，以便更快地检索。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-20T18:03:01.237

键应该是该行的业务模型的唯一标识符。唯一索引的列可以被视为“备用键”。通常 SQL 服务器会自动为主键创建唯一索引。

我还应该提到您可以索引非唯一列；诸如此类的索引用于加速对索引列的查询。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-22T20:35:09.123

键是唯一标识每一行的一个字段或一组字段。通常，会有一个键被指定为主键，而现在这似乎是一个通常本身没有意义的字段（很像页码，它仅在识别页面上的内容时很重要）。

一个表可能有另一个表的键，称为外键。例如，在网上商店的数据库中，可能有一个订单表，每个订单都会有一个关联的客户，因此订单表中的每一行都有一个客户表的外键。

索引是一种基于表中一个或多个字段的数据结构，它允许基于这些字段快速访问表。该索引可以标识单个行（例如，客户电子邮件地址的索引），或者可以指示组（例如，客户的免税状态）。它的使用很像书的索引，或者像反向目录（例如按电话号码排序的电话簿）。

键主要是考虑数据库的一种方式（尽管通常可以告诉数据库有关键的信息，例如，数据库可以拒绝具有重复键的行）。索引是一种使数据库工作得更快的方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T18:06:10.963

一个键在幕后总是有一个索引如果你创建一个主键，SQL Server 将创建一个聚集唯一索引来支持它

即使你创建了唯一约束 SQL Server 也会创建索引

当然，唯一约束和主键之间的区别在于，唯一约束允许至少 1 个 NULL 值（sql server 上的 1 个多于 Oracle 上的一个）您只能有 1 个主键和许多（sql server 上为 249）表上的唯一约束

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-20T18:19:15.910

默认情况下，键在 MS SQL Server 中有一个集群索引。

键是每一行的唯一值。

索引用于最大化您的数据库性能。您可以根据需要创建索引。有不同类型的索引，例如

*   位图索引
*   密集指数
*   稀疏索引
*   覆盖指数

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-26T10:02:28.103

在关系数据库中定义元组的字段或属性称为键。而索引结构用于获得快速访问。每个索引结构都与一个特定的搜索关键字相关联。

# c# - 您如何用初学者语言描述观察者模式？

> ID：769430
> 
> 赞同：15
> 
> 时间：2009-04-20T18:05:10.390
> 
> 标签：c#, design-patterns, observer-pattern

目前，我的理解水平低于网络上所有关于观察者模式的编码示例。我将其理解为几乎是一个订阅，当委托注册的更改发生时，它会更新所有其他事件。但是，我对好处和用途的真正理解非常不稳定。我做了一些谷歌搜索，但大多数都超出了我的理解水平。

我正在尝试用我目前的家庭作业来实现这种模式，并且要真正理解我的项目需要更好地理解模式本身，也许还需要一个例子来了解它的用途。我不想将这种模式强加于提交，我需要了解其目的并相应地开发我的方法，以便它实际上服务于一个好的目的。我的文字并没有真正深入，只是一句话提到它。MSDN 对我来说很难理解，因为我是这方面的初学者，而且它似乎更像是一个高级主题。

*您如何向初学者*描述这种观察者模式及其在 C# 中的用途？ 例如，请保持代码非常简单，这样我就可以比复杂的代码片段更能理解其目的。我试图通过一些简单的文本框字符串操作和使用委托来有效地使用它，所以指针会有所帮助！

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-20T18:10:13.340

我能想到的最好的例子是邮件列表（例如）。

你，观察者，订阅一个邮件列表，然后你观察这个列表。当您不再对列表感兴趣时，您取消订阅。

这个概念就是观察者模式。涉及两个或更多类。一个或多个类订阅发布者类（有不同的名称），然后第一个类（以及每个订阅类）将在发布者需要时得到通知。

这就是我向我妻子解释的方式，她经常听我对编程和设计理论的咆哮。这对她来说很有意义。我意识到这对你来说可能太简单了，但这是一个好的开始......

问候，
弗兰克

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T18:19:49.293

查看[“Head First: Design Patterns”](https://rads.stackoverflow.com/amzn/click/com/0596007124)，了解一些非常容易理解的主要模式描述。

对于 Observer 来说，重要的是要了解它描述了一对多的关系，并使用订阅模型在发生更改时通知其他类。RSS、Atom 和 Twitter 沿着这些思路工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T18:14:04.377

观察者想知道什么时候发生了变化，所以它订阅了主题。主题不认识观察者。这是重要的部分。Subject 只是定义了 Observer 需要提供的接口（或委托），并允许注册。

**简而言之：观察者模式允许你的观察者被一个主题调用，它不关心观察者是谁以及它是否存在。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T18:23:04.153

有两个对象NOTIFIER 和OBSERVER。NOTIFIER 对 OBSERVER 一无所知，而 OBSERVER 知道 NOTIFER 实现了一个事件。

OBSERVER 使用该事件通知其他对象发生了什么事。简单地说，一个事件就是一个方法列表。因为 OBSERVER 希望在发生某事时得到通知，所以 OBSERVER 为 NOTIFER 事件添加了一个在发生某事时应该调用的方法。

所以如果事情发生了，NOTIFIER 发布了这个事件，NOTIFIER 只是遍历方法列表并调用它们。当调用 OBSERVER 添加的方法时，OBSERVER 就知道事情发生了，并且可以在这种情况下做任何需要的事情。

这是一个带有`ValueChanged()`事件的示例通知程序类。

```
// Declare how a method must look in order to be used as an event handler.
public delegate void ValueChangedHandler(Notifier sender, Int32 oldValue, Int32 newValue);

public class Notifier
{
    // Constructor with an instance name.
    public Notifier(String name)
    {
        this.Name = name;
    }
    public String Name { get; private set; }

    // The event that is raised when ChangeValue() changes the
    // private field value.
    public event ValueChangedHandler ValueChanged;

    // A method that modifies the private field value and
    // notifies observers by raising the ValueChanged event.
    public void ChangeValue(Int32 newValue)
    {
        // Check if value really changes.
        if (this.value != newValue)
        {
            // Safe the old value.
            Int32 oldValue = this.value;

            // Change the value.
            this.value = newValue;

            // Raise the ValueChanged event.
            this.OnValueChanged(oldValue, newValue);
        }
    }

    private Int32 value = 0;

    // Raises the ValueChanged event.
    private void OnValueChanged(Int32 oldValue, Int32 newValue)
    {
        // Copy the event handlers - this is for thread safty to
        // avoid that somebody changes the handler to null after
        // we checked that it is not null but before we called
        // the handler.
        ValueChangedHandler valueChangedHandler = this.ValueChanged;

        // Check if we must notify anybody.
        if (valueChangedHandler != null)
        {
            // Call all methods added to this event.
            valueChangedHandler(this, oldValue, newValue);
        }
    }
} 
```

这是一个示例观察者类。

```
public class Observer
{
    // Constructor with an instance name.
    public Observer(String name)
    {
        this.Name = name;
    }
    public String Name { get; private set; }

    // The method to be registered as event handler.
    public void NotifierValueChanged(Notifier sender, Int32 oldValue, Int32 newValue)
    {
        Console.WriteLine(String.Format("{0}: The value of {1} changed from {2} to {3}.", this.Name, sender.Name, oldValue, newValue));
    }
} 
```

一个小型测试应用程序。

```
class Program
{
    static void Main(string[] args)
    {
        // Create two notifiers - Notifier A and Notifier B.
        Notifier notifierA = new Notifier("Notifier A");
        Notifier notifierB = new Notifier("Notifier B");

        // Create two observers - Observer X and Observer Y.
        Observer observerX = new Observer("Observer X");
        Observer observerY = new Observer("Observer Y");

        // Observer X subscribes the ValueChanged() event of Notifier A.
        notifierA.ValueChanged += observerX.NotifierValueChanged;

        // Observer Y subscribes the ValueChanged() event of Notifier A and B.
        notifierA.ValueChanged += observerY.NotifierValueChanged;
        notifierB.ValueChanged += observerY.NotifierValueChanged;

        // Change the value of Notifier A - this will notify Observer X and Y.
        notifierA.ChangeValue(123);

        // Change the value of Notifier B - this will only notify Observer Y.
        notifierB.ChangeValue(999);

        // This will not notify anybody because the value is already 123.
        notifierA.ChangeValue(123);

        // This will not notify Observer X and Y again.
        notifierA.ChangeValue(1);
    }
} 
```

输出将如下所示。

```
观察者 X：Notifier A 的值从 0 变为 123。
观察者 Y：Notifier A 的值从 0 变为 123。
观察者 Y：Notifier B 的值从 0 变为 999。
观察者 X：Notifier A 的值从 123 变为 1。
观察者 Y：Notifier A 的值从 123 变为 1。

```

* * *

为了理解委托类型，我将把它们与类类型进行比较。

```
public class Example
{
   public void DoSomething(String text)
   {
      Console.WriteLine(
         "Doing something with '" + text + "'.");
   }

   public void DoSomethingElse(Int32 number)
   {
      Console.WriteLine(
         "Doing something with '" + number.ToString() + "'.");
   }
} 
```

`Example`我们用两个方法定义了一个简单的类。现在我们可以使用这个类类型了。

```
Example example = new Example(); 
```

虽然这可行，但以下内容不起作用，因为类型不匹配。你得到一个编译器错误。

```
Example example = new List<String>(); 
```

我们可以使用变量`example`.

```
example.DoSomething("some text"); 
```

现在与委托类型相同。首先我们定义一个委托类型——这只是一个类型定义，就像之前的类定义一样。

```
public delegate void MyDelegate(String text); 
```

现在我们可以使用委托类型，但是我们不能将普通数据存储在委托类型变量中，而是在方法中。

```
MyDelegate method = example.DoSomething; 
```

我们现在已经存储`DoSomething()`了对象的方法`example`。以下内容不起作用，因为我们将`MyDelegate`委托定义为采用一个字符串参数并返回 void。`DoSomethingElse`返回 void 但采用整数参数，因此您会收到编译器错误。

```
MyDelegate method = example.DoSomethingElse; 
```

最后你可以使用变量`method`. 您不能执行数据操作，因为变量不存储数据而是存储方法。但是您可以调用存储在变量中的方法。

```
method("Doing stuff with delegates."); 
```

这会调用我们存储在变量 - 中的方法`example.DoSomething()`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T18:11:58.783

观察者模式就像听起来一样 -

这是一些对象观察对象的一种手段，观察它的变化。

在 C# 中，这变得有些简单，因为事件基本上是一种特定于语言的实现观察者模式的方法。如果您曾经使用过事件，那么您就使用过观察者模式。

在其他语言中，这不是内置的，因此已经有很多尝试正式化处理这个问题的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T18:17:31.937

观察者就像一条直接的通信线路。与其让你所有的亲戚都打电话给你来了解你的情况，不如在你生病时写一张卡片，每个有兴趣的人都会得到它（或副本）。当你好转时，你会发出一张卡片。当你踮起脚尖时，你会发出一张卡片。当您获得 A 时，您会发出一张卡片。

任何关心的人都会进入您的群发邮件列表，并且可以按照他们认为合适的方式进行回复。

这种依赖关系非常适合 UI。如果我有一个缓慢的进程（例如），即使取得了进展，它也可以触发。进度条元素可以观察并更新其覆盖范围。OK 按钮可以观察到这一点并在 100% 时变为活动状态。光标可以观察到动画，直到进度为 100%。这些观察者都不需要相互了解。此外，这些元素中的任何一个都不需要知道是什么在驱动它们。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T18:19:01.497

这种模式可能是最基本的模式之一，如果不是最基本的模式的话。

涉及两个“人”；**发布**者和**订阅者/观察者**。

*观察者只是要求发布者在有“新闻”时通知他。*新闻在这里可以是任何重要的东西。它可以是空气的温度，可以是网站上的新帖子，也可以是一天中的时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T19:35:26.833

[![替代文字](https://i.stack.imgur.com/3Ops5.png)](https://i.stack.imgur.com/3Ops5.png)
[（来源：[headfirstlabs.com](http://headfirstlabs.com/Images/brain2.png)）]
正如查看“ [Head First：Design Patterns](http://headfirstlabs.com/) ”所说，他们也有一些[关于这本书](http://forums.oreilly.com/category/48/Head-First-Design-Patterns/)和[设计冥想](http://www.headfirstlabs.com/books/hfdp/dm.html)的论坛。

观察者模式遵循好莱坞原则“不要叫我们我们叫你”

模式的好网站 [http://www.dofactory.com/Patterns/PatternObserver.aspx](http://www.dofactory.com/Patterns/PatternObserver.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T20:15:08.143

您可能遇到的问题是定义正确的接口。该接口定义了订阅者和发布者之间的交互。

首先制作一个 C# WinForms 应用程序

像这样设置 Program.cs

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);

            Application.Run(new Form1());
        }
    }

    interface IObserver
    {
        void Refresh(List<string> DisplayList);
    }

    class ObserverList : List<IObserver>
    {
        public void Refresh(List<String> DisplayList)
        {
            foreach (IObserver tItem in this)
            {
                tItem.Refresh(DisplayList);
            }
        }

    }
} 
```

我们在这里做两件事。第一个是订阅者将实现的接口。然后是发布者的列表以保存所有订阅者。

然后用两个按钮制作一个表格，一个标记为表格 2，另一个标记为表格 3。然后添加一个文本框，然后添加另一个按钮标记为添加

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        private List<string> DataList= new List<string>();
        private ObserverList MyObservers = new ObserverList();
        public Form1()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            Form2 frmNewForm = new Form2();
            MyObservers.Add(frmNewForm);
            frmNewForm.Show();
            MyObservers.Refresh(DataList);
        }

        private void button2_Click(object sender, EventArgs e)
        {
            Form3 frmNewForm = new Form3();
            MyObservers.Add(frmNewForm);
            frmNewForm.Show();
            MyObservers.Refresh(DataList);

        }

        private void Form1_Load(object sender, EventArgs e)
        {

        }

        private void button3_Click(object sender, EventArgs e)
        {
            DataList.Add(textBox1.Text);
            MyObservers.Refresh(DataList);
            textBox1.Text = "";
        }

    }
} 
```

我特意设置了 Form2 按钮和 FOrm3 按钮，以便为每种类型的 Form 制作多个副本。例如，您可以同时拥有十二个人。

您会注意到，在创建每个表单后，我将其放入 Observers 列表中。我能够这样做是因为 Form2 和 Form3 都实现了 IObserver。显示表单后，我在观察者列表上调用刷新，以便使用最新数据更新新表单。请注意，我可以将其转换为 IObserver 的变量并仅更新该表单。我试图尽可能简短。

然后对于添加按钮“Button3”，我从文本框中提取文本并将其存储在我的 DataList 中，然后刷新所有观察者。

然后制作Form2。添加一个列表框和以下代码。

使用系统；

```
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form2 : Form,IObserver
    {
        public Form2()
        {
            InitializeComponent();
        }

        private void Form2_Load(object sender, EventArgs e)
        {

        }

        void IObserver.Refresh(List<string> DisplayList)
        {
            this.listBox1.Items.Clear();
            foreach (string s in DisplayList)
            {
                this.listBox1.Items.Add(s);
            }
            this.listBox1.Refresh();
        }

    }
} 
```

然后添加 Form3，一个组合框并添加以下代码。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form3 : Form,IObserver
    {
        public Form3()
        {
            InitializeComponent();
        }

        private void Form3_Load(object sender, EventArgs e)
        {

        }
        void IObserver.Refresh(List<string> DisplayList)
        {
            this.comboBox1.Items.Clear();
            foreach (string s in DisplayList)
            {
                this.comboBox1.Items.Add(s);
            }
            this.comboBox1.Refresh();
        }
    }
} 
```

你会注意到每个表单实现的 IObserver 接口的刷新方法略有不同。一个用于列表框，另一个用于组合框。接口的使用是这里的关键元素。

在现实世界的应用中，这个例子会更复杂。例如，而不是在刷新接口中传递字符串列表。它不会有任何参数。相反，Publisher（本例中为 Form1）将实现一个发布者接口，并在 Observers 被初始化时向它们注册自己。每个观察者都可以在其初始化例程中接受发布者。然后，当它刷新时，它将通过接口公开的方法将字符串列表从发布者中拉出。

对于具有多种数据类型的更复杂的应用程序，这允许您自定义实现 IObserver 的表单从发布者中提取的数据。

当然，如果您只希望观察者能够显示字符串列表或特定数据。然后将其作为参数的一部分传递。接口明确说明了每一层要做什么。这样 5 年后，您可以查看代码和代码“哦，它在做什么”。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-20T18:19:35.893

用最简单的术语来说，有两个组件：Observer 和 Observed。

在外部，Observed 需要一种添加（注册）和删除 Observer 的方法。
在内部，被观察者需要一个已注册观察者的列表。

观察者需要一个公共方法，例如 Notify() 或 Notify(params)。

每当 Observed 发生特定事情时，它都会遍历列表并在每个注册的观察者上调用 Notify()。

在最简单的情况下，它是一个简单的通知，上面写着“嘿，观察者，我的数据已更改，过来刷新一下自己”。在更复杂的版本中，参数可以过去让观察者知道发生了什么变化。

在 Model-View-Controller 中，Observed 通常是一个实体对象——保存数据的东西。控制器是观察者。它监视模型中的更改，并告诉视图在对更改感兴趣时自行更新。

Java 事件侦听器是这种模式的真实实现。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-20T18:19:52.430

想象一下，您有一个您想要观察其行为（或状态）的对象。例如，当字段 A 的值达到 10 时，您希望获得有关该事件的通知，而无需真正了解您要观察的这个复杂对象的实现细节。你定义一个接口，调用它 Observable 并让你的目标实现这个接口，它应该至少有两个方法来注册和取消注册一个 Observer，这反过来是当字段 A 达到 10 时 Observer 将调用的对象。你的 Observer只需调用 Observable 进行注册（完成后取消注册）。Observable 通常会维护一个观察者列表并立即通知他们，或者根据您的需要通知他们。它也可以同步或异步完成，这取决于你。这是非常简单的解释，无需编写代码。一旦你明白了，

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-20T18:50:47.737

**观察者（发布/订阅）**

当一个对象改变状态时，它会通知其他在运行时已注册其兴趣的对象。通知对象（发布者）向其所有观察者（订阅者）发送事件（发布）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-20T20:11:40.430

**一句话：**

一个对象（主体）允许其他对象（观察者）注册通知。

**实际例子：**

假设您有一个应用程序，并且您想让其他开发人员构建插件。

您可以创建一个 PluginSubject 类，并在其上放置一个名为 NotifyOrderCreated 的方法。每当在您的订单屏幕上创建新订单时，它都会调用 PluginSubject.NotifyOrderCreated。

发生这种情况时，PluginSubject 会获取 PluginObservers 列表并在每个上调用 PluginObserver.Notify，并传入描述事件的消息。

这可以实现一些非常简洁的功能。

**比你想知道的多得多：**

我最近确实这样做了，所以我将更深入地举这个例子——如果你要求你的观察者实现一个特殊的接口，比如 IPluginObserver，你可以使用反射来遍历你的程序集中的类型并即时实例化插件。

然后，您可以允许用户注册他们自己的程序集（您必须在某处存储程序集名称列表，然后遍历它），并且 bam，您获得了可扩展性！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-20T21:29:49.150

观察者是一种解耦的手段，即松开两个对象之间的联系。您想要这样做是因为它使您的代码更整洁且更易于维护。这几乎是所有设计模式的目标：更易于阅读，更易于维护代码。

在这个模式中，你有两个类，两个对象：发布者和观察者。Publisher 是一个实际上做了一些工作的类，然后它会不时地调用任何观察者的方法来告诉他们这件事。它知道要调用哪些类，因为它保留了订阅的观察者列表。

所以你的 Publisher 可能看起来像这样：

```
class Publisher
{
    List<Observer> observers = new List<Observer>();

public Add(Observer o)
{
    observers.Add(o);
}

private AlertObservers()
{
    foreach(Observer o in observers)
    {
        o.Alert();
    }
} 
```

Publisher 确实完成了大部分工作。Observer 需要做的就是添加到列表中并实现被调用的方法。像这样：

```
class Observer
{
    public Observer(Publisher pub)
    {
        pub.Add(this);
    }

    public Alert()
    {
        System.Console.WriteLine("Oh no, stuff is happening!");
    }
} 
```

这是一个关于它如何工作的非常简单的想法。现在，为什么它很有价值？看起来还不错吧？一个原因是因为我不使用接口，这将允许我设置许多具有观察者功能的类，并且发布者不需要了解更多关于它们的信息，除非它们可以接收 Alert() 调用。另请注意，Publisher 将尝试在它拥有的任何和所有 Observers 上调用 Alert，即使它没有。

现在，在 C# 世界中，该语言通过其 Event 对象具有此模式的内置版本。事件非常强大，它使用委托，这是一种在另一个方法调用中将方法作为参数传递的方式。它们允许一些严重的脱钩，但我会把它留到一个新问题上。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-05-02T04:42:31.987

很少有实时示例：

1.  报纸/杂志/邮件列表订阅或任何一般订阅
2.  在 MS Office Communicator 中标记同事
3.  推特

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-05-02T05:42:15.453

那些认为 .NET 中的事件确实是观察者模式的实现的人并不是在拉扯你的链条。这是真的。至于这实际上是如何工作的，无论是从高层次的角度还是在更多特定于实现的细节方面，我都将使用一个类比。

想想报纸出版商。在 OOP 术语中，我们可能将报纸视为**可观察**的事物。但它是如何工作的？显然，报纸本身的实施细节（即在这个类比中，记者、作家、编辑等都回到办公室把报纸放在一起）没有公开。人们（**观察者**）不会聚集在一起观看报纸出版商的员工做他们的工作。他们不能仅仅*这样做*，因为没有协议（或*接口*）可以做到这一点。

这就是你观察（即阅读）报纸的方式：你订阅它。你把你的名字列在该论文的订阅者名单上，然后出版商知道每天早上都会在你家门口送上一份。如果您不想再观察（阅读）它，请退订；你把你的名字*从*名单上删除了。

现在，这似乎是一个抽象的类比；但它实际上**与 .NET 事件的工作方式几乎是完美的平行**。

给定一些旨在可观察的类，它的实现通常不需要为公众所知。但是，它将向公众公开一种特定类型的接口，并且该接口是一个事件。想要观察此事件的代码实际上将自己注册为订阅者：

```
// please deliver this event to my doorstep
myObject.SomeEvent += myEventHandler; 
```

当相同的代码决定它不想再收到此事件的通知时，它会取消订阅：

```
// cancel my subscription
myObject.SomeEvent -= myEventHandler; 
```

现在快速讨论一下代表以及这段代码是如何工作的。您可能知道也可能不知道，委托本质上是一个存储方法地址的变量。通常，此变量具有类型——就像声明为、、等的*值*变量一样，都有类型。对于委托类型，此类型由方法的**签名**定义；也就是它的参数和它的返回值。特定类型的委托可以指向执行*任何操作的**任何*方法，只要该方法具有适当的签名即可。`int``double``string`

 ****所以回到报纸的类比：为了成功订阅一份报纸，你实际上必须遵循一个特定的模式。具体来说，您需要提供一个有效的地址，您希望将报纸投递到该地址。你不能只是说，“是的，把它发给丹。” 你不能说，“我要一个培根芝士汉堡”。您必须向发布者提供他们可以有意义地使用的信息。在 .NET 事件的世界中，这意味着需要提供正确签名的事件处理程序。

在大多数情况下，这个签名最终会是这样的一些方法：

```
public void SomeEventHandler(object sender, EventArgs e) {
    // anything could go in here
} 
```

以上是可以存储在类型委托变量中的方法`EventHandler`。对于更具体的情况，有泛型`EventHandler<TEventArgs>`委托类型，它描述了与上述类似的方法，但具有*从*.`e` *`EventArgs`*

 *请记住，委托实际上是指向方法的变量，在 .NET 事件和报纸订阅之间建立最终联系并不难。事件的实现方式是通过委托*列表*，可以添加和删除项目。这实际上就像报纸出版商的订阅者列表，每天早上分发报纸时，每个订阅者都会收到一份。

无论如何，希望这可以帮助您在一定程度上了解观察者模式。当然，这种模式还有许多其他类型的实现，但 .NET 事件是大多数 .NET 开发人员都熟悉的范例，所以我认为这是一个很好的起点，可以从中加深理解。

# c# - IHttpHandler 与 IHttpModule

> ID：769432
> 
> 赞同：81
> 
> 时间：2009-04-20T18:05:36.643
> 
> 标签：c#, asp.net, iis, httphandler, httpmodule

我的问题很简单（尽管答案很可能不是）：我正在尝试决定如何在 C#/ASP.NET 中实现服务器端上传处理程序。

我已经使用了 HttpModules（IHttpModule 接口）和 HttpHandlers（IHttpHandler 接口），我突然想到我可以使用任何一种机制来实现它。我也想到我不明白两者之间的区别。

所以我的问题是： **在什么情况下我会选择使用 IHttpHandler 而不是 IHttpModule （反之亦然）？**

*一个在管道中执行得更高吗？在某些情况下更容易配置吗？在中等安全性下不能很好地工作吗？*

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-09-21T06:41:32.793

ASP.NET **HTTP 处理程序**是响应对 ASP.NET Web 应用程序发出的请求而运行的进程（通常称为“端点”）。最常见的处理程序是处理 .aspx 文件的 ASP.NET 页面处理程序。当用户请求 .aspx 文件时，该请求由页面通过页面处理程序进行处理。您可以创建自己的 HTTP 处理程序，将自定义输出呈现给浏览器。

自定义 HTTP 处理程序的典型用途包括：

*   RSS 提要 要为网站创建 RSS 提要，您可以创建一个发出 RSS 格式的 XML 的处理程序。然后，您可以将文件扩展名（例如 .rss）绑定到自定义处理程序。当用户向您的站点发送以 .rss 结尾的请求时，ASP.NET 会调用您的处理程序来处理该请求。
*   图像服务器 如果您希望 Web 应用程序提供各种尺寸的图像，您可以编写一个自定义处理程序来调整图像大小，然后将它们作为处理程序的响应发送给用户。

HTTP**模块**是在对您的应用程序发出的每个请求上调用的程序集。HTTP 模块作为 ASP.NET 请求管道的一部分被调用，并且可以访问整个请求的生命周期事件。HTTP 模块允许您检查传入和传出请求并根据请求采取行动。

HTTP 模块的典型用途包括：

*   安全性 因为您可以检查传入的请求，所以 HTTP 模块可以在调用请求的页面、XML Web 服务或处理程序之前执行自定义身份验证或其他安全检查。在以集成模式运行的 Internet Information Services (IIS) 7.0 中，您可以将表单身份验证扩展到应用程序中的所有内容类型。
*   统计信息和日志记录 因为每个请求都会调用 HTTP 模块，所以您可以在一个集中的模块中而不是在单个页面中收集请求统计信息和日志信息。
*   自定义页眉或页脚 因为您可以修改传出响应，所以您可以将自定义页眉信息等内容插入到每个页面或 XML Web 服务响应中。

来自：http: [//msdn.microsoft.com/en-us/library/bb398986.aspx](http://msdn.microsoft.com/en-us/library/bb398986.aspx)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-20T18:11:33.727

[如此处](http://www.worldofasp.net/tut/HttpHandlers/Using_HttpHandlers_and_HttpModules_in_your_ASPNET_Websites_90.aspx)所述，HttpModules 是可以将自身插入请求处理管道的简单类，而 HttpHandler 与 HttpModules 的不同之处不仅在于它们在请求处理管道中的位置，还因为它们必须映射到特定的文件扩展名。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-20T18:14:11.663

`IHttpModule`给您更多的控制权，您基本上可以控制**所有**指向您的 Web 应用程序的流量。`IHttpHandler`为您提供较少的控制（流量在到达您的处理程序**之前**被过滤），但如果这足以满足您的需求，那么我认为没有理由使用`IHttpModule`.

无论如何，最好将您的自定义逻辑放在一个单独的类中，然后从`IHttpModule`或中使用这个类`IHttpHandler`。这样您就不必担心选择其中一个。事实上，您可以创建一个额外的类来实现**两者** `IHttpHandler`，`IHttpModule`然后通过将其设置为来决定使用什么`Web.config`。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-20T18:21:05.717

模块旨在处理应用程序在处理程序实际处理请求之前和之后引发的事件。另一方面，处理程序没有机会订阅任何应用程序事件，而是简单地调用其 ProcessRequest 方法，以便处理特定请求的“主要”工作。

查看 Microsoft 的此文档（大约在“请求由 HttpApplication 管道处理”部分的页面下方）：

[http://msdn.microsoft.com/en-us/library/bb470252.aspx](http://msdn.microsoft.com/en-us/library/bb470252.aspx)

您可以在第 15 步中看到处理程序有机会执行。该步骤之前和之后的所有事件都可以被模块拦截，但不能被处理程序拦截。

根据您尝试实现的特定功能，您可以使用处理程序或模块来实现上传处理程序。您甚至可能最终同时使用两者。

需要考虑的可能是使用已经编写好的上传处理程序。

这是一个免费和开源的：

[http://www.brettle.com/neatupload](http://www.brettle.com/neatupload)

这是一个商业的：

[http://krystalware.com/Products/SlickUpload/](http://krystalware.com/Products/SlickUpload/)

如果您查看 NeatUpload 的文档，您会发现它需要您配置一个模块。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-20T05:48:45.517

15秒有一个很好的小 [教程](http://www.codeguru.com/csharp/.net/net_asp/article.php/c19389/HTTP-Handlers-and-HTTP-Modules-in-ASPNET.htm)给出了实际的例子

# html - Sharepoint - 您可以从数据库中输出未过滤的 HTML 吗？

> ID：769436
> 
> 赞同：1
> 
> 时间：2009-04-20T18:08:07.777
> 
> 标签：html, sharepoint, filter, web-parts

我们的客户要求使用 Sharepoint，当然，我们必须实现 Sharepoint 并非真正设计的功能。我们首先尝试尽可能地扩展内部 Web 部件，因此我们在 MSSQL DB 中的存储过程、用户定义函数和自定义视图方面做了大量工作。

我正在从数据库中的字段生成 html 链接，并希望在数据视图 Web 部件之类的东西中显示它们。当然，正在显示的所有数据都经过过滤，以便显示为未呈现的 HTML。有没有解决的办法？

或者，是否有任何类型的 Web 部件可以连接到另一个 Web 部件或数据源并显示来自该源的未过滤文本/html？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T21:49:44.967

您需要在 dataview webpart 中使用 XSLT 来控制呈现。您可以完全控制创建的 html。如有必要，[禁用输出转义。](http://www.w3schools.com/xsl/el_value-of.asp)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:05:13.943

我感觉您以错误的方式自定义 SharePoint。要么你我真的不明白你的问题的描述。我希望能更详细地描述您要完成的工作。

据我所知，您永远不应该直接接触 SharePoint 数据库。我认为您应该专注于创建列表、字段类型、WebPart 以及您可能需要的任何 SharePoint 组件；而不是在内容数据库中乱七八糟。

SharePoint 有一个不错的开发 API。学习需要一些时间，但最终它可能是值得的。

您可以在 SharePoint 中连接您定制的 WebPart，这里是一个[示例。](http://blogs.msdn.com/pranab/archive/2007/08/28/complete-code-of-connected-web-parts-using-iwebpartfield-interface.aspx)

# linux - Solr 或其他选择

> ID：769439
> 
> 赞同：0
> 
> 时间：2009-04-20T18:09:26.620
> 
> 标签：linux, solr

我已经看到 SolR 在我的 PC 上运行，我可以更好地进行索引和搜索。但是我有 360 MB 的 linux 虚拟机，我想在 pylons 上运行一个网站。你可以推荐的最好的搜索引擎是什么。

到目前为止，我的 linux 机器从 java 安装中是干净的。对于 360 MB linux 机器，使用 Solr 是否过大？我可以看到，在运行网站应用服务器、nginx、memcached 1 年时，我有 160 MB 的可用空间:-)。

我可以很快增加内存..我想要更好的搜索选项..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T21:22:16.047

Xapian ( [http://www.xapian.org](http://www.xapian.org) ) 是 Python 的一个不错的选择，它的设置非常快速和简单。

Whoosh ( [http://whoosh.ca/](http://whoosh.ca/) ) 是一个有趣的纯 Python 新手，尽管我没有听说过它在生产中的表现如何。

# tortoisesvn - 如何在打开 Tortoise SVN 修订图之前对其进行过滤？

> ID：769446
> 
> 赞同：6
> 
> 时间：2009-04-20T18:11:00.157
> 
> 标签：tortoisesvn

有没有办法在打开 Tortoise SVN 修订图之前对其进行过滤？打开它需要一分钟多的时间，这导致走廊里的剑术太多。打开后我可以轻松过滤它，但那是我的问题。

理想情况下，我真的只需要查看最近的 100 次左右的修订，而不是自诞生以来的所有内容。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T18:24:54.600

AFAIK 你不能过滤图表 - TortoiseSVN 文档说：

> 为了生成图表，TortoiseSVN 必须从存储库根目录获取所有日志消息。不用说，即使有几千个修订版的存储库，这也可能需要几分钟，具体取决于服务器速度、网络带宽等。如果您尝试使用当前有超过 500,000 个修订版的 Apache 项目之类的东西，您可能会等待一些时间。
> 
> 好消息是，如果您使用日志缓存，您只需遭受一次这种延迟。之后，日志数据保存在本地。TortoiseSVN 的设置中启用了日志缓存。

所以 - 确保启用日志缓存并且未来的图形视图会更快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T18:20:37.653

不，那是不可能的。因为要生成图表，TSVN 需要所有修订日志中的信息。否则它可能会丢失副本（例如，如果您创建从 r2 到 HEAD 的标签，HEAD 为 r1000）。

# sql-server - 如何更改 SQL Server 数据库的所有者？

> ID：769459
> 
> 赞同：66
> 
> 时间：2009-04-20T18:13:40.790
> 
> 标签：sql-server, sql-server-2005, permissions

当我不小心单击“数据库图表”选项卡时，出现以下错误之一：

> 无法安装数据库图表支持对象，因为该数据库没有有效的所有者。要继续，首先使用数据库属性对话框的文件页面或 ALTER AUTHORIZATION 语句将数据库所有者设置为有效登录，然后添加数据库图表支持对象。

- - 或者 - -

> 数据库没有使用数据库图表所需的一个或多个支持对象。你想创建它们吗？

将此数据库的所有者更改为“sa”的语法是什么？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2014-07-09T03:53:14.310

要更改数据库所有者：

```
ALTER AUTHORIZATION ON DATABASE::YourDatabaseName TO sa 
```

从 SQL Server 2014 开始，您仍然可以使用`sp_changedbowner`，尽管 Microsoft 承诺在 SQL Server 2012 之后的“未来”版本中将其删除。尽管他们从 SQL Server 2014 BOL 中删除了它。

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2009-04-20T18:17:26.163

要更改对象所有者，请尝试以下操作

```
EXEC sp_changedbowner 'sa' 
```

但这不是您的问题，要查看图表，必须创建达芬奇工具对象（您将看到以 dt_ 开头的表和过程）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T18:17:20.470

这是创建一堆不存在的对象的提示，例如 sp_help_diagram (?)。

这应该与数据库的所有者无关。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-04-28T18:03:10.790

这是更改所有 DBS 所有者的方法（不包括系统）

```
EXEC sp_msforeachdb'
USE [?]
IF ''?'' <> ''master'' AND ''?'' <> ''model'' AND ''?'' <> ''msdb'' AND ''?'' <> ''tempdb''
BEGIN
 exec sp_changedbowner ''sa''
END
' 
```

# erlang - 在 Erlang 中定期做某事的最佳方法是什么？

> ID：769466
> 
> 赞同：32
> 
> 时间：2009-04-20T18:15:28.837
> 
> 标签：erlang, erlang-otp

我有一个需要每十五秒做一些工作的过程。我目前正在这样做：

```
-behavior(gen_server).

interval_milliseconds ()-> 15000.
init()->
    {ok, 
     _State = FascinatingStateData,
     _TimeoutInterval = interval_milliseconds ()
    }.

%% This gets called automatically as a result of our handlers
%% including the optional _TimeoutInterval value in the returned
%% Result
handle_info(timeout, StateData)->
    {noreply, 
     _State = do_some_work(StateData),
      _TimeoutInterval = interval_milliseconds ()
    }. 
```

这可行，但非常脆弱：如果我想教我的服务器一条新消息，当我编写任何新的处理函数时，我必须记住在其返回值中包含可选的超时间隔。也就是说，如果我正在处理同步调用，我需要这样做：

```
%% Someone wants to know our state; tell them
handle_call(query_state_data, _From, StateData)->
    {reply, StateData, _NewStateData = whatever (), interval_milliseconds ()}; 
```

代替

```
%% Someone wants to know our state; tell them
handle_call(query_state_data, _From, StateData)->
    {reply, StateData, _NewStateData = whatever ()}; 
```

正如您可能猜到的那样，我已经多次犯过这个错误。这很糟糕，因为一旦代码处理了该 query_state_data 消息，就不再生成超时，整个服务器就会停止运行。（我可以通过在机器上获取外壳并手动发送“超时”消息来手动“除颤”，但是...... eww。）

现在，我可以尝试记住始终在我的 Result 值中指定可选的 Timeout 参数。但这不成比例：总有一天我会忘记，并且会再次盯着这个错误。那么：什么是更好的方法？

我不认为我想编写一个永远运行并且大部分时间都在睡觉的实际循环；这似乎与 OTP 的精神背道而驰。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-20T21:07:48.453

使用[计时器](http://www.erlang.org/doc/man/timer.html)：send_interval/2。例如：

```
-behavior(gen_server).

interval_milliseconds()-> 15000.
init()->
    timer:send_interval(interval_milliseconds(), interval),
    {ok, FascinatingStateData}.

%% this clause will be called every 15 seconds
handle_info(interval, StateData)->
    State2 = do_some_work(StateData)
    {noreply, State2}. 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2013-07-25T04:44:59.497

最好的方法是：

```
init([]) ->
  Timer = erlang:send_after(1, self(), check),
  {ok, Timer}.

handle_info(check, OldTimer) ->
  erlang:cancel_timer(OldTimer),
  do_task(),
  Timer = erlang:send_after(1000, self(), check),
  {noreply, Timer}. 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-20T20:15:02.497

使用[计时器](http://erlang.org/doc/man/timer.html)模块:)

# c# - 我需要在引用类型上覆盖 GetHashCode() 吗？

> ID：769467
> 
> 赞同：22
> 
> 时间：2009-04-20T18:15:38.867
> 
> 标签：c#, .net, dictionary, gethashcode

我阅读了有关 StackOverflow 的大多数问题`GetHashCode`。但我仍然不确定是否必须覆盖`GetHashCode`引用类型。我从另一个问题的某人的回答中得到以下内容：

> Object.GetHashCode() 使用 System.Object 类中的内部字段来生成哈希值。创建的每个对象都被分配一个唯一的对象键，在创建时存储为整数。这些键从 1 开始，并在每次创建任何类型的新对象时递增。

如果在 .NET Framework 3.5 中仍然如此（有人可以确认吗？），那么我看到的引用类型的默认实现的唯一问题是哈希码的分布很差。

我将分解我的问题：

a）因此，`GetHashCode`如果在 a 中使用它，建议也覆盖它，`Dictionary`或者默认实现是否执行得很好？

b）我有引用类型，因为它们具有唯一标识它们的字段，所以很容易做到这一点，但是那些所有成员也是引用类型的引用类型呢？我应该在那里做什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-20T18:26:45.843

如果您覆盖 Object.Equals()，则只需要在引用类型上覆盖 GetHashCode()。

原因很简单——通常，2 个引用总是不同的（a.Equals(b)==false，除非它们是同一个对象）。在这种情况下，GetHashCode() 的默认实现将提供 2 个不同的哈希值，所以一切都很好。

但是，如果您覆盖 Equals()，则无法保证此行为。如果两个对象相等（根据 Equals()），您需要保证它们与 GetHashCode 具有相同的哈希码，因此您应该覆盖它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T18:36:15.667

我只是做了一个样本测试，我看不到它是如何从 1 开始并增加的。

```
for (int i = 0; i < 16; i++)
{
    object obj = new object();
    Console.Write(obj.GetHashCode() + " ");
} 
```

这些结果：

```
45653674 41149443 39785641 45523402 35287174 44419000 52697953 22597652 
10261382 59109011 42659827 40644060 17043416 28756230 18961937 47980820 
```

事实上，使用 Reflector，我只能看到：

```
internal static extern int InternalGetHashCode(object obj); 
```

所以它究竟是如何发生的对我来说是一个谜（可能有一个模式，但我现在不打算深入挖掘——也许是某种“伪随机数”[算法](http://en.wikipedia.org/wiki/Linear_congruential_generator)？）。CLR 团队的某个人可以回答这个问题。

至于其他问题，里德实际上击败了我：`GetHashCode`和`Equals`。为了以防万一， MSDN[页面](http://msdn.microsoft.com/en-us/library/system.object.gethashcode.aspx)用更多血淋淋的细节对其进行了描述。

# sql - SQL多次将一个表连接到另一个表？（将产品映射到类别）

> ID：769475
> 
> 赞同：5
> 
> 时间：2009-04-20T18:17:22.093
> 
> 标签：sql, join

假设我有一个`Product`,`Category`和`Product_To_Category`表。一个产品可以属于多个类别。

```
    产品类别 Product_to_category
    身份证 | 姓名 ID | 名称 Prod_id | Cat_id
    =================================================== ==
        1| 玫瑰1| 鲜花 1| 1
        2| 巧克力棒 2| 食物2| 2
        3| 巧克力花3| 1
                                                       3| 2

```

我想要一个 SQL 查询，它给我一个结果，例如

```
    产品名称 | 类别_1 | 类别_2 | 类别_3
    ==================================================== =====
    玫瑰 | 鲜花 | |
    巧克力花 | 鲜花 | 食品 |

```

等等

我能够做到这一点的最好方法是将一堆查询合并在一起；对给定产品的每个预期数量的类别进行一次查询。

```
select p.name, cat1.name, cat2.name
from
  product p, 
  (select * from category c, producttocategory pc where pc.category_id = c.id) cat1,
  (select * from category c, producttocategory pc where pc.category_id = c.id) cat2
where p.id = cat1.id 
  and p.id = cat2.id
  and cat1.id != cat2.id
union all
select p.name, cat1.name, null
from
  product p, 
  (select * from category c, producttocategory pc where pc.category_id = c.id) cat1
where p.id = cat1.id 
  and not exists (select 1 from producttocategory pc where pc.product_id = p.id and pc.category_id != cat1.id) 
```

这有几个问题。

*   首先，我必须为每个预期的类别重复这个联合；如果一个产品可以属于 8 个类别，我需要 8 个查询。
*   其次，类别没有统一放在相同的列中。例如，有时一个产品可能有“食物，鲜花”，而另一个时间可能有“鲜花，食物”。

有谁知道更好的方法来做到这一点？另外，这种技术有技术名称吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T18:22:36.977

我不知道您使用的是什么 RDBMS，但在 MySQL 中您可以使用 GROUP_CONCAT：

```
SELECT
  p.name,
  GROUP_CONCAT(c.name SEPARATOR ', ') AS categories
FROM
  product p
  JOIN product_to_category pc ON p.id = pc.product_id
  JOIN category c ON c.id = pc.category_id
GROUP BY
  p.name
ORDER BY
  p.name,
  c.name 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T18:22:57.337

您无法使用严格的 SQL 查询来创建这些结果。您尝试生成的内容称为**数据透视表**。许多报告工具都支持这种行为，您可以在其中选择产品和类别，然后将类别转换为数据透视列。

我相信 SQL Server Analysis Services 也支持这样的功能，但我对 SSAS 没有任何经验。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T18:25:02.587

```
SELECT p.name, cat_food.name, cat_flowers.name
FROM
  product p
  left outer join  Product_to_category pc_food 
    on p.id = pc_food.Prod_id
  left outer join Category cat_food
    on pc_food.Cat_id = cat_food.id
    AND cat_food.name = 'Food'
  left outer join  Product_to_category pc_flowers
    on p.id = pc_flowers.Prod_id
  left outer join Category cat_flowers
    on pc_flowers.Cat_id = cat_flowers.id
    AND cat_flowers.Name = 'Flowers' 
```

仅当您知道可能的类别数量时，才能将它们放入列中。这就是（标准）SQL 的工作方式，列数不是动态的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T19:43:11.263

Seb 的回答让我找到了解决方法。我正在使用 Oracle，它具有模拟 MYSQL 的`group_concat`. 这是一个例子。这不会生成列，因此不如纯 SQL 解决方案好，但它适合我当前的目的。

```
with data as
( 
  select 
    pc.id cat,
    p.id prod, 
    row_number() over( partition by p.id order by pc.id) rn,
    count(*) over (partition by p.id) cnt
  from product_to_category pc, product p
  where pc.product_id = p.id
)
select prod, ltrim(sys_connect_by_path(cat, ','), ',') cats
  from data
 where rn = cnt
 start with rn = 1 connect by prior prod = prod and prior rn = rn - 1
 order by prod 
```

这会生成数据，例如

```
产品 | 猫
===========
284 | 12
285 | 12
286 | 9,12

```

我可以根据需要编辑 ltrim(sys_connect_by_path()) 列来生成我需要的任何数据。

# sql-server - EXECUTE 错误后的事务计数

> ID：769484
> 
> 赞同：0
> 
> 时间：2009-04-20T18:19:49.013
> 
> 标签：sql-server, ado.net

我有一个看起来像这样的存储过程：

```
 CREATE PROCEDURE my_procedure 
  @val_1 INT,
  @val_2 INT
AS
SET NOCOUNT ON;
SET XACT_ABORT ON;

BEGIN TRY
  BEGIN TRANSACTION;

  INSERT INTO table_1(col_1, col_2)
  VALUES (@val_1, @val_2);  

  COMMIT TRANSACTION;
END TRY
BEGIN CATCH
  IF @@TRANCOUNT > 0
    ROLLBACK TRANSACTION;

  DECLARE
    @ERROR_SEVERITY INT,
    @ERROR_STATE    INT,
    @ERROR_NUMBER   INT,
    @ERROR_LINE     INT,
    @ERROR_MESSAGE  NVARCHAR(4000);

  SELECT
    @ERROR_SEVERITY = ERROR_SEVERITY(),
    @ERROR_STATE    = ERROR_STATE(),
    @ERROR_NUMBER   = ERROR_NUMBER(),
    @ERROR_LINE     = ERROR_LINE(),
    @ERROR_MESSAGE  = ERROR_MESSAGE();

  RAISERROR('Msg %d,
  Line %d,
  :%s',
    @ERROR_SEVERITY,
    @ERROR_STATE,
    @ERROR_NUMBER,
    @ERROR_LINE,
    @ERROR_MESSAGE);
END CATCH 
```

当这段代码通过数据库执行时，一切都运行正常。通过 ADO.NET 执行时，我收到以下错误消息：

“INSERT 语句与 FOREIGN KEY 约束“`FK_table1_table2`冲突。冲突发生在数据库“ `my_database`”，表“ `dbo.table_1`”，列 ' `col_1`'。EXECUTE 后的事务计数表明缺少 COMMIT 或 ROLLBACK TRANSACTION 语句。先前计数 = 1，当前计数 = 0。”

发生这种情况是因为该`XACT_ABORT`设置强制来自 ADO.NET 的事务回滚吗？避免此错误的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T18:23:33.030

您可以在您的代码中检查 XACT_STATE() 然后提交或回滚，请在此处查看：[使用 XACT_STATE() 检查注定的事务](http://wiki.lessthandot.com/index.php/Use_XACT_STATE()_To_Check_For_Doomed_Transactions)

基本上这样的事情会爆炸

```
BEGIN TRANSACTION TranA
    BEGIN TRY
     DECLARE  @cond INT;
     SET @cond =  'A';
    END TRY
    BEGIN CATCH
     PRINT 'a'
    END CATCH;
    COMMIT TRAN TranA 
```

当您检查 xact_state 时，您可以控制它

```
BEGIN TRANSACTION TranA
    BEGIN TRY
     DECLARE  @cond INT;
     SET @cond = 'A';
    END TRY
    BEGIN CATCH
     PRINT ERROR_MESSAGE();
    END CATCH;
    IF XACT_STATE() =0
    BEGIN
     COMMIT TRAN TranA
    END
    ELSE
    BEGIN
     ROLLBACK TRAN TranA
    END 
```

还请查看这两个必读链接 [实现使用存储过程](http://www.sommarskog.se/error-handling-II.html)的[错误处理和 SQL Server 中的错误处理 - 背景](http://www.sommarskog.se/error-handling-I.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-26T10:06:45.297

IF XACT_STATE() =0 BEGIN COMMIT TRAN TranA END

会产生错误。XACT_STATE() = 0 表示没有要提交或回滚的事务

XACT_STATE() = 1 表示有可提交事务

XACT_STATE() = -1 表示存在不可提交的事务，数据库引擎将在当前上下文结束时回滚。

# asp.net - 如果不为特定浏览器呈现，为什么要使用适配器而不是扩展 ASP.Net 控件？

> ID：769487
> 
> 赞同：0
> 
> 时间：2009-04-20T18:20:11.257
> 
> 标签：asp.net, control-adapter

我对控制适配器的理解是，它们旨在为不同的浏览器提供不同的 HTML 呈现（因此，您在 .browsers 文件中注册它们......）。

但是，似乎人们只是为默认浏览器注册适配器，并使用它们来覆盖 ASP.Net 控件的 Render 方法。

你相信这是真的吗？如果是这样，您为什么不直接从控件继承并以这种方式覆盖 Render 方法，而不是使用适配器？

覆盖的一个好处是您可以向其添加更多属性，这是适配器无法做到的。

我只是想确保我不会错过一些使适配器比覆盖更好的秘诀。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T19:12:26.017

是的，为默认浏览器注册适配器是很常见的。这背后的主要思想是覆盖现有控件的呈现功能。例如，所谓[的“Css Friendly”控件适配器](http://www.asp.net/CssAdapters/)——这项工作主要是为了使控件生成更多符合标准的 html。

基本上，您在这里缺少的是，您可以在使用标准 asp.net 控件的现有站点上删除一组针对默认浏览器的控制适配器，并获得“更好”或“不同”标记，而无需更改您的站点使用您创建的自定义控件。

# ruby-on-rails - Ubuntu rails 安装在 zlib 上失败

> ID：769496
> 
> 赞同：128
> 
> 时间：2009-04-20T18:22:20.020
> 
> 标签：ruby-on-rails, ruby, rubygems, zlib, ubuntu-8.10

我刚刚转移到 Ubuntu 8.10 作为我的开发工具箱；这是我第一次认真尝试将 Linux 作为日常使用的操作系统，我很难让 Rails 运行起来。我遵循了许多似乎都可以正常工作的教程，但是当我尝试在任何东西上使用 gem install 或 gem update 时，我得到一个看起来像这样的错误：

```
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require': no such file to load -- zlib (LoadError)
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/spec_fetcher.rb:1
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/commands/update_command.rb:5
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:167:in `load_and_instantiate'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:88:in `[]'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:144:in `find_command'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:131:in `process_args'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:102:in `run'
from /usr/local/lib/ruby/site_ruby/1.8/rubygems/gem_runner.rb:58:in `run'
from /usr/local/bin/gem:21 
```

我已经（按照教程中的建议）安装了 zlib、zlib1g 和 zlib1g-dev。我什至找到了一些关于这个特定问题的教程（但是，所有这些都是针对我以外的口味），但它们没有帮助。

我在 Ubuntu 8.10，ruby 版本 1.8.8dev gem 版本 1.3.2

我试过分别重新安装红宝石和宝石，但无济于事。

* * *

## 回答 #1

> 赞同：297
> 
> 时间：2010-05-26T09:40:23.277

如果您在尝试在 Ubuntu 10.04 上使用 Ruby 版本管理器 (RVM) 安装 Ruby 时遇到这个问题，那么在 rvm 网站[http://rvm.beginrescueend.com/packages/zlib/上有安装 zlib 的说明](http://rvm.beginrescueend.com/packages/zlib/)

步骤是：

```
rvm pkg install zlib 
```

（或者 `rvm package install zlib`如果你得到“错误：无法识别的命令行参数：'pkg'” - 旧版本的 rvm 使用动词 'package' 代替）

然后

```
rvm remove 1.9.1
rvm install 1.9.1 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2010-09-09T12:31:13.593

我正在使用 Ubuntu 10.04 (Lucid)，我想安装 ruby​​ 1.9.2，因为 Rails 不推荐使用 1.9.1。所以我下载了 1.9.2 的源代码并解压/解压。我的源发行版是 ruby​​-1.9.2-p0。解压后，我构建 zlib 如下：

```
cd ruby-1.9.2-p0/ext/zlib
ruby extconf.rb
make
sudo make install
sudo gem install rails 
```

解决了这个问题。这类似于其他人在上面发布的内容，但不完全一样，所以我想我也可以准确地发布我为实现它所做的事情。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-11-02T13:57:27.637

我在 CentOS 中遇到了同样的问题，并通过执行以下命令来修复它：

首先，我确保 zlib 和 zlib-devel 存在（就像上面的许多建议一样）。

```
yum install zlib zlib-devel 
```

其次，我重新编译安装了ruby自带的zlib的源码。

```
cd /home/myname/installers/ruby-1.8.7-p174/ext/zlib/
ruby extconf.rb --with-zlib-include=/usr/include --with-zlib-lib=/usr/lib
make
make install 
```

该命令似乎解决了问题，然后我执行`gem update --system`并且 zlib 的错误消失了。然后我用 gem install rails 安装 rails。请注意我之前安装了gem，并且在重新编译并安装zlib之后，我都没有重新编译安装gem（实际上我不知道如何卸载它，因为我没有找到执行此操作的脚本）

这对我有用……希望你能。

问候。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-08-17T03:23:31.500

尝试

```
aptitude install zlib1g-dev 
```

然后去做你的事。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-04-25T01:12:09.220

我真的不喜欢这些答案中的任何一个......没有一个真正关注用户的实际需求和问题......只是人们告诉他们做了什么......没有上下文，它甚至对我不起作用......

所以， ..

我正在安装一个新盒子 Ubuntu 8.04 LTS 64-bit ...

所以我 ...

```
cd ~  
wget ftp://ftp.ruby-lang.org//pub/ruby/1.9/ruby-1.9.2-p180.tar.gz  
tar -xvvf ruby-1.9.2-p180.tar.gz  
cd ruby-*  
./configure  
make  
install  
sudo make install 
```

然后我有这个问题......

```
gem list 
```

它不起作用......关于zLib的一些东西没有找到废话......

所以，我实际上阅读了自述文件，发现我需要编辑一个文件......

```
[my ruby source directory]/ext/Setup 
```

并取消注释其中包含 zLib 的行...通过删除第一列中的“#”

然后我再次运行命令...包含在此处以供参考...

```
./configure
make  
install  
sudo make install 
```

一切都很好......这是合乎逻辑的......并且没有“rvm”和其他......“只需安装更多东西以使其工作”类型的解决方案。

乔特

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-02-25T09:24:19.670

只需转到 Ruby Source Package ，解压缩它。

转到 /your-ruby-dir/ext/zlib

```
ruby extconf.rb
make
sudo make install 
```

如果缺少包它会告诉你，主要是 libzlib 相关的包

问候

索拉布

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-04-19T14:44:25.290

```
rvm package install zlib
rvm remove 1.9.1
rvm install 1.9.1 
```

做到了。经过无数次的大雁追逐，我很高兴找到了这个页面。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-21T17:15:01.233

是的，那也没有做这项工作。从另一个来源得到这个，这终于在其他东西失败的地方为我做到了。

```
wget http://www.blue.sky.or.jp/atelier/ruby/ruby-zlib-0.6.0.tar.gz
tar xvzf ruby-zlib-0.6.0.tar.gz
cd ruby-zlib-0.6.0
ruby extconf.rb && make
sudo make install 
```

从源代码重新安装 ruby​​ gems

无论如何，谢谢，伙计们。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-20T18:26:33.520

问题是 Ubuntu 上的 Ruby 不是针对 zlib 构建的。您需要进行源代码构建来安装 Ruby。你可以这样做`apt-get source -b ruby`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-21T17:03:34.833

您是否尝试过 apt-get install libzlib-ruby？

还要从 ruby​​forge 安装 ruby​​gems。我不喜欢 Ubuntu 中的 ruby​​gems 包。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-02-18T16:52:35.563

在 Debian（挤压）上：

libruby 包含用于 ruby​​ 的 zlib 以及使 ruby​​ 在 Debian 上正常工作所需的所有其他东西。所以...

```
apt-get install libruby 
```

然后...

```
cd /usr/local/src/ruby
make clean
make
make install
cd ../rubygems
ruby setup.rb
gem install rails 
```

这使它对我有用，但是您的里程可能会有所不同。在发现所需的一切都被 libruby 覆盖之前，我对 zlib 做了一个轻微的霰弹枪方法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-21T08:50:55.503

您可以尝试在[phusion](http://rubyforge.org/frs/download.php/51101/ruby-enterprise_1.8.6-20090201_i386.deb)网站上下载 ruby​​ enterprise deb 包。并通过包安装乘客。按照[此处](http://www.modrails.com/install.html)的说明进行操作。或者您可以尝试使用[此处](http://gist.github.com/37213)找到的 bash 脚本。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-21T08:59:58.040

在运行 Rails 时，我不建议使用 Ruby 1.8.8dev。坚持使用 1.8.6，最好是 Ruby 企业版。请参阅[RailsLab](http://railslab.newrelic.com/2009/04/01/the-state-of-the-stack-a-ruby-on-rails-benchmarking-report)上的这篇文章，其他人正在使用什么。

如果您坚持使用高科技，请安装 Ruby 1.9.1。

但在这两种情况下，您都可以自己构建它或使用 Marans 的建议。

# java - 我可以在 Java 中使用适用于所有 for-each 循环的参数吗？

> ID：769510
> 
> 赞同：7
> 
> 时间：2009-04-20T18:25:49.060
> 
> 标签：java, iterator, foreach

假设我有一个方法，它接受一个数组并使用 Java 内置的[for-each 循环](http://java.sun.com/j2se/1.5.0/docs/guide/language/foreach.html)处理其中的每个元素，如下所示：

```
public static void myFun(SomeClass[] arr) {
    for (SomeClass sc : arr) {
        // Stuff is processed here
    }
} 
```

这工作得很好，但现在我希望能够传递相同的方法 a `List<SomeClass>`。我注定要使用[Collection.toArray(T [])](http://java.sun.com/javase/6/docs/api/java/util/Collection.html#toArray(T[]))，还是有一个我可以使用的参数`myFun()`接受可以在 for-each 构造中使用的任何类型？

澄清一下：我想要一个可以接受任何可迭代对象的方法签名，无论是原始数组还是集合。我可以很容易地编写两种方法，一种包装另一种，但我只是好奇是否有更好的方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T18:33:05.953

我建议使用`Iterable`,`Collection`或`List`作为参数类型。

IMO，集合应该优先于引用数组。如果您碰巧有一个数组`Arrays.asList`，则可以很好地进行转换。`Arrays.asList`允许获取和设置回数组，但显然不允许更改数组长度的“结构”修改。

```
myFun(Arrays.asList(arr)); 
```

在极端/一般情况下，您可能必须使用通配符。

```
public static void myFun(Iterable<? extends SomeClass> somethings) {
    for (SomeClass something : somethings) {
        // something is processed here
    }
} 
```

值得注意的是`Collections.toArray`，`Arrays.asList`工作方式略有不同。`asList`保留原始数组以支持集合，因此对集合的更改将反映在数组中。`Collections.toArray`制作收集数据的（浅）副本。如果您要返回一个数组，那么制作副本通常是您想要的。不对称地，如果您作为参数传递，则通常不会复制（除非存储为字段）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T18:26:56.420

~~使用[`Iterable`](http://java.sun.com/javase/6/docs/api/java/lang/Iterable.html). 这就是它的用途。~~

正如你所说，[`Iterable`](http://java.sun.com/javase/6/docs/api/java/lang/Iterable.html)不会处理数组。

您不想使用多种方法相互包装。这排除了`Arrays.asList`和`Collection.toArray`。

所以你的问题的答案是否定的，没有办法。但是如果你*可以*使用`Lists`，你为什么会使用数组呢？

我还是会和`Iterable`这里一起去。我更喜欢它，`Collection`因为过去我有实现`Iterable`但不是集合的类；这使他们可以轻松地根据需要懒惰地检索值，并且我可以对它们使用 foreach 循环。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T18:57:11.090

**你不能**，java Arrays 没有实现 Iterable：

```
public static int sum(Iterable<Integer> elements) {
    int s = 0;

    for (int i : elements) {
        s += i;
    }

    return s;
}

public static void main(String[] args) {
    L1: System.out.println(sum(1,2,3));
    L2: System.out.println(sum(Arrays.asList(1,2,3)));
    L3: System.out.println(sum(new int[] { 1,2,3 }));
} 
```

这会导致（L1 和 L3）中出现两个编译时错误；所以你必须设计你的方法来接受一个迭代（集合）和/或一个数组，至少一个方法必须执行一些转换（到/从数组）

**解决方法**：

您可以尝试使用适配器：

```
public class ArrayIterator<T> implements Iterator<T> {

    private final T[] array;
    private int i;

    public ArrayIterator(T[] anArray) {
        array = anArray;
        i = 0;
    }

    public boolean hasNext() {
        return i < array.length;
    }

    public T next() {
        return array[i++];
    }

    public void remove() {
        throw new UnsupportedOperationException();
    }
}

private static int sum(final Integer ... elements) {
    return sum(new Iterable<Integer>() {

        public Iterator<Integer> iterator() {
            return new ArrayIterator<Integer>(elements);
        }
    });
} 
```

仅在处理原始数组时才应注意；当您仅使用引用对象（您的情况）时，ArrayIterator + 匿名类很酷

希望能帮助到你

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T19:35:17.007

简短的回答：不，没有单一的方法签名可以安全地接受 Iterable 和数组。显然你可以接受`Object`，但这也将是一个黑客。

冗长的答案：由于增强的`for`-loop 被有效地定义了两次（一次用于数组，一次用于`Iterable`），因此您还需要提供两个重载方法：

```
public static void myFun(SomeClass[] array) {
    for (SomeClass sc : array) {
        doTheProcessing(sc);
    }
}

public static void myFun(Iterable<? extends SomeClass> iterable) {
    for (SomeClass sc : iterable) {
        doTheProcessing(sc);
    }
} 
```

尽管这两种方法的来源看起来完全相同，但您需要定义它两次（当然，除非您`Iterable`按照@dfa 的概述将数组包装在您自己的中）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T19:28:50.220

Java 1.5+ 中的 Java 泛型有一个鲜为人知的特性，您可以`<? extends Subtype>`在其中使用方法调用和构造函数。你可以使用`<? extends Object>`, 然后任何处理这些的东西都只能访问 Object 上的方法。你可能真正想要的是更像这样的东西：

```
List<? extends MyCrustaceans> seaLife = new ArrayList<? extends MyCrustaceans>();
MyShrimp s = new MyShrimp("bubba");
seaLife.add(s);
DoStuff(seaLife);

...

public static void DoStuff(List<? extends MyCrustaceans> seaLife)
{
    for (MyCrustaceans c : seaLife) {
        System.out.println(c);
    }
} 
```

因此，如果您有一个基类（如 MyCrustaceans），则可以在 DoStuff 中使用该基类的任何方法（如果您的参数为 ，则可以使用 Object 类的任何方法`<? extends Object>`）。有一个类似的特性`<? super MyType>`，它接受一个参数，该参数是给定类型的超类型，而不是子类型。以这种方式可以使用“extends”和“super”有一些限制。这是[查找更多信息的好地方](http://java.sun.com/j2se/1.5/pdf/generics-tutorial.pdf)。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-04-20T18:27:55.950

```
public static void myFun(Collection<MyClass> collection) {
    for (MyClass mc : collection) {
        // Stuff is processed here
    }
} 
```

# .net - 从 IValueConverter 获取对 ViewModel 的引用

> ID：769511
> 
> 赞同：4
> 
> 时间：2009-04-20T18:26:00.683
> 
> 标签：.net, wpf, data-binding, mvvm, ivalueconverter

是否有一种干净和/或可接受的标准方式从 IValueConverter 引用 ViewModel，或者这是否破坏了 MVVM 模式？基本上，我想根据 ViewModel 的其他属性转换 UI 中的绑定数据。我想这与如何从 IValueConverter 引用窗口/页面是同一个问题，因为对控件的引用没有传递给 Convert/ConvertBack 方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T18:43:56.693

我建议向 ViewModel 添加一个新属性，以连接或组合 ViewModel 中的其他属性。这消除了对`IValueConverter`所有在一起的需要。

查看有关何时使用 MVVM 的[讨论。](http://groups.google.com/group/wpf-disciples/browse_thread/thread/3fe270cd107f184f/c29b3935ec9d3c4e?#c29b3935ec9d3c4e)`IValueConverters`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-11-20T16:01:39.410

每当我需要在转换器中使用 ViewModel 中的多个属性时遇到罕见的情况时，我只需将整个视图模型作为输入传递，ala;

```
<Textbox Text="{Binding, Converter={StaticResource WholeObjectConverter}"/> 
```

至于获取调用转换的窗口/页面/视图的引用并不是一个好主意，因为这肯定会破坏 MVVM 模式。这个想法是您的视图和数据是独立的实体，并且设计上不应该相互了解。

但是，如果您想真正破解它，您可能会变得聪明并将所需的引用（ViewModel 或 View）作为绑定的 ConverterParameter 部分传递。

# c# - 有没有办法在 c# 中强制执行没有上下文切换的原子操作？

> ID：769520
> 
> 赞同：0
> 
> 时间：2009-04-20T18:28:05.827
> 
> 标签：c#, .net, multithreading

我有几行方法，我想确保在执行这些方法时没有上下文切换到另一个线程？是的，重新架构是一种选择，但如果我能做到这一点，现在它会更方便。

这可能吗？如果没有，那么有人知道这个决定背后的原因吗？

**编辑：**我问的原因是我有一个负责返回值的类，该值是通过事件提供的，因此当调用 GetValue() 时，线程需要阻塞，直到引发事件。所以我们有：

```
public class ValueResolver {
  IPersistentNotifier _notifier;
  IValueMonitor _monitor;
  Value _value;
  ManualResetEvent _resolvedEvent = new ManualResetEvent(false);
  public ValueResolver(IPersistentNotifier notifier, IValueMonitor monitor) {
    _notifier = notifier;
    _monitor = monitor;
    _monitor.ValueAcquired += ValueAcquired;
  }
  public Value GetValue() {
    _value = null;
    persistentNotifier.Show("Getting Value")
    _monitor.Start();
    _resolvedEvent.WaitOne(60000, false);
    return _value
  }
  public void ValueAcquired(Value val) {
    _value = val;
    _monitor.Stop();
    _notifier.Hide();
    _resolvedEvent.Set();
  }
} 
```

我能想到为此编写测试的唯一方法是（在犀牛模拟中）

```
var monitor = MockRepository.GetMock<IValueMonitor>() 
monitor.Expect(x=>x.Start()).Do(new Action(() => {
  Thread.Sleep(100);
  monitor.Raise(y=>y.ValueAcquired, GetTestValue());
}); 
```

但欢迎提出任何建议。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T18:35:55.573

不，你不能。您可以使用锁来确保没有其他线程会输入与您的操作有关的敏感代码，但仅此而已。

至于“为什么”——一般不需要，在相对高级平台上的抢先操作系统中会有点奇怪。在驱动程序代码中可能是可能的，但在用户代码中通常不需要。

请注意，考虑到多核和多处理器机器，“其他线程正在运行”并不一定意味着上下文切换。

编辑：尽管您进行了编辑，但我仍然不明白为什么会有上下文切换是个问题。如果线程无论如何都必须阻塞，那么它几乎*必然会*上下文切换到不同的线程。我同意你必须等待（比如说）100 毫秒左右才能确信你的测试会让一切都发生在你需要的另一个线程上，这有点令人烦恼，但你绝对*不需要*确保它不会t 上下文切换。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T18:36:39.207

上下文切换是操作系统试图对系统中执行的所有线程\进程“公平”的方法。基于操作系统，例如Windows，实现基于优先级的抢占式调度。抢占式调度意味着如果较高优先级的线程已准备好执行，则当前线程必须离开 CPU。

编写原子代码意味着中断操作系统调度，这是操作系统不允许的。此外，Windows 事件驱动中的调度。除非没有相同\更高优先级的等待线程，否则您无法占用 CPU。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T18:38:11.433

Windows 和其他所有现代操作系统都是抢先调度的多处理操作系统。操作系统负责为各个进程分配时间片，各个进程不能独占系统。

想象一下，如果您的代码在您的神奇“无上下文切换”代码部分中进入无限循环。整个系统将冻结，必须重新启动。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T21:35:27.013

为什么要坐等活动开火？你不能写一个方法`(IValueMonitor)`来“获取”你的价值吗？

也许我不明白...

# jquery - jquery脚本执行但没有为.show设置css

> ID：769521
> 
> 赞同：0
> 
> 时间：2009-04-20T18:28:26.277
> 
> 标签：jquery, asp.net-mvc, css

我有 jquery 代码被 asp.net mvc 页面上的可重复部分视图重用，但脚本没有按我预期的那样执行。

场景并不那么复杂，我有一个页面对一个项目有多个评论，并且登录的用户可以通过竖起大拇指/竖起大拇指按钮“投票赞成”或“投票反对”评论（类似于 digg ）。

我将每个场景的文本呈现在`<span>`id='spanname-'+reviewId 中，因此每个评论的评级都是唯一可识别的（因为它们是可重复的，因为页面上存在多个评论，每个评论都具有相同的功能）所以例如，如果我想要求用户登录，如果他们当前没有，我有以下 html

```
<span id="login-<%=Model.EntityId%>" style="margin: 0 5px 0 5px;display:none;">
        Why not <a href="#">login</a> and rate this? 
</span> 
```

并适当设置一个初始化（）方法

```
var isAuthenticated = <%=Request.IsAuthenticated.ToString().ToLower() %>;
function initialise()
   {
        if (isAuthenticated)
           {//hide login spans, unhide other spans}
       else
           {
               //alert('user not logged in')
               $('rate-<%=Model.EntityId%>').hide();
               $('login-<%=((GigItModel)Model).EntityId%>').show();
               //alert($('login-<%=((GigItModel)Model).EntityId%>'));
           }
    }
    $().ready(function()
       {
        initialise();
       }); 
```

我已经放置了警报按钮来测试它是否检测到登录用户与未登录用户，并且它正在引用对象，但由于某种原因，页面没有呈现 CSS 属性并且显示 NONE`<span>`的（或全部，如果我删除显示：`style`属性中的无）

谁能提供有关为什么 jquery 没有按预期执行的见解？提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T18:39:31.290

你忘了在你的 id 之前使用 #

```
$('#rate-<%=Model.EntityId%>').hide();
$('#login-<%=((GigItModel)Model).EntityId%>').show(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T18:42:34.963

一个建议——不要使用 javascript 来隐藏该功能。使用 ASP 代码编写允许投票的 HTML 和基于该用户登录的登录框。您不应该将该逻辑留给客户端脚本，如果有人禁用了 javascript 会发生什么？

但是，要解决您的问题，您需要在代码前面添加一个 # 来通过 ID 解决某些问题：

```
$('#rate-<%=Model.EntityId%>').hide();
$('#login-<%=((GigItModel)Model).EntityId%>').show(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T18:40:29.073

要按 id 选择 DOM 元素，请使用 #id_of_element：

```
$('#rate-<%=Model.EntityId%>').hide();
$('#login-<%=((GigItModel)Model).EntityId%>').show(); 
```

# java - java中的语音识别

> ID：769523
> 
> 赞同：5
> 
> 时间：2009-04-20T18:29:51.127
> 
> 标签：java, speech-recognition, javax.speech

我想在我的项目中使用语音识别，我找到了这段代码，但是当我运行它时，我得到一个错误：

> ```
> run: java.lang.NullPointerException
>         at newpackage.HelloWorld.main(HelloWorld.java:55) 
> ```

请问你们中的一个可以帮我解决这个问题吗？

这是我使用的服务器代码：

```
package newpackage;

import java.util.logging.Level;
import java.util.logging.Logger;
import javax.speech.*;
import javax.speech.recognition.*;
import java.io.FileReader;
import java.util.Locale;

public class HelloWorld extends ResultAdapter {
  static Recognizer rec;

  // Receives RESULT_ACCEPTED event: print it, clean up, exit
  public void resultAccepted(ResultEvent e) {
    Result r = (Result)(e.getSource());
    ResultToken tokens[] = r.getBestTokens();

    for (int i = 0; i < tokens.length; i++)
      System.out.print(tokens[i].getSpokenText() + " ");

    System.out.println();
    try {
          // Deallocate the recognizer and exit
          rec.deallocate();
    } catch (EngineException ex) {
          Logger.getLogger(HelloWorld.class.getName()).log(Level.SEVERE, null, ex);
    } catch (EngineStateError ex) {
          Logger.getLogger(HelloWorld.class.getName()).log(Level.SEVERE, null, ex);
    }
    System.exit(0);
  }

  public static void main(String args[]) {
    try {
      // Create a recognizer that supports English.
      rec = Central.createRecognizer(
              new EngineModeDesc(Locale.ENGLISH));

      // Start up the recognizer
      rec.allocate();

      // Load the grammar from a file, and enable it
      FileReader reader = new FileReader(args[0]);
      RuleGrammar gram = rec.loadJSGF(reader);

      gram.setEnabled(true);

      // Add the listener to get results
      rec.addResultListener(new HelloWorld());

      // Commit the grammar
      rec.commitChanges();

      // Request focus and start listening
      rec.requestFocus();
      rec.resume();
    } catch (Exception e) {
      e.printStackTrace();
          // System.out.println("the problem");
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-10-28T20:18:32.813

重写

```
// Create a recognizer that supports English.
      rec = Central.createRecognizer(
              new EngineModeDesc(Locale.ENGLISH)); 
```

如下

```
 SynthesizerModeDesc desc = new SynthesizerModeDesc(
            null,          // engine name
            "general",     // mode name
            Locale.US,     // locale
            null,          // running
            null);         // voice

     synth = Central.createSynthesizer(desc); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T18:40:57.073

```
if (rec != null) {
    System.out.println(rec);
}
else {
    System.out.println("rec is null");   
    // <-- here's your problem.  you need to return, exit, or throw here!
}

// Start up the recognizer
rec.allocate();  // <-- This is the line that's blowing out (I assume) 
```

您将获得一个空指针，因为即使您的 else 正在处理`rec`null 时的情况，您的程序也会继续。你需要返回或退出，或者什么时候`rec`是空的。

**注意：**另外，我重新格式化了您的代码，因为很难阅读您的 if/else。如果您要在 if/else 的一个分支上使用 curlies，则应该在两个分支上都使用 curlies。它使它更具可读性。

**编辑：**哦，是的，至于为什么`createRecognizer`要返回`null`，恐怕我不知道。

# tfs - 如何在 TFS 2008 中将工作项从 1 个分支合并到另一个分支

> ID：769527
> 
> 赞同：1
> 
> 时间：2009-04-20T18:31:38.313
> 
> 标签：tfs, merge

我似乎找不到一个简单的方法来做到这一点。

我们有一个主干，其中有一组特定的变更集签入到 TFS 中的工作项中。我想专门将此工作项中的变更集合并到另一个分支中。

这肯定不难吧？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-23T01:03:03.957

TFS 绝对支持樱桃采摘。但是，您选择的变更集范围必须是连续的。如果您需要合并一组包含“间隙”的变更集，则需要多次运行 Merge。如果合并操作最终涉及相同的文件，您可能需要在合并之间进行签入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T18:49:53.667

您应该能够通过简单地选择所需的变更集在正常合并中执行此操作。

1.  在 VS 中打开源代码管理资源管理器窗口
2.  右键单击树干（创建原始分支的文件夹）
3.  选择合并
4.  从下拉列表中选择要合并到的目标分支（如果没有出现，那么您可能选择了错误的源目录）
5.  选择“选定的变更集”选项
6.  点击下一步
7.  选择要合并的变更集

我不确定是否有办法从工作项本身做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T09:51:17.340

这可能非常困难，因为 afaik tfs 不支持有时称为“cherrypicking”的东西，即将一些原本不相关的变更集合并到一个分支中。Tfs 希望您将整个分支合并到某个版本，而不会留下任何更改集。恐怕你问的不是直接可能的。

您可以手动完成，但对于大量变更集，这将是痛苦的。工作项中的“链接”选项卡包含与工作项关联的所有变更集 ID - 这可以为您提供一些帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T23:37:32.623

您可能想查看此工具： [http ://wicreator.codeplex.com/Wiki/View.aspx?title=MergeByWI](http://wicreator.codeplex.com/Wiki/View.aspx?title=MergeByWI)

# c# - 如何在 C# 中将“Keys”枚举值转换为“int”字符？

> ID：769529
> 
> 赞同：9
> 
> 时间：2009-04-20T18:32:03.553
> 
> 标签：c#, winforms, keydown

这似乎应该很容易，但我很难弄清楚这里需要发生什么。

在“KeyDown”事件处理程序中，如果“e.KeyValue”是一个数字，我想将其视为一个数字并将其存储为一个 int。所以，如果我在数字键盘上点击“8”，我不想要“Numpad8”，我想要可以添加或减去的 int 值 8 等等。

那么，如何将 KeyValue 转换为 int？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-20T18:43:15.320

我会选择这个解决方案：

```
int value = -1;
if (e.KeyValue >= ((int) Keys.NumPad0) && e.KeyValue <= ((int) Keys.NumPad9)) { // numpad
    value = e.KeyValue - ((int) Keys.NumPad0);
} else if (e.KeyValue >= ((int) Keys.D0) && e.KeyValue <= ((int) Keys.D9)) { // regular numbers
    value = e.KeyValue - ((int) Keys.D0);
} 
```

...如果关键是要获取被打入的他们键的标签的数值。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T18:48:08.197

像这样的东西应该很好用：（已编辑）

```
int keyVal = (int)e.KeyValue;
int value = -1;
if ((keyVal >= (int)Keys.D0 && keyVal <= (int)Keys.D9)
{
    value = (int)e.KeyValue - (int)Keys.D0;
}
else if (keyVal >= (int)Keys.NumPad0 && keyVal <= (int)Keys.NumPad9)
{
    value = (int)e.KeyValue - (int)Keys.NumPad0;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-20T21:20:39.467

事实：键盘有键。有些键代表数字，有些不代表。

问题（改写）：如果键表示数字，则产生由键表示的数值。

为了解决这个问题，有必要知道哪些键（在所有键的集合中）代表数字以及每个（数字）键代表的确切数值。

据我所知，没有一种简单的方法可以从框架中获得这样的映射。

注意： D0-D9 和 NumPad0-NamPad9 在 Keys 枚举中是连续的这一事实是偶然的，依赖这些值按顺序排序是没有根据的。

所以解决方案是：

1.  确定给定的键是否代表一个数字。
2.  如果 key 表示数字，则返回 key 的数值。

* * *

```
private static readonly IDictionary<Keys, int> NumericKeys = 
    new Dictionary<Keys, int> {
        { Keys.D0, 0 },
        { Keys.D1, 1 },
        { Keys.D2, 2 },
        { Keys.D3, 3 },
        { Keys.D4, 4 },
        { Keys.D5, 5 },
        { Keys.D6, 6 },
        { Keys.D7, 7 },
        { Keys.D8, 8 },
        { Keys.D9, 9 },
        { Keys.NumPad0, 0 },
        { Keys.NumPad1, 1 },
        { Keys.NumPad2, 2 },
        { Keys.NumPad3, 3 },
        { Keys.NumPad4, 4 },
        { Keys.NumPad5, 5 },
        { Keys.NumPad6, 6 },
        { Keys.NumPad7, 7 },
        { Keys.NumPad8, 8 },
        { Keys.NumPad9, 9 }
   };

private int? GetKeyNumericValue(KeyEventArgs e) {
    if (NumericKeys.ContainsKey(e.KeyCode)) return NumericKeys[e.KeyCode];
    else return null;
} 
```

可以说，这不是最简单的解决方案，而是对解决方案进行密切建模的解决方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T18:43:11.390

如果您想要 NUMERIC 值，则必须创建一个`switch(e.KeyCode)`语句并评估键并创建您自己的 int。没有简单的方法可以将 a`Keys`转换为代表键上数字的数值。您可以获得的最接近的可能是 ASCII 等价物，但仍需要翻译。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-20T18:34:23.237

根据您要跟踪的键的数量，最简单的方法是让您创建一个选择案例（或者我猜是 C# 中的 switch 语句？），它将检查您的 keydown 的值并根据该值分配一个值一个合适的整数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T18:43:53.917

你可以只听这个`KeyPress`事件吗？它将给出实际按下的字符。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T18:47:02.253

此功能将执行您想要的操作：

```
private int GetKeyValue(int keyValue)
{
    if (keyValue >= 48 && keyValue <= 57)
    {
        return keyValue - 48;
    }
    else if (keyValue >= 96 && keyValue <= 105)
    {
        return keyValue - 96;
    }
    else
    {
        return -1; // Not a number... do whatever...
    }
} 
```

像这样称呼它：

```
private void Form1_KeyDown(object sender, KeyEventArgs e)
{
    int num = GetKeyValue(e.KeyValue);  
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T18:46:39.370

KeyValue 表示被按下的键的字符代码。为了获得它的数值，您应该找到所按下键的字符，然后将其从字符解析为整数。

类似 Convert.ToInt32(e.KeyCode.ToString())

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-20T18:59:55.127

或者创建一个扩展方法并像这样调用它

```
private void Form1_KeyDown(object sender, KeyEventArgs e)
{    
    int num = e.KeyValue.GetKeyValue();  
} 
```

扩展方法在哪里

```
public static class MyExtensions
{
    public static int GetKeyValue(this int keyValue)
    {

        if (keyValue >= 48 && keyValue <= 57)
        {
            return keyValue - 48;
        }
        else if (keyValue >= 96 && keyValue <= 105)
        {
            return keyValue - 96;
        }
        else
        {
            return -1; // Not a number... do whatever...    }

        }
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-10-17T14:54:33.513

我使用了这 2 行简单的代码：

```
string key = e.KeyCode.ToString();

if (key.Length > 1) key = key.Replace("NumPad", "").Replace("D", ""); 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-04-20T18:35:36.917

int i = (int)e.KeyValue;

# java - Java：使用 WritableRaster.setRect 叠加图像？

> ID：769531
> 
> 赞同：0
> 
> 时间：2009-04-20T18:33:01.697
> 
> 标签：java, image, image-manipulation, raster

我一直在使用 Java 中的一些成像功能，试图将一张图像叠加在另一张图像上。像这样：

```
BufferedImage background = javax.imageio.ImageIO.read(
    new ByteArrayInputStream(getDataFromUrl(
        "https://www.google.com/intl/en_ALL/images/logo.gif"
    ))
);
BufferedImage foreground = javax.imageio.ImageIO.read(
    new ByteArrayInputStream(getDataFromUrl(
        "https://upload.wikimedia.org/wikipedia/commons/e/e2/Sunflower_as_gif_small.gif"
    ))
);

WritableRaster backgroundRaster = background.getRaster();
Raster foregroundRaster = foreground.getRaster();

backgroundRaster.setRect(foregroundRaster); 
```

基本上，我试图在此叠加： [https](https://upload.wikimedia.org/wikipedia/commons/e/e2/Sunflower_as_gif_small.gif)
![花](https://upload.wikimedia.org/wikipedia/commons/e/e2/Sunflower_as_gif_small.gif)
://upload.wikimedia.org/wikipedia/commons/e/e2/Sunflower_as_gif_small.gif：https : [//www.google.com/intl/en_ALL/images/logo .gif](https://www.google.com/intl/en_ALL/images/logo.gif)
![替代文字](https://www.google.com/intl/en_ALL/images/logo.gif)

产品显示为：http: [//imgur.com/xnpfp.png](https://imgur.com/xnpfp.png)
![蹩脚的形象](https://imgur.com/xnpfp.png)

从我看到的例子来看，这似乎是合适的方法。我错过了一步吗？有没有更好的方法来处理这个？谢谢你的回复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T02:30:43.427

似乎我以所有错误的方式来解决这个问题。[Sun 论坛上](http://forums.sun.com/thread.jspa?threadID=5129834&tstart=0)概述的这个解决方案非常有效（复制到这里）：

```
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.*;
import javax.imageio.ImageIO;
import javax.swing.*;

class TwoBecomeOne {
    public static void main(String[] args) throws IOException {
        BufferedImage large = ImageIO.read(new File("images/tiger.jpg"));
        BufferedImage small = ImageIO.read(new File("images/bclynx.jpg"));
        int w = large.getWidth();
        int h = large.getHeight();
        int type = BufferedImage.TYPE_INT_RGB;
        BufferedImage image = new BufferedImage(w, h, type);
        Graphics2D g2 = image.createGraphics();
        g2.drawImage(large, 0, 0, null);
        g2.drawImage(small, 10, 10, null);
        g2.dispose();
        ImageIO.write(image, "jpg", new File("twoInOne.jpg"));
        JOptionPane.showMessageDialog(null, new ImageIcon(image), "",
                                      JOptionPane.PLAIN_MESSAGE);
    }
} 
```

# java - Android MANIFEST.MF 等效项

> ID：769533
> 
> 赞同：4
> 
> 时间：2009-04-20T18:33:23.053
> 
> 标签：java, android, properties

在*普通*JVM 上，您可以使用`META-INF/MANIFEST.MF`来声明应用程序属性，`J2ME`您可以使用`.jad`-Files 但在 Android 上可以做什么？

我需要一种方法来声明我可以`System.getProperties()`在 Android 上使用的属性。如果我可以使用与`MANIFEST.MF`-like 属性文件相同的文件格式，那将是最好的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T18:47:58.603

看起来[资源](http://developer.android.com/guide/topics/resources/available-resources.html)会做你需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T20:48:18.390

我通常将它们放在（例如）“res/values/props.xml”中，您的构建脚本可以获取它们，然后您只需要调用：activityName.getString(R.props.propertyName); 将值作为字符串提取。

# python - Python 模块的动态加载

> ID：769534
> 
> 赞同：4
> 
> 时间：2009-04-20T18:34:04.737
> 
> 标签：python, dynamic, module, loading

我正在尝试动态加载我创建的模块。

现在这可以正常工作：

```
import structures.index 
```

但是如果我通过动态导入来尝试同样的事情，它就会失败。

```
struct = __import__("structures.index") 
```

提供的错误是：

```
Error ('No module named structures.index',) 
```

任何想法为什么？

* * *

编辑：使用完整范围时（它有点工作？）：

```
struct = __import__("neoform.structures.index") 
```

这不会引发任何错误，但是，它没有加载索引模块，而是加载了“neoform”模块。

“结构”的结果是：

```
<module 'neoform' from '/neoform/__init__.py'> 
```

另外，作为一个附带问题，我怎样才能在动态加载的模块中实例化一个类？（假设所有模块都包含一个公共类名）。

编辑：解决方案：（感谢 coonj 和 Rick）这最终是有效的。不知道为什么（还），但`fromlist`必须是“显然是任何东西，因为当我将字母“a”作为值时它起作用（奇怪，因为文件中只有 1 个类）。

```
def get_struct_module(self, name):
    try:
        return = __import__("neoform.structures." + name, fromlist='*')
    except ImportError, e:
        self.out.add("Could not load struct: neoform.structure." + name + "\n\n" + "Error " + str(e.args)) 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-20T18:50:01.530

我不确定“它失败”是什么意思，所以我只提一下它`__import__('structures.index')`实际上应该可以工作，但它不会在当前范围内分配模块名称。为此（然后在动态导入的模块中使用一个类），您必须使用：

```
structures = __import__('structures.index')
structures.index.SomeClass(...) 
```

完整的详细信息`__import__`可[在此处](http://docs.python.org/library/functions.html#__import__)获得。

**编辑：（基于问题编辑）**

要导入`neoform.structures.index`并返回`index`模块，您将执行以下操作：

```
structures = __import__('neoform.structures.index', 
                        fromlist=['does not in fact matter what goes here!']) 
```

因此，如果您有一个包名称列表，您可以使用以下代码`packages`导入它们的`index`模块并为每个模块实例化一些类：`MyClass`

```
modules = [ __import__('neoform.%s.index' % pkg, fromlist=['a']) 
            for pkg in packages ]
objects = [ m.MyClass() for m in modules ] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T18:52:45.377

要导入子模块，您需要在 Fo 示例的`fromlist`arg 中指定它们`__import__()`
，相当于：

```
import structures.index 
```

是：

```
structures = __import__('structures', fromlist=['index']) 
```

在地图中做到这一点有点棘手......

```
import mod1.index
import mod2.index
import mod3.index 
```

对于这些导入，您需要定义一个新函数来`index`从每个模块中获取子模块：

```
def getIndexMods(mod_names):
  mod_list = map(lambda x: __import__(x, fromlist='index'))
  index_mods = [mod.index for mod in mod_list]
  return index_mods 
```

现在，您可以这样做来获取对所有索引模块的引用：

```
index_mods = getIndexMods(['mod1', 'mod2', 'mod3']) 
```

此外，如果您想获取未命名为“索引”的子模块，那么您可以这样做：

```
mod1, mod2, mod3 = map(lambda x,y: __import__(x, fromlist=y), 
  ['mod1', 'mod2', 'mod3'], ['index1', 'index2', 'index3']) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T21:23:16.793

使用此辅助方法使用完整范围（“neoform.structures.index”）。

```
def import_module(name):
    mod = __import__(name)
    components = name.split('.')
    for comp in components[1:]:
        mod = getattr(mod, comp)
    return mod

module = import_module("neoform.structures.index")
# do stuff with module 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T18:41:13.563

Java 程序员在这里，但我认为你需要[imp 模块](http://docs.python.org/library/imp.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-22T13:21:44.750

```
>>> import imp
>>> fm = imp.find_module('index', ['./structures']) # for submodule
>>> mymod = imp.load_module('structures.index', *fm)
>>> mymod
<module 'structures.index' from './structures/index.pyc'>
>>> x = mymod.insideIndex()
Initialising index class... 
```

瞧！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T19:23:19.127

你到底为什么要换

```
import structures.index 
```

和

```
map(__import__, ["structures.index"]) 
```

第一个（a）有效，（b）*是*动态的，（c）是直接支持的。有什么可能的用例可以用更复杂的东西替换易于更改的纯文本源？

简而言之：不要这样做。它没有任何价值。

* * *

**编辑**

“我正在从数据库中获取导入”是一项崇高的努力，但仍然不明智。哪些代码块取决于这些导入？整个代码块——导入和所有——就是你想要执行的。整个代码块——导入、语句和所有东西——应该是一个普通的旧 python 模块文件。

从文件系统中导入该代码块。使用数据库来识别哪个文件，文件的作者——任何你想使用数据库的东西。但只需以最简单的方式导入并执行模块。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-15T02:00:00.733

真的很晚才在这里发帖。但我在谷歌上搜索这个问题。我做了一些试验和错误。不确定此代码段是否有帮助，但在这里。将其用于 Flask 站点。

```
modules = ['frontend', 'admin']
for module in modules:
    mod = __init__('controllers.%s' % module, fromlist=[module])
    app.register_blueprint(mod.blueprint_mod)

# or
from importlib import import_module
modules = ['frontend', 'admin']
for module in modules:
    mod = import_module('controllers.%s' % module)
    app.regitster_blueprint(mod.blueprint_mod) 
```

# .net - 从托管代码挂钩 LoadLibrary 调用

> ID：769537
> 
> 赞同：4
> 
> 时间：2009-04-20T18:34:33.750
> 
> 标签：.net, c++, loadlibrary

我们想挂接对 LoadLibrary 的调用，以下载未找到的程序集。我们有一个处理托管程序集的 ResolveAssembly 处理程序，但我们还需要处理非托管程序集。

我们试图通过“Microsoft Windows 编程应用程序”中指定的技术重写导入表来挂钩 LoadLibrary 调用，但是当我们调用 WriteProcessMemory() 时，我们得到一个权限被拒绝错误 (998)。（是的，我们正在使用提升的权限运行）

有没有人在加载 CLR 时成功地重写了导入表？谁能指出我正确的方向？

**更新：**我们解决了权限被拒绝的问题，但现在当我们迭代混合程序集（托管 + 非托管）的导入表时，我们找到的唯一条目是 mscoree.dll。有谁知道如何找到本地进口？（*我们在 C++/CLI 中工作*）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-21T02:31:21.000

我已经成功地从托管代码中挂钩。但是，我通过将非托管 DLL 注入远程进程并让它重写 DllMain 中的导入表来做到这一点。您可能需要考虑这种方法。

这是我的挂钩功能：

```
//structure of a function to hook
struct HookedFunction {
public:
    LPTSTR moduleName;
    LPTSTR functionName;
    LPVOID newfunc;
    LPVOID* oldfunc;
};

BOOL Hook(HMODULE Module, struct HookedFunction Function) {
    //parse dos header
    IMAGE_DOS_HEADER* dos_header = (IMAGE_DOS_HEADER*)Module;
    if (dos_header->e_magic != IMAGE_DOS_SIGNATURE) return 0; //not a dos program

    //parse nt header
    IMAGE_NT_HEADERS* nt_header = (IMAGE_NT_HEADERS*)(dos_header->e_lfanew + (SIZE_T)Module);
    if (nt_header->Signature != IMAGE_NT_SIGNATURE) return 0; //not a windows program

    //optional header (pretty much not optional)
    IMAGE_OPTIONAL_HEADER optional_header = nt_header->OptionalHeader;
    if (optional_header.Magic != IMAGE_NT_OPTIONAL_HDR32_MAGIC) return 0; //no optional header

    IMAGE_IMPORT_DESCRIPTOR* idt_address = (IMAGE_IMPORT_DESCRIPTOR*)(optional_header.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].VirtualAddress + (SIZE_T)Module);
    if (!optional_header.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT].Size) return 0; //no import table

    //enumerate the import dlls
    BOOL hooked = false;
    for(IMAGE_IMPORT_DESCRIPTOR* i = idt_address; i->Name != NULL; i++)
        //check the import filename
        if (!_stricmp(Function.moduleName, (char*)(i->Name + (SIZE_T)Module)))
            //enumerate imported functions for this dll
            for (int j = 0; *(j + (LPVOID*)(i->FirstThunk + (SIZE_T)Module)) != NULL; j++)
                //check if the function matches the function we are looking for
                if (!_stricmp(Function.functionName, (char*)(*(j + (SIZE_T*)(i->OriginalFirstThunk + (SIZE_T)Module)) + (SIZE_T)Module + 2) )) {
                    //replace the function
                    LPVOID* memloc = j + (LPVOID*)(i->FirstThunk + (SIZE_T)Module);
                    if (*memloc != Function.newfunc) { //not already hooked
                        DWORD oldrights;
                        DWORD newrights = PAGE_READWRITE;
                        VirtualProtect(memloc, sizeof(LPVOID), newrights, &oldrights);
                        if (Function.oldfunc && !*Function.oldfunc)
                            *Function.oldfunc = *memloc;
                        *memloc = Function.newfunc;
                        VirtualProtect(memloc, sizeof(LPVOID), oldrights, &newrights);
                    }
                    hooked = true;
                }

    return hooked;
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-20T20:02:53.400

应该可以，但请尝试使用[detours](http://research.microsoft.com/en-us/projects/detours/)（或免费的[N-CodeHook](http://www.newgre.net/ncodehook)）。
Detours 几乎是检测 Win32 二进制文件的实际方式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T02:14:09.293

**[我们通过在调用 WriteProcessMemory( ) 之前调用 VirtualProtect()](http://msdn.microsoft.com/en-us/library/aa366898(VS.85).aspx)**解决了指定的问题，然后再次调用它以恢复保护级别。这会暂时取消对 IAT 所在内存的只读保护。这对我们很有效，并解决了调用 LoadLibrary() 时的问题。

现在，如果我能弄清楚为什么当非托管程序集链接到库（*而不是静态库*）时不调用 LoadLibrary( )...

顺便说一句，Detour 和[N-Code Hook](http://www.newgre.net/ncodehook)看起来都是不错的产品，很可能是我应该采用的方式，但如果可能的话，我想避免添加第 3 方程序集。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T22:18:45.350

最好的方法是挂钩 LoadLibrary/LoadLibraryEx，在需要时进行下载，然后将下载的文件传递到链中。但是，我担心在下载过程中会阻止 GUI。

# iphone - UITableView - 如何识别取消选择？

> ID：769546
> 
> 赞同：0
> 
> 时间：2009-04-20T18:36:09.893
> 
> 标签：iphone, cocoa-touch

在我的应用程序中，当我的表格视图中没有选择行时，我希望某些按钮处于非活动状态。有一个方法 didSelectRowAtIndexPath，它告诉我何时选择了一行。有没有办法知道一行是否被取消选择？

先感谢您。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T18:57:03.993

中调用`deselectRowAtIndexPath:animated:`了一个方法`UITableView`。您必须在自定义类中覆盖它才能对取消选择做出反应。

见这篇[文章](http://developer.apple.com/iphone/library/documentation/UserExperience/Conceptual/TableView_iPhone/ManageSelections/ManageSelections.html#//apple_ref/doc/uid/TP40007451-CH9)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-02T19:27:43.250

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{
    if (thisCell.accessoryType == UITableViewCellAccessoryNone) {
        thisCell.accessoryType = UITableViewCellAccessoryCheckmark;
        cout << "selected Row: " << selectedRow << endl;
    } else {
        thisCell.accessoryType = UITableViewCellAccessoryNone;
        cout << "deselected Row: " << selectedRow << endl;

    }
} 
```

是一种以可视化和编程方式显示它的方式。

# c - 为什么我的系统调用的“cat”函数比 Linux 的“cat”慢？

> ID：769550
> 
> 赞同：12
> 
> 时间：2009-04-20T18:37:28.550
> 
> 标签：c, linux, system-calls, cat

我已经在 C 中使用系统调用（打开、读取和写入）来模拟 Linux 系统中的“cat”函数，它比真实的要慢...

我使用与真正的“cat”相同的缓冲区大小，并使用“strace”，我认为它进行了相同数量的系统调用。但是我的“猫”的输出比真正的“猫”要慢一点。

这是我的代码：

```
#define BUFSIZ 32768

int sysWriteBuffer(int fdout, char *buffer, ssize_t readBytes) {
    ssize_t writtenBytes = 0;

    while(writtenBytes < readBytes) {
        writtenBytes += write(fdout,
            buffer + writtenBytes, readBytes - writtenBytes);
        if(writtenBytes == -1) {
            return -1;
        }
    }

    return 0;
}

int catPrint(int fdin, int fdout) {
    char buffer[BUFSIZ];
    ssize_t readBytes;

    do {
        readBytes = read(fdin, buffer, BUFSIZ);

        if(readBytes == -1) {
            return -1;
        }

        if(sysWriteBuffer(fdout, buffer, readBytes) == -1) {
            return -1;
        }
    } while(readBytes > 0);

    return 0;
} 
```

我正在从文件中读取（我将其作为参数传递给 main，我认为这里不需要代码），而不是使用该文件描述符调用 catPrint() 函数，输出描述符为 1，因此它打印到标准输出。

我不明白为什么它会变慢，因为我使用相同的文件进行测试，并且两者（真正的“猫”和我的）只有一个 read() 和一个 write() 用于整个文本。整个文本不应该只出现在屏幕上吗？

PS：我已将此标记为作业，尽管我在这里的问题（为什么它变慢）不是作业的一部分。我只需要使用系统调用创建一个“cat”类型的函数，就完成了。我只是对我的代码有点慢很感兴趣。

**用我的愚蠢解决的问题：**
我刚决定在同一个文件上调用 linux 的原始 cat 几次，一个接一个，我只是意识到它在我调用它的某些时候也很慢，就像我的一样慢自己的。我想一切都比...

很抱歉像这些人一样浪费你的时间。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-20T19:38:33.737

啊，根据您的编辑，您被预读缓冲区咬住了。您不能通过运行一次来​​测试两个并排读取文件的程序。由于文件在磁盘上，第一个总是较慢，一旦文件在内存中，第二个将运行得更快，您必须为每个创建新数据或运行一个然后运行两个，这样它们都可以获得预读缓冲区的好处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T19:10:10.140

研究 mmap(2)。

您将丢弃 ftell/fread 的细节，但如果读取吞吐量真的很重要，它将跳过一层间接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T18:44:16.443

也许您在没有优化的情况下编译（或没有那么高的优化设置）？

此外，您的代码将调用`sysWriteBuffer`一次`readBytes`等于零 - 也许（部分）解释它？

您还可以内联 sysWriteBuffer（通过编译器开关或手动）。

[“内联”](http://en.wikipedia.org/wiki/Inline_function)意味着将函数的主体复制到其调用站点，以消除调用函数的开销。有时编译器会自动执行此操作（我认为 -O3 在 gcc 中启用了此优化）。您还可以使用[gcc](http://www.greenend.org.uk/rjk/2003/03/inline.html)`inline`中的关键字来告诉编译器内联函数。如果这样做，您的声明将如下所示：

```
static inline int sysWriteBuffer(int fdout, char *buffer, ssize_t readBytes) {
.... 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T19:24:08.873

不比较源代码，很难说。如果您将您的 cat 与 GNU cat 进行比较，请记住，您是在将几小时/几天前的代码与发展了 20 多年的代码进行比较。

您可能想要进行更全面的性能分析，以不同的输入大小、从不同的设备（RAM 磁盘会很好）并连续多次运行这两个程序。您必须尝试确定程序中的 WHERE 速度较慢。

由于 cat 本身确实微不足道（并且您在评论中说您已经在优化编译），我敢打赌您观察到的性能影响不是在实际算法中，而是在程序加载时间上。如果系统二进制文件是[预链接](http://en.wikipedia.org/wiki/Prelink)的（这在当今大多数发行版中很常见），您会发现它的加载速度比您自己编译的任何程序都快（直到您包含程序预链接）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T18:52:03.380

你比较`strace`过两者吗？您可能会尝试使用该`-tt`参数，以便获得系统调用的时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T18:41:33.530

多少钱？典型的猫是这样的

```
char bufr[BUFSIZ];
ssize_t len;

while((len=read(fdin, bufr, BUFSIZ)) >0)
     write(fdout, bufr, len); 
```

这节省了一些指令。

# winapi - 同一个 DLL 在一个进程中加载 了两次

> ID：769552
> 
> 赞同：5
> 
> 时间：2009-04-20T18:38:10.607
> 
> 标签：winapi, com, activex

我有一个 ActiveX 控件 (foo.dll)，当我在 IE 中嵌入它并启动页面时。我可以看到进程资源管理器显示了从同一位置加载的 foo.dll 的两个实例。

这会导致 DLL_PROCESS_ATTACH 被调用两次，并且全局数据结构被初始化两次。

有没有办法解决这个问题？Windows 加载程序是如何工作的？

谢谢，维卢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T18:54:40.583

`DLL_PROCESS_ATTACH`每个 DLL 实例只能调用一次。. . DLL 是否在相同的基地址加载，即 DllMain 中的 HINSTANCE 是否相同？它们是从完全相同的路径加载的吗？不同的路径导致不同的加载模块。是否在两个负载之间卸载？你确定你看到`DLL_PROCESS_ATTACH`而不是`DLL_THREAD_ATTACH`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T22:09:21.660

[LoadLibraryEx](http://msdn.microsoft.com/en-us/library/ms684179(VS.85).aspx)包含如何处理 dll 的额外标志。我怀疑这就是你看到它不止一次出现的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T18:46:18.887

每当进程加载 DLL 时，都会调用 DLL_PROCESS_ATTACH。

使用计数器来确定附加了多少进程，并且仅在第一个附加时进行初始化。

您还需要设置一些东西以在 DLL 实例之间[共享内存](http://www.codeproject.com/KB/DLL/Share_memory_throuth_DLL.aspx)，并将计数器存储在其中，以及您只想初始化一次的全局内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T18:42:17.757

一种解决方法是使用单例初始化函数来保护您的全局数据。

你到底有多少个全球结构？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-11T13:23:23.253

我不确定，但我认为观察可以解释为您引用的 dll 正在实例化定义为 STA（单线程单元）的 COM（ActiveX）对象。任何引用 STA com 对象的 .Net dll 都会为使用这些 COM 对象的每个线程在内存中加载一个新图像。至少这是看起来发生在我们身上的行为。

# tar - 带有 tar 的错误代码 141

> ID：769564
> 
> 赞同：9
> 
> 时间：2009-04-20T18:41:00.770
> 
> 标签：tar, error-code

tar -xvzf $文件名.tar.gz || { 退出 $?; }

在这里，我的脚本会以 errorCode 141 退出。我正在使用 Fedora Core 6 和 tar 版本 1.15

它不会一直发生，但超过 70% 的时间会失败。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2013-08-13T21:09:21.463

我意识到这个帖子已经有几年的历史了，但我正在为那些偶然发现这个帖子并出现错误的人发表评论。

每当您使用压缩选项时， tar 都会使用管道隐式打开与底层程序的连接。因此，在 OP 的示例中：`tar -xvzf $filename.tar.gz`， tar 实际上会运行类似于以下内容的内容：`gunzip $filename.tar.gz | tar -xv -`。您可以通过运行来验证这一点`top`，您将在其中看到两个进程（一个用于 tar，一个用于 gzip）。

但有时，管道本身会中断。例如，如果文件不是 gzip 文件。以此为例： `tar -xvzf somefile.iso`，这将等同于`gunzip somefile.iso | tar -xv -`。在这种情况下，gzip 会出错。当 gzip 出错时，管道将中断。另一种可能性是 gzip 文件是否正确，但其中的 tar 文件已损坏。在这种情况下，gzip 开始将未压缩的流发送到 tar，但随后 tar 意识到有问题并关闭了流。然后这里的 gzip 会出错，因为它的输出已关闭。

在退出值中，高于 128 的值表示因信号而终止，高于 128 的值表示是哪个信号导致终止。因此，如果我们从 OP 的退出代码 141 中减去 128，我们得到 13，它对应于 SIGPIPE（`man 7 signal`对于标准信号及其相应整数值的列表）。

手册页将 SIGPIPE 的评论列为“Broken pipe: write to pipe without reader”。因此，看起来 gzip 正在尝试写入管道，但 tar 已停止侦听。我的猜测是 gzip 正在成功解压缩文件，但未压缩的流不是有效的 tar 存档。我的建议是在文件上运行 gunzip，然后在结果文件上运行 tar 并查看哪个失败（基于 SIGPIPE，我的猜测是 tar 会失败）。在任何一种情况下，这些版本的工具似乎都无法读取该文件（损坏或某种版本冲突）。

这些文件是如何制作的（tar 的哪些选项等）？它们是在这台机器上还是在另一台机器上创建的？如果您在这台机器上创建一个 .tar.gz 文件，这台机器可以在没有错误的情况下提取这些文件吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T18:48:16.963

GNU tar 只返回一些东西，它们都不是 -141。但是，如果它正在运行一个子进程，例如 gzip，并且该进程异常终止，它会返回*该*返回码。

我不确定子进程可能是什么。尝试一下，`--verbose`看看是否有任何线索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T09:06:29.233

作为一种解决方法，我们现在使用 cpio 进行归档，这对我们来说现在很好，尽管我想知道为什么 tar 会导致这个问题，它存在很长时间，并且多年来一直被用作标准工具。

# css - IE6显示问题

> ID：769572
> 
> 赞同：1
> 
> 时间：2009-04-20T18:43:13.653
> 
> 标签：css, internet-explorer-6

我有一个显示时间表的网页。时间表在 IE 6 中显示不正确。这是一个 schreenshot：

从网络服务器中删除的屏幕截图

左侧的绿色菜单向左浮动。在 IE6 中，日程表显示在菜单底部的下方。我可以通过在日程表上应用 clear: right 或 clear: both 在现代浏览器中复制问题。但是，我无法弄清楚如何解决 IE6 中的问题。

有什么建议么？如果您想尝试使用 firebug 或类似样式调试工具应用一些样式，该页面就[在这里。](http://www.gtcc.edu/reservation/lawenforcement/Schedule.aspx)

### 编辑

在尝试将白色主要内容区域向左浮动后，我在 IE6 中得到[了这个。](http://www.gtcc.edu/temp/ie6problem_floated_content_left.jpg)在 IE7 中也一样，但不是那么靠右。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T20:21:00.283

在调度表（table.schedule）的选择器上，我注释掉了：

```
width: 100% 
```

这导致了 IE6 中的问题，并且注释掉并没有在其他浏览器中破坏它。现在在所有浏览器中看起来都一样。

感谢您的建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T18:47:01.147

尝试将白色的主要内容部分也向左浮动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T19:22:27.660

前几天有人问了同样的问题，[CSS Floats - content fall down in IE6](https://stackoverflow.com/questions/760211/css-floats-content-falling-down-in-ie6)，

也许那里的一些答案会有所帮助。我注意到你的设计没有页脚，所以理论上你应该能够用绝对和相对定位的布局替换浮动布局

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T19:41:44.713

添加浮动：左；到 table.schedule。这修复了 IE 6 中的间距问题，但会导致 IE7 和 FF 中的问题。我将使用下面的代码仅针对 IE6。

```
*.html table.schedule
{
    float: left;
} 
```

# java - 用于获取 CLOB/BLOB 数据的 jdbc 性能测试

> ID：769581
> 
> 赞同：1
> 
> 时间：2009-04-20T18:44:53.600
> 
> 标签：java, database, jdbc

我正在尝试比较从 BLOB 列中获取数据的不同调用 (getBytes/getBinary/getBlob) 的性能。

我现在正在做的是跟踪通过 jdbc 驱动程序执行语句并遍历结果集的时间。

```
//Mark time
ResultSet resultSet = stmt.executeQuery(query);
resultSet.getBytes(1) // or resultSet.getBinary or resultSet.getBlob
//Mark time again 
```

这是一种非常不准确的处理方式，因为一旦我运行第一个查询，由于数据库引擎的缓存，连续调用往往会更快。

有没有更好的方法来对这些不同的调用进行性能评估？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T19:09:43.057

在每个基准测试运行之间重新启动？<j/k>

老实说，我认为最好的方法是加载一个包含大量 clob/blob 数据的表。即，可能是一个像这样的假表'create table testtable (id integer primary key, testdata blob);'。一旦你加载了几场测试数据（依次增加的 id），让你的程序随机查询（使用 Math.random）并使用它进行比较。

这应该消除大多数与缓存相关的变化，并让您清楚地了解各种 blob 检索方法之间的性能是否真的存在显着差异。

# .net - String.Format 不格式化字符串

> ID：769582
> 
> 赞同：6
> 
> 时间：2009-04-20T18:44:54.037
> 
> 标签：.net, string.format

似乎 String.Format 不会将字符串格式化为输入。我做错了什么，还是这只是本机行为？

输入：0.37

这行不通。

```
string x = String.Format("{0:P}", myString) 
```

输出：0.37

这样做。

```
string x = String.Format("{0:P}", Convert.ToDecimal(myString)) 
```

输出 : 37.00 %

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T18:48:04.623

我相信这是“复合格式”的预期行为。

您的第一个示例是尝试将数字格式规则应用于字符串。您的第二个示例是尝试将数字格式规则应用于可以具有小数位的数字。

有关详细信息，请参阅[MSDN 上的这篇文章](http://msdn.microsoft.com/en-us/library/txafckwd(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T18:48:37.617

您尝试应用的格式选项仅适用于数字。.NET 中没有智能字符串的概念，CLR 在其中检查字符串的类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T18:49:07.600

> 我做错了什么，还是这只是本机行为？

那是原生行为。它基本上不是`Format`解释字符串输入的工作。`Format`假设用户提供了正确的数据——在你的例子中是*数字*数据。字符串不是数字，即使它*表示*一个数字（这是 CS 中值/语义与其表示/语法之间最重要的区别！）。

# sql-server - 在 SQL Server 中编写 sql 语句时，如何从表名中删除 dbo 前缀？

> ID：769589
> 
> 赞同：14
> 
> 时间：2009-04-20T18:46:47.030
> 
> 标签：sql-server

我的模式中的所有表都有一个前缀 dbo。现在在我的 sql 语句中，我不喜欢一直使用 dbo.tablename。任何解决方法或配置更改？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-20T18:56:46.473

其实你应该离开那些dbo。语句，因为您的 SQL 会更快，因为优化器不必查找架构

查看此链接还[查看没有所有者资格的过程调用的性能影响](http://sqlblog.com/blogs/linchi_shea/archive/2007/06/30/performance-impact-of-procedure-calls-without-owner-qualification.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T19:00:26.013

离开dbo实际上是有益的。前缀到位 - 毕竟，在 SQL Server 中，您可以有多个具有相同表名的模式（“dbo.”thingie），例如 dbo.MyTable、joe.MyTable、frank.MyTable。

如果您随后从 MyTable 发出 SELECT（字段列表），SQL Server 必须首先确定您真正指的是哪个“MyTable”表 --> 这需要时间，立即指定您想要“dbo.MyTable”将节省您的时间。

好的，单个查询不是很多 - 但是 SELECT 查询非常频繁，而且所有这些都加起来了！

马克

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-01-24T18:17:16.293

赏金问题并不完全是原始问题。

> 当前的答案不包含足够的细节。
> 
> 没有一个答案实际上解决了如何删除 dbo 前缀或将其更改为其他内容的问题。

`dbo`是架构。您不能从表中删除架构。你可以改变它。有很多例子。这是一个：[如何将表移动到 T-SQL 中的模式中](https://stackoverflow.com/q/1149159/6490059)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-01-26T17:45:21.650

就像这样，如果你所有的表都在 dbo 模式中

```
use mydatabase
go
select * from mytable 
```

如果您有多个数据库，您也可以这样做：

```
select * from mydatabase..mytable 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-03-03T11:22:32.020

不幸的是，如果您想充分利用 Microsoft SQL Server，您需要将其`dbo.`放在很多地方。创建视图时，您可以选择使其成为*模式绑定*视图，这意味着将在编译时检查对象名称，并且只要视图存在，它引用的对象就不能被删除。（您必须先显式删除视图。）如果视图是模式绑定的，它也可以成为索引视图。较新的 MSSQL 版本还支持模式绑定存储过程，这具有其他优势。

如果您愿意，您可以创建除`dbo`. 但是你仍然需要明确地引用对象，`myschema.mytable`而不仅仅是`mytable`.

您还需要`dbo.`用于用户定义的函数。

就个人而言，我想告诉 MSSQL 我不打算使用模式，我对表的单个顶级命名空间（至少在给定数据库中）的经典 SQL 方式非常满意，请你`dbo.`如果没有另外指定，则假设。但是我还没有找到方法。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-20T18:49:50.983

我认为您连接的用户必须属于 dbo 模式，然后您不必输入前缀，它会从用户所属的模式中推断出来。

# javascript - SWFObject 音频播放器在最小化时不播放

> ID：769594
> 
> 赞同：0
> 
> 时间：2009-04-20T18:47:30.617
> 
> 标签：javascript, swfobject

`SWFObject`我的网页上有一个小问题。行为是，当 Flash 播放器被另一个选项卡覆盖或最小化时，它不会开始播放音频，直到选项卡再次获得焦点并可见。它使用`SWFObject`来自[http://code.google.com/p/swfobject/](http://code.google.com/p/swfobject/)的 2.1 版本。为了验证这种行为，加载页面，在 5 秒内将其最小化，您会注意到代码中的代码`beginPlay`更改了页面的标题。这发生在音频应该开始播放之后，但直到浏览器再次获得焦点才会开始。这是复制问题的代码示例：

```
<html> 
<head> 
    <script type="text/javascript" src="swfobject.js"></script> 
    <script type="text/javascript" src="audio-player-uncompressed.js"></script> 
    <script> 
    function doLoad() {
        AudioPlayer.setup("player2.swf", { 
            width: "350px",
            animation: "no",
            autostart: "yes",
            loop: "yes",
            buffer: "5",
            initialvolume: 100,
        }); 
        AudioPlayer.embed("flashPlayer"); 
    }

    function beginPlay(){
        setTimeout(function(){
            AudioPlayer.embed("flashPlayer", {
                soundFile: "test.mp3"
            });
            document.title = "code after the flash player has executed."
        }, 5000);
    }
    </script> 
</head>
<body onload="doLoad();">
  This demonstration is to show how either WP Audio Player or SWFObject
  does not build the flash player while the browser is minimized.
  <br><br>
  <a href="javascript:beginPlay();">click this and minimize quickly.</a><br>
  <div id="flashPlayer"></div>
</body> 
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-17T06:30:25.903

这不是特定于 SWFObject 的问题，通常是由于浏览器对 Flash Player 插件的处理所致；当 Flash 播放器内容被隐藏或离开屏幕时，许多浏览器会终止该进程，然后在 SWF 再次可见时重新初始化它。见[http://pipwerks.com/lab/swfobject/hide-swf/2.0/index.html](http://pipwerks.com/lab/swfobject/hide-swf/2.0/index.html)

除了不隐藏 SWF 之外，我不相信您可以做很多事情。

# authentication - 考虑放弃编写自定义成员和角色提供程序的想法。意见？

> ID：769600
> 
> 赞同：3
> 
> 时间：2009-04-20T18:48:10.847
> 
> 标签：authentication, cookies, authorization, membership, roles

我有一个在 ASP.NET 中构建的 Web 应用程序，它具有以下安全要求：

1.  必须能够与将唯一密钥传回应用程序以指示用户已通过第三方站点登录的主身份验证方案集成。
2.  必须能够使用现有的用户/角色表。
3.  如果用户不是第三方站点的成员，则可以使用表单身份验证并允许用户通过单独的登录页面登录。

我尝试自定义 SQL 角色和成员资格提供程序，但遇到了问题，特别是有一个强类型的 MembershipUser 对象，它有一个 uniqueIdentifier (providerKey) 并且没有空间容纳我自己的自定义键集（有将是两个）识别用户。

我应该放弃我的自定义会员提供程序实施而只使用 cookie/session 吗？我真的很想使用内置功能，但它似乎不可行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T18:52:28.060

您可能想要做的是在现有功能的基础上构建您的项目 1，请先尝试。使用返回的信息，自动登录用户。如果第一个过程失败，使用内置代码进行标准身份验证。

我已经为使用 DotNetNuke 的客户多次在 ASP.NET 成员资格提供程序之上构建了这种类型的系统，它运行良好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T09:05:11.820

我成功地放弃了会员提供者，并且根本不使用它。我创建了一个新的 IMembershipService 接口和一个实现，用于处理我的 Web 应用程序用户的创建和验证。

我已经创建了自己的用户模型。这使我可以在我的应用程序中拥有一个灵活的角色模型。我可以自由地创建上下文域角色并将它们与实际用户模型分离。

这真的没那么难。记得给你的密码加盐等等，并阅读一些安全书籍。

您仍然可以通过这种方法使用 FormsAuthentication。

大多数依赖 asp.net 会员提供程序的系统在某种程度上确实是精神分裂症。您将有 2 个用户表，例如在 CommunityServer 中，您有 aspnet_users 和 cs_Users，其中 cs_Users 引用 aspnet_users 的 MembershipId 并在其中引入另一个 UserId。它还反映了用户名等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T18:54:38.773

去吧，这里是来自 Scott Guthrie 博客[的内置 ASP.NET 2.0 Membership 提供程序的源代码。](http://weblogs.asp.net/scottgu/archive/2006/04/13/442772.aspx)

# .net - 如何使 vb.net 属性仅在特定命名空间内可见？

> ID：769607
> 
> 赞同：0
> 
> 时间：2009-04-20T18:49:34.620
> 
> 标签：.net, vb.net, oop

我在一个命名空间中有一组基类，在其他命名空间中有几组派生类。一个项目中的一切。就像是：

```
Namespace Base
Public Class BaseElement
    Protected Friend Readonly Property SubElements() as BaseElements
End Class
End Namespace
...
Namespace Books
Public Class Book
    Inherits Base.BaseElement
    Public Readonly Property Pages() as Pages
        return MyBase.SubElements
    End Property
End Class
End Namespace 
```

我有多个派生类，并希望它们具有一些易于理解的可见属性，而不是 .SubElements。

好的，可以在 BaseElement 类中将 .SubElements 声明为 Protected。但在这种情况下，我无法从 Base 命名空间中不是从它派生的其他类访问此属性。

我尝试添加 Friend 关键字，但它在我实例化派生类时也使这个属性可见。

那么......在使用派生类时隐藏某些属性同时能够使用基类使用它们的任何方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T18:54:45.043

.NET 没有基于命名空间的可见性修饰符。

您可能会将该命名空间中的所有内容移动到其自己的类库项目中，并将其作为`Friend`成员 - 或者您可以忍受它比您想要的更多的可见性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T18:51:39.467

我相信你想在这种情况下使用接口。

# c# - 实时调试堆栈溢出

> ID：769619
> 
> 赞同：7
> 
> 时间：2009-04-20T18:52:26.640
> 
> 标签：c#, crash, windbg, stack-overflow, sos

我有一个托管代码 Windows 服务应用程序，由于托管 StackOverFlowException，它在生产中偶尔会崩溃。我知道这一点是因为我在崩溃模式下运行了 adplus 并使用 SoS 分析了崩溃转储事后分析。我什至附加了 windbg 调试器并将其设置为“未处理的异常”。

我的问题是，我看不到任何托管堆栈或切换到任何线程。当调试器中断时，它们都被拆除了。

我不是 Windbg 专家，并且没有在实时系统上安装 Visual Studio 或使用该工具进行远程调试和调试，是否有人对我如何从有问题的线程中获取堆栈跟踪有任何建议？

这就是我正在做的事情。

> !线程
> 
> ...
> 
> XXXX 11 27c 000000001b2175f0 b220 已禁用 00000000072c9058:00000000072cad80 0000000019bdd3f0 0 Ukn System.StackOverflowException (0000000000c010d0)
> 
> ...

此时你会看到 XXXX ID 表明线程已经死了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T20:03:52.053

一旦遇到堆栈溢出，调试问题就很不走运了——耗尽堆栈空间会使程序处于不确定状态，因此您不能依赖其中的*任何*信息那一点-您尝试获取的任何堆栈跟踪都可能已损坏，并且很容易将您指向错误的方向。即，一旦发生 StackOverflowException，为时已晚。

此外，根据[文档](http://msdn.microsoft.com/en-us/library/system.stackoverflowexception.aspx)，您无法从 .Net 2.0 开始捕获 StackOverflowException，因此使用 try/catch 围绕您的代码的其他建议可能不起作用。考虑到堆栈溢出的副作用（我很惊讶 .Net 居然允许你捕捉到它），这非常有意义。

您唯一真正的选择是进行乏味的代码分析，寻找可能导致堆栈溢出的任何内容，并放入某种标记，以便您可以在它们发生*之前*了解它们发生的位置。例如，显然任何递归方法都是第一个开始的地方，因此给它们一个深度计数器并在它们达到您定义的某个“不合理”值时**抛出您自己的异常**，这样您实际上可以获得有效的堆栈跟踪。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:18:45.283

`try-catch`是否可以选择使用写入（或文件或其他任何内容）的代码来包装代码并`EventLog`一次性运行此调试？

```
try { ... } catch(SOE) { EventLog.Write(...); throw; } 
```

您将无法调试，但您将获得堆栈跟踪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T19:44:52.757

您可以选择的一种方法是在高级别使用 try/catch 块，然后打印或记录异常提供的堆栈跟踪。每个异常都有一个`StackTrace`属性，可以告诉您它是从哪里引发的。这不会让您进行任何交互式调试，但它应该为您提供一个开始的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T21:33:15.740

对于它的价值，从 .NET 4.0 开始，Visual Studio（以及任何依赖`ICorDebug`api 的调试器）获得了调试小型转储的能力。这意味着您将能够将故障转储加载到另一台计算机上的 VS 调试器中，并查看类似于您在崩溃时附加了调试器的托管堆栈。有关详细信息，请参阅[PDC 演讲](http://channel9.msdn.com/pdc2008/PC49/)或[Rick Byers 的博客](http://blogs.msdn.com/rmbyers/archive/2008/10/26/clr-4-0-advancements-in-diagnostics.aspx)。不幸的是，这不会帮助您解决手头的问题，但也许下次您遇到此问题时会有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-05T05:10:23.970

查看您的 ADPLUS 崩溃模式调试日志。查看在抛出托管 StackOverflowException 之前是否发生任何访问冲突或真正的本机堆栈溢出异常。

我的猜测是线程堆栈上存在一个异常，您在线程退出之前对其进行了冷处理。

您还可以使用 www.iis.net 中的 DebugDiag，然后设置崩溃规则并为访问冲突 (sxe av) 和堆栈溢出本机异常 (sxe sov) 创建完整转储文件

谢谢，亚伦

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-20T13:12:00.783

对于这类事情，我有一个 RecursionChecker 类。我在此声明对以下代码的版权声明。

如果发现自己过于频繁地检查目标对象，它会抱怨。这不是万能的。例如，循环可能会导致误报。可以通过在有风险的代码之后再次调用来避免这种情况，告诉检查器它可以减少对目标对象的递归调用。它仍然不是防弹的。

要使用它，我只需调用

```
public void DangerousMethod() {
  RecursionChecker.Check(someTargetObjectThatWillBeTheSameIfWeReturnHereViaRecursion);
  // recursion-risky code here.
} 
```

这是 RecursionChecker 类：

```
/// <summary>If you use this class frequently from multiple threads, expect a lot of blocking. In that case,
/// might want to make this a non-static class and have an instance per thread.</summary>
public static class RecursionChecker
{
  #if DEBUG
  private static HashSet<ReentrancyInfo> ReentrancyNotes = new HashSet<ReentrancyInfo>();
  private static object LockObject { get; set; } = new object();
  private static void CleanUp(HashSet<ReentrancyInfo> notes) {
    List<ReentrancyInfo> deadOrStale = notes.Where(info => info.IsDeadOrStale()).ToList();
    foreach (ReentrancyInfo killMe in deadOrStale) {
      notes.Remove(killMe);
    }
  }
  #endif
  public static void Check(object target, int maxOK = 10, int staleMilliseconds = 1000)
  {
    #if DEBUG
    lock (LockObject) {
      HashSet<ReentrancyInfo> notes = RecursionChecker.ReentrancyNotes;
      foreach (ReentrancyInfo note in notes) {
        if (note.HandlePotentiallyRentrantCall(target, maxOK)) {
          break;
        }
      }
      ReentrancyInfo newNote = new ReentrancyInfo(target, staleMilliseconds);
      newNote.HandlePotentiallyRentrantCall(target, maxOK);
      RecursionChecker.CleanUp(notes);
      notes.Add(newNote);
    }
    #endif
  }
} 
```

下面的助手类：

```
internal class ReentrancyInfo
{
  public WeakReference<object> ReentrantObject { get; set;}
  public object GetReentrantObject() {
    return this.ReentrantObject?.TryGetTarget();
  }
  public DateTime LastCall { get; set;}
  public int StaleMilliseconds { get; set;}
  public int ReentrancyCount { get; set;}
  public bool IsDeadOrStale() {
    bool r = false;
    if (this.LastCall.MillisecondsBeforeNow() > this.StaleMilliseconds) {
      r = true;
    } else if (this.GetReentrantObject() == null) {
      r = true;
    }
    return r;
  }
  public ReentrancyInfo(object reentrantObject, int staleMilliseconds = 1000)
  {
    this.ReentrantObject = new WeakReference<object>(reentrantObject);
    this.StaleMilliseconds = staleMilliseconds;
    this.LastCall = DateTime.Now;
  }
  public bool HandlePotentiallyRentrantCall(object target, int maxOK) {
    bool r = false;
    object myTarget = this.GetReentrantObject();
    if (target.DoesEqual(myTarget)) {
      DateTime last = this.LastCall;
      int ms = last.MillisecondsBeforeNow();
      if (ms > this.StaleMilliseconds) {
        this.ReentrancyCount = 1;
      }
      else {
        if (this.ReentrancyCount == maxOK) {
          throw new Exception("Probable infinite recursion");
        }
        this.ReentrancyCount++;
      }
    }
    this.LastCall = DateTime.Now;
    return r;
  }
}

public static class DateTimeAdditions
{
  public static int MillisecondsBeforeNow(this DateTime time) {
    DateTime now = DateTime.Now;
    TimeSpan elapsed = now.Subtract(time);
    int r;
    double totalMS = elapsed.TotalMilliseconds;
    if (totalMS > int.MaxValue) {
      r = int.MaxValue;
    } else {
      r = (int)totalMS;
    }
    return r;
  }
}

public static class WeakReferenceAdditions {
  /// <summary> returns null if target is not available. </summary>
  public static TTarget TryGetTarget<TTarget> (this WeakReference<TTarget> reference) where TTarget: class 
  {
    TTarget r = null;
    if (reference != null) {
      reference.TryGetTarget(out r);
    }
    return r;
  }
} 
```

# csv - 处理 CSV 文件中的逗号

> ID：769621
> 
> 赞同：503
> 
> 时间：2009-04-20T18:52:33.037
> 
> 标签：csv

我正在寻找有关如何处理正在创建、然后由我们的客户上传的 csv 文件的建议，该文件的值可能包含逗号，例如公司名称。

我们正在研究的一些想法是：引用标识符（值“，”值“，”等）或使用 | 而不是逗号。最大的问题是我们必须让它变得简单，否则客户不会这样做。

* * *

## 回答 #1

> 赞同：424
> 
> 时间：2009-04-20T19:06:30.103

[实际上有 CSV 格式、 RFC 4180](https://datatracker.ietf.org/doc/html/rfc4180)以及如何处理逗号的规范：

> 包含换行符 (CRLF)、双引号和逗号的字段应该用双引号括起来。

^(http://tools.ietf.org/html/rfc4180)

因此，要具有值`foo`和`bar,baz`，请执行以下操作：

```
foo,"bar,baz" 
```

另一个需要考虑的重要要求（也来自规范）：

> 如果使用双引号将字段括起来，则出现在字段内的双引号必须通过在其前面加上另一个双引号来进行转义。例如：
> 
> ```
> "aaa","b""bb","ccc" 
> ```

* * *

## 回答 #2

> 赞同：235
> 
> 时间：2009-04-20T19:14:23.360

正如其他人所说，您需要转义包含引号的值。这是 C♯ 中的一个小 CSV 阅读器，它支持引用的值，包括嵌入的引号和回车符。

顺便说一句，这是经过单元测试的代码。我现在发布它是因为这个问题似乎出现了很多，而当简单的 CSV 支持就可以完成时，其他人可能不想要整个库。

您可以按如下方式使用它：

```
using System;
public class test
{
    public static void Main()
    {
        using ( CsvReader reader = new CsvReader( "data.csv" ) )
        {
            foreach( string[] values in reader.RowEnumerator )
            {
                Console.WriteLine( "Row {0} has {1} values.", reader.RowIndex, values.Length );
            }
        }
        Console.ReadLine();
    }
} 
```

这是课程。请注意，您也可以使用该`Csv.Escape`函数编写有效的 CSV。

```
using System.IO;
using System.Text.RegularExpressions;

public sealed class CsvReader : System.IDisposable
{
    public CsvReader( string fileName ) : this( new FileStream( fileName, FileMode.Open, FileAccess.Read ) )
    {
    }

    public CsvReader( Stream stream )
    {
        __reader = new StreamReader( stream );
    }

    public System.Collections.IEnumerable RowEnumerator
    {
        get {
            if ( null == __reader )
                throw new System.ApplicationException( "I can't start reading without CSV input." );

            __rowno = 0;
            string sLine;
            string sNextLine;

            while ( null != ( sLine = __reader.ReadLine() ) )
            {
                while ( rexRunOnLine.IsMatch( sLine ) && null != ( sNextLine = __reader.ReadLine() ) )
                    sLine += "\n" + sNextLine;

                __rowno++;
                string[] values = rexCsvSplitter.Split( sLine );

                for ( int i = 0; i < values.Length; i++ )
                    values[i] = Csv.Unescape( values[i] );

                yield return values;
            }

            __reader.Close();
        }
    }

    public long RowIndex { get { return __rowno; } }

    public void Dispose()
    {
        if ( null != __reader ) __reader.Dispose();
    }

    //============================================

    private long __rowno = 0;
    private TextReader __reader;
    private static Regex rexCsvSplitter = new Regex( @",(?=(?:[^""]*""[^""]*"")*(?![^""]*""))" );
    private static Regex rexRunOnLine = new Regex( @"^[^""]*(?:""[^""]*""[^""]*)*""[^""]*$" );
}

public static class Csv
{
    public static string Escape( string s )
    {
        if ( s.Contains( QUOTE ) )
            s = s.Replace( QUOTE, ESCAPED_QUOTE );

        if ( s.IndexOfAny( CHARACTERS_THAT_MUST_BE_QUOTED ) > -1 )
            s = QUOTE + s + QUOTE;

        return s;
    }

    public static string Unescape( string s )
    {
        if ( s.StartsWith( QUOTE ) && s.EndsWith( QUOTE ) )
        {
            s = s.Substring( 1, s.Length - 2 );

            if ( s.Contains( ESCAPED_QUOTE ) )
                s = s.Replace( ESCAPED_QUOTE, QUOTE );
        }

        return s;
    }

    private const string QUOTE = "\"";
    private const string ESCAPED_QUOTE = "\"\"";
    private static char[] CHARACTERS_THAT_MUST_BE_QUOTED = { ',', '"', '\n' };
} 
```

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2009-04-20T19:46:30.270

CSV 格式使用逗号分隔值，包含回车符、换行符、逗号或双引号的值用双引号括起来。包含双引号的值被引用，并且每个文字引号都被紧接在前面的引号转义：例如，3 个值：

```
test
list, of, items
"go" he said 
```

将被编码为：

```
test
"list, of, items"
"""go"" he said" 
```

任何字段都可以被引用，但只有包含逗号、CR/NL 或引号的字段*必须*被引用。

CSV 格式没有真正的*标准*，但几乎所有应用程序都遵循[**此处**](http://www.creativyst.com/Doc/Articles/CSV/CSV01.htm)记录的约定。其他地方提到的 RFC 不是 CSV 的标准，它是在 MIME 中使用 CSV 的 RFC，并且包含一些非常规和不必要的限制，使其在 MIME 之外无用。

我见过的许多 CSV 模块不适应的一个问题是，可以在单个字段中编码多行，这意味着您不能假设每行都是单独的记录，您要么不需要在您的数据或准备好处理这个问题。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2009-04-20T18:53:26.263

在字符串周围加上双引号。这通常[是 Excel 所做](https://web.archive.org/web/20210404114001/http://www.creativyst.com/Doc/Articles/CSV/CSV01.htm)的。

阿拉伊莱，

> 您将双引号转义为两个双引号。例如 "test1","foo""bar","test2"

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-04-20T19:34:14.527

您可以在字段周围加上双引号。我不喜欢这种方法，因为它添加了另一个特殊字符（双引号）。只需定义一个转义字符（通常是反斜杠）并在需要转义的任何地方使用它：

```
数据，更多数据，更多数据\，甚至，还有更多
```

您不必尝试匹配引号，并且要解析的异常更少。这也简化了您的代码。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-09-20T16:34:01.820

通过 nuget 可以使用一个库来处理几乎所有格式良好的 CSV (.net) - [CsvHelper](http://nuget.org/packages/CsvHelper)

**映射到类的示例：**

```
var csv = new CsvReader( textReader );
var records = csv.GetRecords<MyClass>(); 
```

**读取单个字段的示例：**

```
var csv = new CsvReader( textReader );
while( csv.Read() )
{
    var intField = csv.GetField<int>( 0 );
    var stringField = csv.GetField<string>( 1 );
    var boolField = csv.GetField<bool>( "HeaderName" );
} 
```

**让客户端驱动文件格式：**
`,`是标准字段分隔符，`"`是用于转义包含分隔符、引号或行尾的字段的标准值。

使用（例如）`#`字段和`'`转义：

```
var csv = new CsvReader( textReader );
csv.Configuration.Delimiter = "#";
csv.Configuration.Quote = ''';
// read the file however meets your needs 
```

[更多文档](http://joshclose.github.io/CsvHelper/)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-01-24T09:39:19.700

如果您在 * **nix-system**上，可以访问并且仅在 CSV 的***特定字段*****[`sed`](http://www.gnu.org/software/sed/manual/sed.html)**中可能有一个或多个**不需要的逗号***，您可以使用以下单行符将它们包含在`"`RFC4180[部分中2](https://www.rfc-editor.org/rfc/rfc4180#section-2)建议：*

 *```
sed -r 's/([^,]*,[^,]*,[^,]*,)(.*)(,.*,.*)/\1"\2"\3/' inputfile 
```

根据不需要的逗号可能在哪个字段中，您必须更改/扩展正则表达式（和替换）的捕获组。
上面的示例将第四个字段（共六个）括在引号中。

![在此处输入图像描述](https://i.stack.imgur.com/cOxbi.png)

结合-[`--in-place`选项](http://www.gnu.org/software/sed/manual/sed.html#Invoking-sed)，您可以将这些更改直接应用于文件。

为了“构建”正确的正则表达式，需要遵循一个简单的原则：

1.  对于 CSV 中在带有不需要的逗号的字段*之前*出现的每个字段，您编写一个`[^,]*,`并将它们全部放在一个捕获组中。
2.  对于包含您编写的不需要的逗号的字段`(.*)`。
3.  对于带有不需要的逗号的字段*之后*的每个字段，您编写一个`,.*` 并将它们全部放在一个捕获组中。

以下是根据特定字段的不同可能的正则表达式/替换的简短概述。如果未给出，则替换为`\1"\2"\3`.

```
([^,]*)(,.*)                     #first field, regex
"\1"\2                           #first field, substitution

(.*,)([^,]*)                     #last field, regex
\1"\2"                           #last field, substitution

([^,]*,)(.*)(,.*,.*,.*)          #second field (out of five fields)
([^,]*,[^,]*,)(.*)(,.*)          #third field (out of four fields)
([^,]*,[^,]*,[^,]*,)(.*)(,.*,.*) #fourth field (out of six fields) 
```

如果您想删除不需要的逗号`sed`而不是用引号括起来，请参阅[此答案](https://stackoverflow.com/a/21280588/1807643)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-11-29T21:48:57.173

正如我在对 harpo 的回答的评论中提到的那样，他的解决方案很好，并且在大多数情况下都有效，但是在某些情况下，当逗号彼此直接相邻时，它无法在逗号上拆分。

这是因为 Regex 字符串意外地表现为逐字字符串。为了使这种行为正确，正则表达式字符串中的所有 " 字符都需要手动转义，而不使用逐字转义。

IE。正则表达式应该是使用手动转义的：

`",(?=(?:[^\"\"]*\"\"[^\"\"]*\"\")*(?![^\"\"]*\"\"))"`

这转化为`",(?=(?:[^""]*""[^""]*"")*(?![^""]*""))"`

使用 Vertabim 字符串`@",(?=(?:[^""]*""[^""]*"")*(?![^""]*""))"`时，它的行为如下所示，如果您调试正则表达式，则可以看到：

```
",(?=(?:[^"]*"[^"]*")*(?![^"]*"))" 
```

所以总而言之，我推荐 harpo 的解决方案，但要注意这个小问题！

我在 CsvReader 中包含了一些可选的故障保护，以在发生此错误时通知您（如果您有预先知道的列数）：

```
if (_expectedDataLength > 0 && values.Length != _expectedDataLength) 
throw new DataLengthException(string.Format("Expected {0} columns when splitting csv, got {1}", _expectedDataLength, values.Length)); 
```

这可以通过构造函数注入：

```
public CsvReader(string fileName, int expectedDataLength = 0) : this(new FileStream(fileName, FileMode.Open, FileAccess.Read))
{
    _expectedDataLength = expectedDataLength;
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-04-11T19:29:27.420

添加对 Microsoft.VisualBasic 的引用（是的，它说是 VisualBasic，但它也可以在 C# 中工作 - 请记住，最后它只是 IL）。

使用`Microsoft.VisualBasic.FileIO.TextFieldParser`类解析 CSV 文件下面是示例代码：

```
 Dim parser As TextFieldParser = New TextFieldParser("C:\mar0112.csv")
 parser.TextFieldType = FieldType.Delimited
 parser.SetDelimiters(",")      

   While Not parser.EndOfData         
      'Processing row             
      Dim fields() As String = parser.ReadFields         
      For Each field As String In fields             
         'TODO: Process field                   

      Next      
      parser.Close()
   End While 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-09-29T12:38:37.663

您可以使用其他“分隔符”，例如“;” 或“|” 但最简单的可能只是引用大多数（体面的）CSV 库和最体面的电子表格支持的引用。

有关[CSV 分隔符的更多信息以及用于描述分隔符和引用的标准格式规范，请参阅此网页](http://data.okfn.org/standards/csv)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-05-01T17:27:09.640

如果您想重新发明轮子，以下可能对您有用：

```
public static IEnumerable<string> SplitCSV(string line)
{
    var s = new StringBuilder();
    bool escaped = false, inQuotes = false;
    foreach (char c in line)
    {
        if (c == ',' && !inQuotes)
        {
            yield return s.ToString();
            s.Clear();
        }
        else if (c == '\\' && !escaped)
        {
            escaped = true;
        }
        else if (c == '"' && !escaped)
        {
            inQuotes = !inQuotes;
        }
        else
        {
            escaped = false;
            s.Append(c);
        }
    }
    yield return s.ToString();
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2017-05-10T14:03:53.800

在欧洲我们有这个问题一定比这个问题更早。在欧洲，我们使用逗号作为小数点。请参阅下面的数字：

```
| American      | Europe        |
| ------------- | ------------- |
| 0.5           | 0,5           |
| 3.14159265359 | 3,14159265359 |
| 17.54         | 17,54         |
| 175,186.15    | 175.186,15    | 
```

因此无法对 CSV 文件使用逗号分隔符。因此，欧洲的 CSV 文件用分号*( `;`)*分隔。

Microsoft Excel 等程序可以读取带有分号的文件，并且可以从分隔符切换。您甚至可以使用制表符 ( `\t`) 作为分隔符。从 Supper User看到[这个答案](https://superuser.com/questions/1174876/how-can-i-dynamic-change-separators-configuration-in-excel-2016-for-csv-files#answer-1174879)。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2019-12-18T17:51:31.900

**Here's a neat little workaround:**

You can use a **Greek Lower Numeral Sign** instead (U+0375)

It looks like this ͵

Using this method saves you a lot of resources too...

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-12-13T16:29:51.740

如果您对如何解析文件（以 CSV 为例）的更具教育性的练习感兴趣，您可以查看Julian Bucknall 的[这篇文章](http://www.boyet.com/articles/csvparser.html)。我喜欢这篇文章，因为它把事情分解成更小的问题，这些问题更不容易克服。你首先创建一个语法，一旦你有了一个好的语法，将语法转换为代码是一个相对容易和有条理的过程。

文章使用C#，底部有下载代码的链接。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-02-11T04:51:57.080

Just use [SoftCircuits.CsvParser](https://www.nuget.org/packages/SoftCircuits.CsvParser/) on NuGet. It will handle all those details for you and efficiently handles very large files. And, if needed, it can even import/export objects by mapping columns to object properties. In addition, my testing showed it averages nearly 4 times faster than the popular CsvHelper.

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2022-03-02T09:46:58.667

I know it's almost 13 years later, but we came across a similar situation where the client inputs us a CSV and has values with commas, there are 2 use cases:

1.  If the client uses a windows Excel client to write the CSV (usually that's the case in windows environment) then commas are **automatically** added to the value. [![enter image description here](https://i.stack.imgur.com/pCocu.png)](https://i.stack.imgur.com/pCocu.png)

The actual text value of the CSV:

```
3786962,1st Meridian Care Services,John,"Person A,Person B, Person C, Person D",Voyager 
```

2.  If the client is sending you the excel programmatically, then he should adhere to [RFC4180](https://datatracker.ietf.org/doc/html/rfc4180) and enclose the value with **"quotes"**. example:

Col1, Col2, `"a, b, c"`, Col4

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-20T19:40:27.040

由于这是关于一般实践，让我们从经验法则开始：

1.  不要使用 CSV，而是使用带有库的 XML 来读取和写入 xml 文件。

2.  如果您必须使用 CSV。正确执行并使用免费库来解析和存储 CSV 文件。

为了证明 1) 的合理性，大多数 CSV 解析器都没有编码意识，所以如果你不处理 US-ASCII，你就是在自找麻烦。例如，excel 2002 将 CSV 存储在本地编码中，而没有任何关于编码的注释。CSV 标准没有被广泛采用 :(。另一方面 xml 标准被很好地采用并且它很好地处理了编码。

为了证明 2) 的合理性，几乎所有语言都有大量的 csv 解析器，因此即使解决方案看起来很简单，也无需重新发明轮子。

仅举几例：

*   对于 python 使用构建在[csv](http://docs.python.org/library/csv.html)模块中

*   对于 perl 检查 CPAN 和[Text::CSV](http://search.cpan.org/~makamaka/Text-CSV-1.11/lib/Text/CSV.pm)

*   对于 php 使用内置 fgetcsv/fputcsv 函数

*   对于 java 检查[SuperCVS](http://supercsv.sourceforge.net/)库

如果你不打算在嵌入式设备上解析它，真的没有必要手动实现它。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-11-21T05:50:36.767

您可以像这样读取 csv 文件。

这利用了拆分并处理了空间。

```
ArrayList List = new ArrayList();
static ServerSocket Server;
static Socket socket;
static ArrayList<Object> list = new ArrayList<Object>();

public static void ReadFromXcel() throws FileNotFoundException
{   
    File f = new File("Book.csv");
    Scanner in = new Scanner(f);
    int count  =0;
    String[] date;
    String[] name;
    String[] Temp = new String[10];
    String[] Temp2 = new String[10];
    String[] numbers;
    ArrayList<String[]> List = new ArrayList<String[]>();
    HashMap m = new HashMap();

         in.nextLine();
         date = in.nextLine().split(",");
         name = in.nextLine().split(",");
         numbers = in.nextLine().split(",");
         while(in.hasNext())
         {
             String[] one = in.nextLine().split(",");
             List.add(one);
         }
         int xount = 0;
         //Making sure the lines don't start with a blank
         for(int y = 0; y<= date.length-1; y++)
         {
             if(!date[y].equals(""))
             {   
                 Temp[xount] = date[y];
                 Temp2[xount] = name[y];
                 xount++;
             }
         }

         date = Temp;
         name =Temp2;
         int counter = 0;
         while(counter < List.size())
         {
             String[] list = List.get(counter);
             String sNo = list[0];
             String Surname = list[1];
             String Name = list[2];
             for(int x = 3; x < list.length; x++)
             {           
                 m.put(numbers[x], list[x]);
             }
            Object newOne = new newOne(sNo, Name, Surname, m, false);
             StudentList.add(s);
             System.out.println(s.sNo);
             counter++;
         } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-08-13T17:32:51.120

我通常对可以包含任何逗号或任何特殊字符的字段进行 URL 编码。然后在任何视觉媒体中使用/显示时对其进行解码。

（逗号变成 %2C）

每种语言都应该有对字符串进行 URL 编码和解码的方法。

例如，在java中

```
URLEncoder.encode(myString,"UTF-8"); //to encode
URLDecoder.decode(myEncodedstring, "UTF-8"); //to decode 
```

我知道这是一个非常通用的解决方案，对于用户想要手动查看 csv 文件内容的情况可能并不理想。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-02-10T13:20:20.253

我通常在我的 CSV 文件解析例程中执行此操作。假设“line”变量是 CSV 文件中的一行，并且所有列的值都用双引号括起来。执行以下两行后，您将在“值”集合中获得 CSV 列。

```
// The below two lines will split the columns as well as trim the DBOULE QUOTES around values but NOT within them
    string trimmedLine = line.Trim(new char[] { '\"' });
    List<string> values = trimmedLine.Split(new string[] { "\",\"" }, StringSplitOptions.None).ToList(); 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-11-18T00:02:37.827

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-06-06T14:38:30.133

```
 public static IEnumerable<string> LineSplitter(this string line, char 
         separator, char skip = '"')
    {
        var fieldStart = 0;
        for (var i = 0; i < line.Length; i++)
        {
            if (line[i] == separator)
            {
                yield return line.Substring(fieldStart, i - fieldStart);
                fieldStart = i + 1;
            }
            else if (i == line.Length - 1)
            {
                yield return line.Substring(fieldStart, i - fieldStart + 1);
                fieldStart = i + 1;
            }

            if (line[i] == '"')
                for (i++; i < line.Length && line[i] != skip; i++) { }
        }

        if (line[line.Length - 1] == separator)
        {
            yield return string.Empty;
        }
    } 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2018-11-13T18:41:52.423

I used Csvreader library but by using that I got data by exploding from comma(,) in column value.

So If you want to insert CSV file data which contains comma(,) in most of the columns values, you can use below function. Author link => [https://gist.github.com/jaywilliams/385876](https://gist.github.com/jaywilliams/385876)

```
function csv_to_array($filename='', $delimiter=',')
{
    if(!file_exists($filename) || !is_readable($filename))
        return FALSE;

    $header = NULL;
    $data = array();
    if (($handle = fopen($filename, 'r')) !== FALSE)
    {
        while (($row = fgetcsv($handle, 1000, $delimiter)) !== FALSE)
        {
            if(!$header)
                $header = $row;
            else
                $data[] = array_combine($header, $row);
        }
        fclose($handle);
    }
    return $data;
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2019-04-24T03:28:32.770

I used papaParse library to have the CSV file parsed and have the key-value pairs(key/header/first row of CSV file-value).

here is example that I use:

[https://codesandbox.io/embed/llqmrp96pm](https://codesandbox.io/embed/llqmrp96pm)

it has dummy.csv file in there to have the CSV parsing demo.

I've used it within reactJS though it is easy and simple to replicate in app written with any language.

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2020-05-18T01:07:04.767

An example might help to show how commas can be displayed in a .csv file. Create a simple text file as follows:

Save this text file as a text file with suffix ".csv" and open it with Excel 2000 from Windows 10.

aa,bb,cc,d;d "In the spreadsheet presentation, the below line should look like the above line except the below shows a displayed comma instead of a semicolon between the d's." aa,bb,cc,"d,d", This works even in Excel

aa,bb,cc,"d,d", This works even in Excel 2000 aa,bb,cc,"d ,d", This works even in Excel 2000 aa,bb,cc,"d , d", This works even in Excel 2000

aa,bb,cc, " d,d", This fails in Excel 2000 due to the space belore the 1st quote aa,bb,cc, " d ,d", This fails in Excel 2000 due to the space belore the 1st quote aa,bb,cc, " d , d", This fails in Excel 2000 due to the space belore the 1st quote

aa,bb,cc,"d,d " , This works even in Excel 2000 even with spaces before and after the 2nd quote. aa,bb,cc,"d ,d " , This works even in Excel 2000 even with spaces before and after the 2nd quote. aa,bb,cc,"d , d " , This works even in Excel 2000 even with spaces before and after the 2nd quote.

Rule: If you want to display a comma in a a cell (field) of a .csv file: "Start and end the field with a double quotes, but avoid white space before the 1st quote"

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-12-22T18:36:48.517

首先，让我们问自己，“为什么我们觉得需要以不同的方式处理 CSV 文件的逗号？”

对我来说，答案是，“因为当我将数据导出到 CSV 文件时，字段中的逗号消失了，我的字段被分隔成多个字段，逗号出现在原始数据中。” （这是因为逗号是 CSV 字段分隔符。）

根据您的情况，分号也可以用作 CSV 字段分隔符。

根据我的要求，我可以使用一个看起来像逗号的字符，例如单个低 9 引号。

所以，这里是你如何在 Go 中做到这一点：

```
// Replace special CSV characters with single low-9 quotation mark
func Scrub(a interface{}) string {
    s := fmt.Sprint(a)
    s = strings.Replace(s, ",", "‚&quot;, -1)
    s = strings.Replace(s, ";", "‚&quot;, -1)
    return s
} 
```

Replace 函数中的第二个逗号外观字符是十进制 8218。

请注意，如果您的客户端可能只有 ascii 文本阅读器，则此十进制 8218 字符看起来不像逗号。如果这是您的情况，那么我建议根据 RFC 4128 用逗号（或分号）和双引号将字段括起来：[https ://www.rfc-editor.org/rfc/rfc4180](https://www.rfc-editor.org/rfc/rfc4180)

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2014-01-24T19:41:57.083

我认为这个问题最简单的解决方案是让客户在 excel 中打开 csv，然后 ctrl + r 用你想要的任何标识符替换所有逗号。这对客户来说非常容易，只需更改一次代码即可读取您选择的分隔符。

* * *

## 回答 #28

> 赞同：-4
> 
> 时间：2016-07-17T00:06:56.103

使用制表符 (\t) 分隔字段。

# c# - 使用 DI 添加新方程以使用 2 个数字进行计算

> ID：769624
> 
> 赞同：1
> 
> 时间：2009-04-20T18:53:05.627
> 
> 标签：c#, algorithm, dependency-injection

我正在开发一个程序，我希望能够使用 DI、C# 添加功能，所以我将创建一个示例来看看这是否可能。

我有一个程序，用户可以输入任意两个数字。然后程序查看 xml 文件中的所有插件，并使用注入的那些类来计算这两个数字。

所以，我创建了两个类，加法和减法。我把它们放进去并运行我的程序。

理想情况下，我想让程序找到这两个类并在完成方程式后显示结果。

现在，别人写“乘”，把它放到一个目录中，更新xml文件，下次我运行我的程序，有两个数字，有三个结果。

现在，我不知道会有多少插件。

在 C# 中有什么方法可以使用 DI 来获得这种类型的功能吗？

我不知道这是否可能。

我试图弄清楚这一点，因为我想展示一种使用不同类型的图表来绘制一些数据的方法，但我认为使用二元方程方法可以使解释更简单，我认为。

我可以通过手动加载 xml 文件中引用的类来做到这一点，所以它可以完成，但是，我希望有一个依赖框架为我处理繁重的工作。

更新：我希望为此使用 Unity 框架。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T18:57:06.630

您可以公开一个接口（`IMathOperation`例如，使用单个方法，例如`Compute`），然后在 DI 框架配置文件中指定实现接口的类型（等）`Add`。`Subtract`DI 框架通常允许您指定程序集名称和类型名称，并且它们通常还擅长允许您创建相似类型的集合，因此您可以拥有一种类型，它具有 type 的属性或构造函数参数`IList<IMathOperation>`。在配置文件中设置该属性/参数，你应该很高兴。

当然，具体细节取决于您要使用的 DI 框架。

# ruby-on-rails - 我需要帮助找出在 rails 中查询此问题的最佳方法

> ID：769626
> 
> 赞同：1
> 
> 时间：2009-04-20T18:53:27.433
> 
> 标签：ruby-on-rails, ruby, activerecord

我在提出适用于这些模型的查询时遇到问题。我有三个连接的模型。

一个组织有很多用户，用户有很多状态条目

基本上这意味着我可以做到

```
Organization.find(1).users.find(1).status_entries 
```

并将状态条目列表返回给我。

问题是我正在尝试查找特定组织的 status_entries 列表。我很难想出一种不太复杂且优雅的方法。任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T20:16:08.703

我认为这是一个 have_many :through 关联的情况：

```
class Organization
  has_many :users
  has_many :status_entries, :through => :users
end 
```

那么你可以这样做：

```
Organization.find(1).status_entries 
```

# winapi - 获取批处理脚本错误代码

> ID：769631
> 
> 赞同：3
> 
> 时间：2009-04-20T18:54:54.247
> 
> 标签：winapi, batch-file

我想要一个 Win32 进程来启动一个外部脚本并能够检索它返回的 ERRORLEVEL。

反过来很容易。只需使用**exit(errorcode)**或**return errorcode;** 在您的 Win32 应用程序中，调用脚本会正确设置其 ERRORLEVEL 值。

但是，从 Win32 调用应用程序中，获取脚本错误代码并不完全相同。

我尝试使用 CreateProcess() 并调用 GetExitCodeProcess()，但它总是返回 0 而不是 ERRORLEVEL 的实际值。即使我用**exit %ERRORLEVEL%结束我的调用脚本**

我最好的猜测是脚本*不是*一个单独的过程。很可能 CMD.EXE 正在运行，并且很可能总是以 ExitCode 0 结束。我知道 ERRORLEVEL 与进程 ExitCode 值不同，我希望 CMD.EXE 能够镜像它。

编辑：

对不起，我问了！我刚刚发现了**我**的问题。我在批处理文件中使用了**exit /b errorcode**而不是**exit errorcode**。似乎 /b 选项的优点是仅关闭正在运行的脚本，而不是 CMD.EXE 当您从命令行进行测试时。但是没有为 CMD.EXE 设置正确的 ExitCode 的缺点。

所以，为了后代，我正在做的是：

```
int LaunchScript(TCHAR *pCmdLineParam)
{
    bool bResult;
    PROCESS_INFORMATION pi;
    STARTUPINFO si;

    memset(&si, 0, sizeof(si));
    si.cb = sizeof(si);

    TCHAR   cmdLine[256];
    _tcscpy(cmdLine,L"Test.cmd");
    _tcscat(cmdLine,L" ");
    _tcscat(cmdLine,pCmdLineParam);

    _tprintf(L"Process executing: %s\n",cmdLine);

    bResult = CreateProcess(NULL, cmdLine, NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi)?true:false;
    if (!bResult) {
        _tprintf(L"CreateProcess() error - %d", GetLastError());
        return -1;
    }

    DWORD result = WaitForSingleObject(pi.hProcess,15000);
    if( result == WAIT_TIMEOUT ) {
        return -2;
    }

    DWORD exitCode=0;
    if( !GetExitCodeProcess(pi.hProcess,&exitCode) ) {
        _tprintf(L"GetExitCodeProcess() error - %d", GetLastError());
        return -1;
    }

    _tprintf(L"Process exitcode=%d\n",exitCode);

    return exitCode;
} 
```

我的“入口点”批处理文件如下所示：

```
@call %*
@exit %ERRORLEVEL% 
```

我正在将我的脚本作为参数传递给入口点脚本。其他“子脚本”文件可以调用 exit /b 或 exit，因为所有内容都已涵盖。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T19:15:34.307

只是在黑暗中拍摄（因为我在家并且周围没有窗户）：

我们`'cmd /c call <script>'`在工作中使用。也许它适用于您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T19:06:56.280

这对我有用：

```
int DoDOS(string parms)
{

Process p=new Process();
ProcessStartInfo ProcInfo=new ProcessStartInfo();

ProcInfo.Arguments="/C "+parms;
ProcInfo.CreateNoWindow=true;
ProcInfo.ErrorDialog=false;
ProcInfo.ErrorDialogParentHandle=IntPtr.Zero;
ProcInfo.FileName="cmd.exe";
ProcInfo.RedirectStandardError=false;
ProcInfo.RedirectStandardInput=false;
ProcInfo.RedirectStandardOutput=false;
ProcInfo.UseShellExecute=false;
ProcInfo.Verb="";
ProcInfo.WindowStyle=ProcessWindowStyle.Hidden;
p=Process.Start(ProcInfo);

while (!p.HasExited)
      {
      if (laRunning.Text!=RunningTxt) laRunning.Text=RunningTxt;
      else                            laRunning.Text="";
      Application.DoEvents();
      Thread.Sleep(500);
      }

return p.ExitCode; 
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-20T19:04:20.200

尝试将此作为`lpCommandLine`参数传递`CreateProcess`：

```
cmd /v:on /k <script_name> & exit !errorlevel! 
```

它将打开*延迟的[环境变量扩展](http://blogs.msdn.com/oldnewthing/archive/2006/08/23/714650.aspx)*（否则`%ERRORLEVEL%`在执行之前扩展`<script_name>`）并显式返回`ERRORLEVEL`脚本返回的作为`cmd.exe`返回码。

# c# - 访问非公共成员 - ReflectionAttribute

> ID：769634
> 
> 赞同：0
> 
> 时间：2009-04-20T18:55:54.900
> 
> 标签：c#, .net, security

我正在从程序集 A 加载程序集 B。我正在尝试枚举位于程序集 B 中的类型的私有成员。

如何使用 ReflectionPermission 来完成这项任务？我在 MSDN 上找不到任何有用的东西。

```
Assembly asm = Assembly.LoadFrom("Chapter13.exe", AppDomain.CurrentDomain.Evidence);
//AppDomain.CurrentDomain.Load("Chapter13");

Type t = asm.GetType("Chapter13.ProtectedBuffer");

MemberInfo[] members = t.GetMembers(BindingFlags.NonPublic);

foreach (MemberInfo m in members)
{
    Console.WriteLine(m.Name);
} 
```

亲切的问候PK

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T18:59:08.560

除非您在部分信任环境中运行，否则您不需要`ReflectionPermission`. 我怀疑您的问题是您没有指定静态/实例。尝试这个：

```
MemberInfo[] members = t.GetMembers(BindingFlags.NonPublic | 
                                    BindingFlags.Static |
                                    BindingFlags.Instance); 
```

# php - CodeIgniter 项目启动器

> ID：769650
> 
> 赞同：5
> 
> 时间：2009-04-20T18:59:12.693
> 
> 标签：php, ruby, codeigniter

我想知道你们是否有任何工具可以用来启动类似于 ROR 的 CodeIgniter 项目？提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T21:52:53.133

我只尝试过 CodeCrafter ( [https://launchpad.net/codecrafter](https://launchpad.net/codecrafter) )，它相当不错，但还有其他的：

```
http://*.com/trac/catalystmodel (see comment)
http://codeigniter.com/wiki/Rapyd_Components/
http://*.com/trac/quickmodel (see comment) 
```

祝你好运！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T09:19:33.733

# 检查其他代码

对我有很大帮助的是通过 Redux 2 身份验证系统的代码库（目前处于测试阶段）。

该项目的代码格式良好且清晰。它使用模型、视图、控制器、库和体面的配置文件进行自定义。

编写代码的方式将使您深入了解如何以非常干净的方式构建 CodeIgniter 项目。

# 使用图书馆

其他快速入门的方法包括使用库从 API 中获取数据。例如，试用Eliot Haughin 编写的[Flickr](http://www.haughin.com/code/flickr/)、[Twitter](http://www.haughin.com/code/flickr/)或[Last FM库。](http://www.haughin.com/code/lastfm/)

这些使您能够以有趣的方式使用其他站点的数据。

# 示例应用程序

Derek Allard 在[此 URL](http://video.derekallard.com/)上还提供了一个示例应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-29T21:47:34.287

[这个 Net-tuts 系列](http://net.tutsplus.com/sessions/codeigniter-from-scratch/)在 CI 上卖给了我。它不是真正的启动器，但会引导您了解基础知识和一些更深入的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T19:08:16.010

我不确定 ROR 是如何做到的，但是如果你在一个目录中解压了 CI，你几乎可以开始创建你的站点。如果您在如何开始创建网站方面需要一些帮助，他们也有一些视频教程。 [http://codeigniter.com/tutorials/](http://codeigniter.com/tutorials/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T19:59:54.537

启动 CodeIgniter 项目的工具，嗯？Debian、Apache、PHP 5、SciTE ... =)

从阅读[用户指南](http://codeigniter.com/user_guide/)开始。这是我遇到的一些最好的文档。

然后，如果您有一个项目，请找出项目所需的功能集并开始在[wiki](http://codeigniter.com/wiki/)上寻找 CodeIgniter 免费赠品。有一些帮助程序、库、插件等可以为您完成很多工作。

最后的旁注：尽量保持开放的心态。如果你试图在 CodeIgniter 中“做 Rails”，你就是在倒退。相反，尝试学习是什么让 CodeIgniter 成为一个出色的框架，并尽可能地使用这些功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-21T08:49:54.707

CI 有一个称为 Scaffolding 的功能，它是数据库的管理员专用 GUI，您可以通过它快速输入测试数据以开始查询并在页面上显示。

视频教程和文档以及一流的，让一个简单的博客启动和运行真的很容易。

# java - DTD 和模式文件的放置位置

> ID：769656
> 
> 赞同：4
> 
> 时间：2009-04-20T19:02:08.537
> 
> 标签：java, jakarta-ee, jboss, schema, dtd

我有一个相当典型的 JavaEE 应用程序，使用 EJB3、seam 组件、spring bean 和 JSF 组成，所有这些都打包到一个 ear 文件中的几个 jar 和 war 文件中。对于 JavaEE，我们自然有许多 XML 文件作为应用程序的一部分。其中一些 XML 文件使用 DTD（seam）进行验证，一些使用模式进行验证。

作为从示例和其他项目中获取的大多数文件，所有 DTD 和模式都引用项目的站点，默认 DTD 或模式所在的位置。问题来了：出于某种原因，JBoss 站点今天错过了接缝 DTD（检查[http://www.jboss.com/products/seam/components-1.1.dtd](http://www.jboss.com/products/seam/components-1.1.dtd)，[http://www.jboss.com/products /seam/components-1.2.dtd，http://www.jboss.com/products/seam/components-2.0.dtd](http://www.jboss.com/products/seam/components-1.2.dtd)）。[_](http://www.jboss.com/products/seam/components-2.0.dtd) 由于 JBoss 服务器在引导时使用此位置验证 XML，因此应用程序部署失败。

我的问题是：在这种情况下，我应该将 DTD 和定义文件放在哪里？我看到三个选项：

1.  和我之前一样，使用默认位置。因为这意味着我现在将 JBoss、Sun、Spring 和任何其他供应商的稳定性添加到我的系统中，以防我需要重新部署应用程序，我不想这样做。
2.  将所有 DTD 和模式文件复制到我的服务器，让 URLS 指向我控制的服务器。
3.  将所有 DTD 和架构文件复制到我的应用程序或应用服务器，并在本地使用它们。

我倾向于使用选项#3，因为它提供了对文件的完全控制，没有网络依赖。在我们所做的测试中，它甚至显着减少了服务器的引导时间——显然 XML 解析器不会缓存定义。走这条路有什么我想念的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T20:17:30.570

不，这是正确的做法。第一个应该只用于乱七八糟或玩代码，但不能用于任何严重的事情，第二个与第三个相比没有优势，同时也更复杂。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:26:48.940

真正的问题是：您**真的**需要验证 xml 文件吗？在大多数情况下，验证不是在生产代码中完成的——大多数时候它太慢了。

如果您真的想验证，请选择选项#3。

# ruby-on-rails - Rack 1.0 的嵌套参数问题/无法冻结 Rails 2.3.2.1 - 请帮助

> ID：769657
> 
> 赞同：0
> 
> 时间：2009-04-20T19:02:45.197
> 
> 标签：ruby-on-rails

我有一个非常奇怪的问题。我将我的应用程序升级到 Rails 2.3.2 没有任何问题，然后将其冻结到供应商/rails 并在我还将 Rspec 升级到 1.2.4 之后完成了我的所有规范。在某些时候（我不能确切地告诉你什么时候）嵌套参数不再起作用。

这意味着服务器会收到类似的信息：

```
{ "post[body]" => "data" } 
```

代替

```
{ "post" => { "body" => "data" } } 
```

这个问题似乎被称为 Rails 2.3.2 / 2.3.2.1 混淆。

所以我浏览了所有论坛，卸载了 gem rack-0.9.1 并检查了我是否有提交 39ff550fa88da9a22d8c21ca872f5e4d0d83f8d4 ( [http://github.com/rails/rails/commit/39ff550fa88da9a22d8c21ca872f5e4d0d83f8d4](http://github.com/rails/rails/commit/39ff550fa88da9a22d8c21ca872f5e4d0d83f8d4) ) 这意味着捆绑的 rack-1.0加载，至少我的 rack.rb 在第 6 行读取

```
$:.unshift(File.expand_path(File.dirname(FILE))) 
```

问题仍然存在，我不知道如何解决这个问题。

我也试过

```
$ sudo rake rails:freeze:edge RELEASE=2.3.2.1 
```

但问题并没有解决。

这是两张相关的灯塔票，但没有解决我的问题：

[https://rails.lighthouseapp.com/projects/8994/tickets/2259-params-hash-issues](https://rails.lighthouseapp.com/projects/8994/tickets/2259-params-hash-issues)

[https://rails.lighthouseapp.com/projects/8994/tickets/2255-bundled-rack-10-doesnt-loaded-first-in-rails-232](https://rails.lighthouseapp.com/projects/8994/tickets/2255-bundled-rack-10-doesnt-loaded-first-in-rails-232)

感谢您提供任何提示/想法/解决方案！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T05:58:31.970

这个“bug”解决了，只是一个非常愚蠢的错误。我不小心冻结了 rack-0.9.1 gem

rake gems:unpack:dependencies

并没有注意到它。一个简单的

```
$ sudo rm -rf vendor/gems/rack-0.9.1 
```

成功了。

我无法冻结 rails edge，因为 dev.rubyonrails.org 服务器已关闭。

愚蠢的我...

# prolog - Prolog 中的广度优先

> ID：769658
> 
> 赞同：9
> 
> 时间：2009-04-20T19:02:49.597
> 
> 标签：prolog, breadth-first-search, logic-programming

在 Prolog 中使用广度优先而不是默认的深度优先搜索方案的一般想法是什么？

不取无限分支？

在 Prolog 中有没有使用广度优先的一般方法？我一直在谷歌搜索，我没有找到太多对新手有用的信息。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T07:10:46.680

广度优先的优点是你会找到所有的解决方案。使用深度优先，您可能会陷入无限分支。

缺点是广度优先占用大量内存，因此一般不用于执行。

如果你想使用它，你需要用某种队列显式地实现它。

**编辑：**如果您想在不使用太多内存的情况下获得广度优先搜索的优势，您可以使用迭代深化。这是具有深度限制的深度优先搜索，您可以连续增加该深度。这会导致一些重复计算，但如果您的搜索空间没有长的线性延伸而没有分支，那么这种重复很小。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-07-22T08:20:48.717

我知道一些事情是“**议程搜索**”。在遍历树（数据、关系、规则……）时，您会维护下一步要做什么的“议程”（列表）。当您输入一个节点时，您将其子节点放在议程上，然后继续处理您弹出的议程的第一个元素。这样，如果您将新项目放在议程的末尾，您将获得广度优先。如果你把它们放在议程的前面，你就会得到深度优先。

使用 Prolog 很容易实现。

编辑：我不妨在这里给出一个实现提示。这是议程搜索算法的一个非常基本的实现。

```
agenda_search([N|T],Mode):-
    doWithNode(N),           % do whatever you do the searching for
    getNodeChildren(N,C),
    (Mode=bf ->              % bf or df (depth-first)
        append(T,C,A);
        append(C,T,A)),
    agenda_search(A,Mode). 
```

它依赖于外部谓词`doWithNode`，这些谓词代表您希望对每个节点执行的操作（例如，将节点数据与搜索词进行比较、序列化节点内容、asf.）。这`getNodeChildren`会将给定节点的子节点列表绑定到`C`（即这个谓词实际上知道树结构以及如何找到子节点）。当然，`doWithNode`谓词可能需要额外的参数来完成它的工作，这也会出现在`agenda_search`.

你可以像这样调用它：

```
agenda_search([RootNode], bf)   % for breadth-first search 
```

和

```
agenda_search([RootNode], df)   % for depth-first search 
```

我还在[这个网页上](http://www.macs.hw.ac.uk/~alison/ai3notes/subsection2_6_2_1.html)找到了一些关于议程搜索的解释。议程搜索的好处是您可以轻松地在 df 和 bf 两个变体之间切换并使用结果。该算法在内存方面表现得非常好，作为议程，仍有待探索的节点在任何时候仅捕获（或多或少）一小部分节点（所谓的边缘）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-22T06:56:36.263

议程搜索的代码应该可以正常工作。为了提高效率，您可能希望考虑使用另一种数据结构；实际上，在广度优先模式下，整个节点列表 (T) 将由 append(T,C,A) 遍历。例如，您可以使用 SICStus 的 library(queues) 模块。广度优先搜索将如下所示（由谓词 start/1、后继谓词 s/2 和目标谓词goal/1 参数化）。注意，我还添加了循环检查。

```
bfs(Res) :- start(Start), empty_queue(EQ),
  queue_append(EQ,[e(Start,[])],Q1),
  bfs1(Q1,Res)。

bfs1(Queue,Res) :- queue_cons(e(Next,Path),NQ,Queue),
   bfs2（下一个，路径，NQ，Res）。

bfs2(H,Path,_NQ,Res) :- 目标(H), reverse([H|Path],Res)。
bfs2(H,Path,NQ,Res) :-  
              findall(e(Succ,[H|Path]),
                      (s(H,Succ),\+ 成员(Succ,Path)),AllSuccs),
              queue_append(NQ,AllSuccs,NewQueue),
              bfs1（新队列，Res）。

```

（您也可以尝试用更好的数据结构替换/补充 Path 组件；例如，AVL 树。）要解决的示例问题是：

```
开始（环境（0,0））。
s(env(X,Y),env(X1,Y)) :- X1 是 X+1。
s(env(X,Y),env(X,Y1)) :- Y1 是 Y+1。
目标（环境（3,3））。

```

您还可以将队列替换为优先级队列，并使用启发式函数计算优先级。然后，您将获得 A* 搜索（可以模拟深度优先、广度优先、最佳优先……）。Bratko 的书（人工智能的逻辑编程）应该是阅读此材料的好来源。

# c# - WCF Web 服务方法建议

> ID：769661
> 
> 赞同：2
> 
> 时间：2009-04-20T19:03:18.690
> 
> 标签：c#, wcf, web-services

我的任务是实现一个可用于许多不同事物的 Web 服务方法（阅读：不存在任何要求），并且任何客户端都不必更改接口 这是该方法应该看起来的样子

```
[DataContract]
    public class Status
    {
        [DataMember(Order = 0)]
        public long Code
        {
            get;
            set;
        }

        [DataMember(Order = 1)]
        public string Message
        {
            get;
            set;
        }
    }

[DataContract]
    public class Data
    {
        [DataMember(Order = 0)]
        public string Name
        {
            get;
            set;
        }

        [DataMember(Order = 1)]
        public string Value
        {
            get;
            set;
        }
    }

public Status InitiateTransaction(long txnTypeId, Data [] txnData); 
```

这个想法是客户端将根据他们想要启动的“事务”类型在数据数组中传递不同的东西。与创建一堆不同的专门方法来做特定事情相比，这样做有什么好处？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T23:49:05.400

如果建议您实现此功能的人感到羞耻，请告诉他们这种模式肯定是懒惰的标志。他们懒得弄清楚行为的要求是什么，所以他们指定了一个方法；他们懒得弄清楚数据的要求，所以他们决定名称/值对。

只有一种情况我发现这种东西很有用。我已经看到了定义一个接受一段 XML 并返回一段 XML 的 Web 服务的一些价值，希望至少受到 XML Schema 的约束。当服务旨在与其他一些服务或其他根据 XML 文档操作的代码进行交互时，这很有用。一个例子是 EDI 场景，当文档格式已经由行业标准或协议定义时，Web 服务实际上只不过是执行实际工作的服务的代理。

看起来你的例子没有这个借口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T19:06:43.457

好吧，好处是 - 它有点“通用” - 取决于传入的内容。

但这同时也是它最大的弱点。由于它是如此通用且通用，因此您实际上无法真正执行很多约束和/或有效性检查。

我在很多地方都看到过这种方法——Web 服务、数据库模式——它们通常适用于两个或三个独立的“事物”，但随着它们变得越复杂，它们就会开始崩溃。

我强烈建议为您想做的每件事创建特定的、经过严格检查的方法。

马克

PS：另外 - 在不更改任何现有接口的情况下使用其他方法扩展现有服务可以非常容易地完成，并且也不需要对客户端进行任何更改 - 因此，随着需求的增长，您始终可以轻松扩展服务，而不会向后中断兼容性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T22:11:48.903

当您在某物之上托管 Web 服务时，您也有这种服务。如果您要在 SOAP 端点上托管它，您的客户端将向您提供“代码”和“消息”，IIS 或您用来托管 Web 服务的任何东西都会将其解释为 HTTP 消息并调用正确的 HTTP 处理程序。WCF SOAP 处理程序将获取消息，该消息实际上只包含另一组代码和消息，SOAP 堆栈将使用这些代码和消息调用正确的服务方法并将消息传递给那个......然后再次打开消息，获取它的代码和消息并调用正确的东西。

在任何情况下，您都需要在某个时候实现这些方法。所以我要问你的主管的问题是，为什么不使用已经是提供者、标准化等等的通用代码/消息系统，为什么他们应该让你在上面实现自己的代码/消息系统来浪费你的时间？

此外，正如 Marc 所说，向接口添加更多方法[不会强制](http://www.dasblonde.net/2006/01/05/VersioningWCFServiceContracts.aspx)对现有客户端进行任何更改。

# c# - 从 Silverlight 覆盖 (IE7) 浏览器键盘处理

> ID：769668
> 
> 赞同：0
> 
> 时间：2009-04-20T19:04:57.627
> 
> 标签：c#, javascript, silverlight, internet-explorer, internet-explorer-7

当我在 Firefox 中测试我的 Silverlight 2 应用程序时，当 Silverlight 获得焦点时，我通过 Page.KeyDown 事件接收每个按键都没有问题。

当我在 Internet Explorer 7 中对其进行测试时，我只能获取浏览器尚未处理的键盘事件。但是，我可以在 javascript 中覆盖这些相同的键盘事件。

例如，**Ctrl + D**。我可以通过执行以下操作在*javascript*中覆盖它，但我不能在 Silverlight 中做同样的事情！

```
function initKeyHandling(){ document.attachEvent("onkeydown", keydown); }

function keydown(e) { printToTextbox('Keydown ', e); return false; }

...

initKeyHandling(); 
```

此外，我将事件从 Javascript 转发到 Silverlight 的尝试失败了。当 Silverlight 获得焦点时，我的 javascript 键盘事件处理程序甚至不会被触发。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T18:06:00.440

从文档看来，这是不可能的（至少没有像你提到的那样使用javascript解决方法）：

> 键盘事件和浏览器 不同的浏览器可能会以不同的方式处理键盘事件。创建使用键盘输入的应用程序时，请确保在目标浏览器中测试该应用程序。
> 
> 浏览器确定将哪些击键解释为命令以及将哪些击键传递给托管内容。这意味着无法从 KeyDown 和 KeyUp 事件处理函数中检索某些击键。大多数被浏览器解释为命令的击键是快捷键或加速键击，并且不会作为键事件传递给 Silverlight。例如，CTRL+D 是用于向 Firefox 和 Internet Explorer 浏览器添加收藏 URL 的快捷键组合，并且 CTRL 和 D 都不会被报告为键事件。

看看：http: [//msdn.microsoft.com/en-us/library/cc189015.aspx](http://msdn.microsoft.com/en-us/library/cc189015.aspx)

我想我前几天读到了一个关于底层 HTML 文本框的解决方法。但我不确定它是否仍然支持，或者细节是什么。如果我再次找到它，我会回来。

/阿斯格

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T20:11:40.663

我们在使用 Flash 时遇到过类似的问题，我们必须通过在同一页面上使用单独的 DIV 标记来解决这些问题，我们必须在需要调用键盘快捷键时以编程方式将焦点设置到该标记上。

# c# - C# 程序员的 COBOL Copybook 规范

> ID：769673
> 
> 赞同：5
> 
> 时间：2009-04-20T19:06:03.253
> 
> 标签：c#, cobol, copybook

我正在开发一个应用程序，该应用程序需要我生成 COBOL 副本来定义数据文件。

有没有人对如何写出字帖有很好的参考？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T19:17:43.367

“copybook”基本上是包含文件的 COBOL 代言。您需要以 COBOL 格式编写数据描述。这是一个[教程](http://www.csis.ul.ie/COBOL/Course/DataDeclaration.htm)。 [这里](http://www.cobug.com/cobug/docs/cobol_copy0139.html)有一些其他的好文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-06T22:13:34.023

首先澄清一下，我假设您不是在询问语法，它只是来自数据部门或过程部门的 COBOL 代码行。

那么格式化文件布局的方法是什么？您需要认识到这是非常低级的数据建模。所以你需要真正了解你的数据是什么样的。你可以研究各种数据建模方法，但我建议从你所知道的开始。如果您知道如何为数据库表建模，请像设计表一样设计它。然后转换为文件格式。

这可能会突出显示您有多个要建模的实体。然后您可能会决定您确实需要多个文件，或者您可能能够摆脱将几个记录组合成一个长文件（展平）或使用 REDEFINES 和某种方差键来创建“辅助”记录来告诉您哪种类型的数据在此记录中。

# sql - 为什么这个表创建脚本会给我错误？

> ID：769674
> 
> 赞同：1
> 
> 时间：2009-04-20T19:06:11.477
> 
> 标签：sql, oracle, ora-00907

```
CREATE TABLE DEPARTMENTS (
dept_num                 NUMBER          (8)                                                 
dept_name               VARCHAR2         (20) NOT NULL,           
dept_loc                    VARCHAR2         (25),
dept_phone             CHAR                   (13),
CONSTRAINT dept_num_pk PRIMARY KEY (dept_num)
) ;

CREATE TABLE JOB_HISTORY (
rank                              CHAR                 (20),                                          
date_attendance        NUMERIC          (10) NOT NULL,
fac_num                      INTEGER         (8),  
CONSTRAINT rank_pk PRIMARY KEY (rank),
CONSTRAINT fk_fac_num FOREIGN  KEY (fac_num) REFERENCES FACULTY (fac_num)
) ;

CREATE TABLE FACULTY (
fac_num                        INTEGER      (8),                                                   
fac_name                      CHAR             (15)      NOT NULL,
fac_last_name             CHAR              (15)      NOT NULL,
street                             VARCHAR2   (30),
city                                 VARCHAR2   (20),
state                              VARCHAR2    (2),
zip_code                       VARCHAR2    (10),
salary                            NUMERIC       (6,2),
earn_ytd                      NUMERIC       (6,2),
start_date                    DATE                          NOT NULL,
degree                          VARCHAR2      (15)   NOT NULL,
field                              CHAR                (15)   NOT NULL,
curr_rank                     CHAR                (20)  NOT NULL ,
dept_num                   NUMBER          (8),
CONSTRAINT fac_num_pk PRIMARY KEY (fac_num),
CONSTRAINT fk_curr_rank FOREIGN KEY (curr_rank) REFERENCES JOB_HISTORY (rank),
CONSTRAINT fk_dept_num FOREIGN KEY (dept_num)  REFERENCES DEPARTMENTS (dept_num)
);

CREATE TABLE SPEAKING_TOPICS (
code                         CHAR                    (10),                                               
title                          CHAR                    (20) NOT NULL,
last_given               CHAR                    (20),
time_given             NUMBER             (3),
fac_num_fke          INTEGER             (8),
CONSTRAINT code_pk PRIMARY KEY (code),
CONSTRAINT fk_fac_num  FOREIGN KEY (fac_num) REFERENCES FACULTY (fac_num)
) ;

CREATE TABLE FACULTY ( fac_num INTERG ORA-00907: missing right parenthesis -  
3 0.08 CREATE TABLE JOB_HISTORY ( rank  ORA-00907: missing right parenthesis -  
4 0.09 CREATE TABLE SPEAKING_TOPICS ( code  ORA-00907: missing right parenthesis 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T20:49:28.967

一些提示：

*   您不能将精度与`INTEGER`. 使用`INTEGER`而不是`INTEGER(8)`. （`INTEGER`实际上和 一样`NUMBER(38)`，所以它已经有了精度。）

*   您在表中的`dept_num`列之后缺少逗号`DEPARTMENTS`。

*   您不能在尚不存在的表上创建外键约束。该`CREATE TABLE JOB_HISTORY ...`语句尝试在`FACULTY`表上创建外键约束，但此时`FACULTY`尚未创建表。`fk_fac_num`从`CREATE TABLE JOB_HISTORY`语句中删除约束。创建表后`FACULTY`，使用类似的东西添加约束

    ```
    ALTER TABLE JOB_HISTORY ADD CONSTRAINT fk_fac_num ... 
    ```

*   中没有调用`fac_num_fke`列`SPEAKING_TOPICS`。你的意思是`fac_num`相反吗？

*   约束必须都有不同的名称。将外键约束的名称更改为`SPEAKING_TOPICS`其他名称。

在对您的 SQL 进行这些更改后，我能够运行它并成功创建表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T21:11:11.393

下面是一个更正的脚本，带有注释块来解释什么是错误的。

```
/*
A comma was missing
*/
create table departments (
  dept_num number(8)
 ,dept_name varchar2(20) not null
 ,dept_loc varchar2(25)
 ,dept_phone char(13)
 ,constraint dept_num_pk primary key(dept_num)
);

/*
Don't specify INTEGER(8)... just say INTEGER.
Also, you can't reference the FACULTY table before you've created it. 
I've made that constraint into a separate command,
after FACULTY is created.
*/
create table job_history(
  rank char(20)                                          
 ,date_attendance numeric(10) not null
 ,fac_num integer  
 ,constraint rank_pk primary key(rank)
 --,constraint fk_fac_num foreign key (fac_num) references faculty(fac_num)
);

/*
Same issue with the INTEGER precision.
*/
create table faculty(
  fac_num integer                                                   
 ,fac_name char(15) not null
 ,fac_last_name char(15) not null
 ,street varchar2(30)
 ,city varchar2(20)
 ,state varchar2(2)
 ,zip_code varchar2(10)
 ,salary numeric(6,2)
 ,earn_ytd numeric(6,2)
 ,start_date date not null
 ,degree varchar2(15) not null
 ,field char(15) not null
 ,curr_rank char(20) not null
 ,dept_num number(8)
 ,constraint fac_num_pk
  primary key(fac_num)
 ,constraint fk_curr_rank
  foreign key(curr_rank)
  references job_history(rank)
 ,constraint fk_dept_num
  foreign key(dept_num)
  references departments(dept_num)
);

/*
This line is new.
JOB_HISTORY has to wait until FACULTY exists before
referencing it.
*/
alter table job_history 
add constraint fk_fac_num
foreign key(fac_num)
references faculty(fac_num);

/*
The INTEGER had a precision argument, again.
Also, the name of your foreign key on faculty(fac_num) was not unique; it 
matched the one used by JOB_HISTORY to refer to faculty(fac_num).
I've modified the name of that constraint to make it unique.

Finally, the foreign_key had the wrong field name.
It needs to refer to the
local field name, whose name includes an "fke" @ the end
*/
create table speaking_topics(
  code char(10)                                               
 ,title char(20) not null
 ,last_given char(20)
 ,time_given number(3)
 ,fac_num_fke integer 
 ,constraint code_pk primary key(code)
 ,constraint fk_spk_top_fac_num
  foreign key(fac_num_fke)
  references faculty(fac_num)
);

/*
If you want to DROP these tables, you must do so in a specific order,
since they reference each other.

You must also take an extra step to break the link btwn
JOB_HISTORY and FACULTY.

The below script will do it, but I've commented it out to avoid accidental
execution.
*/

--drop table speaking_topics;
--alter table job_history drop constraint fk_fac_num;
--drop table faculty;
--drop table job_history;
--drop table departments; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T19:12:13.927

我不确定是否存在数据类型 INTERGER。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T19:14:56.773

您在 FACULTY 表定义中有错字：“INTERGER”而不是 INTEGER

在 JOB_HISTORY 中相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T20:29:48.247

Oracle 没有 INTEGER 数据类型。使用 NUMBER(10,0) 将保存 32 位整数样值。

Oracle 没有 NUMERIC 数据类型，需要使用 NUMBER(8,2)。

这主要是一个拼写错误的问题，但 Oracle 对其表数据类型非常挑剔。

# java - 将 ArrayList 添加到类中 - 它有什么作用？

> ID：769680
> 
> 赞同：1
> 
> 时间：2009-04-20T19:07:00.757
> 
> 标签：java, list, attributes, arraylist

继我的这个问题之后：[制作这个 Java 程序的最佳方法是什么？](https://stackoverflow.com/questions/754184/whats-the-best-way-to-make-this-java-program)

建议我在 Lecturer 类和 Course 类中存储一个列表。所以我做到了，它看起来像这样：

```
public class Lecturer
{
    private String id;  
    private String name;  
    List<Course> courses = new ArrayList<Course>();  // a list to hold the courses

    public Lecturer(String idIn, String nameIn)     // arguments of the constructor
    {
        id = idIn;
        name = nameIn;

    }

} 
```

除了有讲师列表之外，课程课程也是如此。但我不明白的是，在那里放置一个列表究竟有什么作用？因为我不知道在哪里放置 ArrayList 的方法，例如从中添加和删除讲师？

有人可以解释这样做的目的吗？

我使用另一种方法，该方法基本上是将数组列表及其方法放在讲师和课程的两个单独的类中，然后我只需将其作为属性添加到课程和讲师类中，例如：

```
public class Lecturer
{
    private String id;  
    private String name;  
    private CourseList courses;  // COurseList is the class with the arraylist and methods

    public Lecturer(String idIn, String nameIn)     // arguments of the constructor
    {
        id = idIn;
        name = nameIn;
        courses = new CourseList();
    }

} 
```

我希望我是有道理的，因为过去两周我一直坚持一件事，这似乎没有人能理解。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T19:20:40.537

使用第一种方法，您需要公开允许客户端代码向这些列表添加内容的方法。所以，你可以有：

```
public class Lecturer
{
    List<Course> courses = new ArrayList<Course>();  // a list to hold the courses

    public Lecturer(String idIn, String nameIn)
    {
        /* do stuff */
    }

    public void addCourse(Course newCourse)
    {
        this.courses.add(newCourse);
    }
} 
```

您可以为 Course 课程做类似的事情。完成这些设置后，您可以执行以下操作：

```
public static void main(String[] args)
{
    Lecturer bob = new Lecturer(1, "Bob Smith");
    Course math = new Course("Math 101");

    // wire them together such that Bob teaches Math 101
    bob.addCourse(math);
    math.addLecturer(bob);
} 
```

我认为这可以解决您的问题，但是这种双向循环关系有时是设计不佳的标志。不过，只有你知道你真正的任务是什么，所以我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:16:16.723

正如有人在上一个问题中回答的那样，我建议使用`Map<Lecturer, List<Course>>`，这意味着“`Map`不同讲师 ( ) 之间的关联 ( )`Lecturer`与他们教授的课程列表( ) 之间的关联 ( ) `List<Course>`，您可以将其实例化为 `new HashMap<Lecturer, List<Course>>`。否则，存储每个列表，您将复制功能。

一旦您声明了`Course`s `c1, c2, ..., cn`a`Lecturer` `l`教授，您将它们关联到`Map` `m`as `m.put(l, c)`where `c`is a`List`课程中，声明为`new LinkedList<Course>()`，并添加为`c.add(c1); c.add(c2); ... c.add(cn);`。

如果我清楚地解释自己。

您可以阅读[http://java.sun.com/docs/books/tutorial/collections/interfaces/map.html](http://java.sun.com/docs/books/tutorial/collections/interfaces/map.html)和[http://java.sun.com/docs/books/tutorial/collections/implementations/map.html](http://java.sun.com/docs/books/tutorial/collections/implementations/map.html)有关使用`Map`s 的更多帮助。

要获得反向关联，您可以轻松使用以下代码：

```
Collection<Course> courses = m.values();
Map<Course, List<Lecturer>> reverseAssociation = new HashMap<Course, List<Lecturer>>;

    for (Course course : courses) {
        List<Lecturer> lecturersTeachingCourse = new LinkedList<Lecturer>();

        for (Lecturer lecturer : m.keySet()) {
            if (lecturer.teaches(course)) {
                lecturersTeachingCourse.add(lecturer);
            }
        }

        coursesTaught.put(course, lecturersTeachingCourse);
    } 
```

其中，只要`Lecturer.teaches(Course)`查询讲师是否教授通过的课程，设置`reverseAssociation`为课程-讲师关联。（当然，您应该将该代码封装为 Lecturers 中的方法）。

祝JavaNoob好运！我们都去过一次！

# asp.net - 信用卡重复交易

> ID：769682
> 
> 赞同：2
> 
> 时间：2009-04-20T19:07:36.027
> 
> 标签：asp.net, credit-card

防止用户重复信用卡交易的最佳方法是什么？无论是多次单击提交按钮，还是从收据页面返回并再次单击提交按钮。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T19:17:38.093

您可以生成一个唯一值，并将其置于隐藏形式中。在您向信用卡收费之前，请确保尚未处理此唯一值。再加上 CodeToGlory 的禁用按钮的建议应该可以解决您的两个用例。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T19:10:39.123

几种方法：

1.  单击后立即禁用该按钮。

2.  有一个批处理程序可以在当天晚些时候从结算中删除重复项，这样他们就不会被收费。

3.  使用某种模式窗口来阻止用户导航，直到信用卡交易被处理。[Jquery 有可以为你工作的 block.UI 插件。](http://malsup.com/jquery/block/#page)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T20:00:23.250

大多数银行要求您提供**唯一的**订单 ID，因此无法为同一订单收取两次费用。

现在，如果您要求防止重复提交，标准方法是**[Post/Redirect/Get 模式](http://en.wikipedia.org/wiki/Post/Redirect/Get)**。您还可以将其与使用 JavaScript 停用提交按钮结合起来。

你会有：

1.  **order_form.aspx**，生成**唯一的**订单 ID 并通过**POST**提交到
2.  **proces_order.aspx**做实际工作，清空购物篮，然后**重定向**到
3.  **谢谢你.html**

现在，如果用户点击重新加载，只会重新加载 static `thankyou.html`。如果他选择点击返回，则返回`order_form.aspx`，但他的篮子已经空了。如果它以某种方式被缓存，它将使用相同的订单 ID 进行缓存，因此没有收取两次费用的风险。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T19:16:45.257

将某种同步机制添加到您的后端系统，以便在任何一个时间点只有一个线程可以将“待收费”记录处理到您的基础数据源中。在此同步区域内，添加检查以确保数据源中不存在即将处理的费用。如果确实发生了这样的错误，请确保向客户输出某种优雅的消息——至少在后端不会是致命的。

正如 CodeToGlory 所建议的，它还有助于在 UI 级别添加第二层保护。这将最大限度地减少这种情况发生的次数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T20:33:33.247

订购后立即删除购物篮物品并禁用提交按钮。

在这种情况下，即使用户回来，刷新等也不能买两次，因为篮子里没有东西可以买。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-14T10:20:30.367

您可以在客户进入第一个结帐页面时创建会话，然后在按下提交按钮时强制会话超时。这样，客户必须重新开始结帐过程。

# postgresql - PostgreSQL：在 PostgreSQL 中显示表

> ID：769683
> 
> 赞同：2155
> 
> 时间：2009-04-20T19:07:39.210
> 
> 标签：postgresql

`show tables`PostgreSQL 中（来自 MySQL）的等价物是什么？

* * *

## 回答 #1

> 赞同：3085
> 
> 时间：2009-04-20T19:12:57.420

从命令行`psql`界面，

首先，选择你的数据库

```
\c database_name 
```

然后，这将显示当前架构中的所有表：

```
\dt 
```

* * *

以编程方式（`psql`当然也可以通过界面）：

```
SELECT * FROM pg_catalog.pg_tables; 
```

系统表存在于`pg_catalog`数据库中。

* * *

## 回答 #2

> 赞同：219
> 
> 时间：2012-02-16T10:13:20.900

以超级用户身份登录：

```
sudo -u postgres psql 
```

您可以按命令列出所有数据库和用户`\l`，（按 列出其他命令`\?`）。

现在，如果您想查看其他数据库，您可以通过`\c`类似命令更改用户/数据库`\c template1`，`\c postgres postgres`并使用`\d`，`\dt`或`\dS`查看表/视图/等。

* * *

## 回答 #3

> 赞同：175
> 
> 时间：2017-11-08T17:07:14.167

您可以使用 PostgreSQL 的交互式终端 Psql 来显示 PostgreSQL 中的表。

**1.启动Psql**

通常可以运行以下命令进入psql：

```
psql DBNAME USERNAME 
```

例如，`psql template1 postgres`

您可能遇到的一种情况是：假设您以 root 身份登录，但您不记得数据库名称。您可以通过运行首先进入 Psql：

```
sudo -u postgres psql 
```

在某些系统中，sudo 命令不可用，您可以改为运行以下任一命令：

```
psql -U postgres
psql --username=postgres 
```

**2\. 显示表格**

现在在 Psql 中，您可以运行以下命令：

1.  `\?`列出所有命令
2.  `\l`列出数据库
3.  `\conninfo`显示有关当前连接的信息
4.  `\c [DBNAME]`连接到新数据库，例如，`\c template1`
5.  `\dt`列出公共模式的表
6.  `\dt <schema-name>.*`列出某些模式的表，例如，`\dt public.*`
7.  `\dt *.*`列出所有模式的表
8.  然后可以运行 SQL 语句，例如，`SELECT * FROM my_table;`（注意：语句必须以分号结束`;`）
9.  `\q`退出 psql

* * *

## 回答 #4

> 赞同：142
> 
> 时间：2009-04-21T09:55:03.570

（为了完整性）

您还可以查询（SQL 标准）[信息架构](http://www.postgresql.org/docs/current/static/information-schema.html)：

```
SELECT
    table_schema || '.' || table_name
FROM
    information_schema.tables
WHERE
    table_type = 'BASE TABLE'
AND
    table_schema NOT IN ('pg_catalog', 'information_schema'); 
```

* * *

## 回答 #5

> 赞同：57
> 
> 时间：2013-11-22T13:33:35.447

1.  首先以 postgres 用户身份登录：

    `sudo su - postgres`

2.  连接到所需的数据库：`psql -d databaseName`

3.  `\dt`将返回您连接到的数据库中所有表的列表。

* * *

## 回答 #6

> 赞同：51
> 
> 时间：2018-11-15T08:41:58.777

以超级用户身份登录，以便您可以检查所有数据库及其模式：-

```
sudo su - postgres 
```

然后我们可以使用以下命令进入 postgresql shell：-

```
psql 
```

您现在可以使用以下命令检查所有数据库列表：-

```
\l 
```

如果您还想检查数据库的大小，请使用：-

```
\l+ 
```

按`q`返回。

找到数据库后，您可以使用以下命令连接到该数据库：-

```
\c database_name 
```

连接后，您可以通过以下方式检查数据库表或架构：-

```
\d 
```

现在返回到 shell 使用：-

```
q 
```

现在进一步查看某个表使用的详细信息：-

```
\d table_name 
```

要返回 postgresql_shell，请按`\q`。

并返回终端按`exit`。

* * *

## 回答 #7

> 赞同：45
> 
> 时间：2012-07-02T00:48:08.703

使用 -E 标志运行 psql 将回显内部用于实现 \dt 和类似的查询：

```
sudo -u postgres psql -E

postgres=# \dt       
********* QUERY **********
SELECT n.nspname as "Schema",
c.relname as "Name", 
CASE c.relkind WHEN 'r' THEN 'table' WHEN 'v' THEN 'view' WHEN 'i' THEN 'index' WHEN 'S' THEN 'sequence' WHEN 's' THEN 'special' END as "Type",
pg_catalog.pg_get_userbyid(c.relowner) as "Owner"
FROM pg_catalog.pg_class c
    LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
WHERE c.relkind IN ('r','')
    AND n.nspname <> 'pg_catalog'
    AND n.nspname <> 'information_schema'
    AND n.nspname !~ '^pg_toast'
AND pg_catalog.pg_table_is_visible(c.oid)
ORDER BY 1,2;        
************************** 
```

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2016-06-09T06:15:17.223

仅使用查看表格

```
=> \dt 
```

如果想查看模式表

```
=>\dt+ 
```

如果您想查看特定的架构表

```
=>\dt schema_name.* 
```

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2014-11-02T06:45:28.353

如果您只想查看已创建的表列表，您可能只会说：

`\dt`

但我们也有`PATTERN`哪些可以帮助您自定义要显示的表格。要显示包括`pg_catalog`Schema 在内的所有内容，您可以添加`*`.

`\dt *`

如果你这样做：`\?`

> \dt[S+] [PATTERN] 列出表格

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2013-06-27T15:45:34.777

首先使用以下命令连接数据库

```
\c database_name 
```

你会看到这条消息 - `You are now connected to database database_name`。他们运行以下命令

```
SELECT * FROM table_name; 
```

在 database_name 和 table_name 中，只需更新您的数据库和表名

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2017-06-05T02:18:02.513

如果您在 PostgreSQL 中使用 pgAdmin4，您可以使用它来显示数据库中的表：

```
select * from information_schema.tables where table_schema='public'; 
```

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2017-06-25T17:41:14.697

```
select 
  * 
from 
  pg_catalog.pg_tables 
where 
  schemaname != 'information_schema' 
  and schemaname != 'pg_catalog'; 
```

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2017-12-23T04:05:05.587

请注意，`\dt`仅此一项就会列出您正在使用的数据库的**公共架构中的表。**我喜欢将我的表保存在单独的模式中，所以接受的答案对我不起作用。

*要列出特定架构中的*所有表，我需要：

1）连接到所需的数据库：

```
psql mydb 
```

2）在命令之后指定我想查看表的模式名称`\dt`，如下所示：

```
\dt myschema.* 
```

这向我展示了我感兴趣的结果：

```
 List of relations
 Schema   |       Name      | Type  |  Owner   
----------+-----------------+-------+----------
 myschema | users           | table | postgres
 myschema | activity        | table | postgres
 myschema | roles           | table | postgres 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2015-03-06T23:29:41.413

\dt (no * required) -- 将列出您已经连接到的现有数据库的所有表。还需要注意：

\d [table_name] -- 将显示给定表的所有列，包括类型信息、引用和键约束。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2014-05-07T19:31:52.850

您可以使用 列出当前数据库中的表`\dt`。

Fwiw，`\d tablename`将显示有关给定表的详细信息，类似于`show columns from tablename`MySQL，但包含更多信息。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2019-11-15T21:48:49.203

根据我的口味，在命令行列出所有表的最直接方法是：

```
psql -a -U <user> -p <port> -h <server> -c "\dt" 
```

对于给定的数据库，只需添加数据库名称：

```
psql -a -U <user> -p <port> -h <server> -c "\dt" <database_name> 
```

它适用于 Linux 和 Windows。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2015-12-17T01:03:15.027

`\dt`将列出表格，并`\pset pager off`在同一窗口中显示它们，而无需切换到单独的窗口。爱死 dbshel​​l 中的那个特性。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2018-04-10T08:56:48.280

* * *

使用**psql** : \dt

或者：

```
SELECT c.relname AS Tables_in FROM pg_catalog.pg_class c
        LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
WHERE pg_catalog.pg_table_is_visible(c.oid)
        AND c.relkind = 'r'
        AND relname NOT LIKE 'pg_%'
ORDER BY 1 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2021-09-16T14:46:57.437

这些步骤对我`PostgreSQL 13.3`有用`Windows 10`

1.  打开cmd并输入`psql -a -U [username] -p [port] -h [server]`
2.  键入`\c [database]`以连接到数据库
3.  输入`\dt`或`\d`显示所有表格

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2017-07-19T10:56:06.417

首先你必须连接你的数据库，比如

我的数据库是**ubuntu**

使用此命令连接

```
 \c ubuntu 
```

此消息将显示

> “您现在以用户“postgres”的身份连接到数据库“ubuntu”。”

现在

运行此命令以显示其中的所有表

```
\d+ 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2019-02-15T10:26:35.987

作为一个快速的oneliner

```
# just list all the postgres tables sorted in the terminal
db='my_db_name'
clear;psql -d $db -t -c '\dt'|cut -c 11-|perl -ne 's/^([a-z_0-9]*)( )(.*)/$1/; print' 
```

或者，如果您更喜欢更清晰的 json 输出 multi-liner ：

```
IFS='' read -r -d '' sql_code <<"EOF_CODE"
    select array_to_json(array_agg(row_to_json(t))) from (
        SELECT table_catalog,table_schema,table_name 
        FROM information_schema.tables
        ORDER BY table_schema,table_name ) t
EOF_CODE
psql -d postgres -t -q -c "$sql_code"|jq 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2020-08-25T13:45:08.980

此 SQL 查询适用于 PostgreSQL 的大多数版本并且相当简单。

```
select table_name from information_schema.tables where table_schema='public' ; 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2020-09-03T23:22:04.270

1.  登录后在 PostgreSQL 命令行界面中，键入以下命令以连接所需的数据库。

    ```
     \c [database_name] 
    ```

然后你会看到这条消息`You are now connected to database "[database_name]"`

2.  键入以下命令以列出所有表。

    ```
     \dt 
    ```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2019-02-12T20:20:57.077

要在 psql 中查看外部表，请运行`\dE`

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-06-20T14:03:44.780

首先，您可以使用 mac 上的 postgre.app 或 postico 连接您的 postgres 数据库。运行以下命令：

```
psql -h localhost -p port_number -d database_name -U user_name -W 
```

然后你输入你的密码，这应该可以访问你的数据库

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2022-01-20T10:54:26.417

(MySQL) 显示当前数据库的表列表

```
show tables; 
```

(PostGreSQL) 显示当前数据库的表列表

```
select * from pg_catalog.pgtables where schemaname='public'; 
```

# linq - Linq：如何分配给相关实体？

> ID：769691
> 
> 赞同：0
> 
> 时间：2009-04-20T19:09:50.687
> 
> 标签：linq

如何以简单的方式分配给实体的相关对象？

```
properties=IList<property> 
```

linq 实体：人

人.属性

要将属性列表分配给 People.Properties，一些属性可能是新的，而另一些可能已经存在。如何以简单的方式将每个属性分配给 People.Property？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T19:48:48.113

只要您的 Property 类使用默认的相等比较器是可比较的，您就应该能够采用 set union 并将其分配给 properties 集合。

```
People.Properties = People.Properties.Union( properties ); 
```

# c - 为什么在 c 中定义的常量末尾使用'e0'？

> ID：769692
> 
> 赞同：1
> 
> 时间：2009-04-20T19:10:06.537
> 
> 标签：c, maintenance, scientific-notation

我正在尝试调试调用某些 c 程序进行文本编辑的 perl 应用程序的问题。

BATCH_JV_CSH_MAX 用于测试金额字段的最大值。如果金额超过 99,999,999.99，则当前指示错误。应该接受高达 999,999,999.99 的值。好吧，无论如何，这就是文档中所述的内容。

它在包含文件中：

```
#define PROJ_SZ 6
#define REF_SZ  9
#define DESC_SZ 22
#define TRAN_AMT_MAX  9999999999e0
#define BATCH_AMT_MAX 9999999999e0
#define BATCH_JV_CSH_MAX 99999999999e0
#define BATCH_CNT_MAX 99999 
```

我还不知道这个程序是如何工作的。它可能会去除除数字以外的任何值并连接字符。在继续之前，我想知道金额末尾的“e0”是什么意思。在我决定询问这个小组之前，我在 Safari 中的几本 c 编程书籍中进行了文本搜索。

此值在错误消息中打印，因此 '999999999' 比 1e9 更有意义

该值的使用方式如下：

```
/* Batch total amount 1 - debit dollars */
/* Check for overflow */

if (fabs(get_tot_amt1()) > BATCH_JV_CSH_MAX)
{
    fprintf(stderr, "\n*** Error: Transaction debit amount overflow\n");

    fprintf(stderr, "\n***        Maximum expected: %.0f\n",
        BATCH_JV_CSH_MAX);

    return (FALSE);
}

sprintf(in_batch_sum.batch_debit_amt, "%011.0f", get_tot_amt1()); 
```

get_tot_amt1() 获取一个值 tot_amt1，该值已在另一个 c 程序中计算。它是“静态双”。

是的，我有很多工作要做。这是读取以空格分隔的记录并写出固定格式记录的过程的一部分。

谢谢。凯茜

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T19:12:25.190

这意味着指数为 0。`5e0`也是`5 x 10^0 == 5 x 1 == 5`。我认为宏的定义只是为了给数字一个浮点类型（作为使用的替代方法`5.0`or `5f`。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T19:12:33.193

这是[科学记数法](http://en.wikipedia.org/wiki/Scientific_notation)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T19:12:57.667

99999999999e0 是一个浮点常数。末尾的“e0”表示“*10^0”。那是

```
1e2 = 100.0
1e-1 = .1
1e0 = 1.0 
```

等等

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T19:15:49.503

值 9999999999e0 是 C 表示科学记数法的方式

```
9999999999 * 10^0 
```

因此，如果您想允许最多 1,000,000,000.00 的数字，您可以使用

```
#define BATCH_JV_CSH_MAX 1e9 
```

哪个更容易阅读，IMO。但如果你更喜欢完整版，你可以使用

```
#define BATCH_JV_CSH_MAX 1000000000e0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T19:12:33.957

是科学记数法。它的意思是“乘以十的零次方”，或乘以 1。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T19:13:20.663

[http://en.wikipedia.org/wiki/Scientific_notation#E_notation](http://en.wikipedia.org/wiki/Scientific_notation#E_notation)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T19:13:36.107

999999999e0 是浮点表示。0 是 10 的指数。

9e0 == 9

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T19:16:45.037

当然看起来像一个指数：

NUMex - NUM x 10 ^x

例如，12.345e2 = 1234.5

# javascript - 有没有办法检测 HTML 元素何时从视图中隐藏？

> ID：769701
> 
> 赞同：0
> 
> 时间：2009-04-20T19:12:14.877
> 
> 标签：javascript, applet

使用 Javascript，是否可以检测某个元素何时不再可见，例如当用户向下滚动足够远或浏览器最小化或被另一个窗口覆盖时？总体目标是仅当当前广告对用户不可见时才换出广告。

一个想法是让一个非常简单的、不可见的 Java Applet 在每次调用 paint() 方法时与页面通信。我很确定这会起作用，但如果可能的话，我想避免使用小程序。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T19:17:54.630

我不确定是否有办法检测窗口是否在元素上方或窗口是否被最小化（尽管我认为您可以通过将某些东西挂在窗口的模糊中来完成后者？我不确定。 ..)。无论如何，就滚动而言，这部分问题之前已经被问过几次，这是我想出[的快速演示来展示如何做到这一点。](http://www.rootspot.com/stackoverflow/scrollintoview.html)在示例中，当元素滚动到视图中时会发生一些事情，但逻辑当然是相同的。无论如何，代码是：

```
$(document).ready(function() {
    function isScrolledIntoView(elem) {
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();

        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();

        return ((elemBottom >= docViewTop) && (elemTop <= docViewBottom));
    }

    var myelement = $('#formcontainer');
    var mymessage = $('#mymessage');
    $(window).scroll(function() {
        if(isScrolledIntoView(myelement)) {
            mymessage.hide();
        } else {
            mymessage.show();
        }
    });
}); 
```

没有太多特定于 jQuery 的内容，所以你可以把这些东西拿出来：

```
window.addEventListener('load', function() {
    function isScrolledIntoView(elem) {
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();

        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();

        return ((elemBottom >= docViewTop) && (elemTop <= docViewBottom));
    }

    var el = document.getElementById('myelement');
    window.addEventListener('scroll', function() {
        if(isScrolledIntoView(el)) {
            // do something when element is scrolled into view
        } else {
            // do something when it is not in view
        }
    }, false);
}, false); 
```

# asp.net - 不活动时停止 UpdatePanel

> ID：769714
> 
> 赞同：2
> 
> 时间：2009-04-20T19:14:42.237
> 
> 标签：asp.net, javascript, ajax, updatepanel

嗨，我想做以下事情：

当浏览器处于非活动状态时，使用 JavaScript 阻止更新面板“更新”，并在它再次处于活动状态时重新启动。我在看：[JavaScript 不活跃](http://www.beyondfusion.com/html/tutorial-autoclose.php)。我希望我可以用它来完成我想要的；有人能指出我正确的方向吗？非常感谢！

[编辑] 我正在使用定时器进行更新，所以如果我能以某种方式从 JavaScript 中禁用定时器，我想我可以做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T19:24:22.133

我推荐阅读这本书：[http://oreilly.com/catalog/9780596527471/](http://oreilly.com/catalog/9780596527471/)。它告诉您需要了解的有关 ASP.NET AJAX UpdatePanel 控件的所有信息。有关 API 文档，请访问：[http://msdn.microsoft.com/nb-no/library/bb311028(en-us).aspx](http://msdn.microsoft.com/nb-no/library/bb311028(en-us).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-08T01:22:08.163

```
window.blur = function() { stopTimer() }
window.focus = function() { startTimer() }
```

浏览器兼容性可能适用。希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T20:38:58.727

如何利用当前窗口对象的“mousemove”事件？如果鼠标已移动，则将计时器设置为 1 分钟左右，然后停用事件。使用 setInterval() 重复此循环。

如果用户打盹了一段时间，它也会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-08T01:03:52.017

在 head 事件中添加此脚本，

```
<script type ="text/javascript">
    var timerEnabled = true;

    function ToggleTimer(btn, timerID)
    {
        // Toggle the timer enabled state
        timerEnabled = !timerEnabled;

        // Get a reference to the Timer
        var timer = $find(timerID);
        if (timerEnabled)
        { 
            btn.value = 'Pause';
            // Start timer
            timer._startTimer();
        }
        else
        {
            btn.value = 'Resume'; 
            // Stop timer
            timer._stopTimer();
        }            
    }
</script> 
```

在更新面板中添加一个 asp.net 标签控件以进行测试

```
<asp:Label Id="Label1" Text="" runat="server" /> 
```

在更新面板外添加一个 html 按钮

```
<input type="button" id="btntimercontroller" value="Pause" onclick="return ToggleTimer(btntimercontroller, '<%= ajaxtimer.ClientID%>');" /> 
```

检查计时器是否停止在 aspx.cs 文件中添加此代码

```
protected void Page_Load(object sender, EventArgs e)
{       
    Label1.Text = DateTime.Now.ToLongTimeString();    
} 
```

只需省略脚本中的 (") 标记，因为它会导致错误...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-10T15:28:50.190

我在这里找到了一个潜在的解决方案：[http ://www.thefutureoftheweb.com/blog/detect-browser-window-focus](http://www.thefutureoftheweb.com/blog/detect-browser-window-focus)

我现在只有 IE8 可以测试，这有几个问题。首先，单击页面上的各种元素会触发`focusin`事件，因此您需要一种方法来检查计时器是否已经运行。这不是太难。ie8 还会`focusout`在您单击时触发事件，因此我们必须延迟实际的计时器停止以确保窗口实际上没有焦点。幸运的是，ie8 似乎总是在您单击页面`focusin`后立即触发，因此我们可以取消处理程序上的未决计时器关闭。`focusout``focusin`

我认为这应该非常接近一个可行的解决方案。（改编自链接）

```
// indicates if your refresh timer is running
var updatePanelTimerRunning = true;

// timer id for shutdown procedure
var killTimerID = -1;

function stopTimer(e) {
    // prepare to shutdown
    if (updatePanelTimerRunning && killTimerID == -1) {
        killTimerID = setTimeout(timerShutdown, 1000);
    }
}

function startTimer(e) {

    // cancel pending timer shutdown
    clearTimeout(killTimerID);
    killTimerID = -1;

    if (!updatePanelTimerRunning) {
        // TODO start the update panel refresh timer here
        updatePanelTimerRunning = true;
    }
}

function timerShutdown() {
    // TODO do actual update panel timer stopping here.
    updatePanelTimerRunning = false;
}

if (/*@cc_on ! @*/ false) { // check for Internet Explorer

    document.attachEvent('onfocusin', startTimer);
    document.attachEvent('onfocusout', stopTimer);
}
else {
    // window.onfocus = stopTimer;
    // window.onblur = startTimer;

    window.addEventListener('focus', startTimer, false);
    window.addEventListener('blur', stopTimer, false);
} 
```

# java - 为什么 java.util.Set 没有 get(int index)？

> ID：769731
> 
> 赞同：243
> 
> 时间：2009-04-20T19:19:40.460
> 
> 标签：java, data-structures, collections, set

我敢肯定有一个很好的理由，但是有人可以解释为什么`java.util.Set`缺少界面`get(int Index)`或任何类似的`get()`方法吗？

似乎集合非常适合放入东西，但我找不到从中检索单个项目的优雅方法。

如果我知道我想要第一个项目，我可以使用`set.iterator().next()`，但否则我似乎必须强制转换为 Array 以检索特定索引处的项目？

从集合中检索数据的适当方法是什么？（除了使用迭代器）

我确信它被排除在 API 之外的事实意味着有充分的理由不这样做 - 有人可以启发我吗？

**编辑：** 这里有一些非常棒的答案，还有一些说“更多上下文”。具体场景是 dbUnit 测试，我可以合理地断言从查询返回的集合只有 1 个项目，并且我试图访问该项目。

但是，如果没有这个场景，这个问题会更有效，因为它仍然更加集中：

*set 和 list 有什么区别*。

感谢所有人在下面提供出色的答案。

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-04-20T19:20:33.657

因为集合没有顺序。一些实现（尤其是那些实现`java.util.SortedSet`接口的实现），但这不是集合的一般属性。

如果您尝试以这种方式使用集合，则应考虑改用列表。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2010-05-30T00:55:09.507

实际上，在编写使用对象关系映射（例如使用 Hibernate）的 JavaEE 应用程序时，这是一个反复出现的问题；在所有在这里回答的人中，只有 Andreas Petersson 理解了真正的问题并给出了正确的答案：Java 缺少 UniqueList！（或者您也可以将其称为 OrderedSet 或 IndexedSet）。

Maxwing 提到了这个用例（其中你需要有序且唯一的数据），他建议使用 SortedSet，但这并不是 Marty Pitt 真正需要的。

这个“IndexedSet”与 SortedSet 不同——在 SortedSet 中，元素通过使用 Comparator（或使用它们的“自然”排序）进行排序。

但相反，它更接近 LinkedHashSet（其他人也建议），甚至更接近（也不存在的）“ArrayListSet”，因为它保证元素以与插入时相同的顺序返回。

但是 LinkedHashSet 是一个实现，而不是一个接口！需要一个IndexedSet（或ListSet，或OrderedSet，或UniqueList）接口！这将允许程序员指定他需要具有特定顺序且没有重复的元素集合，然后使用任何实现（例如 Hibernate 提供的实现）实例化它。

由于JDK是开源的，也许这个接口最终会包含在Java 7中......

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-04-20T19:31:46.687

[只需添加mmyers 的回答](https://stackoverflow.com/questions/769731/why-doesnt-java-utils-set-have-getint-index/769732#769732)中未提及的一点。

> 如果我知道我想要第一个项目，我可以使用 set.iterator().next()，但否则我似乎必须强制转换为一个数组来检索特定索引处的项目？
> 
> 从集合中检索数据的适当方法是什么？（除了使用迭代器）

您还应该熟悉[`SortedSet`](http://java.sun.com/javase/7/docs/api/java/util/SortedSet.html)接口（其最常见的实现是[`TreeSet`](http://java.sun.com/javase/7/docs/api/java/util/TreeSet.html)）。

SortedSet 是一个 Set （即元素是唯一的），它通过元素的*自然顺序*或使用 some保持有序`Comparator`。`first()`您可以使用和`last()`方法轻松访问第一个和最后一个项目。A`SortedSet`每隔一段时间就会派上用场，当您需要保持您的收藏不重复并以某种方式排序时。

**编辑**：如果您需要一个 Set 其元素按插入顺序保存（很像 List），请查看[`LinkedHashSet`](http://java.sun.com/javase/7/docs/api/java/util/LinkedHashSet.html).

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-04-21T09:42:30.090

这种问题会引出什么时候应该使用集合以及什么时候应该使用列表的问题。通常，建议是：

1.  如果您需要有序数据，请使用 List
2.  如果您需要唯一数据，请使用 Set
3.  如果两者都需要，请使用：SortedSet（用于按比较器排序的数据）或 OrderedSet/UniqueList（用于按插入排序的数据）。不幸的是，Java API 还没有 OrderedSet/UniqueList。

经常出现的第四种情况是您两者都不需要。在这种情况下，您会看到一些程序员使用列表，而一些程序员使用集合。就我个人而言，我发现将 set 视为一个没有排序的列表是非常有害的——因为它实际上是一个完全不同的野兽。除非您需要诸如设置唯一性或设置相等性之类的东西，否则请始终使用列表。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-04-20T21:25:20.407

我不确定是否有人以这种方式准确地拼写出来，但您需要了解以下内容：

**集合中没有“第一个”元素。**

因为，正如其他人所说，集合没有顺序。集合是一个数学概念，具体不包括排序。

当然，您的计算机无法真正保留内存中未排序的内容列表。它必须有一些排序。在内部，它是一个数组或链表或其他东西。但你并不真正知道它是什么，它也没有真正的第一个元素；出现“第一个”的元素是偶然出现的，下次可能不会是第一个。即使你采取了措施来“保证”一个特定的第一个元素，它仍然是偶然出现的，因为你只是碰巧把它用于一个特定的 Set 实现；不同的实现可能不适用于您所做的事情。而且，事实上，您可能并不像您认为的那样了解您正在使用的实现。

人们遇到了这一切。这。时间。与RDBMS系统，不明白。RDBMS 查询返回一组记录。这与数学中的集合类型相同：项目的无序集合，只有在这种情况下项目是记录。除非您使用 ORDER BY 子句，否则 RDBMS 查询结果根本没有保证的顺序，但是人们一直认为它确实如此，然后有一天当他们的数据或代码的形状发生轻微变化并触发查询优化器工作时，他们自己就会出错一种不同的方式，突然间结果并没有按照他们期望的顺序出现。这些人通常是在数据库课程中（或在阅读文档或教程时）没有注意的人，当他们预先向他们解释查询结果没有保证的顺序时。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-28T07:29:23.397

标准 Java 集合中缺少一些数据结构。

袋子（与 set 类似，但可以多次包含元素）

UniqueList（有序列表，每个元素只能包含一次）

在这种情况下，您似乎需要一个唯一列表

[如果您需要灵活的数据结构，您可能会对Google Collections](http://code.google.com/p/google-collections/)感兴趣

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-01-19T12:37:24.913

没错，根据 Set 集合的定义，Set 中的元素没有排序。所以它们不能被索引访问。

但是为什么我们没有一个 get(object) 方法，不是通过提供索引作为参数，而是一个与我们正在寻找的对象相等的对象？通过这种方式，我们可以访问Set内部元素的数据，只需要知道equal方法使用的属性即可。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-01-07T11:54:18.463

如果您要通过集合中的索引进行大量随机访问，您可以获得其元素的数组视图：

```
Object[] arrayView = mySet.toArray();
//do whatever you need with arrayView[i] 
```

但是有两个主要缺点：

1.  它的内存效率不高，因为需要创建整个集合的数组。
2.  如果该集合被修改，该视图将变得过时。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-20T19:22:23.247

这是因为 Set 只保证唯一性，而没有说明最佳访问或使用模式。即，Set 可以是 List 或 Map，它们中的每一个都有非常不同的检索特性。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-04-20T20:25:23.733

我能想到在集合中使用数字索引的唯一原因是迭代。为此，使用

```
for(A a : set) { 
   visit(a); 
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-08-18T13:33:43.910

我遇到了我实际上想要一个通过索引访问的排序集的情况**（**我同意其他发布者的观点，即使用索引访问一个未排序的集是没有意义的）。一个例子是一棵树，我希望对孩子进行排序并且不允许重复的孩子。

我需要通过索引访问来显示它们，并且设置的属性可以派上用场来有效地消除重复。

在 java.util 或 google 集合中找不到合适的集合，我发现自己实现它很简单。基本思想是包装一个 SortedSet 并在需要通过索引访问时创建一个 List（并在 SortedSet 更改时忘记该列表）。当然，这只有在更改包装的 SortedSet 并且访问列表在 Collection 的生命周期中是分开的时才有效。否则，它的行为就像一个经常排序的列表，即太慢。

对于大量的孩子，这比我通过 Collections.sort 排序的列表提高了很多。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-04-01T11:39:59.147

请注意，只有 2 个基本数据结构可以通过索引访问。

*   **数组**数据结构可以通过具有`O(1)`时间复杂度的索引来实现`get(int index)`操作。
*   **LinkedList**数据结构也可以通过索引来访问，但是`O(n)`实现`get(int index)`操作具有时间复杂度。

在 Java 中，`ArrayList`是使用**Array**数据结构实现的。

而**Set**数据结构通常可以通过**HashTable/HashMap**或**BalancedTree**数据结构来实现，为了快速检测元素是否存在并添加不存在的元素，通常实现良好的**Set**可以实现`O(1)`时间复杂度`contains`操作。在 Java 中，是**Set**`HashSet`最常用的实现，它是通过调用API 来实现的，并且是使用**链表**（**Array**和**LinkedList**的组合）的单独链接来实现的。**`HashMap``HashMap`**

 ******由于**Set**可以通过不同的数据结构实现，所以没有`get(int index)`方法。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-05-21T18:13:23.067

Set*接口*没有 get index-type 调用甚至更基本的调用，例如 first() 或 last() 的原因是因为它是一个模棱两可的操作，因此是一个潜在的危险操作。如果一个方法返回一个 Set，并且您在其上调用 first() 方法，那么预期的结果是什么，因为泛型 Set 不保证排序？结果对象在方法的每次调用之间可能会有很大的不同，或者它可能不会让你陷入一种错误的安全感，直到你使用的库改变了下面的实现，现在你发现你的所有代码都中断了没有特别的理由。

此处列出的有关解决方法的建议很好。如果您需要索引访问，请使用列表。小心使用带有泛型 Set 的迭代器或 toArray，因为 a) 不能保证排序，b) 不能保证排序不会随着后续调用或不同的底层实现而改变。如果您需要介于两者之间的东西，SortedSet 或 LinkedHashSet 就是您想要的。

// 我确实希望 Set 接口有一个 get-random-element。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-01-27T14:09:04.923

如果您不介意要排序的集合，那么您可能有兴趣查看[indexed-tree-map](https://github.com/geniot/indexed-tree-map)项目。

增强的 TreeSet/ [TreeMap](https://github.com/geniot/indexed-tree-map/blob/master/src/main/java/com/dictiographer/collections/IndexedTreeMap.java)通过索引或获取元素的索引提供对元素的访问。该实现基于更新 RB 树中的节点权重。所以这里没有迭代或通过列表备份。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-06-10T08:42:26.363

`java.util.Set`是未排序项的集合。如果 Set 有 get(int index) 则没有任何意义，因为 Set 没有索引，而且您只能猜测值。

如果你真的想要这个，编写一个从 Set 中获取随机元素的方法。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-03-21T04:40:27.103

Set 是一个接口，它的一些实现类是 HashSet、TreeSet 和 LinkedHashSet。它在底层使用 HashMap 来存储值。因为 HashMap 不保留顺序，所以无法通过索引获取值。

您现在一定在想 Set 是如何使用 HashMap 的，因为 HashMap 存储了一个键值对，但 Set 没有。有效的问题。当您在 Set 中添加一个元素时，它在内部维护一个 HashMap，其中键是您要在 Set 中输入的元素，值是虚拟常量。下面是 add 函数的内部实现。因此，HashMap 中的所有键都将具有相同的常量值。

```
// Dummy value to associate with an Object in the backing Map
private static final Object PRESENT = new Object();

public boolean add(E e) {
    return map.put(e, PRESENT)==null;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-07-04T20:15:55.543

因为 Set 将唯一元素存储在随机位置，并且在内部它使用多个数据结构。即数组、链表、带有散列的树。

链接 [https://en.wikipedia.org/wiki/Set_(abstract_data_type)](https://en.wikipedia.org/wiki/Set_(abstract_data_type))

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2012-02-02T22:55:12.603

你可以做`new ArrayList<T>(set).get(index)`

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2010-06-20T10:19:55.907

要获取集合中的元素，我使用以下一个：

```
public T getElement(Set<T> set, T element) {
T result = null;
if (set instanceof TreeSet<?>) {
    T floor = ((TreeSet<T>) set).floor(element);
    if (floor != null && floor.equals(element))
    result = floor;
} else {
    boolean found = false;
    for (Iterator<T> it = set.iterator(); !found && it.hasNext();) {
    if (true) {
        T current = it.next();
        if (current.equals(element)) {
        result = current;
        found = true;
        }
    }
    }
}
return result;
} 
```

# anonymous-methods - CodeDom - 我可以生成一个匿名方法吗？

> ID：769733
> 
> 赞同：1
> 
> 时间：2009-04-20T19:20:36.760
> 
> 标签：anonymous-methods, codedom

我找不到任何方法来生成匿名方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T20:17:01.307

您可以尝试使用 CodeSnippetStatement() 来生成匿名方法。

# linq - linq 如何确定值的变化？

> ID：769737
> 
> 赞同：0
> 
> 时间：2009-04-20T19:21:26.960
> 
> 标签：linq, linq-to-sql

如果一个字段的值实际上并没有改变，而是重新分配了相同的值，那么在提交到数据库时，该重新分配是否会被标记为更新？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T19:24:18.810

是的，只需设置该属性即可将其标记为脏。

# wpf - 在项目控制中设置对新项目的关注

> ID：769741
> 
> 赞同：5
> 
> 时间：2009-04-20T19:22:07.053
> 
> 标签：wpf, data-binding, listbox

我有一个 ListBox，它通过数据绑定将新项目添加到其中（即，某些内容正在添加到列表中，并且框正在更新以包含新项目）。

列表框中的项目是可编辑的数据模板，所以问题是：添加新项目时如何将焦点设置到模板中的第一个字段？

我已经看过[这个问题](https://stackoverflow.com/questions/158536/setting-focus-on-a-control-within-a-controltemplate-in-wpf)，并会看看它是否能让我有所收获，但这并不是对我的问题的直接回应。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T19:40:45.463

您链接到的问题应该适用于您的特定情况。只要您使用 ObservableCollection 作为源，您就可以设置：

```
<ListBox IsSynchronizedWithCurrentItem="True" ItemsSource="{Binding MyCollection}" ItemTemplate="{StaticResource MyTemplate}/> 
```

这将确保在添加项目时，将焦点赋予新项目，然后焦点管理器（查看该线程中的第一个响应）应该将焦点赋予文本框。MSDN 文章提供了一个有用的示例，在此处放入模板：

```
<DataTemplate x:Key="MyTemplate" DataType="{x:Type Classes:MyClass}">    
  <StackPanel FocusManager.FocusedElement="{Binding ElementName=firstButton}">
    <Button Name="firstButton" />
  </StackPanel>
</DataTemplate> 
```

# subsonic - 使用列表 在 SubSonic Select 语句中？

> ID：769742
> 
> 赞同：1
> 
> 时间：2009-04-20T19:22:18.067
> 
> 标签：subsonic

我只是想知道你是否可以做这样的事情

```
List<string> maincolumns = new List<string>();
Select s = new Select(maincolumns) 
```

我知道我可以使用 string[] 但我需要建立查询，一旦我设置了 string[] 我就不能追加列:(

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T19:25:10.557

你可以做：

```
List<string> maincolumns = new List<string>();
// example appends...
maincolumns.Add("Column1");
maincolumns.Add("Column2");
Select s = new Select(maincolumns.ToArray()); 
```

# ios - iPhone 有没有好的图表库？

> ID：769749
> 
> 赞同：127
> 
> 时间：2009-04-20T19:23:24.070
> 
> 标签：ios, cocoa, cocoa-touch, charts, core-plot

我需要在我正在开发的 iPhone 应用程序中渲染和显示图表（现在是条形图，但以后可能需要更多类型）。我做了一些环顾四周，看起来还没有任何真正好的、成熟的 iPhone 图表库。我还寻找了在 Mac 上为 Cocoa 编写的可以改编的东西，但还没有发现任何很棒的东西。

以前有人处理过这个吗？有什么建议吗？

我确实找到了[Core Plot](https://github.com/core-plot/core-plot)，但它似乎处于开发的早期阶段。

编辑以添加一些要求的细节（因为他们目前的立场;））

*   条形图
*   水平条形图
*   双堆积条形图
*   轴标签（包括在 y 轴上旋转 90 度）
*   图表上每个条形上方的标签
*   阴影或自定义背景

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-04-20T20:46:29.970

推动 Core Plot 项目的众多因素之一是iPhone 上*缺乏*好的绘图框架。Core Plot 还包含许多其他用例，包括桌面系统，但它的设计从一开始就包括对 iPhone 的支持。它已经非常接近可用，目前已在多个 iPhone 和 OS X 应用程序中使用。

**编辑 2/10**

自从我第一次发布摘要以来，Core Plot 已经走了很长一段路。该框架现在具有条形图（我相信包括水平条形图）、轴标签（包括任意旋转）以及图形的填充和背景。我不确定堆叠条形图，但添加到`CPBarPlot`实现条形图的类中并不难。至于`CPAnotation`注释，如果没有您需要的确切功能，您可以子类化一个类来添加注释。

项目[在 github 上](https://github.com/core-plot)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-03-12T15:46:30.967

作为 CorePlot 的商业替代品，我建议[试一试 ShinobiControls](http://www.shinobicontrols.com/)，他们有一些非常漂亮的图表。它们还具有非常好的性能，以 60fps 的速度渲染超过 100,000 点的图表并支持多点触控。

*作为**全面披露**，我在 Scott Logic 工作，它是 ShinobiControls 的母公司。*

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-17T13:47:59.260

我有自己的名为[PowerPlot](http://powerplot.nua-schroers.de)的库，可在双许可模式下使用。

您可以按照上面的链接安装演示应用程序，该应用程序展示了几个示例图表。您还可以下载该库的 GPL 版本并检查它是否符合您的需求。除了水平条形图之外，它还具有所需的功能——特别是条形图、堆叠条形图、各种轴标签位置和方向。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-20T20:48:40.217

一两年前，我进行了自己的搜索，最终制作了自己的折线图课程，因为我找不到任何可以完全按照我需要的方式工作的东西。不过，要查看的两个大项目是[SM2DGraphView](http://developer.snowmintcs.com/frameworks/sm2dgraphview/index.html)和[GraphX](http://blog.oofn.net/projects/graphx/)。我还没有在 iPhone 项目中尝试过，但我知道 SM2DGraphView 是开源的，因此您可以根据需要对其进行修改。

我也考虑过使用 WebView 来使用 JavaScript 图形库，但这只是一个想法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-10-13T19:46:01.597

有新的、漂亮的饼图 3D 库。您可以使用手指旋转和缩放的 3D 图表 + 用于获取有关轻敲切片的信息的协议

[http://iphone.orpi.pl/?p=20](http://iphone.orpi.pl/?p=20)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-06-11T21:44:36.460

我需要一个雷达图（或蜘蛛网图），但我找不到，所以我自己实现了：

[RP雷达图](http://github.com/raspu/RPRadarChart "RP雷达图")

您可以随意使用它，如果您愿意，请告诉我！我会慢慢添加更多的功能，如果你想通过github问我一些具体的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T22:07:35.533

理论上，您可以将[Google Chart API](http://code.google.com/apis/chart/)与[Cocoa 包装器](http://groups.google.com/group/google-chart-api/web/useful-links-to-api-libraries)一起使用。这可能是一个轻量级的解决方案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-14T08:28:31.997

这个好像也不错

[s7graphview](http://code.google.com/p/s7graphview/)

（但从未真正尝试过）。

# c# - 在计时器上的 ListBox 中的 DataTemplate 之间滚动

> ID：769756
> 
> 赞同：1
> 
> 时间：2009-04-20T19:24:29.357
> 
> 标签：c#, wpf, listbox

我现在正在处理一个项目，在该项目中，我需要为整个应用程序中显示在 ListBoxes 中的 DataTemplates 自动进行动画滚动。基本上是 Javascript 中常见的东西，例如在计时器上运行的[Javascript 平滑滚动示例。](http://www.dezinerfolio.com/wp-content/uploads/smoothscrolldemo/df_smooth_scroll.html)

我见过其他一些人发布类似的问题[，](https://silverlight.net/forums/t/66914.aspx)但我还没有真正看到有人优雅地实现它。我已经尝试在 ScrollViewer 中覆盖 LineDownCommand，但这并不是我真正想要完成的（也不是 CanContentScroll="False"）。在实现此功能之前，我已经暂时使用了 BringIntoView，但这并不能完全满足我的需要。

有没有其他人有任何运气来实现这一点或有任何正确方向的指示？我在这里的时间很短。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T19:16:21.070

您真正需要做的是实现您自己的从 ContentControl 派生的 ScrollViewer。通过这样做，您可以完全控制所有滚动并实现您自己的特殊命令来启动自动平滑滚动。如果您在实现它时遇到问题，您可以随时使用 WPF 模板和 Reflector 来了解 Microsoft 是如何做到的。

# ms-access - 使用没有 MAPI 的 Access 和 VBA 发送电子邮件

> ID：769763
> 
> 赞同：5
> 
> 时间：2009-04-20T19:26:19.947
> 
> 标签：ms-access, email, vba, ms-access-2007, mapi

我想使用 VBA 在无人值守的情况下从 Microsoft Access 发送电子邮件。我知道内置方法“SendObject”使用 MAPI 表示安全提示和类似 Outlook 配置的东西。因为我想使用任务计划程序来启动不同的报告，所以我倾向于远离 MAPI，并且更喜欢其他一些解决方案。不是运输申请，而是内部申请。想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T21:03:35.630

这是适用于 CDO 和 gmail 的测试代码。

```
Sub mtest()

Dim cdoConfig
Dim msgOne

Set cdoConfig = CreateObject("CDO.Configuration")
With cdoConfig.Fields
.Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
.Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = 465
.Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "smtp.gmail.com"
.Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = "gmailname"
.Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = "yourpw"

.Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
.Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1

.Update
End With

Set msgOne = CreateObject("CDO.Message")
Set msgOne.Configuration = cdoConfig
msgOne.To = "target@target.com"
msgOne.From = "I@dontThinkThisIsUsed.com"
msgOne.Subject = "Test email"
msgOne.TextBody = "It works just fine"
msgOne.send
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T19:36:19.967

您需要一个允许您发送电子邮件的 SMTP 服务器。然后您需要使用 CDO 消息对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:23:59.993

您可能会发现 Tony Toews 的[Access EMail FAQ](http://www.granite.ab.ca/access/email.htm)很方便。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T21:13:25.857

我是这样做的，注意，你必须安装 Outlook 才能工作。

```
 Sub btnSendEmail_Click()
    Dim OutApp As Object
    Dim OutMail As Object

    Application.ScreenUpdating = False
    Set OutApp = CreateObject("Outlook.Application")
    OutApp.Session.Logon

    strBody = "<html><head></head><body>"
    strBody = strBody & "Your message goes here"
    strBody = strBody & "</body></html>"

    Set OutMail = OutApp.CreateItem(0)

    OutMail.To = "name@example.com"
    OutMail.BCC = "bcc@example.com"
    OutMail.Subject = "Test message"
    OutMail.HTMLBody = strBody

    OutMail.Send  'Send | Display
    Set OutMail = Nothing
End Sub 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-11T06:25:24.550

Outlook Redemption 是免费的并且使用非常广泛：[http ://www.dimastr.com/redemption/](http://www.dimastr.com/redemption/)

它非常接近原始的 Outlook 对象模型，因此学习曲线很简单：）

# java - 异步 Web 服务流式传输

> ID：769764
> 
> 赞同：3
> 
> 时间：2009-04-20T19:26:55.840
> 
> 标签：java, web-services, asynchronous, streaming

我需要一些框架来帮助我通过 http 进行异步流式传输。它可能看起来像 SOAP WS 或其他东西。我不知道我是否正确命名它，所以这是我需要的：

ServerA 想通过 http 向远程 ServerB 发出请求。该请求包含任意信息。它的结果将包含多个相同类型的记录。其中一些可立即使用，其他可稍后使用。ServerA 希望尽快获得可用的结果，而不是等到所有结果都可用。在现实世界中，ServerB 将搜索不同的数据源，其中一些数据源的响应速度更快。

我可以想到3种解决方案。首先ServerA生成请求的随机id，执行SOAP请求

```
void ServerB.startSearch(id, request); 
```

这将立即返回，然后 A 定期调用

```
Result[] ServerB.areThereAnyNewResults(id); 
```

因此 ServerA 轮询 ServerB 以获得新的结果。我将此方法称为轮询。它涉及从 A 到 B 建立的多个连接。另一种解决方案是在 ServerA 端公开接收服务，例如

```
ServerA.acceptResults(String id, Result[] newResults); 
```

并打电话

```
ServerB.startSearch(id, request, serverAReceivingServiceEndpoindAddress); 
```

因此，当有新结果可用时，ServerB 会将新结果推送到 ServerA.acceptResults()。我称之为推。它涉及从 A 到 B 建立 1 个连接和从 B 到 A 建立多个连接。

另一种选择是在单个响应中通过相同的 http 通道流式传输结果。

A 执行 http 调用（我不知道它是否可以是 SOAP 或者应该是其他东西），B 开始搜索，当有新结果可用时，它通过 http 流发送它们并刷新它，因此它们可能在 A 上可用马上一边。在所有结果可用之前，它不会关闭 http 连接。它只涉及从 A 到 B 的单一连接，这就是我更喜欢使用它的原因。我称之为流媒体。我了解，如果某些代理正在缓冲响应内容的途中，它可能无法正常工作。

所以，我的问题是是否有任何解决方案可以为我完成大部分工作。我想做的是在A端调用这样的代码

```
Service s = new RemoteAsyncService("http://serverb.com/serviceEndpoint", RemoteAsyncService.STREAMING); 
// or RemoteAsyncService.POLLING, or RemoteAsyncService.PUSHING
Request r = new Request(...);
Callback callback = new Callback(){
 void newResults(Result[] result){...}
 // e should be null if finished correctly
 void requestFinished(RemoteException e){...}
}
s.search(request, callback); 
```

并在ServerB端实现

```
public ServiceImpl implements Service{
  void search(Request r, Callback c){
   // perform search, call c.newResult() when new results are available
  }
} 
```

其余由框架处理，包括在断开连接时重新建立连接，如果由于缓冲代理无法完成流式传输，则下降到轮询/推送，在 ServerB 完成工作或抛出异常时调用 callback.requestFinished() 等。可能它还应该以某种标准方式处理身份验证。

那么，是否有任何解决方案可以抽象通信完成的方式，并且在可能的情况下能够进行流式传输？

如果没有，您认为将其作为开源实现有用吗？:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T20:11:30.663

您所说的听起来像是 COMET 服务。您可以在此处阅读 Wikipedia 条目：

[彗星（编程）](http://en.wikipedia.org/wiki/Comet_(programming))

不确定如何在 Java 中实现类似的东西，但在 .NET 中，您可以使用双工合同来实现 WCF 服务。您可以在此处阅读有关如何访问该服务并与之通信的更多信息：

[如何：使用双工合同访问服务](http://msdn.microsoft.com/en-us/library/ms731935.aspx)

# python - 如何使用 Python setuptools 为一组定义的鸡蛋加载入口点？

> ID：769766
> 
> 赞同：0
> 
> 时间：2009-04-20T19:27:37.197
> 
> 标签：python, setuptools, distutils, egg

我想在 setuptools 中使用入口点功能。

在很多情况下，我想严格控制正在运行的鸡蛋列表，以及有助于一组入口点的扩展：

*   鸡蛋集成测试，我想在不同的鸡蛋组合上运行多个测试套件。
*   扫描鸡蛋/插件的单个目录，以便运行同一程序的两个不同实例，但使用不同的鸡蛋。
*   开发时间，我正在开发一个或多个鸡蛋，并希望将程序作为正常编辑运行周期的一部分运行。

我查看了 setuptools 文档，虽然它没有说这是不可能的，但我一定错过了一些说明如何做的事情。

以不同于默认系统范围发现的方式部署插件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-16T10:20:14.213

如果您只是没有访问全局站点包的用户，我们正在解决类似的问题，使用 setup.py develop 的能力。到目前为止，我们用 virtualenv 解决了这个问题。

我想说这对你的情况也有帮助：在系统范围内安装最少（或明确排除它），用你想要的鸡蛋创建虚拟环境并在那里测试。

（或者，对于集成测试，创建干净的环境，安装 egg 并测试所有依赖项是否已安装）。

对于 2，我不确定，但它也应该适用于多个 virtualenvs。对于 3，setup.py develop 是要走的路。

# php - PDO 的 rowCount() 不适用于 PHP 5.2.6+

> ID：769767
> 
> 赞同：5
> 
> 时间：2009-04-20T19:27:51.657
> 
> 标签：php, pdo

所以我一直在使用 PHP 的 PDO 作为我的数据库 goto 类有一段时间了，不幸的是今天在客户端服务器上调试了一段时间后（安装了 PHP 5.2.6）我发现了[这个](http://bugs.php.net/bug.php?id=45080)。我们尝试升级到最新的稳定版本（5.2.9），但问题仍然存在。

有没有人找到解决方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-08-22T01:28:14.813

数据库可以为您计算行数的唯一方法是运行查询并计算行数。

默认情况下，mysql 扩展使用缓冲查询模式，这会导致在将控制权返回给 PHP 之前将整个数据集提取到内存中，并且它可以开始处理行。

PDO 默认使用无缓冲模式，这会降低页面加载时间的延迟，这通常是您想要的。权衡是 rowCount() 在获取整个数据集之前不会返回有效信息。

那你怎么得到这个数呢？

简单的：

```
$q = $db->query("SELECT ...");
$rows = $q->fetchAll();
$rowCount = count($rows);
echo "There are $rowCount rows\n";
foreach ($rows as $row) {
    print_r($row);
} 
```

> 但这很糟糕，因为它会预先查询所有行并使我的页面加载速度变慢，旧的 mysql 扩展没有这个问题！？

但这正是旧的 mysql 扩展实际上在幕后所做的事情；这是获得该计数的唯一方法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T20:54:14.400

您可以通过 MySQL 本身使用[function来](http://dev.mysql.com/doc/refman/5.1/en/information-functions.html#function_found-rows)[完成`FOUND_ROWS()`](http://dev.mysql.com/doc/refman/5.1/en/information-functions.html#function_found-rows)，不确定是否有更好的选择。

**编辑：**似乎 MySQL 可能的唯一原因是因为它在内部获取所有结果行并缓冲它们，以便能够为您提供此信息。见[`mysql_unbuffered_query()`](http://php.net/mysql_unbuffered_query)。如果您使用该功能而不是`mysql_query()`，该`mysql_num_rows()`功能将不起作用。如果您在使用 PDO 时确实需要知道行数，您可以将 PDO 中的所有行提取到一个数组中，然后使用`count()`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-22T17:08:53.783

请注意，您不应将 rowCount() 用于 SELECT 查询，因为 PDOStatement->rowCount() 返回受相应 PDOStatement 对象执行的最后一个 DELETE、INSERT 或 UPDATE 语句影响的行数。

相反，您可以在数组中使用 fetchAll()，然后使用 count()。

# django - django左加入

> ID：769769
> 
> 赞同：1
> 
> 时间：2009-04-20T19:28:58.627
> 
> 标签：django, left-join

我有一点左连接问题。我有以下型号

```
class CommandInfo(models.Model):
    server = models.ForeignKey(Server)
    count = models.IntegerField(default=1)
    ts = models.DateTimeField(auto_now=True)

class Server(models.Model):
    name = models.CharField(max_length=100)
    group = models.ForeignKey(ApplicationGroup, blank=True, default=0)
    host = models.CharField(max_length=100)
    ip = models.IPAddressField(db_index=True)
    about = models.TextField()
    firstTS = models.DateTimeField(auto_now_add=True)
    lastTS = models.DateTimeField(auto_now=True)
    processed = models.SmallIntegerField(max_length=1, default=0)

    def __unicode__(self):
        return self.host 
```

我需要获取所有服务器实例，如果有的话，我需要将 CommandInfo 加入其中。

现在我正在使用原始 sql

```
from django.db import connection
cursor = connection.cursor()
cursor.execute("SELECT host,ts,count as host FROM servers_server LEFT JOIN cmds_commandinfo ON server_id=servers_server.id")
servers = cursor.fetchall() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T19:58:56.030

您可以使用如下代码：

```
s = Server.objects.get(id=1)
cmdinfo = s.commandinfo_set.all() 
```

`s`这将返回已设置为外键的所有 CommandInfo 对象的列表。

您可以在 Django 文档“ [Following Relationships Backward](http://docs.djangoproject.com/en/dev/topics/db/queries/#following-relationships-backward) ”中获得更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T22:25:43.167

有时 Django ORM 需要使用 select_related() 显式命名左连接字段名称。

这只是我的想法，因此您可能需要对其进行调整，但请尝试以下操作：

```
s = Server.objects.select_related('commandinfo_set') 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-16T15:10:29.113

```
commands_by_server_id = defaultdict(list)
for c in CommandInfo.objects.select_related('server'):
  commands_by_server_id[c.server.id].append(c)

servers = Server.objects.all()
for s in servers:
  s.commands = commands_by_server_id.get(s.id, []) 
```

请注意，您需要获取服务器列表，因为您可以在没有 CommandInfo 的情况下使用服务器

# c# - 将数据视图复制到 C# 中的数据表的最简单方法？

> ID：769770
> 
> 赞同：19
> 
> 时间：2009-04-20T19:29:26.070
> 
> 标签：c#, datatable, dataview

我需要将数据视图复制到数据表中。似乎这样做的唯一方法是逐项遍历数据视图并复制到数据表中。一定有更好的方法。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-04-20T19:31:36.343

```
dt = DataView.ToTable() 
```

或者

`dt = DataView.Table.Copy()`,

或者

`dt = DataView.Table.Clone()`;

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-06-26T16:49:55.447

答案不适用于我的情况，因为我有带有表达式的列。`DataView.ToTable()`只会复制值，而不是表达式。

首先我尝试了这个：

```
//clone the source table
DataTable filtered = dt.Clone();

//fill the clone with the filtered rows
foreach (DataRowView drv in dt.DefaultView)
{
    filtered.Rows.Add(drv.Row.ItemArray);
}
dt = filtered; 
```

但该解决方案非常慢，即使只有 1000 行。

对我有用的解决方案是：

```
//create a DataTable from the filtered DataView
DataTable filtered = dt.DefaultView.ToTable();

//loop through the columns of the source table and copy the expression to the new table
foreach (DataColumn dc in dt.Columns) 
{
    if (dc.Expression != "")
    {
        filtered.Columns[dc.ColumnName].Expression = dc.Expression;
    }
}
dt = filtered; 
```

# php - PHP唯一的文本字段？

> ID：769774
> 
> 赞同：1
> 
> 时间：2009-04-20T19:30:37.377
> 
> 标签：php, mysql

我有一个表格，我又有一个带有 URL 的文本字段，我不想要任何具有重复 URL 的行，但我宁愿在插入之前不做检查，有没有办法使文本字段唯一或您能建议使用另一种字段类型吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-10-08T15:01:03.913

解决方案基本上是在数据库上添加一个额外的字段，如 field_hash，使其 VARCHAR 和 Index 赋予唯一性。

```
CREATE TABLE 'info' (
'text' text NOT NULL,
'text_hash' varchar(40) NOT NULL,
PRIMARY KEY ('id'),
UNIQUE KEY 'text_hash' ('text_hash')
);

$text = 'Full Text';
$text_hash = sha1($text);

mysql_query("INSERT INTO info (text, text_hash) VALUES ('$text', '$text_hash')"); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T19:33:31.037

如果您在数据库中的文本字段设置为唯一键或主键，或者您设置了它，那么插入语句将在尝试输入重复项时失败。这样，您所要做的就是正确处理失败的插入，然后就可以了。

正如在别处指出的那样，您不能让实际的 TEXT 字段是唯一的，但如果您使用的是 varchar 字段，它是可行的。这可能根本不重要（可能只是沟通不畅），因为如果您将 URL 存储在 TEXT 字段中，您还有其他问题需要担心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T19:32:44.923

您可以尝试使用另一个包含 URL 字段哈希的字段。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T20:46:27.663

正确的方法是检查表中是否存在url，如果存在则插入，否则不插入。

作为最佳实践，应在实际需要的地方使用异常处理，而不应将其用作普通功能的替代品。

# python - 在文件中突出但不完全重复的行

> ID：769775
> 
> 赞同：3
> 
> 时间：2009-04-20T19:30:37.470
> 
> 标签：python, algorithm, unix, grep, nlp

我正在梳理一个 webapp 的日志文件，以获得突出的语句。

大多数线条相似且无趣。我会通过 Unix 传递它们`uniq`，但是不会过滤任何内容，因为所有行都略有不同：它们都有不同的时间戳，类似的语句可能会打印不同的用户 ID，等等。

有什么方法和/或工具来获得与其他明显不同的线条？（但是，再次，不是精确的重复）

我正在考虑使用 Python 的[difflib](http://docs.python.org/library/difflib.html)，但这似乎是为了区分两个文件，而不是同一文件中的所有行对。

[编辑]

我假设该解决方案将为每一行给出一个唯一性分数。因此，我的意思是“显着不同”，我选择了一个阈值，该阈值必须超过唯一性得分才能使任何行包含在输出中。

在此基础上，如果还有其他可行的定义方式，欢迎讨论。此外，该方法不必具有 100% 的准确率和召回率。

[/编辑]

例子：

我更喜欢尽可能通用的答案。我知道我可以在开始时去掉时间戳。剥离结尾更具挑战性，因为它的语言可能与文件中的任何其他内容完全不同。这些细节是我之前回避具体例子的原因，但因为有人问......

类似1：

```
2009-04-20 00:03:57 INFO  com.foo.Bar - URL:/graph?id=1234
2009-04-20 00:04:02 INFO  com.foo.Bar - URL:/graph?id=asdfghjk 
```

类似2：

```
2009-04-20 00:05:59 INFO  com.baz.abc.Accessor - Cache /path/to/some/dir hits: 3466 / 16534, 0.102818% misses
2009-04-20 00:06:00 INFO  com.baz.abc.Accessor - Cache /path/to/some/different/dir hits: 4352685 / 271315, 0.004423% misses 
```

不同1：

```
2009-04-20 00:03:57 INFO  com.foo.Bar - URL:/graph?id=1234
2009-04-20 00:05:59 INFO  com.baz.abc.Accessor - Cache /path/to/some/dir hits: 3466 / 16534, 0.102818% misses 
```

在不同的 1 情况下，我希望返回两条线，但不希望返回类似它们的其他线。换句话说，这两条线是不同的类型（然后我可以稍后只要求统计上罕见的线类型）。一方面，这两者之间的编辑距离要大得多。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T19:35:08.927

定义“显着不同”。然后看看[“编辑距离”措施](http://en.wikipedia.org/wiki/Edit_distance)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T19:35:15.900

您可以尝试一些计算单词的代码，然后按最不常用单词对行进行排序。

如果这不起作用，您可以添加一些智能来过滤掉时间戳和数字。

您的问题类似于之前关于[生成新闻故事摘要的](https://stackoverflow.com/questions/742711/shorten-a-text-and-only-keep-important-sentences)问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T19:37:47.420

我不知道适合你的工具，但如果*我*要自己动手，我会这样处理：

大概日志行具有明确定义的结构，不是吗？所以

*   解析该结构上的行
*   编写一些非常基本的相关过滤器（只从解析的结构中返回一个简单数字的函数）
*   通过一组过滤器运行解析的行，并根据总分进行切割
*   可能通过更多过滤器的结果将剩余的行分类到不同的箱中
*   生成报告、将 bin 转储到文件或其他输出

如果您熟悉 unix 工具`procmail`，我建议为您的数据定制类似的处理方法。

* * *

正如评论中的 zacherates 所指出的，您的过滤器通常会忽略时间戳（可能还有 IP 地址），而只关注内容：例如，*非常*长的 http 请求可能代表攻击……或任何适用于您的域的内容。

您的分箱过滤器可能就像在几个选定字段上的哈希一样简单，或者您可能会尝试按照[查理马丁的建议](https://stackoverflow.com/questions/769775/the-lines-that-stand-out-in-a-file-but-arent-exact-duplicates/769790#769790)做一些事情并使用编辑距离度量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T02:21:56.390

也许您可以对“相同的单词”/“所有单词”进行基本计算？

例如（包括允许您忽略时间戳和“信息”一词的偏移量，如果它们始终相同）：

```
def score(s1, s2, offset=26):
    words1 = re.findall('\w+', s1[offset:])
    words2 = re.findall('\w+', s2[offset:])
    return float(len(set(words1) & set(words2)))/max(len(set(words1)), len(set(words2))) 
```

鉴于：

```
>>> s1
'2009-04-20 00:03:57 INFO  com.foo.Bar - URL:/graph?id=1234'
>>> s2
'2009-04-20 00:04:02 INFO  com.foo.Bar - URL:/graph?id=asdfghjk'
>>> s3
'2009-04-20 00:05:59 INFO  com.baz.abc.Accessor - Cache /path/to/some/dir hits: 3466 / 16534, 0.102818% misses'
>>> s4
'2009-04-20 00:06:00 INFO  com.baz.abc.Accessor - Cache /path/to/some/different/dir hits: 4352685 / 271315, 0.004423% misses' 
```

这产生：

```
>>> score(s1,s2)
0.8571428571428571
>>> score(s3,s4)
0.75
>>> score(s1,s3)
0.066666666666666666 
```

You've still got to decide which lines to compare. Also the use of set() may distort the scores slightly – the price of a simple algorithm :-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T00:26:14.450

我想知道您是否可以只专注于为您定义独特性的部分。在这种情况下，似乎定义唯一性的部分只是中间部分：

```
2009-04-20 00:03:57 信息 com.foo.Bar - URL:/graph?id=1234
                    ^---------------------^

2009-04-20 00:05:59 信息 com.baz.abc.Accessor - 缓存 /path/to/some/dir 命中：3466 / 16534，0.102818% 未命中
                    ^--------------------------------^

```

然后，我将准确比较这部分，也许使用正则表达式（只是带括号的组；如何访问这样的子匹配取决于语言）：

```
/^.{20}(\w+\s+[\w\.-]+\s+-\s+\w+)/ 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T01:16:32.490

我认为您想将其分解为字段，按“严重性级别”字段和下一个字段（看起来像“类”）排序。我会使用 Haskell：

```
模块主要在哪里
导入 Data.List (nubBy, sortBy)

sortAndNub s = nubBy fields2and3
     $ sortBy fields2and3comp
     $ 地图词 $ 线条 s

fields2and3 ab = fieldEq 2 ab
                  && fieldEq 3 ab
fieldEq fab = a!!f == (b!!f)
fields2and3comp ab = 大小写比较 (a!!2) (b!!2) of
   LT->LT
   GT -> GT
   EQ -> 比较 (a!!3) (b!!3)
main = 交互 $ unlines.(map unwords).sortAndNub

```

# sharepoint - 将 SharePoint 2003 升级到 2007 的注意事项

> ID：769776
> 
> 赞同：2
> 
> 时间：2009-04-20T19:30:53.867
> 
> 标签：sharepoint, moss, sharepoint-2007, sharepoint-2003

提前致谢！

我想知道您的 SharePoint 架构师/专家是否可以帮助我确定有关将现有 SharePoint 2003 部署升级到 SharePoint 2007 的细节和问题。

我知道这是一般性的和模糊的，步骤/问题将很大程度上取决于当前的 SharePoint 部署。任何帮助将非常感激。

随着现有部署的详细信息可用，我将对此进行更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T20:06:23.623

这取决于很多事情。站点结构、数据库结构、内容结构/大小、可用性、工作流程、治理模型、变更管理程序等。

这是我用于新的 MOSS 实现的 100 万英尺视图，但我认为其中一些要点也可能转移到升级中：

*   确定需要什么。这是一个如此沉重的术语，这并不好笑。让高级管理层定义“需要”。每个人都认为他们的内容/工作是“需要的”，并且想要从农场中分得一杯羹。
*   制定分类法并让高级管理层签字。此外，层次结构的级别越少，您的工作就越容易。这样，当客户关系部门的某个人出于某种原因想要建立一些疯狂的网站时，您将签署一份文件告诉他们“不”。这也将有助于解决整个“需要什么”问题。
*   确定管理链。从顶部开始。场管理员（可能是您），然后是网站集管理员（设施主管）、网站管理员（部门经理）等...如果您以后也想拥有批准工作流程，这将有所帮助。
*   设计批准。尽你最大的努力，让一个单一的设计被批准全面使用。这将节省大量时间。让自定义设计模板适用于您的实施版本 x，而不是 1.0 版。
*   治理。如果您希望这在未来取得成功，这很容易成为最重要的事情。为几乎所有任务制定政策和程序，并签署这些政策和程序。就个人而言，我成立了一个由高级管理人员和部门工作人员组成的治理委员会，一旦确定了程序或政策，CIO 就会签署它。

希望这能让你开始。网络上有大量来自农场管理员的很棒的清单和白皮书，他们已经解决了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T06:04:50.823

我需要将几个 SharePoint 2003 网站迁移到 SharePoint 2007，主要由文档库和其他列表组成。迁移或升级的官方方法失败了，所以我最终编写了一个工具，该工具必须在目标 SharePoint 2007 服务器上运行，但可以从 2003 服务器复制所有列表和文档库，并且元数据和版本完好无损。它的源代码位于[http://sourceforge.net/projects/splistcp](http://sourceforge.net/projects/splistcp)，因此请随意使用和改进它。

# .net - MSBuild 和 BuildUri

> ID：769778
> 
> 赞同：1
> 
> 时间：2009-04-20T19:31:25.643
> 
> 标签：.net, tfs, msbuild

我正在尝试将 BuildStep 添加到 MSBuild 中的 AfterBuild 目标，并且我正在使用以下内容

```
<Target Name="AfterCompile">    
    <ItemGroup>      
        <TestAssemblies Include="$(OutDir)\DataStoreUnitTests.dll" />   
    </ItemGroup>    

    <BuildStep      
        Name="Run unit Tests"
        TeamFoundationServerUrl="$(TeamFoundationServerUrl)"     
        BuildUri="$(BuildUri)"      
        Message="Running unit tests">      
        <Output TaskParameter="Id" PropertyName="StepId" />    
    </BuildStep>    

    <Gallio      
        Assemblies="@(TestAssemblies)"      
        ReportTypes="html"      
        ReportFileNameFormat="buildreport{0}{1}"      
        ReportOutputDirectory="." />    

    <BuildStep      
        TeamFoundationServerUrl="$(TeamFoundationServerUrl)"      
        BuildUri="$(BuildUri)"      
        Id="$(StepId)"      
        Message="Yay! All tests succeded!"      
        Status="Succeeded" />    
        <OnError ExecuteTargets="MarkBuildStepAsFailed" />  
    </Target>  

    <Target Name="MarkBuildStepAsFailed">    
        <BuildStep      
            TeamFoundationServerUrl="$(TeamFoundationServerUrl)"      
            BuildUri="$(BuildUri)"      
            Id="$(StepId)"      
            Message="Tests have failed. See test report in drop folder for details." 
            Status="Failed" />  
</Target> 
```

当我在 MSBuild 中运行它时，出现以下错误：

> 错误 MSB4044：未为“BuildStep”任务指定所需参数“BuildUri”的值。

我不明白为什么，有人知道吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T19:45:07.047

我的想法是，这`$(BuildUri)`是毫无意义的评估。尝试执行打印语句来调试和定位 VS/MSBuild 作为错误给出的行号。

```
<Message Text="$(BuildUri)" /> 
```

可以使用以下命令从命令行运行 MSBuild（我发现 MSBuild 更容易使用这种方式）：

```
C:\WINDOWS\Microsoft.NET\Framework\%FrameWork_Version%\MSBuild /verbosity:n
%Solution or Project file% 
```

设置`$(BuildUri)`：

```
<Target Name="AfterCompile">    
    <PropertyGroup>
        <BuildUri>Build_Uri_Value</BuildUri >
    </PropertyGroup>

    <ItemGroup>
        ... 
```

关于 BuildUri 的信息可以在这里找到：

> [什么是 BuildUri，当我只是想获得一些资源时，我从哪里得到它？](http://social.msdn.microsoft.com/forums/en-US/tfsbuild/thread/45c1709f-c0c4-4d95-b84b-a081113de586/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T20:40:30.780

您是作为 Team Build 的一部分（在构建服务器上）还是作为桌面构建（即本地）运行此目标？

BuildUri 属性通常由构建代理在触发新的团队构建时填充传递给构建。在您的脚本中，Uri 用于告诉 TFS 要将构建步骤附加到哪个构建细节。如果您正在运行桌面构建，那么除非您在命令行中传递该属性，否则这将为空。

# git - Git 中的供应商分支

> ID：769786
> 
> 赞同：33
> 
> 时间：2009-04-20T19:33:39.523
> 
> 标签：git, version-control, branch, vendor-branch

Git 项目中有第二个项目，其内容正在独立处理。

子模块不能用于较小的模块，因为当用户尝试克隆或下载“父”时，甚至必须包含子项目。

不能使用子树合并，因为子项目正在积极开发中，并且子树合并使得将这些更新合并回原始项目非常困难。

我被告知该解决方案在 SVN 世界中被称为“供应商分支”，并且它在 Git 中非常简单，甚至不需要寻址。网络上的半生不熟的教程比比皆是。

尽管如此，我似乎无法让它工作。

有人可以请（非常好吗？）解释我如何创建一个结构，使一个项目存在于另一个项目中，并且两者都可以从同一个工作目录中开发和更新。理想情况下[或者更确切地说：如果不支持，这非常重要]当客户端尝试下载“父”项目时，应该自动为他提供*最新版本*的子项目。

请不要向我解释我应该如何使用子模块或子树合并甚至 SVN:Externals。该线程是[以下 SO 线程](https://stackoverflow.com/questions/720669/projects-within-projects-on-git/757028#757028)的产物，如果那里遗漏了什么，请在*此处*发布。该线程试图了解如何使用 Vendor 分支，并且我收到的解释越长、越清晰、越愚蠢，我会越快乐。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-20T20:28:28.610

我认为子模块是“供应商分支”的必经之路。
以下是您应该如何使用 submod... 嗯，开个玩笑。

只是一个想法; 你要：

*   在同一目录中开发主项目和子项目（这称为“**系统方法**”：您开发、标记和合并所有系统）
*   或将您的子项目视为“供应商分支”（这是一个允许您访问供应商外部组件或“文件集”的明确定义版本的分支，并且仅使用新的版本该外部组件的每个版本：这称为“**组件方法**”，所有系统都被视为自行开发的独立组件的集合）

这两种方法不兼容：

*   第一个策略与子树合并兼容：您同时在项目和子项目上工作。
*   第二个用于子模块，但子模块用于定义**配置**（您需要工作的标记列表）：每个 git 子模块，与 svn:externals 不同，都固定到特定的提交 id，这就是允许您定义*配置*（如 S *C* M：“软件*配置*管理”）

我喜欢第二种方法，因为大多数时候，当你有一个项目和一个子项目时，它们的*生命周期*是不同的（它们的开发节奏不同，没有同时标记在一起，也没有同名） .

在您的问题中真正阻止这种方法（“基于组件”）的是“两者都可以从同一个工作目录中开发和更新”部分。
我真的敦促您重新考虑该要求，因为大多数 IDE 完全能够处理多个“源”目录，并且子项目开发可以在其自己的专用环境中完成。

* * *

samgoody 补充道：

> 想象一下适用于 Joomla 和 ModX 的 eMap 插件。插件和特定于 Joomla 的代码（它是 Joomla 的一部分，而不是 eMap 的一部分）都是在插件位于 Joomla 内部时开发的。所有路径都是相对的，结构是刚性的，它们必须分布在一起——即使每个项目都有自己的生命周期。

如果我理解正确，您处于开发环境（您正在处理的文件集）与分发环境（在发布平台上复制相同的文件集）完全相同的配置中

这一切都是为了一个粒度问题：

*   如果两组文件不能单独存在，那么它们应该被视为一个大项目（和子树合并），但这会迫使它们被标记并合并为一个。- 如果一个依赖于另一个（可以单独开发），那么它们应该在自己的 Git 存储库和项目中，第一个依赖于第二个作为子模块的特定提交：如果子模块是在第一个组件的右子树中定义，所有相对路径都受到尊重。

* * *

samgoody 补充道：

> 原始线程列出了子模块的问题 - 主要是 GitHub 的下载不包括它们（对我来说很重要）并且它们卡在特定的提交上。

我不确定 GitHub 的下载最近是否存在问题：“[指南：使用子模块开发](http://github.com/guides/developing-with-submodules)”文章确实提到：

> 最重要的是：克隆你的`my-awesome-framework`fork 的人将没有问题拉下你的`my-fantastic-plugin`子模块，因为你已经为子模块注册了公共克隆 URL。命令

```
$ gh submodule init
$ gh submodule update 
```

> 将子模块拉入当前存储库。

至于“他们卡在特定的提交上”：这是子模块的全部要点，允许您使用*配置*（组件的标记版本列表）而不是最新的可能不稳定的文件集。

samgoody 提到：

> 我需要避免使用子树和子模块（请参阅问题），如果方法合理，我宁愿解决这个需求而不争论太多

您的要求是完全合理的，我不想评判其合理性：我之前的回答只是为了提供更大的上下文并尝试说明通用 SCM 工具通常可用的选项。

子树合并应该是这里的答案，但意味着只合并为主项目的文件提交，而不是子项目的提交。如果您可以管理这种部分合并，我认为这是正确的道路。

但是，我看不到不使用子树合并或子模块的本地 Git 方式来做你想做的事。
我希望真正的 Git 大师会在这里发布更充分的答案。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-22T20:53:08.330

在我回到山上之前，我终于可以上网几个小时了。我们会看看我是否有什么可以澄清你的情况。

我（可能过于简单化）的理解是，您有（场外）供应商为您的项目开发插件，而您的（内部）团队正在使用外部来源的框架为您的主要项目开发代码。供应商不会更改您的代码，并且可能不需要您进行前沿开发，但确实需要您的稳定代码来开发和测试他们的工作。您的团队不会对框架进行更改，但有时会为插件做出更改。

1.  像 VonC（他通常会非常彻底地思考问题）一样，我认为 Git 并不*完全*适合您的要求。和他一样，我认为使用子树合并模式是最合适的。我不是 Git 专家，但我成功地让 Git 适应了广泛的需求。也许 Git 不能满足您的需求：

    *   SVN 会让你在一个中拥有多个 repos，这对你来说似乎很重要。我认为这意味着使用外部或供应商分支模式来接近你想要的。

    *   Mercurial 有一个扩展程序[Forest，](http://www.selenic.com/mercurial/wiki/index.cgi/ForestExtension)用于使用嵌套存储库，这似乎更适合您的心理模型。我在 15 个月前选择了 Git 而不是 Mercurial，但 HG 很稳定，而且在许多用途上我认为它可以与 Git 相媲美。我不知道扩展的稳定性如何。

2.  如果我遇到你的情况，我会使用两个 Git 存储库——一个用于插件，一个用于 MainProject。供应商将在 Plugin repo 中进行开发，并将拥有一个发布分支，他们将插件的当前版本拉入其中，而无需开发环境的其余部分。该分支将作为供应商分支拉入 MainProject 存储库，然后合并到您的主开发分支中。 *当您的团队对插件进行更改时，他们会在您的主要开发分支的功能分支中开发它，并将其作为补丁提交给供应商存储库。* 这为您提供了一个非常干净的工作流程，相对容易设置和学习，同时保持开发历史隔离。

    我并不是要争论，而只是说这是 Git 最适合我对您的情况的理解。设置它的最简单方法是使用子树合并，但这不会在两个方向上运行更改，这是我反对使用该模式的原因。

3.  如果您的团队真的积极参与插件开发，或者您真的希望将项目和插件的开发历史集成到一个 Git 存储库中，那么只需使用一个 Git 存储库。[您可以按照此处的说明](https://stackoverflow.com/questions/359424/detach-subdirectory-into-separate-git-repository/359759#359759)，不时提取插件及其历史记录以供供应商使用。这可能会给您带来比您想要的更少的封装，但 Git 并不是为封装而设计的——Git 的数据结构基于跟踪整个项目中的更改。

也许我误解了你的情况，这些都不适用。如果是这样我道歉。感谢您和 VonC 制定的详细信息，这些信息填补了我最初在试图理解您的问题时遇到的许多漏洞。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-01-17T13:42:20.923

如果您只查找原始问题的标题：

使用 git 的供应商分支模式的一个很好的模板已启用

[https://www.roe.ch/Git_Reference](https://www.roe.ch/Git_Reference)

部分供应商分支模式

# sql - 在 Oracle 数据库中搜索 Long 数据类型的最佳方法是什么？

> ID：769787
> 
> 赞同：15
> 
> 时间：2009-04-20T19:33:50.490
> 
> 标签：sql, oracle, sql-like, ora-00932

我正在使用将 HTML 存储为 Long 数据类型的 Oracle 数据库。我想查询数据库以搜索存储在 Long 中的 HTML 数据中的特定字符串。

我试过，“从 TABLE 中选择 *，其中 COLUMN 像 '%form%'”。这会导致以下 Oracle 错误，因为 Long 数据类型不支持“like”。

ORA-00932: 不一致的数据类型: 预期 NUMBER 长

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2014-12-09T12:54:13.357

您可以在不使用临时表的情况下使用此示例：

```
DECLARE

  l_var VARCHAR2(32767); -- max length

BEGIN

FOR rec IN (SELECT ID, LONG_COLUMN FROM TABLE_WITH_LONG_COLUMN) LOOP
  l_var := rec.LONG_COLUMN;
  IF l_var LIKE '%350%' THEN -- is there '350' string?
    dbms_output.put_line('ID:' || rec.ID || ' COLUMN:' || rec.LONG_COLUMN);
  END IF;
END LOOP;

END; 
```

当然，如果 LONG 的字符数超过 32K，就会出现问题。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-20T20:07:34.510

您不能直接搜索 LONG。LONG 不能出现在 WHERE 子句中。它们可以出现在 SELECT 列表中，因此您可以使用它来缩小您必须检查的行数。

Oracle 建议至少在过去的 2 个版本中将 LONG 转换为 CLOB。对 CLOB 的限制较少。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-21T05:56:25.140

例子：

```
create table longtable(id number,text long);

insert into longtable values(1,'hello world');
insert into longtable values(2,'say hello!');

commit;

create or replace function search_long(r rowid) return varchar2 is
temporary_varchar varchar2(4000);
begin
select text into temporary_varchar from longtable where rowid=r;
return temporary_varchar;
end;
/

SQL> select text from longtable where search_long(rowid) like '%hello%';                                                                              

TEXT
--------------------------------------------------------------------------------
hello world
say hello! 
```

但小心点。PL/SQL 函数将只搜索 LONG 的前 32K。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-04-25T13:15:06.090

首先将`LONG`类型列转换为`CLOB`类型然后使用`LIKE`条件，例如：

```
CREATE TABLE tbl_clob AS
   SELECT to_lob(long_col) lob_col FROM tbl_long;

SELECT * FROM tbl_clob WHERE lob_col LIKE '%form%'; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-21T00:11:42.020

不要使用 LONG，而是使用 CLOB。您可以索引和搜索 CLOB，例如 VARCHAR2。

此外，使用前导通配符 (%) 进行查询将始终导致全表扫描。而是查看[Oracle Text 索引。](http://download.oracle.com/docs/cd/B19306_01/text.102/b14218/toc.htm)

# python - 来自一个 setup.py 的多个项目？

> ID：769793
> 
> 赞同：13
> 
> 时间：2009-04-20T19:35:26.287
> 
> 标签：python, setuptools

我当前的[setup.py](http://github.com/dbr/tvdb_api/blob/fa55575e26b188de9b9b9f0c41d52c2a45400796/setup.py)（使用 setuptools）安装了两个东西，一个是`tvdb_api`（一个 API 包装器），另一个是`tvnamer`（一个命令行脚本）

我希望将两者分别提供，以便用户可以这样做..

```
easy_install tvdb_api 
```

..只获取 API 包装器，或者..

```
easy_install tvnamer 
```

..安装tvnamer（和tvdb_api，作为要求）

如果没有两个单独的`setup.py`脚本，这可能吗？你能有两个来自同一个`python setup.py upload`命令的独立 PyPi 包吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-20T21:45:32.637

`setup.py`只是一个常规的 Python 文件，按照惯例会设置包。按照惯例，`setup.py`包含对 setuptools 或 distutils`setup()`函数的调用。如果你想使用一`setup.py`对二的包，你可以`setup()`根据命令行参数调用不同的函数：

```
import sys
if len(sys.argv) > 1 and sys.argv[1] == 'script':
    sys.argv = [sys.argv[0]] + sys.argv[2:]
    setup(name='tvnamer', ...)
else:
    setup(name='tvdb_api', ...) 
```

但实际上，我建议只编写两个脚本。

# linux - 带有 Zenity 的 Shell 脚本

> ID：769795
> 
> 赞同：1
> 
> 时间：2009-04-20T19:36:10.513
> 
> 标签：linux, shell, zenity

使用 Zenity 可以添加按钮，更改字体，除了默认选项之外的任何其他内容？如果没有，还有另一个允许更多自定义的 sh 对话框？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T19:58:24.407

Zenity 支持一些类似 HTML 的文本标记标签：`<b>`, `<i>`, `<u>`, `<s>`, `<tt>`, `<big>`,`<small>`等等—— 嗯，实际上[是](http://www.gtk.org/api/2.6/pango/PangoMarkupFormat.html)Gtk+ 支持这些标签，但 Zenity 在这些功能之上搭载。

为了更好地控制您的对话框，您可以使用[Kommander](http://kommander.kdewebdev.org/)。它就像一个与各种脚本语言兼容的表单生成器：Python、Perl、Ruby、shell。那里有各种各样的[例子](http://ubuntuforums.org/showthread.php?t=168391)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:46:39.180

您可能可以使用`~/.gtkrc`文件更改样式，但这可能会很痛苦。您可能只想继续使用[Gtk2-Perl](http://gtk2-perl.sourceforge.net/)编写真正的 GUI 程序：

```
#!/usr/bin/perl

use strict;
use warnings;
use Gtk2;

Gtk2->init;

my $window = Gtk2::Window->new;
my $vbox   = Gtk2::VBox->new;
my $label  = Gtk2::Label->new("Hello World");
my $button = Gtk2::Button->new("Press me");

$window->add($vbox);
$vbox->add($label);
$vbox->add($button);

$window->set_default_size(200, 200);
$window->signal_connect(
    destroy => sub {
        Gtk2->main_quit;
    }
);

my $i = 0;
$button->signal_connect(
    clicked => sub {
        $label->set_text("button pressed " . ++$i . " times");
    }
);

$window->show_all;

Gtk2->main; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-26T19:12:35.947

请确保为您使用的 Python 版本安装了正确的“PyZenity”。

这是下载 pyzenity-0.1.4 的链接： [下载 pyzenity-0.1.4](http://www.brianramos.com/software/PyZenity/PyZenity-0.1.4.tar.gz)

这在 Python 2.6 中运行良好

另外，我在我的另一台机器上安装了 Python 2.7，但这会产生同样的错误。

因此，要解决此问题（对于更高版本的 Python），请使用[Active Python](http://www.activestate.com/activepython/downloads)，然后使用“ [pym](http://code.activestate.com/pypm/pyzenity/) ”来安装 Pyzenity。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-06T20:21:41.993

您可以将 gtkdialog 与 glade 一起使用：

```
gtkdialog --glade-xml=file.glade --program=MAIN_WINDOW 
```

# .net - WCF Web 服务，跨域示例

> ID：769800
> 
> 赞同：0
> 
> 时间：2009-04-20T19:38:20.227
> 
> 标签：.net, wcf, web-services, iis

谁能指出一个在一个网站上创建 WCF Web 服务的好/简单示例，然后是一个在另一个网站上使用该 WCF Web 服务的简单示例？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T20:05:19.260

[http://msdn.microsoft.com/en-us/library/ms751514.aspx](http://msdn.microsoft.com/en-us/library/ms751514.aspx)有一些使用 WCF 的好例子。

从另一个站点使用 WCF 应该很简单，只是不要忘记使用 clientaccesspolicy.xml 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T02:59:29.700

如果您正在寻找一般的 WCF 技术和示例，我强烈建议您访问[IDesign 的网站](http://www.idesign.net)。该公司由 WCF 的杰出专家之一 Juval Lowy 创立。下载可免费访问和使用；您只需提供您的电子邮件地址。

# xsd - 如何判断 XML 元素是否在 XSD 文件中标记为必需

> ID：769802
> 
> 赞同：18
> 
> 时间：2009-04-20T19:38:43.487
> 
> 标签：xsd, schema

我需要在 XSD 架构中将一些元素标记为非必需元素。我该如何确定哪些元素被标记为需要，是否有任何特定的标志我应该搜索。目前我所有的元素都标有`minOccurs="0"`，这是需要更改的吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-20T19:41:56.663

是的。

`minOccurs="0"`是您需要添加到元素中的可选内容。
没有`minOccurs`属性意味着强制（因为默认情况下`minOccurs="1"`）

# .net - 查看程序集哈希

> ID：769803
> 
> 赞同：1
> 
> 时间：2009-04-20T19:39:13.207
> 
> 标签：.net, hash, assemblies

我已经用强密钥签署了我的程序集。我能够使用 ildasm 在程序集清单中找到公钥。但是，我无法找到应与公钥一起放入程序集中的程序集散列。

我在哪里可以找到计算哈希？

亲切的问候PK

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T19:51:47.903

使用 SDK 强命名工具，您可以在命令行上运行它

```
sn -T assemblyname 
```

但对我来说最简单的事情是简单地在[Reflector](http://www.red-gate.com/products/reflector/)中打开程序集，然后剪切并粘贴完全限定的程序集名称。

[替代文字 http://www.deploylx.com/so/reflectorname.gif](http://www.deploylx.com/so/reflectorname.gif)

# version-control - 使用带有 Perforce 的 Maven SCM 标签

> ID：769813
> 
> 赞同：2
> 
> 时间：2009-04-20T19:42:55.897
> 
> 标签：version-control, maven-2, perforce, maven-scm

有没有人有关于如何为 perforce 配置 Maven SCM 标签的示例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T21:50:14.467

我刚刚发现这个有答案。

[RE: 使用 perforce 发布 mvn](http://www.mail-archive.com/users@maven.apache.org/msg83688.html)

```
<scm>
  <connection>scm:perforce://depot/simple</connection>
  <developerConnection>scm:perforce://depot/simple</developerConnection>
  <url>scm:perforce://depot/simple</url>
</scm> 
```

我也尝试将它与发布插件一起使用，因为我的 perforce 需要一个用户 ID，我可以在发布插件的配置部分中指定它

```
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-release-plugin</artifactId>
  <version>2.0-beta-9</version>
  <configuration>
    <username>myUser</username>
  </configuration>
</plugin> 
```

# sql-server - 向 Microsoft SQL Server 中的特定序号位置添加新表列

> ID：769828
> 
> 赞同：63
> 
> 时间：2009-04-20T19:48:58.550
> 
> 标签：sql-server, database-table, change-management

是否可以在 Microsoft SQL Server 的特定序号位置向表中添加列？

例如，我们的表在每个表定义的“末尾”总是有 CreatedOn、CreatedBy、LastModifiedOn、LastModifiedBy 列？我希望新列显示在这些列上方的 SSMS 中。

如果我正在编写所有数据库更改的脚本，有没有办法在表的末尾保留这个顺序？

仅供参考，我并不想就是否应该这样做进行一场激烈的战争。如果您想了解一个快速退化的线程，这里有一个很好的：

[http://www.developersdex.com/sql/message.asp?p=581&r=5014513](http://www.developersdex.com/sql/message.asp?p=581&r=5014513)

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-20T19:54:34.730

您必须创建一个临时表，该表反映原始表的架构但具有您想要的列顺序，然后将原始表的内容复制到 temp。删除原始文件并重命名临时文件。

这就是 SQL Management Studio 在幕后所做的。

使用模式同步工具，您可以自动生成这些脚本。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-04-20T19:56:59.497

进入 SQL Server 管理工作室，并“设计”一个现有的表。在中间插入一列，在空白区域右击并选择**Generate Change Script...**

现在看看它创建的脚本。它基本上会创建一个具有正确列顺序的临时表，从原始表中插入数据，删除原始表，然后重命名临时表。这可能是您需要做的。

[![在此处输入图像描述](https://i.stack.imgur.com/Z8Ugy.png)](https://i.stack.imgur.com/Z8Ugy.png)

您可能还需要取消选中此选项以允许创建更改脚本

[![在此处输入图像描述](https://i.stack.imgur.com/J6Exb.png)](https://i.stack.imgur.com/J6Exb.png)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-10-16T18:59:06.000

答案是肯定的，技术上是可行的，但是这样做你会很头疼，而且执行和设置需要很长时间。

**一：创建/复制/删除/重命名**

这实际上是 SQL Server 在图形界面中所做的：这是一个脚本示例，当您在表的开头添加新列后单击“保存”按钮时，它正在生成和执行的脚本。

```
/* To prevent any potential data loss issues, you should review this script in detail before running it outside the context of the database designer.*/
BEGIN TRANSACTION
SET QUOTED_IDENTIFIER ON
SET ARITHABORT ON
SET NUMERIC_ROUNDABORT OFF
SET CONCAT_NULL_YIELDS_NULL ON
SET ANSI_NULLS ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
COMMIT
BEGIN TRANSACTION
GO
CREATE TABLE dbo.Tmp_SomeTable
    (
    MyNewColumn int NOT NULL,
    OriginalIntColumn int NULL,
    OriginalVarcharColumn varchar(100) NULL
    )  ON [PRIMARY]
     TEXTIMAGE_ON [PRIMARY]
GO
ALTER TABLE dbo.Tmp_SomeTable SET (LOCK_ESCALATION = TABLE)
GO
SET IDENTITY_INSERT dbo.Tmp_SomeTable ON
GO
IF EXISTS(SELECT * FROM dbo.SomeTable)
     EXEC('INSERT INTO dbo.Tmp_SomeTable (OriginalIntColumn, OriginalVarcharColumn FROM dbo.SomeTable WITH (HOLDLOCK TABLOCKX)')
GO
SET IDENTITY_INSERT dbo.Tmp_SomeTable OFF
GO
DROP TABLE dbo.SomeTable
GO
EXECUTE sp_rename N'dbo.Tmp_SomeTable', N'SomeTable', 'OBJECT' 
GO

GO
COMMIT 
```

**二：添加列/更新/删除列/重命名**

此方法基本上涉及创建要添加到新列“右侧”的任何现有列的副本，将数据传输到新列，然后删除原始列并重命名新列。这将对您拥有的任何索引或约束造成严重破坏，因为您必须重新指向它们。这在技术上是可行的，但在开发和执行方面同样耗时。

```
CREATE TABLE MyTest (a int, b int, d int, e int)

INSERT INTO MyTest (a,b,d,e) VALUES(1,2,4,5)

SELECT * FROM MyTest -- your current table

ALTER TABLE MyTest ADD c int -- add a new column
ALTER TABLE MyTest ADD d_new int -- create copies of the existing columns you want to move
ALTER TABLE MyTest ADD e_new int

UPDATE MyTest SET d_new = d, e_new = e -- transfer data to the new columns

ALTER TABLE MyTest DROP COLUMN d -- remove the originals
ALTER TABLE MyTest DROP COLUMN e

EXEC SP_RENAME 'MyTest.d_new', 'd'; -- rename the new columns
EXEC SP_RENAME 'MyTest.e_new', 'e';

SELECT * FROM MyTest 

DROP TABLE MyTest -- clean up the sample 
```

**三：与它一起生活**

这极大地冒犯了我的秩序感……但有时，它不值得重新洗牌。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-20T20:01:31.263

据我所知，没有已知的方法可以更改列的顺序。在幕后，SQL Management Studio 执行 Jose Basilio 所说的操作。如果你有一张大桌子，那么像这样改变列顺序是不切实际的。

您可以使用“视图”。使用 SQL 视图，您可以使用任何您喜欢的顺序，而不会受到表列更改的影响。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-08-18T12:56:25.857

我正在使用 SSMS 18。我以简单的方式做到了

*   开放式桌子设计
*   通过拖动来定位所需的列
*   根据 KM 的回答（线程中的第二个） - 取消选中允许创建更改脚本的选项，请参阅上图。
*   保存更改。
*   完毕。现在检查你的桌子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-14T19:18:39.710

**TFS 2013 会自动为您执行此操作**。

以您喜欢的方式将新列添加到您的表中，然后将您的更改提交到 TFS。从那里您可以在 Visual Studio 中打开表的 sql 文件并手动移动 T-SQL CREATE 脚本中的列顺序。然后，您可以使用工具 > SQL Server > 新架构比较下的 VS 架构比较工具来更新目标数据库。选择您的数据库项目，将您的更改作为源，将要更新的数据库作为目标。比较，选择表的脚本，然后更新。VS 会自动删除和添加。您的所有数据和索引都是安全的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-03-13T20:14:30.927

我认为很简单的是添加列 ALTER TABLE table1 ADD .. 然后从 select like 中创建一个像 tmp_table1 这样的 tmp 表 **`SELECT col1,col2,col5,col3,col4 into tmp_table1 from table1;`** ，然后删除 table1 并将 tmp_table1 重命名为 table1，就是这样。我希望它会帮助某人

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-12-21T12:51:53.057

将所有列选择到临时表中，并使用所需的新列创建一个新表。然后删除旧表，从临时表中选择所有列，并将它们插入到具有重新排序列的新表中。没有数据丢失。

```
SELECT * FROM TEMP
SELECT * FROM originaltbl
SELECT * FROM #Stagintbl

DECLARE @ColumnName nvarchar(max);
SET @ColumnName=(SELECT
    DISTINCT STUFF((
        SELECT ',' + a.COLUMN_NAME
        FROM (
            SELECT Column_name 
            FROM INFORMATION_SCHEMA.COLUMNS 
            WHERE TABLE_NAME='originaltbl') a
        for xml path('')
    ),1,1,'') AS ColumnName)

DECLARE @Sqlquery nvarchar(max)
SET @Sqlquery = 'SELECT ' + @ColumnName + ' FROM #Stagintbl' + '';
INSERT INTO originaltbl
EXECUTE(@Sqlquery) 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2017-08-18T09:26:40.477

肮脏而简单。
将表格导出为 csv。
在所需位置插入新数据。
丢表。
创建具有所需列规范的新表。
将列从 csv 加载到新表。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2018-08-26T19:29:51.440

我不确定线程​​是否仍然处于活动状态。我对 MySQL 数据库进行了相同的查询。右键单击表格并选择“ALTER”自动生成以下代码。sakila db 提供的样本，它有效。只需找出要放置新列的列并使用“AFTER”关键字

```
ALTER TABLE `sakila`.`actor` 
CHANGE COLUMN `middle_name` `middle_name` VARCHAR(50) NULL DEFAULT NULL AFTER `first_name`; 
```

# performance - 三角函数的效率/速度

> ID：769836
> 
> 赞同：7
> 
> 时间：2009-04-20T19:52:29.023
> 
> 标签：performance, geometry

在我制作的游戏中，我有两个点，pt1 和 pt2，我想计算出它们之间的角度。在之前的计算中，我已经计算出了距离。显而易见的方法是在垂直距离上计算水平距离（tan（theta）= opp/adj）。

不过我想知道，因为我已经计算了距离，使用反正弦/反余弦与距离和 dx 或 dy 会更快吗？

另外，在表格中预先计算会更好吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-10-01T02:09:20.417

除了所有关于过早优化的明智评论之外，让我们假设这是热点并做一个 frigg'n[基准测试](http://pastebin.com/CwN9DH1M)：

![条形字符](https://chart.apis.google.com/chart?cht=bvg&chs=510x200&chd=t:15.6028,13.3074,16.9134|59.3224,25.7562,32.6745|204.79,510.1,498.205|83.5743,626.522,506.524&chds=0,33.2685,0,64.3905,0,1275.25,0,1566.31&chxr=1,0,125,25&chxt=x&chxs=0,ff0000,12,0,l|1,0000ff,12,1,lt&chxl=0:|atan2|acos|acos%2Bdiv&chbh=34,2,25&chco=4D89F9,09B67D,D09040,B66D7D&chdl=System+1|System+2|System+3|System+4&chdlp=b&chm=N,000000,0,-1,11|N,000000,1,-1,11|N,000000,2,-1,11|N,000000,3,-1,11&chg=0,20)

时间以纳秒为单位，按比例缩放以规范系统之间的“acos”。
'acos' 只是假设单位半径 ie `acos(adj)`，而 'acos+div' 意味着`acos(adj/hyp)`。

系统 1 是运行 Mac OS X 10.6.4 (gcc 4.2.1) 的 2.4GHz i5
系统 2 是运行 Red Hat 7 Linux 2.6.28 (gcc 4.1.2) 的 2.83GHz Core2 Quad
系统 3 是 1.66GHz Atom N280运行 Ubuntu 10.04 2.6.32 (gcc 4.4.3)
系统 4 是运行 Ubuntu 10.04 2.6.32 (gcc 4.4.3) 的 2.40GHz Pentium 4

总结：相对表现无处不在。有时 atan2 更快，有时更慢。非常奇怪的是，在某些系统上，使用除法执行 acos 比不使用它要快。在您自己的系统上测试：-/

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-20T20:09:19.530

我怀疑这里存在过早优化的风险。另外，请注意您的几何形状。您的相反/相邻方法是直角三角形的属性，那是您实际拥有的吗？

我假设你的点是平面的，所以对于一般情况，你让它们隐含地表示来自原点的两个向量（称之为 v1 v2），所以你的角度是

theta=arccos(dot(v1,v2)/(|v1||v2|)) 其中|.| 是向量长度。

让它更快（假设需要）将取决于很多事情。你知道向量长度，还是必须计算它们？在架构中做点积的速度有多快。acos有多快？在某些时候，诸如查找表（可能是插值）之类的技巧可能会有所帮助，但这会降低您的准确性。

不过，这都是权衡取舍，您的问题确实没有一个普遍的答案。

[编辑：添加评论]

我想再次强调，无论如何，经常玩“x 是最快的”有点像现代 cpu 和编译器的杯子游戏。直到你测量它并为生成的代码卑躬屈膝，你才会知道。当你在这个级别上真正关心一段（希望很小的）代码时，你可以详细了解你的系统在做什么。但这很辛苦。也许一张桌子很好。但也许你有快速的向量计算和一个小的缓存。等等等等等等。这一切都相当于“它取决于”。对不起。另一方面，如果您*还没有*达到真正关心这段代码的程度……您可能根本不应该在这个级别上考虑它。改正它。让它干净（这意味着抽象和代码）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-20T19:56:56.563

如果您要多次执行此**操作**，请在表格中预先计算。这样性能会好很多。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-23T20:22:56.793

这里有很多好的答案。

顺便说一句，如果你使用`Math.atan2`，你会得到一个完整的 2π 角。

我会这样做，然后全力以赴。如果您不喜欢这种速度，*并且如果样本显示您实际上大部分时间都在该代码中，而不是在其他地方*，请尝试用表查找替换它。如果您不需要接近 1 度的精度，您可以使用一个非常小的表格和插值。

此外，您可能想要记住该功能。为什么要重新计算你最近已经做过的事情？

补充：如果你使用表格，它只需要覆盖 0-45 度的角度（并且可以硬编码）。你可以通过对称得到其他一切。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T19:59:41.893

从纯速度的角度来看，预先计算的表格和最接近匹配的查找将是最好的。当然，它会涉及一些开销，具体取决于您需要角度的细粒度，但是如果您经常进行此计算（或在紧密循环中），这将是非常值得的，因为那些将是昂贵的计算。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T20:30:37.810

先把它弄好！然后剖析和优化。查表肯定是一个不错的选择，但在做任何花哨的事情之前一定要正确计算

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T21:01:32.243

1.  如果您对大 O 表示法感兴趣，您可能使用的所有方法都是 O(1)。

2.  如果您对最快的方法感兴趣，请对其进行测试。编写一个包装函数，它调用您喜欢的方法但可以轻松更改，并用它进行测试。确保您的应用程序花费大量时间来执行此操作，这样您就不会浪费自己的时间。尝试任何你想到的方法。理想情况下，在多个不同的 CPU 上运行它。

我对预测现代处理器上花费或多或少的时间变得非常谨慎。如果您需要速度，查找表曾经是答案，但您不知道先验对缓存的影响，也不知道规范化和查找需要多长时间与在一个上执行触发函数需要多长时间特定的 CPU。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T20:45:13.500

鉴于这是一款游戏，您可能关心速度。查找表绝对是最快的，但您使用这种方法以准确性换取速度。那么，您必须达到多准确才能满足要求？只有你能回答这个问题。在交易准确性之前，首先确定您是否有速度问题。所有三角函数均使用数值方法计算（研究数值分析以了解更多信息）。一些三角函数的方法比其他函数更昂贵，因为它们依赖于收敛速度较慢的系列，谁知道，您的计算机可能与另一台计算机对这些函数有不同的实现。无论如何，您可以通过编写一些小程序来自己了解这些功能的成本，这些小程序可以根据您的需要循环进行尽可能多的迭代，您可以选择增量，一直为结果计时。然后你可以选择最快的方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-20T21:19:14.993

虽然其他人非常正确地提到您几乎肯定会陷入过早优化的陷阱，但当他们说三角函数是 O(1) 时，他们并没有说明全部情况。

大多数三角函数实现实际上在输入函数的值上都是 O(N)。这是因为三角函数在 [0, 2π) 之类的小区间上最有效地计算（或者，对于最佳实现，甚至该区间的更小部分，但这足以解释事情）。所以算法看起来像这样，在伪 Python 中：

```
def Cosine_0to2Pi(x):
    #a series approximation of some kind, or CORDIC, or perhaps a table
    #this function requires 0 <= x < 2Pi

def MyCosine(x):
    if x < 0:
         x = -x
    while x >= TwoPi:
         x -= TwoPi
    return Cosine_0to2Pi(x) 
```

甚至像 x87 这样的微编码 CPU 指令`FSINCOS`最终也会在内部执行类似的操作。所以 trig 函数，因为它们是周期性的，通常需要 O(N) 时间来进行参数缩减。但是，有两个警告：

1.  如果您必须在三角函数的主域之外计算大量值，那么您的数学可能没有经过深思熟虑。
2.  Big-O 符号隐藏了一个常数因子。参数归约有一个非常小的常数因子，因为它很容易做到。因此，对于几乎每个输入，O(1) 部分都将主导 O(N) 部分。

# emacs - Emacs org-mode - 依赖任务

> ID：769837
> 
> 赞同：8
> 
> 时间：2009-04-20T19:52:51.957
> 
> 标签：emacs, org-mode

是否可以在 emacs org 模式下引入依赖任务？假设我有三个任务开发，测试，部署应该一个接一个地完成。我用 SCHEDULED: 和 DEADLINE: 安排了第一个任务，并希望在第一个任务完成后自动安排第二个任务（例如，我可以指定第一个任务的截止日期和第二个任务的持续时间的偏移量）。或者它至少可以警告我任务重叠吗？此外，如果我移动一项任务的计划日期，则应相应地移动以下任务。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-21T01:36:06.513

在 org-mode 发行版的 contrib 目录中查看 org-depend。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-11T00:44:07.957

org-depend 记录在 Worg 上：http: [//orgmode.org/worg/org-contrib/org-depend.html](http://orgmode.org/worg/org-contrib/org-depend.html)

# c# - 为什么 SGEN.EXE 需要对引用程序集的写入权限？

> ID：769839
> 
> 赞同：1
> 
> 时间：2009-04-20T19:54:14.620
> 
> 标签：c#, visual-studio-2008

我有一个与 ICSharpCode.SharpZipLib.dll 链接的项目（dll 本身无关紧要）。项目输出之一是序列化程序集。此输出由微软工具 sgen.exe 生成。在我将 SharpZipLib 签入到我的源代码存储库之前，所有这些都按预期工作，这使它成为只读的。我没有自己构建 SharpZipLib 程序集，因此签入此二进制文件对我来说是有意义的。但是，当我构建时，sgen 失败并出现“拒绝访问”错误。

这是一个简化的重现命令：

```
sgen.exe /assembly:.\MyProject.dll /proxytypes /reference:.\ICSharpCode.SharpZipLib.dll 
```

这是产生的错误：

```
SGEN : error : Could not load file or assembly 'ICSharpCode.SharpZipLib, Version=0.85.1.271, Culture=neutral, PublicKeyToken=1b03e6acf1164f73' or one of its dependencies. Access is denied.
Done building project "MyProject.csproj" -- FAILED. 
```

同样，当 ICSharpCode.SharpZipLib.dll 上未设置只读标志时，不会发生此错误。我从哲学上反对在构建期间检查文件，但似乎没有办法解决它。如果任何引用的程序集是只读的，sgen.exe 将失败。

需要注意的是，sgen.exe 并没有修改任何引用的程序集，那么为什么要打开它们进行读/写呢？

我可以禁用序列化程序集的生成，但这是一个理想的优化。

注意：我正在使用带有动态视图的理性清晰案例。我认为这无关紧要，但为了完整起见，我将其包括在内。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-26T15:23:29.410

我今天在 ClearCase 动态视图中构建 VS2005 解决方案时遇到了同样的问题。幸运的是，ProcMon 在动态视图中工作（通常是蓝屏），当它打开引用的程序集时，我能够找出 SGEN.EXE 所请求的内容。它需要执行访问权限！这在 ClearCase 中是可配置的，因此我将所有用户和宾果游戏的相关程序集的执行权限设置为 true！

这是 ProcMon 的实际线路，它让我了解了这一点。

所需访问：**执行**/遍历、同步、处置：打开、选项：同步 IO 非警报、非目录文件、属性：n/a、ShareMode：读取、删除、AllocationSize：n/a

在更改程序集的执行权限之前，ProcMon 显示 SGEN.EXE 正在从视图中接收“ACCESS DENIED”。如果您想进行更多研究，可以在 Web 上找到有关执行权限和 ClearCase 视图的更多信息。

希望这可以帮助其他人在同样的问题上苦苦挣扎，并认为唯一的解决方案是检查文件。

-阿基米德

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T20:18:59.240

这听起来像是对 sgen.exe 的不必要限制。

我建议将此报告为[Microsoft Connect](https://connect.microsoft.com/)上的错误。

# python - 如何在 Django 过滤器中使用 AND？

> ID：769843
> 
> 赞同：78
> 
> 时间：2009-04-20T19:55:11.263
> 
> 标签：python, django

如何创建“AND”过滤器来检索 Django 中的对象？例如，我想检索在单个字段中包含两个单词的行。

例如，当我在 mysql 数据库上运行下面的 SQL 查询时，它就是这样做的：

```
select * from myapp_question
where ((question like '%software%') and (question like '%java%')) 
```

你如何在 Django 中使用过滤器来实现这一点？

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2009-04-20T21:04:52.627

为了彻底起见，我们只提[`Q`](https://docs.djangoproject.com/en/3.0/topics/db/queries/#complex-lookups-with-q-objects)对象方法：

```
from django.db.models import Q
criterion1 = Q(question__contains="software")
criterion2 = Q(question__contains="java")
q = Question.objects.filter(criterion1 & criterion2) 
```

请注意，此处的其他答案更简单，更适合您的用例，但如果有类似但稍微复杂的问题（例如需要“不”或“或”）的人看到这一点，最好在此处提供参考。

* * *

## 回答 #2

> 赞同：104
> 
> 时间：2009-04-20T19:57:38.513

（**更新**：这个答案将不再起作用并给出语法错误`keyword argument repeated`）

```
mymodel.objects.filter(first_name__icontains="Foo", first_name__icontains="Bar") 
```

**更新**：自从我写了这个答案并做了一些 django 以来很长一段时间，但我确信迄今为止最好的方法是使用 Q 对象方法，如 David Berger 在这里展示的：[如何在 Django 过滤器中使用 AND？](http://stackoverflow.com/a/770078/63097)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-20T20:01:38.457

您可以在 Django 中链接过滤器表达式：

```
q = Question.objects.filter(question__contains='software').filter(question__contains='java') 
```

[您可以在“链接过滤器](https://docs.djangoproject.com/en/dev/topics/db/queries/#chaining-filters)”的 Django 文档中找到更多信息。

# java - 用 BrowserLauncher2 替换 BrowserLauncher

> ID：769844
> 
> 赞同：0
> 
> 时间：2009-04-20T19:55:15.007
> 
> 标签：java, browser

我开始对现有的 Java 小程序进行增强，让用户点击菜单项中的链接，并在他/她的默认浏览器中打开一个页面。我们部署的一些代码在 Java 1.4 中，而大部分在 Java 5 中。这使我无法在 Java 6 中使用桌面 API。看起来解决问题的最简单方法是将[BrowserLauncher2](http://browserlaunch2.sourceforge.net/index.shtml)集成到应用程序中。

问题是现有代码包含 BrowserLauncher.java 的早期版本（版本 1.4b1（2001 年 6 月 20 日发布））。与原来的不同，BrowserLauncher2 不仅仅是一个类。它似乎有很多我想利用的增强功能。

我想我会根据自己的需要使用较新的版本，并在遗留代码中删除对旧版本的引用。我对旧代码有一套非常好的现有单元测试，并将对我进行交换的代码进行一些功能测试。

是否有人已经从旧版本的 BrowserLauncher 升级路径对潜在的陷阱有任何建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T16:55:17.587

好吧，这就是你提出这样一个晦涩的问题所得到的。我不会放弃一个未回答的问题，而是分享我学到的东西。

BrowserLauncher2 中的 BrowserLauncher 类已弃用旧的静态 openURL(String) 方法。此外，虽然旧方法抛出了 IOException，但新方法抛出了一组不同的异常。

因此，有必要重写您的 catch 块，并且将对 openURL(String) 的静态调用转换为对实际 BrowserLauncher 对象上的方法的调用可能是一个好主意。

然而，鉴于 BrowserLauncher2 的改进，这可能是值得的。

# ruby-on-rails - 如何使用 Rails 应用程序中的 s3 在存储桶之间复制文件？

> ID：769848
> 
> 赞同：4
> 
> 时间：2009-04-20T19:57:31.897
> 
> 标签：ruby-on-rails, actionscript-3, amazon-s3

我目前正在开发一个 Rails 应用程序，它试图在 s3 中将视频从一个存储桶复制/移动到另一个存储桶。但是，我的 Rails 应用程序不断收到代理错误 502。在 mongrel 日志中，它显示“未能分配内存”。一旦发生此错误，应用程序就会死掉，我们必须重新启动。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T20:35:00.967

似乎您的代码正在将整个资源读入内存，并且内存不足您的应用程序。一种天真的方法（根据您的描述，您已经在做类似的事情）是下载文件并再次上传：只需将其下载到本地文件而不是内存中。但是，亚马逊工程师已经提前考虑并提供了可以处理这种特定情况的 API。

如果您使用的是 RightAWS gem 之类的东西，您可以像这样使用它的 S3Interface：

```
# With s3 being an S3 object acquired via S3Interface.new
# Copies key1 from bucket b1 to key1_copy in bucket b2:
s3.copy('b1', 'key1', 'b2', 'key1_copy') 
```

如果您使用的是裸 S3 HTTP 接口，请参阅[亚马逊的对象复制文档](http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTObjectCOPY.html)，了解仅使用 HTTP 将一个对象从一个存储桶复制到另一个的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T20:36:49.743

尝试流式传输文件，而不是将整个文件加载到内存中然后使用它。

例如，如果您使用的是 aws-s3 gem，请不要使用：

```
data = open(file)
S3Object.store file_name, data, BUCKET 
```

请改用以下内容：

```
S3Object.store file_name, open(file), BUCKET 
```

不确定如何确切地“流式下载”文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-28T04:23:51.987

[博托](http://docs.pythonboto.org/en/latest/index.html)效果很好。看到[这个线程](https://stackoverflow.com/questions/5194552/is-it-possible-to-copy-all-files-from-one-s3-bucket-to-another-with-s3cmd)。使用 boto，您可以将对象直接从一个存储桶复制到另一个存储桶，而不是将它们下载到本地计算机然后将它们上传到另一个存储桶。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-08-03T02:58:51.163

You can copy bucket to bucket directly using the [fog](https://github.com/fog/fog) gem.

```
s3 = Fog::Storage.new(your_aws_credentials)

s3.copy_object('source-bucket', 'source/path', 'dest-bucket', 'dest/path') 
```

# c++ - 如何将 BOOST_FOREACH 与两个 std::maps 一起使用？

> ID：769867
> 
> 赞同：2
> 
> 时间：2009-04-20T20:03:03.727
> 
> 标签：c++, stl, boost, foreach, maps

我的代码基本上看起来像这样：

```
std::map<int, int> map1, map2;
BOOST_FOREACH(int i, map1)
{
    // do steps 1-5 here...
}
BOOST_FOREACH(int i, map2)
{
    // do steps 1-5 (identical to above) here...
} 
```

有没有办法连接地图以消除第二个循环中的重复代码？或者一种扩展 BOOST_FOREACH 以一次性遍历两个不同地图的方法？显然我不想增加程序的时间复杂度（否则我可以创建一个新地图并插入其中 map1 和 map2）。我有一种感觉，我在这里遗漏了一些基本的东西。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T20:21:32.887

你可以定义一个函数：

```
typedef std::map<int, int> IntMap;

void doStuffWithInt(IntMap::value_type &i)
{
  // steps 1 to 5
}

BOOST_FOREACH(IntMap::value_type &i, map1)
  doStuffWithInt(i);
BOOST_FOREACH(IntMap::value_type &i, map2)
  doStuffWithInt(i); 
```

尽管在这种情况下使用起来可能更简单`std::for_each`：

```
for_each(map1.begin(), map1.end(), doStuffWithInt);
for_each(map2.begin(), map2.end(), doStuffWithInt); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T21:40:01.963

这里的想法是编写一种特殊类型的迭代器来虚拟合并两个容器，就 BOOST_FOREACH 而言。请注意，我不是从现有的两个容器中创建新容器。我只是从第一个容器的 end() 跳转到第二个容器的 begin() 迭代器。我没有尝试编写实际的merged_iterator 类，但是虽然写起来可能有点长，但在技术上并不困难。我真的很惊讶没有使用谷歌找到类似的东西。不过，我并没有寻找太久！

```
template<typename Container>
boost::iterator_range<
  merged_iterator<Container::iterator>
  >
concat_containers( Container& c1, Container& c2 )
{
  typedef merged_iterator<typename Container::iterator> MergedIterator;
  typedef boost::iterator_range<MergedIterator> IteratorRange;
  return IteratorRange(
    MergeIterator( c1.begin(), c1.end(), c2.begin(), c2.end() ),
    MergeIterator( c2.end(), c1.end(), c2.begin(), c2.end() ) );
}

// Now use a bit of magic to define merged_iterator<...>
// And you'll be able to write

BOOST_FOREACH( std::pair<int, int> i, concat_containers( map1, map2 ) )
{
// Do whatever you want here
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T20:26:28.227

除了我推荐的 1800 解决方案之外，还有各种 hacky 解决方案：

```
for (int stage = 0; stage < 2; stage++) {
    BOOST_FOREACH(int i, stage == 0 ? map1 : map2) {
        ...
    }
}

typedef std::map<int, int> intmap;
std::vector<intmap *> v;
v.push_back(&map1);
v.push_back(&map2);
BOOST_FOREACH(intmap *m, v) {
    BOOST_FOREACH(int i, *m) {
        ...
    }
} 
```

注意：当我看到同事写这样的代码时，有时我会被一种无法抗拒的想要扼杀他们的冲动所征服。使用风险自负。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-24T01:55:59.277

最简单的方法是这样的：

```
std::map<int, int> map1, map2;
int key, value;
BOOST_FOREACH(boost::tie(key, value), boost::join(map1, map2))
{
    // do steps 1-5 here...
} 
```

并且不要担心那些逗号不会因为括号而混淆预处理器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-02T10:15:40.403

在我的头顶，我会尝试

```
std::map<int, int> map1, map2;
std::map<int, int>& maps = { map1, map2 }
BOOST_FOREACH(std::map<int, int> map, maps)
  BOOST_FOREACH(int i, map)
  {
      // do steps 1-5 here...
  } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-27T21:30:00.100

[这里](http://www.boost.org/doc/libs/1_47_0/doc/html/foreach/pitfalls.html)解释 了。

你可以这样做：

```
std::map<int,int> m;
typedef std::pair<int,int> pair_t;
BOOST_FOREACH(pair_t p, m) 
```

# php - 如何使用 file_save_upload 在 Drupal 6 中验证文件类型？

> ID：769875
> 
> 赞同：0
> 
> 时间：2009-04-20T20:07:15.633
> 
> 标签：php, file, drupal-6

我正在开发一个采用用户上传的 CSV 文件的模块。代码如下所示：

```
function foo_form_submit($form_id, &$form_state) {
  $validators = array();
  $dest = 'sites/phoenix.dev/files';
  $uploaded_file = file_save_upload('upload', $validators, $dest);
//some other stuff
} 
```

如您所见，我没有传递任何内容来验证“上传”字段中的文件实际上是一个 .csv 文件。这将导致稍后在函数中发生一些令人讨厌的事情。如何使用验证器检查扩展名是否为 .csv，或者更好的是，检查它实际上是否为 .csv 文件？

编辑：谷歌搜索并没有发现任何有用的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T22:35:00.897

[关于 file_validate_extensions 的 Drupal 文档](http://api.drupal.org/api/function/file_validate_extensions/6)建议您更改此内容：

```
$validators = array(); 
```

对此：

```
$validators = array( 'file_validate_extensions' => array( 'csv' ) ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T21:44:32.233

我看不出如何在不实际尝试解析它并查看是否有任何错误的情况下检查它是否是有效的 CSV。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-21T21:16:38.083

确实，不一定需要验证文件的内容，因为目标可能是停止（例如）.php 脚本的执行，并且扩展名为 .csv 的 apache 不会将其作为 php 脚本运行。

# asp.net-mvc - Asp.Net MVC 主题，如何？

> ID：769878
> 
> 赞同：31
> 
> 时间：2009-04-20T20:07:31.500
> 
> 标签：asp.net-mvc, themes

我有一个 ASP.Net 2.0 站点并希望将其转换为 MVC 范例（我是新手），但从零开始。

我的旧站点中有一些主题，但在这里和那里阅读，似乎主题不太适合 MVC 范式。

问题是：

MVC 中构建主题用户可定制站点的最佳实践是什么？如果适用，你能举一个小例子吗？

注意：我知道[这一点](https://stackoverflow.com/questions/229603/re-using-themes-with-asp-net-mvc)，但他们没有谈论最佳实践或如何开始。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-21T23:52:17.537

这是我一直用于在 ASP.NET MVC 中实现“主题”的代码：

[ASP.NET MVC：使用自定义 ViewEngine 实现主题文件夹](http://pietschsoft.com/post/2009/03/ASPNET-MVC-Implement-Theme-Folders-using-a-Custom-ViewEngine.aspx)

当您能够只换出 CSS 文件来更改主题时，这很好，但在很多情况下这真的不是很实用。特别是当每个主题需要有完全不同的布局时。在这种情况下，您需要更改渲染的 CSS 和 HTML，这就是我编写上述链接中的代码的原因。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-20T20:20:21.173

干净、语义正确的 HTML 和良好的 CSS 是任何 Web 应用程序主题的方式，无论是 ASP.NET、RoR、PHP 等。

CSS 力量的最好例子是[CSS Zen Garden](http://www.csszengarden.com/)。

w3schools 有一个很好[的 CSS 介绍/教程](http://www.w3schools.com/Css/css_intro.asp)。

您的每个用户都可以有一个关联的样式表，该样式表将在适用时被选中，即：

```
<link rel="stylesheet" type="text/css" href="<%= Model.SelectedStyleSheet %>"/> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T20:50:09.510

由于主题旨在设置标签样式，因此您可以使用 CSS 创建类似的方法。我可能会建议您从将默认主题复制到 css 定义开始，例如

html: `<input type="button" />`

CSS：输入{颜色：浅蓝色}

然后，对于任何具有非默认主题的内容，您只需对它们应用类即可。将所有主题重写为 CSS 需要一段时间，但一旦完成，就值得付出努力。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T20:37:06.827

[jQuery-ui](http://jqueryui.com/)主题很好，实现起来也不难。

只需链接到 js 和 css 文件，不要忘记图标。并确保在这些链接中使用 Url.Content()。否则，一旦您将其部署到生产服务器上，它可能不会链接到正确的路径（我曾经陷入过那个陷阱）。

# resharper - ReSharper 缩写列表：我在哪里可以修改它？

> ID：769882
> 
> 赞同：142
> 
> 时间：2009-04-20T20:08:45.600
> 
> 标签：resharper

我正在使用 ReSharper 4.5，当我将显式属性转换为自动属性时经常发生的情况是，我会不小心选择“将 XX 添加到缩写列表”。

即：我想将 CustomerID 转换为自动属性，但由于手忙脚乱，我会不小心将“ID”添加到缩写列表中，而我不想这样做。（我希望命名规则使用“Id”而不是“ID”）。

**在哪里可以找到和修改 ReSharper 4.5 中的自定义缩写列表？**

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-04-20T20:14:50.173

在 Resharper 5 中，请参阅下面的答案。

- 在 Resharper 4 中使用 Resharper/Options/Languages/Common/Naming Style 选择单选“Override common settings”这将启用“Manage Abbreviations”按钮

对于特定语言

*   Resharper/Options/Languages/C#/C# 命名风格
*   Resharper/选项/语言/VB/VB 命名风格

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2013-02-26T01:58:49.087

在 Resharper 7.x 中，它与 v6.0 不同，它在特定语言下，对我来说，Resharper/Options/C#/C# Naming Style/Advanced 设置底部是空格分隔的缩写列表。

这是jetbrains（过时的？）网站，其中详细信息（我认为6.x的做法？） [http://www.jetbrains.com/resharper/webhelp50/Coding_Assistance__Naming_Style.html#dynaProc3](http://www.jetbrains.com/resharper/webhelp50/Coding_Assistance__Naming_Style.html#dynaProc3)

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-03-16T13:35:38.743

在 5.0 beta 中，类似

ReSharper/选项/语言/命名样式/高级设置...

然后底部有一个名为“将缩写词编辑为纯文本”的框

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2011-09-28T14:11:54.937

在 Resharper 6 中，它与 5 几乎相同......

ReSharper/选项/语言/命名样式/高级设置...

然后底部的框称为“Abbreviations as plain text (UPPER CASE only):”

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2011-11-16T11:05:57.320

在 Resharper 6.1 (beta) 中，它与 v6.0 略有不同，它低于

ReSharper/选项/代码编辑/C#/C#命名样式/高级设置

然后底部的框称为“Abbreviations as plain text (UPPER CASE only):”

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2016-03-22T15:23:03.767

使用 Visual Studio 2015 的 ReSharper 10.0.2

`ReSharper > Options > Code Editing > C# > Naming Style`

单击`Advanced settings`以打开`Advanced Naming Settings`窗口。

修改文本框`Abbreviations`

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2017-04-25T13:30:04.980

对于 ReSharper 2016 / 2017，可以在下面找到

`ReSharper`>> `Options`>> `Code Editing`>> `C#/VisualBasic.net`>> `Naming Style`>> `Advanced Settings...`>>`Here you will find abbreviations`

根据语言，您会在不同的地方找到它。

有时你会在 `ReSharper`>> `Options`>> `Code Editing`>> `{language}`>> `Naming Style`>>下找到它`abbreviations`

截屏： [![展示了一张图片](https://i.stack.imgur.com/gbNzc.png)](https://i.stack.imgur.com/gbNzc.png)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-10-16T11:39:38.013

ReSharper 9.2：RESHARPER/选项/C#/命名样式/高级设置

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-05-16T11:05:57.300

在 resharper 5.X 版本中，请使用“重置为默认值”删除已添加的缩写。

ReSharper/选项/代码编辑/C#/C# 命名样式/覆盖到常用设置/重置为默认值

@user1107632：2D 和 3D 不是有效变量，无论如何您都不会使用。

[http://www.informit.com/articles/article.aspx?p=24472](http://www.informit.com/articles/article.aspx?p=24472)

# referrer - 在重定向期间执行 javascript 而不更改原始引荐来源网址

> ID：769885
> 
> 赞同：0
> 
> 时间：2009-04-20T20:09:59.123
> 
> 标签：referrer, referer

我需要通过使用一些 javascript 客户端测试（例如，浏览器窗口尺寸）来测试点击是否有效。

但是，我希望原始点击引荐来源保持不变。有没有办法可以进行重定向，执行一些 javascript，捕获浏览器详细信息，然后继续点击，同时保持原始引荐来源值相同？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T20:22:53.350

如果没有，则只需将引荐来源网址作为您捕获的“浏览器详细信息”之一，并与重定向指令一起发回。推荐人可能不会自动在客户端上可用，因此它将像这样工作：

1.  客户端发送初始请求，大概包括一个推荐人。
2.  服务器动态生成客户端测试页面，包括 Javascript 变量中的引荐来源网址。
3.  客户端收集客户端属性，包括步骤 2 中存储的引用者值。
4.  客户端使用新的重定向请求将收集的属性发送到服务器。
5.  服务器在某处记录referrer 参数，尽管不在HTTP 日志中，因为Referer 标头的值与Javascript 请求发送的值不同。

当然，您意识到这无论如何都不可靠，因为这完全取决于客户端，包括步骤 1 中的 Referer 标头，并且无法保证会发生，或者如果确实发生，您获得的值是准确的。我还质疑进行客户端检查（尤其是像窗口尺寸这样任意的东西）以确定导航请求的有效性是否明智。

# jquery - 在我的布局中使用 jquery 选项卡我的选项卡在开始之前有很大的差距

> ID：769891
> 
> 赞同：4
> 
> 时间：2009-04-20T20:12:19.133
> 
> 标签：jquery, css, jquery-ui-tabs

我目前有一个 2 列站点布局，一个页脚/页眉，一个包含菜单的固定宽度左列，以及一个占据剩余可用空间的右手列。我的左侧列包含一个折叠菜单，似乎当我在右侧列中有选项卡时，所选选项卡中的文本仅在我的左侧菜单结束后才开始。

我试过使用 clear:both; before tabs begin 这会导致整个选项卡向下移动，并在左侧菜单结束后开始。

这是我目前正在使用的代码：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta name="generator" content="HTML Tidy for FreeBSD (vers 1st August 2003), see www.w3.org">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js">
  </script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.6/jquery-ui.min.js">
  </script>
  <style type="text/css">
                body{
                        margin: 0;
                        padding: 0;
                }
                #container{
                        margin: 0;
                        background-color: #FFF;
                }
                #header{
                        background-color: #666;
                        border-bottom: 1px solid #333;
                }
                #header h1{
                        margin: 0;
                        padding: .5em;
                }
                #nav{
                        float: left;
                        width: 160px;
                        margin-left: 10px;
                        padding-top: 1em;
                }
                #nav p { margin-top: 0; }
                #content{
                        padding: 0;
                        margin: 0 0 0 180px;
                }
                #footer{
                        clear: both;
                        background-color: #666;
                        padding: 1em;
                        text-align: right;
                        border-top: 1px solid #333;
                }
                #header, #footer {
                        font-size: large;
                        text-align: center;
                        padding: 0.3em 0;
                }
  .menu { margin: 10px; height: 100px; font-size: 8pt; font-family: verdana; }
  .menu ul { margin: 0pt; padding: 0pt; position: relative; z-index: 500; list-style-type: none; width: 125px; }
  .menu li { background-color: #cccc99; float: left; }
  .menu li.sub { background-color: #cccc99; }
  .menu table { position: absolute; border-collapse: collapse; top: 0pt; left: 0pt; z-index: 100; font-size: 1em; margin-top: -1px; }
  .menu a, .menu a:visited { border: 1px solid #ffffff; display: block; text-decoration: none; height: 2em; line-height: 2em; width: 125px; color: #000000; padding-left: 1em; font-weight: normal; font-style: normal; font-variant: normal; text-transform: none; }
  .menu b { float: right; margin-right: 5px; }
  * html .menu a, * html .menu a:visited { width: 125px; }
  * html .menu a:hover { color: #ccff66; background-color: #999966; position: relative; font-weight: normal; font-style: normal; font-variant: normal; text-decoration: none; text-transform: none; }
  .menu li:hover { position: relative; }
  .menu a:active, .menu a:focus { color: #ccff66; background-color: #999966; font-weight: normal; font-style: normal; font-variant: normal; text-decoration: none; text-transform: none; }
  .menu li:hover > a { color: #ccff66; background-color: #999966; font-weight: normal; font-style: normal; font-variant: normal; text-decoration: none; text-transform: none; }
  .menu li ul { padding: 2em; visibility: hidden; position: absolute; top: -2em; left: 7em; background-color: transparent; }
  .menu li:hover > ul { visibility: visible; }
  .menu ul a:hover ul ul { visibility: hidden; }
  .menu ul a:hover ul a:hover ul ul { visibility: hidden; }
  .menu ul a:hover ul a:hover ul a:hover ul ul { visibility: hidden; }
  .menu ul a:hover ul { visibility: visible; }
  .menu ul a:hover ul a:hover ul { visibility: visible; }
  .menu ul a:hover ul a:hover ul a:hover ul { visibility: visible; }
  .menu ul a:hover ul a:hover ul a:hover ul a:hover ul { visibility: visible; }
  .footer
  {
        text-align: center;
        font-family: Arial, sans-serif;
        font-size: 11px;
        color: #CCCCCC;
  }
  .ui-wrapper { border: 1px solid #383838; }
  .ui-wrapper input, .ui-wrapper textarea { border: 0; }
  .ui-tabs-hide {
        display: none !important;
  }
  .ui-tabs-nav, .ui-tabs-panel {
    font-family: Arial, sans-serif;
    font-size: 13px;
        color: #CCCCCC;
        background-color: #242424;
  }
  .ui-tabs-panel a {
        color: #FFD100;
        cursor: pointer;
        outline: none;
  }
  .ui-tabs-nav {
    list-style: none;
    margin: 0;
    padding: 0 0 0 3px;
  }
  .ui-tabs-nav:after { /* clearing without presentational markup, IE gets extra treatment */
    display: block;
    clear: both;
    content: " ";
  }
  .ui-tabs-nav li {
    float: left;
    margin: 0 0 0 2px;
  }
  .ui-tabs-nav a, .ui-tabs-nav a span {
        color: #FFD100;
    float: left; /* fixes dir=ltr problem and other quirks IE */
    padding: 0 12px;
  }
  .ui-tabs-nav a {
    margin: 5px 0 0; /* position: relative makes opacity fail for disabled tab in IE */
    padding-left: 0;
    background-position: 100% 0;
    text-decoration: none;
    white-space: nowrap; /* @ IE 6 */
    outline: 0; /* @ Firefox, prevent dotted border after click */
  }
  .ui-tabs-nav a:link, .ui-tabs-nav a:visited {
    color: white;
  }
  .ui-tabs-nav .ui-tabs-selected a {
    position: relative;
    top: 1px;
    z-index: 2;
    margin-top: 0;
    background-position: 100% -23px;
  }
  .ui-tabs-nav a span {
    padding-top: 1px;
    padding-right: 0;
    height: 20px;
    background-position: 0 0;
    line-height: 20px;
  }
  .ui-tabs-nav .ui-tabs-selected a span {
        color: white;
    font-weight: bold;
    padding-top: 0;
    height: 27px;
    background-position: 0 -23px;
    line-height: 27px;
  }
  .ui-tabs-nav .ui-tabs-selected a:link, .ui-tabs-nav .ui-tabs-selected a:visited,
  .ui-tabs-nav .ui-tabs-disabled a:link, .ui-tabs-nav .ui-tabs-disabled a:visited { /* @ Opera, use pseudo classes otherwise it confuses cursor... */
    cursor: text;
  }
  .ui-tabs-nav a:hover, .ui-tabs-nav a:focus, .ui-tabs-nav a:active,
  .ui-tabs-nav .ui-tabs-unselect a:hover, .ui-tabs-nav .ui-tabs-unselect a:focus, .ui-tabs-nav .ui-tabs-unselect a:active { /* @ Opera, we need to be explicit again here now... */
    cursor: pointer;
  }
  .ui-tabs-disabled {
    opacity: .4;
    filter: alpha(opacity=40);
  }
  .ui-tabs-nav .ui-tabs-disabled a:link, .ui-tabs-nav .ui-tabs-disabled a:visited {
    color: #000;
  }
  .ui-tabs-panel {
    padding: 10px;
    background: #242424; /* declare background color for container to avoid distorted fonts in IE while fading */
  }

  </style>

  <script type="text/javascript">
  $(document).ready(function() {
  $("#tabs > ul").tabs();} );
  </script>

  <title></title>
</head>

<body>
  <div id="container">
    <div id="header">
      Header
    </div>

    <div id="nav">
      <div class="menu">
        <ul>
          <li><a href="#">Home</a></li>

          <li><a href="#">Page1</a></li>

          <li><a href="#">Page2</a></li>

          <li><a href="#">Page3</a></li>

          <li><a href="#">Page4</a></li>

          <li><a href="#">Page5</a></li>

          <li><a href="#">Page6</a></li>

          <li><a href="#">Page7</a></li>

          <li><a href="#">Page8</a></li>

          <li><a href="#">Page9</a></li>

          <li><a href="#">Page10</a></li>

          <li><a href="#">Page11</a></li>

          <li><a href="#">Page12</a></li>
        </ul>
      </div>
    </div>

    <div id="content">
      <div class="main">
        <h1>Main Body Here</h1><br>

        <div id="tabs">
          <ul>
            <li><a href="#one"><span>One</span></a></li>

            <li><a href="#two"><span>Two</span></a></li>

            <li><a href="#three"><span>Three</span></a></li>
          </ul>

          <div id="one">
            Tab One Here
          </div>

          <div id="two">
            Tab Two Here
          </div>

          <div id="three">
            Tab Three Here
          </div>

        </div>
      </div>
    </div>

    <div id="footer" class="footer">
      Footer
    </div>
  </div>
</body>
</html> 
```

任何帮助将不胜感激。谢谢。

注：Jquery 1.3、Jquery-ui 1.6

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T20:50:02.583

试试这个：

```
.ui-tabs-nav { height:2em; } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T21:35:10.073

默认情况下，清算在全球范围内适用。这就是导致您看到的错误的原因 - #nav 位于内容中的选项卡之前，因此 clear:both 将清除它（您实际上在 .tabs::after 上使用 clear:both，但差异相同）。

为了“包含”清除并防止它与页面中其他地方的元素交互，您还需要浮动容器。在这种情况下，这将是 div.content。添加一个 float:left 和一个 width:100% 以使其拉伸 div#main 的宽度，您将获得所需的行为 - 标签卡将直接位于标签本身的下方。

（顺便说一下，这是“浮动几乎所有东西”策略的一个原因 - 尽管大量过度使用浮动，它仍然可以以理智的方式使用 clear 。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-17T20:57:56.457

关于：

> 编辑 不久前，当我开始使用 jQuery UI 时，下载附带的 CSS 导致我的日历以我预期的 150% 的大小呈现。通过他们的网站，我不得不将字体大小和填充更改为 CSS，然后重新下载。如果间距关闭，听起来可能在某处应用了一些填充。

我最初遇到了同样的问题，但是像下面这样更改 ui.tabs.css 有效：

.ui-tabs { 填充：.2em; 缩放：1；**字体大小：80% ！重要；**}

# javascript - 如何阻止垃圾邮件发送者从 mailto 链接获取电子邮件地址？

> ID：769894
> 
> 赞同：5
> 
> 时间：2009-04-20T20:14:28.800
> 
> 标签：javascript, spam-prevention, mailto

### 复制：

> *   [在网站上混淆电子邮件地址的最佳方法是什么？](https://stackoverflow.com/questions/748780/best-way-to-obfuscate-an-e-mail-address-on-a-website/)
> *   [从垃圾邮件机器人隐藏电子邮件的有效方法](https://stackoverflow.com/questions/483212/effective-method-to-hide-email-from-spam-bots)
> *   [有哪些方法可以保护网站上的电子邮件免受垃圾邮件机器人的侵害？](https://stackoverflow.com/questions/308772/what-are-some-ways-to-protect-emails-on-websites-from-spambots)

* * *

防止垃圾邮件发送者从您的 mailto 链接获取电子邮件地址的最佳方法是什么？我的印象是 javascript 可能是一个解决方案。我不知道我目前的解决方案是否是万无一失的，所以这就是我问的原因。

这是我目前正在做的事情：

```
<script language="JavaScript"><!--
var name = "emailusername";
var domain = "yahoo.com";
var text = "emailusername@yahoo.com";
document.write('<a href=\"mailto:' + name + '@' + domain + '\">');
document.write(text + '</a>');
// --></script> 
```

有没有更好的方法？我不喜欢在任何我想放置邮件链接的地方都有这段代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T20:21:05.413

*   [在网站上混淆电子邮件地址的最佳方法是什么？](https://stackoverflow.com/questions/748780/best-way-to-obfuscate-an-e-mail-address-on-a-website)
*   [从垃圾邮件机器人隐藏电子邮件的有效方法](https://stackoverflow.com/questions/483212/effective-method-to-hide-email-from-spam-bots)
*   [有哪些方法可以保护网站上的电子邮件免受垃圾邮件机器人的侵害？](https://stackoverflow.com/questions/308772/what-are-some-ways-to-protect-emails-on-websites-from-spambots)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T20:16:58.840

Javascript 有帮助，但这无济于事。使用这种类型的脚本，电子邮件地址在 html 源代码中仍然可见。

“最佳”选项使用客户端 javascript 将电子邮件地址从部分中“构建”出来，因此整个电子邮件地址在 HTML 源代码中永远不可见。浏览器将它放在客户端上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:19:16.340

一个简单的修复：

```
<script language="JavaScript"><!--
var name = "emailusername";
var domain = "yahoo.com";
document.write('<a href=\"mailto:' + name + '@' + domain + '\">');
document.write(name + '@' + domain + '</a>');
// --></script> 
```

这基本上与 Reed 建议的相同，但与您现有的代码相同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T20:17:23.130

这甚至不是一个好方法。垃圾邮件发送者将抓住整个事情并使用正则表达式匹配地址。他们不会费心寻找mailto:。此外，您可以使用 Javascript 想到的任何方案都已经被垃圾邮件发送者所攻击和反击。事实上，他们可能只是能够运行 javascript 并获得地址。

你可以

A）过滤垃圾邮件
B）使用表单提交邮件（垃圾邮件发送者可能仍会使用。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T20:19:00.020

你走在正确的轨道上，但是`emailusername`在那里有点违背了目的（大多数蜘蛛机器人不会费心区分 HTML 和脚本代码，只是在页面上寻找任何看起来像电子邮件的东西）。

我听说有证据表明一些蜘蛛机器人现在能够运行 Javascript，并且会自行解决这种混淆。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T20:20:09.193

没有 110% 万无一失的方法可以防止这种情况，除了只会阻碍电子邮件使用的愚蠢技巧，例如将所有电子邮件地址作为图像等。

至少就我个人而言，我已经接受地址至少在某种程度上会被收割。我使用这个小 php 函数对所有电子邮件地址进行 html 编码。这样，所有真正的浏览器都可以完美地使用它们，但愚弄最愚蠢的收割机。就像我说的，这不是 110%，但我很满意。

```
function turboencode($s){
    $tempstr = "";
    for($i = 0; $i < strlen($s); $i++){
        $c = substr($s, $i, 1);
        $tempstr .= "&#" . ord($c) . ";";
    }
    return $tempstr;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T20:25:53.810

防止收获的最好方法是根本没有 mailto: 链接。

除此之外，柜台并不多。诸如 CSS 内容和图像之类的东西已经被尝试和规避了，而 JavaScript 是一种半途而废的解决方案（也就是说它不起作用。）

一种可能的对策是混淆：像这样在您的地址中添加废话：

```
mailNO`at`SPAMyahoo`dot`com 
```

大多数自动收割机（最初）在检测到它时会遇到一些麻烦。或者，可以使用诸如评论之类的东西来迷惑大多数收割机。（RFC822 描述了电子邮件地址的完整语法，其中包括作为地址规范一部分的注释。）

另一个计数器是使用带有某种验证码的表单。

它们都不是完全有效的。

# windows - 在 windows 上更新 OpenGL 库

> ID：769901
> 
> 赞同：0
> 
> 时间：2009-04-20T20:16:31.447
> 
> 标签：windows, opengl

我正在使用使用 OpenGL 的第 3 方 DLL。现在第三方不能正常工作，因为显示器不能正确刷新。我开始怀疑 OpenGL 库没有正确安装或可能已过时。

有没有办法在 Windows 上更新 OpenGL 库？是否有官方网站可以保存正确的 opengl.dll 文件或类似的文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T20:19:49.287

我相信 OpenGL 库只是显卡附带的驱动程序的一部分。升级你的图形驱动程序应该将你的 OpenGL 东西升级到你的卡支持的最新版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T20:20:23.683

OpenGL 在 Windows 上应该是最新的。

但是，如果您遇到显示/刷新问题，并且它们只发生在 Windows 上，则这很可能是您的图形驱动程序的问题。

尝试更新到最新的 OpenGL 图形驱动程序。这修复了 Windows 上的许多 OpenGL 问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T20:22:03.570

opengl.dll 是您的显卡驱动程序的一部分。Windows 带有一个默认的 opengl.dll，它提供的加速很少。重新安装显卡驱动或升级到最新版本应该可以解决您的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-27T20:26:27.260

OpenGL 在图形驱动程序中实现。如果您想使用最新的 OpenGL 版本作为开发人员，您可以下载并使用 GLEW (http://glew.sourceforge.net/) 作为普通库。这将使您能够访问跨平台 OpenGL 4.1 或您的卡支持的任何版本。

# asp.net-ajax - ASP.NET AJAX - 面板中的更新重新发送所有页面验证脚本

> ID：769932
> 
> 赞同：1
> 
> 时间：2009-04-20T20:24:33.317
> 
> 标签：asp.net-ajax, telerik, telerik-grid

我正在使用 Telerik 的[RadGrid](http://www.telerik.com/products/aspnet-ajax/grid.aspx)并启用了 Ajax。每当发生 Ajax 调用时，页面都会响应 56 KB 的 JavaScript 验证器以及新的网格数据（除了 40k 的视图状态 - 啊）。有什么解决方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-20T13:11:46.633

您是否尝试过将其绑定到 Web 服务而不是进行标准的服务器端绑定？请参阅“ [ASP.NET 网格演示 - .NET 3.5 - .NET 3.5 客户端数据绑定](http://demos.telerik.com/aspnet-ajax/grid/examples/clientbinding/defaultcs.aspx)”。

当您从服务器端 Ajax 切换到 Web 服务时，我所使用过的大多数 Telerik 控件都会获得大约 10 倍的加速。

# html - 验证和显示问题？

> ID：769946
> 
> 赞同：0
> 
> 时间：2009-04-20T20:29:18.560
> 
> 标签：html, css, browser, xhtml

我正在为一个朋友开发一个网站，该网站是早期由其他人开发的，基本上，我是一名 PHP 专业人士，在 HTML 方面没有太多经验（或直到现在）......

现在，我正在尝试验证我的网页，之前它显示 162 个错误，我已将其降低为 1 个错误（谢谢）...哈哈

早些时候有 162 个错误，它在 firefox3 中看起来不错，但在 ie6 或 ie7 中根本没有加载.....

现在，因为我已经设法将其降低到 1 个错误，它在 Firefox 中看起来像往常一样好，并且在 ie6 和 ie7 上也可以加载，但在 ie 中无法正确呈现 .... 页面布局有点乱码。

现在唯一剩下的错误是....属性“height”存在，但不能用于此元素。......

现在，当我处理所有这些错误时......即在表格中删除 height="100%" ......即使是 firefox 也拒绝正确显示它。

请指出我正确的方向...过去五天我一直在整个网站上工作..这是无偿的....

我不知道发布链接的规则......无论如何......这是我正在谈论的页面的链接......我希望我有道理......

[http://www.shivgangaresorts.com/dev/aboutus.html](http://www.shivgangaresorts.com/dev/aboutus.html)

请在 ff3 和 ie6 或 ie7 中查看此页面以了解我在说什么....任何帮助将不胜感激....

提前一百万

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T20:54:51.433

您可以尝试使用 style="height: 100%" 而不是 height="100%"

标签上的大多数高度/宽度属性都假定您正在谈论像素，因此它不知道您的“％”字符的含义。

见这篇[文章](http://apptools.com/examples/tableheight.php)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T20:57:38.837

毕竟，100% 作为任何元素的属性，在几乎所有情况下都是愚蠢的。没有浏览器正确应用 100% 值。

但是，如果您尝试验证您的文档，请退出 100% 值并将其放在单独的 CSS 类中。例如：

```
table {
    width: 100%;
    height: 100%;
} 
```

现在我希望你的文件是有效的！哈哈

问候！

# asp.net - Python 在组合框中选择一个值和 HTTP POST

> ID：769948
> 
> 赞同：1
> 
> 时间：2009-04-20T20:29:50.480
> 
> 标签：asp.net, python, http, web-scraping

在 Python 中，我试图读取[http://utahcritseries.com/RawResults.aspx](http://utahcritseries.com/RawResults.aspx)上的值。除了默认的 2002 年，我如何读取年份？

到目前为止，使用 mechanize，我已经能够引用 SELECT 并列出其所有可用的选项/值，但不确定如何更改其值并重新提交表单。

我确定这是一个常见问题并且经常被问到，但我不确定我什至应该搜索什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T11:32:11.900

那么这个怎么样：

```
from mechanize import Browser
year="2005"

br=Browser()
br.open("http://utahcritseries.com/RawResults.aspx")
br.select_form(name="aspnetForm")
control=br.form.find_control("ctl00$ContentPlaceHolder1$ddlSeries")
control.set_value_by_label((year,))
response2=br.submit()

print response2.read() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T20:35:14.850

如果遇到与页面 AJAX 加载相关的问题，请使用[Firebug！](http://getfirebug.com/)

安装并打开 Firebug（它是一个 Firefox 插件），进入网络页面，确保选择“全部”。打开 URL 并更改选择框，然后查看发送到服务器的内容以及接收到的内容。

似乎这个名字很吸引人的字段`ctl00$ContentPlaceHolder1$ddlSeries`是负责任的..以下是否有效..？

```
import urllib

postdata = {'ctl00$ContentPlaceHolder1$ddlSeries': 9}

src = urllib.urlopen(
    "http://utahcritseries.com/RawResults.aspx",
    data = urllib.urlencode(postdata)
).read()

print src 
```

# xml - 在 subversion 中管理 XML 文档，忽略格式

> ID：769950
> 
> 赞同：4
> 
> 时间：2009-04-20T20:30:11.430
> 
> 标签：xml, svn, formatting

我需要在 Subversion 中管理 XML 文档，但不想管理格式，这可能会因编辑文件的人而异。

我看到了两种解决方案：每次在签入之前使用已知格式格式化文件。或者给 svn 一个 diff 程序，该程序会主动从 diff 算法中消除格式化。最终差异当然应该支持主动忽略 XML 格式的三向合并。

你有什么建议吗？

（同样的推理通常适用于代码源文件，但问题更难。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T07:10:06.087

我对这种设置没有太多个人经验。

对于第二种方法（自定义差异），我找到了一个示例，[“Netopeer 存储库库的 API 描述”](http://www.liberouter.org/documents/repository.pdf)，它详细描述了 Subversion 的设置以及[xmldiff](ftp://ftp.logilab.org/pub/xmldiff/)等。

对于另一种方法，在存储到 Subversion 之前转换为已知格式，我推荐使用[Canonical XML](http://www.w3.org/TR/2001/REC-xml-c14n-20010315)作为格式。例如，[xmllint](http://svn.collab.net/repos/svn/trunk/contrib/hook-scripts/enforcer/)工具可以转换为这种格式：

```
% cat complique.xml
<?xml version="1.0" encoding="utf-8"?>
<toto   >
    <truc      a="1" >Machin &#x43; </truc >café</toto>

% xmllint --c14n complique.xml    
<toto>
    <truc a="1">Machin C </truc>café</toto> 
```

要与 Subversion 集成，您可以在预提交中测试提交的文件是否等于规范文件。一个可能的这样的脚本是[我使用 xmllint 的预提交](http://www.bortzmeyer.org/files/pre-commit-check-xml-canonical.sh)。有关示例，另请参见执行器[脚本。](http://svn.collab.net/repos/svn/trunk/contrib/hook-scripts/enforcer/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T00:16:56.830

您认为以下两个 xml 片段是否相同...？

片段1：

```
<foo xmlns="http://foo.com/foo">
    <bar>Hello</bar>
</foo> 
```

片段2：

```
<ns1:foo xmlns:ns1="http://foo.com/foo">
    <ns1:bar>Hello</ns1:bar>
</ns1:foo> 
```

...因为如果您这样做（因为这些片段具有相同的 xml 信息集），那么您需要考虑编写自己的差异工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T21:17:44.310

如果“格式化”是指“空白”，则可以使用命令中的开关配置`svn diff`为忽略空白：`-w``diff`

```
$ svn diff -x -w [file] 
```

有关[`svn help diff`](http://svnbook.red-bean.com/en/1.0/re09.html)更多信息，请参阅。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T17:50:14.160

只需让所有开发人员都在同一页面上。无论如何，它们都应该按照相同的标准进行编码。如果您的编码员都使用不同的格式标准，那么您将面临更大的问题需要解决。

# sql - 将一个表中的多个列连接到另一个表中的单个列

> ID：769953
> 
> 赞同：6
> 
> 时间：2009-04-20T20:30:41.867
> 
> 标签：sql

我希望创建一个从两个表“Schedule”和“Reference”中提取数据的视图。

Schedule 有 50 多列（它几乎完全是非规范化的——不是我的设计），其中大部分包含一个可以连接到 Reference 表中的列的值。

如何编写 SQL 语句以将 Schedules 中的每一列正确连接到 Reference 中的单个列？

调度表定义为：

```
 CREATE TABLE [dbo].[Schedule](
    [ID] [int] NOT NULL,
    [SCHEDULEWEEK] [datetime] NOT NULL,
    [EMPNO] [numeric](10, 0) NOT NULL,
    [EMPLNAME] [varchar](32) NULL,
    [EMPFNAME] [varchar](32) NULL,
    [EMPSENDATE] [datetime] NULL,
    [EMPHIREDATE] [datetime] NULL,
    [EMPTYPE] [char](1) NULL,
    [EMPSTATUS] [char](1) NULL,
    [SNREFUSALS] [tinyint] NULL,
    [QUALSTRING] [varchar](128) NULL,
    [JOBOVERSHIFTTYPE] [bit] NULL,
    [SHORTNOTICE] [bit] NULL,
    [SHORTNOTICEWAP] [bit] NULL,
    [SHORTNOTICEPHONE] [varchar](32) NULL,
    [LEADHAND] [bit] NULL,
    [DUALCURRENCY] [bit] NULL,
    [MIN100WINDOW] [bit] NULL,
    [STATHOLIDAY] [bit] NULL,
    [AREAOVERHOURS] [bit] NULL,
    [DOUBLEINTERZONES] [bit] NULL,
    [MAXDAYSPERWEEK] [tinyint] NULL,
    [MAXHOURSPERWEEK] [numeric](10, 2) NULL,
    [MAXHOURSPERSHIFT] [numeric](10, 2) NULL,
    [MAXDOUBLESPERWEEK] [tinyint] NULL,
    [ASSIGNEDDAYS] [tinyint] NULL,
    [ASSIGNEDHOURS] [numeric](10, 2) NULL,
    [ASSIGNEDDOUBLES] [tinyint] NULL,
    [ASSIGNEDLOAHOURS] [numeric](10, 2) NULL,
    [SHIFTNO1] [int] NULL,
    [TEXT1_1] [varchar](64) NULL,
    [TEXT2_1] [varchar](64) NULL,
    [DAYFLAG1] [bit] NULL,
    [COMMENT1] [text] NULL,
    [SHIFTNO2] [int] NULL,
    [TEXT1_2] [varchar](64) NULL,
    [TEXT2_2] [varchar](64) NULL,
    [DAYFLAG2] [bit] NULL,
    [COMMENT2] [text] NULL,
    [SHIFTNO3] [int] NULL,
    [TEXT1_3] [varchar](64) NULL,
    [TEXT2_3] [varchar](64) NULL,
    [DAYFLAG3] [bit] NULL,
    [COMMENT3] [text] NULL,
    [SHIFTNO4] [int] NULL,
    [TEXT1_4] [varchar](64) NULL,
    [TEXT2_4] [varchar](64) NULL,
    [DAYFLAG4] [bit] NULL,
    [COMMENT4] [text] NULL,
    [SHIFTNO5] [int] NULL,
    [TEXT1_5] [varchar](64) NULL,
    [TEXT2_5] [varchar](64) NULL,
    [DAYFLAG5] [bit] NULL,
    [COMMENT5] [text] NULL,
    [SHIFTNO6] [int] NULL,
    [TEXT1_6] [varchar](64) NULL,
    [TEXT2_6] [varchar](64) NULL,
    [DAYFLAG6] [bit] NULL,
    [COMMENT6] [text] NULL
-- Snip
) ON [PRIMARY] 
```

参考表定义为：

```
CREATE TABLE [dbo].[Reference](
    [ID] [int] NOT NULL,
    [CODE] [varchar](21) NOT NULL,
    [LOCATIONCODE] [varchar](4) NOT NULL,
    [SCHAREACODE] [varchar](16) NOT NULL,
    [LOCATIONNAME] [varchar](32) NOT NULL,
    [FLTAREACODE] [varchar](16) NOT NULL
) ON [PRIMARY] 
```

我正在尝试将 Schedule 中的每个 [TEXT1_ *]/[TEXT2_* ] 列加入到参考中的 [SCHAREACODE] 列。参考表包含的所有内容都是员工可以工作的区域列表。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T20:43:55.110

我认为他的意思是多次加入参考表：

```
SELECT *
  FROM Schedule AS S
 INNER JOIN Reference AS R1 
         ON R1.ID = S.FirstID 
 INNER JOIN Reference AS R2 
         ON R2.ID = S.SecondID 
 INNER JOIN Reference AS R3 
         ON R3.ID = S.ThirdID 
 INNER JOIN Reference AS R4 
         ON R4.ID = S.ForthID 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T20:46:04.823

你的描述有点欠缺，所以我假设

> Schedule 有 50 多列（它几乎完全是非规范化的——不是我的设计），其中大部分包含一个可以连接到 Reference 表中的列的值。

表示 Schedule 中 50 多列中有 1 列是 ReferenceId。因此，给定一个表格设计，例如：

```
Schedule ( MaybeReferenceId1, MaybeReferenceId2, MaybeReferenceId3, ... )
Reference ( ReferenceId ) 
```

就像是：

```
SELECT *
FROM Schedule
JOIN Reference ON
     Schedule.MaybeReferenceId1 = Reference.ReferenceId
     OR Schedule.MaybeReferenceId2 = Reference.ReferenceId
     OR Schedule.MaybeReferenceId3 = Reference.ReferenceId
     OR Schedule.MaybeReferenceId4 = Reference.ReferenceId
     ... 
```

会工作。`IN`如果您的 RDBMS 支持它，您可以使用它来简化它：

```
SELECT *
FROM Schedule
JOIN Reference ON
     Reference.ReferenceId IN (
        Schedule.MaybeReferenceId1,
        Schedule.MaybeReferenceId2,
        Schedule.MaybeReferenceId3,
        Schedule.MaybeReferenceId4,
        ...
     ) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T20:40:14.527

从更新的问题

也许是这样的？不管你做什么都会很乱。

```
SELECT S.ID
  S.TEXT1_1,
  TEXT1_1_RID = COALESCE((SELECT MAX(R.ID) FROM Reference R WHERE R.SCHAREACODE = S.TEXT1_1), 0),
  S.TEXT1_2,
  TEXT1_2_RID = COALESCE((SELECT MAX(R.ID) FROM Reference R WHERE R.SCHAREACODE = S.TEXT1_2), 0),
  ...
FROM Schedule S 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T08:46:17.883

尝试这样的查询：

```
select s.*, r.schareacode from schedule s, 
where 
s.text1_1 = s.schareacode
or s.text2_1 = s.schareacode
or s.textx_x = s.schareacode
.. 
```

您应该能够使用传统联接获得相同的结果，因此我建议您也尝试一下。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T22:23:57.927

同意*TheSoftwareJedi*，但我可以建议使用 LEFT JOIN 以便匹配失败不会导致您的 Schedule 行消失吗？

当然，无论细节如何，做 28 次 JOIN 都会有点麻烦。

我不确定我会称之为“非规范化”，更“非规范化”...... :-)

# sql - 仅比较行内容的工具

> ID：769954
> 
> 赞同：0
> 
> 时间：2009-04-20T20:30:42.520
> 
> 标签：sql, diff, compare, bcp

我正在开发一个工具来生成 TSV 文件，以便使用 bcp.exe 导入数据库，我想验证我的输出。我可以通过将我生成的文件与使用 bcp 从现有数据库导出的文件进行比较来做到这一点。我的问题是文件之间的顺序有时可能不同。我想要一个工具，它可以告诉我在一对文件中是否存在不完全匹配的行，而不管行的顺序如何。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T20:56:24.720

*'不顾'是否是一个词的'不顾'* ......

进行该比较的可靠方法是将两个文件排序为相同的顺序，然后进行文件比较。既然你提到了“bcp.exe”，那听起来更像是 Windows，可能是 MS SQL Server，而不是 Unix 和 Sybase。

我可能会使用 Cygwin`diff`或者`comm`比较（和`sort`排序）文件，或者任何等效的 Unix 类似工具集（MKS，...）。其他人可能会推荐其他工具。这部分取决于您认为正常情况下可能会发现多少差异，以及在找到它们后您将如何处理它们。是否需要 GUI 输出？此外，您还面临着将差异追踪回未排序数据文件中特定行号的问题。

# reporting-services - SQL Reporting Services - 从左到右、从上到下显示

> ID：769957
> 
> 赞同：1
> 
> 时间：2009-04-20T20:32:00.677
> 
> 标签：reporting-services, reporting, reportingservices-2005

SQL Reporting 2005 中有没有办法在从左到右然后上下打印的列中显示数据？例子：

```
Column 1        Column 2

  Adam            Bob
  Carl            Dick
  Eric            Fred 
```

而不是当前的方式是：

```
 Column 1        Column 2

  Adam            Dick
  Bob             Erick
  Carl            Fred 
```

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T06:50:28.957

[水平表](http://blogs.msdn.com/ChrisHays/archive/2004/07/23/193292.aspx)...？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T04:10:00.997

我能想到的3种方法。

不过没有什么漂亮或自然的。问题是 SSRS 中没有标准控件，并且没有用于管理标准控件中的布局的控件数据

首先，生成一个虚拟列，比如使用 ROW_NUMBER() 和模 2。使用它来将数据集结果过滤为 2：将每个过滤集绑定到并排表。

二、在矩形中使用矩阵控件 这将并排拆分成对的行，使用矩形分组来拆分成对。您将需要一个虚拟列再次进行分组，但要上升 0、0、1、1、2、2（嗯，如何做到这一点......）

第三，将数据集生成为 2 列。使用 ROW_NUMBER() 和模 2 列的自联接或 PIVOT

就个人而言，我倾向于第 3 选项或第 1 选项。

# wpf - 资源的 WPF 代码隐藏？

> ID：769960
> 
> 赞同：3
> 
> 时间：2009-04-20T20:33:32.263
> 
> 标签：wpf, resources

我正在开发一个 wpf 应用程序，直到最近，我在 xaml 的主窗口资源部分中有一个 ResourceDictionary。资源字典包含一个 DataTemplate，用于设置窗口中多个列表框的样式。此数据模板的 xaml 包含指向事件处理程序的指针，例如：

```
<Button n:Name="btnClickMe" Content="Click Me!" LeftMouseButtonUp="btnClickMe_Click" /> 
```

我最近决定将窗口的内容拆分为单独的用户控件，并将我的 ResourceDictionary 移动到它自己的文件中。但是，当然，资源字典文件没有代码隐藏文件。我怎么能把它连接起来，就像我描述的那样把事情分开？

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T20:39:03.593

您可以将代码隐藏添加到 ResourceDictionary；只要确保您的类名被正确引用。例如，在 ResourceDictionary 中，如果您使用 AppStyles.xaml，XAML 文件将具有以下类：

```
x:Class="Client.App.Shell.themes.AppStyles" 
```

在代码隐藏 AppStyles.xaml.cs 中，您将确保拥有该类：

```
namespace Client.App.Shell.themes
{
    public partial class AppStyles
    ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T21:42:29.323

您可以添加一个新类并将其命名为与资源字典相同的名称加上`.cs`扩展名，Visual Studio 将自动进行设置，使其成为代码隐藏文件。

例如，如果您有一个名为 的资源字典`Buttons.xaml`，请添加一个名为`Buttons.xaml.cs`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T21:02:31.087

你应该考虑使用[RoutedCommands](http://msdn.microsoft.com/en-us/library/ms752308.aspx)，我在想。网上有很多资源，这里有一些可能对你有帮助。

[http://msdn.microsoft.com/en-us/library/ms752308.aspx](http://msdn.microsoft.com/en-us/library/ms752308.aspx) [http://www.devx.com/DevX/Article/37893/0/page/1](http://www.devx.com/DevX/Article/37893/0/page/1)

# javascript - jQuery 之前的 JavaScript

> ID：769962
> 
> 赞同：1
> 
> 时间：2009-04-20T20:33:33.373
> 
> 标签：javascript, jquery

### 复制：

> *   [使用 jQuery 的优缺点是什么？](https://stackoverflow.com/questions/122902/what-are-some-of-the-pros-and-cons-of-using-jquery)
> *   [在学习如何编写 AJAX 客户端代码时，我应该避免使用 JavaScript 库吗？](https://stackoverflow.com/questions/215589/should-i-avoid-using-a-javascript-library-while-learning-how-to-write-ajax-client/215599)

* * *

我已经读过很多遍了……“我会在学习 jQuery 之类的东西之前先学习 JavaScript”——但这对于每种情况真的有必要吗？当然，有些人想知道幕后发生了什么，但是直接阅读 jQuery 教程/书籍有什么严重的负面影响吗？我想在业余时间学习一些东西，我已经决定使用 jQuery（或者 JavaScript，如果有人能足够强烈地说服我的话）。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-20T20:41:24.210

jQuery 是一个库，而不是一种语言。你基本上说过，“我正在考虑学习如何写英文歌曲。有人说你应该先学习英语，但我不相信这值得，我只是想摇滚。”

您可能仍然可以在不先学习 JavaScript 的情况下学习 jQuery，但您最终将不了解 jQuery 的实际工作原理，并且可能只是接受它的魔力。祝你好运，当 jQuery 发生故障或无法按您的预期工作并且无法弄清楚您的代码为何损坏时。

JavaScript 是一门美丽的语言，它本身就值得学习。从这里开始：[Eloquent Javascript](http://eloquentjavascript.net/contents.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T20:36:00.167

典型的推荐“在 jQuery 之前学习 JS”的原因是因为你会发现自己有太多次问自己一些 jQuery 代码片段是如何工作的，而这不是 jQuery 的问题，而是 JS 语法 / 等（例如闭包）的问题。

去 JS，你不会失望的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T20:41:29.763

这就像在使用 Cocoa 之前询问是否值得学习 Objective-C。这是一个奇怪的问题，因为 Cocoa 是用 Objective-C 编写的，就像 jQuery 是用 JavaScript 编写的一样。当你学习 jQuery 时，不管你喜欢与否，你都会学习一些 JavaScript。

我认为您想知道的更多是“我应该学习 jQuery 使用其核心库和插件绕过的底层 JavaScript 吗？” 当然，这取决于情况；如果您急需代码，最好单独学习 jQuery。但是由于您的目标似乎是在业余时间学习一些东西，我个人认为在深入研究 jQuery 之前学习基本的 JavaScript 是个好主意：

*   如果您需要弄清楚 jQuery 的内部是如何工作的，那么您需要了解核心 JavaScript。考虑到有多少 jQuery 插件，这一点尤其重要。
*   如果您需要扩展 jQuery 或插件功能，您可能需要了解更详细的 JavaScript。
*   如果您只知道 jQuery，那么如果您遇到这种情况，您会发现使用其他框架和/或 vanilla JavaScript 会更加困难。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T20:45:06.637

毫无疑问。jQuery 是 JavaScript。如果您直接跳入 jQuery，您将严重妨碍自己。您的代码将很慢且无法维护。jQuery 是一种 API，它不是一种语言。

事实上，您可以尝试跳入 jQuery，但我怀疑您是否会走得很远，而不会因原本微不足道的障碍而感到沮丧。至少，您应该了解[JavaScript 再介绍中](http://developer.mozilla.org/en/A_re-introduction_to_JavaScript)的概念。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T20:46:41.297

实际上这是非常好的建议。

问题是这样的。Javascript 的工作方式与大多数其他流行语言的工作方式不同。如果您深入研究 Javascript，并认为它类似于 Java、C#、Perl、PHP 等，那么您最终会认为 Javascript 是一种奇怪的、不一致的突变语言，没有任何意义。这并不是因为 Javascript 没有意义，而是因为 Javascript 在其基础上是不同的。Javascript 是一种面向对象的语言，但它不是基于类的，而是基于原型的。语法与您可以很好地工作的地方非常相似，认为 Javascript 是基于类的，直到一切都出现可怕的错误。

首先学习 Javascript，至少是基础知识。这并不难，您甚至不需要特殊的 IDE 或编译器，因为您可以使用浏览器或 WSH。如果您使用 jQuery，学习 Javascript 的基础知识肯定会有所收获。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T20:41:13.277

很多学习和使用 jQuery 都是*免费*开始的，并且可以激励，因为它提供了一种直接的生产力感。然而，确实有一点，您需要了解 JavaScript 才能有效地使用 jQuery 或任何其他 JavaScript 框架。例如，在编写插件和实用程序函数时，这一点尤为重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T20:43:07.140

出于同样的原因，VB6 程序员需要了解 Windows API 才能完成任何事情，而 VB.NET 和 C# 程序员至少需要知道 MSIL 是什么样的，您应该对 JavaScript 足够熟悉才能了解 jQuery 正在做什么。JavaScript 中内置了很多遥远的东西，大多数人永远不需要使用，但如果你不知道它的存在，你总是会忽略解决问题的好方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T20:45:31.533

JQUERY 只是一个库，而不是像 JAVASCRIPT 这样的语言的替代品。仅仅学习图书馆，你不会在软件开发领域取得进步。对核心语言有基本的了解总是更好的方法。当然，一旦你掌握了这一点，你就可以并且应该明确地使用 JQUERY 之类的库。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-20T20:47:11.420

我非常强烈地认为 JavaScript 是一个比 jQuery 或任何它的兄弟姐妹更重要的概念。这些库非常棒，我很难想象没有它们的帮助在客户端做任何事情，但它们本身只提供一些工具和一些华丽的修饰。要真正完成任何真正的逻辑，您需要对 JavaScript 和浏览器中可用的对象有很好的理解。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-20T20:55:41.010

如果您曾经用任何普通语言写过任何东西，那么对您的问题的简短回答是*肯定的。*

如果您想知道原因，请观看Douglas Crockford（JS 大师）的[JavaScript 精彩部分](http://www.youtube.com/watch?hl=en&v=hQVTIJBZook&gl=US)。

# java - Java 的 L 号（长）规范

> ID：769963
> 
> 赞同：105
> 
> 时间：2009-04-20T20:34:06.070
> 
> 标签：java, numbers, long-integer, short, specifications

看来，当您在 Java 中输入数字时，编译器会自动将其读取为整数，这就是为什么当您输入 (long) `6000000000`（不在整数范围内）时，它会抱怨`6000000000`不是整数。为了纠正这个问题，我必须指定`6000000000L`. 我刚刚了解了这个规范。

是否有其他数字规范，例如短、字节、浮点、双精度？拥有这些似乎很好，因为（我假设）如果您可以指定您输入的数字是一个短数字，那么 java 就不必强制转换它 - 这是一个假设，如果我错了，请纠正我. 我通常会自己搜索这个问题，但我什至不知道这种数字规范叫什么。

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2009-04-20T20:45:24.013

`long`(eg `39832L`)、`float`(eg `2.4f`) 和`double`(eg )有特定的后缀`-7.832d`。

如果没有后缀，并且是整数类型（例如`5623`），则假定为`int`. 如果它不是整数类型（例如`3.14159`），则假定它是 a `double`。

在所有其他情况下（`byte`, `short`, `char`），您需要强制转换，因为没有特定的后缀。

Java 规范允许使用大写和小写后缀，但`long`首选 s 的大写版本，因为大写比小写`L`更不容易与数字混淆。`1``l`

有关血腥细节，请参阅[JLS 第 3.10 节](http://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.10)（请参阅 的定义`IntegerTypeSuffix`）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2017-03-18T12:58:30.470

默认情况下，任何完整的原始数据类型（byte、short、int、long）都将被java 编译器视为*int类型。*对于*byte*和*short*，只要分配给它们的值在它们的范围内，就没有问题，也不需要后缀。如果分配给*byte*和*short*的值超出了它们的范围，则需要显式类型转换。

前任：

```
byte b = 130; // CE: range is exceeding. 
```

克服这个执行类型转换。

```
byte b = (byte)130; //valid, but chances of losing data is there. 
```

在长数据类型的情况下，它可以毫不费力地接受整数值。假设我们分配喜欢

```
long l = 2147483647; //which is max value of int 
```

在这种情况下，不需要像 L/l 这样的后缀。默认值 2147483647 被 java 编译器认为是 int 类型。内部类型转换由编译器完成，int 自动提升为 Long 类型。

```
long l = 2147483648; //CE: value is treated as int but out of range 
```

这里我们需要把后缀写成 L 来让 java 编译器把字面量 2147483648 当作 long 类型。

所以最后

```
long l = 2147483648L;// works fine. 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-20T20:45:51.110

我希望你不会介意一点切线，但我想你可能有兴趣知道除了`F`(for float)、`D`(for double) 和`L`(for long) 之外，[还提出了](http://mail.openjdk.java.net/pipermail/coin-dev/2009-March/000905.html)分别为`byte`and 和`short`-`Y`和添加后缀的提议`S`. 当使用字节（或短）数组的文字语法时，这将消除转换为字节的需要。引用提案中的示例：

> 主要好处：如果提案被采纳，为什么平台会更好？
> 
> 像粗鲁的代码
> 
> ```
>  byte[] stuff = { 0x00, 0x7F, (byte)0x80,  (byte)0xFF}; 
> ```
> 
> 可以重新编码为
> 
> ```
>  byte[] ufum7 = { 0x00y, 0x7Fy, 0x80y, 0xFFy }; 
> ```

Joe Darcy 正在监督 Java 7 的 Project Coin，[他的博客](https://blogs.oracle.com/darcy/)是跟踪这些提案的一种简单方法。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-20T20:41:45.833

这些是文字，在 Java 语言规范的[第 3.10 节中进行了描述。](https://docs.oracle.com/javase/specs/jls/se8/html/jls-3.html#jls-3.10)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T08:17:27.750

> 拥有这些似乎很好，因为（我假设）如果您可以指定您输入的数字是一个短数字，那么 java 就不必强制转换它

由于文字的解析发生在编译时，这与性能完全无关。`short`拥有和`byte`后缀会很好的唯一原因是它会导致更紧凑的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-05-13T08:24:37.307

Java有两种数据类型：

1.  原始数据类型
2.  非原始数据类型

某些数据类型需要像 long、float 和 double 这样的规范。

在将上述任何数据类型分配给任何变量时，请始终记住......

*   以双精度数据类型的“d”结束值。
*   在长数据类型中以“L”结束值。
*   以浮点数据类型的“f”结束值。

例子：

长数 = 15000000000L；

浮动 mysecondnum = 5.75f;

双倍我的号码 = 19.99d;

更多信息：

*   long 数据类型的大小为 8 个字节。
*   float 数据类型的大小为 4 个字节。
*   双精度数据类型的大小为 8 个字节。

long 数据类型的精度级别最高为 7-8 位小数，而 float 数据类型最高为 15 位小数。

**编辑：**

与这种类型转换一起，可用于将原始数据类型从一种更改为另一种。

*   加宽铸造（自动）：较小的类型到较大的类型尺寸
*   窄型铸造（手动）：较大型到较小型

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T20:38:37.260

要理解为什么有必要区分`int`和`long`文字，请考虑：

```
long l = -1 >>> 1; 
```

相对

```
int a = -1;
long l = a >>> 1; 
```

现在，正如您所期望的那样，两个代码片段都为 variable 赋予了相同的值`l`。无法区分`int`和`long`字面意思，解释是`-1 >>> 1`什么？

```
-1L >>> 1 // ? 
```

或者

```
(int)-1 >>> 1 // ? 
```

所以即使数字在公共范围内，我们也需要指定类型。如果默认值随着字面量的大小而改变，那么仅仅改变数字就会对表达式的解释产生奇怪的变化。

这不会发生`byte`，`short`并且`char`因为它们总是在执行算术和按位运算之前被提升。可以说它们应该是用于数组初始化表达式的整数类型后缀，但没有。`float`使用后缀`f`and `double` `d`。其他文字有明确的类型，有一个特殊的类型`null`。

# java - 如何从 C 进程中启动 Java？

> ID：769977
> 
> 赞同：1
> 
> 时间：2009-04-20T20:37:10.757
> 
> 标签：java, c, multithreading, clojure, java-native-interface

我想将一些基于 Java（实际上是[Clojure](http://en.wikipedia.org/wiki/Clojure)）的事件处理程序添加到一个巨大的遗留 C 应用程序中。执行此操作的最直接且易于维护的方法是什么？我希望 Java 类与 C 代码在同一进程中运行。这甚至可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T20:40:53.247

[Java Native Interface](http://java.sun.com/javase/6/docs/technotes/guides/jni/index.html)似乎就是为此而设计的。特别是，规范的[这一部分](http://java.sun.com/javase/6/docs/technotes/guides/jni/spec/invocation.html#wp9502)似乎是相关的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T02:04:03.233

顺便说一句，这很容易让它“看起来”正确，但实际上要正确地做起来要困难得多。为什么你希望它们在同一个进程中运行？为什么不是同一个线程？

您可能会考虑通过 TCP/IP 在您的 C 代码和 Java 进程之间建立一座桥梁。这会更好，因为它可以避免维护意外。

你在想“维修惊喜，什么维修惊喜？” 啊! 今天你想从 C 调用 Java，但明天有人会想用另一种方式返回。那就是你的麻烦变得真正痛苦的地方。

我以前来过这里。接受我的建议：做 TCP/IP 桥接。这将防止您的 Java 崩溃。-斯托什

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T20:53:04.760

该`java`命令的源代码可用。它提供了如何在 C 程序中创建 Sun JVM 的一个很好的示例。

[Java 6](http://download.java.net/openjdk/jdk6/) （和即将推出的JDK 7）版本在 OpenJDK 上可用。您可以在两种不同的许可下[下载 Java 5 的源代码](http://java.sun.com/j2se/1.5.0/source_license.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-26T19:09:55.660

你可以这样做，但考虑到你真的想编写一个大型的 C 应用程序，你考虑过 GUILE 还是 Lua？他们都是*为了*这个目的而制造的。

# asp.net-mvc - 遍历 IList

> ID：769978
> 
> 赞同：0
> 
> 时间：2009-04-20T20:37:19.790
> 
> 标签：asp.net-mvc

如何遍历 IList 集合并仅返回 n 条记录？我正在尝试使用 IList 对象实现分页。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T20:40:29.783

使用非常有用的 PagedList：

[http://blog.wekeroad.com/blog/aspnet-mvc-pagedlistt/](http://blog.wekeroad.com/blog/aspnet-mvc-pagedlistt/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T20:39:18.427

```
(From o As Object In myList).Take(n) 
```

Hanselman 在[此处](http://weblogs.asp.net/scottgu/archive/2009/03/10/free-asp-net-mvc-ebook-tutorial.aspx)的 ASP .NET MVC 教程中有一个很好的分页列表类。你应该检查一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:41:24.133

```
foreach (int i in myList.Take(4))
{
            // do some stuff
} 
```

值得注意的是，对于分页，您还需要某种偏移量。为此，您还可以执行以下操作：

> foreach (int i in myList.Skip(40).Take(20)) { }

在 C# 中。

# sql - 如何在 SQL Server 2005 中选择 xml 列的顶级属性？

> ID：769980
> 
> 赞同：23
> 
> 时间：2009-04-20T20:38:04.267
> 
> 标签：sql, sql-server, xml, xpath

我在 SQL Server 2005 中有一个 xml 列，它相当于：

```
<Test foo="bar">
  <Otherstuff baz="belch" />
</Test> 
```

我希望能够将 Test（根元素）的 foo 属性的值作为 varchar 获取。我的目标是：

```
select cast( '<Test foo="bar"><Otherstuff baz="belch" /></Test>' as xml).value('@foo','varchar(20)') as Foo 
```

当我运行上述查询时，我收到以下错误：

> 消息 2390，级别 16，状态 1，行 1 XQuery [value()]：不支持顶级属性节点

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-20T21:05:03.873

约翰桑德斯几乎是对的:-)

```
declare @Data XML
set @Data = '<Test foo="bar"><Otherstuff baz="belch" /></Test>'

select @Data.value('(/Test/@foo)[1]','varchar(20)') as Foo 
```

这对我有用（SQL Server 2005 和 2008）

马克

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-02-21T15:40:11.527

如果您不知道根元素：

```
select @Data.value('(/*/@foo)[1]','varchar(20)') as Foo 
```

# flash - 激活鼠标下方的按钮：如何捕获 OVER 事件？

> ID：769982
> 
> 赞同：1
> 
> 时间：2009-04-20T20:38:42.127
> 
> 标签：flash, actionscript-3

**观察到的行为：**

1.  我有一个 UI 页面滑到屏幕上。
2.  幻灯片完成后，激活按钮。
3.  如果鼠标已经在按钮上，则不会发生翻转（因为从技术上讲，MOUSE_OVER 没有发生）

**期望的行为：** 1、2 相同，但在 3 上，我看到了我的翻转。

除了蛮力之外，有什么方法可以轻松做到这一点，比如跟踪鼠标并将其位置与所有按钮的暗淡进行比较？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T20:42:48.717

您可以使用当前鼠标位置的 x 和 y 坐标将 mouseMove 事件发送到最顶部的容器。这将模拟用户移动鼠标的效果。

```
private function moveComplete():void
{
    topLevelContainer.dispatchEvent(new MouseEvent(MouseEvent.MOUSEMOUSE, true, false, topLevelContainer.mouseX, topLevelContainer.mouseY);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-28T12:54:56.480

当 UI 向下滑动时，您可以更改以下属性，

```
slidingUI.mousenabled = false
slidingUI.mousechildren = false 
```

这将在组件滑动时启用下方按钮上的翻转事件。请务必在之后将属性重置为 true。不确定这是否是您想要的，但它可能会派上用场。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T19:16:29.857

在按钮初始化上，我设置了私有 var _bounds：

```
_bounds = getBounds(this); 
```

在激活时，我调用：

```
if (isMouseOver()) doOver(true); 
```

然后是函数：

```
private function isMouseOver():Boolean {
    //trace ("isMouseOver:");
    var xBool:Boolean = _bounds.left < mouseX && mouseX < _bounds.right;    
    var yBool:Boolean = _bounds.top < mouseY && mouseY < _bounds.bottom;
    //trace (" - xBool: " + xBool);
    //trace (" - yBool: " + yBool);
    return xBool && yBool;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-16T12:35:05.593

您可以为鼠标悬停处理程序设置默认参数，因此您无需创建和调度新事件即可运行相同的代码。

例如

```
myBtn.addEventListener(MouseEvent.MOUSE_OVER, btnOverHandler);

function btnOverHandler(e:MouseEvent = null):void{
trace('do stuff on roll over!');
}

//then you can do this wherever you need
btnOverHandler(); 
```

它应该在两种情况下都有效（MouseEvent，或者不）。

对于鼠标悬停的东西，[getObjectsUnderPoint](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/DisplayObjectContainer.html#getObjectsUnderPoint())可以很方便。它超出了这个特定示例所需的内容（而且有点冗长），但知道它的存在是件好事。

例如

```
function isMouseOver(target:DisplayObject,container:DisplayObjectContainer):Boolean{
   var isOver:Boolean = false;
   var pt:Point = new Point(mouseX, mouseY);
   var objects:Array = container.getObjectsUnderPoint(pt);
   for(var i:int = 0 ; i < objects.length; i++){
      if(objects[i] == target) {
         isOver = true;
         break;
      }
   }
   return isOver;
} 
```

希望这可以帮助。

# .net - 如何从头开始以编程方式配置 log4net（无配置）

> ID：769983
> 
> 赞同：87
> 
> 时间：2009-04-20T20:38:49.520
> 
> 标签：.net, logging, log4net

这是一个坏主意，我知道，但是......我想从头开始以编程方式配置 log4net，没有配置文件。我正在为我和我的团队开发一个简单的日志记录应用程序，用于我们负责的一堆相对较小的部门应用程序。我希望他们都登录到同一个数据库。日志记录应用程序只是 log4net 的包装器，并预先配置了 AdoNetAppender。

所有应用程序都是 ClickOnce 部署的，这在部署配置文件时出现了一个小问题。如果配置文件是核心项目的一部分，我可以将其属性设置为与程序集一起部署。但它是链接应用程序的一部分，因此我无法选择将其与主应用程序一起部署。（如果这不是真的，请有人告诉我）。

可能因为这是一个坏主意，似乎没有太多示例代码可用于从头开始以编程方式配置 log4net。这是我到目前为止所拥有的。

```
Dim apndr As New AdoNetAppender()
apndr.CommandText = "INSERT INTO LOG_ENTRY (LOG_DTM, LOG_LEVEL, LOGGER, MESSAGE, PROGRAM, USER_ID, MACHINE, EXCEPTION) VALUES (@log_date, @log_level, @logger, @message, @program, @user, @machine, @exception)"
apndr.ConnectionString = connectionString
apndr.ConnectionType = "System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
apndr.CommandType = CommandType.Text
Dim logDate As New AdoNetAppenderParameter()
logDate.ParameterName = "@log_date"
logDate.DbType = DbType.DateTime
logDate.Layout = New RawTimeStampLayout()
apndr.AddParameter(logDate)
Dim logLevel As New AdoNetAppenderParameter()
logLevel.ParameterName = "@log_level"
'And so forth... 
```

配置完所有参数后`apndr`，我首先尝试了这个......

```
Dim hier As Hierarchy = DirectCast(LogManager.GetRepository(), Hierarchy)
hier.Root.AddAppender(apndr) 
```

它没有用。然后，作为在黑暗中的镜头，我尝试了这个。

```
BasicConfigurator.Configure(apndr) 
```

那也没有用。有没有人有关于如何在没有配置文件的情况下从头开始以编程方式配置 log4net 的任何好的参考？

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2009-11-21T16:56:02.780

这是一个完全在代码中创建 log4net 配置的示例类。我应该提到，通过静态方法创建记录器通常被认为是不好的，但在我的上下文中，这就是我想要的。无论如何，您可以分割代码以满足您的需求。

```
using log4net;
using log4net.Repository.Hierarchy;
using log4net.Core;
using log4net.Appender;
using log4net.Layout;

namespace dnservices.logging
{
public class Logger
{
    private PatternLayout _layout = new PatternLayout();
    private const string LOG_PATTERN = "%d [%t] %-5p %m%n";

    public string DefaultPattern
    {
        get { return LOG_PATTERN; }
    }

    public Logger()
    {
        _layout.ConversionPattern = DefaultPattern;
        _layout.ActivateOptions();
    }

    public PatternLayout DefaultLayout
    {
        get { return _layout; }
    }

    public void AddAppender(IAppender appender)
    {
        Hierarchy hierarchy = 
            (Hierarchy)LogManager.GetRepository();

        hierarchy.Root.AddAppender(appender);
    }

    static Logger()
    {
        Hierarchy hierarchy = (Hierarchy)LogManager.GetRepository();
        TraceAppender tracer = new TraceAppender();
        PatternLayout patternLayout = new PatternLayout();

        patternLayout.ConversionPattern = LOG_PATTERN;
        patternLayout.ActivateOptions();

        tracer.Layout = patternLayout;
        tracer.ActivateOptions();
        hierarchy.Root.AddAppender(tracer);

        RollingFileAppender roller = new RollingFileAppender();
        roller.Layout = patternLayout;
        roller.AppendToFile = true;
        roller.RollingStyle = RollingFileAppender.RollingMode.Size;
        roller.MaxSizeRollBackups = 4;
        roller.MaximumFileSize = "100KB";
        roller.StaticLogFileName = true;
        roller.File = "dnservices.txt";
        roller.ActivateOptions();
        hierarchy.Root.AddAppender(roller);

        hierarchy.Root.Level = Level.All;
        hierarchy.Configured = true;
    }

    public static ILog Create()
    {
        return LogManager.GetLogger("dnservices");
    }
} 
```

}

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-04-20T20:54:35.163

我过去这样做的一种方法是将配置文件作为嵌入式资源包含在内，并且只使用[log4net.Config.Configure(Stream)](https://logging.apache.org/log4net/release/sdk/html/M_log4net_Config_XmlConfigurator_Configure_7.htm)。

这样，我可以使用我熟悉的配置语法，而不必担心部署文件。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2012-09-26T21:42:20.033

更简洁的解决方案：

```
var layout = new PatternLayout("%-4timestamp [%thread] %-5level %logger %ndc - %message%newline");
var appender = new RollingFileAppender {
    File = "my.log",
    Layout = layout
};
layout.ActivateOptions();
appender.ActivateOptions();
BasicConfigurator.Configure(appender); 
```

不要忘记调用[ActivateOptions](https://logging.apache.org/log4net/release/sdk/html/M_log4net_Appender_RollingFileAppender_ActivateOptions.htm)方法：

> 设置配置属性后，必须在此对象上调用 ActivateOptions 方法。在调用 ActivateOptions 之前，此对象处于未定义状态，不得使用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-20T21:10:47.027

正如[乔纳森](https://stackoverflow.com/questions/769983/how-to-configure-log4net-programmatically-from-scratch-no-config/770046#770046)所说，使用资源是一个很好的解决方案。

这有点限制，因为嵌入的资源内容将在编译时修复。我有一个日志组件，它使用定义为 appSettings 的变量（例如 RollingFileAppender 的文件名、默认日志记录级别、如果您想使用 AdoNetAppender 可能是连接字符串名称）生成具有基本 Log4Net 配置的 XmlDocument。然后我调用`log4net.Config.XmlConfigurator.Configure`使用生成的 XmlDocument 的根元素来配置 Log4Net。

然后管理员可以通过修改一些 appSettings（通常是级别、文件名等）来自定义“标准”配置，或者可以指定外部配置文件以获得更多控制权。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-03T23:04:48.707

我无法在问题的代码片段中判断“'等等......”是否包含非常重要的 apndr.ActivateOptions() ，这在 Todd Stout 的回答中有所说明。如果没有 ActivateOptions()，Appender 将处于非活动状态，并且不会做任何可以解释它为什么失败的事情。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-04-10T13:34:19.143

派对有点晚了。但这是一个对我有用的最小配置。

示例类

```
public class Bar
{
    private readonly ILog log = LogManager.GetLogger(typeof(Bar));
    public void DoBar() { log.Info("Logged"); }
} 
```

最小的 log4net 跟踪配置（在 NUnit 测试中）

```
[Test]
public void Foo()
{
    var tracer = new TraceAppender();
    var hierarchy = (Hierarchy)LogManager.GetRepository();
    hierarchy.Root.AddAppender(tracer);
    var patternLayout = new PatternLayout {ConversionPattern = "%m%n"};
    tracer.Layout = patternLayout;
    hierarchy.Configured = true;

    var bar = new Bar();
    bar.DoBar();
} 
```

打印到跟踪侦听器

```
Namespace+Bar: Logged 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-11-17T12:41:29.470

[Netjes 博士](http://weblogs.asp.net/drnetjes/archive/2005/02/16/374780.aspx)有这个以编程方式设置连接字符串：

```
// Get the Hierarchy object that organizes the loggers
log4net.Repository.Hierarchy.Hierarchy hier = 
  log4net.LogManager.GetLoggerRepository() as log4net.Repository.Hierarchy.Hierarchy;

if (hier != null)
{
  //get ADONetAppender
  log4net.Appender.ADONetAppender adoAppender = 
    (log4net.Appender.ADONetAppender)hier.GetLogger("MyProject",
      hier.LoggerFactory).GetAppender("ADONetAppender");
  if (adoAppender != null)
  {
    adoAppender.ConnectionString =
      System.Configuration.ConfigurationSettings.AppSettings["MyConnectionString"];
    adoAppender.ActivateOptions(); //refresh settings of appender
  }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-12T17:54:17.110

// 我已经嵌入了三个配置文件作为嵌入式资源并像这样访问它们：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Resources;
using System.IO;

namespace Loader
{
  class Program
  {
    private static log4net.ILog CustomerLog = log4net.LogManager.GetLogger("CustomerLogging");
    private static log4net.ILog OrderLog = log4net.LogManager.GetLogger("OrderLogging");
    private static log4net.ILog DetailsLog = log4net.LogManager.GetLogger("OrderDetailLogging");

    static void Main(string[] args)
    {
      // array of embedded log4net config files
      string[] configs = { "Customer.config", "Order.config", "Detail.config"};

      foreach (var config in configs)
      {
        // build path to assembly config
        StringBuilder sb = new StringBuilder();
        sb.Append(System.Reflection.Assembly.GetExecutingAssembly().GetName().Name);
        sb.Append(".");
        sb.Append(config);

        // convert to a stream
        Stream configStream = System.Reflection.Assembly.GetExecutingAssembly().GetManifestResourceStream(sb.ToString());

        // configure logger with ocnfig stream
        log4net.Config.XmlConfigurator.Configure(configStream);

        // test logging
        CustomerLog.Info("Begin logging with: " + config);
        OrderLog.Info("Begin logging with: " + config);
        DetailsLog.Info("Begin logging with: " + config);
        for (int iX = 0; iX < 10; iX++)
        {
          CustomerLog.Info("iX=" + iX);
          OrderLog.Info("iX=" + iX);
          DetailsLog.Info("iX=" + iX);
        }
        CustomerLog.Info("Ending logging with: " + config);
        OrderLog.Info("Ending logging with: " + config);
        DetailsLog.Info("Ending logging with: " + config);
      }

    }
  }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-24T13:37:28.093

奇怪的是`BasicConfigurator.Configure(apndr)`没有工作。在我的情况下，它完成了它的工作......但是，无论如何，答案是 - 你应该在`hier.Configured = true;`完成所有设置后编写（c＃代码）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-10-27T14:43:45.187

我最终使用了这个：

[http://www.mikebevers.be/blog/2010/09/log4net-custom-adonetappender/](http://www.mikebevers.be/blog/2010/09/log4net-custom-adonetappender/)

经过 4 小时摆弄配置并逐渐变得更加沮丧。

希望它可以帮助某人。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-22T10:15:00.803

这是一个简单明了的示例，说明如何在完全没有任何文件（甚至 for ）`AdoNetAdapter`的情况下创建和使用完全在代码中的代码。来吧，删除它！`App.config``Common.Logging`

[这具有在新命名约定](https://github.com/net-commons/common-logging/wiki/Common.Logging-Packaging-and-Versions)下对更新具有弹性的额外好处，其中程序集名称现在反映了版本。(`Common.Logging.Log4Net1213`等)

[SQL]

```
CREATE TABLE [Log](
  [Id] [int] IDENTITY(1,1) NOT NULL,
  [Date] [datetime] NOT NULL,
  [Thread] [varchar](255) NOT NULL,
  [Level] [varchar](20) NOT NULL,
  [Source] [varchar](255) NOT NULL,
  [Message] [varchar](max) NOT NULL,
  [Exception] [varchar](max) NOT NULL
) 
```

[主要的]

```
Imports log4net
Imports log4net.Core
Imports log4net.Layout
Imports log4net.Config
Imports log4net.Appender

Module Main
  Sub Main()
    Dim oLogger As ILog
    Dim sInput As String
    Dim iOops As Integer

    BasicConfigurator.Configure(New DbAppender)
    oLogger = LogManager.GetLogger(GetType(Main))

    Console.Write("Command: ")

    Do
      Try
        sInput = Console.ReadLine.Trim

        Select Case sInput.ToUpper
          Case "QUIT" : Exit Do
          Case "OOPS" : iOops = String.Empty
          Case Else : oLogger.Info(sInput)
        End Select

      Catch ex As Exception
        oLogger.Error(ex.Message, ex)

      End Try

      Console.Clear()
      Console.Write("Command: ")
    Loop
  End Sub
End Module 
```

[数据库应用程序]

```
Imports log4net
Imports log4net.Core
Imports log4net.Layout
Imports log4net.Appender
Imports log4net.Repository.Hierarchy

Public Class DbAppender
  Inherits AdoNetAppender

  Public Sub New()
    MyBase.BufferSize = 1
    MyBase.CommandText = Me.CommandText

    Me.Parameters.ForEach(Sub(Parameter As DbParameter)
                            MyBase.AddParameter(Parameter)
                          End Sub)

    Me.ActivateOptions()
  End Sub

  Protected Overrides Function CreateConnection(ConnectionType As Type, ConnectionString As String) As IDbConnection
    Return MyBase.CreateConnection(GetType(System.Data.SqlClient.SqlConnection), "Data Source=(local);Initial Catalog=Logger;Persist Security Info=True;User ID=username;Password=password")
  End Function

  Private Overloads ReadOnly Property CommandText As String
    Get
      Dim _
        sColumns,
        sValues As String

      sColumns = Join(Me.Parameters.Select(Function(P As DbParameter) P.DbColumn).ToArray, ",")
      sValues = Join(Me.Parameters.Select(Function(P As DbParameter) P.ParameterName).ToArray, ",")

      Return String.Format(COMMAND_TEXT, sColumns, sValues)
    End Get
  End Property

  Private ReadOnly Property Parameters As List(Of DbParameter)
    Get
      Parameters = New List(Of DbParameter)
      Parameters.Add(Me.LogDate)
      Parameters.Add(Me.Thread)
      Parameters.Add(Me.Level)
      Parameters.Add(Me.Source)
      Parameters.Add(Me.Message)
      Parameters.Add(Me.Exception)
    End Get
  End Property

  Private ReadOnly Property LogDate As DbParameter
    Get
      Return New DbParameter("Date", DbType.Date, 0, New DbPatternLayout("%date{yyyy-MM-dd HH:mm:ss.fff}"))
    End Get
  End Property

  Private ReadOnly Property Thread As DbParameter
    Get
      Return New DbParameter("Thread", DbType.String, 255, New DbPatternLayout("%thread"))
    End Get
  End Property

  Private ReadOnly Property Level As DbParameter
    Get
      Return New DbParameter("Level", DbType.String, 50, New DbPatternLayout("%level"))
    End Get
  End Property

  Private ReadOnly Property Source As DbParameter
    Get
      Return New DbParameter("Source", DbType.String, 255, New DbPatternLayout("%logger.%M()"))
    End Get
  End Property

  Private ReadOnly Property Message As DbParameter
    Get
      Return New DbParameter("Message", DbType.String, 4000, New DbPatternLayout("%message"))
    End Get
  End Property

  Private ReadOnly Property Exception As DbParameter
    Get
      Return New DbParameter("Exception", DbType.String, 2000, New DbExceptionLayout)
    End Get
  End Property

  Private Const COMMAND_TEXT As String = "INSERT INTO Log ({0}) VALUES ({1})"
End Class 
```

[数据库参数]

```
Imports log4net
Imports log4net.Core
Imports log4net.Layout
Imports log4net.Appender
Imports log4net.Repository.Hierarchy

Public Class DbParameter
  Inherits AdoNetAppenderParameter

  Private ReadOnly Name As String

  Public Sub New(Name As String, Type As DbType, Size As Integer, Layout As ILayout)
    With New RawLayoutConverter
      Me.Layout = .ConvertFrom(Layout)
    End With

    Me.Name = Name.Replace("@", String.Empty)
    Me.ParameterName = String.Format("@{0}", Me.Name)
    Me.DbType = Type
    Me.Size = Size
  End Sub

  Public ReadOnly Property DbColumn As String
    Get
      Return String.Format("[{0}]", Me.Name)
    End Get
  End Property
End Class 
```

[DbPattern 布局]

```
Imports log4net
Imports log4net.Core
Imports log4net.Layout
Imports log4net.Appender
Imports log4net.Repository.Hierarchy

Public Class DbPatternLayout
  Inherits PatternLayout

  Public Sub New(Pattern As String)
    Me.ConversionPattern = Pattern
    Me.ActivateOptions()
  End Sub
End Class 
```

[数据库异常布局]

```
Imports log4net
Imports log4net.Core
Imports log4net.Layout
Imports log4net.Appender
Imports log4net.Repository.Hierarchy

Public Class DbExceptionLayout
  Inherits ExceptionLayout

  Public Sub New()
    Me.ActivateOptions()
  End Sub
End Class 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-09-14T08:03:13.430

'Vb.Net 的解决方案

```
Private Shared EscanerLog As log4net.ILog = log4net.LogManager.GetLogger("Log4Net.Config")

Public Sub New(ByVal sIDSesion As String)
    Dim sStream As Stream
    Dim JsText As String
    Using reader As New StreamReader((GetType(ClsGestorLogsTraza).Assembly).GetManifestResourceStream("Comun.Log4Net.Config"))
        JsText = reader.ReadToEnd()
        sStream = GenerateStreamFromString(JsText)
        log4net.Config.XmlConfigurator.Configure(sStream)
    End Using
End Sub

Public Function GenerateStreamFromString(ByVal s As String) As Stream
    Dim stream = New MemoryStream()
    Dim writer = New StreamWriter(stream)
    writer.Write(s)
    writer.Flush()
    stream.Position = 0
    Return stream
End Function

Public Function StreamFromResource(ByVal sFilename As String) As Stream
    Dim nAssembly As System.Reflection.Assembly = System.Reflection.Assembly.GetExecutingAssembly()
    Dim s As Stream = nAssembly.GetManifestResourceStream(System.Reflection.MethodBase.GetCurrentMethod.DeclaringType, sFilename)
    Return s
End Function 
```

# git - 我可以强制 git diff 将文件视为副本吗？

> ID：769994
> 
> 赞同：9
> 
> 时间：2009-04-20T20:40:44.103
> 
> 标签：git, version-control, diff

git 中的 diff 功能具有“复制检测”——如果它检测到新文件实际上是现有文件的（可能已修改）副本，则 diff 输出显示源文件和新文件之间的差异，而不仅仅是一个一堆从空白文件添加到新文件的内容。

据我所知，`git diff`使用一些启发式方法来检测这种情况。不幸的是，它没有将特定的新文件检测为另一个文件的副本，因为我猜它已经改变了太多。我仍然想查看差异，就好像它是副本一样。有没有办法通知`git diff`新文件是另一个文件的副本，以便它会为我执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T20:50:01.927

`git diff`（至少我的版本 1.5.6 是这样）带有 switch `--find-copies-harder`，它比常规执行更多的 cpu 密集型复制检测`-C`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-03T10:24:43.037

Have you tried to put **both** files in the diff?

something like

```
git diff --stat -p --find-copies-harder -- src/OldFile.java src/main/NewFile.java 
```

I imagine you did, just in case...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T21:17:56.167

只是想确保它已添加到 git repo 中。

另外，如果您知道原始文件，为什么不直接使用 diff 呢？

# c# - 调试 DLL 的发布版本（使用 PDB 文件）

> ID：769995
> 
> 赞同：23
> 
> 时间：2009-04-20T20:40:45.243
> 
> 标签：c#, visual-studio-2008, debugging, pdb-files

如果我有一个 DLL（在发布模式下构建）和相应的 PDB 文件，是否可以调试（单步执行）该 DLL 中包含的类/方法？

如果是这样，需要哪些步骤/配置（例如，将 PDB 文件放在哪里）？

**编辑：**

如果 PDB 文件与 DLL 位于同一位置（在简单控制台测试应用程序的 bin/debug 目录中）。我可以看到 DLL 的符号已加载（在“输出”窗口和“模块”窗口中），但我仍然无法进入该 DLL 的方法。

这可能是编译器优化的结果（正如迈克尔在他的回答中所描述的那样）？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-20T20:45:29.210

如果 pdb 位于 dll 旁边（例如智能感知 xml 文件），通常（至少对我而言）会检测到 pdb。

或者; 模块加载后你需要一个断点......

在断点处，调出“模块”窗口（Ctrl+D,M - 或 Debug->Windows->Modules）。右键单击您的 dll “从以下位置加载符号”、“符号路径”等。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T20:46:06.523

是的，您可以使用 PDB 调试发布代码。然而，调试优化代码存在一些陷阱，更多信息[在这里](https://stackoverflow.com/questions/563000/can-optimizations-affect-the-ability-to-debug-a-vc-app-using-its-pdb/567886)和[这里](https://stackoverflow.com/questions/763920/ms-compiler-optimization-that-replaces-variables-in-a-function/763923)。

您的 PDB 只需要位于调试器可以找到它的位置 - 对于本地调试与 dll 相同的目录通常是最简单的。否则，将它放在调试器可以找到它的某个地方，并将调试器指向带有符号路径的那个地方。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-22T12:42:38.620

我终于找到了调试在发布配置中构建的 DLL 出现问题的原因：

首先，它基本上按预期工作。这意味着，如果我有一个在发布配置中构建的 DLL 以及相应的 PDB 文件，那么我可以调试该 DLL 中包含的类/方法。

当我第一次尝试这个时，不幸的是我试图进入一个具有**DebuggerStepThroughAttribute**的类的方法，例如：

```
[System.Diagnostics.DebuggerStepThrough]
public class MyClass {
    public void Test() { ... }
} 
```

在这种情况下，当然不可能从调试器进入方法（如预期/预期的那样）。

所以一切都按预期工作。非常感谢你的回答。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-21T01:28:58.233

调试发布版本通常比调试调试版本更难。一般来说，您需要对 x86 汇编器有所了解，并且您可能会花一些时间查看反汇编窗口。这往往是确定您真正使用哪一行代码的唯一方法，因为在对编译器进行优化的发布版本中，可能会进行重要的内联和指令重新排序。此外，我发现调试器经常无法正确报告变量的值。如果您需要知道一个变量的值并且您不确定调试器是否正确，请进入反汇编窗口并找到它所在的内存位置或寄存器。

pdb 文件可以存储在符号服务器中。查看[设置符号服务器](http://entland.homelinux.com/blog/2006/07/06/setting-up-a-symbol-server/)以获得很好的教程。我们在构建机器上构建的每个产品都会将符号发布到我们的符号服务器，因此我们始终可以调试从 WinQual 收到的任何故障转储。**************