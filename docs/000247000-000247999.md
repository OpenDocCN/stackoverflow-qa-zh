# StackOverflow 问答 000247000-000247999

# linq - 如何在 T4 模板中使用 Linq？

> ID：247005
> 
> 赞同：69
> 
> 时间：2008-10-29T14:28:10.070
> 
> 标签：linq, t4

我正在使用 T4 为项目生成一些屏幕和中间层代码，并希望使用 Linq 来简化我的一些模板代码。但是，当我尝试使用 Linq 时，模板会报告语法错误。

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-10-29T14:29:21.100

默认情况下，在 Visual Studio 2008 中（以及在大多数在线示例中使用的）模板是使用不包括 Linq 的 2.0 框架编译的。（参见[MSDN 论坛主题](http://social.msdn.microsoft.com/Forums/en-US/vsx/thread/cf66fd91-0b04-49a2-9116-a3e4eaa9b41a/)）

要解决这个问题，需要三个步骤：

1.  在模板的语言属性中，指定“C#v3.5”或“VBv3.5” - 对于始终使用 .Net 4.0 的 VS2010，此步骤不是必需的。
2.  为 System.Core.dll 添加汇编指令
3.  导入 System.Linq 命名空间

您的模板现在看起来像这样：

```
<#@ template language="C#v3.5" #>
<#@ assembly name="System.Core" #>
<#@ import namespace="System.Linq" #> 
```

您现在可以在模板中使用 Linq 和其他新的语言功能。

# php - 保存远程网页的 cookie

> ID：247006
> 
> 赞同：9
> 
> 时间：2008-10-29T14:28:25.330
> 
> 标签：php, curl, cookies

我有一个 PHP 应用程序需要从另一个网页中获取内容，而我正在阅读的网页需要一个 cookie。

我找到了有关如何在获得 cookie ( [http://groups.google.com/group/comp.lang.php/msg/4f618114ab15ae2a](http://groups.google.com/group/comp.lang.php/msg/4f618114ab15ae2a) ) 后进行此调用的信息，但是我不知道如何生成cookie，或保存 cookie 的方式/位置。

例如，要通过 wget 阅读此网页，我执行以下操作：

```
wget --quiet --save-cookies cookie.file --output-document=who.cares \ 
  http://remoteServer/login.php?user=xxx&pass=yyy

wget --quiet --load-cookies cookie.file --output-document=documentiwant.html \
  http://remoteServer/pageicareabout.html 
```

...我的问题是如何在 PHP 中执行“--save-cookies”位，以便可以在后续 PHP stream_context_create / file_get_contents 块中使用 cookie：

```
$opts = array(http'=> array(
  'method'=> "GET",
  'header'=>
    "Accept-language: en\r\n" .
    "Cookie: **NoClueAtAll**\r\n"
  )
);

$context = stream_context_create($opts);
$documentiwant = file_get_contents("http://remoteServer/pageicareabout.html",
  0, $context); 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-29T16:27:40.097

**Shazam** - 奏效了！太感谢了！万一其他人偶然发现了这个页面，这里需要详细说明：

1.  安装 cURL（对我来说就像 ubuntu 中的 'sudo apt-get install php5-curl' 一样简单）
2.  将之前列出的 PHP 更改为以下内容：

    ```
    <?php

    $cr = curl_init('http://remoteServer/login.php?user=xxx&pass=yyy');
    curl_setopt($cr, CURLOPT_RETURNTRANSFER, true); 
    curl_setopt($cr, CURLOPT_COOKIEJAR, 'cookie.txt');   
    $whoCares = curl_exec($cr); 
    curl_close($cr); 

    $cr = curl_init('http://remoteServer/pageicareabout.html');
    curl_setopt($cr, CURLOPT_RETURNTRANSFER, true); 
    curl_setopt($cr, CURLOPT_COOKIEFILE, 'cookie.txt'); 
    $documentiwant = curl_exec($cr);
    curl_close($cr);

    ?> 
    ```

以上代码片段深受[http://www.weberdev.com/get_example-4555.html](http://www.weberdev.com/get_example-4555.html)的影响。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T14:47:42.607

[使用cURL](http://www.php.net/curl)可能会更好。使用[curl_setopt](http://www.php.net/manual/en/function.curl-setopt.php)设置 cookie 处理选项。

如果这只是一次性的事情，您可以使用带有[Live HTTP](http://livehttpheaders.mozdev.org/)标头的 Firefox来获取标头，然后将其粘贴到您的 PHP 代码中。

# javascript - 在jQuery中获取列表元素内容的数组

> ID：247023
> 
> 赞同：105
> 
> 时间：2008-10-29T14:32:53.790
> 
> 标签：javascript, jquery

我有这样的结构：

```
<ul>
  <li>text1</li>
  <li>text2</li>
  <li>text3</li>
</ul> 
```

如何使用 javascript 或 jQuery 将文本作为数组获取？

```
['text1', 'text2', 'text3'] 
```

在此之后我的计划是将它组装成一个字符串，可能使用`.join(', ')`，并以如下格式获取它：

```
'"text1", "text2", "text3"' 
```

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-10-29T14:43:11.040

```
var optionTexts = [];
$("ul li").each(function() { optionTexts.push($(this).text()) }); 
```

......应该做的伎俩。要获得您正在寻找的最终输出，`join()`加上一些连接会很好：

```
var quotedCSV = '"' + optionTexts.join('", "') + '"'; 
```

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2011-03-04T15:56:23.890

没有多余的中间数组：

```
var arr = $('li').map(function(i,el) {
    return $(el).text();
}).get(); 
```

见 jsfiddle[演示](http://jsfiddle.net/cC8fT/)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-29T15:16:59.100

在干净的javascript中：

```
var texts = [], lis = document.getElementsByTagName("li");
for(var i=0, im=lis.length; im>i; i++)
  texts.push(lis[i].firstChild.nodeValue);

alert(texts); 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-09-22T16:32:12.113

kimstik 很接近，但不完全。

以下是如何在一个方便的单行中做到这一点：

```
$.map( $('li'), function (element) { return $(element).text() }); 
```

这是 jQuery 的 map 函数的完整文档，非常方便：[http ://api.jquery.com/jQuery.map/](http://api.jquery.com/jQuery.map/)

只是为了完全回答，这是您正在寻找的完整功能：

```
$.map( $('li'), function (element) { return $(element).text() }).join(', '); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-29T14:45:06.310

```
var arr = new Array();

$('li').each(function() { 
  arr.push(this.innerHTML); 
}) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-02-20T18:36:37.460

您可以执行以下操作。一行代码就足够了

*   `let array = $('ul>li').toArray().map(item => $(item).html());`
*   获取感兴趣的元素

    1.  得到孩子

    2.  从 toArray() 方法获取数组

    3.  过滤出你想要的结果

```
let array = $('ul>li').toArray().map(item => $(item).html());
console.log(array);
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<ul>
  <li>text1</li>
  <li>text2</li>
  <li>text3</li>
</ul>
```

# unit-testing - 使用类的主要方法进行调试？

> ID：247025
> 
> 赞同：5
> 
> 时间：2008-10-29T14:33:04.977
> 
> 标签：unit-testing, language-agnostic, testing, main-method

使用 main 方法测试 java/.net 类是一种好习惯吗？

我在一些教科书中看到了它的推荐，但对我来说，使用单元测试框架似乎更有意义......

main 方法为您提供了一个类入口点，您可以测试类功能的一个方面。我猜你可能会测试很多，但它似乎不像使用 Junit 或 Nunit 那样有意义。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T14:37:46.900

一个明显的优势似乎是您可以对课程进行白盒测试。也就是说，您可以测试它的内部结构（例如私有方法）。你不能用单元测试来做到这一点，你也不想那样做，它们主要是从用户的角度测试界面和行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T14:45:10.507

我认为开发从测试集成测试套件的主要方法（例如测试运行程序）调用的集成测试可能很有用。我不会以这种方式进行单元测试，因为单元测试框架提供了更好的机制来做到这一点。

[编辑]为了澄清，我并不是建议每个类都有用于集成测试的静态 main 方法，而是您可以编写一个带有静态 main 方法的集成测试程序，该方法将运行您的集成测试套件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T14:38:07.757

main 方法在某些情况下可能很有用，但是使用调试器然后编写单元测试（以提供一些防止回归的保险）是一种更强大的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T20:40:16.733

在 Java 中，可以接受有多个主要方法并将它们用于测试，但是 .NET 不允许这样做，如果您在同一个程序中有两个主要方法，您将收到[编译器错误 CS0017](http://msdn.microsoft.com/en-us/library/t9k01y87.aspx)，并告诉您`Compile with /main to specify the type that contains the entry point.`

我不得不说 Java 方式对我来说更有意义。

# asp.net - 当主要内容需要时，如何在母版页上获取“页脚”内容以向下推？

> ID：247045
> 
> 赞同：1
> 
> 时间：2008-10-29T14:37:53.313
> 
> 标签：asp.net, html, css

自从我处理 ASP.NET 以来已经有一段时间了，这是我第一次不得不处理母版页。一直在关注教程一切都很好，除了我遇到的页脚问题。

母版页包含 topContent、mainContent 和 footerContent 的 div。在 mainContent 我有一个 ContentPlaceHolder。

默认内容页面（只是在这里获得一些概念验证）在其中有一些标签和文本框，在内容区域中有一个多行文本框。“Content1”正确链接回母版页上的 ContentPlaceHolder1。

当我运行该网站时，内容会出现，但页脚部分并没有被现在填充的 ContentPlaceHolder “下推” - 它几乎就像背景图片一样。

我在这里缺少什么属性？我尝试使用CSS将footerContent强制到底部，但这只是将fotter内容放在浏览器的底部，当我将多行文本框扩展到大于浏览器的窗口高度时，同样的事情发生了（内容覆盖页脚）

我知道这必须是我想念的简单的东西。

母版页的基本内容如下：

```
<form id="form1" runat="server">
  <div id="topContent">
     <table style="width: 832px">
     </table>
  </div>

  <div id="mainContent">
     <asp:ContentPlaceHolder id="ContentPlaceHolder1" runat="server">
     </asp:ContentPlaceHolder>
  </div>

  <div id="footerContent">
     <br/><br/>
     <center style="font-size: small; font-style: italic; font-family: Arial">
         <a target="_new" href="/Disclaimer.html">Security and Privacy Notice</a><br/>
         ...
     </center>
  </div>  
</form> 
```

帮助！

编辑：原来 VS2005 将“位置：绝对”标签放在我放在 content.aspx 页面上的所有组件（标签和文本框）上。进入 asp 标签并将它们更改为“位置：相对”就可以了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T14:46:34.543

这听起来不像是母版页问题，这听起来像是 HTML/CSS 布局问题。您没有说明的是您的 DIV 是绝对定位还是出现在页面流中。

通常，假设您没有绝对定位这些 DIV，则标题 DIV 将静态调整大小，页脚将静态调整大小，但应允许内容 DIV 垂直拉伸以适应内容。这反过来将您的页脚 DIV 推到最后一行内容的下方，这就是您想要的。但为了实现这一点，我们通常会省略“position: absolute;”。从页脚 DIV。它需要流动。

您的问题基本上是在问，“我有 3 个 DIV，一个在另一个之上。它们没有适当地向下推对方。”

答案几乎总是一个流氓“立场：绝对；” 标签，保证金问题，或者您使用的“页面容器 DIV”未正确设置为在其内部 DIV 扩展时扩展。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T14:50:38.403

这更像是 HTML + CSS 问题，而不是 asp.net 母版页问题。
这是我将代码更改为：

```
 <div id="mainContent"style="position:relative;">
       <asp:ContentPlaceHolder id="ContentPlaceHolder1" runat="server">
       </asp:ContentPlaceHolder>
   </div>
<br style="clear:both;" />
 <div id="footerContent" style="position:relative;">
     <br/><br/>
     <center style="font-size: small; font-style: italic; font-family: Arial">
         <a target="_new" href="/Disclaimer.html">Security and Privacy Notice</a><br/>
         ...
     </center>
 </div> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T15:25:10.330

清除 maincontent 和 footercontent 之间的 div 会有所帮助，但需要注意的其他事项，尤其是在 IE6 等不能很好清除或浮动的糟糕浏览器中，是高度和溢出。您可能不是，但如果您隐藏溢出并设置高度，则会截断任何超过高度的内容。有什么要检查的。

通常，设置 float: left; 在您的所有主要 div 元素上将有助于与清除 div 结合使用。

此外，正如其他响应者所指出的那样，“将页脚内容放在底部”意味着它是绝对定位的。只要 footercontent 跟在 clearing div 之后，它就应该设置在内容的底部，而不是页面的底部。

我注意到您也在使用中心标签。那和 div align=center 不再是标准的，也可能会惹恼你。使用边距：0px 自动；和文本对齐：居中；反而。

我建议你一般做三件事：

*   在至少三个浏览器中打开您的应用程序，其中至少一个应该是安装了 Firebug 的 Firefox。启动应用程序时，将默认浏览器中的 URL 粘贴到您正在使用的其他浏览器中。确定您遇到问题的地方。
*   在 positioniseverything.net 上阅读，看看那里列出的任何问题是否与您的问题相似。Bergevins 做得很好，会让你直截了当。特别是如果 IE6/7 是一个问题。
*   使用 clear:both 和 height: 0 创建一个可以重复使用的清晰类。如果你必须调整它，它比触摸每个内联样式更容易。

祝你好运。无论如何，您可以编辑您的问题以便我们也可以看到样式吗？

# java - 如何将输出发送到 Java 中的外部/第二个显示器？

> ID：247051
> 
> 赞同：2
> 
> 时间：2008-10-29T14:39:01.533
> 
> 标签：java, ms-office

我希望能够在 MS Office 中模拟“演示者工具”的功能。这要求程序能够检测和使用外部/辅助监视器/投影仪。

有人可以为我指出实现这一目标的正确方向。

我想使用 Java 1.5

谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T17:28:41.063

通过[GraphicsEnvironment](http://java.sun.com/javase/6/docs/api/java/awt/GraphicsEnvironment.html)类，您可以获得有关计算机上可用屏幕的信息。在[GraphicsDevice](http://java.sun.com/javase/6/docs/api/java/awt/GraphicsDevice.html)的文档中，有一个基本示例展示了如何获取和使用屏幕信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T22:22:17.617

这实际上取决于您计划的 GUI API。

对于 AWT，请参阅 John Meagher 的帖子。

对于 SWT，您可以查看 Display.getMonitors() 作为起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T16:26:26.400

我不知道，因为我只有一个屏幕......但我知道[Most Pixels Ever](http://code.google.com/p/mostpixelsever/ "有史以来最多的像素")库：它是一个用于[处理](http://processing.org/ "覆盖")的 Java 库，但我想它使用标准 Java 东西来做到这一点，处理部分仅用于简单的界面。

# asp.net - 从浏览器获取 javascript 版本！=asp.net 中的 IE

> ID：247052
> 
> 赞同：0
> 
> 时间：2008-10-29T14:40:01.780
> 
> 标签：asp.net, asp.net-mvc

在我当前的日志记录类中，我记录了浏览器、浏览器版本和 javascript 版本。我通过的 Javascript 版本

```
HttpContext.Request.Browser.JScriptVersion 
```

这适用于 IE，但不适用于任何其他浏览器。是否有另一种方法（不是基于 javascript）来检测已安装的 javascript 版本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T14:41:50.217

没有通过 HTTP 传输 javascript 版本的标准，因此除非浏览器巧合地符合 IE 的 User-Agent 标头格式，否则您将无法获取该信息

# macos - 在 Mac OS X Intel 上启用浮点中断

> ID：247053
> 
> 赞同：19
> 
> 时间：2008-10-29T14:41:33.570
> 
> 标签：macos, intel, interrupt, floating-point-exceptions

在 Linux 上，feenableexcept 和 fedisableexcept 可用于控制浮点异常时 SIGFPE 中断的生成。如何在 Mac OS X Intel 上执行此操作？

[http://developer.apple.com/documentation/Performance/Conceptual/Mac_OSX_Numerics/Mac_OSX_Numerics.pdf](http://developer.apple.com/documentation/Performance/Conceptual/Mac_OSX_Numerics/Mac_OSX_Numerics.pdf) , pp. 7-15中提供了用于启用浮点中断的内联汇编，但仅适用于 PowerPC 汇编。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-04T14:06:35.710

可以使用`_MM_SET_EXCEPTION_MASK`from启用 sse 的例外`xmmintrin.h`。例如，要启用无效 (nan) 异常，请执行

```
#include <xmmintrin.h>
...
_MM_SET_EXCEPTION_MASK(_MM_GET_EXCEPTION_MASK() & ~_MM_MASK_INVALID); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-31T04:23:30.837

在 Mac OS X 上，这有点复杂。默认情况下，OS X 对所有 FP 数学使用 SSE 单元，而不是 x87 FP 单元。SSE 单元不支持中断选项，这意味着除了启用中断之外，您还需要确保编译所有代码以不使用 SSE 数学。

您可以通过将“-mno-sse -mno-sse2 -mno-sse3”添加到您的 CFLAGS 来禁用数学。一旦你这样做了，你就可以使用一些内联汇编来配置你的 FP 异常，其标志与 Linux 基本相同。

```
short fpflags = 0x1332 // Default FP flags, change this however you want. 
asm("fnclex");
asm("fldcw _fpflags"); 
```

您可能会发现一个问题是，由于 OS X 完全使用 sse 构建，因此可能存在未捕获的错误。我知道信号处理程序没有传回正确的代码曾经有一个大问题，但那是几年前的事了，希望现在已经修复了。

# java - Java 中是否有像 C# 中的 Environment.Newline 一样定义的换行符常量？

> ID：247059
> 
> 赞同：213
> 
> 时间：2008-10-29T14:43:35.437
> 
> 标签：java

在 C# 中，静态属性[Environment.Newline](http://msdn.microsoft.com/en-us/library/system.environment.newline.aspx)会根据运行的平台而变化。

Java中有类似的东西吗？

* * *

## 回答 #1

> 赞同：308
> 
> 时间：2008-10-29T14:45:32.237

**从 Java 7（和 Android API 级别 19）开始：**

```
System.lineSeparator() 
```

文档：[Java 平台 SE 7](https://docs.oracle.com/javase/7/docs/api/java/lang/System.html#lineSeparator%28%29)

* * *

**对于旧版本的 Java，请使用：**

```
System.getProperty("line.separator"); 
```

有关其他属性，请参阅[https://java.sun.com/docs/books/tutorial/essential/environment/sysprop.html](https://java.sun.com/docs/books/tutorial/essential/environment/sysprop.html)。

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2015-05-13T14:25:08.723

从 Java 7 开始：

```
System.lineSeparator() 
```

> [**Java API：System.lineSeparator**](http://docs.oracle.com/javase/7/docs/api/java/lang/System.html#lineSeparator%28%29)
> 
> 返回系统相关的行分隔符字符串。它总是返回相同的值——系统属性 line.separator 的初始值。在 UNIX 系统上，它返回 "\n"；在 Microsoft Windows 系统上，它返回“\r\n”。

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2008-10-29T17:01:48.157

请注意，此属性并不像许多人认为的那样有用。例如，仅仅因为您的应用程序在 Windows 机器上运行并不意味着它正在读取的文件将使用 Windows 样式的行分隔符。许多网页包含“\n”和“\r\n”的混合体，它们是从不同的来源拼凑而成的。当您将文本作为一系列逻辑行阅读时，您应该始终查找所有三种主要的行分隔符样式：Windows ("\r\n")、Unix/Linux/OSX ("\n") 和OSX 之前的 Mac ("\r")。

当您*编写*文本时，您应该更关心文件的使用方式，而不是您运行的平台。例如，如果您希望人们在 Windows 记事本中阅读文件，则应使用“\r\n”，因为它只识别一种分隔符。

# java - 你需要用 Eclipse 在 Java 中进行单元测试吗？

> ID：247064
> 
> 赞同：4
> 
> 时间：2008-10-29T14:44:35.000
> 
> 标签：java, eclipse, unit-testing, junit

我最近从 .Net 世界进入 Java 世界，我想念我的单元测试。

使用 Visual Studio，我使用 NUnit 和 TestDriven.net 来运行我的单元测试。

什么是 Java Using Eclipse 的可比系统？

我正在寻找可以让我继续前进的插件，或者是如何做到这一点的指南。

我知道 JUnit 是 NUnit 最初的基础，但我想知道将它集成到 Eclipse 中的最佳方法，因为似乎有一些插件可以做到这一点，我没有时间玩商场。

**更新**

好吧，我不知道 JUnit 是内置在 IDE 中的。是否有任何插件可以让使用 JUnit 变得更容易？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T14:49:47.330

将 JUnit 与 eclipse 一起使用实际上非常容易。只需转到 File->New... 并选择 JUnit Test Case。Eclipse 将处理添加 JUnit 库和所有导入。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T14:48:52.247

您使用的是哪个版本的 Eclipse？

只要我记得（我从早期的 3.xs 开始就一直在使用 Eclipse），Eclipse 支持开箱即用的 JUnit。你刚才：

右键单击一个项目 -> 运行方式 -> JUnit 测试

这对你不起作用吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T16:33:54.187

我已经使用[moreUnit](http://moreunit.sourceforge.net/)几年了，如果没有它的`Ctrl`+`J`快捷方式在类和它的测试用例之间切换，我就活不下去了。

我还发现[EclEmma](http://www.eclemma.org/)对于查找未经测试的代码很有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T16:24:36.997

比“右键单击项目-> 运行方式-> JUnit 测试”更容易吗？就像您希望它绑定到按键一样（因为它可能是）。让我检查一下——是的，alt-shift-X，然后是“T”。够容易吗？

还有 window/show view/other/java/JUnit 会在窗口中为您提供一个 junit 运行栏。然后，您只需点击运行测试按钮，它将运行您项目/部分中的所有测试。

如果您正在了解 eclipse，那么 Ctrl-shift-L 非常适合找出键绑定。

另外，对 ctrl-space 非常熟悉，只要你在打字的时候按下它（说真的，用所有东西都试试！）另外输入“sysout[ctrl-space]”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T18:30:51.563

我使用了[testNG ，它有一个](http://testng.org)[eclipse](http://code.google.com/p/testng-eclipse/)插件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T18:52:47.807

JUnit 4 实际上真的很容易使用，只要您使用的项目以 Java 5 或更高版本为目标，并且已将其添加到项目中即可。

我的意思是，你能得到多少比

```
@Test
public myTest() {
    // Test code here
} 
```

还有`@Before`, `@After`, `@BeforeClass`, `@AfterClass`, 和`@Ignore`。*Class 方法必须是静态方法。 `@Before`在每个测试`@BeforeClass`之前运行，在第一个测试之前运行......但请记住，JUnit 测试可以按任何顺序运行。

如果您正在执行数据库测试，您可能需要查看[DBUnit](http://www.dbunit.org/)插件，尽管您需要采取一些[特殊步骤](http://www.testearly.com/2006/07/23/dbunit-with-junit-4/)才能将它与 JUnit 4 的本机模式一起使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T19:42:36.910

适合（[http://www.theserverside.com/news/thread.tss?thread_id=39417](http://www.theserverside.com/news/thread.tss?thread_id=39417)）

dbunit ( [http://www.dbunit.org/](http://www.dbunit.org/) )

好多其它的

在 Eclipse 中，您可以右键单击一个包并选择作为 junit 测试运行。

小心[http://xunitpatterns.com/test%20fixture%20-%20ambiguous.html](http://xunitpatterns.com/test%20fixture%20-%20ambiguous.html)。iirc，这归结为junit在调用setup之前创建每个测试用例的实例，而nunit只创建一个实例。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-31T09:06:48.377

“让使用 JUnit 更容易”是什么意思？

我使用 Ant 作为任务运行测试。输出将存储到平面文件或 html 文件中。这取决于 TestRunner。

请指定您的问题，您将得到答案！:)

# .net - 在 .NET 中读取和解析文件 - 招聘性能

> ID：247066
> 
> 赞同：3
> 
> 时间：2008-10-29T14:44:52.317
> 
> 标签：.net, performance, file

我想要最高效的方式来读取和解析文件。

是否可以在 .NET 中读取文件，但不能将整个文件加载到内存中？即在我解析每一行的内容时逐行加载文件？

XmlTextReader 是将整个文件加载到内存中还是在读取文件时将文件流式传输到内存中？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-29T14:54:18.613

您可以使用 StreamReader 类的 ReadLine 方法：

```
string line;

// Read the file and display it line by line.
System.IO.StreamReader file = 
   new System.IO.StreamReader("c:\\test.txt");

while((line = file.ReadLine()) != null)
{
   Console.WriteLine (line);
}

file.Close(); 
```

对于 XML 文件，我会使用 XMLTextReader。请参阅[Dobb 博士杂志上的这篇文章](http://www.ddj.com/windows/184416669)：

*“**使用 C# 在 .NET 中解析 XML 文件：.NET**中有五种不同的解析技术，每种都有自己的优势”*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T14:53:51.643

XmlTextReader 在流上工作 - 因此它不会读取内存中的整个文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T21:47:27.283

这是我多年来一直使用的 TextFileReader 类

[http://www.dotnet2themax.com/ShowContent.aspx?ID=4ee44d6c-79a9-466d-ab47-56bba526534f](http://www.dotnet2themax.com/ShowContent.aspx?ID=4ee44d6c-79a9-466d-ab47-56bba526534f)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T14:47:43.620

我不确定 XMLTextReader，但您可以使用 FileReader 对象逐行读取文件。)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T14:54:57.833

您可以尝试使用 StreamReader.ReadLine 函数并测试与 FileStream/TextReader 等相比的性能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T14:55:06.197

我也不确定 XMLTextReader，但您可以像这样逐行阅读：

```
Dim theLine as String
Dim fsFile As New FileStream(inputFile, FileMode.Open)   'File Stream for the Input File
Dim fsImport As New FileStream(outputFile, FileMode.OpenOrCreate)  'File Stream for the Output File
Dim srFile As New StreamReader(fsFile)  'Stream Reader for Input File
Dim swfile As New StreamWriter(fsImport)   'Stream Writer for Output File

Do While srFile.Peek <> -1              'Do While it's not the last line of the file
    theLine = srFile.ReadLine           'Read the line
    Messagebox.Show(theLine, "Line-by-Line!")
Loop 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T15:02:12.873

XmlTextReader 不会将整个文件加载到内存中，它对流进行操作。

所有文件流对象都以“块”形式读取文件。您可以指定每次调用（即 m 字节，其中 m 是任何整数 - 可能是长 - 值，或使用文本阅读器，任意长度的单行）带回程序的数据量（即块的大小） ) 出于性能原因，操作系统将在每次读取时缓存 n 个字节（其中 n 部分或全部为 0）。您完全无法控制 n 的大小，并且只会让自己感到沮丧，因为它会因一千种不同的环境因素而变化。

# java - 在 JScrollPane 中调整 JPanel 的大小时保留相对鼠标位置

> ID：247071
> 
> 赞同：4
> 
> 时间：2008-10-29T14:45:50.520
> 
> 标签：java, swing, resize

我正在调整 JScrollPane 内的 JPanel 的大小，并且我想确保我的鼠标当前所在的 JPanel 上的点在调整大小后保持其相对于 JScrollPane 的位置（就像 Google 地图在您放大/出去）。

我在 JPanel 上找到了鼠标位置，这让我可以处理位于不同位置的视口。我将它乘以缩放因子，所以我知道缩放后点的位置。然后我减去鼠标在 ScrollPane 上的位置，以便我知道该点相对于可视区域的位置。然而，我做错了什么，我只是看不到什么。

示例代码：

```
import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.Point;
import java.awt.event.MouseWheelEvent;
import java.awt.event.MouseWheelListener;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.SwingUtilities;

public class Test 
{
    public static void main(String[] in)
    {
        javax.swing.SwingUtilities.invokeLater(new Runnable() {
            public void run() {
                new Test();
            }
        });
    }

    public Test()
    {
        final JFrame frame = new JFrame();
        final ScalablePanel child = new ScalablePanel();

        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setLayout(new BorderLayout());
        frame.add(child, BorderLayout.CENTER);
        frame.pack();
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }
}

class ScalablePanel
extends JScrollPane
implements MouseWheelListener
{
    final double ZOOM_IN_FACTOR = 1.1;
    final double ZOOM_OUT_FACTOR = 0.9;
    final JPanel zoomPanel = new JPanel();

    public ScalablePanel()
    {
        final javax.swing.JLabel marker = new javax.swing.JLabel("Testing the mouse position on zoom");
        marker.setHorizontalAlignment(javax.swing.JLabel.CENTER);

        zoomPanel.setLayout(new BorderLayout());
        zoomPanel.add(marker,BorderLayout.CENTER);

        getViewport().setView(zoomPanel);
        setPreferredSize(new Dimension(300,300));
        addMouseWheelListener(this);
    }

    public void mouseWheelMoved(final MouseWheelEvent e) 
    {
        if (e.isControlDown())
        {
            if (e.getWheelRotation() < 0)
                zoomIn(e);
            else
                zoomOut(e);
            e.consume();
        }
    }

    public void zoomIn(final MouseWheelEvent e)
    {
        // Get the mouse position with respect to the zoomPanel
        final Point pointOnZoomPanel = SwingUtilities.convertPoint(
                e.getComponent(), e.getPoint(), zoomPanel);

        // Resize panel
        final Dimension currSize = zoomPanel.getSize();
        zoomPanel.setPreferredSize(
                new Dimension(
                        (int)(currSize.width * ZOOM_IN_FACTOR),
                        (int)(currSize.height * ZOOM_IN_FACTOR) ));

        // Find out where our point on the zoom panel is now that we've resized it
        final Point newViewPos = new Point();
        newViewPos.x = (int)(ZOOM_IN_FACTOR * pointOnZoomPanel.x - e.getPoint().x);
        newViewPos.y = (int)(ZOOM_IN_FACTOR * pointOnZoomPanel.y - e.getPoint().y);
        // Move the viewport to the new position to keep the area our mouse was in the same spot
        getViewport().setViewPosition(newViewPos);

        zoomPanel.revalidate();
    }

    public void zoomOut(final MouseWheelEvent e)
    {
        // Get the mouse position with respect to the zoomPanel
        final Point pointOnZoomPanel = SwingUtilities.convertPoint(
                e.getComponent(), e.getPoint(), zoomPanel);

        // Resize panel
        final Dimension currSize = zoomPanel.getSize();
        zoomPanel.setPreferredSize(
                new Dimension(
                        (int)(currSize.width * ZOOM_OUT_FACTOR),
                        (int)(currSize.height * ZOOM_OUT_FACTOR) ));

        // Find out where our point on the zoom panel is now that we've resized it
        final Point newViewPos = new Point();
        newViewPos.x = (int)(ZOOM_OUT_FACTOR * pointOnZoomPanel.x - e.getPoint().x);
        newViewPos.y = (int)(ZOOM_OUT_FACTOR * pointOnZoomPanel.y - e.getPoint().y);
        // Move the viewport to the new position to keep the area our mouse was in the same spot
        getViewport().setViewPosition(newViewPos);

        zoomPanel.revalidate();
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T17:57:39.133

尝试将鼠标的位置作为当前大小的百分比来查找，然后将其应用于新大小：

```
newViewPos.x = (int)((ZOOM_IN_FACTOR * currSize.width) * (e.getPoint().x/(double)currSize.width)); 
```

举个例子。通过这种方式，您正在查看相对于滚动窗格的鼠标位置，并在 zoomPanel 上保留该关系。

# javascript - 我可以将 Dojo 命名空间更改为 dojo 以外的名称吗？

> ID：247085
> 
> 赞同：4
> 
> 时间：2008-10-29T14:49:04.507
> 
> 标签：javascript, dojo, namespaces

我知道你可以使用 jQuery.noConflict 为 jQuery 做到这一点。有没有办法用 Dojo 做类似的事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T14:53:31.253

我相信你可以。有关在一个页面上运行多个版本的 Dojo 的信息，请参阅[此页面。](http://dojotoolkit.org/reference-guide/quickstart/multiversion.html)这很繁琐，但似乎正是您想要的。

一般而言，Dojo 和 jQuery 都非常小心，不会破坏彼此或其他任何人的变量名。

# unit-testing - 是否应该在编写代码之前编写单元测试？

> ID：247086
> 
> 赞同：25
> 
> 时间：2008-10-29T14:49:28.373
> 
> 标签：unit-testing, tdd

我知道测试驱动开发的定义原则之一是您首先编写单元测试，然后编写代码以通过这些单元测试，但是有必要这样做吗？

我发现在编写之前我常常不知道我在测试什么，主要是因为我过去从事的几个项目更多地是从概念证明而不是设计出来的。

我以前尝试过编写单元测试，它可能很有用，但对我来说似乎并不自然。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-29T15:08:11.270

这里有一些很好的评论，但我认为有一件事被忽略了。

编写测试首先驱动您的设计。这是重要的一步。如果您“同时”或“不久之后”编写测试，您可能会错过以微步骤执行 TDD 的一些设计优势。

起初感觉真的很俗气，但看到事情在你眼前展开成你最初没有想到的设计，真是太棒了。我已经看到它发生了。

TDD 很难，并不适合所有人。但是如果你已经接受了单元测试，那就试试一个月，看看它对你的设计和生产力有什么影响。

您花在调试器上的时间更少，而花更多时间思考由外而内的设计。这是我书中的两个巨大优势。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-29T14:56:35.927

有[研究](http://scruffylookingcatherder.com/archive/2008/01/22/tdd-proven-effective-or-is-it.aspx)表明，在编写代码之后编写的单元测试是更好的测试。但需要注意的是，人们不倾向于在事件发生后写它们。因此，TDD 是一个很好的折衷方案，因为至少要编写测试。

因此，如果您在编写代码后编写测试，对您有好处，我建议您坚持下去。

我倾向于发现我做混合。我对需求了解得越多，我可以预先编写的测试就越多。当需求——或者我对问题的理解——薄弱时，我倾向于在之后编写测试。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-29T15:32:02.563

TDD 不是关于测试，而是关于测试如何驱动你的代码。因此，基本上您正在编写测试以让架构自然发展（并且不要忘记重构！！！否则您不会从中获得太多好处）。之后您拥有大量回归测试和可执行文档是一个很好的副作用，但不是 TDD 背后的主要原因。

所以我的投票是：先测试

PS：不，这并不意味着您不必事先规划您的架构，而是如果测试告诉您这样做，您可能会重新考虑它！！！！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-29T15:48:45.993

在过去的 6-7 年里，我一直领导着开发团队。我可以肯定的是，作为一名开发人员和与我共事过的开发人员，如果我们知道我们的代码适合大局的位置，它会在代码质量方面产生显着差异。

测试驱动开发 (TDD) 帮助我们回答“什么？” 在我们回答“如何？”之前 它有很大的不同。

我理解为什么在 PoC 类型的开发/架构师工作中可能会担心不遵循它。你是对的，遵循这个过程可能没有完全的意义。同时，我想强调的是，TDD 是一个属于开发阶段的过程（我知道这听起来已经过时了，但你明白了：）当低级规范明确时。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-29T15:10:51.407

我认为首先编写测试有助于定义代码实际应该做什么。很多时候人们对代码应该做什么或应该如何工作没有一个很好的定义。他们只是开始写作并随着他们的进展而弥补。首先创建测试使您专注于代码将执行的操作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-29T14:50:47.093

并非总是如此，但我发现当我这样做时它确实有帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-29T14:55:33.887

我倾向于在编写代码时编写它们。最多我会在编写之前编写测试类/模块是否存在。

我没有计划足够多的细节来比要测试的代码更早地编写测试。

我不知道这是否是我的思维或方法的缺陷，或者只是 TIMTOWTDI。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-29T14:57:16.113

我从我想如何调用我的“单元”开始并使其编译。像：

```
picker = Pick.new
item=picker.pick('a')
assert item 
```

然后我创建

```
class Pick
 def pick(something)
 return nil
 end
end 
```

然后我继续在我的“测试”用例中使用 Pick，这样我就可以看到我希望如何调用它以及如何处理不同类型的行为。每当我意识到我可能在某些边界或某种错误/异常上遇到问题时，我都会尝试让它触发并获得一个新的测试用例。

所以，简而言之。是的。之前做测试的比例比不做的要高很多。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-29T15:38:36.840

指令是关于如何做事来提高整体质量或生产力甚至最终产品的建议。它们绝不是要遵守的法律，除非你被正确的编码实践之神一闪而过。

这是我对拍摄的妥协，我发现它非常有用且富有成效。

通常最难解决的部分是需求，紧随其后的是你的类、API、包的可用性......然后是实际的实现。

1.  **编写你的界面（它们会改变，但在知道必须做什么**方面会有很长的路要走）
2.  编写一个简单的程序来使用接口（它们愚蠢的主要）。这在确定**如何**使用它方面有很长的路要走（根据需要经常回到 1）
3.  在接口上编写测试（我从 TDD 集成的位，根据需要再次回到 1）
4.  在接口后面编写实际代码
5.  在类和实际实现上编写测试，使用覆盖工具确保你不会忘记奇怪的执行路径

所以，是的，我在编码之前编写测试，但在我弄清楚需要用一定程度的细节做什么之前从来没有。这些通常是高级测试，仅将整体视为黑匣子。通常将保留为集成测试，一旦接口稳定，不会有太大变化。

然后我在其背后的实现上编写了一堆测试（单元测试），这些测试将更加详细，并且随着实现的发展，随着它的优化和扩展而经常改变。

这是严格意义上的 TDD 吗？极端？敏捷...？任何... ？我不知道，坦率地说，我不在乎。它对**我有用**。我会根据需要和我对软件开发实践的理解进行调整。

我的 2 美分

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-29T16:19:45.993

我已经编程了 20 年，而且我几乎从来没有写过没有运行某种单元测试的代码行——老实说，我知道人们一直都在这样做，但是有人怎么能发布一个没有经过某种测试运行的代码行超出了我的范围。

通常，如果没有合适的测试框架，我只会在我编写的每个类中编写一个 main()。它给你的应用程序增加了一点麻烦，但我猜有人可以随时删除它（或注释掉它）。我真的希望你的类中只有一个 test() 方法可以自动编译出发布版本——我喜欢我的测试方法和我的代码在同一个文件中......

所以我已经完成了测试驱动开发和测试开发。我可以告诉你，当你是一个初级程序员时，TDD 真的很有帮助。它可以帮助您学习“从外部”查看代码，这是程序员可以学习的最重要的课程之一。

TDD 还可以帮助您在遇到困难时继续前进。你可以只写一些你知道你的代码必须做的非常小的部分，然后运行它并修复它——它会让人上瘾。

另一方面，当您添加到现有代码并且几乎确切地知道您想要什么时，这是一个折腾。您的“其他代码”经常测试您的新代码。您仍然需要确保测试每条路径，但只需从前端运行测试即可获得良好的覆盖率（动态语言除外——对于那些你真的应该对所有内容进行单元测试的语言）。

顺便说一句，当我在一个相当大的 Ruby/Rails 项目中时，我们的测试覆盖率非常高。我们将一个主要的中心模型类重构为两个类。这需要我们两天时间，但通过所有测试，我们不得不重构它，最终接近两周。测试不是完全免费的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-01T20:59:42.350

我不确定，但是从您的描述中，我感觉到对 test-first 的实际含义可能存在误解。这并不*意味着*您首先编写*所有*测试。这确实意味着你有一个非常紧凑的周期

1.  编写一个最小的测试
2.  通过编写必要的最少生产代码使测试通过
3.  编写下一个将失败的测试
4.  通过以最简单的方式更改现有的生产代码，使所有现有的测试通过
5.  重构代码（测试和生产！），使其不包含重复并具有表现力
6.  继续 3\. 直到你想不出另一个合理的测试

一个周期 (3-5) 通常只需要几分钟。使用这种技术，您实际上可以在并行编写测试和生产代码的同时*改进设计。*根本没有涉及太多的前期设计。

关于它是否“必要”的问题——不，显然不是。不做 TDD 成功的项目数不胜数。但是有一些强有力的证据表明，使用 TDD 通常会显着提高质量，而且通常不会对生产力产生负面影响。而且也很有趣！

哦，关于它感觉不“自然”，这只是你习惯的问题。我知道有些人非常沉迷于每隔几分钟获得一个绿色条（“所有测试通过”的典型 xUnit 标志）。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-12-01T21:06:52.657

现在有这么多的答案，他们都是不同的。这与外面的现实完全相似。每个人都在做不同的事情。我认为对单元测试存在巨大的误解。在我看来，好像人们听说过 TDD 并且他们说它很好。然后他们开始编写单元测试，但并没有真正理解 TDD 到底是什么。他们刚刚得到“哦，是的，我们必须编写测试”的部分并且他们同意它。他们也听说过“你应该先写你的测试”，但他们并不认真。

我认为这是因为他们不了解测试优先的好处，反过来，只有在您以这种方式完成一段时间后您才能理解。他们似乎总是找到 1.000.000 个借口来解释为什么他们不喜欢先编写测试。因为在弄清楚所有东西如何组合在一起时太难了等等等等。在我看来，这都是他们逃避无法自律的借口，尝试测试优先的方法并开始看到好处。

如果他们开始争论“我不相信这个测试优先的事情，但我从来没有这样做过”，那是最可笑的事情......太好了......

我想知道单元测试最初来自哪里。因为如果这个概念真的源自 TDD，那么人们如何理解它是可笑的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-29T15:22:45.033

编写测试首先定义了您的代码的外观 - 即它倾向于使您的代码更加模块化和可测试，因此您不会创建具有非常复杂和重叠功能的“膨胀”方法。这也有助于将所有核心功能隔离在单独的方法中，以便于测试。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-29T15:54:48.727

就我个人而言，我相信如果在编写代码之前没有完成单元测试，它们的效率就会大大降低。

测试的一个古老问题是，无论我们多么努力地思考它，我们永远不会想出每一个可能的场景来编写一个测试来覆盖。

显然，单元测试本身并不能完全阻止这种情况，因为它是限制性测试，只查看一个代码单元，不涵盖此代码与其他所有内容之间的交互，但它首先为编写干净的代码提供了良好的基础，应该至少限制模块之间交互问题的机会。我一直致力于保持代码尽可能简单的原则——事实上，我相信这是 TDD 的关键原则之一。

所以从一个测试开始，基本上说你可以创建一个这种类型的类并构建它，理论上，为每一行代码编写一个测试，或者至少覆盖一段特定代码的每条路线。随手设计！显然是基于最初制作的粗略设计，为您提供一个可以工作的框架。

正如您所说，一开始是非常不自然的，而且似乎是在浪费时间，但我亲眼目睹了从长远来看，当缺陷统计数据出现并显示使用 TDD 完全编写的模块时，它会得到回报随着时间的推移，缺陷比其他产品低得多。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-29T22:23:45.213

之前，期间和之后。之前是规范的一部分，合同，工作的定义期间是在实施过程中发现特殊情况，不良数据，异常的情况。之后是维护、进化、改变、新的需求。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-29T14:56:21.373

我不会先编写实际的单元测试，但我会在开始编码之前制作一个测试矩阵，列出所有可能需要测试的场景。我还列出了在对程序的任何部分进行更改时必须测试的案例列表，作为回归测试的一部分，除了全面测试代码位之外，该回归测试将涵盖应用程序中的大多数基本场景改变了。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-29T15:00:27.667

请记住，通过 Extreme 编程，您的测试实际上就是您的文档。所以如果你不知道你在测试什么，那么你就不知道你想要你的应用程序做什么？

您可以从“故事”开始，可能类似于

“用户可以获取问题列表”

然后，当您开始编写代码来解决单元测试时。要解决上述问题，您至少需要一个用户和问题类。那么你就可以开始考虑这些领域了：

“用户类具有名称 DOB 地址 TelNo 锁定字段”

等希望它有所帮助。

狡猾

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-29T15:00:48.307

是的，如果您使用的是真正的 TDD 原则。否则，只要您编写单元测试，您就比大多数人做得更好。

根据我的经验，在编写代码之前编写测试通常更容易，因为这样做可以为自己提供一个简单的调试工具，以便在编写代码时使用。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-29T15:01:06.637

我同时写它们。我为新类和测试类创建了框架代码，然后为某些功能编写了一个测试（这有助于我了解我希望如何调用新对象），并在代码中实现它。

通常，我第一次不会得到优雅的代码，它通常很hacky。但是一旦所有的测试都工作了，你就可以重构，直到你最终得到一些非常干净、整洁并且可以证明是坚如磐石的东西。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-29T22:12:52.240

当你在写一些你习惯写的东西时，它会有所帮助，首先写下你会定期检查的所有东西，然后再写那些功能。更多时候，这些功能对于您正在编写的软件来说不是最重要的。现在，在另一边没有灵丹妙药，事情不应该一成不变。开发人员的判断在决定使用测试驱动开发还是测试后开发的决策中起着重要作用。

# sql - 如何调试 ORA-01775：同义词循环链？

> ID：247090
> 
> 赞同：54
> 
> 时间：2008-10-29T14:50:03.897
> 
> 标签：sql, oracle, synonym

我熟悉 ORA-01775 背后的问题：循环同义词链，但是有什么技巧可以调试它，还是我只需要“创建或替换”我的出路？

有没有办法查询模式或任何东西来找出公共同义词的当前定义是什么？

更棒的是图形工具，但在这一点上，任何东西都会有帮助。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-10-29T17:09:35.410

事实证明，问题实际上并不是同义词的循环链，而是同义词指向一个不存在的视图这一事实。

在这种情况下，Oracle 显然会错误地显示为循环链。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2013-04-19T05:26:12.807

如果您使用的是 TOAD，请转到 View>Toad Options>Oracle>General 并从 EXPLAIN PLAN 部分删除 TOAD_PLAN_TABLE 并将 PLAN_TABLE

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-29T15:11:30.670

数据字典表`DBA_SYNONYMS`包含有关数据库中所有同义词的信息。所以你可以运行查询

```
SELECT table_owner, table_name, db_link
  FROM dba_synonyms 
 WHERE owner        = 'PUBLIC'
   AND synonym_name = <<synonym name>> 
```

查看公共同义词当前指向的内容。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2015-08-01T08:34:59.533

此错误代码的不太直观的解决方案似乎是同义词指向的对象存在问题。

这是我用于查找指向错误对象的同义词的 SQL。

```
SELECT S.OWNER as SYN_OWNER, S.SYNONYM_NAME as SYN_NAME,
    S.TABLE_OWNER as OBJ_OWNER, S.TABLE_NAME as OBJ_NAME,
    CASE WHEN O.OWNER is null THEN 'MISSING' ELSE O.STATUS END as OBJ_STATUS
FROM DBA_SYNONYMS S
    LEFT JOIN DBA_OBJECTS O ON S.TABLE_OWNER = O.OWNER AND S.TABLE_NAME = O.OBJECT_NAME
WHERE O.OWNER is null
    OR O.STATUS != 'VALID'; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-10-09T11:07:24.147

尝试此选择以查找有问题的同义词，它列出了指向不存在的对象的所有同义词（表、视图、序列、包、过程、函数）

```
SELECT *
FROM dba_synonyms
WHERE table_owner = 'USER'
    AND (
        NOT EXISTS (
            SELECT *
            FROM dba_tables
            WHERE dba_synonyms.table_name = dba_tables.TABLE_NAME
            )
        AND NOT EXISTS (
            SELECT *
            FROM dba_views
            WHERE dba_synonyms.table_name = dba_views.VIEW_NAME
            )
        AND NOT EXISTS (
            SELECT *
            FROM dba_sequences
            WHERE dba_synonyms.table_name = dba_sequences.sequence_NAME
            )
        AND NOT EXISTS (
            SELECT *
            FROM dba_dependencies
            WHERE type IN (
                    'PACKAGE'
                    ,'PROCEDURE'
                    ,'FUNCTION'
                    )
                AND dba_synonyms.table_name = dba_dependencies.NAME
            )
        ) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-02-18T07:11:42.920

今天我得到了这个错误，调试后我发现实际的表丢失了，我用同义词指代。所以我建议 - 首先检查表是否存在！:-))

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-08-07T16:20:01.557

步骤 1）查看名称存在哪些对象：

```
select * from all_objects where object_name = upper('&object_name'); 
```

可能存在同义词但没有表？

* * *

第 2 步）如果这不是问题，请调查同义词：

```
select * from all_synonyms where synonym_name = upper('&synonym_name'); 
```

可能是缺少该同义词的基础表或视图？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-08-24T20:36:41.217

一位开发人员不小心编写了生成并运行以下 SQL 语句的代码，`CREATE OR REPLACE PUBLIC SYNONYM "DUAL" FOR "DUAL";`导致`select * from dba_synonyms where table_name = 'DUAL';` 返回`PUBLIC DUAL SOME_USER DUAL`而不是`PUBLIC DUAL SYS DUAL`.

我们能够通过运行修复它（感谢[如何重新创建公共同义词“DUAL”？](https://stackoverflow.com/questions/30504918/how-to-recreate-public-synonym-dual)）

```
ALTER SYSTEM SET "_SYSTEM_TRIG_ENABLED"=FALSE SCOPE=MEMORY;
CREATE OR REPLACE PUBLIC SYNONYM DUAL FOR SYS.DUAL;
ALTER SYSTEM SET "_SYSTEM_TRIG_ENABLED"=true SCOPE=MEMORY; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-06-26T16:13:42.923

虽然 Jarrod 的回答是一个好主意，并且发现了更广泛的相关问题，但我发现在 Oracle 论坛中找到的这个查询更直接地解决了（最初陈述的）问题：

```
select owner, synonym_name, connect_by_iscycle CYCLE
from dba_synonyms
where connect_by_iscycle > 0
connect by nocycle prior table_name = synonym_name
and prior table_owner = owner
union
select 'PUBLIC', synonym_name, 1
from dba_synonyms
where owner = 'PUBLIC'
and table_name = synonym_name
and (table_name, table_owner) not in (select object_name, owner from dba_objects
where object_type != 'SYNONYM') 
```

[https://community.oracle.com/message/4176300#4176300](https://community.oracle.com/message/4176300#4176300)

您不必费力地穿过其他类型的无效对象。只是那些实际上处于无限循环中的那些。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-16T16:20:42.350

我有一个类似的问题，结果是由于表和模式名称中缺少双引号引起的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-03-13T18:48:26.703

我们有同样的 ORA-01775 错误，但在我们的例子中，模式用户在几个公共同义词上缺少一些“授权选择”。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-03-18T20:59:53.613

我们今天遇到了这个错误。这就是我们调试和修复它的方式。

1.  由于此错误，包进入无效状态`ORA-01775`。

2.  使用错误行号，我们通过`package`正文代码找到了试图将数据插入到`table`.

3.  `table`我们运行下面的查询以检查上述是否`synonym`存在。

    ```
    SELECT * FROM DBA_TABLES WHERE TABLE_NAME = '&TABLE_NAME';  -- No rows returned

    SELECT * FROM DBA_SYNONYMS WHERE SYNONYM_NAME = '&SYNONYM_NAME'; -- 1 row returned 
    ```

4.  由此我们得出结论，需要重新创建该表。由于`synonym`指向一个`table`不存在的。

5.  DBA 团队重新创建了表，这解决了问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-07-21T12:27:40.837

ORA-01775: 循环同义词链 当我试图编译一个包时遇到了上述错误，该包正在使用一个为其创建了同义词的对象，但底层对象不可用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-04-21T13:05:13.743

我正在使用以下 sql 在 all_synonyms 中查找 object_name 没有对应对象的条目（在 user_objects 中）：

```
 select * 
   from all_synonyms 
   where table_owner = 'SCOTT' 
     and synonym_name not like '%/%'
     and table_name not in (
       select object_name from user_objects
         where object_type in (
           'TABLE', 'VIEW', 'PACKAGE', 'SEQUENCE',
           'PROCEDURE', 'FUNCTION', 'TYPE'
         )
    ); 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-10-29T15:12:51.870

[http://ora-01775.ora-code.com/](http://ora-01775.ora-code.com/)建议：

**ORA-01775**：同义词循环链
*原因*：通过一系列CREATE同义词语句，定义了一个同义词，指的是它自己。例如，以下定义是循环的：
`CREATE SYNONYM s1 for s2 CREATE SYNONYM s2 for s3 CREATE SYNONYM s3 for s1`
*操作*：更改一个同义词定义，使其适用于基表或视图并重试该操作。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-03-04T17:45:37.647

如果您正在编译 PROCEDURE，这可能是指在同一 PROCEDURE 中创建时不存在的表或视图。在这种情况下，解决方案是将查询声明为字符串，例如`v_query: = 'insert into table select * from table2`，然后立即执行`v_query`；

这是因为编译器还不能识别对象，因此找不到引用。问候。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2017-01-31T13:52:06.770

我在错误的模式中定义了一个函数，并且没有公共同义词。即我的proc在模式“Dogs”中，而函数在模式“Cats”中。该函数没有公开的同义词以允许 Dogs 访问猫的函数。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2019-01-18T15:35:10.450

对我来说，表名和同义词都存在，但所有者名称不同。我在与同义词中的所有者名称匹配的所有者名称下重新创建了表。

我使用了@Mahi_0707 发布的查询

# c++ - 编辑注册表值

> ID：247093
> 
> 赞同：2
> 
> 时间：2008-10-29T14:50:32.833
> 
> 标签：c++, windows-mobile, registry, pocketpc

我想更改 PocketPC 上的注册表值。我运行了以下代码：

```
if(enabled)
{
    dwData = 120;
}
if(RegSetValueEx(HKEY_LOCAL_MACHINE, _T("System\\CurrentControlSet\\Control\\Power\\Timeouts\\BattSuspendTimeout"), 0, REG_DWORD, (LPBYTE)&dwData, sizeof(DWORD)))
{
    return FALSE;
} 
```

但它不会改变注册表项。有谁知道如何使用 c++ 设置注册表项值？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T22:05:39.213

您正在做的事情有两个问题：

1：RegSetValueEx 不带路径，只取值名。所以你需要先打开密钥路径。

例如

```
HKEY key;
if(ERROR_SUCCESS == RegOpenKeyEx(HKEY_LOCAL_MACHINE, "System\\CurrentControlSet\\Control\\Power\\Timeouts", 0, 0, &key))
{
    if(RegSetValueEx(key, _T("BattSuspendTimeout"), 0, REG_DWORD, (LPBYTE)&dwData, sizeof(DWORD)))
    {
        RegCloseKey(key);
        return FALSE;
    }

    RegCloseKey(key);
} 
```

2：该注册表区域需要特权代码签名才能在所有 Windows Mobile 设备上运行。如果用户在首次运行或安装应用程序时对未知发布者的问题说“是”，则您可以在大多数当前的触摸屏 Windows 移动设备上摆脱它。如果您在设备上收到“拒绝访问”错误，那么您确实需要签署特权代码才能使设备正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T15:48:40.067

RegSetValueEx 返回描述性错误代码。您可以使用 FormatMessage 并可能通过错误查找工具或 VS 中的 @ERR 工具从此错误代码中获取人类可读的消息。您拥有的代码看起来正确，因此请查看错误消息告诉您的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T17:13:01.487

您如何验证更改？请记住，进行此更改*不会*自动反映在设备行为中，并且可能也不会显示在控制面板中（取决于 CPL 是否已加载）。shell 不知道您进行了更改并且它不会轮询该值 - 您必须告诉它出去并重新读取。如何做到这一点[在 MSDN 中有记录](http://msdn.microsoft.com/en-us/library/aa932196.aspx)（基本上你设置了一个命名的系统事件）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T10:05:56.683

查看 [VORegistry][1]，它使使用注册表变得更加容易。

[1]：[http:](http://www.voscorp.com/products/developer/winmobile/voregistry/index.htm) //www.voscorp.com/products/developer/winmobile/voregistry/index.htm VORegistry

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T16:58:14.153

假设您正在使用 RegEdit，您是否刷新 (F5) 注册表视图？

# .net - x64 .NET 编译/进程资源管理器怪异

> ID：247098
> 
> 赞同：5
> 
> 时间：2008-10-29T14:52:09.070
> 
> 标签：.net, clr, 64-bit, process-explorer, corflags

如果我要说的任何内容毫无意义或忽略了一些显而易见的事情，我深表歉意——我对 CLR 内部的了解参差不齐。

如果我理解正确，那么如果我只是在 VS2K5 中为“AnyCPU”构建一个解决方案（或使用这些设置将 MSBuild 指向那个 .sln 文件），那么二进制文件只能编译到 MSIL。然后，如果在 32 位平台上执行，它们会被 JITted 到 32 位；如果在 x64 上执行，它们会被 JITted 到 64 位代码......对吗？

DLL 用于 Web 应用程序并托管在 W3WP.exe 进程中。Process Explorer 告诉我 W3WP 是一个 64 位进程。

但是，当我使用 Process Explorer 在 DLL 视图中检查其中一个 DLL 的属性时，它会显示：“图像：32 位”。是什么赋予了？

如果我对有问题的 dll 运行 corflags，它会告诉我： ILONLY 1 , 32BIT 0 but PE PE32 。我的理解是，这意味着是的，它只编译到 IL，不，它不限于 32 位或 64 位，但我并不完全清楚。PE32 标志是否与上述显示为 32 位有关？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T21:25:27.417

你的问题与[这个问题有关](https://stackoverflow.com/questions/311158/why-doesnt-the-corflags-utility-warn-when-marking-x64-assemblies-as-x86)。您在进程资源管理器中看到的是图像类型，它与程序集的[corflags](http://jilc.sourceforge.net/ecma_p2_cil.shtml#_Runtime_Flags)中指定的“运行时兼容性”类型不同。

设置“Any Cpu”的目的是在本机映像和程序集中强制使用最常用的分母，以便让 .NET 的 Windows 引导程序选择最适合当前平台的运行时类型。

因此，对于您的示例，您确实有一个 32 位图像（由 PE Header 指定），其中包含一个“Any CPU”程序集（由程序集的 CorFlags 指定）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T15:07:05.267

> 然后，如果在 32 位平台上执行，它们会被 JITted 到 32 位；如果在 x64 上执行，它们会被 JITted 到 64 位代码......对吗？

对，您可以通过执行为 AnyCPU 编译的相同 exe 来检查：

sizeof(IntPtr) == 4 //true on 32bit

sizeof(IntPtr) == 8 //在 64 位上为真

但是，如果您的程序集仅在为 32 位平台编译的进程中引用，它将被 jited 为 32 位（在 64 位 Windows 的 WOW 中运行）。

# nhibernate - 你如何在 NHibernate 中合并两个表？

> ID：247103
> 
> 赞同：5
> 
> 时间：2008-10-29T14:53:37.180
> 
> 标签：nhibernate, hql

我需要使用 NHibernate 和 HQL 合并两个表。我在网上找到的帮助很少，我想知道是否可以，如果可以，如何？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T15:13:05.240

找到我的答案：

[http://www.hibernate.org/117.html#A21](http://www.hibernate.org/117.html#A21)

它目前不支持联合或相交。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-04T00:55:41.407

您可以使用命名的 sql-query 并在原始 SQL 中进行联合。NHibernate 将能够从 sql-query 填充实体实例并将其作为查询结果返回。见[这里](http://nhforge.org/doc/nh/en/index.html#querysql-creating)和[这里](http://nhforge.org/doc/nh/en/index.html#querysql-namedqueries)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T15:14:18.043

我不相信 HQL 支持联合，但您可以编写自己的记录转换器并手动编写 sql。

# c++ - '\0' 相关问题

> ID：247106
> 
> 赞同：2
> 
> 时间：2008-10-29T14:54:17.850
> 
> 标签：c++, string

查看将一个 c 字符串复制到另一个的循环：

```
void strcpyr(char *s, char *t)
{
    while(*s++=*t++)// Why does this work?
        ;
} 
```

为什么我们不检查 while 循环中的 '\0' 字符，像这样？

```
while((*s++=*r++)!='\0').. 
```

第一个循环如何终止？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-29T14:59:42.927

语句 *s++=*t++ 不仅将下一个字符从 t 分配给 s，而且还返回 *t 的当前值作为表达式的结果。while 循环终止于任何错误值，包括 '\0'。

这样想吧。如果你这样做了：

```
char c = *s++ = *t++; 
```

除了将 char 从 *t 复制到 *s 并递增两者之外，它还将 c 设置为 *t 的当前值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T14:58:27.810

当我们`'\0'`在最初由 指向的字符串中点击 时`t`，`*s++=*t++`执行赋值的 也返回分配给由`s`或指向的位置的值`'\0'`，它计算`false`并终止循环。

在您的第二个示例中，您明确依赖于赋值返回分配的字符这一事实，而第一个示例隐含地使用了这一事实（以及`0`字符（也写`'\0'`为 ）被认为是假的事实，而所有其他字符的计算结果为true，因此表达式`c != '\0'`将产生与 相同的结果`c`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T14:59:32.380

循环将终止，因为 '\0' 实际上是 0，并且“while” 正在评估的不是相等测试 (==) 的结果，而是赋值表达式的右值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T14:58:46.500

我们没有明确检查零的原因是在 C 0 中是错误的。

因此循环

```
while(*s++=*t++)
; 
```

将在 t 指向的字符为 0 时终止。

-亚当

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T16:38:29.527

在 C 中，a=b 实际上是一个表达式，它被评估为 'b'。写起来更容易：

```
如果（a=b）{
 //一些块
}

```

然后：

```
a=b;
如果（一！= 0）{
 //一些块
}

```

在 C 语言中，在 if、while、for 语句中进行的检查是：表达式不为零吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T15:12:34.770

while 循环正在测试分配的结果。赋值的结果是赋值给语句左侧的值。在最后一次迭代中，当 *t == '\0' 时，'\0' 被分配给 s，这成为 while 循环在决定是时候退出之前考虑的值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T15:00:31.380

我想你的意思是这样写：

```
void strcpyr(char *s, char *t) {
  while (*s++ = *t++);
} 
```

当“t”指向的值为零时，循环终止。对于 C（和 C++）循环和条件，任何非零整数都为真。

# ruby-on-rails - 寻找在 Ruby on Rails 中构建安全 REST API 的建议

> ID：247110
> 
> 赞同：66
> 
> 时间：2008-10-29T14:54:53.107
> 
> 标签：ruby-on-rails, ruby, security, rest, asp.net-web-api

我开始为我正在从事的项目构建 REST API，这让我对使用 RoR 构建 API 的最佳方式进行了一些研究。我很快发现，默认情况下，模型是向世界开放的，并且可以通过 URL 调用，只需在 URL 末尾添加一个“.xml”并传递适当的参数即可。

那么接下来的问题来了。如何保护我的应用程序以防止未经授权的更改？在做一些研究时，我发现了几篇关于它们`attr_accessible`以及`attr_protected`如何使用它们的文章。我发现谈论这些的特定 URL 是在 07 年 5 月发布的（[这里](http://railscasts.com/episodes/26-hackers-love-mass-assignment)）。

与所有的红宝石一样，我相信从那时起事情已经发展了。所以我的问题是，这仍然是在 RoR 中保护 REST API 的最佳方式吗？

如果不是，您在“新项目”或“现有项目”场景中有何建议？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-10-30T14:16:41.060

有几种认证 API 请求的方案，它们不同于由 restful_authentication 或acts_as_authenticated 等插件提供的普通认证。最重要的是，客户端不会维护会话，因此没有登录的概念。

**HTTP 身份验证**

您可以使用基本 HTTP 身份验证。为此，API 客户端将使用常规用户名和密码，并将其放入 URL 中，如下所示：

```
http://myusername:mypass@www.someapp.com/ 
```

我相信 restful_authentication 开箱即用地支持这一点，因此您可以忽略是否有人通过 API 或浏览器使用您的应用程序。

这里的一个缺点是您要求用户在每个请求中都清楚地输入他们的用户名和密码。通过 SSL 执行此操作，您可以确保此操作安全。

不过，我认为我实际上从未见过使用此 API 的 API。对我来说，这似乎是一个不错的主意，特别是因为当前的身份验证方案开箱即用地支持它，所以我不知道问题出在哪里。

**API 密钥**

启用 API 身份验证的另一种简单方法是使用 API 密钥。它本质上是远程服务的用户名。当有人注册使用你的 API 时，你给他们一个 API 密钥。这需要与每个请求一起传递。

这里的一个缺点是，如果有人获得了其他人的 API 密钥，他们可以以该用户的身份发出请求。我认为通过让所有 API 请求都使用 HTTPS (SSL)，可以在一定程度上抵消这种风险。

另一个缺点是用户在任何地方都使用相同的身份验证凭据（API 密钥）。如果他们想撤销对 API 客户端的访问，他们唯一的选择是更改他们的 API 密钥，这也会禁用所有其他客户端。这可以通过允许用户生成多个 API 密钥来缓解。

**API Key + Secret Key 签名**

*已弃用（某种程度） - 请参阅下面的 OAuth*

使用密钥签署请求要复杂得多。这就是 Amazon Web Services（S3、EC2 等）所做的。本质上，您给用户 2 个密钥：他们的 API 密钥（即用户名）和他们的密钥（即密码）。API 密钥与每个请求一起传输，但密钥不是。相反，它用于对每个请求进行签名，通常是通过添加另一个参数。

IIRC，亚马逊通过将所有参数带到请求中并按参数名称对它们进行排序来实现这一点。然后，使用用户的密钥作为散列密钥对该字符串进行散列。这个新值在发送之前作为新参数附加到请求中。在亚马逊方面，他们做同样的事情。它们获取所有参数（签名除外），对它们进行排序，并使用密钥进行散列。如果这与签名匹配，他们就知道该请求是合法的。

这里的缺点是复杂性。让这个方案正常工作对于 API 开发人员和客户来说都是一件痛苦的事情。期待大量来自无法让事情正常工作的客户开发人员的支持电话和愤怒的电子邮件。

**身份验证**

为了解决密钥 + 秘密签名的一些复杂性问题，出现了一个名为[OAuth](http://oauth.net/)的标准。OAuth 的核心是一种密钥 + 秘密签名，但其中大部分是标准化的，并已包含在[许多语言的库中](http://oauth.net/code/)。

一般来说，API 生产者和消费者都更容易使用 OAuth，而不是创建自己的密钥/签名系统。

OAuth 还固有地对访问进行细分，为每个 API 使用者提供不同的访问凭证。这允许用户有选择地撤销访问而不影响他们的其他消费应用程序。

特别是对于 Ruby，有一个[OAuth gem](http://oauth.rubyforge.org/)可以为 OAuth 的生产者和消费者提供开箱即用的支持。我已经使用这个 gem 来构建 API 并使用 OAuth API，印象非常深刻。如果您认为您的应用程序需要 OAuth（而不是更简单的 API 密钥方案），那么我可以轻松推荐使用 OAuth gem。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-29T19:28:48.920

> 如何保护我的应用程序以防止未经授权的更改？

`attr_accessible`并且`attr_protected`对于控制在 ActiveRecord 模型上执行批量分配的能力都很有用。您肯定想使用 attr_protected 来防止表单注入攻击；请参阅[使用 attr_protected 否则我们将破解您](http://b.lesseverything.com/2008/3/11/use-attr_protected-or-we-will-hack-you)。

此外，为了防止任何人能够访问您的 Rails 应用程序中的控制器，您几乎可以肯定需要某种用户身份验证系统并`before_filter`在您的控制器中放置一个以确保您有一个授权用户发出请求在您允许执行请求的控制器操作之前。

有关更多有用信息，请参阅[Ruby on Rails 安全指南](http://guides.rails.info/security.html)（Rails 文档项目的一部分）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T15:06:42.117

我目前面临与您类似的问题，因为我还在为 Rails 应用程序构建 REST api。

我建议确保只有可以用户编辑的属性才用 attr_accessible 标记。这将设置可以使用 update_attributes 分配的属性白名单。

我所做的是这样的：

```
 class Model < ActiveRecord::Base  
       attr_accessible nil  
   end 
```

我所有的模型都继承自它，因此他们被迫为他们想要批量分配的任何字段定义 attr_accessible。就个人而言，我希望有一种方法可以默认启用此行为（可能有，但我不知道）。

只是为了让您知道有人不仅可以使用 REST api 还可以使用常规表单发布来批量分配属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-03T12:55:04.320

另一种节省自己构建大量东西的方法是使用[http://www.3scale.net/](http://www.3scale.net/)之类的东西，它为个人开发人员处理密钥、令牌、配额等。它还进行分析并创建开发人员门户。

有一个 ruby​​/rails 插件[ruby​​ API 插件](https://github.com/3scale/3scale_ws_api_for_ruby)，它将在流量到达时应用于流量策略 - 您可以将它与[oAuth gem](http://oauth.rubyforge.org/)结合使用。您也可以通过在应用程序前面放置 varnish 并使用 varnish lib mod: [Varnish API Module](https://github.com/3scale/libvmod-3scale/)来使用它。

# asp.net - 我应该在 ASP.NET MVC 中构建我的下一个 Web 应用程序吗？

> ID：247115
> 
> 赞同：9
> 
> 时间：2008-10-29T14:55:59.563
> 
> 标签：asp.net, asp.net-mvc

我的团队正在考虑使用 ASP.NET MVC 框架构建我们的下一个 Web 应用程序。我和其他一些人一样有点犹豫，因为它仍处于测试阶段。我真的很想深入研究，因为它似乎是提供清晰的关注点分离和提高可测试性的好方法。

当 MVC 仍处于测试阶段时，我应该立即冒险，还是推迟发布候选版本？

从一些回答来看，我想我需要稍微澄清一下我的问题。我主要关心的是是否使用仍处于测试阶段的产品，而不是 webforms 与 mvc。担心主要是因为担心我们最终会使用 beta 版本中的某些功能，这些功能在最终版本中会被更改/弃用/不支持。

但是，我确实很欣赏 webforms 与 mvc 的观点。它只是没有成为我问题的核心。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-29T15:19:53.197

这是一个非常简单的决策树，真的。

如果您...，请选择 ASP.NET MVC

*   非常关心 URL
*   非常关心您的 HTML
*   想要真正的关注点分离
*   想要彻底的可测试性
*   需要视图引擎的灵活性（ASPX、NVelocity、NHaml 等）

如果您...，请选择 WebForms

*   享受 WebForms (ViewState) 的有状态抽象
*   不介意 PostBack 模型
*   首选可以在页面上“拖放”的组件

对我来说，99% 的答案是 ASP.NET MVC，因为我认为它更适合 Web。我认为 ajax 故事也更简洁，并且我可以完全控制我的 HTML 和 URL。最重要的是，我可以很容易地测试我的网站（控制器）。

是的，我知道您可以在 WebForms 中实现干净的 URL，您可以通过控制适配器获得干净的 HTML，您可以在 WebForms 中使用 MVP 模式实现一定程度的可测试性，但这些都是不受欢迎的路径方法。对于 ASP.NET MVC，这些东西是核心。这就是你这样做的方式。

并且不要担心预览/测试状态。该团队一直坚持认为您不需要上线许可证即可部署它（即使他们现在提供了）。它纯粹是对现有 ASP.NET 运行时的附加。

这就像自动与手动变速器。选择一个让你快乐并与之一起奔跑的人。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T15:12:08.453

我更喜欢 ASP.NET MVC 而不是 WebForms，所以我会选择它，但是你需要作为一个团队来锻炼你的核心技能，以及是否选择 MVC 会：

1.  创造更好的产品。
2.  让您更快地进入市场。

不要仅仅因为它是新的而选择它。WebForms 仍然是一个不错的选择，您可以为 WebForms 编写既可测试又具有明确关注点分离的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T15:00:22.597

到目前为止，Mvc 看起来不错，但是我是城堡的拥护者，我在许多生产站点中使用过单轨铁路，它让我了解了 IoC 和 AR 查看 castleproject.org

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T15:28:11.870

我建议试一试。

我们最近刚刚发布了一个使用 MVC 运行前端的电子商务平台，虽然您可能会偶然发现一些问题（比如说，目前使用匿名类型解析 Url 比使用 RouteValueDictionary 慢得多，这让我感到惊讶） ，与我们较旧的 WebForms 应用程序相比，在 MVC 中构建可管理的系统确实感觉要容易得多。

如果您有选择的余地，那么您绝对应该仔细看看。在我们处理它的过程中出现的错误都得到了相当快的修复，现在大多数事情都运行良好，并且开始感觉相当完整。

但最终，承担早期测试版产品总是有风险的。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T19:38:22.987

除非您的应用非常简单，否则 MVC 很可能会在您投入生产之前发布。不过，这并不重要。从 Preview 2 开始，我一直在 MVC 上进行构建。每个新版本都包含重大更改；但是，它们并不是很难追踪和修复。在 1.0 之前，您不太可能创建大量代码，而这些代码会因一些重大更改而被推翻。只需预算几个小时来应用每个新版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T14:58:36.640

如果您不必很快将您的应用程序投入生产，可以用 MVC 编写它。在这里，我们有一个团队与 MVC 合作，并计划在 2009 年 1 月将其投入生产。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T15:26:35.790

如果它不是关键任务并且您和您的团队有时间学习它，为什么不呢？

# command-line - Biztalk 可以运行控制台应用程序吗？

> ID：247123
> 
> 赞同：3
> 
> 时间：2008-10-29T14:58:31.977
> 
> 标签：command-line, console, biztalk

我正在编写一个 C# 控制台应用程序，它获取一个二进制文件，将其拆分、分析并将数据存储到数据库中。

我们希望使用 BizTalk 来协调监视何时将新的二进制文件放置在目录中并使用要解析的文件名/名称调用我的应用程序。

BizTalk 可以运行命令行程序吗？
它可以将命令行参数传递给程序吗？
我将如何向 BizTalk 报告上次运行是成功还是失败？

谢谢你，
基思

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T21:32:02.073

我**不**建议这样做，但理论上您可以在表达式形状中使用 shell 命令运行 exe：

`System.Diagnostics.Process.Start(@"C:\yourPath\yourExecutable.exe")`

命名空间在 BizTalk 2006中`System.Diagnostics`可用，我不认为它在 BizTalk 2004 中可用（BizTalk 2004 有一个非常有限的可用系统命名空间子集）。

我不确定是否要返回返回值，但您当然应该能够提供参数。

可以在[此处](http://www.c-sharpcorner.com/UploadFile/DipalChoksi/ShellCommandsInCS12032005042031AM/ShellCommandsInCS.aspx)和[此处](http://www.codeproject.com/KB/cs/wincmdline.aspx)找到有关 C# shell 命令的一些参考资料。

我个人认为您可以使用三个更好的选择：

1.  不要使用 BizTalk。

    正如 Campbell 建议的那样，请改用 Windows 服务。

    如果您想利用现有的 BizTalk 框架（日志记录、报告等），或者如果您在 BizTalk 将要执行的工作流中有其他任务，请仅将 BizTalk 用于此类事情。（对于将所有内容都放在一个平台上存在争议 - 如果您将 Bi​​zTalk 用于一件事，则将 if 用于所有内容，但这是另一种对话）。

2.  将粉碎机的逻辑重构为控制台应用程序和 BizTalk 都可以调用的 C# 类库。

    从 BizTalk 调用类库比调用可执行文件更容易干净和稳健地完成。

    只需从编排中引用已签名和 GAC 的程序集（将其创建为编排变量），然后您就可以直接从表达式形状中调用它。

    [这](http://www.codeproject.com/KB/biztalk/CallCustomDllBiztalk2006.aspx)是一篇涵盖基础知识的文章。它没有涉及很多丑陋的细节，也没有提供关于最佳实践的讨论。[Professional BizTalk Server 2006](https://rads.stackoverflow.com/amzn/click/com/0470046422)是一本很好的书。

3.  正如 Campbell 所说，其中大部分可能可以通过纯 BizTalk 功能来完成。

我认为也许选项 2 和 3 的组合最适合你想要的。将您已有的二进制粉碎逻辑放入 C# 类库中，并从 BizTalk 编排中调用它，该编排负责您的文件监视、错误通知、跟踪以及与其他进程的集成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T16:34:50.033

Biztalk 是一种服务器产品，因此当您在生产环境中设置它时，它将始终在后台运行。

我建议，如果您想使用 BizTalk，请将其设置为观察文件将被删除的位置，将其撕开，分析它，然后在 BizTalk 工作流程中将所有内容写入数据库。这正是它的设计目的。工作流还可以包含通知，或者您可以只使用 BizTalk 跟踪来确认操作是否成功。您可能需要编写的唯一自定义代码是将二进制文件转换为 XML 的反汇编程序。这将作为接收管道组件完成。

如果这就是你所做的一切，那么 BizTalk 就是一个非常昂贵的选择。我建议您编写自己的 Windows 服务并使用[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)来拦截文件已写入的事实，然后在您的 C# 代码中进行处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T03:07:07.977

BizTalk 调用 C# 应用程序有点出格。我们过去曾遇到过类似的问题，我们将控制台应用程序编写或包装为 Web 服务。这样，Biztalk 会拾取被丢弃的文件并将其发送到应用程序 Web 服务应用程序。这属于我们如何使用 BizTalk 的“瑞士军刀”部分。这实在是太武断了。但是，BizTalk 确实提供了诸如跟踪、BAM、远端故障排队等功能。我们还涉及将文件复制到存档位置、从 Web 服务读取结果代码以及使用 SMTP 适配器发送成功或失败通知。

希望这能给你一些想法。祝你好运！

# web-services - Sharepoint Web 服务教程

> ID：247127
> 
> 赞同：7
> 
> 时间：2008-10-29T14:58:48.667
> 
> 标签：web-services, sharepoint

我正在尝试使用将自定义元数据附加到文件的 Web 服务将文档上传到 SharePoint。我已经搜索过，但没有找到涵盖所有这些主题的好教程。谁能指出我正确的方向？

这就是我认为我需要使用 Web 服务的原因：我在 XP 上进行开发，而 Sharepoint 对象模型不是远程的。这意味着任何具有“使用 Microsoft.Sharepoint”的代码都已失效 :-( 我正在研究 CopyIntoItems Web 服务，但我自己无法实现它。我希望有一个清晰的教程。我尝试使用示例代码来自[http://msdn.microsoft.com/en-us/library/copy.copy.copyintoitems.aspx](http://msdn.microsoft.com/en-us/library/copy.copy.copyintoitems.aspx)，但我不确定我的 sourceURL 应该是什么。另外，由于我不能使用“Microsoft.Sharepoint”引用，我想知道我的字段会是什么样子？（这是我的元数据吗？）另外，我很好奇为什么只有网站项目允许我添加 Web 服务。使用该 Web 服务将文件“放入”Sharepoint 后，我​​将不得不使用另一个文件来更新自定义列或元数据。其中一些是自由格式文本，但其他必须匹配列表或查找中的条目。我还没有找到这方面的任何信息。

感谢您的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T15:26:32.917

这是一些代码[http://geek.hubkey.com/2007/10/upload-file-to-sharepoint-document.html](http://geek.hubkey.com/2007/10/upload-file-to-sharepoint-document.html)

至于为什么是这样，因为微软是这样写的:)。有些人编写了将它们组合在一起的自定义 Web 服务，[http://www.sharepointblogs.com/ssa/archive/2006/11/30/wsuploadservice-web-service-for-uploading-documents-into-sharepoint.aspx](http://www.sharepointblogs.com/ssa/archive/2006/11/30/wsuploadservice-web-service-for-uploading-documents-into-sharepoint.aspx)

使用内置的 Web 服务，您必须上传文件并上传包含列的 CAML。如果您使用的是 MS-Office 文档，另一种选择是确保作者填写文档中的属性，然后您可以在 sharepoint 中显示这些字段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T15:21:44.363

这是关于 Sharepoint Designer 的一些内容 - [http://office.microsoft.com/en-us/sharepointdesigner/FX100487631033.aspx](http://office.microsoft.com/en-us/sharepointdesigner/FX100487631033.aspx) 希望对您有所帮助。

您可以从此处链接到 Sharepoint 2007 培训：http: [//office.microsoft.com/en-us/training/HA102358581033.aspx](http://office.microsoft.com/en-us/training/HA102358581033.aspx)

我相信设计师有一个 WS 例子。

# javascript - 如何自动调整 iFrame 的大小？

> ID：247128
> 
> 赞同：64
> 
> 时间：2008-10-29T14:59:00.463
> 
> 标签：javascript, iframe, autosize

> **可能重复：**
> [根据内容调整 iframe 的大小](https://stackoverflow.com/questions/153152/resizing-an-iframe-based-on-content)

我正在加载 iFrame 并希望父级根据 iFrame 内容的高度自动更改高度。

简单来说，所有页面都属于同一个域，所以我不应该遇到跨站点脚本问题。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-29T15:06:31.523

在任何其他元素上，我会使用`scrollHeight`DOM 对象并相应地设置高度。我不知道这是否适用于 iframe（因为它们对所有事情都有些古怪），但这当然值得一试。

编辑：环顾四周，普遍的共识是使用 iframe 设置高度`offsetHeight`：

```
function setHeight() {
    parent.document.getElementById('the-iframe-id').style.height = document['body'].offsetHeight + 'px';
} 
```

并附加它以与 iframe-body 的`onLoad`事件一起运行。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-09-13T12:47:34.787

尝试：

*   [jquery-iframe-自动高度](https://github.com/house9/jquery-iframe-auto-height)
*   [iframe 调整器](https://github.com/davidjbradshaw/iframe-resizer)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-06-03T15:28:28.547

我只是碰巧遇到你的问题，我有一个解决方案。但它在jquery中。它太简单了。

```
$('iframe').contents().find('body').css({"min-height": "100", "overflow" : "hidden"});
setInterval( "$('iframe').height($('iframe').contents().find('body').height() + 20)", 1 ); 
```

给你！

干杯! :)

**编辑：**如果你有一个基于 iframe 方法而不是 div 方法的富文本编辑器，并且希望它扩展每一行，那么这段代码就可以满足需要。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-08-11T01:39:12.937

这是一个适用于每个浏览器和跨域的简单解决方案：

首先，这适用于这样一个概念，即如果包含 iframe 的 html 页面设置为 100% 的高度，并且 iframe 使用 css 样式设置为具有 100% 的高度，那么 css 将自动调整所有内容以适应。

这是代码：

```
<head>
<style type="text/css"> 
html {height:100%}
body {
margin:0;
height:100%;
overflow:hidden
}
</style>
</head>

<body>
<iframe allowtransparency=true frameborder=0 id=rf sandbox="allow-same-origin allow-forms allow-scripts" scrolling=auto src="http://www.externaldomain.com/" style="width:100%;height:100%"></iframe>
</body> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T18:45:07.697

这个[解决方案](http://sonspring.com/journal/jquery-iframe-sizing)最适合我。它使用 jQuery 和 iframe 的“.load”事件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T15:24:57.523

在 IE 5.5+ 中，您可以使用 contentWindow 属性：

```
iframe.height = iframe.contentWindow.document.scrollHeight; 
```

在 Netscape 6（假设也是 firefox）中， contentDocument 属性：

```
iframe.height = iframe.contentDocument.scrollHeight 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-10T14:31:01.367

我发现@ShripadK 的解决方案最有帮助，但如果有多个 iframe，它就不起作用。我的解决方法是：

```
function autoResizeIFrame() {
  $('iframe').height(
    function() {
      return $(this).contents().find('body').height() + 20;
    }
  )
}

$('iframe').contents().find('body').css(
  {"min-height": "100", "overflow" : "hidden"});

setTimeout(autoResizeIFrame, 2000);
setTimeout(autoResizeIFrame, 10000); 
```

*   `$('iframe').height($('iframe').contents().find('body').height() + 20)`将每一帧的高度设置为相同的值，即第一帧内容的高度。所以我使用`height()`带有函数而不是值的jquery。这样就可以计算出各个高度
*   `+ 20`是解决 iframe 滚动条问题的 hack。该数字必须大于滚动条的大小。黑客可能可以避免，但禁用 iframe 的滚动条。
*   在我的情况下，我使用`setTimeout`而不是`setInterval(..., 1)`减少 CPU 负载

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-25T12:42:54.357

我的解决方案，（使用jquery）：

```
<iframe id="Iframe1" class="tabFrame" width="100%" height="100%" scrolling="no" src="http://samedomain" frameborder="0" >
</iframe>  
<script type="text/javascript">
    $(function () {

        $('.tabFrame').load(function () {
            var iframeContentWindow = this.contentWindow;
            var height = iframeContentWindow.$(document).height();
            this.style.height = height + 'px';
        });
    });
</script> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-06-17T09:05:50.280

这是我使用原型发现的最简单的方法：

主要.html：

```
<html>
<head>

<script src="prototype.js"></script>

<script>
    function init() {
        var iframe = $(document.getElementById("iframe"));
        var iframe_content = $(iframe.contentWindow.document.getElementById("iframe_content"));
        var cy = iframe_content.getDimensions().height;
        iframe.style.height = cy + "px";
    }
</script>

</head>

<body onload="init()">

<iframe src="./content.html" id="iframe" frameBorder="0" scroll="no"></iframe>

<br>
this is the next line

</body>
</html> 
```

内容.html：

```
<html>
<head>
<script src="prototype.js"></script>

<style>
body {
    margin: 0px;
    padding: 0px;
}
</style>

</head>

<body>

<div id="iframe_content" style="max-height:200px;">
Sub content<br>
Sub content<br>
...
...
...
</div>

</body>
</html> 
```

这似乎在所有主要浏览器中都有效（到目前为止）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-29T15:21:51.867

Oli 有一个适合我的解决方案。作为记录，我的 iFrame 中的页面是由 javascript 呈现的，所以在报告 offsetHeight 之前我需要一个无限小的延迟。它看起来像这样的东西：

```
 $(document).ready(function(){
        setTimeout(setHeight);
    });

    function setHeight() {
        alert(document['body'].offsetHeight);   
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-11-06T04:33:57.630

我的解决方法是将 iframe 的高度/宽度设置为远远超过 CSS 中任何预期的源页面大小，并将`background`属性设置为`transparent`.

在 iframe 中设置`allow-transparency`为`true`和。`scrolling``no`

唯一可见的是您使用的任何源文件。它适用于 IE8、Firefox 3 和 Safari。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-29T18:12:21.663

实际上 - 帕特里克的代码也对我有用。正确的做法是这样的：

注意：前面有一点 jquery：

```
 if ($.browser.msie == false) {
    var h = (document.getElementById("iframeID").contentDocument.body.offsetHeight);
} else {
    var h = (document.getElementById("iframeID").Document.body.scrollHeight);
} 
```

# xml - 使用 XPATH 搜索包含的文本

> ID：247135
> 
> 赞同：125
> 
> 时间：2008-10-29T15:00:30.537
> 
> 标签：xml, search, xpath, selenium

我使用[XPather Browser](http://xpath.alephzarro.com/)在 HTML 页面上检查我的 XPATH 表达式。

我的最终目标是在 Selenium 中使用这些表达式来测试我的用户界面。

我得到了一个 HTML 文件，其内容类似于：

```
<tr>
  <td>abc</td>
  <td> </td>
</tr>

```

我想选择一个文本包含字符串“ `&nbsp;`”的节点。

使用像“abc”这样的普通字符串没有问题。我使用类似于`//td[text()="abc"]`.

当我尝试使用 XPATH时，`//td[text()="&nbsp;"]`它什么也不返回。对带有“”的文本有特殊规定`&`吗？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-10-29T18:34:39.450

似乎 Selenium 背后的[OpenQA](http://www.openqa.org/)已经解决了这个问题。他们定义了一些变量来明确匹配空格。就我而言，我需要使用类似于`//td[text()="${nbsp}"]`.

我在此处复制了 OpenQA 关于此问题的文本（在[此处](https://svn.openqa.org/svn/selenium-core/trunk/src/main/resources/doctool/doc2html.xml)找到）：

> HTML 自动规范化元素中的空白，忽略前导/尾随空格并将额外的空格、制表符和换行符转换为单个空格。当 Selenium 从页面中读取文本时，它会尝试复制此行为，因此您可以忽略 HTML 中的所有制表符和换行符，并根据呈现时文本在浏览器中的外观进行断言。我们通过用一个空格替换所有不可见的空格（包括不间断空格“ `&nbsp;`”）来做到这一点。应保留所有可见的换行符（`<br>`、`<p>`和格式化的换行符）。`<pre>`
> 
> 我们对 HTML Selenese 测试用例表的文本使用相同的规范化逻辑。这有许多优点。首先，您不需要查看页面的 HTML 源代码来确定您的断言应该是什么；" `&nbsp;`" 符号对最终用户是不可见的，因此在编写 Selenese 测试时不必担心它们。（您不需要`&nbsp;`在测试用例中放置“”标记来断言包含“ `&nbsp;`”的字段上的文本。）您还可以在 Selenese `<td>`标记中放置额外的换行符和空格；由于我们在测试用例上使用与文本相同的规范化逻辑，因此我们可以确保断言和提取的文本将完全匹配。
> 
> 当您真的想要/需要在测试用例中插入额外的空格时，这会在极少数情况下产生一些问题。例如，您可能需要在如下字段中键入文本：“ `foo` ”。但是，如果您只是`<td>foo </td>`在 Selenese 测试用例中编写代码，我们将仅用一个空格替换您的多余空格。
> 
> 这个问题有一个简单的解决方法。我们在 Selenese 中定义了一个变量 `${space}`，它的值是一个空格。您可以使用`${space}`插入不会自动修剪的空格，如下所示： `<td>foo${space}${space}${space}</td>`. 我们还包括了一个变量 `${nbsp}`，您可以使用它来插入一个不间断的空格。
> 
> 请注意，XPath*不会*像我们那样规范化空白。如果您需要编写一个 XPath， `//div[text()="hello world"]`但链接的 HTML 确实是“ ”，则需要在 Selenese 测试用例 `hello&nbsp;world`中插入一个真正的“ ”以使其匹配，如下所示： .`&nbsp;``//div[text()="hello${nbsp}world"]`

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-29T16:09:14.983

我发现当我通过在 Windows 上的两个引号之间键入 Alt+0160 输入硬编码的不间断空格 (U+00A0) 时，我可以进行匹配...

```
//table[@id='TableID']//td[text()=' '] 
```

使用特殊字符为我工作。

据我了解，XPath 1.0 标准不处理转义 Unicode 字符。XPath 2.0 中似乎有这样的功能，但看起来 Firefox 不支持它（或者我误解了一些东西）。所以你必须与本地代码页有关。丑陋，我知道。

实际上，看起来标准依赖于使用 XPath 的编程语言来提供正确的 Unicode 转义序列......所以，不知何故，我做对了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-29T15:57:33.837

尝试使用小数实体`&#160;`而不是命名实体。如果这不起作用，您应该能够简单地使用[unicode 字符作为不间断空格](http://www.fileformat.info/info/unicode/char/00a0/index.htm)而不是`&nbsp;`实体。

（注意：我没有在 XPather 中尝试过，但我确实在 Oxygen 中尝试过。）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2020-01-11T22:05:54.820

根据您提供的 HTML：

```
<tr>
  <td>abc</td>
  <td>&nbsp;</td>
</tr> 
```

要使用字符串定位节点，**`&nbsp;`**您可以使用以下任一基于[xpath](/questions/tagged/xpath "显示标记为“xpath”的问题")的解决方案：

*   使用`text()`：

    ```
    "//td[text()='\u00A0']" 
    ```

*   使用`contains()`：

    ```
    "//td[contains(., '\u00A0')]" 
    ```

* * *

但是，理想情况下，您可能希望避免使用*NO-BREAK SPACE*字符并使用以下任一[定位器策略](https://stackoverflow.com/questions/48369043/official-locator-strategies-for-the-webdriver/48376890#48376890)：

*   使用父`<tr>`节点和`following-sibling`：

    ```
    "//tr//following-sibling::td[2]" 
    ```

*   使用`starts-with()`：

    ```
    "//tr//td[last()]" 
    ```

*   使用前面的`<td>`节点和`following``node and`后面的兄弟节点：

    ```
    "//td[text()='abc']//following::td[1]" 
    ```

* * *

## 参考

您可以在以下位置找到相关的详细讨论：

*   [如何`&nbsp;`使用 Selenium查找包含的元素](https://stackoverflow.com/questions/59624749/how-to-find-an-element-which-contains-nbsp-using-selenium/59625175#59625175)

* * *

## tl; 博士

[Unicode 字符 'NO-BREAK SPACE' (U+00A0)](http://www.fileformat.info/info/unicode/char/00a0/index.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T19:27:59.310

请记住，在评估 XPath 表达式时，符合标准的 XML 处理器将用目标编码中的相应字符替换除 XML 的五个标准引用（ `&amp;`、`&gt;`、`&lt;`、`&apos;`、 ）之外的任何实体引用。`&quot;`鉴于这种行为，如果您想使用 XML 工具，PhiLho 和 jsulak 的建议是您的最佳选择。在输入`&#160;`XPath 表达式时，应先将其转换为相应的字节序列，然后再应用 XPath 表达式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T15:05:47.453

搜索`&nbsp;`或仅搜索`nbsp`- 您尝试过吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T17:12:35.933

我无法使用 Xpather 获得匹配，但以下内容适用于 Microsoft 的 XML 记事本中的纯 XML 和 XSL 文件：

```
<xsl:value-of select="count(//td[text()='&nbsp;'])" /> 
```

返回的值为 1，这是我的测试用例中的正确值。

但是，我确实必须使用以下命令在我的 XML 和 XSL 中将**nbsp**声明为一个实体：

```
<!DOCTYPE xsl:stylesheet [ <!ENTITY nbsp "&#160;"> ]> 
```

我不确定这是否对您有帮助，但我*实际上*能够使用 XPath 表达式找到**nbsp 。**

编辑：我的代码示例实际上包含字符**' '** 但是 JavaScript 语法高亮将其转换为空格字符。不要被误导！

# c# - 在 C# 中匹配 FORTRAN 舍入

> ID：247143
> 
> 赞同：1
> 
> 时间：2008-10-29T15:01:40.223
> 
> 标签：c#, fortran, rounding, truncation

FORTRAN 提供了几个函数来将双精度数转换为整数值。用于截断/舍入的方法不同。我正在转换使用这些的复杂科学算法。

根据 FORTRAN 文档：
**aint(x)**返回 x 和 0 之间的整数值，最接近 x。
**anint(x)**返回最接近 x 的整数值，除非中途情况舍入到幅度较大的整数值。
**nint(x)**将 x 转换为 int 格式，舍入到最接近的 int 值，除非中途情况舍入到幅度较大的 int 值。

**有没有人在 C# 中实现了这些？** 把它做好可能会很棘手。

(int)x 似乎匹配 aint()
Convert.ToInt32(x) 不匹配上述任何一个。
Trunc(x) 与上述任何一个都不匹配。
Round(x) 可能匹配 anint 或 nint。

anint 和 nint 的区别似乎在于返回类型，其中 anint 返回一个双精度值，但 nint 返回一个整数。两者都被使用（实际样本）：
双精度 A、B、C、D、E、F、G
... 此处设置的值 ...
F = ANINT(AB) + ANINT(CD) + ANINT(B+DE)
G = NINT(F) + 1D0；
也许 FORTRAN 专家可以帮助澄清为什么作者选择使用两者（我假设这是故意的）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T15:08:59.973

根据您对调用的定义，**`nint`**并**`anint`**使用.`Math.Round``MidpointRounding.AwayFromZero`

对于，从to**`aint`**的显式转换将实现该结果。`double``int`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T15:12:12.370

从我所见，`aint()`只是`Math.Floor()`。

对于另外两个，我认为你是对的，唯一的区别是返回类型：`nint()`返回一个实际的整数，而`anint()`返回一个恰好具有整数值的 double (fortran: real)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-02T13:26:15.420

我有一个函数 anint 的实现，按照代码：

```
double anint(double x)
{
    int a;
    double y;

    a = (int)x; //a=9

    if (10 * x - 10 * (double)a >= 5)
    {
        a = a + 1;
    }

    y = (double)a;

    return y;
} 
```

# firefox - 从 Firefox 插件调用 COM 对象

> ID：247148
> 
> 赞同：0
> 
> 时间：2008-10-29T15:03:18.643
> 
> 标签：firefox, com

我即将承担一个需要 Firefox 插件来调用安装在客户端 Windows 机器上的 COM dll 的项目，我很难估计这项工作的复杂性。

我对 COM 有相当多的经验，所以我并不害怕它。我对 Firefox 插件的经验较少，但我认为这不是我的问题所在。

有没有人做过类似的事情？

Firefox 是否允许其插件与外界自由交流？

是否有某个插件或示例代码可以做这样的事情（谷歌发现很少有用的结果）？

**更新：**当然，如果可能的话，我更喜欢不需要在 C++ 中构建扩展的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T15:13:30.167

像往常一样在 C++ 中创建一个[XPCOM](http://www.mozilla.org/projects/xpcom/)来与您的 COM 对象对话。XPCOM 扩展随后可用于 Javascript 来完成扩展的其余部分（我猜主要是 GUI）。但是，这就是我对它的全部了解:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T15:32:30.333

您可能对开源的[IE Tab扩展感兴趣。](http://ietab.mozdev.org/ "IE 选项卡")我没看过，但我猜它确实 Com 访问使用 IE 的显示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T19:18:14.780

如果你这样做，你几乎肯定需要使用 XPCOM。看看 Shanti Rao 的[JSDB](http://www.jsdb.org)，它在 Javascript 中支持 COM/ActiveX。ActiveX 内容位于名为 wrap_com.cpp 的文件中。它支持大多数 IDispatch 接口；IDispatch 的 Invoke 方法是使这项工作发挥作用的魔力。

这有多复杂取决于您希望它从 Javascript 中获得的“简单”程度。如果您实现了一个名为 IDispatchObject 的 XPCOM 东西，您必须在其中传入方法名称和参数数组，那么它可能不会太难。如果您想创建一个通用方法来动态绑定到 COM 对象并直接引用它们，那就更难了……不确定 JSDB 中使用的技术是否会延续到 XPCOM。

# php - 使用多态性和工厂模式去除重复条件

> ID：247149
> 
> 赞同：0
> 
> 时间：2008-10-29T15:03:34.977
> 
> 标签：php, oop, design-patterns, inheritance, refactoring

```
<?php
/**
 * My codebase is littered with the same conditionals over and over
 * again.  I'm trying to refactor using inheritance and the Factory
 * pattern and I've had some success but I'm now stuck.
 *
 * I'm stuck because I want to derive a new class from the one
 * returned by the Factory.  But I can't do that, so I'm obviously
 * doing something wrong somewhere else.
 */

/**
 * The old implementation was as follows.  There's if statements
 * everywhere throughout both LayoutView and ItemIndexView and
 * SomeOtherView.
 */
class LayoutView { }
class IndexView extends LayoutView { }
class SomeOtherView extends LayoutView { }

/**
 * Below is the new implementation.  So far I've managed to tidy
 * up LayoutView (I think I have anyway).  But now I'm stuck because
 * the way I've tidied it up has left me not knowing how to extend
 * it.
 *
 * For example's sake, let's say the conditions were relating to a
 * type of fish: salmon or tuna.
 */
abstract class LayoutView {
    protected function prepareHeader() { echo __METHOD__, "\n"; }
    protected function prepareLeftHandSide() { echo __METHOD__, "\n"; }
    protected function prepareFooter() { echo __METHOD__, "\n"; }
    public function prepare() {
        $this->prepareHeader();
        $this->prepareLeftHandSide();
        $this->prepareFooter();
    }
}

class SalmonLayoutView extends LayoutView
{
    protected function prepareLeftHandSide() { echo __METHOD__, "\n"; }
}

class TunaLayoutView extends LayoutView
{
    protected function prepareLeftHandSide() { echo __METHOD__, "\n"; }
    protected function prepareFooter() { echo __METHOD__, "\n"; }
}

class ViewFactory {
    public static function getLayoutView($fishType) {
        switch($this->$fishType) {
        case 'salmon':
            return new SalmonLayoutView();
            break;
        case 'tuna':
            return new TunaLayoutView();
            break;
        }
    }
}

/**
 * Now LayoutView has been cleaned up and the condition that was once
 * scattered through every LayoutView method is now in one place.
 */
$view = ViewFactory::getLayoutView( Config::getOption('fishtype') );
$view->prepare();

/**
 * Now here's where I'm stuck.  I want to effectively extend whatever
 * class $view is an instance of.
 *
 * The reason being, I wish to derive a view to show an index of
 * articles within the appropriate *LayoutView.  The IndexView code is
 * the same for Salmon and Tuna.
 *
 * I can do something like this:
 */

class SalmonIndexView extends SalmonLayoutView { }
class TunaIndexView extends TunaLayoutView { }

/**
 * But then I'll be writing the same IndexView code twice.  What I'd
 * like to do is something like this:
 */

$view = ViewFactory::getLayoutView( Config::getOption('fishtype') );
class IndexView extends get_class($view) { }

/**
 * But I'm pretty certain that's not possible, and even if it was
 * it seems very wrong.
 *
 * Can someone more experienced in refactoring and OO please let
 * me know where I've gone wrong and suggest a clean way to solve
 * this?
 */ 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T15:09:31.890

如果 IndexView 代码确实相同，那么您不需要继承，而是需要组合。在您的基本 LayoutView 类中添加一个 IndexView 实例，然后您就可以从每个 *LayoutView 调用它。

只有当对象之间的关系是 is-a 时，继承才到期。我推断IndexView不是LayoutView，而是LayoutView有IndexView。

看看这个，我不同意它所说的一切，但仍然： http: [//phpimpact.wordpress.com/2008/09/04/favour-object-composition-over-class-inheritance/](http://phpimpact.wordpress.com/2008/09/04/favour-object-composition-over-class-inheritance/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T08:47:18.760

只需将模板作为参数传递给您将编写的子视图。在这种情况下，我认为这不会是邪恶的。虽然如果它是一个标准框架，您最好在他们的论坛中询问，因为他们可能具有我们不知道的功能（通常会发生）

你可以有类似的东西

```
class LayoutView {
    protected View $subview; //Potentially an array of views
    public function prepare() {
        // empty, to be filled out by derived classes
    }
    public function setSubView($view) { $this->subview = $view; }
    public function display() {
        $this->prepare();
        $this->subview->prepare($this->template);
        $this->template->render();
    }
}

class IndexView {
    protected View $subview; //Potentially an array of views
    public function prepare() {
        // empty, to be filled out by derived classes
    }
    public function prepare($template) {
       //operate on it, maybe even assigning it to $this->template
    }
    public function setSubView($view) { $this->subview = $view; }
    public function display() {
        $this->prepare();
        $this->subview->prepare($this->template);
        $this->template->render();
    }
} 
```

# php - 如何检查是否在全局 PHP.INI 或我的 PHP 脚本中启用了 ini_set()？

> ID：247152
> 
> 赞同：4
> 
> 时间：2008-10-29T15:04:21.840
> 
> 标签：php, ini-set

我有一个安装失败的应用程序。供应商说我可能禁用了 ini_set()。我怎样才能检查这个？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T19:58:36.410

我对此做了一些研究，结果发现有时 ini_set 不会返回 FALSE，而是一个空字符串。gabriel1836指出的URL中提到了这一点。检查它是否有效的最好方法是首先检查 php.ini 中的 disable_functions 标志，看看它是否被禁用，然后（如果它没有被禁用），用它更改一个值，然后立即回显 phpinfo()。如果在本地列下更改了值，那么您知道 ini_set 有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T15:22:24.767

你可能想看看 php.ini 中的 CHANGEABLE 指令： [http://us3.php.net/manual/en/ini.php#ini.list](http://us3.php.net/manual/en/ini.php#ini.list)

关于验证 ini_set 函数是否有效，您可以检查返回值以确保它有效： [http://us3.php.net/manual/en/function.ini-set.php](http://us3.php.net/manual/en/function.ini-set.php)

代码看起来像这样：

```
<?php
     if(ini_set('error_reporting', 'ALL') === false)
     {
         // Perform failure handling logic
     }
?> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T15:58:07.067

您可以检查`disable_functions`php.ini 文件中的设置。这几乎是我唯一能想到的。不过，我怀疑它会被设置，除非你在共享主机或类似的东西上运行。

您可能还想检查是否使用`php_admin_flag`或`php_admin_value`在您的 Apache 配置中指定了相关设置，因为这些设置将有效地“锁定”设置并阻止`ini_set()`更改它。

# .net - 将自定义 ContextMenuStrip 与 DataGridView 中的系统编辑上下文菜单合并

> ID：247154
> 
> 赞同：1
> 
> 时间：2008-10-29T15:04:45.397
> 
> 标签：.net, vb.net, datagridview

我在 VB.NET 应用程序中有一个 DataGridView，我仅限于单元格选择。该控件有两列，第一列不可编辑，第二列可编辑。我有一个 ContextMenuStrip，它提供了一些额外的功能，并且当可编辑单元格收到右键单击且未处于编辑模式时，我能够使其出现。基于[Microsoft 论坛](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3745757&SiteID=1)中的示例，我现在可以在可编辑单元格在编辑模式下收到右键单击时显示上下文菜单。该代码如下：

```
Private Sub DataGridView1_EditingControlShowing(ByVal sender As System.Object, ByVal e As System.Windows.Forms.DataGridViewEditingControlShowingEventArgs) Handles DataGridView1.EditingControlShowing
    If TypeOf e.Control Is TextBox Then
        With DirectCast(e.Control, TextBox)
            .ContextMenuStrip = ContextMenuStrip1
        End With
    End If
End Sub 
```

但是，这会完全覆盖编辑控件的系统上下文菜单。如何将我的上下文菜单条 ( `ContextMenuStrip1`) 与系统上下文菜单合并？

有关更多信息，我使用的是 VS2008，但目标是 .NET 2.0 平台。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-30T15:42:19.140

为了短期简单起见，我所做的是创建一个新的上下文菜单，其中包含与现有系统提供的上下文菜单相似的菜单项以及我额外需要的菜单项。Textbox 控件包含每个菜单项最初提供的功能，因此我只需在每个菜单项的事件处理程序中进行必要的调用。

这种方法的问题在于，如果 Microsoft 将来更改系统提供的菜单，我将不得不添加更多菜单项、更多事件处理程序和更多禁用/启用代码。从长远来看，最好找到上下文菜单的句柄并合并到我的自定义菜单项中。

# c# - 这两个 GetLargestValue C# 实现中哪一个更好，为什么？

> ID：247156
> 
> 赞同：5
> 
> 时间：2008-10-29T15:05:31.370
> 
> 标签：c#, .net, .net-2.0

对于如何最好地实现一个简单的方法，该方法采用整数数组并返回最高整数（使用 C# 2.0），我与某人存在分歧。

以下是两个实现 - 我有自己的看法，哪个更好，为什么，但我会很感激任何公正的意见。

**选项 A**

```
public int GetLargestValue(int[] values)
{
   try  {
          Array.Sort(values);
          return values[values.Length - 1];
        }
   catch (Exception){ return -1;}
} 
```

**选项 B**

```
public int GetLargestValue(int[] values)
{
    if(values == null)
        return -1;

    if(values.Length < 1)
        return -1;

    int highestValue = values[0];

    foreach(int value in values)
        if(value > highestValue)
            highestValue = value;

    return highestValue;
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-29T15:12:04.553

当然是选项 B。

A 很丑：

*   Catch(Exception) 是一个非常糟糕的做法

*   你不应该依赖 null ref 的异常，超出范围，......

*   排序比迭代复杂得多

复杂性：

*   在最坏的情况下，A 将是 O(n log(n)) 甚至是 O(n²)

*   B 最坏情况是 O(n)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-29T15:15:51.363

A 具有对数组进行排序的副作用。这可能是调用者意想不到的。

编辑：我不喜欢为空或空数组（在两种解决方案中）返回 -1，因为 -1 可能是数组中的合法值。这应该真的产生一个异常（也许`ArgumentException`）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-29T15:08:49.600

我更喜欢**选项 B**，因为它只遍历集合一次。

在**选项 A**中，您可能必须多次访问许多元素（次数取决于排序算法的实现）。

**选项 A**是一个低效的实现，但会产生一个相当清晰的算法。然而，它确实使用了一个相当丑陋的异常捕获，只有在传入一个空数组时才会触发它（因此可以通过预排序检查更清楚地编写）。

PS，你永远不应该简单地捕捉“异常”然后纠正事情。有许多类型的异常，通常您应该捕获每一种可能的异常并相应地处理。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-29T15:11:05.447

第二个更好。第一个的复杂性是`O(N LogN)`，第二个是`O(N)`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T15:11:20.657

我必须选择选项 B - 并不是说​​它是完美的，而是因为选项 A 使用异常来表示逻辑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T15:12:19.000

我会说这取决于你的目标是什么，速度或可读性。

如果处理速度是您的目标，我会说第二个解决方案，但如果可读性是目标，我会选择第一个。

对于这种类型的功能，我可能会追求速度，所以我会选择第二个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T15:12:47.500

这里有很多因素需要考虑。这两个选项都应包括选项 B 中的边界检查，并以这种方式取消使用异常处理。第二个选项在大多数情况下应该执行得更好，因为它只需要遍历数组一次。但是，如果数据已经排序或需要排序；那么选项A会更可取。

没有排序算法在*n*时间内执行，所以选项 B 平均来说是最快的。

编辑：[关于排序的文章](http://linux.wku.edu/~lamonml/algor/sort/sort.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T15:14:06.187

我在这里看到两点：

1.  参数测试而不是异常处理：更好地使用显式检查，也应该更快。
2.  排序并选择最大值，而不是遍历整个数组。由于排序涉及*至少处理数组中的每个整数一次*，因此它的性能不如（仅）遍历整个数组一次。

哪个更好？对于第一点，绝对是明确的检查。第二，这取决于...

第一个示例更短，可以更快地编写和阅读/理解。第二个更快。所以：如果运行时效率是一个问题，请选择第二个选项。如果快速编码是您的目标，请使用第一个。

# java - java - 如何在java中将String转换为InputStreamReader？

> ID：247161
> 
> 赞同：288
> 
> 时间：2008-10-29T15:06:37.077
> 
> 标签：java, string, stream

如何将`String`值转换为`InputStreamReader`？

* * *

## 回答 #1

> 赞同：333
> 
> 时间：2008-10-29T15:12:11.277

[ByteArrayInputStream](http://docs.oracle.com/javase/7/docs/api/java/io/ByteArrayInputStream.html)也可以做到这一点：

```
InputStream is = new ByteArrayInputStream( myString.getBytes( charset ) ); 
```

然后转换为阅读器：

```
InputStreamReader reader = new InputStreamReader(is); 
```

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-10-29T15:52:59.777

我还找到了 apache commons`IOUtils`类，所以：

```
InputStreamReader isr = new InputStreamReader(IOUtils.toInputStream(myString)); 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-10-29T15:08:33.907

它必须是专门的 InputStreamReader 吗？使用[StringReader](http://java.sun.com/javase/6/docs/api/java/io/StringReader.html)怎么样？

否则，您可以使用[StringBufferInputStream](http://java.sun.com/javase/6/docs/api/java/io/StringBufferInputStream.html)，但由于字符转换问题（这就是您应该更喜欢 StringReader 的原因），它已被弃用。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-29T15:13:20.167

[与@Dan](https://stackoverflow.com/questions/247161/how-do-i-turn-a-string-into-a-stream-in-java#247169)相同的问题- 为什么不是 StringReader ？

如果它必须是 InputStreamReader，那么：

```
String charset = ...; // your charset
byte[] bytes = string.getBytes(charset);
ByteArrayInputStream bais = new ByteArrayInputStream(bytes);
InputStreamReader isr = new InputStreamReader(bais); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-01-12T17:21:53.533

您是要从 a) 中获取`Reader`功能`InputStreamReader`，还是从 b)中获取`InputStream`功能`InputStreamReader`？你不会得到 b)。 `InputStreamReader`不是一个`InputStream`。

的目的`InputStreamReader`是获取一个`InputStream`- 字节源 - 并将字节解码为`Reader`. 您已经将数据作为字符（您的原始字符串）。将您的字符串编码为字节并将字节解码回字符将是一个冗余操作。

如果您想`Reader`从源代码中获取信息，请使用`StringReader`.

如果您正在尝试获取一个`InputStream`（仅给您字节），请`IOUtils.toInputStream(..)`按照此处其他答案的建议使用 apache commons。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-08-27T12:56:09.110

你可以试试[Cactoos](http://www.cactoos.org)：

```
InputStream stream = new InputStreamOf(str); 
```

然后，如果您需要`Reader`：

```
Reader reader = new ReaderOf(stream); 
```

# regex - 正则表达式中的异或

> ID：247167
> 
> 赞同：33
> 
> 时间：2008-10-29T15:07:31.863
> 
> 标签：regex, xor

寻找一些正则表达式帮助。我想设计一个表达式来匹配带有“ *foo* ”或“ *bar* ”的字符串，但不能同时匹配“ *foo* ”和“ *bar* ”

如果我做类似...

```
/((foo)|(bar))/ 
```

它将匹配“ *foobar* ”。不是我要找的。那么，如何仅在存在一个术语或另一个术语时才使正则表达式匹配？

谢谢！

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2011-12-02T19:57:57.510

这就是我使用的：

```
/^(foo|bar){1}$/ 
```

见：[http](http://www.regular-expressions.info/quickstart.html) ://www.regular-expressions.info/quickstart.html下重复

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-29T16:32:06.000

如果您的正则表达式语言支持它，请使用[否定环视](http://www.regular-expressions.info/lookaround.html)：

```
(?<!foo|bar)(foo|bar)(?!foo|bar) 
```

这将匹配“foo”或“bar”之前或之后没有紧跟“foo”或“bar”的“foo”或“bar”，我认为这是你想要的。

从您的问题或示例中不清楚您尝试匹配的字符串是否可以包含其他标记：“foocuzbar”。如果是这样，这种模式将不起作用。

以下是您的测试用例的结果（“真”表示在输入中找到模式）：

```
foo: true
bar: true
foofoo: false
barfoo: false
foobarfoo: false
barbar: false
barfoofoo: false 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-29T15:11:08.923

您可以使用单个正则表达式来执行此操作，但为了便于阅读，我建议您执行类似...

```
(/foo/ and not /bar/) || (/bar/ and not /foo/) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-09-09T10:46:41.427

这将需要 'foo' 和 'bar' 但不是 'foobar' 而不是 'blafoo' 而不是 'blabar'：

```
/^(foo|bar)$/

^ = mark start of string (or line)
$ = mark end of string (or line) 
```

这将需要 'foo' 和 'bar' 和 'foo bar' 和 'bar-foo' 但不是 'foobar' 而不是 'blafoo' 而不是 'blabar'：

```
/\b(foo|bar)\b/

\b = mark word boundry 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-29T16:59:24.430

除了“foo”和“bar”之外，您还没有指定关于内容的行为，或者在另一个不存在的情况下重复一个。例如，“ **foo** d”或“ **barbar** ian”应该匹配吗？

假设您要匹配的字符串仅包含“foo”或“bar”的一个实例，但不能同时包含同一实例的多个实例，而不考虑字符串中的其他任何内容（即“food”匹配和“野蛮人”不匹配），那么您可以使用正则表达式返回找到的匹配数，并且仅在找到一个匹配时才认为它成功。例如，在 Perl 中：

```
@matches = ($value =~ /(foo|bar)/g)  # @matches now hold all foos or bars present
if (scalar @matches == 1) {          # exactly one match found
  ...
} 
```

如果允许同一目标的多次重复（即“野蛮人”匹配），则可以使用相同的通用方法，然后遍历匹配列表以查看匹配是否都是相同文本的重复，或者是否其他选项也存在。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-29T15:56:11.733

您可能要考虑 ? 条件测试。

```
(?(?=regex)then|else) 
```

[正则表达式条件](http://www.regular-expressions.info/conditional.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-29T17:59:56.477

如果你想要一个真正的独占或者，我会在代码中而不是在正则表达式中这样做。在 Perl 中：

```
/foo/ xor /bar/ 
```

但是你的评论：

> 匹配项：“foo”、“bar” 不匹配项：“foofoo”“barfoo”“foobarfoo”“barbar”“barfoofoo”

表示您并不是真的在寻找独占或。您实际上的意思是“`/foo|bar/`仅匹配一次吗？”

```
my $matches = 0;
while (/foo|bar/g) {
  last if ++$matches > 1;
}

my $ok = ($matches == 1) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-07-06T03:19:58.313

我知道这是一个迟到的条目，但只是为了帮助其他可能正在寻找的人：

```
(/b(?:(?:(?!foo)bar)|(?:(?!bar)foo))/b) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T15:15:55.717

我会用这样的东西。它只是检查单词周围的空格，但如果你使用 . ，你可以使用`\b`or`\B`来检查边框`\w`。这将匹配“foo”或“bar”，所以显然你也必须替换空格，以防万一。（假设您要更换任何东西。）

```
/\s((foo)|(bar))\s/ 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-29T15:23:32.067

我认为这不能用一个正则表达式来完成。边界可能会或可能不会起作用，具体取决于您匹配的内容。

我会分别匹配每个正则表达式，并对结果进行异或。

```
foo = re.search("foo", str) != None
bar = re.search("bar", str) != None
if foo ^ bar:
    # do someting... 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-29T15:27:36.690

我尝试与 Regex Coach 对抗：

```
x foo y
x bar y
x foobar y 
```

如果我检查该`g`选项，它确实匹配所有三个单词，因为它在每次匹配后再次搜索。
如果您不想要这种行为，您可以锚定表达式，例如仅在单词边界上匹配：

```
\b(foo|bar)\b 
```

提供更多关于问题的背景信息（数据是什么样的）可能会给出更好的答案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-29T15:41:23.433

```
\b(foo)\b|\b(bar)\b 
```

并且只使用第一个[捕获组](http://www.regular-expressions.info/brackets.html)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-29T16:44:27.910

使用单词边界，您可以获得单个单词...

```
me@home ~  
$ echo "Where is my bar of soap?" | egrep "\bfoo\b|\bbar\b"  
Where is my bar of soap?  

me@home ~  
$ echo "What the foo happened here?" | egrep "\bfoo\b|\bbar\b"  
What the foo happened here?  

me@home ~  
$ echo "Boy, that sure is foobar\!" | egrep "\bfoo\b|\bbar\b" 
```

# geolocation - 是否有从 Thomas Bros 地图页面和网格转换为纬度/经度的公式？

> ID：247174
> 
> 赞同：4
> 
> 时间：2008-10-29T15:10:44.400
> 
> 标签：geolocation, gis, geocoding

我正在开发一个包含 Thomas Brothers 地图页面和网格编号的项目。有没有办法以编程方式将此地图页面转换为纬度和经度？

例如 US101 和 I405 高速公路的交叉口。

ThomasBrothers：561-3G（页面网格）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T15:21:02.600

不是我知道的，但我对 Thomas bros 地图没有太多经验。您是在谈论地图的印刷版，还是在某处有指向在线地图的链接？

如果您只需要一些纬度/经度，那么您可以在许多网站上查找与网格对应的位置并手动获取经度和经度，包括[http://itouchmap.com/latlong.html](http://itouchmap.com/latlong.html)

如果您提供指向您正在使用的 Thomas bros 地图的链接，我可能会提供进一步的帮助。

通过查看上面的链接，您可以确定 US 101 和 I-405 的纬度为 34.16073390017978，经度为 -118.46952438354492。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T15:49:13.340

您最好的来源是地图出版商。如果他们选择提供帮助，那里的人可以准确地告诉您您需要知道的内容。如果他们不帮助您，他们不太可能将信息发布给其他任何人。

如果是这种情况，您可以手动做一些工作，将地图网格中的一个点关联到您的目标坐标系。实际上，您可以对每个页面的映射[“数据”](http://en.wikipedia.org/wiki/Map_datum#Datum)进行逆向工程。您还必须知道使用什么地图投影来渲染地图，以便在远离“原点”时计算从地图坐标到地理坐标的转换。最后，您需要确定地图的方向，因为存在不同的“北”概念。

听起来托马斯地图对每一页都使用了一个新的网格，而不是从一页到另一页不断地填充网格。如果是这种情况，您必须在每张地图上关联一个点。例如，查找地图网格交叉点与著名的道路交叉点重合的位置。然后，您可以使用带有经纬度的地图（地形图、[TerraServer](http://terraserver-usa.com/)等）找到道路交叉口的坐标。使用同一垂直网格线上的两个点执行此操作也可以帮助您确定地图上使用的北方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-02T01:17:15.867

简短的回答是，九个区域中的每一个都有一个从带有自定义参数的 Lambert 等角圆锥投影派生的网格，因此您无法编写没有参数的转换程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-03T05:45:15.027

我也有 ThomasBros。我想转换为 lat/long 以查找 Google Maps API 的页面。他们还提供了一些叫做 TBXY 的东西……不确定这是什么——也许是 GPS/lat/long 的一些符号？

```
<Area>"El Cajon"</Area>
<ThomasBrothers>"1297 5E"</ThomasBrothers>
<TBXY>"6481390:1827008"</TBXY> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-23T07:14:00.263

Thomas Brothers Maps 在开发他们的 GIS 系统以创建他们的数字地图系统时投入了大量资金。尽管第一张“数字制作”的地图是 Sacramento County-1990，但开发始于 1986 年。我希望他们的地图投影方程是一个严密保护的商业机密，现在 Rand McNally 拥有。我不知道这些方程式，但也想知道它们。

有 9 个预测覆盖 48 个州。如果您知道洛杉矶的方程式，那么它在加利福尼亚和内华达州都有效。俄勒冈州和华盛顿州有自己的预测。亚利桑那州、新墨西哥州、科罗拉多州和犹他州共享另一个预测。

这个我知道...

众所周知，页面网格是 1/2 平方英里，或 2640 英尺乘 2640 英尺。坐标测量单位为 1 英尺。

要确定 Thomas Brothers XY 坐标，请获取一张或多张 Thomas Guide CD-ROM 地图，该地图最近已停产。最后为某些加利福尼亚县生产的是 2008 年版。西雅图、波特兰、拉斯维加斯和凤凰城/图森的最后一版是 2007 年版。每个仍然可以在 Rand McNally 网站上以 20 美元的价格购买。

当您对一组地址进行地理编码时，您将看到一个输出文件，其中包含您指定的地址的 TGXY 坐标和纬度/经度，以及该点所在的页码和网格。打开该文件后，您可以单击地图以添加其他地理编码点，这也将提供这两个坐标。输出文件保存在 Access 数据库“.mdb”文件中。

如果您对地图投影或立体几何有很多了解，那么对应的 TGXY 和纬度/经度坐标集将为您提供一些很好的测试数据。

正如您提到的圣地亚哥第 1297 页，我将提供其边界坐标。西 x=3062760 东 x=3086520 北 y=0985040 南-y=0966560

这不在您在 Google 上找到的“TBXY”范围内。也许它是相同的投影，具有重新定位的原点。

# .net - 通过重用一个 IFrame + Ajax 将多个外部网站加载到一个网页中

> ID：247200
> 
> 赞同：0
> 
> 时间：2008-10-29T15:15:10.600
> 
> 标签：.net, asp.net, ajax, asp.net-ajax

我正在尝试将多个外部网站嵌入到一个网页中。使用 IFRAME 可以，但是一旦超过 10 个嵌入式 iframe，内存指纹就会开始变得太大。

所以我在想，是否有可能通过 ajax/javascript，重新使用同一个 iframe 一个接一个地加载网站集合，并将结果显示在主网页上的 div 中？还是出于安全原因明确阻止？

编辑：我不想走屏幕抓取路线，因为我打算把它变成一个半公开的网站，我不想在我的服务器上占用所有带宽，而宁愿在客户端上完成，如果可能的话。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T15:19:33.150

你正试图用锤子把螺丝钉在墙上。也许有些人会去，但不会很漂亮。您最好的选择是屏幕抓取工具或网络服务，以便从外部站点检索数据。也许包括有关情况的更多详细信息，例如您自己的外部站点。他们是否提供您所追求的内容联合。您是否可以使用离线服务，以便您可以使用这些内容？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T19:10:44.197

我同意 Ty 关于屏幕抓取方向的看法。您可以使用 weblient 对象 - 它有一个 DownloadString() 方法，该方法从特定 url 获取 HTML 字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-09T20:52:13.610

如果您担心服务器上的带宽，您可以进行屏幕抓取（基本上通过 http 请求拉下 html）然后将其存储在 .net 缓存中吗？即使您将每个站点的 html 存储在缓存中 15 分钟，您也只能每小时提取 4 次该信息。您仍然需要将该 html 推送到客户端，但您至少可以在发送之前使用 gzip 对其进行压缩。

# telerik - Telerik RadEditor 在 HTML 视图中查找和替换

> ID：247204
> 
> 赞同：0
> 
> 时间：2008-10-29T15:17:58.490
> 
> 标签：telerik, replace

我们使用 Telerik 的 RadEditor 作为我们内容管理系统的所见即所得编辑器。我们需要 WYSIWYG 编辑器中的查找和替换功能也可以在 HTML 编辑器中。编辑器非常可定制，有人知道是否有办法启用或破解它吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-09T13:04:23.340

您正在寻找的内容没有内置功能。但是使用客户端 API 和一些 javascript，您可以连接您自己的按钮，使用`editor.get_html()`and`editor.set_html()`函数进行查找和替换。然后您可以考虑使用一些 RegEx 或只是一个简单的 javascript .replace() 来进行查找和替换？

您可以[在 Telerik 网站上找到 RadEditor 文档。](http://www.telerik.com/help/aspnet-ajax/editor-getting-familiar-with-client-side-api.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T15:26:32.870

在他们的演示站点上有一个[RadEditor ASP.NET Ajax 示例](http://demos.telerik.com/ASPNET/Prometheus/Editor/Examples/ClientsideAPI/DefaultCS.aspx)。

只需单击工具栏的第三个按钮即可测试“查找和替换”。

也看看[这个示例页面](http://demos.telerik.com/ASPNET/Prometheus/Editor/Examples/XhtmlValidatorTrackChangesFormatCodeBlockDialogs/DefaultCS.aspx)。

它定义了这个工具栏

```
...  
<telerik:EditorSeparator />
<telerik:editortool name="FindAndReplace" />
<telerik:editortool name="TableWizard" />
<telerik:editortool name="LinkManager" />
<telerik:editortool name="PageProperties" />
<telerik:EditorSeparator />
... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-28T11:37:52.750

当编辑器处于 HTML 模式时，内容区域是一个简单的 <textarea> 元素。我认为按照设计，编辑器工具栏上的所有工具都在 HTML 模式下被禁用，因此您需要编写一些自定义 JavaScript 代码来实现查找和替换。您可以使用*editor.get_textArea()*获取对文本框的引用。从那里开始变得困难，因为我认为仅在 IE (selection.findText) 中支持在文本区域中搜索文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-29T11:18:12.383

自 2010 年第二季度以来，在 Internet Explorer 中的 RadEditor 的 HTML 模式中启用了查找和替换按钮。由于浏览器的限制，Firefox 仍然不支持此功能。

[http://demos.telerik.com/aspnet-ajax/editor/examples/default/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/editor/examples/default/defaultcs.aspx)

# maven-2 - 作为 Maven 或 ANT 构建的一部分，如何将 DTD 转换为 Schema？

> ID：247207
> 
> 赞同：2
> 
> 时间：2008-10-29T15:19:18.877
> 
> 标签：maven-2, ant, schema, dtd

作为 Maven 构建的一部分，如何将 DTD 转换为 Schema？

具体来说，我正在寻找一个 Maven 插件，我可以向其提供 DTD 的 URL，它将生成一个 XML 模式定义文件。

没有一个好的 Maven 插件，也许我可以在我的 Maven 构建中嵌入一个 ANT 任务

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T16:55:00.003

我不知道任何用于自动将 DTD 转换为 Schema 的 Maven 插件。我对你的建议是不要去那里。

DTD 和 XSD 之间有很多区别，恕我直言，最重要的区别是： * XSD 具有命名空间定义 - 您将无法以自动方式获得其中的大部分内容。* XSD 有一个类型系统。

我的建议是手动进行转换操作，这样您就可以定义您的命名空间并考虑您的类型系统。手术完成后，它们的寿命都会很长;-)

# javascript - 普遍接受的 JavaScript 代码组织最佳实践

> ID：247209
> 
> 赞同：568
> 
> 时间：2008-10-29T15:19:32.293
> 
> 标签：javascript, jquery, design-patterns, architecture, formatting

随着像 jQuery 这样的 JavaScript 框架使客户端 Web 应用程序更丰富、更实用，我开始注意到一个问题......

**你到底是如何保持这种组织的？**

*   将所有处理程序放在一个位置并为所有事件编写函数？
*   创建函数/类来包装您的所有功能？
*   写得像疯了似的，只是希望它能取得最好的效果？
*   放弃并获得新的职业？

我提到了 jQuery，但它实际上是任何一般的 JavaScript 代码。我发现随着一行行开始堆积起来，管理脚本文件或找到您要查找的内容变得越来越困难。很可能我发现的最大问题是有很多方法可以做同样的事情，很难知道哪一种是当前普遍接受的最佳实践。

对于让**.js**文件与应用程序的其余部分一样美观和整洁的最佳方式，是否有任何一般性建议？或者这只是IDE的问题？那里有更好的选择吗？

* * *

**编辑**

这个问题更多地是关于代码组织而不是文件组织。有一些非常好的合并文件或拆分内容的例子。

我的问题是：目前普遍接受的组织实际代码的最佳实践方式是什么？与页面元素交互并创建彼此不冲突的可重用代码的方式是什么，甚至是推荐的方式？

有些人列出了**名称空间**，这是一个好主意。还有哪些其他方法，更具体地说是处理页面上的元素并保持代码的组织和整洁？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-29T16:09:25.967

如果 javascript 内置命名空间会更好，但我发现像 Dustin Diaz[在这里](http://www.dustindiaz.com/namespace-your-javascript/)描述的那样组织东西对我有很大帮助。

```
var DED = (function() {

    var private_var;

    function private_method()
    {
        // do stuff here
    }

    return {
        method_1 : function()
            {
                // do stuff here
            },
        method_2 : function()
            {
                // do stuff here
            }
    };
})(); 
```

我将不同的“命名空间”，有时是单独的类放在单独的文件中。通常我从一个文件开始，当一个类或命名空间变得足够大以保证它时，我将它分离到它自己的文件中。使用工具来组合所有文件以进行生产也是一个绝妙的主意。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2008-11-12T17:36:36.173

我尽量避免在 HTML 中包含任何 javascript。所有代码都封装在类中，每个类都在自己的文件中。对于开发，我有单独的 <script> 标签来包含每个 js 文件，但它们被合并到一个更大的包中用于生产，以减少 HTTP 请求的开销。

通常，我将为每个应用程序创建一个“主”js 文件。所以，如果我正在编写一个“调查”应用程序，我将有一个名为“survey.js”的 js 文件。这将包含 jQuery 代码的入口点。我在实例化期间创建 jQuery 引用，然后将它们作为参数传递到我的对象中。这意味着 javascript 类是“纯的”并且不包含对 CSS id 或类名的任何引用。

```
// file: survey.js
$(document).ready(function() {
  var jS = $('#surveycontainer');
  var jB = $('#dimscreencontainer');
  var d = new DimScreen({container: jB});
  var s = new Survey({container: jS, DimScreen: d});
  s.show();
}); 
```

我还发现命名约定对于可读性很重要。例如：我在所有 jQuery 实例前面加上 'j'。

在上面的示例中，有一个名为 DimScreen 的类。（假设这会使屏幕变暗并弹出一个警告框。）它需要一个可以放大以覆盖屏幕的 div 元素，然后添加一个警告框，所以我传入一个 jQuery 对象。jQuery 有一个插件概念，但它似乎有局限性（例如实例不是持久的，无法访问），没有真正的好处。所以 DimScreen 类将是一个恰好使用 jQuery 的标准 javascript 类。

```
// file: dimscreen.js
function DimScreen(opts) { 
   this.jB = opts.container;
   // ...
}; // need the semi-colon for minimizing!

DimScreen.prototype.draw = function(msg) {
  var me = this;
  me.jB.addClass('fullscreen').append('<div>'+msg+'</div>');
  //...
}; 
```

我使用这种方法构建了一些相当复杂的应用程序。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-10-29T15:22:20.460

你可以将你的脚本分解成单独的文件进行开发，然后创建一个“发布”版本，你可以把它们塞在一起，然后在上面运行[YUI Compressor](http://developer.yahoo.com/yui/compressor/)或类似的东西。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-10-30T00:51:36.443

受早期帖子的启发，我制作了一份随[**WysiHat**](http://github.com/37signals/wysihat/tree/master) **（changelog 提到的 RTE）分发的Rakefile**和**供应商**目录的副本，并进行了一些修改，包括使用[**JSLint**](http://www.jslint.com/lint.html)进行代码检查和使用[**YUI Compressor**](http://developer.yahoo.com/yui/compressor/)进行压缩。[](http://github.com/37signals/wysihat/tree/master)**[](http://www.jslint.com/lint.html)**[](http://developer.yahoo.com/yui/compressor/)****

 ******这个想法是使用[**Sprockets**](http://github.com/sstephenson/sprockets/tree/master)（来自 WysiHat）将多个 JavaScript 合并到一个文件中，使用 JSLint 检查合并文件的语法，并在分发前使用 YUI Compressor 将其缩小。

**先决条件**

*   Java 运行时
*   红宝石和耙子宝石
*   您应该知道如何将 JAR 放入[Classpath](http://en.wikipedia.org/wiki/Classpath)

**现在做**

1.  下载[Rhino](http://www.mozilla.org/rhino/download.html)并将 JAR ("js.jar") 放到你的类路径中
2.  下载[YUI Compressor](http://www.julienlecomte.net/yuicompressor/)并将 JAR (build/yuicompressor-xyz.jar) 放到你的类路径中
3.  下载[WysiHat](http://github.com/37signals/wysihat/tree/master)并将“vendor”目录复制到 JavaScript 项目的根目录
4.  下载[JSLint for Rhino](http://www.jslint.com/rhino/index.html)并将其放在“vendor”目录中

现在在 JavaScript 项目的根目录中创建一个名为“Rakefile”的文件，并在其中添加以下内容：

```
require 'rake'

ROOT            = File.expand_path(File.dirname(__FILE__))
OUTPUT_MERGED   = "final.js"
OUTPUT_MINIFIED = "final.min.js"

task :default => :check

desc "Merges the JavaScript sources."
task :merge do
  require File.join(ROOT, "vendor", "sprockets")

  environment  = Sprockets::Environment.new(".")
  preprocessor = Sprockets::Preprocessor.new(environment)

  %w(main.js).each do |filename|
    pathname = environment.find(filename)
    preprocessor.require(pathname.source_file)
  end

  output = preprocessor.output_file
  File.open(File.join(ROOT, OUTPUT_MERGED), 'w') { |f| f.write(output) }
end

desc "Check the JavaScript source with JSLint."
task :check => [:merge] do
  jslint_path = File.join(ROOT, "vendor", "jslint.js")

  sh 'java', 'org.mozilla.javascript.tools.shell.Main',
    jslint_path, OUTPUT_MERGED
end

desc "Minifies the JavaScript source."
task :minify => [:merge] do
  sh 'java', 'com.yahoo.platform.yui.compressor.Bootstrap', '-v',
    OUTPUT_MERGED, '-o', OUTPUT_MINIFIED
end 
```

如果您正确完成了所有操作，您应该能够在控制台中使用以下命令：

*   `rake merge`-- 将不同的 JavaScript 文件合并为一个
*   `rake check`-- 检查代码的语法（这是**默认**任务，因此您只需键入`rake`）
*   `rake minify`-- 准备你的 JS 代码的缩小版

**关于源合并**

`require`使用 Sprockets，您可以包含（或）其他 JavaScript 文件的 JavaScript 预处理器。使用以下语法从初始文件（名为“main.js”，但您可以在 Rakefile 中更改）中包含其他脚本：

```
(function() {
//= require "subdir/jsfile.js"
//= require "anotherfile.js"

    // some code that depends on included files
    // note that all included files can be in the same private scope
})(); 
```

**接着...**

查看 WysiHat 提供的 Rakefile 来设置自动化单元测试。好东西 ：）

**现在来回答**

这并不能很好地回答原始问题。我知道并且对此感到抱歉，但我已将其发布在这里，因为我希望它可能对其他人有用，以组织他们的混乱。

我解决这个问题的方法是尽可能多地进行面向对象的建模，并将实现分离到不同的文件中。那么处理程序应该尽可能短。单例的例子`List`也很好。

和命名空间......好吧，它们可以被更深层次的对象结构所模仿。

```
if (typeof org === 'undefined') {
    var org = {};
}

if (!org.hasOwnProperty('example')) {
    org.example = {};
}

org.example.AnotherObject = function () {
    // constructor body
}; 
```

我不是模仿的忠实拥护者，但是如果您有许多想要移出全局范围的对象，这会很有帮助。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-10-02T12:26:10.403

代码组织需要采用约定和文档标准：
1\. 物理文件的命名空间代码；

```
Exc = {}; 
```

2\. 在这些命名空间 javascript 中分组类；
3.设置原型或相关函数或类来表示现实世界的对象；

```
Exc = {};
Exc.ui = {};
Exc.ui.maskedInput = function (mask) {
    this.mask = mask;
    ...
};
Exc.ui.domTips = function (dom, tips) {
    this.dom = gift;
    this.tips = tips;
    ...
}; 
```

4\. 设置约定以改进代码。例如，将其所有内部函数或方法分组到其对象类型的类属性中。

```
Exc.ui.domTips = function (dom, tips) {
    this.dom = gift;
    this.tips = tips;
    this.internal = {
        widthEstimates: function (tips) {
            ...
        }
        formatTips: function () {
            ...
        }
    };
    ...
}; 
```

5\. 制作命名空间、类、方法和变量的文档。必要时还要讨论一些代码（一些FIs和Fors，它们通常实现代码的重要逻辑）。

```
/**
  * Namespace <i> Example </i> created to group other namespaces of the "Example".  
  */
Exc = {};
/**
  * Namespace <i> ui </i> created with the aim of grouping namespaces user interface.
  */
Exc.ui = {};

/**
  * Class <i> maskdInput </i> used to add an input HTML formatting capabilities and validation of data and information.
  * @ Param {String} mask - mask validation of input data.
  */
Exc.ui.maskedInput = function (mask) {
    this.mask = mask;
    ...
};

/**
  * Class <i> domTips </i> used to add an HTML element the ability to present tips and information about its function or rule input etc..
  * @ Param {String} id - id of the HTML element.
  * @ Param {String} tips - tips on the element that will appear when the mouse is over the element whose identifier is id <i> </i>.
  */
  Exc.ui.domTips = function (id, tips) {
    this.domID = id;
    this.tips = tips;
    ...
}; 
```

这些只是一些提示，但这对组织代码有很大帮助。记住你必须有纪律才能成功！

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-12-22T21:16:09.980

遵循良好的 OO 设计原则和设计模式有助于使您的代码易于维护和理解。但我最近发现的最好的事情之一是信号和插槽，也就是发布/订阅。查看[http://markdotmeyer.blogspot.com/2008/09/jquery-publish-subscribe.html](http://markdotmeyer.blogspot.com/2008/09/jquery-publish-subscribe.html) 以获得简单的 jQuery 实现。

这个想法在其他语言中很好地用于 GUI 开发。当代码中某处发生重大事件时，您会发布一个全局合成事件，其他对象中的其他方法可能会订阅该事件。这可以很好地分离物体。

我认为 Dojo（和 Prototype？）有这种技术的内置版本。

另请参阅[什么是信号和插槽？](https://stackoverflow.com/questions/312895/signals-and-slots)

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-11-06T22:51:21.733

在我之前的工作中，我能够成功地将[Javascript 模块模式](http://yuiblog.com/blog/2007/06/12/module-pattern/)应用于 Ext JS 应用程序。它提供了一种创建封装良好的代码的简单方法。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-12-22T22:40:17.953

Dojo 从一开始就有模块系统。事实上，它被认为是 Dojo 的基石，是把它粘在一起的粘合剂：

*   [dojo.require — 官方文档](http://docs.dojocampus.org/dojo/require)。
*   [了解 dojo.declare、dojo.require 和 dojo.provide](http://dojocampus.org/content/2008/06/03/understanding-dojodeclare-dojorequire-and-dojoprovide/)。
*   [介绍道场](http://dev.opera.com/articles/view/introducing-the-dojo-toolkit/)。

使用模块 Dojo 可以实现以下目标：

*   Dojo 代码和自定义代码的命名空间 ( `dojo.declare()`) — 不污染全局空间，与其他库和用户的非 Dojo 感知代码共存。
*   按名称 ( ) 同步或异步加载模块`dojo.require()`。
*   通过分析模块依赖关系来自定义构建，以创建单个文件或一组相互依赖的文件（所谓的层），以仅包含您的 Web 应用程序所需的内容。自定义构建也可以包括 Dojo 模块和客户提供的模块。
*   基于 CDN 的对 Dojo 和用户代码的透明访问。AOL 和 Google 都以这种方式使用 Dojo，但一些客户也为他们的自定义 Web 应用程序这样做。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-11-01T16:53:39.633

查看[JavasciptMVC](http://www.javascriptmvc.com)。

你可以 ：

*   将您的代码拆分为模型、视图和控制器层。

*   将所有代码压缩到一个生产文件中

*   自动生成代码

*   创建和运行单元测试

*   还有更多...

最重要的是，它使用 jQuery，因此您也可以利用其他 jQuery 插件。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-10-29T15:48:07.913

我的老板还谈到他们写模块化代码（C语言）的时候，并抱怨现在的代码多么糟糕！据说程序员可以在任何框架中编写汇编。总有一种策略可以克服代码组织。基本问题在于那些将 java 脚本视为玩具并且从不尝试学习它的人。

就我而言，我使用适当的 init_screen() 在 UI 主题或应用程序屏幕的基础上编写 js 文件。使用正确的 id 命名约定，我确保在根元素级别没有名称空间冲突。在不显眼的 window.load() 中，我根据顶层 id 将所有内容绑定起来。

我严格使用 java 脚本闭包和模式来隐藏所有私有方法。这样做之后，就再也没有遇到过属性/函数定义/变量定义冲突的问题。但是，在与团队合作时，通常很难执行同样的严格性。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2011-04-19T19:47:24.357

我很惊讶没有人提到 MVC 框架。我一直在使用[Backbone.js](http://documentcloud.github.com/backbone/)来模块化和解耦我的代码，它非常宝贵。

那里有很多这样的框架，其中大多数也非常小。我个人的看法是，如果您要编写的不仅仅是几行 jQuery 来实现华丽的 UI 内容，或者想要一个丰富的 Ajax 应用程序，那么 MVC 框架将使您的生活更轻松。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-12-23T11:45:25.217

“像疯了似的写，只是希望效果最好？”，我见过这样的项目，它仅由 2 个开发人员开发和维护，一个包含大量 javascript 代码的巨大应用程序。最重要的是，您可以想到的每个可能的 jquery 函数都有不同的快捷方式。我建议他们将代码组织为插件，因为这是类、模块、命名空间......和整个宇宙的 jquery 等价物。但事情变得更糟了，现在他们开始编写插件来替换项目中使用的 3 行代码的每一种组合。就我个人而言，我认为 jQuery 是魔鬼，它不应该用在有大量 javascript 的项目中，因为它鼓励你变得懒惰，不要考虑以任何方式组织代码。我宁愿阅读 100 行 javascript，也不愿阅读 40 个链接的 jQuery 函数的一行（我 我不是在开玩笑）。与流行的看法相反，将 javascript 代码组织成与命名空间和类等效的内容非常容易。这就是 YUI 和 Dojo 所做的。如果你愿意，你可以很容易地自己动手。我发现 YUI 的方法更好更高效。但是，如果您想编写任何有用的东西，您通常需要一个支持片段的好编辑器来补偿 YUI 命名约定。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2008-10-29T22:29:51.830

我为每一件我真的不需要在屏幕上实例化多次的东西创建单例，为其他所有东西创建一个类。所有这些都放在同一个文件的同一个命名空间中。一切都用 UML 状态图进行注释和设计。javascript 代码没有 html，因此没有内联 javascript，我倾向于使用 jquery 来最大限度地减少跨浏览器问题。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-12-23T11:27:12.553

在我的上一个项目-Viajeros.com-中，我使用了多种技术的组合。我不知道如何组织一个网络应用程序——Viajeros 是一个面向旅行者的社交网站，具有明确的部分，因此很容易将每个区域的代码分开。

我根据站点部分使用命名空间模拟和模块的延迟加载。在每次加载页面时，我都会声明一个“vjr”对象，并始终向其加载一组常用函数（vjr.base.js）。然后每个 HTML 页面用一个简单的方法决定需要哪些模块：

```
vjr.Required = ["vjr.gallery", "vjr.comments", "vjr.favorites"]; 
```

Vjr.base.js 从服务器获取每个 gzip 并执行它们。

```
vjr.include(vjr.Required);
vjr.include = function(moduleList) {
  if (!moduleList) return false;
  for (var i = 0; i < moduleList.length; i++) {
    if (moduleList[i]) {
      $.ajax({
        type: "GET", url: vjr.module2fileName(moduleList[i]), dataType: "script"
      });
    }
  }
}; 
```

每个“模块”都有这样的结构：

```
vjr.comments = {}

vjr.comments.submitComment = function() { // do stuff }
vjr.comments.validateComment = function() { // do stuff }

// Handlers
vjr.comments.setUpUI = function() {
    // Assign handlers to screen elements
}

vjr.comments.init = function () {
  // initialize stuff
    vjr.comments.setUpUI();
}

$(document).ready(vjr.comments.init); 
```

鉴于我有限的 Javascript 知识，我知道必须有更好的方法来管理它，但直到现在它对我们来说效果很好。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2009-04-16T14:03:06.600

以 Jquery 为中心的 NameSpace 方式组织您的代码可能如下所示......并且也不会与 Prototype、Ext 等其他 Javascript API 发生冲突。

```
<script src="jquery/1.3.2/jquery.js" type="text/javascript"></script>
<script type="text/javascript">

var AcmeJQ = jQuery.noConflict(true);
var Acme = {fn: function(){}};

(function($){

    Acme.sayHi = function()
    {
        console.log('Hello');
    };

    Acme.sayBye = function()
    {
        console.log('Good Bye');
    };
})(AcmeJQ);

// Usage
//          Acme.sayHi();
// or
// <a href="#" onclick="Acme.sayHi();">Say Hello</a>

</script> 
```

希望这可以帮助。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2011-08-20T03:10:07.473

OO + MVC 的良好原则对于管理复杂的 javascript 应用程序肯定有很长的路要走。

基本上，我将我的应用程序和 javascript 组织为以下熟悉的设计（从我的桌面编程时代一直存在到 Web 2.0）

![JS OO 和 MVC](https://i.stack.imgur.com/EqeXL.png)

图片上的数值说明：

1.  代表我的应用程序视图的小部件。这应该是可扩展的并且整齐地分离出来，从而产生 MVC 试图实现的良好分离，而不是将我的小部件变成意大利面条代码（相当于在 Web 应用程序中将一大块 Javascript 直接放入 HTML 中）。每个小部件通过侦听其他小部件生成的事件来通过其他小部件进行通信，从而减少小部件之间可能导致无法管理的代码的强耦合（还记得在脚本标签中到处添加指向全局函数的 onclick 的日子吗？呃......）
2.  对象模型表示我想在小部件中填充并来回传递给服务器的数据。通过将数据封装到其模型中，应用程序成为数据格式不可知论者。例如：虽然在 Javascript 中这些对象模型自然大部分被序列化和反序列化为 JSON，但如果服务器以某种方式使用 XML 进行通信，我需要更改的只是更改序列化/反序列化层，而不一定需要更改所有小部件类.
3.  管理业务逻辑和与服务器通信的控制器类 + 偶尔缓存层。该层控制与服务器的通信协议，并将必要的数据放入对象模型中
4.  类被整齐地包装在它们相应的命名空间中。我相信我们都知道 Javascript 中的全局命名空间有多糟糕。

过去，我会将文件分离成自己的 js，并使用常见的做法在 Javascript 中创建 OO 原则。我很快发现的问题是编写 JS OO 有多种方法，不一定所有团队成员都有相同的方法。随着团队变得越来越大（在我的情况下超过 15 人），这变得复杂，因为面向对象的 Javascript 没有标准方法。同时我不想编写自己的框架并重复一些我确信比我解决的更聪明的人的工作。

jQuery 作为 Javascript 框架非常好，我喜欢它，但是随着项目变得越来越大，我显然需要为我的 web 应用程序提供额外的结构，特别是为了促进标准化 OO 实践。对于我自己，经过几次实验，我发现 YUI3 Base and Widget ( [http://yuilibrary.com/yui/docs/widget/](http://yuilibrary.com/yui/docs/widget/)和[http://yuilibrary.com/yui/docs/base/index.html](http://yuilibrary.com/yui/docs/base/index.html) ) 基础设施提供正是我需要的。我使用它们的几个原因。

1.  它提供命名空间支持。真正需要 OO 和整洁的代码组织
2.  它支持类和对象的概念
3.  它提供了一种将实例变量添加到类的标准化方法
4.  它巧妙地支持类扩展
5.  它提供了构造函数和析构函数
6.  它提供渲染和事件绑定
7.  它具有基本的小部件框架
8.  现在，每个小部件都能够使用基于标准事件的模型相互通信
9.  最重要的是，它为所有工程师提供了 Javascript 开发的 OO 标准

与许多观点相反，我不一定非要在 jQuery 和 YUI3 之间进行选择。这两者可以和平共处。虽然 YUI3 为我的复杂 Web 应用程序提供了必要的 OO 模板，但 jQuery 仍然为我的团队提供了易于使用的 JS 抽象，我们都喜欢和熟悉。

使用 YUI3，我设法创建 MVC 模式，方法是将 Base 扩展为 Model 的类、将 Widget 扩展为 View 的类以及当然你有控制器类进行必要的逻辑和服务器端调用。

小部件可以使用基于事件的模型相互通信，并根据预定义的接口监听事件并执行必要的任务。简单来说，将 OO + MVC 结构放到 JS 中，对我来说是一种享受。

只是免责声明，我不为雅虎工作！并且只是一个试图解决原始问题提出的相同问题的架构师。我认为如果有人找到等效的 OO 框架，这也可以。原则上，这个问题也适用于其他技术。感谢所有提出 OO 原则 + MVC 的人，让我们的编程日子更易于管理。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-07-24T00:33:02.147

我使用**Dojo 的包管理**（`dojo.require`和`dojo.provide`）和类系统（`dojo.declare`它也允许简单的多重继承）将我的所有类/小部件模块化到单独的文件中。这不仅可以使您的代码井井有条，而且还可以让您延迟/及时加载类/小部件。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2011-03-27T22:04:42.120

[使用继承模式来组织大型 jQuery 应用程序。](http://alexsexton.com/?p=51)

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-10-29T15:29:02.383

几天前，37Signals 的伙计们[发布了一个 RTE 控制](http://github.com/37signals/wysihat/tree/master)，有一个转折。他们制作了一个使用某种预处理器命令捆绑 javascript 文件的库。

从那以后我一直在使用它来分离我的 JS 文件，然后最后将它们合并为一个。这样我就可以分离关注点，最后，只有一个文件通过管道（gzipped，不少于）。

在您的模板中，检查您是否处于开发模式，并包含单独的文件，如果在生产中，请包含最后一个（您必须自己“构建”）。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-05-14T03:58:35.317

创建假类，并确保可以将任何可以放入有意义的单独函数中的东西都这样做。还要确保大量评论，不要编写意大利面条式代码，而是将其全部放在部分中。例如，一些描述我的理想的废话代码。显然，在现实生活中，我还编写了许多基本上包含其功能的库。

```
$(function(){
    //Preload header images
    $('a.rollover').preload();

    //Create new datagrid
    var dGrid = datagrid.init({width: 5, url: 'datalist.txt', style: 'aero'});
});

var datagrid = {
    init: function(w, url, style){
        //Rendering code goes here for style / width
        //code etc

        //Fetch data in
        $.get(url, {}, function(data){
            data = data.split('\n');
            for(var i=0; i < data.length; i++){
                //fetching data
            }
        })
    },
    refresh: function(deep){
        //more functions etc.
    }
}; 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-01-06T21:33:38.200

对于 JavaScript 组织一直在使用以下

1.  所有 javascript 的文件夹
2.  页面级 javascript 获取其自己的与页面名称相同的文件。ProductDetail.aspx 将是 ProductDetail.js
3.  在库文件的 javascript 文件夹中，我有一个 lib 文件夹
4.  将相关的库函数放在您要在整个应用程序中使用的 lib 文件夹中。
5.  Ajax 是我移动到 javascript 文件夹之外并获得它自己的文件夹的唯一 javascript。然后我添加两个子文件夹客户端和服务器
6.  客户端文件夹获取所有 .js 文件，而服务器文件夹获取所有服务器端文件。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-03-30T08:39:32.080

我认为这可能与 DDD（领域驱动设计）有关。我正在开发的应用程序虽然缺少正式的 API，但确实通过服务器端代码（类/文件名等）给出了这样的提示。有了这个，我创建了一个顶级对象作为整个问题域的容器；然后，我在需要的地方添加了命名空间：

```
var App;
(function()
{
    App = new Domain( 'test' );

    function Domain( id )
    {
        this.id = id;
        this.echo = function echo( s )
        {
            alert( s );
        }
        return this;
    }
})();

// separate file
(function(Domain)
{
    Domain.Console = new Console();

    function Console()
    {
        this.Log = function Log( s )
        {
            console.log( s );
        }
        return this;
    }
})(App);

// implementation
App.Console.Log('foo'); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2011-07-20T06:25:27.543

您可以使用[jquery mx](http://javascriptmvc.com/docs.html)（在 javascriptMVC 中使用），它是一组允许您使用模型、视图和控制器的脚本。我在一个项目中使用过它，并帮助我创建了结构化的 javascript，由于压缩，脚本大小最小。这是一个控制器示例：

```
$.Controller.extend('Todos',{
  ".todo mouseover" : function( el, ev ) {
   el.css("backgroundColor","red")
  },
  ".todo mouseout" : function( el, ev ) {
   el.css("backgroundColor","")
  },
  ".create click" : function() {
   this.find("ol").append("<li class='todo'>New Todo</li>"); 
  }
})

new Todos($('#todos')); 
```

如果您对视图和模型部分不感兴趣，也可以[只使用 jquerymx 的控制器端。](http://jupiterjs.com/news/organize-jquery-widgets-with-jquery-controller)

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2010-11-14T20:11:12.090

我正在使用这个小东西。它为 JS 和 HTML 模板提供了“包含”指令。它完全消除了混乱。

[https://github.com/gaperton/include.js/](https://github.com/gaperton/include.js/)

```
$.include({
    html: "my_template.html" // include template from file...
})
.define( function( _ ){ // define module...
    _.exports = function widget( $this, a_data, a_events ){ // exporting function...
        _.html.renderTo( $this, a_data ); // which expands template inside of $this.

        $this.find( "#ok").click( a_events.on_click ); // throw event up to the caller...
        $this.find( "#refresh").click( function(){
            widget( $this, a_data, a_events ); // ...and update ourself. Yep, in that easy way.
        });
    }
}); 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2011-04-02T04:38:34.087

你的问题是去年年底困扰我的一个问题。不同之处 - 将代码交给从未听说过私有和公共方法的新开发人员。我必须构建一些简单的东西。

最终结果是一个小型（大约 1KB）框架，可以将对象文字转换为 jQuery。语法在视觉上更容易扫描，如果你的 js 变得非常大，你可以编写可重用的查询来查找使用的选择器、加载的文件、依赖的函数等。

在这里发布一个小框架是不切实际的，所以我写了[一篇带有示例的博客文章](http://a-laughlin.com)（我的第一篇。那是一次冒险！）。欢迎您来看看。

对于这里有几分钟检查的任何其他人，我将非常感谢您的反馈！

推荐使用 FireFox，因为它支持对象查询示例的 toSource()。

干杯!

亚当

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-12-22T22:43:57.913

延迟加载您需要的代码。[谷歌用他们的google.loader](http://code.google.com/apis/ajax/documentation/)做这样的事情

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-10-29T15:29:39.027

我使用受 Ben Nolan 行为启发的自定义脚本（遗憾的是，我再也找不到指向此的当前链接）来存储我的大部分事件处理程序。例如，这些事件处理程序由元素 className 或 Id 触发。例子：

```
Behaviour.register({ 
    'a.delete-post': function(element) {
        element.observe('click', function(event) { ... });
    },

    'a.anotherlink': function(element) {
        element.observe('click', function(event) { ... });
    }

}); 
```

我喜欢即时包含我的大部分 Javascript 库，除了那些包含全局行为的库。为此，我使用[Zend Framework 的 headScript() 占位符助手](http://framework.zend.com/manual/en/zend.view.helpers.html#zend.view.helpers.initial.headscript)，但您也可以使用 javascript使用[Ajile 动态](http://ajile.iskitz.com/)[加载其他脚本](http://ajaxpatterns.org/On-Demand_Javascript)。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-10-29T23:19:50.357

你没有提到你的服务器端语言是什么。或者，更准确地说，您在服务器端使用的框架（如果有的话）。

输入法，我在服务器端组织东西，然后把它们全部放到网页上。该框架的任务不仅是组织每个页面必须加载的 JS，而且还组织与生成的标记一起使用的 JS 片段。您通常不希望多次发出此类片段 - 这就是为什么将它们抽象到该代码框架中以处理该问题的原因。:-)

对于必须发出自己的 JS 的结束页面，我通常会发现生成的标记中存在逻辑结构。这种本地化的 JS 通常可以在这种结构的开始和/或结束处组装。

请注意，这些都不能免除您编写高效 JavaScript 的责任！:-)

# ssl-certificate - 使用 keytool 生成 CSR 文件时，是否必须在托管服务器上生成？

> ID：247220
> 
> 赞同：3
> 
> 时间：2008-10-29T15:21:49.683
> 
> 标签：ssl-certificate, keytool, csr

我的印象是我可以在任何机器上运行它，但是我们托管公司的一个人说 csr 必须在托管该站点的服务器上生成。

谁能帮我清理一下这个？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T15:40:40.113

底线是您不需要在托管 SSL 证书的服务器上生成 CSR。CSR 是 CSR，您实际上可以使用 OpenSSL 之类的工具生成它，然后在将密钥和证书创建到密钥库后将其导入。问题是他们现在可能不明白如何将钥匙放入钥匙串中。看看这个[KeyTool 和 OpenSSL 提示](http://conshell.net/wiki/index.php/Keytool_to_OpenSSL_Conversion_tips)是否有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-29T03:35:57.957

这并不完全准确。需要发生的是密钥链 -> csr -> cert 都需要在同一个密钥库文件中发生。很难将密钥/证书移入和移出原始密钥库。

# sql - iSeries - 从 CL 程序调用 SQL 存储过程

> ID：247228
> 
> 赞同：3
> 
> 时间：2008-10-29T15:23:40.490
> 
> 标签：sql, ibm-midrange, control-language

如何从 CL 程序运行存储过程？RUNSQLSTM 需要一个源成员，但我只想构建一个命令，以便用户可以轻松地传入变量，所以这不起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T22:01:05.460

您可以调用系统程序`QZDFMDB2`并将其传递一个带有 SQL 字符串的参数以执行。在这种情况下，SQL 字符串是对存储过程的调用：

```
 CALL PGM(QZDFMDB2) PARM('CALL PROCEDURE (''XYZ'', ''ABC'')') 
```

要替换您的值，请使用 PARM 的变量：

```
 DCL VAR(&CALL) TYPE(*CHAR) LEN(200) 

  CHGVAR VAR(&CALL) 
  VALUE('CALL PROCEDURE (''' *CAT &PARM1 *TCAT ''', ''' *CAT &PARM2 *TCAT ''')')

  CALL PGM(QZDFMDB2) PARM(&CALL) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T16:22:50.807

可能有2个选项：

在 CL 程序中创建一个临时源成员。使用提供的参数构造 SQL 语句以执行存储过程并将此源代码写入临时成员。然后使用生成的成员作为参数添加对 RUNSQLSTM 的调用。

第二种选择是不创建 CL 程序，而是使用 RPG/COBOL。通过使用嵌入式 SQL，可以使用参数执行存储过程。它们的值应该从命令传递给程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T18:39:15.477

有一次，有人写了一个我用过的命令。我再也找不到那个参考了，但我还有另外两个选择：

1.  [本文](http://search400.techtarget.com/tip/0,,sid3_gci779945,00.html)使用 REXX
2.  [本文](http://systeminetwork.com/article/dynamic-embedded-sql-runsql-command-revealed)使用RPG

它们都包含使命令正常工作所需的源代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-03T05:56:30.233

`QCMDEXC`可能是您正在寻找的命令。

# windows - 你知道 Windows 上有一个类似的 wc（unix 字数统计命令）程序吗？

> ID：247234
> 
> 赞同：36
> 
> 时间：2008-10-29T15:26:02.450
> 
> 标签：windows, cmd

快速搜索给了我[tawbaware wc](http://www.tawbaware.com/wc.htm)，但它不接受 stdout 作为输入流，这意味着我不能在*DOS*会话中使用管道。

*笔记：*

我无法安装 cygwin 或使用 powershell（本来可以使用 ' `|foreach-object {(get-content $_).count}`'）

[unxutils](http://unxutils.sourceforge.net)和[gnuwin32](http://gnuwin32.sourceforge.net/)软件包可能具有此功能...

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2011-01-27T18:37:01.653

更容易，**`find /c`**. 前任：

```
netstat -an | find /c "ESTABLISHED" 
```

> **`find /c`**：仅显示包含字符串的行数。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-29T15:33:44.417

您可以使用为 Windows 构建的原始“wc”：它是[coreutils](http://gnuwin32.sourceforge.net/packages/coreutils.htm)包的一部分。获取[最新的 coreutils exe](http://gnuwin32.sourceforge.net/downlinks/coreutils.php)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-29T15:45:44.267

对于 Windows 上的 unix 工具，您的选择是：

[msys](http://www.mingw.org/) - 与 unixtools 类似，最初只是 mingw（gcc 的本机版本）所需的一些构建工具，现在几乎拥有所有 cygwin 工具

[cygwin](http://www.cygwin.com/) - 几乎适用于 unix，安装复杂，需要 dll 来提供 unix api。混合使用不同版本的 cygwin.dll 构建的工具可能会出现问题

[Unixtools](http://unxutils.sourceforge.net/) - 不是 cygwin 提供的所有工具，而是本地编译的

[ch](http://www.softintegration.com/products/chstandard/) - 几乎所有的 unix 工具，本机编译。以及一个包含“c”解释器的外壳。标准版是免费的（啤酒），但不是开源的。

[uwin](http://www.research.att.com/sw/tools/uwin/) - 没有 ATT，如果你喜欢这种东西，包括 korn shell。

[mks](http://www.mkssoftware.com/)一个商业端口的 unix 工具。鉴于可用的免费版本相当昂贵。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-12-04T16:18:34.123

尝试：

```
find /c /v "~any string that will never occur~" 
```

**此命令对不**包含搜索字符串的所有行进行计数。测试它，我看到一个问题，它似乎没有计算文件末尾的空行。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-29T15:34:31.390

好吧，我很抱歉不同意，但[unxutils](http://sourceforge.net/projects/unxutils)确实有一个 wc.exe

试试看！

干杯，

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-29T15:34:49.033

我的[unxutils](http://unxutils.sourceforge.net/)包有字数：

> C:\Java\vssWorkspace\java\portlets_core>wc -l C:\Users\malp\AppData\Local\Temp__portlets41366.html 79717 C:\Users\malp\AppData\Local\Temp__portlets41366.html

此外，unxutils 页面显示**wc.exe**可用。您是否正在寻找**wc.exe**无法处理的内容？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-09-25T23:26:42.900

以下是另外两种（纯 Windows CMD）计算 git 日志中行数的方法：

```
set n=0
for /f %a in ('git log --oneline') do set /a n=n+1 
```

或者：

```
git log --online | find /v /c "" 
```

第一个的优点是你最终得到了一个环境变量中的值，你可以用它来做事。但是对于大文件，它可能会执行缓慢。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T15:38:14.610

还有[WinXs 4.2](http://www.softwareonline.org/winxs42.html "WinXs 4.2")，它是共享软件，所以你可以看看它是否能满足你的需要。

您可以为此安装脚本语言吗？这可能是矫枉过正，但如果它以最少的大惊小怪完成工作......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-08-04T01:28:59.210

我找到了这个线程，并被仅使用 Windows 内置的工具模拟 wc 的创新解决方案所吸引。这激发了我对字符数的需求的答案，以便我可以在与 Web 表单字段的最大字符的战斗中获胜警告。

如果您想要**wc -c**给出字节数，您可以使用**DEBUG**，这是 Windows 中的一个 DOS 实用程序（HELP 命令未列出）。字符数应等于字节数减去行数乘以换行符的大小，换行符是 Unix 的一个换行符 ('\n') 或两个字符，回车 + 换行符（'\cr' 和 '\lf' 或 ' \0Dh' '0Ah' 用于 DOS 纯文本文件。

字符数 = 字节数 - (行数 * sizeof("\n"))

为此，打开一个命令行窗口（开始->运行->打开：“cmd”），在纯文本文件上运行调试并检查包含加载文件长度的 CX 寄存器：

> 调试 [路径名] -rcx CX [十六进制文件长度]：-q

然后在文件上运行查找：

> find /v /c "notlikelystring" ---------- [路径名]: [行数]

并应用公式。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-10-29T16:01:09.120

[getgnuwin32](http://sourceforge.net/project/showfiles.php?group_id=163416)有助于下载和安装 gnuwin32（当然有 wc 实用程序）。

# .net - .net 中的事件签名模式

> ID：247241
> 
> 赞同：5
> 
> 时间：2008-10-29T15:27:12.107
> 
> 标签：.net, events

.net 中事件代表的标准模式有什么意义？即 EventHandler 预定义的委托？为什么不为需求选择最合适的签名呢？

编辑：此外，是否有必要在所有情况下都盲目地效仿微软的榜样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T16:28:39.673

在 C# 1.0 中，约定没有多大意义。在 C# 2.0 中，存在一定数量的委托差异，这更有意义。

如果您有一个并不真正关心参数的事件处理方法，例如

```
public void SaveDocument(object sender, EventArgs args)
{
    // Save the document here
} 
```

您现在可以使用该方法订阅任何遵循约定的事件，即使实际发送者或参数的类型更为严格。这意味着您可以对键盘事件、按钮单击等使用相同的处理程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T15:36:27.110

它主要是为了一致性和版本控制——`sender`参数始终为 System.Object，`args`参数始终为 System.EventArgs，或其派生类，您可以更改传递给它的 sender 参数以及之后更改 EventArgs 类型而不会中断任何现有代码。

整个 .NET 事件习惯用法旨在支持基于组件的开发，其中调用代码不受具有事件的组件开发人员的控制。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T15:48:27.540

这是一个很好的问题。异端，但很好。我最近读了一篇博文（我找不到链接——有人有那个链接吗），它揭穿了您需要始终覆盖 System.EventArgs 以提供良好的事件处理的神话。

我完全赞成约定和遵守规则，但我认为这是可以被认为是可以弯曲的——如果不能避免的话。需要为每个事件不断覆盖 System.EventArgs 增加了例程的耦合——现在还有另一件事需要跟踪。

拥有一个提供成员的“e”并不比一组有名的参数更有帮助或更直观。我不认为分派推荐的 System.EventArg 模式可以赢得争论，但我会和你一起提出这个论点。

rp

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T15:33:18.600

它将调用者与被调用者分离。

# html - 是否可以在 MAILTO 链接的正文中添加 HTML 链接

> ID：247245
> 
> 赞同：128
> 
> 时间：2008-10-29T15:27:58.047
> 
> 标签：html, email, mailto

我不必过多地弄乱mailto链接。但是，如果可能的话，我现在需要在邮件正文中添加一个链接。

有没有办法添加链接或将打开的电子邮件更改为 html 电子邮件与文本电子邮件？

就像是：

```
<a href="mailto:test@test.test?body=The message's first paragraph.%0A%0aSecond paragraph.%0A%0AThird Paragraph.%0A%0ALink goes here">Link text goes here</a> 
```

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2008-10-29T16:06:20.887

[RFC 2368](https://www.rfc-editor.org/rfc/rfc2368 "RFC 2368")的第 2 节说该`body`字段应该是`text/plain`格式的，所以你不能做 HTML。

但是，即使您使用纯文本，一些现代邮件客户端也可能会将 URL 呈现为可点击的链接。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-29T18:01:31.093

添加完整链接，其中：

```
 "http://" 
```

到一行的开头，大多数体面的电子邮件客户端会在发送之前自动链接它，或者在接收时在另一端自动链接。

对于很长的 url，可能会由于所有参数而换行，请将链接包装在小于/大于符号中。这告诉电子邮件客户端**不要**包装 url。

例如

```
 <http://www.example.com/foo.php?this=a&really=long&url=with&lots=and&lots=and&lots=of&prameters=on_it> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-29T15:54:02.783

据我所知，这是不可能的，因为链接需要 HTML，而 mailto 链接不会创建 HTML 电子邮件。

这可能是出于安全考虑，因为您可以将 javascript 或 iframe 添加到此链接，并且电子邮件客户端可能会打开最终用户的漏洞。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-08-06T14:54:18.303

请在 IE 中检查以下 javascript。不知道其他现代浏览器是否可以使用。

```
<html>
    <head>
        <script type="text/javascript">
            function OpenOutlookDoc(){
                try {

                    var outlookApp = new ActiveXObject("Outlook.Application");
                    var nameSpace = outlookApp.getNameSpace("MAPI");
                    mailFolder = nameSpace.getDefaultFolder(6);
                    mailItem = mailFolder.Items.add('IPM.Note.FormA');
                    mailItem.Subject="a subject test";
                    mailItem.To = "an@email.here";
                    mailItem.HTMLBody = "<b>bold</b>";
                    mailItem.display (0); 
                }
                catch(e){
                    alert(e);
                    // act on any error that you get
                }
            }
        </script>
    </head>
    <body>
        <a href="javascript:OpenOutlookDoc()">Click</a>
    </body>
</html> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-07T03:34:08.497

这是我放在一起的。它适用于我需要它的选定移动设备，但我不确定该解决方案的通用性

```
<a href="mailto:me@me.com?subject=Me&body=%3Chtml%20xmlns%3D%22http:%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3C%2Fhead%3E%3Cbody%3EPlease%20%3Ca%20href%3D%22http:%2F%2Fwww.w3.org%22%3Eclick%3C%2Fa%3E%20me%3C%2Fbody%3E%3C%2Fhtml%3E"> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-30T11:41:27.587

我已经实现了它适用于 iOS 设备但在 android 设备上失败

```
<a  href="mailto:?subject=Your mate might be interested...&body=<div style='padding: 0;'><div style='padding: 0;'><p>I found this on the site I think you might find it interesting.  <a href='@(Request.Url.ToString())' >Click here </a></p></div></div>">Share This</a> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-10-05T00:02:14.360

“mailto”正文的规范说：

> 消息的正文只是几行 US-ASCII 字符。身体上仅有的两个限制如下：
> 
> *   CR 和 LF 必须仅作为 CRLF 一起出现；它们不得独立出现在体内。
> *   正文中的字符行必须限制为 998 个字符，并且应该限制为 78 个字符，不包括 CRLF。

[https://www.rfc-editor.org/rfc/rfc5322#section-2.3](https://www.rfc-editor.org/rfc/rfc5322#section-2.3)

通常，由于安全问题，现在大多数电子邮件客户端都擅长自动链接，但并非所有人都这样做。您可能会找到一些解决方法，但不一定能普遍适用。

# .net - 我应该在我的数据访问层中保留一个 sqlconnection 吗？

> ID：247247
> 
> 赞同：8
> 
> 时间：2008-10-29T15:28:14.193
> 
> 标签：.net, sql, ado.net

似乎快速打开和关闭 sqlconnections 涉及很多开销。我应该保持一个连接（一个，每个客户端，每个数据库），还是在需要时继续声明一个新的 sqlconnection 对象，并确保我自己清理干净？

你做了什么？什么效果好，什么效果不好？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-29T15:40:10.083

在大多数情况下，.NET 连接池会为您处理这个问题。即使您通过代码打开和关闭连接，这也不是幕后发生的事情。当您实例化并打开一个连接时，.NET 会在连接池中查找具有相同连接字符串的现有连接，然后将其提供给您。当您关闭连接时，它会返回到连接池以供将来使用。

如果您使用的是 SQL Server：http: [//msdn.microsoft.com/en-us/library/8xx3tyca.aspx](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)

OLE DB、ODBC、Oracle：http: [//msdn.microsoft.com/en-us/library/ms254502.aspx](http://msdn.microsoft.com/en-us/library/ms254502.aspx)

Dino Esposito 文章： http: [//www.wintellect.com/Articles/ADO%20NET%20Connection.pdf](http://www.wintellect.com/Articles/ADO%20NET%20Connection.pdf)

您可以使用连接字符串名称/值覆盖默认池行为：http: [//msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx)。请参阅包含“连接生命周期”的第二个设置表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T15:30:37.310

没有太多开销，因为在默认设置下，池存储在连接池中。因此，当您打开一个连接时，通常您只会从池中获得一个准备好的连接。创建 SqlConnections 并没有给我带来任何麻烦。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-29T15:29:24.207

如果您使用相同的连接字符串，您的连接将被合并。只要您需要，您应该只打开一个连接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T15:39:32.440

我确实有同样的想法，所以我在一个紧密的循环中使用了相同的连接，以防止在需要时必须实例化另一个连接。但是有时很难跟踪它并进行调试，如果您从连接中获取 DataReader，然后在同一个阅读器仍处于活动状态时尝试执行另一个，那么您将得到异常。所以，我只推荐它，如果它真的像一个紧密的循环一样频繁，否则它不值得麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T17:22:35.727

这通常不是一件好事（您可能会导致泄漏并最终耗尽连接），而是依赖连接池来获得性能并根据需要打开连接并尽快关闭连接。

Bill Vaughn 有许多关于连接池和数据访问的有用文章，包括[这篇文章](http://www.betav.com/blog/billva/2007/05/managing_and_monitoring_net_co.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T18:05:45.263

多年来，我们让客户端保持与数据库的单一持久连接。问题在于检测间歇性连接失败并正常重新连接。很多时候你不会知道连接失败，直到你尝试使用它（即发出一个选择将抛出一个“一般 SQL 错误”）

我们现在使用一个全局可用的静态类，它的工作是为您提供一个到数据库的新连接，当您完成它时，您使用同一个类来摆脱连接。

```
DbConnection conn = Database.GetConnection();
try
{
   //do stuff with the connetion
   ...
}
finally
{
   Database.DisposeConnection(conn);
} 
```

*我们*这样做是因为在连接数据库时需要初始化（我们存储的信息是 SQL Server 的 CONTEXT_INFO，并且在断开连接时必须清空该信息*）*

# sql - 使用存储过程访问数据

> ID：247252
> 
> 赞同：4
> 
> 时间：2008-10-29T15:29:04.457
> 
> 标签：sql, sql-server-2005, stored-procedures, crud

“最佳实践”之一是通过存储过程访问数据。我明白为什么这种情况很好。我的动机是拆分数据库和应用程序逻辑（表可以更改，如果存储过程的行为相同），SQL注入防御（用户不能执行“select * from some_tables”，他们只能调用存储过程），以及安全性（在存储过程中可以是安全的“任何东西”，用户不能选择/插入/更新/删除数据，这不适合他们）。

我不知道如何使用动态过滤器访问数据。

我正在使用 MSSQL 2005。

如果我有桌子：

```
CREATE TABLE tblProduct (
   ProductID uniqueidentifier -- PK
   , IDProductType uniqueidentifier -- FK to another table
   , ProductName nvarchar(255) -- name of product
   , ProductCode nvarchar(50) -- code of product for quick search
   , Weight decimal(18,4)
   , Volume decimal(18,4)
) 
```

那么我应该创建 4 个存储过程（创建/读取/更新/删除）。

“创建”的存储过程很简单。

```
CREATE PROC Insert_Product ( @ProductID uniqueidentifier, @IDProductType uniqueidentifier, ... etc ... ) AS BEGIN
   INSERT INTO tblProduct ( ProductID, IDProductType, ... etc .. ) VALUES ( @ProductID, @IDProductType, ... etc ... )
END 
```

“删除”的存储过程也很简单。

```
CREATE PROC Delete_Product ( @ProductID uniqueidentifier, @IDProductType uniqueidentifier, ... etc ... ) AS BEGIN
    DELETE tblProduct WHERE ProductID = @ProductID AND IDProductType = @IDProductType AND ... etc ...
END 
```

“更新”的存储过程与“删除”类似，但我不确定这是正确的方法，如何去做。我认为更新所有列效率不高。

```
CREATE PROC Update_Product( @ProductID uniqueidentifier, @Original_ProductID uniqueidentifier, @IDProductType uniqueidentifier, @Original_IDProductType uniqueidentifier, ... etc ... ) AS BEGIN
   UPDATE tblProduct SET ProductID = @ProductID, IDProductType = @IDProductType, ... etc ...
      WHERE ProductID = @Original_ProductID AND IDProductType = @Original_IDProductType AND ... etc ...
END 
```

最后一个“读取”的存储过程对我来说有点神秘。如何通过复杂条件的过滤器值？我有几点建议：

使用 XML 参数传递 where 条件：

```
CREATE PROC Read_Product ( @WhereCondition XML ) AS BEGIN
    DECLARE @SELECT nvarchar(4000)
    SET @SELECT = 'SELECT ProductID, IDProductType, ProductName, ProductCode, Weight, Volume FROM tblProduct'

    DECLARE @WHERE nvarchar(4000)
    SET @WHERE = dbo.CreateSqlWherecondition( @WhereCondition ) --dbo.CreateSqlWherecondition is some function which returns text with WHERE condition from passed XML

    DECLARE @LEN_SELECT int
    SET @LEN_SELECT = LEN( @SELECT )
    DECLARE @LEN_WHERE int
    SET @LEN_WHERE = LEN( @WHERE )
    DECLARE @LEN_TOTAL int
    SET @LEN_TOTAL = @LEN_SELECT + @LEN_WHERE
    IF @LEN_TOTAL > 4000 BEGIN
        -- RAISE SOME CONCRETE ERROR, BECAUSE DYNAMIC SQL ACCEPTS MAX 4000 chars
    END

    DECLARE @SQL nvarchar(4000)
    SET @SQL = @SELECT + @WHERE

    EXEC sp_execsql @SQL
END 
```

但是，我认为一个查询的“4000”个字符的限制是丑陋的。

下一个建议是为每一列使用过滤表。将过滤器值插入过滤器表，然后调用具有过滤器 ID 的存储过程：

```
CREATE TABLE tblFilter (
   PKID uniqueidentifier -- PK
   , IDFilter uniqueidentifier -- identification of filter
   , FilterType tinyint -- 0 = ignore, 1 = equals, 2 = not equals, 3 = greater than, etc ...
   , BitValue bit , TinyIntValue tinyint , SmallIntValue smallint, IntValue int
   , BigIntValue bigint, DecimalValue decimal(19,4), NVarCharValue nvarchar(4000)
   , GuidValue uniqueidentifier, etc ... )

CREATE TABLE Read_Product ( @Filter_ProductID uniqueidentifier, @Filter_IDProductType uniqueidentifier, @Filter_ProductName uniqueidentifier, ... etc ... ) AS BEGIN
   SELECT ProductID, IDProductType, ProductName, ProductCode, Weight, Volume
   FROM tblProduct
   WHERE ( @Filter_ProductID IS NULL
            OR ( ( ProductID IN ( SELECT GuidValue FROM tblFilter WHERE IDFilter = @Filter_ProductID AND FilterType = 1 ) AND NOT ( ProductID IN ( SELECT GuidValue FROM tblFilter WHERE IDFilter = @Filter_ProductID AND FilterType = 2 ) )
      AND ( @Filter_IDProductType IS NULL
            OR ( ( IDProductType IN ( SELECT GuidValue FROM tblFilter WHERE IDFilter = @Filter_IDProductType AND FilterType = 1 ) AND NOT ( IDProductType IN ( SELECT GuidValue FROM tblFilter WHERE IDFilter = @Filter_IDProductType AND FilterType = 2 ) )
      AND ( @Filter_ProductName IS NULL OR ( ... etc ... ) ) 
END 
```

但我认为这个建议有点复杂。

是否有一些“最佳实践”来执行这种类型的存储过程？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T15:39:33.797

对于读取数据，您不需要存储过程来确保安全或分离出逻辑，您可以使用视图。

只授予视图上的选择。

您可以限制显示的记录、更改字段名称、将许多表连接成一个逻辑“表”等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T15:40:53.293

首先：对于您的删除例程，您的 where 子句应该只包含主键。

第二：对于你的更新程序，在你有工作代码之前不要尝试优化。事实上，在您可以分析您的应用程序并查看瓶颈所在之前，不要尝试进行优化。我可以肯定地告诉你，更新一行的一列和更新一行的所有列的速度几乎相同。在 DBMS 中需要时间的是 (1) 找到您将写入数据的磁盘块和 (2) 锁定其他写入器，以便您的写入保持一致。最后，编写只更新需要更改的列所需的代码通常更难做，也更难维护。如果您真的想变得挑剔，则必须将找出哪些列更改的速度与仅更新每一列的速度进行比较。如果您全部更新它们，则不必阅读其中任何一个。

第三：我倾向于为每个检索路径编写一个存储过程。在您的示例中，我将按主键创建一个，按每个外键创建一个，然后根据应用程序中的需要为每个新访问路径添加一个。敏捷；不要编写你不需要的代码。我也同意使用视图而不是存储过程，但是，您可以使用存储过程来返回多个结果集（在某些版本的 MSSQL 中）或将行更改为列，这很有用。

例如，如果您需要按主键获取 7 行，您有一些选择。您可以调用七次按主键获取一行的存储过程。如果您在所有呼叫之间保持连接打开，这可能会足够快。如果您知道一次不需要超过一定数量（例如 10 个）的 ID，则可以编写一个包含 where 子句的存储过程，例如“and ID in (arg1, arg2, arg3...)” 并制作确保未使用的参数设置为 NULL。如果您决定需要生成动态 SQL，我不会为存储过程而烦恼，因为 TSQL 与任何其他语言一样容易出错。此外，使用数据库进行字符串操作不会给您带来任何好处——它几乎总是您的瓶颈，因此没有必要为数据库提供任何不必要的工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T17:47:54.427

我不同意创建插入/更新/选择存储过程是“最佳实践”。除非您的整个应用程序是用 SP 编写的，否则请在应用程序中使用数据库层来处理这些 CRUD 活动。更好的是，使用 ORM 技术为您处理它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T16:04:52.310

我的建议是您不要尝试创建一个存储过程来完成您现在或曾经需要做的所有事情。如果您需要根据表的主键检索一行，请编写一个存储过程来执行此操作。如果您需要搜索满足一组条件的所有行，则找出该条件可能是什么并编写一个存储过程来执行此操作。

如果您尝试编写软件来解决所有可能的问题，而不是一组特定的问题，那么您通常无法提供任何有用的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T16:18:06.277

您的选择存储过程可以按如下方式完成，只需要一个存储过程，但 where 子句中需要任意数量的不同项目。传入任何一个参数或参数组合，您将获得所有匹配的项目 - 因此您只需要一个存储过程。

```
Create sp_ProductSelect
(
 @ProductID int = null,
 @IDProductType int = null,
 @ProductName varchar(50) = null,
 @ProductCode varchar(10) = null,
 ...
 @Volume int = null
)
AS
SELECT ProductID, IDProductType, ProductName, ProductCode, Weight, Volume FROM tblProduct'  
Where
  ((@ProductID is null) or (ProductID = @ProductID)) AND
  ((@ProductName is null) or (ProductName = @ProductName)) AND
  ...
  ((@Volume is null) or (Volume= @Volume)) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T15:54:35.607

在 SQL 2005 中，它支持 nvarchar(max)，它有 2G 的限制，但实际上接受了普通 nvarchar 上的所有字符串操作。您可能想测试这是否适合您在第一种方法中的需要。

# php - 我需要在论坛上发布什么 $_POST[]？

> ID：247257
> 
> 赞同：0
> 
> 时间：2008-10-29T15:30:12.503
> 
> 标签：php, curl, forum, bots, phpbb3

我是论坛的管理员。早些时候我们有 phpbb 2.0，我做了一个可以写到论坛的机器人。现在，我们已将论坛升级到 phpbb 3.0，但我无法让我的机器人再向论坛写信。

我一直在寻找解决方案，但现在我没有想法。因此，如果有人有建议，那就太好了。

顺便说一句，我使用 CURL 和 php 来制作这个机器人。

bot 的使用：用户登录外部网站报告他们在网上玩过的足球比赛的结果。然后，机器人会自动在论坛上发帖。

所以基本上我需要知道我需要发送什么 $_POST[] 。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T15:37:07.187

我建议查看网站上“添加帖子”表单的源代码。检查HTML；您将需要模拟每个`input`或`select`元素，因为这些是通过表单提交的 POST 值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T15:50:56.550

或者获取一个好的 http 数据包分析器（例如 Windows 上的 Fiddler）并查看手动发布时浏览器发送的内容。

不过，我同意 Toytown Mafia 的观点，查看发送或接收页面的来源应该很简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T15:56:02.233

如果您使用的是 Firefox，您可以使用[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)查看表单生成的内容，还可以使用[实时 http 标头](http://livehttpheaders.mozdev.org/)查看实际返回的内容。

HTTP 标头可能是最好的方法，因为它也包含 cookie 标头，您可能会发现 phpbb 3 在允许用户发布之前检查用户会话。

如果您也了解 PHP，您可以查看源代码并查看它正在执行的验证（或使用调试器的步骤）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-18T17:46:27.107

发现建议宁可使用phpbb函数，也不要直接编辑数据库。这里的主题：[http](http://www.phpbb.com/community/viewtopic.php?f=71&t=936535&p=5358845) ://www.phpbb.com/community/viewtopic.php?f=71&t=936535&p=5358845展示了如何让它工作的一个很好的例子。这里解释了发布到论坛的功能：wiki.phpbb.com/Submit_post

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-18T18:07:22.073

既然这是您的论坛，为什么不创建一个脚本来查询数据库并`INSERT`在需要发布时执行适当的操作？

我个人认为这比使用 HTTP 查询发帖更好……除非它真的不是你的论坛……

# c# - VS2008 C# 异常与反射调用的方法

> ID：247269
> 
> 赞同：2
> 
> 时间：2008-10-29T15:33:44.433
> 
> 标签：c#, debugging

如果我调用一个执行非法操作的方法，调试器将在该方法中的代码行处停止，这会引发异常

如果我使用反射通过 Invoke 调用方法并且该方法引发异常，则调试器会在通过反射调用该方法的位置停止，而不是在错误方法本身中停止

如何更改这一点，并使调试器停止在错误的代码行上，而不管该方法是如何调用的？

代码内置在Debug中

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T15:36:20.310

选中特定异常的“Thrown”框——调试器将在异常被 Invoke 层捕获（和翻译）之前停止在引发异常的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T15:36:00.077

您使用的是程序集的调试版本吗？如果不是，调试器无法定位异常的来源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T15:39:38.150

如果您知道反射调用的方法的此签名。您可以创建一个委托。

如果你有课：

```
public class MyClass {
    private string GetSomeText() { return DateTime.Now.ToString(); }
} 
```

您可以创建一个委托：

```
delegate string DlgGetSomeText(); 
```

然后使用引用具体方法创建一个委托的实例：

```
MyClass cls = new MyClass();
DlgGetSomeText dlg = (DlgGetSomeText)Delegate.CreateDelegate( cls.GetType(), cls, "GetSomeText" );
string result = dlg(); 
```

如果你会使用委托，反射调用将不会被使用，所以你的问题就会出现。

# .net - 如何在 Silverlight 中使用与成员变量不同的名称（反）序列化 JSON 数据

> ID：247270
> 
> 赞同：1
> 
> 时间：2008-10-29T15:34:20.157
> 
> 标签：.net, silverlight, json, serialization, silverlight-2.0

我在尝试反序列化的类中定义了以下成员：

```
[DataMemberAttribute(Name = "cust_title")]
        public String Title { get; set; }
        [DataMemberAttribute(Name = "cust_description")]
        public String Description { get; set; } 
```

由于某种原因，反序列化失败（它似乎忽略了 DataMemberAttribute）。

有谁知道如何让这个工作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-29T15:46:07.857

我刚刚通过一些试验和错误找到了答案。为了使用`[DataMemberAttribute]`你还必须放在`[DataContractAttribute]`你的类定义之上：

```
[DataContractAttribute]
public class MyClass
{
  [DataMemberAttribute(Name="test_test")]
  public String Test { get; set; }
} 
```

# jquery - 使用 jQuery ajaxSubmit 使用 beforeSubmit 修改表单值？

> ID：247284
> 
> 赞同：7
> 
> 时间：2008-10-29T15:38:28.340
> 
> 标签：jquery, jquery-forms-plugin

我有一个表单，我使用表单插件中的 jQuery 的 ajaxSubmit 函数提交。我正在尝试在提交之前将表单名称/值对添加到表单数据中。我的计划是在 beforeSubmit 事件处理程序中修改表单数据。

给定一个看起来像这样的函数：

```
function handleActionFormBeforeSubmit(formData, form, options) {
    // Add a name/value pair here somehow to formData
} 
```

如何向 formData 添加一个简单的对？它是一个数组，形式为：

```
[ { name: 'username', value: 'jresig' }, { name: 'password', value: 'secret' } ] 
```

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-29T17:55:02.820

经过一个小时的实验，我想出了一个解决方案。要将值附加到表单数据，以下代码将起作用。

```
function handleActionFormBeforeSubmit(formData, form, options) {

    // Add a name/value pair indicating this is an asynchronous call.
    // This works with the ASP.NET MVC framework's Request.IsMvcAjaxRequest() method.
    formData[formData.length] = { "name": "__MVCASYNCPOST", "value": "true" };
} 
```

如果您知道要更改的值的索引，也可以修改数据，例如：

```
formData[0].value = 'new value'; 
```

我希望这对其他人有帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-11-02T03:43:55.247

这可以：

```
formData.push({ "name": "__MVCASYNCPOST", "value": "true" }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-24T11:14:50.343

formData[0].value = '新值'; 在 AjaxSubmit() 中工作正常。我在动态上传文件内容时实现了相同的功能。经过这么多时间，表单将空白数据发送到服务器，因此此代码有助于在提交表单之前进行更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-08T12:45:25.740

出于某种原因，当我遇到此问题时，更改 beforeSubmit 回调中的数据对我不起作用。

但是，在表单选项中将对象分配给“数据”会导致该对象附加到序列化数据中。这没有在 jquery 表单网站上明确记录，但它是底层 $.ajax 方法的一部分。

# ms-access - 在 MS Access 上与多个程序员合作

> ID：247292
> 
> 赞同：11
> 
> 时间：2008-10-29T15:40:01.487
> 
> 标签：ms-access, version-control

您是否建议在 MS Access 应用程序上与多个程序员一起工作？

我们的一个 MS Access 应用程序已经发展到一个程序员无法在要求的时间范围内处理的更改（错误修复）和新功能的数量。

我们正在尝试使用 VBA 中未记录的 SaveAsText 和 LoadFromText 过程引入版本控制，以使在此应用程序上的协作成为可能。不幸的是，我们已经遇到了将修改后的表单和报告加载回 Access 的问题，因为校验和存储在每个表单文本文件中。

在花时间构建导入/导出应用程序以将文本文件编译到 Access 数据库中之前，我们想听听您的建议。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-29T15:47:33.953

我认为您应该**不惜一切代价避免这条道路**，并尝试说服管理层进行重建。

这是一颗难以下咽的苦果，但这**迟早需要重新开发**，而您只是在为他们节省时间和金钱。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-30T12:14:12.493

我们使用 Microsoft 自己的 MS Access 2000/2002/2003 版本控制插件大约 5 年了，我不记得有一个严重的问题。这个加载项的可用性几乎不值得一个“B”，但它必须比摆弄任何涉及手动或半手动导出/导入 Access 表单、模块等的临时方法方便得多。

我们一直使用 VSS 作为版本控制系统。没有任何问题。但是，如果您有一些避免 VSS 的充分理由，您可能有一些选择：

*   我们使用的版本控制插件**不需要 VSS**。从理论上讲，它可以与任何实现[Microsoft 源代码控制接口 (MSCCI)](http://msdn.microsoft.com/en-us/library/aa265769(VS.60).aspx)的版本控制系统一起使用。例如，当我们不得不让某人远程处理这个项目时，我们使用了 SourceGear 的 SourceOffsite。访问版本控制插件在这个第三方产品上工作得相当好（不是没有一些怪癖，但足够好）。因此，如果您喜欢的版本控制系统符合 MSCCI，您可以尝试使用它。

*   既然微软已经有了这个 Team Foundation 的东西，显然还有其他选项可用于将 MS Access 与版本控制集成。不过，我们并没有探索这条道路。[本文](http://blogs.msdn.com/access/archive/2008/05/14/access-source-code-control-and-team-foundation-server.aspx)可能是探索它的良好开端。

希望这会有所帮助。:-)

PS 我不是 MS Access 的忠实粉丝。事实上，我更讨厌它作为用户前端的平台。如果我有选择，我会在昨天逃避它。:-) 但是，我必须承认，这个版本控制插件的存在是使我们旧的 Access+SQLServer 项目的维护或多或少可以容忍的少数事情之一。:-))

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-30T16:37:00.950

除了[我在这里已经说过的](https://stackoverflow.com/questions/187506/how-do-you-use-version-control-with-access-development#188999)，我应该补充一点，整个系统运行良好。对于一个由 3 名程序员组成的团队，每周的比较过程不到 30 分钟。所以让我们稍微描述一下。

我们的 Access 程序基本上有 2 个版本：

## “开发者版本”，包含所有内容。

我们每个人都开始使用与我们的开发人员版本相同的版本。随着每个人修改或添加部分代码，我们必须定期运行一些比较例程。为此，我们有一个对象导出例程到一个通用的“比较”文件夹。将对象（例如模块）导出为文本文件（saveAsText 命令，不适用于表格，见下文），它将与文件夹中现有的等效文本文件进行比较。如果文件相同，则没有文件导出。如果文件不同，新模块将使用开发人员的名称作为文件名的补充导出（如果 modQueries.txt 存在，则创建 modQueries_philippe.txt...）。当然，如果文件夹中没有等效的 .txt 文件，它会在第一次导出时创建。

在此期间结束时，我们将在我们的文件夹中获得以下文件

1.  modQueries.txt，是模块的第一个“原始”，最后一个通用版本
2.  modQueries_Philippe.txt，带有 Philippe 的修改
3.  modQueries_Denise.txt，带有 Denise 的修改
4.  由于该模块没有被其他开发人员修改，因此他们的导出不会导致创建特定的 modQueries_developersName.txt 文件
5.  如果由于任何原因 Denise 多次导出她的模块，则只有最后一个版本位于比较文件夹中。

然后我们可以比较（使用“文本文件”比较器）不同版本并创建模块的“更新”版本。我们有一个屏幕显示比较文件夹中的对象数量，每个对象的版本号，甚至可以直接从开发人员界面打开文件比较器（我们使用“文件比较工具”，它有一个命令-线模式，然后可以直接从 Access 启动）。

表单比较问题非常特殊，因为我们的规则之一是表单中没有特定代码（[请参阅此处了解更多详细信息](https://stackoverflow.com/questions/47400/best-way-to-test-a-ms-access-application#70572)）。表格仅用于显示，因此通常我们甚至不比较它们。我们只是确保它们中的每一个都仅由一个人更新（这是非常合乎逻辑的）。

表比较问题（我们有本地表）只能在 mdb 文件之间进行。当我们为每个模块导出一个文本文件时，我们也为每个表导出一个 mdb 文件。我们有一个小例程，允许我们在结构级别或记录级别识别表差异。

在每个比较过程之后，一个子例程将使用比较文件夹中所有可用的对象，并***从头开始创建一个全新的干净 mdb 文件***。这是新的开发者版本。然后每个开发人员都可以将其复制到他的计算机上并继续他的工作。

开发者版本没有编号，但包含最后一个客户端版本号。

## 客户端版本，内容有限，自动分发给用户

每个开发人员都有可能为最终用户构建一个“客户端”mdb。这个 mdb 是从头开始创建的，与我们开发人员的版本非常相似，但并非所有对象都被导出。一些特定的开关被关闭（特殊键、访问代码等）。此 mdb 将版本号作为属性保存。版本号用于构建 mdb 文件的名称。

在生产时，此 mdb 文件被压缩并放置在特定的“分发”文件夹中。每次用户启动应用程序时，它都会自动检查此文件夹以查看是否有新版本可用。如果是，则从分发文件夹更新客户端 mdb 文件，并重新启动应用程序。

此分发文件夹在夜间与我们的海外机构进行复制。然后，国外用户将能够在第二天安装新版本。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-31T16:07:00.540

按照 Yarik 提供的指导，我们决定继续使用[Access Add-in Source Code Control](http://www.microsoft.com/downloads/details.aspx?familyid=2ea45ff4-a916-48c5-8f84-44b91fa774bc&displaylang=en)、PushOk Software的[SVN SCC API 插件和](http://www.pushok.com/soft_svn.php)[Subversion](http://subversion.tigris.org/)在 Access 中进行开发。这个堆栈为我们提供了无缝的访问集成、完整的备份和恢复以及开放的版本控制系统。

[我们必须为Access 2003](http://support.microsoft.com/kb/945674/en-us)安装一个修补程序，并确保[默认数据库文件类型与我们的数据库文件类型相匹配](https://stackoverflow.com/questions/208397/loadfromtext-gives-error-2285-microsoft-office-access-cant-create-the-output-fi#253572)才能使其正常工作。

我们将继续用我们的发现更新这个答案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T16:08:17.500

看看这个线程：

[如何在 Access 开发中使用版本控制？](https://stackoverflow.com/questions/187506/how-do-you-use-version-control-with-access-development)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T15:44:42.460

听起来是一种非常痛苦的团队发展方式。如果您有任何移植到另一个环境（如 VS2008）的选项，那将是我的建议。

作为一个团队使用 Access 并没有简单的方法，甚至版本控制也可能有点棘手。

# postgresql - 在 postgresql 中使用 plpgsql 有什么好处

> ID：247301
> 
> 赞同：8
> 
> 时间：2008-10-29T15:42:09.690
> 
> 标签：postgresql, stored-procedures, plpgsql

除了语法糖和表达能力之外，运行时效率的差异是什么。我的意思是，plpgsql 可以比 plpythonu 或 pljava 更快？还是它们都大致相等？

我们正在使用存储过程来检测中等大小的数据库（大约 10M 的记录）中几乎重复的人员记录

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-29T15:54:59.850

我相信 plpgsql 提供了更高的类型安全性，如果您想使用两个相似类型的不同列（如 varchar 和 text 或 int4 和 int8）执行操作，则必须执行显式转换。这很重要，因为如果您需要存储的 proc 使用索引，postgres 要求类型在连接条件之间完全匹配（编辑：我认为也用于相等性检查）。

其他语言可能有这个功能，但我没有使用过。无论如何，我希望这能为您的调查提供一个更好的起点。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-11-22T20:44:25.147

plpgsql 与 SQL 很好地集成 - 源代码应该非常干净和可读。对于 PLJava 或 PLPython 等 SQL 语言，必须隔离 SQL 语句 - SQL 不是语言的一部分。所以你必须写更多的代码。如果你的过程有很多 SQL 语句，那么 plpgsql 过程应该更干净、更短、更快。当您的过程没有 SQL 语句时，来自外部语言的过程可以更快 - 但外部语言（解释）需要一些时间来初始化 - 所以对于简单的任务，SQL 或 plpgsql 语言的过程应该更快。

当您需要一些功能时使用外部语言，例如访问网络、访问文件系统 - [http://www.postgres.cz/index.php/PL/Perlu_-_Untrusted_Perl_%28en%29](http://www.postgres.cz/index.php/PL/Perlu_-_Untrusted_Perl_%28en%29)

我所知道的——人们通常使用 PL 语言的组合——（SQL、plpgsql、plperl）或（SQL、plpgsql、plpython）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T22:19:23.067

如果不进行实际测试，我希望 plpgsql 比其他语言更高效，因为它很小。话虽如此，请记住 SQL 函数可能比 plpgsql 更快，如果一个函数足够简单，您可以只用 SQL 编写它。

# mysql - 散列密码字段使用什么数据类型和长度？

> ID：247304
> 
> 赞同：298
> 
> 时间：2008-10-29T15:44:47.373
> 
> 标签：mysql, hash, types, passwords, cryptography

我不确定密码哈希是如何工作的（稍后将实现它），但现在需要创建数据库模式。

我正在考虑将密码限制为 4-20 个字符，但据我所知，加密哈希字符串后的长度会不同。

那么，如何将这些密码存储在数据库中呢？

* * *

## 回答 #1

> 赞同：473
> 
> 时间：2008-10-29T17:12:11.177

更新：简单地使用散列函数不足以存储密码。您应该阅读[Gilles 在此线程上的答案](https://stackoverflow.com/a/55753734/20860)以获得更详细的解释。

对于密码，请使用增强密钥的哈希算法，例如 Bcrypt 或 Argon2i。例如，在 PHP 中，使用[password_hash() 函数](https://www.php.net/manual/en/function.password-hash.php)，该函数默认使用 Bcrypt。

```
$hash = password_hash("rasmuslerdorf", PASSWORD_DEFAULT); 
```

结果是一个 60 个字符的字符串，类似于以下内容（但数字会有所不同，因为它会生成唯一的盐）。

```
$2y$10$.vGA1O9wmRjrwAVXD98HNOgsNpDczlqm3Jq7KnEd1rVAGv3Fykk1a 
```

使用 SQL 数据类型`CHAR(60)`来存储 Bcrypt 哈希的这种编码。请注意，此函数不编码为十六进制数字字符串，因此我们不能轻松地将其取消十六进制以存储为二进制。

其他哈希函数仍然有用，但不能用于存储密码，所以我将保留下面的原始答案，写于 2008 年。

* * *

这取决于您使用的散列算法。无论输入如何，散列总是产生相同长度的结果。通常将二进制散列结果用文本表示为一系列十六进制数字。或者您可以使用该[`UNHEX()`](http://dev.mysql.com/doc/refman/5.5/en/string-functions.html#function_unhex)函数将一串十六进制数字减半。

*   MD5 生成一个 128 位的哈希值。您可以使用 CHAR(32) 或 BINARY(16)
*   SHA-1 生成一个 160 位的哈希值。您可以使用 CHAR(40) 或 BINARY(20)
*   SHA-224 生成一个 224 位的哈希值。您可以使用 CHAR(56) 或 BINARY(28)
*   SHA-256 生成一个 256 位的哈希值。您可以使用 CHAR(64) 或 BINARY(32)
*   SHA-384 生成一个 384 位的哈希值。您可以使用 CHAR(96) 或 BINARY(48)
*   SHA-512 生成一个 512 位的哈希值。您可以使用 CHAR(128) 或 BINARY(64)
*   BCrypt 生成一个依赖于实现的 448 位哈希值。[您可能需要 CHAR(56)、CHAR(60)、CHAR(76)、BINARY(56) 或 BINARY(60)](https://stackoverflow.com/questions/5881169/storing-a-hashed-password-bcrypt-in-a-database-type-length-of-column)

截至 2015 年，NIST建议在任何需要互操作性的哈希函数应用中[使用 SHA-256 或更高版本。](https://csrc.nist.gov/Projects/Hash-Functions/NIST-Policy-on-Hash-Functions)但 NIST 不建议使用这些简单的散列函数来安全地存储密码。

较小的散列算法有其用途（如应用程序内部，而不是用于交换），但[众所周知，它们是可破解](http://web.archive.org/web/20081222011930/http://www.larc.usp.br/~pbarreto/hflounge.html)的。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2019-04-18T21:07:12.677

# 始终使用密码散列算法：[Argon2](https://en.wikipedia.org/wiki/Argon2)、[scrypt](https://en.wikipedia.org/wiki/Scrypt)、[bcrypt](https://en.wikipedia.org/wiki/Bcrypt)或[PBKDF2](https://en.wikipedia.org/wiki/PBKDF2)。

[Argon2](https://en.wikipedia.org/wiki/Argon2)赢得了 2015 年密码哈希竞赛。[Scrypt](https://en.wikipedia.org/wiki/Scrypt)、[bcrypt](https://en.wikipedia.org/wiki/Bcrypt)和[PBKDF2](https://en.wikipedia.org/wiki/PBKDF2)是较旧的算法，现在被认为不太受欢迎，但从根本上来说仍然是合理的，所以如果你的平台还不支持 Argon2，现在可以使用另一种算法。

切勿将密码直接存储在数据库中。也不要对其进行加密：否则，如果您的网站遭到破坏，攻击者将获得解密密钥，因此可以获得所有密码。密码必须经过*哈希处理*。

*密码散列*具有与散列表散列或加密散列不同的属性。切勿在密码上使用普通的加密哈希，例如 MD5、SHA-256 或 SHA-512。密码散列算法使用*salt*，它是唯一的（不用于任何其他用户或任何其他人的数据库）。盐是必要的，这样攻击者就不能只预先计算常见密码的哈希值：使用盐，他们必须为每个帐户重新开始计算。密码散列算法*本质上很慢*- 尽可能慢。缓慢对攻击者的伤害比对您的伤害更大，因为攻击者必须尝试许多不同的密码。有关详细信息，请参阅[如何安全地散列密码](http://security.stackexchange.com/questions/211/how-to-securely-hash-passwords)。

密码哈希编码四条信息：

*   使用哪种算法的指示符。这对于[敏捷性](https://en.wikipedia.org/wiki/Crypto_agility)是必要的：加密建议会随着时间而变化。您需要能够过渡到新算法。
*   难度或硬度指标。该值越高，计算散列所需的计算量就越多。这应该是密码更改功能中的一个常量或全局配置值，但随着计算机变得更快，它应该随着时间的推移而增加，因此您需要记住每个帐户的值。有些算法只有一个数值，有些算法有更多参数（例如分别调整 CPU 使用率和 RAM 使用率）。
*   盐。由于盐必须是全局唯一的，因此必须为每个帐户存储它。每次更改密码时都应随机生成盐。
*   散列本身，即散列算法中数学计算的输出。

许多库包含一对函数，可以方便地将这些信息打包为单个字符串：一个接受算法指标、硬度指标和密码，生成随机盐并返回完整的哈希字符串；一个将密码和完整的哈希字符串作为输入并返回一个布尔值，指示密码是否正确。没有通用标准，但通用编码是

```
$*算法*$*参数*$*盐*$*输出*
```

其中`*algorithm*`是一个数字或一个短的字母数字字符串，编码算法的选择，`*parameters*`是一个可打印的字符串，并且`*salt*`在`*output*`Base64 中编码而没有终止`=`。

16 个字节足以用于盐和输出。（参见例如[Argon2 的建议](https://argon2-cffi.readthedocs.io/en/stable/parameters.html)。）以 Base64 编码，每个 21 个字符。其他两部分取决于算法和参数，但通常为 20-40 个字符。总共**大约有 82 个 ASCII 字符**（`CHAR(82)`，并且不需要 Unicode），如果您认为以后很难扩大该字段，则应该在其中添加安全边际。

如果您以二进制格式对哈希进行编码，您可以将其缩减为算法的 1 个字节，硬度为 1-4 个字节（如果您对某些参数进行硬编码），盐和输出各 16 个字节, 总共 37 个字节。说**40 字节**( `BINARY(40)`) 至少有几个备用字节。请注意，这些是 8 位字节，不是可打印的字符，特别是该字段可以包含空字节。

请注意，哈希的长度与密码的长度完全无关。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-29T15:53:24.207

您实际上可以使用`CHAR`*(散列长度)*来定义 MySQL 的数据类型，因为每个散列算法将始终计算出相同数量的字符。例如，`SHA1`总是返回一个 40 个字符的十六进制数。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-29T15:50:12.667

您可能会发现这篇关于加盐的 Wikipedia 文章很有[价值](http://en.wikipedia.org/wiki/Password_salt)。这个想法是添加一组数据来随机化你的哈希值；如果有人未经授权访问密码哈希，这将保护您的密码免受字典攻击。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-29T15:47:20.287

作为一个固定长度的字符串（VARCHAR(n) 或者 MySQL 调用它）。散列始终具有固定长度，例如 12 个字符（取决于您使用的散列算法）。所以一个 20 字符的密码会减少到一个 12 字符的哈希值，而一个 4 字符的密码也会产生一个 12 字符的哈希值。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2017-07-25T22:32:03.343

`TEXT`为了向前兼容，您应该使用（存储无限数量的字符）。散列算法（需要）随着时间的推移变得更强大，因此这个数据库字段将需要随着时间的推移支持更多的字符。此外，根据您的迁移策略，您可能需要将新旧哈希存储在同一字段中，因此不建议将长度固定为一种类型的哈希。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-29T15:59:51.307

哈希是一系列位（128 位、160 位、256 位等，具体取决于算法）。如果 MySQL 允许，您的列应该是二进制类型的，而不是文本/字符类型的（SQL Server 数据类型是`binary(n)`or `varbinary(n)`）。你还应该给哈希加盐。盐可能是文本或二进制，您将需要相应的列。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-29T15:54:33.750

这实际上取决于您使用的散列算法。如果我没记错的话，密码的长度与哈希的长度几乎没有关系。查看您正在使用的散列算法的规范，运行一些测试，然后在上面截断。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-29T15:48:06.477

我一直在测试找到加密字符串的最大字符串长度并将其设置为 VARCHAR 类型的字符长度。根据您将拥有多少条记录，它确实可以帮助数据库大小。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-05-29T07:05:52.183

对于 md5 vARCHAR(32) 是合适的。对于那些使用 AES 的人来说，最好使用 varbinary。

# jquery - 在动态修改的表上使用 jQuery tableSorter

> ID：247305
> 
> 赞同：22
> 
> 时间：2008-10-29T15:45:36.653
> 
> 标签：jquery, tablesorter

我在页面上使用 jQuery tableSorter 插件。

不幸的是，正在排序的表格是动态修改的，当我在添加元素后进行排序时，该元素消失了，将表格恢复到创建 tableSorter 时的状态。

有什么方法可以强制 tableSorter 重新扫描页面，以便正确排序这些新元素？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-29T15:47:59.957

我相信您可以使用以下方式触发更新：

```
$(table).trigger("update") 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-12T19:27:01.083

看来你是对的。

```
$(table).trigger("更新");
$(table).trigger("appendCache");

```

成功了。

需要注意的是，tablesorter API 在某些时候发生了变化，因此这些事情以及事件绑定都发生了变化。我最大的困扰是试图弄清楚为什么有些东西有效而另一些无效，这是由于插件版本错误，尽管没有明显的区别。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-06-15T14:07:38.250

抛出`$(table).trigger("update");`错误

```
 Uncaught TypeError: Cannot read property 'rows' of undefined 
```

因此，有一个 jquery 函数`.ajaxStop()`被`tablesorter()`调用。不要调用 tablesorter`.ready()`

```
 jQuery(document).ajaxStop(function(){
      jQuery("#table_name").tablesorter();
    }) 
```

哪个完成了工作

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-02-18T09:40:29.037

对于像我这样面临排序动态生成表问题的新手，这里是解决方案。前面给出的答案是正确的，但是你把这个命令放在哪里呢？

```
$('#tableId').tablesorter().trigger('update'); 
```

将数据附加到表后，您需要立即放置它。前在我的情况下

```
var tableData = "<thead><tr><th>Name</th><th>Age</th></thead><tbody><tr><td>Izaki</td><td>24</td><tr><tr><td>Serizawa</td><td>25</td></tr>";
$('#tableId').html('tableData');
$('#tableId').tablesorter().trigger('update'); 
```

# dispose - SqlDataReader：在这种情况下，阅读器会被关闭吗？

> ID：247311
> 
> 赞同：2
> 
> 时间：2008-10-29T15:46:32.783
> 
> 标签：dispose, .net-1.1, sqldatareader, datareader

我正在清理我继承的旧 .NET 1.1 项目中的 DataReaders。

之前的开发人员对数据访问层进行了编码，使得大多数 DAL 方法都返回 SqlDataReaders（因此将其留给调用者来正确调用 .Close() 或 .Dispose() 方法）。

但是，我遇到了一种情况，调用者没有捕获返回的 SqlDataReader （因此没有正确处理它）。请看下面的代码：

数据访问方法：

```
Public Shared Function UpdateData() As SqlDataReader
   ...

   drSQL = cmdSQL.ExecuteReader(CommandBehavior.CloseConnection)

   Return drSQL

End Function 
```

调用代码：

```
...
DataAccessLayer.UpdateData()
... 
```

如您所见，调用方法没有接收/捕获返回的 SqlDataReader。那么会发生什么？那个 SqlDataReader 还在那里并打开吗？或者它会自动收集垃圾，因为没有任何东西可以解决它？

我想不出调试和测试的方法。如果有人有任何想法或建议，那就太好了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T16:09:12.207

我相信它会被关闭，但直到垃圾收集器得到它，这可能不会持续很长时间......

# c# - 我可以在 .NET 中像数字一样格式化字符串吗？

> ID：247313
> 
> 赞同：4
> 
> 时间：2008-10-29T15:47:18.697
> 
> 标签：c#, .net, formatting

如果我有这样的电话号码

```
string phone = "6365555796"; 
```

我在我的数据库中仅存储数字字符**（作为字符串）**，是否可以像这样输出数字：

```
"636-555-5796" 
```

类似于我使用数字时的方法：

```
long phone = 6365555796;
string output = phone.ToString("000-000-0000"); 
```

我试过搜索，我在网上只能找到数字格式的文档。

我问的原因是因为我认为能够仅将数值存储在数据库中并允许使用常量字符串值来指定我的电话号码格式的不同格式是一个有趣的想法。还是我最好为此使用一个数字？

编辑：问题是格式化一个包含数字的字符串，而不是数字本身。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T16:11:47.773

我能想到的最好的无需转换为长/数字，因此它适合一行是：

```
string number = "1234567890";
string formattedNumber = string.Format("{0}-{1}-{2}", number.Substring(0,3), number.Substring(3,3), number.Substring(6)); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-29T16:23:46.547

请注意，并非所有人都使用北美 3-3-4 格式的电话号码。欧洲电话号码最长可达 15 位，带有重要的标点符号，例如 +44-XXXX-XXXX-XXXX 与 44+XXXX-XXXX-XXXX 不同。您也没有考虑 PBX 和分机，它们可能需要超过 30 位数字。

军用电话和无线电电话可以有字母字符，这不是您在按键式电话上看到的“2”=“ABC”。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-29T16:44:29.610

简单版：

```
string phone = "6365555796";
Convert.ToInt64(phone).ToString("000-000-0000"); 
```

围绕它进行一些验证并将其放入一个不错的方法中：

```
string FormatPhone(string phone)
{
   /*assume the phone string came from the database, so we already know it's
     only digits.  If this changes in the future a simple RegEx can validate 
     (or correct) the digits requirement. */

   // still want to check the length:
   if (phone.Length != 10) throw new InvalidArgumentException();

  return Convert.ToInt64(phone).ToString("000-000-0000");
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-29T16:07:48.827

我认为这行得通

```
string s = string.Format("{0:###-###-####}", ulong.Parse(phone)); 
```

此外，这个[http://blog.stevex.net/index.php/string-formatting-in-csharp/](http://blog.stevex.net/index.php/string-formatting-in-csharp/)是一篇关于在 .NET 中格式化字符串的好文章。

感谢@swilliams 的澄清。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T15:50:54.570

为什么不做这样的事情呢？

```
string phoneText = "6365555796";
long phoneNum = long.Parse(phoneText);
string output = phoneNum.ToString("000-000-0000"); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T17:23:41.950

我爱我一些扩展方法操作：

```
 /// <summary>
   ///   Formats a string of nine digits into a U.S. phone number.
   /// </summary>
   /// <param name="value">
   ///   The string to format as a phone number.
   /// </param>
   /// <returns>
   ///   The numeric string as a U.S. phone number.
   /// </returns>
   public static string
   ToUSPhone (this string value)
   {
      if (value == null)
      {
         return null;
      }

      long  dummy;

      if ((value.Length != 10) ||
         !long.TryParse (
            value,
            NumberStyles.None,
            CultureInfo.CurrentCulture,
            out dummy))
      {
         return value;
      }

      return string.Format (
         CultureInfo.CurrentCulture,
         "{0}-{1}-{2}",
         value.Substring (0, 3),
         value.Substring (3, 3),
         value.Substring (6));
   } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T15:52:20.213

您可能会在给定的字符点插入字符串。有点像：phone = phone.Insert(3, "-"); 电话=电话。插入（7，“-”）；

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T21:21:57.507

当然：

```
Regex.Replace(phone, @"^(\d{3})(\d{3})(\d{4})$", @"$1-$2-$3") 
```

当然，[现在你有两个问题](http://www.codinghorror.com/blog/archives/001016.html)。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-29T16:05:03.433

要控制数字的字符串格式以在 ASP.NET Gridview 或其他控件中显示，您可以将项目包装在帮助器类中以用于显示目的：

```
public class PhoneDisplay
{
    long phoneNum;
    public PhoneDisplay(long number)
    {
        phoneNum = number;
    }
    public override string ToString()
    {
        return string.Format("{0:###-###-####}", phoneNum);
    }

} 
```

然后，将数据或显示字段定义为（例如）：

```
PhoneDisplay MyPhone = new PhoneDisplay(6365555796); 
```

# database - Oracle - 使用 MS Access 的 ODBC 连接错误 (ORA-12154)

> ID：247317
> 
> 赞同：2
> 
> 时间：2008-10-29T15:47:35.310
> 
> 标签：database, oracle, ms-access, odbc, ora-12154

我正在尝试使用 MS 访问连接到 Oracle 数据库。我不断收到以下错误消息：

ORA-12154: TSN- 无法解析指定的连接标识符

Oracle Drivers OracleClient10g 可以验证数据库服务器是否存在。

我的 tsnnames.ora 文件中有一个部分如下所示： UBASEP10G = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = bxxx-xxx.yyyy.com)(PORT = 1521)) ) ( CONNECT_DATA = (SERVICE_NAME = UBASE) ) )

根据我解决此错误的尝试，我将其添加到 sqlnet.ora 文件中：

NAMES.DIRECTORY_PATH=（主机名、ONAMES、TNSNAMES、LDAP、EZCONNECT）

使用 Windows ODBC 驱动程序配置实用程序时，它会询问以下信息 DATA SOURCE NAME : MYSOURCE NAME TSN SERVICE NAME:UBASEP10G USERID:MYUSERID

有什么建议么 ？？？？？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T16:08:48.900

我没有 Access，但使用 Excel 2007，我必须执行以下操作：

1.  打开 ODBC 管理员（在管理员控制面板中）
2.  对于用户 DSN 或系统 DSN，单击添加...
3.  选择“Oracle in OraDb10g_home1”作为驱动程序
4.  在 Oracle ODBC 驱动程序配置中，我输入了：
    *   数据源名称：myOracleDsn
    *   描述：这是我的 Oracle 数据库的 DSN
    *   TNS 服务名称： oratns
    *   用户名：斯科特
5.  单击测试连接，然后输入“tiger”作为密码。显然，我正在连接到我的 scott/tiger 示例 Oracle 数据库。此外，当我安装 Oracle 时，我选择了 oratns 作为我的 TNS 名称。上面的其他两个值是任意的——您将在 Excel 的对话框中看到它们。
6.  如果测试有效，请单击“确定”。
7.  转到 Excel 并与 DSN 建立新连接。该对话框将显示“myOracleDsn”作为选项。选择它，再次输入“tiger”作为密码，你应该得到一个有效的连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T16:50:16.213

您可以通过 SQL*Plus 登录到相关数据库吗？从具有工作连接的另一台机器（或数据库服务器本身）执行此操作也可以。

如果是这样，运行这个：

```
select value from v$parameter where name='service_names'; 
```

在您的 TNSNAMES.ORA 中，为 SERVICE_NAME 使用其中列出的值之一。

在您的 ODBC 连接中，您只需将 TNS 服务名称设置为您在上面使用的名称“UBASEP10G”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:08:46.797

尝试 tnsping 并报告您的结果。

坏的：

```
C:\>tnsping notreal.world

TNS Ping Utility for 32-bit Windows: Version 9.2.0.5.0 - Production on 29-OCT-2008 15:56:47

Copyright (c) 1997 Oracle Corporation.  All rights reserved.

Used parameter files:
C:\oracle\ora92\network\admin\sqlnet.ora

TNS-03505: Failed to resolve name 
```

好的：

```
O:\>tnsping real.world

TNS Ping Utility for 32-bit Windows: Version 9.2.0.5.0 - Production on 29-OCT-2008 15:57:42

Copyright (c) 1997 Oracle Corporation.  All rights reserved.

Used parameter files:

C:\oracle\ora92\network\admin\sqlnet.ora

Used TNSNAMES adapter to resolve the alias
Attempting to contact (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)
(HOST = DBSERVER.DOMAIN.COM)(PORT = 1521)) (LOAD_BALANCE = YES) (FAILOVER = YES))
(CONNECT_DATA = (SERVICE_NAME = REAL.WORLD) 
(FAILOVER_MODE = (TYPE = SELECT) (METHOD = BASIC) (RETRIES = 10) (DELAY = 3))))
OK (40 msec) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T16:22:59.077

尝试在 TNSNAMES.ora 文件中将 (CONNECT_DATA = (SERVICE_NAME = UBASE) ) 更改为 (CONNECT_DATA = (SID = UBASE) )。

ServiceName 和 SID 不一定相同，因此并不总是可以互换的。

SERVICENAME 参数引用在数据库服务器上的 listener.ora 文件中指定的特定 GLOBAL_DBNAME。它是服务器上实例的别名。您可以在引用相同 SID 的服务器上拥有多个服务名称。SID 参数是指该服务器上的特定实例。

在客户端使用 servicename 的优点是 DBA 可以将 servicename 引用的实际实例透明地更改给使用该名称的客户端。我可以在服务器 listener.ora 文件中有这个：

```
(SID_DESC =
  (GLOBAL_DBNAME = THESERVICE)
  (ORACLE_HOME = d:\oracle\10.2.0_DB)
  (SID_NAME = SID1) 
```

稍后，我可以通过切换 listener.ora 配置来更改实际引用的数据库：

```
(SID_DESC =
  (GLOBAL_DBNAME = THESERVICE)
  (ORACLE_HOME = d:\oracle\10.2.0_DB)
  (SID_NAME = SID2) 
```

在客户端，没有人更聪明。客户端上的 tnsnames.ora 文件无需更改。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T17:20:30.317

让我们回到第一方。打开命令窗口并连接到您的数据库：

sqlplus myuserid/mypassword@UBASEP10G

这样连接成功吗？

既然答案是否定的，有没有办法可以成功连接到这个数据库？BQ 是对的，你的问题出在 UBASE 的服务名上。您需要确定服务器上的侦听器认为该数据库的名称是什么。您有权访问服务器吗？你可以在服务器上执行命令“lsnrctl status”吗？这将告诉您向侦听器注册的服务，如下所示：

```
Services Summary...
Service "UBASE" has 1 instance(s).
  Instance "UBASE", status READY, has 1 handler(s) for this service... 
```

# php - 带有空字符串的 PHP SimpleXML::addChild - 冗余节点

> ID：247318
> 
> 赞同：3
> 
> 时间：2008-10-29T15:47:57.070
> 
> 标签：php, simplexml, addchild

使用空字符串作为值（甚至使用空格）调用 addChild 似乎会导致在节点内添加冗余 SimpleXml 节点，而不是仅添加没有值的节点。

这是发生的事情的快速演示：

```
[description] => !4jh5jh1uio4jh5ij14j34io5j! 
```

这是一个空字符串：

```
[description] => SimpleXMLElement Object ( [0] => ) 
```

我目前使用的解决方法非常糟糕——我正在对最终的 JSON 进行 str_replace 替换！4jh5jh1uio4jh5ij14j34io5j！带有一个空字符串。呸。也许此时唯一的答案是“向 simplexml 提交错误报告”......

有没有人有更好的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T04:37:31.917

使用 SimpleXML，如果使用 print_r()、var_dump()、serialize() 或类似方法，您得到的结果与对象内部存储的内容不对应。它是一个“神奇”的对象，它重载了 PHP 交互其内容的方式。

您只能使用 AsXML() 获得元素的真实表示。

当诸如 print_r() 之类的东西遍历 SimpleXML 元素或您使用 -> 运算符访问其属性时，您将获得该对象的 munged 版本。这个 munged 版本允许您执行诸如 "echo $xml->surname" 或 $xml->names[1] 之类的操作，就好像它确实具有这些属性一样，但与包含在以下内容中的真正 XML 是分开的：在 munged 表示元素中不一定按顺序排列，名称为 PHP 保留字（如“var”）的元素不会显示为属性，但可以使用 $xml["var"] 之类的代码访问 - 就好像对象是关联数组一样. 在多个同级元素具有相同名称的情况下，它们像数组一样呈现。我猜由于某种原因，空字符串也像数组一样呈现。但是，当使用 AsXML() 输出时，您会得到真实的表示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T11:10:16.173

I think I figured out what is going on. Given code like this:

```
$xml = new SimpleXMLElement('<xml></xml>');
$xml->addChild('node','value');
print_r($xml);

$xml = new SimpleXMLElement('<xml></xml>');
$xml->addChild('node','');
print_r($xml);

$xml = new SimpleXMLElement('<xml></xml>');
$xml->addChild('node');
print_r($xml); 
```

The output is this:

```
SimpleXMLElement Object
(
    [node] => value
)
SimpleXMLElement Object
(
    [node] => SimpleXMLElement Object
        (
            [0] => 
        )

)
SimpleXMLElement Object
(
    [node] => SimpleXMLElement Object
        (
        )

) 
```

So, to make it so that in case #2 the empty element isn't created (i.e. if you don't know if the second argument is going to be an empty string or not), you could just do something like this:

```
$mystery_string = '';

$xml = new SimpleXMLElement('<xml></xml>');
if (preg_match('#\S#', $mystery_string)) // Checks for non-whitespace character
  $xml->addChild('node', $mystery_string);
else
  $xml->addChild('node');

print_r($xml);
echo "\nOr in JSON:\n";
echo json_encode($xml); 
```

To output:

```
SimpleXMLElement Object
(
    [node] => SimpleXMLElement Object
        (
        )

)

Or in JSON:
{"node":{}} 
```

Is that what you want?

Personally, I never use SimpleXML, and not only because of this sort of weird behavior -- it is still under major development and in PHP5 is missing like 2/3 of the methods you need to do DOM manipulation (like deleteChild, replaceChild etc).

I use DOMDocument (which is standardized, fast and feature-complete, since it's an interface to libxml2).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T04:53:32.737

I've created an Xml library to which extends the simpleXml object to include all of the functionally that is present in the DOMDocument but is missing an interface from SimpleXml (as the two functions interact with the same underlying libxml2 object --by reference). It also has niceties such as AsArray() or AsJson() to output your object in one of those formats.

I've just updated the library to work as you expect when outputting JSON. You can do the following:

```
$xml = new bXml('<xml></xml>');
$xml->addChild('node', '');
$json_w_root = $xml->asJson(); // is { 'xml': {'node':'' } }
$json = $xml->children()->asJson(); // is { 'node' : '' } as expected. 
```

The library is hosted on google code at [http://code.google.com/p/blibrary/](http://code.google.com/p/blibrary/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T15:57:39.953

也许我没有正确理解这个问题，但是在我看来，当您使用 addChild 方法时，无论节点中有什么内容，都需要一个字符串作为节点名称的参数。该值（第二个参数）是可选的，可以留空以添加和清空节点。

让我知道这是否有帮助。

# c++ - 将托管 C++ 从 vs2003 移植到 vs2008 的问题

> ID：247327
> 
> 赞同：0
> 
> 时间：2008-10-29T15:49:28.987
> 
> 标签：c++, visual-studio-2008, managed, visual-studio-2003

试图将我的托管 c++ 项目从 vs2003 移植到 vs2008。我添加了 oldSyntax 标志。但我仍然收到错误 sourceanonotations.h。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T16:02:20.583

我们有一个项目是用 C++ 的托管扩展编写的，它根本无法使用 /clr:oldSyntax 在 VS2005 中编译。

不幸的是，您的选择是继续使用 VS2003 构建它，或者将其转换为 C++/CLI（或者抱怨微软，但我不会抱太大希望）。

我们已经完成了许多项目的翻译，这很乏味，但相当直接。

或者，如果有其他解决方案，我想在这里，这样我们就可以淘汰我们仍然为此目的运行 VS2003 的构建机器！

# javascript - 重构 HTML 生成的 JavaScript

> ID：247329
> 
> 赞同：1
> 
> 时间：2008-10-29T15:50:17.940
> 
> 标签：javascript, html, string-concatenation

不幸的是，在我的项目中，我们在 JavaScript 中生成了大量的 HTML 代码，如下所示：

```
var html = new StringBuffer();
html.append("<td class=\"gr-my-deals\"><a href=\"").append(deal.url).append("\" target=\"_blank\">").append(deal.description).append("</a></td>"); 
```

我对此有两个具体的抱怨：

1.  在 HTML 字符串中使用转义双引号 (\")。这些应替换为单引号 (') 以提高可读性。
2.  使用 .append() 代替 JavaScript 字符串连接运算符“+”</li>

应用这两个建议，生成以下等效的代码行，我认为它更具可读性：

```
var html = "<td class=’gr-my-deals’&gt;<a href=’" + deal.url + "’ target=’_blank’&gt;" + deal.description + "</a></td>"; 
```

我现在正在寻找一种将第一行代码自动转换为第二行的方法。到目前为止，我想出的只是对我们所有的 Javascript 代码运行以下查找和替换：

```
Find:    ).append(  
Replace: + 
```

这会将上面显示的代码行转换为：

```
html.append("<td class=\"gr-my-deals\"><a href=\"" + deal.url + "\" target=\"_blank\">" + deal.description + "</a></td>)"; 
```

这应该安全地删除除第一个“append()”语句之外的所有语句。不幸的是，我想不出任何安全的方法来自动将转义的双引号转换为单引号。请记住，我不能简单地进行查找/替换，因为在某些情况下您确实需要使用转义的双引号。通常，这是在您生成包含嵌套 JS 的 HTML 并且 JS 包含字符串参数时，例如

```
function makeLink(stringParam) {

  var sb = new StringBuffer();
  sb.append("<a href=\"JavaScript:myFunc('" + stringParam + "');\">");
} 
```

我的问题（最后）是：

*   有没有更好的方法来安全地用 '+' 替换对 'append()' 的调用
*   有没有办法用单引号，正则表达式安全地替换转义的双引号？

干杯，唐

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T16:05:00.627

考虑切换到[JavaScript 模板处理器](https://stackoverflow.com/questions/tagged/javascript%20templates)。它们通常相当轻巧，并且可以显着提高代码的清晰度......以及性能，如果您有很多重用并选择一个预编译模板的话。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T16:00:46.827

这是一个 stringFormat 函数，有助于消除连接和丑陋的替换值。

```
function stringFormat( str ) {

    for( i = 0; i < arguments.length; i++ ) {
        var r = new RegExp( '\\{' + ( i ) + '\\}','gm' );

        str = str.replace( r, arguments[ i + 1 ] );    
    }
    return str;
} 
```

像这样使用它：

```
var htmlMask = "<td class=’gr-my-deals’&gt;<a href=’{0}’ target=’_blank’&gt;{1}</a></td>";

var x = stringFormat( htmlMask, deal.Url, deal.description ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T19:39:37.667

正如 Shog9 所暗示的，有几个很好的 JavaScript 模板引擎。这是一个如何使用我的[jQuery Simple Templates](http://plugins.jquery.com/project/simple-templates)的示例：

```
var tmpl, vals, html;

tmpl  = '<td class="gr-my-deals">';
tmpl += '<a href="#{href}">#{text}</a>';
tmpl += '</td>';

vals  = {
    href : 'http://example.com/example',
    text : 'Click me!'
};

html  = $.tmpl(tmpl, vals); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T00:55:29.977

在 JavaScript 中应该使用 StringBuffer() 而不是字符串连接是有充分理由的。StringBuffer() 及其 append() 方法使用 Array 和 Array 的 join() 将字符串组合在一起。如果您有大量要连接的部分字符串，则已知这是一种更快的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-30T00:40:40.063

模板？模板很烂！这是我编写代码的方式：

```
TD({ "class" : "gr-my-deals" },
   A({ href : deal.url,
       target : "_blank"},
     deal.description )) 
```

我使用一个名为 DOMination 的 20 行库，我会将它发送给任何需要的人，以支持此类代码。

优点是多方面的，但其中一些最明显的是：

*   清晰、直观的代码
*   易学易写
*   紧凑的代码（没有关闭标签，只有右括号）
*   被支持 JavaScript 的编辑器、压缩器等很好理解
*   解决了一些特定于浏览器的问题（例如 IE 上的 rowSpan 和 rowspan 之间的区别）
*   与 CSS 很好地集成

（顺便说一句，您的示例突出了 DOMination 的唯一缺点：`class`在这种情况下，任何同时也是 JavaScript 保留字的 HTML 属性都必须被引用，以免发生坏事。）

# html - 使用类将 CSS 应用于文本输入

> ID：247331
> 
> 赞同：2
> 
> 时间：2008-10-29T15:50:54.490
> 
> 标签：html, css, jquery-validate

我在我正在构建的表单上使用 jQuery 验证，它工作得很好。我想要做的是当文本字段更改颜色并将错误消息变为白色时某些内容无效。我认为以下 CSS 会起作用：

```
label .error {color: white; font-weight: bold;}
input .error {background-color: pink; border: 1px dashed red; color: white} 
```

当我测试验证时，上面的 CSS 似乎并不适用。我使用 Firebug 进行了检查，标签和输入区域应用了“错误”类。

CSS 似乎是有效的，因为当我离开 .error 子句时，一切看起来我也想要它。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-29T15:52:52.723

一个空间可能太多了。尝试：

```
label.error {color: white; font-weight: bold;}
input.error {background-color: pink; border: 1px dashed red; color: white} 
```

背景资料：

```
label .error  /* selects all elements of class "error" *within* any label */
label.error   /* selects labels of class "error"                          */ 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T15:52:41.070

尝试不带空格的 label.error 和 input.error。

# maven-2 - 如何在 JUnit 测试中检索 Maven 属性？

> ID：247346
> 
> 赞同：21
> 
> 时间：2008-10-29T15:53:19.633
> 
> 标签：maven-2, junit

我正在为文件解析器类编写测试。parse 方法接收一个文件名作为参数，并且必须打开它才能解析它（duh）。

我已经编写了一个测试文件，将其放入项目目录中的 test/resources 目录中，并希望通过该文件来测试我的解析。由于这个项目在 CVS 中，并且会被其他人操作，我不能硬编码文件路径，所以我想在我的测试中使用 maven ${basedir} 属性来构建文件名。就像是：

```
public void parseTest() {
    ...
    sut.parse( ${basedir} + "src/test/resources/testFile" );
    ...
} 
```

有人知道我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-29T17:03:16.593

您有 2 个选项：

1）通过系统属性（[docs](http://maven.apache.org/plugins/maven-surefire-plugin/examples/system-properties.html)）将文件路径传递给您的测试

在您的 pom 中，您可以执行以下操作：

```
<project>
  [...]
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>2.4.2</version>
        <configuration>
          <systemProperties>
            <property>
              <name>filePath</name>
              <value>/path/to/the/file</value>
            </property>
          </systemProperties>
        </configuration>
      </plugin>
    </plugins>
  </build>
  [...]
</project> 
```

然后在您的测试中，您可以执行以下操作：

```
System.getProperty("filePath"); 
```

2）将文件放在与测试类相同的包下的 src/test/resources 中。然后您可以使用 Class.getResourceAsStream(String fileName) ( [docs](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResourceAsStream(java.lang.String)) ) 访问该文件。

我强烈推荐选项 2 而不是选项 1。通过系统属性将内容传递给您的测试是非常肮脏的 IMO。它将您的测试不必要地与测试运行者结合起来，并且会在未来引起头痛。从类路径中加载文件是可行的方法，这就是 maven 具有资源目录概念的原因。

# build - 可用的构建工具（make 等）？

> ID：247350
> 
> 赞同：10
> 
> 时间：2008-10-29T15:54:01.130
> 
> 标签：build

这里有很多关于各种利基构建需求（.NET、持续集成等）的问题，但是，当然，我的利基需求是不同的。

我现在不想问一个非常具体的问题，而是想对可用的构建工具（如 make、ant 等）进行调查，以便在需要时更智能地提出后续问题。

在您的回答中，请包括：

*   **一个**构建工具
*   链接到有关该工具的主页
*   如果您知道一些优点和缺点（即，在带有 cygwin 的 Windows 上运行，或特定于 .NET 等），请列出一些（不需要 - 名称和链接是必需的）

如果您的构建工具已经在答案中，请对其添加优点/缺点/限制/经验进行评论。只要它们尚不存在，请随意添加任意数量的答案 - 但不要将多个构建工具放在一个答案中。

请注意，如果您重复答案，您可能会被否决 - 在评论中添加有关给定构​​建的其他信息。理想情况下，这些评论将随着时间的推移被纳入答案。

-亚当

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T16:05:45.773

[缺点](http://www.scons.org/)

构建脚本是 Python 脚本。应该在 Linux、Windows、Mac OS X 上工作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-29T15:59:46.160

**南安特**

[http://nant.sourceforge.net/](http://nant.sourceforge.net/)

类似于 Ant，.Net 的构建工具

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-29T16:13:46.833

[耙](http://rake.rubyforge.org/)

Ruby 版本的 make

优点：

*   干净的惯用 ruby​​ 语法
*   Rake 文件是用 ruby​​ 编写的，因此利用 ruby​​ 本身而不是专有文件格式或 XML
*   Ruby on Rails 与其紧密集成

缺点：

*   需要 ruby​​，但并不总是可用
*   没有内置的打包支持/版本控制/依赖管理（参见[ruby​​gems](http://rubyforge.org/projects/rubygems/)）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-29T17:02:27.500

[预制](http://premake.sourceforge.net/)

构建脚本生成器。使用 Lua 来描述构建。它可以为 Visual Studio、Code::Blocks、CodeLite、SharpDevelop、MonoDevelop 等生成 Makefile 或项目文件。内置支持 C、C++、C#，包括资源和 ASP.NET 等。单声道支持。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-29T17:27:50.800

果酱家族。

*   [果酱](http://www.perforce.com/jam/jam.html)
*   [FTJam](http://freetype.sourceforge.net/jam/)
*   [果酱](http://www.boost.org/doc/tools/jam/index.html)

BJam 基于 FTJam，而后者又基于 Jam。小巧、快速、便携。C、C++ 的自动依赖分析。它不是生成器——它不会为辅助构建系统生成任何 Makefile 或其他构建文件。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-29T15:57:26.677

**GNU 制作**

[http://www.gnu.org/software/make/](http://www.gnu.org/software/make/)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-29T15:58:50.310

[阿帕奇蚂蚁](http://ant.apache.org/)

临：

*   许多任务/插件
*   在许多平台上运行
*   很成熟
*   许多 IDE、Continuous-Integration-Tools 等都支持它。

缺点：

*   需要 Java

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-29T16:12:31.187

[阿帕奇马文](http://maven.apache.org/)

优点：

*   自动依赖管理
*   利用约定优于配置（强制一致的项目目录结构）
*   使用 maven 的项目可以在几分钟内构建
*   对标准 java/Java EE 项目构建的出色支持
*   在团队环境中运行良好（支持“团队”配置）
*   内置发布/版本控制概念
*   与流行的 Java IDE 集成
*   在 java OSS 社区中不断增长的支持

缺点：

*   陡峭的学习曲线（特别是与 Ant 相比）
*   糟糕的在线文档（虽然[新书](http://www.sonatype.com/community/definitive_guide.html)很棒）
*   有时令人惊讶的行为
*   非常以 java 为中心
*   XML 配置驱动

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-29T16:53:47.673

[制作](http://www.cmake.org/)

跨平台构建系统生成器。它可以为 Visual Studio、Eclipse CDT、KDevelop、Code::Blocks 等生成 Makefile 或项目文件。对 C、C++、Fortran、Java 进行自动依赖分析。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-21T19:33:23.290

[最终建造者](http://FinalBuilder.com)

优点

*   与 ant 或 make 不同，面向视觉和 GUI
*   很多内置动作
*   用于您自己的操作的脚本生成器
*   与 cc.net 轻松集成

缺点

*   仅在 Windows 上运行
*   不是免费的，但您物有所值

他们还有一个名为[Automise](http://www.automise.com/automise.aspx)的工具，可以执行更多面向系统的任务。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-04-15T12:48:01.303

[团队城市](http://www.jetbrains.com/teamcity/)

## 优点

*   [都可以在这里](http://www.jetbrains.com/teamcity/features/)

## 缺点

*   可能是内存密集型的

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-29T15:59:51.430

微软构建

[http://msdn.microsoft.com/en-us/library/wea2sca5(VS.80).aspx](http://msdn.microsoft.com/en-us/library/wea2sca5(VS.80).aspx)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-29T16:48:06.390

## **CruiseControl/CruiseControl .Net**

[http://cruisecontrol.sourceforge.net/](http://cruisecontrol.sourceforge.net/)

**优点**

*   可以根据选择的版本使用各种构建和 TDD 工具
*   自动构建何时发生以及何种类型 - 完整版本构建或更改代码构建
*   可以在构建上自动运行测试（nUnit、jUnit、Fitnesse 等），以确保在将新代码签入项目时所有测试仍然通过。
*   与源代码控制集成
*   构建失败时的错误报告和通知

**缺点**

*   错误报告并不总是一种很好读的格式
*   项目的设置应该经过深思熟虑，所有受监控的项目都应该使用某些模式来提高集成设置的效率。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-29T17:15:50.093

[PSake](http://code.google.com/p/psake/)（发音为“清酒”）

优点 -

*   电源外壳

缺点 -

*   电源外壳 ：）

这个项目相当新，看起来很有趣，而且非常强大，因为它是“命令行中的 .NET”。不幸的是，我不知道有多少人花时间学习 Powershell。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-04-26T11:22:39.967

[缺点](http://www.dsmit.com/cons/)

优点：

*   使用 Perl，如果你喜欢那种东西
*   其他没用过`:-)`

缺点：

*   很难谷歌！
*   没有积极开发？

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-05-16T18:50:21.147

[上勾拳](http://code.google.com/p/uppercut/)-

这里有一些很好的解释：[Uppercut](http://ferventcoder.com/category/uppercut.aspx)

优点 -

*   超级容易上手 - 自动化构建就像 (1) 解决方案名称、(2) 源代码控制路径、(3) 大多数项目的公司名称一样简单！！！
*   必要的 NAnt 知识有限。

缺点 -

*   仅适用于 .NET

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-09-04T03:15:00.583

**NUBuild**（发音为“New-Build”）

这是最新且非常先进的 .Net 构建工具（一个非常智能的工具），称为 NUBuild，它允许您构建 VB.Net 和 C# 项目。它极其轻巧、开源，同时易于设置并提供几乎无接触的维护。

*   易于使用的命令行界面
*   能够针对所有 .Net 框架版本，即 1.1、2.0、3.0 和 3.5
*   支持基于 XML 的配置
*   支持项目和文件引用
*   为给定项目自动生成“完整的有序构建列表”
*   检测和显示循环依赖的能力 执行并行构建
*   处理代理程序集的能力
*   与 Cruise-Control.Net 持续集成系统轻松集成
*   版本管理能力
*   通知功能

[http://nubuild.codeplex.com/](http://nubuild.codeplex.com/)

这是迄今为止我们见过的最好的构建工具！

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-11-03T22:44:20.977

[烘焙文件](http://www.bakefile.org/index.html)

Bakefile 是跨平台、跨编译器的原生 makefile 生成器。它以编译任务的独立于编译器的描述 (XML) 作为输入，并生成本机 makefile（autoconf 的 Makefile.in、Visual C++ 项目、bcc makefile 等）。

Bakefile 的任务是生成本机 makefile，以便人们可以继续使用他们喜欢的工具。还有其他跨平台的 make 解决方案，但它们不是原生的，需要用户使用不熟悉的工具（Boost.Build），或者它们太有限（qmake）。

# asp.net - ASP.NET：将文本框 maxlength 绑定到 HTML 中的类常量

> ID：247369
> 
> 赞同：2
> 
> 时间：2008-10-29T15:57:35.303
> 
> 标签：asp.net, textbox, attributes

我试图让我的网页设计师在他们正在创建的 asp.net 页面中使用我们拥有的关于数据库字段的元数据。最明显的一个如下：

```
<asp:TextBox runat="server" id="txTextBox" MaxLength="<Value From Metadata here>" ... /> 
```

所有必需的元数据都存储在我们的类对象中，并且由于其公共静态特性而可以访问。

这样做的好处是他们可以设置的值

**a)**可能会在他们不知情或不关心的情况下发生变化
**b)**只需很少的编码工作即可改善用户体验

所有没有它们的人都需要担心价值是什么或它来自哪里。这将主要用于自动绑定控件 - 即添加很少或没有开发人员交互的控件。

[这个问题与我之前的一个问题](https://stackoverflow.com/questions/232986/xaml-binding-textbox-maxlength-to-class-constant)非常相似，现在效果很好（但那是在 WPF / XAML 中）。

这个问题的要点是我希望尽可能少的开发人员对此的要求 - 理想情况下，会有一些`<%# Constant.Value %>`类型语法可以直接在`Maxlength=""`asp:Textbox 控件的属性中使用，这意味着不需要将代码添加到页面/用户控件。

我觉得这是不可能的，但我希望有人能证明我错了。

塔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T16:36:54.477

您可以使用数据绑定表达式：

```
<asp:TextBox MaxLength="<%# Constant.Value %>" /> 
```

*但是*，这要求它位于数据绑定控件中。如果它不在中继器或类似的东西中，则需要在页面生命周期的某个时刻调用 Container.DataBind()。

或者，您可以创建一个[ExpressionBuilder](http://msdn.microsoft.com/en-us/library/system.web.compilation.expressionbuilder.aspx)，它允许以下语法：

```
<asp:TextBox MaxLength="<%$ Constants:Value %>" /> 
```

这是一个从单个静态字典中提取的示例：

```
using System;
using System.Web.UI;
using System.Web.Compilation;
using System.CodeDom;
using System.Collections.Generic;

class ConstantsExpressionBuilder : ExpressionBuilder {
   private static readonly Dictionary<string, object> Values = 
      new Dictionary<string, object>() {
         { "Value1", 12 },
         { "Value2", false },
         { "Value3", "this is a test" }
      };

   public override bool SupportsEvaluate { get { return true; } }

   public override object EvaluateExpression(object target, BoundPropertyEntry entry, object parsedData, ExpressionBuilderContext context) {
      string key = entry.Expression.Trim();
      return GetValue(key);
   }

   public override CodeExpression GetCodeExpression(BoundPropertyEntry entry, object parsedData, ExpressionBuilderContext context) {
      CodePrimitiveExpression keyExpression = new CodePrimitiveExpression(entry.Expression.Trim());
      return new CodeMethodInvokeExpression(this.GetType(), "GetValue", new CodeExpression[] { keyExpression });       
   }

   public static object GetValue(string key) {
      return Values[key];
   }
} 
```

您可以在 web.config 中注册它：

```
<system.web>
   <compilation>
      <expressionBuilders>
    <add expressionPrefix="Constants" type="ConstantsExpressionBuilder" />
      </expressionBuilders>
   </compilation>
</system.web> 
```

并在 ASPX 页面中调用它：

```
<asp:Textbox runat="server" MaxLength="<%$ Constants:Value1 %>" ReadOnly="<%$ Constants:Value2 %>" Text="<%$ Constants:Value3 %>" /> 
```

应该产生：

```
<input type="text" maxlength="12" readonly="false" value="this is a test" /> 
```

在 HTML 输出中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T16:03:56.960

我认为你应该能够用这样的东西来做到这一点

```
<asp:TextBox runat="server" id="txTextBox" MaxLength="<%=Constants.SomeValue%>" /> 
```

但我唯一担心的是，这并没有多大意义。如果常量存储在 .cs 文件中，以便进行更改以使新常量值反映在 UI 中，则您必须重新编译站点。我认为在 .aspx 页面中有一个硬编码值可能更容易，无需重新编译整个代码库即可轻松更改。也许我不明白这个问题。

# mysql - 这是什么时间格式？（不是 UNIX，不是 UTC，什么都没有）

> ID：247373
> 
> 赞同：6
> 
> 时间：2008-10-29T15:57:58.813
> 
> 标签：mysql, time, formatting, unix-timestamp, time-format

我正在将数据从另一个系统导入 MySQL，它是一个 CSV 文件。然而，“日期”字段包含神秘的 3 位数时间条目，这是一个随机样本集：

```
> 540
> 780
> 620
> 965 
```

这是什么？显然不是 5:40 和 6:20。但它也不是 UNIX（在我意识到这代表的时间范围约为 16 分钟之前，我尝试了 1225295 **XXX ）**

有人认识这些吗？

**更新**：我只是注意到在回复的更下方，一位更接近数据的同事刚刚[打开了一个新的 SO 帐户并添加了更多数据](https://stackoverflow.com/questions/247373/what-time-format-is-this-not-unix-not-utc-nothing#247456)。这些数字条目似乎只是时间条目（不是日期）。还是一头雾水。

恕我直言，如果没有人能够识别这一点，那么它可能不是某种（如果模糊的话）标准时间格式，并且更有可能这些条目是外键。

**更新 2**：非常感谢大家！[我们在视觉上找到了答案](https://stackoverflow.com/questions/247373/what-time-format-is-this-not-unix-not-utc-nothing#248123)，但像往常一样，[SO拉开了离合器](https://stackoverflow.com/questions/247373/what-time-format-is-this-not-unix-not-utc-nothing#248070)。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T16:01:40.553

[swatch 互联网时间](http://en.wikipedia.org/wiki/Swatch_Internet_Time)

一天被分成1000等份。非常度量。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T19:18:56.490

它是从午夜开始以五分钟为间隔的分钟数。您的值范围应该是 0 到 1440

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T16:00:33.410

我见过一些系统，其中日期存储在一个特殊的表和其他地方作为它的 id。这可能是其中之一

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T16:07:37.373

我想你最好问问原作者...

或者，您可以将日期插入旧系统并导出吗？如果你能做到这一点，那么你应该能够很容易地对其进行逆向工程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T19:36:47.593

这是解决方案...谢谢....

摩亚

上午 9:00:00 540 上午 9:15:00 555 上午 9:30:00 570 上午 9:45:00 585 上午 10:00:00 600 上午 10:15:00 615 上午 10:30:00 630 10 :45:00 AM 645 11:00:00 AM 660 11:15:00 AM 675 11:30:00 AM 690 11:45:00 AM 705 12:00:00 PM 720 12:15:00 PM 735 12: 30:00 PM 750 12:45:00 PM 765 1:00:00 PM 780 1:15:00 PM 795 1:30:00 PM 810 1:45:00 PM 825 2:00:00 PM 840 2:15 :00 PM 855 2:30:00 PM 870 2:45:00 PM 885 3:00:00 PM 900 3:15:00 PM 915 3:30:00 PM 930 3:45:00 PM 945 4:00: 00 PM 960 4:15:00 PM 975 4:30:00 PM 990 4:45:00 PM 1005 5:00:00 PM 1020 5:15:00 PM 1035 5:30:00 PM 1050 5:45:00下午 1065 6:00:00 下午 1080 6:15:00 下午 1095 6:30:00 下午 1110 6:45:00 下午 1125 7:00:00 下午 1140

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T16:12:09.050

它们应该代表日期或时间吗？如果是日期，那么它们可能只是与“众所周知”时代的偏移量（例如 time_t 是 70 年 1 月 1 日的秒数）。

如果您没有文档来找到时代，您将需要一个示例来解决它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T16:22:41.277

这代表时间，没有日期。并且相同的代码时间出现在不同的日期。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T16:32:59.307

可能是朱利安约会...？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T19:28:46.703

没有办法确定。我可能是[节拍](http://en.wikipedia.org/wiki/Swatch_Internet_Time)，但话又说回来，可能不是。

# asp.net - 如何强制 NHibernate 识别不是通过 NHibernate 进行的数据库更改

> ID：247387
> 
> 赞同：2
> 
> 时间：2008-10-29T16:01:43.410
> 
> 标签：asp.net, nhibernate, caching

我正在将 NHibernate 实现到现有的 Web 应用程序中。但是，我们还有一些其他进程可以在数据库上进行批量插入和更新。如何让 NHibernate 知道后端数据库上发生的更改不是通过 NHibernate 启动的？

我读过的关于 NHibernate 在 asp.net 中使用的大部分信息都提到了将 Session 对象存储在 HttpContext 或 CallContext 中。然后，这将在应用程序生命周期期间存储会话对象。这就是我已经实现的。我害怕在每个请求上初始化 NHibernate 的成本。在每个请求上初始化 Session 对象时，这种方法不会对性能造成重大影响吗？

此外，将 SessionFactory 存储在 HttpContext 或 CallContext 中是否更有意义，以便不必在每个请求上重新生成映射？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-29T16:08:35.377

你不应该。NHibernate 会话可以帮助您在 ACID 环境中工作，这意味着一个事务不知道任何并发事务。您应该使用执行少量操作的短会话。您不应该长时间开放会话。如果您确实需要很长时间来处理域对象，那么您应该将域对象从不同的会话中分离出来，然后重新附加到不同的会话中。

一旦你打开一个新会话，在打开会话之前对数据库所做的任何更改都将通过 NHibernate 提供。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T16:49:36.493

您不应将 Session 存储在多个请求中。坏，坏主意。

在每次通话时重新创建它几乎没有开销。它应该使用数据库连接池——这是大部分开销所在。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-06T18:03:39.863

默认情况下，NHibernate 不会在会话之间缓存任何内容。如果您的会话是短暂的（根据请求），您不必担心太多。

如果您使用二级缓存或查询缓存，您可能需要手动刷新缓存。SessionFactory.Evict 或 SessionFactory.EvictQueries 应该会有所帮助。重新启动应用程序也应该这样做，但这可能不是您正在寻找的答案。

在 ASP.NET 应用程序中，我看到的一般用法是为应用程序创建一个 SessionFactory，并为每个请求创建一个新的 Session。

SessionFactory 需要一段时间来初始化，是线程安全的，并且只需要初始化一次。

会话不是线程安全的，并且创建起来非常快。

存储在 HttpContext 中的任何内容都只会在请求的长度内有效。在上下文中存储会话是正常的，应该会给你想要的结果。SessionFactory 通常存储在一个静态变量中，并且与应用程序一样长。

有关示例，请参见[此处的 NHIbernateHelper 类](http://www.hibernate.org/hib_docs/nhibernate/html/quickstart.html#quickstart-playingwithcats)。

# php - php 观察者模式在会话超时时注销用户

> ID：247412
> 
> 赞同：6
> 
> 时间：2008-10-29T16:11:25.790
> 
> 标签：php, session, timeout, observer-pattern

当用户的会话超时发生时，我正在尝试注销用户。注销用户 - 在我的情况下 - 需要修改用户在数据库中的“在线”状态。
我在想我也许可以使用观察者模式来制作一些东西来监视用户会话的状态并在会话到期时触发回调——这将保留用户的名称，以便我们可以更新数据库。我不确定在会话方面从哪里开始。我可以将回调绑定到会话的超时吗？

这些东西是否内置在任何可用的 pear 或 zend 会话包中？我会用我必须做的一切来实现这一点！

**UPDATE @ 16:33：**
如果您有一个用户可以相互交互的系统（但他们只能与在线用户交互）怎么办？用户需要知道当前还有哪些其他用户在线。

如果我们只是在每次页面刷新时检查会话是否仍处于活动状态，那么在超时后，用户将被发送到未登录的页面，但他们仍然在系统中列为在线。

这种方法很好，只是当我们超时会话时，我们会丢失有关可用于注销用户的用户信息。

**更新@16:56：**
对。谢谢。我同意……有点丑陋。我已经对服务器进行了一些缓慢的轮询，因此实现该方法非常容易。对于会话处理包来说，这似乎是一个非常有用的功能。Zend 和 PEAR 都有会话包。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T17:29:01.453

每当用户点击页面时，在数据库中标记该时间，调用此列 LastAccessed。当用户单击站点的注销部分时，您可以将此值设置为 null。在编写查询以查找当前登录的用户列表时，请执行以下操作：

```
SELECT *  FROM Users WHERE LoggedIn=1 AND LastAccess > DATEADD(Minute,-20.GETDATE()) 
```

这将返回仍然具有活动会话的用户。请原谅可能不适用于 MySQL/PHP 的 SQL，但这应该会给您一个大致的概念。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T16:55:46.247

先看最简单的情况。假设您的系统上有 1 个用户，并且您希望他们的会话超时，并且您希望准确报告他们的状态。用户在 12 分钟内没有访问过页面，您的会话超时设置为 10 分钟。会发生两件事之一。他们要么会在短时间内再次访问，要么不会。如果他们不再访问，系统将如何运行代码来更新他们的超时状态？唯一的方法*是让一个单独的进程为当前处于“会话中”状态的所有用户启动状态更新功能。

每次用户访问您的站点时，更新数据库中的变量，将他们的会话与上次访问时间相关联。然后创建一个每分钟运行的 cron 作业。它调用一个简单的函数来检查会话状态。任何早于超时期限的会话都将设置为“超时”状态。（您还应该在超时会话坐了一段时间后清理桌子）。如果您想要关于登录人数的报告，请查询上次访问时间晚于超时间隔开始的所有记录。

"*" 还有其他方法，但对于简单的 Web 应用程序而言，它并不是真正需要的。如果您有比简单的网络应用程序更复杂的东西，请更新您的问题以反映特定需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T16:28:05.120

你为什么要这样做？常见的方法是检查用户发送的每个请求是否超时。当然，这意味着您的数据库中的状态不是最新的，因为即使已达到超时，用户仍显示为已登录。

但出于实际目的，这通常无关紧要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T16:47:07.967

丑陋但也许可行的建议：

向页面添加一个异步保持活动请求者，以更新它们的最后活动时间戳。然后，如果用户的最后活动时间戳超过 20 秒，您可以有一个将用户标记为离线的 cron 作业。将该 cron 作业设置为每分钟运行一次就可以了。我不确定是否有办法在用户会话超时或关闭浏览器时触发某些事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T17:04:47.027

我的第一个想法是，您可以创建一个自定义会话处理程序，将登录解释为具有活动会话。

有关创建自定义会话处理程序的一些示例，请参阅[http://www.daniweb.com/code/snippet43.html](http://www.daniweb.com/code/snippet43.html)并阅读 PHP 文档[http://ca.php.net/manual/en/function.session-set-保存处理程序.php](http://ca.php.net/manual/en/function.session-set-save-handler.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-12T04:35:27.473

我知道这可能是一个较老的问题，但您的问题的“最佳”答案可以在这里找到：http: [//www.codeguru.com/forum/archive/index.php/t-372050.html](http://www.codeguru.com/forum/archive/index.php/t-372050.html)

它是这样说的： php.ini 文件包含一个名为 sesison.save_path 的设置，它决定了 PHP 将包含会话数据的文件放在哪里。一旦会话过时，PHP 将在下一次垃圾回收期间将其删除。因此，对该会话是否存在字段的测试应该足以确定该会话是否仍然有效。

```
$session_id = 'session_id';
$save_path = ini_get('session.save_path');

if (! $save_path) {
$save_path = '.'; // if this vlaue is blank, it defaults to the current directory
}

if (file_exists($save_path . '/sess_' $session_id)) {
unlink($session_id); // or whatever your file is called
} 
```

# wpf - ComboBox.SelectedValue 未从绑定源更新

> ID：247413
> 
> 赞同：29
> 
> 时间：2008-10-29T16:11:34.200
> 
> 标签：wpf, data-binding, binding, combobox

这是我的绑定源对象：

```
Public Class MyListObject

    Private _mylist As New ObservableCollection(Of String)
    Private _selectedName As String

    Public Sub New(ByVal nameList As List(Of String), ByVal defaultName As String)

        For Each name In nameList
            _mylist.Add(name)
        Next

        _selectedName = defaultName

    End Sub

    Public ReadOnly Property MyList() As ObservableCollection(Of String)
        Get
            Return _mylist
        End Get
    End Property

    Public ReadOnly Property SelectedName() As String
        Get
            Return _selectedName
        End Get
    End Property

End Class 
```

这是我的 XAML：

```
<Window x:Class="Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300"
    xmlns:local="clr-namespace:WpfApplication1"
        >

    <Window.Resources>
        <ObjectDataProvider x:Key="MyListObject" ObjectInstance="" />
    </Window.Resources>

        <Grid>

        <ComboBox Height="23"
                  Margin="24,91,53,0"
                  Name="ComboBox1"
                  VerticalAlignment="Top"
                  SelectedValue="{Binding Path=SelectedName, Source={StaticResource MyListObject}, Mode=OneWay}"
                  ItemsSource="{Binding Path=MyList, Source={StaticResource MyListObject}, Mode=OneWay}"
                  />

        <Button Height="23"
                HorizontalAlignment="Left"
                Margin="47,0,0,87"
                Name="btn_List1"
                VerticalAlignment="Bottom"
                Width="75">List 1</Button>

        <Button Height="23"
                Margin="0,0,75,87"
                Name="btn_List2"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Right"
                Width="75">List 2</Button>
    </Grid>
</Window> 
```

这是代码隐藏：

```
Class Window1

    Private obj1 As MyListObject
    Private obj2 As MyListObject
    Private odp As ObjectDataProvider

    Public Sub New()

        InitializeComponent()

        Dim namelist1 As New List(Of String)
        namelist1.Add("Joe")
        namelist1.Add("Steve")
        obj1 = New MyListObject(namelist1, "Steve")
.
        Dim namelist2 As New List(Of String)
        namelist2.Add("Bob")
        namelist2.Add("Tim")
        obj2 = New MyListObject(namelist2, "Tim")

        odp = DirectCast(Me.FindResource("MyListObject"), ObjectDataProvider)
        odp.ObjectInstance = obj1

    End Sub

    Private Sub btn_List1_Click(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs) Handles btn_List1.Click

        odp.ObjectInstance = obj1

    End Sub

    Private Sub btn_List2_Click(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs) Handles btn_List2.Click

        odp.ObjectInstance = obj2

    End Sub
End Class 
```

当窗口第一次加载时，绑定很好。ComboBox 包含名称“Joe”和“Steve”，默认选择“Steve”。但是，当我单击按钮将 ObjectInstance 切换为 obj2 时，ComboBox ItemsSource 会在下拉列表中正确填充，但 SelectedValue 设置为 Nothing 而不是等于 obj2.SelectedName。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-29T16:31:07.890

上周我们遇到了类似的问题。它与如何`SelectedValue`更新其内部结构有关。我们发现，如果你设置`SelectedValue`它不会看到我们必须设置的更改，而是`SelectedItem`会正确更新所有内容。我的结论是，它`SelectedValue`是**为 get**操作而设计的，而**不是 set**。但这可能只是当前版本 3.5sp1 .net 中的一个错误

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-07-21T16:03:49.113

挑起 2 岁的对话：

如果您想使用字符串，另一种可能性是将其绑定到组合框的 Text 属性。

```
<ComboBox Text="{Binding Test}">
     <ComboBoxItem Content="A" />
     <ComboBoxItem Content="B" />
     <ComboBoxItem Content="C" />
</ComboBox> 
```

这必然是这样的：

```
public class TestCode
{
    private string _test;
    public string Test 
    { 
      get { return _test; }
      set
      {
         _test = value;
         NotifyPropertyChanged(() => Test); // NotifyPropertyChanged("Test"); if not using Caliburn
      }
    }
} 
```

上面的代码是双向的，所以如果你设置 Test="B"; 在代码中，组合框将显示“B”，然后如果您从下拉列表中选择“A”，则绑定属性将反映更改。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-05-10T07:10:40.683

采用

```
UpdateSourceTrigger=PropertyChanged 
```

在绑定中

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-05-13T03:02:50.460

问题：

ComboBox 类使用 IndexOf 方法搜索指定的对象。此方法使用 Equals 方法来确定相等性。

解决方案：

因此，尝试通过 Converter 使用 SelectedValue 设置 SelectedIndex，如下所示：

**C# 代码**

```
//Converter

public class SelectedToIndexConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value != null && value is YourType)
            {
                YourType YourSelectedValue = (YourType) value;

                YourSelectedValue = (YourType) cmbDowntimeDictionary.Tag;
                YourType a = (from dd in Helper.YourType
                                        where dd.YourTypePrimaryKey == YourSelectedValue.YourTypePrimaryKey
                                        select dd).First();

                int index = YourTypeCollection.IndexOf(a); //YourTypeCollection - Same as ItemsSource of ComboBox
            }
            return null;
        }
         public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value!=null && value is int)
            {
                return YourTypeCollection[(int) value];
            }

            return null;
        }
    } 
```

**Xaml**

```
<ComboBox 
   ItemsSource="{Binding Source={StaticResource YourDataProvider}}"
   SelectedIndex="{Binding Path=YourValue, Mode=TwoWay, Converter={StaticResource SelectedToIndexConverter}, UpdateSourceTrigger=PropertyChanged}"/> 
```

祝你好运！:)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-04-21T10:26:15.017

`SelectedValuePath`和的类型`SelectedValue`必须完全相同。

例如，如果`SelectedValuePath`is`Int16`的类型和绑定到`SelectedValue`is的属性的类型`int`将不起作用。

我花了几个小时来找到它，这就是为什么我在问了这么多时间之后在这里回答这个问题。也许像我这样有同样问题的可怜人可以看到它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-08-06T20:42:06.643

遇到类似的事情，最后我只是订阅了下拉菜单的 SelectionChanged 事件并用它设置我的数据属性。愚蠢并希望不需要它，但它确实有效。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-08-11T20:38:23.817

`SelectedValuePath="Content"`在组合框的xaml中设置，然后`SelectedValue`用作绑定是否合理？

看来您有一个字符串列表，并且希望绑定仅针对组合框中的实际项目内容进行字符串匹配，因此如果您告诉它使用哪个属性，`SelectedValue`它应该可以工作；至少，当我遇到这个问题时，这对我有用。

看起来 Content 似乎是一个明智的默认设置，`SelectedValue`但也许不是？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-02-06T20:56:04.847

您是否尝试过引发一个表明 SelectName 已更新的事件，例如 OnPropertyChanged("SelectedName")？这对我有用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-04-09T11:11:42.050

在我的情况下，我绑定到一个列表，而我应该绑定到一个字符串。

**我在做什么：**

```
private ObservableCollection<string> _SelectedPartyType;

public ObservableCollection<string> SelectedPartyType { get { return 
_SelectedPartyType; } set { 
             _SelectedPartyType = value; OnPropertyChanged("SelectedPartyType"); } } 
```

**应该是什么**

```
 private string _SelectedPartyType;

 public string SelectedPartyType { get { return _SelectedPartyType; } set { 
             _SelectedPartyType = value; OnPropertyChanged("SelectedPartyType"); } } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-09T00:34:57.227

绑定模式需要是 OneWayToSource 或 TwoWay，因为源是您想要更新的。模式 OneWay 是 Source to Target，因此使 Source ReadOnly 导致永远不会更新 Source。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-23T20:54:41.910

你知道...我今天已经与这个问题斗争了几个小时，你知道我发现了什么吗？这是一个数据类型问题！填充 ComboBox 的列表是 Int64，我试图将值存储在 Int32 字段中！没有抛出错误，只是没有存储值！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-12-14T18:51:26.517

刚刚解决了这个。啊！！！要么使用 [one of...] .SelectedValue | .SelectedItem | .SelectedText 提示：ComboStyle.DropDownList 首选 Selected Value，而 ComboStyle.DropDown 首选 .SelectedText。

- 这应该可以解决您的问题。我花了一个多星期来解决这个小问题。哈哈！！

# asp.net - ASP.Net 验证器默认样式

> ID：247416
> 
> 赞同：13
> 
> 时间：2008-10-29T16:11:47.133
> 
> 标签：asp.net, validation

我正在使用验证器控件的几个变体（RequiredFieldValidator、CompareValidator 等），并且正在使用验证器的 CssClass 属性。我可以看到（通过 Firebug）正在应用该类，但验证器控件本身正在向其添加样式元素，即颜色：红色。但我不想那样。我希望控件仅使用 cssclass。

我知道我可以覆盖 Forecolor 属性，但我必须在项目中的每个验证器上都这样做。而且我真的很希望能够在我的样式表中更改我的 CSS 类，以防我们将来必须更改所有错误消息的外观。

任何人都知道如何告诉验证器控件不使用它们的默认样式？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-29T16:21:40.390

您可以在您的 css 文件中执行此操作：

```
.validator
{
    color: blue !important;
} 
```

这将覆盖内联红色样式。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-01-11T11:22:59.073

您可以使用主题更改验证器的默认样式。

*   在 Visual Studio 中右键单击该网站
*   选择“添加 ASP.NET 文件夹”
*   选择“主题”，将新文件夹命名为“DefaultTheme”
*   在 DefaultTheme 文件夹中创建一个名为“Controls.skin”的文件

将以下内容添加到 Controls.skin 文件中：

```
<asp:RequiredFieldValidator runat="server" CssClass="validation-error" />
<asp:RangeValidator runat="server" CssClass="validation-error" />
<asp:CompareValidator runat="server" CssClass="validation-error" />
<asp:RegularExpressionValidator runat="server" CssClass="validation-error" />
<asp:CustomValidator runat="server" CssClass="validation-error" />
<asp:ValidationSummary runat="server" CssClass="validation-error" /> 
```

将以下内容合并到您的`web.config`：

```
<configuration>
    <system.web>
        <pages theme="DefaultTheme" />
    </system.web>
</configuration> 
```

然后你可以`.validation-error`在你的 CSS 文件中设置你想要的任何颜色。

（请注意，4.0 之前的 ASP.Net 版本默认适用`style="Color:red"`于所有验证器，因此很难在 CSS 中覆盖它们的颜色。如果您发现这对您有影响，那么您可以通过`ForeColor`在每个验证器上设置属性来覆盖它上面的主题元素，或添加`!important`到您的 CSS 规则中。）

看：

*   [如何：定义 ASP.NET 页面主题](http://msdn.microsoft.com/en-us/library/ms247256%28v=vs.100%29.aspx)
*   [如何：应用 ASP.NET 主题](http://msdn.microsoft.com/en-us/library/0yy5hxdk%28v=vs.100%29.aspx)
*   验证控件在 ASP.Net 4.0 中[失去了红色](http://www.codeproject.com/Articles/85786/Validation-Controls-Lost-Their-Red-Color)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T16:38:05.690

如果你使用主题，你可以设置你的皮肤文件来控制你的验证器的外观。Forecolor 内联的问题在于 .Net 呈现默认控件的方式，它插入了一个 color="#..." 属性，该属性在元素级别覆盖了 CSS。如果上面的 Keltex 的解决方案没有为您提供 !important 指令，您的下一步可能是使用/adapt/help 处理位于[http://www.asp.net/CSSAdapters/](http://www.asp.net/CSSAdapters/)的 CSS-Friendly Control Adapters 项目.

无耻的插件：Brian DeMarzo 正在 Google Code 上扩展这个项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T16:16:19.433

你看过主题吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-06-16T00:06:55.863

```
Set Forecolor="" 
```

和

```
CssClass="your-css-class" 
```

# c# - 如何附加到 VSTO Excel 应用程序进程以进行调试？

> ID：247422
> 
> 赞同：3
> 
> 时间：2008-10-29T16:13:09.283
> 
> 标签：c#, excel, vsto

我有一个需要调试的 Excel VSTO 2005 应用程序，我尝试在 Visual Studio 2005 中附加到进程 EXCEL.EXE 无济于事。

有谁知道如何调试在 VSTO Excel 应用程序中运行的托管代码？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T16:17:29.650

我没有使用过 Excel，但是使用 Word 中的 VSTO，将调试器附加到 WINWORD 进程可以工作，但无法调试启动代码，因为它在附加之前已经运行。在这种情况下，您可以插入

```
Debugger.Launch(); 
```

这将停止您的代码并要求附加调试器。这是我能找到的最佳解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-30T09:50:34.520

我通常包含一个“StopSwitch”，它在 app.config 文件中启用停止开关时启动调试器。

*   *StopSwitch在[http://missico.spaces.live.com/blog/cns!7178D2C79BA0A7E3!309.entry](http://missico.spaces.live.com/blog/cns!7178D2C79BA0A7E3!309.entry)*停止执行即时调试*）*

 *启用 后`StopSwitch`，有时 JIT 调试器无法启动，因为问题发生在 .NET Framework 加载程序集并执行`Stop`语句之前。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T16:53:13.257

我使用的是 VS2008 和 VSTO 2005 (Office 2003)，我可以直接从 VS 本身进行调试。不太确定VS2005，我认为它应该是一样的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T19:53:10.810

我做了这个，应该和Word没什么区别。检查您是否有多个进程。确保您的加载项已实际加载。它可能会被禁止启动。检查加载项下的设置，看看它是否被列为已停用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-03-30T12:09:19.113

我已经使用 Word 加载项完成了此操作，但我必须在调试器选项中禁用“仅我的代码”。

# matlab - Matlab复制构造函数

> ID：247430
> 
> 赞同：6
> 
> 时间：2008-10-29T16:14:29.343
> 
> 标签：matlab, oop, copy-constructor

除了添加带有一个输入的构造函数并显式复制其属性之外，是否有更好的方法来为句柄派生类实现 matlab 的复制构造？

```
obj.property1 = from.property1;  
obj.property2 = from.property2; 
```

等等

谢谢，丹妮

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-04-23T13:28:58.997

还有另一种简单的方法是使用 matlab.mixin.Copyable 创建句柄对象的副本。如果您从此类继承，您将获得一个复制方法，该方法将为您复制所有属性。

```
classdef YourClass < matlab.mixin.Copyable
...

a = YourClass;
b = copy(a); % b is a copy of a 
```

此复制方法无需调用构造函数或设置属性函数即可创建副本。所以这应该更快。您还可以通过覆盖某些方法来自定义复制行为。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-29T19:25:33.497

如果您想要一个假定所有属性都可以复制的快速而简单的解决方案，请查看 PROPERTIES 函数。这是一个自动复制所有属性的类的示例：

```
classdef Foo < handle
  properties
    a = 1;
  end
  methods
    function F=Foo(rhs)
      if nargin==0
        % default constructor
        F.a = rand(1);
      else
        % copy constructor
        fns = properties(rhs);
        for i=1:length(fns)
          F.(fns{i}) = rhs.(fns{i});
        end
      end
    end
  end
end 
```

和一些测试代码：

```
f = Foo(); [f.a Foo(f).a] % should print 2 floats with the same value. 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-19T00:34:22.603

你甚至可以使用

```
try
 F.(fns{i}) = rhs.(fns{i});
end 
```

这使得该方法更有用

# asp.net - ASP.NET 表单身份验证 - 注销

> ID：247433
> 
> 赞同：1
> 
> 时间：2008-10-29T16:16:00.650
> 
> 标签：asp.net, authentication

在 Intranet 应用程序上使用 ASP.NET 表单身份验证时，究竟如何实现注销功能？

如果我是管理员并且想“以其他人身份”登录到应用程序，这将如何工作？

请分享你的想法

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T16:18:28.273

`FormsAuthentication.SignOut();` ;)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T16:45:57.780

Intranet 应用程序的首选身份验证是使用 Windows 身份验证而不是表单身份验证。

在这种情况下，您只需注销 Windows 并以“其他人”身份登录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T16:51:57.490

不要忘记添加 Session.Abandon() 以确保会话数据也被清除

# asp.net - 大型数据列表的替代 UI 控件，而不是 DropDownList

> ID：247438
> 
> 赞同：3
> 
> 时间：2008-10-29T16:17:34.360
> 
> 标签：asp.net, user-interface, webforms, asp.net-2.0, ajaxcontroltoolkit

我在这个特定项目上使用 C# 和 ASP.NET 以及 .NET Framework 库的 2.0 版。我们也在使用 AjaxControlToolkit。AjaxControlToolkit 应该有可用的控件来为我所面临的问题提供下降用户界面解决方案。

去年我在几个项目中遇到过这个问题，并且过去使用了不同的解决方案。我刚刚选择的项目的当前设计是有一个 <asp:DropDownList> 控件，并且在页面加载时进行数据库调用以获取值列表。然后使用 DropDownList 的数据源绑定。问题是从数据库返回了 25k 项。首先，用户必须滚动浏览数以万计的项目是不可接受的。但是，更重要的是，在每个测试它的浏览器（IE 7、FF 3、Safari 和 Chrome）中，浏览器在传播下拉列表项时完全挂起。

我在想的是使用[模态弹出](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ModalPopup/ModalPopup.aspx)表单，它是一个[自动完成扩展器](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx)，允许用户向下钻取到特定公司。因此，在他们必须选择公司的字段中，他们单击“选择公司”图标，出现模式表单，让他们使用自动完成扩展器来选择现有公司。他们单击“确定”并将值保存到该字段。

但是，我是一个老派的命令行/shell/终端人，我对可接受的 UI 设计的想法可能会有所偏差（在任何系统上给我一个命令提示符，我很高兴）。我希望社区中的人们就他们认为可以接受的解决方案提出建议，或者他们是否遇到过类似的其他问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T15:32:54.997

我认为您对自动完成扩展器的想法是最好的解决方案。我也遇到过这个问题（听起来很相似——一个你从别人那里接手的项目）。回击通常来自用户端。他们习惯于从项目列表中进行选择。不幸的是，随着数据库的增长，这变得越来越不可行。

但是当您在页面上下载了 0.5MB 的 html（不包括视图状态）时，就必须做出妥协。

为什么你认为你需要创建模态弹出窗口？你不能只在数据输入页面上有扩展器吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T16:22:55.720

我不得不处理同样的问题。但我最终使用了一个支持分页和自动完成的组合框。目前这个组合框恰好来自 Telerik。它是一个用于自动完成的组合框，因为您无法输入下拉列表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T16:28:22.043

我同意没有用户会想要通过 25,000 个项目来查找他们想要的项目。有什么方法可以限制数据以便他们向下钻取？就像先选择一个地区或公司类型，然后显示匹配的那些？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T19:03:21.353

*   多个级联 ListBox，每个进一步细化前一个的结果集
*   AJAX[自动完成扩展器](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx)

# java - JAX-RPC Web 服务中的多态性

> ID：247442
> 
> 赞同：4
> 
> 时间：2008-10-29T16:19:00.003
> 
> 标签：java, web-services, polymorphism, jax-rpc

我有一个需要返回复杂多态值的 JAX-RPC (Java) Web 服务。更具体地说，类结构是这样的：

```
abstract class Child {
}

class Question extends Child {
    private String name;
    // other fields, getters, and setters
}

class Section extends Child {
    private String label;
    private Child[] children;
    // getters and setters
}

class Quiz {
    private Child[] elements;
    // getter and setter
} 
```

我的网络服务有一个返回测验的方法，它当然可能包含问题和部分，其中可能包含问题和其他部分，依此类推。但是，当我生成 WSDL 时，只有 Child 和 Quiz 进入。当我调用 Web 服务时，我得到一个带有正确数量子元素的 Quiz 元素，但它们都是 Child 元素，并且它们都是空的.

除了将 XML 作为字符串返回之外，有没有一种很好的方法来完成这项工作？

在有人问之前，由于我无法控制的情况，我不能使用 JAX-WS。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T09:44:57.397

我不认为 JAX-RPC 以这种方式支持多态性。我有一个类似的问题，并且不得不通过创建一个只有两个成员的类来解决它 - 一个用于可能返回的两个类中的每一个 - 并且只根据我想要返回的类型填充一个。所以在你的情况下：

```
class Child 
{
    private Section section;
    private Question question;

   // Constructor, etc...
}

class Question 
{
    private String name;
    // other fields, getters, and setters
}

class Section 
{
    private String label;
    private Child[] children;
    // getters and setters
}

class Quiz 
{
    private Child[] elements;
    // getter and setter
} 
```

这需要客户检查孩子的哪个成员被填充，并且非常丑陋，我知道。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-11T14:23:41.253

可能有人还在找，可以在axis 1.4做：

1.  将下一行添加到您的轴 Web 服务部署文件 (wsdd) 部分：

    ```
    <parameter name="emitAllTypesInWSDL" value="true" /> 
    ```

2.  修改 ant 构建文件中的任务以包含“extraClasses”：

    ```
    <axis-java2wsdl ... extraClasses="..."></axis-java2wsdl> 
    ```

    在 extraClasses 中提到了所有将被传递的类，因为轴无法猜测您将作为参数传递/返回的孩子。

完成，现在您可以在接受父类的方法中传递派生类。ETC：

```
// server side class A { ...}
class B extends A {...}
class C extends A {...}

// ws
class wsAxis { public void processPolymorphCall(A obj); }

// client side
wsAxis.processPolymorphCall(new C());

// this will work now, as much as returning derivated classes in place of base class. 
```

# .net - 在 Visual Studio 安装项目中安装后如何启动应用程序

> ID：247446
> 
> 赞同：22
> 
> 时间：2008-10-29T16:20:26.227
> 
> 标签：.net, visual-studio-2008, installation

我使用 Visual Studio 2008 创建了一个安装项目。应用程序安装完成后，我希望它立即启动。关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-04-29T10:18:25.217

我使用脚本在 MSI 的最终表单上放置了一个复选框“Launch [ProductName]”。不过，我不能为这个剧本赢得任何荣誉。您可以在 Aaron Stebner 的 MSDN 博客[http://blogs.msdn.com/astebner/archive/2006/08/12/696833.aspx上找到该脚本](http://blogs.msdn.com/astebner/archive/2006/08/12/696833.aspx)

CodeProject 上有一篇关于它的有趣文章，那里也有一些很好的答案（我在那里找到了 Aaron 的文章）。 [http://www.codeproject.com/KB/install/Installation.aspx](http://www.codeproject.com/KB/install/Installation.aspx)

最后，StackOverflow 上还有一些其他类似的问题

[如何在安装项目结束时运行可执行文件？](https://stackoverflow.com/questions/60565/how-to-run-executable-at-end-of-setup-project)

[在 C# 设置项目中完成设置后如何自动启动我的应用程序](https://stackoverflow.com/questions/1270155/how-to-automatically-start-my-application-when-my-setup-is-done-in-c-setup-proje)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-29T16:26:57.913

我在[VS 2005](http://www.codeproject.com/KB/install/Installation.aspx)中使用了自定义操作。不确定这是否在 VS 2008 中得到了增强。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-26T19:57:43.133

以下是如何在安装后启动您的应用程序（使用 VS2010）：

假设您已经有 2 个项目，例如：`MyApp.Application`和`MyApp.Installer`.

1.  右键单击项目`MyApp.Application`并选择`Add`> `New Item...`> `Installer Class`（随意命名）
2.  右键单击新的 Installer 类并选择`View Code`
3.  覆盖这样的`Commit`方法：

    ```
    public override void Commit(IDictionary savedState)
    {
        base.Commit(savedState);

        Directory.SetCurrentDirectory(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location));
        Process.Start(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location) + "\\MyApp.exe");
    } 
    ```

4.  更新`MyApp.exe`以使用您的应用程序的名称

5.  右键单击您的`MyApp.Installer`项目并选择`View`>`Custom Actions`
6.  右键单击`Commit`文件夹并选择`Add custom action`
7.  选择`Application Folder`> `OK`>`OK`

### 参考：

*   [使用 Visual Studio 2005 安装后启动应用程序](http://www.codeproject.com/Articles/19560/Launching-Your-Application-After-Install-using-Vis)
*   [MSDN：演练：创建自定义操作](http://msdn.microsoft.com/en-us/library/d9k65z2d%28v=vs.100%29.aspx)

# java - 在Java中停止线程？

> ID：247455
> 
> 赞同：9
> 
> 时间：2008-10-29T16:22:23.663
> 
> 标签：java, multithreading

我正在编写一段连接到服务器的代码，使用该连接产生一堆线程并执行一堆“东西”。

在某些情况下连接失败，我需要停止一切并从头开始使用新对象。

我想在对象之后进行清理，但在线程上调用 thread.stop，但这种方法似乎已被弃用。

这样做的推荐替代方法是什么？我应该为每个线程编写自己的清理和退出方法吗？将线程设置为空？或者是其他东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T16:37:39.187

假设您的线程在您的控制下是合理的——即它们没有调用任何可能会在没有执行代码的情况下永远等待的东西——我会用一个简单的（但线程安全的——使用 volatile！）标志来关闭它。

请参阅[这篇文章](http://pobox.com/~skeet/csharp/threads/shutdown.shtml)以获取 C# 中的示例 - Java 等效项应该很容易解决。在线程下一次等待之前，调用`interrupt`不会产生任何影响，并且`stop`可能会使您的应用程序处于难以预测的状态。在可能的情况下，改为进行干净、有序的关机。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T16:26:03.687

如果 Thread.interrupted() 返回 true，请使用 your_thread.interrupt 并检查您的线程。如果是这样，请正确关闭您的线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-26T20:18:28.877

```
private Thread m_CleanupThread = null; 

public void threadCleanUp(){
    m_CleanupThread = new Thread(this);
    m_CleanupThread.Start();
} 
```

该线程将终止，垃圾收集器将完成其余工作。

# php - PHP 中的关联数组是如何实现的？

> ID：247467
> 
> 赞同：24
> 
> 时间：2008-10-29T16:26:42.720
> 
> 标签：php, arrays, php-internals

有人可以解释 PHP 如何实现关联数组吗？PHP 使用什么底层数据结构？PHP是否对密钥进行哈希处理并将其存储在某种哈希映射中？我很好奇，因为我想知道关联数组在插入和搜索键时的性能如何。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2014-04-21T23:26:32.777

投票最高的答案链接已损坏，并没有给出太多解释。

PHP 是用 C 编写的，底层结构只是一个 C 数组。C 数组只是内存块。C 数组中的索引必须是连续的，不能有索引 0 和后面的索引 1000。为了使关联数组键起作用，在将它们添加到 C 数组之前，它们会通过散列函数转换为适当的 C 索引。

对于完整的解释，我发现此链接提供了更多信息。

[http://nikic.github.io/2012/03/28/Understanding-PHPs-internal-array-implementation.html](http://nikic.github.io/2012/03/28/Understanding-PHPs-internal-array-implementation.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-04-22T18:54:11.857

这是一个哈希表。类型声明和哈希函数在这里：
[http ://svn.php.net/viewvc/php/php-src/trunk/Zend/zend_hash.h?view=markup](http://svn.php.net/viewvc/php/php-src/trunk/Zend/zend_hash.h?view=markup)

spl（标准php lib）中有一个轻量级数组和一个链表

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-29T16:28:22.373

好吧，就其价值而言，**所有**PHP 数组都是关联数组。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-29T17:14:36.787

@EBGreen 是正确的。

这会给您带来一些有趣的性能问题，尤其是在将数组视为列表并使用 []（数组添加）运算符时。PHP 似乎没有缓存最大的数字键并向其添加一个，而是似乎遍历所有键以查找下一个数字键应该是什么。由于 PHP 令人沮丧的数组即列表性能，我用 python 重写了脚本。

关联数组具有标准的 dict/hash 性能开销。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T16:52:05.693

根据各种网络论坛的来源，这都是哈希表： [http ://www.usenet-forums.com/php-language/15348-zend-engine-array-implementation.html](http://www.usenet-forums.com/php-language/15348-zend-engine-array-implementation.html)

如果您想确定，请阅读源代码，然后编译它，但请确保您可以[信任您的编译器](http://www.ece.cmu.edu/~ganger/712.fall02/papers/p761-thompson.pdf)（警告：PDF，不相关，但非常酷）。

# windows - 如何控制 Windows DLL 从应用程序导入哪些符号？

> ID：247471
> 
> 赞同：1
> 
> 时间：2008-10-29T16:27:23.747
> 
> 标签：windows, linker, shared-libraries

我正在尝试使用 MSVC 6（复古！）在 Windows 上构建一个共享库（DLL），我有一个特殊的链接问题需要解决。我的共享库必须访问一些全局状态，由加载应用程序控制。

概括地说，我所拥有的是：

应用程序.c：

```
static int g_private_value;

int use_private_value() {
    /* do something with g_private_value */
}

int main (...) {
    return shared_library_method ();
} 
```

shared_library.c：

```
__declspec(dllexport) int __stdcall shared_library_method() {
    use_private_value();
} 
```

（**更新**- 我忘记了`__declspec(dllexport) int __stdcall`部分，但它在真实代码中）

如何设置 shared_library.dll 以便导出`shared_library_method`和导入`use_private_value`？

请记住，A）我通常是一个 unix 程序员，并且 B）我在没有 Visual Studio 的情况下这样做；我们的自动化构建基础架构使用 makefile 驱动 MSVC。如果我省略了一些可以更容易回答问题的内容，请发表评论，我会尽快更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T17:22:44.883

这实际上是很难开始工作的。在 Unix/Linux 上，您可以让共享对象和应用程序相互导入符号，但在 Windows 上，您不能让 DLL 从加载它的应用程序中导入符号：Windows PE 可执行格式不支持该惯用语。

我知道 Cygwin 项目有某种解决方法来解决这个问题，但我不认为这是微不足道的。除非你想做很多与 PE 相关的黑客活动，否则你可能不想去那里。

一个更简单的解决方案可能是从 DLL 导出某种初始化方法：

```
typedef int (*func_ptr)();
void init_library(func_ptr func); 
```

应用程序必须在启动时调用它，并传入您要共享的函数的地址。不完全优雅，但它应该可以正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T17:30:32.043

后半部分你需要从你的 application.c 中导出函数。您可以在链接器中执行此操作：

```
/export:use_private_value@0 
```

这应该会为您提供一个使用 DLL 构建的 lib 文件。

链接 lib 文件的选项是使用 GetProcAddress()。

正如 DavidK 所指出的，如果您只有几个函数，那么在 init 函数中传递函数指针可能会更容易。但是，可以按照您的要求进行操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T16:59:46.757

我将从一半的答案开始。

在 shared_library.c 中：

```
__declspec(dllexport) int __stdcall shared_library_method(void)
{

} 
```

关于从 DLL:s 导出函数的[MSDN 文章。](http://msdn.microsoft.com/en-us/library/z4zxe9k8(VS.80).aspx)

# version-control - Perforce 分支从 Perforce 分支

> ID：247474
> 
> 赞同：1
> 
> 时间：2008-10-29T16:28:11.453
> 
> 标签：version-control, perforce

Perforce 中的路径包含文件 a.txt 和 b.txt。我将主路径称为主线。

我从那里创建了一个仅包含 a.txt 的分支（称为 initialbranch）。我对 a.txt 做了很多修改，对此我很满意。但是，它还没有准备好提交回主线。我可以轻松地将主线中发生的任何更改集成到 a.txt。

另一个项目出现了，它需要从初始分支进行更改。现在，假设我想对 b.txt 进行更改，并希望能够集成在初始分支和主线中发生的更改。目前，我从 initialbranch 分支（称这个新分支为 secondbranch）。以前我一直在将 b.txt 添加到初始分支，然后将我的更改集成到第二个分支。有没有更好的方法来做到这一点？

对不起，如果这个问题看起来有些复杂，我已经尽我所能表达了！

谢谢，

多姆

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T16:53:32.867

我不相信我理解你的问题，但我会尽力提供帮助。

如果你说你真的不想在 initialbranch 中使用 b.txt，你可以像这样定义一个分支规范：

```
initialbranch/a.txt secondbranch/a.txt
mainline/b.txt secondbranch/b.txt 
```

这样，当您使用“secondbranch”分支规范进行集成时，您在 secondbranch 中的更改将被推送到初始分支或主线。

如果您不想将更改直接从 secondbranch 推送到 mainline，那么请执行您已经在做的事情：将 b.txt 从 mainline 集成到 initialbranch，然后从 initialbranch 到 secondbranch。在第二个分支中处理它，然后将更改依次集成回初始分支和主线。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T17:22:24.727

也许图表可能会有所帮助？

```
 a,b------------------------------------------------------> mainline
      \ branched                             / integrated back in
       \-a----------------------------------/------------> initialbranch
                     copied from mainline  /
                     -b-------------------/--------------> secondbranch 
```

perforce 中的分支成本很低，因此我通常会分支整个目录结构而不是单个文件。

这样做还为时不晚。正如埃里克森所说，您可以从主线分支到您的开发分支，而不是将文件复制/添加到第二个分支。

```
 a,b--------------------------------------------------> mainline
      \ branched    \                             / integrated back in
       \-a-----------\---------------------------/----> initialbranch
                      \ branched from mainline  /
                       -b-----------------------------> secondbranch 
```

# internet-explorer - watin 测试期间 IE 实例未停止的 Team City 问题

> ID：247478
> 
> 赞同：3
> 
> 时间：2008-10-29T16:28:43.353
> 
> 标签：internet-explorer, testing, teamcity, watin

我们正在使用 Team City，我在运行 Watin 测试时发现了问题。有时，即使测试关闭了所有打开的实例，IE 的某些实例也不会随机停止在构建服务器上的任务管理器中。这会导致随后的所有测试失败。我们尝试使用在此测试开始运行之前杀死所有 ie 实例的脚本，但这不能防止随机未停止的 ie 实例导致所有测试崩溃。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T13:37:21.043

我不知道它是否会有所帮助，但是....我遇到了类似的错误。我的问题是：“在 Vista 上使用 internet explorer 运行测试，其中 protectedMode = On for localhost”

解决方案记录在这里： [http ://codebetter.com/blogs/james.kovacs/archive/2008/06/18/running-watin-tests-on-vista.aspx](http://codebetter.com/blogs/james.kovacs/archive/2008/06/18/running-watin-tests-on-vista.aspx)

我想你可能会遇到同样的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T10:58:09.527

这是错误消息：

> WatiN.Core.Exceptions.TimeoutException : Internet Explorer 忙时超时 TearDown : System.Reflection.TargetInvocationException : 调用目标引发了异常。----> System.NullReferenceException：对象引用未设置为对象的实例

.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T11:49:05.130

不确定它是否相关，但超时问题可以通过增加超时来解决，如[这里第一条评论中所述](http://16randombytes.blogspot.com/2007/12/watin-testing-aspnet-app-startup-time.html)。

> IE.Settings.WaitForCompleteTimeOut

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-04T10:36:49.507

我有一个类似的错误并通过删除自动保存密码来解决它，它在登录页面上弹出，并且在 Teamcity 中运行时它以某种方式破坏了它。

# javascript - jQuery文本链接脚本？

> ID：247479
> 
> 赞同：40
> 
> 时间：2008-10-29T16:29:14.897
> 
> 标签：javascript, jquery, html, anchor

有谁知道可以选择对 URL 的所有文本引用并自动将它们替换为指向这些位置的锚标记的脚本？

```
For example:

http://www.google.com 

would automatically turn into

<a href="http://www.google.com">http://www.google.com</a> 
```

注意：我想要这个是因为我不想浏览我的所有内容并用锚标签包装它们。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-10-30T00:19:07.210

**NOTE:** An updated and corrected version of this script is now available at [https://github.com/maranomynet/linkify](https://github.com/maranomynet/linkify) (GPL/MIT licence)

* * *

Hmm... to me this seems like the perfect task for jQuery.

...something like this came off the top of my mind:

```
// Define: Linkify plugin
(function($){

  var url1 = /(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,
      url2 = /(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,

      linkifyThis = function () {
        var childNodes = this.childNodes,
            i = childNodes.length;
        while(i--)
        {
          var n = childNodes[i];
          if (n.nodeType == 3) {
            var html = $.trim(n.nodeValue);
            if (html)
            {
              html = html.replace(/&/g, '&amp;')
                         .replace(/</g, '&lt;')
                         .replace(/>/g, '&gt;')
                         .replace(url1, '$1<a href="http://$2">$2</a>$3')
                         .replace(url2, '$1<a href="$2">$2</a>$5');
              $(n).after(html).remove();
            }
          }
          else if (n.nodeType == 1  &&  !/^(a|button|textarea)$/i.test(n.tagName)) {
            linkifyThis.call(n);
          }
        }
      };

  $.fn.linkify = function () {
    return this.each(linkifyThis);
  };

})(jQuery);

// Usage example:
jQuery('div.textbody').linkify(); 
```

It attempts to turn all occurrences of the following into links:

*   `www.example.com/path`
*   `http://www.example.com/path`
*   `mailto:me@example.com`
*   `ftp://www.server.com/path`
*   ...all of the above wrapped in angle brackets (i.e. `<`...`>`)

Enjoy :-)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-29T16:47:56.577

JQuery 在这里不会为您提供很多帮助，因为您并不真正关心 DOM 遍历/操作（除了创建锚标记）。如果您所有的 URL 都在 <p class="url"> 标签中，那么也许。

一个普通的 JavaScript 解决方案可能是你想要的，就像命运一样，[这个人应该让你满意](https://stackoverflow.com/questions/37684/replace-url-with-html-links-javascript)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-07-06T09:15:25.147

I have this function i call

```
textToLinks: function(text) {

    var re = /(https?:\/\/(([-\w\.]+)+(:\d+)?(\/([\w/_\.]*(\?\S+)?)?)?))/g;
    return text.replace(re, "<a href=\"$1\" title=\"\">$1</a>");
  } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-29T16:51:42.717

我建议您在呈现到浏览器之前在静态页面上执行此操作，否则您会将转换计算的负担推给可怜的访问者。:) 以下是您在 Ruby 中的操作方式（从标准输入读取，写入标准输出）：

```
while line = gets
  puts line.gsub( /(^|[^"'])(http\S+)/, "\\1<a href='\\2'>\\2</a>" )
end 
```

显然，您将需要考虑如何使其像您希望的那样健壮。以上要求所有 URL 都以 http 开头，并且将检查不转换引号中的 URL（即，可能已经在 <a href="..."> 内）。它不会捕获 ftp://、mailto:。它会很高兴地转换像 <script> 身体这样的地方的材料，你可能不希望发生这种情况。

The most satisfactory solution is really to do the conversion by hand with your editor so you can eyeball and approve all substitutions. [A good editor](http://purepistos.net/diakonos) will let you do regexp substitution with group references (aka back references), so it shouldn't be a big deal.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-11T19:55:06.047

Take a look at this JQuery plugin: [https://code.google.com/p/jquery-linkifier/](https://code.google.com/p/jquery-linkifier/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-20T20:56:00.620

Doing this server-side is not an option sometimes. Think of a client-side Twitter widget (that goes directly to Twitter API using jsonp), and you want to linkify all the URLs in the Tweets dynamically...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T16:57:22.237

If you want a solution from another perspective... if you can run the pages through php and HTML Purifier, it can autoformat the output and linkify any urls.

# javascript - JavaScript 中的 HTTP GET 请求？

> ID：247483
> 
> 赞同：978
> 
> 时间：2008-10-29T16:31:34.800
> 
> 标签：javascript, http-get, dashcode

我需要在 JavaScript中执行[HTTP GET请求。](http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods)最好的方法是什么？

我需要在 Mac OS X dashcode 小部件中执行此操作。

* * *

## 回答 #1

> 赞同：1396
> 
> 时间：2010-10-27T12:43:51.507

浏览器（和 Dashcode）提供了一个 XMLHttpRequest 对象，可用于从 JavaScript 发出 HTTP 请求：

```
function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
    return xmlHttp.responseText;
} 
```

但是，不鼓励同步请求，并且会生成如下警告：

> 注意：从 Gecko 30.0（Firefox 30.0 / Thunderbird 30.0 / SeaMonkey 2.27）开始，由于对用户体验的负面影响，**主线程上的同步请求已被弃用。**

您应该发出异步请求并在事件处理程序中处理响应。

```
function httpGetAsync(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
} 
```

* * *

## 回答 #2

> 赞同：211
> 
> 时间：2016-07-11T00:45:57.590

新的API 是使用 ES6 承诺[`window.fetch`](https://developers.google.com/web/updates/2015/03/introduction-to-fetch?hl=en)的更清洁的替代品。[这里](https://jakearchibald.com/2015/thats-so-fetch/)`XMLHttpRequest`有一个很好的解释，但归结为（来自文章）：

```
fetch(url).then(function(response) {
  return response.json();
}).then(function(data) {
  console.log(data);
}).catch(function() {
  console.log("Booo");
}); 
```

[浏览器支持](http://caniuse.com/#feat=fetch)现在在最新版本中很好（适用于 Chrome、Firefox、Edge (v14)、Safari (v10.1)、Opera、Safari iOS (v10.3)、Android 浏览器和 Chrome for Android），但 IE 会可能得不到官方支持。[GitHub 有一个](https://github.com/github/fetch)可用的 polyfill，建议支持仍在大量使用的旧版浏览器（尤其是 2017 年 3 月之前的 Safari 版本和同一时期的移动浏览器）。

我想这是否比 jQuery 或 XMLHttpRequest 更方便取决于项目的性质。

这是规范的链接[https://fetch.spec.whatwg.org/](https://fetch.spec.whatwg.org/)

**编辑**：

使用 ES7 async/await，这变得很简单（基于[此 Gist](https://gist.github.com/msmfsd/fca50ab095b795eb39739e8c4357a808)）：

```
async function fetchAsync (url) {
  let response = await fetch(url);
  let data = await response.json();
  return data;
} 
```

* * *

## 回答 #3

> 赞同：208
> 
> 时间：2008-10-29T16:38:26.017

[在 jQuery 中](https://api.jquery.com/jQuery.get/)：

```
$.get(
    "somepage.php",
    {paramOne : 1, paramX : 'abc'},
    function(data) {
       alert('page content: ' + data);
    }
); 
```

* * *

## 回答 #4

> 赞同：173
> 
> 时间：2014-02-27T18:03:11.683

上面有很多很好的建议，但不是很可重用，而且经常充满 DOM 废话和其他隐藏简单代码的绒毛。

这是我们创建的一个可重用且易于使用的 Javascript 类。目前它只有一个 GET 方法，但这对我们有用。添加 POST 不应该对任何人的技能征税。

```
var HttpClient = function() {
    this.get = function(aUrl, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() { 
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.responseText);
        }

        anHttpRequest.open( "GET", aUrl, true );            
        anHttpRequest.send( null );
    }
} 
```

使用它很简单：

```
var client = new HttpClient();
client.get('http://some/thing?with=arguments', function(response) {
    // do something with response
}); 
```

* * *

## 回答 #5

> 赞同：101
> 
> 时间：2010-11-08T09:50:21.697

没有回调的版本

```
var i = document.createElement("img");
i.src = "/your/GET/url?params=here"; 
```

* * *

## 回答 #6

> 赞同：75
> 
> 时间：2008-10-29T16:35:06.540

这是直接使用 JavaScript 执行此操作的代码。但是，如前所述，使用 JavaScript 库会更好。我最喜欢的是 jQuery。

在下面的例子中，一个 ASPX 页面（作为穷人的 REST 服务提供服务）被调用以返回一个 JavaScript JSON 对象。

```
var xmlHttp = null;

function GetCustomerInfo()
{
    var CustomerNumber = document.getElementById( "TextBoxCustomerNumber" ).value;
    var Url = "GetCustomerInfoAsJson.aspx?number=" + CustomerNumber;

    xmlHttp = new XMLHttpRequest(); 
    xmlHttp.onreadystatechange = ProcessRequest;
    xmlHttp.open( "GET", Url, true );
    xmlHttp.send( null );
}

function ProcessRequest() 
{
    if ( xmlHttp.readyState == 4 && xmlHttp.status == 200 ) 
    {
        if ( xmlHttp.responseText == "Not found" ) 
        {
            document.getElementById( "TextBoxCustomerName"    ).value = "Not found";
            document.getElementById( "TextBoxCustomerAddress" ).value = "";
        }
        else
        {
            var info = eval ( "(" + xmlHttp.responseText + ")" );

            // No parsing necessary with JSON!        
            document.getElementById( "TextBoxCustomerName"    ).value = info.jsonData[ 0 ].cmname;
            document.getElementById( "TextBoxCustomerAddress" ).value = info.jsonData[ 0 ].cmaddr1;
        }                    
    }
} 
```

* * *

## 回答 #7

> 赞同：59
> 
> 时间：2014-08-18T07:23:27.400

> 复制粘贴现代版本*（使用[fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)和[箭头功能](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions)）*：

```
//Option with catch
fetch( textURL )
   .then(async r=> console.log(await r.text()))
   .catch(e=>console.error('Boo...' + e));

//No fear...
(async () =>
    console.log(
            (await (await fetch( jsonURL )).json())
            )
)(); 
```

> 复制粘贴经典版本：

```
let request = new XMLHttpRequest();
request.onreadystatechange = function () {
    if (this.readyState === 4) {
        if (this.status === 200) {
            document.body.className = 'ok';
            console.log(this.responseText);
        } else if (this.response == null && this.status === 0) {
            document.body.className = 'error offline';
            console.log("The computer appears to be offline.");
        } else {
            document.body.className = 'error';
        }
    }
};
request.open("GET", url, true);
request.send(null); 
```

* * *

## 回答 #8

> 赞同：47
> 
> 时间：2017-10-28T18:42:52.860

**短而干净：**

```
const http = new XMLHttpRequest()

http.open("GET", "https://api.lyrics.ovh/v1/toto/africa")
http.send()

http.onload = () => console.log(http.responseText)
```

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2008-10-29T16:40:06.357

IE 将缓存 URL 以加快加载速度，但如果您在一段时间内轮询服务器以尝试获取新信息，则 IE 将缓存该 URL，并可能返回您一直拥有的相同数据集。

不管你最终如何处理你的 GET 请求 - vanilla JavaScript、Prototype、jQuery 等 - 确保你设置了一个机制来对抗缓存。为了解决这个问题，请在您要访问的 URL 的末尾附加一个唯一标记。这可以通过以下方式完成：

```
var sURL = '/your/url.html?' + (new Date()).getTime(); 
```

这将在 URL 的末尾附加一个唯一的时间戳，并防止发生任何缓存。

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2020-05-12T11:20:20.840

**现代，干净，最短**

```
fetch('https://www.randomtext.me/api/lorem') 
```

```
let url = 'https://www.randomtext.me/api/lorem';

// to only send GET request without waiting for response just call 
fetch(url);

// to wait for results use 'then'
fetch(url).then(r=> r.json().then(j=> console.log('\nREQUEST 2',j)));

// or async/await
(async()=> 
  console.log('\nREQUEST 3', await(await fetch(url)).json()) 
)();
```

```
Open Chrome console network tab to see request
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2008-10-29T16:35:26.570

[原型](http://www.prototypejs.org)让它变得非常简单

```
new Ajax.Request( '/myurl', {
  method:  'get',
  parameters:  { 'param1': 'value1'},
  onSuccess:  function(response){
    alert(response.responseText);
  },
  onFailure:  function(){
    alert('ERROR');
  }
}); 
```

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2016-07-20T11:23:44.080

一种支持旧浏览器的解决方案：

```
function httpRequest() {
    var ajax = null,
        response = null,
        self = this;

    this.method = null;
    this.url = null;
    this.async = true;
    this.data = null;

    this.send = function() {
        ajax.open(this.method, this.url, this.asnyc);
        ajax.send(this.data);
    };

    if(window.XMLHttpRequest) {
        ajax = new XMLHttpRequest();
    }
    else if(window.ActiveXObject) {
        try {
            ajax = new ActiveXObject("Msxml2.XMLHTTP.6.0");
        }
        catch(e) {
            try {
                ajax = new ActiveXObject("Msxml2.XMLHTTP.3.0");
            }
            catch(error) {
                self.fail("not supported");
            }
        }
    }

    if(ajax == null) {
        return false;
    }

    ajax.onreadystatechange = function() {
        if(this.readyState == 4) {
            if(this.status == 200) {
                self.success(this.responseText);
            }
            else {
                self.fail(this.status + " - " + this.statusText);
            }
        }
    };
} 
```

也许有点矫枉过正，但你绝对可以安全地使用这段代码。

**用法：**

```
//create request with its porperties
var request = new httpRequest();
request.method = "GET";
request.url = "https://example.com/api?parameter=value";

//create callback for success containing the response
request.success = function(response) {
    console.log(response);
};

//and a fail callback containing the error
request.fail = function(error) {
    console.log(error);
};

//and finally send it away
request.send(); 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2018-07-11T21:51:33.590

推荐的方法是使用 JavaScript Promises 来执行此 Fetch API。XMLHttpRequest (XHR)、IFrame 对象或动态`<script>`标记是较旧（且较笨重）的方法。

```
<script type=“text/javascript”&gt; 
    // Create request object 
    var request = new Request('https://example.com/api/...', 
         { method: 'POST', 
           body: {'name': 'Klaus'}, 
           headers: new Headers({ 'Content-Type': 'application/json' }) 
         });
    // Now use it! 

   fetch(request) 
   .then(resp => { 
         // handle response 
   }) 
   .catch(err => { 
         // handle errors 
    });
</script> 
```

这是一个很棒的[fetch 演示](https://scotch.io/tutorials/how-to-use-the-javascript-fetch-api-to-get-data)和[MDN 文档](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2008-10-30T04:03:53.047

我不熟悉 Mac OS Dashcode Widgets，但如果它们让您使用 JavaScript 库并支持[XMLHttpRequests](http://en.wikipedia.org/wiki/XMLHttpRequest)，我会使用[jQuery](http://docs.jquery.com/Ajax/jQuery.get#examples)并执行以下操作：

```
var page_content;
$.get( "somepage.php", function(data){
    page_content = data;
}); 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-10-29T19:42:10.373

在您的小部件的 Info.plist 文件中，不要忘记将您的`AllowNetworkAccess`密钥设置为 true。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2014-09-26T13:21:08.203

您可以通过两种方式获取 HTTP GET 请求：

1.  这种方法基于xml格式。您必须传递请求的 URL。

    ```
    xmlhttp.open("GET","URL",true);
    xmlhttp.send(); 
    ```

2.  这个是基于 jQuery 的。您必须指定要调用的 URL 和 function_name。

    ```
    $("btn").click(function() {
      $.ajax({url: "demo_test.txt", success: function_name(result) {
        $("#innerdiv").html(result);
      }});
    }); 
    ```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2015-05-06T20:36:35.380

对于那些使用[AngularJs](https://docs.angularjs.org/api/ng/service/$http)的人来说，它是`$http.get`：

```
$http.get('/someUrl').
  success(function(data, status, headers, config) {
    // this callback will be called asynchronously
    // when the response is available
  }).
  error(function(data, status, headers, config) {
    // called asynchronously if an error occurs
    // or server returns response with an error status.
  }); 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2008-10-29T23:01:11.080

最好的方法是使用 AJAX（你可以在这个页面[Tizag](http://www.tizag.com/)找到一个简单的教程）。原因是您可能使用的任何其他技术都需要更多代码，不能保证在不返工的情况下跨浏览器工作，并且需要您通过打开框架内的隐藏页面来使用更多客户端内存，这些页面传递 url 解析其数据并关闭它们。AJAX 是在这种情况下要走的路。说我这两年的javascript重度开发。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2021-05-09T06:01:50.093

现在有了异步 js，我们可以使用这个方法和 fetch() 方法以更简洁的方式做出承诺。所有现代浏览器都支持异步函数。

```
async function funcName(url){
    const response = await fetch(url);
    var data = await response.json();
    }
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2021-08-04T17:39:48.147

## 一组功能简单易行

我准备了一组函数，它们在某种程度上相似，但演示了新功能以及 Javascript 所达到的简单性，如果你知道如何利用它的话。

* * *

0.  让一些基本常数

* * *

```
let data;
const URLAPI = "https://gorest.co.in/public/v1/users";
function setData(dt) {
    data = dt;
} 
```

* * *

1.  最简单的

* * *

```
// MOST SIMPLE ONE 
function makeRequest1() {       
    fetch(URLAPI)
        .then(response => response.json()).then( json => setData(json))
        .catch(error => console.error(error))
        .finally(() => {
            console.log("Data received 1 --> ", data);
            data = null;
    });
} 
```

* * *

2.  使用 Promises 和 Async 工具的变体

* * *

```
// ASYNC FUNCTIONS 
function makeRequest2() { 
    fetch(URLAPI)
        .then(async response => await response.json()).then(async json => await setData(json))
        .catch(error => console.error(error))
        .finally(() => {
            console.log("Data received 2 --> ", data);
            data = null;            
        });
}

function makeRequest3() {    
    fetch(URLAPI)
        .then(async response => await response.json()).then(json => setData(json))
        .catch(error => console.error(error))
        .finally(() => {
            console.log("Data received 3 --> ", data);
            data = null;
        });
}

// Better Promise usages
function makeRequest4() {
    const response = Promise.resolve(fetch(URLAPI).then(response => response.json())).then(json => setData(json) ).finally(()=> {
        console.log("Data received 4 --> ", data);

    })
} 
```

* * *

3.  一个班轮功能的演示！！！

* * *

```
// ONE LINER STRIKE ASYNC WRAPPER FUNCTION 
async function makeRequest5() {
    console.log("Data received 5 -->", await Promise.resolve(fetch(URLAPI).then(response => response.json().then(json => json ))) );
} 
```

***值得一提 ---> [@Daniel De León](https://stackoverflow.com/a/25358151/13903942)可能是最干净的功能****

```
(async () =>
    console.log(
            (await (await fetch( URLAPI )).json())
            )
)(); 
```

* * *

4.  最佳答案 - > [By @tggagne](https://stackoverflow.com/a/22076667/13903942)展示了 HttpClient API 的功能。

使用 Fetch 也可以达到同样的效果。根据MDN 的[Using Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)，展示了如何将 INIT 作为第二个参数传递，基本上打开了使用经典方法（get、post...）轻松配置 API 的可能性。

* * *

```
// Example POST method implementation:
async function postData(url = '', data = {}) {
  // Default options are marked with *
  const response = await fetch(url, {
    method: 'POST', // *GET, POST, PUT, DELETE, etc.
    mode: 'cors', // no-cors, *cors, same-origin
    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
    credentials: 'same-origin', // include, *same-origin, omit
    headers: {
      'Content-Type': 'application/json'
      // 'Content-Type': 'application/x-www-form-urlencoded',
    },
    redirect: 'follow', // manual, *follow, error
    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
    body: JSON.stringify(data) // body data type must match "Content-Type" header
  });
  return response.json(); // parses JSON response into native JavaScript objects
}

postData('https://example.com/answer', { answer: 42 })
  .then(data => {
    console.log(data); // JSON data parsed by `data.json()` call
  }); 
```

## 节点

***Fetch 在节点（服务器端*）上不可用**

最简单的解决方案（2021 年底）是使用**[Axios](https://axios-http.com/docs/example)**。

```
$ npm install axios 
```

然后运行：

```
const axios = require('axios');
const request = async (url) => await (await axios.get( url ));
let response = request(URL).then(resp => console.log(resp.data)); 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2016-07-03T09:34:38.563

```
function get(path) {
    var form = document.createElement("form");
    form.setAttribute("method", "get");
    form.setAttribute("action", path);
    document.body.appendChild(form);
    form.submit();
}

get('/my/url/') 
```

发布请求也可以做同样的事情。
看看这个链接[JavaScript post request like a form submit](https://stackoverflow.com/questions/133925/javascript-post-request-like-a-form-submit)

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2018-06-27T14:01:16.887

为了刷新 joann 的最佳答案，这是我的代码：

```
let httpRequestAsync = (method, url) => {
    return new Promise(function (resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.open(method, url);
        xhr.onload = function () {
            if (xhr.status == 200) {
                resolve(xhr.responseText);
            }
            else {
                reject(new Error(xhr.responseText));
            }
        };
        xhr.send();
    });
} 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2018-11-18T16:56:05.233

简单的异步请求：

```
function get(url, callback) {
  var getRequest = new XMLHttpRequest();

  getRequest.open("get", url, true);

  getRequest.addEventListener("readystatechange", function() {
    if (getRequest.readyState === 4 && getRequest.status === 200) {
      callback(getRequest.responseText);
    }
  });

  getRequest.send();
} 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2008-10-29T16:33:21.910

[阿贾克斯](http://en.wikipedia.org/wiki/Ajax_%28programming%29)

最好使用[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)或[jQuery](http://en.wikipedia.org/wiki/JQuery)之类的库。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-09-05T06:00:18.123

```
// Create a request variable and assign a new XMLHttpRequest object to it.
var request = new XMLHttpRequest()

// Open a new connection, using the GET request on the URL endpoint
request.open('GET', 'restUrl', true)

request.onload = function () {
  // Begin accessing JSON data here
}

// Send request
request.send() 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2021-08-23T17:56:32.970

在纯 javascript 中并返回一个 Promise：

```
 httpRequest = (url, method = 'GET') => {
    return new Promise((resolve, reject) => {
      const xhr = new XMLHttpRequest();
      xhr.open(method, url);
      xhr.onload = () => {
        if (xhr.status === 200) { resolve(xhr.responseText); }
        else { reject(new Error(xhr.responseText)); }
      };
      xhr.send();
    });
  } 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2010-08-07T05:03:15.710

如果您想使用 Dashboard 小部件的代码，并且不想在您创建的每个小部件中包含 JavaScript 库，那么您可以使用 Safari 原生支持的对象 XMLHttpRequest。

正如 Andrew Hedges 所报告的，默认情况下，小部件无法访问网络。您需要在与小部件关联的 info.plist 中更改该设置。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-10-11T16:02:56.180

你也可以用纯 JS 做到这一点：

```
// Create the XHR object.
function createCORSRequest(method, url) {
  var xhr = new XMLHttpRequest();
if ("withCredentials" in xhr) {
// XHR for Chrome/Firefox/Opera/Safari.
xhr.open(method, url, true);
} else if (typeof XDomainRequest != "undefined") {
// XDomainRequest for IE.
xhr = new XDomainRequest();
xhr.open(method, url);
} else {
// CORS not supported.
xhr = null;
}
return xhr;
}

// Make the actual CORS request.
function makeCorsRequest() {
 // This is a sample server that supports CORS.
 var url = 'http://html5rocks-cors.s3-website-us-east-1.amazonaws.com/index.html';

var xhr = createCORSRequest('GET', url);
if (!xhr) {
alert('CORS not supported');
return;
}

// Response handlers.
xhr.onload = function() {
var text = xhr.responseText;
alert('Response from CORS request to ' + url + ': ' + text);
};

xhr.onerror = function() {
alert('Woops, there was an error making the request.');
};

xhr.send();
} 
```

请参阅：了解更多详情：[html5rocks 教程](https://www.html5rocks.com/en/tutorials/cors/)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-03-15T10:34:25.603

这是 xml 文件的替代方法，可将文件作为对象加载并以非常快速的方式将属性作为对象访问。

*   注意，为了让 javascript 能够正确解释内容，有必要将文件保存为与 HTML 页面相同的格式。如果您使用 UTF 8 将文件保存为 UTF8 等。

XML 像树一样工作，好吗？而不是写

```
 <property> value <property> 
```

写一个像这样的简单文件：

```
 Property1: value
      Property2: value
      etc. 
```

保存你的文件..现在调用函数....

```
 var objectfile = {};

function getfilecontent(url){
    var cli = new XMLHttpRequest();

    cli.onload = function(){
         if((this.status == 200 || this.status == 0) && this.responseText != null) {
        var r = this.responseText;
        var b=(r.indexOf('\n')?'\n':r.indexOf('\r')?'\r':'');
        if(b.length){
        if(b=='\n'){var j=r.toString().replace(/\r/gi,'');}else{var j=r.toString().replace(/\n/gi,'');}
        r=j.split(b);
        r=r.filter(function(val){if( val == '' || val == NaN || val == undefined || val == null ){return false;}return true;});
        r = r.map(f => f.trim());
        }
        if(r.length > 0){
            for(var i=0; i<r.length; i++){
                var m = r[i].split(':');
                if(m.length>1){
                        var mname = m[0];
                        var n = m.shift();
                        var ivalue = m.join(':');
                        objectfile[mname]=ivalue;
                }
            }
        }
        }
    }
cli.open("GET", url);
cli.send();
} 
```

现在你可以有效地获得你的价值观。

```
getfilecontent('mesite.com/mefile.txt');

window.onload = function(){

if(objectfile !== null){
alert (objectfile.property1.value);
}
} 
```

这只是贡献给小组的一份小礼物。谢谢你的喜欢:)

如果您想在本地测试该功能，请使用以下命令重新启动浏览器（除 safari 之外的所有浏览器都支持）：

```
yournavigator.exe '' --allow-file-access-from-files 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2019-09-06T06:06:39.280

```
<button type="button" onclick="loadXMLDoc()"> GET CONTENT</button>

 <script>
        function loadXMLDoc() {
            var xmlhttp = new XMLHttpRequest();
            var url = "<Enter URL>";``
            xmlhttp.onload = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == "200") {
                    document.getElementById("demo").innerHTML = this.responseText;
                }
            }
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }
    </script> 
```

# asp.net - 引用数据集中的表时如何指定命名空间

> ID：247486
> 
> 赞同：0
> 
> 时间：2008-10-29T16:32:57.620
> 
> 标签：asp.net, vb.net

我正在使用 ReadXml 方法将数据从 XML 文件加载到 DataSet 中。这将产生两个具有相同名称的表。其中一张表有命名空间，而另一张则没有。我正在尝试使用命名空间引用表。谁能告诉我该怎么做？

```
 Dim reader As XmlTextReader = New XmlTextReader(strURL)
    Dim city as string = ""
    Dim ds As DataSet = New DataSet()
    ds.Namespace = "HomeAddress"

    ds.ReadXml(reader)        
    city = ds.Tables("Address").Rows(0).Item(2).ToString() 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-03T16:28:43.427

来自 MSDN：[DataSet.Namespace](http://msdn.microsoft.com/en-us/library/system.data.dataset.namespace(VS.80).aspx)

> 使用 ReadXml、WriteXml、ReadXmlSchema 或 WriteXmlSchema 方法读取 XML 文档并将其写入 DataSet 时使用 Namespace 属性。
> 
> XML 文档的命名空间用于在读入 DataSet 时确定 XML 属性和元素的范围。例如，如果 DataSet 包含从具有命名空间“myCompany”的文档中读取的模式，并且尝试仅从具有不同命名空间的文档中读取数据，则任何与现有模式不对应的数据都是忽略。
> 
> 下面的示例在调用 ReadXml 方法之前设置前缀。

```
private void ReadData(DataSet thisDataSet)
{
    thisDataSet.Namespace = "CorporationA";
    thisDataSet.Prefix = "DivisionA";

    // Read schema and data.
    string fileName = "CorporationA_Schema.xml";
    thisDataSet.ReadXmlSchema(fileName);
    fileName = "DivisionA_Report.xml";
    thisDataSet.ReadXml(fileName);
} 
```

我无法从您提供的示例中看到，但除非您在加载之前设置前缀，否则您将无法读取与现有模式不对应的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T15:42:59.120

我找到了答案。您可以将命名空间作为第二个参数传入。我想我没有注意到 Intellisense 中的这种特殊过载。

```
ds.Tables("Address", "HomeAddress").Rows(1).Item(2).ToString() 
```

# html - 图像和超链接边框 - Ghost 1px x 1px 边框

> ID：247530
> 
> 赞同：2
> 
> 时间：2008-10-29T16:46:05.130
> 
> 标签：html, css, border, firefox-3

我有一个包含在锚标记中的图像，该标记通过 jQuery 触发页面上其他位置的操作。当我单击图像时，图像的左上角和下角会出现两个 1px x 1px 的小框。

我的 CSS 样式明确声明图像没有边框：`a,img { border: 0; }`

它似乎也只发生在 Firefox 3 中。其他人有这个问题吗？

* * *

这是图像左侧的屏幕截图（图形具有白色背景）：

[替代文字 http://neezer.net/img/ss.png](http://neezer.net/img/ss.png)

它不是背景，也不是任何其他元素的边框。我检查了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-29T16:49:08.943

你的锚标签是在下面还是在上面？

在这种情况下将 a 和 a:hover 设置为 text-decoration: none。

发生在我身上，它是两个小盒子的原因是因为元素的宽度没有完全扩展，或者其他什么。

祝你好运！

D'oh：我看到它是左上框和左下框。可能是其他东西，例如偷看的包含元素的背景或边框。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T17:39:18.047

您是否也尝试过设置**边框样式：无；**? 这是一个很长的镜头，但你永远不知道......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-11T14:19:16.600

锚元素的显示属性是什么？您可以尝试将显示属性设置为“块”，并确保将内部 IMG 元素浮动设置设置为“无”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-08T13:55:24.147

我把这归结为 Firefox 3 和 jQuery 1.2.6 的一个错误，因为我还没有用任何其他版本的 Firefox 或 jQuery 复制它。

# c++ - 哪些标准 c++ 类不能在 c++ 中重新实现？

> ID：247538
> 
> 赞同：9
> 
> 时间：2008-10-29T16:47:18.153
> 
> 标签：c++, compiler-construction

我正在查看 C++0x 的计划，并`std::initializer_list`在用户类中实现初始化列表。如果不使用它自己，或者使用一些“编译器魔法”，这个类就无法在 C++ 中实现。如果可以，则不需要它，因为您用来实现的任何技术`initializer_list`都可以用于在您自己的类中实现初始化器列表。

还有哪些其他类需要某种形式的“编译器魔法”才能工作？标准库中有哪些类是第三方库无法实现的？

编辑：也许我应该说实例化而不是实现。更重要的是这个类与语言特性直接相关（你不能使用没有 的初始化列表`initializer_list`）。

与 C# 的比较可能会弄清楚我想知道的问题：IEnumerable 和 IDisposable 实际上是硬编码到语言功能中的。我一直认为 C++ 没有这种情况，因为 Stroustrup 试图让所有东西都可以在库中实现。那么，是否有任何其他类/类型与语言功能密不可分。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T16:47:53.130

我唯一能想到的另一个是 typeid 返回的[type_info](http://msdn.microsoft.com/en-us/library/70ky2y6k.aspx)类。据我所知，VC++ 通过在编译时静态实例化所有需要的 type_info 类，然后在运行时根据 vtable 中的值简单地转换一个指针来实现这一点。这些是可以使用 C 代码完成的事情，但不能以符合标准或可移植的方式完成。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T00:14:19.937

`std::type_info`是一个简单的类，尽管填充它需要`typeinfo`：编译器构造。

同样，异常是普通对象，但抛出异常需要编译器魔法（异常在哪里分配？）。

`std::initializer_list`对我来说，问题是“如果没有编译器魔法，我们离 s 有多近？”

查看[wikipedia](http://en.wikipedia.org/wiki/C%2B%2B0x#Initializer_lists)，`std::initializer_list<typename T>`可以通过看起来很像数组文字的东西来初始化。让我们尝试给我们`std::initializer_list<typename T>`一个接受数组的转换构造函数（即，一个接受单个参数的构造函数`T[]`）：

```
namespace std {
     template<typename T> class initializer_list {
         T internal_array[];
         public:
         initializer_list(T other_array[]) : internal_array(other_array) { };

         // ... other methods needed to actually access internal_array
     }
} 
```

同样，使用 a 的类`std::initializer_list`通过声明一个接受单个`std::initializer_list`参数的构造函数来实现这一点——也就是转换构造函数：

```
struct my_class {
    ...
    my_class(std::initializer_list<int>) ...
} 
```

所以这一行：

```
 my_class m = {1, 2, 3}; 
```

导致编译器认为：“我需要为 ; 调用一个构造函数`my_class`；`my_class`有一个接受 a 的构造函数`std::initializer_list<int>`；我有一个`int[]`文字；我可以将 an 转换`int[]`为 a `std::initializer_list<int>`；我可以将它传递给`my_class`构造函数”（**请阅读到末尾在告诉我 C++ 不允许链接两个隐式用户定义转换之前的答案**）。

那么这有多接近呢？首先，我缺少初始化列表的一些特性/限制。我不强制执行的一件事是初始化列表只能用数组文字构造，而我`initializer_list`也接受一个已经创建的数组：

```
int arry[] = {1, 2, 3};
my_class = arry; 
```

此外，我没有打扰右值引用。

最后，这个类只有在编译器隐式地将两个用户定义的转换链接在一起时才能按照新标准所说的那样工作。这在正常情况下是特别禁止的，所以这个例子仍然需要编译器的魔法。但我认为（1）类本身是一个普通类，（2）所涉及的魔法（强制“数组文字”初始化语法并允许隐式链接两个用户定义的转换）比看起来要少乍一看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T16:58:10.597

根据定义，标准库中的所有类都***必须***用 C++ 实现。其中一些隐藏了一些晦涩的语言/编译器结构，但仍然只是围绕这种复杂性的包装，而不是语言特性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T23:51:01.120

运行时在定义点“挂钩”的任何东西都可能无法作为假设语言“C++，不包括那个东西”的可移植库来实现。

因此，例如，我认为 <cstdlib> 中的 atexit() 不能纯粹作为库实现，因为 C++ 中没有其他方法可以确保在终止序列中的正确时间调用它，即在任何全局析构函数之前.

当然，您可以争辩说 C 的特性对于这个问题“不算数”。在这种情况下，std::unexpected 可能是一个更好的例子，原因完全相同。如果它不存在，那么如果不修改编译器发出的异常代码，就无法实现它。

[编辑：我刚刚注意到提问者实际上问的是哪些*类*不能实现，而不是标准库的哪些部分不能实现。所以实际上这些例子并没有严格回答这个问题。]

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T10:03:49.637

C++ 允许编译器定义其他未定义的行为。这使得在非标准 C++ 中实现标准库成为可能。例如，“onebyone”想知道 atexit()。库编写者可以假设有关编译器的事情，使他们的非可移植 C++ 在他们的编译器上工作正常。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T15:38:13.160

MSalter 在评论中指出了 printf/cout/stdout。您可以根据其他一个（我认为）来实现它们中的任何一个，但是如果没有操作系统调用或编译器魔法，您就不能一起实现它们的全部集合，因为：

1.  这些都是访问进程标准输出流的所有方式。您必须在某处填充字节，并且在没有这些东西的情况下这是特定于实现的。除非我忘记了另一种访问它的方式，但关键是除了通过特定于实现的“魔术”之外，您无法实现标准输出。

2.  它们在运行时具有“神奇”行为，我认为纯库无法完美模仿。例如，你不能只使用静态初始化来构造cout，因为编译单元之间的静态初始化顺序没有定义，因此无法保证它会及时存在以被其他静态初始化器使用。stdout 可能更容易，因为它只是 fd 1，因此任何支持它的设备都可以通过在看到它时传入的调用来创建。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T17:06:39.487

我认为你在这个分数上很安全。C++ 主要用作围绕 C 的一层厚厚的抽象层。由于 C++*也是*C 本身的超集，因此核心语言原语几乎总是实现无类（以 C 风格）。换句话说，你不会找到很多像 Java`Object`这样的情况，Java 是一个具有特殊含义的类，硬编码到编译器中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T23:41:43.760

再次从 C++0x 开始，我认为线程不能作为假设语言“C++0x，除了线程之外的所有标准库”中的可移植库来实现。

[编辑：只是为了澄清，对于“实施线程”的含义似乎存在一些分歧。在这个问题的背景下，我理解它的意思是：

1) 实现 C++0x 线程规范（无论结果如何）。注意 C++0x，这是我和提问者都在谈论的。不是任何其他线程规范，例如 POSIX。

2）没有“编译器魔法”。这意味着不向编译器添加任何内容来帮助您的实现工作，并且不依赖任何非标准的实现细节（例如特定的堆栈布局，或切换堆栈的方法，或用于设置定时中断的非可移植系统调用) 以生成仅适用于特定 C++ 实现的线程库。换句话说：纯粹的、可移植的 C++。您可以使用信号和 setjmp/longjmp，因为它们是可移植的，但我的印象是这还不够。

3) 假设一个 C++0x 编译器，除了它缺少 C++0x 线程规范的所有部分。如果它缺少的只是一些数据结构（存储退出值和 join() 使用的同步原语或等价物），但存在实现线程的编译器魔法，那么显然该数据结构可以作为第三方添加便携式组件。但这是一个枯燥的答案，当问题是关于哪些 C++0x 标准库类需要编译器魔法来支持它们时。国际海事组织。]

# jquery - 使用 MVC 视图页面 + $(document).ready

> ID：247541
> 
> 赞同：0
> 
> 时间：2008-10-29T16:47:53.520
> 
> 标签：jquery, asp.net-mvc, asp.net-mvc-routing

我正在编辑这个原始问题，因为我认为我已经缩小了问题范围......

我的站点中有一个视图不允许我将 $document.ready 放在母版页内容占位符中。我已经将这个页面剥离到了最基本的部分，唯一的特别之处在于它在 global.asax 中有一个自定义路由

```
 routes.MapRoute("Books",
                 "{controller}/{action}/{keywords}/{pageNumber}",
                  new { controller = "Books", action = "SearchResults" }
                 ); 
```

知道为什么这个自定义路由会在放入母版页内容占位符区域时停止 $document.ready 正常工作吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T18:13:32.020

我遇到了同样的问题，结果发现当我使用某个路由时，它改变了站点的感知文件层次结构，例如 .js 文件的 ../../Content 链接不再起作用。我通过将我的 jquery 脚本引用更改为如下所示来修复它：

```
<script src="<%= Url.Content("~/Content/jquery-1.2.6.min.js") %>" type="text/javascript"></script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T16:51:02.233

您的母版页（或查看页面，如果您不使用母版页）需要引用 jquery。这包含在 MVC 框架的最新 Beta 版本中。

检查以确保您的页面标签中包含 jQuery。

还要检查语法...

```
$(document).ready(function() { alert('loaded'); }); 
```

这些缩短的版本也可以：

```
$().ready(function() { alert('loaded'); });
$(function() { alert('loaded'); }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T17:17:21.273

`<script ...>`只需将其粘贴在标签中视图页面的内容控件中的某个位置即可。

```
<asp:Content ID="Content1" ContentPlaceHolderID="MainContentPlaceHolder" runat="server">
    <div class="contentItem">
        <%!-- yadda --%>
    </div>

    <script type="text/javascript">
        $(document).ready(function() {
         // do your worst
        });
    </script>
</asp:Content> 
```

如果您有在每个页面上运行的内容，您可以将其剥离到 .js 文件中并从母版页访问它。但是对于与特定视图相关的功能，这可能是最简单的方法，也最容易维护。

# version-control - Emacs 的最佳 Mercurial 模式？

> ID：247544
> 
> 赞同：23
> 
> 时间：2008-10-29T16:48:13.363
> 
> 标签：version-control, emacs, mercurial

[Emacs Wiki](http://www.emacswiki.org/emacs/MercurialMode)列出了几种在Emacs 内部支持 mercurial 的模式，包括内置的 VC 模式。是否值得探索任何其他模式，例如与 mercurial 本身一起分发的模式？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-03T23:18:31.447

我会建议[DVC](http://xtalk.msk.su/~ott/en/writings/emacs-vcs/EmacsDVC.html)。它支持其他分布式版本控制系统（尤其是 git），它易于配置，并且它的工作方式与默认的 VC 模式一样合理。它似乎也比 mercurial 模式拥有更大的用户群。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T09:03:01.080

这取决于您使用的其他 DVCS。如果您使用多个，那么 DVC 可能是不错的选择。

如果您想获得对 mercurial 的本机支持，那么您可以使用 mercurial.el（在我的文章中描述）或[aHg](https://es.fbk.eu/people/griggio/ahg.html)包，它比 mercurial.el 有一些优势。我计划用这个包的描述更新我的文章，但我不知道什么时候会完成:-(

# .net - Outlook 自动清理我的换行符并搞砸了我的电子邮件格式

> ID：247546
> 
> 赞同：125
> 
> 时间：2008-10-29T16:48:26.200
> 
> 标签：.net, utf-8, outlook, smtp

我正在使用 dotnet 框架发送电子邮件。这是我用来创建消息的模板：

```
Date of Hire: %HireDate%
Annual Salary: %AnnualIncome%
Reason for Request: %ReasonForRequest%

Name of Voluntary Employee: %FirstName% %LastName%
Total Coverage Applied For:  %EECoverageAmount%
Guaranteed Coverage Portion: %GICoveragePortion%
Amount Subject to Medical Evident: %GIOverage% 
```

在 Outlook 中收到邮件时，Outlook 告诉我“删除了此邮件中的额外换行符”。消息显示如下：

```
Date of Hire: 9/28/2001
Annual Salary: $100,000
Reason for Request: New Hire

Name of Voluntary Employee: Ronald Weasley Total Coverage Applied For:  $500,000 Guaranteed Coverage Portion: $300,000.00 Amount Subject to Medical Evident: $200,000 
```

请注意 Outlook 如何错误地删除名称、EEOverageAmount 等后所需的换行符...

对于电子邮件收件人来说，获得格式正确的电子邮件很重要，我必须假设他们中的一些人使用 Outlook 2003。我也不能假设他们知道足以关闭自动清理功能以使邮件正确格式化。

我已经在其他邮件客户端中查看过这些消息并且它们显示正确

更多信息：

*   我正在使用 UTF-8 BodyEncoding (msg.BodyEncoding = System.Text.Encoding.UTF8)
*   msg.Body 是从一个 UTF-8 编码的文本文件中读取的，每一行都以 crlf 结尾。

问题：如何更改消息的格式以避免此问题？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2009-01-12T16:58:19.750

You can also insert a tab character at the *end* of the line (just before the CR LF). This extra white space will be at the end of the line and hence not visible to user. You might prefer this to having to insert spaces on the left. Note that a single space is not enough (though perhaps multiple spaces would help, I don't know.)

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2008-10-29T18:43:21.523

Start every line with 2 spaces and outlook will be "tricked" into keeping your formatting.

So change

```
Date of Hire: %HireDate%
Annual Salary: %AnnualIncome%
Reason for Request: %ReasonForRequest%

Name of Voluntary Employee: %FirstName% %LastName%
Total Coverage Applied For:  %EECoverageAmount%
Guaranteed Coverage Portion: %GICoveragePortion%
Amount Subject to Medical Evident: %GIOverage% 
```

to

```
 Date of Hire: %HireDate%
  Annual Salary: %AnnualIncome%
  Reason for Request: %ReasonForRequest%

  Name of Voluntary Employee: %FirstName% %LastName%
  Total Coverage Applied For:  %EECoverageAmount%
  Guaranteed Coverage Portion: %GICoveragePortion%
  Amount Subject to Medical Evident: %GIOverage%
^^ <--- Two extra spaces at the start of every line 
```

Here is the [article](http://www.masternewmedia.org/newsletter_publishing/newsletter_formatting/remove_line_breaks_issue_Microsoft_Outlook_2003_when_publishing_text_newsletters_20051217.htm) I found when researching this problem which goes into a little more depth than my answer.

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-08-31T17:56:00.070

This answer is on how to "disable" the feature from the Outlook Client.

*   Go to Tools -> "Options ..."
*   In the "Preferences" tab click on "Email Options ..."
*   Uncheck the box "Remove extra line breaks in plain text messages."
*   Hit OK

FYI:I am using Outlook 2007

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-04-12T15:05:22.983

Adding "\t\r\n" ( \t for TAB) instead of "\r\n" worked for me on Outlook 2010.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-29T17:32:19.577

我总是有更好的运气将电子邮件格式化为 html。您可能仍然会遇到必须将客户端设置为允许 html 格式的最终​​用户问题，但他们通常更熟悉这一点，因为很多电子邮件确实都是 html 格式的。在添加 html 标记时，您还需要做更多的工作，但最终结果更加可控。

@ephemient also suggests: *Send as both HTML and plaintext. Good clients will show the latter, Outlook will show the former, everybody is happy (except the programmer who has to do more work).*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-08-17T18:02:03.057

Expanding on the [Doug L](https://stackoverflow.com/users/19179/doug-l) answer, since I think HTML messaging is even more ubiquitous and accepted now than in 2008 when that answer was posted. Here is a little c# snippet to help convert the body and send the message in HTML format:

```
body = string.Format("<font face='calibri,arial,sans-serif'>{0}<font/>", body.Replace("\r\n", "<br>"));

using (var smtpClient = new SmtpClient() { Host = smtpHost })
using (var msg = new MailMessage(from, emailDistribution, subject, body) { IsBodyHtml = true })
     smtpClient.Send(msg); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-03-15T13:33:36.873

Auto cleaning is an outlook feature which removes extra line breaks. You can prevent it by two ways.

*   **First way** is to add at least 2 extra spaces before lines while sending the email through code. You can add these extra spaces only before those lines which outlook automatically removes.

*   **Second way** is to change outlook setting which will prevent outlook from removing extra line breaks.

[![enter image description here](https://i.stack.imgur.com/Fvh6c.jpg)](https://i.stack.imgur.com/Fvh6c.jpg)

[![enter image description here](https://i.stack.imgur.com/LYwPz.jpg)](https://i.stack.imgur.com/LYwPz.jpg)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-12T22:00:11.913

I'm seeing the same problem when generating a plain-text email and then reading it with Outlook 2003 SP3\. It appears you can avoid the removal process by it by keep the line length under 40 characters. May not always be practical.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-24T15:43:58.570

Put the text in `<pre>` Tags and outlook will format and display the text correctly.

i defined it in CSS inline in HTML Body like:

CSS:

```
pre {
 font-family: Verdana, Geneva, sans-serif;
} 
```

i defined the font-family to have to font set.

HTML:

```
<td width="70%"><pre>Entry Date/Time:       2013-09-19 17:06:25
Entered By:     Chris

worklog mania

____________________________________________________________________________________________________

Entry Date/Time:        2013-09-19 17:05:42
Entered By:     Chris

this is a new Worklog Entry</pre></td> 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-11-13T08:53:43.273

My text includes '\r\n' but Outlook 2010 does not render line break. Create tokens of lines delimited by '\r\n' and envelope tokens by HTML Paragraph tags. My Email format is HTML. I am generating HTML Body for my email in the code below.

```
string[] tokens = Regex.Split(objTickt.Description, "\r\n");
  if (tokens.Length > 0)
  {
     foreach (string line in tokens)
     {
         //htmlTW.WriteEncodedText(objTickt.Description.Replace("\r\n", "\n\n"));
         htmlTW.RenderBeginTag(HtmlTextWriterTag.P);
         htmlTW.WriteEncodedText(line);
         htmlTW.RenderEndTag();
     }
  } 
```

* * *

## 回答 #11

> 赞同：-6
> 
> 时间：2008-10-29T17:22:04.930

将您的线路终止从 crlf 更改为 cr 或 lf。

我怀疑电子邮件的顶部仅使用 cr（或 lf），而 Outlook 希望电子邮件的其余部分遵循相同的格式。

# asp.net - 尽管禁用了模拟，但 ASP.NET aspx 页面代码运行模拟

> ID：247550
> 
> 赞同：2
> 
> 时间：2008-10-29T16:49:37.430
> 
> 标签：asp.net, authentication, impersonation

我在 VS 2005 中创建了一个空白测试应用程序作为 ASP.NET 应用程序。[MSDN](http://msdn.microsoft.com/en-us/library/ms998351.aspx)说

> 默认情况下，ASP.NET 不使用模拟，您的代码使用 ASP.NET 应用程序的进程标识运行。

我有以下 web.config

```
<configuration>

    <appSettings/>
    <connectionStrings/>

    <system.web>
        <!-- 
            Set compilation debug="true" to insert debugging 
            symbols into the compiled page. Because this 
            affects performance, set this value to true only 
            during development.
        -->
        <compilation debug="true" defaultLanguage="c#" />
        <!--
            The <authentication> section enables configuration 
            of the security authentication mode used by 
            ASP.NET to identify an incoming user. 
        -->
        <authentication mode="Windows"/>
        <identity impersonate="false"/>
        <!--
            The <customErrors> section enables configuration 
            of what to do if/when an unhandled error occurs 
            during the execution of a request. Specifically, 
            it enables developers to configure html error pages 
            to be displayed in place of a error stack trace.

        <customErrors mode="RemoteOnly" defaultRedirect="GenericErrorPage.htm">
            <error statusCode="403" redirect="NoAccess.htm" />
            <error statusCode="404" redirect="FileNotFound.htm" />
        </customErrors>
        -->
    </system.web>
</configuration> 
```

因此，就像[文章](http://msdn.microsoft.com/en-us/library/ms998351.aspx)建议的那样，模拟似乎已被禁用。

我的 aspx 默认为空白，代码隐藏为

```
namespace TestWebapp
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            System.Diagnostics.Debug.WriteLine(String.Format("Before1: Current Princupal = {0}", Thread.CurrentPrincipal.Identity.Name));
            WindowsImpersonationContext ctx = WindowsIdentity.Impersonate(IntPtr.Zero);
            try
            {
                int a = 0;
                System.Diagnostics.Debug.WriteLine(String.Format("After: Current Princupal = {0}", Thread.CurrentPrincipal.Identity.Name));
            } finally
            {
                ctx.Undo();
            }

        }
    }
} 
```

当我重新加载页面时，我得到以下调试输出：

> [5288] 之前 1：当前主体 = 域\用户 [5288] 之后：当前主体 = 域\用户

输出与

```
<identity impersonate="false"/> 
```

该网站使用默认应用程序池，并且该池设置为使用 NETWORK SERVICE 帐户用于其工作进程。我确定应用程序使用它应该使用的 web.config，并且 w3p.exe 工作进程正在网络服务下运行。

在这种情况下有什么问题？

谢谢！

@Edit：Rob，感谢您的提示！$user 快捷方式告诉我一切都在按我的预期发生：通过模拟，我有运行用户 NT AUTHORITY\NETWORK SERVICE 的进程，并且线程在 WindowsIdentity.Impersonate(IntPtr.Zero) 和“No Token.Thread”之前具有 DOMAIN\User不冒充。” 后。但是 Thread.CurrentPrincipal.Identity.Name 和 HttpContext.Current.User.Identity.Name 在这两个地方仍然给我 DOMAIN\User 。

@Edit：我发现要更改 Thread.CurrentPrincipal 和 HttpContext.Current.User 我必须手动进行：

```
Thread.CurrentPrincipal = new WindowsPrincipal(WindowsIdentity.GetCurrent());
HttpContext.Current.User = Thread.CurrentPrincipal; 
```

我不确定这里有什么意义，但无论如何。我现在对 sharepoint 共享服务管理用户配置文件权限有疑问，但这是另一个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2019-07-03T11:20:57.350

我想我在这里理解你的问题。

在进一步移动之前要了解的事情，

1.  应用程序运行时有不同的安全上下文。像`System.Security.Principal.WindowsIdentity.GetCurrent().Name`，和你上面提到的那个，即`System.Threading.Thread.CurrentPrincipal.Identity.Name`

2.  在 Web 应用程序中，`System.Threading.Thread.CurrentPrincipal.Identity`始终由`HttpContext.Current.User.Identity`.

说到你的意思。如果要修改`System.Threading.Thread.CurrentPrincipal.Identity`，则修改`HttpContext.Current.User.Identity`最初由您的身份验证机制提供的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T16:58:16.477

看起来很奇怪，有几件事要尝试：

*   在 Debug 中的断点上，在监视窗口中键入 $user，这将向您显示进程和线程标识。
*   您对 impersonate 的使用不正确，请尝试以下代码：

    ```
    // Declare the logon types as constants
    const long LOGON32_LOGON_INTERACTIVE = 2;
    const long LOGON32_LOGON_NETWORK = 3;

    // Declare the logon providers as constants
    const long LOGON32_PROVIDER_DEFAULT = 0;
    const long LOGON32_PROVIDER_WINNT50 = 3;
    const long LOGON32_PROVIDER_WINNT40 = 2;
    const long LOGON32_PROVIDER_WINNT35 = 1;

    [DllImport("advapi32.dll", EntryPoint = "LogonUser")]
    private static extern bool LogonUser(
        string lpszUsername,
        string lpszDomain,
        string lpszPassword,
        int dwLogonType,
        int dwLogonProvider,
        ref IntPtr phToken);

    public static WindowsImpersonationContext ImpersonateCurrentUserBegin(System.Net.NetworkCredential credential)
    {
        WindowsImpersonationContext impersonationContext = null;
        if (credential == null || credential.UserName.Length == 0 || credential.Password.Length == 0 || credential.Domain.Length == 0)
        {
            throw new Exception("Incomplete user credentials specified");
        }
        impersonationContext = Security.Impersonate(credential);
        if (impersonationContext == null)
        {
            return null;
        }
        else
        {
            return impersonationContext;
        }
    }

    public static void ImpersonateCurrentUserEnd(WindowsImpersonationContext impersonationContext)
    {
        if (impersonationContext != null)
        {
            impersonationContext.Undo();
        }
    } 
    ```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T16:58:25.620

`HttpContext.User.Identity.Name`给你什么？

假设您已经检查了 IIS 中的安全选项卡，它允许匿名访问？

您是否在具有一些奇怪的本地策略的活动目录中？

# macos - 如何在 TextMate 中撤消多个字符？

> ID：247568
> 
> 赞同：6
> 
> 时间：2008-10-29T16:53:48.467
> 
> 标签：macos, plugins, editor, textmate

[TextMate](http://macromates.com/)可能是目前最好的编辑器，但它有一个很大的缺点：它撤消输入的每个字符而不是对字符进行分组。这使得大撤消变得乏味！

您现在是否有任何黑客、插件或解决方法来解决此问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T17:06:46.757

我知道开发人员多年来一直承诺修复，这是用户社区经常抱怨的事情。但我认为我没有看到比“按住 Cmd-Z 重复”更有用的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T20:16:10.103

这并不完全是您所要求的，而是更多的解决方法，因为正如 dnord 所说，这是 TextMate 的一个基本问题，并且在 Allen Odegard 决定修复它之前不会得到修复。

您是否考虑过尝试其中的剪贴板管理器？至少这样你就可以随意剪辑文本块并“撤消”它们。

我使用[Jumpcut](http://jumpcut.sourceforge.net/)是因为它是免费的并且可以完成这项工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-06T00:08:20.887

以防万一有人还不知道这一点：Shift-Option-Arrow 可让您逐字选择内容。

如果您养成在删除文本之前选择整个单词的习惯，您将在删除文本和撤消文本时节省时间。

# c - 替换导入的类型库

> ID：247569
> 
> 赞同：0
> 
> 时间：2008-10-29T16:53:51.480
> 
> 标签：c, visual-studio

我正在做一个使用导入的项目

```
#import "progid:Blah.blah.retrieve" rename_namespace("Blah") 
```

但我真的不希望注册 dll，我相信这是允许它工作的缺失。我不想注册 dll，因为我们的构建系统将无法一次构建多个实例。有没有一些简单的方法可以将此导入转换为其他形式？我有它正在导入的 progid 的来源。

正如您可能会说的那样，我不太了解这个#import 函数，有人知道它的好入门吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T17:05:56.603

#import 引入针对您指定的 prog id 注册的类型库。它通过在注册表中查找它并跟踪它在那里找到的线索来做到这一点。

您也可以直接通过文件名在 dll 上使用#import，并且完全不需要注册它。如果您有权访问它，您甚至可以直接指定 tlb 文件。请参阅[#import](http://msdn.microsoft.com/en-us/library/8etzzkb6(VS.71).aspx)指令的文档。

如果您需要对指定表示类型库的资源进行更多控制，则有一篇相关的[知识库文章](http://support.microsoft.com/kb/317217)。

# c# - 使用 Nhibernate 过滤通过 Aggregate Root 返回的子集合

> ID：247571
> 
> 赞同：5
> 
> 时间：2008-10-29T16:54:06.563
> 
> 标签：c#, nhibernate

我正在尝试在使用 Nhibernate 加载聚合根的子集合时对其进行过滤。加载客户所有已发货的订单。这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T19:53:30.743

好吧，您可以公开在地图中过滤的属性，如下所示：

```
<bag name="shippedOrders" ... where="Status == 'Shipped'" >
   <key column="CustomerId" />
   <one-to-many class="Order" />
</bag> 
```

'where' 属性是任意 SQL。

从理论上讲，您可以拥有 Customer、Orders 和 ShippedOrders 的两个属性。但是，我应该说我没有这样做，我想测试 NH 在这种情况下如何处理级联。在任何情况下，您都必须注意在添加/删除新项目时将它们正确添加/删除到两个集合中。

您想要这样做的事实使我们想知道 Order 是否是聚合根。从长远来看，这样做可能会减少麻烦：

```
orderRepository.GetOrders(int customerId, OrderStatus[] statuses) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T13:15:09.970

您可以换一种方式看待它 - 为客户加载所有已发货的订单。

```
session.CreateCriteria( typeOf(Order) )
    .Add( Restrictions.Eq("Shipped", shippedStatus ) )
    .Add( Restrictions.Eq("Customer", requiredCustomer) )
    .List<Order>(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T14:13:52.193

您也可以使用 HQL 使用 session.Filter(customer.Orders, "where this.Status == 'Shipped'");

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T14:17:50.123

```
ICriteria crit = session.CreateCriteria (typeof(Customer));

crit.CreateAlias ("Orders", "o");
crit.Add (Expression.Eq ("o.Status", shippedStatus));
crit.Add (Expression.Eq ("Id", customerId));

return crit.UniqueResult <Customer>(); 
```

类似的东西。

# php - 如何为后退按钮保留 Web 表单内容

> ID：247573
> 
> 赞同：5
> 
> 时间：2008-10-29T16:54:43.207
> 
> 标签：php, javascript, session, forms, back-button

当提交 Web 表单并将用户带到另一个页面时，用户通常会单击“后退”按钮以再次提交表单（在我的情况下，表单是高级搜索。）

当用户单击“返回”时，如何可靠地保留用户选择的表单选项（这样如果他们只更改多个表单元素之一，他们就不必从头开始重新填写表单？）

我是否必须沿着将表单选项存储在会话数据（cookie 或服务器端）中的路径，或者有没有办法让浏览器为我处理这个？

（环境是 PHP/JavaScript - 网站必须在 IE6+ 和 Firefox2+ 上运行）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T17:00:51.247

我相信你是在浏览器的摆布。当您回击时，浏览器不会向服务器发出新的内容请求，而是使用缓存（无论如何，在我见过的几乎所有浏览器中）。所以任何服务器端的东西都出来了。

我想知道您是否可以做一些非常复杂的事情，例如在结果页面的 onunload 事件期间将搜索结果存储在 cookie 中，然后在搜索页面上以 javascript 读取 cookie 并填写表格 - 但这只是猜测，我不知道它是否会工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T17:00:20.780

我会把它放在会话中。
这将是最可靠的，即使他们不直接“返回”，它仍然会有他们的搜索选项。将其放入 cookie 中也可以，但除非它是非常小的形式，否则不建议这样做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T17:35:29.617

这取决于浏览器，但在大多数情况下，您无需执行任何操作。

IE、Firefox 等会很高兴地记住前一页中表单的内容，并在单击 Back 时再次显示... -cache 或完全从脚本构建表单。

（在会话中添加内容可能会使浏览器在同一个表单上打开两个选项卡时感到困惑。在执行此类操作时要非常小心。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T17:04:27.417

您遇到的问题是浏览器将返回页面的缓存版本，并且可能不会再次向服务器请求它，这意味着使用会话将无关紧要。

但是，您可以使用 AJAX 在页面的加载事件中加载先前提交的表单的详细信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T17:13:57.287

您基本上必须在 POST 之后以某种方式（可能在会话变量中，如建议的那样）将其存储在您的服务器上。您还必须在表单页面上设置 Javascript 以在加载时执行以发出 AJAX 调用以从服务器获取数据（例如 JSON 格式）并用数据预填充表单字段。

示例 jQuery 代码：

```
$( document ).ready( function() {
  $.getJSON(
    "/getformdata.php",
    function( data ) {
      $.each( data.items, function(i,item) {
        $( '#' + item.eid ).val( item.val );
      } );
    });
} ); 
```

您的 /getformdata.php 可能会返回如下数据：

```
{
  'items': [
    {
      'eid': 'formfield1',
      'val': 'John',
    },
    {
      'eid': 'formfield2',
      'val': 'Doe',
    }
  ]
} 
```

如果会话没有保存任何内容，它显然会返回一个空数组。上面的代码很粗糙且未经测试，但这应该给你基本的想法。

附带说明：当前版本的 Opera 和 Firefox 将在返回时保留表单字段内容。您的 JS 代码将覆盖它，但这应该是安全的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T17:14:21.313

另一个 ajaxy 选项（因此对没有 javascript 的用户不利）是通过 javascript 提交表单，然后进入确认页面（或通过将按钮替换为消息来在表单上显示消息）。这样就没有“后退”的可能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T17:18:36.843

为什么不在提交之前将值存储到 cookie 中？您还可以包含时间戳或令牌以指示何时填写。然后，当页面加载时，您可以确定是否应该使用 cookie 中的数据填写字段，或者将它们留空，因为这是一个新的搜索。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-08T22:57:55.417

您还可以通过 javascript 在本地执行所有操作。因此，您使用搜索值存储一个 cookie，并在页面加载时检查该 cookie 是否存在。像这样的东西：

```
$('#formSubmitButton').click( function() {
    var value = $('#searchbox').val();
    var days = 1;
    var date = new Date();
    date.setTime(date.getTime()+(days*24*60*60*1000));
    var expires = "; expires="+date.toGMTString();
    document.cookie = "searchbox="+value+expires+"; path=/";
});

$(document).ready( function() {
    var nameEQ = "searchbox=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) var valueC = c.substring(nameEQ.length,c.length);
   }
   $('#searchbox').val(valueC);
}); 
```

尚未对此进行测试，但应该可以。为此，您将需要 jQuery。

Cookie 函数来自：[http ://www.quirksmode.org/js/cookies.html](http://www.quirksmode.org/js/cookies.html)

顺便说一句，FireFox 和 IE 默认都有这种行为。

# javascript - 访问 svg 的脚本

> ID：247596
> 
> 赞同：2
> 
> 时间：2008-10-29T17:01:32.773
> 
> 标签：javascript, html, svg

svg 是基于 xml 的图形，您可以向其中添加 JavaScript。我试图访问 svg 中定义的脚本函数。我的 svg 中的脚本是这样的：

```
<svg ... onload="RunScript(evt);"...>
<script type="text/javascript">
...
function RunScript(loadEvent) {
  // Get object in my html by id
  var objElement = top.document.getElementById('objid1');
  if (objElement)
  {
    // Extend object tag object's methods
    objElement.SVGsetDimension  = setDimension;
    ...
  }
  function setDimention(w, h) {...} 
```

在我的主 html 文件中，svg 嵌入在一个对象标签中，如下所示：

```
<object id="objid1" data="mygrahic.svg" ... >
<a href="#" onclick="document.getElementById('objid1').SVGsetDimention(10, 10);
   return false;"
...>Set new dimention</a>... 
```

这个工作正常。但是，如果 svg xml 文件被完整的 URL（在另一个站点上）引用，如下所示：

```
<object id="objid1" data="http://www.artlibrary.net/myaccount/mygrahic.svg" ... > 
```

这些代码不再起作用。看起来我无法将我的 svg 脚本中定义的方法附加到我的主 html 对象标记元素中的方法，或者在这种情况下顶部或文档不可用，或者 getElementById(..) 只是找不到我的对象元素我的 svg 脚本。有什么办法可以在 svg xml 脚本中找到我的 html 元素？

不确定这个问题是否是由不同的 DOM 引起的，并且我的 svg 脚本代码无法找出另一个 DOM 的对象或元素。如果有任何解决方案会很好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T18:09:30.000

我认为线索可能在“另一个网站上”。关于何时允许来自不同站点的 JavaScript 程序与教其他程序通信有严格的规定。嵌入式 SVG 的处理方式与文档中的文档相同`iframe`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-08-18T08:05:12.520

因此，从浏览器的角度来看，您所做的是等同于以下内容：

```
<script>
function stealPassword() {
  var passwordInput = document.querySelector('input[type="password"]');
  var value = passwordInput.value; // My password!
  sendPasswordToServerToStealMyMoney(value);
}
</script>
<iframe src=mybank.com onload=stealPassword()></iframe> 
```

我想你会明白为什么这是不可取的。（不过，您的错误控制台中可能应该有警告或异常。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T19:53:29.213

pdc 有这个权利。浏览器努力防止跨站点脚本攻击（XSS），结果就是这样。您不能在从另一个域加载的文档中执行脚本，也不能使用另一个端口或协议。有关更多信息，您可以查看：[http ://en.wikipedia.org/wiki/Same_origin_policy](http://en.wikipedia.org/wiki/Same_origin_policy)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-04T02:53:20.377

根据我的经验；您的代码是正确的，因此可以准确运行。我的电脑 Windows 7，IE9，安装了 Adob​​e Viewer。两者都除非SVG Viewer，IE9 SVG绘制，但不能运行SVG TAG Animation，只能运行Javascript Animation。因此，在 Windows XP、IE8 下，安装 Adob​​e SVG Viewer，结果相同（完全运行）。

Firefox SVG 不能完全在我的电脑下运行（SVG ecmascript 动画）。

# objective-c - 如何捕获 OCUnit 测试通过/失败消息/事件

> ID：247607
> 
> 赞同：10
> 
> 时间：2008-10-29T17:05:03.157
> 
> 标签：objective-c, unit-testing, continuous-integration, ocunit

我正在尝试将 xcodebuild 和 OCUnit 与我的持续集成服务器（[TeamCity](http://www.jetbrains.com/teamcity/)）一起使用。

JetBrains 为 boost::test 和 CppUnit 提供测试观察器实现，以 TeamCity 可以解释的方式格式化测试输出。如果我想使用 OCUnit，我需要为它做类似的事情。

OCUnit 中似乎有一个 SenTestObserver 类，但我不知道它应该如何使用，而且[OCUnit 主页](http://www.sente.ch/software/ocunit/)似乎没有提供任何有关此事的文档。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T00:25:34.963

您可以通过扩展 SenTestObserver 类并实现通知侦听器来编写自己的观察者

*   (void) testSuiteDidStart:(NSNotification *) aNotification
*   (void) testSuiteDidStop:(NSNotification *) aNotification
*   (void) testCaseDidStart:(NSNotification *) aNotification
*   (void) testCaseDidStop:(NSNotification *) aNotification
*   (void) testCaseDidFail:(NSNotification *) aNotification

然后使用您的班级名称向 info.plist SenTestObserverClass 添加一个条目。

至少在我熟悉的 OCUnit 版本中，SenTestObserver 是同等有用/同等部分损坏。我只是完全跳过它并在我自己的班级中自己注册通知。（有关通知名称的定义，请参见 SenTestSuiteRun.h 和 SenTestCaseRun.h）。

您可以使用通知的测试和运行属性来访问 SenTestSuite 和 SenTestSuiteRun 实例，运行实例包含实际结果所需的信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-27T08:51:04.680

我已经实现了一个简单的 Teamcity 适配器，你可以在[这里查看要点](https://gist.github.com/994882)。SenTestObserver 并没有完全损坏，它根本不符合最佳实践：

这是您需要在 Observer 子类中调用以正确注册它的内容：

```
+(void)initialize
{
    [[NSUserDefaults standardUserDefaults] setValue:@"TeamCityAdapter" forKey:@"SenTestObserverClass"];
    // we need to force SenTestObserver to register us as a handler
    // SenTestObserver is properly guarding against this invocation so nothing bad will hapen
    // but this is required (bad design on SenTestObserver's side)...
    [super initialize];
} 
```

因为 SenTestObserver 的初始化看起来像这样：

```
+ (void) initialize
{
    if ([self class] == [SenTestObserver class]) {
        NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
        NSDictionary *registeredDefaults = [NSDictionary dictionaryWithObjectsAndKeys:
            @"SenTestLog" , @"SenTestObserverClass",
            nil];
        [defaults registerDefaults:registeredDefaults];
        [NSClassFromString ([defaults objectForKey:@"SenTestObserverClass"]) class]; // make sure default observer is loaded
    }

    if ([[[NSUserDefaults standardUserDefaults] objectForKey:@"SenTestObserverClass"] isEqualToString:NSStringFromClass(self)]) {
        [self setCurrentObserver:self];
    }
} 
```

我希望这将帮助其他寻找 OCUnit / SenTestingKit 的 teamcity 适配器的人。

# c# - C# 的正确版本号是什么？

> ID：247621
> 
> 赞同：2770
> 
> 时间：2008-10-29T17:09:40.230
> 
> 标签：c#, .net, visual-studio, .net-core, .net-framework-version

C# 的正确版本号是什么？什么时候出来的？为什么我找不到关于***C# 3.5***的任何答案？

这个问题主要是为了帮助那些使用不正确的版本号（例如***C# 3.5*** ）搜索答案的人。希望任何未能使用错误版本号找到答案的人都会找到*此*问题，然后使用正确的版本号再次搜索。

* * *

## 回答 #1

> 赞同：3075
> 
> 时间：2008-10-29T17:10:18.090

# C#语言版本历史：

以下是撰写本文时已知[的 C# 版本：](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-version-history)

*   **C# 1.0**与 .NET 1.0 和 VS2002 一起发布（2002 年 1 月）
*   **C# 1.2**（很奇怪）；与 .NET 1.1 和 VS2003（2003 年 4 月）一起发布。第一个调用 s 的版本`Dispose`实现`IEnumerator`了`IDisposable`. 其他一些小功能。
*   **C# 2.0**与 .NET 2.0 和 VS2005 一起发布（2005 年 11 月）。主要新特性：泛型、匿名方法、可空类型和迭代器块
*   **C# 3.0**随 .NET 3.5 和 VS2008（2007 年 11 月）一起发布。主要新特性：lambda 表达式、扩展方法、表达式树、匿名类型、隐式类型 ( `var`) 和查询表达式
*   **C# 4.0**随 .NET 4 和 VS2010（2010 年 4 月）一起发布。主要新特性：后期绑定（`dynamic`）、委托和接口泛型变化、更多[COM](https://en.wikipedia.org/wiki/Component_Object_Model)支持、命名参数、元组数据类型和可选参数
*   **C# 5.0**随 .NET 4.5 和 VS2012 一起发布（2012 年 8 月）。[主要特点](https://devblogs.microsoft.com/csharpfaq/visual-studio-11-beta-is-here/)：异步编程和调用者信息属性。重大变化：[循环变量关闭](https://ericlippert.com/2009/11/16/closing-over-the-loop-variable-considered-harmful-part-two/)。
*   **C# 6.0**与 .NET 4.6 和 VS2015 一起发布（2015 年 7 月）。由[Roslyn](https://github.com/dotnet/roslyn)实施。[特点](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-6)：自动实现属性的初始化器，使用指令导入静态成员，异常过滤器，元素初始化器，`await`in`catch`和`finally`，集合初始化器中的扩展`Add`方法。
*   **C# 7.0**随 .NET 4.7 和 VS2017（2017 年 3 月）一起发布。主要[新特性](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7)：[元组](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#tuples)、[ref locals 和 ref return](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#ref-locals-and-returns)、[模式匹配](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#pattern-matching)（包括基于模式的 switch 语句）、[内联`out`参数声明](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#out-variables)、[本地函数](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#local-functions)、[二进制文字、数字分隔符](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#numeric-literal-syntax-improvements)和[任意异步返回](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-7#generalized-async-return-types)。
*   **C# 7.1**随 VS2017 v15.3（2017 年 8 月）一起发布。新特性：[async main](https://github.com/dotnet/csharplang/issues/97)、[元组成员名称推断](https://github.com/dotnet/csharplang/issues/415)、[默认表达式](https://github.com/dotnet/csharplang/issues/102)和[与泛型匹配的模式](https://github.com/dotnet/csharplang/issues/154)。
*   **C# 7.2**随 VS2017 v15.5（2017 年 11 月）一起发布。新特性：[私有受保护访问修饰符](https://github.com/dotnet/csharplang/issues/37)、[Span<T>、又名内部指针、又名 stackonly 结构](https://github.com/dotnet/csharplang/issues/666)和[其他所有内容](https://github.com/dotnet/csharplang/milestone/6)。
*   **C# 7.3**随 VS2017 v15.7（2018 年 5 月）一起发布。新特性：[枚举、委托和`unmanaged`泛型类型约束](https://devblogs.microsoft.com/premier-developer/dissecting-new-generics-constraints-in-c-7-3/)。`ref`重新分配。不安全的改进：`stackalloc`初始化、未固定的索引`fixed`缓冲区、自定义`fixed`语句。改进的重载分辨率。初始化程序和查询中的表达式变量。`==`并`!=`为元组定义。自动属性的支持字段现在可以由属性定位。
*   **C# 8.0**随 .NET Core 3.0 和 VS2019 v16.3（2019 年 9 月）一起发布。主要[的新特性](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8)：[可为空的引用类型](https://docs.microsoft.com/en-us/dotnet/csharp/nullable-references)、[异步流](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#asynchronous-streams)、[索引和范围](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#indices-and-ranges)、[只读成员](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#readonly-members)、[使用声明](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#using-declarations)、[默认接口方法](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#default-interface-methods)、[静态局部函数](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#static-local-functions)和[插值逐字字符串的增强](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#enhancement-of-interpolated-verbatim-strings)。
*   **C# 9.0**随[.NET 5.0](https://devblogs.microsoft.com/dotnet/announcing-net-5-0/)和 VS2019 v16.8（2020 年 11 月）一起发布。主要[新特性](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9)：[init-only 属性](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#init-only-setters)、[记录](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#record-types)、[with-expressions](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/with-expression)、数据类、位置记录、[顶级程序](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#top-level-statements)、[改进的模式匹配](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#pattern-matching-enhancements)（简单类型模式、关系模式、逻辑模式）、改进的目标类型（目标类型`new`表达式、目标类型`??`和`?`)，以及协变返回。次要功能：放宽`ref`和`partial`修饰符的排序、参数空值检查、lambda 丢弃参数、native `int`s、本地函数的属性、函数指针、静态 lambda、扩展`GetEnumerator`、模块初始化器和扩展部分。
*   **C# 10.0**与 .NET 6.0 一起发布（2021 年 11 月）。主要[新特性](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-10)：记录结构、结构无参数构造函数、插值字符串处理程序、全局`using`指令、文件范围的命名空间声明、扩展属性模式、常量插值字符串、解构中的混合赋值和声明、单个方法的异步方法构建器（通过属性），参数的`CallerArgumentExpression`属性，增强的`#line`编译指示。

## 针对OP的问题：

> C# 的正确版本号是什么？什么时候出来的？为什么我找不到关于 C# 3.5 的任何答案？

没有像 C# 3.5 这样的东西——这里造成混淆的原因是 C# 3.0 存在于 .NET 3.5 中。然而，语言和框架是独立版本控制的——CLR 也是如此，它在 .NET 2.0 到 3.5 的 2.0 版本中，.NET 4 引入了 CLR 4.0，尽管有服务包。.NET 4.5 中的 CLR 有各种改进，但版本控制不清楚：在某些地方它可能被称为 CLR 4.5（例如，[这个 MSDN 页面](https://msdn.microsoft.com/en-us/library/bb822049.aspx)曾经这样引用它），但该[`Environment.Version`](https://docs.microsoft.com/en-us/dotnet/api/system.environment.version)属性仍然报告 4.0。 xxx。

截至 2017 年 5 月 3 日，C# 语言团队在其 GitHub 存储库中创建了 C# 版本和功能的历史记录：[C# 语言版本中添加的功能](https://github.com/dotnet/csharplang/blob/master/Language-Version-History.md)。还有[一个页面跟踪即将推出和最近实现的语言功能](https://github.com/dotnet/roslyn/blob/master/docs/Language%20Feature%20Status.md)。

* * *

## 回答 #2

> 赞同：404
> 
> 时间：2016-07-21T14:14:48.133

这与此处的大多数答案相同，但为方便起见，采用了表格形式，并且为了完整起见，它具有**Visual Studio**和**.NET**版本。

| C#版本 | VS版 | .NET 版本 | CLR 版本 | 发布日期 |
| --- | --- | --- | --- | --- |
| 1.0 | 2002年 | 1.0 | 1.0 | 2002 年 2 月 |
| 1.2 | 2003年 | 1.1 | 1.1 | 2003 年 4 月 |
| 2.0 | 2005年 | 2.0 | 2.0 | 2005 年 11 月 |
|  |  | 3.0 | 2.0 | 2006 年 11 月 |
| 3.0 | 2008年 | 3.5 | 2.0 | 2007 年 11 月 |
| 4.0 | 2010 | 4.0 | 4 | 2010 年 4 月 |
| 5.0 | 2012 | 4.5 | 4 | 2012 年 8 月 |
| 5.0 | 2013 | 4.5.1 | 4 | 2013 年 10 月 |
|  |  | 4.5.2 | 4 | 2014 年 5 月 |
| 6.0 | 2015 | 4.6 | 4 | 2015 年 7 月 |
|  |  | 4.6.1 | 4 | 2015 年 11 月 |
|  |  | 4.6.2 | 4 | 2016 年 8 月 |
| 7.0 | 2017 |  |  | 2017 年 3 月 |
|  |  | 4.7 | 4 | 2017 年 5 月 |
| 7.1 | 2017 (v15.3) |  |  | 2017 年 8 月 |
|  |  | 4.7.1 | 4 | 2017 年 10 月 |
| 7.2 | 2017 (v15.5) |  |  | 2017 年 12 月 |
|  |  | 4.7.2 | 4 | 2018 年 4 月 |
| 7.3 | 2017 (v15.7) |  |  | 2018 年 5 月 |
| 8.0 | 2019 | 4.8 | 4 | 2019 年 4 月 |
| 9.0 | 2019 (v16.8) | 5.0* | ** | 2020 年 11 月 |

### 自 .NET Core 以来的版本

| C#版本 | VS版 | .NET 版本 | 发布日期 | 支持结束 |
| --- | --- | --- | --- | --- |
|  | 2015 更新 3 | .NET 核心 1.0 | 2016 年 6 月 | 2019 年 6 月 |
|  |  | .NET 核心 1.1 | 2016 年 11 月 | 2019 年 6 月 |
| 7.1 | 2017 (v15.3) | .NET 核心 2.0 | 2017 年 8 月 | 2018 年 10 月 |
| 7.3 | 2017 (v15.7) | .NET 核心 2.1 | 2018 年 5 月 | 2021 年 8 月 |
|  |  | .NET 核心 2.2 | 2018 年 12 月 | 2019 年 12 月 |
|  | 2019 (v16.3) | .NET 核心 3.0 | 2019 年 9 月 | 2020 年 3 月 |
|  | 2019 (v16.4) | .NET 核心 3.1 | 2019 年 12 月 | 2022 年 12 月 |
| 9.0 | 2019 (v16.8) | .NET 5 | 2020 年 11 月 | 2022 年 2 月 |
| 10.0 | 2022 | .NET 6 | 2021 年 11 月 | 2024 年 11 月 |
|  |  | .NET 7 | 2022 年 11 月 | 2023 年 2 月 |
|  |  | .NET 8 | 2023 年 11 月 | 2026 年 11 月 |

* - .NET 5.0 不是 .NET 框架的更新版本，而是 .NET Core 3。从 .NET 5.0 开始，没有更新版本的 .NET 完整框架。

** - [.NET Core 没有单独的 CLR (CoreCLR) 版本。](https://docs.microsoft.com/en-us/dotnet/standard/clr?redirectedfrom=MSDN#clr-versions)无论 .NET Core 版本是什么，CoreCLR 版本都是如此。所以不提了。

* * *

**注意：** .NET 开发现在几乎独立于 VS，每个版本之间没有关联。
有关更多信息，请参阅“ [.NET Framework 版本和依赖](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/versions-and-dependencies)项”和“ [.NET 发布节奏](https://dotnet.microsoft.com/platform/support/policy/dotnet-core)”。

* * *

## 回答 #3

> 赞同：317
> 
> 时间：2008-11-25T16:10:04.447

处理 C# 的版本号时最大的问题是它与 .NET Framework 的版本无关，这似乎是由于 Visual Studio 和 .NET Framework 之间的同步版本所致。

C# 的版本实际上绑定到编译器，而不是框架。例如，在 Visual Studio 2008 中，您可以编写 C# 3.0 并以 .NET Framework 2.0、3.0 和 3.5 为目标。C# 3.0 命名法描述代码语法版本和支持的特性的方式与[ANSI C89、C90 和 C99](http://en.wikipedia.org/wiki/ANSI_C)描述 C 的代码语法和特性的方式相同。

看看[Mono](http://www.mono-project.com)，您会发现 Mono 2.0（主要是根据 ECMA 规范实现的 .NET Framework 2.0 版）支持 C# 3.0 语法和功能。

* * *

## 回答 #4

> 赞同：214
> 
> 时间：2010-12-31T13:15:12.947

*   **C# 1.0**与[Visual Studio .NET](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#.NET_2002)

*   **C# 2.0**与[Visual Studio 2005](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2005)

*   **C# 3.0**与[Visual Studio 2008](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2008)

*   **C# 4.0**与[Visual Studio 2010](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2010)

*   **C# 5.0**与[Visual Studio 2012](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2012)

*   **C# 6.0**与[Visual Studio 2015](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2015)

*   **C# 7.0**与[Visual Studio 2017](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2017)

*   **C# 8.0**与[Visual Studio 2019](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2019)

*   **C# 9.0**与 Visual Studio 2019

* * *

## 回答 #5

> 赞同：95
> 
> 时间：2010-05-07T11:08:21.777

| [版本](http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/f19a5ce8-1206-4600-a940-cacbbf588344) | 语言规范 | 微软编译器 |
| --- | --- | --- |
| C# [1.0](http://download.microsoft.com/download/a/9/e/a9e229b9-fee5-4c3e-8476-917dee385062/CSharp%20Language%20Specification%20v1.0.doc) / [1.2](http://download.microsoft.com/download/5/e/5/5e58be0a-b02b-41ac-a4a3-7a22286214ff/csharp%20language%20specification%20v1.2.doc) | 2001 年 12 月^？/2003 年^？ | 2002 年 1 月^? |
| C# 2.0 | [2005 年 9 月](http://download.microsoft.com/download/7/E/6/7E6A548C-9C20-4C80-B3B8-860FAF20887A/CSharp%204.0%20Specification.doc) | 2005 年 11 月^? |
| C# 3.0 | [2006 年 5 月](http://download.microsoft.com/download/5/8/6/5868081c-68aa-40de-9a45-a3803d8134b8/CSharp_3.0_Specification.doc) | 2006 年 11 月^？ |
| C# 4.0 | [2009 年 3 月（草案）](http://download.microsoft.com/download/7/E/6/7E6A548C-9C20-4C80-B3B8-860FAF20887A/CSharp%204.0%20Specification.doc) | 2010 年 4 月^？ |
| C# 5.0 |  | 2012 年 8 月随 .NET 4.5 发布 |
| C# 6.0 |  | 与 .NET 4.6 2015 一起发布 |
| C# 7.0 |  | 与 .NET 4.7 2017 一起发布 |
| C# 8.0 |  | 随 .NET 4.8 2019 发布 |

* * *

## 回答 #6

> 赞同：60
> 
> 时间：2017-01-04T05:38:55.383

我总结了这张表中的大部分版本。唯一缺少的应该是 ASP.NET Core 版本。我还添加了不同版本的 ASP.NET MVC。

请注意，ASP.NET 5 已更名为 ASP.NET Core 1.0，ASP.NET MVC 6 已更名为 ASP.NET Core MVC 1.0.0。我相信这种变化发生在 2016 年 1 月左右。

我已经在表中包含了 ASP.NET 5 RC1 的发布日期，但是我还没有包含 ASP.NET core 1.0 和其他核心版本，因为我找不到确切的发布日期。您可以在此处阅读有关 ASP.NET Core 发布日期的更多信息：*[ASP.NET Core 1.0 (ASP.NET 5 / vNext) 计划何时发布？](https://stackoverflow.com/questions/27553952/when-is-asp-net-core-1-0-asp-net-5-vnext-scheduled-for-release)*

[![版本](https://i.stack.imgur.com/NGnxu.png)](https://i.stack.imgur.com/NGnxu.png)

* * *

## 回答 #7

> 赞同：55
> 
> 时间：2014-10-14T21:25:14.627

[您可以在此处](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)查看最新的 C# 版本 ![C# 版本](https://i.stack.imgur.com/Xld6e.png)

* * *

## 回答 #8

> 赞同：40
> 
> 时间：2013-05-21T02:54:13.703

对比 MSDN 文章[“What's New in the C# 2.0 Language and Compiler”](http://msdn.microsoft.com/en-US/library/7cz8t42e%28v=vs.80%29.aspx)和“ [What's New in the Visual C# 2005](http://msdn.microsoft.com/en-US/library/t27ahy37%28v=vs.80%29.aspx) ”，可以推断出“C# major_version.minor_version”是根据编译器的版本编号产生的。

有[对应于 .NET 1.1 和 VS 2003 的 C# 1.2](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29#Versions)也称为[Visual C# .NET 2003](http://msdn.microsoft.com/en-us/library/aa289527%28v=vs.71%29.aspx)。

但进一步在微软停止增加次要版本（在点之后）数字或让它们不是零，`0`. 尽管应该注意，对应于 .NET 3.5 的 C# 在 msdn.microsoft.com 中被命名为["Visual C# 2008 Service Pack 1"](http://msdn.microsoft.com/en-us/library/bb383815%28v=vs.90%29.aspx)。

有两种并行的命名方式：按主要 .NET/编译器版本编号和按 Visual Studio 编号。

[C# 2.0](http://msdn.microsoft.com/en-US/library/7cz8t42e%28v=vs.80%29.aspx)是[Visual C# 2005的同义词](http://msdn.microsoft.com/en-US/library/t27ahy37%28v=vs.80%29.aspx)

C# 3.0 对应（或者，更准确地说，可以定位）：

*   .NET 2.0 <==> [Visual C# 2005](http://msdn.microsoft.com/en-US/library/t27ahy37%28v=vs.80%29.aspx)
*   .NET3.0 <==> Visual C# 2008
*   .NET 3.5 <==> [Visual C# 2008 Service Pack 1](http://msdn.microsoft.com/en-us/library/bb383815%28v=vs.90%29.aspx)

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2019-11-24T22:12:41.290

## C# 1.0 - Visual Studio .NET 2002

*   课程
*   结构
*   接口
*   活动
*   特性
*   代表们
*   表达式
*   声明
*   属性
*   字面量

## C# 1.2 - Visual Studio .NET 2003

*   在 foreach 中处理
*   foreach 字符串特化
*   C# 2 - Visual Studio 2005
*   泛型
*   部分类型
*   匿名方法
*   迭代器
*   可空类型
*   Getter/setter 单独的可访问性
*   方法组转换（委托）
*   静态类
*   委托推理

## C# 3 - Visual Studio 2008

*   隐式类型的局部变量
*   对象和集合初始化器
*   自动实现的属性
*   匿名类型
*   扩展方法
*   查询表达式
*   Lambda 表达式
*   表达式树
*   部分方法

## C# 4 - Visual Studio 2010

*   动态绑定
*   命名参数和可选参数
*   泛型委托和接口的协变和反变
*   嵌入式互操作类型（“NoPIA”）

## C# 5 - Visual Studio 2012

*   异步方法
*   来电者信息属性

## C# 6 - Visual Studio 2015

*   在线规范草案
*   编译器即服务 (Roslyn)
*   将静态类型成员导入命名空间
*   异常过滤器
*   在 catch/finally 块中等待
*   自动属性初始化器
*   仅 getter 属性的默认值
*   表达体成员
*   空传播器（空条件运算符，简洁的空检查）
*   字符串插值
*   运营商名称
*   字典初始化器

## C# 7.0 - Visual Studio 2017

*   输出变量
*   模式匹配
*   元组
*   解构
*   丢弃
*   局部函数
*   二进制字面量
*   数字分隔符
*   参考返回和本地人
*   广义异步返回类型
*   更多表情丰富的成员
*   抛出表达式

## C# 7.1 - Visual Studio 2017 版本 15.3

*   异步主
*   默认表达式
*   参考装配体
*   推断元组元素名称
*   使用泛型进行模式匹配

## C# 7.2 - Visual Studio 2017 版本 15.5

*   跨度和类引用类型
*   在参数和只读引用中
*   参考条件
*   非尾随命名参数
*   私有受保护的可访问性
*   基本说明符后的数字分隔符

## C# 7.3 - Visual Studio 2017 版本 15.7

*   System.Enum、System.Delegate 和非托管约束。
*   Ref 本地重新分配：现在可以使用 ref 分配运算符 (= ref) 重新分配 Ref locals 和 ref 参数。
*   Stackalloc 初始化器：现在可以初始化堆栈分配的数组，例如 Span x = stackalloc[] { 1, 2, 3 };。
*   索引可移动的固定缓冲区：固定缓冲区可以在没有先被固定的情况下被索引。
*   自定义固定语句：可以在固定语句中使用实现合适 GetPinnableReference 的类型。
*   改进的重载候选者：可以及早排除一些重载解决候选者，从而减少歧义。
*   初始化器和查询中的表达式变量：字段初始化器、构造器初始化器和 LINQ 查询中允许使用 out var 和模式变量等表达式变量。
*   元组比较：元组现在可以用 == 和 != 进行比较。
*   支持字段上的属性：允许自动实现的属性上的 [field: ...] 属性以它的支持字段为目标。

## C# 8.0 - .NET Core 3.0 和 Visual Studio 2019 版本 16.3

*   可空引用类型：在 API 中使用 ?、notnull 约束和注解属性表达对引用类型的可空性意图，编译器将使用这些来尝试检测可能的空值被取消引用或传递给不合适的 API。
*   默认接口成员：接口现在可以具有具有默认实现的成员，以及除状态之外的静态/私有/受保护/内部成员（即无字段）。
*   递归模式：位置模式和属性模式允许对对象进行更深入的测试，开关表达式允许测试多个模式并以紧凑的方式产生相应的结果。
*   异步流：await foreach 和 await using 允许异步枚举和处置 IAsyncEnumerable 集合和 IAsyncDisposable 资源，并且 async-iterator 方法允许方便地实现此类异步流。
*   增强的 using：使用隐式范围添加 using 声明，并且 using 语句和声明允许使用模式处理 ref 结构。
*   范围和索引：i..j 语法允许构造 System.Range 实例，^k 语法允许构造 System.Index 实例，这些可用于索引/切片集合。
*   Null-coalescing assignment: ??= 允许在值为 null 时有条件地分配。
*   静态局部函数：用 static 修改的局部函数不能捕获 this 或局部变量，并且局部函数参数现在会在父作用域中隐藏局部变量。
*   非托管通用结构：只有非托管字段的通用结构类型现在被视为非托管（即它们满足非托管约束）。
*   只读成员：现在可以将单个成员标记为只读，以指示并强制他们不修改实例状态。
*   嵌套上下文中的 Stackalloc：现在允许在更多表达式上下文中使用 stackalloc 表达式。
*   替代插值逐字字符串：@$"..." 字符串被识别为插值逐字字符串，就像 $@"..."。
*   属性访问器已过时：属性访问器现在可以单独标记为已过时。
*   Permit t 在不受约束的类型参数上为空

**【来源】：** [https ://github.com/dotnet/cshaplang/blob/master/Language-Version-History.md](https://github.com/dotnet/csharplang/blob/master/Language-Version-History.md)

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2020-08-08T15:01:04.273

```
Version     .NET Framework     Visual Studio     Important Features 
```

C# 1.0 .NET Framework 1.0/1.1 Visual Studio .NET 2002

*   基本功能

C# 2.0 .NET 框架 2.0 Visual Studio 2005

*   泛型
*   部分类型
*   匿名方法
*   迭代器
*   可空类型
*   私人二传手（属性）
*   方法组转换（委托）
*   协方差和逆变
*   静态类

C# 3.0 .NET Framework 3.0\3.5 Visual Studio 2008

*   隐式类型的局部变量
*   对象和集合初始化器
*   自动实现的属性
*   匿名类型
*   扩展方法
*   查询表达式
*   Lambda 表达式
*   表达式树
*   部分方法

C# 4.0 .NET Framework 4.0 Visual Studio 2010

*   动态绑定（后期绑定）
*   命名参数和可选参数
*   泛型协变和逆变
*   嵌入式互操作类型

C# 5.0 .NET Framework 4.5 Visual Studio 2012/2013

*   异步功能
*   来电者信息

C# 6.0 .NET Framework 4.6 Visual Studio 2013/2015

*   表达式体方法
*   自动属性初始化器
*   表达式名称
*   主构造函数
*   在 catch 块中等待
*   异常过滤器
*   字符串插值

C# 7.0 .NET Core 2.0 Visual Studio 2017

*   出变量
*   元组
*   丢弃
*   模式匹配
*   局部函数
*   广义异步返回类型
*   数字文字语法改进

C# 8.0 .NET Core 3.0 Visual Studio 2019

*   只读成员
*   默认接口方法
*   模式匹配增强：
    *   切换表达式
    *   属性模式
    *   元组模式
    *   位置模式
*   使用声明
*   静态局部函数
*   一次性引用结构
*   可空引用类型
*   异步流
*   异步一次性
*   指数和范围
*   空合并赋值
*   非托管构造类型
*   嵌套表达式中的 Stackalloc
*   插值逐字字符串的增强

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-03-02T11:48:35.070

C# 8.0 是 C# 的最新版本。它仅在 .NET Core 3.x 和更新版本上受支持。许多最新功能需要 .NET Core 3.x 中引入的库和运行时功能。

下表列出了目标框架及其版本及其默认 C# 版本。

[![带有 Target 框架的 C# 语言版本](https://i.stack.imgur.com/DSuKQ.png)](https://i.stack.imgur.com/DSuKQ.png)

[源代码 - C# 语言版本控制](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/configure-language-version)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-08-04T16:52:35.973

我一直在寻找 .NET、C#、CLR 和 Visual Studio 版本以及关键语言功能的简明历史。

由于我无法在一个地方找到包含我需要的所有信息的任何最新表格 - 我将 Microsoft 文档中的详细信息合并到我试图保留包含我正在寻找的内容的简洁表格中。

它在这里可用：[https ://mantinband.github.io/dotnet-shmotnet/](https://mantinband.github.io/dotnet-shmotnet/)

我可能有一些错误或丢失的信息，所以请随时在这里打开一个问题或贡献：[https ://github.com/mantinband/dotnet-shmotnet](https://github.com/mantinband/dotnet-shmotnet)

抢先看：

![在此处输入图像描述](https://i.stack.imgur.com/ZuLfV.png)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-03-01T13:59:45.907

## 预览：C# 11.0 .NET Core 7.0 Visual Studio 2022 更新 1

[**`READ MORE`**](https://devblogs.microsoft.com/dotnet/early-peek-at-csharp-11-features/)

*   允许在插值字符串的“洞”中换行
*   列出模式
*   参数空检查
*   与可空引用类型的交互
*   通用属性
*   字段关键字
*   接口中的静态抽象
*   或模式下的声明
*   记录和初始化
*   受歧视的工会
*   T的参数跨度
*   作为表达式的语句
*   表达式树
*   类型系统扩展

# cron - 如何设置 cron 每隔一个半小时运行一次某些命令？

> ID：247626
> 
> 赞同：31
> 
> 时间：2008-10-29T17:11:35.170
> 
> 标签：cron

如何设置 cron 每隔一个半小时运行一次某些命令？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-29T17:17:03.693

使用 normal 中的单个表达式是不可能的`cron`。

在不修改代码的情况下你能做的最好的事情是：

```
0 0,3,6,9,12,15,18,21 * * *  [cmd]
30 1,4,7,10,13,16,19,22 * * * [cmd] 
```

这些*可能*是可压缩的，具体取决于您必须执行的 cron 版本：

```
0 */3 * * * [cmd]
30 1-23/3 * * * [cmd] 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-29T17:16:34.273

为什么你不能使用 1 小时或 2 小时有充分的理由吗？肯定会更简单。

我没有亲自尝试过，但你可以在这里找到一些关于让 cron 每 90 分钟运行一次的信息：http: [//keithdevens.com/weblog/archive/2004/May/05/cron](http://keithdevens.com/weblog/archive/2004/May/05/cron)

来自上述链接的摘录：

```
0 0,3,6,9,12,15,18,21 * * * <commands>
30 1,4,7,10,13,16,19,22 * * * <commands> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-29T17:17:11.213

crontab 中有两行。沿着：

```
0 0,3,6,9,12,15,18,21 * * * /usr/bin/foo
30 1,4,7,10,13,16,19,22 * * * /usr/bin/foo 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-29T17:17:55.360

您可以使用两个 crontab 条目来完成。每个每三个小时运行一次，它们会偏移 90 分钟，如下所示：

0 0,3,6,9,12,15,18,21 * * *

30 1,4,7,10,13,16,19,22 * * *

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T17:47:56.347

您还可以使用[fcron](http://fcron.free.fr/)，它也接受更复杂的时间规范，例如：

```
@ 01h30 my_cmd 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-02-17T04:21:19.493

```
#! /bin/sh

# Minute Cron
# Usage: cron-min start
# Copyright 2014 by Marc Perkel
# docs at http://wiki.junkemailfilter.com/index.php/How_to_run_a_Linux_script_every_few_seconds_under_cron"
# Free to use with attribution

# Run this script under Cron once a minute

basedir=/etc/cron-min

if [ $# -gt 0 ]
then
   echo
   echo "cron-min by Marc Perkel"
   echo
   echo "This program is used to run all programs in a directory in parallel every X minutes."
   echo
   echo "Usage: cron-min"
   echo
   echo "The scheduling is done by creating directories with the number of minutes as part of the"
   echo "directory name. The minutes do not have to evenly divide into 60 or be less than 60."
   echo
   echo "Examples:"
   echo "  /etc/cron-min/1      # Executes everything in that directory every 1  minute"
   echo "  /etc/cron-min/5      # Executes everything in that directory every 5  minutes"
   echo "  /etc/cron-min/13     # Executes everything in that directory every 13 minutes"
   echo "  /etc/cron-min/90     # Executes everything in that directory every 90 minutes"
   echo
   exit
fi

for dir in $basedir/* ; do
   minutes=${dir##*/}
   if [ $(( ($(date +%s) / 60) % $minutes )) -eq 0 ]
   then
      for program in $basedir/$minutes/* ; do
     if [ -x $program ]
     then
        $program &> /dev/null &
     fi
      done
   fi
done 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-08-27T22:30:27.457

`*/10 * * * * root perl -e 'exit(time()%(90*60)>60)' && command`

90 - 以分钟计是一个半小时

"> 60" — 我让 cron 能够在一分钟内延迟脚本的启动

此外，借助此 hack，您可以设置任何具有分钟分辨率的时间段

例如每 71 分钟启动一次脚本

`* * * * * root perl -e 'exit(time()%(71*60)>60)' && command`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-08-01T06:40:51.910

如果您计算自[Epoch](https://en.wikipedia.org/wiki/Unix_time)以来的分钟数（、小时、天或周），您可以实现任何频率，在脚本顶部添加条件，并将脚本设置为在您的 crontab 上每分钟运行一次：

```
#!/bin/bash

minutesSinceEpoch=$(($(date +'%s / 60')))

# every 90 minutes (one and a half hours)
if [[ $(($minutesSinceEpoch % 90)) -ne 0 ]]; then
    exit 0
fi 
```

[`date(1)`](http://linux.die.net/man/1/date)返回当前日期，我们将其格式化为自 Epoch ( `%s`) 以来的秒数，然后我们进行基本数学运算：

```
# .---------------------- bash command substitution
# |.--------------------- bash arithmetic expansion
# || .------------------- bash command substitution
# || |  .---------------- date command
# || |  |   .------------ FORMAT argument
# || |  |   |      .----- formula to calculate minutes/hours/days/etc is included into the format string passed to date command
# || |  |   |      |
# ** *  *   *      * 
  $(($(date +'%s / 60')))
# * *  ---------------
# | |        | 
# | |        ·----------- date should result in something like "1438390397 / 60"
# | ·-------------------- it gets evaluated as an expression. (the maths)
# ·---------------------- and we can store it 
```

您可以将此方法用于每小时、每天或每月的 cron 作业：

```
#!/bin/bash
# We can get the

minutes=$(($(date +'%s / 60')))
hours=$(($(date +'%s / 60 / 60')))
days=$(($(date +'%s / 60 / 60 / 24')))
weeks=$(($(date +'%s / 60 / 60 / 24 / 7')))

# or even

moons=$(($(date +'%s / 60 / 60 / 24 / 656')))

# passed since Epoch and define a frequency
# let's say, every 7 hours

if [[ $(($hours % 7)) -ne 0 ]]; then
    exit 0
fi

# and your actual script starts here 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-10T12:58:40.083

在 crontab 上使用“ [at ”](https://linuxize.com/post/at-command-in-linux/)

该命令在午夜执行，然后设置为在 1.30 执行

ETC ..

`0 */3 * * * echo "Command" | at now +90 minutes && Command`

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2014-06-27T10:15:55.010

将以下内容添加到我的 crontab 并且正在工作

```
15 */1   * * *   root    /usr/bin/some_script.sh >> /tmp/something.log 
```

# sql-server - 是否可以在没有 SSIS 的情况下执行 T-SQL 模糊查找？

> ID：247636
> 
> 赞同：9
> 
> 时间：2008-10-29T17:15:12.903
> 
> 标签：sql-server, tsql, ssis, fuzzy-search

SSIS 2005/2008 进行模糊查找和分组。在 T-SQL 中是否有相同的功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T17:18:57.777

SQL Server 有一个 SOUNDEX() 函数：

```
SELECT * 
FROM Customers
WHERE SOUNDEX(Lastname) = SOUNDEX('Stonehouse')
AND SOUNDEX(Firstname) = SOUNDEX('Scott') 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-29T22:22:18.413

模糊查找使用 q-gram 方法，通过将字符串分解成微小的子字符串并对它们进行索引。然后，您可以通过将输入分解为相同大小的字符串来搜索输入。您可以检查其索引的格式并编写一个 CLR 函数以使用相同样式的索引，但您可能正在谈论相当多的工作。

实际上他们是如何做到的非常有趣，非常简单但提供了非常强大的匹配并且非常可配置。

我记得上次查看索引时的索引，每个 q-gram 或子字符串都存储在表（索引）中的一行中。该行包含一个 nvarchar 列（以及其他值），用作二进制数据并包含对匹配行的引用。

[Microsoft Connect](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=338664)上也有针对此功能的公开反馈建议。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T17:28:36.463

全文搜索是一个很棒的模糊工具。[此处简要介绍](http://www.reluctantdba.com/Default.aspx?tabid=411&EntryID=67)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T16:13:33.017

2009 年 3 月 5 日，我将在 www.sqlservercentral.com 上发布一篇文章，其中包含 Jaro-Winkler TSQL 示例

# c++ - 隐藏在 C++ 类的嵌入式字符数组中的数据成员的性能、安全性和对齐方式是什么？

> ID：247639
> 
> 赞同：2
> 
> 时间：2008-10-29T17:16:17.097
> 
> 标签：c++, alignment

我最近看到一个代码库，我担心它违反了对齐约束。我已经对其进行了清理以生成一个最小的示例，如下所示。简而言之，球员是：

*   *游泳池*。对于“高效”的某些定义，这是一个有效分配内存的类。*池*保证返回与请求大小对齐的一块内存。

*   *对象列表*。此类存储对象的同类集合。一旦对象的数量超过某个阈值，它就会将其内部表示从列表更改为树。*Obj_list*的大小是一个指针（在 64 位平台上为 8 个字节）。它的商店当然会超过这个。

*   *聚合*。此类代表系统中非常常见的对象。它的历史可以追溯到早期的 32 位工作站时代，它被“优化”（在同一个 32 位时代）以使用尽可能少的空间。*Aggregate*可以为空，也可以管理任意数量的对象。

在此示例中，*聚合*项始终从*Pool*分配，因此它们始终对齐。*此示例中Obj_list*的唯一出现是*Aggregate*对象中的“隐藏”成员，因此它们总是使用Placement *new*分配。以下是支持类：

```
class Pool
{
public:
   Pool();
   virtual ~Pool();
   void *allocate(size_t size);
   static Pool *default_pool();   // returns a global pool
};

class Obj_list
{
public:
   inline void *operator new(size_t s, void * p) { return p; }

   Obj_list(const Args *args);
   // when constructed, Obj_list will allocate representation_p, which
   // can take up much more space.

   ~Obj_list();

private:
   Obj_list_store *representation_p;
}; 
```

这里是聚合。请注意成员声明*member_list_store_d*：

```
// Aggregate is derived from Lesser, which is twelve bytes in size
class Aggregate : public Lesser
{
public:
   inline void *operator new(size_t s) {
      return Pool::default_pool->allocate(s);
   }

   inline void *operator new(size_t s, Pool *h) {
      return h->allocate(s);
   }

public:

   Aggregate(const Args *args = NULL);
   virtual ~Aggregate() {};

   inline const Obj_list *member_list_store_p() const;

protected:
   char member_list_store_d[sizeof(Obj_list)];
}; 
```

我最关心的是那个数据成员。这是初始化和访问的伪代码：

```
Aggregate::Aggregate(const Args *args)
{
   if (args) {
      new (static_cast<void *>(member_list_store_d)) Obj_list(args);
   }
   else {
      zero_out(member_list_store_d);
   }
}

inline const Obj_list *Aggregate::member_list_store_p() const
{
   return initialized(member_list_store_d) ? (Obj_list *) &member_list_store_d : 0;
} 
```

您可能会建议我们将 char 数组替换为指向*Obj_list*类型的指针，初始化为 NULL 或类的实例。这给出了正确的语义，但只是改变了内存成本。如果内存仍然很宝贵（它可能是，这是一种 EDA 数据库表示），在*Aggregate*对象*确实*有成员的情况下，用指向*Obj_list*的指针替换 char 数组将花费更多的指针。

 **除此之外，我真的不想分心这里的主要问题，即对齐。我*认为*上述构造是有问题的，但在标准中找不到比对 'system/library' *new*的对齐行为的一些模糊讨论更多的内容。

那么，上述构造除了导致偶尔的管道停顿之外还有什么作用吗？

**编辑**：我意识到有一些方法可以使用嵌入式 char 数组*替换该方法。*最初的建筑师也是如此。他们丢弃了它们，因为内存非常宝贵。现在，如果我有理由接触该代码，我可能会更改它。

然而，我的问题是，关于这种方法固有的对齐问题，我希望人们能解决这个问题。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T13:24:56.687

好的 - 有机会正确阅读它。当您将 char 数组作为 Obj_list 访问时，您遇到了对齐问题，并调用了未定义的行为。您的平台很可能会做以下三件事之一：让您侥幸逃脱，让您在运行时受到惩罚或偶尔因总线错误而崩溃。

解决此问题的便携式选项是：

*   使用 malloc 或全局分配函数分配存储，但您认为这太昂贵了。
*   正如 Arkadiy 所说，让你的缓冲区成为 Obj_list 成员：

    ```
    Obj_list list; 
    ```

但你现在不想支付建设成本。您可以通过提供仅用于创建此实例的内联无操作构造函数来缓解这种情况 - 正如发布的默认构造函数所做的那样。如果你遵循这条路线，强烈考虑调用 dtor

```
list.~Obj_list(); 
```

在对这个存储进行新的放置之前。

否则，我认为您将留下不可移植的选项：要么依赖您的平台对未对齐访问的容忍度，要么使用您的编译器为您提供的任何不可移植的选项。

免责声明：我完全有可能错过了工会或类似的把戏。这是一个不寻常的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T17:29:48.490

编译器将根据其默认值选择对齐方式，这可能会在 GCC / MSVC 下以四字节结束。

如果存在需要特定对齐的代码（SIMD/DMA），这应该是一个问题。在这种情况下，您应该能够使用编译器指令来确保 member_list_store_d 对齐，或者将大小增加 (alignment-1) 并使用适当的偏移量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T23:55:29.660

如果要确保结构对齐，只需执行

```
// MSVC
#pragma pack(push,1)

// structure definitions

#pragma pack(pop)

// *nix
struct YourStruct
{
    ....
} __attribute__((packed)); 
```

确保聚合中 char 数组的 1 字节对齐

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T00:07:05.317

你能简单地在 Aggregate 中有一个 Obj_list 的实例吗？IOW，类似于

类聚合：公共小{...保护：Obj_list列表；};

我一定遗漏了一些东西，但我不知道为什么这很糟糕。

至于你的问题 - 它完全依赖于编译器。但是，大多数编译器默认情况下会在字边界对齐每个成员，即使成员的类型不需要以这种方式对齐以进行正确访问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T23:44:10.557

使用 malloc 或全局运算符 new[]分配 char 数组`member_list_store_d`，其中任何一个都将为任何类型提供对齐的存储。

编辑：只需再次阅读 OP - 您不想为另一个指针付费。早上再读一遍。

# firefox - 如何编译 Firefox 并包含一些扩展？

> ID：247646
> 
> 赞同：3
> 
> 时间：2008-10-29T17:17:23.803
> 
> 标签：firefox

我需要能够编译 firefox 并将它与一些扩展捆绑在一起，这样当人们下载它时，扩展就已经存在了。

我想知道是否有人可以向我指出一些文档。我一直在寻找几个小时，似乎无法找到类似的东西。

谢谢，

塞巴斯蒂安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T18:05:53.720

如果您不需要专门“编译”Firefox 并且使用的是 Windows，则可以创建一个简单的批处理 (.bat) 文件来执行 Firefox 安装程序，然后按顺序执行扩展安装程序。或者，您也可以使用 Powershell (.ps1) 脚本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T01:32:38.320

你可能想看看 CCK 或类似的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-25T01:56:37.980

只需将扩展内容复制到 FireFox 的扩展 guid 目录即可。首先解压缩扩展文件（xpi 文件只是一个普通的 zip 文件）然后复制它们。

您可以通过为 Linux/Unix/Mac 编写简单的 shell 脚本，或者为 Windows XP 和 PowerShell 为 Vista 编写批处理文件（正如 John Dunagan 所提到的）来自动执行此操作。

检查以下线程中的第四个帖子
[http://forums.mozillazine.org/viewtopic.php?f=7&t=586672&start=0&st=0&sk=t&sd=a](http://forums.mozillazine.org/viewtopic.php?f=7&t=586672&start=0&st=0&sk=t&sd=a)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-25T02:03:41.397

我认为不需要重新编译它。只需创建一个安装过程（实际上是一个脚本），它会先安装 firefox，然后再安装扩展。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-25T02:11:34.230

重新编译根本没有帮助。扩展不会编译到 Firefox 中，因为这样做会使 Firefox 在每次安装扩展时都必须重新编译。只需按照上述答案自动安装扩展。

# java - 用户离线时的消息传递

> ID：247647
> 
> 赞同：0
> 
> 时间：2008-10-29T17:17:25.050
> 
> 标签：java, xmpp, openfire

我有一个 OpenFire 插件，它使用

```
XMPPServer.getInstance().getMessageRouter().route(message) 
```

我想知道的是，如果用户不在线，该消息会发生什么。

我的目标是仅在用户在线时传递消息，否则失败或被路由到位桶。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T19:00:43.390

这完全取决于 Openfire 配置。在 Openfire 管理控制台中，转到服务器 -> 服务器设置 -> 离线消息。有存储、反弹和丢弃的选项。

*   存储：当用户重新上线时传递消息。
*   丢弃：丢弃消息。
*   Bounce：丢弃并用返回消息通知发件人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T08:32:34.293

另一种方法，如果您只是希望这些消息不脱机而不影响其他消息的传递，则使用 type='headline'。标题不是很明确，但[RFC 3921bis 第 5.2.2 节](http://xmpp.org/internet-drafts/draft-saintandre-rfc3921bis-07.html#message-syntax-type)说：

> 标题——消息提供警报、通知或其他不需要回复的信息（例如，新闻标题、体育更新、近乎实时的市场数据和联合内容）。由于不希望回复消息，因此接收客户端通常会在界面中显示类型为“标题”的消息，以适当地区分该消息与独立消息、聊天消息或群聊消息（例如，通过不向接收者提供回复能力）。**接收服务器应该将消息传递给接收者的所有可用资源。**

今天的大多数服务器只会默默地将头条新闻投放给离线用户，并在用户在线时将其传递给最高优先级的资源。

# delphi - 如何使用 JEDI TJCLHashMap 类？

> ID：247654
> 
> 赞同：3
> 
> 时间：2008-10-29T17:19:25.373
> 
> 标签：delphi, hashmap, jedi, jedi-code-library

我正在尝试使用 TJCLHashMap 系列类，但显然这个类没有有用的公共方法。所有方法都受到“保护”。如何使用这个类？尽管 JCL 附带了一些示例，但我似乎错过了一些东西。一个基本的例子会很棒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-03T14:10:48.417

您应该使用在 JclContainerIntf.pas 中声明的接口。JclHashMaps 中的类实现了这些接口。
查看 jcl\examples\common\containers\hashing\HashingExample.dpr 中的一些示例（整数、字符串、对象等）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T17:26:12.100

扩展它并添加在内部调用受保护方法的公共方法？

# html - 在 Rails 中创建类似背包的日历

> ID：247656
> 
> 赞同：18
> 
> 时间：2008-10-29T17:19:46.387
> 
> 标签：html, ruby-on-rails, plugins, calendar

Rails 世界中当前的最佳实践是显示日历月视图，其中事件项绑定到当月的日期（例如在 Backpack 或 Google Calendar 中）？

我不需要像拖放支持这样的花哨的东西。我只是在寻找代码，让我在控制器中获取事件列表，并以某种方式将它们公开为月历显示视图中的条目（可能在 HTML 元素上带有类名，以允许我以不同方式显示不同类型的事件，或者可能显示来自多个日历的事件）。

有几年前创建的[动态日历助手](http://oldwiki.rubyonrails.org/rails/pages/DynamicCalendarHelper)，它很可能对我来说仍然可以正常工作，但我只是想知道我是否也应该看看其他插件。

到目前为止我发现的其他可能性：

*   GitHub 上[的一些可能的竞争者（从他们的描述来看）](http://github.com/search?q=rails+calendar)
*   [Joyent Connector](http://joyent.com/connector/)现已开源，具有日历功能

那么，你能指出我现在使用什么来输出带有数据的月历的正确方向吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-07-23T22:22:04.300

这是一个 Rails 插件，可以跨日历日显示多个重叠的事件。

[http://github.com/elevation/event_calendar](http://github.com/elevation/event_calendar)

屏幕截图：http: [//dev.elevationblog.com/2009/7/23/event-calendar-rails-plugin](http://dev.elevationblog.com/2009/7/23/event-calendar-rails-plugin)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-30T16:22:02.237

查看[http://github.com/p8/table_builder/tree/master](http://github.com/p8/table_builder/tree/master)。它更像是 form_for。它也不需要 Event 对象，只需要具有返回日期的方法的对象。

```
 <% calendar_for(@tasks, :year => @year, :month => @month) do |t| %>
    <%= t.head('mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun') %>
    <% t.day(:day_method => YOUR_DATE_METHOD) do |day, tasks| %>
      <%= day.day %><br />
      <% tasks.each do |task| %>
          <%= h(task.name) %><br />
        <% end %>
      <% end %>
    <% end %>
  <% end %> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T19:27:31.693

我不知道这是否适合您的问题的限制，但是您看过[Google Calendar API](http://code.google.com/apis/calendar/)吗？我不知道您是否可以指望您的用户拥有自己的帐户，或者您是否可以通过编程方式在一个帐户上创建您需要的所有日历并通过 API 提取每个日历的数据，但这可能值得一看.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T04:21:08.673

我现在最终选择了动态日历助手。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-11-18T22:49:46.277

如果有人还在寻找 Rails 日历插件，Topfunky 的 calendar_helper 现在可以正常工作：

[http://github.com/topfunky/calendar_helper](http://github.com/topfunky/calendar_helper)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T09:07:47.813

查看 Redmine 中的日历视图。

# c# - 将多个 DOCX 文件附加在一起

> ID：247666
> 
> 赞同：28
> 
> 时间：2008-10-29T17:22:25.680
> 
> 标签：c#, openxml, docx

我需要以编程方式使用 C# 将几个预先存在`docx`的文件附加到一个长`docx`文件中 - 包括特殊标记，如项目符号和图像。页眉和页脚信息将被删除，因此不会引起任何问题。

我可以找到大量有关`docx`使用 .NET Framework 3 操作单个文件的信息，但对于如何合并文件却没有任何简单或明显的信息。还有一个第三方程序（Acronis.Words）可以做到这一点，但它非常昂贵。

## 更新：

有人建议通过 Word 实现自动化，但我的代码将在 IIS Web 服务器上的 ASP.NET 上运行，因此我不适合使用 Word。很抱歉一开始没有提到这一点。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-03-17T15:51:38.917

尽管提交了所有好的建议和解决方案，我还是开发了一个替代方案。在我看来，您应该完全避免在服务器应用程序中使用 Word。所以我使用 OpenXML，但它不适用于 AltChunk。我在原始正文中添加了文本，我收到了 byte[] 列表而不是文件名列表，但您可以轻松地根据需要更改代码。

```
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Xml.Linq;
using DocumentFormat.OpenXml.Packaging;
using DocumentFormat.OpenXml.Wordprocessing;

namespace OfficeMergeControl
{
    public class CombineDocs
    {
        public byte[] OpenAndCombine( IList<byte[]> documents )
        {
            MemoryStream mainStream = new MemoryStream();

            mainStream.Write(documents[0], 0, documents[0].Length);
            mainStream.Position = 0;

            int pointer = 1;
            byte[] ret;
            try
            {
                using (WordprocessingDocument mainDocument = WordprocessingDocument.Open(mainStream, true))
                {

                    XElement newBody = XElement.Parse(mainDocument.MainDocumentPart.Document.Body.OuterXml);

                    for (pointer = 1; pointer < documents.Count; pointer++)
                    {
                        WordprocessingDocument tempDocument = WordprocessingDocument.Open(new MemoryStream(documents[pointer]), true);
                        XElement tempBody = XElement.Parse(tempDocument.MainDocumentPart.Document.Body.OuterXml);

                        newBody.Add(tempBody);
                        mainDocument.MainDocumentPart.Document.Body = new Body(newBody.ToString());
                        mainDocument.MainDocumentPart.Document.Save();
                        mainDocument.Package.Flush();
                    }
                }
            }
            catch (OpenXmlPackageException oxmle)
            {
                throw new OfficeMergeControlException(string.Format(CultureInfo.CurrentCulture, "Error while merging files. Document index {0}", pointer), oxmle);
            }
            catch (Exception e)
            {
                throw new OfficeMergeControlException(string.Format(CultureInfo.CurrentCulture, "Error while merging files. Document index {0}", pointer), e);
            }
            finally
            {
                ret = mainStream.ToArray();
                mainStream.Close();
                mainStream.Dispose();
            }
            return (ret);
        }
    }
} 
```

我希望这可以帮助你。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T02:23:50.640

您不需要使用自动化。DOCX 文件基于 OpenXML 格式。它们只是包含一堆 XML 和二进制部分（想想文件）的 zip 文件。您可以使用 Packaging API（WindowsBase.dll 中的 System.IO.Packaging）打开它们，并使用框架中的任何 XML 类来操作它们。

查看[OpenXMLDeveloper.org](http://openxmldeveloper.org)了解详细信息。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-08-23T10:29:40.000

这是原始问题的一个非常晚的问题，并且有很多变化，但我想我会分享我编写合并逻辑的方式。这利用了[Open XML Power Tools](http://powertools.codeplex.com/)

```
public byte[] CreateDocument(IList<byte[]> documentsToMerge)
{
    List<Source> documentBuilderSources = new List<Source>();
    foreach (byte[] documentByteArray in documentsToMerge)
    {
        documentBuilderSources.Add(new Source(new WmlDocument(string.Empty, documentByteArray), false));
    }

    WmlDocument mergedDocument = DocumentBuilder.BuildDocument(documentBuilderSources);
    return mergedDocument.DocumentByteArray;
} 
```

目前，这在我们的应用程序中运行良好。我对代码做了一点改动，因为我的要求是每个需要先处理的文档。所以传入的是一个带有模板字节数组和需要替换的各种值的 DTO 对象。这是我的代码当前的样子。这使代码更进一步。

```
public byte[] CreateDocument(IList<DocumentSection> documentTemplates)
{
    List<Source> documentBuilderSources = new List<Source>();
    foreach (DocumentSection documentTemplate in documentTemplates.OrderBy(dt => dt.Rank))
    {
        // Take the template replace the items and then push it into the chunk
        using (MemoryStream templateStream = new MemoryStream())
        {
            templateStream.Write(documentTemplate.Template, 0, documentTemplate.Template.Length);

            this.ProcessOpenXMLDocument(templateStream, documentTemplate.Fields);

            documentBuilderSources.Add(new Source(new WmlDocument(string.Empty, templateStream.ToArray()), false));
        }
    }

    WmlDocument mergedDocument = DocumentBuilder.BuildDocument(documentBuilderSources);
    return mergedDocument.DocumentByteArray;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T20:13:47.457

不久前我写了一个小测试应用程序来做到这一点。我的测试应用程序使用 Word 2003 文档 (.doc) 而不是 .docx，但我想这个过程是相同的 - 我应该认为您需要更改的只是使用更新版本的 Primary Interop Assembly。有了新的 C# 4.0 功能，这段代码看起来会更整洁......

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

using Microsoft.Office.Interop.Word;
using Microsoft.Office.Core;
using System.Runtime.InteropServices;
using System.IO;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            new Program().Start();
        }

        private void Start()
        {
            object fileName = Path.Combine(Environment.CurrentDirectory, @"NewDocument.doc");
            File.Delete(fileName.ToString());

            try
            {
                WordApplication = new ApplicationClass();
                var doc = WordApplication.Documents.Add(ref missing, ref missing, ref missing, ref missing);
                try
                {
                    doc.Activate();

                    AddDocument(@"D:\Projects\WordTests\ConsoleApplication1\Documents\Doc1.doc", doc, false);
                    AddDocument(@"D:\Projects\WordTests\ConsoleApplication1\Documents\Doc2.doc", doc, true);

                    doc.SaveAs(ref fileName,
                        ref missing, ref missing, ref missing, ref missing,     ref missing,
                        ref missing, ref missing, ref missing, ref missing, ref missing,
                        ref missing, ref missing, ref missing, ref missing, ref missing);
                }
                finally
                {
                    doc.Close(ref missing, ref missing, ref missing);
                }
            }
            finally
            {
                WordApplication.Quit(ref missing, ref missing, ref missing);
            }
        }

        private void AddDocument(string path, Document doc, bool lastDocument)
        {
            object subDocPath = path;
            var subDoc = WordApplication.Documents.Open(ref subDocPath, ref missing, ref missing, ref missing,
                ref missing, ref missing, ref missing, ref missing, ref missing,
                ref missing, ref missing, ref missing, ref missing, ref missing,
                ref missing, ref missing);
            try
            {

                object docStart = doc.Content.End - 1;
                object docEnd = doc.Content.End;

                object start = subDoc.Content.Start;
                object end = subDoc.Content.End;

                Range rng = doc.Range(ref docStart, ref docEnd);
                rng.FormattedText = subDoc.Range(ref start, ref end);

                if (!lastDocument)
                {
                    InsertPageBreak(doc);
                }
            }
            finally
            {
                subDoc.Close(ref missing, ref missing, ref missing);
            }
        }

        private static void InsertPageBreak(Document doc)
        {
            object docStart = doc.Content.End - 1;
            object docEnd = doc.Content.End;
            Range rng = doc.Range(ref docStart, ref docEnd);

            object pageBreak = WdBreakType.wdPageBreak;
            rng.InsertBreak(ref pageBreak);
        }

        private ApplicationClass WordApplication { get; set; }

        private object missing = Type.Missing;
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T13:22:13.447

您想使用 AltChunks 和 OpenXml SDK 1.0（如果可以的话，至少是 2.0）。查看 Eric White 的博客了解更多详细信息，这也是一个很好的资源！。这是一个代码示例，如果不能立即工作，应该可以帮助您入门。

```
public void AddAltChunkPart(Stream parentStream, Stream altStream, string altChunkId)
{
    //make sure we are at the start of the stream    
    parentStream.Position = 0;
    altStream.Position = 0;
    //push the parentStream into a WordProcessing Document
    using (WordprocessingDocument wordDoc = WordprocessingDocument.Open(parentStream, true))
    {
        //get the main document part
        MainDocumentPart mainPart = wordDoc.MainDocumentPart;
        //create an altChunk part by adding a part to the main document part
        AlternativeFormatImportPart chunk = mainPart.AddAlternativeFormatImportPart(altChunkPartType, altChunkId);
        //feed the altChunk stream into the chunk part
        chunk.FeedData(altStream);
        //create and XElement to represent the new chunk in the document
        XElement newChunk = new XElement(altChunk, new XAttribute(relId, altChunkId));
        //Add the chunk to the end of the document (search to last paragraph in body and add at the end)
        wordDoc.MainDocumentPart.GetXDocument().Root.Element(body).Elements(paragraph).Last().AddAfterSelf(newChunk);
        //Finally, save the document
        wordDoc.MainDocumentPart.PutXDocument();
    }
    //reset position of parent stream
    parentStream.Position = 0;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T21:48:26.870

它退出复杂，因此代码超出了论坛帖子的范围，我会为您编写您的应用程序，但总结一下。

*   将两个文档都作为包打开
*   遍历第二个文档的部分以查找图像和嵌入内容
*   将这些部分添加到第一个包中，记住新的关系 ID（这涉及大量流工作）
*   打开第二个文档中的 document.xml 部分，并用新的关系 ID 替换所有旧的关系 ID - 将第二个 document.xml 的所有子节点（但不包括根节点）附加到第一个 document.xml
*   保存所有 XmlDocuments 并刷新包

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T20:13:31.773

我在 C# 中创建了一个应用程序，将 RTF 文件合并到一个文档中，我希望它也适用于 DOC 和 DOCX 文件。

```
 Word._Application wordApp;
    Word._Document wordDoc;
    object outputFile = outputFileName;
    object missing = System.Type.Missing;
    object vk_false = false;
    object defaultTemplate = defaultWordDocumentTemplate;
    object pageBreak = Word.WdBreakType.wdPageBreak;
    string[] filesToMerge = new string[pageCounter];
    filestoDelete = new string[pageCounter];

    for (int i = 0; i < pageCounter; i++)
    {
        filesToMerge[i] = @"C:\temp\temp" + i.ToString() + ".rtf";
        filestoDelete[i] = @"C:\temp\temp" + i.ToString() + ".rtf";                
    }
    try
    {
        wordDoc = wordApp.Documents.Add(ref missing, ref missing, ref missing, ref missing);
    }
    catch(Exception ex)
    {
        Console.WriteLine(ex.Message);
    }
    Word.Selection selection= wordApp.Selection;

    foreach (string file in filesToMerge)
    {
        selection.InsertFile(file,
            ref missing,
            ref missing,
            ref missing,
            ref missing);

        selection.InsertBreak(ref pageBreak);                                     
    }
    wordDoc.SaveAs(ref outputFile, ref missing, ref missing, ref missing, ref missing, ref missing,
           ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing, ref missing,
           ref missing, ref missing); 
```

希望这可以帮助！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-05T07:31:12.550

对于任何想要使用文件名列表的人：

```
void AppendToExistingFile(string existingFile, IList<string> filenames)
{
    using (WordprocessingDocument document = WordprocessingDocument.Open(existingFile, true))
    {
        MainDocumentPart mainPart = document.MainDocumentPart;

        for (int i = filenames.Count - 1; i >= 0; --i)
        {
            string altChunkId = "AltChunkId" + i;
            AlternativeFormatImportPart chunk = mainPart.AddAlternativeFormatImportPart(AlternativeFormatImportPartType.WordprocessingML, altChunkId);

            using (FileStream fileStream = File.Open(filenames[i], FileMode.Open))
            {
                chunk.FeedData(fileStream);
            }

            AltChunk altChunk = new AltChunk { Id = altChunkId };
            mainPart.Document.Body.InsertAfter(altChunk, mainPart.Document.Body.Elements<Paragraph>().Last());
        }

        mainPart.Document.Save();
    }
} 
```

# c# - 从 ASPX 页面运行命令行，并将输出返回到页面

> ID：247668
> 
> 赞同：10
> 
> 时间：2008-10-29T17:22:40.547
> 
> 标签：c#, asp.net

我正在尝试访问命令行并执行命令，然后将输出返回到我的 aspx 页面。一个很好的例子是在 aspx 页面的页面加载上运行 dir 并通过 Response.Write() 返回输出。我试过使用下面的代码。当我尝试调试它时，它会运行但永远不会完成加载并且不会呈现任何输出。我正在使用 C# 和 .NET Framework 3.5sp1。非常感谢任何帮助。

谢谢，布莱恩

```
public partial class CommandLine : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        System.Diagnostics.Process si = new System.Diagnostics.Process();
        si.StartInfo.WorkingDirectory = @"c:\";
        si.StartInfo.UseShellExecute = false;
        si.StartInfo.FileName = "cmd.exe";
        si.StartInfo.Arguments = "dir";
        si.StartInfo.CreateNoWindow = true;
        si.StartInfo.RedirectStandardInput = true;
        si.StartInfo.RedirectStandardOutput = true;
        si.StartInfo.RedirectStandardError = true;
        si.Start();
        string output = si.StandardOutput.ReadToEnd();
        si.Close();
        Response.Write(output);
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T17:32:43.943

您对 cmd.exe 的命令行参数的语法有疑问。这就是 cmd 永远不会退出的原因。
为了让 cmd.exe 运行程序然后退出，您需要向它发送语法“/c [command]”。尝试使用该行运行相同的代码

```
 si.StartInfo.Arguments = "dir"; 
```

替换为

```
 si.StartInfo.Arguments = "/c dir"; 
```

看看它是否有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T17:26:31.367

您的问题很可能与权限有关。运行 ASP.NET 进程的用户权限非常有限。

因此，要么您必须为该用户设置适当的权限，要么在其他用户下运行 ASP.NET。

但是，这隐藏了安全风险，因此您必须非常小心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T17:37:35.213

这太疯狂了！使用 System.IO 命名空间从 C# 程序内部创建文件列表！这很容易做到；尽管这种技术也存在授权问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T17:43:15.170

使用 System.Diagnostics.Process。

这是一些 ASP.NET 代码，用于在命令行上运行颠覆命令。

```
 ///////////////////////////////////////////////////////////////////////
    public static string run_svn(string args_without_password, string svn_username, string svn_password)
    {
        // run "svn.exe" and capture its output

        System.Diagnostics.Process p = new System.Diagnostics.Process();
        string svn_path = Util.get_setting("SubversionPathToSvn", "svn");
        p.StartInfo.FileName = svn_path;
        p.StartInfo.UseShellExecute = false;
        p.StartInfo.RedirectStandardOutput = true;
        p.StartInfo.RedirectStandardError = true;

        args_without_password += " --non-interactive";
        Util.write_to_log ("Subversion command:" + svn_path + " " + args_without_password);

        string args_with_password = args_without_password;

        if (svn_username != "")
        {
            args_with_password += " --username ";
            args_with_password += svn_username;
            args_with_password += " --password ";
            args_with_password += svn_password;
        }

        p.StartInfo.Arguments = args_with_password;
        p.Start();
        string stdout = p.StandardOutput.ReadToEnd();
        p.WaitForExit();
        stdout += p.StandardOutput.ReadToEnd();

        string error = p.StandardError.ReadToEnd();

        if (error != "")
        {
            Util.write_to_log(error);
            Util.write_to_log(stdout);
        }

        if (error != "")
        {
            string msg = "ERROR:";
            msg += "<div style='color:red; font-weight: bold; font-size: 10pt;'>";
            msg += "<br>Error executing svn.exe command from web server.";
            msg += "<br>" + error;
            msg += "<br>Arguments passed to svn.exe (except user/password):" + args_without_password;
            if (error.Contains("File not found"))
            {
                msg += "<br><br>***** Has this file been deleted or renamed? See the following links:";
                msg += "<br><a href=http://svn.collab.net/repos/svn/trunk/doc/user/svn-best-practices.html>http://svn.collab.net/repos/svn/trunk/doc/user/svn-best-practices.html</a>";
                msg += "<br><a href=http://subversion.open.collab.net/articles/best-practices.html>http://subversion.open.collab.net/articles/best-practices.html</a>";
                msg += "</div>";
            }
            return msg;
        }
        else
        {
            return stdout;
        }
    } 
```

# php - MediaWiki 如何构成图像路径？

> ID：247678
> 
> 赞同：8
> 
> 时间：2008-10-29T17:26:23.300
> 
> 标签：php, perl, mediawiki

我有一个 Perl 应用程序，它解析 MediaWiki SQL 表并显示来自多个 wiki 页面的数据。我需要能够重新创建绝对图像路径来显示图像，例如：`.../f/fc/Herbs.jpg/300px-Herbs.jpg`

来自 MediaWiki 手册：

> Image_Authorisation：“[图像] 路径可以很容易地从文件名中计算出来，并且......”

路径是如何计算的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-31T21:11:02.563

接受的答案不正确：

*   字符串的 MD5 和是 32 个十六进制字符（128 位），而不是 16
*   文件路径是根据文件名的 MD5 和计算的，而不是文件本身的内容
*   路径中的第一个目录是第一个字符，第二个目录是第一个和第二个字符。目录路径不是前 3 或 6 个字符的组合。

“Herbs.jpg”的 MD5 和为 fceaa5e7250d5036ad8cede5ce7d32d6。前 2 个字符是“fc”，给出了文件路径 f/fc/，这就是示例中给出的内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-31T21:28:50.420

在 PHP 中，您可以调用以下函数来获取 URL。您可能想查看 php 代码以了解它们如何计算路径。

```
$url = wfFindFile(Title::makeTitle(NS_IMAGE, $fileName))->getURL(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T19:23:52.517

一种可能的方法是计算文件的 MD5 签名（或数据库中的文件 ID），然后基于此构建/查找路径。

例如，假设我们得到一个像“1ff8a7b5dc7a7d1f0ed65aaa29c04b1e”这样的 MD5 签名

路径可能看起来像“/1f/f”或“/1f/ff/8a”

原因是您不想将所有文件都放在 1 个文件夹中，并且您希望能够将它们“分区”到不同的服务器、SAN 或其他任何地方，以同样分布的方式。

MD5 签名是 16 个“十六进制”字符的字符串。所以我们的“/1f/ff/8a”示例为我们提供了 256*256*256 个文件夹来存储文件。这对任何人来说都应该足够了 :)

* * *

更新，由于大众需求：

**注意**- 我刚刚意识到我们正在专门讨论 MediaWiki 是如何做到的。这**不是**现在 MediaWiki 做的，而是另一种**可以做到**的方式。

“MD5 签名”是指做这样的事情（Perl 中的代码示例）：

```
use Digest::MD5 'md5_hex';
my $sig = md5_hex( $file->id ); 
```

$sig 现在是 32 个字母数字字符长：“1ff8a7b5dc7a7d1f0ed65aaa29c04b1e”

然后建立一个这样的文件夹结构：

```
my $path = '/usr/local/media';
map { mkdir($path, 0666); $path .= "/$_" } $sig =~ m/^(..)(..)(..)/;
open my $ofh, '>', "$path/$sig"
  or die "Cannot open '$path/$sig' for writing: $!";
print $ofh "File contents";
close($ofh); 
```

文件夹结构看起来像

```
/
  usr/
    local/
      media/
        1f/
          f8/
            a7/
              1ff8a7b5dc7a7d1f0ed65aaa29c04b1e 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-07T20:09:21.900

我创建了一个名为*reorder.sh*的小型 Bash 脚本，它将文件从“图像”内部移动到特定的子文件夹：

```
#!/bin/bash

cd /opt/mediawiki/mediawiki-cur/images

for i in `find -maxdepth 1 -type f ! -name .htaccess ! -name README ! -name reorder.sh -printf '%f\n'`; do
    path1=$(echo -n $i | md5sum | head -c1)    &&
    path2=$(echo -n $i | md5sum | head -c2)    &&
    mkdir -p $path1/$path2/                    &&
    mv $i $path1/$path2/;
done 
```

# xhtml - 将许可证信息包含在 xhtml 的微格式块中的元素的正确方法是什么？

> ID：247691
> 
> 赞同：2
> 
> 时间：2008-10-29T17:29:50.063
> 
> 标签：xhtml, licensing, microformats

似乎 rel-license 仅适用于页面而不适用于特定元素......有人发现野外页面元素的用法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T23:00:39.340

`rel-license`不涵盖特定元素的事实是一个已知错误。

以下在问题[主列表中被特别标记为未解决`rel-license`问题](http://microformats.org/wiki/rel-license-issues#Issues)：

> 2006-04-07 由 Evan 提出：
> 目前尚不清楚如何将许可证与页面的一部分相关联，例如页面中的图像或嵌入对象，或者新闻页面上的单个新闻条目。一个典型的用例是一个 Flickr 页面，该页面的图像是在 CC 许可下获得许可的，但页面本身不是。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T20:28:53.557

Have a look here and see if this is along the lines of what you're needing...

[Microsoftmats rel-license information](http://microformats.org/wiki/rel-license)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T18:20:02.657

我个人从未遇到过需要这样做的情况，但倾向于做这样的事情：

```
<p id="someparagraph">Lorum ipsum dolor sit amet.</p>
<div about="#someparagraph">
<a href="http://creativecommons.org/licenses/by/2.0/" rel="license">cc by 2.0</a>
</div> 
```

# c++ - 在 C++ 中获取当前方法的名称

> ID：247703
> 
> 赞同：14
> 
> 时间：2008-10-29T17:35:15.717
> 
> 标签：c++, introspection

是否有一种（标准化）方法可以使用 c++ 获取当前方法的名称？

使用 GNU GCC，您可以使用宏`__FUNCTION__`和`__PRETTY_FUNCTION__`（由 2 个下划线包围）来做到这一点，但是，这当然是不可移植的。有没有办法在标准 C++ 中做到这一点或让它可移植？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-29T17:39:51.963

该`__func__`标识符是 C99 标准的一部分，在 C++0x 草案中。

该标识符`__func__`由编译器隐式声明，就好像以下内容位于每个函数体的开头一样：

```
static const char __func__[] = "function-name"; 
```

where`function-name`是编译器自动提供的实现定义的字符串。

在对这些标准的支持可用（或更广泛可用）之前，您会被编译器特定的垃圾所困扰。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T17:40:40.260

不……但有些东西最终会成为非标准的标准！

请参阅[http://msdn.microsoft.com/en-us/library/b0084kay(VS.80).aspx](http://msdn.microsoft.com/en-us/library/b0084kay(VS.80).aspx) ，其中概述了 ANSI 标准内容，然后是包含*FUNCTION的 microsofs*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T17:36:49.193

不，c++ 标准不支持它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T17:40:37.703

它被称为“内省”，在 c++ 标准中没有这样的东西。您应该使用外部库（我认为提升以某种方式支持它）。但是尝试弄清楚使用它的原因是否真的是一个好的原因。

# bash - 检测 Bash“导出”值的失败

> ID：247706
> 
> 赞同：4
> 
> 时间：2008-10-29T17:36:36.057
> 
> 标签：bash, scripting

在 Bash 中，我正在执行一个命令并将结果放入如下变量中：

```
导出 var=`svn ls`
```

但是如果 SVN 由于某种原因失败——比如它返回一个非零错误代码——export 仍然返回状态代码 0。我如何检测执行的命令是否失败？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T17:48:12.663

```
var=`svn ls`
if [[ $? == 0 ]]
then
        export var
else
        unset var
fi 
```

`$?`是最后执行的命令的退出码，在`svn ls`这里。

jmohr 的解决方案简短而甜蜜。适度适应，

```
var=`svn ls` && export var || unset var 
```

将大致相当于上面的（`export`一个有效的标识符永远不会失败，除非你做了一些可怕的事情并且用完了环境空间）。随心所欲——我使用`unset`它只是为了避免`$var`即使它没有被导出也可能有一个值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T17:53:57.973

```
var=`svn ls` && export var 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T17:39:52.540

我有类似的问题，可以这样做：

```
rm -f 错误标记文件
导出 var=`svn ls || 触摸错误标记文件`

[ -f error_marker_file ] && echo "执行 svn ls 时出错"

```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-29T20:06:40.497

```
export FOO=$(your-command) || echo "your-command failed" 
```

# sharepoint - SharePoint 2007 分析包

> ID：247708
> 
> 赞同：0
> 
> 时间：2008-10-29T17:37:22.780
> 
> 标签：sharepoint, analytics

虽然 MOSS2007 的内置分析很不错，但同时它们也不够用。有什么想法可以让我找到更全面的软件包吗？我错过了什么吗？

谢谢，卡尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-29T20:24:29.230

看看[Nintex 报告](http://www.nintex.com/en-US/Products/Pages/NintexReporting2008.aspx)。我们刚买了它，它似乎是对开箱即用使用报告的一个很好的增强。从可支持性的角度来看，他们似乎也做了所有“正确”的事情，因此您没有工具可以直接与您的内容数据库进行交互。

我还听到我们的 Webtrends 代表声称他们有一些特定于 SharePoint 的功能，如果这是您已经碰巧使用的产品套件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T12:03:38.670

如果您正在寻找使用情况报告，您可以浏览[http://www.intlock.com/](http://www.intlock.com/)并查看 CardioLog。

# c# - 未从存储过程返回的输出参数

> ID：247718
> 
> 赞同：3
> 
> 时间：2008-10-29T17:39:32.260
> 
> 标签：c#, .net, sql-server, stored-procedures, ado.net

我正在调用具有 3 个 OUTPUT 参数的 SQL proc。在调用 proc 之后，其中一个参数不会在其他两个参数返回值时返回值。Profiler 显示所有 3 个值都被返回。

参数在过程中声明如下...

```
@UsrVariableID INT OUTPUT,
@OrganisationName NVARCHAR(256) OUTPUT,
@Visible bit OUTPUT 
```

调用proc的代码是这样的......

```
cm.Parameters.AddWithValue("@OrganisationName", name);
cm.Parameters["@OrganisationName"].Direction = ParameterDirection.Output;
cm.Parameters.AddWithValue("@Visible", visible);
cm.Parameters["@Visible"].Direction = ParameterDirection.Output;

cm.ExecuteNonQuery();

name = cm.Parameters["@OrganisationName"].Value.ToString();
visible = bool.Parse(cm.Parameters["@Visible"].Value.ToString());
id = int.Parse(cm.Parameters["@UsrVariableID"].Value.ToString()); 
```

失败的参数是@OrganisationName。

我想知道是不是因为参数在代码中是字符串类型，但在过程中是 NVARCHAR 类型。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T18:12:44.017

对于具有可变长度数据类型（nvarchar、varchar 等）的输出参数，我发现更明确会带来更好的结果。在您发布的情况下，C# 端未指定类型。我可能会将事情更改为如下所示：

```
SqlParameter theOrganizationNameParam = new SqlParameter( "@OrganisationName", SqlDbType.NVarChar, 256 );
theOrganizationNameParam.Direction = ParameterDirection.Output;
cm.Parameters.Add( theOrganizationNameParam );
cm.ExecuteNonQuery();
name = theOrganizationNameParam.Value; 
```

有了这个，您可以保证输出参数具有正确的数据类型，因此可以访问**Value**属性而不会引发异常。

希望这能有所启发。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T17:48:56.390

您可以尝试先声明参数（然后设置值），看看这是否有所不同。

```
cm.Parameters.Add["@OrganisationName", SqlDbType.NVarChar, 256].Direction = ParameterDirection.Output
cm.Parameters["@OrganisationName"].Value = name 
```

但对我来说，您发布的内容似乎没有任何问题。

顺便说一句，如果你不需要 .Parse(.ToString()) 你应该只需要转换。

```
visible = bool.Parse(cm.Parameters["@Visible"].Value.ToString());
```

变成

```
visible = (bool)cm.Parameters["@Visible"].Value;
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T17:52:58.833

我不是 100% 确定 MS SQL，但在 .NET-->Oracle 中，您需要指定字符串缓冲区大小。

```
cm.Parameters["@OrganisationName"].Size = 256; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T08:50:14.683

谢谢大家，正如 Ady 和 Scott 所建议的那样，在参数声明中明确声明类型解决了它。我选择了 Scotts 的答案，因为它更简洁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T12:46:44.220

改用 ParameterDirection.InputOutput - 这行得通

有关更多信息，请参见此处的最后一条评论 - [http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.adonet/topic28087.aspx](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.adonet/topic28087.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T12:56:34.150

实际上，这与声明类型无关。

对于不同大小的输出参数，需要指定参数大小。

```
cm.Parameters["@OrganisationName"].Size = 50; 
```

我在某处读过，实现中存在一个错误，只要未为某些数据类型指定大小，就会引发异常。

整个事情使它非常适合返回大小未知的参数，例如 nvarchar(max)。我建议通过 SELECT 而不是通过输出参数返回值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-07T16:01:27.260

是的，我在这里尝试了很多东西，唯一有效的是：你需要指定字符串的大小。

我有一个返回字符串 nvarchar(7) 的存储过程，在 C#.NET 端我指定了 size=255，这对我来说可以接收 7 个字符的字符串....

我不喜欢这样，因为代码应该更专业......无论如何......

# python - 如何使用 Python 启动应用程序实例？

> ID：247724
> 
> 赞同：14
> 
> 时间：2008-10-29T17:40:12.010
> 
> 标签：python, scripting, ipc

我正在创建一个 Python 脚本，它在其中执行一系列任务，其中一项任务是启动和打开 Excel 实例。在我的脚本中实现这一目标的理想方式是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-29T19:22:09.823

虽然`Popen`对于一般情况的答案是合理的，但`win32api`如果您想对它做一些有用的事情，我会推荐这种特殊情况：

它是这样的：

```
from win32com.client import Dispatch
xl = Dispatch('Excel.Application')
wb = xl.Workbooks.Open('C:\\Documents and Settings\\GradeBook.xls')
xl.Visible = True    # optional: if you want to see the spreadsheet 
```

取自[邮件列表帖子](https://mail.python.org/pipermail/python-list/2005-June/315330.html)，但周围有很多例子。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-29T17:44:31.767

或者

```
os.system("start excel.exe <path/to/file>") 
```

（假设它在路径中，并且您在 Windows 上）

并且在 Windows 上也可以`start <filename>`正常工作 - 如果它已经是关联的扩展名（就像 xls 一样）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-29T17:50:13.410

我喜欢`popen2`监控过程的能力。

```
excelProcess = popen2.Popen4("start excel %s" % (excelFile))
status = excelProcess.wait() 
```

[https://docs.python.org/2/library/popen2.html](https://docs.python.org/2/library/popen2.html)

**编辑**：请注意，调用`wait()`将阻塞，直到进程返回。根据您的脚本，这可能不是您想要的行为。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-30T08:27:03.530

subprocess模块旨在替换其他几个**较**旧的模块和功能，例如：

*   操作系统
*   os.spawn*
*   os.popen*
*   popen2.*
*   命令。*

.

```
import subprocess

process_one = subprocess.Popen(['gqview', '/home/toto/my_images'])

print process_one.pid 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-14T22:42:54.363

正如其他人所说，我建议使用 os.system。如果有人正在寻找与 Mac 兼容的解决方案，这里有一个示例：

```
import os
os.system("open /Applications/Safari.app") 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T17:41:19.573

os.system("打开文件.xls")

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-01-08T21:34:31.463

我喜欢`os.startfile("path to file")`它打开文件，就好像你已经双击打开一样。

我发现`os.system("start excel filename")`它打开它就像从网络上打开一个文件一样，你必须启用编辑。

# c++ - 假设 STL 向量存储总是连续的是否安全？

> ID：247738
> 
> 赞同：56
> 
> 时间：2008-10-29T17:44:13.063
> 
> 标签：c++, stl, vector

如果您有一个已调整大小的 STL 向量，那么获取元素 0 的地址并假设该向量的其余部分将跟随在内存中是否安全？

例如

```
vector<char> vc(100);
// do some stuff with vc
vc.resize(200);
char* p = &vc[0];
// do stuff with *p 
```

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-10-29T17:50:55.967

**是的，这是一个有效的假设 (*)。**

来自 C++03 标准（23.2.4.1）：

> 向量的元素是连续存储的，这意味着如果 v 是一个向量，其中 T 是除 bool 之外的某种类型，那么对于所有 0 <= n < v，它都遵循恒等式 &v[n] == &v[0] + n 。尺寸（）​​。

(*) ...但要注意在向其添加元素后重新分配的数组（使任何指针和迭代器无效）。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-29T18:34:33.460

C++03 标准增加了措辞，明确向量元素必须是连续的。

C++03 23.2.4 第 1 段包含以下C++98 标准文档中*没有的语言：*

> a 的元素`vector`是连续存储的，这意味着如果`v`a 是 a 以外`vector<T, Allocator>`的`T`某种类型`bool`，则它服从`&v[n] == &v[0] + n`all的标识`0 <= n < v.size()`。

Herb Sutter 在他的一篇博客文章中谈到了这一变化，[不畏惧：向量保证是连续的](http://herbsutter.wordpress.com/2008/04/07/cringe-not-vectors-are-guaranteed-to-be-contiguous/)：

> ...连续性实际上是矢量抽象的一部分。事实上，它是如此重要，以至于当发现 C++98 标准并没有完全保证连续性时，C++03 标准被修改为明确添加了保证。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-29T17:49:44.453

存储始终是连续的，但它可能会随着向量容量的变化而移动。

如果在容量更改操作之前，您在元素零（或任何元素）上有指针、引用或迭代器，则它无效，必须重新分配。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-29T17:47:51.493

[是的，它是连续的](http://www.parashift.com/c++-faq-lite/containers.html#faq-34.3)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-29T17:50:37.620

`std::vector`保证项目存储在连续数组中，因此是数组的首选替代品，也可用于与平台相关的低级代码（如 Win32 API 调用）进行交互。要获取指向数组的指针，请使用：

```
&myVector.front(); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-29T17:46:03.870

是的。

它应该始终是连续的

# html - 仅在 IE<7 中使用条件注释评估 css 表达式？

> ID：247743
> 
> 赞同：2
> 
> 时间：2008-10-29T17:45:43.730
> 
> 标签：html, css, internet-explorer

我已经知道：“不要使用 css 表达式！” 我的问题不在于我是否应该使用表达式或者是否有替代方法；我的问题很简单：**我能否在不使用条件注释的情况下仅在版本 7 之前的 IE 版本中评估 css 表达式？**

我偶尔会使用下划线技巧来隐藏 IE7 的规则，但 IE7 似乎无论如何都会评估表达式。例如，`_width:700px;`被 IE7 忽略但`_width:expression('700px');`仍会被评估。

我知道有人会试图告诉我只使用条件注释来包含规则，但我正在寻找一种方法来做到这一点，而无需将单个样式规则放入单独的文件中。

给那些还不想放手的人的注意事项：我选择了使用css表达式，但我并没有轻率地这样做。我理解其中的含义，并且我使用的表达式只计算一次。停止担心我的错误决定，只需回答这个问题...... ;-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T19:05:54.177

我总是使用星号“hack”来专门针对 IE6，但它确实要求您的浏览器处于**标准兼容**模式（见下文）。

```
/* IE6 only */   
* html .myClass {
    width: 500px;
} 
```

我喜欢它，因为它不依赖于解析浏览器中的不一致并且它根据[W3C](http://jigsaw.w3.org/css-validator/#validate_by_input)进行验证。

至于处于标准兼容模式，您应该始终向您的页面添加有效的 DOCTYPE，因为它会减少 CSS 错误和浏览器特性。有关 quirksmode 和标准兼容模式的说明，请查看这篇[文章](http://www.quirksmode.org/css/quirksmode.html)。

您可以使用下面的示例在每个浏览器中使用表达式。我在 FF、IE6 和 IE7 中对其进行了测试，并按预期工作。我只希望 SO 有语法高亮来识别 CSS 表达式并将它们标记为红色，这样你就可以被提醒它们是邪恶的。我可能会问你为什么首先决定使用 CSS 表达式？很多人尝试使用它们在 IE6 中实现最小宽度，但这不是正确的解决方案。如果这是您要解决的问题，我已经[在一个单独的问题中写了一个答案，](https://stackoverflow.com/questions/191429/css-two-50-fluid-columns-not-respecting-min-width#230152)演示了 IE6 中 min-width 的有效 CSS 解决方案。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <style type="text/css">

        .ie6 {
            display: none;
        }

        * html .ie6 {
            display: expression("block");
        }

        * html .ie7 {
            display: expression("none");
        }

    </style>
</head>
<body>
<div class="ie6">
    This is IE6
</div>
<div class="ie7">
    This is Firefox or IE7+
</div>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-09-09T08:14:09.047

您不必使用条件注释来添加新文件。您可以轻松添加条件注释以将类添加到`body`标签，如下所示：

```
<!--[if lte IE 7]>
<body class="ie7">
<![endif]-->
<!--[if gt IE 7]>-->
<body>
<!--<![endif]--> 
```

然后在您的 CSS 中，您可以简单地在您喜欢的任何元素上为 IE7 定义不同的样式：

```
#content {
    width:720px;
}

.ie7 #content {
    width:700px;
} 
```

您仍然加载相同的样式表，但您可以根据浏览器设置元素的样式。

您甚至可以将其扩展为 IE6、7 和非 IE 浏览器的不同样式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T17:50:38.027

你可以试试[Rafael Lima 的 CSS Selector](http://rafael.adm.br/css_browser_selector/)。它使用 Javascript，但您可以执行以下操作：

```
.ie6 .myClass {}
.ie7 .myClass {}
.ie .myClass{} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T18:23:13.637

我曾经使用 !important 让非 ie 浏览器使用不同的样式，但后来 IE7 开始支持它。我发现 IE7 将应用标记为 !ie-only 的样式（或任何不属于 !important 的样式），而其他浏览器将忽略该样式，因为它们无法识别。

如果您需要三种不同的样式，这可能会起作用，但如果您想遵守标准，那就不是很好了。*（通常我不会尝试混合使用 !important 和 !ie-only ，而只使用 !ie-only 。）*

```
#myDiv {
  height: 3.0em !important; /* non-ie */
  height: 2.6em !ie-only; /* ie7 */
  height: 2.4em; /* ie < 7 */
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T18:35:18.387

这个答案可能就是你要找的： [In-line CSS IE hack](https://stackoverflow.com/questions/213309/in-line-css-ie-hack#213458)

# visual-studio - 是否有在 Visual Studio 中构建当前项目的标准键盘快捷键？

> ID：247745
> 
> 赞同：250
> 
> 时间：2008-10-29T17:46:34.070
> 
> 标签：visual-studio, keyboard-shortcuts

我知道`Ctrl`++`Shift`会`B`启动解决方案构建，但我想要一个仅构建当前项目的快捷方式。自定义快捷方式是我唯一的选择吗？

**编辑：**看起来自定义快捷方式是我唯一的选择，因为`Shift`+`F6`对我不起作用。

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2008-12-13T18:15:57.090

将快捷方式分配给“Build.BuildOnlyProject”命令似乎在 VS2008 中不起作用。

将快捷方式分配给“Build.BuildSelection”。如果您有一个解决方案，其中包含从各个项目中打开的多个项目和文件，那么您当前正在编辑的任何文件都将定义当您使用为“Build.BuildSelection”分配的快捷方式时将构建的项目。

当您单击“构建”菜单选项并在菜单本身上看到键盘快捷键时，您将知道键盘快捷键正在工作。

顺便说一句 - 分配键盘快捷键时不需要重新启动/重新启动。

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2008-10-29T17:49:06.327

自定义快捷方式取决于您使用的键绑定.....如果您查看菜单，它会告诉您是否有键绑定。

由于我使用 ViEmu，我已经习惯的另一件事是使用菜单快捷方式。这实际上很快就可以完成，并且独立于绑定。

*   所以要构建你的项目，你去`Alt`+ `B`,`U`

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2014-03-25T21:25:33.663

您可以使用已在主菜单中建立的快捷方式，这些快捷方式通过 Alt 键进行导航：

至少对于 VS2013：

```
Alt + B, B -> Build Solution
Alt + B, R -> Rebuild Solution
Alt + B, U -> Build current project
Alt + B, E -> Rebuild current project 
```

由于某种原因，安装 Resharper 后我无法获得全局快捷方式来工作（尝试了几次！！！），但只要你想做的是在主菜单上，总是有一个 Alt +“Letter1”， “Letter2”组合可触发您想要的任何操作 :-)

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2011-06-20T09:22:29.547

对于 C# 开发：

`F6`或`Shift`++ `Ctrl`-`B`构建解决方案中的所有项目。

`Shift`+ `F6`- 构建选定的项目及其依赖项。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2017-03-23T08:55:22.383

视觉工作室 2015/17

`ALT`+ `B`+`E`

`ALT`+ `B`= 打开构建菜单

`E`= 重建当前项目

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-09-15T13:31:57.710

用于 C# 开发。工具 -> 选项。选择键盘，选择附加键盘映射方案到“Visual C# 2005”。此映射具有`F6`标准快捷方式。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-11-06T14:52:05.240

VS 2012 已经为此映射了`Shift`+ 。`F6`得知这一点我很惊讶。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-10-26T04:03:58.553

对于 Visual Studio 2017 社区，您可以使用`Alt`+`b`然后按`u`来构建您当前的项目。

详细信息： ALT 切换到主菜单 -> 为构建选择 b -> u 从下拉列表中选择构建 your_project_name 的选项。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-10-28T18:27:17.383

在 Visual Studio 2019 中，这已设置为`Ctrl`+`b`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-04-04T13:29:23.720

在 Visual Studio **2017**和**2019**中，`Shift`+`F6`对我有用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-11-07T13:40:31.500

正如快乐米塔尔所说（Alt + B + J）打开一个选择项目构建的下拉窗口，但后来我不得不按回车而不是最后一个“B”（VS 2017）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-08-20T21:55:23.477

在 Visual Studio 2015 中，+`Alt`将构建您的解决方案并发布它。`B``H`

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-12-29T19:06:25.667

有时我必须以不同于英语的语言使用 Visual Studio，并且使用的导航`Alt`键和组合键也不同。如果有人处于相同的情况，我发现创建键盘快捷键以在语言之间保持一致性更方便。我按照[https://evanjpalmer.wordpress.com/2013/08/20/build-selection-short-cut-for-visual-studio/](https://evanjpalmer.wordpress.com/2013/08/20/build-selection-short-cut-for-visual-studio/)的说明创建了键盘快捷键：

> 要进行此设置：
> 
> 1.  工具 -> 选项 -> 环境 -> 键盘（西班牙语：Herramientas -> Opciones -> Entorno -> Teclado）
> 2.  将光标置于“Press Keyboard Shortcut Keys”并shift CTRL+SHIFT+B
> 3.  在显示包含的命令中，键入：Build.BuildSelection（西班牙语：Compilar.Compilarselección）
> 4.  从下拉列表中选择 Build.BuildSelection 并点击应用
> 5.  将光标放在“Press Keyboard Shortcut Keys”并shift CTRL+ALT+SHIFT+B
> 6.  在显示包含的命令中，键入：Build.BuildSolution
> 7.  从下拉列表中选择 Build.BuildSolution 并点击应用
> 8.  ？？？
> 9.  利润！

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2008-10-29T17:51:34.700

在 Visual Studio 选项窗口的“键盘”下，查找“Build.BuildOnlyProject”命令，您可以设置任何您想要的内容。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2015-12-22T09:44:56.933

按（Alt + B + J + B）这些组合键仅构建解决方案的当前选定项目（VS 2010）。它从工具栏中选择“构建”选项（Alt + B 键），然后转到“仅项目”（J 键），然后转到“仅构建 XXX”项目（B 键）。

# apache - 在 mod_rewrite 中转义空格

> ID：247748
> 
> 赞同：2
> 
> 时间：2008-10-29T17:47:55.380
> 
> 标签：apache, mod-rewrite, cherrypy

我有以下 Apache mod_rewrite 规则：

```
RewriteRule ^(.*) http://127.0.0.1:4321/$1 [proxy] 
```

这很好用；Apache 将所有请求转发到我在同一台机器上运行的 CherryPy 服务器。

不幸的是，我在使用有空格的路径时遇到了一些问题。如果我提出请求，`/Sites/some%20site/image.png`那么 Apache 会向 CherryPy 发出请求，`/Sites/some site/image.png`这会弄乱 CherryPy。

有没有办法在我的 RewriteRule 中指定我想在将请求转发到 CherryPy 之前重新转义 URL 中的空格？

编辑：我找到了一个[可能有帮助](http://snippets.dzone.com/posts/show/6064)的参考，但我继续通过用下划线替换空格并让 CherryPy 在提供文件之前进行转换来解决问题。

如果有人有，我仍然想知道更好的解决方案；不幸的是，我在最后期限内，目前没有时间自己解决这个问题。稍后我可能会返回此内容，并在找到时间时发布进一步的更新。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T19:39:36.120

请参阅[http://tools.cherrypy.org/wiki/ModRewrite#Bewaretheencodingbug](http://tools.cherrypy.org/wiki/ModRewrite#Bewaretheencodingbug)了解最知名的解决方案。

# asp.net - 可以对绑定到自定义对象（CSV 文件）的 gridview 进行排序吗？

> ID：247754
> 
> 赞同：1
> 
> 时间：2008-10-29T17:48:46.733
> 
> 标签：asp.net

我有一个从 CSV 获取数据的 Datagrid。没有文件按任何顺序排序，但我想按用户名（字段）对 gridview 进行排序。怎么可能做到这一点？我的 XML/gridview 代码如下所示：

用于写入 csv 和填充 gridview 的 Streamwriter：

```
 string filename = @"D:\www\isolated\LocalUser\cc-suppressions\generatedsuppressions\surpressions.csv";
    StreamWriter sWriter = new StreamWriter(Server.MapPath("Surpression.csv"));
    string Str = string.Empty;
    string headertext = "";
    sWriter.WriteLine(headertext);
    int cellLimit = GridView3.Rows[1].Cells.Count;
    for (int i = 0; i <= (this.GridView3.Rows.Count - 1); i++)
    {
        for (int j = 0; j <= (this.GridView3.Rows[i].Cells.Count - 1); j++)
        {
            Str = this.GridView3.Rows[i].Cells[j].Text.ToString();
            if (Str == "&nbsp;")
                Str = "";
            Str = (Str + ",");
            sWriter.Write(Str);
        }

        sWriter.WriteLine();
    }
    sWriter.Close();
    sWriter.Dispose();
}
this.GridView3.DataBind(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T18:02:18.563

您可以使用 ODBC 驱动程序绑定到文本数据。一个例子是 [http://www.thejackol.com/2004/07/01/connect-to-a-csv-file-using-odbc-c/](http://www.thejackol.com/2004/07/01/connect-to-a-csv-file-using-odbc-c/)

您可以使用数据适配器来填充 DataSet 对象。绑定到数据集。之后您应该可以进行排序。

# jsf - 如何在 JSF 的回发中保持滚动位置？

> ID：247768
> 
> 赞同：4
> 
> 时间：2008-10-29T17:52:33.653
> 
> 标签：jsf

我正在将 JSF 前端用于上传或删除图像的页面。单击上传或删除按钮会导致回发，并且页面会以更新的状态重新加载。但是，这会重置页面的滚动位置。我应该如何在回发操作中保留此页面的回滚。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-09-15T12:53:22.690

您可以使用 actionListener 来做到这一点。例如，在您的页面中（例如 page.jsf）：

```
<f:view>    
    <h:form>
        <h:commandLink actionListener="#{bean.method}">
            <h:outputText value="Submit" />
            <f:param name="anchor" value="image" />
        </h:commandLink>
    </h:form>
    <div id='result'>
        <h1><a name='image'>Image</a></h1>        
    </div>
</f:view> 
```

托管 bean 看起来像：

```
public class Bean {

    public void method(ActionEvent actionEvent) {

        // Get parameter
        String ancla = FacesContext.getCurrentInstance().getExternalContext().getRequestParameterMap().get("anchor");

        try {
            FacesContext.getCurrentInstance().getExternalContext().redirect("page.jsf#" + anchor);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

} 
```

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T18:03:34.630

如果您使用的是 Apache MyFaces Tomahawk，您可以设置参数 AUTOSCROLL，然后确保启用 AutoScrollPhaseListener。

我不确定这个功能是由 JSF 指定的，而是由 Apache MyFaces Tomahawk 额外实现的。

此外，请注意，在 1.1.6 版本之前，AUTOSCROLL 实现中存在跨站点脚本漏洞。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-15T16:56:16.397

你可以使用 jquery .. 使用 cookies .. 在准备好的功能

```
 $(function(){

           //set window scroll position if cookie is set
       window.scroll(0,getCookie('myCookie'));
       //unset cookie after setting scroll position
       deleteCookie('myCookie'); 

       //make this class objects keep page scroll position
       jQuery(window).unload(function() {
        setCookie('myCookie', getPageScroll());
       });
        //-------------------

    }); 
```

准备好功能后添加此功能..

```
function setCookie(name,value) {

    var date = new Date();
    date.setTime(date.getTime()+(10*1000));
    var expires = "; expires="+date.toGMTString();
    document.cookie = name+"="+value+expires+"; path=/";
}

function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function deleteCookie(name) {
    setCookie(name,"",-1);
} 
```

我希望这对你有帮助..

# oop - 关于如何进行 OOP 设计的建议

> ID：247769
> 
> 赞同：6
> 
> 时间：2008-10-29T17:52:36.773
> 
> 标签：oop, architecture

我发现，每当我开始用 Java/C# 编写应用程序时，一切开始都很好，但随着时间的推移，随着应用程序变得越来越复杂，它只会变得越来越复杂。我已经意识到我不太擅长设计和高级架构。我所有的类都变得相当强耦合，设计一点也不“优雅”。我在“低级”编程方面相当称职。也就是说，我可以在一个函数或一个类中完成任何事情，但是我的高级设计很弱，我真的很想改进它。有没有人提供一些有助于使我成为更好的软件工程师的技术、书籍等？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T20:17:44.860

**我不同意从一本关于设计模式或重构的书开始。**

在我看来，对于一个可靠的 OO 设计，您应该首先熟悉主要的 OO 设计原则，然后了解如何用这些基本原则来表示您的问题。然后，您可以开始发现应用设计模式和重构技术的机会，以实现这些基本原则。

我将从这本书开始：

Robert C. Martin 的[敏捷软件开发、原则、模式和实践](https://rads.stackoverflow.com/amzn/click/com/0135974445)

在这本书中，Robert Martin 描述了良好的 OO 设计的[基本原则](http://www.tek271.com/articles/pood/PrinciplesOfOOD.java.html)，所有这些原则都与封装、耦合和模块化有关：

*   开放/封闭原则
*   里斯科夫换人
*   依赖倒置
*   粒度
*   共同关闭
*   重用
*   无循环依赖
*   依赖的稳定性
*   抽象和稳定性

毕竟，我在 GoF 和 Fowler 中看到的几乎所有设计模式和重构技术都旨在实现这些基本原则中的一个，具体取决于它们在给定场景中的相对优先级。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T17:56:04.193

**图书：**

*   代码完成，史蒂夫·麦康奈尔（Steve McConnel）
*   设计模式，Gamma 等。人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T17:55:58.717

我将从草绘我的设计开始。该草图可以是显示类之间关系的方框和箭头图，也可以是 UML（甚至可能是标准 UML）的变体。但我发现草图可以帮助我了解设计的好坏，甚至可以帮助我了解如何修复它。

我还会看一本关于设计模式的书。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T18:48:15.680

使用面向对象的设计原则 ( [http://www.surfscranton.com/Architecture/ObjectOrientedDesignPrinciples.htm](http://www.surfscranton.com/Architecture/ObjectOrientedDesignPrinciples.htm) )。还考虑一些oo设计启发式（[http://www.cs.colorado.edu/~kena/classes/6448/s02/lectures/lecture27.pdf](http://www.cs.colorado.edu/~kena/classes/6448/s02/lectures/lecture27.pdf)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T18:00:07.460

编写一个大型项目，让它尽可能大地传播。然后研究你可以做些什么来改进你的代码。

如果单个大型例程结构良好，那么它们也可能是干净且易于理解的。

好的设计没有一个好的答案。它实际上是程序员可以学习的有价值的东西之一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T18:11:25.707

你可以毫不留情地重构以改进现有代码的设计。

主要思想是，在某些时候代码确实有意义，当新特性被引入代码时，可能某些特性或职责必须转移到另一个类，这很好。然后您停止开发新功能并开始重构您的代码。

我建议您阅读：

[Martin Fowler 重构](http://www.google.com.mx/search?q=refactoring+by+martin+fowler)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T20:22:33.820

I would start with : [Head first object-oriented analysis and design.](http://www.amazon.ca/Head-First-Object-Oriented-Analysis-Design/dp/0596008678/ref=pd_bbs_sr_2?ie=UTF8&s=books&qid=1225311693&sr=8-2) and once you mastered it : [Head first design patterns.](http://www.amazon.ca/Head-First-Design-Patterns-Freeman/dp/0596007124/ref=pd_sim_b_7)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T20:49:22.143

Read [Head First Design Patterns](http://oreilly.com/catalog/9780596007126).

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T18:49:16.923

浏览好的 API 代码。例如 Spring 框架代码。阅读一些好书，例如设计模式（就像这里提到的其他人一样）和其他一些关于良好实践的书籍。例如 Java、Head First Design、Effective Java 系列等。 C++ - Effective C++ 系列

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-29T19:44:48.980

显然，阅读一些推荐的书籍会有所帮助。我认为[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)绝对没有 GoF 书那么抽象。

我问的主要问题是“这段代码是否做了一些非常具体的事情，可以在其他地方重复使用？” 如果是这样，请将其放入允许重用的程序集中的类中。

如果您真的刚刚开始，那么我曾经做的一件事就是将每个数据库表视为一个“对象”。所以每个数据库表代表一个类。纯粹主义者会告诉你这是一场灾难，但我发现这是让自己开始从对象角度思考的好方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-29T18:01:50.280

在开始之前尝试制作程序大纲和图表，并让其他人审查和批评它。然后随着程序的增长，不断更新大纲和图表以包含新功能。让其他人对其进行审查和批评。最终，假设您正在从批评中学习，您将在设计程序方面变得更好。

书籍和教程只能让你到目前为止。虽然您确实需要学习可用的工具和方法，但知识本身并不能帮助您。实践会让你在设计方面做得更好，并且不时有导师指导你，向你展示如何更好地应用你从书中获得的一些知识。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-29T18:02:01.747

一定要阅读这些书籍，但如果你编写的代码最终会变得愚蠢，也不要感到难过。每个人都这样。问题是，你能重构你必须修复的东西吗？为了能够有效且经常地做到这一点，您需要使用[TDD](http://en.wikipedia.org/wiki/Test-driven_development)并编写大量单元测试。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-29T18:16:07.537

我强烈建议您尝试测试驱动开发 (TDD)。您会发现，要使您的代码可测试，并且不需要不断地对测试进行返工，您将需要一个可靠的设计。您会发现，当您添加\更改\删除功能时，您更好的设计将需要对特定测试集进行非常小的更改。糟糕的设计会抹去大量的测试——因为你有紧密的耦合、负责多个关注点的对象等等……

我发现我在 TDD 方面做得越好，我的架构就越好，最终结果也越好。

请注意，TDD 需要真正的心理训练。您不应该期望您使用它 1-2 天并立即看到效果。您将需要真正想要这样做，并真正付出努力-否则您将不会受益，并且可能最终会讨厌它。

HTH ...

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-29T18:35:04.567

您可以做几件事

1.  **在实际开始编程之前，**使用工具进行高级和低级设计。**例如，创建类 UML 图表将帮助您以图表形式而不是代码形式将解决方案可视化。**

***   **熟悉 Java 设计模式**。例如，以多态方式使用继承将使您热身开始使用标准Java 和J2EE 设计模式。** 

 **有大量的书籍和网站与我刚刚在这里指出的这两个主题有关。

# python - 如何检索模块的路径？

> ID：247770
> 
> 赞同：925
> 
> 时间：2008-10-29T17:52:40.673
> 
> 标签：python, module, inotify

我想检测模块是否发生了变化。现在，使用 inotify 很简单，您只需要知道要从中获取通知的目录即可。

如何在 python 中检索模块的路径？

* * *

## 回答 #1

> 赞同：1123
> 
> 时间：2008-10-29T23:57:13.760

```
import a_module
print(a_module.__file__) 
```

实际上会给你加载的 .pyc 文件的路径，至少在 Mac OS X 上。所以我想你可以这样做：

```
import os
path = os.path.abspath(a_module.__file__) 
```

你也可以试试：

```
path = os.path.dirname(a_module.__file__) 
```

获取模块的目录。

* * *

## 回答 #2

> 赞同：327
> 
> 时间：2012-08-28T07:24:09.850

python中有`inspect`模块。

## [官方文档](http://docs.python.org/library/inspect.html)

> inspect 模块提供了几个有用的函数来帮助获取有关活动对象的信息，例如模块、类、方法、函数、回溯、框架对象和代码对象。例如，它可以帮助您检查类的内容、检索方法的源代码、提取和格式化函数的参数列表，或者获取显示详细回溯所需的所有信息。

例子：

```
>>> import os
>>> import inspect
>>> inspect.getfile(os)
'/usr/lib64/python2.7/os.pyc'
>>> inspect.getfile(inspect)
'/usr/lib64/python2.7/inspect.pyc'
>>> os.path.dirname(inspect.getfile(inspect))
'/usr/lib64/python2.7' 
```

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2011-06-20T19:05:40.220

正如其他答案所说，最好的方法是使用`__file__`（在下面再次演示）。但是，有一个重要的警告，如果您自己运行模块（即 as ） ，`__file__`则不存在。`__main__`

例如，假设您有两个文件（这两个文件都在您的 PYTHONPATH 上）：

```
#/path1/foo.py
import bar
print(bar.__file__) 
```

和

```
#/path2/bar.py
import os
print(os.getcwd())
print(__file__) 
```

运行 foo.py 将给出输出：

```
/path1        # "import bar" causes the line "print(os.getcwd())" to run
/path2/bar.py # then "print(__file__)" runs
/path2/bar.py # then the import statement finishes and "print(bar.__file__)" runs 
```

但是，如果您尝试自行运行 bar.py，您将获得：

```
/path2                              # "print(os.getcwd())" still works fine
Traceback (most recent call last):  # but __file__ doesn't exist if bar.py is running as main
  File "/path2/bar.py", line 3, in <module>
    print(__file__)
NameError: name '__file__' is not defined 
```

希望这可以帮助。在测试提出的其他解决方案时，这个警告花费了我很多时间和困惑。

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2013-05-30T02:15:40.017

我也会尝试解决这个问题的一些变化：

1.  查找被调用脚本的路径
2.  查找当前执行脚本的路径
3.  找到被调用脚本的目录

（其中一些问题已在 SO 上提出，但已作为重复项关闭并在此处重定向。）

## 使用注意事项`__file__`

对于您已导入的模块：

```
import something
something.__file__ 
```

将返回模块的**绝对**路径。但是，鉴于以下脚本 foo.py：

```
#foo.py
print '__file__', __file__ 
```

用'python foo.py'调用它会简单地返回'foo.py'。如果你添加一个shebang：

```
#!/usr/bin/python 
#foo.py
print '__file__', __file__ 
```

并使用 ./foo.py 调用它，它将返回 './foo.py'。从不同的目录调用它，（例如将 foo.py 放在目录栏中），然后调用

```
python bar/foo.py 
```

或添加一个shebang并直接执行文件：

```
bar/foo.py 
```

将返回“bar/foo.py”（**相对**路径）。

## 查找目录

现在从那里获取目录，`os.path.dirname(__file__)`也可能很棘手。至少在我的系统上，如果您从与文件相同的目录中调用它，它会返回一个空字符串。前任。

```
# foo.py
import os
print '__file__ is:', __file__
print 'os.path.dirname(__file__) is:', os.path.dirname(__file__) 
```

将输出：

```
__file__ is: foo.py
os.path.dirname(__file__) is: 
```

换句话说，它返回一个空字符串，因此如果您想将它用于当前**文件**（与导入模块的**文件相反），这似乎并不可靠。**为了解决这个问题，您可以将其包装在对 abspath 的调用中：

```
# foo.py
import os
print 'os.path.abspath(__file__) is:', os.path.abspath(__file__)
print 'os.path.dirname(os.path.abspath(__file__)) is:', os.path.dirname(os.path.abspath(__file__)) 
```

输出类似：

```
os.path.abspath(__file__) is: /home/user/bar/foo.py
os.path.dirname(os.path.abspath(__file__)) is: /home/user/bar 
```

请注意， abspath() 不解析符号链接。如果您想这样做，请改用 realpath()。例如，创建一个指向 file_import_testing.py 的符号链接 file_import_testing_link，其内容如下：

```
import os
print 'abspath(__file__)',os.path.abspath(__file__)
print 'realpath(__file__)',os.path.realpath(__file__) 
```

执行将打印绝对路径，例如：

```
abspath(__file__) /home/user/file_test_link
realpath(__file__) /home/user/file_test.py 
```

文件导入测试链接-> 文件导入测试.py

## 使用检查

@SummerBreeze 提到使用[检查](http://docs.python.org/2/library/inspect.html)模块。

对于导入的模块，这似乎运行良好，并且非常简洁：

```
import os
import inspect
print 'inspect.getfile(os) is:', inspect.getfile(os) 
```

乖乖返回绝对路径。查找当前执行脚本的路径：

```
inspect.getfile(inspect.currentframe()) 
```

（感谢@jbochi）

```
inspect.getabsfile(inspect.currentframe()) 
```

给出当前执行脚本的绝对路径（感谢@Sadman_Sakib）。

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2015-03-11T00:10:44.000

我不明白为什么没有人谈论这个，但对我来说最简单的解决方案是使用**imp.find_module("modulename")**（[此处](https://docs.python.org/2/library/imp.html?highlight=import#module-imp)的文档）：

```
import imp
imp.find_module("os") 
```

它给出了一个路径在第二个位置的元组：

```
(<open file '/usr/lib/python2.7/os.py', mode 'U' at 0x7f44528d7540>,
'/usr/lib/python2.7/os.py',
('.py', 'U', 1)) 
```

这种方法相对于“检查”方法的优点是您不需要导入模块来使其工作，并且您可以在输入中使用字符串。例如，在检查另一个脚本中调用的模块时很有用。

**编辑**：

在 python3 中，`importlib`模块应该做：

文件`importlib.util.find_spec`：

> 返回指定模块的规范。
> 
> 首先，检查 sys.modules 以查看模块是否已导入。如果是这样，那么 sys.modules[name]。**规格**返回。如果恰好设置为 None，则会引发 ValueError。如果模块不在 sys.modules 中，则在 sys.meta_path 中搜索合适的规范，并将 'path' 的值提供给查找器。如果找不到规范，则不返回任何内容。
> 
> 如果名称是子模块的（包含一个点），则自动导入父模块。
> 
> 名称和包参数的工作方式与 importlib.import_module() 相同。换句话说，相对模块名称（带有前导点）有效。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2008-10-29T19:18:15.320

这是微不足道的。

每个模块都有一个`__file__`变量，显示您现在所在位置的相对路径。

因此，获取模块通知它的目录很简单：

```
os.path.dirname(__file__) 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2010-12-13T17:35:17.707

```
import os
path = os.path.abspath(__file__)
dir_path = os.path.dirname(path) 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2014-08-16T23:04:03.010

```
import module
print module.__path__ 
```

> 包支持另一种特殊属性，`__path__`. 这被初始化为一个列表，其中包含`__init__.py`在该文件中的代码执行之前保存包的目录的名称。这个变量可以修改；这样做会影响将来对包中包含的模块和子包的搜索。
> 
> 虽然通常不需要此功能，但它可用于扩展包中的模块集。

[来源](https://docs.python.org/2/tutorial/modules.html#packages-in-multiple-directories)

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2015-08-15T16:27:18.247

## 命令行实用程序

您可以将其调整为命令行实用程序，

```
python-which <package name> 
```

[![在此处输入图像描述](https://i.stack.imgur.com/pjVSO.png)](https://i.stack.imgur.com/pjVSO.png)

* * *

创造`/usr/local/bin/python-which`

```
#!/usr/bin/env python

import importlib
import os
import sys

args = sys.argv[1:]
if len(args) > 0:
    module = importlib.import_module(args[0])
    print os.path.dirname(module.__file__) 
```

使其可执行

```
sudo chmod +x /usr/local/bin/python-which 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2018-08-29T15:39:10.843

你可以只导入你的模块然后点击它的名字，你会得到它的完整路径

```
>>> import os
>>> os
<module 'os' from 'C:\\Users\\Hassan Ashraf\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\os.py'>
>>> 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2012-03-18T16:28:43.550

所以我花了相当多的时间尝试用 py2exe 来做这个问题是获取脚本的基本文件夹，无论它是作为 python 脚本运行还是作为 py2exe 可执行文件运行。无论是从当前文件夹、另一个文件夹还是（这是最难的）从系统路径运行，也让它工作。

最终我使用了这种方法，使用 sys.frozen 作为在 py2exe 中运行的指标：

```
import os,sys
if hasattr(sys,'frozen'): # only when running in py2exe this exists
    base = sys.prefix
else: # otherwise this is a regular python script
    base = os.path.dirname(os.path.realpath(__file__)) 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2019-03-31T23:03:39.663

如果你想从它的任何模块中检索包的根路径，以下工作（在 Python 3.6 上测试）：

```
from . import __path__ as ROOT_PATH
print(ROOT_PATH) 
```

`__init__.py`也可以通过 using 来引用主路径`__file__`。

希望这可以帮助！

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2018-10-06T13:04:45.020

如果您想知道脚本中的绝对路径，可以使用[Path](https://docs.python.org/3/library/pathlib.html)对象：

```
from pathlib import Path

print(Path().absolute())
print(Path().resolve('.'))
print(Path().cwd()) 
```

[cwd() 方法](https://docs.python.org/3/library/pathlib.html#pathlib.Path.cwd)

> 返回一个表示当前目录的新路径对象（由 os.getcwd() 返回）

[解析（）方法](https://docs.python.org/3/library/pathlib.html#pathlib.Path.resolve)

> 使路径成为绝对路径，解析任何符号链接。返回一个新的路径对象：

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2020-11-12T08:53:23.883

导入模块时，您可以访问大量信息。退房`dir(a_module)`。至于路径，有一个dunder `a_module.__path__`：。您也可以只打印模块本身。

```
>>> import a_module
>>> print(dir(a_module))
['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__']
>>> print(a_module.__path__)
['/.../.../a_module']
>>> print(a_module)
<module 'a_module' from '/.../.../a_module/__init__.py'> 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-08-15T01:22:39.707

如果使用的唯一警告`__file__`是当前的相对目录为空白（即，从脚本所在的同一目录作为脚本运行时），那么一个简单的解决方案是：

```
import os.path
mydir = os.path.dirname(__file__) or '.'
full  = os.path.abspath(mydir)
print __file__, mydir, full 
```

结果：

```
$ python teste.py 
teste.py . /home/user/work/teste 
```

诀窍就在通话`or '.'`之后`dirname()`。它将 dir 设置为`.`，这意味着*当前目录*并且对于任何与路径相关的函数都是有效的目录。

因此，使用`abspath()`并不是真正需要的。但是，如果您仍然使用它，则不需要技巧：`abspath()`接受空白路径并将其正确解释为当前目录。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-04-22T16:54:04.760

我想贡献一个常见的场景（在 Python 3 中）并探索一些方法。

内置函数[open()](https://docs.python.org/3/library/functions.html#open)接受相对路径或绝对路径作为其第一个参数。相对路径被视为*相对于当前工作目录*，因此建议将绝对路径传递给文件。

简单来说，如果你用下面的代码运行一个脚本文件，**不**保证该`example.txt`文件会创建在脚本文件所在的同一目录下：

```
with open('example.txt', 'w'):
    pass 
```

要修复此代码，我们需要获取脚本的路径并使其成为绝对路径。为了确保路径是绝对的，我们只需使用[os.path.realpath()](https://docs.python.org/3/library/os.path.html#os.path.realpath)函数。要获取脚本的路径，有几个常用函数会返回各种路径结果：

*   `os.getcwd()`
*   `os.path.realpath('example.txt')`
*   `sys.argv[0]`
*   `__file__`

[os.getcwd()](https://docs.python.org/3/library/os.html#os.getcwd)和[os.path.realpath()](https://docs.python.org/3/library/os.path.html#os.path.realpath)函数都根据*当前工作目录*返回路径结果。一般不是我们想要的。[sys.argv](https://docs.python.org/3/library/sys.html#sys.argv)列表的第一个元素是*根脚本*（您运行的脚本）的路径，无论您是在根脚本本身还是在其任何模块中调用该列表。在某些情况下它可能会派上用场。__file__变量包含调用它的模块的路径[。](https://docs.python.org/3/reference/import.html#__file__)

* * *

以下代码`example.txt`在脚本所在的同一目录中正确创建了一个文件：

```
filedir = os.path.dirname(os.path.realpath(__file__))
filepath = os.path.join(filedir, 'example.txt')

with open(filepath, 'w'):
    pass 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-01-14T01:23:25.097

如果您希望在“程序”中动态执行此操作，请尝试以下代码：
我的意思是，您可能不知道要“硬编码”它的模块的确切名称。它可能是从列表中选择的，也可能当前未运行以使用 __file__。

（我知道，它不适用于 Python 3）

```
global modpath
modname = 'os' #This can be any module name on the fly
#Create a file called "modname.py"
f=open("modname.py","w")
f.write("import "+modname+"\n")
f.write("modpath = "+modname+"\n")
f.close()
#Call the file with execfile()
execfile('modname.py')
print modpath
<module 'os' from 'C:\Python27\lib\os.pyc'> 
```

我试图摆脱“全局”问题，但发现它不起作用的情况我认为可以在 Python 3 中模拟“execfile()”由于这是在程序中，因此可以轻松地将其放入方法或模块中重用。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-05-12T13:27:01.890

在 python 包的模块中，我必须引用与 package.json 位于同一目录中的文件。前任。

```
some_dir/
  maincli.py
  top_package/
    __init__.py
    level_one_a/
      __init__.py
      my_lib_a.py
      level_two/
        __init__.py
        hello_world.py
    level_one_b/
      __init__.py
      my_lib_b.py 
```

所以在上面我必须从 my_lib_a.py 模块调用 maincli.py ，知道 top_package 和 maincli.py 在同一个目录中。这是我获取 maincli.py 路径的方法：

```
import sys
import os
import imp

class ConfigurationException(Exception):
    pass

# inside of my_lib_a.py
def get_maincli_path():
    maincli_path = os.path.abspath(imp.find_module('maincli')[1])
    # top_package = __package__.split('.')[0]
    # mod = sys.modules.get(top_package)
    # modfile = mod.__file__
    # pkg_in_dir = os.path.dirname(os.path.dirname(os.path.abspath(modfile)))
    # maincli_path = os.path.join(pkg_in_dir, 'maincli.py')

    if not os.path.exists(maincli_path):
        err_msg = 'This script expects that "maincli.py" be installed to the '\
        'same directory: "{0}"'.format(maincli_path)
        raise ConfigurationException(err_msg)

    return maincli_path 
```

根据 PlasmaBinturong 的发布，我修改了代码。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2022-01-08T06:11:24.603

如果要检索模块路径**而不加载**它：

```
import importlib.util

print(importlib.util.find_spec("requests").origin) 
```

示例输出：

```
/usr/lib64/python3.9/site-packages/requests/__init__.py 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-01-31T13:57:45.453

如果您使用 pip 安装它，“pip show”效果很好（“位置”）

$ pip 显示检测器2

```
Name: detectron2
Version: 0.1
Summary: Detectron2 is FAIR next-generation research platform for object detection and segmentation.
Home-page: https://github.com/facebookresearch/detectron2
Author: FAIR
Author-email: None
License: UNKNOWN
Location: /home/ubuntu/anaconda3/envs/pytorch_p36/lib/python3.6/site-packages
Requires: yacs, tabulate, tqdm, pydot, tensorboard, Pillow, termcolor, future, cloudpickle, matplotlib, fvcore 
```

### 更新：

$ python -m pip 显示我的模块

（作者：维斯巴基）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-02-10T17:51:18.237

这是一个快速的 bash 脚本，以防它对任何人都有用。我只想能够设置一个环境变量，以便我可以`pushd`访问代码。

```
#!/bin/bash
module=${1:?"I need a module name"}

python << EOI
import $module
import os
print os.path.dirname($module.__file__)
EOI 
```

外壳示例：

```
[root@sri-4625-0004 ~]# export LXML=$(get_python_path.sh lxml)
[root@sri-4625-0004 ~]# echo $LXML
/usr/lib64/python2.7/site-packages/lxml
[root@sri-4625-0004 ~]# 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-08-29T20:54:06.820

如果您使用`pip`，那么您可以调用`pip show`，但您必须使用`python`您正在使用的特定版本来调用它。例如，这些都可能给出不同的结果：

```
$ python -m pip show numpy
$ python2.7 -m pip show numpy
$ python3 -m pip show numpy

Location: /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python 
```

不要简单地运行`$ pip show numpy`，因为不能保证`pip`不同`python`版本调用的相同。

# php - 你如何解释 PHP 中的序列化关联数组，为什么选择这种序列化方法？

> ID：247772
> 
> 赞同：0
> 
> 时间：2008-10-29T17:53:06.040
> 
> 标签：php, arrays, serialization

```
a:3:{i:0;i:4;i:1;i:3;i:2;i:2;} 
```

我是否可以说这是一个大小为 3 的数组，其中键值对是`0->4`、`1->3`和`2->2`？

如果是这样，我发现这种表示非常令人困惑。起初，我认为它是一个值列表（或包含的数组`{0, 4, 1, 3, 2, 2}`），但我认为`a:3`: 是数组的大小。如果`3`是大小，那么键和值都出现在括号中，如果不计数就无法清楚地识别键/值对。

为了澄清我来自哪里：

为什么 PHP 开发者会选择以这种方式进行序列化？这有什么优势，比方说 var_dump 和/或 var_export 显示其数据的方式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T17:58:38.447

是的`array(4, 3, 2)`

`a`对于数组，`i`对于整数作为键然后是值。你必须数数才能找到一个特定的，但 PHP 总是反序列化整个批次，所以无论如何它都有一个计数。

编辑：当你习惯它时，它并不太令人困惑，但与 JSON 相比，它可能有点冗长

> 注意： var_export() 不处理循环引用，因为几乎不可能为此生成可解析的 PHP 代码。如果您想对数组或对象的完整表示做某事，请使用 serialize()。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T18:04:58.590

```
$string="a:3:{i:0;i:4;i:1;i:3;i:2;i:2;}";
$array=unserialize($string);
print_r($array); 
```

输出：

```
Array
(
    [0] => 4
    [1] => 3
    [2] => 2
) 
```

如果认为重点是 PHP 不区分整数索引数组和字符串索引哈希表。序列化格式可以以完全相同的方式用于哈希表：`a:<<size>>:{<<keytype>>:<<key>>;<<valuetype>>:<<value>>;...}`

由于该格式不是人类可读的，而是提供一种通用格式来表示所有 PHP 变量类型（资源除外），我认为使用给定格式更简单，因为可以通过读取底层变量来重构一个字符一个字符的字符串。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T18:36:17.963

序列化的 PHP 数据并不是真正的人类可读的——据我所知，这不是格式的目标。

我认为格式看起来像它的最大原因是为了简洁，它的形式也可能与它的处理速度有关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T17:57:14.360

为什么不使用[unserialize()](http://uk.php.net/unserialize)函数将数据恢复到以前的状态？

# c# - 布尔逻辑规则评估器

> ID：247779
> 
> 赞同：2
> 
> 时间：2008-10-29T17:56:03.130
> 
> 标签：c#, xml, logic, boolean, rule-engine

我基本上有一个显示的调查，人们回答问题很像测试，并且有不同的路径，到目前为止这很容易，但我想让它更加动态，这样我就可以有一个通用规则用于所有路径的测试，以使评估器更易于使用，目前我只允许 AND，每个 OR 本质上成为集合中的另一个规则，

QuestionID，然后我形成一堆像这样的AND规则

```
`<rule id="1">
<true>
 <question ID=123>
 <question ID=124>
</true>
<false>
 <question ID=127>
 <question ID=128>
</false>
</rule>
<rule id="2"><true>
 <question ID=123>
 <question ID=125>
</true>
<false>
 <question ID=127>
</false>
</rule>` 
```

`这条规则 1 说，如果问题 123 和 124 回答正确，而问题 127、128 回答错误，则通过。OR（规则 2）是如果 123 和 125 为真而 127 为假，它们也通过了。如果有很多组合，这会变得乏味，所以我想在逻辑中实现 OR，我只是不确定解决这个问题的最佳方法是什么。`

 `我认为规则引擎太复杂了，必须有更简单的方法，也许像在 LINQ 中那样构建一个图，然后评估它们是否通过，

谢谢！

--不是compsci专业。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T18:17:11.153

这不必很复杂：您已经完成了大部分工作，因为您的 and 元素有效地实现了 AND 类型的规则。我将介绍一个可以容纳和元素的元素。

在你的能力范围内，你可以：

*   一个 RuleBase 类，具有“公共抽象 bool Evaluate()”方法
*   TrueRule、FalseRule 和 OrRule 类，其中包含 RuleBase 对象的列表
*   一个 QuestionRule 类，它引用一个特定的问题

您将在其中的每一个上实现 Evaluate 方法，如下所示：

*   **TrueRule：**仅当所有包含的规则从 Evaluate 返回 true 时才返回 true
*   **FalseRule：**仅当所有包含的规则从 Evaluate 返回 false 时才返回 true
*   **OrRule：**如果至少有一个包含的规则从 Evaluate 返回 true，则返回 true
*   **QuestionRule：**返回原始问题的答案

此类层次结构实现了一个简单的抽象语法树 (AST)。LINQ，以 System.Expressions.Expression 类的形式，做的事情几乎相同，但如果不清楚所有内容如何组合在一起，那么编写自己的内容会很有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-18T09:22:44.227

如果您使用支持推理的适当规则引擎，它将更加高效和可扩展。

看看[http://www.flexrule.com](http://www.flexrule.com)，它是一个灵活、可扩展的规则引擎，支持三种类型的规则。程序、推理和规则流规则可以从您的应用程序外部化并使用此框架执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T18:22:53.843

我不确定我是否完全理解您要解决的问题，但您可以使用简单的 XPath 来获取 ID：

这将为您提供规则 ID = 1 的所有“真实”ID：/rule[@id="1"]/true//@ID

与上面相同，只是它为您提供了错误的 ID：/rule[@id="1"]/false//@ID

最后是 .NET 中 XPath 简介的链接 [http://www.developer.com/xml/article.php/3383961](http://www.developer.com/xml/article.php/3383961)

祝你好运

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:15:08.340

我建议将答案放在问题上，而不是使用`true`和`false`对问题进行分组。我认为它使 XML 更易于阅读，这是值得商榷的。没有争议的是，它可以`question`独立评估元素，即无需了解您尝试评估它的上下文。这使得代码更简单。

我还会从 XML Schema 中获取一个页面，并将您的 OR 逻辑实现为一个`choice`元素。如果`choice`元素中的任何一个子元素为真，则该元素为真。当然，您可以嵌套它们：

```
<rule id="1">
   <question id="123" answer="true" />
   <question id="124" answer="false" />
   <choice id="1">
      <question id="125" answer='true' />
      <choice id="2">
         <question id="126" answer='false' />
         <question id="127" answer='false' />
      </choice>
   </choice>
</rule> 
```

这为您留下了四种非常简单的方法来实现，每种方法都被前面的方法使用：

*   `bool GetProvidedAnswer(int questionID)`
*   `bool IsQuestionCorrect(XmlElement question)`
*   `bool IsChoiceCorrect(XmlElement choice)`
*   `bool IsRuleSatisfied(XmlElement rule)`

XML 的结构使这些方法的实现非常简单：

```
 bool IsRuleSatisfied(XmlElement rule)
 {
    bool satisfied = true;
    foreach (XmlElement child in rule.SelectNodes("*"))
    {
       if (child.Name == "question")
       {
          satisfied = satisfied && IsQuestionCorrect(child);
       }
       if (child.Name == "choice")
       {
          satisfed = satisfied && IsChoiceCorrect(child);
       }
       if (!satisfied)
       {
          return false;
       }
   }
   return true;
} 
```

可能值得将 a 添加`List<XmlElement>`到`IsFooCorrect`方法的参数中。（如果规则引擎在一个类中，您可以将其设为类字段。）当答案错误时，所有方法都将当前元素添加到列表中。然后，您可以检查该列表的内容以确切了解规则失败的原因。

# delphi - Delphi 2009 和 Firebird 2.1 = 完整的 Unicode？

> ID：247787
> 
> 赞同：6
> 
> 时间：2008-10-29T17:58:31.567
> 
> 标签：delphi, unicode, delphi-2009, firebird

有没有人开始制作 Unicode 应用程序或将现有应用程序转换为 Unicode？

您如何调整 Firebird 以使问题最少，尤其是 CHARSET 属性？

有没有遇到什么问题？还有什么我应该注意的吗？

在跳上 Unicode 火车之前，我只是在做好自己的准备，以便减少惊喜。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-01T17:50:38.770

使用 UTF8 作为 Firebird 数据库的字符集。无论如何，这是支持所有可能字符的唯一选项，因为 UNICODE_FSS 已成为过去。

然而，这与您关于使用 Delphi 创建 Unicode 程序的问题是正交的。即使对于使用 UTF8 字符集的新 Ansi Delphi 程序也是您的最佳选择，因为您可以将 Ansi 程序（例如使用 GNU gettext for Delphi [http://dybdahl.dk/dxgettext/](http://dybdahl.dk/dxgettext/)）翻译成其他语言，并且只能使用 UTF8数据库 您可以存储可能发送到数据库的所有文本，具体取决于 Windows 代码页。另一种方法是为不同的部署使用不同的数据库字符集，然后您不能再简单地在安装之间交换数据库文件或迁移数据而无需先重新编码。

对于您的开发工作，还要确保您的数据库管理程序与 UTF8 数据库完美配合。由于它们中的大多数是用 Delphi 编写的，因此您可能会遇到问题，除非它使用支持 Unicode 的控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T21:59:20.987

它是应用程序的“边缘”，您会在其中看到问题（文件读取/写入、DLL、存储等）。

ini 文件：我从 TIniFile（仅限 ansi）迁移到 TMemIniFile（不要忘记调用 UpdateFile）。

至于你问题的火鸟部分，我对此没有任何经验。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T20:16:15.517

据我所知，Delphi 2009 中唯一没有启用 unicode 的部分是控制台函数，如 readln 和 writeln。其余的应该是完全 unicode。

# logging - 在 Lighttpd 中按日期或文件大小拆分日志文件

> ID：247792
> 
> 赞同：2
> 
> 时间：2008-10-29T18:01:01.373
> 
> 标签：logging, lighttpd, logrotate

到目前为止，我发现这样做的唯一方法是告诉 Lighty 通过一个名为“vlogger”的应用程序来管道它的日志。有没有办法在不引入任何外部依赖项或 cron 作业的情况下按日期分解日志文件？我觉得可能有一种方法可以使用配置文件变量来做到这一点，但我的 Lighty-fu 还不够强大。

**编辑**：看起来[logrotate](http://www.debian-administration.org/articles/117)可能是我最好的选择。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T17:19:13.207

我只知道使用 syslog 进行日志处理或其他软件（如“logrotate”或类似的东西）的选项。也许[手册](http://redmine.lighttpd.net/wiki/lighttpd/Docs:ModAccessLog)有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-31T09:07:56.533

以下是为 lighty 配置 logrotate 的方法：[Lighttpd：日志文件轮换](http://www.phaze9dezign.com/post/9495204210/lighttpd-log-file-rotation)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-27T13:50:42.903

我使用 cronolog 而不是 vlogger 来做到这一点没有任何问题。不幸的是，您不能使用这种技术来轮换错误日志。查看旧的 Lighttpd 错误报告，有一个补丁可以修复错误日志，但它被拒绝了。

# c# - 用另一个部分类覆盖部分类的默认构造函数

> ID：247800
> 
> 赞同：53
> 
> 时间：2008-10-29T18:02:36.677
> 
> 标签：c#, web-services, wsdl, overriding, partial-classes

我不认为这是可能的，但如果是那么我需要它:)

我有一个从 Visual Studio 2008 的 wsdl.exe 命令行工具自动生成的代理文件。

代理输出是部分类。我想覆盖生成的默认构造函数。我宁愿不修改代码，因为它是自动生成的。

我尝试制作另一个部分类并重新定义默认构造函数，但这不起作用。然后我尝试使用 override 和 new 关键字，但这不起作用。

我知道我可以从部分类继承，但这意味着我必须更改我们所有的源代码以指向新的父类。我宁愿不必这样做。

有什么想法、解决方法或技巧吗？

```
//Auto-generated class
namespace MyNamespace {
   public partial class MyWebService : System.Web.Services.Protocols.SoapHttpClientProtocol {
      public MyWebService() {
         string myString = "auto-generated constructor";
         //other code...
      }
   }
}

//Manually created class in order to override the default constructor
namespace MyNamespace {
   public partial class MyWebService : System.Web.Services.Protocols.SoapHttpClientProtocol {
      public override MyWebService() { //this doesn't work
         string myString = "overridden constructor";
         //other code...
      }
   }
} 
```

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2010-01-09T01:24:52.737

我遇到了类似的问题，我生成的代码是由 DBML 文件创建的（我正在使用 Linq-to-SQL 类）。

在生成的类中，它在构造函数的末尾调用一个名为 OnCreated() 的部分 void。

长话短说，如果您想保留生成的类为您执行的重要构造函数（您可能应该这样做），那么在您的部分类中创建以下内容：

```
partial void OnCreated()
{
    // Do the extra stuff here;
} 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-29T18:08:00.987

这是不可能的。部分类本质上是同一类的一部分；没有方法可以定义两次或重写，包括构造函数。

您可以在构造函数中调用一个方法，并且只在其他部分文件中实现它。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-04-02T20:57:23.660

嗯，我认为一个优雅的解决方案如下：

```
//* AutogenCls.cs file
//* Let say the file is auto-generated ==> it will be overridden each time when
//* auto-generation will be triggered.
//*
//* Auto-generated class, let say via xsd.exe
//*
partial class AutogenCls
{
    public AutogenCls(...)
    {
    }
}

//* AutogenCls_Cunstomization.cs file
//* The file keeps customization code completely separated from 
//* auto-generated AutogenCls.cs file.
//*
partial class AutogenCls
{
    //* The following line ensures execution at the construction time
    MyCustomization m_MyCustomizationInstance = new MyCustomization ();

    //* The following inner&private implementation class implements customization.
    class MyCustomization
    {
        MyCustomization ()
        {
            //* IMPLEMENT HERE WHATEVER YOU WANT TO EXECUTE DURING CONSTRUCTION TIME
        }
    }
} 
```

这种方法有一些缺点（如一切）：

1.  在 AutogenCls 类的整个构建过程中，MyCustomization 内部类的构造函数究竟会在什么时候执行，目前尚不清楚。

2.  如果有必要为 MyCustomization 类实现 IDiposable 接口以正确处理 MyCustomization 类的非托管资源的处置，我不知道（尚）如何在不触及 AutogenCls.cs 文件的情况下触发 MyCustomization.Dispose() 方法...（但正如我所说的'还':)

但是这种方法与自动生成的代码有很大的分离——整个定制是在不同的 src 代码文件中分离的。

请享用 ：）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-09-27T15:52:40.500

实际上，现在这是可能的，因为已经添加了部分方法。这是文档：

[http://msdn.microsoft.com/en-us/library/wa80x488.aspx](http://msdn.microsoft.com/en-us/library/wa80x488.aspx)

基本上，这个想法是您可以在定义分部类的一个文件中声明和调用方法，但实际上不能在该文件中定义方法。然后，您可以在另一个文件中定义该方法。如果您正在构建未定义方法的程序集，则 ORM 将删除对该函数的所有调用。

所以在上面的例子中，它看起来像这样：

//自动生成的类

```
namespace MyNamespace {
   public partial class MyWebService : System.Web.Services.Protocols.SoapHttpClientProtocol {
      public MyWebService() {
         string myString = "auto-generated constructor";
         OtherCode();
      }
   }
}

partial void OtherCode(); 
```

//手动创建类以覆盖默认构造函数

```
partial void OtherCode()
{
   //do whatever extra stuff you wanted.
} 
```

它有点有限，在这种特殊情况下，如果您有一个需要更改的生成文件，它可能不是正确的解决方案，但对于其他偶然发现此尝试覆盖部分类中的功能的人来说，这可以很有帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-06-17T16:06:36.670

OP 遇到的问题是 Web 引用代理不会生成任何可用于拦截构造函数的部分方法。

我遇到了同样的问题，我不能只升级到 WCF，因为我的目标 Web 服务不支持它。

我不想手动修改自动生成的代码，因为如果有人调用代码生成，它就会变平。

我从不同的角度解决了这个问题。我知道我的初始化需要在请求之前进行，实际上并不需要在构造时完成，所以我只是像这样覆盖了 GetWebRequest 方法。

```
protected override WebRequest GetWebRequest(Uri uri)
{
    //only perform the initialization once
    if (!hasBeenInitialized)
    {
        Initialize();
    }

    return base.GetWebRequest(uri);
}

bool hasBeenInitialized = false;

private void Initialize()
{
    //do your initialization here...

    hasBeenInitialized = true;
} 
```

这是一个很好的解决方案，因为它不涉及破解自动生成的代码，并且它适合 OP 为 SoapHttpClientProtocol 自动生成的代理执行初始化登录的确切用例。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-29T18:10:25.787

你不能这样做。我建议使用部分方法，然后您可以为其创建定义。就像是：

```
public partial class MyClass{ 

    public MyClass(){  
        ... normal construction goes here ...
        AfterCreated(); 
    }

    public partial void OnCreated();
} 
```

其余的应该是不言自明的。

编辑：

我还想指出，您应该为此服务定义一个接口，然后您可以对其进行编程，因此您不必引用实际的实现。如果你这样做了，那么你还有其他一些选择。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-29T18:28:24.360

我想你也许可以用[PostSharp](http://www.postsharp.org)做到这一点，看起来有人已经[为生成的部分类中的方法做了你想要的](http://www.postsharp.org/forum/post1873.html)。我不知道这是否会很容易地转化为编写方法并让它的主体替换构造函数的能力，因为我还没有尝试过，但似乎值得一试。

编辑：[这是相同的路线](http://www.codeproject.com/KB/cs/LinFuPart6.aspx)，看起来也很有趣。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-02-14T09:49:03.997

有时您无权访问或不允许更改默认构造函数，因此您无法使用默认构造函数调用任何方法。

在这种情况下，您可以使用虚拟参数创建另一个构造函数，并使用“：this()”使这个新构造函数调用默认构造函数

```
public SomeClass(int x) : this()
{
    //Your extra initialization here
} 
```

当您创建此类的新实例时，您只需像这样传递虚拟参数：

```
SomeClass objSomeClass = new SomeClass(0); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-12-30T11:54:42.240

在我看来，这是该语言的设计缺陷。他们应该允许一个部分方法的多个实现，这将提供一个很好的解决方案。以一种更好的方式，构造函数（也是一种方法）也可以简单地标记为部分，并且在创建对象时将运行具有相同签名的多个构造函数。

最简单的解决方案可能是为每个额外的部分类添加一个部分“构造函数”方法：

```
public partial class MyClass{ 

    public MyClass(){  
        ... normal construction goes here ...
        OnCreated1(); 
        OnCreated2(); 
        ...
    }

    public partial void OnCreated1();
    public partial void OnCreated2();
} 
```

如果您希望部分类彼此不可知，您可以使用反射：

```
// In MyClassMyAspect1.cs
public partial class MyClass{ 

    public void MyClass_MyAspect2(){  
        ... normal construction goes here ...

    }

}

// In MyClassMyAspect2.cs
public partial class MyClass{ 

    public void MyClass_MyAspect1(){  
        ... normal construction goes here ...
    }
}

// In MyClassConstructor.cs
public partial class MyClass : IDisposable { 

    public MyClass(){  
       GetType().GetMethods().Where(x => x.Name.StartsWith("MyClass"))
                             .ForEach(x => x.Invoke(null));
    }

    public void Dispose() {
       GetType().GetMethods().Where(x => x.Name.StartsWith("DisposeMyClass"))
                             .ForEach(x => x.Invoke(null));
    }

} 
```

但实际上他们应该添加更多的语言结构来处理部分类。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-02-22T09:53:32.267

对于由 Visual Studio 生成的 Web 服务代理，您不能在分部类中添加自己的构造函数（当然可以，但它不会被调用）。相反，您可以使用 [OnDeserialized] 属性（或 [OnDeserializing]）在 Web 代理类实例化的位置挂接您自己的代码。

```
using System.Runtime.Serialization;

partial class MyWebService
{
     [OnDeserialized]
     public void OnDeserialized(StreamingContext context)
     {
         // your code here
     }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-09-18T19:16:27.103

我并没有完全解决 OP，但是如果您碰巧正在使用 EntityFramework Reverse POCO Generator 生成类，那么在构造函数中调用了一个部分方法，这对于初始化您通过自己的部分类添加的内容非常方便。 .

工具生成：

```
 [System.CodeDom.Compiler.GeneratedCode("EF.Reverse.POCO.Generator", "2.37.3.0")]
    public partial class Library {
        public string City { get; set; }
        public Library() {
            InitializePartial();
        }
        partial void InitializePartial();
    } 
```

由您添加：

```
 public partial class Library {
        List<Book> Books { get; set; }
        partial void InitializePartial() {
            Books = new List<Book>();
        }
    }

    public class Book {
        public string Title { get; set; }
    } 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-29T18:07:04.903

没有什么我能想到的。我能想到的“最佳”方法是添加一个带有虚拟参数的 ctor 并使用它：

```
public partial class MyWebService : System.Web.Services.Protocols.SoapHttpClientProtocol 
{
   public override MyWebService(int dummy) 
   { 
         string myString = "overridden constructor";
         //other code...
   }
}

MyWebService mws = new MyWebService(0); 
```

# delphi - 如何制作“环绕”类型的 Delphi 模板？

> ID：247801
> 
> 赞同：5
> 
> 时间：2008-10-29T18:02:56.847
> 
> 标签：delphi, delphi-2009, live-templates

我正在将我的应用程序迁移到 delphi 2009。我的应用程序必须仍然使用大量 AnsiString。在迁移过程中，我发现自己总是在转换：

```
abc := def; 
```

进入：

```
abc := string(def); 
```

或者

```
abc := TDeviceAnsiString(def); 
```

我知道我应该能够使用模板来做到这一点，但我发现模板——尽管功能强大——并不那么容易开始工作。这是我一直在尝试的：

```
<?xml version="1.0" encoding="utf-8" ?>

<codetemplate   xmlns="http://schemas.borland.com/Delphi/2005/codetemplates"
                version="1.0.0">
    <template name="das" invoke="auto">
        <point name="expr">
            <script language="Delphi">
                InvokeCodeCompletion;
            </script>
            <hint>
                MP: TDeviceAnsiString
            </hint>
            <text>
                True
            </text>
        </point>
        <description>
            MP: TDeviceAnsiString
        </description>
        <author>
            Mike
        </author>
        <code language="Delphi" context="any" delimiter="|"><![CDATA[TDeviceAnsiString(|selected|)|end|]]>
        </code>
    </template>
</codetemplate> 
```

它不会出现在“环绕”菜单中，也不会在我想要的时候激活。我希望能够

```
abc := **das***[tab]*def; 
```

或选择“def”并使用“环绕”获得：

```
abc := TDeviceAnsiString(def); 
```

感谢您的帮助！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T19:38:15.763

这应该这样做：

```
<?xml version="1.0" encoding="utf-8" ?>
<codetemplate   xmlns="http://schemas.borland.com/Delphi/2005/codetemplates"
                version="1.0.0">
    <template name="das" surround="true" invoke="auto">
        <description>
            MP: TDeviceAnsiString
        </description>
        <author>
            Mike rev François
        </author>
        <code language="Delphi" delimiter="|"><![CDATA[TDeviceAnsiString(|end||selected|)]]>
        </code>
    </template>
</codetemplate> 
```

补充：您可以通过[LiveTemplates Technical Infos在](http://delphi.wikia.com/wiki/Live_Templates_Technical_Info)[Delphi Wiki](http://delphi.wikia.com/wiki/Delphi_Wiki)上找到更多信息

# php - mysql_connect VS mysql_pconnect

> ID：247807
> 
> 赞同：26
> 
> 时间：2008-10-29T18:06:18.523
> 
> 标签：php, mysql, mysql-connect, mysql-pconnect

我有这个疑问，我在网上搜索过，答案似乎是多样化的。通过 PHP 连接到数据库时，使用 mysql_pconnect 而不是 mysql_connect 更好吗？我读到 pconnect 的扩展性要好得多，但另一方面，作为一个持久连接......同时拥有 10 000 个连接，所有连接都是持久的，对我来说似乎无法扩展。

提前致谢。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-29T18:45:15.840

MySQL 应该不需要持久连接。在其他数据库（如 Oracle）中，建立连接既昂贵又耗时，因此如果您可以重用连接，那将是一个巨大的胜利。但是这些品牌的数据库提供了连接池，可以更好地解决问题。

与其他品牌的数据库相比，与 MySQL 数据库建立连接的速度更快，因此使用持久连接对 MySQL 的好处比其他品牌的数据库要少。

持久连接也有一个缺点。数据库服务器为每个连接分配资源，无论这些连接是否需要。因此，如果连接处于空闲状态，您会看到大量无用的资源浪费。我不知道您是否会达到 10,000 个空闲连接，但即使是几百个也是昂贵的。

连接具有状态，PHP 请求从先前由另一个 PHP 请求使用的会话中“继承”信息是不合适的。例如，临时表和用户变量通常会在连接关闭时被清理，但如果您使用持久连接则不会。同样基于会话的设置，如字符集和排序规则。此外，`LAST_INSERT_ID()`将报告会话期间最后生成的 id——即使那是在先前的 PHP 请求期间。

至少对于 MySQL 来说，持久连接的缺点可能超过了它们的好处。还有其他更好的技术来实现高可扩展性。

* * *

2014 年 3 月更新：

与其他品牌的 RDBMS 相比，MySQL 的连接速度一直较低，但它正在变得更好。

请参阅[http://mysqlserverteam.com/improving-connectdisconnect-performance/](http://mysqlserverteam.com/improving-connectdisconnect-performance/)

> 在 MySQL 5.6 中，我们开始致力于优化代码处理连接和断开连接。而这项工作在 MySQL 5.7 中得到了加速。在这篇博文中，我将首先展示我们已经取得的成果，然后描述我们为获得这些成果所做的工作。

阅读博客了解更多详细信息和速度比较。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T23:31:26.060

基本上，您必须平衡创建连接与保持连接的成本。尽管 MySQL 建立新连接的速度非常快，但它仍然需要花费 - 线程设置时间，以及来自 Web 服务器的 TCP/IP 设置时间。这在足够高的流量站点上很明显。不幸的是，PHP 对连接的持久性没有任何控制。所以答案是大大降低 MySQL 中的空闲超时时间（比如降低到 20 秒），并增加线程缓存大小。总之，这通常工作得非常好。

另一方面，您的应用程序需要尊重连接的状态。最好不要假设会话处于什么状态。如果您使用临时表，那么使用 CREATE IF NOT EXISTS 和 TRUNCATE TABLE 会有很大帮助，唯一地命名它们（例如包含用户 ID）也有很大帮助。交易有点问题；但是您的代码总是可以在顶部执行 ROLLBACK，以防万一。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-02-10T10:16:04.720

`mysql_connect()`两者`mysql_pconnect()`都在为数据库连接工作，但差别不大。在`mysql_pconnect()`中，`p`代表持久连接。

当我们使用`mysql_connect()`函数时，每次打开和关闭数据库连接，取决于请求。

但在`mysql_pconnect()`功能的情况下：

*   首先，在连接时，该函数会尝试查找已使用相同主机、用户名和密码打开的（持久）连接。如果找到，将返回它的标识符，而不是打开新连接。

*   其次，脚本执行结束时不会关闭与 SQL 服务器的连接。相反，连接将保持打开状态以供将来使用（`mysql_close()`不会关闭由 建立的连接`mysql_pconnect()`）。

`mysql_pconncet()`当您的网站上有大量流量时很有用。那时，对于每个请求，它都不会打开连接，而是从池中取出连接。这将提高您网站的效率。但一般使用 mysql_connect() 是最好的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-29T18:14:48.180

您不太可能达到 10000 个连接。无论如何，去[官方来源](http://es.php.net/manual/en/features.persistent-connections.php)。（强调我的）。

> 如果持久连接没有任何附加功能，它们有什么用？
> 
> 这里的答案非常简单——效率。如果创建到 SQL 服务器的链接的开销很高，则持久连接是好的。这种开销是否真的很高取决于许多因素。比如，它是什么类型的数据库，它是否位于您的 Web 服务器所在的同一台计算机上，SQL 服务器所在的计算机的负载情况等等。**底线是，如果连接开销很高，持久连接对您有很大帮助**. 它们导致子进程在其整个生命周期内仅连接一次，而不是每次处理需要连接到 SQL 服务器的页面时。这意味着每个打开持久连接的子节点都将拥有自己的到服务器的打开持久连接。例如，如果您有 20 个不同的子进程运行一个与您的 SQL 服务器建立持久连接的脚本，那么您将有 20 个与 SQL 服务器的不同连接，每个子进程一个。
> 
> 但是请注意，如果您使用的数据库的连接限制超过了持久子连接的限制，那么这可能会有一些缺点。如果您的数据库有 16 个同时连接的限制，并且在繁忙的服务器会话过程中，有 17 个子线程尝试连接，一个将无法连接。如果您的脚本中存在不允许关闭连接的错误（例如无限循环），那么只有 16 个连接的数据库可能会被迅速淹没。检查您的数据库文档以获取有关处理废弃或空闲连接的信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-25T06:48:35.500

**MYSQL_CONNECT()**

1.mysql_connect 可用于关闭连接。每次打开和关闭数据库连接，取决于请求。

2.在MYSQL connect中每次加载页面时都会打开这里的数据库

3.页面加载时，每次都加载数据库

4.用于关闭连接

例子：

```
<?php $conn = mysql_connect(‘host’, ‘mysql_user’, ‘mysql_password’); if(!$conn){ die(‘Could not connect: ‘ . mysql_error()); } echo ‘Connected successfully’; mysql_close($conn); ?> 
```

描述：

host：指定主机名或 IP 地址，如 localhost。

mysql_user：指定 MySQL 用户名

mysql_password：指定 MySQL 密码

**MYSQL_PCONNECT()**

1.我们使用mysql_pconncet()，它最初试图找到一个打开的持久连接。

2.mysql_pconncet()打开持久连接

3.mysql_pconnect()不支持关闭连接

4.mysql_pconnect() 无法关闭连接。这里打开一个到数据库的持久连接

5.这里的数据库不需要每次都连接。

6.The database need not be connected every time in mysql_pconncet().

more details:[http://prittytimes.com/difference-between-mysql_connect-and-mysql_pconnect/](http://prittytimes.com/difference-between-mysql_connect-and-mysql_pconnect/)

# c++ - stl::multimap - 我如何获取数据组？

> ID：247818
> 
> 赞同：35
> 
> 时间：2008-10-29T18:11:42.663
> 
> 标签：c++, stl, multimap

Multimap 本质上具有按键排序的数据组。我想要一种方法，通过它我可以访问这些单独的组并获取它们的汇总值。例如，在`std::multimap< string, int >`I 商店

```
{"Group1", 1}, 
{"Group1", 2}, 
{"Group1", 3}, 

{"Group2", 10}, 
{"Group2", 11}, 
{"Group2", 12} 
```

存储了这些值后，我应该能够迭代这个多图并获得每个“组”的聚合值。问题是 STL 中没有定义任何函数来以这种方式访问​​ MultiMaps。我可以使用`lower_bound`,`upper_bound`手动迭代多图并汇总组的内容，但我希望 STL 中已经定义了更好的方法？任何人都可以提出一个解决方案，说明我如何在上面的示例中获取组的聚合值。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-29T18:23:55.617

```
pair<Iter, Iter> range = my_multimap.equal_range("Group1");
int total = accumulate(range.first, range.second, 0); 
```

是一种方式。

**编辑：**

如果您不知道要查找的组，并且只是遍历每个组，则可以像这样获取下一个组的范围：

```
template <typename Pair>
struct Less : public std::binary_function<Pair, Pair, bool>
{
    bool operator()(const Pair &x, const Pair &y) const
    {
        return x.first < y.first;
    }
};

Iter first = mmap.begin();
Iter last = adjacent_find(first, mmap.end(), Less<MultimapType::value_type>()); 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-07-28T19:28:00.070

```
// samekey.cpp -- Process groups with identical keys in a multimap

#include <iostream>
#include <string>
#include <map>
using namespace std;

typedef multimap<string, int> StringToIntMap;
typedef StringToIntMap::iterator mapIter;

int main ()
{
    StringToIntMap mymap;

    mymap.insert(make_pair("Group2", 11));
    mymap.insert(make_pair("Group1",  3));
    mymap.insert(make_pair("Group2", 10));
    mymap.insert(make_pair("Group1",  1));
    mymap.insert(make_pair("Group2", 12));
    mymap.insert(make_pair("Group1",  2));

    cout << "mymap contains:" << endl;

    mapIter m_it, s_it;

    for (m_it = mymap.begin();  m_it != mymap.end();  m_it = s_it)
    {
        string theKey = (*m_it).first;

        cout << endl;
        cout << "  key = '" << theKey << "'" << endl;

        pair<mapIter, mapIter> keyRange = mymap.equal_range(theKey);

        // Iterate over all map elements with key == theKey

        for (s_it = keyRange.first;  s_it != keyRange.second;  ++s_it)
        {
           cout << "    value = " << (*s_it).second << endl;
        }
    }

    return 0;

}   //  end main

// end samekey.cpp 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-29T18:22:51.797

如果您已经知道密钥，则可以使用`multimap::equal_range`将迭代器获取到组的开头和结尾；使用任何标准算法从范围中获得所需的结果。如果您不知道密钥，您可以`begin()`自己开始并遍历它们，比较密钥以找到每个新组的开始。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T06:09:53.790

您可以使用可以包含每个组的总和的备用容器。为此，您可能会执行以下操作：

```
template <class KeyType, class ValueType>
struct group_add {
  typedef map<KeyType, ValueType> map_type;
  map_type & aggregates;
  explicit group_add(map_type & aggregates_)
    : aggregates(aggregates_) { };
  void operator() (map_type::value_type const & element) {
    aggregates[element.first] += element.second;
  };
};

template <class KeyType, class ValueType>
group_add<KeyType, ValueType>
make_group_adder(map<KeyType, ValueType> & map_) {
  return group_add<KeyType, ValueType>(map_);
};

// ...
multimap<string, int> members;
// populate members
map<string, int> group_aggregates;
for_each(members.begin(), members.end(),
  make_group_adder(group_aggregates));
// group_aggregates now has the sums per group 
```

当然，如果你有 Lambda（在 C++0x 中），它可能会更简单：

```
multimap<string, int> members;
map<string, int> group_aggregates;
for_each(members.begin(), members.end(),
  [&group_aggregates](multimap<string, int>::value_type const & element) {
    group_aggregates[element.first] += element.second;
  }
  ); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-11-03T01:53:10.507

```
equal_range 
```

句法：

```
#include <map>
pair<iterator, iterator> equal_range( const key_type& key ); 
```

该函数`equal_range()`返回两个迭代器——一个指向包含键的第一个元素，另一个指向包含键的最后一个元素之后的点。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-29T19:02:07.990

不是多地图答案，但如果您愿意，您可以执行以下操作。

```
#include <iostream>
#include <vector>
#include <map>
#include <string>
#include <boost/assign/list_of.hpp>
#include <boost/foreach.hpp>
using namespace std;
using namespace boost;
using namespace boost::assign;

int main() {
    typedef map<string, vector<int> > collection;
    collection m;
    m["Group 1"] = list_of(1)(2)(3);
    m["Group 2"] = list_of(10)(11)(12);
    collection::iterator g2 = m.find("Group 2");
    if (g2 != m.end()) {
        BOOST_FOREACH(int& i, g2->second) {
            cout << i << "\n";
        }
    }
} 
```

# apache-flex - Flex 应用程序到组件？

> ID：247819
> 
> 赞同：0
> 
> 时间：2008-10-29T18:11:49.713
> 
> 标签：apache-flex, actionscript-3, components, flexbuilder, mxml

我有一个在 Flex Builder 3 中构建的应用程序。它有相当数量的 mxml 和 as3 代码，这些代码使用了一些其他自定义组件。我查看了有关构建组件的文档，该文档展示了如何制作一个简单的 mxml 或操作脚本组件来扩展类似于组合框的东西，但我不知道如何将一个完整的现有且独立运行的应用程序变成一个可重复使用的组件。

基本上，我只想在另一个 flex 项目中创建这个应用程序的多个实例。

谁能提供一点指导？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T20:53:08.720

最简单的做法是将 Application mxml 标记与 VBox 标记交换……从而使它像一个组件一样工作。

例如，如果这是您的应用程序：

```
 //Foo.mxml
<mx:Appliction xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:Label text = "foo" />
</mx:Appliction> 

```

将其更改为：

```
 //Foo.mxml
<mx:VBox>
    <mx:Label text = "foo" />
</mx:VBox> 

```

然后你可以做这样的事情：

```
 //App.mxml
<mx:Appliction 
    xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:local="your.package.scheme.*"
>
    <local:Foo />

</mx:Appliction> 

```

如果您需要将任何数据传递给组件，您可能必须创建一些公共属性......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T18:30:59.037

如果您只是想让一些“父”Flex 应用程序嵌入这个自治子应用程序的多个实例，那么您应该查看 Adob​​e 的[“嵌入资产类型”](http://livedocs.adobe.com/flex/3/html/help.html?content=embed_4.html)文档，该文档描述了如何将一个 SWF 文件嵌入到另一个文件中。

从文档中：

> 当您不需要嵌入应用程序与嵌入式应用程序交互时，您通常会嵌入 Flex 应用程序。如果嵌入应用程序需要与嵌入应用程序交互，您可以考虑将其实现为自定义组件，而不是作为单独的应用程序。

如果您*确实*需要嵌入式应用程序和父应用程序之间的交互，您可以查看[SWFLoader](http://livedocs.adobe.com/flex/3/html/help.html?content=controls_15.html)控件。

# .net - 通过 .NET 关闭时 Excel 2007 挂起

> ID：247833
> 
> 赞同：1
> 
> 时间：2008-10-29T18:16:44.773
> 
> 标签：.net, vb.net, excel

我有一个需要打开和关闭 Excel 电子表格的 Visual Basic .NET 程序。打开和阅读电子表格工作正常，但试图关闭 Excel 2007 应用程序会导致它挂起。它似乎关闭了，但是如果您查看任务管理器，该应用程序仍在运行。我用来关闭它的代码是

```
wbkData.Close(saveChanges:=False)
appExcel.Quit()
wbkData = Nothing
appExcel = Nothing 
```

如何让 Excel 正确关闭？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T19:11:05.210

我认为这里已经涵盖了您的问题的答案： [如何在 c 中正确清理 excel 互操作对象](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c)

我从您的代码示例中看不到，但基本上，始终将您的 excel 对象分配给局部变量，永远不要“向下两个点”，如下所示：

```
//FAIL

Workbook wkBook = xlApp.Workbooks.Open(@"C:\mybook.xls"); 
```

而是单独引用每个 obj：

```
//WIN

Worksheets sheets = xlApp.Worksheets;
Worksheet sheet = sheets.Open(@"C:\mybook.xls");
...
Marshal.ReleaseComObject(sheets);
Marshal.ReleaseComObject(sheet); 
```

.NET 为您不可见的 COM 对象创建了一个包装器，并且在 GC 编织它的魔力之前不会被释放。

在我发现这一点之前，每次我创建一个新的工作簿来检查 excel.exe 进程的年龄并杀死任何超过一分钟的工作簿时，我都会在 ASP.NET 应用程序中运行下面的 hacky 代码：

```
//force kill any excel processes over one minute old.
try
{
    Process[] procs = Process.GetProcessesByName("EXCEL");
    foreach (Process p in procs)
    {
        if (p.StartTime.AddMinutes(1) < DateTime.Now)
        {
            p.Kill(); 
        }  
    }  
}
catch (Exception)
{} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T22:15:13.263

我写了你[在 Excel 团队博客上提到的那篇文章](http://blogs.msdn.com/excel/archive/2006/06/19/636534.aspx)......

我之前在 StackOverflow 上也讨论过这个问题，问题是[如何在 C# 中正确清理 Excel 互操作对象](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c#159419)。

该问题的第一个答案被标记为“正确”并获得 11 票，但我向您保证，该策略在实践中很难正确使用。如果有人在任何地方滑动并使用“两个点”，或者通过 for each 循环或任何其他类似的命令迭代单元格，那么您将拥有未引用的 COM 对象并冒着挂起的风险——而且没有办法在代码中找到原因。

相反，您采用的清理程序绝对是可行的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T18:19:48.793

我[在 MSDN Excel 博客](http://blogs.msdn.com/excel/archive/2006/06/19/636534.aspx)中找到了一个对我有用的解决方案。它被解释为

> 以上有两个问题：
> 
> (1) 尽管代码似乎首先处理“wbkData”对象等，但上面的代码实际上并未 *强制执行*此操作，因为 .NET 垃圾收集过程可以按任何顺序处理其对象。（GC 在顺序上是非确定性的，而不仅仅是在时间上是非确定性的。）
> 
> (2) 诸如“wsh = wbkData.Workssheets.Item(1)”之类的命令——或类似的行——非常常见，并且会创建一个包装“工作表”对象的 RCW 对象。你不会有一个变量持有对它的引用，所以你通常不会考虑它，但是这个 RCW 对象直到下一次垃圾收集才会被释放。然而，上面的代码*最后*调用了 GC.Collect() ，所以当 appExcel.Quit() 被调用时，RCW 仍然持有对这个“工作表”对象的引用。Excel因此挂起。

最终代码看起来像

```
GC.Collect()
GC.WaitForPendingFinalizers()

wbkData.Close(SaveChanges:=False)
System.Runtime.InteropServices.Marshal.FinalReleaseComObject(wbkData) : wbkData = Nothing
appExcel.Quit()
System.Runtime.InteropServices.Marshal.FinalReleaseComObject(appExcel) : appExcel = Nothing 
```

# javascript - 在 SlideDown 和 SlideUp 之间进行链接切换（scriptaculous）

> ID：247834
> 
> 赞同：3
> 
> 时间：2008-10-29T18:16:50.437
> 
> 标签：javascript, scriptaculous, slideup, slidedown

scriptaculous wiki 有一个演示 ( [http://github.com/madrobby/scriptaculous/wikis/effect-slidedown](http://github.com/madrobby/scriptaculous/wikis/effect-slidedown) )，它显示了使用中的 SlideDown 效果。但是，如果某个 DIV 被隐藏，我需要有相同的链接才能向下滑动，如果该 DIV 正在显示，我需要有相同的链接。

我如何实现这一目标？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-29T19:03:57.923

使用[Effect.toggle](http://github.com/madrobby/scriptaculous/wikis/effect-toggle)。

```
Effect.toggle('element_id', 'slide'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T18:21:30.507

将其包装在一个函数中，而是调用该函数。

```
function slideMe(myDiv) {

    if(Element.visible(myDiv)) {
    //slide up

    }

    else {

    //slide down

    }
} 
```

# c# - 声明变量 - 最佳实践

> ID：247837
> 
> 赞同：5
> 
> 时间：2008-10-29T18:17:22.777
> 
> 标签：c#, .net

不久前我发现（我想再次确认）如果你声明一个类级别的变量，你不应该调用它的构造函数，直到类构造函数或加载被调用。原因是性能 - 但是否有其他理由这样做或不这样做？这条规则有例外吗？

**即：这是我根据我认为的最佳实践所做的：**

```
public class SomeClass
{
   private PersonObject _person;

   public SomeClass()
   {
      _person = new PersonObject("Smitface");
   }
} 
```

**反对：**

```
public class SomeClass
{
   private PersonObject _person = new PersonObject("Smitface");

   public SomeClass()
   {

   }
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-29T18:27:16.877

如果您在构造函数之外设置变量，则没有可用的错误处理（处理）。虽然在您的示例中没有区别，但在很多情况下您可能希望进行某种错误处理。在这种情况下，使用您的第一个选项是正确的。

Nescio 谈到了如果有一些构造函数失败，这将对您的应用程序产生什么影响。

出于这个原因，我总是使用选项#1。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-29T18:20:50.337

老实说，如果您查看 IL，则在第二种情况下发生的所有事情都是编译器将初始化移动到您的构造函数。

就个人而言，我喜欢在构造函数中完成所有初始化。如果我正在处理一次性原型项目，我不介意将初始化和声明放在同一个位置，但对于我的“我想保留这个”项目，我会在构造函数中完成所有操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-29T19:01:52.373

实际上，不管其他人怎么说，初始化是在构造函数内部还是外部**都可能很**重要，因为如果对象在层次结构中，则在对象构造期间会有不同的行为（即运行的顺序不同） ）。

请参阅[这篇文章](http://blogs.msdn.com/ericlippert/archive/2008/02/15/why-do-initializers-run-in-the-opposite-order-as-constructors-part-one.aspx)和Eric Lippert 的[这篇文章](http://blogs.msdn.com/ericlippert/archive/2008/02/18/why-do-initializers-run-in-the-opposite-order-as-constructors-part-two.aspx)，其中更详细地解释了两者之间的语义差异。

所以答案是，在大多数情况下，它没有任何区别，当然在性能方面也没有任何区别，但在少数情况下，它*可能*会有所不同，你应该知道为什么，并据此做出决定。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T23:33:07.727

有一种称为依赖注入或控制反转 (IOC) 的常见模式，它提供了这两种机制，用于将依赖对象（如 DAL 类）“注入”到依赖链（来自数据库）的类中

在这种模式中，使用 ctor，您将

公共类 SomeClass
{
私人 PersonObject per；

```
 public SomeClass(PersonObject person) 

 {      
     per = person;   
 } 
```

}

私人 PersonObject Joe = new PersonObject("Smitface");

SomeClass MyObj = new SomeClass(Joe);

例如，现在您可以传递一个真正的 DAL 类以进行生产调用或在单元测试方法中传递一个测试 DAL 类...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T18:21:49.537

这取决于如何使用变量的上下文。自然，常量和静态或只读应该在声明时初始化，否则它们通常应该在构造函数中初始化。这样，您就可以相当容易地替换设计模式，以使您的对象变得相当容易，而不必担心何时初始化变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T21:59:44.620

您通常应该更喜欢*第二种变体*。它对代码的更改更加健壮。假设您添加了一个构造函数。现在你必须记住在那里初始化你的变量，除非你使用第二个变体。

当然，这仅在没有令人信服的理由使用构造函数内初始化（如 discorax 所述）的情况下才有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T18:18:41.697

我更喜欢后者，但只是因为我觉得它更整洁。

这真的是个人喜好，他们都做同样的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T18:22:09.180

第一个声明实际上更干净。第二个隐藏了构造函数在静态构造函数中初始化类的事实。如果由于任何原因构造函数失败，则整个类型对于应用程序的其余部分是不可用的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T18:31:56.430

我喜欢在构造函数中进行初始化，因为这样一切都发生在一个地方，而且如果您决定稍后创建一个重载的构造函数，它会更容易。

此外，它有助于提醒我要在解构器中清理的东西。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-29T18:35:05.627

后者可以利用惰性实例化，即它不会初始化变量，直到它被引用

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-29T18:39:41.187

我认为这类问题只是文体问题，所以谁在乎你是怎么做的。语言允许两者，所以其他人会同时做。不要做出错误的假设。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-10-29T18:21:04.687

我更喜欢尽快初始化变量，因为它可以避免（一些）空错误。

编辑：显然在这个简化的例子中没有区别，但是在一般情况下，我认为如果可能的话，在声明类变量时初始化它们是一种好习惯。这使得在初始化之前无法引用变量，从而消除了在构造函数中初始化字段时可能出现的一些错误。

随着您获得更多类变量并且构造函数中的初始化序列变得更加复杂，引入错误变得更容易，其中一个初始化依赖于另一个尚未发生的初始化。

# asp.net - 如何在 ASP.NET v3.5 应用程序中使用 Silverlight 绘制图形？

> ID：247849
> 
> 赞同：0
> 
> 时间：2008-10-29T18:22:16.963
> 
> 标签：asp.net, silverlight, graphing

我需要做一些图表（条形图、图表、饼图、趋势），而不是使用 Infragistics 或手动绘制我想使用 Silverlight 的图表。

我当前的 ASP.NET 应用程序已升级到 3.5，并且我添加了一个 Silverlight 应用程序项目。在现有的 master.page 布局或用户控件内部使用输出似乎并不像我希望的那样直观。

从数据的泛型列表创建图形的能力甚至不是一个控件（就像我在 PDC08 的几个演示中看到的那样）。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T21:26:21.007

我建议从包含 Silverlight 图表控件的[Silverligt 工具包（在 PDC 发布）开始。](http://www.codeplex.com/Silverlight/Release/ProjectReleases.aspx?ReleaseId=18804)[此处](http://www.codeplex.com/Silverlight/Wiki/View.aspx?title=Silverlight%20Toolkit%20Overview%20Part%202)概述了如何使用此控制柱。

Silverlight 图表和基于 ASP.Net 论坛的图表（使用第三方控件）之间的重要区别在于 Silverlight 图表将在客户端执行，而 asp.net 图表将在服务器上执行。因此，如果您想使用这种类型的控件，您需要将图表数据公开为[服务](http://silverlight.net/blogs/msnow/archive/2008/09/22/silverlight-tip-of-the-day-43-silverlight-enabled-wcf-services-versus-asmx-web-services.aspx)。

进行 Silverlight 图表但让您的代码在客户端执行的另一种选择是使用 ASP.Net 构建您的 Xaml。在这种情况下，您将使用 ASP.Net 创建图表 Xaml，而不是生成 HTML 输出，而是生成 Xaml 输出。

如果你想要一个例子，请告诉我...

# c# - C# - 将列表转储到下拉列表

> ID：247856
> 
> 赞同：15
> 
> 时间：2008-10-29T18:23:19.193
> 
> 标签：c#, list, drop-down-menu

```
List<String> nameList = new List<String>();
DropDownList ddl = new DropDownList(); 
```

列表在这里填充，然后排序：

```
nameList.Sort(); 
```

现在我需要将它放到下拉列表中，这是我遇到问题的地方（使用 foreach）：

```
foreach (string name in nameList){
    ddl.Items.Add(new ListItem(nameList[name].ToString()));
} 
```

没有工作 - 有什么建议吗？它给了我编译错误：

```
Error - The best overloaded method match for 'System.Collections.Generic.List<string>.this[int]' has some invalid arguments 

Error - Argument '1': cannot convert from 'string' to 'int' 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-29T18:26:01.260

为什么不直接将 DDL 绑定到列表，例如

```
DropDownList ddl = new DropDownList();
ddl.DataSource = nameList;
ddl.DataBind(); 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-29T18:27:22.663

替换这个：

```
 ddl.Items.Add(new ListItem(nameList[name].ToString())); 
```

有了这个：

```
 ddl.Items.Add(new ListItem(name)); 
```

像晚餐一样完成。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-17T02:09:46.913

```
ddl.DataSource = nameList; 
ddl.DataBind(); 
```

如果它是 SharePoint 列表，则不起作用 - 错误：数据源是无效类型。它必须是 IListSource、IEnumerable 或 IDataSource。决定插话，以防任何 SharePoint 开发人员认为这是针对 SPList 而不是 List<string>，如上所述。

有一种方法可以绑定到 SPList，但您会使用 SPListItemCollection，或者更好地使用 SPDataSource。对于 SharePoint 开发人员，请参阅[Chris O' Brien 的此博客](http://www.sharepointnutsandbolts.com/2008/06/spdatasource-every-sharepoint-developer.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T18:28:08.963

那是因为 List 不是按字符串（名称）而是按整数索引的。

```
foreach (string name in nameList)
{
    ddl.Items.Add(new ListItem(name));
} 
```

会解决的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T18:28:05.500

```
 foreach (string name in nameList){
        ddl.Items.Add(new ListItem(nameList[name].ToString()));
    } 
```

是你的问题。

它应该看起来更像

```
foreach (string name in nameList){
    ddl.Items.Add(new ListItem(name.ToString()));
} 
```

但实际上我更喜欢 Marcus 的建议。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T18:29:09.743

您会收到该错误，因为集合`nameList`是 a`List`所以您必须使用索引而不是字符串（您使用名称）来访问它。

所以你可以写：

```
foreach (string name in nameList){
    ddl.Items.Add(name);
} 
```

顺便说一句，最好的方法是：

```
ddl.DataSource = nameList;
ddl.DataBind(); 
```

# algorithm - 可翻转数据结构的模式名称？

> ID：247857
> 
> 赞同：3
> 
> 时间：2008-10-29T18:23:34.853
> 
> 标签：algorithm, language-agnostic, design-patterns, data-structures

我试图想出一个命名约定来准确地传达我正在设计的课程中发生的事情。在第二点上，我试图在两个几乎等效的用户 API 之间做出决定。

情况如下：

我正在构建一个科学应用程序，其中一个中央数据结构具有三个阶段：1）积累、2）分析和 3）查询执行。

在我的例子中，它是一种空间建模结构，在内部使用 KDTree 来划分 3 维空间中的点集合。每个点都描述了周围环境的一个或多个属性，对测量本身具有一定的置信度。

在向集合添加（可能大量）测量后，对象的所有者将查询它以获取适用字段内某处新数据点处的插值测量。

API 看起来像这样（代码是用 Java 编写的，但这并不重要；为清楚起见，代码分为三个部分）：

```
// SECTION 1:
// Create the aggregation object, and get the zillion objects to insert...
ContinuousScalarField field = new ContinuousScalarField();
Collection<Measurement> measurements = getMeasurementsFromSomewhere();

// SECTION 2:
// Add all of the zillion objects to the aggregation object...
// Each measurement contains its xyz location, the quantity being measured,
// and a numeric value for the measurement. For example, something like
// "68 degrees F, plus or minus 0.5, at point 1.23, 2.34, 3.45"
foreach (Measurement m : measurements) {
   field.add(m);
}

// SECTION 3:
// Now the user wants to ask the model questions about the interpolated
// state of the model. For example, "what's the interpolated temperature
// at point (3, 4, 5)
Point3d p = new Point3d(3, 4, 5);
Measurement result = field.interpolateAt(p); 
```

对于我的特定问题域，可以在第 2 节期间执行少量增量工作（将点划分为平衡的 KDTree）。

在第 3 节期间可能会发生少量工作（执行一些线性插值）。

但是在第 2 节和第 3 节**之间**必须执行大量工作（构建核密度估计器并执行快速高斯变换，使用泰勒级数和 Hermite 函数，但这完全是题外话） 。

有时在过去，我只是使用惰性求值来构造数据结构（在这种情况下，它会在第一次调用“interpolateAt”方法时），但是如果用户调用“field.add ()" 方法，我必须完全丢弃那些数据结构并从头开始。

在其他项目中，我要求用户显式调用“object.flip()”方法，从“附加模式”切换到“查询模式”。这样的设计的好处是用户可以更好地控制核心计算开始的确切时刻。但是对于 API 使用者来说，跟踪对象的当前模式可能会很麻烦。此外，在标准用例中，调用者在开始发出查询后永远不会向集合添加另一个值；数据聚合几乎总是完全在查询准备之前。

你们是如何设计这样的数据结构的？

您是否更喜欢让对象懒惰地执行其繁重的分析，当新数据进入集合时丢弃中间数据结构？或者您是否需要程序员显式地将数据结构从附加模式转换为查询模式？

你知道像这样的对象有什么命名约定吗？有没有我没有想到的模式？

* * *

编辑：

我在示例中使用的名为“ContinuousScalarField”的类似乎有些困惑和好奇。

通过阅读这些维基百科页面，您可以很好地了解我在说什么：

*   [http://en.wikipedia.org/wiki/Scalar_field](http://en.wikipedia.org/wiki/Scalar_field)

*   [http://en.wikipedia.org/wiki/Vector_field](http://en.wikipedia.org/wiki/Vector_field)

假设您想创建一个地形图（这不是我的确切问题，但在概念上非常相似）。因此，您在一平方英里的区域内进行了一千次高度测量，但您的测量设备在高度上的误差范围为正负 10 米。

一旦你收集了所有的数据点，你就可以将它们输入一个模型，该模型不仅可以插值，还可以考虑每次测量的误差。

要绘制地形图，您需要在模型中查询要绘制像素的每个点的高程。

至于单个类是否应该同时负责追加和处理查询的问题，我不是 100% 肯定，但我认为是的。

这是一个类似的示例：HashMap 和 TreeMap 类允许添加和查询对象。没有用于添加和查询的单独接口。

这两个类也与我的示例相似，因为必须持续维护内部数据结构以支持查询机制。HashMap 类必须定期分配新内存，重新散列所有对象，并将对象从旧内存移动到新内存。TreeMap 必须使用红黑树数据结构持续保持树平衡。

唯一的区别是，如果我的班级一旦知道数据集已关闭，它就可以执行所有计算，那么它将表现最佳。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T18:35:16.657

如果一个对象有两种这样的模式，我建议向客户端公开两个接口。如果对象处于附加模式，则确保客户端只能使用 IAppendable 实现。要切换到查询模式，请向 IAppendable 添加一个方法，例如 AsQueryable。要返回，请调用 IQueryable.AsAppendable。

您可以在同一个对象上实现 IAppendable 和 IQueryable，并在内部以相同的方式跟踪状态，但是有两个接口可以让客户端清楚地知道对象处于什么状态，并强制客户端故意使（昂贵） 转变。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T18:31:15.713

你的对象应该有一个角色和责任。在您的情况下，ContinuousScalarField 应该负责插值吗？

也许你最好做一些类似的事情：

```
IInterpolator interpolator = field.GetInterpolator();
Measurement measurement = Interpolator.InterpolateAt(...); 
```

我希望这是有道理的，但是如果不完全了解您的问题域，就很难给您一个更连贯的答案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T18:56:05.367

我通常更喜欢进行显式更改，而不是懒惰地重新计算结果。这种方法使实用程序的性能更加可预测，并且减少了我为提供良好的用户体验而必须做的工作量。例如，如果这发生在 UI 中，我在哪里需要担心弹出沙漏等？哪些操作会阻塞一段时间，并且需要在后台线程中执行？

也就是说，与其显式更改一个实例的状态，我建议使用[Builder 模式](http://en.wikipedia.org/wiki/Builder_pattern)来生成一个新对象。例如，您可能有一个聚合器对象，它在您添加每个样本时执行少量工作。`void flip()`然后，我将使用一种`Interpolator interpolator()`方法来获取当前聚合的副本并执行所有繁重的数学运算，而不是您提出的方法。您的`interpolateAt`方法将在这个新的 Interpolator 对象上。

如果您的使用模式允许，您可以通过保留对您创建的插值器的引用来进行简单的缓存，并将其返回给多个调用者，仅在修改聚合器时清除它。

这种职责分离有助于产生更多可维护和可重用的面向对象程序。`Measurement`可以在请求时返回 a 的对象`Point`是非常抽象的，也许很多客户可以使用您的 Interpolator 作为实现更通用接口的一种策略。

* * *

我认为您添加的类比具有误导性。考虑一个替代类比：

```
Key[] data = new Key[...];
data[idx++] = new Key(...); /* Fast! */
...
Arrays.sort(data); /* Slow! */
...
boolean contains = Arrays.binarySearch(data, datum) >= 0; /* Fast! */ 
```

这可以像一个集合一样工作，实际上，它比`Set`实现（使用哈希表或平衡树实现）提供更好的性能。

平衡树可以看作是插入排序的一种有效实现。每次插入后，树处于排序状态。平衡树的可预测时间要求是由于排序成本分布在每个插入上，而不是发生在某些查询上而不是其他查询上。

哈希表的重新散列确实会导致性能不一致，因此不适合某些应用程序（可能是实时微控制器）。但即使是重新散列操作也只取决于表的负载因子，而不是插入和查询操作的模式。

为了使您的类比严格成立，您必须对添加的每个点“排序”（做毛茸茸的数学）您的聚合器。但这听起来成本太高了，这导致了构建器或工厂方法模式。这让您的客户清楚地知道他们何时需要为冗长的“排序”操作做好准备。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T18:52:33.843

“我刚刚使用惰性求值来构造数据结构”——*很好*

“如果用户再次调用“field.add()”方法，我必须完全丢弃那些数据结构并从头开始。” ——*有趣*

“在标准用例中，调用者在开始发出查询后永远不会向集合添加另一个值”——*哎呀，误报，实际上并不有趣*。

由于惰性评估适合您的用例，请坚持使用。这是一个非常常用的模型，因为它非常可靠并且非常适合大多数用例。

重新考虑这一点的唯一原因是 (a) 用例更改（混合添加和插值），或 (b) 性能优化。

由于不太可能更改用例，因此您可能会考虑分解插值对性能的影响。例如，在空闲时间，您可以预先计算一些值吗？或者每次添加都有一个可以更新的摘要？

此外，一个高度有状态（并且不是很有意义）的`flip`方法对您的类的客户不是那么有用。但是，将插值分成两部分可能仍然对他们有所帮助——并帮助您进行优化和状态管理。

例如，您可以将插值分解为两种方法。

```
public void interpolateAt( Point3d p );
public Measurement interpolatedMasurement(); 
```

这借用了关系数据库 Open and Fetch 范式。打开游标可以做很多前期工作，可能会开始执行查询，你不知道。获取第一行可能会完成所有工作，或者执行准备好的查询，或者只是获取第一缓冲行。你真的不知道。你只知道这是一个两部分的操作。RDBMS 开发人员可以自由地进行他们认为合适的优化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-21T17:07:01.787

> 您是否更喜欢让对象懒惰地执行其繁重的分析，当新数据进入集合时丢弃中间数据结构？或者您是否需要程序员显式地将数据结构从附加模式转换为查询模式？

我更喜欢使用允许我通过每次添加“多做一点工作”来增量添加数据的数据结构，并通过每次提取“多做一点工作”来增量提取我需要的数据。

也许如果你在你所在区域的右上角进行一些“interpolate_at()”调用，你只需要对右上角的点进行计算，离开其他 3 个象限并没有什么坏处对新添加的内容“开放”。（等等递归KDTree）。

唉，这并不总是可能的——有时添加更多数据的唯一方法是丢弃所有以前的中间和最终结果，并从头开始重新计算所有内容。

使用我设计的界面的人——尤其是我——是人，容易犯错误。所以我不喜欢使用那些人们*必须*记住以某种方式做事的对象，否则就会出错——因为我总是忘记那些事情。

如果一个对象在从中获取数据之前*必须处于“计算后状态”，即在 interpolateAt() 函数获取有效数据之前**必须*运行一些“do_calculations()”函数，我更喜欢让 interpolateAt() 函数检查它是否已经处于该状态，运行“do_calculations()”并在必要时更新对象的状态，然后返回我预期的结果。

有时我听到人们将这样的数据结构描述为“冻结”数据或“结晶”数据或“编译”或“将数据放入不可变的数据结构”。一个示例是将（可变）StringBuilder 或 StringBuffer 转换为（不可变）String。

我可以想象，对于某些类型的分析，您希望提前获得*所有*数据，并且在所有数据放入之前提取一些插值会得到*错误*的结果。在这种情况下，我更愿意进行设置，以使“add_data()”函数在任何 interpolateAt() 调用之后（错误地）被调用时失败或抛出异常。

我会考虑定义一个延迟评估的“interpolated_point”对象，它不会立即*真正*评估数据，而只会告诉该程序将来某个时候需要该点的数据。集合实际上并没有被冻结，所以可以继续向它添加更多数据，直到某个点实际从某个“interpolated_point”对象中提取第一个实际值，该对象在内部触发“do_calculations()”函数并冻结目的。如果您不仅提前知道所有数据，还知道所有需要插值的点，它可能会加快速度。然后你可以扔掉离插值点“远”的数据，只在“近”区域做繁重的计算

对于其他类型的分析，您可以尽可能地利用现有数据，但是当以后有更多数据出现时，您希望在以后的分析中使用这些新数据。如果这样做的唯一方法是丢弃所有中间结果并从头开始重新计算所有内容，那么这就是您必须做的。（最好是对象自动处理这个问题，而不是要求人们记住每次都调用一些“clear_cache()”和“do_calculations()”函数）。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-29T18:35:52.100

你可以有一个状态变量。有一种启动高级处理的方法，该方法仅在状态位于 SECTION-1 时才有效。它将状态设置为 SECTION-2，然后在完成计算后设置为 SECTION-3。如果程序请求插入给定点，它将检查状态是否为 SECTION-3。如果不是，它将请求开始计算，然后插入给定的数据。

通过这种方式，您可以同时完成这两个任务 - 程序将在第一个插入点的请求时执行其计算，但也可以请求更早地执行此操作。如果您想在一夜之间运行计算，这将很方便，例如，不需要请求插值。

# sql - Access SQL 中的合并替代方案

> ID：247858
> 
> 赞同：34
> 
> 时间：2008-10-29T18:23:52.233
> 
> 标签：sql, ms-access

在 T-SQL 中，您可以这样做：

```
SELECT ProductId, COALESCE(Price, 0)
FROM Products 
```

你如何在 Access SQL 中做同样的事情？我在 VBA 中看到了使用 Nz 执行此操作的示例，但我正在寻找 SQL 等价物。

谢谢。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-29T18:27:45.050

Access 支持该`Nz`功能并允许您在查询中使用它。请注意，`Nz`这与 T-SQL`ISNULL`函数相同。它不能像 can 那样采用任意数量的参数`COALESCE`。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-29T18:28:15.673

如果它在 Access 查询中，你可以试试这个：

```
"Price = IIf([Price] Is Null,0,[Price])" 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-29T18:29:07.573

看起来我可以使用：

```
SELECT ProductId, Nz(Price, 0)
FROM Products 
```

似乎工作得很好。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-11-09T13:37:58.853

使用`Iif(Price is null, 0, Price)`应该会给您最好的性能（请参阅[Allen Browne 的性能提示](http://allenbrowne.com/QueryPerfIssue.html)）。然而，SQL Server`Coalesce()`有一个很大的优势`Iif()`，`Nz()`它可以级联处理多个参数。所以我创建了这个快速的 VBA 等效项：

```
Function Coalesce(ParamArray varValues()) As Variant
'returns the first non null value, similar to SQL Server Coalesce() function
'Patrick Honorez --- www.idevlop.com
    Dim i As Long
    Coalesce = Null
    For i = LBound(varValues) To UBound(varValues)
        If Not IsNull(varValues(i)) Then
            Coalesce = varValues(i)
            Exit Function
        End If
    Next
End Function 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-29T15:45:28.850

使用`IsNull()`、`Nz()`和 数据转换函数是内置的 VBA 函数，只会在 2003 年之前的版本中减慢您的查询速度。就数据类型而言`CCur()`，用于保证您的数据类型，但前提是您需要进行强比较或只是简单地进行比较将列上的格式属性设置为货币。最慢的是 IF 语句，因为它为您的例程添加了另一个功能

使用此解决方案：`Nz([Price], CCur(0))`

唯一`CCur()`会执行的时间是价格为空的时候，所以总的来说这可能是最快的。

关键是*使用的总函数数量越少*，查询执行的速度就越快。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2014-12-30T23:53:34.043

COALESCE 或 NULLIF 函数是 sql server 上用于良好迁移访问的标准。ISNULL 或 IIF 或 CHOOSE 是非标准函数。

# integer - 有符号整数与无符号整数

> ID：247873
> 
> 赞同：429
> 
> 时间：2008-10-29T18:28:18.387
> 
> 标签：integer, unsigned, signed

我是否正确地说有符号整数和无符号整数之间的区别是：

1.  无符号可以持有更大的正值，没有负值。
2.  无符号使用前导位作为值的一部分，而有符号版本使用最左边的位来识别数字是正数还是负数。
3.  有符号整数可以同时包含正数和负数。

还有其他区别吗？

* * *

## 回答 #1

> 赞同：370
> 
> 时间：2008-10-29T18:31:36.740

> 无符号可以持有更大的正值，没有负值。

是的。

> 无符号使用前导位作为值的一部分，而有符号版本使用最左边的位来识别数字是正数还是负数。

有不同的表示有符号整数的方法。最容易可视化的是使用最左边的位作为标志（[符号和幅度](https://en.wikipedia.org/wiki/Signed_number_representations#Signed_magnitude_representation)），但更常见[的是二进制补码](http://en.wikipedia.org/wiki/Twos_complement)。两者都在大多数现代微处理器中使用——浮点使用符号和幅度，而整数运算使用二进制补码。

> 有符号整数可以同时包含正数和负数。

是的。

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2008-11-19T08:12:53.570

我将在 x86 上讨论硬件级别的差异。除非您正在编写编译器或使用汇编语言，否则这几乎无关紧要。但很高兴知道。

首先，x86*原生*支持有符号数[的二进制补码](http://en.wikipedia.org/wiki/Twos_complement)表示。您可以使用其他表示，但这需要更多指令，并且通常会浪费处理器时间。

“本地支持”是什么意思？基本上我的意思是有一组用于无符号数字的指令和另一组用于有符号数字的指令。无符号数可以与有符号数位于相同的寄存器中，实际上您可以混合有符号和无符号指令而不必担心处理器。由编译器（或汇编程序员）来跟踪数字是否有符号，并使用适当的指令。

首先，二进制补码具有加减法与无符号数相同的性质。数字是正数还是负数都没有区别。（所以你只要继续前进，`ADD`你`SUB`的数字就不用担心了。）

当进行比较时，差异开始显现。x86 有一种区分它们的简单方法：上方/下方表示无符号比较，大于/小于表示有符号比较。（例如`JAE`，表示“如果高于或等于则跳转”并且是无符号的。）

还有两组乘法和除法指令来处理有符号和无符号整数。

最后：如果你想检查溢出，你会对有符号数和无符号数做不同的检查。

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2014-05-15T07:07:23.343

他只问签名和未签名。不知道为什么人们要在其中添加额外的东西。让我告诉你答案。

1.  无符号：它仅包含非负值，即 0 到 255。

2.  签名：它由负值和正值组成，但格式不同，例如

    *   0 至 +127
    *   -1 到 -128

这个解释是关于8位数字系统的。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2016-01-26T23:19:31.710

根据我们在课堂上学到的知识，有符号整数可以表示正数*和*负数，而无符号整数*只能*表示非负数。

例如，查看一个**8 位**数字：

*`0`无*符号*值`255`*

 **有符号*值范围从`-128`到`127`

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-10-29T19:11:52.183

为了完整起见，请注意几点：

*   这个答案只讨论整数表示。浮点数可能还有其他答案；

*   负数的表示可以变化。今天使用的最常见的（到目前为止 - 它在今天几乎是普遍的）是**二进制补码**。其他表示包括**一个补码**（非常罕见）和有**符号幅度**（非常罕见 - 可能仅用于博物馆作品），它们只是使用高位作为符号指示符，其余位表示数字的绝对值。

*   使用二进制补码时，该变量可以表示比正数更大的负数范围（乘一）。这是因为零包含在“正”数中（因为符号位未设置为零），而不是负数。这意味着不能表示最小负数的绝对值。

*   当使用一个补码或有符号幅度时，您可以将零表示为正数或负数（这是通常不使用这些表示的几个原因之一）。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-10-29T18:31:18.210

除了第 2 点之外的一切都是正确的。有符号整数有许多不同的表示法，一些实现使用第一个，其他使用最后一个，还有一些使用完全不同的东西。这一切都取决于您正在使用的平台。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2011-04-29T06:57:41.933

另一个区别是当您在不同大小的整数之间进行转换时。

例如，如果您要从字节流中提取一个整数（为简单起见说 16 位），使用无符号值，您可以这样做：

```
i = ((int) b[j]) << 8 | b[j+1] 
```

*（可能应该^(转换第二)个字节，但我猜编译器会做正确的事情）*

使用带符号的值，您将不得不担心符号扩展并执行以下操作：

```
i = (((int) b[i]) & 0xFF) << 8 | ((int) b[i+1]) & 0xFF 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-29T18:43:52.647

除了其他人所说的之外，在 C 中，您不能溢出无符号整数。该行为被定义为模算术。您可以溢出一个有符号整数，理论上（尽管在当前主流系统上不是实践中），溢出可能会触发错误（可能类似于除以零错误）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-04-25T22:33:55.487

Signed integers in C represent numbers. If `a` and `b` are variables of signed integer types, the standard will never require that a compiler make the expression `a+=b` store into `a` anything other than the arithmetic sum of their respective values. To be sure, if the arithmetic sum would not fit into `a`, the processor *might* not be able to put it there, but the standard would not require the compiler to truncate or wrap the value, or do anything else for that matter if values that exceed the limits for their types. Note that while the standard does not require it, C implementations are allowed to trap arithmetic overflows with signed values.

Unsigned integers in C behave as abstract algebraic rings of integers which are congruent modulo some power of two, except in scenarios involving conversions to, or operations with, larger types. Converting an integer of *any* size to a 32-bit unsigned type will yield the member corresponding to things which are congruent to that integer mod 4,294,967,296\. The reason subtracting 3 from 2 yields 4,294,967,295 is that adding something congruent to 3 to something congruent to 4,294,967,295 will yield something congruent to 2.

Abstract algebraic rings types are often handy things to have; unfortunately, C uses signedness as the deciding factor for whether a type should behave as a ring. Worse, unsigned values are treated as numbers rather than ring members when converted to larger types, and unsigned values smaller than `int` get converted to numbers when any arithmetic is performed upon them. If `v` is a `uint32_t` which equals `4,294,967,294`, then `v*=v;` should make `v=4`. Unfortunately, if `int` is 64 bits, then there's no telling what `v*=v;` could do.

Given the standard as it is, I would suggest using unsigned types in situations where one wants the behavior associated with algebraic rings, and signed types when one wants to represent numbers. It's unfortunate that C drew the distinctions the way it did, but they are what they are.

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-29T18:30:24.560

一般来说，这是正确的。在不了解您为什么要寻找差异的更多信息的情况下，我想不出有符号和无符号之间的任何其他区别。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-29T18:35:47.887

（回答第二个问题）仅使用符号位（而不是 2 的补码），您可以得到 -0。不是很漂亮。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-04-25T09:45:26.583

1.  是的，无符号整数可以存储大值。
2.  不，有不同的方式来显示正值和负值。
3.  是的，有符号整数可以包含正值和负值。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-02-04T21:35:53.970

无符号整数比有符号整数更容易让你陷入特定的陷阱。陷阱来自这样一个事实，虽然上面的 1 和 3 是正确的，但两种类型的整数都可以被*分配*一个超出它可以“持有”的范围的值，并且它将被静默转换。

```
unsigned int ui = -1;
signed int si = -1;

if (ui < 0) {
    printf("unsigned < 0\n");
}
if (si < 0) {
    printf("signed < 0\n");
}
if (ui == si) {
    printf("%d == %d\n", ui, si);
    printf("%ud == %ud\n", ui, si);
} 
```

当你运行它时，即使这两个值都被赋值为 -1 并且声明不同，你也会得到以下输出。

```
signed < 0
-1 == -1
4294967295d == 4294967295d 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-07-12T01:58:38.180

C 中有符号和无符号值之间唯一*保证*的区别是有符号值可以是负数、0 或正数，而无符号数只能是 0 或正数。问题是 C 没有定义类型的格式（所以你不*知道*你的整数是二进制补码）。严格来说，你提到的前两点是不正确的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-01-14T19:47:49.127

在嵌入式系统上编程时必须使用无符号整数。在循环中，当不需要有符号整数时，使用无符号整数将节省设计此类系统所需的安全性。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-01-08T22:50:49.867

我在这方面找到的最佳答案是[IBM](https://www.ibm.com/docs/en/aix/7.1?topic=types-signed-unsigned-integers)引用了[XDR 标准](http://osr507doc.sco.com/en/netguide/dnfsC.xdrstand.html)：

> **整数**
> 
> XDR 有符号整数是一段 32 位数据，它对 [-2147483648,2147483647] 范围内的整数进行编码。整数以二进制补码表示。最高和最低有效字节分别是 0 和 3。整数的数据描述是整数。
> 
> **无符号整数**
> 
> XDR 无符号整数是一段 32 位数据，它对 [0,4294967295] 范围内的非负整数进行编码。它由一个无符号二进制数表示，其最高和最低有效字节分别为 0 和 3。无符号整数的数据描述是无符号的。

参见[维基百科](https://en.wikipedia.org/wiki/External_Data_Representation)上的**XDR 标准**

# .net - .NET 紧凑框架中何时分配内存？

> ID：247875
> 
> 赞同：1
> 
> 时间：2008-10-29T18:28:35.797
> 
> 标签：.net, memory, compact-framework

.NET 紧凑框架中何时分配内存？如果值类型和引用类型之间存在差异，请详细说明。文件或确认步骤表示赞赏。

特别是，考虑这种情况......

```
private MyClass item;  // here?

public void MyMethod()
{
    item = new MyClass();  // or here?
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T18:33:11.230

内存分配有 3 种不同的方式。

**静止的：**

这些是在编译时绑定和分配的。例如全局静态变量。

**堆栈动态：**

这些在运行时绑定并推送到堆栈上。比如函数调用中的局部变量。

**堆动态：**

现在堆动态也有一些不同的“子类别”，例如隐式和显式，但我不会详细介绍。

当你声明

```
private MyClass item;  // here? 
```

对 MyClass 的引用被压入堆栈。它只是一个参考，仅此而已。那时它的值为空。

```
public void MyMethod()
{
    item = new MyClass();  // or here?
} 
```

正是在这一点上，通过调用“new MyClass()”在堆上显式分配内存，然后 item 引用它。

所以实际上，在你调用 MyMethod 之后你有 2 个变量。一个名为 item 的引用类型，以及堆上的一个未命名变量，item 引用了 MyClass 类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T18:39:31.017

这是一个棘手的问题，这让我比我想象的更喜欢它。:)

让我们从基础开始：

声明一个变量不会直接为它在引用类型上分配内存*。它**确实**在值类型上这样做，因为值类型在声明点被初始化。对于引用类型，对象的存储空间是在进入其构造函数时分配的。

*什么时候不适用？

*   在给定类的第一次使用（很可能是您的第一行）时，任何类级别的静态数据都会被初始化，如果该类有一个静态构造函数（它可能会分配内存），它也会被调用。因此，您实际上可以在变量声明中分配一些内存（用于静态成员）。
*   从技术上讲，声明您的引用类型变量**确实**在堆栈上分配了一些内存（正如 Nicholas Mancuso 所提到的） - 分配的内存是对对象的引用的堆栈级存储。（不可否认，所说的引用是`null`，但是一旦你初始化你的对象，一个有效的引用就会存在于分配的内存中。）

我强烈推荐这篇关于堆栈和堆分配的[C-Sharp Corner 文章以获取更多信息。](http://www.c-sharpcorner.com/UploadFile/rmcochran/csharp_memory01122006130034PM/csharp_memory.aspx?ArticleID=9adb0e3c-b3f6-40b5-98b5-413b6d348b91)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T23:21:04.287

我强烈建议您查看有关[Compact Framework 内存管理](https://msevents.microsoft.com/cui/WebCastRegistrationConfirmation.aspx?culture=en-US&RegistrationID=1299365950&Validate=false)的 MSDN Webcase 。它与在桌面上的工作方式并不完全相同，本次演讲涵盖了很多细节和图形，以帮助理解 GC 堆。

# svn - 如何在 VisualSVN 服务器中要求提交消息？

> ID：247888
> 
> 赞同：49
> 
> 时间：2008-10-29T18:30:50.410
> 
> 标签：svn, notifications, hook, visualsvn-server, svn-hooks

我们已经将 VisualSVN 服务器设置为 Windows 上的 Subversion 服务器，并且我们使用 Ankhsvn + TortoiseSVN 作为工作站上的客户端。

如何配置服务器以要求提交消息为非空？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-08-12T14:18:56.210

我很高兴你问了这个问题。[这是我们用常见的Windows Batch](http://en.wikipedia.org/wiki/Windows_batch_file)编写的预提交钩子脚本。如果日志消息少于 6 个字符，则拒绝提交。只需将*pre-commit.bat 放入*您的 hooks 目录即可。

***预提交.bat***

```
setlocal enabledelayedexpansion

set REPOS=%1
set TXN=%2

set SVNLOOK="%VISUALSVN_SERVER%\bin\svnlook.exe"

SET M=

REM Concatenate all the lines in the commit message
FOR /F "usebackq delims==" %%g IN (`%SVNLOOK% log -t %TXN% %REPOS%`) DO SET M=!M!%%g

REM Make sure M is defined
SET M=0%M%

REM Here the 6 is the length we require
IF NOT "%M:~6,1%"=="" goto NORMAL_EXIT

:ERROR_TOO_SHORT
echo "Commit note must be at least 6 letters" >&2
goto ERROR_EXIT

:ERROR_EXIT
exit /b 1

REM All checks passed, so allow the commit.
:NORMAL_EXIT
exit 0 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-10-29T18:36:45.093

VisualSVN Server 3.9 提供了`VisualSVNServerHooks.exe check-logmessage`pre-commit 钩子，可以帮助您拒绝带有空或短日志消息的提交。有关说明，请参阅文章[KB140：验证 VisualSVN 服务器](https://www.visualsvn.com/support/topic/00140/)中的提交日志消息。

除了内置的`VisualSVNServerHooks.exe`，VisualSVN Server 和 SVN 通常使用[许多钩子](http://www.visualsvn.com/support/svnbook/ref/reposhooks/)来完成这样的任务。

*   [`start-commit`](http://www.visualsvn.com/support/svnbook/ref/reposhooks/start-commit/)— 在提交事务开始之前运行，可用于进行特殊权限检查
*   [`pre-commit`](http://www.visualsvn.com/support/svnbook/ref/reposhooks/pre-commit/)— 在事务结束时运行，但在提交之前。通常用于验证诸如非零长度日志消息之类的内容。
*   [`post-commit`](http://www.visualsvn.com/support/svnbook/ref/reposhooks/post-commit/)— 在事务提交后运行。可用于发送电子邮件或备份存储库。
*   [`pre-revprop-change`](http://www.visualsvn.com/support/svnbook/ref/reposhooks/pre-revprop-change/)— 在修订属性更改之前运行。可用于检查权限。
*   [`post-revprop-change`](http://www.visualsvn.com/support/svnbook/ref/reposhooks/post-revprop-change/)— 在修订属性更改后运行。可用于通过电子邮件发送或备份这些更改。

你需要使用`pre-commit`钩子。您可以用您的平台支持的几乎任何语言自己编写它，但网络上有许多脚本。谷歌搜索“svn precommit hook to require comment”我发现一对看起来很符合要求的夫妇：

*   [Perl 脚本](http://www.stillnetstudios.com/2008/06/16/require-subversion-comments-minimum/)
*   [Python 脚本](http://tarekziade.wordpress.com/2006/11/01/protecting-a-python-svn-code-base-with-the-pre-commit-hook/)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-29T18:46:58.037

您的问题的技术答案已经给出。我想添加社交答案，即：“通过与您的团队建立提交消息标准并让他们同意（或接受）需要*表达性*提交消息的原因”

我见过很多提交信息，上面写着“patch”、“typo”、“fix”或类似的东西，我已经记不清了。

真的 - 让每个人都清楚你为什么需要它们。

原因示例如下：

*   **生成的变更说明**（嗯 - 如果我知道它们将（以我的名字）公开可见 - 如果只对团队来说，这实际上会成为一个很好的自动工具来强制执行好的消息）
*   **许可证问题**：您以后可能需要知道代码的来源，例如，如果您想更改代码的许可证（有些组织甚至有提交消息格式的标准 - 好吧，您可以自动检查这一点，但您会不一定会得到*好的*提交消息）
*   **与其他工具的互操作性**，例如与您的版本控制交互并从提交消息中提取信息的错误跟踪器/问题管理系统。

除了关于预提交钩子的技术答案之外，希望对您有所帮助。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-07-19T12:08:25.650

这是一个两部分示例**Batch + PowerShell**预提交钩子，它拒绝提交少于 25 个字符的日志消息。

将两者都**`pre-commit.bat`**放入**`pre-commit.ps1`**您的存储库**`hooks`**文件夹中，例如`C:\Repositories\repository\hooks\`

***预提交.ps1***

```
# Store hook arguments into variables with mnemonic names
$repos    = $args[0]
$txn      = $args[1]

# Build path to svnlook.exe
$svnlook = "$env:VISUALSVN_SERVER\bin\svnlook.exe"

# Get the commit log message
$log = (&"$svnlook" log -t $txn $repos)

# Check the log message contains non-empty string
$datalines = ($log | where {$_.trim() -ne ""})
if ($datalines.length -lt 25)
{
  # Log message is empty. Show the error.
  [Console]::Error.WriteLine("Commit with empty log message is prohibited.")
  exit 3
}

exit 0 
```

***预提交.bat***

```
@echo off
set PWSH=%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe
%PWSH% -command $input ^| %1\hooks\pre-commit.ps1 %1 %2
if errorlevel 1 exit %errorlevel% 
```

注1：`pre-commit.bat`是唯一可以被VisualSVN调用的，然后`pre-commit.ps1`是被调用的`pre-commit.bat`。

注2：`pre-commit.bat`也可命名`pre-commit.cmd`。

注意 3：如果您尝试使用一些重音字符和输出进行编码问题，则在.`[Console]::Error.WriteLine`之后添加例如下一行。`chcp 1252``pre-commit.bat``@echo off`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-30T09:01:38.467

VisualSVN 为您提供作为钩子输入的是“Windows NT 命令脚本”，它们基本上是批处理文件。

在批处理文件中编写 if-then-else 非常难看，而且可能很难调试。

它看起来像下面这样（搜索 pre-commit.bat）（未测试）：

```
SVNLOOK.exe log -t "%2" "%1" | grep.exe "[a-zA-Z0-9]" > nul || GOTO ERROR
GOTO OK
:ERROR
ECHO "Please enter comment and then retry commit!"
exit 1
:OK
exit 0 
```

您需要一个 grep.exe 在路径上，%1 是此存储库的路径，%2 是即将提交的 txn 的名称。还可以查看存储库 hooks 目录中的 pre-commit.tmpl。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-10-11T21:32:31.167

我们将优秀的[CS-Script](http://www.csscript.net/)工具用于我们的预提交钩子，以便我们可以用我们正在开发的语言编写脚本。这是一个确保提交消息长度超过 10 个字符的示例，并确保 .suo 和.user 文件未签入。您还可以测试制表符/空格缩进，或在签入时执行小代码标准，但要小心让您的脚本做太多，因为您不想减慢提交速度.

```
// run from pre-commit.cmd like so:
// css.exe /nl /c C:\SVN\Scripts\PreCommit.cs %1 %2
using System;
using System.Diagnostics;
using System.Text;
using System.Text.RegularExpressions;
using System.Linq;

class PreCommitCS {

  /// <summary>Controls the procedure flow of this script</summary>
  public static int Main(string[] args) {
    if (args.Length < 2) {
      Console.WriteLine("usage: PreCommit.cs repository-path svn-transaction");
      Environment.Exit(2);
    }

    try {
      var proc = new PreCommitCS(args[0], args[1]);
      proc.RunChecks();
      if (proc.MessageBuffer.ToString().Length > 0) {
        throw new CommitException(String.Format("Pre-commit hook violation\r\n{0}", proc.MessageBuffer.ToString()));
      }
    }
    catch (CommitException ex) {
      Console.WriteLine(ex.Message);
      Console.Error.WriteLine(ex.Message);
      throw ex;
    }
    catch (Exception ex) {
      var message = String.Format("SCRIPT ERROR! : {1}{0}{2}", "\r\n", ex.Message, ex.StackTrace.ToString());
      Console.WriteLine(message);
      Console.Error.WriteLine(message);
      throw ex;
    }

    // return success if we didn't throw
    return 0;
  }

  public string RepoPath { get; set; }
  public string SvnTx { get; set; }
  public StringBuilder MessageBuffer { get; set; }

  /// <summary>Constructor</summary>
  public PreCommitCS(string repoPath, string svnTx) {
    this.RepoPath = repoPath;
    this.SvnTx = svnTx;
    this.MessageBuffer = new StringBuilder();
  }

  /// <summary>Main logic controller</summary>
  public void RunChecks() {
    CheckCommitMessageLength(10);

    // Uncomment for indent checks
    /*
    string[] changedFiles = GetCommitFiles(
      new string[] { "A", "U" },
      new string[] { "*.cs", "*.vb", "*.xml", "*.config", "*.vbhtml", "*.cshtml", "*.as?x" },
      new string[] { "*.designer.*", "*.generated.*" }
    );
    EnsureTabIndents(changedFiles);
    */

    CheckForIllegalFileCommits(new string[] {"*.suo", "*.user"});
  }

  private void CheckForIllegalFileCommits(string[] filesToExclude) {
    string[] illegalFiles = GetCommitFiles(
      new string[] { "A", "U" },
      filesToExclude,
      new string[] {}
    );
    if (illegalFiles.Length > 0) {
      Echo(String.Format("You cannot commit the following files: {0}", String.Join(",", illegalFiles)));
    }
  }

  private void EnsureTabIndents(string[] filesToCheck) {
    foreach (string fileName in filesToCheck) {
      string contents = GetFileContents(fileName);
      string[] lines = contents.Replace("\r\n", "\n").Replace("\r", "\n").Split(new string[] { "\n" }, StringSplitOptions.None);
      var linesWithSpaceIndents =
        Enumerable.Range(0, lines.Length)
             .Where(i => lines[i].StartsWith(" "))
             .Select(i => i + 1)
             .Take(11)
             .ToList();
      if (linesWithSpaceIndents.Count > 0) {
        var message = String.Format("{0} has spaces for indents on line(s): {1}", fileName, String.Join(",", linesWithSpaceIndents));
        if (linesWithSpaceIndents.Count > 10) message += "...";
        Echo(message);
      }
    }
  }

  private string GetFileContents(string fileName) {
    string args = GetSvnLookCommandArgs("cat") + " \"" + fileName + "\"";
    string svnlookResults = ExecCmd("svnlook", args);
    return svnlookResults;
  }

  private void CheckCommitMessageLength(int minLength) {
    string args = GetSvnLookCommandArgs("log");
    string svnlookResults = ExecCmd("svnlook", args);
    svnlookResults = (svnlookResults ?? "").Trim();
    if (svnlookResults.Length < minLength) {
      if (svnlookResults.Length > 0) {
        Echo("Your commit message was too short.");
      }
      Echo("Please describe the changes you've made in a commit message in order to successfully commit. Include support ticket number if relevant.");
    }
  }

  private string[] GetCommitFiles(string[] changedIds, string[] includedFiles, string[] exclusions) {
    string args = GetSvnLookCommandArgs("changed");
    string svnlookResults = ExecCmd("svnlook", args);
    string[] lines = svnlookResults.Split(new string[] { "\r", "\n" }, StringSplitOptions.RemoveEmptyEntries);
    var includedPatterns = (from a in includedFiles select ConvertWildcardPatternToRegex(a)).ToArray();
    var excludedPatterns = (from a in exclusions select ConvertWildcardPatternToRegex(a)).ToArray();
    var opts = RegexOptions.IgnoreCase;
    var results =
      from line in lines
      let fileName = line.Substring(1).Trim()
      let changeId = line.Substring(0, 1).ToUpper()
      where changedIds.Any(x => x.ToUpper() == changeId)
      && includedPatterns.Any(x => Regex.IsMatch(fileName, x, opts))
      && !excludedPatterns.Any(x => Regex.IsMatch(fileName, x, opts))
      select fileName;
    return results.ToArray();
  }

  private string GetSvnLookCommandArgs(string cmdType) {
    string args = String.Format("{0} -t {1} \"{2}\"", cmdType, this.SvnTx, this.RepoPath);
    return args;
  }

  /// <summary>
  /// Executes a command line call and returns the output from stdout.
  /// Raises an error is stderr has any output.
  /// </summary>
  private string ExecCmd(string command, string args) {
    Process proc = new Process();
    proc.StartInfo.FileName = command;
    proc.StartInfo.Arguments = args;
    proc.StartInfo.UseShellExecute = false;
    proc.StartInfo.CreateNoWindow = true;
    proc.StartInfo.RedirectStandardOutput = true;
    proc.StartInfo.RedirectStandardError = true;
    proc.Start();

    var stdOut = proc.StandardOutput.ReadToEnd();
    var stdErr = proc.StandardError.ReadToEnd();

    proc.WaitForExit(); // Do after ReadToEnd() call per: http://chrfalch.blogspot.com/2008/08/processwaitforexit-never-completes.html

    if (!string.IsNullOrWhiteSpace(stdErr)) {
      throw new Exception(string.Format("Error: {0}", stdErr));
    }

    return stdOut;
  }

  /// <summary>
  /// Writes the string provided to the Message Buffer - this fails
  /// the commit and this message is presented to the comitter.
  /// </summary>
  private void Echo(object s) {
    this.MessageBuffer.AppendLine((s == null ? "" : s.ToString()));
  }

  /// <summary>
  /// Takes a wildcard pattern (like *.bat) and converts it to the equivalent RegEx pattern
  /// </summary>
  /// <param name="wildcardPattern">The wildcard pattern to convert.  Syntax similar to VB's Like operator with the addition of pipe ("|") delimited patterns.</param>
  /// <returns>A regex pattern that is equivalent to the wildcard pattern supplied</returns>
  private string ConvertWildcardPatternToRegex(string wildcardPattern) {
    if (string.IsNullOrEmpty(wildcardPattern)) return "";

    // Split on pipe
    string[] patternParts = wildcardPattern.Split('|');

    // Turn into regex pattern that will match the whole string with ^$
    StringBuilder patternBuilder = new StringBuilder();
    bool firstPass = true;
    patternBuilder.Append("^");
    foreach (string part in patternParts) {
      string rePattern = Regex.Escape(part);

      // add support for ?, #, *, [...], and [!...]
      rePattern = rePattern.Replace("\\[!", "[^");
      rePattern = rePattern.Replace("\\[", "[");
      rePattern = rePattern.Replace("\\]", "]");
      rePattern = rePattern.Replace("\\?", ".");
      rePattern = rePattern.Replace("\\*", ".*");
      rePattern = rePattern.Replace("\\#", "\\d");

      if (firstPass) {
        firstPass = false;
      }
      else {
        patternBuilder.Append("|");
      }
      patternBuilder.Append("(");
      patternBuilder.Append(rePattern);
      patternBuilder.Append(")");
    }
    patternBuilder.Append("$");

    string result = patternBuilder.ToString();
    if (!IsValidRegexPattern(result)) {
      throw new ArgumentException(string.Format("Invalid pattern: {0}", wildcardPattern));
    }
    return result;
  }

  private bool IsValidRegexPattern(string pattern) {
    bool result = true;
    try {
      new Regex(pattern);
    }
    catch {
      result = false;
    }
    return result;
  }
}

public class CommitException : Exception {
  public CommitException(string message) : base(message) {
  }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-20T18:42:06.803

在 Windows 上使用此预提交挂钩。它是用 Windows Batch 编写的，并使用[grep](http://en.wikipedia.org/wiki/Grep)命令行实用程序来检查提交长度。

```
svnlook log -t "%2" "%1" | c:\tools\grep -c "[a-zA-z0-9]" > nul
if %ERRORLEVEL% NEQ 1 exit 0

echo Please enter a check-in comment 1>&2
exit 1 
```

请记住，您需要一份 grep 副本，我推荐使用[gnu 工具版本](http://unxutils.sourceforge.net/)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-08-04T15:15:02.477

这是一个 Windows Shell JScript，您可以通过将钩子指定为：

```
%SystemRoot%\System32\CScript.exe //nologo <..path..to..script> %1 %2 
```

它很容易阅读，所以请继续进行实验。

顺便说一句，在 JScript 中这样做的原因是它不依赖于安装任何其他工具（Perl、CygWin 等）。

```
if (WScript.Arguments.Length < 2)
{
    WScript.StdErr.WriteLine("Repository Hook Error: Missing parameters. Should be REPOS_PATH then TXN_NAME, e.g. %1 %2 in pre-commit hook");
    WScript.Quit(-1);
}

var oShell = new ActiveXObject("WScript.Shell");
var oFSO = new ActiveXObject("Scripting.FileSystemObject");

var preCommitStdOut = oShell.ExpandEnvironmentStrings("%TEMP%\\PRE-COMMIT." + WScript.Arguments(1) + ".stdout");
var preCommitStdErr = oShell.ExpandEnvironmentStrings("%TEMP%\\PRE-COMMIT." + WScript.Arguments(1) + ".stderr");

var commandLine = "%COMSPEC% /C \"C:\\Program Files\\VisualSVN Server\\bin\\SVNLook.exe\" log -t ";

commandLine += WScript.Arguments(1);
commandLine += " ";
commandLine += WScript.Arguments(0);
commandLine += "> " + preCommitStdOut + " 2> " + preCommitStdErr;

// Run Synchronously, don't show a window
// WScript.Echo("About to run: " + commandLine);
var exitCode = oShell.Run(commandLine, 0, true);

var fsOUT = oFSO.GetFile(preCommitStdOut).OpenAsTextStream(1);
var fsERR = oFSO.GetFile(preCommitStdErr).OpenAsTextStream(1);

var stdout = fsOUT && !fsOUT.AtEndOfStream ? fsOUT.ReadAll() : "";
var stderr = fsERR && !fsERR.AtEndOfStream ? fsERR.ReadAll() : "";

if (stderr.length > 0)
{
    WScript.StdErr.WriteLine("Error with SVNLook: " + stderr);
    WScript.Quit(-2);
}

// To catch naught commiters who write 'blah' as their commit message

if (stdout.length < 5)
{
    WScript.StdErr.WriteLine("Please provide a commit message that describes why you've made these changes.");
    WScript.Quit(-3);
}

WScript.Quit(0); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-04-27T02:39:31.450

**注意：这只适用于 TortoiseSVN**

只需右键单击存储库的顶层。在上下文菜单中选择 TortoiseSVN，然后选择属性，以查看此对话框：

![在此处输入图像描述](https://i.stack.imgur.com/ebx2M.png)

单击右下角附近的新建按钮，然后选择日志大小。输入您希望提交和锁定所需的字符数（在下面的示例中为 10）。

![在此处输入图像描述](https://i.stack.imgur.com/sYSOr.png)

从您刚刚修改的顶级目录执行 Commit。现在，您的存储库要求所有用户在提交更改之前进行评论。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-19T14:20:20.163

在向我的服务器添加提交挂钩之前，我只是将 svnprops 分发给 TortoiseSVN 客户端。

因此，作为替代方案：

在 TortoiseSVN -> Properties 属性名称中 -`tsvn:logminsize`适当地添加/设置。

这当然不能保证在服务器上，因为客户端/用户可以选择不这样做，但如果你愿意，你可以分发 svnprops 文件。这样，用户不必设置自己的值 - 您可以将它们提供给所有用户。

这也适用于 bugtraq：设置以链接日志中的问题跟踪内容。

# visual-studio - Nunit 有免费的 Visual Studio 插件吗？

> ID：247900
> 
> 赞同：51
> 
> 时间：2008-10-29T18:34:17.063
> 
> 标签：visual-studio, unit-testing, nunit

我很便宜，不想为 ReSharper 或 TestDriven.NET 付费，是否有适用于 NUnit 的免费 Visual Studio 插件？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-10-29T18:38:02.063

您可以创建一个空白项目（例如选择控制台应用程序）并在项目的属性中选择 DEBUG 标签并选择“启动外部程序”。把Nunit的路径。然后，在开始选项中，命令行参数选择包含所有测试的 DLL（我的总是在 nunit\bin...）。然后选择“启用非托管代码调试”，你就可以在 VS 中启动项目，甚至可以一步步使用调试器。

这是一个免费的解决方案。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-29T18:36:35.017

现在您可以使用 Gallio：它是开源的。[www.gallio.org](http://www.gallio.org)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-29T19:00:10.507

顺便说一句，[TestDriven](http://www.testdriven.net/download.aspx)可以免费下载，如果是供个人使用或开源项目。

几天前，我不得不找到一种在 VS 中使用[.Net Reflector的方法，当我下载 TestDriven 时，它就自带了。](https://stackoverflow.com/questions/234043/how-to-make-reflector-an-addin-for-visual-studios)从来没有任何弹出窗口要求我付款。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-29T18:40:17.100

NUnit 实际上带有一个基本的集成运行器。不是很好，也不是很宣传，但除非查理拿出来，否则它应该在源头上。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-09-17T12:27:00.453

我知道这是一个老问题，但另一种方法是从工具菜单中添加一个外部工具来运行 nunit - 将参数设置为 $(TargetName)$(TargetExt) 并将初始目录设置为 $(ProjectDir)\bin \调试

看看这个[链接](http://rabiddatapros.wordpress.com/2008/11/29/unit-testing-with-nunit-in-visual-studio-2008/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-20T07:22:06.410

# 这是一个古老的问题，自从答案被接受以来，事情已经发生了变化。

* * *

您可以尝试[NCrunch](http://www.ncrunch.net/download.htm)自动或手动运行测试。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-09-05T17:34:27.293

如果您运行的是 Visual Studio 2012，则有一个由 NUnit 贡献者之一 Charlie Poole 编写的插件，该插件利用了新的 Visual Studio 单元测试插件。

*   [下载 VsTestAdapater](https://launchpad.net/nunit-vs-adapter) - 它也在扩展管理器中。

不幸的是，它还没有太多的分组选项，无论是运行/不运行 - 所以你不能按类、解决方案等进行分组。如果测试失败，它也不会向您显示任何堆栈跟踪，只是一个简单的绿色勾号或红色框和一条消息。

[![图像](https://i.stack.imgur.com/iNWmn.png)](https://i.stack.imgur.com/iNWmn.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-12-04T23:15:01.190

我没用过，但 NUnitit 是一个免费的 NUnit 的 Visual Studio 插件。

[http://nunitit.codeplex.com](http://nunitit.codeplex.com)

根据我的经验，Visual Studio 的最佳插件是 resharper。TestDriven.Net 也适用于单元测试。希望有帮助

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-23T11:52:07.367

还发现了这个：http: [//visualstudiogallery.msdn.microsoft.com/c8164c71-0836-4471-80ce-633383031099](http://visualstudiogallery.msdn.microsoft.com/c8164c71-0836-4471-80ce-633383031099)
它能够在调试器中启动您的测试，但是每次更改某些内容时都需要手动重新编译代码 -没有自动运行构建集成

# sql-server - 如何将 SQL Server 2005 数据库从生产复制到开发？

> ID：247901
> 
> 赞同：2
> 
> 时间：2008-10-29T18:34:18.717
> 
> 标签：sql-server, sql-server-2005

我们有一个生产 SQL Server 2005 数据库服务器，上面有我们应用程序数据库的生产版本。我希望能够将生产数据库的数据内容复制到开发服务器进行测试。

几个站点（和 Microsoft 的论坛）建议使用备份/恢复选项从一台服务器复制数据库，但由于多种原因，此解决方案不可行（我对我们的生产数据库没有备份权限，我不想覆盖开发服务器上的权限，我不想覆盖开发服务器上的结构更改等...）

我曾尝试在 SQL Server 2005 中使用 SQL 导入/导出向导，但它总是报告主键违规。如何在不使用“备份/恢复”方法的情况下将数据库的内容从生产服务器复制到开发服务器？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T18:37:18.337

好吧，如果没有适当的权利，它确实变得更加乏味和不理想。

我推荐的一种方法是删除所有约束和索引，然后在导入/导出数据后再次添加它们。

不是一个优雅的解决方案，但它会处理得非常快。

编辑：另一种选择是创建一个 SSIS 包，您可以在其中专门以不违反约束的顺序转储表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T18:44:21.473

我经常使用 SQL 数据比较 ( [http://www.red-gate.com/products/sql_data_compare/index.htm](http://www.red-gate.com/products/sql_data_compare/index.htm) ) 来完成这项任务：它编写的同步脚本将在传输过程中删除关系并重新应用它们，但那是在大多数开发案例中都可以。它特别适用于较小的数据库或数据库子集。

如果您的数据库很大，我建议您找一个拥有王国钥匙的人。进行无序备份可能会干扰从主备份恢复数据库的能力（例如，如果他们在一周内进行部分备份），因为它们仅在备份中标记了已备份的记录*，*所以不要尝试如果您不确定它为什么存在，请绕过该安全性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T19:21:23.740

假设您可以从同一台机器连接到两个数据库（几乎总是可以 - 我通过 VPN 使用我的生产服务器进行连接）。

对于每张桌子

```
DELETE FROM devserv.dbo.tablename;
SET identity_insert [devserv.dbo.tablename] ON;
INSERT into devserv.dbo.tablename SELECT * from prodserv.dbo.tablename;
SET identity_insert [devname.dbo.tablename] OFF; 
```

显然值得注意的是，如果您的表具有外键约束，您将需要按特定顺序执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T18:57:04.817

导入/导出向导因这类事情而臭名昭著，实际上有一个错误，使得它在解决依赖关系时变得更无用（抱歉，手头没有详细信息）。

SSIS 做得更好，但您必须手动添加每个表复制任务（实际上是数据源、复制任务和数据目标对象。设置起来有点乏味（比它应该的要多），但是比编写自己的代码要简单得多。

一个提示：*避免*使用导入/导出向导生成 SSIS 项目，认为调整它会更容易。它会产生大多数人会觉得无法识别的东西，即使有一些 SSIS 经验！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T14:48:37.003

如果您在生产服务器上没有备份权限，我猜这是因为您使用的是来自 webhoster 的共享 SQL Server。在这种情况下，请检查您的虚拟主机是否提供名为[myLittleBackup](http://www.mylittlebackup.com)的工具。它允许单击几下将数据库从一台服务器安装到另一台服务器......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T18:38:13.373

我会联系有权备份数据库的人。权限*通常是*有原因的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T15:35:13.413

我可能会考虑进行备份，因为无论您是否运行它都会有一个备份（至少在理论上正在备份 Prod DB :)）

然后只需在您的开发盒上恢复到一个全新的数据库，这样您就不会与任何其他人或任何人发生冲突。

如果您恢复到一个新的数据库，您还可以根据需要手动拉动表和数据，并且由于您创建了数据库，因此您赋予自己权利，这一切都可以。还有很多其他的方法，都很乏味。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T06:04:07.220

显然值得注意的是，如果您的表具有外键约束，您将需要按特定顺序执行此操作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-19T06:18:52.510

我们只是在工作中使用[SQL Server 数据库发布向导](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)。

您将使用这个小实用程序来生成描述生产数据库（包括其所有数据）的 T-SQL 脚本。然后连接到您的开发服务器并运行生成的脚本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-08T13:22:56.433

如果您必须避免备份/恢复，这是我建议的（这些步骤假设您不想维护旧模式名称，只是结构） -

下载[opendbdiff](http://opendbiff.codeplex.com/releases/view/51995)。在源和（空）目标之间选择“比较”。选择同步。脚本选项卡并仅复制创建表行（没有 dbo.sysdiagrams 表等）粘贴到 sql managment studio 新查询中，删除出现在表名之前的所有模式名称。

现在您拥有完整的结构，包括主键、身份等。下一步 - 像以前一样使用 sql server 导入和导出数据（确保选择编辑映射并选择目标模式作为 dbo 等）。还要确保勾选 drop 并重新创建目标表。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-10-30T14:53:43.840

在您的开发机器上，为您的生产机器设置一个链接服务器。然后就

> 插入 dev.db.dbo.table（字段列表）
> 
> 从 prod.db.dbo.table 中选择（字段列表）

# visual-studio - 如何使用 Visual Studio 和 FireFox 调试防止 Tab Hell？

> ID：247908
> 
> 赞同：25
> 
> 时间：2008-10-29T18:35:30.727
> 
> 标签：visual-studio, firefox

每次按 F5 调试 Web 应用程序时，如何防止 VS 在 Firefox 中打开新选项卡？我*真的很*希望它重新使用相同的选项卡。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-29T19:16:08.227

这可能对您不起作用，但在 Web 选项卡上的项目属性中有一个描述为“不要打开页面。等待来自外部应用程序的请求”的设置。我公司的所有开发人员都有这套，然后只需使用书签来加载我们的页面。

# delphi - 使用关联字符串（键/值）的最简单方法是什么？

> ID：247909
> 
> 赞同：6
> 
> 时间：2008-10-29T18:35:36.203
> 
> 标签：delphi

我有很多以某种方式相关的常量，在某些时候我需要将它们配对，如下所示：

```
const
  key1 = '1';
  key2 = '2';
  key3 = '3';

  value1 = 'a';
  value2 = 'b';
  value3 = 'c'; 
```

我想避免这样做：

```
if MyValue = key1 then Result := value1; 
```

我知道如何使用字符串列表来做到这一点：

```
MyStringList.Add(key1 + '=' + value1);
Result := MyStringList.Values[key1]; 
```

但是，有没有更简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T18:42:58.090

是的，可以通过这种方式进行分配，避免手动字符串连接：

```
MyStringList.Values[Key1] := Value1; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T18:49:23.680

围绕你的“价值”做一个包装

```
TMyValue = 类
  值：字符串；
结尾;
```

然后使用这个：

```
myValue := TMyValue.Create;
我的价值。价值=价值1；

MyStringList.AddObject(Key1, Value1);

```

然后，您可以对列表进行排序，执行 IndexOf(Key1) 并检索对象。

这样，您的列表就会被排序并且搜索速度非常快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T21:53:50.883

您可以使用带有枚举的多维常量数组，其中至少有一个维度：

像这样定义它：

```
type
  TKVEnum = (tKey, tValue); // You could give this a better name
const
  Count = 3;
  KeyValues: array [1..Count, TKVEnum] of string =
    // This is each of your name / value paris
    (('1', 'a'), ('2', 'b'), ('3', 'd')); 
```

然后你像这样使用它：

```
if MyValue = KeyValues[1, TKVEnum.tKey] then 
  Result := KeyValues[1, TKVEnum.tValue] 
```

您也可以在其上使用**For**循环。这与将它们作为单独的常量字符串一样有效，但为您提供了它们本质上相关联的额外优势。

我建议不要用数字定义第一个维度

```
type
  TConstPairs = (tcUsername, tcDatabase, tcEtcetera); 
```

但我想这完全取决于你的常数代表什么。

# php - 如何在 CakePHP 中更新我的 $ajax->remoteFunction() 以更改省市组合框？

> ID：247918
> 
> 赞同：0
> 
> 时间：2008-10-29T18:37:12.283
> 
> 标签：php, cakephp, combobox

我有两个组合；省市。当省组合值发生变化时，我想更改城市值。这是我的代码

```
<div class="cities form">
<?php
    $v = $ajax->remoteFunction(array('url' => '/cities/','update' => 'divcity'));
    print $form-> input('Province.province_id', array('type' => 'select', 'options'=> $provinces, 'onChange' => $v)); 
?>  
<div id="divcity">
<?php
    echo $form->input('Cities.cities_name'); 
?>
</div> 
```

每次我更改省份组合时，它都会调用`cities/index.ctp`. 有人想帮忙吗？真的很感谢你的帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T20:01:25.873

'url' => '/cities/' 正在调用城市控制器的默认索引操作。

这会自动呈现 city/index.ctp 视图。

您是否在城市控制器中包含了 RequestHandler 组件？

这可用于检测 Ajax 请求，然后呈现不同的视图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-12T01:08:13.423

您需要首先在 CitiesController 的顶部包含[RequestHandler 组件，然后编写一个函数来列出城市，可选地需要一个省的 id。](http://book.cakephp.org/view/174/Request-Handling)

我想你最终会得到这样的东西：

```
<?php
// In the view
$v = $ajax->remoteFunction(array('url' => '/cities/list','update' => 'divcity'));
print $form-> input('Province.province_id', array('type' => 'select', 'options'=> $provinces, 'onChange' => $v));

// In CitiesController
function list($province_id = null) {
    // use $this->City->find('list', array('fields'=>array('City.id', 'City.name'))) 
            // to generate a list of cities, based on the providence id if required
    if($this->RequestHandler->isAjax()) {
        $this->layout = 'ajax';
        $this->render();
    }
} ?> 
```

# python - 是否可以获取 Django 的“changed_data”列表中包含的项目的值？

> ID：247922
> 
> 赞同：0
> 
> 时间：2008-10-29T18:38:46.663
> 
> 标签：python, django

我的 Django 应用程序中有以下代码：

```
if 'book' in authorForm.changed_data:
   #Do something here... 
```

我意识到 Django 可以通过使用“changed_data”列表对象告诉我表单中哪些值发生了变化，但我想知道已更改字段的新值。

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T19:58:24.883

嗯...试试这个：

```
if authorForm.is_valid() and 'book' in authorForm.changed_data:
    new_value = authorForm.cleaned_data['book'] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-21T15:56:26.527

我最初的问题的简短回答是“不”。

# php - 通过 HTTP 发送大文件

> ID：247928
> 
> 赞同：4
> 
> 时间：2008-10-29T18:39:56.350
> 
> 标签：php, xml, http

我有一个通过 HTTP 请求 XML 文件的 PHP 客户端（即通过 URL 加载 XML 文件）。到目前为止，XML 文件只有几 KB 大小。我可以预见的一个问题是 XML 的大小变成了几 MB 或 Gbs。我知道这是一个很大的问题，并且可能有无数的解决方案，但是您有什么想法将这些数据传输到客户端？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T19:32:43.937

根据您的用例，我绝对建议先压缩数据。此外，您可能希望在开始下载之前对文件进行 md5 散列并进行比较（如果文件没有更改，则无需更新），这将有助于第 2 点。

另外，是否可以只发送一段 XML 而不是整个文件？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T19:11:21.607

忽略浏览器可能处理或可能不处理 GB 大小的 XML 文件的能力，我能想到的唯一真正的问题是生成所有 XML 的执行时间是否大于任何执行时间阈值在您的环境中设置。

*   [PHP 的 max_execution_time 设置](http://us.php.net/manual/en/info.configuration.php#ini.max-execution-time)
*   [PHP 的 set_time_limit() 函数](http://us.php.net/manual/en/function.set-time-limit.php)
*   [Apache 的超时指令](http://httpd.apache.org/docs/1.3/mod/core.html#timeout)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T20:02:10.397

鉴于 XML 是使用您的 PHP 动态创建的，我能想到的最简单的事情是确保文件由网络服务器自动压缩，如此处所述[，](http://www.webcodingtech.com/php/gzip-compression.php)它提供了通用 PHP 方法和特定于 Apache httpd 的解决方案。

除此之外，拥有一个浏览器（还有什么可以是 PHP 客户端？）每天晚上为一些数据同步做这样的工作，听起来好像在其他地方必须有一个更简单的解决方案。

而且，当然，在某些时候，传输“大量”数据将花费“大量”时间......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T01:43:16.153

问题是他正在同步两个数据集。这个问题是完全错误的。

您需要 a) 保留对数据集 A 的更改的差异日志，以便您可以将该日志发送到数据集 B，或 b) 保留数据集的两个副本（昨晚和当前数据集），然后比较它们以便您然后可以将差异日志从 A 发送到 B。

欢迎来到复制的世界。

(a) 的问题在于它可能会侵入您的所有代码，但如果您使用的是 RDBMS，您可以通过数据库触发器进行一些日志记录，以跟踪插入/更新/删除，并将信息写入一个表，然后将相关行导出为您的差异日志。但是，这也可能很糟糕。

(b) 的问题是一次“比较数据库”。适合 100 行。对 10^9 行不利。可恶可恶。

事实上，这一切都可能很糟糕。复制是讨厌的。

更好的计划是研究为您正在运行的特定数据库设计的“真实”复制系统（假设您正在运行数据库）。可能会发送数据库日志记录以进行同步而不是尝试自己滚动的东西。

大多数现代 DBMS 系统都有复制系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T18:44:22.753

Gallery2，它允许您通过 http 上传照片，让您设置几个 php 参数，`post_max_size`并且`upload_max_filesize`允许更大的上传。你可能想调查一下。

在我看来，发布大文件存在浏览器超时等问题，但从好的方面来说，它与代理服务器和防火墙一起使用比尝试不同的文件上传协议更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T19:22:17.483

感谢您的回复。我没有提到传输文件应该相对较快（最多几分钟，这甚至可能吗？）。每晚都会解析请求的 XML 并将其插入到数据库中。XML 可能与前一天晚上相同，也可能不同。提出的一种解决方案是压缩 xml 文件，然后传输它。所以基本上有两个要求：1.它必须相对较快2.它应该尽量减少对数据库的写入次数。

提出的一种解决方案是压缩 xml 文件，然后传输它。但这仅满足（1）

还有其他想法吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T20:04:11.390

是否有任何算法可以应用于压缩 XML？如何在几秒钟内下载 MP3 等大文件？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T23:13:11.867

PHP 接收 GB 的数据需要很长时间并且是开销。更容易察觉到缺陷。

我会-将分配分配给不受执行时间困扰的shellscript（带有简单错误捕获的wget），并且在失败时甚至可以根据其自身的优点重试。

我对此没有经验，但是尽管可以使用**exec()**或类似方法，但这些可悲地运行模式。

调用脚本`**./test.sh &**`使其在后台运行并解决该问题/我猜。**[该脚本可以轻松地让您的 PHP 通过 wget ` http://yoursite.com/continue-xml-stuff.php?id=1049381023&status=0](http://yoursite.com/continue-xml-stuff.php?id=1049381023&status=0)** ` 将其备份。如果您不需要回溯丢失的请求，则 id 可以是文件名。状态将指示脚本最终如何处理请求。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T00:55:32.567

您是否考虑过使用某种版本控制系统来处理这个问题？您可以利用它计算和发送文件差异的能力，此外还可以获得维护文件版本历史的额外好处。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-30T01:22:19.877

由于我不知道您的情况的详细信息，所以我会在那里提出问题。只是为了争论，它必须是 HTTP 吗？FTP 更适合大数据传输，并且可以通过 PHP 或 Perl 轻松实现自动化。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-30T01:50:52.627

如果您使用的是 Apache，您还可以考虑使用 Apache mod_gzip。这应该允许您自动压缩文件并且解压缩也应该自动发生，只要双方都接受 gzip 压缩。

# ruby-on-rails - 如何在 Rails 中使用模式信息设置 PostgreSQL 表名？

> ID：247929
> 
> 赞同：3
> 
> 时间：2008-10-29T18:40:17.053
> 
> 标签：ruby-on-rails, postgresql

我必须在旧版 Postgre 数据库中连接我的 rails 应用程序。它使用模式，因此在 SQL 中，通常使用类似的东西

```
SELECT * FROM "Financial".budget 
```

我想写一个预算模型，但我不知道在这种情况下如何设置表名。我尝试了以下方法：

*   set_table_name '预算'
*   set_table_name '"财务".budget'

没有工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-07-13T16:13:08.670

```
ActiveRecord::Base.establish_connection(
    :schema_search_path => 'Financial,public'
) 
```

如果您使用的是 Postgres，对于大多数情况，上述内容可能“足够好”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-08T20:36:13.473

我对 Oracle 适配器有类似的问题。默认情况下，ActiveRecord 总是引用 SQL 中的表名，因此如果您指定

```
set_table_name "Financial.budget" 
```

然后生成的 SQL 将是

```
SELECT * FROM "Financial.budget" 
```

这是行不通的。

要解决这个问题，您需要修改 PostgreSQL 适配器。将以下代码放入您的 environment.rb 或单独的初始化程序中：

```
ActiveRecord::ConnectionAdapters::PostgreSQLAdapter.class_eval do
  # abstract_adapter calls quote_column_name from quote_table_name, so prevent that
  def quote_table_name(name)
    name
  end
end 
```

现在你应该在你的模型类中定义

```
set_table_name "Financial.budget" 
```

生成的 SQL 将是

```
SELECT * FROM Financial.budget 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-28T12:19:58.503

现在，这个错误似乎在 2-3-stable 中得到了解决。看看[这个帖子](http://weblog.rubyonrails.org/2009/4/24/this-week-in-edge-rails)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T23:02:05.807

查看您的日志——Rails 使用您的各种选项生成什么 SQL？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T23:23:29.897

```
set_table_name "Financial.budget" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T18:02:39.467

也许使用您的架构扩展搜索路径会对您有所帮助？

```
SET SEARCH_PATH TO "Financial", public; 
```

然后，您可以在没有架构的情况下编写不合格的查询：

```
SELECT * FROM budget; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-07T10:23:32.333

我们设计了一个 gem 来让 ActiveRecord 与 PostgreSQL 一起工作。这是一个小的用法示例： http: [//greyblake.com/blog/2012/09/06/pg-power-activerecord-extension-for-postgresql/](http://greyblake.com/blog/2012/09/06/pg-power-activerecord-extension-for-postgresql/)

# php - PHP 常量：优点/缺点

> ID：247936
> 
> 赞同：8
> 
> 时间：2008-10-29T18:43:03.287
> 
> 标签：php, performance, standards, coding-style, constants

最近，我养成了将整数值分配给常量的习惯，并简单地使用常量名称作为识别其用途的一种方式。但是，在某些情况下，这导致需要在需要字符串表示时编写类似 typeToString($const) 的函数。显然，这是低效且不必要的，但只是偶尔出现的问题。

所以我的问题是，我还应该考虑其他权衡吗？哪种情况被认为更清洁/更符合标准？此外，在大多数情况下，性能差异是否可以忽略不计？

**案例1：（当不需要字符串版本时更快？）**

```
class Foo {
    const USER_TYPE_ADMIN = 0;
    const USER_TYPE_USER = 1;
    const USER_TYPE_GUEST = 2;

    public $userType = self::USER_TYPE_ADMIN;

    public function __construct($type) {
        $this->userType = $type;
    }

    public function typeToString() {
        switch($this->userType) {
            case self::USER_TYPE_ADMIN:
                return 'admin';
                break;

            case self::USER_TYPE_USER:
                return 'user';
                break;

            case self::USER_TYPE_GUEST:
                return 'guest';
                break;

            default:
                return 'unknown';
                break;
        }
    }
}

$foo = new Foo(Foo::USER_TYPE_GUEST);
echo $foo->typeToString();
// Displays "guest" 
```

**案例2：（需要字符串版本时更快/更容易）**

```
class Foo {
    const USER_TYPE_ADMIN = 'admin';
    const USER_TYPE_USER = 'user';
    const USER_TYPE_GUEST = 'guest';

    public $userType = self::USER_TYPE_ADMIN;

    public function __construct($type) {
        $this->userType = $type;
    }
}

$foo = new Foo(Foo::USER_TYPE_GUEST);
echo $foo->userType();
// Displays "guest" 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-29T18:49:55.270

除非您存储大量它们，否则性能差异将可以忽略不计。我会`toString()`更简洁地编写该方法：

```
$strings = array
(
    self::USER_TYPE_ADMIN => 'admin',
    self::USER_TYPE_USER => 'user',
);

if (!isset($strings[$type]))
    return 'unknown';

return $strings[$type]; 
```

此外，您可以将`$strings`数组设为 a `static`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T18:48:07.130

老实说，当您将常量定义为字符串时，我不知道是否有任何类型的性能“命中” - 但如果有的话，我愿意打赌它是如此之小难以测量。

就个人而言，如果常量的值作为文字有意义，则只需为其分配该值。如果常量的值仅作为选项选择器（或其他值*指示*）有意义，则使用整数或您选择的任何合适的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T18:48:38.500

我认为在这种情况下字符串常量是最好的选择。代码看起来更好。

当然，如果您需要最后一点性能，请使用整数常量。但只有在您使用分析器验证字符串比较是瓶颈之后。无论如何，在大多数应用程序中都有很多更昂贵的东西，比如数据库访问等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T18:45:19.023

如果我需要打印它们，我通常只使用字符串而不是使用 const 整数。所以我会做类似的事情`$foo = new Foo('guest');`。我仍然可以验证构造函数中的输入，并且可以在需要时对其进行标记。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-10-29T23:08:02.957

在您编写的示例中，您可以删除所有方法并使类成为静态类，您将创建自己的枚举器。像这样：

```
类枚举{
  公共静态常量一=1；
  公共静态常量二=2；
  公共静态常量三=3；
}

```

使用常量的另一种方便方法是将它们用作应用程序配置。它们在性能方面比解析 xml 文件进行配置要快得多。

# design-patterns - 什么是单例？

> ID：247943
> 
> 赞同：0
> 
> 时间：2008-10-29T18:44:57.433
> 
> 标签：design-patterns, singleton

我的一个朋友最近在一次工作面试中被问到标准单例和单例单例之间的区别。我以前从未听说过这个词，简单的谷歌搜索不会返回任何有意义的结果。

我的朋友建议它是一个构造函数是公共的但所有成员都是静态的对象。这对我来说似乎有点傻，因为它只是一个根本不需要构造函数的静态对象。

有没有人对单例有更好的定义？与标准单例相比，它有用吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T18:49:42.087

我想他们实际上是指“Monostate”。我不会详细介绍它们，因为它们现在很容易在 Google 上搜索（以及与 Singletons 的区别的讨论）。

但是，我会说 Monostates 往往具有至少所有相同的问题和 Singletons，应该尽可能避免（考虑其他方法，例如[Parameterise From Above](http://accu.org/index.php/journals/1411)或依赖注入，在适当的情况下）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T18:48:53.913

我知道可以修改“单例”以支持 n 个实例，其中 n 是一个固定数字。但是，我了解到这被称为 multiplton 或 multiton（我忘记了确切的名称，但它与那个相似）。可能是面试官想要达到这样的程度，即您可以使用非常类似于 Singleton 模式的东西来实现对象的 n 个实例。但如果是这样的话，那就是一种尴尬的表达方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T18:52:18.633

谷歌上恰好有一个“单例”（带引号），所以我将其解析为平台中立的 DotNet 框架中使用的单例，而不是“Java 单例”或“C++ 单例”。

对不起，无法抗拒:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T18:49:03.010

我以前从未听说过这个术语，但我想它是用来指代一个只允许创建一个实例的单例。（一般的单例不需要，它也可以给出有限数量的实例）。

要么是那个，要么是单声道的单例......

# c# - 处理窗体上所有控件的单击

> ID：247946
> 
> 赞同：9
> 
> 时间：2008-10-29T18:45:44.840
> 
> 标签：c#, winforms, events

我有一个 .NET 用户控件（FFX 3.5）。此控件包含几个子控件 - 一个面板、几个标签、几个文本框和另一个自定义控件。我想在基本控件上的任意位置单击鼠标右键-因此右键单击任何子控件（或在面板的情况下为子控件的子控件）。我想这样做，以便如果有人对控件进行更改而无需为新控件连接处理程序，它是可维护的。

首先，我尝试覆盖 WndProc，但正如我所怀疑的那样，我只收到直接点击表单的消息，而不是它的任何子项。作为一个半破解，我在 InitializeComponent 之后添加了以下内容：

```
 foreach (Control c in this.Controls)
  {
    c.MouseClick += new MouseEventHandler(
      delegate(object sender, MouseEventArgs e)
      {
        // handle the click here
      });
  } 
```

现在，这会为支持该事件的控件获得点击，但例如，标签仍然没有得到任何东西。有没有一种我忽略的简单方法可以做到这一点？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-29T19:05:08.407

如果标签在子控件中，那么您必须递归地执行此操作：

```
void initControlsRecursive(ControlCollection coll)
 { 
    foreach (Control c in coll)  
     {  
       c.MouseClick += (sender, e) => {/* handle the click here  */});  
       initControlsRecursive(c.Controls);
     }
 }

/* ... */
initControlsRecursive(Form.Controls); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-07-14T13:18:14.447

要处理*MouseClick*事件以右键单击自定义*UserControl*上的所有控件：

```
public class MyClass : UserControl
{
    public MyClass()
    {
        InitializeComponent();

        MouseClick += ControlOnMouseClick;
        if (HasChildren)
            AddOnMouseClickHandlerRecursive(Controls);
    }

    private void AddOnMouseClickHandlerRecursive(IEnumerable controls)
    {
        foreach (Control control in controls)
        {
            control.MouseClick += ControlOnMouseClick;

            if (control.HasChildren)
                AddOnMouseClickHandlerRecursive(control.Controls);
        }
    }

    private void ControlOnMouseClick(object sender, MouseEventArgs args)
    {
        if (args.Button != MouseButtons.Right)
            return;

        var contextMenu = new ContextMenu(new[] { new MenuItem("Copy", OnCopyClick) });
        contextMenu.Show((Control)sender, new Point(args.X, args.Y));
    }

    private void OnCopyClick(object sender, EventArgs eventArgs)
    {
        MessageBox.Show("Copy menu item was clicked.");
    }
} 
```

# ruby - 是否有更好的方法来检查 Ruby 中字符串的 Nil 或 Length == 0？

> ID：247948
> 
> 赞同：173
> 
> 时间：2008-10-29T18:46:24.077
> 
> 标签：ruby

有没有比以下更好的方法来检查字符串是否为 nil 或在 Ruby 中的长度为 0？

```
if !my_string || my_string.length == 0
  return true
else
  return false
end 
```

在 C# 中很方便

```
string.IsNullOrEmpty(myString) 
```

Ruby中有什么类似的东西吗？

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2008-10-30T20:27:12.343

当我不担心性能时，我会经常使用这个：

```
if my_string.to_s == ''
  # It's nil or empty
end 
```

有各种各样的变化，当然......

```
if my_string.to_s.strip.length == 0
  # It's nil, empty, or just whitespace
end 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-10-29T20:05:06.117

如果您愿意要求 ActiveSupport，您可以只使用`#blank?`为 NilClass 和 String 定义的方法。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2012-03-28T20:46:02.063

我喜欢这样做（在非 Rails/ActiveSupport 环境中）：

```
variable.to_s.empty? 
```

这有效，因为：

```
nil.to_s == ""
"".to_s == "" 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-10-29T19:14:22.053

jcoby 提议的替代方案是：

```
class NilClass
  def nil_or_empty?
    true
  end
end

class String
  def nil_or_empty?
    empty?
  end
end 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2008-10-29T20:18:02.190

[正如在 Rails (ActiveSupport) 有一个方便的空白](http://api.rubyonrails.org/classes/Object.html#M000155)之前所说的那样？方法，它是这样实现的：

```
class Object
  def blank?
    respond_to?(:empty?) ? empty? : !self
  end
end 
```

很容易添加到任何基于 ruby​​ 的项目中。

这个解决方案的美妙之处在于它不仅适用于字符串而且适用于数组和其他类型。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-10-25T07:18:24.480

变量.空白？会做的。如果字符串为空或字符串为 nil，则返回 true。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-29T18:55:09.127

`nil?`在布尔上下文中可以省略。通常，您可以使用它来复制 C# 代码：

```
return my_string.nil? || my_string.empty? 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-29T19:19:56.893

首先，请注意该方法：

正如[杰西·埃泽尔](http://weblogs.asp.net/jezell/archive/2003/04/10/5280.aspx)所说：

> [布拉德·艾布拉姆斯](http://blogs.gotdotnet.com/brada/commentview.aspx/ed33b21f-39a1-4eba-8c62-5e578d6d989a)
> 
> > “这种方法可能看起来很方便，但大多数时候我发现这种情况是因为试图掩盖更深层次的错误。
> 
> 您的代码在使用字符串时应遵守特定协议，并且您应该了解该协议在库代码和您正在使用的代码中的使用。
> 
> NullOrEmpty 协议通常是一个快速修复（所以真正的问题仍然在其他地方，并且您使用了两个协议）或者在实现新代码时缺乏特定协议的专业知识（同样，您应该真的知道什么你的返回值是）。”

如果你修补 String 类......确保[NilClass 也没有被修补](http://rubyforge.org/pipermail/poignant-stiffs/2004-May/000077.html)！

```
class NilClass
    def empty?; true; end
end 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-29T18:52:26.247

每个类都有一个`nil?`方法：

```
if a_variable.nil?
    # the variable has a nil value
end 
```

字符串有`empty?`方法：

```
if a_string.empty?
    # the string is empty
} 
```

请记住，字符串为空时*不*等于`nil`，因此使用该`empty?`方法检查字符串是否为空。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2018-03-12T10:51:16.963

另一种选择是即时将 nil 转换为空结果：

`(my_string||'').empty?`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-29T19:07:54.093

康拉德鲁道夫有正确的答案。

如果它真的让您感到困扰，请修改 String 类或将其添加到您选择的类/模块中。除非您有真正令人信服的理由，否则猴子修补核心对象确实不是一个好习惯。

```
class String
  def self.nilorempty?(string)
    string.nil? || string.empty?
  end
end 
```

然后你可以做`String.nilorempty? mystring`

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-08-20T04:58:18.733

## 检查纯 Ruby 中的空字符串，同时避免 NameError 异常

这里有一些很好的答案，但您不需要 ActiveSupport 或猴子补丁来解决这里的常见用例。例如：

```
my_string.to_s.empty? if defined? my_string 
```

*如果my_string*为 nil 或空字符串，这将“做正确的事” ，但如果*my_string 未定义，则不会引发*[NameError 异常](http://www.ruby-doc.org/core-2.1.2/NameError.html)。这通常比更做作的更可取：

 *```
my_string.to_s.empty? rescue NameError 
```

或更冗长的同类，因为应该为您*不*希望发生的事情保存异常。在这种情况下，虽然它可能是一个常见错误，但未定义的变量并不是真正的例外情况，因此应该相应地处理它。

你的旅费可能会改变。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-04-08T12:26:01.893

如果您使用的是导轨，则可以使用`#present?`

```
require 'rails'

nil.present?  # ==> false (Works on nil)
''.present?    # ==> false (Works on strings)
'  '.present?  # ==> false (Works on blank strings)
[].present?    # ==> false(Works on arrays)
false.present? # ==> false (Works on boolean) 
```

因此，相反地检查 nil 或零长度使用`!present?`

```
!(nil.present?)  # ==> true
!(''.present?)    # ==> true
!('  '.present?)  # ==> true
!([].present?)    # ==> true
!(false.present?) # ==> true 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-09-11T10:59:20.580

您是否尝试过细化？

```
module Nothingness
  refine String do
    alias_method :nothing?, :empty?
  end

  refine NilClass do
    alias_method :nothing?, :nil?
  end
end

using Nothingness

return my_string.nothing? 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-07-26T06:54:35.817

对于代码高尔夫球手：

```
if my_string=~/./
  p 'non-empty string'
else
  p 'nil or empty string'
end 
```

或者，如果您不是高尔夫球手（需要 ruby​​ 2.3 或更高版本）：

```
if my_string&.size&.positive?
  # nonzero? also works
  p 'non-empty string'
else
  p 'nil or empty string'
end 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-07-30T14:02:55.823

在rails中你可以试试`#blank?`。

警告：当字符串由空格组成时，它会给你肯定：

```
nil.blank? # ==> true
''.blank? # ==> true
'  '.blank? # ==> true
'false'.blank? # ==> false 
```

只是想指出来。也许它适合您的需求

UPD。为什么我的提要中出现老问题？很抱歉发布了墓志铭。

# c# - 在选项卡控件中的选项卡页之间淡入淡出

> ID：247954
> 
> 赞同：3
> 
> 时间：2008-10-29T18:48:39.873
> 
> 标签：c#, .net, winforms, animation, tabcontrol

我有一个带有多个标签页的标签控件。我希望能够来回淡化标签。我在选项卡控件上看不到不透明度选项。当我从一个标签页切换到另一个标签页时，有没有办法引起淡入淡出效果？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T16:53:24.690

标准窗口控件中没有神奇的淡入淡出开关。

您可以将选项卡的内容转储到位图（使用[DrawToBitmap](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.drawtobitmap.aspx)或[CopyFromScreen](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.copyfromscreen.aspx)？），在 TabControl 前面显示该位图，切换选项卡，然后淡化位图。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-09T00:05:13.473

我决定发布我所做的以使我的解决方案发挥作用。GvS 有最接近的答案，并让我朝着正确的方向前进，所以我给了他（可能是她，但来吧）正确的答案复选标记，因为我不能给自己。我从来没有弄清楚如何从一个选项卡“交叉淡入淡出”到另一个选项卡（降低一个选项卡的不透明度并提高另一个选项卡的不透明度），但我发现等待在位图上绘制一个灰色框，越来越多的灰色给它淡入我的背景的效果，这也是灰色的。然后我将第二个选项卡作为灰色位图开始，我慢慢添加较少的灰色，并与每次迭代的选项卡图像相结合，使其具有淡化效果。

这个解决方案导致了一个很好的淡入淡出效果（即使我自己这么说），但它是非常线性的。我将为 alphablend 变量使用随机数生成器，看看这是否会使其线性度降低一些，但用户可能会再次欣赏可预测性。顺便说一句，我使用 button_click 触发切换选项卡事件。

```
using System.Drawing.Imaging;
using System.Drawing.Drawing2D;

public int alphablend;
public Bitmap myBitmap;

    private void button1_Click(object sender, EventArgs e)
    {
        alphablend = 0;
        pictureBox1.Visible = true;
        myBitmap = new Bitmap(tabControl1.Width, tabControl1.Height);
        while (alphablend <= 246)
        {
            tabControl1.DrawToBitmap(myBitmap, new Rectangle(0, 0, tabControl1.Width, tabControl1.Height));
            alphablend = alphablend + 10;
            pictureBox1.Refresh();//this calls the paint action
        }
        tabControl1.SelectTab("tabPage2");
        while (alphablend >= 0)
        {
            tabControl1.DrawToBitmap(myBitmap, new Rectangle(0, 0, tabControl1.Width, tabControl1.Height));
            alphablend = alphablend - 10;               
            pictureBox1.Refresh();//this calls the paint action
        }
        pictureBox1.Visible = false;
    }

    private void pictureBox1_Paint(object sender, PaintEventArgs e)
    {
        Graphics bitmapGraphics = Graphics.FromImage(myBitmap);

        SolidBrush greyBrush = new SolidBrush(Color.FromArgb(alphablend, 240, 240, 240));

        bitmapGraphics.CompositingMode = CompositingMode.SourceOver;

        bitmapGraphics.FillRectangle(greyBrush, new Rectangle(0, 0, tabControl1.Width, tabControl1.Height));

        e.Graphics.CompositingQuality = CompositingQuality.GammaCorrected;

        e.Graphics.DrawImage(myBitmap, 0, 0);

    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T18:59:05.573

我没有看到 Winform/Webform 的规范，所以我假设 WebForm ...

您可以使用 AJAX AnimationExtender。

如果做不到这一点，一个不好的方法（可行）是接受一个 QueryString 导致页面自动导航到您想要的选项卡，并使用页面转换。

对于 Winforms，您可以使用 WPF :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T07:20:43.687

我不相信 WPF TabControl 可以从一个 TabItem 淡入到下一个 TabItem，因为它不能同时显示多个 TabItem。

您可以尝试通过将两个`ListView`s 拼接在一起（一个用于标签条，一个用于面板）来模拟这一点，并将效果添加到`ControlTemplate`后者中。使用 TabControl 和 ListView 的 ControlTemplates 作为起点。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-02T16:28:56.453

根据您的选项卡/页面的工作方式，您可以通过向页面添加元标记来在页面级别处理它：

```
<meta http-equiv="Page-Enter" content="blendTrans(Duration=0)">
<meta http-equiv="Page-Exit" content="blendTrans(Duration=0)"> 
```

只需更改持续时间以使淡入淡出更长或更短。这通常称为FAJAX。

# svn - 如何在ant中获取subversion-url下的文件列表？

> ID：247955
> 
> 赞同：1
> 
> 时间：2008-10-29T18:48:42.247
> 
> 标签：svn, ant, svnant

我想通过 ant 访问 subversion-repository 并获取特定 svn-url 下可用的文件列表，例如[https://svn.myhost.de/repository/path/into/repo](https://svn.myhost.de/repository/path/into/repo)。我想以某种形式列出所有项目、子目录或文件，以便稍后在 ant 文件中使用。逗号分隔的列表很好，它可以输入到 ant-contrib 的 foreach-task 中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T01:00:13.087

Subversion的[Subclipse 项目](http://subclipse.tigris.org)提供了[svnant](http://subclipse.tigris.org/svnant.html)

[svnant](http://subclipse.tigris.org/svnant.html)包括`svnFileSet`, an`ant type`就像 a 一样工作`fileset`。

您需要为您正在使用的 Subversion 版本下载适当的版本，并按照文档中的说明在构建文件中包含`svnant`任务、类型、选择器和条件`ant`。

# sharepoint - 开源 SharePoint？

> ID：247959
> 
> 赞同：14
> 
> 时间：2008-10-29T18:49:17.500
> 
> 标签：sharepoint, open-source

是否有 SharePoint 的开源替代方案？

我想要提供与 SharePoint 相同的层次结构和基于 portlet 的设计，但在源代码中是开放的。基于 Web 的管理和定制也是一个优势。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-02T21:43:41.387

[免责声明 - 我为 Alfresco 开源企业 CMS 工作]

在原始帖子发布几天后（10 月 31 日），Alfresco 发布了 Alfresco Share，这是一个专注于协作的应用程序。它有一个为协作量身定制的新 UI（建立在 YUI 之上），能够自定义它，还支持 SharePoint 协议，这意味着您可以从 MS Office（Word、PowerPoint）连接到它并像使用 Alfresco 一样使用SharePoint - 签入/签出、版本控制等。

它建立在 Alfresco ECM 核心之上，该核心已经存在了四年。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T19:50:18.703

我取决于你需要什么。
它被用作内容管理系统吗？如前所述，有很多开源 CMS。

它被用作协作工具吗？然后以下事情之一可能会奏效：

*   [eGroupWare](http://www.egroupware.org/)：已经在许多主机、项目经理、Notes、Tasks、ToDos 和更多工具的 Infolog 上可用。
*   [Collanos Workspace](http://www.collanos.com/de/downloads) : Mac、Win 或 Linux 上的 Java、聊天、讨论合并
*   [OpenGoo](http://www.opengoo.org/)：PHP、任务、日历、联系人、网络链接、内部消息，带有文本文档和演示文稿的编辑器（！）
*   [eyeOS](http://eyeos.org/en/)将其更进一步。它就像浏览器中的桌面，包括内部拖放等。它结合了前面提到的OpenGoo，可以通过[单独下载](http://eyeos-apps.org/)的大量“程序”来增强。唯一的问题：eyeOS 需要对文件具有完整的读/写权限，这通常是托管商的问题。

编辑：我刚刚发现了其他东西，并认为值得在这里添加：[O3Spaces](http://www.o3spaces.org/)（参见[德语文章](http://www.heise.de/open/Groupware-O3spaces-integriert-E-Mail--/news/meldung/121188)）将自己视为 Sharepoint 的替代品，并且刚刚发布了一个新版本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T18:52:00.867

你可以看看[DotNetNuke](http://www.dotnetnuke.com)，它经常被比作类似于 Sharepoint。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-29T19:28:04.053

[Liferay](http://www.liferay.com/)即将发布其通用门户服务器（名为 Social Office）的预配置实例，据称该实例与 sharepoint 协议兼容。

我看到的演示令人印象深刻。它可以作为开源 (AGPL) 或商业支持提供。底层门户是 MIT 许可的，但要将其配置为如此流畅是相当多的工作。

很抱歉听起来像个营销人员——我不是。我已经在他们的研讨会上看到了它的演示，并且只使用了他们的门户服务器。

*更新*：[测试版已经发布](http://www.liferay.com/web/guest/downloads/social_office)。如前所述，它是 AGPL（或者，一旦最终，AGPL 和商业）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T19:22:22.287

我不知道它是否完全符合要求，但我碰巧喜欢这方面的[Plone](http://plone.org)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T18:57:58.857

如果你想要一个非 .NET 方法，[Joomla](http://www.joomla.org/)可能适合你。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T19:26:17.787

Java 世界有一个 Portal 和 Portlet 规范（JSR-168 和 JSR-286）。[Liferay](http://www.liferay.com)是一个开源的 portlet 容器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-06T13:56:49.867

Opengoo是惊人的。它比 sharpoint 更好，因为它集成了电子邮件日历文档和项目。

使用 Opengoo 管理项目也比使用 MS Project 高效得多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T19:51:34.380

是您想要的 CMS，还是只是为了协作。您可能想查看某种 wiki 解决方案。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-31T10:53:14.887

Alfresco 是一个开源替代品，它支持：

文档管理 CMS 协作

[http://www.alfresco.com/](http://www.alfresco.com/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-17T01:16:28.513

在[http://groups.diigo.com/search?group_name=collaboration&what=t%3ASharePoint](http://groups.diigo.com/search?group_name=collaboration&what=t%3ASharePoint) 'Expand All' 将显示有关 SharePoint 主题的一些亮点和注释。

我是一个克隆粉丝。

管理不是 100% 通过网络进行的，但它正朝着这个方向发展，而且很优雅。非 TTW 的管理得到了非常好的支持。目前正在对文档进行重大审查。社区*很棒*。

# c# - C# - 当每个“行”有多个值时对列表进行排序？

> ID：247961
> 
> 赞同：1
> 
> 时间：2008-10-29T18:49:30.420
> 
> 标签：c#, .net, list, sorting

异常：无法比较数组中的两个元素。

```
private void assignNames(DropDownList ddl, Hashtable names)
{
    List<ListItem> nameList = new List<ListItem>();
    if (ddl != null)
    {
        ddl.ClearSelection();
        ddl.Items.Add(new ListItem("Select Author"));
        foreach (string key in names.Keys)
        {
            nameList.Add(new ListItem(names[key].ToString(), key));

        }

    nameList.Sort();
} 
```

那么如何使用 Sort() 比较“名称”而不是卡在键上？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T19:02:00.737

提供一个[`Comparison<T>`](http://msdn.microsoft.com/en-us/library/tfakywbh.aspx)以指示[`List`](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)如何对项目进行排序。

```
nameList.Sort(delegate(ListItem thisItem, ListItem otherItem) {
    return thisItem.Text.CompareTo(otherItem.Text);
}); 
```

您可能还想检查是否`null`完整，除非您已经知道不会有任何内容，如本例所示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T19:13:15.707

nameList=nameList.OrderBy(li => li.Text).ToList();

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T18:55:31.687

什么类型的对象是“名称”？

编辑：据我所知，您必须指定一个 IComparer 才能使其正常工作，但不确定我是否完全理解您要执行的操作。

编辑：这对于我“感觉”你的意图来说太复杂了，你基本上想用作者姓名的排序列表填充下拉列表。

你应该能够拥有一个

```
List<string> auhtorNames;
authorNames.Sort();
ddl.DataSource = authorNames;
ddl.DataBind(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T18:59:40.413

使用 ArrayList.Sort(IComparer) 而不是 ArrayList.Sort()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T18:59:52.487

ListItem 不可比较。您可以改用 System.Collections.Specialized.OrderedDictionary。

# wiki - 维护程序员 Wiki

> ID：247967
> 
> 赞同：19
> 
> 时间：2008-10-29T18:51:45.360
> 
> 标签：wiki

我最近负责开发团队的 wiki。wiki 仍处于起步阶段，所以我有很大的工作空间。它的目标是容纳开发团队的内部。目前，wiki 拥有的主要信息是编码标准。

*   您的开发团队在其内部 wiki 中使用了哪些最佳实践？
*   开发 wiki 上的哪些信息很重要？
*   如果您要访问开发团队的 wiki，您希望看到哪些信息？
*   是否有一些信息不应该出现在 wiki 上，即使它看起来是个好主意？

- 编辑 -

*   另外，有没有很好的方法来组织信息？（例如按层（数据、用户界面）、按项目或其他）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T18:56:15.553

*   新程序员源码库介绍
*   一般文档（不是 API 文档本身，而是更多类似教程的东西）
*   员工名单/谁在做什么以及如何联系他们
*   解释软件中使用的概念的注释/资源/文章
*   构建过程的文档和代码库的文件系统布局

我通常在那里放的其他东西是

*   计划/待办事项清单
*   其他人感兴趣的信息
*   我觉得应该分享的其他一切

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-29T19:45:12.927

我们有一个开发维基，它是一个很棒的工具。我们将它用于*一切*！

*   当头脑风暴新想法时，我们会在 wiki 上捕捉它们。wiki 的低摩擦特性使组织中的任何人（我们是一家小型初创公司）都可以轻松地添加他们想到的想法。我们有一个高级别的“头脑风暴”页面，该页面链接到包含每个想法的详尽描述的详细页面。
*   对于每次迭代，我们会将特征想法项从“头脑风暴”列表“移动”到该迭代的特征列表。该功能的细节已被清除，以包括设计和实现细节。
*   随着功能的完成，迭代页面变成了我们的发布说明页面——其中还包括来自我们版本控制系统的发布标签。
*   我们有一个与功能页面非常相似的错误页面。错误修复已添加到迭代/发布页面，因为它们正在处理/完成。
*   我们还在 wiki 上创建了我们的用户文档，并在发布时将这些页面导出。

随着时间推移。这个工具被认为越来越有价值。我们最终为公司正在开发的不同产品创建了新的 wiki。

我希望您发现您的开发 wiki 和我们一样有用！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-09T04:38:36.413

[Wikipatterns](http://www.wikipatterns.com/display/wikipatterns/Wikipatterns)是一个致力于记录最佳 wiki 实践的网站。他们还描述了反模式并讨论了处理它们的方法。我读了他们的书，在一个 150 多人的组织中创建一个 wiki 对我来说是一笔巨大的财富。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T19:00:51.253

我们在开发 wiki 上强调的一件事是，它会在事情发生变化时进行更新。我们不希望我们旨在提供信息并成为收集知识的中心来源的 wiki 变得过时以致于无用。随着代码的更新，开发人员被要求更新 wiki 上的任何相关信息。

除了编码标准，我们还保留了使用代码库的提示和技巧、新员工的设置信息以及一般环境信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T19:56:10.517

最困难的部分是让开发人员使用您的 wiki。我在这里有一些长期存在的建议：http: //possibility.com/wiki/index.php?title= [GettingYourWikiAdopted](http://possibility.com/wiki/index.php?title=GettingYourWikiAdopted)

让 Wiki 被采用是困难的

有一个冠军

删除异议

创建内容

将 Wiki 融入公司流程

传福音

不要放弃

考虑不使用 Wiki 进行对话

去做就对了！不要等待预算

制定过渡计划

推广你的维基

一种好的做法是通过您的 wiki 提供每个构建的完整文档和源代码。然后开发人员将去 wiki 访问构建信息，这使得它变得非常宝贵。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-29T19:56:25.383

Wiki 可以成为软件开发团队的宝贵资源，但它们不是灵丹妙药。创建一个很快就会被废弃或严重过时的 Wiki 太容易了。

在我看来，成功的 Wiki 的关键是让整个团队都参与进来。这意味着让人们远离其他资源（尤其是电子邮件档案）作为知识库，并为人们做出贡献提供一些激励。

但是，不要成为格式沙皇也很重要：如果您有很多文档是在 MS WORD 中生成的，那么将它们全部以 Wiki 格式完成可能是理想的，但这需要时间，并且如果您这样做可能会很烦人有图表、文档等。在这种情况下，最好妥协并让人们将其保存为 word 格式，只要访问最新版本的唯一方法是通过 Wiki。

如果您不是经理，则需要让经理加入，因为这需要一些“强制执行”。

关于 Wiki 及其在软件工程中的使用，已经积累了研究和经验。例如，您可以搜索 ACM 数字图书馆。我是 SE wiki 年度研讨会的协办者，我们有一些有趣的经验报告，并且在 Wiki 国际研讨会上还有其他材料。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T19:00:31.613

*   燃尽图
*   开发环境的通用设置信息（新人开始时很好）
*   眼镜
*   开发工具的已知问题和解决方法

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-29T19:00:59.083

想出一些风格指南，教别人如何设计风格。当我负责一个企业 wiki 时，所有其他开发人员只会写出几乎没有格式的蹩脚散文，而且看起来很糟糕。

远离需要讨论的事情。我在书评部分尝试了鞋拔，但很难让其他人评论。

内部图书馆的例子很好。和/或“故事板”在调用 MethodX 时引导用户完成一个过程。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-29T19:07:23.080

*您的开发团队在其内部 wiki 中使用了哪些最佳实践？*

让它看起来不错。我知道这听起来并不重要，但是如果您花一点时间进行品牌推广，就实际使用它的人而言，它会有所回报。吸收是关键，否则它只会枯萎死亡。

*开发 wiki 上的哪些信息很重要？*

*   有关项目、里程碑、交付日期等的一般信息。
*   设计决策/会议摘要。重要的是，这样您就不会一次又一次地重新访问相同的区域。
*   当前项目一般开发的 HowTo 指南（例如，如何开发新插件）

*如果您要访问开发团队的 wiki，您希望看到哪些信息？*

项目信息，谁在做什么等。设计决策。还有最佳实践和有用网站的链接。

*是否有一些信息不应该出现在 wiki 上，即使它看起来是个好主意？*

低级任务列表往往会波动并且不会保持最新，并且可能会产生误导。此外，部门之间的关键通信更适合电子邮件，然后可以将对话复制到 wiki。否则很容易忽略它！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-29T19:48:58.303

请记住，wiki 是交互式的。如果您正在考虑发布，例如发布燃尽图，那么您的思考还不够远。分发这些信息只是其中的一部分。

例如，与其创建“当前燃尽图”页面，不如创建一个“2008 年 10 月 27 日当周燃尽图”页面，然后鼓励人们评论该图表，以及它的含义以及您这样做的原因那一周很糟糕。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-29T22:09:15.820

我们拥有和内部团队 wiki。我们在那里为我们正在开发的每个项目提供了所有必要的信息：

*   存储库
*   虚拟机地址
*   密码
*   项目文件
*   项目概况
*   项目状态

我们填写的任何其他内容都需要写在项目上。它是我们正在运行的最有用的 Web 应用程序（除了[Mantis](http://www.mantisbt.org/)）。在更一般的页面上，我们对我们使用的每个分类法、一般项目指南、政策、编码和我们使用的开发实践进行了定义。它就在那里，简单而有效，我认为每个团队都应该拥有其中一个。

# sharepoint - SharePoint 和 global.asax 代码的部署

> ID：247972
> 
> 赞同：1
> 
> 时间：2008-10-29T18:52:33.203
> 
> 标签：sharepoint, logging, global-asax

我想从我的自定义 SharePoint 代码开始将一些自定义消息记录[到 ULS中。](https://stackoverflow.com/questions/136672/programmatically-logging-to-the-sharepoint-uls)我的代码在附加到某些列表的列表项接收器中运行。我想在 global.asax 中的应用程序启动事件处理程序中配置此日志记录机制。部署修改 global.asax 的 SharePoint 解决方案包的最佳实践方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T23:38:41.160

我不知道“最佳实践”，但我会非常热衷于通过功能接收器中的代码进行编辑。

带有备份文件以供以后恢复的行。

对于日志记录，我们在这里使用了 Scott hilliers 代码[来](http://scothillier.spaces.live.com/blog/cns!8F5DEA8AEA9E6FBB!236.entry)创建用于记录的跟踪提供程序。

工作一种享受。

我应该澄清一下，我们为跟踪提供程序使用静态只读包装器

```
static readonly Log instance = new Log(); 
```

用代码注册自己

```
SPFarm farm = SPFarm.Local;
Guid traceGuid = farm.TraceSessionGuid;
unit result = NativeMethods.RegisterTraceGuids(ControlCallback, null, ref traceGuid, 0, IntPrt.Zero, null, null, out hTraceReg);
System.Diagnostics.Debug.Assert(result==NativeMethods.ERROR_SUCCESS, "TraceRegister result = " + result.ToString()); 
```

呸！

然后它只被实例化一次，我们使用析构函数取消注册它。

# .net - 如何防止 DateTime 在 SOAP xsd:dateTime 元素中包含区域偏移量？

> ID：247977
> 
> 赞同：6
> 
> 时间：2008-10-29T18:53:47.743
> 
> 标签：.net, datetime, soap

我在一些 WSDL 中有这个：

```
<element name="startDate" type="xsd:dateTime"/>
<element name="endDate" type="xsd:dateTime"/> 
```

这会在 SOAP 信封中产生以下文本：

```
<startDate>2008-10-29T12:01:05</startDate>
<endDate>2008-10-29T12:38:59.65625-04:00</endDate> 
```

只有一些时间有毫秒和区域偏移。这让我很头疼，因为在这个例子中我试图获得 37 分 54 秒的范围，但是由于偏移量，我最终得到了 4 小时 37 分 54.65625 秒。这是 DateTime 中的某种舍入错误吗？我该如何防止这种情况发生？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T08:13:53.150

我怀疑您的 endDate 值将 Kind 属性设置为 DateTimeKind.Local。

您可以将其更改为 DateTimeKind.Unspecified，如下所示：

```
endDate = DateTime.SpecifyKind(endDate, DateTimeKind.Unspecified) 
```

之后我相信它将在没有时区偏移的情况下进行序列化。

请注意，如果您使用 DateTime.Now 或 DateTime.Today 对其进行了初始化，您将获得带有 DateTimeKind.Local 的 DateTime；如果您使用 Datetime.UtcNow 对其进行了初始化，您将获得 DateTimeKind.Utc。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T19:28:07.907

你用什么来生成日期？如果您在代码中构建此 XML 而不是使用某些序列化程序（WCF 或 XmlSerializer），则可以使用 System.Xml.XmlConvert 生成和解释日期，如下所示：

创建要放入 XML 的字符串：

```
DateTime startDate = DateTime.Now;
string startDateString = System.Xml.XmlConvert.ToString(startDate); 
```

要从 XML 中获取日期：

```
DateTime startDateFromXml = System.Xml.XmlConvert.ToDateTime(startDateString); 
```

如果您从两个相差 37 分 54 秒的 DateTime 实例开始，然后将它们推送到 XML 中，那么在您将它们从 XML 中拉出之后，它们仍然会相差 37 分 54 秒。

# delphi - Midas/DataSnap 项目中的 DUnit 测试

> ID：247978
> 
> 赞同：2
> 
> 时间：2008-10-29T18:54:31.453
> 
> 标签：delphi, datasnap, dunit, midas-server

如何在 Delphi 2006 的 Midas/DataSnap 项目中设置 DUnit 测试

编辑

如何将 Dunit 测试设置到 TRemoteDataModule Delphi 2006 中的项目向导不适用于 TRemoteDataModule

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T19:14:12.037

这个问题并不完全有意义。单元测试在一个单独的项目中执行，而不是在您的 DataSnap 服务器中。通常，连接到数据库的测试是集成测试而不是单元测试。它到底是什么，正是您想要测试的？如果它是 TRemoteDataModule 中的实用程序方法，您应该将它们作为类方法提取到一个单独的类中，并在那里进行测试。您不必实例化应用程序服务器来执行单元测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-12-02T15:05:28.280

很抱歉上面的简洁答案，只要我在编辑帖子时点击返回，iPad就会发布。

dUnit 旨在执行单元测试，而您要做的不是单元测试。

如果满足以下条件，则测试不是单元测试：

*   它与数据库对话
*   它通过网络进行通信
*   它涉及文件系统
*   它不能与您的任何其他单元测试同时运行
*   你必须对你的环境做一些特殊的事情（比如编辑配置文件）来运行它。
*   它不能孤立运行

如果您遵循 SOLID 原则（尤其是单一职责原则），使用 dUnit 测试您的类（无需测试 Midas/DataSnap 相关逻辑）应该相当简单。实际上，您不需要测试 Midas/DataSnap 逻辑。

但是有一些方法可以对 Delphi 应用程序执行集成和行为测试。

就个人而言，我不会使用 TestComplete，因为它不能很好地与任何类型的 CI 服务器集成，并且测试以专有的二进制格式存储（这使得合并差异或维护任何源代码控制系统中的更改成为问题）。

您可以尝试[dSpec](http://sourceforge.net/projects/dspec/)，但我不确定 Jody Dawkins 是否会再维护它。

我在一些项目中直接使用了[AutoIt](http://www.autoitscript.com/site/autoit/) BASIC 脚本语言，并且还使用它的 .NET 程序集来驱动使用 NUnit 和 C# 的 Delphi 应用程序。虽然不完美，但 NUnit / C# 解决方案比我在执行功能 / 行为测试 Delphi 应用程序时看到的任何东西都要优雅。设置它确实需要一些努力。

# mpeg - 将 JPEG 文件转换为 MPEG 静止帧格式

> ID：247987
> 
> 赞同：1
> 
> 时间：2008-10-29T18:56:35.897
> 
> 标签：mpeg

有人知道如何将 JPEG 图像转换为 MPEG 静止帧格式吗？我很想用java来做，但是一个linux命令行过程就可以了。（我在代码项目上看到了一些对 c sharp 执行此操作的内容）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T18:59:50.227

我自己没有做过，但这里是将 JPEG 转换为 MPEG 的概述。我会看看使用FFMPEG。

概述链接：
[http](http://electron.mit.edu/~gsteele/ffmpeg/)
://electron.mit.edu/~gsteele/ffmpeg/ FFMPEG： http:
[//ffmpeg.mplayerhq.hu/](http://ffmpeg.mplayerhq.hu/)

# php - 显示一个没有页面模板的 Drupal 视图

> ID：247991
> 
> 赞同：39
> 
> 时间：2008-10-29T18:57:54.613
> 
> 标签：php, drupal, drupal-views

我想显示一个没有通常围绕它的页面模板的 Drupal 视图——我只想要视图节点的纯 HTML 内容。

此视图将包含在另一个非 Drupal 站点中。

我希望必须使用多个视图来执行此操作，因此让我快速轻松地设置这些视图的解决方案将是最好的 - 我不想每次都需要创建 .tpl.php 文件在某处包含一个视图。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-03-04T05:31:43.887

我正在寻找一种通过 ajax 提取节点数据的方法，并为 Drupal 6 提出了以下解决方案。在实现以下更改后，如果在 URL 中添加 ajax=1（例如 mysite.com/node/1?ajax= 1），你只会得到内容，没有页面布局。

在您的主题的 template.php 文件中：

```
function phptemplate_preprocess_page(&$vars) {

  if ( isset($_GET['ajax']) && $_GET['ajax'] == 1 ) {
        $vars['template_file'] = 'page-ajax';
  }

} 
```

然后使用以下内容在您的主题目录中创建 page-ajax.tpl.php：

```
<?php print $content; ?> 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-12-06T08:17:45.603

根据 Ufonion Labs 的回答，我可以通过在我的主题 template.php 中实现这两者来完全删除 Drupal 7 中页面内容周围的所有 HTML 输出，如下所示`hook_preprocess_page`：`hook_preprocess_html`

```
function MY_THEME_preprocess_page(&$variables) {
  if (isset($_GET['response_type']) && $_GET['response_type'] == 'embed') {
    $variables['theme_hook_suggestions'][] = 'page__embed';
  }
}

function MY_THEME_preprocess_html(&$variables) {
  if (isset($_GET['response_type']) && $_GET['response_type'] == 'embed') {
    $variables['theme_hook_suggestions'][] = 'html__embed';
  }
} 
```

然后我在我的主题中添加了两个模板`html--embed.tpl.php`：

```
<?php print $page; ?> 
```

和`page--embed.tpl.php`：

```
<?php print render($page['content']); ?> 
```

现在当我打开一个节点页面时，例如[http://example.com/node/3](http://example.com/node/3)，我照常看到完整的页面，但是当我添加 response_type 参数时，例如[http://example.com/node/ 3?response_type=embed](http://example.com/node/3?response_type=embed)，我*只*获取`<div>`页面内容，因此它可以嵌入到另一个页面中。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-10T20:01:23.580

我知道这个问题已经得到解答，但我想添加我自己的解决方案，它使用费城网页设计 (PWD) 答案的元素并使用 hook_theme_registry_alter，正如 Owen 所建议的那样。使用此解决方案，您可以直接从自定义模块加载模板。

首先，我将 raw.tpl.php 添加到模块内新创建的“模板”文件夹中。raw.tpl.php 的内容与 PWD 的 page-ajax.tpl.php 相同：

```
<?php print $content; ?> 
```

接下来，我以与 PWD 相同的方式在我的模块中实现了 hook_preprocess_page（除了我修改了 $_GET 参数并更新了模板文件引用：

```
function MY_MODULE_NAME_preprocess_page(&$vars) {
    if ( isset($_GET['raw']) && $_GET['raw'] == 1 ) {
        $vars['template_file'] = 'raw';
    }
} 
```

最后，我实现了 hook_theme_registry_alter 将我的模块的“模板”目录添加到主题注册表（基于[http://drupal.org/node/1105922#comment-4265700](http://drupal.org/node/1105922#comment-4265700)）：

```
function MY_MODULE_NAME_theme_registry_alter(&$theme_registry) {
   $modulepath = drupal_get_path('module','MY_MODULE_NAME');
   array_unshift($theme_registry['page']['theme paths'], $modulepath.'/templates');
} 
```

现在，当我将 ?raw=1 添加到视图的 URL 路径时，它将使用我模块中的指定模板。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-11T00:49:58.627

对于可能点击此页面的其他人，如果您只是使用标准回调（不一定是视图），这很容易。在您的回调函数中，不要返回要在页面内呈现的代码，而是使用“打印”函数。

例如：

```
function mymodule_do_ajax($node)
{
    $rval = <<<RVAL
        <table>
            <th>
                <td>Data</td>
                <td>Data</td>
                <td>Data</td>
            </th>
            <tr>
                <td>Cool</td>
                <td>Cool</td>
                <td>Cool</td>
            </tr>
        </table>
RVAL;

    //return $rval; Nope!  Will render via the templating engine.
    print $rval; //Much better.  No wrapper.
} 
```

干杯!

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-01-11T16:39:21.280

另一种我觉得非常方便的方法是添加一个带有不返回字符串的页面回调函数的菜单项：

例子：

```
/**
 * Implementation of hook_menu.
 */
function test_menu(){
  $items['test'] = array (
    /* [...] */ 
    'page callback' => 'test_callback',
    /* [...] */ 
  );
  return $items;
}

function test_callback() {
  // echo or print whatever you want
  // embed views if you want
  // DO NOT RETURN A STRING
  return TRUE;
} 
```

- 更新

`exit();`使用而不是`return TRUE;`（见评论）会更好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-29T23:15:02.100

假设您在 Drupal 6 中，最简单的方法是`phptemplate_views_view_unformatted_VIEWNAME`调用`template.php`（假设您的视图未格式化 - 如果它是其他内容，列表说，使用适当的主题功能）。然后在此主题调用中为视图结果设置主题，而不是像往常一样返回结果，打印它们并返回`NULL`。这将直接输出 HTML。

PS - 确保清除您的缓存（在 /admin/settings/performance）以查看这项工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-03-15T20:05:33.940

嘿，这是另一种方法：

1) 下载并安装 Views Bonus Pack ( [http://drupal.org/project/views_bonus](http://drupal.org/project/views_bonus) ) 2) 创建 Views 显示“Feed”并使用样式“XML”（或您认为更适合您需要的东西）。3) 如果您对标准的 XML 输出不满意，可以通过调整视图的模板来更改它。检查“主题”设置以获取有关此特定视图的替代模板名称的建议（因此您仍将保留默认的 XML 输出以供将来使用）。

祝你好运！//Johan Falk，NodeOne，瑞典

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-02-07T18:28:03.270

根据费城网页设计的回答（谢谢）和一些谷歌搜索（[http://drupal.org/node/957250](http://drupal.org/node/957250)），这对我在**Drupal 7**中有用，可以在没有模板的情况下显示所选页面：

```
function pixture_reloaded_preprocess_page(&$vars)
{
  if ( isset($_GET['vlozeno']) && $_GET['vlozeno'] == 1 ) {
        $vars['theme_hook_suggestions'][] = 'page__vlozeno';
  }   
} 
```

而不是 phptemplate，在 D7 中，函数名称中必须有 name_of_your_theme。另外，我必须在文件名的 php 变量中加上两个下划线 __，但实际的模板文件名需要两个破折号——

页面内容--vlozeno.tpl.php ：

```
<?php print render($page['content']); ?> 
```

然而，输出仍然有很多包装和主题的 CSS 引用。不知道如何输出完全没有主题的数据......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-29T19:11:39.500

可能有很多方法可以解决这个问题，但是，“最简单的”可能只是设置您自己的自定义主题，并且让 page.tpl.php 为空，或者一些随机的 div

```
// page.tpl.php
<div id="page"><?php print $content ?></div> 
```

这种方法基本上只允许 node.tpl.php 显示（或任何 drupal 的表单视图等），并且是避免修改核心或必须更改主题注册表以避免显示 page.tpl 的简单方法.php 放在首位。

**编辑**：见评论

好的，我玩了一下视图，看起来它接管并构建了自己的“node.tpl.php”（在某种意义上）以在“page.tpl.php”中显示。乍一看，我的直觉是迷上了`theme_registry_alter()`。

当您查看视图页面时，您可以访问此处的大量信息，以及 page.tpl.php 路径/文件。因此，我会做类似的事情：

```
function modulejustforalteration_theme_registry_alter(&$variables) {
  if (isset($variables['views_ui_list_views']) ) {
  // not sure if that's the best index to test for "views" but i imagine it'll work
  // as well as others
    $variables['page']['template'] = 'override_page';        
  }
} 
```

这应该允许您在当前主题中使用“override_page.tpl.php”模板，您可以在其中删除任何您想要的内容（作为我上面的第一个答案）。

一些东西：

*   正如我所说，不确定是否`views_ui_list_views`总是可以检查，但如果我们正在查看视图，听起来应该设置它
*   `theme paths`如果您愿意，可以更改`page`数组的 （更改 drupal 查找 page.tpl.php 的位置，而不是完全重命名它）
*   此特定视图似乎没有任何标识符，因此此方法可能是“所有视图都将被剥离”的方法。如果您只需要为特定视图剥离 page.tpl.php，也许挂钩`template_preprocess_page()`可能是一个更好的主意。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-03T20:16:05.900

我喜欢 Drupal 模块。但是，这是另一种方式。

将主题文件夹中的 page.tpl.php 复制到名为 page-VIEWNAME.tpl.php 的新文件中，其中 VIEWNAME 是视图的机器可读名称。

然后编辑 page-VIEWNAME.tpl.php 以适应。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-23T01:16:28.090

还有[http://drupal.org/project/pagearray](http://drupal.org/project/pagearray)这是一个通用的解决方案......

此外，@Scott Evernden 的解决方案是跨站脚本 (XSS) 安全漏洞。不要那样做。阅读 drupal.org 上有关如何以安全方式处理文本的文档[http://drupal.org/node/28984](http://drupal.org/node/28984)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-01-14T17:02:27.523

一种显示您希望显示的特殊内容类型的内容的简单方法，而无需`page.tpl.php`:
将以下代码段添加到您的`template.php`文件中：

```
function mytheme_preprocess_page(&$vars) {
  if ($vars['node'] && arg(2) != 'edit') {
      $vars['template_files'][] = 'page-nodetype-'. $vars['node']->type;
    }
} 
```

`page-nodetype-examplecontenttype.tpl.php`向您的主题添加一个，例如您的，`page.tpl.php`但没有您不想`print $content`在正文中显示的内容。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-29T19:27:20.780

如果我理解您的问题，您希望拥有包含页面所有 HTML 的节点，从 DOCTYPE 到 </HTML>。我要做的是为这些节点创建一个内容类型——“fullhtml”作为它的机器可读名称——然后为它创建一个名为 node-fullhtml.tpl.php 的节点模板。您不能只转储节点的内容，因为它们已经过 HTML 过滤。node.fullhtml.tpl.php 实际上就是这样：

```
echo htmlspecialchars_decode($content); 
```

然后，您需要一种方法来覆盖标准 page.tpl.php。我*认为*您可以做的是在 page.tpl.php 的顶部检查 $node 的内容类型，如果它是 fullhtml 则退出。或者，在 node-fullhtml.tpl.php 中设置 page.tpl.php 将检查的全局变量。

我不是 Drupal 专家，但我就是这样做的。我说的是即兴表演，所以要注意细节中的魔鬼。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-10T08:32:40.163

我看到你已经把自己变成了一个模块，所以这可能不再有帮助，但是很容易获得公开 rss 提要的视图，这可能是获取内容的更简单方法，特别是如果你想要将其包含在不同的站点上。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-08-27T02:30:53.133

在 D7 上，您可以使用[menu_execute_active_handler](https://api.drupal.org/api/drupal/includes%21menu.inc/function/menu_execute_active_handler/7)

```
$build = menu_execute_active_handler('user', FALSE);
return render($build); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-08-01T08:07:06.193

杰罗恩的回答是玩过它后对我有什么影响。我有一个 Drupal 7 站点。

1.  首先确保您替换`MY_THEME`为您的主题名称。是的，这很明显，但大多数新手都错过了这一点。

2.  我其实已经有一个`function MY_THEME_preprocess_page(&$variables) {`. 然后不要重新创建函数，而是在函数末尾添加此代码，然后再使用`}`.

* * *

```
if (isset($_GET['response_type']) && $_GET['response_type'] == 'embed') {
  $variables['theme_hook_suggestions'][] = 'page__embed';
} 
```

3.  我的函数`$vars`不使用`$variables`，所以我也必须更新它。如果您认为寻找它，这又是显而易见的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-08-02T10:15:20.230

我的第一个答案只允许我在 Web 浏览器中调用它时显示该节点。然而，这样做的最终目标是使用 iframe 将 drupal 节点嵌入到第三方站点中。

由于 Drupal [Core 7.50 iframe 的发布默认被阻止以防止 Clickjacking](https://www.drupal.org/node/2735873)

要仅让节点成功嵌入第 3 方站点，您还需要覆盖 x-frame 默认设置。我在 template.php 中添加以下内容后，一切都开始工作了

```
function MY_THEME_page_alter($page) {

 if (isset($_GET['response_type']) && $_GET['response_type'] == 'embed') {
   header_remove('X-Frame-Options');
 } 
} 
```**`***********