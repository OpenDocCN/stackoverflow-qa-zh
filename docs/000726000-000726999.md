# StackOverflow 问答 000726000-000726999

# c++ - C2065 将定义分配给 int 时未声明的标识符

> ID：726002
> 
> 赞同：0
> 
> 时间：2009-04-07T14:24:55.597
> 
> 标签：c++, compiler-errors, c-preprocessor

我有一个定义的小问题。我想将它分配给一个整数变量，但编译器说它未声明。

下面是代码的样子：defines.h

```
#ifndef DEFINES_H
#define DEFINES_H

#define MYDEFINE 2

#endif 
```

我的班级.h

```
namespace mynamespace {
class myClass {
    int someFunction();
};
} 
```

我的班级.cxx

```
#include "defines.h"
#include "myclass.h"
namespace mynamespace {
int myClass::someFunction() {
    int var = MYDEFINE;
    return 0;
}
} 
```

根据 int 赋值，会发​​生编译器错误。我还尝试使用另一个定义，定义在与上面相同的头文件中，作为具有相同效果的函数参数。有任何想法吗？提前致谢。

我知道使用定义是一个坏习惯，但我只扩展现有项目并尝试保持他们的设计方式。

编辑：错误消息很简单：`Fehler 1 error C2065: 'MYDEFINE': nichtdeklarierter Bezeichner ...`正如您所见，这不是真正的源代码，但我认为我在整理问题时非常小心。

EDIT2：感谢#warning 的提示。在不同的文件夹中有 2 个同名文件。我不知道为什么编译器没有提出这个。无论如何，它现在有效。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:31:25.657

您应该检查是否真正定义了符号 MYDEFINE。

检查声明它的头文件是否真的被包含（和编译）。在定义附近使用#warning 以确保它是为 myclass.cxx 编译的：

```
#ifndef DEFINES_H
#define DEFINES_H

#define MYDEFINE 2
#warning My define is defined

#endif 
```

如果它没有编译（您不会在编译日志中找到警告消息），请搜索 DEFINES_H。它可能已经在其他地方定义了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T14:33:32.487

让我们把它们放在一起：

```
 #ifndef DEFINES_H
    #define DEFINES_H
    #define MYDEFINE 2
    #endif

    namespace mynamespace {
    class myClass {
        int someFunction();
    };    // note ; missing in your code
    }

    namespace mynamespace {
    int myClass::someFunction() {
        int var = MYDEFINE;
        return 0;
    } 
```

这编译没有错误，所以你的#includes有问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T14:35:17.847

它可能是在抱怨你没有宣布你的班级。尝试#include "myclass.h"

编辑：

哦，缺少';' 在你的班级声明之后。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T14:27:44.293

其他一些头文件也使用DEFINES_H？

#pragma once 的一个论点...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T14:38:52.987

您需要查看预处理器对您的代码执行的操作 - 尝试使用 -P 标志编译 myclass.cxx 并检查生成的 .i 文件。

# gcc - 使用 gcc 链接共享库

> ID：726014
> 
> 赞同：41
> 
> 时间：2009-04-07T14:27:40.050
> 
> 标签：gcc, linker, shared-libraries

我在 windows 目标上使用 Real View Compiler Tools (RVCT 3.2) 创建了一个共享库 (*.so)。然后我尝试在 linux 系统上使用 gcc 将此 *.so 文件与我的应用程序链接。

将此共享库与我的应用程序 linux 链接的 gcc 选项是什么？

我的问题是，是`-shared`选项，它被用作

```
gcc -shared myfile.so 
```

...，用于创建 SO 文件或链接 SO 文件？我相信它会产生类似的东西：

```
gcc -lmyfile.so 
```

这够了吗？或者是否有任何其他开关告诉链接器它是一个动态库（共享对象）？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2014-11-03T11:31:59.867

对我有用的是：

```
gcc -L. -l:myfile.so 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-07T15:41:17.300

`gcc -lmyfile`应该足够了（前提是您的库名为`libmyfile.so`）。链接器尽可能搜索共享对象，AFAIK 更喜欢它们。

# c++ - 类似文件夹树浏览器的 Windows 资源管理器

> ID：726016
> 
> 赞同：0
> 
> 时间：2009-04-07T14:28:08.693
> 
> 标签：c++, windows, treeview, wxwidgets, directory

我正在尝试实现一个独立于平台的文件/目录树浏览器。基本上，我正在尝试复制 Windows 资源管理器的树控件来浏览计算机。但是，我不知道如何找到“桌面”或“我的电脑”文件夹字符串（它在每台电脑和操作系统类型、版本和语言中都会发生变化）。如果我能找到一种方法来获取最顶层的文件夹字符串，那么我就可以遍历并充满希望地填充树。某处是否有注册表字符串？

最初，我只针对 MS Windows 操作系统（XP、Vista 等），但后来我也计划支持 Linux 和 Mac。我将 wxWidgets 用于我的 GUI，但我愿意接受针对此特定问题的所有建议。哦，我在 VS2008 中使用 C++。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:49:19.687

忽略可移植性，您需要的是“PIDL”树。PIDL 是文件路径的概括。[您可以使用SHGetFolderLocation](http://msdn.microsoft.com/en-us/library/bb762180.aspx)获取特殊文件夹的PIDL 。桌面是`CSIDL_DESKTOP`（*不是* `CSIDL_DESKTOPDIRECTORY`），我的电脑是`CSIDL_DRIVES`。

要将 PIDL 转换为名称，请查看[SHGetNameFromIDList](http://msdn.microsoft.com/en-us/library/bb762191.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:42:46.660

看看[SHGetFolderPath](http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx)函数。

# c# - C# 中的属性

> ID：726029
> 
> 赞同：38
> 
> 时间：2009-04-07T14:31:29.823
> 
> 标签：c#, .net, attributes

我知道 C#（和一般的 .NET）在属性上很重要。然而，尽管我已经使用 C# 编程多年，但我发现自己从未使用过它们。有人可以让我开始使用它们，并解释在哪里最好使用它们吗？

谢谢

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-07T14:36:17.270

来自[Pro C# 2008 和 .NET 3.5 平台，第四版，作者 Andrew Troelsen](https://rads.stackoverflow.com/amzn/click/com/1590598849)

# 理解属性化编程

.NET 编译器的一个作用是为所有定义和引用的类型生成元数据描述。除了包含在任何程序集中的标准元数据之外，.NET 平台还为程序员提供了一种使用属性将其他元数据嵌入到程序集中的方法。简而言之，属性只不过是可以应用于给定类型（类、接口、结构等）、成员（属性、方法等）、程序集或模块的代码注释。使用属性注释代码的想法并不新鲜。COM IDL 提供了许多预定义的属性，允许开发人员描述给定 COM 服务器中包含的类型。然而，COM 属性只不过是一组关键字。如果 COM 开发人员需要创建自定义属性，他或她可以这样做，但它在代码中被一个 128 位数字 (GUID) 引用，这充其量是很麻烦的。与 COM IDL 属性（同样只是关键字）不同，.NET 属性是扩展抽象 System.Attribute 基类的类类型。在探索 .NET 命名空间时，您会发现许多可以在应用程序中使用的预定义属性。此外，您可以自由构建自定义属性，通过创建派生自 Attribute 的新类型来进一步限定类型的行为。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。与 COM IDL 属性（同样只是关键字）不同，.NET 属性是扩展抽象 System.Attribute 基类的类类型。在探索 .NET 命名空间时，您会发现许多可以在应用程序中使用的预定义属性。此外，您可以自由构建自定义属性，通过创建派生自 Attribute 的新类型来进一步限定类型的行为。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。与 COM IDL 属性（同样只是关键字）不同，.NET 属性是扩展抽象 System.Attribute 基类的类类型。在探索 .NET 命名空间时，您会发现许多可以在应用程序中使用的预定义属性。此外，您可以自由构建自定义属性，通过创建派生自 Attribute 的新类型来进一步限定类型的行为。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。在探索 .NET 命名空间时，您会发现许多可以在应用程序中使用的预定义属性。此外，您可以自由构建自定义属性，通过创建派生自 Attribute 的新类型来进一步限定类型的行为。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。在探索 .NET 命名空间时，您会发现许多可以在应用程序中使用的预定义属性。此外，您可以自由构建自定义属性，通过创建派生自 Attribute 的新类型来进一步限定类型的行为。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。了解当您在代码中应用属性时，嵌入的元数据基本上是无用的，直到另一个软件明确反映信息。如果不是这种情况，则嵌入在程序集中的元数据简介将被忽略并且完全无害。

# 属性消费者

正如您所猜想的那样，.NET 3.5 Framework SDK 附带了许多实用程序，这些实用程序确实在寻找各种属性。C# 编译器 (csc.exe) 本身已经过预编程，可以在编译周期中发现各种属性的存在。例如，如果 C# 编译器遇到 [CLSCompliant] 属性，它将自动检查属性项以确保它仅公开符合 CLS 的构造。再举一个例子，如果 C# 编译器发现一个具有 [Obsolete] 属性的项目，它将在 Visual Studio 2008 错误列表窗口中显示编译器警告。除了开发工具之外，.NET 基类库中的许多方法都经过预编程以反映特定属性。例如，如果您希望将对象的状态保存到文件中，您需要做的就是使用 [Serializable] 属性注释您的类。如果 BinaryFormatter 类的 Serialize() 方法遇到此属性，则对象会自动以紧凑的二进制格式保存到文件中。.NET CLR 也在寻找某些属性的存在。也许最著名的 .NET 属性是 [WebMethod]。如果您希望通过 HTTP 请求公开方法并自动将方法返回值编码为 XML，只需将 [WebMethod] 应用于方法，CLR 会处理详细信息。除了 Web 服务开发之外，属性对于 .NET 安全系统、Windows Communication Foundation 和 COM/.NET 互操作性（等等）的运行也至关重要。最后，您可以自由构建经过编程以反映您自己的自定义属性以及 .NET 基类库中的任何属性的应用程序。通过这样做，您基本上可以创建一组特定程序集可以理解的“关键字”。

# 在 C# 中应用属性

.NET 基类库在各种命名空间中提供了许多属性。下面是一些（但绝不是全部）预定义属性的快照。

## 预定义属性的小样本

[符合 CLS]

强制带注释的项目符合公共语言规范 (CLS) 的规则。回想一下，保证 CLS 兼容的类型可以在所有 .NET 编程语言中无缝使用。

[DLL导入]

允许 .NET 代码调用任何基于 C 或 C++ 的非托管代码库，包括底层操作系统的 API。请注意，在与基于 COM 的软件通信时不使用 [DllImport]。

[过时的]

标记不推荐使用的类型或成员。如果其他程序员尝试使用这样的项目，他们将收到一个编译器警告，描述他们的方式错误。

[可序列化]

将类或结构标记为“可序列化”，这意味着它能够将其当前状态持久化到流中。

[非序列化]

指定在序列化过程中不应保留类或结构中的给定字段。

[网络方法]

将方法标记为可通过 HTTP 请求调用，并指示 CLR 将方法返回值序列化为 XML。

# 构建自定义属性

构建自定义属性的第一步是创建一个派生自 System.Attribute 的新类。例子：

```
// A custom attribute.
public sealed class VehicleDescriptionAttribute : System.Attribute
{
    private string msgData;

    public VehicleDescriptionAttribute(string description)
    {
        msgData = description;
    }

    public VehicleDescriptionAttribute() { }

    public string Description
    {
        get { return msgData; }
        set { msgData = value; }
    }
} 
```

如您所见，VehicleDescriptionAttribute 维护一个私有内部字符串 (msgData)，可以使用自定义构造函数设置该字符串并使用类型属性 (Description) 进行操作。除了此类从 System.Attribute 派生的事实之外，此类定义没有任何独特之处。

出于安全原因，将所有自定义属性设计为密封的被认为是 .NET 最佳实践。事实上，Visual Studio 2008 提供了一个名为 Attribute 的代码片段，它将转储出一个新的 System。将属性派生类放入您的代码窗口。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T14:35:21.093

属性在针对其他程序员或程序不同部分之间的代码中得到更多使用，而不是针对最终用户的代码。

例如，您可以使用属性导入 dll，指示类型如何与 Visual Studio 交互（设计器可见、智能感知帮助、调试器逐步执行等），如何序列化它们，指示类型已过时，描述默认值，描述、处理 COM 访问等。

这些对最终用户来说基本上是不可见的，并且单个程序员可以将它们放在源代码的其他位置。但是当只有编译的二进制文件可用而不是源代码时，它们很有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-07T14:40:47.150

我喜欢将属性用作代码的元数据。我们创建了一些简单的属性，让我们可以标记谁编写了哪些代码、何时以及为什么。这让我们在代码和运行时都记录了更改。如果在运行时出现任何异常，我们可以检查调用堆栈，沿途查看方法上的任何属性，并追踪负责人：

```
[Author("Erich", "2009/04/06", Comment = "blah blah blah")]
public void MyFunction()
{
...
} 
```

当然，我们可以使用我们的源代码管理来查看谁签入了哪些代码，但我发现这使得信息在您需要的地方更容易获得。此外，如果我们更改源代码控制，该信息将不会丢失，因为它保留在代码中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T14:38:45.017

属性是一种声明式编程形式，“类似于”在 XAML 中创建 UI。它使用属性“标记”代码片段（类、方法、属性等），以便您以后可以收集所有以特定方式标记的片段，然后对所有这些片段执行标准操作。

例如。考虑这样一种场景，您希望在每次应用启动时运行一次特定的代码部分。在一种编程模型（非属性）中，您转到 main 方法并显式调用这些 init 方法。使用属性，您只需收集所有用“init”属性标记的方法，并通过反射调用它们。

同样的模式也适用于序列化、持久性和诸如此类的操作......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T13:19:24.497

我使用以下属性：

*   与插件架构通信
*   告诉另一个框架如何处理代码（例如 NUnit）
*   添加元数据以与其他代码一起使用（请参阅 PropertyGrid）
*   将对象映射到数据库（参见 Castle ActiveRecord）
*   在编写我自己的 API 以允许用户交流元数据时
*   在框架代码中告诉调试器跳过它

这些都不在我的脑海里。我在许多其他地方使用它们

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T14:38:10.417

我相信您的意思是您不使用（或经常使用）自定义属性？

在我当前的项目中，我大量使用自定义属性，但是，您需要牢记在心的事实是，使用属性本身不应该是一个目标。

这是获得给定解决方案的工具/目的。

我有时将自定义属性与 PostSharp 之类的编织器结合使用，以装饰应在编译时应用某些编织的方法。

在我当前的项目中，我还使用属性来用附加信息装饰某些类型......但我相信我之前已经在这里发布过： [Cool uses of Attributes or Annotations (CLR or Java)?](https://stackoverflow.com/questions/486815/486872#486872)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T14:37:17.750

属性非常擅长描述代码的某些运行时行为，这些行为与相关代码正交。例如，在一个名为 Customer 的类中，您会为客户建模，对吗？但是您可能不想建模或描述 Customer 对象的序列化方式。

向您的客户类添加属性允许您告诉运行时的其他部分它应该如何处理您的客户。

MSTest 和 NUnit 使用属性来告诉测试框架它应该如何使用定义测试夹具的类。

ASP.NET MVC 使用属性来告诉 mvc 框架它应该将类上的哪些方法视为控制器操作。

因此，任何您希望对属性建模的运行时行为的地方都会很有用。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-01-04T10:44:50.537

类属性定义可在此处获得

[ClassInterfaceAttribute](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.classinterfaceattribute(v=vs.110).aspx)：指示要为暴露给 COM 的类生成的类接口的类型（如果生成了接口）。

[ComDefaultInterfaceAttribute](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.comdefaultinterfaceattribute(v=vs.110).aspx)：指定要公开给 COM 的默认接口。这个类不能被继承。

[ComVisibleAttribute](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.comvisibleattribute(v=vs.110).aspx)：控制单个托管类型或成员，或程序集中的所有类型对 COM 的可访问性。

# fsm - FSM数据结构设计

> ID：726032
> 
> 赞同：6
> 
> 时间：2009-04-07T14:32:14.423
> 
> 标签：fsm

我想编写一个 FSM，它以空闲状态开始，并根据某些事件从一种状态移动到另一种状态。我不熟悉 FSM 的编码，谷歌没有帮助。感谢有人可以发布可用于相同的 C 数据结构。

谢谢， syuga2012

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T14:53:50.613

我们过去为电信公司实现了有限状态机，并且总是使用一组结构，预填充如下：

```
/* States */
#define ST_ANY    0
#define ST_START  1
: : : : :

/* Events */
#define EV_INIT   0
#define EV_ERROR  1
: : : : :

/* Rule functions */
int initialize(void) {
    /* Initialize FSM here */
    return ST_INIT_DONE
}
: : : : :

/* Structures for transition rules */
typedef struct {
    int state;
    int event;
    (int)(*fn)();
} rule;
rule ruleset[] = {
    {ST_START, EV_INIT, initialize},
    : : : : :
    {ST_ANY, EV_ERROR, error},
    {ST_ANY, EV_ANY, fatal_fsm_error}
}; 
```

我可能将函数指针`fn`声明错误，因为这是来自内存。基本上，状态机在数组中搜索相关的状态和事件，并调用执行必须完成的操作的函数，然后返回新状态。

由于规则的优先级取决于它们在数组中的位置，因此将特定状态放在首位，ST_ANY 条目放在最后。找到的第一个规则是使用的规则。

另外，我记得我们对每个状态的第一条规则都有一个索引数组，以加快搜索速度（所有具有相同起始状态的规则都被分组）。

另请记住，这是纯 C 语言 - 可能有更好的方法来使用 C++ 来实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-08T00:50:17.347

有限状态机由有限数量的离散状态组成（我知道很迂腐，但仍然如此），通常可以表示为整数值。在 c 或 c++ 中，使用枚举是很常见的。

机器响应有限数量的输入，这些输入通常可以用另一个整数值变量表示。在更复杂的情况下，您可以使用结构来表示输入状态。

内部状态和外部输入的每种组合都会导致机器：

1.  可能转换到另一个状态
2.  可能产生一些输出

c 中的一个简单案例可能如下所示

```
enum state_val {
   IDLE_STATE,
   SOME_STATE,
   ...
   STOP_STATE
}
//...    
  state_val state = IDLE_STATE
  while (state != STOP_STATE){
    int input = GetInput();
    switch (state) {
    case IDLE_STATE:
      switch (input) {
        case 0:
        case 3: // note the fall-though here to handle multiple states
          write(input); // no change of state
          break;
        case 1: 
          state = SOME_STATE;
          break
        case 2:
          // ...
      };
      break;
    case SOME_STATE:
      switch (input) {
        case 7:
          // ...
      };
      break;
    //...
    };
  };
  // handle final output, clean up, whatever 
```

虽然这很难阅读并且更容易通过以下方式拆分为多个功能：

```
 while (state != STOP_STATE){
     int input = GetInput();
     switch (state) {
     case IDLE_STATE:
       state = DoIdleState(input);
       break;
     // ..
     };
  }; 
```

每个州的复杂性都在它自己的功能中。

正如[m3rLinEz 所说](https://stackoverflow.com/questions/726032/fsm-data-structure-design/726090#726090)，您可以将转换保存在数组中以进行快速索引。您还可以将函数指针保存在数组中以有效地处理动作阶段。这对于自动生成大型复杂状态机特别有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-08T01:25:50.317

这里的答案似乎真的很复杂（但仍然准确）。所以这是我的想法。

首先，我喜欢 dmckee 对 FSM 的（操作）定义以及它们如何应用于编程。

> 有限状态机由有限数量的离散状态组成（我知道很迂腐，但仍然如此），通常可以表示为整数值。在 c 或 c++ 中，使用枚举是很常见的。
> 
> 机器响应有限数量的输入，这些输入通常可以用另一个整数值变量表示。在更复杂的情况下，您可以使用结构来表示输入状态。
> 
> 内部状态和外部输入的每种组合都会导致机器：
> 
> 1.  可能转换到另一个状态
> 2.  可能产生一些输出

所以你有一个程序。它有状态，并且它们的数量是有限的。（“灯泡亮”或“灯泡暗”或“灯泡熄灭。”3 种状态。有限。）您的程序一次只能处于一种状态。

所以，假设你希望你的程序改变状态。通常，您会希望发生一些*事情*来触发状态更改。在这个例子中，我们如何通过用户输入来确定状态——比如按键。

你可能想要这样的逻辑。当用户按键时：

1.  如果灯泡“关闭”，则使灯泡“变暗”。
2.  如果灯泡“暗”，就让灯泡“亮”。
3.  如果灯泡“亮”，则将灯泡“关闭”。

显然，您可能不是“更改灯泡”，而是“更改文本颜色”或您的程序需要做的任何事情。在开始之前，您需要定义您的状态。

所以看看一些伪 C 代码：

```
/* We have 3 states. We can use constants to represent those states */
#define BULB_OFF 0
#define BULB_DIM 1
#define BULB_BRIGHT 2

/* And now we set the default state */
int currentState = BULB_OFF;

/* now we want to wait for the user's input. While we're waiting, we are "idle" */
while(1) {
   waitForUserKeystroke(); /* Waiting for something to happen... */

   /* Okay, the user has pressed a key. Now for our state machine */

   switch(currentState) {
      case BULB_OFF:
         currentState = BULB_DIM;
         break;
      case BULB_DIM:
         currentState = BULB_BRIGHT;
         doCoolBulbStuff();
         break;
      case BULB_BRIGHT:
         currentState = BULB_OFF;
         break;
   }
} 
```

而且，瞧。一个改变状态的简单程序。

此代码仅执行语句的一小部分`switch`- 取决于*当前*状态。然后它会*更新*该状态。这就是 FSM 的工作方式。

现在这里有一些你可以做的事情：

1.  显然，这个程序只是改变了`currentState`变量。你会希望你的代码在状态改变时做一些更有趣的事情。我不知道，该`doCoolBulbStuff()`功能实际上可能会将灯泡的图片放在屏幕上。或者其他的东西。

2.  此代码仅查找按键。但是您的 FSM（以及您的 switch 语句）可以根据用户输入的内容来选择状态（例如，“O”的意思是“关闭”，而不仅仅是进入序列中的下一个。）

您的部分问题要求数据结构。

一个人建议使用`enum`来跟踪状态。这是`#defines`我在示例中使用的一个很好的替代方法。人们也一直在建议使用数组——这些数组跟踪状态之间的转换。这也是一个很好的结构。

鉴于上述情况，您可以使用任何类型的结构（类似树的东西、数组、任何东西）来跟踪各个状态并定义在每个状态下要做什么（因此一些建议使用“函数指针" - 有一个指向函数指针的状态映射，它指示在该状态下要做什么。）

希望有帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T14:42:02.857

有关正式定义，请参见[Wikipedia](http://en.wikipedia.org/wiki/Finite_state_machine#Mathematical_model)。你需要决定你的状态集*S*，你的输入字母 Σ 和你的转换函数 δ。最简单的表示是让*S*是整数 0、1、2、...、*N* -1 的集合，其中*N*是状态数，而 Σ 是整数 0、1、2、...的集合。 ., *M* -1，其中*M*是输入的数量，然后 δ 只是一个大的*N* × *M*矩阵。*最后，您可以通过存储N*位数组来存储接受状态集，其中第*i*位为 1，如果*i*th state 是接受状态，如果不是接受状态，则为 0。

例如，这里是 Wikipedia 文章图 3 中的 FSM：

```
#define NSTATES 2
#define NINPUTS 2
const int transition_function[NSTATES][NINPUTS] = {{1, 0}, {0, 1}};
const int is_accepting_state[NSTATES] = {1, 0};

int main(void)
{
    int current_state = 0;  // initial state
    while(has_more_input())
    {
        // advance to next state based on input
        int input = get_next_input();
        current_state = transition_function[current_state][input];
    }

    int accepted = is_accepting_state[current_state];
    // do stuff
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T14:42:33.137

您基本上可以使用“if”条件和变量来存储 FSM 的当前状态。

例如（只是一个概念）：

```
int state = 0;
while((ch = getch()) != 'q'){
    if(state == 0)
        if(ch == '0')
            state = 1;
        else if(ch == '1')
            state = 0;
    else if(state == 1)
        if(ch == '0')
            state = 2;
        else if(ch == '1')
            state = 0;
    else if(state == 2)
    {
        printf("detected two 0s\n");
        break;
    }
} 
```

对于更复杂的实现，您可以考虑将状态转换存储在二维数组中：

```
int t[][] = {{1,0},{2,0},{2,2}};
int state = 0;

while((ch = getch()) != 'q'){
    state = t[state][ch - '0'];
    if(state == 2){
        ...
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-06T20:26:01.240

AT&T 的几个人，现在在谷歌，写了一个最好的可用于一般用途的 FSM 库。在这里查看它，它被称为[OpenFST](http://www.openfst.org/)。

它快速、高效，并且他们创建了一组非常清晰的操作，您可以在 FSM 上执行这些操作，以执行诸如最小化它们或确定它们以使它们对现实世界问题更有用的事情。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T14:47:26.367

如果 FSM 是指有限状态机，并且您喜欢它简单，请使用枚举来命名您的状态并在它们之间切换。

否则使用函子。您可以在 stl 或 boost 文档中查看花哨的定义。

它们或多或少是对象，有一个名为 run() 的方法，它执行在该状态下应该完成的所有事情，其优点是每个状态都有自己的范围。

# webbrowser-control - 有没有办法阻止使用 ctrl + 鼠标滚轮调整网页中文本大小的可能性

> ID：726036
> 
> 赞同：0
> 
> 时间：2009-04-07T14:33:06.247
> 
> 标签：webbrowser-control, cross-browser, browser

我想也许使用 javascript 我会这样做....但是如果有人知道更好更快的方法来做到这一点..我很容易理解任何想法...谢谢！...

这是为了让用户无法看到糟糕的页面，增加文本或在浏览器中进行诸如放大之类的操作...

我有一些质量检查工程师问我......

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T14:37:05.817

从可用性/可访问性的角度来看，这是一个非常糟糕的主意。请不要这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:35:21.717

即使您阻止了该组合键，用户仍然可以通过“查看”菜单增加缩放级别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T15:00:32.577

你没有给出一个很好的理由，我怀疑有一个，所以我同意你不应该这样做。虽然这是一个有趣的小挑战，所以我有一个可能的答案，虽然我真的不知道它是否会起作用。

首先，`font-size: 70%`在最外层的包含元素中有一个或任何你想要的百分比。

然后，使用以下命令创建一个虚拟测试元素：

```
display:block;
position:absolute;
visibility:hidden;
font-size:1em;
font-family:Arial; 
```

找到元素的实际高度（比如 25px），然后在计时器上一遍又一遍地测试它（window.setInterval()）。如果不匹配，请更改外部元素的字体大小百分比，直到匹配为止。

# objective-c - 如何使用 NSPropertyListXMLFormat_v1_0 格式的 NSKeyedArchiver 将对象序列化为文件？

> ID：726053
> 
> 赞同：0
> 
> 时间：2009-04-07T14:36:04.507
> 
> 标签：objective-c, cocoa, nskeyedarchiver

希望这个标题足够清楚。无论如何，似乎：

```
[NSKeyedArchiver archiveRootObject:rootObject toFile:path]; 
```

限于`NSPropertyListBinaryFormat_v1_0`。

我需要格式是人类可读的 [so xml]。如果您有兴趣，这是项目的一部分，我最终将在 github 上发布一篇关于“如何对 GPS 应用程序进行单元测试”的博文

:-)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T14:48:58.627

你必须使用`NSPropertyListSerialization`它来转换它。基本上，假设您正在序列化的对象被调用`myObject`并且最终文件存储在 中`myPath`，您可以使用类似于以下代码片段的方式将其序列化为 XML：

```
NSString *error = nil;
NSData *mySerializedObject = [NSKeyedArchiver archivedDataWithRootObject:myObject];
NSData *xmlData = [NSPropertyListSerialization dataFromPropertyList:mySerializedObject
                        format:NSPropertyListXMLFormat_v1_0
                        errorDescription:&error]:
if( xmlData ) {
    [xmlData writeToFile:myPath atomically:YES];
} else {
    NSLog(error);
    [error release];
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T14:58:04.457

尝试创建 NSKeyedArchiver 的实例并使用`setOutputFormat:NSPropertyListXMLFormat_v1_0`来指定 XML 格式，而不是使用类方法。唯一的缺点是它需要几行额外的代码，因为要实际处理序列化，它不会只在一个步骤中返回一个 NSData 对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-20T07:37:40.760

您必须使用方法 -(void) encodeWithCoder(NSCoder *)encoder { 对对象类进行编码

```
[coder encodeObject:name forKey:@"name"];
[coder encodeObject:address forKey:@"address"];
[coder encodeObject:position forKey:@"position"]; 
```

}

# asp.net - 动态 XML

> ID：726057
> 
> 赞同：0
> 
> 时间：2009-04-07T14:36:54.863
> 
> 标签：asp.net, xml

在不创建和保存文件的情况下生成 XML 的理想方法是什么？

我正在考虑使用带有代码的 ASP.NET 页面将标记生成为 XML。

这可能吗？或者你有其他方法吗？

我有一个读取 XML 文件的 flash 组件，我需要动态生成这个文件。我没有写权限，所以我无法创建和保存文件。

我正在考虑有一个应用程序页面来获取数据并提供属性方法以在 Settings.xml.aspx 页面上使用 Settings.xml.aspx.cs 代码隐藏生成 xml。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T14:43:38.327

最简单的方法是使用`System.Xml.XmlDocument`或`System.Xml.Linq.XDocument`建立文档。两者都可以流式传输到`Response.OutputStream`.

最平滑的方法（特别是如果您关闭缓冲）只是创建一个`XmlTextWriter`圆形`Response.OutputStream`. 这是生成 XML 的仅向前的方法，但如果输出很大，则意味着您需要更少的内存并且内容开始更早地到达客户端。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T14:40:06.713

[System.Xml.XmlDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx) ?

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:41:33.713

事实上，有很多方法可以做到这一点。这一切都取决于您的需求。也许您可以查看一些`XDocument`（或`XmlDocument`在 .NET 2.0 中）的示例，并且这些示例`XmlWriter`都不需要您将 XML 保存到文件中。您可以在使用时将对象模型保存在内存中，也可以在使用时写入`XDocument`a ：`MemoryStream``XmlWriter`

```
XmlWriterSettings settings = new XmlWriterSettings();
settings.Indent = true;

using (System.IO.MemoryStream stream = new System.IO.MemoryStream())
{
    using (XmlWriter writer = XmlWriter.Create (stream, settings))
    {
      writer.WriteStartElement ("customer");
      writer.WriteElementString ("firstname", "Jim");
      writer.WriteElementString ("lastname"," Bo");
      writer.WriteEndElement();
    }
    // do further processing with the stream
} 
```

两者之间的区别基本上是第一个允许您访问 DOM，而第二个只是将 XML 写入底层流。

不幸的是，在不知道更多细节的情况下，这个问题只能模糊地回答。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T14:41:22.950

是的，“动态”生成 XML 是完全可行的。看一下[XmlDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)类。还有更多信息[在这里](http://support.microsoft.com/kb/301233)。

# .net - 安装网站时如何在 GAC 中注册程序集？

> ID：726065
> 
> 赞同：0
> 
> 时间：2009-04-07T14:38:03.693
> 
> 标签：.net, asp.net, deployment, gac

我正在开发一个依赖第三方控件的项目。安装后打开网站时，我收到有关这些控件的错误消息，

```
 Could not load file or assembly. assembly_file_name. 
The system cannot find the file specified. 
```

web.config 文件，每个 dll 都有一个程序集标签。当我删除这些标签时，网站已成功加载，但在打开包含任何这些控件的任何页面时，我有那个错误

```
Unknown server tag. tag_name. 
```

所以我需要在安装时在 GAC 中注册那个 dll 吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T14:39:30.460

要么将程序集放在 GAC 中，要么将该 DLL 部署在 ASP.NET 应用程序的 bin\ 目录中。

您可以使用 MSI 部署到 GAC，也可以使用该`[gacutil](http://msdn.microsoft.com/en-us/library/ex0ss12c(VS.80).aspx)`实用程序（它附带 .NET SDK，但不附带可再发行框架本身）。

如果 DLL 在 bin 目录中但未找到，[请在此处](http://blogs.msdn.com/tom/archive/2008/07/21/asp-net-tips-loading-a-dll-out-of-the-bin-directory.aspx)查看一些建议。

# .net - DllImport 和 ASP.NET

> ID：726066
> 
> 赞同：4
> 
> 时间：2009-04-07T14:38:04.067
> 
> 标签：.net, asp.net, pinvoke, dllimport

我在使用 DllImport 和 ASP.NET 时遇到了一些问题，因为当我使用导入的方法时，ASP.NET 会加载 Dll 并锁定文件，即使它完成使用后也是如此。有没有办法强制 ASP.NET 释放文件上的锁定？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:40:56.307

在 .Net 中强制 DLL 退出进程的唯一方法是卸载加载 Dll 的 AppDomain。除非您创建一个单独的 AppDomain 在其中运行 DllImport 代码，否则这是不可能的。

我也知道这个政策适用于托管 DLL。我不是 100% 确定这是否适用于通过 PINvoke 加载的 DLL，但我相当确定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T14:42:09.843

仅当您创建新的 AppDomain 并将 dll 加载到域中时。之后你可以卸载 AppDomain 并且 dll 将被卸载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-01T16:23:27.673

卸载 AppDomain 并不是唯一的答案。您还可以使用`LoadLibrary`和`FreeLibrary`over pinvoke 来卸载库。只需确保您调用`FreeLibrary`了两次以确保您的库的任何依赖项也被卸载。

我没有对此进行测试，但我想像这样的课程会让这样做更容易：

```
[DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
private static extern IntPtr LoadLibrary(string libname);

[DllImport("kernel32.dll", CharSet = CharSet.Auto)]
private static extern bool FreeLibrary(IntPtr hModule);

class LibraryHandle
{
    readonly string libName;
    int refCount = 0;
    IntPtr handle;

    public LibraryHandle(string name)
    {
        libName = name;
    }

    public void Increment()
    {
        if (refCount == 0)
        {
            handle = LoadLibrary(libName);
            if (Handle == IntPtr.Zero)
            {
                int error = Marshal.GetLastWin32Error();
                throw new Exception(string.Format("{0})", error));
            }
        }
        ++refCount;
    }

    public void Decrement()
    {
        if (refCount <= 0)
            return;

        if (--refCount)
        {
            // It might be better in some cases to:
            // while(FreeLibrary(handle));
            FreeLibrary(handle);
            FreeLibrary(handle);
        }
    }
} 
```

请注意，此示例**不是线程安全**的，您需要在 ASP.NET 中保证这一点，并且不会进行完整的错误检查。

此外，由于这可能违反运行时所做的一些假设，因此`FreeLibrary`在您未加载的库上使用可能不是一个好主意。

另一种选择是在 new 中执行任何操作，`AppDomain`然后在完成后将其卸载。

# c# - 如何在 C# 中发送 VK_MEDIA_NEXT_TRACK？

> ID：726075
> 
> 赞同：0
> 
> 时间：2009-04-07T14:40:00.660
> 
> 标签：c#, pinvoke

我在谷歌上发现了很多东西，但没有一个我可以真正使用，所以我只是在寻找一种简单的方法，如果可能的话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T14:43:02.057

问题的要点是您必须 PInvoke 到本机代码才能使用这些方法。PInvoke 是一个相当大的话题，我建议稍微阅读一下。

幸运的是，尽管此时可以 PInvoke 的大多数东西都在网络上提供了示例。例如，看看下面关于 CodeIdol 的文章。它提供了有关如何在 ac# 应用程序中使用此密钥和许多其他密钥的完整 winforms 示例。

[http://codeidol.com/csharp/csharpckbk2/Delegates,-Events,-and-Anonymous-Methods/Using-the-Windows-Keyboard-Hook/](http://codeidol.com/csharp/csharpckbk2/Delegates,-Events,-and-Anonymous-Methods/Using-the-Windows-Keyboard-Hook/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T14:48:41.233

JardPar 是正确的，您必须通过 PInvoke 发送`VK_MEDIA_NEXT_TRACK`密钥。您可以使用该`user32.SendInput`功能来实现这一点。看看[pinvoke.net: SendInput (user32)](http://www.pinvoke.net/default.aspx/user32.SendInput)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:08:22.433

过去，我对[keybd_event](http://msdn.microsoft.com/en-us/library/ms646304(VS.85).aspx)的运气更好。方法定义应如下所示：

```
[DllImport("user32.dll")]
public static extern void keybd_event(byte vkCode, byte scanCode, int flags, IntPtr extraInfo); 
```

# c# - SVN - 多个解决方案中的项目

> ID：726084
> 
> 赞同：0
> 
> 时间：2009-04-07T14:41:37.973
> 
> 标签：c#, svn, project, solution

有没有办法在 SVN 中跨多个解决方案共享一个项目？我已经在一个解决方案中有一个类库，我想在另一个解决方案中导入。我可以在新解决方案中导入项目还是路径有问题（因为项目不在同一个存储库中）？有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T14:45:46.870

我将添加另一个`externals`链接：

[如何开始使用 svn:externals？](https://stackoverflow.com/questions/663155/how-to-get-started-with-svnexternals)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:44:17.657

听起来你想要[svn:externals](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-externals.html)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-07T14:43:46.067

看svn外部

[http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)

# matrix - 伴随矩阵复杂度

> ID：726087
> 
> 赞同：2
> 
> 时间：2009-04-07T14:42:08.940
> 
> 标签：matrix, complexity-theory

我知道这更像是一个复杂性理论问题，而不是一个编程问题，希望我在这里没有做错事情，如果是错误的地方，我很抱歉，但我希望你们中的某个人有答案。它甚至在某种程度上与编程相关，因为它是一个复杂性理论问题。

我正在研究线性循环序列，我读到为了获得它弹出的序列的第 n 个值，你需要获得一些伴随矩阵的幂，我想知道是否有已知的算法来获得幂这种矩阵的快速方式..

我无法给出编码示例，但我会尝试为您提供更多解释：

k阶齐次线性循环序列：
s(n+k)=a(k-1)s(n+k-1)+a(k-2)s(n+k-2)+... +a(0)
for n=0,1,.. 其中 s(i) 是序列的第 i 个值，a(i) 是代数域中的系数。

A 是上述序列的伴随矩阵，如果它是：
( 0 0 0 0 ... 0 a(0) )
( 1 0 0 0 ... 0 a(1) )
( 0 1 0 0 ... 0 a (2) )
( .. .. .. .. .. .. .. .. ..)
( 0 0 0 0 ... 1 a(k-1) )
此外，理论指出，对于我们有序列：
s(n) = s(0)A^n for n=0,1,..
就是这样，感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:48:38.830

快速找到矩阵幂的常用策略是将其对角化（执行特征向量分解）：

A = P ^(-1) DP

其中 D 是对角矩阵。然后，您可以通过计算将 A 提高到 n 次方

A ^n = P ^(-1) D ^n P

其中 D ^n计算速度很快，因为它是一个对角矩阵，因此您只需分别计算每个元素的幂即可。

但是，并非所有矩阵都是可对角化的——我不知道您的伴侣矩阵是否可以。在任何情况下，您都可能会发现[这篇 Wikipedia 文章](http://en.wikipedia.org/wiki/Diagonalizable_matrix)很有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-26T12:27:02.747

您可以使用矩阵乘积计算`n`矩阵的 th 次方：`M``O(log n)`

*   如果`n=0`，返回`I`
*   如果`n`是偶数，计算`N=M`^(`n/2`)并返回`N*N`
*   如果`n`是奇数，计算`N=M`^(`n-1`)并返回`M*N`

# asp.net - 使其他用户会话变量无效

> ID：726089
> 
> 赞同：4
> 
> 时间：2009-04-07T14:42:29.047
> 
> 标签：asp.net, asp.net-membership

我正在考虑管理员对系统中恰好登录的另一个用户进行一些更改的情况。是否有任何编程方式使特定用户会话变量无效并强制重新填充它们？

用例

1.  管理员编辑 Bobs 首选项
2.  业务逻辑清除存储在会话中的 bobs 首选项
3.  保存到数据库的首选项

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:45:42.317

一种方法是清除其他用户的会话 cookie。

另一种方法是创建自己的[SessionIDManager](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.isessionidmanager.aspx)（从内置的派生）。然后当使用其他用户的会话 ID 调用 Validate 方法时，您可以返回 false。

# php - 将字节流转换为数字数据类型

> ID：726092
> 
> 赞同：1
> 
> 时间：2009-04-07T14:42:40.887
> 
> 标签：php, floating-point, 64-bit, integer, 32-bit

假设我有一个字节流，其中我知道 64 位值（64 位随机数）的位置。字节顺序是 Little-Endian。由于 PHP 的整数数据类型仅限于 32 位（至少在 32 位操作系统上），我如何将字节序列转换为 PHP 数字表示（我认为浮点数就足够了）？

```
$serverChallenge = substr($bytes, 24, 8);
// $serverChallenge now contains the byte-sequence 
// of which I know that it's a 64-bit value 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T07:10:19.970

刚刚查找了处理此问题的`Zend_Crypt_Math_BigInteger_Bcmath`代码`Zend_Crypt_Math_BigInteger_Gmp`：

## 使用 BCmath (Big-Endian)

这基本上是[Chad Birch](https://stackoverflow.com/questions/726092/converting-byte-stream-into-numeric-data-type/726323#726323)发布的解决方案。

```
public static function bc_binaryToInteger($operand)
{
    $result = '0';
    while (strlen($operand)) {
        $ord = ord(substr($operand, 0, 1));
        $result = bcadd(bcmul($result, 256), $ord);
        $operand = substr($operand, 1);
    }
    return $result;
} 
```

## 使用 GMP（大端）

相同的算法 - 只是不同的函数名称。

```
public static function gmp_binaryToInteger($operand)
{
    $result = '0';
    while (strlen($operand)) {
        $ord = ord(substr($operand, 0, 1));
        $result = gmp_add(gmp_mul($result, 256), $ord);
        $operand = substr($operand, 1);
    }
    return gmp_strval($result);
} 
```

将算法更改为使用 Litte-Endian 字节顺序非常简单：只需从头到尾读取二进制数据：

## 使用 BCmath (Litte-Endian)

```
public static function bc_binaryToInteger($operand)
{
    // Just reverse the binray data
    $operand = strrev($operand);
    $result = '0';
    while (strlen($operand)) {
        $ord = ord(substr($operand, 0, 1));
        $result = bcadd(bcmul($result, 256), $ord);
        $operand = substr($operand, 1);
    }
    return $result;
} 
```

## 使用 GMP (Litte-Endian)

```
public static function gmp_binaryToInteger($operand)
{
    // Just reverse the binray data
    $operand = strrev($operand);
    $result = '0';
    while (strlen($operand)) {
        $ord = ord(substr($operand, 0, 1));
        $result = gmp_add(gmp_mul($result, 256), $ord);
        $operand = substr($operand, 1);
    }
    return gmp_strval($result);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:24:36.077

这似乎完全是一个技巧，但它应该可以完成这项工作，假设你有 daemonmoi 推荐的 BC 数学函数：

```
$result = "0";
for ($i = strlen($serverChallenge) - 1; $i >= 0; $i--)
{
    $result = bcmul($result, 256); // shift result

    $nextByte = (string)(ord($serverChallenge[$i]));
    $result = bcadd($result, $nextByte);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-15T00:27:13.773

聚会晚了两年，但如果有人仍然关心：解包是这里的内置方式，您可以将其解包为几个 32 位整数或双精度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T14:46:14.250

我知道这不是问题的完全答案，但请查看[BC Math 函数](http://us.php.net/manual/en/book.bc.php)来处理大数字。

# c++ - 访问私有成员

> ID：726096
> 
> 赞同：9
> 
> 时间：2009-04-07T14:43:24.710
> 
> 标签：c++, private-members

通过将其转换为 void 指针然后转换为结构来访问类的私有成员是否合适？

我认为我没有权限修改包含我需要访问的数据成员的类。如果不道德，我不想冒险以间接方式访问数据成员。

编辑：必须进一步编辑这个......我很确定这个类不会被修改，所以在那个程度上没关系......我唯一担心的是，如果编写该类的人知道这一点，它可能不会和他相处得很好:(。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-07T15:20:12.093

让我们暂时不要考虑道德。让我们考虑一下标准。

你提议做的是非标准的。见标准第 9.2 节第 12 条。“由访问说明符分隔的非静态成员的分配顺序未指定。” 因此，如果您有一个具有私有成员的类和一个没有私有成员的结构，则标准不保证成员的顺序相同。

因此，如果你的 hack 有效，它只是偶然的，编译器作者碰巧这样做了。不能保证它可以在另一个编译器、同一编译器的更高版本或不同的类布局上工作。

更不用说，如果您无权修改类（例如，提供简单的访问器函数），那么如果类中的任何实现细节发生更改，您可能无权反对。（public 和 private 背后的想法之一是区分承诺的内容和可自由更改的内容。）因此，布局可能会发生变化，或者成员可能意味着不同的东西，或者被完全删除。

Herb Sutter 就这个问题写[了一篇“本周大师”](http://www.gotw.ca/gotw/076.htm)专栏。

哦，就道德而言？如果你真的，真的必须做这样的事情，而且你无法摆脱它，请非常仔细地记录它。如果您的编码标准有某种程序来标记非标准行为，请使用它们。如果没有，请非常小心地记下它，以便在出现问题时不会被忽视。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-07T14:44:58.527

我不确定“道德”是否真的参与其中。不过，它破坏了封装。

编辑：如果我正在执行代码审查，我几乎*永远不会接受这一点。*你必须*非常*努力地说服我没有办法围绕这个需求进行设计。有可能你会成功，但必须到处都有重大警告，并进行严格的单元测试，以确保如果有任何改变来破坏它，你会很快知道。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-06-25T14:59:46.423

我刚刚[在我的博客](http://bloglitb.blogspot.com/2010/07/access-to-private-members-thats-easy.html)中添加了一个条目，展示了如何以完全一致的方式完成它。这是有关如何将其用于以下课程的示例

```
struct A {
private:
  int member;
}; 
```

只需声明一个标签名称并实例化一个 robber，如下例所示（我的帖子显示了 robber 的实现）。然后，您可以使用成员指针访问该成员

```
struct Amem { typedef int type; };
template class rob<Amem, &A::member>;

int main() {
  A a;
  a.*result<Amem>::ptr = 42; // Doh!
} 
```

但实际上，这并不能说明 c++ 的访问规则不可靠。语言规则旨在防止意外错误 - 如果您试图窃取对象的数据，语言*设计*不会花很长时间来阻止您。

* * *

以上是一种以一致的方式访问*私有*和受保护成员的方法。这是另一种以符合标准的方式访问*受保护成员的方法。*基本思想是使用成员指针

```
std::deque<int> &getAdapted(std::stack<int> &s) {
    struct voyeur : stack<int> 
    { using stack<int>::c; };
    return s.*(&voyeur::c);
}

int main() {
    std::stack<int> s;
    std::deque<int> &adapted = getAdapted(s);
    output(adapted); // print the stack...
} 
```

不涉及铸造或类型双关语。它通过从它派生的类获取一个指向受保护成员的指针，`std::stack<int>`其中该成员名称是公共的，因此编译器允许这样做。然后它在一个`std::stack<int>`对象上使用它，这也是允许的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-07T15:32:24.247

我遇到过这种情况，因为有一个非常糟糕的源代码控制系统，对于旧版本的应用程序来说，对头文件进行更改几乎是不可能的。

如果在某些情况下你只需要做一个黑客。

在您需要访问私有数据成员的源文件中，您可以将其作为第一行放入：

```
#define private public
#define protected public 
```

并访问您想要的任何内容。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-07T14:46:34.903

不，你正在做的是纯粹的邪恶。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-07T14:47:21.220

“永不说永不”。我敢肯定，在宇宙的某个地方，有一种情况会迫使你不得不这样做……

但如果我不得不这样做，我肯定会畏缩。在扣动扳机之前，您确实需要就您的情况获得很多意见。您能否描述一下您的具体情况，也许我们可以看看它是否有意义或可能存在哪些更好的选择？

回应评论/问题——定义“权限”——机构许可？这听起来不像是一个编程问题，而是可以与主张所述许可的人交谈。也许这更像是一个政治问题而不是技术问题？同样，我认为我们需要更多细节——即使它在某种程度上是关于局势的政治。但是，这可能会或可能不会被视为超出网站的范围。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-07T14:47:35.760

如果您有这样做的冲动，请忘记强制转换 - 只需修改头文件中的类声明：

```
class A {
  private:
    int x;
}; 
```

将其更改为：

```
class A {
  public:
    int x;
}; 
```

你很高兴。好吧，也许“好”这个词不太合适。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-07T14:46:18.947

这是合乎道德的，但通常有很多脏代码与未定义的行为和不可移植性相邻。只有在绝对必要时才这样做。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-07T14:51:29.167

啊，抽象——没有它你就活不下去，但有时处理起来很痛苦：）

无论如何，抛开道德问题不谈，如果类的“所有者”决定更改内部实现，或者只是颠倒私有数据成员的顺序怎么办？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-07T17:59:47.107

唯一的“道德”问题是你对可怜的混蛋所做的事情，他将不得不弄清楚并维护你的代码。

私人会员就是这样。他可能，而且很可能有一天会改变那个成员。发生这种情况时，您甚至可能不会注意到，因为那里很可能仍然存在内存，而不是您期望的成员。当你的代码运行时，任何你能想象到的几乎不可能发生的事情都可能开始发生。怎么会有人能够调试它？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-07T14:51:47.137

简单的回答：没有。

这是不道德的，并且在某些时候会变成维护的噩梦。库的内部私有成员可以更改和破坏您的代码。库的开发人员不需要知道（也不想知道）您违反了封装。

类通常在其方法上具有不变量，有时不会记录在案，但从外部访问和更改值可能会破坏这些不变量。例如，如果您将向量中的保留空间更改为更高的值，则向量将不会分配新空间，直到它填满现有空间，并且在遇到未分配的内存之前不会发生这种情况：您的应用程序将崩溃。

如果该属性是私有的，则不能供你使用，只供类本身或知道成员、如何使用、如何不破坏它的类朋友使用。如果程序员希望您更改字段，它将是公开的。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-11-28T17:32:38.363

我假设这门课是你正在从事的项目的一部分。

这里有一个道德问题：如果在您的公司中，您将代码的所有权视为骶骨。或者最糟糕的是，您不允许修改不属于您的代码。是的，您可能会伤害维持该课程的人的感觉。如果他的薪水与他的代码有关，或者激怒他。所以最好只是向他寻求任何帮助，并提供一些建议，例如。添加 getter 函数或将私有更改为公共 - 所有这些都基于您使用该新代码的直觉。

你提到的黑客真的是床上练习。如果不能修改该代码并且维护者不会改变任何东西。考虑使用适配器设计模式。

# asp-classic - Expressions Web 2 - 重写代码

> ID：726097
> 
> 赞同：0
> 
> 时间：2009-04-07T14:43:36.097
> 
> 标签：asp-classic, expression-web

我们的一位设计师正在研究 Microsoft Expressions Web，主要是针对 Dreameaver 评估它以维护我们项目的基于 Web 的界面，我们发现了一种我们无法解释且无法相信是正确的行为 - 似乎在某些情况下更改代码。

显示此问题的一个小示例是：

```
<frameset rows="<% =MenuHeight %>,*" cols="*" frameborder="NO" border="0" framespacing="0" id="fsOuter">
</frameset> 
```

它转换为：

```
<frameset rows="*,*" cols="*" frameborder="NO" border="0" framespacing="0" id="fsOuter">
</frameset> 
```

加载文件后立即进行编辑。在这种情况下，它正在从框架中删除 rows 属性，在更大的示例中，这是从它中删除的，将其替换为 rows=" *,* " 。

我们是否遗漏了一些简单的东西，例如“请不要丢弃我们的代码”选项，或者上面的示例中是否有某些东西触发了这种行为？或者这是否仅仅意味着 Expressions Web 不适合维护我们旧的基于 ASP 的代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T02:42:53.940

“仅仅意味着 Expressions Web 不是维护我们旧的基于 ASP 的代码的合适程序”

我会同意的。

# c# - 如何以编程方式从共享点站点下载文件？

> ID：726100
> 
> 赞同：4
> 
> 时间：2009-04-07T14:44:09.417
> 
> 标签：c#, file, download

我有一个共享点站点，其中包含我需要按计划下载的 Excel 电子表格

这可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-21T04:35:27.317

是的，可以从 sharepoint 下载文件。获得文档的 url 后，可以使用 HttpWebRequest 和 HttpWebResponse 下载它。

附上示例代码

```
 DownLoadDocument(string strURL, string strFileName)
    {
        HttpWebRequest request;
        HttpWebResponse response = null;

            request = (HttpWebRequest)WebRequest.Create(strURL);
            request.Credentials = System.Net.CredentialCache.DefaultCredentials;
            request.Timeout = 10000;
            request.AllowWriteStreamBuffering = false;
            response = (HttpWebResponse)request.GetResponse();
            Stream s = response.GetResponseStream();

            // Write to disk
            if (!Directory.Exists(myDownLoads))
            {
                Directory.CreateDirectory(myDownLoads);
            }
            string aFilePath = myDownLoads + "\\" + strFileName;
            FileStream fs = new FileStream(aFilePath, FileMode.Create);
            byte[] read = new byte[256];
            int count = s.Read(read, 0, read.Length);
            while (count > 0)
            {
                fs.Write(read, 0, count);
                count = s.Read(read, 0, read.Length);
            }

            // Close everything
            fs.Close();
            s.Close();
            response.Close();

    } 
```

您还可以使用 Copy 服务的 GetItem API 来下载文件。

```
 string aFileUrl = mySiteUrl + strFileName;
        Copy aCopyService = new Copy();
        aCopyService.UseDefaultCredentials = true;
        byte[] aFileContents = null;
        FieldInformation[] aFieldInfo;
        aCopyService.GetItem(aFileUrl, out aFieldInfo, out aFileContents); 
```

该文件可以作为字节数组检索。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-04T18:32:17.667

你也可以这样做：

```
try
        {   
            using (WebClient client = new WebClient())
            {
                client.Credentials = new NetworkCredential("username", "password", "DOMAIN");
                client.DownloadFile(http_path, path);                    
            }
        }
        catch (Exception ex)
        {
            MessageBox.Show("Error: " + ex.Message);
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T14:48:09.953

Sharepoint 中指向文档的链接应该是静态 URL。在您必须按计划获取文件的任何解决方案中使用该 URL。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-07T15:17:47.077

为什么不直接使用`wget.exe <url>`. 您可以将该行放入批处理文件并通过 Windows 调度程序运行。

# regex - 用于将正则表达式转换为 NFA 的库？

> ID：726105
> 
> 赞同：3
> 
> 时间：2009-04-07T14:45:08.650
> 
> 标签：regex, state-machine, dfa, nfa

是否有将**正则表达式**转换为**NFA**的好**库**？我看到很多关于该主题的学术论文，这些论文很有帮助，但对工作代码的影响不大。

 ****我的问题部分是出于好奇，部分是由于实际需要在我正在开发的生产系统上加快正则表达式匹配。尽管为了学习而探索这个主题可能很有趣，但我不确定它是否是加速我们的模式匹配的“实用”解决方案。我们是一家 Java 商店，但很乐意提供任何语言的优质代码。

**编辑**：

有趣的是，我不知道 Java 的正则表达式已经是 NFA。[这篇论文](http://swtch.com/~rsc/regexp/regexp1.html)的标题让我不相信。顺便说一句，我们目前正在 Postgres 中进行正则表达式匹配；如果简单的解决方案是将匹配移动到 Java 代码中，那就太好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T14:54:01.080

满足您加快正则表达式的需求：

Java 的正则表达式引擎的实现是基于 NFA 的。因此，为了调整您的正则表达式，我会说您将从对引擎如何实现的更深入了解中受益。

因此，我指导您：[掌握正则表达式](http://oreilly.com/catalog/9780596528126/)这本书对 NFA 引擎及其执行匹配的方式进行了大量处理，包括如何调整特定于 NFA 引擎的正则表达式。

此外，请查看[Atomic Grouping](http://www.regular-expressions.info/atomic.html)以调整您的正则表达式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-25T13:13:06.627

免责声明：我不是 java+regex 方面的专家。但是，如果我理解正确...

如果 Java 的正则表达式匹配器与大多数其他匹配器相似，它确实使用 NFA，但不是您可能期望的方式。与您可能听说过的仅前向实现不同，它使用回溯解决方案来简化子表达式匹配，并且可能是反向引用使用所必需的。但是，它的交替性能很差。

你想看看：[http](http://swtch.com/~rsc/regexp/regexp1.html) ://swtch.com/~rsc/regexp/regexp1.html （关于在这种改变的架构上表现不佳的边缘情况）。

我还写了一个问题，我想这可以归结为同一件事：

[可以处理机器生成的正则表达式的正则表达式实现：*非回溯*，O(n)？](https://stackoverflow.com/questions/1178173/practical-on-regex-implementation-for-use-with-machine-generated-regexs)

但基本上，由于某些非常奇怪的原因，所有常见的主要供应商正则表达式实现在某些正则表达式上使用时性能都很差，即使这是不必要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-20T08:55:43.887

免责声明：我是谷歌用户，而不是正则表达式专家。

有一堆比 JDK 更快的正则表达式库，其中一个是*dk.brics.automaton*。根据[文章](https://weblogs.java.net/blog/tomwhite/archive/2006/03/a_faster_java_r.html)中链接的基准，它比 JDK 实现快大约 x20。

这个库是由 Anders Møller 编写的，也被[mavenized 了](http://mvnrepository.com/artifact/dk.brics.automaton/automaton/1.11-8)。

# asp-classic - 经典 ASP 的自动化测试

> ID：726106
> 
> 赞同：4
> 
> 时间：2009-04-07T14:45:12.223
> 
> 标签：asp-classic, watin, mbunit, automated-tests

有人对经典 ASP 站点进行自动化 QA 测试吗？我开始研究 WatIn 和 MBUnit，但不确定构建测试的最佳方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T09:05:53.747

新的 WatiN 2.0 beta 1 确实提供了一些基类来帮助您构建测试类。

它基本上归结为每个页面都有一个类（继承 WatiN.Core.Page 类）。在这些页面类中，您可以为要访问的每个控件添加属性。就像是：

```
public Button OkButton
{
    get { return Document.Button("okbuttonId");
} 
```

并且您可以创建方法来将一些更复杂的操作包装到页面中。例如：

```
public void AddPerson(string name, string email)
{
    /// logic goes here tp click on NewButton, set the textfields and click on OkButton
} 
```

这些页面类提供了在一个地方定义元素的优势。

在您的测试代码中，您可以创建一个页面类，如下所示：

```
using(var ie = new IE("www.somedomain.com/person"))
{
  var page = ie.Page<PersonDetailPage>();
  page.AddPerson("J. Doe", "jdoe@example.com");

  // Do some Assert
} 
```

另一个可以帮助您构建代码的有趣基类是 Control 类。当您使用 ASP 时，您将使用不会仅呈现到呈现页面中的一个 html 元素的控件。相反，它通常是包含在 Div 元素中的元素的构造。创建自己的控件类并继承 Control 时，您将能够包装控件 (html) 内部结构和行为。这使得在页面类中重用控件变得非常容易。以下是有关如何实例化控件的示例：

```
var calendar = Document.Control<CalendarControl>("calendarId"); 
```

希望这能让您对如何构建页面和控件有所了解。

杰伦

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T00:31:35.607

FWIW，过去 3 年我们一直在使用 WatiN 和 MbUnit 进行 Web 集成测试。

我们将测试分为 3 个项目：

1.  QA.Framework：包含用于设置测试夹具和各种自定义 MbUnit 和 WatiN 扩展的胶水代码。

2.  QA.SiteMap：包含分层次排列到命名空间中的页面和控制类，这些命名空间对应于站点的不同域和部分。该项目用于将测试与网站结构的主要部分分离。您可以将其视为网站的模型。

3.  QA.Tests：包含实际测试，也分层排列到命名空间中。测试根据需要利用站点地图和框架与网站交互。这样，与每个测试一遍又一遍地包含相同的按钮 ID 相比，代码重复要少得多……

杰夫。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T07:42:56.443

[我用Watir](http://wtr.rubyforge.org/)测试了 ASP 站点。如果您正在寻找一种构建测试的方法，请查看[WatirCraft 框架](http://github.com/bret/watircraft/tree/master)。

# apache - 如何使这项工作？RewriteCond %{ENV:UNIQUE_ID} !%{QUERY_STRING}

> ID：726107
> 
> 赞同：5
> 
> 时间：2009-04-07T14:45:32.690
> 
> 标签：apache, mod-rewrite

/foo/.htaccess 进行内部重定向

```
RewriteRule ^(.*)$ /bar/?%{ENV:UNIQUE_ID} 
```

/bar/.htaccess 需要认识到请求不是内部的，问题是我无法弄清楚如何进行比较

```
RewriteCond %{ENV:UNIQUE_ID} !%{QUERY_STRING} 
```

甚至一个

```
RewriteCond %{QUERY_STRING} %{QUERY_STRING} 
```

不匹配，我想表达式右侧存在语法问题，转义 % 无济于事。

我测试了上述两个变量在内部重定向上具有相同的值

```
RewriteRule ^(.*)$ /test/%{QUERY_STRING}/%{ENV:UNIQUE_ID} 
```

会显示它。

服务器是 Apache/2.2.3

谢谢，劳里安

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-07T14:59:12.487

遗憾的是，您不能直接将两个变量与 mod_rewrite 进行比较。（或者至少我也不知道该怎么做。）

但是有一个解决方法：

```
RewriteCond %{ENV:UNIQUE_ID}:%{QUERY_STRING} !^(.+):\1$ 
```

我选择了`:`as 分隔符，但您可以根据需要使用任何其他分隔符。如果你可以指定`UNIQUE_ID`值的结构，你应该这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-16T21:34:35.293

If the referrer wasn't the same domain you are on, such as the first time a person visits but didn't use a link within your own website, you could check the HTTP_REFERRER. Same technique is used to prevent hotlinking to images.

# c# - Silverlight 中的 XML 和数据库过滤：动态 LINQ？有没有更好的办法？

> ID：726108
> 
> 赞同：1
> 
> 时间：2009-04-07T14:45:42.223
> 
> 标签：c#, linq, silverlight

我有一个 Silveright 应用程序，它允许用户在几组不同的持久数据集上指定过滤器。持久化的数据可以是 XML 或关系数据库表。我将 nHibernate 用于数据库层，因为我需要至少支持不同的数据库选项，Postgresql 和 MySQL。过滤器字段因查询的数据集而异。

目前，过滤器作为字符串从 Silverlight 客户端传递到服务器，我利用服务器上的[动态 LINQ](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)类将其转换为 LINQ 查询。这适用于所有数据都已加载到内存中的 XML 情况，但我不确定这是否是数据库的最佳方法。

我的问题是从客户端发送过滤器作为字符串然后使用动态 LINQ 库进行解析是否是最好的方法？我可以使用 nHibernate 生成的 LINQ 查询吗？或者，我是否应该考虑在 Silverlight 中序列化一个 Expression 对象并将其传递给服务器？还是有其他方法？

我需要我的持久化对象来提供一个标准的访问接口，并且其中有一些，因此不能为所需的每个过滤器提供不同的方法接口。

下面是我的持久性类支持的接口示例，我正在努力解决的问题是 whereExpression。

```
public interface ICustomerPersistor
{
    Customer Add(Customer customer);
    Customer Update(Customer customer);
    Customer Delete(Customer customer);
    Customer Get(Guid customerId);
    int Count(string whereExpression);
    Customer Get(string username, string password);
    List<Customer> Get(string whereExpression, int offset, int count);
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T14:51:06.593

您是否考虑过 ADO.NET 数据服务？这允许您通过 REST API（由 WCF 支持）执行 LINQ 查询 - 但该工具完成了所有繁重的工作......

许多（不是全部）标准 LINQ 过滤器（等）都受支持，并且可以组合。

特别是，对于*查询*数据，ADO.NET 数据服务应该没问题 - 对于*更新*数据，您需要做更多的工作（或使用单独的非 REST API 进行更新）。[我的博客上](http://marcgravell.blogspot.com/search?q=astoria)有一系列关于 LINQ-to-SQL 的帖子（其他 LINQ 提供程序的工作应该类似）。

# c# - 如何使用套接字通过 Internet 发送数据？

> ID：726115
> 
> 赞同：11
> 
> 时间：2009-04-07T14:46:22.067
> 
> 标签：c#, sockets, networking

我想通过桌面应用程序通过互联网发送数据。我对套接字有点了解。我已经在局域网内传输数据，但现在我想通过互联网传输数据。传输大量和少量数据的最佳方式是什么？

我的系统连接到可以访问互联网的服务器。我系统的 IP 地址是动态的。我不知道如何将数据发送到连接到互联网的另一个系统。我需要找到路由器地址吗？（我的 IP 地址生成为 192.168.1.15）。

使用套接字是否足够，还是需要 HTTP？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-07T14:50:26.127

如果不涉及防火墙/代理，套接字就足够了。

但是，由于涉及 Internet（不是最快的连接），为了方便起见，我建议您最好选择通过 http 进行远程处理。这样，即使将来设置发生变化，并且防火墙/代理参与其中，您也不用担心。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-07T15:10:33.597

如果您只想将原始数据从一台机器传输到另一台机器，那么使用 TCP 套接字很容易做到。

这是一个简单的例子。

服务器：

```
 ThreadPool.QueueUserWorkItem(StartTCPServer);

 private static void StartTCPServer(object state) {
        TcpListener tcpServer = new TcpListener(IPAddress.Parse("192.168.1.15"), 5442);
        tcpServer.Start();
        TcpClient client = tcpServer.AcceptTcpClient();

        Console.WriteLine("Client connection accepted from " + client.Client.RemoteEndPoint + ".");

        StreamWriter sw = new StreamWriter("destination.txt");

        byte[] buffer = new byte[1500];
        int bytesRead = 1;

        while (bytesRead > 0) {
            bytesRead = client.GetStream().Read(buffer, 0, 1500);

            if (bytesRead == 0) {
                break;
            }

            sw.BaseStream.Write(buffer, 0, bytesRead);
            Console.WriteLine(bytesRead + " written.");
        }

        sw.Close();
    } 
```

客户：

```
 StreamReader sr = new StreamReader("source.txt");

 TcpClient tcpClient = new TcpClient();
 tcpClient.Connect(new IPEndPoint(IPAddress.Parse("192.168.1.15"), 5442));

 byte[] buffer = new byte[1500];
 long bytesSent = 0;

 while (bytesSent < sr.BaseStream.Length) {
        int bytesRead = sr.BaseStream.Read(buffer, 0, 1500);
        tcpClient.GetStream().Write(buffer, 0, bytesRead);
        Console.WriteLine(bytesRead + " bytes sent.");

        bytesSent += bytesRead;
  }

  tcpClient.Close();

  Console.WriteLine("finished");
  Console.ReadLine(); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-07T15:36:18.653

需要有关您的连接需求的更多信息，以便为您提供适当的解决方案。有许多协议可供您使用，所有协议都需要权衡取舍。您可能会选择以下两个[传输层](http://en.wikipedia.org/wiki/Transport_Layer)之一：

[UDP](http://en.wikipedia.org/wiki/User_Datagram_Protocol) - 这是发送数据包的发送后忘记方法。适用于不一定要 100% 正确的流媒体。

好的：

1.  无需连接。
2.  非常轻巧。

坏处：

1.  不能保证您的数据包到达目的地（尽管他们大部分时间都会到达目的地）。
2.  数据包可能会超出您发送它们的顺序。
3.  不保证它们的内容与您发送数据包时的内容相同。

[TCP](http://en.wikipedia.org/wiki/Transmission_Control_Protocol) - 这是一种基于连接的协议，可保证可预测的行为。

好的：

1.  您将确定数据包是否已到达目的地。
2.  数据包将按照您发送它们的顺序到达。
3.  您可以保证 99.999999999% 的时间您的数据包将在其内容不变的情况下到达。
4.  流量控制 - 如果发送数据包的机器发送速度过快，接收机器能够限制发送方的数据包发送速率。

坏处：

1.  需要建立连接。
2.  比 UDP 更多的开销。

优点和缺点列表绝不是完整的，但它应该足以让您有能力做出明智的决定。如果可能，您应该利用已经存在的基于[应用层](http://en.wikipedia.org/wiki/Application_Layer)的协议，例如传输 ASCII 文本的[HTTP ，传输文件的](http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)[FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol)，等等。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T14:56:19.047

您可以使用 .Net 的 Socket 类，也可以使用更方便的 TcpClient 类。

首先，尽管您需要弄清楚您打算与之通信的服务器。它是 HTTP 服务器还是 FTP 服务器？HTTP 和 FTP 都是在（使用）套接字之上实现的应用程序级协议，套接字实际上是一个传输层接口。

您的本地 IP 地址或路由器的地址实际上并不重要。但是，您需要知道要连接的远程主机的 IP 地址。您可以通过调用以下方式获得此信息：

```
IPHostEntry host;

host = Dns.GetHostEntry(hostname); 
```

在使用套接字时，您可能还想考虑其他问题，例如使用超时来掩盖故障，传输大文件时恢复上传/下载的可能性等。如果您花一些时间在网上查找，您应该能够找到更高级别的 HTTP/FTP api，让您更轻松地处理文件传输。

从您的问题来看，您似乎对套接字很陌生，因此阅读[本文](https://stackoverflow.com/questions/104617/what-is-a-good-tutorial-howto-on-net-c-socket-programming)也可能会有所帮助

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T14:52:42.330

在你的问题中，你混合了不同的东西。套接字是网络通信的抽象。您肯定需要一个套接字来通过网络进行通信。但是，您可能不会看到使用了套接字（就像在 Web 浏览器中一样）。Http是一种通信协议。这是通过沟通渠道进行的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T14:54:49.503

Visual Studio 有许多用于创建和使用 SOAP XML Web 服务的精良设施。如果我是你，我会调查的。当然，有一些开销，但是针对它进行编码非常容易。

当然，如果您必须通过慢速互联网连接传输数十或数百兆字节的数据，我不确定它的扩展性如何。它确实提供了异步 I/O，但我认为您无法获得进度指示器，而且肯定没有恢复功能。

**补充：**您也可以继续使用您的插座。通过 Internet 连接到服务器不需要额外的工作。只需指定服务器的 IP 地址，然后就可以了。您的操作系统将处理所有血腥细节，例如路由器、丢失的数据包等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T15:00:13.107

首先，您应该决定要使用 TCP 或 UDP 的协议。然后你有两个选择：1.使用 Socket（较低级别）或 2.使用 TCPClient 或 UDPClient 之类的类（代表更高的抽象。我建议（乞求第二个选项）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T15:07:21.343

您想了解的内容在很大程度上取决于您的基础架构的许多部分。

如果您想将数据发送到透明连接到 Internet 的服务器，这就像连接到它的 IP 地址一样简单。

如果您想通过宽带连接与某个朋友联系，事情就会变得棘手。您通常必须为 NAT 配置两台路由器（或至少是目标路由器）。

熟悉 NAT 和 IP 路由的基础知识。您提供的详细信息不足以准确描述您想要做什么。

# c++ - 如何使 MSVS C++ CToolBar 上的按钮连同它们的图像一起变大？

> ID：726119
> 
> 赞同：1
> 
> 时间：2009-04-07T14:46:52.143
> 
> 标签：c++, visual-c++, mfc, image-manipulation

我们有一个触摸屏，而工具栏太小了，我肉肉的手指无法点击。有没有一种简单的方法可以让我选择使工具栏按钮更大更容易点击？

到目前为止，我已经尝试了几件事：

```
m_toolbar.SetSizes( CSize(64,64), CSize(50,50) );
m_toolbar.SetSizes( CSize(64,64), CSize(50,50) );
m_toolbar.GetToolBarCtrl().SetButtonWidth( 64, 64 );
m_toolbar.GetToolBarCtrl().SetButtonSize( CSize(64, 64) ); 
```

这些方法都没有拉伸图像。按钮变得更大，并且功能齐全，但图像不会像通常那样与按钮重叠。我更愿意为图标保留一个图像列表，并拉伸图像以适应。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T18:28:06.713

在工具栏创建时，创建一个大小为 64x64 的空 CImageList（我们称之为*large*）。从资源中加载原始图像列表（我们称之为*small*）。

迭代每个图像*small*并将其复制/调整为*large*。然后将*large*分配给您的工具栏。有点麻烦的bui应该可以工作。

高温下，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:34:04.880

据我所知，没有办法根据按钮的大小调整图像的大小。MFC 应用程序使用 bmp 而不是矢量图像。

因此，您将必须提供具有所需尺寸的 bmp 图像。

您可以使用 CImageList 和[SetImageList](http://msdn.microsoft.com/en-us/library/74yhfwwd.aspx)来设置图像，但是您还必须在
那里用不想要的大小初始化图像。

# c - 使用 C 解析 URL 的最佳方法？

> ID：726122
> 
> 赞同：38
> 
> 时间：2009-04-07T14:47:18.083
> 
> 标签：c, url, parsing

我有一个这样的网址：

```
http://192.168.0.1:8080/servlet/rece 
```

我想解析 URL 以获取值：

```
IP: 192.168.0.1
Port: 8080
page:  /servlet/rece 
```

我怎么做？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-07T16:57:12.687

[就个人而言，我从 W3C](http://www.w3.org/Library/src/HTParse.html)窃取了该`HTParse.c`模块 （例如，它用于[lynx](http://lynx.isc.org/) Web 浏览器）。然后，您可以执行以下操作：

```
 strncpy(hostname, HTParse(url, "", PARSE_HOST), size) 
```

使用完善且经过调试的库的重要之处在于，您不会陷入 URL 解析的典型陷阱（当主机是 IP 地址时，许多正则表达式会失败，例如，特别是 IPv6 的）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-07T15:02:15.460

我使用 sscanf 编写了一个简单的代码，它可以解析非常基本的 URL。

```
#include <stdio.h>

int main(void)
{
    const char text[] = "http://192.168.0.2:8888/servlet/rece";
    char ip[100];
    int port = 80;
    char page[100];
    sscanf(text, "http://%99[^:]:%99d/%99[^\n]", ip, &port, page);
    printf("ip = \"%s\"\n", ip);
    printf("port = \"%d\"\n", port);
    printf("page = \"%s\"\n", page);
    return 0;
}

./urlparse
ip = "192.168.0.2"
port = "8888"
page = "servlet/rece" 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-07T14:54:25.370

如果您想要简单的方法，请使用[正则表达式。](http://www.gnu.org/software/hello/manual/libc/Regular-Expressions.html)否则使用[FLEX](http://westes.github.io/flex/manual/) / [BISON](http://www.gnu.org/software/bison/manual/)。

您还可以使用[URI 解析库](http://uriparser.sourceforge.net/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-11-29T06:48:47.497

可能迟到了，......我使用的是 -从[Joyent/HTTP 解析器](https://github.com/joyent/http-parser)`http_parser_parse_url()`库中分离出来的函数和所需的宏- 运行良好，LOC。`~600`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-12-06T19:32:20.663

Libcurl 现在具有`curl_url_get()`可以提取主机、路径等的功能。

示例代码：[https ://curl.haxx.se/libcurl/c/parseurl.html](https://curl.haxx.se/libcurl/c/parseurl.html)

```
/* extract host name from the parsed URL */ 
uc = curl_url_get(h, CURLUPART_HOST, &host, 0);
if(!uc) {
  printf("Host name: %s\n", host);
  curl_free(host);
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-08-23T10:08:43.407

这个尺寸减小了，对我来说效果很好[http://draft.scyphus.co.jp/lang/c/url_parser.html](http://draft.scyphus.co.jp/lang/c/url_parser.html)。只有两个文件（*.c、*.h）。
我不得不修改代码 [1]。

[1]将所有函数调用从 http_parsed_url_free(purl) 更改为 parsed_url_free(purl)

```
 //Rename the function called
   //http_parsed_url_free(purl);
   parsed_url_free(purl); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-17T15:58:43.843

这个 C 要点可能很有用。它使用 sscanf 实现了纯 C 解决方案。

[https://github.com/luismartingil/per.scripts/tree/master/c_parse_http_url](https://github.com/luismartingil/per.scripts/tree/master/c_parse_http_url)

它用

```
// Parsing the tmp_source char*
if (sscanf(tmp_source, "http://%99[^:]:%i/%199[^\n]", ip, &port, page) == 3) { succ_parsing = 1;}
else if (sscanf(tmp_source, "http://%99[^/]/%199[^\n]", ip, page) == 2) { succ_parsing = 1;}
else if (sscanf(tmp_source, "http://%99[^:]:%i[^\n]", ip, &port) == 2) { succ_parsing = 1;}
else if (sscanf(tmp_source, "http://%99[^\n]", ip) == 1) { succ_parsing = 1;}
(...) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-18T08:34:09.437

我写了这个

```
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
typedef struct
{
    const char* protocol = 0;
    const char* site = 0;
    const char* port = 0;
    const char* path = 0;
} URL_INFO;
URL_INFO* split_url(URL_INFO* info, const char* url)
{
    if (!info || !url)
        return NULL;
    info->protocol = strtok(strcpy((char*)malloc(strlen(url)+1), url), "://");
    info->site = strstr(url, "://");
    if (info->site)
    {
        info->site += 3;
        char* site_port_path = strcpy((char*)calloc(1, strlen(info->site) + 1), info->site);
        info->site = strtok(site_port_path, ":");
        info->site = strtok(site_port_path, "/");
    }
    else
    {
        char* site_port_path = strcpy((char*)calloc(1, strlen(url) + 1), url);
        info->site = strtok(site_port_path, ":");
        info->site = strtok(site_port_path, "/");
    }
    char* URL = strcpy((char*)malloc(strlen(url) + 1), url);
    info->port = strstr(URL + 6, ":");
    char* port_path = 0;
    char* port_path_copy = 0;
    if (info->port && isdigit(*(port_path = (char*)info->port + 1)))
    {
        port_path_copy = strcpy((char*)malloc(strlen(port_path) + 1), port_path);
        char * r = strtok(port_path, "/");
        if (r)
            info->port = r;
        else
            info->port = port_path;
    }
    else
        info->port = "80";
    if (port_path_copy)
        info->path = port_path_copy + strlen(info->port ? info->port : "");
    else 
    {
        char* path = strstr(URL + 8, "/");
        info->path = path ? path : "/";
    }
    int r = strcmp(info->protocol, info->site) == 0;
    if (r && info->port == "80")
        info->protocol = "http";
    else if (r)
        info->protocol = "tcp";
    return info;
} 
```

**测试**

```
int main()
{
    URL_INFO info;
    split_url(&info, "ftp://192.168.0.1:8080/servlet/rece");
    printf("Protocol: %s\nSite: %s\nPort: %s\nPath: %s\n", info.protocol, info.site, info.port, info.path);
    return 0;
} 
```

**出去**

```
Protocol: ftp
Site: 192.168.0.1
Port: 8080
Path: /servlet/rece 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-09-09T12:14:24.110

纯`sscanf()`基解决方案：

```
//Code
#include <stdio.h>

int
main (int argc, char *argv[])
{
    char *uri = "http://192.168.0.1:8080/servlet/rece"; 
    char ip_addr[12], path[100];
    int port;

    int uri_scan_status = sscanf(uri, "%*[^:]%*[:/]%[^:]:%d%s", ip_addr, &port, path);

    printf("[info] URI scan status : %d\n", uri_scan_status);
    if( uri_scan_status == 3 )
    {   
        printf("[info] IP Address : '%s'\n", ip_addr);
        printf("[info] Port: '%d'\n", port);
        printf("[info] Path : '%s'\n", path);
    }

    return 0;
} 
```

但是，请记住，此解决方案是为`[protocol_name]://[ip_address]:[port][/path]`URI 类型量身定制的。要了解有关 URI 语法中存在的组件的更多信息，您可以转到[RFC 3986](https://www.rfc-editor.org/rfc/rfc3986#section-3)。

现在让我们分解我们量身定制的格式字符串：`"%*[^:]%*[:/]%[^:]:%d%s"`

*   `%*[^:]`有助于忽略协议/方案（例如 http、https、ftp 等）

    它基本上从头开始捕获字符串，直到`:`第一次遇到字符。而且由于我们`*`在字符之后使用`%`，因此捕获的字符串将被忽略。

*   `%*[:/]`有助于忽略协议和 IP 地址之间的分隔符，即`://`

*   `%[^:]`有助于捕获分隔符后出现的字符串，直到遇到`:`. 而这个捕获的字符串只不过是 IP 地址。

*   `:%d`有助于捕捉没有。坐在`:`字符后面（在捕获 IP 地址期间遇到的字符）。没有。在这里捕获的基本上是您的端口号。

*   `%s`如您所知，它将帮助您捕获剩余的字符串，这不过是您正在寻找的资源的路径。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-04-07T14:54:00.190

编写自定义解析器或使用字符串替换函数之一替换分隔符 ':'，然后使用`sscanf()`.

# cocoa - 存储 mousedown 位置

> ID：726133
> 
> 赞同：0
> 
> 时间：2009-04-07T14:48:42.263
> 
> 标签：cocoa, mouse, click

我的可可应用程序计算每个 mousedown 事件的位置。下次单击鼠标时，该位置将被新的位置覆盖。如何存储位置？是否可以创建一个带有 mousedown 位置的数组？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T14:52:55.607

你当然可以。由于您正在处理原始结构（NSPoint），因此您需要先将其包装在一个对象中，然后才能将其放入 NSArray 中。NSValue 是一个现成的类，可以让你做到这一点，看看`[NSValue valueWithPoint:aPoint];`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:54:03.747

有可能的。你可以很容易地做这样的事情（假设`storedLocations`是一个类型的 ivar`NSMutableArray`并且已经正确初始化）：

```
NSPoint thePoint = [theEvent locationInWindow];
[storedLocations addObject:[NSValue valueWithPoint:thePoint]]; 
```

# msbuild - 由 AssemblyInfo 任务覆盖的 Log4NET 设置

> ID：726135
> 
> 赞同：1
> 
> 时间：2009-04-07T14:49:04.960
> 
> 标签：msbuild, log4net, assemblyinfo

我有一个使用 log4net 并且在开发人员机器上运行良好的项目。当我们构建时，我们的构建脚本中的一个步骤调用 AssemblyInfo 任务来设置版本号和日期等。但是 AssemblyInfo 文件也丢失了这一行：

[程序集：XmlConfigurator(Watch = true)]

有没有办法让 AssemblyInfo 任务不覆盖该行，或者相反，让 AssemblyInfo 任务将该行重新插入文件中（以及适当的 using 语句？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T07:56:29.833

您实际上可以将 log4net [assembly: ...] 行放在将编译到程序集中的任何文件中。很多时候，我们只是将它放在具有“main”方法的 .cs 文件中，它就可以正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:57:50.883

好吧，换个思路，您不必只有一个程序集信息文件。

这就是我们为解决方案做的方式，每个项目都有 3 个程序集信息文件：

1.  AssemblyInfo.cs - 包含 Guid、AssemblyTitle、AssemblyDescription 和任何程序集特定属性。

2.  ProductAssemblyInfo.cs - 包含 AssemblyProduct、AssemblyVersion 和 AssemblyFileVersion。这样，产品/解决方案中的所有程序集都共享相同的版本。

3.  CompanyAssemblyInfo.cs - 包含 AssemblyCompany、AssemblyCopyright 以及我们希望所有程序集共享的任何属性。

使用“添加为链接”引用项目 2 和 3，这样它们可以从单一源代码共享。现在，您可能不想采用相同的方法，但您当然可以使用类似的结构并将您的 XmlConfigurator 放在与您的程序集版本详细信息不同的程序集信息文件中。

# web-applications - 管理匿名用户数据的最佳实践

> ID：726137
> 
> 赞同：2
> 
> 时间：2009-04-07T14:49:35.990
> 
> 标签：web-applications, cookies, anonymous-users

我正在寻找有关在 Web 应用程序中将数据与匿名用户关联的推荐或简单尝试和测试的方法的任何提示。我希望数据可以跨多个会话供用户使用，因此将其存储在数据库中。

显然我需要某种 cookie 来识别该用户，我特别感兴趣的是如何管理这个匿名标识符和实际数据之间的链接。到目前为止，我正在探索两种选择：

1.  为每个唯一访问者创建一个持久匿名用户。这样我的数据就不需要关心它是属于匿名用户还是注册用户，它只属于一个用户。
2.  为使用其自己的唯一 cookie 值与数据关联的数据提供某种包装器/管理器。

#1 的主要问题是创建的用户数量。每 24 小时运行一次脚本来清理表格很容易，但我仍然可以每天创建数千（我希望！）行，将它们保持 14 天会产生很多结果。对于#2，我必须构建一个特定于数据的匿名/基于 cookie 的基础结构，但是当我有其他需要相同功能的数据集时会发生什么。

有人对如何做到这一点有任何最佳实践建议吗？我正在使用 NHibernate 在 ASP.NET MVC 中工作，但是任何平台的概念和想法都会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T15:35:57.390

保留匿名用户没有意义，原因有两个：

1.  今天在这里，明天就过去了。你会留下很多孤立的行，你必须不时地耙
2.  持久化到数据库意味着您可以为这些用户进行大量自定义，这是一个坏主意，因为它们都挂在 cookie 上

我建议使用 cookie 不仅可以跟踪它们，还可以用作数据存储。或者选项二，您将它们与注册用户分开处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T14:58:25.670

我可能会选择案例 1。每天几千行是少量数据，您不必担心。这听起来像是其中一种情况，您只是让它工作并稍后担心性能（可能永远不会）。

您可能永远无法清除它，也永远不会遇到问题。

# asp.net - 子类中的 ASP.NET 中继器项

> ID：726139
> 
> 赞同：3
> 
> 时间：2009-04-07T14:49:41.730
> 
> 标签：asp.net, repeater

这是我从对象中提取字段的方法：

但是，如果字段位于子类 (Customer.ContactInfo.Name) 中，我该如何提取？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T14:51:58.883

如果您知道 DataItem 是某种类型（假设您知道它是 CustomerInfo 类型），您可以这样做：

```
<%# ((CustomerInfo) Container.DataItem).ContactInfo.Name %> 
```

作为奖励，它比使用 DataBinder.Eval 快一些，因为您避免了反射的所有开销。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T14:52:32.363

尝试...

```
<%#((Customer)Container.DataItem).ContactInfo.Name%> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T14:52:47.197

如果转发器被绑定到客户对象的集合，则从联系信息中获取名称：

# java - Java Swing 中的粗体固定字体

> ID：726142
> 
> 赞同：2
> 
> 时间：2009-04-07T14:50:14.427
> 
> 标签：java, swing, fonts

我正在尝试在 Java 中使用固定宽度的字体。我可以使用 Courier 或 Lucida Console，但是当我应用“粗体”样式时，它会使字符的宽度变大，这在我的应用程序中是不可接受的。无论如何我可以强制粗体字符与非粗体字符具有相同的宽度吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-26T06:30:18.547

`Monospaced`应该在任何平台上工作。在 Windows 上，我喜欢`Consolas`. `Courier New`也应该工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T10:35:18.243

我能想到的唯一解决方案是找到一个以完全相同的宽度呈现的字体，而不管粗体属性如何。我还没有找到这样的字体。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T14:40:30.400

回复@Mario Ortegon 的建议，我在 Sun 论坛上问过，有人建议 Lucida Sans 打字机，这似乎确实有效，但看起来很糟糕。>:(

# javascript - Javascript：格式化数字的更简单方法？

> ID：726144
> 
> 赞同：17
> 
> 时间：2009-04-07T14:50:26.110
> 
> 标签：javascript, jquery, formatting

我正在尝试在我的页面上格式化各种数字。这些数字代表价格、价格变化或百分比。我知道 Javascript 具有限制小数位数的功能，但是是否支持其他类型的格式，例如用逗号对数字进行分组，控制是否显示 +/- 等？这是我到目前为止所拥有的：

```
var FORMATTER = {
    price       : function(value) { return '$' + value.toFixed(2); },
    pricePer    : function(value) { return (value * 100).toFixed(2) + '%'; },
    priceChg    : function(value) { return (value >= 0 ? '+' : '-') + '$' + Math.abs(value).toFixed(2); }
}; 
```

它工作正常，但它想在 'price' 格式化程序中添加逗号，你可以看到在 'priceChg' 格式化程序中有一个 hack，我尝试将 +/- 符号移动到 '$' 前面符号。

基本上，我希望那里有一些库（jQuery 可以）来模拟 Java 的 DecimalFormat 类。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-07T14:54:55.930

有 NUMBERFORMATTER jQuery 插件，详情如下：

[https://code.google.com/p/jquery-numberformatter/](https://code.google.com/p/jquery-numberformatter/)

从上面的链接：

> 这个插件是一个 NumberFormatter 插件。任何使用过 Java 或 PHP 等服务器端代码以及使用过国际化的人都可能熟悉数字格式。

编辑：用更直接的链接替换了链接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T14:54:41.593

不，没有对数字格式的内置支持，但谷歌搜索会显示大量代码片段，这些代码片段将为您完成此操作。

编辑：我错过了你帖子的最后一句话。尝试[http://code.google.com/p/jquery-utils/wiki/StringFormat](http://code.google.com/p/jquery-utils/wiki/StringFormat)获取 jQuery 解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-05T20:26:51.763

刚刚完成了一个用于格式化数字[Numeral.js](http://adamwdraper.github.com/Numeral-js/)的 js 库。它处理小数、美元、百分比甚至时间格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-07T03:46:50.867

还可以尝试[dojo.number](http://docs.dojocampus.org/dojo/number)，它具有内置的本地化支持。它更接近于 Java 的 NumberFormat/DecimalFormat

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-05T21:03:48.450

如果有人感兴趣，这是 YUI 版本：

[http://developer.yahoo.com/yui/docs/YAHOO.util.Number.html](http://developer.yahoo.com/yui/docs/YAHOO.util.Number.html)

```
var str = YAHOO.util.Number.format(12345, { thousandsSeparator: ',' } ); 
```

# ruby-on-rails - 在 Ruby on Rails 中创建对象时，您更喜欢哪种保存方法，为什么？

> ID：726146
> 
> 赞同：7
> 
> 时间：2009-04-07T14:50:31.087
> 
> 标签：ruby-on-rails, ruby, activerecord, rescue

在 Ruby on Rails 应用程序中为对象编写“创建”方法时，我使用了两种方法。为了更清晰和更一致的代码，我想使用一种方法。我将在下面列出这两种方法。有谁知道一个比另一个更好吗？如果是这样，为什么？

方法一：

```
def create1
  # is this unsecure? should we grab user_id from the session
  params[:venue]['user_id'] = params[:user_id]

  begin
    venue = Venue.create(params[:venue])
    @user_venues = @user.venues
    render :partial => 'venue_select_box', :success => true, :status => :ok
  rescue ActiveRecord::RecordInvalid
    render :text => 'Put errors in here', :success => false, :status => :unprocessable_entity
  end
end 
```

方法二：

```
def create2
   # is this unsecure? should we grab user_id from the session
  params[:venue]['user_id'] = params[:user_id]

  venue = Venue.new(params[:venue])
  if venue.save
    @user_venues = @user.venues
    render :partial => 'venue_select_box', :success => true, :status => :ok
  else
    render :text => 'Put errors in here', :success => false, :status => :unprocessable_entity
  end
end 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T18:23:15.927

```
class VenuesController < ApplicationController
  def create
    @venue = @user.venues.create!(params[:venue])
    render :partial => 'venue_select_box', :success => true, :status => :ok
  end

  rescue_from ActiveRecord::RecordInvalid do
    render :text => 'Put errors in here', :success => false, :status => :unprocessable_entity
  end
end 
```

以`@user.venues`这种方式使用可确保始终正确设置用户 ID。此外，ActiveRecord 将在调用`:user_id`过程中保护字段不被分配。`#create!`因此，来自外部的攻击将无法修改`:user_id`。

在您的测试中，您可以验证对 :create 执行 POST 会引发 ActiveRecord::RecordInvalid 异常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T15:10:55.313

我认为例外不应该用于常规条件，所以我会说第二个更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T15:18:33.580

这取决于。如果您希望所有 create 语句都能正常工作，请使用前者，因为创建和保存失败是例外情况，并且可能是程序无法轻松恢复的情况。此外，如果您使用关系完整性（RedHill Consulting 的foreign_key_migrations），这将引发外键违规异常，因此您可能希望在创建或更新时捕获它们。

第二个是可行的，如果查询不成功是您期望作为该特定操作的日常操作的一部分的事情，那么这很好。

此外，您关于会话不安全的代码注释 - 会话是放置 user_id 的地方。只要您在执行其他任何操作之前检查以验证用户是否已通过身份验证，就可以了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T15:23:35.253

我完全同意唐的评论。但我什至会更进一步使用 user_id 部分并将其设置为模型上的前置过滤器。

# mysql - mysql查询，在查询中重用列名

> ID：726147
> 
> 赞同：1
> 
> 时间：2009-04-07T14:50:36.830
> 
> 标签：mysql

我有一个 mysql 查询，如下所示：

```
SELECT users*100 as totalusers, totalusers*90 AS totalsalerys FROM table 
```

正如你所看到的，我想`totalusers`在计算时重用，`totalsalerys`这样我儿子就不必再次编写相同的代码了。这似乎在 mysql 中不起作用，还有另一种简单的方法可以做到这一点吗？

我的查询只是一个示例，将`*100`and更改`*90`为一些非常长的公式，您可能会明白我的意思..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:57:23.753

```
SELECT  (@r := users * 100) as totalusers,
        @r * 90 AS totalsalerys
FROM    table 
```

您也可以使用子查询作为建议，但它对子句`@Tom Ritter`不友好。`ORDER BY ... LIMIT ...`

在中，将在外部子查询中应用任何过滤器**之前**`MySQL`获取内部子查询的所有结果。

 *** * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:54:16.633

我相信您必须复制/粘贴公式或使用子查询。下面将在 T-SQL 中工作，但我想它也可以在 MySQL 中工作，因为它非常简单。

```
 SELECT 
     x.totalusers, x.totalusers*90 AS totalsalerys 
 FROM (
      SELECT users*100 as totalusers FROM table
 ) x 
```

# sql - SQL 查询 - 类似于数据透视表

> ID：726152
> 
> 赞同：0
> 
> 时间：2009-04-07T14:51:33.287
> 
> 标签：sql, pivot-table

我有一个 sql 查询的模型，它将代表一个真正的 sql 查询。

```
Create table #tmp
(
    Atype varchar(10),
    Btype varchar(10)
)

insert into #tmp values ('a','x')
insert into #tmp values ('b','x')
insert into #tmp values ('a','y')
insert into #tmp values ('a','y')
insert into #tmp values ('b','z')
insert into #tmp values ('b','y')

select atype, btype,count(*) as count
from #tmp
group by atype, btype
order by atype

drop table #tmp 
```

这会给我以下结果：

```
atype btype count
-----------------
a     x     1
a     y     2
b     x     1
b     y     1
b     z     1 
```

在此之后我正在寻找的是能够创建一个基本上看起来像这样的报告：

```
atype|x| y| z
-------------
a    |1| 2| 0
b    |1| 1| 1 
```

我相信你可以使用疯狂的 t-sql 代码来做到这一点，但我正在努力让它正确。

编辑：

我同意您可以使用 TSQL PIVOT 命令，但是当 Btype 是变量时会发生什么。这意味着我不知道会有多少种类型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T14:57:30.493

```
SELECT
  atype, 
  SUM(CASE btype WHEN 'x' THEN 1 ELSE 0 END) AS x,
  SUM(CASE btype WHEN 'y' THEN 1 ELSE 0 END) AS y,
  SUM(CASE btype WHEN 'z' THEN 1 ELSE 0 END) AS z
FROM
  #tmp
group by 
  atype
order by 
  atype 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:13:06.150

`@Tomalak`的答案很好，但没有什么疯狂的，只是很老`SQL`。

`T-SQL`如果您有兴趣，这是您要求的真正疯狂的代码：

```
SELECT  atype, [x], [y], [z]
FROM    (
        SELECT  atype, btype
        FROM    #tmp
        ) t
PIVOT
        (
        COUNT(btype)
        FOR btype IN ([x], [y], [z])
        ) AS PivotTable 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:02:23.790

似乎只有 SQL Server 2005 支持直接透视，如下[所示](http://geekswithblogs.net/lorint/archive/2006/08/04/87166.aspx)

这是使用 Oracle 完成的方法 - [http://www.adp-gmbh.ch/ora/sql/examples/pivot.html](http://www.adp-gmbh.ch/ora/sql/examples/pivot.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T15:05:49.133

有关生成交叉表的 MySQL 存储过程，请参见此内容：

[http://www.futhark.ch/mysql/106.html](http://www.futhark.ch/mysql/106.html)

# java - Java Enums 可以有行为吗？

> ID：726155
> 
> 赞同：14
> 
> 时间：2009-04-07T14:51:42.397
> 
> 标签：java, oop, enums

在 Java 中，Enum 可以做 Enums 所做的伟大事情，但也可以有方法（行为和逻辑）。与使用枚举的类相比，这有什么优势？也欢迎简单的例子来说明这一点。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-07T14:59:08.260

这是一个简单的例子：

```
enum RoundingMode {
    UP {
        public double round(double d) {
            return Math.ceil(d);
        }
    },
    DOWN {
        public double round(double d) {
            return Math.floor(d);
        }
    };

    public abstract double round(double d);
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T15:01:27.223

`Enum`类型也是实现真正单例的好方法。

Java 中的经典单例模式通常涉及私有构造函数和公共静态工厂方法，但仍然容易通过反射或（反）序列化进行实例化。枚举类型可以防止这种情况。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-07T14:55:07.397

我不太确定问题的标题与其余部分的位置相符。是的，Java 枚举有行为。他们也可以有状态，虽然它应该真的，*真的*是不可变的状态。（可变枚举值的想法在 IMO 中非常可怕。）

Java 中的枚举基本上是一组固定的对象。好处是您知道，如果您有该类型的引用，它*始终*是`null`众所周知的集合之一或其中之一。

就我个人而言，我真的很喜欢 Java 枚举，并希望 C# 也有它们——它们比 C# 的枚举更加面向对象，C# 的枚举基本上是“命名数字”。在初始化顺序方面有一些“陷阱”，但它们通常都很棒。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T15:03:22.523

因为枚举实例是单例，您可以在`switch`语句中使用它们或使用 with`==`来检查相等性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T15:07:45.540

基本上，Java 枚举**是**类（我不认为在字节码级别存在差异），具有已知固定的可能实例集并能够在 switch 语句中使用它们的额外好处。

您可以使用常规类模拟“已知的固定可能实例集”（无数书籍和文章中描述的“类型安全枚举”模式），但要让它真正正确地工作需要做很多工作（对每个这样的类重复）关于序列化、equals() 和 hashCode()，也许还有一些我忘记的东西。语言级别的枚举使您免于工作。而且，如上所述，在 switch 语句中只能使用语言级别的枚举。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T14:57:59.260

在我们的项目中，我们将 Enums 用于一些事情，但也许最显着地用于 i18n 目的 - 每条显示的文本都被赋予一个 Enum。Enum 类有一个返回字符串的方法，该方法检查正在使用的语言环境，并在运行时从翻译集合中选择正确的翻译。

这具有双重目的 - 您可以从 IDE 获得代码完成，并且永远不要忘记翻译字符串。

用法非常简单，举个例子几乎是多余的，但这里是如何使用翻译枚举

```
System.out.println(Translations.GREET_PERSON.trans()+" "+user.getName()); 
```

或者，如果您想花哨，让 Enum 接受参数，通过一些魔术字符串操作，将其插入到翻译字符串中的标记位置

```
System.out.println(Translations.GREET_PERSON.trans(user.getName()); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-12-21T16:26:52.900

看看 java/joda 时间类，枚举在其中做了很多工作。

这是 java.time.Month 的示例：

```
public enum Month implements TemporalAccessor, TemporalAdjuster {
    JANUARY,
    FEBRUARY,
    MARCH,
    APRIL,
    MAY,
    JUNE,
    JULY,
    AUGUST,
    SEPTEMBER,
    OCTOBER,
    NOVEMBER,
    DECEMBER;

    private static final Month[] ENUMS = Month.values();

    public static Month of(int month) {
        if (month < 1 || month > 12) {
            throw new DateTimeException("Invalid value for MonthOfYear: " + month);
        }
        return ENUMS[month - 1];
    }

    // About a dozen of other useful methods go here 

} 
```

# asp.net - IE 6 SSL 中的弹出窗口

> ID：726182
> 
> 赞同：0
> 
> 时间：2009-04-07T14:55:29.873
> 
> 标签：asp.net, javascript, ssl, internet-explorer-6, popup

我有一个奇怪的问题。我在 IE6 中打开一个弹出窗口，并在服务器上启用了 SSL。

当以下执行时，它似乎锁定了浏览器。我知道这很模糊。这是似乎是问题的 JScript。一定要爱上你的 IE6！

```
function PopoffWindow(url) {
    var features = "height=400,width=550,top=60,left=100,"
                + "toolbar=no,location=no,menubar=no,status=no,"
                + "scrollbars=yes,resizable=yes";

    var win = window.open(url, "DSRocks", features);
    win.focus();
    return win;
} 
```

这在 IE7 或 Firefox 中不是问题。并且问题似乎与此服务器隔离（使用 SSL）。有人对此有任何见解吗？

谢谢，

缺口

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T15:07:03.670

window.open 调用是否有可能没有足够快地返回以允许您在下一行对其执行 .focus() ？

如果你在这两行之间抛出一个 alert() 会发生什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:10:46.093

您是否尝试为窗口指定名称？当您打开一个未命名的窗口时，IE6 有时会做一些有趣的事情。只需在 url 之前添加一个“windowName”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:43:25.813

对于这样的问题，通常最好回归基础。需要检查的几件事：

*   你是如何测试IE6的？您是否使用 Microsoft [Internet Explorer 应用程序兼容性 VPC 映像](http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en)或某些工作站安装，您已设法让 IE6 和 IE7 在同一台 PC 上运行？在同一台 PC 上同时安装 IE6 和 IE7 似乎可以正常工作，但会导致您看到的问题。即使您使用现有的 VPC 映像，您也可能希望下载（或从现有下载中提取）一个新副本，并查看它是否发生在该 IE6 副本上。
*   您是否清除了 IE6 安装的 Internet 临时文件、Cookie 和历史记录？我知道这听起来很明显也很愚蠢，但是可能正在弹出窗口中加载的资源在缓存中已损坏，从而导致了问题。
*   您是否禁用了 IE6 中的每个附加组件？

我认为首先要确定问题是出在每个 IE6 副本上，还是仅出在您的 IE6 副本上（由第一个要点涵盖）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T16:45:11.763

授予，

谢谢。但问题在于查看托管站点的所有 IE6 实例。我将尝试在 focus() 之前添加一个警报，看看这是否是问题所在。至于windowname ..这是我传递的第二个参数“DSRocks”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T17:26:51.977

问题出在 JSON 网络服务调用上。详情请查看此链接：

[http://codeclimber.net.nz/archive/2006/12/22/How-to-enable-an-ASP.NET-WebService-to-listen-to-HTTP.aspx](http://codeclimber.net.nz/archive/2006/12/22/How-to-enable-an-ASP.NET-WebService-to-listen-to-HTTP.aspx)

# asp.net - 当跟踪文件变得太大时截断跟踪文件的有效方法？

> ID：726192
> 
> 赞同：1
> 
> 时间：2009-04-07T14:57:38.700
> 
> 标签：asp.net, trace

我正在使用 .NET 的内置跟踪机制来跟踪程序执行。问题是跟踪文件可以很快增长到几 MB。当文件增长超过某个点时，是否有一种有效的截断文件的方法？我想在编写某些内容时进行检查（我有一个继承自 TraceListener 的自定义类），但这可能会大大降低性能。也许计时器会是一个更好的解决方案？

有人有想法么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T15:01:51.513

实现自定义跟踪侦听器：

> 让我们看看如何解决相当常见的任务：管理连续生成的跟踪文件。默认跟踪侦听器实现并不真正适合应该始终处于活动状态的服务应用程序。如果应用程序产生大量的跟踪输出，那么这些信息迟早会耗尽所有磁盘空间。

[http://www.codeproject.com/KB/dotnet/customnettracelisteners.aspx?display=Print](http://www.codeproject.com/KB/dotnet/customnettracelisteners.aspx?display=Print)

使用此示例，您可以像这样创建日志块：

```
MyTrace.txt (recent trace information); 
MyTrace00.txt (trace history backup); 
MyTrace01.txt (trace history backup); 
and so on... 
```

当然，您可以丢弃备份文件。

（只是一个提示：试试*log4net*（[这里](http://logging.apache.org/log4net)）和*Enterprise Library Logging Block*（[这里](http://msdn.microsoft.com/en-us/library/cc309506.aspx)）！）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:59:45.183

也许使用事件日志跟踪侦听器，因为事件日志可以很容易地以这种方式自动循环。

# xslt - XSLT - 过滤

> ID：726202
> 
> 赞同：2
> 
> 时间：2009-04-07T14:58:29.367
> 
> 标签：xslt, xpath

我有一个这样的重复 xml 树 -

```
<xml>
  <head>this is a sample xml file</head>
  <item><color>yellow</color><color>red</color></item>
  <item><color>blue</color></item>
  <item><color>grey</color><color>red</color><color>blue</color></item>
</xml> 
```

如您所见，每个项目都可以有不同数量的颜色标签。

我希望只获得前两项的所有颜色标签。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T15:06:18.740

```
<xsl:template match="xml">
  <xsl:apply-templates select="item[position() &lt; 3]/color" />
</xsl:template>

<xsl:template match="color">
  <xsl:copy-of select="." />
</xsl:template> 
```

应用于您的 XML 这会产生：

```
<color>yellow</color>
<color>red</color>
<color>blue</color> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T15:07:10.207

获得技术上完全正确的项目的一种潜在可能方法，并且绝不会在命名空间、未来要求或模板构造方面对文档结构做出假设，这很简单：

```
/xml/item[position() &lt; 3]/color 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:07:19.520

尝试这个...

```
/xml/item[ position() &lt; 3 ]/color 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-07T15:05:12.067

为每个项目添加一个序号字段并选择前两个。

# vb.net - 组合框数据绑定 DisplayMember 和 LINQ 查询

> ID：726213
> 
> 赞同：0
> 
> 时间：2009-04-07T15:02:08.080
> 
> 标签：vb.net, linq, combobox

# 更新

我决定遍历`Data.DataTable`并修剪那里的值。

* * *

利用[SirDemon 的](https://stackoverflow.com/questions/726213/need-a-little-help-with-combobox-databinding-displaymember-and-linq-queries/733494#733494)帖子，我稍微更新了代码：

```
Sub test(ByVal path As String)
    Dim oData As GSDataObject = GetDataObj(path)
    EmptyComboBoxes()
    Dim oDT As New Data.DataTable
    Try
        Dim t = From r In oData.GetTable(String.Format("SELECT * FROM {0}gsobj\paths ORDER BY keyid", AddBS(path))) Select r

        If t.Count > 0 Then
            oDT = t.CopyToDataTable
            For Each dr As Data.DataRow In oDT.Rows
                dr.Item("key_code") = dr.Item("key_code").ToString.Trim
                dr.Item("descript") = dr.Item("descript").ToString.Trim
            Next
            dataPathComboBox.DataSource = oDT
            dataPathComboBox.DisplayMember = "descript"
            dataPathComboBox.ValueMember = "key_code"
            dataPathComboBox.SelectedIndex = 0
            dataPathComboBox.Enabled = True
        End If
    Catch ex As Exception

    End Try
End Sub 
```

这几乎可以按照我的需要工作，数据最初来自 foxpro 表，因此它返回的字符串是尾随空格字符的`<value>`加号 ( `<Field>.maxlength-<value>.length`)。例如，长度为 12 个字符的字段的值为 bob。当我查询数据库时，我得到“ `bob_________`”，其中 _ 是一个空格。

我尝试了几种不同的方法来消除空格，例如：

> `dataPathComboBox.DisplayMember.Trim()`
> `dataPathComboBox.DisplayMember = "descript".Trim`.

但是还没有任何效果。除了迭代`Data.DataTable`或创建自定义`CopyToDataTable`方法之外，还有什么方法可以修剪这些值？也许它可以与 LINQ 查询一起完成？

* * *

这是我到目前为止的代码，查询数据库和获取信息没有问题，但我不知道如何在 ComboBox 列表中显示正确的文本。我总是得到`System.Data.DataRow`：

```
Try
    Dim t = From r In oData.GetTable("SELECT * FROM ../gsobj/paths ORDER BY keyid") _
            Select r

    dataPathComboBox.DataSource = t.ToList
    dataPathComboBox.SelectedIndex = 0
    'dataPathComboBox.DisplayMember = t.ToList.First.Item("descript")
    dataPathComboBox.Enabled = True
Catch ex As Exception
    Stop
End Try 
```

我知道在 DisplayMember 行上的`.First.Item()`部分是错误的，我只是想显示我试图将哪一行指定为 DisplayMember。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T09:30:20.077

我很确定您的代码尝试将整个 DataRow 设置为一个属性，该属性只是字段（在强类型类中）或列（在 DataTable 中）的名称。

```
dataPathComboBox.DisplayMember = "descript" 
```

如果 DataTable 包含该名称的检索列，则应该可以工作。

另外，我建议您仅在完成 ​​DataBinding 并且知道您实际上有项目之后才设置您的 SelectedIndex，否则`SelectedIndex = 0`可能会引发异常。

编辑：修剪绑定列的名称只会修剪它，而不是实际的绑定值字符串。您要么必须在绑定后检查所有项目并执行以下操作：

```
dataPathComboBox.Item[i].Text = dataPathComboBox.Item[i].Text.Trim() 
```

对于每一项。不确定您使用的是什么 ComboBox 控件，因此项目集合名称可能是其他名称。

如果 ComboBox 控件公开某种类型的 onItemDataBound 事件，则另一种解决方案是在绑定每个项目时对它执行此操作。

还有很多其他方法可以做到这一点，具体取决于控件本身提供的内容以及您选择执行的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T15:48:45.783

DisplayMember 旨在指示保存要显示的值的属性的名称。

在您的情况下，我不确定语法是什么，因为您似乎正在使用 DataSet，但这应该是

```
... DisplayMember="Item['descript']"  ... 
```

在 Xaml 中，除非您需要在运行时切换它，在这种情况下，您可以在代码中使用

```
dataPathComboBox.DisplayMember = "Item['descript']" 
```

同样，对语法不是 100% 确定的。如果您使用的是强类型数据集，则更容易，因为您的行上应该有一个“descript”属性，但鉴于您的错误指示“System.DataRow”而不是自定义类型，我猜你不是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T09:20:05.797

因为我无法弄清楚您正在使用的数据源的基础类型，我建议您将注释字符串更改为

```
dataPathComboBox.DisplayMember = t.ElementType.GetProperties.GetValue(0).Name 
```

并尝试在实践中确定正确的索引（最初为零）。

# testing - 测试网页/站点时要查找的首要事项

> ID：726219
> 
> 赞同：3
> 
> 时间：2009-04-07T15:03:00.027
> 
> 标签：testing

我正在寻找在进行网站测试时要寻找的优先事项列表。我们可以做一些事情来提高网站的性能，有些事情会影响性能。是否有开发人员和测试人员严格遵循的指南，以提供最佳的网站体验？

### 有关的：

> [开发人员在建立公共网站之前应该知道什么？](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T15:09:19.887

对于初学者，Yahoo 有一个很好的列表 @ [Best Practices for Speeding Your Web Site](http://developer.yahoo.com/performance/rules.html)。

出于安全考虑，有[OWASP 前十名](http://www.owasp.org/index.php/Top_10_2007)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:14:36.693

**您的网站在所有主要网络浏览器**上都能按预期运行

 *** * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:09:40.840

来自雅虎的家伙！拥有优秀[的开发者网络](http://developer.yahoo.com/)。具体来说，您可以查看他们的[Guide to Exceptional Performance](http://developer.yahoo.com/performance/)。

我肯定会建议您按照他们的建议下载 Yslow for Firebug 并使用它来预先衡量您网站的性能，然后使用它的评分系统作为提高性能的一种方式。

请记住，这些是一般的经验法则，有时根本不可能遵循他们所有的最佳建议来提高性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T15:16:46.143

一些安全问题：查看是否可能发生跨站点脚本或跨请求伪造攻击。如果您知道 URL，是否可以在不登录的情况下访问页面？

# asp.net - 如何在 ASP.NET gridview 控件中将项目分组到子标题中？

> ID：726220
> 
> 赞同：1
> 
> 时间：2009-04-07T15:03:21.790
> 
> 标签：asp.net, gridview

我想拿两张桌子并用结果填充一个gridview：

产品分类

我想让gridview按类别分成子标题，而不是作为产品gridview中的数据字段......

就像是：

（类别：食物，衣服，住所）

```
FOOD

 Rice 10s Available <buy now>

 Beans 20s Available <buy now>

 Chicken 50s Available <buy now>

CLOTHING

 Cloak 30s Available <buy now>

 Helmet 45s Available <buy now>

 Sandals 10s Available <buy now>

SHELTER

 Tent 100s Available <buy now> 
```

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T15:10:39.543

您不能使用开箱即用的 asp.net gridview。

您可以使用中继器并在中继器项内嵌套一个网格视图。类别的中继器。.NET 3.0 + 使用 ListView

您可以购买商业控件，也许有一些免费的控件可以定制以允许这种行为。

安德鲁

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T15:11:28.917

您可能想查看 DevExpress 网格控件，它不仅可以执行此操作，还允许用户手动将列拖到顶部，以便以他们认为合适的任何方式进行分类。您可以限制可以使用的列。

我不知道您是否可以在 GridView 中执行此操作（我认为您不能），但您绝对可以使用 DeveExpress 网格执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T18:18:06.720

ListView 将相当容易地做到这一点，因为它有分组模板。类别的中继器，以及项目的嵌套 GridViews 也将起作用。

如果您设置在 GridView 上，则需要一些技巧。您可以修改数据以放入分类行，子类化 GridView 以添加新行，添加自定义控件以将标记注入 GridView 的 HTML（我使用关闭当前行并添加新的跨行行），或使用客户端上的 JQuery。

子类化是“正确”的方式 - 并且可以重复使用 - 但它有点工作。修改数据相当容易，但它非常难看，并且取决于您如何绑定到数据。JQuery 实际上可能是这里最简单的路线。在第一列中设置类别，随着类别的变化创建新行，然后隐藏第一列。它也很好地降级，因为 noscript 将是第一列中的类别。这未经测试，但它应该让你接近：

```
var lastCategory = '';
$('TR > TD:first').each(function() {
   var thisCategory = $(this).text().trim();
   if (thisCategory != lastCategory) {
      // new category - insert subheading row
      var thisRow = $(this).parent();
      var colspan = $('> TD', thisRow).length;
      thisRow.insertBefore(
          '<tr class="subheading">' +
              '<td colspan="' + colspan.toString() + '">' +
                thisCategory +
              '</td>' +
          '</tr>'
      );
      lastCategory = thisCategory;
   }
}).hide(); // hide 1st columns 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-04T22:32:53.903

我尝试实现 Mark 的代码，并且不得不稍微调整它以使其工作。对于将来遇到此帖子的任何人，这里是修改后的代码：

```
var lastCategory = '';
$('tr').find('td:first').each(function() {
    var thisCategory = $(this).text().trim();
    if (thisCategory != lastCategory) {
        // new category - insert subheading row
        var thisRow = $(this).parent();
        var colspan = $('> td', thisRow).length;
        thisRow.before(
          '<tr class="subheading">' +
              '<td colspan="' + colspan.toString() + '">' +
                thisCategory +
              '</td>' +
          '</tr>'
        );
        lastCategory = thisCategory;
    }
}).hide(); 
```

我必须更改初始选择器以获取每个单元格中的第一个单元格，并将 insertBefore() 更改为 before() 因为 inserBefore() 用于 jQuery 对象而不是 html 内容。

# sql-server - Full Text search on a Varbinary Column - Is it possible to use a mime type rather than a file extension as my Type Column?

> ID：726243
> 
> 赞同：0
> 
> 时间：2009-04-07T15:09:04.367
> 
> 标签：sql-server, full-text-search

I am setting up full text search on an existing database. We have Document table with the following schema:

```
ID int Not Null,
Data varbinary(max) Not Null
MimeType varchar Not Null 
```

I want to use full text search on the data column, using the mimetype to specify the document type.

I was hoping it would be possible to register new types into whatever tables are used when you use the view `sys.fulltext_document_types`. Is this possible?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:11:43.663

No it isn't possible. IFilters are mapped to a document extension. A new column has to be added and populated.

# internet-explorer - IE 告诉我我混合了 SSL 内容，而我没有

> ID：726244
> 
> 赞同：0
> 
> 时间：2009-04-07T15:09:09.110
> 
> 标签：internet-explorer, ssl

在 IE 中，它给了我“页面上的某些项目不安全”的消息。我已经追踪到这一行：

```
<script type="text/javascript" src="lightbox/js/prototype.js"></script> 
```

这是我下载的灯箱脚本。我尝试使用 https 使 src 相对或绝对，无论哪种方式都会发生。并且仅在 IE 中。

如果您需要查看，请访问以下页面：[Clicky](https://www.kranichs.com/cart.php)

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T15:24:11.210

查看您在 Fiddler 中的页面，我看到了对[https://www.kranichs.com/images/bottombax_02.jpg](https://www.kranichs.com/images/bottombax_02.jpg)的请求，这是一个 404。

IE 将 404 错误消息视为不安全的内容，因此如果您将其包含（在 IFRAME 或其他内容中），那么您将看到混合内容错误。解决这个问题，看看会发生什么。

如果该文件存在时没有任何变化，并且您在 Fiddler 中看不到任何 HTTP 请求，则可能是[removeChild](http://support.microsoft.com/kb/925014)问题 - 如果您删除带有背景图像的 DIV（如灯箱可能），那么您将看到混合内容错误。

# .net - .Net：空字符串是不是清除空格字符？

> ID：726248
> 
> 赞同：2
> 
> 时间：2009-04-07T15:10:19.947
> 
> 标签：.net, vb.net, string, null

我一直使用 String.IsNullOrEmpty 来检查空字符串。最近我注意到一个 " " 算作不是一个空字符串。例如，

```
 Dim test As String = " "
    If String.IsNullOrEmpty(test) Then
        MessageBox.Show("Empty String")
    Else
        MessageBox.Show("Not Emtpy String")
    End If 
```

它将显示“非空字符串”。那么我们如何检查字符串中的“”或“”呢？

编辑：我不知道“”算作字符。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T15:15:54.083

试试这个方法来检查空白字符串。它与 Trim() 版本的不同之处在于它不分配新字符串。它还使用了更广泛的空白概念。

```
Public Function IsNullOrBlank(ByVal str as String) As Boolean
  if String.IsNullOrEmpty(str) Then
    Return True
  End IF
  For Each c In str
    IF Not Char.IsWhiteSpace(c) Then
      Return False
    End If
  Next
  Return True
End Function 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-17T11:57:21.723

[String.IsNullOrWhiteSpace](http://msdn.microsoft.com/en-us/library/system.string.isnullorwhitespace.aspx)在 .NET 4 的 BCL 中

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-07T15:13:52.497

“”是一个 ASCII 32 值，它与任何其他 ASCII 字符没有什么不同，只是它“看起来”是空白的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T15:13:02.873

问题是你需要修剪字符串，但是如果你在一个空字符串上调用 trim() ，你会得到一个错误。

```
string.IsNullOrEmpty(s.Trim()) 
```

这会出错。

你需要做类似的事情

```
if (Not string.IsNullOrEmpty(s) AndAlso s.Trim()!=string.Empty) 
```

这将验证字符串不为空或为空，如果有一些内容，它将修剪然后验证它不为空。

# 编辑

感谢 Slough 帮助我了解我的 VB 语法。我是 C# 人，需要复习 vb 的语法

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T15:17:00.103

在 VB.NET 中，您需要使用如下测试：

```
If String.IsNullOrEmpty(test) OrElse String.IsNullOrEmpty(test.Trim()) Then 
```

防止NullException`OrElse`发生在`test.Trim()`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T15:19:37.727

```
public static bool IsNullOrWhite(string s)
{
  if (String.IsNullOrEmpty(s))
    return true;

  for (int i = 0; i < s.Length; i++)
    if (!Char.IsWhiteSpace(s, i))
      return false;

  return true;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T15:13:06.243

也许您只是想在检查之前修剪字符串（空格）？

```
Dim test As String = " "
If test.Trim().Length = 0 Then // Best option as long as string is guaranteed not to be null.
//  If test = Nothing OrElse test.Trim().Length = 0 Then // If string can be null.
    MessageBox.Show("Empty String")
Else
    MessageBox.Show("Not Emtpy String")
End If 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T15:17:50.290

如前所述，如果字符串为空，则调用 Trim() 将引发 NullReferenceException。我有时使用`Regex.IsMatch(test, "^ +$")`（希望我有正确的参数顺序）来测试一个或多个空格。^ 和 $ 确保您匹配整个字符串。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-07T15:20:33.653

如果您确实需要将仅包含空格字符的字符串视为与空字符串或空字符串相同，那么您可以使用像这样的扩展方法（对不起，它在 C# 中）：

```
namespace ExtensionMethods
{
    public static class StringExtensions
    {
        public static bool IsNullOrEmptyOrWhitespace(this string str)
        {
            if (string.IsNullOrEmpty(str)) return true;
            return (str.Trim().Length == 0);
        }
    }
} 
```

这允许您编写：

```
using ExtensionMethods;

string s1 = "  ";
string s2 = "some string";

s1.IsNullOrEmptyOrWhitespace(); //-> returns true
s2.IsNullOrEmptyOrWhitespace(); //-> returns false 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-07T15:26:16.057

```
If test Is Nothing OrElse test.Trim().Length = 0 Then ... 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-04-07T15:19:22.017

您可以添加一个扩展方法，例如[此处](https://stackoverflow.com/questions/647643/string-isnullorblank-extension-method)讨论的，并保持与之前相同的易用性`IsNullOrEmpty()`。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-04-07T15:23:24.783

```
If String.IsNullOrEmpty(str) OrElse str.Trim().Length = 0 Then
  ' ..
End If 
```

如果 str 为 null，则以下内容有时可能不起作用，因为在 null 上调用方法将导致异常。If String.IsNullOrEmpty(str.Trim()) Then ' 有时会出现异常 ... End If

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-04-07T15:12:27.167

尝试

```
Dim test As String = " "
If String.IsNullOrEmpty(test.Trim()) Then
    MessageBox.Show("Empty String")
Else
    MessageBox.Show("Not Emtpy String")
End If 
```

希望有帮助。

# java - 检测使用 Java Web 应用程序登录计算机的用户

> ID：726249
> 
> 赞同：8
> 
> 时间：2009-04-07T15:10:22.850
> 
> 标签：java, tomcat, active-directory

我想开发一个可以检测登录 Windows 域的用户的 Java 应用程序。这些凭据将用于登录运行在 Tomcat 上的 Java 应用程序。

我怎样才能做到这一点？我想知道访问我的网络应用程序的远程用户。此用户已登录 Active Directory。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T13:47:33.020

这是我的解决方案：

将 jcifs-1.2.7.jar 放在 [TOMCAT_HOME]/common/lib 目录中。

修改应用程序的 web.xml，将以下文本添加到 webapp 部分：

```
<filter>
    <filter-name>NtlmHttpFilter</filter-name>
    <filter-class>jcifs.http.NtlmHttpFilter</filter-class>
    <init-param>
        <param-name>jcifs.http.domainController</param-name>
        <param-value>xx.xx.xx.xxx</param-value>  --> Domain Controller IP
    </init-param>
    <init-param>
        <param-name>jcifs.util.loglevel</param-name>
        <param-value>2</param-value>
    </init-param>
  </filter>
  <filter-mapping>
       <filter-name>NtlmHttpFilter</filter-name>
       <url-pattern>/*</url-pattern>
  </filter-mapping> 
```

您可以在没有提示的情况下使用 request.getRemoteUser() 获取远程用户。

再见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T16:01:04.773

[通常，您可以使用Java Authentication and Authorization Service](http://en.wikipedia.org/wiki/Java_Authentication_and_Authorization_Service)连接到本地授权服务。这可能会做你想要的。

也就是说，你确定这是正确的方法吗？你想要完成什么？您是否正在为 webapp 寻找单点登录解决方案？

然后是： [如何配置 Tomcat 以使用 Windows NTLM 身份验证？](https://stackoverflow.com/questions/439120/how-to-configure-tomcat-to-use-windows-ntlm-authentication) 可能是您正在寻找的东西，正如 Steve Read 在上面的评论中所建议的那样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T16:13:00.797

[Jcifs](http://jcifs.samba.org)图书馆一定会对您有所帮助。该库可用于执行 NTLM 身份验证。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-07T16:03:47.777

我记得使用 mod_ntlm for apache 对我有用，但那是几年前的事了，所以我不知道从那以后发生了什么变化。

# php - 在 PHP 中标准化“时间”的最佳方法是什么？

> ID：726260
> 
> 赞同：1
> 
> 时间：2009-04-07T15:12:17.870
> 
> 标签：php, twitter, normalization

我正在寻找一种将用户输入转换为适合计算的标准化数据的方法。输入是一段时间的，并且来自 Twitter，所以它只是字符串。理想情况下，我会喜欢这些结果：

一个半小时 --> 01:30

27.52 --> 00:28

5:24 --> 05:24

这是一件特别困难的事情吗？我可以专注于指导用户如何创建良好的输入，但也不想过于严格。

任何建议都会很棒，

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T15:30:21.460

让它发挥作用的三件事：

1.  常用表达
2.  模糊逻辑（大量 if/else 语句）
3.  [strtotime](http://php.net/strtotime)标准化为标准 unix 纪元时间（这使得加法/减法非常容易）

因为它是用户输入和非确定性的，所以这是唯一的方法。即使这样，结果也不会 100% 可靠，并且应该可以接受小的误差范围。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T15:16:26.423

我认为你会得到最好的是 strtotime ( [http://us3.php.net/strtotime](http://us3.php.net/strtotime) ) 函数。

# database - 从 ms 访问 ado.net 返回多个结果集

> ID：726263
> 
> 赞同：1
> 
> 时间：2009-04-07T15:13:00.677
> 
> 标签：database, ms-access, ado.net, dataset, data-access

嘿伙计们，我想在 1 个 ado.net 调用中从我的 ms access 数据库中获取 3 个表，但是当我尝试这样做时出现错误

当我将我的 sql 查询更改为只获取 1 个表时，我的代码工作正常

谁能让我知道如何通过 ms 访问实现这一目标？因为我多年来一直在使用 sql server 执行此操作，没有任何问题。也许访问不支持多个结果集？我在访问方面没有做太多工作。请帮忙。以下是我的参考代码：

```
System.Data.OleDb.OleDbConnection con = new System.Data.OleDb.OleDbConnection(@"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=DatabaseFile.mdb;Persist Security Info=True");
System.Data.OleDb.OleDbDataAdapter da = new System.Data.OleDb.OleDbDataAdapter("SELECT * FROM Table1; SELECT * FROM Table2; SELECT * FROM Table3;", con);
DataSet ds = new DataSet();
da.Fill(ds); 
```

**更新：伙计们，这看起来不可能。所以我不得不编写非常愚蠢的代码来得到我想要的，完全浪费计算资源：**

```
DataSet ds = new DataSet();

ds.Tables.Add(new DataTable("Table1"));
ds.Tables.Add(new DataTable("Table2"));
ds.Tables.Add(new DataTable("Table3"));

System.Data.OleDb.OleDbConnection con = new System.Data.OleDb.OleDbConnection(@"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=DatabaseFile.mdb;Persist Security Info=True");
System.Data.OleDb.OleDbDataAdapter da = new System.Data.OleDb.OleDbDataAdapter("SELECT * FROM Table1;", con);
da.Fill(ds, "Table1");

da.SelectCommand.CommandText = "SELECT * FROM Table2;";
da.Fill(ds, "Table2");

da.SelectCommand.CommandText = "SELECT * FROM Table3;";
da.Fill(ds, "Table3"); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T15:19:13.843

据我所知，如果您的数据位于 Access mdb 中，则您不能拥有多个数据集。相反，如果您使用 Access 连接到外部数据源，则可以使用传递查询并这样做，但我认为这不是您的情况。（见[http://support.microsoft.com/kb/126992](http://support.microsoft.com/kb/126992)）

# c# - DataAdapter 从基表模式中选择字符串？

> ID：726267
> 
> 赞同：1
> 
> 时间：2009-04-07T15:13:06.430
> 
> 标签：c#, xsd, schema, strongly-typed-dataset, dataadapter

当我构建我的 .xsd 时，我必须为每个表选择列，它为表创建了一个模式，对吗？那么，如何让 Select 字符串用作数据适配器新实例的基本 Select 命令，然后根据需要向其附加 Where 和 OrderBy 子句？

这将使我不必使每个 DataAdapter 的字段列表（对于同一个表）与 .xsd 文件中该表的架构保持同步。

有几个 DataAdapter 在某个表模式上工作但在 Where 和 OrderBy 子句中使用不同的参数不是很常见吗？当然，不必为六个 DataAdapter 维护（甚至冗余构建）Select 字符串的字段列表部分，这些 DataAdapter 都在同一个表模式下工作。

我正在设想这样的伪代码：

```
BaseSelectString = MyTypedDataSet.JobsTable.GetSelectStringFromSchema()  // Is there such a method or technique?

WhereClause = " Where SomeField = @Param1 and SomeOtherField = @Param2"
OrderByClause = " Order By Field1, Field2"

SelectString=BaseSelectString + WhereClause + OrderByClause

OleDbDataAdapter adapter = new OleDbDataAdapter(SelectString, MyConn) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-08T18:35:33.633

每个表都有一个默认查询（上面带有检查的那个）。当您将表拖入数据集以创建查询时，它会编写一条 SQL 语句，用于对您的表进行架构。保持该查询简单，您可能实际上不会在代码中使用它，并且您始终可以编辑该查询以更新表模式。

每次打开默认查询时，它都会连接到您的数据源，并允许您选择以前不存在的新列。如果要更新现有列，请在尝试打开查询之前从表中删除所有列。保存查询时，更新的列会重新添加。

确保您的连接字符串有权查看列信息。

您可以将多个查询添加到单个 TableAdapter。设计器中的 TableAdapter 显示为顶部的表架构，底部的查询。默认查询将控制哪些列可用于其他查询的输出。要添加其他查询，请右键单击 TableAdapter 并选择“Add->Query”，或者如果您选择 TableAdapter 的底部，您可以选择“Add Query...”。您创建的任何新 SQL 查询都将从默认查询中的 SQL 开始。您为每个新查询指定一个方法名称，您可以使用它来代替默认查询的“Fill”或“GetData”方法。假设每个新查询都会有一个与默认查询匹配的结果集，即使它们可以有不同的“where”子句参数。

简而言之

*   每个表可能有一个 TableAdapter，只需添加多个查询。
*   每个附加查询可以有不同的“Where”子句参数，只要它们都返回相同的列。

# routing - 简单的 Java Web 服务路由器

> ID：726273
> 
> 赞同：0
> 
> 时间：2009-04-07T15:14:56.943
> 
> 标签：routing, service

如何设置程序化 Web 服务从我的 Web 应用程序转发到外部 Web 服务？我需要 tcpmon 之类的东西，然后将其集成到我的 webapp 战争中，以便我的 flash 文件可以将 web 服务调用回为它们提供服务的 webapp。反过来，这些调用将被路由到外部 Web 服务。ESB 对于这种普通路由来说太重了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T11:49:42.837

试试 Jason Edwards 的[代理 Servlet](http://edwardstx.net/wiki/attach/HttpProxyServlet/ProxyServlet.java)

# svn - SVN for Emacs：如何设置作者姓名和保存密码？

> ID：726274
> 
> 赞同：5
> 
> 时间：2009-04-07T15:15:06.583
> 
> 标签：svn, configuration, emacs

我似乎无法在任何地方的谷歌上找到这个。我正在尝试从 eclipse 迁移到 emacs，但我一生都无法弄清楚如何设置我的 svn 作者姓名，因此它不会默认作者姓名或保存密码，所以我不必输入它在任何时候。如果这很重要，我是 Ubuntu 8.10。

任何见解都会很棒。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T15:47:51.340

你使用哪个界面？我更喜欢[psvn](http://www.xsteve.at/prg/emacs/psvn.el)，它说以下内容：

> Q3：如何输入用户名和密码？
> 
> A3：在*svn-status* buffer按“s”，切换到 *svn-process* buffer按回车。系统将提示您输入用户名和密码。

据我所知，psvn 不提供保存密码的方法。无论如何，将您的密码存储在您的 dotmacs 中是不明智的。在 SSH 上使用 SVN 是个好主意，因为命令行 Subversion 客户端（psvn 也使用）可以记住 HTTPS 密码。在这种情况下，您可能希望生成一个 SSH 密钥对，让您每次都输入密码。[Subversion FAQ 中](http://subversion.tigris.org/faq.html#ssh-auth-cache)有一个关于它的条目，你可以如何做到这一点。

# clickonce - 自签名证书到验证码证书？

> ID：726275
> 
> 赞同：4
> 
> 时间：2009-04-07T15:15:22.870
> 
> 标签：clickonce, code-signing

我们通过 ClickOnce 和我们创建的自签名证书部署了一个 Windows 应用程序。我们现在正在寻求从像 VeriSign 这样的证书颁发机构获得 Authenticode 证书。

当我们开始使用新证书签署 ClickOnce 清单时，我们的用户是否必须重新安装应用程序？

是否有任何已知的迁移路径来处理我们的场景？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-09T10:02:21.740

是的，您可以做到这一点，而无需用户重新安装，但这很棘手。关键是要意识到应用程序清单具有 Authenticode 签名（以识别发布者）和强名称签名（以防止篡改）。诀窍是将旧证书用于强名称签名，将新证书用于 Authenticode 签名。

VS2005/Mage 或 .NET Framework SDK 中的签名工具 (signtool.exe) 都不支持这种签名。但[Windows Server 2003 R2 平台 SDK](http://www.microsoft.com/downloads/details.aspx?FamilyId=0BAF2B35-C656-4969-ACE8-E4C0C0716ADB&displaylang=en)包含较新版本的 signtool.exe，带有一个新的开关“/manifest”，并提供了使用不同密钥进行签名的选项。使用此工具，您可以使用两个签名中的每一个的不同密钥对 ClickOnce 清单进行签名。

您可以在此处找到[更多详细信息](http://blogs.msdn.com/danielma/archive/2007/03/19/clickonce-and-expired-certificates.aspx)。

# perl - 如何在 Perl 中将日期转换为纪元时间？

> ID：726289
> 
> 赞同：4
> 
> 时间：2009-04-07T15:17:20.057
> 
> 标签：perl, datetime, date, epoch

Solaris 10 似乎不太喜欢我。我正在尝试运行一个简单的脚本来接受日期并返回该日期的纪元：

```
#!/usr/bin/perl -w
use strict;
use Time::ParseDate;

my $date1 = "Mon Mar 27 05:54:08 CDT 2009";

#Convert to seconds since start of epoch
my $time1 = parsedate($date1);
print $time1; 
```

在 RHEL 机器上工作得非常好，但在 Solaris（两者都有 5.8.8 Perl）上被搞砸了，给出了以下错误消息。

在@INC 中找不到 Date/Parse.pm（@INC 包含：/usr/perl5/5.8.4/lib/sun4-solaris-64int /usr/perl5/5.8.4/lib /usr/perl5/site_perl/ 5.8.4/sun4-solaris-64int /usr/perl5/site_perl/5.8.4 /usr/perl5/site_perl /usr/perl5/vendor_perl/5.8.4/sun4-solaris-64int /usr/perl5/vendor_perl/5.8。 4 /usr/perl5/vendor_perl .) 在 try1.pl 第 3 行。 BEGIN 失败 - 编译在 try1.pl 第 3 行中止。

这里有什么问题？...如何纠正这个？

哦..差点忘了，我不能在这个 Solaris 机器上更改/安装/修改任何东西，这个脚本需要发送给运行 Solaris 10 的客户！所以让他安装一个模块绝对不是一个选择。:(

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T15:50:23.907

**错误消息说它在您的 Perl 库包含路径 ( @INC** )中找不到模块 Date::Parse 。

该模块可从[CPAN](http://www.cpan.org/) (Comprehensive Perl Archive Network) 获得。如果您需要基本安装中未包含的 Perl 模块，通常 (>90%) 可从 CPAN *（事实上*的Perl 模块存档站点）获得。

您的问题已通过 CPAN 模块（CPAN 模块用于从 CPAN 检索模块）文档得到解决。我建议从[常见](http://search.cpan.org/~rgarcia/perl-5.6.2/lib/CPAN.pm#FAQ)问题 5 开始，“我不是 root，如何在个人目录中安装模块？”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T16:53:38.267

你应该可以使用 Time::Piece 来做到这一点，它是 Perl **5.10**的核心（这里更正：它不是 5.8 的核心）。这是我机器上的一个例子。见和。`man strftime`_ 在文档中，您要检查*Date Parsing*部分。（转换细节在 Solaris 机器上可能会有所不同。我现在在 OS X 上工作。）`man strptime``perldoc Time::Piece``Time::Piece`

 *```
#!/usr/bin/env perl
use strict;
use warnings;
use Time::Piece;

my $date = Time::Piece->strptime("Tue Apr 7 12:46:59 2009",
  "%a %b %e %H:%M:%S %Y");
my $epoch_date = $date->epoch;

print "$epoch_date\n"; 
```

**编辑**：CDT 上的解析器阻塞（%Z 似乎无法识别它），因此您可能需要分两步执行此操作。以下对我有用：

```
my $string = "Mon Mar 27 05:54:08 CDT 2009";
$string =~ s/CDT/-0500/; # Replace timezone with offset from UTC
my $date = Time::Piece->strptime($string, "%a %b %e %H:%M:%S %z %Y");
my $epoch_date = $date->epoch;

print "$epoch_date\n"; 
```

但是，现在我们遇到了 CDT => -0500 与 CST => -0600 的额外问题。我正式讨厌夏令时。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T15:46:58.503

你确定这是正确的错误信息吗？ [Date::Parse](http://search.cpan.org/perldoc?Date::Parse)是一个完全独立于[Time::ParseDate](http://search.cpan.org/perldoc?Time::ParseDate)的模块。它们提供类似的功能，但不相互使用。

您可以使用[Module::CoreList](http://search.cpan.org/dist/Module-CoreList/)获取 5.8.8 附带的模块列表。我不知道 Solaris 10 是否包含任何其他模块。

您可能必须从合适的模块中复制内容并将其粘贴到您的脚本中。（请记住，一个 Perl 文件可能有多个`package`语句。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T17:07:27.967

由于您需要将程序发送给不会为您安装模块的客户，因此您需要使用[PAR::Packer](http://search.cpan.org/dist/PAR-Packer/lib/PAR/Packer.pm)创建包含所有依赖项（或仅使用核心模块）的本机可执行文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T14:22:34.907

> Solaris 10 似乎不太喜欢我。我正在尝试运行一个简单的脚本来接受日期并返回该日期的纪元

愚蠢的问题，但是输入日期字符串的来源是什么？如果字符串是从系统中获取的，那么您的代码会简单得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-01T18:08:42.770

旧线程，但这可能会帮助有同样问题的人。使用标准 Time::Local 模块中的 timelocal 函数。见 [perlfaq 4](http://perldoc.perl.org/perlfaq4.html#How-can-I-take-a-string-and-turn-it-into-epoch-seconds?)

# browser - 您可以在浏览器中对 Word 文档进行复杂的编辑吗？

> ID：726293
> 
> 赞同：4
> 
> 时间：2009-04-07T15:18:24.267
> 
> 标签：browser, editor, ms-word, text-editor

我的一个朋友想要一个应用程序，人们可以在其中上传 Word（或文本）格式的文档，然后允许人们在浏览器中对这些文档进行编辑。

是否有任何机制可以支持添加文本“气泡”以添加评论？要么漂浮，要么偏向一边。

能够保存回 Word 格式也是必须的。或者至少，Word 支持的某些格式仍然可以编辑。将其保存为图像是不可接受的。

我正在考虑在 FCK 编辑器窗口中打开 Word 文档，但 FCK 似乎只有“正常”的**内联**文本编辑功能（尽管它很棒）。

这可行吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T15:33:42.140

是的，这是可行的。[谷歌已经做到了](https://docs.google.com/)（它确实有评论）。[Adobe](http://www.adobe.com/acom/buzzword/)也是如此。我敢肯定还有更多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T15:53:26.037

[Xopus](http://www.xopus.com)提供了一个可编程平台，允许您在所见即所得的环境中定义可编辑的 XML。您可以使用它来定义您想要编辑的内容 (XML)、您想要编辑它的规则 (XSD) 以及您希望它在编辑时的外观 (XSL)。[然后你将所有这些与Javascript API](https://xopus.com/documentation/developer-guide/reference/xopus-api.html)联系在一起。

换句话说，你可以很容易地定义一个包含多个带有可选注释的段落的文档，然后让它们完全按照你想要的方式显示为气泡；保存后，可以执行服务器上的脚本，将 XML 转换为 Word 文档。

看看[演示](http://xopus.com/demos.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T15:27:00.517

如果它们是 Word 2007 文档，您可以使用[Silverlight](http://www.microsoft.com/silverlight/)。[下面是一个示例应用程序](http://openxmldeveloper.com/articles/TextGlow.aspx)，它使用 Silverlight 打开 Word 2007 文档并将其显示在浏览器中。

由于 StackOverflow 是一个程序员网站，我假设您是一名程序员。您可以使用 Silverlight 将气泡和注释添加到 Word 2007 文档中，但您需要了解 VB.NET 或 C#。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-02T05:20:24.217

看看 docx2web.appspot.com，它（目前）是一个非常简单的编辑器，具有浏览器直接操纵（或多或少）docx 的“平面 OPC”版本的显着特征。

这意味着在输入或输出上都没有有损转换。因此，例如，当您在编辑后保存时，原始 docx 中的任何内容都会返回到 Word。

就对旧 .doc 的支持而言，POI 可用于将它们转换为 .docx（尽管您的里程可能会有所不同）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T15:28:31.310

你为什么要与谷歌文档竞争？

我知道 TinyMCE 为浏览器编辑提供了一些丰富的控件。上次我看它时，它有 100% 的我通常在 word 中使用的东西，然后是一些。另一方面，我可能拥有 MS word 提供的 1% 的功能。实现这一切将是非常困难的。

至于保存到 MS word 兼容格式。我相信它是可能的。保存为非文档格式可能会更容易。至于弹出窗口等，可以使用 jquery UI 或任何其他 javascript 框架轻松构建。

底线：是的，有可能，但为什么呢？！

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-07T15:28:26.113

有可能的。例如[eyeOS](http://eyeos.org/)有一个文本处理应用程序，能够打开和处理 Microsoft Office 和 OpenOffice.org 文本文档。

# .net - 如何查询索引为 IndexEmbedded 的数据（nhibernate.search 中的全文）

> ID：726299
> 
> 赞同：0
> 
> 时间：2009-04-07T15:19:30.457
> 
> 标签：.net, nhibernate, search, nhibernate.search

如何查询添加为 IndexEmbedded 的数据？
我有一个实体类

```
 [Indexed]
  public class Something
  {
    [Field(Index.Tokenized, Store = Store.Yes)]
    public virtual string Description { get; set; }

    [IndexedEmbedded]
    public virtual Category Category { get; set; }
    [IndexedEmbedded]
    public virtual Location Location { get; set; }
  } 
```

位置为

```
[Indexed]
  public class Location 
  {
    /// </summary>            
    [Field(Index.Tokenized, Store = Store.Yes)]
    public virtual string Address
    {
  } 
```

数据被添加到索引中（包括普通属性和 IndexEmbedded），我可以使用 Luke 看到它们。
但是，当我使用全文查询时，我只得到正常属性的有效结果，而不是**IndexedEmbedded**
*例如 “样本描述” => 1 个结果，“帕洛阿尔托” => 0 个结果（它们都在索引中）* 这是我的查询

```
using (IFullTextSession s = Search.CreateFullTextSession(NHibernateSession.GetSession())) {
        MultiFieldQuerParser qp = new MultiFieldQueryParser(new[] {
                                                                     “Description”,“Title”,”Name”
                                                                   }, new StandardAnalyzer());
        IQuery NHQuery = s.CreateFullTextQuery(qp.Parse(query), typeof(Something));
        result = NHQuery.List(); 
```

我做错了什么或遗漏了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-29T10:22:14.607

据我所知，您没有引用 IndexedEmbedded 集合的字段。您应该在 MultiFieldQueryParser 中添加以下字段

```
new MultiFieldQueryParser(new[] {"Description", "Title", "Name", "Location.Address"}) 
```

字段的正确名称应该在 Luke 中可见，并以您应用*IndexedEmbedded*属性的属性名称为前缀。

* * *

**编辑**：如果默认前缀不符合您的喜好，您可以使用*IndexedEmbedded*属性的前缀参数更改它

# .net - 奇怪的远程连接问题

> ID：726316
> 
> 赞同：0
> 
> 时间：2009-04-07T15:23:42.863
> 
> 标签：.net, remoting

在尝试通过 TCP 配置 .NET 远程处理设置时，我在接受外部连接（来自不在我的 LAN 上的任何计算机的连接）时遇到了问题。我做了一些调查，并在我的朋友开始连接后立即点击 netstat -a。这是我看到的：

> TCP 0.0.0.0:2594 Taylor-PC:0 LISTENING
> ...
> TCP 192.168.1.102:2594 24-155-7-16:63588 已建立
> TCP 192.168.1.102:62488 192.168.0.100:1554 SYN_SENT

现在这是奇怪的部分：24.155.7.16 是我朋友的 IP（已修改），它表示连接已建立。但是连接会挂起，直到超时。然后我发现 192.168.0.100 是*他网络上**的*本地地址。某处发生了一些奇怪的事情。我的服务器和客户端都是 TCPChannel，后者初始化为“new TCPChannel(0)”。当我在与服务器相同的机器上运行客户端时，本地主机连接工作，但我不能接受远程连接。没有端口转发或防火墙问题。

谢谢您的帮助

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T15:41:43.197

您朋友的子网是否与您的子网具有相同的 IP 地址范围（例如 192.168.0.*）？我之前也遇到过类似的问题......更多是由于路由器配置而不是其他任何原因，因为子网具有相同的 IP 地址范围。他试过直接连接到互联网吗？或者他或您是否能够更改您的子网？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-08T03:32:42.787

再次检查服务器端的防火墙，如服务中的 Windows 防火墙/Internet 连接共享 (ICS)

# c# - Richtextbox.invoke, C#, Form 仍然挂起

> ID：726317
> 
> 赞同：1
> 
> 时间：2009-04-07T15:23:45.750
> 
> 标签：c#, winforms, multithreading, invoke

我已经编写了 ac# 应用程序来运行外部程序，并且我已经将它的输出重定向到我的表单中的富文本框。我使用以下设置创建了流程

```
p1.StartInfo.RedirectStandardOutput = true;
p1.OutputDataReceived += new DataReceivedEventHandler(outputreceived); 
```

并在 outputreceived 事件中

```
void outputreceived(object sender, DataReceivedEventArgs e)
{
  if (!string.IsNullOrEmpty(e.Data))
  {
    richTextBox1.Invoke(new UpdateOutputCallback(this.updateoutput),
                        new object[] { e.Data });
  }
}

void updateoutput(string text)
{
  int len = text.Length;
  int start = richTextBox1.Text.Length;
  richTextBox1.Text += text + Environment.NewLine;
  richTextBox1.Select(start, len);
  richTextBox1.SelectionColor = System.Drawing.Color.White;
  richTextBox1.Select(richTextBox1.Text.Length, 0);
  richTextBox1.ScrollToCaret();
} 
```

现在问题是虽然它正在工作，但是如果应用程序的输出很大，我包含文本框的主表单会挂起。我认为每次调用调用都会导致重新绘制表单，这种情况经常发生。是否有任何替代方法可以让我看到文本框的更新，并保持表单完全激活？

* * *

### 更新：

我想我得到了答案，我`BeginInvoke`在应该使用的时候使用了`Invoke`.

* * *

### 更新1：

我尝试了 BeginInvoke 和 Suspendlayout 但它没有给我所需的功能，发生的情况是该过程已将所有标准输出恢复到字符串，但负责更新文本的线程正在花费自己的时间来打印数据. 我可以对它做点什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T15:27:58.783

既然你已经解决了你的问题，我会注意到如果你使用`rtb.AppendText`（而不是`Text += ...`）并使用 pinvoke 滚动到底部会更快：

```
private const int WM_VSCROLL = 0x115;
private const int SB_BOTTOM = 7;

[DllImport("user32.dll", CharSet=CharSet.Auto)]
private static extern int SendMessage(IntPtr hWnd, int wMsg, IntPtr wParam,
IntPtr lParam);

// ...
// Scroll to the bottom, but don't move the caret position.
SendMessage(rtb.Handle, WM_VSCROLL, (IntPtr) SB_BOTTOM, IntPtr.Zero); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:39:28.757

你可能想试试

```
richTextBox1.BeginInvoke() 
```

而不是

```
richTextBox1.Invoke() 
```

这至少会使调用异步。仍然不确定这是否会导致 UI 线程在绘制更新时锁定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T16:19:23.557

尝试暂停和恢复布局`richTextBox1`

```
 void updateoutput(string text)
    {
        try
        {
            richTextBox1.SuspendLayout();

            int len = text.Length;
            int start = richTextBox1.Text.Length;
            richTextBox1.Text += text + Environment.NewLine;
            richTextBox1.Select(start, len);
            richTextBox1.SelectionColor = Color.White;
            richTextBox1.Select(richTextBox1.Text.Length, 0);
            richTextBox1.ScrollToCaret();
        }
        finally
        {
            richTextBox1.ResumeLayout();
        }
    } 
```

> 是否有任何替代方法可以让我看到文本框的更新，并保持表单完全激活？

我认为您应该使用 Debug.Print 来查看正在发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-05T14:51:55.067

这是一个旧帖子，但也许有人还在像我一样寻找它。

您也可以这样做，例如“for(writeToTextbox % 10 == 0)”然后调用。在这种情况下，它将仅每 10 次更新一次。

更新：抱歉拼写错误！（写->写）并感谢“HaveNoDisplayName”向我展示！

# sql - 触发以捕获服务器中的架构更改

> ID：726319
> 
> 赞同：4
> 
> 时间：2009-04-07T15:23:56.797
> 
> 标签：sql, sql-server, sql-server-2005, tsql, triggers

是否可以实现类似下面的触发器

```
CREATE TRIGGER [tr_AU_ddl_All_Server] ON DATABASE
    WITH EXECUTE AS self
    FOR DDL_DATABASE_LEVEL_EVENTS
AS
    DECLARE
        @data XML
      , @rc INT
    SET @data = EVENTDATA()
    EXEC @rc = __AU.dbo.AU_DDLLog @data
GO 
```

但是在整个服务器上。我的想法是捕获服务器中所有数据库的所有模式更改。

就我而言，这在 SQL Server 2005 中是不可能的，但我想知道是否有人有这样的工作。我想避免在每个数据库中实现触发器。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T16:09:16.077

[是的，SQL Server 2005 引入了“DDL 触发器”——在SQL Team](http://www.sqlteam.com/article/using-ddl-triggers-in-sql-server-2005-to-capture-schema-changes)阅读一篇关于它的优秀文章。

本文很好地展示了它们是 DDL 触发器的两个范围 - 服务器范围或数据库范围。那些数据库范围的不能应用于整个服务器 - 您必须在每个数据库中设置它们。

马克

# c# - for 循环中的模数 (%)

> ID：726325
> 
> 赞同：0
> 
> 时间：2009-04-07T15:24:44.297
> 
> 标签：c#, arrays

我在这里有一个代码，我希望它会显示前 10 个，如果我单击它，它将再次显示第二批。我首先用我的第一个 for 代码尝试了这个，现在它可以工作了我正在使用数组，它似乎不接受它

我评论的那个不起作用？这是错的吗？谢谢

```
long [] potenzen = new long[32];
potenzen[0] = 1;

for (int i = 1; i < potenzen.Length; ++i)
{
    potenzen[i] = potenzen[i-1] * 2;
    //if (potenzen % 10 == 0)
    //    Console.ReadLine();
}

foreach (long elem in potenzen)
{
    Console.WriteLine(" " + elem);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T15:28:02.137

你需要：

```
if (i % 10 == 0) 
```

并不是：

```
if (potenzen % 10 == 0) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T15:28:34.210

```
long [] potenzen = new long[32];
potenzen[0] = 1;
for (int i = 1; i < potenzen.Length; ++i)
{ 
  potenzen[i]=potenzen[i-1]*2;
  Console.WriteLine(potenzen[i-1]);
  if (i % 10 == 0)
    Console.ReadLine();
} 
```

更符合你想要的。一种改进是将数据操作逻辑与数据显示逻辑分开。

```
long [] potenzen = new long[32];
potenzen[0] = 1;
for (int i = 1; i < potenzen.Length; ++i)
  potenzen[i]=potenzen[i-1]*2;

for (int i = 0; i < potenzen.Length; ++i)
{
  Console.WriteLine(potenzen[i]);
  if (i % 10 == 0)
    Console.ReadLine();
} 
```

当然，你可以在没有数组的情况下做到这一点

```
long potenzen = 1;
for (int i = 1; i < 32; ++i)
{ 
  Console.WriteLine(potenzen);
  potenzen = potenzen * 2;
  if (i % 10 == 0)
    Console.ReadLine();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T15:27:54.540

将模运算符应用于 long 数组是可疑的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T15:28:27.783

potenzen 是一个数组，所以你可以试试

```
if (i % 10 == 0) 
```

或许

```
if (potenzen[i] % 10 == 0) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T15:28:55.957

您正在使用数组 mod 10 - 充其量，使用不安全的语言，您将在内存地址上进行模运算。

如果您只是将行更改为：

```
// if you don't want to pause the first time you run it, replace with:
// if (i > 0 && i % 10 == 0) {
if (i % 10 == 0) {
    Console.ReadLine();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T15:29:37.280

尝试将其更改为：

```
long [] potenzen = new long[32];
potenzen[0] = 1;
Console.WriteLine(potenzen[0]);
for (int i = 1; i < potenzen.Length; ++i)
{
    potenzen[i]=potenzen[i-1]*2;
    Console.WriteLine(potenzen[i]);
    if (i % 10 == 0)
    {
        var s = Console.ReadLine();
        // break if s == some escape condition???
    }
} 
```

现在，你永远不会打印，除非你完全完成你的第一个 for 循环。我的猜测是你不允许完整的 32 个元素完成，所以你永远看不到你的结果 -

这将在它们运行时打印它们。

# svn - SVN 更新命令以单个外部子文件夹为目标？

> ID：726331
> 
> 赞同：6
> 
> 时间：2009-04-07T15:26:50.157
> 
> 标签：svn, version-control, svn-externals

我在插件文件夹中有一堆外部目录。

```
~> svn propedit svn:externals .

akismet http://plugins.svn.wordpress.org/akismet/trunk/
stats http://plugins.svn.wordpress.org/stats/tags/1.3.7/
html-purified http://svn.wp-plugins.org/html-purified/trunk/ 
```

有时我会更新单个外部引用以将版本号从 1.3.7 更新到 1.3.8，但我被迫向`svn up`整个文件夹发出命令并且根本`svn up stats`不起作用，而是返回如下内容：

```
At revision 108437. 
```

而不是从外部存储库更新文件夹。是否可以更新单个外部子文件夹？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T15:28:56.317

不，因为这是父文件夹上的单个属性，为每个“虚拟”子文件夹定义这些外部引用。Subversion 眼中不存在实际的子文件夹。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T18:37:32.337

如果您想避免父文件夹上的“svn up”，您可以将外部切换到新版本。首先将 svn:externals 属性更改为新标签，提交。然后

```
svn switch http://plugins.svn.wordpress.org/stats/tags/1.3.8/ stats 
```

但当然，建议更新父文件夹。

# javascript - ASP.NET MVC JsonResult 日期格式

> ID：726334
> 
> 赞同：258
> 
> 时间：2009-04-07T15:27:06.133
> 
> 标签：javascript, asp.net-mvc, json

我有一个控制器操作，它有效地简单地返回我的模型的 JsonResult。因此，在我的方法中，我有以下内容：

```
return new JsonResult(myModel); 
```

这很好用，除了一个问题。模型中有一个日期属性，这似乎在 Json 结果中返回，如下所示：

```
"\/Date(1239018869048)\/" 
```

我应该如何处理日期，以便它们以我需要的格式返回？或者我如何在脚本中处理上面的这种格式？

* * *

## 回答 #1

> 赞同：204
> 
> 时间：2009-04-07T17:48:51.050

只是为了扩展[casperOne 的答案](https://stackoverflow.com/questions/726334/asp-mvc-jsonresult-date-format/726417#726417)。

[JSON 规范](http://www.json.org/)不考虑日期值。MS 不得不进行调用，他们选择的路径是利用字符串的 javascript 表示中的一个小技巧：字符串文字 "/" 与 "\/" 相同，并且字符串文字*永远不会*被序列化为 " \/”（甚至“\/”也必须映射到“\\/”）。

请参阅[http://msdn.microsoft.com/en-us/library/bb299886.aspx#intro_to_json_topic2](http://msdn.microsoft.com/en-us/library/bb299886.aspx#intro_to_json_topic2)以获得更好的解释（向下滚动到“从 JavaScript 文字到 JSON”）

> JSON 的痛点之一是缺少日期/时间文字。许多人在第一次遇到 JSON 时会感到惊讶和失望。缺少日期/时间文字的简单解释（不管是否安慰）是 JavaScript 也从未有过：JavaScript 中对日期和时间值的支持完全是通过 Date 对象提供的。因此，大多数使用 JSON 作为数据格式的应用程序通常倾向于使用字符串或数字来表示日期和时间值。如果使用字符串，您通常可以期望它采用 ISO 8601 格式。相反，如果使用数字，则该值通常表示自纪元以来的通用协调时间 (UTC) 中的毫秒数，其中纪元定义为 1970 年 1 月 1 日午夜 (UTC)。再次，这只是一个约定，不是 JSON 标准的一部分。如果您正在与另一个应用程序交换数据，则需要查看其文档以了解它如何在 JSON 文字中编码日期和时间值。例如，Microsoft 的 ASP.NET AJAX 不使用上述两种约定。相反，它将 .NET DateTime 值编码为 JSON 字符串，其中字符串的内容是 /Date(ticks)/，其中 ticks 表示自纪元 (UTC) 以来的毫秒数。因此，1989 年 11 月 29 日凌晨 4:55:30，UTC 编码为“\/Date(628318530718)\/”。NET AJAX 不使用上述任何一种约定。相反，它将 .NET DateTime 值编码为 JSON 字符串，其中字符串的内容是 /Date(ticks)/，其中 ticks 表示自纪元 (UTC) 以来的毫秒数。因此，1989 年 11 月 29 日凌晨 4:55:30，UTC 编码为“\/Date(628318530718)\/”。NET AJAX 不使用上述任何一种约定。相反，它将 .NET DateTime 值编码为 JSON 字符串，其中字符串的内容是 /Date(ticks)/，其中 ticks 表示自纪元 (UTC) 以来的毫秒数。因此，1989 年 11 月 29 日凌晨 4:55:30，UTC 编码为“\/Date(628318530718)\/”。

一个解决方案是把它解析出来：

```
value = new Date(parseInt(value.replace("/Date(", "").replace(")/",""), 10)); 
```

但是我听说在某处有一个设置可以让序列化程序使用语法输出`DateTime`对象。`new Date(xxx)`我会试着把它挖出来。

* * *

的第二个参数`JSON.parse()`接受一个`reviver`函数，其中规定了在返回之前最初是如何产生值的。

这是日期的示例：

```
var parsed = JSON.parse(data, function(key, value) {
  if (typeof value === 'string') {
    var d = /\/Date\((\d*)\)\//.exec(value);
    return (d) ? new Date(+d[1]) : value;
  }
  return value;
}); 
```

[请参阅JSON.parse()](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)的文档

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2009-11-20T00:19:46.150

这是我在 Javascript 中的解决方案 - 非常类似于 JPot，但更短（并且可能更快一点）：

```
value = new Date(parseInt(value.substr(6))); 
```

"value.substr(6)" 取出 "/Date(" 部分，parseInt 函数忽略最后出现的非数字字符。

编辑：我故意省略了基数（parseInt 的第二个参数）；请参阅[下面的评论](https://stackoverflow.com/questions/726334/asp-net-mvc-jsonresult-date-format/1767558#comment23310086_1767558)。另外，请注意 ISO-8601 日期比这种旧格式更受欢迎——所以这种格式通常不应该用于新的开发。

对于 ISO-8601 格式的 JSON 日期，只需将字符串传递给 Date 构造函数：

```
var date = new Date(jsonDate); //no ugly parsing needed; full timezone support 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2012-02-15T21:54:45.813

有很多答案可以在客户端处理它，但是如果需要，您可以更改输出服务器端。

有几种方法可以解决这个问题，我将从基础开始。您必须继承 JsonResult 类并覆盖 ExecuteResult 方法。从那里您可以采取几种不同的方法来更改序列化。

**方法 1：** 默认实现使用[JsonScriptSerializer](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx "JsonScriptSerializer")。如果您查看文档，您可以使用 RegisterConverters 方法添加自定义[JavaScriptConverters](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptconverter.aspx "JavaScript转换器")。但这有一些问题： JavaScriptConverter 序列化为字典，即它需要一个对象并序列化为 Json 字典。为了使对象序列化为字符串，它需要一些技巧，请参阅[帖子](http://blog.calyptus.eu/seb/2011/12/custom-datetime-json-serialization/ "自定义日期时间序列化")。这种特殊的 hack 也会转义字符串。

```
public class CustomJsonResult : JsonResult
{
    private const string _dateFormat = "yyyy-MM-dd HH:mm:ss";

    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
        {
            throw new ArgumentNullException("context");
        }

        HttpResponseBase response = context.HttpContext.Response;

        if (!String.IsNullOrEmpty(ContentType))
        {
            response.ContentType = ContentType;
        }
        else
        {
            response.ContentType = "application/json";
        }
        if (ContentEncoding != null)
        {
            response.ContentEncoding = ContentEncoding;
        }
        if (Data != null)
        {
            JavaScriptSerializer serializer = new JavaScriptSerializer();

            // Use your custom JavaScriptConverter subclass here.
            serializer.RegisterConverters(new JavascriptConverter[] { new CustomConverter });

            response.Write(serializer.Serialize(Data));
        }
    }
} 
```

**方法 2（推荐）：** 第二种方法是从重写的 JsonResult 开始，然后使用另一个 Json 序列化程序，在我的例子中是[Json.NET](http://json.codeplex.com/ "json.net")序列化程序。这不需要方法1的hackery。这是我对JsonResult子类的实现：

```
public class CustomJsonResult : JsonResult
{
    private const string _dateFormat = "yyyy-MM-dd HH:mm:ss";

    public override void ExecuteResult(ControllerContext context)
    {
        if (context == null)
        {
            throw new ArgumentNullException("context");
        }

        HttpResponseBase response = context.HttpContext.Response;

        if (!String.IsNullOrEmpty(ContentType))
        {
            response.ContentType = ContentType;
        }
        else
        {
            response.ContentType = "application/json";
        }
        if (ContentEncoding != null)
        {
            response.ContentEncoding = ContentEncoding;
        }
        if (Data != null)
        {
            // Using Json.NET serializer
            var isoConvert = new IsoDateTimeConverter();
            isoConvert.DateTimeFormat = _dateFormat;
            response.Write(JsonConvert.SerializeObject(Data, isoConvert));
        }
    }
} 
```

使用示例：

```
[HttpGet]
public ActionResult Index() {
    return new CustomJsonResult { Data = new { users=db.Users.ToList(); } };
} 
```

**附加学分：** [詹姆斯·牛顿-金](http://james.newtonking.com/archive/2009/02/20/good-date-times-with-json-net.aspx "詹姆斯·牛顿-金")

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2012-11-05T15:15:41.493

Moment.js 是一个广泛的日期时间库，也支持这一点。[http://momentjs.com/docs/#/parsing/asp-net-json-dates/](http://momentjs.com/docs/#/parsing/asp-net-json-dates/)

例如：时刻（“/日期（1198908717056-0700）/”）

它可能会有所帮助。[插件输出](http://embed.plnkr.co/P05l1a/preview)

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2015-03-09T09:55:03.643

我发现创建一个新的`JsonResult`并返回是不令人满意的 - 必须替换所有调用`return Json(obj)`with`return new MyJsonResult { Data = obj }`是一种痛苦。

* * *

所以我想，为什么不直接劫持`JsonResult`使用`ActionFilter`：

```
public class JsonNetFilterAttribute : ActionFilterAttribute
{
    public override void OnActionExecuted(ActionExecutedContext filterContext)
    {
        if (filterContext.Result is JsonResult == false)
        {
            return;
        }

        filterContext.Result = new JsonNetResult(
            (JsonResult)filterContext.Result);
    }

    private class JsonNetResult : JsonResult
    {
        public JsonNetResult(JsonResult jsonResult)
        {
            this.ContentEncoding = jsonResult.ContentEncoding;
            this.ContentType = jsonResult.ContentType;
            this.Data = jsonResult.Data;
            this.JsonRequestBehavior = jsonResult.JsonRequestBehavior;
            this.MaxJsonLength = jsonResult.MaxJsonLength;
            this.RecursionLimit = jsonResult.RecursionLimit;
        }

        public override void ExecuteResult(ControllerContext context)
        {
            if (context == null)
            {
                throw new ArgumentNullException("context");
            }

            var isMethodGet = string.Equals(
                context.HttpContext.Request.HttpMethod, 
                "GET", 
                StringComparison.OrdinalIgnoreCase);

            if (this.JsonRequestBehavior == JsonRequestBehavior.DenyGet
                && isMethodGet)
            {
                throw new InvalidOperationException(
                    "GET not allowed! Change JsonRequestBehavior to AllowGet.");
            }

            var response = context.HttpContext.Response;

            response.ContentType = string.IsNullOrEmpty(this.ContentType) 
                ? "application/json" 
                : this.ContentType;

            if (this.ContentEncoding != null)
            {
                response.ContentEncoding = this.ContentEncoding;
            }

            if (this.Data != null)
            {
                response.Write(JsonConvert.SerializeObject(this.Data));
            }
        }
    }
} 
```

* * *

这可以应用于任何返回 a`JsonResult`以使用 JSON.Net 的方法：

```
[JsonNetFilter]
public ActionResult GetJson()
{
    return Json(new { hello = new Date(2015, 03, 09) }, JsonRequestBehavior.AllowGet)
} 
```

这将回应

```
{"hello":"2015-03-09T00:00:00+00:00"} 
```

如预期的！

* * *

如果您不介意`is`在每次请求时调用比较，您可以将其添加到您的`FilterConfig`：

```
// ...
filters.Add(new JsonNetFilterAttribute()); 
```

并且您的所有 JSON 现在都将使用 JSON.Net 而不是内置的`JavaScriptSerializer`.

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2010-12-27T16:13:45.120

## 使用 jQuery 自动转换日期`$.parseJSON`

> ***注意****：这个答案提供了一个 jQuery 扩展，它添加了自动 ISO 和 .net 日期格式支持。*

由于您使用的是 Asp.net MVC，我怀疑您在客户端使用 jQuery。我建议您阅读[这篇博客文章](http://erraticdev.blogspot.com/2010/12/converting-dates-in-json-strings-using.html)，其中包含如何`$.parseJSON`为您自动转换日期的代码。

代码支持您提到的 Asp.net 格式的日期以及 ISO 格式的日期。所有日期都将使用 自动为您格式化`$.parseJSON()`。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-10-10T14:25:36.313

客户端和服务器之间的 Ajax 通信通常涉及 JSON 格式的数据。虽然 JSON 适用于字符串、数字和布尔值，但由于 ASP.NET 序列化它们的方式，它可能会给日期带来一些困难。由于它对日期没有任何特殊表示，因此它们被序列化为纯字符串。作为一种解决方案，ASP.NET Web 窗体和 MVC 的默认序列化机制以特殊形式序列化日期 - /Date(ticks)/- 其中 ticks 是自 1970 年 1 月 1 日以来的毫秒数。

这个问题可以通过两种方式解决：

**客户端**

将接收到的日期字符串转换为数字，并使用日期类的构造函数以刻度为参数创建一个日期对象。

```
function ToJavaScriptDate(value) {
  var pattern = /Date\(([^)]+)\)/;
  var results = pattern.exec(value);
  var dt = new Date(parseFloat(results[1]));
  return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
} 
```

**服务器端**

之前的解决方案使用客户端脚本将日期转换为 JavaScript Date 对象。您还可以使用以您选择的格式序列化 .NET DateTime 实例的服务器端代码。要完成此任务，您需要创建自己的 ActionResult，然后以您想要的方式序列化数据。

参考： http: [//www.developer.com/net/dealing-with-json-dates-in-asp.net-mvc.html](http://www.developer.com/net/dealing-with-json-dates-in-asp.net-mvc.html)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2010-03-11T17:44:01.180

我遇到了同样的问题，我没有返回实际的日期值，而是使用了 ToString("dd MMM yyyy") 。然后在我的 javascript 中，我使用了 new Date(datevalue)，其中 datevalue 可能是“2009 年 1 月 1 日”。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-07T15:47:58.593

看到这个线程：

[http://forums.asp.net/p/1038457/1441866.aspx#1441866](http://forums.asp.net/p/1038457/1441866.aspx#1441866)

基本上，虽然`Date()`格式是有效的 javascript，但它不是有效的 JSON（有区别）。如果您想要旧格式，您可能必须创建一个外观并自己转换值，或者找到一种方法来获取您的类型的序列化程序`JsonResult`并让它使用自定义格式的日期。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-01-11T20:50:49.463

不是最优雅的方式，但这对我有用：

```
var ms = date.substring(6, date.length - 2);
var newDate = formatDate(ms);

function formatDate(ms) {

    var date = new Date(parseInt(ms));
    var hour = date.getHours();
    var mins = date.getMinutes() + '';
    var time = "AM";

    // find time 
    if (hour >= 12) {
        time = "PM";
    }
    // fix hours format
    if (hour > 12) {
        hour -= 12;
    }
    else if (hour == 0) {
        hour = 12;
    }
    // fix minutes format
    if (mins.length == 1) {
        mins = "0" + mins;
    }
    // return formatted date time string
    return date.getMonth() + 1 + "/" + date.getDate() + "/" + date.getFullYear() + " " + hour + ":" + mins + " " + time;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-07-07T13:47:35.893

我一直在努力解决这个问题，因为上述答案都没有真正帮助我。我正在使用 jquery 周历，需要我的日期在服务器上和页面上本地获取时区信息。经过一番挖掘后，我想出了一个可能对其他人有所帮助的解决方案。

我正在使用 asp.net 3.5、vs 2008、asp.net MVC 2 和 jquery 周历，

首先，我使用的是 Steven Levithan 编写的库，它有助于在客户端处理日期，即[Steven Levithan 的日期库](http://blog.stevenlevithan.com/archives/date-time-format)。isoUtcDateTime 格式非常适合我的需要。在我的 jquery AJAX 调用中，我使用带有 isoUtcDateTime 格式的库提供的格式函数，当 ajax 调用命中我的操作方法时，日期时间类型设置为本地并反映服务器时间。

当我通过 AJAX 将日期发送到我的页面时，我通过使用 "ddd, dd MMM yyyy HH':'mm':'ss 'GMT'zzzz" 格式化日期来将它们作为文本字符串发送。这种格式很容易在客户端使用

```
var myDate = new Date(myReceivedDate); 
```

这是我的完整解决方案减去 Steve Levithan 的源代码，您可以下载：

控制器：

```
public class HomeController : Controller
{
    public const string DATE_FORMAT = "ddd, dd MMM yyyy HH':'mm':'ss 'GMT'zzzz";

    public ActionResult Index()
    {
        ViewData["Message"] = "Welcome to ASP.NET MVC!";

        return View();
    }

    public ActionResult About()
    {
        return View();
    }

    public JsonResult GetData()
    {
        DateTime myDate = DateTime.Now.ToLocalTime();

        return new JsonResult { Data = new { myDate = myDate.ToString(DATE_FORMAT) } };
    }

    public JsonResult ReceiveData(DateTime myDate)
    {
        return new JsonResult { Data = new { myDate = myDate.ToString(DATE_FORMAT) } };
    }
} 
```

Javascript：

```
<script type="text/javascript">

function getData() {
    $.ajax({
        url: "/Home/GetData",
        type: "POST",
        cache: "false",
        dataType: "json",
        success: function(data) {
            alert(data.myDate);
            var newDate = cleanDate(data.myDate);
            alert(newDate);
            sendData(newDate);
        }
    });
} 

function cleanDate(d) {
    if (typeof d == 'string') {
        return new Date(d) || Date.parse(d) || new Date(parseInt(d));
    }
    if (typeof d == 'number') {
        return new Date(d);
    }
    return d;
}

function sendData(newDate) {
    $.ajax({
        url: "/Home/ReceiveData",
        type: "POST",
        cache: "false",
        dataType: "json",
        data:
        {
            myDate: newDate.format("isoUtcDateTime")
        },
        success: function(data) {
            alert(data.myDate);
            var newDate = cleanDate(data.myDate);
            alert(newDate);
        }
    });
}

// bind myButton click event to call getData
$(document).ready(function() {
    $('input#myButton').bind('click', getData);
});
</script> 
```

我希望这个快速示例可以帮助其他与我处于相同情况的人。目前，它似乎与 Microsoft JSON 序列化配合得很好，并且可以使我的日期跨时区保持正确。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-07-06T14:15:30.947

在 knockoutjs 中处理日期的更好方法是使用时刻库​​并像老板一样处理日期。您可以轻松处理 /Date(-62135578800000)/ 之类的日期。无需费心如何在控制器中序列化日期。

```
function jsonToDate(date,format) {
   return moment(date).format(format);
} 
```

像使用它一样

```
var formattedDate = jsonToDate(date,'MM/DD/YYYY') 
```

[momentjs](http://momentjs.com/)支持许多日期时间格式和日期实用功能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-03-05T06:03:08.797

格式化查询中的日期。

```
var _myModel = from _m in model.ModelSearch(word)
    select new { date = ((DateTime)_m.Date).ToShortDateString() }; 
```

此解决方案的唯一问题是，如果任何日期值为空，您将不会得到任何结果。为了解决这个问题，您可以在选择忽略日期空值的日期之前在查询中放置条件语句，或者您可以设置查询以获取所有结果，然后使用 foreach 循环遍历所有这些信息并分配一个值在您执行 SELECT new 之前，所有为空的日期。

两者的例子：

```
var _test = from _t in adc.ItemSearchTest(word)
                        where _t.Date != null
                        select new { date = ((DateTime)_t.Date).ToShortDateString() }; 
```

第二个选项完全需要另一个查询，因此您可以将值分配给所有空值。这和 foreach 循环必须在您选择值的查询之前。

```
var _testA = from _t in adc.ItemSearchTest(word)
                         select _i;

            foreach (var detail in _testA)
            {
                if (detail.Date== null)
                {
                    detail.Date= Convert.ToDateTime("1/1/0001");
                }
            } 
```

只是一个我发现比所有 javascript 示例更容易的想法。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-03-07T23:06:44.617

这是我编写的一些 JavaScript 代码，它`<input type="date">`根据从 ASP.NET MVC 传递的日期设置值。

```
var setDate = function(id, d) {
  if (d !== undefined && d !== null) {
    var date = new Date(parseInt(d.replace("/Date(", "").replace(")/", ""), 10));
    var day = ('0' + date.getDate()).slice(-2);
    var month = ('0' + (date.getMonth() + 1)).slice(-2);
    var parsedDate = date.getFullYear() + "-" + (month) + "-" + (day);
    $(id).val(parsedDate);
  }
}; 
```

你这样调用这个函数：

```
setDate('#productCommissionStartDate', data.commissionStartDate); 
```

`commissionStartDate`MVC 传递的 JSON 日期在哪里。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-05-09T19:53:48.790

您可以使用此方法：

```
String.prototype.jsonToDate = function(){
    try{
        var date;
        eval(("date = new " + this).replace(/\//g,''));
        return date;
    } 
    catch(e){
        return new Date(0);
    }
}; 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-06-29T12:08:37.667

**在您的页面中添加 jquery ui 插件。**

```
function JsonDateFormate(dateFormate, jsonDateTime) {
    return $.datepicker.formatDate(dateFormate, eval('new ' + jsonDateTime.slice(1, -1)));
}; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-02-25T08:44:03.287

它返回服务器日期格式。您需要定义自己的功能。

```
function jsonDateFormat(jsonDate) {
  // Changed data format;
  return (new Date(parseInt(jsonDate.substr(6)))).format("mm-dd-yyyy / h:MM tt");
}; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-08-13T18:02:55.353

不是没有，而是有另一种方式。首先，构建您的 LINQ 查询。然后，构造枚举结果的查询并应用适合您的任何类型的格式。

```
var query = from t in db.Table select new { t.DateField };
var result = from c in query.AsEnumerable() select new { c.DateField.toString("dd MMM yyy") }; 
```

我不得不说，额外的步骤很烦人，但效果很好。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-02-06T23:00:41.703

对我有用的是创建一个包含日期属性作为字符串的视图模型。从域模型分配 DateTime 属性并在将值分配给 viewmodel 时调用 date 属性上的 .ToString() 。

来自 MVC 操作方法的 JSON 结果将以与视图兼容的格式返回日期。

## 查看模型

```
public class TransactionsViewModel
{
    public string DateInitiated { get; set; }
    public string DateCompleted { get; set; }
} 
```

## 领域模型

```
public class Transaction{
   public DateTime? DateInitiated {get; set;}
   public DateTime? DateCompleted {get; set;}
} 
```

## 控制器动作方法

```
public JsonResult GetTransactions(){

var transactions = _transactionsRepository.All;
        var model = new List<TransactionsViewModel>();

        foreach (var transaction in transactions)
        {
            var item = new TransactionsViewModel
            {
                ...............
                DateInitiated = transaction.DateInitiated.ToString(),
                DateCompleted = transaction.DateCompleted.ToString(),
            };

            model.Add(item);
        }
        return Json(model, JsonRequestBehavior.AllowGet);
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-08-12T13:40:10.703

覆盖控制器 Json/JsonResult 以返回 JSON.Net：

[这是一种享受](https://stackoverflow.com/questions/23348262/using-json-net-to-return-actionresult)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-02-02T10:11:46.017

烦人，不是吗？

我的解决方案是更改我的 WCF 服务，使其以更易读（非 Microsoft）的格式返回 DateTimes。请注意下面的“ `UpdateDateOriginal`”，这是 WCF 的默认日期格式，以及我的“ `UpdateDate`”，它被格式化为更易读的格式。

[![在此处输入图像描述](https://i.stack.imgur.com/Gggtg.png)](https://i.stack.imgur.com/Gggtg.png)

这是如何做到的：

[更改 WCF 日期格式](https://stackoverflow.com/questions/18511147/change-default-date-serialization-in-wcf/27860910#27860910)

希望这可以帮助。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-03-04T11:23:33.273

我发现这是在服务器端更改它的最简单方法。

```
using System.Collections.Generic;
using System.Web.Mvc;
using Newtonsoft.Json;
using Newtonsoft.Json.Converters;
using Newtonsoft.Json.Serialization;

namespace Website
{
    /// <summary>
    /// This is like MVC5's JsonResult but it uses CamelCase and date formatting.
    /// </summary>
    public class MyJsonResult : ContentResult
    {
        private static readonly JsonSerializerSettings Settings = new JsonSerializerSettings
        {
            ContractResolver = new CamelCasePropertyNamesContractResolver(),
            Converters = new List<JsonConverter> { new StringEnumConverter() }
        };

        public FindersJsonResult(object obj)
        {
            this.Content = JsonConvert.SerializeObject(obj, Settings);
            this.ContentType = "application/json";
        }
    }
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-11-04T19:47:07.357

我遇到了许多关于 JSON 日期的问题，并决定通过解决 SQL 中的日期问题来解决这个问题。将日期格式更改为字符串格式

```
select flddate from tblName

select flddate, convert(varchar(12), flddate, 113) as fldDateStr from tblName 
```

通过使用 fldDateStr 问题消失了，我仍然可以使用日期字段进行排序或其他目的。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-02-25T10:37:00.357

0

在你的cshtml中，

```
<tr ng-repeat="value in Results">                
 <td>{{value.FileReceivedOn | mydate | date : 'dd-MM-yyyy'}} </td>
</tr> 
```

在您的 JS 文件中，可能是 app.js，

在 app.controller 之外，添加以下过滤器。

这里的“mydate”是您为解析日期而调用的函数。这里的“app”是包含 angular.module 的变量

```
app.filter("mydate", function () {
    var re = /\/Date\(([0-9]*)\)\//;
    return function (x) {
        var m = x.match(re);
        if (m) return new Date(parseInt(m[1]));
        else return null;
    };
}); 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2018-02-21T15:32:14.623

最简单的一个：

var miisegundos = parseInt(data.replace("/Date(", "").replace(")/", ""));
Var newDate = new Date(milisegundos)。**toLocaleDateString** ("en-UE");

# java - Spring MVC Web 应用程序 i18n

> ID：726342
> 
> 赞同：3
> 
> 时间：2009-04-07T15:28:31.997
> 
> 标签：java, configuration, internationalization, spring-mvc

在使用 spring-MVC 编写的 Web 应用程序中，我希望允许用户通过单击文本是语言名称的链接来更改当前语言。

我已经设置了一个messageSource，并让我所有的jsp页面都使用这个messageSource查找消息。目前，语言正在根据用户浏览器的语言环境而变化。

所以，我现在要做的是允许手动更改语言环境。

我发现 SessionLocaleResolver 类可以提供帮助，但我不知道如何在我的应用程序上下文文件（名称为 myAppName-servlet.xml）中设置它。

我已经定义了 bean：

```
<bean id="localeResolver"
    class="org.springframework.web.servlet.i18n.SessionLocaleResolver">
</bean> 
```

但是我应该在哪个 bean 中插入这个？此外，如何将与语言环境相关的 cookie 设置到用户会话中？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T16:05:19.490

我需要的所有信息都在我面前的文档中，位于：

**[http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-localeresolver](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-localeresolver)**

简而言之，我将以下 xml 改编为 myAppName-servlet.xml

```
<bean id="localeChangeInterceptor"
      class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">
    <property name="paramName" value="siteLanguage"/>
</bean>

<bean id="localeResolver"
      class="org.springframework.web.servlet.i18n.CookieLocaleResolver"/>

<bean id="urlMapping"
      class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="interceptors">
        <list>
            <ref bean="localeChangeInterceptor"/>
        </list>
    </property>
    <property name="mappings">
        <value>/**/*.view=someController</value>
    </property>
</bean> 
```

现在，使用参数访问任何页面就足够了：

```
siteLanguage=locale 
```

更改整个站点的区域设置。

例如：[http://localhost:8080/SBrowser/deliveries.html?siteLanguage=fr](http://localhost:8080/SBrowser/deliveries.html?siteLanguage=fr)`enter code here`

# pdf - 我可以使用 java 在黑莓上打开“.pdf”文档吗？

> ID：726350
> 
> 赞同：2
> 
> 时间：2009-04-07T15:29:30.183
> 
> 标签：pdf, blackberry, java-me

我可以使用 java 在黑莓上打开“.pdf”文档吗？

如果是，那么如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-05-25T21:10:37.667

黑莓中没有本地加载pdf文件，但您可以在您的浏览器字段中实现加载谷歌查看器，这将起到作用！=D！

```
public ScrLoad()
{     
String url = "http://docs.google.com/gview?embedded=true&url=http://prueba.agenciareforma.com/appiphone/android/elnorte.pdf";                
    add(new BrowserField(url));        
} 
```

Google 文档查看器 [http://docs.google.com/gview](http://docs.google.com/gview)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-11T16:35:06.497

BB 没有内置的 PDF 查看器。您可以在电子邮件中查看 PDF 附件，但这与一些服务器端的魔法有关。我认为最好的方法是购买一个 3rd-party 查看器并启动它来查看 PDF。

可能的观众包括以下。我还没有尝试过这些。

*   [http://www.cerience.com/products/reader/](http://www.cerience.com/products/reader/)
*   [http://www.slgmobile.com/beamreader.html](http://www.slgmobile.com/beamreader.html)
*   [http://www.dynoplex.com/](http://www.dynoplex.com/)

我认为您最终会使用 net.rim.device.api.system.ApplicationManager，但我还没有尝试过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T15:44:06.140

无法在 BlackBerry 上从 Java 程序中打开 PDF 文件。由于 OS 4.5（我认为）黑莓有一个内置的 PDF 阅读器，但它仅在您通过电子邮件接收 PDF 文件时才有效。甚至无法打开 SD 卡上存储的 PDF 文件。

因此，“不”不可能在 Java 中打开 PDF。

当然，当您首先编写 PDF 阅读器时除外。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-04-07T17:21:41.583

我不确定 Blackberry 到底是什么，但 Java 6 SE 有一个[Desktop](http://java.sun.com/javase/6/docs/api/java/awt/Desktop.html)类，可用于`.pdf`在该平台上打开带有与该扩展名关联的程序的文件。

尝试这样的事情：

```
 if (Desktop.isDesktopSupported()) {
        Desktop desktop = Desktop.getDesktop();
        if (desktop.isSupported(Desktop.Action.OPEN)) {
            File pdf = new File(...);  // path to pdf file
            try {
                desktop.open(pdf);
            }
            catch (IOException e) {
                System.err.println("Could not open " + pdf);
            }
        }
    } 
```

# ruby - Ruby 中的 poll()？

> ID：726352
> 
> 赞同：3
> 
> 时间：2009-04-07T15:29:38.950
> 
> 标签：ruby, networking, sockets

我目前正在将一个自写的网络应用程序从 C++ 移植到 Ruby。该网络应用程序通常需要同时管理大约 10.000 个套接字，这意味着它需要快速访问任何具有可读数据、传入连接等的套接字。

我在用 C++ 编写它时已经体验过，这`select()`不适用于这种情况，因为它在内部使用 32`DWORD`秒（128 字节）来管理最多 1024 个带有位掩码的套接字。因为有时我必须使用超过 10.000 个套接字，所以这个功能是不够的。因此我不得不切换到`poll()`哪个也使代码更优雅，因为我并不总是再次添加和删除所有文件描述符。

正如我从 Ruby 文档中看到的那样，Ruby 提供了[`IO.select()`](http://ruby-doc.org/core-1.9/classes/IO.html#M002053)，它基本上是 C-API 的包装器（据我所知）。不幸的是，似乎没有`IO.poll()`，我需要这个特定的应用程序。

是否有与WinSocks 和 Berkeley Sockets`IO.select()`相同的限制？`select()`如果是，有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-02-06T08:35:34.663

Select 不能安全地用于 Linux 系统上具有超过 1024 个文件描述符的程序。这是因为 select 系统调用使用的底层 fd_set 是一个固定大小的缓冲区，即它的大小是在编译时分配的，而不是在运行时分配的。

从 man 2 中选择：

```
int select(int nfds, fd_set *readfds, fd_set *writefds,
           fd_set *exceptfds, struct timeval *timeout); 
```

> fd_set 是一个固定大小的缓冲区。使用 fd 为负数或等于或大于 FD_SETSIZE 的值执行 FD_CLR() 或 FD_SET() 将导致未定义的行为。此外，POSIX 要求 fd 是有效的文件描述符。

这意味着如果您的程序中有超过 1024 个文件描述符，并且您使用 select 系统调用，您最终将导致内存损坏。

如果要在程序中使用超过 1024 个文件描述符，则*必须*使用 poll 或 epoll，并确保永远不要使用 select，否则会出现随机内存损坏。如果`ulimit`您使用`select`. 不要这样做。

Ruby 的 select 似乎确实是通过 select 系统调用实现的，所以虽然它看起来像是在增加`ulimit`工作量，但实际上正在发生损坏： [https ://github.com/ruby/ruby/blob/trunk/thread.c](https://github.com/ruby/ruby/blob/trunk/thread.c)

此外，ruby 中的一些不相关的 API 似乎使用了 select（请参阅 thread_pthread.c），因此在运行文件描述符表大于 1024 的 ruby​​ 程序中使用这些 API 或任何使用这些 API 的代码可能也是不安全的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T15:25:35.300

每个进程可以拥有的打开连接数的限制`IO.select()`似乎主要由底层操作系统支持决定。绝对没有固定的 1024 套接字限制。

例如，在 WinXP 下，我最多打开 69 个套接字（甚至在我选择之前）。我确定这可能是可调的，我只是不知道如何。

在 Linux 下，限制是允许打开的文件数。默认情况下，限制通常为 1024（运行`ulimit -a`检查）。

但是，您可以轻松更改此设置，例如`ulimit -n 10000`. 我刚刚运行了一个测试，并愉快地完成了使用 TCPSocket.new 创建的 1024 个活动套接字，并使用 IO.select 来测试准备好的数据。

[注意：这篇GServer 文章](http://www.rubyinside.com/advent2006/10-gserver.html)中有一个很好的 IO.select 用法示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:20:31.633

[IO::Reactor](http://www.deveiate.org/projects/IO-Reactor/)可以做你需要的。它有一个 poll 方法，看起来与您所描述的相似。

# cocoa - 在 mousedown 方法中创建一个 NSRect 值数组

> ID：726357
> 
> 赞同：0
> 
> 时间：2009-04-07T15:31:33.923
> 
> 标签：cocoa, mouse, click

我的可可应用程序计算每个 mousedown 事件的位置。它还使用 NSPointInRect 检查该位置是否位于矩形内，同时使用矩形的值枚举现有的可变数组。我正在使用 if 语句将 mousedown 事件所在的矩形值添加到新数组 (selectedRectangles)。这些值完美地添加到 selectedRectangles 中，唯一的问题是以前的值被覆盖了。我怎么解决这个问题。

PS 在 mousedown 方法结束时，我使用 setNeedsDisplay:YES 来更新数据（这是因为 selectedRectangles 在另一种方法中使用）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:52:11.030

> 将矩形值...添加到新数组

假设您要继续提出[这个问题](https://stackoverflow.com/questions/726133/)。您*不想*每次都创建一个新数组。您想`NSMutableArray`在存储任何点击位置之前创建一个，然后使用它的`addObject:`方法在每次点击时添加一个新项目。

# java - Java 中的 Rails 闪现消息

> ID：726362
> 
> 赞同：6
> 
> 时间：2009-04-07T15:32:40.567
> 
> 标签：java, ruby-on-rails, ruby, spring-mvc

在 Java 世界中实现类似 Rails 的 flash 消息（例如“更新成功” [http://api.rubyonrails.org/classes/ActionController/Flash.html ）的最佳方法是什么？](http://api.rubyonrails.org/classes/ActionController/Flash.html)我正在使用 Spring MVC。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-01-26T11:15:42.830

我已经在 Spring MVC 中使用**会话范围**的bean 做到了这一点。

```
public class FlashImpl implements Flash, Serializable{

private static final long serialVersionUID = 1L;

private static final String ERROR = "error";
private static final String WARNING = "warning";
private static final String NOTICE = "notice";

private String message;
private String klass;

public void message(String klass, String message) {
    this.klass = klass;
    this.message = message;
}

public void notice(String message) {
    this.message(NOTICE, message);
}

public void warning(String message) {
    this.message(WARNING, message);
}

public void error(String message) {
    this.message(ERROR, message);
}

public boolean isEmptyMessage() {
    return message == null;
}

public void clear() {
    this.message = null;
    this.klass = null;
}

public String getMessage() {
    String msg = message;
    this.clear();
    return msg;
}

public void setMessage(String message) {
    this.message = message;
}

public String getKlass() {
    return klass;
}

public void setKlass(String klass) {
    this.klass = klass;
}} 
```

诀窍是在第一次阅读该消息后立即使用它。这样，它可以在发布后生存到重定向。

我假设只有一种类型的请求消息！如果你不想要这个，你可以按照已经建议的那样创建一个哈希图。

我将这个 bean 注入到我的控制器中（实际上我将它注入到一个由所有其他控制器继承的基本控制器中）。

在您的 JSP 中，您必须添加如下代码：

```
<c:if test="${!flash.emptyMessage}" >
    <div class="${flash.klass}">${fn:escapeXml(flash.message)}</div>
</c:if> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T15:56:04.863

我建议将其实现为会话范围的 HashTable，将字符串键映射到自定义 FlashItem 对象。FlashItem 将仅包含您正在存储的对象或字符串以及一个布尔值，可能称为 IsNew，当您将新项目插入 HashTable 时，该值应设置为 true。

然后在每个页面加载时迭代 HashTable，将任何 IsNew = true 项设置为 false，并删除 IsNew 已经为 false 的所有项。这应该给你一个与 Rails 的 flash 功能类似的工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-10-18T14:31:39.037

这已添加到 Spring MVC 3.1.RC1：

> [3.1.15 Flash 属性和重定向属性](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/new-in-3.1.html#d0e1595)
> 
> Flash 属性现在可以存储在 FlashMap 中，并保存在 HTTP 会话中以在重定向中存活。有关 Spring MVC 中对 flash 属性的一般支持的概述，请参阅[第 16.6 节，“使用 flash 属性”</a>。](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-flash-attributes)
> 
> [](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-flash-attributes)
> 
> [在带注释的控制器中，@RequestMapping 方法可以通过声明 RedirectAttributes 类型的方法参数来添加 flash 属性。此方法参数现在还可用于精确控制重定向场景中使用的属性。有关更多详细信息，请参阅](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-flash-attributes)[第 16.3.3.10 节，“指定重定向和 flash 属性”</a>。](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-ann-redirect-attributes)
> 
> [](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-ann-redirect-attributes)

[](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-ann-redirect-attributes)

[（JIRA 问题：](http://static.springsource.org/spring/docs/3.1.0.RC1/spring-framework-reference/html/mvc.html#mvc-ann-redirect-attributes)[SPR-6464](https://jira.springsource.org/browse/SPR-6464)）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-08T14:33:46.297

我在 Spring MVC 中使用了 Manolo Santos 的示例，如下所示：

使用 @Component 注释 Flash 类，并添加一个布尔变量来指示消息是否应该为另一个请求而存在。

```
@零件
公共类闪存{

    私人静态最终字符串信息=“信息”；
    私人静态最终字符串成功=“成功”；
    私有静态最终字符串错误=“错误”；
    私有静态最终字符串警告=“警告”；
    私有静态最终字符串 NOTICE = "notice";

    私有最终映射消息 = 新 HashMap();

    私有布尔 isKept；// 为另一个请求保留 msg（当控制器方法重定向到另一个请求时）

    私人无效消息（字符串严重性，字符串消息）{
        msgs.put（消息，严重性）；
    }

    公共无效信息（字符串消息）{
        this.message（信息，消息）；
    }

    公共无效成功（字符串消息）{
        this.message（成功，消息）；
    }

    公共无效通知（字符串消息）{
        this.message（注意，消息）；
    }

    公共无效警告（字符串消息）{
        this.message（警告，消息）；
    }

    公共无效错误（字符串消息）{
        this.message（错误，消息）；
    }

    公共布尔 isEmptyMessage() {
        返回 msgs.isEmpty();
    }

    公共无效清除（）{
        msgs.clear();
        isKept = 假；
    }

    公共地图getMessage（）{
        返回消息；
    }

    公共布尔 isKept() {
        返回被保留；
    }

    公共无效保持（）{
        isKept =真；
    }

    公共无效 unKeep() {
        isKept = 假；
    }
}

```

使用拦截器将 Flash 消息添加到模型对象。

```
公共类 FlashMessageInterceptor 扩展 HandlerInterceptorAdapter {

    @资源
    闪闪；

    @覆盖
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        if (!flash.isKept()) {
            modelAndView.addObject("flash", flash);
        }
    }

    @覆盖
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        如果 (flash.isKept()) {
            flash.unKeep();
        }
        别的 {
            flash.clear();
        }
    }
}

```

在您的控制器中，如果您有一个重定向到另一个方法的方法，您可以说；flush.keep()，显示 flash 消息。

```
@控制器
公共课 ComputerCampLove {

    @资源
    私人闪闪；

    @RequestMapping(方法 = RequestMethod.GET)
    公共字符串 takeMeToAnotherPlace（模型模型）{

        flash.info("发-发-发！");
        flash.keep();

        返回“重定向：某处”；
    }
}

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T18:08:39.660

如果你还没有在你的 spring java 应用程序上投入大量的工作，你可以看看在 jruby 上运行 rails。在 Rails 上运行 jRuby 的美妙之处在于您可以混合和匹配 ruby​​ gem 和 java 库。

如果您已经在您的应用程序中投入了大量工作，那么这很可能不是一个选择。

# c# - 如何通过属性控制方法行为？

> ID：726364
> 
> 赞同：5
> 
> 时间：2009-04-07T15:33:30.063
> 
> 标签：c#, .net, attributes

我想将自定义属性应用于某些方法，表明它们应该作为事务处理。一般来说，我知道如何通过从 System.Attribute 继承来创建自定义属性，但我不知道如何做我需要的。

我的目标是这样的：

```
[TransactionalMethod()]
public void SaveData(object someObject)
{
    // ... maybe some processing here
    // ... then the object gets saved to a database
    someObject.Save();
} 
```

TransactionalMethod() 属性将使该方法的行为就像它被包装在 TransactionScope 中一样......

```
 try 
 {
     using(TransactionScope scope = new TransactionScope())
     {
         SaveData(someObject);
         scope.Complete();
     }
 }
 catch 
 {
     // handle the exception here
 } 
```

如果 SaveData() 方法抛出异常，那么我们将超出 Using 并且不会调用 scope.Complete。

我不想找到调用 SaveData() 的每个实例并在其周围手动添加代码 Using 语句。我怎样才能创建一个导致这种行为的属性？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T15:39:07.180

基本上你想要[面向方面的编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)（AOP）。

看看[PostSharp](http://postsharp.org) - 它可以很好地处理这个问题。还有其他选择，但我没有使用它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T19:35:08.303

Aspect.NET 是另一个具有相同目的的项目

# sharepoint - 如何本地化不同语言的共享点站点

> ID：726366
> 
> 赞同：0
> 
> 时间：2009-04-07T15:33:51.687
> 
> 标签：sharepoint

如何本地化共享点站点。我需要它来复制在英文网站中创建的任何新内容以复制到德文网站。实际翻译处理正常。我只需要创建要从英文网站复制到德文网站的网站/子网站/内容/页面

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T15:42:36.110

您使用的是 MOSS 发布网站吗？如果是这样，您可能想研究[变体](http://office.microsoft.com/en-us/sharepointserver/HA101212991033.aspx)。

# sql - 将值插入 SQL 表并使用 SELECT 语句

> ID：726368
> 
> 赞同：3
> 
> 时间：2009-04-07T15:35:04.007
> 
> 标签：sql, sql-server

我正在尝试将一个表中的值插入到另一个表中，并带有一个必需的附加参数。例如：

```
INSERT INTO table1(someInt, someOtherInt, name, someBit)    
SELECT someInt, someOtherInt, name FROM table2 
```

someBit 不允许为空，我需要将其设置为 False，但我不太确定如何在同一个 INSERT 语句中使用它。（如果重要，我使用 SQL 2005）

编辑：哎哟......看起来我把菲力牛排扔给狮子了:-)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-07T15:36:32.413

也许

```
INSERT INTO table1(someInt, someOtherInt, name, someBit)    
SELECT someInt, someOtherInt, name, 0
FROM table2 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T15:36:49.480

也许

`INSERT INTO table1(someInt, someOtherInt, name, someBit)
SELECT someInt, someOtherInt, name, 0 FROM table2`

?

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-07T15:36:59.027

```
INSERT INTO table1(someInt, someOtherInt, name, someBit)    
SELECT someInt, someOtherInt, name, 0 FROM table2 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T15:37:27.713

您可以像这样对 SELECT 中的值进行硬编码：

```
INSERT INTO
     dbo.table1
(
     someInt,
     someOtherInt,
     name,
     someBit
)
SELECT
     someInt,
     someOtherInt,
     name,
     0
FROM
     dbo.table2 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T18:14:05.733

您还可以为目标表上的该列定义默认值。这样您就不必在插入语句中全部引用它。

假设您的 SomeBit 是客户表上的活动标志或状态。活动 0 = 关/假/否 活动 1 = 开/真/是。

```
ALTER TABLE [dbo].[Customer] ADD  CONSTRAINT [DF_Customer_Active]  DEFAULT ((1)) FOR [Active] 
```

# opengl - 如何在 OpenGL 中使用多个视口？

> ID：726379
> 
> 赞同：29
> 
> 时间：2009-04-07T15:37:30.290
> 
> 标签：opengl, viewport

我需要在 OpenGL 中在两个不同的视口中显示相同的对象，例如，一个使用正交投影，另一个使用透视。为此，是否需要在每次调用 glViewport() 后再次绘制对象？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T15:39:57.303

Nehe 有[一个关于如何做到这一点的很好的教程](http://nehe.gamedev.net/tutorial/multiple_viewports/20002/)，他的网站通常是 OpenGL 问题的一个很好的资源。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-08-25T09:21:27.930

```
 // normal mode
  if(!divided_view_port)
    glViewport(0, 0, w, h);
else
{
    // right bottom
    glViewport(w/2, h/2, w, h);
    glLoadIdentity ();
    gluLookAt(5.0f, 5.0f, 5.0f,
              0.0f, 0.0f, 0.0f,
              0.0f, 1.0f, 0.0f);

    display();

    // left bottom
    glViewport(0, h/2, w/2, h);
    glLoadIdentity();
    gluLookAt (5.0f, 0.0f, 0.0f,
              0.0f, 0.0f, 0.0f,
              0.0f, 1.0f, 0.0f);

    display();

    // top right
    glViewport(w/2, 0, w, h/2);
    glLoadIdentity();
    gluLookAt(0.0f, 0.0f, 5.0f,
              0.0f, 0.0f, 0.0f,
              0.0f, 1.0f, 0.0f);

    display();

    // top left
    glViewport(0, 0, w/2, h/2);
    glLoadIdentity();
    gluLookAt(0.0f, 5.0f, 0.0f,
              0.0f, 0.0f, 0.0f,
              0.0f, 1.0f, 0.0f);

    display();
}
glMatrixMode(GL_PROJECTION);
glLoadIdentity();

if (w <= h)
    glOrtho(-2.0, 2.0, 
            -2.0 * (GLfloat) h / (GLfloat) w, 2.0 * (GLfloat) h / (GLfloat) w, 
    -10.0, 100.0); 
else
    glOrtho(-2.0 * (GLfloat) w / (GLfloat) h, 2.0 * (GLfloat) w / (GLfloat) h, 
    -2.0, 2.0, 
    -10.0, 100.0);

glMatrixMode(GL_MODELVIEW); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-03-16T22:35:13.620

**最小可运行示例**

类似于[这个答案](https://stackoverflow.com/a/1327092/895245)，但更直接和可编译。输出：

![](https://i.stack.imgur.com/tRuZG.png)

主程序

```
#include <stdlib.h>

#include <GL/gl.h>
#include <GL/glu.h>
#include <GL/glut.h>

static int width;
static int height;

static void display(void) {
    glClear(GL_COLOR_BUFFER_BIT);
    glColor3f(1.0f, 0.0f, 0.0f);

    glViewport(0, 0, width/2, height/2);
    glLoadIdentity();
    gluLookAt(0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0);
    glutWireTeapot(1);

    glViewport(width/2, 0, width/2, height/2);
    glLoadIdentity();
    gluLookAt(0.0, 0.0, 3.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0);
    glutWireTeapot(1);

    glViewport(0, height/2, width/2, height/2);
    glLoadIdentity();
    gluLookAt(0.0, 3.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0);
    glutWireTeapot(1);

    glViewport(width/2, height/2, width/2, height/2);
    glLoadIdentity();
    gluLookAt(0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0);
    glutWireTeapot(1);

    glFlush();
}

static void reshape(int w, int h) {
    width = w;
    height = h;
    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    glFrustum(-1.0, 1.0, -1.0, 1.0, 1.5, 20.0);
    glMatrixMode(GL_MODELVIEW);
}

int main(int argc, char** argv) {
    glutInit(&argc, argv);
    glutInitDisplayMode(GLUT_SINGLE | GLUT_RGB);
    glutInitWindowSize(500, 500);
    glutInitWindowPosition(100, 100);
    glutCreateWindow(argv[0]);
    glClearColor(0.0, 0.0, 0.0, 0.0);
    glShadeModel(GL_FLAT);
    glutDisplayFunc(display);
    glutReshapeFunc(reshape);
    glutMainLoop();
    return EXIT_SUCCESS;
} 
```

编译并运行：

```
gcc -o main.out main.c -lGL -lGLU -lglut
./main.out 
```

我认为在现代 OpenGL 4 中，您应该只渲染纹理，然后将这些纹理正交放置在屏幕上，将此视为起点：[http ://www.opengl-tutorial.org/intermediate-tutorials/tutorial-14 -渲染到纹理/](http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-14-render-to-texture/)

在 OpenGL 4.5.0 NVIDIA 352.63、Ubuntu 15.10 上测试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T15:54:29.047

是的，

如果它们在同一个窗口中，您还应该更改剪刀设置以在两个视图之间有一个干净的分隔。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-09-07T22:46:50.500

在 GL 4 中，您可以在一个渲染过程中渲染到多个视口。请参阅[ARB_viewport_array](https://www.khronos.org/registry/OpenGL/extensions/ARB/ARB_viewport_array.txt)和相关概念。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-23T19:53:56.040

将 OpenGL 想象成只是准备输出到当前正在使用的窗口的命令。

OpenGL 有两个命令，即使是 NEHE 的教程也没有告诉您其重要性：

wglCreateContext - 接受窗口设备上下文 DC，可以从任何窗口获取 - 无论是用户控件、窗口窗体、GL 窗口还是其他应用程序窗口（如记事本）。这将创建一个 OpenGL 设备上下文 - 它们称为资源上下文 - 您稍后将与 ...

wglMakeCurrent - 它接受两个参数，您正在处理的设备上下文（在 wglCreateContext 中为 Windows 设备上下文传递的参数） - 以及返回的资源上下文。

仅利用这两件事 - 这是我的建议：

NEHE 的教程提供了一种解决方案，它仅利用现有窗口并分割屏幕以进行绘图。这是教程： http: [//nehe.gamedev.net/tutorial/multiple_viewports/20002/](http://nehe.gamedev.net/tutorial/multiple_viewports/20002/)

利用 glViewport，您需要在每次更新时重新绘制。

这是一种方法。

但是还有另一种 - 图形较少且处理器密集的方法：

通过利用用户控件为每个视图创建一个窗口。

每个窗口都有自己的 hWnd。

获取 DC，处理 wglcreatecontext，然后在计时器上（我的是每秒 30 帧），如果您检测到状态更改，则为该视图选择 wglMakeCurrent 并重绘。否则，请完全跳过该部分。

这节省了宝贵的处理能力，还减少了必须手动管理窗口和视口计算的代码。

# iphone - 如何使用水效果转换切换内容视图？

> ID：726382
> 
> 赞同：0
> 
> 时间：2009-04-07T15:38:57.790
> 
> 标签：iphone, core-animation

在照片应用程序中，有一个漂亮的水滴效果用于过渡。不久前，我看到一个应用程序在其内容视图中使用了相同的水效果过渡。

不幸的是，UIViewAnimationTransition 文档中没有列出这种过渡类型。但是由于这个第三方应用程序使用了它（我不记得它的名字），我想有一种使用它的方法。

有人知道吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T20:34:46.597

它不是已发布 SDK 的一部分。如果你想在应用商店销售你的应用，你需要自己实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T22:14:32.893

我认为这只是一种隐藏`CATransition`类型：

```
CATransition *transition = [CATransition animation];
transition.type = @"rippleEffect";
transition.duration = 5.0f;
transition.timingFunction = UIViewAnimationCurveEaseInOut;
[self.layer addAnimation:transition forKey:@"transitionViewAnimation"]; 
```

（注意：我没有尝试过，`rippleEffect`但我已经使用过`suckEffect`类似`spewEffect`的）

# mysql - mysql + 更新前 n

> ID：726386
> 
> 赞同：9
> 
> 时间：2009-04-07T15:40:12.840
> 
> 标签：mysql, sql, sql-update

我有这样的查询：

```
update  table
set     status = 1
where   status = 2; 
```

但我只想对前 400 名执行此操作。我尝试添加一个“限制 0、400”（就像我在查询中那样），但这没有用。我做了一些搜索，mysql 似乎不像 sql server 那样支持 TOP(n) 命令。

知道我会怎么做吗？

编辑：为了将来参考，我使用以下样式进行选择，效果很好：

```
select  * 
from    table
where   ... limit 0, 400; 
```

但在更新中，无论出于何种原因，它都不能与“0”一起使用。我会考虑这种不一致和模棱两可的行为，但是哦，好吧。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-07T15:50:19.790

```
UPDATE  table
SET     status = 1
WHERE   status = 2
ORDER BY id
LIMIT 400 
```

签到`MySQL 5.2.0-falcon-alpha-community-nt-log`，确认工作。

在你的情况下，它`0`不起作用`LIMIT 0, 400`。

`UPDATE`您不能在's中使用下限`LIMIT`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T15:48:17.237

试试这个：

```
update  table
set     status = 1
where   status = 2
LIMIT 400 
```

您也可以通过子句下订单

```
update  table
set     status = 1
where   status = 2
ORDER BY id
LIMIT 400 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-06-15T09:45:04.263

以供将来参考，不要忘记关闭安全模式

```
SET SQL_SAFE_UPDATES = 0;
update YOUR_DATABASE_NAME.TABLE_NAME
set COLUMN_NAM = 0
limit 400;
SET SQL_SAFE_UPDATES = 1; 
```

例如，MySQL 不允许您更新记录以防止您在安全模式下出错，因此您必须禁用它才能更新您的记录。

另一种语法非常先进。limit 会将返回的记录数量限制为您选择的数量。

# asp.net - WriteStartDocument() 抛出 InvalidOperationException

> ID：726387
> 
> 赞同：1
> 
> 时间：2009-04-07T15:40:16.897
> 
> 标签：asp.net, xml, xmltextwriter

我正在尝试生成 XML，但遇到了这个异常：

```
XmlTextWriter xmlWriter = new XmlTextWriter(Response.OutputStream, Encoding.UTF8);

xmlWriter.WriteStartDocument();
xmlWriter.WriteStartElement("userInfo"); 
```

它给了我一个例外：

`WriteStartDocument needs to be the first call.`

但正如您所见，我确实先调用了 WriteStartDocument()！

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T15:46:02.077

但是，响应流中已经有其他内容（例如 HTTP 标头）。

将 XML 写入 StringWriter 然后将字符串写入 Response 可能会更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-10T13:24:18.803

尝试使用这个：

```
XmlTextWriter xmlWriter = new XmlTextWriter(Response.OutputStream, Encoding.UTF8);
xmlWriter.Formatting = Formatting.Indented;
xmlWriter.WriteStartDocument(false);
xmlWriter.WriteStartElement("userInfo"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T15:49:18.437

不要忘记清除内容的 aspx 文件，以便只剩下 Page 指令，即：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %> 
```

也使用 Response.Output 而不是 Response.OutputStream：

```
XmlTextWriter xmlWriter = new XmlTextWriter(Response.Output); 
xmlWriter.WriteStartDocument(); 
xmlWriter.WriteStartElement("userInfo");
xmlWriter.WriteEndElement(); 
```

# iphone - 可以从 iPhone 和 Android 应用程序安全访问哪些通用后端？

> ID：726388
> 
> 赞同：3
> 
> 时间：2009-04-07T15:40:36.273
> 
> 标签：iphone, android, security, backend

我正在考虑为 iPhone 和 Android 创建一个需要访问通用后端来检索帐户信息的应用程序。两者都可以通过 https 访问 Web 服务吗？还有什么其他方法可以让我拥有一个可供两者访问的后端接口？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T15:43:34.877

它们都通过 http 和 https 工作，这是一个足够常见的协议。我建议您使用 RESTful Web 服务，以便通过 URI 公开您的服务，例如[http://www.myservice.com/weather/zip/98007](http://www.myservice.com/weather/zip/98007)，这将返回一个可由客户端解析的 XML blob。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-21T03:35:23.117

如果你从零开始，我肯定会选择`RESTful`返回/接受的服务`JSON`......两个平台都有很多库可以接受`JSON`并将其转换为数组和字典。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T15:44:45.810

我建议使用 RESTful Web 服务后端，它都是标准的 HTTP 和/或 HTTPS。如果您可以使用 Ruby on Rails，它的默认脚手架将为您提供大约 99% 的路径，并且对于 iPhone，有一个名为 ObjectiveResource 的开源项目可以自动与此 Rails 后端进行通信。我还没有调查 Android 上有哪些可用选项，但由于它都是简单的 HTTP，它应该很简单。我不是 ObjectiveResource 的维护者，但我贡献了一些代码。你可以在这里查看：

[http://iphoneonrails.com](http://iphoneonrails.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T17:08:42.580

我看到与其他服务一起使用的一种好方法是编写后端，使其可以以不同类型反馈数据 - 对于 Android，XML 响应是最好的，但对于 iPhone，发送回 plist 数据是首选（尽管它如果需要，也可以使用 XML）。在这两种情况下，简单地将更新 POST 回服务器比用 XML 包装更新更容易。

两个平台都应该能够使用您希望使用的任何形式的身份验证，我知道的 iPhone 支持所有 HTTP 身份验证方法。

# c# - 使用 Prism 显示选项卡的标题

> ID：726391
> 
> 赞同：1
> 
> 时间：2009-04-07T15:41:26.800
> 
> 标签：c#, wpf

我正在使用 Prism 并且有一个区域是 TabControl。我在 TabControl.ItemTemplate 上有一个 DataTemplate 设置为 IView 类型的接口。IView 有一个 Title 和 Description 字符串。当我使用 IView 调用 RegisterViewWithRegion 时，会添加选项卡，但标题上不显示任何描述。我可以不绑定到接口上的属性还是我错过了其他东西？

manager.AddToRegion("ContentZone", new PrimaryView()); //实现IView

```
<TabControl x:Name="ContentZone" cal:RegionManager.RegionName="ContentZone" Grid.Row="1" umn="0">
<TabControl.ItemTemplate>
    <DataTemplate DataType="{x:Type oasis:IView}">
        <DockPanel ToolTip="{Binding Path=Description}">
            <Label Padding="0"
                   Content="{Binding Path=Title}"
                   VerticalAlignment="Center" /> 
```

编辑：我找到了一个解决方案，虽然我觉得它不是很好。出于某种原因，无论我做什么，DataTemplate 的 DataContext 总是返回为空，我尝试了 DataTempalteSelector，但项目本身也是空的。我尝试改用基本抽象类，但也没有用。所以这就是我对绑定本身的最终结果：

```
{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ContentControl}}, Path=DataContext.Title} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T16:24:13.017

您不能将 a`DataTemplate`与接口相关联。它必须与类型直接关联。如果您想通过接口进行关联，您可以考虑实现 a`DataTemplateSelector`来检查项目是否实现`IView`并相应地返回 a `DataTemplate`。

# sql-server - 解析 SQL 2008 FTS 的搜索查询

> ID：726392
> 
> 赞同：0
> 
> 时间：2009-04-07T15:41:31.060
> 
> 标签：sql-server, search, full-text-search

我们想使用 SQL SERVER 2008 全文搜索，但似乎在处理搜索查询时遇到了很多问题。

如果用户输入“blue dog”，它只会使 sql 崩溃，除非我们解析搜索词以在单词周围包含“”，但这使它成为短语而不是关键字。

我想要包含 blue 或 dog 的结果，但这意味着用 or(s) 等替换空格。不幸的是，用户可能键入的组合似乎太多了。

是否有任何库（用于.net）已经可以将搜索字符串解析为 FT 可以理解的内容？

我们想要类似 Google 的语法 :)

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T16:12:15.027

我正在寻找“FREETEXT”选项并使用“CONTAINS”关键字代替，我的错。Freetext 给了我想要的结果。

# java - DOM 处理后的 XML 属性顺序

> ID：726395
> 
> 赞同：47
> 
> 时间：2009-04-07T15:42:14.740
> 
> 标签：java, xml, dom

当通过标准 DOM 处理 XML 时，序列化后不能保证属性顺序。最后，这就是我在使用标准 java XML Transform API 序列化输出时才意识到的。

但是我确实需要保持订单。我想知道Java是否有任何可能性来保持通过DOM API处理的XML文件属性的原始顺序，或任何强制顺序的方式（也许通过使用允许您设置的替代序列化API种属性）。在我的情况下，处理减少以改变具有一堆属性的相同元素序列的某些属性（不是全部）的值，并且可能插入更多元素。

是否有任何“简单”的方法或者我必须定义我自己的 XSLT 转换样式表来指定输出并更改整个输入 XML 文件？

**更新**我必须感谢您的所有回答。答案现在似乎比我预期的更明显。我从来没有关注过属性顺序，因为我以前从来不需要它。

需要属性顺序的主要原因是生成的 XML 文件*看起来*不同。目标是一个包含数百个警报的配置文件（每个警报都由一组属性定义）。这个文件通常随着时间的推移几乎没有修改，但保持它的顺序很方便，因为当我们需要修改某些东西时，它是手动编辑的。有时，一些项目需要对该文件进行轻微修改，例如将属性之一设置为客户特定的代码。

我刚刚开发了一个小应用程序将原始文件（所有项目通用）与每个项目的特定部分（修改某些属性的值）合并，因此特定于项目的文件获取基础文件的更新（新的警报定义或某些属性值错误修正）。我要求有序属性的主要动机是能够通过文本比较工具（例如 Winmerge）检查应用程序的输出与原始文件的对比。如果格式（主要是属性顺序）保持不变，则很容易发现差异。

我真的认为这是可能的，因为 XML 处理程序（例如 XML Spy）允许您编辑 XML 文件并应用一些排序（网格模式）。也许我唯一的选择是使用这些程序之一来*手动*修改输出文件。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-09-16T15:31:51.837

很抱歉，但答案比“不，你不能”或“为什么你首先需要这样做？”更微妙。

简短的回答是“DOM 不允许你这样做，但 SAX 会”。

这是因为 DOM 不关心属性顺序，因为就标准而言它是没有意义的，并且当 XSL 获得输入流时，信息已经丢失。大多数 XSL 引擎实际上会优雅地保留输入流属性顺序（例如 Xalan-C（一种情况除外）或 Xalan-J（始终））。特别是如果您使用`<xsl:copy*>`.

据我所知，不保留属性顺序的情况是。- 如果输入流是 DOM - Xalan-C：如果您按字面意思插入结果树标签（例如`<elem att1={@att1} .../>`

这是一个使用 SAX 的示例，用于记录（也禁止 DTD 唠叨）。

```
SAXParserFactory spf = SAXParserFactoryImpl.newInstance();
spf.setNamespaceAware(true);
spf.setValidating(false);
spf.setFeature("http://xml.org/sax/features/validation", false);
spf.setFeature("http://apache.org/xml/features/nonvalidating/load-dtd-grammar", false);
spf.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
SAXParser sp = spf.newSAXParser() ;
Source src = new SAXSource ( sp.getXMLReader(), new InputSource( input.getAbsolutePath() ) ) ;
String resultFileName = input.getAbsolutePath().replaceAll(".xml$", ".cooked.xml" ) ;
Result result = new StreamResult( new File (resultFileName) ) ;
TransformerFactory tf = TransformerFactory.newInstance();
Source xsltSource = new StreamSource( new File ( COOKER_XSL ) );
xsl = tf.newTransformer( xsltSource ) ;
xsl.setParameter( "srcDocumentName", input.getName() ) ;
xsl.setParameter( "srcDocumentPath", input.getAbsolutePath() ) ;

xsl.transform(src, result ); 
```

我还想指出，出于许多反对者的意图，在*某些*情况下属性顺序*确实*很重要。

回归测试是一个明显的例子。任何被要求优化写得不太好的 XSL 的人都知道，您通常希望确保“新”结果树与“旧”结果树相似或相同。当结果树大约有一百万行时，XML diff 工具被证明过于笨拙......在这些情况下，保留属性顺序很有帮助。

希望这可以帮助 ;-）

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-07T18:07:16.967

查看 XML 建议的第 3.1 节。它说，“请注意，开始标签或空元素标签中属性规范的顺序并不重要。”

如果某个软件需要 XML 元素上的属性以特定顺序出现，则该软件不是在处理 XML，而是在处理表面上看起来像 XML 的文本。它需要修复。

如果它无法修复，并且您必须生成符合其要求的文件，那么您就无法可靠地使用标准 XML 工具来生成这些文件。例如，您可以尝试（按照您的建议）使用 XSLT 以定义的顺序生成属性，例如：

```
<test>
   <xsl:attribute name="foo"/>
   <xsl:attribute name="bar"/>
   <xsl:attribute name="baz"/>
</test> 
```

只是发现 XSLT 处理器发出这个：

```
<test bar="" baz="" foo=""/> 
```

因为处理器使用的 DOM 按标签名称的字母顺序排列属性。（这在 XML DOM 中很常见但不是普遍的行为。）

但我想强调一点。如果某个软件在某个方面违反了 XML 建议，那么它很可能在其他方面也违反了它。如果在您以错误的顺序提供属性时它会中断，如果您用单引号分隔属性，或者如果属性值包含字符实体，或者 XML 建议中所说的 XML 文档中的任何其他内容，它也可能会中断可以做到这一点，这个软件的作者可能没有想到。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-09-16T15:36:26.323

XML 规范化导致一致的属性排序，主要是为了允许人们检查部分或全部 XML 的签名，尽管还有其他潜在用途。这可能适合您的目的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-07T18:27:40.893

罗伯特·罗斯尼（Robert Rossney）刚才所说的话怎么强调都不为过，但我会努力的。;-)

国际标准的好处是，当每个人都遵循它们时，生活是美好的。我们所有的软件都和平相处。

XML 必须是我们拥有的最重要的标准之一。它是诸如 SOAP 之类的“旧网络”东西的基础，并且仍然是诸如 RSS 和 Atom 之类的“网络 2.0”之类的东西。正是因为有明确的标准，XML 才能够在不同平台之间进行互操作。

如果我们一点一点地放弃 XML，我们就会陷入这样一种情况，即 XML 的生产者将无法假设 XML 的消费者能够消费他们的内容。这将对行业产生灾难性的影响。

我们应该非常有力地反对任何编写不根据标准处理 XML 的代码的人。我明白，在这个经济时代，人们不愿意通过说“不”来冒犯客户和商业伙伴。但在这种情况下，我认为这是值得的。如果我们必须为每个业务合作伙伴手工制作 XML，我们的财务状况会更糟。

所以，不要“启用”不懂 XML 的公司。将标准发送给他们，突出显示相应的行。他们需要停止认为 XML 只是带有尖括号的文本。它根本不像带有尖括号的文本。

这不像是有借口的。即使是最小的嵌入式设备也可以在其中拥有全功能的 XML 解析器实现。我还没有听说过不能解析标准 XML 的充分理由，即使买不起功能齐全的 DOM 实现也是如此。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-06-29T14:32:40.060

我想我可以找到一些关心属性顺序的有效理由：

*   您可能期望人类不得不手动读取、诊断或编辑 XML 数据一次或多次；在这种情况下，可读性很重要，属性的一致和逻辑排序有助于实现这一点；
*   您可能必须与某些（诚然错误地）关心订单的工具或服务进行沟通；要求提供商更正其代码可能不是一种选择：尝试向政府机构提出要求，而您的用户以电子方式交付一堆财政文件的截止日期越来越近了！

似乎[Alain Pannetier 的解决方案](https://stackoverflow.com/questions/726395/order-of-xml-attributes-after-dom-processing/3728241#3728241)是可行的方法。

此外，您可能想看看[DecentXML](https://bitbucket.org/digulla/decentxml)；它使您可以完全控制 XML 的格式，即使它与 DOM 不兼容。如果您想修改一些手工编辑的 XML 而不会丢失格式，则特别有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-31T22:13:03.900

我有同样的问题。我想修改 XML 属性，但由于差异而想保持顺序。我使用[StAX](http://docs.oracle.com/javase/tutorial/jaxp/stax/index.html)来实现这一点。您必须使用 XMLStreamReader 和 XMLStreamWriter（基于 Cursor 的解决方案）。当您获得 START_ELEMENT 事件类型时，游标会保留属性的索引。因此，您可以进行适当的修改并将它们“按顺序”写入输出文件。

看这篇[文章/讨论](https://forums.oracle.com/forums/thread.jspa?threadID=2428142&tstart=0)。您可以看到如何按顺序读取起始元素的属性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-09T13:13:42.183

您仍然可以使用标准 DOM 和 Transformation API 执行此操作，方法是使用一种快速而肮脏的解决方案，例如我所描述的解决方案：

我们知道转换 API 解决方案按字母顺序排列属性。您可以在属性名称前加上一些易于剥离的字符串，以便它们按您想要的顺序输出。在大多数情况下，简单的前缀如“a_”“b_”等就足够了，并且可以使用单行正则表达式轻松地从输出 xml 中剥离。

如果您正在加载 xml 并重新保存并希望保留属性顺序，则可以使用相同的原理，首先修改输入 xml 文本中的属性名称，然后将其解析为 Document 对象。同样，根据 xml 的文本处理进行此修改。这可能很棘手，但可以通过再次使用正则表达式检测元素及其属性字符串来完成。请注意，这是一个肮脏的解决方案。自己解析 XML 时有很多陷阱，即使是这样简单的事情，所以如果您决定实现它，请小心。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T15:45:25.370

你真的不需要保持任何秩序。据我所知，在验证 XML 文档时，也没有模式考虑属性顺序。听起来在另一端处理 XML 的任何东西都没有使用适当的 DOM 来解析结果。

我想一种选择是使用字符串构建手动构建文档，但我强烈建议不要这样做。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-07T18:32:21.070

Robert Rossney 说得好：如果您依赖于属性的排序，那么您实际上并不是在处理 XML，而是在处理看起来像 XML 的东西。

我至少可以想到两个您可能关心属性排序的原因。可能还有其他人，但至少对于这两个我可以提出替代方案：

1.  您正在使用具有相同名称的多个属性实例：

    ```
    <foo myAttribute="a" myAttribute="b" myAttribute="c"/> 
    ```

    这只是普通的无效 XML；DOM 处理器可能会丢弃所有这些值，但其中一个值除外——如果它完全处理文档的话。而不是这个，你想使用子元素：

    ```
    <foo>
        <myChild="a"/>
        <myChild="b"/>
        <myChild="c"/>
    </foo> 
    ```

2.  您假设某种区别适用于首先出现的属性。通过其他属性或通过子元素明确这一点。例如：

    ```
    <foo attr1="a" attr2="b" attr3="c" theMostImportantAttribute="attr1" /> 
    ```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-15T00:15:35.263

一类的作品...

```
package mynewpackage;

// for the method
import java.lang.reflect.Constructor;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.List;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

// for the test example
import org.xml.sax.InputSource;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import java.io.StringReader;
import org.w3c.dom.Document;
import java.math.BigDecimal;

public class NodeTools {
    /**
     * Method sorts any NodeList by provided attribute.
     * @param nl NodeList to sort
     * @param attributeName attribute name to use
     * @param asc true - ascending, false - descending
     * @param B class must implement Comparable and have Constructor(String) - e.g. Integer.class , BigDecimal.class etc
     * @return 
     */
    public static Node[] sortNodes(NodeList nl, String attributeName, boolean asc, Class<? extends Comparable> B)
    {        
        class NodeComparator<T> implements Comparator<T>
        {
            @Override
            public int compare(T a, T b)
            {
                int ret;
                Comparable bda = null, bdb = null;
                try{
                    Constructor bc = B.getDeclaredConstructor(String.class);
                    bda = (Comparable)bc.newInstance(((Element)a).getAttribute(attributeName));
                    bdb = (Comparable)bc.newInstance(((Element)b).getAttribute(attributeName));
                }
                catch(Exception e)
                {
                    return 0; // yes, ugly, i know :)
                }
                ret = bda.compareTo(bdb);
                return asc ? ret : -ret; 
            }
        }

        List<Node> x = new ArrayList<>();
        for(int i = 0; i < nl.getLength(); i++)
        {
            x.add(nl.item(i));
        }
        Node[] ret = new Node[x.size()];
        ret = x.toArray(ret);
        Arrays.sort(ret, new NodeComparator<Node>());
        return ret;
    }    

    public static void main(String... args)
    {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();  
        DocumentBuilder builder;
        String s = "<xml><item id=\"1\" price=\"100.00\" /><item id=\"3\" price=\"29.99\" /><item id=\"2\" price=\"5.10\" /></xml>";
        Document doc = null;
        try 
        {  
            builder = factory.newDocumentBuilder();  
            doc = builder.parse(new InputSource(new StringReader(s)));
        }
        catch(Exception e) { System.out.println("Alarm "+e); return; }

        System.out.println("*** Sort by id ***");
        Node[] ret = NodeTools.sortNodes(doc.getElementsByTagName("item"), "id", true, Integer.class);

        for(Node n: ret)
        {
            System.out.println(((Element)n).getAttribute("id")+" : "+((Element)n).getAttribute("price"));
        }

        System.out.println("*** Sort by price ***");
        ret = NodeTools.sortNodes(doc.getElementsByTagName("item"), "price", true, BigDecimal.class);
        for(Node n: ret)
        {
            System.out.println(((Element)n).getAttribute("id")+" : "+((Element)n).getAttribute("price"));
        }
    }
} 
```

在我的简单测试中，它打印：

```
*** Sort by id ***
1 : 100.00
2 : 5.10
3 : 29.99
*** Sort by price ***
2 : 5.10
3 : 29.99
1 : 100.00 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2014-10-02T21:28:16.643

我有一个非常相似的问题。我首先需要始终具有相同的属性。例子 ：

```
<h50row a="1" xidx="1" c="1"></h50row>
<h50row a="2" b="2" xidx="2"></h50row> 
```

必须成为

```
<h50row xidx="1" a="1" c="1"></h50row>
<h50row xidx="2" a="2" b="2"></h50row> 
```

我找到了一个带有正则表达式的解决方案：

```
test = "<h50row a=\"1\" xidx=\"1\" c=\"1\"></h50row>";
test = test.replaceAll("(<h5.*row)(.*)(.xidx=\"\\w*\")([^>]*)(>)", "$1$3$2$4$5"); 
```

希望你觉得这很有用

# java - Java中对象的内存开销是多少？

> ID：726404
> 
> 赞同：7
> 
> 时间：2009-04-07T15:44:34.343
> 
> 标签：java, memory, overhead

### 复制：

> [Java中对象的内存消耗是多少？](https://stackoverflow.com/questions/258120/what-is-the-memory-consumption-of-an-object-in-java)

假设在 Intel 或 AMD 机器上的 64 位 Linux 上的 Java 1.6 JVM，创建一个简单的对象使用多少字节的内存开销？例如，二维数组中的每一行都是一个单独的对象。如果我的阵列很大，我将使用多少 RAM？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-07T15:56:49.977

这将取决于您使用的 JVM。

假设您没有使用带有压缩指针的 JVM，该数组将消耗：

*   8 个字节用于类型指针。
*   数组长度为 4 个字节。
*   数组中的每个元素 8 个字节（这些是指向实际对象的指针）。
*   总和：8+4+len*8 字节
*   对于带有压缩指针的 JVM：4+4+len*4 字节

然后，您在数组中存储（引用）的实际对象将消耗内存，具体取决于它们是什么类型的对象。java.lang.Object 仅包含一个指向该类的指针，因此为 8 个字节，如果使用压缩指针则为 4 个字节。

对于您自己的类，您可以通过查看类中的字段来计算内存使用量。每个引用将消耗 8 个字节（压缩指针为 4 个字节）。每个 long 8 个字节，int 4 个字节，char/short 2 个字节，byte/boolean 1 个字节。但是所有这些都将对齐到一个偶数的总大小，即 4 或 8 字节的倍数，具体取决于您使用的 JVM。

# asp.net - 我需要帮助配置 ASP.net 配置文件

> ID：726406
> 
> 赞同：0
> 
> 时间：2009-04-07T15:45:07.713
> 
> 标签：asp.net, asp.net-profiles

我正在尝试使用 ASP.net 配置文件我遵循了一些说明，这意味着我有

1.  设置一个 ASPNETDB（使用 SQLExpress 2005）
2.  配置配置文件提供程序（在 web.config 中）
3.  定义了一些属性
4.  启用身份验证

但我似乎无法使用类似的代码（即 Intellisense 不喜欢它）

```
Profile.UserCustomContent = "Hi Mom"; 
```

很明显我错过了一些重要的东西，但我看不到，请帮助我......

以下是我的一些片段`web.config`

```
<connectionStrings>
<add name="SqlServices"
connectionString="Data Source=localhost;Integrated Security=SSPI;Initial Catalogue=aspnetdb" />
</connectionStrings>

<system.web>
<authentication mode="Windows" />
<authorization>
<deny users="?"/>
</authorization>

<profile enabled="true" defaultProvider="SqlServices">
<providers>
<clear/>
<add name="SqlProvider" type="System.Web.Profile.SqlProfileProvider"
connectionStringName="SqlServices" applicationName="MyInternalApplication" />
</providers>

<properties>
<add name="UserSearchFilterOptions" type="String" />
<add name="UserCustomContent" type="String"/>
</properties>
</profile>
</system.web> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T15:55:55.173

添加配置文件时，您将其称为 SqlProvider 而不是 SqlServices。（您在上面使用的默认配置文件提供程序名称）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:56:43.957

我就是这样做的..也许你的情况有不同的方法。

VB - 新用户..（真是 IsAuthenticated 的值）

```
Dim profile As ProfileCommon = ProfileCommon.Create(myUser.UserName, True)
profile.UserCustomContent = "customcontent" 
```

VB - 现有用户...

```
Dim profile As ProfileCommon
profile = Profile.GetProfile(myUser.UserName)
profile.UserCustomContent = "customcontent" 
```

C# - 新用户

```
ProfileCommon profile = (ProfileCommon) ProfileCommon.Create(myUser.UserName, true);
profile.UserCustomContent = "customcontent";
profile.Save(); 
```

C# - 现有用户

```
ProfileCommon profile;
profile = Profile.GetProfile(myUser.UserName);
profile.UserCustomContent = "customcontent";
profile.Save(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T03:05:31.807

如果您使用的是 Web 应用程序项目，您将需要自己实现配置文件。配置文件只能与网站选项一起使用。Web 应用程序项目没有像网站项目那样将 Profile 对象自动添加到每个页面，因此我们无法获得对 web.config 文件中定义的配置文件属性的强类型编程访问。

因此，如果您使用的是 Web 应用程序项目，这应该会有所帮助：

[http://code.msdn.microsoft.com/WebProfileBuilder](http://code.msdn.microsoft.com/WebProfileBuilder)

但是，如果您使用的是网站项目，那么 Scott Guthrie 的这篇文章应该会引导您朝着正确的方向前进：

[http://weblogs.asp.net/scottgu/archive/2005/10/18/427754.aspx](http://weblogs.asp.net/scottgu/archive/2005/10/18/427754.aspx)

有关我自己的一篇博客文章的更多详细信息：

[http://www.codersbarn.com/post/2008/06/01/ASPNET-Web-Site-versus-Web-Application-Project.aspx](http://www.codersbarn.com/post/2008/06/01/ASPNET-Web-Site-versus-Web-Application-Project.aspx)

:-)

# c# - 在 C++ 中序列化然后在 C# 中反序列化？

> ID：726410
> 
> 赞同：11
> 
> 时间：2009-04-07T15:45:28.570
> 
> 标签：c#, c++, serialization

有没有一种简单的方法可以在 C++ 中序列化数据（到 xml 或二进制），然后在 C# 中反序列化数据？

我正在使用一些不会运行 .Net 的远程 WINNT 机器。我的服务器应用程序完全用 C# 编写，所以我想要一种简单的方法来共享简单数据（主要是键值对，也许是 SQL 结果集的一些表示形式）。我认为最好的方法是在客户端以某种预定义格式将数据写入 xml，将 xml 文件传输到我的服务器，然后让 C# 包装器将 xml 读取到可用的 c# 对象中。

客户端和服务器通过 tcp 连接进行通信，我真正想要的是序列化客户端内存中的数据，通过套接字将二进制数据传输到 ac# 内存流，我可以反序列化为 ac# 对象（消除文件创建，转移等），但我认为不存在类似的东西。随意启发我。

## 编辑

我知道我可以在 c++ 应用程序中创建一个结构并在 c# 中定义它并以这种方式传输数据，但在我看来，这感觉就像我在限制可以发送的内容。我必须为对象等设置预定义的大小

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T15:48:37.237

[协议缓冲区](http://code.google.com/apis/protocolbuffers/docs/overview.html)可能对您有用。

> 协议缓冲区是 Google 用于序列化结构化数据的语言中立、平台中立、可扩展的机制——**想想 XML，但更小、更快、更简单**。您只需定义一次数据的结构化方式，然后就可以使用特殊生成的源代码轻松地在各种数据流中写入和读取结构化数据，并使用各种语言（Java、C++ 或 Python）。

.NET 端口可从[Marc Gravell](http://code.google.com/p/protobuf-net/)和[Jon Skeet](http://github.com/jskeet/dotnet-protobufs/tree/master)获得。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-12-20T09:39:47.603

我检查了所有提到的项目，如协议缓冲区、json、xml 等，但在找到[BSON](http://bsonspec.org/)后，我使用它是因为以下原因：

*   易于使用的 API
*   支持多种语言（C、C [++](http://bsonspec.org/#/implementation)、Haskell、Go、Erlang、Perl、PHP、Python、Ruby、C#，...）
*   二进制因此非常节省空间和快速（更少的字节->更少的时间）
*   在平台上保持一致（字节序没有问题等）
*   层次分明。数据模型可与 json 相媲美（顾名思义），因此大多数数据建模任务应该是可解决的。
*   无需预编译器
*   广泛使用（Mongodb，多种语言）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:53:18.143

C++ 没有结构内省（您无法在运行时找出类的字段），因此没有编写 C++ 对象的通用机制。您要么必须采用约定并使用代码生成，要么（更典型地）自己编写序列化。

有一些标准格式的库，例如 ASN.1、HDF5 等，它们是实现语言中立的。有用于相同目的的专有库（例如协议缓冲区）。

如果您的目标是特定的体系结构和编译器，那么您也可以将 C++ 对象转储为原始字节，并在 C# 端创建解析器。

更好的是取决于您希望端点的耦合程度，以及数据主要是数字（HDF5）、树和序列结构（ASN.1）还是简单的普通数据对象（直接将值写入内存）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T15:54:04.040

其他选择是：

*   以您需要的方式创建包含数据的二进制文件（不是一个简单且可移植的解决方案）

*   XML

*   YAML

*   纯文本文件

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T15:55:04.023

您可以选择很多选项。命名管道、共享内存、DDE、远程处理...取决于您的特殊需要。

快速谷歌搜索给出了以下内容：

[命名管道](http://www.codeproject.com/csharp/DotnetPipesPart1.asp)

[命名共享内存](http://www.dotnetconsult.co.uk/weblog/permalink.aspx/32c3abfb-bac9-4e19-bbc5-39ca338d906d)

[DDE](http://weblogs.asp.net/savanness/archive/2003/12/05/41595.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T15:55:29.030

[如前所述](https://stackoverflow.com/questions/726410/serialize-in-c-then-deserialize-in-c/726420#726420)，Protocol Buffers 是一个不错的选择。

如果该选项不适合您的需求，那么我会考虑将 XML 发送到客户端（您必须在消息前面加上长度，以便知道要阅读多少），然后使用 IXmlSerializer 的实现或使用将 DataContract/DataMember 属性与 DataContractSerializer 结合使用，以在 .NET 中获取您的表示形式。

我建议不要使用封送处理属性，因为它们不受`List<T>`您通常使用的许多其他标准 .NET 类的支持。

# ruby-on-rails - 为 JRuby 安装 hpricot

> ID：726412
> 
> 赞同：1
> 
> 时间：2009-04-07T15:46:17.617
> 
> 标签：ruby-on-rails, jruby, cucumber, webrat, hpricot

我正在尝试查看 Jruby on Rails 的黄瓜。其中一个先决条件是 webrat，它具有先决条件 hpricot。

我已经使用 hpricot 安装了 gem：

gem install hpricot --source [http://code.whytheluckystiff.net](http://code.whytheluckystiff.net) --version 0.6.1 --platform java

这将安装 hpricot 的 java 版本。我将 hpricot_scan.jar 添加到 CLASSPATH 但是当我运行时：

```
cucumber features -n 
```

我得到以下输出：

```
HpricotScanService.java:931:in `hpricot_scan': java.lang.NoSuchMethodError:
org.jruby.runtime.builtin.IRubyObject.getInstanceVariable(Ljava/lang/String;)Lorg/jruby/runtime/builtin/IRubyObject;
from HpricotScanService.java:1324:in `__hpricot_scan'
from null:-1:in `call'
from InvocationCallback.java:67:in `execute'
from FullFunctionCallbackMethod.java:69:in `call'
from DynamicMethod.java:243:in `call'
from CachingCallSite.java:283:in `cacheAndCall'
from CachingCallSite.java:121:in `callBlock' 
```

等等

如果我编译 HpricotScanService.java 文件并将生成的 .class 文件添加到类路径中，我会得到：

```
Then I should see "Run"
private method `scan' called for Hpricot:Module (NoMethodError)
features/step_definitions/webrat_steps.rb:94:in `/^I should see "([^\"]*)"$/'
features/manage_activity.feature:9:in `Then I should see "Run"' 
```

如果我尝试安装更高版本的 hpricot，那么我会得到：

```
ERROR: Failed to build gem native extension.
C:/Program Files/Ruby/jruby-1.2.0/bin/../bin/jruby.bat extconf.rb install hpricot --platform java
C:/Program Files/Ruby/jruby-1.2.0/bin/../lib/ruby/1.8/mkmf.rb:7: JRuby does not support native extensions. Check wiki.jruby.org for alternatives. (Not
ImplementedError)
from C:/Program Files/Ruby/jruby-1.2.0/bin/../lib/ruby/1.8/mkmf.rb:1:in `require'
from extconf.rb:1 
```

有没有人知道我做错了什么/没有做什么/我在哪里愚蠢。？

使用 Windows XP、JRuby 1.2.0

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T20:40:14.123

我不知道黄瓜，但 Hpricot 绝对可以从 JRuby 1.2.0 开始使用（尽管不是最新版本的 Hpricot）。您安装了哪个版本的 Hpricot？也许它与其他库不兼容？

以下命令对我有用：

```
jruby -S gem install hpricot --version '~>0.6.1' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-24T17:13:14.453

由于 Ola Bini 上个月重写了 hpricot jruby 支持，所以 hpricot 的[git head](http://github.com/whymirror/hpricot/)可以安装 jruby 了。只需下载头部，然后使用

```
jruby -S rake package_jruby
cd pkg
sudo jgem install ./hpricot-0.8.1-jruby.gem 
```

你应该是金色的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-19T18:48:29.027

仅供参考，JRuby 1.4 版现在支持 HPricot 0.7 版。

[http://jruby.org/2009/11/02/jruby-1-4-0.html](http://jruby.org/2009/11/02/jruby-1-4-0.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T01:51:26.227

HPricot 使用本机 C 扩展，它不符合 FFI。因此它不能在 JRuby 下使用。

# social-networking - 在 LAMP 上运行的企业 Intranet 中的社交网络软件

> ID：726415
> 
> 赞同：2
> 
> 时间：2009-04-07T15:47:17.097
> 
> 标签：social-networking, enterprise, community-server

我工作的公司（1800 多名员工）正在寻求加强员工之间的个人关系，促进部门之间更好的协作和沟通，并使人力资源部门更容易识别员工的技能、经验和兴趣（例如：我们有一些同事对 SAP 模块和产品有深入了解，但在具体项目中很难识别它们并集成它们）。因此，他们想为我们的 Intranet 实现一个社交网络。

我们只是在寻找基本功能，例如配置文件、讨论板等，所以没什么特别的。我提出了社区服务器，但我的老板说 .Net 和 java 是不行的。他想要 LAMP，但出于隐私和安全方面的考虑，他对 Ning 这样的网络解决方案不感兴趣。它是开源软件还是商业软件都没有关系。但它应该允许完整的布局定制，并且还必须能够从外部世界访问。

所以我的问题是，是否有类似社区服务器的东西在 LAMP 堆栈上运行？

非常感谢！

更新：我们已经有一个 Facebook 页面和一个群组。但是我的老板想要 Facebook 中没有的一些功能，例如每个个人资料页面中的标签云，显示技能和相关项目；以及 Last.FM 的“社区”等功能，您可以在其中将具有相似技能和兴趣的人分组，还有保密问题（关于项目、客户等的讨论）。那么，有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-15T17:01:00.770

您应该查看 StatusNet。[http://status.net/](http://status.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T16:24:29.723

它没有直接回答你的问题，但你不是更想重新发明轮子吗？

Facebook 已经关闭了社交网络，很可能你的 1800 名员工中有 95% 已经在使用它。

当您可以建立一个 Facebook 网络时，您为什么还要努力编写和支持产品以及要求您的员工在多个地方更新有关他们自己的信息。

我要说的另一点是，你为什么要从一开始就限制自己做事的一种方式。也许对哪些技术最适合您的目的进行详细分析会更合适。

我很感激这并没有回答你的问题，我只是觉得这是公司不愿意接受已经存在的工具的一个很好的例子，我怀疑是因为他们害怕它们。

我可能猜对了，您的公司会严格监控 Facebook 的使用情况，这就是为什么这也可能很难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-05T19:13:42.350

试试[Open Atrium](http://openatrium.com/)，一个基于 Drupal 的团队服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T02:42:25.463

您可能需要考虑[Drupal 之](http://drupal.org/)类的东西。从技术上讲，它是一个 CMS，但它非常可定制，并且有很多模块可以提供社交网络风格的功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T02:47:42.237

使用 Office Messenger 进行通信。它基本上类似于 MSN Messenger，但运行在公司的服务器上，因此他们可以监控所有流量。要知道谁在哪个领域有专长，构建自己的简单 CRUD 应用程序来记录员工的个人资料并为每个个人资料标记员工拥有的关键技能并构建搜索功能来查找人员并不难随时掌握所需的技能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T02:55:50.987

您可以使用 Facebook SDK（PHP、java 或任何其他语言）创建应用程序并对其进行审核，以便只有员工可以使用它。这样你就可以使用现有的 Facebook 功能并添加标签云和老板想要的其他东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T03:10:33.117

我没用过，但[Dolphin](http://www.boonex.com/products/dolphin/)可能值得下载试用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T16:30:33.313

某种 facebook 应用程序将允许您将数据保存在您管理的服务器上，但仍使用 facebook 的现有功能。可以肯定 facebook 使用 PHP 作为其应用程序框架。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-07T16:31:11.470

我同意 MrEdmundo 的观点，如果我注册了，我会支持他。不要成为“它不是在这里发明的”综合症的受害者。我敢打赌你的老板就像“我们需要*像 facebook*这样的东西”。

如果它让你感觉更好......这里有一个小故事：

我试图实现某种群聊，以便同事可以在线向彼此快速提问，而无需起床或是否有人在打电话等。但是，我安装的服务（某种 jabber 守护程序，我忘记了哪一个）从未真正被使用过。解决方案？只需安装 facebook 聊天客户端，因为无论如何所有同事都已经在 facebook 上！

另外，“网名”是合适的，因为它是我们的真实姓名，而不是“Out Into Space”、“theman”或“fly-mystikal-dj-69”之类的东西

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-23T18:15:52.010

elgg.org

LAMP 易于安装和设置，看起来您的要求都可以通过可用的官方插件轻松满足。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-02-24T06:28:58.517

另一种选择：[http ://buddypress.org/](http://buddypress.org/)

# c# - 如何让我的浏览器独一无二？

> ID：726423
> 
> 赞同：0
> 
> 时间：2009-04-07T15:49:00.230
> 
> 标签：c#, winforms, browser

我刚刚使用 c# 作为我的第一个编程项目之一制作了一个浏览器，它工作得很好，但它非常通用。我尝试在其上添加不同的工具，但它仍然非常简单，我最好使用 Firefox。有没有办法在浏览器上添加有用的应用程序和颜色。我想让它更加个性化，并添加一些使它独一无二的东西，不一定比其他所有东西都好。我这样做更多是为了练习，但我想给它添加一点闪光。如果我不是为了工作而做的，我还不如去追求风格点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T15:50:51.740

实现 HTML5 和 CSS3。所有的。那将是值得使用的。

现在从短期来看，我真正想要的是一个浏览器，它结合了 V8 JavaScript 引擎、WebKit 作为渲染引擎和 XPCOM 的灵活性（但没有它的臃肿）。我的意思是基本上跨平台的谷歌浏览器，接受 Firefox 扩展。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T15:51:39.053

我怀疑你会发现大多数真正有用的想法已经在主流浏览器中实现了。如果您想到一些尚未完成的非常简洁的*事情*，我认为如果您为/在主要浏览器中而不是在您自己的浏览器中实现它，那将对世界做出更有用的贡献。

我并不是要阻止你的目标——只是很多人已经长期认真地考虑过浏览器。做一些事情作为学习的途径是很棒的，但认为你会同时提出一个世界领先的新想法是不现实的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:04:57.633

[小猫、独角兽（大部分是粉红色的）和闪闪发光的标志会为我做这件事。](https://stackoverflow.com/questions/704353/the-fancy-and-amazing-april-fools-thread)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T16:11:36.183

如今，大多数浏览器都放弃了在功能上的竞争，现在在速度和稳定性方面展开了竞争。Safari 4（使用他们的 SquirrelFish / Nitro JavaScript 引擎）是自称“[世界上最快的浏览器](http://www.apple.com/safari/)”，Chrome 实现了他们的[V8](http://code.google.com/p/v8/) JavaScript 引擎，并且还为浏览器中的每个选项卡分离了进程。Firefox 3.5 显然提高了 JavaScript 性能以与 Safari 4 相媲美。

There are umpteen Gecko and WebKit browsers out there trying to come up with the next big idea, but bar Chrome, no browser has made significant (any?) impact on the web in the past few years.

# asp.net - 您如何使用 Excel 服务器端？

> ID：726432
> 
> 赞同：13
> 
> 时间：2009-04-07T15:50:57.650
> 
> 标签：asp.net, excel

客户希望“启用 Web”电子表格计算——用户指定某些单元格的值，然后在其他单元格中显示结果值。

（他们不想向用户显示“类似电子表格”的界面。这不是 UI 问题。）

他们有一个巨大的电子表格，其中有很多很多工作表上的大量计算。但是，最后，只有两件事很重要——（1）你将数字放在一张纸上的几个单元格中，以及（2）你从另一张纸上的几个单元格中得到相应的数字。其余部分是一个黑匣子。

我想向用户展示一个 UI 以输入他们想要的数字，然后我想以编程方式打开 Excel 文件，设置数字，告诉它重新计算，然后读出结果。

这可能/可取吗？是否有商业组件使这更容易？我没有考虑他们的陷阱吗？

（我知道我可以使用 Office 自动化来执行此操作，但我知道不建议在服务器端执行此操作，因为它会尝试在用户的上下文中运行等）

很多人说我需要在代码中重新创建公式。然而，这将是惊人的复杂。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T16:07:19.420

这是可能的，但不建议这样做（并且官方不支持）。

您可以通过 COM 或 .NET Primary Interop Assemblies 与 Excel 交互，但这是一个客户端进程。

在服务器端，没有可用的显示器或桌面，任何意外的对话框（例如）都会使您的 Web 应用程序挂起——您的应用程序将表现得不稳定。

此外，将 Excel 进程附加到每个请求并不完全是一种低资源方法。

解决黑匣子并用适当的编程语言重新实现它显然是更好的选择（如“更可靠和更快”）。

相关阅读：[KB257757：Office 服务器端自动化的注意事项](http://support.microsoft.com/kb/257757)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T18:29:22.840

您绝对不想在服务器端使用互操作，将它用作客户端的杂物已经够糟糕的了。

我可以看到两个选项：

弄清楚电子表格的逻辑。通过使业务逻辑成为已知数量，这可能会使您在长期内受益，并且在短期内您可能会发现电子表格中实际上存在错误（我遇到过使用多年的大量怪物电子表格，结果很简单它们中的错误 - 每个人都认为答案一定是正确的）

评估[SpreadSheetGear.NET](http://www.spreadsheetgear.com/)，它基本上是互操作的替代品，无需 Excel 即可完成所有操作（它在 .NET 中复制了大量 Excel 的非可视逻辑和 IO）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-07T15:55:20.947

尽管使用 ASP.NET 肯定可以做到这一点，但这是非常不可取的。它不可扩展并且容易出现并发错误。

最好的办法是分析电子表格计算并复制它们。现在，当然，您的企业不会喜欢这样做所需的时间，但它会（大概）为他们提供一个更可用的系统。

或者，您可以简单地将电子表格从您的网站提供给用户，在这种情况下，您几乎什么都不做。

**编辑：**如果您的利益相关者真的坚持使用 Excel 服务器端，我建议您按照[@John Saunders](https://stackoverflow.com/questions/726432/how-do-you-use-excel-server-side/726550#726550)的建议仔细研究 Excel Services。它可能无法为您提供所需的*一切*，但它会为您提供相当多的服务，并且应该可以解决您在尝试使用 ASP.NET 进行服务器端操作时最终会遇到的一些问题。

这并不是说它是灵丹妙药。您的里程肯定会有所不同。而且 Sharepoint 的购买或维护并不便宜。事实上，如果您采用 Sharepoint 路线，短期成本很容易与长期成本相形见绌——但它可能是满足要求的最佳选择。

我仍然建议您支持将所有逻辑编码在单独的 .NET 模块中。这样你就可以在服务器端*和*客户端使用它。Excel 可以轻松地将计算传递给 COM 对象，并且您可以非常轻松地将 .NET 库发布为 COM 对象。最后，您将拥有一个更易于维护和可用的架构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T16:08:36.110

忽略在服务器端操作 excel 表是否有意义的讨论，执行此操作的一种方法可能看起来像采用

Microsoft.Office.Interop.Excel.dll

使用这个库，您可以告诉 Excel 打开电子表格，更改和读取 .NET 中的内容。我在 WinForm 应用程序中使用了该库，我猜想它也可以从 ASP.NET 中使用。

尽管如此，考虑已经提到的并发问题......但是，如果不经常访问工作表，为什么不......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T16:16:37.510

最简单的方法可能是：

将 Excel 工作簿上传到 Google 文档——根据我的经验，这非常干净

使用 Google 电子表格数据 API 更新数据并返回数字。

如果您想朝那个方向发展，这里有一个链接可以帮助您开始：

[http://code.google.com/apis/spreadsheets/overview.html](http://code.google.com/apis/spreadsheets/overview.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T16:25:33.107

让我比其他人更坚定：不要在*服务器*端使用 Excel。它旨在用作桌面应用程序，这意味着它不打算用于随机不同的线程，可能一次使用多个线程。您最好编写自己的电子表格，而不是尝试使用 Excel（或任何其他 Office 桌面产品）形成服务器。

这是 Excel Services 存在的原因之一。在 MSDN 上快速搜索出现了这个链接：http: [//blogs.msdn.com/excel/archive/category/11361.aspx](http://blogs.msdn.com/excel/archive/category/11361.aspx)。这是一个类别列表，因此包含有关该主题的博客文章列表。另请参见[Microsoft.Office.Excel.Server.WebServices 命名空间](http://msdn.microsoft.com/en-us/library/microsoft.office.excel.server.webservices.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T15:54:34.600

听起来您在说用户在他们的本地系统上打开了电子表格，并且您想要一个网站来操作该本地电子表格？

如果是这样的话，你真的不能那样做。即使是办公自动化也无济于事，除非您想要求他们将工作表上传到服务器并下载新的更改版本。

您可以做的是创建一个 Web 服务来进行计算并将一些 vba 或 vsto 代码添加到 Excel 工作表中以与该服务通信。

# asp.net-mvc - ASP.NET MVC 中的 dateTime 对象

> ID：726433
> 
> 赞同：7
> 
> 时间：2009-04-07T15:51:30.787
> 
> 标签：asp.net-mvc, datetime

有没有人使用 MVC 中的模型绑定成功地将 2 个文本框绑定到一个 DateTime 属性，我尝试了 Scott 的方法[http://www.hanselman.com/blog/SplittingDateTimeUnitTestingASPNETMVCCustomModelBinders.aspx](http://www.hanselman.com/blog/SplittingDateTimeUnitTestingASPNETMVCCustomModelBinders.aspx)但不满意，因为这会停止 HTML 字段和具有相同的名称（因此如果验证失败，验证将无法设置正确的 css）。

我当前的尝试通过从 bindingcontext 中删除 ValueProviderResult 对象并为由日期结果和 tiem 组成的键添加一个新对象（使用 Scotts 帖子中的 .Time 约定）来修改这一点，但我有点担心搞砸直接使用 bindingContext 对象。

这个想法是，我可以使用 IDateErrorInfo 和 VAB PropertyComparisonValidator 来比较模型上的两个日期时间，其中一个需要晚于另一个，为此需要包含时间元素。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-03T20:47:56.540

我使用不同的方法并使用两组不同的模型：我的视图模型将具有两个属性和对这些字段的验证，而我的域模型将具有一个 DateTime。然后在绑定之后，我让视图模型更新域：

```
public ActionResult Update(DateInput date)
{
    if(date.IsValid)
    {
        var domain = someRepository.GetDomainObject(); // not exactly, but you get the idea.
        date.Update(domain);
    }
    // ...
}

public class DateInput
{
    public string Date { get; set; }
    public string Time { get; set; }

    public void Update(DomainObject domain) { ... }
}

public class DomainObject
{
    public DateTime SomePointInTime { get; set; }
} 
```

# c# - 强制枚举以获取与之关联的值？

> ID：726446
> 
> 赞同：0
> 
> 时间：2009-04-07T15:54:49.857
> 
> 标签：c#, enumeration

我有一个像这样的枚举：

```
public enum BlahType
{
    blahA = 1,
    blahB = 2,
    blahC = 3
} 
```

如果我有一个值为“blahB”的字符串，是否可以将其与枚举 BlahType 进行强制转换以获得值 2？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T15:59:01.593

利用：

```
BlahType yourEnumValue = (BlahType) Enum.Parse(typeof(BlahType), "blahB"); 
```

接着

```
int yourIntValue = (int) yourEnumValue; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:56:50.397

您可以使用[Enum.Parse](http://msdn.microsoft.com/en-us/library/essfb559.aspx)方法，然后强制转换为 int。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:00:30.453

```
enum test
{
   VAL1,
   VAL2
}

static void Main(string[] args)
{
   test newTest = (test)Enum.Parse(typeof(test), "VAL2");
   Console.WriteLine(newTest.ToString());
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T15:59:35.057

```
public void EnumInstanceFromString()
{

 DayOfWeek wednesday = (DayOfWeek)Enum.Parse(typeof(DayOfWeek), "Wednesday");
 DayOfWeek sunday = (DayOfWeek)Enum.Parse(typeof(DayOfWeek), "sunday", true);
 DayOfWeek tgif = (DayOfWeek)Enum.Parse(typeof(DayOfWeek), "FRIDAY", true);

 lblOutput.Text = wednesday.ToString() +
                  ".  Int value = " + 
                  (int)wednesday).ToString() + "<br>";

 lblOutput.Text += sunday.ToString() + 
                   ".  Int value = " + 
                   ((int)sunday).ToString() + "<br>";

 lblOutput.Text += tgif.ToString() + 
                   ".  Int value = " + 
                   ((int)tgif).ToString() + "<br>";

 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T16:02:34.580

使用此代码...

```
BlahType blah = Enum.Parse(typeof(BlahType), "blahB"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T16:14:51.510

如上所述，您希望使用的其他一些人：

```
 BlahType myEnum = (BlahType)Enum.Parse(typeof(BlahType), "blahB");
        int myEnumValue = (int)myEnum; 
```

# sql - 使用 SQL Server CE；仅在不存在时才可以插入？

> ID：726448
> 
> 赞同：2
> 
> 时间：2009-04-07T15:55:09.357
> 
> 标签：sql, tsql, sql-server-ce

我正在尝试验证一个简单的 1 字段表，以确定在插入重复项之前是否存在记录。

```
if not exists (select * from url where url = ...)
insert into url... 
```

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T16:04:08.680

您的代码示例将在完整版 SQL 中运行，或者您可以重新排列为以下内容：

```
insert into url
select 'myvalue'
where not exists (select * from url where url = 'myvalue') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-30T07:54:02.443

您可能想阅读此线程。[在 sql-server-compact-edition 上执行插入或更新 upsert](https://stackoverflow.com/questions/728373/performing-insert-or-update-upsert-on-sql-server-compact-edition/1062302#1062302)

简而言之，一个特定于 sqlce 的解决方案（使用 SqlCeResultSet）将提供最大的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T16:03:33.113

只需将其反转并将条件添加为 where 子句谓词

```
 Insert Into Table .... 
  Where Not Exists 
 (Select * From table where ...) 
```

...但是您的基本问题听起来可能可以通过在插入表上放置一个备用键（唯一）约束来更好地解决，引用 url 列（我假设 Sql CE 有参照完整性（RI）约束？）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-25T14:03:49.687

使用外部联接

Insert into X(...) select blah, blah, blah from table t left outer join X on t.id=x.id where x.id is null

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-20T05:22:57.877

诚然，这已经过了发布日期，但由于我没有在我的快速谷歌搜索中看到这个答案，我想我会分享我是如何用 SQL CE 解决这个问题的，这样其他搜索可能会找到答案。

> -- 更新现有记录的值
> UPDATE myTable
> SET myValue = 'Hello World'
> WHERE keyField = 'MyKey';
> 
> -- 如果现有记录不存在则插入新记录`
> 
> INSERT INTO myTable (keyField, myValue)
> SELECT I.keyField, I.myValue
> FROM (
> SELECT 'Hello World' AS myValue, 'MyKey' AS keyField
> ) I
> LEFT JOIN myTable T ON I.keyField = T.keyField
> WHERE T.keyField无效的;

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-07T18:05:44.333

如果不存在，您将走在正确的道路上。使用 IF NOT EXISTS() 或 IF EXISTS() 比使用 Sub Query 更好，因为当 SQL Server 找到与您要查找的 EXISTS() 条件匹配的第一个实例时，SQL Server 将停止扫描表中的行。使用上面示例中编写的子查询，它将扫描整个表。

一个经典的例子是插入或更新，也就是保存。

```
IF EXISTS(SELECT * FROM Table_A WHERE Column_1 = @Parameter)
BEGIN
    --Update Statement here.
END
ELSE
BEGIN
    --Insert Statement here.
END 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-06-25T00:45:35.883

像这样的东西怎么样：

```
UPDATE Table1 SET (...) WHERE Column1='SomeValue'
IF @@ROWCOUNT=0
    INSERT INTO Table1 VALUES (...) 
```

[资源](http://blogs.msdn.com/miah/archive/2008/02/17/sql-if-exists-update-else-insert.aspx)

# python - 在 mac 上使用 readline 安装 ipython

> ID：726449
> 
> 赞同：17
> 
> 时间：2009-04-07T15:55:16.237
> 
> 标签：python, macos, readline, ipython

我在 Mac OS 10.5 和 python 2.5.1 上使用 ipython（我实际上想将 ipython 用于 2.6.1，但它似乎不可用？）

我通过easy_install安装了ipython。它可以工作，但缺少 gnu readline（需要使用 ctrl-R 等很好地搜索命令行历史记录）

我发现一篇[博客文章](http://www.brianberliner.com/2008/04/18/ipython-on-mac-os-x-105-leopard/)和其他消息来源说这可以通过

`sudo easy_install -f http://ipython.scipy.org/dist/ readline`

但是，这会导致构建错误`readline.c`，尤其是未声明的函数，例如`rl_compentry_func_t`和`rl_catch_signals`。

有没有人看到这些错误？是否有另一种方法可以使用 readline 安装 ipython？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-12-03T14:43:38.700

要在不使用 MacPorts 的情况下在 Snow Leopard 或 Lion 上安装 ipython，您可以简单地执行以下操作：

```
sudo easy_install readline ipython 
```

（注意如果你使用“pip”安装readline，那么ipython就看不到readline库，不知道为什么）。

*编辑：*

如果你安装了 ipython 删除它

```
sudo pip uninstall ipython 
```

或者

```
pip uninstall ipython #for virtualenvs 
```

然后确保你已经先安装了 readline 并重新安装了 iptyhon

```
pip install readline ipython 
```

由于某些原因，如果在安装过程中不存在 readline，它将在不支持 readline 的情况下自行安装，或者使用默认的 mac readline。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-01-05T20:09:03.127

这对我有用（我使用的是 python 2.7，对于其他版本，您需要编辑）：

```
cd /System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload
sudo mv readline.so readline.so.bak 
```

随心所欲地安装 readline（pip、自制软件、macports 等）

```
pip install -U readline 
```

成功！它适用于 virtualenv 和 virtualenvwrapper，无需修改 ipython :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T16:46:17.660

您可以使用 MacPorts 基本上通过一个命令来安装所需的一切。[首先从http://www.macports.org/](http://www.macports.org/)下载并安装 MacPorts 。

然后只需在终端中执行以下操作：1）sudo port -v selfupdate
2）sudo port -v install py26-ipython

这将为您安装 python2.6、python 2.6 的 ipython 和 readline。启动 ipython 的命令将位于 /opt/local/bin/ipython2.6

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-02-05T18:25:23.293

MacOS Mavericks 的唯一工作方式是：

1.  切换到您的虚拟环境`workon myproject_name`
2.  删除 readline 和 ipython（如果你之前安装过）`pip uninstall readline ipython`
3.  仅通过 easy_install 安装 readline（pip - 没用！）`easy_install readline`
4.  最后用 pip 安装 ipython`pip install ipython`

它在我的 MacOS 上运行良好并且经过了很长时间的测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-19T16:54:38.047

如果您不想使用端口，则可以选择。**警告：这不是升级安全的。**

`ipython`正常安装`readline`：

```
sudo easy_install -f http://ipython.scipy.org/dist/ readline ipython 
```

找到你的`readline`鸡蛋的完整路径。对于 python 2.6，这可能是：

```
/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/site-packages/readline-2.5.1-py2.6-macosx-10.3-fat.egg 
```

`ipython`使用您喜欢的文本编辑器进行编辑：

```
vim `which ipython` 
```

在文件的最后一行之前`sys.exit`，插入：

```
sys.path.insert(0,'PATH_TO_READLINE_EGG') 
```

保存并退出 ( `:wq`)。

检查 readline 是否正常工作：

```
ipython 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T20:51:21.173

“我实际上想将 ipython 用于 2.6.1”

它是可用的。我在 os x 上将它与 2.6.1 一起使用。你只需要安装官方的python 2.6.1 发行版，然后使用easy_install 安装ipython。

# .net - 将 Linq 支持添加到 Web 项目。编译器扼流圈

> ID：726455
> 
> 赞同：1
> 
> 时间：2009-04-07T15:56:20.883
> 
> 标签：.net, asp.net, linq

我添加了对`System.Core`程序集的引用。现在`web.config`有：

```
<add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/> 
```

IIS 设置为使用 ASP.NET 版本 2.0.50727

虽然智能感知显示了扩展方法，但编译器不理解 linq 语法。我可以在解决方案的其他类库中使用 Linq。

我该如何解决？

**编辑：我在 web.config 中已经有以下内容

```
<system.web>
 <compilation
    <assemblies>
    <!-- references here //-->
    </assemblies>
      <compilers>
        <compiler language="c#" type="Microsoft.CSharp.CSharpCodeProvider, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" extension=".cs" compilerOptions="/d:DEBUG;TRACE" />
      </compilers>
    </compilation>
</system.web> 
```

我没有`<system.codedom>`节点。这是一个从 1.x 迁移到 2.x 到 3.5 的项目。我是否`<compilers>`从 中删除 并将其添加到`<system.codedom>`？

请注意，我想做最小的更改以使其正常工作，因为这是一个大型企业项目（我不想过多地弄乱 web.config）**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T16:01:22.430

只需添加程序集就会创建一个引用，但您必须指定您正在使用的编译器版本。

您需要更新`<system.codedom>`web.config 文件中的元素：

```
<system.codedom>
  <compilers>
    <compiler language="c#;cs;csharp" extension=".cs" warningLevel="4"
      type="Microsoft.CSharp.CSharpCodeProvider, System, Version=2.0.0.0,
      Culture=neutral, PublicKeyToken=b77a5c561934e089">
      <providerOption name="CompilerVersion" value="v3.5" />
      <providerOption name="WarnAsError" value="false" />
    </compiler>
  </compilers>
</system.codedom> 
```

您必须确保在`<compiler>`元素中的重要部分是这个子元素：

```
<providerOption name="CompilerVersion" value="v3.5" /> 
```

这可确保您使用的是 v3.5 的 C# 编译器。

根据文档，该`<system.codedom>`元素是该元素的子`<configuration>`元素：

[http://msdn.microsoft.com/en-us/library/k6bttwes.aspx](http://msdn.microsoft.com/en-us/library/k6bttwes.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T16:19:10.703

使用 Web 应用程序项目而不是网站不会出现此问题（供参考），因为它将代码构建到 DLL 中。

# c++ - 运算符 == 的 C++ 模板类错误

> ID：726456
> 
> 赞同：5
> 
> 时间：2009-04-07T15:56:24.113
> 
> 标签：c++, operators, equals-operator

错误：
错误 C2678：二进制“==”：未找到采用“const entry”类型的左侧操作数的运算符（或没有可接受的转换）

功能：

```
template <class T, int maxSize>
int indexList<T, maxSize>::search(const T& target) const
{
    for (int i = 0; i < maxSize; i++)  
        if (elements[i] == target)   //ERROR???
            return i;       // target found at position i

    // target not found
    return -1;
} 
```

[indexList.h](http://www2.cs.uregina.ca/%7Emouhoubm/=teaching/=cs170/=indexList/indexList.h)
[indexList.cpp](http://www2.cs.uregina.ca/%7Emouhoubm/=teaching/=cs170/=indexList/indexList.cpp)

这假设是一个重载的运算符吗？作为一个模板类，我不确定我是否理解错误？

解决方案- 类中的重载函数现在声明为 const：

```
//Operators
bool entry::operator == (const entry& dE)  const <--
{
    return (name ==dE.name);

} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T16:06:59.127

首先完全按原样阅读错误文本：

> 二进制 '==' ：没有找到接受“const entry”类型的左操作数的运算符

这意味着它找不到任何`==`接受`entry`类型作为其左操作数的运算符。此代码无效：

```
entry const e;
if (e == foo) 
```

您已经向我们展示了您的列表类的代码，但这不是错误所在。该错误是关于缺少该`entry`类型的运算符，无论是什么。要么给类一个`operator==`函数，要么声明一个`operator==`接受 a`const entry&`作为其第一个参数的独立函数。

```
struct entry {
  bool operator==(const entry& other) const;
};
// or
bool operator==(const entry& lhs, const entry& rhs); 
```

我认为后者是首选风格。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T16:01:30.310

问题是指在此实例中使用的类型 T 没有定义 operator==。我从你的问题中猜想这是一个类“条目”。

也可能是 'entry' 类没有正确定义 operator== 以将 const entry& 作为参数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T16:02:17.547

这很可能是“`const`中毒”，您`const`在搜索函数声明中的使用将迫使您添加`const`您调用的所有下游函数的版本。

在声明的函数`const`中，`this`会考虑指针`const`，这意味着您通过该指针使用的所有成员也会被考虑`const`。如果您`operator == ()`对任何类型的 T 进行专门研究没有明确指定`const`参数，您将收到此错误。

如果您不能确保您使用的所有 T 都会有正确的`operator == ()`调用，我会删除成员函数模板上的 const 说明符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T16:02:45.703

您用作此类参数的类型 T 应该有一个，`operator==()`因为您提供的代码不包含模板的实例化，因此很难知道出了什么问题。

另一方面，模板的函数定义应与类一起在 .h 文件中，否则编译器将无法正确实例化它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T16:05:06.040

默认情况下未定义用户定义类型的相等运算符。这与您的模板类没有任何关系，而是您的`struct`或`class`“条目”。

因此，您必须覆盖`struct entry`or中的相等运算符`class entry`。

或者，如果您不想强制使用该模板的所有内容定义相等运算符，则可以修改模板接口以接受进行相等比较的 Comparator。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T16:44:57.910

有时候写就够了

```
...
    if (target == elements[i])
... 
```

# java - 如何实现 RMI 连接、J2EE 服务的通用测试？

> ID：726460
> 
> 赞同：1
> 
> 时间：2009-04-07T15:57:34.343
> 
> 标签：java, jakarta-ee, rmi

我想实现一个小测试来检查通过 RMI 与 J2EE 服务的连接。它需要是通用的，这样我就可以给它一个属性文件，其中设置了以下属性：

```
    java.naming.factory.initial=oracle.j2ee.rmi.RMIInitialContextFactory
    java.naming.security.principal=用户
    java.naming.security.credentials=pass
    java.naming.provider.url=ormi://hostname:port/application

```

检查端口是不够的，因为其他应用程序可以成功部署在服务器上。我不能假设我们环境中的所有应用程序都具有默认方法（如 ping 方法）的默认服务，这会使它更容易。

有没有我可以使用 java.naming.provider.url 执行的标准测试？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T11:06:14.720

我选择了一种不像我想要的那样通用但有效的方法。

因为所有服务都部署在一个 Oracle OAS 上，所以我可以执行 opmnctl 来获取容器和所有应用程序的状态。不漂亮，但它的工作。

# wpf - WPF 在 xaml 中使用资源变量

> ID：726464
> 
> 赞同：2
> 
> 时间：2009-04-07T15:59:37.490
> 
> 标签：wpf, resources

我的 App.xaml 中有一个全局字符串，我想在 UserControl xaml 中使用如何引用它？

```
<Application.Resources>
   <sys:String x:Key="Assembly">Zpg</sys:String>
</Application.Resources> 
```

我在 UserControl 资源中也有一个变量，我是否在 xaml 中以类似的方式使用它？

```
<UserControl.Resources>
    <sys:String x:Key="Dictionary">Test</sys:String>
</UserControl.Resources> 
```

我希望这是有道理的，基本上我有以下我想参考上面的变量来替换，因为我会经常使用它们。

```
Text="{LocText Key=MyString, Dict=Test, Assembly=Zpg}" 
```

谢谢，

詹姆士

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:22:41.770

```
Text="{LocText Key=MyString, Dict={StaticResource Dictionary}, Assembly={StaticResource Assembly}}" 
```

# ruby-on-rails - 如何在 Rails 中为订单提供送货地址和帐单地址

> ID：726468
> 
> 赞同：3
> 
> 时间：2009-04-07T16:00:47.753
> 
> 标签：ruby-on-rails, e-commerce, modeling

在我的在线商店中，每个订单都与一个送货地址和一个账单地址相关联（当然，它们可以相同）。这是我第一次尝试对此建模：

```
Class Order
  belongs_to :billing_address, :class => "Address"
  belongs_to :shipping_address, :class => "Address" 
```

这工作得很好，但现在表单助手不起作用。即，`form_for`只会生成名称类似的字段`address[zipcode]`，所以我必须手动破解它来获取`billing_address[zipcode]`和`shipping_address[zipcode]`。

我想我可以使用单表继承将子类`Address`化为`ShippingAddress`and `BillingAddress`，但这对我来说似乎有点 hacky（并且与[建模 Customer <--> Address 的最佳方式中的](https://stackoverflow.com/questions/648463/best-way-to-model-customer-address)一些好的答案相矛盾）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T21:13:48.797

您需要指定类名，因为它不是 BillingAddress 或 ShippingAddress。

```
class Order < ActiveRecord::Base
  # foreign key not required here because it will look for
  # association_name_id, e.g. billing_address_id, shipping_address_id
  belongs_to :billing_address, :class_name => "Address"
  belongs_to :shipping_address, :class_name => "Address"
end 
```

要完成关联：

```
class Address < ActiveRecord::Base
  # foreign key required here because it will look for class_name_id, 
  # e.g. address_id
  has_many :billing_orders, :class_name => "Order", 
    :foreign_key => "billing_address_id" 
  has_many :shipping_orders, :class_name => "Order", 
    :foreign_key => "shipping_address_id"
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T19:46:35.353

我有两个想法给你，其中一个或两个都可以解决问题：

```
Class Order
  belongs_to :billing_address, :class_name => "Address"
  belongs_to :shipping_address, :class_name => "Address"

Class Order
  belongs_to :address, :foreign_key => "billing_address_id"
  belongs_to :address, :foreign_key => "shipping_address_id" 
```

请与您的表单助手一起尝试一下，我很想知道它是否适合您。希望能帮助到你！

# mmap - 内存映射文件可以有多大？

> ID：726471
> 
> 赞同：27
> 
> 时间：2009-04-07T16:01:27.347
> 
> 标签：mmap, memory-mapped-files

什么限制了内存映射文件的大小？我知道它不能大于未分配地址空间的最大连续块，并且应该有足够的可用磁盘空间。但是还有其他限制吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-07T16:17:09.053

您太保守了：内存映射文件可能大于地址空间。内存映射文件的**视图**受到操作系统内存限制的限制，但这只是您一次查看的文件的一部分。（而且我想从技术上讲，您可以一次映射文件不连续部分的多个视图，因此除了开销和页面长度限制之外，只有您正在查看的总字节数构成了限制。您可以查看字节[0 到 1024] 和字节 [2 ^(40)到 2 ^(40) + 1024] 有两个单独的视图。）

在 MS Windows 中，查看[MapViewOfFile](http://msdn.microsoft.com/en-us/library/aa366761(VS.85).aspx)函数。它有效地采用 64 位文件偏移量和 32 位长度。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-10-27T10:09:46.897

这是我在 Win32 下使用内存映射文件时的经验：

如果您将整个文件映射到一个段中，它通常会在 750 MB 左右敲出，因为它找不到更大的连续内存块。如果你把它分成更小的部分，比如每个 100MB，你可以获得大约 1500MB-1800MB，具体取决于正在运行的其他内容。

如果您使用[/3g 开关](http://msdn.microsoft.com/en-us/library/ms791558.aspx)，您可以获得超过 2GB 到大约 2700MB，但操作系统性能会受到影响。

我不确定 64 位，我从未尝试过，但我认为最大文件大小仅受您拥有的物理内存量的限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:12:21.657

在 Windows 下：“文件视图的大小仅限于最大可用的未保留虚拟内存的连续块。这最多 2 GB 减去进程已保留的虚拟内存。”

来自[MDSN](http://msdn.microsoft.com/en-us/library/aa366542(VS.85).aspx)。

我不确定 LINUX/OSX/Whatever Else，但它可能也与地址空间有关。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-06-03T10:41:39.003

在 64 位 Windows 系统上，虚拟地址空间的限制为 >16 TB。这里讨论的问题很可能与混合 DWORD 和 SIZE_T 有关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T16:08:51.273

不应有其他限制。这些还不够吗？;-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-09T17:55:23.067

是的，内存映射文件是有限制的。最令人震惊的是：

> 在 32 位系统上，内存映射文件不能大于 2GB。
> 
> 当 memmap 导致创建或扩展文件超出文件系统中的当前大小时，未指定新部分的内容。在具有 POSIX 文件系统语义的系统上，扩展部分将用零字节填充。

即使在我的 64 位、32GB RAM 系统上，如果我尝试读取一个大的 numpy 内存映射文件而不是使用字节偏移量获取其中的一部分，我也会收到以下错误：

`Overflow Error: memory mapped size must be positive`

使用大数据集真的很痛苦。

# php - MySQL Query 为我正在制作的论坛创建一个“bump-system”

> ID：726472
> 
> 赞同：1
> 
> 时间：2009-04-07T16:01:28.657
> 
> 标签：php, mysql, inner-join

我无法形成执行以下操作的 MySQL 查询：

从线程表中选择所有线程ID，按最新帖子（最大时间戳）的时间戳（按降序排列）排序，其中threadID等于每个线程的threadID。所以基本上我想通过线程并让MySQL检查数据库，比如说线程0。然后它检查所有threadID为0的帖子，并根据thread0内帖子的最大时间戳对thread0进行排序。然后它对线程 1、线程 2 等重复此操作并相应地对它们进行排序。

这甚至可能吗？就是为了创造论坛的“bump-system”效果，最近活跃的帖子不断地被顶到列表的顶部，直到帖子消失，然后下降到底部。我曾经使用不同的实现，我将 lastActivity 时间戳存储在线程表中，并在将新帖子提交到线程时更新它，但是这个查询会使事情变得更有效率。

非常感谢！这里有两个相关的表：线程和帖子。这些帖子有一个 threadID 字段，用于存储它所属的线程的 ID，它还有一个时间戳字段。Threads 有一个字段 threadID 对应于帖子的 threadID。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:05:53.340

```
SELECT  *
FROM    threads t
LEFT JOIN
        posts p
ON      p.id =
        (
        SELECT  p.id
        FROM    posts pi
        WHERE   pi.threadID = t.threadID
        ORDER BY
                pi.timestamp DESC
        LIMIT 1
        ) 
```

启用索引`posts (threadID, timestamp)`将大大改善此查询。

请注意，与`GROUP BY`解决方案不同，`posts`即使您在最新的`posts.timestamp`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T16:05:58.927

以下内容过去在 MySql 上为我工作过。如果您想在查询中包含有关每个线程的更多信息，则必须将列添加到`SELECT`和`GROUP BY`。

```
select thread.threadID, max(comments.modifiedOn) as threadUpdated 
   from thread inner join comments on thread.threadID = comments.threadID 
   group by 1 
   order by 2 desc; 
```

此查询服务于您的主要请求，这是我最近评论排序的线程列表。它不会按原样返回没有注释的线程，您需要将连接更改为外部连接才能做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:25:38.330

```
SELECT t.*, p1.`timestamp`
FROM threads t 
  JOIN posts p1 ON (p1.threadid = t.id)
  LEFT JOIN posts p2 ON (p2.threadid = t.id 
    AND p1.`timestamp` < p2.`timestamp`)
WHERE p2.threadid IS NULL
ORDER BY p1.`timestamp` DESC; 
```

# delphi - 如何使用 Win32 调试 API 实现代码覆盖工具

> ID：726476
> 
> 赞同：2
> 
> 时间：2009-04-07T16:02:23.567
> 
> 标签：delphi, winapi

我试图了解如何使用 Win32 调试 API 实现代码覆盖率工具。

我的想法是利用[Win32 调试 API](http://msdn.microsoft.com/en-us/library/ms809754.aspx)在调试模式下启动进程 - 并跟踪已执行的 CPU 指令。在跟踪所有 CPU 指令后，我将使用映射文件将其映射到执行的源代码行。

据我了解，有两种方法可以知道 CPU 指令正在执行。

1.  将以调试模式启动进程 - 将所有线程设置为单步模式，并让调试应用记录所有已执行的指令

2.  将是一种更智能的方法，您将更多地了解 x86 指令，并基本上用断点替换下一条分支指令。然后跟踪两个断点之间的增量指令。

**更新 - 受迈克尔回应启发的新建议方法：**

3.  从映射文件开始，在每一行的开头插入断点，让调试框架在每次断点命中时得到通知。

4.  从映射文件开始 - 二进制工具插入在每个源代码行的入口处调用的“钩子” - 避免通过调试器框架进行回调。

5.  使用 VM 技术 - 例如 VMware 来找出特定进程中执行了哪些指令 - 我不完全理解这种方法......

有人可以验证上述方法之一，或者建议替代方法 - 请注意，用例是逐行代码覆盖而不是性能分析 - 因此我们需要知道是否访问了每个单独的源代码行。

我的主要目标（虽然没有具体的计划......）主要是为 Delphi 创建一个简单的代码覆盖工具。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:28:55.640

一种方法是挂钩所有 api 调用和函数调用以与从源生成的表进行比较。因此，您会发现所涵盖的内容。
hooking的api有很多，一种是[Trappola API hooking](http://www.nektra.com/products/deviare/trappola/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-26T09:33:23.697

我会建议，而不是钩住每一行代码，你可以去每个块。我的意思是说代码块的钩子。它会更快，您也可以从块数中获得行数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:47:15.237

这可以工作 - 每个单步事件都会创建一个异常，您可以在执行代码行的映射中记录命中的 IP 地址。

不幸的是，我想这会非常缓慢。这将是非常低效的，因为每一行代码都会导致 1000 倍的工作量增加，因为会生成、捕获异常、将消息发送到调试器，然后在记录命中后往返返回。尝试为每个覆盖的行设置断点并在它们被命中后清除它们可能会更好。那会更快，但很可能仍然很慢。

核心问题是您试图将调试器用作它不适合的代码覆盖工具。快速搜索显示 Internet 上的几个 Delphi 代码覆盖工具。

# c# - 为什么即使绑定的属性没有改变，绑定也会触发？

> ID：726480
> 
> 赞同：2
> 
> 时间：2009-04-07T16:03:23.143
> 
> 标签：c#, winforms, event-handling

使用下面的代码，我得到`Firing C Binding`消息和`Firing F Binding`消息。这是为什么？我希望只收到`Firing C Binding`消息。

```
class Program : Form
{
    private Label lblC;
    private Label lblF;
    private Button btnCUp;
    private Temp t;

    public Program()
    {
        lblC = new Label();
        lblF = new Label();
        btnCUp = new Button();
        t = new Temp();

        lblC.Location = new Point(22, 21);
        lblC.Size = new Size(35, 13);
        Binding b = new Binding("Text", t, "C");
        b.Format += new ConvertEventHandler(CLabelFormat);
        lblC.DataBindings.Add(b);

        lblF.Location = new Point(108, 21);
        lblF.Size = new Size(35, 13);
        Binding b2 = new Binding("Text", t, "F");
        b2.Format += new ConvertEventHandler(FLabelFormat);
        lblF.DataBindings.Add(b2);

        btnCUp.Location = new Point(45, 55);
        btnCUp.Text = "C Up";
        btnCUp.Click += new EventHandler(btnCUp_Click);

        this.ClientSize = new Size(165, 113);
        this.Controls.Add(lblC);
        this.Controls.Add(lblF);
        this.Controls.Add(btnCUp);
    }

    private void CLabelFormat(object sender, ConvertEventArgs cevent)
    {
        MessageBox.Show("Firing C Binding");
    }

    private void FLabelFormat(object sender, ConvertEventArgs cevent)
    {
        MessageBox.Show("Firing F Binding");
    }

    [STAThread]
    public static void Main()
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new Program());
    }

    private void btnCUp_Click(object sender, EventArgs e)
    {
        t.incC();
    }
}

class Temp : INotifyPropertyChanged
{
    private double tempC;
    private double tempF;

    public event PropertyChangedEventHandler PropertyChanged;

    public Temp()
    {
        tempC = 0;
        tempF = ctof(tempC);
    }

    private void NotifyPropertyChanged(String field)
    {
        if (PropertyChanged != null)
        {
            PropertyChanged(this, new PropertyChangedEventArgs(field));
        }
    }

    private double ctof(double c)
    {
        return c * 9.0 / 5.0 + 32;
    }

    public void incC()
    {
        ++tempC;
        tempF = ctof(tempC);
        NotifyPropertyChanged("C");
        //NotifyPropertyChanged("F");
    }

    public double C
    {
        get { return tempC; }
    }

    public double F
    {
        get { return tempF; }
    }
} 
```

如果我删除前面的评论`NotifyPropertyChanged("F")`，那么当我按下按钮时，我会得到四个消息框。两个用于“触发 C 绑定”，两个用于“触发 F 绑定”。

如何修改代码以仅获取其中一个？

* * *

**编辑：**我试图查看 Binding 的源（使用反射器），以查看触发 PropertyChanged 事件时它的作用，但找不到任何东西。谁能提供一些见解？我想确认它关心更改了哪些字段。

**编辑：**用演示问题的完整可编译示例实现替换了我的代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-06-27T14:44:37.940

PropertyChanged 事件仅触发一次，您可以自行测试：

```
t.PropertyChanged += t_PropertyChanged;

void t_PropertyChanged(object sender, PropertyChangedEventArgs e) {
  MessageBox.Show("Property Changed: " + e.PropertyName);
} 
```

[Binding Format](http://msdn.microsoft.com/en-us/library/system.windows.forms.binding.format.aspx)事件是另外一回事：

> 只要 BindingManagerBase 的 Current 值发生变化，就会发生 Format 事件，其中包括：
> 
> *   第一次绑定属性。
>     
> *   任何时候位置发生变化。
>     
> *   每当对数据绑定列表进行排序或过滤时，这在 DataView 提供列表时完成。

因此，只要当前值的属性发生变化，就会触发 Format 事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T16:48:44.500

我假设当一个属性发生变化时，它表明它可能对另一个属性产生了影响，从而导致该属性也触发更新。很多时候，即使对象没有更改，属性更改事件也会触发，因为开发人员不想实际检查更改，因此只是在它可能已更改的情况下触发事件。我的直觉表明这可能是你正在经历的。

但是，也可能是侦听 PropertyChanged 事件的任何东西实际上都没有检查已更改的属性的名称。这也会导致同样的问题。

# jquery - Rails 中不显眼的 jQuery 自动完成功能

> ID：726485
> 
> 赞同：13
> 
> 时间：2009-04-07T16:04:41.970
> 
> 标签：jquery, ruby-on-rails, unobtrusive-javascript

我正在使用 rails，但是在`application.js`.

不幸的是，这使得引用 URL 变得非常困难。例如，如果我想给一个字段自动完成行为，我必须硬编码自动完成 URL，`application.js`因为 rails`url_for`不可用。

可以`application.js`用erb吗？我在想这个错误的方式吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T23:55:55.633

如果您不介意可能无法通过验证器的标记，则可以将 url 添加到表单或表单字段的属性中，然后使用 jQuery 获取该属性。

看起来 Rails 3.0 可能会使用 HTML5 自定义数据属性的 javascript 助手沿着这条路线走：[DHH @ Railsconf 09](http://railsconf.blip.tv/file/2081411/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T16:20:54.227

是的，有可能，在当前的 rails 版本上，只需调用您的文件`application.js.erb`；在旧版本上，您可以自己滚动或抓取类似的[东西](http://embeddedjs.com/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T14:41:40.177

不要这样做`application.js.erb`，即使涉及缓存，这也不是一个好习惯。使您的自动完成端点（您从中获取数据的 url）与表单的操作 url 相同。在你`application.js`只是附加`&ac=1`到它并让你的控制器理解它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-11T14:16:46.910

您不必对其进行硬编码 - 只需创建一个添加自动完成侦听器并接受自动完成参数的 JS 函数，然后从模板中调用该 JS 函数：

*（为清楚起见简化了代码）*

应用程序.js：

```
function add_autocomplete(id, url) {
   $("#" + id).autocomplete(
      source: url  
   );
}; 
```

application_helper.rb：

```
def add_autocomplete(id, url)
  render :text => "<script> add_autocomplete('#{id}', '#{url}');</script>"
end 
```

ERb 模板：

```
<input id="i_want_autocomplete" />
<%= add_autocomplete("i_want_autocomplete", items_js_path() %> 
```

# html - 如何停止搜索引擎索引维护页面

> ID：726491
> 
> 赞同：5
> 
> 时间：2009-04-07T16:06:29.440
> 
> 标签：html, apache, metadata, header, robot

我需要为我正在运行的网站设置一个维护页面，例如在我执行站点维护（计划停机时间）时显示，或者如果确实出现问题并且我需要建立一个保留页面。

我需要做些什么特别的事情来确保搜索引擎爬虫不会将其编入索引并认为它是我的网站。或者我应该做一个 404，添加一个临时 robots.txt 文件还是什么？我基本上不希望他们将它作为我的站点进行索引，但我也不希望他们认为我的站点已经死了并且不会回来。

**编辑：**这是我在 Apache 中所做的：ErrorDocument 503 /.server-maintenance.html RewriteEngine On RewriteRule !^.server-maintenance.html /server-maintenance Redirect 503 /server-maintenance **strong text**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T16:26:28.750

您应该发送一个**`503 Service Unavailable`**HTTP 状态代码，而不是一个**`404`**. 将此与**`Retry-After`**标题结合使用，以告诉机器人何时返回。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T16:24:10.397

您可以使用 robots.txt

[http://www.robotstxt.org/](http://www.robotstxt.org/)

此外，谷歌在他们的网站管理员工具中有一个验证器。

[https://www.google.com/webmasters/tools/](https://www.google.com/webmasters/tools/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T16:39:10.280

Returning`503 Service Unavailable`告诉 Google 机器人稍后再回来。有一个 Google[支持页面](http://google.com/support/webmasters/bin/answer.py?answer=83040)描述了 HTTP 错误代码以及它们是如何解释的。

您还可以使用[Retry-After 响应标头来](http://www.askapache.com/htaccess/503-service-temporarily-unavailable.html)建议重新检查站点可用性的最短时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T16:28:55.283

另一种方法是不从您网站（或任何其他网站）上的任何其他页面链接维护页面。

# css - 不是 CSS 选择器

> ID：726493
> 
> 赞同：72
> 
> 时间：2009-04-07T16:07:05.600
> 
> 标签：css, css-selectors

是否有某种“非”CSS 选择器？

例如，当我在我的 CSS 中编写以下行时，具有类*classname*的标记内的所有输入字段都将具有红色背景。

```
.classname input {
  background: red;
} 
```

如何选择类*classname*标记之外的所有输入字段？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-07T16:16:57.447

~~**使用当前的浏览器 CSS 支持，您不能。**~~

*较新的浏览器现在支持它 - 有关更多信息，请参阅[Sam 的答案](https://stackoverflow.com/questions/726493/negative-css-selectors#6294916)。*

（有关 CSS 中的替代方案，请参阅其他答案。）

如果在 JavaScript/jQuery 中这样做是可以接受的，你可以这样做：

```
$j(':not(.classname)>input').css({background:'red'}); 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-07-10T18:14:28.793

Mozilla 支持[否定伪类](http://www.w3.org/TR/css3-selectors/#negation)：

```
:not(.classname) input {background: red;} 
```

另见：http: [//developer.mozilla.org/en/Mozilla_CSS_support_chart](http://developer.mozilla.org/en/Mozilla_CSS_support_chart)

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-06-09T14:58:42.170

请注意，否定伪类在[Selectors Level 3 Recommendation](http://www.w3.org/TR/css3-selectors)中，并且适用于最新版本的 Firefox、Chrome 和 Safari（至少）。下面的示例代码。

```
<html>
<head>
<title>Negation pseudo class</title>
<style type="text/css">
    div {
    border: 1px solid green;
    height: 10px;
    }
    div:not(#foo) {
    border: 1px solid red;
    }
</style>
</head>
<body>
    <div id="foo"></div>
    <div id="bar"></div>
    <div id="foobar"></div>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-04-07T16:09:46.390

你不会通过将“全局”背景设置为红色，然后使用类名来改变其他人来做到这一点吗？

```
input { background: red; }
.classname input { background: white; } 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-07T16:11:46.867

我会这样做

```
input { /* styles outside of .classname */ }
.classname input { /* styles inside of .classname, overriding above */ } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T16:09:23.380

无法使用 CSS 选择匹配元素的父级。您必须使用 JavaScript 来选择它们。

根据您的问题，我假设您的标记或多或少像这样：

```
<form class="formclassname">
    <div class="classname">
        <input />  <!-- Your rule matches this -->
        <input />  <!-- Your rule matches this -->
    </div>
    <input />  <!-- You want to select this? -->
    <input />  <!-- You want to select this? -->
</form> 
```

一种选择是将一个类添加到更高的元素，比如`<form>`，并编写一个规则来设置表单的所有输入的样式。IE：

```
.formclassname input {
  /* Some properties here... */
} 
```

或者

```
.formclassname > input {
  /* Some properties here... */
} 
```

如果您想根据它们不在具有特定类的元素内的事实来选择它们，那么如果不使用 JavaScript，您将不走运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T16:18:47.053

我认为您能得到的最接近的方法是仅通过声明影响直系后代

例如，此代码只会影响直接在具有类“maincontent”的 div 下的输入字段

```
div.maincontent > input {
  // do something
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T17:06:46.813

输入有点烦人，因为与大多数其他 html 元素不同，不一定有办法将所有 css 属性重置为默认值。

如果样式是非关键的（即很好但不影响功能），我会使用 jQuery 来获取所有输入的数组，检查它们的父项，然后只在该 div 之外的那些上执行样式。就像是：

```
$('input').each(function() {
     if($(this).closest('.classname') == false)
     {
           // apply css styles
     }
}); 
```

（顺便说一句，我不是 jQuery 专家，所以上面可能会有一些错误，但原则上这样的东西应该可以）

# iis - IIS 文件权限

> ID：726506
> 
> 赞同：0
> 
> 时间：2009-04-07T16:11:33.670
> 
> 标签：iis, windows-server-2003, file-permissions

我有一个应用程序，我在进行维护时试图限制权限。我使用 windows 文件权限并删除对所有非管理员帐户运行应用程序的 dll 文件的访问权限，即：

cacls "%DLL_LOC%" /E /R BUILTIN\Users

然后我回收应用程序池（它在我的开发环境中工作以锁定用户）：

cscript c:\windows\system32\iisapp.vbs /a "DefaultAppPool" /r

但是没有运气，因为任何人仍然可以访问 dll 和应用程序。

感谢任何进一步的想法，因为我没有获得一致应用的权限。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T04:08:32.670

确保您正在编辑的文件没有从上面的文件夹[继承其权限](http://support.microsoft.com/kb/318754)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:51:07.943

因此，在尝试阻止网络端口以寻求解决方法并重新启动机器两到三次的错误尝试之后，用户被阻止了。

对不起，简单的重启修复 XP。

# ruby-on-rails - Rails 部分渲染导致空白页？

> ID：726516
> 
> 赞同：3
> 
> 时间：2009-04-07T16:13:31.997
> 
> 标签：ruby-on-rails

我现在遇到了一个令我困惑的错误。我有一个包含一些 HTML 和部分（用于导航）的布局 - 除了产量之外没有其他任何东西。

1.  如果将导航作为部分包含在内，我根本没有返回浏览器（空白页面），但其他一切看起来都很正常
2.  如果我删除部分页面工作正常
3.  如果我将导航代码直接放在模板中，它可以正常工作
4.  如果我用一个简单的字符串替换部分中的导航代码，我会再次得到一个空白页。

有没有人对问题可能有任何想法，或者知道我可以如何调试它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T16:27:58.747

发现问题，部分位于布局文件夹中，而不是相关的控制器视图文件夹中。

然而，Rails 抛出了一个 ActionView::MissingTemplate 异常，它只能通过调试器看到，这可能是一个错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T16:28:50.010

首先，检查日志文件以查看是否在某处收到错误消息。如果这样做没有帮助，请按照以下步骤操作：

*   复制您的模板和部分，作为原始链接
*   测试他们是否表现出问题
*   开始从中删除东西，直到您遇到仍然存在问题的最简单的情况（您在部分测试中的字符串是朝这个方向迈出的一步）
*   如果您在该过程中没有弄清楚，请返回并编辑您的问题以包含简化案例的代码

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-08-08T21:06:12.310

我曾多次遇到此错误。问题总是通过更改有问题的模板中的某些内容或其中一个部分来解决（在我的最新情况下，我在 a`</div>`和 a之间的源代码中添加了一个空行`<div>`，这是模板调用的部分内容；更改模板本身没有效果）。真正奇怪的是，当我实际更改模板时，问题很少发生，但通常是在我更改相关内容时（例如，编辑页面中显示的图像或与页面相关的 CSS）。虽然问题通常与部分有关，但整个页面都是空白的，而不仅仅是部分提供的部分。

顺便说一句，重新启动 Web 服务器（在本例中为 Unicorn）并不能解决问题。运行 Ruby 1.9.3、Rails 3.1.3。使用 SASS 和独角兽。

更新：刚刚确定 Rails 正在返回一个 304-not modified，基于我的浏览器发送的“If-none-match”标头（这又基于上一页的 ETAG）。但是，与此同时，浏览器清除了窗口。因此，大概是 Rails 发送的某些内容导致浏览器清除窗口。

# sql - TSQL 中的合并和透视

> ID：726522
> 
> 赞同：2
> 
> 时间：2009-04-07T16:16:18.527
> 
> 标签：sql, sql-server-2005, tsql, aggregate

我无法弄清楚如何在如下所示的 SQL 记录集上合并或旋转：

```
ID      VALUE       GROUP
3       John        18
4       Smith       18
5       Microsoft   18
3       Randy       21
4       Davis       21
5       IBM     21
etc 
```

我想像这样格式化

```
NEWVALUE                GROUP
Smith, John (Microsft)      18
Davis, Randy (IBM)          21 
```

感谢您的任何建议和帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:32:30.500

这是我做的，我希望它适合你

```
DECLARE @t table (id int, value VARCHAR(20), grupo int)
INSERT @T VALUES (3, 'John', 18)
INSERT @T VALUES (4, 'Smith', 18)
INSERT @T VALUES (5, 'Microsoft', 18)
INSERT @T VALUES (3, 'Randy', 21)
INSERT @T VALUES (4, 'Davis', 21)
INSERT @T VALUES (5, 'IBM', 21)

SELECT grupo, (SELECT value FROM @t t2 WHERE t2.grupo = t.grupo AND id = 4) + ', ' + 
(SELECT value FROM @t t2 WHERE t2.grupo = t.grupo AND id = 3) + ' (' +
(SELECT value FROM @t t2 WHERE t2.grupo = t.grupo AND id = 5) + ')'
FROM @t t 
GROUP BY grupo 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T16:36:56.107

```
SELECT  LEFT(gvalue, LEN(gvalue) - 1) AS newvalue, _group
FROM    (
        SELECT  DISTINCT _group
        FROM    mytable
        ) qo
CROSS APPLY
        (
        SELECT  value + ', '
        FROM    mytable qi
        WHERE   qi._group = qo._group
        FOR XML PATH ('')
        ) gr(qvalue) 
```

如果你总是有一组三个硬编码`ID`的`_group`，你可以使用：

```
SELECT m3._group, m3.value + ', ' + m4.value + '(' + m5.value + ')' AS newvalue
FROM   mytable m3
LEFT JOIN
       mytable m4
ON     m4._group = m3.group
LEFT JOIN
       mytable m5
ON     m5._group = m3.group
WHERE  m3.id = 3
       AND m4.id = 4
       AND m5.id = 5 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T16:29:28.447

您需要的不是旋转查询，而是一个简单的带有 group by 的 select 和一个聚合字符串连接函数。但我不记得 tsql 中的确切功能。

更新： tsql 中没有聚合连接函数，但从 sql2005 开始，您可以编写自己的扩展来实现此类功能。谷歌搜索有很多例子：tsql 2005 concatenation aggregate example。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-07T16:47:02.617

这有点做作，但我认为它应该适用于小型数据集。如果你有很多数据，你需要创建一个游标和一个循环。

```
select max(case when ID = 4 then VALUE else null end) + ', ' + 
    max(case when ID = 4 then VALUE else null end) + '( ' +
    max(case when ID = 5 then VALUE else null end) + ') as NEWVALUE,
    [GROUP]
group by [GROUP] 
```

# mysql - 单行汇总表应该有一个主键吗？

> ID：726524
> 
> 赞同：2
> 
> 时间：2009-04-07T16:16:46.887
> 
> 标签：mysql, schema

假设您有一个只有一行的汇总表（存储有关另一个表的一行统计信息）。在这种情况下，我使用 InnoDB 以便我可以更新它以及它旨在包含事务摘要的表。我应该让这个表有一个主键吗？如果是这样，什么，只是一个总是等于 1 的 tinyint？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T16:26:15.040

`InnoDB`如果您不提供主键，将为您创建一个隐藏的主键。

有时访问此密钥会更容易，因为

```
INSERT
...
ON DUPLICATE KEY UPDATE 
```

可以用来更新这个表，不管它是否已经有值。

是的，只需使用一个常量`1`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T16:19:58.580

我认为您应该，您不知道将来是否可以使用同一张表来存储其他表的统计信息，这似乎是存储它们的好地方，那么您将需要识别表的每一行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T16:59:53.930

鉴于大多数其他答案是“不，你不需要一个”，我将提供一个魔鬼代言人的答案。

主键约束确保您不会在应用约束的列中获得具有重复值的行。你说你打算这个表只有一行，那你为什么*不*声明约束呢？它可以帮助防止重复，这是您想要的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T16:30:14.093

我会在上面放一个标识列（我不知道 InnoDB 的等价物是什么）。这样做是无害的，并且如果您需要，可以更轻松地选择或删除特定行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T16:19:36.740

我从不在这种情况下打扰。PK 用于与其他记录区分开来，在这种情况下没有。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T16:22:05.937

如果您打算扩展此表怎么办？定义一个键可能是有意义的。同样，这只是一种意见，而不是您的必要条件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T16:25:47.410

我暂时不会介绍PK。如果您决定将此表也用于其他记录，只需重构并添加一个新行（无论如何您可能都需要）（过早优化）。添加这样一个 PK 的原因还有一个：如果您使用的框架在没有标识记录的 PK 的情况下无法更新记录。

# apache-flex - 当 Flex 中的列表为空时显示的背景图像

> ID：726538
> 
> 赞同：2
> 
> 时间：2009-04-07T16:21:12.897
> 
> 标签：apache-flex, actionscript-3, image, list

当a为空时，如何在 a`backgroundImage`上显示 a？`List``List`

目前，在拖放后将项目放入其中时会填充列表，但我更喜欢检查数据是否有任何更改以确定列表是否为空的解决方案。

`List`继承`backgroundImage`自它的a`ScrollControlBase`但最好的方法是让它在列表为空时出现并在添加项目时消失。

有什么建议么？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T16:54:27.500

In the past, I've done it with states for a component. Quick and dirty example would be something like this in your custom component:

`<mx:List currentState="{(listItemsDataProvider.length > 0) ? 'HasItemsState' : 'NoItemsState'}">`

`// anything else you need`

`</mx:List>`

and of course creating those states in the component, with the NoItemsStates changing the background image, or if your component is a container, like a `Canvas`, then you can have the state not display the `List` at all.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T16:36:43.190

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            import mx.collections.ArrayCollection;

            [Bindable] public var listItems:ArrayCollection = new ArrayCollection();

            private function removeAllItemsFromList():void
            {
                this.listItems.removeAll();
                backgroundCheck()
            }

            private function addItemToList():void
            {
                this.listItems.addItem({data:null,label:"test"});
                backgroundCheck()
            }

            private function backgroundCheck():void
            {
                if(this.listItems.length>0)
                {
                    this.myList.setStyle("backgroundImage", null)
                }
                else
                {
                    this.myList.setStyle("backgroundImage", "me.png")
                }               
            }
        ]]>
    </mx:Script>
    <mx:VBox width="100%" height="100%">
        <mx:List id="myList" width="100%" height="100%" backgroundImage="me.png" dataProvider="{this.listItems}"/>
        <mx:HBox width="100%">
            <mx:Button id="addItemButton" click="addItemToList()" label="add item"/>
            <mx:Button id="removeItemsButton" click="removeAllItemsFromList()" label="remove all items"/>
        </mx:HBox>
    </mx:VBox>
</mx:Application> 
```

这就是我将如何处理它，检查 dataProvider 长度。在您的情况下，您会在删除完成后这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:52:45.023

You could extend the List control and override updateDisplayList(). Draw the backgroundImage if dataProvider.length == 0 else call super.updateDisplayList() to get normal List behavior. This will make the new List control easy to reuse if you need to.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T16:23:43.767

使用相同的属性，当您有一些数据时将图像设置为空。你也可以看看custom `ItemRenderers`。

# java - 如何有效地取消发布博客应用程序上特定用户的所有数据？

> ID：726545
> 
> 赞同：2
> 
> 时间：2009-04-07T16:24:28.383
> 
> 标签：java, mysql, performance

我们开发和运营一个博客应用程序，其中用户数据分散在许多表中：
- 博客
- 文章
- 评论
- 消息
- 引用
- 50 个其他表。

用户可以关闭他们的账户，他们的账户/内容必须立即从网站上消失。

出于法律/合同原因，我们还必须能够在给定期限内取消删除他们的帐户/内容，并且还必须在另一期限内向司法当局提供这些数据。

多年来和不同的应用，我们使用了不同的方法：

*   “deleted”标志无处不在：每个表都有一个“deleted”列，当数据被删除/恢复时更新。非常讨厌，因为它会减慢每个列表生成查询，在删除/恢复时创建大量更新。此外，它不处理上述两阶段删除。事实上，我们从未使用过这个，但值得不建议使用它:)

*   “多表”：对于每个表，我们使用相同的模式和两个额外的字段（dateDeleted、reason）创建第二个表。额外的字段用于了解数据是否仍可用于恢复、何时删除以及为什么/如何删除。这个版本比以前的版本好一点，但是当表增长时，性能也会非常糟糕。此外，您必须更改某些表的架构（即：删除 UNIQUE 约束），这使得新开发人员、管理员......以及一般心理健康的人更难以理解/升级系统。

*   “多数据库”：与以前的方法相同，但我们将数据移动到不同的数据库集群上，这样可以浏览这些数据而不会影响“最终用户”数据库。此外，对于这个应用程序，唯一性约束是在 java 级别完成的，因此所有模式都是相同的。最后，双重数据保留约束是通过为每个约束设置一个专用数据库来完成的，这使事情变得更容易。

我不得不承认，这些方法都不能让我满意，即使它们可以处理一定数量的数据。我还想象我们可以只删除数据库中的一些关键行，让其余的不一致（并安排一个更受控制的删除作业），但这让我害怕......

您是否知道做同样事情的其他方法，保持相同级别的功能（我们可以对齐两个持续时间以简化问题）？我不是在为我现有的应用程序寻找解决方案，而是想改进下一个应用程序。

任何输入将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T16:36:48.133

似乎每一项资产（博客、评论……）都依赖于用户。我会给用户表一个“活动”列，它是 0 或 1，然后你实现一个功能来询问不同资产“用户活动”的每个查询？尝试使用 indizes 或类似的东西优化此查找。在我看来，这是最干净的方式。在此之后，您可以实施一项作业，该作业对禁用超过 x 天的用户运行级联删除。

# algorithm - RGB 值的加色混合算法

> ID：726549
> 
> 赞同：83
> 
> 时间：2009-04-07T16:25:27.677
> 
> 标签：algorithm, colors

我正在寻找一种算法来对 RGB 值进行加色混合。

是否像将 RGB 值加在一起最多为 256 一样简单？

```
(r1, g1, b1) + (r2, g2, b2) =
    (min(r1+r2, 256), min(g1+g2, 256), min(b1+b2, 256)) 
```

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-04-07T19:57:37.310

要使用 Alpha 通道进行混合，您可以使用以下公式：

```
r = new Color();
r.A = 1 - (1 - fg.A) * (1 - bg.A);
if (r.A < 1.0e-6) return r; // Fully transparent -- R,G,B not important
r.R = fg.R * fg.A / r.A + bg.R * bg.A * (1 - fg.A) / r.A;
r.G = fg.G * fg.A / r.A + bg.G * bg.A * (1 - fg.A) / r.A;
r.B = fg.B * fg.A / r.A + bg.B * bg.A * (1 - fg.A) / r.A; 
```

`fg` is the paint color. `bg` is the background. `r` is the resulting color. `1.0e-6` is just a really small number, to compensate for rounding errors.

*NOTE:* All variables used here are in the range [0.0, 1.0]. You have to divide or multiply by 255 if you want to use values in the range [0, 255].

For example, 50% red on top of 50% green:

```
// background, 50% green
var bg = new Color { R = 0.00, G = 1.00, B = 0.00, A = 0.50 };
// paint, 50% red
var fg = new Color { R = 1.00, G = 0.00, B = 0.00, A = 0.50 };
// The result
var r = new Color();
r.A = 1 - (1 - fg.A) * (1 - bg.A); // 0.75
r.R = fg.R * fg.A / r.A + bg.R * bg.A * (1 - fg.A) / r.A; // 0.67
r.G = fg.G * fg.A / r.A + bg.G * bg.A * (1 - fg.A) / r.A; // 0.33
r.B = fg.B * fg.A / r.A + bg.B * bg.A * (1 - fg.A) / r.A; // 0.00 
```

Resulting color is: `(0.67, 0.33, 0.00, 0.75)`, or 75% brown (or dark orange).

* * *

You could also reverse these formulas:

```
var bg = new Color();
if (1 - fg.A <= 1.0e-6) return null; // No result -- 'fg' is fully opaque
if (r.A - fg.A < -1.0e-6) return null; // No result -- 'fg' can't make the result more transparent
if (r.A - fg.A < 1.0e-6) return bg; // Fully transparent -- R,G,B not important
bg.A = 1 - (1 - r.A) / (1 - fg.A);
bg.R = (r.R * r.A - fg.R * fg.A) / (bg.A * (1 - fg.A));
bg.G = (r.G * r.A - fg.G * fg.A) / (bg.A * (1 - fg.A));
bg.B = (r.B * r.A - fg.B * fg.A) / (bg.A * (1 - fg.A)); 
```

or

```
var fg = new Color();
if (1 - bg.A <= 1.0e-6) return null; // No result -- 'bg' is fully opaque
if (r.A - bg.A < -1.0e-6) return null; // No result -- 'bg' can't make the result more transparent
if (r.A - bg.A < 1.0e-6) return bg; // Fully transparent -- R,G,B not important
fg.A = 1 - (1 - r.A) / (1 - bg.A);
fg.R = (r.R * r.A - bg.R * bg.A * (1 - fg.A)) / fg.A;
fg.G = (r.G * r.A - bg.G * bg.A * (1 - fg.A)) / fg.A;
fg.B = (r.B * r.A - bg.B * bg.A * (1 - fg.A)) / fg.A; 
```

The formulas will calculate that background or paint color would have to be to produce the given resulting color.

* * *

If your background is opaque, the result would also be opaque. The foreground color could then take a range of values with different alpha values. For each channel (red, green and blue), you have to check which range of alphas results in valid values (0 - 1).

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2009-04-07T16:30:51.113

这取决于您想要什么，它可以帮助您了解不同方法的结果。

如果你想

```
红+黑=红
红+绿=黄
红+绿+蓝=白
红+白=白
黑 + 白 = 白

```

然后用夹子添加（例如`min(r1 + r2, 255)`）这更像是您提到的灯光模型。

如果你想

```
红色 + 黑色 = 深红色
红色 + 绿色 = 深黄色
红色 + 绿色 + 蓝色 = 深灰色
红色 + 白色 = 粉色
黑色 + 白色 = 灰色

```

那么你需要对这些值进行平均（例如`(r1 + r2) / 2`）这对于淡化/加深颜色和创建渐变效果更好。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2015-03-28T18:57:53.590

Fun fact: Computer RGB values are derived from the square root of photon flux. So as a general function, your math should take that into account. The general function for this for a given channel is:

```
blendColorValue(a, b, t)
    return sqrt((1 - t) * a^2 + t * b^2) 
```

Where a and b are the colors to blend, and t is a number from 0-1 representing the point in the blend you want between a and b.

The alpha channel is different; it doesn't represent photon intensity, just the percent of background that should show through; so when blending alpha values, the linear average is enough:

```
blendAlphaValue(a, b, t)
    return (1-t)*a + t*b; 
```

So, to handle blending two colors, using those two functions, the following pseudocode should do you good:

```
blendColors(c1, c2, t)
    ret
    [r, g, b].each n ->
        ret[n] = blendColorValue(c1[n], c2[n], t)
    ret.alpha = blendAlphaValue(c1.alpha, c2.alpha, t)
    return ret 
```

Incidentally, I long for a programming language and keyboard that both permits representing math that (or more) cleanly (the combining overline unicode character doesn't work for superscripts, symbols, and a vast array of other characters) and interpreting it correctly. sqrt((1-t)*pow(a, 2) + t * pow(b, 2)) just doesn't read as clean.

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-07T16:35:10.570

几点：

*   我认为您想使用 min 而不是 max
*   我想你想用 255 而不是 256

这将给出：

(r1, g1, b1) + (r2, g2, b2) = (min(r1+r2, 255), min(g1+g2, 255), min(b1+b2, 255))

然而，混合颜色的“自然”方式是使用平均值，然后你不需要最小值：

(r1, g1, b1) + (r2, g2, b2) = ((r1+r2)/2, (g1+g2)/2, (b1+b2)/2)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-07-17T21:44:27.630

## Javascript function to blend rgba colors

c1,c2 and result - JSON's like *c1={r:0.5,g:1,b:0,a:0.33}*

```
 var rgbaSum = function(c1, c2){
       var a = c1.a + c2.a*(1-c1.a);
       return {
         r: (c1.r * c1.a  + c2.r * c2.a * (1 - c1.a)) / a,
         g: (c1.g * c1.a  + c2.g * c2.a * (1 - c1.a)) / a,
         b: (c1.b * c1.a  + c2.b * c2.a * (1 - c1.a)) / a,
         a: a
       }
     } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-05-06T14:29:26.513

**PYTHON** **COLOUR** **MIXING** **THROUGH** **ADDITION** **IN** **CMYK** **SPACE**

One possible way to do this is to first convert the colours to [CMYK](http://en.wikipedia.org/wiki/CMYK_color_model) format, add them there and then reconvert to RGB.

Here is an example code in Python:

```
rgb_scale = 255
cmyk_scale = 100

def rgb_to_cmyk(self,r,g,b):
    if (r == 0) and (g == 0) and (b == 0):
        # black
        return 0, 0, 0, cmyk_scale

    # rgb [0,255] -> cmy [0,1]
    c = 1 - r / float(rgb_scale)
    m = 1 - g / float(rgb_scale)
    y = 1 - b / float(rgb_scale)

    # extract out k [0,1]
    min_cmy = min(c, m, y)
    c = (c - min_cmy) 
    m = (m - min_cmy) 
    y = (y - min_cmy) 
    k = min_cmy

    # rescale to the range [0,cmyk_scale]
    return c*cmyk_scale, m*cmyk_scale, y*cmyk_scale, k*cmyk_scale

def cmyk_to_rgb(self,c,m,y,k):
    """
    """
    r = rgb_scale*(1.0-(c+k)/float(cmyk_scale))
    g = rgb_scale*(1.0-(m+k)/float(cmyk_scale))
    b = rgb_scale*(1.0-(y+k)/float(cmyk_scale))
    return r,g,b

def ink_add_for_rgb(self,list_of_colours):
    """input: list of rgb, opacity (r,g,b,o) colours to be added, o acts as weights.
    output (r,g,b)
    """
    C = 0
    M = 0
    Y = 0
    K = 0

    for (r,g,b,o) in list_of_colours:
        c,m,y,k = rgb_to_cmyk(r, g, b)
        C+= o*c
        M+=o*m
        Y+=o*y 
        K+=o*k 

    return cmyk_to_rgb(C, M, Y, K) 
```

The result to your question would then be (assuming a half-half mixture of your two colours:

```
r_mix, g_mix, b_mix = ink_add_for_rgb([(r1,g1,b1,0.5),(r2,g2,b2,0.5)]) 
```

where the 0.5's are there to say that we mix 50% of the first colour with 50% of the second colour.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-07T16:29:34.687

是的，就是这么简单。另一种选择是找到平均值（用于创建渐变）。

这真的取决于你想要达到的效果。

但是，当添加 Alpha 时，它会变得复杂。有许多不同的方法可以使用 Alpha 进行混合。

简单 alpha 混合的示例： [http ://en.wikipedia.org/wiki/Alpha_compositing#Alpha_blending](http://en.wikipedia.org/wiki/Alpha_compositing#Alpha_blending)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-11-22T09:31:05.377

When I came here I didn't find the "additive color mixing" algorithm I was actually looking for, which is also available in Photoshop and is described as **"Screen"** on [Wikipedia](https://en.wikipedia.org/wiki/Blend_modes#Screen). (Aka **"brighten"** or **"invert multiply"**.) It produces a result similar to two light sources being combined.

> With Screen blend mode the values of the pixels in the two layers are inverted, multiplied, and then inverted again. This yields the opposite effect to multiply. The result is a brighter picture.

Here it is:

```
// (rgb values are 0-255)
function screen(color1, color2) {
    var r = Math.round((1 - (1 - color1.R / 255) * (1 - color2.R / 255)) * 255);
    var g = Math.round((1 - (1 - color1.G / 255) * (1 - color2.G / 255)) * 255);
    var b = Math.round((1 - (1 - color1.B / 255) * (1 - color2.B / 255)) * 255);
    return new Color(r, g, b);
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-06-06T22:03:37.397

Find here the mixing methods suggested by Fordi and Markus Jarderot in one python function that gradually mixes or blends between two colors A and B.

The "mix" mode is useful to interpolate between two colors. The "blend" mode (with `t=0`) is useful to compute the resulting color if one translucent color is painted on top of another (possibly translucent) color. `gamma` correction leads to nicer results because it takes into consideration the fact that physical light intensity and perceived brightness (by humans) are related non-linearly.

* * *

```
import numpy as np

def mix_colors_rgba(color_a, color_b, mode="mix", t=None, gamma=2.2):
    """
    Mix two colors color_a and color_b.

    Arguments:
        color_a:    Real-valued 4-tuple. Foreground color in "blend" mode.
        color_b:    Real-valued 4-tuple. Background color in "blend" mode.
        mode:       "mix":   Interpolate between two colors.
                    "blend": Blend two translucent colors.
        t:          Mixing threshold.
        gamma:      Parameter to control the gamma correction.

    Returns: 
        rgba:       A 4-tuple with the result color.

    To reproduce Markus Jarderot's solution:
            mix_colors_rgba(a, b, mode="blend", t=0, gamma=1.)
    To reproduce Fordi's solution:
            mix_colors_rgba(a, b, mode="mix", t=t, gamma=2.)
    To compute the RGB color of a translucent color on white background:
            mix_colors_rgba(a, [1,1,1,1], mode="blend", t=0, gamma=None)
    """
    assert(mode in ("mix", "blend"))
    assert(gamma is None or gamma>0)
    t = t if t is not None else (0.5 if mode=="mix" else 0.)
    t = max(0,min(t,1))
    color_a = np.asarray(color_a)
    color_b = np.asarray(color_b)
    if mode=="mix" and gamma in (1., None):
        r, g, b, a = (1-t)*color_a + t*color_b
    elif mode=="mix" and gamma > 0:
        r,g,b,_ = np.power((1-t)*color_a**gamma + t*color_b**gamma, 1/gamma)
        a = (1-t)*color_a[-1] + t*color_b[-1]
    elif mode=="blend":
        alpha_a = color_a[-1]*(1-t)
        a = 1 - (1-alpha_a) * (1-color_b[-1])
        s = color_b[-1]*(1-alpha_a)/a
        if gamma in (1., None):
            r, g, b, _ = (1-s)*color_a + s*color_b
        elif gamma > 0:
            r, g, b, _ = np.power((1-s)*color_a**gamma + s*color_b**gamma,
                                  1/gamma)

    return tuple(np.clip([r,g,b,a], 0, 1)) 
```

* * *

See below how this can be used. In "mix" mode the left and right colors match exactly `color_a` and `color_b`. In "blend" mode, the left color at `t=0` is the color that results if `color_a` is blended over `color_b` (and a white background). In the example, `color_a` then is made increasingly translucent until one arrives at `color_b`.

Note that blending and mixing are equivalent if the alpha values are 1.0.

[![Results](https://i.stack.imgur.com/4Y2fQ.png)](https://i.stack.imgur.com/4Y2fQ.png)

* * *

For completeness, here the code to reproduce the above plot.

```
import matplotlib.pyplot as plt
import matplotlib as mpl

def plot(pal, ax, title):
    n = len(pal)
    ax.imshow(np.tile(np.arange(n), [int(n*0.20),1]),
              cmap=mpl.colors.ListedColormap(list(pal)),
              interpolation="nearest", aspect="auto")
    ax.set_xticks([])
    ax.set_yticks([])
    ax.set_xticklabels([])
    ax.set_yticklabels([])
    ax.set_title(title)

_, (ax1, ax2, ax3, ax4) = plt.subplots(nrows=4,ncols=1)

n = 101
ts = np.linspace(0,1,n)
color_a = [1.0,0.0,0.0,0.7] # transparent red
color_b = [0.0,0.0,1.0,0.8] # transparent blue

plot([mix_colors_rgba(color_a, color_b, t=t, mode="mix", gamma=None)
      for t in ts], ax=ax1, title="Linear mixing")
plot([mix_colors_rgba(color_a, color_b, t=t, mode="mix", gamma=2.2)
      for t in ts], ax=ax2, title="Non-linear mixing (gamma=2.2)")
plot([mix_colors_rgba(color_a, color_b, t=t, mode="blend", gamma=None)
      for t in ts], ax=ax3, title="Linear blending")
plot([mix_colors_rgba(color_a, color_b, t=t, mode="blend", gamma=2.2)
      for t in ts], ax=ax4, title="Non-linear blending (gamma=2.2)")
plt.tight_layout()
plt.show() 
```

* * *

```
Formulas:
    Linear mixing (gamma=1):
                r,g,b,a:    (1-t)*x + t*y
    Non-linear mixing (gama≠1):
                r,g,b:      pow((1-t)*x**gamma + t*y**gamma, 1/gamma)
                a:          (1-t)*x + t*y
    Blending (gamma=1):
                a:          1-(1-(1-t)*x)*(1-y)
                s:          alpha_b*(1-alpha_a)*a
                r,g,b:      (1-s)*x + s*y
    Blending (gamma≠1):
                a:          1-(1-(1-t)*x)*(1-y)
                s:          alpha_b*(1-alpha_a)/a
                r,g,b:      pow((1-s)*x**gamma + s*y**gamma, 1/gamma) 
```

And finally, [here](http://blog.johnnovak.net/2016/09/21/what-every-coder-should-know-about-gamma) a useful read about gamma correction.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-08-14T06:54:42.573

Have written/used something like [@Markus Jarderot](https://stackoverflow.com/a/726564/8740349)'s `sRGB` blending answer (which is not gamma corrected since that is the default legacy) using C++

```
//same as Markus Jarderot's answer
float red, green, blue;
alpha = (1.0 - (1.0 - back.alpha)*(1.0 - front.alpha));
red   = (front.red   * front.alpha / alpha + back.red   * back.alpha * (1.0 - front.alpha));
green = (front.green * front.alpha / alpha + back.green * back.alpha * (1.0 - front.alpha));
blue  = (front.blue  * front.alpha / alpha + back.blue  * back.alpha * (1.0 - front.alpha));

//faster but equal output
alpha = (1.0 - (1.0 - back.alpha)*(1.0 - front.alpha));
red   = (back.red   * (1.0 - front.alpha) + front.red   * front.alpha);
green = (back.green * (1.0 - front.alpha) + front.green * front.alpha);
blue  = (back.blue  * (1.0 - front.alpha) + front.blue  * front.alpha);

//even faster but only works when all values are in range 0 to 255
int red, green, blue;
alpha = (255 - (255 - back.alpha)*(255 - front.alpha));
red   = (back.red   * (255 - front.alpha) + front.red   * front.alpha) / 255;
green = (back.green * (255 - front.alpha) + front.green * front.alpha) / 255;
blue  = (back.blue  * (255 - front.alpha) + front.blue  * front.alpha) / 255; 
```

more info: [what-every-coder-should-know-about-gamma](http://blog.johnnovak.net/2016/09/21/what-every-coder-should-know-about-gamma/#fn:osgamma)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-02-03T20:25:03.953

I was working on a similar problem and ended up here, but had to write my own implementation in the end. I wanted to basically "overlay" the new foreground color over the existing background color. (And without using an arbitrary midpoint like `t`. I believe my implementation is still "additive.") This also seems to blend very cleanly in all of my test-cases.

Here, `new_argb` just converts the `int` into a struct with 4 `unsigned char` so I can reduce the amount of bit-shifts.

```
int blend_argb(int foreground, int background)
{
    t_argb fg;
    t_argb bg;
    t_argb blend;
    double ratio;

    fg = new_argb(foreground);
    bg = new_argb(background);

    // If background is transparent,
    // use foreground color as-is and vice versa.
    if (bg.a == 255)
        return (foreground);
    if (fg.a == 255)
        return (background);

    // If the background is fully opaque,
    // ignore the foreground alpha. (Or the color will be darker.)
    // Otherwise alpha is additive.
    blend.a = ((bg.a == 0) ? 0 : (bg.a + fg.a));

    // When foreground alpha == 0, totally covers background color.
    ratio = fg.a / 255.0;
    blend.r = (fg.r * (1 - ratio)) + (bg.r * ratio);
    blend.g = (fg.g * (1 - ratio)) + (bg.g * ratio);
    blend.b = (fg.b * (1 - ratio)) + (bg.b * ratio);

    return (blend.a << 24 | blend.r << 16 | blend.g << 8 | blend.b);
} 
```

For context, in my environment I'm writing color `int`s into a 1D pixel array, which is initialized with 0-bytes and increasing the alpha will make the pixel tend towards black. (`0` `0 0 0` would be opaque black and `255` `255 255 255` would be transparent white... aka black.)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-01-30T05:04:50.000

Here's a highly optimized, standalone c++ class, public domain, with floating point and two differently optimized 8-bit blending mechanisms in both function and macro formats, as well as a technical discussion of both the problem at hand and how to, and the importance of, optimization of this issue:

[https://github.com/fyngyrz/colorblending](https://github.com/fyngyrz/colorblending)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-07-09T03:58:52.303

Thank you Markus Jarderot, Andras Zoltan and hkurabko; here is the Python code for blending a list of RGB images.

Using Markus Jarderot's code we can generate RGBA color, then i use [Andras Zoltan and hkurabko's](https://stackoverflow.com/questions/2049230/convert-rgba-color-to-rgb) method to trans RGBA to RGB.

Thank you!

```
import numpy as np
def Blend2Color(C1,C2):
    c1,c1a=C1
    c2,c2a=C2
    A = 1 - (1 - c1a) * (1 - c2a);
    if (A < 1.0e-6): 
        return (0,0,0) #Fully transparent -- R,G,B not important
    Result=(np.array(c1)*c1a+np.array(c2)*c2a*(1-c1a))/A
    return Result,A
def RGBA2RGB(RGBA,BackGround=(1,1,1)):# whilt background
    A=RGBA[-1]
    RGB=np.add(np.multiply(np.array(RGBA[:-1]),A),
               np.multiply(np.array(BackGround),1-A))
    return RGB

def BlendRGBList(Clist,AlphaList=None,NFloat=2,ReturnRGB=True,
                 RGB_BackGround=(1,1,1)):
    N=len(Clist)
    if AlphaList==None:
        ClistUse=Clist.copy()
    else:
        if len(AlphaList)==N:
            AlphaListUse=np.multiply(AlphaList,10**NFloat).astype(int)
            ClistUse=np.repeat(np.array(Clist), AlphaListUse, axis=0)
        else:
            raise('len of AlphaList must equal to len of Clist!')
    while N!=1:
        temp=ClistUse.copy()
        ClistUse=[]
        for C in temp[:-1]:
            c1,a1=C
            c2,a2=temp[-1]
            ClistUse.append(Blend2Color(C1=(c1,a1*(1-1/N)),C2=(c2,a2*1/N)))
        N=len(ClistUse)
    Result=np.append(ClistUse[0][0],ClistUse[0][1])
    if ReturnRGB:
        Result=RGBA2RGB(Result,BackGround=RGB_BackGround)

    return Result 
```

Test

```
BlendRGBList([[(1,0,0),1],[(0,1,0),1]],ReturnRGB=True)
#array([0.75, 0.5 , 0.25])
BlendRGBList([[(1,0,0),1],[(0,1,0),1]],ReturnRGB=False)
#array([0.66666667, 0.33333333, 0\.        , 0.75      ]) 
```

# c# - Web 表单中的 PartialView

> ID：726562
> 
> 赞同：0
> 
> 时间：2009-04-07T16:30:32.923
> 
> 标签：c#, asp.net, webforms

我正在开发一个 Web 表单应用程序，并且我在另外 2-3 个地方需要一些 HTML 代码。
我已经创建了代表重复代码的 .ascx 控件：

```
 protected override void Render(HtmlTextWriter writer)
    {
        StringBuilder str = new StringBuilder();

        while (connRef.Read())
        {
            str.Append(connRef["some_database_field"]);
        }

        writer.Write(str.ToString());

        base.Render(writer);
    } 
```

connRef 是对 DataReader 对象的引用，我在需要渲染这段代码的地方传递该对象。
在其他控件中，我使用以下代码：

```
 MSSqlConn s = new MSSqlConn();
        StringBuilder str = new StringBuilder();

        s.OpenConn("select * from notes order by note_date desc;");

        notes.note c = (notes.note)Page.LoadControl(@"/controls/notes/note.ascx");
        c.ID = "note";
        c.connRef = s;

        while (s.Read())
        {
            str.Append(Html.RenderControl(c));
        }
        s.CloseConn();

        Response.Write(str.ToString()); 
```

MSSqlConn 是我的数据库连接类。
RenderControl 将任何控件呈现为 HTML 字符串。
第二个代码片段中的 s 只返回一条记录而不是两条。出于某种原因，如果我将引用传递给另一个控件 (c.connRef = s)，s 就会关闭。

也许我错过了什么，我不知道。

如果我没有很好地解释它，我很抱歉。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:47:28.203

您的问题是您两次调用 Read() 方法。这就是您的代码基本上在做的事情：

```
 while (s.Read())
        {
             while (connRef.Read())
             {
                 str.Append(connRef["some_database_field"]);
             }

        } 
```

每次调用 Read() 方法都会使数据读取器前进一条记录。您需要取出其中一个 while 循环。

您还应该注意，如果您将此数据读取器传递给多个用户控件，则需要将其重置为从头开始为每个新用户控件开始。

# metrics - 跟踪和预测质量水平

> ID：726565
> 
> 赞同：0
> 
> 时间：2009-04-07T16:31:03.310
> 
> 标签：metrics, prediction

人们推荐哪些技术来跟踪新程序的质量水平？他们是否会采用定义不明确的术语（例如“质量水平”），对其进行量化然后进行预测？目前我使用错误率和 S 曲线，但我正在寻找其他方法来评估、估计和预测质量水平。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T17:08:31.210

我不确定如果没有可以与之比较的东西，计算你的错误会做什么。如果你制作的软件非常难并且有很多边缘情况怎么办？你需要某种比较...

即使其他答案之一显然是一个笑话，代码审查也可能是一个好主意。如果你有太多错误，请雇用更好的工程师或让他们编写更少的代码。

编辑：在考虑评论后添加...

每个虫子都像一个独特的吸雪花（吸雪花？）。它们对您的客户和开发人员有不同程度的影响。我至少会考虑到这一点。也许增加严重性（衡量客户推动修复的措施）和修复它所花费的工程时间可能有助于提高准确性。我想我担心的是，在开发软件时，这仍然是对“质量”的过度简化。

可悲的是软件质量！=产品质量。最近发布的一款名为 Fallout 3 的游戏赢得了大量奖项并赚了很多钱（至少我认为），但至少在 PC 上也是一大堆垃圾。

只要确保您正在跟踪和优化正确的事情。跟踪 # 个错误与时间只是跟踪 # 个错误与时间。进一步阅读它需要某种程度的假设，无论是正确的还是不正确的。

你的目标是什么？错误只是软件质量的一部分。如果您想继续支持您的软件，可维护性是关键。很多时候，如果您的编码人员匆忙做某事，错误修复会使事情的可维护性降低。这反过来又使未来的修复和功能变得更加困难，并且修复可能会添加新的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T16:45:52.840

您在寻找[这种措施](http://www.osnews.com/story/19266/WTFs_m)吗？

更严重的是，对我而言，代码质量与可维护性有关：

*   修复错误，添加/删除/修改功能是多么容易，
*   重构有多容易：是否有可用的回归测试套件？
*   多少[技术债](http://www.martinfowler.com/bliki/TechnicalDebt.html)？

请记住，您编写代码一次，但您阅读了多次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:20:23.613

你做单元测试吗？单元测试的代码覆盖率可以作为质量衡量标准。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T16:42:25.703

这在很大程度上取决于您尝试进行什么样的比较。如果随着时间的推移您正在查看单个项目并且团队没有改变，那么错误率可能是有意义的。但是，如果你在比较不同的项目，不同的团队，真的没有办法比较 bug 率之类的东西，因为你实际上是在比较*已知*bug 的比率。一个团队可能比另一个团队更擅长识别错误，从而使他们的错误率看起来更高，但他们确实是软件质量更好的团队。

# .net - 连接超时

> ID：726571
> 
> 赞同：0
> 
> 时间：2009-04-07T16:33:13.727
> 
> 标签：.net, sql

我收到此错误：

> 超时已过。操作完成前超时时间已过或服务器无响应

```
"Data Source=" + server + ";Initial Catalog=" + database + ";Integrated Security=SSPI;Connection Reset=False;" 
```

连接池默认为 true，我正在关闭所有连接。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T16:34:24.893

尝试设置 ConnectionTimeout 和/或 CommandTimeout（如果在 .NET 上工作）。超时 0 表示“无超时”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-24T08:18:29.127

请尝试连接字符串如下

您可以尝试其中任何一种，Connect Timeout=0 或 Connection Timeout=0

```
"Data Source=" + server + ";Initial Catalog=" + database + ";Integrated Security=SSPI;Connection Timeout=0;" 
```

Connect Timeout=0 或 Connection Timeout=0 表示操作运行的无限时间

请参阅以下[MSDN 链接](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectiontimeout.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T17:16:19.083

可能是 SQL 服务器不允许传入 TCP/IP 连接（这是默认设置）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T16:48:55.530

这个问题是否只出现在一页上？还是全球性问题？

您是否知道导致超时的查询是什么？

*   如果没有，你应该在你的数据库调用周围添加 try/catch 并记录你的错误以确定它在哪里。
*   如果是这样，您可以从您的数据库工具中运行该查询吗？（IE SQL Server 管理工作室）
    *   你的查询成功了吗？还是超时？
    *   需要很长时间吗？你能提高那个查询的性能吗？

# svn - SVN 和 VSS 同步

> ID：726579
> 
> 赞同：1
> 
> 时间：2009-04-07T16:35:26.873
> 
> 标签：svn, scripting, repository, visual-sourcesafe, sync

我可以自动将文件从 SVN 同步到 VSS 吗？我的个人存储库是 SVN，我的客户有一个 VSS 存储库。我会喜欢通过脚本或类似的东西来同步存储库。

我可以吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T16:44:25.713

我知道没有软件可以自动化这样一个过程，但是您可以利用 SVN 提交后挂钩（[http://svnbook.red-bean.com/en/1.4/svn.ref.repohooks.post -commit.html](http://svnbook.red-bean.com/en/1.4/svn.ref.reposhooks.post-commit.html) ) 和 VSS 命令行界面 ( [http://msdn.microsoft.com/en-us/library/asxkfzy4(VS.80).aspx](http://msdn.microsoft.com/en-us/library/asxkfzy4%28VS.80%29.aspx) )。

最棘手的问题可能是在您的 SVN 存储库中添加/删除/重命名文件并在 VSS 中反映这些更改。如果 VSS 中的源代码也可以改变您（由另一个开发人员），那将打开另一个蠕虫罐 - 您必须在两个方向管理代码，包括合并。

祝你好运。

# asp.net - 使用 JQuery/ASP.NET 进行简单的 ajax 聊天时出现堆栈溢出错误

> ID：726580
> 
> 赞同：1
> 
> 时间：2009-04-07T16:35:47.857
> 
> 标签：asp.net, jquery, ajax, chat, settimeout

我正在尝试使用 JQuery 和 ASP.NET 创建一个简单的 ajax 聊天。我的代码是这样工作的：

1.  当页面加载时，它会通过对 messages.aspx 页面的请求刷新“聊天框”div，该页面处理从数据库获取新消息并使用 setTimeout() 启动自动刷新。
2.  每当用户单击发送按钮时，它会将消息添加到 messages.aspx page_load 代码内的数据库中。

当超时开始时，我从一开始就收到堆栈溢出错误，我不确定是什么原因导致的？会不会是缓存？也许messages.aspx 中的代码无法在这5 秒内完成运行？任何帮助，将不胜感激！

此外，我并不担心 sql 注入攻击，但 b/c 我只是想让它使用简单的代码。

这是我的代码：

> **客户端**

```
<%@ Page Language="C#" AutoEventWireup="true"  CodeFile="Default.aspx.cs" Inherits="_Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Untitled Page</title>
    <script src="jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            refreshChat();
            $("#btnSend").click(function () {
                addMessage();
            });
            return false;
        });

        function refreshChat() {
            $.get("messages.aspx", function (data) {
                $("#chatbox").empty();
                $("#chatbox").prepend(data);
            });
            setTimeout(refreshChat(), 5000);
        }

        function addMessage() {
            $.get("messages.aspx", { usr: $("#usr").val(), msg: $("#msg").val() });
        }
    </script>
</head>
<body>
    <form id="form1" runat="server">
        <div id="input">
            username: <input type="text" name="usr" id="usr" /><br />
            message:<br />
            <textarea id="msg" name="msg" rows="5" cols="30"></textarea><br /><br />
            <input type="button" id="btnSend" name="btnSend" value="Send" />
        </div>
        <div id="chatbox"></div>
    </form>
</body>
</html> 
```

> **服务器端**

```
using System;
using System.Data.SqlClient;
using System.Configuration;
using System.Collections;
using System.IO;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

public partial class messages : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {     
        SqlConnection conn = 
            new SqlConnection("Data Source=.\\SQLEXPRESS;AttachDbFilename=F:\\Chatter\\App_Data\\messages.mdf;Integrated Security=True;User Instance=True");
        conn.Open();

        string sql;
        SqlCommand comm;

        if (Request["usr"] != null)
        {
            string user = Request["usr"].ToString();
            string message = Request["msg"].ToString();
            sql = "insert into messages (usr, msg, [date]) values ('"
                + user + "', '" + message + "', '" + DateTime.Now + "')";
            comm = new SqlCommand(sql, conn);
            comm.ExecuteNonQuery();
        }

        sql = "select top 5 usr, msg from messages order by [date] desc";
        comm = new SqlCommand(sql, conn);
        SqlDataReader dr = comm.ExecuteReader();

        while (dr.Read())
        {
            Response.Write(dr["usr"].ToString() + ": <br/>" + dr["msg"] + "<br/><br/>");
        }
        dr.Close();

        conn.Close();
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T16:43:11.973

您的 javascript refreshChat 函数正在递归调用自身。将代码更改为：

```
function refreshChat() {
    $.get("messages.aspx", function (data) {
        $("#chatbox").empty();
        $("#chatbox").prepend(data);
    });
    setTimeout(refreshChat, 5000);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T16:41:11.367

您需要将 setTimeout 中的函数调用用引号括起来，否则会立即对其进行评估，从而导致无限递归和堆栈溢出：

```
setTimeout("refreshChat()", 5000); 
```

# jquery - 通过 XmlHttpRequest 对象调用支持 bean 方法

> ID：726581
> 
> 赞同：2
> 
> 时间：2009-04-07T16:35:53.270
> 
> 标签：jquery, ajax, jsf, xmlhttprequest

有没有办法使用 javascript XmlHttpRequest 对象或通过 JSF 中的 jQuery 调用支持 bean 方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T17:55:20.817

是的，如果您通过 HTTP 公开 Backing Bean（即使用类似 RESTeasy、Servlet 等的东西）。

但是使用 ajax4jsf 之类的东西更容易。如果需要，可以使用 ajax4jsf 的 a4j:jsFunction 作为 jQuery 和支持 bean 之间的中介。

# sql - SQL Server 2008 中 PIVOT 的更新

> ID：726582
> 
> 赞同：1
> 
> 时间：2009-04-07T16:36:00.257
> 
> 标签：sql, sql-server, sql-server-2008, pivot, pivot-table

假设没有聚合，有没有办法对 SQL Server 2008 中的 PIVOTed 表执行更新，其中更改传播回源表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:20:16.350

`PIVOT`s 在 pivot 子句中总是需要一个聚合函数。

因此总是有聚合。

所以，不，它不能更新。

**您`INSTEAD OF TRIGGER`可以根据该语句放置一个视图，因此您可以使任何视图可更新。**

[这里的](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=120679)例子

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T17:12:19.033

只有当透视列形成唯一标识符时，这才会真正起作用。那么让我们以Buggy的例子为例；这是原始表格：

```
TaskID    Date    Hours 
```

我们想把它变成一个看起来像这样的表格：

```
TaskID    11/15/1980    11/16/1980    11/17/1980 ... etc. 
```

为了创建枢轴，您将执行以下操作：

```
DECLARE @FieldList NVARCHAR(MAX)

SELECT
    @FieldList =
    CASE WHEN @FieldList <> '' THEN 
        @FieldList + ', [' + [Date] + ']' 
    ELSE 
        '[' + [Date] + ']' 
    END
FROM
    Tasks

DECLARE @PivotSQL NVARCHAR(MAX)
SET @PivotSQL = 
    '
        SELECT 
            TaskID
            , ' + @FieldList + '
        INTO
            ##Pivoted
        FROM 
            (
                SELECT * FROM Tasks
            ) AS T
        PIVOT
            (
                MAX(Hours) FOR T.[Date] IN (' + @FieldList + ') 
            ) AS PVT
    '

EXEC(@PivotSQL) 
```

那么你有你的数据透视表`##Pivoted`。现在您对小时字段之一执行更新：

```
UPDATE
    ##Pivoted
SET
    [11/16/1980 00:00:00] = 10
WHERE
    TaskID = 1234 
```

现在`##Pivoted`有一个在 1980 年 11 月 16 日发生的任务的小时更新版本，我们希望将其保存回原始表，因此我们使用`UNPIVOT`：

```
DECLARE @UnPivotSQL NVarChar(MAX)
SET @UnPivotSQL = 
    '
        SELECT
              TaskID
            , [Date]
            , [Hours]
        INTO 
            ##UnPivoted
        FROM
            ##Pivoted
        UNPIVOT
        (
            Value FOR [Date] IN (' + @FieldList + ')
        ) AS UP

    '

EXEC(@UnPivotSQL)

UPDATE
    Tasks
SET
    [Hours] = UP.[Hours]
FROM
    Tasks T
INNER JOIN
    ##UnPivoted UP
ON
    T.TaskID = UP.TaskID 
```

您会注意到我修改了 Buggy 的示例以删除按星期几的聚合。那是因为如果您执行任何类型的聚合，就没有回头路和更新。如果我更新 SUNHours 字段，我如何知道我正在更新哪个星期日的时间？这仅在没有聚合的情况下才有效。我希望这有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:41:19.883

这只是一个猜测，但你能把查询变成一个视图然后更新它吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T17:41:41.333

我不相信这是可能的，但是如果您发布有关您尝试解决的实际问题的详细信息，那么某人可能会就不同的处理方法给您一些建议。

# mocking - Rhino Mocks：模拟方法返回 null

> ID：726583
> 
> 赞同：3
> 
> 时间：2009-04-07T16:36:16.340
> 
> 标签：mocking, rhino-mocks

我正在尝试模拟一个数据存储库对象，但是在对我的 MockRepository 设置期望之后，它每次都返回 null。我的代码如下：

 `````
 [Test]
    public void GetById_NotNull()
    {
        Person expectedPerson = new Person() { Id = 1, Name="Jon"};

        MockRepository MockRepository = new MockRepository();
        var FakePersonRepository = MockRepository.StrictMock<IRepository<Person>>();

        FakePersonRepository.Expect(action => action.Get(1)).IgnoreArguments().Return(expectedPerson);

        PersonService PersonService = new PersonService(FakePersonRepository);
        Person returnedPerson = PersonService.Get(1);

        Assert.IsNotNull(returnedPerson);
    }

    //and inside my person service
    public class PersonService
    {
         private IRepository<Person> _PersonRepository;
         public PersonService(IRepository<Person> PersonRepository)
         {
           this._PersonRepository = PersonRepository;
         }

         public Person Get(int Id)
         {
             Person p = _PersonRepository.Get(Id);
             return p;
          }
    } 
```` 

`测试底部的断言失败，返回的人始终为空。我知道我的模拟肯定做错了......想法？`

 `* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T16:38:57.613

尝试做一个

```
mockRepository.ReplayAll() 
```

在你设置期望的那一行之后。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T16:59:22.977

正如其他人所说，我相信您将需要在某个地方使用您正在使用的测试风格进行重播；作为替代方案，您可以使用[较新的 AAA 语法](http://ayende.com/Blog/archive/2008/05/16/Rhino-Mocks--Arrange-Act-Assert-Syntax.aspx)以及不需要重播的静态 MockRepository.GenerateMock<>()/MockRepository.GenerateStub<>() 方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T16:43:23.250

我对 RhinoMocks 不是很熟悉（我一直在使用 Moq），但不能：

```
FakePersonRepository.Expect(action => action.Get(1)).IgnoreArguments().Return(expectedPerson); 
```

是

```
FakePersonRepository.Expect(action => action.Get(1)).Return(expectedPerson); 
```

我还认为你需要一个带有 RM 的 Replay() 。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-23T09:54:18.050

克里斯在这里很赚钱。AAA 语法并为此场景使用 GenerateStub 是最好的。

```
var FakePersonRepository = MockRepository.GenerateStub<<IRepository<Person>>();
FakePersonRepository.Stub(x => x.Get(1)).Returns(expectedPerson);

PersonService PersonService = new PersonService(FakePersonRepository);
Person returnedPerson = PersonService.Get(1); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-05T15:04:03.800

使用 AAA 语法和 GenerateMock，您还可以验证是否使用正确的参数和正确的次数调用了 PersonRepository：

```
Person expectedPerson = new Person() { Id = 1, Name="Jon"}; 

MockRepository MockRepository = new MockRepository(); 
var FakePersonRepository = MockRepository.GenerateMock<IRepository<Person>>(); 

FakePersonRepository.Expect(action => action.Get(1)).Return(expectedPerson).Repeat.Once(); 
PersonService PersonService = new PersonService(FakePersonRepository); 
Person returnedPerson = PersonService.Get(1); 

Assert.IsNotNull(returnedPerson); 
FakePersonRepository.VerifyAllExpectations(); 
```

# gmail - 通过 DotNetOpenId 检索 GMail 数据

> ID：726588
> 
> 赞同：5
> 
> 时间：2009-04-07T16:38:56.100
> 
> 标签：gmail, dotnetopenauth

我正在尝试使用 dotNetOpenId 登录到 GMail 帐户。它有效，但我无法检索任何索赔。我知道我也可以检索电子邮件地址或用户名，但是只有**ClaimedIdentifier**可用，才会返回任何声明。有人知道如何从 Gmail 帐户中检索这些数据吗？如果您能提供一个 ClaimsRequest 配置的示例，我将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T13:43:51.930

```
// Either you're creating this already or you can get to it in 
// the LoggingIn event of the control you're using.

IAuthenticationRequest request;

// Add the AX request that says Email address is required.
var fetch = new FetchRequest();
fetch.Attributes.Add(
    new AttributeRequest(WellKnownAttributes.Contact.Email, true));
request.AddExtension(fetch); 
```

然后，Google 对用户进行身份验证并返回您可以使用的电子邮件地址：

```
var fetch = openid.Response.GetExtension<FetchResponse>();  
if (fetch != null) 
{  
    IList<string> emailAddresses = fetch.GetAttribute(
        WellKnownAttributes.Contact.Email).Values;  
    string email = emailAddresses.Count > 0 ? emailAddresses[0] : null;  
} 
```

您可以查看[我关于该主题的博客文章](http://blog.nerdbank.net/2008/07/how-to-use-dotnetopenid-attribute.html)以获取更多信息。这里需要注意的重要一点是，如果您将其标记为必需，Google 只会告诉您用户的电子邮件地址（正如我在上面的代码段中所做的那样）。但这也意味着如果用户不想分享他的电子邮件地址，他就根本无法登录。抱歉，Google 就是这样设置的。不幸的是，人们使用的其他提供者有不同的行为。

# linux - 持续唤醒和睡眠以最大限度地减少 Linux 上的功耗？

> ID：726596
> 
> 赞同：2
> 
> 时间：2009-04-07T16:42:07.607
> 
> 标签：linux, sleep, power-saving

我想纯粹使用 linux pc 来收集 rss 提要，但想尽可能减少它的功耗。

大概我会创建某种 cron 作业来使其进入和退出睡眠模式，或者有更好的方法来解决这个问题吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T16:44:49.363

在 RTC 中设置唤醒警报，然后将计算机置于待机或挂起（到 RAM）模式。一些主板支持从休眠中唤醒（挂起到磁盘），但我想这太慢了。

```
echo `date '+%s' -d '+ 5 minutes'` > /sys/class/rtc/rtc0/wakealarm
echo -n "mem" > /sys/power/state 
```

将“mem”替换为“standby”以表示待机而不是挂起。

顺便提一句。MythTV 的 wiki 有一些更深入的信息结束示例。 [http://www.mythtv.org/wiki/ACPI_Wakeup](http://www.mythtv.org/wiki/ACPI_Wakeup)

# java - 如何重写方法来调用超类的超类方法？

> ID：726599
> 
> 赞同：4
> 
> 时间：2009-04-07T16:43:11.193
> 
> 标签：java, oop, class-design

我的一部分认为这不应该是可能的（即使它是），但我还是会问。

给定以下类层次结构（`Grandparent`并且`Parent`来自第 3 方，因此不受我的控制），我将如何覆盖`myMethod()`in`Child`以绕过覆盖的实现`Parent`并调用 in 中的实现`Grandparent`？

```
class Grandparent {
   public void myMethod() {
      // do stuff
   }
}

class Parent extends Grandparent {
   @Override public void myMethod() {
      super.myMethod();
      // do something else
   }
}

class Child extends Parent {
   @Override public void myMethod() {
      // ??? I want to *only* do what Grandparent did here
   }
} 
```

假设`Parent`该类提供了许多其他有用的行为，并且是`Child`的层次结构的关键元素（换句话说，我不是在寻找“创建`Child`一个子类`Grandparent`”。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T17:07:10.573

**继承**背后的想法是，每个类都根据需要定义其方法，因此您无需检查任何代码。

似乎您在这里进行子类化只是为了重用代码，而这不是子类化的想法。

也许你应该有一个助手成员来完成你需要的一些任务，而不是子类化，并且让“孩子”和“父母”类都扩展“祖父母”。

您需要问自己的主要问题是：“Child 真的是 Parent、Grandparent 或 neiter 的后代吗？” 换句话说，**对于 Child 的每个实例，我可以说它是 Parent**吗？

如果答案是否定的，那么您的子类化是错误的：继承应该意味着某些东西，而不仅仅是代码重用（即**Ford *IS ALSO* a Car**，而不仅仅是“Ford”*使用*“Car”方法）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:53:50.570

假设我无法触摸 Parent 或 Grandparent 中的代码，并假设我不是，正如 Seb 建议的（并且正如 Steve 显然同意的那样）完全滥用继承：

我会创建一个 Grandfather 对象的本地实例（或者一个扩展 Grandfather 的本地类，如果它是抽象的）并直接访问它对 myMethod() 的解释。当然，根据 myMethod() 应该读取和/或操作多少状态信息，所涉及的工作量可能从“容易”到“难以忍受”。

这是一个丑陋的解决方案，并且根据访问的状态信息量，可能会非常脆弱。但是如果 Grandfather 可靠稳定和/或 myMethod() 相当独立，它可以工作。魔鬼在细节中，一如既往。

我绝对同意 Seb 的观点，即这是重用，而不是继承。但是，嘿。重复使用通常是一件好事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T16:44:39.677

不可能。

我会`final`在祖父母中创建一个辅助方法。并让这个方法（被覆盖）调用那个助手。

```
class Grandparent {
   public final void myHelperMethod() {
      // do stuff
   }
   public void myMethod() {
      myHelperMethod();
   }
}

class Parent extends Grandparent {
   @Override public void myMethod() {
      super.myMethod();
      // do something else
   }
}

class Child extends Parent {
   @Override public void myMethod() {
      // ??? I want to *only* do what Grandparent did here
      myHelperMethod();
   }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T16:58:09.987

您可以控制 Parent 类吗？

如果是这样，您是否可以向父级添加一个方法（myNewMethod），该方法在祖父级上调用 myMethod，并从子级调用 myNewMethod？

（我不是Java人，所以不知道您是否只能从子类中的该方法的覆盖中调用超类中的方法）

```
class Grandparent {
   public void myMethod() {
      myHelperMethod();
   }
}

class Parent extends Grandparent {
   @Override public void myMethod() {
      super.myMethod();
      // do something else
   }
   public final void myNewMethod() {
      super.myMethod();
   }
}

class Child extends Parent {
   @Override public void myMethod() {
      // ??? I want to *only* do what Grandparent did here
      myNewMethod();
   }
} 
```

# c# - 如何：在检查不可用的网络共享时防止超时 - C#

> ID：726602
> 
> 赞同：16
> 
> 时间：2009-04-07T16:43:41.190
> 
> 标签：c#, windows, networking, filesystems

我们有一些基本的 C# 逻辑，它遍历一个目录并返回其中的文件夹和文件。当针对无法访问或无效的网络共享 (\\server\share\folder) 运行时，代码似乎“挂起”大约 30 秒，然后从调用返回。

我想最终得到一种方法，该方法将尝试从给定路径获取文件夹和文件，但**没有超时**期限。换句话说，完全减少或消除超时。

我已经尝试过一些简单的方法，例如提前验证目录的存在，认为“不可用”的网络驱动器会很快返回错误，但这并没有按预期工作。

```
System.IO.Directory.Exists(path) //hangs 

System.IO.DirectoryInfo di = new System.IO.DirectoryInfo(path); //hangs 
```

关于什么可以帮助我实现高效（并且希望管理）解决方案的任何建议？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2011-08-18T15:51:27.473

您可以使用以下代码：

```
var task = new Task<bool>(() => { var fi = new FileInfo(uri.LocalPath); return fi.Exists; });
task.Start();

return task.Wait(100) && task.Result; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T16:46:17.597

把它放在自己的线程上，如果它在一定时间内没有回来，继续前进。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:46:26.940

或许您可以先尝试 ping 服务器，然后仅在收到响应时询问目录信息？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-17T12:15:08.060

看...

[更快的 DirectoryExists 函数？](https://stackoverflow.com/questions/1438923/faster-directoryexists-function)

...用于设置 Directory.Exists 执行时间的方法

# class - 页面视图类设计

> ID：726614
> 
> 赞同：1
> 
> 时间：2009-04-07T16:46:59.217
> 
> 标签：class, view

假设我有以下课程。

```
public class Location
{
    public Id { get; set;}
    public Name { get; set;}
} 
```

我有一个名为 Location 的网页，看起来像这样。

```
txtId  
txtName 

txtCountStaffWorkersAtLocation 
txtCountVehiclesAtLocation
txtCountNonStaffWorkersAtLocation 
txtCountetc

listViewPersonnel
listViewVehicles 
```

现在我正在调用存储库以在视图上显示 Location 字段，但我对获取和显示其他字段数据的正确方法感到困惑。它们显然与位置类关系不大。当我从数据库设置位置类时，我是否将计数放在位置类中并填写它们？我在某个地方有一个结构对象，它只有这些计数字段吗？你们通常如何处理与域对象关系不大的页面上显示的对象？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T16:57:22.000

我建议将 StaffPersonnel、NonStaffPersonnel 和 Vehicles 实现为 Location 对象的属性，其中每个属性都返回关联对象的集合。然后对于计数，您可以从位置对象中获取如下属性：

```
loc.Vehicles.Count
loc.StaffPersonnel.Count
loc.NonStaffPersonnel.Count 
```

# perl - 向 Squid 代理用户发送消息

> ID：726623
> 
> 赞同：1
> 
> 时间：2009-04-07T16:48:43.660
> 
> 标签：perl, unix, redirect, proxy

当用户第一次通过 squid 代理服务器启动会话时，是否可以向用户发送自定义 HTML 消息？

我希望能够将用户的第一个请求重定向到“今日消息”....然后他们在会话剩余时间内的其余浏览请求不会被重定向......详细步骤：

1.  用户打开浏览器。（浏览器配置为使用 Squid 代理）
2.  用户打开`http://google.com`（或他们选择的其他网址）
3.  他们没有得到 Google.com，而是被重定向到`http://somewhere.else.com/MOD.html`
4.  用户阅读MOD
5.  用户`http://google.com`再次输入（或他们选择的其他 url） 这次浏览器无需重定向即可到达正确的目的地。

我是否必须开发或定位一个 Squid 代理服务器插件来执行这种操作，还是 SQUID 服务器可以用一些自定义代码来完成？（Perl 等）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:06:11.527

squid conf 中有一行可以添加，例如 redirect_script。编写一个接受输入的 Perl 程序 - 每行一个 URL。它输出您要将用户重定向到的 url。UpsideDownTernet脚本[就是](http://www.ex-parrot.com/~pete/upside-down-ternet.html)一个示例。

现在将脚本更改为第一次输出您的 MOTD，并且每隔一次将 URL 回显。

问题是，你如何区分用户请求？那么此时您需要使用redirect_program 行而不是redirect_script ...

Squid 将向程序传递几个参数：

```
 URL ip-address/fqdn ident method

 URL    is the URL requested
 ip-address/fqdn    is the IP address or fully qualified domain name of the client   (web browser) which requested the page.
 ident  is the identity of the user running the web browser. Unless you configure   squid to do ident lookups, this will be "-".
 method is the request method: "GET", "POST", "HEAD" 
```

参考：[http ://taz.net.au/block/](http://taz.net.au/block/)

此时，您可以修改脚本以确定每个用户在看到 MOTD 之间的“超时”（例如，如果他 12 小时没有访问网站，他会收到消息）或其他任何东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-07T13:13:47.823

我遇到了一本关于 Squid 的好书，名为 Squid Proxy Server 3.1：Packt 的初学者指南。你可以在这里阅读更多关于它的信息[https://www.packtpub.com/squid-proxy-server-31-beginners-guide/book](https://www.packtpub.com/squid-proxy-server-31-beginners-guide/book)。也许它会派上用场

# excel - VBA：如何防止 QueryTable 刷新？

> ID：726629
> 
> 赞同：0
> 
> 时间：2009-04-07T16:49:33.360
> 
> 标签：excel, vba, csv, import

我编写了一个宏，它使用 QueryTable 将 CSV 文件导入到我的电子表格中。我的目标是导入 CSV 数据并能够将其保存在电子表格中以供将来参考。

但是，QueryTable 会使用外部 CSV 文件进行更新，当然，我想防止这种情况发生（因为我想忘记外部文件）。是否有可用于防止刷新的 QueryTable 设置，或者这是完全使用的错误功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T17:31:00.767

好吧..如果您的目标是导入数据而不是使该数据保持最新（即再次使用 CSV 刷新），那么在您的 VBA 结束时，在查询表的 .Refresh 命令之后，只需删除查询桌子。

例如
Sheet1.QueryTables(1).Refresh (False)
Sheet1.QueryTables(1).Delete

请务必将 False 传递给刷新命令以要求 Excel 进行前台查询，您的代码执行将一直持续到您获取数据。然后您添加查询表的单元格将被视为常规单元格。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T17:03:42.517

您可以使用 VBA 将 CSV 作为工作簿打开。像这样的东西。

```
Set myCSVbook = Workbooks.Open Filename:="C:\dir\myfile.csv", Format:=2 '2 is csv 
```

完成此操作后，您可以复制单个单元格，或者您可以将整个工作表复制到另一行中的另一个工作簿中。我认为 Worksheet 对象上有一个 Copy 方法可以做到这一点。

# c# - 使用 Moq 验证参考参数的值

> ID：726630
> 
> 赞同：18
> 
> 时间：2009-04-07T16:50:25.557
> 
> 标签：c#, mocking, tdd, moq-3

我刚刚切换到起订量并遇到了问题。我正在测试一种方法，该方法创建业务对象的新实例，根据用户输入值设置对象的属性并调用方法 (SaveCustomerContact) 来保存新对象。业务对象作为 ref 参数传递，因为它通过远程处理层。我需要测试传递给 SaveCustomerContact 的对象是否按预期设置了所有属性，但是因为它在控制器方法中被实例化为新对象，所以我似乎无法这样做。

```
public void AddContact() {

    var contact = new CustomerContact() { CustomerId = m_model.CustomerId };

    contact.Name = m_model.CustomerContactName;
    contact.PhoneNumber = m_model.PhoneNumber;
    contact.FaxNumber = m_model.FaxNumber;
    contact.Email = m_model.Email;
    contact.ReceiveInvoiceFlag = m_model.ReceiveInvoiceFlag;
    contact.ReceiveStatementFlag = m_model.ReceiveStatementFlag;
    contact.ReceiveContractFlag = m_model.ReceiveContractFlag;
    contact.EmailFlag = m_model.EmailFlag;
    contact.FaxFlag = m_model.FaxFlag;
    contact.PostalMailFlag = m_model.PostalMailFlag;
    contact.CustomerLocationId = m_model.CustomerLocationId;

    RemotingHandler.SaveCustomerContact( ref contact );
} 
```

这是测试：

```
[TestMethod()]
public void AddContactTest() {

    int customerId = 0;

    string name = "a";

    var actual = new CustomerContact();

    var expected = new CustomerContact() {
        CustomerId = customerId,
        Name = name
    };

    model.Setup( m => m.CustomerId ).Returns( customerId );
    model.SetupProperty( m => model.CustomerContactName, name );
    model.SetupProperty( m => m.PhoneNumber, string.Empty );
    model.SetupProperty( m => m.FaxNumber, string.Empty );
    model.SetupProperty( m => m.Email, string.Empty );
    model.SetupProperty( m => m.ReceiveInvoiceFlag, false );
    model.SetupProperty( m => m.ReceiveStatementFlag, false );
    model.SetupProperty( m => m.ReceiveContractFlag, false );
    model.SetupProperty( m => m.EmailFlag, false );
    model.SetupProperty( m => m.FaxFlag, false );
    model.SetupProperty( m => m.PostalMailFlag, false );
    model.SetupProperty( m => m.CustomerLocationId, 0 );

    remote
        .Setup( r => r.SaveCustomerContact( ref actual ) )
        .Callback( () => Assert.AreEqual( actual, expected ) );

    target.AddContact();

} 
```

这只是获得该参数的许多尝试中的最新一次。作为参考，actual 的值不会从其初始（构造）状态改变。

在目标调用失败后移动 Assert.AreEqual(expected, actual)。如果我将 .Verifiable() 而不是 .CallBack 添加到设置中，然后在目标之后调用 remote.Verify （或者，我假设，将模拟设置为严格）它总是失败，因为我在测试中提供的参数不是与在控制器方法中创建的实例相同。

我正在使用起订量 3.0.308.2。任何关于如何测试它的想法将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-07T17:33:51.680

我无法为您提供确切的解决方案，但另一种方法是将传递引用语义隐藏在适配器后面，该适配器按值获取参数并将其转发给 RemotingHandler。这将更容易模拟，并且会从界面中删除“ref”疣（我总是怀疑 ref 参数:-)）

编辑：

或者您可以使用存根代替模拟，例如：

```
public class StubRemotingHandler : IRemotingHandler
{
    public CustomerContact savedContact;

    public void SaveCustomerContact(ref CustomerContact contact)
    {
        savedContact = contact;
    }
} 
```

您现在可以检查测试中保存的对象：

```
IRemotingHandler remote = new StubRemotingHandler();
...
//pass the stub to your object-under-test
...
target.AddContact();
Assert.AreEqual(expected, remote.savedContact); 
```

您还在评论中说：

> 我不想开一个包装后端随机位的先例，这样我就可以更轻松地编写测试

我认为这*正是*您需要树立的先例！如果您的代码不可测试，您将继续努力测试它。使测试更容易，并增加您的覆盖范围。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-19T20:41:22.817

最新版本的 Moq 支持这种情况。

摘自[http://code.google.com/p/moq/wiki/QuickStart](http://code.google.com/p/moq/wiki/QuickStart)上的快速入门：

```
// ref arguments
var instance = new Bar();
// Only matches if the ref argument to the invocation is the same instance
mock.Setup(foo => foo.Submit(ref instance)).Returns(true); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-07T17:24:18.237

不幸的是，如果没有起订量的直接支持，我不确定这是否可行。问题是 Lambda 表达式不支持 ref 或 out。

> “lambda 表达式不能直接从封闭方法中捕获 ref 或 out 参数。”

[http://msdn.microsoft.com/en-us/library/bb397687.aspx](http://msdn.microsoft.com/en-us/library/bb397687.aspx)

我什至找不到像你这样的例子。将 ref 添加到设置中无法编译。

**您可能想查看起订量讨论以了解更多** [http://groups.google.com/group/moqdisc](http://groups.google.com/group/moqdisc)

祝你好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-05T18:14:27.973

我遇到过类似的问题。位我通过使用最新的最小起订量并传递像这样的值得到了解决方案

var instance = new Bar(); Mock.Setup(foo => foo.Submit(ref instance)).Returns(true);

早些时候，我也使用相同的方法，但我没有得到回报。

在实际函数实例内部被创建并覆盖从单元测试类传递的实例导致问题。我在实际类中删除了实例创建，然后它起作用了。

希望它会帮助你。

谢谢

# c# - System.Windows.Forms.Keys 枚举器中的 AltGr

> ID：726634
> 
> 赞同：3
> 
> 时间：2009-04-07T16:52:40.357
> 
> 标签：c#, .net, winforms

应该是一件容易的事。`AltGr`System.Windows.Forms.Keys 枚举器中键的值是多少？

我已经看过了，看不到任何明显的东西（'AltrGr' no，'RAlt' no，'GrAlt' no）。

**更新 - 回答：**

```
if (ModifierKeys == ( Keys.Control | Keys.Alt ) )
{
    // AltGr is held down
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2015-03-01T11:48:08.587

大多数键盘仍然包含此键**。**

你正在寻找`RMenu`.

[MSDN](https://msdn.microsoft.com/en-us/library/system.windows.forms.keys)说明：

> 右 ALT 键。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:23:03.203

根据我对 Google 的最小研究，在 Windows 中，您可以替换 Ctrl + Alt 以获得等效的 AltGr 键。我认为新键盘不再有那个键了。

克里斯

# java - 使用 JVisualVM 从 Java 中的远程应用程序获取堆转储

> ID：726643
> 
> 赞同：11
> 
> 时间：2009-04-07T16:56:35.653
> 
> 标签：java, monitoring, heap-memory, jvisualvm

我运行 JVisualVM（Windows XP、Sun Java 1.6.0.13、32 位客户端 VM）来监控远程应用程序（Linux、Sun Java 1.6.0.07、64 位服务器 VM）。在启动实际的远程应用程序之前，我`jstatd`使用所有访问策略在远程计算机上启动：

```
grant codebase "file:${java.home}/../lib/tools.jar" {
   permission java.security.AllPermission;
}; 
```

然后我使用命令行启动实际的应用程序

```
 java -Dcom.sun.management.jmxremote.authenticate=false 
-Dcom.sun.management.jmxremote.ssl=false 
-Dcom.sun.management.jmxremote.port=3333 
compileTest.Main 
```

从客户端机器上，我可以看到远程应用程序并对其进行监控。我也可以进行线程转储等。不幸的是，堆转储按钮是灰色的。

如何使用 JVisualVM 从远程监控的应用程序中获取堆转储？

我尝试使用 jConsole。使用 jConsole，可以使用 com.sun.management.HotSpotDiagnostic dumpHeap 操作进行*远程*堆转储。我希望将转储传输到客户端并使用 JVisualVM 提供的工具进行分析。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T12:08:02.333

有办法做到这一点！

1.  rmir​​egistry -J-Xbootclasspath/p:$JAVA_HOME/lib/sa-jdi.jar （这使用端口 1099）
2.  在运行应用程序的机器上启动“jsadebugd”：jsadebugd & (JVM 的 pid)
3.  在远程机器上使用以下 jmap -dump:file= :1099

4.  贾特

以上将在端口 7000 启动一个 Web 应用程序

以上所有工具都是 JDK 1.6 的一部分

一切顺利！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-01T17:45:47.320

不幸的是，没有一种自动化的方法可以做到这一点。您必须在 Linux 服务器上手动运行 jmap 以转储 JVM 的堆，然后将生成的堆转储复制到运行 JVisualVM 的本地计算机并使用 File|Load... 将堆转储加载到 JVisualVM 中进行分析。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-02T04:03:06.810

从 1.3 开始，VisualVM 支持远程堆转储：

> 从 VisualVM 1.3 开始，您现在可以使用工具中的堆转储操作和按钮来获取远程运行的应用程序的堆转储。调用时，将显示一个对话框，您可以在其中指定要转储堆的远程系统上的完整路径。创建堆转储后，您需要手动将文件复制到本地计算机并使用 Load 操作打开并使用 VisualVM 分析文件。

参见：[VisualVM 1.3 发布](https://blogs.oracle.com/nbprofiler/entry/visualvm_1_3_released)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T21:01:16.067

您无法远程分析堆。您可以在服务器上运行 visualvm 并将 x 会话导出到本地计算机。您必须在服务器上安装 x11，而许多服务器没有。

# c# - 如何获取方法调用历史？

> ID：726644
> 
> 赞同：0
> 
> 时间：2009-04-07T16:57:09.520
> 
> 标签：c#, .net, exception, exception-handling

我正在尝试获取从 try 块开始到异常的调用列表。在下面的代码中，当我陷入 Catch 块时，Exception 对象中的 StackTrace 如下：

> 在 ConsoleApplication.Program.MethodC() / 在 ConsoleApplication.Program.Main(String[] args)。

这是完全可以预料的，但不能帮助我获取通话记录。有人知道我该怎么做吗？

```
static void MethodA() { }
static void MethodB() { }
static void MethodC() { throw new Exception(); }

static void Main(string[] args)
{
    try
    {
        MethodA();
        MethodB();
        MethodC();
    }
    catch (Exception e)
    {
        // Get list of calls
        throw;
    }
} 
```

我惊讶地发现 Exception 对象的 StackTrace 属性不是 StackTrace 对象。这有什么原因吗？

最后，这一切的目的很简单。如果在代码执行过程中抛出异常，我想查看每个调用的方法的元数据（属性）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T17:05:38.813

据我了解您的问题，您希望能够知道在您的 try 块中 MethodC*之前调用了哪些方法。*我认为如果不向方法中添加代码就无法做到这一点。

当 MethodA 完成执行时，它不再在堆栈上，因此您无法从任何地方获取信息。MethodB 也是如此，当异常发生时只有 MethodC 在堆栈上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T17:06:55.567

除非您向每个方法添加自定义日志记录代码，否则您似乎无法获得使用 try 块调用的每个方法的堆栈跟踪。但是，您可以通过将对象传递给构造函数来`System.Diagnostics.StackTrace`轻松地从异常中创建选项。`Exception`这将提供有关堆栈跟踪的所有信息，包括是否从 MethodA/MethodB/MethodC 抛出异常，这可能至少对您有所帮助。

示例代码：

```
static void MethodA() { }
static void MethodB() { }
static void MethodC() { throw new Exception(); }

static void Main(string[] args)
{
    try
    {
        MethodA();
        MethodB();
        MethodC();
    }
    catch (Exception e)
    {
        System.Diagnostics.StackTrace callStack = new System.Diagnostics.StackTrace(e);
        System.Diagnostics.StackFrame frame = null;
        System.Reflection.MethodBase calledMethod = null;
        System.Reflection.ParameterInfo[] passedParams = null;
        for (int x = 0; x < callStack.FrameCount; x++)
        {
            callStack.GetFrame(x);
            calledMethod = frame.GetMethod();
            passedParams = calledMethod.GetParameters();
            foreach (System.Reflection.ParameterInfo param in passedParams)
                System.Console.WriteLine(param.ToString());
        }
    }
} 
```

（您可以看到包含代码的原始答​​案的[这个 SO 线程](https://stackoverflow.com/questions/157911/in-a-net-exception-how-to-get-a-stacktrace-with-argument-values)。我只是稍微修改了它。）

希望这至少是您问题的部分解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:07:38.917

您可以轻松地从代码中的任何位置获取[StackTrace](https://stackoverflow.com/questions/620959/getting-the-stacktrace)对象，但正如已经指出的那样，您无法获取方法调用的完整历史记录。

# php - 哪个 Linux 发行版最适合在虚拟机中运行，用于编程研究？

> ID：726649
> 
> 赞同：4
> 
> 时间：2009-04-07T16:57:54.510
> 
> 标签：php, linux, apache, virtualization

我想学习 LAMP 开发，以供我个人熏陶。

我尝试在 Microsoft VPC 中设置 Ubuntu 8.10 “Hardy Heron”，但我无法让视频在 800x600 以上工作。xorg.conf 玩了一百万次，但没有乐趣。谁能推荐一个与 VPC 配合得很好的发行版？也欢迎任何有关 Apache 和 Perl/PHP 入门的指导。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T17:05:00.797

我在我的 Vista 64 位笔记本电脑上的虚拟机中安装了 ubuntu 8.10。我尝试使用 SUN 的 Virtual PC、VM Ware 和 Virtual Box 进行安装。Virtual Box 是我从一开始就成功使用的唯一 vm 软件。在设置中，您选择将 linux 安装为您的客户操作系统，并且一切正常，而无需花费您晚上的时间来筛选试图让安装工作的博客。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T01:04:45.347

首先，如果您的目标是学习 LAMP 开发，我会首先从[http://www.wampserver.com/en/](http://www.wampserver.com/en/)或其竞争对手之一下载适用于 Windows 的 WAMP 堆栈。LAMP 编程的“Linux”部分不太可能成为您学习经历的主要部分。避免运行 VM 将大大减少开发工作站上的资源密集度，并避免出现挂起/恢复和磁盘 IO 争用问题。

其次，任何 linux 都应该在 virtualbox 或 msvpc 下工作。所有现代桌面虚拟化系统都模拟一个完整的系统，所以这只是配置和获取正确驱动程序的问题。就像其他人说的那样，virtualbox 对开源更友好，所以试一试。

最后，我通常不在我的开发虚拟机上运行 X，因为它只会消耗不必要的资源。只需在主机上使用 putty 并通过 ssh 连接到以控制台模式运行的 VM。

不完全是您问题的答案，但我认为它更直接地攻击了您的目标。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T17:35:18.167

如果您不喜欢 VPC，一个快速开始的方法可能是下载免费的 VMWare Player，网址为

[http://vmware.com/products/player/](http://vmware.com/products/player/)

然后你可以在这里尝试为 VMWare 预先打包的许多发行版中的任何一个：

[http://vmware.com/appliances/directory/cat/508](http://vmware.com/appliances/directory/cat/508)

第二个链接中的设备应该可以开箱即用，因此您不必摆弄 X conf 文件，这可能不是您研究的主题。作为奖励，您可能会接触到您通常不知道的发行版。

编辑：这是一个带有 Ubuntu 8.10 的设备：

[http://www.vmware.com/appliances/directory/54735](http://www.vmware.com/appliances/directory/54735)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T17:09:24.357

[http://www.virtualbox.org/wiki/Guest_OSes](http://www.virtualbox.org/wiki/Guest_OSes)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T17:20:39.650

这在很大程度上是一个偏好问题。如前所述，Ubuntu 是一个不错的选择。我更喜欢[debian](http://www.debian.org)，因为它的前沿性稍差一些（因此更稳定）。但它不像 Ubuntu 那样容易学习。

正如还指出的那样，我会推荐 VirtualBox，因为 Virtual PC 不支持非 MS 操作系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T17:00:09.777

我使用 Ubuntu 8.10 和 Mono。

但是，要使图形正常工作，您需要

```
noreplace-paravirt 
```

内核参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T20:09:24.457

我使用的是 Scientific Linux 5.2（它只是重新命名的 RedHat Enterprise Linux 5.2），它运行良好。我在 Ubuntu 的许多版本上也取得了成功。我在 VMWare 服务器下运行我的所有机器，并成功地将它们与 1.0.x 版本和 2.0.x 版本的 VMWare 服务器一起使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T00:38:51.743

必须是 Microsoft Virtual PC 吗？ [Virtual Box](http://www.virtualbox.org)对开源更加友好，我使用它来显示更高分辨率的来宾操作系统没有问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T00:48:48.490

检查 Bitnami 堆栈。它们是 ISO 实时磁盘映像。您只需要将 iso 附加到虚拟机的引导光盘。有一个基于 Ubuntu 的 LAMP 堆栈。如果您喜欢它的工作方式，可以选择安装到虚拟磁盘。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T01:05:45.937

我能够让 VMWare Server（免费）在 Ubuntu 上正常工作，而无需太多麻烦（显示等工作开箱即用）。在 VM 上安装 VMWare 工具（它们适用于 linux），您将获得更无缝的体验。我的具体配置：

*   VMWare 服务器 2.0
*   主机操作系统：Windows XP Pro、SP 3
*   来宾操作系统：KUbuntu 0804

# java - 在 Java 中创建“逻辑异或”运算符

> ID：726652
> 
> 赞同：289
> 
> 时间：2009-04-07T16:58:50.313
> 
> 标签：java, operators, xor

## 观察：

Java 有一个逻辑 AND 运算符。
Java 有一个逻辑 OR 运算符。
Java 有一个逻辑 NOT 运算符。

## 问题：

[根据 sun](http://java.sun.com/docs/books/tutorial/java/nutsandbolts/operators.html)的说法， Java 没有逻辑 XOR 运算符。我想定义一个。

## 方法定义：

作为一种方法，它简单地定义如下：

```
public static boolean logicalXOR(boolean x, boolean y) {
    return ( ( x || y ) && ! ( x && y ) );
} 
```

## 方法调用：

该方法的调用方式如下：

```
boolean myVal = logicalXOR(x, y); 
```

## 运算符用法：

我宁愿有一个运算符，使用如下：

```
boolean myVal = x ^^ y; 
```

## 问题：

我找不到任何关于如何在 Java 中定义新运算符的信息。我应该从哪里开始？

* * *

## 回答 #1

> 赞同：736
> 
> 时间：2009-04-07T17:02:55.747

Java**确实有一个逻辑 XOR 运算符**，它是[^](https://stackoverflow.com/questions/460542/-operator-in-java)（如 中`a ^ b`）。

除此之外，您不能在 Java 中定义新的运算符。

**编辑：**这是一个例子：

```
public static void main(String[] args) {
    boolean[] all = { false, true };
    for (boolean a : all) {
        for (boolean b: all) {
            boolean c = a ^ b;
            System.out.println(a + " ^ " + b + " = " + c);
        }
    }
} 
```

输出：

```
假 ^ 假 = 假
假 ^ 真 = 真
真 ^ 假 = 真
真 ^ 真 = 假

```

* * *

## 回答 #2

> 赞同：323
> 
> 时间：2009-04-07T17:04:41.903

不是 x != y 吗？

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-04-07T18:10:41.090

> Java 有一个逻辑 AND 运算符。
> Java 有一个逻辑 OR 运算符。

错误的。

Java有

*   两个逻辑 AND 运算符：普通 AND 是 &，短路 AND 是 &&，以及
*   两个逻辑或运算符：正常的 OR 是 | 短路或为||。

XOR 仅作为 ^ 存在，因为不可能进行短路评估。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2009-04-07T20:39:58.750

`&`可能你误解了and和的区别 快捷操作符 and 的目的`&&`是`|`第一个操作数的值可以决定结果，所以第二个操作数不需要计算。`||``&&``||`

如果第二个操作数会导致错误，这将特别有用。例如

```
if (set == null || set.isEmpty())
// or
if (list != null && list.size() > 0) 
```

但是，对于*XOR*，您始终必须评估第二个操作数才能获得结果，因此唯一有意义的操作是`^`。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2013-06-04T06:09:22.907

你可以写`(a!=b)`

这与`a ^ b`.

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-04-07T17:02:04.733

那是因为运算符重载是他们特意从语言中遗漏的东西。他们用字符串连接“欺骗”了一点，但除此之外，这样的功能不存在。

（免责声明：我没有使用过 java 的最后 2 个主要版本，所以如果它现在发布，我会感到非常惊讶）

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-04-04T14:00:54.040

Java 中的逻辑异或称为`!=`. `^`如果你想混淆你的朋友，你也可以使用。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-04-07T17:13:44.050

Java 中唯一的运算符重载是字符串上的 + （[JLS 15.18.1 字符串连接运算符 +](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#15.18.1)）。

社区多年来一直一分为三，1/3 不想要，1/3 想要，1/3 不在乎。

您可以使用 unicode 创建符号的方法名称...因此，如果您有要使用的符号，则可以执行 myVal = x.$(y); 其中 $ 是符号，而 x 不是原语......但这在某些编辑器中会很狡猾并且是有限的，因为你不能在原语上做到这一点。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2016-04-13T06:54:40.267

以下是您的代码：

```
public static boolean logicalXOR(boolean x, boolean y) {
    return ( ( x || y ) && ! ( x && y ) );
} 
```

是多余的。

为什么不写：

```
public static boolean logicalXOR(boolean x, boolean y) {
    return x != y;
} 
```

?

此外，正如 javashlook[所说](https://stackoverflow.com/a/726665/1421194)，已经有`^`运营商。

`!=`并且`^`对于布尔操作数（您的情况）相同*，但对于整数操作数则不同。

[* 注意：
1\. 它们对`boolean`（原始类型）操作数相同，但对`Boolean`（对象类型）操作数不同。As `Boolean`（对象类型）值可以具有 value `null`。当它的一个或两个操作数是 时，`!=`将返回`false`or ，而在这种情况下将抛出。 2\. 虽然它们的工作方式相同，但它们具有不同的优先级，例如，当与:一起使用时，将被视为，而将被视为（offtopic：哎哟，C 风格的优先级表很烂）。`true``null``^``NullPointerException`
`&``a & b != c & d``a & (b != c) & d``a & b ^ c & d``(a & b) ^ (c & d)`]

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2012-11-28T21:07:34.707

这是java的var arg XOR方法...

```
public static boolean XOR(boolean... args) {
  boolean r = false;
  for (boolean b : args) {
    r = r ^ b;
  }
  return r;
} 
```

享受

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-10-24T09:24:25.023

您可以使用[Xtend（中缀运算符和运算符重载）](http://www.eclipse.org/xtend/documentation/203_xtend_expressions.html#operators)来重载运算符并在 Java 上“停留”

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-10-25T22:21:51.117

你所要求的没有多大意义。除非我不正确，否则您建议您要使用 XOR 以与 AND 和 OR 相同的方式执行逻辑运算。您提供的代码实际上显示了我所指的内容：

```
public static boolean logicalXOR(boolean x, boolean y) {
    return ( ( x || y ) && ! ( x && y ) );
} 
```

您的函数具有布尔输入，当对布尔值使用按位异或时，结果与您提供的代码相同。换句话说，在比较单个位（布尔值）或比较较大值中的单个位时，按位异或已经很有效。把它放到上下文中，就二进制值而言，任何非零值都是 TRUE，只有 ZERO 是 false。

因此，要以与应用逻辑 AND 相同的方式应用 XOR，您要么只使用只有一位的二进制值（给出相同的结果和效率），要么必须将二进制值作为一个整体而不是每个位进行评估。换句话说，表达式 (010 ^^ 110) = FALSE 而不是 (010 ^^ 110) = 100。这将删除操作中的大部分语义含义，并表示您无论如何都不应该使用的逻辑测试。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-08-04T11:37:01.387

我正在使用非常流行的类“org.apache.commons.lang.BooleanUtils”

此方法经过许多用户的测试并且安全。玩得开心。用法：

```
boolean result =BooleanUtils.xor(new boolean[]{true,false}); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-06-06T15:14:11.780

A 和 B 必须是布尔值才能使 != 与 xor 相同，以便真值表看起来相同。您也可以使用 !(A==B) 大声笑。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-12-21T00:17:12.823

这是一个使用 XOR(^) 的例子，来自这个[答案](https://stackoverflow.com/questions/14243922/java-xor-over-two-arrays)

```
byte[] array_1 = new byte[] { 1, 0, 1, 0, 1, 1 };
byte[] array_2 = new byte[] { 1, 0, 0, 1, 0, 1 };

byte[] array_3 = new byte[6];

int i = 0;
for (byte b : array_1)
    array_3[i] = b ^ array_2[i++]; 
```

输出

```
0 0 1 1 1 0 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-03-09T02:14:04.723

因为布尔数据类型像整数一样存储，如果与布尔值一起使用，位运算符 ^ 的功能类似于 XOR 操作。

```
//©Mfpl - XOR_Test.java

    public class XOR_Test {
        public static void main (String args[]) {
            boolean a,b;

            a=false; b=false;
            System.out.println("a=false; b=false;  ->  " + (a^b));

            a=false; b=true;
            System.out.println("a=false; b=true;  ->  " + (a^b));

            a=true;  b=false;
            System.out.println("a=true;  b=false;  ->  " + (a^b));

            a=true; b=true;
            System.out.println("a=true; b=true;  ->  " + (a^b));

            /*  output of this program:
                    a=false; b=false;  ->  false
                    a=false; b=true;  ->  true
                    a=true;  b=false;  ->  true
                    a=true; b=true;  ->  false
            */
        }
    } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-10-21T04:42:09.903

这是一个例子：

给定 2 个 int 值，如果一个为负，一个为正，则返回 true。除非参数“negative”为真，否则只有当两者都为负时才返回真。

```
 public boolean posNeg(int a, int b, boolean negative) {
      if(!negative){
        return (a>0 && b<0)^(b>0 && a<0);
      }
      else return (a<0 && b<0);
    } 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-10-20T13:59:26.593

你需要切换到 Scala 来实现你自己的操作符

[管道示例](https://hackernoon.com/operator-in-scala-cbca7b939fc0)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-05-23T15:28:44.473

可以在 java 8 及更高版本中使用流 API 来实现

```
public static boolean logicalXOR(boolean x, boolean y) {  // can modify to take [] or list of bools
    return Stream.of(x, y)  // modify as per method params
        .filter(bool -> bool)
        .count() == 1;
} 
```

# c# - 在多线程应用程序中使用单例的危险是什么

> ID：726654
> 
> 赞同：9
> 
> 时间：2009-04-07T16:59:41.683
> 
> 标签：c#, .net, multithreading, singleton

我正在考虑在多线程 Win 服务中使用单例进行日志记录，并想知道我可能遇到的一些问题。我已经设置了 get 实例来处理同步

```
 private static volatile Logging _instance;
    private static object _syncRoot = new object();

    private Logging(){}
    public static Logging Instance
    {
        get
        {
            if (_instance==null)
            {
                lock(_syncRoot)
                {
                    if (_instance == null)
                    {
                        _instance = new Logging();
                    }
                }
            }
            return _instance;
        }
    } 
```

还有什么我可能需要担心的吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T17:04:04.807

这对我来说看起来很不错。

有关详细信息，请参阅[在 C# 中实现单例模式](http://csharpindepth.com/Articles/General/Singleton.aspx)。

编辑：不过，应该可能把回报放在锁里。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-07T17:16:39.160

这比其他任何东西都更具信息性。

您发布的是*双重检查锁定算法*-据我所知，您发布的*内容将起作用。*（从 Java 1.5 开始，它也可以在那里工作。）但是，它非常脆弱——如果你弄错了，你可能会引入非常微妙的竞争条件。

我通常更喜欢在静态初始化器中初始化单例：

```
public class Singleton
{
    private static readonly Singleton instance = new Singleton();

    public static Singleton Instance
    {
        get { return instance; }
    }

    private Singleton()
    {
        // Do stuff
    }
} 
```

（如果您想要一点额外的懒惰，请添加一个静态构造函数。）

这种模式更容易正确，而且在大多数情况下也一样。

在我的[C# 单例实现页面](http://csharpindepth.com/Articles/General/Singleton.aspx)上有更多详细信息（也由 Michael 链接）。

至于危险——我想说最大的问题是你失去了可测试性。对于日志记录来说可能还*不错*。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T17:06:15.660

单例有可能成为访问该类所体现的资源的瓶颈，并强制顺序访问原本可以并行使用的资源。

在这种情况下，这可能不是一件坏事，因为您不希望多个项目同时写入您的文件，即使这样我也不认为您的实现会产生这种结果。但这是需要注意的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T17:55:58.147

您需要确保记录器中的每个方法都可以安全地并发运行，即它们不会在没有适当锁定的情况下写入共享状态。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T17:08:26.390

您正在使用被认为是反模式的[双重检查锁定。](http://en.wikipedia.org/wiki/Double_checked_locking_pattern)[Wikipedia](http://en.wikipedia.org/wiki/Singleton_pattern)有针对不同语言的带有和不带有延迟初始化的模式。

创建单例实例后，您当然必须确保所有方法都是线程安全的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T17:17:14.730

更好的建议是在单线程设置步骤中建立记录器，因此可以保证在您需要时它就在那里。在 Windows 服务中，OnStart 是执行此操作的好地方。

您拥有的另一个选择是使用 System.Threading.Interlocked.CompareExchange(T%, T, T) : T 方法来切换。它不那么令人困惑，并且可以保证工作。

```
System.Threading.Interlocked.CompareExchange<Logging>(_instance, null, new Logging()); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-28T22:50:41.543

如果您使用双重检查锁定模式并希望它适用于所有内存模型，则需要首先检查是否需要使用 Thread.VolatileRead() 存在一些争论。可以在[http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/b1932d46-877f-41f1-bb9d-b4992f29cedc/](http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/b1932d46-877f-41f1-bb9d-b4992f29cedc/)阅读辩论的示例。

也就是说，我通常从上面使用 Jon Skeet 的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T17:04:45.790

我认为如果 Logging 实例方法是线程安全的，则无需担心。

# c++-cli - VS2005.NET 项目中的内部引用

> ID：726659
> 
> 赞同：0
> 
> 时间：2009-04-07T17:01:00.650
> 
> 标签：c++-cli

我在 VS2005 中有一个 C++/CLI 类库项目，但我遇到了一些问题。我定义了一个名为 Languages 的类，它是一个枚举类。看起来像这样：

```
"Language.cpp"
namespace Company
{
    namespace product
    {
        public eunm class Languages : int
        {
            English = 1,
            German = 2,
            //etc for other languages
        };
    }
}; 
```

然后我有另一个类试图引用它，它位于同一个命名空间中：

```
"Language.cpp"
namespace Company
{
    namespace product
    {
        public class LanguageConsumer
        {
        public:
            LanguageConsumer()
            {
            }
        public:
            Languages DoSomething(Languages input)
        {
            if (input == Languages::English)
            {
                //Do something and return
            }
        };
    }
}; 
```

但是我的项目没有编译。据我所知，即使认为它们在同一个命名空间中，不同的类也看不到对方。我假设我可能需要头文件和头文件的#includes，但我对 C++/CLI 的了解不够确定（我来自 C# 背景，几乎没有任何 C 经验）并且我尝试过很多我能想到的不同组合。我敢肯定，对于任何知道自己在做什么的人来说，我都遗漏了一些非常明显的东西，但可惜我没有。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T17:14:12.973

C++/CLI 仍然像 C++ 一样编译，文件文件是分开编译然后链接在一起的。这与将所有文件编译在一起的 C# 不同。在编译时，文件彼此不知道，因此代码无法编译（这个枚举是什么？！）。您需要将枚举定义与类放在同一文件（编译单元）中。

执行此操作的简单方法是将代码移动到同一个文件中。头文件解决方案是将枚举定义移动到头文件中，然后将其包含（#include）到另一个文件中。#include 插入另一个文件的文本，产生相同的效果。

# ruby - 如何使用 ruby 和 unix 服务器截取网页截图？

> ID：726660
> 
> 赞同：8
> 
> 时间：2009-04-07T17:01:36.873
> 
> 标签：ruby, unix, gtk, screenshot, rmagick

我正在尝试以编程方式创建大量网页的缩略图，这些网页托管在我自己的基于 ruby​​/rails 的网站上。

我希望能够编写一个独立的 ruby​​ 代码，看起来像这样：

```
require 'awesome-screenshot-maker'

items.each do |id|
  url = "http://foo.com/bar/#{id}"
  shooter = AwesomeScreenshotMaker.new(0.2) # thumbnails are 20% of original
  shooter.capture(url, "/images/thumbnail-#{id}.png")
end 
```

我需要 awesome-screenshot-maker 库（及其依赖项）相当容易在 Linux、Solaris 和 Mac OS X 上构建。理想情况下，它将使用单个“gem install”命令进行安装。

我花了一个下午探索各种选项，包括[Moz snap shooter](http://www.lilik.it/~mirko/Ruby-GNOME2/moz-snapshooter.rb)、[webkit2png](http://www.paulhammond.org/webkit2png/)和[rbwebkitgtk](http://github.com/danlucraft/rbwebkitgtk/tree/master)。它们都在正确的区域，但似乎没有一个适用于所有三个平台。

如果我愿意从我的 Rails 应用程序（而不是网页）输出 PDF，RMagick 看起来是一个可能的选择，但这让我觉得很hacky。在 Mac OS X 上启动和运行 RMagic 和 imagemagick 也非常费力。

是否存在可以在三个平台上轻松设置的库？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T17:18:50.420

[Selenium RC](http://seleniumhq.org/)有一个 Ruby 接口，可以使用[capture_screenshot(filename,kwargs)](http://release.seleniumhq.org/selenium-remote-control/1.0-beta-2/doc/ruby/classes/Selenium/Client/GeneratedDriver.html#M000220)抓取屏幕截图。

然后，您必须将其缩小为缩略图。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T17:13:33.193

你可能想试试这个：

[http://www.pageglimpse.com/](http://www.pageglimpse.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-01-21T17:01:14.793

有使用 phantom.js的[https://github.com/maxwell/screencap](https://github.com/maxwell/screencap)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T18:57:29.467

有一个用于 PageGlimpse 的 ruby​​ 包装器：

[http://code.squidchunks.com/pageglimpse/](http://code.squidchunks.com/pageglimpse/)

不幸的是，使用条款规定“您不得使用或启动任何自动化系统，包括但不限于“离线阅读器”、“蜘蛛”等来捕获服务提供的数据。”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-01-08T15:30:34.313

你可以气喘吁吁地使用[宝石](https://github.com/mgrachev/gastly)。

`Gastly.capture('http://google.com', 'output.png')`

# query-string - 查询字符串中哪些字符不安全？

> ID：726662
> 
> 赞同：7
> 
> 时间：2009-04-07T17:02:08.587
> 
> 标签：query-string, security

我需要防止导致 URL 漏洞的字符。

我的示例 URL 是*http://localhost/add.aspx?id=4;req=4*。

请给出我需要阻止的字符列表。

我正在使用[ASP.NET](https://en.wikipedia.org/wiki/ASP.NET)网页。我正在绑定来自[SQL Server](https://en.wikipedia.org/wiki/Microsoft_SQL_Server)数据库的信息。

我只想列出字符以远离*黑客*在 URL 中输入不需要的字符串。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T17:14:08.200

根据您使用的技术，通常有一个内置函数可以为您处理此问题。

**ASP.NET (VB) 和经典 ASP**

```
myUrl = Server.UrlEncode(myUrl) 
```

**ASP.NET (C#)**

```
myUrl = Server.UrlEncode(myUrl); 
```

**PHP**

```
$myUrl = urlencode($myurl); 
```

* * *

如果您只是想**删除不安全字符**，则需要一个正则表达式。[RFC 1738](http://www.w3.org/Addressing/rfc1738.txt)定义了哪些字符对于 URL 是不安全的：

> 不安全：
> 
> 由于多种原因，字符可能不安全。空格
> 字符是不安全的，因为
> 当 URL 被转录或
> 排版或接受文字处理程序的处理时，重要的空格可能会消失，并且可能会引入无关紧要的空格。字符“<”和“>”是不安全的，因为它们被用作
> 自由文本中 URL 的分隔符；引号 (""")
> 在某些系统中用于分隔 URL。字符 "#" 是不安全的，应
> 始终进行编码，因为它在万维网和其他
> 系统中用于将 URL 与片段/锚定分隔开可能跟在它后面的标识符。字符“%”是不安全的，因为它用于
> 其他字符的编码。其他字符是不安全的，因为
> 已知网关和其他传输代理有时会修改这些字符。这些字符是“{”、“}”、“|”、“\”、“^”、“~”、“[”、“]”和“`”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T19:00:10.147

> 我需要防止导致漏洞的字符

好吧，正如答案所说，您当然*需要进行 URL 编码。*但是URL 编码*不会*导致漏洞吗？好吧，通常不是直接的；大多数情况下，当输入意外字符时，它只会使您的应用程序中断。

如果我们谈论网络“漏洞”，今天最常见的是：

1.  服务器端[代码注入](http://en.wikipedia.org/wiki/Code_injection)，危害你的服务器
2.  [SQL注入](http://en.wikipedia.org/wiki/SQL_injection)，危害你的数据库
3.  HTML 注入，允许对您的用户进行[跨站点脚本](http://en.wikipedia.org/wiki/Cross-site_scripting)(XSS) 攻击
4.  未经验证的操作，允许对您的用户进行[跨站点请求伪造](http://en.wikipedia.org/wiki/Cross-site_request_forgery)(XSRF) 攻击

这些是按照严重性降低和普遍性增加的顺序。（幸运的是，如今很少有网站作者愚蠢到将用户输入传递给 system()，但 XSS 和 XSRF 漏洞很普遍。）

这些漏洞中的每一个都需要您了解潜在问题并有意识地应对它。如果您的应用程序对安全性玩弄天真，没有“您需要阻止的字符串”的神奇列表可以保护您的应用程序。有*一些*插件会在提交时阻止字符串“<script>”，但它们给你的只是一种错误的安全感，因为它们只能捕捉到一些常见的情况，而且通常很容易编写代码.

当您真正想要它们时，它们还会停止提交这些字符串。例如，一些（愚蠢的）PHP 作者拒绝所有传入的撇号，以试图遏制 SQL 注入；结果是你不能被称为“O'Reilly”。哦。不要阻塞；正确编码。

例如，为了防止 SQL 注入，请确保对您进行查询的任何字符串进行 SQL 转义（或使用参数化查询自动执行此操作）；为了防止 HTML 注入，对您输出到页面上的所有文本字符串进行 HTML 编码（或使用会自动执行此操作的模板/MVC 方案）。

> 我的示例 URL http://localhost/add.aspx?id=4;req=4

该网址应该有问题吗？用';'分隔两个查询参数是有效的 而不是更常见的 '&'，但遗憾的是，许多常见的 Web 框架在默认情况下仍然不理解这种语法（包括 Java Servlet 和 ASP.NET）。所以你必须使用'id=4&req=4'——或者，如果你真的希望它是一个带有分号的单个参数，'id=4%3Breq%3D4'。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T17:04:29.550

[http://en.wikipedia.org/wiki/Query_string#URL_encoding](http://en.wikipedia.org/wiki/Query_string#URL_encoding)

另见：[https ://www.rfc-editor.org/rfc/rfc3986#section-2.2](https://www.rfc-editor.org/rfc/rfc3986#section-2.2)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-10-07T07:08:17.910

我为漂亮的 URL 写了这个，但它当然不完整：

""",´,',·,‚,*,@,?,=,;,:,.,/,+,&,$,<,>,#,%,{,(,),}, |,,^,~,[,],-,-,-',,"

然后我翻译空格“”和“-”的重复空格。

更好的做法是这样做或将其与正则表达式结合使用。

# c++ - C++中枚举的字符串

> ID：726664
> 
> 赞同：19
> 
> 时间：2009-04-07T17:02:47.587
> 
> 标签：c++, string, enums

有没有办法将文本文件中的字符串与枚举值相关联？

问题是：我有一些枚举值作为字符串存储在一个文本文件中，我在满足某些条件时即时读取这些值......现在我想将读取的值分配给一个枚举。

最有效的方法是什么？它不需要是最简单的方法。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-07T17:05:38.737

您可以设置一个可以反复使用的地图：

```
template <typename T>
class EnumParser
{
    map <string, T> enumMap;
public:
    EnumParser(){};

    T ParseSomeEnum(const string &value)
    { 
        map <string, T>::const_iterator iValue = enumMap.find(value);
        if (iValue  == enumMap.end())
            throw runtime_error("");
        return iValue->second;
    }
};

enum SomeEnum
{
    Value1,
    Value2
};
EnumParser<SomeEnum>::EnumParser()
{
    enumMap["Value1"] = Value1;
    enumMap["Value2"] = Value2;
}

enum OtherEnum
{
    Value3, 
    Value4
};
EnumParser<OtherEnum>::EnumParser()
{
    enumMap["Value3"] = Value3;
    enumMap["Value4"] = Value4;
}

int main()
{
    EnumParser<SomeEnum> parser;
    cout << parser.ParseSomeEnum("Value2");
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T17:05:13.150

```
std::map< string, enumType> enumResolver; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T20:51:33.263

我同意许多`std::map`最简单的解决方案的答案。

如果您需要更快的东西，您可以使用哈希映射。也许您的编译器已经提供了一个，例如`hash_map`即将推出的标准 unordered_map，或者您可以从[boost](http://www.boost.org/doc/libs/1_37_0/doc/html/boost/unordered_map.html)中获得一个。当提前知道所有字符串时，也可以使用[完美散列。](http://en.wikipedia.org/wiki/Hash_table#Perfect_hashing)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-21T16:30:45.020

接受的答案不包含完整列表。我正在添加`EnumParser.h`我从接受的答案中创建的内容，希望它可以提供帮助

```
#include <string>
#include <map>

using namespace std;

template <typename T> class EnumParser
{
    map<string, T> enumMap;
public:
    EnumParser(){};

    T ParseSomeEnum(const string &value)
    { 
        typename map <string, T>::const_iterator iValue = enumMap.find(value);
        if (iValue  == enumMap.end())
            throw runtime_error("");
        return iValue->second;
    }
}; 
```

用法很简单：

```
enum FieldType
{
    Char,
    Integer,
    Long,
    Fixed,
    Price,
    Date,
    Time
};

EnumParser<FieldType>::EnumParser()
{
    enumMap["Char"] = Char;
    enumMap["Integer"] = Integer;
    enumMap["Long"] = Long;
    enumMap["Fixed"] = Fixed;
    enumMap["Price"] = Price;
    enumMap["Date"] = Date;
    enumMap["Time"] = Time;
} 
```

采用：

```
 EnumParser<FieldType> fieldTypeParser;
 FieldType val = fieldTypeParser.ParseSomeEnum(stringValue) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T01:01:30.933

查看[Boost.Bimap](http://www.boost.org/doc/libs/1_38_0/libs/bimap/doc/html/index.html)，它提供了两组值之间的双向关联。您还可以选择底层容器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T17:18:53.853

使用 a`std::map`提出了一个问题：地图是如何被初始化的？我宁愿使用一个函数：

```
enum E { A, B };

E f( const std::string & s ) {
   if ( s == "A" ) {
      return A;
    }
    else if ( s == "B" ) {
      return B;
    }
    else {
      throw "Your exception here";
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-28T21:40:58.680

这是你想要的吗？初始化是直接的，不需要实例化。

用法：

```
enum SomeEnum
{
    ENUM_ONE,
    ENUM_TWO,
    ENUM_THREE,
    ENUM_NULL
};

DEFINE_PAIRLIST(CEnumMap, SomeEnum)

INIT_PAIRLIST(CEnumMap)=
{
        {"One", ENUM_ONE},
        {"Two", ENUM_TWO},
        {"Three", ENUM_THREE},
        {"", ENUM_NULL}
};

main{
    // Get enum from string
    SomeEnum i = CEnumMap::findValue("One");

    // Get string from enum
    SomeEnum eee = ENUM_ONE;
    const char* pstr = CEnumMap::findKey(eee);
    ...
} 
```

图书馆：

```
template <class T>
struct CStringPair
{
    const char* _name;
    T _value;
};

template <class T, class Derived>
struct CStringPairHandle
{
    typedef CStringPair<T> CPair;
    static const CStringPair<T> * getPairList(){
        return Derived::implementation();
    }
    static T findValue(const char* name){
        const CStringPair<T> * p = getPairList();
        for (; p->_name[0]!=0; p++)
            if (strcmp(name,p->_name)==0)
                break;
        return p->_value;
    }

    static const char* findKey(T value){
        const CStringPair<T> * p = getPairList();
        for (; p->_name[0]!=0; p++)
            if (strcmp(value,p->_value)==0)
                break;
        return p->_name;
    };
};

#define DEFINE_PAIRLIST(name, type) struct name:public CStringPairHandle<type, name>{ \
    static CPair _pairList[];       \
    static CPair* implementation(){     \
        return _pairList;           \
    }};
#define INIT_PAIRLIST(name) name::CPair name::_pairList[] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T17:05:13.587

自己解析字符串，将字符串与一个值匹配（这也是`map<string, enum>`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-07-09T02:07:42.120

您可以计算字符串的哈希值，然后使用它：

```
template <typename H, typename E>
E map_hash(H const key, std::initializer_list<std::pair<H, E>> const il)
{
  auto const i(
    std::find_if(il.begin(),
      il.end(),
      [key](auto& p)
      {
        return p.first == key;
      }
    )
  );

  assert(i != il.end());

  return i->second;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-02-17T16:22:29.510

从这里使用 C++ 反射库：[https ://github.com/tapika/cppreflect](https://github.com/tapika/cppreflect)

您可以 - 包括这样的库：

```
#include "cppreflect/cppreflect.h" 
```

基本用法：

声明枚举：

```
DECLARE_ENUM( enumName,
    // Prefix for all enums, "" if no prefix used.
    "myenum_",

    myenum_enumValue1,
    myenum_enumValue2,
    myenum_enumValue3 = 5,

    // comment
    myenum_enumValue4
); 
```

转换逻辑：

从枚举到字符串：

```
printf( EnumToString(myenum_enumValue3).c_str() );

=> "enumValue3" 
```

从字符串到枚举：

```
enumName value;

if( !StringToEnum("enumValue4", value) )
    printf("Conversion failed...");

=> 

value == myenum_enumValue4 
```

主要/核心功能位于此处：

[https://github.com/tapika/cppreflect/blob/master/cppreflect/enumreflect.h](https://github.com/tapika/cppreflect/blob/master/cppreflect/enumreflect.h)

# asp.net - 动画更新面板

> ID：726666
> 
> 赞同：0
> 
> 时间：2009-04-07T17:02:56.497
> 
> 标签：asp.net, javascript, ajax

我曾尝试使用作为 Ajax 控件工具包一部分的 UpdatePanelAnimationExtender，但我最大的抱怨是它不会等待您的动画完成后再加载新内容。

我想做类似以下的事情：

1.  向服务器发起异步请求
2.  完全淡出 UpdatePanel 中的内容
3.  一旦 UpdatePanel 完全淡出并返回新内容，加载新内​​容
4.  淡入更新面板

我可以将以下代码放在启动回发的触发器上：

```
OnClientClick="Sys.WebForms.PageRequestManager.getInstance().add_pageLoading(PauseForFade); FadeOut();" 
```

有了它，我还可以使用以下 JavaScript 来取消任何进一步的处理：

```
function PauseForFade(sender, args) { args.set_cancel(true); } 
```

我的问题是，一旦我的淡入淡出动画完成，我无法弄清楚如何恢复加载。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T19:26:48.380

我想我找到了一个可行的解决方案。如果你们中的任何人有更好的解决方案，请随时加入。

在我的按钮中，我放置了以下 OnClientClick 事件处理程序：

```
OnClientClick="return FadeOut();" 
```

这将调用我的 FadeOut 方法，如果当前内容淡入并可见，该方法将返回 false。返回 false 将完全取消 UpdatePanel 将调用的异步回发。

动画完成后，我将 IsFadedIn 变量设置为 false 并再次单击按钮（我知道单击按钮的代码现在不兼容跨浏览器，这只是概念证明，因此需要被固定）。由于 IsFadeIn 设置为 false，因此这次 FadeOut 方法不返回 false，因此 UpdatePanel 执行回发。

我有一个附加到 pageLoaded 事件的事件处理程序，以便在完成加载后我可以淡入新内容。

**好处**：我现在可以在加载新内容之前完成我的动画。

**坏处**：在开始回发过程之前，我必须等待动画完成，因此用户实际上必须等待更长的时间。

```
var opacity = 100;
var IsFadedIn = true;

Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(FadeIn);
function FadeIn(sender, args) {
  if (!IsFadedIn) {
    if (opacity < 100) {
      opacity += 15;
      $get("LowerPageContent").style.filter = "alpha(opacity=" + opacity + ")";
      setTimeout(FadeIn, 1);
    } else {
      $get("LowerPageContent").style.filter = "alpha(opacity=100)";
      IsFadedIn = true;
    }
  }
}
function FadeOut() {
  if (IsFadedIn) {
    if (opacity > 0) {
      opacity -= 15;
      $get("LowerPageContent").style.filter = "alpha(opacity=" + opacity + ")";
      setTimeout(FadeOut, 1);
    } else {
      $get("LowerPageContent").style.filter = "alpha(opacity=0)";
      IsFadedIn = false;
      $get("TestButton").click();
    }
    return false;
  }
} 
```

# sharepoint - SharePoint - 用于查看远程列表的 Web 部件

> ID：726672
> 
> 赞同：2
> 
> 时间：2009-04-07T17:04:10.050
> 
> 标签：sharepoint, listview, web-parts

哪个 Web 部件以及如何配置它以查看来自不同网站集的列表？请注意，我不想查看页面，而是查看列表。例如，在单独的网站集下查看来自不同团队网站的公告。

预先感谢您的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:19:54.473

通过 SharePoint 设计器提供的[数据表单 Web 部件](http://masteringsharepoint.com/blogs/beagle/archive/2008/08/13/DFWP1.aspx)可以执行此操作。

作为发布基础结构（需要 MOSS）的一部分的内容查询 Web 部件 (CQWP) 不会跨网站集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T16:26:53.903

Re [http://www.spelements.com/spanylistview/](http://www.spelements.com/spanylistview/) 这个问题是你必须能够在服务器上安装它。

如果您没有这些权限，则无法使用它。不要费心问他们是否可以获得。他们不能。

# design-patterns - 是的..我知道..我是个傻瓜..那么什么是单例？

> ID：726685
> 
> 赞同：31
> 
> 时间：2009-04-07T17:06:16.957
> 
> 标签：design-patterns, singleton

我已经尝试过几次来了解单例是什么。也许我太直观了..所以任何人都可以用一个简单的类比来分解它。

类似的帖子：

*   [初始化单例的不同方法](https://stackoverflow.com/questions/1637635/different-ways-to-initialize-singletons)
*   [单例：应该如何使用](https://stackoverflow.com/questions/86582/singleton-how-should-it-be-used)
*   [这是对 Singleton 模式的良好使用吗？](https://stackoverflow.com/questions/793737/is-this-a-good-use-of-the-singleton-pattern)
*   [单身人士有什么不好？](https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons)
*   [单例：应该如何使用](https://stackoverflow.com/questions/86582/singleton-how-should-it-be-used)
*   [单身人士：好的设计还是拐杖？](https://stackoverflow.com/questions/11831/singletons-good-design-or-a-crutch)
*   [.NET 中的全局与单例](https://stackoverflow.com/questions/504036/global-vs-singleton-in-net)
*   [关于设计模式：何时使用单例？](https://stackoverflow.com/questions/228164/on-design-patterns-when-to-use-the-singleton)
*   [Java中带参数的单例](https://stackoverflow.com/questions/1050991/singleton-with-arguments-in-java)
*   [在 Java 中实现单例模式的有效方法是什么？](https://stackoverflow.com/questions/70689/efficient-way-to-implement-singleton-pattern-in-java)
*   [什么是单例的替代品](https://stackoverflow.com/questions/1300655/whats-alternative-to-singleton)
*   [滥用单例类的最常见](https://stackoverflow.com/questions/135347/most-common-examples-of-misuse-of-singleton-) 示例
*   [https://stackoverflow.com/questions/1395766/asp-net-objectdatasource-singleton](https://stackoverflow.com/questions/1395766/asp-net-objectdatasource-singleton)
*   [在 .NET 远程处理中使用单例与单调用？](https://stackoverflow.com/questions/1434849/using-singleton-vs-single-call-in-net-remoting)
*   [什么是单例类？它可以帮助我为两个相关服务运行一个类的单个实例吗？](https://stackoverflow.com/questions/1494642/what-is-a-singleton-class-can-it-help-me-running-single-instance-of-a-class-for)

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-04-07T17:15:03.487

根据要求，这里有一些类比：

*   地球
*   宇宙
*   元素氧（还有其他元素，但只有一种氧。有很多氧分子，但只有一种规范的氧元素。）
*   真实的概念
*   假的概念

您可以实例化许多 True 对象，但它们都将引用相同的实际项目（即 True 的通用概念）。根据您的应用程序的域，可能会有更具体的示例：

*   数据库连接
*   应用程序的主线程
*   任何代表硬件设备的东西（即您只想实例化一个代表 CPU0 的对象）。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-07T17:07:13.600

单例是一类在您的应用程序中只能有一个实例的类。然后，您在整个应用程序中共享该实例。

这是一个可能有帮助的链接（包括如何在 c# 中使你的单例线程安全）：

[在 C# 中实现单例模式](http://www.yoda.arachsys.com/csharp/singleton.html)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-07T17:24:28.720

**当您必须**确保一个类**只有一个****实例**并且必须从代码中的多个位置访问该对象时，单例非常有用。

 **如果一次可以使用多个类的实例是有意义的，那么您不想要一个单例。

以下是有关在何处使用单例的一些信息：http: [//www.ibm.com/developerworks/webservices/library/co-single.html](http://www.ibm.com/developerworks/webservices/library/co-single.html)

从前面提到的文章中：

> 要确定一个类是否真的是单例，你必须问自己一些问题。
> 
> *   每个应用程序都会以完全相同的方式使用这个类吗？（正好是关键词）
> *   每个应用程序都只需要一个此类的实例吗？
>     （ever 和 one 是关键词）
> *   此类的客户是否应该不知道他们所属的应用程序
>     ？
>     
>     
>     
>     如果您对所有三个问题的回答都是肯定的，那么您已经找到了一个单身人士。这里的关键点是，如果所有应用程序对它的处理完全相同，并且如果它的客户端可以在没有应用程序上下文的情况下使用该类，则该类只是一个单例。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-17T17:30:27.957

单例是羊皮中的全局变量:)

[http://googletesting.blogspot.com/2008/08/root-cause-of-singletons.html](http://googletesting.blogspot.com/2008/08/root-cause-of-singletons.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T17:41:43.407

单例是一个类，它只能创建一个实例。

这通常是通过一个私有构造函数来实现的，该构造函数被分配给一个静态变量，然后可以通过一个公共方法访问。

使用单例存在一些问题，包括：

*   他们使测试变得困难
*   它们不能被子分类
*   一旦实例化，实例将永远存在

有关单例的进一步描述，请参见此处，以及另一种可能有用的模式“Monostate”：[http ://www.objectmentor.com/resources/articles/SingletonAndMonostate.pdf](http://www.objectmentor.com/resources/articles/SingletonAndMonostate.pdf)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T17:10:02.267

除了作为一种特殊的设计模式之外，单例也可以被认为是简单的*一件事*。毫无疑问，它在编程中的使用源于它在数学中的使用，其中单例是一组只有一个数字。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T22:45:03.987

单身人士有时可能不那么单身。看看这里： [当单例不是单例时？](http://java.sun.com/developer/technicalArticles/Programming/singletons/), 文章由 Sun 提供。

一个建议：不要使用它。这不好，会在您的应用程序中造成严重的性能瓶颈，而且测试单例类的努力是不值得的。

从上面提到的维基百科文章：

> 应该注意的是，这种模式使单元测试变得更加困难，因为它将全局状态引入了应用程序。

另一个值得一看的资源是谷歌测试博客上的这篇文章[。](http://googletesting.blogspot.com/2008/11/clean-code-talks-global-state-and.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-29T20:20:16.080

有一个很棒的 Google 技术讲座，演讲者谈到了全球状态（包括单身人士）以及他们为什么几乎不可能进行测试：

[清洁代码会谈 - “全球状态和单身人士”](http://www.youtube.com/watch?v=-FRm3VPhseI)

演讲者区分了*他*所谓的 Singletons（大写 'S'）`getInstance`和 singletons（small's ') 其中只需要一个实例，但类中没有内置任何内容来防止创建多个实例。

# linux - 是什么杀死了我的进程，为什么？

> ID：726690
> 
> 赞同：735
> 
> 时间：2009-04-07T17:07:19.760
> 
> 标签：linux, process, kill, signals

我的应用程序在 Linux 上作为后台进程运行。它当前在终端窗口的命令行中启动。

最近一个用户执行了一段时间的应用程序，它神秘地死了。文本：

> 被杀

在终端上。这发生了两次。我问是否有人在不同的终端使用 kill 命令杀死进程？不。

Linux 在什么情况下会决定终止我的进程？我相信 shell 显示“killed”是因为进程在收到 kill(9) 信号后死亡。如果 Linux 发送了终止信号，系统日志中是否应该有一条消息解释它为什么被终止？

* * *

## 回答 #1

> 赞同：469
> 
> 时间：2009-04-07T17:23:58.397

如果用户或系统管理员没有杀死内核可能拥有的程序。内核只会在资源极度匮乏（想想 mem+swap 耗尽）等特殊情况下杀死进程。

* * *

## 回答 #2

> 赞同：352
> 
> 时间：2013-12-19T02:59:18.200

尝试：

```
dmesg -T| grep -E -i -B100 'killed process' 
```

where`-B100`表示杀死发生之前的行数。

在 Mac OS 上省略**-T 。**

* * *

## 回答 #3

> 赞同：188
> 
> 时间：2009-04-07T17:51:37.190

这看起来像是一篇关于这个主题的好文章：[驯服 OOM 杀手](http://lwn.net/Articles/317814/)。

要点是 Linux**过度使用**记忆。当一个进程请求更多空间时，Linux 会给它这个空间，即使它被另一个进程占用，假设没有人真正使用他们请求的所有内存。该进程将在实际使用它分配的内存时独占使用它，而不是在它请求时。这使得分配速度更快，并且可能允许您“作弊”并分配比实际更多的内存。然而，一旦进程开始使用这个内存，Linux 可能会意识到它在分配它没有的内存方面过于慷慨，并且必须终止一个进程以释放一些内存。要杀死的进程是基于考虑运行时（长时间运行的进程更安全）、内存使用量（贪婪进程不太安全）和其他一些因素的分数，包括一个您可以调整的值，以使进程不太可能被杀死。这一切都在文章中进行了更详细的描述。

编辑：这是[另一篇文章](http://linux-mm.org/OOM_Killer)，很好地解释了如何选择进程（用一些内核代码示例进行注释）。这样做的好处是它包含了对各种规则背后的**推理的一些评论。**`badness()`

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2016-04-05T00:36:36.813

## 让我先解释一下何时以及为什么会调用 OOMKiller？

假设您有 512 RAM + 1GB 交换内存。所以理论上，你的 CPU 可以访问总共 1.5GB 的虚拟内存。

现在，一段时间以来，在 1.5GB 的总内存中一切都运行良好。但是突然（或逐渐）您的系统开始消耗越来越多的内存，并且达到了所用总内存的 95% 左右。

现在假设任何进程都向内核请求了大块内存。内核检查可用内存并发现它无法为您的进程分配更多内存。所以它会尝试释放一些内存调用/调用 OOMKiller ( [http://linux-mm.org/OOM](http://linux-mm.org/OOM) )。

OOMKiller 有自己的算法来为每个进程评分。通常哪个进程使用更多内存成为被杀死的受害者。

## 我在哪里可以找到 OOMKiller 的日志？

通常在 /var/log 目录中。/var/log/kern.log 或 /var/log/dmesg

希望这会帮助你。

## 一些典型的解决方案：

1.  增加内存（不是交换）
2.  查找程序中的内存泄漏并修复它们
3.  限制任何进程可以消耗的内存（例如可以使用 JAVA_OPTS 限制 JVM 内存）
4.  查看日志和谷歌:)

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2015-07-20T12:56:16.813

这是 Linux**内存不足管理器 (OOM)**。选择您的进程是因为“**糟糕**”——最近性、驻留大小（正在使用的内存，而不仅仅是分配的内存）和其他因素的组合。

```
sudo journalctl -xb 
```

您会看到如下消息：

```
Jul 20 11:05:00 someapp kernel: Mem-Info:
Jul 20 11:05:00 someapp kernel: Node 0 DMA per-cpu:
Jul 20 11:05:00 someapp kernel: CPU    0: hi:    0, btch:   1 usd:   0
Jul 20 11:05:00 someapp kernel: Node 0 DMA32 per-cpu:
Jul 20 11:05:00 someapp kernel: CPU    0: hi:  186, btch:  31 usd:  30
Jul 20 11:05:00 someapp kernel: active_anon:206043 inactive_anon:6347 isolated_anon:0
                                    active_file:722 inactive_file:4126 isolated_file:0
                                    unevictable:0 dirty:5 writeback:0 unstable:0
                                    free:12202 slab_reclaimable:3849 slab_unreclaimable:14574
                                    mapped:792 shmem:12802 pagetables:1651 bounce:0
                                    free_cma:0
Jul 20 11:05:00 someapp kernel: Node 0 DMA free:4576kB min:708kB low:884kB high:1060kB active_anon:10012kB inactive_anon:488kB active_file:4kB inactive_file:4kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present
Jul 20 11:05:00 someapp kernel: lowmem_reserve[]: 0 968 968 968
Jul 20 11:05:00 someapp kernel: Node 0 DMA32 free:44232kB min:44344kB low:55428kB high:66516kB active_anon:814160kB inactive_anon:24900kB active_file:2884kB inactive_file:16500kB unevictable:0kB isolated(anon):0kB isolated
Jul 20 11:05:00 someapp kernel: lowmem_reserve[]: 0 0 0 0
Jul 20 11:05:00 someapp kernel: Node 0 DMA: 17*4kB (UEM) 22*8kB (UEM) 15*16kB (UEM) 12*32kB (UEM) 8*64kB (E) 9*128kB (UEM) 2*256kB (UE) 3*512kB (UM) 0*1024kB 0*2048kB 0*4096kB = 4580kB
Jul 20 11:05:00 someapp kernel: Node 0 DMA32: 216*4kB (UE) 601*8kB (UE) 448*16kB (UE) 311*32kB (UEM) 135*64kB (UEM) 74*128kB (UEM) 5*256kB (EM) 0*512kB 0*1024kB 1*2048kB (R) 0*4096kB = 44232kB
Jul 20 11:05:00 someapp kernel: Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=2048kB
Jul 20 11:05:00 someapp kernel: 17656 total pagecache pages
Jul 20 11:05:00 someapp kernel: 0 pages in swap cache
Jul 20 11:05:00 someapp kernel: Swap cache stats: add 0, delete 0, find 0/0
Jul 20 11:05:00 someapp kernel: Free swap  = 0kB
Jul 20 11:05:00 someapp kernel: Total swap = 0kB
Jul 20 11:05:00 someapp kernel: 262141 pages RAM
Jul 20 11:05:00 someapp kernel: 7645 pages reserved
Jul 20 11:05:00 someapp kernel: 264073 pages shared
Jul 20 11:05:00 someapp kernel: 240240 pages non-shared
Jul 20 11:05:00 someapp kernel: [ pid ]   uid  tgid total_vm      rss nr_ptes swapents oom_score_adj name
Jul 20 11:05:00 someapp kernel: [  241]     0   241    13581     1610      26        0             0 systemd-journal
Jul 20 11:05:00 someapp kernel: [  246]     0   246    10494      133      22        0         -1000 systemd-udevd
Jul 20 11:05:00 someapp kernel: [  264]     0   264    29174      121      26        0         -1000 auditd
Jul 20 11:05:00 someapp kernel: [  342]     0   342    94449      466      67        0             0 NetworkManager
Jul 20 11:05:00 someapp kernel: [  346]     0   346   137495     3125      88        0             0 tuned
Jul 20 11:05:00 someapp kernel: [  348]     0   348    79595      726      60        0             0 rsyslogd
Jul 20 11:05:00 someapp kernel: [  353]    70   353     6986       72      19        0             0 avahi-daemon
Jul 20 11:05:00 someapp kernel: [  362]    70   362     6986       58      18        0             0 avahi-daemon
Jul 20 11:05:00 someapp kernel: [  378]     0   378     1621       25       8        0             0 iprinit
Jul 20 11:05:00 someapp kernel: [  380]     0   380     1621       26       9        0             0 iprupdate
Jul 20 11:05:00 someapp kernel: [  384]    81   384     6676      142      18        0          -900 dbus-daemon
Jul 20 11:05:00 someapp kernel: [  385]     0   385     8671       83      21        0             0 systemd-logind
Jul 20 11:05:00 someapp kernel: [  386]     0   386    31573      153      15        0             0 crond
Jul 20 11:05:00 someapp kernel: [  391]   999   391   128531     2440      48        0             0 polkitd
Jul 20 11:05:00 someapp kernel: [  400]     0   400     9781       23       8        0             0 iprdump
Jul 20 11:05:00 someapp kernel: [  419]     0   419    27501       32      10        0             0 agetty
Jul 20 11:05:00 someapp kernel: [  855]     0   855    22883      258      43        0             0 master
Jul 20 11:05:00 someapp kernel: [  862]    89   862    22926      254      44        0             0 qmgr
Jul 20 11:05:00 someapp kernel: [23631]     0 23631    20698      211      43        0         -1000 sshd
Jul 20 11:05:00 someapp kernel: [12884]     0 12884    81885     3754      80        0             0 firewalld
Jul 20 11:05:00 someapp kernel: [18130]     0 18130    33359      291      65        0             0 sshd
Jul 20 11:05:00 someapp kernel: [18132]  1000 18132    33791      748      64        0             0 sshd
Jul 20 11:05:00 someapp kernel: [18133]  1000 18133    28867      122      13        0             0 bash
Jul 20 11:05:00 someapp kernel: [18428]    99 18428   208627    42909     151        0             0 node
Jul 20 11:05:00 someapp kernel: [18486]    89 18486    22909      250      46        0             0 pickup
Jul 20 11:05:00 someapp kernel: [18515]  1000 18515   352905   141851     470        0             0 npm
Jul 20 11:05:00 someapp kernel: [18520]     0 18520    33359      291      66        0             0 sshd
Jul 20 11:05:00 someapp kernel: [18522]  1000 18522    33359      294      64        0             0 sshd
Jul 20 11:05:00 someapp kernel: [18523]  1000 18523    28866      115      12        0             0 bash
Jul 20 11:05:00 someapp kernel: Out of memory: Kill process 18515 (npm) score 559 or sacrifice child
Jul 20 11:05:00 someapp kernel: Killed process 18515 (npm) total-vm:1411620kB, anon-rss:567404kB, file-rss:0kB 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2014-01-28T19:01:00.490

正如 dwc 和 Adam Jaskiewicz 所说，罪魁祸首很可能是 OOM Killer。然而，接下来的下一个问题是：如何防止这种情况发生？

有几种方法：

1.  如果可以的话，给你的系统更多的内存（如果它是一个虚拟机很容易）
2.  确保 OOM 杀手选择不同的进程。
3.  禁用 OOM 杀手
4.  选择禁用 OOM Killer 的 Linux 发行版。

[多亏了这篇文章](http://backdrift.org/how-to-create-oom-killer-exceptions)，我发现（2）特别容易实现。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2015-02-25T17:59:24.520

像 systemtap（或跟踪器）这样的工具可以监控内核信号传输逻辑并报告。例如，[https://sourceware.org/systemtap/examples/process/sigmon.stp](https://sourceware.org/systemtap/examples/process/sigmon.stp)

```
# stap --example sigmon.stp -x 31994 SIGKILL
   SPID     SNAME            RPID  RNAME            SIGNUM SIGNAME
   5609     bash             31994 find             9      SIGKILL 
```

该脚本中的过滤`if`块可以进行调整以适应口味，或消除以跟踪系统范围的信号流量。通过收集回溯可以进一步隔离原因（分别为内核和用户空间添加一个`print_backtrace()`和/或探针）。`print_ubacktrace()`

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-04-26T19:20:17.763

[限制资源](http://linux.die.net/man/5/limits.conf)的PAM 模块导致了您描述的结果：我的进程神秘地死亡，控制台窗口上的文本*被 Killed 。*没有日志输出，既不在*syslog*也不在*kern.log*中。[顶级](http://linux.die.net/man/1/top)程序帮助我发现，在CPU 使用一分钟后，我的进程就被杀死了。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-03-03T07:07:59.570

在 lsf 环境（交互式或其他方式）中，如果应用程序的内存利用率超出队列管理员的某个预设阈值或提交到队列的资源请求，则进程将被终止，因此其他用户不会成为潜在的受害者逃跑。它并不总是在发送电子邮件时发送电子邮件，具体取决于其设置方式。

在这种情况下，一种解决方案是找到具有更大资源的队列或在提交中定义更大的资源需求。

您可能还想回顾`man ulimit`

虽然我不记得`ulimit`我`Killed`需要它已经有一段时间了。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-12-30T00:58:15.607

就我而言，这是发生在 Laravel 队列工作者身上。系统日志没有提到任何杀戮，所以我进一步查看，结果发现worker基本上是因为超过内存限制（默认设置为128M）的作业而自我杀戮。

运行队列工作者`--timeout=600`并`--memory=1024`为我解决了问题。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-07T17:44:23.387

我们在客户站点（我认为是 Red Hat）在 Linux 下遇到了反复出现的问题，OOMKiller（内存不足的杀手）杀死了我们的主要应用程序（即服务器存在的原因）和它的数据库进程。

在每种情况下，OOMKiller 都只是简单地确定进程正在使用大量资源……机器甚至不会因为缺乏资源而发生故障。应用程序和它的数据库都没有内存泄漏（或任何其他资源泄漏）的问题。

我不是 Linux 专家，但我宁愿收集它的算法来决定何时杀死某些东西以及杀死什么是复杂的。另外，有人告诉我（我不能说这句话的准确性）OOMKiller 被嵌入到内核中，你不能简单地不运行它。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-05-04T17:32:24.367

**通过增加交换大小**解决了这个问题：

[https://askubuntu.com/questions/1075505/how-do-i-increase-swapfile-in-ubuntu-18-04](https://askubuntu.com/questions/1075505/how-do-i-increase-swapfile-in-ubuntu-18-04)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-07T17:12:54.803

用户有能力杀死自己的程序，使用 kill 或 Control+C，但我得到的印象不是发生了什么，并且用户向你抱怨。

root 当然有能力杀死程序，但是如果有人在你的机器上拥有 root 并且正在杀死东西，那么你就有更大的问题。

如果您不是系统管理员，系统管理员可能已经设置了 CPU、RAM 或磁盘使用配额，并自动终止超过这些配额的进程。

除了这些猜测之外，如果没有有关该程序的更多信息，我不确定。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-10-29T05:55:18.073

我最近遇到了这个问题。最后，我发现我的进程在 Opensuse zypper update 被自动调用后就被杀死了。禁用 zypper update 解决了我的问题。

# .net - 旧的 .NET 软件问题

> ID：726693
> 
> 赞同：0
> 
> 时间：2009-04-07T17:07:36.733
> 
> 标签：.net, vb.net

为什么在较旧的框架版本中创建的软件无法在较新的框架版本上运行？

实际上，每当我尝试在我的 PC 上运行一些具有 .net 3.5 框架的旧特定软件时，它们都会显示他们需要 .net 框架 1.1。有什么坏事？

我的新版 Photoshop ans Office 打开所有低版本文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:09:57.430

它通常会。考虑到所有因素，有一些向后不兼容的地方，但不是*很多*。

你有一个特定的问题吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T17:10:25.900

简短的回答是“这样他们就可以添加新功能”。有时，如果不对过去的完成方式进行[重大更改](http://msdn.microsoft.com/en-us/library/ms994364.aspx)，就无法添加功能。

也就是说，较新版本的框架通常会运行为旧版本编写的程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T18:10:05.117

.NET 1.1 和 .NET 2.0 是不同的框架。但是 .NET 3.0 和 3.5 框架是增量添加的，这意味着它们依赖于 .NET 2.0 框架。所以如果你有一些用 1.1 编写的东西，那么你需要安装 1.1。用 2.0 编写的任何东西都应该在具有 .NET 2.0、3.0、3.5 甚至 4.0 的机器上正常工作（如果您喜欢冒险的话）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T17:09:31.737

不运行或不编译？它们是有区别的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T18:15:48.910

.NET 平台旨在并行运行不同的版本。它不是为向后兼容而设计的。

不同版本的 CLR 并行运行的能力意味着可以更积极地更新和改进 CLR，而不必担心破坏向后兼容性或在为先前版本编写的程序中产生错误。这是因为为 1.1 设计的应用程序在较新版本发布很久之后仍在同一版本的 1.1 上运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T17:10:36.850

取决于您使用的 API。您也可以强制程序仅在一个框架中运行。检查 app.config。

# c++ - MFC/Win32 中的定时器消息

> ID：726698
> 
> 赞同：1
> 
> 时间：2009-04-07T17:08:58.540
> 
> 标签：c++, winapi, mfc

我只是在 Win32 中尝试使用一些低值（例如 10 毫秒）作为超时时间的 SetTimer 方法。我计算了获得 500 个计时器事件所需的时间，预计大约为 5 秒。令人惊讶的是，我发现获得这么多事件大约需要 7.5 秒，这意味着它在大约 16 毫秒时超时。我们可以为超时期限设置的值是否有任何限制（我在 MSDN 上找不到任何内容）？另外，我系统中运行的其他进程是否会影响这些计时器消息？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T17:14:53.317

OnTimer 是基于`WM_TIMER`消息的，消息优先级较低，意味着只有在没有其他消息等待时才会发送。

另外 MSDN 解释说你不能设置一个小于`USER_TIMER_MINIMUM`10 的间隔。

无论如何，调度程序都会遵守时间量。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:21:18.043

Windows 不是实时操作系统，无法处理那种精度（10 毫秒间隔）。话虽如此，[定时器有多种](http://www.codeproject.com/KB/system/timers_intro.aspx)，有些比其他的精度更高。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T17:49:22.780

您可以将系统计时器的粒度更改为 1 毫秒 - 这适用于 MIDI 工作。

基本上，我在 w2k 上的经验是，任何低于 13 毫秒的请求等待期都会返回一个等待，该等待会在 0 毫秒和 13 毫秒这两个值之间随机振荡。比这更长的计时器通常非常准确。您的 500 个计时器事件 - 有些是 0 毫秒，有些是 13 毫秒（假设 13 毫秒仍然正确）。你以时间短缺告终。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T14:20:25.847

如前所述 - Windows 不是实时操作系统。要求它做任何事情并在稍后的特定时间期待它是愚蠢的差事。设置一个计时器可以很好地要求窗口在时间过去后尽快触发 WM_TIMER 事件。这可能是在其他线程处理完成之后。因此，无法实际预测看到 WM_TIMER 事件的实际时间 - 您所知道的是 > 您设置的时间.... [查看有关 windows 时间的这篇文章](http://www.flounder.com/time.htm)

# asp.net - 如何创建自定义 asp.Net 模板化数据绑定控件？

> ID：726699
> 
> 赞同：0
> 
> 时间：2009-04-07T17:09:13.813
> 
> 标签：asp.net, data-binding, templates, controls

我想知道是否有用于创建 Asp.Net 模板化数据绑定控件的良好文档来源或用于简单控件的代码示例。

我在网上看到的所有文档似乎都太复杂了。有没有简单易懂的解释的地方？

我也可能对教科书感兴趣，如果这是您找到关于如何做到这一点的最简单解释的地方。

注意：我不在乎文章/代码示例是针对 C# 还是 VB.NET

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T13:09:24.287

*   [开发 Microsoft ASP.NET 服务器控件和组件](https://rads.stackoverflow.com/amzn/click/com/0735615829)
*   [http://www.nikhilk.net/](http://www.nikhilk.net/)

除了 MSDN 文档：[Developing Custom ASP.NET Server Controls](http://msdn.microsoft.com/en-us/library/zt27tfhy.aspx)之外，您还需要了解这些。

这不是一个简单的领域。

# jquery - jQuery 如何进行跨域 ajax 调用以及如何使用 mootools 复制 em

> ID：726704
> 
> 赞同：4
> 
> 时间：2009-04-07T17:09:50.723
> 
> 标签：jquery, mootools, cross-domain

在我关于是否继续使用 mootools 或跳转到 jQuery 的永恒内部斗争中，我在 jQuery 文档上发现了一些引起我注意的东西，那就是 jQuery 可以向不同的域请求 JSON，这通常被浏览器禁止.

我已经看到了一些跨子域的解决方法，但从来没有跨域，我真的很激动，首先我认为我是服务器相关的，但尝试了更多我已经看到从 jQuery 执行相同的 JSON 请求Mootools 上的文档不起作用！

这适用于 jQuery：

```
$.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?tags=cat&tagmode=any&format=json&jsoncallback=?",
        function(data){
          $.each(data.items, function(i,item){
            $("<img/>").attr("src", item.media.m).appendTo("#images");
            if ( i == 3 ) return false;
          });
        }); 
```

这不是 Mootools：

```
var jsonRequest = new Request.JSON({url: "http://api.flickr.com/services/feeds/photos_public.gne?tags=cat&tagmode=any&format=json&jsoncallback=?", onComplete: function(person, responseText){
    alert(responseText);
}}).get({}); 
```

我怎样才能复制这种行为？是什么原因造成的？

jQuery 文档：[http](http://docs.jquery.com/Ajax/jQuery.getJSON#urldatacallback) : //docs.jquery.com/Ajax/jQuery.getJSON#urldatacallback Mootols 文档：[http ://mootools.net/docs/Request/Request.JSON](http://mootools.net/docs/Request/Request.JSON)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T17:34:17.980

页面上说它是JSONP。

JSONP 是一种技巧，服务器不返回通常的响应，而是将其包装到用户提供的方法的方法调用中，例如，而不是：

`{"foo": "bar", "baz":"bah"}`

它会返回：

`temporaryCallbackFunctionName({"foo": "bar", "baz":"bah"});`

jQuery定义了临时回调函数，插入`<script src="..."></script>`元素，不受同源策略限制。

加载脚本后，将执行该函数，仅此而已。

不利的一面是，如果服务器是邪恶的（或被黑客入侵），它现在可以在您的浏览器中执行任意代码。

更多信息[在这里](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:40:44.673

您可以通过插件 JSONP 在 MooTools 中使用[JSONP](http://www.clientcide.com/docs/Request/JsonP)。它由MooTools 的核心开发人员之一[Aaron Newton制作。](https://stackoverflow.com/users/10071/anutron)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-02T15:39:59.907

自 v1.2.2（2009 年 4 月 23 日发布）以来，MooTools 中包含更多内容。

查看[此文档页面](http://mootools.net/docs/more/Request/Request.JSONP)以获取更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T17:13:54.223

[根据它的 API 文档和这个论坛](http://forum.mootools.net/topic.php?id=4155)，你似乎不能用 Mootools 做到这一点。

这受到限制的原因可能是因为[跨站点脚本攻击](http://en.wikipedia.org/wiki/Cross-site_scripting)。

# c# - 使用 C# WebClient 伪造表单提交

> ID：726710
> 
> 赞同：3
> 
> 时间：2009-04-07T17:11:39.157
> 
> 标签：c#, asp.net-mvc

我需要调用 web 并从我的 asp.net mvc 应用程序中的模型中检索结果数据。在 Web 上访问时，表单如下所示：

```
<form id="textEntryForm" name="textEntryForm" method="post" action="/project/evaluate_to_pdf">
            <textarea id="p" rows="20" name="p" cols="132"/><br/>   
            <input type="button" value="parse" name="do_parse" onclick="new Ajax.Updater('parsedProject','/project/parse',{asynchronous:true,evalScripts:true,on404:function(e){alert('not found!')},parameters:Form.serialize(this.form)});return false"/>
            <input type="button" value="evaluate_to_html" name="do_evaluate_to_html" onclick="new Ajax.Updater('parsedProject','/project/evaluate_to_html',{asynchronous:true,evalScripts:true,on404:function(e){alert('not found!')},parameters:Form.serialize(this.form)});return false"/>
            <input type="button" value="evaluate" name="do_evaluate" onclick="new Ajax.Updater('parsedProject','/project/evaluate',{asynchronous:true,evalScripts:true,on404:function(e){alert('not found!')},parameters:Form.serialize(this.form)});return false"/>
            <input type="button" value="evaluate to pdf source" name="do_evaluate_to_pdf_source" onclick="new Ajax.Updater('parsedProject','/project/evaluate_to_pdf_source',{asynchronous:true,evalScripts:true,on404:function(e){alert('not found!')},parameters:Form.serialize(this.form)});return false"/>
            <input type="submit" id="do_evaluate_to_pdf" value="evaluate_to_pdf" name="do_evaluate_to_pdf"/>
        </form> 
```

我需要传递将输入到 textarea id="p" 中的数据。如何添加它，使用 WebClient 连接？

谢谢！

**编辑**这不是出于测试目的，我需要检索数据以在我的应用程序中使用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T17:29:07.277

我只是用这个：[http ://www.eggheadcafe.com/community/aspnet/2/69261/you-can-use-the-webclient.aspx](http://www.eggheadcafe.com/community/aspnet/2/69261/you-can-use-the-webclient.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:19:11.450

另一种选择是[Microsoft 的轻量级测试自动化框架](https://web.archive.org/web/20120501082849/http://blog.codeville.net/2009/03/27/first-steps-with-lightweight-test-automation-framework/)<- Steve Sanderson 将其应用于 MVC。

[![替代文字](https://i.stack.imgur.com/7DbUn.png)](https://i.stack.imgur.com/7DbUn.png)
[（来源：[codeville.net](http://blog.codeville.net/wp-content/uploads/2009/03/image-thumb.png)）]

[![替代文字](https://i.stack.imgur.com/sK0Xn.png)](https://i.stack.imgur.com/sK0Xn.png)
[（来源：[codeville.net](http://blog.codeville.net/wp-content/uploads/2009/03/image-thumb1.png)）]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T17:15:01.367

您创建一个 Stream 并将其传递给您的 HttpWebRequest。

```
// Create a request using a URL that can receive a post. 
WebRequest request = 
    WebRequest.Create("http://www.contoso.com/PostAccepter.aspx ");
// Set the Method property of the request to POST.
request.Method = "POST";

// Create POST data and convert it to a byte array.
string postData = "p=Some text here from the textarea";

byte[] byteArray = Encoding.UTF8.GetBytes (postData);
// Set the ContentType property of the WebRequest.
request.ContentType = "application/x-www-form-urlencoded";
// Set the ContentLength property of the WebRequest.
request.ContentLength = byteArray.Length;
// Get the request stream.
Stream dataStream = request.GetRequestStream ();
// Write the data to the request stream.
dataStream.Write (byteArray, 0, byteArray.Length);
// Close the Stream object.
dataStream.Close ();
// Get the response.
WebResponse response = request.GetResponse ();
// Display the status.
Console.WriteLine (((HttpWebResponse)response).StatusDescription);
// Get the stream containing content returned by the server.
dataStream = response.GetResponseStream ();
// Open the stream using a StreamReader for easy access.
StreamReader reader = new StreamReader (dataStream);
// Read the content.
string responseFromServer = reader.ReadToEnd ();
// Display the content.
Console.WriteLine (responseFromServer);
// Clean up the streams.
reader.Close ();
dataStream.Close ();
response.Close (); 
```

[http://msdn.microsoft.com/en-us/library/debx8sh9.aspx](http://msdn.microsoft.com/en-us/library/debx8sh9.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T17:21:14.610

这些事情有一个变得越来越复杂的习惯，例如，如果您需要处理 cookie、身份验证或多部分表单上传以上传文件等。我建议使用 curl ( [http://sourceforge.net/projects/libcurl-net/](http://sourceforge.net/projects/libcurl-net/) )

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T17:34:54.953

像这样的东西：

```
HttpWebRequest req = (HttpWebRequest)WebRequest.Create(url);
req.Method = "POST";
req.ContentType = "application/x-www-form-urlencoded";
string data = "&p=" + dataThatNeedsToBeInTextArea;
byte[] byteArray = Encoding.UTF8.GetBytes (data);
req.ContentLength = byteArray.Length;
Stream stream= req.GetRequestStream ();
stream.Write (byteArray, 0, byteArray.Length);
stream.Close ();
StreamReader streamIn = new StreamReader(req.GetResponse().GetResponseStream());
string response = streamIn.ReadToEnd();
streamIn .Close(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T17:41:07.060

同意[@wentbackward](https://stackoverflow.com/questions/726710/fake-a-form-submission-with-c-webclient/726747#726747)，[WatiN](http://watin.sourceforge.net/)是另一种选择。

# java - 重构使用全局变量的类

> ID：726725
> 
> 赞同：3
> 
> 时间：2009-04-07T17:15:53.267
> 
> 标签：java, refactoring, global-variables

我正在研究一些从全局变量中获取部分配置的类，例如

```
class MyClass {
    public void MyClass(Hashtable<String, String> params) {
        this.foo = GlobalClass.GLOBALVAR.get("foo");
        this.bar = GlobalClass.GLOBALVAR.get("bar");
        this.params = params;
    }
} 
```

这有几个原因很糟糕，GLOBALVAR 与数据库对话以获取一些变量，这使得进行单元测试变得非常困难。另一个问题是我有很多（几十个）继承自 MyClass 的类，所以我不能轻易更改构造函数签名。

我当前的解决方案是为`params`,`foo`和. 创建一个额外的默认构造函数和 setter 方法`bar`。

```
class MyClass {
     // Other code still here for backwards compatibility.
     public void MyClass() {
         // Do nothing much.
     }
     public void setParams(Hashtable<String, String> params) {
         this.params = params;
     }
     public void setFoo(Foo foo) {
         this.foo = foo;
     }
     public void setBar(Bar bar) {
         this.bar = bar;
     }
} 
```

除了我这样做的方式之外，还有什么关于重构它的好方法的想法吗？我的另一个想法是使用工厂方法，但我担心我会遇到多态替换问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:26:25.817

我认为你应该引入一个接口，在全局变量集合和它的消费者之间放置一个抽象层。

```
interface GlobalVars {
   String get(String key);
} 
```

您应该引入一个范围有限的构造函数，可能`package-private`

```
MyClass(GlobalVars globals, Map<String, String> params) {
   // create the object
} 
```

然后提供`public static`工厂方法来使用这个构造函数。

```
public static MyClass newMyClass(Map<String, String> params) {
   return new MyClass(GlobalClass.GLOBAL_VAR, params);
} 
```

`GlobalVars`使用这种设计，您可以通过显式调用构造函数从同一包内传入单元测试的模拟实现。

*附录*：由于`params`似乎是一个必填字段，我肯定会这样做，`final`并避免使用添加变异器来覆盖它们的方法。

```
private final Map<String, String> params; 
```

另外，制作防御副本以防止 l33t h4x。

```
this.params = Collections.unmodifiableMap(params); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:58:53.210

我想我会先做以下事情。它让您现有的代码无需修改即可工作，并允许您尽可能向子类添加新的构造函数。一旦所有子类都有新的构造函数，并且对旧构造函数的所有调用都消失了，您就可以摆脱 GlobalClass 和使用它的构造函数。然后，希望您还可以清理 GLOBALVAR（我的代码中的 Car 类）。

```
import java.util.Hashtable;

class MyClass
{
    private final Foo foo;
    private final Bar bar;
    private final Hashtable<String, String> params;

    public MyClass(final Hashtable<String, String> params)
    {
        this(params, GlobalClass.GLOBALVAR);
    }

    // added constructor
    public MyClass(final Hashtable<String, String> params, 
                   final FooBar fooBar)
    {
        this.foo    = fooBar.getFoo();
        this.bar    = fooBar.getBar();
        this.params = params;
    }
}

class MySubClass
    extends MyClass
{
    public MySubClass(final Hashtable<String, String> params)
    {
        super(params);
    }

    // added constructor
    public MySubClass(final Hashtable<String, String> params, 
                      final FooBar fooBar)
    {
        super(params, fooBar);
    }
}

// unchanged
class GlobalClass
{
    public static Car GLOBALVAR;
}

// added interface
interface FooBar
{
    Foo getFoo();
    Bar getBar();
}

class Car
    // added implements
    implements FooBar
{
    private Foo foo = new Foo();
    private Bar bar = new Bar();

    public Object get(final String name)
    {
        if(name.equals("foo"))
        {
            return (foo);
        }

        if(name.equals("bar"))
        {
            return (bar);
        }

        throw new Error();
    }

    // added method
    public Foo getFoo()
    {
        return ((Foo)get("foo"));
    }

    // added method
    public Bar getBar()
    {
        return ((Bar)get("bar"));
    }
}

// unchanged
class Foo
{
}

// unchanged
class Bar
{
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T17:23:47.367

您的类应该在构造函数中获取其所有依赖项。最好不要创建无效或未初始化的类实例。make`foo`和`bar`private 和 final，并在构造函数中设置它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T17:19:50.807

您的方法的一个细微变化是在类中有一个 GLOBALVAR 类型的对象并使用它而不是实际的全局对象（重构应该是一个简单的搜索/替换）。您可以将新变量默认为实际的全局变量，并为测试提供覆盖。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T17:26:45.267

这个 GlobalClass.GLOBALVAR 应该被分割成逻辑单元。这样，为单元测试制作模拟对象会更容易。例如，在我的 CAD/CAM 金属切削应用程序中，我有一个 MaterialList、一个 SheetSizeList、PartNestingParameters 等。

我没有将一大堆变量放入一个巨大的 AppParameter 类中。它们都挂在 ShopStandards 对象上。对于涉及特定 PartNestingParmeters 的单元测试，我将只使用 ShopStandards.PartNestingParmeters = new MockPartNestingParameterTest114()。测试将在没有意识到零件嵌套参数是模型的情况下运行。另外，这让我不必为了测试正确设置 ShopStandard 而做几十个作业。

我们更加自动化，其中许多 Mock 从初始开发期间测试运行期间保存的文件加载。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T18:31:02.180

既然您提到您可以自由修改类层次结构。

*   更改基本 MyClass ctor 以接收 3 个参数 params、foo 和 bar。注释掉 GlobalVar 引用并简单地缓存传入的值
*   编译..这应该会引发一堆编译错误 - 没有采用 1 个参数的 ctor。
*   修复每一项以传入 GlobalVar.get("foo") 和 GlobalVar.get("bar")。得到它来建造。
*   优化：现在通过延迟加载和缓存 foo 和 bar 值来最小化对 DB 的命中。通过 GlobalVar 上的一些属性公开。

# iphone - NSInvalidArgumentException

> ID：726727
> 
> 赞同：5
> 
> 时间：2009-04-07T17:16:25.807
> 
> 标签：iphone, objective-c, cocoa-touch

I'm getting a crash from this routine after adding the :(id)sender so I could determine which button called it. When set up as plain old toggleView3 it works perfectly. The crash occurs when detailView is toggled back to docView.

`'NSInvalidArgumentException', reason: '*** -[RootViewController toggleView3]: unrecognized selector sent to instance 0x524a00' 2009-04-07 12:29:44.421 eTarot[11405:20b] Stack:`

```
-(IBAction)toggleView3:(id)sender{

    if (detailViewController == nil) {
        [self loadDetailViewController];
    }

    UIView *docView = docViewController.view;
    UIView *detailView = detailViewController.view;

    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:1];
    [UIView setAnimationTransition:([docView superview] ? UIViewAnimationTransitionFlipFromRight : UIViewAnimationTransitionFlipFromLeft) forView:self.view cache:YES];

    if ([docView superview] != nil) {
        [detailViewController viewWillAppear:YES];
        [docViewController viewWillDisappear:YES];
        [docView removeFromSuperview];

        [self.view addSubview:detailView];
        [self.view insertSubview:detailNavigationBar aboveSubview:detailView];
        [docViewController viewDidDisappear:YES];
        [detailViewController viewDidAppear:YES];

    } else {
        [docViewController viewWillAppear:YES];
        [detailViewController viewWillDisappear:YES];
        [detailView removeFromSuperview];
        [detailNavigationBar removeFromSuperview];
        [self.view addSubview:docView];
        [detailViewController viewDidDisappear:YES];
        [docViewController viewDidAppear:YES];
    }
    [UIView commitAnimations];
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T17:33:15.813

You're sending a view the message `toggleView3` when the correct name of the selector is `toggleView3:` — that is, with a colon and argument. They may look similar to you, but they're totally different methods to Objective-C.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T17:31:10.390

That exception means your application is calling toggleView3 without the :sender argument somewhere. Since your new method requires an argument, it's the same as calling a method that never existed.

If you look through the stack trace in the debugger it should be pretty clear where it's coming from. There's probably a warning in the build results, too.

# c# - 再次提出 C# 多态性问题 - 覆盖字段？

> ID：726732
> 
> 赞同：1
> 
> 时间：2009-04-07T17:18:32.807
> 
> 标签：c#, xna, polymorphism

这次我遇到了虚拟字段的问题。

我的游戏对象有核心类。此类包含带有模型类对象的字段。模型的对象包含位置等值。

现在 - 在绘图时我需要从它的模型中读取每个对象的位置。当我使用派生而不是默认模型类时，问题就开始了。例子：

```
abstract class GenericGameObject { public DefaultGameObjectModel Model = new DefaultGameObjectModel(); }
class Missile : GenericGameObject { public new MissileModel Model = new MissileModel(); }

class DefaultGameObjectModel { public Vector2 Position = new Vector2(){X=0}; }
class MissileModel : DefaultGameObjectModel { }

Missile m = new Missile();
m.Model.Position.X = 10;
// NOT OK! ((GenericGameObject)m).Model.Position.X == 0 
```

我试图将模型定义为虚拟属性而不是字段，但这失败了，因为派生属性必须与它们的基础类型相同。铸造是徒劳的，因为会有许多其他模型类型。如果我想从派生类而不是基类中读取值，我该怎么办？

我已经问过这个问题，但答案没有带来任何解决方案。解释：

*   **使用接口 IGameObjectModel**

    概念很好，但我必须强制执行字段。接口不能定义字段，所以我必须定义属性。但是我不能做 IGameObjectModel.Position.X=10 因为 Position 不是一个字段。

*   **为了使 GenericGameObject 成为泛型类型，例如 GenericGameObject 和 Missile 派生自 GenericGameObject 的类型，** 我无法将导弹投射到 GenericGameObject 并通常将这些对象存储在同一个列表中。当然，我可以制作这两个可以继承的主要基本类型，但是我将无法访问 Model 字段。

*   **使模型成为属性而不是字段。** 无法更改派生类中的属性类型。

我能做什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T17:26:26.830

在这种情况下，您最好的方法是将父字段的值分配为派生类的实例，然后将其转换回派生类或保留派生类的引用（可能更好）。

或者你可以走这条我最喜欢的路...

```
abstract class GenericGameObject
{
    public DefaultGameObjectModel Model
    {
        get { return ModelInternal; }
    }

    protected abstract DefaultGameObjectModel ModelInternal { get; }
}

class Missile : GenericGameObject
{
    private MissileModel model = new MissileModel();

    public override DefaultGameObjectModel ModelInternal
    {
        get { return model; }
    }

    public new MissileModel Model
    {
        get { return model; }
        set { model = value; }
    }
}

class DefaultGameObjectModel { public Vector2 Position = new Vector2(){X=0}; }
class MissileModel : DefaultGameObjectModel { }

Missile m = new Missile();
m.Model.Position.X = 10; 
```

此解决方案使您可以从基类的上下文访问您的基本模型实例，同时让您可以从继承的类访问您的具体模型实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T18:01:38.523

没有“虚拟领域”之类的东西。只有[属性](http://msdn.microsoft.com/en-us/library/aa664453(VS.71).aspx)和[方法](http://msdn.microsoft.com/en-us/library/aa645767(VS.71).aspx)可以是虚拟的。

在 Missle 类中，您似乎使用[new 关键字作为修饰符](http://msdn.microsoft.com/en-us/library/51y09td4(VS.71).aspx#vclrfnew_newmodifier)来隐藏名为 Model 的继承成员。

当您以这种方式隐藏继承的成员时，您不会获得多态行为。这很糟糕，因为基类中的代码（如果它引用了 Model 字段）可能无法按预期工作。

最好的选择：使用属性。必要时进行强制转换或泛化（将成员移动到基类）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T17:26:07.750

如果您使用接口，我相信您仍然可以调用：

```
IGameObjectModel.Position.X = 10; 
```

只要您用于 Position 的对象类型有一个名为 X 的读/写属性。您的界面将类似于：

```
public interface IGameObjectModel
{
    Vector2 Position
    {
        get;
        // only add set if you need to set the Position object outside of your class
        // set;
    }

    // ...other properties
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T17:42:21.097

您说过，如果您使用具有“无法执行 IGameObjectModel.Position.X=10”的属性的接口。我认为这是因为 Vector2 是一个结构，因此具有值类型语义。如果这是正确的，您应该简单地将 Position 属性分配给根据原始值计算的新 Vector2。例如：

```
Missile m = new Missile();
m.Model.Position = new Vector2()
{
    X = m.Model.Position.X + 10,
    Y = m.Model.Position.Y
}; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-28T17:42:03.800

您是否尝试过使用泛型？使用泛型，您可以将游戏对象模型与游戏对象分开。然后，您可以使用任何游戏对象模型实例化您的游戏对象。游戏对象可以通过标准接口与游戏对象模型通信。

```
interface IGameObjectModel {
    void Shoot();
        :
}

class GameObject<TModel> where TModel:IGameObjectModel {
    public TModel Model;
    public GameObject(TModel model) {
        Model = model;
    }
    public void Shoot() {
        Model.Shoot();
    }
        :
}

class MissleModel : IGameObjectModel {
    public void Shoot() {
        :
    }   
} 
```

有了以上内容，您就可以使用 Missle 模型实例化您的游戏对象：-

```
MissleModel model = new MissleModel();
GameObject<MissleModel> obj =
    new GameObject<MissleModel>(model); 
```

# groovy - 如何设置嵌入式 Groovy 脚本类路径？

> ID：726736
> 
> 赞同：3
> 
> 时间：2009-04-07T17:19:10.123
> 
> 标签：groovy, eclipse-plugin, classpath, embedded-language

我正在尝试扩展一个 Eclipse 代码构建器（用于从 Hibernate VO 生成 DTO）——它使用 Groovy 作为其模板系统。

它用于创建 groovy 脚本的代码有点奇怪（不是我在 Groovy 文档中看到的），但它可以正常工作，主要是：

```
GroovyShell shell = new GroovyShell();
script = shell.parse(source); 
```

然后，稍后：

```
Binding binding = (bindings == null ? new Binding() : new Binding(bindings));
Script scriptInstance = InvokerHelper.createScript(script.getClass(), binding);
scriptInstance.setProperty("out", out);
scriptInstance.run();
out.flush(); 
```

现在，这工作得很好，直到它引用一个不直接在项目中的对象。在脚本中，它遍历它正在处理的 Class 的属性——当它这样做时，Groovy 会查看所有方法，当它找不到某个方法参数的 Class 定义时，它就会出错。在这种情况下，当它发现任何对 Hibernate 的引用时，它就会死去，但我相信它会因为更多的东西而崩溃。它不需要对他们做任何事情，但如果不知道他们显然是什么，它就无法生存。

[脚本](http://groovy.codehaus.org/api/groovy/lang/Script.html)似乎没有可以提供任何类路径信息的类加载器，所以我尝试将它提供给[GroovyShell](http://groovy.codehaus.org/api/groovy/lang/GroovyShell.html) - 没有区别。

解决这个问题的正确方法是什么，以便 Groovy 解释器可以找到我的项目引用的 Jars？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T04:41:43.990

我遇到了这个确切的问题，并通过创建自己的 URLClassLoader 并使用反射调用受保护的方法来向 ClassPath 添加新路径来解决它

```
// Specify the path you want to add
URL url = new URL("file://path/to/classes/here");

// Create a new class loader as a child of the default system class loader
ClassLoader loader = new URLClassLoader(System.getClass().getClassLoader()); 

// Get the AddURL method and call it
Method method = URLClassLoader.class.getDeclaredMethod("addURL",new Class[]{URL.class});
method.setAccessible(true);
method.invoke(loader,new Object[]{ url });

GroovyShell shell = new GroovyShell( loader ); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-25T12:59:26.280

与@James 相同，无需使用反射即可完成，从某个文件夹加载所有 jar 文件：

```
URLClassLoader classLoader = new URLClassLoader( getExtraJarUrls(), getClass().getClassLoader() );
GroovyShell shell = new GroovyShell( classLoader, binding, compilerConfiguration );

private URL[] getExtraJarUrls() throws MalformedURLException
{
    logger.debug( "Loading extra jars from {}", EXTRA_JARS_DIR.getAbsolutePath() );
    URL[] result;
    File[] files = EXTRA_JARS_DIR.listFiles( new JarFilenameFilter() );
    if (files != null)
    {
        List<URL> urls = new ArrayList<URL>( files.length );
        for (File file : files)
        {
            urls.add( file.toURI().toURL() );
        }
        result = urls.toArray( new URL[urls.size()] );
    }
    else
    {
        result = new URL[0];
    }
    logger.debug( "Adding URLs to classloader: {}", Arrays.toString( result ) );
    return result;
}

private static class JarFilenameFilter implements FilenameFilter
{
    public boolean accept( File dir, String name )
    {
        return name.endsWith( ".jar" );
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T00:11:55.030

我在尝试自动运行 Gant 脚本时遇到了同样的问题。我找到的解决方案是：

1.  将 gant-starter.conf（或 groovy-starter.conf，如果它只是 groovy）从 $GROOVY_HOME/conf 复制到您自己的目录；

2.  在那里添加“load [directory]”或“load [jar]”，如 javadocs 中所述到 org.codehaus.groovy.tools.LoaderConfiguration，在 Groovy 源代码分发中找到；

3.  在启动 groovy 之前，将 groovy.starter.conf.override 系统属性设置为该文件的名称，例如 -Dgroovy.starter.conf.override=[filename]

# iphone - 如何在 iPhone 上使用 openGLES 制作水效果视图？

> ID：726738
> 
> 赞同：6
> 
> 时间：2009-04-07T17:19:26.753
> 
> 标签：iphone, opengl-es

我找到了这个视频：[http](http://www.youtube.com/watch?v=eVi6ThY3LRs) ://www.youtube.com/watch? v=eVi6ThY3LRs 我想知道这是否是 openGLES 的某种标准效果。我很确定是这样，因为我经常看到这种情况。KoiPond 使用它，DuckDuckDuck 使用它。很多游戏都使用它。他们不都是宇航员。他们是普通的程序员 ;) 那么这是怎么做到的呢？网上有这方面的教程吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T17:43:39.767

对于一个旧示例，请查看“[扭曲](http://web.archive.org/web/20120403194350/http://www.sgi.com/products/software/opengl/examples/more_samples/)”示例。请注意，这是在 1992 年创建的（仅在 distort.c 中查看）。

> 很棒的程序，只要按下鼠标按钮，就会在图像中产生涟漪。该程序的另一种模式就像一块橡胶，可以通过拖动鼠标来拉动。

我设法在我的mac上编译了这个例子。

*   全部重命名`#include <GL/glut.h>`为`#include <GLUT/glut.h>`
*   `usleep(33*1000);`在`idle()`函数中添加
*   将文件重命名`ripple_precalc.c`为`ripple_precalc.c.org`（或只是 rm ）
*   用“”编译`cc *.c -framework GLUT -framework OpenGL`将创建一个`a.out`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T17:27:30.150

（在我的头顶上）也许是纹理被固定到顶点的网格扭曲，因此随着网格顶点的移动而出现波纹？通过在网格周围移动一组顶点位移，您可以像波前一样产生均匀的波纹......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T06:07:36.650

JeeBee 是对的。您可以基于本教程编写代码：

[http://www.gamedev.net/reference/articles/article915.asp](http://www.gamedev.net/reference/articles/article915.asp)

# regex - PHP - 用于在 SQL 中添加表名的正则表达式

> ID：726743
> 
> 赞同：1
> 
> 时间：2009-04-07T17:20:25.457
> 
> 标签：regex

我正在寻找一种不显眼的方法来根据它们在 SQL 查询中的位置来查找和替换表名。

例子：

```
$query = 'SELECT t1.id, t1.name, t2.country FROM users AS t1, country AS t2 INNER JOIN another_table AS t3 ON t3.user_id = t1.id'; 
```

我基本上需要在表名前面加上客户端名称缩写，然后让我的 CMS 处理该更改。因此，从 'users' 到 'so_users'（如果 Stack Overflow 是客户端）但不必在所有查询表名称（如 Drupal）周围添加花括号。一个例子是 WordPress 如何允许您在设置时添加表名，但 WordPress 处理此问题的方式对我来说并不理想。

对于我的示例，我希望某些方法的输出为：

```
$query = 'SELECT t1.id, t1.name, t2.country FROM so_users AS t1, so_country AS t2 INNER JOIN so_another_table AS t3 ON t3.user_id = t1.id'; 
```

（'so_' 在表名前）

谢谢你。

克里斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T17:30:58.830

这应该适用于您给定的示例。

不过请注意，正如其他人已经提到的那样，正则表达式并不是满足您需要的最佳工具。鉴于正则表达式适用于您的示例，仅此而已。有很多可以想象的 SQL 结构，这个正则表达式**不会**进行您需要的替换。

```
$result = preg_replace('/(FROM|JOIN|,) ([_\w]*) (AS)/m', '$1 so_$2 $3', $subject); 
```

* * *

```
# (FROM|JOIN|,) ([_\w]*) (AS)
# 
# Match the regular expression below and capture its match into backreference number 1 «(FROM|JOIN|,)»
#    Match either the regular expression below (attempting the next alternative only if this one fails) «FROM»
#       Match the characters “FROM” literally «FROM»
#    Or match regular expression number 2 below (attempting the next alternative only if this one fails) «JOIN»
#       Match the characters “JOIN” literally «JOIN»
#    Or match regular expression number 3 below (the entire group fails if this one fails to match) «,»
#       Match the character “,” literally «,»
# Match the character “ ” literally « »
# Match the regular expression below and capture its match into backreference number 2 «([_\w]*)»
#    Match a single character present in the list below «[_\w]*»
#       Between zero and unlimited times, as many times as possible, giving back as needed (greedy) «*»
#       The character “_” «_»
#       A word character (letters, digits, etc.) «\w»
# Match the character “ ” literally « »
# Match the regular expression below and capture its match into backreference number 3 «(AS)»
#    Match the characters “AS” literally «AS» 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T17:41:32.223

使用查询构建器类将是最好的解决方案，因为您不想对要用正则表达式替换的模式做出任何假设。如果您没有找到适合您特定需求的任何现有库，请推出您自己的库。制作一个简单的查询构建器并不难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T18:35:58.190

正则表达式没有解析 SQL 的能力。想想这样的结构：

```
SELECT 'SELECT * FROM users';
SELECT * FROM users; -- users
SELECT '* -- users' FROM users;
SELECT '\' FROM users; -- ';               -- differs in My/Pg vs others
SELECT users.name FROM country AS users;   -- or without AS
SELECT users(name) FROM country;           -- users() is procedure
SELECT "users"."name" FROM users;          -- or ` on MySQL, [] in TSQL 
```

等等。要解析 SQL，您需要一个合适的 SQL 解析器库；在正则表达式中尝试破解它只会犯奇怪的错误。

# c# - 如何让 NHibernate SchemaExport 创建 SQL Server 时间戳列？

> ID：726745
> 
> 赞同：3
> 
> 时间：2009-04-07T17:20:31.990
> 
> 标签：c#, sql-server, nhibernate, fluent-nhibernate

我正在使用 NHibernate HBM2DDL SchemaExport 工具从我的实体对象生成我的数据库，并且我想使用 SQL Server Timestamp 列进行优化并发。

我向我的实体对象添加了如下所示的属性：

公共虚拟字节 [] 时间戳 { 获取；放; }

NHibernate 将生成 Timestamp 列，但类型是 varbinary(8000)。我宁愿在 SQL Server 中使用 Timestamp 类型，因为如果有人更改数据库中的某些内容（在 NHibernate 之外），它会自行增加。任何人都知道这是否可能以及我如何才能使这项工作？

（FWIW，我已按照[此处](http://www.techfocus2.com/2008/10/sql-server-timestamp-field-and-fluent-nhibernate/ "这里")找到的说明获取时间戳列以与 Fluent NHibernate 一起使用，但似乎这些东西与 SchemaExport 没有任何关系。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T19:44:03.083

回答我自己的问题...

您可以这样做，其中涉及一些技巧：http: //japikse.blogspot.com/2008/06/sql-server-timestamp-with-nhibernate-20.html?showComment=1239132960000# [c6605833213839346413](http://japikse.blogspot.com/2008/06/sql-server-timestamp-with-nhibernate-20.html?showComment=1239132960000#c6605833213839346413)

我只是让 NHibernate 创建 varbinary 列，然后运行 ​​SQL 脚本来修复所有问题：

```
DECLARE @sql nvarchar(255)
DECLARE @sql2 nvarchar(255)
WHILE EXISTS
(
    select 1 from INFORMATION_SCHEMA.COLUMNS 
    where COLUMN_NAME = 'Timestamp'
    and DATA_TYPE = 'varbinary'
)
BEGIN
    select  @sql = 'ALTER TABLE [' + table_name + '] DROP COLUMN [Timestamp]',
            @sql2 = 'ALTER TABLE [' + table_name + '] ADD [Timestamp] timestamp not null'
    from    INFORMATION_SCHEMA.COLUMNS 
    where   COLUMN_NAME = 'Timestamp'
    and     DATA_TYPE = 'varbinary'
    exec    sp_executesql @sql
    exec    sp_executesql @sql2
END
GO 
```

嘘！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-29T21:29:47.517

使用 FluentNHibernate，我得到了这个工作：（为了避免歧义，有些值是故意不命名为约定的。）

```
public partial class PetStore //: IPetStore
{

    public PetStore()
    { /*Constructor*/      }

    public virtual Guid? PetStoreUUID { get; set; }
    public virtual byte[] TheVersionProperty { get; set; }
    public virtual string PetStoreName { get; set; }
    public virtual DateTime CreateDate { get; set; }        

}

public class PetStoreMap : ClassMap<PetStore>
{
    public PetStoreMap()
    {
        Id(x => x.PetStoreUUID).GeneratedBy.GuidComb();

        OptimisticLock.Version();
        Version(x => x.TheVersionProperty)
            .Column("MyVersionColumn")
            .Not.Nullable()
            .CustomSqlType("timestamp")
            .Generated.Always();

            Map(x => x.PetStoreName);
            Map(x => x.CreateDate);
    }
} 
```

我的测试成功了，我没有得到可怕的“无法更新时间戳列”异常。

我的 DDL 显示为：

```
CREATE TABLE [dbo].[PetStore](
    [PetStoreUUID] [uniqueidentifier] NOT NULL,
    [MyVersionColumn] [timestamp] NOT NULL,
    [PetStoreName] [nvarchar](255) NULL,
    [CreateDate] [datetime] NULL) 
```

# ruby-on-rails - 如何冷冻耙子？

> ID：726750
> 
> 赞同：3
> 
> 时间：2009-04-07T17:21:42.003
> 
> 标签：ruby-on-rails, ruby, rake

我有一个 rails-app (2.3.2) 需要安装在未安装 rake 的服务器上，并且我没有安装 gem 的权限，所以我想冻结 rails gem .

但是，我不知道该怎么做。我已经把它放在 environment.rb 的依赖项中，但是“rake gems:unpack GEM=rake”没有效果。“rake gems”说 rake 是一个框架 gem，而不是一个冻结的 gem。

如何确保 rake 出现在我的“供应商/宝石”中，以及如何告诉 capistrano 使用该版本的 rake？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T18:19:38.323

冻结 gem 本身相当简单 - 如果 Maran 的解决方案不适合您，您可以在您的供应商目录中创建一个实际的 gem 存储库，然后执行`gem install rake --install-dir /rails_dir/vendor/gems`.

更难的部分是告诉 Capistrano 使用哪种耙子。你能发布更多关于你想用 rake 和 Capistrano 做什么的细节吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T18:39:16.977

这就是你想要的：

```
set :rake, "/path/to/rake" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:40:34.173

也许这可以帮助你？

[http://gemsonrails.rubyforge.org/](http://gemsonrails.rubyforge.org/)

# mysql - 这是什么文件？

> ID：726751
> 
> 赞同：0
> 
> 时间：2009-04-07T17:21:50.850
> 
> 标签：mysql, file-format

我不知道完整的故事，因为我最近才参与其中，但我有一个文件是“MySQL 数据库”（长篇大论，来源不是技术性的）。

文件名是：`something.db`

Linux`file`命令只是给出`data`

看里面我发现`Copyright (c)2000 9.0.0.1108` [`Sybase`](http://en.wikipedia.org/wiki/Sybase)（可能是作者或文件格式供应商）

我应该从文件中删除数据，但首先我需要知道它是什么类型。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T17:23:39.037

如果是 Sybase，我猜它是[SQLAnywhere](http://en.wikipedia.org/wiki/SQL_Anywhere)数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T17:26:54.190

这里，[供应商联动](http://www.sybase.com/products/databasemanagement/sqlanywhere)。

# arrays - 以螺旋顺序打印二维数组

> ID：726756
> 
> 赞同：59
> 
> 时间：2009-04-07T17:23:32.780
> 
> 标签：arrays, algorithm, language-agnostic, math

如何以螺旋顺序打印 5×5 二维数组？

是否有任何公式可以让我以螺旋顺序打印任意大小的数组？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2011-02-16T04:48:18.413

这个想法是将矩阵视为一系列层，右上层和左下层。要螺旋打印矩阵，我们可以从这些矩阵中剥离层，打印剥离的部分并递归调用左侧部分的打印。当我们没有更多要打印的层时，递归终止。

**输入矩阵：**

```
1 2 3 4 
5 6 7 8
9 0 1 2   
3 4 5 6 
7 8 9 1 
```

**剥离右上层后：**

```
 1 2 3 4 
       8
5 6 7  2
9 0 1  6   
3 4 5  1 
7 8 9 
```

**从子矩阵中剥离左下层后：**

```
 6 7
5  0 1   
9  4 5
3 
7 8 9 
```

**从子矩阵中剥离右上角层后：**

```
 6 7
      1   
   0  5
   4 
```

**从子矩阵中剥离左下层后：**

```
 0
  4 
```

递归终止。

* * *

**C函数：**

```
// function to print the top-right peel of the matrix and 
// recursively call the print bottom-left on the submatrix.
void printTopRight(int a[][COL], int x1, int y1, int x2, int y2) {
    int i = 0, j = 0;

    // print values in the row.
    for(i = x1; i<=x2; i++) {
        printf("%d ", a[y1][i]);
    }

    // print values in the column.
    for(j = y1 + 1; j <= y2; j++)         {
        printf("%d ", a[j][x2]);
    }

    // see if more layers need to be printed.
    if(x2-x1 > 0) {
        // if yes recursively call the function to 
        // print the bottom left of the sub matrix.
        printBottomLeft(a, x1, y1 + 1, x2-1, y2);
    }
}

// function to print the bottom-left peel of the matrix and 
// recursively call the print top-right on the submatrix.
void printBottomLeft(int a[][COL], int x1, int y1, int x2, int y2) {
    int i = 0, j = 0;

    // print the values in the row in reverse order.
    for(i = x2; i>=x1; i--) {
        printf("%d ", a[y2][i]);
    }

    // print the values in the col in reverse order.
    for(j = y2 - 1; j >= y1; j--) {
        printf("%d ", a[j][x1]);
    }

    // see if more layers need to be printed.
    if(x2-x1 > 0) {
        // if yes recursively call the function to 
        // print the top right of the sub matrix.
        printTopRight(a, x1+1, y1, x2, y2-1);
    }
}

void printSpiral(int arr[][COL]) {
    printTopRight(arr,0,0,COL-1,ROW-1);
    printf("\n");
} 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2014-06-17T16:43:22.790

1.  弹出顶行
2.  转置和倒置（与逆时针旋转 90 度相同）
3.  转到 1

Python 2 代码：

```
import itertools

arr = [[1,2,3,4],
       [12,13,14,5],
       [11,16,15,6],
       [10,9,8,7]]

def transpose_and_yield_top(arr):
    while arr:
        yield arr[0]
        arr = list(reversed(zip(*arr[1:])))

print list(itertools.chain(*transpose_and_yield_top(arr))) 
```

对于 python 3x：

```
import itertools

arr = [[1,2,3,4],
       [12,13,14,5],
       [11,16,15,6],
       [10,9,8,7]]

def transpose_and_yield_top(arr):
while arr:
    yield arr[0]
    arr = list(reversed(list(zip(*arr[1:]))))

print(list(itertools.chain(*transpose_and_yield_top(arr)))) 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2013-10-25T07:38:18.660

我看到没有人在代码中**只使用一个`for loop`**并且**没有递归**，所以我想做出贡献。

这个想法是这样的：

> 想象有一只乌龟站在点（0,0），即左上角，面向东方（向右）
> 
> 它会**继续前进**，每看到一个标志，乌龟就会**右转**
> 
> 因此，如果我们将海龟放置在点 (0,0) 向右，并且如果我们将标志放置在适当的位置，海龟将以螺旋方式遍历数组。
> 
> 现在的问题是：“在哪里放置标志？”

让我们看看我们应该把符号放在哪里（用#标记，数字用O）：

```
对于看起来像这样的网格：
哦哦哦
哦哦哦
哦哦哦
哦哦哦

我们把这样的标志：
哦哦#
#O#O
哦 # # 哦
#OO#

对于看起来像这样的网格：
噢噢噢
噢噢噢
噢噢噢
噢噢噢

我们把这样的标志：
OO #
# # 哦
哦#哦
#哦#

对于看起来像这样的网格：
呜呜呜
呜呜呜
呜呜呜
呜呜呜
呜呜呜

我们把这样的标志：
喔喔喔#
#OOOO#O
哦#OO#OO
O#OOO#O
#呜呜呜#

```

我们可以看到，除非该点在左上角，否则符号是在**距离最近的水平边界和最近的垂直边界相同的**点处，而对于左上角，**距离上边框比左边框的距离大一**，如果该点水平居中，则优先考虑右上角，如果该点垂直居中，则优先考虑左上角。

这可以很容易地在一个简单的函数中实现，通过取 ( 和 ) 的最小值，然后 (`curRow`和`height-1-curRow`) 的最小值`curCol`并`width-1-curCol`比较它们是否相同。但是我们需要考虑左上角的情况，即最小值是`curRow`和`curCol`它们自己的时候。在这种情况下，我们会相应地减少垂直距离。

这是C代码：

```
#include <stdio.h>

int shouldTurn(int row, int col, int height, int width){
    int same = 1;
    if(row > height-1-row) row = height-1-row, same = 0; // Give precedence to top-left over bottom-left
    if(col >= width-1-col) col = width-1-col, same = 0; // Give precedence to top-right over top-left
    row -= same; // When the row and col doesn't change, this will reduce row by 1
    if(row==col) return 1;
    return 0;
}

int directions[4][2] = {{0,1},{1,0},{0,-1},{-1,0}};
void printSpiral(int arr[4][4], int height, int width){
    int directionIdx=0, i=0;
    int curRow=0, curCol=0;
    for(i=0; i<height*width; i++){
        printf("%d ",arr[curRow][curCol]);
        if(shouldTurn(curRow, curCol, height, width)){
            directionIdx = (directionIdx+1)%4;
        }
        curRow += directions[directionIdx][0];
        curCol += directions[directionIdx][1];
    }
    printf("\n");
}

int main(){
    int arr[4][4]= {{1,2,3,4},{5,6,7,8},{9,10,11,12},{13,14,15,16}};
    printSpiral(arr, 4, 4);
    printSpiral(arr, 3, 4);
} 
```

哪个输出：

```
1 2 3 4 8 12 16 15 14 13 9 5 6 7 11 10
1 2 3 4 8 12 11 10 9 5 6 7

```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-11-17T02:53:34.670

以下是三种有趣的方式

1.  以螺旋方式阅读可以被视为一条向边界移动并开始撞击边界或自身的蛇（我发现它优雅且最有效的是 N 次迭代的单个循环）

    ```
    ar = [
         [ 0,  1,  2,  3, 4],
         [15, 16, 17, 18, 5],
         [14, 23, 24, 19, 6],
         [13, 22, 21, 20, 7],
         [12, 11, 10, 9, 8]]

    def print_spiral(ar):
        """
        assuming a rect array
        """
        rows, cols = len(ar), len(ar[0])
        r, c = 0, -1 # start here
        nextturn = stepsx = cols # move so many steps
        stepsy = rows-1
        inc_c, inc_r = 1, 0 # at each step move this much
        turns = 0 # how many times our snake had turned
        for i in range(rows*cols):
            c += inc_c
            r += inc_r 

            print ar[r][c],

            if i == nextturn-1:
                turns += 1
                # at each turn reduce how many steps we go next
                if turns%2==0:
                    nextturn += stepsx
                    stepsy -= 1
                else:
                    nextturn += stepsy
                    stepsx -= 1
                # change directions
                inc_c, inc_r = -inc_r, inc_c  

    print_spiral(ar) 
    ```

输出：

```
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 
```

2.  一种递归方法是打印外层并为内部矩形调用相同的函数，例如

    ```
    def print_spiral(ar, sr=0, sc=0, er=None, ec=None):
        er = er or len(ar)-1
        ec = ec or len(ar[0])-1

        if sr > er or sc > ec:
            print
            return

        # print the outer layer
        top, bottom, left, right = [], [], [], []
        for c in range(sc,ec+1):
            top.append(ar[sr][c])
            if sr != er:
                bottom.append(ar[er][ec-(c-sc)])

        for r in range(sr+1,er):
            right.append(ar[r][ec])
            if ec != sc:
                left.append(ar[er-(r-sr)][sc])

        print " ".join([str(a) for a in top + right + bottom + left]),

        # peel next layer of onion
        print_spiral(ar, sr+1, sc+1, er-1, ec-1) 
    ```

最后这是一个小片段，效率不高但很有趣:)，基本上它打印顶行，逆时针旋转整个矩形并重复

```
def print_spiral(ar):
    if not ar: return
    print " ".join(str(a) for a in ar[0]),
    ar = zip(*[ reversed(row) for row in ar[1:]])
    print_spiral(ar) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-03-04T23:15:57.450

该程序适用于任何 n*n 矩阵。

```
public class circ {
    public void get_circ_arr (int n,int [][] a)
    {
        int z=n;
        {
            for (int i=0;i<n;i++)
            {
                for (int l=z-1-i;l>=i;l--)
                {
                    int k=i;
                    System.out.printf("%d",a[k][l]);
                }           

                for (int j=i+1;j<=z-1-i;j++)
                {
                    int k=i;
                    {
                        System.out.printf("%d",a[j][k]);
                    }
                }

                for (int j=i+1;j<=z-i-1;j++)
                {
                    int k=z-1-i;
                    {
                        System.out.printf("%d",a[k][j]);
                    }
                }

                for (int j=z-2-i;j>=i+1;j--)
                {
                    int k=z-i-1;        
                    {
                        System.out.printf("%d",a[j][k]);
                    }
                }
            }
        }
    }
} 
```

希望能帮助到你

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-12-30T02:03:11.667

我在学习 Ruby 的时候就被这个问题困扰了。这是我能做的最好的：

```
def spiral(matrix)
  matrix.empty? ? [] : matrix.shift + spiral(matrix.transpose.reverse)
end 
```

您可以通过回顾本[要点](https://gist.github.com/O-I/56d3049d9d99de965383)中的修订来查看我的其他一些解决方案。此外，如果您按照我从中分出要点的链接返回，您会发现其他一些聪明的解决方案。非常有趣的问题，可以通过多种优雅的方式解决——尤其是在 Ruby 中。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-11-27T00:21:12.970

JavaScript 解决方案：

```
var printSpiral = function (matrix) {
  var i;
  var top = 0;
  var left = 0;
  var bottom = matrix.length;
  var right = matrix[0].length;

  while (top < bottom && left < right) {

    //print top 
    for (i = left; i < right; i += 1) {
      console.log(matrix[top][i]);
    }
    top++;

    //print right column
    for (i = top; i < bottom; i += 1) {
      console.log(matrix[i][right - 1]);
    }
    right--;

    if (top < bottom) {
      //print bottom
      for (i = right - 1; i >= left; i -= 1) {
        console.log(matrix[bottom - 1][i]);
      }
      bottom--;
    }

    if (left < right) {
      //print left column
      for (i = bottom - 1; i >= top; i -= 1) {
        console.log(matrix[i][left]);
      }
      left++;
    }
  }
}; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-10-31T03:29:20.640

一种解决方案涉及向右、向左、向上、向下的方向及其相应的限制（索引）。一旦打印了第一行，并且方向（从右）变为向下，则通过增加上限来丢弃该行。一旦打印了最后一列，并且方向更改为向左，则通过减少右手限制来丢弃该列……详细信息可以在不言自明的 C 代码中看到。

```
#include <stdio.h>
#define N_ROWS 5
#define N_COLS 3

void print_spiral(int a[N_ROWS][N_COLS])
{
    enum {up, down, left, right} direction = right;
    int up_limit = 0,
        down_limit = N_ROWS - 1,
        left_limit = 0,
        right_limit = N_COLS - 1,
        downcount = N_ROWS * N_COLS,
        row = 0,
        col = 0;

    while(printf("%d ", a[row][col]) && --downcount)
        if(direction == right)
        {
            if(++col > right_limit)
            {
                --col;
                direction = down;
                ++up_limit;
                ++row;
            }
        }
        else if(direction == down)
        {
            if(++row > down_limit)
            {
                --row;
                direction = left;
                --right_limit;
                --col;
            }
        }
        else if(direction == left)
        {
            if(--col < left_limit)
            {
                ++col;
                direction = up;
                --down_limit;
                --row;
            }
        }
        else /* direction == up */
            if(--row < up_limit)
            {
                ++row;
                direction = right;
                ++left_limit;
                ++col;
            }
}

void main()
{
    int a[N_ROWS][N_COLS] = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
    print_spiral(a);
} 
```

### [测试和下载链接](http://www.ideone.com/UN1y2)

.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-10-25T05:23:14.327

[二维 N*N 矩阵是方阵](http://www.sumeetkataria.com/2012/12/print-two-dimensional-nn-and-mn-matrix-in-spiral-form/)

主意：

我们必须在四个不同的方向上穿行才能像螺旋一样穿行。一旦一层螺旋结束，我们必须遍历矩阵内部。因此，总共需要 5 个循环，4 个循环像螺旋一样遍历，1 个循环遍历层。

```
public void printSpiralForm(int[][] a, int length)
{

  for( int i = 0 , j = length-1 ; i < j ; i++ , j-- )
  {

    for( int k = i ; k < j ; k++ )
    {
      System.out.print( a[i][k] + " " ) ;
    }

    for( int k = i ; k < j ; k++ )
    {
      System.out.print(a[k][j] + " ");
    }

    for( int k = j ; k > i ; k-- )
    {
      System.out.print(a[j][k] + " ") ;
    }

    for( int k = j ; k > i ; k-- )
    {
      System.out.print( a[k][i] + " " ) ;
    }

  }

  if ( length % 2 == 1 )
  {
    System.out.println( a[ length/2 ][ length/2 ] ) ;
  }

} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-10-28T00:40:10.100

给定一个字符矩阵，实现一个按以下顺序打印所有字符的方法：首先是外圆，然后是下一个，依此类推。

```
public static void printMatrixInSpiral(int[][] mat){

    if(mat.length == 0|| mat[0].length == 0){
        /* empty matrix */
        return;
    }

    StringBuffer str = new StringBuffer();
    int counter = mat.length * mat[0].length;
    int startRow = 0;
    int endRow = mat.length-1;
    int startCol = 0;
    int endCol = mat[0].length-1;
    boolean moveCol = true;
    boolean leftToRight = true;
    boolean upDown = true;

    while(counter>0){

        if(moveCol){

            if(leftToRight){

                /* printing entire row left to right */                 
                for(int i = startCol; i <= endCol ; i++){                       
                    str.append(mat[startRow][i]);
                    counter--;
                }
                leftToRight = false;
                moveCol = false;
                startRow++;
            }
            else{

                /* printing entire row right to left */
                for(int i = endCol ; i >= startCol ; i--){
                    str.append(mat[endRow][i]);
                    counter--;
                }
                leftToRight = true;
                moveCol = false;
                endRow--;       
            }
        }
        else
        {
            if(upDown){                 

                /* printing column up down */
                for(int i = startRow ; i <= endRow ; i++){                      
                    str.append(mat[i][endCol]);
                    counter--;
                }
                upDown = false;
                moveCol = true;
                endCol--;
            }
            else
            {

                /* printing entire col down up */
                for(int i = endRow ; i >= startRow ; i--){
                    str.append(mat[i][startCol]);
                    counter--;
                }
                upDown = true;
                moveCol = true;
                startCol++;
            }
        }
    }
    System.out.println(str.toString());
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-02-06T23:09:12.060

保持简单 -->

```
public class spiralMatrix {

public static void printMatrix(int[][] matrix, int rows, int col)
{
    int rowStart=0;
    int rowEnd=rows-1;
    int colStart=0;
    int colEnd=col-1;

    while(colStart<=colEnd && rowStart<=rowEnd)
    {
        for(int i=colStart;i<colEnd;i++)
            System.out.println(matrix[rowStart][i]);

        for(int i=rowStart;i<rowEnd;i++)
            System.out.println(matrix[i][colEnd]);

        for(int i=colEnd;i>colStart;i--)
            System.out.println(matrix[rowEnd][i]);

        for(int i=rowEnd;i>rowStart;i--)
            System.out.println(matrix[i][colStart]);
        rowStart++;
        colEnd--;
        rowEnd--;
        colStart++;

    }

}
public static void main(String[] args){

    int[][] array={{1,2,3,4},{5,6,7,8}};
    printMatrix(array,2,4);
} 
```

}

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-10-08T02:59:43.517

这是我的实现：

```
public static void printMatrix(int matrix[][], int M, int N){
    int level = 0;
    int min = (M < N) ? M:N;
    System.out.println();
    while(level <= min/2){
        for(int j = level; j < N - level - 1; j++){
            System.out.print(matrix[level][j] + "\t");
        }
        for(int i = level; i < M - level - 1; i++) {
            System.out.print(matrix[i][N - level - 1] + "\t");
        }
        for(int j = N - level - 1; j > level; j--){
            System.out.print(matrix[M - level - 1][j] + "\t");
        }
        for(int i = M - level - 1; i > level; i-- ){
            System.out.print(matrix[i][level] + "\t");
        }
        level++;
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-08-26T14:41:36.067

int N = Integer.parseInt(args[0]);

```
 // create N-by-N array of integers 1 through N
    int[][] a = new int[N][N];
    for (int i = 0; i < N; i++)
        for (int j = 0; j < N; j++)
            a[i][j] = 1 + N*i + j;

    // spiral
    for (int i = N-1, j = 0; i > 0; i--, j++) {
          for (int k = j; k < i; k++) System.out.println(a[j][k]);
          for (int k = j; k < i; k++) System.out.println(a[k][i]);
          for (int k = i; k > j; k--) System.out.println(a[i][k]);
          for (int k = i; k > j; k--) System.out.println(a[k][j]);
   }

   // special case for middle element if N is odd
   if (N % 2 == 1) System.out.println(a[(N-1)/2][(N-1)/2]);
} 
```

}

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-07-01T19:29:45.480

这是我的解决方案。如果我错了，请纠正。

```
class Spiral:

def spiralOrder(self, A):
    result = []
    c = []
    c.append(A[0])
    b = A[1:]
    while len(b) > 0:
        b = self.rotate(b)
        c.append(b[0])
        b = b[1:]
    for item in c:
        for fitem in item:
            print fitem,
            result.append(fitem)
    return result

def rotate(self,a):
    b = []
    l = zip(*a)
    for i in xrange(len(l)-1,-1,-1):
        b.append(list(l[i]))
    return b

if __name__ == '__main__':
  a = [[1, 2, 3,3], [4, 5, 6,6], [7, 8, 9,10]]
  s = Spiral()
s.spiralOrder(a) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-08-19T12:56:59.960

## 斜线顶行 -> 转置 -> 翻转 -> 重复。

```
void slashTransposeFlip(int[][] m){

    if( m.length * m[0].length == 1){ //only one element left
        System.out.print(m[0][0]);
    }else{
        //print the top row
        for(int a:m[0]){System.out.print(a+" ");}

        //slash the top row from the matrix.
        int[][] n = Arrays.copyOfRange(m,1,m.length);

        int[][] temp = n;
        int rows = temp.length;
        int columns = temp[0].length;

        //invert rows and columns and create new array
        n = new int[columns][rows];

        //transpose
        for(int x=0;x<rows;x++)
            for(int y=0;y<columns;y++)
                n[y][x] = temp[x][y];

        //flipping time
        for (int i = 0; i < n.length / 2; i++) {
          int[] t = n[i];
          n[i] = n[n.length - 1 - i];
          n[n.length - 1 - i] = t;
        }

        //recursively call again the reduced matrix.
        slashTransposeFlip(n);
    }
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-06-26T20:29:27.353

> 复杂性：**单次遍历** `O(n)`

请让我添加复杂的**单循环**答案`O(n)`。我观察到，在矩阵的左右遍历过程中，行主索引分别增加和减少了一个。类似地，对于自上而下和自下而上的遍历，增加和减少`n_cols`. 因此我为此做了一个算法。例如，给定一个包含条目的 (3x5) 矩阵，打印输出的行主要索引为：`1,2,3,4,5,10,15,14,13,12,11,6,7,8,9`.

```
 ------->(+1)
          ^ 1  2  3  4  5   |
(+n_cols) | 6  7  8  9  10  | (-n_cols)
          | 11 12 13 14 15  
            (-1)<------- 
```

**代码解决方案：**

```
#include <iostream>
using namespace std;

int main() {
    // your code goes here

    bool leftToRight=true, topToBottom=false, rightToLeft=false, bottomToTop=false;
    int idx=0;
    int n_rows = 3;
    int n_cols = 5;
    int cnt_h = n_cols, cnt_v = n_rows, cnt=0;
    int iter=1;
    for (int i=0; i <= n_rows*n_cols + (n_rows - 1)*(n_cols - 1)/2; i++){

        iter++; 
        if(leftToRight){
            if(cnt >= cnt_h){ 
                cnt_h--; cnt=0;
                leftToRight = false; topToBottom = true; 
                //cout  << "Iter: "<< iter << " break_leftToRight"<<endl;
            }else{
                cnt++;
                idx++;
                //cout << "Iter: "<< iter <<" idx: " << idx << " cnt: "<< cnt << " cnt_h: "<< cnt_h<< endl;
                cout<< idx << endl;
            }
        }else if(topToBottom){
            if(cnt >= cnt_v-1){
                cnt_v--; cnt=0;  
                leftToRight = false; topToBottom = false; rightToLeft=true;
                //cout  << "Iter: "<< iter  << " break_topToBottom"<<endl;
            }else{
                cnt++;
                idx+=n_cols;
                //cout  << "Iter: "<< iter << " idx: " << idx << " cnt: "<< cnt << " cnt_v: "<< cnt_h<< endl;
                cout << idx <<endl;
            }
        }else if(rightToLeft){
            if(cnt >= cnt_h){
                cnt_h--; cnt=0; 
                leftToRight = false; topToBottom = false; rightToLeft=false; bottomToTop=true;
                //cout  << "Iter: "<< iter  << " break_rightToLeft"<<endl;
                //cout<< idx << endl;
            }else{
                cnt++;
                idx--;
                //cout  << "Iter: "<< iter << " idx: " << idx << " cnt: "<< cnt << " cnt_h: "<< cnt_h<< endl;
                cout << idx <<endl;
            }
        }else if(bottomToTop){
            if(cnt >= cnt_v-1){
                cnt_v--; cnt=0;
                leftToRight = true; topToBottom = false; rightToLeft=false; bottomToTop=false;
                //cout  << "Iter: "<< iter << " break_bottomToTop"<<endl;
            }else{
                cnt++;
                idx-=n_cols;
                //cout  << "Iter: "<< iter << " idx: " << idx << " cnt: "<< cnt << " cnt_v: "<< cnt_h<< endl;
                cout<< idx << endl;
            }
        }

        //cout << i << endl;
    }

    return 0;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-04-26T03:06:37.733

```
function spiral(a) {
  var s = [];
  while (a.length) {
    // concat 1st row, push last cols, rotate 180 (reverse inner/outer)...
    s = s.concat(a.shift());
    a = a
      .map(function(v) {
        s.push(v.pop());
        return v.reverse();
      })
      .reverse();
  }
  return s;
}
var arr = [
  [1, 2, 3, 4], 
  [12, 13, 14, 5], 
  [11, 16, 15, 6], 
  [10, 9, 8, 7]
];
console.log(spiral(arr));// -> [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
arr = [
  [0, 1, 2, 3, 4],
  [15, 16, 17, 18, 5],
  [14, 23, 24, 19, 6],
  [13, 22, 21, 20, 7],
  [12, 11, 10, 9, 8]
];
console.log(spiral(arr));// -> [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-08-25T18:55:54.000

对于打印二维矩阵，将矩阵视为矩形和/或线的组合，其中较小的矩形适合较大的矩形，取矩阵的边界，形成要打印的矩形，每次在每一层中从左上元素开始; 一旦完成，进入下一层较小的矩形，如果我没有矩形，那么它应该是要打印的线，水平或垂直。我已将代码粘贴到示例矩阵 HTH 中。

```
#include <stdio.h>

int a[2][4] = { 1, 2 ,3, 44,
                8, 9 ,4, 55 };

void print(int, int, int, int);

int main() {

int row1, col1, row2, col2;

row1=0;
col1=0;
row2=1;
col2=3;

while(row2>=row1 && col2>=col1)
{
    print(row1, col1, row2, col2);

    row1++;
    col1++;
    row2--;
    col2--;
}

return 0;
}

void print(int row1, int col1, int row2, int col2) {

int i=row1;
int j=col1;

/* This is when single horizontal line needs to be printed */
if( row1==row2 && col1!=col2) {
    for(j=col1; j<=col2; j++)
        printf("%d ", a[i][j]);
    return;
}

/* This is when single vertical line needs to be printed */
if( col1==col2 && row1!=row2) {
    for(i=row1; j<=row2; i++)
        printf("%d ", a[i][j]);
    return;
}

/* This is reached when there is a rectangle to be printed */

for(j=col1; j<=col2; j++)
    printf("%d ", a[i][j]);

for(j=col2,i=row1+1; i<=row2; i++)
    printf("%d ", a[i][j]);

for(i=row2,j=col2-1; j>=col1; j--)
    printf("%d ", a[i][j]);

for(j=col1,i=row2-1; i>row1; i--)
    printf("%d ", a[i][j]);

} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-01-15T05:41:55.930

这是我在 Java 中的实现：

```
public class SpiralPrint {
static void spiral(int a[][],int x,int y){

    //If the x and y co-ordinate collide, break off from the function

    if(x==y)
        return;
    int i;

    //Top-left to top-right

    for(i=x;i<y;i++)
        System.out.println(a[x][i]);

    //Top-right to bottom-right 

    for(i=x+1;i<y;i++)
        System.out.println(a[i][y-1]);

    //Bottom-right to bottom-left

    for(i=y-2;i>=x;i--)
        System.out.println(a[y-1][i]);

    //Bottom left to top-left

    for(i=y-2;i>x;i--)
        System.out.println(a[i][x]);

    //Recursively call spiral

    spiral(a,x+1,y-1);

}

public static void main(String[] args) {

    int a[][]={{1,2,3,4},{5,6,7,8},{9,10,11,12},{13,14,15,16}};
    spiral(a,0,4);
    /*Might be implemented without the 0 on an afterthought, all arrays will start at 0 anyways. The second parameter will be the dimension of the array*/ 

    }

} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-07-03T09:48:00.197

```
//shivi..coding is adictive!!
#include<shiviheaders.h>
#define R 3
#define C 6
using namespace std;

void  PrintSpiral(int er,int ec,int arr[R][C])
{
    int sr=0,sc=0,i=0;

    while(sr<=er && sc<=ec)
    {
        for(int i=sc;i<=ec;++i)
            cout<<arr[sr][i]<<" ";
        ++sr;

        for(int i=sr;i<=er;++i) 
            cout<<arr[i][ec]<<" ";
        ec--;

        if(sr<=er)  
        {
            for(int i=ec;i>=sc;--i)
                cout<<arr[er][i]<<" ";
            er--;   
        }

        if(sc<=ec)
        {
            for(int i=er;i>=sr;--i)
                cout<<arr[i][sc]<<" ";
            ++sc;   
        }

    }

}

int main()
{
    int a[R][C] = { {1,  2,  3,  4,  5,  6},
            {7,  8,  9,  10, 11, 12},
            {13, 14, 15, 16, 17, 18}
        };

        PrintSpiral(R-1, C-1, a);
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-11-07T00:34:31.737

如果有人感兴趣，Java 代码。
**输入**：
4
1 2 3 4
5 6 7 8
9 1 2 3
4 5 6 7

**输出**：1 2 3 4 8 3 7 6 5 4 9 5 6 7 2 1

```
public class ArraySpiralPrinter {

  public static void main(String[] args) {
    Scanner sc = new Scanner(System.in);
    int n = sc.nextInt(); //marrix size
    //read array
    int[][] ar = new int[n][n];
    for (int i = 0; i < n; i++) {
      for (int j = 0; j < n; j++) {
        ar[i][j] = sc.nextInt();
      }
    }
    printTopRight(0, 0, n - 1, n - 1, ar);
  }
    //prints top and right layers.
  //(x1,y1) to (x1, y2) - top layer & (x1,y2) to (x2, y2)
  private static void printTopRight(int x1, int y1, int x2, int y2, int[][] ar) {
    //print row values - top
    for (int y = y1; y <= y2; y++) {
      System.out.printf("%d ", ar[x1][y]);
    }
    //print column value - right
    for (int x = x1 + 1; x <= x2; x++) {
      System.out.printf("%d ", ar[x][y2]);
    }

    //are there any remaining layers
    if (x2 - x1 > 0) {
      //call printBottemLeft
      printBottomLeft(x1 + 1, y1, x2, y2 - 1, ar);
    }
  }

    //prints bottom and left layers in reverse order
  //(x2,y2) to (x2, y1) - bottom layer & (x2,y1) to (x1, y1)
  private static void printBottomLeft(int x1, int y1, int x2, int y2, int[][] ar) {
    //print row values in reverse order - bottom
    for (int y = y2; y >= y1; y--) {
      System.out.printf("%d ", ar[x2][y]);
    }

    //print column value in reverse order - left
    for (int x = x2-1; x >= x1; x--) {
      System.out.printf("%d ", ar[x][y1]);
    }

    //are there any remaining layers
    if (x2 - x1 > 0) {
      printTopRight(x1, y1 + 1, x2 - 1, y2, ar);
    }
  }
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-01-16T19:38:30.037

这是我能想到的 C 中的递归版本：-

```
void printspiral  (int[][100],int, int, int, int);

int main()
{
  int r,c, i, j;
  printf ("Enter the dimensions of the matrix");
  scanf("%d %d", &r, &c);
  int arr[r][100];
  int min = (r<c?r:c);
  if (min%2 != 0) min = min/2 +1;
  for (i = 0;i<r; i++)
    for (j = 0; j<c; j++)
        scanf ("%d",&arr[i][j]);

  printspiral(arr,0,r,c,min );

}

void printspiral (int arr[][100], int i, int j, int k, int min)
{
   int a;

   for (a = i; a<k;a++)
   printf("%d\n", arr[i][a]);
   for (a=i+1;a<j;a++) 
   printf ("%d\n", arr[a][k-1]);
   for (a=k-2; a>i-1;a--)
   printf("%d\n", arr[j-1][a]);
   for (a=j-2; a>i; a--)
   printf("%d\n", arr[a][i]);
   if (i < min)
       printspiral(arr,i+1, j-1,k-1, min);

 } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-01-23T17:47:53.347

[http://www.technicalinterviewquestions.net/2009/03/print-2d-array-matrix-spiral-order.html](http://www.technicalinterviewquestions.net/2009/03/print-2d-array-matrix-spiral-order.html)

这是对上述答案的最佳解释:)以及图表:)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-02-15T09:01:01.377

```
public static void printSpiral1(int array[][],int row,int col){

    int rowStart=0,colStart=0,rowEnd=row-1,colEnd=col-1;
    int i;

    while(rowStart<=rowEnd && colStart<= colEnd){

        for(i=colStart;i<=colEnd;i++)
            System.out.print(" "+array[rowStart][i]);   

        for(i=rowStart+1;i<=rowEnd;i++)
            System.out.print(" "+array[i][colEnd]); 

        for(i=colEnd-1;i>=colStart;i--)
            System.out.print(" "+array[rowEnd][i]); 

        for(i=rowEnd-1;i>=rowStart+1;i--)
            System.out.print(" "+array[i][colStart]);   

        rowStart++;
        colStart++;
        rowEnd--;
        colEnd--;
    }

} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-03-25T06:08:28.097

```
public class SpiralPrint{

    //print the elements of matrix in the spiral order.
    //my idea is to use recursive, for each outer loop

    public static void printSpiral(int[][] mat, int layer){
        int up = layer;
        int buttom = mat.length - layer - 1;
        int left = layer;
        int right = mat[0].length - layer - 1;
        if(up > buttom+1 || left > right + 1)
            return; // termination condition

        //traverse the other frame, 
        //print up
        for(int i = left; i <= right; i ++){
            System.out.print( mat[up][i]+ " " );
        }
        //print right
        for(int i = up + 1; i <=buttom; i ++){
            System.out.print(mat[i][right] + " ");
        }

        //print buttom
        for(int i = right - 1; i >= left; i --){
            System.out.print(mat[buttom][i] + " ");
        }

        //print left
        for(int i = buttom - 1; i > up; i --){
            System.out.print(mat[i][left] + " ");
        }

        //recursive call for the next level
        printSpiral(mat, layer + 1);
    }

    public static void main(String[] args){

        int[][] mat = {{1,2,3,4}, {5,6,7,8}, {9,10,11,12}, {13,14,15,16}};
        int[][] mat2 = {{1,2,3}, {4,5,6}, {7,8,9}, {10,11,12}};
        SpiralPrint.printSpiral(mat2,0);
        return;
    }
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-04-12T00:52:59.573

这是我在 C# 中的解决方案：

```
public static void PrintSpiral(int[][] matrix, int n)
{
    if (matrix == null)
    {
        return;
    }

    for (int layer = 0; layer < Math.Ceiling(n / 2.0); layer++)
    {
        var start = layer;
        var end = n - layer - 1;
        var offset = end - 1;

        Console.Write("Layer " + layer + ": ");

        // Center case
        if (start == end)
        {
            Console.Write(matrix[start][start]);
        }

        // Top
        for (int i = start; i <= offset; i++)
        {
            Console.Write(matrix[start][i] + " ");
        }

        // Right
        for (int i = start; i <= offset; i++)
        {
            Console.Write(matrix[i][end] + " ");
        }

        // Bottom
        for (int i = end; i > start; i--)
        {
            Console.Write(matrix[end][i] + " ");
        }

        // Left
        for (int i = end; i > start; i--)
        {
            Console.Write(matrix[i][start] + " ");
        }

        Console.WriteLine();
    }
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-04-12T06:36:46.397

这是我使用 Iterator 的方法。请注意，这解决了几乎相同的问题。完整的代码在这里：[https ://github.com/rdsr/algorithms/blob/master/src/jvm/misc/FillMatrix.java](https://github.com/rdsr/algorithms/blob/master/src/jvm/misc/FillMatrix.java)

```
import java.util.Iterator;

class Pair {
    final int i;
    final int j;

    Pair(int i, int j) {
        this.i = i;
        this.j = j;
    }

    @Override
    public String toString() {
        return "Pair [i=" + i + ", j=" + j + "]";
    }
}

enum Direction {
    N, E, S, W;
}

class SpiralIterator implements Iterator<Pair> {
    private final int r, c;
    int ri, ci;
    int cnt;

    Direction d; // current direction
    int level; // spiral level;

    public SpiralIterator(int r, int c) {
        this.r = r;
        this.c = c;

        d = Direction.E;
        level = 1;
    }

    @Override
    public boolean hasNext() {
        return cnt < r * c;
    }

    @Override
    public Pair next() {
        final Pair p = new Pair(ri, ci);
        switch (d) {
            case E:
                if (ci == c - level) {
                    ri += 1;
                    d = changeDirection(d);
                } else {
                    ci += 1;
                }
                break;

            case S:
                if (ri == r - level) {
                    ci -= 1;
                    d = changeDirection(d);
                } else {
                    ri += 1;
                }
                break;

            case W:
                if (ci == level - 1) {
                    ri -= 1;
                    d = changeDirection(d);
                } else {
                    ci -= 1;
                }
                break;

            case N:
                if (ri == level) {
                    ci += 1;
                    level += 1;
                    d = changeDirection(d);
                } else {
                    ri -= 1;
                }
                break;
        }

        cnt += 1;
        return p;
    }

    private static Direction changeDirection(Direction d) {
        switch (d) {
            case E:
                return Direction.S;
            case S:
                return Direction.W;
            case W:
                return Direction.N;
            case N:
                return Direction.E;
            default:
                throw new IllegalStateException();
        }
    }

    @Override
    public void remove() {
        throw new UnsupportedOperationException();
    }

}

public class FillMatrix {
    static int[][] fill(int r, int c) {
        final int[][] m = new int[r][c];
        int i = 1;
        final Iterator<Pair> iter = new SpiralIterator(r, c);
        while (iter.hasNext()) {
            final Pair p = iter.next();
            m[p.i][p.j] = i;
            i += 1;
        }
        return m;
    }

    public static void main(String[] args) {
        final int r = 19, c = 19;
        final int[][] m = FillMatrix.fill(r, c);
        for (int i = 0; i < r; i++) {
            for (int j = 0; j < c; j++) {
                System.out.print(m[i][j] + " ");
            }
            System.out.println();
        }
    }
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-09-24T12:06:23.013

*对于给定行 x 列*的任何二维数组矩阵，完成纯 C 程序。

```
#include <stdio.h>
void  printspiral(int *p,int r, int c) {    
    int i=0,j=0,m=1,n=0;
    static int firstrun=1,gCol;
    if (!p||r<=0||c<=0)
        return ;
    if(firstrun) {
        gCol=c;
        firstrun=0;
    }
    for(i=0,j=0;(0<=i && i<c)&&(0<=j && j<r);i+=m,j+=n) {                                                                               
        printf(" %d",p[i+j*gCol]);                                                                                                      
        if (i==0 && j==1 && (i+1)!=c) break;                                                                                            
        else if (i+1==c && !j) {m=0;n=1;}                                                                                               
        else if (i+1==c && j+1==r && j) {n=0;m=-1;}                                                                                     
        else if (i==0 && j+1==r && j) {m=0;n=-1;}                                                                                       
    }                                                                                                                                   
    printspiral(&p[i+j*gCol+1],r-2,c-2);                                                                                                
    firstrun=1;                                                                                                                         
    printf("\n");                                                                                                                       
}                                                                                                                                       
int main() {                                                                                                                            
    int a[3][3]={{0,1,2},{3,4,5},{6,7,8}};                                                                                              
    int b[3][4]={{0,1,2,3},{4,5,6,7},{8,9,10,11}};                                                                                      
    int c[4][3]={{0,1,2},{3,4,5},{6,7,8},{9,10,11}};                                                                                    
    int d[3][1]={{0},{1},{2}};                                                                                                          
    int e[1][3]={{0,1,2}};                                                                                                              
    int f[1][1]={{0}};                                                                                                                  
    int g[5][5]={{0,1,2,3,4},{5,6,7,8,9},{10,11,12,13,14},{15,16,17,18,19},{20,21,22,23,24}};
    printspiral(a,3,3);                                                                                                                 
    printspiral(b,3,4);                                                                                                                 
    printspiral(c,4,3);                                                                                                                 
    printspiral(d,3,1);                                                                                                                 
    printspiral(e,1,3);                                                                                                                 
    printspiral(f,1,1);                                                                                                                 
    printspiral(g,5,5);
    return 0;                                                                                                                           
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-09-24T16:10:02.247

这个问题与这个问题有关：[php 中的矩阵排列问题](https://stackoverflow.com/questions/3584557/logical-problem)

提出的答案似乎有效，但理解起来很复杂。解决这个问题的一个非常简单的方法是分而治之，即在读取边缘之后，将其移除，下一次读取会简单得多。在下面查看完整的 PHP 解决方案：

```
#The source number matrix
$source[0] = array(1, 2, 3, 4);
$source[1] = array(5, 6, 7, 8);
$source[2] = array(9, 10, 11, 12);
$source[3] = array(13, 14, 15, 16);
$source[4] = array(17, 18, 19, 20);

#Get the spiralled numbers
$final_spiral_list = get_spiral_form($source);
print_r($final_spiral_list);

function get_spiral_form($matrix)
{
    #Array to hold the final number list
    $spiralList = array();

    $result = $matrix;
    while(count($result) > 0)
    {
        $resultsFromRead = get_next_number_circle($result, $spiralList);
        $result = $resultsFromRead['new_source'];
        $spiralList = $resultsFromRead['read_list'];
    }

    return $spiralList;
}

function get_next_number_circle($matrix, $read)
{
    $unreadMatrix = $matrix;

    $rowNumber = count($matrix);
    $colNumber = count($matrix[0]);

    #Check if the array has one row or column
    if($rowNumber == 1) $read = array_merge($read, $matrix[0]);
    if($colNumber == 1) for($i=0; $i<$rowNumber; $i++) array_push($read, $matrix[$i][0]);
    #Check if array has 2 rows or columns
    if($rowNumber == 2 || ($rowNumber == 2 && $colNumber == 2)) 
    {
        $read = array_merge($read, $matrix[0], array_reverse($matrix[1]));
    }

    if($colNumber == 2 && $rowNumber != 2) 
    {
        #First read left to right for the first row
        $read = array_merge($read, $matrix[0]);
        #Then read down on right column
        for($i=1; $i<$rowNumber; $i++) array_push($read, $matrix[$i][1]);
        #..and up on left column
        for($i=($rowNumber-1); $i>0; $i--) array_push($read, $matrix[$i][0]);
    }

    #If more than 2 rows or columns, pick up all the edge values by spiraling around the matrix
    if($rowNumber > 2 && $colNumber > 2)
    {
        #Move left to right
        for($i=0; $i<$colNumber; $i++) array_push($read, $matrix[0][$i]);
        #Move top to bottom
        for($i=1; $i<$rowNumber; $i++) array_push($read, $matrix[$i][$colNumber-1]);
        #Move right to left
        for($i=($colNumber-2); $i>-1; $i--) array_push($read, $matrix[$rowNumber-1][$i]);
        #Move bottom to top
        for($i=($rowNumber-2); $i>0; $i--) array_push($read, $matrix[$i][0]);
    }

    #Now remove these edge read values to create a new reduced matrix for the next read
    $unreadMatrix = remove_top_row($unreadMatrix);  

    $unreadMatrix = remove_right_column($unreadMatrix); 
    $unreadMatrix = remove_bottom_row($unreadMatrix);   
    $unreadMatrix = remove_left_column($unreadMatrix);  

    return array('new_source'=>$unreadMatrix, 'read_list'=>$read);
}

function remove_top_row($matrix)
{
    $removedRow = array_shift($matrix);
    return $matrix;
}

function remove_right_column($matrix)
{
    $neededCols = count($matrix[0]) - 1;
    $finalMatrix = array();
    for($i=0; $i<count($matrix); $i++) $finalMatrix[$i] = array_slice($matrix[$i], 0, $neededCols);
    return $finalMatrix;
}

function remove_bottom_row($matrix)
{
    unset($matrix[count($matrix)-1]);
    return $matrix;
}

function remove_left_column($matrix)
{
    $neededCols = count($matrix[0]) - 1;
    $finalMatrix = array();
    for($i=0; $i<count($matrix); $i++) $finalMatrix[$i] = array_slice($matrix[$i], 1, $neededCols);
    return $finalMatrix;
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-07-22T03:42:13.373

```
// Program to print a matrix in spiral order

#include <stdio.h>
int main(void) {
    // your code goes here
    int m,n,i,j,k=1,c1,c2,r1,r2;;
    scanf("%d %d",&m,&n);
    int a[m][n];
    for(i=0;i<m;i++)
    {
        for(j=0;j<n;j++)
        {
            scanf("%d",&a[i][j]);
        }
    }
    r1=0;
    r2=m-1;
    c1=0;
    c2=n-1;

    while(k<=m*n)
                {
                    for(i=c1;i<=c2;i++)
                    {
                        k++;
                        printf("%d ",a[r1][i]);
                    }

                    for(j=r1+1;j<=r2;j++)
                    {
                        k++;
                        printf("%d ",a[j][c2]);
                    }

                    for(i=c2-1;i>=c1;i--)
                    {
                        k++;
                        printf("%d ",a[r2][i]);
                    }

                    for(j=r2-1;j>=r1+1;j--)
                    {
                        k++;
                        printf("%d ",a[j][c1]);
                    }

                 c1++;
                 c2--;
                 r1++;
                 r2--;
                }
    return 0;
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2016-01-27T15:59:28.990

这是任何 mxn 矩阵的 java 实现。其中行 = 行数，列 = 列数

```
public static void printSpiral(int rows, int columns, int a[][])
    {
        int i, k = 0, l = 0;

        /*  k - starting row index
            l - starting column index
        */

        while (k < rows && l < columns)
        {
            /* Print the first row from the remaining rows */
            for (i = l; i < columns; ++i)
            {
                System.out.println(a[k][i]);
            }
            k++;

            /* Print the last column from the remaining columns */
            for (i = k; i < rows; ++i)
            {
                System.out.println(a[i][columns-1]);
            }
            columns--;

            /* Print the last row from the remaining rows */
            if ( k < rows)
            {
                for (i = columns-1; i >= l; --i)
                {
                    System.out.println(a[rows-1][i]);
                }
                rows--;
            }

            /* Print the first column from the remaining columns */
            if (l < columns)
            {
                for (i = rows-1; i >= k; --i)
                {
                    System.out.println(a[i][l]);
                }
                l++;    
            }        
        }
    } 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-08-11T07:40:54.603

```
#include <iostream>

using namespace std;

const int MAX=100;

int main(void)
{
int a[MAX][MAX],i,j,lower,upper,k,n=0,am=0;
cout<<"enter number or size of matrix \n"<<endl;
cin>>n;

// assigning the value 
for(i=0;i<n;i++)
{
    for(j=0;j<n;j++)
      a[i][j]=am+1;

}
i=0;
j=0;
lower=0,upper=n-1;
for(k=0;k<(n*n);k++)
{
    cout<<a[i][j]<<"\t";
    if((i==lower)&&(j<upper))
            j++;
    else if((j==upper)&&(i<lower))
            j--;
    else if((j==lower)&&(i>lower))
           i--;
    if((a[i][j]==a[lower][i]))
    {
        lower++;
        upper--;
        i++;
        j++;
    }
}
return 0;
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2017-01-15T17:03:16.303

您可以想象螺旋线由一组有序的水平和垂直线段组成。您还可以观察到，**每个下一个水平段比前一个水平段短一个元素，每个下一个垂直段比前一个垂直段短一个元素**。每个**下一个段开始于一个单元格，该单元格与前一个段结束的单元格相邻**。我假设我们在顺时针方向构建一个螺旋。第一个水平段长度等于给定矩阵中的列数。第一个垂直段长度等于给定矩阵中的行数减一。使用这些观察，您可以遍历任何 NxM 矩阵，而无需任何额外的内存和`O(NxM)`运行时间的递归：

```
public static void VisitBySpiral<T>(T[,] matrix, Action<T> onVisit)
{
    var spiralWidth = matrix.GetLength(1);
    var spiralHeight = matrix.GetLength(0);
    var row = 0;
    var column = 0;
    var step = +1;
    while (spiralWidth > 0 && spiralHeight > 0)
    {
        var horizontalSteps = spiralWidth;
        while (horizontalSteps-- > 0)
        {
            onVisit(matrix[row, column]);
            if (horizontalSteps > 0)
            {
                column += step;
            }
        }
        // Move to the cell where next vertical segment starts.
        row += step;
        --spiralHeight;

        var verticalSteps = spiralHeight;
        while (verticalSteps-- > 0)
        {
            onVisit(matrix[row, column]);
            if (verticalSteps > 0)
            {
                row += step;
            }
        }
        --spiralWidth;
        step *= -1;
        // Move to the cell where next horizontal segment starts.
        column += step;
    }
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2017-09-01T13:24:54.283

带有相关测试用例的 C# 工作代码。它适用于任何`n x m`矩阵。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MatrixSpiralPrint
{
    class Matrix
    {
        int[,] mat;
        public Matrix(int[,] matrix)
        {
            mat = matrix;
        }
        void printHelper(int x)
        {
            Console.Write(string.Format("{0} ", x));
        }
        // print the top right of the matrix and 
        // recursively call the print bottom left on the submatrix.
        void printTopRight(int colStart, int rowStart, int colEnd, int rowEnd)
        {
            int i = 0, j = 0;

            // print Top row.
            for (i = colStart; i <= colEnd; i++)
            {
                printHelper(mat[rowStart, i]);
            }

            // print Right column.
            for (j = rowStart + 1; j <= rowEnd; j++)
            {
                printHelper(mat[j, colEnd]);
            }

            // Recursion base case: see if more layers need to be printed.
            if (colEnd - colStart > 0 && rowStart!=rowEnd)
            {
                // print the bottom left of the sub matrix.
                printBottomLeft(colStart, rowStart + 1, colEnd - 1, rowEnd);
            }
        }

        // print the bottom left peel of the matrix and 
        // recursively call the print top right on the submatrix.
        void printBottomLeft(int colStart, int rowStart, int colEnd, int rowEnd)
        {
            int i = 0, j = 0;

            // print Bottom row in reverse order.
            for (i = colEnd; i >= colStart; i--)
            {
                printHelper(mat[rowEnd, i]);
            }

            // print Left column in reverse order.
            for (j = rowEnd - 1; j >= rowStart; j--)
            {
                printHelper(mat[j, colStart]);
            }

            // Recursion base case: see if more layers need to be printed.
            if (colEnd - colStart > 0)
            {
                // print the top right of the sub matrix.
                printTopRight(colStart + 1, rowStart, colEnd, rowEnd - 1);
            }
        }

        void printMatrix()
        {
            int rowLength = mat.GetLength(0);
            int colLength = mat.GetLength(1);
            Console.WriteLine("Test Case");
            for (int i = 0; i < rowLength; i++)
            {
                for (int j = 0; j < colLength; j++)
                {
                    Console.Write(string.Format("{0} ", mat[i, j]));
                }
                Console.Write(Environment.NewLine + Environment.NewLine);
            }

        }
        public void printSpiral()
        {
            var maxRowIndex = mat.GetUpperBound(0);
            var maxColIndex = mat.GetUpperBound(1);
            printMatrix();
            Console.WriteLine("Spiral Print");
            printTopRight(0, 0, maxColIndex, maxRowIndex);
            Console.WriteLine("\n---------------------------------");
        }

    } 
    class Program
    {

        static void Main(string[] args)
        {
            var matrix = new int[,] {
                { 1,2,3,4,5},
                { 6,7,8,9,10},
                { 11,12,13,14,15},
                { 16,17,18,19,20},
                { 21,22,23,24,25}
            };
            var mat = new Matrix(matrix);
            mat.printSpiral();

            matrix = new int[,] {
                { 1,2,3,4},
                { 5,6,7,8},
                { 9,10,11,12}
            };
            mat = new Matrix(matrix);
            mat.printSpiral();

            matrix = new int[,] {
                { 1,2,3},
                { 4,5,6},
                { 7,8,9},
                { 10,11,12},
            };
            mat = new Matrix(matrix);
            mat.printSpiral();

            matrix = new int[,] {
                { 1,2 }
            };
            mat = new Matrix(matrix);
            mat.printSpiral();

            matrix = new int[,] {
                { 1},
                { 2}
            };
            mat = new Matrix(matrix);
            mat.printSpiral();
        }
    }
} 
```

请注意，接受的答案不适用于任何`n x m`矩阵。使用@codaddict 在接受的答案中发布的代码将此代码移植到 C#。我已经更正了递归基本情况。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2019-04-04T06:12:57.553

我已经在 Python3 中解决了这个问题。它通过了几乎所有的边缘情况。

```
def spiralOrder(self, matrix):
    r = len(matrix)
    if r == 0:
        return []

    c = len(matrix[0])

    result = []
    x = 0; y = 0
    while x< r and y<c:
        for i in range(y,c):
            result.append(matrix[x][i])
        x+=1
        for i in range(x,r):
            result.append(matrix[i][c-1])
        c-=1
        if x < r:
            for i in range(c-1,y-1,-1):
                result.append(matrix[r-1][i])
            r -=1
        if y <c :
            for i in range(r-1,x-1,-1):
                result.append(matrix[i][y])
            y+=1

    return result 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2019-12-06T00:38:09.760

这是 C++ 中一个不错的递归解决方案，

```
#include <iostream> 
#include <vector> 

using namespace std; 

void helper(const vector<vector<int>>& arr, vector<int>& spiral, int i, int j, int until, int i_, int j_) {
   int& comp = j_ != 0 ? j : i;  

   while(until != comp) {  
       spiral.push_back(arr.at(i).at(j)); 

       i += i_;     
       j += j_; 
   }  
} 

void get_spiral_ordering(vector<int>& spiral, const vector<vector<int>>& arr, int i, int until) {
    if(until == i) { 
       spiral.push_back(arr.at(i).at(i)); 
       return; 
    } else if(until < i) return;     

    helper(arr, spiral, i, i, until, 0, 1);   
    helper(arr, spiral, i, until, until, 1, 0);   
    helper(arr, spiral, until, until, arr.size()-1-until, 0, -1);   
    helper(arr, spiral, until, i, arr.size()-1-until, -1, 0);

    return get_spiral_ordering(spiral, arr, i+1, until-1);
} 
```

要使用此代码，对于任何 nxn 维数组来获取其螺旋顺序，请调用`get_spiral_ordering(result_vec, src, 0, src.size()-1)`

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2015-01-05T13:52:03.363

```
 /// <param name="arr"></param>
    /// <param name="w">CONSTANT width</param>
    /// <param name="h">CONSTANT height of array</param>
    /// <param name="i">index or 1d array. At start is 0</param>
    /// <param name="n">number of printed elements. At start is 0</param>
    /// <param name="l">spiral loop. At start is 0</param>
    /// <param name="d">direction of iteration. At start is 1</param>
    /// <returns></returns>
    private int print(Array arr, int w, int h, int i, int n, int l, byte direction)
    {
        int x = i % w;
        int y = (i - x) / w;
        Console.Write(arr.GetValue(i) + " ");
        n++;
        if (n == arr.Length) return 0;

        switch (direction)
        {
            case 1://→
                if (x < w - l - 1)
                {
                    return print(arr, w, h, i + 1, n, l, 1);
                }
                return print(arr, w, h, i + w, n, l, 2);
            case 2://↓
                if (y < h - l - 1)
                {
                    return print(arr, w, h, i + w, n, l, 2);
                }
                return print(arr, w, h, i - 1, n, l, 3);
            case 3://←
                if (x > l)
                {
                    return print(arr, w, h, i - 1, n, l, 3);
                }
                return print(arr, w, h, i - w, n, l, 4);
            case 4://↑
                if (y > l + 1)
                {
                    return print(arr, w, h, i - w, n, l, 4);
                }
                return print(arr, w, h, i + 1, n, l + 1, 1);
            default:
                return 0;
        }
    } 
```

# javascript - JavaScript 在新窗口中打开，而不是选项卡

> ID：726761
> 
> 赞同：386
> 
> 时间：2009-04-07T17:23:57.507
> 
> 标签：javascript, firefox

我有一个选择框，在选择项目时调用`window.open(url)`。默认情况下，Firefox 将在新选项卡中打开该页面。但是，我希望页面在新窗口中打开，而不是在新选项卡中打开。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：492
> 
> 时间：2009-04-07T17:32:31.213

为调用指定窗口“功能” `open`：

```
window.open(url, windowName, "height=200,width=200"); 
```

当您指定宽度/高度时，它将在新窗口而不是选项卡中打开它。

有关所有可能的功能，请参阅[https://developer.mozilla.org/en-US/docs/Web/API/Window.open#Position_and_size_features](https://developer.mozilla.org/en-US/docs/Web/API/Window.open#Position_and_size_features)。

* * *

## 回答 #2

> 赞同：119
> 
> 时间：2010-02-23T03:28:11.410

您不需要使用高度，只需确保使用`_blank`，没有它，它会在新选项卡中打开。

对于空窗口：

```
window.open('', '_blank', 'toolbar=0,location=0,menubar=0'); 
```

对于特定的 URL：

```
window.open('http://www.google.com', '_blank', 'toolbar=0,location=0,menubar=0'); 
```

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2009-04-07T17:26:25.037

我可能是错的，但据我了解，这是由用户的浏览器偏好控制的，我不相信这可以被覆盖。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-07T17:30:02.607

尝试：

```
window.open("", [window name], "height=XXX,width=XXX,modal=yes,alwaysRaised=yes"); 
```

我有一些代码可以按照您所说的进行，但是其中有很多参数。我认为这些是最低限度的，如果它不起作用，请告诉我，我会发布其余的。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-11-28T11:55:40.687

好的，经过大量测试后，我的结论是：

当你执行：

```
 window.open('www.yourdomain.tld','_blank');
     window.open('www.yourdomain.tld','myWindow'); 
```

或您在目标字段中输入的任何内容，这不会改变任何内容：新页面将在新选项卡中打开（因此取决于用户偏好）

如果要在新的“真实”窗口中打开页面，则必须输入额外的参数。像：

```
window.open('www.yourdomain.tld', 'mywindow','location=1,status=1,scrollbars=1, resizable=1, directories=1, toolbar=1, titlebar=1'); 
```

经过测试，您使用的额外参数似乎并不重要：这不是您放置“这个参数”或“另一个”创建新的“真实窗口”的事实，而是有新参数的事实（s ）。

但是有些东西很困惑，可能会解释很多错误的答案：

这：

```
 win1 = window.open('myurl1', 'ID_WIN');
 win2 = window.open('myurl2', 'ID_WIN', 'location=1,status=1,scrollbars=1'); 
```

还有这个：

```
 win2 = window.open('myurl2', 'ID_WIN', 'location=1,status=1,scrollbars=1');
 win1 = window.open('myurl1', 'ID_WIN'); 
```

不会给出相同的结果。

在第一种情况下，当您第一次打开**没有**额外参数的页面时，它将在新**选项卡**中打开。在这种情况下，由于您提供的名称，第二个呼叫也将在此**选项卡中打开。**

在第二种情况下，由于您的第一次调用是**使用**额外参数进行的，因此页面将在一个新的“**真实窗口**”中打开。在这种情况下，即使第二次调用没有额外的参数，它也会在这个新的“**真实窗口**”中打开......但相同的选项卡！

这意味着第一次调用很重要，因为它决定了页面的放置位置。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-01-26T22:59:25.607

您可以尝试以下功能：

```
<script type="text/javascript">
function open(url)
{
  var popup = window.open(url, "_blank", "width=200, height=200") ;
  popup.location = URL;
}
</script> 
```

执行的 HTML 代码：

```
<a href="#" onclick="open('http://www.google.com')">google search</a> 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-04-07T17:26:04.100

你不应该需要。允许用户拥有他们想要的任何偏好。

默认情况下，Firefox 会这样做，因为在新窗口中打开页面很烦人，如果这不是用户想要的，则永远不应该允许页面这样做。（如果您这样设置，Firefox 确实允许您在新窗口中打开选项卡）。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-01-07T07:03:12.787

关键是参数：

如果您**提供** 参数 [ Height="" , Width="" ] ，那么它将在新窗口中打开。

如果您**不提供**参数，那么它将在新选项卡中打开。

在 Chrome 和 Firefox 中测试

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-06-02T00:41:55.053

有趣的是，我发现如果为 window.open 的第三个属性传入一个**空**字符串（而不是空字符串或属性列表），它将在 Chrome、Firefox 和 IE 的新选项卡中打开。如果不存在，则行为不同。

所以，这是我的新电话：

```
 window.open(url, windowName, ''); 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-12-19T11:47:22.850

试试那个方法.....

```
function popitup(url) {
       //alert(url);
       newwindow=window.open("http://www.zeeshanakhter.com","_blank","toolbar=yes,scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400");
       newwindow.moveTo(350,150);
   if (window.focus) 
          {
             newwindow.focus()
          }
   return false;
  } 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2016-07-14T18:06:30.157

我刚刚用 IE (11) 和 Chrome (54.0.2794.1 canary SyzyASan) 试过这个：

```
window.open(url, "_blank", "x=y") 
```

...它在一个新窗口中打开。

这意味着[克林特·帕赫尔](https://stackoverflow.com/users/41906/clint-pachl)说提供任何一个参数都会导致新窗口打开是正确的。

- 显然它不必是一个合法的参数！

（YMMV - 正如我所说，我只在两个地方进行了测试......下一次升级可能会使结果无效，无论如何）

ETA：不过，我刚刚注意到 - 在 IE 中，窗口没有任何装饰。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-11-13T17:26:37.870

对我来说，解决方案是

```
"location=0" 
```

在第三个参数中。在最新的 FF/Chrome 和旧版本的 IE11 上测试

我使用的完整方法调用如下（因为我喜欢使用可变宽度）：

```
window.open(url, "window" + id, 'toolbar=0,location=0,scrollbars=1,statusbar=1,menubar=0,resizable=1,width=' + width + ',height=800,left=100,top=50'); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-04-09T08:08:24.973

[在这里](https://stackoverflow.com/a/13158856/1504589)回答。但再次发布以供参考。

`window.open()`如果实际点击事件没有发生，则不会在新选项卡中打开。在给出的示例中，URL 是在实际点击事件中打开的。如果用户在浏览器中有适当的设置，这将起作用。

```
<a class="link">Link</a>
<script  type="text/javascript">
     $("a.link").on("click",function(){
         window.open('www.yourdomain.com','_blank');
     });
</script> 
```

同样，如果您尝试在 click 函数中进行 ajax 调用并希望在成功时打开一个窗口，请确保您正在使用`async : false`选项集进行 ajax 调用。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-11-03T05:08:29.687

我认为这不是 html 目标属性问题，但您未选中 Firefox“选项”菜单下“选项卡”选项卡中的“在新选项卡中打开 nw 窗口”选项。检查并重试。

![在此处输入图像描述](https://i.stack.imgur.com/Kxx2D.png)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-11-11T21:02:21.513

我有同样的问题，但找到了一个相对简单的解决方案。

在 JavaScript 中，我正在检查`window.opener !=null;`以确定窗口是否是弹出窗口。如果您正在使用一些类似的检测代码来确定正在呈现您的站点的窗口是否是一个弹出窗口，当您想使用新窗口 JavaScript打开一个*“新”窗口时，您可以轻松地**“关闭它” 。*

 *只需将其放在您希望始终成为*“新”*窗口的页面顶部即可。

```
<script type="text/javascript">
    window.opener=null;
</script> 
```

我在我网站的登录页面上使用它，因此如果用户使用弹出窗口导航到我的网站，他们就不会出现弹出行为。

您甚至可以创建一个简单的重定向页面来执行此操作，然后移动到您提供的 URL。就像是，

**父页面上的 JavaScript：**

```
window.open("MyRedirect.html?URL="+URL, "_blank"); 
```

[然后通过从这里](https://stackoverflow.com/a/5448635/839501)使用一点 javascript，您可以获取 URL 并重定向到它。

**重定向页面上的 JavaScript：**

```
 <script type="text/javascript">
        window.opener=null;

    function getSearchParameters() {
          var prmstr = window.location.search.substr(1);
          return prmstr != null && prmstr != "" ? transformToAssocArray(prmstr) : {};
    }

    function transformToAssocArray( prmstr ) {
        var params = {};
        var prmarr = prmstr.split("&");
        for ( var i = 0; i < prmarr.length; i++) {
            var tmparr = prmarr[i].split("=");
            params[tmparr[0]] = tmparr[1];
        }
        return params;
    }

    var params = getSearchParameters();
    window.location = params.URL;
    </script> 
```

# javascript - 切换样式表（使用 Javascript？）

> ID：726768
> 
> 赞同：2
> 
> 时间：2009-04-07T17:24:39.673
> 
> 标签：javascript, css

假设我有一个站点的 3 种完全不同的布局。
第一个默认显示，但页面顶部有超链接。如果单击其中之一，我希望不再使用当前样式表，而单击的样式表将应用于 HTML 文档。

我认为这是用 Javascript 完成的，但有人可以告诉我具体是怎么做的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T17:27:33.037

这听起来像你在找什么： http: [//net.tutsplus.com/tutorials/javascript-ajax/jquery-style-switcher/](http://net.tutsplus.com/tutorials/javascript-ajax/jquery-style-switcher/)

祝你好运！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T17:45:37.190

[这篇文章](http://www.alistapart.com/articles/alternate/)应该回答你的问题。它依赖于将样式表设置为默认样式表，然后使用替代样式表将其切换出来，使用`"alternate stylesheet"`as`rel`属性而不是简单的`"stylesheet"`，以及一些 Javascript。

# language-agnostic - 如何串行生成随机负整数和正整数文件？

> ID：726773
> 
> 赞同：1
> 
> 时间：2009-04-07T17:26:22.337
> 
> 标签：language-agnostic, bash, random, awk

我想要一个随机生成的正或负序列整数文件。现在，我要求文件包含大致相等数量的负数和正数（无需保证），但以后可以轻松更改比例。“串行”是指第 k 个随机负数等于 -k，第 k 个随机正数等于 +k。

这个 GNU Bash 脚本单行将满足文件格式，但不会是[random](http://xkcd.com/221/)。

```
$ seq -1 -1 -5 && seq 1 5
-1
-2
-3
-4
-5
1
2
3
4
5 
```

这个例子更好地展示了我正在寻找的东西，但仍然不是随机的，因为整数可预测地在负数和正数之间交替。

```
$ paste <(seq -1 -1 -5) <(seq 1 5) | tr '\t' '\n'
-1
1
-2
2
-3
3
-4
4
-5
5 
```

通过 shuf 命令发送其中之一会使它们随机为负或正，但它们会失去序列性。

```
$ paste <(seq -1 -1 -5) <(seq 1 5) | tr '\t' '\n' | shuf
-5
4
3
2
-2
1
-1
-4
5
-3 
```

注意：我正在尝试测试排序列表/位数组（零和一）的算法，但如果我使用 0 和 1，我将无法分析排序的行为或判断是否保持稳定性。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T17:44:47.847

如果我理解正确，您希望随机交错正整数和负整数。例如：`1 2 -1 3 -2 4 5- 3`。

```
my $count = 10;
my $pos   =  1;
my $neg   = -1;

my @random = map { 
    int(rand 2) 
    ? $pos++ 
    : $neg--
} 1..$count; 

print "@random\n"; 
```

* * *

**更新：**

要改变比例，我会这样做：

```
use strict;
use warnings;

my $next = get_list_generator(.5);

my @random = map $next->(), 1..10; 
print "@random\n";

my $again = get_list_generator(.25);

my @another = map $again->(), 1..10; 
print "@another\n";

sub get_list_generator {
    my $prob_positive = shift;

    my $pos = 1;
    my $neg = -1;

    return sub {
        return rand() <= $prob_positive ? scalar $pos++ : scalar $neg--;
    }

} 
```

该`get_list_generator()`函数返回一个闭包。这样，您甚至可以同时运行多个列表生成器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T18:44:42.430

让我们开始高尔夫比赛？(44)

```
perl -le'print rand>.5?++$a:--$b for 1..10' 
```

**编辑**：[daotoad 的](https://stackoverflow.com/users/59135/daotoad)40 字符版本

```
seq 1 10|perl -ple'$_=rand>.5?++$a:--$b' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T19:03:54.427

其中`15`是生成的数字总量，`tp`是您想要的正数数量（有效表示 pos/neg 的比率）：

```
tp=8
unset p n
for i in $(printf '%s\n' {1..15} | gsort -R); do
    (( i <= tp )) && \
        echo $((++p)) || \
        echo $((--n))
done 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T19:21:33.620

```
#!/bin/bash

pos=0 neg=0
for i in {1..10}
do 
    if (( ($RANDOM > 16384 ? ++pos : --neg) > 0 ))
    then echo $pos
    else echo $neg
    fi
done 
```

我不能把它完全融入一个单行中。还有谁？

**编辑**：啊，一个衬里，65个字符（如果你在同一个shell中反复调用它，需要设置a和b）：

```
a=0 b=0;for i in {1..10}; do echo $(($RANDOM>16384?++a:--b));done 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T19:58:17.837

这是受 lhunath 和 Brian 的回答启发的 Bash one-liner (2?)。

```
RANDOM=$$; pos=1; neg=-1; for i in {1..10}; do \
echo $(( $(echo $RANDOM / 32767 \> 0.5 | bc -l) ? pos++ : neg-- )); done 
```

这是一个参加高尔夫比赛的 Awk 脚本 (44)。

```
seq 1 10|awk '{print(rand()>0.5?++p:--n);}' 
```

这是写它的更清晰的惯用方式：

```
seq 1 10 | awk 'BEGIN{srand(); pos=1; neg=-1;}
                {print (rand() > 0.5 ? pos++ : neg--);}' 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-07T17:29:39.240

没有一组数字可以满足您的所有标准。你不能说你想要随机但同时说第 k 个负值 == -k 和第 k 个正值 == k。您可以随机使用，也可以不使用。

至于您要做什么，为什么不将这两个问题分开并在诸如长度为 n 的整数对数组之类的东西上测试排序。这对中的第一个可以是零或 1，第二对将是您的稳定性跟踪器（只是从 0 到 n 的计数）。

生成您想要的 0 和 1 列表并将它们打乱，然后添加到跟踪器整数上。现在按它们的第一个元素对对进行排序。

您排序的输入将如下所示。

```
0, 1
1, 2
0, 3
1, 4
1, 5
0, 6
0, 7
1, 8
1, 9
1, 10
0, 11
0, 12
0, 13 
```

稳定的排序会产生这个

```
0, 1
0, 3
0, 6
0, 7
0, 11
0, 12
0, 13
1, 2
1, 4
1, 5
1, 8
1, 9
1, 10 
```

不稳定的将产生 0 和 1，而跟踪器整数乱序。

# c# - 使用正则表达式在源代码中查找方法

> ID：726777
> 
> 赞同：3
> 
> 时间：2009-04-07T17:26:45.080
> 
> 标签：c#, regex

我有一个程序，它查看源代码，定位方法，并对每个方法内部的代码执行一些计算。我正在尝试使用正则表达式来执行此操作，但这是我第一次在 C# 中使用它们，我在测试结果时遇到了困难。

如果我使用这个正则表达式来查找方法签名：

```
((private)|(public)|(sealed)|(protected)|(virtual)|(internal))+([a-z]|[A-Z]|[0-9]|[\s])*([\()([a-z]|[A-Z]|[0-9]|[\s])*([\)|\{]+) 
```

然后通过这种方法拆分源代码，将结果存储在一个字符串数组中：

```
string[] MethodSignatureCollection = regularExpression.Split(SourceAsString); 
```

这会让我得到我想要的，即包含其中代码的方法列表吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T17:30:13.670

我强烈建议使用[反射](http://msdn.microsoft.com/en-us/library/ms173183(VS.80).aspx)（如果合适的话）或[`CSharpCodeProvider.Parse(...)`](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider.parse.aspx)（由 rstevens 推荐）

编写适用于所有情况的正则表达式可能非常困难。

以下是您必须处理的一些情况：

```
public /* comment */ void Foo(...)      // Comments can be everywhere
string foo = "public void Foo(...){}";  // Don't match signatures in strings 
private __fooClass _Foo()               // Underscores are ugly, but legal
private void @while()                   // Identifier escaping
public override void Foo(...)           // Have to recognize overrides
void Foo();                             // Defaults to private
void IDisposable.Dispose()              // Explicit implementation

public // More comments                 // Signatures can span lines
    void Foo(...)

private void                            // Attributes
   Foo([Description("Foo")] string foo) 

#if(DEBUG)                              // Don't forget the pre-processor
    private
#else
    public
#endif
    int Foo() { } 
```

**笔记：**

*   该`Split`方法将丢弃它匹配的所有内容，因此您实际上将丢失您正在拆分的所有“签名”。
*   不要忘记签名中可以有逗号
*   `{...}`可以嵌套，您当前的正`{`则表达式可能会消耗更多
*   还有很多其他的东西（预处理器命令、`using`语句、属性、注释、`enum`定义、属性）可以出现在代码中，所以仅仅因为某些东西在两个方法签名之间并不能使它成为方法体的一部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T17:59:04.473

也许使用 CSharpCodeProvider.Parse() 可以将 C# 源代码“编译”成 CompileUnit 是一种更好的方法。然后，您可以浏览该编译单元中的名称空间、类型、类和方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-09-15T06:43:06.630

使用`ICSharpCode.NRefactory.CSharp;`

PM> 安装包 ICSharpCode.NRefactory

```
var parser = new CSharpParser();
var syntaxTree = parser.Parse(File.ReadAllText(sourceFilePath));

var result = syntaxTree.Descendants.OfType<MethodDeclaration>()
    .FirstOrDefault(y => y.NameToken.Name == methodName);
if (result != null)
{
    return result.ToString(FormattingOptionsFactory.CreateSharpDevelop()).Trim();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T17:31:11.560

不，这些访问修饰符也可以用于内部类和字段等。您需要编写一个完整的 C# 解析器才能使其正确。

你可以使用反射做你想做的事。尝试以下操作：

```
 var methods = typeof (Foo).GetMethods();
  foreach (var info in methods)
  {
    var body = info.GetMethodBody();
  } 
```

这可能具有您的计算所需的内容。

如果您需要原始的 C# 源代码，则无法通过反射获得它。不要编写自己的解析器。使用现有的，在[此处](https://stackoverflow.com/questions/81406/parser-for-c)列出。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T17:45:42.540

我想，使用正则表达式来获得一些工作是可行的，但这确实需要非常仔细地查看 C# 语言的规范并深入了解 C# 语法，这不是一个简单的问题。我知道您说过您想将方法存储为字符串数组，但大概还有其他内容。已经指出要考虑使用反射，但是如果这不能满足您的要求，则应考虑使用 ANTLR（另一种语言识别工具）。ANTLR 确实有可用的 C# 语法。

[http://www.antlr.org/about.html](http://www.antlr.org/about.html)

# java - Java中的服务器断开连接

> ID：726780
> 
> 赞同：0
> 
> 时间：2009-04-07T17:27:22.083
> 
> 标签：java, client, stream, disconnect

相关帖子没有回答我的问题。

我有一台服务器，它执行以下操作：

```
EVERY TWO SECONDS DO: 
if the inputstream is not null {
     if inputStream.available() is 0 
     {
          return 
     }
     print "handling input stream"
     handleTheInputStream(); 
} 
```

即使在我的客户端断开连接后，服务器也无法通过 IOException 识别它。另一篇文章说我会看到一个 End-of-Stream 角色。但是，情况并非如此，因为在我的客户端断开连接后，我再也看不到“处理输入流”，这表明没有可用的数据。

也许我目前理解它是如何工作的方式有问题。

请帮忙。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:29:54.293

不要使用`available()`- 这表示*当前*是否有可用数据，而不是未来是否有*可用*数据。换句话说，它是用于检测断开连接的错误工具。

基本上你应该调用`read()`（并处理数据）直到它返回-1，此时它意味着客户端已经断开连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T17:41:45.387

如果这是使用套接字完成的，您可能需要检查[Socket](http://java.sun.com/javase/6/docs/api/java/net/Socket.html)类的各种实例方法，例如[isClosed()](http://java.sun.com/javase/6/docs/api/java/net/Socket.html#isClosed())或[isInputShutdown()](http://java.sun.com/javase/6/docs/api/java/net/Socket.html#isInputShutdown())。

当然，这假定在此流上操作的方法可以访问 Socket 对象，而不仅仅是 InputStream。

# sql-server-2005 - Reporting Services - 根据报表参数隐藏表格列

> ID：726783
> 
> 赞同：11
> 
> 时间：2009-04-07T17:28:19.850
> 
> 标签：sql-server-2005, reporting-services, parameters

我在 Reporting Services 2005 中有一个报表，我想根据报表参数隐藏或显示单个表列。有谁知道该怎么做？

谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-03-27T00:21:03.740

使用列的可见性属性。这对我有用。

```
=iif(Parameters!ParameterName.Value = "TextValueOfTheParameter",False,True) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T17:32:38.560

将列的 Visibility 设置为将返回 true 或 false 的表达式。例如，可以在 TextBox 的 Visibility 选项卡中找到此属性。

单击表达式的单选选项，然后您的表达式可能看起来像

```
=Parameters!ShowColumn.Value 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-10-21T21:27:04.080

提示：如果表达式返回“False”，则列或行将可见。如果表达式返回“True”，则表达式将被隐藏。这起初欺骗了我。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-22T09:42:33.157

对于我的一些报告，我已将列的可见性（特别是**隐藏****属性**）设置为：

 **```
=IsNothing(Fields!Site.Value) 
```

请注意，这仅适用于基础数据集中相关字段可以为空的情况，否则您将看到空白列。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-04-17T19:06:58.290

假设我的报告（SSRS 2005）有 5 列。我想根据用户选择的参数（所有 5 个列名的多选）显示/隐藏列。执行以下操作

1）创建一个字符串类型的参数（ColumnVisibility是我的参数的名称），在“可用值”部分的值中分别在5列的标签和**INT**编号（01,02,03,04,05）中使用所需的列名参数向导。

2）然后转到设计上的列属性。转到“可见性”并粘贴以下内容

```
=iif(instr(Join(Parameters!ColumnVisibility.Value,","),"01")>0,false,true) 
```

3) 对所有列重复相同的操作，将 int 值增加 1 ..参见以下示例

第二栏

```
=iif(instr(Join(Parameters!ColumnVisibility.Value,","),"**02**")>0,false,true) 
```

第三栏

```
=iif(instr(Join(Parameters!ColumnVisibility.Value,","),"**03**")>0,false,true) 
```

等等。对于 SSRS 2008，当您右键单击该列时，您可以看到“列可见性”选项。将代码粘贴到每列的“根据表达式显示或隐藏”部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-01-25T16:31:32.883

如果要隐藏整列，当报表中该特定列根本没有数据时，您可以在列可见性/表达式中使用以下代码：

```
=IIF(IsNothing (Sum(Fields!columnA.Value, "ReportA")),False,True) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-10-23T09:10:41.393

当我按照上述方式进行操作时，我可以使该列消失，但它会在我的表格中留下一个空白。这是预期的结果吗。我希望这些列也会转移。我正在尝试为一组添加一列，然后为下一组显示它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-07-19T15:02:43.003

要使空列消失，

右键单击列以选择列可见性，然后为隐藏设置表达式：

```
IIF(IsNothing(Fields!FieldName.Value),True,False) 
```

# objective-c - 如何在 Cocoa 程序中将视图滑入和滑出窗口

> ID：726795
> 
> 赞同：12
> 
> 时间：2009-04-07T17:30:51.000
> 
> 标签：objective-c, cocoa, animation

我想在窗口上有一个视图并响应消息（按钮单击或菜单），我想让另一个视图向下滑动，并调整第一个视图的大小。

我想从这个出发：

```
**********************************
*                                *
*--------------------------------*
*|                              |*
*|        view 1                |*
*|                              |*
*--------------------------------*
*                                *
********************************** 
```

对此：

```
**********************************
*                                *
*--------------------------------*
*|        view 2                |*
*--------------------------------*
*--------------------------------*
*|        view 1                |*
*--------------------------------*
*                                *
********************************** 
```

我不一定要寻找代码，将不胜感激从哪里开始的想法。

这是一个桌面应用程序。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-07T18:55:56.897

CoreAnimation 绝对是您最好的选择。自从我使用任何 CA 代码以来已经有一段时间了，但类似：

```
[UIView beginAnimations:@"slideOn" context:nil];

firstView.frame = shrunkFirstViewRect; // The rect defining the first view's smaller frame. This should resize the first view

secondView.frame = secondViewOnScreenFrame; // This should move the second view on the frame. 

[UIView commitAnimations]; 
```

稍后，您可以使用以下命令返回单个视图：

```
[UIView beginAnimations:@"slideOff" context:nil];

firstView.frame = normalFirstViewRect; // The rect defining the first view's normal frame. This should expand the first view.

secondView.frame = secondViewOffScreenFrame; // Move the second view off the screen

[UIView commitAnimations]; 
```

**编辑：上面的代码适用于 iPhone，我读了你的问题有点快。**

在 Mac 上，您可能希望使用（类似地）：

```
[NSAnimationContext beginGrouping];
[[NSAnimationContext currentContext] setDuration:1.0f]; // However long you want the slide to take

[[firstView animator] setFrame:shrunkFirstViewRect];

[[secondView animator] setFrame:secondViewOnScreenFrame];

[NSAnimationContext endGrouping]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-10T02:10:24.463

需要注意的是，如果不设置动画块的持续时间，默认为 0.25 秒左右，实际上在大多数情况下似乎效果很好。

我建议在尝试 CoreAnimation 时先尝试该持续时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T17:38:47.157

我从未尝试过，但我认为 CoreAnimation 对此有一些有趣的功能。您必须将 view1 的高度从全高设置为半高，并将 view2 的位置从其父视图外部设置到其上半部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-03T18:18:17.657

或者，您可以尝试使用[NSSplitView](https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/ApplicationKit/Classes/NSSplitView_Class/Reference/Reference.html) ...

# unit-testing - 对 LINQ2SQL 存储库进行单元测试

> ID：726800
> 
> 赞同：14
> 
> 时间：2009-04-07T17:31:45.693
> 
> 标签：unit-testing, tdd, mocking, moq, mstest

我正在使用 MsTest 和 Moq 迈出第一步，并希望对 Linq2SQL 存储库类进行单元测试。问题是我不希望单元测试永久修改我的开发数据库。

对于这种情况，哪种方法最好？

*   让每个测试都在我的真实开发数据库上运行，但要确保每个测试都自行清理
*   为单元测试创​​建我的开发数据库和 dbml 的副本，并改用该上下文，这样我就可以在每次测试运行之前清除整个数据库
*   找到一些模拟 Datacontext 的复杂方法（请记住，我是一个完整的 Moq 菜鸟）。
*   完全不同的东西？也许可以在每次测试运行之前自动为我设置数据库？

**编辑：**我刚刚了解到 MBUnit 有一个回滚属性，可以反转测试用例运行的任何数据库操作。我不是特别喜欢 MSTest，所以这可以简单地解决我的问题吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-07T17:37:44.960

我使用一些包装类 + 基于[http://andrewtokeley.net/archive/2008/07/06/mocking-linq-to-sql-datacontext.aspx](http://andrewtokeley.net/archive/2008/07/06/mocking-linq-to-sql-datacontext.aspx)的假实现来模拟/伪造数据库。请注意，我最终在我的假数据上下文包装器中实现了 SubmitChanges 逻辑，以测试我实体的部分类实现中的验证逻辑。我认为这确实是与 Tokeley 的实现有很大不同的唯一棘手部分。

我将在下面包含我的 FakeDataContextWrapper 实现：

```
public class FakeDataContextWrapper : IDataContextWrapper
{

    public DataContext Context
    {
        get { return null; }
    }

    private List<object> Added = new List<object>();
    private List<object> Deleted = new List<object>();

    private readonly IFakeDatabase mockDatabase;

    public FakeDataContextWrapper( IFakeDatabase database )
    {
        mockDatabase = database;
    }

    protected List<T> InternalTable<T>() where T : class
    {
        return (List<T>)mockDatabase.Tables[typeof( T )];
    }

    #region IDataContextWrapper Members

    public virtual IQueryable<T> Table<T>() where T : class
    {
        return mockDatabase.GetTable<T>();
    }

    public virtual ITable Table( Type type )
    {
        return new FakeTable( mockDatabase.Tables[type], type );
    }

    public virtual void DeleteAllOnSubmit<T>( IEnumerable<T> entities ) where T : class
    {
        foreach (var entity in entities)
        {
            DeleteOnSubmit( entity );
        }
    }

    public virtual void DeleteOnSubmit<T>( T entity ) where T : class
    {
        this.Deleted.Add( entity );
    }

    public virtual void InsertAllOnSubmit<T>( IEnumerable<T> entities ) where T : class
    {
        foreach (var entity in entities)
        {
            InsertOnSubmit( entity );
        }
    }

    public virtual void InsertOnSubmit<T>( T entity ) where T : class
    {
        this.Added.Add( entity );
    }

    public virtual void SubmitChanges()
    {
        this.SubmitChanges( ConflictMode.FailOnFirstConflict );
    }

    public virtual void SubmitChanges( ConflictMode failureMode )
    {
        try
        {
            foreach (object obj in this.Added)
            {
                MethodInfo validator = obj.GetType().GetMethod( "OnValidate", BindingFlags.Instance | BindingFlags.NonPublic );
                if (validator != null)
                {

                    validator.Invoke( obj, new object[] { ChangeAction.Insert } );
                }
                this.mockDatabase.Tables[obj.GetType()].Add( obj );
            }

            this.Added.Clear();

            foreach (object obj in this.Deleted)
            {
                MethodInfo validator = obj.GetType().GetMethod( "OnValidate", BindingFlags.Instance | BindingFlags.NonPublic );
                if (validator != null)
                {
                    validator.Invoke( obj, new object[] { ChangeAction.Delete } );
                }
                this.mockDatabase.Tables[obj.GetType()].Remove( obj );
            }

            this.Deleted.Clear();

            foreach (KeyValuePair<Type, IList> tablePair in this.mockDatabase.Tables)
            {
                MethodInfo validator = tablePair.Key.GetMethod( "OnValidate", BindingFlags.Instance | BindingFlags.NonPublic );
                if (validator != null)
                {
                    foreach (object obj in tablePair.Value)
                    {
                        validator.Invoke( obj, new object[] { ChangeAction.Update } );
                    }
                }
            }
        }
        catch (TargetInvocationException e)
        {
            throw e.InnerException;
        }
    }

    public void Dispose() { }

    #endregion
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T12:46:19.087

我也有类似的需求——对 Linq to Sql 类进行单元测试，所以我制作了一小部分类来将模拟数据上下文、ITables 和 IQueryables 放入查询中。

I put the code in a blog post "[Mock and Stub for Linq to Sql](http://nonodes.spunow.co.uk/2009/04/mock-and-stub-for-linq-to-sql.html)". It uses Moq, and might provide enough functionality for the tests you're after without hitting the database.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:39:53.097

我玩了一点 MBUnit 并了解到，对于大多数测试用例，您可以通过使用 MBUnit 的 [ROLLBACK] 属性而无需模拟数据上下文。

不幸的是，在某些情况下，属性会产生奇怪的副作用，例如从数据库加载 linq 实体，更改一个属性（没有提交更改），然后再次加载相同的实体。通常这会导致数据库上没有更新查询，但是在测试方法中，一旦我更改了 linq 实体属性，就会立即执行更新。

不是一个完美的解决方案，但我认为我会使用 [ROLLBACK] 属性，因为它的工作量更少并且对我来说效果很好。

# ms-access - 在 MS Access 中按月份排序

> ID：726807
> 
> 赞同：1
> 
> 时间：2009-04-07T17:33:29.713
> 
> 标签：ms-access, sorting

我正在使用 MS Access 数据库来跟踪一年中的一些任务。每个任务都有一个到期*月份*。我不想使用确切的日期，因为我团队的惯例是指月份。我不想以日期格式存储日期，因为团队成员将手动输入到期月份。

如果日期存储为文本字符串月份，是否可以按日期顺序对我的字段进行排序？（例如，1 月、2 月而不是 2009 年 1 月 31 日、2009 年 2 月 28 日）。

如果是这样，这样的查询会是什么样子？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T19:20:01.970

如果您只存储月份名称，您首先需要转换为日期以获取月份编号，使用查找表（MonthNo，MonthName）或使用 Switch 功能。以下是转换为日期的示例：

```
SELECT Month(CDate(Year(Date()) & "/" & [MonthNameField] & "/1")) AS MonthNo
FROM Table 
```

但是，根据输入的月份名称存储日期可能是一个很好的论据，这样可以防止混淆年份。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T03:34:51.203

我会做一个日期字段。

我会将 1/1/2009 存储为 2009 年 1 月，将 2/1/2009 存储为 2009 年 2 月，依此类推。出于显示目的，我将对其进行格式化，使其仅显示月份（或月份 + 年份——无法想象你不想要年份）。

这使得可以利用字段上的日期操作，而无需将文本转换为日期格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:36:41.530

这应该工作

SELECT * FROM TableName OrderBy Month(date_field)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T19:17:58.793

我会将月份存储为整数 1-12，然​​后您可以轻松地对它们进行排序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T12:47:22.597

谢谢大家的回复。很抱歉延迟回复 - 我现在正在再次处理这个问题。

为清楚起见，数据库将用于跟踪 12 个月内的事件时间表。不需要存储年份，因为数据库中的所有内容都指的是同一年。数据库的新副本将在 2010 年初制作。

我真的很想将月份实际存储为一个单词，而不是任何类型的值或日期字段，因为当批量添加任务时，我可能会直接编辑表格而不是使用表单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-06-26T11:14:23.703

我意识到这已经死了，但谷歌把我带到了这里，而我正在寻找，所以我想我会添加它：

我自己也遇到了这个问题（Access 2010），在这里找到了一个不错的答案：[http://www.vbforums.com/showthread.php?503841-How-to-Convert-MonthName-to-Value(Microsoft-access-2003)](http://www.vbforums.com/showthread.php?503841-How-to-Convert-MonthName-to-Value%28Microsoft-access-2003%29)

所以我所做的是有一个查询，它从我的表中提取了 DISTINCT 月份。然后在设计视图中，我添加了另一列`MonthNo: Month(CDate("1 " & [Month]))`并对该列的查询进行了排序

如果不是 OP，希望这对某人有所帮助。

# java - 在 Swing 中重置/删除边框

> ID：726808
> 
> 赞同：2
> 
> 时间：2009-04-07T17:33:32.023
> 
> 标签：java, user-interface, validation, swing

这是一个非常具体的编码问题：

我最近被要求在工作中维护一些旧的 Java Swing GUI 代码并遇到了这个问题：

我已将我自己的 InputVerifier 子类（称为 MyFilenameVerifier）附加到 JTextField（但它也可以是用于这些目的的任何 JComponent）。我重写了 verify() 方法，以便它调用**`super.verify(input)`**（其中输入是 verify() 的 JComponent 参数）。如果**`super.verify(input)`**返回错误，我会：

```
input.setBorder(BorderFactory.createLineBorder(Color.RED)); 
```

这是该应用程序的整个 UI 中使用的约定，早在我之前就开始了，所以就使用其他方式来吸引用户的注意力（希望我这样做）而言，我没有太多选择。这就是它的工作方式。

问题是，一旦用户返回并在文本字段中输入有效的内容，我需要一种方法将其设置回默认边框（而不是仅仅说将其设置为 Color.GRAY 或其他颜色，这是与原始颜色不同的颜色边界）。我需要一种方式来表达“移除额外的装饰并恢复正常”，或者只是将边框设置为默认值，换句话说。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T17:38:43.040

[`input.getBorder()`](http://java.sun.com/javase/6/docs/api/javax/swing/JComponent.html#getBorder())在将边框设置为红色之前，您不能在某处调用并缓存它吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T18:17:13.277

或者在不缓存任何内容的情况下，您可以通过 component.updateUI 告诉 JComponent 将其 UI 更新回外观的默认值。这应该使组件重置其颜色、边框、字体等以匹配原始设置。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T17:39:14.117

`input.getBorder()`

如果没有人看到这个并且我没有因为提出这个问题而受到应得的殴打而自由自在，那不是很棒吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T17:38:48.937

不确定您的系统是如何构建的，但我认为您可以在更改之前存储原始边框。所以你可以稍后再改回来

```
// assuming the Border was not null before
if (!super.verify(input)) {
    original = input.getBorder();
    input.setBorder(...);
} else {
    if (original != null) {
        input.setBorder(original);
        original = null;  // not needed
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T17:42:31.017

更改时需要保留现有边框。

一种方法是使用 putClientProperty() 和 getClientProperty() 方法，您可以在 API 中找到这些方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T17:50:19.923

另一种可能性是，如果您只需要几个输入小部件，则将其作为子类，例如 JTextField，添加 setBorderOverride() 并修改 getBorder() 以返回“overriddingBorder”（如果它不为空）。

然后您只需使用 setBorderOverride(redBorder) 将其变为红色并使用 setBorderOverride(null) 将其清除。

这当然取决于绘画是否使用 getBorder()，它可能会或可能不会这样做，并且*可能*是特定于实现的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T17:44:17.957

顺便说一句，您只需要一个对边框的静态引用——它是所有 JTextField 使用的同一个边框实例。

# java - 如何从在 web start 下运行的客户端获取 Java 堆栈跟踪？

> ID：726812
> 
> 赞同：1
> 
> 时间：2009-04-07T17:34:24.267
> 
> 标签：java, stack-trace, java-web-start

我想从 SO 社区获得关于这个问题的想法。

这是问题所在：

我们在世界的另一端有一个用户通过 WebStart 启动我们的应用程序。然而，用户抱怨她的整个应用程序冻结并变得无响应。通常，客户端对分布式数据库执行大量数据库查询。

问题：

1.  如果我们要求她对她的应用程序执行**CTRL-Break**，JVM 会将堆栈跟踪写入哪里？
2.  **仅使用JConsole**就足够了吗？
3.  在客户端实现**JMX bean**会不会过大？它真的有助于解决生产中的问题吗？

目前，用户在 JRE 1.5.0-b08 上运行，但我们确实计划在几个月内迁移到 JRE 6。

你怎么看？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T18:48:13.233

José，您可以通过多种方式从 JVM 获取大量信息。

最好的办法可能是在远程 JVM 中启用调试。您可以使用描述符 XML 中的元素来设置它们，如此[处](http://java.sun.com/j2se/1.5.0/docs/guide/javaws/developersguide/syntax.html#resources)`j2se`所示。既然你可以设置你有一个好的开始；我从未尝试在 Web 启动应用程序上进行远程调试，因此设置远程部分可能有点问题。`-Xdebug`

您还可以自己设置一些东西，方法是添加一个单独的线程来远程与您交谈并发送调试消息。

您可以使用[本机 java](http://java.sun.com/j2se/1.4.2/docs/guide/util/logging/overview.html#1.18)或[log4j 远程记录器](http://logging.apache.org/log4j/1.2/apidocs/index.html)。

但是，如果它按照您描述的方式挂起，那么发生某种网络挂断的可能性非常高。*您*可以在对话结束时进行一些跟踪/调试吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T22:02:45.837

除了这些调试建议，你为什么不为你的线程安装一个异常处理程序呢？请参阅 java.lang.Thread。

```
void setDefaultUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh) 
```

这是相关的javadoc：http: [//java.sun.com/javase/6/docs/api/java/lang/Thread.html#setDefaultUncaughtExceptionHandler(java.lang.Thread.UncaughtExceptionHandler)](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html#setDefaultUncaughtExceptionHandler(java.lang.Thread.UncaughtExceptionHandler))

如果你将它安装在你的代码中，并且一旦在 Swing 的 EDT 中，那么只需编写一些 java 代码通过电子邮件发送给你自己，将它保存在服务器上，将它展示给用户，等等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T17:37:00.440

您需要显示 Java 控制台（从命令行运行 javaws，然后从“首选项”对话框中选择它），然后点击“v”

# javascript - 如何使用 jquery 访问 iFrame 父页面？

> ID：726816
> 
> 赞同：277
> 
> 时间：2009-04-07T17:35:18.727
> 
> 标签：javascript, jquery, iframe

我有一个 iframe，为了访问父元素，我实现了以下代码：

```
window.parent.document.getElementById('parentPrice').innerHTML 
```

如何使用 jquery 获得相同的结果？
**更新**：或者如何使用 jquery 访问 iFrame 父页面？

* * *

## 回答 #1

> 赞同：515
> 
> 时间：2009-04-07T17:47:26.403

要在 iFrame 的父级中查找，请使用：

```
$('#parentPrice', window.parent.document).html(); 
```

$() 包装器的第二个参数是搜索的上下文。这默认为文档。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-04-07T18:09:41.657

> 如何使用 jquery 访问 iFrame 父页面

window.parent.document。

jQuery 是 JavaScript 之上的一个库，而不是它的完全替代品。您不必将每个最后的 JavaScript 表达式都替换为涉及 $ 的内容。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-04-13T19:31:44.757

如果您需要在父文档中查找 jQuery 实例（例如，调用插件提供的实用函数），请使用以下语法之一：

*   `window.parent.$`
*   `window.parent.jQuery`

例子：

```
window.parent.$.modal.close(); 
```

jQuery 被附加到`window`对象上，`window.parent`就是这样。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2016-02-21T12:24:35.727

您可以使用以下方法从 iframe 中访问父窗口的元素[`window.parent`](https://developer.mozilla.org/en-US/docs/Web/API/window/parent)：

```
// using jquery    
window.parent.$("#element_id"); 
```

这与以下内容相同：

```
// pure javascript
window.parent.document.getElementById("element_id"); 
```

如果你有多个嵌套的 iframe 并且你想访问最顶层的 iframe，那么你可以[`window.top`](https://developer.mozilla.org/en-US/docs/Web/API/Window/top)这样使用：

```
// using jquery
window.top.$("#element_id"); 
```

这与以下内容相同：

```
// pure javascript
window.top.document.getElementById("element_id"); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-04-04T07:58:42.690

在父窗口中放置：

```
<script>
function ifDoneChildFrame(val)
{
   $('#parentPrice').html(val);
}
</script> 
```

并在 iframe src 文件中放置：

```
<script>window.parent.ifDoneChildFrame('Your value here');</script> 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-01-17T04:49:38.070

是的，它也适用于我。

注意：我们需要使用 window.parent.document

```
 $("button", window.parent.document).click(function()
    {
        alert("Functionality defined by def");
    }); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-02-23T04:51:23.920

它对我有用，而且有点扭曲。在我的情况下，我必须将值从 POPUP JS 填充到 PARENT WINDOW 表单。

所以我用过`$('#ee_id',window.opener.document).val(eeID);`

优秀的！！！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-09-12T23:10:42.687

在这里玩游戏可能有点晚了，但我刚刚发现了这个很棒的 jQuery 插件[https://github.com/mkdynamic/jquery-popupwindow](https://github.com/mkdynamic/jquery-popupwindow)。它基本上使用了一个 onUnload 回调事件，所以它基本上监听子窗口的关闭，并在那时执行任何必要的事情。所以真的不需要在子窗口中写任何 JS 传回给父窗口。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-03-28T13:30:42.763

有多种方法可以做到这些。

I）直接获取主要父母。

例如。我想将我的子页面替换为 iframe 然后

```
var link = '<%=Page.ResolveUrl("~/Home/SubscribeReport")%>';
top.location.replace(link); 
```

这里**top.location**直接获取父级。

II）一一获取父母，

```
var element = $('.iframe:visible', window.parent.document); 
```

如果您有多个 iframe，请在此处指定活动或可见的 iframe。

你也可以这样做以获得更多的父母，

```
var masterParent = element.parent().parent().parent() 
```

III）通过标识符获取父级。

```
var myWindow = window.top.$("#Identifier") 
```

# css - 你如何调试可打印的 CSS？

> ID：726825
> 
> 赞同：76
> 
> 时间：2009-04-07T17:37:45.977
> 
> 标签：css

我一直使用 Firebug 和 IE Developer Toolbar 来调试棘手的 CSS 问题。但偶尔会出现一个棘手的错误，该错误仅在您打印页面时才会出现。

您使用什么技术/工具来诊断此类问题？有没有办法在打印视图中充分利用传统的 CSS 调试工具？

更新：我已经使用 PDF 打印机来避免浪费纸张；我的问题是我无法右键单击打印的 DOM。下面的一些其他答案非常有帮助，谢谢。:-)

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2014-05-27T10:15:59.963

刚刚发现[lee-penkman在](https://stackoverflow.com/users/1323161/lee-penkman)[这里](http://tjvantoll.com/2012/12/12/debugging-print-stylesheets-now-significantly-easier-in-chrome/#comment-1394994872)评论了 Firefox 中的一项新功能：在 Firefox 中按下`Shift-F2`以打开浏览器控制台（不是 javascript 控制台），然后输入`media emulate print`. 工作绝对很棒！

* * *

**2018 年 9 月更新**：从 Firefox 62 开始，开发者控制台已经消失。现在似乎没有办法激活打印样式仿真。

* * *

**2019 年 11 月更新**：似乎在 Firefox 69 中，又有一个用于打印样式模拟的新按钮。请参阅此页面上的其他答案：[https ://stackoverflow.com/a/58015662/195476](https://stackoverflow.com/a/58015662/195476)

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2016-03-28T17:57:25.400

在 Chrome 51 中：

[![Chrome 开发者工具](https://i.stack.imgur.com/mV2ra.png)](https://i.stack.imgur.com/mV2ra.png)

打开 devtools (`CTRL + F12`或`CTRL + SHIFT + I`) 并单击`...`菜单，单击`More Tools > Rendering settings`以打开`Rendering`开发人员控制台的选项卡（或者，如果控制台已打开，只需导航到此选项卡）。

在该选项卡中，选择并选中`Emulate Media: print`.

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-04-07T17:42:56.993

我使用 WebDeveloper 插件和 CSS --> 按媒体类型显示 CSS --> 打印来查看打印时的 CSS。Firebug 的检查实用程序使用插件过滤的 CSS。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2019-09-19T16:50:22.253

在 Firefox 69 中，我找到了一个模拟打印媒体的按钮。只需打开 Developer Tools (F12) 并单击 Inspector。切换按钮是下面屏幕截图中突出显示部分中最左侧的图标，看起来像一张纸。

[![在此处输入图像描述](https://i.stack.imgur.com/3VdLo.png)](https://i.stack.imgur.com/3VdLo.png)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-07T17:45:15.380

我使用 Firefox 和[开发者工具栏](https://addons.mozilla.org/en-US/firefox/addon/60)。

我使用任务栏中的实时 css 编辑工具，实时修改 css 非常有用，可以实时查看结果。

我还在您的网站上使用大纲功能，即 div 和鼠标悬停之类的东西。找到 div 真的很有帮助。

对于打印问题，请转到 CSS -> 按媒体显示 CSS 样式 -> 打印

在这个工具中还有很多其他可用的工具，我可能会使用其中的 10% 左右。

试试也许你会发现一些有用的东西。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-04-20T14:41:47.580

在 chrome 开发人员工具中（F12 \ Ctrl（mac 上的 cmd）+ Shift + C）：在仿真选项卡中（从 Chrome 32 开始，恕我直言），有一个“媒体”选项卡。

在那里您可以选中媒体仿真复选框并选择您想要仿真的媒体（“打印”、“屏幕”等）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-03-30T23:47:46.720

最后列出您的打印 CSS，然后从您的 CSS 链接或导入语句中删除“打印”条件怎么样？然后在浏览器窗口中调试打印 CSS。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-07T17:40:36.937

我使用 Adob​​e PDF 虚拟打印机，因为它是最接近您所获得的真实打印机的东西，而且不会浪费墨水和纸张。

无论如何，建议使用单独的 CSS 进行打印，使用更简单的图形和更少的仅用于设计目的的图像。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-08-01T16:46:19.337

我一直使用 Web 开发人员工具栏（如其他答案中所述），但 Firebug 似乎不时会错过一些样式。所以我在浏览器中添加了一个书签，并添加了以下 Javascript 作为书签的 URL。现在我可以通过单击书签简单地切换到打印样式：

```
javascript:(function(){var%20h,a,f;a=document.getElementsByTagName('link');for(h=0;h<a.length;h++){f=a[h];if(f.rel.toLowerCase().match(/stylesheet/)&&f.href&&(f.media=='print'||f.media=='screen')){var%20g=f.href.replace(/(&|%5C?)forceReload=\d+/,'');if(f.media.toLowerCase().match(/screen/))f.media="dontshow";if(f.media.toLowerCase().match(/print/))f.media="all";f.href=g+(g.match(/\?/)?'&':'?')+'forceReload='+(new%20Date().valueOf());}}})() 
```

上面的代码查找所有样式表链接，测试它是否为 media=print，如果是，则将其更改为 media=all（并通过将其替换为 media=dontshow 来隐藏所有 media=screen）并通过添加时间标记重新加载样式表网址。基本的重新加载脚本来自其他人，我添加了媒体部分。这对我很有用！

这将是上面用于解释的 JavaScript URL 的更易读版本：

```
javascript: (function() {
    var h, a, f;
    a = document.getElementsByTagName('link');
    for (h = 0; h < a.length; h++) {
        f = a[h];
        if (f.rel.toLowerCase().match(/stylesheet/) && f.href && (f.media == 'print' || f.media == 'screen')) {
            var g = f.href.replace(/(&|\?)forceReload=\d /, '');
            if (f.media.toLowerCase().match(/screen/)) f.media = "dontshow";
            if (f.media.toLowerCase().match(/print/)) f.media = "all";
            f.href = g(g.match(/\?/) ? '&' : '?')
            'forceReload=' (new Date().valueOf());
        }
    }
})() 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-07T17:44:58.127

如果您不想付钱，请打印到 Microsoft XPS Document Writer。如果您有资金，或者使用[SnagIt （现场免费试用）。](http://www.techsmith.com/)

# silverlight - 如何绑定 UserControl 属性？

> ID：726827
> 
> 赞同：3
> 
> 时间：2009-04-07T17:38:32.947
> 
> 标签：silverlight, user-controls

假设我有一个没有代码隐藏的简单 UserControl：

```
<UserControl
xmlns= ....
x:Class="TrafficLight.LightControl">
<Grid x:Name="LayoutRoot">
<Grid x:Name="Light" >
  <Ellipse  x:Name="MyColor" Fill="{**I need bind this field to UserControl.Foreground**}" Stroke="#FF000000" />
  <Ellipse  x:Name="Shade" Fill="#E4555555" />
</Grid>
</Grid> 
```

并在页面上使用此 UserControl：

```
<TrafficLight:LightControl x:Name="red" Foreground="#FFFEF100" **<= I need to bind MyColor.Fill with this property**/> 
```

我怎样才能实现这个场景？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T17:58:12.197

好的，我研究了各种方法，并且没有 ElementName 绑定（Silverlight 3 引入的东西），Microsoft 没有为 Silverlight 包含这些方法，这是一个艰难的方法。如果没有背后的一些代码，这不是一件容易的事。

[这篇博客文章](http://www.scottlogic.co.uk/blog/wpf/2009/02/relativesource-binding-in-silverlight/)详细介绍了如何实现这一点，但请注意，您需要编写一些代码。

# sql-server - SQL 复制 - 发布已删除，但日志文件仍在增长

> ID：726830
> 
> 赞同：0
> 
> 时间：2009-04-07T17:38:46.613
> 
> 标签：sql-server, sql-server-2000, replication, truncate-log

**作为序言，我以前见过回答这个问题的命令，但现在我找不到了，所以我只是在寻找可以解决我问题的单个 SQL 语句。**

我曾经在 SQL Server 2000 数据库上发表过两篇文章，但后来我删除了它们。但是，我的日志文件正在增长，并且似乎包含未复制的事务，并且不断增长。我试过这个：

```
EXEC sp_repldone @xactid = NULL, @xact_segno = NULL, @numtrans = 0, @time = 0, @reset = 1 
```

我收到一条消息“数据库未发布”（并且由于我已删除该出版物，这是有道理的）。如果我尝试：

```
backup log dbname with truncate_only 
```

我收到消息说我的日志中有未复制的事务，它不会被截断。

**我以前见过这种情况，不存在任何出版物，但数据库被标记为仍在参与复制，我找到了一个单行脚本来取消将数据库标记为复制源，这立即解决了我的问题。不过，我现在找不到它，当我再次需要它的时候——希望你们中的某个人能有所启发。谢谢！**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T20:37:19.837

我无法通过任何支持的方法清除这些尚未复制的数据，因此我不得不强制重建日志文件。它是 SQL 2000，因此有一个不受支持/未记录的 SP 可以执行此操作：

```
DBCC REBUILD_LOG('DBName','D:\Log folder\Logfile name.ldf') 
```

这将为数据库创建一个新的空日志文件并放弃旧的。请注意，这将强制截断当前事务，因此请确保您有备份。数据库需要处于“紧急恢复”模式才能使用此命令，因为它不会回滚任何已部分应用于数据的进程中事务，这可能会破坏数据完整性。

有关我使用的过程的完整详细信息，请参阅此线程的帖子 7：[http ://www.sqlteam.com/forums/topic.asp?TOPIC_ID=76785](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=76785)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-15T09:11:34.347

```
use master
go
exec sp_replicationdboption @dbname='SERVICEDESK', @optname = 'publish', @value= 'true', @ignore_distributor = 1
go
use servicedesk
go
EXEC sp_repldone @xactid = NULL, @xact_segno = NULL, @numtrans = 0,  @time = 0, @reset = 1
go
use master
go
exec sp_replicationdboption @dbname='SERVICEDESK', @optname = 'publish', @value= 'false', @ignore_distributor = 1
go
dump tran servicedesk with no_log
go 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T19:38:01.677

您是否在寻找：

```
EXEC sp_replicationdboption 
    @dbname = @publicationDB, 
    @optname = N'merge publish', 
    @value = N'false' 
```

?

另请参见[sp_dropmergepublication](http://msdn.microsoft.com/en-us/library/ms187808.aspx) / [sp_droppublication](http://msdn.microsoft.com/en-us/library/ms188363.aspx)。

# .net - .NET 中的用户组和角色管理与 Active Directory

> ID：726837
> 
> 赞同：62
> 
> 时间：2009-04-07T17:40:35.173
> 
> 标签：.net, asp.net, security, active-directory

我目前正在研究为基于 .NET 的项目存储用户角色和权限的方法。其中一些项目是基于网络的，有些则不是。我目前正在努力寻找最佳方法，以跨项目类型以一致、可移植的方式实现我正在寻找的东西。

在我所在的位置，我们希望利用 Active Directory 作为我们获取基本用户信息的单一联系点。因此，我们希望不必为每个应用程序的用户维护自定义数据库，因为它们已经存储在 Active Directory 中并在那里积极维护。此外，如果可能，我们不想编写自己的安全模型/代码，而是希望使用预先存在的东西，例如 Microsoft 提供的安全应用程序块。

有些项目只需要基本权限，例如读、写或无访问权限。其他项目需要更复杂的权限。这些应用程序的用户可能被授予访问某些区域的权限，但不能访问其他区域，并且他们的权限可以在每个区域中更改。应用程序的管理部分将控制和定义此访问权限，**而不是**AD 工具。

目前，我们正在使用集成的 Windows 身份验证在我们的 Intranet 上执行身份验证。这对于查找基本用户信息非常有效，而且我已经看到可以扩展 ASP.NET 以提供 Active Directory 角色提供程序，因此我可以找出用户所属的任何安全组。但是，在我看来，这种方法的缺点是所有内容都存储在 Active Directory 中，如果事情变得太大，可能会导致维护混乱。

同样，我还听说过 Active Directory 轻量级目录服务，它似乎可以扩展我们的架构并仅添加应用程序特定的属性和组。问题是，我找不到任何关于如何完成或如何工作的信息。有一些 MSDN 文章描述了如何与这个实例对话以及如何创建一个新实例，但似乎没有任何东西可以回答我的问题。

**我的问题是：**根据您的经验，我是否走在正确的轨道上？我希望仅使用 Active Directory 就可以实现，还是必须使用其他工具？

* * *

**我研究过的其他方法：**

*   使用多个 web.config 文件 [ [stackoverflow](https://stackoverflow.com/questions/176338/customer-configurable-asp-net-web-site-security-for-fine-grained-control-of-page) ]
*   创建自定义安全模型和数据库以跨应用程序管理用户

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-04-08T06:51:37.690

使用 AD 进行身份验证是一个好主意，因为无论如何您都需要在其中添加所有人，而对于 Intranet 用户，则无需额外登录。

您是正确的，ASP.NET 允许您使用允许您针对 AD 进行身份验证的提供程序，尽管没有任何内容可以为您提供组成员资格支持（尽管如果您愿意，实现起来非常简单，我可以提供一个示例）。

这里真正的问题是，如果您想使用 AD 组在每个应用程序中定义权限，是吗？

如果是这样，那么您可以选择为 ASP.NET 创建自己的 RoleProvider，WinForms 和 WPF 应用程序也可以通过 ApplicationServices 使用它。此 RoleProvider 可以将 AD 中的用户 ID 链接到每个应用程序的组/角色，您可以将其存储在您自己的自定义数据库中，这也允许每个应用程序允许管理这些角色，而无需这些管理员在 AD 中具有额外权限。

如果您愿意，您还可以覆盖并将应用程序角色与 AD 组组合，因此，如果它们位于 AD 中的某个全局“管理员”组中，则无论应用程序角色成员身份如何，他们都可以获得应用程序的完全权限。相反，如果他们在 AD 中有一个组或属性说他们已被解雇，您可以忽略所有 App 角色成员资格并限制所有访问权限（因为 HR 可能不会从每个应用程序中删除他们，假设他们甚至知道他们全部！）。

按要求添加的示例代码：

**注意：基于此原创作品[http://www.codeproject.com/Articles/28546/Active-Directory-Roles-Provider](http://www.codeproject.com/Articles/28546/Active-Directory-Roles-Provider)**

对于您的 ActiveDirectoryMembershipProvider，您只需要实现 ValidateUser 方法，尽管您可以根据需要实现更多，新的 AccountManagement 命名空间使这变得微不足道：

```
// assumes: using System.DirectoryServices.AccountManagement;
public override bool ValidateUser( string username, string password )
{
  bool result = false;

  try
  {
    using( var context = 
        new PrincipalContext( ContextType.Domain, "yourDomainName" ) )
    {
      result = context.ValidateCredentials( username, password );
    }
  }
  catch( Exception ex )
  {
    // TODO: log exception
  }

  return result;
} 
```

对于您的角色提供者来说，这需要更多的工作，我们在搜索 google 时发现了一些关键问题，例如您想要排除的组、您想要排除的用户等。

可能值得一篇完整的博客文章，但这应该可以帮助您入门，它是在 Session 变量中缓存查找，就像您如何提高性能的示例一样（因为完整的 Cache 示例太长了）。

```
using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Configuration.Provider;
using System.Diagnostics;
using System.DirectoryServices;
using System.DirectoryServices.AccountManagement;
using System.Linq;
using System.Web;
using System.Web.Hosting;
using System.Web.Security;

namespace MyApp.Security
{
    public sealed class ActiveDirectoryRoleProvider : RoleProvider
    {
        private const string AD_FILTER = "(&(objectCategory=group)(|(groupType=-2147483646)(groupType=-2147483644)(groupType=-2147483640)))";
        private const string AD_FIELD = "samAccountName";

        private string _activeDirectoryConnectionString;
        private string _domain;

        // Retrieve Group Mode
        // "Additive" indicates that only the groups specified in groupsToUse will be used
        // "Subtractive" indicates that all Active Directory groups will be used except those specified in groupsToIgnore
        // "Additive" is somewhat more secure, but requires more maintenance when groups change
        private bool _isAdditiveGroupMode;

        private List<string> _groupsToUse;
        private List<string> _groupsToIgnore;
        private List<string> _usersToIgnore;

        #region Ignore Lists

        // IMPORTANT - DEFAULT LIST OF ACTIVE DIRECTORY USERS TO "IGNORE"
        //             DO NOT REMOVE ANY OF THESE UNLESS YOU FULLY UNDERSTAND THE SECURITY IMPLICATIONS
        //             VERYIFY THAT ALL CRITICAL USERS ARE IGNORED DURING TESTING
        private String[] _DefaultUsersToIgnore = new String[]
        {
            "Administrator", "TsInternetUser", "Guest", "krbtgt", "Replicate", "SERVICE", "SMSService"
        };

        // IMPORTANT - DEFAULT LIST OF ACTIVE DIRECTORY DOMAIN GROUPS TO "IGNORE"
        //             PREVENTS ENUMERATION OF CRITICAL DOMAIN GROUP MEMBERSHIP
        //             DO NOT REMOVE ANY OF THESE UNLESS YOU FULLY UNDERSTAND THE SECURITY IMPLICATIONS
        //             VERIFY THAT ALL CRITICAL GROUPS ARE IGNORED DURING TESTING BY CALLING GetAllRoles MANUALLY
        private String[] _defaultGroupsToIgnore = new String[]
            {
                "Domain Guests", "Domain Computers", "Group Policy Creator Owners", "Guests", "Users",
                "Domain Users", "Pre-Windows 2000 Compatible Access", "Exchange Domain Servers", "Schema Admins",
                "Enterprise Admins", "Domain Admins", "Cert Publishers", "Backup Operators", "Account Operators",
                "Server Operators", "Print Operators", "Replicator", "Domain Controllers", "WINS Users",
                "DnsAdmins", "DnsUpdateProxy", "DHCP Users", "DHCP Administrators", "Exchange Services",
                "Exchange Enterprise Servers", "Remote Desktop Users", "Network Configuration Operators",
                "Incoming Forest Trust Builders", "Performance Monitor Users", "Performance Log Users",
                "Windows Authorization Access Group", "Terminal Server License Servers", "Distributed COM Users",
                "Administrators", "Everybody", "RAS and IAS Servers", "MTS Trusted Impersonators",
                "MTS Impersonators", "Everyone", "LOCAL", "Authenticated Users"
            };
        #endregion

        /// <summary>
        /// Initializes a new instance of the ADRoleProvider class.
        /// </summary>
        public ActiveDirectoryRoleProvider()
        {
            _groupsToUse = new List<string>();
            _groupsToIgnore = new List<string>();
            _usersToIgnore = new List<string>();
        }

        public override String ApplicationName { get; set; }

        /// <summary>
        /// Initialize ADRoleProvider with config values
        /// </summary>
        /// <param name="name"></param>
        /// <param name="config"></param>
        public override void Initialize( String name, NameValueCollection config )
        {
            if ( config == null )
                throw new ArgumentNullException( "config" );

            if ( String.IsNullOrEmpty( name ) )
                name = "ADRoleProvider";

            if ( String.IsNullOrEmpty( config[ "description" ] ) )
            {
                config.Remove( "description" );
                config.Add( "description", "Active Directory Role Provider" );
            }

            // Initialize the abstract base class.
            base.Initialize( name, config );

            _domain = ReadConfig( config, "domain" );
            _isAdditiveGroupMode = ( ReadConfig( config, "groupMode" ) == "Additive" );
            _activeDirectoryConnectionString = ReadConfig( config, "connectionString" );

            DetermineApplicationName( config );
            PopulateLists( config );
        }

        private string ReadConfig( NameValueCollection config, string key )
        {
            if ( config.AllKeys.Any( k => k == key ) )
                return config[ key ];

            throw new ProviderException( "Configuration value required for key: " + key );
        }

        private void DetermineApplicationName( NameValueCollection config )
        {
            // Retrieve Application Name
            ApplicationName = config[ "applicationName" ];
            if ( String.IsNullOrEmpty( ApplicationName ) )
            {
                try
                {
                    string app =
                        HostingEnvironment.ApplicationVirtualPath ??
                        Process.GetCurrentProcess().MainModule.ModuleName.Split( '.' ).FirstOrDefault();

                    ApplicationName = app != "" ? app : "/";
                }
                catch
                {
                    ApplicationName = "/";
                }
            }

            if ( ApplicationName.Length > 256 )
                throw new ProviderException( "The application name is too long." );
        }

        private void PopulateLists( NameValueCollection config )
        {
            // If Additive group mode, populate GroupsToUse with specified AD groups
            if ( _isAdditiveGroupMode && !String.IsNullOrEmpty( config[ "groupsToUse" ] ) )
                _groupsToUse.AddRange(
                    config[ "groupsToUse" ].Split( ',' ).Select( group => group.Trim() )
                );

            // Populate GroupsToIgnore List<string> with AD groups that should be ignored for roles purposes
            _groupsToIgnore.AddRange(
                _defaultGroupsToIgnore.Select( group => group.Trim() )
            );

            _groupsToIgnore.AddRange(
                ( config[ "groupsToIgnore" ] ?? "" ).Split( ',' ).Select( group => group.Trim() )
            );

            // Populate UsersToIgnore ArrayList with AD users that should be ignored for roles purposes
            string usersToIgnore = config[ "usersToIgnore" ] ?? "";
            _usersToIgnore.AddRange(
                _DefaultUsersToIgnore
                    .Select( value => value.Trim() )
                    .Union(
                        usersToIgnore
                            .Split( new[] { "," }, StringSplitOptions.RemoveEmptyEntries )
                            .Select( value => value.Trim() )
                    )
            );
        }

        private void RecurseGroup( PrincipalContext context, string group, List<string> groups )
        {
            var principal = GroupPrincipal.FindByIdentity( context, IdentityType.SamAccountName, group );

            if ( principal == null )
                return;

            List<string> res =
                principal
                    .GetGroups()
                    .ToList()
                    .Select( grp => grp.Name )
                    .ToList();

            groups.AddRange( res.Except( groups ) );
            foreach ( var item in res )
                RecurseGroup( context, item, groups );
        }

        /// <summary>
        /// Retrieve listing of all roles to which a specified user belongs.
        /// </summary>
        /// <param name="username"></param>
        /// <returns>String array of roles</returns>
        public override string[] GetRolesForUser( string username )
        {
            string sessionKey = "groupsForUser:" + username;

            if ( HttpContext.Current != null &&
                 HttpContext.Current.Session != null &&
                 HttpContext.Current.Session[ sessionKey ] != null
            )
                return ( (List<string>) ( HttpContext.Current.Session[ sessionKey ] ) ).ToArray();

            using ( PrincipalContext context = new PrincipalContext( ContextType.Domain, _domain ) )
            {
                try
                {
                    // add the users groups to the result
                    var groupList =
                        UserPrincipal
                            .FindByIdentity( context, IdentityType.SamAccountName, username )
                            .GetGroups()
                            .Select( group => group.Name )
                            .ToList();

                    // add each groups sub groups into the groupList
                    foreach ( var group in new List<string>( groupList ) )
                        RecurseGroup( context, group, groupList );

                    groupList = groupList.Except( _groupsToIgnore ).ToList();

                    if ( _isAdditiveGroupMode )
                        groupList = groupList.Join( _groupsToUse, r => r, g => g, ( r, g ) => r ).ToList();

                    if ( HttpContext.Current != null )
                        HttpContext.Current.Session[ sessionKey ] = groupList;

                    return groupList.ToArray();
                }
                catch ( Exception ex )
                {
                    // TODO: LogError( "Unable to query Active Directory.", ex );
                    return new[] { "" };
                }
            }
        }

        /// <summary>
        /// Retrieve listing of all users in a specified role.
        /// </summary>
        /// <param name="rolename">String array of users</param>
        /// <returns></returns>
        public override string[] GetUsersInRole( String rolename )
        {
            if ( !RoleExists( rolename ) )
                throw new ProviderException( String.Format( "The role '{0}' was not found.", rolename ) );

            using ( PrincipalContext context = new PrincipalContext( ContextType.Domain, _domain ) )
            {
                try
                {
                    GroupPrincipal p = GroupPrincipal.FindByIdentity( context, IdentityType.SamAccountName, rolename );

                    return (

                        from user in p.GetMembers( true )
                        where !_usersToIgnore.Contains( user.SamAccountName )
                        select user.SamAccountName

                    ).ToArray();
                }
                catch ( Exception ex )
                {
                    // TODO: LogError( "Unable to query Active Directory.", ex );
                    return new[] { "" };
                }
            }
        }

        /// <summary>
        /// Determine if a specified user is in a specified role.
        /// </summary>
        /// <param name="username"></param>
        /// <param name="rolename"></param>
        /// <returns>Boolean indicating membership</returns>
        public override bool IsUserInRole( string username, string rolename )
        {
            return GetUsersInRole( rolename ).Any( user => user == username );
        }

        /// <summary>
        /// Retrieve listing of all roles.
        /// </summary>
        /// <returns>String array of roles</returns>
        public override string[] GetAllRoles()
        {
            string[] roles = ADSearch( _activeDirectoryConnectionString, AD_FILTER, AD_FIELD );

            return (

                from role in roles.Except( _groupsToIgnore )
                where !_isAdditiveGroupMode || _groupsToUse.Contains( role )
                select role

            ).ToArray();
        }

        /// <summary>
        /// Determine if given role exists
        /// </summary>
        /// <param name="rolename">Role to check</param>
        /// <returns>Boolean indicating existence of role</returns>
        public override bool RoleExists( string rolename )
        {
            return GetAllRoles().Any( role => role == rolename );
        }

        /// <summary>
        /// Return sorted list of usernames like usernameToMatch in rolename
        /// </summary>
        /// <param name="rolename">Role to check</param>
        /// <param name="usernameToMatch">Partial username to check</param>
        /// <returns></returns>
        public override string[] FindUsersInRole( string rolename, string usernameToMatch )
        {
            if ( !RoleExists( rolename ) )
                throw new ProviderException( String.Format( "The role '{0}' was not found.", rolename ) );

            return (
                from user in GetUsersInRole( rolename )
                where user.ToLower().Contains( usernameToMatch.ToLower() )
                select user

            ).ToArray();
        }

        #region Non Supported Base Class Functions

        /// <summary>
        /// AddUsersToRoles not supported.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory. 
        /// </summary>
        public override void AddUsersToRoles( string[] usernames, string[] rolenames )
        {
            throw new NotSupportedException( "Unable to add users to roles.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory." );
        }

        /// <summary>
        /// CreateRole not supported.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory. 
        /// </summary>
        public override void CreateRole( string rolename )
        {
            throw new NotSupportedException( "Unable to create new role.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory." );
        }

        /// <summary>
        /// DeleteRole not supported.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory. 
        /// </summary>
        public override bool DeleteRole( string rolename, bool throwOnPopulatedRole )
        {
            throw new NotSupportedException( "Unable to delete role.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory." );
        }

        /// <summary>
        /// RemoveUsersFromRoles not supported.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory. 
        /// </summary>
        public override void RemoveUsersFromRoles( string[] usernames, string[] rolenames )
        {
            throw new NotSupportedException( "Unable to remove users from roles.  For security and management purposes, ADRoleProvider only supports read operations against Active Direcory." );
        }
        #endregion

        /// <summary>
        /// Performs an extremely constrained query against Active Directory.  Requests only a single value from
        /// AD based upon the filtering parameter to minimize performance hit from large queries.
        /// </summary>
        /// <param name="ConnectionString">Active Directory Connection String</param>
        /// <param name="filter">LDAP format search filter</param>
        /// <param name="field">AD field to return</param>
        /// <returns>String array containing values specified by 'field' parameter</returns>
        private String[] ADSearch( String ConnectionString, String filter, String field )
        {
            DirectorySearcher searcher = new DirectorySearcher
            {
                SearchRoot = new DirectoryEntry( ConnectionString ),
                Filter = filter,
                PageSize = 500
            };
            searcher.PropertiesToLoad.Clear();
            searcher.PropertiesToLoad.Add( field );

            try
            {
                using ( SearchResultCollection results = searcher.FindAll() )
                {
                    List<string> r = new List<string>();
                    foreach ( SearchResult searchResult in results )
                    {
                        var prop = searchResult.Properties[ field ];
                        for ( int index = 0; index < prop.Count; index++ )
                            r.Add( prop[ index ].ToString() );
                    }

                    return r.Count > 0 ? r.ToArray() : new string[ 0 ];
                }
            }
            catch ( Exception ex )
            {
                throw new ProviderException( "Unable to query Active Directory.", ex );
            }
        }
    }
} 
```

一个示例配置子部分条目如下：

```
<roleManager enabled="true" defaultProvider="ActiveDirectory">
  <providers>
    <clear/>
    <add
        applicationName="MyApp" name="ActiveDirectory"
        type="MyApp.Security.ActiveDirectoryRoleProvider"
        domain="mydomain" groupMode="" connectionString="LDAP://myDirectoryServer.local/dc=mydomain,dc=local"
    />
  </providers>
</roleManager> 
```

哇，代码太多了！

PS：上面角色提供者的核心部分是基于另一个人的工作，我手边没有链接，但我们是通过谷歌找到的，所以部分归功于那个人的原作。我们对其进行了大量修改以使用 LINQ 并摆脱对数据库进行缓存的需要。

# javascript - XUL 和 document.write()

> ID：726840
> 
> 赞同：1
> 
> 时间：2009-04-07T17:40:59.727
> 
> 标签：javascript, firefox, xul

我正在尝试创建一个简单的 firefox 扩展程序，但在 XUL 窗口中允许我做的事情时遇到了麻烦。

我想使用 document.write 或获取文本区域的句柄来收集数据并在单击按钮时显示它。

有没有关于如何做到这一点的教程？根据我一直在阅读的内容，人们建议打开一个新窗口并写入它，但我的目标是在浏览器底部创建一个持久窗口。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T18:34:10.753

我使用 xulrunner 编写了一个简单的 XUL 应用程序。试试这个： http: [//plindenbaum.blogspot.com/2009/02/standalone-xul-application-translating.html](http://plindenbaum.blogspot.com/2009/02/standalone-xul-application-translating.html)

稍后，当您的应用程序将正确运行时，您会将其转换为扩展程序。

希望能帮助到你。

# winapi - 是否需要使用 InitCommonControlsEx() 和 InitCommonControls()？

> ID：726841
> 
> 赞同：14
> 
> 时间：2009-04-07T17:41:03.707
> 
> 标签：winapi

我对win32完全陌生。在过去的 48 小时里，我一直在努力。

我正在尝试构建一个**“网格”**，并且 在 msdn.microsoft.com 上获得了**List-View 控件**和**Header 控件的示例。**

第一个调用 InitCommonControls() 函数（除了我读到此函数已过时）。

```
HWND DoCreateHeader(HWND hwndParent, HINSTANCE hInst) 
{ 
    HWND hwndHeader; 
    RECT rcParent; 
    HDLAYOUT hdl; 
    WINDOWPOS wp; 

    // Ensure that the common control DLL is loaded, and then create 
    // the header control. 
    InitCommonControls(); 

    // ...

    // hwndHeader = CreateWindowEx(0, WC_HEADER, ...
} 
```

第二个调用 InitCommonControlsEx() 函数。

```
HWND CreateListView (HWND hwndParent, HINSTANCE hInst) 
{     
    RECT rcl; 
    INITCOMMONCONTROLSEX icex;

    // Ensure that the common control DLL is loaded. 
    icex.dwSize = sizeof(INITCOMMONCONTROLSEX);
    icex.dwICC  = ICC_LISTVIEW_CLASSES;
    InitCommonControlsEx(&icex); 

    // ...

    // HWND hWndListView = CreateWindow(WC_LISTVIEW ...
} 
```

似乎这些功能需要 comctl32.lib 库，但下载它是一团糟。

此外，我注意到，如果我删除这些功能，一切都会正常运行。**那么，它们有必要吗？**

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-07T18:02:13.077

是的，这是必要的。他们需要为那些注册的自定义控件获取窗口类。奇怪的是，代码中的其他一些组件正在加载它们。我不确定，但我认为如果您的清单中支持 comctl v6（XP 及以上视觉样式），您会自动获得 commctl32.dll。

有关 InitCommonControlsEx 所做的更多信息在[这里](https://devblogs.microsoft.com/oldnewthing/20050718-16/?p=34913)。

不知道下载 comctl32.lib 是什么意思，它存在于自 NT 4 和 Windows 95 以来的每个 Windows 平台上，因此您无需重新分发它。

# java - 查找是否因重复而引发 SQLException

> ID：726856
> 
> 赞同：13
> 
> 时间：2009-04-07T17:44:42.650
> 
> 标签：java, sql, exception

我有一个与数据库无关的 Java 程序，我需要在插入时知道是否由于重复键而引发了 SQLException。

如果我使用单个数据库驱动程序，我会简单地使用 ErrorCode，但由于我可以使用非常不同的引擎，因此 ErrorCode 是不一样的。

有没有人这样做过？有任何想法吗？

许多TIA！

**编辑：**我有一个配置文件，用于存储驱动程序类（即：org.apache.derby.jdbc.ClientDriver）和一些其他需要的信息（即：用户名、密码、url ...）。连接总是作为“java.SQL.Connection”传递，所以我并不关心正在使用什么驱动程序。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T21:04:28.647

这正是 SQLException.getSQLState() 的用途。根据 Google 的说法，“23000”表示至少在[MySQL](http://dev.mysql.com/doc/refman/5.0/en/error-messages-server.html)、[PostgreSQL](http://www.postgresql.org/docs/8.3/static/errcodes-appendix.html)和[Oracle](http://download.oracle.com/docs/cd/B10501_01/appdev.920/a58231/appd.htm)中存在唯一约束违规。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T19:07:45.087

使用基本的 JDBC，实际上没有办法以跨数据库的方式执行您所说的操作。正如您提到的，可以使用*getErrorCode ，但需要供应商特定的错误代码。*

我看到解决这个问题的唯一三种方法是：

1.  使用某种框架来完成从错误代码到有意义的异常的所有转换（Hibernate 可能会这样做，其他人提到 Spring 会这样做）
2.  在插入之前手动检查重复项（使用选择）。（这不会是 100%，因为从技术上讲，有人可以在您的查询之后进行插入）。
3.  在插入时遇到任何 sql 异常后，尝试查询该 id。如果您确实可以找到匹配项 - 您可以相当确定您收到的错误是由于重复的主键造成的。（尽管可能存在多个问题，而这实际上并不是引发的问题）。

我的建议是编写代码以尽可能避免该问题，然后（如果绝对必要）使用#3。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T17:59:13.397

您可以通过插入已知的重复密钥并记录抛出的错误代码来在启动（或配置）时“训练”程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T18:06:22.600

我认为理想的解决方案是让数据层在这种情况下抛出一个特定的异常，可能是 SQLException 的子类`DuplicateKeyException`或类似的东西。

如果您希望能够以不同的方式处理不同的异常，那么您必须首先抛出不同的异常类型（或子类型）。

我认为这是 Spring 框架真正正确的一个领域：它们提供[了非常丰富的“数据库异常”层次结构，](http://static.springframework.org/spring/docs/2.5.x/reference/dao.html#dao-exceptions)所有这些都扩展了[DataAccessException](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/dao/DataAccessException.html)，具有“可恢复异常”、“瞬态异常”、“数据完整性异常”等。这使您的客户端代码可以自由捕获任何（或没有）它可以处理或关心的异常类型：表示错误的异常，如果您重新运行事务可能无法重复，一个致命的不可恢复错误，或者您可以简单地捕获根类型。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T17:53:49.837

好吧，如果你不能依靠异常来告诉你它被抛出的原因，你可以通过使用“select count(*) from table where key = @keyfailedtoinsert;”来测试异常。

不幸的是，不能保证异常为您提供表名和键名。在某些情况下，调用 JDBC 驱动程序的 java 代码可能永远不会拥有它们，例如，如果插入发生在存储过程中，或者在触发器中。

因此，您又不得不信任每个 JDBC 驱动程序的供应商。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T17:52:03.257

我相信一种简单可靠的方法是在插入之前检查密钥是否存在。正如您正确指出的那样，每个数据库都有自己的错误报告方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T18:00:05.843

我错过了什么吗？如果您使用的是 JDBC，则无论使用什么数据库，都应该返回重复键异常。

或者你有没有问过在你尝试插入之前你将如何确定一个 dupkey？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-01-23T07:47:15.873

如果您使用的是 spring，请将您的唯一 KEY 名称设置`UK_user_id`为例如并捕获`DataIntegrityViolationException`.
然后，您可以与 进行`ex.getCause().getConstraintName()`比较`UK_user_id`。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-21T19:04:57.063

也许这不是解决这个问题的正确方法，但我有同样的问题，我用以下代码解决了：

```
try{

   //here goes your code
   //Conection to DB, stmt, ...

}catch (SQLException sqlEx){

    //Check if the SQLException message contains the words "duplicate entry" and "for key"
    if(sqlEx.getMessage().contains("Duplicate entry") 
        && sqlEx.getMessage().contains("for key")){

           System.out.println("This Key already exists in the database");

      }else {

         //if your Exception is not due to the duplicate key, print your SQLException
           System.out.println("Error SQL:" + sqlEx.getMessage());          
      }
} 
```

我希望这个解决方案可以对某人有所帮助！

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-07T18:02:33.373

我假设您没有使用 JDBC，否则这将是一个非常简单的错误查找。

您是否有一组不同的类来访问不同的数据库？如果是这样，您可以在数据库特定类中捕获异常并抛出您自己的在所有数据库类型之间共享的异常类型。

# lucene.net - Lucene 版本

> ID：726859
> 
> 赞同：1
> 
> 时间：2009-04-07T17:45:01.480
> 
> 标签：lucene.net

有人听说过 Lucene 2.3.1.3 版吗？我们在生产项目中使用它。不过Lucene的稳定版是2.0.0.4版。

我应该推动将项目的依赖项移至版本 2.0.0.4 吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-05T18:04:32.187

我在大约 50 个站点的生产环境中运行 2.3.1.3。我不建议降级版本，因为 2.3.1 解决了很多性能和内存泄漏问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T18:44:55.750

您是在谈论[Lucene](http://lucene.apache.org/)还是[Lucene.NET](http://incubator.apache.org/lucene.net/)？这些是不同但相关的项目。Lucene.NET 是 Lucene Java 代码的 .NET 端口。

[2.0.0.4](http://incubator.apache.org/lucene.net/download/)是 Lucene.NET 的稳定版本。

但是，有一个 Lucene 版本 2.3.1（用于 Java）。[Lucene 网站使2.4.1](http://lucene.apache.org/#9+March+2009+-+Lucene+Java+2.4.1+available)看起来像是适合生产的最新版本。

# c# - 上传用户头像的图片

> ID：726863
> 
> 赞同：2
> 
> 时间：2009-04-07T17:45:47.390
> 
> 标签：c#, asp.net-mvc, avatars

现在我在我的网站上使用 Gravatar 作为用户头像。

我想让用户从我的网站上传图像以用作头像到 gravatar，这样他们就不必访问 gravatar，如果他们选择不访问，我也不必支持多种头像方法。我不知道如何在 ASP.NET MVC 中实现这一点。

在 Ruby on Rails 中，它们变得简单；你只需安装一个插件。但是在 ASP 中，您自己编写整个代码。

*   我需要知道什么才能开始？
*   有这方面的 Gravatar API 吗？
*   是否有具有此功能的 ASP 插件？
*   有没有一种简单的方法可以将 Ruby 代码转换为 ASP？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T18:11:44.660

Gravatar 似乎没有简单的服务或界面来从其他网站上传头像 - 他们希望您直接访问他们的网站。

您可能必须抓取他们的网站，并充当 HTTP 客户端来模拟用户自己执行操作。这不是微不足道的，但如果您查看 Ruby 代码，您应该对一般流程有一个很好的了解。

你试过什么了？

-亚当

# c# - 从 Win32_TCPIPPrinterPort 检索主机地址时出现问题

> ID：726864
> 
> 赞同：1
> 
> 时间：2009-04-07T17:46:28.823
> 
> 标签：c#, wmi

我在检索打印机端口地址时遇到了一个奇怪的问题。当我获得 Win32_TCPIPPrinterPort 中的所有条目时，HostAddress 字段（应该有 IP 地址）通常为空白/空，只有端口名称有值。为了让它有点奇怪，如果某个特定端口没有被任何打印机使用，那么 HostAddress 将具有正确的值。

C# 代码很简单，结果是这样的；IP_192.168.1.100，打印机端口xyz，

```
richTextBox1.Clear();
ManagementObjectSearcher portSearcher = new ManagementObjectSearcher("root\\CIMV2",
    "SELECT * FROM Win32_TCPIPPrinterPort");
foreach (ManagementObject port in portSearcher.Get())
{
    richTextBox1.AppendText(
        String.Format("Name: {0} HostAddress: {1}",
            port["Name"],
            port["HostAddress"])
        );
} 
```

我也在 WSH/VBS 中尝试过同样的事情，并且看到了同样的行为。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-27T00:21:23.270

我最终不得不重新访问它，并再次尝试。我发现内置的 prnport.vbs 管理脚本没有问题 - 调查它我发现在建立它的 WMI 连接时它有 oService.Security_.Priveleges.AddAsString "SeLoadDriverPrivilege"

C# 中的解决方案最终指定了 WMI ConnectionOptions 并将 EnablePrivileges 设置为 true。然后，未使用或正在使用的端口的 HostAdress 不再为空。

```
ConnectionOptions connOptions = new ConnectionOptions();
connOptions.EnablePrivileges = true;

ManagementScope mgmtScope = new ManagementScope("root\\CIMV2", connOptions);
mgmtScope.Connect();

ObjectQuery objQuery = new ObjectQuery("SELECT * FROM Win32_TCPIPPrinterPort");
ManagementObjectSearcher moSearcher = new ManagementObjectSearcher(mgmtScope, objQuery);

foreach (ManagementObject mo in moSearcher.Get())
{
    Console.WriteLine(String.Format("PortName={0} HostAddress={1}", mo["Name"], mo["HostAddress"]));
} 
```

# linux - SNMP 设备仿真

> ID：726876
> 
> 赞同：5
> 
> 时间：2009-04-07T17:49:53.997
> 
> 标签：linux, snmp, emulation

我们有linux、C/C++、perl下的网络管理系统，我们需要测试这个系统的性能。是否有工具或方法可以让我们模拟 50 000 台 SNMP 设备？

我不知道在这里还能说什么......如果我应该提供更多信息，请告诉我。

任何想法都值得赞赏。

谢谢博格丹

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:57:48.110

有一些工具可以让你做到这一点，但我所看到的通常是商业软件。

*   [Adventnet SNMP 代理模拟器](http://www.adventnet.com/products/simulator/snmp-agent-simulator-ds.html)
*   [MIMIC SNMP 代理模拟器](http://www.gambitcomm.com/site/products/snmp_simulator.shtml)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-09T21:00:41.497

你可以试试[Raddle——](http://raddle.sourceforge.net/)它是开源的，用 Perl 编写并基于 Honeyd，它应该能够模拟多达 65536 个主机。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T15:01:30.247

谢谢您的回答。这是我们现在解决这个问题的方法：

1.  我们有一个带有 1 个接口 (eth0) 的 linux VM。
2.  我们添加了 50'000 个虚拟接口（eth0:1、eth0:2 等）。
3.  一个 SNMP 守护程序启动并通过所有 IP 地址回复请求。

这样，我们在网络中有 50K 个 IP 地址来回复 SNMP 请求。

不过，我正在调查 Raddle。也许如果它适合我​​们会切换到这个解决方案。

谢谢，波格丹

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T17:58:21.200

如果设备正在发送陷阱，您可以使用[Net-SNMP](http://www.net-snmp.org/)来`snmptrap`模拟发送的许多陷阱的影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-02T23:29:40.513

据报道，[snmpsim](http://snmpsim.sf.net)工具可以支持约 50K 代理的模拟。它可以通过响应不同的 IP 或不同的 SNMPv1/v2c 社区名称或 SNMPv3 上下文名称来模拟不同的代理。

还有关于性能优化的[提示。](http://snmpsim.sourceforge.net/simulation-receipts.html)

# brew-framework - BREW：跟踪 BPOINT 错误消息的方法

> ID：726893
> 
> 赞同：2
> 
> 时间：2009-04-07T17:56:30.657
> 
> 标签：brew-framework, brewmp

嗨，我是 BREW 移动开发的新手。我想知道如何在模拟器中跟踪 BPOINT 错误消息的方法，比如双释放内存，即 BPOINT 的 TYPE 3 等。

谢谢。克拉姆克拉姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-17T06:16:48.167

使用 DBGPRINTF( **FILE_LINE** ); 由于 BPOINT 错误消息一发生就出现在模拟器日志中，因此放置 DBGPRINTF( **FILE_LINE** ) 实际上非常有效，它们将指示错误是在语句之​​前还是之后。把它们放很多 - 查找并修复错误然后删除 - 它比你想象的要快。

# unix - 你妈妈从来没有告诉过你的 Vim 的黑暗角落是什么？

> ID：726894
> 
> 赞同：821
> 
> 时间：2009-04-07T17:57:30.437
> 
> 标签：unix, vim, editor, vi

人们谈论常见技巧的问题很多，特别是“ [Vim+ctags 技巧和窍门](https://stackoverflow.com/questions/563616/vimctags-tips-and-tricks)”。

但是，我并不是指那些刚接触 Vim 的人会觉得很酷的常用快捷键。我说的是一位经验丰富的 Unix 用户（无论他们是开发人员还是管理员，等等），他们认为他们知道我们 99% 的人从未听说过或梦想过的事情。不仅让他们的工作更轻松，而且很酷和**hackish**的东西。毕竟，*Vim*存在于世界上最黑暗角落的操作系统中，因此它应该具有只有少数特权人员知道并想与我们分享的复杂性。

* * *

## 回答 #1

> 赞同：797
> 
> 时间：2009-04-07T18:03:41.483

可能不是 99% 的 Vim 用户不知道的东西，但它是我每天都在使用的东西，任何 Linux+Vim 高级用户都必须知道。

基本命令，但非常有用。

```
:w !sudo tee % 
```

在编辑我没有写权限的文件之前，我经常忘记 sudo。当我来保存该文件并收到权限错误时，我只需发出该 vim 命令即可保存该文件，而无需将其保存到临时文件然后再次将其复制回来。

您显然必须在安装了 sudo 并拥有 sudo 权限的系统上。

* * *

## 回答 #2

> 赞同：628
> 
> 时间：2009-04-07T18:09:16.883

我最近发现的一些我认为很酷的东西：

```
:earlier 15m 
```

将文档恢复到 15 分钟前的状态。可以为要回滚的时间采用各种参数，并且取决于撤消级别。可以用相反的命令反转`:later`

* * *

## 回答 #3

> 赞同：419
> 
> 时间：2009-04-26T04:03:04.300

`:! [command]`在 Vim 中执行外部命令。

但是在冒号之后添加一个点 `:.! [command]`，它会将命令的输出转储到您的当前窗口中。那是`: . !`

例如：

```
:.! ls 
```

我经常使用它来将当前日期添加到我正在输入的文档中：

```
:.! date 
```

* * *

## 回答 #4

> 赞同：316
> 
> 时间：2009-04-07T20:33:30.437

并不完全晦涩难懂，但有几个“删除”命令非常有用，例如..

*   `diw`删除当前单词
*   `di(`在当前括号内删除
*   `di"`删除引号之间的文本

其他可以在[`:help text-objects`](http://vimdoc.sourceforge.net/htmldoc/motion.html#diw)

* * *

## 回答 #5

> 赞同：240
> 
> 时间：2009-04-29T13:21:55.380

**de**按 删除直到单词结尾的所有内容。随心所欲。

**ci(xyz[Esc]** -- 这是一个奇怪的。这里，'i' 并不意味着插入模式。相反，它意味着括号内。所以这个序列剪切你所在的括号内的文本并将其替换为“xyz”。它也适用于方括号和数字括号内——只需执行 ci[ 或ci `a`{`i`也想删除括号，而不仅仅是其中的文本。

**ci"** - 剪切当前引号中的文本

**ciw** - 剪切当前单词。这与前一个一样工作，只是`(`被替换为`w`.

**C** - 剪切其余的行并切换到插入模式。

**ZZ** -- 保存并关闭当前文件（比 Ctrl-F4 更快地关闭当前选项卡！）

**ddp** - 将当前行向下移动一行

**xp** -- 将当前字符向右移动一位

**U** - 大写，所以大写`viwU`单词

**~** - 切换大小写，因此`viw~`将反转整个单词的大小写

**Ctrl+u / Ctrl+d**向上或向下滚动页面半个屏幕。这似乎比通常的全屏分页更有用，因为它可以更容易地查看两个屏幕的关系。对于那些仍然想一次滚动整个屏幕的人来说，Ctrl+f 用于前进，Ctrl+b 用于后退。Ctrl+Y 和 Ctrl+E 一次向下或向上滚动一行。

**疯狂但非常有用的命令是 zz——**它滚动屏幕使这条线出现在中间。这非常适合将您正在处理的代码放在您的注意力中心。兄弟命令 - zt 和 zb - 使这条线在屏幕上的顶部或底部，这不太有用。

**%**查找并跳转到匹配的括号。

**de** -- 从光标处删除到词尾（也可以`dE`删除到下一个空格）

**bde** -- 删除当前单词，从左到右分隔符

**df[space]** -- 删除直到并包括下一个空格

**DT。**-- 删除直到下一个点

**dd** -- 删除整行

**ye (or yE)** -- 将文本从这里拉到词尾

**ce** - 切开词尾

**再见**——复制当前单词（让我想知道“hi”是做什么的！）

**yy** -- 复制当前行

**cc** -- 剪切当前行，你也可以这样做`S`。还有一个较低的上限`s`，可以切断当前字符并切换到插入模式。

**viwy 或 viwc**。拉动或更改当前单词。`w`多次点击以继续选择每个后续单词，用于`b`向后移动

**vi{** - 选择括号中的所有文本。va{ - 选择所有文本，包括 {}s

**vi(p** - 突出显示 () 中的所有内容并替换为粘贴的文本

**b 和 e 逐字移动光标，类似于 Ctrl+Arrows 通常的做法**。单词的定义略有不同，因为几个连续的分隔符被视为一个单词。如果你从一个单词的中间开始，按 b 总是会让你到当前单词的开头，并且每个连续的 b 都会跳到下一个单词的开头。类似地，并且易于记忆，`e`将光标移到当前单词的末尾以及每个后续单词的末尾。

**类似于`b`/ `e`，大写`B`并`E`仅使用空格作为分隔符逐字移动光标。**

**大写 D（深呼吸）**删除光标右侧的其余行，与普通编辑器中的 Shift+End/Del 相同（注意 2 次按键 -- Shift+D -- 而不是 3）

* * *

## 回答 #6

> 赞同：211
> 
> 时间：2009-06-04T11:54:15.460

我在大多数 Vim 教程中很少找到，但它非常有用（至少对我而言）是

`g; and g,`

在更改列表中移动（向前、向后）。

让我展示一下我是如何使用它的。有时我需要复制和粘贴一段代码或字符串，比如 CSS 文件中的十六进制颜色代码，所以我搜索、跳转（不在乎匹配在哪里）、复制它然后跳回 (g;) 到哪里我正在编辑代码以最终粘贴它。无需创建标记。更简单。

只是我的2美分。

* * *

## 回答 #7

> 赞同：187
> 
> 时间：2009-04-07T21:19:32.400

```
:%!xxd 
```

将 vim 变成一个十六进制编辑器。

```
:%!xxd -r 
```

恢复。

**警告：如果您不使用二进制 (-b) 进行编辑，您可能会损坏文件。**- 乔什·李在评论中。

* * *

## 回答 #8

> 赞同：136
> 
> 时间：2011-01-12T20:03:40.860

```
gv 
```

重新选择最后的视觉选择。

* * *

## 回答 #9

> 赞同：123
> 
> 时间：2009-05-04T20:04:33.233

有时 .vimrc 中的设置会被插件或自动命令覆盖。要调试这个有用的技巧是结合使用:verbose 命令和:set。例如，要找出 cindent 设置/取消设置的位置：

```
:verbose set cindent? 
```

这将输出如下内容：

```
cindent
    Last set from /usr/share/vim/vim71/indent/c.vim 
```

这也适用于地图和高光。（感谢 joeytwiddle 指出这一点。）例如：

```
:verbose nmap U
n  U             <C-R>
        Last set from ~/.vimrc

:verbose highlight Normal
Normal         xxx guifg=#dddddd guibg=#111111 font=Inconsolata Medium 14
        Last set from ~/src/vim-holodark/colors/holodark.vim 
```

* * *

## 回答 #10

> 赞同：103
> 
> 时间：2011-03-27T10:05:01.137

`:%TOhtml`

创建当前文件的 html 呈现。

* * *

## 回答 #11

> 赞同：102
> 
> 时间：2009-04-08T15:36:36.977

不确定这是否算作黑暗角落，但我才刚刚学会......

```
:g/match/y A 
```

将所有包含“匹配”的行拉入（复制）到`"a`/`@a`寄存器中。（大写 as`A`使 vim*追加*yankings 而不是替换以前的寄存器内容。）我最近在制作 Internet Explorer 样式表时经常使用它。

* * *

## 回答 #12

> 赞同：96
> 
> 时间：2009-04-20T20:36:25.020

想查看您的 :command 历史记录吗？

```
q: 
```

然后浏览，编辑，最后执行命令。

曾经对两个文件进行类似的更改并在它们之间来回切换吗？（比如说，源文件和头文件？）

```
:set hidden
:map <TAB> :e#<CR> 
```

然后在这些文件之间来回切换。

* * *

## 回答 #13

> 赞同：88
> 
> 时间：2010-09-17T16:50:46.907

Vim 会打开一个 URL，例如

```
vim http://stackoverflow.com/ 
```

当您需要提取页面的源代码以供参考时，这很好。

* * *

## 回答 #14

> 赞同：71
> 
> 时间：2009-09-11T12:39:23.203

宏可以调用其他宏，也可以调用自身。

例如：

```
qq0dwj@qq@q 
```

...将删除每一行的第一个单词，直到文件末尾。

这是一个非常简单的例子，但它展示了 vim 的一个非常强大的特性

* * *

## 回答 #15

> 赞同：57
> 
> 时间：2009-07-13T19:18:26.800

**^O 和 ^I**

转到较旧/较新的位置。当您在文件中移动（通过搜索、移动命令等）时，vim 会记住这些“跳转”，因此您可以向后重复这些跳转（^O - O 表示旧）和向前（^I - 就在键盘上的 I 旁边）。我发现它在编写代码和执行大量搜索时非常有用。

**吉**

转到最后停止插入模式的位置。我发现自己经常编辑然后搜索一些东西。要返回编辑位置，请按 gi。

**女朋友**

将光标放在文件名上（例如包含头文件），按 gf 并打开文件

**gF**

类似于 gf 但识别格式“[文件名]:[行号]”。按 gF 将打开 [文件名] 并将光标设置为 [行号]。

**^P 和 ^N**

编辑时自动完成文本（^P - 上一个匹配和 ^N 下一个匹配）

**^X^L**

编辑完成到同一行（对编程很有用）。您编写代码，然后您回想起文件中某处有相同的代码。只需按 ^X^L 即可完成整行

**^X^F**

完整的文件名。你写“/etc/pass”嗯。你忘记了文件名。只需按^X^F，文件名就完成了

**^Z 或 :sh**

临时移动到外壳。如果您需要快速抨击：

*   按 ^Z（将 vi 置于后台）返回原始 shell，按 fg 返回 vim
*   按 :sh 转到子 shell 并按 ^D/exit 返回 vi 返回

* * *

## 回答 #16

> 赞同：57
> 
> 时间：2009-04-08T01:15:58.930

假设您已编译 Perl 和/或 Ruby 支持，`:rubydo`并将`:perldo`在范围内的每一行（默认为整个缓冲区）上运行 Ruby 或 Perl 单行，并`$_`绑定到当前行的文本（减去换行符）。操作`$_`将更改该行的文本。

您可以使用它来完成某些在脚本语言中很容易完成但使用 Vim 内置函数不那么明显的事情。例如要反转一行中单词的顺序：

```
:perldo $_ = join ' ', reverse split 
```

在每行末尾插入一个 8 个字符 (AZ) 的随机字符串：

```
:rubydo $_ += ' ' + (1..8).collect{('A'..'Z').to_a[rand 26]}.join 
```

您一次只能处理一行，并且不能添加换行符。

* * *

## 回答 #17

> 赞同：51
> 
> 时间：2009-08-17T13:57:55.707

```
" insert range ip's
"
"          ( O O )
" =======oOO=(_)==OOo======

:for i in range(1,255) | .put='10.0.0.'.i | endfor 
```

* * *

## 回答 #18

> 赞同：51
> 
> 时间：2010-04-16T00:44:56.780

键入**==**将根据上面的行更正当前行的缩进。

实际上，您可以在任何移动命令后执行一个 = 符号。**= *{运动}***

例如，您可以使用在匹配的大括号之间移动的 % 移动。将光标定位在以下代码中的 { 上：

```
if (thisA == that) {
//not indented
if (some == other) {
x = y;
}
} 
```

然后按**=%**立即得到这个：

```
if (thisA == that) {
    //not indented
    if (some == other) {
        x = y;
    }
} 
```

或者，您可以在代码块中执行**=a{**，而不是将自己定位在 { 字符上。

* * *

## 回答 #19

> 赞同：47
> 
> 时间：2009-04-07T18:40:23.813

这是用不同的编码重新打开当前文件的好技巧：

```
:e ++enc=cp1250 %:p 
```

当您必须使用旧编码时很有用。支持的编码列在`encoding-values`（参见 参考资料`help` `encoding-values`）下的表中。类似的事情也适用于`++ff`，因此如果您第一次出错，您可以重新打开以 Windows/Unix 行结尾的文件（请参阅 参考资料`help` `ff`）。

* * *

## 回答 #20

> 赞同：41
> 
> 时间：2009-04-19T18:33:15.337

```
imap jj <esc> 
```

* * *

## 回答 #21

> 赞同：37
> 
> 时间：2009-04-07T18:03:21.373

让我们看看一些漂亮的小 IDE 编辑器做列转置。

```
:%s/\(.*\)^I\(.*\)/\2^I\1/ 
```

解释

`\(`并且`\)`是如何*记住*正则表达式中的东西。`\1`等等`\2`是如何检索记住的东西。

```
>>> \(.*\)^I\(.*\) 
```

记住所有内容，然后是`^I`（选项卡），然后是所有内容。

```
>>> \2^I\1 
```

用“你记得的第二件事”替换上面的东西，然后是“你记得的第一件事”——本质上是做一个转置。

* * *

## 回答 #22

> 赞同：31
> 
> 时间：2009-04-11T07:14:21.593

不完全是一个秘密，但我喜欢将以下映射放入我的 .vimrc 文件中，因此我可以随时点击“-”（减号）打开文件资源管理器以显示*与我刚刚编辑的文件相邻的*文件。在文件资源管理器中，我可以点击另一个“-”来向上移动一个目录，提供对复杂目录结构的无缝浏览（就像现在 MVC 框架使用的那些）：

```
map - :Explore<cr> 
```

这些可能对某人也有用。我喜欢同时滚动屏幕和前进光标：

```
map <c-j> j<c-e>
map <c-k> k<c-y> 
```

标签导航 - 我喜欢标签，我需要在它们之间轻松移动：

```
map <c-l> :tabnext<enter>
map <c-h> :tabprevious<enter> 
```

仅在 Mac OS X 上：类似 Safari 的标签导航：

```
map <S-D-Right> :tabnext<cr>
map <S-D-Left> :tabprevious<cr> 
```

* * *

## 回答 #23

> 赞同：29
> 
> 时间：2009-04-07T20:11:12.033

通常，我喜欢在编辑时更改当前目录 - 所以我必须少指定路径。

```
cd %:h 
```

* * *

## 回答 #24

> 赞同：27
> 
> 时间：2009-06-12T05:54:59.633

我喜欢使用“sudo bash”，我的系统管理员讨厌这个。他锁定了“sudo”，因此它只能与少数命令（ls、chmod、chown、vi 等）一起使用，但无论如何我都能使用 vim 获得 root shell：

```
bash$ sudo vi +'silent !bash' +q
Password: ******
root# 
```

* * *

## 回答 #25

> 赞同：26
> 
> 时间：2009-04-07T21:11:26.320

当我处理一个项目时，我经常使用很多窗口，有时我需要调整它们的大小。这是我使用的：

```
map + <C-W>+
map - <C-W>- 
```

这些映射允许增加和减少当前窗口的大小。这很简单，但速度很快。

* * *

## 回答 #26

> 赞同：24
> 
> 时间：2011-03-04T02:20:57.050

不是一个不起眼的功能，但非常有用且节省时间。

如果要保存打开的缓冲区、选项卡、标记和其他设置的会话，可以发出以下命令：

```
mksession session.vim 
```

您可以使用以下命令打开会话：

```
vim -S session.vim 
```

* * *

## 回答 #27

> 赞同：24
> 
> 时间：2009-05-06T07:38:25.990

```
:r! <command> 
```

将外部命令的输出粘贴到缓冲区中。

做一些数学运算，直接在文本中得到结果：

```
:r! echo $((3 + 5 + 8)) 
```

在编写 Makefile 时获取要编译的文件列表：

```
:r! ls *.c 
```

不要查找您在维基百科上阅读的事实，将其直接粘贴到您正在编写的文档中：

```
:r! lynx -dump http://en.wikipedia.org/wiki/Whatever 
```

* * *

## 回答 #28

> 赞同：21
> 
> 时间：2009-07-08T19:19:08.073

将 F5 映射到快速 ROT13 您的缓冲区：

```
map <F5> ggg?G`` 
```

您可以将其用作老板键:)。

* * *

## 回答 #29

> 赞同：20
> 
> 时间：2009-04-29T18:56:49.773

我几乎使用 vim 进行任何文本编辑，所以我经常使用复制和粘贴。问题是 vim 默认情况下经常会通过粘贴扭曲导入的文本。阻止这种情况的方法是使用

```
:set paste 
```

在粘贴您的数据之前。这将防止它搞砸。

请注意，您必须发出`:set nopaste`才能恢复自动缩进。粘贴预格式化文本的替代方法是剪贴板寄存器（`*`和`+`），和`:r!cat`（您必须用 ^D 结束粘贴的片段）。

有时打开高对比度配色方案也很有帮助。这可以通过

```
:color blue 
```

我注意到它不适用于我使用的所有版本的 vim，但它适用于大多数版本。

* * *

## 回答 #30

> 赞同：19
> 
> 时间：2009-05-11T21:59:04.003

我今天刚刚通过[NSFAQ](http://notfaq.wordpress.com/2006/07/28/vim-comment-blocks-of-code/)找到了这个：

注释代码块。

按 CTRL-V 进入 Blockwise Visual 模式。

标记您要评论的块。

点击 I（大写 I）并在行首输入您的注释字符串。(// 对于 C++)

点击 ESC 并且所有选择的行都将在行的前面加上 //。

* * *

## 回答 #31

> 赞同：12
> 
> 时间：2009-06-05T19:10:57.123

Ctrl-n 在插入模式下将根据打开缓冲区中的所有单词自动完成您输入的任何单词。如果有多个匹配项，它将为您提供一个可能的单词列表，您可以使用 ctrl-n 和 ctrl-p 循环遍历这些单词。

* * *

## 回答 #32

> 赞同：11
> 
> 时间：2009-04-07T22:29:44.697

这里有一些不明显的东西。如果您的 $HOME 中有很多自定义插件/扩展，并且有时需要从 su / sudo / ... 工作，那么这可能很有用。

在你的 ~/.bashrc 中：

`export VIMINIT=":so $HOME/.vimrc"`

在你的 ~/.vimrc 中：

```
`if $HOME=='/root'
        if $USER=='root'
                if isdirectory('/home/your_typical_username')
                        let rtuser = 'your_typical_username'
                elseif isdirectory('/home/your_other_username')
                        let rtuser = 'your_other_username'
                endif
        else
                let rtuser = $USER
        endif
        let &runtimepath = substitute(&runtimepath, $HOME, '/home/'.rtuser, 'g')
endif`
```

`它将允许您的本地插件加载 - 无论您使用什么方式来更改用户。`

 `您可能还想将 *.swp 文件从当前路径中取出并放入 ~/vimtmp（进入 .vimrc）：

```
`if ! isdirectory(expand('~/vimtmp'))
   call mkdir(expand('~/vimtmp'))
endif
if isdirectory(expand('~/vimtmp'))
   set directory=~/vimtmp
else
   set directory=.,/var/tmp,/tmp
endif` 
```

`此外，我使用一些映射来简化编辑 - 使 ctrl+s 像转义一样工作，并且 ctrl+h/l 切换选项卡：`

 ````
`inoremap <C-s> <ESC>
vnoremap <C-s> <ESC>
noremap <C-l> gt
noremap <C-h> gT`
```

* * *

 `## 回答 #33

> 赞同：11
> 
> 时间：2009-06-06T14:27:05.820

**想要一个 IDE？**

`:make`将在当前目录中运行 makefile，解析编译器输出，然后您可以使用`:cn`和`:cp`逐步检查编译器错误，打开每个文件并查找有问题的行号。

`:syntax on`打开 vim 的语法高亮。

* * *

## 回答 #34

> 赞同：10
> 
> 时间：2010-02-22T04:28:29.740

```
gg=G 
```

更正整个文件的缩进。我错过了我`<C-a><C-i>`在 Eclipse 中的信任，但发现 vim 可以很好地处理它。

* * *

## 回答 #35

> 赞同：10
> 
> 时间：2011-05-11T19:54:15.727

sudo write 的变体：

进入 .vimrc

```
cmap w!! w !sudo tee % >/dev/null 
```

重新加载 vim 后，您可以将“sudo save”作为

```
:w!! 
```

* * *

## 回答 #36

> 赞同：10
> 
> 时间：2011-03-24T22:44:40.250

能够在基于客户端/服务器的模式下运行 Vim。

例如，假设您正在处理一个项目，其中有很多缓冲区、选项卡和其他信息保存在名为 session.vim 的会话文件中。

您可以通过发出以下命令打开会话并创建服务器：

```
vim --servername SAMPLESERVER -S session.vim 
```

请注意，如果要创建服务器，则可以打开常规文本文件，并且不必一定是会话。

现在，假设您在另一个终端中并且需要打开另一个文件。如果您通过发出以下命令定期打开它：

```
vim new_file.txt 
```

您的文件将在单独的 Vim 缓冲区中打开，这很难与会话中的文件进行交互。为了在服务器上的新选项卡中打开 new_file.txt，请使用以下命令：

```
vim --servername SAMPLESERVER --remote-tab-silent new_file.txt 
```

如果没有服务器运行，该文件将像普通文件一样打开。

由于每次要运行它们时都提供这些标志非常繁琐，因此您可以创建一个单独的别名来创建客户端和服务器。

我在我的 bashrc 文件中放置了以下内容：

```
alias vims='vim --servername SAMPLESERVER'
alias vimc='vim --servername SAMPLESERVER --remote-tab-silent' 
```

您可以在以下位置找到更多信息：http: [//vimdoc.sourceforge.net/htmldoc/remote.html](http://vimdoc.sourceforge.net/htmldoc/remote.html)

* * *

## 回答 #37

> 赞同：9
> 
> 时间：2009-04-19T18:18:26.903

我经常想突出显示一个特定的单词/函数名称，但还不想搜索它的下一个实例：

```
map m* *# 
```

* * *

## 回答 #38

> 赞同：8
> 
> 时间：2009-04-07T23:11:04.193

HOWTO：在 Bash 中使用 Vim 时自动完成 Ctags。对于其他使用 Vim 和 Ctags 的人，我为 Bash 编写了一个小型自动完成功能。将以下内容添加到您的 ~/.bash_completion 文件中（如果不存在则创建它）：

感谢 stylepants 的许多修复和改进。

```
_vim_ctags() {
    local cur prev

    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    case "${prev}" in
        -t)
            # Avoid the complaint message when no tags file exists
            if [ ! -r ./tags ]
            then
                return
            fi

            # Escape slashes to avoid confusing awk
            cur=${cur////\\/}

            COMPREPLY=( $(compgen -W "`awk -vORS=" "  "/^${cur}/ { print \\$1 }" tags`" ) )
            ;;
        *)
            _filedir_xspec
            ;;
    esac
}

# Files matching this pattern are excluded
excludelist='*.@(o|O|so|SO|so.!(conf)|SO.!(CONF)|a|A|rpm|RPM|deb|DEB|gif|GIF|jp?(e)g|JP?(E)G|mp3|MP3|mp?(e)g|MP?(E)G|avi|AVI|asf|ASF|ogg|OGG|class|CLASS)'

complete -F _vim_ctags -f -X "${excludelist}" vi vim gvim rvim view rview rgvim rgview gview 
```

重新启动 Bash 会话（或创建一个新会话）后，您可以键入：

代码：

```
~$ vim -t MyC<tab key> 
```

它会像处理文件和目录一样自动完成标签：

代码：

```
MyClass MyClassFactory
~$ vim -t MyC 
```

当我开始快速修复错误时，我发现它非常有用。

* * *

## 回答 #39

> 赞同：7
> 
> 时间：2009-04-09T12:37:25.807

当您想在项目的两个不同副本之间区分文件而不磨损小指（从 project1 的根目录）时， % 也很好：

```
:vert diffs /project2/root/% 
```

* * *

## 回答 #40

> 赞同：7
> 
> 时间：2009-05-08T01:36:24.907

我什么都用 Vim。当我编辑电子邮件时，我使用：

`**gqap**`（或`**gwap**`）

广泛地在逐段的基础上轻松正确地重新格式化，即使使用引号前导字符也是如此。为了实现这个功能，我还添加了：

`-c 'set fo=tcrq' -c 'set tw=76'`

到命令以在外部调用编辑器。一个值得注意的补充是在 fo (formatoptions) 参数中添加“ **a ”。**这将在您键入和浏览内容时自动重新格式化段落，但**可能会**干扰或导致消息中包含的错误或奇怪的格式出现问题。

* * *

## 回答 #41

> 赞同：7
> 
> 时间：2009-07-08T19:07:42.607

> :setlocal 自动读取

自动重新加载当前缓冲区..在查看日志文件时特别有用，它几乎可以从 vim 中提供 unix 中“tail”程序的功能。

从 vim 中检查编译错误。根据语言设置 makeprg 变量让我们说 perl

> :setlocal makeprg = perl\ -c \ %

对于 PHP

> set makeprg=php\ -l\ %
> set errorformat=%m\ in\ %f\ on\ line\ %l

发出 ":make" 运行相关的 makeprg 并在 quickfix 窗口中显示编译错误/警告，并且可以轻松导航到相应的行号。

* * *

## 回答 #42

> 赞同：6
> 
> 时间：2009-04-19T18:35:13.430

把它放在你的 .vimrc 中有一个命令来漂亮打印 xml：

```
function FormatXml()
    %s:\(\S\)\(<[^/]\)\|\(>\)\(</\):\1\3\r\2\4:g
    set filetype=xml
    normal gg=G
endfunction

command FormatXml :call FormatXml() 
```

* * *

## 回答 #43

> 赞同：6
> 
> 时间：2009-04-09T12:53:15.160

从其十六进制值输入一个字符（插入模式）：

```
<C-Q>x[type the hexadecimal byte] 
```

* * *

## 回答 #44

> 赞同：6
> 
> 时间：2009-10-02T07:38:30.830

由于延迟和缺乏颜色（我喜欢配色方案：）我不喜欢在[PuTTY](http://en.wikipedia.org/wiki/PuTTY)中的远程机器上编程。所以我开发了这个技巧来解决这个问题。我在 Windows 上使用它。

**你会需要**

*   1x gVim
*   远程和本地机器上的 1x rsync
*   1x SSH 私钥对远程机器进行身份验证，因此您无需输入密码
*   1x[选美](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)
*   1x 腻子

**设置远程机器**

配置 rsync 以使您的工作目录可访问。我使用 SSH 隧道并且只允许来自隧道的连接：

```
address = 127.0.0.1
hosts allow = 127.0.0.1
port = 40000
use chroot = false
[bledge_ce]
    path = /home/xplasil/divine/bledge_ce
    read only = false 
```

然后启动 rsyncd： rsync --daemon --config=rsyncd.conf

**设置本地机器**

从 Cygwin 安装 rsync。启动 Pageant 并为远程机器加载你的私钥。如果您使用 SSH 调谐，请启动 PuTTY 来创建隧道。在您的工作目录中创建一个批处理文件 push.bat，它将使用 rsync 将更改的文件上传到远程机器：

```
rsync --blocking-io *.cc *.h SConstruct rsync://localhost:40001/bledge_ce 
```

SConstruct 是 scons 的构建文件。修改文件列表以满足您的需要。如果您不使用 SSH 调谐，请将 localhost 替换为远程机器的名称。

**配置 Vim** 现在很容易。我们将使用快速修复功能（:make 和错误列表），但编译将在远程机器上运行。所以我们需要设置makeprg：

```
set makeprg=push\ &&\ plink\ -batch\ xplasil@anna.fi.muni.cz\ \"cd\ /home/xplasil/divine/bledge_ce\ &&\ scons\ -j\ 2\" 
```

这将首先启动 push.bat 任务以上传文件，然后使用 SSH 在远程机器上执行命令（来自 PuTTY 套件的[Plink ）。](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)该命令首先将目录更改为工作目录，然后开始构建（我使用 scons）。

构建的结果会方便地显示在您本地的 gVim 错误列表中。

* * *

## 回答 #45

> 赞同：6
> 
> 时间：2009-08-20T12:21:53.330

```
==================================================== ========
在正常模式下
==================================================== ========
gf ................ 在同一窗口中打开光标下的文件 --> 查看 :h 路径
Ctrl-w f .......... 在新窗口中打开光标下的文件
Ctrl-w q .......... 关闭当前窗口
Ctrl-w 6 .......... 打开备用文件 --> 见 :h #
gi ................ 在最后一个插入位置初始化插入模式
'0 ...... 将光标放在文件最后一次编辑时的位置

```

* * *

## 回答 #46

> 赞同：6
> 
> 时间：2009-05-08T01:54:44.897

我确信有人已经发布了这个，但是这里有。

采用任何你喜欢的构建系统；make, mvn, ant, 随便什么。在项目目录的根目录中，创建一个包含您一直使用的命令的文件，如下所示：

mvn install
mvn clean install
... 等等

要进行构建，请将光标放在该行上并键入 !!sh。即过滤该行；将其写入外壳并替换为结果。

构建日志替换了行，准备滚动、搜索等等。

查看完日志后，键入 u 撤消，然后您将返回命令文件。

* * *

## 回答 #47

> 赞同：5
> 
> 时间：2011-07-12T12:21:24.057

`set colorcolumn=+1`或者`set cc=+1`对于 vim 7.3

* * *

## 回答 #48

> 赞同：5
> 
> 时间：2010-01-19T00:26:07.960

几个有用的：

```
:set nu # displays lines
:44     # go to line 44
'.      # go to last modification line 
```

我最喜欢的：`Ctrl`+`n`单词完成！

* * *

## 回答 #49

> 赞同：4
> 
> 时间：2009-09-15T20:18:16.863

在复制并粘贴到 stackoverflow 之前：

```
:retab 1
:% s/^I/ /g
:% s/^/    / 
```

现在复制并粘贴代码。

根据评论中的要求：

retab 1\. 这会将标签大小设置为 1。但它也遍历代码并添加额外的制表符和空格，以便格式不会移动任何实际文本（即文本在 ratab 之后看起来相同）。

% s/^I/ /g：注意 ^I 是点击制表符的结果。这将搜索所有选项卡并将它们替换为单个空格。由于我们只是做了一个 retab，这不应该导致格式改变，但是由于将标签放入网站会被击中并错过它，最好删除它们。

%s/^/ /：用四个空格替换行首。由于您实际上不能用任何内容替换行首，因此它会在行首插入四个空格（SO 格式化需要这样做以使代码脱颖而出）。

* * *

## 回答 #50

> 赞同：4
> 
> 时间：2009-08-06T09:33:01.673

`:sp %:h`- 目录列表/文件选择器使用当前文件的目录

（属于rampion的`cd`提示下的评论，但我还没有评论权）

* * *

## 回答 #51

> 赞同：4
> 
> 时间：2009-12-28T09:21:01.443

在处理构建过程缓慢的项目时，我总是在后台构建并将输出通过管道传输到名为 errors.err 的文件（类似于`make debug 2>&1 | tee errors.err`）。这使我可以在构建过程中继续编辑或查看源代码。准备就绪后（在 GTK 上使用 pynotify 通知我它已完成），我可以使用[quickfix](http://vimdoc.sourceforge.net/htmldoc/quickfix.html#quickfix)在 vi​​m 中查看结果。首先发出 :cf[ile] 读取错误文件并跳转到第一个错误。我个人喜欢使用 cwindow 在单独的窗口中获取构建结果。

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2011-01-12T15:22:06.153

## 地图宏

我经常发现动态定义一些键映射很有用，就像定义一个宏一样。这里的转折是，映射是*递归*的，并且一直执行到失败为止。

例子：

```
enum ProcStats
{
        ps_pid,
        ps_comm,
        ps_state,
        ps_ppid,
        ps_pgrp,
:map X /ps_<CR>3xixy<Esc>X 
```

给出：

```
enum ProcStats
{
        xypid,
        xycomm,
        xystate,
        xyppid,
        xypgrp, 
```

只是一个愚蠢的例子:)。

我完全意识到所有的缺点——碰巧我发现它在某些场合相当有用。在工作中观看它也会很有趣；）。

* * *

## 回答 #53

> 赞同：3
> 
> 时间：2011-03-17T20:41:47.670

在插入模式下，`ctrl`+ `x`，`ctrl`+`p`将完成（如果您喜欢的话，可以使用可能的完成菜单）您正在输入的当前长标识符。

```
if (SomeCall(LONG_ID_ <-- type c-x c-p here
            [LONG_ID_I_CANT_POSSIBLY_REMEMBER]
             LONG_ID_BUT_I_NEW_IT_WASNT_THIS_ONE
             LONG_ID_GOSH_FORGOT_THIS
             LONG_ID_ETC
             ∶ 
```

* * *

## 回答 #54

> 赞同：3
> 
> 时间：2009-04-24T13:36:44.687

我喜欢 :ls 命令。

* * *

## 回答 #55

> 赞同：3
> 
> 时间：2009-05-11T04:39:04.767

为了让 vim 更像一个 IDE 编辑器：

*   设置 nu - 用于左边距中的行号。
*   set cul - 突出显示包含光标的行。

* * *

## 回答 #56

> 赞同：3
> 
> 时间：2009-09-13T18:29:22.463

以下都不是真正的顽固，但我发现它非常有用。

琐碎的绑定，但我不能没有。它在插入模式下启用 hjkl 样式的移动（使用 ctrl 键）。在正常模式下： ctrl-k/j 向上/向下滚动半个屏幕， ctrl-l/h 进入下一个/上一个缓冲区。µ 和ù 映射特别适用于AZERTY 键盘并转到下一个/上一个错误。

```
imap <c-j> <Down>
imap <c-k> <Up>
imap <c-h> <Left>
imap <c-l> <Right>
nmap <c-j> <c-d>
nmap <c-k> <c-u>
nmap <c-h> <c-left>
nmap <c-l> <c-right>

nmap ù :cp<RETURN>
nmap µ :cn<RETURN> 
```

我编写的一个小函数，用于突出显示函数、全局变量、宏、结构和 typedef。（在非常大的文件上可能会很慢）。每种类型都有不同的突出显示（参见 ":help group-name" 以了解当前颜色主题的设置） 用法：用 ww 保存文件（默认为 "\ww"）。为此，您需要 ctags。

```
nmap <Leader>ww :call SaveCtagsHighlight()<CR>

"Based on: http://stackoverflow.com/questions/736701/class-function-names-highlighting-in-vim
function SaveCtagsHighlight()
    write

    let extension = expand("%:e")
    if extension!="c" && extension!="cpp" && extension!="h" && extension!="hpp"
        return
    endif

    silent !ctags --fields=+KS *
    redraw!

    let list = taglist('.*')
    for item in list
        let kind = item.kind

        if     kind == 'member'
            let kw = 'Identifier'
        elseif kind == 'function'
            let kw = 'Function'
        elseif kind == 'macro'
            let kw = 'Macro'
        elseif kind == 'struct'
            let kw = 'Structure'
        elseif kind == 'typedef'
            let kw = 'Typedef'
        else
            continue
        endif

        let name = item.name
        if name != 'operator=' && name != 'operator ='
            exec 'syntax keyword '.kw.' '.name
        endif
    endfor
    echo expand("%")." written, tags updated"
endfunction 
```

我有编写大量代码和函数的习惯，我不喜欢为它们编写原型。所以我做了一些函数来在 C 风格的源文件中生成一个原型列表。它有两种风格：一种删除形式参数的名称，另一种保留它。每次需要更新原型时，我都会刷新整个列表。它避免了原型和函数定义不同步。还需要ctags。

```
"Usage: in normal mode, where you want the prototypes to be pasted:
":call GenerateProptotypes()
function GeneratePrototypes()
    execute "silent !ctags --fields=+KS ".expand("%")
    redraw!
    let list = taglist('.*')
    let line = line(".")
    for item in list
        if item.kind == "function"  &&  item.name != "main"
            let name = item.name
            let retType = item.cmd
            let retType = substitute( retType, '^/\^\s*','','' )
            let retType = substitute( retType, '\s*'.name.'.*', '', '' ) 

            if has_key( item, 'signature' )
                let sig = item.signature
                let sig = substitute( sig, '\s*\w\+\s*,',        ',',   'g')
                let sig = substitute( sig, '\s*\w\+\(\s)\)', '\1', '' )
            else
                let sig = '()'
            endif
            let proto = retType . "\t" . name . sig . ';'
            call append( line, proto )
            let line = line + 1
        endif
    endfor
endfunction

function GeneratePrototypesFullSignature()
    "execute "silent !ctags --fields=+KS ".expand("%")
    let dir = expand("%:p:h");
    execute "silent !ctags --fields=+KSi --extra=+q".dir."/* "
    redraw!
    let list = taglist('.*')
    let line = line(".")
    for item in list
        if item.kind == "function"  &&  item.name != "main"
            let name = item.name
            let retType = item.cmd
            let retType = substitute( retType, '^/\^\s*','','' )
            let retType = substitute( retType, '\s*'.name.'.*', '', '' ) 

            if has_key( item, 'signature' )
                let sig = item.signature
            else
                let sig = '(void)'
            endif
            let proto = retType . "\t" . name . sig . ';'
            call append( line, proto )
            let line = line + 1
        endif
    endfor
endfunction 
```

* * *

## 回答 #57

> 赞同：3
> 
> 时间：2011-01-12T14:32:03.393

**重用**

与其他命令混合的动作，更多[在这里](http://jmcpherson.org/editing.html)。

```
tx
fx
Fx 
```

在 Vim 中使用您最喜欢的工具。

```
:r !python anything you want or awk or Y something 
```

在视觉模式下重复，结合上述提示时功能强大。

```
; 
```

* * *

## 回答 #58

> 赞同：3
> 
> 时间：2011-06-29T16:05:50.133

```
In Insert mode 
<C-A>   - Increments the number under cursor 
<C-X>   - Decrements the number under cursor 
```

如果我们想在 vim 中生成连续数字，这将非常有用假设我们
是否要插入数字从 1 到 10 的第 1-10 行 [比如第一行的“1”，第二行的“2”..]
插入第一行的“0”并复制该行并过去9次，以便所有行都显示“0”。

运行以下 Ex 命令

```
:g/^/exe "norm " . line(".") . "\<C-A>" 
```

* * *

## 回答 #59

> 赞同：2
> 
> 时间：2009-11-24T20:21:01.600

这些年来我收集了这些。

```
" Pasting in normal mode should append to the right of cursor
nmap <C-V>      a<C-V><ESC>
" Saving
imap <C-S>      <C-o>:up<CR>
nmap <C-S>      :up<CR>
" Insert mode control delete
imap <C-Backspace> <C-W>
imap <C-Delete> <C-O>dw
nmap    <Leader>o       o<ESC>k
nmap    <Leader>O       O<ESC>j
" tired of my typo
nmap :W     :w 
```

* * *

## 回答 #60

> 赞同：2
> 
> 时间：2009-04-27T13:06:44.920

全部替换

```
 :%s/oldtext/newtext/igc 
```

给一个替换所有:)

* * *

## 回答 #61

> 赞同：2
> 
> 时间：2009-04-22T16:41:05.863

使用鼠标右键在 gVim 中切换插入模式，并在 ~/.gvimrc 中进行以下设置：

```
"
"------------------------------------------------------------------
" toggle insert mode <--> 'normal mode with the <RightMouse>-key
"------------------------------------------------------------------
nnoremap  <RightMouse> <Insert>
inoremap  <RightMouse> <ESC>
" 
```

* * *

## 回答 #62

> 赞同：2
> 
> 时间：2009-08-20T18:55:48.970

尝试使用普通模式命令`perltidy`进行格式化`=`

```
:set equalprg=perltidy 
```

* * *

## 回答 #63

> 赞同：2
> 
> 时间：2010-05-10T15:01:43.753

创建一个函数来使用它的 shebang 执行当前缓冲区（假设设置了一个）并使用 crtl-x 调用它。

```
map <C-X> :call CallInterpreter()<CR>

au BufEnter *
\ if match (getline(1) , '^\#!') == 0 |
\   execute("let b:interpreter = getline(1)[2:]") |
\ endif

fun! CallInterpreter()
    if exists("b:interpreter")
        exec("! ".b:interpreter." %")
    endif
endfun 
```

* * *

## 回答 #64

> 赞同：2
> 
> 时间：2011-04-05T18:43:08.820

要将文本从 Vim 复制到剪贴板以供其他应用程序使用，请在可视模式下选择要复制的文本，然后按“+y”。这样，您可以轻松地将文本粘贴到其他应用程序。

如果您已垂直拆分窗口并且想要从右侧窗口复制某些内容，这将特别有用。使用 set mouse=r 对这种情况没有帮助，因为它也会选择左侧窗口中的所有内容。

请注意，您的 vim 必须使用 xterm 支持进行编译。

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2009-07-02T16:22:19.777

映射以使移动以环绕模式在当前屏幕行上运行。前段时间我在 Vim 技巧的评论中发现了这一点，事实证明它非常方便。

```
function! ScreenMovement(movement)
  if &wrap
    return "g" . a:movement
  else
    return a:movement
  endif
endfunction
onoremap <silent> <expr> j ScreenMovement("j")
onoremap <silent> <expr> k ScreenMovement("k")
onoremap <silent> <expr> 0 ScreenMovement("0")
onoremap <silent> <expr> ^ ScreenMovement("^")
onoremap <silent> <expr> $ ScreenMovement("$")
nnoremap <silent> <expr> j ScreenMovement("j")
nnoremap <silent> <expr> k ScreenMovement("k")
nnoremap <silent> <expr> 0 ScreenMovement("0")
nnoremap <silent> <expr> ^ ScreenMovement("^")
nnoremap <silent> <expr> $ ScreenMovement("$") 
```

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2009-05-06T16:08:49.820

我的一些必备品是：

cscope + ctags + vim，可以在网上找到。

一些用于快速启动新代码文件的缩写，例如：

```
ab cpph #include <iostream><CR>#include <string><CR>#include <cstdlib><CR>#include <cassert><CR>#include <vector><CR>#include <
stdexcept><CR>using namespace std;<CR>int main(int argc, char *argv[]) {
ab perlh #!/usr/bin/perl<CR>use strict;<CR>use warnings;<CR>
ab chdr #include <stdio.h><CR>#include <sys/types.h><CR>#include <unistd.h><CR>#include <stdlib.h><CR>#include <sys/stat.h><CR>
#include <sys/wait.h><CR>#include <string.h><CR>int main(int argc, char *argv[]) {
ab xhtmlhdr <?xml version="1.0" encoding="UTF-8"?><CR><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.o
rg/TR/xhtml1/DTD/xhtml1-strict.dtd"><CR><html xmlns="http://www.w3.org/1999/xhtml"><CR>  <head><CR>  <title></title><CR><link h
ref="style.css" rel="STYLESHEET" type="text/css"><CR></head> 
```

例如 cpph 将插入 main.cc 文件的基本骨架

还有我的功能键映射：

```
map <F1> <Esc>:w<CR>:perl $e = `./error.pl`; my ($f,$l,@w) = split(":",$e); my $w=join(":",@w); $curwin->Cursor($l,0); VIM::Msg($w);<CR>
map <F2> :wincmd w<CR>
map <F3> :wincmd s<CR>
map <F4> :wincmd v<CR>
map <F5> :wincmd o<CR>
map <F6> :sball<CR>
map <F7> :wq<CR>
map <F8> :wincmd q<CR>
map <F9> :wincmd -<CR>
map <F10> :wincmd +<CR>
map <F11> :wincmd <<CR>
map <F12> :wincmd ><CR> 
```

在这种情况下，我的 F1 被映射为将光标放在下一个需要纠正以进行源代码迁移的错误上。

```
map _ ebi"^[ea"^[ 
```

这张地图将使 _ 引用一个字符串

* * *

## 回答 #67

> 赞同：1
> 
> 时间：2009-08-11T13:29:45.547

根据这个[线程](https://stackoverflow.com/questions/1174274/how-can-i-prepend-text-to-multiple-lines-in-vim)

为了给一组行添加前缀，我使用两种不同的方法之一：

一种方法是块选择（由某物提到）。通常，您可以使用 ctrl-V 后跟光标移动来选择一个矩形区域。突出显示一个矩形后，按 shift-I 将在矩形的左侧插入字符，或者按 shift-A 将它们附加到矩形的右侧。因此，您可以使用此技术制作一个矩形，其中包含要添加前缀的行的最左侧列，按 shift-I，键入前缀，然后按转义键。

另一种方法是使用替换（如 Brian Agnew 所述）。Brian 的替换将影响整个文件（命令中的 % 表示“所有行”）。要仅影响几行，最简单的方法是在第一行/最后一行时按 shift-V（启用可视行模式），然后移动到最后/第一行。然后输入：

:s/^/你的前缀/

^ 是一个正则表达式（在本例中为行首）。通过在可视行模式下键入此内容，您将看到 '<,'> 自动插入到 s 之前。这意味着替换的范围将是视觉选择。

额外提示：如果您的前缀包含斜杠，您可以使用反斜杠对其进行转义，或者您可以使用不同的标点符号作为命令中的分隔符。例如，要添加 C++ 行注释，我通常会这样写：

:s:^:// :

对于添加后缀，替换方法通常更容易，除非所有行的长度完全相同。只需将 $ 用于模式而不是 ^ ，您的字符串将被附加而不是预先附加。

如果要同时添加前缀和后缀，可以执行以下操作：

:s/.*/前缀和后缀/

.* 匹配整行。替换中的 & 将匹配的文本（整行）放回原处，但现在它将添加您的前缀和后缀。

顺便说一句：注释掉代码时，您可能希望稍后取消注释。您可以使用视觉块（ctrl-V）选择斜杠，然后按 d 删除它们，或者您可以使用替换（可能使用视线选择，使用 shift-V）来删除前导斜杠，像这样：

:s://::

* * *

## 回答 #68

> 赞同：1
> 
> 时间：2009-08-13T10:50:24.440

我正在使用宏而不是搜索 - 将宏与可视模式结合起来有时更有效。

* * *

## 回答 #69

> 赞同：1
> 
> 时间：2011-07-12T10:49:15.160

我想在[`after-directory`](http://vimdoc.sourceforge.net/htmldoc/options.html#after-directory). 它对[`ftplugin`](http://vimdoc.sourceforge.net/htmldoc/usr_41.html#ftplugin).

您可以避免在 .vimrc 文件中编写一长串 augroup ，而不是为每种类型编写单独的文件。

但是，很明显，.vim/ftplugin 目录与 .vim/after/ftplugin 做同样的事情，但我更愿意将 .vim 目录留给 vim 插件。

* * *

## 回答 #70

> 赞同：1
> 
> 时间：2010-09-04T04:13:11.883

我最喜欢在窗口之间来回切换的食谱：

```
function! SwitchPrevWin()
    let l:winnr_index = winnr()
    if l:winnr_index > 1
       let l:winnr_index -= 1
    else
       "set winnr_index to max window open
        let l:winnr_index = winnr('$')
    endif
    exe l:winnr_index . "wincmd w" 
endfunction 
```

* * *

```
nmap <M-z> :call SwitchPrevWin()
imap <M-z> <ESC>:call SwitchPrevWin() 
```

* * *

```
nmap <C-z> :wincmd w
imap <C-z> <ESC>:wincmd w 
```

# apache-flex - 远程对象不适用于模块

> ID：726902
> 
> 赞同：1
> 
> 时间：2009-04-07T17:59:08.560
> 
> 标签：apache-flex, amf

我们有一些模块在 remoting-config.xml 中配置了自己的远程对象。每个都打包并部署为单独的 Web 档案 (WAR)。例如。模块1.war，模块2.war。

我们正在尝试将它们集成到部署在单独的 Web 应用程序中的 flex 应用程序中。例如。MainApp.war。

从 Module1.war 和 Module2.war 中调用远程对象时可以正常工作。但是当从主 flex 应用程序 MainApp.war 调用时，不会调用 java 远程对象。

我看过 Flex Developers guide 和 flexcoders Yahoo group。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T05:18:19.457

你是如何配置你的远程对象的？您是否在“-services”编译器标志中传递了 services-config.xml 的路径？如果您是，我会避免这样做，因为它不会给您提供服务端点位置的很大灵活性。

Christophe Coenraets 有一篇很棒的文章，介绍了在 Flex 中配置 RemoteObject 和其他数据访问类的最佳实践。总体思路是将 URL 外部化为 XML 配置文件，在应用程序启动时使用 HTTPService 加载该文件，然后使用 URL 配置绑定到 RemoteObject 中的 Channel/ChannelSet。全文在这里：

[http://coenraets.org/blog/2009/03/externalizing-service-configuration-using-blazeds-and-lcds/](http://coenraets.org/blog/2009/03/externalizing-service-configuration-using-blazeds-and-lcds/)

# java - F5 irule 与 RESTful 服务

> ID：726907
> 
> 赞同：0
> 
> 时间：2009-04-07T18:00:49.647
> 
> 标签：java, tomcat, rest

我试图在我们的 F5 上提出一个规则，以适当地将流量引导到我们的 Tomcat 服务器。我们正在为每个 RESTful 服务部署单独的 WAR 文件。因此，我们希望以以下 URI 为例：

/services/quiz/01234/ /services/user/54321/

其中 'quiz' 和 'user' 分别是 quiz.war 和 user.war。我们希望将 F5 级别的流量定向到 /services/ 作为根，并将 URI 的其余部分定向到 Tomcat 服务器。

我们如何做到这一点？

* * *

## 编辑

资源的浏览器 url 看起来像[http://www.domain.com/services/quiz/01234/](http://www.domain.com/services/quiz/01234/)

我希望 BIG-IP 将请求发送到 tomcat 作为[http://tomcatserver:8080/quiz/01234/](http://tomcatserver:8080/quiz/01234/)

所以基本上删除 /services 并将其后的所有内容附加到 tomcat 域。我认为这将是一个简单的正则表达式，对吧？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T23:52:43.110

我对我的 iRules 有点生疏，但我认为这些方面的东西会起作用：

```
when HTTP_REQUEST {
  set path [HTTP::path]
  regsub "^/services/" $path "/" path
  HTTP::path $path
} 
```

请注意，对“/services”（没有尾部斜杠）的请求将按原样传递，而对“/services/”（带有尾部斜杠但没有应用程序）的请求将转到根应用程序。我不确定如何处理这些退化的情况；您可能想要更改此行为。

顺便说一句，[DevCentral](http://devcentral.f5.com/)有一个很棒的社区，致力于帮助人们使用这些 iRules。

# .net - Linq over 存储过程

> ID：726908
> 
> 赞同：6
> 
> 时间：2009-04-07T18:01:13.580
> 
> 标签：.net, database, linq, stored-procedures

在存储过程上使用 linq 有哪些优点和缺点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T18:15:21.220

由于没有人添加 CON - 我会在这里推荐一个...

存储过程使您能够拒绝对基表和视图进行选择/插入/删除/更新，因此您可以使用存储过程获得更好的安全性，就像使用 Linq to SQL 一样。通过仅在您的 proc 上授予 exec 权限，您可以管理更小的表面区域以确保安全。

当然——你仍然可以同时使用 Linq to SQL 和存储过程——也许这会是更好的选择。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T18:21:38.943

LINQ 是对 .Net 框架的一个很好的补充，但它确实有它的局限性。到目前为止，LINQ 还不支持所有的 SQL 语法（尽管我确信他们正在研究它）。此外，对于 LINQ，没有一种简洁的方法可以让它处理多个表并只为我们提供所需的数据。使用 LINQ，您必须检索所有数据，然后保留您想要的数据并丢弃其余数据，从而传输比实际需要更多的数据，这是一个性能问题。

如果您所做的只是简单的 INSERT、UPDATE 和 DELETE 语句 LINQ 是可行的方法（在我看来）并且所有优化都为您完成，对于更复杂的工作我会说坚持使用存储过程。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-07T18:10:00.470

从我的角度来看，存储过程的主要价值已经被 LINQToSQL 消除了。长期以来，使用存储过程的关键价值在于将 SQL 封装成一种您自然会使用参数化查询的形式。这为开发人员在 SQL 注入方面提供了一层安全保障。由于默认情况下 LINQToSQL 查询是参数化的，我发现我对存储过程的使用已大大减少。

这并不是说仍然没有它们的位置，但现在我觉得你应该只在它们为参数化 LINQ 查询提供显着价值时才使用它们，因为它们可以降低复杂性或提高性能，这可能是因为服务器的能力以优化程序。我觉得消除对存储过程的过度依赖会导致代码库更易于维护，因为大多数代码都位于您的 IDE 中，而不是在数据库和 IDE 之间拆分。

请注意，您仍然可以将存储过程与 LINQToSQL 一起使用。我只是觉得这样做没有多大价值。实际上，我想不出我在切换到 LINQToSQL 后编写的单个存储过程，尽管我已经编写了一些表值函数来执行特定的搜索。这些被放到我的 DataContext 上并显示为我可以调用的方法，以使用该函数从数据库中获取适当的实体。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-05T03:21:45.357

我想在讨论中添加一些内容：

*   与存储过程相比，Linq 不太可能命中 SQL Server 中的缓存执行计划。虽然基本选择语句的编译很轻，但在更复杂的查询中编译可能非常昂贵。（*根据您的情况，很多因素都会使此陈述为真/假*，但这可能是针对不同的帖子）。

*   如果您有偏斜的数据，重新编译实际上可能是一个好处，可以防止 SQL 做出奇怪的索引使用决策。想想 `select * FROM Person where LastName = @Letter` 第一遍`@Letter='Z'`（假设总人数的 0.25%）与`@Letter='S'`（总人数的 6.00%）可能会导致完全不同的执行计划。

*   Linq 正在有效地将 ad hoc sql 重新引入我们的代码中。通过抽象层和新语言授予它，但我不再调用， `exec GetOrders @DateStart=@now @DayRange=7` 而是写出我的表名、where 子句和 order by。

*   将非执行 SQL 语句回溯到生成语句的代码比使用 SP 更困难。在大容量环境中，SQL 分析器通常会定期运行以查找非性能查询（高 CPU、读取或持续时间）。由于 Linq 对它生成的文本进行了抽象，因此很难将 sql 追溯到代码中的特定位置，尤其是在大型应用程序中。

*   附带说明一下，必要时 Linq 可以调用特定的存储过程，而不是生成它自己的 SQL。请参阅此[Scott Gu 文章](http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T18:04:47.563

我假设您的意思是*LINQ to SQL*，因为 LINQ 和存储过程是两个非常不同的东西。

*使用任何* [ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)的主要原因之一是提高开发速度。每当您有一个将为您创建查询的组件时，您必须自己编写一个更少的事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T18:39:49.180

前几天我在这里和某人讨论过这个问题，因为我们目前对所有数据库访问都使用存储过程。我们一般都在讨论 LINQ，以及 LINQ to SQL 的实现、IQueryable 等。她很快意识到将 LINQ 与存储过程一起使用充其量是多余的，而在最坏的情况下则很困难。

LINQ to SQL 的优点是代码在一个地方，数据库中发生的事情非常清楚。此外，开发时间可以更短，主要取决于流程，因为要制作的工作产品更少。

在我看来，Sprocs 的优势也是双重的。存储过程为 DBA 提供了更好的访问控制，因为它们可以在部署之前检查存储过程，并允许应用程序仅使用访问来执行存储过程，而不是对所需的所有表进行读/写访问。这可以更好地审查数据库争用和性能问题。我看到的另一个优点是，虽然 LINQ to SQL 将生成正确的查询，但在复杂查询的情况下，有时您会遇到导致数据库端优化不佳的情况。在这些情况下，您要么重写查询，要么向优化器提供提示，这两者都很难/不可能/隐喻破坏 LINQ。

也许是我的 DBA（不是 DBA，但曾经是），但在处理大型高事务负载 DB 并且不确切知道系统将执行的每条可能语句时，我感到非常*紧张*。所以我自己坚持使用sprocs。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-19T09:16:26.457

我不明白为什么关于这个主题的每次讨论似乎都假设编写 SQL 很难，而编写 linq 查询则不然。虽然简单的 linq 确实很简单，但只要您想编写一个访问大量表的查询，并使用复杂的外部连接，它就会变得非常混乱。不仅如此，我不知道底层引擎将如何呈现我的查询，如果它不起作用，则很难调试。

我发现快速编写一段复杂的 SQL 比在 linq 中做同样的事情要容易 100 倍（当然，我是和这个一起长大的，但我肯定不是唯一的）。

如果我需要调整它，并且它在一个存储过程中，那么我只需调整它并发布一个新的存储过程。我不必对应用程序进行完整构建，因为代码已嵌入其中。

如果它表现不佳，我可以处理查询，直到它表现良好。

然而，关于 linq 的每个演示文稿都说您不再需要学习 SQL。然而，SQL 是一种很好理解的成熟语言。地狱，我宁愿我可以将 SQL 直接放入我的 C# 代码中，而不必学习新的语法。

即使是跨数据库访问的理论“如果我在 linq 中编写它，我就可以使用我想要的任何数据库”对我来说并不感兴趣，特别是如果我正在编写，比如 SQL Azure，我确切地知道它将是什么数据库.

所以这就是我对这个主题的咆哮（这已经有一段时间了！！）。我会去存储过程。如果您希望它类型安全，则将结果加载到定义明确的业务对象中，或者如果您愿意，可以将 linq 加载到 sql 实体中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-10T19:51:47.630

我在我的项目中广泛使用 LINQ-to-SQL，并且发现它在几乎所有情况下的性能都与 SP 一样好。

毫无疑问，在某些情况下，使用 LINQ-to-SQL 会失去性能/能力：

*   由于使用 LINQ 将查询封装在代码中，因此您不能使用 SQL 的内置查询优化器/索引优化器工具（很容易）。跟踪执行计划之类的事情也需要额外的步骤（获取生成的 sql）。我猜很微不足道。

*   如果您遇到带宽非常低的情况，则通过网络发送参数化查询的额外文本将比仅发送存储过程调用消耗更多的带宽。因此，如果您正在编写一个通过调制解调器连接进行通信的 Windows 应用程序，这可能比 Web 应用程序（服务器彼此相邻）更令人担忧，或者如果您处于非常高使用率的情况.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-02-18T15:53:54.920

模块化呢？

我在 LINQ-to-SQL 中发现的一件事是，如果出现错误，我们可能需要重新编译和重新部署整个应用程序（或者只是受影响的 DLL），但是对于存储过程，我只需要修复一个存储过程我的工作完成了。

在我看来，LINQ 感觉更临时，而存储过程感觉更正式。

同样，我确实喜欢 LINQ 和随之而来的功能......但在 LINQ-TO-SQL 上并没有完全出售。

# c# - 如何使用 Linq-to-SQL 上的单个查询比较来自不同表的值？

> ID：726909
> 
> 赞同：1
> 
> 时间：2009-04-07T18:01:32.237
> 
> 标签：c#, .net, linq, linq-to-sql, select

我正在尝试优化的带有两个 Linq-to-SQL 查询的代码如下：

```
 var maxAInstant =
            (
                from a in db.As
                select a.Instant
            )
            .Max();
        var maxBInstant =
            (
                from b in db.Bs
                select b.instant
            )
            .Max();
        var interval = maxAInstant - maxBInstant;
        bool result = interval > new TimeSpan(0, 0, 1); 
```

我可以通过单个 Linq-to-SQL 查询获得结果吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T18:16:19.143

试试这个：

```
bool result = (db.As.Max(a => a.Instant) - db.Bs.Max(b => b.instant)) > new TimeSpan(0,0,1); 
```

# oop - 如何构造这个接口/继承

> ID：726913
> 
> 赞同：1
> 
> 时间：2009-04-07T18:01:48.023
> 
> 标签：oop, inheritance, interface

*   我有一个有方法的`File`类 `Open()`。
*   我有一个实现接口的`File`调用子类 ，它需要实现一个方法。`TextFile``IReadableFile``Read()`

如果我将变量声明`myFile`为`IReadableFile`，则无法对其调用该`Open()`方法。我希望能够一次使用`TextFile`基类 ( `File`) 方法及其接口 ( `IReadableFile`) 方法的功能。这可能吗？

**编辑：**我在 VB.NET 工作（如果重要的话）。

我试图通过 File 类提供最小的文件 I/O 功能集，然后通过从 File 派生并添加一些其他方法（如读取、写入等）来为特定类型的文件提供扩展功能。我希望派生类是多态的——例如，在 TextFile 上调用 Write 方法只会将文本数据写入文件系统，而在 BinaryFile 上调用 Write 方法可能会在将二进制数据写入文件系统之前对二进制数据进行 64 位编码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T18:05:04.083

创建一个IFile接口，使File类实现IFile。IReadableFile 将继承自 IFile。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T18:07:03.517

只有将 Open() 放入 IReadableFile 或将 IReadableFile 转换为 TextFile 时才有可能。

有关您正在做的事情的更多详细信息可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T18:34:43.123

您可以将 myFile 声明为 TextFile 对象。然后，您将能够调用 Read（从继承的 File 对象）和 Open（从实现的 IFileReadable 接口）。

```
Public Class File

  Public Sub Open()

  End Sub

End Class

Public Interface IFileReadable
  Sub Read()
End Interface

Public Class TextFile
  Inherits File
  Implements IFileReadable

  Public Sub Read() Implements IFileReadable.Read

  End Sub

End Class

Public Class Main

  Public Sub New()

    Dim oFile As TextFile
    oFile.Read()
    oFile.Open()

  End Sub

End Class 
```

# linux - ioctl 返回 -1 并将 errno 设置为 EPERM

> ID：726914
> 
> 赞同：1
> 
> 时间：2009-04-07T18:01:51.610
> 
> 标签：linux, linux-device-driver

*我有一个调用ioctl()*的 C 程序，但它返回 -1 并且*errno*设置为**EPERM**。但我已将该文件的模式更改为“777”。

你能告诉我为什么*ioctl()*仍然返回 -1 并将*errno*设置为**EPERM**吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-17T22:48:32.283

您调用 ioctl 的设备可能包含一些代码，这些代码会在执行您请求的操作之前检查功能。在这种情况下，将特殊文件的权限设置为 777 是不够的。如果您想深入了解支持相关设备的驱动程序的源代码，您可以查找类似于以下内容的内容，以确定实际需要哪些功能。

```
if (! capable (CAP_SYS_ADMIN))
    return -EPERM; 
```

您可能想了解有关功能的信息，或者只是按照其他人的建议以 root 身份运行您的应用程序。

[Linux 功能手册页](http://linux.die.net/man/7/capabilities)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-07-08T08:22:47.657

是的，EPERM（*不允许操作*）错误表明您没有**足够的权限**来执行该操作**。正如 liw.fi**建议的那样，尝试以 root 权限执行或告诉我们要执行的操作是什么。

# javascript - jQuery灯箱插件bug

> ID：726916
> 
> 赞同：3
> 
> 时间：2009-04-07T18:02:26.540
> 
> 标签：javascript, jquery

如果您访问此处：[http](http://www.egyptevakantie.nl/dahab) : //www.egyptevakantie.nl/dahab，单击“andere plaatsen”选项卡，然后单击一个图像，它会显示放大的图像，由 jQuery 灯箱插件提供。

但是，如果你在这里做同样的事情[http://www.egyptevakantie.nl/dahab?rhys=yes](http://www.egyptevakantie.nl/dahab?rhys=yes)（基本上是同一个站点，除了几个样式表和一两个小的 html 更改，其中没有一个非常接近图像）灯箱失败。灯箱不是覆盖内容，而是附加到页面底部，在那里它也显示得很奇怪。

到目前为止，在调试过程中，我已经设法确定插件仍然计算正确的左值和顶部值来放置灯箱的位置，但是在生成 dhtml 时，顶部值已经完全改变了。

有谁知道为什么会这样？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T18:08:30.800

我认为您缺少 jquery 灯箱样式表文件。

在第一页有对这个 css 文件的引用：

```
/css/jquery.lightbox-0.5.css 
```

但在第二个链接上没有对该文件的引用。

此 css 文件包含在此处的 jQuery 灯箱下载中：

[http://leandrovieira.com/projects/jquery/lightbox/](http://leandrovieira.com/projects/jquery/lightbox/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T18:11:16.253

如果图像附加在底部页面，肯定没有设置 postion:absolute。

# c# - 推荐游戏的精灵大小（XNA）？

> ID：726921
> 
> 赞同：2
> 
> 时间：2009-04-07T18:04:12.120
> 
> 标签：c#, xna

**2D 精灵表中单个图块的最佳尺寸是多少？**

我正在创建一个精灵表，并试图找出每个精灵使用的最佳分辨率。有我不应该超过或低于的标准尺寸吗？

前任。64 像素 X 64 像素、512 像素 X 512 像素等。

我正在尝试获得高清质量的精灵。想想 Alien Hominid、Castle Crashers 或 World of Goo。一些例子也很好，所以如果你有精灵表例子，请上传它们。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T18:20:49.600

这取决于精灵将如何被渲染，以及当你渲染它们时你将如何处理它们。

如果要避免缩放精灵，使它们尽可能与最终渲染的分辨率相同将有助于保持更高的质量。我肯定会坚持使用两种纹理大小的力量，因为它似乎确实有帮助。

但是，如果您要对精灵进行大量转换，尤其是旋转或缩放，您可能希望稍微大于它们将渲染的分辨率，因为重新采样的质量可能会稍好一些。您需要考虑随时合成和显示多少个精灵，以及您将在哪些硬件上运行（xbox、pc，两者？），以确定平衡性能与纹理质量的最佳选项。

但是，如果您对精灵的数量不太感兴趣，您可能会获得更高的质量，并允许系统根据需要缩小它们的大小，并获得良好的结果。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T19:32:35.310

这可能不会直接回答您的问题，但我想介绍一下我在使用精灵表时学到的知识。精灵表很棒，因为 GPU 在绘制到屏幕时必须切换的纹理越少，性能就越好。

如果您还没有的话，我建议您看一下[XNA sprite sheet example 。](http://creators.xna.com/en-US/sample/spritesheet)它提供了几个很大的好处：

*   它会自动将您的精灵（在不同的文件中）打包成一个大纹理。我认为将我的艺术作品保存在单独的文件中并自动生成一个巨大的精灵表会比将我的所有艺术作品保存在一个文件中更好。

    例如，如果我决定让我的动画在中间有一个额外的帧怎么办？然后我必须在精灵表中移动一堆东西，为新框架腾出空间。如果我每帧使用一个文件，如果我想在中间添加一个新帧，只需对 XML 文件进行一行更改，列出精灵表中的内容。

    单独列出每个帧文件可能会很痛苦，所以我明白为什么这对某些人可能不起作用，但这对我的项目来说很棒。此外，我发现能够轻松地将纹理交换进出我的精灵表的好处是非常值得的，这将帮助您确定要使用的精灵大小。

*   我们在缩放精灵时遇到了[问题。](http://christophermpark.blogspot.com/2008_10_01_archive.html)我相信该链接很好地描述了这个问题。在任何情况下，这个 sprite sheet 示例都会在您添加到 sprite sheet 的每个 sprite 周围自动添加一个 1 像素的边框（使用最初位于边缘的像素的颜色），这将保护您不会看到您周围的奇怪颜色边框缩放时精灵，因为它仍然只使用原始大小绘制精灵。它只是使用额外的边框进行插值，而不是使用附近精灵的像素或空白。

Reed 是正确的，您确实不应该使用任何标准的精灵大小。这主要取决于您在做什么类型的游戏，您正在做什么类型的缩放和旋转等。但是，在使用精灵表时需要注意特定的大小。Sprite 表只是一个巨大的纹理，但是 GPU 可以在内存中容纳多大的纹理是有限制的。XBOX360 最多支持 4096x4096（我认为）纹理。如果您正在为 Windows 编程，那么这取决于用户的显卡。据我所见，在 Windows 上最好坚持使用 2048x2048，因为大多数显卡至少可以支持这么多。

关于精灵表示例的最后一点。我不相信它会监视最大精灵表大小，所以如果你确实使用它，你可能需要添加几行来捕捉生成纹理的大小大于你想要支持的大小。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-06-19T02:10:31.040

Shawn Hargreaves 最近发表了一系列关于纹理重采样和混叠的博客文章。请参阅[4 月的帖子列表顶部和](http://blogs.msdn.com/b/shawnhar/archive/2011/04.aspx)[5](http://blogs.msdn.com/b/shawnhar/archive/2011/05.aspx)月的帖子。这里的关键词是“**奈奎斯特频率**”（[维基百科](http://en.wikipedia.org/wiki/Nyquist_frequency)）。

特别是看看[这篇关于纹理混叠的帖子](http://blogs.msdn.com/b/shawnhar/archive/2011/04/29/texture-aliasing.aspx)。它有像这样的漂亮图表：

[http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-70-20-metablogapi/6518.image_5F00_1B896E07.png](http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-70-20-metablogapi/6518.image_5F00_1B896E07.png)

非常非常简短的答案是：

**避免渲染比源纹理小 2 倍以上**（即：源大小的 50% 或更小）。如果您确实需要渲染更小，请使用**mipmaps**。而且，如果您正在旋转，则向下缩放的余量较小。避免向上缩放。

在 XNA 中使用二次幂大小的纹理没有任何优势。只需在您的目标分辨率下使用纹理，让 XNA 在后台处理它。

举个例子：如果你正在制作一个 1080p 分辨率的游戏，那么缩小到 720p 就是缩小到 66.66%，这是完全可以接受的。

# ruby - 红宝石WSDL错误

> ID：726923
> 
> 赞同：1
> 
> 时间：2009-04-07T18:04:45.707
> 
> 标签：ruby, soap, wsdl

我正在为这个错误撞墙。使用 wsdl2ruby 生成我的类后，当我针对 web 服务发布销售时，我收到以下错误。

> SOAP::FaultError: org.xml.sax.SAXException: com.marquis.eomis.canteeninventoryandsales.resource.canteenSale.CanteenSaleContent 中的元素无效 - 用户

user 元素是 CanteenSaleType 所需的有效元素。生成的WSDL有问题吗？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T18:10:12.980

WSDL 有问题吗？- 可能不是。wsdl2ruby.rb 对如何传递参数相当挑剔。您可以发布 WSDL 的相关部分和生成的代码的相关部分吗？

# c++ - 在 C++ 中处理音频

> ID：726924
> 
> 赞同：1
> 
> 时间：2009-04-07T18:04:47.360
> 
> 标签：c++, audio

我需要能够获取音频文件的长度（最好以毫秒为单位，时间对应用程序非常重要），并播放音频。该应用程序是在 windows XP 平台上用 C++ 编写的。对音频格式/第三方库有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T18:07:24.657

如果我必须在任何平台上做任何与音频相关的事情，我只需使用[FMOD](http://www.fmod.org/)。它非常快速、跨平台，并且支持多种格式。请注意，它不能免费用于商业用途。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T18:14:27.963

[Phonon 库](http://qt-project.org/doc/qt-4.8/phonon-module.html)（Qt的 一部分）非常强大和舒适。它是 LGPL。

缺点：它的性能不如一些面向游戏的库，例如 FMod、SDL_Mixer 和 OpenAL。但是，对于桌面应用程序，延迟通常是可以接受的。

至于音频格式：默认使用 Ogg Vorbis。它是一个开放标准，免版税并且比 MP3 质量更好。

# vb.net - VB.NET ManagementObject 帮助

> ID：726937
> 
> 赞同：2
> 
> 时间：2009-04-07T18:07:52.470
> 
> 标签：vb.net

我正在尝试创建一个函数来将映射的驱动器路径转换为 ​​UNC 路径。我做了一些谷歌搜索，发现[了几个](http://groups.google.nu/group/DotNetDevelopment/msg/6caffd33ad1eae11) 关于此事的[不同](http://www.freevbcode.com/ShowCode.Asp?ID=397) [页面。](http://www.devx.com/vb2themax/Tip/18960)我对第一个最感兴趣，但我似乎无法让代码配合。由于原始帖子是用 C# 编写的，因此这是我的 VB.NET 转换：

```
Public Shared Function GetUniversalName(ByVal sFilePath As String) As String
    If sFilePath = String.Empty OrElse sFilePath.IndexOf(":") Then
        Return sFilePath
    End If
    If sFilePath.StartsWith("\") Then
        Return (New Uri(sFilePath)).ToString()
    End If

    Dim searcher As New ManagementObjectSearcher("SELECT RemoteName FROM win32_NetworkConnection WHERE LocalName = '" + sFilePath.Substring(0, 2) + "'")
    For Each managementObject As ManagementObject In searcher.[Get]()
        Dim sRemoteName As String = TryCast(managementObject("RemoteName"), String)
        sRemoteName += sFilePath.Substring(2)
        Return (New Uri(sRemoteName)).ToString()
    Next
    Return sFilePath
End Function 
```

我已经导入了`System.Management`，但是 VS2008 说`ManagementObjectSearcher`并且`ManagementObject`没有定义。谁能把我推向正确的方向？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T18:14:39.473

您还需要在引用中添加 System.Management。

# c# - 使用 WPF 显示流式富文本

> ID：726943
> 
> 赞同：3
> 
> 时间：2009-04-07T18:09:19.393
> 
> 标签：c#, .net, wpf, flowdocument

我有一个 WPF 应用程序，它通过套接字连接到设备并获取流式文本数据（每秒大约 1 条消息）。然后，此数据将显示在 UI 上。用户可以创建诸如*“如果数据包含'abc'突出显示该行”*或*“...使其变为粗体”*这样的规则，所以纯文本输出是不行的，它需要是“富”文本。

我目前对此的解决方案是在我的 ViewModel 中有一个包含格式化输出的[FlowDocument 。](http://msdn.microsoft.com/en-us/library/system.windows.documents.flowdocument.aspx)View 有一个[FlowDocumentScrollViewer](http://msdn.microsoft.com/en-us/library/system.windows.controls.flowdocumentscrollviewer.aspx)，它绑定到 ViewModel 中的 FlowDocument。

这可行，但是当 FlowDocument 变大（约 6,000 行）时，性能开始下降。当前算法将行数限制在 10,000 行，但随后情况变得更糟，以至于应用程序无法使用。一旦达到 10,000 行，我就会为添加的每一行删除一行，从而导致 FlowDocumentScrollViewer 为每个新行获取 2 个更新通知。

我试图找到一种批量删除的方法（当我们达到 10,000 行时删除最旧的 1,000 行），但 FlowDocument 上没有批量删除。循环 1,000 次并执行删除会导致 1,000 条更新通知并锁定 UI。

这是我的问题，这是我的问题：

**使用 WPF 显示流式富文本内容的最佳方式是什么？** 我每秒收到约 1 条消息，每条消息约为 150 个字符，我想保留最后 10000 条消息。我会以错误的方式解决这个问题吗？是否还有其他性能更好的控件/对象？

**编辑**：这里有一些更多的要求

*   需要能够打印输出文本
*   需要能够选择和复制输出文本，以便将其粘贴到另一个文档中

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-14T15:33:06.313

性能下降似乎是由 FlowDocument 中的大量块引起的。对于收到的每条消息，我都在创建一个运行，将运行添加到段落并将段落添加到文档中。

我更改了算法，所以现在它创建了一个段落，然后向该段落添加 250 次运行，然后创建一个新的段落......添加 250 次运行......等等。这基本上将块的数量减少了一半。

当我达到最大行数（10,000）时，这还有一个额外的好处。我可以删除最旧的段落并立即删除最旧的 250 行，而不是为添加的每个新行删除一行（并与 CPU 挂钩）。

这种相对简单的改变使性能很好地处于可接受的范围内。现在 CPU 保持在相对较低的水平，峰值约为 15%，而不是固定 CPU 并锁定 UI。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T18:18:31.650

由于能够在列中显示内容等，FlowDocumentScrollViewers 可能会产生开销。是否有正常 WPF RichTextBox 不起作用的原因？另外，您有 .NET 3.5 SP1 吗？以下链接表明 SP1 中 FlowDocuments 的性能有了很大改进：http: [//social.msdn.microsoft.com/Forums/en-US/wpf/thread/a116da54-ce36-446a-8545-3f34e9b9038d](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/a116da54-ce36-446a-8545-3f34e9b9038d)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T19:36:19.777

这个想法使事情变得非常复杂，但我的想法是为每条消息创建一个查看器，并且只创建显示当前可见消息所需的数量的查看器。我认为 VirtualizingStackPanel 控件将是一个很好的工具来管理它。[我在这里](http://blogs.msdn.com/dancre/archive/2006/02/06/implementing-a-virtualized-panel-in-wpf-avalon.aspx)找到了一个描述 VirtualizingStackPanel 实现的系列。

显然，这意味着在单独的数据结构中维护消息缓冲区。

**编辑：**我刚刚意识到标准 ListBox 控件在其实现中使用了 VirtualizingStackPanel。考虑到这一点，我修改后的建议是：

1.  创建一个数据结构来包含每条消息的来源。
2.  在数据结构上创建一个属性，该属性“动态”从消息源创建 FlowDocument
3.  将 ListBox 绑定到所述数据结构的集合。
4.  使用 FlowDocumentScrollViewer 为 ListBox 定义 ItemTemplate，其中 Document 属性绑定到上述数据结构的属性。

**编辑 2：**关于打印/缩放：我无法帮助您在 WPF 中打印（可能涉及 VisualBrush 的东西？），但缩放应该很容易做到。我创建了一个 ZoomListBox 来测试这个想法。XAML 如下所示：

```
<ListBox
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    x:Class="Test.ZoomListBox"
    d:DesignWidth="640" d:DesignHeight="480"
    x:Name="ThisControl">
    <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
            <VirtualizingStackPanel IsItemsHost="True">
                <VirtualizingStackPanel.LayoutTransform>
                    <ScaleTransform ScaleX="{Binding ElementName=ThisControl, Path=Zoom}" ScaleY="{Binding ElementName=ThisControl, Path=Zoom}" />
                </VirtualizingStackPanel.LayoutTransform>
            </VirtualizingStackPanel>
        </ItemsPanelTemplate>
    </ListBox.ItemsPanel>
</ListBox> 
```

后面的代码是这样的：

```
public partial class ZoomListBox
{
    public ZoomListBox()
    {
        this.InitializeComponent();
    }

    public double Zoom
    {
        get { return (double)GetValue(ZoomProperty); }
        set { SetValue(ZoomProperty, value); }
    }

    // Using a DependencyProperty as the backing store for Zoom.  This enables animation, styling, binding, etc...
    public static readonly DependencyProperty ZoomProperty =
        DependencyProperty.Register("Zoom", typeof(double), typeof(ZoomListBox), new UIPropertyMetadata(1.0));
} 
```

以及一个使用它的例子：

```
<Grid x:Name="LayoutRoot">
    <Grid.RowDefinitions>
        <RowDefinition />
        <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <l:ZoomListBox x:Name="ZoomList">
        <Button>Foo</Button>
        <Button>Foo</Button>
        <Button>Foo</Button>
        <Button>Foo</Button>
        <Button>Foo</Button>
        <Button>Foo</Button>
        <Button>Foo</Button>
    </l:ZoomListBox>
    <Slider Grid.Row="1" Value="{Binding ElementName=ZoomList, Path=Zoom}" Minimum="0.5" Maximum="5" /> 
</Grid> 
```

# objective-c - 为什么 Instruments 将此报告为内存泄漏？

> ID：726944
> 
> 赞同：1
> 
> 时间：2009-04-07T18:09:31.857
> 
> 标签：objective-c, cocoa, cocoa-touch

我有一些如下所示的代码：

```
NSMutableArray *bar = [[NSMutableArray alloc] initWithCapacity:0];
NSMutableDictionary *foo = [[NSMutableDictionary alloc] initWithCapacity:0];
[foo setObject:[NSNull null] forKey:@"yay"];
[bar addObject:foo];

[foo release]; 
```

Instruments 显示 foo 正在泄漏。我明白为什么会这样。alloc'd 时 Foo 的保留计数为 1。然后当 bar addObject 的 foo 时，保留计数变为 2。后来当我释放 foo 时，它又回到 1。仍然是泄漏。但是，稍后在我的代码中，（在一个单独的方法中，这就是为什么我认为这可能会显示为泄漏）

```
[bar removeAllObjects]; 
```

如果我稍后执行 removeAllObjects，为什么 foo 显示为泄漏？

** 笔记 **

我没有将它包含在我的原始帖子中，但 bar 确实在类 dealloc 方法中发布。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T18:48:23.763

我认为（我认为您也暗示了这种可能性）Instruments 将其标记为*潜在*泄漏，因为它没有向前看足够远，无法看到该栏将负责删除/释放其所有对象。方法..

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T18:31:21.603

鉴于你所展示的，它`bar`永远不会被释放。调用`[bar removeAllObjects]`只会删除它包含的对象。相反，您应该`[bar release]`在完成`bar`. 这将自动释放所有`bar`持有的对象，并释放 bar 对象本身。

您声明您了解内存管理概念，所以也许您只是没有`bar`在示例中显示被释放。

**编辑：**我认为克雷格的[回答](https://stackoverflow.com/questions/726944/why-is-instruments-reporting-this-as-a-memory-leak/727108#727108)是正确的。避免警告的一种方法（也许）是`bar`在类`init`方法中进行分配。我通常发现在成员变量方面保持我的`init`和`dealloc`方法之间的对称是有益的，这将是一个很好的例子：

```
- (id)init
{
    if ((self = [super init]) == nil) { return nil; }

    bar = [[NSMutableArray alloc] initWithCapacity:0];

    return self;
}

- (void)dealloc
{
    [bar release];

    [super dealloc];
}

- (void)YourMethod
{
    NSMutableDictionary *foo = [[NSMutableDictionary alloc] initWithCapacity:0];
    [foo setObject:[NSNull null] forKey:@"yay"];
    [bar addObject:foo];
    [foo release];
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T18:25:38.793

NSMutableArray 应该在调用 removeAllObjects 时释放它。您不需要将其释放或添加到自动释放池中。

来自 O'Reilly 关于内存管理的章节：

> 将对象添加到集合时，它会被保留。当您从集合中删除一个对象时，它就会被释放。释放一个集合对象（例如 NSArray）也会释放存储在其中的所有对象。

也许仪器中发生了其他事情？

# cocoa - 模拟鼠标点击窗口而不是屏幕

> ID：726952
> 
> 赞同：1
> 
> 时间：2009-04-07T18:11:10.450
> 
> 标签：cocoa, macos, mouse

在 MacOS X 中是否可以将鼠标单击发送到特定窗口？

我已经设法通过`CGPostMouseEvent`. 我要控制的窗口相互重叠，所以我的下一个想法是在触发点击之前将正确的窗口放在前面。它可以工作，但最终会一团糟…… ;-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T11:30:57.413

可以通过未记录的方式向 Cocoa 应用程序发送事件

```
CGEventPostToPSN 
```

这是来自 Dave Keck 的一些代码示例。[他在邮件列表](http://lists.apple.com/archives/Cocoa-dev/2009/Apr/msg00764.html)上贴了一份小申请。

```
customEvent = [NSEvent mouseEventWithType: [event type]
                                 location: [event locationInWindow]
                            modifierFlags: [event modifierFlags] | NSCommandKeyMask
                                timestamp: [event timestamp]
                             windowNumber: WID
                                  context: nil
                              eventNumber: 0
                               clickCount: 1
                                 pressure: 0];

CGEvent = [customEvent CGEvent];
CGEventPostToPSN(&psn, CGEvent); 
```

为了存档它，我在 paste.org 上粘贴[了更多源代码](http://pastie.org/476682)

[供参考： cocao-dev 邮件列表上](http://lists.apple.com/archives/Cocoa-dev/2009/Apr/thrd8.html#00708)的整个线程

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T18:18:10.573

您可能会使用[Accessibility APIs](http://developer.apple.com/documentation/Accessibility/Reference/AccessibilityLowlevel/)。

它有点复杂，但它应该可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T18:31:10.200

也许您可以使用[窗口管理器 API：SetUserFocusWindow()](http://developer.apple.com/documentation/Carbon/Reference/Window_Manager/Reference/reference.html#//apple_ref/c/func/SetUserFocusWindow)，然后创建鼠标事件。

# ruby - 使用 Webby/Compass 集成时，*.sass 文件进入哪个目录？

> ID：726953
> 
> 赞同：0
> 
> 时间：2009-04-07T18:11:16.177
> 
> 标签：ruby, sass, compass-sass, webby

我刚刚设置了[Webby/Compass 集成](https://github.com/Compass/compass/wiki/webby-integration)。（[https://github.com/Compass/compass/wiki/webby-integration](https://github.com/Compass/compass/wiki/webby-integration)）

我将 Compass/Sass 源文件放在哪里，它们在哪个目录中作为样式表获得输出？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T14:15:12.557

您可以将您的 SASS 文件放在您想要的任何位置（在 'content/' 目录下）。因此，如果包含您的 CSS 文件的目录是“content/css”，则将它们放在那里。

唯一重要的是在 SASS 文件本身的顶部正确设置元数据部分。像这样：

```
$ cat content/css/site.sass 
---
filter: sass
extension: css
layout: nil
---
[..cut..] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T18:38:05.517

看起来您可以从文档中自己设置源文件：

```
Compass.configuration do |config|
  config.project_path = File.dirname(__FILE__)
  config.sass_dir = File.join('src', 'stylesheets' )
end 
```

看起来它默认为“src/stylesheets”。当你构建它时，它可能会被渲染为“输出/css/”，但我自己从未使用过 webby，所以我不能 100% 确定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T18:38:33.740

好的，在[这个存储库中找到它](http://github.com/macournoyer/macournoyer.com/blob/43a1be1ef4b36bf2c292f4a060ff2623d1b912e3/content/stylesheets/ie.sass)

显然它属于您的 webby 项目的 ./content/stylesheets 目录，并输出到 ./output/stylesheets 目录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-14T21:40:08.490

令我困惑的是“为什么”它会以这种方式工作。为什么选择 File.join？看起来默认的“src”正在被“stylesheets”取代，而不是加入一个新的字符串。好奇的。

# types - 从 C 中查询 Lua 用户数据类型

> ID：726958
> 
> 赞同：6
> 
> 时间：2009-04-07T18:13:30.053
> 
> 标签：types, lua

`"stackoverflow.test"`我有一个具有某种元表类型（例如）的 Lua 用户数据对象。从 C 代码中，我希望能够准确检查它是哪种类型，并根据结果表现出不同的行为。是否有一个很好的方便函数（很像`luaL_checkudata`，但如果答案不是您想要的，则不会出错）让我查询用户数据的元表类型名称？如果没有，我想我需要使用`lua_getmetatable`，但是我有点不清楚如何确定刚刚添加到堆栈中的元表的名称。

澄清一下：我使用的是 Lua 5.1，其中 luaL_checkudata 的行为发生了变化。我知道在 5.0 中它不会出错。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T01:43:45.603

您始终可以在元表中存储一个标记字段，其中包含模块独有的轻量用户数据值。

```
static const char *green_flavor = "green";
...
void my_setflavor(lua_State *L, void *flavor) {
  lua_pushlightuserdata(L,flavor);
  lua_pushlstring(L,"_flavor");
  lua_rawset(L,-3);
}

void my_isflavor(lua_State *L, void *flavor) {
  void *p = NULL;
  lua_pushlstring(L,"_flavor");
  lua_rawget(L,-2);
  p = lua_touserdata(L,-1);
  lua_pop(L,1);
  return p == flavor;
} 
```

然后可以使用`my_setflavor(L,&green_flavor)`设置栈顶表的_flavor字段，并`my_isflavor(L,&red_flavor)`测试栈顶表的_flavor字段。

以这种方式使用，_flavor 字段只能采用可以由模块中具有符号 green_flavor 的代码创建的值，并且除了检索元表本身之外，查找该字段并测试其值只需要一次表查找. 请注意，变量 green_flavor 的值无关紧要，因为实际上只使用了它的地址。

有几个不同的风味变量可用作标记值，_flavor 字段可用于区分几个相关的元表。

综上所述，一个自然的问题是“为什么要这样做？” 毕竟，元表可以很容易地包含获得适当行为所需的所有信息。它可以很容易地保存函数和数据，并且可以从 C 和 Lua 中检索和调用这些函数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T07:20:48.767

您将使用`lua_getmetatable`and`lua_equal`来测试表是否相同。

在我看来，Lua 应该对这种类型扩展的东西给予更多的支持。到目前为止，这确实是 Lua/C(++) 包装系统的责任。

在我最近完成的包装器中（作为商业项目的一部分），我这样做是`class::instance(L,index)`为了获取特定类型的用户数据指针。换句话说，该方法检查它是用户数据并且元表也是正确的。如果不是，则返回 NULL。

Lua 可以帮助这一切的方式是，如果元表有一个用于扩展类型信息（sa `__type`）的标准字段。这可以用来`type()`返回“userdata”、“xxx”（两个值，目前只返回一个）。这将与大多数当前代码保持兼容。但这只是假设（除非您执行自定义 type() 并自行实现）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T02:05:56.760

用户数据必须有一个元表，所以抓住它；然后在注册表中查找您想要的名称。如果这两个对象相同，则您已找到要查找的类型。

您可以在 C 代码中发送这种类型，但请允许我建议您改为指定元表的字段。存储在元表中的函数应该可以完成这项工作，但如果不是，如果您绝对必须`switch`在 C 代码中使用，则选择一个名称，使用该名称来索引元表，并为每个元表分配一个可以打开的小整数。

```
meta1.decision = 1
meta2.decision = 2
meta3.decision = 3 
```

然后在你的 C 代码中

```
if (lua_getmetatable(L, 1)) {
  lua_getfield(L, -1, "decision");
  if (lua_isnumber(L, -1)) {
    switch ((int) lua_tonumber(L, -1)) {
       case 1: ... ; break;
       case 2: ... ; break;
       case 3: ... ; break;
    }
    return 0;
  }
}
return luaL_error(L, "Userdata was not one of the expected types"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T18:17:30.233

我刚刚查看了`luaL_checkudata`函数的源代码，它基本上使用`lua_getmetatable`. 然后它使用 来从注册表中获取给定的类型名称`lua_getfield`，并`lua_rawequal`调用来比较它们。

# php - PHP：套接字监听问题

> ID：726960
> 
> 赞同：2
> 
> 时间：2009-04-07T18:13:46.187
> 
> 标签：php, sockets

这是我的代码：

```
<?php

$host = "127.0.0.1";
$portListen = 1234;
$portSend = 1240;

// create socket
$sSender = socket_create(AF_INET, SOCK_STREAM, 0);

socket_connect($sSender, $host, $portListen);

socket_write($sSender, "test", strlen ("test"));

$sListen = socket_create(AF_INET, SOCK_STREAM, 0);
socket_set_option($sListen, SOL_SOCKET, SO_REUSEADDR, 1);

socket_bind($sListen, $host, $portSend);

socket_listen($sListen,1);
$dataSock = socket_accept($sListen);
echo socket_read($dataSock, 3, PHP_NORMAL_READ);

// close sockets
socket_close($sSender);
socket_close($sListen);
?> 
```

我将“test”发送到另一个应用程序，它接收并发回“ack”。问题是，我只能做一次。如果我刷新，我得到地址已使用错误。我尝试了[php.net](http://my.php.net/manual/en/function.socket-close.php)上建议的解决方案，但无济于事。在 socket_close() 之前尝试 socket_shutdown() 只会给我未连接的警告，并且在刷新时会给我一个永无止境的加载。

据我了解，套接字未立即关闭的原因是缓冲区中仍有数据。但正如你所看到的，我明确声明只听 1 个连接。另外，我只从我的应用程序中发送 3 个字符并在此脚本中读取 3 个字符。

我究竟做错了什么？

编辑：我使用 2 个套接字的原因是因为我在 write() 之后无法监听（），这给了我套接字已连接错误。在 write() 之后跳过 listen() 并直接进行 read() 会给我无效的参数错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T22:57:56.110

我看到，在睡了几个小时并重新分析了我的代码和文档之后，我设法解决了所有问题。你们是对的，1个插座确实足够了，正确的方法是：

```
<?php

$host = "127.0.0.1";
$portListen = 1234;
$sSender = socket_create(AF_INET, SOCK_STREAM, 0) or die("Could not create socket\n");

socket_connect($sSender, $host, $portListen) or die("Could not connect\n");

socket_write($sSender, "test", strlen ("test")) or die("Could not write output\n");

echo socket_read($sSender, 3, PHP_NORMAL_READ);

socket_close($sSender);
?> 
```

很简单！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T18:18:59.247

为什么需要创建 2 个用于读写的套接字？它看起来像一个奇怪的设计。客户端应用程序通常会打开一个到服务器的套接字连接，然后发送一个请求并在同一个套接字上读取服务器的响应。此外，创建侦听套接字（例如服务器）不会扩展任何防火墙或 NAT 网关。

回答你的评论：不需要听。只需阅读（如果您的服务器尚未回复，可能会阻止操作）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T18:54:05.667

连接关闭后，套接字进入延迟状态，因此如果（在关闭期间）数据包丢失并重新传输，响应将是一个干净的确认，而不是`RST`（重置）指示没有打开这样的套接字。它是 TCP 规范的一部分，你不能让它停止发生。

`Listen(1)`并不意味着只接受一个连接，这意味着保持一个最多 1 个连接的队列等待应用程序`accept()`。因此，一旦您接受第一个，套接字就准备好侦听更多内容。

像其他人一样，我想知道为什么会有奇怪的设计，但我认为这是一个简化的例子，它提出了你的问题，并不一定代表你的真正计划。

# silverlight - 使用 Silverlight 应用程序填充浏览器窗口

> ID：726964
> 
> 赞同：14
> 
> 时间：2009-04-07T18:15:03.890
> 
> 标签：silverlight, browser, size

我希望我的 Silverlight 应用程序填满整个浏览器窗口。我已将插件对象的宽度和高度设置为 100%，并将我的 LayoutRoot 容器的高度和宽度设置为自动，但仍然没有运气。有什么建议么？

```
<form id="form1" runat="server">
    <asp:ScriptManager ID="ScriptManager1" runat="server" />
    <asp:Silverlight ID="Silverlight1" runat="server" 
        Source="~/ClientBin/Client.xap"
        MinimumVersion="2.0.30818.0"
        AutoUpgrade="true"
        Height="100%" 
        Width="100%">
    </asp:Silverlight>
</form>

<UserControl 
    x:Class="Client.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Height="Auto"
    Width="Auto">
    <Grid 
        x:Name="LayoutRoot" 
        Background="#084E85"
        ShowGridLines="True">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="80" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="600" />
        </Grid.RowDefinitions>

        ...Remaining content here...
    </Grid>
</UserControl> 
```

**免责声明：**我首先搜索了答案，找到[了这个帖子](https://stackoverflow.com/questions/441143/silverlight-make-same-size-as-browser-frame)。但是，正如您从我的代码中看到的那样，它对我不起作用。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-07T18:23:15.087

首先，我没有在用户控件中设置高度/宽度。相反，我设置了 DesignHeight 和 DesignWidth（在 " `http://schemas.microsoft.com/expression/blend/2008`" 命名空间中）并将对齐设置为拉伸

```
<UserControl ... 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
    d:DesignHeight="1050" d:DesignWidth="1680"> 
```

在我的 HTML 中，我将高度和宽度设置为 100%，如下所示...

```
<div style="height: 100%; width: 100%; position: fixed;">
        <asp:Silverlight runat="server" Source="~/ClientBin/My.xap" ID="MyId" 
            Width="100%" Height="100%" />
</div> 
```

那时，一切都对我有用，可以占据整个窗口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T18:22:35.057

从 中删除 Height 和 Width 属性：

```
<UserControl
     x:Class="Client.Page"
     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"> 
```

自动高度和宽度调整窗口大小以适应内容。如果您删除 Height 和 Width 属性，您的 Silverlight 应用程序将增长以适合窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T18:23:46.973

唔

我认为您的 Grid 设置得尽可能小（没有“星”列或行）。您可以尝试使用“星号”大小的多列和行吗？

正如其他人指出的那样，您还需要删除“自动”大小，因为它们会根据内容自动调整大小。

还尝试在页面上设置背景颜色，以便您看到它实际扩展的位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-20T14:04:12.763

如果您有一个相当复杂的 HTML 布局并且不能依赖固定定位，那么您可以使用以下命令调整 #silverlightControlHost div 的大小：

```
private bool _hasResized;

protected override Size ArrangeOverride(Size finalSize)
{
    if (!_hasResized)
    {
        HtmlPage.Document.GetElementById("silverlightControlHost").SetStyleAttribute("height", finalSize.Height.ToString());
        _hasResized = true;
    }

    return base.ArrangeOverride(finalSize);
} 
```

你可以把它放在里面`MainPage.cs`，或者如果你有嵌套`UserControls`，那么需要最高高度的控件。我还使用以下 XAML 和 Visual Studio 提供的默认 HTML

```
<UserControl ...
    VerticalAlignment="Stretch"
    Height="Auto"
    Width="Auto"> 
```

没有这些设置我还没有测试过，据我所知 Auto 是默认设置。

# vb6 - Janus GridEX 问题

> ID：726965
> 
> 赞同：1
> 
> 时间：2009-04-07T18:15:04.280
> 
> 标签：vb6

任何人都可以帮助解决这个问题，但这是一个远景。我继承了一个带有 Janus GridEX 控件的 VB6 应用程序。它遍历记录，并且是可编辑的。问题是，如果我编辑一个单元格并点击按钮转到下一条记录，则更改将应用​​于下一条记录，而不是我正在编辑的记录。就像，我需要它在进入下一条记录之前完成编辑。我以前在 VC++ 中遇到过这种问题，有时你必须在你所在的控件上“KillFocus”或其他东西。我只是不知道在这里做什么。我尝试发送回车，因为如果您从编辑单元格返回，它可以工作，但手动发送回车不起作用。秘诀是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T15:20:21.127

您的网格是绑定的还是未绑定的？

从你的描述很难看出，但我想如果你有这个问题，那么它可能是必然的。

正如另一个答案所问的那样，按钮是内置在控件中的 RecordNavigator 还是单独的按钮？我再次提出这个问题的原因是，我在我支持的 VB6 应用程序中看到了一些问题，其中工具栏经常会拦截并干扰 JanusGrid 的工作方式。

为了解决这个限制，我在表单上还有 JanusGrid 控件的任何工具栏的单击处理程序中添加了以下代码。

如果`jsgxYourGridName.EditMode = jgexEditModeOn`那么`jsgxYourGridName.Update`

这样，任何更改都会立即应用于当前行。

如果这没有帮助，那么我还看到了绑定到网格的记录集与网格中的内部记录集不同步的问题。您可以通过将网格的书签与记录集的书签进行比较来检查这一点。

IE。`mrsYourRecordset.Bookmark = jsgxYourGrid.ADORecordset.Bookmark`

在某一时刻，我可能也使用过类似的东西。

```
jsgxYourGrid.ADORecordset.Bookmark = jsgxYourGrid.RowBookmark(jsgxYourGrid.RowIndex(jsgxYourGrid.Row)) 
```

最后，您可以尝试在网格的和/或事件中设置断点`BeforeUpdate`，以查看单击按钮时网格的实际记录。`RowColChange``AfterColUpdate`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T20:22:05.457

这取决于按钮是否在 Janus GridEX 内部。如果它是内部的，那么您唯一能做的就是查看控件公开的事件，看看是否有一个序列可以让您知道发生了这个问题。然后，您可以尝试通过恢复您移动到的行并将编辑放在您离开的行中来采取纠正措施。

如果按钮在 Janus 外部，那么您可以使用调试模式来跟踪控制焦点转移到下一行的语句序列。它可能是一些乱序或特定命令序列的副作用。我遇到了两种不同的控件。

请记住，您可以在调试模式下进行编辑，这样您就可以尝试不同的方法并进行测试，直到找到一种可行的方法。

# c# - 调试 AxShockwaveFlash

> ID：726967
> 
> 赞同：3
> 
> 时间：2009-04-07T18:15:22.203
> 
> 标签：c#, .net, apache-flex, flash, axshockwaveflash

我正在构建一个 C# 应用程序，其中包含通过`AxShockwaveFlash`. 挑战之一是，当我使用基于 Eclipse 的 Flex Builder 开发 Flash 控件时，如果电影是直接通过 Flash 播放器独立运行，它似乎只能让我调试 Flash 控件。如果我想从我的 C# 应用程序内部调试我的 ActionScript 代码，我必须求助于穴居人（跟踪）调试，这远不理想。

我看到这`AxShockwaveFlash`似乎为外部分析支持提供了挂钩。我希望也可能有一些用于外部调试支持的钩子，所以我可以将我的 Flex Builder 调试器直接连接到 AxShockwaveFlash，但没有任何反应。想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T20:27:05.610

我不是 C# 程序员，所以我不确定这是否可行。

您应该能够使用 Sephiroth 的Flash [Tracer](http://www.sephiroth.it) [Firefox 插件](http://www.sephiroth.it/examples/firefox/extensions/flashtracer.xpi)获取跟踪。不过，在获取跟踪之前需要设置的东西很少：

1.确保您在 Firefox[中使用 Flash Player](http://download.macromedia.com/pub/flashplayer/updaters/10/flashplayer_10_plugin_debug.exe)插件的调试版本。[一个简单的检查方法是查看此处](http://blog.flexexamples.com/2007/08/08/checking-the-users-flash-player-capabilities-using-the-flashsystemcapabilities-class/#more-68)显示的属性列表中的 isDebugger 属性是否为真（滚动到页面底部的 swf）。

2.确保您的硬盘上有一个名为 flashlog.txt 的文本文件，位于以下位置：%homepath%\Application Data\Macromedia\Flash Player\Logs。默认情况下，Logs 文件夹可能不存在，因此您需要创建它并在其中添加一个空的 flashlog.txt 文件。

3.一旦你安装了正确的播放器和扩展，配置扩展指向 flashlog.txt。您可以使用扩展面板右下方的“首选项”按钮来执行此操作。

重新启动浏览器，以防万一并打开 Flash Tracer 面板。如果您有任何跟踪内容的 Flash 内容，您应该得到跟踪。如果您太快获得太多痕迹，可能会导致浏览器崩溃，因此请确保不时清除痕迹并使用暂停按钮。

另一个想法是使用远程调试器，您应该能够使用 Flash 内容的右键单击菜单中的调试器选项触发，以防显示右键单击菜单（我不知道 Flash 内容的外观/运行方式C# 应用程序）。我没有过多地尝试使用该选项，据我所知，swf 文件应该是远程的，所以我不确定这有多大帮助。

希望我能伸出援手。祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T23:16:51.363

您确定您已安装 AX 调试版本并且您的应用正在使用该版本吗？

如果您使用的是非 IE 浏览器，那么它将不会使用 AX 版本的播放器，因此您对 GProfenza 的评论：“......就像在网络浏览器中一样”可能不成立。

IE 中的 Flash 是否显示调试器菜单？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-20T18:04:19.273

试试 deMonster 的 Monster Debugger。它是一个 AIR 应用程序，允许实时调试 Flash、Flex、浏览器等中的应用程序。只需从 AIR 应用程序中导出一个客户端类并在您的根类中实例化它。然后，您可以分析类、对象、跟踪等。

[http://demonsterdebugger.com/](http://demonsterdebugger.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-04T07:38:08.693

[正如 Spender 在下面](https://stackoverflow.com/questions/726967/debugging-axshockwaveflash/860882#860882)指出的，您可能需要安装[ActiveX“内容调试器”播放器](http://download.macromedia.com/pub/flashplayer/updaters/10/flashplayer_10_ax_debug.exe)。它允许您从 Flex Builder 或 Flashing 创作工具调试在 IE 中运行的 Flash 电影。因此，大概 ActiveX 内容调试器也可以从您的 C# 应用程序中进行调试。

# php - imagesetpixel 问题和使用 php5 和 gd 2.0（或更高版本，显然）显示图像

> ID：726972
> 
> 赞同：0
> 
> 时间：2009-04-07T18:17:13.477
> 
> 标签：php, image, png, gd

由于我的潜意识最清楚的原因，我正在尝试生成一个雪崩般的画面。

使用 PHP5 和 GD v2.0（或更高版本），我使用以下 php/html：

```
<?php

            $x = $y = 100;

            $gd = imagecreatetruecolor($x,$y);

            $w  = imagecolorallocate($gd, 255, 255, 255);
            $b  = imagecolorallocate($gd, 0, 0, 0);

            for ($r=1; $r <= $y; $r++) {

                for ($c=1; $c <= $x; $c++) {

                        if (rand(0,1) == 0) {
                            $rand = $w;
                                    }

                        else {
                            $rand = $b;
                                    }

                    imagesetpixel($gd,$r,$c,$rand);

                            }

                        }

echo "<?xml version=\"1.0\" encoding=\"utf-8\"?>"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />

</head>

<body page="snowcrash2">

    <?php

        echo "<div id=\"snowcrashimg\">";

header('Content-Type: image/png');
            imagepng($gd);

        echo "</div>";

    ?>

</body>

</html> 
```

我试图迭代图像的每个“行”的每个“列”，将像素值设置为 1 或 0 以反映黑色或白色。

但是，这会引发（有趣的）错误：“警告：无法修改标头信息 - 标头已由 /var/www/play/snowcrash2.php 中的（输出开始于 /var/www/play/snowcrash2.php:32）发送在第 51 行"

将标头（...）移动到的前几行（试图将标头放在可能及时发送的位置）会导致以下错误（以图像形式）：图像“ [http:// 127.0.0.1/play/snowcrash2.php](http://127.0.0.1/play/snowcrash2.php) “无法显示，因为它包含错误。”

嗯……救命？

* * *

出现的唯一另一个主题是这个[使用 PHP 和 GD 生成的图像正在被切断](https://stackoverflow.com/questions/129013/generated-image-using-php-and-gd-is-being-cut-off)，它没有可接受的答案，据我所知，与我遇到的问题无关。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T18:26:41.600

当浏览器显示图像时，它会单独下载并放置在页面上。因此，您无法在一个请求中发送 HTML 和图片。您需要的是一个 html/php 页面，该页面有一个标签，其中 src 设置为另一个页面，该页面只会发送图像的数据。

例如：（index.php）

```
<html>
<body>
<image src="pic.php" />
</body>
</html> 
```

现在在另一个名为（pic.php）的文件中，您将生成图像并将其发送回带有“内容类型”标题的响应，并且绝对没有其他内容（可能除了其他标题）

例如取自[http://www.webdeveloper.com/forum/showpost.php?p=879552&postcount=2](http://www.webdeveloper.com/forum/showpost.php?p=879552&postcount=2)

```
<?php

$number = "";
for ($i = 1; $i <= $lenght; $i++)
{
     $number .= rand(0,9)."";
}

$width = 11*$lenght;
$height = 30;

$img = ImageCreate($width, $height);
$background = imagecolorallocate($img,255,255,255);
$color_black = imagecolorallocate($img,0,0,0);
$color_grey = imagecolorallocate($img,169,169,169);
imagerectangle($img,0, 0,$width-1,$height-1,$color_grey);
imagestring($img, 5, $lenght, 7, $number, $color_black);
//////// VERY IMPORTANT
header('Content-Type: image/png');
//////// VERY IMPORTANT
imagepng($img);
imagedestroy($img); 

?> 
```

# c - WinAvr 编程所需的帮助

> ID：726974
> 
> 赞同：-2
> 
> 时间：2009-04-07T18:17:35.177
> 
> 标签：c, embedded, avr, winavr, avrdude

我正在尝试运行 win avr 的源代码。当我尝试使用 avrdude 发送 makefile 后，它给了我错误。

请任何人都可以帮助我

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T18:25:48.387

在没有关于实际错误的更好信息的情况下，以下是对微控制器进行编程时要检查的事项列表：

*   电源是否正确？
*   振荡器在运行吗？
*   重置是否正确配置？
*   目标芯片的电源引脚上是否有合适的旁路电容？
*   编程线是否正确连接？
*   编程线上是否存在电气冲突？
*   是 avrdude 为其供电，还是项目自供电？
*   微控制器上的引脚电压是多少？这是正确的吗？
*   总电路电流消耗是多少？如果它是高或低，寻找短裤并打开。
*   您是否在编程命令之前指定了擦除命令？
*   批量擦除或空白命令是否有效？
*   你能看到串口/usb/etc 端口上的编程器吗？
*   你换了目标芯片吗？

-亚当

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T06:42:21.970

有关更多信息，请参见 avrdude 主页[http://savannah.nongnu.org/projects/avrdude/](http://savannah.nongnu.org/projects/avrdude/)

检查您在调用 avrdude 时是否设置了正确的部件号、端口和编程器，例如：

```
avrdude -p m8 -c stk200 -P lpt1 ...etc 
```

如果您使用 MFile 生成 Makefile，那么应该为您设置这些。使用编辑器打开生成的 Makefile 并检查

```
MCU
AVRDUDE_PROGRAMMER
AVRDUDE_PORT 
```

确保它们与您的微控制器和编程器相对应。

# windows - 如何在我的 MSVC++ 控制台应用程序中休眠？

> ID：726979
> 
> 赞同：2
> 
> 时间：2009-04-07T18:18:36.877
> 
> 标签：windows, visual-c++, console, console-application, sleep

我想调用 Sleep(x)，其中 x 是毫秒数。我知道这是功能，但它对我不起作用。我需要包括什么？

- -解决了 - -

我使用的是编译器选项 /Za，它禁用了 Sleep() 实现中使用的本机 Windows 扩展。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T18:20:19.553

[使用 WINAPI睡眠](http://msdn.microsoft.com/en-us/library/ms686298(VS.85).aspx) 睡眠（__in DWORD dwAtleastFor8HoursForGoodHealth）；

包括 Winbase.h 或 Windows.h

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T18:56:15.053

睡眠在 Winbase.h 中定义，但您应该包含 Windows.h 来获取它。

以后您可以通过从 VisualStudio 调出帮助或搜索 MSDN 来找到您自己的信息。所有关于 Win32 API 调用的信息都应该在那里。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T18:20:06.233

你只是睡觉（asManyMilliSecondsAsYouWant）；

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T18:20:23.253

[Sleep(int milliseconds)](http://msdn.microsoft.com/en-us/library/ms686298.aspx)是一个 Win32 API，用于在设定的毫秒数内暂停程序的执行。

包括`<windows.h>`以访问它。

MSDN 通常会列出 API 所在的头文件和库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-07T17:59:58.623

这可能有点太晚了（对于“提问者”:)），但在 MSVC（2010）（控制台应用程序）中，睡眠时间是秒而不是毫秒。

# sql - Sql Trigger - 它属于哪个表？

> ID：726993
> 
> 赞同：4
> 
> 时间：2009-04-07T18:22:19.923
> 
> 标签：sql, sql-server, sql-server-2005, triggers

在 Sql Server 2005 触发器中是否有办法获取触发器在执行期间附加到的表的名称和架构？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-07T18:48:24.027

```
SELECT
    OBJECT_NAME(parent_id) AS [Table],
    OBJECT_NAME(object_id) AS TriggerName
FROM
    sys.triggers
WHERE
    object_id = @@PROCID 
```

然后你还可以使用[OBJECTPROPERTY](http://msdn.microsoft.com/en-us/library/ms176105.aspx)来获取额外的信息，例如 after/before、delete/insert/update、first/last 等

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T18:26:35.703

这是一种肮脏的认识方式

```
SELECT o.name
FROM sysobjects t
JOIN sysobjects o ON t.parent_obj = o.id
WHERE t.name = 'your_trigger_name' 
```

**[编辑]**

根据其他答案和评论，我认为这适合您（MSSQL2000 版本）

```
SELECT o.name
FROM sysobjects t
JOIN sysobjects o ON t.parent_obj = o.id
WHERE t.id = @@PROCID 
``````*****``*********