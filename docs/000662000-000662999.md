# StackOverflow 问答 000662000-000662999

# c# - 使用批处理文件或 .NET 代码更改 Web.config 中的值

> ID：662000
> 
> 赞同：4
> 
> 时间：2009-03-19T12:20:36.330
> 
> 标签：c#, .net, asp.net, vb.net, sharepoint

我的电脑上有一个 web.config 文件。

我需要在文件中更改和添加很多东西。 *（我实际上正在使用我的 SharePoint web.config 文件）*

我可以用批处理文件执行此操作吗，如果可以，我将如何执行。或者我将如何使用 VB.NET 或 C# 代码来做到这一点？

有什么想法吗？

编辑：我需要创建一个程序来更改 web.config 假设我 web.config 放在我的桌面上，而不是我项目的实际 web.config

问候艾蒂安

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T12:25:49.170

您可以从 C# 代码修改它，例如：

```
Configuration configuration = WebConfigurationManager.OpenWebConfiguration("~");     
AppSettingsSection appSettingsSection = (AppSettingsSection)configuration.GetSection("appSettings"); 

if (appSettingsSection != null) 
{
  appSettingsSection.Settings["foo"].Value = "bar"; 
  config.Save();
} 
```

显然，其中 foo 是键，而 bar 是要设置的键的值。要删除一个值，请使用 Settings.Remove(key);

有关OpenWebConfiguration 方法等的更多信息，请参阅[msdn 文档。](http://msdn.microsoft.com/en-us/library/ms151456.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T12:30:22.997

您要更改文件的上下文确实会影响您应该如何做。如果您正在考虑相对频繁地执行更改，但在管理域中，那么某种命令行工具是有意义的，在这种情况下，我同意 JaredPar 的观点，即[PowerShell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)将是一个有价值的工具。

另一方面，如果您发现自己需要在更加程序化的环境中修改 web.config（例如，作为安装程序的一部分），那么使用程序化技术可能更有意义。我最近不得不做这样的事情，[Linq to Xml](http://msdn.microsoft.com/en-us/library/bb387098.aspx)被证明非常方便。

例如，要打开一个文档“C:\foo\bar.xml”，您可以执行以下操作（未经测试，目前没有方便的构建环境）：

```
XDocument config = XDocument.Load(@"C:\foo\bar.xml"); 
```

然后，您可以按照通常的方式继续使用[API](http://msdn.microsoft.com/en-us/library/system.xml.linq.aspx)。请注意，如果您正在执行管理任务而不是编程任务，这可能有点过头了——学习 PowerShell 之类的工具有很大的长期优势。

最后，如果您正在使用 web.config 的程序中修改 web.config，并且您没有做任何太花哨或动态的事情，那么使用内置的`Settings`或者[`ConfigurationManager`](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.aspx)可能是要走的路.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T12:25:03.540

您最好的选择可能是使用 MSBuild 脚本和[MsBuild 社区任务](http://msbuildtasks.tigris.org/)XML 批量更新任务来更改它

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T12:25:53.570

我个人建议使用 PowerShell。这是 Microsoft 的下一代命令行，它位于 .Net 之上。它被构建用于跨大量文件进行批量编辑等项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T12:28:13.410

对于 SharePoint 环境中的 web.config 更改，您有专门为此任务开发的类。您只需搜索[SPWebConfigModification 类](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spwebconfigmodification.aspx)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T21:07:03.607

加载任意 .NET 配置文件

```
string configLocation = @"C:\myconfigFile.Config";
ExeConfigurationFileMap configFileMap = new ExeConfigurationFileMap();

configFileName = configLocation;
configFileMap.ExeConfigFilename = configFileName;

Configuration configuration= ConfigurationManager.OpenMappedExeConfiguration(configFileMap, ConfigurationUserLevel.None); 
```

然后使用[Razzie 的代码](https://stackoverflow.com/questions/662000/changing-values-in-web-config-with-a-batch-file-or-in-net-code/662019#662019)来改变实际的配置设置

```
AppSettingsSection appSettingsSection = (AppSettingsSection)configuration.GetSection("appSettings"); 
if (appSettingsSection != null) 
{  
    appSettingsSection.Settings["foo"].Value = "bar";   
    configuration.Save();
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T09:45:25.657

这就是我需要做的......谢谢所有的帮助！！！

```
// Read in Xml-file 
        XmlDocument doc = new XmlDocument();
        doc.Load("C:/Web.config");

        //SaveControl tag..........................................................
        XmlNode n = doc.SelectSingleNode("/configuration/SharePoint/SafeControls");

        XmlElement elemWeb = doc.CreateElement("SafeControl");
        elemWeb.SetAttribute("Assembly", "SamrasWebOption4");
        elemWeb.SetAttribute("Namespace", "SamrasWebOption4");
        elemWeb.SetAttribute("TypeName", "*");
        elemWeb.SetAttribute("Safe", "True");

        XmlElement elemSmartPart = doc.CreateElement("SafeControl");
        elemSmartPart.SetAttribute("Assembly", "Machine_Totals");
        elemSmartPart.SetAttribute("Namespace", "Machine_Totals");
        elemSmartPart.SetAttribute("TypeName", "*");
        elemSmartPart.SetAttribute("Safe", "True");

        //Appending the Nodes......................................................
        n.AppendChild(elemWeb);
        n.AppendChild(elemSmartPart);

        //Saving the document......................................................
        doc.Save("C:/Web.config"); 
```

# asp.net - 验证消息

> ID：662002
> 
> 赞同：0
> 
> 时间：2009-03-19T12:21:10.103
> 
> 标签：asp.net, html, asp.net-mvc, validation

我在设置验证消息时遇到问题。我在一个控件中有两个模型，并且两个模型都具有相同的属性“数量”。

因此，为一个 Model.amount 设置验证也将反映到其他 Model.amount。我试图将不同的 id 传递给两者但不工作。

```
<%= Html.TextBox("amount", Model.amount, new { id = "Pamount" })%>
    <%=Html.ValidationMessage("Pamount", " ")%>
<%= Html.TextBox("amount", Model.amount, new { id = "Eamount" })%>
    <%=Html.ValidationMessage("Eamount", " ")%> 
```

在行动中我正在设置

```
if (obj.amount.ToString() == "0")
            modalState.AddModelError("Pamount", ""); 
```

但验证也适用于 Eamount

我应该怎么办？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T13:52:44.190

我认为添加模型错误时，您按名称访问字段，而不是 ID。所以你想做

```
ModelState.AddModelError("amount", ""); 
```

此外，我建议为文本框提供不同的名称，这样当只有一个导致错误时，您就不会在两个文本框中都添加错误，这可能会导致一些混乱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T13:56:58.470

根据控件的名称应用验证突出显示。该名称必须反映属性名称才能使模型绑定起作用。因此，您不能有两个具有相同名称的控件并且验证突出显示正常工作。所以你需要给控件起不同的名字。有两种方法可以做到这一点：

1.  为不同的金额创建具有两个不同属性的表示模型。分别在显示表单或处理帖子时将演示模型与您正在更新的实际对象进行转换。

2.  为两个对象创建具有子属性的单个模型，然后使用点符号访问这两个数量。

像这样：

```
<%= Html.TextBox("Foo.amount", Model.Foo.amount, [...]
<%= Html.TextBox("Bar.amount", Model.Bar.amount, [...] 
```

# msbuild - MSBuild：如何检查进程是否存在？

> ID：662005
> 
> 赞同：3
> 
> 时间：2009-03-19T12:22:39.350
> 
> 标签：msbuild

是否可以在 msbuild 中编写一个条件来检查某个进程是否存在？或者，有没有人知道这样的任务？

今天，我的进程创建了一个 pid 文件，我检查了它的存在。但我不喜欢此类文件所涉及的所有额外维护。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T13:13:26.797

[MSBuild Extension Pack](http://www.codeplex.com/MSBuildExtensionPack)或[MSBuild Community Tasks](http://msbuildtasks.tigris.org/)中没有此类任务。但是你可以很容易地创建一个这样的。像这样的东西：

```
using System.Diagnostics;
using Microsoft.Build.Framework;
using Microsoft.Build.Utilities;

namespace StackOverflow.MSBuild
{
  public class IsProcessRunning : Task
  {
    private string processName;
    private bool isRunning;

    [Required]
    public string ProcessName
    {
      get { return processName; }
      set { processName = value; }
    }

    [Output]
    public bool IsRunning
    {
      get { return isRunning; }
    }

    public override bool Execute()
    {
      if(string.IsNullOrEmpty(processName))
      {
        Log.LogError("ProcessName could not be empty");
        return false;
      }

      foreach(Process clsProcess in Process.GetProcesses())
      {
        if(clsProcess.ProcessName.Contains(processName))
        {
          isRunning = true;
        }
      }

      return true;
    }
  }
} 
```

你像这样使用它：

```
<UsingTask AssemblyFile="$(Task_Assembly_path)"
         TaskName="StackOverflow.MSBuild.IsProcessRunning" />

<Target Name="TestTask">
  <IsProcessRunning ProcessName="${Process}">
    <Output ItemName="Result" TaskParameter="IsRunning"/>
  </IsProcessRunning>

  <Message Text="Process ${Process} is running"
           Condition="'${Result}' == 'true'"/>
</Target> 
```

# synchronization - 如何使用 ssh 将我的代码同步到远程机器？

> ID：662006
> 
> 赞同：14
> 
> 时间：2009-03-19T12:23:01.067
> 
> 标签：synchronization, development-environment

对于我正在学习的当前课程，我们正在使用远程计算机来运行我们的代码。

我在我的 MacBook 上进行本地编码，我正在寻找一种让我的本地代码在集群上保持最新的好方法。

我这样做的方式是打开一个终端以运行 SCP 以复制目录，并打开另一个终端，该终端通过 SSH 连接到集群中以制作和运行我的代码。

这对我来说似乎不太理想。有没有一种方法可以在修改文件时自动将文件发送到集群？

还是我坚持使用单行命令来移动所有内容？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-19T12:29:00.897

除了分布式版本控制之外，您最好的选择是使用 rsync over ssh。我通过对每台机器执行以下操作来保持几台机器同步：

```
rsync -urltv --delete -e ssh /src.dir user@othermachine:/src.dir 
```

您提到使用 MacBook - rsync 在 Mac OS X 上。据我所知，它不需要额外安装。rsync 的美妙之处在于它查找修改并且只复制修改过的文件。它不会像分布式版本控制系统那样合并同时修改，但如果你像我一样在笔记本电脑上做一些工作，然后在桌面上做一些工作，rsync 是发送所有更改文件的最佳方式（并且只有更改的文件）在您切换模式时从一个到另一个。

注意：这里使用的 rsync 选项是：

*   `-u`, --update 跳过接收器上较新的文件
*   `-r`, --recursive 递归到目录
*   `-l`, --links 将符号链接复制为符号链接
*   `-t`, --times 保留修改时间
*   `-v`, --verbose 增加详细程度
*   `--delete` 从 dest 目录中删除无关文件，充当`--delete-during`

最后，`-e`是允许您指定远程 shell 的选项，在这种情况下是 ssh

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-19T12:39:54.550

如果您可以使用[rsync](http://samba.anu.edu.au/rsync/)，那可能是最好的方法。

使用[sshfs](http://fuse.sourceforge.net/sshfs.html)来（熔断）挂载远程文件夹是一种选择吗？您可以直接编辑文件，或者使用 rsync、[unison](http://www.cis.upenn.edu/~bcpierce/unison/)或任何文件夹到文件夹同步工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T13:06:39.090

我知道这不是您知道的答案，但您可以设置一个 SVN 或 CVS 服务器，这会容易得多。

否则我会选择 rsync。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T23:43:52.090

比 rsync 更好的是[Unison 文件同步器](http://www.cis.upenn.edu/~bcpierce/unison/)，它允许您在任一端进行更改，并检测并帮助解决任何冲突。它通过 ssh 工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T18:33:05.053

可能不是你要找的，但你应该看看像 git 这样的 DSCM：

1.  在远程服务器中创建一个存储库。
2.  使用 ssh 将其克隆到您的开发机器。
3.  添加/修改代码
4.  使用提交和推送（同样，通过 ssh）来合并更改。

# sql-server - 在 MS SQL 触发器中处理多条记录

> ID：662010
> 
> 赞同：6
> 
> 时间：2009-03-19T12:24:37.927
> 
> 标签：sql-server, triggers

我必须第一次在 MSSQL 中使用触发器，一般来说是触发器。在阅读并自己测试后，我现在意识到触发器会触发每个命令，而不是每个插入、删除或更新的行。

整个事情是广告系统的一些统计数据。我们的主统计表相当大，并且在大多数情况下不包含有意义的数据。它包含每个广告点击、查看等的一行。作为用户，用户更倾向于查看此内容，因为 X 天有 Y 次点击和 Z 次浏览等等。到目前为止，我们完全基于 SQL 查询完成了这项工作，从主表中获取了这种报告，但是随着表的增长，该查询的执行时间也在增加。因此，我们选择使用触发器来保持另一个表的更新，从而使 SQL 服务器上的操作更容易一些。

我现在的问题是让它与多个记录一起工作。我所做的是创建 2 个存储过程，一个用于处理插入操作，一个用于删除操作。我的插入触发器（编写为使用单个记录）然后从 Inserted 表中获取数据，并将其发送到存储过程。删除触发器以相同的方式工作，并且（显然？）更新触发器与删除 + 插入相同。

我现在的问题是如何最好地处理多条记录。我曾尝试使用光标，但就我能够阅读和看到自己而言，这表现非常糟糕。我也考虑过写一些“检查”——检查命令中是否有多个记录，然后使用光标，否则只是避免这种情况。无论如何，这是我用光标的解决方案，我想知道是否有更好的方法？

```
CREATE TRIGGER [dbo].[TR_STAT_INSERT]
   ON  [iqdev].[dbo].[Stat]
   AFTER INSERT
AS 
BEGIN
    SET NOCOUNT ON;

    DECLARE @Date DATE 
    DECLARE @CampaignId BIGINT
    DECLARE @CampaignName varchar(500)
    DECLARE @AdvertiserId BIGINT
    DECLARE @PublisherId BIGINT
    DECLARE @Unique BIT
    DECLARE @Approved BIT
    DECLARE @PublisherEarning money
    DECLARE @AdvertiserCost money
    DECLARE @Type smallint

    DECLARE InsertCursor CURSOR FOR SELECT Id FROM Inserted
    DECLARE @curId bigint

    OPEN InsertCursor

    FETCH NEXT FROM InsertCursor INTO @curId

    WHILE @@FETCH_STATUS = 0
    BEGIN

        SELECT @Date = [Date], @PublisherId = [PublisherCustomerId], @Approved = [Approved], @Unique = [Unique], @Type = [Type], @AdvertiserCost = AdvertiserCost, @PublisherEarning = PublisherEarning
        FROM Inserted
        WHERE Id = @curId

        SELECT @CampaignId = T1.CampaignId, @CampaignName = T2.Name, @AdvertiserId = T2.CustomerId
        FROM Advert AS T1
        INNER JOIN Campaign AS T2 on T1.CampaignId = T2.Id
        WHERE T1.Id = (SELECT AdvertId FROM Inserted WHERE Id = @curId)

        EXEC ProcStatInsertTrigger @Date, @CampaignId, @CampaignName, @AdvertiserId, @PublisherId, @Unique, @Approved, @PublisherEarning, @AdvertiserCost, @Type

        FETCH NEXT FROM InsertCursor INTO @curId
    END

    CLOSE InsertCursor
    DEALLOCATE InsertCursor
END 
```

存储过程相当大和密集，我认为没有办法避免以一种或另一种方式遍历 Inserted 表的记录（好吧，也许有，但我希望能够阅读代码也是：p），所以我不会用那个让你厌烦（除非你喜欢不这么想）。差不多，有没有更好的方法来做到这一点，如果有，怎么做？

编辑：在请求之后，这是存储过程

```
CREATE PROCEDURE ProcStatInsertTrigger 
    @Date DATE,
    @CampaignId BIGINT,
    @CampaignName varchar(500),
    @AdvertiserId BIGINT,
    @PublisherId BIGINT,
    @Unique BIT,
    @Approved BIT,
    @PublisherEarning money,
    @AdvertiserCost money,
    @Type smallint
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;
IF @Approved = 1
        BEGIN
            DECLARE @test bit

            SELECT @test = 1 FROM CachedStats WHERE [Date] = @Date AND CampaignId = @CampaignId AND CustomerId = @PublisherId

            IF @test IS NULL
                BEGIN
                    INSERT INTO CachedStats ([Date], CustomerId, CampaignId, CampaignName) VALUES (@Date, @PublisherId, @CampaignId, @CampaignName)
                END

            SELECT @test = NULL

                    DECLARE @Clicks int
                    DECLARE @TotalAdvertiserCost money
                    DECLARE @TotalPublisherEarning money
                    DECLARE @PublisherCPC money
                    DECLARE @AdvertiserCPC money

                    SELECT @Clicks = Clicks, @TotalAdvertiserCost = AdvertiserCost + @AdvertiserCost, @TotalPublisherEarning = PublisherEarning + @PublisherEarning FROM CachedStats
                    WHERE [Date] = @Date AND CustomerId = @PublisherId AND CampaignId = @CampaignId

                    IF @Type = 0 -- If click add one to the calculation
                        BEGIN
                            SELECT @Clicks = @Clicks + 1
                        END

                    IF @Clicks > 0
                        BEGIN
                            SELECT @PublisherCPC = @TotalPublisherEarning / @Clicks, @AdvertiserCPC = @TotalAdvertiserCost / @Clicks
                        END
                    ELSE
                        BEGIN
                            SELECT @PublisherCPC = 0, @AdvertiserCPC = 0
                        END
            IF @Type = 0
                BEGIN

                    UPDATE CachedStats SET
                        Clicks = @Clicks,
                        UniqueClicks = UniqueClicks + @Unique,
                        PublisherEarning = @TotalPublisherEarning,
                        AdvertiserCost = @TotalAdvertiserCost,
                        PublisherCPC = @PublisherCPC,
                        AdvertiserCPC = @AdvertiserCPC
                    WHERE [Date] = @Date AND CustomerId = @PublisherId AND CampaignId = @CampaignId
                END
            ELSE IF @Type = 1 OR  @Type = 4 -- lead or coreg
                BEGIN
                    UPDATE CachedStats SET
                        Leads = Leads + 1,
                        PublisherEarning = @TotalPublisherEarning,
                        AdvertiserCost = @TotalAdvertiserCost,
                        AdvertiserCPC = @AdvertiserCPC,
                        PublisherCPC = @AdvertiserCPC
                    WHERE [Date] = @Date AND CustomerId = @PublisherId AND CampaignId = @CampaignId
                END
            ELSE IF @Type = 3 -- Isale
                BEGIN
                    UPDATE CachedStats SET
                        Leads = Leads + 1,
                        PublisherEarning = @TotalPublisherEarning,
                        AdvertiserCost = @TotalAdvertiserCost,
                        AdvertiserCPC = @AdvertiserCPC,
                        PublisherCPC = @AdvertiserCPC,
                        AdvertiserOrderValue = @AdvertiserCost,
                        PublisherOrderValue = @PublisherEarning 
                    WHERE [Date] = @Date AND CustomerId = @PublisherId AND CampaignId = @CampaignId                 
                END
           ELSE IF @Type = 2 -- View
                BEGIN
                    UPDATE CachedStats SET
                        [Views] = [Views] + 1,
                        UniqueViews = UniqueViews + @Unique,
                        PublisherEarning = @TotalPublisherEarning,
                        AdvertiserCost = @TotalAdvertiserCost,
                        PublisherCPC = @PublisherCPC,
                        AdvertiserCPC = @AdvertiserCPC
                    WHERE [Date] = @Date AND CustomerId = @PublisherId AND CampaignId = @CampaignId         
                END
        END
END 
```

经过帮助，这是我的最终结果，以防其他人有类似问题

```
CREATE TRIGGER [dbo].[TR_STAT_INSERT]
   ON  [iqdev].[dbo].[Stat]
   AFTER INSERT
AS 
BEGIN

    SET NOCOUNT ON

    -- insert all missing "CachedStats" rows
    INSERT INTO
        CachedStats ([Date], AdvertId, CustomerId, CampaignId, CampaignName) 
    SELECT DISTINCT
        CONVERT(Date, i.[Date]), i.AdvertId, i.[PublisherCustomerId], c.Id, c.Name
    FROM
        Inserted i
        INNER JOIN Advert AS   a ON a.Id = i.AdvertId
        INNER JOIN Campaign AS c ON c.Id = a.CampaignId
    WHERE
        i.[Approved] = 1
        AND NOT EXISTS (
                SELECT 1 
                FROM CachedStats as t
                WHERE 
                        [Date] = CONVERT(Date, i.[Date])
                        AND CampaignId = c.Id 
                        AND CustomerId = i.[PublisherCustomerId]
                        AND t.AdvertId = i.AdvertId
        )

  -- update all affected records at once
    UPDATE 
        CachedStats
    SET
        Clicks = 
            Clicks + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 0
            ),
        UniqueClicks = 
            UniqueClicks + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.[Unique] = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 0
            ),
        [Views] = 
            [Views] + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 2
            ),
        UniqueViews = 
            UniqueViews + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.[Unique] = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 2
            ),
        Leads = 
            Leads + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.[Unique] = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] IN (1,3,4)
            ),
        PublisherEarning =
            CachedStats.PublisherEarning + ISNULL((
                SELECT SUM(PublisherEarning) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId           

            ), 0),
        AdvertiserCost =
            CachedStats.AdvertiserCost + ISNULL((
                SELECT SUM(AdvertiserCost) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
            ), 0),
        PublisherOrderValue =
            PublisherOrderValue + ISNULL((
                SELECT SUM(PublisherEarning) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 3              
            ), 0),
        AdvertiserOrderValue =
            AdvertiserOrderValue + ISNULL((
                SELECT SUM(AdvertiserCost) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId           
                AND   s.[Type] = 3
            ), 0),
        PublisherCPC = 
            CASE WHEN (Clicks + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 0
            )) > 0 THEN
                (CachedStats.PublisherEarning + ISNULL((
                SELECT SUM(PublisherEarning) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId           
            ), 0)) -- COST ^
                / (
                    Clicks + (
                        SELECT COUNT(*) FROM Inserted s
                        WHERE s.Approved = 1
                        AND   s.PublisherCustomerId = i.PublisherCustomerId
                        AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                        AND   s.AdvertId = i.AdvertId
                        AND   s.[Type] = 0
                    )               
                ) --- Clicks ^
            ELSE
                0
            END,    
        AdvertiserCPC = 
            CASE WHEN (Clicks + (
                SELECT COUNT(*) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId
                AND   s.[Type] = 0
            )) > 0 THEN
                (CachedStats.AdvertiserCost + ISNULL((
                SELECT SUM(AdvertiserCost) FROM Inserted s
                WHERE s.Approved = 1
                AND   s.PublisherCustomerId = i.PublisherCustomerId
                AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                AND   s.AdvertId = i.AdvertId           
            ), 0)) -- COST ^
                / (
                    Clicks + (
                        SELECT COUNT(*) FROM Inserted s
                        WHERE s.Approved = 1
                        AND   s.PublisherCustomerId = i.PublisherCustomerId
                        AND   CONVERT(Date, s.[Date]) = CONVERT(Date, i.[Date])
                        AND   s.AdvertId = i.AdvertId
                        AND   s.[Type] = 0
                    )               
                ) --- Clicks ^
            ELSE
                0
            END     
   FROM
        Inserted i
    WHERE
        i.Approved = 1 AND
        CachedStats.Advertid = i.AdvertId AND
        CachedStats.[Date] = Convert(Date, i.[Date]) AND
        CachedStats.CustomerId = i.PublisherCustomerId
  SET NOCOUNT OFF
END 
```

现在看起来略有不同，因为我也必须为每个广告编制索引 - 但非常感谢您的帮助 - 将所有内容从 30 小时以上加快到 30 秒，以从我自己的开发统计表中生成 CachedStats :)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T13:54:50.610

这种情况的诀窍是将顺序操作（对于每条记录执行*xyz*）转换为基于集合的操作（一个 UPDATE 语句）。

我已经分析了您的存储过程并将您单独的 UPDATE 语句合并为一个。然后可以将该单个语句转换为可以一次应用于所有插入记录的版本，从而无需存储过程，从而无需游标。

编辑：下面是我们终于开始工作的代码。根据 OP 的反馈，整个操作的执行时间从“几乎永远”（对于原始解决方案）下降到不到一秒。整体代码大小也显着减少。

```
CREATE TRIGGER [dbo].[TR_STAT_INSERT]
   ON  [iqdev].[dbo].[Stat]
   AFTER INSERT
AS 
BEGIN
  SET NOCOUNT ON

  -- insert all missing "CachedStats" rows
  INSERT INTO
    CachedStats ([Date], AdvertId, CustomerId, CampaignId, CampaignName) 
  SELECT DISTINCT
    CONVERT(Date, i.[Date]), i.AdvertId, i.PublisherCustomerId, c.Id, c.Name
  FROM
    Inserted i
    INNER JOIN Advert   a ON a.Id = i.AdvertId
    INNER JOIN Campaign c ON c.Id = a.CampaignId
  WHERE
    i.Approved = 1
    AND NOT EXISTS ( 
      SELECT 1 
      FROM   CachedStats
      WHERE  Advertid   = i.AdvertId AND
             CustomerId = i.PublisherCustomerId AND
             [Date]     = CONVERT(DATE, i.[Date])
    )

  -- update all affected records at once
  UPDATE 
    CachedStats
  SET
    Clicks               = Clicks               + i.AddedClicks,
    UniqueClicks         = UniqueClicks         + i.AddedUniqueClicks,
    [Views]              = [Views]              + i.AddedViews,
    UniqueViews          = UniqueViews          + i.AddedUniqueViews,
    Leads                = Leads                + i.AddedLeads,
    PublisherEarning     = PublisherEarning     + ISNULL(i.AddedPublisherEarning, 0),
    AdvertiserCost       = AdvertiserCost       + ISNULL(i.AddedAdvertiserCost, 0),
    PublisherOrderValue  = PublisherOrderValue  + ISNULL(i.AddedPublisherOrderValue, 0),
    AdvertiserOrderValue = AdvertiserOrderValue + ISNULL(i.AddedAdvertiserOrderValue, 0)
  FROM
    (
    SELECT
      AdvertId,
      CONVERT(DATE, [Date]) [Date],
      PublisherCustomerId,
      COUNT(*) NumRows,
      SUM(CASE WHEN Type IN (0)                      THEN 1 ELSE 0 END) AddedClicks,
      SUM(CASE WHEN Type IN (0)     AND [Unique] = 1 THEN 1 ELSE 0 END) AddedUniqueClicks,
      SUM(CASE WHEN Type IN (2)                      THEN 1 ELSE 0 END) AddedViews,
      SUM(CASE WHEN Type IN (2)     AND [Unique] = 1 THEN 1 ELSE 0 END) AddedUniqueViews,
      SUM(CASE WHEN Type IN (1,3,4) AND [Unique] = 1 THEN 1 ELSE 0 END) AddedLeads,
      SUM(PublisherEarning)                                      AddedPublisherEarning,
      SUM(AdvertiserCost)                                        AddedAdvertiserCost,
      SUM(CASE WHEN Type IN (3) THEN PublisherOrderValue  ELSE 0 END) AddedPublisherOrderValue,
      SUM(CASE WHEN Type IN (3) THEN AdvertiserOrderValue ELSE 0 END) AddedAdvertiserOrderValue
    FROM
      Inserted
    WHERE
      Approved = 1
    GROUP BY
      AdvertId,
      CONVERT(DATE, [Date]),
      PublisherCustomerId
    ) i 
    INNER JOIN CachedStats cs ON 
      cs.Advertid   = i.AdvertId AND
      cs.CustomerId = i.PublisherCustomerId AND
      cs.[Date]     = i.[Date]

  SET NOCOUNT OFF
END 
```

The operations involving the `CachedStats` table will greatly benefit from one multiple-column index over `(Advertid, CustomerId, [Date])` (as confirmed by the OP).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T12:58:23.867

根据您运行的 MSSQL 版本，您还应该考虑为此使用索引视图。这很可能是比您的触发器更简单的方法，具体取决于报告查询的样子。请参阅[此处](http://msdn.microsoft.com/en-us/library/ms191432.aspx)了解更多信息。

此外，在您的触发器中，您应该尝试将您的更新写入物化结果表作为基于集合的操作，而不是游标。编写基于游标的触发器可能只是将您的问题从报告查询转移到表格插入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T12:37:17.397

我要做的第一件事是使用 FAST_FORWARD 游标。由于您只是从一个记录转到下一个记录并且不进行任何更新，因此性能会好得多。

[DECLARE CURSOR 语法](http://doc.ddart.net/mssql/sql70/de-dz_3.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T13:24:28.547

您可以通过对光标执行 FAST_FORWARD、READ_ONLY 和 LOCAL 选项来稍微优化您的光标变化。此外，您将 Id 拉到光标中，然后循环返回以获取值。要么使用 CURRENT_OF 要么将它们全部放入变量中。但是，我不希望这些变化能给你带来太多收益。

你真的需要转向基于集合的方法。该存储过程在基于集合的模型中绝对是可行的——尽管它可能需要 3 或 4 个不同的更新语句。但即使是 3 或 4 个不同的触发器（1 个用于查看，1 个用于点击等）也会比光标方法更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T13:44:02.667

您最好的选择是在触发器中移动到基于集合的操作。我不会 100% 为你写这篇文章，但让我让你开始吧，我们可以看看我们从那里开始。请记住，我是在没有表/模式的情况下编写的，所以我不会去验证。期待错别字:-)

让我们首先看一下您的更新语句，据我所知，您正在使用相同的 where 子句更新同一个表，唯一的区别是列。您可以将其合并为如下所示：

```
UPDATE CachedStats SET
        /* Basically we are going to set the counts based on the type inline in the update clause*/

    Leads= CASE WHEN (@Type = 1 OR  @Type = 4 OR @Type=3 ) THEN Leads + 1 ELSE LEADS END,
        Clicks=CASE WHEN (@Type=0) THEN Clicks+1 ELSE Clicks END,
    Views=CASE WHEN (@Type=4) THEN Views+1 ELSE Views END,
        PublisherEarning = @PublisherEarning + PublisherEarning,
        AdvertiserCost = @AdvertiserCost +AdvertiserCost,
FROM CachedStats CS
INNER JOIN Inserted INS
    ON CS.Date=Inserted.Date AND CS.CustomerId=Ins.PublisherId AND CS.CampaignId=Ins.CampaignId 
```

我同意你的观点，这可能会变得丑陋，但这是你必须做出的决定。

至于您的插入子句，我会以与您已经从 Inserted 表中插入表中不存在的任何内容相同的方式进行处理。

# java - dwr 中的透明批处理远程调用

> ID：662013
> 
> 赞同：1
> 
> 时间：2009-03-19T12:24:54.040
> 
> 标签：java, ajax, xmlhttprequest, dwr

我希望 DWR 透明地批处理在处理同一事件过程中完成的所有远程调用。

原因是在 Javascript 中处理一个事件必须只需要很短的时间，并且在同一时间内不会发生任何其他事情。因此，如果我要进行很多调用，我想透明地对它们进行 DWR 批处理。那可能吗？如何？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T12:45:56.563

DWR 的网站解释了[Call Batching](http://directwebremoting.org/dwr/browser/engine/batch)。

从[另一个 DWR 页面](http://directwebremoting.org/dwr/browser/engine)：

> 远程调用可以批量处理以减少延迟。也可以在 endBatch() 方法上设置选项：
> 
> ```
> dwr.engine.beginBatch();
> Remote.methodInBatch1(params, callback1);
> Remote.methodInBatch2(params, callback2);
> dwr.engine.endBatch({
>   timeout:3000
> }); 
> ```

# wpf - 在 wpf 中按名称获取列定义

> ID：662020
> 
> 赞同：1
> 
> 时间：2009-03-19T12:25:51.900
> 
> 标签：wpf, xaml

例如：

```
<Grid Name="TestGrid">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Name="TestColumnName" Width="*" />
    </Grid.ColumnDefinitions>
</Grid> 
```

我希望能够使用名称“TestColumnName”访问代码中的列定义。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T12:31:34.027

使用 x:Name 属性而不是 Name :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T12:35:46.370

你有没有尝试过：

```
this.TestGrid.ColumnDefinitions.Where(c => c.Name == "TestColumnName").SingleOrDefault(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T12:30:37.303

你用什么来开发你的应用程序。这对我来说在 Visual Studio 2008 SP1 中效果很好。

# visual-c++ - 在 Visual C++ 2005 (MFC) 中删除控件

> ID：662024
> 
> 赞同：1
> 
> 时间：2009-03-19T12:26:22.587
> 
> 标签：visual-c++, visual-studio-2005, mfc

我在 Visual C++ 2005 中有一个 MFC 对话框（MFC 应用程序），我已经向它添加了几个控件。但是，如果我不再需要某个控件，Visual Studio 将无法删除它。除了修改出现对控件的引用的所有代码之外，还有什么简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T12:00:43.770

无法自动删除所有相关代码。一种可以帮助手动删除的方法是在设计器中删除对象*之前使用“查找所有引用”。*然后在删除它后，导航到引用并删除相关代码。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-19T12:39:55.223

我很确定在设计表上选择有问题的控件并按删除有效？

# sharepoint - SharePoint 发布网站上的搜索中心

> ID：662039
> 
> 赞同：1
> 
> 时间：2009-03-19T12:30:39.473
> 
> 标签：sharepoint, search, moss

有人可以给我一些关于如何设置 SharePoint 搜索中心的指导，以便我可以从列表中获取结果并且他们有一些自定义（修改）链接吗？

我使用备用访问映射启用了表单身份验证（和匿名访问）。

现在在默认区域中，我从列表中的数据中获取结果，它们都指向 AllItems.aspx。如果尝试从 Internet 区域搜索，我不会从列表中得到任何结果，我猜这是因为某些安全设置。但是，如果让它们显示我将如何自定义结果链接，以便列表项与某些发布页面一起显示。例如，如果我将新闻保留在新闻列表中，并且当我进行搜索时，我想获得带有以下格式链接的结果

```
http://somesite/Pages/News.aspx?itemId=12
```

其中 itemID 是新闻项的 ID。

我可以自定义结果中的链接吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T16:40:30.347

您可以使用核心搜索结果 Web 部件自定义结果链接。如果您修改 Web 部件的共享属性，所有这些都在可用的 XSL 中。

问题是此页面旨在显示所有类型的搜索结果，包括 SharePoint 中的文档、可能在 SharePoint 之外的文件、网页、业务数据等。

您可能希望拥有一个使用特定范围或托管属性查询的自定义搜索结果页面，以便您可以确保结果将是列表项。这可能无需任何编码即可完成（如果您不考虑 XSL 编码），您仍然可以使用核心搜索结果 Web 部件。

另一个选项可能类似，但使用数据表单/视图 Web 部件（通过 SharePoint Designer）或内容查询 Web 部件（需要发布基础结构功能）。

# language-agnostic - 理论，可逆解析器的例子？

> ID：662041
> 
> 赞同：4
> 
> 时间：2009-03-19T12:31:00.953
> 
> 标签：language-agnostic, parsing, code-generation, theory

有没有人知道解析器背后的示例和理论，它们将采用（也许）抽象语法树并生成代码，而不是反之亦然。在数学上，至少在直觉上，我相信 code->AST 的功能是可逆的，但我正在努力寻找这方面的工作/示例......除了 Dragon book 等常用资源之外。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T12:35:53.313

这样的东西被称为访客。Is 遍历树并做任何必须做的事情，例如优化或生成代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-18T20:42:10.240

我们的[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)坚持将解析器和逆解析器（称为“prettyprinters”）作为对任意语言进行机械处理（分析/转换）的“扑克赌注”。这些提供了完整的往返：源文本到 AST，带有捕获的位置信息（文件/行/列）和注释，以及 AST 到合法源文本，包括重新生成原始令牌位置（“保真打印”）或格式良好（“漂亮打印” ) 选项，包括评论的再生。

解析器通常由语法和词法定义的组合来指定；这些符号通常被编译成高效的解析引擎，正如您所料，DMS 为“解析器”端执行此操作。这里的其他人建议“访问者”是进行漂亮打印的方式，并且像汇编代码一样，它是在最低抽象级别实现漂亮打印的正确方法。但是，DMS 漂亮打印机[是根据文本框构造语言指定的](http://www.semdesigns.com/Products/DMS/DMSPrettyPrinters.html?site=StackOverflow)在诸如 Latex 之类的语法术语上，它使人们能够控制各种语言元素的水平、垂直、嵌入、间隔、连接、层压等的位置。DMS 将这些编译成有效的低级访问者（正如其他答案所暗示的那样），实现盒子一代。但就像解析器生成器一样，您并没有看到所有丑陋的细节。

DMS 有大约 30 多套这些[语言前端](http://www.semanticdesigns.com/Products/FrontEnds/)，用于各种编程语言和正式符号，范围从 C++、C、Java、C#、COBOL 等到 HTML、XML、来自某些机器的汇编语言、临时属性规范、规范用于可组合的抽象代数等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T12:58:38.687

我更喜欢 lewap 的回应：

> 找到一种表达访问者的数学方法，并且您对解析器具有双重性

但是您要求提供样本，因此请试一下大小：Visual Studio 包含一个具有出色对称性的 UML 编辑器。它和编辑器的实现方式都构成模型的视图，并且编辑任一修改模型导致所有保持同步。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-17T10:51:35.690

实际上，从解析树生成代码比解析代码更容易，至少在数学意义上是这样。有许多语法是模棱两可的，也就是说，没有唯一的方法来解析它们，但是解析树总是可以以唯一的方式转换为字符串，模空格。

[Dragon 书](http://dragonbook.stanford.edu/)很好地描述了解析器的理论。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-02-19T00:30:58.973

Haskell 中有可逆解析的理论、工作实现和示例。图书馆由 Paweł Nowak 设计。请参考 [https://hackage.haskell.org/package/syntax](https://hackage.haskell.org/package/syntax) 作为您的起点。您可以在以下 URL 中找到示例。

*   [https://hackage.haskell.org/package/syntax-example](https://hackage.haskell.org/package/syntax-example)
*   [https://hackage.haskell.org/package/syntax-example-json](https://hackage.haskell.org/package/syntax-example-json)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T13:01:18.960

我不知道在哪里可以找到有关该理论的更多信息，但[boost::spirit 2.0](http://www.boost.org/doc/libs/1_38_0/libs/spirit/doc/html/index.html)具有 qi（解析器）和[karma](http://osdir.com/ml/parsers.spirit.devel/2006-04/msg00019.html)（生成器），共享相同的底层结构和语法，因此它是该概念的实际实现。

生成器方面的文档仍然很薄（spirit2 在 Boost 1.38 中是新的，并且仍处于测试阶段），但是周围有一些 karma 示例代码，并且 AFAIK 库处于工作状态并且至少有一些可用的[例子](http://svn.boost.org/svn/boost/trunk/libs/spirit/example/karma/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T01:12:37.713

除了“Visitor”，“unparser”是另一个很好的网络搜索关键字。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T01:42:36.160

这听起来很像非优化编译器的后端，它的目标语言与源语言相同。

一个问题是您是否需要“未解析”代码与原始代码相同，或者只是功能上等效。

例如，输出是否可以使用与原始样式不同的缩进样式？该信息通常不会存储在 AST 中，因为它在语义上并不重要。

要看的一件事是自动代码重构工具。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-20T21:35:30.660

我一直在做这些，并称它们为“DeParse”。

如果您还想重新捕获空白和注释，它只会变得棘手。您必须将它们塞入解析树中，以便在输出时重新生成它们。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-03-19T17:40:15.780

“访客模式”的想法很好。但是，我应该将“访问者”模式视为线性列表模式，或者作为通用模式，并为更具体的情况添加模式，如列表、矩阵和树。

在网络上寻找“分层访问者模式”或“树访问者模式”。

您有一个树数据结构（“集合”）并且想要对数据做一些事情，每次您“访问”、“迭代”或“读取”树中的一个项目。

在您的情况下，您有一个树数据结构，它表示扫描/解析某些源代码的结果。然后您已读取每个项目的数据，并将其转换为目标代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-09-19T18:30:05.663

有几种“镜头语言”允许对源代码进行[双向转换](https://en.wikipedia.org/wiki/Bidirectional_transformation)。

也可以使用Prolog中的[明确子句语法来实现可逆解析器。](https://en.wikipedia.org/wiki/Definite_clause_grammar)在 SWI-Prolog 中，[短语/3](http://www.swi-prolog.org/pldoc/man?predicate=phrase/3)谓词将解析树转换为文本，反之亦然。[本书](https://books.google.com/books?id=Hj70BwAAQBAJ&pg=PA177&lpg=PA177&dq=prolog+reversible&source=bl&ots=vnfqLaU_14&sig=tjzoA31S3mLaGmoAsn4alaEuL4Y&hl=en&sa=X&ved=0ahUKEwj71-eHhpzPAhXCdR4KHU4FDKwQ6AEIUDAI#v=onepage&q=prolog&f=false)提供了一些额外的 Prolog 可逆解析示例。

# sql-server - 动态 SQL 结果到 SQL 存储过程中的临时表中

> ID：662049
> 
> 赞同：50
> 
> 时间：2009-03-19T12:35:18.197
> 
> 标签：sql-server, tsql, dynamic-sql

代码如下：

```
ALTER PROCEDURE dbo.pdpd_DynamicCall 
@SQLString varchar(4096) = null

AS

Begin

    create TABLE #T1 ( column_1 varchar(10) , column_2 varchar(100) )

    insert into #T1 
        execute ('execute ' + @SQLString )

    select * from #T1 

End 
```

问题是我想调用可以返回不同列的不同程序。因此，我必须笼统地定义表#T1。但我不知道怎么做。

谁能帮我解决这个问题？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-03-19T12:56:56.117

尝试：

```
SELECT into #T1 execute ('execute ' + @SQLString ) 
```

这闻起来真的很糟糕，就像一个 sql 注入漏洞。

* * *

**更正**（根据@CarpeDiem 的评论）：

```
INSERT into #T1 execute ('execute ' + @SQLString ) 
```

`'execute'`另外，如果 sql 字符串不是过程，则省略

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-06-16T18:50:33.577

您可以在动态插入表时动态定义表，但问题在于临时表的范围。例如，这段代码：

```
DECLARE @sql varchar(max)
SET @sql = 'CREATE TABLE #T1 (Col1 varchar(20))'
EXEC(@sql)
INSERT INTO #T1 (Col1) VALUES ('This will not work.')
SELECT * FROM #T1 
```

将返回错误“无效的对象名称'#T1'。” 这是因为临时表 #T1 是在比执行代码块“更低的级别”创建的。为了修复，请使用全局临时表：

```
DECLARE @sql varchar(max)
SET @sql = 'CREATE TABLE ##T1 (Col1 varchar(20))'
EXEC(@sql)
INSERT INTO ##T1 (Col1) VALUES ('This will work.')
SELECT * FROM ##T1 
```

希望这会有所帮助，杰西

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2010-11-15T16:03:48.887

请注意全局临时表解决方案，因为如果两个用户同时使用相同的例程，这可能会失败，因为所有用户都可以看到全局临时表...

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2013-03-15T17:26:54.270

动态创建名称中带有 GUID 的全局临时表。然后您可以通过 dyn sql 在您的代码中使用它，而不必担心另一个调用相同 sproc 的进程会使用它。当您不知道每次运行时从基础选定表中期待什么时，这很有用，因此您无法事先显式创建临时表。即 - 你需要使用 SELECT * INTO 语法

```
DECLARE @TmpGlobalTable varchar(255) = 'SomeText_' + convert(varchar(36),NEWID())

-- select @TmpGlobalTable 

-- build query
    SET @Sql = 
        'SELECT * INTO [##' + @TmpGlobalTable + '] FROM SomeTable'
EXEC (@Sql)
EXEC ('SELECT * FROM [##' + @TmpGlobalTable + '] ')
EXEC ('DROP TABLE [##' + @TmpGlobalTable + ']')
PRINT 'Dropped Table ' + @TmpGlobalTable 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-06-14T22:29:39.563

```
INSERT INTO #TempTable
EXEC(@SelectStatement) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-31T11:01:03.480

```
DECLARE @EmpGroup INT =3 ,
        @IsActive BIT=1

DECLARE @tblEmpMaster AS TABLE
        (EmpCode VARCHAR(20),EmpName VARCHAR(50),EmpAddress VARCHAR(500))

INSERT INTO @tblEmpMaster EXECUTE SPGetEmpList @EmpGroup,@IsActive

SELECT * FROM @tblEmpMaster 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-11-22T08:29:58.677

```
CREATE PROCEDURE dbo.pdpd_DynamicCall 
AS
DECLARE @SQLString_2 NVARCHAR(4000)
SET NOCOUNT ON
Begin
    --- Create global temp table
    CREATE TABLE ##T1 ( column_1 varchar(10) , column_2 varchar(100) )

    SELECT @SQLString_2 = 'INSERT INTO ##T1( column_1, column_2) SELECT column_1 = "123", column_2 = "MUHAMMAD IMRON"'
    SELECT @SQLString_2 = REPLACE(@SQLString_2, '"', '''')

    EXEC SP_EXECUTESQL @SQLString_2

    --- Test Display records
    SELECT * FROM ##T1

    --- Drop global temp table 
    IF OBJECT_ID('tempdb..##T1','u') IS NOT NULL
    DROP TABLE ##T1
End 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-03-18T11:03:29.677

**尝试下面的代码，使用 T-SQL 从存储过程输出动态创建临时表**

```
declare @ExecutionName varchar(1000) = 'exec [spname] param1,param2 '
declare @sqlStr varchar(max) = ''

   declare @tempTableDef nvarchar(max) =   
  (  
  SELECT distinct   
   STUFF(  
    (  
     SELECT ','+a.[name]+' '+[system_type_name]  
  +'  
   ' AS [text()]  
     FROM sys.dm_exec_describe_first_result_set  (@ExecutionName, null, 0) a  
     ORDER BY a.column_ordinal  
     FOR XML PATH ('')  
    ), 1, 1, '') tempTableDef   

  FROM sys.dm_exec_describe_first_result_set  (@ExecutionName, null, 0) b  
  )  

  IF ISNULL(@tempTableDef ,'') = '' RAISERROR( 'Invalid SP Configuration. At least one column is required in Select list of SP output.',16,1) ;    

  set @tempTableDef='CREATE TABLE #ResultDef   
  (  
  ' + REPLACE(@tempTableDef,'&#x0D;','') +'  
  )  

  INSERT INTO #ResultDef   
  ' + @ExecutionName    

  Select  @sqlStr  = @tempTableDef +' Select * from  #ResultDef '   
exec(@sqlStr) 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-19T12:40:16.080

不确定我是否理解得很好，但也许您可以在字符串中形成 CREATE 语句，然后执行该字符串？这样您就可以根据需要添加任意数量的列。

# perl - 如何在 Perl 中评估环境变量？

> ID：662050
> 
> 赞同：-4
> 
> 时间：2009-03-19T12:35:42.407
> 
> 标签：perl, environment-variables

我想评估一个环境变量并将结果设置为一个变量：

```
$x=eval($ENV{EDITOR});
print $x; 
```

输出：

```
/bin/vi 
```

工作正常。

如果我将环境变量 QUOTE 设置为 \' 并尝试相同的操作：

```
$x=eval($ENV{QUOTE});
print $x; 
```

输出：

（没有）

```
$@ set to: "Can't find a string terminator anywhere before ..." 
```

我不希望简单地设置`$x=$ENV{QUOTE};`，因为 eval 也用于调用脚本并返回其最后一个值（非常方便），所以我想坚持使用 eval(); 请注意，以这种方式评估的所有环境变量都是由我在不同的地方设置的，因此我不关心恶意访问以这种方式评估的环境变量。

建议？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-19T12:45:02.340

好吧，当然它什么也没做。

如果您的 ENV 变量包含一半代码的文本，但不是，并且您将生成的字符串提供给将该代码评估为 Perl 的东西，**那么**它**当然**不会起作用。

您只有 3 个选项：

1.  以编程方式处理字符串，使其中没有无效的语法
2.  手动确保您的 ENV 变量不是垃圾
3.  找到一个不涉及**eval**但给出正确结果的解决方案。

你也可以抱怨

```
 $x = ' 
```

不是有效的代码，因为这基本上就是正在发生的事情。

## 固定 'QUOTE' 的值以工作的示例

```
# Bad. 
QUOTE="'" perl -wWe 'print eval $ENV{QUOTE}; print "$@"'
#  Can't find string terminator "'" anywhere before EOF at (eval 1) line 1.

# Bad. 
QUOTE="\'" perl -wWe 'print eval $ENV{QUOTE}; print "$@"'
#  Can't find string terminator "'" anywhere before EOF at (eval 1) line 1.

# Bad. 
QUOTE="\\'" perl -wWe 'print eval $ENV{QUOTE}; print "$@"'
#  Can't find string terminator "'" anywhere before EOF at (eval 1) line 1.

# Good
QUOTE="'\''" perl -wWe 'print eval $ENV{QUOTE}; print "$@"' 
# ' 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-19T15:06:33.077

你为什么要[`eval`](http://perldoc.perl.org/functions/eval.html)摆在首位？你应该说

```
my $x = $ENV{QUOTE};
print "$x\n"; 
```

`eval`就像执行 Perl 代码一样执行字符串，`$ENV{QUOTE}`我当然希望它不是。这就是 \ 消失的原因。如果您要检查`$@`变量，您会发现一条错误消息，例如

(eval 1) 第 2 行，EOF 处的语法错误

如果您的环境变量将包含 Perl 应该执行的代码，那么您应该查看[Safe](http://search.cpan.org/dist/Safe/)模块。它允许您控制可以在其中执行的代码类型，`eval`这样您就不会意外地执行类似的代码`"use File::Find; find sub{unlink $File::Find::file}, '.'"`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-19T17:41:13.240

评估环境值是**非常**危险的，如果在污染模式下运行会产生错误。

```
# purposely broken
QUOTE='`rm system`' 
```

```
$x=eval($ENV{QUOTE});
print $x; 
```

现在想象一下这个脚本是否以 root 访问权限运行，并被更改为实际删除文件系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-22T18:19:27.633

肯特的回答虽然在技术上是正确的，但没有抓住重点。解决的办法不是`eval`更好用，而是根本不用`eval`！

这个问题的症结似乎在于理解是什么`eval STRING`（`eval BLOCK`尽管名称相同，但它是完全不同的）。它接受一个字符串并将**其作为 Perl 代码运行**。99.99% 这是不必要的和危险的，会导致意大利面条代码，你绝对不应该在你的 Perl 编程生涯的早期使用它。你在你爸爸的袜子抽屉里找到了枪。发现它可以在你现在试图用它挂海报的东西上打洞。最好忘记它的存在，你的代码会更好。

`$x = eval($ENV{EDITOR});`不做你认为它做的事。我什至不必知道你认为它做了什么，你甚至在那里使用它意味着你不知道。我也知道你是在关闭警告的情况下运行的，因为 Perl 会因此而对你大喊大叫。为什么？假设`EDITOR`设置为`/bin/vi`. 以上等价于`$x = /bin/vi`which 甚至不是有效的 Perl 代码。

```
$ EDITOR=/bin/vi perl -we '$x=eval($ENV{EDITOR}); print $x'
Bareword found where operator expected at (eval 1) line 1, near "/bin/vi"
    (Missing operator before vi?)
Unquoted string "vi" may clash with future reserved word at (eval 1) line 2.
Use of uninitialized value $x in print at -e line 1. 
```

我不确定你最初是如何让它工作的。我怀疑你在你的例子中遗漏了一些东西。也许调整 EDITOR 直到它起作用？

您不必做任何神奇的事情来读取环境变量。只是`$x = $ENV{EDITOR}`。完毕。 `$x`现在`/bin/vi`如你所愿。它只是一样`$x = $y`。与 QUOTE 相同。

```
$ QUOTE=\' perl -wle '$x=$ENV{QUOTE}; print $x'
' 
```

完毕。

现在，我怀疑您真正想要做的是运行该编辑器并在某些 shell 命令中使用该引号。我对吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T12:41:27.637

好吧，我猜你可以双重转义 QUOTE 的值，因为你*知道*它会被`eval`编辑。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T19:58:09.467

也许你想要的不是 Perl ，而是*像 shell 一样*`eval`评估环境变量。为此，您需要使用反引号。

 *```
$x = `$ENV{QUOTE}` 
```

# multithreading - 线程在 Nunit 中不能正常工作吗？

> ID：662066
> 
> 赞同：0
> 
> 时间：2009-03-19T12:43:05.387
> 
> 标签：multithreading, nunit

我认为当涉及线程代码时 nunit 无法正常运行：

这是示例代码：

```
public class multiply
{
    public Thread myThread;
    public int Counter
    {
        get;
        private set;
    }
    public string name
    {
        get;
        private set;
    }
    private Object thisLock = new Object();
    public void RunConsolePrint()
    {
        //lock(thisLock)
        //{
        Console.WriteLine("Now thread " + name + " has started");
        for (int i = 1; i<= Counter; i++)
        {
            Console.WriteLine(name + ": count has reached " + i+ ": total count is "+Counter);
        }
        Console.WriteLine("Thread " + name + " has finished");
        //}
    }
    public multiply(string pname, int pCounter)
    {
        name = pname;
        Counter = pCounter;
        myThread = new Thread(new ThreadStart(RunConsolePrint));
    }
} 
```

这是测试代码：

```
[Test]
public  void Main()
{
    counter=100;

    multiply m2=new multiply("Second", counter);
    multiply m1 = new multiply("First", counter);
    m1.myThread.Start();
    m2.myThread.Start();

} 
```

并且输出是 and 的顺序运行`m1`，`m2`这意味着循环`m1`总是**在**before 之前执行`m2`，至少这是我的测试显示的。我进行了几次测试，我总是得到这个。

这是一个错误吗？还是预期的行为？

**如果我把上面的代码复制到一个控制台程序中运行，就可以清楚的看到线程的效果。**

我正在使用 TestDriven.net runner 进行测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T12:54:18.417

无法真正预测两个或多个线程的确切交错。

您的示例需要考虑几个因素。首先，每个线程将在（可能）切换到另一个线程之前执行其量子。您不能期望线程切换会发生在代码中的任何特殊位置。即一个线程可能在另一个线程启动之前完成（特别是因为在您的情况下任务相对较短）。

其次，由于您正在写入控制台，因此线程在该访问时同步。这也会影响交织。

结果还取决于机器上可用内核的数量（以及运行代码时机器上的一般负载）。

简而言之，您无法预测这两个线程将如何运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T12:49:59.003

是否先执行`m1`或`m2`开始执行是不确定的。如果计数器执行得足够快，看到其中一个在另一个开始之前完成，我不会感到惊讶。将计数更改为非常大的值（例如一百万），我很确定您会看到单独的线程同时执行。

任何结果都是可能的 - 您看到什么结果表明存在错误？

# wpf - 如何进一步将这个 WPF 示例与 MVC、MVP 或 MVVM 解耦？

> ID：662072
> 
> 赞同：2
> 
> 时间：2009-03-19T12:45:21.403
> 
> 标签：wpf, events, mvvm, mvp, decoupling

我通过以下方式解耦了此 WPF 应用程序中的事件。

继续解耦的最佳方式是什么？

**Shell.xaml：**

```
<Button x:Name="btnProcess"
        Content="Process"
        Margin="10"/> 
```

**引导程序.cs：**

```
public void Run()
{
    Shell shell = new Shell(new Customer());
    shell.Show();
} 
```

**Shell.xaml.cs：**

```
public Shell(IPerson person)
{
    InitializeComponent();
    btnProcess.Click +=new RoutedEventHandler(person.Process);
} 
```

**客户.cs：**

```
public class Customer : IPerson
{
    public void Process(object sender, RoutedEventArgs e)
    {
        Button theButton = (Button)sender;
        theButton.Content = "Customer processed.";
    }
} 
```

上面的代码成功地将视图`Shell`与模型分离，`Customer:IPerson`以便我可以交换模型`Employee:IPerson`等，它以自己的方式处理“已处理”。那是第一个目标。

但现在：

*   **如何将`Processed`方法与专门与 Button 对话**分离，以便它也可以与在视图中触发事件的 MenuItem 或 ListView 对话，这样它甚至不必是调用它的元素，例如单元测试类？
*   **除了发送者（按钮）之外，我如何更改视图的其他元素**，例如，我将如何更改 Shell 中的状态栏？我看到两种方法：
    *   我可以**构建一个包含**所有视图的容器，并在创建时将容器注入到客户中，然后客户可以查看容器并根据需要操作调用视图（尽管我必须以某种方式匹配发送事件的视图和容器中的视图相同）
    *   我可以在触发事件时以某种方式**将整个视图（Window 对象）发送到带有 eventargs**的模型，尽管模型需要某种方式来了解（通过接口）在运行时可以操作哪些类型的区域
*   **您将如何继续**这个应用程序朝着更加解耦的设计方向发展？
*   **这**实际上是什么模式，例如 MVC、MVP、MVVM？我只看到一个视图（Shell）和一个模型（客户）。
    *   演示者如何适应？
    *   ViewModel 如何适应？
    *   控制器如何适应？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T12:59:03.647

我建议您使用命令而不是经典事件来实现事件处理。它在 WPF 中非常简单，因为命令模式已经实现，并且您可以告诉所有 UI 输入（按钮、菜单项...）它们的命令是 [命令名称] 并在一个地方处理所有这些。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T11:52:52.760

Cameron MacFarland 在这里做得很好，但我可以补充一点。

跟随 MV-VM 时，你的解耦工具是数据绑定、命令、附加行为和接口。数据绑定应该是不言而喻的。您已经对命令进行了很好的描述，但我建议您避免使用 RoutedCommand 并坚持使用 ICommand 实现。附加行为是附加的 DependencyProperty，它们订阅它们所附加的元素上的事件，在这种情况下，将用于将事件处理中继到 ViewModel。接口为您提供了最大的灵活性，但您必须弄清楚如何将接口传递给 ViewModel。现在学习所有这些的最好方法是去谷歌看看现有的 MV-VM 框架。以下是框架列表：

*   棱镜/复合 WPF ( [http://www.codeplex.com/CompositeWPF](http://www.codeplex.com/CompositeWPF) )。这个来自 Microsoft Patterns & Practices 小组。这里有很多好东西，但是您可以从这里学到的上述三件事的示例之一是如何使用 ICommand。Prism 包含一个 DelegateCommand，它实现了 ICommand 并简化了在 MV-VM 中使用来自 ViewModel 的命令。

*   Caliburn ( [http://www.codeplex.com/caliburn](http://www.codeplex.com/caliburn) )。最近发布的，您可以从中学到的关键内容之一是如何使用附加行为，该库将其用于它的“Actions”。

*   Onyx ( [http://www.codeplex.com/wpfonyx](http://www.codeplex.com/wpfonyx) )。免责声明：我是这个的作者。这个尚未发布，尽管当前的 alpha 源可用。这为如何为 ViewModel 提供接口的问题提供了一种新颖的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T14:09:40.857

正如陈建议的那样，我会研究命令模式：[路由命令](http://joshsmithonwpf.wordpress.com/2008/03/18/understanding-routed-commands/)

我从中学到了很多东西的一个工作示例可以在 Jaime Rodriquez 他的博客上找到：[Southridge](http://blogs.msdn.com/jaimer/archive/2009/02/10/m-v-vm-training-day-sample-application-and-decks.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T14:12:54.907

**如何将 Processed 方法与专门与按钮**
命令的对话分离。将命令放入 IPerson 接口并从 Shell 的 xaml 调用该命令。

**如何更改视图**
属性和绑定的其他元素。如果您有显示状态（已处理/未处理）的属性，则可以使用绑定直接在 xaml 中显示该属性。

**你将如何继续**
我将通过在 Shell 和 IPerson 之间创建一个 ViewModel 来进一步了解 MVVM 路径。ViewModel 旨在具有 1) 绑定所需的属性，以及 2) 需要执行的任何命令。ViewModel 旨在为 UI 提供模型所需的内容。

**这是目前的什么模式**
？没有。我只看到两个对象，视图和模型。你没有 Presenter、Controller 或 ViewModel。

对于 WPF，我更喜欢 ViewModel。有关 MVVM 的更多信息，请参阅[此](https://stackoverflow.com/questions/483367/are-there-any-good-books-on-m-v-vm-in-wpf)问题。

# windows-services - 为什么窗体在 Windows 服务中失败

> ID：662073
> 
> 赞同：0
> 
> 时间：2009-03-19T12:45:39.827
> 
> 标签：windows-services

我了解 Window 的服务没有桌面，并且无法直接访问任何用户的桌面（实际上，它们可以在没有加载桌面的情况下运行）。为什么在 Window 的服务中启动表单会导致错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T12:56:40.533

嗯...该表格将出现在什么和谁的桌面上，究竟是什么？“桌面”是一个操作系统概念：每个窗口句柄由属于单个（交互式）用户的窗口站内的特定桌面拥有。执行服务的进程不会在其窗口站中找到用户的可见桌面。有关相当枯燥的参考，请查看[MSDN](http://msdn.microsoft.com/en-us/library/ms681928(VS.85).aspx)。

实际上，[它甚至更糟](http://msdn.microsoft.com/en-us/library/ms687105(VS.85).aspx)。您也许可以为该服务配置权限以便能够创建桌面——但是没有人会看到它！或者，您可以授予该进程切换桌面的权限，并让用户感到困惑！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T12:57:36.257

服务应该在没有任何用户交互的情况下运行，因此不需要表单。如果服务必须等待用户反馈，那么它可能不会做它应该做的事情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T13:53:34.453

您必须了解三个相关概念：会话、Windows 站和桌面。但是由于会话和站点之间存在一对一的关系，因此我们可以在此讨论中广泛地忽略站点。一个会话包含一个站（winSta0 是唯一的交互式站）并且站包含一个或多个桌面。

现在会话架构因 Windows 版本而异。对于 NT <= 5（XP/2003 和之前的所有内容），服务与交互式用户的应用程序一起在会话 0 中执行。这就是为什么您可以在这些 Windows NT 版本中配置服务以与桌面交互的原因——它们在同一个会话中。对于 NT >= 6（Vista、Server 2008 以后的版本），服务存在于会话 0 中，但交互式桌面位于另一个会话中。这就是所谓的“服务强化”，基本上是一种安全修复。

因此，由于会话 0 应用程序无法访问交互式控制台，因此它们尝试显示任何类型的用户界面都是没有意义的。

只是为了让这更令人困惑，Vista 有一个临时组合来应对这种情况：如果会话 0 中的应用程序试图创建一个对话框，Windows 将捕获它并向用户发出警告，以便他们切换到一个（我认为是临时的) 桌面，他们可以在其中与对话框进行交互。但是，此措施显然是临时的，您不能依赖它在未来的 Windows 版本中。我已经看到这在本机代码中工作，但我怀疑您在托管代码中，并且运行时足够聪明，可以捕捉到您的行为并向后躯发出隐喻的耳光:-)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T12:54:16.903

因为如果没有人会看到表单，也没有人会关闭它 - 运行模式对话框是导致挂起的秘诀 - 所以你希望它在发生这种情况时大声抱怨，而不是静静地坐在那里直到你终止进程（或查看堆栈跟踪以确定发生了什么）。（另一个明显的问题是，如果有多种可能性，谁会选择 DialogResult？）您想知道这种情况何时发生。（断言如果不能显示任何内容就不会抛出的对话框是一种让人们发疯的有趣方式。）。

换句话说，因为您想知道代码中的事情何时足够混乱，以至于在服务上下文中显示了一个对话框。

（我假设您在 .NET 上使用 Windows 窗体，尽管您没有这样标记它）

（如果您正确配置了允许服务与桌面交互的内容，则不会出现异常）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T14:13:37.993

您必须启用一项设置才能允许您的 Windows 服务直接访问某些文件夹（如桌面）或显示表单（包括 MessageBox 弹出窗口）：“允许服务与桌面交互”

要查看此内容，请右键单击我的电脑 => 管理 => 服务和应用程序 => 服务。双击服务以访问其属性。在“登录”选项卡上，有一个用于此设置的复选框。

[这是](http://www.codeproject.com/KB/install/cswindowsservicedesktop.aspx)一篇关于如何在 C# 中以编程方式设置它的文章

**[编辑]**正如斯蒂芬马丁在评论中指出的那样：这只是对 Windows 的 Vista 之前版本的有效建议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-20T17:15:47.447

当 Windows 服务启动时，它会根据有据可查的规则分配给 Window Station 和 Desktop，尽管有些晦涩难懂。正如在别处提到的，它没有分配给交互式桌面（除非它被设置为与预 Vista 操作系统上的桌面交互），但它肯定在桌面中运行。

服务不能使用 UI 元素是一个常见的误解。事实上，许多服务（例如 SQL Server）过去曾使用隐藏窗口和窗口消息来实现线程同步和工作分配目的。没有理由不能在服务中显示表单。如果您收到错误，那是由于您正在对表单或表单上的某些组件执行某些操作。最可能的问题与您是否需要表单的 STA 线程，或者您是否为表单创建消息泵或类似的东西有关。

虽然您当然可以在 Windows 服务中使用表单，但您几乎肯定不应该这样做。会有线程问题、跨单元调用问题、可能的阻塞 UI 问题等。在极少数情况下，在服务中使用窗口是一个不错的选择，但在 99.99% 的情况下，有更好的方法，没有 UI所有情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T13:01:56.697

因为在操作系统需要绘制窗口的时候，没有任何东西可以绘制窗体。

# asp.net - 如何在 ASP.NET 应用程序中有效地缩放和裁剪图像？

> ID：662080
> 
> 赞同：4
> 
> 时间：2009-03-19T12:50:35.617
> 
> 标签：asp.net, image

我们在使用允许用户上传和裁剪图像的 ASP.NET 应用程序时遇到问题。之后图像都被缩放到固定大小。当处理一个大文件时，我们基本上会耗尽内存；似乎 JPEG 的处理效率很低——我们使用的是 System.Drawing.BitMap。你有什么一般性的建议，也许还有一些指向更高效的图像处理库的建议吗？你有什么经验？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T13:01:34.983

我遇到了同样的问题，解决方案是使用 System.Drawing.Graphics 进行转换并在完成后立即处理每个位图对象。这是我的库中的一个示例（调整大小）：

```
 public Bitmap ApplyTo(Bitmap bitmap)
    {
        using (bitmap)
        {
            Bitmap newBitmap = new Bitmap(bitmap, CalculateNewSize(bitmap));

            using (Graphics graphics = Graphics.FromImage(newBitmap))
            {
                graphics.SmoothingMode =
                    SmoothingMode.None;
                graphics.InterpolationMode =
                    InterpolationMode.HighQualityBicubic;
                graphics.CompositingQuality =
                    CompositingQuality.HighQuality;

                graphics.DrawImage(
                    bitmap,
                    new Rectangle(0, 0, newBitmap.Width, newBitmap.Height));
            }

            return newBitmap;
        }
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-17T07:16:54.480

我发现[imageresizer](http://imageresizing.net/)和它的伟大。和良好的 API。效果很好。从 Visual Studio 2010 扩展管理器下载：http: [//nuget.org/](http://nuget.org/)。

在 VS-2010 中下载 API 的简单步骤：

**1）。安装扩展[http://nuget.org/](http://nuget.org/)。**

![在此处输入图像描述](https://i.stack.imgur.com/l7d67.jpg)

**3）。查找并安装 ImageResizing**
![在此处输入图像描述](https://i.stack.imgur.com/1HSPo.jpg)

**4）然后代码：（我在这里使用裁剪。你可以使用任何） imageresizing.net 上的文档**

```
string uploadFolder = Server.MapPath(Request.ApplicationPath + "images/");
FileUpload1.SaveAs(uploadFolder + FileUpload1.FileName);

//The resizing settings can specify any of 30 commands.. See http://imageresizing.net for details.
ResizeSettings resizeCropSettings = new ResizeSettings("width=200&height=200&format=jpg&crop=auto");

//Generate a filename (GUIDs are safest).
string fileName = Path.Combine(uploadFolder, System.Guid.NewGuid().ToString());

//Let the image builder add the correct extension based on the output file type (which may differ).
fileName = ImageBuilder.Current.Build(uploadFolder + FileUpload1.FileName, fileName, resizeCropSettings, false, true);
```

尝试！！！它非常糟糕且易于使用。谢谢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T13:02:31.050

脑海里浮现出几个念头——

1.  你允许你的用户上传多大的图片，你可以对此施加限制吗？

2.  当您使用 `System.Drawing.Bitmap`该类时，您是否记得正确处理它？`System.OutOfMemoryException`我们发现在我们的共享托管平台上出现异常的主要原因之一是用户没有`Bitmap`正确处理对象。

凯夫

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T13:21:20.427

.net 有一个较旧的错误，即所有图像默认为每像素 32 位 - 在这种大小下，您可能会很快耗尽内存。请使用 PixelFormat 结构来确保您的问题不是这种情况。

此链接可能会有所帮助：http: [//msdn.microsoft.com/en-us/library/aa479306.aspx](http://msdn.microsoft.com/en-us/library/aa479306.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T12:57:51.170

您是否有要查看的堆栈跟踪？

在用户上传图像后，我还进行了一些图像编辑。我遇到的唯一问题是浏览器上文件上传大小的限制和超时。但与.Net 的库无关。

还有其他要考虑的。如果您正在制作多个图像或在某处有一些危险的循环，那么您是否确保 flush() 和 dispose() 东西。

# c++ - C++中定义的WIN32和_WIN32有什么区别

> ID：662084
> 
> 赞同：84
> 
> 时间：2009-03-19T12:52:38.903
> 
> 标签：c++, c-preprocessor

我知道这`WIN32`表示 win32 编译，但它是`_WIN32`用来做什么的？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-03-19T15:05:31.847

详细说明（Neil Butterworth 和 blue.tuxedo 已经给出了正确答案）：

*   `WIN32`由 SDK 或构建环境定义，因此不使用实现保留的命名空间
*   `_WIN32`由**编译器**定义，因此它使用下划线将其放置在实现保留的命名空间中

您会发现一组相似的双重定义，它们的名称和用途几乎相同，例如`_UNICODE`/ `UNICODE`、`_DEBUG`/`DEBUG`或可能`_DLL`/ `DLL`（我认为只有 UNICODE 的定义在其不同版本中有很多用途）。尽管有时在这些情况下（如），它们不是*由*`_UNICODE`编译器定义的下划线版本，而是用于控制 CRT 标头的作用：

 **   `_UNICODE`告诉 CRT 标头 CRT 名称可以是 Unicode 或 ANSI（例如`_tcslen()`应该映射到宽字符变体 ( `wcslen()`)
*   `UNICODE`对 SDK 执行类似的操作（将 Win32 API 映射到它们的“ `W`”变体）

本质上，带有下划线的版本由编译器团队控制或使用，不带下划线的版本由编译器外部的团队控制/使用。当然，由于与过去版本的兼容性以及一个团队或另一个团队的一般错误，可能会有很多重叠。

我发现它令人困惑——并且发现它们在用户代码中几乎可以互换使用（通常，当您看到一个定义时，您会在同一个地方看到另一个定义，因为如果您需要一个，则需要另一个）。就个人而言，我认为您应该*使用*不带下划线的版本（除非您正在编写编译器的运行时），并确保在定义它们时它们都被定义（无论是通过听众还是编译器切换）。

* * *

请注意，SDK 将`_WIN32`在为 Mac 构建时定义，因为编译器没有，有点超出了它的界限。我不确定哪些项目使用 Win32 API 和针对 Mac 的编译器 - 可能是某些版本的 Office for the Max 之类的。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-03-19T12:57:02.840

`WIN32`是您可以在自己的代码中使用甚至定义的名称，因此可能与 Microsoft 的用法发生冲突。`_WIN32`是为实现者（在本例中为 Microsoft）保留的名称，因为它以下划线和大写字母开头 - 您不允许在自己的代码中定义保留名称，因此不会发生冲突。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-03-19T12:59:15.753

WIN32 是用户定义的标志，某些标头可能需要它。_WIN32 由可视化 C/C++ 编译器自动定义。由于它以 _ 开头，后跟大写字符，因此由实现保留（即 C/C++ 工具链提供程序）。

我更喜欢使用（阅读）_WIN32，对我来说似乎更安全。

# c# - 获取 html 元素顶部和左侧属性数据

> ID：662085
> 
> 赞同：0
> 
> 时间：2009-03-19T12:53:42.287
> 
> 标签：c#, html, mshtml

我正在使用 mshtml dll 开发一个助手，即，我正在尝试获取 htmll 元素的位置，当我尝试获取他的 style.posTop 值时，我有一个类型为 HTMLAnchorElementClass 的对象我得到了空引用异常

有更好的方法吗？

也许其他演员？

请帮忙

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T13:02:37.710

这是我找到的一个示例（您获取对元素对象的引用的方式可能不同，但无论如何请看一下：

```
Element = <however your get your element>;

//--- Determine real element size and position relative to the main page.
int ElementLeft = Element.offsetLeft;
int ElementTop = Element.offsetTop;
mshtml.IHTMLElement TmpElem = Element.offsetParent;
while (TmpElem != null)
{
     ElementLeft = ElementLeft + TmpElem.offsetLeft;
     ElementTop = ElementTop + TmpElem.offsetTop;
     TmpElem = TmpElem.offsetParent;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T12:59:46.093

尝试

```
element.offsetTop
element.offsetLeft 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-09T07:43:35.117

此方法不适用于此链接[http://s1.webstarts.com/VacationHome/rates.html](http://s1.webstarts.com/VacationHome/rates.html)。随着项目
旺季：

绝对最高价为 526，商品：$160 / nt 或 £95 / nt
绝对最高价为 545。btw 他们的距离太大

# c# - 防止命令提示符自动关闭（CS 脚本）

> ID：662086
> 
> 赞同：3
> 
> 时间：2009-03-19T12:53:50.353
> 
> 标签：c#, scripting, command-prompt

我正在尝试使用[CS-Script](http://www.csscript.net/)，我的问题是每次运行脚本时，控制台窗口都会在脚本退出时自动关闭。我怎样才能防止这种情况发生？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T12:56:59.347

如果您不想更改脚本本身，请打开命令窗口并从命令行执行脚本。脚本完成后控制台关闭的唯一原因是它是由脚本本身创建的。该脚本不会关闭您打开的控制台。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T13:00:25.187

我不知道你怎么称呼它，但你总是可以用你的脚本`"Ctrl + R" > cmd.exe /k [your command]`或`Console.ReadLine()`在你的脚本中调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T12:58:47.563

在脚本末尾添加 Console.Read() 是一种糟糕的方法。

# .net - 是否可以使用 silverlight 2/3 做安全套接字（不是 https）？

> ID：662098
> 
> 赞同：3
> 
> 时间：2009-03-19T12:57:39.610
> 
> 标签：.net, silverlight, sockets, ssl

我需要快速、安全地向客户推送消息（而不是通过轮询），向 silverlight 客户推送消息，是否可以使用 silverlight 进行安全套接字？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T13:06:17.857

我还没有检查过 SL3，但你没有带 SL2 的 SslStream 库。您可以这样做，但您需要推出自己的 SSL 和证书库，并将它们放在 SL2 提供的 TCP 套接字之上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T13:28:29.677

在 SL3 中，我认为这是可能的。SDK 文档“为 Silverlight 客户端构建双工服务”中有一个 HOW TO，当您希望将数据推送到 Silverlight 客户端时，它应该很有用。

该文档还显示了“BasicHttpSecurityMode”枚举，可用于使用 BasicHttpBinding 或 PollingDuplexHttpBinding 指定安全类型（我认为这将在您的情况下使用）。

注意：不是 SL 专家。

# opengl - 如何使用 GL_REPEAT 仅重复选择纹理图集？(OpenGL)

> ID：662107
> 
> 赞同：18
> 
> 时间：2009-03-19T12:59:04.943
> 
> 标签：opengl, graphics, textures, texture-mapping

**如何重复选择纹理图集？**

例如，我的精灵（选择）在纹理坐标内：

```
GLfloat textureCoords[]=
{
    .1f,  .1f,
    .3f,  .1f,
    .1f,  .3f,
    .3f,  .3f
}; 
```

然后我想将该精灵重复*N 次*到由以下定义的三角形条带（或四边形）：

```
GLfloat vertices[]=
{
   -100.f, -100.f,
    100.f, -100.f,
   -100.f,  100.f,
    100.f,  100.f
}; 
```

我知道这`GL_REPEAT`与 textureCoords 超出范围有关`[0,1]`。但是，这不起作用：（尝试重复 N = 10）

```
GLfloat textureCoords[]=
{
    10.1f,  10.1f,
    10.3f,  10.1f,
    10.1f,  10.3f,
    10.3f,  10.3f
}; 
```

我们看到我们的完整纹理图集重复...

**我将如何以正确的方式做到这一点？**

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-19T15:28:54.120

不能按照问题中描述的方式完成。OpenGL 的纹理坐标模式仅适用于整个纹理。

通常，要重复纹理，您会绘制一个比纹理所暗示的“更大”的多边形。例如，如果你有一个方形纹理，你想在更大的区域上重复多次（比如六次），你会绘制一个宽度是高度的六倍的矩形。然后将纹理坐标设置为 (0,0)-(6,1)，并将纹理模式设置为“重复”。在多边形上插值时，超过 1 的纹理坐标将由于启用重复而在纹理中“环绕”，导致纹理在矩形上映射六次。

没有一种纹理环绕模式支持问题中描述的那种操作，即它们都映射到完整的 [0,1] 范围，而不是某个任意子集。当您仅使用纹理的一部分进行纹理处理时，无法以使 OpenGL 仅在子矩形内重复它的方式指定较大的纹理坐标。

您基本上有两个选择：要么从现有纹理中创建一个仅包含您需要的精灵的新纹理，要么编写一个 GLSL 顶点程序来适当地映射纹理坐标。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-19T13:40:15.107

我不确定你能做到这一点。我认为OpenGL的纹理坐标模式只适用于整个纹理。使用图集时，您使用的是“子纹理”，因此您的纹理坐标永远不会接近 0 和 1，即发生缠绕和夹紧的正常限制。

可能有扩展来处理这个问题，我没有检查过。

编辑：通常，要重复纹理，您会绘制一个比纹理暗示的“更大”的多边形。例如，如果你有一个方形纹理，你想在更大的区域上重复多次（比如六次），你会绘制一个宽度是高度的六倍的矩形。然后将纹理坐标设置为 (0,0)-(6,1)，并将纹理模式设置为“重复”。在多边形上插值时，超过 1 的纹理坐标将由于启用重复而在纹理中“环绕”，导致纹理在矩形上映射六次。

如果没有图像，这有点粗略。

无论如何，当您只使用纹理的一部分进行纹理处理时，无法以使 OpenGL 仅在子矩形内重复它的方式指定更大的纹理坐标。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-19T14:03:03.603

没有一种纹理环绕模式支持您正在寻找的那种操作，即它们都映射到完整的 [0,1] 范围，而不是某个任意子集。您基本上有两个选择：要么从现有纹理中创建一个只有您需要的精灵的新纹理，要么编写一个 GLSL 像素程序来适当地映射纹理坐标。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-09T11:48:42.237

虽然这可能是一个老话题；这就是我最终这样做的方式：

一种解决方法是创建多个网格，将它们粘合在一起，包含纹理 UV 的子集。

例如：我有一个激光纹理包含在一个更大的纹理图集中，位于 U[0.05 - 0.1] 和 V[0.05-0.1]。

然后我会构建 N 个网格，每个网格都有 U[0.05-0.1] 和 V[0.05-0.1] 坐标。（N = length / texture.height；height 是我想要重复的纹理的尺寸。或者更简单：我想要重复纹理的次数。）

这种解决方案比必须在纹理后重新加载纹理更具成本效益。特别是如果你批处理所有渲染调用（你应该这样做）。

（OpenGL ES 1.0、1.1、2.0 - 移动硬件 2011）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-03-10T15:55:01.287

可以在着色器中使用 tex 坐标的模数来完成。该模组将重复您的子范围坐标。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-02-15T20:06:28.067

我在处理同一个问题时遇到了你的问题——尽管是在 HLSL 和 DirectX 中。我还需要 mip 映射并解决相关的纹理出血。

我是这样解决的：

```
min16float4 sample_atlas(Texture2D<min16float4> atlasTexture, SamplerState samplerState, float2 uv, AtlasComponent atlasComponent)
{
  //Get LOD
  //Never wrap these as that will cause the LOD value to jump on wrap
  //xy is left-top, zw is width-height of the atlas texture component
  float2 lodCoords = atlasComponent.Extent.xy + uv * atlasComponent.Extent.zw;  
  uint lod = ceil(atlasTexture.CalculateLevelOfDetail(samplerState, lodCoords));

  //Get texture size
  float2 textureSize;
  uint levels;
  atlasTexture.GetDimensions(lod, textureSize.x, textureSize.y, levels);

  //Calculate component size and calculate edge thickness - this is to avoid bleeding
  //Note my atlas components are well behaved, that is they are all power of 2 and mostly similar size, they are tightly packed, no gaps
  float2 componentSize = textureSize * atlasComponent.Extent.zw;
  float2 edgeThickness = 0.5 / componentSize;

  //Calculate texture coordinates
  //We only support wrap for now
  float2 wrapCoords = clamp(wrap(uv), edgeThickness, 1 - edgeThickness);
  float2 texCoords = atlasComponent.Extent.xy + wrapCoords * atlasComponent.Extent.zw;
  return atlasTexture.SampleLevel(samplerState, texCoords, lod);
} 
```

请注意，限制是 mip 级别以这种方式混合，但在我们的用例中完全没问题。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-03-19T13:58:54.393

做不到...

# silverlight-2.0 - 如何获取 Silverlight 程序的产品版本？

> ID：662113
> 
> 赞同：1
> 
> 时间：2009-03-19T13:01:52.783
> 
> 标签：silverlight-2.0

在 Winforms 中，我会使用 Application.ProductVersion 来获取我的代码版本。Silverlight 2.0 是否有等价物？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T13:13:58.510

这是可能对您有帮助的链接： [确定我的 Silverlight 应用程序的版本](https://stackoverflow.com/questions/1226232/determine-the-version-of-my-silverlight-app)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-11T04:37:32.000

这只能通过反思来完成。代码是

```
using System.Reflection;
Version v = new Version(Assembly.GetExecutingAssembly().FullName.Split(',')[1].Split('=')[1]); 
```

笨重，但它的工作原理。

# statistics - 结合联合概率

> ID：662120
> 
> 赞同：2
> 
> 时间：2009-03-19T13:04:44.693
> 
> 标签：statistics, probability, algebra

我正在尝试计算概率分布的表达式（与生物信息学相关），并且在组合来自两个不同来源的随机变量的信息时遇到了麻烦。本质上，这里是这样的场景：有 3 个离散随机变量 X、A 和 B。X 依赖于 A 和 B。A 和 B 仅通过 X 相关，即 A 和 B 在给定 X 的情况下是独立的。现在，我得出了表达式：P(X, A) 和 P(X, B)。我需要计算 P(X, A, B) - 这不是链式法则的直接应用。

由于 P(A) 可用，我可以从第一个表达式中推导出 P(X | A)。B 从未独立于 A 被观察到，P(B) 并不容易获得 - 充其量我可以通过边缘化 A 来近似它，但表达式 P(A, B) 没有封闭形式，因此整合很棘手。

关于如何在不丢弃信息的情况下导出 P(X, A, B) 的任何想法？提前谢谢了。

阿米特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T21:43:56.107

你在这里处理的是一个无向无环图。给定X，A有条件地独立于B，但X取决于（我直接假设）A和B。我对你的问题的性质有点困惑，即你的概率分布是以什么形式指定的，但你可以看看[信仰传播。](http://en.wikipedia.org/wiki/Belief_propagation)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T20:44:45.440

好的，自从我完成联合概率以来已经有*很长时间*了，所以对它持保留态度，但鉴于 A 和 B 是正交的，我首先要开始寻找的地方是一个类似的表达式：

P(X, A, B) = P(X,A) + (P(X,B) * (1-P(X,A)))；

同样，这只是为了给你一个探索的想法，因为我已经很久没有做这种类型的工作了！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T02:45:40.970

就您观察到的内容和未知内容而言，您的问题非常不清楚。似乎您清楚说明的唯一事实是 A 和 B 在给定 X 的情况下是独立的。也就是说，

假设：P(A,B|X)=P(A|X)P(B|X)

因此： P(A,B,X)=P(A,B|X)P(X)=P(A|X)P(B|X)P(X)=P(A,X)P(X )=P(B,X)P(X)

选择因式分解。

# desktop-application - 使用什么语言或技术来开发 Spotify 桌面应用程序？

> ID：662121
> 
> 赞同：78
> 
> 时间：2009-03-19T13:05:43.927
> 
> 标签：desktop-application, spotify

有人知道开发 Spotify 桌面应用程序使用了哪种语言或技术吗？它稳定、美观、轻巧。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2014-11-04T12:46:27.873

从这里：[http](http://www.quora.com/What-is-the-technology-behind-the-Spotify-desktop-app)
://www.quora.com/What-is-the-technology-behind-the-Spotify-desktop-app 日期：2014-09-09

> 在 Spotify 工作了 5 年的员工 Andreas Blixt：
> 
> 我们所有客户的核心都是 C++，但是自从 Rasmus 的帖子被压缩后，这个核心已经被压缩了，功能被分成了模块。随着 Spotify 在越来越多的平台上可用以及获得更丰富的功能集，我们需要确保“核心”不会成为“一切的一点点”。这意味着将某些功能（例如播放控制）分解到它们自己的单独模块中。这些模块仍然是 C++，但足够独立，理论上它们的逻辑可以用其他语言实现。我们将这些模块的接口层称为“Cosmos”，它的工作方式与 HTTP 并没有太大的不同。Cosmos 允许客户端的任何部分使用任意路径和有效负载与模块进行通信，从而实现更灵活的架构。一些明显的好处是版本化接口（例如：GET sp://player/v1/main 返回播放器状态）和用于传递数据的 JSON。这对于我们桌面客户端的另一个变化很重要。
> 
> 如今，我们的很多桌面 UI 实际上都在使用 Chromium Embedded Framework (CEF)，这基本上意味着我们的视图由 JavaScript、HTML 和 CSS 提供支持。为了让我们所有的功能团队能够处理他们的功能而不必担心破坏其他人的视图，每个视图都在他们自己的“浏览器”中进行沙盒处理（我想您可以将视图视为 Chrome 中的选项卡，除了我们展示更多一次不止一个）。但是，这带来了一个限制：在视图之间共享数据变得更加困难。这就是 Cosmos 的用武之地，它真正简化了核心 (C++) 和 JavaScript 领域之间的通信：JS 客户端可以发出任意请求，如果存在绑定，则该请求得到处理和响应。一个例子是“消息” 端点，它允许任何视图将 JSON 数据推送到正在监听的任何其他视图（有点像 HTML5 中的 window.postMessage，除了这个也可以与 C++ 模块交互）。这也是客户端中的所有播放按钮如何知道一首曲目是否正在播放，或者它是否可以离线使用（另一个 Cosmos 模块），或者你是否已经将一首歌曲保存到你的音乐中。
> 
> 我们技术堆栈的另一个重要变化是我们将一些逻辑进一步“向后”移动到视图聚合服务中。因此，我们以前会在客户端中执行几乎所有逻辑，仅使用后端作为数据存储，现在我们在数据存储和客户端之间的逻辑层中做更多的工作，暴露与 Cosmos 非常相似的端点（实际上，您可以像调用 Cosmos 模块一样调用后端，因此在层之间移动并不麻烦）。这样做的原因有两个：第一，它让我们更快地扩展到更多平台，因为要实现的客户端逻辑更少；第二，它确实帮助我们保持客户端行为更加一致和最新，因为客户端是更“愚蠢”。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-03-31T15:05:14.970

以下是他们使用的第三方组件列表（当然是在 C++ 之上）：

*   促进
*   外籍人士
*   快速委托
*   gif库
*   libjpeg
*   利博格
*   libvorbis
*   梅森捻线机
*   zlib
*   NSIS（仅限 Windows）
*   Windows 模板库（仅限 Windows）
*   咆哮（仅限 Max OS X）
*   MATrackingArea（仅限 Mac OS X）

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2011-08-25T15:35:05.060

根据 Spotify 设计师的说法：

[http://twitter.com/#!/tobiasahlin/status/96483609799692288](http://twitter.com/#!/tobiasahlin/status/96483609799692288)

“其中一些是用 C++ 编写的，还有一些是用一种叫做 Spider 的 HTML 风格的标记语言编写的”

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2014-06-04T23:38:06.753

Spotify 现在使用[Chromium Embedded Framework](https://code.google.com/p/chromiumembedded/) (CEF) 在桌面应用程序中显示由 HTML/CSS/JavaScript 组成的 Web 界面。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-07-22T23:52:52.757

从他们的[网站](http://www.spotify.com/us/jobs/view/oljHVfw0/)：

> Spotify 主要使用 Python 和 C++ 构建

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-19T13:14:19.587

鉴于它在 Windows 上运行，显然不是 .NET（进程资源管理器告诉我），没有遵循 AIR 安装过程，我会说 C++ 使用跨平台库。

一切都被编译成一个可执行文件，这表明他们可以访问所有依赖项的源。

Wrt to Techno……我想他们用的是 Hardhouse Electronica

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-09-15T12:45:23.000

这个答案更新得更多，来自他们的工程博客：[https ://engineering.atspotify.com/2021/04/07/building-the-future-of-our-desktop-apps/](https://engineering.atspotify.com/2021/04/07/building-the-future-of-our-desktop-apps/)

> Spotify 桌面客户端是一个 Windows 和 Mac 原生应用程序，它使用 CEF（Chromium Embedded Framework）来显示基于 Web 的用户界面。今天仍然如此，但对于以前版本的 Desktop，客户端中的每个“页面”都构建为独立的“应用程序”，以在其自己的 iframe 中运行。

然而，他们最近不得不更新他们的架构，因为他们想以一种单一团队可以为这两个客户端开发和交付功能的方式集成使用 React 和**桌面客户端构建的****Web 播放器。**

 **> 最终的架构看起来像一层平台 API，将底层 Spotify 生态系统暴露给客户端，具有基于 React 的用户界面和通过 React Hooks 暴露的平台 API。因此，新的 UI 可以在 Web 上运行，它可以在我们的桌面容器中运行，并且永远不知道或关心数据是否来自我们的 C++ 堆栈或我们的 Web 基础设施。

[架构图](https://i.stack.imgur.com/r2fvw.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-27T12:24:21.153

在此处查看第一个答案： [https ://www.quora.com/What-is-the-technology-stack-behind-the-Spotify-web-client](https://www.quora.com/What-is-the-technology-stack-behind-the-Spotify-web-client)

Spotify 前技术主管 Andreas Blixt 详细回答了这个问题。

> 我们有一个 PHP 层来处理登录（和其他一些服务器端逻辑）以及为不同域上的应用程序提供服务（出于安全原因）。其余的都是 JavaScript。
> 
> 为了让 JavaScript 与后端通信，它通过我们所谓的“接入点”（AP）来实现，这是一种高度优化的 C++ 服务，可以同时处理大量活动连接。该服务负责将请求路由到正确的后端服务。该服务能够在端口 80 和 443 上运行以克服防火墙限制。通信是通过 WebSocket（或某些浏览器的 Flash）完成的。
> 
> 为了与特定的后端服务通信，我们使用我们自己的称为“Hermes”的传输通过 AP 路由请求。这基本上是一个 URL 方案，让 AP 知道将请求发送到哪里。有效载荷被编码为 Protobuf。Hermes 有一个很好的缓存系统（我们称之为“Mercury”），它将结果存储到支持它的浏览器的 IndexedDB 中（我们在桌面客户端有相同的系统，但用 C++ 实现），以避免两次请求相同的数据。这对于经常被重新请求的资源非常有用，例如艺术家、专辑和曲目。
> 
> 对于 UI，我们编写了一个非常高级的应用程序框架（称为“Stitch”），允许不同团队独立开发每个视图，而不必担心会破坏任何东西。这些视图在沙盒中运行，但仍然可以依赖共享库来处理常见的事情，例如加载轨道元数据等。在撰写本文时，我们在网络播放器中有大约 35 个独特的视图（或应用程序）。
> 
> 视图通过使用 postMessage 的“桥”（基本上是 API）获取数据并执行操作，因此我们不需要重新初始化每个应用程序的所有公共代码。真正很酷的一点是，我之前提到的大约 35 个视图实际上也可以在桌面客户端中运行而无需修改。当然，他们将使用挂钩到 Chromium Embedded Framework 和我们的 C++ 核心，而不是 postMessage。
> 
> 我们尝试尽可能多地使用 HTML 5 技术，但在某些情况下依赖于 Flash。我认为我们的网络播放器总体上有一个非常酷的技术堆栈。

* * *

## 回答 #9

> 赞同：-11
> 
> 时间：2010-10-12T12:52:09.120

前端是用 FLEX 编写的，在你的 mac 或 windows 机器上查看源代码。你会看到很多 flex 文件格式的 xml 文件。

当然，与服务器和平台集成的连接可能是用 C++ 原生编写的。但 UI 部分只是 FLEX ......

# c# - 当 XML Element 没有值时如何处理

> ID：662122
> 
> 赞同：1
> 
> 时间：2009-03-19T13:06:11.993
> 
> 标签：c#, xml

有时，某个 XMLElement 有一个值：

```
<CAR>value</CAR> 
```

有时虽然它不在返回 XML 中：

```
<CAR/> 
```

使用 XmlReader 时，我还不确定如何处理这种情况。例如，我有读取每个元素的代码。但是，如果汽车有时回来没有价值怎么办？然后我的 DateTime.Parse 爆炸了，所以我不太确定从本质上处理这些情况并使用 XmlReader 跳过它：

```
reader.ReadStartElement("CAR");
// error here since car doesn't have a value this time
_tDate = DateTime.Parse(reader.ReadContentAsString()); 
```

**编辑：**

```
if(!reader.IsStartElement()) 
```

这也不起作用。在它看到它不是一个开始元素之后，我得到一个错误并且不确定如何在 if 语句之后处理跳过它

```
if(!reader.IsStartElement())
                    {
                        reader.ReadStartElement("CAR");
                        _tDate = DateTime.Parse(reader.ReadContentAsString());

                    }
                    reader. ReadEndElement(); <-- ERROR HERE not sure how to move on 
```

**编辑2：**

当价值为`<CAR/>`

```
 reader.ReadStartElement("In");
            _optedInDate = DateTime.Parse(reader.ReadContentAsString());
            _userIsOut = false;
            reader.ReadEndElement();

            if(reader.IsStartElement("CAR"))
            {
                reader.ReadStartElement("CAR");
                _optedOutDate = DateTime.Parse(reader.ReadContentAsString());
                _userIsOptedOut = true;

            }

            reader.ReadStartElement("COLUMNS");
            reader.ReadStartElement("COLUMN"); 
```

这显然不是一个开始元素，但我是真的......

**编辑 3：**

试过这个：

```
 if((reader.NodeType == XmlNodeType.Element) & (!reader.IsEmptyElement))
                {
                    reader.ReadStartElement("CAR");
                    _optedOutDate = DateTime.Parse(reader.ReadContentAsString());
                    _userIsOptedOut = true;

                }

                reader.ReadStartElement("COLUMNS"); Error Here: Element 'COLUMNS' was not found. Line 12, position 2 
```

节点类型是“空白”。我不知道怎么才能跳过那个该死的`<CAR/>`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T13:08:45.683

首先阅读内容，然后`DateTime.Parse`根据是否有内容来调用或不调用。如果您有时会收到想要跳过的“不良”内容，您也应该查看一下`DateTime.TryParse`。至于如果你得到一个空元素，你应该在更宏大的计划中做什么，这完全取决于你的应用程序——我们真的不能告诉你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T13:25:49.777

如果您使用的阅读器是 XMLReader，则使用：

```
XmlReader reader;
reader.IsEmptyElement // to determine if you should try and parse the value. 
```

请注意，您可能只需要以下几行内容，以确保您正在阅读内容......

```
Reader.Read();
Reader.MoveToContent(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-02T16:31:25.100

我也花了一段时间才弄清楚。你应该这样做：

```
if (!reader.IsEmptyElement)
{
    reader.ReadStartElement("CAR");

    // Read the content
    _tDate = DateTime.Parse(reader.ReadContentAsString());

    reader.ReadEndElement();
}
else
    reader.Skip(); 
```

那是`XmlReaderSettings`'s `IgnoreWhitespace = true`，否则您也必须检查空白节点。

# smtp - 如何使用 Windows 脚本使用 SMTP 服务器发送电子邮件？

> ID：662127
> 
> 赞同：2
> 
> 时间：2009-03-19T13:06:59.057
> 
> 标签：smtp, wsh

我是 Windows 脚本的新手。[我在这里](https://stackoverflow.com/questions/152323/send-mail-from-a-windows-script)看到了关于从 WScript 在 Exchange 服务器上发送电子邮件的帖子，但我的情况有点不同。

我们需要能够使用 Windows 脚本在我们的任何网络中配置的任何 SMTP 服务器发送邮件。你能帮忙吗？

*   IM_IBM

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T13:14:37.713

您[提到](https://stackoverflow.com/questions/152323/send-mail-from-a-windows-script)的问题中提供的解决方案实际上适用于任何 SMTP 服务器。查看以下链接，了解如何使用 CDOSYS：

[ASP 使用 CDOSYS (W3Schools) 发送电子邮件](http://www.w3schools.com/asp/asp_send_email.asp)

[使用 CDOSYS (MSDN) 通过端口 25 发送 SMTP 邮件](http://msdn.microsoft.com/en-us/library/ms992546(EXCHG.65).aspx)

凯夫

# erlang - 使用 Erlang，我应该如何在集群之间分配负载？

> ID：662131
> 
> 赞同：6
> 
> 时间：2009-03-19T13:08:33.360
> 
> 标签：erlang, load-balancing

我正在查看从/池模块，它似乎与我想要的相似，但我的应用程序中似乎也存在单点故障（如果主节点出现故障）。

客户端有一个接受连接的网关列表（为了回退 - 都做同样的事情），客户端随机选择一个。当客户端连接时，检查所有节点以查看负载最小的节点，然后将负载最小的服务器的 IP 转发回客户端。然后客户端连接到这个服务器，一切都在那里执行。

总之，我希望所有节点都充当网关并实际处理客户端请求。负载平衡仅在客户端最初连接时完成 - 所有实际数据包并在客户端的“主”节点上处理。

我该怎么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T09:36:10.793

我不知道是否已经实现了这个模块，但我可以说，负载平衡被高估了。我可以争辩的是，最好选择随机放置工作，除非您知道更多信息将来会如何负载，并且在大多数情况下您真的不知道。你写的：

> 当客户端连接时，检查所有节点以查看负载最小的节点，然后将负载最小的服务器的 IP 转发回客户端。

你怎么知道所有那些负载最少的节点在接下来的毫秒内不会是最高负载的？你怎么知道所有那些你不会包含在列表中的高负载节点不会在接下来的毫秒内降低负载？除非您有非常罕见的情况，否则您真的无法知道。

只需测量（或计算）您的节点的性能并设置节点的概率被选择取决于它。无论当前负载如何，随机选择节点。将此作为初始方法。当你设置好之后，你就可以尝试编造一些更复杂的算法。我敢打赌，要击败这种最初的方法将是一项非常艰巨的工作。相信我，非常难。

**编辑**：为了更清楚地说明一个微妙的细节，我强烈认为您无法从当前和历史负载预测未来负载，但您应该使用有关任务持续时间概率和当前任务生命周期分解的知识。这项工作很难实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-30T22:54:44.240

监督树的目的是管理不一定转发请求的进程。您没有理由不能使用不同的代码将请求直接发送到可用进程列表的成员。请参阅 pool:get_nodes 或 pool:get_node() 函数以获取获取这些列表的一种方法。

您可以让 pool 模块处理进程的管理（重启、监视和终止处理），并使用其他一些模块将请求透明地重定向到进程池。也许您正在寻找分布式池？在不去分布式节点的情况下，很难摆脱 erlang 中的主进程。整个运行系统几乎是一棵大型监督树。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T03:25:17.810

我最近想起了允许您设置进程组的 pg 模块。发送到组的消息会发送到组中的每个进程。它可能会让你朝着你想要的方向前进。您必须编写代码来决定哪个进程真正处理请求，但是您将获得一个没有主人使用它的池。

# c - 将数组及其长度变量包装在 C 中的结构中是最佳实践吗？

> ID：662133
> 
> 赞同：6
> 
> 时间：2009-03-19T13:10:30.563
> 
> 标签：c, arrays, struct, word-wrap

我将很快开始在操作系统课程中使用 C，并且我正在阅读有关使用 C 的最佳实践，以便以后减少头痛。

这一直是我关于阵列的第一个问题，因为它们很容易搞砸。

将数组及其关联变量包含在结构中的长度捆绑在一起是一种常见的做法吗？

我从未在书中见过它，通常他们总是将两者分开或使用类似 sizeof(array[]/array[1]) 之类的交易。

但是通过将两者包装到一个结构中，您可以通过值和引用传递结构，除非使用指针，否则您无法真正使用数组，在这种情况下，您必须再次跟踪数组长度.

我开始使用 C，所以上面的内容可能是非常错误的，我还是个学生。

干杯，凯。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T13:15:53.980

是的，这是在 C 中的一个很好的实践。将相关值包装到包含结构中是完全合乎逻辑的。

我会走得更远。永远不要直接修改这些值也可以满足您的目的。而是编写函数，将这些值作为一对在您的结构中起作用，以更改长度和更改数据。这样你就可以添加不变的检查，也可以很容易地测试。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T13:14:45.450

当然，你可以这样做。不确定我是否称其为最佳实践，但让 C 相当基本的数组更易于管理当然是个好主意。如果您需要动态数组，则几乎需要将进行簿记所需的各个字段组合在一起。

在这种情况下，有时您有两种大小：一种是当前的，一种是已分配的。这是一种权衡，您可以用更少的分配来换取一定的速度，但需要付出一点内存开销。

很多时候数组只在本地使用，并且是静态大小的，这就是为什么`sizeof`操作符可以很方便地确定元素数量的原因。顺便说一句，您的语法与此略有不同，这是它通常的外观：

```
int array[4711];
int i;

for(i = 0; i < sizeof array / sizeof *array; i++)
{
  /* Do stuff with each element. */
} 
```

请记住，这`sizeof`不是一个函数，括号并不总是需要的。

**编辑**：与您描述的完全一样的包装的一个真实示例是[glib提供的](http://library.gnome.org/devel/glib/stable/)[GArray](http://library.gnome.org/devel/glib/stable/glib-Arrays.html)类型。声明的用户可见部分正是您所描述的：

```
typedef struct {
  gchar *data;
  guint len;
} GArray; 
```

程序应尽可能使用提供的 API 来访问数组，而不是直接戳这些字段。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T13:21:48.257

有三种方式。

1.  对于静态数组（非动态分配且未作为指针传递），大小在编译时是已知的，因此您可以使用`sizeof`运算符，如下所示：`sizeof(array)/sizeof(array[0])`
2.  使用终止符（最后一个数组元素的特殊值，不能用作常规数组值），如以空字符结尾的字符串
3.  使用单独的值，作为结构成员或自变量。这并不重要，因为所有使用数组的标准函数都采用单独的大小变量，但是将数组指针和大小合并到一个结构中会增加代码的可读性。我建议使用为您自己的功能提供更清晰的界面。请注意，如果你通过值传递你的结构，被调用的函数将能够改变数组，但不能改变大小变量，所以传递结构指针将是一个更好的选择。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T13:41:26.370

对于公共 API，我会使用数组和大小值分开。这就是我知道的大多数（如果不是全部）c 库中的处理方式。你如何在内部处理它完全取决于你。因此，使用结构加上一些辅助函数/宏来为您完成棘手的部分是一个好主意。重新考虑如何插入或删除一个项目总是让我头疼，所以这是一个很好的问题来源。解决一次和通用的问题，可以帮助您从一开始就解决错误。动态和通用数组的一个很好的实现是[kvec](http://attractivechaos.awardspace.com/kvec.h.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-19T14:05:58.260

我会说这是一个很好的做法。事实上，在 C++ 中他们将其放入标准库并调用它就足够了`vector`。每当您在 C++ 论坛中谈论数组时，您都会被要求使用数组的回答淹没`vector`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T13:14:37.150

我认为这样做没有任何问题，但我认为通常不这样做的原因是由于这种结构产生的开销。出于性能原因，大多数 C 是裸机代码，因此通常会避免抽象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-19T13:17:24.180

我也没有在书中看到太多这样的事情，但我现在一直在做同样的事情。将这些东西“打包”在一起似乎很有意义。例如，如果您需要从方法返回分配的数组，我发现它特别有用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-19T13:40:48.697

如果您使用静态数组，则可以使用 sizeof 运算符访问数组的大小。如果将其放入结构中，则可以按值、引用和指针将其传递给函数。通过引用和指针传递参数在汇编级别是相同的（我几乎可以肯定）。

但是如果你使用动态数组，你在编译时并不知道数组的大小。因此，您可以将此值存储在结构中，但您也将仅在结构中存储指向数组的指针：

```
struct Foo {
  int *myarray;
  int size;
}; 
```

所以你可以按值传递这个结构，但你真正要做的是将指针传递给 int（指向数组的指针）和 int（数组的大小）。

在我看来，它对你没有多大帮助。唯一的优点是您将大小和数组存储在一个地方，并且很容易获得数组的大小。如果您将使用大量动态数组，您可以这样做。但是，如果您将使用少量数组，则更容易不使用结构。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-19T13:16:17.210

我从来没有见过它这样做，但我已经十多年没有做过操作系统级别的工作了...... :-) 乍一看似乎是一种合理的方法。唯一需要注意的是确保尺寸以某种方式*保持*准确......根据需要计算没有那个问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-19T13:19:06.203

考虑到您可以计算数组的长度（以字节为单位，即不是元素数），并且编译器会将 sizeof() 调用替换为实际值（它不是函数，对它的调用被编译器替换为它'返回'的值），那么你想要将它包装在结构中的唯一原因是为了可读性。

这不是一种常见的做法，如果您这样做，查看您的代码的人会认为长度字段是一些特殊值，而不仅仅是数组大小。这是你的提案中潜伏的危险，所以你必须小心地正确评论它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-12-14T17:51:06.650

我认为您问题的这一部分是倒退的：

“但是通过将两者包装到一个结构中，您将能够通过值和引用传递结构，除非使用指针，否则您无法真正使用数组，在这种情况下，您必须再次跟踪数组长度。”

传递数组时使用指针是默认行为；就按值传递整个数组而言，这不会给您带来任何好处。如果你想复制整个数组而不是让它衰减到一个指针，你需要将数组包装在一个结构中。有关更多信息，请参阅此答案：

[可以按值将数组传递给递归函数吗？](https://stackoverflow.com/questions/16094009/pass-array-by-value-to-recursive-function-possible/16094032#16094032)

这里更多的是关于数组的特殊行为：

[http://denniskubes.com/2012/08/20/is-c-pass-by-value-or-reference/](http://denniskubes.com/2012/08/20/is-c-pass-by-value-or-reference/)

# java - 希伯来语在 netbeans 中显示为问号

> ID：662146
> 
> 赞同：7
> 
> 时间：2009-03-19T13:15:30.910
> 
> 标签：java, hebrew

我在 2 台计算机上使用 netbeans 6.1。

在其中一个程序上：

```
public static void main(String argv[]) 
{
        System.out.println("שלום");
} 
```

正常打印，而在其他问号上。
两种环境之间有什么区别？

编辑：在两台计算机上控制面板\区域和语言选项\高级设置为希伯来语
编辑：谢谢迈克尔伯尔，但编码的值已经是UTF-8。也许这与JVM有关？
编辑：我已经安装了 Eclipse，问题也出现在那里。我还尝试从具有相同结果的文件中读取希伯来语。
编辑： `System.getProperty("file.encoding");` 返回“Cp1252”我试过 `System.setProperty("file.encoding","UTF-8")` 但问号仍然存在。

谢谢，
伊多

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T13:56:58.313

确保使用支持希伯来字符的编码设置 NetBeans。来自[NetBeans Wiki](http://wiki.netbeans.org/FaqI18nProjectEncoding)：

> 要更改项目的语言编码：
> 
> 1.  在“项目”窗口中右键单击项目节点并选择“属性”。
> 2.  在源下，从编码下拉字段中选择一个编码值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T16:54:48.203

You can't set the "file.encoding" property with `System.setProperty()`; it has to be set on the command line when the JVM is started with `-Dfile.encoding=UTF-8`. The value of this property is read during JVM initialization and cached. By the time your `main` method is invoked, the value has been cached and changes to the property are ignored.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:03:55.300

你到底是如何运行程序的？它在哪里打印输出？它可以像 netbeans 或使用不同字体的控制台一样简单，其中一种不包括希伯来语字符。

[要消除编译期间的编码问题，请尝试用其unicode 转义序列](http://java.sun.com/docs/books/jls/second_edition/html/lexical.doc.html#100850)替换希伯来字符，看看结果是否不同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T17:00:12.653

I think I misunderstood your problem (I thought that the characters were not being displayed in the NetBeans editor properly). The exact steps to solve your problem might depend on the version of the OS you're running on. Win2K, WInXP, and Vista all have slightly different dialogs and wording unfortuantely.

Take a look at this help page for the JVM:

*   [http://java.com/en/download/help/locale.xml](http://java.com/en/download/help/locale.xml)

It sounds like you've already configured the system like it should be, but the devil is in the details - there are several different 'locale' settings on a system that might affect this (and for all I know the JVM might throw in one or two on its own).

*   [http://www.siao2.com/2005/02/01/364707.aspx](http://www.siao2.com/2005/02/01/364707.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T13:24:25.927

希伯来语是默认安装的吗？可能是没有安装语言包？

控制面板 > 区域和语言选项 > 语言。选择“为复杂的脚本和从右到左的语言（包括泰语）安装文件”选项。这将安装对希伯来语的支持。您可能需要一张操作系统光盘。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T13:21:56.307

通常它是默认编码：

> 控制面板\区域和语言选项\高级
> （在组合上选择希伯来语）

更改此设置后，您必须重新启动。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-25T07:09:01.887

对我有帮助的是（在Win7上）： ![在此处输入图像描述](https://i.stack.imgur.com/n6ONo.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-02-22T14:07:19.603

上面没有一个答案是行不通的。

我花了大约一个小时，但发现问题不在字符串编码中，而是在默认编码中，IDE 从启动时就使用该编码。

因此，要在 Netbeans 控制台输出中获取希伯来语、阿拉伯语、俄语等符号，您需要修改**netbeans.conf**。

搜索键**netbeans_default_options**并将**-J-Dfile.encoding=UTF-8**添加到引号中。

# .net - 您会在新的商业项目中使用 S#arp 架构吗？

> ID：662150
> 
> 赞同：5
> 
> 时间：2009-03-19T13:16:26.180
> 
> 标签：.net, architecture, frameworks, s#arp-architecture

[S#arp 架构](http://code.google.com/p/sharp-architecture/)看起来真的很酷，但是你认为它仍然太新而不能在一个重要的新项目中做出承诺吗？（让我们假设该项目乍一看似乎很适合它。）

一切*看起来*都很好，我只是担心我正在从事的新项目正在使用所有较新的技术——WCF、ASP.NET MVC 等——如果我再添加一项婴儿技术，我将结束有很多问题，但没有足够的技术技能或社区支持来解决它们……

很难抗拒我内心那个苛刻的男孩：*我想要最新的东西！*

*（免责声明：我对 S#arp 架构非常陌生，所以我主要基于项目的既定目标、文章、示例代码等方面对它的乐观看法。）*

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-12-29T22:46:46.807

[http://fancydressoutfitters.co.uk](http://fancydressoutfitters.co.uk)使用：

*   夏普架构（ASP.NET MVC、NHibernate、Fluent NHibernate）、
*   火花视图引擎
*   自动映射器
*   NHibernate 验证器
*   xVal 验证框架
*   N2CMS
*   PostSharp
*   Solr 和 SolrNet

它确实运作良好。我们在博客中记录了我们从这个项目中学到的很多知识，您可以在这里找到：http: [//delicious.com/howardvanrooijen/fdo-casestudy](http://delicious.com/howardvanrooijen/fdo-casestudy)

我们还决定回馈帮助我们的各个开源社区，因此我们创建了一个新的 Sharp 架构展示应用程序，名为 Who Can Help Me？源代码可从[http://whocanhelpme.codeplex.com](http://whocanhelpme.codeplex.com)获得，现场演示可在[http://who-can-help.me找到](http://who-can-help.me)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T13:20:59.600

我会鼓励你尝试它，并用它做一些内部或爱好项目。对于商业应用程序，我建议使用更成熟的框架。它将更加稳定，得到更好的支持，并拥有更多的开发人员和示例代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-12T14:19:16.627

我不认为 S#arp 架构是一个框架，甚至不是一个“架构”，而是一个使用 MVC 和 Fluent NHibernate 开发应用程序的绝佳起点。项目和文件根据它提供的 Visual Studio 模板组织得很好。这本身就值得一吨地启动并快速运行。我建议查看 S#arp Architecture 的源代码中的 Northwind 示例源代码，看看有什么可能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T13:24:44.037

新技术的问题是：

*   随着时间的推移没有发现最佳实践
*   没有其他人可以用谷歌搜索的文档/样本/社区
*   没有成功实施的“案例研究”来证明性能/可扩展性/等
*   没有发现和记录“功能”，更不用说修复了。

但是必须有人这样做才能得到这些东西——如果你能承受整个事情失败并被重写的话，那也可能是你。

如果你没有时间重新做一遍（以防万一它确实没用或太难），那么坚持使用成熟的、经过验证的技术。最后，重要的是你生产什么，而不是如何生产。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-31T14:50:56.347

我同意 John B 的观点：S#arp Architecture 使用了一些众所周知的框架和模式，这些框架和模式本身在很大程度上经过了实战测试，并且有合理数量的社区支持来保证商业用途，但是没有足够的 S #arp 特定的社区支持或示例项目，以保证框架提供的优势。

如果您想使用他们在框架中实现的一些技术，这绝对是一个很好的参考。

@leppie - 是什么让你想避免 NHibernate？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-09-04T13:37:28.803

如前所述，S#arp 是一个很好的起点。根据您的需求，您可以轻松扩展、解耦或更改组件，但是了解其底层框架将是一个**主要**优势。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-22T02:53:57.810

S#arp 是一个很棒的基础，但您确实需要了解幕后发生的事情以扩展您的域架构。我尽可能利用 S#arp。

# c# - 当里面有一个循环时，lock 语句不起作用？

> ID：662156
> 
> 赞同：3
> 
> 时间：2009-03-19T13:18:26.410
> 
> 标签：c#, multithreading, locking

请参阅此代码：

```
public class multiply
{
    public Thread myThread;
    public int Counter
    {
        get;
        private set;
    }
    public string name
    {
        get;
        private set;
    }

    public void RunConsolePrint()
    {

        lock(this)
        {
        RunLockCode("lock");
        }

    }

    private void RunLockCode(string lockCode)
    {
        Console.WriteLine("Now thread "+lockCode+" " + name + " has started");
        for (int i = 1; i <= Counter; i++)
        {
            Console.WriteLine(lockCode+" "+name + ": count has reached " + i + ": total count is " + Counter);
        }
        Console.WriteLine("Thread " + lockCode + " " + name + " has finished");
    }
    public multiply(string pname, int pCounter)
    {
        name = pname;
        Counter = pCounter;
        myThread = new Thread(new ThreadStart(RunConsolePrint));
    }

} 
```

这是测试运行代码：

```
 static void Main(string[] args)
    {
        int counter = 50;

        multiply m2 = new multiply("Second", counter);
        multiply m1 = new multiply("First", counter);
        m1.myThread.Start();
        m2.myThread.Start();
        Console.ReadLine();
    } 
```

由于该语句，我希望在开始执行`m2`之前必须从头到尾`m1`执行，反之亦然。`lock`但是我发现的结果是lock first和lock second的调用混合在一起，即像这样

```
Now thread lock First has started
Now thread lock Second has started
lock First: Count has reached 1: total count is 50
lock First: Count has reached 2: total count is 50
lock Second: Count has reached 1: total count is 50 
```

我做错什么了？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-19T13:20:24.983

代码的每个实例都锁定在不同的对象上。您的锁对象需要在所有实例之间共享——使其成为静态类变量。

```
private static object syncRoot = new object();
public void RunConsolePrint()
{
    lock(syncRoot)
    {
         RunLockCode("lock");
    }    
} 
```

# asp.net - 在母版页后面的代码中使用 javascript 访问值集

> ID：662159
> 
> 赞同：0
> 
> 时间：2009-03-19T13:20:08.323
> 
> 标签：asp.net, javascript

我在作为菜单项的 onClick 事件的母版页上执行 javascript，我将其设置为隐藏字段，并且在母版页的 Init 上，我无法访问此隐藏字段值。

问候

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T13:24:16.253

在加载阶段之前，您的控件中的状态不可用。在此之前，您必须办理登机手续`Request.Form`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T05:49:51.120

这是守则。在母版页中，我添加了标签

```
<asp:HiddenField ID="hdnPath" runat="server" Value=""/> 
```

然后我有一个脚本标签，它运行一个`setScript()`每次加载母版页时的函数

```
<script type="text/javascript" language="javascript">
    setScript();
    // I Navigate through all the menu items, which is navigate
    // through all the "a" tags and then all of the a tags onclick
    // event i add a new function ,below is the code

<script type="text/javascript" language="javascript">
    setScript();

    function setScript() {
        var objMenu=document.getElementById('<%=_menu.ClientID %>');
        var objHyperLinks=objMenu.getElementsByTagName('a');
        for(var i=0;i<objHyperLinks.length;i++) {
            var pageLoc=objHyperLinks[i].href;
            objHyperLinks.item(i).onclick=function (){
                return setEvent(this);
            };
        }
    }

    function setEvent(Loc) {
        var pageLoc=Loc+"";
        var iframePath=document.location.href;
        var targetPath=pageLoc;
        document.getElementById('<%=hdnPath.ClientID %>').value=targetPath;

        if(document.all) {
            document.all.frameLoader.src=targetPath;
        } else {
            var frame=window.frames;
            frame[0].location.href=targetPath;
        }
        return false;
    } 
```

我在分配后立即提醒 hdnPath 的值，`targetPath`我可以看到分配的值。

# c# - 如何在不将该颜色应用于每个子控件的情况下更改 GroupBox 的 ForeColor？

> ID：662160
> 
> 赞同：4
> 
> 时间：2009-03-19T13:20:23.143
> 
> 标签：c#, winforms

我需要将组框文本更改为特定颜色，而不更改组框内的颜色。

以下代码将 的 设置`ForeColor`为`GroupBox`粉红色，但此设置也级联到所有子控件：

```
groupbox.ForeColor = Color.Pink 
```

如何在不将该颜色应用于每个子控件的情况下更改`ForeColor`a ？`GroupBox`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T13:30:39.500

您可以遍历 GroupBox 中的所有控件并设置它们各自的 ForeColor 属性：

```
groupBox1.ForeColor = Color.Pink;
foreach (Control ctl in groupBox1.Controls) {
    ctl.ForeColor = SystemColors.ControlText;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-06-08T15:38:28.550

```
form_load()
{
    ...
    foreach (Control ctl in groupbox.Controls) 
    {
        // load color value from parent and explicitly set it to control level
        ctl.ForeColor = ctl.ForeColor;
    }
    ...
}

some_click()
{
    groupbox.ForeColor = Color.Pink;
}

someother_click()
{
    groupbox.ForeColor = Color.Green; 
} 
```

在明确完成之前，不会为子控件设置颜色，并且当子控件颜色请求从父控件获取时。更改父级的颜色将刷新其所有内容，子控件将从父级获取颜色。

如果您（显式）设置子颜色，则子颜色将不会“询问”父颜色。

子颜色也可以在设计器中设置，但如果颜色与父颜色相同，设计器会减少此设置。加载事件中的代码强制孩子拥有自己的颜色。

# ruby - 如何强制 Qt 小部件保持相等的高度和宽度？

> ID：662162
> 
> 赞同：2
> 
> 时间：2009-03-19T13:20:49.897
> 
> 标签：ruby, qt, qt4, qwidget, aspect-ratio

我正在使用 Ruby Qt 绑定。

我正在尝试制作一个方形小部件（棋盘），但它似乎不起作用。 [这是我尝试过的代码](http://pastie.org/420860)

制作保持其纵横比的小部件的正确方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T13:23:41.700

看到这个问题：[如何在 Qt 中保持小部件的纵横比？](https://stackoverflow.com/questions/452333/how-to-maintain-widgets-aspect-ratio-in-qt)

# wpf - WPF 上下文菜单未绑定到正确的数据绑定项

> ID：662164
> 
> 赞同：17
> 
> 时间：2009-03-19T13:20:59.320
> 
> 标签：wpf, data-binding, mvvm, contextmenu

在标签页上的用户控件的上下文菜单中绑定命令时遇到问题。我第一次使用菜单（右键单击选项卡）时效果很好，但是如果我切换选项卡，该命令将使用第一次使用的数据绑定实例。

如果我在用户控件中放置一个绑定到命令的按钮，它会按预期工作......

有人可以告诉我我做错了什么吗？

这是一个暴露问题的测试项目：

应用程序.xaml.cs：

```
public partial class App : Application
{
    protected override void OnStartup(StartupEventArgs e)
    {
        base.OnStartup(e);

        CompanyViewModel model = new CompanyViewModel();
        Window1 window = new Window1();
        window.DataContext = model;
        window.Show();
    }
} 
```

Window1.xaml：

```
<Window x:Class="WpfApplication1.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vw="clr-namespace:WpfApplication1"
Title="Window1" Height="300" Width="300">

  <Window.Resources>
    <DataTemplate x:Key="HeaderTemplate">
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="{Binding Path=Name}" />
        </StackPanel>
    </DataTemplate>
    <DataTemplate DataType="{x:Type vw:PersonViewModel}">
        <vw:UserControl1/>
    </DataTemplate>

</Window.Resources>
<Grid>
    <TabControl ItemsSource="{Binding Path=Persons}" 
                ItemTemplate="{StaticResource HeaderTemplate}"
                IsSynchronizedWithCurrentItem="True" />
</Grid>
</Window> 
```

用户控件1.xaml：

```
<UserControl x:Class="WpfApplication1.UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    MinWidth="200">
    <UserControl.ContextMenu>
        <ContextMenu >
            <MenuItem Header="Change" Command="{Binding Path=ChangeCommand}"/>
        </ContextMenu>
    </UserControl.ContextMenu>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="100" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Label Grid.Column="0">The name:</Label>
        <TextBox Grid.Column="1" Text="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}" />
    </Grid>
</UserControl> 
```

CompanyViewModel.cs：

```
public class CompanyViewModel
{
    public ObservableCollection<PersonViewModel> Persons { get; set; }
    public CompanyViewModel()
    {
        Persons = new ObservableCollection<PersonViewModel>();
        Persons.Add(new PersonViewModel(new Person { Name = "Kalle" }));
        Persons.Add(new PersonViewModel(new Person { Name = "Nisse" }));
        Persons.Add(new PersonViewModel(new Person { Name = "Jocke" }));
    }
} 
```

PersonViewModel.cs：

```
public class PersonViewModel : INotifyPropertyChanged
{
    Person _person;
    TestCommand _testCommand;

    public PersonViewModel(Person person)
    {
        _person = person;
        _testCommand = new TestCommand(this);
    }
    public ICommand ChangeCommand 
    {
        get
        {
            return _testCommand;
        }
    }
    public string Name 
    {
        get
        {
            return _person.Name;
        }
        set
        {
            if (value == _person.Name)
                return;
            _person.Name = value;
            OnPropertyChanged("Name");
        }
    }
    void OnPropertyChanged(string propertyName)
    {
        PropertyChangedEventHandler handler = this.PropertyChanged;
        if (handler != null)
        {
            var e = new PropertyChangedEventArgs(propertyName);
            handler(this, e);
        }
    }
    public event PropertyChangedEventHandler PropertyChanged;
} 
```

测试命令.cs：

```
public class TestCommand : ICommand
{
    PersonViewModel _person;
    public event EventHandler CanExecuteChanged;

    public TestCommand(PersonViewModel person)
    {
        _person = person;
    }
    public bool CanExecute(object parameter)
    {
        return true;
    }
    public void Execute(object parameter)
    {
        _person.Name = "Changed by command";
    }
} 
```

个人.cs：

```
public class Person
{
    public string Name { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-19T13:42:46.100

这里要记住的关键是**上下文菜单不是可视化树的一部分。**

因此，它们不会继承与它们所属的用于绑定的控件相同的源。处理这种情况的方法是绑定到 ContextMenu 本身的放置目标。

```
<MenuItem Header="Change" Command="{Binding 
    Path=PlacementTarget.ChangeCommand, 
    RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ContextMenu}}}"
/> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-01-28T00:32:17.533

我发现将命令绑定到上下文菜单项的最简洁的方法是使用一个名为 CommandReference 的类。您可以在[WPF Futures](http://wpf.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=14962)的 Codeplex 上的 MVVM 工具包中找到它。

XAML 可能如下所示：

```
<UserControl x:Class="View.MyView" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:vm="clr-namespace:ViewModel;assembly=MyViewModel"
                xmlns:mvvm="clr-namespace:ViewModelHelper;assembly=ViewModelHelper"
           <UserControl.Resources>
                <mvvm:CommandReference x:Key="MyCustomCommandReference" Command="{Binding MyCustomCommand}" />

                <ContextMenu x:Key="ItemContextMenu">
                    <MenuItem Header="Plate">
                        <MenuItem Header="Inspect Now" Command="{StaticResource MyCustomCommandReference}"
                                CommandParameter="{Binding}">
                        </MenuItem>
                    </MenuItem>
               </ContextMenu>
    </UserControl.Resources> 
```

MyCustomCommand 是 ViewModel 上的 RelayCommand。在此示例中，ViewModel 在代码隐藏中附加到视图的数据上下文。

注意：此 XAML 是从一个工作项目中复制的，并且为了说明而进行了简化。可能有错别字或其他小错误。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-12-03T01:58:52.517

我最近在 ListBox 中的 ContextMenu 遇到了同样的问题。我试图在没有任何代码隐藏的情况下以 MVVM 方式绑定命令。我终于放弃了，我向一位朋友寻求帮助。他找到了一个稍微扭曲但简洁的解决方案。他在 ContextMenu 的 DataContext 中传递 ListBox，然后通过访问 ListBox 的 DataContext 在视图模型中找到命令。这是迄今为止我见过的最简单的解决方案。没有自定义代码，没有标签，只有纯 XAML 和 MVVM。

[我在Github](http://github.com/mlaflamm/listbox-contextmenu "Github")上发布了一个完整的工作示例。这是 XAML 的摘录。

```
<Window x:Class="WpfListContextMenu.MainWindow" 
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        Title="MainWindow" Height="350" Width="268">
  <Grid>
    <DockPanel>
      <ListBox x:Name="listBox" DockPanel.Dock="Top" ItemsSource="{Binding Items}" DisplayMemberPath="Name"
               SelectionMode="Extended">
        <ListBox.ContextMenu>
          <ContextMenu DataContext="{Binding Path=PlacementTarget, RelativeSource={RelativeSource Self}}">
            <MenuItem Header="Show Selected" Command="{Binding Path=DataContext.ShowSelectedCommand}"
                      CommandParameter="{Binding Path=SelectedItems}" />
          </ContextMenu>
        </ListBox.ContextMenu>
      </ListBox>
    </DockPanel>
  </Grid>
</Window> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-27T06:44:43.467

我更喜欢另一种解决方案。添加上下文菜单加载器事件。

```
<ContextMenu Loaded="ContextMenu_Loaded"> 
    <MenuItem Header="Change" Command="{Binding Path=ChangeCommand}"/> 
</ContextMenu> 
```

在事件中分配数据上下文。

```
private void ContextMenu_Loaded(object sender, RoutedEventArgs e)
{
    (sender as ContextMenu).DataContext = this; //assignment can be replaced with desired data context
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-26T06:54:42.633

当从控件模板深处的上下文菜单绑定时，我发现使用 Tag 属性的这种方法非常有用：

[http://blog.jtango.net/binding-to-a-menuitem-in-a-wpf-context-menu](http://blog.jtango.net/binding-to-a-menuitem-in-a-wpf-context-menu)

这使得绑定到打开上下文菜单的控件可用的任何数据上下文成为可能。上下文菜单可以通过“PlacementTarget”访问被点击的控件。如果单击控件的 Tag 属性绑定到所需的数据上下文，则从上下文菜单中绑定到“PlacementTarget.Tag”会将您直接弹射到该数据上下文。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-14T09:41:45.420

我知道这已经是一篇旧文章，但我想为那些正在寻找不同方法的人添加另一种解决方案。

在我的情况下，我无法使用相同的解决方案，因为我正在尝试做其他事情：通过鼠标单击打开上下文菜单（就像附加了子菜单的工具栏一样）并将命令绑​​定到我的模型。由于我使用的是事件触发器，因此 PlacementTarget 对象为空。

这是我发现使其仅使用 XAML 工作的解决方案：

```
<!-- This is an example with a button, but could be other control -->
<Button>
  <...>

  <!-- This opens the context menu and binds the data context to it -->
  <Button.Triggers>
    <EventTrigger RoutedEvent="Button.Click">
      <EventTrigger.Actions>
        <BeginStoryboard>
          <Storyboard>
            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="ContextMenu.DataContext">
              <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{Binding}"/>
            </ObjectAnimationUsingKeyFrames>
            <BooleanAnimationUsingKeyFrames Storyboard.TargetProperty="ContextMenu.IsOpen">
              <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="True"/>
            </BooleanAnimationUsingKeyFrames>
          </Storyboard>
        </BeginStoryboard>
      </EventTrigger.Actions>
    </EventTrigger>
  </Button.Triggers>

  <!-- Here it goes the context menu -->
  <Button.ContextMenu>
    <ContextMenu>
      <MenuItem Header="Item 1" Command="{Binding MyCommand1}"/>
      <MenuItem Header="Item 2" Command="{Binding MyCommand2}"/>
    </ContextMenu>
  </Button.ContextMenu>

</Button> 
```

# ms-access - VBA 文件的版本控制

> ID：662166
> 
> 赞同：2
> 
> 时间：2009-03-19T13:21:08.587
> 
> 标签：ms-access, version-control, vba

我有一个带有内置 VBA 代码库的巨大 MS Access 文档。是否可以使用（mercurial）版本控制系统跟踪文件（正如我正在开发的那样）？我可以提取代码并跟踪它吗？或者它只是二进制文件路径？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T13:32:15.067

MS Access 可以通过脚本导出大部分代码。前段时间我在这里发了一些：

[如何在 Access 开发中使用版本控制？](https://stackoverflow.com/questions/187506/how-do-you-use-version-control-with-access-development)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T13:22:58.270

可以对二进制文件进行版本控制，但将代码分开会更简洁（IMO）。如果它对你有用，那么一定要做你所做的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-23T00:13:15.723

这里有一个很好的工具[https://github.com/hilkoc/vbaDeveloper](https://github.com/hilkoc/vbaDeveloper)。

它允许您轻松导出和导入所有 vba 代码，并且可以在您单击“保存”时自动执行此操作。导出文件都是纯文本，然后您可以以通常的方式将其放入版本控制中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-09-23T03:45:20.643

一直到 2010 年的 Access 都支持源代码控制，其中包括对团队基础服务器的支持。将所有文件放在一个 zip 文件、硬盘驱动器上的一个文件夹或一个名为 accDB 的容器中的事实是一个模拟题。只要每个单独的对象都可以被视为一个单独的对象，那么您为什么要关心使用的是 zip 文件还是 accDB 文件呢？这是一个“逻辑”视图与物理视图问题。

简单的事情是访问中的每个对象都可以作为文本对象导出。因此，自 Access 97（即 17 年以上！！）以来，Access 已经支持使用此功能与标准 Microsoft SCC 界面集成的源代码控制。

当您使用 SCC（例如 Visual Source safe 或 Team Foundation 服务器）时，Access 中的 BUILT IN UI 支持显示有问题的对象状态。您可以解决表单、报表、sql 查询和代码模块级别的问题。因此，多个开发人员可以同时在应用程序上工作。他们只需要查看他们正在处理的表格、报告查询等。因此，每个开发人员都有自己的本地构建。

如果使用 Visual Source Safe，那么您会在功能区中看到：

![在此处输入图像描述](https://i.stack.imgur.com/KetKr.png)

如果您使用团队基础服务器，那么您会看到：

![在此处输入图像描述](https://i.stack.imgur.com/cBIh3.png)

对于签出的对象，您会看到：

![在此处输入图像描述](https://i.stack.imgur.com/XgbTQ.png)

当您打开甚至右键单击某个对象时，您会看到以下附加选项：

![在此处输入图像描述](https://i.stack.imgur.com/Kb3dq.png)

当然，鉴于“很少”使用此功能甚至知道它是什么（并且 SO 上的帖子证实了这种知识的缺乏），那么这些年来该功能在 Access 2013 中被删除就不足为奇了！然而，一些第 3 方插件声称可以恢复此功能。因此，在 2013 年将对象导出为单个文本文件的功能仍然存在。

# c# - 批量插入问题

> ID：662179
> 
> 赞同：3
> 
> 时间：2009-03-19T13:23:36.287
> 
> 标签：c#, ado.net, bulkinsert

我在客户端有一个 CSV 文件，我想开发一个 C# 应用程序来将数据批量插入数据库的表中以最小化日志输出。我对是否在客户端使用 ADO.NET 来调用数据库服务器中的存储过程感到困惑。什么样的代码需要在客户端开发，什么样的代码需要在服务器端以存储过程的形式实现？

但我没有从谷歌找到任何样本。有哪些即用型样品？:-)

编辑：更多信息：

我在客户端有很多数据，我想导入数据库，但我不想要所有许多事务日志的开销。出于安全原因，我想在服务器端开发一个存储过程并从客户端（ADO.NET）调用。我想知道实现这样的目标。服务端存储过程需要开发什么样的T-SQL，客户端如何高效调用/填充数据？

如果还有什么不清楚的地方，请随时告诉我。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T13:29:07.897

您可以将[CsvReader 连接](http://www.codeproject.com/KB/database/CsvReader.aspx)到 SqlBulkCopy，它可以很好地完成这项工作......类似于（未经测试）：

```
using (CsvReader reader = new CsvReader(path))
using (SqlBulkCopy bcp = new SqlBulkCopy(CONNECTION_STRING))
{
    bcp.DestinationTableName = "SomeTable";
    bcp.WriteToServer(reader);
} 
```

**编辑**您通常会将批量插入到**临时**表中，然后使用常规存储过程将数据移动到*实际*表中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T13:37:08.267

您使用的是 SQL Server 2008 吗？您是否能够执行动态 SQL（不是我提倡的）？

如果是这样，您可以构造一个使用“行构造函数”的插入语句。本质上，插入语句现在将接受每一行的参数数组，如下所示：

```
INSERT INTO TableA (Col1, Col2)
VALUES ('A', 'B'), ('C', 'D') 
```

在博客文章“ [SQL Server 2008 – 使用一个插入语句插入多条记录 – 行构造函数的使用](http://blog.sqlauthority.com/2008/07/02/sql-server-2008-insert-multiple-records-using-one-insert-statement-use-of-row-constructor/)”中有更多关于它的内容。

我希望这有帮助。

# .net - 验证事件导致 Winforms 中的按钮单击事件丢失

> ID：662181
> 
> 赞同：0
> 
> 时间：2009-03-19T13:24:15.850
> 
> 标签：.net, winforms, events, buttonclick, validating

背景：我有一个带有“清除表单”和“取消”按钮的表单。如果我在下拉列表中有无效数据并单击这些按钮中的任何一个，则会触发下拉列表的验证事件。我已将代码添加到验证事件中，以便在按下“清除”或“取消”时成功。

问题：我希望接下来会发生按钮单击事件将触发。在“取消”按钮的情况下，它确实如此。但是“清除”按钮的事件没有。我看不出两个按钮/事件之间有任何区别。发生了什么事，我该如何解决？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T13:31:21.213

不确定您遇到了什么问题，当您在 Validating 事件处理程序中设置 e.Cancel 时，Click 事件都不应该运行。但是有一个更好的方法可以做到这一点。将按钮的 CausesValidation 属性设置为 False。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-14T13:49:13.863

我遇到了另一个类似的场景。在寻找答案时，我遇到了这个我几个月前问过的老问题！在这种情况下，验证事件将焦点从原始字段移开，因此当按钮事件准备好触发时，它不能。最终通过从验证中显式调用按钮单击事件来解决它。

# java - 为什么这个通用的 java 代码不能编译？

> ID：662191
> 
> 赞同：35
> 
> 时间：2009-03-19T13:27:25.060
> 
> 标签：java, generics

在这个简化的示例中，我有一个泛型类和一个无论类型参数如何都返回 Map 的方法。当我没有在包含类上指定类型时，为什么编译器会清除映射上的类型？

```
import java.util.Map;

public class MyClass<T>
{
    public Map<String, String> getMap()
    {   
        return null;
    }

    public void test()
    {   
        MyClass<Object> success = new MyClass<Object>();
        String s = success.getMap().get("");

        MyClass unchecked = new MyClass();
        Map<String, String> map = unchecked.getMap();  // Unchecked warning, why?
        String s2 = map.get("");

        MyClass fail = new MyClass();
        String s3 = fail.getMap().get("");  // Compiler error, why?
    }
} 
```

我得到这个编译器错误。

```
MyClass.java:20: incompatible types
found   : java.lang.Object
required: java.lang.String
                String s3 = fail.getMap().get("");  // Compiler error 
```

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-19T13:44:34.973

知道了。这实际上*不是*一个错误，虽然看起来很奇怪。

从[JLS 的第 4.8 节（原始类型）](http://java.sun.com/docs/books/jls/third_edition/html/typesValues.html#110257)：

> 未从其超类或超接口继承的原始类型 C 的构造函数（第 8.8 节）、实例方法（第 8.8 节、第 9.4 节）或非静态字段（第 8.3 节）M 的类型是其类型的擦除在对应于 C 的泛型声明中。原始类型 C 的静态成员的类型与其在对应于 C 的泛型声明中的类型相同。

因此，即使方法的类型签名不使用类本身的任何类型参数，类型擦除也会生效，并且签名变得有效

```
public Map getMap() 
```

换句话说，我认为您可以将原始类型想象为与泛型类型相同的 API，但从*任何地方*（在 API 中，而不是在实现中）`<X>`删除了所有位。

 *编辑：这段代码：

```
MyClass unchecked = new MyClass();
Map<String, String> map = unchecked.getMap();  // Unchecked warning, why?
String s2 = map.get(""); 
```

编译是因为从原始`Map`类型到`Map<String, String>`. 在最后一种情况下，您可以通过进行显式转换（在执行时不执行任何操作）来获得相同的效果：

```
// Compiles, but with an unchecked warning
String x = ((Map<String, String>)fail.getMap()).get(""); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T13:32:17.717

嗯......不幸的是我不能告诉你为什么它失败了。但我可以给你一个简单的解决方法：

将类型更改`fail`为`MyClass<?>`，然后它会编译得很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-19T14:47:46.303

非常有趣的问题，以及 Jon Skeet 的非常有趣的回答。

我只想添加一些关于java编译器这种行为的愚蠢或不愚蠢的东西。

我认为编译器假定**如果您没有在generc 类中指定类型参数，那么您根本无法（或不想）使用任何类型参数**。您可以使用早于 5 的 java 版本，或者喜欢手动进行强制转换。

这对我来说似乎并不那么愚蠢。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T13:46:28.977

泛型类型在编译后被删除。

当你这样做时：

```
Map<String, String> map = unchecked.getMap(); 
```

您正在强制从 Map 转换为 Map<String, String>，这就是未经检查的警告的原因。但是，之后您可以执行以下操作：

```
String s2 = map.get(""); 
```

因为 map 的类型是 Map<String, String>。

但是，当你这样做

```
String s3 = fail.getMap().get(""); 
```

您没有将 fail.getMap() 转换为任何内容，因此它被认为是简单的 Map，而不是 Map<String, String>。

你应该在后者中做的事情是这样的：

```
String s3 = ((Map<String, String>fail.getMap()).get(""); 
```

它仍然会引发警告，但无论如何都会起作用。

# managed-directx - 如何重新分发托管 DirectX？

> ID：662195
> 
> 赞同：1
> 
> 时间：2009-03-19T13:28:20.817
> 
> 标签：managed-directx

我开发了一个使用 Microsoft.DirectX.Direct3D 命名空间的应用程序。该应用程序在安装了 Managed DirectX SDK 的计算机上运行，​​但不能在只有通常 DirectX 的计算机上运行。

具体来说，它抱怨它“无法加载文件或程序集'Microsoft.DirectX.Direct3D [...]”。

重新分配必要程序集的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T13:32:22.460

只需使用 microsoft 提供的 mdx 的可再发行安装程序。它将安装本机 dx 以及托管扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T14:03:44.053

如果您确实重新分发了 MDX 库，请注意 Microsoft 不再支持此功能，并且已弃用 XNA。您可能还想将[SlimDX](http://code.google.com/p/slimdx/)作为替代方案

# c# - 正如 MSDN 文章所述，为什么按钮单击事件“冒泡视觉树”到 StackPanel？

> ID：662201
> 
> 赞同：22
> 
> 时间：2009-03-19T13:29:57.910
> 
> 标签：c#, wpf, event-routing

在 MSDN 文章[Understanding Routed Events and Commands In WPF](http://msdn.microsoft.com/en-us/magazine/cc785480.aspx)中，它指出

> *一个事件将从源元素向上冒泡（传播）到可视化树，直到它被处理或到达根元素。*

但是，在此示例中，当您单击按钮时，**它不会“冒泡视觉树”以由父 StackPanel 事件处理**，即单击按钮不会触发任何事件。

为什么不？如果不是这个**，他们所说的“冒泡”是什么意思？**

**XAML：**

```
<Window x:Class="TestClickEvents456.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <StackPanel x:Name="TheStackPanel"
                Background="Yellow"
                MouseDown="TheStackPanel_MouseDown">
        <Button x:Name="TheButton"
                Margin="10"
                Content="Click This"/>
        <TextBlock x:Name="TheMessage"
                   Text="Click the button or the yellow area"/>
    </StackPanel>
</Window> 
```

**代码隐藏：**

```
using System.Windows;
using System.Windows.Input;

namespace TestClickEvents456
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private void TheStackPanel_MouseDown(object sender, MouseButtonEventArgs e)
        {
            TheMessage.Text = "StackPanel was clicked.";
        }

    }
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-19T13:54:19.927

事件冒泡，直到它得到处理......

由于 Button 通过您的鼠标单击执行某些操作，因此它会吸收您的鼠标事件并将其转换为 ClickEvent。

如果您使用 PreviewMouseDown，您会看到 StackPanel 先于按钮接收事件。预览事件使用 Tunnel down 方法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-19T18:41:14.020

正如其他人所说，这是因为事件在可以进一步冒泡之前`MouseDown`得到处理。`Button`您可以在 Reflector 中看到这一点`ButtonBase.OnMouseLeftButtonDown`：

```
protected override void OnMouseLeftButtonDown(MouseButtonEventArgs e)
{
    if (this.ClickMode != ClickMode.Hover)
    {
        e.Handled = true;
        // SNIP...
    }
    base.OnMouseLeftButtonDown(e);
} 
```

一种解决方案是侦听`MouseDown`事件，并表明您不在乎是否处理了该事件。您可以使用该[`AddHandler`](http://msdn.microsoft.com/en-us/library/ms598899.aspx)方法执行此操作。它有一个布尔重载，可让您侦听已处理的事件。

如果您在某处执行此操作而不是在 XAML 中设置 MouseDown 处理程序：

```
TheStackPanel.AddHandler(MouseDownEvent, new MouseButtonEventHandler(TheStackPanel_MouseDown), true); 
```

您将收到`MouseDown`上的所有事件`TheStackPanel`，无论它们是否已被处理。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-19T14:00:18.727

此外，如果您希望 stackpanel 接收事件，请将 stackpanel xaml 更改为：

```
<StackPanel x:Name="TheStackPanel" 
            Background="Yellow"
            Button.Click="TheStackPanel_MouseDown" /> 
```

和事件签名：

```
private void TheStackPanel_MouseDown(object sender, RoutedEventArgs e) 
```

在这种情况下，stackpanel 将接收按钮的单击事件。但是，单击堆栈面板本身不会触发任何事件，因为它专门侦听按钮单击。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T13:56:40.170

这是因为所有消息都由Button~~处理，并且消息停止~~~~消息停止~~冒泡。答案在您的问题文本中是正确的：

> 一个事件将从源元素向上冒泡（传播）到可视化树，**直到它被处理**或到达根元素。

编辑：

Edward Tanguay（OP）评论了这个答案，我在这里复制他的评论，因为它非常相关：

> “我没有看到按钮正在处理事件，即我在按钮上没有点击处理程序，我在 StackPanel 上有一个点击处理程序（MouseDown），因此我认为它会冒泡 PAST 按钮，因为按钮不处理它并由堆栈面板处理，对吗？”

你说的对。Button 未处理 MouseDown 事件，因为在该控件上没有为它指定处理程序。

但是，MouseDown 在某些方面是特别的。至少在 Windows 窗体中，它用于启动绘制和拖动等操作，因此，当控件获取事件时，即使您尚未为其定义处理程序，它也会继续捕获所有后续鼠标消息。此陷阱在控件将 Capture 属性设置为 True 时完成，这有效地阻止了后续事件冒泡。Windows 窗体在收到 MouseUp 事件时将 Capture 属性设置回 False。

我再说一遍，这就是它在 Windows 窗体中的工作方式，您可能想仔细检查一下，但是恕我直言，没有理由为什么 WPF 应该有所不同。

[供参考：请参阅http://blogs.msdn.com/jfoscoding/archive/2005/07/28/444647.aspx](http://blogs.msdn.com/jfoscoding/archive/2005/07/28/444647.aspx)上的“Windows 窗体处理”部分（从页面中间稍微向下滚动）。

注意：有关气泡和隧道事件引发序列的参考，请参阅我对 Arcturu 的回答的评论。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-01-16T20:02:18.127

按钮事件抑制 mousedown 和 mouseup 因为按钮事件是高级事件并且有一些代码可以提供标志句柄 true 这导致抑制 mousdown 以解决此问题您可以在窗口的构造函数中添加此代码

```
TheButton.AddHandler(
    UIElement.MouseDownEvent, 
    new MouseButtonEventHandler(TheStackPanel_MouseDown),
    true); 
```

# sql - MySQL 结果为逗号分隔列表

> ID：662207
> 
> 赞同：142
> 
> 时间：2009-03-19T13:31:10.887
> 
> 标签：sql, mysql, concatenation

我需要运行如下查询：

```
SELECT p.id, p.name, 
       (SELECT name 
          FROM sites s 
         WHERE s.id = p.site_id) AS site_list
  FROM publications p 
```

但我希望子选择返回一个逗号分隔的列表，而不是一列数据。这甚至可能吗？如果可以，怎么做？

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2009-03-19T13:37:03.027

您可以使用[GROUP_CONCAT](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat)来执行该操作，例如

```
SELECT p.id, p.name, GROUP_CONCAT(s.name) AS site_list
FROM sites s
INNER JOIN publications p ON(s.id = p.site_id)
GROUP BY p.id, p.name; 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2019-10-30T09:58:56.153

现在只有我遇到了这种情况，并发现了一些更有趣的功能`GROUP_CONCAT`。我希望这些细节会让你觉得有趣。

**简单的 GROUP_CONCAT**

```
SELECT GROUP_CONCAT(TaskName) 
FROM Tasks; 
```

*结果：*

```
+------------------------------------------------------------------+
| GROUP_CONCAT(TaskName)                                           |
+------------------------------------------------------------------+
| Do garden,Feed cats,Paint roof,Take dog for walk,Relax,Feed cats |
+------------------------------------------------------------------+ 
```

**GROUP_CONCAT 与 DISTINCT**

```
SELECT GROUP_CONCAT(TaskName) 
FROM Tasks; 
```

*结果：*

```
+------------------------------------------------------------------+
| GROUP_CONCAT(TaskName)                                           |
+------------------------------------------------------------------+
| Do garden,Feed cats,Paint roof,Take dog for walk,Relax,Feed cats |
+------------------------------------------------------------------+ 
```

**GROUP_CONCAT 与 DISTINCT 和 ORDER BY**

```
SELECT GROUP_CONCAT(DISTINCT TaskName ORDER BY TaskName DESC) 
FROM Tasks; 
```

*结果：*

```
+--------------------------------------------------------+
| GROUP_CONCAT(DISTINCT TaskName ORDER BY TaskName DESC) |
+--------------------------------------------------------+
| Take dog for walk,Relax,Paint roof,Feed cats,Do garden |
+--------------------------------------------------------+ 
```

**GROUP_CONCAT 与 DISTINCT 和 SEPARATOR**

```
SELECT GROUP_CONCAT(DISTINCT TaskName SEPARATOR ' + ') 
FROM Tasks; 
```

*结果：*

```
+----------------------------------------------------------------+
| GROUP_CONCAT(DISTINCT TaskName SEPARATOR ' + ')                |
+----------------------------------------------------------------+
| Do garden + Feed cats + Paint roof + Relax + Take dog for walk |
+----------------------------------------------------------------+ 
```

**GROUP_CONCAT 和组合列**

```
SELECT GROUP_CONCAT(TaskId, ') ', TaskName SEPARATOR ' ') 
FROM Tasks; 
```

*结果：*

```
+------------------------------------------------------------------------------------+
| GROUP_CONCAT(TaskId, ') ', TaskName SEPARATOR ' ')                                 |
+------------------------------------------------------------------------------------+
| 1) Do garden 2) Feed cats 3) Paint roof 4) Take dog for walk 5) Relax 6) Feed cats |
+------------------------------------------------------------------------------------+ 
```

**GROUP_CONCAT 和 Grouped Results** 假设以下是使用前的结果`GROUP_CONCAT`

```
+------------------------+--------------------------+
| ArtistName             | AlbumName                |
+------------------------+--------------------------+
| Iron Maiden            | Powerslave               |
| AC/DC                  | Powerage                 |
| Jim Reeves             | Singing Down the Lane    |
| Devin Townsend         | Ziltoid the Omniscient   |
| Devin Townsend         | Casualties of Cool       |
| Devin Townsend         | Epicloud                 |
| Iron Maiden            | Somewhere in Time        |
| Iron Maiden            | Piece of Mind            |
| Iron Maiden            | Killers                  |
| Iron Maiden            | No Prayer for the Dying  |
| The Script             | No Sound Without Silence |
| Buddy Rich             | Big Swing Face           |
| Michael Learns to Rock | Blue Night               |
| Michael Learns to Rock | Eternity                 |
| Michael Learns to Rock | Scandinavia              |
| Tom Jones              | Long Lost Suitcase       |
| Tom Jones              | Praise and Blame         |
| Tom Jones              | Along Came Jones         |
| Allan Holdsworth       | All Night Wrong          |
| Allan Holdsworth       | The Sixteen Men of Tain  |
+------------------------+--------------------------+ 
```

```
USE Music;
SELECT ar.ArtistName,
    GROUP_CONCAT(al.AlbumName)
FROM Artists ar
INNER JOIN Albums al
ON ar.ArtistId = al.ArtistId
GROUP BY ArtistName; 
```

*结果：*

```
+------------------------+----------------------------------------------------------------------------+
| ArtistName             | GROUP_CONCAT(al.AlbumName)                                                 |
+------------------------+----------------------------------------------------------------------------+
| AC/DC                  | Powerage                                                                   |
| Allan Holdsworth       | All Night Wrong,The Sixteen Men of Tain                                    |
| Buddy Rich             | Big Swing Face                                                             |
| Devin Townsend         | Epicloud,Ziltoid the Omniscient,Casualties of Cool                         |
| Iron Maiden            | Somewhere in Time,Piece of Mind,Powerslave,Killers,No Prayer for the Dying |
| Jim Reeves             | Singing Down the Lane                                                      |
| Michael Learns to Rock | Eternity,Scandinavia,Blue Night                                            |
| The Script             | No Sound Without Silence                                                   |
| Tom Jones              | Long Lost Suitcase,Praise and Blame,Along Came Jones                       |
+------------------------+----------------------------------------------------------------------------+ 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-12-29T08:44:23.137

而不是使用`group concat()`你可以只使用`concat()`

```
Select concat(Col1, ',', Col2) as Foo_Bar from Table1; 
```

编辑这只适用于 mySQL；Oracle concat 只接受两个参数。在 oracle 中，您可以使用类似 select col1||','||col2||','||col3 as foobar from table1; 在 sql server 中，您将使用 + 而不是管道。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-09-14T10:54:39.730

就我而言，我必须连接一个手机号码唯一的人的所有帐号。所以我使用了以下查询来实现这一点。

```
SELECT GROUP_CONCAT(AccountsNo) as Accounts FROM `tblaccounts` GROUP BY MobileNumber 
```

查询结果如下：

```
Accounts
93348001,97530801,93348001,97530801
89663501
62630701
6227895144840002
60070021
60070020
60070019
60070018
60070017
60070016
60070015 
```

# javascript - 如何从 JavaScript 中的另一个对象访问数据？

> ID：662217
> 
> 赞同：1
> 
> 时间：2009-03-19T13:34:06.043
> 
> 标签：javascript

我想访问对象`availJobs`，`jobs.scan`但我不能。它没有在 中定义`jobs.attack`。我可以做些什么来访问`jobs.scan`其他对象中的部分？

```
var jobs = new Array();

jobs.scan = function() {
    var availJobs = new Array();
    var jobContents = dom.get("app8743457343_content");
    var boldthreads = jobContents.getElementsByTagName('b');
    for(var i = 0; i < boldthreads.length; i++) {
        if(boldthreads[i].style.color == 'silver') {
            availJobs.push(boldthreads[i].textContent);
        }
    }
    return availJobs;
}

jobs.attack = function() {
    jobs.scan();
    alert(jobs.availJobs[0]);
}

jobs.attack(); 
```

`availJobs[0]`在`jobs.attack`不起作用。是`undefined`。如何将其设置`availJobs`为公共并且可以在其他对象中访问？

谢谢大家的帮助！！这是我放的代码：

```
var jobs = {
    availJobs: new Array(),
    scan: function() {
        var jobContents = dom.get("app8743457343_content");
        var boldthreads = jobContents.getElementsByTagName('b');
        for(var i = 0; i < boldthreads.length; i++) {
            if(boldthreads[i].style.color == 'silver') {
                this.availJobs.push(boldthreads[i].textContent);
            }
        }
    },
    attack: function() {
        this.scan();
        alert(this.availJobs[0]);
    },
};

jobs.attack(); 
```

这段代码肯定更优雅，你不觉得吗？我用了这个，它奏效了！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T13:37:07.907

`{}`用于初始化对象，Array 用于初始化数组。

```
var jobs = {
    availJobs : new Array()
}

jobs.scan = function() {
    var jobContents = dom.get("app8743457343_content");
    var boldthreads = jobContents.getElementsByTagName('b');
    for(var i = 0; i < boldthreads.length; i++) {
        if(boldthreads[i].style.color == 'silver') {
            availJobs.push(boldthreads[i].textContent);
        }
    }
    return availJobs;
} 
```

在`{}`声明中，如果用逗号分隔多个成员，则可以将多个成员添加到对象中`,`：

```
var jobs = {
    availJobs : new Array(),
    anotherMember : null,
    anotherArray : new Array(),
    aFunction = function() {...}
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T13:36:39.890

我在这里可能错了，但我很确定你需要在函数本身之外声明availJobs，即：`jobs.availJobs = new Array();`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T13:37:38.110

您的代码不正确。`jobs.scan`是一个功能，`jobs.attack`是另一个。`availJobs`是在 中定义的局部变量`jobs.scan`。您不能从另一个函数访问一个函数的局部变量。

更重要的是，`availJobs`当您尝试访问它时它并不存在，因为 jobs.scan 已经完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T13:38:45.173

您需要声明availJobs 数组，并且jobs 应该是一个对象。

```
var jobs = {}

jobs.availJobs = []

jobs.scan = function() {
    var availJobs = new Array();
    var jobContents = dom.get("app8743457343_content");
    var boldthreads = jobContents.getElementsByTagName('b');
    for(var i = 0; i < boldthreads.length; i++) {
        if(boldthreads[i].style.color == 'silver') {
            availJobs.push(boldthreads[i].textContent);
        }
    }
    return availJobs;
}

jobs.attack = function() {
    jobs.scan();
    alert(jobs.availJobs[0]);
}

jobs.attack(); 
```

# javascript - 如何更改 jQuery DatePicker 控件的弹出位置

> ID：662220
> 
> 赞同：118
> 
> 时间：2009-03-19T13:36:27.973
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-datepicker

知道如何让 DatePicker 出现在相关文本框的末尾而不是直接在它下方吗？倾向于发生的是文本框位于页面底部，并且 DatePicker 向上移动以解决它并完全覆盖文本框。如果用户想输入日期而不是选择日期，他们不能。我宁愿让它出现在文本框之后，所以它如何垂直调整并不重要。

知道如何控制定位吗？我没有看到小部件的任何设置，也没有任何运气来调整 CSS 设置，但我很容易遗漏一些东西。

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-07-24T22:44:00.403

这是我正在使用的：

```
$('input.date').datepicker({
    beforeShow: function(input, inst) {
        inst.dpDiv.css({
            marginTop: -input.offsetHeight + 'px', 
            marginLeft: input.offsetWidth + 'px'
        });
    }
}); 
```

您可能还想在左边距添加一点，这样它就不会正好靠在输入字段上。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-08-28T12:23:39.017

我直接在 CSS 中做：

```
.ui-datepicker { 
  margin-left: 100px;
  z-index: 1000;
} 
```

我的日期输入字段都是 100 像素宽。我还添加了 z-index，因此日历也出现在 AJAX 弹出窗口上方。

我不修改 jquery-ui CSS 文件；我在我的主 CSS 文件中重载了该类，因此我可以更改主题或更新小部件，而无需重新输入我的特定模块。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2012-05-15T09:49:12.083

这是我的 Datepicker 日历对齐的变体。

我认为这很不错，因为您可以通过 jQuery UI Position util 控制定位。

一个限制：需要 jquery.ui.position.js。

代码：

```
$('input[name=date]').datepicker({
    beforeShow: function(input, inst) {
        // Handle calendar position before showing it.
        // It's not supported by Datepicker itself (for now) so we need to use its internal variables.
        var calendar = inst.dpDiv;

        // Dirty hack, but we can't do anything without it (for now, in jQuery UI 1.8.20)
        setTimeout(function() {
            calendar.position({
                my: 'right top',
                at: 'right bottom',
                collision: 'none',
                of: input
            });
        }, 1);
    }
}) 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2015-01-19T21:39:30.937

这是另一个适合我的变体，调整 rect.top + 40, rect.left + 0 以满足您的需要：

```
$(".datepicker").datepicker({
    changeMonth: true,
    changeYear: true,
    dateFormat: 'mm/dd/yy',
    beforeShow: function (input, inst) {
        var rect = input.getBoundingClientRect();
        setTimeout(function () {
	        inst.dpDiv.css({ top: rect.top + 40, left: rect.left + 0 });
        }, 0);
    }
});
```

```
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<form>
<input class="datepicker" name="date1" type="text">
<input class="datepicker" name="date2" type="text">
</form>
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-06-26T07:29:14.423

这个问题的公认答案实际上不适用于 jQuery UI Datepicker。要更改 jQuery UI Datepicker 的位置，只需修改 css 文件中的 .ui-datepicker。Datepicker的大小也可以通过这种方式改变，只需调整字体大小即可。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2012-08-23T18:32:45.597

这对我有用：

```
beforeShow: function(input, inst) {
    var $this = $(this);
    var cal = inst.dpDiv;
    var top = $this.offset().top + $this.outerHeight();
    var left = $this.offset().left;

    setTimeout(function() {
        cal.css({
            'top': top,
            'left': left
        });
    }, 10);
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-06-29T10:47:30.013

首先，我认为 datepicker 对象中应该有一个`afterShowing`方法，您可以在 jquery 在方法中完成所有巫术之后更改位置`_showDatepicker`。`preferedPosition`此外，还需要一个名为的参数，因此您可以设置它并让 jquery 修改它，以防对话框呈现在视口之外。

做这最后一件事有一个“技巧”。如果您研究该`_showDatepicker`方法，您将看到私有变量的使用`$.datepikcer._pos`。如果之前没有人设置过该变量，则会设置该变量。如果您在显示对话框之前修改该变量，Jquery 将使用它并尝试在该位置分配对话框，如果它渲染到屏幕外，它将调整它以确保它是可见的。听起来不错，嗯？

问题是；`_pos`是私人的，但如果你不介意的话。你可以：

```
$('input.date').datepicker({
    beforeShow: function(input, inst)
    {
        $.datepicker._pos = $.datepicker._findPos(input); //this is the default position
        $.datepicker._pos[0] = whatever; //left
        $.datepicker._pos[1] = whatever; //top
    }
}); 
```

但要小心 Jquery-ui 更新，因为内部实现的更改`_showDatepicker`可能会破坏您的代码。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-09-01T05:26:12.837

我需要根据我的无边界输入控件所在的父 div 定位日期选择器。为此，我使用了 jquery UI 核心中包含的“位置”实用程序。我在 beforeShow 活动中做到了这一点。正如上面其他人评论的那样，您不能直接在 beforeShow 中设置位置，因为 datepicker 代码将在完成 beforeShow 功能后重置位置。要解决这个问题，只需使用 setInterval 设置位置。当前脚本将完成，显示日期选择器，然后重新定位代码将在日期选择器可见后立即运行。尽管它永远不会发生，但如果日期选择器在 0.5 秒后不可见，则代码具有放弃和清除间隔的故障安全功能。

```
 beforeShow: function(a, b) {
            var cnt = 0;
            var interval = setInterval(function() {
                cnt++;
                if (b.dpDiv.is(":visible")) {
                    var parent = b.input.closest("div");
                    b.dpDiv.position({ my: "left top", at: "left bottom", of: parent });
                    clearInterval(interval);
                } else if (cnt > 50) {
                    clearInterval(interval);
                }
            }, 10);
        } 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-02-22T09:01:24.517

使用 datepicker 后绑定 focusin 更改 datepicker 小部件的 css 希望帮助

```
$('input.date').datepicker();
$('input.date').focusin(function(){
    $('input.date').datepicker('widget').css({left:"-=127"});
}); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-06-02T12:29:12.910

我用我的自定义 jquery 代码修复了它。

1.  给我的日期选择器输入字段一个类“ ***.datepicker2*** ”

2.  从顶部找到它的当前位置并

3.  定位弹出框，类名为“ ***.ui-datepicker*** ”

这是我的代码。

```
$('.datepicker2').click(function(){
    var popup =$(this).offset();
    var popupTop = popup.top - 40;
    $('.ui-datepicker').css({
      'top' : popupTop
     });
}); 
```

这里“40”是我预期的像素，你可以用你的来改变。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-08-07T00:33:00.440

一个非常简单的jquery函数。

```
$(".datepicker").focus(function(event){
                var dim = $(this).offset();
                $("#ui-datepicker-div").offset({
                    top     :   dim.top - 180,
                    left    :   dim.left + 150
                });
            }); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-12-19T16:50:43.460

我花了很多时间试图为我正在开发的一个新网站的几个页面解决这个问题，但似乎没有任何效果（包括上面我实现的各种解决方案。我猜 jQuery 刚刚改变了事情已经足够了，因为他们被建议解决方案不再起作用。我不知道。老实说，我不明白为什么在 jQuery ui 中没有实现一些简单的东西来配置它，因为它似乎是一个相当大的问题是日历总是在页面下方的某个位置弹出，距离它所附加的输入很远。

无论如何，我想要一个足够通用的最终解决方案，我可以在任何地方使用它并且它会起作用。我似乎终于得出了一个结论，避免了上面一些更复杂和特定于 jQuery 代码的答案：

jsFiddle：http: [//jsfiddle.net/mu27tLen/](http://jsfiddle.net/mu27tLen/)

HTML：

```
<input type="text" class="datePicker" /> 
```

JS：

```
positionDatePicker= function(cssToAdd) {
    /* Remove previous positioner */
    var oldScript= document.getElementById('datePickerPosition');
    if(oldScript) oldScript.parentNode.removeChild(oldScript);
    /* Create new positioner */
    var newStyle= document.createElement("style");
    newStyle.type= 'text/css';
    newStyle.setAttribute('id', 'datePickerPostion');
    if(newStyle.styleSheet) newStyle.styleSheet.cssText= cssToAdd;
    else newStyle.appendChild(document.createTextNode(cssToAdd));
    document.getElementsByTagName("head")[0].appendChild(newStyle);
}
jQuery(document).ready(function() {
    /* Initialize date picker elements */
    var dateInputs= jQuery('input.datePicker');
    dateInputs.datepicker();
    dateInputs.datepicker('option', {
        'dateFormat' : 'mm/dd/yy',
        'beforeShow' : function(input, inst) {
            var bodyRect= document.body.getBoundingClientRect();
            var rect= input.getBoundingClientRect();
            positionDatePicker('.page #ui-datepicker-div{z-index:100 !important;top:' + (rect.top - bodyRect.top + input.offsetHeight + 2) + 'px !important;}');
        }
    }).datepicker('setDate', new Date());
}); 
```

本质上，我在每个日期选择器“显示”事件之前将一个新样式标签附加到头部（如果存在，则删除前一个）。这种做事的方法解决了我在开发过程中遇到的大部分问题。

在 Chrome、Firefox、Safari 和 IE>8 上进行了测试（因为 IE8 不能很好地与 jsFiddle 一起使用，我正在失去关心的热情

我知道这是 jQuery 和 javascript 上下文的混合，但在这一点上，我只是不想努力将其转换为 jQuery。会很简单，我知道。我现在已经完成了这件事。希望其他人可以从这个解决方案中受益。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-05-13T04:32:43.763

我从（（[如何控制 jQueryUI datepicker 的定位](https://stackoverflow.com/questions/1818670/how-to-control-positioning-of-jqueryui-datepicker)））

```
$.extend($.datepicker, { 
    _checkOffset: function(inst, offset, isFixed) { 
        return offset 
    } 
}); 
```

有用 ！！！

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-10-09T19:54:25.933

或者您可以一起使用 dateSelect 对象和位置 api 上的焦点事件。您可以将顶部和底部和左侧交换为右侧或中心（或者实际上是您想要从位置 api 获得的任何东西）。这样您就不需要间隔或任何极其复杂的解决方案，您可以根据输入的位置配置布局以满足您的需求。

```
dateSelect.focus(function () {
    $("#ui-datepicker-div").position({
        my: "left top",
        at: "left bottom",
        of: $(this)
    });
}); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-06-28T08:45:55.880

修复显示位置问题 daterangepicker.jQuery.js

```
//Original Code
//show, hide, or toggle rangepicker
    function showRP() {
        if (rp.data('state') == 'closed') {
            rp.data('state', 'open');
            rp.fadeIn(300);
            options.onOpen();
        }
    }

//Fixed
//show, hide, or toggle rangepicker
    function showRP() {
        rp.parent().css('left', rangeInput.offset().left);
        rp.parent().css('top', rangeInput.offset().top + rangeInput.outerHeight());
        if (rp.data('state') == 'closed') {
            rp.data('state', 'open');
            rp.fadeIn(300);
            options.onOpen();
        }
    } 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-03-21T22:55:49.590

他们将班级名称更改为`ui-datepicker-trigger`

所以这适用于`jquery 1.11.x`

```
.ui-datepicker-trigger { 
margin-top:7px;
  margin-left: -30px;
  margin-bottom:0px;
  position:absolute;
  z-index:1000;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-07-30T15:55:04.827

还值得注意的是，如果 IE 进入 quirks 模式，您的 jQuery UI 组件和其他元素将被错误定位。

为确保您不会陷入怪癖模式，请确保将您的文档类型正确设置为最新的 HTML5。

```
<!DOCTYPE html> 
```

使用过渡会使事情变得一团糟。希望这将在未来节省一些时间。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-04-30T19:29:18.157

这会将功能放入名为 function 的方法中，允许您的代码封装它或使该方法成为 jquery 扩展。刚刚用在我的代码上，效果很好

```
var nOffsetTop  = /* whatever value, set from wherever */;
var nOffsetLeft = /* whatever value, set from wherever */;

$(input).datepicker
(
   beforeShow : function(oInput, oInst) 
   { 
      AlterPostion(oInput, oInst, nOffsetTop, nOffsetLeft); 
   }
);

/* can be converted to extension, or whatever*/
var AlterPosition = function(oInput, oItst, nOffsetTop, nOffsetLeft)
{
   var divContainer = oInst.dpDiv;
   var oElem        = $(this);
       oInput       = $(oInput);

   setTimeout(function() 
   { 
      divContainer.css
      ({ 
         top  : (nOffsetTop >= 0 ? "+=" + nOffsetTop : "-=" + (nOffsetTop * -1)), 
         left : (nOffsetTop >= 0 ? "+=" + nOffsetLeft : "-=" + (nOffsetLeft * -1))
      }); 
   }, 10);
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-07-11T09:29:50.540

在 Jquery.UI 中，只需更新 _checkOffset 函数，以便在返回 offset 之前将 viewHeight 添加到 offset.top。

```
_checkOffset: function(inst, offset, isFixed) {
    var dpWidth = inst.dpDiv.outerWidth(),
    dpHeight = inst.dpDiv.outerHeight(),
    inputWidth = inst.input ? inst.input.outerWidth() : 0,
    inputHeight = inst.input ? inst.input.outerHeight() : 0,
    viewWidth = document.documentElement.clientWidth + (isFixed ? 0 : $(document).scrollLeft()),
            viewHeight = document.documentElement.clientHeight + (isFixed ? 0 : ($(document).scrollTop()||document.body.scrollTop));
        offset.left -= (this._get(inst, "isRTL") ? (dpWidth - inputWidth) : 0);
        offset.left -= (isFixed && offset.left === inst.input.offset().left) ? $(document).scrollLeft() : 0;
        offset.top -= (isFixed && offset.top === (inst.input.offset().top + inputHeight)) ? ($(document).scrollTop()||document.body.scrollTop) : 0;

        // now check if datepicker is showing outside window viewport - move to a better place if so.
        offset.left -= Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
            Math.abs(offset.left + dpWidth - viewWidth) : 0);
        offset.top -= Math.min(offset.top, (offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
            Math.abs(dpHeight + inputHeight) : 0);
**offset.top = offset.top + viewHeight;**
        return offset;
    }, 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-01-08T16:25:26.277

```
.ui-datepicker {-ms-transform: translate(100px,100px); -webkit-transform: translate(100px,100px); transform: translate(100px,100px);} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-05-15T06:24:24.103

```
$('.PDatePicker').MdPersianDateTimePicker({
                Placement: 'top',          
            }); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-01-31T10:57:58.817

这是另一个解决方案。

1.  创建函数来固定位置

    ```
     function setDatepickerPos(input, inst) {
     var rect = input.getBoundingClientRect();
     // use 'setTimeout' to prevent effect overridden by other scripts
     setTimeout(function () {
         var scrollTop = $("body").scrollTop();
         inst.dpDiv.css({ top: rect.top + input.offsetHeight + scrollTop });
     }, 0);} 
    ```

2.  将函数添加到 datepicker 的“beforeShow”属性中

    ```
     $('#MyDatepicker').datepicker({
     dateFormat: "yy-mm-dd",
     changeMonth: true,
     changeYear: true,
     defaultDate: +0,
     inline: true,
     beforeShow: function (input, inst) { setDatepickerPos(input, inst) },}); 
    ```

这是参考链接：[链接](https://aries.me/2020/08/03/jquery-ui-1-12-datepicker-wrong-position-issue-and-fix/)。所有的学分都应该去[Aries.me](https://aries.me/)

# asp.net - 实体框架与替代品

> ID：662231
> 
> 赞同：0
> 
> 时间：2009-03-19T13:39:13.893
> 
> 标签：asp.net, nhibernate, entity-framework, orm

**复制：**

*   [您最喜欢 .NET 的哪些 ORM 框架？](https://stackoverflow.com/questions/249550/what-orm-frameworks-for-net-do-know-which-do-you-like-best)
*   [您目前使用什么来访问数据？](https://stackoverflow.com/questions/45152/what-are-you-currently-using-for-data-access)
*   [选择 ORM 时，LINQ to SQL 或 LINQ to Entities 是否比 NHibernate 更好？](https://stackoverflow.com/questions/71955/when-choosing-an-orm-is-linq-to-sql-or-linq-to-entities-better-than-nhibernate)
*   [中小型 .NET 应用程序的数据库（和 ORM）选择](https://stackoverflow.com/questions/259409/database-and-orm-choice-for-an-small-medium-size-net-application)
*   [等等。](https://stackoverflow.com/search?q=entity-framework+nhibernate)

对于大型 ASP.NET 应用程序、实体框架或 NHibernate，您会推荐什么 OR\M。您认为这两种技术的优缺点是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T13:46:35.203

NHibernate 更加成熟，拥有庞大的用户群，并且支持“真正的延迟加载”，对持久性一无所知......

我会选择NHibernate。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T14:01:16.540

我对一个类似的问题做了一个相当长的回答：[ADO.NET Entity Framework: Decision Making between ORM solutions](https://stackoverflow.com/questions/349718/ado-net-entity-framework-decision-making-between-orm-solutions/349755#349755)。

**但是，既然你问了 :) 我同意，我今天**会选择 NHibernate 作为“企业”网络解决方案，但是..

实体框架的下一个版本应该值得仔细研究。第一个版本还没有准备好进行大规模部署，生成的 T-SQL 还有很多不足之处，但是如果 ADOEF 团队能够正确地将它组合在一起，我看到了一个美好的未来。它可能真的很重要，特别是如果它能够使用经过改进的 SQL 数据服务！

如果有的话，我会复习 eSql（实体 SQL）并习惯使用 LINQ 编写数据查询的语法。有些事情告诉我，这将是未来几年的绝佳体验。

# sql-server-2005 - 刷新 MS 数据仓库多维数据集时出错

> ID：662249
> 
> 赞同：1
> 
> 时间：2009-03-19T13:43:15.897
> 
> 标签：sql-server-2005, data-warehouse, cubes

我们有一个多维数据集，我们正在填充源表中的数据。为了让数据反映我们正在调用“分析服务处理任务”组件。在刷新多维数据集时，我们收到以下错误。

说明：OLE DB 错误：OLE DB 或 ODBC 错误：通讯链路故障；08S01。结束错误错误：2009-03-13 02:26:11.24 代码：0xC11F000C 来源：处理 LedgerTransactions01 多维数据集分析服务执行 DDL 任务描述：OLAP 存储引擎中的错误：维度发生错误，ID 为“Dim Item” V'，正在处理“dimItem”的名称。

多维数据集在 SQL Server 环境中运行，并且此问题并非总是发生。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-28T05:45:45.283

这篇[文章](http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/492f598f-d1c1-4598-bc23-c03fd5fcd96e)似乎表明此错误的一个可能原因是服务器空间不足。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-27T16:21:11.013

我试过了，但它没有解决问题，但是，我们也找到了这个答案，它确实解决了问题。

1.  在 BIDS (VS) 中双击 DataSource

2.  将打开一个窗口 --> 转到模拟信息

3.  确保选中“使用服务帐户”。

[原帖在这里](http://social.msdn.microsoft.com/forums/en-US/sqlanalysisservices/thread/fab54623-b40a-4974-8a28-b96e4e631738/)

# asp.net - 如何处理放置在复合自定义控件中可绑定模板上的子控件的视图状态？

> ID：662265
> 
> 赞同：0
> 
> 时间：2009-03-19T13:48:56.990
> 
> 标签：asp.net, custom-server-controls

我有一个复合数据绑定控件，它承载一个 IBindableTemplate 并根据某些条件将标记动态加载到控件中。现在，当这些子控件被加载到复合控件中并且回发在那里时，我失去了子控件的视图状态。有没有办法，我可以在回发中保存子控件的视图状态？

我也参考。使用[http://scottonwriting.net/sowblog/posts/2129.aspx](http://scottonwriting.net/sowblog/posts/2129.aspx)对 Scott 的解释；但没有用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T15:31:38.497

没有足够的信息。什么时候创建控件？什么时候将它们添加到 Controls 集合中？什么是条件，它在回发时会改变吗？

鉴于控件是在正确的时间添加的，视图状态会在页面周期结束时自动保存（无论是否回发）。

如果您稍后添加控件，在某些情况下在所有初始化完成之后，那么为时已晚。

**更新**

如果没有代码，很难猜测故障发生在哪里。让我们检查一个带有自定义模板的Repeater，它可以根据某些条件加载控件。此示例正在运行，但如果在 Page_Load 上完成模板分配，它将失败。这和你的情况相似吗？

形式：

```
<div>
    <asp:Repeater ID="repeater" runat="server" />
    <asp:Button ID="submitButton" runat="server" Text="Submit" onclick="submitButton_Click" />
    <asp:Button ID="postButton" runat="server" Text="PostBack" />
</div> 
```

代码：

```
public partial class _Default : System.Web.UI.Page
{
    protected override void OnInit(EventArgs e)
    {
        base.OnInit(e);
        repeater.ItemTemplate = new MyTemplate();
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        //however, if I was to move repeater.ItemTemplate = new MyTemplate() here
        //it would not reload the view state
        if (!IsPostBack)
        {
            repeater.DataSource = new int[] { 1, 2, 3, 4, 5 };
            repeater.DataBind();
        }
    }

    protected void submitButton_Click(object sender, EventArgs e)
    {
        submitButton.Text = "Do it again";
    }
}

public class MyTemplate : IBindableTemplate, INamingContainer
{
    #region IBindableTemplate Members
    public System.Collections.Specialized.IOrderedDictionary ExtractValues(Control container)
    {
        OrderedDictionary dictionary = new OrderedDictionary();
        return dictionary;
    }
    #endregion

    #region ITemplate Members
    public void InstantiateIn(Control container)
    {
        Label label = new Label();
        label.Text = "Label";
        container.Controls.Add(label);

        TextBox textbox = new TextBox();
        container.Controls.Add(textbox);
    }
    #endregion
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T08:22:54.987

您的理论代码几乎接近我的情况，只有一个主要区别是我没有从 IBindable 扩展我的模板类，而是我在标记本身中为模板提供控件，这是要求。

斯科特也明确表示，如果我们像您所做的那样将控件添加到模板中

```
 #region ITemplate Members
         public void InstantiateIn(Control container)
         {
             Label label = new Label();
             label.Text = "Label";
             container.Controls.Add(label);

             TextBox textbox = new TextBox();
             container.Controls.Add(textbox);
         }
         #endregion 
```

然后视图状态将在每次回发时自动持久化。我所需要的只是让我的模板在标记中被实例化，并且在回发时仍然保持视图状态，并允许我获取控制状态，即使我曾经使用一些不同的数据重新启动模板。

# c# - 您可以一般地将 Web 服务调用传递给另一台服务器吗？

> ID：662271
> 
> 赞同：3
> 
> 时间：2009-03-19T13:51:06.017
> 
> 标签：c#, asp.net, web-services, iis-6

我有两台服务器，一台在单独的域中，另一台在主域中，它们需要来回传递 Web 服务调用。出于安全和其他各种原因，我不希望这些机器直接相互交谈。

我希望在它们之间有一个服务器，将这些 Web 服务请求路由到另一台服务器。

我开始编写一个 .net Web 服务应用程序，它反映了每个可能的 Web 服务调用的签名，但这似乎不太实用，并且需要在签名更改时进行更新。

内置的 IIS 转发似乎没有做我想要的，因为它只是将调用重定向到另一台机器，这不是我想要的。

这些 Web 服务将序列化的 .net 对象作为输入/输出参数传递。

我是否有任何选项可以将 Web 服务调用一般转发到另一台服务器？

-编辑-

要回答有关此需求的一些问题：

当我说它是 DMZ 时我说错了，我应该说它只是一个单独的域。我用这个更新了这个问题。

我上面提到的这种架构的“其他各种原因”是因为我正在与一家通过安全 VPN 访问我们网络的一小部分的子公司打交道。该子公司根本无法直接访问子域。但是，他们确实需要访问子域中服务器上的 Web 服务。他们解决这个问题的方法是拥有一台可以与他们的服务器以及子域中的服务器通信的服务器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T13:57:38.310

从架构上讲，这是一种冗余。您应该寻求在防火墙上实施任何安全措施。

应该允许您的 Web 服务（位于 DMZ 中）通过防火墙上适当安全的端口执行其需要的操作。

我很困惑为什么你需要这样做？

如果没有更多关于不允许两台机器直接通信的安全原因的详细信息，或者没有更多关于为什么这两个 Web 服务需要在彼此之间传递相同功能的调用的详细信息，似乎很难提供帮助。

**更新**

因此，您将让子公司在适当配置的 Web 服务（见上文）上调用函数，该 Web 服务位于您的核心域的 DMZ 中。

这样他们就不需要访问子域，因为 Web 服务将调用您的域而不是子域用户本身。

相同的架构适用不是吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T14:53:52.887

WCF 支持[WS-Addressing](http://www.w3.org/Submission/ws-addressing/)。查看有关[如何设置 WCF 路由器](http://msdn.microsoft.com/en-us/magazine/cc500646.aspx)的 MSDN 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T13:59:15.313

WCF 具有路由功能，并且 WCF 将 SOAP over HTTP 称为 ASP.NET WebServices。所以也许[在谷歌中搜索“WCF 路由”](http://www.google.com/search?client=safari&rls=nb-no&q=wcf+routing&ie=UTF-8&oe=UTF-8)会给你一些有用的信息......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T14:00:30.113

我认为您真正要寻找的是[Proxy Server](http://en.wikipedia.org/wiki/Proxy_server)。Microsoft 有自己的产品，称为[Microsoft Internet Security & Acceleration (ISA) Server](http://www.microsoft.com/forefront/edgesecurity/isaserver/en/us/default.aspx)，但您可能会找到一个免费/开源产品来满足您相当简单的要求。

虽然我有点同意[查尔斯](https://stackoverflow.com/questions/662271/can-you-generically-pass-web-service-calls-to-another-server/662295#662295)的观点，但不明白你为什么需要这样做？

凯夫

# actionscript-3 - 场景图形/显示列表之外的 AS3 事件冒泡

> ID：662274
> 
> 赞同：2
> 
> 时间：2009-03-19T13:52:11.397
> 
> 标签：actionscript-3, events, event-bubbling

您好只是想知道是否可以在 AS3 的非显示列表类中利用事件冒泡。

例如，在一个应用程序模型中，有一个包含许多汽车的 City 类。有哪些方法可以将事件侦听器附加到 City 对象并接收从子 Cars 冒出的事件。为了澄清 City 和 Car 对象不是显示列表的一部分，它们不是 DisplayObjects。那么冒泡可以以某种方式在显示列表之外实现吗？

据我所知，如果不手动将事件侦听器附加到每个 Car 对象并从 City 对象重新调度事件，这是不可能的。其他人有更清洁的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-29T22:11:34.423

这门课是我解决这个问题的方法。基本上让你的类通常会扩展 EventDispatcher 而不是扩展 BubblingEventDispatcher

然后调用 addChildTarget(target:BubblingEventDispatcher) 函数来设置可以从中捕获冒泡事件的子项。

此解决方案为每个事件调度程序使用一个 sprite，但导致每个类仅使用 1 字节的额外内存

```
package 
{
 import flash.display.Sprite;
 import flash.events.Event;
 import flash.events.EventDispatcher;

 public class BubblingEventDispatcher extends EventDispatcher
 {
  //We have to use a sprite to take advantage of flash's internal event bubbling system
  private var sprite:Sprite;

  public function BubblingEventDispatcher()
  {
   //initialize our sprite
   sprite = new Sprite();
  }

  public override function addEventListener(type:String, listener:Function, useCapture:Boolean=false, priority:int=0, useWeakReference:Boolean=false):void
  {
   sprite.addEventListener( type, listener, useCapture, priority, useWeakReference );
  }

  public override function dispatchEvent(event:Event):Boolean
  {
   return sprite.dispatchEvent( event );
  }

  //We must add child targets if we want to take advantage of the bubbling
  public function addChildTarget( target:BubblingEventDispatcher ):void
  {
   sprite.addChild( target.eventTarget as Sprite );
  }

  public function get eventTarget():EventDispatcher
  {
   return sprite;
  }
 }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T14:00:59.410

我不确定我是否完全理解，但是当你创建一个事件时，你可以说它会冒泡，所以当它调度时它会冒泡。

[http://livedocs.adobe.com/flex/3/html/help.html?content=createevents_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=createevents_3.html)

[http://livedocs.adobe.com/flex/3/langref/flash/events/Event.html#Event()](http://livedocs.adobe.com/flex/3/langref/flash/events/Event.html#Event())

我相信这将允许您将事件侦听器附加到您的城市以获取正确类型的事件，并且可以捕获汽车引发的事件。我从来没有试过这个，所以我不确定。

**更新：**

啊，我没有意识到这一点。你是对的。从以下链接：

[http://livedocs.adobe.com/flex/3/html/help.html?content=events_08.html](http://livedocs.adobe.com/flex/3/html/help.html?content=events_08.html)

> 捕获和冒泡发生在 Event 对象在显示列表中从一个节点移动到另一个节点时：父到子用于捕获，子到父用于冒泡。这个过程与继承层次无关。除了目标阶段之外，只有 DisplayObject 对象（容器和控件等可视对象）可以具有捕获阶段和冒泡阶段。

我能看到的唯一方法是每次将新的孩子添加为孩子时，您都要向父母（城市的汽车）注册孩子。此时，您可以在父级（城市）中添加一个事件侦听器，然后在任何时候从子级（汽车）处理事件时从父级（城市）重新调度事件。我知道它很难看，并且您希望确保在删除孩子的任何时候都删除事件侦听器，但这是我能看到的唯一真正的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T21:14:08.580

我不确定这是哪一年发布的，但我刚刚发现了这个，男孩是不是很愚蠢。为什么冒泡会依赖于显示列表？在我看来，在 AS3 中构建事件模型时，Adobe 应该为任何类实现冒泡。我需要更频繁地在不同类之间传递数据，而不是让多个显示对象相互监听。更不用说使用显示列表和根引用显示对象比引用由动态实例使用的动态实例使用的动态实例要容易得多（你明白了）。毕竟AS2的事件模型和AS3的事件模型相差不远

# javascript - 需要如何从 Viewdata 列表填充 javascript 数组的简单示例

> ID：662277
> 
> 赞同：3
> 
> 时间：2009-03-19T13:53:22.707
> 
> 标签：javascript, asp.net-mvc, arrays, viewdata

可能有一种更简单的方法可以做到这一点，如果有的话，我会全神贯注。我的情况是我在表单上有一个下拉列表，我成功地填充了文本和值。我还需要从客户端上可用的 db 表中的同一表行中获取其他相关字符串值，因此当用户从下拉列表中选择时，此相关数据将填充到表单上的文本框中。我只处理 4 条记录，因此存储在客户端上没什么大不了的。我考虑过通过 ViewData 将这些数据作为列表传递并加载到 javascript 数组中。当用户从下拉列表中选择时 - 我将确定所选索引并从数组中获取我需要的相关数据。我已经将下拉项的值用于其他所需数据，因此我需要一种方法来获取这些相关数据，而无需返回服务器。

谢谢，

麦克风

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T14:20:26.680

```
var myArray = [
<% foreach (string item in ViewData["list"] as List<string>) { %>
"<%= item %>",
<% } %>
]; 
```

据报道，最后有一个逗号会在 IE 中中断，所以我建议使用视图扩展帮助器方法来使代码更易于管理：

```
<%= Html.JavaScriptArray(ViewData["list"] as List<string>, "myArray") %> 
```

将此辅助方法放在您的解决方案中的某个位置：

```
public static string JavaScriptArray(this HtmlHelper htmlHelper, IList<string> values, string varName) {
    StringBuilder sb = new StringBuilder("var ");
    sb.append(varName);
    sb.append(" = [");
    for (int i = 0; i < values.Count; i++) {
        sb.append("'");
        sb.append(values[i]);
        sb.append("'");
        sb.append(i == values.Count - 1 ? "\n" : ",\n"); // Not the prettiest but it works...
    }
    sb.append("];");
    return sb.toString();
} 
```

从技术上讲，扩展方法可以去任何地方，您只需要在 .aspx 文件中包含命名空间。实际上最好将它们保持在逻辑分离的类中，例如`MyApp.Mvc.Extensions.JavaScriptExtensions`，`MyApp.Mvc.Extensions.LinkExtensions`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T05:59:32.047

怎么样...

```
<%= new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewData["list"]) %> 
```

# xml - 分层 RSS 提要

> ID：662280
> 
> 赞同：0
> 
> 时间：2009-03-19T13:53:59.333
> 
> 标签：xml, rss

是否可以创建具有多级层次结构的 RSS 提要，有点像目录结构？根据 RSS 规范是否允许这样做？如果这是可能的，有谁知道可能有什么限制？例如，是否有任何特定的读者不支持它？我主要关心的是我想创建一个 RSS 提要，以在许多浏览器中与“实时书签”功能一起使用，但能够保持目录感觉。

我不关心生成 RSS 的代码，尽管我们会很感激 RSS xml 的示例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T13:59:04.703

[根据Rss Spec](http://cyber.law.harvard.edu/rss/rss.html)是不可能的，如果您尝试这样做，恐怕很多浏览器将无法识别 rss 格式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T14:00:32.297

您可以做的最好的事情是让 <link> 元素指向其他 rss 提要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-20T23:50:08.127

我意识到自从 OP 提出这个问题以来已经有一段时间了，但我最近一直在考虑做类似的事情 - 我的问题是将具有多个组件（图块）的 HTML 页面表示为 RSS 提要。我正在考虑将 XPath 嵌入到组件（从主页）作为 rss/item/category 标记：

<item> ... <category domain="path">/component1/subcomponent2</category> </item>

希望这可以帮助其他人来寻找:-)。

# c# - 如何在 C# 中获取本地机器名称？

> ID：662282
> 
> 赞同：78
> 
> 时间：2009-03-19T13:54:20.580
> 
> 标签：c#, dns, hostname

如何获取本地机器名称？

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2009-03-19T13:57:18.327

[System.Environment.MachineName](http://msdn.microsoft.com/en-us/library/system.environment.machinename.aspx)

除非[机器名称超过 15 个字符](https://stackoverflow.com/questions/42088346/environment-machinename-is-cropped-to-15-characters?noredirect=1&lq=1)，否则它会起作用。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-03-19T14:09:09.860

从 [源头](http://blog.xploiter.com/2008/09/17/get-your-local-machinecomputer-name-in-c/)

获取本地网络/机器名称的四种方法：

```
string name = Environment.MachineName;
string name = System.Net.Dns.GetHostName();
string name = System.Windows.Forms.SystemInformation.ComputerName;
string name = System.Environment.GetEnvironmentVariable("COMPUTERNAME"); 
```

更多信息请参见： [SystemInformation.ComputerName、Environment.MachineName 和 Net.Dns.GetHostName 之间的区别](https://stackoverflow.com/questions/1233217/difference-between-systeminformation-computername-environment-machinename-and-n)

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-03-19T13:58:49.853

您应该可以使用`System.Environment.MachineName`它。它是一个返回包含计算机的 netBIOS 名称的字符串的属性：

[http://msdn.microsoft.com/en-us/library/system.environment.machinename.aspx](http://msdn.microsoft.com/en-us/library/system.environment.machinename.aspx)

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-11-23T11:58:00.653

如果您想要本地计算机的 FQDN（完全限定域名），您可以使用

`System.Net.Dns.GetHostEntry("localhost").HostName`

其他方法将仅返回本地名称，没有任何特定于域的信息。例如，对于计算机`myComp.myDomain.com`，之前的方法将返回`myComp`，而`GetHostEntry`方法将返回`myComp.myDomain.com`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-29T02:07:42.257

我的计算机名称超过 15 个字符，所以我使用 hostname.exe 来获取全长名称：

```
Process proc = new Process();
proc.StartInfo.UseShellExecute = false;
proc.StartInfo.RedirectStandardOutput = true;
proc.StartInfo.FileName = "c:/windows/system32/hostname.exe";
proc.Start();
var hostName = proc.StandardOutput.ReadLine(); 
```

# visual-studio-2008 - Visual Studio 2008 XML 文档

> ID：662298
> 
> 赞同：2
> 
> 时间：2009-03-19T13:58:05.020
> 
> 标签：visual-studio-2008, xml-comments

我似乎在我的项目的属性页中的“配置属性”文件夹下找不到“构建”选项。我一直在寻找四处试图弄清楚如何做到这一点。

我按照这里的指示：http: [//msdn.microsoft.com/en-us/magazine/cc302121.aspx](http://msdn.microsoft.com/en-us/magazine/cc302121.aspx)

更具体地说：http: [//msdn.microsoft.com/en-us/library/azt1z1eh.aspx](http://msdn.microsoft.com/en-us/library/azt1z1eh.aspx) （“在 Visual Studio 中构建 XML 文档示例”部分）

我想在构建中为我的项目生成 XML 注释，但我的“配置属性”窗口下没有“文件夹”或“构建”选项。

我正在使用 Visual Studio Team System 2008，有什么想法吗？

编辑 -> 这是一个网站 [无项目]，它是用 C# 和 VB.NET 编写的。

我需要下载任何工具吗？我找到了 GhostDoc，但这对我帮助不大。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T14:01:35.493

我不确定“配置属性”文件夹是什么意思。我没有这样的东西 - 如果我只是双击项目下的“属性”（在解决方案资源管理器中），它会出现具有以下选项卡的属性页面（对于 VS 2008 Pro 中的控制台应用程序）：

*   应用
*   建造
*   构建事件
*   调试
*   资源
*   服务
*   设置
*   参考路径
*   签约
*   安全
*   发布

这听起来像你正在看的屏幕吗？你能抓住你所拥有的截图吗？

如果你只是双击“属性”，你会得到什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T14:03:55.677

您使用的是 C# 还是 VB.NET？在 VB.NET 中，属性页看起来有点不同。编译属性页面上有一个复选框，说明“生成 XML 文档文件”。确保已检查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T15:33:23.913

我有一个网络服务，我想为其创建这种文档。这也是一个网站项目，所以我没有菜单。有没有针对这种情况找到解决方案？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T10:14:39.773

右键单击项目的任何类库并选择属性，然后您将找到“构建”选项卡选项...在那里您可以指定 xml 文档文件路径。-易卜拉欣

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-21T17:59:54.927

您引用的 MSDN 杂志文章已过时。2008 和 2010 文档的链接已更新，并提供了正确的方向。

**通过选择Project |**打开 XML 注释。**菜单中的属性**并转到**构建**页面。您可能会注意到，对于许多监视器，您必须在**构建**页面上向下滚动，然后才能找到有关 XML 注释的部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-06T23:41:10.313

能够为 Web 服务（网站项目）构建文档是有意义的，因为它将被第三方使用。[Web 服务调用者可以使用wcfextras](http://wcfextras.codeplex.com/)流通过 wsdl 使用 XML 文档。这是否意味着我必须将仅包含两个 .cs 文件的解决方案分解为一个单独的项目，以便获取文档或有其他方法吗？谢谢。

# streaming - 流媒体流速度混乱

> ID：662318
> 
> 赞同：0
> 
> 时间：2009-03-19T14:01:18.910
> 
> 标签：streaming, frame-rate

我总是对关于流媒体的两个参数感到困惑——fps（每秒帧数）和比特率（例如 256k bps、512k bps 等）。

我不想知道数学和算法的内部原理，我只是想弄清楚我的以下理解是否正确。

我认为 15 fps 和 256 bps 意味着每秒，服务器将发送 15 帧，这 15 帧聚合为 256k 位到客户端。帧可以是任何帧、关键帧（我指的是 MPEG 中的 I 帧）或非关键帧。用于表示一秒钟内 15 帧中的每一帧的位不必相同，总量为 256k 位应该没问题。这种理解正确吗？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T14:09:42.137

几乎，

服务器每秒可能发送多于或少于 15 帧，这些应在客户端缓冲。15 fps 意味着视频应该每秒播放 15 帧才能看起来正常。*平均而言*，这意味着服务器每秒将发送 15 帧。但是，在接下来的 11 秒内，你肯定会得到 4 帧，而在接下来的 11 秒内，你肯定会得到 16 帧。

# winforms - Windows 窗体 - 报表设计器

> ID：662323
> 
> 赞同：0
> 
> 时间：2009-03-19T14:02:11.607
> 
> 标签：winforms, reporting

是否有允许用户在 WinForms 应用程序中定义报表布局的解决方案？我们正在使用 xml、xslt 和 Word 有一些不错的结果，但想知道是否有更好的选择。

我们想要：

1.  设置元素的边距、内边距、定位
2.  声明基于列的或连续的报表元素
3.  不需要做排版

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T19:03:00.173

我们的 Data Dynamics Reports 产品包括一个用于 Windows 窗体的最终用户设计器控件，您可以将其拖放到 Windows 窗体上，并为您的最终用户提供一个功能齐全的报表设计器。访问[Data Dynamics Reports 产品页面](http://www.datadynamics.com/Products/DDRPT/)，选择功能选项卡并查看功能页面底部附近的标题“设计器控件”。

虽然不是[这个截屏视频](http://www.datadynamics.com/Products/DDRPT/ScreencastViewer.aspx?ID=DSXML)的主要焦点，但它确实展示了一些关于最终用户设计器控件的信息。

最后，如果您下载免费评估版（单击下载[主产品页面](http://www.datadynamics.com/Products/DDRPT/)），请从开始菜单（在 Data Dynamics 下）选择 Sample Gallery。弹出的 Sample Gallery 表单是使用我们的最终用户设计器控件的详细演示。

```
Scott Willeke
Data Dynamics / GrapeCity 
```

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2009-03-19T16:03:17.690

使用 Visual Studio 创建报表。假设您使用的是 reportviewer 组件，您可以将报告定义文件添加到您的项目 (.rdlc)，并且 IDE 为您提供了一个 GUI 来编辑报告。

# apache-flex - Adobe Flex 到 erlang 的连接？

> ID：662327
> 
> 赞同：4
> 
> 时间：2009-03-19T14:02:18.720
> 
> 标签：apache-flex, erlang

有没有人让 Adob​​e Flex 和 erlang 相互连接？许多人在各种博客上谈论这个，但我还没有看到一个可行的解决方案。

Flex 和 erlang 将形成真正的最佳组合。

谢谢。

院长

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T17:12:56.897

I haven't but I have thought about a few potential options:

*   AMF - ErlAMF - [http://code.google.com/p/erlamf/](http://code.google.com/p/erlamf/)
*   JSON - as3corelib has JSON [http://code.google.com/p/as3corelib/](http://code.google.com/p/as3corelib/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-29T00:57:12.003

我已经在 github 上发布了带有 flex 远程处理模块和示例的 erlang-http 服务器。

```
git clone git://github.com/mujaheed/erlang-http.git
cd erlang-http
git submodule init
git submodule update
make
cd examples/stock
make run 
```

然后将浏览器指向[http://localhost:8080](http://localhost:8080)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T14:09:23.807

我不知道答案，它可能会滚动您自己的 AMF 传输或使用 http/rest 类型的 API，但 Ted Patrick 的这篇博文可能会给您一个起点：

[http://www.onflex.org/ted/2008/01/why-erlang.php](http://www.onflex.org/ted/2008/01/why-erlang.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T00:12:34.113

Flex 前端和 RESTful 后端运行良好 - 使用套接字来运行您的远程处理。

可以在[此处](http://code.google.com/p/jssockets/)找到套接字示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T09:43:32.010

我认为[Vimagi](http://vimagi.com/)结合了 Flash/Flex？与二郎。

# c++ - 什么是简单的 C 或 C++ TCP 服务器和客户端示例？

> ID：662328
> 
> 赞同：46
> 
> 时间：2009-03-19T14:02:28.177
> 
> 标签：c++, tcp, client-server

我需要快速实现一个非常小的 C 或 C++ TCP 服务器/客户端解决方案。这只是将字节数组从一台计算机传输到另一台计算机 - 不需要可扩展/过于复杂。越简单越好。如果可以的话，又快又脏。

我尝试使用本教程中的代码，但无法在 Linux 中使用 g++ 构建它：[http ://www.linuxhowtos.org/C_C++/socket.htm](http://www.linuxhowtos.org/C_C++/socket.htm)

如果可能的话，我想避免使用 3rd 方库，因为我运行它的系统非常有限。这必须是 C 或 C++，因为现有应用程序已经实现。

感谢**emg-2**的回答，我设法使用以下步骤使上述代码示例与 C++ 兼容：

将这些标头添加到客户端和服务器：

```
#include <cstdlib>
#include <cstring>
#include <unistd.h> 
```

在[server.c](http://www.linuxhowtos.org/data/6/server.c)中，将 clilen 的类型更改为 socklen_t。

```
int sockfd, newsockfd, portno/*, clilen*/;
socklen_t clilen; 
```

在[client.c](http://www.linuxhowtos.org/data/6/client.c)中，更改以下行：

```
if (connect(sockfd,&serv_addr,sizeof(serv_addr)) < 0) { ... } 
```

到：

```
if (connect(sockfd,(const sockaddr*)&serv_addr,sizeof(serv_addr)) < 0) 
```

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-19T14:09:58.907

我过去使用过[Beej 的网络编程指南](https://www.beej.us/guide/bgnet/html)。它是用 C 语言编写的，而不是 C++ 语言，但示例很好。直接转到[第 6 节](https://www.beej.us/guide/bgnet/html/#client-server-background)，了解简单的客户端和服务器示例程序。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-19T14:21:11.920

如果代码应该很简单，那么您可能会要求基于传统 BSD 套接字的 C 示例。对于简短而简单的“hello world”示例，imho 之类的解决方案`boost::asio`非常复杂。

要编译您提到的示例，您必须进行简单的修复，因为您是在 C++ 编译器下编译的。我指的是以下文件：
[http ://www.linuxhowtos.org/data/6/server.c](http://www.linuxhowtos.org/data/6/server.c)
[http://www.linuxhowtos.org/data/6/client.c](http://www.linuxhowtos.org/data/6/client.c)
来自：[http://www。 linuxhowtos.org/C_C++/socket.htm](http://www.linuxhowtos.org/C_C++/socket.htm)

1.  将以下包含添加到两个文件中：

    ```
    #include <cstdlib>
    #include <cstring>
    #include <unistd.h> 
    ```

2.  在[client.c](http://www.linuxhowtos.org/data/6/client.c)中，更改以下行：

    ```
    if (connect(sockfd,&serv_addr,sizeof(serv_addr)) < 0)
    { ... } 
    ```

    到：

    ```
    if (connect(sockfd,(const sockaddr*)&serv_addr,sizeof(serv_addr)) < 0)
    { ... } 
    ```

正如您在 C++ 中看到的，需要显式转换。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-19T14:03:08.627

试试 boost::asio lib ( [http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio.html](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio.html) ) 它有很多例子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-02-19T18:30:59.750

虽然很多年前，clsocket 似乎是一个非常不错的小型跨平台（Windows、Linux、Mac OSX）：[https ://github.com/DFHack/clsocket](https://github.com/DFHack/clsocket)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-12T11:59:24.720

以下是一些示例：

1) 简单
2) 分叉
3) 线程

基于服务器：

[http://www.martinbroadhurst.com/server-examples.html](http://www.martinbroadhurst.com/server-examples.html)

# obfuscation - 如何使用 ProGuard 混淆 OSGi 包？

> ID：662335
> 
> 赞同：4
> 
> 时间：2009-03-19T14:03:58.547
> 
> 标签：obfuscation, osgi, rcp, proguard, manifest.mf

我目前正在尝试使用 ProGuard 混淆我的 Eclipse RCP 应用程序。问题在于它混淆了包名（My.Package.Class 类变成了类似 abc），但将包名保留在 MANIFEST.MF 的 Export-Package 部分。

这导致我的应用程序（实际上是一组 OSGi 捆绑包）无法运行，因为无法解析 MANIFEST.MFs 的 Export-Package 部分中指定的包名称。

ProGuard 混淆基于 OSGi 的 RCP 应用程序是否有人成功？基本上，我看到了两个选择：要么完全关闭包名称混淆，要么混淆 MANIFEST.MF 的 Export-Package 部分，但我找不到实现其中任何一个的方法。Proguard 似乎只混淆了 MANIFEST.MF 中的 Bundle-Activator 类名，跳过了所有其他部分。提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T14:11:09.357

关闭包名混淆；我的意思是你通过告诉世界包名称暴露了哪些重要的商业价值？

如果这确实是个问题，请将所有代码移动到完全混淆的库中，并在非混淆插件中使用该库。

也就是说，请考虑完全不要在混淆上浪费时间。这将花费您的时间和金钱，并且是否有任何好处值得怀疑。当你的竞争对手开始拆解你有价值的工作时，你将编写下一个版本。那么为什么要打扰呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-27T17:19:10.883

ProGuard 不支持内置的 OSGi 包混淆。查看[Proguard 功能请求 #135](http://sourceforge.net/p/proguard/feature-requests/135/)了解更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-11-04T15:16:44.223

为 OSGI 声明式服务使用以下保留选项

```
#Keep all annotations.
-keepattributes *Annotation*,Exceptions
#Keep all interfaces. This is required to run OSGi services.
-keep public interface *
#Keep all Component classes
-keep @org.osgi.service.component.annotations.Component class *
#Kepp all Component classes member functions with OSGi specific annotations
-keepclassmembers @org.osgi.service.component.annotations.Component class * {
   #Keep all methods with annotatios Reference.
   @org.osgi.service.component.annotations.Reference *;
   #Keep all methods with annotatios Activate.
   @org.osgi.service.component.annotations.Activate *;
} 
```

# html - 使用“边距：0 自动；” 在 Internet Explorer 8 中

> ID：662341
> 
> 赞同：81
> 
> 时间：2009-03-19T14:05:40.883
> 
> 标签：html, css, internet-explorer-8

我正在进行一些高级 IE8 测试，似乎旧的使用技术`margin: 0 auto;`在 IE8 中并不适用于所有情况。

以下 HTML 在 FF3、Opera、Safari、Chrome、IE7 和 IE8 兼容中提供了一个居中按钮，但在 IE8 标准中**没有：**

```
<div style="height: 500px; width: 500px; background-color: Yellow;">
    <input type="submit" style="display: block; margin: 0 auto;" />
</div> 
```

（作为一种解决方法，我可以为按钮添加显式宽度）。

所以问题是：哪些浏览器是正确的？或者这是行为未定义的情况之一？

（我的想法是**所有**的浏览器都不正确——如果它是“显示：块”，按钮不应该是 100% 宽度吗？）

*更新：我是个笨蛋。由于输入不是块级元素，因此我应该将其包含在带有“text-align：center”的 div 中。话虽如此，出于好奇，我仍然想知道按钮是否应该或不应该在上面的示例中居中。*

**赏金：我知道我在示例中做了一些奇怪的事情，正如我在更新中指出的那样，我应该将其对齐中心。对于赏金，我想参考回答的规范：**

1.  **如果我设置“显示：块”，按钮的宽度应该是 100% 吗？或者这是未定义的？**

2.  **由于显示是块状的，应该是“margin: 0 auto;” 使按钮居中，或不居中，或未定义？**

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2010-10-05T21:48:55.540

添加`<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">`解决问题

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2009-05-02T18:36:31.933

这是IE8中的一个错误。

从你的第二个问题开始：“margin：0 auto”使块居中，但仅当块的宽度设置为小于父级的宽度时。通常，它们是相同的。这就是为什么下面示例中的文本没有居中的原因。

```
<div style="height: 100px; width: 500px; background-color: Yellow;">    
    <b style="display: block; margin: 0 auto; ">text</b>
</div> 
```

一旦 b 元素的显示样式设置为块，它的宽度默认为父宽度。[CSS 规范](http://www.w3.org/TR/CSS2/visudet.html#the-width-property) *10.3.3 正常流程中的块级、非替换元素*描述了如何：“如果 'width' 设置为 'auto'，则任何其他 'auto' 值变为 '0' 并且 'width' 遵循结果相等。” 那里提到的平等是

'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' = 包含块的宽度

因此，通常所有的自动都会导致块宽度等于包含块的宽度。

但是，此计算不应应用于 INPUT，它是一个替换元素。被替换的元素包含在*10.3.4 块级，正常流程中的替换元素中*。那里的文字说：“'width'的使用值是根据内联替换元素确定的。” *10.3.2 内联替换元素*的相关部分是：“如果'width' 的计算值为'auto'，并且元素具有固有宽度，则该固有宽度是'width' 的使用值”。

我猜CSS关心的场景是IMG元素。此示例中的 Stackoverflow 徽标将由所有浏览器居中。

```
<div style="height: 100px; width: 500px; background-color: Yellow;">    
    <img style="display: block; margin: 0 auto; " border="0" src="http://stackoverflow.com/content/img/so/logo.png" alt="">
</div> 
```

INPUT 元素的行为方式应该相同。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-03T09:14:55.457

是的，你可以阅读规范一百遍，并结合不同的点点滴滴，直到你有一个感觉正确的解释——但这正是浏览器供应商所做的，这就是我们处于今天这种情况的原因。

本质上，当您对元素应用 100% 的宽度时，如果该父元素是块元素，它应该扩展到其父元素宽度的 100%。`margin: 0 auto;`因为它已经占据了可用宽度的 100%，所以您不能再将其居中。

要将任何东西居中，`margin: 0 auto;`您需要定义一个明确的宽度。要使内联元素居中，您可以`text-align: center;`在父元素上使用，尽管如果父元素有其他子元素，这可能会产生不必要的副作用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-04T04:06:08.640

表单控件是CSS 中的*替换元素*。

> [10.3.4 正常流程中的块级替换元素](http://www.w3.org/TR/CSS2/visudet.html#block-replaced-width)
> 
> 'width'的使用**值与内联替换元素一样确定**。然后应用非替换块级元素的规则来确定边距。

所以表单控件*不应该*被拉伸到 100% 宽度。

但是，它*[应该](http://www.w3.org/TR/CSS2/visudet.html#blockwidth)*居中。它看起来像 IE8 中的一个普通错误。如果您设置特定宽度，它将使元素居中：

```
<input type="submit" style="display: block; width:100px; margin: 0 auto;" /> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-08T11:46:33.613

正如 buti-oxa 所解释的，这是 IE8 处理替换元素的方式的错误。如果您不想为按钮添加显式宽度，则可以将其更改为内联块并居中对齐内容：

```
<div style="height: 500px; width: 500px; background-color: Yellow; text-align: center;">
  <input type="submit" style="display: inline-block;" />
</div> 
```

如果您希望它在不支持 inline-block 的旧版本 Mozilla（包括 FF2）中工作，那么您可以添加`display: -moz-inline-stack;`到按钮。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-19T12:26:27.727

至于这是与规范相关的“错误”；不是。作为帖子问题的作者，这种行为将是“未定义的”，因为 IE 中的这种行为仅发生在表单控件上，根据规范：

> CSS 2.1 没有定义哪些属性适用于表单控件和框架，或者如何使用 CSS 来设置它们的样式。用户代理可以将 CSS 属性应用于这些元素。建议作者将此类支持视为实验性支持。

（[http://www.w3.org/TR/CSS21/conform.html#conformance](http://www.w3.org/TR/CSS21/conform.html#conformance)）

干杯!

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-03-03T14:46:35.610

再来一次：我们都讨厌 IE！

```
<div style="width:100%;background-color:blue;">
    <div style="margin:0 auto;width:300px;background-color:red;">
        Not Working
    </div>
</div>

<div style="width:100%;background-color:green;text-align:center;">
    <div style="margin:0 auto;width:300px;background-color:orange;text-align:left;">
        Working, but dumb that you have to use text-align
    </div>
</div> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-04-08T21:11:24.243

尝试了以上所有方法，最终这样做

```
<div style="width:100%; background-color:red; text-align:center;">
        <div style="width:900px; margin:0 auto; background-color:blue;">
            hello
        </div>
    </div> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-08-11T08:04:05.610

`<!doctype html>`在 HTML 输出的顶部添加。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-19T14:10:22.337

> 如果按钮是“显示：块”，按钮不应该是 100% 宽度吗

不，这只是意味着它是垂直空间中唯一的东西（假设你没有使用其他技巧来强制那里的其他东西）。这并不意味着它必须填满该空间的宽度。

我认为您在这种情况下的问题是它`input`本身不是块元素。尝试将其嵌套在另一个 div 中并在其上设置边距。但是我目前没有 IE8 浏览器来测试这个，所以这只是一个猜测。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-19T14:32:16.497

"margin: 0 auto" 仅当父元素具有 "text-align: center" 时才会在 IE 中居中元素。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-30T15:07:10.580

1.  假设`margin: 0 auto`元素应该居中，但宽度保持原样 - 无论计算结果如何，忽略任何边距设置。
2.  如果您将`<INPUT>`标签设置为`display:block`，那么它应该以 为中心`margin: 0 auto`。

有关更多详细信息，请参阅视觉格式化模型详细信息 -从 CSS 2.1 规范[计算宽度和边距。](http://www.w3.org/TR/CSS2/visudet.html#Computing_widths_and_margins)相关位包括：

> 在块格式化上下文中，每个框的左外边缘接触包含块的左边缘。

和

> 当一行上的行内框的总宽度小于包含它们的行框的宽度时，它们在行框中的水平分布由 'text-align' 属性确定。

最后

> 如果 'width' 设置为 'auto'，则任何其他 'auto' 值都将变为 '0' 并且 'width' 来自结果相等。
> 
> 如果 'margin-left' 和 'margin-right' 都是 'auto'，则它们使用的值相等。这使元素相对于包含块的边缘水平居中。

# android - Android BroadcastReceiver、ContentProvider 和 Activity 之间的数据流？

> ID：662344
> 
> 赞同：5
> 
> 时间：2009-03-19T14:07:50.080
> 
> 标签：android, android-activity, broadcastreceiver, android-contentprovider, dataflow

我开发了一个应用程序，它接收一个广播，然后启动一个`Activity`，在其中`Activity`查询一个`ContentProvider` 实时从 DNS 中提取信息的应用程序。

我希望能够改组这个，而不是去：

```
BroadcastReceiver.onReceive() {
  Intent intent = new Intent(...);
  intent.setData(...); // set a single String data
  context.startActivity(intent);
}

Activity.onCreate() {
  String value = intent.getData();  // get the String data
  Cursor = ContentProvider.query(search);
  ...
  setContentView(...);
} 
```

它去：

```
BroadcastReceiver.onReceive() {
  Cursor = ContentProvider.query(...);
  if (cursor != null) {
     Intent intent = new Intent(...);
     // how do I pass the cursor?
     getContext().startActivity(intent);
  }
}

Activity.onCreate() {
  // how do I retrieve the cursor?
  setContentView(...);
} 
```

即，如果`query()`没有返回任何数据，我不想错过启动 `Activity`，并允许广播消息正常通过。

如果`query()`确实返回数据，我希望`Cursor`将其提供给`Activity`，这样我就不必再去查询数据了。

反过来，它`Activity`有自己的用户界面，用户需要对其做出响应。

这可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T18:14:49.167

你想要的有点困难，对我来说，效率很低。我建议您使用第一种替代方法，但是当您在活动中加载光标时，请检查是否没有数据，然后退出活动。

```
BroadcastReceiver.onReceive() {
  Intent intent = new Intent(...);
  intent.setData(...); // set a single String data
  context.startActivity(intent);
}

Activity.onCreate() {
  String value = intent.getData();  // get the String data
  Cursor = ContentProvider.query(search);

  if(cursor.isEmpty() ...){
    finish();
    return;
  }
  ...
  setContentView(...);
} 
```

这将具有完全相同的效果，光标只会加载一次，并且只有在光标中存在某些内容时才会显示活动。唯一的额外开销是无论如何都会触发意图，但这并不完全是征税:)

请注意，不会有任何闪烁或任何东西，Android 会处理在 onCreate() 中调用完成的情况（我相信 onStart 和 onResume 也是如此），因此用户永远不会知道它发生了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:13:29.457

您需要找到或制作一个可序列化或可打包的游标（然后使用 intent.setExtra()）。或者也许可以改为将所有数据作为一个包裹读取并将其传递给活动？

# linq - LINQ 和 Lambda 表达式是否会降低圈复杂度？

> ID：662346
> 
> 赞同：8
> 
> 时间：2009-03-19T14:08:33.293
> 
> 标签：linq, lambda, cyclomatic-complexity

LINQ 和 Lambda 表达式是否会降低圈复杂度？只是好奇，因为当 VS 分析器增加 cc 时，CodeRush 实际上显示 cc 减少。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-19T14:15:38.317

我怀疑这种差异可能是由于延迟执行造成的。当您将 LINQ 与 lambda 表达式一起使用时，您指定的是*在*您随后迭代集合时将运行的代码。

就我个人而言，我并不担心圈复杂度，但我绝对确定（如果使用得当）LINQ 会提高可读性。这才是我*真正*关心的:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-09T23:32:23.817

我刚遇到同样的问题，事实上，lambda 可以增加圈复杂度。**我做了测试， Where() 子句可以明智地增加它。**

**可读性确实是您的首要任务之一。**

但是我很快就用 Get() 方法替换了一些 LinQ 查询，这些方法为我提供了相同的数据和额外的好处。

* * *

我在我的构建/发布脚本中保持我的 Fxcop 开启，所以我从来没有在没有达到 25 的圈复杂度目标的情况下部署任何东西。

这很艰难，但我认为这是值得的。

当我的伙伴提出一个非常糟糕的代码时，这让我在讨论中获得了一些观点： *这行得通，这才是最重要的。*

* * *

我的建议是：**保持你的圈复杂度低于 25。** 这可以帮助你保持每个方法都足够简单，以便进行良好的维护。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-11T21:49:41.090

Jon Skeet 几乎简洁地回答了这个问题。我想补充一点，根据我使用 C# 等高级语言的经验，测量圈复杂度的价值降低了，因为 LINQ 等语法糖包增加了开发的价值。

在过去的十年中，随着语言的发展，网络上的许多人已经说明了圈复杂度和代码行数之间的强相关性，这让他们中的许多人质疑这种衡量标准究竟带来了多少价值。另一种看待它的方式是，将 CC 作为衡量代码质量的标准贬值实际上是对可读性重要性的断言，因为其中一个通常与另一个相反。

例如，如果我在 foreach 循环中放置一个条件，则该条件被评估为我的代码，并计算适当数量的代码路径。另一方面，如果我将函数树应用于我正在迭代的集合（例如 Where(evalStr => evalStr == origStr) 我将条件移动到循环外部并进入编译器生成的代码。有仍然是相同数量的分支，但是条件不是循环的一部分，但是 CC 增加了超过 foreach 循环的，在实际分支计数之上使用匿名方法（lambdas 和委托）的“惩罚”。 Where 函数让我对迭代集合进行预处理，以便循环仅在需要时进行迭代。

但是，代码的可读性要高得多。

最后，如果一个人决定在 LINQ IQueryable 函数中使用的布尔表达式不需要进行单元测试，表面上是因为如果有异常，它是一个高阶（也称为业务级别）异常（正在测试错误的值，错误的运算符、错误的操作数等），而不是使用不太理想的语言（使用 switch 代替 if，if 代替三进制等），那么测量圈复杂度应该考虑到这一点：A Where( ) 功能不应该增加我的CC。测量圈复杂度无助于编写更好的代码；如果有的话，它将人为地增加开发人员简化的倾向，而无需或不需要简化。

# iphone - 在 NavigationController 的视图堆栈中打开一个应用程序

> ID：662358
> 
> 赞同：2
> 
> 时间：2009-03-19T14:10:18.530
> 
> 标签：iphone, cocoa-touch

我正在阅读“Beginning iPhone Development”一书并了解基本的视图推送概念。然而，Apple 的 iPhone UI 设计指南指出我应该在之前的应用程序退出视图中重新打开我的应用程序。如何启动 NavigationController 以使其默认为子视图，但又有一个返回到应用程序根视图的视图堆栈？

与 iPhone 电子邮件应用程序类比，80% 的时间我的用户会从收件箱子视图开始，但有时需要向上导航到“概览”根视图。

一个解法？

我认为 pushViewController() 的动画属性只是控制视图打开的视觉效果，但文档状态“如果您在显示视图之前设置导航控制器，则传递 NO”。我希望这意味着我可以将隐藏视图推送到控制器的堆栈中，直到默认的应用程序打开视图，然后为最终视图显示设置动画？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T14:13:56.883

您可能必须将堆栈存储在某个地方并在启动时转到正确的视图。

话虽如此，您不必这样*做*。它只对某些应用程序有意义。

另请参阅：[在重新启动时保留应用程序状态](https://stackoverflow.com/questions/329511/preserving-application-state-across-restarts)

# cocoa - 无法访问可可中 NSArray 的属性

> ID：662365
> 
> 赞同：0
> 
> 时间：2009-03-19T14:12:26.233
> 
> 标签：cocoa, arrays, import

我正在尝试传递一个包含字符串的 NSArray，以便在另一个类中使用，而不是在其中生成它的类。因此，我将其设为以下属性：

登录控制器.h

```
#import <Cocoa/Cocoa.h>  

@interface loginController : NSObject {  
NSArray *myArray;  
}  

@property (nonatomic, retain) NSArray * myArray;  

@end 
```

登录控制器.m

```
#import "loginController.h"  

@implementation loginController

@synthesize myArray;  

@end 
```

问题是我想要访问 myArray 的类的接口和实现文件应该是什么样子。此时接口文件如下所示：

```
#import <Cocoa/Cocoa.h>  
#import "loginController.h"  

@interface viewController : NSObject {  
NSArray* myArray;  
}  

@property (nonatomic,retain) NSArray* myArray;  

@end 
```

我不确定这是否正确以及如果我想在其中使用 myArray 应该如何实现。有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:06:45.200

我认为您可能对属性的工作方式或它们的用途存在根本性的误解。它们只是生成的 getter 和 setter。它们不会使对象在程序中的任何类中自动可见。

有关更多信息，请参阅[Apple 的文档](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_5_section_1.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T12:51:38.757

如果您`LoginController`引用了您的`ViewController`对象，则可以在您的`LoginController`类中执行以下操作：

```
#import "loginController.h"  

@implementation loginController

@synthesize myArray;
@synthesize myViewController; // this property needs to be
                              // declared in loginController.h

// This method represents some hypothetical method that
// would be invoked at some point after both 'myViewController'
// and 'myArray' have been instantiated and initialized
// (for example it could be 'awakeFromNib').
-(void)someMethod
{
    myViewController.myArray = myArray;
}

@end 
```

但是，我想提醒您，让您`LoginController`和您`ViewController`彼此了解可能不是一个好的架构决策。我只发布此代码作为如何在两个对象之间实际传递数组的示例；在大多数设计中，我认为`LoginController`和`ViewController`都从属于某些包含对象（例如应用程序级控制器），这将是`myArray`两个控制器实例上的对象设置。

# jquery - 移除未选中的类选择选项

> ID：662373
> 
> 赞同：4
> 
> 时间：2009-03-19T14:13:39.287
> 
> 标签：jquery, css-selectors

当我从选择框中选择某些内容时，它会向

以这种方式选择选项：

```
$(
    'div#tabs input[type="text"],
    select option:selected,
    input:checked,
    textarea'
).addClass('takethis'); 
```

但是当我选择一个不同的选项时，它不会 `takethis`从我首先选择的选项中删除该类。我怎么能强迫这个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T14:35:54.287

从所有未选择的选项中删除类：

```
$("select option:not(:selected)").removeClass("takethis"); 
```

然后添加到选定的一个：

```
$("select option:selected").addClass("takethis"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T14:16:37.547

您可以像这样使用[removeClass](http://docs.jquery.com/Removeclass)：

```
$('#tabs').find('option').removeClass('takethis'); 
```

不过，我不确定您要做什么。这段代码：

```
$('div#tabs input[type="text"],
            select option:selected,
            input:checked,
            textarea').addClass('takethis'); 
```

正在抓取*所有*文本字段、所有选择的选定选项*、*所有*选中*的字段和*所有*文本区域并将类添加`takethis`到其中。那是你想做的吗？

**编辑**我明白你想要做什么。如果是这样，为什么不这样做呢？

```
var table = $('<table>');
$('div#tabs :input').each(function() {
    var val = $.trim($(this).val());
    var name = $(this).attr('name');
    if(val) {
        var td1 = $('<td>').html(name);
        var td2 = $('<td>').html(val);
        $('<input>').attr({
            type: 'hidden',
            name: name
        }).appendTo(td2);
        $('<tr>').append(td1).append(td2).appendTo(table);
    }
});
$('#4tab').append(table); 
```

这不是更简单还是我在这里错过了一个要求？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T14:16:05.117

您需要调用[`removeClass`](http://docs.jquery.com/Attributes/removeClass)先前选择的项目。

# java - 多维数组

> ID：662376
> 
> 赞同：2
> 
> 时间：2009-03-19T14:14:44.353
> 
> 标签：java, arrays

我在 Java 中工作，我想知道，是像网格这样的多维数组，其中行是元素，列是维度，还是我们看不到的超几何图形？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T14:16:44.553

一维数组就像一个列表，一个二维数组就像一个有列和行的表格，一个 3D 数组就像一个立方体，x、y 和 z 以及除此之外的任何东西都是超几何的。您可以用 4D 数组表示一个带时间的立方体。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:32:33.910

有时将多维数组视为几何数组很有用：列表、表格、立方体。其他时候，例如当数组长度不相等时，它不是。他们可能是：

*   表格列表
*   列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表列表
*   立方体表

在某个（早期）时候，是时候做一些`class`es 了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T14:17:55.487

取决于您创建数组的维度。显然，您可以创建一个二维数组，即表格。

# c++ - 从指向数组的函数返回指针时出错

> ID：662378
> 
> 赞同：1
> 
> 时间：2009-03-19T14:15:03.340
> 
> 标签：c++, arrays, pointers, function, return

我有点不知所措，因为我不知道为什么我的代码在编译时会出现以下错误：

```
1>..\SA.cpp(81) : error C2664: 'CFE' : cannot convert parameter 1 from 'int' to 'int []'
1>        Conversion from integral type to pointer type requires reinterpret_cast, C-style cast or function-style cast 
```

本质上，我正在尝试：

Step1：使用以下方法将向量转换为数组：

```
int* VecToArray(vector<int> Vec)
{
    int ary[Vec.size()];

    for(int i = 0; i < Vec.size(); i++)
        ary[i] = Vec[i];

    return ary;
} 
```

Step2：调用一个以数组为参数的函数，并从新生成的数组中返回一个指针：

```
int* CFE(int density[])
{
   ...do stuff to generate 'double Energy[]'....

    return Energy;
} 
```

第 3 步：在第三个函数中使用此指针来计算 Energy[] 的总和：

```
double ObjFunction (double *E_Array) 
{
    double SumEnergy = 0;

    int n = 10; // Is irrelivant

    for (int i = 0; i < n; i++)
    {
        SumEnergy += E_Array[i];
    }

    return SumEnergy;
} 
```

为了简化编码，我使用了这样的函数，其中 VectorName 是一个整数向量：

```
double TotalEnergy = ObjFunction ( CFE ( VecToArray ( VectorName ) ) ); 
```

我显然在某个地方弄错了参数类型，尽管我自己也不明白为什么。任何有经验的人都可以帮助发现它/它们吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T14:24:22.897

从哪里来`Energy`？如果它是 a`double[]`那么你不能把它转换成一个`int*`.

`std::vector<int>`保证是连续的，所以如果你想将 a 转换`std::vector<int> VectorName`为`const int*`use `&VectorName[0]`。另一方面，如果您的 CFE 函数修改了传递的数组，则最好在本地创建它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T14:21:11.127

不确定编译器错误，但是如果从函数返回本地数组，则会遇到大问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T14:22:45.303

第 1 步有几个问题：

*   您正在尝试创建一个可变大小的数组。你不能在 C89 或 C++ 中做到这一点（我认为 C99 添加了这个）。
*   您正在返回一个指向已超出范围的局部变量的指针。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T14:22:51.357

你应该解决这个问题：

```
int ary[Vec.size()]; 
```

到：

```
int *ary = new int(Vec.size()); 
```

编译器在编译时不知道 Vec.size()，因此它无法创建数组。

确保稍后释放内存。

那就是解决问题。但是，我认为你的方法也不好。Vector 与常规数组的性能几乎相同，但更安全，更易于使用。为什么不直接使用向量？

即使您决定使用数组，按值传递它们也不是很有效。特别是因为您立即将输出重定向到另一个函数。我宁愿使用参考来解决这类问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T14:26:58.507

您不能创建具有动态评估大小的数组。您不能返回本地定义的数组。

但是，您可以将 &myVector[0] 视为一个数组。

# c# - 从周数计算日期

> ID：662379
> 
> 赞同：147
> 
> 时间：2009-03-19T14:15:29.190
> 
> 标签：c#, .net, week-number

任何人都知道一种简单的方法来获取一周中第一天的日期（欧洲的星期一）。我知道年份和周数吗？我将在 C# 中执行此操作。

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2012-01-30T13:55:53.197

我对@HenkHolterman 的解决方案有疑问，即使是@RobinAndersson 的修复。

阅读 ISO 8601 标准很好地解决了这个问题。使用第一个星期四作为目标，而不是星期一。下面的代码也适用于 2009 年的第 53 周。

```
public static DateTime FirstDateOfWeekISO8601(int year, int weekOfYear)
{
    DateTime jan1 = new DateTime(year, 1, 1);
    int daysOffset = DayOfWeek.Thursday - jan1.DayOfWeek;

    // Use first Thursday in January to get first week of the year as
    // it will never be in Week 52/53
    DateTime firstThursday = jan1.AddDays(daysOffset);
    var cal = CultureInfo.CurrentCulture.Calendar;
    int firstWeek = cal.GetWeekOfYear(firstThursday, CalendarWeekRule.FirstFourDayWeek, DayOfWeek.Monday);

    var weekNum = weekOfYear;
    // As we're adding days to a date in Week 1,
    // we need to subtract 1 in order to get the right date for week #1
    if (firstWeek == 1)
    {
        weekNum -= 1;
    }

    // Using the first Thursday as starting week ensures that we are starting in the right year
    // then we add number of weeks multiplied with days
    var result = firstThursday.AddDays(weekNum * 7);

    // Subtract 3 days from Thursday to get Monday, which is the first weekday in ISO8601
    return result.AddDays(-3);
} 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-03-19T15:06:38.130

### 笔记

下面的答案使用 .NET 日历规则。它不承诺符合 ISO8601。当您需要时，请在此处查看其他一些答案。周编号是一团糟，总是试着找出你需要首先遵循的规则。

* * *

下面的代码正确地将 2009 年第 1 周的开始时间设置为 29-12-2008。CalendarWeekRule 可能应该是一个参数。

请注意，weekNum 应该 >= 1

```
static DateTime FirstDateOfWeek(int year, int weekNum, CalendarWeekRule rule)
{
    Debug.Assert(weekNum >= 1);

    DateTime jan1 = new DateTime(year, 1, 1);

    int daysOffset = DayOfWeek.Monday - jan1.DayOfWeek;
    DateTime firstMonday = jan1.AddDays(daysOffset);
    Debug.Assert(firstMonday.DayOfWeek == DayOfWeek.Monday);

    var cal = CultureInfo.CurrentCulture.Calendar;
    int firstWeek = cal.GetWeekOfYear(firstMonday, rule, DayOfWeek.Monday);

    if (firstWeek <= 1)
    {
        weekNum -= 1;
    }

    DateTime result = firstMonday.AddDays(weekNum * 7);

    return result;
} 
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2009-05-27T10:07:44.163

我喜欢 Henk Holterman 提供的解决方案。但是要更加独立于文化，您必须获得当前文化的一周的第一天（并不总是星期一）：

```
using System.Globalization;

static DateTime FirstDateOfWeek(int year, int weekOfYear)
{
  DateTime jan1 = new DateTime(year, 1, 1);

  int daysOffset = (int)CultureInfo.CurrentCulture.DateTimeFormat.FirstDayOfWeek - (int)jan1.DayOfWeek;

  DateTime firstMonday = jan1.AddDays(daysOffset);

  int firstWeek = CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(jan1, CultureInfo.CurrentCulture.DateTimeFormat.CalendarWeekRule, CultureInfo.CurrentCulture.DateTimeFormat.FirstDayOfWeek);

  if (firstWeek <= 1)
  {
    weekOfYear -= 1;
  }

  return firstMonday.AddDays(weekOfYear * 7);
} 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2018-06-19T10:29:40.437

**更新**： .NET Core 3.0 和 .NET Standard 2.1 已随附此类型。

好消息！添加到 .NET Core的[拉取请求](https://github.com/dotnet/coreclr/pull/18456)`System.Globalization.ISOWeek`刚刚合并，目前计划在 3.0 版本中发布。希望它会在不久的将来传播到其他 .NET 平台。

您应该能够使用该`ISOWeek.ToDateTime(int year, int week, DayOfWeek dayOfWeek)`方法来计算它。

[您可以在此处](https://github.com/dotnet/runtime/blob/b41f1c5f2fde25d752d857a54c3af24145060cdd/src/libraries/System.Private.CoreLib/src/System/Globalization/ISOWeek.cs#L102-L139)找到源代码。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-19T14:18:53.720

最简单的方法可能是找到一年中的第一个星期一，然后添加相关的周数。这是一些示例代码。顺便说一下，它假设从 1 开始的周数：

```
using System;

class Test
{
    static void Main()
    {
        // Show the third Tuesday in 2009\. Should be January 20th
        Console.WriteLine(YearWeekDayToDateTime(2009, DayOfWeek.Tuesday, 3));
    }

    static DateTime YearWeekDayToDateTime(int year, DayOfWeek day, int week)
    {
        DateTime startOfYear = new DateTime (year, 1, 1);

        // The +7 and %7 stuff is to avoid negative numbers etc.
        int daysToFirstCorrectDay = (((int)day - (int)startOfYear.DayOfWeek) + 7) % 7;

        return startOfYear.AddDays(7 * (week-1) + daysToFirstCorrectDay);
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-19T15:32:11.337

就我个人而言，我会利用文化信息来获取一周中的某一天并循环到该文化的一周的第一天。我不确定我是否解释得当，这里有一个例子：

```
 public DateTime GetFirstDayOfWeek(int year, int weekNumber)
    {
        return GetFirstDayOfWeek(year, weekNumber, Application.CurrentCulture);
    }

    public DateTime GetFirstDayOfWeek(int year, int weekNumber,
        System.Globalization.CultureInfo culture)
    {
        System.Globalization.Calendar calendar = culture.Calendar;
        DateTime firstOfYear = new DateTime(year, 1, 1, calendar);
        DateTime targetDay = calendar.AddWeeks(firstOfYear, weekNumber);
        DayOfWeek firstDayOfWeek = culture.DateTimeFormat.FirstDayOfWeek;

        while (targetDay.DayOfWeek != firstDayOfWeek)
        {
            targetDay = targetDay.AddDays(-1);
        }

        return targetDay;
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-09-04T12:50:15.900

使用流畅的日期[时间 http://fluentdatetime.codeplex.com/](http://fluentdatetime.codeplex.com/)

```
 var year = 2009;
        var firstDayOfYear = new DateTime(year, 1, 1);
        var firstMonday = firstDayOfYear.Next(DayOfWeek.Monday);
        var weeksDateTime = 12.Weeks().Since(firstMonday); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-02-26T19:35:24.757

这是一种与 Google Analytics 的周数兼容的方法，也是我们在英特尔内部使用的相同编号方案，我敢肯定它也用于许多其他情况。

```
// Google Analytics does not follow ISO standards for date.
// It numbers week 1 starting on Jan. 1, regardless what day of week it starts on.
// It treats Sunday as the first day of the week.
// The first and last weeks of a year are usually not complete weeks.
public static DateTime GetStartDateTimeFromWeekNumberInYear(int year, uint weekOfYear)
{
  if (weekOfYear == 0 || weekOfYear > 54) throw new ArgumentException("Week number must be between 1 and 54! (Yes, 54... Year 2000 had Jan. 1 on a Saturday plus 53 Sundays.)");

  // January 1 -- first week.
  DateTime firstDayInWeek = new DateTime(year, 1, 1);
  if (weekOfYear == 1) return firstDayInWeek;

  // Get second week, starting on the following Sunday.      
  do
  {
    firstDayInWeek = firstDayInWeek.AddDays(1);
  } while (firstDayInWeek.DayOfWeek != DayOfWeek.Sunday);

  if (weekOfYear == 2) return firstDayInWeek;

  // Now get the Sunday of whichever week we're looking for.
  return firstDayInWeek.AddDays((weekOfYear - 2)*7);
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-02-06T13:25:28.840

稍微更改了 Mikael Svenson 代码。我找到了第一个星期一的星期并适当地更改了星期数。

```
 DateTime GetFirstWeekDay(int year, int weekNum)
    {
        Calendar calendar = CultureInfo.CurrentCulture.Calendar;

        DateTime jan1 = new DateTime(year, 1, 1);

        int daysOffset = DayOfWeek.Monday - jan1.DayOfWeek;
        DateTime firstMonday = jan1.AddDays(daysOffset);
        int firstMondayWeekNum = calendar.GetWeekOfYear(firstMonday, CalendarWeekRule.FirstFourDayWeek, DayOfWeek.Monday);

        DateTime firstWeekDay = firstMonday.AddDays((weekNum-firstMondayWeekNum) * 7);

        return firstWeekDay;
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-19T16:10:46.907

根据**在瑞典使用的 ISO 8601:1988，**一年中的第一周是新年中至少有四天的第一周。

因此，如果您的一周从星期一开始，那么任何一年的第一个星期四都在第一周内。您可以从中获取 DateAdd 或 DateDiff 。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-07-09T03:43:27.133

假设周数从 1 开始

```
DateTime dt =  new DateTime(YearNumber, 1, 1).AddDays((WeekNumber - 1) * 7 - (WeekNumber == 1 ? 0 : 1));
return dt.AddDays(-(int)dt.DayOfWeek); 
```

这应该给你任何给定一周的第一天。我没有对其进行大量测试，但看起来它有效。它比我在网上找到的大多数其他解决方案都要小，所以想分享。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-05-13T17:07:13.113

.NET的免费[时间周期库](http://www.codeproject.com/KB/datetime/TimePeriod.aspx)包括符合[ISO 8601](http://www.iso.org/iso/support/faqs/faqs_widely_used_standards/widely_used_standards_other/date_and_time_format.htm)的类*Week*：

```
// ----------------------------------------------------------------------
public static DateTime GetFirstDayOfWeek( int year, int weekOfYear )
{
  return new Week( year, weekOfYear ).FirstDayStart;
} // GetFirstDayOfWeek 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-08-26T10:13:35.390

我尝试了上面的一些代码，有些有小错误，当你尝试不同年份的不同开始日期时，你会看到它们，我采用了 Jon Skeet 的代码，修复它并且它可以工作，非常简单的代码。

```
Public Function YearWeekDayToDateTime(ByVal year As Integer, ByVal weekDay As Integer, ByVal week As Integer) As DateTime
   ' weekDay, day you want
    Dim startOfYear As New DateTime(year, 1, 1)
    Dim startOfYearFixDay As Integer

    If startOfYear.DayOfWeek <> DayOfWeek.Sunday Then
        startOfYearFixDay = startOfYear.DayOfWeek
    Else
        startOfYearFixDay = 7
    End If

    Return startOfYear.AddDays((7 * (week)) - startOfYearFixDay + weekDay)
End Function 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-03-29T17:58:28.140

这对我有用，它还具有期望文化信息作为参数来测试具有不同文化的公式的优势。如果为空，则获取当前的文化信息...有效值如：“it”、“en-us”、“fr”、...等等。诀窍是减去一年中第一天的周数，这可能是 1 表示第一天在第一周内。希望这可以帮助。

```
Public Shared Function FirstDayOfWeek(ByVal year As Integer, ByVal weekNumber As Integer, ByVal culture As String) As Date
    Dim cInfo As System.Globalization.CultureInfo
    If culture = "" Then
        cInfo = System.Globalization.CultureInfo.CurrentCulture
    Else
        cInfo = System.Globalization.CultureInfo.CreateSpecificCulture(culture)
    End If
    Dim calendar As System.Globalization.Calendar = cInfo.Calendar
    Dim firstOfYear As DateTime = New DateTime(year, 1, 1, calendar)
    Dim firstDayWeek As Integer = calendar.GetWeekOfYear(firstOfYear, cInfo.DateTimeFormat.CalendarWeekRule, cInfo.DateTimeFormat.FirstDayOfWeek)
    weekNumber -= firstDayWeek
    Dim targetDay As DateTime = calendar.AddWeeks(firstOfYear, weekNumber)
    Dim fDayOfWeek As DayOfWeek = cInfo.DateTimeFormat.FirstDayOfWeek

    While (targetDay.DayOfWeek <> fDayOfWeek)
        targetDay = targetDay.AddDays(-1)
    End While
    Return targetDay
End Function 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-07-10T10:39:01.040

我简化了 Mikael Svensson 提供的代码，这对于欧洲的许多国家都是正确的。

```
public static DateTime FirstDateOfWeekIso8601(int year, int week)
{
        var firstThursdayOfYear = new DateTime(year, 1, 1);
        while (firstThursdayOfYear.DayOfWeek != DayOfWeek.Thursday)
        {
            firstThursdayOfYear = firstThursdayOfYear.AddDays(1);
        }

        var startDateOfWeekOne = firstThursdayOfYear.AddDays(-(DayOfWeek.Thursday - DayOfWeek.Monday));

        return startDateOfWeekOne.AddDays(7 * (week - 1));        
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-19T15:03:18.480

第 1 周定义为从星期一开始并包含一年中的第一个星期四的那一周。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-09-05T05:35:05.380

要双向转换，请参见此处：[关于 ISO 周日期的维基百科文章](http://en.wikipedia.org/wiki/ISO_week_date#Calculation)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-03-30T05:29:18.310

我通过覆盖对 Thomas 的解决方案进行了一些改进：

```
 public static DateTime FirstDateOfWeek(int year, int weekOfYear)
    {
      return Timer.FirstDateOfWeekOfMonth(year, 1, weekOfYear);
    }

    public static DateTime FirstDateOfWeekOfMonth(int year, int month, 
    int weekOfYear)
    {
      DateTime dtFirstDayOfMonth = new DateTime(year, month, 1);

       //I also commented out this part:
      /*
      if (firstWeek <= 1)
      {
        weekOfYear -= 1;
      }
      */ 
```

否则日期提前一周..

谢谢托马斯，帮助很大。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-08-09T16:10:55.210

我使用了其中一个解决方案，但它给了我错误的结果，仅仅是因为它将星期日视为一周的第一天。

我变了：

```
var firstDay = new DateTime(DateTime.Now.Year, 1, 1).AddDays((weekNumber - 1) * 7);
var lastDay = firstDay.AddDays(6); 
```

到：

```
var lastDay = new DateTime(DateTime.Now.Year, 1, 1).AddDays((weekNumber) * 7);
var firstDay = lastDay.AddDays(-6); 
```

现在它作为一种魅力发挥作用。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-09-21T17:57:28.283

建议的解决方案并不完整 - 它仅适用于 CalendarWeekRule.FirstFullWeek。其他类型的周规则不起作用。使用此测试用例可以看出这一点：

```
foreach (CalendarWeekRule rule in Enum.GetValues(typeof(CalendarWeekRule)))
{
    for (int year = 1900; year < 2000; year++)
    {
        DateTime date = FirstDateOfWeek(year, 1, rule);
        Assert(CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(date, rule, DayOfWeek.Monday) == 1);
        Assert(CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(date.AddDays(-1), rule, DayOfWeek.Monday) != 1);
    }
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-09-21T18:08:09.110

我已经提出了一个更简单的建议解决方案的改进版本，并且对 firstDayOfWeek 进行了参数化：

```
public static DateTime GetFirstDayOfWeek(int year, int week, DayOfWeek firstDayOfWeek)
{
    return GetWeek1Day1(year, firstDayOfWeek).AddDays(7 * (week - 1));
}

public static DateTime GetWeek1Day1(int year, DayOfWeek firstDayOfWeek)
{
    DateTime date = new DateTime(year, 1, 1);

    // Move towards firstDayOfWeek
    date = date.AddDays(firstDayOfWeek - date.DayOfWeek);

    // Either 1 or 52 or 53
    int weekOfYear = CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(date, CalendarWeekRule.FirstFullWeek, firstDayOfWeek);

    // Move forwards 1 week if week is 52 or 53
    date = date.AddDays(7 * System.Math.Sign(weekOfYear - 1));

    return date;
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-11-27T15:02:13.413

当我们想要计算给定年份、星期数和星期几的日期时，这是我的解决方案。

```
int Year = 2014;
int Week = 48;
int DayOfWeek = 4;

DateTime FecIni = new DateTime(Year, 1, 1);
FecIni = FecIni.AddDays(7 * (Week - 1));
if ((int)FecIni.DayOfWeek > DayOfWeek)
{
    while ((int)FecIni.DayOfWeek != DayOfWeek) FecIni = FecIni.AddDays(-1);
}
else
{
    while ((int)FecIni.DayOfWeek != DayOfWeek) FecIni = FecIni.AddDays(1);
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-11-04T04:35:44.017

我已经编写并测试了以下代码，并且对我来说工作得很好。如果有人遇到此问题，请告诉我，我也发布了一个问题，以获得最佳答案。有人可能会发现它很有用。

```
public static DateTime GetFirstDateOfWeekByWeekNumber(int year, int weekNumber)
        {
            var date = new DateTime(year, 01, 01);
            var firstDayOfYear = date.DayOfWeek;
            var result = date.AddDays(weekNumber * 7);

            if (firstDayOfYear == DayOfWeek.Monday)
                return result.Date;
            if (firstDayOfYear == DayOfWeek.Tuesday)
                return result.AddDays(-1).Date;
            if (firstDayOfYear == DayOfWeek.Wednesday)
                return result.AddDays(-2).Date;
            if (firstDayOfYear == DayOfWeek.Thursday)
                return result.AddDays(-3).Date;
            if (firstDayOfYear == DayOfWeek.Friday)
                return result.AddDays(-4).Date;
            if (firstDayOfYear == DayOfWeek.Saturday)
                return result.AddDays(-5).Date;
            return result.AddDays(-6).Date;
        } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-11-08T15:48:01.337

目前，没有正确处理 ISO 8601week 数字的 C# 类。即使您可以实例化一种文化，寻找最接近的东西并纠正它，我认为最好自己进行完整的计算：

```
 /// <summary>
    /// Converts a date to a week number.
    /// ISO 8601 week 1 is the week that contains the first Thursday that year.
    /// </summary>
    public static int ToIso8601Weeknumber(this DateTime date)
    {
        var thursday = date.AddDays(3 - date.DayOfWeek.DayOffset());
        return (thursday.DayOfYear - 1) / 7 + 1;
    }

    /// <summary>
    /// Converts a week number to a date.
    /// Note: Week 1 of a year may start in the previous year.
    /// ISO 8601 week 1 is the week that contains the first Thursday that year, so
    /// if December 28 is a Monday, December 31 is a Thursday,
    /// and week 1 starts January 4.
    /// If December 28 is a later day in the week, week 1 starts earlier.
    /// If December 28 is a Sunday, it is in the same week as Thursday January 1.
    /// </summary>
    public static DateTime FromIso8601Weeknumber(int weekNumber, int? year = null, DayOfWeek day = DayOfWeek.Monday)
    {
        var dec28 = new DateTime((year ?? DateTime.Today.Year) - 1, 12, 28);
        var monday = dec28.AddDays(7 * weekNumber - dec28.DayOfWeek.DayOffset());
        return monday.AddDays(day.DayOffset());
    }

    /// <summary>
    /// Iso8601 weeks start on Monday. This returns 0 for Monday.
    /// </summary>
    private static int DayOffset(this DayOfWeek weekDay)
    {
        return ((int)weekDay + 6) % 7;
    } 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-01-29T04:06:26.667

我发现的最大问题之一是从周转换为日期，然后从日期转换为周。

主要问题是当试图从属于上一年的一周的日期获取正确的周年时。幸运`System.Globalization.ISOWeek.GetYear`地处理了这个。

这是我的解决方案：

```
public class WeekOfYear
{
    public static (int Year, int Week) DateToWeekOfYear(DateTime date) =>
        (ISOWeek.GetYear(date), ISOWeek.GetWeekOfYear(date));

    public static bool ValidYearAndWeek(int year, int week) =>
           year >= 1 && year <= 9999 && week >= 1 && week <= 53 // bounds of year/week
        && !(year <= 1 && week <= 1) && !(year >= 9999 && week >= 53); // bounds of DateTime

    public int Year { get; }
    public int Week { get; }
    public virtual DateTime StartOfWeek { get; protected set; }
    public virtual DateTime EndOfWeek { get; protected set; }

    public virtual IEnumerable<DateTime> DaysInWeek =>
        Enumerable.Range(1, 10).Select(i => StartOfWeek.AddDays(i));

    public WeekOfYear(int year, int week)
    {
        if (!ValidYearAndWeek(year, week))
            throw new ArgumentException($"DateTime can't represent {week} of year {year}.");

        Year = year;
        Week = week;
        StartOfWeek = ISOWeek.ToDateTime(year, week, DayOfWeek.Monday);
        EndOfWeek = ISOWeek.ToDateTime(year, week, DayOfWeek.Sunday).AddDays(1).AddTicks(-1);
    }

    public WeekOfYear((int Year, int Week) week) : this(week.Year, week.Week) { }
    public WeekOfYear(DateTime date) : this(DateToWeekOfYear(date)) { }
} 
```

第二大问题是美国偏好从周日开始的几周。

我`WeekOfYear`从上面提出了子类的解决方案，并管理构造函数中的偏移量（将周转换为日期）和`DateToWeekOfYear`（从日期转换为周）。

```
public class UsWeekOfYear : WeekOfYear
{
    public static new (int Year, int Week) DateToWeekOfYear(DateTime date)
    {
        // if date is a sunday, return the next week
        if (date.DayOfWeek == DayOfWeek.Sunday) date = date.AddDays(1);
        return WeekOfYear.DateToWeekOfYear(date);
    }

    public UsWeekOfYear(int year, int week) : base(year, week)
    {
        StartOfWeek = ISOWeek.ToDateTime(year, week, DayOfWeek.Monday).AddDays(-1);
        EndOfWeek = ISOWeek.ToDateTime(year, week, DayOfWeek.Sunday).AddTicks(-1);
    }

    public UsWeekOfYear((int Year, int Week) week) : this(week.Year, week.Week) { }
    public UsWeekOfYear(DateTime date) : this(DateToWeekOfYear(date)) { }
} 
```

这是一些测试代码：

```
public static void Main(string[] args)
{
    Console.WriteLine("== Last Week / First Week");
    Log(new WeekOfYear(2020, 53));
    Log(new UsWeekOfYear(2020, 53));

    Log(new WeekOfYear(2021, 1));
    Log(new UsWeekOfYear(2021, 1));

    Console.WriteLine("\n== Year Crossover (iso)");
    var start = new DateTime(2020, 12, 26);
    var i = 0;
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2020-12-26 - Sat
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2020-12-27 - Sun
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2020-12-28 - Mon
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2020-12-29 - Tue
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2020-12-30 - Wed
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2020-12-30 - Thu
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2021-01-01 - Fri
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2021-01-02 - Sat
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2021-01-03 - Sun
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2021-01-04 - Mon
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2021-01-05 - Tue
    Log(start.AddDays(i), new WeekOfYear(start.AddDays(i++))); // 2021-01-06 - Wed

    Console.WriteLine("\n== Year Crossover (us)");
    i = 0;
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2020-12-26 - Sat
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2020-12-27 - Sun
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2020-12-28 - Mon
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2020-12-29 - Tue
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2020-12-30 - Wed
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2020-12-30 - Thu
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2021-01-01 - Fri
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2021-01-02 - Sat
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2021-01-03 - Sun
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2021-01-04 - Mon
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2021-01-05 - Tue
    Log(start.AddDays(i), new UsWeekOfYear(start.AddDays(i++))); // 2021-01-06 - Wed

    var x = new UsWeekOfYear(2020, 53) as WeekOfYear;
}

public static void Log(WeekOfYear week)
{
    Console.WriteLine($"{week} - {week.StartOfWeek:yyyy-MM-dd} ({week.StartOfWeek:ddd}) - {week.EndOfWeek:yyyy-MM-dd} ({week.EndOfWeek:ddd})");
}

public static void Log(DateTime date, WeekOfYear week)
{
    Console.WriteLine($"{date:yyyy-MM-dd (ddd)} - {week} - {week.StartOfWeek:yyyy-MM-dd (ddd)} - {week.EndOfWeek:yyyy-MM-dd (ddd)}");
} 
```

# sql - 在 SQL Server 中修剪前导零的更好技术？

> ID：662383
> 
> 赞同：183
> 
> 时间：2009-03-19T14:16:22.837
> 
> 标签：sql, sql-server, sql-server-2005, tsql, string

我已经使用[了](https://stackoverflow.com/questions/92093/removing-leading-zeroes-from-a-field-in-a-sql-statement)一段时间：

```
SUBSTRING(str_col, PATINDEX('%[^0]%', str_col), LEN(str_col)) 
```

但是最近，我发现所有“0”字符（如“00000000”）的列存在问题，因为它从未找到要匹配的非“0”字符。

我见过的另一种技术是使用`TRIM`：

```
REPLACE(LTRIM(REPLACE(str_col, '0', ' ')), ' ', '0') 
```

如果有嵌入的空格，这是有问题的，因为当空格变回“0”时，它们将变成“0”。

我试图避免使用标量 UDF。我发现 SQL Server 2005 中的 UDF 存在很多性能问题。

* * *

## 回答 #1

> 赞同：339
> 
> 时间：2009-03-19T14:32:57.650

```
SUBSTRING(str_col, PATINDEX('%[^0]%', str_col+'.'), LEN(str_col)) 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-03-19T14:21:05.260

为什么不直接将值转换为`INTEGER`然后返回到`VARCHAR`？

```
SELECT  CAST(CAST('000000000' AS INTEGER) AS VARCHAR)

--------
       0 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2014-02-15T23:25:19.433

如果您有全零（甚至是单个零），则此处不考虑其他答案。
有些人总是将空字符串默认为零，当它应该保持空白时这是错误的。
重新阅读原始问题。这回答了提问者想要什么。

## 解决方案#1：

```
--This example uses both Leading and Trailing zero's.
--Avoid losing those Trailing zero's and converting embedded spaces into more zeros.
--I added a non-whitespace character ("_") to retain trailing zero's after calling Replace().
--Simply remove the RTrim() function call if you want to preserve trailing spaces.
--If you treat zero's and empty-strings as the same thing for your application,
--  then you may skip the Case-Statement entirely and just use CN.CleanNumber .
DECLARE @WackadooNumber VarChar(50) = ' 0 0123ABC D0 '--'000'--
SELECT WN.WackadooNumber, CN.CleanNumber,
       (CASE WHEN WN.WackadooNumber LIKE '%0%' AND CN.CleanNumber = '' THEN '0' ELSE CN.CleanNumber END)[AllowZero]
 FROM (SELECT @WackadooNumber[WackadooNumber]) AS WN
 OUTER APPLY (SELECT RTRIM(RIGHT(WN.WackadooNumber, LEN(LTRIM(REPLACE(WN.WackadooNumber + '_', '0', ' '))) - 1))[CleanNumber]) AS CN
--Result: "123ABC D0" 
```

## 解决方案#2（带有样本数据）：

```
SELECT O.Type, O.Value, Parsed.Value[WrongValue],
       (CASE WHEN CHARINDEX('0', T.Value)  > 0--If there's at least one zero.
              AND LEN(Parsed.Value) = 0--And the trimmed length is zero.
             THEN '0' ELSE Parsed.Value END)[FinalValue],
       (CASE WHEN CHARINDEX('0', T.Value)  > 0--If there's at least one zero.
              AND LEN(Parsed.TrimmedValue) = 0--And the trimmed length is zero.
             THEN '0' ELSE LTRIM(RTRIM(Parsed.TrimmedValue)) END)[FinalTrimmedValue]
  FROM 
  (
    VALUES ('Null', NULL), ('EmptyString', ''),
           ('Zero', '0'), ('Zero', '0000'), ('Zero', '000.000'),
           ('Spaces', '    0   A B C '), ('Number', '000123'),
           ('AlphaNum', '000ABC123'), ('NoZero', 'NoZerosHere')
  ) AS O(Type, Value)--O is for Original.
  CROSS APPLY
  ( --This Step is Optional.  Use if you also want to remove leading spaces.
    SELECT LTRIM(RTRIM(O.Value))[Value]
  ) AS T--T is for Trimmed.
  CROSS APPLY
  ( --From @CadeRoux's Post.
    SELECT SUBSTRING(O.Value, PATINDEX('%[^0]%', O.Value + '.'), LEN(O.Value))[Value],
           SUBSTRING(T.Value, PATINDEX('%[^0]%', T.Value + '.'), LEN(T.Value))[TrimmedValue]
  ) AS Parsed 
```

## 结果：

![MikeTeeVee_SQL_Server_Remove_Leading_Zeros](https://i.stack.imgur.com/uPdoH.png)

## 概括：

您可以使用我上面的内容一次性删除前导零。
如果您打算大量重用它，请将其放入 Inline-Table-Valued-Function (ITVF) 中。
您对 UDF 的性能问题的担忧是可以理解的。
然而，这个问题只适用于 All-Scalar-Functions 和 Multi-Statement-Table-Functions。
使用 ITVF 非常好。

我们的 3rd-Party 数据库也有同样的问题。
使用字母数字字段，许多人在没有前导空格的情况下输入，该死的人类！
如果不清理丢失的前导零，这使得连接是不可能的。

## 结论：

除了删除前导零，您可能需要考虑在进行连接时仅使用前导零填充修剪后的值。
更好的是，通过添加前导零来清理表中的数据，然后重建索引。
我认为这会更快，更简单。

```
SELECT RIGHT('0000000000' + LTRIM(RTRIM(NULLIF(' 0A10  ', ''))), 10)--0000000A10
SELECT RIGHT('0000000000' + LTRIM(RTRIM(NULLIF('', ''))), 10)--NULL --When Blank. 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-19T14:27:00.050

将 0 替换为通常不应出现在列文本中的“罕见”空白字符，而不是空格。对于这样的列，换行可能已经足够了。然后你可以正常 LTrim 并再次用 0 替换特殊字符。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-03-02T21:36:41.987

如果字符串完全由零组成，则以下将返回“0”：

```
CASE WHEN SUBSTRING(str_col, PATINDEX('%[^0]%', str_col+'.'), LEN(str_col)) = '' THEN '0' ELSE SUBSTRING(str_col, PATINDEX('%[^0]%', str_col+'.'), LEN(str_col)) END AS str_col 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-19T16:47:45.043

这是一个很好的功能......

```
DROP FUNCTION [dbo].[FN_StripLeading]
GO
CREATE FUNCTION [dbo].[FN_StripLeading] (@string VarChar(128), @stripChar VarChar(1))
RETURNS VarChar(128)
AS
BEGIN
-- http://stackoverflow.com/questions/662383/better-techniques-for-trimming-leading-zeros-in-sql-server
    DECLARE @retVal VarChar(128),
            @pattern varChar(10)
    SELECT @pattern = '%[^'+@stripChar+']%'
    SELECT @retVal = CASE WHEN SUBSTRING(@string, PATINDEX(@pattern, @string+'.'), LEN(@string)) = '' THEN @stripChar ELSE SUBSTRING(@string, PATINDEX(@pattern, @string+'.'), LEN(@string)) END
    RETURN (@retVal)
END
GO
GRANT EXECUTE ON [dbo].[FN_StripLeading] TO PUBLIC 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-04-12T09:36:47.000

如果字符串是数字，cast(value as int) 将始终有效

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-01-29T21:17:05.913

```
SELECT CAST(CAST('000000000' AS INTEGER) AS VARCHAR) 
```

这对可以转换为 INT 的字符串的长度有限制

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-08-04T14:40:42.563

我的这个版本是对 Arvo 作品的改编，增加了一点以确保其他两种情况。

1) 如果我们全是 0，我们应该返回数字 0。

2）如果我们有一个空白，我们仍然应该返回一个空白字符。

```
CASE 
    WHEN PATINDEX('%[^0]%', str_col + '.') > LEN(str_col) THEN RIGHT(str_col, 1) 
    ELSE SUBSTRING(str_col, PATINDEX('%[^0]%', str_col + '.'), LEN(str_col))
 END 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-02-02T08:54:55.353

这可能会有所帮助

```
SELECT ABS(column_name) FROM [db].[schema].[table] 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-12-08T21:59:44.460

```
replace(ltrim(replace(Fieldname.TableName, '0', '')), '', '0') 
```

Thomas G 的建议满足了我们的需求。

在我们的例子中，该字段已经是字符串，只需要修剪前导零。大多数情况下都是数字，但有时会有字母，所以之前的 INT 转换会崩溃。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-10-26T16:35:56.960

如果您使用的是 Snowflake SQL，可以使用这个：

```
ltrim(str_col,'0') 
```

ltrim 函数从左侧删除指定字符集的所有实例。

所以 ltrim(str_col,'0') on '00000008A' 会返回 '8A'

'$1​​25.00' 上的 rtrim(str_col,'0.') 将返回 '$125'

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-11-24T13:19:21.910

要将number 作为**varchar**转换为**int**，您还可以使用 simple

```
(column + 0) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-10-05T13:58:42.993

非常简单的方法，当您只使用数值时：

```
SELECT
    TRY_CONVERT(INT, '000053830') 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-07-12T07:48:43.190

试试这个：

```
replace(ltrim(replace(@str, '0', ' ')), ' ', '0') 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-08-16T20:17:49.050

如果您不想转换为 int，我更喜欢下面的逻辑，因为它可以处理空值 IFNULL(field,LTRIM(field,'0'))

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-11-25T22:33:57.903

```
 SUBSTRING(str_col, IIF(LEN(str_col) > 0, PATINDEX('%[^0]%', LEFT(str_col, LEN(str_col) - 1) + '.'), 0), LEN(str_col)) 
```

即使使用“0”、“00”等也能正常工作。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2020-06-15T18:49:57.963

在 MySQL 中，您可以这样做...

```
Trim(Leading '0' from your_column) 
```

# vb.net - 数据表不知道其主键

> ID：662394
> 
> 赞同：3
> 
> 时间：2009-03-19T14:19:21.113
> 
> 标签：vb.net, ado.net

我正在尝试通过查询每个列的自动增量属性来查询数据表以建立主键 [标识列]。但是它总是错误的（对于 Idenity/PK 列）。

查询表的主键集合显示数据表认为它没有 PK。

```
 Dim dc As DataColumn() = dt.PrimaryKey
  Debug.WriteLine(dc.Count)  'Result is 0 
```

正在填充数据表......

```
Using cn As SqlConnection = MyApp.GetConnection
  Using cmd As New SqlCommand(strSQL, cn)
    Using da As New SqlDataAdapter(cmd)
      Dim ds As New DataSet
      Try
        da.Fill(ds)

        Return ds

      Catch ex As Exception
        MyAppClass.LogWarning(ex, EventLogEntryType.Error)
        Throw
      End Try
    End Using 
  End Using 
End Using 
```

有问题的表的主键是：([myTableId] [int] IDENTITY(1,1) NOT NULL)。及其 pk ： CONSTRAINT [PK_myTablesPK] PRIMARY KEY CLUSTERED ( [myTableId] ASC )

这里有人遇到同样的问题（可能比我写的更清楚）：[http ://social.msdn.microsoft.com/Forums/en-US/adodotnetdataproviders/thread/c6abdeef-0cb0-42f5-a5f1-10dc4d81df4a/](http://social.msdn.microsoft.com/Forums/en-US/adodotnetdataproviders/thread/c6abdeef-0cb0-42f5-a5f1-10dc4d81df4a/)

我假设我缺少一些简单的东西，有人愿意启发我吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-23T10:03:10.377

使用 fillschema 解决了我的问题；

```
da.FillSchema(ds, SchemaType.Mapped, table.tableName)
da.Fill(ds, table.tableName) 
```

> 默认情况下，DataAdapter 对象针对只读方案进行了优化。Fill 方法仅检索填充 DataSet 对象所需的架构数量。要获取更新或验证 DataSet 对象所需的其他架构，请对由 DataAdapater 填充的 DataSet 对象使用以下方法之一：
> 
> *   使用 DataAdapter 的[FillSchema](http://msdn.microsoft.com/en-us/library/system.data.common.dbdataadapter.fillschema.aspx)方法。
> *   将 AddWithKey 枚举用于 DataAdapter 的 MissingSchemaAction 属性。
> 
> 本文介绍了当您想要使用 DataAdapter 填充可更新的 DataSet 对象时如何在这两种方法之间进行选择。

[参考：http://support.microsoft.com/kb/310128](http://support.microsoft.com/kb/310128)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T14:29:52.710

您是否需要从自动增量属性中确定主键？或者这可以帮助你吗？

```
Private Sub GetPrimaryKeys ( myTable As DataTable )
   ' create the array for the columns.
   Dim colKeys ( ) As DataColumn = myTable.PrimaryKey
   ' get the number of elements in the array.
   Response.Write ( "Column Count: " & colKeys.Length.ToString ( ) )
   Dim i As Integer
   For i = 0 To colKeys.GetUpperBound ( 0 )
      Response.Write ( colKeys ( i ).ColumnName & _
         colKeys ( i ).DataType.ToString ( ) )
   Next i
End Sub 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2011-02-21T17:56:20.733

有一个库，[Kailua - ADO.NET API 中被遗忘的方法。](http://kailua.codeplex.com/)，这确实为前 5 名供应商提供了此元数据和其他元数据。此信息是特定于供应商的。

# wcf - WCF，从现有架构实现 Web 服务

> ID：662405
> 
> 赞同：1
> 
> 时间：2009-03-19T14:22:53.367
> 
> 标签：wcf, web-services, xsd

我必须实现一个符合旅游业（大型）标准模式的 SOAP Web 服务。这是一个示例 .XSD 文件：

[http://www.opentravel.org/2008B/OTA_HotelAvailRQ.xsd](http://www.opentravel.org/2008B/OTA_HotelAvailRQ.xsd)

我认为这排除了简单地将 [WebMethod] 属性添加到方法的可能性。您如何推荐使用 C# 实现现有模式？

PS：我正在使用 WCF、C# 3 并且服务器安装了 .NET 3.5。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T14:29:13.213

您是否尝试过使用 Visual Studio 命令行中的 xsd.exe 加载架构？这会生成一个 clr 对象文件。

[http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.71).aspx](http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.71).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T13:27:46.797

您可以使用 XSD.EXE 创建类，并从 WCF 服务返回它们（您的意思是 [OperationContract]，而不是 [WebMethod]）。但是您必须配置为使用 XML 序列化器，而不是数据协定序列化器。

# opengl - 物体不会旋转？

> ID：662411
> 
> 赞同：3
> 
> 时间：2009-03-19T14:26:07.027
> 
> 标签：opengl, rotation

```
void RenderBrain(void)
{ 

glClear(GL_COLOR_BUFFER_BIT);
glMatrixMode(GL_MODELVIEW);

ifstream myFile("brainData.txt");

if (!myFile.is_open()) 
{
    cout << "Unable to open file";
    exit(1); // terminate with error
}

glRotatef(80.0f, 1.0f, 0.0f, 0.0f);

while (! myFile.eof()) 
{
    myFile>>a[0];
    myFile>>a[1];
    myFile>>a[2];
    myFile>>a[3];

    glColor3f(0.60f,0.80f,0.90f);

    glLoadIdentity();       
    glTranslatef((a[0]-1.15)*26, a[2]*30, a[1]*30);
    glutSolidSphere(6, 5, 5);   

}   

myFile.close();
glFlush();
glutSwapBuffers();
} 
```

以上是我的代码的一部分，在添加 glLoadIdentity(); 后我无法让它旋转；循环内。如果我移除它，我的所有球体都会飞向各个方向。

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T14:37:30.587

如果 OpenGL 对您来说是新手，我**强烈建议您**阅读[NeHe OpenGL 教程。](http://nehe.gamedev.net/)

`glLoadIdentity`正在否定 的影响`glRotate`。相反，使用[`glPushMatrix`/`glPopMatrix`](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/pushmatrix.html)来实现独立翻译：

```
glPushMatrix();               
glTranslatef((a[0]-1.15)*26, a[2]*30, a[1]*30);
glutSolidSphere(6, 5, 5);
glPopMatrix(); 
```

如果球体不再可见，那么您需要提供视口和投影矩阵设置代码，以便我们确定问题所在。另一方面，如果您根本没有设置视口和投影，请参阅上面的教程并修复它！

此外，每次渲染场景时，您都会将模型视图矩阵旋转 80 度。这是预期的结果吗？这个函数的调用频率是多少？我会考虑在变量中保持所需的旋转，然后加载单位矩阵并在每次通过时旋转该角度。例如：

```
glMatrixMode(GL_MODELVIEW);
glLoadIdentity();
angle += angularVelocity * deltaTime;
glRotate(angle, 1, 0, 0); 
```

您是否只调用此函数一次并期望 glRotate 调用不断更新场景（一个非常错误的假设），或者重复调用此函数以渲染动画场景，这也是模棱两可的。如果是前一种情况，请阅读我上面链接的教程。如果是后一种情况，那么您应该考虑执行一次文件 I/O 并构建一个[显示列表](http://www.lighthouse3d.com/opengl/displaylists/source.php3?1)以在渲染循环中调用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T14:31:15.953

~~你没有`glBegin`/ `glEnd`。~~（实心球体不需要）另外，在听起来投影矩阵未初始化`glLoadIdentity`之前尝试。`glRotate`说到这，你可能也需要一个`gluPerspective`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T14:31:35.623

您必须记住，OpenGL 的矩阵堆栈独立于您的帧。堆栈仍然存在，因此必须使用 push/pop 保存它，或者为每一帧完全重建。

在您的情况下，尝试将 glRotate() 调用移动到 glLoadIdentity() 之后，以进行新的旋转。当然，您必须随后更改角度才能实现旋转的变化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T14:34:03.857

你正在创建一个实心球体......你应该如何判断它是否旋转？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T23:44:30.903

你设置`ProjectionMatrix`正确吗？（使用`glutOrtho`等）

正如其他人已经指出的那样，`glLoadIdentity`让您的模型-视图-矩阵识别，然后您进行翻译，因此当您渲染球体时，它只会被翻译。至于飞行，您正在循环进行转换，而 OpenGL 是状态机，因此您的所有转换都被一个接一个地应用。IE

```
for (each point)
{
   modelMatrix *= translate(newPt); // this is adding all transaltes..
} 
```

因此，您的起点可能会正确显示（可能只是第一个），但随后会看起来像飞行......因为他们正在获取所有先前点的翻译。

您需要做的是独立为每个 pt 应用翻译，即

```
for (each pt)
{
push_matrix
glLoadIdentity
glRotate      // matrix being applied is in reverse order of being called..
glTranslate   // so translate and rotate
glutSphere
pop matrix
} 
```

但以上对你没有帮助，因为你想动动整个大脑。所以你应该像你一样用平移来渲染你的大脑，但将旋转矩阵应用于所有对象。

希望这可以澄清。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T14:32:32.830

我的 OpenGL 生锈了，但我认为你想在加载单位矩阵后进行旋转。

```
glLoadIdentity();    
glRotatef(80.0f, 1.0f, 0.0f, 0.0f);           
glTranslatef((a[0]-1.15)*26, a[2]*30, a[1]*30);
glutSolidSphere(6, 5, 5); 
```

但是最好的解决方案（如果我没记错的话）是在旋转后推动矩阵，然后弹出它而不是`glLoadIdentity()`循环的每次迭代，但我不太确定。也许其他人更了解 OpenGL 矩阵堆栈？

# ruby-on-rails - 弹性-> 导轨；如何在一次服务调用中使用 has_many 创建模型？

> ID：662417
> 
> 赞同：1
> 
> 时间：2009-03-19T14:27:55.710
> 
> 标签：ruby-on-rails, apache-flex

我正在开发一个 Flex/Rails 应用程序。我有一个模型`has_many :through`，我正在尝试创建一个关联。[在Paul Barry 的 has-many-through-checkboxes](http://paulbarry.com/articles/2007/10/24/has_many-through-checkboxes "Paul Barry 的多选复选框")等博客的帮助下，我已经在普通的 rails 页面上使用了复选框。现在我正试图让 Flex 做同样的事情，并且在如何在 Flex 服务调用中发送等效的复选框参数时遇到了困难。

涉及的模型如下所示：

```
class PlayerAction < ActiveRecord::Base
  belongs_to :player
  belongs_to :action_type
  has_many :action_cards
  has_many :deck_cards, :through => :action_cards
end 
```

rails页面上的表格是这样的：

```
<% form_for PlayerAction.new do |f| %>
    <%= f.hidden_field  :player_id, {:value => @player.id} %>
    <%= f.collection_select(:action_type_id, ActionType.find(:all), :id, :desc) %>
    <ul>
        <% @player.hand.deck_cards.each do |deck_card| -%>
        <li><%= check_box_tag "player_action[deck_card_ids][]", deck_card.id -%><%= deck_card.title %>
            <% end -%>
        </ul>
    <%= f.submit 'Do Action' %>
<% end %> 
```

这将创建在 rails 日志中的参数，如下所示：

```
Parameters: {"commit"=>"Do Action", "action"=>"create", "controller"=>"player_actions", "player_action"=>{"action_type_id"=>"1", "player_id"=>"9", "deck_card_ids"=>["87", "56"]}} 
```

使用 Firefox 上的 TamperData 插件，参数如下所示：

```
player_action[player_id]=9
player_action[action_type_id]=1
player_action[deck_card_ids][]=87
player_action[deck_card_ids][]=56
commit=Do+Action 
```

最后，我的服务调用 Flex 代码如下。`svcAction`是在`mx:HTTPService`别处定义的。路由和 url 有效，我在这里关注参数：

```
svcAction.url = "/player_actions.xml";
var params:Object = new Object();
params['player_action[action_type_id]'] = 1;
params['player_action[player_id]'] = 8;
params['player_action[deck_cards_ids][]'] = 37;
params['player_action[deck_cards_ids][]'] = 19;
svcAction.send(params); 
```

在上面的代码中，`player_action[deck_cards_ids][]`参数相互覆盖，所以只发送了一个，第二个值。我也尝试过 ids 的数组

`params['player_action[deck_cards_ids]'] = myIdsArray.toString();`

和

`params['player_action[deck_cards_ids]'] = "[" + myIdsArray.toString() + "]";`

但这些都不起作用。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T20:05:01.180

我从另一个进行更新的服务调用中复制了 Flex 中 params 对象的用法（我以 Flex on Rails 书中的示例为模型）。重新审视这一点，我意识到这是一个创建，查看了另一个有效的创建服务，并最终创建了一个 xml 请求。

这是有效的 Flex 代码片段：

```
var request:XML =
  <player_action>
    <player_id>10</player_id>
    <action_type_id>1</action_type_id>
    <deck_card_ids>37</deck_card_ids>
    <deck_card_ids>103</deck_card_ids>
  </player_action>;
svcAction.request = request;
svcAction.send();

<mx:HTTPService id="svcAction" url="/player_actions.xml" contentType="application/xml" method="POST" resultFormat="e4x" result="handleActionResult(event)" /> 
```

起初我以为我需要`<deck_card_id>`嵌套在 的父级中`<deck_card_ids>`，但这不起作用。我实际上在那里使用绑定变量和大括号来使用我想要的值，但上面是生成的 xml。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T17:01:55.690

您的问题可能在视图中。而不是传回一个带有类似元素的数组`player_action[deck_card_ids][] = 87`，它应该是`player_action[deck_card_ids][87] = true`.

```
<ul>
  <% @player.hand.deck_cards.each do |deck_card| %>
    <li><%= check_box_tag "player_action[deck_card_ids][#{deck_card.id}]" %><%= deck_card.title %>
  <% end %>
</ul> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T20:38:30.460

在我看来，您最好的选择是更改 Rails 控制器，以便解析参数中的不同字符串键。也就是说，您现有的控制器可能会工作。尝试使用`params[ new String( "player_action[deck_cards_ids][]" ) ] = [ 37, 19 ];`

# android - Android 短信内容 (content://sms/sent)

> ID：662420
> 
> 赞同：20
> 
> 时间：2009-03-19T14:28:41.920
> 
> 标签：android, contacts, android-sms

我在从设备读取 SMS 消息时遇到问题。获取 URI 的内容提供程序时`content://sms/inbox`，一切都很好。我可以读取**人员**列以在人员表中找到外键，并最终找到联系人及其姓名。

但是，我也想遍历发送的消息。从 读取时`content://sms/sent`，**人员**字段始终显示为 0。

这是要读取以查找已发送消息的收件人数据的正确字段吗？*如果是这样-知道为什么我的总是0吗？*

我所有的测试都在模拟器中完成，我已经创建了 3 个联系人。我已经以您发送消息的正常方式从模拟器向这些联系人发送了消息。

重申一下，我可以看到 4 条发送的消息并阅读相关的正文。我的问题是我似乎无法读取“人员”ID，因此我无法确定收件人是谁。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-19T17:29:28.853

使用地址栏。我猜 person 列被忽略了，因为人们可以向不在联系人列表中的电话号码发送 SMS。

```
// address contains the phone number
Uri phoneUri = Uri.withAppendedPath(Contacts.Phones.CONTENT_FILTER_URL, address);
if (phoneUri != null) {
  Cursor phoneCursor = getContentResolver().query(phoneUri, new String[] {Phones._ID, Contacts.Phones.PERSON_ID}, null, null, null);
  if (phoneCursor.moveToFirst()) {
    long person = phonesCursor.getLong(1); // this is the person ID you need
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-01T10:17:18.113

在这里，我附上了我编写的代码，用于将消息发送给我从电话簿中选择的用户

```
addcontact.setOnClickListener(new View.OnClickListener()
        {
            public void onClick(View V)
            {
                Intent ContactPickerIntent = new Intent(Intent.ACTION_PICK,ContactsContract.Contacts.CONTENT_URI);
                startActivityForResult(ContactPickerIntent, CONTACT_PICKER_RESULT);             
            }
        }
        ); 
```

这将打开联系人列表..........................

```
 protected void onActivityResult(int requestCode, int resultCode, Intent data) {  
         if (resultCode == RESULT_OK)
         {  
             switch (requestCode) 
             {  
             case CONTACT_PICKER_RESULT:
                 Cursor cursor=null;
                 try
                 {   
                     Uri result = data.getData();
                     Log.v(DEBUG_TAG, "Got a contact result: " + result.toString());

                     // get the contact id from the Uri     
                     String id = result.getLastPathSegment();

                     // query for everything contact number  
                     cursor = getContentResolver().query(  
                          Phone.CONTENT_URI, null,  
                          Phone.CONTACT_ID + "=?",  
                          new String[]{id}, null); 

                     cursor.moveToFirst();
                     int phoneIdx = cursor.getColumnIndex(Phone.DATA);  
                     if (cursor.moveToFirst())
                     {   
                         phonenofromcontact = cursor.getString(phoneIdx);
                         finallistofnumberstosendmsg +=","+phonenofromcontact;
                         Log.v(DEBUG_TAG, "Got email: " + phonenofromcontact);  
                     }
                     else 
                     {                                
                         Log.w(DEBUG_TAG, "No results"); 
                     }
                 }
                 catch(Exception e)
                 {
                     Log.e(DEBUG_TAG, "Failed to get contact number", e);
                 }
                 finally
                 {
                     if (cursor != null)
                     {  
                         cursor.close();
                     }
                 }
                 phonePhoneno= (EditText)findViewById(R.id.Phonenofromcontact);
                 phonePhoneno.setText(finallistofnumberstosendmsg);
                 //phonePhoneno.setText(phonenofromcontact);
                 if(phonenofromcontact.length()==0)
                 {
                     Toast.makeText(this, "No contact number found for this contact",
                             Toast.LENGTH_LONG).show(); 
                 }
                break;  
             }  
         } 
         else
         {  
             Log.w(DEBUG_TAG, "Warning: activity result not ok");
         }  
     } 
```

这就是您如何处理和从电话簿中获取电话号码的方法...................................... .....................................

现在用号码列表和味精调用发送味精来设置..

```
private void sendSMS(String phoneNumber, String message)
    {
        String SENT = "SMS_SENT";
        String DELIVERED = "SMS_DELIVERED";

        PendingIntent sentPI = PendingIntent.getBroadcast(this, 0,
            new Intent(SENT), 0);

        PendingIntent deliveredPI = PendingIntent.getBroadcast(this, 0,
            new Intent(DELIVERED), 0);

      //---when the SMS has been sent---
        registerReceiver(new BroadcastReceiver(){
            @Override
            public void onReceive(Context arg0, Intent arg1) {
                switch (getResultCode())
                {
                    case Activity.RESULT_OK:
                        Toast.makeText(getBaseContext(), "SMS sent", 
                                Toast.LENGTH_SHORT).show();
                        break;
                    case SmsManager.RESULT_ERROR_GENERIC_FAILURE:
                        Toast.makeText(getBaseContext(), "Generic failure", 
                                Toast.LENGTH_SHORT).show();
                        break;
                    case SmsManager.RESULT_ERROR_NO_SERVICE:
                        Toast.makeText(getBaseContext(), "No service", 
                                Toast.LENGTH_SHORT).show();
                        break;
                    case SmsManager.RESULT_ERROR_NULL_PDU:
                        Toast.makeText(getBaseContext(), "Null PDU", 
                                Toast.LENGTH_SHORT).show();
                        break;
                    case SmsManager.RESULT_ERROR_RADIO_OFF:
                        Toast.makeText(getBaseContext(), "Radio off", 
                                Toast.LENGTH_SHORT).show();
                        break;
                }
            }
        },new IntentFilter(SENT));

        //---when the SMS has been delivered---
        registerReceiver(new BroadcastReceiver(){
            @Override
            public void onReceive(Context arg0, Intent arg1) {
                switch (getResultCode())
                {
                    case Activity.RESULT_OK:
                        Toast.makeText(getBaseContext(), "SMS delivered", 
                                Toast.LENGTH_SHORT).show();
                        break;
                    case Activity.RESULT_CANCELED:
                        Toast.makeText(getBaseContext(), "SMS not delivered", 
                                Toast.LENGTH_SHORT).show();
                        break;                        
                }
            }
        }, new IntentFilter(DELIVERED));        

        SmsManager sms = SmsManager.getDefault();
        sms.sendTextMessage(phoneNumber, null, message, sentPI, deliveredPI);       
    } 
```

这将发送消息..................................您需要接收方接收广播的消息

```
public class SmsReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        //---get the SMS message passed in---
        Bundle bundle = intent.getExtras();        
        SmsMessage[] msgs = null;
        String str = ""; 
        if (bundle != null)
        {
            //---retrieve the SMS message received---
            Object[] pdus = (Object[]) bundle.get("pdus");
            msgs = new SmsMessage[pdus.length];            
            for (int i=0; i<msgs.length; i++)
            {
                msgs[i] = SmsMessage.createFromPdu((byte[])pdus[i]);                
                str += "SMS from " + msgs[i].getOriginatingAddress();                     
                str += " :";
                str += msgs[i].getMessageBody().toString();
                str += "\n";        
            }
            //---display the new SMS message---
            Toast.makeText(context, str, Toast.LENGTH_SHORT).show();
        }   
    }
} 
```

你也可以试试看。它对我有用..谢谢

# java - “没有 X11 DISPLAY 变量”——这是什么意思？

> ID：662421
> 
> 赞同：113
> 
> 时间：2009-03-19T14:28:50.733
> 
> 标签：java, linux, variables, x11, headless

我正在尝试在我的 Linux 机器（Slackware）上安装 Java 应用程序。

我收到以下错误，我不明白。

你能告诉我如何解决这个问题吗？谢谢你。

这是我得到的：（我看到需要设置一些**X11 DISPLAY**变量，但是我应该给它什么值以及如何设置？）

```
~$ java -jar gate-5.0-beta1-build3048-installer.jar
- ERROR -

java.awt.HeadlessException:
No X11 DISPLAY variable was set, but this program performed an operation which requires it.
java.awt.HeadlessException:
No X11 DISPLAY variable was set, but this program performed an operation which requires it.
at java.awt.GraphicsEnvironment.checkHeadless(Graphic sEnvironment.java:159)
at java.awt.Window.<init>(Window.java:407)
at java.awt.Frame.<init>(Frame.java:402)
at net.sourceforge.mlf.metouia.borders.MetouiaDotsBuf fer.<init>(MetouiaDotsBuffer.java:105)
at net.sourceforge.mlf.metouia.borders.MetouiaDots.<i nit>(MetouiaDots.java:66)
at net.sourceforge.mlf.metouia.borders.MetouiaToolBar Border.<init>(MetouiaToolBarBorder.java:49)
at net.sourceforge.mlf.metouia.MetouiaLookAndFeel.ini tComponentDefaults(MetouiaLookAndFeel.java:241)
at javax.swing.plaf.basic.BasicLookAndFeel.getDefault s(BasicLookAndFeel.java:130)
at javax.swing.plaf.metal.MetalLookAndFeel.getDefault s(MetalLookAndFeel.java:1591)
at javax.swing.UIManager.setLookAndFeel(UIManager.jav a:537)
at javax.swing.UIManager.setLookAndFeel(UIManager.jav a:581)
at com.izforge.izpack.installer.GUIInstaller.loadLook AndFeel(GUIInstaller.java:373)
at com.izforge.izpack.installer.GUIInstaller.<init>(G UIInstaller.java:116)
at sun.reflect.NativeConstructorAccessorImpl.newInsta nce0(Native Method)
at sun.reflect.NativeConstructorAccessorImpl.newInsta nce(NativeConstructorAccessorImpl.java:39)
at sun.reflect.DelegatingConstructorAccessorImpl.newI nstance(DelegatingConstructorAccessorImpl.java:27)
at java.lang.reflect.Constructor.newInstance(Construc tor.java:513)
at java.lang.Class.newInstance0(Class.java:355)
at java.lang.Class.newInstance(Class.java:30
at com.izforge.izpack.installer.Installer.main(Instal ler.java:62) 
```

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2009-03-19T14:30:17.033

如果您在主显示屏上，那么

```
export DISPLAY=:0.0 
```

或者如果您使用的是 csh 或 tcsh

```
setenv DISPLAY :0.0 
```

在运行您的应用程序之前。

实际上，我很惊讶它没有自动设置。您是否尝试从非图形终端启动此应用程序？如果没有，您是否修改了默认的 .profile、.login、.bashrc 或 .cshrc？

请注意，如我所说，将 DISPLAY 设置为 :0.0 前提是您正坐在主显示屏上，或者至少主显示屏已登录到您的用户 ID。如果它没有登录，或者它是不同的用户 ID，这将失败。

如果您是从另一台机器进来的，并且您在该机器的主显示屏上并且它正在运行 X，那么您可以使用“ssh -X hostname”连接到该主机，ssh 会将 X 显示屏转发回来. ssh 还将确保正确设置了 DISPLAY 环境变量（前提是它没有在我上面提到的各种点文件中被弄乱）。在“ssh -X”会话中，DISPLAY 环境变量将具有类似“localhost:11.0”的值，它将指向 ssh 正在通过隧道连接到本地机器的套接字。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-19T14:36:40.293

您是在 X11 环境中运行它吗？您可以使用终端窗口，但它必须在 X 内（在图形登录之后，或通过运行 startx）。

如果您已经在图形环境中，请尝试 export DISPLAY=:0 用于 bash 之类的 shell（bash、sh 等）或 setenv DISPLAY :0 用于基于 C shell 的 shell（csh、tcsh 等）

如果您通过 SSH 从另一台机器连接，则使用 -X 选项在您所在的机器上显示图形界面（前提是那里运行 X 服务器（例如用于 windows 的 xming，以及您的标准 Linux X服务器）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-08-31T13:36:45.183

您必须在 PuTTy 中启用**X11 转发**

为此打开 PuTTy，转到**Connection => SSH => Tunnels**并选中**Enable X11 forwarding**

还 sudo 到服务器并在此处导出以下变量 IP 是您本地机器的 IP

```
export DISPLAY=10.75.75.75:0.0 
```

[![在此处输入图像描述](https://i.stack.imgur.com/JIRrZ.png)](https://i.stack.imgur.com/JIRrZ.png)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-05-22T18:20:40.743

有很多方法可以做到这一点。我做了一些对我来说很方便的事情，而且总是很好。

1.  在您的远程服务器上，确保安装 xorg-x11-xauth、xorg-x11-font-utils、xorg-x11-fonts。
2.  在本地桌面上运行 Xming 服务器
3.  在 putty 上，在 ssh 到服务器之前，启用 X11 转发并将显示位置设置为 localhost:0.0
4.  在服务器上，会生成 .Xauthority 文件，并注意 DISPLAY 变量已设置。

    $ xauth 列表

    $ xauth 添加

要测试它，请输入 xclock 或 xeyes

**注意**：要切换用户，请将 .Xauthority 文件复制到相应用户的主目录，并从该用户导出 DISPLAY 变量。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-06-15T14:41:59.357

在与所描述的情况类似的情况下，还有一件事可能是问题 - 当远程端未安装“xauth”程序时，未转发 X 并且未设置 $DISPLAY。当您运行“ssh -Xv ip_address”时，您可以看到它正在搜索它，如果未找到，则会失败，除非您打开详细模式（IMO 失败），否则不会看到它。您通常可以在同名的包中找到“xauth”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-01-28T09:52:01.710

非常简单，遇到同样的问题，然后我所做的是下载并安装一个有助于显示然后修复错误的应用程序。

下载这个应用程序xming：

[http://sourceforge.net/project/downloading.php](http://sourceforge.net/project/downloading.php)？

安装，然后使用此链接上的设置：

[http://www.geo.mtu.edu/geoschem/docs/putty_install.html](http://www.geo.mtu.edu/geoschem/docs/putty_install.html)或按照以下步骤操作：

**安装/配置 PuTTy 和 Xming**

将 PuTTy 和 Xming 下载到 PC 后，根据各自的说明进行安装。

**配置 Xming**

安装 Xming 后，运行名为“XLaunch”的应用程序并验证设置是否如下所示：

*   在显示设置窗口中选择默认条目，单击下一步
*   在会话类型窗口中单击下一步。
*   单击附加参数窗口上的下一步（注意剪贴板复选框为真）
*   保存配置并点击完成。

**配置 PuTTy**

安装完 PuTTy 后，双击桌面上的 PuTTy 图标，进行如下配置：

这显示了创建登录配置文件然后保存它。

*   在 ssh -> X11 上，单击复选框以启用 X11 转发。
*   在 X 显示位置文本框中，输入 localhost:0.0

保存配置文件然后远程连接到服务器进行测试。

干杯！！！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-04-20T14:36:56.093

对于那些试图让 X Window 应用程序从 Linux 的 Windows 工作的人：

对我有用的是在我的 Windows 机器上设置 xming 服务器，当我连接到 linux 主机时在 putty 中设置 X11 转发选项，然后输入我的 windows ip 地址和显示端口，然后输入我的 windows IP 地址的显示变量：0.0

不要忘记将 linux 主机 IP 地址添加到 X0.hosts 文件中，以确保 xming 服务器接受来自该主机的流量。我花了一段时间才弄清楚。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-01T10:44:05.977

如果我在 Byobu 终端内启动脚本，我在 Ubuntu 14.04.01 中也遇到了同样的问题（可能与 Screens 相同）。

只需退出 Byobu 并（在图形终端中）运行脚本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-12-08T11:49:15.570

初步检查。

1) 当您将 DISPLAY 导出到其他机器时，请确保您`xhost +`在该机器上输入了命令。该命令允许其他机器在这台机器上导出他们的 DISPLAY。可能存在安全限制，只需了解即可。需要检查`ssh -X MachineIP`会不会需要`xhost +`？

2) 有时`JCONSOLE`不会显示其所有进程，因为这些 JVM 进程可能与不同的用户一起运行，并且您正在与另一个用户一起导出 DISPLAY。所以最好遵循`CD_DIR>sudo ./jconsole`

3) 在 WAS (WEBSPHERE) 中；jconsole 将无法连接它的java server 进程，那个时候只要到链接，然后尝试连接它。这对我有用。可能是此页面正在初始化一些变量以使 jconsole 能够与该服务器连接。

WAS 控制台 > 应用程序服务器 > server1 > 进程定义 > Java 虚拟机

* * *

我在 AIX（命令行界面仅可用，没有 DISPLAY UI）机器上遇到了同样的问题。我通过安装解决了

> 适用于 Windows 的 NX 客户端

第 1 步：通过那台 Windows 机器，我连接到有 GUI 控制台可用的 unix box。
第 2 步：从 UNIX 框通过 SSH 连接到 AIX 框。
第 3 步：将 DISPLAY 设置为“export DISPLAY=UNIXMACHINE:NXClientPORTConnectedMentionedOnTitle”
第 4 步：现在如果我们启动任何需要 DISPLAY 的程序；它将在这个 UNIX 机器上启动。

> VNC

如果您在显示可用的 UNIX 机器上安装了 VNC；则不需要 Windows 和 NX 客户端。第 1 步：使用 VNC 连接有 GUI 控制台的 Unix 机器。
第 2 步：从 UNIX 框通过 SSH 连接到 AIX 框。
第 3 步：将 DISPLAY 设置为“export DISPLAY=UNIXMACHINE:VNCPORT”
第 4 步：现在如果我们启动任何需要 DISPLAY 的程序；它将在这个 UNIX 机器上启动。

别的

第 1 步：从 UNIX 机器通过 SSH 连接到 AIX 机器。
第 2 步：将 DISPLAY 设置为“export DISPLAY=UNIXMACHINE:VNCPORT”
第 3 步：现在如果我们启动任何需要 DISPLAY 的程序；它将在这个 UNIX 机器上启动。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2011-08-25T19:18:15.147

不要忘记在“home”显示机器上执行“host +”，当你 ssh 到机器时，你正在执行“ssh -x hostname”

# ruby - 如何在 wxRichTextCtrl 中复制和粘贴富文本？

> ID：662423
> 
> 赞同：0
> 
> 时间：2009-03-19T14:29:08.813
> 
> 标签：ruby, wxwidgets, copy-paste, rte, wxruby

我正在使用 wxruby，但据我所知，它不仅是一个 ruby​​ 问题。如果我尝试将富文本复制并粘贴到 wxRichTextCtrl 中，它会丢失所有格式。我错过了什么？有什么办法可以使这项工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T12:34:25.203

查看*richtextbuffer.cpp*的[SVN 主干代码](http://svn.wxwidgets.org/viewvc/wx/wxWidgets/trunk/src/richtext/richtextbuffer.cpp?view=markup)，特别是方法

 *```
bool wxRichTextBuffer::PasteFromClipboard(long position) 
```

该控件完全接受 4 种不同的剪贴板格式：

*   它自己的私有格式*wxRichTextBufferDataObject::GetRichTextBufferFormatId()*

*   标准文本格式*wxDF_TEXT*和*wxDF_UNICODETEXT*

*   位图格式*wxDF_BITMAP*

因此，确实可以在不同的 wxRichTextCtrl 之间或在单个*wxRichTextCtrl*之间复制和粘贴富文本，但不支持将 RTF 或来自外部应用程序的类似数据粘贴到*wxRichTextCtrl*中。

# javascript - 单击使用 JavaScript 记录日志

> ID：662434
> 
> 赞同：6
> 
> 时间：2009-03-19T14:32:18.133
> 
> 标签：javascript, jquery, firefox, logging, onclick

我想记录对链接的所有点击。

我写了一个小记录器，可以通过 url 调用（返回一个空页面）。此 url 使用 jquery-ajax-method 调用。但不幸的是，如果用户使用 firefox（在 IE 中一切正常），则不会记录每次点击。

我已经尝试了很多东西，但没有解决这个问题，有人有胶水吗？

HTML代码：

```
<a href="http://google.com" onclick="return loggClick();">Click</a> 
```

JS-jQuery-脚本：

```
function loggClick(){
   $.ajax({
        type: "POST",
        url: "Logger.ff", //dynamic url to logging action
        data: {
            sid: 'abc123' //random data
        },
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        cache: false
    });
    return true;
} 
```

编辑：我在示例中错过了我必须在 js 调用中传递动态参数，因此“不可能”删除 onclick-event :(

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T14:43:03.070

我将开始**摆脱内联的“onclick”**代码并稍后绑定事件：

```
 <a href="http://google.com" rel="outbound" >Click</a>

   $("a[rel=outbound]").click(function(){ 
        var url = this.href; 
        $.ajax({
        async: false,
        type: "POST",
        url: "Logger.ff", //dynamic url to logging action
        data: {
                sid: 'abc123' //random data
                clicked: url
        },
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        cache: false
     });
     return true; 
  }); 
```

**此外，您可能会发生“种族状况”**。在我的示例中，我**将 async 设置为 false**。

这将在执行请求之前停止函数返回并跟踪链接。

### 关于异步

我`async: false`在这里使用的原因是因为默认情况下， aync 为 true，这意味着 AJAX 请求可能只有在浏览器看到时才部分传输`return: true`，并导航离开页面。

这就是我提到的“竞争条件”。在这里，这是一个廉价的技巧，通过使浏览器基本上停止直到请求完成，然后允许浏览器单击链接来避免它。

一个更复杂的答案是让它返回“false”，（这将杀死浏览器的原生“follow link”行为），然后在函数中执行*真正的*重定向。`complete`

这并非没有自己的问题，并且可能会导致请求完成时浏览行为缓慢，从而使用户有时间单击其他链接，这似乎什么也没做，然后最终一个请求在随机时间通过，并且看似随机发生重定向。

因此，高级解决方案包括阻止页面的其余部分并在请求完成时给出某种进度指示。

（因此，在一个简单的例子中，这个解决方案的复杂性比一个数量级更难实现`async: false`）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T14:44:12.990

我认为 FF 给您带来糟糕结果的原因是您在操作需要时间执行之前离开了页面。正如 mhartman 的链接所提到的，如果您在外部链接上使用目标，它应该可以正常工作。如果您不能这样做，那么您可能必须等待日志完成，尽管您可能会看到导航延迟。

HTML 代码

```
<a href="http://google.com" onclick="return loggClick(event);">Click</a> 
```

这

```
function loggClick(e) {
  if (!e) e = window.event;

  e.preventDefault();  // cancels the link

  var theLink = this.href;  // stores the link for later

  $.ajax({
     async: false,
     type: "POST",
        url: "Logger.ff", //dynamic url to logging action
        data: {
            sid: 'abc123' //random data
        },
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        cache: false,
         complete: function() {
           // navigate when the log completes
           this.location.href = theLink;
         }
    });
    return true;
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T14:56:03.303

您可能没有想到的另一种服务器端方法是拥有一个页面来处理您的重定向并记录数据。

例如：

```
<a href="LoggerRedirect.ff?url=http://google.com">Click</a> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T15:03:23.363

上面的海报是正确的，它是不可靠的，因为你在它有机会登录之前就离开了页面。

你可以这样做：

1) 返回 false，因此 href 无效。2) 记录点击 3) 使用 location.href 重定向到它会被重定向到的 url

如果您的 onclick 处理程序需要很长时间才能执行，您可能会看到轻微的延迟。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-22T16:19:50.900

此示例将在处理链接单击之前触发 ajax 帖子。我发现我必须同步调用 ajax 否则 POST 将不会被执行。在这个例子中，我的 ajax 帖子是一个 PHP 页面，它附加了一个日志文件。这个例子很有效，因为它只将一个点击事件附加到窗口。它也不会干扰用户点击链接。

```
//attach click event to window
attachClickEvent = function() {
    $(document).on('click', function(e) { //document for IE8 compatibility
        var element = $(e.target);
        var tag = element.prop('tagName');

        if (tag === 'A') {
            var data = {'title':document.title, 'URL':element.attr('href'), 'origin':location.href};
            logData(data);
        }
    });
}

logData = function(data) {
    $.ajax({
        async: false,
        cache: false,
        type: "POST",
        data: data,
        url: 'logger.php',
        success: function(msg) { 
            //debugging
        },
        error: function() {
            //debugging
        }
    });
} 
```

# c - 有哪些重构方法可以减少编译代码的大小？

> ID：662439
> 
> 赞同：16
> 
> 时间：2009-03-19T14:33:50.503
> 
> 标签：c, optimization, memory, embedded, size

我有一个需要新功能的旧版固件应用程序。应用程序的大小已经接近设备有限的闪存容量，少数新功能和变量将其推到了边缘。打开编译器优化可以解决问题，但客户对此持谨慎态度，因为他们过去曾导致失败。那么，在重构 C 代码以产生更小的输出时，需要寻找哪些常见的东西呢？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-19T14:38:00.633

*   尽可能使用生成函数而不是数据表
*   禁用内联函数
*   把常用的宏变成函数
*   降低大于本机机器大小的变量的分辨率（即 8 位微，尝试摆脱 16 位和 32 位变量 - 将某些代码序列加倍和加倍）
*   如果 micro 具有较小的指令集（Arm thumb），请在编译器中启用它
*   如果内存是分段的（即分页的或非线性的），那么
    *   重新排列代码，以便需要使用更少的全局调用（更大的调用指令）
    *   重新排列代码和变量使用以消除全局内存调用
    *   重新评估全局内存使用 - 如果它可以放在堆栈上，那就更好了
*   确保您在关闭调试的情况下进行编译 - 在某些处理器上它会产生很大的不同
*   压缩无法即时生成的数据 - 然后在启动时解压缩到 ram 中以便快速访问
*   深入研究编译器选项 - 可能每个调用都是自动全局的，但您可以安全地逐个文件禁用它以减小大小（有时显着）

如果您仍然需要比`compile with optimizations`打开时更多的空间，请查看生成的程序集与未优化的代码。然后重新编写发生最大变化的代码，以便编译器在关闭优化的情况下基于棘手的 C 重写生成相同的优化。

例如，您可能有几个进行类似比较的“if”语句：

```
if(A && B && (C || D)){}
if(A && !B && (C || D)){}
if(!A && B && (C || D)){} 
```

然后创建一个新变量并提前进行一些比较将使编译器免于重复代码：

```
E = (C || D);

if(A && B && E){}
if(A && !B && E){}
if(!A && B && E){} 
```

如果您打开它，这是编译器自动为您执行的优化之一。还有很多很多其他的，如果您想学习如何在 C 代码中手动执行此操作，您可能会考虑阅读一些编译器理论。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-19T15:57:29.840

通常：使用您的链接器映射或工具来确定您最大/最多的符号是什么，然后可能使用反汇编程序查看它们。你会惊讶于你以这种方式找到的东西。

使用一些 perl 等，您可以对 .xMAP 文件或“objdump”或“nm”的结果进行简短处理，并以各种方式重新排序以获取相关信息。

* * *

特定于小型指令集：注意[文字池](http://en.wikipedia.org/wiki/Literal_pool)的使用。虽然从例如 ARM（每条指令 32 位）指令集更改为 THUMB（每条指令 16 位）指令集在某些 ARM 处理器上可能很有用，但它减小了“立即”字段的大小。

突然之间，来自全局或静态的直接负载变得非常间接；它必须首先将全局/静态的地址加载到寄存器中，然后从中加载，而不是直接在指令中编码地址。因此，您会在文字池中获得一些额外的指令*和*一个额外的条目，这些条目通常是一条指令。

解决这个问题的策略是将全局变量和静态变量组合成结构；这样，您只存储一个文字（全局结构的地址）并从中计算偏移量，而不是在访问多个静态/全局变量时存储许多不同的文字。

我们将“单例”类从管理它们自己的实例指针转换为仅作为大型“struct GlobalTable”中的成员，并且在某些情况下，它在代码大小（几个百分比）和性能方面产生了显着差异。

* * *

否则：留意静态结构和非平凡构造的数据数组。其中每一个通常会生成大量 .sinit 代码（“不可见的函数”，如果您愿意的话），这些代码在 main() 之前运行以正确填充这些数组。如果您只能在静态数据中使用微不足道的数据类型，那么您的情况会好得多。

这又是可以通过使用工具对“nm”或“objdump”等的结果轻松识别的东西。如果您有大量 .sinit 文件，您会想要进行调查！

* * *

哦，而且——如果你的编译器/链接器支持它，不要害怕为某些文件或函数选择性地启用优化或更小的指令集！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T14:37:26.203

重构[重复代码](http://en.wikipedia.org/wiki/Duplicate_code)应该对程序的内存占用影响最大。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T14:39:48.990

注意宏。他们可以从一个宏扩展中生成大量代码。如果您发现这样的宏 - 尝试重写它们，以最小化它们的大小并将功能转移到函数中。

注意重复的代码 - 复制粘贴和逻辑重复。尝试将重复的代码分成函数。

检查编译器是否支持内联，可以关闭。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T14:43:58.357

触发错误的编译器优化？那很奇怪。获取您的程序的地图，看看您是否应该以数据或代码为目标。寻找重复的代码。寻找具有类似目标的代码。其中一个示例是busybox 代码，它旨在减少内存占用。

它更倾向于大小而不是可读性，所以有时它会变得非常丑陋，比如 goto 等等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T17:44:54.357

上述答案声称“打开编译器优化[减少代码大小]”。鉴于我在嵌入式系统*TI DSP 编程方面的所有文档和经验，我知道启用优化将增加您的代码大小（对于 TI DSP 芯片）！*

* * *

让我解释：

TI TMSCx6416 DSP 有 9 个编译器标志，它们会影响您的代码大小。

1.  3个不同的优化标志
2.  3 个不同的调试标志
3.  代码大小的 3 个不同标志

对于我的编译器，当您打开优化级别 3 时，文档说明：

1.  将发生某些函数的自动内联 --> 将增加代码大小
2.  启用软件流水线 --> 将增加代码大小

什么是软件流水线？

这就是编译器将在汇编中做的事情，使 for 循环执行得更快（最多快几倍），但以更大的代码大小为代价。我建议阅读[维基百科上的软件流水线](http://en.wikipedia.org/wiki/Software_pipelining)（寻找循环展开、序言和结语）。

**因此，请检查您的文档以确保优化不会使您的代码变大。**

* * *

另一个建议是寻找与代码大小相关的编译器标志。**如果您有代码大小编译器标志，请确保将它们提高到最高设置。通常针对代码大小进行编译意味着您的代码执行速度会变慢……但您可能必须这样做。**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-04-09T23:04:47.817

你可以做很多事情，但是这两件事过去对我帮助很大，我只想建议一个

1-不要使用像*sprintf*这样的通用标准 C 库，...它们非常通用，如果您编写自己的函数，它会释放大量空间

2-如果你有一个 char 数组的本地声明，如果你知道最大长度，你应该明确给出长度，而不是通过输入参数获取长度，例如

如果你有这样的功能

```
void foo(char* str,uint8_t length){
char local_string[length];
....
} 
```

您最好找到您使用的最大长度，然后将其更改为

```
void foo(char* str,uint8_t length){
char local_string[MAXIMUM_LENGTH];
....
} 
```

# c++ - OpenGL中的调色板动画

> ID：662440
> 
> 赞同：2
> 
> 时间：2009-03-19T14:33:54.433
> 
> 标签：c++, c, opengl

我正在制作一个老式的 2d 游戏，我想在我的纹理中设置特定颜色的动画。

我知道的唯一方法是：

1.  opengl 着色器。
2.  仅对一个颜色通道进行动画处理。
3.  彩色动画纹理下的白色纹理。

但我不想使用着色器，我想让这个游戏尽可能简单，不需要太多额外的 openGL 函数等。

颜色通道动画不适合这个，因为我需要纹理中的所有颜色通道。

目前我正在使用 2 个纹理：另一个纹理下的白色纹理，将特定像素颜色转换为透明，然后我使用 glColor3f() 函数将白色纹理颜色更改为我想要的任何颜色，然后我看到“调色板动画”那个特定的颜色。

但是这种风格听起来很hacky，所以我想知道是否有更好的技巧？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T00:33:21.040

虽然我不熟悉调色板纹理扩展，但我仍然建议使用片段着色器来获得这种效果。与您提到的其他方法相比，使用着色器替换颜色键几乎是微不足道的，并且比自己编写调色板功能要快得多。

这是一个示例 GLSL 片段着色器，它可以将纹理中的白色替换为传入的任何颜色。

```
uniform vec4 fvReplaceColor;
uniform sampler2D baseMap;
varying vec2 Texcoord;

void main( void )
{
     vec4  fvBaseColor = texture2D( baseMap, Texcoord);

     if(fvBaseColor == vec4(1.0, 1.0, 1.0, 1.0))
          fvBaseColor = fvReplaceColor;

     gl_FragColor = fvBaseColor;
} 
```

是的，设置着色器确实需要一些额外的时间，但是听起来你正在尝试做的事情，我觉得这是最好的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-26T20:13:14.570

如果您希望您的游戏在现代硬件上运行，那么片段着色器几乎是您唯一的选择，因为调色板纹理已被弃用，并且可能无法在较新的硬件上使用。

您现在拥有的解决方案听起来很合理，尤其是因为它可能在任何地方都可以使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T15:21:15.277

只使用调色板纹理怎么样？有一些[扩展](http://personal.redestb.es/jmovill/opengl/openglonwin-20.html)可以做到这一点。如果使用扩展是不可能的，您可以自己进行调色板处理。只是做你的调色板技巧，有很多，只需使用调色板编写 RGB 纹理。当然，这限制了颜色的数量，但这就是使用调色板的重点。

适合调色板处理的绘图程序现在很少见。这就是为什么我不会从我的驱动器中删除 Deluxe Paint。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T14:39:21.317

您也可以使用模板缓冲区来做一些等效的事情。在您的动画应该发生的位置（=应该具有动画颜色的位置）写入模板缓冲区。然后使用相应的模板操作仅在模板缓冲区的未设置位置上渲染具有正常纹理的框。之后，将动画颜色渲染到相应的颜色中。位置使用不同的模板操作。

我不知道这是否真的会是一种改进——还取决于你掌握数据的方式——但可能不那么“骇人听闻”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-21T14:32:01.813

对于 2D 游戏，我认为使用 ARB_vertex_program 扩展比使用 GLSL 更好。仍然有不支持[GLSL](http://www.kludx.com/capability.php?capability=437)但支持[ARB_fragment_program](http://www.kludx.com/capability.php?capability=435)的 OpenGL 驱动程序。现在不存在对[调色板纹理的支持，但前着色器时代的视频卡可能支持它。](http://www.kludx.com/capability.php?capability=523)请参阅统计链接。

旧的 ARB 语言是一种低级汇编语言，但您可以使用 NVidia 的高级 Cg 语言将着色器编译成这种格式。尽管它是 NVidia 技术，但它适用于所有 GPU。也就是说，如果您是为了自己的娱乐而编写游戏，那么麻烦可能不值得。

# asp.net - 设置为数据源时，IDataReader 是否会自动关闭？

> ID：662444
> 
> 赞同：1
> 
> 时间：2009-03-19T14:36:26.860
> 
> 标签：asp.net, ado.net, idatareader

当您将活动的 IDataReader 对象分配给 Repeater、GridView 等时，它会在 DataBind 方法调用完成后自动关闭，还是我们仍需要自己显式关闭它？

```
this.sampleRepeater.DataSource = ExampleDAL.GetIDataReader();
this.sampleRepeater.DataBind(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T15:53:10.817

使用 DataReader 类型时，连接需要在您访问数据时保持打开状态。这不是一个断开连接的数据源，比如 DataTable。您必须自己关闭它，否则您正在等待它死于自然原因:)。

对替代品感兴趣？将您的数据放入 DataTable、DataSet，或将返回的行转换为自定义对象列表并返回其中之一。

希望有帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:21:11.550

我相信你必须自己关闭它。例如，Repeater 的 DataBind 不会关闭其数据源。如果它不是 IDataSource，那么它只是将其转换为 IEnumerable 并调用 foreach。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T15:47:54.170

我使用反射器检查了中继器的代码，它没有关闭 IDataReader。你必须自己做。

# delphi - 德尔福拖动图像挑战

> ID：662448
> 
> 赞同：1
> 
> 时间：2009-03-19T14:37:23.303
> 
> 标签：delphi, image, drag-and-drop, draggable, vcl

下面的代码使控件（例如标签）在拖动操作时显示拖动图像。

我的问题是我**不想**在拖动开始时立即显示拖动图像，我希望在鼠标位于控件的特定边界时显示图像 - 例如**。**在标签的右半部分。

到目前为止，我还没有找到解决方案 - 图像会立即显示（除非我修改 VCL 源）。在放弃 VCL 拖放实用程序并滚动自定义捕获鼠标之前，我很欣赏在这一点上获得所需行为的任​​何技巧。

这是为标签启用拖动图像的示例伪代码。

```
{ turn on dragging }
Label1.DragMode := dmManual;
Label1.ControlStyle := Label1.ControlStyle + [csDisplayDragImage];

type 
  // VCL needs this for getting drag images..
  TMyDragObject = class(TDragControlObject)
  protected
    function GetDragImages: TDragImageList; override; 
  end;

function TMyDragObject.GetDragImages: TDragImageList;
begin
  Result := Form1.ImageList1;
end;             

procedure TForm1.Label1MouseDown(...);
begin
  { start the dragging manually }
  Label1.BeginDrag(False, 4); // the problem area! image is shown instantly at here!
end;

procedure TForm1.Label1StartDrag(Sender: TObject; var DragObject: TDragObject);
var b : TBitmap;
begin
  ImageList1.Clear;
  DragObject := TMyDragObject.Create(self);

  b := TBitmap.Create;
  try
    b.Width := ImageList1.Width;
    b.Height := ImageList1.Height;
    b.LoadFromFile('/path/to/image');
    ImageList1.Add(b, nil);
  finally
    b.Free;
  end;
end;

procedure TForm1.Label1MouseMove(...);
begin
  if X > Label1.Width div 2 then // right half
    // ??? - do show the drag image
  else
    // ??? - no drage image should be shown
end; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-09T21:41:10.500

将名为 b 的 TBitmap 设为全局变量并删除该行

> > ImageList1.Add(b, nil);

来自 Label1StartDrag 过程并将其放置在 OnDragOverProcedure 中。这将允许 ImageList1 保持空白，直到鼠标移动了指定的四个像素

> > Label1.BeginDrag(False, 4);

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T14:43:35.190

> Label1.DragMode := dmAutomatic;

您是否尝试过使用 dmManual？您应该编写更多代码，但您可以更改更多过程。

顺便说一句，你为什么要改变标准行为？您的用户可能期望该标准，如果程序的行为不同，他们可能会感到沮丧。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-05T23:20:17.150

正如该主题的沉默所暗示的那样，我想我想要的对于默认的 VCL 拖放实用程序来说有点过头了。

无论如何，为了获得想要的效果 - 即对拖动操作有更多的控制，这里有一种方法涉及捕获鼠标和手动处理消息：

```
 SetCapture(Handle);
  try
    while GetCapture = Handle do 
       { Process messages like mouse move, click, etc..
         ie. Change the drag image when the control under cursor changes.. } 
  finally
    if Handle = GetCapture then
      ReleaseCapture;
  end; 
```

# java - Java Swing ActionMap 键

> ID：662457
> 
> 赞同：5
> 
> 时间：2009-03-19T14:39:34.700
> 
> 标签：java, swing

我正在提高 Swing 的学习曲线，并且正在阅读`InputMap`和`ActionMap`. O'Reilly 关于 Swing 的书说 的键`ActionMap`可以是 any `Object`，但按照惯例是`String`s。

是否有任何理由使用 a 以外的对象`String`？（例如一个`enum`）

我认为使用字符串文字是不好的做法，因为它们可能会被错误输入而不会产生任何编译错误。所以我猜测将 ActionMap 键存储为一个不可变的`static final`类变量定义一次（例如`MyAction.NAME`）是一种很好的做法。

**编辑：**为了澄清，我在阅读文档时想到的想法是使用 an`enum`而不是`String`. 我有理由使用 a吗*？*`String`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T14:48:20.873

我不确定你为什么不直接使用枚举（没有看过 O'Reilly 的书），但在这种情况下，我可能宁愿使用 Enum.toString() 方法，如

```
MyActions.NAME.toString() 
```

这节省了定义这么多静态变量的开销，如果您希望存储有关状态的更多信息，让我们扩展 MyActions 枚举的功能，并且它保证每个枚举都有一个唯一的字符串。所有的错别字都有编译时错误。

编辑：Swing 早于枚举。这只是我们方便的包罗万象的答案吗？查看[卡片布局](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/CardLayout.html#addLayoutComponent(java.lang.String,%20java.awt.Component))的 api 。如果曾经有一个设计需要枚举，那就是卡片布局（允许循环浏览要在同一位置显示的组件列表）。我想有些用例可能首选字符串（例如，用户添加的材料），但请继续：大多数时候我将使用某种预定义的状态模式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T13:58:32.827

实际上，您建议的是 Swing 本身（有时）所做的，所以您是对的。

检查 javax.swing.DefaultEditorKit 类。Swing 使用所有这些静态最终字符串来创建 ActionMap。

但是，如果您检查它们的一些外观和感觉的初始化，例如 WindowsLookAndFeel，它们在源代码中也有硬编码的字符串文字。

# .net - 使用 CollectionAssert 对 IList 进行单元测试

> ID：662458
> 
> 赞同：16
> 
> 时间：2009-03-19T14:39:39.660
> 
> 标签：.net, unit-testing, mstest, ilist, icollection

MSTest 框架有一个接受 ICollections 的 CollectionAssert。我的方法返回一个 IList。显然列表不是集合..

有没有办法让我的 IList 成为 ICollection？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T14:43:45.237

您可以在其上调用 ToArray() 扩展方法 - Array 实现 ICollection

编辑：另外，虽然`List<T>`实现了 ICollection，`IList<T>`但只实现`ICollection<T>`了不实现 ICollection 的实现，所以如果你知道测试中的项目是 a `List<T>`，你应该能够转换它......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T18:27:39.167

您可以发送列表

```
 List<string> actual = new List<string>(){"1","2","3"};
    List<string> expected = new List<string>(){"1","2","**EditCaseFalse**"};
    CollectionAssert.AreEqual(actual,expected) 
```

我返回失败（第三个元素不匹配。）

# tomcat - Tomcat 损坏时重新安装 TeamCity

> ID：662461
> 
> 赞同：1
> 
> 时间：2009-03-19T14:40:21.407
> 
> 标签：tomcat, teamcity

我有一个 TeamCity 4 安装，其中 tomcat 用以下错误“在 java.library 路径中找不到允许在生产环境中获得最佳性能的基于 APR 的 Apache Tomcat 本机库”。一旦在服务器上安装了 JDK 以允许编译，这似乎就开始发生了。JDK已被删除并重新安装了JRE，但仍然没有成功。

我的问题是我应该完全重新安装 TeamCity，还是有办法简单地重新安装 tomcat，这样我就不用管配置了？

非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T23:37:10.117

我们继续创建了一个新的 Win 2k8 实例并重新安装。多次重新安装 Team City 和 Apache 永远无法解决问题

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T04:33:04.127

TeamCity 将其数据（包括项目配置）存储在[数据目录](http://www.jetbrains.net/confluence/display/TCD4/TeamCity+Data+Directory)下。即使您删除 Tomcat 并重新安装，它也会使用相同的数据。如果您使用的是外部数据库，您可能需要更改的唯一一件事是将 jdbc 连接器 jar 放入 Web 应用程序 WEB-INF/lib 文件夹。

另外，你提到的APR错误并不是真正的错误，Tomcat默认没有自带APR，你可以根据需要单独安装，但这不是正确运行的必要条件。我们没有在生产 TeamCity 安装中使用 APR。如果要使用 APR，请参阅[Tomcat 文档](http://tomcat.apache.org/tomcat-6.0-doc/apr.html)。

从您最初的问题描述中，不可能说出真正的问题是什么，因为 APR 是绝对可选的，并且默认情况下不安装。不过，Tomcat Windows 服务安装程序有一个自动安装 APR 的选项：

[可选的 APR 安装 http://img395.imageshack.us/img395/5233/snap619.png](http://img395.imageshack.us/img395/5233/snap619.png)

如果您再次遇到问题，我建议您参考[报告问题](http://www.jetbrains.net/confluence/display/TCD4/Reporting+Issues)文档。

# python - 根据值字典编写一个包含空单元格的表格

> ID：662463
> 
> 赞同：1
> 
> 时间：2009-03-19T14:40:44.900
> 
> 标签：python, django, django-templates

我的应用程序中有这个视图：

```
def context_detail(request, context_id):
c = get_object_or_404(Context, pk=context_id)
scs = SherdCount.objects.filter(assemblage__context=c).exclude(count__isnull=True)
total = sum(sc.count for sc in scs)
table = []
forms = []
for a in c.assemblage_set.all():
    for sc in a.sherdcount_set.all():
        forms.append(sc.typename)
forms_set = set(forms)
for a in c.assemblage_set.all():
    diko = {}
    diko['assemblage'] = a
    for f in forms_set:
        for sc in a.sherdcount_set.all():
            if f == sc.typename:
                diko[f] = sc.count
            else:
                diko[f] = 0
    table.append(diko)
return render_to_response('tesi/context_detail.html',
    {'context': c, 'total': total, 'sherdcounts': scs, 'table': table, 'forms': forms_set},
    context_instance=RequestContext(request)) 
```

两个 for 循环的目的是创建一个字典列表，其中包含参考 SherdCount.typename 外键的 SherdCount.count 值（我能够做到这一点，即使当前代码有点混乱向上）。

“表”列表应包含如下内容：

```
[{<Type: Hayes 61B>: 0, <Type: Hayes 99A-B>: 0, <Type: Hayes 105>: 0, <Type: Hayes 104A>: 0, <Type: Hayes 104B>: 0, <Type: Hayes 103>: 0, <Type: Hayes 91>: 0, <Type: Hayes 91A>: 0, <Type: Hayes 91B>: 0, <Type: Hayes 91C>: 0, <Type: Hayes 91D>: 0, <Type: Hayes 85B>: 0, <Type: Hayes 82A>: 0, <Type: Hayes 76>: 0, <Type: Hayes 73>: 0, <Type: Hayes 72>: 0, <Type: Hayes 70>: 0, <Type: Hayes 68>: 0, <Type: Hayes 67>: 0, <Type: Hayes 66>: 0, <Type: Hayes 62A>: 0, <Type: Hayes 80B>: 0, <Type: Hayes 59>: 0, <Type: Hayes 61A>: 0, <Type: Hayes 91A-B>: 0, <Type: Hayes 58>: 0, <Type: Hayes 50>: 0, <Type: Hayes 53>: 0, <Type: Hayes 71>: 0, <Type: Hayes 60>: 0, <Type: Hayes 80A>: 0, <Type: Hayes Style A2-3>: 0, <Type: Hayes Style B>: 0, <Type: Hayes Style E1>: 1, 'assemblage': <Assemblage: Brescia, Santa Giulia : non periodizzato>}, {<Type: Hayes 61B>: 0, <Type: Hayes 99A-B>: 0, <Type: Hayes 105>: 0, <Type: Hayes 104A>: 0, <Type: Hayes 104B>: 0, <Type: Hayes 103>: 0, <Type: Hayes 91>: 0, <Type: Hayes 91A>: 0, <Type: Hayes 91B>: 0, <Type: Hayes 91C>: 0, <Type: Hayes 91D>: 0, <Type: Hayes 85B>: 0, <Type: Hayes 82A>: 0, <Type: Hayes 76>: 0, <Type: Hayes 73>: 0, <Type: Hayes 72>: 0, <Type: Hayes 70>: 0, <Type: Hayes 68>: 0, <Type: Hayes 67>: 0, <Type: Hayes 66>: 0, <Type: Hayes 62A>: 0, <Type: Hayes 80B>: 0, <Type: Hayes 59>: 0, <Type: Hayes 61A>: 0, <Type: Hayes 91A-B>: 0, <Type: Hayes 58>: 0, <Type: Hayes 50>: 0, <Type: Hayes 53>: 0, <Type: Hayes 71>: 0, <Type: Hayes 60>: 0, <Type: Hayes 80A>: 0, <Type: Hayes Style A2-3>: 0, <Type: Hayes Style B>: 3, <Type: Hayes Style E1>: 0, 'assemblage': <Assemblage: Brescia, Santa Giulia : Periodo IIIA>}, 
```

但是许多 0 值显然是错误的。即使可能有一些零（我指的是空单元格）

问题是，一旦我建立了这样一个列表，我如何在模板中创建一个包含所有单元格的表格（例如，每个类型 1 行，每个上下文 1 列，SherdCount 在单元格）？

斯特科

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T18:25:34.837

这是数据结构。

```
[{<Type1>: 16,
  <Type2>: 10,
  <Type3>: 12,
  <Type4>: 7,
  <Type5>: 0,
  'assemblage': <Assemblage1>},
 {<Type1>: 85,
  <Type2>: 18,
  <Type3>: 21,
  <Type4>: 12,
  <Type5>: 2,
  'assemblage': <Assemblage2>},
 ...] 
```

问题是结果表必须按行顺序生成，而这个字典列表是按列顺序的。因此，必须将字典列表转换为行优先顺序。

```
from collections import defaultdict
titles = []
cells = defaultdict(list)
for x,col in enumerate(table):
    titles.append( col['assemblage'] )
    for rk in col:
        if rk == 'assemblage': continue # skip the title
        cells[rk][x]= col[rk] 
```

此外，它有助于将结果形式化为列表列表；字典没有内在的顺序。

```
final= []
for name in sorted( cells.keys() ):
    final.append( cells[name] ) 
```

这是要渲染`titles`和`final`作为表格的模板。

```
<table>
  <tr>
    {% for t in titles %}<th>{{t}}</th>{% endfor %}
  </tr>
  {% for row in final %}
  <tr>
      {% for cell in row %}<td>{{cell}}</td>{% endfor %}
  </tr>
  {% endfor %}
</table> 
```

# http - 逆向工程 windows mobile live search CellID 位置感知协议 (yikes)

> ID：662464
> 
> 赞同：0
> 
> 时间：2009-03-19T14:41:12.917
> 
> 标签：http, windows-mobile, reverse-engineering, cellular-network

我不确定如何提出问题，所以如果标题具有误导性，我深表歉意。此外，您可能想喝杯咖啡并为此坐下……它很长。

基本上，我正在尝试对 Windows Mobile Live Search 应用程序使用的协议进行逆向工程，以根据 cellID 获取位置。在继续之前，我知道其他开源服务（例如 OpenCellID），但这更多是为了教育和冗余。

根据我捕获的数据包，发出 POST 请求以...

```
mobile.search.live.com/positionlookupservice_1/service.aspx 
```

...带有一些特定的标头（代理、内容长度等）并且没有正文。一旦完成，服务器会发回 100-Continue 响应。此时，应用程序提交了这个数据（我剪掉了数据包头）：

```
 00 00 00 01 00 00 00 05 55 54         ........UT
46 2d 38 05 65 6e 2d 55 53 05 65 6e 2d 55 53 01   F-8.en-US.en-US.
06 44 65 76 69 63 65 05 64 75 6d 6d 79 01 06 02   .Device.dummy...
50 4c 08 0e 52 65 76 65 72 73 65 47 65 6f 63 6f   PL..ReverseGeoco
64 65 01 07 0b 47 50 53 43 68 69 70 49 6e 66 6f   de...GPSChipInfo
01 20 06 09 43 65 6c 6c 54 6f 77 65 72 06 03 43   . ..CellTower..C
47 49 08 03 4d 43 43 b6 02 07 03 4d 4e 43 03 34   GI..MCC....MNC.4
31 30 08 03 4c 41 43 cf 36 08 02 43 49 fd 01 00   10..LAC.6..CI...
00 00 00                                          ... 
```

并在响应中接收到这个（数据包和 HTTP 响应标头被截断）：

```
 00 00 00 01 00 00 00 00 01 06 02 50 4c      ...........PL
06 08 4c 6f 63 61 6c 69 74 79 06 08 4c 6f 63 61   ..Locality..Loca
74 69 6f 6e 07 03 4c 61 74 09 34 32 2e 33 37 35   tion..Lat.42.375
36 32 31 07 04 4c 6f 6e 67 0a 2d 37 31 2e 31 35   621..Long.-71.15
38 39 33 38 00 07 06 52 61 64 69 75 73 09 32 30   8938...Radius.20
30 30 2e 30 30 30 30 00 42 07 0c 4c 6f 63 61 6c   00.0000.B..Local
69 74 79 4e 61 6d 65 09 57 61 74 65 72 74 6f 77   ityName.Watertow
6e 07 16 41 64 6d 69 6e 69 73 74 72 61 74 69 76   n..Administrativ
65 41 72 65 61 4e 61 6d 65 0d 4d 61 73 73 61 63   eAreaName.Massac
68 75 73 65 74 74 73 07 10 50 6f 73 74 61 6c 43   husetts..PostalC
6f 64 65 4e 75 6d 62 65 72 05 30 32 34 37 32 07   odeNumber.02472.
0b 43 6f 75 6e 74 72 79 4e 61 6d 65 0d 55 6e 69   .CountryName.Uni
74 65 64 20 53 74 61 74 65 73 00 00 00            ted States... 
```

现在，这是我到目前为止所确定的：

*   所有字符串都以一个字节作为其长度的十进制等效值。

*   在整个请求和响应中似乎使用了三种不同的强制转换。它们显示为长度字节之前的一个字节。我得出的结论是，这三种类型的映射如下：

    1.  0x06 - 父元素（后续值为子元素，以 0x00 结束）
    2.  0x07 - 字符串
    3.  0x08 - 整数？

基于这些确定，以下是请求和响应以更易读的方式呈现的样子（括号括起来的值表示长度，括号括起来的值表示强制转换）：

```
\0x00\0x00\0x00\0x01\0x00\0x00\0x00
[5]UTF-8
[5]en-US
[5]en-US
\0x01
[6]Device
[5]dummy
\0x01
(6)[2]PL
  (8)[14]ReverseGeocode\0x01
  (7)[11]GPSChipInfo[1]\0x20
  (6)[9]CellTower
    (6)[3]CGI
      (8)[3]MCC\0xB6\0x02         //310
      (7)[3]MNC[3]410             //410
      (8)[3]LAC\0xCF\0x36         //6991
      (8)[2]CI\0xFD\0x01          //259
    \0x00
  \0x00
\0x00
\0x00 
```

和..

```
\0x00\0x00\0x00\0x01\0x00\0x00\0x00
\0x00\0x01
(6)[2]PL
  (6)[8]Locality
    (6)[8]Location
      (7)[3]Lat[9]42.375621
      (7)[4]Long[10]-71.158938
    \0x00
    (7)[6]Radius[9]2000.0000
  \0x00
  \0x42     //"B" ... Has to do with GSM
  (7)[12]LocalityName[9]Watertown
  (7)[22]AdministrativeAreaName[13]Massachusetts
  (7)[16]PostalCodeNumber[5]02472
  (7)[11]CountryName[13]United States
\0x00
\0x00\0x00 
```

除了以下几点外，我的分析似乎效果很好：

1.  整个 0x01 让我感到困惑……起初我以为它们是某种基本级别的元素终止符，但我不确定。
2.  我不确定 7 字节标头实际上是 7 字节标头。我想知道它是否可能是 4 个字节，剩下的三个 0x00 是否具有其他意义。
3.  尾随 0x00s。为什么请求中只有一个，响应中只有两个？
4.  上面提到的类型 8 转换......我似乎无法弄清楚这些值是如何编码的。我在这些行中添加了值*应该*对应的注释。

任何关于这四点的建议将不胜感激。

是的，这些数据包是在马萨诸塞州沃特敦捕获的。:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-29T18:30:36.833

我还没有阅读您的所有故障，但您可能想查看[这个](http://www.codeproject.com/KB/mobile/DeepCast.aspx)似乎已经破坏了 google celltower to location API 的代码项目。看起来它正在将 celltower ID 吐出到它的组件中，就像实时搜索请求所需的一样。

也许这会对你有所帮助。

# c - 为什么我的 setenv() 包装器不起作用？

> ID：662466
> 
> 赞同：3
> 
> 时间：2009-03-19T14:42:03.617
> 
> 标签：c, setenv

我有下面的方法，它正确地将 ret 值设置为 0（表示 setenv 中的成功），但是当我检查这个环境变量是否实际设置时，它不存在。为什么会发生这种情况？

```
 void Class::mysetenv(char* a, char* b)                           
     {   
         if(a==0 || b==0)
             return;

         int ret = setenv(strdup(a), strdup(b), 1);
         printf("ret: %d %s %s\n", ret, a, b);                          
     } 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T14:47:00.550

您的功能泄漏。的联机帮助页`setenv`说：

> 此函数复制名称和值所指向的字符串

因此，在将它们传递给它之前，您不必自己复制它们。

您是否从外壳中执行这样的程序？

```
./a.out FOO 42 
```

好了，那么环境变量就会被设置为被执行的进程（`a.out`），并被继承给它启动的进程。但它不会“冒泡”到执行的 shell 中`a.out`。这也是为什么诸如`set`or之类的命令`export`是 shell 内置而不是真正的程序的原因。在 bash 中签出“帮助导出”。

# vb.net - INSERT 查询超时过期

> ID：662477
> 
> 赞同：0
> 
> 时间：2009-03-19T14:43:59.713
> 
> 标签：vb.net, sql-server-2005

我正在尝试在事务中使用简单的 INSERT 查询在表中插入一行。它在 SQL Server 中运行良好，但我无法使用我的业务对象插入数据。

我使用以下命令调用 SELECT 查询：

```
Using cm As New SqlCommand
    With cm
        .Connection = tr.Connection
        .Transaction = tr
        .CommandType = CommandType.Text
        .CommandText = Some Select Query
        .ExecuteScalar()
         '' Do something

        .CommandText = Insert Query
        .ExecuteNonQuery()
    End With
End Using 
```

我在“.ExecuteNonQuery()”行收到超时期限过期错误。

此时任何其他 DML 查询都运行良好。

谁能告诉我原因？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T04:06:41.413

It looks like your query is using a bad query plan. Try setting ARITHABORT ON and that should bypass the query plan:

```
Dim arithabortCmd As New SqlCommand("SET ARITHABORT ON", cn)
arithabortCmd.ExecuteNonQuery() 
```

I would make sure the database indexes are updated by executing this SQL on the database:

```
-- Execute this to rebuild all for a given database. Replace the <databasename> after EXEC.
EXEC <databasename>..sp_MSforeachtable @command1='DBCC DBREINDEX (''*'')', @replacechar='*' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T14:49:32.477

Management Studio 将其连接设置为不超时，这可以解释为什么它在那里工作。您可以在代码中通过将连接的属性设置为 0 来执行此操作。但是，除非您*是认真*`.Timeout`的，否则不建议这样做。

 *相反，我们需要弄清楚是什么花了这么长时间。Management Studio 查询是否需要很长时间才能完成？它可以等待事务提交吗？你能分析一下应用程序在哪里花费时间吗？

# java - 用 Java 将 XML 文档保存在数据库中（Hibernate 和 JAXB 的组合）

> ID：662481
> 
> 赞同：3
> 
> 时间：2009-03-19T14:45:35.717
> 
> 标签：java, xml, hibernate, annotations, jaxb

我正在寻找一种使用 Hibernate 将 XML 文件保存在数据库中的解决方案。

问题是，XML 文件的结构与 Hibernate-beans 不同。

我正在尝试使用 JAXB 将 XML 内容序列化为 Hibernate bean。

请想象以下场景： 有这个 xml 文件：

```
<root>    
    <general>
        <property1/>          
        <property2/>
    </general>
    <details>
        <detail1>
        <detail2>
</root> 
```

现在我想将 property1 和 detail1 保存在一个 bean 中：

```
@Entity
@Table(name = "tablename")
class Bean(){
    public String property;
    public String detail;

    //+ getters and  setters ...

} 
```

有谁知道我可以使用哪些 JAXB 注释来解决该问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T16:57:15.983

Is it mandatory to do it that way? Hibernate is a persistence API which is intented not to care about how data is stored in no matter what DBMS engine or XML files. It is a framework to *persist* your objects. But it does not stop there, since you can run queries (pseudo SQL or through Criteria API), what results altogether in fact in an objet oriented data storage.

JAXB is a different monster, since it is intended to persist the objects in XML format, defined by a XSD-Schema, so resulting data can be exchanging between systems sharing the same model.

If storing your data in XML format is important for you, since you work with XML, maybe it has more sense to use a XML native database such as [eXist](http://exist.sourceforge.net/), which lets you access and transform your XML data in a XML-friendly way (XSLT, XQuery, XPath).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T18:38:40.093

看起来您正在尝试解决错误的问题。

简而言之，数据库可以将 XML 存储为 CLOB 或 XML 数据类型（基本上是 clob 的扩展）

在这种情况下，您可以将适当的 LOB 处理程序映射到 hibernate 对象中的字符串或 byte[] 字段（表示完整的 xml 文档）。

但是，在您的情况下，您似乎想将 bean 编组/解组到 XML 和来自 XML ......这可以通过多个框架/库来完成；如果您使用的是休眠，真的没关系。

只需为转换过程创建一些静态工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T10:37:22.053

我刚刚完成了与我所做的相同类型的解决方案，即使用 hibernate 和 XStream 与 xstream 我在我的类和字段上使用注释 XStreamAlias("") 并将它们映射到实际的 xml 文档并通过 xstream 运行它们.fromXML() 及其创建bean然后将bean插入数据库

一些代码

```
@XStreamAlias("task")
public class Task {

    @XStreamOmitField
    private Long id;

    @XStreamAlias("subject-type")
    private String subject;

    @XStreamAlias("body")
    private String body;

    @XStreamAlias("frame")
    private String timeframe;

    @XStreamAlias("due-at")
    private String due;

    @XStreamAlias("alert-at")
    private String alarm;

    /** Getters/Setters **/
}

<?xml version="1.0"?>
<tasks>
    <task>
        <subject-type></subject-type>
        <body>A task for today</body>
        <frame>today</frame>
        <due-at type="datetime"></due-at>
        <alert-at type="datetime"></alert-at>
    </task>
</tasks>

// Test Case
        File xml = new File("xmlfile.xml");

        XStream xstream = new XStream();

        xstream.processAnnotations(new Class[]{ Task.class });
        xstream.alias("tasks", ArrayList.class);

    List tasks = (List)xstream.fromXML(new FileReader(xml)); 
```

# database - 您会将二进制数据存储在数据库中还是文件系统中？

> ID：662488
> 
> 赞同：44
> 
> 时间：2009-03-19T14:47:18.677
> 
> 标签：database, binary-data

这是一个之前已经提出的问题（[large-text-and-images-in-sql](https://stackoverflow.com/questions/525690/large-text-and-images-in-sql)），但主要针对将要更改的数据。在我的情况下，数据将被存储并且永远不会改变。将所有东西放在一起似乎是明智的。

为什么我不应该将静态二进制数据存储在数据库中？

假设这是明智之举，将此类数据存储在单独的表中是否有任何优势？（你现在可能开始意识到我不是数据库专家......）

澄清：可能不会超过 10-20 个用户，但这些用户将在美国和英国。在任何情况下都必须传输二进制数据。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-19T14:50:34.363

将数据存储在数据库中的优势在于利用数据库安全机制并降低维护成本（备份，...）。它的缺点是增加了数据库负载和消耗连接（这对于每个连接许可的数据库服务器可能很昂贵）。如果您使用的是 SQL Server 2008，[`FILESTREAM`](http://technet.microsoft.com/en-us/library/bb933993.aspx)可能是一个不错的选择。

顺便说一句，对于 Web 应用程序（或任何其他可能需要流式传输数据的应用程序），将数据存储在 DB 之外通常更明智。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-06-08T17:44:59.570

当表中包含 LOB 时，所有这些关于执行“从表中选择 *”会导致巨大的内存和/或带宽问题的讨论都不是问题。返回的只是一个指向相关 LOB 的指针。没有足够的声誉将评论放在上下文中，但看到这个的人应该知道这不是问题。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-19T14:57:46.343

如果要存储 BLOBS，最大的缺点是内存消耗。你能想象 select * from x 会对每条 45k 图像的数千条记录做什么吗？

正如 Mehrdad 所说，这也有优势。因此，如果您决定采用这种方法，您应该尝试设计您的数据库，以便大多数查询返回较少的结果，其中包含 BLOB 数据。也许例如为此目的建立一对一的关系。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-19T16:26:47.773

我熟悉一个规模相当大的 OSS 项目，该项目一开始就决定将图像存储在 MySQL 数据库中，并且它被证明是他们一直在应对的三大坏主意之一。（“无情地重构”是一种诅咒，但这是另一回事。）

这导致的严重问题包括：

1.  超过最大有效数据库大小 (mysql)。（图像所需的总空间超过所有其他空间至少 2 个数量级）。

2.  图像文件失去了它们的“文件性”。除非存储（冗余）为日期（需要管理代码），否则没有日期大小等。

3.  无论是存储还是操作，任意字节序列都不能一直很好地处理。

4.  “我们永远不需要从外部访问图像”是一个危险的假设。

5.  脆弱性。因为整个安排是不自然的和敏感的，你不知道它接下来会咬到哪里（助长了反重构的心态）。

好处？没有我能想到的，除了它可能是当时阻力最小的路径。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-06-10T12:54:32.530

从原理的角度解决这个问题，关系数据库（主要）用于存储结构化数据。如果您无法在数据元素上创建查询条件或连接，则它可能不属于数据库。我没有看到 WHERE 子句中使用了图像 BLOB，所以我会说将其保留在数据库之外。另一方面，CLOB 可用于查询。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-19T15:09:25.410

我认为这取决于您的建筑物的应用程序。如果您正在构建一个 CMS 系统，并且数据的用途是在 Web 浏览器中显示图像，那么将图像保存到磁盘而不是放入数据库中可能是有意义的。虽然老实说我会同时做这两个，这可以允许将服务器添加到农场，而不必在整个地方复制文件。

另一个用例可能是一个复杂的对象，例如工作流，甚至是一个具有大量相互依赖关系的业务对象。您可以将这两者序列化为二进制或基于文本的格式，并将它们保存在数据库中。然后你会得到 DB 的好处：ATOMIC、Backups 等等……

我认为人们不应该首先使用`select *`查询。您所做的是提供两种获取数据的方法，一种方法返回摘要信息，第二种方法将返回 blob。我无法想象为什么您需要一次返回数千张图像。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-05-02T02:35:56.633

任何想在数据库中存储图像（或其他二进制文档）的人都不是我很满意的人。数据库用于存储 [主要是？] INDEXABLE、DISCRETE 数据。不是无意义的二进制数据的 BLOB。如果您亲身使用 BLOB 处理二进制数据，那么您已经知道这一点。

您应该在文件系统中存储对该文件的引用。最佳实践是文件名，而不是绝对（甚至相对）路径。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-19T15:01:00.327

这不正是 LOB 或 CLOB 或 .... 的设计目的吗？

我们使用 CLOB 存储大型航空公司系统的信用卡交易的大量加密。

内存消耗是你最大的罪魁祸首。

高温高压

干杯，

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-19T15:55:40.860

我们将附件存储在我们的系统中，您无法更改附件，因此我认为我们在同一页面上的数据“将被存储且永不更改”。我们特别决定*不*将其存储在数据库中。我们这样做有两个原因，简单性和备份/恢复时间。

简单第一：在我们的例子中，这些附件是从最终用户的浏览器上传的，将它们写入一个目录（在数据库服务器上）比然后将它们流式传输到 SQL 管道更简单。数据库中有它们的记录，但数据库只包含有关附件的元信息，以及磁盘上文件的名称（在我们的例子中是一个 guid）

在备份/恢复方面：这些 blob 可能会成为数据库中最大的部分之一。每当您运行完整备份时，您将一遍又一遍地复制这些位，即使您知道那时永远不会改变。对我们来说，拥有（很多）较小的备份似乎要简单得多，并将附件目录的 xcopy 复制到辅助服务器作为备份。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-19T15:14:03.790

某些数据库（例如 Postgresql）会自动压缩字段，直接从 db 读取字段可能会更快。而且，该程序可以一口气读取所有字段和图像。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-19T16:07:48.723

这里的性能问题如上所述，所以我不会重复它。但是我认为，如果您要存储大量流出的内容（例如网站上的图像/文档），那么构建缓存系统是一个很好的建议。

我的意思是将所有数据存储在您的数据库中，但是当有人请求该文件时，检查它是否存在于磁盘上（基于已知文件名，在临时文件夹中），如果不存在，则从数据库中获取它并将其写入文件夹，然后将其流式传输给用户。对于同一文件的下一个请求，由于它存在于磁盘上，因此可以从那里提供服务而无需访问数据库。但是，如果您需要删除这些文件（或者您的网络服务器出现问题！），这并不重要，因为它们会在人们请求它们时从数据库中再次重建。这应该比为来自数据库的同一文件的每个请求提供服务要快得多。

# jakarta-ee - 是否可以通过不同的 EJB 模块进行 EJB 继承？

> ID：662490
> 
> 赞同：0
> 
> 时间：2009-03-19T14:48:02.997
> 
> 标签：jakarta-ee, eclipselink

是否有可能拥有一个从另一个 ejb 模块的另一个（抽象）实体类继承的实体类？

例如 EclipseLink 不会在子类的数据库表中创建依赖列。它只是忽略了（抽象的）超类实体。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-23T09:58:05.133

该注释`@Entity`在我的项目中不起作用，但`@MappedSuperclass`也是 JPA 1.0 一部分的注释现在运行良好。

# java - 用于查看 Word 文档的小程序

> ID：662491
> 
> 赞同：0
> 
> 时间：2009-03-19T14:48:12.217
> 
> 标签：java, ms-word, applet

如何在 IE 中打开 Word 文档而不在 Java 小程序中打开/保存对话框？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-22T03:25:40.793

这可以通过使用 Java-COM 桥加载 MS Word ActiveX 控件的签名小程序来完成。FWIW，我使用 ComfyJ，一个商业 Java JNI 库来做到这一点。显然它只适用于已经安装了 MS Word 的 Windows 客户端计算机。它的想法让我的脊椎不寒而栗，然而……这几乎可以肯定是一个坏主意。

# citrix - 关于 Citrix 的水晶子报告

> ID：662499
> 
> 赞同：0
> 
> 时间：2009-03-19T14:50:30.260
> 
> 标签：citrix

我们有一个 Crystal Report（v8.5 - 是的，我知道它很旧！），其中包含子报告，在尝试在 Citrix 上运行时会出现问题（由我们的一位客户提供）。这似乎是因为子报表在设计时保留了对原始 Access 数据库位置的硬编码引用。例如，后者位于 C:\xyz\abc。不幸的是，我们无法通过简单地将虚拟 Access 文件复制到此位置来愚弄它，因为 Citrix 用户实际上并没有“看到”C：驱动器！（至少这是我的理解 - 事实证明，很难找到 Citrix 环境的基本操作原理。有没有人遇到过这个问题并找到了解决方案？（或者找到任何提供 Citrix 环境基本指导的网站？）

谢谢克里斯
L

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T15:02:08.623

目标访问数据库在哪里？它在某个地方的网络驱动器上吗？

我对访问数据库和水晶几乎没有经验，但我认为您应该能够去“设置数据源位置”并更新访问表以指向正确的路径。

关于水晶和 citrix，我要说的一件事是，您不应该在同一个 citrix 盒子上运行不同版本的水晶。这让我们很头疼！

我知道[Citrix 论坛](http://support.citrix.com/search/forum/?searchQuery=crystal+report&search.x=14&search.y=13&search=Go&categoryId=c150)不止一次地帮助了我……

# java - 如何将 Java 对象作为参数传递给 MATLAB 函数？

> ID：662502
> 
> 赞同：1
> 
> 时间：2009-03-19T14:51:16.717
> 
> 标签：java, matlab

我写了一个 Matlab 类来使用 JDBC 和 java.sql 中的东西来实现一个数据库。

我需要知道 ResultSet 中有多少个结果，所以我编写了以下 Matlab 静态函数：

```
methods (Static)

    function [numRecords] = numRecords(resultSet)
        numRecords = 0;
        if (~isempty(resultSet))
            row = resultSet.getRow();
            resultSet.beforeFirst();
            resultSet.last();
            numRecords = resultSet.getRow();
            resultSet.absolute(row);
        end
    end

end 
```

但是当我尝试调用它时，我收到以下错误消息：

？？？'org.apache.derby.impl.jdbc.EmbedResultSet40' 类型的输入参数的未定义函数或方法'numRecords'

没有其他称为 numRecords 的函数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T20:46:39.497

当我写最初的问题时，我意识到我的错误。

显然，在 Matlab 类中，调用静态函数需要将封闭类添加到函数之前……即使是从同一个类中调用！

我换了行：

```
trials = zeros(numRecords(rs)); 
```

和

```
trials = zeros(CMAPSigSimResultsDB.numRecords(rs)); 
```

它奏效了。（好吧，它没有，但它至少调用了这个函数。）

这是一个令人困惑的错误消息，因为不应键入 Matlab，但它听起来像是......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:08:12.930

您应该能够像对待任何其他变量/对象一样在 MATLAB 中处理 Java 对象。您可以像这样创建 Java 对象：

```
myDate = java.util.Date; 
```

然后将该对象传递给函数：

```
myFcn(myDate,...other input arguments...); 
```

有关更多信息，您可以查看[MATLAB 文档](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_external/f4873.html)。

**编辑：**

不言而喻，但您应该避免为函数**myFcn**赋予与您传入的 Java 对象的任何方法相同的名称（即*重载*）。[正如另一个问题](https://stackoverflow.com/questions/656014/how-to-avoid-ambiguity-when-calling-java-from-matlab)和[我对它的回答](https://stackoverflow.com/questions/656014/how-to-avoid-ambiguity-when-calling-java-from-matlab/656315#656315)所说明的那样，实际调用哪个重载函数可能会让人感到困惑。

# shortcut - 有没有办法更改桌面上的网络快捷方式/书签图标

> ID：662503
> 
> 赞同：0
> 
> 时间：2009-03-19T14:51:38.510
> 
> 标签：shortcut, bookmarks

我想知道是否有一种方法可以在桌面上创建一个 Web 快捷方式，并使用从 FavIco.ico 加载的图标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T14:58:14.767

右键单击桌面并选择新建 > 快捷方式。在“键入项目的位置”的文本字段中输入 url。创建快捷方式后，它将使用站点中的图标。

如果您随后在记事本中打开此链接，您将看到“IconFile”属性设置为该站点的 favicon.ico。

# java - 如何在 Java 中使用泛型转换列表？

> ID：662508
> 
> 赞同：27
> 
> 时间：2009-03-19T14:53:23.577
> 
> 标签：java, generics, casting

请考虑以下代码段：

```
public interface MyInterface {

    public int getId();
}

public class MyPojo implements MyInterface {

    private int id;

    public MyPojo(int id) {
        this.id = id;
    }

    public int getId() {
        return id;
    }

}

public ArrayList<MyInterface> getMyInterfaces() {

    ArrayList<MyPojo> myPojos = new ArrayList<MyPojo>(0);
    myPojos.add(new MyPojo(0));
    myPojos.add(new MyPojo(1));

    return (ArrayList<MyInterface>) myPojos;
} 
```

return 语句执行不编译的强制转换。如何将 myPojos 列表转换为更通用的列表，**而不必遍历列表中的每个项目**？

谢谢

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-19T14:55:58.297

更改您的方法以使用通配符：

```
public ArrayList<? extends MyInterface> getMyInterfaces() {    
    ArrayList<MyPojo> myPojos = new ArrayList<MyPojo>(0);
    myPojos.add(new MyPojo(0));
    myPojos.add(new MyPojo(1));

    return myPojos;
} 
```

这将阻止调用者尝试将接口的*其他*实现添加到列表中。或者，您可以只写：

```
public ArrayList<MyInterface> getMyInterfaces() {
    // Note the change here
    ArrayList<MyInterface> myPojos = new ArrayList<MyInterface>(0);
    myPojos.add(new MyPojo(0));
    myPojos.add(new MyPojo(1));

    return myPojos;
} 
```

正如评论中所讨论的：

*   返回通配符集合对调用者来说可能很尴尬
*   通常最好使用接口而不是返回类型的具体类型。所以建议的签名可能是以下之一：

    ```
    public List<MyInterface> getMyInterfaces()
    public Collection<MyInterface> getMyInterfaces()
    public Iterable<MyInterface> getMyInterfaces() 
    ```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-19T20:35:42.027

从一开始就选择正确的类型是最好的，但是要回答您的问题，您可以使用类型擦除。

`return (ArrayList<MyInterface>) (ArrayList) myPojos;`

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T14:56:16.830

你应该这样做：

```
public ArrayList<MyInterface> getMyInterfaces() {   
   ArrayList<MyInterface> myPojos = new ArrayList<MyInterface>(0);    
   myPojos.add(new MyPojo(0));    
   myPojos.add(new MyPojo(1));    
   return myPojos;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T14:58:12.613

在这种情况下，我会这样做：

```
public ArrayList<MyInterface> getMyInterfaces() {

    ArrayList<MyInterface> myPojos = new ArrayList<MyInterface>(0);
    myPojos.add(new MyPojo(0));
    myPojos.add(new MyPojo(1));

    return myPojos;
} 
```

MyPojo 是 MyInterface 类型的（因为它实现了接口）。这意味着，您可以使用所需的接口创建列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T16:06:10.163

尝试在任何地方使用接口，除了在构造实例时，你的问题就会消失：

```
public List<MyInterface> getMyInterfaces()
{
    List<MyInterface> myInterfaces = new ArrayList<MyInterface>(0);
    myInterfaces.add(new MyPojo(0));
    myInterfaces.add(new MyPojo(1));

    return myInterfaces;
} 
```

正如其他人已经说过的那样，使用 MyInterface 可以解决您的问题。对于返回类型和变量，最好使用 List 接口而不是 ArrayList。

# sql - 您将如何对通用方案的数据变量方差进行建模？SQL

> ID：662514
> 
> 赞同：2
> 
> 时间：2009-03-19T14:55:05.617
> 
> 标签：sql, mysql, database, database-design, normalization

我最近在考虑一些事情，我想知道做类似以下场景的正确方法是什么（我相信对于 DB 人来说做类似的事情是很常见的事情）。

假设您有一个产品表，如下所示（MySQL）：

```
CREATE TABLE `products` (
  `id` int(11) NOT NULL auto_increment,
  `product_name` varchar(255) default NULL,
  `product_description` text,
  KEY `id` (`id`),
  KEY `product_name` (`product_name`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8; 
```

这里没有什么不寻常的。现在假设在不同的表中有一个类别的层次结构，并且有一个单独的表将多对多关系与 products 表绑定 - 这样每个产品都属于某种类别（我将省略那些，因为这不是这里的问题）。

现在到了有趣的部分——如果每个类别都要求产品项目附加一组变量。例如，计算机显示器类别中的产品必须具有 LCD/CRT 枚举字段、屏幕尺寸枚举等 - 以及其他一些类别，假设冰淇淋有一些其他变量，如风味 varchar、货架存储时间 int 等。

这里的问题在于所有产品都有一组共同的变量（id、name、description 和类似的），但是还有其他变量在类别之间不一致 - 但所有产品都应该共享共同的集合，因为最后它们都属于产品组，因此可以查询例如 SELECT * FROM products ORDER BY company_id （琐碎的例子，可能不具有代表性，但你明白了）。

现在，我看到了几个潜在的解决方案：
- 为每个产品类别生成单独的表，并在其中存储带有适当附加变量的产品 - 愚蠢且查询不友好

- 产品表与公共变量保持相同，并为每个类别创建一个单独的表，其中包含额外的将两个表与 JOIN 绑定的变量 - 标准化，但查询性能和清晰度问题 - 如何从类别中过滤产品（第一个表 - 产品）和额外的变量过滤器（即 17 英寸 LCD 显示器） - 它需要 SQL JOIN 技巧

- 产品表保持不变并添加另一个变量类型文本，例如包含其他变量的 JSON 数据 - 紧凑且整洁，但无法使用 SQL 过滤变量

我知道我在这里遗漏了一些非常明显和简单的东西——我对标准化技术有点生疏了:)

* * *

*编辑：*在没有成功提出这个问题之前，我一直在搜索 stackoverflow。然而，在我发布问题后，我点击了我的一个标签“规范化”，发现了几个类似的问题，导致查找“泛化专业化关系设计”。故事的重点是，这一定是我的互联网生活中第一次出现标签在搜索中真正有用的情况。但是，我仍然想听听你们的意见和意见。

* * *

*编辑*2：方法 2 的问题是我希望大约 1000 个专业化。类别有一个层次结构（1-4 级深），端节点添加了专门的变量 - 它们以大约 1000 个的顺序累积，因此添加专门的表来连接有点不切实际。

* * *

**编辑3**：由于在我的案例中存在大量属性波动，建议的“实体属性值”看起来像是要走的路。查询噩梦来了！多谢你们。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T16:06:20.070

您期望有多少种产品类型？他们每个人都有自己的应用程序逻辑吗？

您可以创建一个称为“实体属性值”模型的通用模型，但是当您尝试处理产品的特定属性时，它有很多陷阱。简单的搜索查询有时会变成真正的噩梦。基本思想是您有一个包含产品 ID、属性名称（或属性表中的 ID）和值的表。您还可以添加表格以保存每种产品类型的模板。因此，一组表会告诉您任何给定产品它可以具有的属性（可能还有有效的值范围），而另一组表会告诉您任何单个产品的值是什么。

不过，我会强烈警告不要使用此模型，因为在您必须实际实施之前，这似乎是一个非常巧妙的想法。

如果您的产品类型数量有限，我会选择您的第二种解决方案 - 一个具有基本属性的主产品表，然后是每种特定产品类型的附加表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:17:29.327

我一直在做这个`Oracle`。

我有以下表格：

```
t_class (id RAW(16), parent RAW(16)) -- holds class hierachy.
t_property (class RAW(16), property VARCHAR) -- holds class members.
t_declaration (id RAW(16), class RAW(16)) -- hold GUIDs and types of all class instances
t_instance (id RAW(16), class RAW(16), property VARCHAR2(100), textvalue VARCHAR2(200), intvalue INT, doublevalue DOUBLE, datevalue DATE) -- holds 'common' properties

t_class1 (id RAW(16), amount DOUBLE, source RAW(16), destination RAW(16)) -- holds 'fast' properties for class1.
t_class2 (id RAW(16), comment VARCHAR2(200)) -- holds 'fast' properties for class2
--- etc. 
```

`RAW(16)`是在哪里`Oracle`举行`GUID`

如果要选择对象的所有属性，请发出：

```
SELECT  i.*
FROM    (
        SELECT  id 
        FROM    t_class
        START WITH
                id = (SELECT class FROM t_declaration WHERE id = :object_id)
        CONNECT BY
                parent = PRIOR id
        ) c
JOIN    property p
ON      p.class = c.id
LEFT JOIN
        t_instance i
ON      i.id = :object_id
        AND i.class = p.class
        AND i.property = p.property 
```

`t_property`保存您通常不会搜索的内容（例如，文本描述等）

快速属性实际上是数据库中的普通表，以提高查询效率。它们仅保存某个类或其后代的实例的值。这是为了避免额外的连接。

您不必使用快速表并将所有数据限制在这四个表中。

对于您的任务，它看起来像这样（为简洁起见，我将使用方括号中的字符串而不是 GUID）：

```
t_class

标识父母

[ClassItem] [ClassUnknown]
[ClassMonitor] [ClassItem]
[ClassLCD] [ClassMonitor]

t_property

类属性

[ClassItem] 价格
[ClassItem] 供应商
[ClassItem] 模型
[ClassMonitor] 大小
[ClassLCD] 矩阵类型

t_declaration

身份证类
[1] [ClassLCD] -- 饭山 ProLite E1700

t_instance -- 我会将所有值放在一列中，不考虑类型（INT、VARCHAR 等）

id 类属性值

[1] [ClassItem] 价格 $300
[1] [ClassItem] 供应商饭山
[1] [ClassItem] 型号 ProLite E1700s
[1] [ClassMonitor] 尺寸 17
[1] [ClassLCD] matrixType TFT

```

如果您需要一些复杂的查询来搜索，比如`size`AND `matrixType`，您可以将它们从`property`并`instance`创建另一个表中删除：

```
t_lcd (id RAW(16), 大小 INT, matrixType VARCHAR2(200))

id 大小 matrixType

[1] 17 TFT

```

并使用它与其他属性连接，而不是`t_declaration`在上面的查询中。

但是即使没有快速表，这种模型也是可行的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T06:54:39.590

这种模式有一个名称。它被称为“泛化专业化”。

如果你搜索“泛化专业化建模”，你会得到一些关于如何做到这一点的文章。其中一些文章倾向于关系建模和 SQL，而另一些则倾向于对象建模。

# django - 如何在所有模板中查找 UserProfile 值？

> ID：662521
> 
> 赞同：0
> 
> 时间：2009-03-19T14:58:02.940
> 
> 标签：django, django-templates

我的“UserProfile”记录中附加了一个标志，用于登录用户，让我知道用户是否在我的网站上启用了“新功能”。我希望能够在我的所有模板中检查这个 django 模板变量以隐藏/显示新功能

我已经使用过：
{% if user.is_authenticated %}

要检查登录用户，我只想在该检查中再添加一个标志。我不想修改用户模型，有没有办法从模板中为用户查找 UserProfile？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T15:01:47.440

```
{% if user.get_profile.has_feature_enabled %} 
```

# c# - CanExecute-Result 更改后控件不刷新

> ID：662525
> 
> 赞同：5
> 
> 时间：2009-03-19T14:59:45.260
> 
> 标签：c#, wpf, commandbinding

在我的窗口中，我有加载和保存方法的按钮。我使用 CommandBinding 并且保存按钮具有 CanExecute 属性，以防止用户在加载数据之前保存数据。

CanExecute-Methode 连接到一个名为“canSaveXML”的简单布尔值

```
private void Save_CanExecute(object sender, CanExecuteRoutedEventArgs e)
{
    if (canSaveXML == false)
    {
        e.CanExecute = false;
    }
    else
    {
        e.CanExecute = true;
    }
    e.Handled = true;
} 
```

我的意图是在加载数据后设置 canSaveXML = true 但在值发生更改后控件不会刷新。我做了一些阅读，发现我必须调用 CommandManager.InvalidateRequerySuggested。我现在这样做，我的代码看起来像这样。

```
canSaveXML = true;
CommandManager.InvalidateRequerySuggested(); 
```

但是控件（按钮）仍然没有刷新。在我触发 UI 上的任何内容或最小化/最大化窗口之前，我仍然处于禁用状态。在我这样做之后，按钮被启用。

这里有什么问题？

在 MSDN 示例中，CommandManager.InvalidateRequerySuggested 一次又一次地使用调度程序计时器调用，但我拒绝相信这将是唯一的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T12:53:29.027

好吧，我自己发现了。

```
canSaveXML = true;
CommandManager.InvalidateRequerySuggested(); 
```

是后台工作人员中的代码。不好。您必须告诉窗口的调度程序调用 CommandManager.InvalidateRequerySuggested();

# linux - 内核模块的内存使用情况

> ID：662526
> 
> 赞同：11
> 
> 时间：2009-03-19T15:00:04.683
> 
> 标签：linux, memory, memory-management, kernel, linux-device-driver

在尝试估计内核模块（通常是设备驱动程序）消耗的内存量时，我尝试使用**size**实用程序，它给出了 .ko（.bss、.data、.text 等）的静态内存区域的大小。所以我期望这些值的总和与插入模块后立即由**lsmod**命令给出的输出完全相等。

init() 函数中没有执行动态内存分配（kmalloc 或 vmalloc）以确保它不会导致差异。那么为什么会出现不匹配？

奇怪的是，大多数时候发现不匹配是固定的！！

命令输出如下所示

# 大小 chardev.ko

```
text    data     bss     dec     hex   filename
172     448    1024016 1024636  fa27c chardev.ko 
```

# lsmod

```
Module  Size    Used by    Tainted: P
chardev 1025040 0 - Live   0xc009d000 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-24T14:43:41.363

您提到在 init 函数中没有进行任何分配，但这是否考虑到诸如 register_chrdev(9) 之类的调用，它在内部为设备实例分配内存？它是一个持续的差异的评论让我想知道这是否可能是原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:37:31.683

模块使用的功能是否可能计入模块大小？尝试

```
cat /proc/kallsyms | grep module_name 
```

两者大小之差为 404。文本 + 数据 + 404 = 1024。可能这是某种粒度问题吗？我不知道内核内部的大小是如何计算的...

但是，内核代码和数据是使用动态内存分配的。而且 kmalloc 使用预先分配的内存块，因此在分配代码和数据部分时很可能存在一些舍入。

尝试增加数据部分的大小并查看 lsmod 是否报告了大小变化

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T06:08:50.043

如果没有更多信息，我很想猜测它的调试开销。我说动心是因为我没有你的内核配置。

# .net - 是否有一种简单的方法来判断 LINQ to SQL 记录是否已更改？

> ID：662528
> 
> 赞同：0
> 
> 时间：2009-03-19T15:00:17.240
> 
> 标签：.net, linq-to-sql

我有一个简单的例程来填充表格中的记录。我有一些字段，我只想在发生实际更改时更新。即使用户没有更改任何内容，也可以调用该函数。有没有一种简单的方法来判断是否发生了变化？这是功能：

```
Sub Edit(ByVal key as Integer, ByVal myval1 As Integer?, ByVal myval2 As Integer?)

    Dim db As New MyDatabaseDataContext

    Dim form = (From x In db.MyTables Where x.id = key).SingleOrDefault

    form.field1 = myval1
    form.field2 = myval2

    If [???] Then
        form.mod_date = Now
    End If

    db.SubmitChanges()

End Function 
```

这有点简化 - 我宁愿不检查 field1 和 myval1、field2 和 myval2 等之间的每个关系，因为可能有很多字段，你必须对每个字段都没有考虑，等等等等。如果作业真的改变了什么，有什么办法可以问“表格”吗？我知道在幕后，如果没有任何变化，它不会进行数据库更新，但是在我提交更改之前是否会暴露给我？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T15:17:14.180

您可以在 DataContext 本身上处理这种事情。

例如，您可以使用 UpdateXXX 方法来捕获对对象的更改并记录您的日期。

因此，在 DataContext 上与您的示例相关（假设您有一个名为 MyTable 的类）：

```
Private Sub UpdateMyTable(ByVal instance As MyTable)
    instance.mod_date = Now
    Me.ExecuteDynamicUpdate(instance)
End Sub 
```

据我所知，DataContext 将检测是否发生了更改，并且只调用该方法进行实际更新（但我可能在这方面错了，我会检查一下）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:12:57.990

看起来您只是想设置修改日期，但前提是有更改。我处理这个问题的方法是使用分部类实现并在 OnCreated 分部方法中注册一个 PropertyChanged 事件处理程序，该方法在设计器代码的默认构造函数中被调用。在属性更改处理程序中，我更新了修改数据字段（当然，如果那不是正在更新的属性）。请注意，我也直接设置了支持字段，这样事件就不会因为我的更改而重新触发。

示例（对不起 C#，但这就是我的代码的实现方式）。

```
partial void OnCreated()
{
    this.PropertyChanged += new PropertyChangedEventHandler( Participant_PropertyChanged );
}

void Participant_PropertyChanged( object sender, PropertyChangedEventArgs e )
{
    if (e.PropertyName != "mod_date")
    {
        this._mod_date = DateTime.Now;
    }
} 
```

# c# - 如何从 ActiveXObject 访问 window.document 对象？

> ID：662529
> 
> 赞同：0
> 
> 时间：2009-03-19T15:00:32.403
> 
> 标签：c#, javascript, com-interop

如何从 InternetExplorer 中的 ActiveXObject 访问 window.document 对象？我正在为我的 ActiveXObject 使用 C# 语言。

谢谢保罗。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T15:51:13.333

我认为被实例化的对象不会知道 - 从哪里调用它。
因此，为了在 ActiveXObject 中使用 window.document，您必须将 window.document 的实例作为属性传递。

# asp.net - 在 iis 中为静态文件设置字符集

> ID：662535
> 
> 赞同：5
> 
> 时间：2009-03-19T15:02:43.710
> 
> 标签：asp.net, iis, content-type

如何确保 IIS（和 Cassini）发送带有内容类型标头（即 text/css;charset=UTF-8）的 css 和 js 文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-02-27T12:30:56.650

刚刚提出了同样的问题，我在[这里](http://forums.iis.net/t/1155439.aspx)找到了答案（对于 IIS7/7.5，但希望这也适用于 Casini）：

任何一个：

*   直接`; charset=utf-8`在IIS管理器的mine types配置中添加mime type。
*   编辑 web.config：

```
  <配置>
    <system.webServer>
      <静态内容>
        <mimeMap fileExtension=".rss" mimeType="text/xml; charset=utf-8"/>
      </静态内容>
    [...]

```

# c++ - 为什么我不能在 ATL 对话框中托管的 Winform 中输入文本？

> ID：662540
> 
> 赞同：0
> 
> 时间：2009-03-19T15:04:13.660
> 
> 标签：c++, winforms, atl

我正在将 winform 控件嵌入到 ATL 对话框中（请参阅[此处](https://stackoverflow.com/questions/642082/how-to-embed-windows-form-in-unmanaged-atl-gui)了解我到目前为止的工作方式）。

现在我遇到了一个相当奇怪的问题。
出于某种原因，我的 winforms 中的文本字段显示正常，但我无法通过在键盘上键入来更改其中的文本。

但是，我可以将文本从其他地方复制并粘贴到文本字段中，然后将其视为正常输入（触发文本更改事件等）。

如何让文本字段正常运行并允许通过键盘输入文本？
有什么提示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T18:54:51.647

您的消息循环有问题。TranslateMessage() 是可能的候选者，它是从 WM_KEYDOWN 消息生成 WM_CHAR 消息的候选者。

# entity-framework - 使用 ado.net 实体框架进行前向映射

> ID：662542
> 
> 赞同：0
> 
> 时间：2009-03-19T15:05:28.587
> 
> 标签：entity-framework, ado.net

我最近在试验实体框架，

我想知道是否可以从头开始在设计器视图中对实体进行建模，然后让框架自动处理模式创建、外键等？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T17:28:45.020

Entity Framework 团队将此称为“[模型优先](http://blogs.msdn.com/efdesign/archive/2008/09/10/model-first.aspx)”。它不是当前发布的实体框架的一个功能，但它将在 .NET 4.0 中。[如果您观看PDC 视频](http://mschnlnine.vo.llnwd.net/d1/pdc08/WMV-HQ/TL20.wmv)，您可以看到演示。

# css - 在 IE (7) 中使用空白样式的跨度应用了跨度的_past_结束

> ID：662544
> 
> 赞同：0
> 
> 时间：2009-03-19T15:05:37.807
> 
> 标签：css, internet-explorer, whitespace

我们有一个应用程序，用户可以在其中将“注释”输入到富编辑控件（Telerik 的 RedEditor，但这在这里无关紧要）。我们有一个用户在 Safari 中输入笔记，笔记`<span></span>`中间有一个，并且该跨度上有一个样式，指定`white-space:pre`笔记的 HTML 格式为：

```
<div> This is a note <span class="Apple-tab-span" style="white-space: pre; ">   </span> and here's more of the note. </div> 
```

很简单，样式*应该*适用于跨度，跨度中有 4 个空格。结果输出中应该有 4 个空格。

这就是问题所在。IE 似乎`white-space: pre;`不仅将这种风格应用于跨度，而且应用于封闭的 div！因此，由于它不在跨度中而应该已经换行的这条长线现在将文档推出，直到该线适合页面。

我错过了什么。我知道 IE 有问题，但这似乎不对，即使对于 IE。

所以，问题：

1）我是否正确认为该`white-space`属性应该只应用于跨度？

2）这可以以某种方式解决吗？请记住，我无法控制输入的内容。它是从带有 Safari 的 mac 输入并在 IE 中查看的。

编辑：相关页面上的文档类型是： `<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T22:41:33.987

我不确定你想用 pre 作为样式的跨度空间来实现什么。如果你想让句子有一个空格而不是自动换行，请将 no-wrap 样式放在整个 div 上。如果你想要的只是一个空格，将html实体   直接放在两个单词之间，它们不会分开。或者，如果您试图创建一个大于单个空间的任意空间，请忘记 pre 并给该跨度一个宽度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T17:11:21.067

Are you using a Standards Mode DOCTYPE? In Quirks Mode, IE incorrectly applies ‘white-space’ only to block elements. (I couldn't get it to leak the white-space out of the span though, it just simply didn't work.)

> I'm not in control of the content being entered.

It's unusual to allow raw HTML content to be entered; in that case you can't really fix up any browser weirdnesses!

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T19:32:05.910

1）是的，你是对的。

2) 我在 Telerik 控件方面遇到了很多问题，特别是 RTE 更改了输入的原始 HTML。我建议您检查您的数据库并查看其中存储了哪些 HTML。

希望有帮助

达科

# jquery - 从单选按钮中删除类

> ID：662545
> 
> 赞同：0
> 
> 时间：2009-03-19T15:06:03.170
> 
> 标签：jquery, css-selectors, radio-button

我如何为 jquery 中的单选按钮做同样的事情？

```
$("select option:not(:selected)").removeClass("takethis"); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T15:08:07.643

```
$("input:radio, input:checkbox").not(":checked").removeClass('takethis'); 
```

# matlab - 在 Octave 中实现 Matlab 的 avgpower？

> ID：662548
> 
> 赞同：1
> 
> 时间：2009-03-19T15:06:59.753
> 
> 标签：matlab, signal-processing, octave, spectral-density

伙计们，

Matlab 2007b (7.5.0) 有一个 avgpower 函数。见[这里](http://www.mathworks.com/products/signal/demos.html?file=/products/demos/shipping/signal/spectralanalysisobjsdemo.html)：

“avgpower 方法使用积分的矩形近似值，使用存储在对象中的 PSD 数据计算信号的平均功率。

“avgpower 方法返回信号的平均功率，即 PSD 曲线下的面积。”

示例调用：

```
    numSamples = 10000
    频率 = 20
    幅度 = 10
    Fs = 1000
    t = [0:1/numSamples:1];
    sig = 幅度 * sin(2*pi*频率*t);
    h = 光谱.周期图（'矩形'）；
    hopts = psdopts(h, 信号);
    设置（跳跃，'Fs'，Fs）；
    p = psd(h,信号,跳数);
    较低 = 12
    上 = 30
    beta_power = p.avgpower([下上]);

```

我希望在 Octave 中复制这种功能。功能“pwelch”似乎是一种可能性。以机智：

```
    ...
    sig = 幅度 * sin(2*pi*频率*t);
    pwelch('R12+');
    [光谱，频率]=pwelch（信号，[]，[]，[]，Fs，plot_type='dB'）；

```

现在我*认为*频谱具有PSD的y值，而频率具有x值。所以，我可以在频率中找到介于“下”和“上”之间的样本，并且......呃，平均光谱中的相应值？我对此很模糊。

此外，“频率”中的值不一定对应于我想要的上限和下限，我不知道该怎么做。如果下部或上部正好位于宽频率箱的中间怎么办？例如，我是否需要半个 bin（即线性插值）？

也有可能从某种 FFT 中获取单个值，而不是使用 pwelch。

建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T14:05:39.353

显然我是在自言自语，但这里有一些建议的 Octave 代码，供那些走这条路的人使用。

```
函数[avgp] = oavgpower（信号，采样频率，低频率，高频率，窗口）

[光谱，频率]=pwelch（信号，窗口，[]，[]，采样频率）；

idx1=max(find(freq = highfreq));

% 索引和下层和上层的实际频率
%idx1
%频率（idx1）
%idx2
%频率（idx2）

% 0: 不包括最后一个 bin
宽度 = [差异（频率）；0];

pvec = 宽度(idx1:idx2).*光谱(idx1:idx2);
avgp = sum(pvec);

```

# sql - 如何为 Microsoft SQL Server 2005 中的数据生成图形图像？

> ID：662551
> 
> 赞同：2
> 
> 时间：2009-03-19T15:08:07.783
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有以下示例表：

```
Dt                      Value1   Value2  Value3 ...
2008-12-01 12:34:00     100.1    0.123   43
.... 
```

有没有什么办法可以使用TSQL来生成jpg等图片的趋势图？还是我需要报告服务才能做到这一点？我需要使用 TSQL，以便可以在计划的作业中生成每日趋势图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T15:21:25.637

你可以试试这个：
1\. 编写一个控制台程序，它将连接到 SQL 并为你的表生成带有趋势的 jpg 2\. 用[xp_cmdshell](http://msdn.microsoft.com/en-us/library/ms175046(SQL.90).aspx)
运行这个程序（你也可以传递一些参数）

```
EXEC sp_xp_cmdshell 'trendsgen.exe [param1], [param2]' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:18:41.930

您需要报告服务来执行此操作。

但是，您可以安排作业以使用报告服务。

# javascript - 在 Visual Studio 2008 中匿名 Javascript 函数的第一行设置断点

> ID：662553
> 
> 赞同：0
> 
> 时间：2009-03-19T15:08:14.460
> 
> 标签：javascript, visual-studio, debugging

我在使用 Visual Studio 2008 Javascript 调试器时遇到问题。我无法在匿名函数的第一行设置断点。鉴于现在大多数 Javascript 都是使用命名空间编写的，这意味着您不能在大多数 Javascript 函数的第一行设置断点。

看看谷歌（例如[this](http://weblogs.asp.net/kdente/archive/2007/11/27/is-the-visual-studio-2008-javascript-debugger-crippled.aspx)）和connect.microsoft.com，这似乎是一个长期存在的问题。

然而，谷歌并不擅长为老问题找到新的解决方案，有没有人找到解决方案？

（由于我正在开发的网络应用程序仅适用于 IE6，我不能使用 FireFox，它是 Javascript 的调试器，所以我不得不使用 Visual Studio 2008 Javascript 的调试器。我认为该应用程序也适用于 IE7，但我们的IT 部门不会让我们在没有充分理由的情况下安装 IE7，因为我们的大多数客户仍在使用 IE6——因此我开始希望我是一名 Java 开发人员而不是 C# 开发人员。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T15:12:26.697

首先哎呀，对不起您的 IT 部门和您无法逃脱 IE6 的地狱。

其次，我最好的建议是添加一个调试器；声明你想要你的断点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T08:53:47.713

微软的回应：

> 您描述的问题在 IE 附带的脚本引擎中。我想说好消息是我们已经在 IE8 中修复了它。

# sql - 是否可以创建一个知道当前模式/库名称的视图？

> ID：662554
> 
> 赞同：3
> 
> 时间：2009-03-19T15:08:28.733
> 
> 标签：sql, database, db2, ibm-midrange

背景：iSeries 版本的 DB2。在每个环境中，都有一个包含有关其他表的位置列信息的表。由于此表中的数据是静态的，并且每次更改表时都必须重新生成，因此如果不同步就会出现问题。

所有位置数据都存在于`QSYS2.SYSTABLES`和中`QSYS2.SYSCOLUMNS`，因此应该可以创建一个包含相同信息但保证正确的视图。旧程序应该能够使用此视图。

唯一的问题是视图需要知道当前模式（iSeries 中的数据库），才能从 QSYS2 表中检索正确的信息，因为它们包含***所有***模式/库的数据。

关于这是否可行以及如果可行怎么办的任何想法？

**编辑：**回复：瑞安吉尔

实际上，我希望视图`QSYS2.SYSCOLUMNS`在其条件中使用当前库名称来选择行。如果我在多个库中有表 T，那么`SYSCOLUMNS`每个库中都会有 T 实例的数据。

一个不优雅的解决方案是我可以将库/模式名称存储在每个库中，并且视图将在选择中使用这个值......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T20:25:04.493

您是否尝试过使用特殊寄存器`CURRENT_SCHEMA`？

前任：`Select CURRENT_SCHEMA From QSQPTABL`

（注：与玩玩的虚拟桌`QSQPTABL`相同）`SysIBM/SysDummy1`

```
Select * From SysViews
Where System_View_Schema = CURRENT_SCHEMA 
```

'当然只有当你使用 *SQL 命名而不是 *SYS 命名时才有效，但那是另一回事 :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T17:13:11.560

I think you're idea of storing the schema & table names in a table will work. Your view gets created in that schema by using an inner join of that schema & table to syscolumns to create the view.

Optionally you might want to consider using DDS instead of SQL to create a logical file (view) over syscolumns for each library. Not sure how many libraries you are dealing with but if they are just a few this might be workable.

To use DDS with Selection:

SYSCOLUMNS is already a view so to create a DDS LF for Select/Omit you have to create it over the underlying QADBIFLD physical file (QADBXSFLD is also involved but I don't think you need any fields from that file for this application):

```
 A          R QDBIFLD                   PFILE(QADBIFLD)                      
 A          S DBILB2                    COMP(EQ 'SCHEMANAME')                
 A          S DBILFI                    COMP(EQ 'TABLENAME') 
```

You could use DBILIB & DBIFIL if you're schema and table names are 10 or under. If you need the SYSCOLUMN names you have to do some field renaming.

Ryan, I'm wrong as you could also do this with a SQL view:

```
 CREATE VIEW MYSCHEMA/MYSYSCOLUMN AS
     SELECT *
       FROM SYSCOLUMNS
      WHERE SYSCOLUMNS.DBNAME = 'SCHEMANAME'
        AND SYSCOLUMNS.TBNAME = 'TABLENAME' 
```

To use a join:

```
CREATE TABLE MYSCHEMA/MYTABLESELECT
           ( MYSCHEMA VARCHAR (128),
             MYTABLE VARCHAR (128) );
INSERT INTO MYTABLESELECT VALUES( 'SCHEMANAME', 'TABLENAME' );
CREATE VIEW MYSCHEMA/MYSYSCOLUMN AS
     SELECT SYSCOLUMNS.*
       FROM SYSCOLUMNS, MYTABLESELECT
      WHERE SYSCOLUMNS.DBNAME = MYTABLESELECT.MYSCHEMA
        AND SYSCOLUMNS.TBNAME = MYTABLESELECT.MYTABLE; 
```

No ordering is being done on either the DDS or the View.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T15:12:02.547

您是说要创建一个视图并将其粘贴在仅显示其库内容的库中？我猜您正在使用库列表访问这些东西，而不是指定特定的库？

我认为在使用库列表时，视图不可能使用 sql 来知道它是当前库。如果您没有使用库列表，那么您应该能够使用您知道的库来运行查询。

还是我误会了？

**更新**

如果您想要一个动态知道它所在的模式并将其用作 sql 语句的一部分的视图，我认为这是不可能的。如果您对视图的查询进行硬编码，以将其中 schema = 'myLib' 说明为当前库，那么它可以工作，但您必须制作不同的版本才能放入每个库中。如果它是错误的或者它是否被切换等等，也不会很明显。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-03-23T09:51:31.643

如果您将库创建为模式（即，使用`CREATE SCHEMA`而不是`CRTLIB`，那么所有需要的信息都已经在模式中。也就是说，您不需要查询`QSYS2.SYSTABLES`并且`QSYS2.SYSCOLUMNS`因为您可以查询`myschema.SYSTABLES`and `myschema.SYSCOLUMNS`，或者只是不合格的 SYSTABLES 和 SYSCOLUMNS 如果您的 CURRENT_SCHEMA 设置为“myschema”。

# jquery - 将特定于域的 javascript 编写为 jquery 插件是个好主意吗？

> ID：662555
> 
> 赞同：0
> 
> 时间：2009-03-19T15:09:15.720
> 
> 标签：jquery, jquery-plugins

将您的应用程序 javascript 编写为 jquery 插件是一个好主意吗？

优点：

*   通过创建通用接口促进重用

缺点：

*   不完全是 jquery 的扩展。

你觉得呢？你有没有什么想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T15:19:34.020

到目前为止，我已经为我的应用程序制作了几个 jQuery 插件，尽管还没有将它们作为开源发布。

如果它们是可重用的代码（例如翻转图像、浮动菜单等），我发现它们非常有用。

但是对于任何其他特定于项目的功能，我不会创建 jQuery 插件，因为这是不必要的开销，而且您不会从中获得太多收益。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:14:53.617

如果作为 jQuery 扩展使任务更容易，我认为它没有任何问题。如果它实际上没有帮助，那是没有意义的。

不过，我会使用与标准 jquery 插件不同的文件命名约定（即，不是“jquery.xxxxxx.js”）

# javascript - 使用 jQuery 代替长列表的 <SELECT> 框？

> ID：662558
> 
> 赞同：2
> 
> 时间：2009-03-19T15:09:46.687
> 
> 标签：javascript, jquery

现在我有一个应用程序，允许用户从下拉（选择）框中选择一个戒指。可以有很多选择，它会创建一个很长的下拉菜单，使用起来不太好。我想也许使用 jQuery 来使它更好一点。就像可能在顶部有一个标签，他们可以选择“白金”、“黄金”等来缩小我不确定的选项。我从未使用过 jQuery，也不确定它在这里能为我做什么，所以我愿意接受任何建议。我只有一个要求，现在每个<选项>都有一个值属性表示所选项目的库存号，所以当点击提交按钮时，我的处理页面会收到他们想要的项目的库存号；我需要保留该功能。

谁能告诉我一个很酷的解决方案？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T15:14:29.670

嗯，像[FlexBox 之](http://www.fairwaytech.com/flexbox/flexbox-demos/)类的东西？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:17:02.013

您可能想查看 jQuery[自动完成](http://plugins.jquery.com/project/autocompletex)插件。您可以限制自动完成的输入，以便必须从您的自动完成列表中选择它。如果将所需的字符数设置为 0，它可能会在文本框获得焦点时调出整个列表，然后在用户开始输入时缩小范围。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T15:14:23.900

你检查过[jQuery UI Demos](http://jqueryui.com/demos/)了吗？您可能对“可选”交互以及“选项卡”小部件感兴趣。

# java - 如何从 jpeg 文件中的 FFC4 (DHT) 标头创建 Huffman 树？

> ID：662565
> 
> 赞同：5
> 
> 时间：2009-03-19T15:12:57.023
> 
> 标签：java, jpeg, huffman-code

我以为我可以自己解决这个问题，但我似乎根本没有前进。

好的，背景：

我需要根据 jpg 文件中的 FFC4、DHT（定义霍夫曼表）标头提供的信息创建一个霍夫曼代码树。DHT 标头以这种方式定义 Huffman 表：

1) 一系列 16 字节。每个字节定义有多少个符号具有 n 位数的霍夫曼码，其中 n 是字节在序列中的位置。（这有什么意义吗？！！）例如，十六进制的原始数据是：

> 00 01 05 01 01 01 ... 00

这意味着：

```
Num of bits:    1   2   3   4   5   6   7 ...  16  
Num of codes:   00  01  05  01  01  01  01 ... 00 
```

2) 在 16 个字节列表之后是​​实际符号本身。例如：

> 00 01 02 03 04 05 06 07 08 09 0A 0B

3）结合这两部分我们看到它们是：
00码1位。
01 2 位代码：因此从列表中取出第一个符号：00
05 3 位代码：因此从列表中取出接下来的 5 个符号：01 02 03 04 05
.. 依此类推

4）最后，我们必须从上面的信息中计算出实际的霍夫曼码。如果您是数学天才，您可能已经发现这些代码可以通过简单地为每个新代码以特定位长度递增适当位数的二进制数来计算。当位长增加时，只需增加二进制数，然后将其加倍并继续。当你手工画出许多这样的二叉树时，其他人就会很明显......

5）所以这是我用来计算霍夫曼代码并将它们存储在数组中的代码：（首先我读取1处的数据）并将其放入数组中：dhtBitnum）

```
 int binaryCode = 0;
            count = 0;
            StringBuffer codeString = new StringBuffer();               

            //populate array with code strings
            for (int numBits=1; numBits<=16; numBits++) {

                //dhtBitnum contains the number of codes that have a certain number of bits
                for (int i=1; i<=dhtBitnum[(numBits-1)]; i++) {

                    //turn the binary number into a string
                    codeString.append(Integer.toBinaryString(binaryCode)); 
                    //prepend 0s until the code string is the right length
                    for(int n=codeString.length(); n<numBits; n++) {
                        codeString.insert(0, "0");
                    }
                    //put the created Huffman code in an array
                    dhtCodes[count]=codeString.toString();
                    binaryCode++;
                    count ++;
                    codeString.delete(0, codeString.length());
                }
                binaryCode = binaryCode << 1;

            } 
```

一旦我生成了霍夫曼代码并按顺序存储它们，我就可以按照它们在 2) 中出现的顺序添加它们引用的符号。这可能不是非常优雅，但它似乎至少可以工作并创建正确的表。

6）如果有人仍然遵循这一点，你应该得到一枚奖牌。

7) 现在的问题是我想将此信息存储在二叉树中，以便以后可以有效地解码 jpg 图像数据，而不是每次都搜索数组。不幸的是，我无法直接从上述 jpg 标题中提供的信息中找出一种干净有效的方法来执行此操作。
我能想到的唯一方法是首先计算出上面的霍夫曼代码，然后实现一些方法，根据需要创建节点并将符号保存在适当的位置，使用代码作为各种地址。然而，这似乎是一种重复我需要的信息的方式，我相信一定有一个更好、更简单的方法。

8）因此，如果有人理解我的胡言乱语，我将非常感谢您提出一些建议。我意识到这是一个非常具体的问题，但如果没有别的，上面的信息可能对某人有帮助。我对此还是很陌生，所以请原谅我的无知，特别欢迎易于理解的代码！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:00:05.327

至于如何直接实现这一点，我不完全确定，因为处理信息需要一段时间，但如果你知道[Trys](http://en.wikipedia.org/wiki/Trie) ，算法应该很简单。从第 7 点看来，您没有？

我将添加一个示例：

```
 °
        / \
       /   \
      °     °
     / \   / \
    a   b  c  d 
```

在这个简单的 trie 中，如果我们向左走，我们将假设 left 是 0，right 是 1。所以如果你遇到模式 '00'，这对应于 a。模式“10”对应于 c。通常对于霍夫曼树，特里树将是不平衡的，即

```
 °
    / \
   a   °
      / \
     b   °
        / \
       c   d 
```

在这种情况下，前缀代码“0”对应于 a。将代码 111 转换为“d”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T16:05:47.387

正如@wds 所说，尝试帮助。霍夫曼解码的核心思想是代码序列的位应该用于“遍历”特里树，当代码有 0 时向左走，1 向右走，直到代码字结束。然后，您将在 trie 节点中存储该代码的替换数据。

# asp.net - 用于 HTML 编辑的最佳免费或廉价 ASP.NET 控件是什么？

> ID：662567
> 
> 赞同：1
> 
> 时间：2009-03-19T15:13:00.580
> 
> 标签：asp.net, richtextbox

### 复制

> [最佳 ASP.net WYSIWYG](https://stackoverflow.com/questions/308685/best-asp-net-wysiwyg)
> [使用 ASP.NET MVC 框架时，最好的 WYSIWYG 编辑器是什么？](https://stackoverflow.com/questions/590960/whats-the-best-wysiwyg-editor-when-using-the-asp-net-mvc-framework)
> [如何在网页上制作所见即所得的部分？](https://stackoverflow.com/questions/364642/how-to-make-a-wysiwyg-section-on-a-web-page)
> [Web 开发人员可以使用的最好的 HTML WYSISYG 编辑器是什么？为什么？](https://stackoverflow.com/questions/65800/whats-the-best-html-wysisyg-editor-available-to-web-developers-and-why)
> [https://stackoverflow.com/questions/5833/looking-for-wysiwyg-html-editor](https://stackoverflow.com/questions/5833/looking-for-wysiwyg-html-editor)
> [.NET 文本编辑器，接受 HTML 和带有拼写检查的输入/输出](https://stackoverflow.com/questions/259569/-net-text-editor-that-accepts-html-and-input-output-with-spellchecking)

我正在寻找一个易于集成的 ASP.NET 控件，用于简单的 HTML 编辑、插入图片、基本格式设置等。

你会推荐什么组件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T15:20:34.047

[FCKEditor](http://www.fckeditor.net/)或[TinyMCE](http://tinymce.moxiecode.com/)。两者都很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T15:20:12.957

来自[FCKeditor](http://www.fckeditor.net/)关于[*ASP.NET 集成的页面*](http://docs.fckeditor.net/FCKeditor_2.x/Developers_Guide/Integration/ASP.NET)

> 在您的 ASP.NET 网页中使用 FCKeditor 非常容易

事实上，它带有一个易于使用的 ASP.NET 控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T15:30:25.443

我过去使用过[FreeTextBox](http://freetextbox.com/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T15:33:45.577

我真的很喜欢我现在正在写的 wmd 编辑器：）

[http://wmd-editor.com/](http://wmd-editor.com/)

在代码示例方面非常好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T15:35:19.130

看你觉得什么便宜！

我们过去曾使用过来自 CuteSoft 的[CuteEditor](http://cutesoft.net/example/general.aspx)，它很棒——尽管价格从 129 美元起。

我们还使用了 TinyMCE、FreeTextBox 和 FckEditor——虽然这些都是免费的，但它们无法提供 CuteEditor 的精美功能。

*   源代码模式下的 HTML 是标签和缩进的
*   可以在图库中编辑/裁剪/调整图像大小
*   编写新工具栏很容易
*   与 ASP.NET 网络表单的简单集成 - MVC 是另一回事

如果您不需要所有这些，那么其他一个应该没问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T15:50:51.727

我目前正在使用 FreeTextBox，并且可以很好地与我们的 asp.net 应用程序配合使用。最好的部分是它是免费的。

# repository - 我什么时候需要刷新 Rhino Commons UnitOfWork？

> ID：662572
> 
> 赞同：2
> 
> 时间：2009-03-19T15:14:02.527
> 
> 标签：repository, rhino, flush, unit-of-work

当使用 Rhino Commons UnitOfWork（在 ASP-MVC 的 UnitOfWorkApplication 中）时，我喜欢使用 Rhino Repository 静态类来保存这样的实体：

```
Repository<Car>.Save(new Car(Id = 1)); 
```

我发现我可以在调用之后立即使用：

```
Car car = Repository<Car>.Get(1); 
```

这工作正常。但是，当我在 Rhino UnitOfWork 上使用 NHibernate Linq 提供程序时，如下所示：

```
var allCars = (from rep in UnitOfWork.CurrentSession.Linq<Car>()
               select rep).ToList(); 
```

我得到一个空列表。看来我必须先调用 UnitOfWork.Current.Flush() 才能像这样把车开出来。我不明白为什么，因为在幕后我假设两种检索方法都在查询同一个会话/工作单元。这是否意味着您应该在每次保存到数据库后调用 UnitOfWork.Current.Flush() ？NHibernate 不应该能够计算出何时刷新自身吗？还是我误解了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T17:00:17.707

好吧，虽然对 Repository 的 Get 调用可以使用会话缓存，但似乎可以“看到”缓存中保存的汽车：

```
Car car = Repository<Car>.Get(1); // This works because it uses the same session 
```

linq 查询不使用会话缓存：

```
var allCars = (from rep in UnitOfWork.CurrentSession.Linq<Car>()               
select rep).ToList(); // Does not work, even if it is in the same code block and even though it uses the same session 
```

因此最佳实践是任何数据库更改（保存、更新、删除、插入）都应遵循：

```
UnitOfWork.Session.Flush(), 
```

或包裹在：

```
With.Transaction(delegate{
   // code here
}) 
```

或用 [Transaction] 装饰您的方法并使用 ATM。这将确保后续的 linq 查询将查看最新数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:33:08.900

当您调用 Repository.Save 时，您将通知存储库持有的会话以跟踪该对象并在下次刷新时将更改同步到数据库。在刷新会话之前，不会对数据库进行任何更改。该对象确实成为会话缓存的一部分，因此将由 Get(1) 返回。

当您运行查询以填充集合时，会话会查询数据库以获取结果，除非它已经缓存了这些结果。~~由于您尚未更新数据库，因此您添加到会话中的 Car 将不会成为结果集的一部分。~~（<-- 可能不正确）如果我正确阅读了文档，则查询结果和 Save()ed 实体都应添加到会话（一级）缓存中。这并不一定意味着`querystatement.List()`在添加数据库结果后查询缓存......我很难弄清楚到底发生了什么。

顺便说一句，我相信您可以将会话设置为自动刷新，但我必须检查文档。

更新：

我想我可能会看到这里发生了什么。默认会话`FlushMode`是`Auto`，但 Rhino`UnitOfWork.Start()`会创建一个`FlushMode`设置为`Commit`的会话，这意味着会话不会自动刷新，除非您明确调用`Flush()`或提交事务。使用`FlushMode`of `Auto`，NHibernate 将（有时？）在查询之前刷新会话，以防止返回过时的数据。如果我是对的，您的数据库事务看起来像：

```
SELECT * FROM Car

INSERT INTO Car (...) VALUES (...) 
```

从我读过的文档/博客来看，当它自动刷新时似乎有点模棱两可......最常见的答案是它`FlushMode = Auto`“有时”会刷新，尽管它保证`Session.Find`永远不会返回陈旧的数据。由于 NHibernate Linq 实际上只是创建了一个 Criteria 查询，它可能不会触发自动刷新（也许现在已经修复了......很难知道）。

因此，在我看来，在您的情况下，您想在保存后刷新，因为您立即想检索保存的结果。在仅更新实体的较小工作单元中，单个 Commit() 就可以了。也许`UnitOfWork.CurrentSession.FlushMode = FlushMode.Auto;`可以解决问题，但 UOW 工厂明确将模式设置为 Commit 的事实似乎鼓励您真正考虑您的 UOW 边界。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T11:48:08.917

感谢 Stuart Childs，我怀疑他是对的，问题可能出在 NHibernate Linq 提供程序上。我不确定它在幕后做了什么，但它可能会使用不同的会话，如果是这样，那么我必须在 Linq 查询“看到”它之前刷新存储库保存是有道理的。是时候查看源代码了，但有人告诉我，试图理解它会让我头晕目眩！

# c# - C#中标签的用途是什么？

> ID：662577
> 
> 赞同：12
> 
> 时间：2009-03-19T15:14:32.620
> 
> 标签：c#

标签和`GOTO`s 被认为是不好的做法，据我所知，没有理由在 C# 中使用它。

C#中标签的用途是什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-19T15:16:14.143

标签和 goto 本身并没有错。问题是人们倾向于滥用它们，这确实造成了问题。

标签的典型使用

```
OperationStart:
  if ( !TrySomeOperation() ) {
    if ( MaybeFixOperation() ) { 
      goto OperationStart;
    }
  } 
```

你需要做出一些你不能命中无限循环的断言，但如果有一组合理的保证，这段代码本质上没有任何问题。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-19T15:16:56.270

仅仅因为它们是一种声名狼藉的做法，并不意味着应该关闭任何使用它们的可能性。虽然它们可能永远不会被真正*需要*，但它们有时是最好的方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-19T15:34:51.970

当您实现一个小型[有限状态机](http://en.wikipedia.org/wiki/Finite_state_machine)时，您可以为每个状态使用一个*标签，并为状态转换使用**goto*。这是植入有限状态机的标准方法之一，并且可以产生清晰的代码，前提是代码注释指向的文档中有状态机图。

有时问题域包含很多状态机（例如电信协议通常由有限状态机定义），大多数时候您不会经常看到有限状态机。

*Goto*和*标签*对于机器生成的代码也非常有用，如果您正在编写一个输出 C# 的简单编译器，您可能会对它们感到非常高兴。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-12T14:09:26.767

代码生成器有时会使用标签和 goto。在某些情况下，它可以简化代码生成逻辑。出于可读性的原因，通常避免使用 Goto 语句，但如果不打算阅读代码，那么这是一个有争议的问题。

我还看到过这样的情况：反编译器被 IL 弄糊涂了，并输出 goto 语句，而不是人类会想出的精心设计的指令序列。如果 goto 语句不合法，那么反编译器可能不得不完全取消该部分代码。这样，至少，它可以生成可以往返的*东西。*

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-06-12T11:04:27.453

**Why is it there?**

The reason is actually pretty simple. Assembler and IL don't support advanced instructions like `for`, `do`, `break`, `continue` and `while`. Implicitly, code that loops (or more generally: branches) is compiled to branches. `goto` and `label` is a very literal branch.

Note that you simply cannot implement all the contraptions that I can think of easily without a 'goto'- even though there are usually better alternatives (at this point I'd like to point out that there are Design Patterns like the `State pattern`).

If you design a language like C#, which is kind-of the "high level assembler for IL", it only makes sense to support at least everything there is in IL. Here, branch / label is the low-level construct, and goto / label is the C# projection (with scope added as high-level construct).

**From the compiler POV**

Eventually if you go down to how a compiler works, there's a difference in *predictable* code and *unpredictable* code. The optimizing part of a compiler spends a tremendous amount of effort into normalizing the constructions you're using in your code. Once normalized, it's optimized using patterns.

Herein lies the problem. If you have a `while` loop, a `for` loop or a `foreach` loop, it will definitely generate a normalized pattern. After all, loops are the number one thing in your code that can be optimized. However, if you're using strange branches, they *won't* be optimized - simply because it won't be normalized to a standardized pattern and therefore won't be picked up by the pattern matcher.

This comment is not just about predictability of code patterns - it's also about predictability of data flow. Again, if it's predictable, your compiler can do more than if it's not. In various cases, constructs like `break` and `continue` will also lead to more unpredictable branches; labels and `goto` will just get you there more easily. The result is the same: your performance will suffer if this occurs.

So while it's true that all compilers change loops into branches of a specific form. The IL compiler is a SSA compiler, just like LLVM. This video of Chandler explains a thing or two about how this works: [https://www.youtube.com/watch?v=FnGCDLhaxKU](https://www.youtube.com/watch?v=FnGCDLhaxKU)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-19T15:27:25.433

我认为这是一个营销决定..

微软希望所有类型的开发人员都使用他们的 C# 语言，如果你添加标签，它会使一些程序员的过渡更容易。它还可以更轻松地将旧代码移植到他们的语言中......

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-19T15:41:50.063

没有标签`goto`是没有用的，它们什么都不做。

使用`goto`被认为是一种不好的做法。但是有一种情况是无法避免的：跳出嵌套循环：

```
foreach(...) {
  foreach(...) {
    if(...) {
      goto OuterLabel;
    }
  }
}
OuterLabel: 
```

在这种情况下，使用该`break`语句只会破坏最内部的循环。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-19T15:50:56.143

没有它们就很难做 switch 语句。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-19T15:32:47.527

我在某处读到，goto 在大多数情况下应该只是用于向前跳转，所以很可能只是用于早期循环终止和继续外循环，因为 C# 中没有标记循环（与 Java 不同）。还有一些算法可以用 goto 优雅地表达，而不是结构化的方式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-19T15:33:07.060

有时，放置得当的“goto”比其他技术更优雅/更易读。在不需要它们时放置'goto'肯定是一种不好的做法。与往常一样，应仔细判断每种情况。

例如，当你的函数需要进行清理以防它失败时，'goto's 可能会很好。您在函数的末尾放置一个标签，您可以在其中进行清理，然后在出现故障时“转到”它。

然而，'goto's 在 C# 中变得不如在 C 中有用。例如，正确使用异常处理可以避免在某些情况下需要'goto'。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-19T15:34:28.240

标签的使用是为了支持`goto`. 可能不好`goto`，如果你有`goto`语言，那么你需要标签。没有`goto`，标签在 C# 中确实没用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-19T17:44:48.037

虽然原则上我认为该声明有合法用途，但实际上我自 C# 首次发布以来一直在使用 C# 进行开发，直到现在`goto`我才知道它*有*声明。`goto`

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-14T22:55:21.807

If (audience.LikesGoTo == true) { 转到[LabelThatSupportGoTo](http://weblogs.asp.net/stevewellens/archive/2009/06/01/why-goto-still-exists-in-c.aspx) ; } else { 转到[LabelForRejectGoTo](http://www.codethinked.com/ten-c-keywords-that-you-shouldne28099t-be-using) ; }

# iphone - 通过 App Delegate 在视图之间共享数据

> ID：662582
> 
> 赞同：1
> 
> 时间：2009-03-19T15:15:08.280
> 
> 标签：iphone, cocoa-touch

我有一个关于在视图之间共享数据的问题，希望它不是太基本。我在 appDelegate 中有一个 NSMutableArray，比如（Object1，Object2，Object3）。当创建一个新对象（并添加到数组中）时，我需要在下一个视图中访问该对象。以前我只是将对象传递给下一个视图，但这变得混乱并且似乎是错误的。

所以现在我将所有对象都放在一个地方，但是我如何在下一个视图中访问该对象（刚刚创建的），因为我不知道它被添加到哪个索引中？每次创建对象时是否需要检查数组的计数，然后从中确定数组索引并将该索引值传递给下一个视图？或者有没有办法通过某种唯一名称从 NSMutable 数组中检索对象？

另一种解决方案是遍历所有对象，直到找到我想要的对象，但我想知道这样做的正确方法是什么。感谢您的时间。

编辑：感谢您的回复，我会澄清我正在尝试做的事情。我有一个 NavigationController，您进入的每个视图都需要访问该对象。你可以把它想象成一本书。您选择要阅读的书的第一个视图，之后的每个视图都是您选择的书的一页。在 App Delegate 中是所有书籍的数组。你会通过每个“页面”查看这本书吗？

请记住，这是一个粗略的示例，因为当您选择这本书时，您已经知道它所在的索引。假设您创建了一本书，那么您还不知道它在数组中的哪个位置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T15:34:01.800

如果您可以为每个对象创建一个有意义的唯一名称，只需使用 a`NSMutableDictionary`并让控制器通过指定键来获取数据。像这样：

```
AppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];
NSString *obj = [appDelegate.dict objectForKey:@"unique-name-here"]; 
```

希望有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:22:06.867

我不确定您是在谈论在不同控件之间共享对象，还是在谈论不同的视图控制器-例如主从视图，尽管我怀疑这就是您的意思。

在这种情况下，如果您有一个专门用于编辑单个对象的详细视图，那么在我看来，给该视图控制器一个要编辑的对象并没有错。如果您正在维护一个数组，您仍然可以将新对象添加到数组中，并将该对象分配给新的视图控制器，然后再将其放在屏幕上。

如果您可以更具体地了解您的应用程序是如何工作的，我可能会给您一些更好的帮助。

# version-control - IIS 的最佳版本控制系统？

> ID：662593
> 
> 赞同：4
> 
> 时间：2009-03-19T15:18:03.680
> 
> 标签：version-control, cvs

我正在寻找一个在 Windows 或 IIS5 上运行的良好 VCS（版本控制系统，例如 CVS）（我有一个网络服务器，并且认为没有理由安装 Apache）。最好是带有 Visual Studio 集成客户端的东西，最好是免费的。这样的野兽是否存在，还是我必须购买 sourcesafe？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T15:20:51.130

我推荐[Subversion](http://subversion.tigris.org/)，它是免费的，不需要 IIS 或 Apache。在 Sourcesafe 上花了数年时间，但除了麻烦什么都没有。

您可以使用免费的[TortoiseSVN](http://tortoisesvn.tigris.org/)客户端。

对于visual studio，我使用[VisualSvn](http://www.visualsvn.com/)，它提供了一个集成插件——但它不是免费的——不过只要50美元。

虽然我相信[AnkhSvn确实提供了一个免费插件。](http://ankhsvn.open.collab.net/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T15:24:20.433

Subversion 非常好，虽然我也是 DVCS 系统（mercurial 和 GIT）的粉丝。SVN 的一大优势在于它的 GUI 工具相当成熟。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T15:26:02.240

我宁愿花几个大钱运行 TFS，然后使用源安全的免费副本。当然还有很多其他更便宜的替代品（例如 Subversion）

如果你有 Visual Studio 的团队版，你会得到一个免费版的 TFS，它可以供五个用户使用。只是一个想法，如果已经有 MSDN。

# c# - c# system.net.FileWebRequest 访问被拒绝错误

> ID：662594
> 
> 赞同：2
> 
> 时间：2009-03-19T15:18:06.067
> 
> 标签：c#, system.net

我想通过 System.Net.FileWebRequest 通过网络获取文件大小。例如：\IP\c$\sampleFile.txt

我通过将文件传递给 FilewebRequest 的凭据来提供访问文件的凭据，但下面的代码返回访问路径被拒绝错误。这里穿什么？如何通过网络访问文件？（我有访问文件的凭据）

```
 System.Net.FileWebRequest request = (System.Net.FileWebRequest)
 System.Net.FileWebRequest.Create(url);
 request.PreAuthenticate = true;
 request.Credentials = new NetworkCredential(_clientUser,_clientPass);
 FileWebResponse response = (System.Net.FileWebResponse) request.GetResponse();

 // gets the size of the file in bytes    
 Int64 iSize = response.ContentLength;
 response.Close(); 
```

* * *

## 回答 #1

> 赞同：-2
> 
> 时间：2009-03-19T15:38:33.160

看起来您尝试获取的文件在您的网络上，而不是通过 FileWebRequest 的 http 调用。

尝试：

```
FileInfo fileInfo = new FileInfo(filePath);
long fileBytes = fileInfo.Length;
long fileKBytes = fileInfo.Length / 1024; 
```

文件路径是您的 \IP\c$\sampleFile.txt。确保您的机器可以读取它。

# java - 如何设计扩展

> ID：662598
> 
> 赞同：20
> 
> 时间：2009-03-19T15:18:34.863
> 
> 标签：java, inheritance, class-design

有一个[Checkstyle](http://checkstyle.sourceforge.net/)规则[DesignForExtension](http://checkstyle.sourceforge.net/config_design.html#DesignForExtension)。它说：如果您有一个非抽象、非最终或空的公共/受保护方法，则它不是“为扩展而设计的”。阅读[Checkstyle 页面上此规则的说明以](http://checkstyle.sourceforge.net/config_design.html#DesignForExtension)了解基本原理。

想象一下这种情况。我有一个抽象类，它定义了一些字段和这些字段的验证方法：

```
public abstract class Plant {
    private String roots;
    private String trunk;

    // setters go here

    protected void validate() {
        if (roots == null) throw new IllegalArgumentException("No roots!");
        if (trunk == null) throw new IllegalArgumentException("No trunk!");
    }

    public abstract void grow();
} 
```

我还有一个植物的子类：

```
public class Tree extends Plant {
    private List<String> leaves;

    // setters go here

    @Overrides
    protected void validate() {
        super.validate();
        if (leaves == null) throw new IllegalArgumentException("No leaves!");
    }

    public void grow() {
        validate();
        // grow process
    }
} 
```

按照 Checkstyle 规则，Plant.validate() 方法不是为扩展而设计的。但是在这种情况下我该如何设计扩展呢？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-19T15:23:55.287

该规则正在抱怨，因为派生（扩展）类可能会完全替换您提供的功能而不告诉您。这是一个强烈的迹象，表明您尚未完全考虑如何扩展该类型。它希望你做的是这样的事情：

```
public abstract class Plant {
    private String roots;
    private String trunk;

    // setters go here

    private void validate() {
        if (roots == null) throw new IllegalArgumentException("No roots!");
        if (trunk == null) throw new IllegalArgumentException("No trunk!");
        validateEx();
    }

    protected void validateEx() { }

    public abstract void grow();
} 
```

请注意，现在有人仍然可以提供他们自己的验证代码，但他们无法替换您预先编写的代码。根据您打算如何使用该`validate`方法，您也可以将其设为 public final 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-12-29T11:50:34.457

尽管 Joel Coehoorn 的回答解释了如何克服 OP 发布的具体问题，但我想提出一种方法，可以更广泛地看待“如何设计扩展？” 正如 OP 在他的评论中指出的那样，给定的解决方案不能随着（类）继承深度的增加而很好地扩展。`validateTreeEx()`此外，由于明显的原因，在基类中预期需要验证可能的子类 ( ) 是有问题的。

建议：在施工时检查植物属性并`validate()`完全移除（连同可能的设置器；另见[http://www.javaworld.com/article/2073723/core-java/why-getter-and-setter-methods-are-邪恶的.html](http://www.javaworld.com/article/2073723/core-java/why-getter-and-setter-methods-are-evil.html)）。原始代码表明这是一个不变量，在每次操作`validate()`之前必须为真。`grow()`我怀疑这种设计是故意的。如果没有操作，可以在建造后“破坏”一个工厂，没有必要一遍又一遍地重新检查有效性。

更进一步，我会质疑初始继承设计的合理性。没有额外的（可能是多态的）操作，`Tree`只是重用了 Plant 的一些属性。我坚持认为，类继承不应该用于代码重用。Josh Bloch 这么说（来自 Effective Java，第 2 版，第 4 章）：

> 如果在适合组合的情况下使用继承，则不必要地暴露实现细节。生成的 API 将您与原始实现联系在一起，永远限制您的类的性能。更严重的是，通过公开内部结构，您可以让客户直接访问它们。

另请查看“第 17 项：继承的设计和文档，否则禁止它”（同一本书的第 4 章）

# perl - 如何获取 PDF 页面的页面方向？

> ID：662602
> 
> 赞同：4
> 
> 时间：2009-03-19T15:19:00.447
> 
> 标签：perl, pdf

函数 getPageDimensions（CAM::PDF）为纵向和横向页面返回相同的值。如何识别 PDF 页面的方向？我正在使用 CAM::PDF Perl 库，并且想知道如何使用这个库来做到这一点。但也欢迎任何其他方法来识别这一点（最好使用 Perl 库）。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T04:58:43.613

我是 CAM::PDF 的作者。

嗯，这有两个部分。如您所述，一个是页面的尺寸。这按预期工作：我使用 Apple 的 Preview.app 来旋转 PDF 文件并运行这两个命令行：

```
perl -MCAM::PDF -le'print "@{[CAM::PDF->new(shift)->getPageDimensions(1)]}"' orig.pdf 
0 0 612 792
perl -MCAM::PDF -le'print "@{[CAM::PDF->new(shift)->getPageDimensions(1)]}"' rotated.pdf 
0 0 792 612 
```

但是还有 `/Rotate' 页面属性。参数是度数（默认为 0，但 90 或 270 并不少见）。与页面尺寸一样，它是一个可继承的属性，因此您必须导航到父页面。这是一个快速而简单的命令行工具，用于输出旋转值：

```
use CAM::PDF;
my $filename = shift || die;
my $pagenum = shift || die;
my $pdf = CAM::PDF->new($filename) || die;
my $pagedict = $pdf->getPage($pagenum);
my $rotate = 0;
while ($pagedict) {
   $rotate = $pdf->getValue($pagedict->{Rotate});
   if (defined $rotate) {
      last;
   }
   my $parent = $pagedict->{Parent};
   $pagedict = $parent && $pdf->getValue($parent);
}
print "/Rotate $rotate\n"; 
```

# apache-flex - 使用 FunFX 解析 Flex 应用程序对象层次结构

> ID：662605
> 
> 赞同：0
> 
> 时间：2009-03-19T15:19:08.170
> 
> 标签：apache-flex, testing, automation, qa

我正在尝试测试对象没有静态 ID 的 Flex 应用程序。我想使用 FunFX 进行自动化，因为它可以很容易地从 Linux shell 中启动。

这就是说，FunFX 似乎不包含允许用户通过其父对象访问子对象的功能（例如`parent.get_child_at(<index>)`或`parent.children()`用于迭代）。我看到了返回父级下的子级*数量*的方法，但是我没有看到任何允许我解析层次结构的迭代功能。

有没有人用 FunFX 测试过一个不知道对象 ID 的黑盒 Flex 应用程序？如果是这样，您是如何完成访问各种对象和组件以驱动它们的功能的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-03T00:33:53.250

FunFX 包括[FlexSpy](http://code.google.com/p/fxspy/)工具，它允许您查看组件 ID、层次结构等。但是，不稳定的组件 ID（显然）是进行健壮测试的挫折。但是，FunFX 确实允许从“自动化名称”、“自动化值”和索引驱动组件。所以，还是有些希望的。:)

# internet-explorer - IE8中PNG的背景颜色

> ID：662616
> 
> 赞同：18
> 
> 时间：2009-03-19T15:21:26.230
> 
> 标签：internet-explorer, internet-explorer-8, png

我有以下徽标，它显示为与 FF3、Chrome (#363636) 中的 HTML 正文相同的背景颜色。

但在 IE8 中，它显示不同的、较暗的颜色。

这个 FF3/Chrome 是原谅我的 PNG，还是只是另一个 IE 错误（我认为他们修复了 IE7 中的 PNG 支持）？

**更新**：我仍然遇到这个问题，我用来纠正它的 pngcrush 参数是：

> pngcrush -replace_gamma 0.5181347 infile.png outfile.png

Win32 二进制链接在[这里](http://sourceforge.net/projects/pmt/files/pngcrush-executables/1.7.9/pngcrush-1.7.9-win32.zip/download)。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-19T16:59:20.800

您的 PNG 中有一个伽马校正信息（gAMA 块）结构。如果您正在处理需要伽玛校正的照片，那很好，但这对于网络来说不是正确的。

在网络上，浏览器通常不会对 HTML/CSS 颜色或其他图像应用 gamma 校正，因此如果您使用 gamma 校正，您的 PNG 上的结果将与页面的其余部分不一致。出于这个确切原因，某些浏览器不应用 PNG gamma，这就是您获得可变结果的原因。

将徽标加载到图像编辑器中并在没有 gAMA 块信息的情况下将其保存回来。[更多](http://morris-photographics.com/photoshop/articles/png-gamma.html)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-09-19T18:52:10.143

这里评价最高的答案建议使用 pngcrush 将伽马值重置为 0.5181347。这可能适用于某些领域，但在我们的情况下，您最好的方法是从 PNG 中去除所有颜色空间信息，以便它完全呈现在浏览器用于 CSS 中颜色的相同中性 RGB 三元组空间中：

```
pngcrush -rem cHRM -rem gAMA -rem iCCP -rem sRGB infile.png outfile.png 
```

对于真正的色头来说，这意味着您设计的原始颜色可能在另一台显示器或操作系统上看起来不一样，但您所有具有相同 RGB 值的颜色将根据浏览器为每个用户呈现相同的方式+操作系统他们在。具体来说，与 PNG 相邻的背景或相邻颜色将匹配，因此您可以使用互锁的图像和颜色设计您的网站。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-08T12:48:16.930

我已经讨论了[Internet Explorer 中的 PNG 颜色问题](http://salman-w.blogspot.com/2011/03/png-color-problem-in-ie.html)及其屏幕截图解决方案。解决方案是从 PNG 图像中删除 gamma 块（例如使用 TweakPNG 实用程序）。这使得图像在 Internet Explorer 中以正确的阴影呈现。一些不常见的浏览器可能仍会出现异常行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T13:22:19.623

您需要从 PNG 中删除 gAMA 和 sRGB 块。此外，您需要删除附加到图像的任何 ICC 颜色/颜色配置文件。

Photoshop“保存到 Web”添加了一个标准的 sRGB ICC 配置文件 - 这对于**内容**图像非常有用，但对于需要与 CSS 颜色匹配的图像样式则完全错误。

这在 Safari 中尤其明显——我有一篇关于它的[博客文章](http://blog.jiffle.net/post/99636502/png-jpg-color-matching)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-26T20:41:14.353

我在所有 IE 中都注意到了这个问题——6、7、8。一些 PNG 图像在透明区域周围会有黑色轮廓。原来我必须打开 Gimp（我的免费跨平台图像编辑器），打开有问题的 PNG，然后使用 150% 上的模糊选择工具重新选择透明区域，然后单击删除。然后重新保存。这通常可以解决大约 98% 的透明区域中 PNG 周围的斑点。

如果这不起作用，则在 Gimp 中重新加载，将背景设置为白色，选择拼合图像，将模糊选择阈值设置为 3%，选择要删除的背景，选择删除（清除），然后再次重新选择背景阈值为 150%，删除，然后重新保存图像。

注意我的模糊选择工具，我的 Gimp 设置是选中抗锯齿，取消选中羽化边缘，选中选择透明区域，取消选中样本合并，然后按合成选择。

是的，这似乎是一个带有透明背景的 PNG 图像的 IE 错误。其他浏览器——Opera、Safari、Firefox、Chrome——都没有这个问题。我怀疑某些图像程序将透明度设置为 50% 作为边缘上某种抗锯齿的一部分，因为只有边缘有问题。我认为非 IE 浏览器处理像素上 50% 的透明度，但 IE 可能只能理解像素上的 100% 透明度——只是一种预感。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-08T09:34:59.483

这是唯一对我有用的解决方案：http: [//forum.jquery.com/topic/transparent-png-shows-black-edges-in-ie8](http://forum.jquery.com/topic/transparent-png-shows-black-edges-in-ie8)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-12T23:20:27.700

知道使用[Yahoo Smushit](http://www.smushit.com/ysmush.it/)优化网络图像为我纠正了这个问题，这可能对其他人有用（一般来说，通过这个或类似的方法运行图像是一个好主意）。

# python - 使用 minidom 修改时保留属性顺序

> ID：662624
> 
> 赞同：12
> 
> 时间：2009-03-19T15:23:11.047
> 
> 标签：python, xml, minidom

在使用 minidom 处理 XML 时，有没有办法可以保留属性的原始顺序？

假设我有：`<color red="255" green="255" blue="233" />` 当我用 minidom 修改它时，属性按字母顺序重新排列为蓝色、绿色和红色。我想保留原来的顺序。

我通过遍历返回的元素来处理文件，`elements = doc.getElementsByTagName('color')`然后我做这样的分配`e.attributes["red"].value = "233"`。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-12-01T17:00:35.210

为了保持属性顺序，我做了这个微小的修改：

```
from collections import OrderedDict 
```

在元素类中：

```
__init__(...)
    self._attrs = OrderedDict()
    #self._attrs = {}
writexml(...)
    #a_names.sort() 
```

现在这只适用于 Python 2.7+ 而且我不确定它是否真的有效 => 使用风险自负......

请注意，您不应依赖属性顺序：

*请注意，开始标签或空元素标签中属性规范的顺序并不重要。*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-19T15:42:55.117

> 在使用 minidom 处理 XML 时，有没有办法可以保留属性的原始顺序？

使用 minidom no，用于存储属性的数据类型是无序字典。[pxdom](http://www.doxdesk.com/software/py/pxdom.html)可以做到，尽管速度要慢得多。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-06T08:36:58.840

很明显，xml 属性没有排序。我刚刚发现了这种奇怪的行为！

似乎这与 xml.dom.minidom.Element.writexml 函数中添加的排序有关！

```
class Element(Node):
... snip ...

    def writexml(self, writer, indent="", addindent="", newl=""):
        # indent = current indentation
        # addindent = indentation to add to higher levels
        # newl = newline string
        writer.write(indent+"<" + self.tagName)

        attrs = self._get_attributes()
        a_names = attrs.keys()
        a_names.sort()
--------^^^^^^^^^^^^^^
        for a_name in a_names:
            writer.write(" %s=\"" % a_name)
            _write_data(writer, attrs[a_name].value)
            writer.write("\"") 
```

删除该行将恢复保持原始文档顺序的行为。当您必须使用差异工具检查代码中没有错误时，这是​​一个好主意。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-08T09:47:45.260

在 Python 2.7 之前，我使用了以下*热补丁*：

```
class _MinidomHooker(object):
    def __enter__(self):
        minidom.NamedNodeMap.keys_orig = minidom.NamedNodeMap.keys
        minidom.NamedNodeMap.keys = self._NamedNodeMap_keys_hook
        return self

    def __exit__(self, *args):
        minidom.NamedNodeMap.keys = minidom.NamedNodeMap.keys_orig
        del minidom.NamedNodeMap.keys_orig

    @staticmethod
    def _NamedNodeMap_keys_hook(node_map):
        class OrderPreservingList(list):
            def sort(self):
                pass
        return OrderPreservingList(node_map.keys_orig()) 
```

这样使用：

```
with _MinidomHooker():
    document.writexml(...) 
```

免责声明：

1.  你不应该依赖属性的顺序。
2.  改变 NamedNodeMap 类不是线程安全的。
3.  *热补丁*是邪恶的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-03-10T15:02:13.600

你们可以提出尽可能多的免责声明。虽然重新排序属性对程序没有意义，但它对程序员/用户确实有意义。

对于 Fredrick 来说，拥有 RGB 顺序很重要，因为这就是颜色的顺序。对我来说，特别是 name 属性。

比较

```
<field name="url" type="string" indexed="true" stored="true" required="true" multiValued="false"/> <!-- ID -->
<field name="forkortelse" type="string" indexed="true" stored="true" required="false" multiValued="false" />
<field name="kortform" type="text_general" indexed="true" stored="true" required="false" multiValued="false" />
<field name="dato" type="date" indexed="true" stored="true" required="false" multiValued="false" />
<field name="nummer" type="int" indexed="true" stored="true" required="false" multiValued="false" />
<field name="kilde" type="string" indexed="true" stored="true" required="false" multiValued="false" />
<field name="tittel" type="text_general" indexed="true" stored="true" multiValued="true"/> 
```

反对

```
<field indexed="true" multiValued="false" name="forkortelse" required="false" stored="true" type="string"/>
<field indexed="true" multiValued="false" name="kortform" required="false" stored="true" type="text_general"/>
<field indexed="true" multiValued="false" name="dato" required="false" stored="true" type="date"/>
<field indexed="true" multiValued="false" name="nummer" required="false" stored="true" type="int"/>
<field indexed="true" multiValued="false" name="kilde" required="false" stored="true" type="string"/>
<field an_optional_attr="OMG!" an_optional_attr2="OMG!!" indexed="true" name="tittel" stored="true" type="text_general"/> 
```

虽然阅读并非不可能，但它并不容易。名称是重要的属性。隐藏名称字段是不好的。如果名称是左边的 15 个属性，而前面的 7 个属性是可选的呢？

关键是重新排序是一个比递增排序所带来的问题更大的问题。它与程序员的思维方式或功能应该如何工作相混淆。至少排序应该是可配置的/可选的。

原谅我糟糕的英语。它不是我的主要语言。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-17T10:37:44.680

**1.自定义你自己的'Element.writexml'方法。**

从 'minidom.py' 将 Element 的 writexml 代码复制到您自己的文件中。

将其重命名为 writexml_nosort，

删除 'a_names.sort()' (python 2.7) 或将 'a_names = sorted(attrs.keys())' 更改为 'a_names = attrs.keys()' (python 3.4)

将 Element 的方法更改为您自己的方法：

minidom.Element.writexml = writexml_nosort;

**2.自定义您喜欢的订单：**

right_order = ['a', 'b', 'c', 'a1', 'b1']

**3.调整你元素的 _attrs**

node._attrs = OrderedDict( [(k,node._attrs[k]) for k in right_order ])

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-16T13:02:01.827

使用类 Element 中的 writexlm 函数编写时，属性按最小顺序排列。它是这样完成的：

```
a-name = sorted(attrs.keys()) 
```

您可以将其更改为

```
a-name = list(attrs.keys()) 
```

对于空闲，我不得不将文件更改为 `/usr/lib/python3.6/xml/dom`. 似乎 Idle 不遵循`sys.path`顺序。不要忘记先备份。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-04-17T08:51:58.963

> 在使用 minidom 处理 XML 时，有没有办法可以保留属性的原始顺序？

是的。从 Python 3.8 开始，序列化 XML 文档时会保留原始属性顺序。

请参阅[https://docs.python.org/3/library/xml.dom.minidom.html#xml.dom.minidom.Node.writexml](https://docs.python.org/3/library/xml.dom.minidom.html#xml.dom.minidom.Node.writexml)。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-06-13T00:11:41.523

我最终使用了[lxml](http://codespeak.net/lxml/)库而不是 minidom。

# javascript - javascript 表单 - 绕过 ajax 的默认行为

> ID：662630
> 
> 赞同：1
> 
> 时间：2009-03-19T15:25:47.967
> 
> 标签：javascript, html, ajax

我正在尝试使用下面的代码。我想要的是获取选择了哪个单选按钮的值，并将其发送回 javascript 方法。我尝试的任何变化似乎都失败了。

```
<html>
  <head>
    <style type="text/css">
      body { background-color: black; color: white; }
    </style>
    <script type="text/javascript">
      function handleClick(event)
      {

        alert(this.textBox1.value);

        event.preventDefault(); // disable normal form submit behavior
        return false; // prevent further bubbling of event
      }

    </script>
  </head>
  <body">
    <form name="myform">
      <div>
 <input type="radio" name="test1" value="Cheese">
 <input type="radio" name="test2" value="Grapes">
 <input type="radio" name="test3" value="Crackers">
      </div>
      <input type="submit" onsubmit=JavaScript:handleClick(value) value="Update"/>
    </form>
  </body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-30T21:15:44.833

你的代码被剪掉了，但我认为你想做这样的事情：

```
<html>
<head>
    <script type="text/javascript">
        function alertThing() {
            alert(document.getElementsByName('textBox1')[0].value);
            return false;
        }
    </script>
</head>
<body>
    <form action="myPage.php" method="post" onsubmit="return alertThing();">
        <input type="text" name="textBox1" value="hello" />
        <input type="submit" value="Submit the form!" />
    </form>
</body>
</html> 
```

这将提醒该值，但不会提交表单。希望我对你有所帮助！

//Linus Unnebäck

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T16:08:41.933

如果您谈论的是您在[其他问题](https://stackoverflow.com/questions/638629/)中发布的相同通用代码，我相信您必须遍历可能的单选按钮；没有内置 whichRadioButtonIsSelected() 函数。

你可以这样做：

```
function getRadioButtonValue(rbutton)
{
  for (var i = 0; i < rbutton.length; ++i)
  { 
    if (rbutton[i].checked)
      return rbutton.value;
  }
  return null;
}

// then in your code, where "this" is the form object, and 
var rbvalue = getRadioButtonValue(this.radiobutton);
// replace "radiobutton" with whatever the radiobutton group's name is 
```

**编辑：**这是一个例子：

```
<html>
  <head>
    <style type="text/css">
      body { background-color: black; color: white; }
    </style>
    <script type="text/javascript">
      function getRadioButtonValue(rbutton)
      {
        for (var i = 0; i < rbutton.length; ++i)
        { 
          if (rbutton[i].checked)
            return rbutton[i].value;
        }
        return null;
      }

      function handleClick(event)
      {
        if (console) console.info("handling click");  
        // for Firebug debugging, if you want it

    /* do something here */
        alert(this.textBox1.value);
        alert("Favorite weird creature: "+getRadioButtonValue(this["whichThing"]));
        // I don't like alerts but it works everywhere

        if (console) console.info("handled click");  

        event.preventDefault(); // disable normal form submit behavior
        return false; // prevent further bubbling of event
      }
      function doit()
      {
        if (console) console.info("starting doit()");
        document.forms.myform.addEventListener("submit", handleClick, true);
        return true;
      }
    </script>
  </head>
  <body onload="doit()">
    <form name="myform">
      <div>
          <textarea name="textBox1" rows="10" cols="80">
'Twas brillig, and the slithy toves
Did gyre and gimble in the wabe;
All mimsy were the borogoves,
And the mome raths outgrabe.
         </textarea>
      </div>
      <input type="submit" value="Update"/>
      Which of the following do you like best?
      <p><input type="radio" name="whichThing" value="slithy toves" />Slithy toves</p>
      <p><input type="radio" name="whichThing" value="borogoves" />Borogoves</p>
      <p><input type="radio" name="whichThing" value="mome raths" />Mome raths</p>
    </form>
  </body>
</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T04:00:20.663

If it were me I would use a framework like JQUERY. Every radio button matching the selector "form input:radio" (and you can be very precise with selectors) will be associated with the doThis function. I made doThis a separate function but that was just for clarity.

below will work as is, however if you do use JQUERY, get a local copy.

```
<html>
<body>
    <form>
      IAMFOO <input type="radio" name="foobar" value="foo"/>
      IAMBAR <input type="radio" name="foobar" value="bar"/>
    </form>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
<script type="text/javascript">
   function dothis() {
    alert(this.value);
  }
  $(document).ready(function(){
    $("form input:radio").click(dothis)
  });
</script>

</body>
</html> 
```

# c# - 如何从 C# 更改 IIS 中 ApplicationPool 的用户名/密码？

> ID：662634
> 
> 赞同：2
> 
> 时间：2009-03-19T15:26:39.010
> 
> 标签：c#, .net, iis, wmi, iis-6

我正在使用下面的代码在我的应用程序的 Installer 类中创建一个新的应用程序池：

```
private static void CreateAppPool(string serverName, string appPoolName)
{
    //  metabasePath is of the form "IIS://<servername>/W3SVC/AppPools"
    //    for example "IIS://localhost/W3SVC/AppPools" 
    //  appPoolName is of the form "<name>", for example, "MyAppPool"
    string metabasePath = string.Format("IIS://{0}/W3SVC/AppPools", serverName);
    Console.WriteLine("\nCreating application pool named {0}/{1}:", metabasePath, appPoolName);
    try
    {
        DirectoryEntry apppools = new DirectoryEntry(metabasePath);
        DirectoryEntry newpool = apppools.Children.Add(appPoolName, "IIsApplicationPool");
        newpool.CommitChanges();
        Console.WriteLine("AppPool created.");
    }
    catch (Exception ex)
    {
        Console.WriteLine("Failed in CreateAppPool with the following exception: \n{0}", ex.Message);
    }
} 
```

如何更改运行此应用程序池的用户凭据？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T15:32:35.470

在您创建的行之后将以下内容添加到您的代码中`newpool`：

```
DirectoryEntry newpool = 
            apppools.Children.Add(appPoolName, "IIsApplicationPool");
// Add this:
newpool.Properties["AppPoolIdentityType"].Value = 3;
newpool.Properties["WAMUserName"].Value = 
            Environment.MachineName + @"\" + username;
newpool.Properties["WAMUserPass"].Value = password; 
```

您显然还需要添加字符串变量`username`和`password`方法`CreateAppPool()`参数。

如果您还不知道，您需要做的另一件事是确保您的应用程序池用户获得足够的权限来访问 IIS 元数据库、ASP.NET 临时文件夹等。您可以通过运行以下命令来完成此操作：

```
aspnet_regiis.exe -ga <username> 
```

您可以在文件夹中找到此工具`%SYSTEMROOT%\Microsoft.NET\Framework\v2.0.50727`。我通常只是使用`System.Diagnostics.Process`.

最后，应用程序池用户将需要（至少）对应用程序的 web 文件夹具有读取权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T17:46:49.547

```
aspnet_regiis.exe -ga <username> 
```

可能不是最好的命令。

您应该将 APPPool 用户添加到 IIS_WPG 组并使用该组授予权限。

# javascript - 嵌入式 IE 中的 TinyMCE 未收到输入按键

> ID：662635
> 
> 赞同：0
> 
> 时间：2009-03-19T15:26:50.413
> 
> 标签：javascript, internet-explorer, tinymce

抱歉，如果这个问题有点晦涩难懂，我一直在努力解决这个问题，而且我的想法已经不多了，所以我希望这里有人可以提供帮助。

我正在尝试在 IE 的嵌入式实例中使用 TinyMCE。奇怪的是，它不处理输入/返回按键。如果我这样做，肯定会收到返回按键：

```
tinyMCE.init({
    setup : function(ed) {
      ed.onKeyDown.add(function(ed, e) {
       if (e.keyCode == 13) {
         ed.execCommand('mceInsertContent',false,'Hello World!');
       }
      });
     },
... 
```

然后是“你好世界！” 插入到我的光标所在的任何位置。我想一个合理的做法是`execCommand`通过调用 TinyMCE 在输入按键时执行的任何代码来替换 。有谁知道该功能是什么，以及是否可以访问？如果没有，是否有人有其他想法？

谢谢，

多姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T14:45:48.327

原来这是因为嵌入式 IE 所在的窗口正在吞噬按键。

# jquery - 根据值更改字段

> ID：662636
> 
> 赞同：0
> 
> 时间：2009-03-19T15:27:07.103
> 
> 标签：jquery, input

假设我有一个带有 10 个预定义数量的选择框和一个“其他”选项。如果我选择“其他”，我会得到一个输入框来给出金额。当我离开该字段时，我将选择框的值设为输入框中输入的金额。我将如何使用 jquery 来做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T15:34:39.317

添加此项，以便在您离开输入时在选择框中创建一个新选项：

```
$("input#other-value").blur(function (){
    // Create new option
    $("<option>") 
        // Assign value and text
        .val($(this).val())
        .text($(this).val())
        // Append before the "other" option
        .insertBefore("select@select-id option[value=other]");
}); 
```

另外，请将您满意的答案用左侧的支票标记为“已接受”。如果你不这样做，问题就会悬而未决，没有人知道真正的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:36:50.153

我假设“选择框”等同于 HTML 的“选择”标签。这里的“otherInpute”是一个文本输入框，“someSelect”是一个 HTML 的“选择”标签。

```
var val = $("#otherInput").val();
$("#someSelect option:selected").text(val) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T15:43:29.513

```
var val = $("#otherInput").val(); 
```

$("#someSelect option:selected").text(val)

# asp.net - Asp.Net 网站结构问题

> ID：662637
> 
> 赞同：1
> 
> 时间：2009-03-19T15:27:16.247
> 
> 标签：asp.net, web-applications, structure

我最近有一个项目，我需要在 asp.net 中创建一个 Web 应用程序。这是我的第一个大项目，所以我想我会问你们关于如何去做这件事的意见。我计划在这个项目中使用 asp.net 网络表单。该应用程序需要一堆相似的摘要页面（除了一些不同的控件），它们显示一个项目或一个人或一本书等的摘要列表。还有一个详细屏幕视图，它将允许用户添加/更新数据库中的记录。详细信息页面在外观和感觉上相似，但它们每个都有与项目/人/书有关的不同输入控件。创建这样的网络应用程序的最佳方法是什么？现在我有 10-15 个内容摘要页面、10-15 个内容详细信息页面和几个母版页。

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T15:32:34.020

您应该不断问自己的问题是“我是否尽可能地简化了维护？”。

如果你牢记这一点（答案是肯定的）你应该没问题。我相信你会得到很多关于如何构建你的网站的意见（更多的用户控件、更多的母版页、MVC 等），虽然其中一些可能是有效的，但解决方案必须为你工作，因为你是使用它的人.

如果它满足您的需求，那么采用简单/简单的方法并没有错。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T16:46:02.453

如果您的摘要页面都相同，并且您的详细信息页面都相同（除了内容），您应该将它们中的每一个都设为一页（即 summary.aspx、detail.aspx）并动态填充值。通过这种方式，您可以获得可扩展性，而无需在添加其他产品/任何内容时重新参与。

根据涉及多少代码和标记，将两者进一步合并为一个可能是可行的。这是你必须打的电话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:54:30.873

我目前正在开发一个在许多页面上使用声明屏幕的网络应用程序，我使用用户控件并将其放在许多页面上。然后，您可以向每个特定页面添加任何附加功能。当您获得用户控件的图形设计时，这是一种很好的方法。母版页也是一个很棒的功能。保持简单，但..不要简单到你一遍又一遍地复制相同的代码。那是不行的。

祝你好运。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T16:56:37.140

我认为你有正确的方法。为每个列表创建一个详细信息页面。或者，您可以使用单个列表和详细信息页面，并使用查询字符串来获取相关数据。不过取决于你。

# python - 如何将拍摄的文档更改为“扫描”

> ID：662638
> 
> 赞同：6
> 
> 时间：2009-03-19T15:27:18.493
> 
> 标签：python, image-processing, python-imaging-library, image-scanner

我怎样才能在 Python/PIL 中[做到这一点？](http://www.techcrunch.com/2009/03/17/jotnot-turns-your-iphones-camera-into-a-document-scanner/)即，给定一个偏移矩形（一张照片文件）的四个点，让它看起来像被扫描一样平坦。有简单的算法吗？

另外，我应该做任何其他操作以使其看起来更像“扫描”吗？

我想用 Python 为自己制作这个程序的简单版本。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T15:37:38.140

查看 transform() 方法设置为 QUAD

[http://effbot.org/imagingbook/image.htm](http://effbot.org/imagingbook/image.htm)

> ```
> im.transform(size, QUAD, data) => image
> im.transform(size, QUAD, data, filter) => image 
> ```
> 
> 将图像中的四边形（由四个角定义的区域）映射到具有给定大小的矩形。
> 
> 数据是一个 8 元组 (x0, y0, x1, y1, x2, y2, y3, y3)，其中包含源四边形的左上角、左下角、右下角和右上角。

# python - Windows 机器上的 subprocess.call 帮助

> ID：662641
> 
> 赞同：3
> 
> 时间：2009-03-19T15:27:59.520
> 
> 标签：python, trac, python-2.4

我正在尝试修改一个允许将 wiki 页面下载到 word 文档的[trac插件。](http://trac.edgewall.org)pagetodoc.py 在这一行抛出异常：

```
# Call the subprocess using convenience method
retval = subprocess.call(command, shell=True, stderr=errptr, stdout=outptr, close_fds = True) 
```

说这`close_fds`在 Windows 上不受支持。该过程似乎在 C:\Windows\Temp 中创建了一些临时文件。我尝试删除`close_fds`参数，但随后子进程写入文件以无限期保持打开状态。稍后写入文件时会引发异常。这是我第一次使用 Python，我对这些库并不熟悉。这更加困难，因为大多数人可能在 Unix 机器上编写代码。有什么想法可以修改这段代码吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T16:59:33.107

`close_fds` *[**is** supported on Windows](http://docs.python.org/library/subprocess.html#subprocess.Popen)* (search for "close_fds" after that link) starting with Python 2.6 (if `stdin`/`stdout`/`stderr` are not redirected). You might consider upgrading.

**UPDATE 2017-11-16 after a down vote (why?)**: From the linked doc:

> Note that on Windows, you cannot set close_fds to true and also redirect the standard handles by setting stdin, stdout or stderr.

So you can either `subprocess.call` with `close_fds = True` and not setting `stdin`, `stdout` or `stderr` (the default) (or setting them to `None`):

> `subprocess.call(command, shell=True, close_fds = True)`

or you `subprocess.call` with `close_fds = False`:

> `subprocess.call(command, shell=True, stderr=errptr, stdout=outptr, close_fds = False)`

or (Python >= 3.2) you let `subprocess.call` figure out the value of `close_fds` by itself:

> `subprocess.call(command, shell=True, stderr=errptr, stdout=outptr)`

# java - 我想上传 .csv 文件到 servlet 并解析它，但不知道如何打开上传的文件

> ID：662642
> 
> 赞同：0
> 
> 时间：2009-03-19T15:28:16.883
> 
> 标签：java, servlets

我有一个允许用户选择 .csv 文件并将其发布到 servlet 的表单。但是，我很难从服务器上的 Java Servet 获取文件的句柄有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T15:33:52.003

我推荐使用[Apache Commons FileUpload](http://commons.apache.org/fileupload/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:33:51.567

我自己和其他人经常犯的一个错误是在 HTML 中，而不是在服务器端。确保您的表单标签中有 enctype="multipart/form-data" 。

如果没关系，请参阅：

[http://coldjava.hypermart.net/servlets/upload.htm](http://coldjava.hypermart.net/servlets/upload.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-24T09:28:09.000

尝试使用 OpenCSV 读取和解析 CSV 文件。我刚试过。这非常简单快捷。它也具有商业友好的许可证。因此，您也可以使用它作为您的生产代码。

查看此链接 [http://opencsv.sourceforge.net/](http://opencsv.sourceforge.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-15T09:00:12.683

您无法打开您上传的文件。您需要使用输入流来解析文件。并且

> “确保你的表单标签中有 enctype="multipart/form-data"”</p>

在java编程中，任何上传文件都可以使用io来解析。当你使用servlet解析文件时，使用request.getInputStream。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2011-05-11T06:00:00.773

要将您的 csv 文件上传到任何一个数据库中，您必须首先通过浏览并选择文件将文件保存在文件夹中。然后您必须使用 FileInputStream 类读取 csv 文件中的所有列...

通过在程序中使用此代码 **FileInputStream fis=new FileInputStream(pathheader); FileOutputStream fos=new FileOutputStream(filenamehdr);**

更多检查在这里..[使用 Servlets 上传 CSV 文件](http://javabynataraj.blogspot.com/2011/04/upload-csv-file-into-mysql-database.html)

# iphone - iPhone 应用程序中的单选按钮

> ID：662646
> 
> 赞同：13
> 
> 时间：2009-03-19T15:28:51.047
> 
> 标签：iphone

我必须在我的 iPhone 应用程序中添加单选按钮。为此，我有圆形的单选按钮图像。我可以将该图像添加为子视图吗？我可以将 touchupinside 事件添加到 UIImage 吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-19T15:48:05.900

iPhone 应用程序没有单选按钮。“类似 iPhone”的方法是使用选择器视图或在分组表视图中包含几行，并在所选行上带有检查附件。

如果出于某种原因你真的，真的觉得需要有单选按钮，请使用带有自定义按钮类型的 UIButton。将空圆圈设置为“正常”控制状态的图像，将实心圆圈设置为“选中”状态的图像。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-09T05:14:03.720

尝试[UISegmentedControl](http://developer.apple.com/library/ios/#documentation/UIKit/Reference/UISegmentedControl_Class/Reference/UISegmentedControl.html#//apple_ref/doc/uid/TP40006807 "UISegmentedControl")。它的行为类似于单选按钮——呈现一系列选项并让用户选择 1。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-19T02:10:33.527

```
IBOutlet UIButton *checkboxButtonMale; 

IBOutlet UIButton    *checkboxButtonFmale;

  checkboxButtonFmale.tag = 3;
  checkboxButtonMale.tag = 2; 

(IBAction)checkboxGenderChecked:(id)sender{ 

    UIButton *selectedButton = (UIButton *)sender;
    UIButton    *toggledButton; 

    if (selectedButton.tag == 2 ) { 
        toggledButton =    checkboxButtonFmale;
    } 
    else {      
        toggledButton = checkboxButtonMale; 
    }   [toggledButton    setSelected:NO]; 
    [sender setSelected:YES];
       } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T16:03:29.653

您还可以创建一个 UIWebView，将使用单选按钮的 HTML 加载到其中，然后使用 UIWebView 委托方法监视单选值。

这是一种 hack，但在某些情况下，这正是我们所需要的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-31T11:48:41.120

您可以使用 s 数组`UIButton`，然后使用我的[GSRadioButtonSetController](https://github.com/goosoftware/GSRadioButtonSetController)类来处理逻辑（本质上，确保只能选择一个按钮）。有关示例用法，请参阅 GitHub 上的 README。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T15:47:49.300

您可以尝试使用仅将 UIImage 包装在 UIView 容器内的 UIImageView 类。它支持我认为合适的 touchesBegan/Cancelled 事件。

您可能还考虑不使用您所描述的真正的单选按钮设置，而是使用更类似于 iPhone 的方法 - 例如，使用 UITableView 与对应于您的单选选择的单元格并在选中/取消选中切换触碰。有关示例，请参阅 Apple iPhone 开发网站上的 TouchCells 示例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-19T04:48:27.093

如果您只有“是”或“否”选项，请使用 UISwitch。

对于多种类型，请使用以下代码：

```
-(void)buttonPressed:(id)sender{

if([sender isSelectd])

//here change button image and set

[sender setSelected:NO];

}else{
//here change button image and set

[sender setSelected:YES];

} 
```

请记住，当您创建按钮时，不要忘记将 setSelected 设置为 NO。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-05-02T13:13:46.310

iPhone 应用程序中没有任何 RadioButton 控件。

虽然您可以查看以下链接以获取 RadioButton。

在这里，我们放置了两个图像来代替 RadioButtons。

[http://www.developers-life.com/radio-buttons-in-iphone-application.html](http://www.developers-life.com/radio-buttons-in-iphone-application.html)

享受编码......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-08T15:17:58.323

我做了这样的事情并且它有效：

```
- (IBAction)tickbuttonClicked:(id)sender
{

UIButton *selectedButton = sender;
UIImage *ticked   = [UIImage imageNamed:@"tickbox_yes3.png"];   
UIImage *unticked = [UIImage imageNamed:@"tickbox_no3.png"];    

    //untick active box
    if((activetag>-1)&&(activetag!=[sender tag])){
        UIButton *thisButton = (UIButton *)[self.view viewWithTag:activetag];
        thisButton.backgroundColor  = [UIColor colorWithPatternImage:unticked];
    }

 //tick sender
 if ([sender tag]!=activetag)
 {
    selectedButton.backgroundColor = [UIColor colorWithPatternImage:ticked]; 
    activetag=[sender tag];   
    [selectedButton setSelected:YES];

 }

} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-12-24T08:28:51.217

//定义按钮属性

**声明未更改的图像**

```
 - (void)viewDidLoad
   {
       [ButtonChaked setBackgroundImage:[UIImage imageNamed:@"UnChacked.png"] forState:UIControlStateNormal];
    } 
```

**查过的图像**。

```
 - (IBAction)ButtonChaked:(id)sender
 {
    if (ButtonChaked.selected ==YES)
    {
      [ButtonChaked setBackgroundImage:[UIImage imageNamed:@"UnChacked.png"] forState:UIControlStateSelected];

    ButtonChaked.selected =NO;

 }
 else
 {
    [ButtonChaked setBackgroundImage:[UIImage imageNamed:@"Chaked.png"] forState:UIControlStateNormal];
    ButtonChaked.selected = YES;

 }

} 
```

真的用过

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-08T13:17:04.267

我刚刚在 Cocoapods 上发布了一个 iOS Radio Button 控件`pod "DLRadioButton"`，文档和示例请到[GitHub](https://github.com/DavydLiu/DLRadioButton)。附件是此控件的屏幕截图。![在此处输入图像描述](https://i.stack.imgur.com/X1139.png)

# macos - 是否可以从 Windows 远程“协助”Mac OS 10.3.9 系统？

> ID：662648
> 
> 赞同：-1
> 
> 时间：2009-03-19T15:28:55.697
> 
> 标签：macos, remote-desktop, remote-access

我需要帮助我的电脑问题阿姨为她的 OS 10.3.9 系统设置一台新打印机。过去，我在 Windows 上使用过 TeamViewer，它非常简单易用……这正是我在这种情况下所需要的。

我知道 TeamViewer 有一个 OS X 版本，但它至少需要 10.4。

任何人都知道一个非常简单的连接远程“辅助”解决方案，适用于 10.3.9？VNC 不适合我，因为它需要在她端进行配置，老实说这是不可能的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T13:44:41.930

我找到了解决方案。显然 Vine Server v2.2 与 10.3.9 配合得很好。最新[版本](http://sourceforge.net/projects/osxvnc/)(3.0) 仅适用于 10.4 及更高版本。

你可以在这里下载这个旧版本的[Vine Server (2.2)](http://mac.majorgeeks.com/download5079.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-14T14:10:55.597

Apple 有一个远程桌面工具（可能必须明确下载），它允许它作为 VNC 服务器工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T15:34:13.670

您可以使用 Fog Creek 的 Copilot。

[https://www.copilot.com/faq/#t1](https://www.copilot.com/faq/#t1)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-16T02:02:29.077

+1 苹果远程桌面。这将是最可靠的“官方”支持的解决方案。远程桌面很不错，但要花钱。最后，您最好通过 iChat 屏幕共享升级到 Leopard。Leopard 即使在旧的 powerPC 系统上也能正常运行。

你也可以考虑廷巴克图

[http://www.netopia.com/software/products/tb2/](http://www.netopia.com/software/products/tb2/)

# javascript - 函数参数

> ID：662649
> 
> 赞同：9
> 
> 时间：2009-03-19T15:29:00.563
> 
> 标签：javascript, scope

```
function Foo(f) {
   var f = f;    
} 
```

在函数内部，变量`f`是局部的`Foo`（它具有函数范围），但是为什么`f`参数列表中的变量没有冲突？也许是因为它绑定在`Foo.arguments`对象内部？

在其他语言中，我们不能声明与局部变量同名的参数变量。

如何解决此名称歧义？或者，您如何`f`在该方法的后面引用这两个不同的变量中的每一个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T16:16:05.303

JavaScript 做了几件显然不是很直观的事情——你感兴趣的事情叫做“提升”——JS 将 var 声明移动到函数的顶部，它们的唯一目的是将这个变量名保留为函数范围内的局部变量。有时，这会导致[很多奇怪](http://calculist.blogspot.com/2005/12/dynamic-scope.html)。如果变量名已被保留为局部变量（例如，它是一个参数），则 var 声明将被完全删除。

JS 的另一个不直观的部分是它如何处理参数变量和`arguments`对象（这有点特殊，如 Hippo 所示）。不过，这不一定是您感兴趣的 - 对于您的示例来说重要的是参数还将该变量名称声明为函数的本地变量。

所有这一切的结果是，当您拥有 a`var f`和参数 name`f`时，`var f' 被删除，您的示例等效于：

```
function Foo(f) {
   f = f;
} 
```

您可以在 Hippo 的示例中看到这一点，因为：

```
function foo(f) {
    console.log(f); // --> 11
    console.log(arguments); // --> array [11]
    var f = 10;
    console.log(f); // --> 10
    console.log(arguments); // --> [10] (!!!)
} 
```

相当于：

```
function foo(f) {
    var f;
    console.log(f); // --> 11
    console.log(arguments); // --> array [11]
    f = 10;
    console.log(f); // --> 10
    console.log(arguments); // --> [10] (!!!)
} 
```

相当于：

```
function foo(f) {
    console.log(f); // --> 11
    console.log(arguments); // --> array [11]
    f = 10;
    console.log(f); // --> 10
    console.log(arguments); // --> [10] (!!!)
} 
```

有关更多详细信息，请阅读JS 规范[ECMA-262中的第](http://www.ecma-international.org/publications/standards/Ecma-262.htm)*10.1.3 节 - 变量实例化*（第 37 页底部） 。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-19T15:43:32.103

没有办法解决这个问题，除了重命名其中一个，或者将值存储在另一个变量中。

```
function foo(f) {
    console.log(f); // --> 11
    console.log(arguments); // --> array [11]
    var f=10;
    console.log(f); // --> 10
    console.log(arguments); //even this is now array [10]
}
foo(11); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T15:36:46.863

一旦你声明了一个与旧变量同名的新变量，它就会覆盖它并且你不能同时引用这两个变量。

您应该更改参数或变量名称。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T16:50:06.517

> 这里的函数变量 f 是 Foo 的本地变量（它具有函数范围），但参数列表中的变量 f 的命名方式与它不冲突的原因相同，可能是因为它绑定在 Foo.arguments 内部目的？

不，它不受参数的约束：参数只是位置参数值的数组，你不能从中得到“arguments.f”。

按名称传递给函数的参数成为局部变量。带有参数“f”的函数中的“var f”是隐含的。

当您在已经是本地的变量上声明 'var f' 时，什么也没有发生。您的代码与以下内容相同：

```
function Foo(f)
{
    f = f;
} 
```

> 在其他语言中，我们不能声明与局部变量同名的参数变量。

在 JavaScript 中，只要在作用域块中使用了一次“var x”，那么在该块中对“x”的任何使用都是局部的。您可以愉快地在同一范围内一次又一次地在同一变量上声明“var”，但它什么也没做。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-19T15:40:17.243

在 Firefox 中，我注意到声明新变量并没有造成任何伤害，就好像声明不存在一样

```
 <script type="text/javascript">

  function saymessage(f) {
    alert(f);
    var f = f;
    alert(f);
    alert(this.f);
  }
  </script>
</head>

<body >

  <!-- Insert Body Here -->
<button  id='link' textToShow="Hidden message text" onclick="saymessage('Hello World')">Click me </button>

</body> 
```

我在第 1 次和第 2 次警报中收到“Hello World”，在第三次收到“未定义”

# spring - 使用 ControllerClassNameHandlerMapping 的 Spring MVC 配置约定？

> ID：662650
> 
> 赞同：4
> 
> 时间：2009-03-19T15:29:04.073
> 
> 标签：spring, configuration, spring-mvc, conventions, convention-over-configur

按照[Spring Source](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-coc)和 Spring in Action 一书的指示，我正在尝试以最小化 xml 配置的方式设置 Spring MVC。但是根据 Spring Source，这是您设置 ControllerClassNameHandlerMap 的方式

```
<bean class="org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"/>

<bean id="viewShoppingCart" class="x.y.z.ViewShoppingCartController">
    <!-- inject dependencies as required... -->
</bean> 
```

这让我觉得完全没用，因为使用处理程序手动设置 bean 实际上更简单，因为它的 XML 数量大致相同。

现在，《Spring in Action》这本书听起来好像您只需要该代码块中的第一行即可使用 ControllerClassNameHandlerMapping，这将使其更加有用。但是，我还不能让它工作。

有Spring经验的人可以帮帮我吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T17:27:00.797

这里实际上发生了两种不同的事情：

1.  URL 和控制器之间的映射
2.  将控制器定义为 Spring bean

对于 #1，如果您按照之前的方式定义 ControllerClassNameHandlerMapping，则会处理 URL 到控制器的映射。例如，[http](http://example.com/context/home) ://example.com/context/home -> HomeController

对于 #2，您可以像之前那样定义控制器 bean。或者，您可以继续使用 Spring 2.5 风格的 @Controllers 注释和自动装配，这样就不需要 XML bean 定义。与否，选择权在你。

使用 ControllerClassNameHandlerMapping 避免的是必须将所有潜在的 URL 显式映射到控制器。我们已经成功地使用了它。

您可能想要使用的另一件事是 DefaultRequestToViewNameTranslator：

```
<!-- Generates view names based on the request url (e.g. "/home.htm" => "home", "/user/list.htm" => "user/list", etc.) -->
<bean id="viewNameTranslator" class="org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator"/> 
```

我们还使用 UrlBasedViewResolver：

```
<!-- Maps view names to tiles view definitions files.  E.g., "home" => "home", etc.  -->
<bean id="viewResolver" class="org.springframework.web.servlet.view.UrlBasedViewResolver">
    <property name="viewClass" value="org.springframework.web.servlet.view.tiles2.TilesView"/>
</bean> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-25T00:27:50.767

我不认为使用 ControllerClassNameHandlerMapping 是一种好的工程实践，因为它确实会阻止您对 Controller java 类进行重构工作。

# asp.net-mvc - ASP.NET MVC 模型绑定外键关系

> ID：662651
> 
> 赞同：7
> 
> 时间：2009-03-19T15:29:22.280
> 
> 标签：asp.net-mvc, model-binding

是否可以将我的模型上的外键关系绑定到表单输入？

`Car`假设我在和之间存在一对多的关系`Manufacturer`。我想要一个用于更新的表单，`Car`其中包括用于设置的选择输入`Manufacturer`。我希望能够使用内置模型绑定来做到这一点，但我开始认为我必须自己做。

我的操作方法签名如下所示：

```
public JsonResult Save(int id, [Bind(Include="Name, Description, Manufacturer")]Car car) 
```

该表单发布值 Name、Description 和 Manufacturer，其中 Manufacturer 是 type 的主键`int`。名称和描述设置正确，但制造商设置不正确，这是有道理的，因为模型绑定器不知道 PK 字段是什么。这是否意味着我必须编写一个`IModelBinder`它意识到这一点的自定义？我不确定这将如何工作，因为我的数据访问存储库是通过每个`Controller`构造函数上的 IoC 容器加载的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-06-04T02:18:42.483

这是我的看法 - 这是一个自定义模型绑定器，当要求 GetPropertyValue 时，它​​会查看该属性是否是我的模型程序集中的一个对象，并且在我的 NInject IKernel 中注册了一个 IRepository<>。如果它可以从 Ninject 获得 IRepository，它会使用它来检索外键对象。

```
public class ForeignKeyModelBinder : System.Web.Mvc.DefaultModelBinder
{
    private IKernel serviceLocator;

    public ForeignKeyModelBinder( IKernel serviceLocator )
    {
        Check.Require( serviceLocator, "IKernel is required" );
        this.serviceLocator = serviceLocator;
    }

    /// <summary>
    /// if the property type being asked for has a IRepository registered in the service locator,
    /// use that to retrieve the instance.  if not, use the default behavior.
    /// </summary>
    protected override object GetPropertyValue( ControllerContext controllerContext, ModelBindingContext bindingContext,
        PropertyDescriptor propertyDescriptor, IModelBinder propertyBinder )
    {
        var submittedValue = bindingContext.ValueProvider.GetValue( bindingContext.ModelName );
        if ( submittedValue == null )
        {
            string fullPropertyKey = CreateSubPropertyName( bindingContext.ModelName, "Id" );
            submittedValue = bindingContext.ValueProvider.GetValue( fullPropertyKey );
        }

        if ( submittedValue != null )
        {
            var value = TryGetFromRepository( submittedValue.AttemptedValue, propertyDescriptor.PropertyType );

            if ( value != null )
                return value;
        }

        return base.GetPropertyValue( controllerContext, bindingContext, propertyDescriptor, propertyBinder );
    }

    protected override object CreateModel( ControllerContext controllerContext, ModelBindingContext bindingContext, Type modelType )
    {
        string fullPropertyKey = CreateSubPropertyName( bindingContext.ModelName, "Id" );
        var submittedValue = bindingContext.ValueProvider.GetValue( fullPropertyKey );
        if ( submittedValue != null )
        {
            var value = TryGetFromRepository( submittedValue.AttemptedValue, modelType );

            if ( value != null )
                return value;
        }

        return base.CreateModel( controllerContext, bindingContext, modelType );
    }

    private object TryGetFromRepository( string key, Type propertyType )
    {
        if ( CheckRepository( propertyType ) && !string.IsNullOrEmpty( key ) )
        {
            Type genericRepositoryType = typeof( IRepository<> );
            Type specificRepositoryType = genericRepositoryType.MakeGenericType( propertyType );

            var repository = serviceLocator.TryGet( specificRepositoryType );
            int id = 0;
#if DEBUG
            Check.Require( repository, "{0} is not available for use in binding".FormatWith( specificRepositoryType.FullName ) );
#endif
            if ( repository != null && Int32.TryParse( key, out id ) )
            {
                return repository.InvokeMethod( "GetById", id );
            }
        }

        return null;
    }

    /// <summary>
    /// perform simple check to see if we should even bother looking for a repository
    /// </summary>
    private bool CheckRepository( Type propertyType )
    {
        return propertyType.HasInterface<IModelObject>();
    }

} 
```

您显然可以用 Ninject 代替您的 DI 容器和您自己的存储库类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T15:43:18.533

当然，每辆车只有一个制造商。如果是这种情况，那么您应该有一个 ManufacturerID 字段，您可以将 select 的值绑定到该字段。也就是说，您的选择应该将制造商名称作为文本，将 id 作为值。在您的保存值中，绑定制造商 ID 而不是制造商。

```
<%= Html.DropDownList( "ManufacturerID",
        (IEnumerable<SelectListItem>)ViewData["Manufacturers"] ) %> 
```

和

```
ViewData["Manufacturers"] = db.Manufacturers
                              .Select( m => new SelectListItem
                                            {
                                               Text = m.Name,
                                               Value = m.ManufacturerID
                                            } )
                               .ToList(); 
```

和

```
public JsonResult Save(int id,
                       [Bind(Include="Name, Description, ManufacturerID")]Car car) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-08T05:37:27.443

也许这是迟到的，但您可以使用自定义模型绑定器来实现这一点。通常我会以与@tvanofosson 相同的方式执行此操作，但我有一个案例，我将 UserDetails 添加到 AspNetMembershipProvider 表中。由于我也只使用 POCO（并从 EntityFramework 映射它），我不想使用 id，因为从业务角度来看它是不合理的，所以我创建了一个仅用于添加/注册用户的模型。该模型具有用户的所有属性和 Role 属性。我想将角色的文本名称绑定到它的 RoleModel 表示。这基本上就是我所做的：

```
public class RoleModelBinder : DefaultModelBinder
{
    public override object BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
    {
        string roleName = controllerContext.HttpContext.Request["Role"];

        var model = new RoleModel
                          {
                              RoleName = roleName
                          };

        return model;
    }
} 
```

然后我必须将以下内容添加到 Global.asax：

```
ModelBinders.Binders.Add(typeof(RoleModel), new RoleModelBinder()); 
```

以及视图中的用法：

```
<%= Html.DropDownListFor(model => model.Role, new SelectList(Model.Roles, "RoleName", "RoleName", Model.Role))%> 
```

我希望这可以帮助你。

# multithreading - 你会怎么做/写这个家庭作业？（理论）

> ID：662658
> 
> 赞同：0
> 
> 时间：2009-03-19T15:31:28.840
> 
> 标签：multithreading, theory, circular-buffer

我不是要求任何人为我做这个作业，但我提出它是因为它是对 C# 和线程的非常好的实用介绍，但同时我觉得它可能有点太简单了。

**这真的是教授线程的最好方法吗？在本练习中“丢失”了哪些关键线程概念，第一次使用线程的新程序员可能无法观察到什么？**

我有很多关于线程的理论知识，但过去我自己不需要做很多，写它时有人对我有什么警告吗？

[这是原始作业的链接](http://www2.cs.uidaho.edu/~sgotshall/cs204/CS_204_Assignment_5.pdf)

这是目标文本：

> 1) 创建一个线程安全的通用循环队列类并创建一个 GUI 来使用它（参见下一节）。在这种情况下，线程安全意味着更改队列内容的每个操作（方法）一次只能由一个线程执行，以避免数据损坏。循环队列被实现为一个固定大小的数组，其中队列的开始和结束是数组中的索引。随着队列填满，队列的开头和结尾将随着元素的添加而转移到更高的值，并最终环绕到数组中的第一个索引以重用内存。如果操作无效，此类还应向调用者抛出异常（如下指定）。
> 
> 2) 创建一个 GUI 以生产者-消费者的方式控制两个线程。GUI 将能够启动和启动和停止生产者和消费者线程，并控制它们修改 GenericCircularQueue 的速率。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T15:36:01.747

读这个：

*   [为什么线程安全收集这么难？](http://blogs.msdn.com/jaredpar/archive/2009/02/11/why-are-thread-safe-collections-so-hard.aspx)
*   [用于可变线程安全集合的更有用的 API](http://blogs.msdn.com/jaredpar/archive/2009/02/16/a-more-usable-thread-safe-collection.aspx)

第二个链接大部分可以独立存在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T16:04:48.217

阅读有关 SyncLock 或 Monitor（假设为 Windows C#）的信息。

它是理解多线程的好方法，尤其是在多核时代。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T18:07:08.610

我想说这错过了两件大事：

*   大量写入，读取无法获得锁定和饥饿；结果：像这样的有界队列被填满。您需要一种方法来赋予读者更高的优先级，以便他们可以排空队列。
*   可扩展性——你可以很容易地让它成为线程安全的，只需要一个锁来读取或写入，这对于一个读者/一个作家来说非常有用。然而，一旦你有大量的生产者/消费者，你就会有很多线程争用。

# .net - Silverlight 应用程序与 WCF 服务通信的安全隐患是什么？

> ID：662677
> 
> 赞同：1
> 
> 时间：2009-03-19T15:34:18.787
> 
> 标签：.net, wcf, silverlight, security

我的公司正在构建一个医疗应用程序。我们想使用 Silverlight 2.0/3.0。由于 HIPAA 法律，安全是最重要的，不能在这里犯错。

在使用 Silverlight 的上下文中，是什么使 WCF 调用安全或不安全？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T15:40:03.627

由于 Silverlight 仅适用于 WCF 的 HTTP(S) 绑定，因此您只能像 HTTPS 允许的那样安全。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T19:40:49.413

据我所知，如果 Silverlight XAP 文件是从 Web 服务所在的**同一个**网站提供的，那么它们可以共享 ASP 会话。

在这种情况下，您将像往常一样对网站的用户进行身份验证。当他们获得 XAP 文件时，它与服务器的通信可以使用会话，就像所有正常的 HTTP 调用都将使用（传递 cookie）一样。

如果他们在不同的网站，那么他们就无法共享会话，您必须在 Web 服务中执行其他操作来验证调用者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T14:52:45.370

[SL2 中的 WCF 服务](http://www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2)

[SL2 中的网络安全访问限制](http://msdn.microsoft.com/en-us/library/cc645032(VS.95).aspx)

以上是关于 Silverlight 和 WCF 安全性的体面资源的链接，但 Mike_G 准确地总结了它，您仅限于 HTTPS 安全性。

# java - Squeak 跨平台运行“位相同”是什么意思，而 Java 却没有？

> ID：662681
> 
> 赞同：8
> 
> 时间：2009-03-19T15:34:44.637
> 
> 标签：java, jvm, smalltalk, vm-implementation

Alan Kay[指出](http://craphound.com/kayetcon2003)“与 Java 不同，[Squeak] 在每台机器上的运行方式都完全相同——这是我们 20 年前发明的”。维基[百科页面](http://en.wikipedia.org/wiki/Squeak)也提到了这一点：

> Squeak 可用于许多平台，并且在一个平台上生成的程序在所有其他平台上运行位相同。

由于具有不同指令集的机器显然不能在本地运行位相同的程序，当有人说 Squeak 在不同的机器上运行位相同的程序时，这是什么意思，而 Java 没有？

我的印象是编译后的 Java 类在任何 JVM 上的任何机器上运行相同，不是这样吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T16:10:27.080

显而易见的解释是，在具有相同输入的不同机器上执行相同的图像将导致图像通过相同的位模式演变。[这篇关于 Squeak 浮点数学的帖子](http://www.nabble.com/FloatMathPlugin-for-Croquet-td3603085.html)暗示浮点在不同平台上具有相同的表示。Java 要求平台之间的语义相同，但允许非规范化表示。Squeak 用于确保跨平台的位相同浮点的库是 Sun 的库，Sun JVM 也使用该库，尽管他们提到通过编译器设置进一步限制它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T16:20:18.180

术语位相同不仅可以指没有本机代码，还可以指如何处理数据操作。从平台到平台存在细微差别，例如由于浮点单元的不同硬件实现，浮点数的最低有效位。

因此位相同也可能意味着消除了这种差异，并且每条指令在每个硬件上逐位返回相同的结果。Ad hoc 这禁止使用某些硬件并且需要仿真。我不确定这是否以可接受的成本可行，或者是否有一个很好的技巧来实现这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T16:03:07.580

位相同意味着 Squeak 映像本身可以在许多平台上运行，而不仅仅是 Squeak 源代码。

Smalltalk 图像是代码（字节码格式）和活动对象的存储。代码以中间字节码格式提供，然后 VM 将其即时编译为特定于平台的机器代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T17:02:51.837

从[java.lang.Math](http://java.sun.com/javase/6/docs/api/java/lang/Math.html)的文档：

> 与 StrictMath 类的一些数值方法不同，Math 类的等效函数的所有实现都未定义为返回逐位相同的结果。这种放松允许在不需要严格的再现性的情况下实现更好的性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T15:37:46.377

它在虚拟机上运行，​​如 Wikipedia 上的下一句所述。:)

与 Java 相比，不确定“位相同”部分的含义。我的印象是相同的类文件可以在不同的机器上运行，因为 Java 也可以在虚拟机上运行。

这里希望艾伦能跳入主题并为我们解决这个问题！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T15:56:40.357

我唯一能想到的是，他指的是 Java 经常（并且 C# 总是）在目标机器上“即时”编译为本机代码的事实，然后再运行。

# c# - Lucene 查询排除文档，但不排除部分匹配的文档

> ID：662688
> 
> 赞同：0
> 
> 时间：2009-03-19T15:36:19.813
> 
> 标签：c#, .net, lucene

假设我有一组这样的文档：

*   奔驰
*   奔驰卡车

有没有办法创建一个可以过滤掉梅赛德斯而不是梅赛德斯卡车的查询？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T15:44:59.650

如果您需要短语“mercedes trucks”，那么您的查询可以是

> “奔驰卡车”

如果您需要梅赛德斯和卡车这两个词，那么您的查询可以是

> +梅赛德斯 +卡车

或者

> 梅赛德斯和卡车

这些查询自然会过滤掉不包含卡车一词的文档。

**编辑：** 除非这是一个关键字/未标记的字段。在这种情况下，只有第一个示例有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:43:52.213

你有没有尝试过：

+汽车品牌：梅赛德斯* -汽车品牌：梅赛德斯

（或者当然是任何字段名）。还是我根据具体示例过于简化了？

# sql - 我想使用“嵌套集模型”，但我必须有一个 GUID 作为主键。没有整数作为pk怎么办？

> ID：662697
> 
> 赞同：2
> 
> 时间：2009-03-19T15:38:09.077
> 
> 标签：sql, sql-server, tree, nested, hierarchical-data

我不**知道**我的树会有多深。所以我认为 NSM 适合我，阅读一些文档。在 sql 中，此模型假设我使用整数值作为主键。我想创建一个双表只是为了存储通过与真实表一对一的关系连接的整数（PK，左，右）。事情变得复杂而且浪费空间磁盘，特别是当服务器不是我的并且我必须支付每兆字节时。帮助！！

**更新**

优秀的！太棒了！谢谢 Macka 和 Bill，我现在可以跳过阅读整本书。Celko 是亚马逊的未来订单。;-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T15:41:07.710

你的主键是什么类型并不重要，因为左/右值仍然是整数。例如。

```
CREATE TABLE [dbo].[Demo](
    [ID] [uniqueidentifier] ROWGUIDCOL  NOT NULL CONSTRAINT [DF_Demo_ID]  DEFAULT (newid()),
    [Name] [varchar](50) NOT NULL,
    [Lft] [int] NOT NULL,
    [Rgt] [int] NOT NULL,
 CONSTRAINT [PK_Demo] PRIMARY KEY CLUSTERED 
(
    [ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] 
```

--添加一些测试数据

```
INSERT INTO demo(name,lft,rgt)
SELECT 'node1',1,6
UNION
SELECT 'node2a',2,3
UNION
SELECT 'node2b',4,5 
```

--检查它是否有效

```
SELECT *
FROM demo
WHERE lft>=2
ORDER BY lft 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T16:10:34.643

正如@Macka[所写](https://stackoverflow.com/questions/662697/id-like-to-use-the-nested-set-model-but-im-obliged-to-have-a-guid-as-primary-ke/662707#662707)，左右值不是树节点的外键，因此它们不必是同一类型。它们可以是整数，而树节点主键是 GUID。

Celko 还[为 Smarties 编写了“SQL 中的树和层次结构](https://rads.stackoverflow.com/amzn/click/com/1558609202)”，其中更详细地介绍了嵌套集模型和其他解决方案。读这本书会为你节省很多时间和很多错误。

还有其他将分层数据存储在数据库中的解决方案。在这里查看我的答案： [将平面表解析为树的最有效/优雅的方法是什么？](https://stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree/192462#192462)

# php - 我应该使用 eval() 还是 call_user_func()？

> ID：662698
> 
> 赞同：5
> 
> 时间：2009-03-19T15:38:19.370
> 
> 标签：php, eval

我正在开发一个 php 项目，我想运行从 MySQL 数据库中获取的代码。没有机会注入不安全的代码，所以我唯一担心的是性能。我应该使用 eval() 以便我可以直接运行代码，还是解析它以便 call_user_func() 运行它？

例如，如果我获取的代码是“myfunc(1,2,3); anotherFunc(3,2,1);”
我可以直接 eval() 来运行代码。

但是对于 call_user_func()，我必须解析字符串才能运行它。那么在这种情况下使用哪个更好的功能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T01:31:11.960

将 PHP 存储在数据库中本身就是一种不好的设计气味。即使在这种情况下，您很确定它永远不会包含不安全的代码，但尽量减少您必须做出的假设或防御的数量总是好的。如果您将 PHP 代码存储在数据库中，那么攻击者可以快速访问您的数据库的攻击会变得更加严重，变成攻击者可以运行任意代码的攻击！我知道让您的数据库像这样被破坏是极不可能的，但是即使是不太可能的情况也不要让您的系统受到超出其需要的损害，这是一种良好的安全实践。

[许多人同意](https://stackoverflow.com/questions/233030/worst-php-practice-found-in-your-experience/234021#234021)在 PHP 代码中应该始终避免使用 eval()，无一例外。总有替代方案。

然而，在这种情况下，我认为我不得不说使用 eval() 对你来说是最好的解决方案，因为你已经在数据库中存储了 PHP 代码，所以使用 eval() 不会增加你的风险除此之外。

但是，我建议

1.  您尝试在 eval() 之前验证代码，在您允许的范围内保持保守。假设攻击者以某种方式进入了您的数据库，甚至认为这不太可能。
2.  您至少认真考虑重写您的应用程序，以便 PHP 代码不存储在数据库中。如果您要存储复杂的数据结构，请考虑使用 JSON 甚至 XML 之类的东西。这些存在安全的解析器。

如果这个答案看起来有点反动，我很抱歉；我只是碰巧觉得这种事情很重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T18:22:45.780

作为一般规则，我总是尽量远离 eval() 。然而，这个案例看起来是一个很好的候选者。

您说*“不可能注入不安全的代码”*，所以最大的问题是：数据库中是否有可能出现不工作的代码？

如果没有， eval() 是解决方案，但如果有正确的解析和错误记录/等可能是一个更安全的选择。（我相信理论上使用 call_user_func_array() 更快，所以任何解析开销都可以忽略不计）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T15:45:16.157

我认为解析会增加开销，但您可以确定的唯一方法是对其进行测试。用各种功能尝试两种方式，看看你的结果是什么。使用代表您希望存储的内容的代码。

祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T15:54:48.817

使用 eval()。其他任何事情都不值得付出努力——它们不会产生任何积极的副作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T18:18:28.410

您可能想看看[runkit](http://php.net/runkit)扩展，它可以在沙箱中执行 php 而不会影响正在运行的代码。

如果假设代码会影响您正在运行的代码，请使用 eval()。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T01:42:31.917

您也应该将要运行的代码包装在 try/catch 块中，以防出现错误（即使您说不会出现错误，但仍有可能，这是最佳实践）

# c# - 匿名泛型 - 我将在哪里使用它？

> ID：662700
> 
> 赞同：4
> 
> 时间：2009-03-19T15:38:35.207
> 
> 标签：c#, generics, c#-3.0, anonymous-types

我最近发现了一个技巧，使用示例转换来实例化具有匿名类型的泛型。

[http://brendanjerwin.com/blog/2009/03/19/anonymous-generics/](http://brendanjerwin.com/blog/2009/03/19/anonymous-generics/)

所以，这是一个巧妙的技巧，但什么时候会用到呢？有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T15:40:21.690

我使用这个技巧的主要地方是为匿名类型创建一个集合容器。

```
public static List<T> CreateListOfAnonymous<T>(T unused) {
  return new List<T>();
} 
```

用法：

```
public void Foo() {
  var list = CreateListOfAnonymous(new { Name = String.Empty, Age = 42 });
  list.Add(new { Name = "foo", Age = 28 });
} 
```

# vba - Excel 和/或 Visual Basic 中的十六进制 ANDing

> ID：662701
> 
> 赞同：4
> 
> 时间：2009-03-19T15:38:55.050
> 
> 标签：vba, excel, hex

我正在尝试`AND`在`Excel/Visual Basic`.

前任。`53FDBC AND 00FFFF`这应该产生`00FDBC`。

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T15:51:41.773

我假设您将 2 个值存储为字符串。在这种情况下，您可以执行以下操作：

```
Dim hex1 As String
hex1 = "53FDBC"

Dim hex2 As String
hex2 = "00FFFF"

Dim bin1 As String
bin1 = CLng("&H" & hex1)

Dim bin2 As String
bin2 = CLng("&H" & hex2)

Dim result As String
result = Hex$(bin1 And bin2) 
```

*结果*现在包含“FDBC”，但您可能希望在左侧填充零

作为一个函数（excel模块），这可以实现为：

```
Function hexand(hex1 As String, hex2 As String) as String

Dim bin1 As String
bin1 = CLng("&H" & hex1)

Dim bin2 As String
bin2 = CLng("&H" & hex2)

hexand = Hex$(bin1 And bin2)

End Function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:51:26.873

iirc，它是内置的，只有位移运算符不是内置的

&H53FDBC 和 &H00FFFF

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-02-23T03:44:29.480

十进制 0xFFFF 的十六进制值为 65536 十进制 0x53FDBC 的十六进制值为 5504444

所以你可以使用 =DEC2HEX(MOD(5504444,65536))

# ruby-on-rails - 如何在特定于环境的电子邮件中发送 URL？

> ID：662708
> 
> 赞同：0
> 
> 时间：2009-03-19T15:41:11.703
> 
> 标签：ruby-on-rails, mailer

使用 restful_authentication 生成的代码，我们通常会在注册和激活邮件中获取 'localhost' 作为 URL。我正在尝试创建这样的东西：

```
def signup_notification(user, host)
  setup_email(user)
  @subject    += 'Please activate your new account'

  @body[:url]  = "http://#{host}/activate/#{user.activation_code}"
end 
```

但是，由于传递邮件的实际调用是在观察者中，我不能这样做：

```
UserMailer.deliver_signup_notification(user, request.host_with_port) 
```

由于请求方法在模型中不可用。这样做的最佳方法是什么？

我考虑过将每个域的 URL 存储在 YAML 文件中，然后在启动时加载它，但是端口可能会改变，所以它不起作用。

或者，我考虑在某个地方创建一个静态类变量，该变量在加载应用程序时设置，但我不知道如何去做。请求方法是否可用于初始化程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T16:17:18.217

使用 ActiveMailer，我在`config/envrionments/production.rb`

```
config.action_mailer.default_url_options = { :host => "my.host.com" } 
```

在模型中`app/models/event_mailer.rb`

```
def new_event(event)
    recipients  EventMailer::NO_REPLY
    bcc         event.emails('new_event')
    from        EventMailer::FROM_EMAIL
    subject     "#{EventMailer::SUBJECT_HEADER} Event Updated :: #{event.title}"
    content_type    "text/plain"
    body        :event => event
end 
```

然后在邮件视图中`app/views/event_mailer/new_event.rb`

```
You can view the event by going to: <%= url_for(:controller => "events", :action => "show", :id => @event.id, :only_path => false) %> 
```

在邮件中生成：

```
You can view the event by going to: http://my.host.com/events/11 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T08:09:51.533

我也遇到了同样的问题，这就是我所做的

1.  在用户模型中，我将 :host 添加到 attr_accessible，然后添加此方法

    ```
    def 主机=（值）
      write_attribute ：主机，值
    结尾

    ```

2.  在用户控制器中，在发送电子邮件的方法中，例如创建和激活我放

    ```
    @user.host = request.host_with_port
    ```

因为我仍然是一个新手，所以我真的希望有人能为这个问题提出一个最佳实践解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-02T15:57:06.107

试试 current_request 插件，描述在[http://codeshooter.wordpress.com/2009/08/](http://codeshooter.wordpress.com/2009/08/)

为我工作

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T15:48:01.533

访问您的服务器的主机名位于请求的 Host 标头中。您不应该在模型中访问它（假设 rails 是健全的）。但是，如果您可以访问控制器中的请求对象，则可以在从 db 中提取模型对象时将该值插入模型字段。

# java - 如果服务器不可用，如何防止应用程序冻结？

> ID：662712
> 
> 赞同：3
> 
> 时间：2009-03-19T15:42:16.303
> 
> 标签：java, sockets, networking

```
InetAddress serverAddr = InetAddress.getByName(serverAddress);
String hostname = serverAddr.getCanonicalHostName();
Socket socket = new Socket(serverAddr, portNumber);
// Freezes before this line if the server is unavailable
socket.setSoTimeout(3000); 
```

有谁知道如何实施服务器可用性检查或防止冻结？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T15:52:02.943

通过使用[两个参数的构造函数](http://java.sun.com/javase/6/docs/api/java/net/Socket.html#Socket(java.net.InetAddress,%20int))，您可以告诉 Java 立即连接。您正在寻找的可能是

```
Socket socket = new Socket();
// Configure socket here
socket.connect(new InetSocketAddress(serverAddr, portNumber), 3000);
if (! socket.isConnected()) {
    // Error handling
} else {
    // Use socket
} 
```

不过，这仍然会阻塞 3 秒。如果要防止这种情况，请使用线程进行连接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T15:52:32.393

我将建议显而易见的：使用单独的线程来执行此操作。线程可以在不冻结应用程序的情况下冻结。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T16:10:40.447

这可能过于简单化（因为它不处理连接完成后如何“重新加入”线程 - 假设您需要这样做。）

此外，如果这种情况经常发生，您希望使用`Executor`（线程池）而不是手动创建自己的`Thread`- 线程创建/销毁是昂贵的。

我也忽略了这个片段中的异常处理（这不是完全微不足道的。）

```
Runnable runnable = new Runnable() {
   public void run() {
      InetAddress serverAddr = InetAddress.getByName(serverAddress);
      String hostname = serverAddr.getCanonicalHostName();
      Socket socket = new Socket(new InetSocketAddress(serverAddr, portNumber), 3000);
      /* ... do more of your after-connection processing here, assuming it doesn't
       * need to be in the original "dispatch" thread.
       */
   }
};

Thread t = new Thread(runnable);
t.start(); 
```

# ssis - 为什么我的 foreach 文件容器不会循环？

> ID：662718
> 
> 赞同：1
> 
> 时间：2009-03-19T15:43:22.963
> 
> 标签：ssis

我在一个包中有两个 foreach 文件容器。

两者具有相同的设置，只是名称不同：一个称为“Foreach 可用性文件”，另一个称为“Foreach 通信文件”。

第一个容器“可用性”经历了 1 次迭代（我可以通过断点看到这一点），第二个“通信”没有。

除了名称之外，这两个容器再次相同。

我在将“Foreach 通信文件”重命名为“Foreach 通信文件”后重试了这一点，突然容器工作了。

谁能告诉我为什么会这样？

克雷格

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T22:45:16.073

向 connect.microsoft.com 提交重现步骤 - 如果它可以重现，他们会告诉您原因。

# javascript - JQuery - 从 DOM 调整大小的窗口 - 触发事件

> ID：662726
> 
> 赞同：1
> 
> 时间：2009-03-19T15:44:53.473
> 
> 标签：javascript, jquery

当浏览器窗口调整大小时，我知道有一个 JQuery 方法可以将其连接到事件处理程序。

我想知道是否有一个，如果窗口从 DOM 调整大小，有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T16:01:07.880

这应该工作

```
$(window).bind('resize', function() {
    alert('Resizing now');
}); 
```

# .net - .net 文本分隔库？

> ID：662731
> 
> 赞同：2
> 
> 时间：2009-03-19T15:46:08.370
> 
> 标签：.net, text, csv, io

.net 框架是否有任何内置程序集来处理对文本分隔文件的读写？或者这是我自己创造的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T15:52:25.390

[FileHelpers](http://filehelpers.sourceforge.net/)是据说擅长它的人。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T15:56:19.157

Microsoft.VisualBasic.dll中其实有一个类叫[TextFieldParser](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.fileio.textfieldparser.aspx)，可以读取CSV文件之类的。不过我从来没有尝试过。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T15:51:16.173

不，它没有。你必须自己写一个......或者你可以使用其他人已经制作的东西。只是谷歌.net csv 作家。这是来自谷歌代码的示例：[csv-reader-and-writer](http://code.google.com/p/csv-reader-and-writer/)

编辑：我以前使用过以下一个，效果很好：（来自[knab.ws](http://knab.ws/blog/index.php?/archives/3-CSV-file-parser-and-writer-in-C-Part-1.html)

```
public class CsvWriter
{
        public static string WriteToString(DataTable table, bool header, bool quoteall)
        {
                StringWriter writer = new StringWriter();
                WriteToStream(writer, table, header, quoteall);
                return writer.ToString();
        }

        public static void WriteToStream(TextWriter stream, DataTable table, bool header, bool quoteall)
        {
                if (header)
                {
                        for (int i = 0; i < table.Columns.Count; i++)
                        {
                                WriteItem(stream, table.Columns[i].Caption, quoteall);
                                if (i < table.Columns.Count - 1)
                                        stream.Write(',');
                                else
                                        stream.Write('\n');
                        }
                }
                foreach (DataRow row in table.Rows)
                {
                        for (int i = 0; i < table.Columns.Count; i++)
                        {
                                WriteItem(stream, row[i], quoteall);
                                if (i < table.Columns.Count - 1)
                                        stream.Write(',');
                                else
                                        stream.Write('\n');
                        }
                }
        }

        private static void WriteItem(TextWriter stream, object item, bool quoteall)
        {
                if (item == null)
                        return;
                string s = item.ToString();
                if (quoteall || s.IndexOfAny("\",\x0A\x0D".ToCharArray()) > -1)
                        stream.Write("\"" + s.Replace("\"", "\"\"") + "\"");
                else
                        stream.Write(s);
        }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T15:54:17.960

.NET 中没有用于 c# 的内置 CSV 阅读器，但是有可用的第三方库。

*   [FileHelpers](http://filehelpers.sourceforge.net/)适用于 ORM 类型的内容，但不适用于任意列格式，例如 Excel 可以处理的格式。
*   [CodeProject 上的CsvReader](http://www.codeproject.com/KB/database/CsvReader.aspx)还不错，但是缺少一些功能，例如处理固定长度字段和使用字符串作为分隔符。
*   Google 代码上[的 Calcite-Csv 库。](http://code.google.com/p/calcite-csv/)这是我自己的努力，您可能会觉得有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T15:50:17.767

我认为这是你必须自己创造的东西。
（无论如何我做了；））。

# documentation - 代码片段的正确标题标签是什么？

> ID：662732
> 
> 赞同：1
> 
> 时间：2009-03-19T15:46:35.903
> 
> 标签：documentation, report, pseudocode

我目前正在为我的学位写论文，在写我的报告时，我不知道如何正确地为我的代码片段添加标题。

例如...

=====================================

图表/图片：“图 1 - 我的图表”

表：“表 1 - 列表数据”

代码：“????? 1 - 一些伪代码”

=====================================

你会用什么来代替问号？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T15:48:51.997

我认为普遍接受的术语是“上市”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:48:28.177

我通常会选择“列表”，例如：

> 清单 14：多线程电梯控制器的仿真线束代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T15:49:23.587

我会将您的代码片段称为*Listings*。

因此，

=====================================

图表/图片：“图 1 - 我的图表”

表：“表 1 - 列表数据”

代码：“清单 1 - 一些伪代码”

=====================================

# sql-server - 服务和集群帐户的 SQL 登录

> ID：662733
> 
> 赞同：0
> 
> 时间：2009-03-19T15:46:37.493
> 
> 标签：sql-server

任何人都可以请告诉我为什么集群服务需要本地 SQL 登录而 sql server 服务需要 SQL 登录。

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T14:14:35.600

这很有趣，这家伙直接给我发了电子邮件并问了同样的问题。我的回答是：

服务帐户不是 SQL 登录名。SQL 登录用于*连接*到 SQL Server，但不用于运行 SQL Server 本身。

如果您进入控制面板、管理工具、服务，然后转到 SQL Server 服务，您将看到运行该服务的帐户。它通常是本地系统，或者是 Windows 域帐户。

如果这不能回答您的问题，请发送您正在查看的内容的屏幕截图，这让您感到困惑，我可能会提供更多帮助。希望有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T15:01:34.520

首次设置集群时，您必须指定作为域成员的用户帐户。这是集群服务帐户。它是一个 Windows 帐户，这意味着就 SQL Server 而言，它是一个 Windows 登录（特别是 Windows 用户登录）。此 Windows 帐户必须是组成集群的每台服务器上操作系统的本地管理员组的成员。而在 SQL Server 2008 之前，Administrators 组会自动添加到 SQL Server 并授予 sysadmin 级别的权限，这意味着当您安装 SQL Server 时，您不必担心它。

对于 SQL Server 服务帐户，包括 SQL Server 代理、SQL Server 全文（如果在 2005/2008 上），它们也需要是域中的 Windows 帐户。原因是操作系统实际上使用这些帐户启动了这些服务，并且它们需要能够在 SQL Server 配置为可能运行的群集的每台服务器上运行。如果您在设置 SQL Server 时不更改这些，则安装将确保这些帐户在 SQL Server 中也具有正确的权限。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T21:00:07.727

他们都不能使用sql登录。他们都应该在大多数环境中使用域帐户。

您可能会在这些页面深处找到更多信息：http: [//msdn.microsoft.com/en-us/library/ms179530 (SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms179530(SQL.90).aspx)

微软并不总是解释为什么你必须做事，他们只是说你做。

* * *

编辑： [http ://technet.microsoft.com/en-us/library/ms143504.aspx](http://technet.microsoft.com/en-us/library/ms143504.aspx)

我们去吧。对不起，有一个糟糕的微软一天。

# replace - 用 Vim 文件中其他地方的寄存器或行范围的内容替换

> ID：662734
> 
> 赞同：69
> 
> 时间：2009-03-19T15:46:58.117
> 
> 标签：replace, vim, substitution

我正在使用 Vim，我想用一个长字符串替换一些占位符文本，该字符串跨越几行，已经写在文件的其他地方。

是否可以用寄存器的内容替换模式？就像是

```
:%s/foo/<contents of register A> 
```

否则，是否可以用一系列行替换？就像是

```
:%s/foo/<content of lines from 10 to 15> 
```

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-03-19T15:48:24.417

根据[http://vim.wikia.com/wiki/Search_and_replace](http://vim.wikia.com/wiki/Search_and_replace) 出现：

```
:%s/foo/\=@a/g 
```

`<c-r>a`此外，在插入模式下按下将插入寄存器的内容`a`。

酷——我从来不知道。好问题。

其他一些事情要做：http `<c-r>`: [//vimdoc.sourceforge.net/htmldoc/cmdline.html#c_CTRL-R](http://vimdoc.sourceforge.net/htmldoc/cmdline.html#c_CTRL-R)

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-19T15:53:57.930

```
:%s/foo/\=getline(10, 15)/g

:%s/foo/\=join(getline(10, 15))/g 
```

# c# - ASP.Net 应用程序使用 fOpen 调用 DLL

> ID：662736
> 
> 赞同：0
> 
> 时间：2009-03-19T15:47:47.617
> 
> 标签：c#, asp.net, com, dll, fopen

我有 ASP.Net Web 应用程序和我的 c# 代码调用自定义 COM DLL。

DLL 是不久前编写的，并使用 fOpen。fOpen 调用返回一个 NULL 指针。我怀疑这是权限，但我没有运气解决这个问题。

谁能给我任何关于做什么的想法？可以使用 fOpen 吗？我需要设置特殊权限吗？

任何帮助将不胜感激。

谢谢，托尼

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T15:50:37.593

问题很可能与它实际尝试打开的文件有关。文件 Asp.Net 工作进程可能没有访问文件系统上该文件的权限。您需要添加对工作进程的访问权限，这应该可以解决问题。

本页详细介绍了如何为 Asp.Net 1.1 设置权限。对于更高版本的 Asp.Net，它应该非常相似

[http://www.asp.net/learn/whitepapers/aspnet-and-iis6/](http://www.asp.net/learn/whitepapers/aspnet-and-iis6/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:52:27.760

需要检查的一些事项：

*   `trust`ASP.Net 应用程序的级别
*   您是否将正确的路径传递给 dll（映射到本地文件系统与 Web 文件系统）？
*   [用于运行该站点](http://msdn.microsoft.com/en-us/library/ms998297.aspx)的帐户是否有足够的权限来访问该文件？

# c - 如果我要重复引用它们，我应该将 C 数组值存储在局部变量中吗？

> ID：662748
> 
> 赞同：3
> 
> 时间：2009-03-19T15:50:00.530
> 
> 标签：c, arrays, optimization

我正在编写一些优化的 C 代码，这些代码基本上通过一个数组运行并对每个元素执行一些操作。它的作用取决于元素的当前值，例如：

```
for (i=0; i < a_len; i++) {
    if (a[i] == 0) {
        a[i] = f1(a[i]);
    } else if (a[i] % 2 == 0) {
        a[i] = f2(a[i]);
    } else {
        a[i] = 0;
} 
```

在从事动态语言工作多年后，我回到了 C，我的实践是尝试编写简单的代码，而不是为我可以直接引用的东西创建大量局部变量，比如上面的 a[i]。 *我非常清楚最佳实践是编写可读代码并相信编译器比您更聪明并且会进行良好的优化。*

如果我在汇编程序中编写上面的代码，我会将 a[i] 加载到寄存器中一次，然后每次只使用该值，因为我知道 a[] 是私有内存并且不会在引用之间更改。但是，即使是智能编译器也可能每次都加载，因为它不能确定内存没有改变。（或者我是否必须显式声明“a” volatile 以使编译器不进行此优化？）。

所以，我的问题是：我是否应该通过像这样重写局部变量来获得更好的性能：

```
for (i=0; i < a_len; i++) {
    val = a[i];
    if (val == 0) {
        a[i] = f1(val);
    } else if (val % 2 == 0) {
        a[i] = f2(val);
    } else {
        a[i] = 0;
} 
```

或者像 -O3 这样的东西会自动为我处理这个问题吗？我正在优化的代码需要几天时间才能运行，因此即使是适度的改进也会有所作为。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-19T15:52:25.233

显而易见的答案当然是首先以最易读/最简单/易于理解的方式编写它，然后用尽可能多的优化对其进行编译，然后对其进行基准测试和分析。

[在你知道](http://en.wikipedia.org/wiki/Optimization_%28computer_science%29#When_to_optimize)它们是否是瓶颈之前优化它们是没有意义的。如果编译器自动进行转换，您只会让代码变得更糟，花费时间，而且绝对没有任何回报。除了可能很酷的感觉，但随着时间的推移会逐渐消失。:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-19T16:06:58.210

首先写它是为了可读性。就个人而言，我发现所有的下标都伤害了我的眼睛，所以我可能会写得更像：

```
for (i=0; i < a_len; i++) {

    int val = a[i];  /* or whatever type */
    int result = 0;  /* default result */

    if (val == 0) {
        result = f1(val);
    } else if (val % 2 == 0) {
        result = f2(val);
    } 

    a[i] = result;
} 
```

我猜编译器会通过优化生成类似的代码。但是，如果其中一个稍微（只是非常轻微）好一点，我不会感到震惊。我敢打赌，如果有的话，那一定是使用当地人的。

此外，通过将使用索引遍历数组更改为使用指针遍历数组，您可能会获得非常轻微的改进。同样，这非常依赖于编译器和情况。

```
for (p=&a[0]; p < &a[a_len]; ++p) {

    int val = *p;    /* or whatever type */
    int result = 0;  /* default result */

    if (val == 0) {
        result = f1(val);
    } else if (val % 2 == 0) {
        result = f2(val);
    } 

    *p = result;
} 
```

而且，是的，我知道这些是微优化，通常甚至不应该担心（请先*编写代码以确保可读性和正确性*）-我只是指出了一些可能需要微优化的选项（这些建议必须以对特定情况的分析为依据）。

至于编译器是否会反复从 a[i] 之类的东西重新加载，这取决于控制流以及被访问的对象是全局对象还是已获取其地址并将其传递给其他对象。

如果对象是全局的或已获取其地址并且您调用函数，则通常编译器必须假定该对象可能已被该函数修改并且必须重新加载它。当使用指针将信息传递给函数时，也会发生类似的问题。使用 locals 可以帮助缓解这个问题，因为编译器可以很容易地确定 local 没有被调用的函数修改，除非使用 local 的地址。编译器也可以尝试通过使用某种全局优化来解决这个问题（例如 MSVC 在链接时所做的）。

即使数组`a`是全局的，您的示例代码也可能不会真正遇到这个问题，因为在调用这些函数中的任何一个（您只写入它）之后，您不会从数组中重新读取值。

* * *

我想知道为什么降价会从代码格式的块中删除空白行？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T16:38:55.637

只要打开 -O 或更高版本，两个版本在 GCC 中生成完全相同的代码。所以我的建议是做任何你喜欢的更好的方式（我更喜欢没有局部变量）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-19T16:16:31.900

这些功能似乎共享相同的签名`f1`。`f2`他们的行为有何不同？你真的需要外面的支票吗？或者，您可以将逻辑嵌入到一个函数中吗？

如果您有一个`if-else`梯形图而不是只有两个这样的函数，请尝试使用函数指针数组来代替。使用 的值`a[ i ]`来索引该数组并调用正确的函数。

手动优化通常是容易出错的微优化。最好将此任务留给编译器。如果你真的需要优化，看看大局，想想算法、设计、层等等。

至于您的问题：是的，大多数编译器可能会优化掉`a[ i ]`不应该声明的内存读取`volatile`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T21:33:09.347

德克根特利的回答：

> 是的，大多数编译器可能会优化内存读取应该 a[i]

有时编译器在处理“可能有别名”的指针时不会优化代码。在您的情况下，尼克，如果您将“a”作为函数参数函数（int * a），那么编译器可能会假设指向“a”的指针是别名，因此不会优化。

如果您将指针质量为“int * restrict a”，那么编译器将知道“a”没有被别名，它将进行优化。

100% 知道编译器是否正在优化的唯一方法是[检查程序集](https://stackoverflow.com/questions/36906/what-is-the-fastest-way-to-swap-values-in-c/615995#615995)！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T15:54:56.210

C 中的数组本质上是一个指针。

局部变量很便宜。

我发现第一个示例更易于阅读，因为我没有质疑“val”的用途。如果“val”和“a”有更好的名字，我敢说第二个例子会提高可读性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T17:33:11.980

你说“如果我用汇编程序编写上面的代码......”所以我假设你知道汇编语言。

我的建议：看看代码关键部分的编译器输出，看看到底发生了什么。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-19T16:00:02.597

1.  除非您知道必须优化，否则不要优化
2.  你的编译器可能会做正确的事
3.  我发现后一个版本更容易阅读
4.  （边缘）在多线程程序中更容易将后一个版本与副作用隔离开来

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-19T16:46:48.740

## 优化提示

我可能会首先考虑`var`将指针作为指针，而不是我本地变量可能会更好。那么你也不要使用变量的双重存储

```
int* var;//Int or whatever type a[] is
for (i=0; i < a_len; i++) {
    val = &a[i];
    if (*val == 0) {
        f1(val);//// Set the valur inside f1
    } else if (*val % 2 == 0) {
        f2(val);// Set the valur inside f2
    } else {
        *val = 0;
} 
```

当您对结果不感兴趣时​​，优化代码的提示可能是避免使用 '%' 运算符。这取决于您的编译器，但事实证明这对我来说更快（使用宏来提高可读性）：

```
#define is_divisible(dividend, divisor) ((((dividend)/(divisor)) * (divisor))==(dividend)) 
```

采用：

```
else if (is_divisible(val,2)) { 
```

这更快，至少在我测试过的大多数情况下。

编辑：确实，仅使用“% 2”进行模数计算时，利润并没有那么大，但是如果您曾经以比 2 更大的计算量来进行模数运算，并且只是对模数返回零感兴趣，那么我的宏是在我使用的所有编译器中都更快

# c# - C#标签的好处和模型用法是什么

> ID：662753
> 
> 赞同：1
> 
> 时间：2009-03-19T15:50:50.480
> 
> 标签：c#, .net

### 复制：

> [c#中的标签有什么用？](https://stackoverflow.com/questions/662577)

当我遇到一些我在网上很少看到的东西时，我正在使用反射器浏览一些 .NET 源代码，这就是标签语法。

从这里我可以看到它增加了丑陋的意大利面条代码的机会：

```
goto 1: 
goto 2: 
if(booleanProperty) goto 1: 
```

标签的目的仅仅是为了让您可以在函数内向后跳转和第四次跳转吗？

您会说 C# 标签有哪些模型用法？你自己有实施它的经验吗？这是一次很好的经历吗？

```
if (1 == 1)
    goto Stage2;
Stage1:
    Console.WriteLine("Stage1");
Stage2:
    Console.WriteLine("Stage2"); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T15:54:01.610

您最常在反射器中看到这一点，因为程序员使用了在幕后重写的更高级别的构造，因此我们现在看到的是 goto/labels。

在考虑是否使用标签作为程序员时，我的经验法则是，如果你不得不问，你可能不应该这样做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:53:02.613

在极少数情况下——通常在代表状态机的自动生成代码中——`goto`可以让生活变得更简单。如果你想得足够努力，通常有一种方法可以绕过它，但是对于自动生成的代码，与尝试生成你要手动编写的代码相比，制定一种简单但可读性较差的方法更容易。

不能说我自己在 C# 中使用过它，但是 IIRC 在将 Colossal Cave 冒险移植到 Java 时我做了类似的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T15:52:52.487

后藤的争议很大。但是，您遇到的代码可能已从更易读的 c# 源代码重构为标签和分支，这些标签和分支更符合 IL 结构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T15:53:16.200

我发现在 C# 中有用的 label/goto 语法的唯一一次是在实现 case 语句的失败时。这是我发现偶尔在 C# 不允许的 Java 中有用的东西。否则我会避免贴标签，然后像瘟疫一样转到。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T15:57:00.467

goto 有多种用法，考虑到始终避免意大利面条式代码，以及之前回复中的所有建议：

```
 while (loop1) {
    while (loop2) {
        if (timeToQuit) 
            break outerLabel;
    }
}
outerLabel: 
```

在交换机中

```
switch(value) {
    case 1:
        // DoSomething();
        break;
    case 2:
        // DoSomethingElse();
        break;
    default:
        goto case 1;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T16:08:30.250

好处：工作保障？-- 因为它真的可以让你的代码对其他人不可读

使用模式：无，除非替代方案更糟

# .net - 以编程方式从其他网站获取数据的最佳方式是什么？“例如亚马逊提供”

> ID：662760
> 
> 赞同：2
> 
> 时间：2009-03-19T15:51:52.537
> 
> 标签：.net, html, web

我想构建一个小型应用程序，它将访问一些网站并从这些网站读取特定数据，我希望该应用程序尽可能通用，以便以后可以在我想要的任何网站上运行。那么有一种使用.net 解析网站的好方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:01:49.517

有人告诉我，在 .NET 中进行屏幕抓取的一个很好的工具包是[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)。

您应该意识到，要使屏幕抓取解决方案稳定或如您所描述的通用用途总是非常困难的。

另请参阅此问题的其他答案：[屏幕抓取：正则表达式或 XQuery 表达式？](https://stackoverflow.com/questions/646484/screen-scraping-regular-expressions-or-xquery-expressions)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:58:41.053

虽然不是真正适用于您的场景，但请查看[Watin](http://watin.sourceforge.net/)。我假设您想要做的是屏幕刮擦。Watin 很容易上手，并且可以避免您自己编写大部分解析代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-01T22:20:30.630

使用 wget for windows 和正则表达式应该做你想做的事。您使用 wget 获取源代码，然后使用正则表达式过滤掉所有代码，或者如果它具有模式，则准确获取您要查找的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T15:58:38.137

假设您尝试获取的数据无法通过 RSS 或其他类似方式获得，听起来您正在寻找页面抓取工具。谷歌搜索“.NET HTML scraper”会返回有关该主题的大量信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T16:00:36.197

阅读为人类阅读而制作的网站始终是一个问题。我这样做已经有几年了，这从来都不是一件容易的事。在 XML 或 RSS 等其他文件中寻找您需要的数据总是一个好主意。

始终牢记网站布局可能会发生变化，您必须调整您的应用程序。但主要问题是在页面上找到您需要的信息。我们总是需要很多字符串方法，比如 contains、left、mid、indexOf。

HTML 是某种 XML，所以也许 XMLParser 可以工作。但是浏览器总是更宽容一些，并且会接受并显示许多格式不正确的页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T16:01:17.943

如果该站点不提供 API，您最终将“抓取”该网站。虽然这当然是可能的，但它非常脆弱。如果网站发生变化，您用来“查找”所需信息的逻辑就会中断。拥有一个可以找到特定信息的通用应用程序是一个很棒的概念，但很难可靠地实现。

# python - 我可以同时为 Windows 和 Linux 平台编写 Python Web 应用程序吗？

> ID：662762
> 
> 赞同：3
> 
> 时间：2009-03-19T15:52:10.273
> 
> 标签：python, cgi, fastcgi, wsgi

我可以编写可以在 Windows（IIS Web 服务器）和 Linux（Apache 或 lighttpd）上托管的 Web 应用程序而无需任何更改吗？

电脑动画？也许有什么新东西？WSGI | 快速CGI ?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T15:55:57.987

是的你可以。但是你也可以在 Windows 上使用 apache。如果您采用 IIS 方式，则只有 CGI，而且很难设置。您还可以使用基于 python 的服务器，例如 CherryPy，它非常好，可以在所有带有 python 的平台上工作。

django 等一些框架同时支持 CGI 和 WSGI，因此您不必过多担心 WSGI 或 CGI 的细节。

如果你问我，WSGI 是 Python Web 应用程序的未来。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:55:29.330

web.py 包含一个服务器......它将为小型工作解决问题。

顺便说一句，Apache 在 Windows 上工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T15:56:14.040

是的，如果您使用 CGI、FastCGI 或根据您的框架，甚至是自包含的 Web 服务器（因此 IIS 和 Apache 将成为反向代理），那么这一切都可以工作。

不同之处在于特定于操作系统的服务器的配置，以及每个操作系统上的 Python 环境。因此，您可能会发现自己在开始时做了一些工作以确保您的路径是正确的，等等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T16:03:33.773

一个相当大的基于 Python 的 Web 框架是[ZOPE](http://www.zope.org/)。

> Zope 是一个开源应用程序服务器，用于构建内容管理系统、内部网、门户和自定义应用程序。Zope 社区由全球数百家公司和数千名开发人员组成，致力于构建平台和 Zope 应用程序。Zope 是用 Python 编写的，Python 是一种高效的面向对象的脚本语言

ZOPE 在 Linux 和 Windows 上可用，您可以使用 Python 编写您的*Zope Web 应用程序*（它也包括一个更简单的模板系统）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T17:56:23.550

还要考虑使用 web2Py、XML-RPC 实现或 Twisted 的可能性...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T18:09:19.663

编写 python web 应用程序本身就是一个主题，但我想说的是，默认情况下，它可以在多个服务器/平台上移植。

在开发 Python Web 应用程序时，您通常会使用提供自己的 Web 服务器的框架。出于性能原因，您可能希望将它放在 apache 后面，但这甚至没有必要，但是，您可以通过将它放在 apache 服务器后面来提高性能。

一些最流行的 web python 框架是：Plone、Zope、CherryPy 和 TurboGears，仅举几例。

在 apache 下，你还可以通过 mod_python 使用 python 服务器页面，并且由于 apache 也可以在 windows 上运行，这也可以移植。

# c# - 在 using 块的中间返回

> ID：662773
> 
> 赞同：218
> 
> 时间：2009-03-19T15:53:39.960
> 
> 标签：c#, dispose, idisposable, using-statement

就像是：

```
using (IDisposable disposable = GetSomeDisposable())
{
    //.....
    //......
    return Stg();
} 
```

我认为这不是退货声明的合适位置，是吗？

* * *

## 回答 #1

> 赞同：208
> 
> 时间：2009-03-19T16:02:18.627

正如其他几个人一般指出的那样，这不是问题。

唯一会导致您出现问题的情况是，如果您在 using 语句的中间返回并另外返回 in using 变量。但是话又说回来，即使您没有返回并且只是保留对变量的引用，这也会给您带来问题。

```
using ( var x = new Something() ) { 
  // not a good idea
  return x;
} 
```

一样糟糕

```
Something y;
using ( var x = new Something() ) {
  y = x;
} 
```

* * *

## 回答 #2

> 赞同：165
> 
> 时间：2009-03-19T16:01:54.370

完全没问题。

你显然在想

```
using (IDisposable disposable = GetSomeDisposable())
{
    //.....
    //......
    return Stg();
} 
```

被一味翻译成：

```
IDisposable disposable = GetSomeDisposable()
//.....
//......
return Stg();
disposable.Dispose(); 
```

诚然，这将是一个问题，并且会使`using`声明变得毫无意义——这就是为什么它**不是**这样做的。

编译器确保对象在控制离开块之前被释放——不管它是如何离开块的。

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2009-03-19T15:56:53.227

这绝对没问题 - 完全没有问题。为什么你认为这是错误的？

using 语句只是 try/finally 块的语法糖，正如 Grzenio 所说，也可以从 try 块返回。

将计算返回表达式，然后执行 finally 块，然后方法将返回。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2009-03-19T15:55:30.827

这将完全正常，就像在中间返回一样`try{}finally{}`

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-03-19T15:56:05.163

这是完全可以接受的。*using*语句确保 IDisposable 对象无论如何都会被释放。

来自[MSDN](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)：

> using 语句可确保调用 Dispose，即使在调用对象上的方法时发生异常也是如此。您可以通过将对象放在 try 块中，然后在 finally 块中调用 Dispose 来获得相同的结果；事实上，这就是编译器翻译 using 语句的方式。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2017-08-02T09:35:38.017

下面的代码显示了如何`using`工作：

```
private class TestClass : IDisposable
{
   private readonly string id;

   public TestClass(string id)
   {
      Console.WriteLine("'{0}' is created.", id);
      this.id = id;
   }

   public void Dispose()
   {
      Console.WriteLine("'{0}' is disposed.", id);
   }

   public override string ToString()
   {
      return id;
   }
}

private static TestClass TestUsingClose()
{
   using (var t1 = new TestClass("t1"))
   {
      using (var t2 = new TestClass("t2"))
      {
         using (var t3 = new TestClass("t3"))
         {
            return new TestClass(String.Format("Created from {0}, {1}, {2}", t1, t2, t3));
         }
      }
   }
}

[TestMethod]
public void Test()
{
   Assert.AreEqual("Created from t1, t2, t3", TestUsingClose().ToString());
} 
```

输出：

> 't1' 被创建。
> 't2' 被创建。
> 't3' 被创建。
> “从 t1、t2、t3 创建”已创建。
> 't3' 被释放。
> 't2' 被释放。
> 't1' 被释放。

在 return 语句之后但在函数退出之前调用处置的。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2016-09-23T20:37:50.697

也许这不是100％正确的，这是可以接受的......

如果您碰巧嵌套使用并从嵌套中返回，则可能不安全。

以此为例：

```
using (var memoryStream = new MemoryStream())
{
    using (var textwriter = new StreamWriter(memoryStream))
    {
        using (var csv = new CsvWriter(textwriter))
        {
            //..write some stuff to the stream using the CsvWriter
            return memoryStream.ToArray();
        }
    }
} 
```

我传入了一个要输出为 csv 的 DataTable。在中间返回时，它将所有行写入流，但输出的 csv 总是缺少一行（或多行，取决于缓冲区的大小）。这告诉我某些东西没有正确关闭。

正确的方法是确保正确处理所有以前的使用：

```
using (var memoryStream = new MemoryStream())
{
    using (var textwriter = new StreamWriter(memoryStream))
    {
        using (var csv = new CsvWriter(textwriter))
        {
            //..write some stuff to the stream using the CsvWriter
        }
    }

    return memoryStream.ToArray();
} 
```

# jakarta-ee - 隐藏 .xhtml 源代码 - facelets/icefaces？

> ID：662777
> 
> 赞同：4
> 
> 时间：2009-03-19T15:54:04.123
> 
> 标签：jakarta-ee, facelets, icefaces

我对 Icefaces 和 Facelets 都是新手，但我在一个新项目中使用它们。我已经配置好了一切工作正常。但是，当我访问 mywebapp/file.xhtml 时，整个 facelets 模板源会出现在我的浏览器中。我如何隐藏它以防止用户查看我的服务器端模板？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-12T01:40:03.727

将所有模板放入WEB-INF/someDirectory/templates。

然后根据 facelets 文档将它放在你的 web.xml 中，用于所有其他 xhtml 文件：

```
<security-constraint>
    <display-name>Restrict XHTML Documents</display-name>
    <web-resource-collection>
        <web-resource-name>XHTML</web-resource-name>
        <url-pattern>*.xhtml</url-pattern>
    </web-resource-collection>
    <auth-constraint>
        <description>Only Let 'developer's access XHTML pages</description>
        <role-name>someone</role-name>
    </auth-constraint>
</security-constraint> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T15:59:51.347

在 web.xml 中应该有一个条目，可以让您配置 xhtml 模板的行为（显示/隐藏..）

如果将 .jsp 文件移动到 WEB-INF 文件夹（您必须为 JSF 重新配置 jsp 路径），则无法通过 URL 访问它们。我所知道的每个 J2EE-Server/Webcontainer 都是这样操作的。

另一种方法是自写的 servlet 过滤器等。

但是，为什么要隐藏模板？

# c# - 在 ac# 数据表上执行选择

> ID：662798
> 
> 赞同：3
> 
> 时间：2009-03-19T15:57:58.153
> 
> 标签：c#, asp.net, ado.net

我有一个包含一堆行的数据表，第一列是一个`Int32`，我想执行一个简单的选择，例如：

```
select * from MyDataTable where column1 = 234 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T16:01:00.830

试试这个以获得行数组的结果：

```
DataRow[] rows = myDataTable.Select("column1 = 234"); 
```

或者这个来获取数据视图：

```
DataView myDataView = myDataTable.DefaultView;
myDataView.RowFilter = "column1 = 234"; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T16:02:28.253

```
var result = from row in table.AsEnumerable()
             where row[0].Equals(42)
             select row; 
```

或者

```
var result = table.AsEnumerable().Where(row => row[0].Equals(42)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:00:24.840

如果您正在谈论 System.Data.DataTable，您可以使用 datatable.Rows.Find 来按 primaryKey 搜索行，或使用 datatable.Select 来获取满足您条件的行数组。

// 通过DataTable的主键

```
datatable.Rows.Find(234); 
```

// 通过复合主键

```
datatable.Rows.Find(234, 1, 4); 
```

// 通过选择

```
datatable.Select("column1=234"); 
```

// 通过复合选择

```
datatable.Select("column1=234 AND column2=1"); 
```

# .net - Silverlight：重复故事板的一部分

> ID：662803
> 
> 赞同：0
> 
> 时间：2009-03-19T15:59:05.170
> 
> 标签：.net, silverlight, storyboard

是否可以创建后半部分重复但前半部分不重复的故事板？或者，我可以让一个故事板在另一个故事板完成后开始，全部在 xaml 中吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T07:14:43.397

我认为您不能仅在 XAML/Blend 中使用动画，无论如何您都需要在代码中开始它们。

```
StoryBoard1.Begin(); 
```

但是在第一个动画结束时开始另一个动画的代码非常简单：

首先，您在代码中订阅 Completed 事件：

```
this.Storyboard1.Completed += new EventHandler(Storyboard1_Completed);
this.Storyboard2.Completed += new EventHandler(Storyboard2_Completed);
this.Storyboard1.Begin(); 
```

然后在受人尊敬的事件处理程序中，如果 Storyboard1 完成，您将启动 storyboard2，反之亦然。

```
private void Storyboard2_Completed(object sender, EventArgs e){
        this.Storyboard1.Begin();
}

private void Storyboard1_Completed(object sender, EventArgs e)
{
    this.Storyboard2.Begin();
} 
```

要添加事件处理程序，您只需键入 Storyboard.Completed += 然后按两次选项卡，它将生成所需的方法。

# text - Gedit 中的文本换行

> ID：662823
> 
> 赞同：2
> 
> 时间：2009-03-19T16:03:17.563
> 
> 标签：text, indentation, word-wrap, gedit

是否可以在 Gedit（GNOME 文本编辑器）中缩进一行文本？

例如：

```
if (x > y) {
    System.out.println("ABCDEFGHIJ
    KLMNOPQRSTUVWXYZ");
} 
```

代替：

```
if (x > y) {
    System.out.println("ABCDEFGHIJ
KLMNOPQRSTUVWXYZ");
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:07:48.193

开箱即用的 GEdit 是不可能的，但这是一个[**正在处理**](https://bugs.launchpad.net/gedit/+bug/318517)的请求。

# c# - C# 同步对象 - 具有写入访问器的重复代码

> ID：662830
> 
> 赞同：3
> 
> 时间：2009-03-19T16:04:09.183
> 
> 标签：c#, multithreading, synchronization

我喜欢使用在属性更改时锁定的私有对象来同步自身的对象。有没有通用的方法来实现这一点？对于每个属性，我的代码看起来总是这样（带有一个储物柜对象）

```
private Object locker = new Object();
private int x; 
    public int X
    {
    get {return x;} 
    set{
        lock(locker){x=value;}
    } 
```

你是实现属性的线程安全修改的更简单方法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T16:07:27.833

你的代码不应该是那样的——你也应该锁定*get*。否则，由于复杂的内存模型原因，获取数据的线程可能无法获得最新值。

但是不，我不知道有什么方法可以解决这个问题。你可以用 lambda 表达式和扩展方法做一些奇怪的事情，但这将是过度的 IMO。

您还应该认真考虑是否*真的*希望各个属性是线程安全的。这可能是正确的做法——但我发现通常我不需要大多数类型都是线程安全的。只有少数类型需要直接了解线程，然后他们在使用对象时取出适当的锁，而不是对象自己进行锁定。不过，这确实取决于您在做什么。

在某些情况下，另一种选择是使用不可变类型——如果你能做到这一点，那就太好了，尽管如果你需要一个线程来查看另一个线程中所做的更改，你将需要*某种*可变性或同步。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T16:36:44.753

不要成为“推动者”，但如果您确定这绝对是您想要的设计，并且您发现自己重复输入这些属性，您可能希望节省一些击键并编写一个小代码片段以加快添加过程他们。

```
 <?xml version="1.0" encoding="utf-8" ?>
<CodeSnippets  xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
    <CodeSnippet Format="1.0.0">
        <Header>
            <Title>prop</Title>
            <Shortcut>propso</Shortcut>
            <Description>Locking property for SO</Description>
            <Author>TheMissingLinq</Author>
            <SnippetTypes>
                <SnippetType>Expansion</SnippetType>
            </SnippetTypes>
        </Header>
        <Snippet>
            <Declarations>
                <Literal>
                    <ID>type</ID>
                    <ToolTip>Property type</ToolTip>
                    <Default>int</Default>
                </Literal>
                <Literal>
                    <ID>property</ID>
                    <ToolTip>Property name</ToolTip>
                    <Default>MyProperty</Default>
                </Literal>
                <Literal>
                    <ID>field</ID>
                    <ToolTip>Field Name</ToolTip>
                    <Default>myField</Default>
                </Literal>
            </Declarations>
            <Code Language="csharp">
            <![CDATA[private $type$ $field$;
                public $type$ $property$ 
                {
                    get
                    {
                        lock(locker) { return this.$field$; }
                    }
                    set
                    { 
                        lock(locker) { this.$field$ = value; } 
                    }
                }
            $end$]]>
            </Code>
        </Snippet>
    </CodeSnippet>
</CodeSnippets> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-25T05:31:45.380

我不断发现自己对 C# 可以使用新的 C# 3.0 功能做什么感到惊讶。我打算把一些我认为一般的东西扔出去，但结果比我希望的要好。这里是。

制作一个对象来保存所有值（让我们称它为“值持有者”......但不要与该术语的任何其他用法混淆）。它只有 C# 自动属性。然后制作另一个可以访问价值持有者的对象。将第二个对象称为“SynchronicityHandler”（很糟糕的术语，但会理解这个概念）。

让 SynchronicityHandler 进行锁定。它现在可以是通用的。所以这就是你得到的：

```
public class PersonValueHolder
{
     public string FirstName { get; set; }
     public string LastName { get; set; }
     public bool HasCollegeDegree { get; set; }
}

public class SyncronicityHandler<T>
{
     private object locker = new object();

     private T valueHolder;

     public SynchronicityHandler(T theValueHolder)
     {
          this.valueHolder = theValueHolder;
     }

     public void WorkWithValueHolderSafely(Action<T> yourAction)
     {
          lock(locker)
          {
               yourAction(valueHolder);
          }
     }
} 
```

这是您如何称呼它的示例：

```
var myPerson = new SynchronicityHandler(new PersonValueHolder());

// Safely setting values
myPerson.WorkWithValueHolderSafely( p => 
     {
          p.FirstName = "Douglas";
          p.LastName = "Adams";
          p.HasCollegeDegree = true;
     });

// Safely getting values (this syntax could be improved with a little effort)
string theFirstName = null;

myPerson.WorkWithValueHolderSafely( p=> theFirstName = p.FirstName);

Console.Writeline("Name is: " + theFirstName); // Outputs "Name is: Douglass". 
```

真的，现在我想起来了，“价值持有者”不必只是自动属性。它可以是任何对象。

# mfc - 向 CMFCToolBar 按钮添加下拉箭头

> ID：662837
> 
> 赞同：0
> 
> 时间：2009-03-19T16:06:38.600
> 
> 标签：mfc, drop-down-menu, mfc-feature-pack

谁能解释如何向 CMFCToolBar 工具栏按钮添加下拉箭头 - 例如撤消/重做按钮。我们通过使用 TBSTYLE_EX_DRAWDDARROWS 样式和 TBN_DROPDOWN 通知在 CToolBar 中实现了这一点。这似乎不适用于 CMFCToolBar。我相信这些下拉箭头已添加到 VisualStudioDemo MFC 功能包演示中，但我不知道如何。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T22:17:08.010

在 VisualStudioDemo 示例中，`CMainFrame::OnToolbarReset`他们将工具栏的撤消按钮替换为一个名为 CUndoButton 的自定义类，如下所示：

```
m_wndToolBar.ReplaceButton(ID_EDIT_UNDO, CUndoButton(ID_EDIT_UNDO, _T("&Undo"))); 
```

`CUndoButton`在示例项目的文件`"UndoBar.h"`中声明，因此您可以使用它或随意更改它。

# c# - 需要 C 代码的 C# 等效项

> ID：662844
> 
> 赞同：1
> 
> 时间：2009-03-19T16:07:49.673
> 
> 标签：c#, arrays, initialization

谁能告诉我这个 C 代码的 C# 等价物吗？

```
static const value_string  message_id[] = {

  {0x0000, "Foo"},
  {0x0001, "Bar"},
  {0x0002, "Fubar"},
  ...
  ...
  ...
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T16:09:58.907

```
public Enum MessageID { Foo = 0, Bar = 1, Fubar = 2 }; 
```

`Enum.Format()`然后，您可以使用or获得“字符串”版本`ToString()`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T16:10:37.983

就像是：

```
MessageId[] messageIds = new MessageId[] {
    new MessageId(0x0000, "Foo"),
    new MessageId(0x0001, "Bar"),
    new MessageId(0x0002, "Fubar"),
    ...
}; 
```

（您在其中定义适当的`MessageId`构造函数。）

这是与 C 代码最接近的等价物 - 但您当然应该考虑根据 tvanfosson 的答案的枚举是否可能是更合适的设计选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:12:31.583

```
 private static readonly IDictionary<int, string> message_id = new Dictionary<int, string>
        {
            { 0x0000, "Foo" }, 
            { 0x0001, "Bar" }
        }; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T16:12:59.537

```
private const value_string message_id[] = {

  new value_string() { prop1 = 0x0000, prop2 = "Foo"},
  new value_string() { prop1 = 0x0001, prop2 = "Bar"},
  new value_string() { prop1 = 0x0002, prop2 = "Fubar"},
  ...
  ...
  ...
} 
```

或者更好的是，如果您像字典一样使用它：

```
private const Dictionary<string, int> message_id = {

   {"Foo", 0},
   {"Bar", 1},
   {"Fubar", 2},
   ...
} 
```

其中字符串是您获取值的关键。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T16:12:09.867

不会有完全匹配的。C# 不允许类`static`中的`const`字段。不过，您可以使用`readonly`.

如果您在本地范围内使用它，那么您可以获得匿名输入的好处并执行以下操作：

```
var identifierList = new[] {
    new MessageIdentifier(0x0000, "Foo"),
    new MessageIdentifier(0x0001, "Bar"),
    new MessageIdentifier(0x0002, "Fubar"),
    ...
}; 
```

不过，我更喜欢[**这个解决方案**](http://#662854)。

# c++ - 为什么 std::for_each 是非修改序列操作？

> ID：662845
> 
> 赞同：11
> 
> 时间：2009-03-19T16:07:56.010
> 
> 标签：c++, stl, standards, foreach

我刚刚阅读了 C++ 标准，它`std::for_each`是一个非修改序列操作，以及`find`，`search`等等。这是否意味着应用于每个元素的函数不应该修改它们？这是为什么？什么可能出错？

这是一个示例代码，其中修改了序列。你能看出它有什么问题吗？

```
void foo(int & i)
{
    i = 12;
}

int main()
{
    std::vector<int> v;
    v.push_back(0);

    std::for_each(v.begin(), v.end(), foo);
    // v now contains 12
} 
```

我怀疑这只是一个解释问题，但我想听听你的看法。

PS：我知道我可以使用`std::transform`代替`for_each`，但这不是重点。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-19T16:12:11.863

很简单，您不能进行可能修改容器结构的更改。这是因为在一般情况下，修改容器会使正在使用的迭代器失效。

只要不改变容器的结构（例如容器中元素的顺序），就可以修改元素。

[添加]

* * *

`for_each`请注意，对于“非修改”算法似乎有些混淆。Stroustrup 在“The C++ Programming Language, 3rd Ed”第 4 次印刷的勘误表中总结了这种令人困惑的情况。（*CPL*`for_each` ）关于是否可以修改序列的元素有这个说法（ [http://www.research.att.com/~bs/3rd_printing5.html](http://www.research.att.com/~bs/3rd_printing5.html)）：

> “该`for_each()`算法被归类为非修改算法，因为它没有显式修改序列。但是，如果应用于非常量序列`for_each()`可能会更改序列的元素。例如，请参阅`negate()`11.9 中的使用。” （最近的标准决议）。

CPL 最初表示`for_each`不允许传递给它的函数或函数对象修改传递给它的元素。但是，CPL 是在标准最终确定之前编写和最初发布的，显然在最终确定之前，这个限制就`for_each()`被删除了。

也可以看看：

*   [http://www.angelikalanger.com/Articles/Cuj/03.ForeachTransform/ForEachTransform.html](http://www.angelikalanger.com/Articles/Cuj/03.ForeachTransform/ForEachTransform.html)
*   [litb 的回答](https://stackoverflow.com/questions/662845/why-is-stdforeach-a-non-modifying-sequence-operation/662922#662922)中提到的 C++ LWG 缺陷报告（[http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html#475](http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html#475)）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-19T16:24:38.433

看看他们说的[这个缺陷报告](http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html#475)

> LWG 认为标准中没有任何内容禁止修改序列元素的函数对象。问题是 for_each 在名为“非变异算法”的部分中，并且标题可能令人困惑。非规范性说明应澄清这一点。

但也要注意[这一点](http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-active.html#969)。

他们似乎称其为“非修改”，因为 for_each 本身并没有显式修改序列的元素。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-19T16:16:35.427

我认为“非修改序列操作”意味着此操作不修改**序列**。但是操作**可以修改容器元素**。

容器元素和序列的价值 - 不同的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T21:49:50.727

如上所述，for_each 被归类为“非变异算法”

STL 的“变异”对应物是 std::transform。

由于您表示您知道您可以使用 std::transform，因此上述确实成为重点。它是与阅读您的代码的人的交流点。

如果我看到 std::for_each，很明显无论 foo 做什么，它都不会修改容器。

我遵循的指导方针可以说是：

“如果您希望使用容器的元素来执行某些不更改元素的任务，请使用 std::for_each。

如果您希望使用容器的元素以某种系统方式修改元素，或者在会以某种方式更改它们的任务中使用它们，请使用 std::transform。”

# synchronization - 从飞行模拟器读取数据

> ID：662851
> 
> 赞同：11
> 
> 时间：2009-03-19T16:09:20.297
> 
> 标签：synchronization, hardware, simulation

我正在考虑构建一些硬件组件以与 Microsoft Flight Simulator 交互，它（希望）将显示当前占用屏幕空间的东西（高度计、空速指示器、无线电等）

有没有办法在 FlightSim 运行时读取它们的值，以便我可以将外部硬件组件与它们应该在屏幕上显示的内容同步？最好相对较快，因此没有太多滞后。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T16:13:55.247

此链接可以提供对 MS Flight Simulator API (SimConnect) 的一些见解：http: [//msdn.microsoft.com/en-us/library/cc526983.aspx](http://msdn.microsoft.com/en-us/library/cc526983.aspx)

具体来说，这里有一篇关于监控 AI 对象的文章：http: [//msdn.microsoft.com/en-us/library/cc974114.aspx](http://msdn.microsoft.com/en-us/library/cc974114.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T16:33:38.723

看看Project Magenta

> 迄今为止，从桌面系统到经批准的飞行训练设备，已安装了数千个，**Project Magenta**已成为飞行模拟中非常知名的名称。我们的产品涵盖从特定类型的玻璃驾驶舱、飞行管理系统和交互软件到数据记录和传统的 IFR 培训软件。

*   [链接 1](http://www.projectmagenta.com/)
*   [链接 2](http://www.schiratti.com/)

该项目使用一个名为 FSUIPC 的接口模块

*   [链接 3](http://secure.simmarket.com/pete-dowson-fsuipc4.phtml)

    > FSUIPC4 是 Microsoft Flight Simulator X 的一个插件，它为其他程序提供了一个接口来读取和写入与模拟相关的各种相关数据，并且在许多方面甚至可以控制实际过程本身。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:15:18.813

查看 MS SimConnect API：

[http://www.fs-seine-75.com/SDK/Core%20Utilities%20Kit/SimConnect%20SDK/SimConnect.htm](http://www.fs-seine-75.com/SDK/Core%20Utilities%20Kit/SimConnect%20SDK/SimConnect.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-16T15:47:39.717

我的经验是，SimConnect 不仅适用于 FSX，而且有点问题。我相信您的努力会更好地针对 FSUIPC 库之一，它可以让您与*所有*Microsoft Flight Simulator 版本和 Prepar3D 互操作。

# c - 如何确定 DIB 是自下而上还是自上而下？

> ID：662853
> 
> 赞同：4
> 
> 时间：2009-03-19T16:09:58.127
> 
> 标签：c, winapi, gdi

如果我使用 创建 DIB ，我可以通过将结构的字段设置为负值或正值`CreateDIBSection()`来指定它应该是自上而下还是自下而上。但是，如果我调用这样的位图来填充结构，那么和似乎总是积极的。`biHeight``BITMAPINFOHEADER``GetObject()``DIBSECTION``dsBm.bmHeight``dsBmih.biHeight`

有没有办法找出 DIB 是自上而下还是自下而上，而我`HBITMAP`只有

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T17:46:22.823

不; 为此，您需要 BITMAPINFOHEADER，并且它无法从 HBITMAP 中恢复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T14:30:37.403

无法从 GDI 检索该信息。正如您发现的那样，通过 GetObject 检索到的 BITMAP 和 BITMAPINFOHEADER bmHeight 字段始终为正。bmWidthBytes 字段同样为正值。如果您使用 GDI 句柄在 DIBSection 上（或从）绘制，GDI 将以正确的方式向上绘制 DIBSection。使用提取的 BITMAPINFOHEADER 会导致自上而下的位图错误。

从用户模式判断的唯一方法似乎是使用 GDI 进行测试 - SetPixel 将位图的左上角和左下角像素设置为两个不同的值，然后读取缓冲区以查看哪个写入落在第一个内存位置。

真正最好的选择是构建到您的 API 中 - 无论您将 DIBSection 作为 HBITMAP 传递，确保至少有一个 bool fIsDibSectionTopDown 传递或存储。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T01:44:30.443

我认为你能从 HBITMAP 中得到的最好的东西就是 GetDIBits。然而，GetDIBits 的问题在于它还需要一个 HDC，而 HBITMAP 必须是一个 DDB。

*参见：[GetDIBits 函数](http://msdn.microsoft.com/en-us/library/dd144879(VS.85).aspx)*

我不是很肯定，但是您可能会在转换中失去任何自上而下的感觉。

# ssis - 重新部署自定义控制流组件 SSIS

> ID：662855
> 
> 赞同：2
> 
> 时间：2009-03-19T16:10:00.370
> 
> 标签：ssis

我开发了一个自定义控制流任务组件，只是想检查是否有任何特定的过程或方式，如果我们重新部署组件的第二个/更高版本，那么我们不需要重置工具箱并将组件手动添加到工具箱？截至目前，如果我对自定义组件进行任何更改并重新部署，我必须重置工具箱并在 BIDS 中读取组件。这会导致问题。

提前致谢

赛

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T07:49:15.747

修复程序集版本，使其不会随着每次部署而改变。

即，如果您的 AssemblyInfo.cs 指定程序集版本 1.0.*，请将其设为例如 1.1.0.0，并且不要更改它，除非在主要不兼容版本之间。

# adobe - Adobe HTTP 表单提交 - Windows 身份验证

> ID：662857
> 
> 赞同：0
> 
> 时间：2009-03-19T16:10:25.970
> 
> 标签：adobe, livecycle

我正在尝试让 Windows 身份验证在 Adob​​e Form 提交中工作。当我从本地主机运行东西并且我的用户 ID 出现时它可以工作，但是当我提交到另一台机器时，我不断收到 401 - Not Authorized 错误。这是不支持还是我错过了一些设置？

如果有人感兴趣，最初的问题是我们将人力资源政策文档作为 PDF 文件，底部带有“我同意”按钮，当用户单击该按钮时，将其发布到我可以跟踪的服务器。但是没有 Windows 身份验证，我如何识别用户？

有更好的选择吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-03T17:26:56.497

你可以添加一个带有用户名/id 的隐藏字段吗？我使用 fdf 工具包执行此操作以使表单具有交互性。另一种选择是将用户 ID 作为“我同意”按钮的值传入

# json - 将 CSV/XLS 转换为 JSON？

> ID：662859
> 
> 赞同：147
> 
> 时间：2009-03-19T16:10:28.763
> 
> 标签：json, csv, xls

有谁知道是否有应用程序可以让我最好将 XLS 转换为 JSON？

我也会满足于 CSV 的转换器，因为如果周围没有任何东西，我可能最终不得不自己写。

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2011-05-23T20:19:48.257

你可以试试我做的这个工具：

[数据转换器先生](http://shancarter.github.io/mr-data-converter/)

它转换为 JSON、XML 等。

这也是所有客户端，因此您的数据永远不会离开您的计算机。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2011-01-31T19:51:46.687

这对我来说非常有效，不需要文件上传：

[https://github.com/cparker15/csv-to-json?files=1](https://github.com/cparker15/csv-to-json?files=1)

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2012-12-19T18:31:39.843

由于 Powershell 3.0（随 Windows 8 提供，[可用于 Windows 7 和 Windows Server 2008](http://www.microsoft.com/en-us/download/details.aspx?id=34595)但不适用于 Windows Vista），您可以使用内置的 convertto-json 命令行开关：

```
PS E:> $topicsjson = import-csv .\itinerary-all.csv | ConvertTo-Json 

PS E:\> $topicsjson.Length
11909

PS E:\> $topicsjson.getType()

IsPublic IsSerial Name                                     BaseType                  
-------- -------- ----                                     --------                  
True     True     Object[]                                 System.Array 
```

[Technet 上的在线帮助页面](http://technet.microsoft.com/library/hh849922.aspx)

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2010-05-05T23:05:57.733

如果您找不到现有的解决方案，那么用 Java 构建一个基本的解决方案非常容易。我刚刚为客户写了一个，只花了几个小时，包括研究工具。

Apache POI 将读取 Excel 二进制文件。 [http://poi.apache.org/](http://poi.apache.org/)

JSONObject 将构建 JSON

之后，只需遍历 Excel 数据中的行并构建 JSON 结构即可。这是一些基本用法的伪代码。

```
FileInputStream inp = new FileInputStream( file );
Workbook workbook = WorkbookFactory.create( inp );

// Get the first Sheet.
Sheet sheet = workbook.getSheetAt( 0 );

    // Start constructing JSON.
    JSONObject json = new JSONObject();

    // Iterate through the rows.
    JSONArray rows = new JSONArray();
    for ( Iterator<Row> rowsIT = sheet.rowIterator(); rowsIT.hasNext(); )
    {
        Row row = rowsIT.next();
        JSONObject jRow = new JSONObject();

        // Iterate through the cells.
        JSONArray cells = new JSONArray();
        for ( Iterator<Cell> cellsIT = row.cellIterator(); cellsIT.hasNext(); )
        {
            Cell cell = cellsIT.next();
            cells.put( cell.getStringCellValue() );
        }
        jRow.put( "cell", cells );
        rows.put( jRow );
    }

    // Create the JSON.
    json.put( "rows", rows );

// Get the JSON text.
return json.toString(); 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2013-03-01T17:39:09.773

这对我有用并在客户端运行：http: [//www.convertcsv.com/csv-to-json.htm](http://www.convertcsv.com/csv-to-json.htm)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-09-19T03:25:11.820

我刚发现这个：

[http://tamlyn.org/tools/csv2json/](http://tamlyn.org/tools/csv2json/)

（注意：您必须通过网址提供您的 csv 文件）

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-03-27T23:05:53.637

试试这个小小的免费工具：

[http://keyangxiang.com/csvtojson/](http://keyangxiang.com/csvtojson/)

它利用 node.js [csvtojson 模块](https://github.com/Keyang/node-csvtojson)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-09-26T03:18:10.277

现有的解决方案都不起作用，所以我很快就编写了一个可以完成这项工作的脚本。还将空字符串转换为空值，并分隔 JSON 的标题行。可能需要根据您拥有的 CSV 方言和字符集进行调整。

```
#!/usr/bin/python
import csv, json
csvreader = csv.reader(open('data.csv', 'rb'), delimiter='\t', quotechar='"')
data = []
for row in csvreader:
    r = []
    for field in row:
        if field == '': field = None
        else: field = unicode(field, 'ISO-8859-1')
        r.append(field)
    data.append(r)
jsonStruct = {
    'header': data[0],
    'data': data[1:]
}
open('data.json', 'wb').write(json.dumps(jsonStruct)) 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-03-19T17:08:17.500

看看这是否有帮助：[返回 CSV - 将 CSV 文本转换为对象；通过 JSON](http://staceyw.spaces.live.com/blog/cns!f4a38e96e598161e!1437.entry)

这是 2008 年 11 月发布的博客文章，其中包含 C# 代码以提供解决方案。

从博客文章的介绍中：

> 因为 Json 比 Xml 更容易读写。因此 CSV（逗号分隔值）比 Json 更容易读写。CSV 还具有 Excel 等工具，可以轻松使用和创建。因此，如果您想为下一个应用程序创建配置或数据文件，这里有一些将 CSV 转换为 JSON 到 POCO 对象的代码

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-05-10T18:27:28.903

代替硬编码转换器，CSV 对 Jackson（JSON 处理器）的支持如何：[https](https://github.com/FasterXML/jackson-dataformat-csv) ://github.com/FasterXML/jackson-dataformat-csv 。所以核心 Jackson 可以将 JSON 读取为 POJO、Maps`JsonNode`等几乎任何东西。CSV 支持也可以对 CSV 做同样的事情。将两者结合起来，它是多种格式之间非常强大但简单的转换器（已经有 XML、YAML 的后端，并且正在添加更多）。

可以在[此处](http://www.cowtowncoder.com/blog/archives/2012/03/entry_468.html)找到说明如何执行此操作的文章。

# stl - 自定义 STL 容器

> ID：662864
> 
> 赞同：3
> 
> 时间：2009-03-19T16:10:50.730
> 
> 标签：stl, containers

我编写了代码，允许按照输入的顺序遍历映射数据。

我编码了几次的解决方案是：

给定键类型 K 和数据类型 D，std::map std::vector

如果想随机查找数据条目，请使用`map.find(K)`. 如果想按入口顺序遍历地图，请使用`std::vector::iterator (begin(), end()]`.

这很好，但作为练习，我想把它写成`'OrderedMap'`一个符合 STL 的容器。我也有（精简到这个讨论）：

```
template <typename K, typename D>
class OrderedMapValue
{
private:
    K first_ref;
    std::map<K,size_t>& m;
    std::vector<D>& v;
public:
    const K& first
    D& second
    assignment operator=(const D& data) 
    {
        std::map<K,size_t>::const_iterator iter = m.find(first_ref);
        v[iter.second] = data;  // error checking of iter stripped
    }
}; 
```

进一步假设

```
template <typename K, typename D>
class OrderedMap
{
public:
     typename OrderedMapValue<K,D>& OrderedMap<K,D>::operator[](const K&);
     // snip...
};

class MyClass
{
public:
    MyClass(std::string s) : _my_data(s) {}
private:
    std::string _my_data;
}; 
```

以下代码有效：

```
OrderedMap<std::string,MyClass*> omap;
omap["MyKey"] = new MyClass("dummy"); 
```

但是，此代码不会：

```
OrderedMap::iterator iter = omap.find("MyKey");
MyClass * obj = iter->second;
delete obj;
iter->second = new MyClass("dummy"); 
```

假设我做了某事 a) 结构愚蠢或 b) 不必要的复杂，应该怎么做？

我意识到我很可能在这里重新发明轮子，但同样，这项工作主要是为了增加我对 STL 容器、它们的设计模式和正确使用的知识。

提前感谢您的任何见解，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T04:04:32.417

I don't have a compiler right now to test this, so there could be errors, but I think you want it more like:

```
template <typename K, typename D>
class OrderedMap
{
private:
        std::map<K,size_t> &m;
        std::vector<D> &v;
public:
    typename pair<K,D> TYPE;

        TYPE& operator[](const K &k)
    {
        return v[ m[ k ]];
    }

    TYPE& operator[](size_t idx)
    {
        return v[ idx ];
    }

    pair<iterator,bool> insert( const TYPE& pair )
    {
        map<K, size_t>::const_iterator iter;
        iter = m.find( pair.first );

        if( iter != m.end() )
            return make_pair( v[ iter.second], false );

        m.insert( make_pair( pair->first, v.size() ));
        v.push_back( pair->second );

        return make_pair(  v.last() , inserted );
    }

    iterator &begin()
    {
        return v.begin();
    }
    // etc
}; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T03:23:58.927

在`OrderedMapValue::operator=`中，您有：

```
 std::map<K,size_t>::const_iterator iter = m.find(first_ref); 
```

是什么`first_ref`？该代码没有在其他地方引用它（没有双关语）。在我看来，它可能是旧实现的痕迹，在其他地方被公共成员取代

`const K& first`.

这可能是问题吗？

**从评论中编辑**：代码没有显示 first_ref 在任何地方被初始化；所以据我所知，调用`m.find(first_ref)`是搜索一个空字符串，而不是 OrderedMapValue 的键。

# asp.net - AJAX 自动完成性能

> ID：662871
> 
> 赞同：4
> 
> 时间：2009-03-19T16:13:06.637
> 
> 标签：asp.net, asp.net-ajax

如何提高 AJAX 自动完成性能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T16:15:07.973

缓存，客户端和服务器端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T16:31:19.650

这个来自 flickr 开发人员的最新[链接](http://code.flickr.com/blog/2009/03/18/building-fast-client-side-searches/)可能对您有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-07T21:07:38.733

请参阅此处的 .NET 服务器端实现： http: [//metalthought.blogspot.com/2009/05/enhanced-performance-for-aspnet-ajax.html](http://metalthought.blogspot.com/2009/05/enhanced-performance-for-aspnet-ajax.html)

# .net - 奇怪的所有者绘制的变量组合框行为

> ID：662872
> 
> 赞同：2
> 
> 时间：2009-03-19T16:13:07.073
> 
> 标签：.net, combobox, scroll

在我的 .NET 所有者绘制的变量组合框中，当我按页或鼠标滚轮移动时，它似乎在错误的方向上滚动，但最终出现在正确的项目上。

似乎没有什么可以避免这种行为。我尝试将其设为所有者绘制固定，但随后它改变了组合框的大小。

我怎样才能让它正常滚动？

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-18T14:59:06.613

尝试使用 CBS_OWNERDRAWFIXED 样式而不是 CBS_OWNERDRAWVARIABLE 创建窗口

# c# - 如何仅在需要时使用 ADO.NET Entity Framework 加载 varbinary(max) 字段？

> ID：662873
> 
> 赞同：8
> 
> 时间：2009-03-19T16:13:23.750
> 
> 标签：c#, linq, entity-framework, ado.net, linq-to-entities

我的一个表中有一个 varbinary(max) 字段，但我并不每次都需要它，我正在寻找一种仅在必要时从数据库中获取它的方法。我正在使用 ADO.NET 实体框架。怎么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T11:44:02.157

解决方案是使用 varbinary 字段创建一个单独的表，并在表之间建立一对一的关系

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-01-29T12:45:02.020

不一定要创建单独的表。你应该做几个步骤。假设我们有表“文档”（Id、Name、Data (varbinary)）。

1.  打开 EF 设计器，复制并粘贴“文档”实体。
2.  将其重命名为“DocumentData”。将映射添加到“文档”表。
3.  删除“文档”实体中的“数据”属性。
4.  删除“DocumentData”实体中的“名称”属性。
5.  右键单击“DocumentData”实体并添加新的关联。选择与“文档”实体的一对一关联。
6.  选择新关联，转到属性，单击“引用约束”字段上的“...”，选择“文档”实体作为主体，将所有内容保留为默认值（Id -> Id），然后单击“确定”。

现在构建项目。

笔记。现在，在创建新的“文档”实体时，即使您还不想放置任何数据，您也应该创建新的“文档数据”实体：

```
Document doc = new Document();

doc.Name = "My document";
doc.DocumentData = new DocumentData();

context.Documents.Add(doc);
context.SaveChanges(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T17:23:02.537

一种方法是在不需要 blob 时将结果集投影为匿名类型：

```
from entity in context.Entities
select new 
{
    Field1 = entity.Field1,
    Field2 = entity.Field2
} 
```

在此示例中，仅加载 Field1 和 Field2。

此方法的缺点是您无法更新返回的实例并执行 context.SaveChanges。尽管我认为在不完全了解实例的情况下保存实例是不安全的。当您想要返回实例的长列表时，此方法很好，但在实际更新之前将查询单个实例、varbinary 字段和所有。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-18T19:03:07.800

您应该从表中删除您的 varbinary 字段，并将其放在另一个表中，在它们之间建立一对一的关系。这是一个很好的做法，因为您可以轻松实现延迟加载和其他内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-09T16:57:27.190

表拆分。[Entity Developer](http://www.devart.com/entitydeveloper/)工具允许直观地执行此操作。您可以将实体映射到不同的表。

# delphi - Delphi/Win32 的虚拟库接口？

> ID：662875
> 
> 赞同：5
> 
> 时间：2009-03-19T16:13:47.523
> 
> 标签：delphi

我阅读[了这篇文章](http://hallvards.blogspot.com/2007/10/dn4dp22-net-only-pinvoke-magic.html)，发现虚拟库接口的概念非常适合运行时加载 DLL。但是，它们似乎不适用于 Win32。这是真的？如果是这样：为什么？我看不出有什么可以将这个想法与.NET 联系起来。

编辑：我在这里主要改写 Rob 已经写过的内容。:-)
我不追求插件或类似的东西——它是关于普通的旧 Win32 DLL。吸引我的是让编译器处理在运行时加载 DLL 的所有细节的想法——无需为 DLL 中的每个函数调用 GetProcAddress 等。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T23:41:41.770

在我看来，到目前为止的三个答案完全没有抓住你问题的重点。那个，或者我有。您在问为什么 Win32 Delphi 没有类似`Supports`Hallvard 文章中提到的神奇功能，不是吗？即，给定 DLL 的名称和接口的类型信息的函数返回一个使用从 DLL 导出的独立函数实现该接口的对象。

Hydra 似乎只是从 Win32 程序调用 .Net 代码，而不是从 DLL 导入函数。`TJvPluginManager`要求插件DLL导出一个特殊的自注册函数，管理器在加载DLL时会调用该函数，并且该函数必须返回`TJvPlugin`该类的实例，所以插件DLL必须用Delphi或C++ Builder编写. `Supports`另一方面，该函数适用于以任何语言编写的任何 DLL。如果你愿意，你可以在 kernel32 上使用它。

我不知道为什么Win32 Delphi 没有这样的东西。也许 CodeGear 没有看到对它的太多需求，因为 Delphi 和 Turbo Pascal 已经很久没有它了。

当然可以编写一个这样工作的函数，而且我不认为它会比 .Net 版本更难编写，除非 Microsoft 的 .Net 库已经提供了大部分部分，而 Delphi 只是包装了它们到一个方便调用的函数，看起来就像`Supports`Delphi 多年来拥有的其他几个重载版本。

在 Win32 中实现该功能需要几个步骤。（我只提供了必要内容的草图，因为我现在手边没有运行的 Delphi 副本。问得好，也许我会找到更多细节。）首先，您需要确保该类型接口的信息至少包含其方法的未修饰名称。然后，`Supports`需要为接口中的每个方法（除了 _AddRef、_Release 和 QueryInterface）生成一个函数存根。假设调用约定是，存根会像这样`stdcall`：

```
asm
  // Pop the return address,
  // discard the "this" pointer,
  // and restore the return address
  pop eax
  pop ecx
  push eax

  jmp AddressOfFunction
end; 
```

在`Supports`生成每个存根时，它会填写实际的函数地址，该地址是通过调用获得`GetProcAddress`的相应接口方法的名称。`stdcall`调用约定很容易像这样包装；`cdecl`有点麻烦；`register`是脖子疼。

一旦生成了所有存根，它就需要生成一个看起来像是实现给定接口的“对象”。它不必是一个实际的类。在编译时，`Supports`不知道将被要求实现的界面的布局，因此拥有一个类不会完成太多工作。

最后一步是提供`_AddRef`、`_Release`和`QueryInterface`. `_AddRef`将不起眼；是引用计数达到零时`_Release`调用的位置；除了声称它支持和提供给.`FreeLibrary``QueryInterface``IUnknown``Supports`

Delphi 曾经附带一个示例程序，它演示了实现一个完全没有任何类的接口。这一切都是通过记录和函数指针完成的（毕竟，这最终都是一个接口）。Delphi 还提供了相应的代码来处理类，部分是为了展示 Delphi 可以使事情变得多么容易。我现在找不到演示程序的名称，但我确定它仍然在某个地方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T17:17:07.713

此类功能有许多 Win32 选项。[JEDI 项目](http://delphi-jedi.org/)有一个开源插件系统，作为 JVCL 的一部分，它可以加载 DLL 或包，并且可以包含表单和诸如此类的附加功能。

还有许多可用的商业产品，包括[TMS 插件框架](http://tmssoftware.com/site/tpf.asp)和[RemObjects Hydra](http://www.remobjects.com/hydra.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T18:06:30.560

这不是什么新鲜事或特别的事。这篇文章只是在谈论插件。本机代码多年来一直能够做插件。P/Invoke 的唯一特别之处在于它允许本地代码和 .NET 在插件系统中相互通信，以及“DLL 可以被视为实现接口的单例对象 [so that]您可以使用 Borland.Delphi.Win32 单元中的 Supports 函数来检查 DLL 和所有方法是否可用。"

如果您想在 Delphi for Win32 中执行本文所述的操作，请查看 LoadLibrary、GetProcAddress 和 FreeLibrary Windows API 函数。如果您绝对必须有文章描述的接口，则必须自己编写它，或者在 DLL 中（如果您自己编写 DLL）通过编写一个返回接口的导出函数，或者在调用应用程序中编写一个使用 GetProcAddress 动态创建接口的函数。（注意：这需要使用指针，而且通常比它的价值更麻烦。）

您最好的选择可能就是按照 Tim Sullivan 所说的去做：如果您只需要本机代码，则使用[JEDI VCL](http://jvcl.sourceforge.net)中的 TJvPluginManager，如果您必须与 .NET 程序集对话，则使用[Hydra 。](http://www.remobjects.com/hydra.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T21:44:24.967

我自己将 Hydra 用于 Delphi 唯一的解决方案（即，没有与 .NET 接口），它也适用于该解决方案。它更易于使用并增加了一些细节，但我认为它的实现方式基本上与本文中详细描述的“roll-your-own”插件框架相同：http: [//www.saxon.co.uk /单包/](http://www.saxon.co.uk/SinglePkg/)

我会寻找一个基于接口的插件框架（如 Hydra 和上一段中的“roll-your-own”系统），而不是简单地在应用程序之间发送消息的插件框架。

sourceforge上有一个Delphi插件框架，不知道是不是和JEDI项目一样：http: [//sourceforge.net/projects/rd-dpf](http://sourceforge.net/projects/rd-dpf)

还有一些其他商业解决方案，其中之一是 Dragonsoft 的： [http ://www.dragonsoft.us/products_dsps.php](http://www.dragonsoft.us/products_dsps.php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T23:57:31.747

使用简单的 com 对象执行此操作有什么问题？声明一个所有插件都实现的简单接口，并要求每个 com 对象包含一个返回其类 guid 的导出函数。然后使用“插件”就像遍历插件目录一样简单，寻找公开特殊注册功能的 DLL，调用它，然后使用类 guid 调用 com 对象。

我在 WIN32 商业应用程序中使用了类似的东西并取得了巨大的成功。优点是我可以随意切换插件（当然前提是应用程序没有运行以删除现有插件），神奇之处在于每个插件实现的界面。

# php - 需要 MySQL INSERT - SELECT 查询具有数百万条记录的表

> ID：662877
> 
> 赞同：1
> 
> 时间：2009-03-19T16:13:59.427
> 
> 标签：php, mysql

我正在尝试向优化 90GB+ 表迈出一步：

**旧表**

每天桌子抓取大约。来自外部来源的 750,000 条记录，并将它们添加到具有新日期的表中。据我了解，这种情况已经持续了三年。97% 的记录不会从一天到另一天发生变化。

**新表**

我正在尝试遍历旧表（数百万条记录）并消除冗余，这可能会大大减少表的大小。

*旧表*

*   日期
*   记录ID
*   data_field （确实有很多字段，但为了示例）

*新表索引*

*   日期
*   index_id

*新表*

*   index_id
*   记录ID
*   数据字段

**我们遍历 old_table 中每条记录时的逻辑**

if (record_id is not in new_table) or (record_id is in new_table, but the latest entry has a different data_field)

> 将其插入 new_table 并获取 index_id

别的

> 从 new_table_index 获取该 record_id 的最新条目 index_id

总是

> 将 index_id 和日期插入 new_table_index

关于最佳方法的任何想法？我对 MySQL 不够先进，无法将所有这些放在一起。当我尝试用 PHP 编写脚本时，它耗尽了 3GB 的内存，然后失败了。其他建议或疑问？？？非常感谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T20:09:11.110

你可以使用这个：

```
new_table
    * date
    * record_id (pk)
    * data_field

INSERT INTO new_table (date,record_id,data_field)
    SELECT date, record_id, data_field FROM old_table
        ON DUPLICATE KEY UPDATE date=old_table.data, data_field=old_table.data_field; 
```

记录 id 是主键，可以在插入到 old_table 的下方添加相同的插入。

见[mySQL](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T16:48:43.117

首先，我认为没有必要创建两个新表。如果你需要一个索引，那么这就是 MySQL 索引的用途：只需创建一个新表并为其`date`字段设置一个索引。

一个简单的脚本应该做到这一点（假设 new_table 自动递增`index_id`）：

```
INSERT INTO new_table (date, record_id, data_field)
  SELECT
    date,
    record_id,
    data_field
  FROM
    old_table
  GROUP BY
    data_field 
```

在执行此操作之前，您可能会考虑为所有涉及的 data_field 创建一个索引。这样它会非常快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T16:44:20.180

您可以在存储 LastModified 时间的表中添加一列。然后是 On Insert 或 On Update 触发器将该值设置为当前时间。您的数据移植过程可以简单地抓取 LastMotified 大于上一个数据端口的记录。

如果您索引这个新字段，它应该比比较所有数据字段值快得多。

如果您不需要这些检查的每小时粒度，那么您可以简单地将其设为日期字段类型而不是日期时间。该字段会更小，因此它们中的更多将保留在内存中，并且您的 where 过滤器会更快地发生。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T19:27:53.130

我最终使用了 PHP 和 MySQL 的混合体（在开始每种方式都摇摆得太远之后）：

*   为所有前一天 PR 插入前一天的链接（使用 INSERT - SELECT）
*   比较前一天的 PR，如果更改则插入（使用 INSERT - SELECT）
*   为新更新的 PR 插入链接（使用 SELECT - php foreach - UPDATE）
*   每天添加新 PR（使用 INSERT - SELECT）
*   为新 PR 插入链接（使用 INSERT - SELECT）

仍然需要使用 php foreach 循环来完善它，但在大多数情况下，这可以解决问题！感谢你的帮助！

# c# - 如何在 C# 中查找 IIS 站点 ID？

> ID：662879
> 
> 赞同：10
> 
> 时间：2009-03-19T16:14:03.450
> 
> 标签：c#, .net, iis, installation, wmi

我正在为我的网络服务编写一个安装程序类。在许多情况下，当我使用 WMI（例如创建虚拟目录时）时，我必须知道 siteId 才能为站点提供正确的元数据库路径，例如：

```
metabasePath is of the form "IIS://<servername>/<service>/<siteID>/Root[/<vdir>]"
for example "IIS://localhost/W3SVC/1/Root" 
```

如何在 C# 中根据站点名称（例如“默认网站”）以编程方式查找它？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T16:27:36.243

以下是如何通过名称获取它。您可以根据需要进行修改。

```
public int GetWebSiteId(string serverName, string websiteName)
{
  int result = -1;

  DirectoryEntry w3svc = new DirectoryEntry(
                      string.Format("IIS://{0}/w3svc", serverName));

  foreach (DirectoryEntry site in w3svc.Children)
  {
    if (site.Properties["ServerComment"] != null)
    {
      if (site.Properties["ServerComment"].Value != null)
      {
        if (string.Compare(site.Properties["ServerComment"].Value.ToString(), 
                             websiteName, false) == 0)
        {
            result = int.Parse(site.Name);
            break;
        }
      }
    }
  }

  return result;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T16:44:43.377

`ServerComment`您可以通过检查属于元数据库路径的子级的属性来搜索站点，这些子级`IIS://Localhost/W3SVC`具有`SchemaClassName`.`IIsWebServer`

以下代码演示了两种方法：

```
string siteToFind = "Default Web Site";

// The Linq way
using (DirectoryEntry w3svc1 = new DirectoryEntry("IIS://Localhost/W3SVC"))
{
    IEnumerable<DirectoryEntry> children = 
          w3svc1.Children.Cast<DirectoryEntry>();

    var sites = 
        (from de in children
         where
          de.SchemaClassName == "IIsWebServer" &&
          de.Properties["ServerComment"].Value.ToString() == siteToFind
         select de).ToList();
    if(sites.Count() > 0)
    {
        // Found matches...assuming ServerComment is unique:
        Console.WriteLine(sites[0].Name);
    }
}

// The old way
using (DirectoryEntry w3svc2 = new DirectoryEntry("IIS://Localhost/W3SVC"))
{

    foreach (DirectoryEntry de in w3svc2.Children)
    {
        if (de.SchemaClassName == "IIsWebServer" && 
            de.Properties["ServerComment"].Value.ToString() == siteToFind)
        {
            // Found match
            Console.WriteLine(de.Name);
        }
    }
} 
```

这假定该`ServerComment`属性已被使用（IIS MMC 强制其使用）并且是唯一的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-19T16:21:36.803

也许不是最好的方法，但这里有一种方法：

1.  遍历“IIS://servername/service”下的所有站点
2.  对于每个站点，在您的情况下检查名称是否为“默认网站”
3.  如果为真，那么您有您的站点 ID

例子 ：

```
Dim oSite As IADsContainer
Dim oService As IADsContainer
Set oService = GetObject("IIS://localhost/W3SVC")
For Each oSite In oService
    If IsNumeric(oSite.Name) Then
        If oSite.ServerComment = "Default Web Site" Then
            Debug.Print "Your id = " & oSite.Name
        End If
    End If
Next 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-19T17:26:17.990

```
private static string FindWebSiteByName(string serverName, string webSiteName)
{
    DirectoryEntry w3svc = new DirectoryEntry("IIS://" + serverName + "/W3SVC");
    foreach (DirectoryEntry site in w3svc.Children)
    {
        if (site.SchemaClassName == "IIsWebServer"
            && site.Properties["ServerComment"] != null
            && site.Properties["ServerComment"].Value != null
            && string.Equals(webSiteName, site.Properties["ServerComment"].Value.ToString(), StringComparison.OrdinalIgnoreCase))
        {
            return site.Name;
        }
    }

    return null;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-23T22:06:00.617

```
public static ManagementObject GetWebServerSettingsByServerComment(string serverComment)
        {
            ManagementObject returnValue = null;

            ManagementScope iisScope = new ManagementScope(@"\\localhost\root\MicrosoftIISv2", new ConnectionOptions());
            iisScope.Connect();
            if (iisScope.IsConnected)
            {
                ObjectQuery settingQuery = new ObjectQuery(String.Format(
                    "Select * from IIsWebServerSetting where ServerComment = '{0}'", serverComment));

                ManagementObjectSearcher searcher = new ManagementObjectSearcher(iisScope, settingQuery);
                ManagementObjectCollection results = searcher.Get();

                if (results.Count > 0)
                {
                    foreach (ManagementObject manObj in results)
                    {
                        returnValue = manObj;

                        if (returnValue != null)
                        {
                            break;
                        }
                    }
                }
            }

            return returnValue;
        } 
```

# c# - ASP.NET 服务器端视图状态

> ID：662880
> 
> 赞同：3
> 
> 时间：2009-03-19T16:14:52.263
> 
> 标签：c#, asp.net, session, viewstate, session-state

我已经阅读了一些在服务器上存储视图状态的方法：

[这是一个](http://aspalliance.com/72_Server_Side_Viewstate)

[这是另一个](http://www.clanmonroe.com/Blog/archive/2008/08/05/efficient-server-side-view-state-persistence.aspx)

但它们有点复杂。我正在寻找一种无需序列化即可持久化对象的方法。我可以使用会话状态，但如果用户打开多个窗口，则可能会覆盖对象。

有一个简单的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:20:11.923

> 我正在寻找一种无需序列化即可持久化对象的方法。

小心点。这将对您站点的内存使用产生巨大影响，而内存使用通常是可扩展性的最大障碍。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T16:41:23.370

在这种情况下，我会使用唯一键将对象存储在会话中，并将键绑定到页面。所有这些都可以抽象为页面类的属性。

```
public string PersistanceKey
{
    get { 
        if(ViewState["PersistanceKey"] == null)
           ViewState["PersistanceKey"] = "Object" + Guid.NewGuid().ToString();

        return (string)ViewState["PersistanceKey"];
    }
}

public PersistanceObject Persistance
{
    get {
        if(Session[this.PersistanceKey] == null)
            Session[this.PersistanceKey] = new PersistanceObject();

        return (PersistanceObject)Session[this.PersistanceKey];
} 
```

不同的会话密钥将允许在每页的基础上使用不同的对象。或者，您可以考虑使用应用程序缓存（Cache 对象）来自动从内存中删除陈旧的条目，而不是使用 Session 对象，但这有其自身的警告。

应该注意的是，乔尔对他关于内存使用的回答的警告是完全准确的。对于低内存、高使用率或大持久性对象场景，这可能不是最佳主意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:18:43.550

为用户可能打开的每个窗口分配一个编号。将该数字附加到会话密钥。您还应该将数字存储在页面中的某处（查询字符串或隐藏输入），以便能够检索适当的会话变量。

# php - 和之间有速度差异吗？

> ID：662891
> 
> 赞同：11
> 
> 时间：2009-03-19T16:18:12.100
> 
> 标签：php, syntax, php-shorttags

这两个版本之间有速度差异吗？

```
<?php echo $var; ?>

<?=$var?> 
```

你推荐哪个，为什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-19T16:27:44.743

性能差异是微不足道的。此外，使用 APC，性能差异为零，零，无。

短标签在 XML 中是有问题的，因为`<?`它也是 XML 处理标签的标记。因此，如果您正在编写应该可移植的代码，请使用长格式。

请参阅[http://www.php.net/manual/en/ini.core.php](http://www.php.net/manual/en/ini.core.php)`short_open_tag`中的描述

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-19T16:22:48.220

从技术上讲，解析器必须解析较长版本的每个字符，并且每次传输都有更多字符。

如果您的网络服务器没有“预编译”（即：缓存标记化的 PHP 页面），那么性能会略有不同。除非您开始谈论数十亿次运行，否则这应该是微不足道的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-19T16:23:34.177

性能方面，它是微不足道的。

正确使用说使用更长的，因为它更便携。亲自？我做较短的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-19T16:20:38.957

不，它们是相同的。如果你喜欢打字很多使用`<?php echo $var; ?>`，否则只是节省时间`<?=$var?>`。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-19T16:26:17.133

在 php 5.3 短标签 ASP 样式的 <% %> 支持将被弃用，尽量避免这种情况并将代码重写为`'<?php echo' format`，因为你不能使用`<?xml ?>`例如内联。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-19T17:24:28.617

> 你推荐哪个

都不是，除非你真的想允许 HTML 注入。（99% 的情况下，你不会。）

```
<?php echo htmlspecialchars($var); ?> 
```

或者定义一个使用较短名称执行 echo(htmlspecialchars($arg)) 的函数，以避免所有输入。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-11-11T23:31:27.190

## 这两行代码是相同的。

我添加了一个较晚的答案，因为还没有人证明这一点，但答案是明确的**，没有性能差异，**特别是因为PHP 执行这两行代码的方式*完全*没有区别。

解释器在这两种情况下看到**相同**的代码。解析器产生完全相同的[AST](https://en.wikipedia.org/wiki/Abstract_syntax_tree)，因为`<?=`它与`<?php echo`. `<?=`编写vs时解释器运行的指令没有区别`<?php echo`。

通过安装[php-ast](https://github.com/nikic/php-ast)，您可以检查两行代码生成的 AST。

鉴于这两种情况...

```
# CASE 1
<?php echo $i %>

# CASE 2
<?= $i ?> 
```

两者的抽象语法树是**相同**的：

```
case 1
AST_STMT_LIST
    0: AST_ECHO
        expr: AST_VAR
            name: "i"
case 2
AST_STMT_LIST
    0: AST_ECHO
        expr: AST_VAR
            name: "i" 
```

这意味着 PHP**在运行时无法分辨它们之间的区别**，更不用说体验某种性能差异了。

产生此输出的代码如下，并使用[util.php](https://github.com/nikic/php-ast/blob/master/util.php)：

```
<?php
require('util.php');

echo "case 1\n";
echo ast_dump(ast\parse_code('<?php echo $i ?>', $version=50));

echo "\n";

echo "case 2\n";
echo ast_dump(ast\parse_code('<?= $i ?>', $version=50));

echo "\n"; 
```

优化在这里无关紧要。选择取决于个人喜好，特别是因为`<?=`始终可用，与短标签无关，从未被弃用，也不会从语言中删除。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-19T16:27:30.830

我认为第二个需要将 short_open_tag（在 PHP.ini 中）设置为 true。

这意味着它有可能在某些网络服务器上被关闭。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-19T18:04:07.867

速度差异取决于您输入这 9 个额外字符的速度。
它还可以提高代码的可读性，但这值得商榷。

如果您谈论执行速度，则没有明显差异。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-08-12T08:56:47.473

不要试图用这些来优化，没用的。相反，停用 allow_short_tags（因为加载 XML 文件时出现问题）并编写干净、可读和可理解的代码。

即使可能有细微的差别（肯定低于 10%），用它来优化也没有用。如果您的脚本很慢，请先查看您的循环。大多数情况下，通过优化程序流程比使用奇怪的语法可以获得更多的性能。

# c# - 当 DataContext 发生变化时立即更新 Binding

> ID：662892
> 
> 赞同：9
> 
> 时间：2009-03-19T16:18:36.403
> 
> 标签：c#, .net, wpf, data-binding

我试图在更改 DataContext 后立即测量对象，但对象的绑定没有很快更新。这是我的代码：

```
// In MeasureOverride(Size)
m_inputWidth = 0.0;

Size elemSize = new Size(double.PositiveInfinity, RowHeight);
MapElementView ruler = new MapElementView();

// Measure inputs
foreach (MapElementViewModel elem in m_vm.InputElements)
{
   ruler.DataContext = elem;
   ruler.Measure(elemSize);
   m_inputWidth = Math.Max(m_inputWidth, ruler.DesiredSize.Width);
} 
```

我希望更新 View 对象的绑定，以便我可以测量 View 需要多大才能显示 ViewModel。我正在重用相同的视图进行测量，因为我正在虚拟化数据。

有谁知道如何在 DataContext 更改时强制绑定更新？

请注意，绑定最终会更新。

View 包含一个 TextBlock，它是根据 ViewModel 更改大小的主要元素。在更改 DataContext 后，我​​立即查看了此元素上 TextProperty 的 BindingExpression，但调用 UpdateTarget() 并不能解决问题，并且 BindingExpression.DataItem 似乎为空。

编辑： BindingExression 的状态是未附加。诀窍是弄清楚如何附加它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T21:40:57.557

好吧，如果在设置 DataContext 之后，您在 Dispatcher 上以 DataBind 优先级执行了 Invoke，它应该会导致它们都被更新。

由于此代码是在 MeasureOverride 方法中执行的，因此您无法在 Dispatcher 上执行 Invoke。相反，我会制作一个标志，指示是否测量了标尺宽度，如果没有，则在计算这些宽度的方法上执行 BeginInvoke。然后，在计算宽度时，调用 InvalidateMeasure 以强制进行第二次布局传递。

每当其中一个宽度发生变化时，这将需要额外的布局传递。每当必须重新测量文本框时，您都需要将标志重置为 false。

```
private bool isRulerWidthValid = false;

protected override Size MeasureOverride(Size available)
{
    ... // other code for measuring
    if (!isRulerWidthValid)
    { 
        Dispatcher.BeginInvoke(new Action(CalculateRulerSize));
        ... // return some temporary value here
    }

    ... // do your normal measure logic
}

private void CalculateRulerSize(Size available)
{
    Size elemSize = new Size(double.PositiveInfinity, RowHeight);
    m_inputWidth = 0.0;

    foreach (MapElementViewModel elem in m_vm.InputElements)
    {
       ruler.DataContext = elem;
       ruler.Dispatcher.Invoke(new Action(() => { }), DispatcherPriority.DataBind);
       ruler.Measure(elemSize);
       m_inputWidth = Math.Max(m_inputWidth, ruler.DesiredSize.Width);
    }

    // invalidate measure again, as we now have a value for m_inputwidth
    isRulerWidthValid = true;
    InvalidateMeasure();
} 
```

# svn - 如何处理依赖于同一来源的多个项目？

> ID：662898
> 
> 赞同：7
> 
> 时间：2009-03-19T16:19:37.603
> 
> 标签：svn, version-control

这是我在过去一个月中遇到过两次的事情，我什至不确定如何将其表述为 Google 查询。

我实际上是在使用 SVN 来解决所有这些问题，但这似乎应该是一个通用的版本控制问题。

我们有两个项目，其中一个依赖于另一个的一些代码。由于 API 问题，在产品之间建立某种形式的链接是不切实际的（我不想配置所有非编码人员的机器来完成这项工作）。

我想如果我将共享代码的副本放入目录结构中，我最终将覆盖 SVN 使用的所有配置文件。这意味着依赖项目目录中的版本将不再能够更新。

前任：

项目#1 需要使用类 MyExampleClass，然而，MyExampleClass 是项目#2 的一部分并需要它。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-19T17:50:56.760

`svn:externals`几年来，我们一直在实践中使用指向共享代码。我们遇到了一些有趣的问题，您可能应该在使用它之前考虑这些问题。这是我们拥有的结构：

```
root
+---common
|   +---lib1
|   |   \---trunk
|   |       +---include
|   |       \---src
|   \---lib2
|       \---trunk
|           +---include
|           \---src
+---proj1
|   \---trunk
|       +---include
|       |   \---common
|       \---src
|           \---common
\---proj2
    \---trunk
        +---include
        |   \---common
        \---src
            \---common 
```

项目中和项目中的`common`目录都包含引入公共库的外部定义：`include``src`

```
c:\dev> svn pget -v svn:externals proj1\trunk\src\common
Properties on 'c:\dev\proj1\trunk\src\common':
  svn:externals : lib1 http://.../common/lib1/trunk/src
                  lib2 http://.../common/lib2/trunk/src 
```

我们遇到的问题是多方面的，但与随着项目随时间变化而标记和分支我们的源代码有关。如果你想拥有可重现的构建，我上面展示的外部定义有一些非常严重的问题：

1.  它指的是动态目标 - `trunk`。
2.  它没有提到明确的修订。

当您使用 分支时`svn copy`，将逐字复制外部，因为它们实际上只是附加到对象的属性。其他一些 svn 命令（`commit`、`checkout`和`export`）实际上解释了这些属性。当您标记一个项目时，您确实希望始终保留该项目的状态。这意味着您必须将外部“固定”到特定修订版，因此您需要更改外部定义以明确引用您想要的修订版（例如，`"lib1 -r42 http://.../common/lib1/trunk/src"`）。这解决了问题的一个方面。

如果您必须维护公共代码的多个不兼容分支，那么您必须明确指定您想要的分支以及（可能）修订。

不用说，这可能有点让人头疼。幸运的是，Subversion 领域的某个人编写了`svncopy.pl`脚本来自动化其中的一些混乱。我们仍然（并且一直）在为支持这一点的现场部署产品中遇到一些困难而苦苦挣扎，该产品具有一堆共享代码，并且随时需要在现场使用三个不同版本。

如果你确实走这条路，那么一定要考虑随着项目的发展和变化，你将如何保持联系。我们发现，在这里花一点时间思考一个流程会大有帮助。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-19T16:21:02.420

调查[`svn:externals`](https://stackoverflow.com/questions/663155/how-to-get-started-with-svnexternals)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:23:18.843

将所有共享文件放在任一项目或单独项目中的单独文件夹中。然后使用[外部](http://svnbook.red-bean.com/en/1.0/ch07s03.html)引用该文件夹。在同一个文件夹中混合来自不同位置的文件是一个坏主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T09:17:02.803

外部，但请注意此问题：

[Subversion 将外部更新到某个日期](https://stackoverflow.com/questions/683716/subversion-update-externals-to-a-date)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T16:26:47.837

svn:externals 将允许您在目录级别引入文件。像：

```
Proj1\
  File1
  File2

Proj2\
  File3
  File4 
```

然后在 Proj2 中你可以 svn:externals Proj1，最后得到：

```
Proj2\
  Proj1\
    File1
    File2
  File3
  File4 
```

现在，如果您想在 1 个文件夹中包含来自 2 个项目的文件，例如：

```
Proj2\
  File1 <- from Proj1
  File2 <- from Proj1
  File3
  File4 
```

然后我认为SVN不支持。

但是，我使用过其他源代码控制工具，它们可以让您将单个文件从一个项目“链接”到您想要的任何地方（尤其是 Borland StarTeam）。

# sql - WCF 模拟和 SQL 可信连接？

> ID：662902
> 
> 赞同：2
> 
> 时间：2009-03-19T16:20:26.710
> 
> 标签：sql, wcf, .net-3.5, impersonation, trustedconnection

我们有一个托管在 IIS7 下的服务。SQL 服务器的连接字符串设置为 Trusted。为了进行身份验证，我需要在服务上设置模拟并让客户端启动模拟连接。

有没有办法不设置模拟并且仍然允许服务通过受信任的连接登录到 SQL 服务器？我们希望避免让客户端登录服务。我们不确定他们将使用什么作为代理。我认为它更多的是与 SQL 服务器的服务级别协议，而不是客户端到 SQL 服务器的服务。

有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T17:03:05.143

如果您使用域帐户来运行服务正在运行的应用程序池，则可以授予该帐户访问 SQL 服务器的权限。在这种情况下，只有运行应用程序池的帐户才需要拥有权限。

# unix - UNIX 符号引用错误

> ID：662904
> 
> 赞同：1
> 
> 时间：2009-03-19T16:20:53.497
> 
> 标签：unix, compiler-construction

大家好。

我目前正在尝试使用 UNIX 中的 GNU 编译器（分别为 g++、gcc 和 f77）编译多语言程序（C、C++ 和 FORTRAN）。

我所有的源代码都在编译成没有错误的对象，但是我遇到了符号引用错误，因为它们的链接如下所示：

```
f77 -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -o SlowDynamic.exe main.o \
        SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o\
        BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -o SlowDynamic.exe main.o SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o
Undefined                       first referenced
 symbol                             in file
_Znwj                               SA.o
_ZNSt14basic_ofstreamIcSt11char_traitsIcEED1Ev SA.o
_ZNSt14basic_ofstreamIcSt11char_traitsIcEEC1Ev SA.o
_ZNKSsixEj                          main.o
_ZNSolsEPFRSoS_E                    SA.o
_ZNSt14basic_ofstreamIcSt11char_traitsIcEE4openEPKcSt13_Ios_Openmode SA.o
_ZNSolsEd                           SA.o
_ZNSolsEi                           SA.o
__cxa_end_catch                     SA.o
__cxa_begin_catch                   SA.o
_ZdlPv                              SA.o
_ZNSt14basic_ofstreamIcSt11char_traitsIcEE7is_openEv SA.o
_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_c SA.o
_ZSt4cerr                           SA.o
_ZSt4cout                           SA.o
_ZNSt14basic_ofstreamIcSt11char_traitsIcEE5closeEv SA.o
_ZNSt8ios_base4InitD1Ev             main.o
_ZNSt8ios_base4InitC1Ev             main.o
_ZNKSt9basic_iosIcSt11char_traitsIcEEntEv SA.o
__gxx_personality_v0                main.o
_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc SA.o
__cxa_rethrow                       SA.o
_ZNKSs4sizeEv                       main.o
_ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_ SA.o
ld: fatal: Symbol referencing errors. No output written to SlowDynamic.exe
*** Error code 1
make: Fatal error: Command failed for target `SlowDynamic.exe' 
```

使用以下 Makefile：

```
products: SlowDynamic.exe

SlowDynamic.exe: main.o SA.o mersenne.o CFE.o BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o MA_57.o blas.o MA_57_Depend.o Metis.o
    f77 -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -o SlowDynamic.exe main.o \
        SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o\
        BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o

main.o: main.cpp
    g++ -c -o main.o main.cpp

SA.o: SA.cpp
    g++ -c -o SA.o SA.cpp

mersenne.o: mersenne.cpp
    g++ -c -o mersenne.o mersenne.cpp

CFE.o: CFE.c
    gcc -c -o CFE.o CFE.c

MA_57.o: MA_57.f
    f77 -c -o MA_57.o MA_57.f

blas.o: blas.f
    f77 -c -o blas.o blas.f

MA_57_Depend.o: MA_57_Depend.f
    f77 -c -o MA_57_Depend.o MA_57_Depend.f

Metis.o: Metis.f
    f77 -c -o Metis.o Metis.f

BCs.o: BCs.c
    gcc -c -o BCs.o BCs.c

EMatrix.o: EMatrix.c
    gcc -c -o EMatrix.o EMatrix.c

Numbering.o: Numbering.c
    gcc -c -o Numbering.o Numbering.c

KMatrix.o: KMatrix.c
    gcc -c -o KMatrix.o KMatrix.c

Solve.o : Solve.c
    gcc -c -o Solve.o Solve.c

clean: 
    rm *.o Main.exe *.gpi 
```

I have read that this is typically the fault of missing libraries. I know the C & FORTRAN code compiles fine seperatly (respective libraries included) as does the C++ code when compiled on its own. This leads me to believe that it is the interface between the two programs that causes the error. Unfortunatly I've little to no experiance debugging this sort of problem and without any clues from the linker its hard to move forward. I'll include the necessary parts of my program that deal with the interface between the two sides of the program.

First the C++ part: SA.h, SA.cpp

SA.h:

```
class SimAnneal {
    ...
    std::vector<float> DensityArray; 
    std::vector<float> EnergyArray;
  public
    double ObjFunction ();
    ...
} 
```

SA.ccp:

```
#include <math.h>
#include <iostream>
#include <fstream>          
#include <time.h>           
#include <vector>
#include "SA.h"
#include "CFE.h"
#include "randomc.h"  //Includes mersenne.cpp

double SimAnneal::ObjFunction () 
{
    CFE(&DensityArray[0], &EnergyArray[0]); 

      // sends pointers of both arrays to CFE.c and modifies EnergyArray as 
      // shown in CFE.c

    double SumStrainEnergy = 0;

    for (int i = 0; i < EnergyArray.size(); i++)
    {
        SumStrainEnergy += EnergyArray[i];  //Effectively sum of array 
                                                //engy[] from CFE.c
    }

    return SumStrainEnergy;
} 
```

Secondly the C/FORTRAN part: CFE.h, CFE.c

CFE.h:

```
#ifdef __cplusplus
extern "C" {
#endif 

void CFE(float density[], float energy[]);

#ifdef __cplusplus
 }
#endif 
```

CFE.c:

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include "BCs.h"
#include "EMatrix.h"
#include "Numbering.h"
#include "KMatrix.h"
#include "fg_types.h"
#include "Solve.h"

void CFE(float density[], float energy[])
{
    ...stuff...

    float * dens;
    dens = density;  //pass pointer of array density[0] in SA.cpp to CFE.c

    ...more stuff....

    float * engy;
    engy = energy; //pass pointer of array energy[0] in SA.cpp to CFE.c

    ***Modify engy in some respects****    
} 
```

Essentially the ObjFunction in SA.cpp is called in main.cpp, which contains main().

Is there any visible fault?

Is there any way I can ask the linker to announce what causes / where the error occours in the linking?

Any help will be much appriciated.

Thank you.

+++ EDIT: Verbose feedback +++

```
birch $ g++ -v Hello.cpp
Reading specs from /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/specs
Configured with: /sfw10/builds/build/sfw10-patch/usr/src/cmd/gcc/gcc-3.4.3/configure --prefix=/usr/sfw --with-as=/usr/ccs/bin/as --without-gnu-as --with-ld=/usr/ccs/bin/ld --without-gnu-ld --enable-languages=c,c++ --enable-shared
Thread model: posix
gcc version 3.4.3 (csl-sol210-3_4-branch+sol_rpath)
 /usr/sfw/libexec/gcc/sparc-sun-solaris2.10/3.4.3/cc1plus -quiet -v Hello.cpp -quiet -dumpbase Hello.cpp -mcpu=v7 -auxbase Hello -version -o /var/tmp//cc2JwHRb.s
ignoring nonexistent directory "/usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/../../../../sparc-sun-solaris2.10/include"
#include "..." search starts here:
#include <...> search starts here:
 /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/../../../../include/c++/3.4.3
 /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/../../../../include/c++/3.4.3/sparc-sun-solaris2.10
 /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/../../../../include/c++/3.4.3/backward
 /usr/local/include
 /usr/sfw/include
 /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/include
 /usr/include
End of search list.
GNU C++ version 3.4.3 (csl-sol210-3_4-branch+sol_rpath) (sparc-sun-solaris2.10)
        compiled by GNU C version 3.4.3 (csl-sol210-3_4-branch+sol_rpath).
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
Hello.cpp:6:2: warning: no newline at end of file
 /usr/ccs/bin/as -V -Qy -s -xarch=v8 -o /var/tmp//ccvAshv7.o /var/tmp//cc2JwHRb.s
/usr/ccs/bin/as: Sun Compiler Common 10 Patch 09/04/2007
 /usr/sfw/libexec/gcc/sparc-sun-solaris2.10/3.4.3/collect2 -V -R/usr/sfw/lib -Y P,/usr/ccs/lib:/usr/lib -Qy /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/crt1.o /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/crti.o /usr/ccs/lib/values-Xa.o /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/crtbegin.o -L/usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3 -L/usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/../../../../sparc-sun-solaris2.10/lib -L/usr/ccs/lib -L/usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/../../.. /var/tmp//ccvAshv7.o -lstdc++ -lm -R/usr/sfw/lib -lgcc_s -lgcc -lc -R/usr/sfw/lib -lgcc_s -lgcc -lc /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/crtend.o /usr/sfw/lib/gcc/sparc-sun-solaris2.10/3.4.3/crtn.o
ld: Software Generation Utilities - Solaris Link Editors: 5.10-1.490 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T16:30:30.587

Some of those undefined symbols clearly relate to standard C++ classes (i.e. ostream).

You need to ensure that you've got at least the C++ library linked (-lstdc++).

To debug further:

1.  Run f77, g++, etc, in verbose mode (`-v`) with single language programs and see which libraries the compiler automatically includes in the link phase for each language

2.  For symbols that are in your own code, use `nm` to look at both the native language declarations and non-native invocations to determine how they mismatch. There are rules about underscore prefixes, etc, which are commonly applied.

(As far as I can remember, but it's 15 years since I last linked C and Fortran, C symbols are always internally prefixed with an underscore, but Fortran symbols are not).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T16:34:16.990

The main problem is that you're doing the linking step with the F77 compiler, which doesn't link in the C++ standard library by default. Like Alnitak said, specify -lg++ explicitly during linking to get it.

Also, if you are calling C++ functions from C code (or from F77 code), make sure you enclose the prototypes of those functions in an extern "C" {} block so that their symbol names show up in the standardized C form, rather than the mangled C++ form (this restricts you from some things, though, such as overloading). See [here](http://www.parashift.com/c++-faq-lite/mixing-c-and-cpp.html) for more information.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T17:14:49.077

Usually, you should link a program containing any C++ code with the C++ compiler, adding the Fortran and C libraries to the link line. Further, the standard advice is to make the main() program C++, nor Fortran, since the startup sequences for C++ are different. Make the Fortran code into a function that you call from a minimal C++ main.

```
int main(void) // Assuming no argument handling - probably incorrect
{
    return(fortran_main_program());
} 
```

# debugging - 使用 xp 开发环境在 iis 6.0 和 7.0 上运行测试/调试网站？

> ID：662910
> 
> 赞同：0
> 
> 时间：2009-03-19T16:21:43.697
> 
> 标签：debugging, iis, testing

考虑到 iis 6.0 及更高版本无法在 xp 上运行，我有哪些可用选项？

我知道远程调试（使用 win 2k3 主机），但我可能没有很容易使用的设施

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T16:28:42.043

我不确定您的确切情况（特别是操作系统许可证的可用性），但您可以考虑虚拟化。我使用过 VirtualBox ( [http://www.virtualbox.org/](http://www.virtualbox.org/) )，听说 MS Virtual PC ( [http://www.microsoft.com/Windows/products/winfamily/virtualpc/default.mspx](http://www.microsoft.com/Windows/products/winfamily/virtualpc/default.mspx) ) 是非常适合 MS 操作系统。

我会注意到我并没有完全按照您的要求完成。但是，我怀疑一旦 IIS 在 VM 中运行，您就可以对 VM 进行“远程”调试。另请注意，您需要公平的硬件来运行虚拟化操作系统以及您的主要主机/开发操作系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T16:44:03.347

出于测试目的和漏洞搜索，请尝试使用此工具[SPIKE 代理](http://www.immunitysec.com/resources-freesoftware.shtml)
：-
修改浏览器信息（C:\SPIKEProxy\spkproxy\spkproxy.py）：
第 449 行：IEstring="Mozilla/4.0（兼容；MSIE 5.0；Windows NT；Bob）
- 将 IE 的代理设置为本地：
Windows 注册表编辑器版本 5.00
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings]
"ProxyServer"="127.0.0.1:8080"
"ProxyOverride"=""

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T17:07:36.160

我会使用虚拟机。我在 VMWare 内部开发取得了一些非常好的结果，而且功能齐全的[VMWare Player](http://www.vmware.com/products/player/)是免费的。它只是无法创建新的虚拟设备，但我认为您可以抓住众多[虚拟设备](http://www.vmware.com/appliances/)之一并在其上安装 Windows。

**编辑：**看来您可以使用此[虚拟设备](http://www.vmware.com/appliances/directory/232)进行快速、轻松的 Windows 安装。您只需要安装 CD 的 ISO，它确实支持 Windows 2000。

# msbuild - 如何替换存储在 MSBuild 属性中的文件路径的扩展名？

> ID：662912
> 
> 赞同：0
> 
> 时间：2009-03-19T16:22:01.590
> 
> 标签：msbuild, properties

我的 MSBuild 项目文件中有以下几行：

```
<PropertyGroup>
    <TestResultsFileName Condition=" '$(TestResultsFileName)' == '' ">
        TestResults.trx
    </TestResultsFileName>
    <TestResultsFilePath>$(OutDir)\$(TestResultsFileName)</TestResultsFilePath>
</PropertyGroup> 
```

我需要创建另一个文件，其名称与 TestResultsFilePath 相同，但扩展名为 .xml。所以我想要一个属性来保存另一个文件的文件路径。

起初，我认为这样的事情会起作用：

```
<PropertyGroup>
    <NUnitResultsFilePath>
        $(OutDir)\$(TestResultsFileName->'%(Filename).xml')
    </NUnitResultsFilePath>
</PropertyGroup> 
```

当然，它没有，因为 TestResultsFileName 不是项目集合。不幸的是，它不可能是这样的，因为它是某些任务的参数，它需要一个简单的值，而不是一个集合。

所以，我的问题是如何用 .xml 替换 TestResultsFileName 属性值的扩展名？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T17:29:50.060

没关系。我写了一个自定义任务来完成这项工作：

```
 public class ReplaceExtension : Task
    {
        [Required]
        public string FilePath { get; set; }

        public string NewExtension { get; set; }

        [Output]
        public string Result { get; set; }

        public override bool Execute()
        {
            if (string.IsNullOrEmpty(FilePath))
            {
                Log.LogError("FilePath cannot be empty!");
                return false;
            }

            try
            {
                int length = FilePath.Length;
                int startIndex = length;
                int oldExtensionLength = 0;
                while (--startIndex >= 0)
                {
                    char ch = FilePath[startIndex];
                    if (ch == '.')
                    {
                        oldExtensionLength = length - startIndex;
                        break;
                    }
                    if (ch == Path.DirectorySeparatorChar || 
                        ch == Path.AltDirectorySeparatorChar || 
                        ch == Path.VolumeSeparatorChar)
                    {
                        break;
                    }
                }

                bool isNewExtensionEmpty = string.IsNullOrEmpty(NewExtension) ||
                    (NewExtension.Length == 1 && NewExtension[0] == '.');

                if (isNewExtensionEmpty)
                {
                    // The new extension is empty - remove the old extension.
                    if (oldExtensionLength > 0)
                    {
                        Result = FilePath.Remove(startIndex, oldExtensionLength);
                    }
                    else
                    {
                        Result = FilePath;
                    }
                }
                else
                {
                    // Replace the old extension with the new one.
                    StringBuilder sb = new StringBuilder(FilePath.Length - oldExtensionLength +
                        NewExtension.Length + (NewExtension[0] == '.' ? 0 : 1));
                    sb.Append(FilePath, 0, FilePath.Length - oldExtensionLength);
                    if (NewExtension[0] != '.')
                    {
                        sb.Append('.');
                    }
                    sb.Append(NewExtension);
                    Result = sb.ToString();
                }
            }
            catch (Exception ex)
            {
                Log.LogErrorFromException(ex);
            }
            return !Log.HasLoggedErrors;
        }
    } 
```

我这样使用它：

```
 <Target Name="CreateProperties">
    <ReplaceExtension FilePath="$(TestResultsFilePath)" NewExtension="xml">
      <Output TaskParameter="Result" PropertyName="NUnitResultsFilePath"/>
    </ReplaceExtension>
  </Target> 
```

# c++ - 如何在一行上连接多个 C++ 字符串？

> ID：662918
> 
> 赞同：169
> 
> 时间：2009-03-19T16:23:11.527
> 
> 标签：c++, string, compiler-errors, concatenation, one-liner

C# 有一个语法特性，你可以在一行中将许多数据类型连接在一起。

```
string s = new String();
s += "Hello world, " + myInt + niceToSeeYouString;
s += someChar1 + interestingDecimal + someChar2; 
```

C ++中的等价物是什么？据我所见，您必须在单独的行中完成所有操作，因为它不支持使用 + 运算符的多个字符串/变量。这没关系，但看起来不那么整洁。

```
string s;
s += "Hello world, " + "nice to see you, " + "or not."; 
```

上面的代码会产生错误。

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2009-03-19T16:27:20.110

```
#include <sstream>
#include <string>

std::stringstream ss;
ss << "Hello, world, " << myInt << niceToSeeYouString;
std::string s = ss.str(); 
```

看看 Herb Sutter 的这篇 Guru Of The Week 文章：[Manor Farm 的字符串格式化程序](http://www.gotw.ca/publications/mill19.htm)

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2014-11-14T08:45:19.053

5年内没人提过`.append`？

```
#include <string>

std::string s;
s.append("Hello world, ");
s.append("nice to see you, ");
s.append("or not."); 
```

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-03-19T16:26:23.873

```
s += "Hello world, " + "nice to see you, " + "or not."; 
```

这些字符数组文字不是 C++ std::strings - 您需要转换它们：

```
s += string("Hello world, ") + string("nice to see you, ") + string("or not."); 
```

要转换整数（或任何其他流式类型），您可以使用 boost lexical_cast 或提供您自己的函数：

```
template <typename T>
string Str( const T & t ) {
   ostringstream os;
   os << t;
   return os.str();
} 
```

你现在可以这样说：

```
string s = string("The meaning is ") + Str( 42 ); 
```

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2009-03-19T16:28:19.937

您的代码可以写为¹，

```
s = "Hello world," "nice to see you," "or not." 
```

...但我怀疑这就是你要找的。在您的情况下，您可能正在寻找流：

```
std::stringstream ss;
ss << "Hello world, " << 42 << "nice to see you.";
std::string s = ss.str(); 
```

* * *

¹ "**可以写成**" ：这仅适用于字符串文字。连接由编译器完成。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2014-07-01T20:00:58.223

使用 C++14 用户定义的文字，`std::to_string`代码变得更容易。

```
using namespace std::literals::string_literals;
std::string str;
str += "Hello World, "s + "nice to see you, "s + "or not"s;
str += "Hello World, "s + std::to_string(my_int) + other_string; 
```

请注意，连接字符串文字可以在编译时完成。只需删除`+`.

```
str += "Hello World, " "nice to see you, " "or not"; 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2018-04-29T17:25:54.697

在 C++20 中，您将能够：

```
auto s = std::format("{}{}{}", "Hello world, ", myInt, niceToSeeYouString); 
```

在此之前，您可以对[{fmt} 库](https://github.com/fmtlib/fmt)做同样的事情：

```
auto s = fmt::format("{}{}{}", "Hello world, ", myInt, niceToSeeYouString); 
```

**免责声明**：我是 {fmt} 的作者。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2014-05-28T11:21:10.310

提供更单行的解决方案：`concat`可以实现一个函数以将基于“经典”字符串流的解决方案简化为**单个语句**。它基于可变参数模板和完美转发。

* * *

**用法：**

```
std::string s = concat(someObject, " Hello, ", 42, " I concatenate", anyStreamableType); 
```

* * *

**执行：**

```
void addToStream(std::ostringstream&)
{
}

template<typename T, typename... Args>
void addToStream(std::ostringstream& a_stream, T&& a_value, Args&&... a_args)
{
    a_stream << std::forward<T>(a_value);
    addToStream(a_stream, std::forward<Args>(a_args)...);
}

template<typename... Args>
std::string concat(Args&&... a_args)
{
    std::ostringstream s;
    addToStream(s, std::forward<Args>(a_args)...);
    return s.str();
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-03-19T16:26:33.920

提升::格式

或 std::stringstream

```
std::stringstream msg;
msg << "Hello world, " << myInt  << niceToSeeYouString;
msg.str(); // returns std::string object 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2017-09-19T09:25:36.743

**实际问题**是在C++ 中将字符串文字与`+`失败连接起来：

> `string s;`
> `s += "Hello world, " + "nice to see you, " + "or not.";`
> 上面的代码会产生错误。

在 C++ 中（也在 C 中），您只需将字符串文字彼此相邻放置即可连接它们：

```
string s0 = "Hello world, " "nice to see you, " "or not.";
string s1 = "Hello world, " /*same*/ "nice to see you, " /*result*/ "or not.";
string s2 = 
    "Hello world, " /*line breaks in source code as well as*/ 
    "nice to see you, " /*comments don't matter*/ 
    "or not."; 
```

这是有道理的，如果您在宏中生成代码：

```
#define TRACE(arg) cout << #arg ":" << (arg) << endl; 
```

...一个可以像这样使用的简单宏

```
int a = 5;
TRACE(a)
a += 7;
TRACE(a)
TRACE(a+7)
TRACE(17*11) 
```

（[现场演示...](https://ideone.com/rQTGSU)）

或者，如果您坚持使用`+`for 字符串文字（正如[underscore_d](https://stackoverflow.com/questions/662918/how-do-i-concatenate-multiple-c-strings-on-one-line#comment55927097_662918)已经建议的那样）：

```
string s = string("Hello world, ")+"nice to see you, "+"or not."; 
```

另一种解决方案`const char*`为每个连接步骤组合了一个字符串和一个

```
string s;
s += "Hello world, "
s += "nice to see you, "
s += "or not."; 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-10-07T03:58:05.147

```
auto s = string("one").append("two").append("three") 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-19T16:28:09.143

您必须为要连接到字符串的每种数据类型定义 operator+()，但由于大多数类型都定义了 operator<<，因此您应该使用 std::stringstream。

妈的，快50秒了……

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-09-10T16:37:46.430

如果你写出`+=`，它看起来几乎和 C# 一样

```
string s("Some initial data. "); int i = 5;
s = s + "Hello world, " + "nice to see you, " + to_string(i) + "\n"; 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-02-22T16:21:27.287

正如其他人所说，OP 代码的主要问题是运算符`+`不连接`const char *`；不过，它适用于`std::string`。

这是另一个使用 C++11 lambda`for_each`并允许提供`separator`分隔字符串的解决方案：

```
#include <vector>
#include <algorithm>
#include <iterator>
#include <sstream>

string join(const string& separator,
            const vector<string>& strings)
{
    if (strings.empty())
        return "";

    if (strings.size() == 1)
        return strings[0];

    stringstream ss;
    ss << strings[0];

    auto aggregate = [&ss, &separator](const string& s) { ss << separator << s; };
    for_each(begin(strings) + 1, end(strings), aggregate);

    return ss.str();
} 
```

用法：

```
std::vector<std::string> strings { "a", "b", "c" };
std::string joinedStrings = join(", ", strings); 
```

至少在我的计算机上进行快速测试之后，它似乎可以很好地扩展（线性）；这是我写的一个快速测试：

```
#include <vector>
#include <algorithm>
#include <iostream>
#include <iterator>
#include <sstream>
#include <chrono>

using namespace std;

string join(const string& separator,
            const vector<string>& strings)
{
    if (strings.empty())
        return "";

    if (strings.size() == 1)
        return strings[0];

    stringstream ss;
    ss << strings[0];

    auto aggregate = [&ss, &separator](const string& s) { ss << separator << s; };
    for_each(begin(strings) + 1, end(strings), aggregate);

    return ss.str();
}

int main()
{
    const int reps = 1000;
    const string sep = ", ";
    auto generator = [](){return "abcde";};

    vector<string> strings10(10);
    generate(begin(strings10), end(strings10), generator);

    vector<string> strings100(100);
    generate(begin(strings100), end(strings100), generator);

    vector<string> strings1000(1000);
    generate(begin(strings1000), end(strings1000), generator);

    vector<string> strings10000(10000);
    generate(begin(strings10000), end(strings10000), generator);

    auto t1 = chrono::system_clock::now();
    for(int i = 0; i<reps; ++i)
    {
        join(sep, strings10);
    }

    auto t2 = chrono::system_clock::now();
    for(int i = 0; i<reps; ++i)
    {
        join(sep, strings100);
    }

    auto t3 = chrono::system_clock::now();
    for(int i = 0; i<reps; ++i)
    {
        join(sep, strings1000);
    }

    auto t4 = chrono::system_clock::now();
    for(int i = 0; i<reps; ++i)
    {
        join(sep, strings10000);
    }

    auto t5 = chrono::system_clock::now();

    auto d1 = chrono::duration_cast<chrono::milliseconds>(t2 - t1);
    auto d2 = chrono::duration_cast<chrono::milliseconds>(t3 - t2);
    auto d3 = chrono::duration_cast<chrono::milliseconds>(t4 - t3);
    auto d4 = chrono::duration_cast<chrono::milliseconds>(t5 - t4);

    cout << "join(10)   : " << d1.count() << endl;
    cout << "join(100)  : " << d2.count() << endl;
    cout << "join(1000) : " << d3.count() << endl;
    cout << "join(10000): " << d4.count() << endl;
} 
```

结果（毫秒）：

```
join(10)   : 2
join(100)  : 10
join(1000) : 91
join(10000): 898 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2018-10-01T18:21:45.593

这是单线解决方案：

```
#include <iostream>
#include <string>

int main() {
  std::string s = std::string("Hi") + " there" + " friends";
  std::cout << s << std::endl;

  std::string r = std::string("Magic number: ") + std::to_string(13) + "!";
  std::cout << r << std::endl;

  return 0;
} 
```

尽管它有点难看，但我认为它和 C++ 中的猫一样干净。

我们将第一个参数强制转换为 a `std::string`，然后使用（从左到右）计算顺序 of`operator+`确保其**左**操作数始终为 a `std::string`。以这种方式，我们`std::string`将左侧的 与`const char *`右侧的操作数连接起来并返回另一个`std::string`，级联效果。

注意：右操作数有几个选项，包括`const char *`、`std::string`和`char`。

由您决定幻数是 13 还是 6227020800。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-08-31T15:57:19.487

也许您喜欢我的“Streamer”解决方案，以便真正做到这一点：

```
#include <iostream>
#include <sstream>
using namespace std;

class Streamer // class for one line string generation
{
public:

    Streamer& clear() // clear content
    {
        ss.str(""); // set to empty string
        ss.clear(); // clear error flags
        return *this;
    }

    template <typename T>
    friend Streamer& operator<<(Streamer& streamer,T str); // add to streamer

    string str() // get current string
    { return ss.str();}

private:
    stringstream ss;
};

template <typename T>
Streamer& operator<<(Streamer& streamer,T str)
{ streamer.ss<<str;return streamer;}

Streamer streamer; // make this a global variable

class MyTestClass // just a test class
{
public:
    MyTestClass() : data(0.12345){}
    friend ostream& operator<<(ostream& os,const MyTestClass& myClass);
private:
    double data;
};

ostream& operator<<(ostream& os,const MyTestClass& myClass) // print test class
{ return os<<myClass.data;}

int main()
{
    int i=0;
    string s1=(streamer.clear()<<"foo"<<"bar"<<"test").str();                      // test strings
    string s2=(streamer.clear()<<"i:"<<i++<<" "<<i++<<" "<<i++<<" "<<0.666).str(); // test numbers
    string s3=(streamer.clear()<<"test class:"<<MyTestClass()).str();              // test with test class
    cout<<"s1: '"<<s1<<"'"<<endl;
    cout<<"s2: '"<<s2<<"'"<<endl;
    cout<<"s3: '"<<s3<<"'"<<endl;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-07-23T07:21:46.053

您可以为此使用此标头：[https ://github.com/theypsilon/concat](https://github.com/theypsilon/concat)

```
using namespace concat;

assert(concat(1,2,3,4,5) == "12345"); 
```

在引擎盖下，您将使用 std::ostringstream。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-01-02T21:34:25.423

如果您愿意使用`c++11`，您可以利用[用户定义的字符串文字](http://en.cppreference.com/w/cpp/language/user_literal)`std::string`并定义两个函数模板，它们为一个对象和任何其他对象重载加号运算符。唯一的缺陷是不要重载 的加号运算符`std::string`，否则编译器不知道使用哪个运算符。您可以使用[`std::enable_if`](http://en.cppreference.com/w/cpp/types/enable_if). [`type_traits`](http://en.cppreference.com/w/cpp/header/type_traits)之后，字符串的行为就像在 Java 或 C# 中一样。有关详细信息，请参阅我的示例实现。

# 主要代码

```
#include <iostream>
#include "c_sharp_strings.hpp"

using namespace std;

int main()
{
    int i = 0;
    float f = 0.4;
    double d = 1.3e-2;
    string s;
    s += "Hello world, "_ + "nice to see you. "_ + i
            + " "_ + 47 + " "_ + f + ',' + d;
    cout << s << endl;
    return 0;
} 
```

# 文件 c_sharp_strings.hpp

在您希望拥有这些字符串的所有位置都包含此头文件。

```
#ifndef C_SHARP_STRING_H_INCLUDED
#define C_SHARP_STRING_H_INCLUDED

#include <type_traits>
#include <string>

inline std::string operator "" _(const char a[], long unsigned int i)
{
    return std::string(a);
}

template<typename T> inline
typename std::enable_if<!std::is_same<std::string, T>::value &&
                        !std::is_same<char, T>::value &&
                        !std::is_same<const char*, T>::value, std::string>::type
operator+ (std::string s, T i)
{
    return s + std::to_string(i);
}

template<typename T> inline
typename std::enable_if<!std::is_same<std::string, T>::value &&
                        !std::is_same<char, T>::value &&
                        !std::is_same<const char*, T>::value, std::string>::type
operator+ (T i, std::string s)
{
    return std::to_string(i) + s;
}

#endif // C_SHARP_STRING_H_INCLUDED 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-10-15T09:24:29.750

像这样的东西对我有用

```
namespace detail {
    void concat_impl(std::ostream&) { /* do nothing */ }

    template<typename T, typename ...Args>
    void concat_impl(std::ostream& os, const T& t, Args&&... args)
    {
        os << t;
        concat_impl(os, std::forward<Args>(args)...);
    }
} /* namespace detail */

template<typename ...Args>
std::string concat(Args&&... args)
{
    std::ostringstream os;
    detail::concat_impl(os, std::forward<Args>(args)...);
    return os.str();
}
// ...
std::string s{"Hello World, "};
s = concat(s, myInt, niceToSeeYouString, myChar, myFoo); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-11-02T10:19:03.310

基于上述解决方案，我为我的项目创建了一个类 var_string 以简化生活。例子：

```
var_string x("abc %d %s", 123, "def");
std::string y = (std::string)x;
const char *z = x.c_str(); 
```

类本身：

```
#include <stdlib.h>
#include <stdarg.h>

class var_string
{
public:
    var_string(const char *cmd, ...)
    {
        va_list args;
        va_start(args, cmd);
        vsnprintf(buffer, sizeof(buffer) - 1, cmd, args);
    }

    ~var_string() {}

    operator std::string()
    {
        return std::string(buffer);
    }

    operator char*()
    {
        return buffer;
    }

    const char *c_str()
    {
        return buffer;
    }

    int system()
    {
        return ::system(buffer);
    }
private:
    char buffer[4096];
}; 
```

仍然想知道 C++ 中是否会有更好的东西？

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-11-10T21:24:48.587

在 c11 中：

```
void printMessage(std::string&& message) {
    std::cout << message << std::endl;
    return message;
} 
```

这允许您像这样创建函数调用：

```
printMessage("message number : " + std::to_string(id)); 
```

将打印：消息编号：10

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-03-10T15:23:17.190

您还可以“扩展”字符串类并选择您喜欢的运算符（<<、&、| 等...）

这是使用 operator<< 显示与流没有冲突的代码

注意：如果您取消注释 s1.reserve(30)，则只有 3 个 new() 运算符请求（1 个用于 s1，1 个用于 s2，1 个用于保留；不幸的是，您不能在构造函数时保留）；没有保留，s1 必须随着它的增长而请求更多的内存，所以它取决于你的编译器实现增长因子（我的似乎是 1.5，在这个例子中调用了 5 个 new()）

```
namespace perso {
class string:public std::string {
public:
    string(): std::string(){}

    template<typename T>
    string(const T v): std::string(v) {}

    template<typename T>
    string& operator<<(const T s){
        *this+=s;
        return *this;
    }
};
}

using namespace std;

int main()
{
    using string = perso::string;
    string s1, s2="she";
    //s1.reserve(30);
    s1 << "no " << "sunshine when " << s2 << '\'' << 's' << " gone";
    cout << "Aint't "<< s1 << " ..." <<  endl;

    return 0;
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-05-15T00:36:17.363

带有使用 lambda 函数的简单预处理宏的 Stringstream 看起来不错：

```
#include <sstream>
#define make_string(args) []{std::stringstream ss; ss << args; return ss;}() 
```

进而

```
auto str = make_string("hello" << " there" << 10 << '$'); 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2013-09-25T17:36:43.797

这对我有用：

```
#include <iostream>

using namespace std;

#define CONCAT2(a,b)     string(a)+string(b)
#define CONCAT3(a,b,c)   string(a)+string(b)+string(c)
#define CONCAT4(a,b,c,d) string(a)+string(b)+string(c)+string(d)

#define HOMEDIR "c:\\example"

int main()
{

    const char* filename = "myfile";

    string path = CONCAT4(HOMEDIR,"\\",filename,".txt");

    cout << path;
    return 0;
} 
```

输出：

```
c:\example\myfile.txt 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2019-01-16T13:04:28.870

您是否尝试避免使用 +=？而是使用 var = var + ... 它对我有用。

```
#include <iostream.h> // for string

string myName = "";
int _age = 30;
myName = myName + "Vincent" + "Thorpe" + 30 + " " + 2019; 
```

# java - 在应用服务器中调用远程 Bean 与本地 Bean

> ID：662921
> 
> 赞同：0
> 
> 时间：2009-03-19T16:24:24.020
> 
> 标签：java, jakarta-ee, jboss, ejb-3.0, application-server

与使用本地 Bean 接口相比，使用远程 Bean 接口是否存在明显的性能开销？如果性能差异不大，我希望每个客户端应用程序都连接到远程 bean。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:28:22.060

是的，有相当多的开销。您*至少*会对每个请求进行序列化。

现在，如果您的请求通常由一个远程调用处理，那可能没问题。如果您计划以这种方式进行大量 bean 间通信，我不会那样做（如果您有大量 bean 参与创建对单个客户端请求的响应，那么您将浪费相当长的时间）

# javascript - 使用 JavaScript 提取语言值

> ID：662923
> 
> 赞同：13
> 
> 时间：2009-03-19T16:24:39.713
> 
> 标签：javascript

我正在尝试从 HTML 标记中获取 lang 值，但我正在使用的当前 JavaScript 不起作用。

这是我试图访问的 HTML 代码：

```
<html  lang="it-IT"> 
```

和 Javascript

```
if(navigator.appName == 'Netscape')
{
    langType = navigator.language;
}
else
{
    langType = navigator.browserLanguage;
} 
```

但在测试中我仍然得到值“EN-us”

任何人都可以帮忙吗？

谢谢！

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-03-19T17:03:06.967

采用

```
document.documentElement.lang 
```

正如 Rob 所评论的，您的代码获取浏览器的语言而不是文档的语言。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T16:30:41.057

试试这个

```
var language = document.getElementsByTagName("html")[0].getAttribute("lang"); 
```

我没有尝试过，但它应该可以工作。

# unit-testing - 硒测试后清理数据

> ID：662928
> 
> 赞同：6
> 
> 时间：2009-03-19T16:25:48.400
> 
> 标签：unit-testing, selenium

我正在为内部 Web 应用程序设置一些 Selenium 测试，并寻求有关测试“最佳实践”的建议。其中一项测试将通过 UI 添加一些无法通过 UI 删除的数据（例如，您可以通过 Web 应用程序添加记录，但删除需要在内部联系某人以在数据库级别删除它）。在 Selenium 测试运行后，您通常如何清理数据？

有问题的应用程序是用 PHP 编写的，我使用 PHP 进行测试（使用 Selenium RC 和 SimpleTest），但我对其他工具等持开放态度，因为这只是一个广泛的最佳实践问题。正在测试的应用程序在我们的开发环境中，所以我并不特别担心测试中的数据会被带走。

一些想法：

1.  Selenium测试中手动连接数据库清理数据
2.  使用类似[DBUnit](http://dbunit.sourceforge.net/howto.html)的东西来管理这个？
3.  只需添加数据，不用担心清理它（也就是惰性方法）

谢谢！

**编辑：**似乎大多数想法都围绕着相同的结论：处理一组已知数据并在测试完成时恢复。这个机制可能会因语言、数据量等而有所不同，但这看起来应该可以满足我的需要。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T16:40:55.243

我将 Selenium 与 Rails 应用程序一起使用，并使用夹具机制从测试数据库加载和卸载数据。它类似于 DbUnit 方法，但由于数据量大，我不会在测试之间卸载和重新加载。（不过，这是[我正在做](https://stackoverflow.com/questions/644227/fixtures-and-selenium-and-rails-oh-my)的事情。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T16:30:19.980

我们有一个数据库恢复例程的 Web 前端。我们的测试做的第一件事是恢复一个“众所周知的”起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T16:58:51.470

将 webapp 指向一个不同的数据库实例，您*可以*在完成测试后擦除该实例。然后，如果您需要调试，您将在测试运行后检查数据库，完成后您可以删除所有表。如果您需要种子数据，您可以导出当前数据库并将其还原到测试之前的新实例中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T01:23:38.140

避免懒惰的方法。这不好，最终会让你失望。[在这个单独的 StackOverflow 问题](https://stackoverflow.com/questions/644227/fixtures-and-selenium-and-rails-oh-my)中查看我之前对此主题的回复。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T21:41:58.503

同意这里的其他答案。我已经将 Selenium 和 DBUnit 测试连接到我从事的过去 3 个项目中。在第一个项目中，我们尝试了惰性方法，但可以预见的是它陷入了困境，所以我们使用了 DBUnit，我没有回头。

我知道您正在使用 PHP，所以请将 DBUnit/JUnit 翻译成您的 PHP 等价物。

几点：

*   使用尽可能少的数据。随着许多 selenium 测试的运行，您希望 DBUnit 加载尽可能快。因此，请尽量减少您正在加载的数据量。
*   仅加载更改的数据。通常，您可以跳过 Web 应用程序从未更改过的表格。参考数据表等。但是，您可能希望创建一个单独的 DBUnit xml 文件/数据库备份来加载此数据，以防您意外丢失它。
*   让 JUnit selenium 测试选择是否需要重新加载。一些 Selenium 测试不会更改任何数据，因此在运行后重新加载数据库是没有意义的。在我的每个 selenium 测试中，我重写/实现了一个方法来返回所需的 DBUnit 行为。

    @Override 受保护的 DBUnitRunConfig getDBUnitRunConfig() {

    ```
    return DBUnitRunConfig.RUN_ONCE_FOR_THIS_TEST_CASE; 
    ```

    }

（无法正确格式化该代码段。） DBUnitRunConfig 在哪里：

```
public enum DBUnitRunConfig {
    NONE, 
    RUN_IF_NOT_YET_RUN_IN_ANY_TEST_CASE, 
    RUN_ONCE_FOR_THIS_TEST_CASE, 
    RUN_FOR_EACH_TEST_IN_TEST_CASE
}; 
```

这减少了通过测试所需的时间。然后，启用 Selenium 的超类（或帮助类）可以为给定的测试运行或不运行 DBUnit。

# c# - C#中的HTML元素属性

> ID：662947
> 
> 赞同：1
> 
> 时间：2009-03-19T16:28:34.413
> 
> 标签：c#, asp.net

它如何为我将在 JS 中使用的 C# 中的元素创建/访问我自己的属性。以及如何访问在 Html 中可用但似乎没有在 c# 集中暴露的属性，例如表格的边框属性我知道我可以使用样式和类来做到这一点，但与最强大的方法。提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-19T16:31:49.367

基类的[`Attributes`属性](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webcontrol.attributes.aspx)就是`WebControl`你要找的。例子：

```
MyControl.Attributes["myattr"] = "examplevalue"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T17:41:36.720

最健壮和最正确的方法是通过 CssClass 属性和在 .css 文件中定义的类。

这样做的一个原因是，如果你有一个只接触 CSS 的设计师，他们可以在不接触你的 C# 源代码的情况下更改样式。如果您没有指定的 CSS 人员，层分离仍然是有益的——想象一下查看源代码来更改边框颜色。

尽可能多地分离 CSS、源代码和 JS 是可取的做法。

# php - Zend_Db 忽略了我的默认字段值！

> ID：662949
> 
> 赞同：1
> 
> 时间：2009-03-19T16:29:49.823
> 
> 标签：php, zend-framework, zend-db, zend-db-table

我正在为我正在做的项目使用 Zend Framework 1.7 和 MySQL 5.0 数据库。系统的一部分是一个较长的表单，它要求用户提供各种日期（以 dd/mm/yyyy 格式）以及一些整数字段。

在我的 MySQL 表中，所有这些字段的默认值为**null**。当我使用模型中的函数（扩展 Zend_Db_Table）来保存表单数据时，任何空白整数字段都设置为**0**，并且任何空白日期字段都设置为**0000-00-00** - 在这两种情况下，它们都应该是**空**。

我相信这是因为 Zend_Db_Table->insert() 引用了所有值，包括空白值。有什么办法可以改变这种行为？我目前必须遍历字段组，并酌情将它们设置为 null。

干杯，
马特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T17:00:18.347

尝试：

```
$data['shouldBeEmtpy'] = new Zend_Db_Expr('NULL'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T11:21:27.703

vartec - 感谢您的帮助。你的想法给了我一个很好的起点。我进一步开发了它，扩展了 Zend_Db_Table，添加了一个从 MySQL 中吸取列元数据的函数，并使用它来设置默认值。我已经在下面发布了它的草稿。我还没有尝试简化它，并且只涵盖了我立即需要的字段类型。希望它可以帮助其他有同样问题的人。

```
public function reformatData($array) {
    if (!is_array($array)) {
        return false;
    }

    $cols = $this->info(Zend_Db_Table_Abstract::METADATA);

    if (is_array($cols)) {
        foreach ($cols as $col) {
            if (array_key_exists($col['COLUMN_NAME'], $array)) {
                switch ($col['DATA_TYPE']) {
                    case 'int': case 'tinyint':
                        if ($array[$col['COLUMN_NAME']] == '') {
                            $newArray[$col['COLUMN_NAME']] = new Zend_Db_Expr('null');
                        }
                        else {
                            $newArray[$col['COLUMN_NAME']] = $array[$col['COLUMN_NAME']];
                        }
                        break;

                    case 'date':
                        if ($array[$col['COLUMN_NAME']] == '') {
                            $newArray[$col['COLUMN_NAME']] = new Zend_Db_Expr('null');
                        }
                        elseif(!Zend_Date::isDate($array[$col['COLUMN_NAME']], 'YYYY-MM-dd')) {
                            $date = new Zend_Date($array[$col['COLUMN_NAME']], null, 'en_GB');
                            $newArray[$col['COLUMN_NAME']] = $date->toString('YYYY-MM-dd'); 
                        }
                        else {
                            $newArray[$col['COLUMN_NAME']] = $array[$col['COLUMN_NAME']];
                        }
                        break;

                    case 'datetime':
                        if ($array[$col['COLUMN_NAME']] == '') {
                            $newArray[$col['COLUMN_NAME']] = new Zend_Db_Expr('null');
                        }
                        elseif(!Zend_Date::isDate($array[$col['COLUMN_NAME']], 'YYYY-MM-dd HH:MM')) {
                            $date = new Zend_Date($array[$col['COLUMN_NAME']], null, 'en_GB');
                            $newArray[$col['COLUMN_NAME']] = $date->toString('YYYY-MM-dd HH:MM'); 
                        }
                        else {
                            $newArray[$col['COLUMN_NAME']] = $array[$col['COLUMN_NAME']];
                        }
                        break;

                    default:
                        $newArray[$col['COLUMN_NAME']] = $array[$col['COLUMN_NAME']];
                        break;
                }           
            }
        }
        return $newArray;
    }
    else {
        return false;
    }
} 
```

# lucene - 具有复杂查询的 Lucene 搜索

> ID：662961
> 
> 赞同：1
> 
> 时间：2009-03-19T16:32:07.947
> 
> 标签：lucene, lucene.net

这是我想做的，使用伪代码：

```
lucene.Find((someField == "bar" || someField == "baz") && anotherField == "foo"); 
```

或者用英语，“查找*someField*为 'bar' 或 'baz' 且*anotherField*为 'foo' 的所有文档”。

如何使用 Lucene 进行这样的查询？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T16:40:04.060

在 Lucene 查询语法中：

```
+(someField:bar someField:baz) +anotherField:foo 
```

“+”表示该术语是必需的，就像 Google 搜索语法一样。括号将术语组合成一个术语。如果没有“+”（或“-”），则术语是可选的；至少有一个词必须匹配，匹配的词越多，得分越高。

将此字符串传递给`QueryParser`以创建`Query`对象。然后可以根据您的需要将查询传递给几种搜索方法之一。

# .net - VB.Net 的解决方法 - 属性的 ByRef 参数

> ID：662962
> 
> 赞同：2
> 
> 时间：2009-03-19T16:32:11.347
> 
> 标签：.net, vb.net, vb6, properties

我有一个遗留的 COM 组件，其接口声明了这样的属性（IDL 表示法）：

```
interface IPasswordCallback : IUnknown {
    [propget] HRESULT Password( [in] VARIANT_BOOL ownerNeeded, [in, out]
        VARIANT_BOOL* isResultValid, [out, retval] BSTR* password );
} 
```

该接口在用 VB6 编写的调用应用程序中实现，如下所示：

```
Public Property Get IPasswordCallback_Password(ByVal ownerNeeded As Boolean,
    ByRef isResultValid As Boolean) As String
    'implementation cut
End Property 
```

Everyting 工作正常，直到我尝试在 VB.Net 中做同样的事情。VB.Net 拒绝编译通过 ByRef 传递属性参数的代码。[MSDN 说](http://msdn.microsoft.com/en-us/library/7abxsyxb.aspx)VB.Net 不允许这样的参数。

有什么办法可以在 VB.Net 中实现这样的属性吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:41:49.000

围绕已正确实现属性的旧接口创建一个新接口。您不需要原始源代码，您可以从 VB6 中引用它并制作一个新的 ActiveX DLL/OCX 来完成这项工作。我意识到有点痛苦。

我自己在我的转换项目中遇到了这个问题，不得不回到旧的 VB6 代码并确保所有属性参数都被声明为 ByVal。问题是我们必须等待 VB6 代码的主要版本更改（当我们破坏二进制兼容性时）。这样做会使新的 DLL 与旧的 DLL 不兼容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T05:01:11.580

如果您无法更改旧 COM 组件的源代码，则必须解决它。一种可能性是创建一个新的 VB6 组件，该组件实现`IPasswordCallback`并通过回调您的 .NET 代码来执行获取密码的实际工作。这样，VB6代码可以处理`ByRef`参数，而.NET代码看不到它。

使其工作的大部分代码将是 VB6 代码，您可以将其放入新的 ActiveX DLL 项目并从您的 .NET 项目中引用。

以下是所需的不同类和接口的概述：

*   类`ByValPasswordCallbackWrapper`(VB6)：此类是一个包装类，它对`ByRef`.NET 代码隐藏参数。当遗留 COM 组件调用此类的`Password`属性时，此类将调用一个帮助程序类（用 .NET 编写），该类将执行实际的回调工作。然后，VB6 类将从帮助程序类中获取结果并将它们返回给旧的 COM 组件。

*   类`PasswordCallbackArgs`(VB6)：该类用于将参数从调用传递 `IPasswordCall_Password`到将执行实际工作的 .NET 帮助器类。

*   接口`IPasswordCallbackProvider`(VB6)：这是您的 .NET 代码将实现而不是`IPasswordCallback`直接实现的接口。

### 编码

下面是上述每个 VB6 组件的代码清单。您可以将此代码添加到一个新的 ActiveX DLL 项目中并对其进行编译，以便从您的 .NET 代码中使用。每个文件都单独列出。顺便说一句，确保这些类中的每一个的*Instancing属性都设置为“5-MultiUse”。*

* * *

**文件**：PasswordCallbackArgs.cls

```
'Used to pass arguments around'

Public OwnerNeeded As Boolean
Public IsValidResult As Boolean 
```

* * *

**文件**： IPasswordCallbackProvider.cls

```
' This is the interface that your .NET                  '
' class should implement (instead of IPasswordCallback) '

Public Function GetPassword(ByVal args As PasswordCallbackArgs)

End Function 
```

* * *

**文件**：ByValPasswordCallbackWrapper.cls

```
Implements IPasswordCallback

Private m_callbackProvider As IPasswordCallbackProvider

Public Property Set CallbackProvider(ByVal callbackProvider As IPasswordCallbackProvider)

   Set m_callbackProvider = callbackProvider

End Property

Private Property Get IPasswordCallback_Password( _
   ByVal ownerNeeded As Boolean, _
   ByRef isResultValid As Boolean) As String

   IPasswordCallback_Password = DoGetPassword(ownerNeeded, isResultValid)

End Property

Private Function DoGetPassword(
   ByVal ownerNeeded As Boolean, _
   ByRef isResultValid As Boolean) As String

   If m_callbackProvider Is Nothing Then
      Err.Raise 5,,"No callback provider. DoGetPassword failed."
   End If

   'Wrap the arguments in a PasswordCallbackArgs object.'
   'Do not need to fill args.IsResultValid here - the callback provider will do that'

   Dim args As New PasswordCallbackArgs
   args.OwnerNeeded = ownerNeeded

   'Get the password and a value to put back into our ByRef isResultValid'
   DoGetPassword = m_callbackProvider.GetPassword(args)
   isResultValid = args.IsResultValid

End Sub 
```

* * *

### 如何使用此代码

将上述代码编译为 ActiveX DLL 后，从您的 .NET 项目中添加对它的引用。

接下来，将您要放入`IPasswordCallback`实现中的 .NET 代码放入一个新类中，该类实现`IPasswordCallbackProvider`. 请记住，回调参数 ( `ownerNeeded`and `isResultValid`) 在对象中传递给您的提供程序类`PasswordCallbackArgs`，因此您必须在您的 .NET 类中使用`args.ownerNeeded`and`args.isResultValid`来引用它们。

这是一个存根提供程序类，可帮助您入门：

**文件**：MyPasswordCallbackProvider.vb (VB.NET)

```
' A stub implementation of an IPasswordCallbackProvider '

Public Class MyPasswordCallbackProvider Implements IPasswordCallbackProvider

   Public Function GetPassword(PasswordCallbackArgs args) As String _
      Implements IPasswordCallbackProvider.Password

      Dim password As String = ""
      Dim resultWasValid As Boolean

      If args.OwnerNeeded Then
         'do stuff'
      Else
         'do other stuff'
      End If

      'do even more stuff'

      'set whether the result was valid or not'
      args.ResultValid = resultWasValid

      Return password

   End Property

End Class 
```

为了将有效值传递`IPasswordCallback`给旧 COM 对象，您需要创建一个`ByValPasswordCallbackWrapepr`，设置其`CallbackProvider`属性，然后将包装器对象传递给旧 COM 对象。

使用上面的示例，并假设您有一个名为 的旧 COM 组件的实例`LegacyComObject`，您将执行以下操作来设置回调：

```
' Create the callback wrapper '
ByValPasswordCallbackWrapper wrapper = New ByValPasswordCallbackWrapper()

' Tell the wrapper to call our custom IPasswordCallbackProvider '
wrapper.CallbackProvider = New MyPasswordCallbackProvider()

''" Pass the call back wrapper to the legacy COM object ''"
''" (not sure how this is done in your scenario. ''"
''" I'm just pretending it's a property since I don't know... "''
LegacyComObject.PasswordCallback = wrapper 
```

### 为什么这样有效

这是因为`ByValPasswordCallbackWrapper`实现了`IPasswordCallback`旧 COM 对象期望接收的接口。反过来`ByValPasswordCallbackWrapper`提供了一种通过`IPasswordCallbackProvider`接口挂钩到回调过程的方法。`IPasswordCallbackProvider`COM 接口与.NET 兼容，因此您可以使用VB.NET 编写实现类。`ByValPasswordCallbackWrapper`调用您来完成获取密码的`IPasswordCallbackProvider`工作，并确保将值放回`ByRef`参数中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T13:57:52.913

所有的答案都非常有用，但它们都建议我在 VB6 中创建这个回调重定向器，这不是很方便，因为我可能必须使用客户端应用程序重新分发 VB6 运行时。

这是解决方案的扩展版本。重定向器可以用 C# 编写，因为 C# 不会抱怨通过 ref 传递。它可以作为类库实现并作为 .dll 程序集分发。这样，任何安装了 .Net Framework 的人都可以使用这样的重定向器。而那些使用 VB.Net 的人肯定已经安装了 .Net Framework。

# mysql - 是什么导致 MySQL 中带有 InnoDB 表的大量待处理读取/写入？我怎样才能防止它们？

> ID：662965
> 
> 赞同：1
> 
> 时间：2009-03-19T16:32:32.080
> 
> 标签：mysql, performance, innodb

我有一个 MySQL 数据库，它有大约 4 亿个 innodb_data_pending_reads 和 innodb_pending_writes。我的其他数据库始终处于或接近于零，所以我注意到了这个大的异常值。

什么会导致这种情况？

会造成哪些不良影响？

我该如何解决这种情况以降低这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T19:17:20.873

在与 MySQL 企业支持讨论此问题后，似乎这是特定服务器正在运行的版本 5.0.18 中的统计报告的一个已知问题。服务器似乎没有受到影响，所以这只是一个虚假的紧急情况。

修复方法是： 1) 升级服务器版本 2) 使用此命令获得更可靠的 InnoDB 统计信息：Iostat -x -a

# html - SAXException：错误的信封标签

> ID：662972
> 
> 赞同：6
> 
> 时间：2009-03-19T16:34:33.557
> 
> 标签：html, soap, tags, envelope

我正在尝试连接到通过 Web 服务客户端保护的 Web 服务 https。Eclipse 生成了一个基于存根的 Web 服务客户端，对我来说看起来不错。当我尝试从 Web 服务调用方法时出现问题：

```
String a = (String)webservice.userProfileServices(xml); 
```

我还使用以下 SOAP 标头：

```
esgGatewayPort = (new EsgGatewayLocator()).getesgGatewayPort();

//setting the authentication header
PrefixedQName name = new PrefixedQName("http://schemas.xmlsoap.org/ws/2002/07/secext","Security","wsse");
System.out.println("Setting headers for authentication");
org.apache.axis.message.SOAPHeaderElement sh = new org.apache.axis.message.SOAPHeaderElement(name);
SOAPElement sub;

try {

      String clntUserName="myUser";
      String clntPassword="myPassword";
      sub = sh.addChildElement("UsernameToken");
      SOAPElement element = sub.addChildElement("Username");
      element.addTextNode(clntUserName);
      element = sub.addChildElement("Password");
      element.addTextNode(clntPassword);
      ((org.apache.axis.client.Stub) esgGatewayPort).setHeader(sh);

} catch (SOAPException e) {

      e.printStackTrace();

} 
```

我收到以下信息：

```
AxisFault
 faultCode: {http://schemas.xmlsoap.org/soap/envelope/}Server.userException
 faultSubcode: 
 faultString: org.xml.sax.SAXException: Bad envelope tag:  HTML
 faultActor: 
 faultNode: 
 faultDetail: 
    {http://xml.apache.org/axis/}stackTrace:org.xml.sax.SAXException: Bad envelope tag:  HTML
    at org.apache.axis.message.EnvelopeBuilder.startElement(EnvelopeBuilder.java:71)
    at org.apache.axis.encoding.DeserializationContext.startElement(DeserializationContext.java:1048)
    at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.startElement(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.scanStartElement(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl$NSContentDriver.scanRootElementHook(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)
    at weblogic.xml.jaxp.WebLogicXMLReader.parse(WebLogicXMLReader.java:133)
    at weblogic.xml.jaxp.RegistryXMLReader.parse(RegistryXMLReader.java:153)
    at javax.xml.parsers.SAXParser.parse(Unknown Source)
    at org.apache.axis.encoding.DeserializationContext.parse(DeserializationContext.java:227)
    at org.apache.axis.SOAPPart.getAsSOAPEnvelope(SOAPPart.java:696)
    at org.apache.axis.Message.getSOAPEnvelope(Message.java:435)
    at org.apache.axis.transport.http.HTTPSender.readFromSocket(HTTPSender.java:796)
    at org.apache.axis.transport.http.HTTPSender.invoke(HTTPSender.java:144)
    at org.apache.axis.strategies.InvocationStrategy.visit(InvocationStrategy.java:32)
    at org.apache.axis.SimpleChain.doVisiting(SimpleChain.java:118)
    at org.apache.axis.SimpleChain.invoke(SimpleChain.java:83)
    at org.apache.axis.client.AxisClient.invoke(AxisClient.java:165)
    at org.apache.axis.client.Call.invokeEngine(Call.java:2784)
    at org.apache.axis.client.Call.invoke(Call.java:2767)
    at org.apache.axis.client.Call.invoke(Call.java:2443)
    at org.apache.axis.client.Call.invoke(Call.java:2366)
    at org.apache.axis.client.Call.invoke(Call.java:1812) 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2015-01-15T13:08:19.963

**端点格式错误**

例如：[http://localhost:8080/YourService/](http://localhost:8080/YourService/)

例如：[http://localhost:8080/YourService?wsdl](http://localhost:8080/YourService?wsdl)

**正确的端点格式来设置构造函数**

例如：[http://localhost:8080/YourService](http://localhost:8080/YourService)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-21T03:38:43.747

I resolved the problem in WAS (WebSphere Application Server), following [http://www-01.ibm.com/support/docview.wss?uid=swg1PK54518](http://www-01.ibm.com/support/docview.wss?uid=swg1PK54518). Applying the appropriate Fix Pack for your version of WAS resolved the issue.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-23T12:32:00.673

问题可能是您正在尝试使用 http 绑定到 https 服务。当 Eclipse 从托管在 https 服务器上的 wsdl 为我生成存根时，我遇到了这个问题。

通过指向服务器 URL 的 eclipse 编辑生成的文件，它应该正确连接。

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-18T08:05:47.913

在我的情况下，从 Axis（不是 Axis2）中的 URL 末尾删除“/”后它得到了解决

我使用的 URL`http://localhost:7000/myWS/`
更改为正常工作后`http://localhost:7000/myWS`！

例外：
`Main: org.xml.sax.SAXException: Bad envelope tag: table at org.apache.axis.AxisFault.makeFault(AxisFault.java:101) at org.apache.axis.SOAPPart.getAsSOAPEnvelope(SOAPPart.java:701) at org.apache.axis.Message.getSOAPEnvelope(Message.java:435) at org.apache.axis.handlers.soap.MustUnderstandChecker.invoke(MustUnderstandChecker.java:62) at org.apache.axis.client.AxisClient.invoke(AxisClient.java:206)`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-08-05T02:40:28.470

主要：org.xml.sax.SAXException：坏信封标签：脚本在我们的例子中，错误“坏信封标签：脚本”由于用户 ID 被锁定而发生

# c++ - 如何在 C++ 中将字符串流转换为字符串？

> ID：662976
> 
> 赞同：145
> 
> 时间：2009-03-19T16:37:09.433
> 
> 标签：c++, string, stringstream

如何在 C++ 中转换`std::stringstream`为？`std::string`

我需要在字符串流上调用方法吗？

* * *

## 回答 #1

> 赞同：243
> 
> 时间：2009-03-19T16:38:00.210

​​​​​​​​​</p>

```
yourStringStream.str() 
```

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2009-03-19T16:38:02.660

使用[.str() 方法](http://www.cppreference.com/wiki/io/sstream/str)：

> 管理底层字符串对象的内容。
> 
> 1) 如同通过调用一样返回底层字符串的副本`rdbuf()->str()`。
> 
> 2) 替换底层字符串的内容，就像调用`rdbuf()->str(new_str)`...
> 
> **笔记**
> 
> str 返回的底层字符串的副本是一个临时对象，它将在表达式的末尾被破坏，因此直接调用（例如 in ）[`c_str()`](http://en.cppreference.com/w/cpp/string/basic_string/c_str)的结果会导致悬空指针......`str()``auto *ptr = out.str().c_str();`

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2015-09-26T20:53:19.240

`std::stringstream::str()`是您正在寻找的方法。

与`std::stringstream`：

```
template <class T>
std::string YourClass::NumericToString(const T & NumericValue)
{
    std::stringstream ss;
    ss << NumericValue;
    return ss.str();
} 
```

`std::stringstream`是一个更通用的工具。您可以使用更专业的类`std::ostringstream`来完成这项特定的工作。

```
template <class T>
std::string YourClass::NumericToString(const T & NumericValue)
{
    std::ostringstream oss;
    oss << NumericValue;
    return oss.str();
} 
```

如果您使用`std::wstring`的是字符串类型，则必须使用`std::wstringstream`or`std::wostringstream`代替。

```
template <class T>
std::wstring YourClass::NumericToString(const T & NumericValue)
{
    std::wostringstream woss;
    woss << NumericValue;
    return woss.str();
} 
```

如果您希望字符串的字符类型可以在运行时选择，您还应该将其设为模板变量。

```
template <class CharType, class NumType>
std::basic_string<CharType> YourClass::NumericToString(const NumType & NumericValue)
{
    std::basic_ostringstream<CharType> oss;
    oss << NumericValue;
    return oss.str();
} 
```

对于上述所有方法，您必须包含以下两个头文件。

```
#include <string>
#include <sstream> 
```

请注意，`NumericValue`上面示例中的参数也可以分别作为 和 实例传递`std::string`或`std::wstring`与`std::ostringstream`和`std::wostringstream`实例一起使用。不必`NumericValue`是数值。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-19T16:37:57.403

从内存中，您调用`stringstream::str()`以获取`std::string`值。

# hibernate - OSGi + 休眠

> ID：662986
> 
> 赞同：8
> 
> 时间：2009-03-19T16:39:02.533
> 
> 标签：hibernate, persistence, osgi

而不是将数据库操作分散在四个（osgi）包中，所有操作都略有不同。我想创建一个负责所有持久性问题的（简单）OSGi 包。我觉得这并不像听起来那么简单，因为“每个包的唯一类加载器”的事情。因此，如果有人知道此类问题的解决方案，我将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T19:38:57.780

我可以想到两种方法来解决类加载问题。

*   您是绑定到特定的 OSGi 框架，还是希望尽可能保持兼容？或者您可以使用 Equinox 进行实施吗？在 Equinox 中，您有一种称为 Buddy Classloading 的机制。此添加允许您增加不同 OSGi 捆绑包之间某些类的可见性。如果您对此主题感兴趣，我想向您介绍这两篇文章：[了解 Eclipse 插件如何与 OSGi 一起工作](http://www.ibm.com/developerworks/library/os-ecl-osgi/index.html)，[Eclipse - 两个 VM（和许多类加载器）的故事](http://www.eclipsezone.com/articles/eclipse-vms/)。
*   如果您更喜欢保持 OSGi 实现独立，那么您可能会考虑将您希望保留的类提取到一个单独的包中，Hibernate-Bundle 和您的其他包都依赖于该包。这样，他们都可以访问持久类的类定义。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-05T10:04:42.447

（如果您使用的是 Hibernate Annotations）

当 Hibernate 包被告知一个带注释的类时，保存所有实体类加载器。

然后在构建你的 SessionFactory 之前做这样的事情。

```
ClassLoad cl = Thread.currentThread().getContextClassLoader();
try {
 Thread.currentThread().setContextClassLoader(yourClassLoader);
 factory = cfg.buildSessionFactory(); 
}finally {
 Thread.currentThread().setContextClassLoader(cl);  // restore the original class loader
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T21:17:32.853

刚刚在 Bundle 类/api 中发现了一个有趣的方法。

```
public java.lang.Class loadClass(java.lang.String name) throws java.lang.ClassNotFoundException 
```

这必须解决一些类加载器问题？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T19:31:49.867

我将建议远离伙伴类加载，因为它特定于 Eclipse 的 Equinox 实现，并且在我看来，人们可以让它工作，但他们不明白为什么，每个人最终都成为其他人的伙伴。这使您无法正确理解 OSGi 类加载的工作原理以及使用它时需要使用的模式（复合类加载器、上下文类加载、OSGi 服务……）。

如果你的持久化包提前知道它需要持久化什么类型，那么包可以导入包含你的域类的所有必需的包（Require-Bundle 是邪恶的）。

管理上下文类加载器（如 Roger 的回复中所示）可以帮助 Hibernate，但我建议使用 Spring dm 之类的东西将其隐藏在 OSGi 服务后面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-31T05:45:50.627

Hibernate[确实支持 OSGi](https://hibernate.atlassian.net/browse/HHH-7527)，但这是一项[持续的努力](https://hibernate.atlassian.net/browse/HHH-8501)。

# puzzle - 字节中设置位的模式

> ID：662988
> 
> 赞同：4
> 
> 时间：2009-03-19T16:39:16.667
> 
> 标签：puzzle

[Joel 在他的Guerrilla Guide to Interviewing](http://www.joelonsoftware.com/articles/fog0000000073.html)中提到计算一个字节中设置的位数是一个编程问题，并谈到了一种利用查找表中出现的模式的方法。在我找到模式后不久，我写了一篇关于它的文章。

总结一下：

```
Number of bits set in a byte in 16x16
0   1   1   2   1   2   2   3   1   2   2   3   2   3   3   4  
1   2   2   3   2   3   3   4   2   3   3   4   3   4   4   5  
1   2   2   3   2   3   3   4   2   3   3   4   3   4   4   5  
2   3   3   4   3   4   4   5   3   4   4   5   4   5   5   6  
1   2   2   3   2   3   3   4   2   3   3   4   3   4   4   5  
2   3   3   4   3   4   4   5   3   4   4   5   4   5   5   6  
2   3   3   4   3   4   4   5   3   4   4   5   4   5   5   6  
3   4   4   5   4   5   5   6   4   5   5   6   5   6   6   7  
1   2   2   3   2   3   3   4   2   3   3   4   3   4   4   5  
2   3   3   4   3   4   4   5   3   4   4   5   4   5   5   6  
2   3   3   4   3   4   4   5   3   4   4   5   4   5   5   6  
3   4   4   5   4   5   5   6   4   5   5   6   5   6   6   7  
2   3   3   4   3   4   4   5   3   4   4   5   4   5   5   6  
3   4   4   5   4   5   5   6   4   5   5   6   5   6   6   7  
3   4   4   5   4   5   5   6   4   5   5   6   5   6   6   7  
4   5   5   6   5   6   6   7   5   6   6   7   6   7   7   8 
```

第一行和第一列完全相同，网格中的每个位置都可以通过将该位置的行和列中的第一个值相加来计算。因此，对于一个 8 位数字，您只需要一个包含 16 个条目的查找表，并且可以只使用前 16 个数字。然后，如果您想计算数字 243 中的设置位，例如，您只需执行以下操作：

```
a = [0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4]
x = 243 / 16 => 15 # (int)
y = 243 % 16 => 3

a[x] + a[y] => 6

# Are there six bits set in the number 243?
243 = 11110011 # yep 
```

之后我注意到的下一个模式是，每次将 NxN 网格的大小加倍时，每个象限都可以通过分别向每个象限添加 0、1、1 和 2 来计算，如下所示：

```
# Make a 4x4 grid on the paper, and fill in the upper left quadrant with the values of the 2x2 grid.  
# For each quadrant, add the value from that same quadrant in the 2x2 grid to the array.  

# Upper left quad add 0 to each number from 2x2  
0   1   *   *  
1   2   *   *  
*   *   *   *  
*   *   *   *  

# Upper right quad add 1 to each number from 2×2  
0   1   1   2  
1   2   2   3  
*   *   *   *  
*   *   *   *  

# Lower left quad add 1 to each number from 2×2  
0   1   1   2  
1   2   2   3  
1   2   *   *  
2   3   *   *  

# Lower right quad add 2 to each number from 2×2  
0   1   1   2  
1   2   2   3  
1   2   2   3  
2   3   3   4 
```

再重复这个过程两次，你会从上面得到 16x16 的网格，所以我想一定有某种四叉树算法可以让你从网格开始：

```
0 1
1 2 
```

并给定一个数字 N，动态生成查找表并计算出位数。所以我的问题/挑战是，**你能想出一个算法来做到这一点吗？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T21:41:21.057

这是一个愚蠢的问题！在第一个示例中，您使用 16 项表而不是 256 来计算设置的位数，这并不神奇！您所做的只是计算字节的前四位（第一个半字节）中设置的位数，然后计算第二个半字节中设置的位数，将两者相加。x/16 是第一个半字节，x%16 是第二个半字节。

如果你重复这个过程，现在你有一个两位的查找表，你只需做四次，每对一次。在极端情况下，您只需将所有位一个接一个地添加在一起，您就会得到明显的答案。

查找表的重点是避免加法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-20T21:05:40.420

根据 Robert's code [here](https://stackoverflow.com/questions/697978/c-code-to-count-the-number-of-1-bits-in-an-unsigned-char/698108#698108)，它甚至可以在没有除法或模数的情况下完成，用一个移位和一个 AND 替换它们，如下所示：

```
a = [0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4]
x = 243 >> 4 # 15 (same as dividing by 16)
y = 243 & 0x0f # 3 ( same as modding by 16)

result = a[x] + a[y] # 6 bits set 
```

或在 C 中：

```
const unsigned char oneBits[] = {0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4};

unsigned char CountOnes(unsigned char x)
{
    unsigned char results;
    results = oneBits[x&0x0f];
    results += oneBits[x>>4];
    return results
} 
```

对于任何大小的整数，您都可以遍历字节并进行快速查找，如下所示：

```
def bits(n)
    a = [0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4]
    a[n >> 4] + a[n & 0x0f]
end

def setBits(n)
   total = 0
   while(n > 0)
       total += bits(n&0xff)
       n >>= 8
   end
   total
end

setBits(6432132132165432132132165436265465465653213213265465) # 78 bits set 
```

我对这个答案很满意。我知道更复杂和四叉树式的东西不会有效率，我只是认为这是一个体面的思想实验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-19T23:56:30.787

请原谅迟到的帖子，但我刚刚发现了挑战。我的 $.02（蛮力）

```
Private Sub Button1_Click(ByVal sender As System.Object, _
                          ByVal e As System.EventArgs) Handles Button1.Click

    For x As Integer = 0 To 255
        Debug.WriteLine(bitsOn2(CByte(x)) & " " & Convert.ToString(x, 2).PadLeft(8, "0"c))
    Next

End Sub

Private Function bitsOn(ByVal aByte As Byte) As Integer
    Dim aBit As Byte = 1
    For z As Integer = 0 To 7
        If (aByte >> z And aBit) = aBit Then bitsOn += 1
    Next
End Function

Dim aDict As New Dictionary(Of Integer, Integer)
Private Function bitsOn2(ByVal aByte As Byte) As Integer
    If aDict.Count = 0 Then 'init dictionary
        For x As Integer = 0 To 255
            aDict.Add(x, bitsOn(CByte(x)))
        Next
    End If
    Return aDict(aByte)
End Function 
```*******