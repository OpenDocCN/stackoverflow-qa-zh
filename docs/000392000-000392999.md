# StackOverflow 问答 000392000-000392999

# sql - SQL 字符串格式化程序

> ID：392001
> 
> 赞同：52
> 
> 时间：2008-12-24T18:35:11.987
> 
> 标签：sql, linux, formatting, code-formatting

有谁知道一个程序、实用程序或一些程序库，最好是用于 Linux，它采用未格式化的 SQL 字符串并漂亮地打印出来？

例如我想要以下

```
select * from users where name = 'Paul' 
```

改成这样

```
select * 
from users
where
   name = 'Paul' 
```

确切的格式并不重要。我只需要一些东西来获取一个大的 SQL 字符串并将其分解成更易读的东西。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2014-11-20T23:40:22.983

# 尝试 sqlparse 模块的 sqlformat

查看[sqlparse](https://github.com/andialbrecht/sqlparse)。它是一个安装命令的 Python 模块`sqlformat`。用法很简单，例如：

```
sqlformat --reindent --keywords upper --identifiers lower my_file.sql 
```

我尝试了上述 CLI 替代方案，但是：

*   `sqlinform`出来了，因为我想要一个开源 CLI 应用程序。
*   `fsqlf`只有很少的功能（`create view`例如缺少）。

感谢`sqlformat`我什至了解到“REF”是[SQL:2011 和 SQL:2008 中的保留关键字](http://www.postgresql.org/docs/9.3/static/sql-keywords-appendix.html)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-08-19T20:49:56.807

# 试试 fsqlf

**fsqlf** ( [http://sourceforge.net/projects/fsqlf/](http://sourceforge.net/projects/fsqlf/) ) 是一个命令行或 GUI 程序，开源，用于格式化 SQL。它支持有一个formatting.conf 文件，它可以让您在最终产品的外观方面有很大的灵活性。

示例 1：

```
☺  [wwalker@speedy:~] 
$ echo "select f1, f2, fname, lName from tblName where f1 = true and fname is not null order by lName asc" | fsqlf 

SELECT
  f1
, f2
, fname
, lName
FROM tblName
WHERE f1=true
AND fname is not null
ORDER BY lName asc 
```

示例 2：

```
☺  [wwalker@speedy:~] 
$ vim formatting.conf # 2 character change

☺  [wwalker@speedy:~] 
$ echo "select f1, f2, fname, lName from tblName where f1 = true and fname is not null order by lName asc" | fsqlf 

SELECT
 f1 ,
 f2 ,
 fname ,
 lName
FROM tblName
WHERE f1=true
AND fname is not null
ORDER BY lName asc 
```

示例 3：

```
☺  [wwalker@speedy:~] 
$ vim formatting.conf # 1 character change

☺  [wwalker@speedy:~] 
$ echo "select f1, f2, fname, lName from tblName where f1 = true and fname is not null order by lName asc" | fsqlf 

SELECT
 f1 , f2 , fname , lName
FROM tblName
WHERE f1=true
AND fname is not null
ORDER BY lName asc 
```

# oracle - 通过 ODBC 访问 - Oracle DEFAULT 不起作用

> ID：392011
> 
> 赞同：1
> 
> 时间：2008-12-24T18:41:09.480
> 
> 标签：oracle, ms-access, odbc, default, constraints

我们通过 ODBC 使用 MS Access 作为 Oracle 表的前端，它运行良好。但是我们正在尝试在 Oracle 表中使用 DEFAULT 约束。当我们在 Access 中打开链接表时，我们可以看到现有数据，但是当我们尝试添加一行时，没有在具有 Oracle DEFAULT 的列中键入任何值（期望使用默认值），我们会看到 #在每一列中删除，并且该行不会添加到表中。有任何想法吗？如果有帮助，我可以提供更多详细信息，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T19:09:55.457

如果您使用网格视图作为数据输入来执行此操作，我认为 Access 可能会显式尝试插入一个空字符串作为该值。尝试为插入编写普通的 SQL 语句，看看会发生什么。

我希望像这样的底层 SQL（假设为 name="John", balance="0.0" 设置默认值）......

通过网格视图：

```
insert into customers (cust_id, name, balance) values (1, "Bob", 50.25); 
```

如果一个是空的：

```
insert into customers (cust_id, name, balance) values (2, "", 0); 
```

但是，通过 SQL：

```
insert into customers (cust_id, name) values (3, "Pete");
insert into customers (cust_id) values (4); 
```

我假设 SQL 示例使用未设置列的默认值，但网格视图从 UI 提供空白值，这将阻止使用默认值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T04:08:57.677

不知道关于 Oracle，但要使其与 SQL Server 一起使用，您需要在表中添加一个时间戳字段。

# perl - 在 Perl 中进行跨平台、原子文件替换的最佳方法是什么？

> ID：392016
> 
> 赞同：8
> 
> 时间：2008-12-24T18:44:19.707
> 
> 标签：perl, file, filesystems, rename, atomic

我有一个很常见的情况。我有一个文件，我需要用新内容完全覆盖该文件。但是，每次页面加载时都会访问原始文件（这是一个 Web 应用程序），因此它不会丢失很长时间。几毫秒是可以的（虽然不理想），一秒钟是不行的。

现在我通过将临时文件写入同一目录然后将该临时文件重命名为新文件的名称来做到这一点。我只是在 Perl 中使用普通的 File::Temp 和“重命名”来执行此操作。我想知道——还有其他推荐/更好的方法吗？最好是不需要 CPAN 模块的模块，因为这是我系统中唯一需要执行此操作的地方，而且我不想要一个全新的依赖项。

哦，所有这些都必须在 Windows、Linux、BSD、OS X、Solaris 和大多数其他常见平台上运行。

[这是有问题的代码](http://mxr.mozilla.org/mozilla/source/webtools/bugzilla/Bugzilla/Config.pm#272)，对于那些感兴趣的人。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-24T18:53:25.680

你的方法似乎很好。它很快，它是原子的，它只使用核心模块，并且 File::Temp 是一种处理临时文件的安全方法。你还需要什么？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-24T18:54:38.843

我会按照你的方式来做。至少在 Unix 类型的操作系统上，文件重命名保证是原子的，因此您不会有任何瞬间原始文件或新文件不存在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T19:07:33.310

重命名就足够了。然而：

您的临时文件是否面临竞争条件的风险？文件名应该是随机的，所以没有人可以通过插入自己的文件来引起问题。如果可能，请使用 mkstemp() 的接口。

# linux - 向进程组的所有成员发送信号的最佳方式是什么？

> ID：392022
> 
> 赞同：445
> 
> 时间：2008-12-24T18:48:00.073
> 
> 标签：linux, shell, process, signals

我想杀死整个进程树。使用任何常见的脚本语言来做到这一点的最佳方法是什么？我正在寻找一个简单的解决方案。

* * *

## 回答 #1

> 赞同：320
> 
> 时间：2008-12-24T20:06:02.990

您没有说要杀死的树是否是单个进程组。（如果树是从服务器启动或 shell 命令行分叉的结果，通常会出现这种情况。）您可以使用 GNU ps 发现进程组，如下所示：

```
 ps x -o  "%p %r %y %x %c " 
```

如果它是您要杀死的进程组，只需使用`kill(1)`命令，但不要给它一个进程号，而是给它组号的*否定*。例如要杀死组 5112 中的每个进程，请使用`kill -TERM -- -5112`.

* * *

## 回答 #2

> 赞同：219
> 
> 时间：2013-02-28T15:46:32.620

使用***进程组 ID*** ( )杀死属于同一*进程树的所有进程**`PGID`*

 **   **`kill -- -$PGID`**     使用默认信号 ( `TERM`= 15)
*   **`kill -9 -$PGID`**     使用信号`KILL`(9)

您可以从同一*进程树*`PGID`的任何*Process-ID* ( ) 中检索`PID`

 **   **`kill -- -$(ps -o pgid= $PID | grep -o '[0-9]*')`**   （信号`TERM`）
*   **`kill -9 -$(ps -o pgid= $PID | grep -o '[0-9]*')`**   （信号`KILL`）

^(特别感谢[tanager](https://stackoverflow.com/users/1022309)和[Speakus](https://stackoverflow.com/users/751932)对`$PID`剩余空间和 OSX 兼容性的贡献。)

## 解释

*   **`kill -9 -"$PGID"`**=>`KILL`向所有子孙发送信号 9 ( )...
*   **`PGID=$(ps opgid= "$PID")`**=>从树的任何*Process-ID中检索**Process-Group-ID*，而不仅仅是*Process-Parent-ID*。的变体是where可以替换为。但： ****`ps opgid= $PID`****`ps -o pgid --no-headers $PID`****`pgid`****`pgrp`**

    *   **`ps`**[当tanager](https://stackoverflow.com/users/1022309)`PID`注意到少于五位并右对齐时插入前导空格。您可以使用：
        **`PGID=$(ps opgid= "$PID" | tr -d ' ')`**
    *   **`ps`**来自 OSX 的总是打印标题，因此[Speakus](https://stackoverflow.com/users/751932)建议：
        **`PGID="$( ps -o pgid "$PID" | grep [0-9] | tr -d ' ' )"`**** 
***   **`grep -o [0-9]*`**仅打印连续数字（不打印空格或字母标题）。**

 **## 更多命令行

```
PGID=$(ps -o pgid= $PID | grep -o [0-9]*)
kill -TERM -"$PGID"  # kill -15
kill -INT  -"$PGID"  # correspond to [CRTL+C] from keyboard
kill -QUIT -"$PGID"  # correspond to [CRTL+\] from keyboard
kill -CONT -"$PGID"  # restart a stopped process (above signals do not kill it)
sleep 2              # wait terminate process (more time if required)
kill -KILL -"$PGID"  # kill -9 if it does not intercept signals (or buggy) 
```

## 局限性

*   正如[davide](https://stackoverflow.com/users/1012773)和[Hubert Kario](https://stackoverflow.com/users/462370)所注意到的，当**`kill`**被属于同一棵树的进程调用时，有**`kill`**可能在终止整个树的杀戮之前杀死自己。
*   因此，请务必使用具有不同*Process-Group-ID*的进程运行命令。

* * *

## 很长的故事

```
> cat run-many-processes.sh
#!/bin/sh
echo "ProcessID=$$ begins ($0)"
./child.sh background &
./child.sh foreground
echo "ProcessID=$$ ends ($0)"

> cat child.sh
#!/bin/sh
echo "ProcessID=$$ begins ($0)"
./grandchild.sh background &
./grandchild.sh foreground
echo "ProcessID=$$ ends ($0)"

> cat grandchild.sh
#!/bin/sh
echo "ProcessID=$$ begins ($0)"
sleep 9999
echo "ProcessID=$$ ends ($0)" 
```

使用“&”在后台运行进程树

```
> ./run-many-processes.sh &    
ProcessID=28957 begins (./run-many-processes.sh)
ProcessID=28959 begins (./child.sh)
ProcessID=28958 begins (./child.sh)
ProcessID=28960 begins (./grandchild.sh)
ProcessID=28961 begins (./grandchild.sh)
ProcessID=28962 begins (./grandchild.sh)
ProcessID=28963 begins (./grandchild.sh)

> PID=$!                    # get the Parent Process ID
> PGID=$(ps opgid= "$PID")  # get the Process Group ID

> ps fj
 PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND
28348 28349 28349 28349 pts/3    28969 Ss   33021   0:00 -bash
28349 28957 28957 28349 pts/3    28969 S    33021   0:00  \_ /bin/sh ./run-many-processes.sh
28957 28958 28957 28349 pts/3    28969 S    33021   0:00  |   \_ /bin/sh ./child.sh background
28958 28961 28957 28349 pts/3    28969 S    33021   0:00  |   |   \_ /bin/sh ./grandchild.sh background
28961 28965 28957 28349 pts/3    28969 S    33021   0:00  |   |   |   \_ sleep 9999
28958 28963 28957 28349 pts/3    28969 S    33021   0:00  |   |   \_ /bin/sh ./grandchild.sh foreground
28963 28967 28957 28349 pts/3    28969 S    33021   0:00  |   |       \_ sleep 9999
28957 28959 28957 28349 pts/3    28969 S    33021   0:00  |   \_ /bin/sh ./child.sh foreground
28959 28960 28957 28349 pts/3    28969 S    33021   0:00  |       \_ /bin/sh ./grandchild.sh background
28960 28964 28957 28349 pts/3    28969 S    33021   0:00  |       |   \_ sleep 9999
28959 28962 28957 28349 pts/3    28969 S    33021   0:00  |       \_ /bin/sh ./grandchild.sh foreground
28962 28966 28957 28349 pts/3    28969 S    33021   0:00  |           \_ sleep 9999
28349 28969 28969 28349 pts/3    28969 R+   33021   0:00  \_ ps fj 
```

该命令`pkill -P $PID`不会杀死孙子：

```
> pkill -P "$PID"
./run-many-processes.sh: line 4: 28958 Terminated              ./child.sh background
./run-many-processes.sh: line 4: 28959 Terminated              ./child.sh foreground
ProcessID=28957 ends (./run-many-processes.sh)
[1]+  Done                    ./run-many-processes.sh

> ps fj
 PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND
28348 28349 28349 28349 pts/3    28987 Ss   33021   0:00 -bash
28349 28987 28987 28349 pts/3    28987 R+   33021   0:00  \_ ps fj
    1 28963 28957 28349 pts/3    28987 S    33021   0:00 /bin/sh ./grandchild.sh foreground
28963 28967 28957 28349 pts/3    28987 S    33021   0:00  \_ sleep 9999
    1 28962 28957 28349 pts/3    28987 S    33021   0:00 /bin/sh ./grandchild.sh foreground
28962 28966 28957 28349 pts/3    28987 S    33021   0:00  \_ sleep 9999
    1 28961 28957 28349 pts/3    28987 S    33021   0:00 /bin/sh ./grandchild.sh background
28961 28965 28957 28349 pts/3    28987 S    33021   0:00  \_ sleep 9999
    1 28960 28957 28349 pts/3    28987 S    33021   0:00 /bin/sh ./grandchild.sh background
28960 28964 28957 28349 pts/3    28987 S    33021   0:00  \_ sleep 9999 
```

该命令`kill -- -$PGID`会杀死包括孙子进程在内的所有进程。

```
> kill --    -"$PGID"  # default signal is TERM (kill -15)
> kill -CONT -"$PGID"  # awake stopped processes
> kill -KILL -"$PGID"  # kill -9 to be sure

> ps fj
 PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND
28348 28349 28349 28349 pts/3    29039 Ss   33021   0:00 -bash
28349 29039 29039 28349 pts/3    29039 R+   33021   0:00  \_ ps fj 
```

## 结论

我在这个例子中注意到`PID`并且`PGID`是相等的 ( `28957`)。
这就是为什么我最初认为`kill -- -$PID`就足够了。但是如果进程是在 Process ID 与 Group ID 不同的`Makefile`情况*下**产生*的。

我认为当从不同的*组 ID*（另一个进程树）**`kill -- -$(ps -o pgid= $PID | grep -o [0-9]*)`**调用时，杀死整个进程树是最好的简单技巧。

 ** * *

## 回答 #3

> 赞同：170
> 
> 时间：2011-06-26T00:16:08.267

```
pkill -TERM -P 27888 
```

这将杀死所有父进程 ID 为 27888 的进程。

或者更健壮：

```
CPIDS=$(pgrep -P 27888); (sleep 33 && kill -KILL $CPIDS &); kill -TERM $CPIDS 
```

哪个计划在 33 秒后杀死并礼貌地要求进程终止。

请参阅[此答案](https://stackoverflow.com/a/33556110/815781)以终止所有后代。

* * *

## 回答 #4

> 赞同：105
> 
> 时间：2010-07-09T08:57:02.157

要递归地终止进程树，请使用 killtree()：

```
#!/bin/bash

killtree() {
    local _pid=$1
    local _sig=${2:--TERM}
    kill -stop ${_pid} # needed to stop quickly forking parent from producing children between child killing and parent killing
    for _child in $(ps -o pid --no-headers --ppid ${_pid}); do
        killtree ${_child} ${_sig}
    done
    kill -${_sig} ${_pid}
}

if [ $# -eq 0 -o $# -gt 2 ]; then
    echo "Usage: $(basename $0) <pid> [signal]"
    exit 1
fi

killtree $@ 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2015-11-05T22:37:22.797

*[来自pslist包的](https://packages.debian.org/unstable/pslist)**[rkill](http://manpages.debian.org/cgi-bin/man.cgi?query=rkill&apropos=0&sektion=0&manpath=Debian+8+jessie&format=html&locale=en)*命令将给定的信号（或`SIGTERM`默认情况下）发送到指定的进程及其所有后代：

```
rkill [-SIG] pid/name... 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2011-12-17T12:59:46.470

我使用了这里描述的方法的一点修改版本： [https ://stackoverflow.com/a/5311362/563175](https://stackoverflow.com/a/5311362/563175)

所以它看起来像这样：

```
kill `pstree -p 24901 | sed 's/(/\n(/g' | grep '(' | sed 's/(\(.*\)).*/\1/' | tr "\n" " "` 
```

其中 24901 是父母的 PID。

它看起来很丑，但它的工作很完美。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-12-24T20:00:54.607

布拉德的回答也是我推荐的，除了`awk`如果你使用.`--ppid``ps`

```
for child in $(ps -o pid -ax --ppid $PPID) do ....... done 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-11-20T20:31:17.840

zhigang回答的修改版：

```
#!/usr/bin/env bash
set -eu

killtree() {
    local pid
    for pid; do
        kill -stop $pid
        local cpid
        for cpid in $(pgrep -P $pid); do
            killtree $cpid
        done
        kill $pid
        kill -cont $pid
        wait $pid 2>/dev/null || true
   done
}

cpids() {
    local pid=$1 options=${2:-} space=${3:-}
    local cpid
    for cpid in $(pgrep -P $pid); do
        echo "$space$cpid"
        if [[ "${options/a/}" != "$options" ]]; then
            cpids $cpid "$options" "$space  "
        fi
    done
}

while true; do sleep 1; done &
cpid=$!
for i in $(seq 1 2); do
    cpids $$ a
    sleep 1
done
killtree $cpid
echo ---
cpids $$ a 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2013-09-25T21:28:51.480

我无法发表评论（没有足够的声誉），所以我不得不添加一个新的*答案*，即使这不是一个真正的答案。

@olibre 在 2 月 28 日给出的其他非常好的和彻底的答案存在一个小问题。 的输出`ps opgid= $PID`将包含小于五位数字的 PID 的前导空格，因为`ps`正在证明列的正确性（右对齐数字）。在整个命令行中，这会产生一个负号，后跟空格，然后是组 PID。简单的解决方案是通过管道`ps`删除`tr`空格：

```
kill -- -$( ps opgid= $PID | tr -d ' ' ) 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-12-24T19:34:32.617

如果您知道传递父进程的 pid，那么这里有一个应该可以工作的 shell 脚本：

```
for child in $(ps -o pid,ppid -ax | \
   awk "{ if ( \$2 == $pid ) { print \$1 }}")
do
  echo "Killing child process $child because ppid = $pid"
  kill $child
done 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2011-06-28T16:31:13.713

要添加到 Norman Ramsey 的答案，如果您想创建一个进程组，可能值得看一下 setid 。
[http://pubs.opengroup.org/onlinepubs/009695399/functions/setsid.html](http://pubs.opengroup.org/onlinepubs/009695399/functions/setsid.html)

> 如果调用进程不是进程组领导，则 setsid() 函数将创建一个新会话。返回时，调用进程将是这个新会话的会话负责人，应是新进程组的进程组负责人，并且不应有控制终端。调用进程的进程组 ID 应设置为等于调用进程的进程 ID。调用进程应是新进程组中的唯一进程，也是新会话中的唯一进程。

我的意思是你可以从开始的过程中创建一个组。我在 php 中使用了它，以便在启动它后能够杀死整个进程树。

这可能是个坏主意。我会对评论感兴趣。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-12-31T02:44:34.420

灵感来自[**ysth 的评论**](https://stackoverflow.com/questions/392022/best-way-to-kill-all-child-processes#comment219361_392155)

```
kill -- -PGID 
```

> 与其给它一个进程号，不如给它组号的否定。与几乎所有命令一样，如果您希望以 a 开头的普通参数`-`不被解释为开关，请在其前面加上`--`

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-08-19T12:54:28.513

[使用 python 使用psutil](https://code.google.com/p/psutil/)非常容易做到这一点。只需使用 pip 安装 psutil，然后您就拥有一整套流程操作工具：

```
def killChildren(pid):
    parent = psutil.Process(pid)
    for child in parent.get_children(True):
        if child.is_running():
            child.terminate() 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2013-10-30T11:49:16.590

根据志刚的回答，这样可以避免自残：

```
init_killtree() {
    local pid=$1 child

    for child in $(pgrep -P $pid); do
        init_killtree $child
    done
    [ $pid -ne $$ ] && kill -kill $pid
} 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2013-08-13T16:43:13.993

以下 shell 函数类似于许多其他答案，但它适用于 Linux 和 BSD（OS X 等），没有外部依赖项，例如`pgrep`：

```
killtree() {
    local parent=$1 child
    for child in $(ps -o ppid= -o pid= | awk "\$1==$parent {print \$2}"); do
        killtree $child
    done
    kill $parent
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-10-03T09:49:29.150

如果要按名称杀死进程：

```
killall -9 -g someprocessname 
```

或者

```
pgrep someprocessname | xargs pkill -9 -g 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2011-11-14T15:28:18.290

这是我使用 bash 脚本杀死所有子进程的版本。它不使用递归并且依赖于 pgrep 命令。

采用

```
killtree.sh PID SIGNAL 
```

killtrees.sh 的内容

```
#!/bin/bash
PID=$1
if [ -z $PID ];
then
    echo "No pid specified"
fi

PPLIST=$PID
CHILD_LIST=`pgrep -P $PPLIST -d,`

while [ ! -z "$CHILD_LIST" ]
do
    PPLIST="$PPLIST,$CHILD_LIST"
    CHILD_LIST=`pgrep -P $CHILD_LIST -d,`
done

SIGNAL=$2

if [ -z $SIGNAL ]
then
    SIGNAL="TERM"
fi
#do substring from comma to space
kill -$SIGNAL ${PPLIST//,/ } 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2014-02-27T07:06:35.427

这是@zhigang 的答案的变体，它没有 AWK，仅依赖 Bash 的本机解析可能性：

```
function killtree {
  kill -STOP "$1"
  ps -e -o pid= -o ppid= | while read -r pid ppid
                           do
                             [[ $ppid = $1 ]] || continue
                             killtree "$pid"  || true # Skip over failures
                           done
  kill -CONT "$1"          
  kill -TERM "$1"
} 
```

它似乎在 Mac 和 Linux 上都能正常工作。在您不能依赖管理流程组的情况下——例如在编写脚本来测试必须在多个环境中构建的软件时——这种树遍历技术绝对有用。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-09T20:45:30.790

谢谢你的智慧，伙计们。我的脚本在退出时留下了一些子进程，*否定*提示使事情变得更容易。如有必要，我编写了此函数以在其他脚本中使用：

```
# kill my group's subprocesses:          killGroup
# kill also myself:                      killGroup -x
# kill another group's subprocesses:     killGroup N  
# kill that group all:                   killGroup -x N
# N: PID of the main process (= process group ID).

function killGroup () {
    local prid mainpid
    case $1 in
        -x) [ -n "$2" ] && kill -9 -$2 || kill -9 -$$ ;;
        "") mainpid=$$ ;;
         *) mainpid=$1 ;;
    esac
    prid=$(ps ax -o pid,pgid | grep $mainpid)
    prid=${prid//$mainpid/}
    kill -9 $prid 2>/dev/null
    return
} 
```

干杯。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-07-27T05:10:21.133

如果你的系统上有 pstree 和 perl，你可以试试这个：

```
perl -e 'kill 9, (`pstree -p PID` =~ m/\((\d+)\)/sg)' 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-02-04T22:32:12.710

在孩子之前杀死父母可能会更好；否则父母可能会在他自己被杀之前再次产生新的孩子。这些将在杀戮中幸存下来。

我的 ps 版本与上面的不同；也许太老了，因此奇怪的grepping...

使用 shell 脚本而不是 shell 函数有很多优点......

不过，基本上是志刚的想法

* * *

```
#!/bin/bash
if test $# -lt 1 ; then
    echo >&2 "usage: kiltree pid (sig)"
fi ;

_pid=$1
_sig=${2:-TERM}
_children=$(ps j | grep "^[ ]*${_pid} " | cut -c 7-11) ;
echo >&2 kill -${_sig} ${_pid}
kill -${_sig} ${_pid}
for _child in ${_children}; do
    killtree ${_child} ${_sig}
done 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-09-14T13:48:50.763

以下已在 FreeBSD、Linux 和 MacOS X 上测试过，仅依赖于 pgrep 和 kill（ps -o 版本在 BSD 下不起作用）。第一个参数是必须终止其子代的父 pid。第二个参数是一个布尔值，用于确定父 pid 是否也必须终止。

```
KillChilds() {
        local pid="${1}"
        local self="${2:-false}"

        if children="$(pgrep -P "$pid")"; then
                for child in $children; do
                        KillChilds "$child" true
                done
        fi

        if [ "$self" == true ]; then
                kill -s SIGTERM "$pid" || (sleep 10 && kill -9 "$pid" &)
        fi
}

KillChilds $$ > /dev/null 2>&1 
```

这会将 SIGTERM 发送到 shell 脚本中的任何子/孙进程，如果 SIGTERM 不成功，它将等待 10 秒然后发送 kill。

* * *

之前的回答：

以下方法也有效，但会在 BSD 上杀死 shell 本身。

```
KillSubTree() {
    local parent="${1}"
    for child in $(ps -o pid=$parent); do
            if [ $$ -ne $child ]; then (kill -s SIGTERM $child || (sleep 10 && kill -9 $child & )) > /dev/null 2>&1 ; fi
    done
}
# Example lanch from within script
KillSubTree $$ > /dev/null 2>&1 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-02-09T15:11:25.930

我进一步开发了zhigang、xyuri和solidsneck的解决方案：

```
 #!/bin/bash

if test $# -lt 1 ; then
    echo >&2 "usage: kiltree pid (sig)"
    exit 1 ;
  fi ;

_pid=$1
_sig=${2:-TERM}

# echo >&2 "killtree($_pid) mypid = $$"
# ps axwwf | grep -6 "^[ ]*$_pid " >&2 ;

function _killtree () {
    local _children
    local _child
    local _success

    if test $1 -eq $2 ; then # this is killtree - don't commit suicide!
        echo >&2 "killtree can´t kill it´s own branch - some processes will survive." ; 
        return 1 ;
      fi ;
    # this avoids that children are spawned or disappear.
    kill -SIGSTOP $2 ;

    _children=$(ps -o pid --no-headers --ppid $2) ;        
    _success=0 
    for _child in ${_children}; do
        _killtree $1 ${_child} $3 ;
        _success=$(($_success+$?)) ;
      done ;

    if test $_success -eq 0 ; then
        kill -$3 $2
      fi ;
    # when a stopped process is killed, it will linger in the system until it is continued
    kill -SIGCONT $2
    test $_success -eq 0 ;
    return $?
    }

_killtree $$ $_pid $_sig 
```

这个版本将避免杀死它的祖先——这会在以前的解决方案中导致大量的子进程。

在确定子列表之前正确停止进程，这样就不会创建或消失新的子进程。

被杀死后，停止的作业必须继续从系统中消失。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-11-08T14:44:46.163

老问题，我知道，但所有的回复似乎都在叫 ps，我不喜欢。

这种基于 awk 的解决方案不需要递归，只调用 ps 一次。

```
awk 'BEGIN {
  p=1390
  while ("ps -o ppid,pid"|getline) a[$1]=a[$1]" "$2
  o=1
  while (o==1) {
    o=0
    split(p, q, " ")
    for (i in q) if (a[q[i]]!="") {
      p=p""a[q[i]]
      o=1
      a[q[i]]=""
    }
  }
  system("kill -TERM "p)
}' 
```

或单行：

```
awk 'BEGIN {p=1390;while ("ps -o ppid,pid"|getline) a[$1]=a[$1]" "$2;o=1;while (o==1) {o=0;split(p, q, " ");for (i in q) {if (a[q[i]]!="") {p=p""a[q[i]];o=1;a[q[i]]=""}}}system("kill -TERM "p)}' 
```

基本上我们的想法是我们建立一个 parent:child 条目的数组 (a)，然后在数组中循环查找匹配的父母的孩子，然后将它们添加到我们的父母列表 (p) 中。

如果你不想杀死顶级进程，那么做

```
sub(/[0-9]*/, "", p) 
```

就在 system() 行将其从杀伤集中删除之前。

请记住，这里存在竞争条件，但所有解决方案都是如此（据我所知）。它可以满足我的需要，因为我需要它的脚本不会产生很多短命的孩子。

给读者的一个练习是让它成为一个 2-pass 循环：在第一次通过后，向 p 列表中的所有进程发送 SIGSTOP，然后循环以再次运行 ps，在第二次通过后发送 SIGTERM，然后发送 SIGCONT。如果你不关心美好的结局，那么我想第二遍可能只是 SIGKILL。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-03-02T11:49:05.743

```
ps -o pid= --ppid $PPID | xargs kill -9 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-03-28T21:39:49.767

如果您知道要杀死的东西的 pid，通常可以从会话 id 以及同一会话中的所有内容中获取。我会仔细检查，但我将它用于在我想死的循环中启动 rsync 的脚本，而不是像我只是 killall'd rsync 那样启动另一个（因为循环）。

```
kill $(ps -o pid= -s $(ps -o sess --no-heading --pid 21709)) 
```

如果你不知道 pid 你仍然可以嵌套更多

```
kill $(ps -o pid= -s $(ps -o sess --no-heading --pid $(pgrep rsync ))) 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-12-21T21:01:00.130

在 sh 中，jobs 命令将列出后台进程。在某些情况下，最好先杀死最新的进程，例如旧的进程创建了一个共享套接字。在这些情况下，以相反的顺序对 PID 进行排序。有时您想等待作业在它们停止之前在磁盘上写一些东西或类似的东西。

如果没有必要，不要杀人！

```
for SIGNAL in TERM KILL; do
  for CHILD in $(jobs -s|sort -r); do
    kill -s $SIGNAL $CHILD
    sleep $MOMENT
  done
done 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-09-04T08:38:02.627

在 shell 脚本中杀死子进程：

很多时候我们需要杀死由于某种原因被挂起或阻塞的子进程。例如。FTP 连接问题。

有两种方法，

1) 为每个子进程创建单独的新父进程，一旦超时，它将监视并终止子进程。

如下创建 test.sh，

```
#!/bin/bash

declare -a CMDs=("AAA" "BBB" "CCC" "DDD")
for CMD in ${CMDs[*]}; do
    (sleep 10 & PID=$!; echo "Started $CMD => $PID"; sleep 5; echo "Killing $CMD => $PID"; kill $PID; echo "$CMD Completed.") &
done
exit; 
```

并使用以下命令在其他终端中查看名称为“test”的进程。

```
watch -n1 'ps x -o "%p %r %c" | grep "test" ' 
```

上面的脚本将创建 4 个新的子进程及其父进程。每个子进程将运行 10 秒。但是一旦达到 5 秒的超时时间，它们各自的父进程就会杀死这些子进程。所以孩子将无法完成执行（10秒）。玩转这些时间（开关 10 和 5）以查看另一种行为。在这种情况下，孩子将在 10 秒超时之前在 5 秒内完成执行。

2）一旦超时，让当前父进程监控并杀死子进程。这不会创建单独的父级来监视每个子级。您还可以在同一父级中正确管理所有子进程。

如下创建 test.sh，

```
#!/bin/bash

declare -A CPIDs;
declare -a CMDs=("AAA" "BBB" "CCC" "DDD")

CMD_TIME=15;
for CMD in ${CMDs[*]}; do
    (echo "Started..$CMD"; sleep $CMD_TIME; echo "$CMD Done";) &
    CPIDs[$!]="$RN";
    sleep 1;
done

GPID=$(ps -o pgid= $$);
CNT_TIME_OUT=10;
CNT=0;
while (true); do
    declare -A TMP_CPIDs;

    for PID in "${!CPIDs[@]}"; do
        echo "Checking "${CPIDs[$PID]}"=>"$PID;

        if ps -p $PID > /dev/null ; then
          echo "-->"${CPIDs[$PID]}"=>"$PID" is running..";
          TMP_CPIDs[$PID]=${CPIDs[$PID]};
        else
          echo "-->"${CPIDs[$PID]}"=>"$PID" is completed.";
        fi
    done

    if [ ${#TMP_CPIDs[@]} == 0 ]; then
        echo "All commands completed.";
        break;
    else
        unset CPIDs;
        declare -A CPIDs;
        for PID in "${!TMP_CPIDs[@]}"; do
            CPIDs[$PID]=${TMP_CPIDs[$PID]};
        done
        unset TMP_CPIDs;

        if [ $CNT -gt $CNT_TIME_OUT ]; then
            echo ${CPIDs[@]}"PIDs not reponding. Timeout reached $CNT sec. killing all childern with GPID $GPID..";
            kill -- -$GPID;
        fi
    fi

    CNT=$((CNT+1));
    echo "waiting since $b secs..";
    sleep 1;
done

exit; 
```

并使用以下命令在其他终端中查看名称为“test”的进程。

```
watch -n1 'ps x -o "%p %r %c" | grep "test" ' 
```

上面的脚本将创建 4 个新的子进程。我们正在存储所有子进程的 pids 并循环它们以检查它们是否已完成执行或仍在运行。子进程将执行到 CMD_TIME 时间。但是如果 CNT_TIME_OUT 超时，所有子进程都会被父进程杀死。您可以切换时间并使用脚本来查看行为。这种方法的一个缺点是，它使用组 ID 来杀死所有子树。但是父进程本身属于同一个组，所以它也会被杀死。

如果您不希望父进程被杀死，您可能需要将其他组 ID 分配给父进程。

更多详情可在这找到，

[在shell脚本中杀死子进程](http://blog.hemantthorat.com/killing-child-process-in-shell-script/)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-10-05T11:05:50.093

该脚本也可以工作：

`#/bin/sh while true do echo "Enter parent process id [type quit for exit]" read ppid if [ $ppid -eq "quit" -o $ppid -eq "QUIT" ];then exit 0 fi for i in `ps -ef| awk '$3 == '$ppid' { print $2 }'` do echo killing $i kill $i done done`

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-12-01T12:37:29.343

我知道这很旧，但这是我找到的更好的解决方案：

```
killtree() { 
    for p in $(pstree -p $1 | grep -o "([[:digit:]]*)" |grep -o "[[:digit:]]*" | tac);do
        echo Terminating: $p 
        kill $p
    done
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-09-02T20:54:47.167

**仅使用属于组的进程名称杀死组：**

```
kill -- -$(ps -ae o pid,pgrp,cmd | grep "[e]xample.py" | awk '{print $2}' | tail -1) 
```

*这是对 olibre 答案的修改，但您不需要知道 PID，只需知道组成员的名称。*

### 解释：

要获取组 ID，您可以使用所示的参数执行 ps 命令，将其 grep 用于您的命令，但使用引号格式化 example.py 并使用括号作为第一个字母（这会过滤掉 grep 命令本身）然后过滤它awk 获取第二个字段，即组 ID。尾部 -1 去掉了重复的组 ID。您使用 $() 语法将所有这些放在一个变量中，瞧——您将获得组 ID。因此，您将 $(mess) 替换为上面的 -groupid。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2020-03-08T20:18:51.347

## 现在进行一些巧妙的 shell 编程。

这种解决方案是有代价的，但至少它是基于日常迭代和递归的。通过仔细注意`typeset`命令并将它们转换为`declare`或`local`在适当的情况下，可以将其转换为 bash。

## 讨论

在杀死一个进程时，必须处理这样一个事实：它可能是许多孩子的父母，并且每个孩子都可能是更多孩子的父母，等等。

**该怎么办？**

如果只有一个函数可以测试一个进程是否有子进程，另一个函数可以返回父进程的子 PID。

然后，游戏会简单得多，因为您可以创建一个循环来迭代一个 PID 列表，在杀死它之前检查每个 PID。如果没有子进程，就终止进程。如果有孩子，则递归调用驱动函数并将获取父母孩子的 PID 的函数的结果传递给它。

**基本情况操作（进程*没有*子进程）。**

```
#!/bin/ksh

function killProcess ()
{
    typeset -r PID=$1

    if [[ ! isProcess $PID ]]
    then
        echo -e "Process $PID cannot be terminated because it does not exist.\n" 1>&2
        return 1
    elif [[ kill -s TERM $PID ]] && [[ ! isProcess $PID ]]
    then
        echo -e "Process $PID was terminated.\n" 1>&2
        return 0
    elif kill -s KILL $PID
        echo -e "Process $PID killed with SIGKILL (9) signal. No time to clean up potential files.\n" 1>&2
        return 0
    elif isZombie $PID
    then
        echo -e "Process $PID in the zombie status.\n" 1>&2 
        return 2
    else
        echo -e "Process $PID is alive. SIGTERM and SIGKILL had no effect. It is not a zombie.\n" 1>&2
    fi

    return 3
}

function attemptToKillPid ()
{
    typeset -r PID=$1

    if killProcess $PID
    then 
        return 0
    fi

    ppid=$(getParentPid $pid)
    echo -e "Process $pid of parent $ppid was not able to be killed.\n" 1>&2
    return 1
} 
```

**一般案例动作（进程有子进程）。**

```
function killPidFamily ()
{
    typeset -r PROCESSES=$*
    typeset -ir NUM_PROCESSES_TO_KILL=$(countLines $PROCESSES)
    typeset -i numKilledProcesses=0
    typeset ppid

    for pid in $PROCESSES
    do
        pid=$(trim $pid)

        if ! hasChildPids $pid
        then
            attemptToKillPid $pid && (( numKilledProcesses++ ))
        else
            killPidFamily $(getChildPids $pid) && attemptToKillPid $pid && (( numKilledProcesses++ ))
        fi
    done

    (( numKilledProcesses == NUM_PROCESSES_TO_KILL ))
    return $?
} 
```

## 支持功能库。

```
#!/bin/ksh

function trim ()
{
    echo -n "$1" | tr -d [:space:]
}

function countLines ()
{
    typeset -r $LIST=$*
    trim $(echo $LIST | wc -l | awk {'print $1'})
}

function getProcesses ()
{
    # NOTE: -o pgid below would be $4 in awk.

    ps -e -o comm,pid,ppid,pgid,user,ruid,euid,group,rgid,egid,etime,etimes,stat --no-headers
}

function getProcess ()
{
   typeset -r PID=$1
   ps -p $PID -o comm,pid,ppid,pgid,user,ruid,euid,group,rgid,egid,etime,etimes,stat --no-headers
}

function isProcess ()
{
    typeset -r PID=$1

    ps -p $PID -o pid --no-headers 1>&2
    return $?
}

function getProcessStatus ()
{
    typeset -r PID=$1
    trim $(ps -p $PID -o stat --no-headers)
}

function isZombie ()
{
    typeset -r PID=$1
    typeset processStatus

    processStatus=$(getProcessStatus $PID)

    [[ "$processStatus" == "Z" ]]
    return $?
}

function hasChildPids ()
{
    typeset -r PPID=$1
    echo $(getProcesses) | awk '{print $3}' | sort -n | uniq | grep "^${PPID}$"
    return $?
}

function getChildPids ()
{
    typeset -r PPID=$1
    echo $(getProcesses) | awk '{print $2, $3}' | sort -k 2 | awk "\$2 == $PPID {print \$1}" | sort -n
}

function getParentPid ()
{
    typeset -r PID=$1
    trim $(echo $(getProcess $PID) | awk '{print $3}')
} 
```

通过这种方式，您可以确定进程树正在***从分支中被破坏，向上移动到根***。这有助于避免产生僵尸和其他不良情况的可能性。

现在，您已经看到了*最昂贵*的方法（一次杀死一个进程），请研究如何更改此解决方案以使用 PGID（进程组 ID）。该`getProcesses ()`函数已经打印了 PGID ( `$4`in `awk`)，所以学习如何使用它，或者不要。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2022-02-08T15:20:43.437

一次杀死整个进程组，就像这样`^C`做：

```
PID="$(pgrep -f unique_command_line_part)"
if [[ -n "$PID" ]]
then
    PGID="$(ps --no-headers -p $PID -o pgid)"
    kill -SIGINT -- -${PGID// /}
fi 
```

[此答案](https://stackoverflow.com/questions/60424390/is-there-a-way-to-kill-uvicorn-cleanly/71036303#71036303)中解释了每一行

* * *

## 回答 #34

> 赞同：-3
> 
> 时间：2015-02-17T00:12:56.313

键入`ps -ef`检查进程ID。通过键入终止进程`kill -9 <pid>`

# sql - 当“截断表”需要 0 时间时，为什么“从表中删除”需要很长时间？

> ID：392024
> 
> 赞同：16
> 
> 时间：2008-12-24T18:48:02.757
> 
> 标签：sql, mysql, performance, truncate

（我已经在 MySql 中尝试过）

我相信它们在语义上是等价的。为什么不找出这个微不足道的案例并加快速度呢？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-24T18:50:08.913

truncate table 不能回滚，就像删除和重新创建表一样。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-24T18:52:29.690

...只是为了添加一些细节。

调用 DELETE 语句告诉数据库引擎生成所有已删除记录的事务日志。如果删除错误，您可以恢复您的记录。

调用 TRUNCATE 语句是一个笼统的“全有或全无”，它删除所有没有事务日志的记录来恢复。它肯定更快，但只有在您确定不需要任何要删除的记录时才应该这样做。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-24T18:53:50.747

Delete from table 一次删除一行中的每一行，并在事务日志中添加一条记录，以便可以回滚操作。删除所花费的时间也与表上的索引数量成正比，以及是否有任何外键约束（对于 innodb）。

截断有效地删除表并重新创建它，并且不能在事务中执行。因此，它需要更少的操作并快速执行。截断也不使用任何删除触发器。

可以在 MySql 文档中找到有关为什么在 MySql 中更快的确切详细信息：http: [//dev.mysql.com/doc/refman/5.0/en/truncate-table.html](http://dev.mysql.com/doc/refman/5.0/en/truncate-table.html)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-25T16:16:43.467

你的问题是关于 MySQL 的，我对 MySQL 作为一个产品知之甚少，但我想我会在 SQL Server 中添加一个 TRUNCATE 语句*可以*回滚。自己试试

```
create table test1 (col1 int)
go
insert test1 values(3)
begin tran
truncate table test1
select * from test1
rollback tran
select * from test1 
```

在记录 SQL Server TRUNCATE 时，它只是没有以记录 DELETE 的详细方式记录。我相信它被称为最低限度记录的操作。实际上，数据页仍然包含数据，但它们的范围已被标记为删除。只要数据页仍然存在，您就可以回滚截断。希望这会有所帮助。如果有人在 MySQL 上尝试它，我很想知道结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-25T11:05:27.277

对于使用 InnoDb 作为存储引擎的 MySql 5，TRUNCATE 的行为就像没有 WHERE 子句的 DELETE：即对于大型表，它需要很长时间，因为它会一个接一个地删除行。这在 6.x 版中有所改变。

看

[http://dev.mysql.com/doc/refman/5.1/en/truncate-table.html](http://dev.mysql.com/doc/refman/5.1/en/truncate-table.html)

对于 5.1 信息（使用 InnoDB 逐行）和

[http://blogs.mysql.com/peterg/category/personal-opinion/](http://blogs.mysql.com/peterg/category/personal-opinion/)

对于 6.x 中的更改

* * *

## 编者注

这个答案[显然与 MySQL 文档相矛盾](http://dev.mysql.com/doc/refman/5.0/en/truncate-table.html)：

“对于 5.0.3 版本之前的 InnoDB 表，InnoDB 通过逐一删除行来处理 TRUNCATE TABLE。从 MySQL 5.0.3 开始，仅当存在引用该表的任何 FOREIGN KEY 约束时才使用逐行删除。如果有没有 FOREIGN KEY 约束，InnoDB 通过删除原始表并创建一个具有相同定义的空表来执行快速截断，这比逐行删除要快得多。”

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-08-14T09:50:10.830

截断是在表级别，而删除是在行级别。如果您将其转换为其他语法的 sql，则 truncate 将是：

```
DELETE * FROM table 
```

因此一次删除所有行，而 DELETE 语句（在 PHPMyAdmin 中）如下所示：

```
DELETE * FROM table WHERE id = 1
DELETE * FROM table WHERE id = 2 
```

直到桌子空了。每个查询花费数（毫秒）秒，加起来比截断花费的时间更长。

# linux - sendmail 的 ssh 隧道

> ID：392034
> 
> 赞同：4
> 
> 时间：2008-12-24T18:51:53.390
> 
> 标签：linux, ssh, sendmail, mutt, fetchmail

我要疯了，试图配置我的系统。

我家里有一台笔记本电脑，工作中有一台工作站。我使用 mutt 和 sendmail。我有一个家庭 ISP，它在很多黑名单上，因此我通过我的 ISP 从笔记本电脑发送的任何电子邮件都经常被接收者作为垃圾邮件阻止。我可以通过 SSH 连接到我的工作站并在那里交互地使用 mutt，但它既慢又乏味。我使用 fetchmail 将我的电子邮件从工作服务器下载到笔记本电脑。

我试图让笔记本电脑通过工作邮件发送邮件使用

```
ssh -L 25:workstation.work.com:25 workstation.work.com 
```

但是当我这样做时，sendmail 似乎无法运行。当我尝试从工作站获取邮件到笔记本电脑时，sendmail 必须在笔记本电脑上运行，邮件才能在笔记本电脑本地传送。当邮件确实通过时，它会被拒绝，因为无法识别主机名。我试过更改 mutt 中的主机名。这似乎不影响任何事情。

所以我对如何在我的笔记本电脑上配置 mutt、sendmail 和 SSH 感到困惑，这样我就可以从我的笔记本电脑上撰写和发送电子邮件，以便它们被送达，但我也想用 fetchmail 从服务器获取我的电子邮件并拥有它在本地交付。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-24T19:07:29.160

如果您运行该 ssh 隧道，您将无法在本地运行 sendmail，否则它将监听端口 25，而不是您的隧道。默认情况下，fetchmail 希望将其发送到本地邮件服务器，但如果您愿意，可以将其配置为直接发送到 mbox 文件。

我所做的是在我的笔记本电脑上运行 postfix，并使用`relayhost=[127.0.0.1]:2526`/etc/postfix/main.cf 将其设置为将邮件发送到 localhost:2526。然后我运行 ssh 隧道`ssh -N -L 2526:localhost:25 ptomblin@myserver`，这样当 postfix 发送时，它会通过隧道向外传输。像 mutt 和 fetchmail 这样的本地邮件客户端会像他们期望的那样看到在端口 25 上运行的本地邮件服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T00:20:38.497

保罗：你的回答成功了！我很困惑，应该指定 -L 54321:localhost:25 而不是 -L 54321:remotehost:25。请注意您的中继主机节中的错字。方括号应该在冒号之前关闭，因此：relayhost=[127.0.0.1]:54321。感谢您提供有关后缀的提示。我以前一直使用sendmail，有点盲目，现在根据你的建议安装和使用postfix，发现配置与sendmail相比绝对令人高兴！

# iis - 在 IIS 中隔离猖獗的进程

> ID：392036
> 
> 赞同：1
> 
> 时间：2008-12-24T18:53:01.873
> 
> 标签：iis

我有一个固定的网络服务器，我已经能够将它隔离到一个特定的网站实例。我想深入挖掘并隔离导致问题的特定页面/进程。有什么提示吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T19:29:28.617

您可以对进程进行内存转储，然后使用 windbg 进行查看。

Tess Ferrandez 博客上有[关于这个问题的帖子。](http://blogs.msdn.com/tess/archive/2008/02/22/net-debugging-demos-lab-4-high-cpu-hang.aspx)就照她说的做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T18:57:36.357

您使用的是哪个版本的 IIS？一些较高的允许分离用于处理请求的进程，例如您可以通过这种方式隔离更多的工作进程。我还建议通读 IIS 日志以查看正在处理的请求、它们花费了多长时间等。

每个 IIS 版本都有许多不同的怪癖。真正低端的只有启动/停止功能，但较新的确实为管理员提供了更多的控制和权力，IMO。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T19:08:36.473

您应该尝试使用分析器来确定消耗最多资源的内容。我使用过[dotTrace Profiler](http://www.jetbrains.com/profiler/)，但如果您的预算紧张，这可能会很昂贵。

它使您可以准确地查看哪些进程和方法调用使用了请求的最多处理时间，因此您可以隔离资源最密集的操作。

您真的应该能够使用任何分析器来执行此操作，而不仅仅是 dotTrace。我只是碰巧只有这方面的经验。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-31T01:38:04.127

将您的网络花园设置更改为 10 或更高。然后在 Web 服务器上查看您的 CPU 和内存利用率。

继续增加网络花园设置，直到应用程序完全响应且平均利用率低于 5%，或者您实际上已经最大化了网络服务器的内存。

**更新**

这不是关于诊断，而是关于正确配置 IIS 服务器。Web Gardens 是 IIS 最容易被误解的功能之一。通过增加可用线程来处理新请求，您可以消除 Web 服务器级别的争用现象，并将其直接放置在它所属的位置。在这种情况下，在您的数据库中。它实际上并没有掩盖问题，而是准确地突出了问题所在。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T17:54:55.823

This turned out to be a SQL problem (sql 2005). The solution was found by using SQL activity monitor to identify a suspended process with a Async_network_io wait type. We then ran SQL profiler to narrow it down to two massive queries which were returning an over abundance of results.

# python - Python Optparse 列表

> ID：392041
> 
> 赞同：39
> 
> 时间：2008-12-24T18:54:52.523
> 
> 标签：python, optparse

我在我的程序中使用了 python optparse 模块，但我无法找到一种简单的方法来解析包含值列表的选项。

例如：

```
--groups one,two,three. 
```

我希望能够以列表格式访问这些值，如`options.groups[]`. 是否有 optparse 选项将逗号分隔值转换为列表？还是我必须手动执行此操作？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-12-24T21:50:34.917

S.Lott 的回答已被接受，但这里是档案的代码示例：

```
def foo_callback(option, opt, value, parser):
  setattr(parser.values, option.dest, value.split(','))

parser = OptionParser()
parser.add_option('-f', '--foo',
                  type='string',
                  action='callback',
                  callback=foo_callback) 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-12-24T19:03:51.897

查看[选项回调](http://docs.python.org/2/library/optparse#option-callbacks)。您的回调函数可以使用基本的方法将值解析为列表`optarg.split(',')`

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2015-03-27T12:53:43.283

同样，为了存档的完整性，扩展上面的示例：

*   您仍然可以使用“dest”来指定选项名称以供以后访问
*   在这种情况下不能使用默认值（参见[在 optparse 中触发默认值回调中的](https://stackoverflow.com/questions/14568141/triggering-callback-on-default-value-in-optparse)解释）
*   如果您想验证输入，应该从 foo_callback 抛出 OptionValueError

代码（有微小的变化）将是：

```
def get_comma_separated_args(option, opt, value, parser):
    setattr(parser.values, option.dest, value.split(','))

parser = OptionParser()
parser.add_option('-f', '--foo',
                  type='string',
                  action='callback',
                  callback=get_comma_separated_args,
                  dest = foo_args_list) 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2016-12-16T18:38:16.157

使用 optparse，要获取列表值，您可以使用操作“**附加**”：

> ```
> from optparse import OptionParser
> parser = OptionParser()
> parser.add_option("--group",
>                   action="append",
>                   dest="my_groups")
> (options, args) = parser.parse_args()
> print options.my_groups 
> ```

然后像这样调用你的程序：

**$ python demo.py --group 1 --group 2 --group 3**

['一二三']

# php - PHP忽略mysql_connect请求

> ID：392042
> 
> 赞同：1
> 
> 时间：2008-12-24T18:54:57.640
> 
> 标签：php, mysql, linux

我是 PHP 新手，并且已经安装在 Linux 上以启动（也是新手）。无论如何，PHP正在工作......

```
<?
$myVar = "test";
echo($myVar);
?> 
```

...工作得很好。

但...

```
<?

$dbhost = "localhost";
$dbuser = "myuser";
$dbpass = "mypass";
$dbname = "mydb";

echo($dbhost . "-" . $dbuser . "-" . $dbpass . "-" . $dbname);

$conn = mysql_connect($dbhost, $dbuser, $dbpass) or die("Unable to connect to MySQL");
print $conn;

mysql_close($conn);

phpInfo();
?> 
```

... 什么也没做。也没有错误，什么都没有。就好像代码甚至不存在一样。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T19:04:42.940

尝试执行以下操作：

1.  首先确保在您的 php 配置文件中打开了[display_errors 。](http://www.php.net/manual/en/errorfunc.configuration.php)还要设置[error_reporting](http://www.php.net/error_reporting)的级别以显示所有错误，包括严格 (error_reporting = E_ALL|E_STRICT)。进行更改后，重新启动您的网络服务器。
2.  运行[phpinfo()](http://www.php.net/phpinfo)，并检查 mysql 扩展是否已安装并正常工作。如果不确定您在 php 配置文件中取消了注释（再次提醒，请记住在每次更改配置文件后重新启动 apache）。
3.  此时 MySQL 应该已加载并开始工作，您应该能够从错误（如果仍然存在）中判断出问题所在。
4.  尝试[转储](http://www.php.net/var_dump)连接结果 ($conn) 的内容以查看它包含的内容。
5.  一般来说，我建议使用长 php 标签（<?php 而不是 <?），因为它更便携（短标签在 PHP 5 安装中默认关闭）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T19:01:47.860

如果它什么都不做，那是否意味着它连接良好？您期望该语句的输出是什么？

你可以试试

```
error_reporting(E_ALL);
$conn = mysql_connect("localhost", "myusername", "mypassword");
if(!$conn) {
    echo 'Unable to connect';
} else {
    echo 'Connected to database';
}
var_dump($conn); 
```

编辑：解决评论说你有一个mysql查询设置，如果你没有看到“成功”，这意味着你的查询有问题。添加到上面

```
$sth = mysql_query("SELECT * FROM tablename");
if(!$sth) {
    echo 'unable to query: ' . mysql_error();
} else {
    echo 'success';
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T19:11:42.473

尝试将其添加到代码的顶部：

```
error_reporting(E_ALL); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T19:02:17.453

代码是否比您向我们展示的更多？您刚刚建立的块建立了连接。如果成功了，您将什么都看不到，您必须使用它`$conn`来做某事。

要确认，请尝试将密码更改为故意错误的值，然后查看是否出现错误。如果这样做，代码就可以正常工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T19:02:21.637

连接到数据库

```
$conn = mysql_connect("localhost", "myusername", "mypassword") or die("Unable to connect"); 
```

如果连接成功，将没有*(visible(*结果。但是，一旦运行此语句，就可以使用其他 mysql 函数对数据库进行查询。

连接到数据库告诉你的程序“嘿，我想和这个数据库交谈”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T19:02:45.223

此代码应该创建一个数据库连接，仅此而已。你期望看到什么？

试试这个

```
<?php
$conn = mysql_connect("localhost", "myusername", "mypassword") 
or die("Unable to connect");
print("code sample");

print $conn;

?> 
```

它应该打印出类似“resource #1”的东西......

然后您可以使用该连接与数据库服务器进行通信

# .net - .Net 有哪些数据库缓存选项？

> ID：392043
> 
> 赞同：1
> 
> 时间：2008-12-24T18:55:56.627
> 
> 标签：.net, asp.net, winforms, caching, database-caching

我在网上看到有很多关于缓存 ASP.Net 的问题，但没有很多关于智能客户端应用程序及其数据库的缓存选项的讨论。

.Net 框架上的智能客户端应用程序有哪些可用的数据缓存选项，你们中的任何人如何使用它们？

* * *

**编辑**

下面提到了企业框架，想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T19:01:29.297

在 Winforms Smart Client 应用程序中需要/希望缓存经常访问的数据。从缓存中读取数据通常比访问数据提供者/Web 服务更快。

以下是一些带有示例的选项

1.  企业库的缓存应用程序块是一个不错的选择。
2.  此外，System.Web.Caching.Cache 可以与 Winforms 一起使用，只需获取一个静态实例。

请参见下面的示例。

使用 Entlib

```
 using Microsoft.Practices.EnterpriseLibrary.Caching;
    //Later 
    CacheManager cache= CacheFactory.GetCacheManager(); 
    cache.Add("dataKey", "Yourdata") 
```

使用 .NET 内置缓存 - 这也适用于您的 Winform 应用程序。

```
using System.Web.Caching;
using System.Web;

public sealed class CacheProvider 
{ 
    private CacheProvider(){}; 

    public static GetInstance() 
    {  
            return HttpRuntime.Cache;
    } 
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T18:59:29.333

好吧，如果您有一个 Windows 窗体应用程序，您通常不会关心 ASP.NET 中常见的多用户缓存方案的类型。我认为这就是为什么您在这里没有看到很多关于该主题的文档的原因。

我通常为 Windows 窗体滚动我自己的缓存机制——只是将“缓存”的东西存储为应用程序的状态。您是否有任何需要它的场景示例？解决方案应该根据问题量身定制......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T19:03:52.523

[速度](http://msdn.microsoft.com/en-us/data/cc655792.aspx)是另一种选择。

# math - 盒子里有几支蜡烛？

> ID：392079
> 
> 赞同：0
> 
> 时间：2008-12-24T19:13:07.433
> 
> 标签：math

对于目前描述为 [ck]?hann?ukk?ah? 大约在第一天点燃一根蜡烛，在第 8 天增加到最后的 8 根蜡烛。但是，每天都有一根额外的蜡烛用于点燃其他蜡烛。

那么，当你在商店购买那个盒子时，你会得到多少支蜡烛？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T19:24:54.867

根据[这个](http://judaism.about.com/cs/chanukahgeneral/ht/hol_chan_light.htm)，你的烛台需要有 8 支蜡烛，再加上你用来点燃其他蜡烛的额外一支。我发现的大多数网站都有 45 支光明节蜡烛。（伙计！我在平安夜工作时感到无聊还是什么？）

# parameters - 使用全局设置作为属性参数

> ID：392083
> 
> 赞同：4
> 
> 时间：2008-12-24T19:18:41.713
> 
> 标签：parameters, attributes

我想在属性中指定一个参数，如下所示：

```
[OutputCache(Duration = GlobalSettings.GlobalVar)] 
```

其中 GlobalVar 是我只定义一次的变量（不在乎在哪里）。

使用配置设置无论如何都不起作用，我也不能让它与一些静态类一起工作。

我收到错误： *属性参数必须是属性参数类型的常量表达式、typeof 表达式或数组创建表达式*

也许可以在 OutputCache 周围编写一个自定义包装器，但这感觉就像是 hack。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-24T19:27:30.307

问题是属性值必须在编译时确定——它们嵌入在程序集中。这就是为什么你必须使用一个常量表达式（不仅仅是一个全局变量——真正的一个*常量*）。

# php - 在 PHP 中输 出标题之前调用一个函数？

> ID：392088
> 
> 赞同：2
> 
> 时间：2008-12-24T19:22:40.410
> 
> 标签：php

在脚本输出任何 HTTP 标头之前，有什么方法可以让 PHP 自动调用函数？

我正在寻找类似[register-shutdown-function](http://us.php.net/register-shutdown-function)的东西，但是要注册一个在输出已经发送**之前调用的函数，而不是之后。**我希望我的函数发送一个标题，所以我需要一些之前调用的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-24T19:43:49.103

您还可以使用 捕获所有内容，`ob_start`然后注册一个回调函数，以便在使用 发送页面时使用`ob_end_flush`。查看[OB_START的 PHP 手册](http://us2.php.net/ob_start)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T02:14:18.097

我不知道这是否是您要查找的内容，但您可能想在 php.ini 中使用 auto_prepend_file 或将其设置在 .htaccess 文件中进行调查。如果您设置了 auto_prepend_file，它将在运行每个脚本之前自动包含该文件。

[auto_prepend_file](http://www.askapache.com/php/use-phpini-to-add-http-headers-to-output.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T19:27:19.743

查看[http://www.webmasterworld.com/forum88/1225.htm](http://www.webmasterworld.com/forum88/1225.htm) 您将使用 PHP 的 header() 函数来发送标头（必须在任何其他输出之前调用），但在之前/期间使用您的函数称呼。

# java - Java注解的最佳（或至少是好的）指南

> ID：392094
> 
> 赞同：17
> 
> 时间：2008-12-24T19:27:10.353
> 
> 标签：java, annotations

必须有一本好的书/PDF/HTML 文件来描述 Java 中注释的基本要素和良好实践。我从其他优秀的 Java 书籍中知道它们是什么，但我正在寻找能够教会我如何充分利用它们所需的大部分知识的东西。（最好是 PDF/HTML 格式，这样我可以打印出来并在闲暇时阅读，也可以预订，但那些过时的太快了……）

有什么建议吗？

编辑：我找到了 Sun 指南，以及来自[O'Reilly](http://www.onjava.com/lpt/a/4768)和[DevX的此类教程，以及涵盖它们的](http://www.devx.com/Java/Article/27235/1954?pf=true)[有效 Java](https://rads.stackoverflow.com/amzn/click/com/0201310058)部分......好吧，所以我知道它们是什么以及阅读它们的工具，但是并没有告诉我太多关于它们是如何在实践中使用的。（除了 Effective Java 和上面的 O'Reilly 文章中的一点建议它们在自动化测试框架中的使用）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-24T20:13:42.023

*   关于注释的一些意见：http://web.archive.org/web/20120115164115/http: [//faler.wordpress.com/2007/11/21/when-to-use-and-not-to-use-java - 注释](http://web.archive.org/web/20120115164115/http://faler.wordpress.com/2007/11/21/when-to-use-and-not-to-use-java-annotations)

*   这家伙非常反对他们： [https ://web.archive.org/web/20060702222249/http://www.softwarereality.com/programming/annotations.jsp](https://web.archive.org/web/20060702222249/http://www.softwarereality.com/programming/annotations.jsp)

*   最佳实践：[http ://willcode4beer.com/opinion.jsp?set=annotations_gotchas_best_practices](http://willcode4beer.com/opinion.jsp?set=annotations_gotchas_best_practices)

希望这可以帮助。让我们知道你发现了什么。

# design-patterns - 设计模式是你发明的东西吗？

> ID：392097
> 
> 赞同：3
> 
> 时间：2008-12-24T19:28:01.350
> 
> 标签：design-patterns, reducing

是否有固定的设计模式，或者每个足够熟练的软件开发人员是否识别并减少他们的代码以开发新的模式。有效地创建自己的“设计”模式。

编辑 - 感谢您的回复。实际上，我只是重构和/或减少在编写代码之前应该首先将问题与现有设计模式进行比较的代码。如果找到匹配项，那么我应该使用它，否则我只是重构代码（这不是一件坏事，通常不会产生任何新的普遍有用的“模式”。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-24T19:35:28.403

这不是一个非此即彼的问题。

设计模式是常见问题的通用解决方案。

已经有一堆现有的设计模式，每一个都适用于不同的问题（或不同的上下文），但设计模式的规范并没有关闭。当然还有更多的模式需要创建和/或发现。

要记住的重要一点是，要使解决方案真正成为一种模式，它需要足够通用才能被重用，并且需要应用于重复出现的问题。

我认为随着时间的推移，大多数程序员都会独立发现许多相同的模式。设计模式目录的真正目的是让我们都可以一劳永逸地同意特定模式是什么和做什么，例如外观模式，然后在更高的抽象层次上讨论它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-24T19:59:30.990

如果您阅读有关设计模式的文献，您会发现它是一个涵盖至少以下几种知识的**总称：**

*   常见问题的解决方案

*   每个程序员都应该知道的有用的编程技术，即应该普遍使用的

*   常用语言中丢失的解决方法（与 Smalltalk 相比，最初的四人帮一书包含许多 C++ 中丢失的解决方法）

设计模式的另一个重要方面是它们为程序员**提供了一个通用的词汇**来讨论这些事情。因此，要成为一种设计模式，必须**在社区之间共享**某些东西并获得**一致同意的名称**。要回答您的问题，**您可能会创建一个新的设计模式**，但首先要**创建一些新**的东西，然后让**社区同意**它是值得的（以及如何称呼它），需要做很多工作。

当然，新问题将变得普遍，有用的新编程技术将被发明，新的损失将产生对新解决方法的需求。但这**不会经常发生**，并且发明新的解决方案将是**大量的工作**。《四人帮》几乎完全是对现有实践的编纂——这本书的主要新贡献是共享词汇。这是一项有价值的贡献，但让我们这些听到炒作并希望得到的不仅仅是新瓶装旧酒的人感到失望。

如果您想创建新的设计模式，**请留下人迹罕至的路径**。例如，模式在面向对象的世界中几乎无处不在。（尽管围绕多方法调度或基于原型的语言可能仍有机会使用模式。）相比之下，**函数式程序员仍在等待**有人识别和命名大多数常见的解决方案和良好实践。如果你是一个伟大的思想家和作家，你可能会对那个领域产生巨大的影响。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T21:05:52.540

在您（1）多次需要它之前，它不是“模式”；(2) 可以以独立于特定问题域的方式对其进行描述。

也就是说，如果我按照自己的方式行事，我会宣布暂停使用新模式，或者拥有一个官方模式语言存储库，在它被记录、同行评审并证明不重复之前，它不会成为“模式”现有的模式。

大多数情况下，当人们谈论“组成一个模式”时，他们的真正意思是他们找到了一个他们想要重用的代码片段。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-24T19:31:38.143

肯定有固定的、公认的模式，正如[“四人帮”的设计模式一书](https://rads.stackoverflow.com/amzn/click/com/0201633612)很好地阐述的那样。微软模式和实践团队等团队也发布了[CAB](https://rads.stackoverflow.com/amzn/click/com/0201633612)和[SCSF等模式。](http://msdn.microsoft.com/en-us/library/aa480482.aspx)这是否意味着每个模式都被覆盖了？当然不是。开发人员和团队经常提出自己的模式来满足他们的需求并在整个项目中使用。

所以我们不想重新发明轮子——使用已经存在的模式——但不要觉得你被限制在别人正在做的事情上。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-24T19:33:46.657

没有理由不能将自己的模式和反模式记录下来，作为与他人分享所学知识的一种方式；然而，每个足够熟练的软件开发人员都不太可能真正发现尚未在其他地方发现和记录的东西。在发布这样的模式之前，一定要确保另一个模式还没有涵盖这种情况，以免以后出现尴尬。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-24T19:36:28.383

设计模式的主要用途之一是与其他程序员交流设计的方法。如果您创建自己的，那么只有您会意识到它们，并且它对于交流没有那么有用。

通常，开发人员确实会创建我们自己的设计模式，将这些与已发布的模式相关联会给我们带来新的想法和见解，并提高我们的沟通能力。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T19:32:54.867

如果你发现自己在一个有很多极端抽象机会的大项目中工作，你可以而且很可能会这样做。

但是，一般来说，设计模式是由那些花时间研究大型软件开发的人创建的，他们来自许多自己和他人的项目。

[http://en.wikipedia.org/wiki/Design_Patterns](http://en.wikipedia.org/wiki/Design_Patterns)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-24T19:36:58.663

软件设计模式通常适用于重复出现的问题，而不是特定于项目的。如果您为自己的问题域找到的解决方案足够通用且可重用以用于具有类似问题的类似项目，则它们可能会被视为模式。

随着软件开发出现的问题需要越来越多的解决方案，模式存储库不断增长。

# c# - 如何使winforms中的组合框只读

> ID：392098
> 
> 赞同：62
> 
> 时间：2008-12-24T19:29:09.087
> 
> 标签：c#, .net, winforms

我不希望用户能够更改组合框中显示的值。我一直在使用`Enabled = false`，但它使文本变灰，所以它不是很可读。我希望它的行为类似于带有 的文本框`ReadOnly = true`，其中文本正常显示，但用户无法对其进行编辑。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2009-02-21T11:29:15.647

使`DropDownStyle`属性`DropDownList`代替`DropDown` 然后处理`TextChanged`事件以防止用户更改文本。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-31T05:47:23.157

文章[ComboBox-with-read-only-behavior](http://www.codeproject.com/kb/combobox/ReadOnlyComboBoxByClaudio.aspx)提出了一个有趣的解决方案：

在同一个地方创建一个只读文本框和一个组合框。当您想要只读模式时，显示文本框，当您希望它可编辑时，显示组合框。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-24T20:42:10.967

不确定这是否是您正在寻找的，但...

设置 DropDownStyle = DropDownList

然后在 SelectedIndexChanged 事件上

```
if (ComboBox1.SelectedIndex != 0)
{
    ComboBox1.SelectedIndex = 0;
} 
```

这个丑陋的部分是他们会“感觉”他们可以改变它。他们可能会认为这是一个错误，除非您向他们发出警报，告诉他们为什么他们不能更改该值。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-24T19:36:01.117

我可以建议的最好的事情是用只读文本框（或者可能只是一个标签）替换组合框 - 这样用户仍然可以选择/复制值等。

当然，另一种厚颜无耻的策略是将 设置`DropDownStyle`为`DropDownList`，然后删除所有其他选项 - 然后用户没有其他选择;-p

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-05-11T04:18:23.887

[在此处输入链接描述](https://stackoverflow.com/a/3061058)

> 只需更改`DropDownStyle`为`DropDownList`. 或者，如果您希望它完全只读，您可以设置`Enabled = false`，或者如果您不喜欢我有时有两个控件的外观，一个只读文本框和一个组合框，然后隐藏组合并显示文本框，如果它应该是完全只读的反之亦然。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-11-21T10:57:31.417

我通过子类化 ComboBox 来处理它，以添加一个 ReadOnly 属性，该属性在设置时隐藏并在顶部显示一个包含相同文本的 ReadOnly TextBox：

```
class ComboBoxReadOnly : ComboBox
{
    public ComboBoxReadOnly()
    {
        textBox = new TextBox();
        textBox.ReadOnly = true;
        textBox.Visible = false;
    }

    private TextBox textBox;

    private bool readOnly = false;

    public bool ReadOnly
    {
        get { return readOnly; }
        set
        {
            readOnly = value;

            if (readOnly)
            {
                this.Visible = false;
                textBox.Text = this.Text;
                textBox.Location = this.Location;
                textBox.Size = this.Size;
                textBox.Visible = true;

                if (textBox.Parent == null)
                    this.Parent.Controls.Add(textBox);
            }
            else
            {
                this.Visible = true;
                this.textBox.Visible = false;
            }
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-09-10T14:09:37.680

这是 ReadOnly Combo 的最佳解决方案。

```
private void combo1_KeyPress(object sender, KeyPressEventArgs e)
{
    e.KeyChar = (char)Keys.None;
} 
```

它将丢弃 Combo 的按键。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-11-19T14:31:42.550

Michael R 的代码有效，但是……
当`DropDownHeight = 1;` ReadOnly 属性设置为 false 时，必须恢复为默认值。所以，在之前插入`base.OnDropDown(e)`：`DropDownHeight = 106;`

```
using System;
using System.Threading;
using System.Windows.Forms;

namespace Test_Application
{
    class ReadOnlyComboBox : ComboBox
    {
        private bool _readOnly;
        private bool isLoading;
        private bool indexChangedFlag;
        private int lastIndex = -1;
        private string lastText = "";

        public ReadOnlyComboBox()
        {
        }

        public bool ReadOnly
        {
            get { return _readOnly; }
            set { _readOnly = value; }
        }

        protected override void OnDropDown (EventArgs e)
        {
            if (_readOnly)
            {
                DropDownHeight = 1;
                var t = new Thread(CloseDropDown);
                t.Start();
                return;
            }
            DropDownHeight = 106; //Insert this line.
            base.OnDropDown(e);
        }

        private delegate void CloseDropDownDelegate();
        private void WaitForDropDown()
        {
            if (InvokeRequired)
            {
                var d = new CloseDropDownDelegate (WaitForDropDown);
                Invoke(d);
            }
            else
            {
                DroppedDown = false;
            }
        }
        private void CloseDropDown()
        {
            WaitForDropDown();
        }

        protected override void OnMouseWheel (MouseEventArgs e)
        {
            if (!_readOnly) 
                base.OnMouseWheel(e);
        }

        protected override void OnKeyDown (KeyEventArgs e)
        {
            if (_readOnly)
            {
                switch (e.KeyCode)
                {
                    case Keys.Back:
                    case Keys.Delete:
                    case Keys.Up:
                    case Keys.Down:
                        e.SuppressKeyPress = true;
                        return;
                }
            }
            base.OnKeyDown(e);
        }

        protected override void OnKeyPress (KeyPressEventArgs e)
        {
            if (_readOnly)
            {
                e.Handled = true;
                return;
            }
            base.OnKeyPress(e);
        }
    }
} 
```

要完成此答案：

> 文件 -> 新建 -> 项目... Visual C# -> Windows -> 经典桌面 -> Windows 窗体控件库

键入控件的名称 - 确定并粘贴此代码。

您可以选择 dll 文件的名称：
Project - yourproject Properties...

*   程序集名称：键入名称。只需构建解决方案，您就有了 dll 文件。因此，打开要使用只读组合的项目，右键单击参考
*   添加参考...并浏览您的 dll 文件。要将您的自定义组件插入工具箱，请打开您的工具箱，右键单击常规选项卡 -> 选择项目...
*   浏览您的 dll 文件 - 打开。现在您可以在您的项目中使用您的 ReadOnlyComboBox。PS：我正在使用VS2015。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-24T21:11:04.183

您可以将启用的组合框的前景色和背景色更改为系统颜色，尽管这可能会使用户感到困惑（如果他们不能更改，为什么要拥有它），它看起来会更好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-11-27T02:24:32.030

实际上，它相当简单：

```
Private Sub combobox1_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles combobox1.KeyDown
    ' the following makes this the combobox read only    
    e.SuppressKeyPress = True    
End Sub 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-10-20T12:33:36.183

`ComboBox`这就是您将如何解决 a with`Enabled = False`难以阅读的事实：

[禁用时看起来不错的组合框](http://www.codeproject.com/Articles/15078/A-combobox-that-looks-decent-when-it-is-disabled)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-21T12:29:46.517

为什么不直接使用文本框？文本框具有“只读”属性，并且由于您希望组合框仅显示数据，因此我不明白您为什么需要组合框。

另一种方法是您只需取消“on value changed”事件的输入。这样，无论用户做什么，您都将显示您的信息......

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-07-04T09:34:54.680

将`DropdownStyle`属性设置为`Simple`

将以下代码添加到`KeyPress`ComboBox 的事件中

```
private void comboBoxName_KeyPress(object sender, KeyPressEventArgs e)
{
    e.Handled = true;
    return;
} 
```

将以下代码添加到`KeyDown`ComboBox 的事件中

```
private void comboBoxName_KeyDown(object sender, KeyEventArgs e)
{
    e.Handled = true;
    return;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-08-16T01:07:49.857

如果您已经填充了它，并选择了适当的项目并将其设为 a `DropDownList`，那么您可以使用这样的扩展方法来快速将选择列表缩减为仅选定的项目：

```
public static void MakeReadOnly(this ComboBox pComboBox) {
   if (pComboBox.SelectedItem == null)
      return;

   pComboBox.DataSource = new List<object> {
      pComboBox.SelectedItem
   };
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-12-04T06:28:58.633

我知道我参加聚会有点晚了，但是我正在研究这个确切的问题，并且我知道必须有某种方法可以使组合框成为只读的，就好像它是一个文本框并禁用列表弹出一样。它并不完美，但绝对比我在互联网上找到的所有对我不起作用的答案要好。按下按钮并调用 OnDropDown 后，将创建一个新线程，将 DroppedDown 属性设置为 false，从而创建“什么都没有发生”的效果。鼠标滚轮被消耗，按键事件也被消耗。

```
using System;
using System.Threading;
using System.Windows.Forms;

namespace Test_Application
{
    class ReadOnlyComboBox : ComboBox
    {
        private bool _readOnly;
        private bool isLoading;
        private bool indexChangedFlag;
        private int lastIndex = -1;
        private string lastText = "";

        public ReadOnlyComboBox()
        {
        }

        public bool ReadOnly
        {
            get { return _readOnly; }
            set { _readOnly = value; }
        }

        protected override void OnDropDown(EventArgs e)
        {
            if (_readOnly)
            {
                DropDownHeight = 1;
                var t = new Thread(CloseDropDown);
                t.Start();
                return;
            }
            base.OnDropDown(e);
        }

        private delegate void CloseDropDownDelegate();
        private void WaitForDropDown()
        {
            if (InvokeRequired)
            {
                var d = new CloseDropDownDelegate(WaitForDropDown);
                Invoke(d);
            }
            else
            {
                DroppedDown = false;
            }
        }
        private void CloseDropDown()
        {
            WaitForDropDown();
        }

        protected override void OnMouseWheel(MouseEventArgs e)
        {
            if (!_readOnly) 
                base.OnMouseWheel(e);
        }

        protected override void OnKeyDown(KeyEventArgs e)
        {
            if (_readOnly)
            {
                switch (e.KeyCode)
                {
                    case Keys.Back:
                    case Keys.Delete:
                    case Keys.Up:
                    case Keys.Down:
                        e.SuppressKeyPress = true;
                        return;
                }
            }
            base.OnKeyDown(e);
        }

        protected override void OnKeyPress(KeyPressEventArgs e)
        {
            if (_readOnly)
            {
                e.Handled = true;
                return;
            }
            base.OnKeyPress(e);
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-01-19T09:45:15.690

**代码中最简单的方法**：

不要为`KeyPress`or添加方法，而是`KeyDown`在 ' ' 方法上添加此代码`Form1_Load`：

> `comboBox1.KeyPress += (sndr, eva) => eva.Handled = true;`

或者

> `comboBox1.KeyDown += (sndr, eva) => eva.SuppressKeyPress = true;`

`(sndr, eva)`是为了`(object sender, EventArgs e)`

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-05-17T21:14:50.857

我不知道这是否是您正在寻找的，但这会阻止用户从下拉列表中选择任何项目，并且仍然能够在组合框中键入文本。如果您不希望用户在组合框中键入文本，您可以从属性菜单中将其设为下拉列表。

所以你得到**Read Only 组合框**。

1.  选定索引已更改
2.  使选定的索引 -1 " **comboBox.SelectedIndex = -1** ";

    ```
     private void MyComboBox_comboBox_SelectedIndexChanged(object sender, EventArgs e)
        {
            MyComboBox_comboBox.SelectedIndex = -1; 

        } 
    ```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2011-11-12T16:59:14.710

这是 ReadOnly Combo 的最佳解决方案。

```
private void combo1_KeyPress(object sender, KeyPressEventArgs e) {
    e.KeyChar = (char)Keys.None; 
} 
```

它将丢弃 Combo 的按键。它没有“e. **KeyChar** ”！

# python - wxPython 和在窗口之间共享对象

> ID：392100
> 
> 赞同：2
> 
> 时间：2008-12-24T19:30:01.813
> 
> 标签：python, wxpython

我已经使用 python 有一段时间了，并且刚刚开始学习 wxPython。在创建了一些小程序之后，我很难理解如何创建可以在对话框之间共享的对象。

以下是一些代码作为示例（为长度道歉 - 我试图修剪）：

```
import wx

class ExampleFrame(wx.Frame):
    """The main GUI"""
    def __init__(self, parent, id, title):
        wx.Frame.__init__(self, parent, id, title, size=(200,75))
        mainSizer = wx.BoxSizer(wx.VERTICAL)

        # Setup buttons
        buttonSizer = wx.BoxSizer(wx.HORIZONTAL)
        playerButton = wx.Button(self, wx.ID_ANY, "Player number", wx.DefaultPosition, wx.DefaultSize, 0)
        buttonSizer.Add(playerButton, 1, wx.ALL | wx.EXPAND, 0)
        nameButton = wx.Button(self, wx.ID_ANY, "Player name", wx.DefaultPosition, wx.DefaultSize, 0)
        buttonSizer.Add(nameButton, 1, wx.ALL | wx.EXPAND, 0)

        # Complete layout and add statusbar
        mainSizer.Add(buttonSizer, 1, wx.EXPAND, 5)
        self.SetSizer(mainSizer)
        self.Layout()

        # Deal with the events
        playerButton.Bind(wx.EVT_BUTTON, self.playerButtonEvent)
        nameButton.Bind(wx.EVT_BUTTON, self.nameButtonEvent)
        self.Show(True)
        return

    def playerButtonEvent(self, event):
        """Displays the number of game players"""
        playerDialog = PlayerDialogWindow(None, -1, "Player")
        playerDialogResult = playerDialog.ShowModal() 
        playerDialog.Destroy()
        return

    def nameButtonEvent(self, event):
        """Displays the names of game players"""
        nameDialog = NameDialogWindow(None, -1, "Name")
        nameDialogResult = nameDialog.ShowModal() 
        nameDialog.Destroy()
        return

class PlayerDialogWindow(wx.Dialog):
    """Displays the player number"""
    def __init__(self, parent, id, title):
        wx.Dialog.__init__(self, parent, id, title, size=(200,120))

        # Setup layout items
        self.SetAutoLayout(True)
        mainSizer = wx.BoxSizer(wx.VERTICAL)
        dialogPanel = wx.Panel(self, wx.ID_ANY, wx.DefaultPosition, wx.DefaultSize, wx.TAB_TRAVERSAL)
        dialogSizer = wx.BoxSizer(wx.VERTICAL)

        # Display player number
        playerNumber = "Player number is %i" % gamePlayer.number
        newLabel = wx.StaticText(dialogPanel, wx.ID_ANY, playerNumber, wx.DefaultPosition, wx.DefaultSize, 0)
        dialogSizer.Add(newLabel, 0, wx.ALL | wx.EXPAND, 5)

        # Setup buttons
        buttonSizer = wx.StdDialogButtonSizer()
        okButton = wx.Button(dialogPanel, wx.ID_OK)
        buttonSizer.AddButton(okButton)
        buttonSizer.Realize()
        dialogSizer.Add(buttonSizer, 1, wx.EXPAND, 5)

        # Complete layout
        dialogPanel.SetSizer(dialogSizer)
        dialogPanel.Layout()
        dialogSizer.Fit(dialogPanel)
        mainSizer.Add(dialogPanel, 1, wx.ALL | wx.EXPAND, 5)
        self.SetSizer(mainSizer)
        self.Layout()

        # Deal with the button events
        okButton.Bind(wx.EVT_BUTTON, self.okClick)
        return

    def okClick(self, event):
        """Deals with the user clicking the ok button"""
        self.EndModal(wx.ID_OK)
        return 

class NameDialogWindow(wx.Dialog):
    """Displays the player name"""
    def __init__(self, parent, id, title):
        wx.Dialog.__init__(self, parent, id, title, size=(200,120))

        # Setup layout items
        self.SetAutoLayout(True)
        mainSizer = wx.BoxSizer(wx.VERTICAL)
        dialogPanel = wx.Panel(self, wx.ID_ANY, wx.DefaultPosition, wx.DefaultSize, wx.TAB_TRAVERSAL)
        dialogSizer = wx.BoxSizer(wx.VERTICAL)

        # Display player number
        playerNumber = "Player name is %s" % gamePlayer.name
        newLabel = wx.StaticText(dialogPanel, wx.ID_ANY, playerNumber, wx.DefaultPosition, wx.DefaultSize, 0)
        dialogSizer.Add(newLabel, 0, wx.ALL | wx.EXPAND, 5)

        # Setup buttons
        buttonSizer = wx.StdDialogButtonSizer()
        okButton = wx.Button(dialogPanel, wx.ID_OK)
        buttonSizer.AddButton(okButton)
        buttonSizer.Realize()
        dialogSizer.Add(buttonSizer, 1, wx.EXPAND, 5)

        # Complete layout
        dialogPanel.SetSizer(dialogSizer)
        dialogPanel.Layout()
        dialogSizer.Fit(dialogPanel)
        mainSizer.Add(dialogPanel, 1, wx.ALL | wx.EXPAND, 5)
        self.SetSizer(mainSizer)
        self.Layout()

        # Deal with the button events
        okButton.Bind(wx.EVT_BUTTON, self.okClick)
        return

    def okClick(self, event):
        """Deals with the user clicking the ok button"""
        self.EndModal(wx.ID_OK)
        return 

class Player(object):
    """A game player"""
    def __init__(self, number, name):
        self.number = number
        self.name = name
        return

def main():
    # Start GUI
    global gamePlayer
    gamePlayer = Player(1, "John Smith")
    app = wx.App(redirect=False)
    frame = ExampleFrame(None, -1, "Example frame")
    frame.Show(True)
    app.MainLoop()
    return 0

if __name__ == '__main__':
    main() 
```

所以，我希望这两个对话框都能访问 gamePlayer 对象。目前，我能想到的唯一方法是将 gamePlayer 对象创建为全局对象，但这些通常是不受欢迎的——有没有更好的方法来做到这一点？

[这个问题](https://stackoverflow.com/questions/173687?sort=votes)中有一种在事件绑定中传递对象的方法，但感觉不太对劲。

学习实现 MVC 模式是前进的方向吗？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T19:42:02.257

您可以将 gamePlayer 对象`__init__`作为另一个参数传递给。

```
def __init__(self, parent, id, title, gamePlayer ):
    ...etc... 
```

从长远来看，这并不理想。

您应该将构建一个空面板与加载该面板的数据分开。空面板是一回事，用模型中的数据填充它是不相关的。

使用数据填充帧是必须为您提供 gamePlayer 对象的地方，该对象将用于更新各种显示小部件。

我建议您查看 Document-View 框架以获得这方面的指导。 [http://docs.wxwidgets.org/stable/wx_docviewoverview.html#docviewoverview](http://docs.wxwidgets.org/stable/wx_docviewoverview.html#docviewoverview)。不幸的是，没有任何好的 Python 示例，因此从 C++ 代码转换为 Python 可能会令人困惑。

最终，您有一个“文档”，它是正在显示的主要对象（“gamePlayer”）。每个框架都是该文档的一个视图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-02T17:42:28.160

模型-视图-控制器 (MVC) 框架允许您访问公共数据 (模型) 并通过控制器将其显示在您的 GUI (视图) 中。在这里可以找到一个很好的解释：

[wxPython 的 MVC 框架](http://wiki.wxpython.org/ModelViewController)

基本上，您可以通过不允许模型直接与视图对话，而是将其发布到已进行更改的控制器来避免混乱。然后控制器适当地更新视图。同样用于从您的 gui 上的控件更新模型。这样，模型和视图代码是独立的，它们与访问每个 API 的控制器代码绑定在一起。

# solaris - ZFS vdev 命名？

> ID：392118
> 
> 赞同：1
> 
> 时间：2008-12-24T19:37:01.270
> 
> 标签：solaris, opensolaris, zfs

我不知道在 Solaris 中创建 zfs 池时命名使用的 vdev（虚拟设备）的基本原理是什么。假设我有一个磁盘c4d0，c4d0p0和c4d0s0是什么意思？而且，我怎么知道 ZFS 命令使用什么。我非常困惑，因为我不断收到“指定的无效 vdev”。任何指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T19:43:44.110

c4d0s0 = 控制器 4，磁盘 0，切片 0

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T20:05:36.483

如果您希望 ZFS 使用整个磁盘，您可能需要使用主磁盘名称，在您的情况下为 c4d0。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T07:20:15.603

有一篇很好的文章：[“Solaris 磁盘设备名称的工作原理”](http://initialprogramload.blogspot.com/2008/07/how-solaris-disk-device-names-work.html)。
这可能会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T13:06:52.897

[ZFS 最佳实践指南](http://www.solarisinternals.com/wiki/index.php/ZFS_Best_Practices_Guide "ZFS 最佳实践指南")建议使用整个磁盘进行生产设置——按照 X-Istence 所说的去做——使用不带分片号的 c4d0。使用 ZF，您可以抛弃所有关于分区的知识 - 它们是如此 1990 年代！

# firebird - 使用 InstallShield 安装 FireBird

> ID：392119
> 
> 赞同：2
> 
> 时间：2008-12-24T19:37:19.473
> 
> 标签：firebird, installshield, installscript

我似乎找不到一个好的脚本或任何可用于使用 InstallShield 安装 Firebird（InterBase-decendent RDBMS）的脚本。有一种方法可以使用 firebird install 可执行文件静默安装它，但我对 InstallShieldscripts 的了解还不够，无法做到！如果有人知道关于 a）如何从 InstallShield 执行 exe b）如何使用 InstallShield 安装 firebord 的任何信息，我将不胜感激！非常感谢，马特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-28T11:16:49.917

您可能应该改写您的问题以获取有关如何使用 InstallShield 脚本中的命令行参数执行外部程序的答案。也许文档已经有足够的信息了。

关于 Firebird 的安装，请查看Firebird 安装随附的[文档，其中显示了 Firebird 安装可执行文件的所有可用开关。](http://firebird.cvs.sourceforge.net/viewvc/firebird/firebird2/builds/install/arch-specific/win32/installation_scripted.txt?view=markup)如果您不希望用户看到您的程序正在安装 Firebird，您可能应该使用*/SP-*、*/VERYSILENT*和*/SUPPRESSMSGBOXES*开关。其他值得研究的开关是*/NOICONS*用于禁止在开始菜单中创建程序组，以及*/COMPONENTS=...*仅安装程序运行所必需的部分。

请注意，安装 Firebird 只是您应该做的一部分。为了清楚地与使用 Firebird 的其他程序区分开来，您应该使用密码创建一个新的 Firebird 用户帐户，并且将数据库的别名添加到*aliases.conf*文件中总是一个好主意。

# c++ - 为什么我不能通过 typedef 声明朋友？

> ID：392120
> 
> 赞同：20
> 
> 时间：2008-12-24T19:37:20.317
> 
> 标签：c++

有谁知道为什么类名的类型定义不像朋友声明的类名那样工作？

```
class A
{
public:
};

class B : public A
{
public:
   typedef A SUPERCLASS;
};

typedef A X;

class C
{
public:
   friend class A;             // OK
   friend class X;             // fails
   friend class B::SUPERCLASS; // fails
}; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-24T19:49:42.663

目前不能。我还不知道原因（只是查找它，因为我觉得它很有趣）。更新：您可以在第一个提案中找到支持 typedef-names 作为朋友的原因：[http](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1520.pdf) ://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1520.pdf 。原因是标准只支持详细类型说明符。很容易只允许那些，并说如果声明为朋友的实体尚未声明，它将成为周围命名空间的成员。但这意味着如果您想使用模板参数，则必须这样做（例如，需要一个类）

```
friend class T; 
```

但这带来了额外的问题，并且被认为不值得。现在，该论文建议允许给出额外的类型说明符（这样就允许使用模板参数和 typedef-names）。

下一个 C++ 版本（由于 2010 年）将能够做到这一点。

请参阅此标准更新提案：[http](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1791.pdf) ://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1791.pdf 。它不仅允许 typedef 名称，而且还允许将模板参数用作声明为朋友的类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T19:48:28.220

AFAIK，在 C++ 中 typedef 在与类结合使用时不会创建完整的同义词。换句话说，它不像宏。

限制之一是同义词不能出现在类或结构前缀之后，也不能用作析构函数或构造函数名称。您也不能子类化同义词。我敢打赌这也意味着你不能成为它的朋友。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T19:49:02.040

我在 VC++ 8.0 中尝试了代码：

```
...
class C
{
public:
  friend class A;       
  friend X;             
  friend B::SUPERCLASS; 
};
... 
```

它编译没有错误。

我不知道它是否特定于 MS。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-30T19:26:54.707

typedef 定义了一个类型。Friend decls 声明友元类或函数（基本上是范围），然后它们可以“访问”声明类的非公共区域......

原语，即 float 或 int* 不使用代码等定义范围，它们无论如何都不会“使用”该类。

不要忘记，您还可以在 typedef 中“打包”调用约定、对齐属性和其他编译器特定的东西，即由同一类实现但具有不同对齐属性的多个向量类型。=> 类型不是类，反之亦然。

恕我直言，声明朋友 typedef 可能很有用，但是当可以将任何地方的“类 typedef”设置为朋友时，友谊可能变得非常难以理解，因此容易出错，尤其是在过度使用模板的情况下。

由于广泛的依赖关系，使单个 typedef 无效可能会弄乱整个项目。模板朋友和 0x 模板类型定义很有用，但不要放松朋友声明的规则。

我不知道有关朋友类型定义的任何建议。

# c# - 在 C# 中，我如何判断一个属性是否是静态的？（.Net CF 2.0）

> ID：392122
> 
> 赞同：36
> 
> 时间：2008-12-24T19:38:29.567
> 
> 标签：c#, reflection, compact-framework

FieldInfo 有一个 IsStatic 成员，但 PropertyInfo 没有。我想我只是忽略了我需要的东西。

```
Type type = someObject.GetType();

foreach (PropertyInfo pi in type.GetProperties())
{
   // umm... Not sure how to tell if this property is static
} 
```

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-24T19:44:58.647

要确定属性是否为静态，您必须通过调用 GetGetMethod 或 GetSetMethod 方法获取 get 或 set 访问器的 MethodInfo，并检查其 IsStatic 属性。

[http://msdn.microsoft.com/en-us/library/system.reflection.propertyinfo.aspx](http://msdn.microsoft.com/en-us/library/system.reflection.propertyinfo.aspx)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2017-08-03T12:44:00.373

作为对所问问题的实际快速简单的解决方案，您可以使用以下方法：

```
propertyInfo.GetAccessors(true)[0].IsStatic; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-24T19:53:27.633

为什么不使用

```
type.GetProperties(BindingFlags.Static) 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2018-07-20T11:49:46.100

更好的解决方案

```
public static class PropertyInfoExtensions
{
    public static bool IsStatic(this PropertyInfo source, bool nonPublic = false) 
        => source.GetAccessors(nonPublic).Any(x => x.IsStatic);
} 
```

用法：

```
property.IsStatic() 
```

# wpf - 是否有与 Windows 窗体列表框 TopIndex 等效的 WPF 列表框？

> ID：392127
> 
> 赞同：0
> 
> 时间：2008-12-24T19:42:52.770
> 
> 标签：wpf, listbox, wpf-controls, scroll

基本上我想要做的是允许用户输入一个字符串值并让列表框滚动到与他们输入的文本匹配的项目（或第一个 LIKE 匹配）。

如果我使用 .ScrollIntoView() 方法，问题是如果项目在列表中比当前滚动位置更靠下，它会将项目放在可见区域的底部，如果它更高，它会在顶部在列表中比当前滚动位置。我想通过使其成为列表中的顶部项目来使其保持一致（除非它当然不能因为它是项目的最后“页面”之一）。

我试图通过选择列表中更靠下的*x*项目来伪造它，其中 x 是可见项目的数量。这在下降时有效，但在上升时会中断。而且我一直无法确定哪个索引当前是我列表中最显眼的位置。

WinForms 列表框具有 .TopIndex 属性，该属性正是我正在寻找的，但我一直无法找到 WPF 等价物。那里的任何人都知道如何做到这一点？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T22:56:09.387

使用 ScrollIntoView 两次，首先显示列表中的最后一项，然后显示您选择的项目。这样，它将始终自下而上地工作。您需要在每次调用后调用 UpdateLayout 以确保位置正确。

# perl - Perl 的“祝福”到底是做什么的？

> ID：392135
> 
> 赞同：152
> 
> 时间：2008-12-24T19:48:51.993
> 
> 标签：perl, bless

我知道在类的“new”方法中使用 Perl 中的“bless”关键字：

```
sub new {
    my $self = bless { };
    return $self;
} 
```

但是“祝福”对那个哈希引用到底做了什么？

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2008-12-24T19:58:09.900

通常，`bless`将对象与类相关联。

```
package MyClass;
my $object = { };
bless $object, "MyClass"; 
```

现在，当您在 上调用方法时`$object`，Perl 知道要在哪个包中搜索该方法。

如果第二个参数被省略，如您的示例所示，则使用当前包/类。

为了清楚起见，您的示例可能会编写如下：

```
sub new { 
  my $class = shift; 
  my $self = { }; 
  bless $self, $class; 
} 
```

编辑：有关更多详细信息，请参阅[kixx](https://stackoverflow.com/users/11260/kixx)的好[答案](https://stackoverflow.com/questions/392135/what-exactly-does-perls-bless-do#392194)。

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2008-12-24T20:39:53.623

`bless`将引用与包相关联。

引用是什么并不重要，它可以是哈希（最常见的情况）、数组（不太常见）、标量（通常这表示一个由[内而外的对象](https://perldoc.perl.org/perlobj.html#Inside-Out-objects)）、正则表达式，子例程或 TYPEGLOB（有关有用的示例，请参阅[Damian Conway 的《面向对象的 Perl：概念和编程技术综合指南》](https://www.goodreads.com/book/show/86378.Object_Oriented_Perl)一书），甚至是对文件或目录句柄的引用（最不常见的情况）。

效果`bless`是它允许您将特殊语法应用于祝福引用。

例如，如果一个受祝福的引用存储在`$obj`（`bless`与包“Class”相关联）中，那么`$obj->foo(@args)`将调用一个子例程`foo`并将引用作为第一个参数传递，`$obj`然后是其余参数（`@args`）。子程序应该在包“Class”中定义。如果包“Class”中没有子例程`foo`，则将搜索其他包的列表（取自包“Class”中的数组）并调用找到`@ISA`的第一个子例程。`foo`

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-24T19:54:06.447

短版本：它将哈希标记为附加到当前包命名空间（以便该包提供其类实现）。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2016-06-03T12:01:43.027

这个函数告诉 REF 引用的实体它现在是 CLASSNAME 包中的一个对象，或者如果 CLASSNAME 被省略，则为当前包。建议使用 bless 的两个参数形式。

**示例**：

```
bless REF, CLASSNAME
bless REF 
```

**返回值**

此函数返回对 CLASSNAME 中祝福的对象的引用。

**示例**：

以下是显示其基本用法的示例代码，对象引用是通过祝福对包类的引用来创建的 -</p>

```
#!/usr/bin/perl

package Person;
sub new
{
    my $class = shift;
    my $self = {
        _firstName => shift,
        _lastName  => shift,
        _ssn       => shift,
    };
    # Print all the values just for clarification.
    print "First Name is $self->{_firstName}\n";
    print "Last Name is $self->{_lastName}\n";
    print "SSN is $self->{_ssn}\n";
    bless $self, $class;
    return $self;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-08-26T22:24:42.173

我将在这里提供一个答案，因为这里的那些并没有完全点击我。

Perl 的 bless 函数将任何对包内所有函数的引用关联起来。

为什么我们需要这个？

让我们从用 JavaScript 表达一个例子开始：

```
(() => {
    'use strict';

    class Animal {
        constructor(args) {
            this.name = args.name;
            this.sound = args.sound;
        }
    }

    /* [WRONG] (global scope corruption)
     * var animal = Animal({
     *     'name': 'Jeff',
     *     'sound': 'bark'
     * }); 
     * console.log(animal.name + ', ' + animal.sound); // seems good
     * console.log(window.name); // my window's name is Jeff?
     */

    // new is important!
    var animal = new Animal(
        'name': 'Jeff',   
        'sound': 'bark'
    );

    console.log(animal.name + ', ' + animal.sound); // still fine.
    console.log(window.name); // undefined
})(); 
```

现在让我们剥离类结构并没有它：

```
(() => {
    'use strict';

    var Animal = function(args) {
        this.name = args.name;
        this.sound = args.sound;
        return this; // implicit context hashmap
    };

    // the "new" causes the Animal to be unbound from global context, and 
    // rebinds it to an empty hash map before being constructed. The state is
    // now bound to animal, not the global scope.
    var animal = new Animal({
        'name': 'Jeff',
        'sound': 'bark'
    });
    console.log(animal.sound);    
})(); 
```

该函数采用无序属性的哈希表（因为在 2016 年必须以特定顺序在动态语言中编写属性是没有意义的）并返回具有这些属性的哈希表，或者如果您忘记输入新关键字，它将返回整个全局上下文（例如浏览器中的窗口或 nodejs 中的全局）。

Perl 没有“this”、“new”或“class”，但它仍然可以有一个行为相似的函数。我们不会有构造函数或原型，但我们将能够随意创建新动物并修改它们的个别属性。

```
# self contained scope 
(sub {
    my $Animal = (sub {
        return {
            'name' => $_[0]{'name'},
            'sound' => $_[0]{'sound'}
        };
    });

    my $animal = $Animal->({
        'name' => 'Jeff',
        'sound' => 'bark'
    });

    print $animal->{sound};
})->(); 
```

现在，我们有一个问题：如果我们希望动物自己发出声音，而不是我们打印它们的声音，该怎么办。也就是说，我们需要一个函数 performSound 来打印动物自己的声音。

做到这一点的一种方法是教每个动物如何发出声音。这意味着每只 Cat 都有自己的重复函数来执行声音。

```
# self contained scope 
(sub {
    my $Animal = (sub {
        $name = $_[0]{'name'};
        $sound = $_[0]{'sound'};

        return {
            'name' => $name,
            'sound' => $sound,
            'performSound' => sub {
                print $sound . "\n";
            }
        };
    });

    my $animal = $Animal->({
        'name' => 'Jeff',
        'sound' => 'bark'
    });

    $animal->{'performSound'}();
})->(); 
```

这很糟糕，因为每次构造动物时，performSound 都会作为一个全新的函数对象放入。10000 只动物意味着 10000 种表演声音。我们希望有一个函数 performSound，所有动物都可以使用它来查找自己的声音并打印出来。

```
(() => {
    'use strict';

    /* a function that creates an Animal constructor which can be used to create animals */
    var Animal = (() => {
        /* function is important, as fat arrow does not have "this" and will not be bound to Animal. */
        var InnerAnimal = function(args) {
            this.name = args.name;
            this.sound = args.sound;
        };
        /* defined once and all animals use the same single function call */
        InnerAnimal.prototype.performSound = function() {
            console.log(this.name);
        };

        return InnerAnimal;
    })();

    /* we're gonna create an animal with arguments in different order
       because we want to be edgy. */
    var animal = new Animal({
        'sound': 'bark',
        'name': 'Jeff'
    });
    animal.performSound(); // Jeff
})(); 
```

这就是与 Perl 的相似之处。

JavaScript 的 new 运算符不是可选的，没有它，对象方法中的“this”会破坏全局范围：

```
(() => {
    // 'use strict'; // uncommenting this prevents corruption and raises an error instead.

    var Person = function() {
        this.name = "Sam";
    };
//    var wrong = Person(); // oops! we have overwritten window.name or global.main.
//    console.log(window.name); // my window's name is Sam?
    var correct = new Person; // person's name is actually stored in the person now.

})(); 
```

我们希望每个 Animal 都有一个函数来查找该动物自己的声音，而不是在构造时对其进行硬编码。

Blessing 让我们可以使用一个包作为对象的原型。这样，对象就知道它被“引用”的“包”，进而可以让包中的函数“进入”从该“包对象”的构造函数创建的特定实例：

```
package Animal;
sub new {
    my $packageRef = $_[0];
    my $name = $_[1]->{'name'};
    my $sound = $_[1]->{'sound'};

    my $this = {
        'name' => $name,
        'sound' => $sound
    };   

    bless($this, $packageRef);
    return $this;
}

# all animals use the same performSound to look up their sound.
sub performSound {
    my $this = shift;
    my $sound = $this->{'sound'};
    print $sound . "\n";
}

package main;
my $animal = Animal->new({
    'name' => 'Cat',
    'sound' => 'meow'
});
$animal->performSound(); 
```

**摘要/ TL；博士**：

Perl 没有“this”、“class”和“new”。将一个对象祝福到一个包给该对象一个对该包的引用，并且当它调用包中的函数时，它们的参数将偏移1个槽，第一个参数（$_ [0]或shift）将等效于javascript的“这个”。反过来，您可以在某种程度上模拟 JavaScript 的原型模型。

不幸的是，（据我所知）在运行时创建“新类”是不可能的，因为您需要每个“类”都有自己的包，而在 javascript 中，您根本不需要包，因为“new”关键字组成一个匿名哈希图，供您在运行时用作一个包，您可以在其中添加新函数和动态删除函数。

有一些 Perl 库创建了自己的方法来弥补这种表达能力的限制，例如 Moose。

**为什么会出现混乱？**：

因为包裹。我们的直觉告诉我们将对象绑定到包含其原型的 hashmap。这让我们可以像 JavaScript 一样在运行时创建“包”。Perl 没有这样的灵活性（至少不是内置的，你必须发明它或从其他模块中获取它），进而阻碍你的运行时表现力。称它为“祝福”也没有多大好处。

**我们想做的**：

像这样的东西，但是绑定到原型映射递归，并且被隐式绑定到原型而不是必须显式地这样做。

这是一个天真的尝试：问题是“调用”不知道“调用它的东西”，所以它也可能是一个通用的 perl 函数“objectInvokeMethod(object, method)”，它检查对象是否具有方法，或者它的原型有它，或者它的原型有它，直到它到达最后并找到它与否（原型继承）。Perl 有很好的 eval 魔法来做这件事，但我会把它留给我以后可以尝试做的事情。

无论如何，这是一个想法：

```
(sub {

    my $Animal = (sub {
        my $AnimalPrototype = {
            'performSound' => sub {
                return $_[0]->{'sound'};
            }
        };

        my $call = sub {
            my $this = $_[0];
            my $proc = $_[1];

            if (exists $this->{$proc}) {
                return $this->{$proc}->();
            } else {
                return $this->{prototype}->{$proc}->($this, $proc);
            }
        };

        return sub {
            my $name = $_[0]->{name};
            my $sound = $_[0]->{sound};

            my $this = { 
                'this' => $this,
                'name' => $name,
                'sound' => $sound,
                'prototype' => $AnimalPrototype,
                'call' => $call                
            };
        };
    })->();

    my $animal = $Animal->({
        'name' => 'Jeff',
        'sound'=> 'bark'
    });
    print($animal->{call}($animal, 'performSound'));
})->(); 
```

无论如何，希望有人会发现这篇文章很有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-11-21T08:51:55.567

内部特别区分`bless`-ed 引用的是`SV` for 引用（存储在标量中）获取一个`FLAGS`附加值（`OBJECT`），以及`STASH`带有包名称的 a （有一些其他区别）

```
perl -MDevel::Peek -wE'
    package Pack  { sub func { return { a=>1 } } }; 
    package Class { sub new  { return bless { A=>10 } } }; 
    $vp  = Pack::func(); print Dump $vp;   say"---"; 
    $obj = Class->new;   print Dump $obj' 
```

印刷品，相同的（与此无关的）部分被抑制

```
SV = IV(0x12d5530) at 0x12d5540
  REFCNT = 1
  FLAGS = (ROK)
  RV = 0x12a5a68
  SV = PVHV(0x12ab980) at 0x12a5a68
    REFCNT = 1
    FLAGS = (SHAREKEYS)
    ...
      SV = IV(0x12a5ce0) at 0x12a5cf0
      REFCNT = 1
      FLAGS = (IOK,pIOK)
      IV = 1
---
SV = IV(0x12cb8b8) at 0x12cb8c8
  REFCNT = 1
  FLAGS = (PADMY,ROK)
  RV = 0x12c26b0
  SV = PVHV(0x12aba00) at 0x12c26b0
    REFCNT = 1
    FLAGS = (OBJECT,SHAREKEYS)
    STASH = 0x12d5300   "Class"
    ...
      SV = IV(0x12c26b8) at 0x12c26c8
      REFCNT = 1
      FLAGS = (IOK,pIOK)
      IV = 10 
```

这样，口译员就知道

*   这是一个对象

*   它属于什么包

这通知了它的使用。

例如，当遇到对该变量的取消引用时（`$obj->name`），在包（或层次结构）中寻找具有该名称的子，将对象作为第一个参数传递等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-05T10:59:32.133

我按照这个思路来指导开发面向对象的Perl。

Bless 将任何数据结构引用与类相关联。鉴于 Perl 如何创建继承结构（在一种树中），很容易利用对象模型来创建用于组合的对象。

对于我们称为对象的这种关联，开发时始终牢记对象的内部状态和类行为是分开的。您可以祝福/允许任何数据引用使用任何包/类行为。由于包可以理解对象的“情绪”状态。

* * *

## 回答 #8

> 赞同：-9
> 
> 时间：2011-06-16T05:39:25.810

例如，如果您确信任何 Bug 对象都将是一个祝福哈希，那么您可以（终于！）在 Bug::print_me 方法中填写缺失的代码：

```
 package Bug;
 sub print_me
 {
     my ($self) = @_;
     print "ID: $self->{id}\n";
     print "$self->{descr}\n";
     print "(Note: problem is fatal)\n" if $self->{type} eq "fatal";
 } 
```

现在，每当 print_me 方法通过对已被祝福到 Bug 类中的任何哈希的引用来调用时，$self 变量都会提取作为第一个参数传递的引用，然后打印语句访问祝福哈希的各个条目。

# c++ - 您将如何列出已编译库中包含的可用函数等？

> ID：392142
> 
> 赞同：14
> 
> 时间：2008-12-24T19:53:35.870
> 
> 标签：c++, linker, ld

如何确定函数是否存在于库中，或列出已编译库中的函数？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-24T20:00:29.710

您可以使用[nm](http://unixhelp.ed.ac.uk/CGI/man-cgi?nm)命令列出静态库中的符号。

```
nm -g -C <libMylib.a> 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-24T20:08:06.010

对于 ELF 二进制文件，您可以使用 readelf：

```
readelf -sW a.out | awk '$4 == "FUNC"' | c++filt 
```

`-s`: 列出符号 `-W`: 不要剪太长的名字

然后 awk 命令将过滤掉所有函数，而 c++filt 将解开它们。这意味着它将从内部命名方案转换它们，以便它们以人类可读的形式显示。它输出与此类似的名称（取自 boost.filesystem lib）：

```
285: 0000bef0    91 FUNC    WEAK   DEFAULT   11 boost::exception::~exception() 
```

没有 c++filt，名称显示为`_ZN5boost9exceptionD0Ev`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-24T20:21:09.027

对于 Microsoft 工具，“ `link /dump /symbols <filename>`”将为您提供血淋淋的细节。可能还有其他方法（或选项）可以提供更易于阅读的列表。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-24T20:02:48.923

在 Linux/Unix 下，您可以使用`objdump -T`列出给定对象中包含的导出符号。在 Windows 下有`dumpbin`(IIRC `dumpbin /exports`)。请注意，为了允许重载，对 C++ 函数名称进行了修改。

编辑：在看到 codelogic 的[anwser](https://stackoverflow.com/questions/392142/how-would-you-list-the-available-functions-etc-contained-within-a-compiled-libr#392148)之后，我记得 objdump 也理解 -C 来执行 de-mangling。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-24T20:00:58.147

使用这个命令：

objdump -t "你的库"

它会打印比你想要的更多的东西——不仅仅是函数名，而是整个符号表。检查你得到的符号的各种属性，你将能够从变量和东西中整理出函数。

# .net - 在 Web 主机上安装和运行 .NET Windows 服务

> ID：392153
> 
> 赞同：3
> 
> 时间：2008-12-24T20:04:58.403
> 
> 标签：.net, windows-services, web-hosting, installutil

我已经在 J​​OS-.NET 板上问过这个问题，但 Joel 正在关闭该板，所以又来了：

网络托管服务提供商是否允许您安装 Windows 服务？我想玩一些自动化的东西，我目前可以在我自己的开发电脑上做得很好，但我想开始向公众开放这些东西。但是，Web 主机是否允许您运行 installutil.exe？

如果有人有这方面的经验，请告诉我。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T20:15:35.920

不，99% 的托管服务提供商（至少对于共享托管环境）不允许您安装 Windows 服务来增强您的网站功能。

如果您使用的是 VPS 或专用设置，并且可以访问机器的远程桌面，那么可以，您可以。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T20:12:50.213

您在 ASP.NET 中寻找的是后台进程。这是一个作为单独线程实现的进程，您将存储在 Application 对象中。

一般来说，不建议这样做，因为它不能很好地扩展。它将与 IIS/ASP.NET 进程竞争资源。

谷歌它以获取更多信息->[谷歌搜索](http://www.google.com.mx/search?hl=es&q=aps.net+implementing+a+background+process&btnG=Buscar&meta=)。

编辑：正如其他人所说。通常 ISP 不会让您安装服务应用程序。使用后台进程是这些情况的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T23:43:50.210

感谢米切尔和 vmarquez。

我发现这一轮是关于[实现服务](https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/)的方式，但不必实际安装服务。

但是，它在实现上有点古怪，所以我可能会去尝试 VPS/专用路由。

# python - 元类有哪些（具体）用例？

> ID：392160
> 
> 赞同：144
> 
> 时间：2008-12-24T20:13:06.173
> 
> 标签：python, metaclass

我有一个朋友喜欢使用元类，并定期提供它们作为解决方案。

我认为您几乎不需要使用元类。为什么？因为我认为如果你对一个类做这样的事情，你可能应该对一个对象做这样的事情。一个小的重新设计/重构是有序的。

能够使用元类导致很多地方的很多人将类用作某种二流对象，这对我来说似乎是灾难性的。编程会被元编程取代吗？不幸的是，类装饰器的添加使它更容易被接受。

所以，我很想知道你在 Python 中元类的有效（具体）用例。或者了解为什么变异类有时比变异对象更好。

我将开始：

> 有时在使用第三方库时，能够以某种方式改变类是很有用的。

（这是我能想到的唯一案例，并不具体）

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2015-06-25T22:26:32.893

我最近被问到同样的问题，并想出了几个答案。我希望恢复这个线程是可以的，因为我想详细说明一些提到的用例，并添加一些新的用例。

我见过的大多数元类都做以下两件事之一：

1.  注册（向数据结构添加类）：

    ```
    models = {}

    class ModelMetaclass(type):
        def __new__(meta, name, bases, attrs):
            models[name] = cls = type.__new__(meta, name, bases, attrs)
            return cls

    class Model(object):
        __metaclass__ = ModelMetaclass 
    ```

    每当您创建 subclass`Model`时，您的类都会在`models`字典中注册：

    ```
    >>> class A(Model):
    ...     pass
    ...
    >>> class B(A):
    ...     pass
    ...
    >>> models
    {'A': <__main__.A class at 0x...>,
     'B': <__main__.B class at 0x...>} 
    ```

    这也可以使用类装饰器来完成：

    ```
    models = {}

    def model(cls):
        models[cls.__name__] = cls
        return cls

    @model
    class A(object):
        pass 
    ```

    或使用显式注册功能：

    ```
    models = {}

    def register_model(cls):
        models[cls.__name__] = cls

    class A(object):
        pass

    register_model(A) 
    ```

    实际上，这几乎是一样的：你不喜欢提到类装饰器，但它实际上只不过是类上函数调用的语法糖，所以它没有什么神奇之处。

    无论如何，在这种情况下，元类的优点是继承，因为它们适用于任何子类，而其他解决方案仅适用于显式修饰或注册的子类。

    ```
    >>> class B(A):
    ...     pass
    ...
    >>> models
    {'A': <__main__.A class at 0x...> # No B :( 
    ```

2.  重构（修改类属性或添加新属性）：

    ```
    class ModelMetaclass(type):
        def __new__(meta, name, bases, attrs):
            fields = {}
            for key, value in attrs.items():
                if isinstance(value, Field):
                    value.name = '%s.%s' % (name, key)
                    fields[key] = value
            for base in bases:
                if hasattr(base, '_fields'):
                    fields.update(base._fields)
            attrs['_fields'] = fields
            return type.__new__(meta, name, bases, attrs)

    class Model(object):
        __metaclass__ = ModelMetaclass 
    ```

    每当您对`Model`某些属性进行子类化和定义`Field`时，它们都会被注入它们的名称（例如，用于获取更多信息的错误消息），并分组到一个`_fields`字典中（以便于迭代，而无需查看所有类属性及其所有基类）每次属性）：

    ```
    >>> class A(Model):
    ...     foo = Integer()
    ...
    >>> class B(A):
    ...     bar = String()
    ...
    >>> B._fields
    {'foo': Integer('A.foo'), 'bar': String('B.bar')} 
    ```

    同样，这可以通过类装饰器来完成（无需继承）：

    ```
    def model(cls):
        fields = {}
        for key, value in vars(cls).items():
            if isinstance(value, Field):
                value.name = '%s.%s' % (cls.__name__, key)
                fields[key] = value
        for base in cls.__bases__:
            if hasattr(base, '_fields'):
                fields.update(base._fields)
        cls._fields = fields
        return cls

    @model
    class A(object):
        foo = Integer()

    class B(A):
        bar = String()

    # B.bar has no name :(
    # B._fields is {'foo': Integer('A.foo')} :( 
    ```

    或明确：

    ```
    class A(object):
        foo = Integer('A.foo')
        _fields = {'foo': foo} # Don't forget all the base classes' fields, too! 
    ```

    虽然，与您提倡可读和可维护的非元编程相反，这更加麻烦、冗余和容易出错：

    ```
    class B(A):
        bar = String()

    # vs.

    class B(A):
        bar = String('bar')
        _fields = {'B.bar': bar, 'A.foo': A.foo} 
    ```

考虑了最常见和最具体的用例，您绝对必须使用元类的唯一情况是当您想要修改类名或基类列表时，因为一旦定义，这些参数就会被烘焙到类中，并且没有装饰器或函数可以解开它们。

```
class Metaclass(type):
    def __new__(meta, name, bases, attrs):
        return type.__new__(meta, 'foo', (int,), attrs)

class Baseclass(object):
    __metaclass__ = Metaclass

class A(Baseclass):
    pass

class B(A):
    pass

print A.__name__ # foo
print B.__name__ # foo
print issubclass(B, A)   # False
print issubclass(B, int) # True 
```

这在定义具有相似名称或不完整继承树的类时发出警告的框架中可能很有用，但我想不出除了拖钓之外实际更改这些值的原因。也许大卫比兹利可以。

无论如何，在 Python 3 中，元类也有`__prepare__`方法，它可以让你将类主体评估为 a 以外的映射`dict`，从而支持有序属性、重载属性和其他邪恶的酷东西：

```
import collections

class Metaclass(type):

    @classmethod
    def __prepare__(meta, name, bases, **kwds):
        return collections.OrderedDict()

    def __new__(meta, name, bases, attrs, **kwds):
        print(list(attrs))
        # Do more stuff...

class A(metaclass=Metaclass):
    x = 1
    y = 2

# prints ['x', 'y'] rather than ['y', 'x'] 
```

```
class ListDict(dict):
    def __setitem__(self, key, value):
        self.setdefault(key, []).append(value)

class Metaclass(type):

    @classmethod
    def __prepare__(meta, name, bases, **kwds):
        return ListDict()

    def __new__(meta, name, bases, attrs, **kwds):
        print(attrs['foo'])
        # Do more stuff...

class A(metaclass=Metaclass):

    def foo(self):
        pass

    def foo(self, x):
        pass

# prints [<function foo at 0x...>, <function foo at 0x...>] rather than <function foo at 0x...> 
```

您可能会争辩说可以使用创建计数器来实现有序属性，并且可以使用默认参数模拟重载：

```
import itertools

class Attribute(object):
    _counter = itertools.count()
    def __init__(self):
        self._count = Attribute._counter.next()

class A(object):
    x = Attribute()
    y = Attribute()

A._order = sorted([(k, v) for k, v in vars(A).items() if isinstance(v, Attribute)],
                  key = lambda (k, v): v._count) 
```

```
class A(object):

    def _foo0(self):
        pass

    def _foo1(self, x):
        pass

    def foo(self, x=None):
        if x is None:
            return self._foo0()
        else:
            return self._foo1(x) 
```

除了更难看之外，它也不太灵活：如果你想要有序的文字属性，比如整数和字符串怎么办？如果`None`是一个有效值`x`怎么办？

这是解决第一个问题的创造性方法：

```
import sys

class Builder(object):
    def __call__(self, cls):
        cls._order = self.frame.f_code.co_names
        return cls

def ordered():
    builder = Builder()
    def trace(frame, event, arg):
        builder.frame = frame
        sys.settrace(None)
    sys.settrace(trace)
    return builder

@ordered()
class A(object):
    x = 1
    y = 'foo'

print A._order # ['x', 'y'] 
```

这是解决第二个问题的一种创造性方法：

```
_undefined = object()

class A(object):

    def _foo0(self):
        pass

    def _foo1(self, x):
        pass

    def foo(self, x=_undefined):
        if x is _undefined:
            return self._foo0()
        else:
            return self._foo1(x) 
```

但这比一个简单的元类（尤其是第一个，它真的融化你的大脑）要多得多。我的观点是，您将元类视为不熟悉且违反直觉的，但您也可以将它们视为编程语言发展的下一步：您只需要调整自己的心态。毕竟，您可能可以在 C 中做所有事情，包括定义一个带有函数指针的结构并将其作为第一个参数传递给它的函数。第一次看到 C++ 的人可能会说，“这是什么魔法？为什么编译器会隐式传递`this`到方法，而不是常规和静态函数？最好对你的论点保持明确和详细”。但是，一旦你掌握了面向对象编程，它就会变得更加强大；这也是如此，呃......我猜是准面向方面的编程。一旦你了解元类，它们实际上非常简单，那么为什么不在方便的时候使用它们呢？

最后，元类很受欢迎，编程应该很有趣。一直使用标准的编程结构和设计模式既乏味又乏味，还会阻碍您的想象力。坚持一下！这是一个元元类，专为您准备。

```
class MetaMetaclass(type):
    def __new__(meta, name, bases, attrs):
        def __new__(meta, name, bases, attrs):
            cls = type.__new__(meta, name, bases, attrs)
            cls._label = 'Made in %s' % meta.__name__
            return cls 
        attrs['__new__'] = __new__
        return type.__new__(meta, name, bases, attrs)

class China(type):
    __metaclass__ = MetaMetaclass

class Taiwan(type):
    __metaclass__ = MetaMetaclass

class A(object):
    __metaclass__ = China

class B(object):
    __metaclass__ = Taiwan

print A._label # Made in China
print B._label # Made in Taiwan 
```

# 编辑

这是一个很老的问题，但它仍然得到了支持，所以我想我会添加一个链接到更全面的答案。如果您想了解更多关于元类及其用途的信息，我刚刚在[此处](https://medium.com/@dan.gittik/metaphysics-2036b38fa711)发表了一篇关于它的文章。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-12-24T21:43:05.087

元类的目的不是用元类/类替换类/对象的区别——它是以某种方式改变类定义（以及它们的实例）的行为。实际上，它是以对您的特定域比默认更有用的方式改变类语句的行为。我用它们做的事情是：

*   跟踪子类，通常用于注册处理程序。这在使用插件样式设置时很方便，您希望通过子类化和设置一些类属性来为特定事物注册处理程序。例如。假设您为各种音乐格式编写了一个处理程序，其中每个类都为其类型实现了适当的方法（播放/获取标签等）。为新类型添加处理程序变为：

    ```
    class Mp3File(MusicFile):
        extensions = ['.mp3']  # Register this type as a handler for mp3 files
        ...
        # Implementation of mp3 methods go here 
    ```

    然后元类维护一个`{'.mp3' : MP3File, ... }`etc 的字典，并在您通过工厂函数请求处理程序时构造一个适当类型的对象。

*   改变行为。您可能希望为某些属性附加特殊含义，从而在它们存在时改变行为。例如，您可能希望查找具有名称的方法`_get_foo`并将`_set_foo`它们透明地转换为属性。作为一个真实的例子，[这是](http://code.activestate.com/recipes/498149/)我写的一个配方，用于提供更多类似 C 的结构定义。元类用于将声明的项转换为结构格式字符串，处理继承等，并生成一个能够处理它的类。

    对于其他实际示例，请查看各种 ORM，例如 sqlalchemy[的](http://www.sqlalchemy.org/)ORM 或[sqlobject](http://www.sqlobject.org/)。同样，目的是解释具有特定含义的定义（此处为 SQL 列定义）。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-26T01:35:56.520

我有一个处理非交互式绘图的类，作为 Matplotlib 的前端。然而，有时人们想做交互式绘图。我发现只有几个函数可以增加图形计数、手动调用绘图等，但我需要在每次绘图调用之前和之后执行这些操作。因此，要创建交互式绘图包装器和屏幕外绘图包装器，我发现通过元类包装适当的方法比执行以下操作更有效：

```
class PlottingInteractive:
    add_slice = wrap_pylab_newplot(add_slice) 
```

此方法跟不上 API 更改等，但是`__init__`在重新设置类属性之前迭代类属性的方法更有效并保持最新：

```
class _Interactify(type):
    def __init__(cls, name, bases, d):
        super(_Interactify, cls).__init__(name, bases, d)
        for base in bases:
            for attrname in dir(base):
                if attrname in d: continue # If overridden, don't reset
                attr = getattr(cls, attrname)
                if type(attr) == types.MethodType:
                    if attrname.startswith("add_"):
                        setattr(cls, attrname, wrap_pylab_newplot(attr))
                    elif attrname.startswith("set_"):
                        setattr(cls, attrname, wrap_pylab_show(attr)) 
```

当然，可能有更好的方法来做到这一点，但我发现这是有效的。当然，这也可以在`__new__`or中完成`__init__`，但这是我发现的最直接的解决方案。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-12-25T02:23:47.610

让我们从 Tim Peter 的经典名言开始：

> 元类是比 99% 的用户所担心的更深层次的魔法。如果你想知道你是否需要它们，你就不需要（真正需要它们的人肯定知道他们需要它们，并且不需要解释为什么）。蒂姆·彼得斯 (clp post 2002-12-22)

话虽如此，我（定期）遇到了元类的真正用途。想到的是在 Django 中，所有模型都继承自 models.Model。反过来，models.Model 用 Django 的 ORM 特性包装了你的 DB 模型。这种神奇是通过元类发生的。它创建各种异常类、管理器类等。

见 django/db/models/base.py, class ModelBase() 为故事的开始。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-08-14T14:49:02.157

元类使用的合理模式是在定义类时做某事，而不是在实例化同一个类时重复。

当多个类共享相同的特殊行为时，重复`__metaclass__=X`显然比重复专用代码和/或引入临时共享超类更好。

但是，即使只有一个特殊类且没有可预见的扩展， 元类`__new__`也是`__init__`一种初始化类变量或其他全局数据的更干净的方法，而不是在类定义主体中混合专用代码和普通`def`和`class`语句。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-24T22:54:53.117

元类可以方便地在 Python 中构建领域特定语言。具体的例子是 Django，SQLObject 的数据库模式的声明性语法。

Ian Bicking的[A Conservative Metaclass](http://blog.ianbicking.org/a-conservative-metaclass.html)中的一个基本示例：

> 我使用的元类主要是为了支持一种声明式的编程风格。例如，考虑一个验证模式：

```
class Registration(schema.Schema):
    first_name = validators.String(notEmpty=True)
    last_name = validators.String(notEmpty=True)
    mi = validators.MaxLength(1)
    class Numbers(foreach.ForEach):
        class Number(schema.Schema):
            type = validators.OneOf(['home', 'work'])
            phone_number = validators.PhoneNumber() 
```

其他一些技术：[在 Python 中构建 DSL 的成分](http://web.archive.org/web/20091229094610/http://media.brianbeck.com/files/Python_DSLs_I.pdf)(pdf)。

编辑（由 Ali）：我更喜欢使用集合和实例执行此操作的示例。重要的事实是实例，它给你更多的权力，并消除使用元类的理由。进一步值得注意的是，您的示例混合使用了类和实例，这肯定表明您不能只使用元类来完成所有操作。并创建了一种真正不统一的方式。

```
number_validator = [
    v.OneOf('type', ['home', 'work']),
    v.PhoneNumber('phone_number'),
]

validators = [
    v.String('first_name', notEmpty=True),
    v.String('last_name', notEmpty=True),
    v.MaxLength('mi', 1),
    v.ForEach([number_validator,])
] 
```

它并不完美，但已经几乎为零魔法，不需要元类，并且提高了一致性。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-28T03:20:15.823

我昨天也在想同样的事情，完全同意。在我看来，由于试图使其更具声明性而导致的代码复杂性通常会使代码库更难维护、更难阅读并且更少 Pythonic。它通常还需要大量的 copy.copy()ing（以保持继承并从类复制到实例），这意味着您必须查看许多地方以查看发生了什么（总是从元类向上查看），这与蟒纹也。我一直在挑选 formencode 和 sqlalchemy 代码，看看这种声明式风格是否值得，但显然不值得。这种风格应该留给描述符（例如属性和方法）和不可变数据。Ruby 对这种声明式风格有更好的支持，我很高兴核心 python 语言没有走这条路。

我可以看到它们用于调试，向所有基类添加元类以获得更丰富的信息。我还看到它们仅在（非常）大型项目中使用以摆脱一些样板代码（但失去了清晰度）。[例如](http://www.sqlalchemy.org/trac/browser/sqlalchemy/trunk/lib/sqlalchemy/sql/visitors.py)， sqlalchemy确实在其他地方使用它们，根据类定义中的属性值向所有子类添加特定的自定义方法，例如玩具示例

```
class test(baseclass_with_metaclass):
    method_maker_value = "hello" 
```

可以有一个元类，它在该类中生成一个具有基于“hello”的特殊属性的方法（比如一个在字符串末尾添加“hello”的方法）。确保您不必在创建的每个子类中都编写方法可能对可维护性有好处，而您只需定义 method_maker_value。

对此的需求是如此罕见，并且只减少了一点打字，除非你有足够大的代码库，否则它并不值得考虑。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-24T21:19:39.847

我唯一一次在 Python 中使用元类是在为 Flickr API 编写包装器时。

我的目标是抓取[flickr 的 api 站点](http://www.flickr.com/services/api/)并动态生成完整的类层次结构以允许使用 Python 对象进行 API 访问：

```
# Both the photo type and the flickr.photos.search API method 
# are generated at "run-time"
for photo in flickr.photos.search(text=balloons):
    print photo.description 
```

所以在那个例子中，因为我从网站生成了整个 Python Flickr API，所以我真的不知道运行时的类定义。能够动态生成类型非常有用。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-24T22:15:22.353

元类并没有取代编程！它们只是一种可以使某些任务自动化或更优雅的技巧。一个很好的例子是[Pygments](http://pygments.org/)语法高亮库。它有一个名为的类`RegexLexer`，它允许用户将一组词法规则定义为类上的正则表达式。元类用于将定义转换为有用的解析器。

它们就像盐；它很容易使用太多。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-24T21:17:25.717

您永远*不需要*使用元类，因为您始终可以使用要修改的类的继承或聚合来构造一个执行您想要的操作的类。

也就是说，在 Smalltalk 和 Ruby 中修改现有类可能非常方便，但 Python 不喜欢直接这样做。

有一篇关于 Python 元类化的优秀[DeveloperWorks 文章可能会有所帮助。](https://web.archive.org/web/20130716222859/http://www.ibm.com:80/developerworks/linux/library/l-pymeta/index.html)维基[百科的文章](http://en.wikipedia.org/wiki/Metaclass)也很不错。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-03-16T19:13:50.780

元类的唯一合法用例是防止其他爱管闲事的开发人员接触您的代码。一旦一个爱管闲事的开发人员掌握了元类并开始使用你的元类，再增加一两个级别以将它们排除在外。如果这不起作用，请开始使用`type.__new__`或使用递归元类的某种方案。

（写在脸颊上，但我见过这种混淆。Django 就是一个很好的例子）

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-06-04T19:29:42.267

当多个线程尝试与它们交互时，一些 GUI 库会出现问题。`tkinter`就是这样一个例子；虽然可以明确地处理事件和队列的问题，但以一种完全忽略问题的方式使用库会简单得多。看哪——元类的魔力。

在某些情况下，能够无缝地动态重写整个库以使其在多线程应用程序中按预期正常工作可能非常有用。[safetkinter](http://code.activestate.com/recipes/578153/)模块在[threadbox](http://code.activestate.com/recipes/578152/)模块提供的元类的帮助下做到这一点——不需要事件和队列。

一个简洁的方面`threadbox`是它不关心它克隆什么类。它提供了一个示例，说明如果需要，元类如何触及所有基类。元类带来的另一个好处是它们也可以在继承类上运行。自己编写的程序——为什么不呢？

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-12-25T11:47:43.557

我使用元类的方式是为类提供一些属性。举个例子：

```
class NameClass(type):
    def __init__(cls, *args, **kwargs):
       type.__init__(cls, *args, **kwargs)
       cls.name = cls.__name__ 
```

将*name*属性放在每个将元类设置为指向 NameClass 的类上。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-08-14T16:44:08.423

这是一个小用途，但是......我发现元类有用的一件事是在创建子类时调用一个函数。我将其编入一个查找`__initsubclass__`属性的元类：每当创建子类时，定义该方法的所有父类都使用`__initsubclass__(cls, subcls)`. 这允许创建一个父类，然后使用某个全局注册表注册所有子类，在定义子类时对子类运行不变检查，执行后期绑定操作等......所有这些都无需手动调用函数*或*创建自定义元类履行这些单独的职责。

请注意，我已经慢慢意识到这种行为的隐含魔法有些不可取，因为如果脱离上下文查看类定义是出乎意料的......所以我已经不再使用该解决方案来解决任何严重问题`__super`为每个类和实例初始化一个属性。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-11-08T17:59:56.063

我最近不得不使用一个元类来帮助围绕一个数据库表以声明方式定义一个 SQLAlchemy 模型，该数据库表填充了来自[http://census.ire.org/data/bulkdata.html的美国人口普查数据](http://census.ire.org/data/bulkdata.html)

IRE 为人口普查数据表提供[数据库外壳](https://github.com/ireapps/census/tree/master/tools/sql/ire_export)，这些外壳按照人口普查局 p012015、p012016、p012017 等的命名约定创建整数列。

我想 a) 能够使用`model_instance.p012017`语法访问这些列，b) 相当明确地说明我在做什么，并且 c) 不必在模型上显式定义数十个字段，因此我将 SQLAlchemy 子类`DeclarativeMeta`化以遍历一系列列并自动创建与列对应的模型字段：

```
from sqlalchemy.ext.declarative.api import DeclarativeMeta

class CensusTableMeta(DeclarativeMeta):
    def __init__(cls, classname, bases, dict_):
        table = 'p012'
        for i in range(1, 49):
            fname = "%s%03d" % (table, i)
            dict_[fname] = Column(Integer)
            setattr(cls, fname, dict_[fname])

        super(CensusTableMeta, cls).__init__(classname, bases, dict_) 
```

然后我可以将这个元类用于我的模型定义并访问模型上的自动枚举字段：

```
CensusTableBase = declarative_base(metaclass=CensusTableMeta)

class P12Tract(CensusTableBase):
    __tablename__ = 'ire_p12'

    geoid = Column(String(12), primary_key=True)

    @property
    def male_under_5(self):
        return self.p012003

    ... 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-05-25T08:44:58.130

[这里](http://www.jesshamrick.com/2013/04/17/rewriting-python-docstrings-with-a-metaclass/)描述的似乎有一个合法的用途- Rewriting Python Docstrings with a Metaclass。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-05-18T21:53:01.967

[Pydantic](https://pydantic-docs.helpmanual.io/)是一个用于数据验证和设置管理的库，它在运行时强制执行类型提示，并在数据无效时提供用户友好的错误。它利用元类进行 BaseModel 和数字范围验证。

在工作中，我遇到了一些代码，该代码的进程具有由类定义的多个阶段。这些步骤的顺序由元类控制，这些元类在定义类时将这些步骤添加到列表中。这被扔掉了，并通过将它们添加到列表中来设置顺序。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-09-02T12:47:37.237

我不得不将它们用于二进制解析器以使其更易于使用。您定义一个消息类，其中包含在线路上存在的字段的属性。需要按照声明的方式对它们进行排序，以便从中构造最终的电汇格式。如果您使用有序的命名空间字典，您可以使用元类来做到这一点。事实上，它在 Metaclasses 的示例中：

[https://docs.python.org/3/reference/datamodel.html#metaclass-example](https://docs.python.org/3/reference/datamodel.html#metaclass-example)

但总的来说：非常仔细地评估，如果你真的需要增加元类的复杂性。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-07-23T11:58:26.853

@Dan Gittik 的回答很酷

最后的例子可以澄清很多事情，我把它改成python 3并给出一些解释：

```
class MetaMetaclass(type):
    def __new__(meta, name, bases, attrs):
        def __new__(meta, name, bases, attrs):
            cls = type.__new__(meta, name, bases, attrs)
            cls._label = 'Made in %s' % meta.__name__
            return cls

        attrs['__new__'] = __new__
        return type.__new__(meta, name, bases, attrs)

#China is metaclass and it's __new__ method would be changed by MetaMetaclass(metaclass)
class China(MetaMetaclass, metaclass=MetaMetaclass):
    __metaclass__ = MetaMetaclass

#Taiwan is metaclass and it's __new__ method would be changed by MetaMetaclass(metaclass)
class Taiwan(MetaMetaclass, metaclass=MetaMetaclass):
    __metaclass__ = MetaMetaclass

#A is a normal class and it's __new__ method would be changed by China(metaclass)
class A(metaclass=China):
    __metaclass__ = China

#B is a normal class and it's __new__ method would be changed by Taiwan(metaclass)
class B(metaclass=Taiwan):
    __metaclass__ = Taiwan

print(A._label)  # Made in China
print(B._label)  # Made in Taiwan 
```

*   一切都是对象，所以类是对象
*   类对象由元类创建
*   从 type 继承的所有类都是元类
*   元类可以控制类创建
*   元类也可以控制元类的创建（因此它可以永远循环）
*   这是元编程......你可以在运行时控制类型系统
*   再次，一切都是对象，这是一个统一的系统，类型创建类型，类型创建实例

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-08-17T20:53:15.887

另一个用例是当您希望能够修改类级属性并确保它只影响手头的对象时。在实践中，这意味着“合并”元类和类实例化的阶段，从而导致您只处理它们自己（唯一）种类的类实例。

当（出于[可读性](https://zen-of-python.info/readability-counts.html)和[多态性](https://stackify.com/oop-concept-polymorphism/)的考虑）我们想要***动态定义*** [`property`](https://stackoverflow.com/questions/17330160/how-does-the-property-decorator-work)s时，我也必须这样*做*，*即*在元类实例化之后和类实例化之前。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-11-20T14:42:36.927

我知道这是一个老问题，但是如果只想基于传递给构造函数的参数创建一个类的单个实例，这里有一个非常宝贵的用例。

实例单例 我使用此代码在 Z-Wave 网络上创建设备的单例实例。无论我创建实例多少次，如果将相同的值传递给构造函数，如果存在具有完全相同值的实例，那么这就是返回的内容。

```
import inspect

class SingletonMeta(type):
    # only here to make IDE happy
    _instances = {}

    def __init__(cls, name, bases, dct):
        super(SingletonMeta, cls).__init__(name, bases, dct)
        cls._instances = {}

    def __call__(cls, *args, **kwargs):
        sig = inspect.signature(cls.__init__)
        keywords = {}

        for i, param in enumerate(list(sig.parameters.values())[1:]):
            if len(args) > i:
                keywords[param.name] = args[i]
            elif param.name not in kwargs and param.default != param.empty:
                keywords[param.name] = param.default
            elif param.name in kwargs:
                keywords[param.name] = kwargs[param.name]
        key = []
        for k in sorted(list(keywords.keys())):
            key.append(keywords[k])
        key = tuple(key)

        if key not in cls._instances:
            cls._instances[key] = (
                super(SingletonMeta, cls).__call__(*args, **kwargs)
            )

        return cls._instances[key]

class Test1(metaclass=SingletonMeta):

    def __init__(self, param1, param2='test'):
        pass

class Test2(metaclass=SingletonMeta):

    def __init__(self, param3='test1', param4='test2'):
        pass

test1 = Test1('test1')
test2 = Test1('test1', 'test2')
test3 = Test1('test1', 'test')

test4 = Test2()
test5 = Test2(param4='test1')
test6 = Test2('test2', 'test1')
test7 = Test2('test1')

print('test1 == test2:', test1 == test2)
print('test2 == test3:', test2 == test3)
print('test1 == test3:', test1 == test3)
print('test4 == test2:', test4 == test2)
print('test7 == test3:', test7 == test3)
print('test6 == test4:', test6 == test4)
print('test7 == test4:', test7 == test4)
print('test5 == test6:', test5 == test6)

print('number of Test1 instances:', len(Test1._instances))
print('number of Test2 instances:', len(Test2._instances)) 
```

输出

```
test1 == test2: False
test2 == test3: False
test1 == test3: True
test4 == test2: False
test7 == test3: False
test6 == test4: False
test7 == test4: True
test5 == test6: False
number of Test1 instances: 2
number of Test2 instances: 3 
```

现在有人可能会说它可以在不使用元类的情况下完成，我知道如果 __init__ 方法被修饰就可以完成。我不知道另一种方法。下面的代码虽然将返回一个包含所有相同数据的类似实例，但它不是单例实例，但会创建一个新实例。因为它创建了一个具有相同数据的新实例，所以需要采取额外的步骤来检查实例的相等性。最后，它比使用元类消耗更多的内存，并且使用元类不需要采取额外的步骤来检查相等性。

```
class Singleton(object):
    _instances = {}

    def __init__(self, param1, param2='test'):
        key = (param1, param2)
        if key in self._instances:
            self.__dict__.update(self._instances[key].__dict__)
        else:
            self.param1 = param1
            self.param2 = param2
            self._instances[key] = self

test1 = Singleton('test1', 'test2')
test2 = Singleton('test')
test3 = Singleton('test', 'test')

print('test1 == test2:', test1 == test2)
print('test2 == test3:', test2 == test3)
print('test1 == test3:', test1 == test3)

print('test1 params', test1.param1, test1.param2)
print('test2 params', test2.param1, test2.param2)
print('test3 params', test3.param1, test3.param2)

print('number of Singleton instances:', len(Singleton._instances)) 
```

输出

```
test1 == test2: False
test2 == test3: False
test1 == test3: False
test1 params test1 test2
test2 params test test
test3 params test test
number of Singleton instances: 2 
```

如果还需要检查新实例的删除或添加，元类方法非常好用。

```
 import inspect

class SingletonMeta(type):
    # only here to make IDE happy
    _instances = {}

    def __init__(cls, name, bases, dct):
        super(SingletonMeta, cls).__init__(name, bases, dct)
        cls._instances = {}

    def __call__(cls, *args, **kwargs):
        sig = inspect.signature(cls.__init__)
        keywords = {}

        for i, param in enumerate(list(sig.parameters.values())[1:]):
            if len(args) > i:
                keywords[param.name] = args[i]
            elif param.name not in kwargs and param.default != param.empty:
                keywords[param.name] = param.default
            elif param.name in kwargs:
                keywords[param.name] = kwargs[param.name]
        key = []
        for k in sorted(list(keywords.keys())):
            key.append(keywords[k])
        key = tuple(key)

        if key not in cls._instances:
            cls._instances[key] = (
                super(SingletonMeta, cls).__call__(*args, **kwargs)
            )

        return cls._instances[key]

class Test(metaclass=SingletonMeta):

    def __init__(self, param1, param2='test'):
        pass

instances = []

instances.append(Test('test1', 'test2'))
instances.append(Test('test1', 'test'))

print('number of instances:', len(instances))

instance = Test('test2', 'test3')
if instance not in instances:
    instances.append(instance)

instance = Test('test1', 'test2')
if instance not in instances:
    instances.append(instance)

print('number of instances:', len(instances)) 
```

输出

```
number of instances: 2
number of instances: 3 
```

这是一种在实例不再使用后删除已创建的实例的方法。

```
 import inspect
import weakref

class SingletonMeta(type):
    # only here to make IDE happy
    _instances = {}

    def __init__(cls, name, bases, dct):
        super(SingletonMeta, cls).__init__(name, bases, dct)

        def remove_instance(c, ref):
            for k, v in list(c._instances.items())[:]:
                if v == ref:
                    del cls._instances[k]
                    break

        cls.remove_instance = classmethod(remove_instance)
        cls._instances = {}

    def __call__(cls, *args, **kwargs):
        sig = inspect.signature(cls.__init__)
        keywords = {}

        for i, param in enumerate(list(sig.parameters.values())[1:]):
            if len(args) > i:
                keywords[param.name] = args[i]
            elif param.name not in kwargs and param.default != param.empty:
                keywords[param.name] = param.default
            elif param.name in kwargs:
                keywords[param.name] = kwargs[param.name]
        key = []
        for k in sorted(list(keywords.keys())):
            key.append(keywords[k])
        key = tuple(key)

        if key not in cls._instances:
            instance = super(SingletonMeta, cls).__call__(*args, **kwargs)

            cls._instances[key] = weakref.ref(
                instance,
                instance.remove_instance
            )

        return cls._instances[key]()

class Test1(metaclass=SingletonMeta):

    def __init__(self, param1, param2='test'):
        pass

class Test2(metaclass=SingletonMeta):

    def __init__(self, param3='test1', param4='test2'):
        pass

test1 = Test1('test1')
test2 = Test1('test1', 'test2')
test3 = Test1('test1', 'test')

test4 = Test2()
test5 = Test2(param4='test1')
test6 = Test2('test2', 'test1')
test7 = Test2('test1')

print('test1 == test2:', test1 == test2)
print('test2 == test3:', test2 == test3)
print('test1 == test3:', test1 == test3)
print('test4 == test2:', test4 == test2)
print('test7 == test3:', test7 == test3)
print('test6 == test4:', test6 == test4)
print('test7 == test4:', test7 == test4)
print('test5 == test6:', test5 == test6)

print('number of Test1 instances:', len(Test1._instances))
print('number of Test2 instances:', len(Test2._instances))

print()
del test1
del test5
del test6

print('number of Test1 instances:', len(Test1._instances))
print('number of Test2 instances:', len(Test2._instances)) 
```

输出

```
test1 == test2: False
test2 == test3: False
test1 == test3: True
test4 == test2: False
test7 == test3: False
test6 == test4: False
test7 == test4: True
test5 == test6: False
number of Test1 instances: 2
number of Test2 instances: 3

number of Test1 instances: 2
number of Test2 instances: 1 
```

如果您查看输出，您会注意到 Test1 实例的数量没有改变。那是因为 test1 和 test3 是同一个实例，我只删除了 test1 所以代码中仍然有对 test1 实例的引用，因此 test1 实例没有被删除。

另一个不错的特性是，如果实例仅使用提供的参数来完成它的任务，那么您可以使用元类来促进在完全不同的计算机上或在同一台机器上的不同进程中远程创建实例. 参数可以简单地通过套接字或命名管道传递，并且可以在接收端创建类的副本。

# audio - 播放圣诞曲子的邮政编码

> ID：392169
> 
> 赞同：9
> 
> 时间：2008-12-24T20:19:47.533
> 
> 标签：audio, playback

有没有办法在没有预先录制的声音文件的情况下在 PC 或 Mac 上播放圣诞曲子？（没有 .mp3 或 .wav 或任何声音文件）

我记得在我的 TI 99/4A 和 Apple II 上可以播放声音（类似于音乐）。不确定现代计算机是否具有这些能力（除了*beep*）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-24T21:12:50.500

Java 中的“Jingle Bells”（像往常一样臃肿），使用[JFugue](http://www.jfugue.org/)，带有管状铃铛和木琴（复音！）：

```
import org.jfugue.*;

public class JingleBells
{
    public static void main(String[] args)
    {
        Player player = new Player();
        player.play("T170 "+
                    "     V0 I[XYLOPHONE] C4q C4q C3h C4q C4q C3h C3q B3q A3q G3q C4h "+
                    "     V1 I[TUBULAR_BELLS] E5q E5q E5h E5q E5q E5h E5q G5q C5q D5q Eqh "+
                    "     V2 I[XYLOPHONE] G3h     G2q G3q G3h     G3h");
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-24T22:13:00.270

说到“像哔声一样糟糕”，如果你在你的 linux 机器上安装了[哔声](http://manpages.ubuntu.com/manpages/gutsy/man1/beep.1.html)，你可以运行以下 shell 脚本（与 Jeremy Ruten 的回答相同）：

```
#!/bin/sh
beep -f 659 -l 400
sleep 0.05
beep -f 659 -l 400
sleep 0.05
beep -f 659 -l 800
sleep 0.05
beep -f 659 -l 400
sleep 0.05
beep -f 659 -l 400
sleep 0.05
beep -f 659 -l 800
sleep 0.05
beep -f 659 -l 400
sleep 0.05
beep -f 783 -l 400
sleep 0.05
beep -f 523 -l 400
sleep 0.05
beep -f 587 -l 400
sleep 0.05
beep -f 659 -l 800 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-24T20:27:48.250

是的，你可以玩midi。

Midi 本身不编码声音，它编码用于播放音乐的信息；音高、音调、强度等。

在 codeplex 上有一个 C# midi 工具包：http: [//www.codeproject.com/KB/audio-video/MIDIToolkit.aspx](http://www.codeproject.com/KB/audio-video/MIDIToolkit.aspx)

声音的质量完全取决于用来播放它的 MIDI 设备，因此它的质量会因计算机而异。

您可以在以下位置找到一份不错的圣诞 midi 文件列表：[http ://www.lockergnome.com/midi/](http://www.lockergnome.com/midi/)

Windows Media Player 可以像 Quick Time 一样播放 MIDI 文件（我相信）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-24T20:33:57.770

```
PLAY "e4 e4 e2 e4 e4 e2 e4 g4 c4 d4 e2" 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-24T20:39:56.463

即时生成 PCM 数据怎么样？PCM - 脉冲编码调制 - 声音只是模拟音响系统中的一堆电压样本。

想想扬声器。播放声音时，它会振动。如果你拿尺子以比声音频率更快的速度测量扬声器的位置会怎样？你会得到一张波形图。这正是 PCM 数据的样子，每个测量值都存储为 8 位或 16 位整数。频率，比如 44khz 是每秒的样本数。CD 使用 44khz 采样频率和 16 位采样。

[DirectSound](http://en.wikipedia.org/wiki/DirectSound)（在 Windows 上）和[OpenAL](http://en.wikipedia.org/wiki/OpenAL)（跨平台）是您可以用来播放充满 PCM 数据的数据缓冲区的两个库。我过去使用过 DirectSound，不是播放数据，而是从麦克风读取数据以获取音量。

如果您想为某个音符创建一个 PCM 样本，您只需计算频率（这里有一个[表](http://www.phy.mtu.edu/~suits/notefreqs.html)），然后在缓冲区中放入一个正弦波。您可以通过添加它们来混合不同的频率（确保总和小于最大音量，以避免削波）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-24T20:26:03.510

MIDI 是一种选择，尽管在 PC 上它通常听起来几乎和哔哔声一样糟糕。

# minimization - 如何使用牛顿法找到非线性、多元函数的最小值（代码不是线性代数）

> ID：392173
> 
> 赞同：12
> 
> 时间：2008-12-24T20:23:37.540
> 
> 标签：minimization, newtons-method, nonlinear-functions

我正在尝试进行一些参数估计，并希望选择参数估计，以最小化**大约 30 个变量**的预测方程中的平方误差。如果方程是线性的，我只需计算 30 个偏导数，将它们全部设置为零，然后使用线性方程求解器。但不幸**的是，这个方程是非线性**的，它的导数也是如此。

如果方程超过一个变量，我会使用[牛顿法](http://en.wikipedia.org/wiki/Newton-Raphson#Nonlinear_systems_of_equations)（也称为 Newton-Raphson）。*网络上有丰富的示例和代码来实现单变量函数的*牛顿方法。

鉴于我有大约 30 个变量，**我如何使用牛顿法对这个问题的数值解决方案进行编程**？我有封闭形式的方程，可以计算一阶和二阶导数，但我不知道如何从那里开始。我在网上找到了大量的处理方法，但它们很快就进入了重矩阵符号。我在 Wikipedia 上发现[了一些很有帮助](http://en.wikipedia.org/wiki/Newton-Raphson#Nonlinear_systems_of_equations)的东西，但我在将其翻译成代码时遇到了麻烦。

我担心分解的地方是矩阵代数和矩阵求逆。我可以用线性方程求解器反转矩阵，但我担心得到正确的行和列，避免转置错误等等。

具体来说：

*   我想使用将变量映射到它们的值的表。我可以编写这样一个表的函数，它返回给定这样一个表作为参数的平方误差。我还可以创建返回关于任何给定变量的偏导数的函数。

*   我对表中的值有一个合理的起始估计，所以我不担心收敛。

*   我不确定如何编写使用估计值（每个变量的值表）、函数和偏导函数表来生成新估计值的循环。

最后一个是我想要帮助的。任何直接帮助或指向良好资源的指针都将受到热烈赞赏。

* * *

编辑：由于我有封闭形式的一阶和二阶导数，我想利用它们并避免更慢收敛的方法，如单纯形搜索。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-08T20:42:38.480

数字食谱链接最有帮助。我最终象征性地对我的误差估计进行微分以产生 30 个偏导数，然后使用牛顿法将它们全部设置为零。以下是代码的亮点：

```
__doc.findzero = [[function(functions, partials, point, [epsilon, steps]) returns table, boolean
Where
  point       is a table mapping variable names to real numbers 
              (a point in N-dimensional space)
  functions   is a list of functions, each of which takes a table like
              point as an argument
  partials    is a list of tables; partials[i].x is the partial derivative
              of functions[i] with respect to 'x'
  epilson     is a number that says how close to zero we're trying to get
  steps       is max number of steps to take (defaults to infinity)
  result      is a table like 'point', boolean that says 'converged'
]]

-- See Numerical Recipes in C, Section 9.6 [http://www.nrbook.com/a/bookcpdf.php]

function findzero(functions, partials, point, epsilon, steps)
  epsilon = epsilon or 1.0e-6
  steps = steps or 1/0
  assert(#functions > 0)
  assert(table.numpairs(partials[1]) == #functions,
         'number of functions not equal to number of variables')
  local equations = { }
  repeat
    if Linf(functions, point) <= epsilon then
      return point, true
    end
    for i = 1, #functions do
      local F = functions[i](point)
      local zero = F
      for x, partial in pairs(partials[i]) do
        zero = zero + lineq.var(x) * partial(point)
      end
      equations[i] = lineq.eqn(zero, 0)
    end
    local delta = table.map(lineq.tonumber, lineq.solve(equations, {}).answers)
    point = table.map(function(v, x) return v + delta[x] end, point)
    steps = steps - 1
  until steps <= 0
  return point, false
end

function Linf(functions, point)
  -- distance using L-infinity norm
  assert(#functions > 0)
  local max = 0
  for i = 1, #functions do
    local z = functions[i](point)
    max = math.max(max, math.abs(z))
  end
  return max
end 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T20:34:44.117

您可能可以在 C 网页中的数值食谱中找到您需要的内容。网上有 [免费版本](http://www.nrbook.com/a/bookcpdf.php)。 [这里](http://www.nrbook.com/a/bookcpdf/c9-4.pdf)(PDF) 是包含用 C 实现的 Newton-Raphson 方法的章节。您可能还想查看[Netlib](http://www.netlib.org)中可用的内容（LINPack 等）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-24T20:47:51.517

作为使用牛顿法的替代[方法，Nelder-Mead 的单纯形法](http://en.wikipedia.org/wiki/Nelder-Mead_method)非常适合解决这个问题，并在 C 中的 Numerical Recpies 中引用。

抢

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-16T06:36:58.570

您要求函数最小化算法。有两个主要类：本地和全局。您的问题是最小二乘，因此局部和全局最小化算法都应该收敛到相同的唯一解决方案。局部最小化比全局更有效，所以选择它。

有许多局部最小化算法，但一种特别适合最小二乘问题的算法是[Levenberg-Marquardt](http://www.fizyka.umk.pl/nrbook/c15-5.pdf)。如果您手头没有这样的求解器（例如来自MINPACK），那么您可能可以摆脱牛顿的方法：

```
x <- x - (hessian x)^-1 * grad x 
```

您使用线性求解器计算逆矩阵乘以向量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-08T15:55:38.530

既然你已经有了偏导数，那么一般的梯度下降方法怎么样？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T15:46:19.410

也许你认为你有一个足够好的解决方案，但对我来说，考虑这个问题的最简单方法是先在 1 变量情况下理解它，然后将其扩展到矩阵情况。

在 1 变量的情况下，如果您将一阶导数除以二阶导数，您将获得下一个试验点的（负）步长，例如 -V/A。

在 N 变量的情况下，一阶导数是向量，二阶导数是矩阵（Hessian）。您将导数向量乘以二阶导数的倒数，结果是到下一个试验点的负步进向量，例如 -V*(1/A)

我假设您可以获得二阶导数 Hessian 矩阵。您将需要一个例程来反转它。在各种线性代数包中有很多这样的东西，而且它们的速度非常快。

（不熟悉这个思路的读者，假设两个变量是x和y，曲面是v(x,y)。那么一阶导数就是向量：

```
 V = [ dv/dx, dv/dy ] 
```

二阶导数是矩阵：

```
 A = [dV/dx]
    [dV/dy] 
```

或者：

```
 A = [ d(dv/dx)/dx, d(dv/dy)/dx]
    [ d(dv/dx)/dy, d(dv/dy)/dy] 
```

或者：

```
 A = [d^2v/dx^2, d^2v/dydx]
    [d^2v/dxdy, d^2v/dy^2] 
```

这是对称的。）

如果表面是抛物线（常数二阶导数），它将在 1 步中得到答案。另一方面，如果二阶导数非常不恒定，则可能会遇到振荡。将每一步切成两半（或一小部分）应该使其稳定。

如果 N == 1，您将看到它与 1 变量情况下的作用相同。

祝你好运。

补充：你想要的代码：

```
 double X[N];
// Set X to initial estimate
while(!done){
    double V[N];    // 1st derivative "velocity" vector
    double A[N*N];  // 2nd derivative "acceleration" matrix
    double A1[N*N]; // inverse of A
    double S[N];    // step vector
    CalculateFirstDerivative(V, X);
    CalculateSecondDerivative(A, X);
    // A1 = 1/A
    GetMatrixInverse(A, A1);
    // S = V*(1/A)
    VectorTimesMatrix(V, A1, S);
    // if S is small enough, stop
    // X -= S
    VectorMinusVector(X, S, X);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T18:17:05.377

我的意见是使用随机优化器，例如粒子群方法。

# sql - 查询三组不二等分的数据

> ID：392176
> 
> 赞同：0
> 
> 时间：2008-12-24T20:24:19.597
> 
> 标签：sql, sql-server

我正在检索三组不同的数据（或者应该是“唯一”行）。总的来说，我希望有 3 组不同的唯一行，因为我必须对每组数据完成不同的操作。但是，我检索的行数超过了表中的总行数，这意味着我必须在某处检索重复的行。这是我的三组查询的示例：

```
SELECT DISTINCT t1.*
    FROM table1 t1
    INNER JOIN table2 t2
        ON t2.ID = t1.ID
            AND t2.NAME = t1.NAME
            AND t2.ADDRESS <> t1.ADDRESS

SELECT DISTINCT t1.*
    FROM table1 t1
    INNER JOIN table2 t2
        ON t2.ID = t1.ID
            AND t2.NAME <> t1.NAME
            AND t2.ADDRESS <> t1.ADDRESS

SELECT DISTINCT t1.*
    FROM table1 t1
    INNER JOIN table2 t2
        ON t2.ID <> t1.ID
            AND t2.NAME = t1.NAME
            AND t2.ADDRESS <> t1.ADDRESS 
```

如您所见，我正在选择（按查询顺序）

*   id AND name 匹配的数据集
*   id 匹配但名称不匹配的数据集
*   id 不匹配但名称匹配的数据集

将所有三个查询返回的结果数相加时，我检索的行数比 T1 中存在的行数多对每个集合执行不同的命令（因为一行将执行另一个命令）。

有人可以在这里找到我要去哪里吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T20:55:56.743

考虑 Name 是否不唯一。如果您有以下数据：

```
Table 1                        Table 2
ID    Name      Address        ID    Name      Address
0     Jim Smith 1111 A St      0     Jim Smith 2222 A St
1     Jim Smith 2222 B St      1     Jim Smith 3333 C St 
```

然后查询 1 为您提供：

```
0     Jim Smith 1111 A St
1     Jim Smith 2222 B St 
```

因为表 1 中的第 1 行和第 2 行分别匹配表 2 中的第 1 行和第 2 行。

查询 2 什么也没给你。

查询 3 为您提供

```
0     Jim Smith 1111 A St
1     Jim Smith 2222 B St 
```

因为表 1 中的第 1 行与表 2 中的第 2 行匹配，而表 1 中的第 2 行与表 2 中的第 1 行匹配。因此，当表 1 中只有 2 行时，您会从表 1 中得到 4 行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T20:34:41.980

您确定 NAME 和 ID 在两个表中都是唯一的吗？

如果没有，您可能会遇到一种情况，例如，表 1 有这样的情况：

姓名：弗雷德 ID：1

table2 有这个：

姓名：弗雷德 ID：1

姓名：弗雷德 ID：2

在这种情况下，您的两个查询将返回 table1 中的记录：ID 和 NAME 都匹配，NAME 匹配但 ID 不匹配。

您可以通过交叉两个查询的每个组合来找出重复项是什么来缩小问题范围，例如：

```
SELECT DISTINCT t1.*
    FROM table1 t1
    INNER JOIN table2 t2
        ON t2.ID = t1.ID
                AND t2.NAME = t1.NAME
                AND t2.ADDRESS <> t1.ADDRESS
INTERSECT
SELECT DISTINCT t1.*
    FROM table1 t1
    INNER JOIN table2 t2
        ON t2.ID = t1.ID
                AND t2.NAME <> t1.NAME
                AND t2.ADDRESS <> t1.ADDRESS 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T20:57:17.770

假设T2.ID具有唯一性约束，那么这种场景在逻辑上还是很有可能发生的。如果对于T1中的每条记录，在T2中都有两条对应的记录：

1.  相同的名字，相同的ID，不同的地址
2.  同名，不同身份证，不同地址

例如，T1 的相同记录可以出现在第一个和第三个查询中。

也可以在第二个和第三个查询中同时获取同一行。

如果不能保证 T2.ID 是唯一的，那么您可以在所有三个查询中从 T1 获得相同的行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T20:37:02.367

我认为最后一个查询可能是获取额外行集的查询。

即它依赖于两个表中的名称匹配（而不是 ID）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T00:47:22.110

要找到有问题的数据（并帮助找到你的逻辑漏洞），我建议：

（注意伪代码）

将结果限制为 SELECT id FROM ...。

*   UNION 结果集

*   计数（编号）

*   按 ID 分组

*   计数（id）> 1

这将显示匹配多个子查询的记录。

# .net - 用于创建类和将类移动到新文件的 Resharper 快捷方式

> ID：392186
> 
> 赞同：26
> 
> 时间：2008-12-24T20:36:10.120
> 
> 标签：.net, resharper

Resharper 4 的快捷方式是什么

1.  从使用中创建一个类？例如，我输入“var p = new Person();”，现在我想创建 person 类。

2.  将这个类移动到它自己的文件中？当 Person 类存在于我的 Order 类旁边的同一文件中时，移动它的快捷方式是什么。

我似乎无法在[备忘](http://www.jetbrains.com/resharper/docs/ReSharper40DefaultKeymap.pdf)单或[Internet](https://www.google.com/search?btnG=1&pws=0&q=resharper+create+class+shortcut&gws_rd=ssl)上找到这些快捷方式。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-24T21:04:29.657

键入以下行：

```
var p = new Person(); 
```

`Person`将被 ReSharper 以红色突出显示为错误。将插入符号放在上面，然后按**`ALT`+`ENTER`**调用快速修复上下文菜单。选择**创建类 'Person'**。

然后光标将位于新类的名称上，因此再次按**`ALT`+`ENTER`**以再次调用上下文相关的快速修复菜单并选择**Move to another file to match type name**。

这只是**两个**动作 - 非常快速和容易。一段时间后，它（就像大多数 R# 命令一样）变成了肌肉记忆。喜欢开车、走路或嚼口香糖。

**对于奖励积分**
以上是您想要做的所有事情，但您可以更进一步：

1.  如果您希望将类移动到不同的命名空间，您可以按**`SHIFT`++`CTRL``R`**并选择**Modify Namespace** **...**。

2.  如果您希望将课程完全移动到不同的项目，您可以按**`SHIFT`+ `CTRL`+`R`**并选择**Move to Folder...**。

最棒的是 - ReSharper 将对命名空间进行所有必要的更改，以确保仍然可以编译。有一个问题 - 仅当您将类移至的项目被您*从中**移出*的项目引用时。你有两个选择

1.  继续重构并使用 ReSharper 快速修复来一次性添加引用*和*导入命名空间（如果它是一个新类，我会这样做，因为它将是唯一的用法）。
2.  在移动它们之前手动添加参考，它会为你做这一切。

# visual-studio-2008 - VS 2008 中的程序切片

> ID：392187
> 
> 赞同：6
> 
> 时间：2008-12-24T20:36:14.537
> 
> 标签：visual-studio-2008, debugging

[任何人都对在 MS Visual Studio 2008 中使用程序切片](http://en.wikipedia.org/wiki/Program_slicing)技术调试 OO 项目有任何想法或经验吗？工具建议会很有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-16T19:33:48.070

恕我直言，真正有用的程序切片工具通常出现在静态分析工具中，例如[C++ 的 CodeSurfer](http://www.grammatech.com/products/codesurfer/overview.html)和[LLVM 的 Clang](http://clang-analyzer.llvm.org/)。如果您正在寻找 C# 工具和/或 Visual Studio 插件，请参阅[哪些静态分析工具可用于 C#](https://stackoverflow.com/questions/38635/what-static-analysis-tools-are-available-for-c)。

但是，它们并不是学术研究成果的完美实现，请注意。

# linux - 当大量磁盘活动发生时如何使 Linux GUI “可用”

> ID：392198
> 
> 赞同：15
> 
> 时间：2008-12-24T20:43:26.800
> 
> 标签：linux, performance, storage, disk

如果我开始将一个巨大的文件树从一个位置复制到另一个位置，或者如果某个其他进程开始执行大量磁盘活动，则前台应用程序 (GUI) 会减慢速度。例如，采用一个 2gb 的文件树，其中包含 100k 个文件。打开控制台并执行 cp -r bigtree bigtree2。然后转到Firefox并开始浏览。Firefox 几乎无法使用。即使我将 firefox 的 nice 级别设置为非常高的优先级（-20），它仍然非常慢且延迟很大。

我记得几年前我在 Solaris 机器上工作时，系统在类似情况下的表现要好得多。

我的 HD 使用的是 DMA，而不是 PIO。是SATA。未安装 atime 标志。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-25T00:38:55.903

Linux 长期以来一直存在占用系统所有“脏”高速缓存内存的程序的问题。正在发生的事情是，复制过程正在用它正在复制的文件数据填充写入缓存，并且速度非常快。因此，当 Firefox 出现并需要写入时，它必须首先等待脏缓冲区空间或可用的磁盘队列写入槽。在等待期间，它与复制进程和内核的 pdflush 线程竞争，后者将数据从脏缓冲区移动到磁盘写入队列。

Firefox 在这种情况下还有另一个问题。它使用 SQLite 来存储它的书签、历史和其他东西。SQLite 是一个符合 ACID 的数据库，它使用事务系统，其磁盘写入**刷新到磁盘**。因此，它不仅要等待缓冲区空间，还必须等待充满复制文件的磁盘队列清空，然后才能确认写入成功。

Linux 磁盘队列和缓冲系统已经做了**很多**调整。几乎每个内核版本都有变化。尝试其中一个较新的版本。您也可以尝试调整 sysctl 值。我有点喜欢这些：

```
vm.dirty_writeback_centisecs = 100
vm.dirty_expire_centisecs = 9000
vm.dirty_background_ratio = 4
vm.dirty_ratio = 80 
```

您还可以尝试调整磁盘队列中的插槽数。这个值在`/sys/block/sda/queue/nr_requests`. 你需要`sda`用你真正的驱动器来代替。更多槽意味着更多合并 IO 请求的机会，并且 CFQ IO 调度程序可以更好地处理优先级。更少的插槽通常意味着更短的等待写入磁盘的同步 IO（如 SQLite 的事务）。如果写入繁重的进程完全用写入 IO 填充队列，则更少的插槽也意味着将读取 IO 放入磁盘队列的等待时间更短。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-24T20:50:28.640

尝试[ionice](http://linux.die.net/man/1/ionice) -ing 或 nice-ing 复制过程。问题是由于 IO 获得与 GUI 相同的优先级，这对于桌面来说会影响感知响应能力。

目前有一个关于这个的 Ubuntu[头脑风暴](http://brainstorm.ubuntu.com/idea/15668/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T01:33:13.280

你不是第一个注意到这个问题的人。前内核开发人员 [Con Kolivas] ( [http://en.wikipedia.org/wiki/Con_Kolivas](http://en.wikipedia.org/wiki/Con_Kolivas) ) 发现很多公司都**在以牺牲桌面性能为代价来提高 linux 服务器性能**。Con 有一[组令人印象深刻的补丁，可以让桌面响应更快](http://members.optusnet.com.au/ckolivas/kernel/)。不幸的是，发生了某种代码大战，最终[Con 退出了](http://apcmag.com/why_i_quit_kernel_developer_con_kolivas.htm)。

我很想知道如何向**Linux 内核开发人员**请求更好的桌面性能。同时，如果您愿意运行内核 2.6.22，您可以**使用`-ck`补丁集**运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T21:24:11.817

确保在所有支持它的驱动器上启用 DMA。根据您的发行版，这可能不是默认值。阅读**`man hdparm`**，并查看您的系统**`init`**机制。

# php - 重构以消除静态方法代码异味

> ID：392201
> 
> 赞同：4
> 
> 时间：2008-12-24T20:47:02.813
> 
> 标签：php, zend-framework, refactoring, static-methods

对于需要创建的每个域对象，我都有当前的基本结构：

```
class Model_Company extends LP_Model
{   
    protected static $_gatewayName = 'Model_Table_Company';
    protected static $_gateway;
    protected static $_class;

    public static function init()
    {
        if(self::$_gateway == null)
        {
            self::$_gateway = new self::$_gatewayName();
            self::$_class = get_class();
        }
    }

    public static function get() 
    {
        self::init();

        $param = func_get_arg(0);

        if($param instanceof Zend_Db_Table_Row_Abstract)
        {
            $row = $param;
        }
        elseif(is_numeric($param))
        {
            $row = self::$_gateway->find($param)->current();
        }

        return new self::$_class($row);
    }

    public static function getCollection()
    {
        self::init();

        $param = func_get_arg(0);

        if($param instanceof Zend_Db_Table_Rowset_Abstract)
        {
            $rowset = $param;
        }
        elseif(!$param)
        {
            $rowset = self::$_gateway->fetchAll();
        }

        $array = array ();      

        foreach ($rowset as $row)
        {
            $array[] = new self::$_class($row);
        }

        return $array;
    }
} 
```

我最初尝试将静态方法重构为父 LP_Model 类，只是为了最终了解“后期静态绑定”在 php 世界中的含义。

我只是想知道是否有人对如何重构此代码有建议，这样我就不必在我创建的每个域对象中重新声明相同的三个函数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T22:43:34.777

这个怎么样：

```
<?php

abstract class Model_Abstract
{
    protected $_gatewayName = null;
    protected $_gateway = null;

    protected function _init()
    {
        $this->_gateway = new $this->_gatewayName();
    }

    protected function __construct($row = null)
    {
        $this->_init();
        if ($row) {
            $this->_data = $row;
        }
    }

    public static function getAbstract($class, $param)
    {
        $model = new $class();
        if($param instanceof Zend_Db_Table_Row_Abstract)
        {
                $row = $param;
        }
        elseif(is_numeric($param))
        {
                $row = $model->_gateway->find($param)->current();
        }

        return new $class($row);
    }

    public static function getAbstractCollection($class, $param = null)
    {
        $model = new $class();
        if($param instanceof Zend_Db_Table_Rowset_Abstract)
        {
                $rowset = $param;
        }
        elseif($param === null)
        {
                $rowset = $model->_gateway->fetchAll();
        }

        $array = array ();

        foreach ($rowset as $row)
        {
                $array[] = new $class($row);
        }

        return $array;
    }

    abstract public static function get($param);
    abstract public static function getCollection($param = null);
}

class Model_Company extends Model_Abstract
{
    protected $_gatewayName = 'Model_Table_Company';

    public static function get($param) {
        return self::getAbstract(__CLASS__, $param);
    }

    public static function getCollection($param = null) {
        return self::getAbstractCollection(__CLASS__, $param);
    }
}

class Model_Table_Company extends Zend_Db_Table_Abstract
{
    protected $_name = 'company';
}

$model = Model_Company::get(1);
print "Got an object of type ".get_class($model)."\n";

$models = Model_Company::getCollection();
print "Got ".count($models)." objects of type ".get_class($models[0])."\n";

?> 
```

不幸的是，为了使函数易于调用，您必须在每个子类中复制`get()`和。`getCollection()`另一种选择是调用父类中的函数：

```
$model = Model_Abstract::getAbstract('Model_Company', 1);
print "Got an object of type ".get_class($model)."\n";

$models = Model_Abstract::getAbstractCollection('Model_Company');
print "Got ".count($models)." objects of type ".get_class($models[0])."\n"; 
```

如果你想走这条路，你可以重命名基类及其函数名。但关键是**你必须在一个地方或另一个地方命名子类**：要么像我的第一个示例那样在子类中创建一个样板函数，要么像我的第二个示例那样在字符串中命名该类。

# java - 寻找端到端 Java CPU Profiler 的建议

> ID：392203
> 
> 赞同：6
> 
> 时间：2008-12-24T20:49:40.077
> 
> 标签：java, profiling

有哪些适用于 Java 的端到端 CPU 分析器？

我正在寻找的东西的快速列表：

1.  离线分析 - 程序执行期间无需用户交互或 GUI。将配置文件数据转储到文件中，然后需要使用 GUI 进行查看很好，我只是不想在作业运行时照看它
2.  端到端记录 - Profiler 应该能够在输入 J2SE 应用程序的主要调用后立即开始记录。它应该在 JVM 退出之前立即停止记录。
3.  调用图生成 - 分析后，最好将数据转换为可视调用图。

谷歌有一个很好的 C/C++ 分析器 - [http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html](http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html)

如果存在与此等效的 Java，那么它正是我正在寻找的。

我没有将 HProf 包括在我的预期分析器列表中，因为与我在使用准确的 CPU 调用分析时看到的其他商业分析器相比，它的性能很差（通常通过字节码注入完成，这很慢，但 HProf 至少出现比其他分析器慢一个数量级，并且当单个采样配置文件运行需要 1-2 小时时，等待同一运行超过一天是不可接受的）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T21:39:46.153

到目前为止，我最喜欢的是[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)。直到现在我才意识到（因为我总是使用交互式分析 GUI），但它实际上支持离线分析，就像你描述的那样。

其他一些很酷的功能：

*   它会分析您的所有 SQL 语句，因此您可以查看哪些数据库查询正在减慢您的速度。

*   它跟踪哪些方法（在哪些类和包中）分配了最多的内存，哪些类型的对象和数组，以及这些对象的寿命。因此，如果您正在泄漏内存，则很容易追踪哪些类型的类实例已经过时，并找到最初分配这些对象的方法（以及谁持有使对象保持活动状态的引用）。

*   您可以跟踪 VM 增长，监控 GC 完整收集的频率，并确定在每个收集周期中释放了多少对象（哪种类型）。

*   当然，您会得到所有方法调用的分层分解，包括调用次数和整个调用堆栈的平均执行时间（不包括或包括）。您还可以从“最严重的瓶颈”函数的角度查看此层次结构，按执行时间或内存分配排序。

对我来说，JProfiler 是我开发过程中最重要的工具之一（仅次于 Eclipse）。

* * *

另外：还有[10 天免费试用](http://www.ej-technologies.com/download/jprofiler/trial.php)。下载并查看。而且，顺便说一句，我不隶属于公司或任何东西。在过去的五六年里，我一直是一个快乐的客户。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T21:04:17.240

我不熟悉离线分析。这不是[hprof](http://java.sun.com/developer/technicalArticles/Programming/HPROF.html)的用途吗？否则，我对[YourKit profiler](http://www.yourkit.com/)的体验非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T21:23:44.377

我对[NetBeans Profiler](http://profiler.netbeans.org/)非常满意；我相信它也可以满足您的所有要求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T06:56:46.670

[您可以尝试JRockit Mission Control](http://www.oracle.com/technology/products/jrockit/missioncontrol/index.html)附带的运行时分析器。它会生成录制文件，您可以稍后在 GUI 中打开这些文件。开销非常低，通常不到 1-2%，而且非常易于使用。

您可以像这样从命令行开始录制：

> JROCKIT_HOME\bin>java -XXjra:recordingtime=2000s,filename=myrecording.jra,sampletime=1

如果 JVM 退出，在记录完成之前，分析数据将被刷新到磁盘。

# asp.net - DNN 4.9 ... 上传 PDF 文件时出现间歇性错误

> ID：392211
> 
> 赞同：0
> 
> 时间：2008-12-24T21:01:11.753
> 
> 标签：asp.net, dotnetnuke

在 DNN 4.9 的 FCKEditor 中上传 PDF 文件时，出现间歇性“对象引用未设置为对象的实例”错误。

这是错误：

> AssemblyVersion：04.09.00 AbsoluteURL：/.../Providers/HtmlEditorProviders/Fck/fcklinkgallery.aspx
> UserAgent：Mozilla/4.0（兼容；MSIE 7.0；Windows NT 5.1；.NET CLR 1.1.4322；.NET CLR 2.0.50727； IEMB3；IEMB3) InnerException：对象引用未设置为对象的实例。文件名：
> FileLineNumber：0 FileColumnNumber：0 方法：DotNetNuke.UI.UserControls.UrlControl.cmdSave_Click StackTrace：消息：DotNetNuke.Services.Exceptions.PageLoadException：对象引用未设置为对象的实例。---> System.NullReferenceException：对象引用未设置为对象的实例。在 DotNetNuke.UI.UserControls.UrlControl.cmdSave_Click(Object sender, EventArgs e) 在 System.Web.UI.WebControls.LinkBut​​ton.OnClick(EventArgs e) 在 System.Web.UI.WebControls.LinkBut​​ton.RaisePostBackEvent(String eventArgument) 在System.Web.UI.WebControls.LinkBut​​ton.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument) 在 System.Web.UI.Page.RaisePostBackEvent(IPostBackEventHandler sourceControl, String eventArgument) 在 System.Web.UI.Page。

错误来来去去，文件大小似乎无关紧要，上次我在上传几个 1MB 文件后得到它，第三个文件（600kB）给了我一个错误。

请帮忙！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-26T19:31:03.727

我在许多使用 FCK 提供程序的站点上注意到了这一点，该提供程序包含在 4.9.0 和更高版本的 DotNetNuke 中。

目前我不知道有什么方法可以“修复”它，因为我还没有准确指出是什么导致了错误。

# flash - 如何通过 html 对象和/或嵌入标签中的 url 加载 .swf？

> ID：392215
> 
> 赞同：3
> 
> 时间：2008-12-24T21:04:53.790
> 
> 标签：flash

我认为这很简单，但它不起作用..在对象/嵌入代码中，我尝试通过 url 加载 .swf 但没有加载。例如：名称=“电影”值=“http://localhost/mySite/Flash/Flash.swf”

如果我从 flash 文件夹本地运行页面并通过以下方式引用：name="movie"value="Flash.swf" ... 它工作正常

我认为这可能是一个安全问题，所以我尝试更改 name="allowScriptAccess" value="always"，但这没有帮助。

任何帮助表示赞赏 - 谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T21:34:58.113

我推荐[SWF 对象](http://blog.deconcept.com/swfobject/)

它易于使用、免费，并且还解决了 IE 中烦人的“单击此处激活此..”问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T06:50:38.363

*   解决方案：这不起作用，因为我的 .swf 引用了一个 .xml 文件——为了让它正常工作，我必须告诉 flash 这是在哪里，所以我在 url 中也有完整的质量

即：旧的 [http://localhost/mySite/Flash/Flash.swf](http://localhost/mySite/Flash/Flash.swf)

新： [http://localhost/mySite/Flash/Flash.swf&xml=http://localhost/Flash/Myfile.xml](http://localhost/mySite/Flash/Flash.swf&xml=http://localhost/Flash/Myfile.xml)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T21:31:00.523

这是嵌入 swf 的正确代码

```
<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" WIDTH="320" HEIGHT="240" id="Yourfilename" ALIGN="">
<PARAM NAME=movie VALUE="Yourfilename.swf"> <PARAM NAME=quality VALUE=high> <PARAM NAME=bgcolor VALUE=#333399> <EMBED src="Yourfilename.swf" quality=high bgcolor=#333399 WIDTH="320" HEIGHT="240" NAME="Yourfilename" ALIGN="" TYPE="application/x-shockwave-flash" PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED> </OBJECT> 
```

然后只需确保您的 MIME 设置允许在您的 Web 服务器中使用 swf 文件

请注意大写标签，我是从旧网站上提取的

# java - 究竟什么是“finally 子句的突然完成”？

> ID：392216
> 
> 赞同：3
> 
> 时间：2008-12-24T21:04:56.380
> 
> 标签：java, try-catch

根据[Java 语言规范](http://java.sun.com/docs/books/jls/third_edition/html/exceptions.html)：

> 如果有任何封闭的 try 语句，其 try 块包含 throw 语句，则这些 try 语句的任何 finally 子句都会在控制向外转移时执行，直到捕获到抛出的值。请注意，**finally 子句的突然完成**可能会中断由 throw 语句启动的控制转移。

除了在 finally 块中返回之外，还有哪些其他方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T21:06:09.687

从 finally 块中抛出异常也会破坏原始异常（如果有的话）。

编辑：找到解释“突然完成”的参考。
来自[§14.1：语句的正常和突然完成](http://java.sun.com/docs/books/jls/third_edition/html/statements.html#5894)：

> 突然完成总是有一个相关的原因，这是以下原因之一：
> 
> *   没有标签的休息
> *   给定标签的中断
> *   没有标签的继续
> *   给定标签的继续
> *   没有价值的回报
> *   具有给定值的返回
> *   具有给定值的 throw，包括 Java 虚拟机抛出的异常

最后三个是子句中唯一可能的`finally`，除非它在循环内。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T21:08:00.867

`Sys.exit()`或强制中止。尤其是 GUI 程序因调用`Sys.exit()`异常而臭名昭著，部分原因是在 JVM 1.5 之前存在的一个错误——从 GUI 线程抛出的异常并没有传递到主线程。

更新：特别是对谁反对这一点。对不起，但是 Sys.exit() 完全符合突然终止的含义，包括导致堆栈不被展开；明天我将针对文档提交一个错误。我在 Sun 担任高级 Java 架构师已有多年的权威，我可以这样说。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T06:35:15.903

如果 finally 块是 switch case 的一部分，我想它也可能是 switch 内的 break 语句。此外，如果 finally 块调用以其他语言实现的方法，它可能会做该语言的编译器喜欢的任何事情。

# python - 是否有 Ruby/Python HTML 回流/布局库？

> ID：392217
> 
> 赞同：3
> 
> 时间：2008-12-24T21:05:12.557
> 
> 标签：python, html, ruby, layout

我正在寻找一个 Ruby 或 Python 中的库，它将一些 HTML 和 CSS 作为输入并返回包含元素位置和大小的数据。如果有帮助，我不需要所有元素的信息，而只需要页面的主要 div。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T21:29:45.583

Scriptor，我认为您可能正在寻找的可能是 JavaScript，而不是 Ruby 或 Python。我的意思是 - 位置和大小基本上将由渲染引擎（浏览器）确定。您可能会考虑使用 jQuery 之类的东西来遍历所有您想要的对象 - 输出对象的名称（如 DIV 的 ID）以及该项目的高度和宽度。所以，如果我在你的位置和 height() 和 width() 方法中，我会看看 jQuery 的价值。你永远不知道 - 可能已经有一个 jQuery 插件。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-25T01:23:46.263

Ruby 和 Python 都有一个 Regex 库。为什么不搜索 /width=\"(\d+)px\"/ 和 /height:(\d+)px/ 之类的东西。使用 $1 查找组中的值。我不是正则表达式专家，而且我是从内存中执行此操作的，因此请参阅网上的任何教程以了解正确的语法和变量用法，但这就是开始的地方。祝你好运，bsperlinus

# regex - 正则表达式拼写错误

> ID：392234
> 
> 赞同：8
> 
> 时间：2008-12-24T21:20:29.563
> 
> 标签：regex

我从数据库中的列表创建了一个正则表达式，以匹配游戏中建筑物类型的名称。问题是拼写错误，有时那些在游戏中为他们的团队编写指令的人会拼错建筑物名称，显然正则表达式将无法识别它（即拼写“大学”和“大学”）。

是否有关于使正则表达式匹配 1 个或 2 个字母的拼写错误的建议？

正则表达式是动态生成的，并在能够处理更多负载的本地机器上运行，因此作为最后的手段，我不得不通过算法创建每个单词的版本，其中缺少一个字母，然后另一个版本添加了字母。

我正在使用 PHP，但我希望这个问题的任何解决方案都不是 PHP 特定的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-24T21:22:46.157

请允许我向您介绍[Levenshtein Distance](http://en.wikipedia.org/wiki/Levenshtein_distance)，它衡量字符串之间的差异，作为将一个字符串转换为另一个字符串所需的转换次数。

它也[内置于 PHP](http://us2.php.net/manual/en/function.levenshtein.php)中。

因此，我将输入文件按非单词字符拆分，并测量每个单词与目标建筑物列表之间的距离。如果距离低于某个阈值，则假设它是拼写错误。

我认为与尝试为每种特殊情况制作正则表达式相比，以这种方式匹配您会更幸运。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T21:28:27.533

Google 通过查看以前的结果来实施“您的意思是”也可能会有所帮助：

[你如何实现“你的意思是”？](https://stackoverflow.com/questions/41424/how-do-you-implement-a-did-you-mean)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T01:36:10.017

> [什么是 Soundex() ？– Teifion（28 分钟前）](https://stackoverflow.com/a/392282/1165522)

soundex 类似于 Triptych 提到的 levenshtein 函数。它是一种比较字符串的方法。见：[http ://us3.php.net/soundex](http://us3.php.net/soundex)

您还可以查看 metaphone 和similar_text。我会把它放在评论中，但我还没有足够的代表来做这件事。:D

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-24T22:17:14.673

过去我们有时会使用 Soundex() 来解决这些问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-25T01:25:58.053

你很幸运；**算法人员在正则表达式**的近似匹配方面做了很多工作。这些工具中最古老的可能[`agrep`](http://www.tgries.de/agrep/)最初是在亚利桑那大学开发的，现在有一个不错的开源版本。你只需**告诉`agrep`你愿意容忍多少错误**，它就会从那里匹配。它还可以匹配**除行之外的其他文本块**。[上面](http://www.tgries.de/agrep/)的链接有一个更新的 GPL 版本的链接，`agrep`还有一些特定于语言的库，用于正则表达式的近似匹配。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-24T21:25:02.190

这可能有点矫枉过正，但 Google 的 Peter Norvig 写了一篇关于用 Python 编写拼写检查器的[优秀文章](http://norvig.com/spell-correct.html)。这绝对值得一读，并且可能适用于您的情况。

在文章的最后，他还列出了该算法在各种其他语言中的贡献实现。

# ruby-on-rails - ActionMailer 使用 GMAIL 发送电子邮件的完整示例

> ID：392235
> 
> 赞同：3
> 
> 时间：2008-12-24T21:21:13.587
> 
> 标签：ruby-on-rails, gmail, actionmailer

我想测试我的 ActionMailer 类，但没有 smtp 服务器。我想使用 gmail 发送此类电子邮件。有人可以在谷歌和应用程序中的任何配置文件上提供所有必要配置的示例吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T21:27:46.723

GMail 只有 SSL SMTP 可用，因此您应该通过 Net::SMTP 创建 SSL SMTP 连接。

检查这篇文章：

*   [如何在 Rails ActionMailer 中使用 GMail SMTP 服务器发送电子邮件](http://www.stephenchu.com/2006/06/how-to-use-gmail-smtp-server-to-send.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-25T02:32:36.063

我用 SSMTP 做到这一点。它充当 SMTP 服务器并代理到真正的 SMTP 服务器。在 Unix（在这种情况下是 Ubuntu hardy）上，它使系统 sendmail 正常工作。

如果您也在 Ubuntu 上，请运行`apt-get install ssmtp`以获取它。

这是一个基于我的示例配置文件。

```
#
# Config file for sSMTP sendmail
#
# The person who gets all mail for userids < 1000
# Make this empty to disable rewriting.
root=postmaster

# The place where the mail goes. The actual machine name is required no 
# MX records are consulted. Commonly mailhosts are named mail.domain.com
#mailhub=aspmx.l.google.com
mailhub=smtp.gmail.com:587

# Where will the mail seem to come from?
rewriteDomain=example.com

# The full hostname
hostname=yourhostname.example.com

# Are users allowed to set their own From: address?
# YES - Allow the user to specify their own From: address
# NO - Use the system generated From: address
FromLineOverride=YES

# should turn on SSL & auth to google's SMTP server
# TODO change this user
UseTLS=YES
UseSTARTTLS=YES
AuthUser=yourgoogleuser@example.com.com
AuthPass=yourgooglepassword 
```

您需要将此添加到您的`environment.rb`or中`production/environment.rb`：

```
ActionMailer::Base.delivery_method = :sendmail
ActionMailer::Base.raise_delivery_errors = true 
```

# vb.net - Visual Basic .net 中图像的透明度？

> ID：392257
> 
> 赞同：2
> 
> 时间：2008-12-24T21:47:49.803
> 
> 标签：vb.net, image

我的表单上有一个图片框，我在其中添加了图片。这张图片有一个透明的背景，但不幸的是，它似乎丢失在图片框中......我猜那是因为图片框的背景颜色属性设置为灰色（默认）。不过，我看不到“透明”的任何选项。

知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T21:56:43.687

根据您要完成的工作，有几种不同的方法可以实现。

**一些例子是 -**

使位图透明

```
将 bmp 调暗为位图 = Bitmap.FromFile("test.bmp")
bmp.MakeTransparent(Color.Magenta) ' 位图中的洋红色将是透明的
PictureBox1.Image = bmp

```

使图片框透明

```
PictureBox1.BackColor = 颜色.透明

```

如果您真的需要透明图像，我建议不要使用图片框而直接渲染透明位图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-04T05:15:44.890

如果您希望PictureBox*后面*的控件显示，即。如果您希望图像以透明背景显示，请尝试直接在表单本身上绘制。

*回到 VB6 的时代，我们可以通过挂钩表单的“重绘”事件或其他东西来做到这一点......*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-06T23:43:58.473

在 VB 中的大多数控件上，在对象的 Backcolor 属性中，都有一个透明度选项。这在 VB2008 中工作正常，但在 VB2005 中，您必须将其 .parent 属性设置为后面的对象（好吧，无论如何，根据我的经验。）

希望这可以帮助，

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-06T16:10:26.040

我知道这是一个老话题，但我想我会发布我想出的解决方案，供任何寻找 Windows 窗体的简单解决方案的人使用。假设您有 PictureBox1 和 PictureBox2。您希望 PictureBox2 覆盖在 PictureBox1 上。确保您的 PictureBox1 背景设置为透明。然后，您可以以编程方式设置：

```
PictureBox2.Parent = PictureBox1 
```

魔法

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-10-03T06:27:41.830

透明图像，您也可以使用 Adob​​e Photoshop 删除白色/黑色背景（观看教程如何创建透明背景）或使用下面的代码，

```
PictureBox1.BackColor = Color.Transparent
SetStyle(ControlStyles.SupportsTransparentBackColor, True) 
```

# c# - 如何向特定事件处理程序发出目标 C# 事件？

> ID：392266
> 
> 赞同：1
> 
> 时间：2008-12-24T21:59:47.237
> 
> 标签：c#, events

假设我有一个可以同时进入多个商店和购物的客户对象。当客户进入商店时，商店将开始处理客户触发的事件。要购买商品，客户当前会使用 EventArgs 中指定的特定商品触发 PurchaseItem 事件。

目前，由于客户可以同时在多个商店中，因此每当他触发 PurchaseItem 事件时，都会通知他所在的所有商店。有没有办法**使用事件**，当客户触发 PurchaseItem 事件时，只通知包含该项目的商店？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T22:07:10.653

这听起来像是一种非常奇怪的建模方式。采购应该是商店和客户之间的一个动作——一个直接的方法调用，可能是从客户到商店。这可能会触发一个事件，但我不会使用一个事件来进行初始购买。也许它在你的真实环境中更有意义......但如果不知道更多细节就很难说。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T22:22:13.447

如果您让该物品知道拥有它的商店怎么办？然后，您可以使用 this 作为客户调用 item.Purchase(this)，并且该项目将触发商店事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T22:35:17.587

我认为命令是处理广泛目标事件的首选方式。这样可以省去正确接线所有东西的麻烦。您的客户可以发出购买命令，商店可以使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T03:49:08.077

为您的事件提供与相应商店相对应的“频道”标识符，并为商店提供代码以忽略不在其“频道”上的事件

但是 jon skeet 是对的（jon skeet*永远*是对的，或者至少 99.999% 正确）这是一个糟糕的设计——也许有更多的细节我们可以帮助你修复它

# java - 如何使用 org.xml.sax.ext.EntityResolver2 resolveEntity 方法获取非空名称参数？

> ID：392268
> 
> 赞同：1
> 
> 时间：2008-12-24T22:05:54.230
> 
> 标签：java, xml, sax

在 Java SAX 处理中，我无法从 `org.xml.sax.ext.EntityResolver2`resolveEntity 方法中获取实体引用名称。name 参数始终`null`是即使文档声明`'name' is never null when invoked by a SAX2 parser`.

任何想法 ？

为了演示这个问题，我创建了一个 Jython 2.5 脚本。它打印（在我的盒子上）：

```
Entity Resolver 2 enabled: True
Entity name: None 
```

Jython 2.5 脚本：

```
# Jython
from org.python.core.util import StringUtil
from jarray import array

# Java Standard Edition
from org.xml.sax import *
from org.xml.sax.ext import *
from org.xml.sax.helpers import *
from java.io import ByteArrayInputStream

xml = """\
<!DOCTYPE doc
[<!ENTITY entity SYSTEM "entity-file">
]>
<doc>&entity;</doc>
"""

def empty_source():
    _source = InputSource()
    byte_stream = ByteArrayInputStream(array([], "b"))
    _source.setByteStream(byte_stream)
    return _source

class Handler(EntityResolver2):
    def getExternalSubset(self, name, baseURI):
        return None
    def resolveEntity(self, name, publicId, baseURI, systemId):
        print "Entity name:", name 
        return empty_source()

reader = XMLReaderFactory.createXMLReader()
enabled = reader.getFeature("http://xml.org/sax/features/use-entity-resolver2")
print "Entity Resolver 2 enabled:", enabled 

handler = Handler()
reader.setEntityResolver(handler) 
bytes = StringUtil.toBytes(xml)
byte_stream = ByteArrayInputStream(bytes)
source = InputSource(byte_stream)
reader.parse(source) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-25T19:40:03.853

使用更新版本的 Xerces（例如 2.9.1），而不是与 Java 捆绑在一起的“旧”版本。

# session-state - regenerateExpiredSessionId 未按预期工作

> ID：392272
> 
> 赞同：4
> 
> 时间：2008-12-24T22:09:41.803
> 
> 标签：session-state

据我了解，根据 MSDN，**regenerateExpiredSessionId="true"**指定当客户端指定过期的会话 ID 时将重新发布会话 ID。但是，这似乎不像描述的那样工作。

假设您有一个配置如下的应用程序：

```
<sessionState 
     cookieless="AutoDetect" 
     regenerateExpiredSessionId="true" /> 
```

在其他地方，您有一个指向该应用程序中嵌入了过期会话 ID 的页面的链接：

```
<p><a href="http://localhost/SessionStateTest/(S(3gxng155isp0ocvhveoklnqe))/Default.aspx">Here is a link!</a></p> 
```

如果*未*启用 cookie 的浏览器单击该链接，*则不会重新发出会话 ID。*它正在从 URL 中回收过期的 ID，并使用此旧 ID 创建新会话。

当然，如果多个无 cookie 浏览器同时点击链接，它们都共享同一个过期会话 ID，这显然是一个安全问题。

**regenerateExpiredSessionId="true"**不是应该防止用户无意中共享相同的会话状态吗？如果是这样，为什么在这种情况下框架没有按预期生成新的会话 ID？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T00:12:12.643

您确定您的会话实际上即将到期吗？

如果您使用 Forms 身份验证，则其票证的到期时间可能与会话不同。（当您将滑动到期加入混合时会变得更加混乱）

要检查 cookieless 是否启用，只需在您认为会话已过期时查看 url……如果 url 票证的第二部分“F（xydUI ....）”在您再次登录时发生变化，但“S（dysXy. ..)”保持不变，您知道您的会话刚刚更新并且尚未完全过期。

希望这可以帮助

# tcl - Tcl 变量中存储了什么？

> ID：392273
> 
> 赞同：0
> 
> 时间：2008-12-24T22:10:20.540
> 
> 标签：tcl

根据[this question](https://stackoverflow.com/questions/385156/how-do-i-retrofit-a-gui-to-an-existing-c-program)中给出的建议，我编写了一个小gui来获取命令行C程序的选项并将它们传递给已经设置为处理它们的所述C程序。它就像我想要的那样显示。

但是，我想验证存储在变量中的值是否正确。 **让值打印出来让我很伤心**（由于一些硬件问题，我现在无法*在体内测试）。*我错过了什么？

1.  在变量名前加上“$”会给我“$variableName”而不是变量的*值*。
2.  将这些变量添加到数组并调用`array get arr`应该打印索引和数组值；我得到变量名。
3.  我尝试了*pathName* `cget` *option*，但显然`-value`不是一个选项，并且放弃该选项不会给我一个有效选项列表。

这是所有不起作用的各种代码的代码（来自选项＃1，这是最直接的方法；其他只是我尝试解决方法）。它们都会产生以下错误：“无法读取“::”：没有这样的变量”或“无法读取“色度”：没有这样的变量”。

```
#!/opt/ActiveTcl-8.5/bin/wish8.5

wm title . "Gretag"

ttk::frame .f -borderwidth 5 -relief sunken -padding "5 10"

# next line part of the "puts" tests at the bottom
global colorimetric
ttk::label .f.dataLabel -text "Data Type"
ttk::label .f.colorimetricLabel -text "Colorimetric"
ttk::checkbutton .f.colorimetric -onvalue "-c" -offvalue "" -command getFilename1
ttk::label .f.spectralLabel -text "Spectral"
ttk::checkbutton .f.spectral -onvalue "-s" -offvalue "" -command getFilename2 

ttk::label .f.gretagNumLabel -text "Gretag #"
ttk::label .f.gretagLabel0 -text "1"
ttk::radiobutton .f.gretagRadio0 -variable gretagNum -value "/dev/ttyS0" 
ttk::label .f.gretagLabel1 -text "2"
ttk::radiobutton .f.gretagRadio1 -variable gretagNum -value "/dev/ttyS1"
ttk::label .f.gretagLabel2 -text "3"
ttk::radiobutton .f.gretagRadio2 -variable gretagNum -value "/dev/ttyS2" 
ttk::label .f.gretagLabel3 -text "4"
ttk::radiobutton .f.gretagRadio3 -variable gretagNum -value "/dev/ttyS3" 
ttk::label .f.gretagLabel4 -text "5"
ttk::radiobutton .f.gretagRadio4 -variable gretagNum -value "/dev/ttyS4" 

ttk::label .f.sampleSize -text "Sample Size"
ttk::label .f.samplex -text "X"
ttk::label .f.sampley -text "Y"
ttk::entry .f.x -textvariable x -width 5 
ttk::entry .f.y -textvariable y -width 5 

ttk::label .f.filterLabel -text "Filter Type"
ttk::label .f.filterLabel0 -text "D50"
ttk::radiobutton .f.filterRadio0 -variable filter -value "-d50" 
ttk::label .f.filterLabel1 -text "D65"
ttk::radiobutton .f.filterRadio1 -variable filter -value "-d65" 
ttk::label .f.filterLabel2 -text "Unfiltered"
ttk::radiobutton .f.filterRadio2 -variable filter -value "-U" 
ttk::label .f.filterLabel3 -text "Polarized"
ttk::radiobutton .f.filterRadio3 -variable filter -value "-p" 

ttk::label .f.baudLabel -text "Baud Rate"
ttk::label .f.baudLabel0 -text "4800"
ttk::radiobutton .f.baudRadio0 -variable baud -value "B4800" 
ttk::label .f.baudLabel1 -text "9600"
ttk::radiobutton .f.baudRadio1 -variable baud -value "B9600" 
ttk::label .f.baudLabel2 -text "19200"
ttk::radiobutton .f.baudRadio2 -variable baud -value "B19200" 
ttk::label .f.baudLabel3 -text "38400"
ttk::radiobutton .f.baudRadio3 -variable baud -value "B38400" 
ttk::label .f.baudLabel4 -text "57600"
ttk::radiobutton .f.baudRadio4 -variable baud -value "B57600" 

ttk::button .f.submitBtn -text "Submit" -command finish

grid columnconfigure . 0 -weight 1
grid rowconfigure . 0 -weight 1
grid .f -column 0 -row 0 -columnspan 11 -rowspan 5

grid .f.dataLabel -column 0 -row 0 -sticky we
grid .f.colorimetricLabel -column 1 -row 0 -sticky e
grid .f.colorimetric -column 2 -row 0 -sticky w
grid .f.spectralLabel -column 3 -row 0 -sticky e
grid .f.spectral -column 4 -row 0 -sticky w

grid .f.gretagNumLabel -column 0 -row 1 -sticky we
grid .f.gretagLabel0 -column 1 -row 1 -sticky e
grid .f.gretagRadio0 -column 2 -row 1 -sticky w
grid .f.gretagLabel1 -column 3 -row 1 -sticky e
grid .f.gretagRadio1 -column 4 -row 1 -sticky w
grid .f.gretagLabel2 -column 5 -row 1 -sticky e
grid .f.gretagRadio2 -column 6 -row 1 -sticky w
grid .f.gretagLabel3 -column 7 -row 1 -sticky e
grid .f.gretagRadio3 -column 8 -row 1 -sticky w
grid .f.gretagLabel4 -column 9 -row 1 -sticky e
grid .f.gretagRadio4 -column 10 -row 1 -sticky w

grid .f.sampleSize -column 0 -row 2 -sticky we
grid .f.samplex -column 1 -row 2 -sticky e
grid .f.x -column 2 -row 2 -sticky w
grid .f.sampley -column 3 -row 2 -sticky e
grid .f.y -column 4 -row 2 -sticky w

grid .f.filterLabel -column 0 -row 3 -sticky we
grid .f.filterLabel0 -column 1 -row 3 -sticky e
grid .f.filterRadio0 -column 2 -row 3 -sticky w
grid .f.filterLabel1 -column 3 -row 3 -sticky e
grid .f.filterRadio1 -column 4 -row 3 -sticky w
grid .f.filterLabel2 -column 5 -row 3 -sticky e
grid .f.filterRadio2 -column 6 -row 3 -sticky w
grid .f.filterLabel3 -column 7 -row 3 -sticky e
grid .f.filterRadio3 -column 8 -row 3 -sticky w

grid .f.baudLabel -column 0 -row 4 -sticky we
grid .f.baudLabel0 -column 1 -row 4 -sticky e
grid .f.baudRadio0 -column 2 -row 4 -sticky w
grid .f.baudLabel1 -column 3 -row 4 -sticky e
grid .f.baudRadio1 -column 4 -row 4 -sticky w
grid .f.baudLabel2 -column 5 -row 4 -sticky e
grid .f.baudRadio2 -column 6 -row 4 -sticky w
grid .f.baudLabel3 -column 7 -row 4 -sticky e
grid .f.baudRadio3 -column 8 -row 4 -sticky w
grid .f.baudLabel4 -column 9 -row 4 -sticky e
grid .f.baudRadio4 -column 10 -row 4 -sticky w

grid .f.submitBtn -column 1 -row 5 -columnspan 7 -sticky we

foreach w [winfo children .f] {grid configure $w -padx 5 -pady 5}
focus .f.colorimetric
.f.colorimetric state selected
.f.filterRadio1 state selected
.f.baudRadio1 state selected
bind . <Return> {finish}

proc getFilename1 {} {
set filename1 [tk_getSaveFile]
}

proc getFilename2 {} {
set filename2 [tk_getSaveFile]
}

proc finish {} {
.f.x insert 0 "-x"
.f.y insert 0 "-y"
# Pick one
# puts $colorimetric
# puts colorimetric
# puts "$colorimetric"
# puts $::colorimetric
# puts .f.colorimetric
# puts $.f.colorimetric
# puts $::.f.colorimetric
# puts "$::colorimetric"
exec ./gretag .f.colorimetric filename1 .f.spectral filename2 .f.gretagNum .f.x .f.y .f.filter .f.baud
} 
```

* * *

**编辑：** 我已经发布了所有代码而不仅仅是部分代码，在最后一行的下一行是我尝试过的选项 #1 中的各种语法，以便在变量传递给之前查看它们的值下一个节目。这些都不起作用，我不明白为什么或如何解决它。我希望另一双眼睛能发现问题所在。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-05T19:00:26.267

## 变量基础

正如其他人指出的那样，可以通过以下规则简化**对 $ 或不是 $表示法的混淆。**

> **var**是对变量本身的引用，而不是它的值
> 
> **$var**产生变量中保存的值

当您开始将 Tcl 中的所有内容都视为字符串时，它会变得更加混乱（实际上不是，但足够接近），因此您可以将一个变量的名称存储在另一个变量中并通过引用恢复它的值。

```
% set foo "hi"
hi
% set bar "foo"
foo
% set $foo
can't read "hi": no such variable
% set $bar
hi 
```

在这里，符号`set $foo`被逐步计算——首先`$foo`产生它的值`hi`，然后`set`表达式（当没有第三个参数运行时）尝试返回变量中保存的值`hi`。这失败了。该表示法`set $bar`采用相同的步骤，但这次`set`可以对`bar`, which is的值进行操作`foo`，从而返回 is 的`foo`值`hi`。[（链接到“设置”API）](http://tcl.tk/man/tcl8.5/TclCmd/set.htm)

## 初始化

您在此脚本中遇到的一个问题是初始化。在 Tcl 中，变量在被赋值之前是不存在的。这显然是为什么尝试`set $foo`上面没有工作，因为没有 variable `hi`。

在脚本的顶部，您尝试声明一个变量，

```
global colorimetric 
```

这不起作用，因为您已经在全球范围内运作。全局“除非在 proc 主体的上下文中执行，否则无效。” [（链接到“全局”API）](http://tcl.tk/man/tcl8.5/TclCmd/global.htm)您实际上必须使用`set`命令来初始化变量。这就是为什么您的打印尝试都没有成功的`colorimetric`原因`proc finish`。

## 范围

您在此脚本中遇到的另一个问题是范围，特别是在混合全局和程序/本地范围时。你是对的，如果你`colorimetric`正确初始化了代码，

```
puts $::colorimetric ;# print the value of the global variable colorimetric 
```

本来可以的。实现这一目标的另一种方法是，

```
global colorimetric ;# reference a global variable into the local scope
puts $colorimetric  ;# print the value of colorimetric in the local scope 
```

## 我的解决方案

我想介绍我的解决方案。我承认我已经移动了很多代码，我将简要解释我实施了哪些更改以使其更简洁。

```
#!/usr/bin/env wish

# --- default configuration --- #
array set CONF {
    colorimetric "-c"
    spectral     ""
    cfilename    "/path/to/defaultCI.txt"
    sfilename    ""
    x            0
    y            0
    gretagnum    "/dev/ttyS0"
    filter       "-d65"
    baud         "B9600"
}

# --- build the interface --- #
wm title . "Gretag"
ttk::frame .f -borderwidth 5 -relief sunken -padding "5 10"
grid columnconfigure . 0 -weight 1
grid rowconfigure    . 0 -weight 1
grid .f

ttk::label .f.dataLabel -text "Data Type: "
foreach {dtname dttag dtfile} {
    colorimetric "-c" cfilename
    spectral     "-s" sfilename
} {
    lappend mygrid [
        ttk::checkbutton .f.$dtname -text [string totitle $dtname] \
        -variable CONF($dtname) -onvalue $dttag -offvalue "" \
        -command [list getFilename $dtname $dttag $dtfile ]
    ]
}
grid .f.dataLabel {*}$mygrid -sticky w ; set mygrid { }

ttk::label .f.gretagNumLabel -text "Gretag #: "
for {set tty 0} {$tty < 5} {incr tty} {
    lappend mygrid [
        ttk::radiobutton .f.gretagRadio$tty -text [expr $tty + 1] \
        -variable CONF(gretagnum) -value "/dev/ttyS$tty" 
    ]
}
grid .f.gretagNumLabel {*}$mygrid -sticky w ; set mygrid { }

ttk::label .f.sampleSize -text "Sample Size: "
ttk::label .f.samplex -text "X"
ttk::label .f.sampley -text "Y"
ttk::entry .f.x -textvariable CONF(x) -width 5 
ttk::entry .f.y -textvariable CONF(x) -width 5 
grid .f.sampleSize .f.samplex .f.x .f.sampley .f.y

ttk::label .f.filterLabel -text "Filter Type: "
foreach {ftname ftval} {
    D50        "-d50"
    D65        "-d65"
    Unfiltered "-U"
    Polarized  "-P"
} {
    lappend mygrid [
        ttk::radiobutton .f.filterRadio$ftname -text $ftname \
        -variable CONF(filter) -value $ftval
    ]
}
grid .f.filterLabel {*}$mygrid -sticky w ; set mygrid { }

ttk::label .f.baudLabel -text "Baud Rate: "
foreach {baud} {
    4800 9600 19200 38400 57600
} {
    lappend mygrid [
        ttk::radiobutton .f.baudRadio$baud -text $baud \
        -variable CONF(baud) -value "B$baud"
    ]
}
grid .f.baudLabel {*}$mygrid -sticky w ; set mygrid { }

ttk::button .f.submitBtn -text "Submit" -command submit
grid .f.submitBtn -columnspan 6 -sticky we

foreach w [winfo children .f] {
    grid configure $w -padx 5 -pady 5
}
focus .f.colorimetric
bind . <Return> submit

# --- callbacks --- #
proc getFilename {type tag file} {
    global CONF

    if {$CONF($type) eq $tag} {
        set CONF($file) [tk_getOpenFile]
        if {$CONF($file) eq ""} { .f.$type invoke }
    } else {
        set CONF($file) ""
    }
}

proc submit { } {
    global CONF

    exec ./gretag $CONF(colorimetric) $CONF(cfilename) \
        $CONF(spectral) $CONF(sfilename) $CONF(gretagnum) \
        $CONF(x) $CONF(y) $CONF(filter) $CONF(baud)
} 
```

## 变更讨论

**1.**我所做的第一个更改是使用 和上的`-text`选项。当然，为这些使用额外的标签可以让您将文本放在按钮之前，但这样做是非标准的并且需要更多代码。`ttk::checkbutton``ttk::radiobutton`

```
ttk::label .f.colorimetricLabel -text "Colorimetric"
ttk::checkbutton .f.colorimetric -onvalue "-c" -offvalue "" -command getFilename1 
```

变成

```
ttk::checkbutton .f.colorimetric -text "Colorimetric" -onvalue "-c" -offvalue "" -command getFilename1 
```

* * *

**2.**接下来我利用这两个checkbutton的相似性将创建抽象成一个foreach。（我一直在我的 Tcl 代码中这样做。）这会生成更易于阅读的代码，并允许您添加/删除/交换小部件的名称和标签。它会产生更多但更通用的代码。

```
ttk::checkbutton .f.colorimetric -text "Colorimetric" -onvalue "-c" -offvalue "" -command getFilename1
ttk::checkbutton .f.colorimetric -text "Spectral" -onvalue "-s" -offvalue "" -command getFilename2 
```

变成

```
foreach {dtname dttag dtcommand} {
    colorimetric "-c" getFilename1
    spectral     "-s" getFilename2
} {
        ttk::checkbutton .f.$dtname -text [string totitle $dtname] -onvalue $dttag -offvalue "" -command $dtcommand
} 
```

* * *

**3.**下一个变化是将你的`getFilename1`和合并`getFilename2`成一个`getFilename`程序中。我们可以将参数传递给这个函数来确定谁在调用它。我使用该`list`命令来生成对这个新函数的调用。[（链接到“列表”API）](http://tcl.tk/man/tcl8.5/TclCmd/list.htm)

我也开始结合你的`grid`命令组合到小部件代码本身中。这里`mygrid`保留了 GUI 中每行需要网格化的列表，然后在每个部分的末尾进行评估以动态传播 GUI。[（链接到“网格”API）](http://tcl.tk/man/tcl8.5/TkCmd/grid.htm)

之前的代码得到了它的最终版本，变成了，

```
foreach {dtname dttag dtfile} {
    colorimetric "-c" cfilename
    spectral     "-s" sfilename
} {
    lappend mygrid [
        ttk::checkbutton .f.$dtname -text [string totitle $dtname] -variable CONF($dtname) -onvalue $dttag -offvalue "" -command [list getFilename $dtname $dttag $dtfile ]
    ]
} 
```

然后`grid`可以评估命令并且`mygrid`在每次使用后清除变量！

* * *

**4.**如果您一直在关注我还添加了一个`-variable`选项到您的`ttk::checkbutton`此时开始将按钮状态存储在全局变量`CONF`中。这是一个很大的变化。

Tk 喜欢污染你的全局命名空间，反击是一个好习惯。我通常将所有配置状态放在一个全局数组中，并将其设置在代码的顶部，这样任何人都可以进入并更改我的代码的默认状态，而无需深入研究或进行搜索/替换调用或类似的操作那。只是很好的做法，所以无论你有一个变量，我都会把它移到顶部`CONF`并移到`CONF`顶部。

```
array set CONF {
    colorimetric "-c"
    spectral     ""
    cfilename    "/path/to/defaultCI.txt"
    sfilename    ""
    x            0
    y            0
    gretagnum    "/dev/ttyS0"
    filter       "-d65"
    baud         "B9600"
} 
```

* * *

**5.**接下来，我将这些更改传播到您的代码中。几乎所有的小部件创建都容易受到这些修订的影响。关于小部件的创建，这有时会使独立的代码部分变大。但它也允许我删除你的整个网格部分，将这段代码合并到我已经讨论过的小部件代码中，大大减少了代码的大小和混乱，但增加了复杂性。

* * *

**6.**我做的最后修改是对你的函数代码。您的代码中有几个小`getFilename1`错误`getFilename2`。第一个错误是您想调用`tk_getOpenFile`，因为我认为您只是在获取现有文件名以将其传递给`gretag`. [（链接到 'tk_getOpenFile' API）](http://tcl.tk/man/tcl8.5/TkCmd/getOpenFile.htm)如果你使用`tk_getOpenFile`对话框，将确保文件存在。

第二个错误`getFilename1`是对话框有一个`Cancel`按钮，如果用户单击此取消按钮，对话框将返回一个空字符串。在这种情况下，您必须取消选中`ttk::checkbutton`并且必须取消设置`CONF(colorimetric)`变量。或者更准确地说，您必须设置`CONF(colorimetric)`为按钮的`-offvalue`. 您可以通过向当前按钮发送点击事件来同时完成这两项操作。

```
proc getFilename1 {} {
set filename1 [tk_getSaveFile]
} 
```

变成

```
proc getFilename {type tag file} {
    global CONF

    if {$CONF($type) eq $tag} {
        set CONF($file) [tk_getOpenFile]
        if {$CONF($file) eq ""} { .f.$type invoke }
    } else {
        set CONF($file) ""
    }
} 
```

在你的`finish`函数中，我将函数重命名为`submit`(sorry) 并重写它以使用新的`CONF`变量。

## 答案

当然，大部分都是不必要的。我想给你一些有趣的 Tcl/Tk 代码来思考，同时解决你的问题。不过，在这一点上，我们应该有词汇来回答你的问题。

您的变量没有打印出来的原因是因为初始化和范围。您应该始终在稍后需要引用的小部件上使用`-variable`或。`-textvariable`我通常在构建它们包含的小部件之前初始化我的引用变量。所以如果你已经完成了，在你文件的顶部，

```
set colorimetric "-c"
ttk::checkbutton .f.colorimetric -variable colorimetric [...] 
```

那么你就可以在`finish`函数中做到，

```
puts $::colorimetric 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T07:18:45.737

您尚未将任何变量分配给比色检查按钮。将 -variable colorimetric 添加到检查按钮，然后在完成时您可以使用： puts $::colorimetric

此外，首先设置 ::colorimetric 以选择您的默认值。这比试图弄乱小部件的状态更容易。

我看到 colorimetric 可以具有的值是“”和“-c”，所以我假设您将在 exec 行中使用该值。请注意 [exec something yada $::colorimetric something] 可能无法正常工作。如果参数为空，您可能需要在 exec 行中使用 {*}$::colorimetric 以使参数消失。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T22:57:34.610

这是一个小 tcl 片段 - 从 tclsh 运行或希望

```
[nigel@rose ~]$ wish
% set foo /dev/ttys0
/dev/ttys0
% puts $foo
/dev/ttys0
% puts "$foo"
/dev/ttys0
% puts [$foo]
invalid command name "/dev/ttys0"
% puts ($foo)
(/dev/ttys0)
% puts {$foo}
$foo
% 
```

在 Tcl 中引用：

*   `""`（双引号）：评估替换（$variable）

*   `{}`{Squiggly 括号)：将整个字符串视为没有替换的文字

*   `[]`（方括号）：将字符串作为替换命令执行

作为替代方案，您可以在对话框中弹出诊断：

```
% set mb [tk_messageBox -message "Port is $foo" -type ok -icon info]
ok
% 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T21:33:02.677

我不确定你想做什么，如果你结束打印变量名而不是变量内容，请使用**set**命令*作为函数*：

设置内容“你好”

设置废话内容

如果你这样做：

```
puts $blah 
```

.. 你得到 blah 变量的内容，即内容。

要通过 blah 获取变量 content 的内容，请使用以下命令：

```
puts [set $blah] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T07:53:13.953

只要记住这条规则，你就会永远做对：

```
$foo is shorthand for [set foo] 
```

尝试使用 [set foo] 重写您的代码，它会起作用。

尤其是，

```
$$foo  ;# not what you think 
```

被替换为

```
[set [set foo]]   ;# does what you think 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-26T10:26:25.780

在您的“# Just here”评论中，尝试添加

放 $::gretagNum

:: 表示全局变量，小部件的 -variable 选项始终是全局的。

# javascript - jQuery隐藏使用ID

> ID：392277
> 
> 赞同：2
> 
> 时间：2008-12-24T22:14:48.113
> 
> 标签：javascript, jquery

我正在尝试使用带有 jquery 的 id 更改图像的边框颜色（ photo['id'] 是从以前的函数传入的）照片的 id 的形式为“photo239839”

```
 $('#photo'+photo['id']+'').click(function(){  
       $('#photo'+photo['id']+'').css('border-color','#777');

    }); 
```

当我尝试使用它的类使用相同的代码时，它可以工作，但我不能使用这种方法，因为同一页面上有多个图像具有相同的类

```
$('img.flickr_photo').click(function() {
    $("this.flickr_photo").css('border-color','#777');
}); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-24T22:33:25.767

这是你需要做的：

```
$('img.flickr_photo').click(function(){  
       $(this).css('border-color','#777');
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T18:52:44.680

我总是会添加一个 CSS 类而不是内联样式。更具可维护性和可扩展性。

例子：

```
$('img.flickr_photo').click(function(){  
       $(this).addClass('greyishBorder');
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T22:41:45.077

photo['id'] 是错误的，或者在您设置点击处理程序后正在更改。

要测试第一种情况，您可以警告（或带有 FireBug 的 console.log 或其他）jQuery 选择的长度：

```
alert($('#photo'+photo['id']).length); 
```

第二种情况的解决方案是使用“this”。在单击处理程序中，“this”设置为导致单击事件的元素。

```
$('#photo'+photo['id']).click(function(){  
   $(this).css('border-color','#777');
}); 
```

**编辑：** @Dreas Grech 是对的，只要您想将行为应用于具有 flickr_photo 类的所有元素。如果您可以概括选择器以通过单个查询选择*所有元素，那么最好这样做。*

# web - 使用 Windows Live Writer 作为网站内容编辑器

> ID：392283
> 
> 赞同：1
> 
> 时间：2008-12-24T22:17:25.767
> 
> 标签：web, wysiwyg

您对使用与您的网站进行通信的 Windows Live Writer 作为内容编辑系统有何想法？

Windows Live Writer支持多分类博客（即可以是新闻、文章、博客）、多分类页面、标签、XHTML所见即所得编辑、通过服务或ftp上传图片和文件，客户端有“插入HTML”插件库，其中包含许多已为流行站点开发的插件。

最棘手的部分是在您的服务中实现所有 XmlRpc 方法，但是使用 Reflector 进行的一些挖掘发现它们很容易实现这些功能。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-31T19:57:36.310

我考虑过，但这有点像将三角形放入圆孔中。它会适合，但不完全正确。由于主要关注博客，如果您以页面编辑器的身份呈现给某人，页面编辑将是反直觉的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T20:00:28.753

好吧，如果网站的正常更新模式是发布新的“新闻”，也就是博客文章，那么页面编辑就变成了更新静态内容的次要内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-20T19:48:41.907

我在想同样的事情。使用 Windows Live Writer 或 MS Word 2007（它也支持 Atom Publishing）来编辑网站上的 Web 材料（理论上）会很棒，对吧？

我尝试研究创建一个 AtomPub 服务器（使用 Google Data API、Apache Abdera 或 Project ROME），以在 Java Google App Engine 上创建一个简单的 atom 发布服务器后端。它将实体和图像保存到 GAE 数据存储中。保存的数据可以通过网站上的简单前端显示。所有编辑都将在 MS Word 中完成。

但是创建一个自定义的 Atom pub 服务器对我来说非常困难。我现在就认输，至少对于 AtomPub 协议是这样。对于 Windows Live Writer 来说，像 CRUD 实体接口这样极其简单的东西可能仍然是可能的，因为它支持更简单的协议。

据我所知，GAE 还没有这样做。不过，Umbraco ASP.net CMS 支持它。

# .net - ADO.NET 实体框架和 Linq to Entity

> ID：392291
> 
> 赞同：4
> 
> 时间：2008-12-24T22:28:54.590
> 
> 标签：.net, entity-framework, linq-to-entities

我对 Linq to Entity 感到困惑。是实体框架的新名称还是它们不同？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T22:34:41.333

当用于查询实体框架时，LINQ to Entities 实际上只是标准的 LINQ 扩展方法（Where、OrderBy 等）。这不是唯一的选择；EF 也可以在 SQL[实体 SQL](http://msdn.microsoft.com/en-us/library/bb387145.aspx)的自定义方言中进行查询。实际上，LINQ 扩展方法用于生成 Entity SQL，然后将该 Entity SQL 传递给提供者。

这样，实现新的 EF 提供程序的人（因为它是可扩展的）只需要担心一件事来进行查询：实体 SQL。

当然，要*严格*算作LINQ，你也需要使用*语言*部分，即

```
from product in db.Products
     where product.IsActive
     select product.Name; 
```

等等 - 但由于这归结为扩展方法（在`Queryable`/上`IQueryable<T>`），大多数人会将直接扩展使用视为 LINQ - 即

```
var qry = db.Products.Where(x=>x.IsActive).Select(x=>x.Name); 
```

# algorithm - 如何测试哈希函数？

> ID：392304
> 
> 赞同：26
> 
> 时间：2008-12-24T22:50:59.367
> 
> 标签：algorithm, unit-testing, language-agnostic, testing, hash

有没有办法测试哈希函数的质量？我希望在哈希表中使用时有一个很好的传播，如果这在单元测试中是可验证的，那就太好了。

**编辑**：为了澄清起见，我的问题是我`long`在 Java 中使用值的方式是前 32 位编码一个 ID，第二个 32 位编码另一个 ID。不幸的是，Java 的长值散列只是将第一个 32 位与第二个 32 位进行异或，在我的情况下，这导致在`HashMap`. 所以我需要一个不同的哈希，并且想要一个单元测试，这样这个问题就不会再蔓延了。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-24T23:23:59.423

您必须使用从您期望它工作的相同（或相似）分布中提取的数据来测试您的哈希函数。在查看 64 位 long 的散列函数时，如果输入值是从所有可能的 long 值中统一提取的，则默认的 Java 散列函数非常出色。

但是，您已经提到您的应用程序使用 long 来存储两个独立的 32 位值。尝试生成与您期望实际使用的值相似的值样本，然后用它进行测试。

对于测试本身，获取您的样本输入值，对每个值进行哈希处理并将结果放入一组中。计算结果集的大小并将其与输入集的大小进行比较，这将告诉您哈希函数正在生成的冲突次数。

对于您的特定应用程序，不要简单地将它们异或在一起，而是尝试以典型的良好哈希函数将两个独立整数组合在一起的方式组合 32 位值。即乘以一个素数，然后相加。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-24T23:01:36.287

首先，我认为您必须定义对自己的良好传播的含义。您的意思是对所有可能的输入进行良好的传播，还是对可能的输入进行良好的传播？

例如，如果您正在对代表正确全名（名字+姓氏）的字符串进行哈希处理，您可能不会关心数字 ASCII 字符如何哈希处理。

至于测试，你最好的办法是得到一个你期望的巨大或随机的输入数据集，然后通过散列函数推送它，看看传播结果如何。不可能有一个神奇的程序可以说“是的，这对你的用例来说是一个很好的散列函数。”。但是，如果您可以以编程方式生成输入数据，您应该能够轻松地创建一个生成大量数据的单元测试，然后验证传播是否在您的良好定义范围内。

**编辑：**在您的 64 位长的情况下，是否真的有理由使用哈希映射？为什么不直接使用平衡树，直接使用 long 作为键而不是重新散列呢？您会在整体节点大小上付出一点代价（键值大小的 2 倍），但最终可能会节省性能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-24T23:01:20.203

如果您使用链式哈希表，那么您真正关心的是冲突的数量。这将是微不足道的实现为您的哈希表上的一个简单的计数器。每次插入一个项目并且表必须链接时，增加一个链计数器。更好的散列算法将导致更少的冲突。一个很好的通用表散列函数是：[djb2](http://www.cse.yorku.ca/~oz/hash.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T20:04:00.840

根据您的说明：

> 我在 Java 中使用长值的方式是，前 32 位编码一个 ID，第二个 32 位编码另一个 ID。不幸的是，Java 的长值散列只是将第一个 32 位与第二个 32 位进行异或，在我的情况下，这在 HashMap 中使用时导致性能非常差。

看来您在分配两个 ID 值的方式与 HashMap 实例的大小之间存在一些不愉快的“共鸣”。

您是明确调整地图的大小，还是使用默认值？QAD 检查似乎表明 a`HashMap<Long,String>`以 16 桶结构开始，溢出时翻倍。这意味着只有 ID 值的低位实际上参与了哈希桶的选择。您可以尝试使用带有初始大小参数的构造函数之一，并使用初始大小创建地图。

或者，Dave L 关于定义自己的长键散列的建议将允许您避免低位依赖性问题。

Another way to look at this is that you're using a primitive type (long) as a way to avoid defining a real class. I'd suggest looking at the benefits you could achieve by defining the business classes and then implementing hash-coding, equality, and other methods as appropriate on your own classes to manage this issue.

# emacs - 在 Emacs 中保存窗口配置

> ID：392314
> 
> 赞同：20
> 
> 时间：2008-12-24T22:58:55.713
> 
> 标签：emacs, dot-emacs

我想知道是否有一种方法可以跨 emacs 会话保存窗口配置。我知道桌面保存非常适合保存缓冲区和诸如此类的东西，并且 emacs 手册演示了将窗口配置存储到寄存器中，但这不会在会话中持续存在。

当然，这似乎并不难实现我自己......

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-25T02:45:10.767

EmacsWiki 是一个很好的资源：[EmacsWiki：会话管理](http://www.emacswiki.org/emacs/SessionManagement)

看起来像[Windows Mode](http://www.emacswiki.org/emacs/WindowsMode)，或者更具体地说是 revive.el，是你想要的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-05-10T17:32:38.423

自 2008 年以来发生了很多变化，`desktop-save-mode`现在还可以跨会话恢复帧。Emacs 24.4 及更高版本。

# asp.net-mvc - 如何根据 IFrame 切换母版页

> ID：392315
> 
> 赞同：1
> 
> 时间：2008-12-24T22:58:58.397
> 
> 标签：asp.net-mvc, iframe

我想在我的 ASP.Net MVC 应用程序中使用 IFrame，但我想在通过直接访问（搜索引擎）导航内部页面时保留布局。

如何根据视图是在 IFrame 还是顶级窗口中切换母版页？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T22:51:22.293

您在控制器 Action 中返回的 ViewResult 具有 MasterName 属性。让您的控制器操作接收一个参数，告诉它您是否在 IFrame 中，然后您可以执行

```
if (isInIFrame)
{
    ViewResult result = View();
    result.MasterName = "IFrameMaster";
    return result;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T14:10:03.157

单程：

将内容放在用户控件中。编写一个轻量级视图，它为 IFrame 版本和另一个顶级版本包装用户控件。

# asp.net-mvc - 模型背后/旁边的代码（.cs-aspx.cs-aspx）VS MVC模型，到底有什么区别？

> ID：392318
> 
> 赞同：3
> 
> 时间：2008-12-24T23:01:49.093
> 
> 标签：asp.net-mvc, model-view-controller, design-patterns

经典 .cs-aspx.cs-aspx（代码隐藏/旁注）模型和新 MVC 模型之间的基本区别是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-25T03:14:22.687

MVC 和经典 ASP 之间的基本区别在于，在经典 ASP 中，应用程序的所有代码和标记都存在于 .asp 文件中。在 MVC 中，.aspx 文件仅包含用于呈现页面的代码和标记。用于处理请求、检索模型数据和执行业务逻辑的应用程序的其余部分存在于控制器和模型类中。这些类比类 ASP 代码更容易测试，因为它与负责呈现视图的代码是分开的。

这种关注点分离是[MVC 模式](http://en.wikipedia.org/wiki/Model-view-controller)的基础。根据模式，代码分为三个主要组件——模型、视图和控制器。模型中的类代表应用程序的业务对象、持久性框架和应用于业务对象的业务逻辑。控制器中的类接受传入的请求，使用输入或查询参数来检索适当的模型数据，并生成视图呈现所需的数据。视图（aspx 页面）获取控制器提供的数据并生成标记。

Webforms（代码隐藏）介于经典 ASP 和 MVC 模式之间。Webforms 不像 MVC 那样强制关注点分离，但它确实允许更多代码存在于实际页面的“后面”。例如，您可以从负责生成视图的代码中分离出业务对象、业务逻辑和持久性框架（模型，如果您愿意的话）。困难在于控制器动作（输入处理和模型检索）仍然与视图渲染代码相关联。这种集成使测试该代码变得更加困难，并使视图/控制器代码彼此之间的依赖程度超出了必要的程度——关注点是“混合的”，而不是“分离的”。一般来说，

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-09T13:35:37.580

简单地说：MVC 是真正应该构建 Web 应用程序的方式。代码隐藏（asp.net web 表单）不是一个好习惯。如果您是真正的开发人员，您会意识到 MVC 是最佳实践，因为它真正将逻辑与数据和表示分离。简单的 MVC 是优雅而正确的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T14:27:41.393

了解 MVC 和 ASP（或 ASP.NET 形式）之间区别的一个非常简单的方法是，在 MVC 中，控制器是请求的处理程序。

请求被路由到控制器而不是“页面”或“表单”。控制器会将请求中的信息传递给模型，然后就应该使用哪个视图来呈现模型的所需状态做出一些简单的选择。请注意，这是控制器可以选择在响应中使用什么视图的重点。

MVC 打破了请求的 URL 和呈现特定数据表示所需的 UI 代码之间的关系。

# rdf - 有博客的 RDF 本体吗？

> ID：392321
> 
> 赞同：9
> 
> 时间：2008-12-24T23:06:25.370
> 
> 标签：rdf, blogs, semantic-web, rdfa

我正在建立一个博客，我对 RDF 和语义网的想法很着迷。我想使用 RDFa 将语义数据嵌入到我的博客中。有几种众所周知的语义网络本体，例如用于描述人的 FOAF、用于事件的 ical、用于地点的 geo。

有博客的本体吗？有话要说“这个网站是一个博客。Foo 是一个博客条目。Foo 发布于（日期在 ical 或其他任何地方），foo 有 X 条评论。Y 是对 Foo 的评论。Y 留在（此时）， Y被（某人）留下”？

**更新**：我知道都柏林核心，这似乎涵盖了我想要的很多东西（例如“这是在这个时候写的”、“这是由这个人写的”、“这个标题是什么”）。所以这大约是那里的75%。有什么可以完全标记博客的吗？把它带到一个新的水平？“这是一个博客”、“这是对此条目的评论”、“这是此博客引用的 URL”等？如果没有，我就自己做。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-20T02:09:31.417

[SIOC 本体](http://rdfs.org/sioc/spec/)可能是您正在寻找的。其目的是表达关于博客、论坛、维基和其他类型的社交媒体网站的信息。

有用的信息：

*   [SIOC 申请清单](http://rdfs.org/sioc/applications/)
*   [用于 WordPress 的 SIOC 插件](http://sioc-project.org/wordpress/)
*   [Firefox 的语义雷达扩展](https://addons.mozilla.org/en-US/firefox/addon/3886)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-12T21:13:58.720

看看 SIOC（语义互连在线社区）[http://sioc-project.org/](http://sioc-project.org/) 我认为这正是您想要的。

引用它们：

> SIOC（语义互连在线社区）核心本体提供了描述语义网上在线社区（例如，留言板、维基、博客等）信息所需的主要概念和属性。

如果您需要更多，还有其他取决于您的需要（用于标签或其他）大部分时间延长 FOAF/SIOC/...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T00:44:48.217

好吧，RDF 模式的优点之一是能够扩展它们，并且可以相互混合和匹配元素。所以你可以创建自己的，并使用现有的位。

所以我会使用[Dublin Core](http://dublincore.org/2008/01/14/dcterms.rdf#)的组合，用于文档、出版等，与[Friend Of A Friend](http://xmlns.com/foaf/spec/20071002.rdf)用于博客的人和社交方面。这是两个最常用的通用本体。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-18T14:24:29.027

[Schema.org](http://schema.org)[为博客和博客文章](http://schema.org/BlogPosting)发布了一个本体。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T04:54:14.343

几个月前，我做了一些涉及大量 RSS 提要的研究，我们遇到的最常见的模式（在 RSS 标签中交错）是Ali A 提到的[Dublin Core 。](http://dublincore.org/2008/01/14/dcterms.rdf#)

[我们对评论 RSS 提要的格式良好的 Web](http://wellformedweb.org/)标记最感兴趣，但 Dublin Core 的东西可能正是您要寻找的。它是目前最广泛用于博客的 RDF 模式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T09:28:56.607

[Less Talk, More Code](http://oxfordrepo.blogspot.com/) (by Ben O'Steen) 有一篇文章[Ditching the DB-based blog for a semantic blog，](http://oxfordrepo.blogspot.com/2008/04/ditching-db-based-blog-for-semantic-one.html) 它涵盖了很多需要的东西——值得一看。

# c# - 在 C# 中将像素数组转换为图像

> ID：392324
> 
> 赞同：3
> 
> 时间：2008-12-24T23:13:54.327
> 
> 标签：c#, java, arrays, pixels

我的 C# 程序中有一个像素数组，`int`我想将其转换为图像。问题是我正在将程序的 Java 源代码转换为等效的 C# 代码。在 java 中，该行读取将 int 像素数组显示到图像中：

```
Image output = createImage(new MemoryImageSource(width, height, orig, 0, width)); 
```

**有人可以告诉我 C# 等价物吗？**

这里 orig 是`int`像素数组。我搜索了 Bitmap 类，有一个方法被调用`SetPixel`，但问题是它需要 ax,y 坐标数。但是我的代码中有一个`int`像素数组。另一个奇怪的事情是我的 orig 数组有负数，它们离 255 很远。在 Java 中，情况相同（这意味着 C# 和 Java 中的数组具有相同的值）并且这些值在 Java 中工作正常。

但我无法将该行翻译成 C#。请帮忙。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T23:34:24.830

使用 WPF，您可以直接从数组创建位图（图像）。然后，您可以对该图像进行编码或显示或使用它：

```
int width = 200;
int height = 200;

//
// Here is the pixel format of your data, set it to the proper value for your data
//
PixelFormat pf = PixelFormats.Bgr32;
int rawStride = (width * pf.BitsPerPixel + 7) / 8;

//
// Here is your raw data
//
int[] rawImage = new int[rawStride * height / 4];

//
// Create the BitmapSource
//
BitmapSource bitmap = BitmapSource.Create(
    width, height,
    96, 96, pf, null,
    rawImage, rawStride); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T23:24:53.463

您可以使用[Bitmap.LockBits](http://msdn.microsoft.com/en-us/library/039882h3.aspx)获取位图数据，然后您可以直接操作，而不是通过 SetPixel。([如何使用 LockBits](http://msdn.microsoft.com/en-us/library/ms229672.aspx) )

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-26T11:12:03.283

我喜欢已经提出的 WPF 选项，但这里它使用`LockBits`and `Bitmap`：

```
 // get the raw image data
        int width, height;
        int[] data = GetData(out width, out height);

        // create a bitmap and manipulate it
        Bitmap bmp = new Bitmap(width,height, PixelFormat.Format32bppArgb);
        BitmapData bits = bmp.LockBits(new Rectangle(0, 0, width, height),
            ImageLockMode.ReadWrite, bmp.PixelFormat);
        unsafe
        {
            for (int y = 0; y < height; y++)
            {
                int* row = (int*)((byte*)bits.Scan0 + (y * bits.Stride));
                for (int x = 0; x < width; x++)
                {
                    row[x] = data[y * width + x];
                }
            }
        }
        bmp.UnlockBits(bits); 
```

使用（作为测试数据）：

```
 public static int[] GetData(out int width, out int height)
    {
        // diagonal gradient over a rectangle
        width = 127;
        height = 128;
        int[] data =  new int[width * height];
        for (int x = 0; x < width; x++)
        {
            for (int y = 0; y < height; y++)
            {
                int val = x + y;
                data[y * width + x] = 0xFF << 24 | (val << 16) | (val << 8) | val;
            }
        }
        return data;
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T23:25:27.330

好吧，我假设每个 int 都是复合 ARGB 值？如果没有一个简单的选项，那么[LockBits](https://web.archive.org/web/20141229164101/http://bobpowell.net/lockingbits.aspx)可能值得一看 - 它会比 快很多`SetPixel`，但更复杂。您还必须确保知道 int 是如何组成的（ARGB？RGBA？）。我会尝试看看是否有更明显的选择...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T23:37:29.677

我建议使用 LockBits，但基于 SetPixel 的较慢算法可能看起来像

```
 // width - how many int's per row        
// array - array of integers
Bitmap createImage(int width, int[] array)
{            
  int height = array.Length / width;
  Bitmap bmp = new Bitmap(width, height);
  for (int y = 0; y < height; y++)
  {
    for (int x = 0; x < array.Length; x += width)
    {
      bmp.SetPixel(x, y, Color.FromArgb(array[i]));
    }
  }
  return bmp;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T23:44:30.803

[MemoryImageSource](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/image/MemoryImageSource.html)的构造函数的第三个参数是一个由 argb 值按该顺序组成的整数数组

该页面中的示例通过以下方式创建了这样一个数组；

```
pix[index++] = (255 << 24) | (red << 16) | blue; 
```

您需要将该整数数组分解为字节数组（移位运算符会很有用），但它应该按 bgr 顺序排列，LockBits 方法才能工作。

# c++ - 如何在不使用 dbghelp.dll 的情况下在 Windows 上获取堆栈跟踪？

> ID：392327
> 
> 赞同：7
> 
> 时间：2008-12-24T23:16:31.170
> 
> 标签：c++, c, stack, stack-trace, dbghelp

如何在不使用 dbghelp.dll 的情况下获取 Windows 上的地址堆栈跟踪？

我不需要知道与地址关联的符号或函数名称，我只需要地址列表——类似于**[*nix 系统的回溯](http://www.gnu.org/software/libtool/manual/libc/Backtraces.html)**。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-24T23:42:07.797

查看 Kernel32.dll 中的[CaptureStackBackTrace()](http://msdn.microsoft.com/en-us/library/bb204633(VS.85).aspx)函数。这应该可以满足您的所有需求。

> 通过向上走堆栈并记录每一帧的信息来捕获堆栈回溯。

```
USHORT WINAPI CaptureStackBackTrace(
  __in       ULONG FramesToSkip,
  __in       ULONG FramesToCapture,
  __out      PVOID *BackTrace,
  __out_opt  PULONG BackTraceHash
); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T00:30:57.977

如果您想以*极其*不可移植的方式执行此操作，则可以只读取 EBP 寄存器并自己遍历堆栈。这仅适用于 x86 架构，并且它还假定您使用的 C 运行时在调用第一个函数之前将 EBP 正确初始化为 0。

```
uint32_t read_ebp(void)
{
    uint32_t my_ebp;
    __asm
    {
        mov ebp, my_ebp
    }

    return my_ebp;
}

void backtrace(void)
{
    uint32_t ebp = read_ebp();

    printf("backtrace:\n");

    while(ebp != 0)
    {
        printf("0x%08x\n", ebp);
        ebp = ((uint32_t *)ebp)[1];
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T17:54:51.977

以前的变体对我不起作用（msvc 6），所以：

```
unsigned long prev;
unsigned long addr;
__asm { mov prev, ebp }
while(addr!=0) { 
  addr = ((unsigned long *)prev)[1]; 
  printf("0x%08x\n", addr); 
  prev = ((unsigned long *)prev)[0]; 
} 
```

亚当，谢谢你强调的方式！

# svn - 使用 Git SVN 追溯更正作者？

> ID：392332
> 
> 赞同：52
> 
> 时间：2008-12-24T23:22:03.420
> 
> 标签：svn, git, git-svn

我有一个*已经*从 Subversion 克隆的存储库。我一直在以 Git 形式在这个存储库中做一些工作，我不想通过再次克隆来失去那个结构。

但是，当我最初克隆存储库时，我未能正确指定`svn.authors`属性（或语义相似的选项）。

既然存储库完全被 Git 化了，有什么方法可以指定 SVN 作者映射？

最好，我想更正所有旧的提交作者以代表 Git 作者，而不是原始的 SVN 用户名。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-12-25T01:52:40.467

首先查看您需要清理的内容：

```
git shortlog -s 
```

对于这些名称中的每一个，在一个如下所示的脚本中创建一个条目（假设您希望所有作者和提交者都相同）：

```
#!/bin/sh

git filter-branch --env-filter '

n=$GIT_AUTHOR_NAME
m=$GIT_AUTHOR_EMAIL

case ${GIT_AUTHOR_NAME} in
        user1) n="User One" ; m="user1@example.com" ;;
        "User Two") n="User Two" ; m="user2@example.com" ;;
esac

export GIT_AUTHOR_NAME="$n"
export GIT_AUTHOR_EMAIL="$m"
export GIT_COMMITTER_NAME="$n"
export GIT_COMMITTER_EMAIL="$m"
' 
```

这基本上是我最近用于[大型重写](http://groups.google.com/group/memcached/browse_thread/thread/a7b153bc087244b1)的脚本，与您描述的非常相似（除了我有大量作者）。

**编辑**Use π 在我的脚本中指出了一个引用问题。谢谢！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-24T23:49:45.550

[`git filter-branch`](http://SChacon.GitHub.Com/git/git-filter-branch.html)可用于重写大量历史。

在这种情况下，您可能会执行以下操作（完全未经测试）：

```
git filter-branch --env-filter '
    GIT_AUTHOR_NAME=`echo "${GIT_AUTHOR_NAME}" | sed -e "s/svnname1/Right Name/; s/svnname2/Correct Name/"`
    GIT_COMMITTER_NAME=`echo "${GIT_COMMITTER_NAME}" | sed -e "s/svnname1/Right Name/; s/svnname2/Correct Name/"`
    GIT_AUTHOR_EMAIL=`echo "${GIT_AUTHOR_EMAIL}" | sed -e "s/svnname1/m@i.l/; s/svnname2/correct.name@e.mail/"`
    GIT_COMMITTER_EMAIL=`echo "${GIT_COMMITTER_EMAIL}" | sed -e "s/svnname1/m@i.l/; s/svnname2/correct.name@e.mail/"`
' 
```

与往常一样，以下适用：为了改写历史，你需要一个[阴谋](http://SChacon.GitHub.Com/git/git-rebase.html#_recovering_from_upstream_rebase)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-24T23:36:52.893

您可能想研究[`git-filter-branch`](http://git-scm.com/docs/git-filter-branch)，特别是`--commit-filter`选项。该命令是一个强大的电锯，可以重写您的整个存储库历史记录，更改您可能想要更改的任何内容。

请注意，执行此操作时，您应该从更新的存储库中提取新的克隆，因为每次提交的 SHA1 哈希值可能已更改。

# jquery - Facebook Connect、jQuery UI 和 jQuery.noConflict()

> ID：392334
> 
> 赞同：6
> 
> 时间：2008-12-24T23:24:26.303
> 
> 标签：jquery, facebook, api, jquery-ui

我正在尝试在我的个人网站上建立一个使用`jQuery`和实现的页面`Facebook Connect`。

不幸的是，`Facebook client API`使用 the `$ token`，这意味着我必须打电话`jQuery.noConflict()`

不幸的是，我发现出于某种疯狂的原因，[正如 Rick Strahl 指出的那样，jQuery UI 不尊重 noConlict()。完全没有。](http://web.archive.org/web/20070722183917/http://west-wind.net/WebLog/posts/157705.aspx)其实看源码的话，`$`全是s。

我*真的*很想能够使用 jQuery UI - 特别是`dialog()`组件，而且`draggable`也非常好 - 但我更不想手动编辑 - 测试和维护 - 我自己的副本jQuery UI 的任何部分。

[这是我不得不刮胡子](http://projects.csail.mit.edu/gsb/old-archive/gsb-archive/gsb2000-02-11.html)的一系列牦牛中最近的一次，这让我束手无策。有什么建议么？帮助！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-25T04:28:10.840

您引用的帖子已经过时且过时了。该`1.0`版本`jQuery UI`在几个文件中包含此问题，并在报告后立即修复。

所有的 jQuery UI 都被包裹在一个`closure`传入 jQuery 的 as 中`$`，因此可以在内部使用 $ 而 $ 在外部用于其他东西。

来自[http://docs.jquery.com/Using_jQuery_with_Other_Libraries#Referencing_Magic_-_Shortcuts_for_jQuery](http://docs.jquery.com/Using_jQuery_with_Other_Libraries#Referencing_Magic_-_Shortcuts_for_jQuery)

> 使用以下技术，它允许您在代码块内使用 $ 而不会永久覆盖 $：
> 
> ```
> (function($) {
>   /* some code that uses $ */
> })(jQuery) 
> ```

注意：如果您使用这种技术，您仍然可以通过`window.$`例如`window.$('some_element_id')`. 闭包之外的任何引用的函数`$`都将调用 Prototype，即使从闭包内部调用也是如此。

这就是为什么您会`$`在 jQuery UI 文件中看到的原因，但请放心，任何最新版本`jQuery UI (1.5+)`都完全支持`jQuery.noConflict()`

# python - 在 Python 中修改闭包的绑定变量

> ID：392349
> 
> 赞同：52
> 
> 时间：2008-12-24T23:38:30.940
> 
> 标签：python, functional-programming, closures

有什么方法可以修改闭包内变量之一的绑定值？查看示例以更好地理解它。

```
def foo():
    var_a = 2
    var_b = 3

    def _closure(x):
        return var_a + var_b + x

    return _closure

localClosure = foo()

# Local closure is now "return 2 + 3 + x"
a = localClosure(1) # 2 + 3 + 1 == 6

# DO SOME MAGIC HERE TO TURN "var_a" of the closure into 0
# ...but what magic? Is this even possible?

# Local closure is now "return 0 + 3 + x"
b = localClosure(1) # 0 + 3 +1 == 4 
```

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-12-25T03:13:56.153

由于[nonlocal](http://jeremyhylton.blogspot.com/2007/02/nonlocal-implemented.html)的魔力，这在 python 3 中是很有可能的。

```
def foo():
        var_a = 2
        var_b = 3

        def _closure(x, magic = None):
                nonlocal var_a
                if magic is not None:
                        var_a = magic

                return var_a + var_b + x

        return _closure

localClosure = foo()

# Local closure is now "return 2 + 3 + x"
a = localClosure(1) # 2 + 3 + 1 == 6
print(a)

# DO SOME MAGIC HERE TO TURN "var_a" of the closure into 0
localClosure(0, 0)

# Local closure is now "return 0 + 3 + x"
b = localClosure(1) # 0 + 3 +1 == 4
print(b) 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-24T23:58:23.690

我认为在 Python 中没有任何方法可以做到这一点。定义闭包时，将捕获封闭范围内变量的当前状态，并且不再具有可直接引用的名称（来自闭包外部）。如果您要`foo()`再次调用，新的闭包将具有与封闭范围不同的一组变量。

在您的简单示例中，您最好使用一个类：

```
class foo:
        def __init__(self):
                self.var_a = 2
                self.var_b = 3

        def __call__(self, x):
                return self.var_a + self.var_b + x

localClosure = foo()

# Local closure is now "return 2 + 3 + x"
a = localClosure(1) # 2 + 3 + 1 == 6

# DO SOME MAGIC HERE TO TURN "var_a" of the closure into 0
# ...but what magic? Is this even possible?
localClosure.var_a = 0

# Local closure is now "return 0 + 3 + x"
b = localClosure(1) # 0 + 3 +1 == 4 
```

如果您确实使用了这种技术，我将不再使用该名称`localClosure`，因为它实际上不再是一个闭包。但是，它的工作原理与一个相同。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-25T00:08:52.250

我找到了 Greg's 的一个替代答案，稍微不那么冗长，因为它使用 Python 2.1 的自定义函数属性（可以从它们自己的函数内部访问，非常方便）。

```
def foo():
    var_b = 3

    def _closure(x):
        return _closure.var_a + var_b + x

    _closure.func_dict['var_a'] = 2
    return _closure

localClosure = foo()

# Local closure is now "return 2 + 3 + x"
a = localClosure(1) # 2 + 3 + 1 == 6

# DO SOME MAGIC HERE TO TURN "var_a" of the closure into 0
# ...but what magic? Is this even possible?
# apparently, it is
localClosure.var_a = 0

# Local closure is now "return 0 + 3 + x"
b = localClosure(1) # 0 + 3 +1 == 4 
```

以为我会发布它以确保完整性。反正干杯。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-08-03T17:44:46.333

我们做了以下事情。我认为它比这里的其他解决方案更简单。

```
class State:
    pass

def foo():
    st = State()
    st.var_a = 2
    st.var_b = 3

    def _closure(x):
        return st.var_a + st.var_b + x
    def _set_a(a):
        st.var_a = a

    return _closure, _set_a

localClosure, localSetA = foo()

# Local closure is now "return 2 + 3 + x"
a = localClosure(1) # 2 + 3 + 1 == 6

# DO SOME MAGIC HERE TO TURN "var_a" of the closure into 0
localSetA(0)

# Local closure is now "return 0 + 3 + x"
b = localClosure(1) # 0 + 3 +1 == 4

print a, b 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-01T23:31:30.040

我通过使用单项列表而不是普通变量来解决类似的限制。它很难看，但它可以工作，因为修改列表项不会被解释器视为绑定操作。

例如：

```
def my_function()
    max_value = [0]

    def callback (data)

        if (data.val > max_value[0]):
            max_value[0] = data.val

        # more code here
        # . . . 

    results = some_function (callback)

    store_max (max_value[0]) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-01-29T22:19:49.790

也许还有更进一步的方法（即使我的提议似乎为时已晚 :-)

```
def foo():
    def _closure(x):
        return _closure.var_a + _closure.var_b + x
    _closure.var_a = 2
    _closure.var_b = 3
    return _closure

localClosure = foo()

# Local closure is now "return 2 + 3 + x"
a = localClosure(1)  # 2 + 3 + 1 == 6
print(a)

# DO SOME MAGIC HERE TO TURN "var_a" of the closure into 0
# ...but what magic? Is this even possible?
localClosure.var_a = 0

# Local closure is now "return 0 + 3 + x"
b = localClosure(1)  # 0 + 3 +1 == 4
print(b) 
```

从我的角度来看，提出的类解决方案更容易阅读。但是如果你尝试在装饰器中修改一个自由变量，这个解决方案可能会派上用场：与基于类的解决方案相比，使用 functools.wraps 来保存装饰函数的元数据更容易。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T23:53:01.050

为什么不为函数 foo 创建 var_a 和 var_b 参数？

```
def foo(var_a = 2, var_b = 3):
    def _closure(x):
        return var_a + var_b + x
    return _closure

localClosure = foo() # uses default arguments 2, 3
print localClosure(1) # 2 + 3 + 1 = 6

localClosure = foo(0, 3)
print localClosure(1) # 0 + 3 + 1 = 4 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-09T17:25:59.590

```
def foo():
    var_a = 2
    var_b = 3

    def _closure(x):
            return var_a + var_b + x

    return _closure

def bar():
        var_a = [2]
        var_b = [3]

        def _closure(x):
                return var_a[0] + var_b[0] + x

        def _magic(y):
            var_a[0] = y

        return _closure, _magic

localClosureFoo = foo()
a = localClosureFoo(1)
print a

localClosureBar, localClosureBarMAGIC = bar()
b = localClosureBar(1)
print b
localClosureBarMAGIC(0)
b = localClosureBar(1)
print b 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-02T12:59:03.073

与所要求的略有不同，但您可以这样做：

```
def f():
    a = 1
    b = 2
    def g(x, a=a, b=b):
        return a + b + x
    return g

h = f()
print(h(0))
print(h(0,2,3))
print(h(0)) 
```

并使闭包成为默认值，在需要时被覆盖。

# c++ - 如何在不创建对象实例的情况下强制创建模板代码？

> ID：392359
> 
> 赞同：4
> 
> 时间：2008-12-24T23:52:13.453
> 
> 标签：c++

我有一个仅对几个模板参数有效的模板类：

做.h：

```
// only int and float are valid T
template <typename T>
class doer
{
public:
   void doIt();
} 
```

我想隐藏 .cpp 文件中的实现（为了更快的编译，也因为它是专有的）：

doIt.cpp:

```
template <>
void doer<T>::doIt()  {  /* how to do it */ } 
```

...并按如下方式使用它：use.cpp：

```
int main( int, char** )
{
   doer<int>::doIt()
} 
```

上面的链接失败是因为 void doer::doIt(void) 的实现从未在它被调用的地方的范围内。

我可以强制将代码生成到doItv2.obj中，如下：

doIt_v2.cpp：

```
template <>
void doer<T>::doIt()  {  /* how to do it */ }

doer<int> a;    
doer<real> b; 
```

但这会导致各种令人头疼的问题（进入 main 之前的动态内存分配），我实际上不想创建一个实例——我只想生成模板实例化的目标代码。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T23:55:50.450

请参阅文章[如何组织模板源代码](http://www.codeproject.com/KB/cpp/templatesourceorg.aspx)。我认为您正在使用那里描述的第二种方法：显式模板实例化。

# c# - 如何将整数数组分解为字节数组（像素编码）

> ID：392371
> 
> 赞同：1
> 
> 时间：2008-12-25T00:08:41.487
> 
> 标签：c#, arrays, rgb, pixels

嗨，很抱歉通过改写我的问题而烦人，但我只是在发现我的答案。

我有一个`int`由 RGB 值组成的数组，我需要将该`int`数组分解为一个字节数组，但它应该按 BGR 顺序排列。

由 RGB 值组成的 int 数组的创建方式如下：

```
pix[index++] = (255 << 24) | (red << 16) | blue; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-25T01:04:10.970

C# 代码

```
 // convert integer array representing [argb] values to byte array representing [bgr] values
        private byte[] convertArray(int[] array)
        {
            byte[] newarray = new byte[array.Length * 3];

            for (int i = 0; i < array.Length; i++)
            {

                newarray[i * 3] = (byte)array[i];
                newarray[i * 3 + 1] = (byte)(array[i] >> 8);
                newarray[i * 3 + 2] = (byte)(array[i] >> 16);

            }
            return newarray;
        } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T04:31:46.853

使用 Linq：

```
 pix.SelectMany(i => new byte[] { 
            (byte)(i >> 0),
            (byte)(i >> 8),
            (byte)(i >> 16),
        }).ToArray(); 
```

或者

```
 return (from i in pix
                from x in new[] { 0, 8, 16 }
                select (byte)(i >> x)
               ).ToArray(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T00:27:38.250

```
#define N something
unsigned char bytes[N*3];
unsigned int  ints[N];

for(int i=0; i<N; i++) {
    bytes[i*3]   = ints[i];       // Blue
    bytes[i*3+1] = ints[i] >> 8;  // Green
    bytes[i*3+2] = ints[i] >> 16; // Red
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-15T18:53:26.830

尝试使用缓冲区类

```
byte[] bytes = new byte[ints.Length*4];
Buffer.BlockCopy(ints, 0, bytes, 0, ints.Length * 4); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T00:28:23.957

`r = (pix[index] >> 16) & 0xFF`

其余类似，只需将 16 更改为 8 或 24 即可。

# c++ - 将while循环变成数学方程式？

> ID：392375
> 
> 赞同：16
> 
> 时间：2008-12-25T00:12:43.817
> 
> 标签：c++, c, algorithm, math

我的程序中有两个简单的 while 循环，我觉得应该是数学方程，但我正在努力转换它们：

```
float a = someValue;
int b = someOtherValue;
int c = 0;

while (a <= -b / 2) {
    c--;
    a += b;
}
while (a >= b / 2) {
    c++;
    a -= b;
} 
```

这段代码按原样工作，但我觉得它可以简化为数学方程。这里的想法是该代码采用偏移量 (someValue) 并调整坐标 (c) 以最小化与图块中心的距离（大小为 someOtherValue）。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-25T01:17:22.517

可以证明以下是正确的：

```
c = floor((a+b/2)/b)
a = a - c*b 
```

请注意， floor 表示向下舍入，朝向负无穷大：而不是朝向 0。（例如 floor(-3.1)=-4。`floor()`库函数会这样做；只要确保不要只转换为 int，它通常会向 0 舍入.)

大概`b`是严格肯定的，因为否则两个循环都不会终止：加法`b`不会`a`变大，减法`b`不会`a`变小。有了这个假设，我们可以证明上面的代码有效。（而且 paranoidgeek 的代码也几乎是正确的，除了它使用强制转换为 int 而不是`floor`.）

**证明它的聪明方法**`b`：代码添加或减去from `a`until `a`is in的倍数，您可以将其视为从until is in`[-b/2,b/2)`中添加或减去*整数*，即 until (调用它) is in 。由于您只是通过整数更改它，因此 的值不会更改，即它会变为**其余数 mod 1**，即。所以你做的有效减法数（即）是。`a/b``a/b``[-1/2,1/2)``(a/b+1/2)``x``[0,1)``x``mod 1`**`x-floor(x)``c``floor(x)`**

 ****繁琐的证明方法**：

[在第一个循环结束时， 的值为`c`循环运行次数的负数，即：]

*   0 如果：a > -b/2 <=> a+b/2 > 0
*   -1 如果：-b/2 ≥ a > -3b/2 <=> 0 ≥ a+b/2 > -b <=> 0 ≥ x > -1
*   -2 如果：-3b/2 ≥ a > -5b/2 <=> -b ≥ a+b/2 > -2b <=> -1 ≥ x > -2 等等，

其中`x = (a+b/2)/b`，所以 c 是：如果 x>0 则为 0，否则为 "ceiling(x)-1"。如果第一个循环完全运行，那么在*最后一次*执行循环之前它是≤-b/2，所以现在是≤-b/2+b，即≤b/2。根据它是否恰好是 b/2（即，`x`您开始时是否恰好是一个非正整数），第二个循环恰好运行 1 次或 0，并且 c 是上限（x）或上限（ x)-1。这样就解决了第一个循环确实运行的情况。

如果第一个循环没有运行，那么第二个循环结束时 c 的值是：

*   0 如果：a < b/2 <=> ab/2 < 0
*   1 如果： b/2 ≤ a < 3b/2 <=> 0 ≤ ab/2 < b <=> 0 ≤ y < 1
*   2 如果：3b/2 ≤ a < 5b/2 <=> b ≤ ab/2 < 2b <=> 1 ≤ y < 2，等等，

其中`y = (a-b/2)/b`, 所以 c 是：如果 y<0 则为 0，否则为 1+floor(y)。[`a`现在肯定是 < b/2 和 ≥ -b/2。]

所以你可以为 as 写一个表达式`c`：

```
x = (a+b/2)/b
y = (a-b/2)/b
c = (x≤0)*(ceiling(x) - 1 + (x is integer))
   +(y≥0)*(1 + floor(y)) 
```

当然，接下来你会注意到 that is 与which is`(ceiling(x)-1+(x is integer))`相同，实际上就是, so ，而对于条件句： 当 x≤0 时，它不可能是 that (y≥0)，所以只是第一项 is ， 当 0 < x < 1 时，这两个条件都不成立，因此，当 1 ≤ x 时，则只有 0≤y，所以 c 只是第二项，又是。所以 c =在所有情况下。 `floor(x+1)-1``floor(x)``y``x-1``(1+floor(y))=floor(x)`
`c``floor(x)`
`c``0`
`floor(x)``floor(x)`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T00:43:29.233

```
c = (int)((a - (b / 2)) / b + 1);
a -= c * b; 
```

[http://pastebin.com/m1034e639](http://pastebin.com/m1034e639)上的测试用例

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T00:35:16.910

我想你想要这样的东西：

```
c = ((int) a + b / 2 * sign(a)) / b 
```

这应该与您的循环匹配，除了 b 为奇数的某些情况，因为当 b 为奇数时，从 -b/2 到 b/2 的范围小于 b。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T00:38:35.980

假设 b 为正，abs(c) = floor((abs(a) - b/2) / b)。然后，将 a 的符号应用于 c。

# sharepoint - 需要帮助将启用浏览器的 InfoPath 表单发布到 Sharepoint 2007 服务器

> ID：392376
> 
> 赞同：1
> 
> 时间：2008-12-25T00:15:11.223
> 
> 标签：sharepoint, sharepoint-2007, infopath

我正在尝试将 InfoPath 表单发布到 SharePoint 文档库，并让表单可以在 Web 浏览器中查看。

问题是在 InfoPath 发布向导中告诉我，虽然表单与浏览器兼容，但由于以下原因之一，它不能启用浏览器：

*   服务器未运行 InfoPath 表单服务

*   网站集上没有必要的功能

*   服务器上的策略设置不允许用户浏览器启用表单。

好吧，我已经验证 SiteCollection 有一个名为“Office SharePoint Server Enterprise Site Collection features”的活动功能，其中包括表单服务，所以我假设前两个问题不是原因

此外，我已在 Central Admin 中验证表单服务已配置为允许在 Web 浏览器中查看与浏览器兼容的表单。所以第三个原因似乎也没有意义。

我尝试将不同的安全级别应用于表单：受限/域/完全信任，但这似乎没有效果。我已经能够将此表单发布到不同的 SharePoint 站点，因此我假设问题出在 SharePoint 站点的配置上，而不是 InfoPath 表单

有没有人对为什么这可能不起作用有任何其他想法？

感谢您的任何帮助，您可以提供！！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T19:44:43.183

除了@x0n 建议检查目录是否已分配为可用之外，检查事件查看器并查看是否显示任何内容。

作为一个愚蠢但检查项目去：

> 管理中心 > 操作 > 转换许可证类型

并确保您列出了企业客户端访问权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-25T00:17:33.043

通过将文件复制到服务器本身（例如 c:\temp）并运行以下命令，尝试针对 MOSS 服务器测试 XSN 文件：

```
c:\temp> stsadm -o verifyformtemplate -filename myform.xsn 
```

工具 STSADM.EXE 位于其中，`%programfiles%\common files\microsoft shared\web server extensions\12\bin`因此将其添加到您的`%PATH%`.

如果仍然让您感到困惑，请在此处发布答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T07:41:31.787

确保在“表单库高级设置”部分中，您已将“**显示为网页**”选项设置为“**打开启用浏览器的文档**”

# licensing - 围绕 GPL CLI 应用程序的 GUI 包装器，它是派生的吗？

> ID：392395
> 
> 赞同：5
> 
> 时间：2008-12-25T00:54:29.663
> 
> 标签：licensing, gpl

如果我开发一个**只执行**GPL cli 应用程序的 GUI 包装器（为了论证，比如说[tar](http://www.gnu.org/software/tar/)），我必须将 GUI 包装器作为 GPL 发布吗？是衍生作品吗？

如果是衍生作品，我必须发布什么？

GPL 应用程序和包装器将一起分发

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-25T02:42:09.820

伊纳尔。引用 GPL FAQ 的[单纯聚合](http://www.gnu.org/copyleft/gpl-faq.html#MereAggregation)部分（强调我的）：

> “聚合”由多个单独的程序组成，它们一起分布在同一张 CD-ROM 或其他介质上。GPL 允许您创建和分发聚合，即使其他软件的许可证是非自由或 GPL 不兼容的。唯一的条件是，您不能在禁止用户行使每个程序的单独许可授予他们的权利的许可下发布聚合。
> 
> 两个独立的程序和一个包含两个部分的程序之间的界限在哪里？这是一个法律问题，最终由法官决定。我们认为，一个合适的标准取决于通信机制（exec、管道、rpc、共享地址空间内的函数调用等）和通信的语义（交换什么类型的信息）。
> 
> 如果模块包含在同一个可执行文件中，它们肯定会组合在一个程序中。如果模块被设计为在共享地址空间中链接在一起运行，那几乎肯定意味着将它们组合到一个程序中。
> 
> **相比之下，管道、套接字和命令行参数**是通常在两个独立程序之间使用的通信机制。因此，当它们用于通信时，模块通常是单独的程序。但是，如果通信的语义足够亲密，交换复杂的内部数据结构，那也可以作为将这两个部分组合成一个更大程序的基础。

FAQ 中与此相关的另一个[问题](http://www.gnu.org/licenses/gpl-faq.html#GPLAndPlugins)是“如果在 GPL 下发布的程序使用插件，插件的许可证有什么要求”：

> 这取决于程序如何调用其插件。如果程序使用**fork**和**exec**调用插件，那么插件是独立的程序，所以主程序的license对它们没有要求。
> 
> ..

恕我直言，在精神上，仅公开 GPL 程序功能的纯包装器应该是 GPL。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T02:40:09.887

IANAL，但我很确定，如果您不将 GPL 代码与您的代码链接而只使用 CLI，那么您的代码不会受到 GPL 的影响。您唯一的义务是分发 GPL 代码的源代码。

如果您决定分发 GPL 应用程序，我建议您只在媒体上包含压缩源 tar，而不仅仅是通过下载“提供”，因为您必须无限期维护所有 GPL 版本的下载站点您分发的应用程序。

# arrays - 为什么我们使用数组而不是其他数据结构？

> ID：392397
> 
> 赞同：210
> 
> 时间：2008-12-25T00:56:12.980
> 
> 标签：arrays, data-structures

在我编程时，我还没有看到一个数组比另一种形式更适合存储信息的实例。我确实认为编程语言中添加的“功能”已经对此进行了改进，并因此取代了它们。我现在看到它们没有被替换，而是被赋予了新的生命，可以这么说。

那么，基本上，使用数组有什么意义呢？

这不是为什么我们从计算机的角度使用数组，而是为什么我们从编程的角度使用数组（一个细微的区别）。计算机对阵列的作用不是问题的重点。

* * *

## 回答 #1

> 赞同：792
> 
> 时间：2008-12-25T01:51:44.697

是时候回去上课了。虽然我们今天在花哨的托管语言中没有过多考虑这些事情，但它们建立在相同的基础上，所以让我们看看 C 中的内存是如何管理的。

在我深入研究之前，快速解释一下“**指针**”一词的含义。指针只是一个“指向”内存中某个位置的变量。它不包含该内存区域的实际值，它包含它的内存地址。将一块内存想象成一个邮箱。指针将是该邮箱的地址。

在 C 中，数组只是一个带有偏移量的指针，偏移量指定在内存中查找的距离。这提供了[O(1)](http://en.wikipedia.org/wiki/Big_O_notation)访问时间。

```
 MyArray   [5]
     ^       ^
  Pointer  Offset 
```

所有其他数据结构要么建立在此之上，要么不使用相邻内存进行存储，从而导致随机访问查找时间差（尽管不使用顺序内存还有其他好处）。

例如，假设我们有一个包含 6 个数字 (6,4,2,3,1,5) 的数组，在内存中它看起来像这样：

```
=====================================
|  6  |  4  |  2  |  3  |  1  |  5  |
===================================== 
```

在数组中，我们知道每个元素在内存中彼此相邻。AC 数组（`MyArray`此处称为）只是指向第一个元素的指针：

```
=====================================
|  6  |  4  |  2  |  3  |  1  |  5  |
=====================================
   ^
MyArray 
```

如果我们想查找`MyArray[4]`，内部会这样访问：

```
 0     1     2     3     4 
=====================================
|  6  |  4  |  2  |  3  |  1  |  5  |
=====================================
                           ^
MyArray + 4 ---------------/
(Pointer + Offset) 
```

因为我们可以通过向指针添加偏移量来直接访问数组中的任何元素，所以我们可以在相同的时间内查找任何元素，而不管数组的大小。这意味着 get`MyArray[1000]`将花费与 getting 相同的时间`MyArray[5]`。

另一种数据结构是链表。这是一个线性指针列表，每个指针指向下一个节点

```
========    ========    ========    ========    ========
| Data |    | Data |    | Data |    | Data |    | Data |
|      | -> |      | -> |      | -> |      | -> |      | 
|  P1  |    |  P2  |    |  P3  |    |  P4  |    |  P5  |        
========    ========    ========    ========    ========

P(X) stands for Pointer to next node. 
```

请注意，我将每个“节点”都放入了自己的块中。这是因为不能保证它们在内存中（并且很可能不会）相邻。

如果我想访问P3，我不能直接访问它，因为我不知道它在内存中的什么位置。我只知道根（P1）在哪里，所以我必须从 P1 开始，然后按照每个指针指向所需的节点。

这是一个 O(N) 查找时间（查找成本随着每个元素的添加而增加）。与到达 P4 相比，到达 P1000 的成本要高得多。

更高级别的数据结构，例如哈希表、堆栈和队列，都可能在内部使用一个数组（或多个数组），而链表和二叉树通常使用节点和指针。

您可能想知道为什么有人会使用需要线性遍历来查找值的数据结构而不仅仅是使用数组，但它们有其用途。

再拿我们的阵列。这一次，我想找到包含值“5”的数组元素。

```
=====================================
|  6  |  4  |  2  |  3  |  1  |  5  |
=====================================
   ^     ^     ^     ^     ^   FOUND! 
```

在这种情况下，我不知道要为指针添加什么偏移量才能找到它，所以我必须从 0 开始，然后一直向上直到找到它。这意味着我必须执行 6 次检查。

因此，在数组中搜索一个值被认为是 O(N)。搜索成本随着数组变大而增加。

还记得上面我说过有时使用非顺序数据结构可以有优势吗？搜索数据是这些优势之一，最好的例子之一就是二叉树。

二叉树是一种类似于链表的数据结构，但是不是链接到单个节点，而是每个节点可以链接到两个子节点。

```
 ==========
         |  Root  |         
         ==========
        /          \ 
  =========       =========
  | Child |       | Child |
  =========       =========
                  /       \
            =========    =========
            | Child |    | Child |
            =========    =========

 Assume that each connector is really a Pointer 
```

当数据被插入二叉树时，它使用几个规则来决定在哪里放置新节点。基本概念是，如果新值大于父母，则将其插入左侧，如果低于父母，则将其插入右侧。

这意味着二叉树中的值可能如下所示：

```
 ==========
         |   100  |         
         ==========
        /          \ 
  =========       =========
  |  200  |       |   50  |
  =========       =========
                  /       \
            =========    =========
            |   75  |    |   25  |
            =========    ========= 
```

在二叉树中搜索 75 的值时，我们只需要访问 3 个节点（ O(log N) ），因为这种结构：

*   75小于100吗？查看右节点
*   75大于50吗？查看左节点
*   有75！

即使我们的树中有 5 个节点，我们也不需要查看剩下的两个，因为我们知道它们（和它们的子节点）不可能包含我们正在寻找的值。这给了我们一个搜索时间，在最坏的情况下意味着我们必须访问每个节点，但在最好的情况下，我们只需要访问一小部分节点。

这就是数组被击败的地方，尽管访问时间为 O(1)，但它们提供了线性的 O(N) 搜索时间。

这是对内存中数据结构的令人难以置信的高级概述，跳过了很多细节，但希望它说明了数组与其他数据结构相比的优势和劣势。

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2008-12-25T01:01:29.680

对于 O(1) 随机访问，无法被击败。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-12-25T01:57:09.787

**并非所有程序都做相同的事情或在相同的硬件上运行。**

这通常是为什么存在各种语言特征的答案。数组是一个核心的计算机科学概念。用列表/矩阵/向量/任何高级数据结构替换数组会严重影响性能，并且在许多系统中完全不切实际。由于所讨论的程序，在许多情况下应该使用这些“高级”数据收集对象之一。

在业务编程中（我们大多数人都这样做），我们可以针对相对强大的硬件。在这些情况下，使用 C# 中的 List 或 Java 中的 Vector 是正确的选择，因为这些结构允许开发人员更快地完成目标，从而使此类软件更具特色。

在编写嵌入式软件或操作系统时，阵列通常可能是更好的选择。虽然数组提供的功能较少，但它占用的 RAM 较少，并且编译器可以更有效地优化代码以查找数组。

我确信我忽略了这些案例的一些好处，但我希望你明白这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-06-16T01:52:01.160

查看数组优势的一种方法是查看数组的 O(1) 访问能力在哪里需要并因此大写：

1.  在应用程序的查找表中（用于访问某些分类响应的静态数组）

2.  记忆化（已经计算出复杂的函数结果，这样就不用再计算函数值了，比如log x）

3.  需要图像处理的高速计算机视觉应用 ( [https://en.wikipedia.org/wiki/Lookup_table#Lookup_tables_in_image_processing](https://en.wikipedia.org/wiki/Lookup_table#Lookup_tables_in_image_processing) )

# air - 如何决定我应该使用 AIR 还是 Titanium

> ID：392414
> 
> 赞同：1
> 
> 时间：2008-12-25T01:27:48.987
> 
> 标签：air, titanium

我可能想创建一个 RIA，但我想知道[Adob​​e AIR](http://www.adobe.com/products/air/)还是[Titanium](http://titaniumapp.com/)是要走的路。

你认为开源版本会持续更长时间吗？无论如何会更好吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T21:42:18.277

以防万一有人回到这篇文章，我会加我的 2 美分。

在过去的几个月里，钛已经出现了。它现在支持 Ruby 和 Python。您可以使用 C++（例如 IRC）编写自己的模块并编译 Titanium 以支持该模块（或者您可以使用 Py/Ru/JS 编写模块）。

您可以在 Titanium 中使用 flex、flash 和 silverlight。一切都已经过测试并且可以顺利工作:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T03:10:53.957

尽管 AIR 还不是开源的，但它所在的技术堆栈（Flex、Webkit 等）是开源的。Titanium 肯定看起来很有前途，但还没有 AIR 的势头和支持。在它实际发布并运行多个生产应用程序之前，我不会在它上面打太多赌。如果你想参与一个开源项目并实际工作并帮助开发它，那是另外一回事......

* * *

澄清一下，AIR 也允许您使用 HTML/js 来构建您的应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T03:35:30.710

两者都不是，因为这两种技术都是用于创建桌面应用程序而不是 RIA。

现在，如果您要问应该如何构建您的 RIA……那么当您需要制作桌面版本时，您应该使用哪种技术，Flex 还是 Javascript/HTML？

一旦您在 Flex 或 Javascript/HTML 之间做出选择，答案就会变得显而易见。如果您使用 Flex，那么您的桌面应用程序将在 AIR 中；如果您使用 Javascript/HTML，您的桌面应用程序将使用 Titanium。

我的建议是使用 Flex - Air。两者都是使状态变得容易的环境。无论如何，Flex 编写起来很像客户端（桌面）应用程序，因为它们有状态。

# c - 加载的库函数如何在主应用程序中调用符号？

> ID：392416
> 
> 赞同：13
> 
> 时间：2008-12-25T01:30:10.527
> 
> 标签：c, module, dlopen

当通过函数打开共享库时`dlopen()`，有没有办法在主程序中调用函数？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-25T01:42:17.723

dlo.c (lib) 的代码：

```
#include <stdio.h>

// function is defined in main program
void callb(void);

void test(void) {
    printf("here, in lib\n");
    callb();
} 
```

编译

```
gcc -shared -olibdlo.so dlo.c 
```

这里是主程序的代码（从 dlopen 手册页复制，并调整）：

```
#include <stdio.h>
#include <stdlib.h>
#include <dlfcn.h>

void callb(void) {
    printf("here, i'm back\n");
}

int
main(int argc, char **argv)
{
    void *handle;
    void (*test)(void);
    char *error;

    handle = dlopen("libdlo.so", RTLD_LAZY);
    if (!handle) {
        fprintf(stderr, "%s\n", dlerror());
        exit(EXIT_FAILURE);
    }

    dlerror();    /* Clear any existing error */

    *(void **) (&test) = dlsym(handle, "test");

    if ((error = dlerror()) != NULL)  {
        fprintf(stderr, "%s\n", error);
        exit(EXIT_FAILURE);
    }

    (*test)();
    dlclose(handle);
    exit(EXIT_SUCCESS);
} 
```

构建

```
gcc -ldl -rdynamic main.c 
```

输出：

```
[js@HOST2 dlopen]$ LD_LIBRARY_PATH=. ./a.out
here, in lib
here, i'm back
[js@HOST2 dlopen]$ 
```

该`-rdynamic`选项将所有符号放入动态符号表（映射到内存）中，而不仅仅是使用符号的名称。[在这里](http://blogs.oracle.com/ali/entry/inside_elf_symbol_tables)进一步阅读。当然，您也可以提供定义库和主程序之间接口的函数指针（或函数指针的结构）。这实际上是我可能会选择的方法。我从其他人那里听说，`-rdynamic`在 Windows 中做到这一点并不容易，而且它还可以使库和主程序之间的通信更清晰（您可以精确控制可以调用的内容），但它还需要更多家政。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-25T01:35:28.863

是的，如果您为您的库提供指向该函数的指针，我确信该库将能够在主程序中运行/执行该函数。

这是一个例子，还没有编译所以要小心;）

```
/* in main app */

/* define your function */

int do_it( char arg1, char arg2);

int do_it( char arg1, char arg2){
  /* do it! */
  return 1;
}

/* some where else in main app (init maybe?) provide the pointer */
 LIB_set_do_it(&do_it);
/** END MAIN CODE ***/

/* in LIBRARY */

int (*LIB_do_it_ptr)(char, char) = NULL;

void LIB_set_do_it( int (*do_it_ptr)(char, char) ){
    LIB_do_it_ptr = do_it_ptr;
}

int LIB_do_it(){
  char arg1, arg2;

  /* do something to the args 
  ...
  ... */

  return LIB_do_it_ptr( arg1, arg2);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T06:22:36.707

正如@litb 所讨论的，该`dlopen()`功能主要在使用 ELF 格式目标文件的系统上提供。它相当强大，可以让你控制加载的库引用的符号是否可以从主程序中得到满足，并且通常会让它们得到满足。并非所有的共享库加载系统都如此灵活——请注意移植代码。

@hhafez 概述的回调机制现在可以正常工作，因为代码中的问题已经解决。

# c# - 像素编程（续）

> ID：392425
> 
> 赞同：5
> 
> 时间：2008-12-25T01:49:33.543
> 
> 标签：c#, arrays, image, pixels

我有一个按 BGR 顺序排列的像素字节数组，我想在 C# 中用它创建一个图像。任何人都可以提供代码或建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T20:12:11.037

你可能需要这样的东西：

```
public static Bitmap TransformBGRArrayToBitmap(byte[] inputValues, int Width, int Height, int Stride)
{
    Bitmap output = new Bitmap(Width, Height, System.Drawing.Imaging.PixelFormat.Format8bppIndexed);

    // Lock the bitmap's bits.  
    Rectangle rect = new Rectangle(0, 0, Width, Height);
    BitmapData outputData = output.LockBits(rect, System.Drawing.Imaging.ImageLockMode.WriteOnly, output.PixelFormat);

    // Get the address of the first line.
    IntPtr outputPtr = outputData.Scan0;

    // Declare an array to hold the bytes of the bitmap.
    byte[] outputValues = new byte[outputData.Stride * output.Height];
    int inputBytesPP = (1 * Stride) / Width;
    int outputBytesBPP = (1 * outputData.Stride) / output.Width;

    // Copy the RGB values into the array.
    for (int inputByte = 0, outputByte = 0; inputByte < inputValues.Length; inputByte += inputBytesPP, outputByte += outputBytesBPP)
    {
        //The logic inside this loop transforms a 32 bit ARGB Bitmap into an 8 bit indexed Bitmap
        //So you will have to replace it
        /*byte pixel = 0x00;
        if (inputValues[inputByte] > 0x7F)
        {
            if (inputValues[inputByte + 1] > 0x7F)
                pixel |= 0x01;
            if (inputValues[inputByte + 2] > 0x7F)
                pixel |= 0x02;
            if (inputValues[inputByte + 3] > 0x7F)
                pixel |= 0x04;
            if ((inputValues[inputByte + 1] & 0x7F) > 0x3F)
                pixel |= 0x02;
            if ((inputValues[inputByte + 2] & 0x7F) > 0x3F)
                pixel |= 0x04;
            if ((inputValues[inputByte + 3] & 0x7F) > 0x3F)
                pixel |= 0x08;
        }
        else
            pixel = 0x10;
        outputValues[outputByte] = pixel;*/
    }
    System.Runtime.InteropServices.Marshal.Copy(outputValues, 0, outputPtr, outputValues.Length);
    output.UnlockBits(outputData);
    return output;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T02:31:28.983

影响（未经测试）的东西

```
 private Bitmap createImage(int width, int height, byte[] image)
        {
            int index = 0;
            byte r, g, b;
            Bitmap bmp = new Bitmap(width, height);
            for (y as int = 0; y < height; y++)
            {                
                for (x as int = 0; x < width; x++)
                {
                    b = image[y * width + index];
                    g = image[y * width + index + 1];
                    r = image[y * width + index + 2];
                    bmp.SetPixel(x, y, Color.FromArgb(255, r, g, b));
                    index += 3;
                }                
            }
            return bmp;
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T02:42:28.367

该类的`Bitmap(int width, int height, int stride, PixelFormat format, IntPtr scan0)`构造函数`Bitmap`可能会有所帮助。当然，这取决于数据如何存储在数组中。

# c# - 为什么 XmlSerializer 不需要将类型标记为 [Serializable]？

> ID：392431
> 
> 赞同：18
> 
> 时间：2008-12-25T01:59:25.413
> 
> 标签：c#, xml-serialization, datacontractserializer

在 C# 中，如果我想用 序列化一个实例`XmlSerializer`，则对象的类型不必用`[Serializable]`属性标记。但是，对于其他序列化方法，例如`DataContractSerializer`，需要将类标记为`[Serializable]`或`[DataContract]`。

有没有关于序列化要求的标准或模式？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-25T02:03:10.053

这是因为 XmlSerializer 只序列化公共字段/属性。其他形式的序列化可以序列化私有数据，这构成潜在的安全风险，因此您必须使用属性“选择加入”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-26T08:34:22.260

安全不是唯一的问题。简单地说，序列化只对某些类有意义。例如，序列化“连接”几乎没有什么意义。一个连接**字符串**，当然，但是连接本身呢？不。同样，任何需要非托管指针/句柄的东西都不会很好地序列化。代表也不是。

此外，`XmlSerializer`and `DataContractSerializer`（默认情况下）是*树*序列化器，而不是*图形*序列化器 - 因此任何递归链接（如`Parent`）都会导致它中断。

用序列化程序的首选标记标记类只是一种说“它应该有意义”的方式。

IIRC，两者都`[XmlSerializer`曾经`[DataContractSerializer]` **非常**严格地**要求**诸如`[Serializable]`,`[DataContract]`或之类的东西`[IXmlSerializable]`，但最近它们变得更加自由了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-25T15:21:22.440

现在 .Net 框架中确实有 3 种形式的序列化。

1.  XmlSerialization - 默认情况下适用于公共字段和属性。仍然可以通过 XmlElementAttribute、XmlAttributeAttribute 等进行控制...
2.  BinarySerialization - 由 SerializationAttribute 控制。深度集成到 CLR
3.  WCF 序列化 - DataContractAttribute 等...

不幸的是，序列化有标准的整体模式。所有 3 个框架都有不同的要求和怪癖。

# javascript - 使用 jQuery 传递变量

> ID：392438
> 
> 赞同：0
> 
> 时间：2008-12-25T02:16:07.640
> 
> 标签：javascript, jquery

我对 jquery 和 javascript 比较陌生，我试图将唯一 id（数字）传递给 flickr 搜索函数（jquery.flickr-1.0-js），就像这样，（数字是我存储唯一 id 的变量)

```
<script type="text/javascript" src="javascripts/jquery.flickr-1.0.js"></script>

 <script type="text/javascript"> 

 jQuery(function(){   
        jQuery(".btnRefresh").click(function(){
          var number = $(this).attr("id");
          $('#gallery_flickr_'+number+'').show();
            jQuery('#gallery_flickr_'+number+'').html("").flickr({      
                api_key: "XXXXXXXXXXXXXXXXXXXXXXX",     
                per_page: 15   
            });
        }); 
    }); 

  </script> 
```

当我尝试将它传递给 flickr-1.0.js 函数时（缩写）

```
（函数（$）{
$.fn.flickr = 函数（o）{

变量 s = {
    文本：$('input#flickr_search_'+number+'').val(),
   };
  };
})(jQuery);

```

我得到一个错误

number 未定义 [Break on this error] text: $('input#flickr_search_'+numbe...] for type=='search' 自由文本搜索

请帮忙，我需要做什么才能在两个脚本之间传递变量？

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-25T02:54:58.670

尝试如下调整脚本：

```
 ...
            jQuery('#gallery_flickr_'+number+'').html("").flickr({      
                    api_key: "XXXXXXXXXXXXXXXXXXXXXXX",     
                    per_page: 15,
                    search_text: $('input#flickr_search_'+number+'').val()  
            });
...

(function($) {
$.fn.flickr = function(o){

var s = {
    text: o.search_text
   };
  };
})(jQuery); 
```

这个想法是您需要根据单击项目的 id 找到搜索文本。您在 id 可用的函数中执行此操作，然后将输入的值与 hash 参数中的其他值一起传递给 flickr 函数。在 flickr 函数中，您从哈希中提取命名项目并使用该值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-06T01:58:43.150

您可以非常轻松地在 JQuery 中传递参数；例如：

```
$.ajax({
    type: "POST",
    url: "/<%=domainMap%>/registration/recieptList.jsp",  
    data: "patientId=" + patientId+"golbalSearch="+golbalSearch,
    success: function(response){
      // we have the response
      $('#loadPatientReciept').html(response);
    },
    error: function(e){
      alert('Error: ' + e);
    }
  });
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T03:07:16.213

我刚刚意识到'闪烁'！='flickr'

讨厌你可爱的 web 2.0 名字！！！

谢谢！

# livecoding - 什么可用于实时编码音乐？

> ID：392449
> 
> 赞同：15
> 
> 时间：2008-12-25T02:37:54.727
> 
> 标签：livecoding

我最近发现了关于[实时编码](http://en.wikipedia.org/wiki/Livecoding#Live_coding)，有人会在其中即时编程一些东西来制作音乐。显然，这类事情有特殊的语言和库。所以我想知道是否有人对此有任何经验，以及他们是否有任何语言、库或工具可以建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-25T03:12:14.080

检查这些资源：

*   [SuperCollider](http://supercollider.sourceforge.net/)（用于实时音频合成和算法合成的环境和编程语言）
*   [Chuck](http://chuck.cs.princeton.edu/)（强定时、并发和即时音频编程语言）
*   [TOPLAP](http://toplap.org/)（现场音频节目扩散的临时组织）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-10T01:53:10.860

我也想支持 Impromptu 的建议：

*   批发使用您的 Mac：音频单元、摄像头、openGL 等（实际上我在玩过这个应用程序后最终购买了一台 Mac。）
*   非常简单易上手：本[教程](http://homepage.mac.com/digego/impromptu_intro.mov)很快就会变得有趣。也许最笨拙的方面是安装键绑定：（您需要安装在 ~/Library/KeyBindings/DefaultKeyBinding.dict 中）
*   它使用 Scheme(Lisp dialect) 一种高度迭代的语言，适用于一次一行地为应用程序制作原型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-01-24T07:20:58.317

现在还有很有趣的[Sonic Pi 。](http://sonic-pi.net)

它是一个基于 Ruby的[开源实时编码环境，可在包括 Raspberry Pi 在内的各种环境中运行，并构建在](https://github.com/samaaron/sonic-pi)[Supercollider](https://supercollider.github.io/)合成引擎之上。

Sonic Pi 的设计旨在在三个核心原则之间找到和谐的平衡：

*   对你内心 10 岁的孩子来说足够简单
*   快乐到让你在游戏中迷失自我
*   足够强大，适合您自己的表达

示例代码：

```
loop do
  sample :perc_bell, rate: (rrand 0.125, 1.5)
  sleep rrand(0, 2)
end 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-13T21:56:14.450

您应该查看[RTcmix](http://rtcmix.org/)（**实时**Cmix）。我看到了它的一位开发人员的精彩实时编码演示，但我无法在网上找到任何视频。

我一直在使用 RTcmix 及其 Python 前端模块来试验算法组合。它非常易于使用并且效果很好。

**编辑**
我最近一直在进一步研究实时编码，RTcmix 不是为此而设计的，但在某些情况下，它可以工作。预处理的分数要好得多。很抱歉有任何混淆。:)

# c++ - 关于 C++ 中自定义对象的构造函数/析构函数和 new/delete 运算符

> ID：392455
> 
> 赞同：4
> 
> 时间：2008-12-25T02:46:30.887
> 
> 标签：c++, constructor, destructor, new-operator

假设我有一个我自己创建的链接列表。它有自己的析构函数，可以释放内存。此链接列表不会重载 new 或 delete。

现在，我正在尝试创建一个所述链接列表的数组（如果我理解正确，则打开散列）。然后我在这个开放散列类的构造函数中分配必要的内存。在构造函数中调用的 new 运算符足以正确地为数组分配内存，对吧？我不确定，因为我没有为 Linked List 类重载 new 。

另外，假设我的链接列表数组被称为元素，我可以在析构函数中写“删除 [] 元素”吗？这会为数组中的每个元素调用析构函数并正确释放内存吗？

最后，如果我的两个假设都是正确的（即，我不必重载 new 和 delete 就可以将它们与我的自定义类一起使用），那么重载这些运算符有什么意义呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-25T02:51:39.707

嗯你是对的。一个平原

```
elements = new LinkedList[N]; 
```

足以分配它们。然后您可以访问它们

```
elements[i]->push(....); 
```

并使用您展示的方式在您的析构函数中删除它们：

```
delete[] elements; 
```

编译器会记住分配了多少元素，并正确调用每个列表的析构函数。重载 new 和 delete 运算符的目的是提供自定义的内存分配策略。例如，您可以预先分配内存，然后从该池中取出，而不是每次都从操作系统分配内存。

但请注意，您还必须编写一个复制构造函数和复制赋值运算符。因为如果有人复制了您的哈希图，那么链表也必须被复制，而不仅仅是指针。或者您可以将复制构造函数和复制赋值运算符设为私有而不定义它们，从而禁止复制哈希映射：

```
....
private:
    MyHashMap(MyHashMap const& rhs);
    MyHashMap & operator=(MyHashMap const& rhs);
.... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T03:00:23.027

**new**运算符做了两件事：分配内存和调用构造函数。

**删除**操作符调用析构函数，然后释放内存。

**使用new []**创建的数组必须使用**delete[]**销毁。

除非出于性能原因，您通常不需要重载**new**或**delete 。**您可能有一个可预测的分配/解除分配模式，这使得特定的分配策略非常适合（快速或低内存使用）。

你不妨看看[这个页面](http://www.parashift.com/c++-faq-lite/freestore-mgmt.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T02:54:07.020

你所有的假设都是正确的。

重载 new 和 delete 有很多用途，但并不经常这样做。一个常见的原因是跟踪内存分配以发现内存泄漏。很多编译时泄漏跟踪器都这样做，但是随着 valgrind 等更好的外部应用程序已经过时了。您还可以执行诸如使用池化内存之类的操作。

# ios - 如何在 iOS 上进行 base64 编码？

> ID：392464
> 
> 赞同：233
> 
> 时间：2008-12-25T03:09:45.163
> 
> 标签：ios, objective-c, base64

我想做`base64`编码和解码，但我找不到 iPhone 的任何支持`SDK`。我如何在`base64`有或没有库的情况下进行编码和解码？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-04-29T05:17:50.863

这是 Objective C[类别](http://en.wikipedia.org/wiki/Objective-C#Categories)的一个很好的用例。

对于 Base64 编码：

```
#import <Foundation/NSString.h>

@interface NSString (NSStringAdditions)

+ (NSString *) base64StringFromData:(NSData *)data length:(int)length;

@end

-------------------------------------------

#import "NSStringAdditions.h"

static char base64EncodingTable[64] = {
  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
  'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
  'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
  'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '/'
};

@implementation NSString (NSStringAdditions)

+ (NSString *) base64StringFromData: (NSData *)data length: (int)length {
  unsigned long ixtext, lentext;
  long ctremaining;
  unsigned char input[3], output[4];
  short i, charsonline = 0, ctcopy;
  const unsigned char *raw;
  NSMutableString *result;

  lentext = [data length]; 
  if (lentext < 1)
    return @"";
  result = [NSMutableString stringWithCapacity: lentext];
  raw = [data bytes];
  ixtext = 0; 

  while (true) {
    ctremaining = lentext - ixtext;
    if (ctremaining <= 0) 
       break;        
    for (i = 0; i < 3; i++) { 
       unsigned long ix = ixtext + i;
       if (ix < lentext)
          input[i] = raw[ix];
       else
  input[i] = 0;
  }
  output[0] = (input[0] & 0xFC) >> 2;
  output[1] = ((input[0] & 0x03) << 4) | ((input[1] & 0xF0) >> 4);
  output[2] = ((input[1] & 0x0F) << 2) | ((input[2] & 0xC0) >> 6);
  output[3] = input[2] & 0x3F;
  ctcopy = 4;
  switch (ctremaining) {
    case 1: 
      ctcopy = 2; 
      break;
    case 2: 
      ctcopy = 3; 
      break;
  }

  for (i = 0; i < ctcopy; i++)
     [result appendString: [NSString stringWithFormat: @"%c", base64EncodingTable[output[i]]]];

  for (i = ctcopy; i < 4; i++)
     [result appendString: @"="];

  ixtext += 3;
  charsonline += 4;

  if ((length > 0) && (charsonline >= length))
    charsonline = 0;
  }     
  return result;
}

@end 
```

对于 Base64 解码：

```
#import <Foundation/Foundation.h>

@class NSString;

@interface NSData (NSDataAdditions)

+ (NSData *) base64DataFromString:(NSString *)string;

@end

-------------------------------------------

#import "NSDataAdditions.h"

@implementation NSData (NSDataAdditions)

+ (NSData *)base64DataFromString: (NSString *)string
{
    unsigned long ixtext, lentext;
    unsigned char ch, inbuf[4], outbuf[3];
    short i, ixinbuf;
    Boolean flignore, flendtext = false;
    const unsigned char *tempcstring;
    NSMutableData *theData;

    if (string == nil)
    {
        return [NSData data];
    }

    ixtext = 0;

    tempcstring = (const unsigned char *)[string UTF8String];

    lentext = [string length];

    theData = [NSMutableData dataWithCapacity: lentext];

    ixinbuf = 0;

    while (true)
    {
        if (ixtext >= lentext)
        {
            break;
        }

        ch = tempcstring [ixtext++];

        flignore = false;

        if ((ch >= 'A') && (ch <= 'Z'))
        {
            ch = ch - 'A';
        }
        else if ((ch >= 'a') && (ch <= 'z'))
        {
            ch = ch - 'a' + 26;
        }
        else if ((ch >= '0') && (ch <= '9'))
        {
            ch = ch - '0' + 52;
        }
        else if (ch == '+')
        {
            ch = 62;
        }
        else if (ch == '=')
        {
            flendtext = true;
        }
        else if (ch == '/')
        {
            ch = 63;
        }
        else
        {
            flignore = true; 
        }

        if (!flignore)
        {
            short ctcharsinbuf = 3;
            Boolean flbreak = false;

            if (flendtext)
            {
                if (ixinbuf == 0)
                {
                    break;
                }

                if ((ixinbuf == 1) || (ixinbuf == 2))
                {
                    ctcharsinbuf = 1;
                }
                else
                {
                    ctcharsinbuf = 2;
                }

                ixinbuf = 3;

                flbreak = true;
            }

            inbuf [ixinbuf++] = ch;

            if (ixinbuf == 4)
            {
                ixinbuf = 0;

                outbuf[0] = (inbuf[0] << 2) | ((inbuf[1] & 0x30) >> 4);
                outbuf[1] = ((inbuf[1] & 0x0F) << 4) | ((inbuf[2] & 0x3C) >> 2);
                outbuf[2] = ((inbuf[2] & 0x03) << 6) | (inbuf[3] & 0x3F);

                for (i = 0; i < ctcharsinbuf; i++)
                {
                    [theData appendBytes: &outbuf[i] length: 1];
                }
            }

            if (flbreak)
            {
                break;
            }
        }
    }

    return theData;
}

    @end 
```

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2011-01-18T17:32:43.717

**QSUtilities 库的****QSStrings 类**中提供了一个非常非常快速的实现，它从 PHP 核心库移植（和修改/改进）到本机 Objective-C 代码中。我做了一个快速基准测试：一个 5.3MB 图像 (JPEG) 文件的编码时间小于 50 毫秒，解码时间约为 140 毫秒。

 **整个库的代码（包括 Base64 方法）都可以在**[GitHub](https://github.com/mikeho/QSUtilities)**上找到。

或者，如果您希望代码*仅*包含 Base64 方法本身，我已将其发布在这里：

**首先，您需要映射表：**

```
static const char _base64EncodingTable[64] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
static const short _base64DecodingTable[256] = {
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -1, -1, -2, -1, -1, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -1, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, 62, -2, -2, -2, 63,
    52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -2, -2, -2, -2, -2, -2,
    -2,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
    15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -2, -2, -2, -2, -2,
    -2, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
    41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2,
    -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2
}; 
```

**编码：**

```
+ (NSString *)encodeBase64WithString:(NSString *)strData {
    return [QSStrings encodeBase64WithData:[strData dataUsingEncoding:NSUTF8StringEncoding]];
}

+ (NSString *)encodeBase64WithData:(NSData *)objData {
    const unsigned char * objRawData = [objData bytes];
    char * objPointer;
    char * strResult;

    // Get the Raw Data length and ensure we actually have data
    int intLength = [objData length];
    if (intLength == 0) return nil;

    // Setup the String-based Result placeholder and pointer within that placeholder
    strResult = (char *)calloc((((intLength + 2) / 3) * 4) + 1, sizeof(char));
    objPointer = strResult;

    // Iterate through everything
    while (intLength > 2) { // keep going until we have less than 24 bits
        *objPointer++ = _base64EncodingTable[objRawData[0] >> 2];
        *objPointer++ = _base64EncodingTable[((objRawData[0] & 0x03) << 4) + (objRawData[1] >> 4)];
        *objPointer++ = _base64EncodingTable[((objRawData[1] & 0x0f) << 2) + (objRawData[2] >> 6)];
        *objPointer++ = _base64EncodingTable[objRawData[2] & 0x3f];

        // we just handled 3 octets (24 bits) of data
        objRawData += 3;
        intLength -= 3; 
    }

    // now deal with the tail end of things
    if (intLength != 0) {
        *objPointer++ = _base64EncodingTable[objRawData[0] >> 2];
        if (intLength > 1) {
            *objPointer++ = _base64EncodingTable[((objRawData[0] & 0x03) << 4) + (objRawData[1] >> 4)];
            *objPointer++ = _base64EncodingTable[(objRawData[1] & 0x0f) << 2];
            *objPointer++ = '=';
        } else {
            *objPointer++ = _base64EncodingTable[(objRawData[0] & 0x03) << 4];
            *objPointer++ = '=';
            *objPointer++ = '=';
        }
    }

    // Terminate the string-based result
    *objPointer = '\0';

    // Create result NSString object
    NSString *base64String = [NSString stringWithCString:strResult encoding:NSASCIIStringEncoding];

    // Free memory
    free(strResult);

    return base64String;
} 
```

**解码：**

```
+ (NSData *)decodeBase64WithString:(NSString *)strBase64 {
    const char *objPointer = [strBase64 cStringUsingEncoding:NSASCIIStringEncoding];
    size_t intLength = strlen(objPointer);
    int intCurrent;
    int i = 0, j = 0, k;

    unsigned char *objResult = calloc(intLength, sizeof(unsigned char));

    // Run through the whole string, converting as we go
    while ( ((intCurrent = *objPointer++) != '\0') && (intLength-- > 0) ) {
        if (intCurrent == '=') {
            if (*objPointer != '=' && ((i % 4) == 1)) {// || (intLength > 0)) {
                // the padding character is invalid at this point -- so this entire string is invalid
                free(objResult);
                return nil;
            }
            continue;
        }

        intCurrent = _base64DecodingTable[intCurrent];
        if (intCurrent == -1) {
            // we're at a whitespace -- simply skip over
            continue;
        } else if (intCurrent == -2) {
            // we're at an invalid character
            free(objResult);
            return nil;
        }

        switch (i % 4) {
            case 0:
                objResult[j] = intCurrent << 2;
                break;

            case 1:
                objResult[j++] |= intCurrent >> 4;
                objResult[j] = (intCurrent & 0x0f) << 4;
                break;

            case 2:
                objResult[j++] |= intCurrent >>2;
                objResult[j] = (intCurrent & 0x03) << 6;
                break;

            case 3:
                objResult[j++] |= intCurrent;
                break;
        }
        i++;
    }

    // mop things up if we ended on a boundary
    k = j;
    if (intCurrent == '=') {
        switch (i % 4) {
            case 1:
                // Invalid state
                free(objResult);
                return nil;

            case 2:
                k++;
                // flow through
            case 3:
                objResult[k] = 0;
        }
    }

    // Cleanup and setup the return NSData
    NSData * objData = [[[NSData alloc] initWithBytes:objResult length:j] autorelease];
    free(objResult);
    return objData;
} 
```

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2013-11-05T17:00:20.240

在最初发布此问题时，由于缺乏任何本机例程，人们将您定向到第三方 base 64 库是可以理解的。但是 iOS 7 引入了[base 64 编码例程](https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/doc/uid/20000172-SW36)（实际上只是暴露了 iOS 可以追溯到 iOS 4 的私有方法）。

因此，您可以使用该`NSData`方法[`base64EncodedStringWithOptions:`](https://developer.apple.com/documentation/foundation/nsdata/1413546-base64encodedstringwithoptions?language=occ)从`NSData`.

```
NSString *string = [data base64EncodedStringWithOptions:kNilOptions]; 
```

您可以使用[`initWithBase64EncodedString:options:`](https://developer.apple.com/documentation/foundation/nsdata/1410081-initwithbase64encodedstring?language=occ)将 base-64 字符串转换回`NSData`：

```
NSData *data = [[NSData alloc] initWithBase64EncodedString:string options:kNilOptions]; 
```

或者，在 Swift 中：

```
let string = data.base64EncodedString() 
```

和

```
let data = Data(base64Encoded: string) 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2013-04-19T21:39:23.780

iOS 包含对 base64 编码和解码的内置支持。如果您看一下，`resolv.h`您应该会看到两个函数`b64_ntop`和`b64_pton`. Square [SocketRocket](https://github.com/square/SocketRocket/tree/master/SocketRocket)库提供了一个合理的示例，说明如何使用 Objective-c 中的这些函数。

这些功能经过了很好的测试和可靠 - 与您在随机互联网帖子中可能找到的许多实现不同。不要忘记链接到`libresolv.dylib`.

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2010-05-03T00:48:14.613

由于这似乎是 google 在 base64 编码和 iphone 上排名第一的结果，所以我想与上面的代码片段分享我的经验。

它可以工作，但速度非常慢。在原生 iphone 上，随机图像 (0.4 mb) 的基准测试耗时 37 秒。主要原因可能是所有的 OOP 魔法 - 单字符 NSStrings 等，它们仅在编码完成后自动释放。

此处发布的另一个建议 (ab) 使用 openssl 库，感觉也有点矫枉过正。

下面的代码需要 70 毫秒 - 这是 500 倍的加速。这只做base64编码（一遇到它就会解码）

```
+ (NSString *) base64StringFromData: (NSData *)data length: (int)length {
int lentext = [data length]; 
if (lentext < 1) return @"";

char *outbuf = malloc(lentext*4/3+4); // add 4 to be sure

if ( !outbuf ) return nil;

const unsigned char *raw = [data bytes];

int inp = 0;
int outp = 0;
int do_now = lentext - (lentext%3);

for ( outp = 0, inp = 0; inp < do_now; inp += 3 )
{
    outbuf[outp++] = base64EncodingTable[(raw[inp] & 0xFC) >> 2];
    outbuf[outp++] = base64EncodingTable[((raw[inp] & 0x03) << 4) | ((raw[inp+1] & 0xF0) >> 4)];
    outbuf[outp++] = base64EncodingTable[((raw[inp+1] & 0x0F) << 2) | ((raw[inp+2] & 0xC0) >> 6)];
    outbuf[outp++] = base64EncodingTable[raw[inp+2] & 0x3F];
}

if ( do_now < lentext )
{
    char tmpbuf[2] = {0,0};
    int left = lentext%3;
    for ( int i=0; i < left; i++ )
    {
        tmpbuf[i] = raw[do_now+i];
    }
    raw = tmpbuf;
    outbuf[outp++] = base64EncodingTable[(raw[inp] & 0xFC) >> 2];
    outbuf[outp++] = base64EncodingTable[((raw[inp] & 0x03) << 4) | ((raw[inp+1] & 0xF0) >> 4)];
    if ( left == 2 ) outbuf[outp++] = base64EncodingTable[((raw[inp+1] & 0x0F) << 2) | ((raw[inp+2] & 0xC0) >> 6)];
}

NSString *ret = [[[NSString alloc] initWithBytes:outbuf length:outp encoding:NSASCIIStringEncoding] autorelease];
free(outbuf);

return ret;
} 
```

因为我不需要它，所以我省略了线切割，但添加它是微不足道的。

对于那些对优化感兴趣的人：目标是尽量减少主循环中发生的事情。因此，处理最后 3 个字节的所有逻辑都在循环外处理。

此外，尝试就地处理数据，而无需额外复制到缓冲区/从缓冲区复制。并将任何算术减少到最低限度。

观察被放在一起以在表中查找条目的位在不移位的情况下被或在一起时不会重叠。因此，一个主要的改进可能是使用 4 个单独的 256 字节查找表并消除移位，如下所示：

```
outbuf[outp++] = base64EncodingTable1[(raw[inp] & 0xFC)];
outbuf[outp++] = base64EncodingTable2[(raw[inp] & 0x03) | (raw[inp+1] & 0xF0)];
outbuf[outp++] = base64EncodingTable3[(raw[inp+1] & 0x0F) | (raw[inp+2] & 0xC0)];
outbuf[outp++] = base64EncodingTable4[raw[inp+2] & 0x3F]; 
```

当然你可以更进一步，但这超出了这里的范围。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-10-21T12:04:29.077

更好的解决方案：

NSData 中有一个内置函数

```
[data base64Encoding]; //iOS < 7.0
[data base64EncodedStringWithOptions:NSDataBase64Encoding76CharacterLineLength]; //iOS >= 7.0 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2010-05-07T19:02:48.233

在 mvds 的出色改进中，存在两个问题。将代码更改为：

```
raw = tmpbuf;
inp = 0;
outbuf[outp++] = base64EncodingTable[(raw[inp] & 0xFC) >> 2];
outbuf[outp++] = base64EncodingTable[((raw[inp] & 0x03) << 4) | ((raw[inp+1] & 0xF0) >> 4)];
if ( left == 2 ) outbuf[outp++] = base64EncodingTable[((raw[inp+1] & 0x0F) << 2) | ((raw[inp+2] & 0xC0) >> 6)];
else outbuf[outp++] = '=';
outbuf[outp++] = '='; 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-07-06T00:09:40.407

很高兴人们喜欢它。我必须承认，最后的比赛有点缺陷。除了正确设置 inp=0 之外，您还应该将 tmpbuf 的大小增加到 3，例如

```
unsigned char tmpbuf[3] = {0,0,0}; 
```

**或者**省略 raw[inp+2] 的 orring；如果我们有一个 raw[inp+2] != 0 这个块，我们当然仍然在循环中......

无论哪种方式都有效，为了清楚起见，您可以考虑将最终表查找块与循环中的块保持相同。在我使用的最终版本中，我做到了

```
while ( outp%4 ) outbuf[outp++] = '='; 
```

添加 ==

对不起，我没有检查 RFC 和其他东西，应该做得更好！

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-08-11T15:45:04.577

iOS8及以后使用`- (NSString *)base64EncodedStringWithOptions:(NSDataBase64EncodingOptions)options`NSData

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-09-21T00:24:06.857

有关`NSData (NSDataBase64Encoding)`在 iOS7 中使用类别方法的更新，请在此处查看我的答案：[https ://stackoverflow.com/a/18927627/1602729](https://stackoverflow.com/a/18927627/1602729)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-10-16T01:47:10.890

```
#import "NSDataAdditions.h"
@implementation NSData (NSDataAdditions)

+ (NSData *) base64DataFromString: (NSString *)string {
  unsigned long ixtext, lentext;
  unsigned char ch, input[4], output[3];
  short i, ixinput;
  Boolean flignore, flendtext = false;
  const char *temporary;
  NSMutableData *result;

  if (!string)
    return [NSData data];

  ixtext = 0;
  temporary = [string UTF8String];
  lentext = [string length];
  result = [NSMutableData dataWithCapacity: lentext];
  ixinput = 0;

  while (true) {
    if (ixtext >= lentext)
      break;
    ch = temporary[ixtext++];
    flignore = false;

    if ((ch >= 'A') && (ch <= 'Z'))
      ch = ch - 'A';
    else if ((ch >= 'a') && (ch <= 'z'))
      ch = ch - 'a' + 26;
    else if ((ch >= '0') && (ch <= '9'))
      ch = ch - '0' + 52;
    else if (ch == '+')
      ch = 62;
    else if (ch == '=')
      flendtext = true;
    else if (ch == '/')
      ch = 63;
    else
      flignore = true;

    if (!flignore) {
      short ctcharsinput = 3;
      Boolean flbreak = false;

      if (flendtext) {
         if (ixinput == 0)
           break;              
         if ((ixinput == 1) || (ixinput == 2))
           ctcharsinput = 1;
         else
           ctcharsinput = 2;
         ixinput = 3;
         flbreak = true;
      }

      input[ixinput++] = ch;

      if (ixinput == 4){
        ixinput = 0;
        output[0] = (input[0] << 2) | ((input[1] & 0x30) >> 4);
        output[1] = ((input[1] & 0x0F) << 4) | ((input[2] & 0x3C) >> 2);
        output[2] = ((input[2] & 0x03) << 6) | (input[3] & 0x3F);
        for (i = 0; i < ctcharsinput; i++)
        [result appendBytes: &output[i] length: 1];
      }
    if (flbreak)
      break;
    }
  }
  return result;
}
@end 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-12-30T20:45:45.680

iOS 从 iOS 4 开始就内置了 Base64 编码和解码方法（不使用 libresolv）。但是，它只在 iOS 7 SDK 中声明。Apple 文档指出，您可以在针对 iOS 4 及更高版本时使用它。

```
NSData *myData = ... some data
NSString *base64String = [myData base64Encoding];
NSData *decodedData = [[NSData alloc] initWithBase64Encoding:base64String]; 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-11-10T21:11:48.527

这是一个紧凑的 Objective-C 版本，作为 NSData 上的一个类别。这需要一些思考...

```
@implementation NSData (DataUtils)

static char base64[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

- (NSString *)newStringInBase64FromData
{
 NSMutableString *dest = [[NSMutableString alloc] initWithString:@""];
 unsigned char * working = (unsigned char *)[self bytes];
 int srcLen = [self length];

 // tackle the source in 3's as conveniently 4 Base64 nibbles fit into 3 bytes
 for (int i=0; i<srcLen; i += 3)
 {
  // for each output nibble
  for (int nib=0; nib<4; nib++)
  {
   // nibble:nib from char:byt
   int byt = (nib == 0)?0:nib-1;
   int ix = (nib+1)*2;

   if (i+byt >= srcLen) break;

   // extract the top bits of the nibble, if valid
   unsigned char curr = ((working[i+byt] << (8-ix)) & 0x3F);

   // extract the bottom bits of the nibble, if valid
   if (i+nib < srcLen) curr |= ((working[i+nib] >> ix) & 0x3F);

   [dest appendFormat:@"%c", base64[curr]];
  }
 }

 return dest;
}

@end 
```

如果需要，可以通过使 'byte' 的范围更宽并在返回前附加 'dest' 和（2 字节）“=”字符来添加填充。

然后可以将 Category 添加到 NSString，因此：

```
@implementation NSString (StringUtils)

- (NSString *)newStringInBase64FromString
{
 NSData *theData = [NSData dataWithBytes:[self UTF8String] length:[self length]]; 

 return [theData newStringInBase64FromData];
}

@end 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-01-25T21:23:43.873

这是一个将 NSData 对象转换为 Base 64 的示例。它还展示了如何采用另一种方式（解码 base 64 编码的 NSData 对象）：

```
NSData *dataTake2 = 
  [@"iOS Developer Tips" dataUsingEncoding:NSUTF8StringEncoding];

// Convert to Base64 data
NSData *base64Data = [dataTake2 base64EncodedDataWithOptions:0];

// Do something with the data...

// Now convert back from Base64
NSData *nsdataDecoded = [base64Data initWithBase64EncodedData:base64Data options:0]; 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-02-06T07:56:25.670

在 iOS 7 中

```
 NSData *data=[[NSData alloc]init];
        [data base64Encoding]; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-07-10T12:50:43.110

我已经使用以下课程完成了它..

```
@implementation Base64Converter
static char base64EncodingTable[64] = {
'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L',  'M', 'N', 'O', 'P',
'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7',    '8', '9', '+', '/'
};
+ (NSString *) base64StringFromData: (NSData *)data length: (int)length {

unsigned long ixtext, lentext;

long ctremaining;

unsigned char input[3], output[4];

short i, charsonline = 0, ctcopy;

const unsigned char *raw;

NSMutableString *result;

lentext = [data length];

if (lentext < 1)
    return @"";

result = [NSMutableString stringWithCapacity: lentext];

raw = [data bytes];

ixtext = 0;

while (true) {

    ctremaining = lentext - ixtext;

    if (ctremaining <= 0)
        break;

    for (i = 0; i < 3; i++) {
        unsigned long ix = ixtext + i;
        if (ix < lentext)
            input[i] = raw[ix];
        else
            input[i] = 0;
    }

    output[0] = (input[0] & 0xFC) >> 2;

    output[1] = ((input[0] & 0x03) << 4) | ((input[1] & 0xF0) >> 4);

    output[2] = ((input[1] & 0x0F) << 2) | ((input[2] & 0xC0) >> 6);

    output[3] = input[2] & 0x3F;

    ctcopy = 4;

    switch (ctremaining) {
        case 1:
            ctcopy = 2;
            break;

        case 2:
            ctcopy = 3;
            break;
    }

    for (i = 0; i < ctcopy; i++)
        [result appendString: [NSString stringWithFormat: @"%c", base64EncodingTable[output[i]]]];

    for (i = ctcopy; i < 4; i++)
        [result appendString: @"="];

    ixtext += 3;

    charsonline += 4;

    if ((length > 0) && (charsonline >= length))
        charsonline = 0;
}
return result;
}
@end 
```

打电话的时候

```
 [Base64Converter base64StringFromData:dataval length:lengthval]; 
```

而已...

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-01-29T04:23:55.640

我认为这会有所帮助

```
 + (NSString *)toBase64String:(NSString *)string {
    NSData *data = [string dataUsingEncoding: NSUnicodeStringEncoding];

    NSString *ret = [data base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength];

    return ret;
    }

    + (NSString *)fromBase64String:(NSString *)string {
NSData *aData = [string dataUsingEncoding:NSUTF8StringEncoding];
NSData *aDataDecoded = [[NSData alloc]initWithBase64EncodedString:string options:0];
NSString *decryptedStr = [[NSString alloc]initWithData:aDataDecoded encoding:NSUTF8StringEncoding];

return [decryptedStr autorelease]; 
```

}

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-09-10T07:27:08.703

下载[Base64](https://github.com/nicklockwood/Base64)

执行以下代码将图像转换为 base64

```
NSString *base64String=[UIImagePNGRepresentation(image) base64Encoding]; 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-01-10T05:31:28.097

根据您的要求，我使用**Swift 4**创建了一个示例演示，您可以在其中根据您的要求对字符串和图像进行编码/解码。

*   我还添加了相关操作的示例方法。

    ```
    //
    //  Base64VC.swift
    //  SOF_SortArrayOfCustomObject
    //
    //  Created by Test User on 09/01/18.
    //  Copyright © 2018 Test User. All rights reserved.
    //

    import UIKit
    import Foundation

    class Base64VC: NSObject {

        //----------------------------------------------------------------
        // MARK:-
        // MARK:- String to Base64 Encode Methods
        //----------------------------------------------------------------

        func sampleStringEncodingAndDecoding() {
            if let base64String = self.base64Encode(string: "TestString") {
                print("Base64 Encoded String: \n\(base64String)")
                if let originalString = self.base64Decode(base64String: base64String) {
                    print("Base64 Decoded String: \n\(originalString)")
                }
            }
        }

        //----------------------------------------------------------------

        func base64Encode(string: String) -> String? {
            if let stringData = string.data(using: .utf8) {
                return stringData.base64EncodedString()
            }
            return nil
        }

        //----------------------------------------------------------------

        func base64Decode(base64String: String) -> String? {
            if let base64Data = Data(base64Encoded: base64String) {
                return String(data: base64Data, encoding: .utf8)
            }
            return nil
        }

        //----------------------------------------------------------------
        // MARK:-
        // MARK:- Image to Base64 Encode  Methods
        //----------------------------------------------------------------

        func sampleImageEncodingAndDecoding() {
            if let base64ImageString = self.base64Encode(image: UIImage.init(named: "yourImageName")!) {
                print("Base64 Encoded Image: \n\(base64ImageString)")
                if let originaImage = self.base64Decode(base64ImageString: base64ImageString) {
                    print("originalImageData \n\(originaImage)")
                }
            }
        }

        //----------------------------------------------------------------

        func base64Encode(image: UIImage) -> String? {
            if let imageData = UIImagePNGRepresentation(image) {
                return imageData.base64EncodedString()
            }
            return nil
        }

        //----------------------------------------------------------------

        func base64Decode(base64ImageString: String) -> UIImage? {
            if let base64Data = Data(base64Encoded: base64ImageString) {
                return UIImage(data: base64Data)!
            }
            return nil
        }

    } 
    ```

# visual-studio - 如何将现有目录树添加到 Visual Studio 中的项目？

> ID：392473
> 
> 赞同：897
> 
> 时间：2008-12-25T03:17:13.993
> 
> 标签：visual-studio

这个问题真的很简单。我没有在 Visual Studio 中创建文件夹，而是在文件系统上为我的项目创建了一个目录结构。如何在项目中包含所有文件夹和文件，保持结构？

如果我在名为 Services 的文件夹上“添加现有文件”并导航到目录结构中的文件 ..Services > AccountManagement > CreateAccount.cs，它在 Visual Studio 中显示如下：Services > CreateAccount.cs。我不想要这个。

我已经制定了一个完整的目录结构，因为我正在模仿我们的客户开发人员使用相同的组织结构。如何在 Visual Studio 中将所有文件夹和文件添加到项目中？还是我必须做大多数 Microsoft 用户所做的事情并“忍受它”并通过 Visual Studio 重新创建每个文件夹？

* * *

## 回答 #1

> 赞同：1542
> 
> 时间：2008-12-25T03:25:40.997

您需要将目录结构放在项目目录中。然后单击解决方案资源管理器工具箱顶部的“显示所有文件”图标。之后，将显示添加的目录。然后，您需要选择此目录，右键单击并选择“包含在项目中”。

[![在此处输入图像描述](https://i.stack.imgur.com/ub2DI.png)](https://i.stack.imgur.com/ub2DI.png)

[![在此处输入图像描述](https://i.stack.imgur.com/oIDP1.png)](https://i.stack.imgur.com/oIDP1.png)

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2008-12-25T03:48:19.420

[您还可以将文件夹从Windows 资源管理器](http://en.wikipedia.org/wiki/Windows_Explorer)拖放到您的 Visual Studio 解决方案窗口中。

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2016-02-25T16:18:22.483

在 Visual Studio 2015 中，您就是这样做的。

如果要自动包含特定文件夹下的所有后代文件：

```
<Content Include="Path\To\Folder\**" /> 
```

这可以限制为仅包含指定路径中的文件：

```
<Content Include="Path\To\Folder\*.*" /> 
```

甚至只有具有指定扩展名的文件：

```
<Content Include="Path\To\Folder\*.jpg" > 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2013-06-25T14:38:04.083

**复制和粘贴**。

要添加文件夹、所有子目录和文件，我们还可以复制和粘贴。例如我们可以：

1.  右键单击文件夹上的 Windows 资源管理器，然后复制包含许多文件和文件夹的文件夹。

2.  然后在 Visual Studio 解决方案资源管理器中，右键单击目标文件夹并单击粘贴。

3.  可选添加到 TFS；然后在顶部文件夹中右键单击并签入 TFS 以签入所有子文件夹和文件。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2014-10-23T21:24:12.160

您可以使用符号链接。这使得在一个项目中修改文件会在另一个项目中修改它（因为它实际上是同一个文件）。

去做这个：

1.  以管理员身份打开cmd提示符
2.  mklink /d [当前项目目录名称] [它应该指向的其他项目中的目录]

这有它的缺点和陷阱，但我有时将它用于需要不同名称的重复库。

编辑 Anoop：添加到 Visual Studio 的步骤：

1.  使用上述步骤在项目文件夹中创建链接。
2.  在 Visual Studio... 中选择解决方案资源管理器中的项目。
3.  在解决方案资源管理器的顶部...单击显示所有文件按钮（如果已激活，可能需要单击两次）。
4.  该链接现在将显示在您的项目中...右键单击并选择包含在项目中。

这些是我遵循的步骤，适用于几个不同的项目。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2018-03-14T14:06:33.483

在 Visual Studio 2017 中，您可以在*解决方案视图*和*文件夹视图*之间来回切换。我认为这是一个更好的选择，因为它将使解决方案保持清洁。我用它来编辑 .gitignore、.md 文件等。

[![解决方案视图和文件夹视图](https://i.stack.imgur.com/P5tSD.png)](https://i.stack.imgur.com/P5tSD.png)

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2017-08-21T23:30:09.537

要扩展[Yuchen 的答案](https://stackoverflow.com/a/35632703/492)，您可以包含文件和路径作为链接。这与添加现有项目不同，因为它不会在项目的文件夹结构中创建额外的副本。如果您希望在许多不同的地方使用一个规范的文件夹/文件等，但您只想维护它的一个版本/副本，这将很有用。

这是您可以添加到`*.csproj`文件以创建链接的示例

```
<Compile Include="$(Codez)\z.Libraries\Common\Strings\RegexExtensions.cs">
    <Link>Helpers\RegexExtensions.cs</Link>
</Compile>

<Compile Include="..\..\z.Libraries\MoreLINQ\MoreLinq\ExceptBy.cs">
    <Link>Helpers\ExceptBy.cs</Link>
</Compile>

<Content Include="C:\Codez\Libs\Folder\OtherFolder\**\*.*">
    <Link>%(RecursiveDir)%(Filename)%(Extension)</Link>
    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
</Content> 
```

`$(Codez)`是我定义的一个Windows环境变量，你可以用同样的方式使用内置的环境变量。

最后一个示例组是我在最终输出中需要的一堆内容文件。有关更多信息，请参阅[https://stackoverflow.com/a/11808911/492](https://stackoverflow.com/a/11808911/492)和其他答案和链接。

更多 MSBuild 信息，请访问[https://msdn.microsoft.com/en-us/library/bb629388.aspx](https://msdn.microsoft.com/en-us/library/bb629388.aspx)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-01-31T17:29:50.627

我想我找到了一种方法来使用 Compile Include=".\Code***.cs" 我想要的是在我的代码文件夹下递归地包含代码。

这是项目文件示例。

```
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="15.0" DefaultTargets="BuildTarget">
    <PropertyGroup>
        <OutputType>Library</OutputType>
    </PropertyGroup>
    <PropertyGroup>
        <StartupObject />
    </PropertyGroup>
    <PropertyGroup>
        <RootNamespace>Autogen</RootNamespace>
    </PropertyGroup>
    <ItemGroup>
        <Compile Remove="@(Compile)" />
        <Compile Include=".\Code\**\*.cs" />
    </ItemGroup>
    <Target Name="BuildTarget">
        <Message Text="Build selected" Importance="high"/>
    </Target>
</Project> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-01-17T15:06:01.160

在 Visual Studio 2013 中，右键单击文件夹时无法让“包含在项目中”工作。起作用的是扩展文件夹，选择所有文件，然后选择“包含在项目中”。这很繁琐，因为您必须一个一个地处理每个文件夹（但至少您可以一次完成每个文件夹中的所有文件），并且它似乎存储了文件路径（您可以通过查看文件的属性来查看并查看“相对路径”选项。）

我希望使用它在 Visual Studio 安装程序项目中部署一些数据文件，它似乎可以拾取包含的文件并保留它们的路径。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-06-26T23:03:47.790

Visual Studio 2017 及更新版本支持一种新的轻量级`.csproj`格式，该格式已被称为“SDK 格式”。这种格式的几个优点之一是，默认情况下，文件不是包含文件和文件夹的列表，而是包含*通配符*。**因此，使用这种新格式，您的文件和文件夹 - 添加到资源管理器或命令行中 - 将被自动拾取！**

SDK 格式`.csproj`文件[目前适用于以下项目类型](https://natemcmaster.com/blog/2017/03/09/vs2015-to-vs2017-upgrade/)：

*   类库项目

*   控制台应用

*   ASP.NET Core Web 应用

*   任何类型的 .NET Core 项目

要使用新格式，请创建一个新的 .NET Core 或 .NET Standard 项目。因为即使在 Visual Studio 2019 中也没有针对完整的 .NET Framework 更新模板，所以要创建 .NET 类库，请选择 .NET Standard Library 模板，然后编辑项目文件以定位您选择的框架版本（可以在 Visual Studio 中编辑新样式的项目格式 - 只需在解决方案资源管理器中右键单击项目并选择“编辑项目文件”）。例如：

```
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net46</TargetFramework>
  </PropertyGroup>
</Project> 
```

进一步阅读：

*   [旧 csproj 到新 csproj：Visual Studio 2017 升级指南](https://natemcmaster.com/blog/2017/03/09/vs2015-to-vs2017-upgrade/)
*   [揭开 SDK 项目的神秘面纱](https://dansiegel.net/post/2018/08/21/demystifying-the-sdk-project)
*   [MSDN：.NET Core 的 csproj 格式的补充](https://docs.microsoft.com/en-us/dotnet/core/tools/csproj)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-02-14T18:41:44.747

我没有找到令我满意的答案，所以我自己想通了。

如果您想将外部源代码添加到您的项目并且不想复制整个代码，这就是您的答案。我对其他 git 有很多依赖，它们每小时更新一次，如果不是每分钟更新一次。我不能每小时复制一次来同步。这是您需要做的。

假设这是结构：

/root/projA/src

/root/projA/包括

/root/projB/src

/root/projB/包括

/root/yourProj/src

/root/yourProj/包括

1.  启动您的 VS 解决方案。
2.  右键单击解决方案正下方的项目名称。
3.  然后点击“添加”，“新建过滤器”，把名字“projA”换成projA。
4.  右键单击“projA”，单击“添加”，“新建过滤器”，输入名称“src”
5.  右键单击“projA”，单击“添加”，“新建过滤器”，输入名称“includes”
6.  右键单击“projA”/“src”，单击“添加”，“现有项目”，然后浏览到 /root/projA/src 以添加所有源代码或一一添加您想要的源代码。
7.  对“projA”/“includes”做同样的事情
8.  对 projB 做同样的事情。现在，您的解决方案/项目中存在您之外的外部/现有项目。VS 会将它们编译在一起。这是一个技巧。由于 projA 和 projB 是您项目下的虚拟文件夹，因此编译器可能找不到 projA/includes。

9.  如果没有找到 projA/includes，则右键单击项目，选择“属性”。

10.  导航到“C/C++”。编辑“其他包含目录”，添加您的 projA/include，例如“../projA/includes”，相对路径。

一个警告，如果有重复的包含/头文件，“头文件”上的“从项目中排除”实际上不起作用。这是VS中的一个错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-29T20:04:47.047

据我所知，在 VS2010 中执行此操作的唯一方法类似于拖放方法。右键单击要添加项目的解决方案。应用程序菜单将有一个添加 ... 项。打开它，您会发现其中一个选项是将现有项目添加到解决方案中。

在打开的对话框中，导航到包含解决方案项目文件的文件夹并选择它。作为导入该项目文件的一部分，VS 还将导入整个目录，并且我假设任何属于该项目的从属目录。

由于这确实需要一个现有的项目文件，因此在将目录树转换为项目之前，导入目录树是不可能的。

# mysql - 托管：为什么 MySQL 数据库的数量很重要？

> ID：392492
> 
> 赞同：2
> 
> 时间：2008-12-25T03:59:23.033
> 
> 标签：mysql, hosting, web-hosting, shared-hosting

好的，也许我在这里遗漏了一些东西，但我正在查看各种[PHP 托管选项](https://stackoverflow.com/questions/392476/good-php-hosting-options)，我看到诸如“10 个 MySQL 数据库”之类的东西，或者 25 个甚至无限。

现在，我曾在具有 10,000 多个并发用户的 Oracle 后端的站点上工作，并且我们拥有……一个数据库。

当然，数据库的想法是您可以在其中存储任何您想要的东西。那么为什么对于 MySQL 来说这个数字很重要呢？是否有一些我不知道的表、行或整体数据库限制（完全可能）？或者它是一个问题或并发连接？还是其他一些性能问题（例如分片）？分片方面似乎不太可能，因为即使是基本的托管选项（即每月 5 美元以下）我也看到了 10 个数据库。

如果有人能在这件事上给我线索，那就太好了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-25T04:35:13.070

这主要是一种营销策略，尽管有一些技术和历史方面的考虑。

首先，如果这很明显，我们深表歉意，但是 SCHEMA 之于 Oracle 就像 DATABASES 之于 MySQL（简而言之，是表的逻辑集合）。

主持人说您可以在服务器上拥有 XX 个已配置的逻辑数据库。许多 Web 应用程序需要数据库才能运行。现代 Web 应用程序，如 Wordpress、Movable Type、Joomla 等，将允许您使用自定义前缀命名您的表格。但是，如果应用程序没有此配置功能，则意味着每次安装都需要一个数据库。同样，如果两个应用程序具有相同的表名，它们就不能共存于一个数据库中。许多早期的 Web 应用程序都是这样开始的，所以早期的数据库数量是一个需要考虑的重要特性。

还有访问和安全性。虽然 MySQL（和其他数据库）可以配置为向用户提供细粒度的访问控制到表和列级别，但创建一个对逻辑数据库具有完全权限的用户通常更容易。这对于销售服务但将已完成站点/应用程序的实际托管传递给共享网络主机的人来说很重要。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-25T04:04:32.120

有些人喜欢每个应用程序一个数据库

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T04:10:18.237

是营销，不是技术。他们想要做一些广告。“10”听起来是个不错的数字。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T04:10:52.107

当我使用共享主机时，我为自定义应用程序的每个站点/客户端设置了一个单独的数据库，如果您使用 Fantastico 安装应用程序，它将默认为每个应用程序使用一个数据库。

我相信当您超出当前级别时，这些限制会提示您升级到下一层服务。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-25T04:17:01.343

出于开发目的，有时最好复制整个数据库来测试新软件。Beats 重命名代码中的所有表（尽管 Wordpress 等应用程序允许您为所有表名指定前缀，以防万一您没有多个 DB）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-25T05:43:59.157

Nick 部分正确，但它也与那些试图在一个共享帐户上托管多个站点并为每个站点使用不同的数据库和脚本以通过少量 dns 伪装提供正确内容的人有关。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-25T05:41:40.003

此外，它可能是一个营销角度。

如果您只是为自己设置数据库，那么低计数就可以了。但是对于*商业*用户，他们可能希望在一项服务上为多个客户提供多个站点，试图偷工减料，每个客户/项目可能需要 1 个数据库（或更多）。

因此，对数据库数量进行限制会在一定程度上控制您提供的各种服务，并可能限制您“转售”价值的潜力，即：阻止您购买 1 个计划，然后将其出售给其他人，例如“转租”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-25T05:55:56.403

这主要用于当您在同一个盒子上托管多个站点时。对我来说，我买/卖了很多网站，所以我需要能够让每个网站尽可能地与其他网站分离。

# sqlite - SQLite3::SQLException的问题：SQL逻辑错误或缺少数据库

> ID：392493
> 
> 赞同：3
> 
> 时间：2008-12-25T04:02:38.190
> 
> 标签：sqlite

> SQLite3::SQLException: SQL 逻辑错误或缺少数据库

从浏览器对表进行插入、更新和删除操作时出错（这意味着创建、更新和销毁操作失败但显示操作很好），控制台中的相同操作是可以的。我用谷歌搜索了这个问题，发现大多数解决方案是删除夹具中的重复项，因此我从夹具中删除了所有测试数据并重新启动服务器，但它再次失败：（
感谢任何建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-25T05:18:00.910

原来我忘记了使用`"sudo script/server"`来获得对数据库的写权限:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-14T19:58:41.710

我不是说要死而复生，只是我遇到了这个问题，我找到的流行答案并不适用。

我的问题原来是 Firefox 的 SQLite Manager 插件。我使用 SysInternals“句柄”程序来确定 a) Firefox/SQLiteManager 有（我假设）一个打开的事务，并且 b) 每次我使用插件连接到数据库时，它都没有破坏前一个，不再可以访问。

我退出了 Firefox，我的代码运行良好。我再次加载了 Firefox 和 SQLite Manager，但没有开始事务；再次，我的代码运行良好。我的代码是 Python，而不是 RoR。

我会推荐这个答案，并将原始问题标记为 [sqlite3]。它绝对不是特定于 RoR 的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-01-30T17:54:48.153

这可能不是我观察的正确位置，但是：

我花了几个小时发现两个 C++ 线程连接到一个数据库的问题。

出于某种愚蠢的原因，我正在`COMMIT`从一个线程执行一个打算在另一侧执行的线程。

提交运行良好，但另一个线程立即`AUTO COMMIT`被设置为`true`.

# .net - 如何避免 .NET 3.0 / WinForms / SQLServer 2005 中的这种阻塞情况？

> ID：392501
> 
> 赞同：1
> 
> 时间：2008-12-25T04:22:08.683
> 
> 标签：.net, winforms, sql-server-2005

应用 1 -

*   针对 SQLServer 2005 数据库打开 SqlConnection 和 SqlTransaction
*   在 Table1 中插入一条记录
*   不提交或回滚 SqlTransaction - 故意保持此状态以演示/描述问题

应用 2 -

*   针对 SqlServer 2005 数据库打开 SqlConnection 和 SqlTransaction
*   尝试运行此查询 - “SELECT COUNT(Id) FROM Table1”

表 1 - Id 是一个身份字段。名称是一个 varchar 字段。表中没有其他字段

应用程序 2 无法运行“SELECT ...”查询。似乎 Table1 被应用程序 1 中的插入锁定或阻塞。

虽然上面提到的场景是虚构的 - 它充分展示了我们面临的问题。我们希望能够打开一个长时间运行的 SqlTransaction（可能是几个小时）并通过该 SqlTransaction 进行许多插入/更新。

我们正在开发一个数据转换应用程序，它必须对大量数据进行大量处理，然后才能将其插入/更新到数据库中。数据转换发生在我们的主要基于 WebForms 的应用程序在同一个 SQLServer 2005 数据库上运行时，我们希望在该数据库中执行长时间运行的事务。

我们应用程序中的所有表都由 ClientMaster 表中的 ClientID 字段分段。例如，如果我们有一个 CollegeMaster 表，那么它将有一个 ClientID 字段作为主键的一部分，并有一个 ID 字段作为它自己的标识。数据转换从创建一个新的 ClientID 开始，该新的 ClientID 字段用于所有其他表。

理想情况下，像应用程序 2 中提到的所有查询都不应受到长时间运行的事务的影响。这些查询应该只读取/使用已经提交并继续工作的数据，而不是由于长时间运行的事务而被阻塞。应用程序 1 可以做些什么来确保实现这一目标？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T04:31:08.477

我建议不要进行长时间运行的事务；然而，话虽如此：

您可以通过使用提示来降低事务隔离级别。我通常不推荐这种做法，但如果您选择这样做：

select count(id) from Table1 (NOLOCK) 你基本上会绕过表上的所有锁；但是，请注意，您将可以并且最终会出现脏读、幻读（数据在前一分钟但不在下一分钟）。如果您的查询是真正分段的，那么您应该没问题。您还可以在在线图书中查看其他提示。

另一种选择是在暂存表中进行所有长时间运行的处理，然后将最终复制/插入到 table1 中。这将有助于缩短交易时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T06:01:11.773

您可能想查看此 Sql 2005 功能。听起来它可以帮助你。它是一种更新的锁定机制，您必须在数据库中启用，但显然阻塞要少得多。

[http://msdn.microsoft.com/en-us/library/ms177404(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms177404(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T04:58:13.710

长期运行的数据转换事务背后的原因是 SQLServer 2005 已经具有回滚功能。如果数据转换出现问题，我们可以使用该工具回滚插入/更新的数据。

反对临时表的原因是我们有很多身份字段，在并发情况下很难跟踪。在从实际源表转换为暂存表时，我们将在“主”表中生成一组标识值，这些值将在“子”暂存表中进一步使用。接下来，在将数据从临时表推送到目标表时，我们必须确保为“主”表生成的新标识值正确映射并传播到“子”表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T11:35:06.420

为什么不将所有更改存储在 DataSet 中并一次全部提交？这不能解决长期运行的事务问题吗？

# sql-server - LogParser 删除日志条目

> ID：392505
> 
> 赞同：1
> 
> 时间：2008-12-25T04:29:02.693
> 
> 标签：sql-server, iis, logparser

我正在将 IIS 日志文件导入 SQL 数据库，但由于某种原因，并非每个条目都进入数据库。例如，如果日志文件有 1,000,000 个条目，logparser 确实说它处理了 1,000,000 个条目，但如果我在数据库中执行 SELECT COUNT(*)，我没有 1,000,000 行数据。有没有人见过这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T07:54:20.747

数据是否在输入时被截断，因此该行被丢弃？

您导入的方式（bcp、BUK INSERT、SSIS）决定了它是真正的批量加载还是逐行加载。错误处理设置（忽略、中断、最大数量等）决定了截断时会发生什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T21:17:54.697

也许它在第一个计数中计算标题行（其中通常不仅仅是文件顶部的内容）？然后他们在导入到数据库中被删除了？只是一个猜测。

# networking - 在 Windows Mobile (5/6) SDK 中，windns.h 去了哪里？

> ID：392507
> 
> 赞同：0
> 
> 时间：2008-12-25T04:31:44.403
> 
> 标签：networking, windows-mobile

根据[http://msdn.microsoft.com/en-us/library/aa916070.aspx](http://msdn.microsoft.com/en-us/library/aa916070.aspx) (DnsQuery_W)，Windows Mobile/CE 开发人员可以使用 5.0 及以上版本的 DNS 查询库。然而，“#include”给出了令人讨厌的“找不到文件”错误。是什么赋予了？奇怪的是“dnsapi.lib”是可用的。微软真的希望开发人员从某个地方清除文件吗？...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T06:39:30.230

[此处](http://www.eggheadcafe.com/software/aspnet/29287111/dnsqueryw-in-windows-mob.aspx)发布的线程声称此 API 实际上在 Windows Mobile 5 中不可用（也许更高版本？），尽管另有声明。我查看了 Mobile 5 和 6 SDK，也没有看到这个 API，所以线程的建议可能对你有用：

> 如果是简单的主机名->IP 地址（IPv4 或 v6），您可以在 Winsock 中使用 getnameinfo。仅当您执行非 A/AAAA 查询时才需要 DNSQuery_W。如果您正在这样做，我们真的没有任何帮助者可以从操作系统方面为您执行此操作 - 抱歉。您可能会环顾四周，看看是否有可以为 CE 重新编译的辅助库（假设您对他们可能给您的任何许可协议感到满意。）

getnameinfo 应该记录[在这里](http://msdn.microsoft.com/en-us/library/aa923585.aspx)（对于 Windows Mobile），以防万一。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T20:33:02.947

如果你真的在追求 'windns.h'，我在 WM5/WM6/WM6.1 Platform Builders 中找到了它

\public\common\sdk\inc

如果您是 ISV，困难的部分是访问 WM Platform Builder。那个我帮不了你。

# .net - 在 VS 中使用 64 位操作系统进行 .Net 开发

> ID：392510
> 
> 赞同：2
> 
> 时间：2008-12-25T04:32:13.733
> 
> 标签：.net, visual-studio-2008, resharper, 64-bit

[由于安装了 Resharper](http://itscommonsensestupid.blogspot.com/2008/10/impressions-on-resharper.html)，当我在 Visual Studio 2008 中进行 .Net 开发时，我的开发机器（32 位 Windows XP）运行速度非常慢。所以我正在考虑将我的开发机器切换到 64 位 Windows XP。

不确定这样的转换是否会加快开发速度？64位机器没有内存问题，所以Resharper的内存问题可以通过投入越来越多的RAM来解决。

有人使用 64 位操作系统开发吗？愿意分享您的经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-25T05:16:53.220

64 位无法解决 Resharper 4.0 的内存问题，因为 Visual Studio 2008 无论如何都作为 32 位进程运行。[不过， Resharper 4.5](http://rabdullin.com/journal/2008/12/19/resharper-45-features-and-release-date.html)将解决一些问题。

PS：这是我在 64 位下开发的帖子：[使用 Windows Server 2008 64 位作为开发工作站](http://rabdullin.com/journal/2008/6/23/using-windows-server-2008-64-bit-as-a-development-workstatio.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T13:21:31.400

只有一个提示：远离 64 位 XP。对于 Vista 和 Server 2008，在驱动程序和软件方面的 64 位支持大部分都很棒，但 XP64 从未真正被业界采用，我相信你会后悔那一步。

话虽如此，具有 8 GB RAM 的 Visual Studio 2008 和 Vista 64 = 非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T15:37:33.903

我在 64 位 Vista 上工作了几个月，我必须说，与 32 位平台相比，您可以真正感受到差异。

关于内存问题——我实际上认为 64 位平台会解决这个问题，因为这里的 32 位进程使用完整的 2G 地址空间，这在 32 位平台上通常不是这种情况。

顺便说一句，我的硬件设置很常见（没什么特别的）：Core 2 Duo 2.4GHz with 4GB Ram。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T04:55:40.173

我在 64 位 Windows 2008 上进行开发，效果很好。我什至不知道resharper在那里。

但是随后（警告，无偿的男子气概在前面挥手）我的主开发箱有一个四核 Xeon 3Ghz，带有 12Gb RAM 和一对 15k SAS 磁盘。

我还在 Hyper-V 下同时运行三个 32 位 windows 2003 开发环境，每个环境都有 2GB 内存。

64 位世界在强大的硬件上摇摆不定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T11:37:01.160

只需阅读：Resharper for Dummies。不完全是！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-28T17:15:42.313

我还在 64 位 Windows Vista Ultimate 上进行开发。我的盒子有一个华硕 P5K Premium mb（非常棒，顺便说一句），配备 2.67 GHz Intel Core2 Quad Q9450 处理器、8 GB RAM 和 2 TB HD（2 x 1TB RAID 0）。我的显示适配器是具有 512 MB VRAM 的 NVIDIA GeForce 9600 GT。

我真的没有注意到 Resharper 工作。它是如此令人眼花缭乱，以至于根本没有任何区别。

截至今天，我使用 R# 4.5 只是为了测试。它更快了。到目前为止，我没有发现任何问题。我通过它运行了一个大型项目，它运行完美。唉，我仍然缺少有关此新版本中已实现的新功能的详细信息。

在我购买具有 24 GB RAM 的 Core i7 之前，我认为这种设置非常适合开发。它相对便宜，容易获得，而且速度非常快。Windows Vista 64 非常适合开发。

# interface - 可以初始化一些东西吗？

> ID：392513
> 
> 赞同：11
> 
> 时间：2008-12-25T04:35:25.427
> 
> 标签：interface

我创建了一个名为 Initializable 的界面，但根据[Dictionary.com](http://dictionary.reference.com/browse/initializable) ，这不是一个词。搜索[谷歌](http://www.google.ca/search?q=initializable)只给出大约 30k 的结果，它们主要是 API 参考。

是否有另一个词来描述可以初始化的东西（这**是**一个词）？

**编辑：**

感谢有关它在构造函数中的问题，这可能是一个更好的方法。现在它们是静态类（就像在 Ruby 中一样是静态的），可以动态加载并有一些初始化工作要做。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-25T05:11:20.797

技术人员一直在创造新词。（见下面的例子）但这不是创造一个新词的情况。这是一个“推导”的案例。您使用了一个非常好的词（“初始化”）并为其添加了一个完全好的[衍生后缀](http://www.prefixsuffix.com/affixes.php)（“能够”）。生成的可初始化词是派生词。

简而言之，如果某些东西可以被初始化，那么它就是可初始化的。就像它可以运行或停止一样。

现在，我认为用不了多久就会有一个语法纳粹指出我在这里的方式错误。但英语是丰富而富有表现力的语言。一个词不一定要在“dictionary.com”上列出才能有效。甚至在[mw.com](http://code.msdn.microsoft.com/solverfoundation)（我认为这是一个更好的网站）上也没有。

我最喜欢的一本书是[加纳的《现代美国用法》](https://rads.stackoverflow.com/amzn/click/com/0195161912)。这是一本很棒的书，不仅仅是一本字典——它是关于如何使用美式英语的参考和指南。

“原子”是我们在软件开发中一直使用的一个词的一个很好的例子，它在某种程度上是一个“虚构”的词。在开发环境中，原子性的事情要么发生，要么不发生——它不能被分成单独的操作。但是，这个词的通用定义没有考虑到这种用法。

呸! 这是一个更好的……“Grep” 字典中没有——但是，一个非常好的词。我用它所有的时间

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-25T04:47:21.063

怎么样 -

```
interface ICanBeInitialized 
```

或者......（我在圣诞节喝了一点酒......很抱歉）

```
interface ICanHazInitialization 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T05:15:05.690

我认为问题——除了关于这个词的迂腐问题，我将在下面提到——你打算通过这个“可初始化”标签识别的行为可能是什么。

在例如 Java 中编写私有方法 init() 来进行复杂的初始化并不罕见。因为在多个地方可能需要该代码（复制构造函数、克隆操作等），它只是一种很好的形式。它不太常见，但有效的事情是，构造一个“转发”类，但它正在等待一些异步操作以便完全初始化（例如，异步完成令牌模式）。所以这不一定只在ctor中，但我很好奇你想要的实际行为是什么。

从字面上看，英语是一种有点粘连的语言，就像德语一样：有一些语法规则可以根据基本词和模式中的其他音节来构建作品。其中之一就是这里的“初始”->“初始化”=>“可初始化”。任何母语人士都会将“可初始化”识别为具有能够被初始化的属性的东西。所以它是一个价值词，但他们在字典中没有这个词，原因与没有单独的复数条目相同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-25T04:43:44.350

如果谷歌返回“Initializable”的 API 引用，在我看来它是一个有效的接口名称，即使它可能不是一个有效的英文单词。使用虚构的词并没有错，只要它是描述性的。

我唯一感到困惑的是类通常能够通过它们的构造函数进行初始化。您的接口如何提供无法通过使用构造函数获得的功能？这个问题的答案可能会提供一个比简单的“Initializable”更具描述性的名称。（即*以什么方式*初始化？）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-25T04:44:20.867

如果发明的词很清楚，我认为为类似 API 的事物编造一个词没有错。

我认为比`Initializable`发明的更糟糕的词——比如“stringize”和“RAII”（我知道这不是一个词，但它仍然是一个经常使用的术语，每次都让我畏缩——尽管这个概念是 doubleplusgood）。

我可能遇到的问题`Initializable`是，它听起来像是一个接口，它完成了构造函数应该做的事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-25T04:46:00.007

如果 Initializable 最清楚地描述了界面是关于什么的，那么我不会在意试图找到另一个单词，因为它是一个有效的英文单词。只要它不是 UI 字符串，优先级应该是命名清晰而不是英语单词的有效性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-25T04:50:05.600

是的，没关系。编程术语不必在字典中。Dictionary.com 也不喜欢“Serializable”，我们都知道这没关系。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-25T04:51:16.987

是的。如果意思清楚，不要让现有单词的缺失破坏你的创造力

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-05T21:14:28.477

对于那些质疑使用初始化的人 - 您可能希望将构造函数逻辑放在 void 方法中，以避免在通过工厂构造弱耦合类时出现竞争条件。

示例工厂：

```
 public static T CreateSingleInstance<T>(string providerName, string sectionName)           
    {
        //create the key
        ProviderKey key = new ProviderKey(providerName, typeof(T));

        //check key
        if (!_singletons.ContainsKey(key))
        {
            object provider = _singletons[key] = CreateInstance<T>(providerName, sectionName);

            IInitializable initializableProvider = provider as IInitializable;
            if (initializableProvider != null)
                initializableProvider.Initialize();
        }

        return (T)_singletons[key];
    } 
```

将导致竞争条件的示例实现构造函数

```
 public class Class
    {
        public Class()
        {
            Factory.CreateSingleInstance<OtherClass>(null, null);
        }
    }
    public class OtherClass
    {
        public OtherClass()
        {
            Factory.CreateSingleInstance<Class>(null, null);
        }
    } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-14T13:21:29.370

为了回应其他人所说的话，它是有效的英语，因为英语与许多语言一样，是公式化的，您只是在应用一个有效的语言公式。看起来你正在做的事情有优先权。SQL Server 团队认为您所做的事情是有效的，因为他们提出了相同的`IInitializable`接口（请参阅[此处](https://docs.microsoft.com/en-us/dotnet/api/microsoft.sqlserver.management.iinitializable?view=sqlserver-2016)）。它看起来像这样：

```
public interface IInitializable {
    public void Initialize (IServiceProvider serviceProvider);
} 
```

# c# - 如何在 C# 中使用 Web 服务下载文件？

> ID：392539
> 
> 赞同：2
> 
> 时间：2008-12-25T05:37:40.200
> 
> 标签：c#, web-services, file

如何通过网络服务下载文件？以及客户端应用程序如何接受这个？我在客户端应用程序中写下如下代码，它引发异常“访问被拒绝”

```
wsDownload.wsDownloadFile downFile = new wsDownload.wsDownloadFile();
byte[] file = downFile.DownloadFile(strFileName, "", "", "");
MemoryStream mStream = new MemoryStream(file); 
```

任何回应表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T05:42:00.860

“拒绝访问”可能只是意味着本地 Web 服务用户没有对该文件的本地副本的读取权限。

罗恩

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T12:40:17.133

这可能是服务端的 ntfs 权限问题。您应该将包含您正在下载的文件的文件夹的读取权限授予运行 WS 的用户帐户，通常是 IIS_WPG。

# c++ - 在启动时为程序添加参数

> ID：392540
> 
> 赞同：2
> 
> 时间：2008-12-25T05:41:24.280
> 
> 标签：c++, parameters

我目前正在尝试制作一个执行不同职责的小型应用程序。现在我有一个控制台应用程序弹出并询问我想做什么，但有时我宁愿用 MyApp.exe -printdocuments 之类的东西启动它。

是否有任何教程可以向我展示一个简单的示例？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-25T05:49:24.980

在 C++ 中，您的`main()`函数可以有`argc`和`argv`参数，其中包含在命令行上传递的参数。`argc`是参数的计数（包括可执行文件名称本身），并且是`argv`指向长度为 null 的字符串的指针数组`argc`。

例如，这个程序打印它的参数：

```
#include <stdio.h>

int main(int argc, char *argv[])
{
    for (int i = 0; i < argc; i++) {
        printf("argv[%d]: %s\n", i, argv[i]);
    }
    return 0;
} 
```

任何 C 或 C++ 教程都可能有更多关于此的信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-25T05:51:51.247

您可以使用 boost::program_options 来执行此操作，如果您不想使用 boost 库，则必须自己解析主函数参数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-25T07:25:46.533

`getopt`是一个 posix 函数（存在 windows 的实现），可以帮助您解析参数：

```
#include <unistd.h> // getopt

// call with my_tool [-n] [-t <value>]
int main(int argc, char *argv[])
{
    int opt;
    int nsecs;
    bool n_given = false, t_given = false;
    // a colon says the preceding option takes an argument
    while ((opt = ::getopt(argc, argv, "nt:")) != -1) {
        switch (opt) {
        case 'n':
            n_given = true;
            break;
        case 't':
            nsecs = boost::lexical_cast<int>(optarg);
            t_given = true;
            break;
        default: /* '?' */
            std::cerr << "Usage: "
                      << argv[0] << " [-t <value>] [-n]\n";
            return 1;
        }
    }
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T05:51:44.290

你最好为此使用一个库。这里有一些链接可以帮助您开始使用 c++ 进行命令行参数。

1.  [gperf](http://www.ibm.com/developerworks/linux/library/l-gperf.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T05:51:23.540

您的入口点方法，即在 C++ 中，您的主要方法需要看起来像

```
int main ( int argc, char *argv[] ); 
```

你可以阅读这篇[文章](http://www.cprogramming.com/tutorial/lesson14.html)并完成你想要做的事情

# iphone - 查找当前是否正在播放音频

> ID：392542
> 
> 赞同：1
> 
> 时间：2008-12-25T05:41:55.667
> 
> 标签：iphone, audio-streaming

我需要确定我的程序当前是否正在播放任何音频，如果是，我想停止以前的音频并开始新的播放。属性 kAudioSessionProperty_OtherAudioIsPlaying 总是返回 0（可能只检查 iPod 音乐是否正在播放） 还有另一个属性 kAudioQueueProperty_IsRunning 但无论音频是否正在运行，它总是返回 0。有人可以告诉我如何确定我的应用程序中是否正在播放音频。

谢谢。

注意：当我移回视图层次结构时，我调用流媒体的类会被释放。所以我没有任何方法可以访问 AudioFileStreamID 来了解音频是否正在播放。我需要使用 SDK 提供的属性之一。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-26T06:59:47.350

找到了解决方法。我没有在视图控制器中创建流媒体对象，而是在 appDelegate 中使用了一个引用。这样，我将始终拥有流媒体类的实时引用，我可以在任何视图控制器中访问它以了解当前是否正在播放音频。

# c# - c#中的极点显示问题

> ID：392550
> 
> 赞同：0
> 
> 时间：2008-12-25T05:51:27.253
> 
> 标签：c#, serial-port, point-of-sale

我在我的 POS c# 应用程序中使用了极显示（E POS）。我有两个主要问题，1\. 我不能完美地清除显示。2\. 无法设置光标位置。

```
 I used some dirty tricks to do these.But I am not satisfied with that code.The following code i used. 
```

代码 ：-

```
class PoleDisplay : SerialPort
{
    private SerialPort srPort = null;

    public PoleDisplay()
    {
        try
        {
            srPort = new SerialPort("COM1", 9600, Parity.None, 8, StopBits.One);
            if (!srPort.IsOpen) srPort.Open();
        }
        catch { }
    }

    ~PoleDisplay()
    {
        srPort.Close();
    }

    //To clear Display.....
    public void ClearDisplay()
    {
        srPort.Write("                    ");
        srPort.WriteLine("                    ");

    }

    //Display Function 
    //'line' 1 for First line and 0 For second line
    public void Display(string textToDisplay, int line)
    {
        if (line == 0)
            srPort.Write(textToDisplay);
        else
            srPort.WriteLine(textToDisplay);
    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T06:00:48.593

您的问题是您正在调用 Write 来清除第 1 行，并调用 WriteLine 来清除第 2 行。

这没有任何意义。方法之间的唯一区别是 WriteLine 在末尾添加了一个换行符。你真正要做的就是输出这个字符串：

```
 "                                  "\r\n 
```

在不知道您使用的杆显品牌的情况下，我无法告诉您正确的操作方法，但是您尝试做的方法永远不会奏效。大多数终端接受特殊字符代码来移动光标或清除显示。您是否找到了您正在使用的终端的参考资料？如果您向它们发送 CHR(12)，大多数显示将清除。

除此之外，您的班级设计存在一个主要问题。永远不要依赖析构函数来释放 C# 中的资源。

在 C# 中，当垃圾收集器收集对象时将调用析构函数，因此无法确定何时收集和关闭资源（在本例中为 Com 端口）。

相反，在您的类上实现接口 IDisposable。

这需要您向您的类添加一个 Dispose 方法。这将与您当前的析构函数具有相同的目的。

通过这样做，您可以利用 C# 中的内置语言功能在对象超出范围时释放您的资源。

```
using (PoleDisplay p = new PoleDisplay())
{
     // Do Stuff with p
}
// When the focus has left the using block, Dispose() will be called on p. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-02-23T05:20:11.673

发送十六进制代码 0C 清除屏幕，适用于大多数显示器

这是一个代码示例：

```
byte[] bytesToSend = new byte[1] { 0x0C }; // send hex code 0C to clear screen
srPort.Write(bytesToSend, 0, 1); 
```

# ofbiz - OFBiz 工作努力日历定制

> ID：392557
> 
> 赞同：1
> 
> 时间：2008-12-25T05:59:28.767
> 
> 标签：ofbiz

我在 Work Effort 应用程序中自定义日历，我必须在添加新事件（事件类型 - EVENT）时限制显示的字段数量。我修改了 WorkEffortForms.xml 中的 EditWorkEffort 表单以忽略我不想显示的字段。我正在使用 use-when 属性来检查上下文键 workeffort、workEffortId 是否为 null 并且 workEffortTypeId 是否为 EVENT。如果上述条件返回 true，那么我将使用忽略标签忽略该字段。否则，字段将按之前的状态显示，即当为新任务（事件类型 - TASK）创建新工作量或创建新工作量（事件类型 - AVAILABLE）时。

现在，如果出现新事件（事件类型 - 事件），上面的逻辑给了我想要的结果。但是，当我添加新任务（事件类型 - 任务）或新工作量（事件类型 - 可用）时，WorkEffort 实体的所有字段都会显示（这是正确的），但布局会失真（这是我的问题）。当我检查最终生成的 html 源代码时，我看到一个 colspan=4 被添加到我使用 use-when 标记的相应字段的 html td 中。

我希望我已经解释了我的问题陈述。我需要纠正布局问题。而且我在为我的定制做正确的事情还是有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T06:44:47.657

如果您不希望字段更好地显示，请使用`<ignore>`标签，那么它们将永远不会显示。如果您仍想使用 'usewhen'，请注意容易混淆的 'position' 参数。

如果您还查看“排序”选项，您可以按特定顺序显示字段。

# firefox - FireFox 脚本标签错误

> ID：392561
> 
> 赞同：4
> 
> 时间：2008-12-25T06:06:56.473
> 
> 标签：firefox, xhtml, xhtml-1.0-strict

在添加一些非常基本的脚本标签时，我在 Firefox（以及 IE）中发现了一个奇怪的“错误”，我将这两行代码添加到了我的 .htm 页面

```
<script type="text/javascript" src="js/jquery.js" />
<script type="text/javascript" src="js/jquery.corner.js" /> 
```

对我以及opera 和chrome 来说，它们看起来像普通的脚本标签，但是对于firefox 和IE，它们不识别它们并且不会运行脚本。然而，一个简单的改变

```
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.corner.js"></script> 
```

修复问题。我不明白为什么这种不同风格的结束标签适用于其他标签，但不适用于脚本标签。例如，我可以关闭一个 img 标签

```
<img src="img.gif" alt=""></img> 
```

或者

```
<img src="img.gif" alt="" /> 
```

# version-control - 我应该为可重用代码库组织提出什么建议？

> ID：392587
> 
> 赞同：4
> 
> 时间：2008-12-25T06:49:44.610
> 
> 标签：version-control, code-reuse

在过去的一两年里，我的组织已经开始慢慢地将自己重新定位为较少以产品为导向的商业模式和更多以合同为导向的商业模式。在过去的一年里，我被转移到新的承包业务中，以帮助扑灭火灾并完成订单。虽然这一年全年都是盈利的（因此，至少从一个衡量标准来看，它是成功的，但我们有几个项目确实在 6 月左右为我们的一年带来了数字。

我在圣诞节假期前和我的经理谈过，他提到了这一点，虽然他不喜欢“事后分析”这个词（我不知道这个词有什么问题，那里的任何商业人士或经理都知道吗？） ，他确实想在 1 月中旬的某个时候召开一次会议，整个合同小组将在会上回顾这一年，并试图弄清楚什么是正确的，什么是错误的，以及我们可以采取哪些措施来提高盈利能力。

出于各种原因（如果需要，我会更详细地介绍），我相信我们的团队乃至整个组织将从中受益的一件事是某种形式的有组织的代码共享。同样的事情由不同的人一次又一次地完成，他们最终以不同的方式完成（和破坏）。我想至少建立一个存储库，人们可以在其中获取执行特定任务的代码，并将该代码包含（或者，实际上是复制/粘贴）他们自己的项目中。

**我应该为至少 10-12 名全职开发人员以及临时借给合同组从事专业工作的 5-50 名（非常）兼职开发人员的团队提供一个可行的公共源存储库，我应该提出什么建议？**

答案需要一些文化信息才能获得合理的答案，因此我将在此处提供它，以及我对该主题的一些想法：

1.  **开发人员不会被迫使用此存储库。进入门槛必须尽可能低以鼓励参与，否则将被忽略。** 可悲的是，这意味着任何需要安装和运行附加软件客户端的东西都可能会失败。ClickOnce 部署几乎是我们所能得到的，这是非常不确定的。
2.  **我们是规避风险的微软商店。** 我也许可以销售开源解决方案，但他们会受到怀疑。所有的开发者都有 VSS，公司总监已经宣布 VSTS 在未来是不可行的。如果设置不是太困难并且许可证是自由的，我仍然可以尝试将 VSTS 服务器忍者进入实验室。
3.  **我的一些开发伙伴关心编写质量、可靠的软件，有些则不关心。** 我想保护那些关心那些不关心的人编写的任何共享代码。合同团队中至少五分之一的同事完全忽略了常见的配置管理实践（例如在处理代码时检查代码）。
4.  **我们更擅长编写流程而不是遵循它们。** 我几乎必须有某种形式的书面流程才能将其出售给我的经理。我相信它必须是轻量级的、灵活的，并且由工具强制执行才能远程相关，因为我的经理是唯一会阅读它的人。
5.  **不要假设最佳实践。** 我非常希望包含强制代码审查之类的内容，以强制在公共代码上使用静态分析工具（FxCop、StyleCop）。然而，这提高了标准，因为目前没有以一致的方式执行此类做法。

我很乐意提供任何其他要求的信息。:)

编辑：（回答问题）

也许承包不是正确的术语。我们绝对拥有自己的代码资产。纸面上的商业模式的一个重要部分（尽管实际上还没有）是我们拥有我们编写的代码/项目，我们可以将它们转售给其他客户。我们的项目通常采用向公司众多现有软件产品之一添加一些特殊功能的形式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-26T06:21:57.067

从它的声音来看，您有机会在“验尸”期间提出一些解决方案。我会创建一个演示文稿，概述您的想法并在这次会议上展示它们。在此之前，我建议您设置一些解决方案并在演示过程中进行演示。有些事情要做——

1.  传播基于组件的编程（一本很好的读物是[Programming .NET Components - Jubal Lowy](https://rads.stackoverflow.com/amzn/click/com/0596102070)）。倡导 DRY（不要重复自己）编码原则。

2.  在存储库中为所有可重用代码库设置一个中央公共位置。这应该具有可重用代码库的参考实现。

3.  通过为常见场景提供项目模板以及已经嵌入的代码库，使人们可以轻松地使用您的代码库。这样，您的同事将拥有一个一致的模板来工作。您可以利用 VS.NET 项目模板功能来实现这一点 - 查看以下链接[VSX 项目系统 (VS.Net 2008)](http://msdn.microsoft.com/hi-in/vsx/cc677252(en-us).aspx)，[关于创建项目模板的代码项目文章](http://www.codeproject.com/KB/dotnet/krevera_template_manager.aspx)

4.  使用 MSBuild（捆绑在 VS2005 及更高版本中）之类的构建自动化工具仅复制特定项目所需的组件。在 IDE 中进行构建设置的这一部分（VS.NET 2005 及更高版本具有使用 MSBuild 设置预编译和后编译任务的好方法）

5.  我知道开源解决方案存在阻力，但我仍然建议设置和使用像[CruiseControl.NET](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)这样的持续自动化系统，以便您可以利用它从中央存储库定期编译和测试您的项目维护可用的代码库。这样，可以快速检查对代码库的任何更改，以确保它不会破坏任何内容，还有助于找出各种项目的版本问题。

如果您可以在机器上进行设置并在事后检验期间将其作为可以改进的步骤的一部分进行展示，那么您应该得到更好的购买，因为您展示的东西已经在工作并且可以轻松扩展。

希望这对您的传福音有所帮助并祝您好运:-)

我最近遇到了一组称为[Chuck Norris 框架](https://github.com/chucknorris)的框架——它们可以在 NuGet 上的[http://nuget.org/packages/chucknorris](http://nuget.org/packages/chucknorris)上找到。您绝对应该查看它们，因为它们为您的 ASP.NET 项目提供了一些不错的模板。也肯定结帐[Nuget](http://nuget.org/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T06:54:58.483

按主题组织，需要单元测试（功能级别）以签入/接受库；添加一个维基来解释什么/为什么和搜索

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T08:10:55.443

一个问题：你说这是一个咨询小组。你有什么代码资产？我认为您团队的大部分编码工作都将归您的客户所有，作为您的雇佣合同的一部分。如果您打算这样做，您需要绝对确定您的合同授予您对员工工作的权利。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T08:21:26.843

Maven 已经解决了 Java 社区中的代码重用问题——你应该去看看。

我有一个 .NET 开发人员为我们内部使用 .NET 程序集设计了类似的东西。因为没有可比的 .NET Internet 社区，所以这个工具只会访问我们公司网络中的内部存储库。否则会像 Maven 那样工作。

Maven 真的可以用来直接管理 .NET 程序集（我们将它与我们的 Flex .swf 和 .swc 代码模块一起使用）只是 .NET 人不得不使用 Java 工具克服，并且可能不得不编写一个 Maven 插件来驱动 msbuild。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T10:40:17.233

还有一点，因为我们在我的商店里也有“共享代码”。

我们发现这在很大程度上是一个***打包问题***：
无论您正在生成什么代码或使用什么工具，您都应该拥有一个*通用*的构建工具，能够将您的源代码**打包**成一个“交付组件”，所有内容都用于实际执行代码，还有文档（压缩）和源代码（压缩）。

拥有这样一个“交付包单元”的主要兴趣是**尽可能*少*地部署文件**，以简化这些单元的下载。

构建过程可以很好地由 Maven 或您想要的任何其他 (ant/nant) 工具管理。

当一些审计团队想要检查我们所有的项目时，我们只是在他们的帖子上部署我们在生产机器上部署的相同包，除了他们将解压缩源文件并完成他们的工作。

由于我们的源文件还包括编译它们所需的任何文件（例如[eclipse 文件](https://stackoverflow.com/questions/300328)），它们甚至可以在其开发环境中重新编译这些项目）。

* * *

那样：

1.  **开发人员不会被迫使用此存储库。进入壁垒必须尽可能低以鼓励参与，否则将被忽略**：它只是一个执行脚本以获取包含他们需要的所有内容的“交付模块”（也可以使用 maven 存储库） )

2.  **我们是风险厌恶者，微软商店**：您可以使用任何您想要的存储库

3.  **我的一些开发伙伴关心编写质量可靠的软件，而另一些则不关心**：这与这些包模块中编写的代码质量无关

4.  **我们更擅长编写流程而不是遵循它们**：其中涉及的唯一流程是打包流程，并且可以相当自动化

5.  **不要假设最佳实践**：您不必在打包可执行文件和源文件之前应用任何类型的静态代码分析。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-25T11:16:45.507

首先对于代码组织，请查看[http://msdn.microsoft.com/en-us/library/ms229042.aspx](http://msdn.microsoft.com/en-us/library/ms229042.aspx)上的 Microsoft 框架设计指南，然后为您要创建的新框架创建一个中央位置源控制。设置一些默认命名空间、程序集以实现更清晰的分离，并确保每个人都获得每日构建。

# .net - 如何将非列特定参数添加到 C# 表适配器？

> ID：392592
> 
> 赞同：0
> 
> 时间：2008-12-25T06:58:19.787
> 
> 标签：.net, dataset, tableadapter

我第一次使用 TableAdapter 并向其添加自定义查询，但在向查询中添加一些搜索参数时遇到了困难，这就是我所拥有的：

```
SELECT  *
FROM    Orders
WHERE   (id_order = @id_order) OR
        (IsFor LIKE '%@word1%') OR
        (IsFor LIKE '%@word2%') OR
        (IsFrom LIKE '%@word1%') OR
        (IsFrom LIKE '%@word2%') 
```

当我测试执行查询时，系统提示我输入 id_order，但不是 word1 或 word2。我还尝试将这些直接作为参数添加到适配器并将它们传入，但它们不起作用。奇怪的是， id_order 继续工作，但其他值不会生成任何匹配项。

我的目标是允许用户输入名字和/或姓氏，并使其与具有该名字和/或姓氏的任何订单相匹配。

关于我做错了什么的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-25T07:09:19.000

您不需要引号或百分号。

```
SELECT  *
FROM    Orders
WHERE   (id_order = @id_order) OR
    (IsFor LIKE @word1) OR
    (IsFor LIKE @word2) OR
    (IsFrom LIKE @word1) OR
    (IsFrom LIKE @word2) 
```

# authentication - 并发用户会话 - 我们为什么不看到更多呢？

> ID：392594
> 
> 赞同：2
> 
> 时间：2008-12-25T07:06:27.523
> 
> 标签：authentication, cookies, login, session, accounts

这是一个咆哮，也是一个问题。

有些网站，例如 Facebook，您一次只想登录一个帐户。

但是从博客网站到电子邮件的所有内容总是会迫使您在登录另一个帐户之前先注销。

而且我了解安全隐患，以及它将如何使基于 cookie 的会话变得更加复杂，但为什么我们看不到更多呢？

为什么同时来自单个客户端的多个用户是个坏主意？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-25T07:12:07.090

我认为这应该由浏览器通过允许多个会话来实现，每个会话都使用自己的 cookie/身份验证/等。

这可能是最好的解决方案，因为它似乎适用于所有站点，并且不需要对它们进行更新，而且，虽然我对此了解不多，但实施起来似乎也不是非常困难.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T07:36:33.767

**简单的问题是**大多数会话都是通过 cookie 实现的，没有 cookie 几乎没有办法做到这一点。

cookie 的工作方式是绑定到域/路径，并且发送与该域相关的所有 cookie。

因此，如果您允许通过 2 个不同的 cookie 登录两次，问题将是每个连续页面都会发送*BOTH* cookie，并且看到这两个 cookie 的服务器不知道您正在充当哪个“用户”。

解决这个问题的**唯一方法**是在所有链接周围传递一个“线程”标识，（即，即时重写每个站点链接`foo.bar?thread=2`或`thread=1`指示要使用哪个会话），这是一场彻头彻尾的噩梦，更不用说安全了影响。

**唯一真正的方法**是通过浏览器沙盒，用户告诉浏览器给定选项卡和所有分支使用一个 cookie 集，而另一个选项卡和所有分支使用另一个。

从本质上讲，这不是网站可以以实际方式解决的问题。

*如果不将控件委托给浏览器来实现，并让用户手动*指示他们何时想要分叉到新会话中，那么实际上没有好的方法来存储这些信息。

### 今天应该可以使用的单一浏览器解决方案：

*   [CookieSwap 0.5.1](https://addons.mozilla.org/en-US/firefox/addon/3255) 似乎允许对各种 cookie 集进行“状态切换”，它并不需要能够神奇地浏览它们，但它是部分解决方案。我无法自己测试它，因为它还没有移植到 FF3.1。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T07:45:52.937

“为什么同时来自一个客户的多个用户是个坏主意？”

这根本不是一个坏主意，但是 HTTP 的使用迫使我们走这条路。

大多数客户端/服务器协议都是有状态的——客户端在握手期间只需要验证一次，然后会话由套接字连接表示。如果您失去连接，您将失去会话并且必须重新进行身份验证。然后编写在一个进程中允许多个会话（作为相同或不同用户）的应用程序是微不足道的。

HTTP 是无状态的。客户端需要以某种方式对每个请求进行重新身份验证。身份验证信息通常存储在 cookie 中，因此一旦完成初始身份验证，用户就不必参与其中。然而，Cookie 是全局的——不仅在进程中是全局的，而且通常跨应用程序的实例/调用。因此，您被困在一个会话中。

您可能会认为 Web 应用程序设计人员会将这种巨大的限制视为 HTTP 不是用于客户端/服务器应用程序开发的正确协议的标志。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T07:36:51.800

多次登录的一个含义是如何管理权限。假设我有两个帐户，一个具有删除用户帐户的权限，而我的另一个帐户没有此权限。

如果我可以同时登录我的两个帐户（优先），我是否具有两个帐户的权限的联合，或者只有两个帐户拥有的权限的交集？

如果我拥有特权联合，我是否能够以赋予我太多权力的方式组合来自这些多个帐户的特权？这对 Sarbanes-Oxley 合规性意味着什么？

在 SQL 中可以看到与作为特权组的“角色”相关的等效问题。在标准 SQL 中，允许给定帐户采用​​多个角色，*但一次只能采用一个*角色。这可以防止您行使过多的特权。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-11T22:05:14.947

您可以通过创建新配置文件在 Firefox 中执行多个会话 - 运行：firefox.exe -P 在这里您可以设置具有不同 cookie 的多个配置文件 - 您可以使用 firefox.exe 同时运行多个 firefox 会话-P "profileName" -no-remote 。no remote 将只允许每个会话 1 个窗口，但也将同时允许多个会话。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-25T07:35:17.247

Cookie 状态锚定到主机标头...

使用不同的主机名或直接使用其 IP 地址连接到站点。根据站点的不同，您可以为站点设置一堆本地主机别名，从而允许您多次登录，因为每个别名都有自己的 cookie 状态。

如果站点重定向到自身以强制使用特定的主机标头，则别名将不起作用，您将需要使用多个浏览器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-12T19:20:16.717

自从你第一次写这个问题以来，IE 8 已经正式发布，它有一个内置的功能可以满足你的需求。从“文件”菜单中，单击“新会话”。这将打开一个新窗口，该窗口不会与原始窗口共享会话 cookie，从而允许您以不同的登录名同时登录到同一站点。

[http://blogs.msdn.com/ie/archive/2009/05/06/session-cookies-sessionstorage-and-ie8.aspx](http://blogs.msdn.com/ie/archive/2009/05/06/session-cookies-sessionstorage-and-ie8.aspx)

# sql - SELECT FOR UPDATE 锁定查询

> ID：392609
> 
> 赞同：1
> 
> 时间：2008-12-25T07:53:23.687
> 
> 标签：sql, mysql, transactions

我正在使用 MySql 5.x，在我的环境中，我有一个名为 CALLS 的表。

表 CALLS 有一个列状态，它采用枚举 {inprogress, completed}。

我希望表的读取/更新是行锁定的，所以：

```
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SET AUTOCOMMIT = 0;
SELECT amount from CALLS where callId=1213 FOR UPDATE;
COMMIT 
```

基本上，即使在我只需要读取金额并返回的情况下，我也会执行 FOR UPDATE。我发现这使我能够确保防止读取/更新相互干扰。但是我被告知这会降低应用程序的并发性。

有没有办法在不产生锁定开销的情况下实现相同的事务一致性？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T20:56:06.143

免责声明：MySQL 通常充满惊喜，因此以下内容可能不真实。

你在做什么对我来说没有任何意义：你是在 SELECT 之后提交的，这应该会打破锁定。所以在我看来，你的代码不应该真的产生任何显着的开销。但它也没有给你任何一致性改进。

一般来说，SELECT FOR UPDATE 可以是一种非常合理且合理的方式来确保一致性，而不会占用比实际需要更多的锁。但当然，它只应在需要时使用。也许您应该有不同的代码路径：一个（使用 FOR UPDATE）在随后的更改操作中使用检索到的值时使用。另一个（不使用 FOR UPDATE）在不需要保护值免受更改时使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-25T08:49:18.080

你在那里实现的——如果你不熟悉它——被称为[悲观锁定](http://www.agiledata.org/essays/concurrencyControl.html#PessimisticLocking)。你为了一致性而牺牲了性能，这有时是一个有效的选择。根据我的专业经验，我发现悲观锁定与其说是帮助，不如说是一种障碍。

一方面，它可能导致[死锁](http://en.wikipedia.org/wiki/Deadlock)。

（更好的恕我直言）替代方案是[乐观锁定](http://www.agiledata.org/essays/concurrencyControl.html#OptimisticLocking)，您可以假设冲突很少发生，并且您只需在它们发生时处理它们。您正在处理事务，因此冲突不应使您的数据处于不一致的状态。

这里有更多关于 Java 意义上的[乐观锁定](http://www.javaworld.com/jw-07-2001/jw-0713-optimism.html)的信息，但这些想法适用于任何事情。

# development-environment - 在虚拟机内部设置开发环境

> ID：392616
> 
> 赞同：7
> 
> 时间：2008-12-25T08:08:52.093
> 
> 标签：development-environment, virtualization

这是问题所在。我使用大约三台不同的机器进行开发。我的伙伴正在使用两个。我们必须在所有五台机器上完成相同的设置程序才能开始工作。

在这里使用一个 php 项目，所以：安装和配置、PDT、一个 php 调试器和某些版本的 XAMPP。然后可能安装一个 svn 客户端和任何其他工具。

再次，对五台机器中的每台机器。

相反，如果我们在一个与生产服务器具有相同堆栈、相同版本的虚拟机中执行所有这些操作，那会怎样。然后我们每个人都可以获取 VM 映像的副本，在五台机器的每一台上运行该映像，并在该 VM 中完成我们所有的开发。将 Eclipse、apache、mysql、作品全部放在那个 vm 中。

这种方法唯一的缺点是性能，请纠正我的唯一部分。不过真的有那么大的问题吗？五台机器中最慢的机器是三星 NC10，采用英特尔凌动 1.6 GHz 处理器。

您认为这可行且实用吗？还是我疯了？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-25T08:18:08.970

我使用虚拟机进行开发（在我的笔记本电脑上运行）并且从未遇到过性能问题。您可以采取的另一种方法是将驱动器映像到您想要的状态。需要时使用 Acronis 或 Ghost 重新映像每台计算机。只需大约 5-10 分钟即可在任何现代 PC 上恢复映像。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T08:33:09.330

我将虚拟机用于我所有的“工作”，因为它远离我的“游戏”。这种设置允许我使用办公室 VPN，而无需将我的整台机器暴露在办公室环境中（我信任它与互联网一样多。;-) 而且我不必担心通过尝试游戏来搞乱我的开发环境或其他软件。我的工作虚拟机目前在 VirtualBox 中运行，但我过去使用过 VMWare。我只注意到使用 Webex 或终端服务器客户端等图形密集型程序时的性能问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T08:20:35.270

当然可以。让我失望的是 VM 映像的大小，通常是几 GB。将它放在网络共享上意味着传输时间可能比您当前的设置过程需要更长的时间。我想外部硬盘驱动器将是移动它的最简单方法。

性能不会成为任何 Web 开发的问题。

我不得不问为什么每次您坐下来工作时都需要“重新成像”您当前的机器？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-05T04:26:29.590

如果您使用的是 Windows，您可能希望在主映像上使用[SYSPREP](http://support.microsoft.com/kb/302577)，以便在您首次启动虚拟机时运行“迷你设置”。

否则，从 Windows 的角度来看，这些机器具有完全相同的 SID、主机名和其他东西——在同一网络上运行具有相同 SID 的多台机器可能会引起很多麻烦。如果您希望他们相互交流，那就更是如此。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-05T04:36:00.883

我已经在 vmware 虚拟机上运行 websphere for zSeries，没有任何问题，并且 websphere 比任何 PHP 堆栈都更占用资源。我发现拥有多核机器或至少超线程可以让它运行得更快。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-05T04:46:03.670

使用 vmware，磁盘操作速度较慢。对于 PHP 开发，我怀疑这将是一个问题，但如果您正在编译一个大型 C++ 项目，您肯定会注意到它。还有 Sun 的 VirtualBox，它是免费的，最新版本相当不错（但我还没有看到磁盘操作有多慢）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-03T18:16:53.390

我在实践中使用了这个想法。虚拟机通常非常适合开发。

1.  在多个操作系统和多个单独的开发环境上运行。
2.  保留较旧的开发环境以供以后支持。
3.  可以轻松备份，当硬盘崩溃时无需从头开始。
4.  可以从开发者复制到另一个，所以每个人都不必做繁琐的安装和配置。

缺点是：

1.  虚拟机速度较慢，您需要比其他方式更强大的计算机。我建议至少有 4 G 的内存，但最好是 16 个，快速多核处理器和快速硬盘驱动器。
2.  复制 Windows 操作系统虚拟机，每个使用的虚拟机副本都应该有自己的产品密钥。制作副本时，需要使用新的产品密钥进行注册。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-02-13T11:35:42.343

您是否考虑过像[ansible](http://www.ansible.com/home)、chef 或 puppet 这样的软件配置管理器？有了这样的软件，这些任务的自动化是非常容易的！它甚至可以创建新的虚拟机，然后对其进行配置。

# c# - 开发游戏服务器的好语言？

> ID：392624
> 
> 赞同：15
> 
> 时间：2008-12-25T08:25:54.960
> 
> 标签：c#, java, python, networking

我只是想知道哪种语言是开发游戏服务器以支持大量（数千）用户的好选择？我涉足 python，但意识到这太麻烦了，因为它不会跨内核生成线程（意味着 8 核服务器 = 1 核服务器）。我也不太喜欢这种语言（那种“自我”的东西让我很生气）。

我知道 C++ 在性能方面是适合这项工作的语言，但我讨厌它。我不想处理它草率的语法，我喜欢我的手被托管语言握住。这让我接触到了 C# 和 Java，但我对其他语言持开放态度。我喜欢 .NET 的简单性，但我想知道，从速度方面来说，这是否适合这项工作。请记住，由于这将部署在 Linux 服务器上，它将在 Mono 框架上运行 - 不确定这是否重要。我知道 Java 在语法方面与 .Net 非常相似，但我对它的经验有限。是否有任何框架可以用于它或可以简化开发？

请帮助我和我挑剔的自己找到解决方案。

更新：我不是故意听起来那么挑剔，我真的不认为我是。我真正排除的唯一语言是 C++，由于可扩展性问题，我不喜欢 Python。我知道进程之间有多种通信方式，但是如果我有一个 8 核服务器，为什么我需要制作 8 个进程？有没有更优雅的解决方案？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-25T08:30:16.870

我不想这么说，而且我知道我在这里冒着降低模式的风险，但听起来好像没有适合你的语言。所有编程语言都有其怪癖，程序员只需要适应它们。完全可以在没有类的情况下用 Python 编写一个工作服务器（消除“self”变量类引用），同样用干净的语法编写 C++ 也同样容易。

如果您正在寻找跨平台部署并且也想开发跨平台，那么您最好的选择可能是 Java。它比 C 和 C++ 等编译语言更短的开发周期，但比 Python 和 Perl 等解释语言具有更高的性能（有争议，但我一直反对 Java =P），而且您不必使用非官方实现，例如有时可能不支持所有语言功能的 Mono。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-25T15:57:19.887

我可能会在这里稍微偏离主题，但这个主题让我感兴趣，因为我（爱好）在很多游戏服务器（MMORPG 服务器）上工作过——在其他人的代码上以及我的代码上。那里有您感兴趣的文献，如果您需要一些参考资料，请给我留言。

您的问题让我印象深刻的一件事是希望从多线程应用程序中为一千名用户提供服务。根据我卑微的经验，这不太好。:-)

当您为成千上万的用户提供服务时，您需要一个尽可能模块化的设计，因为您的主要目标之一是保持服务作为一个整体正常运行。游戏服务器往往相当复杂，因此会有不少令人震惊的错误。不要因为单点故障（一个应用程序！）而让您的生活变得悲惨。

相反，尝试构建可以在多个主机上运行的多个进程。我的谦虚建议如下：

*   使它们独立，因此失败的进程将与服务无关。
*   使它们变小，以便服务的不同部分及其交互方式易于掌握。
*   不要让用户直接与 gamelogic OR DB 通信。编写代理 - 当您拥有大量用户时，网络堆栈可以并且将会在不同架构上显示奇怪的行为。还要确保您以后可以“清理”/过滤代理转发的内容。
*   拥有一个只监视其他进程以查看它们是否仍在正常工作的进程，并具有重新启动部件的能力。
*   使它们可分发。从一开始就通过 TCP 协调进程，否则您将遇到可伸缩性问题。
*   如果您有大型景观，请考虑通过按地理位置划分服务器来动态划分负载的方法。不要让每个后端进程都将所有数据保存在内存中。

我已经为在 Linux、FreeBSD 和 Solaris 上运行的主机移植了一些用 C++ 和 C# 编写的此类引擎（在旧的 UltraSparc IIi 上 - 是的，单声道仍然在那里运行 :)。根据我的经验，考虑到它在该 sparc 机器上运行的古老硬件，C# 足够快。

该行业（据我所知）倾向于使用大量 C++ 来进行服务工作，并为实际游戏逻辑嵌入脚本语言。啊，已经写太多了——很酷的话题。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-12-25T13:50:59.143

Erlang 是一种围绕并发和分布在多个服务器上而设计的语言，非常适合服务器软件。关于 Erlang 和游戏服务器的一些链接：

[http://www.devmaster.net/articles/mmo-scalable-server/](http://www.devmaster.net/articles/mmo-scalable-server/)

[http://www.erlang-consulting.com/euc2005/mmog/mmog_in_erlang.htm](http://www.erlang-consulting.com/euc2005/mmog/mmog_in_erlang.htm)

我正在考虑自己用 Erlang 编写一个游戏服务器。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-25T09:23:36.250

说到纯粹的性能，如果你可以运行 Java 6，那么与优化的 C++ 相比，你可以获得大约 1:1 的性能（尽管有特殊情况，有时 Java 更快，有时 C++），你唯一会遇到的问题当然是数据库库之类的东西、互连性、可扩展性等。我相信对于这些问题中的每一个问题都有各种从好到好的解决方案，但是您不会找到一种语言可以为您解决所有问题，因此我必须给您一个古老的建议：选择您喜欢的语言并使用该语言.

哦，你还在读这个吗？:) 好吧，这里有一些额外的指示。

*   [EVE Online](http://www.eve-online.com/)将 Python 用于其客户端和服务器端代码，而且它充满了 bug 和滞后，因为我认为我不应该在这里写，所以这将是 Python 可以如何扩展到（差）服务大量的一个例子的用户。
*   虽然 Java 对各种相关问题有一些很好的解决方案，但对于大量用户来说，它确实不是最好的语言；如果没有调整，它不能很好地扩展到极端。然而，有一些多虚拟机解决方案可以在一定程度上解决这个问题，例如据说[Terracotta](http://www.terracotta.org/)可以很好地完成这项工作。
*   虽然 C++ 相当繁琐，但它允许与系统进行如此低级的交互，以至于您实际上可能会发现自己在做一些您认为自己做不到的事情。我正在考虑诸如运行时代码块的动态每核微集群之类的东西，以尽可能高效地“填充”处理器的每个可能的时钟周期，以获得最大的性能等等。
*   Mono 在 Windows 平台上远远落后于 .NET VM/等价物，因此您将无法使用 C# 的最新和最精美的功能。然而，Windows XP (x64) OEM 许可证目前非常便宜，只需少量投资，您就可以获得一堆许可证，然后您就可以在原本应成为的平台上运行您的代码。不要陷入对 Linux 的炒作，只有当你真的知道如何使用它时，Linux 才是你的救星，尤其是现在 XP 非常快且稳定。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-25T08:55:56.930

你需要什么样的性能？

twisted 非常适合需要大量并发的服务器，erlang 也是如此。无论是轻松支持大规模并发，并具有分布式计算的设施。

如果您想在 Python 应用程序中跨越多个核心，请执行与想要跨越多台机器相同的操作——运行多个进程。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-25T14:13:45.180

有关此游戏服务器的更多详细信息可能会帮助人们更好地回答您的问题。这是一个游戏服务器，就像反恐精英专用服务器一样，它位于后台并托管多人交互，还是您正在编写将托管在 HTTP 网络服务器上的东西？

就个人而言，如果是我，我会考虑 Java 或 C++。我的个人偏好和技能组合可能会引导我转向 C++，因为我发现 Java 在两个平台上都难以使用（更何况在 Linux 上），并且不相信 C# 已经准备好在 Linux 中的黄金时间。

也就是说，您还需要有一个相当重要的社区在您的语言性能变得如此成问题之前对所述服务器进行锤击。我的建议是用你目前可以使用的任何语言编写它，如果你的游戏变得足够大，那么在那个时候投资重写。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-25T11:44:26.557

您也可以使用 Java 并使用 GCC 将代码编译为本机可执行文件。

这样你就不会受到字节码引擎的性能影响（是的，我知道——开箱即用的 Java 和 C++ 一样快。一定只有我总是测量 5 倍的性能差异）。缺点是 GCC Java 前端不支持所有 Java 1.6 语言特性。

另一种选择是使用您选择的语言，首先让代码工作，然后将性能关键的东西转移到本机代码中。几乎所有语言都支持绑定到已编译的库。

这并不能解决您的“python 不能很好地多线程”问题，但它为您提供了更多选择。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-25T14:34:43.797

显而易见的候选者是 Java 和 Erlang：

专业Java：

*   易于开发
*   良好的开发环境
*   稳定性，良好的堆栈跟踪
*   知名（很容易找到有经验的程序员，很多图书馆，书籍，...）
*   相当快速、成熟的虚拟机

专业二郎：

*   在需要 >99.9% 正常运行时间的系统中得到验证
*   无需停机即可进行软件更新的能力
*   可扩展（不仅多核，而且多机）

反二郎：

*   不熟悉的语法和编程范式
*   不太为人所知；很难找到有经验的程序员
*   VM 几乎没有 java 快

如果您的游戏服务器主要用作事件分发器（带有一些数据库），那么 Erlang 的消息驱动范式应该是一个很好的匹配。

在这个时代，我不会考虑使用非托管语言（如 C 或 C++）；边际性能收益根本不值得麻烦。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-25T08:50:13.663

这可能很大程度上取决于您的“游戏逻辑”（您可能知道这个术语为“业务逻辑”）最好用什么语言表达。例如，如果游戏逻辑最好用 Python（或任何其他特定语言）表达，它最好只用 Python 编写它，并通过多线程或集群来处理性能问题。尽管从 Python 中获得所需的性能可能会花费您很多时间，但您表达“玩家 A 现在在 7 个单位的半径范围内施放 70 级黑暗法术”所花费的时间会更少所有与玩家 B 和 .... 交谈过的单位在 C++ 中。

其他需要考虑的是您将使用什么协议与客户端通信。如果你有一个复杂的二进制协议，C++ 可能更容易（尤其是如果你之前已经有这样做的经验），而 JSON（或类似的）可能更容易在 Python 中解析。是的，我知道 C++ 和 python 不是你被限制（甚至考虑）的语言，但我在这里一般指的是它们。

可能归结为您最擅长的语言。一个你讨厌写的写得不好的程序会比用你知道和喜欢的语言写的更糟糕，即使写得不好的程序是用一种更强大的语言编写的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-25T11:07:24.137

您还可以查看[jRuby](http://jruby.codehaus.org/)。它在一个简洁的包中提供了 Java 的许多优点和 Ruby 的许多优点。您将可以访问两种语言的大型库。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-25T15:16:55.397

你的目标是什么？不是游戏本身的创造，而是你为什么创造它？

如果您这样做是为了学习一门新语言，那么请选择您认为最有趣的一种（即您最想学习的一种）。

如果是出于任何其他原因，那么最好的语言将是您已经最了解并最喜欢使用的语言。这将使您能够专注于制定游戏逻辑并启动并运行某些东西，以便您可以看到进度并保持继续前进的动力，而不是陷入您正在使用的语言的细节并失去兴趣。

如果你最喜欢的语言在某些方面被证明是不合适的（太慢、不够表达等等），那么当出现问题时，你可以用更合适的语言重写问题部分——而且你不会知道解决特定问题的最佳语言问题，直到你知道问题最终是什么。即使您选择的语言被证明完全不适合最终生产使用并且必须重写整个内容，它也会为您提供经过测试的游戏逻辑的工作原型，这将使​​处理新语言变得更加容易。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-25T15:54:34.963

你可以看看[Stackless Python](http://www.stackless.com/)。它是一种替代 Python 解释器，可为并发提供更大的支持。EVE Online 的服务器和客户端软件都使用 Stackless Python。

免责声明：我自己并没有广泛使用 Stackless Python，因此我无法提供任何关于其有效性的第一手资料。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-29T03:56:17.077

有一个非常酷的开发框架可以满足您的所有需求：

太阳的[暗星计划。](http://www.projectdarkstar.com "Project Darkstar")所以我想说Java似乎是游戏服务器开发的好语言:-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-25T08:17:18.257

我知道 facebook 使用 Erlang 和 C++ 的组合作为他们的聊天引擎。

无论您决定什么，如果您选择多种语言组合，请查看 facebook 的跨语言服务部署节俭框架。他们大约一年前开源了它：

[http://incubator.apache.org/thrift/](http://incubator.apache.org/thrift/)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-12-26T16:40:00.453

与 C 相比，C++ 和 Java 相当慢。该语言应该是一种工具，而不是拐杖。

# c# - 使用 DataSet.WriteXml(Stream) 丢失 XML 文件声明

> ID：392626
> 
> 赞同：0
> 
> 时间：2008-12-25T08:28:58.090
> 
> 标签：c#, dataset

我有一个包含一些数据的数据集。当我尝试将此 DataSet 写入文件时，一切正常。但是当我尝试将它写入 MemoryStream 时，XML 文件声明丢失了。代码如下所示：

```
DataSet dSet = new DataSet();
//load schema, fill data in
dSet.WriteXML("testFile.xml");
MemoryStream stream = new MemoryStream();
dSet.WriteXML(stream);
stream.Seek(0,SeekOrigin.Begin); 
```

当我打开文件 testFile.xml 时，我得到：

```
<?xml version="1.0" standalone="yes"?>
//balabala 
```

但是当我用 StreamReader 打开流时，我只得到：

```
//balabala 
```

有人说我可以手动在我的流中插入 XML 文件声明。它有效，但看起来很丑。你知道为什么它放弃了第一行以及更简单的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T03:54:16.830

它没有被丢弃。根本不包括在内。尽管强烈建议 xml 声明不是 xml 规范的必需元素。

[http://msdn.microsoft.com/en-us/library/ms256048(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms256048(VS.85).aspx)

您可以使用 XmlWriter.WriteStartDocument 在流中包含 xml 声明，如下所示：

```
MemoryStream stream = new MemoryStream();
var writer = XmlWriter.Create(stream);
writer.WriteStartDocument(true);
dSet.WriteXML(stream); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-15T14:34:32.583

我用 DataTable 尝试了您的解决方案，但无法正常工作。

```
using (MemoryStream stream = new MemoryStream()) {
    using (XmlTextWriter writer = new XmlTextWriter(stream, Encoding.UTF8)) {
        writer.WriteStartDocument(); //<?xml version="1.0" encoding="utf-8"?>
        writer.WriteRaw("\r\n"); //endline
        writer.Flush(); //Write immediately the stream
        dTable.WriteXml(stream);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-14T16:46:54.400

如果您反汇编 2.0 代码，您将看到`WriteXml`采用文件名的方法显式地写出声明 ( `XmlWriter.WriteStartDocument`)，但`WriteXml`采用流或写入器的方法却没有。

# php - 如何防止 PHP 的 file_get_contents( )

> ID：392630
> 
> 赞同：3
> 
> 时间：2008-12-25T08:32:48.490
> 
> 标签：php, http

我的 php 页面之一返回如下数据：

```
<?php
  //...
  echo "json string";
?> 
```

但其他人使用 file_get_contents() 来获取我的数据并在其他网站中使用。

谁能告诉我我能做些什么来防止这种事情发生。

我考虑是否可以获得请求的域名来回显其他内容。但我不知道

获取请求域名的功能。如果请求是由服务器发送的，那

将无济于事。我的英语很差，表达疑惑，请多多包涵。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-25T19:31:52.107

你也可以使用会话。如果在您的应用程序的某个地方，在用户获取 json 数据之前，您启动了一个会话，那么在您输出 json 数据的这个页面中，您可以检查会话变量。这样只有通过会话生成器页面的用户才能查看您的输出。假设您有生成会话的页面 A.php。在此页面中输出任何内容之前使用此代码。

```
session_start();
$_SESSION['approvedForJson'] = true; 
```

然后在您输出 json 数据的页面中，在输出任何内容之前，再次调用 session_start()。PHP 代码的开头是调用它的好地方。然后在输出 json 数据之前，检查已批准用户的会话变量是否存在。

```
if ( isset($_SESSION['approvedForJson']) && $_SESSION['approvedForJson'] ) {
    echo "json data";
} else {
  // bad request
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T08:41:57.830

You can use $_SERVER['REMOTE_ADDR'] to get the address of the client address. You can also check $_SERVER['HTTP_REFERER'] and block external requests that way, but it's less reliable. There's probably a few other techniques involving [$_SERVER](http://us3.php.net/reserved.variables.server) that you can try.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T09:20:43.290

Your fighting an uphill battle here. I am assuming your serverside process that responds in json is being consumed via javascript in your users browsers... so there is no easy way to encrypt it. You might try some of the techniques used to prevent xspf (see [http://en.wikipedia.org/wiki/Cross-site_request_forgery](http://en.wikipedia.org/wiki/Cross-site_request_forgery) ). If you developed the client to pass along some session token that is uniq per client you could reduce some of the problem. But, chances are whoever is stealing your data is gonna figure out whatever mechanism you put in place ... assuming this is some sort of ajax type thing. If its a server-server thing then as sli mentions, setting up some restrictions based on the remote ip would help, plus setting up some sort of API authentication tokens would help even more (see oauth for some pointers)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T09:37:03.727

You could also using .htaccess with apache block every external request to the page if it get's called internally or block every request that is not from your domain:

[Google search thingie](http://www.google.com/search?ie=UTF-8&oe=UTF-8&sourceid=navclient&gfns=1&q=.htacces+block+file+acces)

**EDIT**
You could also use some php file which includes the file which can not be read. So for example you have file.php:

```
<?php
 $allowedFiles[] = 'somefile.php';
 $allowedFiles[] = 'someotherFile.php';
 $allowedFiles[] = 'jsonReturnFile.php';
 if(in_array($_GET['file'], $allowedFiles)){
  include( "include/".$_GET['file'] );
 }
?> 
```

Then you can allow file_ get _contents() on that file and write a rewriteRule in your .htacces to disallow any request to the include/ folder.

```
RewriteRule include* - [F,NC] 
```

That will return a 403 forbidden error for a request to that directory or any file in the directory.

Then you can do you JSON request to something like: file.php?file=jsonReturnFile.php&someothherParamReadByJsonFile=1

And when someone tries to get the file contents for the JSON file they will get the forbidden error, and getting the file contents for the include.php won't return anything usefull.

# image-formats - 网站图像格式：为正确的任务选择正确的格式

> ID：392635
> 
> 赞同：48
> 
> 时间：2008-12-25T08:36:22.647
> 
> 标签：image-formats

**在设计网站时，您认为用于特定任务的最佳图像格式是什么？**

当我试图找出用于特定任务的格式时，我总是陷入两难境地……例如，*我应该全面使用 .jpg 吗？* 或者，*何时以及为什么应该使用 .png？*

例如，以*[亚马逊](http://www.amazon.com)*的网站为例，他们使用**.jpg**作为产品图片（[示例](http://ecx.images-amazon.com/images/I/51JBu91TjRL._SL500_AA240_.jpg)）**，.gif**作为透明像素（[示例](http://g-ecx.images-amazon.com/images/G/01/x-locale/common/transparent-pixel._V42752373_.gif)）**，.png**作为他们的 CSS Sprites（[示例](http://g-ecx.images-amazon.com/images/G/01/gno/images/holiday08/navPackedSprites_v3._V238584356_.png)）

另一方面，[Play.com](http://www.play.com/)使用**.gif**作为其网站徽标（[示例](http://images.play.com/SiteCSS/Play/Live2/img/brand/logo.gif)），但使用**.jpg**作为其网站产品（如亚马逊）（[示例](http://images.play.com/bc/920246m.jpg)），就其主页而言，他们没有任何**.png**就可以了。

*那么我应该为我的网站使用哪些格式？我为什么要使用它们？*

**[更新]**

感谢[CruellO](https://stackoverflow.com/questions/392635/website-image-formats-choosing-the-right-format-for-the-right-task#392641)的[这个链接](http://www.killersites.com/articles_2005/theory/imagesInWebPages.jsp)解释了这些差异，也感谢[Dustin](https://stackoverflow.com/questions/392635/website-image-formats-choosing-the-right-format-for-the-right-task#392646)给出了使用什么的理由。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2013-05-08T12:32:09.913

你应该知道几个关键因素...

首先，有两种类型的压缩：[无损](http://en.wikipedia.org/wiki/Lossless_data_compression)和[有损](http://en.wikipedia.org/wiki/Lossy_compression)。

**无损**意味着图像变得更小，但不损害质量。**有损**意味着图像变得（甚至）更小，但会损害质量。如果您一遍又一遍地以有损格式保存图像，图像质量会越来越差。

还有不同的颜色深度（调色板）：[索引颜色](http://en.wikipedia.org/wiki/Indexed_color)和[直接颜色](http://en.wikipedia.org/wiki/Color_depth#16-bit_direct_color)。

使用**索引**意味着图像只能存储图像作者选择的有限数量的颜色（通常为 256 种），使用**直接**意味着您可以存储作者未选择的数千种颜色。

* * *

**BMP** - 无损/索引和直接

这是一种旧格式。它是无损的（保存时不会丢失图像数据），但也几乎没有压缩，这意味着保存为 BMP 会导致文件非常大。它可以有索引和直接的调色板，但这是一个小小的安慰。文件大小太大，以至于没有人真正使用过这种格式。

适合：真的没什么。BMP 没有什么擅长的，或者没有其他格式做得更好。

![BMP 与 GIF](https://i.stack.imgur.com/J1EEX.png)

* * *

**GIF** - 无损/仅索引

GIF 使用无损压缩，这意味着您可以一遍又一遍地保存图像而不会丢失任何数据。文件大小比 BMP 小很多，因为实际使用了良好的压缩，但它只能存储索引调色板。这意味着文件中最多只能有 256 种不同的颜色。这听起来是一笔不小的数目，而且确实如此。

GIF 图像也可以是动画的并且具有透明度。

适用于：徽标、线条图和其他需要很小的简单图像。只真正用于网站。

![GIF 与 JPEG](https://i.stack.imgur.com/F7VtM.png)

* * *

**JPEG** - 有损/直接

JPEG 图像旨在通过删除人眼不会注意到的信息来使详细的照片图像尽可能小。因此，它是一种有损格式，并且一遍又一遍地保存同一个文件将导致更多数据随着时间的推移而丢失。它有数千种颜色的调色板，因此非常适合照片，但有损压缩意味着它对徽标和线条图不利：它们不仅看起来模糊，而且与 GIF 相比，此类图像的文件大小也更大！

适合：照片。还有，渐变。

![JPEG 与 GIF](https://i.stack.imgur.com/agaQv.png)

* * *

**PNG-8** - 无损/索引

PNG 是一种较新的格式，PNG-8（PNG 的索引版本）确实是 GIF 的一个很好的替代品。然而，遗憾的是，它有一些缺点：首先它不能像 GIF 那样支持动画（它可以，但似乎只有 Firefox 支持它，不像每个浏览器都支持的 GIF 动画）。其次，它对 IE6 等较旧的浏览器存在一些支持问题。第三，像Photoshop这样的重要软件对格式的实现很差。（该死的，Adobe！）PNG-8 只能存储 256 种颜色，比如 GIF。

优点：PNG-8 比 GIF 做得更好的主要方面是支持 Alpha Transparency。

![PNG-8 与 GIF](https://i.stack.imgur.com/B09oZ.png)

**重要说明：** Photoshop 不支持 PNG-8 文件的 Alpha 透明度。（该死的，Photoshop！）有一些方法可以将 Photoshop PNG-24 转换为 PNG-8 文件，同时保持其透明度。一种方法是[PNGQuant](http://pngquant.org)，另一种方法是使用[Fireworks](http://www.adobe.com/uk/products/fireworks.html)保存文件。

* * *

**PNG-24** - 无损/直接

PNG-24 是一种很好的格式，它结合了无损编码和直接颜色（数千种颜色，就像 JPEG）。在这方面它非常像 BMP，除了 PNG 实际上压缩图像，因此它产生的文件要小得多。不幸的是，PNG-24 文件仍将比 JPEG、GIF 和 PNG-8 大得多，因此您仍然需要考虑是否真的要使用其中一个。

尽管 PNG-24 在进行压缩时允许使用数千种颜色，但它们并非旨在取代 JPEG 图像。保存为 PNG-24 的照片可能至少比等效的 JPEG 图像大 5 倍，而可见质量几乎没有改善。（当然，如果您不关心文件大小并希望获得最佳质量的图像，这可能是一个理想的结果。）

就像 PNG-8 一样，PNG-24 也支持 alpha 透明度。

我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-12-25T08:51:57.280

JPEG 用于照片。我偶尔会看到带有文本的 JPEG，它们看起来很糟糕。文本最适合文本，否则使用 PNG。

如果它不是照片，但您想要它的图形，请使用 PNG。PNG 几乎总是比等效的 gif 文件小，并且不会像 JPEG 文件那样丢失质量。相当于 JPEG 的 PNG 通常会大很多（假设它是逼真的）。有时这仍然是可取的。

PNG 确实允许 8 位透明度，但如果您必须支持 IE，您会发现他们不断拒绝正确支持。据我所知，它们*确实*支持 8 位图像（基本上与 gif 相同）中的一点透明度。还有许多技巧可以让 8 位透明度在 IE 中工作。我从来没有打扰过，我自己。

总之：

*   照片 → jpg
*   !照片 → png

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-04T14:18:26.790

**在以下情况下可以使用**PNG ：****

 ***   您需要透明度（1 位或 alpha 透明度）
*   无损压缩效果很好（例如扁平式图标或徽标）

**JPEG**可用于以下情况：

*   无损压缩效果不好（比如照片）

**GIF**可用于以下情况：

*   动画是必要的，视频是不可能的（尽管你真的应该尝试使用视频；动画 GIF 质量很差而且效率很低）

尽管存在相反的神话，但在同类比较中，PNG 在所有方面都优于 GIF。PNG除了动画之外，可以支持GIF的所有图像模式，并且在使用相同的图像模式时，PNG由于其DEFLATE算法优于LZW，因此具有更好的压缩率。PNG 还具有 GIF 无法做到的其他模式，例如 24 位颜色和多位透明度（alpha 透明度）。请注意，当人们使用 IE6 时，多位透明度曾经是一个问题。

PNG 模式包括（这只是一小部分）

*   2 到 256 色的调色板颜色（如 GIF）
*   调色板颜色 2 到 256 色，带透明色（如 GIF）
*   真彩色（24 位彩色）
*   带 Alpha 通道的真彩色（24 位颜色 + 8 位透明度）

为了在 Web 上使用 PNG 进行最佳压缩，请始终使用调色板模式。如果您发现 PNG 文件比同等的 GIF 文件大，那么您很可能将 PNG 保存为 24 位颜色，并将 GIF 保存为调色板模式（因为保存全彩色 GIF 总是需要转换为调色板模式）。在两种情况下保存之前尝试将图像转换为调色板模式。

PNG 还具有其他模式，例如调色板中带有 alpha 透明度的调色板颜色。诸如此类的模式在浏览器中工作，但由于不支持这些图像模式，像 Photoshop 这样的软件在创建或使用它们时存在（或曾经存在）问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-03-24T09:31:50.320

如果您要存储或呈现大量图像，新的[Google WebP 格式](https://developers.google.com/speed/webp/)可能值得考虑，因为它比 PNG/JPG 小 25%。请注意，目前并非所有浏览器都支持此功能。注意。这是在发布此问题后于 2010 年发布的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-12-11T13:48:13.103

JPEG 文件格式

1.  非常适合需要保持较小尺寸的图像
2.  拍照的好选择
3.  不利于徽标、线条艺术和大面积的纯色

GIF 文件格式

1.  非常适合动画效果
2.  剪贴画、平面图形和使用最少颜色和精确线条的图像的不错选择
3.  带有色块的简单徽标的不错选择

PNG文件格式

1.  无损
2.  必须透明时的绝佳选择
3.  标志和线条艺术的好选择
4.  并非所有地方都支持

您可以查看此信息图表以获取更多详细信息，[图像文件类型：何时使用 JPEG、GIF 和 PNG](http://thecomputerstudents.com/infographics/image-file-types-use-jpeg-gif-png/)

# .net - SQLServer 2005 何时无法插入/更新并且也不会“抛出”异常？

> ID：392637
> 
> 赞同：0
> 
> 时间：2008-12-25T08:38:12.440
> 
> 标签：.net, sql-server-2005

在对 SQLServer 2005 数据库运行插入或更新查询后，在什么情况下（如果有的话）会发生这种情况 - SQLServer 2005 不执行或无法执行插入/更新，并且也不“抛出”异常？

考虑我们正在通过 SqlCommand 对象运行插入或更新查询。还要考虑使用插入或更新查询的表具有

*   身份字段
*   不为空的字段，
*   具有适当数据类型的字段
*   作为参考键的字段
*   应用了检查约束的字段
*   等等

请假设在更新查询中，“WHERE”条件会找到需要更新的记录。

我们是否可以假设在执行 SqlCommand.ExecuteNonQuery() 之后，如果未执行插入或更新，那么总是会发生未处理的异常？否则，我们可以假设插入或更新查询已经成功。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-25T09:10:13.780

查看 ExecuteNonQuery() 的返回值以查看受影响的记录数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-25T10:50:13.343

将您的逻辑移动到数据库存储过程并从那里抛出异常（RAISERROR）。然后你的命令（它会调用相应的存储过程）会有必要的例外。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T13:31:49.353

您可以假设将引发异常 (SqlException)，除非 INSERT/UPDATE 包含不匹配任何行的 WHERE 子句。

# regex - 如何在 Perl 替换运算符的替换端使用变量？

> ID：392643
> 
> 赞同：56
> 
> 时间：2008-12-25T08:47:41.907
> 
> 标签：regex, perl, substitution

我想做以下事情：

```
$find = "start (.*) end";
$replace = "foo \1 bar";

$var = "start middle end";
$var =~ s/$find/$replace/; 
```

我希望 $var 包含“foo middle bar”，但它不起作用。也没有：

```
$replace = 'foo \1 bar'; 
```

不知何故，我错过了一些关于逃跑的东西。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-12-25T10:38:46.673

在替换方面，您必须使用 $1，而不是 \1。

你只能做你想做的事，方法是替换一个给出你想要的结果的可评估表达式，并告诉 s/// 用 /ee 修饰符来评估它，如下所示：

```
$find="start (.*) end";
$replace='"foo $1 bar"';

$var = "start middle end";
$var =~ s/$find/$replace/ee;

print "var: $var\n"; 
```

要了解为什么需要 "" 和双 /e，请在此处查看双 eval 的效果：

```
$ perl
$foo = "middle";
$replace='"foo $foo bar"';
print eval('$replace'), "\n";
print eval(eval('$replace')), "\n";
__END__
"foo $foo bar"
foo middle bar 
```

`eval()`（尽管正如ikegami`eval(eval(...))`所指出的，单个 /e 或双 e 的第一个 /e 并不是真正的做你需要做的事情来让 /ee 按需要工作。）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-25T08:55:30.423

Deparse 告诉我们这是正在执行的内容：

```
$find = 'start (.*) end';
$replace = "foo \cA bar";
$var = 'start middle end';
$var =~ s/$find/$replace/; 
```

然而，

```
 /$find/foo \1 bar/ 
```

被解释为：

```
$var =~ s/$find/foo $1 bar/; 
```

不幸的是，似乎没有简单的方法可以做到这一点。

您可以使用字符串 eval 来完成，但这很危险。

对我有用的最理智的解决方案是：

```
$find = "start (.*) end"; 
$replace = 'foo \1 bar';

$var = "start middle end"; 

sub repl { 
    my $find = shift; 
    my $replace = shift; 
    my $var = shift;

    # Capture first 
    my @items = ( $var =~ $find ); 
    $var =~ s/$find/$replace/; 
    for( reverse 0 .. $#items ){ 
        my $n = $_ + 1; 
        #  Many More Rules can go here, ie: \g matchers  and \{ } 
        $var =~ s/\\$n/${items[$_]}/g ;
        $var =~ s/\$$n/${items[$_]}/g ;
    }
    return $var; 
}

print repl $find, $replace, $var; 
```

### 对 ee 技术的反驳：

正如我在回答中所说，我避免使用评估是有原因的。

```
$find="start (.*) end";
$replace='do{ print "I am a dirty little hacker" while 1; "foo $1 bar" }';

$var = "start middle end";
$var =~ s/$find/$replace/ee;

print "var: $var\n"; 
```

此代码完全按照您的想法执行。

如果您的替换字符串在 Web 应用程序中，那么您只是打开了任意代码执行的大门。

做得好。

此外，出于这个原因，它**不适**用于打开污点。

```
$find="start (.*) end";
$replace='"' . $ARGV[0] . '"';

$var = "start middle end";
$var =~ s/$find/$replace/ee;

print "var: $var\n"

$ perl /tmp/re.pl  'foo $1 bar'
var: foo middle bar
$ perl -T /tmp/re.pl 'foo $1 bar' 
Insecure dependency in eval while running with -T switch at /tmp/re.pl line 10. 
```

然而，更谨慎的技术是理智的、安全的、可靠的，*并且*不会失败。（请放心，它发出的字符串仍然受到污染，因此您不会失去任何安全性。）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-04-15T22:02:37.743

正如其他人所建议的那样，您可以使用以下内容：

```
my $find = 'start (.*) end';
my $replace = 'foo $1 bar';   # 'foo \1 bar' is an error.
my $var = "start middle end";
$var =~ s/$find/$replace/ee; 
```

以上是以下内容的缩写：

```
my $find = 'start (.*) end';
my $replace = 'foo $1 bar';
my $var = "start middle end";
$var =~ s/$find/ eval($replace) /e; 
```

我更喜欢第二个而不是第一个，因为它不会隐藏使用的事实[`eval(EXPR)`](http://perldoc.perl.org/functions/eval.html)。但是，上述两个静音错误，所以以下会更好：

```
my $find = 'start (.*) end';
my $replace = 'foo $1 bar';
my $var = "start middle end";
$var =~ s/$find/ my $r = eval($replace); die $@ if $@; $r /e; 
```

但正如您所见，以上所有内容都允许执行任意 Perl 代码。以下会更安全：

```
use String::Substitution qw( sub_modify );

my $find = 'start (.*) end';
my $replace = 'foo $1 bar';
my $var = "start middle end";
sub_modify($var, $find, $replace); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-07-17T01:05:19.900

```
# perl -de 0
$match="hi(.*)"
$sub='$1'
$res="hi1234"
$res =~ s/$match/$sub/gee
p $res
  1234 
```

不过要小心。这会导致出现两层，在正则表达式的末尾`eval`各有一层：`e`

1.  $sub --> $1
2.  $1 --> 最终值，在示例中为 1234

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-19T16:00:44.113

我会建议类似：

```
$text =~ m{(.*)$find(.*)};
$text = $1 . $replace . $2; 
```

它的可读性很强，而且似乎很安全。如果需要多次更换，很容易：

```
while ($text =~ m{(.*)$find(.*)}){
     $text = $1 . $replace . $2;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-17T00:01:19.610

```
#!/usr/bin/perl

$sub = "\\1";
$str = "hi1234";
$res = $str;
$match = "hi(.*)";
$res =~ s/$match/$1/g;

print $res 
```

这让我得到了'1234'。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-07-17T01:24:38.433

请参阅[上](https://stackoverflow.com/questions/392643/how-to-use-a-variable-in-the-replacement-side-of-the-perl-substitution-operator)`s///`一篇关于在 Perl的替换端使用变量的 SO 帖子。看看[接受的答案](https://stackoverflow.com/questions/392643/how-to-use-a-variable-in-the-replacement-side-of-the-perl-substitution-operator/392717#392717)和[反驳](https://stackoverflow.com/questions/392643/how-to-use-a-variable-in-the-replacement-side-of-the-perl-substitution-operator/392649#392649)的答案。

您尝试使用在右手字符串上`s///ee`执行双精度的形式来实现。`eval`有关更多示例，请参见[perlop quote like operator](http://perldoc.perl.org/perlop.html#Regexp-Quote-Like-Operators)。

请注意，存在安全隐患，`eval`这在污点模式下不起作用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-01-16T04:49:53.457

我没有设法使最受欢迎的答案起作用。

*   当我的替换字符串包含几个连续的反向引用时，ee 方法会抱怨。
*   肯特弗雷德里克的回答只替换了第一场比赛，我需要我的搜索和替换是全局的。我没有想出办法让它替换所有不会导致其他问题的匹配项。例如，我尝试递归地运行该方法，直到它不再导致字符串更改，但如果替换字符串包含搜索字符串，则会导致无限循环，而常规的全局替换不会这样做。

我尝试使用普通的旧 eval 提出自己的解决方案：

```
eval '$var =~ s/' . $find . '/' . $replace . '/gsu;'; 
```

当然，这允许代码注入。但据我所知，逃避正则表达式查询和注入代码的唯一方法是在 $find 中插入两个正斜杠或在 $replace 中插入一个斜杠，后跟一个分号，之后您可以添加添加代码。例如，如果我这样设置变量：

```
my $find = 'foo';
my $replace = 'bar/; print "You\'ve just been hacked!\n"; #'; 
```

评估的代码是这样的：

```
$var =~ s/foo/bar/; print "You've just been hacked!\n"; #/gsu;'; 
```

所以我要做的是确保字符串不包含任何未**转义**的正斜杠。

首先，我将字符串复制到虚拟字符串中。

```
my $findTest = $find;
my $replaceTest = $replace; 
```

然后，我从虚拟字符串中删除所有转义的反斜杠（反斜杠对）。这使我可以找到未转义的正斜杠，而不会陷入考虑如果正斜杠前面有转义反斜杠的情况下已转义的陷阱。例如：`\/`包含转义的正斜杠，但`\\/`包含文字正斜杠，因为反斜杠已转义。

```
$findTest =~ s/\\\\//gmu;
$replaceTest =~ s/\\\\//gmu; 
```

现在，如果任何前面没有反斜杠的正斜杠保留在字符串中，我会抛出一个致命错误，因为这将允许用户插入任意代码。

```
if ($findTest =~ /(?<!\\)\// || $replaceTest =~ /(?<!\\)\//)
{
  print "String must not contain unescaped slashes.\n";
  exit 1;
} 
```

然后我评估。

```
eval '$var =~ s/' . $find . '/' . $replace . '/gsu;'; 
```

I'm not an expert at preventing code injection, but I'm the only one using my script, so I'm content using this solution without fully knowing if it's vulnerable. But as far as I know, it may be, so if anyone knows if there is or isn't any way to inject code into this, please provide your insight in a comment.

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2008-12-25T10:47:26.703

我不确定您要达到的目标是什么。但也许你可以使用这个：

```
$var =~ s/^start/foo/;
$var =~ s/end$/bar/; 
```

即只留下中间并替换开始和结束。

# image - 是否可以将 .png 图像用于 WiX 位图

> ID：392654
> 
> 赞同：9
> 
> 时间：2008-12-25T09:02:54.590
> 
> 标签：image, wix, png, bitmap, wix3

我正在使用 2 500K 位图在我的 WiX 对话框上显示图像。

它们极大地增加了安装包的大小，更糟糕的是 - 看起来无法将它们打包为 .cab 文件的一部分，因为它们`<binary>`在 WiX 术语中是 -es。

那么，我想，有没有办法将其他文件格式用于位图或 WiX 与 BMP 绑定？理想情况下，如果有一种使用 .png 格式的方法会更好，因为它带有一个松散的压缩选项。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-25T09:58:21.750

[位图控件](http://msdn.microsoft.com/en-us/library/aa367830.aspx)的 Windows 安装程序文档指出图像应该是“位图”——可能是 .BMP 文件——或 JPEG。

您必须记住，在使用 WiX 时，它是基于 Windows Installer 的。这意味着 WiX 中的任何限制通常是由底层 Windows Installer 实现中的限制引起的。

.BMP 文件可以进行 RLE 压缩。我不知道他们是否支持任何其他压缩算法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-25T20:06:59.070

WiX 工具集不受 BMP 和 JPG 的限制。正如您发现的那样，您可以将任何其他图像格式放入您的包中。但是，MSI SDK 仅记录 BMP 和 JPG 支持。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-11-16T18:44:59.053

是的，如果您只需要在 Windows 8 或更高版本上安装。从[位图控制](https://msdn.microsoft.com/en-us/library/aa367830.aspx)：

> **Windows 8 和 Windows Server 2012：** 图像文件可以是 Windows 图像处理组件 (WIC) 支持的任何标准格式，包括 TIFF、JPEG、PNG、GIF、BMP 和 HDPhoto。该控件不支持动画。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-07-25T22:30:15.090

正如其他答案中所述，图像格式限制来自微软的 MSI 实现，而不是来自 WiX。虽然`.jpeg`似乎从 Windows 7 开始支持，并且`PNG`从 Windows 8 开始，但请注意您使用的格式。您的权衡是安装程序的外观。

我的经验表明，确保生成的安装程序正确显示图像的唯一可靠方法是使用 uncompressed `BMPs`. 就是这样！是的，我知道他们会膨胀最终文件的大小，但是，嘿，就像微软的其他一切一样，他们落后了很多年，没有办法解决它。

因此，如果您不想让安装程序在 Windows XP 或 Vista 上显示灰色方块而不是图形，请不要使用原始`.bmp`格式以外的任何内容。

# delphi - MD5 Hashing in Delphi 2009

> ID：392657
> 
> 赞同：7
> 
> 时间：2008-12-25T09:07:28.670
> 
> 标签：delphi, unicode, delphi-2009, md5, hash

In borland delphi 7 and even in delphi 2007 everything worked, but in delphi 2009 it just returns the wrong hash!

I use wcrypt2 script ([http://pastebin.com/m2f015cfd](http://pastebin.com/m2f015cfd))

Just have a look:

string : "123456"

hash:

Delphi 7 : "e10adc3949ba59abbe56e057f20f883e" - real hash.
Delphi 2007 : "e10adc3949ba59abbe56e057f20f883e" - real hash too.
And... Delphi 2009 : "5fa285e1bebe0a6623e33afc04a1fbd5" - WTF??

I've tried a lot of md5 scripts, but delphi 2009 does the same with all of them. Any help? Thanks.

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-25T11:11:37.717

Your library is not Unicode aware. Just passing it an AnsiString won't be enough because it probably uses strings internally to store data.

You could try to update that library, wait for the author to update it, or just use the **MessageDigest_5.pas** that ships with Delphi 2009\. It is in the *source\Win32\soap\wsdlimporter* folder, which you will need to either add to your path, or explicitly include it in your project.

Here is some sample code using it in Delphi 2009:

```
uses Types, MessageDigest_5;

procedure TForm16.Edit1Change(Sender: TObject);
var
  MD5: IMD5;
begin
  MD5 := GetMD5;
  MD5.Init;
  MD5.Update(TByteDynArray(RawByteString(Edit1.Text)), Length(Edit1.Text));
  Edit2.Text := LowerCase(MD5.AsString);
end; 
```

And you are in business:

> MD5(123456) = e10adc3949ba59abbe56e057f20f883e

You could wrap it in a simple function call if you wanted to. It is important you cast to a **RawByteString** before casting to a **TByteDynArray** since the **RawByteString** cast drops all the extra Unicode characters. Granted if the edit contains Unicode characters then you could end up with bad data.

Keep in mind that **GetMD5** is returning an interface, so it is reference counted, etc.

*Merry Christmas!*

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T23:23:41.950

在有人可以评论散列算法之前，如果他们至少对基本概念和原理有基本的了解，这会有所帮助。到目前为止，所有关注于无休止类型转换的响应都完全是矫枉过正，但更糟糕的是，如果对 unicode 字符串进行哈希处理，将导致不可靠的结果。

您需要了解的第一件事是散列和加密算法在字节级别上运行。这意味着他们不在乎你在散列或加密什么。您可以散列整数、字符、纯 ASCII、完整的 unicode、字节、长字等。算法不在乎。

使用字符串时，您必须确保的唯一事情是哈希库的内部函数在函数中返回一个 AnsiString，该函数会吐出生成的哈希值。而已。这才是最重要的。

您的项目的实际代码可以（并且应该）基于正常的字符串输入，它映射到 Delphi 2009 中的 unicodestring。您不应该将任何内容强制转换为 ansistring 或 rawbytestring。通过这样做，如果用户尝试散列 ANSI 字符集范围之外的任何内容，您将立即创建一个损坏的散列。在散列的世界中，一个损坏的散列既不可靠又不安全。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-28T09:36:05.730

如果有`wcrypt2.pas`，请使用此功能。

```
function md5ansi(const Input: AnsiString): AnsiString;
var
  hCryptProvider: HCRYPTPROV;
  hHash: HCRYPTHASH;
  bHash: array[0..$7f] of Byte;
  dwHashBytes: Cardinal;
  pbContent: PByte;
  i: Integer;
begin
  dwHashBytes := 16;
  pbContent := Pointer(PAnsiChar(Input));
  Result := '';

  if CryptAcquireContext(@hCryptProvider, nil, nil, PROV_RSA_FULL, CRYPT_VERIFYCONTEXT or CRYPT_MACHINE_KEYSET) then
  begin
    if CryptCreateHash(hCryptProvider, CALG_MD5, 0, 0, @hHash) then
    begin
      if CryptHashData(hHash, pbContent, Length(Input) * sizeof(AnsiChar), 0) then
      begin
        if CryptGetHashParam(hHash, HP_HASHVAL, @bHash[0], @dwHashBytes, 0) then
        begin
          for i := 0 to dwHashBytes - 1 do
          begin
            Result := Result + AnsiString(Format('%.2x', [bHash[i]]));
          end;
        end;
      end;
      CryptDestroyHash(hHash);
    end;
    CryptReleaseContext(hCryptProvider, 0);
  end;

  Result := AnsiString(AnsiLowerCase(String(Result)));
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T09:45:42.943

Have you checked that your library has been correctly updated for D2009 and unicodification? I kinda doubt the same code would do D7/D2007 and D2009 for this sort of things.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-25T10:41:20.633

It is obvious that your lib is not unicode enabled.

Convert your string to AnsiString or RawByteString or UTF8String by declaring temp AnsiString and assign your uniode string to it.

Note that if you are using unicode specific chars that can't be translated to single codepage, you should convert your string to UTF8\.

Then call MD5(PAnsiChar(YourTempString)).

Check that your lib may have PWideChar or UNICODE declarations, to skip this.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-25T09:37:11.963

Are you perchance casting a generic string (which in Delphi 2009 is a UnicodeString) to a PAnsiChar and passing that into the hash function? That will not work. You first must cast the string into an AnsiString and then cast that one to PAnsiChar, a la:

```
PAnsiChar(AnsiString('123456')) 
```

Also, try using RawByteString instead of AnsiString like dmajkic suggested. Avoid UTF8String since that's not an AnsiString and any characters outside the ASCII range (0..127) might get reinterpreted into multibyte characters.

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-03-18T08:59:09.020

在吉姆的回答中：

如果我们改变

MD5.Update(TByteDynArray(RawByteString(Edit1.Text))，长度(Edit1.Text))；

至

MD5.Update(TByteDynArray(RawByteString(Edit1.Text)), 长度(RawByteString(Edit1.Text)));

存在汉字时会更好地支持。

# javascript - jQuery ajax 调用 javascript 函数

> ID：392658
> 
> 赞同：0
> 
> 时间：2008-12-25T09:07:47.123
> 
> 标签：javascript, jquery, ajax, function-calls

我正在使用 jQuery 和 Ajax。

我的 MainFile 有以下代码：

```
<html>
    <head>
        <script src="Myscript.js">
        </script>
        <script type="text/javascript">
            $(document).ready(function(){
                $.ajax({
                    type: 'POST',
                    url: 'ajax.php',
                    success: function(data){
                        $("#response").html(data);
                    }
                });
            });
        </script>

    <body>
        <div id="response">
        </div>
    </body>
</html> 
```

我的 ajax.php 获取示例数据

```
...
MyScript.js has the following

function display (text,corner)
{

}
.. 
```

我有 Myscript.js。在此，我有一个名为`display(text,corner)`. 我必须在执行 ajax.php 后调用这个函数。

我如何在 jQuery 中为上述代码执行此操作？

是否可以在 ajax.php 之后决定执行顺序并调用`display(text,corner)`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T09:13:52.197

您应该`display`在 Ajax 请求的回调函数中调用该函数，如下所示：

```
$.ajax({
    type:'POST',
    url: 'ajax.php',
    success: function(data){
        display(data, /* your other parameter, corner */); //Invoking your data function
    } 
}); 
```

在上述情况下，`data`是从`ajax.php`

# c# - Simple Scenario, How to Incorporate Tell Don't Ask?

> ID：392668
> 
> 赞同：5
> 
> 时间：2008-12-25T09:20:31.373
> 
> 标签：c#, tell-dont-ask

I'm trying to model a basic scenario involving a Person and a Seat. A Person has a Status property: Sitting or Standing. A seat has a Seated property that specifies the Person that is currently sitting in it. Also, a Seat is *special* in that it only "accepts" certain people to sit in it. I know it sounds strange for a Seat to "accept" someone, but just imagine it prefers certain people over others.

Following "[Tell, Don't Ask](http://www.pragprog.com/articles/tell-dont-ask)," How should I design the Person and Seat objects so that a Person can sit down in a Seat only when the Seat "accepts" him and also have his status changed to Sitting. My first thought was that a Person should have a SitDown method as follows:

```
Person.SitDown(Seat seat); 
```

But this seems like it would require the Person class to inspect the state of the Seat before sitting in it, as well as having to update the Seat's Seated property (instead of the Seat updating the property itself):

```
// inside the Person class
void SitDown(Seat seat) {
    if (seat.AcceptsPlayer(this)) {
        seat.Seated = this;
        this.Status = Sitting;
    }
} 
```

It seems better to have the Seat class handle seating a person:

```
Seat.SeatPerson(Person person);

// inside Seat class
void SeatPerson(Person person) {
    if (IsAccepted(person)) {
        this.Seated = person;
        person.Status = Sitting;
    }
} 
```

But this still requires the Seat to change the person's status. Is this the way that the person's status should be updated? Should only a Person be able to change his status? How would you model this simple scenario?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-25T09:30:06.767

Introduce a 3rd model... Seatings that has a reference to both the seat, and the person. Then you can create an instance of that model every time someone sits down, throw in some validations for preventing two people sitting in the same seat, and maybe even throw in some timeouts (if your sitting in a seat too long, you lose it).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-15T18:35:35.617

闻起来像你需要座位服务。那接受一个座位和一个人。然后决定是否可以进行操作。

这样，该人只需负责将自己标记为就座和位置。座位只负责将自己标记为“已占用”。

检查人员和座位是否符合标准是座位服务的责任。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T09:35:44.180

The problem is your model is defined with a circular dependency. There are two ways of avoiding this.

The first one doesn't exactly follow "Tell, Don't Ask" explicitly, but it gets closer to the point. We try to find out if we can sit down, then tell the chair that we're sitting in it.

```
void Person.SitDown(Seat seat) {
    if (seat.AcceptsPlayer(this)) {
        seat.SeatPerson(this);
        this.Status = Status.Sitting;
    }
}

void Seat.SeatPerson(Person person) {
    this.Seated = person;
} 
```

A better way to do this (which follows the "Tell, Don't Ask" more explicitly) might be the following. We try to sit in the chair. If the chair rejects us, we know.

```
void Person.SitDown(Seat seat) {
    if (seat.SeatPerson(this)) {
        this.Status = Status.Sitting;
    }
    else
    {
        //Couldn't sit down!
    }
}

bool Seat.SeatPerson(Person person) {
    if (this.IsAccepted(person) && this.Seated == null) {
        this.Seated = person;
        return true;
    }
    else
    {
        return false;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T13:53:18.233

使用回调，以便每个类都可以维护它负责的状态。

```
public class Seat
{
  public void SeatPerson(Person person, Action successAction)
  {
    if (IsAccepted(person))
    {
      this.Seated = person;
      successAction();
    }
  }
}

public class Person
{
  public void Sit(Seat seat)
  {
    seat.SeatPerson(this, this.SitComplete);
  }

  public void SitComplete()
  {
    this.Status = Sitting;
  }
} 
```

这里仍然存在周期性依赖。

Seat 有责任检查试图就座的人是否有效。一旦他们坐下，Seat 就会引用该人。人们只知道尝试坐在座位上的方法。

按照惯例，successAction 的持续时间不应超过 SeatPerson 调用。这保证了 Seat 不会损害 Person 的状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-14T09:59:16.053

您不需要 Seat 类。Seat 类跟踪坐着的人。相反，您可以删除 Seat 类并在名为 isSitting() 的 Person 类中添加一个新方法 { return this.Status == Sitting; }

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-25T09:34:51.420

let the person try to seat on the seat, and update it's state depending on the success of the operation:

Just call myPerson.TrySeat(targetseat), which returns true if the sitting process succeeded.

```
//inside Person class
        public bool TrySeat(Seat seat)
        {
            if (seat.TrySeat(this))
            {
                Status = Sitting;
                return true;
            }
            else
            {
                return false;
            }
        }

//inside Seat class
        internal bool TrySeat(Person person)
        {
            if (CanSeat(person))
            {
                Seated = person;
                return true;
            }
            else
            {
                return false;
            }
        } 
```

# c# - 关于C#/VisualStudio 2005使用的五个问题

> ID：392678
> 
> 赞同：0
> 
> 时间：2008-12-25T09:35:16.897
> 
> 标签：c#, visual-studio-2005

我有一些问题.. 我真的需要你的帮助。

1.  我有一个应用程序。

    首先我显示一个闪屏，一个表单，这个闪屏会调用另一个表单。

    **问题**：当显示启动画面时，如果我在启动画面顶部打开另一个应用程序，然后最小化这个新打开的应用程序窗口，启动画面变成白色。我该如何避免这种情况？我希望我的启动画面清晰地显示并且不受任何应用程序的影响。

2.  我正在使用 DropDownList 但我意识到它有两种类型。我发现“Dropdown”使 DDL 中的文本可编辑，而“DropDownList”则不能。

    **问题**：当我尝试使用 DropDownList 控件时，它不允许我添加默认文本，而 DropDown 这样做我想要一个 DropDownList 控件，它可以防止修改文本并允许默认文本..我应该使用什么属性？

3.  我可以加“？” 表示 FormBorder 的 Help 按钮（带有最小化、最大化和关闭按钮）

4.  我可以更改 Formborder 的默认颜色（蓝色）吗？

5.  我的应用程序功能之一是将文件从服务器复制到手机到存储卡中的某个文件夹中。

    **问题**：我能否确定 MMC 的空闲大小，以便在复制时通知用户它是否已满。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-25T10:45:45.507

3）您必须将表单的“HelpButton”属性设置为true。然而 ”？” 仅当您通过将“MinimizeBox”和“MaximizeBox”设置为 false 来停用最大化和最小化按钮时，按钮才可见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T09:42:27.677

这里有几个...

1）您需要在另一个线程中启动窗口，以便您的应用程序可以执行启动所需的操作。启动完成后，向启动屏幕发出信号，表明它可以自行关闭。

2)

```
dropDownList.SelectedIndex = 0; 
```

4）我不建议这样做。它基于用户设置的系统配色方案。我不希望应用自行决定使用哪种方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T10:30:22.153

5) 如果 MMC 显示为映射驱动器，您可以使用其中[一种](http://weblogs.asp.net/israelio/archive/2004/08/08/210788.aspx)技术

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T11:07:39.923

再一次，这个家伙的问题没有答案。

1.  是的，按照其他人的说法，在自己的线程中启动启动画面。

2.  .Net 中只有一种类型的 ComboBox，但是有一个名为 DropDownStyle 的属性可以设置其功能。

3.  是的，我对它的工作原理一无所知，而且从来不需要它。

4.  是的，你打赌，它被称为非客户绘画。你可以在这里找到更多信息[http://www.codeplex.com/CustomerBorderForm/Wiki/View.aspx?title=Painting%20NonClient%20Area&referringTitle=Home](http://www.codeplex.com/CustomerBorderForm/Wiki/View.aspx?title=Painting%20NonClient%20Area&referringTitle=Home)

5.  我需要更多细节。

# javascript - jQuery中的弹出窗口

> ID：392698
> 
> 赞同：4
> 
> 时间：2008-12-25T09:57:30.363
> 
> 标签：javascript, jquery, popupwindow

我需要一个带有单选按钮选项的弹出窗口。我已经用[Impromtu](http://en.wikipedia.org/wiki/Impromptu_%28programming_environment%29)进行了测试。是否有任何易于制作的 Popupwindow 插件可用？

我的插件应该可以在 Internet Explorer、Mozilla 和 Google Chrome 中运行。一些示例代码是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-25T10:09:01.493

[jqModal](http://dev.iceburg.net/jquery/jqModal/)非常棒且易于使用，可用于构建模态弹出窗口等。

如果您想了解如何在不使用 jQuery 的情况下自己构建一个教程，请查看[本教程](http://slayeroffice.com/code/custom_alert/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T10:10:22.053

看看[厚盒](http://jquery.com/demo/thickbox/)！您可以在页面上使用 div 等作为内容（请参阅内联内容演示）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T10:56:51.100

根据您的需要，这是一个类似灯箱的插件列表：

[http://www.fortysomething.ca/mt/etc/archives/006978.php](http://www.fortysomething.ca/mt/etc/archives/006978.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T05:01:38.750

如果您不是绝对倾向于使用 jQuery，那么还有另一个可用的库使用 Prototype 库，它非常方便。弹出窗口很容易实现，模式对话框更容易实现。

顺便说一句，我以前使用过厚盒，印象深刻，但它使用的 URL 解析结构有点限制我需要做的事情（我使用的是不使用锚点的 ComponentArt 对象）。

无论如何，一定要看看这个工具。它可能超出了您的需要，但谁知道您可能会受到启发去寻找它的其他用途。这是一个非常有趣的工具： http: [//prototype-window.xilinus.com/documentation.html](http://prototype-window.xilinus.com/documentation.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T16:10:16.683

[FaceBox](http://famspam.com/facebox)是另一种选择。

# c# - C#中的阴影和覆盖之间的区别？

> ID：392721
> 
> 赞同：106
> 
> 时间：2008-12-25T10:45:53.133
> 
> 标签：c#

在 C# 中**遮蔽**和**覆盖**方法有什么区别？

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2008-12-25T10:55:58.590

那么继承...

假设你有这个类：

```
class A {
   public int Foo(){ return 5;}
   public virtual int Bar(){return 5;}
}
class B : A{
   public new int Foo() { return 1;}     //shadow
   public override int Bar() {return 1;} //override
} 
```

那么当你调用这个时：

```
A clA = new A();
B clB = new B();

Console.WriteLine(clA.Foo()); // output 5
Console.WriteLine(clA.Bar()); // output 5
Console.WriteLine(clB.Foo()); // output 1
Console.WriteLine(clB.Bar()); // output 1

//now let's cast B to an A class
Console.WriteLine(((A)clB).Foo()); // output 5 <<<-- shadow
Console.WriteLine(((A)clB).Bar()); // output 1 
```

假设您有一个基类，并且您在所有代码中都使用基类而不是继承的类，并且您使用影子，它将返回基类返回的值，而不是遵循对象真实类型的继承树。

[在这里运行代码](https://dotnetfiddle.net/ApUlvE)

希望我说得通：）

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-12-25T12:21:36.483

阴影实际上是 VB 的说法，我们称之为隐藏在 C# 中。

通常隐藏（VB 中的阴影）和覆盖显示为[Stormenet](https://stackoverflow.com/users/2090/stormenet)的回答。

虚拟方法被子类覆盖，即使在超类类型上或从超类的内部代码调用该方法，也会从子类调用替换实现。

`new`然后，在子类上定义具有相同签名的方法时，通过使用关键字隐藏具体方法（未标记为虚拟或抽象的方法） 。在这种情况下，当在超类类型上调用方法时，使用原始实现，新实现仅在子类上可用。

然而，经常被忽略的是也可以隐藏一个虚拟方法。

```
class A
{
    public virtual void DoStuff() { // original implementation }
}

class B : A
{
    public new void DoStuff() {  //new implementation }
}

B b = new B();
A a = b;

b.DoStuff(); //calls new implementation
a.DoStuff(); //calls original implementation. 
```

注意在上面的例子中 DoStuff 变得具体并且不能被覆盖。但是，也可以同时使用 the`virtual`和`new`关键字。

```
class A
{
    public virtual void DoStuff() { // original implementation }
}

class B : A
{
    public new virtual void DoStuff() {  //new implementation }
}

class C : B
{
    public override void DoStuff() { //replacement implementation }
}

C c = new C();
B b = c;
A a = b;

c.DoStuff(); //calls replacement implementation
b.DoStuff(); //calls replacement implementation
a.DoStuff(); //calls original implementation. 
```

请注意，尽管涉及的所有方法都是虚拟的，但 C 上的覆盖不会影响 A 上的虚拟方法，因为`new`在 B 中的使用隐藏了 A 的实现。

**编辑：**在对此答案的评论中指出，上述内容可能很危险，或者至少不是特别有用。我会说是的，它可能很危险，如果它有用的话，它会在那里。

特别是，如果您还更改了可访问性修饰符，您可能会遇到各种麻烦。例如：-

```
public class Foo
{
    internal Foo() { }
    protected virtual string Thing() { return "foo"; }
}

public class Bar : Foo
{
 internal new string Thing() { return "bar"; }
} 
```

对于 , 的外部继承者`Bar`来说，`Foo`Thing() 的实现仍然是可访问和可覆盖的。根据 .NET 类型规则，所有合法且可解释的内容都非常不直观。

我发布这个答案是为了加深对事物如何工作的理解，而不是作为可以自由使用的技术的建议。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-25T10:52:00.767

我认为主要区别在于，使用阴影，您实际上是在重用名称，而只是忽略了超类的使用。通过覆盖，您正在更改实现，但不是可访问性和签名（例如参数类型和返回）。请参阅[http://www.geekinterview.com/question_details/19331](http://www.geekinterview.com/question_details/19331)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-03-02T09:37:05.660

阴影是一个 VB.NET 概念。在 C# 中，阴影被称为隐藏。它隐藏了派生类方法。它是使用“新”关键字完成的。

Override 关键字用于在派生类中提供基类方法（标记为“虚拟”）的全新实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-06T11:01:51.997

基本上，如果你有类似下面的东西，

```
Class A
{
}

Class B:A
{
}

A a = new B(); 
```

你在对象'a'上调用的任何方法都将在'a'的类型上进行（这里类型是'A'）但是如果你在B类中实现了A类中已经存在的相同方法，编译器将警告您使用“新”关键字。如果您使用“新建”，警告将消失。除此之外，在继承的类中使用“New”或不使用它没有区别。

在某些情况下，您可能需要调用特定实例当时持有的引用类的方法，而不是调用对象类型的方法。在上述情况下，它持有的引用是“B”，但类型是“A”。因此，如果您希望方法调用发生在“B”上，那么您可以使用 Virtual 并覆盖来实现这一点。

希望这可以帮助...

丹尼尔·桑迪普。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-03-26T19:25:46.780

如果在某些情况下您无法更改类的内容，例如`A`，但您想使用它的某些方法并且您有一个名称通用的方法，您可以通过`new`关键字使用您自己的方法实现。

关键是要使用它，引用和对象必须是相同的类型。

```
class A
{
    public void Test()
    {
        Console.WriteLine("base");
    }
}

class B : A
{
    public new void Test()
    {
        Console.WriteLine("sub");
    }

    public static void Main(string[] args)
    {
        A a = new A();
        B aa = new B();
        a.Test();
        aa.Test();
    }
} 
```

# python - 如何从数字中生成颜色

> ID：392728
> 
> 赞同：5
> 
> 时间：2008-12-25T10:56:00.540
> 
> 标签：python, colors

我有一个函数，它返回一个从 0 到 255 的浮点数。我想从中制作一个红色渐变，但我需要一个“#FFFFFF”格式的字符串。有那个功能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-25T10:58:37.867

你可以使用：

```
"#%02X0000" % x 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T17:11:00.487

```
def rgbtohex(r,g,b):
    return "#%02X%02X%02X" % (r,g,b) 
```

# nhibernate - 每个会话打开视图中的 NHibernate 事务 - 建议的做法？

> ID：392730
> 
> 赞同：1
> 
> 时间：2008-12-25T10:56:59.743
> 
> 标签：nhibernate, transactions

清理一些事务逻辑并想知道其他人是如何处理它的。

Ayende 的建议似乎是在服务边界处理事务。这是一个 ASP.NET Web 应用程序，因此它没有明确的服务边界，至少现在没有。

人们做什么？

*   在 HttpModule 中为每个请求创建一个事务并在 EndRequest 上处理提交，在错误时回滚？
*   在应用程序的实际“服务”中创建事务并在多个地方处理它？
*   还有什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-15T17:55:49.183

您可以为您的服务层使用 IoC 容器，该容器可以管理事务和 Nibenrate 会话。

您的 WebApp 控制器 => 调用 (A) 服务层 => 调用 (B) 一个或多个 DAO 方法/操作。

像 Spring.NET 这样的 IoC 容器将管理 TX 范围，例如在 (A) 中，并将在 (B) 中为您的 DAO 提供一个 Session。提交（或回滚）将在服务层调用结束时处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T13:55:55.153

大多数人使用您的第一个要点中所述的按请求会话策略。但是，我不认为事务需要在 EndRequest 上提交。在许多网页中，根据用户操作（例如单击提交）提交事务并让 EndRequest 处理 ISession 的处理会更容易。

据我所知，不需要创建 HttpModule，因为可以在 global.asax 中创建相同的功能：http: [//forum.hibernate.org/viewtopic.php](http://forum.hibernate.org/viewtopic.php?t=993041) ?t=993041 。

# mobile - 如何获得手机MMC闪存卡的可用空间

> ID：392731
> 
> 赞同：0
> 
> 时间：2008-12-25T10:58:07.620
> 
> 标签：mobile, hardware, diskspace

我想通过 PC 的 USB 连接获取手机存储卡的大小和可用空间。

我使用[PC 套件](http://europe.nokia.com/pcsuite)连接。

这不是移动应用程序；这是一个桌面应用程序。我所做的就是打开应用程序和手机之间的连接，然后将所需的文件复制到 MMC 中的某个文件夹中。

现在我需要获取可用空间和总大小，以便通知用户他的存储卡是否已满，然后停止传输。CONA 中是否有可以帮助我做到这一点的功能？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-26T14:08:42.193

WinMo 上的 Umm Active Sync 显示了这一点，在 G1 上它是一个附加的驱动器，而对于 Iphone，这个信息可以在 iTunes 中找到。我假设您使用 WinMo？

# haskell - Haskell, Lisp, and verbosity

> ID：392733
> 
> 赞同：104
> 
> 时间：2008-12-25T10:58:42.813
> 
> 标签：haskell, comparison, lisp, language-comparisons

For those of you experienced in both Haskell and some flavor of Lisp, I'm curious how "pleasant" (to use a horrid term) it is to write code in Haskell vs. Lisp.

Some background: I'm learning Haskell now, having earlier worked with Scheme and CL (and a little foray into Clojure). Traditionally, you could consider me a fan of dynamic languages for the succinctness and rapidity they provide. I quickly fell in love with Lisp macros, as it gave me yet another way to avoid verbosity and boilerplate.

I'm finding Haskell **incredibly** interesting, as it's introducing me to ways of coding I didn't know existed. It definitely has some aspects that seem like they would aid in achieving agility, like ease of writing partial functions. However, I'm a bit concerned about losing Lisp macros (I assume I lose them; truth be told I may have just not learned about them yet?) and the static typing system.

Would anyone who has done a decent amount of coding in both worlds mind commenting on how the experiences differ, which you prefer, and if said preference is situational?

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-25T15:40:13.010

简短的回答：

*   几乎所有你可以用宏做的事情，你可以用高阶函数做（我包括单子，箭头等），但这可能需要更多的思考（但只是第一次，它很有趣，你会成为一个更好的程序员），和
*   静态系统足够通用，它永远不会妨碍您，有点令人惊讶的是，它实际上“有助于实现敏捷性”（正如您所说），因为当您的程序编译时，您几乎可以确定这是正确的，所以这种*确定性*让您尝试排除你可能害怕尝试的东西——编程有一种“动态”的感觉，尽管它与 Lisp 不同。

[注意：有一个“[模板 Haskell](http://www.haskell.org/haskellwiki/Template_Haskell) ”可以让你像在 Lisp 中一样编写宏，但严格来说你永远*不需要*它。]

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-12-25T11:28:04.470

First of all, don't worry about losing particular features like dynamic typing. As you're familiar with Common Lisp, a remarkably well-designed language, I assume you're aware that a language can't be reduced to its feature set. It's all about a coherent whole, isn't it?

In this regard, Haskell shines just as brightly as Common Lisp does. Its features combine to provide you with a way of programming that makes code extremely short and elegant. The lack of macros is mitigated somewhat by more elaborate (but, likewise, harder to understand and use) concepts like monads and arrows. The static type system adds to your power rather than getting in your way as it does in most object-oriented languages.

On the other hand, programming in Haskell is much less interactive than Lisp, and the tremendous amount of reflection present in languages like Lisp just doesn't fit the static view of the world that Haskell presupposes. The tool sets available to you are therefore quite different between the two languages, but hard to compare to one another.

I personally prefer the Lisp way of programming in general, as I feel it fits the way I work better. However, this doesn't mean you're bound to do so as well.

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-07T23:01:18.263

与 Common Lisp 相比，Haskell 中对元编程的需求更少，因为可以围绕 monad 构建很多内容，并且添加的语法使嵌入式 DSL 看起来不像树，但总是有 Template Haskell，正如[ShreevatsaR](https://stackoverflow.com/questions/392733/haskell-lisp-and-verbosity#392893)所提到的，甚至是[Liskell](http://www.liskell.org/)（Haskell 语义 + Lisp语法）如果你喜欢括号。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-02-23T23:20:18.270

关于宏，这里有一个讨论它的页面：[**Hello Haskell，Goodbye Lisp**](http://newartisans.com/2009/03/hello-haskell-goodbye-lisp/)。它解释了在 Haskell 中不需要宏的观点。它带有一个简短的示例进行比较。

需要 LISP 宏以避免评估两个参数的示例：

```
(defmacro doif (x y) `(if ,x ,y)) 
```

Haskell 没有系统地评估两个参数的示例情况，不需要像宏定义这样的东西：

```
doif x y = if x then (Just y) else Nothing 
```

瞧

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-07-09T08:03:20.243

我是一名 Common Lisp 程序员。

前段时间尝试过 Haskell，我个人的底线是坚持使用 CL。

原因：

*   动态类型（查看[动态与静态类型——Pascal Costanza 的基于模式的分析](http://www.p-cos.net/documents/dynatype.pdf)）
*   可选和关键字参数
*   带有宏的统一同音列表语法
*   前缀语法（无需记住优先规则）
*   不纯，因此更适合快速原型制作
*   具有元对象协议的强大对象系统
*   成熟的标准
*   广泛的编译器

Haskell 确实有其自身的优点，并且以完全不同的方式做一些事情，但从长远来看，它对我来说并没有削减它。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-12T21:10:13.593

在 Haskell 中，您可以定义一个 if 函数，这在 LISP 中是不可能的。这是可能的，因为惰性允许程序中的更多模块化。这篇经典论文： John Hughes 的[为什么 FP 很重要](http://www.math.chalmers.se/~rjmh/Papers/whyfp.html)，解释了惰性如何增强可组合性。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-09-09T14:31:36.503

您可以在 Lisp 中使用 Haskell 中繁琐（如果可能的话）的宏来实现非常酷的事情。以“memoize”宏为例（参见 Peter Norvig 的 PAIP 的第 9 章）。有了它，你可以定义一个函数，比如 foo，然后简单地评估 (memoize 'foo)，它将 foo 的全局定义替换为一个 memoized 版本。你能在 Haskell 中用高阶函数达到同样的效果吗？

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-29T23:42:31.847

当我继续我的 Haskell 学习之旅时，似乎有助于“替换”宏的一件事是能够定义自己的中缀运算符并自定义它们的优先级和关联性。有点复杂，但一个有趣的系统！

# xcode - Xcode：调整自动生成的大括号的缩进？

> ID：392749
> 
> 赞同：39
> 
> 时间：2008-12-25T11:21:29.147
> 
> 标签：xcode, indentation

默认情况下，Xcode 自动生成的代码似乎在同一行有左大括号：

```
@interface Controller : NSObject {

} 
```

我想要单独一行的左大括号，如下所示：

```
@interface Controller : NSObject 
{

} 
```

这通常适用于 Xcode 自动生成的任何方法/类。在 Xcode 首选项中，我将“Indent solo { by”设置为 0： [![替代文字](https://i.stack.imgur.com/XOVVe.png)](https://i.stack.imgur.com/XOVVe.png)

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-05-07T11:32:53.303

对于 Xcode 3.x，您可以使用以下内容： 如果您打开一个终端会话并输入
`defaults write com.apple.Xcode XCCodeSenseFormattingOptions '{ "BlockSeparator" = "\n" ; }'`
它，则会在新行上开始新的代码块。请注意，如果您打开了 XCode，则必须重新启动它才能读取和使用新的默认值。

对于 Xcode 4.x 到 6.x（当前），我建议您使用[Snippet Edit](http://cocoaholic.com/snippet_edit/)作为一个方便的工具来编辑定义 Xcode 自动完成的片段。目前它是免费的，而且效果很好。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-25T18:51:13.060

**New Project**和**New File**命令**不会真正生成任何**代码；他们填写**模板**。

您需要使用所需的更改创建自己的模板（可能基于 Apple 的）。

在**Xcode 3.1**中，库存模板位于`/Developer/Library/Xcode`. 您会将修改后的副本放入`~/Library/Application` `Support/Developer/Shared/Xcode`. 注意这些文件夹的子文件夹。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-25T18:08:36.750

阅读：[XCCodeSenseFormattingOptions](http://developer.apple.com/mac/library/documentation/DeveloperTools/Reference/XcodeUserDefaultRef/100-Xcode_User_Defaults/UserDefaultRef.html#//apple_ref/doc/uid/TP40005535-CH3-SW40)

本文档描述了自动完成将用于大括号和参数样式的所有格式选项。这是我的：

```
 XCCodeSenseFormattingOptions =     {
    BlockSeparator = "\\n";
    PreMethodDeclSpacing = "";
}; 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-11-04T14:56:16.193

这也是我想看到的，我不喜欢花括号与函数或循环控制在同一行的“新派”方式。

在编辑和改组代码行时，更容易将所有相关内容保持在一行中。花括号应该只定义范围，它们不是函数定义或程序执行的一部分（如 if、for 等）。

修改所有模板并不是一个好的解决方案，但无论如何感谢您提供的信息。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-02-09T15:11:48.040

如果您想在所有情况下都有自己喜欢的风格，您需要结合 Laughing_Jack 的答案和 Peter Hosey 的答案。除了 Peter Hosey 所说的，您可能还想知道 Cocoa Touch 文件模板位于以下位置。您也可以将该目录复制到您的自定义模板中：

```
/Developer/Platforms/iPhoneOS.platform/Developer/Library/Xcode/File Templates/Cocoa Touch Classes/ 
```

Xcode User Defaults 在手动输入代码时为您提供您的风格，文件模板在自动生成新类时提供它等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-12-10T23:09:07.090

我相信“默认写入 com.apple.Xcode”不适用于最新版本的 Xcode (7.x)

解决方法是编辑默认代码片段。

但是，Xcode 不允许修改默认的代码片段。

为了修改它们，您可以从[这里下载“片段编辑”程序](http://cocoaholic.com/snippet_edit/)

# sql - 如何在 mysql 中执行此操作：如果 id=idold THEN UPDATE status=1

> ID：392750
> 
> 赞同：1
> 
> 时间：2008-12-25T11:22:45.697
> 
> 标签：sql, mysql

我想比较两个表，然后在某些逻辑为真时更新，

在伪代码中：

```
SELECT * FROM users, usersold IF users.id=usersold.id THEN UPDATE users.status=1; 
```

有没有办法在 MySQL 中做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-25T11:26:20.463

```
UPDATE users u
SET status = 1
WHERE EXISTS (SELECT id FROM usersold WHERE id = u.id) 
```

替代版本：

```
UPDATE users
SET status = 1
WHERE id IN (SELECT id FROM usersold) 
```

您应该进行测试，并且根据您的数据库，您可能会发现一个比另一个执行得更好，尽管我希望任何体面的数据库都会优化，然后无论如何都会大致相同。

# xml - 在 XML 模式中强制使用 CDATA

> ID：392770
> 
> 赞同：4
> 
> 时间：2008-12-25T11:52:20.613
> 
> 标签：xml, xsd, cdata

我正在创建一个 xml 架构，并且我想确保所有元素中的值都是 CDATA 元素。

有没有办法使用 XML 模式强制执行此操作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-25T13:01:40.460

我记得 XML Schema 在 XML Infoset 上工作，这意味着在解析 XML 文档后，实体被解析，空白被规范化，CDATA 被处理。CDATA 是一种简化文本序列化的方法，而不是结构模型的一部分。所以：不。在 DTD 或 RELAX NG 中都没有。

# java - 如何在 Eclipse 编辑器插件中显示语法错误

> ID：392775
> 
> 赞同：4
> 
> 时间：2008-12-25T12:06:51.770
> 
> 标签：java, syntax-highlighting, eclipse-plugin

如何像在 Eclipse Java 编辑器中一样在 Eclipse 编辑器插件中指示语法错误（例如，非法的标记序列），即通过红色下划线、滚动条上可以跳转到的红色标记以及解释性消息你悬停在任何一个上？

我正在为自定义文件格式（特别是 Shark3D 游戏引擎的“蛇文件格式”）编写一个 Eclipse 编辑器插件。我已经实现了一个扫描器来获得语法高亮和一个大纲。

*   对于下划线，我是否只是让扫描仪返回`IToken`带有“弯曲下划线”`TextAttribute`而不是正常的，或者是否有标记语法错误的特定机制？
*   如何实现滚动条标记？`IAnnotationModel`相关接口在这里吗？如果是这样，我在哪里注册实现以便标记出现？
*   我只找到了`SourceViewerConfiguration.getAnnotationHover()`，这将允许我实现悬停行为，但仅限于“注释”，我认为这意味着滚动条标记 - 我如何为文本本身实现悬停行为？

我很乐意提供具体的建议以及涵盖此内容的教程的 URL - eclipse 帮助文档和示例似乎没有。

**编辑：** 标记是最好的解决方案。可以在插件示例代码中找到如何使用它们的工作示例`org.eclipse.ui.examples.readmetool.AddReadmeMarkerAction`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-26T00:33:26.257

你应该使用标记。

一个源自“The Java Developer's Guide to Eclipse”的示例如下：

```
<extension point="org.eclipse.core.resources.markers"  
            id="snakesyntax"  
            name="Snake syntax error">  
    <super type="org.eclipse.core.resources.problemmarker" />  
    <super type="org.eclipse.core.resources.textmarker" />  
    <persistent value="true" />
<extension>

IMarker marker = res.createMarker("com.ibm.tool.resources.snakesyntax");

marker.setAttribute(IMarker.SEVERITY, 0);
marker.setAttribute(IMarker.CHAR_START, startOfSyntaxError);
marker.setAttribute(IMarker.CHAR_END, endOfSyntaxError);
marker.setAttribute(IMarker.LOCATION, "Snake file");
marker.setAttribute(IMarker.MESSAGE, "Syntax error"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T00:45:39.447

正确的方法是使用标记界面。

标记本质上是一个将标记对象映射到源代码中位置的模型，因此这在多个文件中可能出现错误的情况下是有意义的。（见 IMarker 界面）

如果您想将标记添加到当前编辑器而不是所有项目，一个更便宜的选择是使用注释，您可以自己添加删除。

标记在 UI 中表示为注释，但 Eclipse 自己添加和删除注释。使用直接注释，您可以掌控一切。

# c# - 对于 .NET/Windows 窗体项目，是否有 Maven 的替代品？

> ID：392781
> 
> 赞同：39
> 
> 时间：2008-12-25T12:28:46.967
> 
> 标签：c#, dependencies

C# Windows 窗体项目使用什么代替[Maven ？](http://en.wikipedia.org/wiki/Apache_Maven)

我们在世界各地都有开发人员，并且正在尝试开发一些简单快速的依赖管理系统。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-08T11:07:02.443

有[Byldan](http://byldan.codeplex.com/)，但该项目似乎还很年轻。

（另请参阅 Stack Overflow 问题*[.NET 世界是否有 Maven 替代方案或端口？](https://stackoverflow.com/questions/652583/is-there-a-maven-alternative-or-port-for-the-net-world)*。）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-10-08T00:42:24.600

我写了一篇关于这个主题的教程，*[使用 Maven 管理 .NET 项目](https://web.archive.org/web/20110830022107/http://docs.codehaus.org/display/MAVENUSER/Using+Maven+to+manage+.NET+projects)*。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-03-11T09:20:00.543

似乎在这方面已经用[Nuget](http://nuget.org/)完成了一些工作。请参阅 David Ebbo 的博文*[Using NuGet without committing packages](http://blog.davidebbo.com/2011/03/using-nuget-without-committing-packages.html)*。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-05-10T08:43:30.540

有[NMaven](http://nmaven.codeplex.com)和[NPaday](http://incubator.apache.org/npanday/)，它们都具有相同的起源。它们是 Maven 插件的集合，可以使用类似 Maven 的 C# 和 VB.NET 项目构建。

NMaven 似乎死了，这就是我使用 NPaday 的原因。我最近加入了这个团队，而且很活跃。当前版本是 1.1。1.2 版即将推出，我们也在努力开发下一个主要版本。

**你应该用它...**

*   当你喜欢 Maven

**你不应该使用它...**

*   当你喜欢 MSBuild 时（这在 2.0 中会变得更好）
*   当您需要本地化资源程序集时（将在 1.2 中修复）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-25T22:28:12.483

您可以只使用[Maven](http://en.wikipedia.org/wiki/Apache_Maven)并编写一个集成[MSBuild](http://en.wikipedia.org/wiki/MSBuild)的插件。

我们使用 Maven 来管理非 Java 组件，例如我们的[Flex](http://en.wikipedia.org/wiki/Adobe_Flex) .swf 和 .swc 模块。与仅为 .NET 程序集重新创建类似系统相比，编写 Maven 插件的工作量更少。

就此而言，我建议同时使用[Hudson](http://en.wikipedia.org/wiki/Hudson_%28software%29)和 Maven。

# python - 如何在一个视图中处理两个表单？

> ID：392784
> 
> 赞同：5
> 
> 时间：2008-12-25T12:40:27.990
> 
> 标签：python, django, django-forms, django-templates

我在一个模板中有两种完全不同的表格。如何在一个视图中处理它们？如何区分提交了哪些表格？我怎样才能使用前缀来完成呢？或者也许最好编写单独的视图？

问候
克里斯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-25T13:23:25.330

就个人而言，我会使用一个视图来处理每个表单的 POST。

另一方面，您可以使用隐藏的输入元素来指示使用的表单

```
<form action="/blog/" method="POST">
    {{ blog_form.as_p }}
    <input type="hidden" name="form-type" value"blog-form" /> <!-- set type -->
    <input type="submit" value="Submit" />
</form>

... 

<form action="/blog/" method="POST">
    {{ micro_form.as_p }}
    <input type="hidden" name="form-type" value"micro-form" /> <!-- set type -->
    <input type="submit" value="Submit" />
</form> 
```

像这样的视图：

```
def blog(request):
    if request.method == 'POST':
        if request.POST['form-type'] == u"blog-form":   # test the form type
            form = BlogForm(request.POST) 
            ...
        else:
            form = MicroForm(request.POST)
            ...

    return render_to_response('blog.html', {
        'blog_form': BlogForm(),
        'micro_form': MicroForm(),
    }) 
```

...但再一次，我认为每个表单一个视图（即使视图只接受 POST）比尝试执行上述操作更简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-26T07:02:48.203

就像ayaz说的，你应该给表单提交按钮提供唯一的名称

```
<form action="." method="post">
......
<input type="submit" name="form1">
</form>

<form action="." method="post">
......
<input type="submit" name="form2">
</form>

#view

if "form1" in request.POST:
    ...
if "form2" in request.POST:
    ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T14:42:22.783

如果这两种形式是完全不同的，用两种不同的观点来处理肯定是没有坏处的。否则，您可以使用*zacherates*提到的“隐藏输入元素”技巧。或者，您总是可以给每个`submit`元素一个**唯一的**名称，并根据该名称在视图中区分提交的表单。

# android - XMPP 和安卓

> ID：392785
> 
> 赞同：10
> 
> 时间：2008-12-25T12:40:28.787
> 
> 标签：android, xmpp

> **可能重复：**
> [Android 和 XMPP：当前可用的解决方案](https://stackoverflow.com/questions/4769020/android-and-xmpp-currently-available-solutions)

我正在尝试在 Android 中构建一个小型 XMPP 客户端。关于我可以使用什么库的任何想法？我曾尝试使用 Smack API，但它存在一些问题，这使得它不实用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-08-20T10:07:38.723

ASmack 是 Smack 到 Android 的端口：

[http://code.google.com/p/asmack/](http://code.google.com/p/asmack/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-29T11:05:45.633

它已经实施了。看看这里： [http ://davanum.wordpress.com/2008/12/29/updated-xmpp-client-for-android/](http://davanum.wordpress.com/2008/12/29/updated-xmpp-client-for-android/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-07T21:26:31.907

Smack has been ported to Android and works fine now. Nevertheless, if you are looking for a rocket proof port of Smack for Android which supports most of the XMPP extensions (including pubsub) as well as automatic reconnection and other features, you should consider this commercial solution: [http://www.ubikod.com/products.htm](http://www.ubikod.com/products.htm)

# .net - 从 .Net 程序中卸载 COM dll

> ID：392786
> 
> 赞同：2
> 
> 时间：2008-12-25T12:44:02.490
> 
> 标签：.net, c++, com

我们有一个 .Net 应用程序，从中实例化一个 C++ COM 组件。我们从子窗体窗口加载 COM 组件。.Net 应用程序正在编辑一个公共资源，而 COM dll 又使用该资源来启动。

当执行以下步骤时：
1\. 在新的子窗口中实例化 COM 组件 COM 组件被实例化，被子窗体使用，使用后被设置为 NULL ，希望 COM 组件将被卸载。
2\. 保持子窗口打开，然后编辑资源
3\. 现在，去“刷新”表单，创建一个新的 COM 实例，查看更改资源的重新选择 - 但资源没有刷新。

我们也使用了 Marshal.ReleaseComObject 方法，但没有成功。请指教。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-25T15:14:30.957

一旦将 DLL 加载到 .Net AppDomain 中，就不可能强制卸载 DLL。这是 CLR 的一个不幸的限制。如果您绝对需要卸载 DLL，您可以执行以下操作。

1.  创建一个新的应用程序域
2.  将 DLL 加载到新的 DLL 中
3.  在新的 AppDomain 中完成工作
4.  卸载新的 AppDomain

如果 DLL 仅加载到一个 AppDomain 中，则卸载 AppDomain 也会卸载 DLL。因此，这将卸载 DLL。然而，这是一个相当重量级的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-05T15:25:26.443

A [discussion on clrInterop page](http://clrinterop.codeplex.com/discussions/61817) describes very close what you outlined in your question. The garbage collector does not unload the native dll. I quote: " It could be very dangerous for clr to do this because there might be other code (even native code) which depends on that dll. If you do assure that dll is not used any more, calling a windows API like FreeLibrary may be easiest way to unload the dll."

So you'll need to interop FreeLibrary and use that to unload the native dll. Although I might add: don't if you can try to find a solution where you don't need to unload the dll.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T14:31:41.837

COM 对象和 DLL 是两个不同的东西，即使一个存在于另一个中。某些 hack 是可能的，但更好的解决方案是以不依赖 DLL 卸载的更明智的方式重写这部分。

# c# - 闪屏问题 - C# - VS2005

> ID：392787
> 
> 赞同：1
> 
> 时间：2008-12-25T12:45:40.303
> 
> 标签：c#, winforms, splash-screen

我有一个应用程序。

首先我显示一个闪屏，一个表单，这个闪屏会调用另一个表单。

问题：当显示启动画面时，如果我在启动画面上方打开另一个应用程序，然后最小化这个新打开的应用程序窗口，启动画面变成白色。我该如何避免这种情况？我希望我的启动画面清晰地显示并且不受任何应用程序的影响。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-25T13:21:40.513

您需要在不同的线程中显示初始屏幕 - 当前您的新表单加载代码正在阻塞初始屏幕的 UI 线程。

启动一个新线程，并在该线程上创建启动画面并调用`Application.Run(splash)`. 这将在该线程上启动一个新的消息泵。然后，您需要让主 UI 线程在准备就绪时回调到启动屏幕的 UI 线程（例如，使用 Control.Invoke/BeginInvoke），以便启动屏幕可以自行关闭。

重要的是确保您不要尝试从错误的线程修改 UI 控件 - 仅使用创建控件的那个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-26T15:11:06.140

.NET 框架对启动画面具有出色的内置支持。启动一个新的WF项目，Project + Add Reference，选择Microsoft.VisualBasic。添加一个新表单，将其命名为 frmSplash。打开 Project.cs 并使其看起来像这样：

```
using System;
using System.Windows.Forms;
using Microsoft.VisualBasic.ApplicationServices;

namespace WindowsFormsApplication1 {
  static class Program {
    [STAThread]
    static void Main(string[] args) {
      Application.EnableVisualStyles();
      Application.SetCompatibleTextRenderingDefault(false);
      new MyApp().Run(args);
    }
  }
  class MyApp : WindowsFormsApplicationBase {
    protected override void OnCreateSplashScreen() {
      this.SplashScreen = new frmSplash();
    }
    protected override void OnCreateMainForm() {
      // Do your time consuming stuff here...
      //...
      System.Threading.Thread.Sleep(3000);
      // Then create the main form, the splash screen will close automatically
      this.MainForm = new Form1();
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-26T00:53:39.710

我有一个类似的问题，你可能想看看。我得到的[Stack Overflow 答案](https://stackoverflow.com/questions/48916/multi-threaded-splash-screen-in-c)对我来说非常完美 - 你可能想看看。

# perl - 您是否正在使用 Perl，是什么让您进入其中？

> ID：392789
> 
> 赞同：12
> 
> 时间：2008-12-25T12:54:18.960
> 
> 标签：perl

几年前我接触到 Perl，一直觉得它是一种有趣且富有表现力的语言。

我发现使用 Perl 进行编程使我的工作效率很高，这要归功于它的低开销以及针对 CPAN 上常见问题的大量现成解决方案。

如果你是 Perl 的新手，是什么让你喜欢上了它？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-25T16:07:43.843

我以编写 PHP 为生，然后听说它们从 :: 更改为 \ 作为名称空间分隔符。我真的不是在开玩笑或怀有恶意，但这*确实*是让球滚动的原因。

不要成为精英，但我突然意识到，我必须与之合作的那些知道 PHP 的人对编程概念知之甚少，这让我很沮丧，他们怎么会如此盲目，IRC 房间里的人不再是我的问题的帮助来源，我通常会花更多时间回答问题并等待可以回答我的人出现。通常我最终自己解决了它。大多数时候，我意识到人们以越来越糟糕的方式一遍又一遍地重新解决相同的问题。

我在 PHP 中发现了违反逻辑和推理的问题行为（例如 array_merge_recursive 系列），并发现了未记录如何使用它们的函数，当我报告函数中的错误时，我的错误被标记为“虚假”，我预计是通灵的。

我有一个朋友一直在宣传 Perl 的优点，所以我基本上试了一下，现在我像个瘾君子一样上瘾了。

此外，我在其他高阶动态类型语言（JavaScript 和 Ruby，是的，就语言特性而言 JavaScript 是一种比 PHP 更强大的语言）方面的经验让我了解了许多轻松解决类型问题的方法，但受到限制以这种方式我无法使用这些强大的功能。Perl 满足了这种需求。

为什么选择 Perl 而不是 Ruby？我玩过一点 Ruby，但我的经验告诉我支持和文档很少，语言很慢而且不成熟。可能很好，但从我所看到的情况来看，它在对抗 Perl 方面的能力仍然有所下降。**它与**PHP 的主要缺陷相同，即它拥有庞大的用户群，其中包括所有以错误方式做事的新手，我真的不想处理那么多。

成为精英并不好，但是一旦你试图向 30 个人解释同样的事情（并且每次都花一个小时将一个简单的概念带入他们的脑海），你就会感到沮丧。（我无法应对“互联网上有人错了”的情况，如果我看不到*，*就不会发生）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-25T19:33:02.383

作为“脚本语言”课程的一部分，我在计算机科学专业的第三年开始学习 Perl。我有一个朋友学习生物技术，我帮助她编写了一些数据挖掘脚本来处理蛋白质数据库（解析文本文件、正则表达式、简单的完整性检查）。在 Perl 中做这一切都是很自然的。

然后我得到了我的第一份兼职工作，并且不得不专业地使用它。我负责开发一组批处理脚本来处理公司的某些业务逻辑。Perl 正是在这项任务中展现了它的全部潜力。需要从数据库中获取数据？- 没问题，只要去 CPAN。需要自动化 wiki - 没问题，去 CPAN。已经创建的模块的数量是压倒性的，你可以确定你总能在 CPAN 中找到你需要的东西。

总结一下。对我来说，Perl 是脚本语言的瑞士军刀。一切都可以在其中完成，即使对于非常奇特的任务，它也有大量的附加模块。顺便说一句，我有没有提到REGEXPS？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-25T19:15:12.547

我在 Perl 社区的时间还不长，我首先带来的是 Larry Wall 的幽默和智慧。诚然，Perl 有它的怪癖，但该语言来自对与我非常接近的事物的理解，因此我对 Python 和对 Ruby 的理解程度较低。

我不使用 WxPerl 做 web 应用程序的更多 GUI，它工作得很好。我对一些鲜为人知的语言也很感兴趣，比如 factor、boo、rebol 等等，但总的来说，Perl 是我的选择。这是因为强大的语法（如果你喜欢它可以非常实用）、社区、当然还有 CPAN 的混合，而且，就像我之前说的，因为在正确的地方有舒适的感觉。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-28T18:51:41.747

使用 Perl（以及 TMTOWTDI 背后的表达能力），编程变成了一项创造性的任务。如果我打算写`if($expr) { $statement; }`很多其他语句，我可以写，或者`$statement if $expr;`如果这更有意义，我可以写（例如，我喜欢写：

```
sub doSomething {
    my($toObject, $argument) = @_;

    die "No object specified" unless defined($toObject);
    die "Object invalid: $toObject" unless $toObject->ISA('Example');

    # Do stuff
} 
```

但当然，这并不总是最简单、最具表现力的方式；所以我想出了一个更好的方法来完成手头的任务！）。人们抱怨是因为 Perl 让你写出看起来很糟糕的代码；我喜欢 Perl，因为它可以让我编写*在我看来很漂亮的*代码（是的，我可以看到有十几个不同的程序员以自己的风格编写的缺点；我会坚持认为优秀的作家可以非常富有表现力和无论主题有多么不同，都可以理解）。

使用其他编程语言，我最终不得不通过抽象层来思考我的方式（这将如何`Map`给我`Collection`s`Iterator`我可以用来......等等）。使用 Perl，我通常只比基本 Perl 高一个抽象级别。例如，`DBI`将给我数据库结果作为普通的、日常的 Perl 标量、列表和散列，所以我对这些简单的核心数据结构的所有了解都适用于我执行的每项任务`DBI`（复杂的数据结构？这就是 PostgreSQL 的用途！） .

我只全职使用 Perl 大约一年，但这些对我来说是巨大的胜利，也是我在 Java 1.4 的集合模型受苦一年后第一次全职使用 Perl 的原因（不要问）。其他编程语言让我觉得我在拼拼图，因为你把所有的模块和包排列*得恰到好处*；Perl 感觉就像一个装满乐高积木的盒子，里面有一些“特殊”的积木（比如和`DBI`）。有很多不同的方法可以解决任何问题，Perl 允许您以任何您喜欢的方式尝试任何您喜欢的方法。`CGI.pm``Test::*`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-25T17:02:39.863

Perl 是它的社区，这就是在社交和实践层面上使用它的原因。（参见 CPAN 和 Perlmonks，它们可能启发了 SO。）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-28T20:31:30.703

用 Perl 编码时有很大的自由度；你可以写一些疯狂的不可读的技巧，但是一旦你对这种语言有了感觉（并且学会了如何使用 perltidy :-)），很快你就会意识到编写良好的 perl 代码可以看起来很通俗漂亮的。

这真有趣; 在大学学习系统管理员类型的工作后，我最终成为了一名全职 Perl 程序员。现在这是我最强的技能。我将继续使用 Perl 一段时间，因为到目前为止，该语言的用途广泛，可以与我一起成长。我用 Perl 编写了很多系统软件，并决定学习 Web 编程以获得乐趣，而 Catalyst 就在那里等着我。我想尝试一种新的语言范式吗？Perl 可能会支持它。相比之下，当我用 PHP 编写代码时，我立刻感觉自己就像在压在玻璃天花板上。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-29T02:29:46.553

我在俄亥俄州南部的一家大型组织担任技术故障排除人员。我不得不学习 Perl 来保持一些自动化的网络文本操作系统的正常运行，最终我对它有点兴奋。我最终认为自己是一名开发人员，并编写了一些程序来解析一些数据库数据并让一些人的生活变得更轻松一些。但是在阅读了本网站上的一些帖子并收听了 stackoverflow 播客，甚至开始阅读某人建议的阅读列表中的 Code Complete 这本书之后，我不再有任何妄想我是 Perl 或任何其他语言的开发人员。 . 然而，也许有一天我可以。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-25T15:09:21.607

简单的语法，强大的 win32 和 unix 系统脚本功能，以及完全强大的正则表达式！

我在第一份工作中选择了 Perl，我必须为电气工程师编写大量自动化脚本来挖掘数据日志并将它们格式化为 Excel，有时还要处理 sql server。使用 Perl，我通常可以很快得到一些东西，所以在制造领域一切都很好。:P

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-25T17:53:42.163

我曾经使用 awk 几次作为 shell 脚本的方式，很久以前。在一个古老的项目中，我们需要实现一个 TELNET 协议连接，所以我用 Perl 4 编写了一个快速版本。它运行得非常好，我开始非常喜欢这种语言。

后来，我用 Perl 5 编写了一个完整的大型商业 Web 应用程序，并带有它自己的框架和数据库。我小心翼翼地不使用 Perl 的许多更深奥的特性，所以代码看起来更像 C 而不是 Perl。它工作得很好，性能很好，代码很容易扩展。

最近我一直在使用 Java，但我经常发现自己缺少 Perl 的松散类型，以及它比 Java 更好地封装事物的能力。我最喜欢的功能是能够将 Perl 数据结构（数组和哈希）和代码直接放入配置文件并执行它们，以及将代码与数组等语法联系起来的能力。两者都会导致一些非常漂亮的代码。

保罗。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-07-23T02:02:53.583

我开始使用 Perl 来增强我们的嵌入式开发构建过程。我们需要基于交叉编译的有效负载开发各种输出，而 Perl 非常适合。

我们的增强功能包括浮点到十六进制转换、S 记录后处理和校验和修改。

并不是说这种工作不能用许多其他工具来完成，但我肯定会推荐 Perl 用于与构建相关的工作。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-07-03T17:38:32.807

当我看到[DBI](http://search.cpan.org/dist/DBI/DBI.pm)并意识到我可以用五分之一的时间编写我当时正在编写的 ESQL/C 程序时，让我接触到 Perl。

让我一直使用 Perl 的原因是，其他两种可能取代它的语言都是强类型的。那是

```
print "10" + 5; 
```

是类型错误而不是 15。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-25T15:38:38.613

我*不*接受它。几年前我不得不在 Perl 上做一个项目，我开始非常不喜欢这种语言。它有一个有时很尴尬的语法和很多我发现很难处理的疯狂陷阱。老实说，我认为 Ruby 在许多方面已经取代了 Perl：它擅长的事情大致相同，但具有更好的特性并且更易于使用。

不过，Perl 仍然有 CPAN，它甚至 Ruby 都无法比拟（尽管 Ruby 也有很多有用的库）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-05T03:59:54.223

去年我考虑学习 Perl。

这是我积极决定不学习的唯一技术。这与语言本身并无直接冲突，只是似乎我来晚了 10 年。它对于为其设计的 shell 脚本任务非常有用，但对我个人而言，我更喜欢具有更强连贯性的语言。

Perl 6 似乎处于无限期的中断状态，即使它到来，我也不相信它会使该语言更加引人注目。

另外，拉里沃尔让我害怕。

对于我的情况，Perl 不是正确的选择，这就是原因。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2008-12-25T18:59:01.970

Perl 并没有我想象的那么糟糕。大约一年前，我曾经在几个客户脚本中使用它，甚至变得有点喜欢它。再说一次，从那以后我再也没有错过它。

原因？它主要是一种只写的语言。超过 100 行的解决方案让我对自己的代码保持警惕，这绝对不是一个好的结果。对于其他语言，bar 相当高（可能是 1000 或 10000 行）。

我认为没有理由在 2009 年的新项目、新用户中使用 Perl。

# html - 在内容上方显示 flash

> ID：392790
> 
> 赞同：0
> 
> 时间：2008-12-25T12:56:51.920
> 
> 标签：html, css, flash, z-order

我有一个带有教程的页面（[http://www.poromenos.org/tutorials/bittorrent/download](http://www.poromenos.org/tutorials/bittorrent/download)），但是站点布局掩盖了 Flash 播放器，它太宽了。有没有办法通过 z 顺序（或其他东西，lightbox-y）在内容上方显示闪光灯？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T13:51:41.950

您可以将 IFrame 与播放器放在一起 - 它会高于所有页面内容

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T14:02:21.040

我肯定会建议使用灯箱。如果您只是尝试在 z-index 中将其推高，您将涵盖导航，这将导致您出现可用性问题。我是[FancyBox](http://fancy.klade.lv/)的忠实粉丝——它非常快捷方便，而且它使用了您已经在使用的 jQuery。查看下载页面，您可以看到带有 Flash 示例的内联内容的详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T15:02:12.430

灯箱是一个好方法。或者您可以添加视频链接或优化播放器的大小。

# licensing - 保护 C++ 中的许可实施

> ID：392791
> 
> 赞同：2
> 
> 时间：2008-12-25T12:59:10.447
> 
> 标签：licensing

有哪些方法可以保护 C/C++ 中的许可执行机制？

我知道：

*   使用宏（但这会使代码难以维护）
*   静态链接
*   混淆符号名称

我不确定的其他方法：

*   使用 C++ 模板
*   使用内联函数

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-25T13:33:27.150

保持代码尽可能干净并依靠第三方工具来保护代码通常是个好主意。google for "c++ obfuscator" 可以找到这样的工具。

# wcf - 在部分信任主机上托管 WCF 服务

> ID：392794
> 
> 赞同：1
> 
> 时间：2008-12-25T13:06:25.160
> 
> 标签：wcf, wcf-hosting

我正在尝试将我的 WCF Web 服务部署到免费主机以对其进行测试，但它给了我以下错误：

> **名称为 WSDualHttpBinding 的绑定验证失败，因为部分信任不支持绑定类型 System.ServiceModel.WSDualHttpBinding。考虑使用 BasicHttpBinding 或 WSHttpBinding，或者在完全信任的环境中托管您的应用程序。**

任何想法如何将我的托管环境设置为完全信任或任何其他方式来解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-18T18:17:37.843

托管环境设置为部分信任，这样您的代码就不会干扰其他人的代码。您无法提升托管环境授予您的权限。

这意味着您只能使用 BasicHttpBinding、BasicHttpContextBinding、WebHttpBinding、WSHttpBinding、WSHttpContextBinding 和 WS2007HttpBinding。

您将您的网站设置为使用中等信任（很可能是您的主机正在使用的），以便您可以在本地测试您的网站，并使用与主机强制相同的限制。添加到您的 web.config 以执行此操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-06-03T10:13:11.083

非常简单，只需将以下几行添加到您的 web.config 文件中

```
 <configuration> 
  <system.web> 
    <trust level="Full" /> 
  </system.web> 
  </configuration> 
```

# javascript - Firefox 中的跨站点 XmlHttpRequest？

> ID：392796
> 
> 赞同：3
> 
> 时间：2008-12-25T13:09:17.917
> 
> 标签：javascript, api, firefox, xmlhttprequest

我理解（我认为） XmlHttpRequest 对象遵守“同域”策略。但是，我想创建一个简单的 (POC) 本地 html 文件，该文件从 Web 服务器下载 XML 并对其进行处理（让我们从一个简单的“alert()”开始）。

有可能吗？我需要一个特殊的 Firefox 配置选项吗？

我尝试下载的服务器**不在**我的控制之下（它实际上是一个 Google API）。

我的简单尝试是来自[Mozilla 的“使用 XMLHttpRequest”页面](https://developer.mozilla.org/En/Using_XMLHttpRequest#Example.3a.c2.a0Synchronous_request)的代码。它从“发送”方法返回一个我不太了解的错误。

免责声明：我主要是一名 C/C++ 开发人员——从未做过任何严肃的 JS 编程，从未尝试过使用这些 API。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-25T13:24:05.577

XMLHttpRequest 实际上遵循更严格的相同域策略实现：虽然您可以设置 document.domain 属性以允许来自两个子域的 JavaScript 相互通信，但您不能使用 XMLHttpRequestObject 做到这一点。在你的情况下，去一个完全不同的域，你也不能用 JavaScript 做到这一点。

有几个选项。首先，您可以使用反向代理使外部站点看起来是您站点的子域。看看 Apache 的 mod_proxy，特别是 ProxyPassReverse

另一种选择是将数据作为 JSON 对象返回：<script src="foo"> 可以从任何它想要的地方检索它想要的任何数据。这样做的缺点是它不是（很容易）可重复的（就像来自同一页面的多个请求一样）。

我还建议您使用 Google 搜索“google mashups”。其中大部分位于“googlemashops.com”域上，这使得实施变得更加容易。一些人住在该领域之外，可能会给你一些想法。

编辑：而不是直接使用 XMLHttpRequest 对象，我建议通过第三方库，例如prototype.js

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T13:24:25.217

如果您尝试检索的 XML 由 Google 的 JS API 之一返回，则不需要 XmlHttpRequest（因为它只能在与您的页面相同的域上使用）。

因此，在使用 Google API（例如 Maps API）的情况下，通常首先在页面某处添加对其通用 API 的引用：

```
<script type="text/javascript" src="http://www.google.com/jsapi?key=your_google_api_key"></script> 
```

然后在页面中添加对您计划使用的特定 API 的引用：

```
<script type="text/javascript">google.load("maps", "2");</script> 
```

现在您可以调用该 API 提供的各种函数：

```
<script type="text/javascript">
  function initialize() {
    var map = new google.maps.Map2(document.getElementById("map"));
    map.setCenter(new google.maps.LatLng(41.86, 87.68), 13);
  }
  google.setOnLoadCallback(initialize);
</script> 
```

不需要 XmlHttpRequest :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-28T14:37:44.173

您可以使用 JSONP 来执行此操作。我在[这里](http://os.adamaltemus.com/social-actions/)使用 jQuery 和 PHP。基本上我使用 PHP 代理来包装 JSON 回复，以便 jQuery 可以处理它。它在BSD下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-28T14:24:34.317

或者尝试使用 IE8。如果您从磁盘而不是网站运行，IE8 将忽略所有正常的域限制并获取您想要的数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-21T14:08:00.683

使用 jQuery（可能还有 XHR，但我尽量不直接使用它），您可以愉快地进行跨域请求，前提是您不指定不寻常的标头或非 GET 方法。如果您确实想使用这些，您必须控制服务器以启用 OPTIONS 请求。

有关详细信息，请参阅[https://developer.mozilla.org/En/HTTP_access_control](https://developer.mozilla.org/En/HTTP_access_control)。

# objective-c - 如何使用 Cocoa 在我的 Dock 图标上绘制徽章？

> ID：392797
> 
> 赞同：27
> 
> 时间：2008-12-25T13:15:11.790
> 
> 标签：objective-c, macos, cocoa, badge, nsdocktile

如何使用 Cocoa 为我的应用程序的 Dock 图标添加徽章？是否有任何大致“标准化”的方式来做到这一点？

（我指的是出现在 Mail、iChat 等中的徽章类型，以指示未读消息的数量等。）

Cocoa Touch 确实提供了一种这样的方法，但我还没有找到任何与常规 Cocoa 应用程序等效的方法。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-12-12T06:30:31.137

采用

```
 [[[NSApplication sharedApplication] dockTile] setBadgeLabel:@"2234"]; 
```

该方法和`NSDockTile`该类自 Leopard 以来就已可用。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-26T03:51:47.540

需要注意的是，NSDockTile 仅在 Leopard 上可用。如果您需要以 Tiger 为目标，您需要`-setApplicationIconImage:`在您的 NSApplication 对象上使用并手动绘制您的徽章。

此外，它不在我可以找到的发行说明之外的文档中，但是您可以通过将`dockTile`消息发送到您的 NSApplication 对象来获取应用程序的停靠图块。

```
NSDockTile *tile = [[NSApplication sharedApplication] dockTile];
[tile setBadgeLabel:@"Lots"]; 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-12-25T14:34:07.463

一个快速的谷歌搜索出现了[NSDockTile](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/NSDockTile_Class/Reference/Reference.html "NSDockTile 文档")类。一旦你看了一下文档，这似乎是不言自明的。

# datatable - 您更喜欢哪一个来搜索/报告 DataTable 或 DTO 或域类？

> ID：392806
> 
> 赞同：3
> 
> 时间：2008-12-25T13:34:30.440
> 
> 标签：datatable, domain-driven-design, dto

我目前正在从事的项目需要大量搜索/过滤页面。例如，我有一个复杂的搜索页面，可以按数据、类别、单位、...

问题域类很复杂，包含大量的值对象和子对象。

.我想知道人们如何处理 UI 的搜索/过滤/报告。据我所知，我有 3 个选择，但没有一个能让我更快乐。

1.) 将参数发送到 Repository/DAO 以获取 DataTable 并将 DataTable 绑定到 UI 控件。例如到 ASP.NET GridView

```
DataTable dataTable =issueReportRepository.FindBy(specs);
.....
grid.DataSource=dataTable;
grid.DataBind(); 
```

在这个选项中，我可以简单地通过域层并查询给定规格的数据库。而且我不必完全构建复杂的域对象。不需要值对象，子对象，.. 直接从数据库中获取数据以显示在 UI 中的 DataTable 中并显示在 UI 中。

但是如果必须在 UI 中显示计算字段，例如方法返回值，我必须在数据库中执行此操作，因为我没有完整的域对象。我必须复制逻辑和 DataTable 问题，比如没有智能感知等......

2.) 将参数发送到 Repository/DAO 以获取 DTO 并将 DTO 绑定到 UI 控件。

```
IList<IssueDTO> issueDTOs =issueReportRepository.FindBy(specs);
....
grid.DataSource=issueDTOs;
grid.DataBind(); 
```

在此选项中与上述相同，但我必须为每个搜索页面创建贫血的 DTO 对象。另外对于不同的问题搜索页面，我必须显示问题对象的不同部分。IssueSearchDTO、CompanyIssueTO、MyIssueDTO ....

3.) 将参数发送到 Real Repository 类以获得完全构造的域对象。

```
IList<Issue> issues =issueRepository.FindBy(specs);
//Bind to grid... 
```

我喜欢领域驱动设计和模式。此选项中没有 DTO 或重复逻辑。但在此选项中，我必须创建许多子对象和值对象，这些对象不会在 UI 中显示。此外，它还需要大量的 ob 连接才能获得完整的域对象和针孩子的性能成本对象和值对象。

我不使用任何 ORM 工具也许我可以为这个版本手动实现延迟加载，但它似乎有点矫枉过正。

你更喜欢哪一个？还是我做错了？有什么建议或更好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T04:08:38.980

我有一些建议，但当然总体答案是“视情况而定”。

首先，您应该使用 ORM 工具，或者您应该有充分的理由不这样做。

其次，手动实现延迟加载相对简单，所以如果您不打算使用 ORM 工具，您可以简单地在对象上创建属性，例如：

```
private Foo _foo;
public Foo Foo
{  
  get {  
         if(_foo == null)
         {
            _foo = _repository.Get(id);
         }
         return _foo;
       }
} 
```

第三，性能是最初应该考虑的东西，但不应该让你远离优雅的设计。我认为您应该最初使用 (3) 并且仅在其性能不足时才使用它。这会导致编写最少的代码并在您的设计中具有最少的重复。

如果性能受到影响，您可以在 UI 层使用缓存和/或在您的域层使用延迟加载轻松解决它。如果这两者都不能提供可接受的性能，那么您可以退回到 DTO 方法，在这种方法中，您只传回所需的轻量级值对象集合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-05T15:01:40.590

这是一个*很好的*问题，我也想提供我的答案。我认为*技术上最好*的答案是选择选项#3。它提供了最好地描述和组织数据的能力以及可扩展性，以便将来增强报告/搜索请求。

*然而*，虽然这可能是总体上最好的选择，但与其他 (2) 个选项相比，IMO 的成本很高，这些选项是支持报告需求所需的所有类和关系的额外设计时间（同样在假设存在没有使用 ORM 工具）。

我在很多应用程序中也遇到了这个问题，而现实情况是＃2 是时间和设计之间的最佳折衷方案。现在，如果您询问您的商务对象及其所有需求，那么**毫无**疑问，一个完全布局和适当设计的模型很重要，并且没有替代品。但是，当涉及到向我报告和搜索时，这是另一种动物。#2 在贫血类中提供强类型数据，不像 #1 这样的 DataSet 中的硬编码值那么原始，并且与 #3 相比仍然大大减少了完成设计所需的时间。

理想情况下，我很想扩展我的对象模型以涵盖所有报告需求，但有时这样做所需的工作量非常大，以至于为报告需求创建一组单独的类是一个更容易但仍然可行的选择。几年前我实际上问了几乎相同的问题，并且还被告知为报告需求创建另一组类（本质上是 DTO）并不是一个糟糕的选择。

所以总结一下，#3 在技术上是最好的选择，但在综合考虑时间和质量来满足复杂的报告和搜索需求时，#2 可能是最现实和可行的选择。

# apache-flex - 德格拉法换色器

> ID：392808
> 
> 赞同：1
> 
> 时间：2008-12-25T13:42:31.140
> 
> 标签：apache-flex, degrafa

```
<degrafa:LinearGradientFill id="bluedream">
    <degrafa:GradientStop color="#6ab5d0"/>
    <degrafa:GradientStop color="#388aae"/>
</degrafa:LinearGradientFill>

<degrafa:GeometryComposition graphicsTarget="{[bgCanvas]}">
    <degrafa:RoundedRectangle id="color_preset" fill="{bluedream}"/>
</degrafa:GeometryComposition> 
```

我有 degrafa 代码的问题，我已经为 color_preset.fill 定义了一组不同的渐变，当用户在组合框中选择不同的颜色时动态变化。

我替换`fill="{bluedream}"`为`fill="using_variable"`并导致错误编译消息：“填充”的初始化程序：类型的值`com.degrafa.core.IGraphicsFill`无法在文本中表示。

有没有办法将此代码用作换色器？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-28T04:48:30.530

您示例中的填充属性指向 ID 为“bluedream”的 LinearGradientFill。您可以用不同的渐变（或纯色或其他填充）替换填充，也可以更改渐变填充本身的颜色：

```
<degrafa:LinearGradientFill id="bluedream">
    <degrafa:GradientStop color="{your_combobox.selectedItem}"/>
    <degrafa:GradientStop color="{your_other_combobox.selectedItem}"/>
</degrafa:LinearGradientFill>

<degrafa:GeometryComposition graphicsTarget="{[bgCanvas]}">
     <degrafa:RoundedRectangle id="color_preset" fill="{bluedream}"/>
</degrafa:GeometryComposition> 
```

我没有运行该代码，但它应该可以工作。我们的想法是使用下拉列表的 selectedItem 更改 GradientStop 的颜色（前提是它是一个字符串）。这个例子做了一些非常相似的事情，但使用颜色选择器而不是下拉列表： http: [//degrafa.org/source/CS4IconPreviewer/CS4IconPreviewer.html](http://degrafa.org/source/CS4IconPreviewer/CS4IconPreviewer.html)

# cygwin - 我应该使用 Cygwin 安装哪些软件包以使其不臃肿，而且还拥有作为开发人员所需的一切？

> ID：392812
> 
> 赞同：38
> 
> 时间：2008-12-25T13:48:38.897
> 
> 标签：cygwin

通常，我在 VM 中运行 Linux，但是，我的大多数 VM 都在外部 HDD 上，我可能有也可能没有。当我需要类似 Linux 的东西并且我的笔记本电脑上没有虚拟机时，我认为 Cygwin 将是轻量级功能的一个很好的选择。但是我无法正确配置-我想要开发的最低限度+ X11。有没有人以这种方式使用过 Cygwin？如果有，你有什么建议？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2015-03-27T01:31:50.310

*更新：自发布此答案以来，我已切换到[WSL 。](https://docs.microsoft.com/en-us/windows/wsl)如果您仍在使用 Cygwin，请尝试一下。它不是直接替代品，但在许多方面都更好。*

就个人而言，我发现不得不退出 Cygwin 只是为了安装新软件包，这很烦人，以至于试图避免即时策略，幸运的是有一个工具可以让这变得更容易：[`apt-cyg`](https://github.com/transcode-open/apt-cyg). 这样，您实际上可以即时安装软件包，而无需退出 Cygwin。

也就是说，这里是您可能想要安装的常用软件包的列表，无论是通过安装程序还是通过`apt-cyg`：

*   `bash-completion`
*   `lynx`（安装`apt-cyg`），`wget`和`curl`
*   `vim`
*   `hg`, `git`, 也许`svn`和`git-svn`
*   `diffutils`和`patchutils`
*   `python`和`python3`

互联网上也有大量 Cygwin 设置帖子，我引用[了这个](http://guysherman.com/2013/11/02/my-ultimate-cygwin-setup/)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-25T14:52:38.440

第一个选项：不要担心“膨胀” - 安装所有想到的东西。

通过永久可用的 Internet 连接，我还采取了“及时”的方法——Cygwin 安装程序可以在您发现需要时轻松下载和安装任何您需要的东西。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-03T17:44:39.310

这里唯一的方法是反复试验。从绝对最小的安装开始，并在您发现需要时添加内容。

# c# - 通过c#刷新并保存excel文件

> ID：392818
> 
> 赞同：3
> 
> 时间：2008-12-25T13:57:27.243
> 
> 标签：c#, excel

我使用此代码打开刷新保存并关闭 excel 文件：

```
Application excelFile = new Application();               
Workbook theWorkbook = excelFile.Workbooks._Open(Environment.CurrentDirectory + "/WebGate", 0, false, 5, System.Reflection.Missing.Value, System.Reflection.Missing.Value, false, System.Reflection.Missing.Value, System.Reflection.Missing.Value, true, false, System.Reflection.Missing.Value, false);    
Sheets sheets = (Sheets)theWorkbook.Worksheets;    
theWorkbook.RefreshAll();    
theWorkbook.Save();    
excelFile.Quit(); 
```

问题是刷新和保存命令之间存在冲突，因为在后台完成刷新时文件被保存（我猜）有人可以帮我吗？我需要知道如何知道刷新过程何时完成或任何其他有助于我决定何时保存文件而不损害刷新过程的指示

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-26T21:05:00.777

我不熟悉 C#，但我擅长 Excel VBA。这里的问题是大多数数据透视表都将 BackgroundQuery 属性设置为 True，从而使数据透视表异步刷新，以便 Excel 文件在最终用户使用时做出响应。如果您在处理文件期间没有添加任何新的数据透视表，那么您可以通过取消选中外部数据选项下数据透视表->表设置->BackgroundQuery 中的 BackgroundQuery 来修复文件一次。如果要添加数据透视表，则需要将此属性设置为 false，例如

```
Dim oPivot As PivotTable
set oPivot=worksheets("xyz").PivotTables("Pivot1") 
oPivot.PivotCache.BackgroundQuery = False 
```

如果您不确定要修复哪个表并且您的 excel 中有很多表，请使用 Excel VBA 中的以下代码来修复它。

```
Public Sub FixPivotTables()
    Dim oPivot As New PivotTable, oSheet As Worksheet
    For Each oSheet In ThisWorkbook.Worksheets
        For Each oPivot In oSheet.PivotTables
            oPivot.PivotCache.BackgroundQuery = False
        Next
    Next
End Sub 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-26T20:11:35.050

同样，我查看了文档，这就是我能说的。

获取您正在刷新的 QueryTable 对象。它有一个名为“AfterRefresh”的事件，您可以使用它来执行任何操作。

此外，不要对工作簿进行刷新，而是对特定的 QueryTable 进行刷新（除非您有多个 QueryTable）。QueryTable 有一个 Refresh 方法，该方法接受一个名为 BackGroundQuery 的布尔参数，您可以将其设置为 False。

我想，这将同步查询记录。
那对你有用吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-25T18:43:27.633

Eran，我是根据我对文档的理解发布的。

我假设您正在使用数据透视表，并且它使用某种查询。
尝试使用 Workbook 对象的 PivotTableCloseConnection 并查看是否可以在其中调用 Save。

在 Excel 2007 中，Application 对象具有 AfterCalculate 事件 - 这也可能有用。

如何模拟这种情况？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-10T15:47:16.710

尝试使用：

```
this.Application.ActiveWorkbook.RefreshAll();
this.Application.ActiveWorkbook.Save(); 
```

如有必要，请使用该`.ReCalculate()`操作。

# c# - 如何禁用 BindingNavigator 上的工具条？

> ID：392825
> 
> 赞同：1
> 
> 时间：2008-12-25T14:07:01.730
> 
> 标签：c#, toolstripitem

我想以编程方式启用或禁用绑定导航器上的工具条。

当我尝试设置 toolStripitem 的 enable 属性时，它不会改变。它没有给出任何异常，但 Enable 属性的值不会改变。

我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-26T08:57:10.467

控制这些按钮本身，以根据`BindingNavigator`需要启用/禁用它们；即，如果没有更多数据，您将无法进行上一个/下一个，如果没有底层源允许您（`IBindingList.AllowNew`/ `.AllowRemove`.

您要调整哪些按钮？例如，您可以通过使用数据源来禁用添加/删除，例如`BindingList<T>`, 和设置`AllowNew=false`/ `AllowRemove=false`。

或者，只需完全编写自己的按钮（忘记`BindingNavigator`） - 这不是很多工作，特别是如果您从`BindingSource`表单上的 a 开始（因为它具有所有必要的`MoveFirst()`等。

# c# - C# 中两种不同的窗体

> ID：392832
> 
> 赞同：2
> 
> 时间：2008-12-25T14:17:50.197
> 
> 标签：c#, winforms, login, screen

我是 C# 和 .NET 编程的新手。我想设计一个打开一个小的登录屏幕的应用程序，当用户按下“登录”按钮时，我的程序应该关闭登录表单并传递给一个新表单。我怎样才能实现这个简单的过程？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-25T14:48:25.517

这可能是一个解决方案；

在登录表单中；

```
public bool IsLoggedIn { get; private set;}
public void LoginButton_Click(object sender, EventArgs e)
{
  IsLoggedIn = DoLogin();
  if(IsLoggedIn)
  {
    this.Close()
  }
  else
  {
    DoSomethingElse();
  }
} 
```

在 program.cs 中

```
static void Main()
{
  Application.EnableVisualStyles();
  Application.SetCompatibleTextRenderingDefault(false);
  LoginForm loginForm = new LoginForm();
  Application.Run(loginForm);
  if (loginForm.IsLoggedIn)
  {
    Application.Run(new OtherForm());
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T15:43:55.093

根据应用程序的整体架构，我经常喜欢让主表单控制启动登录屏幕。

```
 //Program.cs:
    [STAThread]
    static void Main()
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new MainForm());
    }

    //MainForm.cs
    private void MainForm_Load(object sender, EventArgs e)
    {
        this.Hide();
        Login login = new Login();
        if (login.ShowDialog() == DialogResult.OK)
        {
            //make assignments from login
            currentUser = login.User;
        }
        else
        {
            //take needed action
            Application.Exit();
            return;
        }
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T15:04:32.160

这里的挑战是传递给 Application.Run() 方法的形式。如果您使用登录表单的实例启动应用程序，然后关闭该表单，我相信应用程序将退出。毫无疑问，有几种方法可以处理这个......

一种方法是将主表单的实例传递给 Application.Run 方法（这会将消息循环与该表单实例而非登录表单联系起来）。在主窗体的 OnLoad 方法中，您可以使用模式对话框来执行登录。IE

```
//--Main form's OnLoad method
protected override void OnLoad(EventArgs ea)
{
    // Remember to call base implementation
    base.OnLoad(ea);

    using( frmLogin frm = new frmLogin() )
    {
        if( frm.ShowDialog() != DialogResult.OK )
        {
            //--login failed - exit the application
            Application.Exit();
        }
    }       
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T18:23:52.210

如果您确实使用了 .ShowDialog()，请不要忘记将其包裹在 using 块中，或者在完成后在登录表单上使用 .Dispose。模型对话框必须手动处理。

# ruby-on-rails - 允许使用 MarsEdit/Ecto/etc 发布到 Rails 站点的最简单方法？

> ID：392833
> 
> 赞同：2
> 
> 时间：2008-12-25T14:18:32.503
> 
> 标签：ruby-on-rails, api, xml-rpc

我有一个简单的站点，使用 restful_authentication 和一个简单的帖子模型。我想使用[MarsEdit](http://en.wikipedia.org/wiki/MarsEdit)（或类似[Ecto](http://illuminex.com/ecto/)的东西）来发布/编辑内容。我该怎么办？

XML-RPC 系统相当令人困惑——有很多不同的变体（Atom、MovableType、metaWeblog、Blogger、TypePad，可能还有其他），更不用说实际实现它们中的任何一个了。Rails 中的 Action Web 服务 API，它的目的是实现这样的 API，前一阵子已经弃用了..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T09:50:49.703

试试插件...

[http://github.com/calavera/atompub-server/tree/master](http://github.com/calavera/atompub-server/tree/master)

或者这个图书馆...

[http://github.com/inkspot/alumina/tree/master](http://github.com/inkspot/alumina/tree/master)

作为您需要的入门/原型

# .net - 如何将 .NET DateTimeOffset 转换为 Sql2008 DateTimeOffset

> ID：392839
> 
> 赞同：6
> 
> 时间：2008-12-25T14:31:12.010
> 
> 标签：.net, sql-server-2008, datetimeoffset

我不确定如何将 .NET`DateTimeOffset`变量正确格式化为字符串，以便 SqlServer 2008 正确解析值。

目前，如果我从正常的 DateTimeOffset 值中提供默认`.ToString()`值，则会出错。

这是一个错误的示例`.ToString()`值（例如，Sql2008 不喜欢它）：`'25/12/2008 2:12:21 PM +00:00'`

## 更新

只是为了澄清，我知道`.ToString()`它不是兼容的 Sql2008 格式。我希望有人能够告诉我需要为新SqlDataType合法的`IFormattableProvider`参数（用于`.ToString()`方法）提供什么。`DateTimeOffset`

## 回答

我自己已经回答过了。我找到了正确的 IFormattableProvider 参数

`myDateTimeOffest.ToString("yyyy-MM-dd HH:mm:ss.ffffff zzz")`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-25T16:45:26.513

根据[BOL](http://msdn.microsoft.com/en-us/library/bb675168.aspx)，这些类型是兼容的。

你收到什么错误？您是否在连接字符串中将类型系统版本指定为 2008？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-25T15:09:12.947

[DateToOffset.ToString](http://msdn.microsoft.com/en-us/library/bb351892.aspx)支持传入格式字符串来控制输出。尝试传入与 SQL 2008 兼容的格式字符串

# iphone - 在被黑的 iPhone 上开发 iPhone

> ID：392845
> 
> 赞同：4
> 
> 时间：2008-12-25T14:37:19.750
> 
> 标签：iphone

您知道，在中国大陆等其他国家/地区的 iPhone 从经销商处购买时总是被黑客入侵。我可以通过官方 SDK 在被黑的 iPhone 上开发自定义应用程序吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-25T14:39:19.810

是的，您可以使用 Xcode 在越狱的 iPhone 上开发和调试您的应用程序。你甚至不需要支付 99 美元就可以做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T15:45:54.760

只要您的 iPhone 运行固件 2.0 或更高版本，您就可以使用官方 SDK 开发您的应用程序并使用*ldid*工具来伪造代码签名过程。然后，您的 iPhone 将能够正常运行该应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T16:56:20.580

您可以从 Apple 网站获取 SDK，但这确实需要使用 Mac。您可以使用 Hackintosh 或 VMWare，但这并不完全合法。

# c# - C# 线性代数库

> ID：392857
> 
> 赞同：51
> 
> 时间：2008-12-25T14:51:49.050
> 
> 标签：c#, .net, linear-algebra, nmath

C# 是否有稳定的线性代数（更具体地说，向量、矩阵、多维数组和它们的基本运算）库？

搜索产生了一些开源库，这些库要么几年没有更新，要么处于早期测试阶段——还有 Centerspace NMath。哪些替代方案值得检查？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-25T19:35:44.297

[数学.NET](http://numerics.mathdotnet.com/)。我们在生产中使用它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-02-08T14:38:36.643

见：[http ://en.wikipedia.org/wiki/List_of_numerical_libraries](http://en.wikipedia.org/wiki/List_of_numerical_libraries)

[http://www.alglib.net/](http://www.alglib.net/) - 开源。多语言库。

[http://www.mathdotnet.com/](http://www.mathdotnet.com/) - 开源。正如其他人所提到的。dnAnalytics 在此被[http://numerics.mathdotnet.com/](http://numerics.mathdotnet.com/)取代。

[http://www.lutzroeder.com/dotnet/](http://www.lutzroeder.com/dotnet/) - Lutz Roeder 有一个 LAPACK 的开源端口 Mapack.Net。

[http://www.extremeoptimization.com/](http://www.extremeoptimization.com/) - 商业。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-06-21T07:53:29.007

我正在使用 ILNumerics.NET

[www.ilnumerics.net](http://www.ilnumerics.net)

很好的支持和稳定。虽然我没有任何可比性。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-18T20:32:20.787

我们对 nMath 进行了评估，并对它的可编程性和速度感到非常满意。他们的支持人员甚至工作了一个周末来找出我们发现的错误。我们喜欢他们使用英特尔的内核数学库而不是滚动他们自己的数字。[编辑添加：多年来一直在生产中使用]

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-23T20:12:57.323

几周前，我发现一个新的 c# 库[FinMath](https://rtmath.net/products/finmath/)包含许多不同方法和技术的实现，包括基本的线性代数，例如：

1.  矢量和矩阵实现（易于使用的高级接口，涵盖了大部分[BLAS](http://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms)功能）
2.  矩阵分解算法（LU、QR、SVD、Cholesky）。

还有许多其他有用的东西，如统计、因子和聚类分析、线性和二次规划求解器等。

不幸的是，它不是免费的，但速度非常快，因为它使用[MKL](http://en.wikipedia.org/wiki/Math_Kernel_Library)进行最复杂的计算，同时它作为单个库分发，支持 32 位和 64 位模式，并且不需要特殊维护即可使用，例如照顾原生库。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-25T15:02:16.410

你看过[dnAnalytics](http://www.codeplex.com/dnAnalytics)吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-18T21:35:07.393

虽然它没有更新、不是开源的，也没有用于商业用途，但人们可能想从 Microsoft Research 中查看 D*。它是一个非常酷的*符号*数学库，尤其是对于做导数，但实际上它是一个 .NET 程序员手中的一个小 matlab。

[http://research.microsoft.com/en-us/downloads/4714703d-782c-4e37-830d-0e3b7662f743](http://research.microsoft.com/en-us/downloads/4714703d-782c-4e37-830d-0e3b7662f743)

# c - 产生堆栈溢出

> ID：392859
> 
> 赞同：0
> 
> 时间：2008-12-25T15:00:07.553
> 
> 标签：c, linux, stack-overflow

如何在 GNU/linux 中创建堆栈溢出的条件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-25T15:07:30.033

一个没有出路的递归函数应该可以解决问题

伪代码，我的 c 有点生疏了

```
void stack_overflow()
{
   stack_overflow();
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-25T16:34:18.127

我建议阅读 phrack 杂志的文章[“为了乐趣和利润而粉碎堆栈”](http://www.phrack.org/issues.html?issue=49&id=14#article)。它还包含示例代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-25T15:07:24.620

维基百科文章中有[代码示例](http://en.wikipedia.org/wiki/Stack_overflow)。为什么你要造成一个超出我的...

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-25T15:08:23.510

您只需要考虑在 C 中使用堆栈的是什么。

*   动态内存分配（带`malloc()`）使用堆；
*   局部变量和函数调用堆栈使用堆栈。

所以，你所要做的就是耗尽堆栈。函数上的无限递归或大型局部变量创建（尽管超出范围，但不要让它们被清理）应该这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-25T15:29:32.250

使用 alloca() 或 strdupa()

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-04T21:50:47.583

在其他答案中已经提到了很多例子。但每个人似乎都错过了这一点。

要强制堆栈溢出，需要了解堆栈的大小。在 linux 中，堆栈的默认大小是 8MB。

```
 ulimit -a         //would give you the default stack size 
 ulimit -s 16384   // sets the stack size to 16M bytes 
```

因此，如果您将堆栈大小调整到那么小，即使使用 100 个整数的数组也可以强制堆栈溢出。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-26T11:32:15.443

最简单的方法就是声明一个足够大的自动堆栈变量。不需要递归或分配。有趣的是，这不是编译时错误。所需尺寸因平台而异：

```
#define SIZE 10000000

int main(int argc, char **argv)
{
    char a[SIZE];
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-26T12:23:22.563

《如何在linux中创建堆栈溢出的条件》

与在 Windows 上创建堆栈溢出的方式相同。

Jason 的答案可能有效，但一些编译器通过将其优化为循环。我认为添加 aa 参数可以解决问题：

```
 int Add(int num)
    {
        num += Add(num);
        return num;
    } 
```

# c# - 启动画面等待线程完成

> ID：392864
> 
> 赞同：20
> 
> 时间：2008-12-25T15:06:16.730
> 
> 标签：c#, winforms, splash-screen

我仍然有启动画面的问题。我不想使用该属性`SC.TopMost=true`。

现在我的应用场景如下：

**在 progeram.cs 中：**

```
[STAThread]
static void Main()
{
    new SplashScreen(_tempAL);// where _tempAL is an arrayList
    Application.Run(new Form1(_tempAL));
} 
```

**在 SplashScreen 类中：**

```
public SplashScreen(ArrayList _Data)
{
    DisplaySplash()
} 
private void DisplaySplash()
{
    this.Show();
    this.TopMost = true;
    this.CenterToScreen();
    this.SetTopLevel(true);

    _allServerNarrators = new string[10];
    for (int i = 0; i < _allServerNarrators.Length; i++)
        _allServerNarrators[i] = null;

    GetFromServer();

    this.Hide();
    _serverData = new ArrayList();
    _thisData.Add(_allServerNarrators);
    _thisData.Add(_serverNarrators);

}
private void GetFromServer()
{
    _serverNarrators = new ArrayList();
    string _file = "Suras.serverNar";

    if (!Directory.Exists("c:\\ASGAQuraan"))
        Directory.CreateDirectory("c:\\ASGAQuraan");

    while (counter < 4 && _serverFiles == null)
    {
        if (Download("c:\\ASGAQuraan", _ftpServerIP, _file))
        {
            StreamReader _strReader = new StreamReader
                         ("c:\\ASGAQuraan\\"+_file,System.Text.Encoding.Default);
            string _line = _strReader.ReadLine();
            string _word;

            while (true)
            {
                while (_line != null)
                {
                    _word = _line.Substring(0, _line.IndexOf("*"));
                    int _narId = Convert.ToInt32(_word);
                    _line = _line.Substring(2);
                    int k = 0;
                    _serverNarratorNode = new ArrayList();
                    while (true)
                    {
                        int ind = _line.IndexOf("*");
                        if (ind > 0 && ind < _line.Length)
                        {
                            string str = _line.Substring(0, (ind));
                            if (k == 0)
                            {
                                _allServerNarrators[_narId] = str;
                                _serverNarratorNode.Add(str);
                            }
                            else
                            {
                                _serverNarratorNode.Add(str);
                            }
                            _line = _line.Substring(ind + 1);
                            k++;
                        }
                        else
                        {
                            _line = null;
                            break;
                        }
                    }
                    _serverNarrators.Add(_serverNarratorNode);
                    _serverFiles = "added";
                }
                _line = _strReader.ReadLine();
                if (_line == null)
                {
                    break;
                }
            }
        }
        else
            counter++;
    }
} 
```

我想要的是启动屏幕类中的东西，它会等到线程完成。

有关更多详细信息，请告诉我我需要告诉您的内容。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-12-26T15:11:46.433

同样的问题，同样的答案：

.NET 框架对启动画面具有出色的内置支持。启动一个新的WF项目，Project + Add Reference，选择Microsoft.VisualBasic。添加一个新表单，将其命名为 frmSplash。打开 Project.cs 并使其看起来像这样：

```
using System;
using System.Windows.Forms;
using Microsoft.VisualBasic.ApplicationServices;

namespace WindowsFormsApplication1 {
  static class Program {
    [STAThread]
    static void Main(string[] args) {
      Application.EnableVisualStyles();
      Application.SetCompatibleTextRenderingDefault(false);
      new MyApp().Run(args);
    }
  }
  class MyApp : WindowsFormsApplicationBase {
    protected override void OnCreateSplashScreen() {
      this.SplashScreen = new frmSplash();
    }
    protected override void OnCreateMainForm() {
      // Do your time consuming stuff here...
      //...
      System.Threading.Thread.Sleep(3000);
      // Then create the main form, the splash screen will close automatically
      this.MainForm = new Form1();
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-26T15:34:52.317

在调用 Application.Run() 之前创建 UI，您已进入危险领域。Application.Run 本质上是程序的消息泵。通过在启动应用程序的消息泵之前显示 UI，您可以在不成熟的 UI 上有效地使典型的 UI 交互变得不可能。对于启动画面，这可能看起来无关紧要，但如果（例如）有请求让启动画面在单击时消失，或者您想使用 BackgroundWorker，这将很重要。

这些可以通过在初始屏幕中创建一个消息泵来解决（通过调用 ShowDialog() 而不是 Show() 使其成为模态），但是当治疗问题时，这就是治疗症状真的不是那么困难。

在这种情况下，我强烈鼓励[nobugz 的回答。](https://stackoverflow.com/questions/392864/c-splash-screen-problem#393870)该框架提供您需要的支持。虽然 Microsoft.VisualBasic 命名空间中的功能对于 C# 程序员来说并不总是很容易发现，但对于此类情况，它们可以成为真正的节省时间和救生员。

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-25T15:50:06.937

跨越 2 个线程有点令人困惑，但我要试一试，说这个......

我在这里不完全理解您的设计，但是如果问题是当您启动第二个应用程序时，启动屏幕表单会变成白色......这很可能是由于启动屏幕忙于执行 GetFromServer 中的所有代码()。太忙了，没有时间重新粉刷自己。

为了解决这个问题，我建议您使用[BackGroundWorker 组件](http://msdn.microsoft.com/en-us/library/8xs8549b.aspx)来执行 GetFromServer 方法。这将在单独的线程中运行该方法，并使表单的线程可以自由地重新绘制自身。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-11-26T12:23:10.170

不幸的是，我还没有足够的声誉来评论某人的回答。:(这是对[恐慌上校对汉斯·帕桑茨回答的评论的回答](https://stackoverflow.com/questions/392864/splash-screen-waiting-until-thread-finishes#comment26302855_393870)。

他的问题是在启动画面后面会显示一个`MessageBox`显示的来源。`new FormMain(args)`关键是从启动画面运行的线程调用 MessageBox：

```
splashScreen.Invoke(new Action(() => {
    MessageBox.Show(splashScreen, "the message");
})); 
```

Where `splashScreen` is a reference to the splash screen object that has been created in `OnCreateSplashScreen` and obviously has to be given to the new `Form1` object.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-25T15:50:24.893

你真的应该提供更多关于你的问题的细节。我可能完全错了，但我要在黑暗中开枪。从我想象的情况来看，你想要显示启动画面，在另一个线程中进行一些处理，然后启动画面在完成后消失。

为此，您需要将`GetFromServer()`调用移至`BackgroundWorker`. 然后移动

```
 this.Hide();
    _serverData = new ArrayList();
    _thisData.Add(_allServerNarrators);
    _thisData.Add(_serverNarrators); 
```

`BackgroundWorker_RunWorkerCompleted`事件处理程序的代码。

**要使用`BackgroundWorker`**：

1) 初始化`BackGroundWorker`

```
 BackgroundWorker myWorker = new BackgroundWorker(); 
```

2) 添加事件处理程序

```
 myWorker.DoWork += new DoWorkEventHandler(myWorker_DoWork);
  //put the work you want done in this one

  myWorker.RunWorkerCompleted += 
      new RunWorkerCompletedEventHandler(myWorker_RunWorkerCompleted);
  //this gets fired when the work is finished 
```

3) 将代码添加到事件处理程序。

4) 打电话`myWorker.RunWorkerAsync()`开始工作。

作为单独的说明，您似乎没有对`ArrayList`传递给启动画面的构造函数的内容做任何事情。这是故意的吗？

# comparison - 用于开发的 FAST ESP 与 Google Search Appliance

> ID：392870
> 
> 赞同：4
> 
> 时间：2008-12-25T15:14:09.460
> 
> 标签：comparison, fast-esp

两者中哪一个提供了更好的 API 来开发？尽管有一个虚拟的 Google Search Appliance 可供下载，但 FAST 没有这样的等效项。
因此，希望在这些产品中具有经验的开发人员提供建议和文档链接。（特别是对于 FAST，因为他们的网站上没有可用的）

亲切的问候，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-10T16:37:45.603

我很确定 FAST 今天没有提供他们的企业搜索平台 (ESP) 的试用下载，也没有提供 SDK（没有 ESP 就没有用）。

FAST 几乎是定制的行业领导者（Google 很受欢迎，因为它是简单的开箱即用解决方案，而 Autonomy 似乎是合规性的领导者），这可能是您对 API 感兴趣的地方。但不便宜。用于处理文档的内部 Python 定制，用于与服务交互的外部 .NET 和 Java API。

此外，如果您正在寻找基本的企业搜索 + API，请在“Solr”项目上搜索谷歌。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-01T11:08:54.790

我认为 FAST 提供了免费试用版。随之而来的是 API 文档和其他手册。我的公司使用它。我用这个。

回答您的问题，FAST 显然比 Google 搜索工具更好（出于各种原因）。这就是我的看法。

房地美

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-21T15:28:30.873

我曾在 Google Search Appliance 上工作过，效果很好。我可以在元数据中搜索，从查询中获取选择性数据，查看正在被抓取的文档的实时状态，可以使用 GSA6.14 进行扩展，以及 Google 的所有大力支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-21T15:48:31.713

Apache Solr 是一个很好的解决方案，具有非常灵活的客户端 API。你一定要检查一下。我们目前正在从 FAST 迁移到 Solr，我发现 Solr 的功能和 API 比 FAST ESP 好得多。

# applet - 桌面小程序的最佳框架是什么？

> ID：392879
> 
> 赞同：1
> 
> 时间：2008-12-25T15:21:34.733
> 
> 标签：applet, desktop-application, cappuccino

我想做一个简单的桌面应用程序来学习这种东西。

你会为初学者推荐什么语言？你会推荐初学者使用框架吗？我只在 javascript 和一点 PHP 方面有经验。

你对卡布奇诺有什么看法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-25T16:51:31.587

我推荐 Yahoo 小部件系统，因为您在 Javascript 方面经验丰富。它完全基于 Javascript。（我相信有一点 HTML）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-25T19:05:47.323

我推荐 python + PyQt。非常容易学习，非常强大。

# sql-server - 我是否在 unicode 的“insert into”语句中使用了前缀 N？

> ID：392916
> 
> 赞同：11
> 
> 时间：2008-12-25T16:00:10.193
> 
> 标签：sql-server, unicode

像：
插入表（col）值（N'多语言Unicode字符串'）

我正在使用 SQL Server 2008，并且我已经使用 nVarChar 作为列数据类型。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-25T16:31:18.383

仅当字符串包含不在默认代码页内的字符时，才需要 N'' 语法。“最佳实践”是在插入 nvarchar 或 ntext 列时使用 N''。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T16:17:11.767

是的，如果字符串中有 unicode 字符，您可以这样做。

从在线书籍（[http://msdn.microsoft.com/en-us/library/ms191313.aspx](http://msdn.microsoft.com/en-us/library/ms191313.aspx)）...

“出现在服务器上执行的代码（例如存储过程和触发器）中的 Unicode 字符串常量必须以大写字母 N 开头。即使被引用的列已经定义为 Unicode，也是如此。没有 N 前缀，字符串被转换为数据库的默认代码页。这可能无法识别某些字符。使用 N 前缀的要求适用于源自服务器的字符串常量和从客户端发送的字符串常量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T16:14:42.283

出于兼容性考虑，它是优选的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-25T20:27:41.543

最佳做法是使用[参数化](http://weblogs.sqlteam.com/dang/archive/2008/02/18/Why-Parameters-are-a-Best-Practice.aspx)，在这种情况下您不需要 N 前缀。

# algorithm - 如何计算密码复杂度

> ID：392928
> 
> 赞同：13
> 
> 时间：2008-12-25T16:23:54.590
> 
> 标签：algorithm, security, passwords

某些应用程序（或网站）会在您键入时计算密码的复杂性。

它们通常会显示一个红色条，该条会变成橙色，然后是绿色，然后随着密码变长甚至更绿，并且包含更多类别的字符（例如，小写字母、大写字母、标点符号、数字）。

**如何可靠地计算密码的复杂性？**

我提出了以下算法，但我担心它被`Password1!`评为“非常强”和`]@feé:m`“弱”，因为它只有 7 个字符长。

```
private int GetPasswordComplexity(string password)
{
    if (password.Length <= 4)
        return 1;

    int complexity = 0;

    int digit = 0;
    int letter = 0;
    int cap = 0;
    int other = 0;

    for (int i = 0; i < password.Length; i++)
    {
            if (char.IsDigit(password[i]) && i!=password.Length-1)
            digit = 1;
        else if (char.IsLower(password[i]))
            letter = 1;
        else if (char.IsUpper(password[i]) && i!=0)
            cap = 1;
        else
            other = 1;
    }

    complexity = digit + letter + cap + other;

    if (password.Length <= 7)
        complexity = Math.Min(3, complexity);

    return complexity;
} 
```

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-25T18:55:32.443

如果您有时间检查所有潜在规则，那么使用像cracklib 这样的东西是非常好的。如果你只是想要一些快速的东西——比如基于 javascript 的强度计——然后考虑估计暴力攻击所需的潜在猜测的数量。对于看到的每种字符类型，都会根据该类型的潜在字符数更新一个乘数。因此，如果您只有数字，则乘数将为 10。如果您只有小写字母，则乘数为 26。如果两者都有，则乘数为 36——即对于密码中的每个字符，暴力攻击将需要尝试多达 36 个不同的字符。包含大小写字符、数字和标点符号的密码，

要估计蛮力方法将采用的最大排列数，请将乘数提高到等于密码中位数的幂。这为您提供了使用暴力攻击破解密码所需的最大猜测次数。假设每次猜测需要一个 cpu 周期，并且给定最快的处理器，计算在给定一定数量的排列的情况下破解密码需要多长时间。例如，如果我的乘数为 10，密码长度为 10 个字符，那么我将有 10,000,000,000 个可能的组合。在 3GHz 处理器上，这应该花费 10/3 * k 或 3k 秒（其中 k 是每次猜测的周期数，通常很小）。显然，这是一个弱密码。

现在，建立一些代表合理密码强度的范围。例如，如果您认为中等强度至少需要包含大小写字符的 8 个字符的密码，那么在 3GHz 处理器上您的截止值将是 52^8 或大约 1.5 年（假设 k = 1）。如果添加数字，则在 3GHz 处理器上，截止值变为 62^8 或大约 8 年。

要使用它，您只需要跟踪您看到的字符类型，构建适当的乘数，根据密码长度计算预期排列，并将其与预定义的截止值进行比较，以确定密码的强度。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-25T16:32:07.070

我建议为此使用cracklib。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-25T16:28:32.397

当您看到数字、大写字母等时，我不会简单地设置一个标志，而是为它们打分。类似于评分系统的东西。一个普通的字母算 1，一个数字算 2，一个特殊字符算 3。

现在，您的总数既考虑了字符数，也考虑了密码的构成方式。你只需要为弱点和强点画线。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T21:03:29.830

您还应该检查字典。我认为苹果在它的内置密码检查器中做到了这一点。

# c# - 一个具有不同返回类型的函数......可以使用泛型吗？

> ID：392931
> 
> 赞同：4
> 
> 时间：2008-12-25T16:27:01.590
> 
> 标签：c#, .net, generics

我有一些程序，为简单起见，如下所示：

```
public string FetchValueAsString(string key)
public int FetchValueAsInteger(string key)
public bool FetchValueAsBoolean(string key)
public DateTime FetchValueAsDateTime(string key) 
```

我知道我可以只有一个返回对象类型的方法并进行转换，但我想知道是否有一种方法可以只调用一个方法，并以某种方式使用泛型来确定返回值......可能?

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-25T16:37:04.033

```
public static T FetchValue<T>(string key)
{
    string value;  
    // logic to set value here  
    // ...  
    return (T)Convert.ChangeType(value, typeof(T), CultureInfo.InvariantCulture);  
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-25T16:40:03.623

我假设您正在用 C# 编写代码。如果你是，那么你可以像这样做你所说的：

```
public T FetchValueAsType<T>(string key) 
```

然后你会这样调用版本：

```
FetchValueAsType<int>(key); 
```

话虽`System.Convert`如此，框架提供的类也可以正常工作并且具有相似的语法。您可以在此处找到有关它的 msdn 文章：http: [//msdn.microsoft.com/en-us/library/system.convert.aspx](http://msdn.microsoft.com/en-us/library/system.convert.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T16:41:25.990

这是可能的，但在不知道该方法的实现的情况下，很难说是否有什么可以得到的，或者它是否真的/很容易作为泛型实现。

好歹：

```
public T FetchValue<T>(string key) 
```

将是你想要做的。

# c++ - 如何使用条件（三元）运算符？

> ID：392932
> 
> 赞同：39
> 
> 时间：2008-12-25T16:27:10.653
> 
> 标签：c++, conditional-operator

我一直想知道如何**`"A ? B : C"`**用 C++ 兼容的语言编写语法。

我认为它的工作原理类似于：（*伪代码）*

```
If A > B
   C = A
Else
   C = B 
```

*请任何资深的 C++ 程序员帮帮我吗？*

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-12-25T16:34:48.797

它是这样工作的：

```
(condition) ? true-clause : false-clause 
```

它最常用于赋值操作，尽管它也有其他用途。三元运算符`?`是缩短 if-else 子句的一种方式，在其他语言中也称为立即 if 语句（`IIf(condition,true-clause,false-clause)`例如在 VB 中）。

例如：

```
bool Three = SOME_VALUE;
int x = Three ? 3 : 0; 
```

是相同的

```
bool Three = SOME_VALUE;
int x;
if (Three)
    x = 3;
else
    x = 0; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-25T16:32:43.467

它是这样工作的：

```
expression ? trueValue : falseValue 
```

这基本上意味着如果`expression`评估为 true，则将返回或执行 trueValue，否则将返回或评估 falseValue。

请记住，trueValue 和 falseValue 仅在表达式分别为 true 或 false 时才会被评估和执行。这种行为称为短路。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-25T16:31:28.880

在 c++ 中没有实际的 if 部分。它被称为三元运算符。它是这样使用的： <boolean statement> ？<result if true> : <result if false>; 对于上面的示例，它看起来像这样：

```
C = A > B ? A : B; 
```

维基百科上的这篇文章也讨论了它： [http ://en.wikipedia.org/wiki/Ternary_operation](http://en.wikipedia.org/wiki/Ternary_operation)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-25T16:31:04.983

我假设您的意思是 a = b 之类的东西？c : d，其中 b 是条件，c 是 b 为真时的值，d 是 b 为假时的值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-06T18:29:30.467

我会说？是一个捷径。然而，一些“铁杆”程序员倾向于将其写出来，以便在未来的情况下，人们可以轻松地阅读和修改代码。

例如，如果你写

```
int a = b<c ? b : c; 
```

有些人声称这样写更清楚：

```
if(b<c)
 a = b;
else
 a = c; 
```

因为在未来的情况下，人们可以抓住它。当然，一个简单的 b<c ? b:c 很容易捕捉，但有时会进行复杂的操作，很难发现。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-18T02:19:47.700

似乎没有人提到条件运算符表达式的结果可以是 C++ 中的 L 值（但不能在 C 中）。以下代码在 C++ 中编译并运行良好：

```
 int a, b;
    bool cond;
    a=1; b=2; cond=true;
    (cond? a : b) = 3;
    cout << a << "," << b << endl; 
```

上面的程序打印 3, 2

然而，如果 a 和 b 是不同的类型，它就行不通了。以下代码给出了编译器错误：

```
 int a;
    double b;
    bool cond;
    a=1; b=2; cond=true;
    (cond? a : b) = 3;
    cout << a << "," << b << endl; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-23T12:01:25.807

很简单它的基本语法是：expression1?expression2:expression3;

如果表达式 1 为真，则表达式 2 将成立，否则表达式 3 将成立。

例子：

> `hey=24>2?24:34;`

在这里，条件为真值 24 将分配给它。如果它是假的，那么 34 将被分配给它

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-12-03T07:18:49.400

> **简单地你可以把它写成**

C=(A>B)?A:B;

> **这与以下内容相同：**

```
if(A>B)

 C=A;

else

 C=B; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-10-01T02:26:57.070

这称为“三元运算符”，`?`and`:`是另一种编写 if-else 语句的方式。

[查看此Codepen](https://codepen.io/alfredrafael/pen/wvGLBLE?editors=0010)中的“示例 #1” ，然后取消注释...您会注意到它的作用。

现在评论“Example #1”，取消评论“Example #2”，看看会发生什么。代码做了完全相同的事情......但这次只有 5 行代码。注意`?`符号之前出现的东西是`if`（有条件的），之后出现`:`的东西是要执行的东西。

但是，如果您有一个条件，需要像 Codepen 的“示例 #3”（这增加了用户写出特定错误答案的可能性）中的“else-if”（具有超过 2 种可能的结果），该怎么办？那么三元运算符可能就没那么有用了，但你当然可以将几个条件与三元运算符连接起来，就像这个 ES6 [fizzbuzz](https://www.vincecampanale.com/blog/2016/12/16/fizzbuz-es6/)示例一样。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-15T04:32:45.557

就像这是我们的条件 - > A?B:C 所以根据条件，如果“A”为真，则打印“B”，或者如果“A”为假，则打印“C”。换句话说，我们也可以说它是 if else 条件的另一种方式。

# ruby - Ruby 中你最喜欢的特性是什么？

> ID：392958
> 
> 赞同：6
> 
> 时间：2008-12-25T16:48:29.317
> 
> 标签：ruby

[.NET](https://stackoverflow.com/questions/237365/whats-your-favorite-feature-in-net)和[Java](https://stackoverflow.com/questions/237386/whats-your-favorite-feature-in-java)也有类似的问题，但 Ruby 没有。那么，**您最喜欢 Ruby 中的哪个功能？**

您可能还对[Ruby 的隐藏特性](https://stackoverflow.com/questions/63998/hidden-features-of-ruby)感兴趣。

*请具体并在每个答案中发布一项功能。解释或代码示例会很好。*

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-25T17:32:01.537

块非常好：

```
my_array.each { |element| print element } 

#...

File.open("foo.txt") do |file|
  # do stuff with file
end 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-25T16:53:49.087

这是一个非常小，几乎微不足道的功能，但我真的很喜欢这个结构：

```
var ||= "default" 
```

如果尚未设置，则设置`var`为默认值 ( `"default"`)，如果`var`已设置，则保留当前值`var`。我喜欢简洁的语法。

同样，我可以这样做：

```
new_val = old_val || "default" 
```

也可以设置默认值。

总的来说，我喜欢所有 Ruby 表达式返回值的方式，因此我可以使用运算符`||`来编写简短、紧凑的语句。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-26T16:47:15.667

数不胜数！一些关于为什么它很棒的例子。

```
a = ['foo', 'bar', 'baz']

a.delete_if {|i| i =~ /^f/ }
# vs
new = []
a.each do |i|
  if i !~ /^f/
    new << i
  end
end

a.select {|i| i =~ /^f/ }
# vs
new = []
a.each do |i|
  if i =~ /^f/
    new << i
  end
end

a.detect {|i| i =~ /^f/ }
# vs
a.each do |i|
  if i =~ /^f/
    return i
  end
end 
```

能够直接说出你想要达到的效果，用'select'，'detect'，'delete_if'等等，而不是循环和手工做所有事情，这是非常好的。Enumerable 使键入更容易，并且在阅读代码时更容易理解。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-25T18:50:05.933

我喜欢能够调用不带括号的函数，以及返回最后一个评估表达式的函数。

前者省去了很多不必要的括号，让代码更容易阅读。

后者有时会变得相当混乱，但它非常适合单行（尤其是逻辑）函数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-12-21T17:41:27.150

非布尔值的布尔运算符。

`&&`和`||`

两者都返回最后评估的表达式的值。通过短路，这些创建方便的捷径。出于短路检测的目的，他们将任何非 nil 或 false 的值视为 true。

例子：

```
a = b || c 
```

仅当 b 为 nil 或 false 时才将 c 的值分配给 a。

```
a = b && c 
```

将 c 的值赋给 a，只有 b 不是 nil 或 false，否则，赋值 b。

这种行为解释了`||=`已经提到的。

然而，`&&=`运营商并没有得到同样的爱。

```
string &&= string + "suffix" 
```

相当于

```
if string
  string = string + "suffix"
end 
```

如果变量未定义，这对于不应进行的破坏性操作非常方便。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-25T16:53:38.417

该类是对象，而 new 是该类的方法：

```
c = Array
a = c.new() 
```

我喜欢案例的工作方式。它在每个 case 值上调用 === 并返回一个值：

```
if(0 <= age &&  age <= 10){
  x = "kid"
}else if(10 <= age && age <= 80)
  x = "person"
}else if(80 <= age && age <= 99)
  x = "old"
}else{
  x = "???"
}

=>

x = case age
  when 0..10:  "kid"
  when 10..80: "person"
  when 80..99: "old"
  default:     "???"
end 
```

这是有效的，因为范围 (0..10) 有一个 === 方法来检查是否在范围内：(5..10) === 6 ==> true。正则表达式也支持 ===，所以你可以这样做：

```
case str
  when /regex1/: ...
  when /regex2/: ...
  ...
end 
```

您甚至可以为自己的对象编写 === 方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-25T16:59:27.687

另一个不错的功能：确保。它就像 finally，但在 Ruby 中具有简洁的语法。当你有这样的事情时，你可以使用它：

```
def foo(x)
  return_value = bar(x)
  dosomething(x)
  return return_value
end

=>    

def foo(x)
  bar(x)
ensure
  dosomething(x)
end 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-25T17:11:45.680

公开课是我的最爱*之一*。例如，这个：

```
# try.rb

class TryObjectMock
  public_instance_methods.reject { |x| x =~ /^__/ }.each { |x| undef_method(x) }

  def method_missing(symbol, *args)

  end
end

class Object
  def try
    self.nil? ? TryObjectMock.new : self 
  end
end 
```

使处理`nil`能对象的代码更清晰：

```
irb(main):001:0> require 'try'
irb(main):002:0> puts "5".try.to_i
5
irb(main):003:0> puts nil.try.to_i
nil
irb(main):004:0> puts [1, 2].try.find { |x| x == 2 }.try + 3
5
irb(main):005:0> puts [1, 2].try.find { |x| x == 3 }.try + 3
nil
irb(main):006:0> puts nil.try.find { |x| x == 3 }.try + 3
nil
irb(main):007:0> 
```

它避免了很多`if-else`s：

```
irb(main):007:0> a = [1, 2]
irb(main):008:0> puts(if a
irb(main):009:2>        if b = a.find { |x| x == 2 }
irb(main):010:3>          b + 3
irb(main):011:3>        end
irb(main):012:2>      end)
5
irb(main):013:0> c = "5"
irb(main):014:0> puts(c ? c.to_i : nil)
5 
```

该技巧通过`try`为对象空间中的每个类定义方法来起作用。当它被调用时，它返回一个特殊的对象，当对象是`nil`（`nil`是的实例`NilClass`，它是`Object`！的子类）或对象本身时。该特殊对象只是`nil`为每个调用的方法返回（通过空`method_missing`实现）。请注意，它也适用于运算符，因为它们是左侧对象的方法。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-12-21T18:01:56.550

我不可能只选择一个，但首先想到的是 splat：`*`

基本上它可以让你把一个数组变成一个参数列表，反之亦然，让你做这样的事情：

```
odds  = [1, 3, 7]
evens = [2, 4, 6]

case 4
  when *odds  then "odd!"
  when *evens then "even!"
end
# => "even!"

arr = [ :a, 1, :b, :2 ]    
Hash[*arr] # => { :a => 1, :b => 2 }

a, b, c = *(1..3)
puts a # => 1
puts b # => 2
puts c # => 3

a = 1, *[2, 3] # => [1, 2, 3]

# And of course...
def f(*args)
  puts args
end

f 1, 2, 3 # => [1, 2, 3] 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-25T16:56:38.130

问号/感叹号命名约定

方法调用后通常不需要括号

关闭

红宝石

好吧，我想这是一些最爱:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-27T02:37:05.117

我现在最喜欢的功能（在最近处理了 Soap4R 之后）可能是可用的内省。这两种方法特别有用：

public_methods - 返回对象上所有方法的列表。当您试图弄清楚您可以对某事做什么时，调试器或 irb 非常有用。（接近一秒

instance_variables - 返回对象上所有实例变量的列表。

这里还有各种其他好东西：[http ://www.ruby-doc.org/core/classes/Object.html](http://www.ruby-doc.org/core/classes/Object.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-08-03T20:36:45.887

instance_eval 和 class_eval :)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-08-03T20:47:32.963

`if`语句也是表达式，因此块的最后一行返回一个值。允许如下代码：

```
my_var = if some_var.is_true?
           if some_other_var > 8
             1
           else
             23
           end
         else
           5
         end 
```

在这里，`my_var`最终会得到值 1、23 或 5，具体取决于条件的评估方式。

# c# - 如何在 C# 中获取设备名称？

> ID：392960
> 
> 赞同：2
> 
> 时间：2008-12-25T16:49:07.113
> 
> 标签：c#, windows-ce

如何在 C# 代码中获取我的设备名称（使用 WinCE）？

它只给我“WindowsCE”我如何获得设备名称的类型？（例如符号或数据逻辑或 mio...）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-10-03T21:19:58.953

我能够使用 Windows CE 5 检索设备名称

```
System.Net.Dns.GetHostName() 
```

希望这可以帮助。干杯。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-25T16:53:58.697

注册表值 HKEY_LOCAL_MACHINE\Ident\Name 包含设备名称。使用注册表库来读取它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-05T18:16:00.323

你要什么“名字”？如果您正在阅读 FrozenFire 指示的注册表项并获得“WindowsCE”，那么这就是 OEM 为设备名称填充的内容。设备是否在其他地方报告了其他名称以及您想要的其他值？如果是这样，您在哪里看到它，价值是什么？您是否正在考虑设备唯一 ID（[WinMo 团队在此处发布的示例](http://blogs.msdn.com/windowsmobile/archive/2006/01/09/510997.aspx)）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-08-02T10:49:36.680

尝试这个：

```
Environment.MachineName 
```

# c# - 将 Lua 与 C# 结合使用的最有效方法是什么？

> ID：392979
> 
> 赞同：3
> 
> 时间：2008-12-25T17:15:39.573
> 
> 标签：c#, performance, clr, lua

据我了解，Lua 是一种可嵌入的脚本语言，可以对对象执行方法。有哪些需要避免的陷阱？使用 Lua 作为解释器并在 Web 环境中执行方法或作为规则引擎是否可行？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-25T17:43:35.617

Lua 脚本正在[成为](http://lua-users.org/lists/lua-l/2008-12/msg00119.html)Apache Web 服务器的核心模块。

这里有一些用于绑定 Lua 和 C#/.NET 代码的[工具](http://lua-users.org/wiki/BindingCodeToLua)。 [LuaInterface](http://lua-users.org/wiki/LuaInterface)是最新的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-25T18:42:12.753

Lua 非常快 - 脚本可以预编译为字节码，函数执行接近 C++ 虚拟方法调用。这就是为什么它在游戏行业中用于编写 AI、插件和其他游戏中的高级内容的原因。

但是您将 C# 和 Web 服务器放在问题标签中。

如果您不考虑嵌入式 Web 服务器，那么 Lua 就不是很强大。Lua 是 ANSI C - 它编译为本机代码，因此它不是很欢迎您的 asp.net 服务器，也不是您的 C# 代码。想想“中等信任”或“绑定”或“64 位”。

陷阱够多了。如果您已经在使用 C#，则没有理由在 Web 服务器上避免使用它。它被编译和缓存。它为像这样的大型网站提供服务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T05:46:15.343

我们曾经在一个中型 C# 生物医学仪器控制应用程序中使用 Lua 作为我们的脚本语言。这是教硬件人员如何编写自己的一小段测试代码的好方法。

一旦 IronPython 成熟，我们决定，由于 Python 功能更全，并且与 VS 的集成度更高（以及使用它的人更多），我们将用 Python 替换所有 Lua。到目前为止，效果很好。Lua 是一门很好的小语言，我不确定在这一点上我能想到 Lua 相对于 Python 的任何优势。

Lua 可能会快一点，但如果您已经将域拆分为 script-y 和 non-script-y，那么这可能不是一个大因素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T19:07:50.703

我喜欢 Lua 的原因是它作为一种语言非常出色，尤其是在与 C/C++ 一起使用时。对我来说，正是这两者的结合“造就”了这种语言。

陷阱.. 缺少扩展模块可以看作是一个。就像没有 CPAN，但有 LuaRocks。取决于您是否有足够的绑定来解决您的问题。如果没有，你可能需要制作它们。

语言陷阱.. Lua wiki中有一些愿望，可以看作是“陷阱”。没有“切换”声明。没有正确的“cond ? a : b”格式。如果您不想将注意力转移到这些相当肤浅的语法上，那么 JavaScript 是否适合您？

总的来说，它是一种语言，它使我的工作效率比没有它的编程高 10 到 100 倍。

# php - Symfony 是否比 Zend 更适合 Web 开发商店（10+），因为它是一个全栈框架？

> ID：392980
> 
> 赞同：7
> 
> 时间：2008-12-25T17:16:19.773
> 
> 标签：php, zend-framework, frameworks, symfony1

我的工作团队正在考虑使用一个框架来开发网站和应用程序。一些资深人士认为我们应该使用 Zend 框架，因为它更容易挑选功能，因此我们的框架将是轻量级的。

然而，我担心他们只关注轻量级框架将具有的技术优势。在我看来，最好有一个全栈框架（我是 Symfony 的支持者），因为

1.  它还将为我们提供一种无需编写新文档的标准工作方式。
2.  如果我们想使用新功能，我们只需阅读文档以了解如何使用它，而不必先将其构建到 Zend 设置中。

我不希望每个人都能回答我的所有问题，但这就是我在答案中寻找的：

*   我在这里有意见吗？
*   你有没有遇到过类似的情况，你是怎么处理的？
*   你有更多我可以使用的论点或者可以让我重新考虑我自己的观点吗？

背景：我在一家有大约 10 名程序员的小商店工作。我们主要编写 PHP。我们使用了一个非常简单的内部开发框架和 ORM 库，它们实际上没有文档记录，除了最基本的功能（无验证器、无交易、无缓存、无身份验证）外缺少任何东西

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-02T12:35:19.683

为什么不两者兼而有之？我从 2006 年开始使用 symfony，一年来一直是 Doctrine 的忠实粉丝，几个月来，通过将 Zend 组件直接集成到我们的 symfony 应用程序中，我们在生产力阶梯上迈出了许多台阶。

symfony 的真正优势在于一切的解耦，以及框架的易扩展性。您几乎可以替换整个事物的每一层。只需将 Zend 目录复制/粘贴到 /lib/ 中，然后在 /config/ProjectConfiguration.class.php 中添加这个单例：

```
 static public function registerZend()
{
    if (self::$zendLoaded)
    {
        return;
    }

    sfToolkit::addIncludePath(sfConfig::get('sf_lib_dir') . '/vendor', 'back');
    require_once(sfConfig::get('sf_lib_dir') . '/vendor/Zend/Loader.php');

    Zend_Loader::registerAutoload();
    self::$zendLoaded = true;
} 
```

并自由使用您可能喜欢的任何 Zend 组件。您可能对新的 Jobeet 教程感兴趣，尤其是使用 Zend_Lucene_Search 的搜索部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T14:31:08.980

ZF怎么*不是*“全栈”？它似乎包含 Symfony 所做的每一个元素，然后是一些。此外，ZF 有一个“选择你的毒药”的方法，允许你以不同的方法使用不同的部分。（例如，我们在很多不同的地方使用 Zend_Config，这样每个人都可以期待一个合理统一的配置系统，即使是在很小的代码片段上）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T16:40:38.550

> 然而，我担心他们只关注轻量级框架将具有的技术优势。在我看来，最好有一个全栈框架（我是 Symfony 的支持者），因为......

这在很大程度上取决于您正在构建的应用程序的类型。如果您正在构建大量低复杂性、主要是内容驱动的应用程序，那么 Symfony 将会大放异彩。另一方面，如果您的应用程序不适合 Symfony 的裸对象范式（例如，如果它很复杂并且不完全专注于内容管理），您可能会发现它更像是一个障碍，而不是一个帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-25T20:01:34.060

我认为 ZF 文档和社区参与更好。我也喜欢它的命名方案、编码标准和可扩展性。ZF 似乎还从许多从事自己的宠物项目的不同人那里获得了许多新功能和对现有类的改进，例如开源项目。

我真的不明白 Symfony 对 10 名程序员的团队有何优势。显然，您应该能够相对快速地为新项目设置默认配置，并在 ZF 之上和之外拥有大量可扩展性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-25T18:09:31.273

Symfony 真的很容易使用，并且可以在很短的时间内获得一个功能齐全的站点，包括会话、缓存、单元和功能测试、自动化部署等等。你只需要担心代码来访问和显示你的数据。虽然它可能不像自己滚动的实现那样轻量级，但您必须维护的代码量会更少。

Propel/Creole ORM 运行良好，内置了验证器等，并且设置为开箱即用可扩展。

在将内部框架转换到 Symfony 时，我只需将其放入 Symfony 在启动时扫描的 lib 目录之一即可重用大量库代码。

虽然我没有使用过它，但 Symfony 中内置了一个 Zend 桥接器，它允许您在需要时使用 Zend 模块。

希望有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-25T19:30:58.147

我对这两者的经验都有限，但是为 Zend 设置“标准”的一个很好的起点是遵循他们使用不同模块的教程——其中许多给出了适用于 99% 项目的合理默认值。

我会说这取决于你需要它来做什么——Zend 的灵活性，Symfony 的快速启动和预先制定的标准，如果你的项目没有特别的需求。

# c++ - 如何在 C++ 中将字符串转换为双精度值？

> ID：392981
> 
> 赞同：37
> 
> 时间：2008-12-25T17:17:21.160
> 
> 标签：c++

如何在 C++ 中将字符串转换为双精度值？我想要一个在字符串不是数字时返回 0 的函数。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-25T18:18:38.057

~~请参阅 C++ FAQ Lite[如何将 std::string 转换为数字？](http://www.parashift.com/c++-faq-lite/misc-technical-issues.html#faq-39.2)~~

请参阅 C++ Super-FAQ[*如何将 std::string 转换为数字？*](https://isocpp.org/wiki/faq/misc-technical-issues#convert-string-to-num)

请注意，根据您的要求，您无法区分所有允许的零字符串表示形式和非数字字符串。

```
 // the requested function
 #include <sstream>
 double string_to_double( const std::string& s )
 {
   std::istringstream i(s);
   double x;
   if (!(i >> x))
     return 0;
   return x;
 } 

 // some tests
 #include <cassert>
 int main( int, char** )
 {
    // simple case:
    assert( 0.5 == string_to_double( "0.5"    ) );

    // blank space:
    assert( 0.5 == string_to_double( "0.5 "   ) );
    assert( 0.5 == string_to_double( " 0.5"   ) );

    // trailing non digit characters:
    assert( 0.5 == string_to_double( "0.5a"   ) );

    // note that with your requirements you can't distinguish
    // all the the allowed string representation of zero from
    // the non numerical strings:
    assert( 0 == string_to_double( "0"       ) );
    assert( 0 == string_to_double( "0."      ) );
    assert( 0 == string_to_double( "0.0"     ) );
    assert( 0 == string_to_double( "0.00"    ) );
    assert( 0 == string_to_double( "0.0e0"   ) );
    assert( 0 == string_to_double( "0.0e-0"  ) );
    assert( 0 == string_to_double( "0.0e+0"  ) );
    assert( 0 == string_to_double( "+0"      ) );
    assert( 0 == string_to_double( "+0."     ) );
    assert( 0 == string_to_double( "+0.0"    ) );
    assert( 0 == string_to_double( "+0.00"   ) );
    assert( 0 == string_to_double( "+0.0e0"  ) );
    assert( 0 == string_to_double( "+0.0e-0" ) );
    assert( 0 == string_to_double( "+0.0e+0" ) );
    assert( 0 == string_to_double( "-0"      ) );
    assert( 0 == string_to_double( "-0."     ) );
    assert( 0 == string_to_double( "-0.0"    ) );
    assert( 0 == string_to_double( "-0.00"   ) );
    assert( 0 == string_to_double( "-0.0e0"  ) );
    assert( 0 == string_to_double( "-0.0e-0" ) );
    assert( 0 == string_to_double( "-0.0e+0" ) );
    assert( 0 == string_to_double( "foobar"  ) );
    return 0;
 } 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-12-25T17:25:08.367

最简单的方法是使用[boost::lexical_cast](http://www.boost.org/doc/libs/1_47_0/libs/conversion/lexical_cast.htm)：

```
double value;
try
{
    value = boost::lexical_cast<double>(my_string);
}
catch (boost::bad_lexical_cast const&)
{
    value = 0;
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-12-25T17:26:39.690

atof 和 strtod 做你想做的事，但非常宽容。如果您不想接受像“32asd”这样的字符串有效，则需要将 strtod 包装在如下函数中：

```
#include <stdlib.h>
double strict_str2double(char* str)
{
    char* endptr;
    double value = strtod(str, &endptr);
    if (*endptr) return 0;
    return value;
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-25T17:42:01.143

如果它是一个 c 字符串（char 类型的以 null 结尾的数组），您可以执行以下操作：

```
#include <stdlib.h>
char str[] = "3.14159";
double num = atof(str); 
```

如果是 C++ 字符串，只需使用 c_str() 方法：

```
double num = atof( cppstr.c_str() ); 
```

atof() 将字符串转换为双精度，失败时返回 0。该功能记录在这里：[http ://www.cplusplus.com/reference/clibrary/cstdlib/atof.html](http://www.cplusplus.com/reference/clibrary/cstdlib/atof.html)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-06-12T17:14:09.193

```
#include <iostream>
#include <string>
using namespace std;

int main()
{
    cout << stod("  99.999  ") << endl;
} 
```

输出：（`99.999`这是双倍的，空白被自动剥离）

由于 C++11 将字符串转换为浮点值（如 double）可用于以下函数：
[stof](http://www.cplusplus.com/reference/string/stof/) - 将 str 转换为 float
[stod](http://www.cplusplus.com/reference/string/stod/) - 将 str 转换为 double
[stold](http://www.cplusplus.com/reference/string/stold/) - 将 str 转换为 long double

> 我想要一个在字符串不是数字时返回 0 的函数。

`stod`抛出异常时可以添加 try catch 语句。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-25T19:27:11.570

必须说我同意最优雅的解决方案是使用 boost::lexical_cast。然后，您可以捕获可能发生的 bad_lexical_cast，并在它失败时执行某些操作，而不是获得 atof 给出的 0.0。

```
#include <boost/lexical_cast.hpp>
#include <string>

int main()
{
    std::string str = "3.14";
    double strVal;
    try {
        strVal = boost::lexical_cast<double>(str);
    } catch(bad_lexical_cast&) {
        //Do your errormagic
    }
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-25T18:25:02.130

这个问题最优雅的解决方案之一是使用 boost::lexical_cast 正如@Evgeny Lazin 提到的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-25T17:19:20.330

我认为[atof](http://www.cplusplus.com/reference/clibrary/cstdlib/atof.html)正是你想要的。此函数解析字符串并将其转换为双精度数。如果字符串不是以数字（非数字）开头，则返回 0.0。

但是，它确实会尝试尽可能多地解析字符串。换句话说，字符串“3abc”将被解释为 3.0。如果您想要一个在这些情况下返回 0.0 的函数，您需要自己编写一个小包装器。

此外，此函数适用于以空字符结尾的字符数组的 C 样式字符串。如果您使用的是字符串对象，则需要在使用此函数之前将其转换为 char*。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-25T17:20:37.863

没有一个函数可以做到这一点，因为 0 是一个有效数字，并且您需要能够在字符串不是有效数字时进行捕捉。

您将需要首先检查字符串（可能使用正则表达式）以查看它是否仅包含数字和数字标点符号。然后，如果这是您的应用程序需要的，您可以决定返回 0 或将其转换为双精度值。

在查找**atof()**和**strtod()**之后，我应该将我的陈述改写为“不应该”而不是“没有”......呵呵

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-04T17:22:12.273

> 在 C 中将字符串转换为双精度的示例 C 程序

```
#include <iostream>
#include <comutil.h>
#include <iomanip>

bool ParseNumberToDouble(const std::wstring& strInput, double & dResult)
{
    bool bSucceeded = false;
    dResult = 0;
    if (!strInput.empty() && dResult)
    {
        _variant_t varIn = strInput.c_str();
        if (SUCCEEDED(VariantChangeTypeEx(&varIn, &varIn, GetThreadLocale(), 0, VT_R8)))
        {
            dResult = varIn.dblVal;
            bSucceeded = true;
        }
    }
    return bSucceeded;
}

int main()
{
    std::wstring strInput = L"1000";
    double dResult = 0;

    ParseNumberToDouble(strInput, dResult);

    return 0;
} 
```

# java - Ragel - 在输入时验证字符串

> ID：392983
> 
> 赞同：2
> 
> 时间：2008-12-25T17:19:12.997
> 
> 标签：java, input, validation, ragel

假设我们要验证用户输入，而用户正在输入 JTextField。为了验证用户输入，我想知道我是否可以使用 Ragel。

假设输入应遵循此示例正则表达式：

```
[a-z]{2,5}ABC[0-9]+ 
```

我怎么能用 ragel 做到这一点？任何人都可以举一个简短的例子，如何使用 ragel “即时”（输入时）验证用户输入吗？

Ragel 文档遗漏了一些快速入门的好例子，所以我在这里问。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-10-20T11:18:32.123

您可以使用 EOF 动作（Ragel 文档中的第 3.2.2 节 EOF 动作）通过 Ragel 动态检查表达式。当检测到输入缓冲区结束处于有效状态（包括非最终状态）时触发它们。

简单的例子：

```
 main := ([a-z]{2,5}'ABC'[0-9]+) @/{correct = 1;} %{correct = 1;}; 
```

动作“@/”适用于所有非最终状态。它包括起始状态，因此空字符串对于这种情况是正确的。当整个输入缓冲区与模式匹配时，动作“%”用于最终状态。在上面的示例中，两个动作的代码是相同的，但在实践中通常要分别处理最终状态。如果不需要，则可以简化上面的示例：

```
 main := ([a-z]{2,5}'ABC'[0-9]+) $/{correct = 1;}; 
```

下面是带有 C 输出的完整 Ragel 示例，用于检查所提供的模式。我希望将其转换为 Java 不是问题。

```
 #include <stdio.h>

  %%{
   machine checker;
   write data;
  }%%

  unsigned char checker( const char *str )
  {
   /* standart Ragel variables */
   const char *p = str, *pe = str + strlen( str ) - 1; //-1 to strip "\n"
   const char *eof = pe;
   int cs;

   unsigned char correct = 0;

   %%{
    action final { printf("entire match"); correct = 1; }
    action partial { printf("partial match"); correct = 1; }

    main := ([a-z]{2,5}'ABC'[0-9]+) @/partial %final;

    write init;
    write exec;
   }%%

   return correct;
  };

  #define BUFSIZE 1024
  int main()
  {
   char buf[BUFSIZE];
   while ( fgets( buf, sizeof(buf), stdin ) != 0 ) {
    printf( "%d\n", checker( buf ));
   }
   return 0;
  } 
```***********