# StackOverflow 问答 000375000-000375999

# java - 字符串的正则表达式错误

> ID：375009
> 
> 赞同：1
> 
> 时间：2008-12-17T15:55:27.527
> 
> 标签：java, regex

我有简单的正则表达式

```
"\".*\"" 
```

对我来说，它说选择“和”之间的所有内容，但它也抓住了

```
"text") != -1 || file.indexOf(".exe" 
```

对我来说它的两个字符串，对于正则表达式它的一个。我怎样才能使正则表达式看到它的两个字符串？

PS我正在使用Java。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-17T16:10:41.273

那是非贪婪的形式：

```
".*?" 
```

意思是： “`*?`尽可能少地匹配”，而`*`单独的意思是“尽可能地匹配”。

后者基本上一直持续到字符串的末尾，一个一个地返回字符，以便最终`"`匹配。这就是为什么你会得到字符串中第一个和最后一个引号之间的所有内容。

```
// for the sake of completeness: Java would need this pattern string
"\".*?\"" 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T15:59:28.503

正则表达式是“贪婪的”。你想要做的是从比赛中间排除引号，比如

```
"\"[^\"]*\"" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T16:00:13.133

而不是`.`使用`[^\"]`，以便正则表达式无法匹配`"`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T16:16:13.447

您正在使用贪婪的量词。你想要一个不情愿的量词。

模式的 Javadocs 应该有所帮助：http: [//java.sun.com/j2se/1.5.0/docs/api/java/util/regex/Pattern.html](http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/Pattern.html)

在该页面上，您会发现：

```
Greedy quantifiers
X?  X, once or not at all
X*  X, zero or more times
X+  X, one or more times
X{n}    X, exactly n times
X{n,}   X, at least n times
X{n,m}  X, at least n but not more than m times

Reluctant quantifiers
X??     X, once or not at all
X*?     X, zero or more times
X+?     X, one or more times
X{n}?   X, exactly n times
X{n,}?  X, at least n times
X{n,m}?     X, at least n but not more than m times 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T16:19:39.273

正如其他答案所指出的那样，量词 ( *) 是贪婪的，并试图匹配尽可能多的字符。一种解决方法是 "\"[^\"]* \""，这样中间就不会匹配 ""。但是你真的想要一个不情愿的量词，尽可能少地尝试字符。在你的情况下 "\".*?\"" 不情愿的量词是 *?。

[在此处](http://java.sun.com/docs/books/tutorial/essential/regex/quant.html)阅读有关此内容的更多信息。“贪婪、不情愿和占有量词之间的差异”在这里可能特别有趣。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T15:59:17.503

研究[惰性量化](http://en.wikipedia.org/wiki/Regex#Lazy_quantification)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T15:59:19.547

找到在 Java 的正则表达式中指定非贪婪行为的方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-17T16:06:43.183

你知道有多少个字符，或者至少一个最大值吗？如果是这样，您可以使用 \".{n,}\" ，其中 n 是最大值，或者如果您知道确切的长度，则省略 ','。

# c# - 使用 c# 使用 GPU

> ID：375011
> 
> 赞同：145
> 
> 时间：2008-12-17T15:55:47.653
> 
> 标签：c#, gpu, gpgpu

我正试图从我的网格中获得更多的处理能力。

我正在使用所有 cpus/cores，是否可以将 GPU 与 C# 一起使用。

有人知道任何库或有任何示例代码吗？

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2012-12-05T00:49:59.487

[*编辑 OCT 2017，因为即使这个答案已经很老了*]

这些答案中的大多数都已经很老了，所以我想我会给出一个更新的总结，说明我认为每个项目的位置：

*   [GPU.Net](https://github.com/tidepowerd/GPU.NET-Example-Projects) (TidePowerd) - 我在大约 6 个月前尝试过这个，虽然花了一些工作但确实让它工作了。在编译时将 C# 内核代码转换为 cuda。不幸的是，他们的网站已经关闭，他们的 github 已经有几年没有更新了，这可能表明该项目已经死了......

*   [Cudafy](https://cudafy.codeplex.com/) - 开源且非常易于使用。在运行时将 C# 内核代码转换为 cuda（具有序列化和缓存能力）。可以轻松地在 CPU 上运行相同的内核代码（主要用于调试）。支持多个 GPU。此处提供的示例比其他示例更多。其他答案引用的样板代码很少，就我而言，至少有助于我理解代码的工作原理。不过只有 Cuda/Nvidia。不幸的是，他们似乎也有几年没有更新他们的解决方案（2015 年的最新提交——支持 cuda 7.0）。

*   [杂交剂](http://www.altimesh.com/)。将 C# 编译为 CUDA 的商业解决方案。[在Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=altimesh.AltimeshHybridizerExtensionEssentials)上提供免费社区版，在[github](https://github.com/altimesh/hybridizer-basic-samples)上提供示例。

*   [AleaGPU](http://www.aleagpu.com/release/3_0_3/doc/)商业解决方案，带有适用于消费级 GPUS 的免费社区版。有关详细信息，请参阅丹尼尔的评论。

*   [Brahma](https://brahma.codeplex.com/) - 通过 OpenCL 运行 LINQ 表达式（因此也支持 AMD）。没有太多文档/示例。2011 年最后一次更新。

*   [C$](https://cbucks.codeplex.com/) - 最后一次开发是在 10 多年前...

*   [Microsoft Accelerator](http://research.microsoft.com/en-us/projects/accelerator/) - 同样看起来它不再被积极开发。

*   其他一些（[C++ AMP](http://blogs.msdn.com/b/nativeconcurrency/archive/2011/09/13/c-amp-in-a-nutshell.aspx)、[OpenTK -- dead](http://www.opentk.com/) / [Cloo](http://sourceforge.net/projects/cloo/)）——其中许多只是绑定——即使您能够从 C# 调用 GPU，但您的内核代码（实际上在 GPU 上运行的代码）需要写入C 或 OpenCL，这意味着您必须使用（并学习）另一种语言。

正如我所说，我会推荐 Cudafy 胜过其他所有产品 - 如果它可以在 OpenCL 和 Cuda 上运行，那将是完美的。

**编辑 SEP 2013** Cudafy 现在允许您为 CUDA 和 OpenCL 进行编译*，*因此将在所有 GPU 上运行相同的 C# 代码。这听起来很棒，虽然我还没有测试过 OpenCL 编译。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2008-12-17T16:46:39.390

Microsoft Research [Accelerator](https://web.archive.org/web/20150307180743/http://research.microsoft.com/en-us/projects/Accelerator/)是一个 .NET GP GPU 库。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-17T18:50:09.250

我找到了[Brahma](https://archive.codeplex.com/?p=brahma) ...它还有一个 GPGPU 提供程序，允许方法在 GPU 上运行...感谢您的提问...今天学到了一些新东西。:)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-17T16:22:31.747

我可以推荐 XNA Game Studio 作为探索的可能途径吗？它显然是为编写游戏而准备的，但与以前在托管 DirectX 中提供的相比，它为您提供了对图形卡的托管访问以及对功能枚举功能和着色器开发的更好访问。还有一些方法可以将 WinForms 和 XNA 组合到混合应用程序中：

[http://www.ziggyware.com/news.php?readmore=866](http://www.ziggyware.com/news.php?readmore=866)

您必须花一些精力来学习着色器编程（XNA 支持 HLSL），但这可能比学习特定于供应商的解决方案（如 nVidia 的 CUDA）更简单。优点是您可以在 100% 托管的环境中进行编程。以下是一些 HLSL 链接：

[http://www.ziggyware.com/weblinks.php?cat_id=9](http://www.ziggyware.com/weblinks.php?cat_id=9)

GPGPU 站点也是通用 GPU 编程的推荐目的地：

[http://gpgpu.org/](http://gpgpu.org/)

祝你好运！

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2012-07-26T23:26:10.470

这是另一个： [CUDAfy](http://cudafy.codeplex.com/documentation)。这听起来像 GPU.Net，因为像方法属性这样简单的东西可以使整个方法在 GPU 上运行。但与 GPU.Net 不同的是，CUDAfy 是免费和开源的。

GPU.Net 似乎不需要样板代码*（根据他们的文档，它是“由构建工具自动注入的”）*，而 CUDAfy 则需要。

* * *

[这](http://www.codeproject.com/Articles/202792/Using-Cudafy-for-GPGPU-Programming-in-NET)是使用 CUDAfy 构建应用程序的示例。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-08-05T12:14:56.487

[http://www.tidepowerd.com/GPU.NET](http://www.tidepowerd.com/)怎么样？

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2015-11-20T08:17:24.937

嗯，这是一个很老的问题，自从有人问起，事情发生了很大变化。
使用 .Net 编写 GPU 代码的另一种选择，在[Alea GPU](http://quantalea.com/)的答案中没有人提到过。它涵盖了 C#、F# 和 VB。

> 适用于 .NET 和 Mono 的专业 GPU 软件开发环境。真正的跨平台

在 F# 官方网站上，Alea 是在 GPGPU 编程中使用 F# 的[首选](http://fsharp.org/use/gpu/)。
要了解这个框架，我建议查看其综合[示例](http://quantalea.com/static/app/tutorial%5Cexamples%5Cindex.html)列表。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-11-03T05:48:11.153

除了 Brahma，看看[C$](http://cbucks.codeplex.com/)（读作“C Bucks”）。从他们的 CodePlex[网站](http://cbucks.codeplex.com/)：

> [C$] 的目标是创建一种统一的语言和系统，用于在现代 GPU 和 CPU 上进行无缝并行编程。

它基于 C#，延迟评估，并针对多个加速器模型：

> 目前，预期架构列表包括 GPU、多核 CPU、多 GPU（SLI、CrossFire）和多 GPU + 多 CPU 混合架构。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-08-31T21:54:20.183

镇上有一个新的 Microsoft 解决方案 - [C++ AMP](http://msdn.microsoft.com/en-us/library/hh265137.aspx)（[此处](http://blogs.msdn.com/b/nativeconcurrency/archive/2012/08/30/learn-c-amp.aspx)介绍）。

从 C# 中使用将通过 P/Invoke 进行，如[这里](http://blogs.msdn.com/b/pfxteam/archive/2011/09/21/10214538.aspx)演示的桌面应用程序和[这里](http://blogs.msdn.com/b/pfxteam/archive/2011/11/11/how-to-use-c-amp-from-c-using-winrt.aspx)的（不要称之为）Metro 应用程序。

**编辑：**我应该注意到 C++ AMP 有一个[开放的规范](http://blogs.msdn.com/b/nativeconcurrency/archive/2012/02/03/c-amp-open-spec-published.aspx)，这意味着它不一定只适用于 MS 编译器，或者只适用于 Windows。

**编辑：**显然，该技术[现在处于“维护模式”，](https://developercommunity.visualstudio.com/content/problem/225629/question-what-is-microsofts-plan-for-c-amp-do-you.html)这意味着他们正在修复错误，但没有积极开发。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-17T15:57:20.533

以某种方式管理 DirectX，可能有效

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-03T17:03:46.613

如果您的 GPU 都是同一个品牌，您可以通过 Nvidia 的 CUDA 或 ATI 的 Stream 从供应商处获得 GPGPU 支持。AFAIK，它们提供 DLL，您可以通过 P/Invoke 使用它们。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-09-04T08:50:43.717

[CenterSpace Software 在其NMath](http://www.centerspace.net/product-overviews)库中具有 GPU 驱动的计算，您可以将其添加到 C# 项目中。这是一个商业产品。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-03T16:49:55.813

WPF 也使用 GPU，您可以使用 HLSL 添加自定义着色器。

*   [基于 GPU 的 WPF 效果系列](https://docs.microsoft.com/en-us/archive/blogs/greg_schechter/a-series-on-gpu-based-effects-for-wpf)（Greg Schechter 的博客）

# c# - 重构 OrderBy 表达式

> ID：375014
> 
> 赞同：2
> 
> 时间：2008-12-17T15:56:20.083
> 
> 标签：c#, linq, lambda

我希望能够在 linq 表达式中重构**OrderBy子句。**

这是一个重构**where**子句 的例子

前：

```
results = ctx.ActiveUsers
    .Where(u => u.CompanyID != 1 &&
           (u.LastName.ToLower().Contains(searchString)
           || u.Email.ToLower().Contains(searchString)
           || u.Company.Name.ToLower().Contains(searchString)))
    .OrderBy(u =>  u.LastName ).ThenBy(u => u.FirstName)
    .Select(u => new Employee {
      ID = u.ID
      , FirstName = u.FirstName
      , LastName = u.LastName
      , Email = u.Email
      , CompanyName = u.Company.Name
      , CompanyID = u.CompanyID.ToString() }); 
```

* * *

后：

```
results = ctx.ActiveUsers
    .Where(Employee.GetExpression(searchString))
    .OrderBy(u =>  u.LastName ).ThenBy(u => u.FirstName)
    .Select(u => new Employee {
      ID = u.ID
      , FirstName = u.FirstName
      , LastName = u.LastName
      , Email = u.Email
      , CompanyName = u.Company.Name
      , CompanyID = u.CompanyID.ToString() }); 
```

* * *

```
private static Expression<Func<User, bool>> GetExpression(string searchString)
{ 
    Expression<Func<User, bool>> p = (u => u.CompanyID != 1 &&
                       (u.LastName.ToLower().Contains(searchString)
                       || u.Email.ToLower().Contains(searchString)
                       || u.Company.Name.ToLower().Contains(searchString)));
    return p;
} 
```

我想知道除了我想重构**Orderby**表达式之外，是否可以进行相同类型的事情。

先感谢您

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T16:10:01.587

假设您想要实际获取一个字符串，例如“LastName”、“FirstName”等，我会执行以下操作：

```
var unordered = ctx.ActiveUsers
                   .Where(Employee.GetExpression(searchString))
                   .OrderBy(ordering)
                   .Select(u => new Employee {
                       ID = u.ID,
                       FirstName = u.FirstName,
                       LastName = u.LastName,
                       Email = u.Email,
                       CompanyName = u.Company.Name,
                       CompanyID = u.CompanyID.ToString() }); 
```

并添加一个新的 OrderBy 扩展方法：

```
public static class UserQueryableExtensions
{
    public static IOrderedQueryable<User> OrderBy(this IQueryable<User> source,
                                                  string ordering)
    {
        switch (ordering)
        {
            case "LastName":
                return source.OrderBy(x => x.LastName);
            case "FirstName":
                return source.OrderBy(x => x.FirstName);
            case "Email":
                return source.OrderBy(x => x.Email);
            case "Company":
                return source.OrderBy(x => x.Company);
            default:
                throw new ArgumentException("Unknown ordering");
        }
    }
} 
```

您当然*可以*使用反射来做到这一点，但除非您有一组重要的属性（或者您想对不同的实体类型使用相同的例程），否则 switch 语句会更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T20:14:48.330

谢谢乔恩，

这个答案让我现在走上了正确的道路......但是，我需要在我的订单中保留**ThenBy**子句。所以虽然下面的解决方案不是动态的，但它仍然保留了**ThenBy**

```
var unordered = ctx.ActiveUsers
                   .Where(Employee.GetExpression(searchString))
                   .MyOrder()
                   .Select(u => new Employee {
                       ID = u.ID,
                       FirstName = u.FirstName,
                       LastName = u.LastName,
                       Email = u.Email,
                       CompanyName = u.Company.Name,
                       CompanyID = u.CompanyID.ToString() }); 
```

* * *

```
public static class UserQueryableExtensions
{
    public static IOrderedQueryable<User> MyOrder(this IQueryable<User> source )
    { 
        return source.OrderBy(x => x.LastName).ThenBy(x => x.FirstName).ThenBy(x => x.Email);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T19:46:55.797

我同意 Jon 在可能的情况下使用 lambdas 来避免拼写错误等。但是，如果你真的不能这样做（无论出于何种原因），我过去看过完全动态`OrderBy`的。有关在 LINQ-to-SQL 上测试的示例，请参见[此处](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/9ca28e3f0205bb87/7d931ec0e2356d21#7d931ec0e2356d21)（但理论上 EF 应该没问题）。

# perl - 我可以在 VC++ 6.0 编译的应用程序中嵌入 Strawberry Perl，或者在编译器不匹配的情况下使用 Inline::C 吗？

> ID：375015
> 
> 赞同：5
> 
> 时间：2008-12-17T15:56:33.033
> 
> 标签：perl, visual-c++, mingw, visual-c++-6, strawberry-perl

我正在考虑将 perl 5.10 嵌入到使用 VC++ 6.0 编译的大型 C++ 应用程序中。这导致了两个问题。

1) 简单地使用 Strawberry Perl 作为依赖项而不是使用 VC++ 6.0 编译我自己的 perl 是不是一个坏主意？考虑到编译器不匹配，Strawberry 甚至可以工作吗？我认为草莓是用 mingw 编译的。我宁愿不必保留我自己的自定义 perl 构建。

2）如果我走草莓路线，像 Inline::C 这样的东西会在嵌入式应用程序中工作吗？您将有 VC++ 6.0 代码调用 mingw 编译的草莓，然后调用用户 mingw 编译的代码。Inline::C 将是我尝试使用嵌入式 perl 解释器实现的一项很棒的功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T20:16:26.517

考虑到所涉及的不确定性，我建议使用 MSVC 编译 Perl，而不是为此应用程序尝试使用 Strawberry Perl。[perlwin32](http://perldoc.perl.org/perlwin32.html)中有说明，还有关于[Perl Monks](http://perlmonks.org/)的[相关讨论](http://perlmonks.org/?node_id=346164)可以指导您。

作为 Strawberry Perl 的前发布经理，我可以告诉您，如果您已经对编译器感到满意，那么做起来并不难。

-- xdg

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-09T00:40:45.447

Activestate perl 是用 VC++ 6.0 编译的。它可以使用 VC++ 6.0 或 MinGW 来编译模块，因为它们链接到相同的 C 运行时库 msvcrt.dll。最好使用 MinGW，因为 VC++ 6.0 既不是免费的也不是现成的（除非您可以确定它已安装在目标机器上。）[您可以 PPM 立即安装 Mingw](http://www.openkomodo.com/blogs/troyt/ppm-install-mingw)，并从 CPAN 编译模块。大量模块编译没有问题。您可能需要配置 CPAN：

o conf yaml_module '' （两个单引号，中间没有）

o conf 提交

内联::C 有效。

# python - 如何使用 LiveAPI（Ableton Live）发送剪辑名称

> ID：375052
> 
> 赞同：5
> 
> 时间：2008-12-17T16:05:31.547
> 
> 标签：python, api, osc, ableton-live

当播放（触发）音频或 midi 剪辑时，需要使用 OSC 将其名称发送到[另一个应用程序](http://vvvv.org/)。

[LiveAPI](http://www.assembla.com/wiki/show/live-api)是一个允许人们使用 python 脚本探索和自动化[Ableton Live的接口。](http://www.ableton.com/)

执行此操作的代码必须用 python 脚本编写，该脚本必须放在 Ableton Live 可以找到它的特定文件夹中，在 Live 的首选项中选择。

有关 LiveAPI 的更多信息，请访问以下网站：
[http://www.assembla.com/wiki/show/live-api](http://www.assembla.com/wiki/show/live-api)
[http://groups.google.com/group/liveapi](http://groups.google.com/group/liveapi)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T11:30:36.787

According to [the LiveAPI documentation](http://svn2.assembla.com/svn/live-api/trunk/docs/Ableton%20Live%20API/modules/Clip.Clip.html), the Clip object has a "name" attribute which holds the clip name. Presumably that's what you want to send in your OSC packets.

Also, it's worth mentioning that the Max/MSP support in Live8 will probably be a lot more comfortable to work with than LiveAPI, which is pretty much a dead project. Max/MSP supposedly has OSC support, which was added to support the JazzMutant Lemur, but I'm not sure how much of that made it into Live. Anyways, it's worth keeping in mind for when Live8 is released.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T16:57:08.453

我知道 Max 4 Live，但在我看来，这是另一回事。是的，它可能能够与 Live 交互来完成人们现在使用 LiveAPI 所做的所有事情。有些人甚至认为 M4L 甚至可能不通过 LiveAPI，而是使用一些内部接口（因为 Ableton 和 Cycling 74 正在一起开发它）。从ableton.com 网站上的宣传视频来看，我认为M4L 将主要用于制作和修改声音，而不是控制/读取其他乐器、效果、剪辑等。

我不会说 LiveAPI 项目已经死了，因为很多硬件 MIDI 控制器都依赖 LiveAPI 来做一些自动映射魔术。当您查看 Live 中的 MIDI Remote Scripts 文件夹时，您会看到每个控制器都有自己的带有 python 脚本的文件夹。所以我绝对认为 LiveAPI 会继续存在，而 Live 的大门会一直敞开。他们甚至创建了一个名为 Framework 的新文件夹，其中包含一些更新的代码，这可能是新的 Akai 控制器与 Live 一起工作所必需的（这是人们理论上所相信的）。

我打算使用播放剪辑名称的应用程序称为 vvvv，因此我不想将 Max 带入其中，因为它并不是真正需要的。

我在某人修改原始 LiveAPI 代码方面取得了一些成功，但仅在我请求所有剪辑的名称时才有效，而不是在我只要求一个时。后来没时间玩了，我准备做的事情已经过去了。我计划最终解决这个问题，但它不再那么紧迫了。

# php - 为什么我的代码会出现“意外的正则表达式”错误？

> ID：375053
> 
> 赞同：0
> 
> 时间：2008-12-17T16:05:40.597
> 
> 标签：php, regex

目标是将当前工作目录拆分为`/clients/`并查看用户是否在

```
[某事]/客户/[他们的用户名]/[某事]
```

例如，目标是输入：

```
cwd = "/volumes/raid0/www/clients/mikey/test_folder/"
$session->username = "mikey" 
```

返回

```
$authorized = true 
```

我希望它能够识别 UNIX 和 Windows 路径，因此它应该查找“/”或“\”。假定文件名不包含这些字符。

此外，该`isAdmin()`位应该允许管理员访问所有目录。

现在，PHP 说：

> 警告：第 69 行 c:\apache\htdocs\clients\mikey\index.php 中的意外正则表达式错误 (8)

这是目前的代码。（第 69 行在评论中注明。）

```
if($session->isAdmin())
{
    $authorized = true;
} 
else 
{
  // split cwd at the first instance of /clients/
  $dir = spliti('%(\/|\\)clients(\/|\\)%',getcwd(),2); //this is line 69
  if(count($dir) == 2) // if /clients/ was in cwd
  {
    // check if the second piece of cwd starts with the username.
    $authorized = (preg_match('/^'.$session->username.'//*.$/', $dir[1]));
  } 
  else 
    $authorized = false;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T16:18:24.453

这里不需要使用正则表达式，你是在另一个字符串中寻找一个字符串。所以这将是这样的：

```
$isAuthorized = strpos(str_replace('\\', '/', getcwd()), "/clients/$username/") !== FALSE; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T16:46:03.557

简单的正则表达式变体是：

*   `"/"`在或处拆分字符串`"\"`
*   在结果数组中搜索`"clients"`
*   如果找到，检查下一个位置的元素是否等于用户名

在 PHP 中（虽然未经测试）：

```
function isAuthorized($session)
{
  $authorized = $session->isAdmin();

  if(!$authorized)
  {
    $parts = split("[/\\\\]", $path);

    // find "clients", compare the following bit to the $session->username
    $clients_pos = array_search("clients", $parts);
    if ($clients_pos && count($parts) >= $clients_pos) 
      $authorized = ($parts[$clients_pos + 1] == $session->username);
    else
      $authorized = false;
  }
  return $authorized;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T16:16:06.970

这样的事情可能会让你开始：

```
<?php
$regex = '%(.+)(/|\\\\)clients(/|\\\\)(.+)(/|\\\\)(.+)(/|\\\\)%';

preg_match($regex, "/volumes/raid0/www/clients/mikey/test_folder/", &$matches);
var_dump($matches);
?> 
```

输出：

```
 array(8) {
  [0]=>
  string(45) "/volumes/raid0/www/clients/mikey/test_folder/"
  [1]=>
  string(18) "/volumes/raid0/www"
  [2]=>
  string(1) "/"
  [3]=>
  string(1) "/"
  [4]=>
  string(5) "mikey"
  [5]=>
  string(1) "/"
  [6]=>
  string(11) "test_folder"
  [7]=>
  string(1) "/"
} 
```

应该可以让你把这段代码写得更短。请记住，您必须双重转义。这很丑，我知道。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T16:21:46.413

您的正则表达式是否也尝试考虑路径中的反斜杠？这可能没有必要。然后你可以拆分：

```
'%/clients/%' 
```

（您不需要转义正则斜杠，因为您使用 % 作为正则表达式分隔符。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T16:29:19.643

此代码未经测试，适用标准免责声明：

```
if($session->isAdmin()) {
   $authorized = true;
} else {
   // split cwd at the first instance of /clients/
   $dir = preg_split('/(\/|\\)clients(\\|\/)/i', getcwd());
   if(count($dir) == 2) { // if /clients/ was in cwd
      // check if the second piece of cwd starts with the username.
      $dir = preg_split('/\/|\\/', $dir[1]);
      $authorized = ($dir[0] == $session->username);
   } else {
      $authorized = false;
   }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T16:45:58.470

这修复了我的 PHP 警告：

```
if($session->isAdmin())
{
    $authorized = true;
} else {
    // split cwd at the first instance of /clients/
    $dir = spliti('%(/|\\\\)clients(/|\\\\)%',getcwd(),2);
    if(count($dir) == 2) // if /clients/ was in cwd
        {
            // check if the second piece of cwd starts with the username.
            $authorized = (preg_match('%^'.$session->username.'*(/|\\\\)*.$%', $dir[1]));
    } else $authorized = false;
} 
```

问题是， spliti() 没有拆分我的 cwd() 返回...我正在测试的 cwd() 返回是：

> c:\apache\htdocs\clients\mikey

我希望能够使用“/”或“\”，这会迫使我使用正则表达式（据我所知。）

Ruben 的解决方案不太优雅（它似乎限制了允许的目录深度），但如果我无法解决这个问题，它可能会起作用。

我将继续努力，看看我是否能弄清楚发生了什么（此时我的 spliti() 正则表达式似乎都是一个问题。）

输入/反馈总是受到赞赏，即使它不是问题的完整解决方案（甚至不是相关的。如果我的代码很糟糕，请告诉我。）

谢谢！——威尔（OP）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T17:51:40.507

OKAY，这就解决了。我需要用 preg_split() 替换 split() ...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-01T17:01:46.540

我会检查[`DIRECTORY_SEPARATOR`](http://docs.php.net/manual/en/dir.constants.php)当前使用的内容，然后`strpos`对其进行简单检查：

```
$cwd = getcwd();
if (DIRECTORY_SEPARATOR != '/') {
    $cwd = str_replace(DIRECTORY_SEPARATOR, '/', $cwd);
}
$authorized = (strpos($cwd, '/clients/'.$session->username.'/') !== false); 
```

# windows - 我将如何定期备份 Windows 应用程序日志？

> ID：375066
> 
> 赞同：4
> 
> 时间：2008-12-17T16:07:24.493
> 
> 标签：windows, logging, batch-file, backup, event-viewer

我正在使用一个定期记录到 Windows 应用程序日志的应用程序（可通过事件查看器管理工具查看），并且我正在寻找一种每天备份它的方法。这很重要，因为我们有时会发现应用程序存在问题 - 为了进一步调查，我们需要一周前记录的信息。我们正在寻找的事件不一定仍然存在......我已经尝试增加大小和所有这些，但我认为自动备份会促进这个过程。我们最终不会得到巨大的日志，而是多个中等大小的日志。

我*更喜欢*像批处理文件 + Windows 调度程序这样的简单解决方案，但也会对其他方法感兴趣。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T16:22:27.567

您可以使用 Windows Management Instrumentation (WMI) 来读取事件日志并对结果执行任何您喜欢的操作。这是[一篇文章](http://www.siccolo.com/Articles/CodeProject/LogWatcher_RSS_feed/build_log_watcher_rss_feed_using_WMI.html)，您可以根据自己的目的进行调整。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T16:28:21.813

这是我不久前找到的一个 WMI 脚本。这可能就是您要搜索的内容！

```
dim strComputer = "." 'Define here the Remote IP Address or Computername
dim objWMIService
dim colLogFiles
dim objLogfile
dim errBackupLog

Set objWMIService = GetObject("winmgmts:" & "{impersonationLevel=impersonate,(Backup)}!\\" &  strComputer & "\root\cimv2")

Call eventlogbackup("Application")
Call eventlogbackup("System")
Call eventlogbackup("Security")

Function eventlogbackup(logtype)

Set colLogFiles = objWMIService.ExecQuery ("SELECT * FROM Win32_NTEventLogFile WHERE LogFileName='" & logtype & "'")

For Each objLogfile in colLogFiles
 errBackupLog = objLogFile.BackupEventLog("\\server\eventlogs\" & strComputer & "\" &logtype & ".evt")
 If errBackupLog <> 0 Then
    Wscript.Echo "The " & logtype &" event log could not be backed up."
 Else
    objLogFile.ClearEventLog()
    Wscript.Echo "The " & logtype &" event log is backed up."
 End If
Next

End Function 
```

只需在计划任务中设置此脚本，您就可以开始了！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-28T18:53:38.840

将 Application 通道中的所有事件输出到 XML：

```
wevtutil.exe qe application 
```

对于可读的文本输出，使用：

```
wevtutil.exe qe application /f:text 
```

您可以轻松地将这些输出中的任何一个定期通过管道传输到文件以进行备份。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T19:38:27.827

您可能需要考虑设置一种工具来将 Windows 事件转发到 syslog 服务器。然后，不必运行执行备份的进程，您将几乎在将所有日志条目添加到 Windows 事件日志的同时将它们转发到第二个位置。

[http://ntsyslog.sourceforge.net/](http://ntsyslog.sourceforge.net/) [http://edoceo.com/creo/winlogd](http://edoceo.com/creo/winlogd) [http://www.softpanorama.org/Logs/Syslog/syslog_for_windows.shtml](http://www.softpanorama.org/Logs/Syslog/syslog_for_windows.shtml)

根据您使用的系统日志服务器，您可以设置过滤器以忽略某些事件或将它们发送到不同的文件。您可以随意设置日志滚动。

# c# - 如何测量 .NET 中多个并发线程的代码块（线程）执行时间

> ID：375068
> 
> 赞同：6
> 
> 时间：2008-12-17T16:07:47.627
> 
> 标签：c#, .net, performance, multithreading, measurement

现在我们只使用这样的东西

```
 stopWatch.Start();            
        try
        {
            method();
        }
        finally
        {
            stopWatch.Stop();
        } 
```

这对于同步方法很有效，但有些是异步执行的，因此在执行多个线程时时间会出现偏差。是否有与 System.Diagnostics.Stopwatch 等效的仅测量当前线程中花费的时间？

我们希望在我们的内部测试版（alpha？）版本中收集较长时间的数据，并且在分析器下全职运行不是一个可行的选择。

编辑：为了澄清，我们只想测量执行 method() 所花费的时间，所以如果 Method1() 和 Method2() 同时开始并且 Method1 在 2 秒标记处完成， Method2 在 4 秒标记处完成，我想要的东西会告诉我 Method1 花了大约 1 秒执行，Method2 花了大约 3 秒执行（假设在前 2 秒内他们平等地共享（假设为单核）处理器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T17:06:19.630

嗯，来自 Jon Skeet 对这个问题的回答：

[在线程应用程序中准确计时一行代码，C#](https://stackoverflow.com/questions/252793/timing-a-line-of-code-accurately-in-a-threaded-application-c)

还有这篇文章：

[http://lyon-smith.org/blogs/code-o-rama/archive/2007/07/17/timing-code-on-windows-with-the-rdtsc-instruction.aspx](http://lyon-smith.org/blogs/code-o-rama/archive/2007/07/17/timing-code-on-windows-with-the-rdtsc-instruction.aspx)

似乎没有简单的方法可以做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T16:38:13.790

秒表应该只测量一个线程所花费的时间。您需要在每个线程上运行一个单独的实例。这可能会给你你想要的结果。

或者（如果您想监控整个应用程序，而不仅仅是某些方法，则首选选项），您可以使用各种开箱即用的性能计数器（它们由 .Net 运行时更新）。网上有很多资料，可以从msdn入手：http: [//msdn.microsoft.com/en-us/library/w8f5kw2e (VS.71).aspx](http://msdn.microsoft.com/en-us/library/w8f5kw2e(VS.71).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T16:50:57.103

我曾经通过为 StopWatch 创建一个包装器解决了类似的问题，该包装器的 StopWatch 实例标记为`ThreadStatic`.

或者，您可以购买 Ants Profiler 等工具来帮助您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-16T09:58:50.120

这是一个很酷的工具： [http ://technet.microsoft.com/en-us/sysinternals/bb896647.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)

# ruby - 关于Ruby架构的几个问题

> ID：375070
> 
> 赞同：0
> 
> 时间：2008-12-17T16:08:24.397
> 
> 标签：ruby

我主要是一个流利的 .NET 开发人员（从我发表的关于 .NET 的帖子和线程的数量可以看出），但我认为学习 RoR 会很好。

在这样做的过程中，我对语言（Ruby）和框架（RoR）的架构有几个问题：

1) 在 .NET 中，每个对象都派生自 System 但继承 System.Object。因此，当我键入 System. 时，我会得到一个命名空间列表，然后在这些命名空间、类和更多命名空间中。

Ruby 没有这种层次结构吗？

2）在某些情况下，我没有得到智能感知。例如，我编写了此处概述的类 ( [http://wiki.rubyonrails.org/rails/pages/HowToSendEmailsWithActionMailer](http://wiki.rubyonrails.org/rails/pages/HowToSendEmailsWithActionMailer) )，但在收件人 user.email 行中，当我键入“user.”时，什么也没有出现。

知道为什么吗？

感谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T16:16:15.427

Dave Thomas（实用程序员）有一个关于 Ruby 对象模型/元编程的优秀[截屏系列。](http://www.pragprog.com/screencasts/v-dtrubyom/the-ruby-object-model-and-metaprogramming)我们在本地 Ruby 用户组中观看了这个。该系列不是免费的，但也不贵。您可能想查看免费预览，看看您是否认为值得花时间。

并给你一个答案。是的，Ruby 中的一切都派生自 Object。[您可以在http://corelib.rubyonrails.org/](http://corelib.rubyonrails.org/)找到关于此的文档。寻找 Object 类。

我不确定你为什么没有获得智能感知，部分原因是你没有指定你的 IDE。您可能不能，因为您已经动态添加了该方法并且没有可用的智能感知。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T21:15:41.953

下载 NetBeans。对 Ruby 和 Ruby on Rails 有完整的智能感知支持。

[http://www.netbeans.org/features/ruby/index.html](http://www.netbeans.org/features/ruby/index.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T16:57:13.083

Ruby 是一种纯 OO 语言，这意味着从类到对象的所有内容都派生自 Object 类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T16:22:53.480

1.  如果我们将 .NET 与 Rails 进行比较，那么是的，那里存在这种层次结构。通常，您可以通过使用模块在任何 Ruby 应用程序中实现这种层次结构。
2.  我想这是因为 Ruby 的动态特性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-18T11:38:47.887

Intellisense 支持可能不会为您提供您认为它会为您提供的服务。因为 Ruby 是一种动态语言，所以 Intellisense 或代码完成是很困难的。您会发现，要么下拉列表中充斥着可能的完成，因此毫无用处。或者在你的情况下什么都没有。

它不是 100% 没用的，但我从未发现它非常有价值。

# sql - Database Bejeweled Puzzle - 这个解决方案是如何工作的？

> ID：375078
> 
> 赞同：0
> 
> 时间：2008-12-17T16:10:28.730
> 
> 标签：sql, database, matrix

我对 Bejewelled 游戏带来的编程挑战很感兴趣。它看起来像一个简单的游戏，但在编程上它看起来更复杂。

在寻找有关如何评估董事会的提示时，我遇到了 Simple-Talk 的好人提出的[这个测验。](http://www.simple-talk.com/content/print.aspx?article=580)他们已经发布了获胜的答案，但是如果我真的能理解解决方案的工作原理，我会感到很震惊。我可以看到它与矩阵有关，并将单元格值与其行和列分组在一起，但这是我到目前为止所获得的。任何人都可以为我进一步分解它吗？

发布的解决方案（测验的详细信息在上面的链接中）：

```
--====== Table matches needs to be loaded only once
CREATE TABLE matches(offsetRow1 INT, offsetCol1 INT, offsetRow2 INT, ofsetCol2 INT, directions VARCHAR(20))
-- for horizontal 
INSERT INTO matches VALUES(-1, -1, -1, -2, 'up')
INSERT INTO matches VALUES(-1, -1, -1, 1, 'up')
INSERT INTO matches VALUES(-1, 1, -1, 2, 'up')        
INSERT INTO matches VALUES( 1, -1, 1, -2, 'down')           
INSERT INTO matches VALUES( 1, -1, 1, 1, 'down')
INSERT INTO matches VALUES( 1, 1, 1, 2, 'down')       
INSERT INTO matches VALUES( 0, -2, 0, -3, 'left')     
INSERT INTO matches VALUES( 0, 2, 0, 3, 'right')            
-- for verical
INSERT INTO matches VALUES(-2, -1, -1, -1, 'left')
INSERT INTO matches VALUES(-1, -1, 1, -1, 'left')
INSERT INTO matches VALUES( 1, -1, 2, -1, 'left')
INSERT INTO matches VALUES(-2, 1, -1, 1, 'right')
INSERT INTO matches VALUES(-1, 1, 1, 1, 'right')
INSERT INTO matches VALUES( 1, 1, 2, 1, 'right')
INSERT INTO matches VALUES(-2, 0, -3, 0, 'up')
INSERT INTO matches VALUES( 2, 0, 3, 0, 'down')

--==================================================
;WITH CTE
      AS
  (
  SELECT
        [Row] = CAST( [#] AS INT ),
        [Col] = CAST( [Col] AS INT ),
        [Value]
    FROM bejeweled
        UNPIVOT ([Value] FOR [Col] IN ([1],[2],[3],[4],[5],[6],[7],[8],[9])) unpvt
  )
SELECT DISTINCT T.Row, T.Col, T.Value, directions
  FROM CTE T
      JOIN CTE T1
      ON T.Value = T1.Value
      JOIN CTE T2
      ON T.Value = T2.Value
      JOIN matches
      ON (T1.Row - T.Row) = offsetRow1
    AND (T1.Col - T.Col) = offsetCol1
    AND (T2.Row - T.Row) = offsetRow2
    AND (T2.Col - T.Col) = ofsetCol2
  ORDER BY T.Row, T.Col 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T17:30:04.887

unpivot 函数将原始数据转换为线性列表而不是矩阵。例如，由于原始列中 1,1 的值为 8，因此新表的第一行是 1,1,8 。同样，由于原始表的第一行的第二列是 5，所以我们的新表的第二行是 1,2,5 。

“With CTE”有效地创建了一个名为 CTE 的内存表，因此这个新的 3 列 81 行表称为 CTE。

逻辑发生在内部连接：CTE 中的每个单元格都连接到 CTE 中值匹配的每个单元格，并再次连接到值匹配的自身。这意味着原始表中的每个单元格都知道所有其他可能的三项匹配。也就是说，返回包含值“1”（例如）的 3 个单元格列表的每个排列。

让我们看看值 2。在 (6,2) 处有一个，在 (5,3) 处有另一个，在 (7,3) 处有另一个，因此内部连接的可能值之一是 T.Row 为 6 ，T.Col 为 2，T1.Row 为 5，T1.Col 为 3，T2.Row 为 7，T2.Col 为 3。我们通过查看它知道将 (6,2) 与 (6,3) 交换) 将三个连续。但是 JOIN 语句是怎么知道的呢？

好吧，有效的举动是将 T 置于 T1 和 T2 之间。确定我们的 3 组合是否满足的最简单方法是检查偏移量并将其与有效的相对位置列表进行比较。T1 在 T (-1,1) 的上方和右侧，T2 在 T (1,1) 的下方和右侧。我们检查 (-1,1,1,1) 是否是有效匹配。是的，因此它通过了 JOIN 标准并作为结果保留。

# asp.net - Asp.Net 水平子菜单

> ID：375079
> 
> 赞同：2
> 
> 时间：2008-12-17T16:10:34.737
> 
> 标签：asp.net, alignment, aspmenu

如何在保持顶部菜单水平的同时创建一个具有水平子菜单而不是垂直子菜单的 asp:Menu？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T23:32:31.703

您可能想研究使用[CSS Friendly Adapters](http://www.codeplex.com/cssfriendly)。Menu 适配器将使用语义 HTML（在本例中为无序列表）而不是表格来呈现 asp:Menu 控件，这使得应用 CSS 使其执行您需要执行的任何操作变得更加容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T19:29:45.740

asp.net 菜单只生成一个表。做这样的事情：

```
<div id="nav"><asp:menu .... /></div> 
```

在你的样式表中做这样的事情：

```
#nav table { display: inline-block }
#nav tr { display: inline-block }
#nav td { display: inline-block } 
```

您可以通过将所有参数传递给 asp:menu 并为每个静态和动态菜单项提供一个单独的类并将它们全部设置样式来获得真正的幻想。

当所有其他方法都失败时，在页面加载时使用 jQuery 修复它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-04T09:29:15.380

```
#nav table { display: inline-block }
#nav tr { display: inline-block }
#nav td { display: inline-block } 
```

此解决方案适用于 mozilla 但不适用于 IE :(

# licensing - 您如何管理软件序列号、许可证等？

> ID：375080
> 
> 赞同：7
> 
> 时间：2008-12-17T16:10:39.523
> 
> 标签：licensing, license-key

我的公司正在尝试寻找一种工具来跟踪我们购买的软件（例如 Office）以及我们编写和销售的软件的序列号。

我们需要允许我们将特定计算机与该计算机上的软件以及该软件的序列号和许可证相关联的软件。我们还想跟踪计算机的历史记录，例如从计算机中删除软件并转移到另一台计算机的时间。

我查看了 Google 和各种软件站点，但我发现的所有结果都是针对软件许可和创建序列密钥，而不是管理这些工具生成的序列密钥。我知道这个问题已经解决了；许多公司许可软件并保存它们生成的序列密钥的记录。所以我很好奇你们中是否有人在不编写自己的定制软件的情况下解决了同样的问题？

**编辑：**我忘了提一下，我不是在问许可软件的优点——我们编写的软件不是 COTS 并且购买受合同级别的控制。尽管如此，我们仍需要管理如何生成串行密钥。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T02:05:31.803

看看SpiceWorks：

[http://www.spiceworks.com/](http://www.spiceworks.com/)

它不仅仅是库存/资产管理，而且是免费的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T16:40:04.177

几个选项（包括您不想要的选项）：

1.  为此编写您自己的数据库；也许是一个使用 SQLite 的简单应用程序。（不是很吸引人，但也不难）

2.  您只需要一个允许您创建名称：值对并将它们分配到组中的应用程序。一个可定制的地址簿将在紧要关头工作。每个联系人可以是程序名称或以许可证/序列号作为数据的客户名称。然后您可以按计算机、客户等进行分组。

这听起来像是 Access（以及类似的程序）旨在解决的经典问题。您从访问开始，使用它几年，然后当您超出该解决方案时雇用某人将数据移植到自定义应用程序中。

我会非常想尝试使用通讯簿程序来启动它。（注意：我在脑海中使用 Apple 的地址簿程序来引用功能）它允许自定义字段、注释和组。缺点是您必须做更多工作：搜索序列号的一部分以确保它尚未使用，手动向两个“联系人”添加注释，指示许可证从一个转移到另一个。

另一方面，如果您自己的软件的许可证跟踪对您的业务至关重要，那么在 SQL 数据库之上开发自定义应用程序可能值得您花时间和金钱。写下你想要做的所有事情的清单。返回并写下任何规则或限制（例如，两台或多台机器可以拥有相同的许可证吗？）。数据库模式和编程规则将直接包含在该文档中。

另一个想法：跟踪书籍、dvd 等的程序。主要是允许您记录何时将它们借给他人的程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-20T15:53:11.560

我的建议是 PassPack - 我们将它们用于密码管理，它们非常棒。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T16:28:11.533

不是现成的，而是像 MySQL 或 OpenOffice Base（或 Access，bleah）这样的数据库？如果您不是在寻找很多多余的装饰，这听起来很简单。只有几个表，例如用户、计算机、软件类型、许可证密钥和交叉表，以将它们相互关联。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T16:39:04.350

这可能很有用，但我没有将它用于您要查找的内容：

[http://www.ezasset.com/i/front.html?page=front_ezindex](http://www.ezasset.com/i/front.html?page=front_ezindex)

您可以通过多种方式来处理这个问题——也许许可证也被视为一种资产（而不仅仅是一台计算机），而您将这些资产组合在一起？

我认为有一个母资产和子资产的概念。最多可免费使用 100 种资产。还处理分配和位置。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-17T16:43:42.797

[我过去使用](http://www.productivecomputing.com/cart/productdetail.php?ID=36)过它并且对此非常满意。缺点是它在 FileMaker 中运行

# ruby-on-rails - RoR： has_one “或其他”？（或者，没有继承的多态性。）

> ID：375083
> 
> 赞同：8
> 
> 时间：2008-12-17T16:12:50.830
> 
> 标签：ruby-on-rails, activerecord, polymorphism, polymorphic-associations, has-one

大家好，我的项目有一些有趣的要求。我需要一种`has_one`关系，它要么是一个类，要么是另一个类，但没有继承。如果这是唯一的方法，我可以摆脱继承，但是两个关联记录具有完全不同的数据并且根本不相关。

我需要弄清楚的是以下内容。

```
# 1\. Foo never belongs to anything.
# 2\. Foo MUST have one assigned sub-record for validity.
# 3\. Foo can only have either Bar or Baz assigned.
# 4\. Bar and Baz have only ONE common property, and aren't
#    related in either data or implementation.

class Foo < ActiveRecord::Base
  # Attributes: id, name, value
  has_one :assignment, :foreign_key => 'assigned_to', :readonly => true
          # Could really use an :object_type for has_one here...
end

class Bar < ActiveRecord::Base
  # Attributes: name,...
end

class Baz < ActiveRecord::Base
  # Attributes: name,...
end 
```

Where`Foo`有一个赋值，类型为`Bar`or `Baz`; 它们只共享一个公共列，所以也许我可以从中创建一个父对象。但是，如果我让它们继承自一个通用对象（当它们包含的数据确实是橙子和苹果时）我必须为记录制作一个表吗？如果记录是抽象记录，但孩子们不是，我可以侥幸逃脱吗？

我想现在你可以看到我的困难了。我对 RoR 很陌生，但到目前为止我很喜欢它。我敢肯定有办法解决这个问题，但如果我无法弄清楚它是什么，我会被诅咒的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T16:38:04.307

您正在尝试对不符合关系数据库范式的东西进行建模。SQL 中的所有引用都有一个来源和一个目标。

FWIW，多态关联也是一种反模式，因为它打破了这条规则。*当文档*说您必须放弃参照完整性约束才能使其工作时，这应该是一个线索，表明它是一个损坏的设计！

**您需要 Foo 有两种`has_one`关系**：一种与 Bar，另一种与 Baz。然后实现一些类逻辑，以确保在任何 Foo 实例中只填充一个引用。也就是说，在对 Bar 和 Baz 的引用中，一个必须有值，另一个必须为零，但这是您的代码需要检查和执行的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T16:31:39.547

也许做到这一点的一种方法是在 Foo 中为 Bar 和 Baz 创建 to has-one 关联。然后创建一个名为 assignment 和 assignment= 的方法，这是访问 Bar 和 Baz 的唯一方法。您可以在 get 方法中检查两个 has_ones 中的哪一个不是 nil 并返回那个。在赋值方法中，您可以检查传入的变量的类型，并将正确的 has-one 关系设置为该对象并将另一个设置为 nil。这应该涵盖你所有的基础，而不会太复杂。

# sql - 有没有办法用月份数字而不是月份名称来搜索 SQL 查询？

> ID：375086
> 
> 赞同：1
> 
> 时间：2008-12-17T16:13:39.457
> 
> 标签：sql, mysql, sql-server

我正在尝试在 sql 查询中使用月份的实际数值来提取结果。有没有办法做到这一点，而无需将数字更改为实际月份名称，然后返回月份数字？以下代码适用于名称，什么适用于数字？

> 日期名称（月，（转换（日期时间，DTSTAMP）））='十月'

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T16:17:34.597

month,(convert(datetime,DTSTAMP)) 应该这样做，但是为什么您没有正确地将数据存储为日期时间呢？所有使用日期的额外转换内容都会给您的服务器增加不必要的负载并减慢您的应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T23:11:05.277

[Datepart](http://msdn.microsoft.com/en-us/library/aa258265(SQL.80).aspx)是月份命令的替代品，它更灵活，因为您可以提取日期的其他部分。

```
DATEPART(mm, convert(datetime,DTSTAMP)) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T08:43:17.477

获取日期的月份数

转换（VARCHAR（2），DTSTAMP，110）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-07T06:42:40.447

在这里，您可以使用 diff 选项进行搜索，例如：

DATE_SUB（CURDATE（），间隔 0 天）

DATE_SUB（CURDATE（），间隔 1 个月）

DATE_SUB（CURDATE（），间隔 1 年）

根据您的要求。

# c# - ASP.NET：可以创建包含内部标记内容的用户控件吗？

> ID：375093
> 
> 赞同：3
> 
> 时间：2008-12-17T16:17:33.083
> 
> 标签：c#, asp.net, user-controls

我正在尝试实现谷歌无法给出答案的东西。我正在尝试创建一个 asp.net 用户控件，当我将内容放入其中时，它的打开关闭标签将包含它，以便我仍然能够通过父 ID 访问它的内容。这是我想要实现的一个例子。

用户控制：

```
<%@ Control Language="C#" AutoEventWireup="true" CodeFile="ctrlGENE_CollapsiblePanel.ascx.cs"
    Inherits="Controls_GenericsControls_ctrlGENE_CollapsiblePanel" %>
<asp:Panel ID="pnlHeader" CssClass="SnapPanelHeader" runat="server">
    <h3>
        <asp:Literal ID="litTitle" Text='<%# Text %>' runat="server" />
    </h3>
    <div class="SnapPanelHeader-img">
        <img id="imgOpenClose" src="/images/application/close.jpg" alt="" />
    </div>
</asp:Panel>
<asp:PlaceHolder runat="server" ID="pnlContent">
// **HERE I WANT TO INCLUDE THE INSIDE MARKUP**
</asp:PlaceHolder>
<act:CollapsiblePanelExtender runat="server" TargetControlID="pnlContent" ImageControlID="imgOpenClose"
    ExpandControlID="imgOpenClose" CollapseControlID="imgOpenClose" CollapsedImage="/images/application/open.jpg"
    ExpandedImage="/images/application/close.jpg" CollapsedSize="0" TextLabelID="litTitle">
</act:CollapsiblePanelExtender> 
```

包含控件的父页面：

```
<uc:MyUserControl ID="clpTest" runat="server">
     <asp:Literal ID="litText" runat="server" />
</uc:MyUserControl> 
```

像这样我可以在 Parent.cs 文件中执行以下操作：

```
litText.Text = "Anything"; 
```

我知道我们可以实现与 ITemplate 接口类似的东西，如下所示：http: [//msdn.microsoft.com/en-us/library/36574bf6.aspx](http://msdn.microsoft.com/en-us/library/36574bf6.aspx)

看起来像这样：

```
<uc:MyUserControl ID="clpTest" runat="server">
     <ItemTemplate>
          <asp:Literal ID="litText" runat="server" />
     </ItemTemplate>
</uc:MyUserControl> 
```

但是如果我这样做，我将无法访问 litText 的属性，而我可以访问它的唯一方法是使用 FindControl，我想避免这种情况。

如果我能以一种或另一种方式达到我的目标，有人对此有什么暗示吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T22:37:30.913

好的，我在这里修复它是我使用的解决方案：

在 MyUserConstrol.ascx 文件中，我在希望显示 innerHTML 的位置放置了一个占位符：

```
<asp:PlaceHolder runat="server" ID="plhContent" /> 
```

然后在 MyUserControl.ascx.cs 文件中，我将这些属性添加到类中：

```
[ParseChildren(false)]
[PersistChildren(true)] 
```

我在文件中添加了这个：

```
public void RegisterUpdatePanel(UpdatePanel panel)
{
    MethodInfo m =
        (from methods in typeof (ScriptManager).GetMethods(BindingFlags.NonPublic | BindingFlags.Instance)
         where methods.Name.Equals("System.Web.UI.IScriptManagerInternal.RegisterUpdatePanel")
         select methods).First();

    m.Invoke(ScriptManager.GetCurrent(Page), new object[] {panel});
}

protected override void CreateChildControls()
{
    for (int i = 0; i < Controls.Count; i++)
        if (Controls[i] is MyLastControl)
            while (i + 2 < Controls.Count)
            {
                // In cas there is an updatepanel in the control we are moving
                // We are registering an event to register the updatepanel
                // to the scriptmanager again
                SearchUpdatePanel(Controls[i + 2]);
                plhContent.Controls.Add(Controls[i + 2]);
            }
    base.CreateChildControls();
}

private void SearchUpdatePanel(Control control)
{
    if (control is UpdatePanel)
        control.Unload += updPnl_Unload;

    foreach (Control childcontrol in control.Controls)
        SearchUpdatePanel(childcontrol);
}

protected void updPnl_Unload(object sender, EventArgs e)
{
    RegisterUpdatePanel((UpdatePanel) sender);
} 
```

请注意，我在 ascx 文件 myLastContol 中命名了我的最后一个控件，以了解在 innerHTML 注入之前的控件是什么，因为我不知道我收到了什么。该过程基本上说在UserControl中的控件中循环，当您到达UserControl的末尾时，之后的所有内容都是来自父级的innerHTML，因此将它们移动到我想要它们的占位符。

我希望这会对某人有所帮助。

以下是我用来实现目标的一些资源： [注册 UpdatePanel](http://msmvps.com/blogs/luisabreu/archive/2006/11/16/adding-removing-updatepanels-dynamicaly-from-a-page.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T17:02:38.967

在用户控件的代码隐藏文件中添加公共属性。如果您需要设计时支持，则涉及更多工作，但对于您概述的简单场景，它应该足够了。

然后只需在父页面中访问它以设置值并在用户控件中读取它并使用该值来呈现您需要的任何内容。

# apache-flex - Flex：在flex中隐藏组件时

> ID：375100
> 
> 赞同：14
> 
> 时间：2008-12-17T16:18:57.777
> 
> 标签：apache-flex, actionscript-3

当我将组件设置为 visible=false 时，组件会隐藏，但是如何让它不占用空间（让它所属的容器调整大小？？）

```
<mx:HBox width="100%" height="100%">
...
</mx:HBox>

<mx:HBox width="100%" id="boxAddComment" visible="false" >
    <mx:TextArea id="txtComment"/>
    <mx:Button label="Spara" click="addComment();"/>
</mx:HBox> 
```

当 boxAddComment 为 visible=false 时，我希望第一个 HBox 采用 100% 的高度。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-17T16:26:00.040

使用**includeInLayout**属性。例如

```
 <mx:HBox width="100%" height="100%">
...
</mx:HBox>

<mx:HBox width="100%" id="boxAddComment" visible="false" includeInLayout="false" >
    <mx:TextArea id="txtComment"/>
    <mx:Button label="Spara" click="addComment();"/>
</mx:HBox> 

```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-17T20:03:56.683

使用`includeInLayout ="true"`or`"false"`将切换它在该部分中呈现的项目流中占用的空间。

**重要提示：**如果您未指定`visible="false"`何时使用，`includeInLayout = "false"`那么您通常会得到一些不想要的东西，即您的项目 ( `boxAddComment`) 在页面上仍然可见，但下面的内容`id="boxAddComment"`会在视觉上重叠。所以，一般来说，您可能希望 " `includeInLayout`" 和 " `visible`" 保持同步。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-09T20:21:02.057

Ross Henderson 在将 includeInLayout 与 boxAddComment.visible 绑定时的建议在 Flex 3.0 中效果很好，但我发现它在 Flex 3.6 中不起作用（我看到一个帖子，它实际上从 Flex 3.3 开始停止工作）。

仅供参考。

# apache-flex - 如何根据另一个 itemRenderer 中的操作更改 itemRenderer 中的状态？

> ID：375103
> 
> 赞同：0
> 
> 时间：2008-12-17T16:19:46.653
> 
> 标签：apache-flex, actionscript, datagrid, itemrenderer

我有一个带有 ItemRenderer 的 DataGridColumn，它扩展了 Box 组件。默认显示是一个文本组件。当用户单击文本组件时，我将状态更改为添加一个 PopUpMenuButton 子项，并使文本组件不可见。这工作正常。但是，我只想让一个 PopUpMenuButton 一次在 DataGrid 中可见（类似于 itemEditor 的工作方式）。我不想使用 itemEditor，因为我遇到了太多问题，试图让它在这种情况下工作。

我正在我的 itemRenderer 中实现 IDropInListItemRenderer，以便访问 listData 属性，这将为我提供所有者（DataGrid），但我不知道如何“关闭”DataGrid 中其他 itemRenderers 中的“编辑”状态。

我怎样才能做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T19:14:59.653

开始了。我只是在 listData.owner 中添加了一个更改事件的侦听器——如果它被触发，我将 currentState 更新为 null。奇迹般有效。比尝试访问列中的 itemRenderers 并将它们全部重置要容易得多。在性能上也更好。

```
private function label_clickHandler():void
{
    showEditor();
}

private function showEditor():void
{
    this.currentState = "editingMode";

    var ownerListBase:ListBase = ListBase(listData.owner);

    ownerListBase.addEventListener(ListEvent.CHANGE, ownerListBase_changeHandler);
}

private function ownerListBase_changeHandler(event:ListEvent):void
{
    this.currentState = null;

    var ownerListBase:ListBase = ListBase(listData.owner);

    ownerListBase.removeEventListener(ListEvent.CHANGE, ownerListBase_changeHandler);
} 
```

# regex - 如何将引号分隔的字符串与正则表达式匹配？

> ID：375104
> 
> 赞同：42
> 
> 时间：2008-12-17T16:19:55.170
> 
> 标签：regex, perl

如果我尝试将引号分隔的字符串与正则表达式匹配，则以下哪个是“更好”（其中“更好”意味着更高效且不太可能做意外的事情）：

```
/"[^"]+"/ # match quote, then everything that's not a quote, then a quote 
```

或者

```
/".+?"/   # match quote, then *anything* (non-greedy), then a quote 
```

假设这个问题空字符串（即“”）不是问题。在我看来（不是正则表达式新手，但肯定不是专家）这些将是等价的。

**更新**：经过反思，我认为将`+`字符更改为`*`无论如何都会正确处理空字符串。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-12-18T10:45:54.703

你应该使用第一，因为第二是不好的做法。考虑追随您的开发人员想要匹配后跟感叹号的字符串。他应该使用：

```
"[^"]*"! 
```

或者：

```
".*?"! 
```

当您有主题时会出现差异：

```
"one" "two"! 
```

第一个正则表达式匹配：

```
"two"! 
```

而第二个正则表达式匹配：

```
"one" "two"! 
```

始终尽可能具体。尽可能使用否定字符类。

另一个区别是 [^"]* 可以跨行，而 .* 则不能，除非您使用单行模式。 [^"\n]* 也排除了换行符。

至于回溯，第二个正则表达式回溯它匹配的每个字符串中的每个字符。如果缺少右引号，则两个正则表达式都将回溯整个文件。只有回溯的顺序不同。因此，理论上，第一个正则表达式更快。在实践中，您不会注意到差异。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-06-21T09:17:28.280

更复杂，但它处理转义引号和转义反斜杠（转义反斜杠后跟引号不是问题）

```
/(["'])((\\{2})*|(.*?[^\\](\\{2})*))\1/ 
```

示例：
  **"hello\"world"**匹配**"hello\"world"**
  **"hello\\"world"**匹配**"hello\\"**

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-17T17:37:24.140

我会建议：

```
([\"'])(?:\\\1|.)*?\1 
```

但仅仅是因为它处理转义的引号字符并允许 ' 和 " 成为引号字符。我还建议查看这篇深入探讨这个问题的文章：

[http://blog.stevenlevithan.com/archives/match-quoted-string](http://blog.stevenlevithan.com/archives/match-quoted-string)

但是，除非您遇到严重的性能问题或无法确定嵌入的引号，否则请使用更简单且更易读的：

```
/".*?"/ 
```

我必须承认，非贪婪模式不是基本的 Unix 风格的“ed”正则表达式，但它们越来越普遍。我仍然不习惯对 (?:stuff) 之类的运算符进行分组。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-17T16:38:14.353

我会说第二个更好，因为当终止`"`丢失时它会更快地失败。第一个将回溯字符串，这是一个潜在的昂贵操作。如果您使用 perl 5.10，另一种正则表达式是`/"[^"]++"/`. 它传达了与版本 1 相同的含义，但与版本 2 一样快。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-17T16:27:23.470

我会选择第二个，因为它更容易阅读。但我仍然想匹配空字符串，所以我会使用：

```
/".*?"/ 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T17:27:17.250

从性能的角度来看（在长字符串上非常繁重、长时间运行的循环），我可以想象

```
"[^"]*" 
```

比

```
".*?" 
```

因为后者会为每一步做额外的检查：偷看下一个字符。前者将能够无意识地滚动字符串。

正如我所说，在现实世界的场景中，这几乎不会被注意到。因此我会选择第二个（如果我当前的正则表达式支持它），因为它更具可读性。否则，当然是第一名。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-29T18:04:30.127

当边界字符（在您的示例中为双引号）出现在输入中的其他位置时，使用否定字符类可防止匹配。

你的例子#1：

`/"[^"]+"/ # match quote, then everything that's not a quote, then a quote`

只匹配最小的一对匹配的引号——非常好，而且大多数时候这就是你所需要的。但是，如果您有嵌套引号，并且您对最大的匹配引号对（或所有匹配的引号）感兴趣，那么您的情况要复杂得多。

幸运的是，Damian Conway 已准备好进行救援：如果您发现有多个匹配的引号，[Text::Balanced就在那里。](http://search.cpan.org/search?query=text+balanced)它还具有匹配其他成对标点符号的优点，例如括号。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-17T16:32:02.913

我更喜欢第一个正则表达式，但这当然是一个口味问题。

第一个可能更有效？

```
Search for double-quote
add double-quote to group
for each char:
    if double-quote:
        break
    add to group
add double-quote to group 
```

与涉及回溯的更复杂的东西相比？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-17T16:40:27.453

考虑到我什至不知道“*？” 直到今天，我已经使用正则表达式 20 多年了，我会投票赞成第一个。它确实清楚地说明了您要做什么 - 您正在尝试匹配一个不包含引号的字符串。

# c# - 在 C# 中对 Windows 应用程序进行屏幕抓取

> ID：375117
> 
> 赞同：12
> 
> 时间：2008-12-17T16:22:50.263
> 
> 标签：c#, .net, screen-scraping

我需要从 Windows 应用程序中抓取数据以在另一个程序中运行查询。有谁知道我在 .NET 中执行此操作的一个很好的起点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-17T16:40:08.467

您可能想查看[WM_GETTEXT 消息](http://msdn.microsoft.com/en-us/library/ms632627(VS.85).aspx)。这可[用于从其他窗口读取文本](http://msdn.microsoft.com/en-us/magazine/cc301438.aspx)——它是 Windows API 的一个古老部分，如果您使用 C#，则需要为它 p/invoke。

查看[此页面](http://answers.google.com/answers/threadview/id/759776.html)以获取在 C# 中执行此操作的示例。

基本上，您首先 FindControlEx() 来获取您想要的窗口句柄（通过标题）。

其次，您使用 EnumChildWindows() 递归地枚举该窗口上的控件，以查找该窗口的所有子控件以及所有这些子控件的子控件，直到您获得目标窗体的完整映射。

以下是来自 Google Answers的[Theta-ga 出色解释的一部分：](http://answers.google.com/answers/threadview/id/759776.html)

*要获取任何文本框或列表框控件的内容，我们只需要它的窗口句柄。如果您已经获得了窗口句柄，请转到说明的第 2 部分。*

***第 1 部分：获取控制句柄***

*   *要获得一个控件的句柄，我们首先要获得它的父窗口的句柄。我们可以通过使用 Win32 FindControlEx() 方法来做到这一点。此方法接受窗口标题（例如“计算器”）和/或其类名，并返回其句柄。*
*   *一旦我们有了父窗口句柄，我们就可以调用 Win32 EnumChildWindows 方法。此方法接受一个回调方法，它使用为指定父项找到的每个子控件的句柄调用该方法。例如，如果我们用计算器窗口的句柄调用这个方法，它会用文本框控件的句柄调用回调方法，然后再用计算器窗口上每个按钮的句柄调用回调方法，以此类推.*
*   *由于我们只对文本框控件的句柄感兴趣，我们可以在回调方法中查看窗口的类。Win32 方法 GetClassName() 可用于此。这个方法接受一个窗口句柄，并为我们提供一个包含类名的字符串。所以一个文本框属于？编辑？类，“ListBox”类的列表框等等。一旦您确定您拥有正确控件的句柄，您就可以阅读其内容。*

***第 2 部分：读取控件的内容***

*   *您可以使用 Win32 SendMessage() 函数读取控件的内容，并使用它将 WM_GETTEXT 消息传递给目标控件。这将为您提供控件的文本内容。此方法适用于文本框、按钮或静态控件。*
*   *但是，如果您尝试读取列表框的内容，上述方法将失败。要获取列表框的内容，我们需要首先使用带有 LB_GETCOUNT 消息的 SendMessage() 来获取列表项的计数。然后我们需要为列表中的每个项目调用带有 LB_GETTEXT 消息的 SendMessage()。*

# .net - 在 .NET 1.1 中将包含样式的 HTML 表格转换为 PDF

> ID：375120
> 
> 赞同：1
> 
> 时间：2008-12-17T16:23:07.863
> 
> 标签：.net, pdf, itextsharp

我有同事从事 .NET 1.1 项目，他们从外部获取 XML 文件，并以编程方式指示 iTextSharp 基于 XML 数据生成 PDF 内容。

棘手的部分是，在这个 XML 中是任意 HTML 内容的片段。这些是用户从其 Office 应用程序复制和粘贴的 HTML 代码。在 Web 浏览器上看起来仍然不错，但是当将此 HTML 输入 iTextSharp 的 HTMLWorker 对象以解析并转换为 PDF 对象时，格式和对齐会在生成的 PDF 文档中到处运行。例如

```
<span id="mceBoundaryType" class="portrait"></span>
<table border="0" cellspacing="0" cellpadding="0" width="636" class="MsoNormalTable"
    style="margin: auto auto auto 4.65pt; width: 477pt; border-collapse: collapse">
    <tbody>
        <tr style="height: 15.75pt">
            <td width="468" valign="bottom" style="padding-right: 5.4pt; padding-left: 5.4pt;
                padding-bottom: 0in; width: 351pt; padding-top: 0in; height: 15.75pt; background-color: transparent;
                border: #ece9d8">
                <p style="margin: 0in 0in 0pt" class="MsoNormal">
                    <font face="Times New Roman">&nbsp;</font></p>
            </td>
            <td colspan="3" width="168" valign="bottom" style="padding-right: 5.4pt; padding-left: 5.4pt;
                padding-bottom: 0in; width: 1.75in; padding-top: 0in; height: 15.75pt; background-color: transparent;
                border: #ece9d8">
                <p style="margin: 0in 0in 0pt; text-align: center" class="MsoNormal" align="center">
                    <u><font face="Times New Roman">Group</font></u></p>
            </td>
        </tr> 
```

标签充满了 Style 属性，iTextSharp 不支持 CSS 和解释该属性。其他 iTextSharp 用户尝试解决此问题或其他可行的 HTML-to-PDF 组件有哪些替代方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T04:00:34.023

我发现[ExpertPDF](http://www.html-to-pdf.net/)和[ABCpdf](http://www.websupergoo.com/products.htm#pd)等基于 .NET 2.0 的组件在解释 CSS 样式和在 PDF 中正确对齐表格方面做得相当好。现在，我建议我的同事使用可以使用此类组件的单独 .NET 2.0 Web 服务，ASP.NET 1.1 Web 应用程序将通知该服务继续抓取生成的网页，该网页本质上是报告在 HTML 视图中。

更新：

这是答案，因为它是提供给应用程序团队的推荐方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T16:43:48.460

我没有任何可靠的答案，但我会给你两个探索的方向，这两个方向都是我以前用过的。

[1 - 使用HtmlAgilityPack](http://www.codeplex.com/htmlagilitypack)之类的东西来清理你的 HTML - 你可以遍历 DOM 并删除样式和类，这显然会在一定程度上搞砸布局。我不清楚您是否需要保留这种样式。[然后，您可以使用 iTextSharp 或HtmlDoc 之](http://www.easysw.com/htmldoc/)类的替代程序（也不支持 CSS）来呈现为 PDF。我们用一个接受 URL 的方法编写了一个简单的包装器，然后调用[Htmldoc](http://www.easysw.com/htmldoc/)来生成 PDF。

2 - 使用 WebBrowser 控件呈现 HTML 服务器端，从中生成图像，然后使用[PDFsharp](http://pdfsharp.com/)或您选择的库将图像转换为 PDF。这显然不会为您提供可以搜索或复制文本的 PDF。[这里](http://www.tommyt.se/post/Small-update-Website-Snapshot.aspx)有一些非常好的示例代码，用于将呈现的页面转换为图像（注意：您可以获得全高图像，而不仅仅是您可以在不滚动的情况下看到的图像）。

编辑：我认为 WebBrowser 控件在 .NET 1.1 中不可用。

# java - 配置速度以使用 toString 以外的东西渲染对象？

> ID：375128
> 
> 赞同：1
> 
> 时间：2008-12-17T16:28:09.223
> 
> 标签：java, templates, velocity, tostring, webwork

有没有办法将 Velocity 配置为使用 toString() 以外的东西将对象转换为模板中的字符串？例如，假设我正在使用带有 format() 方法的简单日期类，并且每次都使用相同的格式。如果我所有的速度代码如下所示：

```
$someDate.format('M-D-yyyy') 
```

有没有我可以添加的配置让我说

```
$someDate 
```

反而？（假设我不能只编辑日期类并给它一个适当的 toString()）。

如果有帮助，我将在使用 WebWork 构建的 web 应用程序的上下文中执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T03:49:10.863

Velocity 允许使用类似 JSTL 的实用程序，称为 velocimacros：

[http://velocity.apache.org/engine/devel/user-guide.html#Velocimacros](http://velocity.apache.org/engine/devel/user-guide.html#Velocimacros)

这将允许您定义一个宏，如：

```
#macro( d $date)
   $date.format('M-D-yyyy')
#end 
```

然后这样称呼它：

```
#d($someDate) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:47:14.500

您还可以创建自己的 ReferenceInsertionEventHandler 来监视您的日期并自动为您进行格式化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T22:49:14.217

哦，1.6+ 版本的 Velocity 有一个新的 Renderable 接口。如果您不介意将日期类绑定到 Velocity API，那么实现此接口，Velocity 将使用 render(context, writer) 方法（对于您的情况，您只需忽略上下文并使用 writer）而不是 toString( ）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-06-22T21:38:52.057

我也遇到了这个问题，我能够根据[Nathan Bubna 的回答](https://stackoverflow.com/questions/375128/configure-velocity-to-render-an-object-with-something-other-than-tostring/505297#505297)来解决它。

我只是想完成提供[Velocity 文档链接](https://click.apache.org/docs/velocity/developer-guide.html#Configuring_Event_Handlers)的答案，该文档解释了如何使用 EventHandlers。

就我而言，每次插入引用时，我都需要为 gson 库中的所有 JsonPrimitive 对象调用 Velocity 调用“getAsString”而不是 toString 方法。

就像创建一个

```
public class JsonPrimitiveReferenceInsertionEventHandler implements ReferenceInsertionEventHandler{

    /* (non-Javadoc)
     * @see org.apache.velocity.app.event.ReferenceInsertionEventHandler#referenceInsert(java.lang.String, java.lang.Object)
     */
    @Override
    public Object referenceInsert(String reference, Object value) {
        if (value != null && value instanceof JsonPrimitive){
            return ((JsonPrimitive)value).getAsString();
        }
        return value;
    }

} 
```

并将事件添加到 VelocityContext

```
vec = new EventCartridge();
vec.addEventHandler(new JsonPrimitiveReferenceInsertionEventHandler());

...

context.attachEventCartridge(vec); 
```

# java - 多线程文件传输到 FTP 服务器

> ID：375129
> 
> 赞同：4
> 
> 时间：2008-12-17T16:28:11.267
> 
> 标签：java, multithreading, ftp

我正在为备份服务器编写客户端。我的客户安排了一些文件夹进行备份。（例如：每个星期五的 X 小时）。我用于调度**cron4j**（Linux cron 到 java 的端口）。

一切正常，直到我同时安排多个上传作业，然后由于多个线程它变得混乱。

谁能帮我解决多线程上传到 ftp 服务器的问题？（每个线程都有在 Ftp 服务器上上传目录的工作）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T20:59:48.973

当你说它有点“混乱”时，你能解释一下你的意思吗？有什么特别的症状吗？

无论如何，从一张干净的表格来看，我会说你想限制你一次执行的并发上传数量，否则你可能会在 FTP 服务器的连接数量方面达到某种限制允许单个客户端，或客户端操作系统将允许的连接数。您的应用程序可能更多地受带宽而非 CPU 的约束，因此运行太多线程可能会适得其反。您实际上将一次上传更多项目，但吞吐量较低。

我假设你的应用程序有一组任务，它们关闭了 cron4j，这些任务然后获取一个目录并通过 FTP 上传，这听起来对吗？

如果是这样，我建议将其分为几个阶段，首先 cron4j 启动构建一个可运行对象的任务，该对象在执行时将执行 FTP 上传，而不是执行上传本身的任务。将此可运行对象放入队列中（来自 java.util.concurrent 的阻塞队列是个好主意）。然后，您在线程池中运行了另一个任务的一些实例，这些任务将从队列中取出作业并执行它们（实验池中的线程数以查看什么可以为您提供良好的吞吐量）。这将为您提供一组竞争消费者，您可以将其限制为并发上传的有效数量（例如，一次 4 个）。

* * *

正如评论中所指出的，SEDA 模式听起来很有趣。如果您打算使用 Java 进行任何并发编程，我建议您获取 Doug Lea 的“Java 中的并发编程：设计原则和模式”的副本，它不包括 Java 5 的东西，但其中大部分是基于什么反正在书里。他清楚地解释了很多关于线程安全以及如何编写好的 Java 代码的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-10T15:54:55.137

ipworks FTP 类是线程安全的。您**必须**阅读 Brian Goetz 的 Java Concurrency in Practice ...

```
public class ServerConnection extends Thread  {

// the connection to the ftp server
private final Ftp connection; 
```

或者，如果您不喜欢自己管理线程，则可以实现 Runnable 并使用[executorService ...](http://download.oracle.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html "执行者服务")

# php - Firefox 中奇怪的重新加载效果

> ID：375132
> 
> 赞同：0
> 
> 时间：2008-12-17T16:28:33.687
> 
> 标签：php, browser, performance, html-select

我有一个由 php 生成的页面，其中包括两个下拉列表 (SELECTs)，其中包含很多项目（每个大约 2,000 个）。该页面很好，但是当它在 Firefox 中加载时，加载过程中有延迟，然后似乎刷新了整个页面。如果用户在“重新加载”发生之前尝试单击任何内容，则没有效果。

在资源管理器中，每个下拉菜单只需要一段时间（一两秒）就会出现，这很好。

有谁知道这是什么吗？而除了使用AJAX动态填充下拉列表，有没有简单的方法可以避免呢？

编辑：附加信息。我已经让我的 PHP 脚本在被调用时输出到日志文件，所以我现在可以看到似乎正在发生的事情是这样的：

调用 PHP 脚本，页面开始加载。几秒钟后，对 PHP 脚本进行了另一个相同的调用，此时页面再次开始加载。这次它完成了加载。所以我想浏览器似乎在页面完成加载之前出于某种原因自动刷新了页面。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T15:09:53.677

首先，您应该使用像 wireshark 这样的网络嗅探器来确认页面确实加载了两次。然后，确认它只发生在 Firefox 上；那么，你就走在了好路上！我经历了 n8wrl 提议的变体；它在一些带有空背景图像属性的 CSS 声明中 --> 检查你的 CSS 是否有空文件声明

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T16:43:13.907

黑暗中的狂野拍摄：您是否有任何带有 BLANK src 的图像或隐藏图像提交按钮？我需要为文本框“伪造”一个“默认输入”效果，并在所有字段之前使用一个隐藏的图像按钮。由于它是隐藏的，我将 src 属性留空。Firefox 两次加载页面！将 src 属性指向一个单像素但真实的图像修复了它。

# sql-server - 如何在 t-sql 中提取部分字符串

> ID：375133
> 
> 赞同：20
> 
> 时间：2008-12-17T16:29:05.150
> 
> 标签：sql-server, tsql, string

如果我有以下 nvarchar 变量 - BTA200，我怎样才能从中提取 BTA？

另外，如果我有不同的长度，例如 BTA50、BTA030，我怎样才能只提取数字部分？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-17T16:39:29.263

我会推荐 PatIndex 和 Left 的组合。精心构造，无论您的数据是什么样子，您都可以编写始终有效的查询。

前任：

```
Declare @Temp Table(Data VarChar(20))

Insert Into @Temp Values('BTA200')
Insert Into @Temp Values('BTA50')
Insert Into @Temp Values('BTA030')
Insert Into @Temp Values('BTA')
Insert Into @Temp Values('123')
Insert Into @Temp Values('X999')

Select Data, Left(Data, PatIndex('%[0-9]%', Data + '1') - 1)
From   @Temp 
```

PatIndex 将查找 0-9 范围内的第一个字符，并返回它的字符位置，您可以使用 LEFT 函数来提取正确的数据。请注意，PatIndex 实际上是使用 Data + '1'。这可以保护我们免受找不到数字的数据的影响。如果没有数字，PatIndex 将返回 0。在这种情况下，LEFT 函数会出错，因为我们使用的是 Left(Data, PatIndex - 1)。当 PatIndex 返回 0 时，我们会以 Left(Data, -1) 结束，它会返回一个错误。

仍然有可能失败的方法。要获得完整的解释，我鼓励您阅读：

[使用 SQL Server 提取数字](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/extracting-numbers-with-sql-server)

那篇文章展示了如何从字符串中获取数字。在您的情况下，您想要获取字母字符。但是，该过程非常相似，您可能可以从中学到一些有用的东西。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T16:41:07.653

substring(field, 1,3) 将适用于您的示例。

```
select substring(field, 1,3) from table 
```

此外，如果字母部分的长度可变，您可以这样做来提取字母部分：

```
select substring(field, 1, PATINDEX('%[1234567890]%', field) -1) 
from table
where PATINDEX('%[1234567890]%', field) > 0 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T16:31:49.967

LEFT ('BTA200', 3) 将适用于您给出的示例，如：

```
SELECT LEFT(MyField, 3)
FROM MyTable 
```

要提取数字部分，您可以使用此代码

```
SELECT RIGHT(MyField, LEN(MyField) - 3)
FROM MyTable
WHERE MyField LIKE 'BTA%' 
--Only have this test if your data does not always start with BTA. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-31T16:11:28.407

```
declare @data as varchar(50)
set @data='ciao335'

--get text
Select Left(@Data, PatIndex('%[0-9]%', @Data + '1') - 1)    ---->>ciao

--get numeric
Select right(@Data, len(@data) - (PatIndex('%[0-9]%', @Data )-1) )   ---->>335 
```

# php - Programmatically combining images in PHP

> ID：375138
> 
> 赞同：3
> 
> 时间：2008-12-17T16:30:18.393
> 
> 标签：php, css, optimization, image

I'm a big fan of Yahoo's [recommendations](http://developer.yahoo.com/performance/rules.html) for speeding up websites. One of the recommendations is to combine images where possible to cut down on size and the number of requests. However, I've noticed that while it can be easy to use CSS sprites for layouts, other image uses aren't as easily combined. The primary example I'm thinking of is a blog or article list, where each blog or article also has an image associated with it. Those images can greatly affect load time and page size, especially if they aren't optimized. What I'm looking for, in concept or in practice, is a way to dynamically combine those images while running them through a loss-less compression using PHP.

A few added thoughts or concerns:

*   Combining the images and generating a dynamic CSS stylesheet to position the backgrounds of the images might be one way to go about it, but I also worry about accessibility and semantics. As far as I understand, CSS images should be used for layout elements and the img tag (with the alt attribute) should be used for images that are meant to convey information. I could set the image as a background to a div element and substitute a title attribute for the alt attribute, but I'm unsure about the accessibility and semantic implications of doing so.
*   Might the GD library be a good candidate for something like this? Can you recommend other options?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T16:46:43.727

I wouldn't go down this route if I were you. Sure, you may save a few bytes in protocol overhead by reducing the number of requests, but this would more-tha-likely end up being self-defeating.

Imagine this scenario: A blog site, whose front page has 10 articles at a time. Each article has it's own image associated with it. To save a byte or two of transfer time, you programatically create a composite image of all 10 article images. You now have one of two problems.

1.  You must update the composite image each time a new post is made, as the most recent 10 images will have a modified set of content.
2.  You decide to create a new composite each request, on the fly.

Obviously, #1 is preferable here, and would not be difficult to implement. However, what if a user searches for all posts tagged with the word "SQL"? You are unlikely to have a composite image of the first 10 results already created for this simple query, let alone a more complex one. Also, what happens if you want to update or delete an image? Once again you'd have to trigger the background creation of the composite.

How about an RSS aggregator, like Google Reader? It wouldn't have the required logic to figure out which portion of a composite image it would need to display, and would probably display the full image. (I mention Google Reader because I very rarely visit blog sites directly, tending to trust to an RSS aggregation service like Reader)

If it were me, I'd leave the single images alone. With modern connection speeds, the tradeoff between additional bandwidth overhead and on-server processing time is unlikely to win you and great gains.

Having said that, if you decide to go down this route anyway, I'd say the GD library is an excellent place to start.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T16:49:15.627

You'd almost certainly be better off reducing the filesize of the images in articles, than combine them. I'd agree that there might be accessibility issues with the method you suggest. Also, I suppose it depends on what you mean by "dynamic" - if you're thinking of combining those images and generating CSS for each page load, you might well find that that results in slower page load times for users with average connection speeds.

As to your second point, GD could certainly handle that. A better use of GD for reducing page load times might be reducing the image quality of your article images to reduce filesizes, at article creation time, not at page load.

# c++ - 如何将方法结果作为参数传递给 C++ 中的基类构造函数？

> ID：375141
> 
> 赞同：2
> 
> 时间：2008-12-17T16:31:16.567
> 
> 标签：c++, inheritance, constructor, initialization, composition

我试图实现这样的目标：

```
class Base
{
  public:

  Base(string S) 
  {
  ...
  };
}

class Derived: Base
{
public:
  int foo;
  string bar()
  {
    return stringof(foo); // actually, something more complex
  };

  Derived(int f) : foo(f), Base(bar()) 
  {
  };
} 
```

现在，这不能按我的意愿工作，因为在初始化 foo 之前在 Derived 构造函数中调用了 bar() 。

我考虑添加一个类似于 bar() 的静态函数，它以 foo 作为参数 - 并在初始化列表中使用它，但我想我会问是否有任何其他技术可以用来从这个中挖掘自己。 ..

**编辑**：感谢您的反馈 - 这是我将如何处理静态函数。不确定静态和非静态函数之间的重载是否太聪明了，但是......

```
class Derived: Base
{
public:
  int foo;

  static string bar(int f)
  {
    return stringof(f); // actually, something more complex
  }

  string bar()
  {
    return bar(foo); 
  };

  Derived(int f) :  Base(bar(f)) , foo(f)
  {
  };
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T16:38:57.707

是的，使用以*foo*作为参数并返回字符串的函数（静态类方法或常规函数）是一个很好的解决方案。您可以从 Derived::bar 调用相同的函数来防止代码重复。因此，您的构造函数将如下所示：

```
Derived(int f) : Base(stringof(f)), foo(f) {} 
```

我将调用 Base 构造函数放在列表的首位，以强调初始化发生的顺序。初始化列表的顺序没有影响，因为所有类成员都按照它们在类主体中声明的顺序进行初始化。

这是解决问题的一种非常干净、[实用](http://en.wikipedia.org/wiki/Functional_programming)的方法。但是，如果您仍然想权衡替代方案，请考虑使用[组合](http://en.wikipedia.org/wiki/Object_composition)而不是继承来处理 Derived 和 Base 类之间的关系：

```
class Base {
public:
    Base(string S) {  ...  }
    void bat() { ... }
};

class Derived {
    Base *base;
    int foo;

public:
    Derived(int f) : base(NULL), foo(f) {
        base = new Base(bar());
    }
    ~Derived() {
        delete base;
    }

    string bar() {
        return stringof(foo); // actually, something more complex
    }

    void bat() {
        base->bat();
    }
}; 
```

您需要根据您的具体情况考虑[利弊](http://blogs.msdn.com/steverowe/archive/2008/04/28/prefer-composition-over-inheritance.aspx)。使用 Derived 持有对 Base 的引用，您可以更好地控制初始化顺序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T16:42:54.000

您只能在初始化列表中调用静态函数。您在代码中使用它的方式：

```
class Derived: Base
{
public:
  int foo;
  string bar()
  {
    return stringof(foo); // actually, something more complex
  };

  Derived(int f) : foo(f), Base(bar()) 
  {
  };
} 
```

仍会先初始化 Base，然后再初始化 foo。在构造函数初始化器列表中编写内容的顺序无论如何都无关紧要。它将始终按以下顺序构建：

1.  一、所有虚拟基类
2.  然后按照它们在基类列表中出现的顺序排列非虚拟基类
3.  然后所有成员对象按照它们在类定义中定义的顺序。

因此，您最终会`stringof`使用未初始化的值进行调用。这个问题在[`boost::base_from_member`](http://www.boost.org/doc/libs/1_37_0/libs/utility/base_from_member.html). 另请注意，在所有基类的所有构造函数初始化程序完成之前调用任何非静态成员函数是未定义的行为。

然而，调用静态函数完全没问题：

```
class Derived: Base
{
public:
  int foo;
  static string bar(int f)
  {
    return stringof(f); // actually, something more complex
  };

  Derived(int f) : Base(bar(f)), foo(f)
  {
  };
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T16:44:46.710

基类构造函数总是在初始化派生类的其他成员之前被调用；您的编译器应该警告您初始化程序的顺序错误。唯一正确的解决方案是制作`bar()`一个以参数为参数的静态方法`f`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T16:54:19.763

构造函数是用来构造对象的。这意味着，在它返回之前，那里没有对象，因此调用成员函数不会可靠地工作。正如其他人所说，使用静态函数或非成员函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T16:41:34.237

我也一直想做这个，但最后还是放弃了。
任何合适的函数调用都可以用作 Base() 的参数。
另一种选择是向 Base 添加替代构造函数，该构造函数采用 int 并转换为“字符串”本身。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T17:31:53.370

只需将您的构造函数代码移动到 Initialize() 函数并从构造函数中调用它。这比静态/非静态覆盖或类似的东西要简单得多。

# outlook - 将新记录添加到私人 Outlook 通讯组列表

> ID：375148
> 
> 赞同：2
> 
> 时间：2008-12-17T16:32:47.530
> 
> 标签：outlook, distribution-list

我需要从文件或数据库中读取包含姓名和电子邮件的记录，并将它们添加到现有的 Oulook 分发列表（来自私人联系人，而不是来自 GAL）。

我刚刚看到了使用 LINQ to DASL 从 OL 读取的示例，这些示例用于处理邮件和约会，但我不知道如何列出 dist 列表的内容：

```
private static void GetContacts()
    {
         Outlook.Application app = new Outlook.Application();
         Outlook.Folder folder = (Outlook.Folder)app.Session.GetDefaultFolder(Outlook.OlDefaultFolders.olFolderContacts);
 var distLists = from item in folder.Items.AsQueryable<MyDistList>()
                 where item.DLName == "My Dist List"
                 select item.Item;

        var builder = new StringBuilder();

        foreach (var list in distLists)
        {
            builder.AppendLine(list.DLName);
            foreach (var item in list.Members)
            {
            // can't figure out how to iterate through the members here
            // compiler says Object doesn't have GeNumerator...
            }
        }

        Console.WriteLine(builder.ToString());
        Console.ReadLine();
    } 
```

一旦我可以阅读成员，我就需要能够添加新成员，这更加棘手。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T09:07:38.007

事实证明这很容易。我只是错过了对 Resolve 的调用，因为我认为这只是在您解决 GAL 时：

```
Outlook.Recipient rcp = app.Session.CreateRecipient("Smith, John<j.smith@test.com>");
rcp.Resolve();
list.AddMember(rcp);
list.Save(); 
```

我可以创建一个使用 distList.GetMember 方法的迭代器：

// 将 DistListItem.GetMembers() 包装为迭代器

```
public static class DistListItemExtensions
{
    public static IEnumerable<Outlook.Recipient> Recipients(this Outlook.DistListItem distributionList)
    {
        for (int i = 1; i <= distributionList.MemberCount; i++)
        {
            yield return distributionList.GetMember(i);
        }
    }
} 
```

# javascript - 这两种函数语法类型有什么区别

> ID：375150
> 
> 赞同：1
> 
> 时间：2008-12-17T16:33:13.567
> 
> 标签：javascript

正如标题所说，有什么区别

```
MyFunction = function() {

} 
```

和

```
function MyFunction() {

} 
```

没有？

**重复：** [var functionName = function() {} vs function functionName() {}](https://stackoverflow.com/questions/336859/javascript-var-functionname-function-vs-function-functionname)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T16:39:35.300

第一种形式实际上是一个分配了**匿名函数**的变量，第二种是**声明的函数**。

它们*几乎*可以互换，但有一些区别：调试器很难使用 anons（因为它们没有名称），并且 JS 引擎可以直接访问脚本中存在的任何声明的函数，但只有在它们之前无法访问 anons已分配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T16:36:53.387

我想你的意思是

```
var MyFunction = function() {
} 
```

而且在很多情况下，差别不大。

当您在某种包装类中并希望确定您的命名空间（如在greasemonkey 中）时，var 语法有时很有用。

此外，我相信函数是构造函数的东西（使用 .prototype 等）不适用于 var 语法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T16:40:36.033

这是一个区别：

```
function Moose() {
   alert(arguments.callee.name); // "Moose"
}
var Cow = function() {
   alert(arguments.callee.name); // ""
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T16:43:34.310

*`function myFunction(){}`*是一样的*`var myFunction = function myFunction(){}`*。如果你只是这样做*`MyFunction = function(){}`*，它就像*`MyFunction = function anonymous(){}`*。

变量和函数的作用域不同，但函数只能通过变量名在函数外引用，需要绑定到函数上。

*`function myFunction(){}`*将变量绑定`myFunction`到恰好具有相同名称的函数。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-17T16:42:41.347

当您声明一个窗口`load`事件处理程序时，Firefox 有一个细微的差别。在脚本标签中声明以下内容仅适用于 Firefox：

```
function onload() {
    alert(42);
} 
```

对于 IE、Opera、Safari 或 Chrome，您必须这样做：

```
onload = function () {
    alert(42);
} 
```

# python - 如何获取文件最后在 Python 中修改的时间？

> ID：375154
> 
> 赞同：64
> 
> 时间：2008-12-17T16:33:41.070
> 
> 标签：python, file, time

假设文件存在（使用`os.path.exists(filename)`首先确保它存在），我如何显示文件最后修改的时间？如果这有什么不同的话，这是在 Linux 上。

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-12-17T16:41:59.663

```
>>> import os
>>> f = os.path.getmtime('test1.jpg')
>>> f
1223995325.0 
```

自（纪元）之初

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2008-12-17T16:38:08.813

[os.stat()](http://docs.python.org/library/os.html#os.stat)

```
import os
filename = "/etc/fstab"
statbuf = os.stat(filename)
print("Modification time: {}".format(statbuf.st_mtime)) 
```

Linux 不记录文件的创建时间（[对于大多数](https://unix.stackexchange.com/q/24441/61642)文件系统）。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2018-02-24T16:17:13.153

python 3.4+ 的新功能（参见：[pathlib](https://docs.python.org/3/library/pathlib.html)）

```
import pathlib

path = Path('some/path/to/file.ext')
last_modified = path.stat().st_mtime 
```

# netbeans - 有没有办法配置 NetBeans 以阻止使用 Tab 键缩进？

> ID：375156
> 
> 赞同：0
> 
> 时间：2008-12-17T16:34:27.497
> 
> 标签：netbeans

我开始使用 NetBeans 进行 Python 开发，到目前为止它看起来还不错。困扰我的一件事是，当我突出显示几行文本并按 Tab 键时，它并没有像几乎所有其他编辑器所做的那样，而是在块的末尾添加了四个空格。

我知道 NetBeans 有一个块缩进动作（有点奇怪地称为“右移”），但似乎不可能将 Tab 键绑定到任何东西。现在，我已经决定使用 Ctrl+Shift+I 进行块缩进，以纪念我的 Delphi 时代，但实际上，我只想让它像 Eclipse/IntelliJ/Notepad2 一样工作，并在 Tab 上进行块缩进。

有小费吗？

**编辑：**好的，所以似乎只有当我选择一堆行并且光标位于空行时才会发生这种行为。这看起来像一个错误，所以我要提交报告。

多谢你们！

**编辑 2：**如果有人感兴趣，[Issue 155735](http://scripting.netbeans.org/issues/show_bug.cgi?id=155735)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T04:35:34.950

Tab 应缩进选定的行，Shift-Tab 缩进。您描述的行为听起来像一个错误。您可以打开键绑定对话框并查看您的 Tab 键绑定到什么吗？

你可以尝试的另一件事是清除你的用户目录，以防里面有旧的垃圾。

如果这些东西不起作用，请提交一个问题，以便我们可以重现并追踪它——http: //scripting.netbeans.org/issues/enter_bug.cgi?component=python& [issue_type=DEFECT](http://scripting.netbeans.org/issues/enter_bug.cgi?component=python&issue_type=DEFECT)

-- 托尔

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T05:27:45.337

现在应该修复这个问题 - 在 build #415 和以后的[http://deadlock.netbeans.org/hudson/job/python/](http://deadlock.netbeans.org/hudson/job/python/)中。感谢您的错误报告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T16:42:01.147

您是否在某个时候更改了默认键？制表符适用于我的块缩进。

# javascript - 无法在 jqGrid 中加载 XML 数据

> ID：375164
> 
> 赞同：1
> 
> 时间：2008-12-17T16:37:28.597
> 
> 标签：javascript, jquery

我正在使用从这里[http://www.trirand.com/blog](http://www.trirand.com/blog)下载的 jqGrid 。我按照教程逐字逐句地测试了网格。现在我所做的更改是网格从中获取数据的页面位于 asp.net 而不是 php 中。

问题是网格加载正常，并且我生成的 xml 数据有响应，但由于某种原因没有加载到网格本身上（即我留下了一个空白网格。

我使用的代码是

```
<link rel="stylesheet" type="text/css" media="screen" href="js/themes/basic/grid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="js/themes/jqModal.css" />
<script src="js/jquery.js" type="text/javascript"></script>
<script src="js/jquery.jqGrid.js" type="text/javascript"></script>
<script src="js/js/jqModal.js" type="text/javascript"></script>
<script src="js/js/jqDnR.js" type="text/javascript"></script>
<script type="text/javascript">
jQuery(document).ready(function(){ 
  jQuery("#list").jqGrid({
    url:'nrGetjqgridXML.aspx',
    datatype: "xml",      
    colNames:['Dummy ID','Dummy String','Dummy Int','Dummy Char','Dummy Bool','Dummy Date','Dummy Float'],colModel :[{name:'dummyID', index:'dummyID' , width:100, sortable:true},{name:'dummyString', index:'dummyString' , width:100, sortable:true},{name:'dummyInt', index:'dummyInt' , width:100, sortable:true},{name:'dummyChar', index:'dummyChar' , width:100, sortable:true},{name:'dummyBool', index:'dummyBool' , width:100, sortable:true},{name:'dummyDate', index:'dummyDate' , width:100, sortable:true},{name:'dummyFloat', index:'dummyFloat' , width:100, sortable:true}],                    
    rowNum: 10,
    rowList:[10,20,30],
    imgpath: 'js/themes/basic/images',
    pager: jQuery('#pager'),
    sortname: 'dummyid',   
    viewrecords: true,
    sortorder: "desc",    
    caption: 'Test Grid'
  }).navGrid('#pager', {edit:false , add:false, del:false}); 
}); 
</script> 
```

这是 nrGetjqgridXML 的响应：

```
<xml version='1.0' encoding = 'utf-8'?>
<rows>
   <page>1</page>
   <total>2</total>
   <records>15</records >
   <row id = '15'>
      <cell>15</cell>
      <cell><![CDATA[Test15]]></cell>
      <cell>15</cell>
      <cell><![CDATA[o]]></cell>
      <cell><![CDATA[False]]></cell>
      <cell>15/03/2005 00:00:00</cell>
      <cell>15.15</cell>
   </row>
   <row id = '14'>
      <cell>14</cell>
      <cell><![CDATA[Test14]]></cell>
      <cell>14</cell>
      <cell><![CDATA[n]]></cell>
      <cell><![CDATA[False]]></cell>
      <cell>14/02/2004 00:00:00</cell>
      <cell>14.14</cell>
   </row><row id = '13'>
      <cell>13</cell>
      <cell><![CDATA[Test13]]></cell>
      <cell>13</cell>
      <cell><![CDATA[m]]></cell>
      <cell><![CDATA[True]]></cell>
      <cell>13/01/2003 00:00:00</cell>
      <cell>13.13</cell>
   </row>
   <row id = '12'>
      <cell>12</cell>
      <cell><![CDATA[Test12]]></cell>
      <cell>12</cell>
      <cell><![CDATA[l]]></cell>
      <cell><![CDATA[False]]></cell>
      <cell>12/12/2002 00:00:00</cell>
      <cell>12.12</cell>
   </row><row id = '11'>
      <cell>11</cell>
      <cell><![CDATA[Test11]]></cell>
      <cell>11</cell>
      <cell><![CDATA[k]]></cell>
      <cell><![CDATA[True]]></cell>
      <cell>11/11/2001 00:00:00</cell>
      <cell>11.11</cell>
   </row>
   <row id = '10'>
      <cell>10</cell>
      <cell><![CDATA[Test10]]></cell>
      <cell>10</cell>
      <cell><![CDATA[j]]></cell>
      <cell><![CDATA[False]]></cell>
      <cell>10/10/2000 00:00:00</cell>
      <cell>10.1</cell>        
   </row>
   <row id = '9'>
      <cell>9</cell>
      <cell><![CDATA[Test9]]></cell>
      <cell>9</cell>
      <cell><![CDATA[i]]></cell>
      <cell><![CDATA[False]]></cell>
      <cell>09/09/1999 00:00:00</cell>
      <cell>9.9</cell>
   </row>
   <row id = '8'>
       <cell>8</cell>
       <cell><![CDATA[Test8]]></cell>
       <cell>8</cell>
       <cell><![CDATA[h]]></cell>
       <cell><![CDATA[False]]></cell>
       <cell>08/08/1998 00:00:00</cell>
       <cell>8.8</cell>
   </row>
   <row id = '7'>
       <cell>7</cell>
       <cell><![CDATA[Test7]]></cell>
       <cell>7</cell>
       <cell><![CDATA[g]]></cell>
       <cell><![CDATA[True]]></cell>
       <cell>07/07/1997 00:00:00</cell>
       <cell>7.7</cell>
   </row>
   <row id = '6'>
       <cell>6</cell>
       <cell><![CDATA[Test6]]></cell>
       <cell>6</cell>
       <cell><![CDATA[f]]></cell>
       <cell><![CDATA[True]]></cell>
       <cell>06/06/1996 00:00:00</cell>
       <cell>6.6</cell>
   </row>
   <row id = '5'>
       <cell>5</cell>
       <cell><![CDATA[Test5]]></cell>
       <cell>5</cell>
       <cell><![CDATA[e]]></cell>
       <cell><![CDATA[False]]></cell>
       <cell>05/05/1995 00:00:00</cell>
       <cell>5.5</cell>
   </row>
    <row id = '4'>
       <cell>4</cell>
       <cell><![CDATA[Test4]]></cell>
       <cell>4</cell>
       <cell><![CDATA[d]]></cell>
       <cell><![CDATA[True]]></cell>
       <cell>04/04/1994 00:00:00</cell>
       <cell>4.4</cell>
   </row>
   <row id = '3'>
       <cell>3</cell>
       <cell><![CDATA[Test3]]></cell>
       <cell>3</cell>
       <cell><![CDATA[c]]></cell>
       <cell><![CDATA[False]]></cell>
       <cell>03/03/1993 00:00:00</cell>
       <cell>3.3</cell>
   </row>
   <row id = '2'>
       <cell>2</cell>
       <cell><![CDATA[Test2]]></cell>
       <cell>2</cell>
       <cell><![CDATA[b]]></cell>
       <cell><![CDATA[False]]></cell>
       <cell>02/02/1992 00:00:00</cell>
       <cell>2.2</cell>
   </row>
   <row id = '1'>
       <cell>1</cell>
       <cell><![CDATA[Test1]]></cell>
       <cell>1</cell>
       <cell><![CDATA[a]]></cell>
       <cell><![CDATA[True]]></cell>
       <cell>01/01/1991 00:00:00</cell>
       <cell>1.1</cell>
   </row>
</rows> 
```

这就是网格的显示方式： [alt text http://img132.imageshack.us/img132/6671/testgridol7.jpg](http://img132.imageshack.us/img132/6671/testgridol7.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T02:52:39.713

您是否添加了：

```
<script src="grid/js/jqDnR.js" type="text/javascript">
</script> 
```

此外，您的 XML 缺少结束

```
</rows> 
```

标签。试试看！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-02-21T06:33:03.090

您需要为此使用 XML Reader：

```
function fillGridOnEvent() {
            $("#jQGrid").html("<table id=\"list\"></table><div id=\"page\"></div>");
            jQuery("#list").jqGrid({
                url: "<URL from where u r getting xml>",
                datatype: "xml",`enter code here`
                height: 250,
                colNames: ['ID', 'Name', 'Sales Rep', 'Market', 'Station', 'Advister', 'Agency'],

                colModel: [{ name: 'id', xmlmap: 'id', width: 75 },
                               { name: 'product_name', xmlmap: 'product_name', width: 190 },
                               { name: 'salesrep_name', xmlmap: 'salesrep_name', width: 100 },
                               { name: 'account', xmlmap: 'account', width: 180, align: "right" },
                               { name: 'station', xmlmap: 'station', width: 180, align: "right" },
                               { name: 'advertiser_name', xmlmap: 'advertiser_name', width: 180 },
                               { name: 'agency_name', xmlmap: 'agency_name', width: 150, sortable: false}],
                xmlReader: {
                    root: "orders",
                    row: "order",
                    page: "orders>page",
                    total: "orders>total",
                    records: "orders>records",
                    repeatitems: false
                },
                multiselect: false,
                paging: true,
                rowNum: 10,
                rowList: [10, 20, 30],
                pager: $("#page"),
                loadonce: true,
                caption: "Student Details"
            }).navGrid('#page', { edit: false, add: false, del: false });

            jQuery().ready(function () {
                //fillGrid();
            });
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T18:59:23.577

我在 Java/Struts 中有同样的错误，我解决了它，设置了一个 XML 流，但是

```
public class AtualizarListaAction extends Action {

    @Override
    public ActionForward execute(ActionMapping mapping, ActionForm form,
        HttpServletRequest request, HttpServletResponse response)
        throws Exception {

        //use this
        response.setContentType("text/xml;charset=utf-8");

        response.getWriter().println(" <rows>");
        response.getWriter().println("  <row id='1' >");            
        response.getWriter().println("   <cell>1</cell>");       
        ... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-30T21:29:22.900

我遇到了同样的问题。最终通过反复试验，我通过添加：

```
mtype: 'GET' 
```

作为网格选项。IE，从你的例子中，

```
jQuery(document).ready(function(){ 
  jQuery("#list").jqGrid({
        url:'nrGetjqgridXML.aspx',
        datatype: "xml",
        mtype: 'GET',
        ... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T23:49:49.530

我试过你的代码。它有效，我发现的唯一问题是您的 XML 有一个错误：

第一行必须是

```
<?xml version='1.0' encoding = 'utf-8'?> 
```

代替

```
<xml version='1.0' encoding = 'utf-8'?> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T15:50:17.237

你加了吗？

```
<table id="list" class="scroll" cellpadding="0" cellspacing="0"></table> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-28T15:07:15.963

添加

`response.setContentType("text/xml;charset=utf-8");`

它解决了 Servlet 响应后更新网格的 IE 问题

谢谢

# wpf - 将 ListBoxItem 从一个 ListBox 动画化到另一个 ListBox

> ID：375165
> 
> 赞同：5
> 
> 时间：2008-12-17T16:38:00.140
> 
> 标签：wpf, animation, listboxitem

我想在双击列表框中的项目时创建视觉效果。到目前为止，我有拖放功能，其中项目在视觉上附加到鼠标上并且可以移动到放置目标。通过该功能，我可以使用获取项目容器的相同逻辑为项目设置动画，但是我无法离开项目控制。有没有办法从 ListBox 中删除项目并将其视觉动画到另一个位置？基本上主列表框是一手牌。当一张卡片被双击时，我希望它在视觉上从手牌列表框移动到丢弃列表框。到目前为止，将项目从一个集合移动到另一个集合的逻辑没有问题，但是我真的想要这个事件的动画视觉表示。任何关于如何做这样的事情的想法或参考将不胜感激。

谢谢，布兰登

关于我尝试过的更多细节：有些概念我还没有很好地掌握，这导致我首先面对这堵墙。我有一个方法，我将 ListBox 作为 ItemsControl、作为列表框项的 FrameworkElement 以及与 ListBox 项关联的数据对象传入（有些可能是不必要的）。我试图做的是作为画布的 ListBoxItem 的 FindVisualChild。我能做到。在我看来，我想以某种方式将画布克隆为画布或位图，将其添加到同一位置的页面子级的子级中，从 ListBox 中删除 ListBoxItem，并将克隆动画到丢弃桩。当动画完成时，克隆将被移除或隐藏，并且随着该对象被添加到丢弃堆集合中，它将有效地替换克隆。

我的问题是，我觉得确实有一种更简单的方法可以使用装饰层或其他东西来做到这一点。我也不知道如何将克隆定位在元素中的完全相同的位置，在视觉树的更上方。我将继续努力并研究其他方法，我只希望有人能分享一些对此的见解。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-07T02:00:06.483

这是我为绘制位图视觉效果而编写的一些代码。您可以根据自己的需要进行调整，并通过装饰表示两个列表视图的共同祖先的 UIElement 来绘制位图。请注意使用 FrameworkElement.TransformToAncestor 来获取嵌套元素根据祖先元素的坐标。

```
 public static BitmapSource CreateBitmapFromElement(FrameworkElement element, Double dpiX, Double dpiY)
        {
            Size elementSize = new Size(element.ActualWidth, element.ActualHeight);
            Visual root = GetAdornerDecoratorAncestor(element);
            Rect elementBounds  = element.TransformToAncestor(root).TransformBounds(new Rect(elementSize));

            RenderTargetBitmap rtb = new RenderTargetBitmap((Int32)(elementBounds.Size.Width * dpiX / 96.0),
                                           (Int32)(elementBounds.Size.Height * dpiY / 96.0),
                                           dpiX,
                                           dpiY,
                                           PixelFormats.Pbgra32);

            DrawingVisual dv = new DrawingVisual();
            using (DrawingContext dc = dv.RenderOpen())
            {
                VisualBrush vb = new VisualBrush(root);
                vb.ViewboxUnits = BrushMappingMode.Absolute;
                vb.Stretch = Stretch.None;
                vb.Viewbox = elementBounds;
                dc.DrawRectangle(vb, null, new Rect(new Point(), elementBounds.Size));
            }
            rtb.Render(dv);
            return rtb;
        }

        public static Visual GetAdornerDecoratorAncestor(DependencyObject obj)
        {            
            while(obj != null && !(obj is AdornerDecorator))
            {
                obj = VisualTreeHelper.GetParent(obj);
            }
            return obj as AdornerDecorator;
        } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T17:05:48.777

好的，您可以尝试获取一个 Visual 元素并将其背景设置为您的 ListItem 的视觉刷，并将其设置为另一个列表框。您可以等待故事板完成事件实际进行切换。如果这是我，我会从一个盒子动画到另一个盒子的边缘。如果切换发生得足够快，它对用户来说应该看起来非常无缝。根据您拥有的任何排序/过滤规则，找到项目应该进入列表框的确切位置将非常复杂。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T00:13:39.087

如果两个列表框始终位于相同的位置，您可以尝试将双击的项目动画到预定位置，假设在旧列表和新列表之间的中间位置。然后执行代码将项目移动到新列表，但使用的样式会立即在该项目上启动动画，从该预定位置开始并动画到其在新列表中的位置。您可能必须在运行时根据它在列表中的插入位置调整新项目的初始偏移量。

# maven-2 - Maven：OSGI、包和多模块项目

> ID：375172
> 
> 赞同：11
> 
> 时间：2008-12-17T16:39:03.820
> 
> 标签：maven-2, osgi, dependencies

我目前正在开发一个基于 OSGi 的应用程序（使用 Equinox），方法是尝试对我在 OSGi+Equinox 上找到的网络教程进行 mavenize。在这个项目中，有一些依赖于其他包的包（quote-service 依赖于报价）。编译阶段确实成功，但打包阶段没有。Maven抱怨以下内容：

```
[信息] [捆绑：捆绑]
[错误] 构建捆绑包 de.vogella.osgi:quote-service:bundle:0.0.1 时出错：Bundle-Classpath[Jar:dot] 上的类未解决对 [de.vogella.osgi.quote] 的引用： [de/vogella/osgi/quoteservice/Activator.class，de/vogella/osgi/quoteservice/QuoteService.class]
[错误] 在捆绑配置中发现错误

```

我确实理解这个问题，但不知道如何使它工作。这是报价的 pom ：

```
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/maven-v4_0_0.xsd">

<parent>
    <artifactId>osgi-first-app</artifactId>
    <groupId>de.vogella.osgi</groupId>
    <version>0.0.1</version>
</parent>

<modelVersion>4.0.0</modelVersion>
<groupId>de.vogella.osgi</groupId>
<artifactId>quote</artifactId>
<packaging>bundle</packaging>
<name>Quote Bundle</name>
<version>0.0.1</version>

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.felix</groupId>
            <artifactId>maven-bundle-plugin</artifactId>
            <version>1.4.3</version>
            <extensions>true</extensions>
            <configuration>
                <instructions>
                    <_include>src/main/resources/META-INF/MANIFEST.MF</_include>
                </instructions>
            </configuration>
        </plugin>
    </plugins>
</build>
</project> 
```

和报价的捆绑清单：

```
Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Quote Plug-in
Bundle-SymbolicName: de.vogella.osgi.quote
Bundle-Activator: de.vogella.osgi.quote.Activator
Bundle-ActivationPolicy: lazy
Bundle-RequiredExecutionEnvironment: J2SE-1.5
Import-Package: org.osgi.framework;version="1.3.0"
Export-Package: de.vogella.osgi.quote 
```

然后是报价服务的 pom ：

```
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/maven-v4_0_0.xsd">

<parent>
    <artifactId>osgi-first-app</artifactId>
    <groupId>de.vogella.osgi</groupId>
    <version>0.0.1</version>
</parent>

<dependencies>
    <dependency>
        <groupId>de.vogella.osgi</groupId>
        <artifactId>quote</artifactId>
        <version>0.0.1</version>
        <type>bundle</type>
    </dependency>
</dependencies>

<modelVersion>4.0.0</modelVersion>
<groupId>de.vogella.osgi</groupId>
<artifactId>quote-service</artifactId>
<packaging>bundle</packaging>
<name>Quote Service Bundle</name>
<version>0.0.1</version>

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.felix</groupId>
            <artifactId>maven-bundle-plugin</artifactId>
            <version>1.4.3</version>
            <extensions>true</extensions>
            <configuration>
                <instructions>
                    <_include>src/main/resources/META-INF/MANIFEST.MF</_include>
                </instructions>
            </configuration>
        </plugin>
    </plugins>
</build>
</project> 
```

最后是报价服务的清单：

```
Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Quoteservice Plug-in
Bundle-SymbolicName: de.vogella.osgi.quoteservice
Bundle-Activator: de.vogella.osgi.quoteservice.Activator
Bundle-ActivationPolicy: lazy
Bundle-RequiredExecutionEnvironment: J2SE-1.5
Import-Package: org.osgi.framework;version="1.3.0", \
 de.vogella.osgi.quote;version="0.0.1" 
```

有什么不对 ？先感谢您 ！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-18T11:26:17.307

答案很简单：我删除了已经定义的清单，并在捆绑插件说明中使用了 bnd 条目。这样可行 ！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-19T02:21:59.167

[Tycho](http://www.sonatype.com/people/2009/04/tycho-040-roadmap/)旨在处理这些类型的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-06T03:00:15.370

我写了一个名为 auto-builder 的工具：[http://code.google.com/p/auto-builder](http://code.google.com/p/auto-builder)。它内省基于 PDE 的项目并生成 Ant 构建文件；它支持对依赖项和所有爵士乐的传递闭包。

我发布了一篇文章：[http](http://empty-set.net/?p=9) ://empty-set.net/?p=9 。我之所以写它，是因为我使用的 Maven 工具在与 PDE 集成时“不能正常工作”。基本上，我想在 PDE 中进行编码，并拥有一个基于 Hudson 的 CI，而不会在两者之间大惊小怪。

生成 Ant 文件很好，因为它为您提供了声明式构建工具的所有好处，但它为您提供了关于它正在做什么的过程描述。

我正在寻找更多基于 PDE 的项目来对其进行测试。周围有几个 RFC-0112 Bundle 存储库，我有一些用于下载依赖项的代码。如果有人感兴趣，那么我可以将依赖项下载与自动生成器集成。

# asp.net - ASP.net：注销时的缓存问题

> ID：375178
> 
> 赞同：0
> 
> 时间：2008-12-17T16:40:14.940
> 
> 标签：asp.net

我找不到任何关于注销时缓存的帖子，所以我要问这个问题。如果有类似的问题。请告诉我。

我有一个注销页面，它基本上调用 FormAuthentications 注销方法，然后将用户重定向到登录页面。它工作正常，但问题是用户可以单击浏览器的后退按钮并获取缓存页面。我试图在我的母版页上设置 no-cache 标头，但这不起作用。

有人可以指点我一篇文章或教程或发布一些关于您如何处理这种情况的提示吗？

感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T19:14:52.320

根据您的要求，可能的解决方案可能是在每个经过身份验证的页面上将 Cache-Control 标头设置为“无缓存”。这将防止页面被下游缓存。这可以通过编写一个自定义的[HttpModule](http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.aspx)来[设置标题](http://msdn.microsoft.com/en-us/library/system.web.httpcachepolicy.setnostore.aspx)：

```
// Prevent the browser from caching the ASPX page
Response.Cache.SetNoStore(); 
```

您还可以通过添加以下代码行在页面的 HEAD 部分中进行设置：

```
<meta http-equiv="Cache-Control" content="no-cache" /> 
```

通过这样做，如果用户在退出后单击“后退”按钮，他将被重定向到登录表单，而不是看到他最后一页的缓存版本，如果他使用的是公共计算机，这可能是一个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T23:52:43.697

如果您使用表单身份验证，请确保在用户注销时删除表单身份验证 cookie。一旦用户在缓存页面（他们按下后退按钮进入的页面）上执行任何操作，站点将要求用户重新登录，然后将他们重定向回原始页面，并提供新数据. 中提琴！

此外，关于页面缓存，您需要设置相当多的标头以关闭浏览器和代理服务器中的缓存机制：

*   “过期” - 设置为过去的某个日期
*   “Last-Modified” - 设置为当前日期/时间
*   “缓存控制” - 设置为“无缓存，必须重新验证”
*   “编译指示” - 设置为“无缓存”

那应该*只是*使页面不可缓存。日期/时间需要采用 RFC1123 格式（.net 中的格式说明符“R”，例如“Mon, 17 Apr 2006 21:22:48 GMT”）。您可以将其实现为：

```
Response.AddHeader("Expires", new DateTime(1940, 1, 1).ToString("R"));
Response.AddHeader("Last-Modified", DateTime.Now.ToString("R"));
Response.AddHeader("Cache-Control", "no-cache, must-revalidate");
Response.AddHeader("Pragma", "no-cache"); 
```

或类似的东西，具体取决于您要添加所有标题的位置。我在许多浏览器和代理服务器上都取得了很好的成功，但在页面缓存方面没有什么是万无一失的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T00:03:59.243

IE6 似乎忽略了一些缓存头。

缓存标头之上的另一种技术是一些客户端 javascript 来检查身份验证 cookie 并使用 history.Forward() 如果它不存在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T19:13:28.173

将此添加到 global.asax 中，它将为Web 应用程序中的*所有*页面设置无缓存标头。但是，请确保禁用缓存确实是您想要做的 - 因为缓存是一种性能优势。

当然，您也可以将相同的 Response.Cache 命令单独应用于页面。

这适用于 FireFox 3、IE7 和 Opera 9.6。*（在 Opera 中，如果您不*发送任何帖子请求，它将起作用。如果您这样做，页面仍然可以从第一次返回按钮访问，但之后无法访问。）

```
 protected void Application_PreSendRequestHeaders(object sender, EventArgs e)
    {
        if (!Request.Path.Contains("/Content/")) //We WANT images, css, javascripts to be cached!
        {
            //Otherwise, all of our pages contain sensitive information, and we don't want them cached.
            Response.Cache.SetCacheability(HttpCacheability.NoCache);
            Response.Cache.SetRevalidation(HttpCacheRevalidation.AllCaches); //for Opera. May only work on https sites
            Response.Cache.SetNoStore();
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T16:50:27.213

没有万无一失的方法可以做到这一点。用户最终可以控制缓存设置，并且无缓存标头无法覆盖这些设置。

您是否要在这里解决一个特别的问题（安全性？），或者您只是想确保用户没有看到过时的数据？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T17:12:14.220

这是一个很难解决的问题。您可以创建一个基本页面，并在构造函数中检查此人是否已登录。如果此人未登录，则只需重定向到登录页面。此基本页面将被所有其他 ASP.NET 页面继承。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-26T04:05:37.857

您实际上无法停止行为，人们删除了后退按钮禁用了它，但用户仍然可以通过任何浏览器的快捷方式进行控制，我的建议是对于您希望用户登录的所有页面把它们放在一个`POST`方法上，而不是一个经常`GET`使用的帖子。这样做的目的是，只要用户按下该 URL 的后退按钮，浏览器就会通过警告框要求用户发布为此请求缓存的最后一个数据，并且将有一个服务器调用，其中表单身份验证将起作用。

在 get 可能工作的地方使用 post 有点粗糙，但它解决了你的这个问题。

# rdbms - 如何设计 Hbase 架构？

> ID：375194
> 
> 赞同：11
> 
> 时间：2008-12-17T16:42:51.613
> 
> 标签：rdbms, hadoop, hbase, hive

假设我有这个 RDBM 表（[Entity-attribute-value_model](http://en.wikipedia.org/wiki/Entity-attribute-value_model)）：

```
col1: entityID
col2: attributeName
col3: value 
```

由于缩放问题，我想使用 HBase。

我知道访问 Hbase 表的唯一方法是使用主键（光标）。您可以获得特定键的游标，并逐个迭代行。

问题是，就我而言，我希望能够迭代所有 3 列。例如 ：

*   对于给定的 entityID，我想获取它的所有属性和值
*   对于给定的属性名称和值，我想要所有的 entitiIDS ...

所以我的一个想法是构建一个 Hbase 表来保存数据（表 DATA，以 entityID 作为主索引），以及 2 个“索引”表，一个以 attributeName 作为主键，另一个以 value

每个索引表都将保存 DATA 表的指针（实体 ID）列表。

这是一个合理的方法吗？或者是 Hbase 概念的“滥用”？

在这篇[博客](http://blog.rapleaf.com/dev/?p=26)中，[作者](http://blog.rapleaf.com/dev/?author=7)说：

> HBase 允许通过主键获取操作并在行范围内扫描（想想：游标）。（如果你有二级索引的规模和需要，别担心 - Lucene 来拯救！但那是另一篇文章。）

您知道 Lucene 如何提供帮助吗？

——约纳坦

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T15:54:39.520

二级索引确实对 HBase 的许多潜在应用很有用，我相信开发人员实际上正在研究它。结帐[http://www.mail-archive.com/hbase-dev@hadoop.apache.org/msg04801.html](http://www.mail-archive.com/hbase-dev@hadoop.apache.org/msg04801.html)。

同时，如果您的应用程序数据存储可以建模为星型模式（请参阅[http://en.wikipedia.org/wiki/Star_schema](http://en.wikipedia.org/wiki/Star_schema)），您可能希望查看 Hypertable 针对二级索引类型需求提出的解决方案[http://markmail.org/message/rphm4q6cbar2ycgp](http://markmail.org/message/rphm4q6cbar2ycgp)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-04T15:00:40.493

我建议使用两个不同的平面表：一个用于查找给定 entityID 的属性 + 值，另一个用于查找给定属性 + 值的 entityID。

表 1 如下所示：

```
entityID1 {
  attribute1: value1;
  attribute2: value2;
  ...
} 
```

和表 2：

```
attribute1_value1 {
  entityID1;
}
attribute2_value2 {
  entityID1;
} 
```

# ruby-on-rails - Ruby类继承或任何问题

> ID：375203
> 
> 赞同：-2
> 
> 时间：2008-12-17T16:44:15.527
> 
> 标签：ruby-on-rails, ruby, class

我的 ruby​​ (on rails) 类看起来像：

class Foo def self.method1 someAction end

def self.method2 someAction end

def someAction //doSmth end end

任何想法如何使这项工作或以其他方式实现相同的行为？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T17:29:11.770

如果 some_action 适合作为类方法，我会这样做：

```
 class Foo
   def self.method1
     some_action
   end
   def self.some_action
     # do stuff
   end
   def some_action
     self.class.some_action
   end
 end 
```

如果 method1 应该是一种方便的方法，那么我会像 Hates_ 所说的那样做。

```
 class Foo
   def self.method1
     self.new.some_action
   end
   def some_action
     # do stuff
   end
 end 
```

对我来说，决定通常是 some_action 是否更像是一种实用方法（例如生成随机密钥，在这种情况下我会选择第一种形式），或者它是否是更复杂事物的入口点（例如解析器，其中情况下我会选择第二种形式）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T16:50:55.887

如果没有类本身的实际实例，就不能从类方法调用实例方法。你可以这样做：

```
class Foo 

    def self.method1 
         myFoo = Foo.new
         myFoo.someAction 
    end

    def someAction 
         //doSmth 
    end 

end 
```

# javascript - jQuery 没有正确解析 JSON

> ID：375204
> 
> 赞同：6
> 
> 时间：2008-12-17T16:44:34.387
> 
> 标签：javascript, jquery, json, ajax

我有个问题。我构建了一个脚本来向发送回响应的内部链接发出请求。这是脚本的样子：

```
jQuery.get(callUrl, function(data) {
  console.log(typeof data);
  jQuery.each(data.items, function(i, item) {

    console.log(i);
  });
}, 'json'); 
```

服务器发回的响应如下所示：

```
{"items":[            
  {
   "src": "gallery_item_data_Jc4EaLP6vlwd_large.jpg",
   "id": "83",
   "gallery_id": "30",
   "username": "admin"
  }]
} 
```

我的问题是当我解析“数据”时，它的类型总是字符串。我需要它成为一个对象，以便我可以查询它并用我的脚本解析它。为了解决问题，我尝试将我的脚本与 jQuery 文档页面上的示例进行比较：

[http://docs.jquery.com/Ajax/jQuery.getJSON](http://docs.jquery.com/Ajax/jQuery.getJSON)

此页面上的请求与我的请求的主要区别在于它使用了 getJSON 方法。当我尝试将它与我的服务器的 url 一起使用时，我根本没有得到任何响应，所以这就是我选择 get 方法并将返回类型指定为“json”的主要原因。

我尝试的另一件事是：我查看了jQuery 示例用于查找它发回的 Content-type 标头的[Flickr 提要，我认为我的提要可能有错误的标头，它在 Flickr 提要上是这样的：](http://api.flickr.com/services/feeds/photos_public.gne?tags=cat&tagmode=any&format=json&jsoncallback=?)

```
Content-Type    application/x-javascript; charset=utf-8 
```

这与我自己的提要上的标题完全相同。所以我很困惑。有谁知道为什么会这样？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T16:55:43.287

JSON 需要有括号，所以它应该是：

```
({"items":[            
  {
   "src": "gallery_item_data_Jc4EaLP6vlwd_large.jpg",
   "id": "83",
   "gallery_id": "30",
   "username": "admin"
  }]
}) 
```

然后您应该能够使用 getJSON，因为这是将数据作为对象获取的最简单方法。但是，您也可以 eval() 字符串，这将返回一个对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T16:57:11.007

您是否尝试通过调用 JavaScript eval() 函数来构建该字符串的对象？如果您首先在回调函数中调用 eval(data) 它应该给您一个对象。

# visual-studio - Visual Studio - 发布到多个位置？

> ID：375215
> 
> 赞同：17
> 
> 时间：2008-12-17T16:48:08.437
> 
> 标签：visual-studio, load-balancing, publish

有没有办法一次自动将网站发布到多个位置？

我们的网站在多台服务器之间进行负载平衡，因此当我想发布时，我必须单独对每台服务器进行发布。

谢谢，特雷夫

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T16:53:23.900

也许使用一些构建脚本，例如 MSBuild？或者，也许您可​​以创建一个脚本（PowerShell、VBScript 等），它复制目录的所有内容，并在构建后事件中调用它（可在 Visual Studio 中配置），这样一旦您的解决方案（或最后一个项目，实际上) 构建后，脚本将运行并将输出文件复制到您需要的任何位置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T17:18:24.787

你可以

1.  将内容发布到 UNC 并让所有 Web 服务器在该 UNC 之外工作
2.  [使用MSDeploy](http://blogs.iis.net/msdeploy/archive/2008/01/22/welcome-to-the-web-deployment-team-blog.aspx)之类的工具将内容从暂存/QA 服务器推送到生产环境
3.  使用[FRS](http://technet.microsoft.com/en-us/library/cc781582.aspx)将文件从“主”网络服务器复制到其他所有人。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-25T15:16:38.773

MSDeploy 设置为使用每个位置的多个配置来处理此问题。Scott Hanselman 在 Mix '10 上对此进行了介绍

[http://live.visitmix.com/MIX10/Sessions/FT14](http://live.visitmix.com/MIX10/Sessions/FT14)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-10-03T13:55:31.790

或者只使用多个发布命令。每个位置一个。

# c# - 你知道'@eax'的托管等价物吗？

> ID：375221
> 
> 赞同：3
> 
> 时间：2008-12-17T16:50:23.657
> 
> 标签：c#, visual-studio-2008, debugging

在非托管开发环境中，您可以通过在调试器的监视窗口中键入“@eax”来观察方法的 DWORD 返回值。

有谁知道托管代码中的等效快捷方式？

相关点：了解到VS2008 SP1支持**$exception**作为watch窗口中的魔术字。您还知道其他快捷方式吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T17:47:24.993

我不确定这是否就是您的意思，但是您可以为跟踪点打印一些其他关键字：

```
 $ADDRESS      address of current instruction
  $CALLER       name of the previous function on the call stack
  $CALLSTACK    entire call stack
  $FUNCTION     name of the current function
  $PID          process ID for current process
  $PNAME        name of the current process
  $TID          thread ID for current thread
  $TNAME        name of the current thread 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-25T08:28:13.520

像@eax 这样的监视窗口技巧被称为 [Psuedovariables]。它们实际上已[记录在案。](http://msdn.microsoft.com/en-us/library/ms164891(VS.80).aspx)几年前， 我写了[一篇关于这个和其他一些 VS 调试项目的博客文章。](http://blogs.msdn.com/stevejs/archive/2005/10/18/482300.aspx#comments)格式说明符通常非常有用。

对于您的具体问题，托管代码中没有 eax 的伪变量。然而，有一个寄存器窗口实际上将包含 EAX 和其他寄存器。值得怀疑的是，这在许多情况下是否有用，因为我不相信有任何方法可以将地址转换为托管类型。但是，您可以查看内存窗口中的布局

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T10:03:31.740

托管代码中的 @EAX 实现起来有点棘手，因为 CIL 具有用于函数返回的高阶原语（这在语义上发生在虚拟执行堆栈上）。

也就是说，如果您的函数返回一个值类型并且该类型的大小小于或等于 32 位，那么 @EAX 很可能仍会为您提供该值。（你可能需要打开混合模式调试才能看到寄存器，我不记得我的头脑。）这当然不适合引用类型、大值类型和内联函数。

简而言之，我希望它也内置在调试器中！

# c# - 如何在 WinForms 中获取控制索引？

> ID：375223
> 
> 赞同：3
> 
> 时间：2008-12-17T16:50:45.997
> 
> 标签：c#, .net, winforms

我有一个面板，里面有一组控件。遍历它们时如何获取特定控件的索引？我正在使用`foreach`迭代，但没有 Index 属性。我应该在比赛完成后使用`for x = 0...`并返回`x`，还是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T16:57:17.090

你可以使用：

```
panel.Controls.IndexOf(control); 
```

或者您可以使用 for 循环而不是 foreach 循环来迭代它们。或者您可以只创建一个在 foreach 循环内递增的索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T16:57:26.373

您可以只使用 IndexOf 方法。类似 panel1.Controls.IndexOf(textBox1);

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T16:59:25.403

要回答您提出的具体问题，是的，我会使用

for(x = 0; x < panel.Controls.Count; i++)

但是，如果您正在向面板动态添加控件，则可以考虑通过 .Name 或 .Tag 属性为它们提供唯一名称或其他标识属性。

然后，您可以更精确地区分您的子控件。

希望这可以帮助...

# perl - 如何获得适用于 ActivePerl 5.10 的 BerkeleyDB？

> ID：375239
> 
> 赞同：2
> 
> 时间：2008-12-17T16:57:10.010
> 
> 标签：perl, winapi, module, berkeley-db, activeperl

我正在尝试找出适用于 ActivePerl 5.10 的 BerkeleyDB PPM 在哪里。任何人都知道在哪里可以找到它，或者如何构建它？

[我在这里](http://trouchelle.com/perl/ppmrepview.pl?l=berkeleydb&v=10)找到了线索。他们声称 BerkeleyDB 0.33 已经为 Perl 5.10 构建好了。它们提供指向 PPM 的链接，但不提供指向支持 zip 文件的链接。所以我绕过它，手动获取[ppm](http://trouchelle.com/ppm10/MSWin32-x86-multi-thread-5.10/BerkeleyDB.ppm)和[zip](http://trouchelle.com/ppm10/BerkeleyDB-0.33.zip)并在 ppm 文件上运行 ppm install 。这不起作用，因为无法加载 zip 中提供的 dll。

似乎唯一要做的就是从 Oracle 获取 BerkeleyDB 代码，使用 Visual Studio 为 Win32 编译它（提供的 MSI 使用 Cygwin 工具），从 CPAN 修改 tarball 并自己构建 ppm。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T23:11:16.050

The short answer: Use Sqlite. The long answer, compile it and debug it yourself, contribute it to the community.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-18T19:48:49.250

启动 ppm，转到 Edit -> Preferences -> repositories 并添加[“trouchelle”存储库](http://trouchelle.com/perl/ppmrepview.pl)。他们有一个用于 ActiveState Perl 5.10 的 BerkelyDB 包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T06:17:27.830

您是否考虑过使用[Strawberry Perl](http://strawberryperl.com/)？它可能不适合您的目的，但创建它的很大一部分原因是对 CPAN 模块的更好（尽管不是完美）支持，而不是要求 PPM 存储库保持最新。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-24T19:30:49.487

DBD::DBM 不支持 BerkelyDB 吗？

# asp.net - 如何使用 PopupControlExtender 为输入表单显示自由浮动面板？

> ID：375245
> 
> 赞同：1
> 
> 时间：2008-12-17T16:57:34.237
> 
> 标签：asp.net, ajax, popupcontrolextender

我目前正在使用 ajaxToolkit 中的 PopupControlExtender 并不能完全获得我想要的功能。

我正在尝试为输入表单显示一个自由浮动的“帮助”面板。

一旦用户按下表单上的帮助按钮，面板就会弹出并显示没有问题，但是一旦我点击主表单，它就会再次消失。

我理解大多数应用程序的这种良好行为，但我想让弹出的面板保持在屏幕上，直到明确关闭（通过面板本身内的关闭按钮）。

这可能吗？如果可以，怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T21:58:30.867

可以试试 ModalPopupExtender。它会锁定主页，直到弹出窗口上发生事件。

# c# - 一种为 Web 请求生成 QueryString 参数的简洁方法

> ID：375248
> 
> 赞同：3
> 
> 时间：2008-12-17T16:59:11.800
> 
> 标签：c#, .net, asp.net, url

我在当前的应用程序中遇到了一个问题，需要摆弄基`Page`类（我的所有页面都继承自）中的查询字符串来解决问题。由于我的一些页面使用查询字符串，我想知道是否有任何类提供干净和简单的查询字符串操作。

代码示例：

```
// What happens if I want to future manipulate the query string elsewhere
// (e.g. maybe rewrite when the request comes back in)
// Or maybe the URL already has a query string (and the ? is invalid)

Response.Redirect(Request.Path + "?ProductID=" + productId); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T17:18:44.707

使用`HttpUtility.ParseQueryString`, 正如有人建议的那样（然后删除）。

这将起作用，因为该方法的返回值实际上是 an `HttpValueCollection`，它继承`NameValueCollection`（并且是内部的，您不能直接引用它）。然后，您可以正常设置集合中的名称/值（包括添加/删除），并调用`ToString`-- 这将生成完成的查询字符串，因为`HttpValueCollection`覆盖`ToString`以重现实际的查询字符串。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T17:34:54.673

我希望找到一个内置到框架中的解决方案，但没有。（框架中的那些方法需要做很多工作才能使其简单干净）

在尝试了几种替代方案后，我目前使用以下扩展方法：（如果您有更好的解决方案或评论，请发布）

```
public static class UriExtensions
{
    public static Uri AddQuery(this Uri uri, string name, string value)
    {
        string newUrl = uri.OriginalString;

        if (newUrl.EndsWith("&") || newUrl.EndsWith("?"))
            newUrl = string.Format("{0}{1}={2}", newUrl, name, value);
        else if (newUrl.Contains("?"))
            newUrl = string.Format("{0}&{1}={2}", newUrl, name, value);
        else
            newUrl = string.Format("{0}?{1}={2}", newUrl, name, value);

        return new Uri(newUrl);
    }
} 
```

这种扩展方法可以实现非常干净的重定向和 uri 操作：

```
Response.Redirect(Request.Url.AddQuery("ProductID", productId).ToString());

// Will generate a URL of www.google.com/search?q=asp.net
var url = new Uri("www.google.com/search").AddQuery("q", "asp.net") 
```

并将适用于以下网址：

```
"http://www.google.com/somepage"
"http://www.google.com/somepage?"
"http://www.google.com/somepage?OldQuery=Data"
"http://www.google.com/somepage?OldQuery=Data&" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T20:12:18.617

请注意，无论您使用什么路线，您都应该真正对值进行编码 -`Uri.EscapeDataString`应该为您这样做：

```
string s = string.Format("http://somesite?foo={0}&bar={1}",
            Uri.EscapeDataString("&hehe"),
            Uri.EscapeDataString("#mwaha")); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T21:09:20.593

我通常做的只是重建查询字符串。Request 有一个 QueryString 集合。

您可以对其进行迭代以获取当前（未编码）参数，然后使用适当的分隔符将它们连接在一起（随时编码）。

优点是 Asp.Net 已经为您完成了原始解析，因此您无需担心尾随 & 和 ?s 等边缘情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-18T10:54:07.883

**检查这个！！！**

```
// First Get The Method Used by Request i.e Get/POST from current Context
string method = context.Request.HttpMethod;

// Declare a NameValueCollection Pair to store QueryString parameters from Web Request
NameValueCollection queryStringNameValCollection = new NameValueCollection();

if (method.ToLower().Equals("post")) // Web Request Method is Post
{
   string contenttype = context.Request.ContentType;

   if (contenttype.ToLower().Equals("application/x-www-form-urlencoded"))
   {
      int data = context.Request.ContentLength;
      byte[] bytData = context.Request.BinaryRead(context.Request.ContentLength);
      queryStringNameValCollection = context.Request.Params;
   }
}
else // Web Request Method is Get
{
   queryStringNameValCollection = context.Request.QueryString;
}

// Now Finally if you want all the KEYS from QueryString in ArrayList
ArrayList arrListKeys = new ArrayList();

for (int index = 0; index < queryStringNameValCollection.Count; index++)
{
   string key = queryStringNameValCollection.GetKey(index);
   if (!string.IsNullOrEmpty(key))
   {
      arrListKeys.Add(key.ToLower());
   }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-03T13:25:02.930

我找到了使用 get 参数轻松操作的方法。

```
public static string UrlFormatParams(this string url, string paramsPattern, params object[] paramsValues)
{
    string[] s = url.Split(new string[] {"?"}, StringSplitOptions.RemoveEmptyEntries);
    string newQueryString = String.Format(paramsPattern, paramsValues);
    List<string> pairs = new List<string>();

    NameValueCollection urlQueryCol = null;
    NameValueCollection newQueryCol = HttpUtility.ParseQueryString(newQueryString);

    if (1 == s.Length)
    {
        urlQueryCol = new NameValueCollection();
    }
    else
    {
        urlQueryCol = HttpUtility.ParseQueryString(s[1]);
    }

    for (int i = 0; i < newQueryCol.Count; i++)
    {
        string key = newQueryCol.AllKeys[i];
        urlQueryCol[key] = newQueryCol[key];
    }

    for (int i = 0; i < urlQueryCol.Count; i++)
    {
        string key = urlQueryCol.AllKeys[i];
        string pair = String.Format("{0}={1}", key, urlQueryCol[key]);
        pairs.Add(pair);
    }

    newQueryString = String.Join("&", pairs.ToArray());

    return String.Format("{0}?{1}", s[0], newQueryString);
} 
```

像这样使用它

```
"~/SearchInHistory.aspx".UrlFormatParams("t={0}&s={1}", searchType, searchString) 
```

# java - 调整浏览器大小时如何调整java小程序的大小？

> ID：375252
> 
> 赞同：8
> 
> 时间：2008-12-17T16:59:52.717
> 
> 标签：java, javascript, applet, resize

我有一个使用该`object-comment-embed`方法嵌入到 html 中的 java 小程序。每当调整浏览器窗口的大小时，我都想调整小程序的大小。我在互联网上找到了解决方案，但它们都基于已弃用的`applet`标签。

此外，当尝试在 FireBug 中`setSize()`调用我的`embed`元素时，它会调整小程序的内容，但不会调整小程序视口。也就是说，交给 java 的显示区域不会改变。

当前代码如下所示：

```
<object
    id='MyApplet1'
    width='300' height='200'
    classid='clsid:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX'
    codebase='http://java.sun.com/update/1.6.0/jinstall-6-windows-i586.cab#Version=1,6,0,0'>
    <param name='type' value='application/x-java-applet;version=1.6'>
    <param name='scriptable' value='false'>
    <param name='codebase' value='foo'>
    <param name='code' value='bar'>
    <param name='archive' value='baz'>
    <param name='arg1' value='A'>
    <param name='arg2' value='B'>
    <comment>
        <embed
            id='MyApplet2'
            width='300' height='200'
            pluginspage='http://java.sun.com/products/plugin/index.html#download'
            type='application/x-java-applet;version=1.6'
            scriptable='false'
            codebase='foo'
            code='bar'
            archive='baz'
            arg1='A'
            arg2='B'>
            <noembed>
            </noembed>
        </embed>
    </comment>
</object>
<script type="text/javascript"> 
function resize() {
  min_width = 300;
  min_height = 200;
  frame_width = 0;
  frame_height = 0;
  if(parseInt(navigator.appVersion) > 3) {
    if(navigator.appName=='Netscape') {
      frame_width = window.innerWidth;
      frame_height = window.innerHeight;
    }
    if (navigator.appName.indexOf('Microsoft') != -1) {
      frame_width = document.body.offsetWidth;
      frame_height = document.body.offsetHeight;
    }
  }
  frame_width *= 0.78;
  frame_height *= 0.78;
  applet_width = frame_width > min_width ? frame_width : min_width;
  applet_height = frame_height > min_height ? frame_height : min_height;
  document.getElementById('MyApplet1').setSize(applet_width, applet_height);
  document.getElementById('MyApplet2').setSize(applet_width, applet_height);
}
window.onResize = resize;
window.onLoad = resize;
</script> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T17:13:44.420

尝试替换这些行：

```
document.getElementById('MyApplet1').setSize(applet_width, applet_height);
document.getElementById('MyApplet2').setSize(applet_width, applet_height); 
```

和：

```
document.getElementById('MyApplet1').style.height = applet_height + "px";
document.getElementById('MyApplet1').style.width = applet_width + "px";

document.getElementById('MyApplet2').style.height = applet_height + "px";
document.getElementById('MyApplet2').style.width = applet_width + "px"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-22T06:39:49.923

Why don't you use percentage width and height. I usually use the following code for my applets:

```
<applet codebase="http://localhost:89" archive="npaxet?version=0.0.1.28" code="main.NPaxet.class" width=100% height=90%>\
<PARAM NAME="thumbnailUrl" VALUE="http://localhost:89/thumbnail?seriesid=%s">
<PARAM NAME="dicomUrl" VALUE="http://localhost:89/dicom?imageid=%d">
<PARAM NAME="seriesCount" VALUE="11">
...
</applet> 
```

# apache-flex - DataGrid 第一行中的 RadioButton 导致问题 - Adob e Flex

> ID：375254
> 
> 赞同：1
> 
> 时间：2008-12-17T16:59:55.650
> 
> 标签：apache-flex, actionscript, datagrid, itemrenderer

我在使用 itemRenderer 的一列中有一个带有 RadioButtons 的 DataGrid。DataGrid 驻留在 TitleWindow 上，每次用户单击按钮时都会创建和弹出该窗口。DataGrid 的 dataProvider 是一个 ArrayCollection，当显示窗口和 DataGrid 时，根据每个 ArrayCollection 项中的布尔值选择或不选择 RadioButtons。如果用户单击 DataGrid 中的不同 RadioButton，则 ArrayCollection 项将使用新的布尔值进行更新。

问题在于第一行中的 RadioButton 保持其选定值。对于所有其他行中的 RadioButton，当显示 TitleWindow 和 DataGrid 时，将根据 ArrayCollection 中项目的布尔值选择正确的 RadioButton。但如果第一行的 RadioButton 是需要选择的，则不是。我为 RadioButtons 上的 valueCommit 事件设置了一个侦听器，结果很有趣：除了第一个之外，所有行中 RadioButtons 的 valueCommit 只触发一次，所选值为 true。但是如果第一行中的 RadioButton 是应该被选中的，valueCommit 会被触发**5 次**，前 3 次将所选值报告为 true，最后 2 次将其报告为 false。

对此的任何帮助将不胜感激。[已经报告](http://bugs.adobe.com/jira/browse/SDK-18327)了一个类似的错误，但它没有提供任何解决方法。

UPDATE 12/18/08 OK，valueCommit 被触发了 5 次，第四次为假，第五次为假，实际上对应于数据中的索引 2 ALWAYS，不管它是什么。所以 4 次报告第一个 RadioButton，最后一次为假，第五次报告索引 2 为假。诡异的！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-18T21:02:36.673

解决方案：我没有使用 RadioButtons 作为 itemRenderer，而是使用了一个图像，它工作得更清晰，并且不会产生太多不可预测的行为。

# .net - CLR 存储过程调用 .NET 类实例

> ID：375255
> 
> 赞同：1
> 
> 时间：2008-12-17T17:00:10.533
> 
> 标签：.net, stored-procedures, clr, instance

我编写了一个 CLR 存储过程（如下所列） 抛出异常的代码行只是为了在 EventLog 中记录异常而添加的 我部署了程序集并在数据库中创建了存储过程 但是当我执行存储过程时Windows 的 EventLog 中没有记录任何条目

如果在单独的 Windows 控制台应用程序中使用 EventLog 的代码，则会记录异常

任何帮助，将不胜感激

谢谢，

阿龙加努

```
.......
using System.Diagnostics;
using System.Data.SqlClient;
using System.Data.SqlTypes;
using Microsoft.SqlServer.Server;
.......
[Microsoft.SqlServer.Server.SqlProcedure]
public static SqlInt32 Posting(SqlString tag)
{
  try
  {
      ...
       throw new ArgumentException("arg exc");
      ...
      return 0;    //  success
  }
  catch (Exception e)
  {
      try
      {
          EventLog PostingLog = new EventLog("Application");
          PostingLog.Source = "Posting";
          PostingLog.WriteEntry(e.Message, EventLogEntryType.Error);
          PostingLog.Close();
          return 1;   //  error
      }
      catch  // in case when another exception is raised from the try block above
      {
          return 1;   // error
      }
  }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:43:10.823

IIRC，您需要授予程序集不安全的权限。

# video - 未对齐的内存访问

> ID：375259
> 
> 赞同：3
> 
> 时间：2008-12-17T17:02:07.627
> 
> 标签：video, assembly, embedded, alignment, decoding

我正在开发不支持未对齐内存访问的嵌入式设备。

对于视频解码器，我必须处理 8x8 像素块中的像素（每个像素一个字节）。该设备具有一些 SIMD 处理功能，允许我并行处理 4 个字节。

问题是，8x8 像素块不能保证从对齐的地址开始，并且函数需要读取/写入最多三个这些 8x8 块。

如果您想要非常好的性能，您将如何处理？经过一番思考，我想出了以下三个想法：

1.  将所有内存访问作为字节进行。这是最简单的方法，但速度很慢，而且它不适用于 SIMD 功能（这是我目前在参考 C 代码中所做的）。

2.  编写四个复制函数（每个对齐情况一个），通过两个 32 位读取加载像素数据，将位移动到正确的位置，并将数据写入一些对齐的暂存内存块。然后视频处理功能可以使用 32 位访问和 SIMD。缺点：CPU 将没有机会隐藏处理背后的内存延迟。

3.  与上述相同的想法，但不是将像素写入暂存内存，而是进行视频处理。这可能是最快的方法，但是我必须为这种方法编写的函数数量很多（我猜大约 60 个）。

顺便说一句：我将不得不在汇编程序中编写所有函数，因为编译器在涉及 SIMD 扩展时会生成可怕的代码。

你会走哪条路，或者你有其他想法如何解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T19:16:39.073

您可以使用`memcpy`（如果我记得可以对其进行优化以在可能的情况下执行字复制）复制到对齐的数据结构（例如，分配在堆栈上或 from 的东西`malloc`）。然后对该对齐的数据结构执行处理。

不过，最有可能的是，您希望在处理器的寄存器中而不是在内存中处理事情。您将如何处理您的任务取决于硬件的功能（例如，一个 32 位寄存器可以拆分为四个 8 位寄存器吗？SIMD 操作对哪些寄存器进行操作？）如果您要走简单的路线，您可以调用一个小的加载器函数，它会为您执行未对齐的读取。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-30T05:55:51.140

首先对齐数据，然后采用对齐 SIMD 方法。

这比选项 3 的工作量少，幸运的是，您的代码将在 25% 的时间内达到最高速度（即已经对齐的情况）。*在您知道*输入将正确对齐的情况下，您将来可以愉快地重用代码。

只有当这不能让您满意时，您才应考虑将所有四种对齐可能性硬编码到您的函数中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-30T06:21:07.347

您应该首先将代码分解为获取/处理部分。

提取代码应该复制到工作缓冲区中，并且有对齐内存的情况（您应该能够使用 SIMD 寄存器进行复制）和需要逐字节复制的非对齐内存（如果您的平台可以） t 进行未对齐的访问，并且您的源/目标具有不同的对齐方式，那么这是您能做的最好的）。

然后，您的处理代码可以是 SIMD，并保证处理对齐的数据。对于任何真正程度的处理，复制+处理肯定会比对未对齐数据的非 SIMD 操作更快。

假设您的源和目标相同，进一步的优化将是仅在源未对齐时使用工作缓冲区，如果内存对齐，则在原地进行处理。这样做的好处将取决于您的数据的特征。

根据您的架构，您可以通过在处理之前预取数据获得更多好处。在这里，您可以发出指令以在需要之前将内存区域提取到缓存中，因此您可以在处理当前块之前发出对下一个块的提取。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T19:07:08.263

我会选择选项 1）直到你知道它太慢了（慢是可以的，太慢是不好的）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T06:28:15.770

一般建议：您为什么不使用听起来合理的东西（例如＃2）然后衡量性能？如果不可接受，您可以返回绘图板。

当然，在测量之前在汇编程序中手工制作 60 个函数会算作“过早的优化”。:)

# sql - 用于在表中查找代表性行的 SQL 查询

> ID：375262
> 
> 赞同：2
> 
> 时间：2008-12-17T17:03:38.700
> 
> 标签：sql

假设我有一个这样的付款表：

PaymentID INT、CustomerID INT、Value INT、PaidOn DATE

我想查询每个客户支付的最高金额。这是否可以使用单个 SQL 查询来避免不得不挖掘我不感兴趣的每一行——或者更糟的是，为每个客户运行一个查询？

到目前为止，我想出的最好的是：

SELECT CustomerID, MAX(Value) FROM Payments GROUP BY CustomerID;

但这并没有给我它找到的行的 PaymentId 或 PaidOn 值。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-17T17:19:20.633

```
select PaymentID, CustomerID, Value, PaidOn
from payments
where (customerID, value) in
( select customerID, max(value)
  from payments 
  group by customerID
); 
```

请注意，如果每个客户有不止一笔最高金额的付款，这可能会返回多于一行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T18:48:25.183

这与今天早些时候的[这个](https://stackoverflow.com/questions/374846/how-do-i-select-only-the-latest-entry-in-a-table)问题几乎相同。

为避免子查询，您还可以使用：

```
SELECT
     P1.PaymentID,
     P1.CustomerID,
     P1.Value,
     P1.PaidOn
FROM
     Payments P1
LEFT OUTER JOIN Payments P2 ON
     P2.CustomerID = P1.CustomerID AND
     P2.Value > P1.Value
WHERE
     P2.PaymentID IS NULL 
```

根据您需要更改此查询的值关系的业务规则。

例如，如果出现平局，则使用最新付款：

```
SELECT
     P1.PaymentID,
     P1.CustomerID,
     P1.Value,
     P1.PaidOn
FROM
     Payments P1
LEFT OUTER JOIN Payments P2 ON
     P2.CustomerID = P1.CustomerID AND
     (P2.Value > P1.Value OR (P2.Value = P1.Value AND P2.PaidOn > P1.PaidOn))
WHERE
     P2.PaymentID IS NULL 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T17:07:14.980

以下查询将完成此操作。它会拉出所有没有更大值的行。

```
SELECT *
FROM payments p
WHERE NOT EXISTS (
    SELECT *
    FROM payments p2
    WHERE p2.CustomerID = p.CustomerId
    AND   p2.Value > p.Value
) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T18:23:17.823

另一个使用自连接 - 语法糖的问题。更容易理解，性能也很好。

```
select PaymentID, CustomerID, Value, PaidOn
from
( select customerID, max(value) as maxValue
  from payments 
  group by customerID
)as T
 INNER JOIN payments as P
  ON P.Value=T.maxValue AND P.CustomerID = T.CustomerID 
```

——毛利克·莫迪

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T18:24:18.867

这是一个使用派生表的选项：

```
SELECT     p2.PaymentId, p2.CustomerID, p2.Value, p2.PaidOn
FROM         Payments AS p2 INNER JOIN
    (SELECT     CustomerID, MAX(Value) AS Value
     FROM          Payments
     GROUP BY CustomerID)
AS p1
ON p1.CustomerID = p2.CustomerID AND p1.Value = p2.Value 
```

# java - JTable选择改变事件处理：动态查找源表

> ID：375265
> 
> 赞同：4
> 
> 时间：2008-12-17T17:04:35.827
> 
> 标签：java, event-handling, jtable

我已经实现了自己的事件处理程序并将其添加到表的选择模型中：

```
table.getSelectionModel().addListSelectionListener(event); 
```

并实现了“事件”的方法（上面提到过）：

```
public void valueChanged(ListSelectionEvent e) {
    log.debug("value changed");
} 
```

不幸的是，如果我有机会进行选择，则事件会触发两次，并且似乎无法找到关联的表，因为 e.getSource 提供了 javax.swing.DefaultListSelectionModel。

因此我的问题是：

1) 为什么虽然 eventListener 只注册了一次，但它会触发两次？

2) 如何找到选择适用的表格？DefaultListSelectionModel 似乎没有提供任何 getSource() 或类似功能。

非常感谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-04-17T06:30:44.260

谢谢德拉蒙..它工作正常....

## 我们的准则

```
vMachinesTable.getSelectionModel().addListSelectionListener(new ListSelectionListener() {

    public void valueChanged(ListSelectionEvent lse) {
        if (!lse.getValueIsAdjusting()) {
            System.out.println("Selection Changed");
        }
    }
}); 
```

谢谢

特遣队

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T17:19:45.330

1）我想你会发现它会触发一次，用于取消选择旧选择，一次用于选择新选择。如果您记录事件的详细信息，您应该确切地看到正在发生的事情。我不记得细节，所以也许这是错误的。无论哪种方式，您都应该能够在事件上调用 getValueIsAdjusting() 并且只使用链中的最后一个（即当它返回 false 时）。

2）您通常不需要，但AFAIK唯一的方法是专门为表创建监听器（即将表传递给构造函数并记住它）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T19:09:15.577

由于不止一个 JTable（或我猜的其他组件）可以共享相同的选择模型，因此从事件中请求关联的 JTable 是没有意义的。这与您无法从 TableModel 中检索 JTable 的原因相同。正如 Draemon 建议的那样，将对 JTable 的引用存储在（或使其可访问）您的侦听器类中。

# vb.net - VB中匿名类型的语法是什么？

> ID：375268
> 
> 赞同：1
> 
> 时间：2008-12-17T17:06:22.453
> 
> 标签：vb.net, syntax, anonymous-types

我正在尝试设置 htmlAttribute 属性，但我无法找出正确的语法

这是它在 c# 中的工作方式

```
<%=Html.Password("myPassword", 50,"",new { style = "width:100px" })%><br /> 
```

什么是 vb.net 版本

```
new { style = "width:100px" } 
```

?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T17:11:40.243

VB 中内联匿名类型的正确语法是：

```
New With { .Style = "width:100px" } 
```

如果要声明匿名类型，请使用以下语法：

```
Dim myVariable = New With { .Style = "width:100px" } 
```

# algorithm - 编写桌面应用程序所需的最低 CompSci 知识

> ID：375272
> 
> 赞同：1
> 
> 时间：2008-12-17T17:07:40.970
> 
> 标签：algorithm, qt, computer-science

作为一名业余程序员已经 3 年（主要是 Python 和 C）并且从未编写过超过 500 行代码的应用程序，我发现自己面临着两种选择：

(1) 学习数据结构和算法设计的基本知识，这样我就可以成为一名 33 岁的计算机科学家。

(2) 学习 Qt，这将帮助我构建我一直*渴望*构建的项目。

对于学习（1），大家似乎都推荐阅读CLRS。不幸的是，阅读 CLRS 至少需要一年的学习时间（或者更多，我不是 Peter Krumins）。我也明白，要使用 (2) 完成任何中等复杂的任务，我至少需要了解 (1) 的基础知识，这让我想到了我的问题：假设我使用 C++ 作为选择的编程语言，*哪些***部分CLRS 会给我足够的算法和数据结构知识，以便使用 (2) 处理大型项目？**

换句话说，我需要**一份对日常应用程序编程任务绝对必要的理论 CompSci 主题列表**。此外，我想将 CLRS 用作方便的参考，因此我不想跳过任何对理解本书后面部分至关重要的材料。

不要在这里误会我的意思。离散数学和 CompSci 的理论基础已经在我的“TODO: URGENT”列表上大约 6 个月了，但由于大学工作，我没有足够的时间。很长一段时间后，我有 15 天的假期来做任何我喜欢做的事，我想用这 15 天来构建我真正*想要*构建的应用程序，而不是坐在办公桌前，手里拿着笔和纸，试图写下来教科书问题的解决方案。

（顺便说一句，关于算法的少数学多代码资源将受到高度赞赏。我刚从高中毕业，我的数学还没有达到应有的水平。）

谢谢 ：）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T17:39:57.347

This could be considered heresy, but the vast majority of application code does not require much understanding of algorithms and data structures. Most languages provide libraries which contain collection classes, searching and sorting algorithms, etc. You generally don't need to understand the theory behind how these work, just use them!

However, if you've never written anything longer than 500 lines, then there are a lot of things you DO need to learn, such as how to write your application's code so that it's flexible, maintainable, etc.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T17:16:04.323

要获得比 CLRS 更少的数学、更多的算法代码资源，请查看[Algorithms in a Nutshell](https://rads.stackoverflow.com/amzn/click/com/059651624X)。如果您要编写桌面应用程序，我不认为 CLRS 是必读的。如果您使用的是 C++，我认为[Sedgewick](https://rads.stackoverflow.com/amzn/click/com/0201350882)是更合适的选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T17:27:53.037

尝试一些在线计算机科学课程。伯克利有一些，麻省理工学院也有。软件工程广播也是一个很棒的播客。

另请参阅以下问题：

[对于盲人程序员来说，有哪些好的计算机科学资源？](https://stackoverflow.com/questions/370976/electronic-computer-science-resources#371557) [https://stackoverflow.com/questions/360542/plumber-programmers-vs-computer-scientists#360554](https://stackoverflow.com/questions/360542/plumber-programmers-vs-computer-scientists#360554)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T17:50:04.100

Heed the wisdom of Don and *just do it*. Can you define the features that you want your application to have? Can you break those features down into smaller tasks? Can you organize the code produced by those tasks into a coherent structure?

Of course you can. Identify any 'risky' areas (areas that you do not understand, e.g. something that requires more math than you know, or special algorithms you would have to research) and either find another solution, prototype a solution, or come back to SO and ask specific questions.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T18:03:50.217

Moving from 500 loc to a real (eve if small) application it's not that easy. As Don was pointing out, you'll need to learn a lot of things about code (flexibility, reuse, etc), you need to learn some very basic of configuration management as well (visual source safe, svn?)

But the main issue is that you need a way to don't be overwhelmed by your functiononalities/code pair. That it's not easy. What I can suggest you is to put in place something to 'automatically' test your code (even in a very basic way) via some regression tests. Otherwise it's going to be hard.

As you can see I think it's no related at all to data structure, algorithms or whatever.

Good luck and let us know

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T18:37:23.270

I must say that sitting down with a dry old textbook and reading it through is not the way to learn how to do anything effectively, even if you are making notes. Doing it is the best way to learn, using the textbooks as a reference. Indeed, using sites like this as a reference.

As for data structures - learn which one is good for whatever situation you envision: Sets (sorted and unsorted), Lists (ArrayList, LinkedList), Maps (HashMap, TreeMap). Complexity of doing basic operations - adding, removing, searching, sorting, etc. That will help you to select an appropriate library data structure to use in your application.

And also make sure you're reasonably warm with MVC - i.e., ensure your model is separate from your view (the QT front-end) as best as possible. Best would be to have the model and algorithms working on their own, and then put the GUI on top. Or a unit test on top. Etc...

Good luck!

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T18:40:11.983

It's like saying you want to move to France, so should you learn french from a book, and what are the essential words - or should you just go to France and find out which words you need to know from experience and from copying the locals.

Writing code is part of learning computer science. I was writing code long before I'd even heard of the term, and lots of people were writing code before the term was invented.

Besides, you say you're itching to write certain applications. That can't be taught, so just go ahead and do it. Some things you only learn by doing.

(The theoretical foundations will just give you a deeper understanding of what you wind up doing anyway, which will mainly be copying other people's approaches. The only caveat is that in some cases the theoretical stuff will tell you what's futile to attempt - e.g. if one of your itches is to solve an NP complete problem, you probably won't succeed :-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-17T18:42:09.890

I would say the practical aspects of coding are more important. In particular, source control is vital if you don't use that already. I like [bzr](http://bazaar-vcs.org/) as an easy to set up and use system, though GUI support isn't as mature as it could be.

I'd then move on to one or both of the classics about the craft of coding, namely

*   [The Pragmatic Programmer](https://rads.stackoverflow.com/amzn/click/com/020161622X)
*   [Code Complete 2](https://rads.stackoverflow.com/amzn/click/com/0735619670)

You could also check out the [list of recommended books on Stack Overflow](https://stackoverflow.com/questions/1711/what-is-the-single-most-influential-book-every-programmer-should-read).

# symbols - 相当于微软的 nm 命令

> ID：375273
> 
> 赞同：38
> 
> 时间：2008-12-17T17:08:00.143
> 
> 标签：symbols, nm

我长期以来一直使用 cygwin 的 nm 命令来满足我所有的 .lib 符号调试需求，但最近我考虑在 SO 答案中引用它，并意识到大多数 Windows 开发人员都没有安装 cygwin。

那么微软的nm等价物是什么，即什么命令会列出.lib文件导出的符号、.lib中未定义的符号等等？

对于好奇的人，[这里](http://unixhelp.ed.ac.uk/CGI/man-cgi?nm)有一个示例 nm 手册页。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-17T17:12:18.027

试试 dumpbin.exe。

[MSDN dumpbin.exe 参考](http://msdn.microsoft.com/en-us/library/c1h23y6c(v=vs.120).aspx)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2018-11-26T09:48:28.430

1.  运行`vcvarsall.bat`可能出现在 Microsoft Visual Studio 安装路径中的文件。这将设置所需的环境变量`dumpbin.exe`。

    `D:>"D:\Program Files (x86)\Microsoft Visual Studio 10.0\vcvarsall.bat" x86`

2.  然后使用`dumpbin.exe`. 例如`dumpbin.exe /ALL <bin_file>`给出所有符号。

# c# - 确定 aspx 页面是否由 window.open() 命令打开

> ID：375287
> 
> 赞同：1
> 
> 时间：2008-12-17T17:13:16.870
> 
> 标签：c#, asp.net, javascript

有没有办法在子页面的代码中确定是由父页面的 window.open() javascript 命令打开的？

弹出页面包含一个用户控件，该控件由不是从 window.open() 命令生成的其他页面使用，我想动态添加功能以在用户完成子页面中的任务后关闭页面。

它是一个 ASP.NET C# 3.5 应用程序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T17:15:39.253

你能通过查询字符串中的一个标志来指示窗口是从哪里产生的吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T17:16:45.523

在 javascript 中，您可以检查 window.opener 是否为空

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T17:19:26.437

对子窗口的请求可能会有一个`Referer`指向父页面的 HTTP（referrer）标头。您可以在后端检查或`window.opener`在客户端检查。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T17:16:27.597

可能是错的，但我认为没有简单直接的方法可以做到这一点。您总是可以尝试从不同的 url 中识别它，例如“MyChildForm.aspx?from=winopen”

--Edit-- 被 Galwegian 打败

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T17:18:24.647

您可以在用户控件中添加一些 javascript 来测试 window.opener 是否为非空，并在此基础上隐藏或显示关闭页面 UI。

# silverlight - Silverlight Scrollviewer 只有按钮

> ID：375291
> 
> 赞同：5
> 
> 时间：2008-12-17T17:13:59.320
> 
> 标签：silverlight, scrollviewer

我在 Silverlight 应用程序中使用 ScrollViewer。它具有水平方向，我希望它只出现滚动按钮，而不是滚动条本身。类似于这种粗略的 ASCII 渲染：

```
------------------------------------------------------
|   |                                            |   |
| < |                Content Here                | > |
|   |                                            |   |
------------------------------------------------------ 
```

我知道我可以使用模板功能，但我看到的所有示例只改变了所有元素的外观，而不是它们的原始位置，或者它们是否出现。是否有可能做到这一点，有人可以提供模板的外观吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T23:37:31.230

这是另一种选择。覆盖 SCrollviewer 的默认模板并将按钮作为 PageUp/PageDown 处理。我下面的示例是一个垂直滚动的滚动查看器。您可以轻松更改为水平滚动并将处理程序从 PageUp/PageDown 更改为 Left 和 Right 处理程序。

```
<ControlTemplate TargetType="{x:Type ScrollViewer}" x:Key="ButtonOnlyScrollViewer">
        <ControlTemplate.Resources>
            <!-- Add style here for repeat button seen below -->
        </ControlTemplate.Resources>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <RepeatButton Grid.Row="0"
                          Foreground="White" 
                          Background="Yellow" 
                          HorizontalAlignment="Stretch" 
                          Command="ScrollBar.PageUpCommand"
                          Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}">
            </RepeatButton>

            <ScrollContentPresenter
                CanContentScroll="{TemplateBinding CanContentScroll}"
                Grid.Row="1" 
                Content="{TemplateBinding Content}"  
                Width="{TemplateBinding Width}"
                Height="{TemplateBinding Height}" 
                Margin="{TemplateBinding Margin}"/>

            <RepeatButton Grid.Row="2" Background="Black" Foreground="White" Command="ScrollBar.PageDownCommand">
            </RepeatButton>
        </Grid>
    </ControlTemplate> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T19:47:44.500

我做过类似的事情，我发现最好的方法是将您的内容放在滚动查看器中，然后关闭滚动条。然后对按钮进行编码以滚动滚动查看器。

**编辑：**回应关于无法处理尺寸的评论。

首先，您可以将此控件构建为 ContentControl。它应该有一个在 generic.xaml 中定义的模板，其中包含您的按钮控件和滚动查看器。就像是：

```
<Canvas x:Name="root">
  <Button x:Name="left" Content="<"/>
  <Button x:Name="right" Content=">"/>
  <ScrollViewer x:Name="viewer" BorderThickness="0" VerticalScrollBarVisibility="Hidden">
    <ContentPresenter />
  </ScrollViewer>
</Canvas> 
```

然后在您的控制中，您需要覆盖 OnApplyTemplate：

```
public override void OnApplyTemplate()
{
  base.OnApplyTemplate();

  left = GetTemplateChild("left") as Button;
  left.Click += new RoutedEvent(YourHandler);
  right = GetTemplateChild("right") as Button;
  right.Click += new RoutedEvent(YourHandler);
  // position your scroll buttons here, not writing that code
  scroll = GetTemplateChild("viewer") as ScrollViewer;
  root = GetTemplateChild("root") as Canvas;

  var fe = this.Content as FrameworkElement;
  if (fe != null)
  {
    fe.SizeChanged += new SizeChangedEventHandler(fe_SizeChanged);
  }
}

void  fe_SizeChanged(object sender, SizeChangedEventArgs e)
{
  this.InvalidateMeasure();
}

protected override Size ArrangeOverride(Size finalSize)
{
  if (!double.IsInfinity(scroll.ViewportHeight))
  {
     left.Visibility = (scroll.HorizontalOffset > 0);
     right.Visibility = (scroll.HorizontalOffset < ScrollableHeight);
  }
  return base.ArrangeOverride(finalSize);
}

protected override Size MeasureOverride(Size availableSize)
{
  scroll.Measure(availableSize);
  return scroll.DesiredSize;
} 
```

在您的按钮单击处理程序中，您需要 (1) 滚动查看器并 (2) 检查 Horizo​​ntalOffset 的新值，以查看是否需要隐藏或显示任一按钮。

免责声明：此代码可能无法按原样工作，因为它是手工编写的，并且基于不同的示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-20T20:08:53.827

我在这里找到了解决方案:)

[http://weblogs.asp.net/fredriknormen/archive/2009/09/18/create-an-automatic-scrollable-image-slider-in-silverlight.aspx](http://weblogs.asp.net/fredriknormen/archive/2009/09/18/create-an-automatic-scrollable-image-slider-in-silverlight.aspx)

这是使用 DispatcherTimer 制作的，非常好的示例 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-08-14T10:36:58.980

我一直在寻找有效的解决方案很长时间了。并且基于路易斯的解决方案，我已经设法使其工作。（在 WPF 中）

此解决方案适用于**水平**滚动。

首先，添加 ListView：

```
 <ListView ItemsSource="{Binding Items}">
        <ListView.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal"/>
            </ItemsPanelTemplate>
        </ListView.ItemsPanel>
        <ListView.Template>
            <ControlTemplate>
                <ScrollViewer Template="{StaticResource ButtonOnlyScrollViewer}">
                    <ItemsPresenter />
                </ScrollViewer>
            </ControlTemplate>
        </ListView.Template>
    </ListView> 
```

以及来自路易斯的水平滚动答案的修改模板：

```
 <ControlTemplate TargetType="{x:Type ScrollViewer}" x:Key="ButtonOnlyScrollViewer">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <RepeatButton Content="&lt;"
                          Grid.Column="0"
                          Command="ScrollBar.LineLeftCommand"
                          Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>

            <ScrollContentPresenter
                CanContentScroll="{TemplateBinding CanContentScroll}"
                Grid.Column="1" 
                Content="{TemplateBinding Content}"  
                Width="{TemplateBinding Width}"
                Height="{TemplateBinding Height}" 
                Margin="{TemplateBinding Margin}"/>

            <RepeatButton Content="&gt;"
                          Grid.Column="2" 
                          Command="ScrollBar.LineRightCommand"
                          Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>
        </Grid>
    </ControlTemplate> 
```

# perl - 如何在 Perl 中对复杂数据结构的每个元素执行给定的函数？

> ID：375300
> 
> 赞同：1
> 
> 时间：2008-12-17T17:17:07.550
> 
> 标签：perl, data-structures, recursion, map

我想解码复杂数据结构中的所有 HTML 实体。基本上我正在寻找一个“超级地图（）”功能。这是我到目前为止所拥有的：

```
sub _html_decode {
    my $self = shift;
    my $ref = shift;

    if (ref($ref) eq "HASH") {
        $self->_html_decode_hash($ref)
    }
    if (ref($ref) eq "ARRAY") {
        $self->_html_decode_array($ref);
    }

}

sub _html_decode_array {
    my $self = shift;
    my $ref = shift;

    unless (@$ref) {return;}

    foreach (0 .. (scalar(@$ref) - 1)) {
        if (ref($ref->[$_]) eq "HASH") {
            $self->_html_decode_hash($ref->[$_]);
        }
        if (ref($ref->[$_]) eq "ARRAY") {
            $self->_html_decode_array($ref->[$_]);
        }
        else {
            $ref->[$_] = decode_entities($ref->[$_]);
        }
    }
}

sub _html_decode_hash {
    my $self = shift;
    my $ref = shift;

    unless (%$ref) {return;}

    while (my ($k, $v) = each %$ref) {
        if (ref($v) eq "HASH") {
            $self->_html_decode_hash($v);
        }
        if (ref($v) eq "ARRAY") {
            $self->_html_decode_array($v)
        }
        else {
            $ref->{$k} = decode_entities($v);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T17:31:48.020

我认为这应该可以，但我还没有测试过。

```
sub _html_decode {
    my ($self, $ref) = @_;

    if (ref($ref) eq "HASH") {
        for my $value (values %{$ref}) {
            $self->_html_decode($value);
        }
    }
    elsif (ref($ref) eq "ARRAY") {
        for my $value (@{$ref}) {
            $self->_html_decode($value);
        }
    }
    else {
        $_[1] = decode_entities($_[1]);
    }
} 
```

我承认最后一部分并不漂亮。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T19:45:00.560

要对任意复杂数据结构的每个元素执行子例程，请查看访问者设计模式。基本上，您的数据结构是一个对象，它知道它仍需要处理哪些元素，并将您的子例程应用于它们。那里还有一些迭代器模式，因为你知道如何

我的[Netscape::Bookmarks](http://search.cpan.org/dist/Netscape-Bookmarks)模块中有一个示例。该数据结构与几种不同类型的对象深度嵌套。通过使用访问者模式，大部分复杂性都消失了。

除此之外，您可能还想查看我的[Object::Iterate](http://search.cpan.org/dist/Object-Iterate)模块。它具有`imap`使用对象而不是列表的功能。我`__next__`从 Python 中借鉴了 的想法并将其应用到 Perl。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-18T01:01:15.663

[Data::Rmap](http://search.cpan.org/~bowmanbs/Data-Rmap-0.62/lib/Data/Rmap.pm)似乎也这样做了。有没有人有这个模块的经验？

# silverlight - 我应该在 Silverlight 项目中使用模型-视图-视图模型 (MVVM) 模式吗？

> ID：375301
> 
> 赞同：41
> 
> 时间：2008-12-17T17:17:30.170
> 
> 标签：silverlight, design-patterns, mvvm

Silverlight 控件的一个挑战是，当属性绑定到代码时，它们在 Blend 中不再是真正可编辑的。例如，如果您有一个从数据馈送中填充的 ListView，则在 Blend 中编辑控件时没有可见的元素。

我听说由 WPF 开发社区发起的 MVVM 模式也有助于保持 Silverlight 控件“可混合”。我仍在纠结它，但这里有一些解释：

*   [http://www.nikhilk.net/Silverlight-ViewModel-Pattern.aspx](http://www.nikhilk.net/Silverlight-ViewModel-Pattern.aspx)
*   [http://mark-dot-net.blogspot.com/2008/11/model-view-view-model-mvvm-in.html](http://mark-dot-net.blogspot.com/2008/11/model-view-view-model-mvvm-in.html)
*   [http://www.ryankeeter.com/silverlight/silverlight-mvvm-pt-1-hello-world-style/](http://www.ryankeeter.com/silverlight/silverlight-mvvm-pt-1-hello-world-style/)
*   [http://jonas.follesoe.no/YouCardRevisitedImplementingTheViewModelPattern.aspx](http://jonas.follesoe.no/YouCardRevisitedImplementingTheViewModelPattern.aspx)

一个潜在的缺点是该模式需要额外的类，尽管不一定需要更多代码（如上面的第二个链接所示）。想法？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-19T09:21:54.293

我绝对认为您应该将 MVVM 模式用于 Silverlight 应用程序 - 该模式的好处之一是您实际上可以通过一些简单的技术使您的应用程序真正可混合。我经常将“可混合性”称为“可设计性设计”——您使用某些技术来确保您的应用程序在 Blend 中看起来很棒。

Torbjørn 指出的其中一项技术是使用依赖注入框架并根据代码是在 Blend 中还是在浏览器中执行来提供外部服务的不同实现。因此，当代码在 Blend 中执行时，我将容器配置为使用虚拟数据提供程序，这样您就可以获得对列表框、数据网格等的设计时支持。

挑战通常是如何以声明方式设置 DataContext - 所以我经常最终使用服务定位器类 aa“前端”到 IoC 容器。这样我就可以将数据上下文绑定到服务定位器上的一个属性。

另一种技术是创建某种具有两个属性的 ObjectDataSource 控件（非可视）：设计时数据上下文和运行时数据上下文。该控件负责检测正在执行的位置，然后将 Parent DataContext 设置为正确的对象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T17:25:33.663

我不确定我是否能回答你的问题，但我发现下面的文章非常有价值。[Jonas Follesø](https://stackoverflow.com/questions/375301/should-i-use-the-model-view-viewmodel-mvvm-pattern-in-silverlight-projects/380477#380477)在设计/混合模式下使用 ninject 来切换他的服务。非常好！

[http://jonas.follesoe.no/YouCardRevisitedImplementingDependencyInjectionInSilverlight.aspx](http://jonas.follesoe.no/YouCardRevisitedImplementingDependencyInjectionInSilverlight.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-08T04:35:56.590

[我也同意 Jonas](https://stackoverflow.com/questions/375301/should-i-use-the-model-view-viewmodel-mvvm-pattern-in-silverlight-projects/380477#380477)关于使用 Silverlight 的 MVVM 的观点。我确实相信 MVP 也是一个不错的选择，但最近我有时间尝试使用 Silverlight 的 MVP 和 MVVM，我对 MVVM 的结果更满意。（是的，我使用 MVVM 越多，我就改变了主意）。VM 从 MVVM 中的视图（显然）抽象了模型的绑定，这允许比 MVP 更多的绑定场景（至少更简洁的方式来完成它们）。不过，这只是一方面。

我将在我的网站上发布一些使用 Silverlight 的 MVP 和 MVVM 示例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T20:13:59.953

我已经尝试了一些选项，并且我决定将 MVVM 作为我的最佳选择。可混合性是很重要的一点，我还发现 VM 方面对于装配动态行为、程序效果和动画（如 Nikhil 的 Silverlight.FX）很直观。有一次，我试图通过流畅的界面完全避免 Blend，但从长远来看，我发现 UI 和行为之间的耦合太痛苦了。我想在 Blend 中设计我的 UI，然后在代码中添加效果和其他行为，这被证明是迄今为止我遵循的最佳模式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-24T23:18:08.763

我认为我们中的许多人都在等待开拓者继续前进，并使用 Silverlight 中的 MVVM（以及就此而言的 WPF）创建非常好的示例应用程序。有许多棘手的地方，例如[Silverlight 中缺少 ICommand](http://blogs.southworks.net/jdominguez/2008/08/icommand-for-silverlight-with-attached-behaviors/) ，或者仅使用数据绑定[与动画开始和停止进行交互](https://stackoverflow.com/questions/286904/using-data-binding-to-launch-animations-in-wpf)的困难。

不过，这绝对是一种值得关注的模式，如果你不介意偶尔在你无法弄清楚的地方“作弊”，那么值得一试。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-27T13:07:52.957

[我同意乔纳斯](https://stackoverflow.com/questions/375301/should-i-use-the-model-view-viewmodel-mvvm-pattern-in-silverlight-projects/380477#380477)。MVVM 似乎是最适合我的模型（尽管 John Papa 认为 MVP 更有意义）。我有一篇关于这方面的 MSDN 文章将于 3 月发布，希望能响应号召，提供一个很好的例子。

顺便说一句，我希望在 MVVM 框架部门看到一些凝聚力。目前还没有一个好的框架可以遵循的解决方案。我喜欢 Jonas（我认为 Jonas 是 FX 框架），但由于它不兼容 WPF，因此它可能不是某些人的正确选择。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-10T05:51:57.507

我喜欢 ViewModel 模式并强烈推荐它。我的博客上有几篇“ViewModel 入门”类型的帖子。

*   [视图模型模式](http://blog.jeffhandley.com/archive/2008/10/21/viewmodel-pattern.aspx)
*   [HelloWorld.ViewModel](http://blog.jeffhandley.com/archive/2008/10/27/helloworld.viewmodel.aspx)
*   [绑定转换 - VisibilityConverter](http://blog.jeffhandley.com/archive/2008/10/27/binding-converters---visibilityconverter.aspx)
*   [带有 ViewModel 的 Silverlight 航空公司](http://blog.jeffhandley.com/archive/2008/11/14/silverlight-airlines-with-a-viewmodel.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-20T13:55:57.077

我最近在几个不同的 Silverlight 项目中使用了 MVVM，它运行得非常好，我肯定会推荐它。 [Jonas 的帖子](https://stackoverflow.com/questions/375301/should-i-use-the-model-view-viewmodel-mvvm-pattern-in-silverlight-projects/380477#380477)是一个很好的起点，我最近也写了一篇关于我的 MVVM 体验的[博客](http://blogs.conchango.com/davidwynne/archive/2008/12/15/silverlight-and-the-view-viewmodel-pattern.aspx)，并创建了一个非常简单的解决方案来演示主要接触点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-28T13:23:40.060

MVVM 模式有一个非常好的 Techdays 2010 视频介绍，解释清楚：

*   [TechDays 2010：了解模型-视图-视图模型模式](http://channel9.msdn.com/posts/kreekman/TechDays-2010-Understanding-the-Model-View-ViewModel-pattern/)
*   [Laurent 的 Hanselminutes 播客](http://www.hanselminutes.com/default.aspx?showID=260)

对于需要更高程度的自动化测试的更复杂的应用程序，这绝对是有意义的，并且从 DependencyProperties 到 DataContext 绑定的转变比它的 ASP.NET 对应项要简洁得多。

我在 Silverlight 中发现的最大挑战是测试实际 UI（我认为目前只有一个商业框架），以及在 Silverlight 中使用 WCF 服务（或 WebClient）时遇到的大量事件调用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-20T14:13:10.753

我一直认为 MVVM 和 PresntationModel [http://martinfowler.com/eaaDev/PresentationModel.html](http://martinfowler.com/eaaDev/PresentationModel.html)本质上是一回事。PresentationModel 说起来容易得多。我已经在 java swing、windows forms、WPF 和 silverlight 中成功使用了它。如果您从关注点分离的角度考虑，则表示模型很有意义。你有一个类，它唯一关心的是提供一个演示友好的模型。使用什么技术在屏幕上显示它真的无关紧要。它可能会更改一些实现细节，但无论您如何显示信息，将关注点分开是一个好主意。由于这种分离，无论视图技术如何，您都可以轻松地针对您的演示模型编写测试。所以这是一个优点。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-22T23:52:50.783

随着 2009 年 2 月 P&P 发布的 Prism v2，Silverlight 和 WPF 现在可以更好地支持 MVVM。有关详细信息，请参阅[microsoft.com/compositewpf 。](http://microsoft.com/compositewpf)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-03-05T19:05:30.497

看看我关于现实生活项目中的 MVVM 和 Silverlight 的文章，然后自己决定。

[http://alexburtsev.wordpress.com/2011/03/05/mvvm-pattern-in-silverlight-and-wpf/](http://alexburtsev.wordpress.com/2011/03/05/mvvm-pattern-in-silverlight-and-wpf/)

# perl - 为什么 Nginx 不能 POST 到我的 Perl 后端？

> ID：375310
> 
> 赞同：4
> 
> 时间：2008-12-17T17:20:59.587
> 
> 标签：perl, sockets, cgi, nginx, fastcgi

编辑：所以我刚刚发现 GET 方法确实有效，但是 POST 方法却不起作用！这可能很重要。

所以我在 Debian Etch 上，运行 Nginx。Nginx 通常不提供 cgi/pl 文件，所以我按照指南让我的后端工作。

[http://technotes.1000lines.net/?p=23](http://technotes.1000lines.net/?p=23)

我的后端在 Apache 上运行良好，但我必须安装一个使用 nginx (lib-www) 的模块。

它现在可以工作了，但由于某种原因，POST/GET 方法不起作用......举个例子，我的后端设置为在 url 中接受产品 SKU，它只是在你这样做时将其添加到购物车. 现在，如果我用这个附加值直接输入这个 url，它工作正常，将它添加到购物车，一切都很好......

但是，当我将产品添加到购物车时，我的所有产品页面都设置为提交到我的后端。它提交的值与我可以在浏览器窗口中输入的值完全相同，但它不起作用（与仅在我的 url 栏中输入它确实有效）。

现在我在想我正在使用的 perl 包装器代码有点错误还是什么？是这里：

[http://technotes.1000lines.net/fastcgi-wrapper.pl](http://technotes.1000lines.net/fastcgi-wrapper.pl)

我只做了一些更改...我只是创建了一个要在其中安装套接字的文件夹（但也许它应该一起放在不同的文件夹中），并且在我的 nginx conf 中我基本上是这样的：

```
location ~ ^/cgi-bin/.*\.pl$ {
  gzip off;
  fastcgi_pass  unix:/var/run/nginx/perl_cgi-dispatch.sock;
  fastcgi_param SCRIPT_FILENAME /www/blah.com$fastcgi_script_name;
  include fastcgi_params;
} 
```

我的参数和文章中的一样，我只有默认的 mime 类型设置。关于为什么这不起作用的任何想法？我也愿意提供您需要的任何额外信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T23:35:15.607

这个特殊的 fastcgi-wrapper.pl 脚本由 Denis S. Filimonov 修改以正确处理 POSTS 请求。你可以阅读更多关于它的信息：[http ://www.ruby-forum.com/topic/145858](http://www.ruby-forum.com/topic/145858)

# oracle - NHibernate - 关系上的复合 ID - 父级的 ID 不是相同的复合

> ID：375313
> 
> 赞同：1
> 
> 时间：2008-12-17T17:23:21.890
> 
> 标签：oracle, nhibernate, composite

假设我在 Oracle 数据库中有这些表

Person:
PersonId <- PK ID (int, from sequence)
PersonFirstNameID <-- int
PersonLastNameID <-- int
PersonSecurityID <-- int

PersonDetails
PersonFirstNameID -CompositeKey
PersonLastNameID -CompositeKey
PersonSecurityID -CompositeKey
PersonDetailKey
PersonDetailValue
PersonDetailRisk

现在我想在 NHibernate 中建模从 Person 到 PersonDetails 的一对多关系。

我怎样才能做到这一点？我尝试设置一个表示复合 Id 的组件并通过属性 ref 将其输入一对多，但是这会生成带有重复列的 SQL 并抛出以下内容： System.ArgumentException: Identifier type mismatch; 发现：预期：

NHibernate 文档仅在复合 ID 相同时才讨论这样做。

是的......它不是我的数据库架构，它是一个遗留数据库并且访问非常有限。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T22:47:21.610

不太清楚。

为了使外键关系起作用，子项必须引用父项的主键，因此数据结构表明 person 的主键是 FirstNameId/lastNameid/securityid （因此您最好的做法是忽略 personid 列） .

Person_Id 实际上是主键（在数据库中定义为 PK），还是数据库的 PERSON 主键版本实际上是 FirstNameId/lastNameid/securityid ？

# c# - ThreadPool 和 GUI 等待问题

> ID：375314
> 
> 赞同：1
> 
> 时间：2008-12-17T17:23:34.933
> 
> 标签：c#, threadpool, deadlock

我是线程新手，需要帮助。我有一个数据输入应用程序需要花费大量时间来插入新记录（即 50-75 秒）。所以我的解决方案是通过 ThreadPool 发送一个插入语句，并允许用户在插入运行时开始输入记录的数据，该插入返回一个新的记录 ID。我的问题是用户可以在从该插入返回新 ID 之前点击保存。

我尝试放入一个布尔变量，当可以安全保存时，该变量通过来自该线程的事件设置为 true。然后我输入

```
while (safeToSave == false)  
{  
    Thread.Sleep(200)  
} 
```

我认为这是个坏主意。如果我在胎面返回之前运行保存方法，它就会卡住。

所以我的问题是：

1.  有没有更好的方法来做到这一点？
2.  我在这里做错了什么？

谢谢你的帮助。
道格

**编辑以获取更多信息：**

它正在插入一个非常大（接近最大大小）的 FoxPro 数据库。该文件有大约 200 个字段和几乎一样多的索引。
在你问之前，不，我不能像以前那样改变它的结构，而且有大量的遗留代码在攻击它。第一个问题是，为了获得一个新 ID，我必须首先在表中找到 max(id)，然后对其进行递增和校验。这大约需要 45 秒。然后第一个插入很简单，插入新的 id 和一个 enterdate 字段。该表不是/不能放入 DBC 中，因此排除了自动生成的 id 等。

**@joshua.ewer**
你的过程是正确的，我认为短期内我只会禁用保存按钮，但我会研究你将其传递到队列中的想法。您是否有任何我应该看一看的 MSMQ 参考资料？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T17:33:49.747

1）很多:)，例如，您可以在线程插入对象时禁用“保存”按钮，或者您可以设置一个处理“保存请求”队列的线程工作者（但我认为这里的问题是用户想要修改新创建的记录，所以禁用按钮可能会更好）

2）我认为我们需要更多代码才能理解......（或者可能是同步问题，我也不是线程的错误粉丝）

顺便说一句，我只是不明白为什么插入需要这么长时间..我认为您应该先检查该代码！<- 正如查尔斯之前所说的（对不起，没有阅读帖子）:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T17:51:13.130

包括您在内的其他所有人都解决了核心问题（插入时间，为什么要进行插入，然后进行更新），因此我将仅解决您提出的解决方案的技术问题。所以，如果我的流程正确：

*   线程1：开始数据录入记录

*   线程 2：后台调用 DB 以检索新 ID

*   保存按钮始终处于启用状态，如果用户在线程 2 完成之前尝试保存，你让#1 休眠 200 毫秒？

最简单但不是最好的答案是只禁用按钮，并让该线程对启用按钮的委托进行[回调。](http://msdn.microsoft.com/en-us/library/system.threading.waitcallback.aspx "打回来")在您确定设置正确之前，他们无法启动更新操作。

不过，我认为更好的解决方案（尽管如果您只是为 FoxPro 构建 Q&D 前端可能会被夸大其词）是将这些保存操作放入队列中。用户可以尽快键入，然后将请求放入 MSMQ 之类的东西中，它们可以在自己的时间异步完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T17:52:21.863

使用[未来](http://ayende.com/Blog/archive/2008/01/02/Its-the-future-now.aspx)而不是原始 ThreadPool 操作。执行未来，允许用户做任何他们想做的事情，当他们在第二条记录上点击保存时，从未来请求值。如果第一次插入已经完成，您将立即获得 ID，并且第二次插入将被允许开始。如果你还在等待第 1 个操作，future 会阻塞直到它可用，然后才能执行第 2 个操作。

除非用户比操作慢，否则您不会节省任何时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T17:32:25.070

首先，您可能应该找出并修复插入需要这么长时间的原因......对于任何现代数据库来说，50-75 秒对于单行插入来说都是不合理的，并且表明需要解决其他问题，例如索引或阻塞...

其次，为什么要在获得数据之前插入记录？通常，对数据输入应用程序进行编码，以便在从用户那里收集到所有插入所需的数据之前，不会尝试插入。你这样做是因为你试图先从数据库中取回新的 ID，然后稍后用用户输入的数据“更新”新的空记录？如果是这样，几乎每个数据库供应商都有一种机制，您可以在不知道新 ID 的情况下只执行一次插入，并且让数据库也返回新 ID……您使用的是什么供应商数据库？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T23:45:01.730

这样的解决方案是否可行：

在用户开始添加之前预先计算唯一 ID。保留已在表中但实际上是占位符的唯一 ID 的列表。当用户尝试插入时，为他们保留一个唯一 ID，当用户按下保存时，他们现在用他们的数据替换占位符。

PS：很难确认这一点，但请注意您提出的以下并发问题（有或没有线程）：用户 A，开始添加，用户 B 开始添加，用户 A 计算 ID 1234 作为最大空闲ID，用户 B 计算 ID 1234 作为最大空闲 ID。用户 A 插入 ID 1234，用户 B 插入 ID 1234 = Boom！

# c# - XNA - 键盘文本输入

> ID：375316
> 
> 赞同：15
> 
> 时间：2008-12-17T17:24:53.633
> 
> 标签：c#, .net, xna

好的，所以基本上我希望能够检索键盘文本。就像在文本字段中输入文本或其他内容。我只是在为 Windows 编写我的游戏。我忽略了使用 Guide.BeginShowKeyboardInput，因为它破坏了独立游戏的感觉，而且 Guide 总是显示 XBOX 按钮的事实对我来说似乎也不合适。是的，这是最简单的方法，但我不喜欢它。

接下来我尝试使用 System.Windows.Forms.NativeWindow。我创建了一个继承自它的类，并将游戏窗口句柄传递给它，实现了 WndProc 函数以捕获 WM_CHAR（或 WM_KEYDOWN），尽管 WndProc 被调用以获取其他消息，WM_CHAR 和 WM_KEYDOWN 从未这样做过。所以我不得不放弃这个想法，此外，我还引用了整个 Windows 窗体，这意味着不必要的内存占用膨胀。

所以我的最后一个想法是创建一个线程级的低级键盘钩子。这是迄今为止最成功的一次。我收到 WM_KEYDOWN 消息，（尚未尝试 WM_CHAR）将带有 Win32 函数 MapVirtualKey 的虚拟键码转换为字符。我得到了我的文字！（我现在只是用 Debug.Write 打印）

不过有几个问题。就好像我有大写锁定和无响应的换档键。（当然不是，只是每个键只有一个虚拟键代码，因此翻译它只有一个输出）并且它会增加开销，因为它将自身附加到 Windows 挂钩列表并且不如我快我喜欢它，但速度慢可能更多是由于 Debug.Write。

有没有其他人解决了这个问题，而不必求助于屏幕键盘？或者有没有人有进一步的想法让我尝试？

提前致谢。

吉米提出的问题

> 也许我不明白这个问题，但你为什么不能使用 XNA 键盘和 KeyboardState 类？

我的评论：

> 这是因为尽管您可以读取键状态，但您无法访问键入的文本以及用户键入的方式。

所以让我进一步澄清。我想实现能够读取用户的文本输入，就好像他们正在输入文本框是窗口一样。键盘和 KeyboardState 类获取所有键的状态，但我必须将每个键和组合映射到它的字符表示。当用户不使用与我使用相同的键盘语言特别是符号时（我的双引号是 shift + 2，而美式键盘在返回键附近的某个地方），这就会失败。

* * *

看来我的窗口挂钩是要走的路，只是我没有得到 WM_CHAR 的原因是因为 XNA 消息泵不翻译消息。

每当我收到 WM `_`KEYDOWN 消息时添加 TranslateMessage 意味着我收到了 WM_CHAR 消息，然后我使用它在我的 KeyboardBuffer 类订阅的 MessageHook 类中触发字符类型事件，然后将其缓冲到文本缓冲区：D（或StringBuilder，但结果是一样的）

所以我让这一切都按我的意愿工作。

非常感谢 Jimmy 提供了一个非常有用的线程的链接。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-15T04:08:23.697

用于在 XNA 中添加 windows 挂钩

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
using System.Diagnostics;
using System.Reflection;

/* Author: Sekhat
 * 
 * License: Public Domain.
 * 
 * Usage:
 *
 * Inherit from this class, and override the WndProc function in your derived class, 
 * in which you handle your windows messages.
 * 
 * To start recieving the message, create an instance of your derived class, passing in the
 * window handle of the window you want to listen for messages for.
 * 
 * in XNA: this would be the Game.Window.Handle property
 * in Winforms Form.Handle property
 */

namespace WindowsHookExample
{
    public abstract class WindowsHook : IDisposable
    {
        IntPtr hHook;
        IntPtr hWnd;
        // Stored here to stop it from getting garbage collected
        Win32.WndProcDelegate wndProcDelegate;

        public WindowsHook(IntPtr hWnd)
        {
            this.hWnd = hWnd;

            wndProcDelegate = WndProcHook;

            CreateHook();
        }

        ~WindowsHook()
        {
            Dispose(false);
        }

        private void CreateHook()
        {

            uint threadId = Win32.GetWindowThreadProcessId(hWnd, IntPtr.Zero);

            hHook = Win32.SetWindowsHookEx(Win32.HookType.WH_CALLWNDPROC, wndProcDelegate, IntPtr.Zero, threadId);

        }

        private int WndProcHook(int nCode, IntPtr wParam, ref Win32.Message lParam)
        {
            if (nCode >= 0)
            {
                Win32.TranslateMessage(ref lParam); // You may want to remove this line, if you find your not quite getting the right messages through. This is here so that WM_CHAR is correctly called when a key is pressed.
                WndProc(ref lParam);
            }

            return Win32.CallNextHookEx(hHook, nCode, wParam, ref lParam);
        }

        protected abstract void WndProc(ref Win32.Message message);

        #region Interop Stuff
        // I say thankya to P/Invoke.net.
        // Contains all the Win32 functions I need to deal with
        protected static class Win32
        {
            public enum HookType : int
            {
                WH_JOURNALRECORD = 0,
                WH_JOURNALPLAYBACK = 1,
                WH_KEYBOARD = 2,
                WH_GETMESSAGE = 3,
                WH_CALLWNDPROC = 4,
                WH_CBT = 5,
                WH_SYSMSGFILTER = 6,
                WH_MOUSE = 7,
                WH_HARDWARE = 8,
                WH_DEBUG = 9,
                WH_SHELL = 10,
                WH_FOREGROUNDIDLE = 11,
                WH_CALLWNDPROCRET = 12,
                WH_KEYBOARD_LL = 13,
                WH_MOUSE_LL = 14
            }

            public struct Message
            {
                public IntPtr lparam;
                public IntPtr wparam;
                public uint msg;
                public IntPtr hWnd;
            }

            /// <summary>
            ///  Defines the windows proc delegate to pass into the windows hook
            /// </summary>                  
            public delegate int WndProcDelegate(int nCode, IntPtr wParam, ref Message m);

            [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Auto)]
            public static extern IntPtr SetWindowsHookEx(HookType hook, WndProcDelegate callback,
                IntPtr hMod, uint dwThreadId);

            [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Auto)]
            public static extern bool UnhookWindowsHookEx(IntPtr hhk);

            [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Auto)]
            public static extern int CallNextHookEx(IntPtr hhk, int nCode, IntPtr wParam, ref Message m);

            [DllImport("coredll.dll", SetLastError = true)]
            public static extern IntPtr GetModuleHandle(string module);

            [DllImport("user32.dll", EntryPoint = "TranslateMessage")]
            public extern static bool TranslateMessage(ref Message m);

            [DllImport("user32.dll")]
            public extern static uint GetWindowThreadProcessId(IntPtr window, IntPtr module);
        }
        #endregion

        #region IDisposable Members

        public void Dispose()
        {
            Dispose(true);
        }

        private void Dispose(bool disposing)
        {
            if (disposing)
            {
                // Free managed resources here
            }
            // Free unmanaged resources here
            if (hHook != IntPtr.Zero)
            {
                Win32.UnhookWindowsHookEx(hHook);
            }
        }

        #endregion
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-16T22:45:16.380

我使用了这个[gamedev.net 帖子](http://www.gamedev.net/community/forums/topic.asp?topic_id=457783)中的解决方案，效果很好:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-18T02:47:53.347

这是一个简单的方法，IMO，有`space`, `back`，`A-Z`然后是特殊的 chars `!,@,#,$,%,^,&,*,(,)`。（注意，您需要 import `System.Linq`）以下是字段：

```
Keys[] keys;
bool[] IskeyUp;
string[] SC = { ")" , "!", "@", "#", "$", "%", "^", "&", "*", "("};//special characters 
```

构造函数：

```
keys = new Keys[38];
Keys[] tempkeys;
tempkeys = Enum.GetValues(typeof(Keys)).Cast<Keys>().ToArray<Keys>();
int j = 0;
for (int i = 0; i < tempkeys.Length; i++)
{
    if (i == 1 || i == 11 || (i > 26 && i < 63))//get the keys listed above as well as A-Z
    {
        keys[j] = tempkeys[i];//fill our key array
        j++;
    }
}
IskeyUp = new bool[keys.Length]; //boolean for each key to make the user have to release the key before adding to the string
for (int i = 0; i < keys.Length; i++)
    IskeyUp[i] = true; 
```

最后，更新方法：

```
string result = "";

public override void Update(GameTime gameTime)
{
    KeyboardState state = Keyboard.GetState();
    int i = 0;
    foreach (Keys key in keys)
    {
        if (state.IsKeyDown(key))
        {
            if (IskeyUp[i])
            {
                if (key == Keys.Back && result != "") result = result.Remove(result.Length - 1);
                if (key == Keys.Space) result += " ";
                if (i > 1 && i < 12)
                {
                    if (state.IsKeyDown(Keys.RightShift) || state.IsKeyDown(Keys.LeftShift))
                        result += SC[i - 2];//if shift is down, and a number is pressed, using the special key
                    else result += key.ToString()[1];
                }
                if (i > 11 && i < 38)
                {
                    if (state.IsKeyDown(Keys.RightShift) || state.IsKeyDown(Keys.LeftShift))
                       result += key.ToString();
                    else result += key.ToString().ToLower(); //return the lowercase char is shift is up.
                }
            }
            IskeyUp[i] = false; //make sure we know the key is pressed
        }
        else if (state.IsKeyUp(key)) IskeyUp[i] = true;
        i++;
    }
    base.Update(gameTime, otherScreenHasFocus, coveredByOtherScreen);
} 
```

希望这很好的帮助。我个人认为它比钩子更容易使用，而且也可以很容易地修改它以获得特殊结果（例如洗牌）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T17:27:38.090

也许我不明白这个问题，但你为什么不能使用 XNA 键盘和 KeyboardState 类？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-03T02:11:47.867

此页面位于关于 xna 中 WM_CHAR 拦截的谷歌结果之上，所以我在这里留下一些注释。也许这对其他人有用（如果他们能够理解我的英语 =))）。

我尝试使用 Sekhat 的 windowshook 代码，但似乎应该将 WH_GETMESSAGE 传递给 SetWindowsHookEx 而不是 Win32.HookType.WH_CALLWNDPROC （只有 WH_GETMESSAGE 代码 lparaw 将指向 Win32.Message ）。

有时还会出现重复的消息（使用 wparam 0）。（看这里 - [http://msdn.microsoft.com/en-us/library/ms644981%28v=VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/ms644981%28v=VS.85%29.aspx) 关于 WPARAM 中的 PM_NOREMOVE/PM_REMOVE 的东西）

当我添加这样的东西

```
 if (nCode >= 0 && wParam == 1)
    {
        Win32.TranslateMessage(ref lParam); 
        WndProc(ref lParam);
    } 
```

wm_keypress wm_char 复制停止（我假设 1 是 PM_NOREMOVE 或 PM_REMOVE）。

PS nuclex 变体现在显示 404 页面，但可以使用 webarchive 查看。nuclex 变体有效，但它会导致本地 XNA MouseState（在 XNA 3.1 上）的 mouseWheel 处理中断=（

# css - 下拉框未完全显示（所有浏览器）

> ID：375320
> 
> 赞同：0
> 
> 时间：2008-12-17T17:26:12.883
> 
> 标签：css, drop-down-menu

![下拉截图](https://farm4.static.flickr.com/3200/3116366800_570cc971b9_m.jpg)

这将是我的问题，我有一个未完全显示的下拉菜单。我什至不确定从哪里开始，所以这里是下拉列表周围的 HTML，我也会提供 CSS。

HTML

```
<div id="add_item">
 <ul class="vert">
  <li>
   <ul class="horz">
    <li class="name">
     <select style="width: 195px; padding: 0px; margin: 0px;" disabled="disabled">
      <option value=""></option>
      <option value="0">0</option>
     </select>

    </li>
    <li class="quantity">
     <select style="width: 50px; padding: 0px; margin: 0px;" disabled="disabled">
      <option value=""></option>
      <option value="0">0</option>
     </select>
    </li>
   </ul>

  </li>
 </ul>
</div> 
```

代码的下拉菜单被禁用的原因是因为它是动态的，周围的 HTML 是相同的，除了有可供选择的选项并且不再被禁用。

CSS

```
div#byitem ul.horz li.name {
background:transparent none repeat scroll 0 0;
display:block;
font-size:11px;
font-weight:bold;
width:195px;
}

div#byitem ul.horz {
background:transparent none repeat scroll 0 0;
clear:left;
list-style-type:none;
margin:0;
padding:0;
}

div#byitem ul.vert li {
background:transparent none repeat scroll 0 0;
height:14px;
margin:0;
padding:0;
}

div#byitem ul.vert {
background:transparent none repeat scroll 0 0;
list-style-type:none;
margin:0;
padding:0;
width:540px;
}

element.style {
margin-bottom:0;
margin-left:0;
margin-right:0;
margin-top:0;
padding-bottom:0;
padding-left:0;
padding-right:0;
padding-top:0;
width:195px;
}
#content form select {
margin:0 0 4px 4px;
z-index:1;
}
html, body, div, p, form, input, select, textarea, fieldset {
-x-system-font:none;
color:#333333;
font-family:Arial,Helvetica,Verdana,sans-serif;
font-size:11px;
font-size-adjust:none;
font-stretch:normal;
font-style:normal;
font-variant:normal;
font-weight:normal;
line-height:15px;
}
* {
margin:0;
padding:0;
} 
```

感谢您的任何建议。

# 编辑

我已经为包含下拉菜单的 div 添加了 CSS。更改行高也没有什么区别。两个下拉菜单（项目和数量）之间的唯一区别是宽度。更改 Item 的宽度并没有什么不同。

取出 Add another item 链接，因为这被怀疑是一个问题，没有变化。我也在 Firefox 中进行开发，我刚刚发布了来自 Safari 的屏幕截图。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T17:47:36.380

看起来您正在设置“line-height:15px;” 关于“选择”元素。删除它，看看它是否能解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:04:55.143

如果您元素上的样式对于相同类型（宽度除外）都是相同的，那么似乎唯一可能的罪魁祸首是页面中的周围元素。例如，有问题的下拉列表下方的“添加另一个项目”链接的 css/html 是什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:20:11.150

我建议使用 Firefox 中的[Firebug](http://getfirebug.com/)插件检查您的页面。它可以显示和更改分配给您的元素的 CSS 样式，您将立即解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T18:46:46.107

它可能不是 DDL，但页面上的其他内容可能覆盖了它的一部分。在 FireFox 中，在 DDL 底部的空白处尝试“检查元素”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T19:07:26.440

下拉菜单可能没有区别；但是，根据您提供的代码，`LI`包含它们的 s 存在差异。

您为所有列表项设置了基本样式，但也为`li.name`. 我会专注于`div#byitem ul.horz li.name`风格。没有足够的代码让我在本地重现它，但我猜那`display: block`是罪魁祸首。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T22:02:19.753

杰罗米是正确的，区别在于包含选择的 li 和考虑到您正在浮动 li 的周围元素。

尝试更改以下样式的高度，看看你的结果是什么。

```
div#byitem ul.vert li {
    background:transparent none repeat scroll 0 0;
    height:17px;
    margin:0;
    padding:0;
} 
```

希望这可以帮助您追踪它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T22:17:40.220

即使它最终没有解决问题，我强烈建议将`height:`声明从 the`li`和`select`元素中删除。显示大小将取决于浏览器使用的字体。由于您无法控制用户计算机上安装的字体，因此您无法保证浏览器将使用哪种字体。这些高度迟早会给您带来问题（并且可能是您当前问题的原因）。

# delphi - acrobat 如何对作为便笺添加到 pdf 的注释进行编码？

> ID：375321
> 
> 赞同：2
> 
> 时间：2008-12-17T17:26:18.140
> 
> 标签：delphi, delphi-2009, acrobat

多年来，我们一直在通过我们的应用程序中的 activex 控件读取和写入 pdf 的便笺/注释/注释。我们最近升级到了支持 Unicode 的 Delphi2009。以下是引起问题的原因。

当我们打电话

CAcroPDAnnot.GetContents

结果似乎很奇怪，我们丢失了 Unicode 字符。这不像保存为 ansi 字符串，这通常会导致返回 ????? 相反，我们得到一个字符串，例如

‚És‚“ú‚É•—Ž×‚ð‚‚‚‚‚½‚ç</p>

对于一串日文字符。

但是，如果我通过 pdf 本身的菜单将 pdf 中的注释保存到数据文件中，它将被写入文件，如下所示

0k^L0Oeå0k~¨ª0'0r0D0_0‰</p>

后者可以导出并重新导入到 acrobat pdf 中，并将重新创建正确的 unicode 字符。但是，一旦我在我的代码中调用 CAcroPDAnnot.GetContents，它就会以其他方式返回。

1.  CAcroPDAnnot.GetContents 坏了吗？
2.  是否有我应该注意的编码方案？
3.  有没有我可以做的替代方案？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T17:38:53.313

> ‚És‚“ú‚É•—Ž×‚ð‚‚‚‚‚½‚ç</p>

那是字符串：

に行く日に风邪をひいたら

在 CP-932 又名 Shift-JIS 编码中，这是一种糟糕但在日本仍然流行的编码。

您当前将其解释为 CP-1252（Windows 西欧）。如果您的 PDF 阅读组件不会自动为您转换，您需要找到一种方法来检测文档的编码并手动转换。

我不知道 Delphi 为读取编码提供了什么，但是您是否从控制面板 -> 区域选项 ->“为东亚语言安装文件”选项中安装了 Shift-JIS 的编码？如果不是，那也许可以解释为什么它无法自动转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T17:21:13.333

你并没有给我们提供很多信息来处理。

我认为您在这里谈论的是“Acrobat.CAcroPDAnnot”类的 GetContents 方法。您使用的是哪个版本的 Acrobat？您是否在开始使用 Delphi 2009 编程时切换了版本（或运行了更新）？

然后：你是如何实例化对象的？如果使用从 DLL 生成的 *_TLB.pas 文件，您确定它仍然匹配吗？（如果不确定，请尝试重新生成它）。

第三：你是怎么调用方法的？您将结果分配给什么类型的变量？

如果您可以提供注释样本（最好包括非 ASCII 字符），这也可能会有所帮助；对于那个注释：

*   它*应该*是什么样子（以及它在 Reader 中的样子）
*   使用 2009 之前版本的 Delphi* 时返回的内容
*   使用 Delphi 2009 时返回的内容*

（* 最好是（ansi/wide）字符串的 HEX 字节码；但是 Ctrl-F7 检查器的输出应该可以）

那么也许有人可以提供更有意义的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:14:50.477

好的，Delphi 2009 和早期版本之间的主要区别之一是默认字符串类型是 unicode 字符串。这意味着如果您使用与以前版本相同的 ActiveX 组件，您会将 unicode 字符串传递给 ascii 字符串，这通常不是一个好主意。

这个问题有几个解决方案：

*   试试你是否可以升级你的 activeX 组件，以便它支持完整的 unicode 字符串。
*   使用 AnsiString 而不是 string 与 activeX 组件进行通信。在这种情况下，您仍然可以使用旧界面，但您仍然受到相同的限制。
*   使用创建 pdf 的其他控件。有很多东西要找，但要准备好更改大部分软件。（一些控件基于 XML 并使用编码。）

# macos - AppleScript：将安装的文件夹添加到 Finder 边栏？

> ID：375323
> 
> 赞同：2
> 
> 时间：2008-12-17T17:26:48.200
> 
> 标签：macos, applescript, finder, automator

我有一个安装文件夹的简单 Apple 脚本：

```
mount volume smb://machineip/folder 
```

这在启动时运行，因为 Mac OS X 10.5.5 没有像 Windows 这样的映射驱动器的概念。脚本并没有达到我想要的程度。我将机器 IP 添加到 Finder 侧边栏，当我单击它时，会出现该机器的所有共享文件夹，包括上面带有小弹出图标的“文件夹”。如何使用 Apple Script 让该文件夹出现在 Finder 边栏中的“设备”下。

有没有办法通过Automator也做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T21:01:29.017

您可能想研究使用 fstab 而不是挂载脚本。[在这里](http://forums.macrumors.com/showthread.php?t=170786)查看如何解决这个问题。如果您想在 Finder 的侧边栏上安装可用的文件夹，您可能只需将 /Volumes/(name) 文件夹拖到您的位置栏。

# java - org.springframework.webflow.util.RandomGuid 上的错误 java.lang.NoClassDefFoundError

> ID：375332
> 
> 赞同：7
> 
> 时间：2008-12-17T17:28:41.973
> 
> 标签：java, linux, tomcat, classpath, centos5

对不起，我的问题很愚蠢，但作为一个java文盲，我无法回答。我在 CentOS5（用于 CAS 服务器）上运行了一个 tomcat (5)，当我尝试打开这个 URL [http://192.168.1.17:8080/cas-server-webapp-3.3.1/login](http://192.168.1.17:8080/cas-server-webapp-3.3.1/login)时，我收到了这个错误：

第一个错误：java.lang.NoClassDefFoundError：无法初始化类**org.springframework.webflow.util.RandomGuid**

和根错误：org.springframework.web.util.NestedServletException：处理程序处理失败；嵌套异常是 java.lang.NoClassDefFoundError: 无法初始化类 org.springframework.webflow.util.RandomGuid

$CLASSPATH 是空的，好像有问题，但是不知道往里面放什么。

编辑：Jared 是对的，我的主机文件将 127.0.0.1 定义为 localhost，现在它工作得很好！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-12T18:55:08.343

在这种情况下，重要的是要牢记两三个不同的例外情况：

1.  **`java.lang.ClassNotFoundException`** 此异常表明在类路径中找不到该类。这表明我们正在尝试加载类定义，并且类路径中不存在该类。

2.  **`java.lang.NoClassDefFoundError`** 此异常表明 JVM 在其内部类定义数据结构中查找类的定义，但没有找到。这与说它无法从类路径加载不同。通常这表明我们之前尝试从类路径加载一个类，但由于某种原因失败了 - 现在我们再次尝试，但我们甚至不会尝试加载它，因为我们之前加载它失败了。较早的失败可能是 ClassNotFoundException 或 ExceptionInInitializerError（指示静态初始化块中的失败）或任何数量的其他问题。关键是，NoClassDefFoundError 不一定是类路径问题。

话虽如此，另一个答案海报表明 RandomGUID 需要调用 InetAddress.getLocalHost()。在许多操作系统上，这将触发使用主机文件的主机查找（`/etc/hosts`在 *NIX 系统上，`%WINDOWS%/system32/drivers/etc/HOSTS`在 Windows 系统上。）

当该文件错误地定义了本地主机地址时，我经常看到类似的错误。 `127.0.0.1`应该指向“localhost”（也可能是`localhost.localdomain`.）它不应该**指向**机器的实际主机名（尽管出于某种原因，许多旧的 RedHat Linux 安装程序喜欢错误地设置它。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T17:33:55.613

现在，不应该使用环境变量 $CLASSPATH；相反，java 应用程序应该在命令行上设置类路径。

但是，对于 webapps 中使用的 tomcat 和库，您只需将 JAR（用于 Spring）放入 tomcat 安装的 shared/lib/ 文件夹中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T17:52:50.053

NoClassDef：在编译当前执行的类时，搜索到的类定义已经存在，但无法再找到该定义。由于您缺少一个弹簧类，我猜您缺少一个弹簧 jar 文件。

有 2 个地方可以在 tomcat 中放置 jar，有一个全局区域（在 5 中类似于 common/lib，在 tomcat6 中有点不同）和仅用于您的 webapp 的区域，即 webapps/mywebapp/WEB-INF/库。你的应用程序的 jars 真的应该放在这里，但是如果你真的很困惑并且想不出任何其他方法让它工作，它们将在全局中工作（如果你在全局中只有其中一些可能也会中断，因为他们可能需要另一个 jar 中的类，如果其中一个在本地，它将无法工作。对于 spring 库尤其如此，因为有许多单独的 jar，而不仅仅是一个）。

您的 CLASSPATH 是 jvm 查找类的所有位置的列表。这可能包括类文件的目录，或者类的 jar 或 zip 文件，它们像目录一样列出。Tomcat 应该通过正确使用上述目录为您加载它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T18:19:51.947

原因是无法加载类 RandomGUID。

通过查看 RandomGUID[源](http://www.docjar.com/html/api/org/springframework/webflow/util/RandomGuid.java.html)，它的静态初始化程序在 InetAddress.getLocalHost() 失败的大部分机会。

你在主机上有一些奇怪的网络配置吗？例如， /etc/hosts 中没有或奇怪的 localhost 定义？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-08T18:33:48.650

如果这对您正在构建的内容突然出现且不合逻辑，请尝试重命名和重命名错误日志中引用的类。这在 Netbeans 中帮助了我好几次。

# javascript - 修改javascript的“window.open()”函数打开的窗口

> ID：375340
> 
> 赞同：1
> 
> 时间：2008-12-17T17:30:39.177
> 
> 标签：javascript, javascript-events

这是我的场景：

我有一个包含多个链接的页面；每个链接旨在打开另一个包含 pdf 的窗口。问题是，我不能让该窗口直接转到 PDF，因为我不想让最终用户看到 PDF 位于另一个域中，并且我需要以不同于通常的方式命名 PDF出现。

那么我有两页：一个是空白的，只包含一个用于显示 pdf 的框架：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
    <head>
        <title>[PDF]</title>
    </head>
    <frameset>
        <frame id="pdfFrame">
    </frameset>
</html> 
```

在带有链接的页面上，我有以下调用此页面的函数（我们将上述页面称为“pdf.html”）：

```
function OpenWindow(pdfTitle, pdfLocation)
{
    var myWindow = window.open("pdf.html", "", "toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1,resizable=1,width=700,height=600");

    myWindow.document.title = pdfTitle; 
    myWindow.document.getElementById('pdfFrame').src = pdfLocation;
} 
```

在大多数情况下，这似乎工作正常。但是，有时弹出窗口不会在上面设置标题/帧源的行之前加载，并且它会崩溃（或至少无法正确加载）。

我的问题是，有没有一种简单的方法让我在打开窗口后添加某种阻塞调用，等到我们准备好运行这段代码？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T17:38:03.123

在加载之前你不能真正阻止它，但你可以在弹出窗口中设置一个事件，如下所示：

```
myWindow.onload = function()
{
    document.title = pdfTitle;
    document.getElementById('pdfFrame').src = pdfLocation;
} 
```

# asp.net - ASP.NET 视图状态验证 - ASP.NET 1.1 与 ASP.NET 3.5

> ID：375341
> 
> 赞同：1
> 
> 时间：2008-12-17T17:30:55.527
> 
> 标签：asp.net, validation, viewstate

我们正在将我们的 Web 应用程序从 ASP.NET 1.1 迁移到 ASP.NET 3.5。我们的应用程序通过 DNS 循环在多个服务器上运行，因此每个浏览器请求都可能最终在不同的服务器上。我们的 web.config 中确实有一个来防止验证错误。

但是，我们的计划是一次迁移一台服务器。现在看起来就像用户在 1.1 上加载页面时的样子。服务器，然后页面在回发时在 3.5 服务器上结束，视图状态验证失败。

我在网上找不到任何关于这个问题的东西——我只是猜测视图状态验证在 1.1 之间不兼容。和 3.5，即 1.1 生成的视图状态不会在 3.5 上验证，即使使用相同的 machineKey，反之亦然。

谁能证实这个怀疑？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T17:33:02.213

[使用类似帖子](https://stackoverflow.com/questions/370109/load-balancing-ajax-and-you#370115)中提到的粘性会话。这将使用户在同一台​​机器上保持一段时间。

我认为允许单个用户在单个会话中访问框架的三个不同版本是不明智的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T17:40:26.927

您是否为 3.5 主机运行 IIS7？我在 IIS7 上运行 1.1 应用程序时遇到了很多问题。让 1.1 应用程序在 IIS7 上正常运行已经很困难了，更不用说尝试跨多个框架版本进行网络花园了。我遇到的最大问题是 ViewState 的加密或管理方式与以前版本的 IIS 不同。如果您尝试在 1.1 上设置 weg-garden，则会收到各种 ViewState 加密错误。您不能在 IIS7 上的 1.1 应用程序上设置网络花园（具有多个工作线程）。至少从我的经验来看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T17:40:42.353

我相信 1.1 和 2.0 对视图状态使用不同的默认加密算法。1.1 的默认值为 3DES，我相信 2.0 的默认值为 SHA1（尽管目前我似乎找不到支持这一点的文档）。尝试在新服务器上将机器密钥中的验证设置为 3DES，看看是否能解决问题。

```
<machineKey validation="3DES"> 
```

# c# - C# 表单应用程序集合

> ID：375345
> 
> 赞同：0
> 
> 时间：2008-12-17T17:33:01.793
> 
> 标签：c#, winforms, collections

我正在使用.Net 2.0，这让我发疯了，但可能有一些简单的事情我没有做，我现在太困惑了，看不到。

我有一个应用程序，其中有一个定制的对象集合，只有主窗体应该能够更改该集合的内容，所有其他窗体应该能够从中读取。

实际上只有另一种形式，但我需要它具有被多次调用的能力，因为它可以编辑定制集合中的不同项目。因此，让孩子形成对话是不切实际的。必须能够打开包含集合中不同项目的此表单的多个实例。

我似乎想不出一种让所有形式都围绕集合的同一个实例旋转的方法。就像我说的那样，我可能遗漏了一些明显的东西，但我已经不再能够正确地思考这个问题了。

编辑：哎呀！我不能很好地解释自己。所有子表单都应该能够读取和写入集合项，但我想在程序运行时一次只使用一个集合实例。

编辑2：原来我需要的是一个单身人士。我现在在不同的项目中实施了类似的解决方案。感谢下面的评论者，他们实际上没有留下答案，我可以将其标记为正确的答案，即使他们确定了答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T17:42:18.153

如果主表单需要读/写访问权限，而其他表单不需要，那么我会将集合设为主表单的属性，该属性可从表单内部读取/写入，但只能从表单外部读取。您可以使用以下方法执行此操作：

C＃

```
private myCollection _MyCollection; 
public myCollection MyCollection { 
    get { return _MyCollection.AsReadOnly(); } 
    private set { _MyCollection = value; } 
} 
```

VB

```
Private _MyCollection As myCollection
Public Property MyCollection() As myCollection
  Get
     Return _MyCollection.AsReadOnly
  End Get
  Private Set(ByVal value As myCollection)
    _MyCollection = value
  End Set
End Property 
```

然后，您可以通过引用 MyCollection 或 _MyCollection 来从表单内部引用您的集合，但从您的表单外部，集合将是只读的，因此不可编辑。

***编辑：***在您进行编辑之后，您所追求的确实像之前建议的那样是一个单例，这是否意味着您的表单的所有实例都应该能够编辑这个集合？如果是这样，则将您的集合放入静态类中：

```
Private _MyCollection as myCollection = Nothing
Public Shared ReadOnly Property MyCollection() As myCollection
   Get
      If _MyCollection is Nothing Then _MyCollection = New myCollection
      Return _MyCollection
   End Get
End Property 
```

现在第一次从您的一个表单中引用该集合时，它将实例化一个新集合，然后您可以从中添加/删除项目。每次您从这个或您的其他表单之一引用集合时，它已经被实例化，因此它将返回最初实例化的集合。然而，没有一个表单能够设置新集合，只需引用由单例模式实例化的集合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:07:46.013

看看方法`List<T>.AsReadOnly()`

这允许您返回列表的只读包装器。

例如

```
private LIst<Foo> fooList; 

public ReadOnlyCollection<Foo> Foo { 
    get { return fooList.AsReadOnly(); } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T18:59:22.383

所有表单都需要对集合进行读/写访问吗？那么，您现在唯一的问题是如何为您的孩子提供对这个集合的引用？你不能把它传递给子窗体的构造函数吗？或者让它成为你的主窗体的公共属性（你的子窗体可能可以从它们的`Owner`属性中获得引用）？或者， :::shudder::: 使其成为公共静态属性？

# vb.net - 从 Infragistics ultracombo 中的 valuemember 列之外的其他列获取值

> ID：375348
> 
> 赞同：1
> 
> 时间：2008-12-17T17:33:31.167
> 
> 标签：vb.net, visual-studio, combobox, infragistics, ultracombo

我对使用基础设施控制（昨天开始）相当陌生。虽然它们（非常）令人印象深刻，但它们确实增加了另一层复杂性，我正在蒙混过关。所以我问我觉得这是一个相当简单的问题：

我试图从组合框中显示的列之外的另一列中获取值。到目前为止，我所有的尝试都只获取了标题列的值，而不是选择的行列中的值。

具体来说，我想在选择一行时从我的超组合框中获取 lastname 列中的值并将其放在文本框中。到目前为止，我的以下代码将重新运行标题列 (LastName)，无论我选择哪一行，都没有其他内容。

```
Private Sub ucboPatientInfo_RowSelected(ByVal sender As Object, ByVal e As Infragistics.Win.UltraWinGrid.RowSelectedEventArgs) Handles ucboPatientInfo.RowSelected
        ucboPatientInfo.ValueMember = "accounts"
        LastName = ucboPatientInfo.SelectedRow.Band.Columns(1).ToString 
```

我添加了：“ucboPatientInfo.ValueMember = 'accounts'”以帮助澄清我的代码在做什么它实际上不在这部分代码中。

请帮忙

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T19:50:35.937

看起来您找到了解决自己问题的有效解决方案。我想我会添加更多信息和要考虑的事情。

您可能希望避免对单元格进行硬索引引用，以防将来在您将新数据添加到网格的数据源时位置发生变化。假设您在 lastName 之前插入另一列，现在您的 .Cells(5) 将返回不正确的数据。

而是尝试使用 Cells("columnName") 进行如下访问：

```
LastName = ucboPatientInfo.Cells("LastName").Value 
```

您还应该尝试在事件中使用 eventArgs 和 sender 对象，并避免直接控制引用。所以你的代码可能看起来像这样：

```
LastName = e.Row.Cells("LastName").Value.ToString() 
```

无论如何，很高兴看到你的工作进展顺利。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T21:59:36.170

找到正确的组合：

```
LastName = ucboPatientInfo.Cells(5).Value 
```

# c# - 在 C# 中随机“排序”（随机播放）整数列表的最有效方法

> ID：375351
> 
> 赞同：52
> 
> 时间：2008-12-17T17:34:00.293
> 
> 标签：c#, random, shuffle

我需要以最有效的方式随机“排序”整数列表（0-1999）。有任何想法吗？

目前，我正在做这样的事情：

```
bool[] bIndexSet = new bool[iItemCount];

for (int iCurIndex = 0; iCurIndex < iItemCount; iCurIndex++)
{
    int iSwapIndex = random.Next(iItemCount);
    if (!bIndexSet[iSwapIndex] && iSwapIndex != iCurIndex)
    {
        int iTemp = values[iSwapIndex];
        values[iSwapIndex] = values[iCurIndex];
        values[iCurIndex] = values[iSwapIndex];
        bIndexSet[iCurIndex] = true;
        bIndexSet[iSwapIndex] = true;
    }
} 
```

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-12-17T17:37:14.687

[Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)是一个很好的线性时间洗牌算法。

您会发现您提出的算法的一个问题是，当您接近 shuffle 结束时，您的循环将花费大量时间寻找尚未交换的随机选择的元素。一旦到达最后一个要交换的元素，这可能需要不确定的时间。

此外，如果要排序的元素数量为奇数，您的算法似乎永远不会终止。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-12-17T17:59:44.343

```
static Random random = new Random();

public static IEnumerable<T> RandomPermutation<T>(IEnumerable<T> sequence)
{
    T[] retArray = sequence.ToArray();

    for (int i = 0; i < retArray.Length - 1; i += 1)
    {
        int swapIndex = random.Next(i, retArray.Length);
        if (swapIndex != i) {
            T temp = retArray[i];
            retArray[i] = retArray[swapIndex];
            retArray[swapIndex] = temp;
        }
    }

    return retArray;
} 
```

修改为处理列表或其他实现 IEnumerable 的对象

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-17T19:55:15.563

我们可以从中创建一个扩展方法来获取任何 IList 集合的随机枚举器

```
class Program
{
    static void Main(string[] args)
    {
        IList<int> l = new List<int>();
        l.Add(7);
        l.Add(11);
        l.Add(13);
        l.Add(17);

        foreach (var i in l.AsRandom())
            Console.WriteLine(i);

        Console.ReadLine();
    }
}

public static class MyExtensions
{
    public static IEnumerable<T> AsRandom<T>(this IList<T> list)
    {
        int[] indexes = Enumerable.Range(0, list.Count).ToArray();
        Random generator = new Random();

        for (int i = 0; i < list.Count; ++i )
        {
            int position = generator.Next(i, list.Count);

            yield return list[indexes[position]];

            indexes[position] = indexes[i];
        }
    }
} 
```

这对我们要随机枚举的列表的索引使用反向 Fisher-Yates 洗牌。它的大小有点大（分配 4*list.Count 字节），但在 O(n) 中运行。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-17T17:51:33.660

正如 Greg 指出的那样，[Fisher-Yates 洗牌](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)将是最好的方法。这是来自维基百科的算法的实现：

```
public static void shuffle (int[] array)
{
   Random rng = new Random();   // i.e., java.util.Random.
   int n = array.length;        // The number of items left to shuffle (loop invariant).
   while (n > 1)
   {
      int k = rng.nextInt(n);  // 0 <= k < n.
      n--;                     // n is now the last pertinent index;
      int temp = array[n];     // swap array[n] with array[k] (does nothing if k == n).
      array[n] = array[k];
      array[k] = temp;
   }
} 
```

> 上面的实现依赖于 Random.nextInt(int) 提供足够随机和无偏的结果

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-17T17:49:39.293

我不确定效率因素，但如果您不反对使用 ArrayList，我使用了类似于以下内容的内容：

```
private ArrayList ShuffleArrayList(ArrayList source)
{
    ArrayList sortedList = new ArrayList();
    Random generator = new Random();

    while (source.Count > 0)
    {
        int position = generator.Next(source.Count);
        sortedList.Add(source[position]);
        source.RemoveAt(position);
    }

    return sortedList;
} 
```

使用它，您不必担心中间交换。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T17:46:19.677

为了提高您的效率，您可以保留一组已交换的值/索引，而不是用于指示它们已交换的布尔值。从剩余的池中选择您的随机交换索引。当池为 0 时，或者当您通过初始列表时，您就完成了。您没有可能尝试选择随机掉期指数值。

当您进行交换时，只需将它们从池中移除即可。

对于您正在查看的数据大小，这没什么大不了的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-12-22T21:29:53.030

```
itemList.OrderBy(x=>Guid.NewGuid()).Take(amount).ToList() 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-11T13:49:48.523

ICR 的回答非常快，但生成的数组分布不正常。如果你想要一个正态分布，这里是代码：

```
 public static IEnumerable<T> RandomPermutation<T>(this IEnumerable<T> sequence, int start,int end)
    {
        T[] array = sequence as T[] ?? sequence.ToArray();

        var result = new T[array.Length];

        for (int i = 0; i < start; i++)
        {
            result[i] = array[i];
        }
        for (int i = end; i < array.Length; i++)
        {
            result[i] = array[i];
        }

        var sortArray=new List<KeyValuePair<double,T>>(array.Length-start-(array.Length-end));
        lock (random)
        {
            for (int i = start; i < end; i++)
            {
                sortArray.Add(new KeyValuePair<double, T>(random.NextDouble(), array[i]));
            }
        }

        sortArray.Sort((i,j)=>i.Key.CompareTo(j.Key));

        for (int i = start; i < end; i++)
        {
            result[i] = sortArray[i - start].Value;
        }

        return result;
    } 
```

请注意，在我的测试中，该算法比提供的 ICR 慢 6 倍，但这是我能想出的获得正态结果分布的唯一方法

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-17T17:59:30.740

像这样的东西不会起作用吗？

```
var list = new[]{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};
var random = new Random();
list.Sort((a,b)=>random.Next(-1,1)); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-02T16:27:15.637

关于什么 ：

```
System.Array.Sort(arrayinstance, RandomizerMethod);
...
//any evoluated random class could do it !
private static readonly System.Random Randomizer = new System.Random();

private static int RandomizerMethod<T>(T x, T y)
    where T : IComparable<T>
{
    if (x.CompareTo(y) == 0)
        return 0;

    return Randomizer.Next().CompareTo(Randomizer.Next());
} 
```

瞧！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-09-22T19:36:53.763

这是我用的。这肯定不是最快的，但对于大多数情况来说它可能已经足够好了，最重要的是，它非常简单。

```
IEnumerable<ListItem> list = ...;
Random random = new Random(); // important to not initialize a new random in the OrderBy() function
return list.OrderBy(i => random.Next()); 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2010-03-15T14:15:00.247

我使用临时哈希表制作了一个方法，允许哈希表的自然键排序随机化。只需添加、读取和丢弃。

```
int min = 1;
int max = 100;
Random random;
Hashtable hash = new Hashtable();
for (int x = min; x <= max; x++)
{
    random = new Random(DateTime.Now.Millisecond + x);
    hash.Add(random.Next(Int32.MinValue, Int32.MaxValue), x);
}
foreach (int key in hash.Keys)
{
    HttpContext.Current.Response.Write("<br/>" + hash[key] + "::" + key);
}
hash.Clear(); // cleanup 
```

# php - 忽略标题标签中的上标

> ID：375355
> 
> 赞同：2
> 
> 时间：2008-12-17T17:35:51.863
> 
> 标签：php, html, css, superscript

我在一个数据库驱动的网站上工作。大多数页面的标题是我们拥有的合作伙伴的名称，并使用 php 从数据库提供。

例如，一页可能被称为“Experian”。问题是合作伙伴名称的某些值不起作用，因为这些值类似于

```
 $partnername22 = Discover<sup>tm</sup> Magazine 
```

我不能将它用于标题，因为上标不能出现在标题中，而且我不能更改值，因为许多其他事情都依赖于它。如果标题中有上标标签，我可以采取什么技巧让浏览器忽略它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:12:43.413

在将其作为标题发布之前，使用 PHP 的 strip_tags() 命令从字符串中删除所有 html 将非常简单（并且可能是可取的）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T19:26:01.550

为了：

```
<title><?php echo $offer22name ?>is a magazine</title> 
```

改成：

```
<title><?php echo preg_replace('|<sup>(.*?)</sup>|', '($1)', $offer22name) ?> is a magazine</title> 
```

但是就像 Bryan 提到的，在这种情况下您应该使用 PHP 的 strip_tags()。所以：

```
<title><?php echo strip_tags($offer22name) ?> is a magazine</title> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T19:40:03.113

```
<title><?PHP echo str_replace('<sup>tm</sup>', '&trade;', $offer22name); ?> is a magazine</title> 
```

或者，更安全：

```
<title><?PHP echo strip_tags(str_replace('<sup>tm</sup>', '&trade;', $offer22name)); ?> is a magazine</title> 
```

或者，捕获更多案例（不确定是否准确）：

```
<title><?PHP echo strip_tags(preg_replace('/<sup.*?>\s+[Tt][Mm]\s*</(sup|)>', '&trade;', $offer22name)); ?> is a magazine</title> 
```

如果您愿意，您可以`'&trade;'`用`'&#8482;'`、`'&#x2122;'`或 '™' 替换（但请确保编码与最后一个匹配），具体取决于具体情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T17:40:28.127

不是AFAIK，但如果您已经从数据库中编写了一个字符串，为什么不能用空字符串编写相同的字符串正则表达式替换标签（或标签对，如您所愿）？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T17:41:40.183

一句话，没有。

理想情况下，您会这样做`$partnername22 = strip_tags('Discover<sup>tm</sup> Magazine');`（或做一些更有趣的事情），但如果您不能这样做，那么恐怕您会被 Javascript 解决方案所困。

就像是：

```
window.title = window.title.replace(/<sup.*?</sup>/, ''); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T18:06:10.760

PHP 中将 <sup>text</sup> 替换为 (text) 的正则表达式：

```
$title = preg_replace('|<sup>(.*?)</sup>|', '\($1\)', $title); 
```

在 javascript 中执行此操作类似。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-17T18:17:04.090

迈克，我认为你的意思是：

```
$title = preg_replace('|<sup>(.*?)</sup>|', '$1', $title); 
```

您之前使用它的方式会在标记的单词周围打印一些斜杠和括号。对？

pg，你也可以这样做

```
$title = preg_replace('|<sup>(.*?)</sup>|', '', $title); 
```

如果您想完全删除标题中的上标信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-24T11:00:13.323

一些 CSS 的简单权宜之计怎么样？

```
h2.title sub, h2.title sup { vertical-align: baseline; font-size:100%; } 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-04-25T09:56:57.530

您可以使用字符编码而不是标记，例如 `&trade;`，`&#153;`

# jquery - AJAX 删除 - 使用 jQuery

> ID：375356
> 
> 赞同：2
> 
> 时间：2008-12-17T17:35:56.030
> 
> 标签：jquery, ajax

我有一个简单的购物车页面，它显示某人购物车中的物品，并在我的桌子上通过 ASP 显示。我有一列，用户可以在其中删除条目。我的 ASP 工作正常，现在我正在尝试向其中添加一些 AJAX。我有以下代码：

```
$("img.delete").click(function() {
var id     = $('#id').attr('value');        
    $.ajax({
        type: "POST",
        url: "delete.php",
        data: "id="+ id,
        success: function(){
            $('tr.selector').remove();
            $('div.success').fadeIn();
        }
    });
return false;
}); 
```

问题是，我将如何为每个值设置它，因为如果我使用上面的，我单击一个，它们都会消失。我对如何设置它以处理大量行感到困惑。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T17:41:47.890

您只需选择要删除的项目行。我不确定你是如何设置它的，但如果图像元素在你可以使用的行内：

```
 $("img.delete").click(function() {
      var row = $(this).parents('tr:first');

      ...

      success: function(){
           $(row).remove(); //Remove the row containing the image element
           ...
      }

      ...
  }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T18:26:32.963

如果它是您想要的 html id 属性，那么它会起作用。你为什么不试试呢？

编辑：可能只是 row.attr('id'); 它已经从我的脑海中滑落，有一段时间没有使用 jQuery 了:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-15T10:00:58.737

简单的事情是将 a 附加`$variable (id)`到每个项目的类中，例如

```
// $("img.delete_<?php echo $id;?>").click(function() 
```

在这种情况下，它显示为每个项目的 img.delete_1、img.delete_2 等，

然后将其应用于循环项目的类

```
<td class="delete_<?php echo $id;?>"></td> 
```

希望这是有道理的

```
$("img.delete_<?php echo $id;?>").click(function() {
var id     = $('#id').attr('value');            
        $.ajax({
                type: "POST",
                url: "delete.php",
                data: "id="+ id,
                success: function(){
                        $('tr.selector').remove();
                        $('div.success').fadeIn();
                }
        });
return false;
}); 
```

# apache-flex - Flex：使用 NumericStepper 作为 DataGrid 中的 itemEditor

> ID：375365
> 
> 赞同：0
> 
> 时间：2008-12-17T17:38:16.977
> 
> 标签：apache-flex, datagrid, itemeditor

我正在尝试使用数字步进器使数据网格中的一个字段可编辑。我目前的尝试看起来像是在工作，但 dataProvider 实际上并没有被改变。

根据我在十亿个不同地方读到的内容，语法应该是

```
< mx:DataGridColumn dataField="a" itemRenderer="mx.controls.NumericStepper" rendererIsEditor="true" editorDataField="value" />
```

我在这个主题上尝试了几种变体，但似乎没有任何效果。我错过了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T20:44:53.420

如果没有更多信息，我猜您的 dataProvider 未声明为 Bindable。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T15:49:11.187

问题似乎是，我希望更改会立即反映在 dataProvider 中，但直到编辑器失去焦点时才会应用它们。

# c# - 用 wmd 上传图片？

> ID：375368
> 
> 赞同：1
> 
> 时间：2008-12-17T17:39:10.580
> 
> 标签：c#, javascript, asp.net-mvc, file-upload, wmd

wmd编辑器是否可以添加一个按钮让用户将图像上传到Web服务器并将相应的img markdown放在文本框中？如果没有，另一个好的就地编辑器会这样做吗？背景：我正在使用 asp.net mvc、C#，我是一个真正的 javascript 初学者。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T20:13:59.757

这是 WMD 附带的最小示例的变体：

```
 <!DOCTYPE html>
<html>
  <head>
    <title>WMD minimal example</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
    <script type="text/javascript">
    $.fn.insertAtCaret = function (myValue) {
            return this.each(function(){
                    //IE support
                    if (document.selection) {
                            this.focus();
                            sel = document.selection.createRange();
                            sel.text = myValue;
                            this.focus();
                    }
                    //MOZILLA/NETSCAPE support
                    else if (this.selectionStart || this.selectionStart == '0') {
                            var startPos = this.selectionStart;
                            var endPos = this.selectionEnd;
                            var scrollTop = this.scrollTop;
                            this.value = this.value.substring(0, startPos)
                                          + myValue
                                  + this.value.substring(endPos,
    this.value.length);
                            this.focus();
                            this.selectionStart = startPos + myValue.length;
                            this.selectionEnd = startPos + myValue.length;
                            this.scrollTop = scrollTop;
                    } else {
                            this.value += myValue;
                            this.focus();
                    }
            });

    };

    int i = 50;

    function Add()
    {
        $("#myTextarea").insertAtCaret("![alt text][" +(i++)+"]");
        // You'll need to add the link too, at the bottom
    }
    </script>
  </head>
  <body>

    <form>
    <a href="javascript:Add()">test</a>
        <textarea id="myTextarea" style="width: 500px; height: 200px;">*This* is a minimal example.</textarea>
    </form>
    <div class="wmd-preview"></div>

    <script type="text/javascript" src="wmd/wmd.js"></script>
  </body>
</html> 
```

但这只是你可能知道的开始。[这个markdown](http://markitup.jaysalvat.com/home/)编辑器看起来更好

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:00:45.840

[对WMD](http://wmd-editor.com/features)的简要阅读似乎表明该功能不直接支持，并且该控件不是特别可插入的。

话虽如此，没有什么可以阻止您创建按钮/上传字段/将图像发送到您的服务器并注入适当的任何内容：

```
<img src="http://your.server.com/path/to/attachments/..." /> 
```

进入控件的底层文本区域。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-18T07:07:14.277

我写了[一篇博文](http://jordanarseno.com/blog/8/uploading-images-with-wmd-editor)，解释了我是如何解决这个问题的。在帖子中，我使用 PHP - 如果您愿意将我的 PHP 逻辑转换为 ASP.NET，您可能会发现它很有帮助！

# multithreading - 尽可能多的线程或尽可能少的线程？

> ID：375374
> 
> 赞同：10
> 
> 时间：2008-12-17T17:40:11.247
> 
> 标签：multithreading, language-agnostic, client-server

作为一个副项目，我目前正在为我曾经玩过的一个古老的游戏编写服务器。我试图使服务器尽可能松耦合，但我想知道多线程的一个好的设计决策是什么。目前，我有以下一系列操作：

*   启动（创建）->
*   服务器（监听客户端，创建）->
*   客户端（监听命令并发送周期数据）

我假设平均有 100 个客户，因为这是游戏在任何给定时间的最大值。对于整个事情的线程化，正确的决定是什么？我目前的设置如下：

*   服务器上的 1 个线程侦听新连接，在新连接上创建一个客户端对象并再次开始侦听。
*   客户端对象有一个线程，监听传入的命令并定期发送数据。这是使用非阻塞套接字完成的，因此它只是检查是否有可用数据，处理它，然后发送它已排队的消息。登录在发送-接收周期开始之前完成。
*   一个线程（目前）用于游戏本身，因为我认为从架构上讲，它与整个客户端-服务器部分是分开的。

这将导致总共 102 个线程。我什至正在考虑给客户端 2 个线程，一个用于发送，一个用于接收。如果我这样做，我可以在接收线程上使用阻塞 I/O，这意味着线程在一般情况下大部分是空闲的。

我主要担心的是，通过使用这么多线程，我将占用资源。我不担心比赛条件或死锁，因为无论如何我都必须处理这些事情。

我的设计是这样设置的，即我**可以**使用单个线程进行所有客户端通信，无论它是 1 还是 100。我已经将通信逻辑与客户端对象本身分离，因此我可以实现它而无需重写很多代码。

主要问题是：在应用程序中使用超过 200 个线程是错误的吗？它有优点吗？我正在考虑在多核机器上运行它，这样会充分利用多核吗？

谢谢！

* * *

在所有这些线程中，它们中的大多数通常会被阻塞。我预计连接数不会超过每分钟 5 个。来自客户端的命令很少会出现，我会说平均每分钟 20 个。

按照我在这里得到的答案（上下文切换是我正在考虑的性能影响，但在你指出之前我不知道，谢谢！）我想我会选择一个听众的方法，一个接收者、一个发送者和一些杂项；-)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T17:44:54.093

使用事件流/队列和线程池来保持平衡；这将更好地适应可能具有更多或更少内核的其他机器

一般来说，比核心多得多的活动线程会浪费时间上下文切换

如果您的游戏包含许多短动作，循环/循环事件队列将比固定数量的线程提供更好的性能

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T18:24:48.833

简单地回答这个问题，在今天的硬件上使用 200 个线程是完全错误的。

每个线程占用 1 MB 内存，因此您在开始做任何有用的事情之前就占用了 200 MB 的页面文件。

无论如何，将您的操作分解成可以在任何线程上安全运行的小块，但将这些操作放在队列中，并有固定的、有限数量的工作线程为这些队列提供服务。

**更新：**浪费 200MB 重要吗？在 32 位机器上，它是进程的整个理论地址空间的 10% - 没有其他问题。在 64 位机器上，这*听起来*像是理论上可用的沧海一粟，但实际上它仍然是一个非常大的存储块（或者更确切地说，是大量相当大的存储块），被应用程序，然后必须由操作系统管理。它的效果是用大量无价值的填充物包围每个客户端的有价值信息，这会破坏局部性，挫败操作系统和 CPU 将经常访问的内容保存在最快的缓存层中的尝试。

无论如何，内存浪费只是精神错乱的一部分。除非您有 200 个内核（以及能够使用的操作系统），否则您实际上并没有 200 个并行线程。你有（比如说）8 个内核，每个内核都在 25 个线程之间疯狂地切换。您可能会天真地认为，因此，每个线程都相当于在慢 25 倍的内核上运行。但实际上比这更糟糕 - 操作系统花费更多时间从核心中取出一个线程并在其上放置另一个线程（“上下文切换”），而不是实际允许您的代码运行。

看看任何著名的成功设计是如何解决这类问题的。CLR 的线程池（即使您不使用它）就是一个很好的例子。它开始假设每个核心只有一个线程就足够了。它允许创建更多，但只是为了确保最终完成设计糟糕的并行算法。它拒绝每秒创建超过 2 个线程，因此它通过减慢线程贪婪算法来有效地惩罚它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-17T18:05:04.897

我用 .NET 编写代码，我不确定我的编码方式是否是由于 .NET 的限制和它们的 API 设计，或者这是否是一种标准的做事方式，但这就是我在过去：

*   将用于处理传入数据的队列对象。这应该在排队线程和工作线程之间同步锁定以避免竞争条件。

*   用于处理队列中数据的工作线程。排队数据队列的线程使用信号量通知该线程处理队列中的项目。该线程将在任何其他线程之前自行启动，并包含一个可以运行的连续循环，直到它收到关闭请求。循环中的第一条指令是暂停/继续/终止处理的标志。该标志最初将设置为暂停，以便线程处于空闲状态（而不是连续循环），而无需进行任何处理。当队列中有要处理的项目时，排队线程将更改标志。然后，该线程将在循环的每次迭代中处理队列中的单个项目。

*   一个连接侦听器线程，它侦听传入的连接请求并将其传递给...

*   创建连接/会话的连接处理线程。从您的连接侦听器线程中拥有一个单独的线程意味着您正在减少由于该线程处理请求时资源减少而丢失连接请求的可能性。

*   一个传入数据侦听器线程，用于侦听当前连接上的传入数据。所有数据都被传递到排队线程以进行排队处理。您的侦听器线程应在基本侦听和传递数据以进行处理之外尽可能少地做。

*   一个队列线程，它以正确的顺序对数据进行排队，以便可以正确处理所有内容，该线程将信号量提升到处理队列，让它知道有数据要处理。将此线程与传入数据侦听器分开意味着您不太可能错过传入数据。

*   在方法之间传递的一些会话对象，以便每个用户的会话在整个线程模型中都是自包含的。

这使线程变得像我想出的那样简单但健壮的模型。我很想找到一个比这更简单的模型，但我发现如果我尝试进一步减少线程模型，我会开始丢失网络流上的数据或丢失连接请求。

它还有助于 TDD（测试驱动开发），这样每个线程都在处理单个任务，并且更容易编写测试代码。拥有数百个线程会很快成为资源分配的噩梦，而拥有单个线程则成为维护的噩梦。

为每个逻辑任务保留一个线程要简单得多，就像在 TDD 环境中每个任务有一个方法一样，您可以在逻辑上分离每个任务应该做什么。发现潜在问题更容易，解决问题也容易得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T18:13:41.023

你的平台是什么？如果是 Windows，那么我建议您查看异步操作和线程池（如果您在 C/C++ 中的 Win32 API 级别工作，则直接查看 I/O 完成端口）。

这个想法是您有少量线程来处理您的 I/O，这使您的系统能够扩展到大量并发连接，因为连接数和进程使用的线程数之间没有关系那是为他们服务。正如预期的那样，.Net 将您与细节隔离开来，而 Win32 则没有。

使用异步 I/O 和这种服务器风格的挑战在于，客户端请求的处理变成了服务器上的状态机，并且到达的数据会触发状态更改。有时这需要一些时间来适应，但一旦你这样做了，它真的很了不起；）

我有一些免费代码，在[此处](http://www.serverframework.com/products---the-free-framework.html)演示了使用 IOCP 的 C++ 中的各种服务器设计。

如果您使用的是 unix 或需要跨平台并且您使用的是 C++，那么您可能需要查看提供异步 I/O 功能的 boost ASIO。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T17:49:37.687

我认为您应该问的问题不是 200 作为一般线程数是好是坏，而是这些线程中有多少是活动的。

如果在任何给定时刻只有其中几个处于活动状态，而所有其他人都在睡觉或等待或诸如此类，那么你很好。在这种情况下，休眠线程不会花费您任何费用。

但是，如果所有这 200 个线程都处于活动状态，那么您的 CPU 将浪费大量时间在所有这 200 个线程之间进行线程上下文切换。

# sql-server - SQL Server - 奇怪的被零除

> ID：375383
> 
> 赞同：0
> 
> 时间：2008-12-17T17:42:00.043
> 
> 标签：sql-server, divide-by-zero

我正在执行以下查询：

```
Select guiPolygonID, dbo.fn_Yval(p1X, p1Y, p2X, p2Y, 4.003318)
From [vPolygonSegments]
Where dbo.fn_Yval(p1X, p1Y, p2X, p2Y, 4.003318) > 0 
```

函数 fn_Yval 的重要部分（所有参数都是浮点类型）：

```
set @m = (@p2Y - @p1Y)/(@p2X - @p1X)
set @b = @p1Y - (@m*@p1X)
set @result = (@m*@xval+@b) 
```

视图 vPolygonSegments 不包含 p1X = p2X 的记录（这些记录被排除在外）。然而，当我执行查询时，SQL Server 返回错误：“遇到除以零错误”。奇怪的是，如果我只执行前两行（没有 where 子句），查询返回结果就好了。

我该如何解决这个问题，和/或导致这种行为的原因是什么？

**编辑：** 这是我的观点：

```
Select P1.guiPolygonID,
    P1.decX as p1X, P1.decY as p1Y,
    P2.decX as p2X, P2.decY as p2Y
From PolygonPoints P1, PolygonPoints P2
Where P1.guiPolygonID = P2.guiPolygonID
    and (
        P1.lPointNumber - P2.lPointNumber = 1
        or (
            -- Some other unimportant code
        )
    )
    and P1.decX <> P2.decX 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T18:13:21.727

这里的问题是 select cause 中的函数在 where 子句中的函数被评估之前被评估。这种情况非常罕见，但有可能，因此您需要针对它进行编码。我建议您修改该函数，以便它可以安全地处理除以零的情况。更改此行：

```
set @m = (@p2Y - @p1Y)/(@p2X - @p1X) 
```

对此：

```
set @m = (@p2Y - @p1Y)/NullIf((@p2X - @p1X), 0) 
```

当@p2x - @p1x = 0 时，NULLIF 函数将返回 NULL。随后，@m 将为空，所有其他值也是如此。最有可能的是，该函数将返回 NULL。

在你的 where 子句中，你有......

```
Where dbo.fn_Yval(p1X, p1Y, p2X, p2Y, 4.003318) > 0 
```

当函数返回 NULL 时，它不会与 0 进行比较，并且最终会被过滤掉。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T17:51:43.253

正如 Joel Coehoorn 指出的那样，这可能是个问题。下面的查询应该可以避免这个问题，但最好在你的函数内部解决这个问题：

```
Select guiPolygonID, dbo.fn_Yval(p1X, p1Y, p2X, p2Y, 4.003318)
From [vPolygonSegments]
Where p2X <> p1X and dbo.fn_Yval(p1X, p1Y, p2X, p2Y, 4.003318) > 0 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T18:19:47.313

我怀疑这与视图如何为查询具体化有关。将该函数添加到 where 子句*实质上是*将其添加到视图的源查询中，这样优化器可能会选择将此过滤器应用于之前的源数据`P1.decX <> P2.decX`。

无论如何，您不知道何时要在没有相同约束的其他地方重用该功能。最好预先制定如何处理不良数据的计划。在这种情况下，这些`NullIf`建议似乎是一个很好的建议。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T17:45:49.753

当@p2X = @p1X 时会出现问题。在这种情况下，您预计会发生什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T17:57:26.033

我不知道这会以任何方式回答这个问题，但是您正在为每条记录评估 fn_Yval 两次。为什么不将函数的结果作为视图中的列？然后，您的 where 子句可能类似于“where Yval > 0”。

编辑：出于好奇，fn_Yval 没有任何副作用，是吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T18:13:21.523

当涉及连接或视图时，我发现尝试使用 where 子句删除可能导致除以零错误的数据是有问题的。要么过滤连接子句中的数据，要么在函数中过滤掉它。

更新：出于“G Mastros”所写的那种原因。

# security - Office 文档提示登录匿名 SharePoint 网站

> ID：375390
> 
> 赞同：14
> 
> 时间：2008-12-17T17:45:33.187
> 
> 标签：security, sharepoint, anonymous

我有一个配置为匿名访问的 MOSS 07 站点。此站点中有一个文档库，它也启用了匿名访问。当匿名用户单击此库中的 PDF 文件时，他或她可以毫无问题地阅读或下载它。当用户单击 Office 文档时，系统会提示他或她使用登录框。用户可以在不输入登录信息的情况下取消此框，并将被带到文档。

这发生在 IE 中，但不在 FireFox 中。

我在网上看到一些对这个问题的引用，但没有明确的解决方案： http: [//www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.sharepoint.windowsservices.development &tid=5452e093 -a0d7-45c5-8ed0-96551e854cec&cat=en_US_CC8402B4-DC5E-652D-7DB2-0119AFB7C906&lang=en&cr=US&sloc=&p=1](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.sharepoint.windowsservices.development&tid=5452e093-a0d7-45c5-8ed0-96551e854cec&cat=en_US_CC8402B4-DC5E-652D-7DB2-0119AFB7C906&lang=en&cr=US&sloc=&p=1)

[http://www.sharepointu.com/forums/t/5779.aspx](http://www.sharepointu.com/forums/t/5779.aspx)

[http://www.eggheadcafe.com/software/aspnet/30817418/anonymous-users-getting-p.aspx](http://www.eggheadcafe.com/software/aspnet/30817418/anonymous-users-getting-p.aspx)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-06-10T10:34:38.900

要禁用从 SharePoint 2010 打开 Office 文档的登录提示，请在 web.config 中执行以下设置

```
<system.webServer>
  <security>
    <requestFiltering allowDoubleEscaping="true">
      <!-- here's where the magic happens -->
      <verbs allowUnlisted="true">
        <add verb="OPTIONS" allowed="false" />
        <add verb="PROPFIND" allowed="false" />
      </verbs>
    </requestFiltering>
  </security>
</system.webServer> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-30T15:09:06.937

如果在 MS Word 中启用了 Sharepoint 共享工作区，如果用户无权访问或创建共享工作区，这可能会提示用户使用 Windows 登录。执行以下操作将其关闭：

1.  打开 MS Word
2.  转到工具/选项
3.  单击常规选项卡
4.  单击服务选项
5.  单击共享工作区
6.  取消选中“文档是工作区或 SharePoint 网站的一部分”的复选框。</li>
7.  点击确定
8.  点击确定
9.  尝试从 SharePoint 网站点击 MS Word 文档。

如果这解决了问题，则对每个 MS Office 程序重复步骤以消除提示。（Excel、PowerPoint、Visio 等）

[http://office.microsoft.com/en-us/word/HP010414641033.aspx](http://office.microsoft.com/en-us/word/HP010414641033.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T01:22:32.627

如果您可以单击取消并出现问题是... AuthForwardServerList

[http://support.microsoft.com/kb/943280](http://support.microsoft.com/kb/943280)

Office 不知道该站点是受信任的/本地的，因此它不会转发您的凭据并提示您有机会提供它们。这是一个特点......

如果您在正确的注册表项中列出您的站点，它将转发您不需要的凭据，但您不会收到提示。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T20:20:35.140

不幸的是，我发现的唯一解决方法破坏了登录用户的一些功能（无法上传多个文件，连接到 Outlook 等..）

如果这是可以接受的，或者您想尝试一下，看看：

1.  在中央管理 > 应用程序管理 > 应用程序安全 > 身份验证提供程序中，选择您的 Web 应用程序并选择您的提供程序（可能是“默认”）。

2.  为客户端集成选择否并保存设置。

3.  打开您的网络配置，找到该行`<add verb="OPTIONS,PROPFIND,PUT,LOCK,UNLOCK.....`并删除动词 OPTIONS。

不应再在 ie 中要求您提供凭据。要扭转这种情况，只需撤消这两项更改。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-29T01:09:54.927

可能的原因和解决方法：http: [//support.microsoft.com/kb/943280](http://support.microsoft.com/kb/943280)

“当您从运行 Windows Vista 或 Windows 7 且未配置代理的计算机访问 FQDN 站点时，系统会提示您输入您的凭据”

“例如，当您在未配置代理的基于 Windows Vista 的客户端计算机上使用 2007 Microsoft Office 从 Microsoft Office SharePoint 站点打开 Microsoft Office 文件时，系统会提示您进行身份验证。”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-07T19:01:02.830

如果您有 url 重写模块或 urlscan，请将软件配置为发送 http 403 到 http OPTIONS 请求。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-28T21:40:20.930

在 Sharepoint Server 2010 中，由于新一代的 Sharepoint 不能在 web.config 中保存动词，解决方法略有变化。因此，您必须更改方法。首先，您打开 IIS 7.0 并选择您的应用程序站点。您可以在屏幕中间看到许多项目。您选择并双击请求过滤器。在请求过滤器中，您可以看到“动词”。您可以将 OPTIONS 和 PROPFIND 动词添加到拒绝模式。最后测试您的网站。有时，Sharepoint 需要关闭您网站的客户端集成模式。如果需要，您可以在管理中心中关闭客户端集成模式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-29T05:00:23.343

使用像 Fiddler 这样的工具（在您的第一个链接参考中引用/建议，请参阅[http://www.fiddlertool.com/fiddler/](http://www.fiddlertool.com/fiddler/)了解更多信息）是确定此类问题的根本原因的唯一有效方法我'我知道。无论是什么导致这将通过 HTTP 发生。像 Fiddler 这样的调试代理会准确地向您显示是哪个 URL/资源导致了身份验证请求。

在相关说明中，您是否正在运行该平台的最新版本？检查以确保 MS 尚未解决此问题（例如在修补程序中）可能是明智之举。我知道的最好的更新列表在这里：[http ://www.harbar.net/articles/postsp1.aspx](http://www.harbar.net/articles/postsp1.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-26T17:17:27.617

在 IE 中打开 Office 文档时，使用 ActiveX 组件调用客户端应用程序，并提示它打开文档。在其他浏览器中，下载是由浏览器处理的标准超链接。

这是否也发生在搜索结果和文档库中的标准链接列中？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-18T18:37:45.093

好像不是这样。有问题的文档中有一个是 Excel 文件，它不会使用 .doc 模板。此外，在“文档模板”对话框中，如果我基于它创建新的 Word 文档，它不会给我指向 SharePoint 模板文件的 URL。它只是说模板是“正常的”。我还尝试在文档库级别禁用模板，它不会更改密码情况。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-05T09:33:14.663

勾选此项：匿名用户从 SharePoint 站点下载办公文档时删除登录框

[http://www.theblackknightsings.com/RemoveLoginBoxWhenAnonymousUsersDownloadOfficeDocumentFromSharePointSite.aspx](http://www.theblackknightsings.com/RemoveLoginBoxWhenAnonymousUsersDownloadOfficeDocumentFromSharePointSite.aspx)

> 在 SharePoint 中开发 Extranet/Internet 站点时，您通常希望允许匿名访问，这非常有效。但是，在匿名访问方面，开箱即用的体验会失败，那就是当您允许用户下载 Microsoft Office 文档时。在这种情况下，IE/Office 会弹出几个登录对话框，如果用户取消这些对话框，则文档会按预期打开，但您真的不希望用户必须取消几个对话框才能打开您的文档

问题是 Office 试图变得智能并发出 Microsoft Office 协议发现请求以查看允许用户执行多少操作，但 SharePoint 以拒绝访问作为响应，直到用户登录。

我找到的解决方案是实现一个 HttpModule，如果用户没有登录，它会拒绝 Microsoft Office 协议发现请求，这会消除登录框

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-11-17T10:28:26.457

我找到了解决方案。首先，您打开 inetpub 下的 Web 应用程序配置文件。然后你会找到添加动词部分。在本节中，安装时添加了许多动词。删除 Options 和 Profind 动词并保存配置文件。最后测试一下问题，看看。问题结束了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-18T12:30:11.670

我的猜测是 Office 客户端正在从启用匿名访问的另一个位置加载基础文档模板。这也解释了为什么您仍然可以打开文档，因为 Office 客户端也可以在不加载最初创建文档的模板的情况下工作。要在 Word 2007 中查看模板 URL，请从 Word 选项中启用开发人员功能区，然后单击功能区上的文档模板按钮。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-09T12:01:01.850

我猜你使用的是Windows Vista。我们在 Vista 上遇到了这个问题，但在 XP 上没有。

* * *

来自 Microsoft：在 Windows Vista 中，当您使用 Internet Explorer 访问 WebDAV 资源时，Internet Explorer 使用 Web 客户端服务。Web 客户端服务使用 Windows HTTP 服务 (WinHTTP) 对远程主机执行网络 I/O。WinHTTP 仅在响应本地 Intranet 站点上发生的请求时才发送用户凭据。但是，WinHTTP 不会检查 Internet Explorer 中的安全区域设置以确定网站是否位于允许自动发送凭据的区域中。

如果未配置代理，WinHTTP 仅将凭据发送到本地 Intranet 站点。

注意 如果 URL 在服务器名称中不包含句点，例如在以下示例中，则假定服务器位于本地 Intranet 站点上： [http://sharepoint/davshare](http://sharepoint/davshare)

如果 URL 包含句点，则假定服务器位于 Internet 上。句点表示您使用 FQDN 地址。因此，除非配置了代理并且指示该服务器绕过代理，否则不会自动将凭据发送到该服务器。

* * *

这是一个尚未完全解决的已知问题。这里有一个关于它的 MSDN 博客：http: [//blogs.msdn.com/sharepoint/archive/2007/10/19/known-issue-office-2007-on-windows-vista-prompts-for-user-credentials -when-opening-documents-in-a-sharepoint-2007-site.aspx](http://blogs.msdn.com/sharepoint/archive/2007/10/19/known-issue-office-2007-on-windows-vista-prompts-for-user-credentials-when-opening-documents-in-a-sharepoint-2007-site.aspx)

这里发布了一个有趣的解决方法：http: [//grounding.co.za/blogs/neil/archive/2008/11/10/workaround-sharepoint-keeps-prompting-for-login-when-creating-office-2007-文件-on-vista.aspx](http://grounding.co.za/blogs/neil/archive/2008/11/10/workaround-sharepoint-keeps-prompting-for-login-when-creating-office-2007-documents-on-vista.aspx)

最终，Vista SP1 中包含了一个补丁，但它也需要注册表编辑。我们最近刚刚在 Windows Vista SP2 客户端上使用以下步骤使其工作：

打开注册表。导航到以下子项：

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WebClient\Parameters

创建一个名为 AuthForwardServerList 的新多字符串值，并为其指定一个值（例如）： https:// *.Contoso.com
http://* .dns.live.com
*.microsoft.com
[https://172.169.4.6](https://172.169.4.6)

然后重新启动 WebClient 服务。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-07-22T23:54:28.970

我们可以通过更改 IE 设置来实现这一点。

我们在受信任的站点中有站点 URL。在自定义设置下将用户身份验证设置为：使用当前用户名和密码自动登录

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-03-16T19:39:52.977

我找到了以下解决方法：

[http://www.objectsharp.com/cs/blogs/max/archive/2008/04/21/sharepoint-public-facing-website-and-microsoft-office-documents.aspx](http://www.objectsharp.com/cs/blogs/max/archive/2008/04/21/sharepoint-public-facing-website-and-microsoft-office-documents.aspx)

为了简单起见：

1.  禁用客户端集成

2.  从站点的 web.config 文件的注册行中删除 OPTIONS 动词

# jsp - Spring MVC 和 JSP 框架

> ID：375395
> 
> 赞同：2
> 
> 时间：2008-12-17T17:46:48.643
> 
> 标签：jsp, frameworks

什么是与 Spring MVC 一起使用的非常好的 jsp 框架。是唯一的候选 SiteMesh 和 Tiles 等吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T19:21:51.230

你看过 Tapestry 了吗？
[http://tapestry.apache.org/](http://tapestry.apache.org/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-21T06:43:19.957

[Sitemesh](http://www.opensymphony.com/sitemesh)和[Wicket](http://wicket.apache.org)是其他不错的选择。

# diff - 有什么方法可以将自定义差异工具与 cleartool/clearcase 一起使用？

> ID：375398
> 
> 赞同：51
> 
> 时间：2008-12-17T17:49:09.857
> 
> 标签：diff, clearcase, cleartool

在明文快照视图中工作时，我想使用自己的差异。

据我所见，运行“ `cleartool diff`”时无法指定差异工具，所以我想我可以运行“ `mydiff <predecessor file> <modified file in my view>`”之类的东西，但我对 ClearCase 的了解还不够，无法找到“前身”文件”进行比较。

有什么办法可以做到这一点？

忘了提（直到现在，在阅读了处理 windows 的前两个响应之后）这是在 Unix 上，并且我不允许使用 ClearCase 配置。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-12-17T17:58:20.493

## 如何更改默认差异工具

[您可以通过修改文件**映射**](http://www.guiffy.com/help/GuiffyHelp/ClearCase.html)来指定外部差异工具，在“c:\program files\rational\ClearCase\lib\mgrs”

Paul 建议的 WinMerge 实际上修改了该文件。

每个地图行包含 3 个部分：CC 文件类型、CC 操作和应用程序。

在映射文件中查找 text_file_delta 文件类型的部分。在那里，您将找到 CC 操作 compare、xcompare、merge 和 xmerge 的行，如下所示：

```
text_file_delta   compare          ..\..\bin\cleardiff.exe
text_file_delta   xcompare         ..\..\bin\cleardiffmrg.exe
text_file_delta   merge            ..\..\bin\cleardiff.exe
text_file_delta   xmerge           ..\..\bin\cleardiffmrg.exe 
```

您可以将它们替换[为您选择的差异工具的可执行文件](http://www.downloadatoz.com/howto/use-beyond-compare-with-clearcase.html)。

* * *

## 或者，一个简单的差异脚本

如果您想对此使用完整的命令行（我喜欢 ;-)），一点 ccperl 可以提供帮助：

```
#!/bin/perl
my ($file, $switches) = @ARGV;
$switches ||= '-ubBw';

my ($element, $version, $pred) 
    = split(/;/,`cleartool describe -fmt '%En;%Vn;%PVn' $file`);

unless ($pred) { die "ctdiff: $file has no predecessor\n"; }

exec "mydiff $switches $element\@\@$pred $file"; 
```

警告：扩展路径名 ( `@@\...`) 只能在动态视图 ( `M:\...`，而不是快照视图 ( `c:\...`) 中访问。

`map`该脚本与上述文件无关：

*   该文件定义了“类型合并管理器”。
*   此脚本允许您在所需的任何文件上运行任何合并管理器，而无需读取任何映射文件来查找用于给定文件的正确 diff exe。

在这里，您向脚本提供两个信息：文件（作为参数）和要运行的 diff exe（在脚本实现中：替换`mydiff`为您想要的任何 diff exe）。

* * *

## 或者，改进的差异脚本（也适用于静态/快照视图）

这是此脚本的一个版本，适用于快照和动态视图。

对于快照视图，我使用 chacmool 的建议：`cleartool get`.

同样，您可以用`diff`您选择的工具替换此脚本中包含的命令。

```
#!/bin/perl
my ($file, $switches) = @ARGV;
$switches ||= '-u';

my ($element, $version, $pred) 
    = split(/;/,`cleartool describe -fmt '%En;%Vn;%PVn' $file`);

unless ($pred) { die "ctdiff: $file has no predecessor\n"; }

# figure out if view is dynamic or snapshot
my $str1 = `cleartool lsview -long -cview`;
if($? == 0) { dodie("pred.pl must be executed within a clearcase view"); }
my @ary1 = grep(/Global path:/, split(/\n/, $str1));
if($str1 =~ /View attributes: snapshot/sm) { $is_snapshot = 1; }

my $predfile = "$element\@\@$pred";
$predfile =~ s/\'//g;#'
#printf("$predfile\n");
if ($is_snapshot) { 
  my $predtemp = "c:\\temp\\pred.txt";
  unlink($predtemp);
  my $cmd = "cleartool get -to $predtemp $predfile"; printf("$cmd\n");
  my $str2 = `$cmd`;
  $predfile = $predtemp;
}
sub dodie {
    my $message = $_[0];
    print($message . "\n");
    exit 1;
}

exec "diff $switches $predfile $file"; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T22:32:33.123

另一种选择是使用[Git+ClearCase](https://web.archive.org/web/20081206172310/http://www.littleredbat.net/mk/blog/story/63/)（或查看[this](https://web.archive.org/web/20100906234536/http://blog.charleso.org/2008/10/clearcase-for-git.html)或[this](https://web.archive.org/web/20081204192644/http://www.turbodad.com/articles/24/12-revision)）并与 Git 进行比较。

这非常容易设置，并且根据我的经验，一次使用两个 VCS 系统实际上比试图击败 CC 成为 21 世纪的工具更伤脑筋。

只需将 Git 视为 CC 和 diff 之间的桥梁 :-)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-09-19T08:23:18.613

似乎有人已经在 snip2code 上考虑过了！
这是一个 tcsh bash 脚本，它完全符合您的要求。

[自定义 diff-tool-for-clearcase-object](http://www.snip2code.com/Snippet/11216/Custom-diff-tool-for-clearcase-object?fromPage=1)

如您所见，以下是获取给定文件的先前版本的关键代码：

`cleartool descr -pred -short $1`

`$1`要比较的文件名在哪里。

* * *

```
#!/bin/tcsh -e
set _CLEARCASE_VIEW = `cleartool pwv -short -setview`
echo Set view: "$_CLEARCASE_VIEW"
set my_firstversion = ""
set my_secondversion = ""
set my_difftool = kdiff3

# check clearcase view
if ( "$_CLEARCASE_VIEW" == "** NONE **" ) then
  echo "Error: ClearCase view not set, aborted."
  exit -1
endif

if ( "$1" == "" ) then
  echo "Error: missing 1st file argument!"
  echo "Eg: `basename $0` file1.txt -> This will diff file1.txt with its previous version"
  echo "Eg: `basename $0` file1.txt file2.txt -> This will diff file1.txt and file2.txt"
  exit -1
endif  

set my_firstversion = "$1"
echo "my_firstversion=$my_firstversion"

if ( "$2" == "" ) then
  echo "No 2nd file passed, calculating previous version of $my_firstversion"
  set my_secondversion = $my_firstversion@@`cleartool descr -pred -short $my_firstversion`
else
  echo "Setting 2nd file to $2"
  set my_secondversion = "$2"
endif
echo "my_secondversion=$my_secondversion"

${my_difftool} ${my_firstversion} ${my_secondversion} & 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-09-30T11:25:25.740

[Kdiff3](http://kdiff3.sourceforge.net/)已内置集成。打开工具 - 转到设置 --> 配置 --> 集成，然后单击“与 ClearCase 集成”按钮。该工具具有出色的 3 路差异支持，处理 UTF-8，并且通过这种自动集成，您不必担心地图文件中的元素类型等。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-18T16:02:58.480

根据这里的建议，我得到了另一种工作方式。我发现了 cleartool "get" 命令，所以我执行这个命令来获取以前的版本到一个临时文件：

cleartool get -to fname.temp fname@@predecessor

然后运行我的差异，并删除该文件。

感谢所有的建议。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-09-10T14:53:43.187

以下是有关更改 ClearCase XML 差异工具的 IBM 文档的链接：

**更改 XML 差异/合并类型管理器**

[http://www-01.ibm.com/support/docview.wss?rs=984&uid=swg21256807](http://www-01.ibm.com/support/docview.wss?rs=984&uid=swg21256807)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-17T22:28:31.867

你可以尝试使用[这个技巧](https://stackoverflow.com/questions/176858/in-clearcase-how-can-i-view-old-version-of-a-file-in-a-static-view-from-the-command-line)：

1.  创建一个空文件

    `% touch empty`

2.  检索版本 A

    `% cleartool diff -ser empty File@@/main/28 > A`

3.  检索版本 B

    `% cleartool diff -ser empty File@@/main/29 > B`

4.  差异和利润！

    `% your-diff-here A B`

把它放在一个脚本中，使选项更灵活一点，就可以了。

`awk`如果你愿意，你可以用一点或`cut`或`perl`或你选择的毒药轻松地剪掉 cleartool diff crud 。

ClearCase 万岁！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-15T09:35:14.297

对我来说，这很好用：

```
%vimdiff my_file.c my_file.c@@/main/LATEST 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-17T17:56:49.450

我安装了“WinMerge”（一个免费的差异工具），它自己安装为 clearcase 差异工具。我不确定它是怎么做到的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T17:35:20.383

如前所述，WinMerge 会自动检测 ClearCase 的安装并修改 Clearcase 安装路径中的映射文件。

我遇到的问题是 ClearCase 将打开它自己的差异工具，因为 WinMerge 安装没有更改所有必要的行项目。因此，最好阅读 ClearCase 的文档，以便在需要时手动修复它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-01-05T17:52:46.340

我通常是这样进行的。

对于统一的差异 `cleartool diff -pred <my file>`

对于图形差异 `cleartool diff -pred -g <my file>`

# c# - Programmatically close aspx page from code behind

> ID：375406
> 
> 赞同：36
> 
> 时间：2008-12-17T17:51:19.557
> 
> 标签：c#, asp.net

What is the best way to close an ASPX page from the code-behind?

I have a button event handler that I want to close the page after the user has clicked an ASP.NET button on the page. I have tried to programmatically add a JavaScript method that contains a `window.close()` command to the `OnClientClick` event to close the page but it does not work. The button is also a `asp:AsyncPostBoskTrigger` for an AJAX Update Panel.

The application uses .NET Framework 3.5.

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-12-17T18:59:16.237

You would typically do something like:

```
protected void btnClose_Click(object sender, EventArgs e)
{
    ClientScript.RegisterStartupScript(typeof(Page), "closePage", "window.close();", true);
} 
```

However, keep in mind that different things will happen in different scenerios. Firefox won't let you close a window that wasn't opened by you (opened with `window.open()`).

IE7 will prompt the user with a "This page is trying to close (Yes | No)" dialog.

In any case, you should be prepared to deal with the window not always closing!

One fix for the 2 above issues is to use:

```
protected void btnClose_Click(object sender, EventArgs e) {
    ClientScript.RegisterStartupScript(typeof(Page), "closePage", "window.open('close.html', '_self', null);", true);
} 
```

And create a close.html:

```
<html><head>
 <title></title>
 <script language="javascript" type="text/javascript">
     var redirectTimerId = 0;
     function closeWindow()
     {
         window.opener = top;
         redirectTimerId = window.setTimeout('redirect()', 2000);
         window.close(); 
     }

     function stopRedirect()
     {
         window.clearTimeout(redirectTimerId);
     }

     function redirect()
     {
         window.location = 'default.aspx';
     }
 </script>
 </head>
 <body onload="closeWindow()" onunload="stopRedirect()" style="">
     <center><h1>Please Wait...</h1></center>
 </body></html> 
```

Note that close.html will redirect to default.aspx if the window does not close after 2 sec for some reason.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-10-10T19:12:49.660

```
 protected void btnOK_Click(object sender, EventArgs e)
        {

          // Your code goes here.
          if(isSuccess)
          {
                  string  close =    @"<script type='text/javascript'>
                                window.returnValue = true;
                                window.close();
                                </script>";
            base.Response.Write(close);
            }

        } 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-17T18:24:21.313

**UPDATE:** I have taken all of your input and came up with the following solution:

In code behind:

```
protected void Page_Load(object sender, EventArgs e)    
{
    Page.ClientScript.RegisterOnSubmitStatement(typeof(Page), "closePage", "window.onunload = CloseWindow();");
} 
```

In aspx page:

```
function CloseWindow() {
    window.close();
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-17T17:55:08.097

A postback is the process of re-loading a page, so if you want the page to close after the postback then you need to set your window.close() javascript to run with the browser's onload event during that postback, normally done using the `ClientScript.RegisterStartupScript()` function.

But are you sure this is what you want to do? Closing pages tends to piss off users.

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-17T17:58:58.090

You should inject a startup script that will close the page after the postback has finished.

```
ClientScript.RegisterStartupScript(typeof(Page), "closePage", "<script type='text/JavaScript'>window.close();</script>"); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-09-08T13:31:02.357

You just need to add this property in your asp:Button element (for example):

```
OnClientClick="javascript:window.close();" 
```

It works perfectly.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-01-06T18:23:54.423

If you using RadAjaxManager then you can use this:

```
RadAjaxManager1.ResponseScripts.Add("window.opener.location.href = '../CaseManagement/LCCase.aspx?" + caseId + "'; 
window.close();"); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-17T20:20:59.567

You can close a window by simply pasting the window closing code in the button's OnClientClick event in the markup

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-02-01T17:13:33.057

For anyone wondering why they cannot get the provided answers to work it's because the page must have been opened by javascript in order to be closed by javascript.

Since most people finding this asp question are likely using an `asp:hyperlink` or an asp redirect of some sort to navigate to the page that needs to be closed. These methods of redirection don't use javascript and therefore will not close by javascript.

I found a simple solution for my application and that's eliminating the `NavigateUrl` and using the `asp:Hyperlink.Attributes` to add an `onclick` to the hyperlink which uses java script to open the window that needs to be closed by javascript.

```
aspHyperlink.NavigateUrl = "https://www.google.com"; 
```

The above NavigateUrl is removed and instead we attach our click event.

```
aspHyperlink.Attributes.Add("onclick", "javascript:openInNewTab('https://www.google.com');"); 
```

And in the code behind of the page containing our aspHyperlink we have the javascript for opening the url provided by [Rinto](https://stackoverflow.com/questions/4907843/open-a-url-in-a-new-tab-and-not-a-new-window-using-javascript)

```
function openInNewTab(url) {
         var win = window.open(url, '_blank');
         win.focus();
     } 
```

Now all pages opened with `openInNewTab` can be closed with the provided answers.

```
window.close(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-02-19T04:35:42.533

For closing a asp.net windows application,

*   Just drag a button into the design page
*   Then write the below given code inside its click event

    ```
     "   this.close();  " 
    ```

ie:

```
 private void button2_Click(object sender, EventArgs e)  
 {
        this.Close();
 } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-03T11:42:05.693

```
 protected void Button1_Click(object sender, EventArgs e)
  {
    Button1.Attributes.Add("onclick"," CloseWindow();");
  }

    <script type="text/javascript">
        function CloseWindow() 
      {
         window.close();
      }
    </script> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-07-24T05:18:45.863

You can just simply use this.. short and easy.

```
Response.Write("<script>window.close();</script>"); 
```

Hope this helps.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-07-30T05:27:34.797

if you are opening page on JavaScript popup then

```
 Response.Write("<script>javascript:window.close();</script>"); 
```

will do the job

# cocoa-touch - 如何识别正在显示的当前视图

> ID：375408
> 
> 赞同：3
> 
> 时间：2008-12-17T17:51:40.443
> 
> 标签：cocoa-touch

如果我有 3 个不同的视图，它们在 3 个相应的函数中定义，即：

```
- (UIView *)getView1 { /*...*/ }
- (UIView *)getView2 { /*...*/ }
- (UIView *)getView3 { /*...*/ } 
```

这些是`self.view`在需要特定视图时添加的。

我的问题是，我们如何知道当前正在显示哪些视图？是否有一个参数可以识别当前视图是哪个视图？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T19:16:06.703

您可以用整数标记每个视图，然后读取标记以确定哪个视图处于活动状态（假设您正在替换`self.view`）。

```
#define TAG_VIEW_1 1
#define TAG_VIEW_2 2
#define TAG_VIEW_3 3
...
[ [self getView1()] setTag:TAG_VIEW_1 ];
[ [self getView2()] setTag:TAG_VIEW_2 ];
[ [self getView3()] setTag:TAG_VIEW_3 ];
...    

if ( self.view.tag == TAG_VIEW_1 ) {
    // do something
}
else if ( self.view.tag == TAG_VIEW_2 ) {
    // etc
}
... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-18T03:35:02.047

假设您从 self.view 中删除其他两个视图，当您更改它们时，您可以使用 [self superview] 来确定当前显示的是哪一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-15T22:02:04.063

所有 UIView 都有一个[window 属性](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIView_Class/UIView/UIView.html#//apple_ref/occ/instp/UIView/window)，当它在窗口中显示时设置，当它被移除时设置为 nil。您可以获取 window 属性的值来查看当前是否正在窗口中显示视图：

```
BOOL isDisplayed = self.view.window != nil; 
```

您还可以在 UIView 的子类中覆盖[willMoveToWindow:](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIView_Class/UIView/UIView.html#//apple_ref/occ/instm/UIView/willMoveToWindow:)，只要将视图添加到窗口或从窗口中删除，就会调用它。

# java - Java 等价于 PHP 的 preg_replace_callback

> ID：375420
> 
> 赞同：38
> 
> 时间：2008-12-17T17:54:03.483
> 
> 标签：java, php, regex, preg-replace

我正在将应用程序从 PHP 迁移到 Java，并且代码中大量使用了正则表达式。我在 PHP 中遇到了一些似乎没有 java 等价物的东西：

```
preg_replace_callback() 
```

对于正则表达式中的每个匹配，它都会调用一个函数，该函数将匹配文本作为参数传递。作为示例用法：

```
$articleText = preg_replace_callback("/\[thumb(\d+)\]/",'thumbReplace', $articleText);
# ...
function thumbReplace($matches) {
   global $photos;
   return "<img src=\"thumbs/" . $photos[$matches[1]] . "\">";
} 
```

在 Java 中执行此操作的理想方法是什么？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-18T10:38:36.090

当您可以在循环中使用 appendReplacement() 和 appendTail() 时，尝试模拟 PHP 的回调功能似乎需要做很多工作：

```
StringBuffer resultString = new StringBuffer();
Pattern regex = Pattern.compile("regex");
Matcher regexMatcher = regex.matcher(subjectString);
while (regexMatcher.find()) {
  // You can vary the replacement text for each match on-the-fly
  regexMatcher.appendReplacement(resultString, "replacement");
}
regexMatcher.appendTail(resultString); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-12-17T18:11:18.673

**重要提示：正如**[Kip](https://stackoverflow.com/questions/375420/java-equivalent-to-phps-preg-replace-callback/375479?noredirect=1#comment2566951_375479)在评论中指出的那样，如果匹配的正则表达式与替换字符串匹配，则此类具有无限循环错误。如有必要，我会将其作为练习留给读者进行修复。

* * *

我不知道Java中内置了类似的东西。使用 Matcher 类，你可以毫不费力地自己动手：

```
import java.util.regex.*;

public class CallbackMatcher
{
    public static interface Callback
    {
        public String foundMatch(MatchResult matchResult);
    }

    private final Pattern pattern;

    public CallbackMatcher(String regex)
    {
        this.pattern = Pattern.compile(regex);
    }

    public String replaceMatches(String string, Callback callback)
    {
        final Matcher matcher = this.pattern.matcher(string);
        while(matcher.find())
        {
            final MatchResult matchResult = matcher.toMatchResult();
            final String replacement = callback.foundMatch(matchResult);
            string = string.substring(0, matchResult.start()) +
                     replacement + string.substring(matchResult.end());
            matcher.reset(string);
        }
    }
} 
```

然后调用：

```
final CallbackMatcher.Callback callback = new CallbackMatcher.Callback() {
    public String foundMatch(MatchResult matchResult)
    {
        return "<img src=\"thumbs/" + matchResults.group(1) + "\"/>";
    }
};

final CallbackMatcher callbackMatcher = new CallbackMatcher("/\[thumb(\d+)\]/");
callbackMatcher.replaceMatches(articleText, callback); 
```

`matchResults.group()`请注意，您可以通过调用or获取整个匹配的字符串`matchResults.group(0)`，因此无需将当前字符串状态传递给回调。

**编辑：**使它看起来更像 PHP 函数的确切功能。

这是原版，因为提问者喜欢它：

```
public class CallbackMatcher
{
    public static interface Callback
    {
        public void foundMatch(MatchResult matchResult);
    }

    private final Pattern pattern;

    public CallbackMatcher(String regex)
    {
        this.pattern = Pattern.compile(regex);
    }

    public String findMatches(String string, Callback callback)
    {
        final Matcher matcher = this.pattern.matcher(string);
        while(matcher.find())
        {
            callback.foundMatch(matcher.toMatchResult());
        }
    }
} 
```

对于这个特定的用例，最好在回调中简单地对每个匹配进行排队，然后向后运行它们。这将避免在修改字符串时重新映射索引。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-01T20:19:06.753

我对这里的任何解决方案都不太满意。我想要一个无状态的解决方案。如果我的替换字符串碰巧与模式匹配，我不想最终陷入无限循环。当我这样做时，我添加了对`limit`参数和返回`count`参数的支持。（我使用 an`AtomicInteger`来模拟通过引用传递整数。）我将参数移动`callback`到参数列表的末尾，以便更容易定义匿名类。

这是一个使用示例：

```
final Map<String,String> props = new HashMap<String,String>();
props.put("MY_NAME", "Kip");
props.put("DEPT", "R&D");
props.put("BOSS", "Dave");

String subjectString = "Hi my name is ${MY_NAME} and I work in ${DEPT} for ${BOSS}";
String sRegex = "\\$\\{([A-Za-z0-9_]+)\\}";

String replacement = ReplaceCallback.replace(sRegex, subjectString, new ReplaceCallback.Callback() {
  public String matchFound(MatchResult match) {
    String group1 = match.group(1);
    if(group1 != null && props.containsKey(group1))
      return props.get(group1);
    return match.group();
  }
});

System.out.println("replacement: " + replacement); 
```

这是我的 ReplaceCallback 类版本：

```
import java.util.concurrent.atomic.AtomicInteger;
import java.util.regex.*;

public class ReplaceCallback
{
  public static interface Callback {
    /**
     * This function is called when a match is made. The string which was matched
     * can be obtained via match.group(), and the individual groupings via
     * match.group(n).
     */
    public String matchFound(MatchResult match);
  }

  /**
   * Replaces with callback, with no limit to the number of replacements.
   * Probably what you want most of the time.
   */
  public static String replace(String pattern, String subject, Callback callback)
  {
    return replace(pattern, subject, -1, null, callback);
  }

  public static String replace(String pattern, String subject, int limit, Callback callback)
  {
    return replace(pattern, subject, limit, null, callback);
  }

  /**
   * @param regex    The regular expression pattern to search on.
   * @param subject  The string to be replaced.
   * @param limit    The maximum number of replacements to make. A negative value
   *                 indicates replace all.
   * @param count    If this is not null, it will be set to the number of
   *                 replacements made.
   * @param callback Callback function
   */
  public static String replace(String regex, String subject, int limit,
          AtomicInteger count, Callback callback)
  {
    StringBuffer sb = new StringBuffer();
    Matcher matcher = Pattern.compile(regex).matcher(subject);
    int i;
    for(i = 0; (limit < 0 || i < limit) && matcher.find(); i++)
    {
      String replacement = callback.matchFound(matcher.toMatchResult());
      replacement = Matcher.quoteReplacement(replacement); //probably what you want...
      matcher.appendReplacement(sb, replacement);
    }
    matcher.appendTail(sb);

    if(count != null)
      count.set(i);
    return sb.toString();
  }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-01-10T15:58:10.383

```
public static String replace(Pattern pattern, Function<MatchResult, String> callback, CharSequence subject) {
    Matcher m = pattern.matcher(subject);
    StringBuffer sb = new StringBuffer();
    while (m.find()) {
        m.appendReplacement(sb, callback.apply(m.toMatchResult()));
    }
    m.appendTail(sb);
    return sb.toString();
} 
```

**使用示例：**

```
replace(Pattern.compile("cat"), mr -> "dog", "one cat two cats in the yard") 
```

将产生返回值：

> 一只狗 院子里的两只狗

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-12-24T01:09:04.613

Java 9 引入了[`Matcher#replaceAll`](https://docs.oracle.com/javase/10/docs/api/java/util/regex/Matcher.html#replaceAll(java.util.function.Function))接受 a 的方法`Function<MatchResult,String>`来返回给定特定匹配的替换，这非常优雅。

```
Patern.compile("regex").matcher("some string")
     .replaceAll(matchResult -> "something" + matchResult.group()); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-05T04:16:05.517

我发现如果您返回的字符串可以再次匹配，jdmichal 的答案将无限循环；下面是一个修改，它可以防止这种匹配出现无限循环。

```
public String replaceMatches(String string, Callback callback) {
    String result = "";
    final Matcher matcher = this.pattern.matcher(string);
    int lastMatch = 0;
    while(matcher.find())
    {
        final MatchResult matchResult = matcher.toMatchResult();
        final String replacement = callback.foundMatch(matchResult);
        result += string.substring(lastMatch, matchResult.start()) +
            replacement;
        lastMatch = matchResult.end();
    }
    if (lastMatch < string.length())
        result += string.substring(lastMatch);
    return result;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-10-06T14:59:30.277

`Matcher#replaceAll`就是你要找的。

```
Pattern.compile("random number")
    .matcher("this is a random number")
    .replaceAll(r -> "" + ThreadLocalRandom.current().nextInt()) 
```

输出：

```
this is a -107541873 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-17T19:59:31.387

这是我对您的建议所做的最终结果。我认为如果有人遇到同样的问题，在这里会很好。生成的调用代码如下所示：

```
content = ReplaceCallback.find(content, regex, new ReplaceCallback.Callback() {
    public String matches(MatchResult match) {
        // Do something special not normally allowed in regex's...
        return "newstring"
    }
}); 
```

整个类列表如下：

```
import java.util.regex.MatchResult;
import java.util.regex.Pattern;
import java.util.regex.Matcher;
import java.util.Stack;

/**
 * <p>
 * Class that provides a method for doing regular expression string replacement by passing the matched string to
 * a function that operates on the string.  The result of the operation is then used to replace the original match.
 * </p>
 * <p>Example:</p>
 * <pre>
 * ReplaceCallback.find("string to search on", "/regular(expression/", new ReplaceCallback.Callback() {
 *      public String matches(MatchResult match) {
 *          // query db or whatever...
 *          return match.group().replaceAll("2nd level replacement", "blah blah");
 *      }
 * });
 * </pre>
 * <p>
 * This, in effect, allows for a second level of string regex processing.
 * </p>
 *
 */
public class ReplaceCallback {
    public static interface Callback {
        public String matches(MatchResult match);
    }

    private final Pattern pattern;
    private Callback callback;

    private class Result {
        int start;
        int end;
        String replace;
    }

    /**
     * You probably don't need this.  {@see find(String, String, Callback)}
     * @param regex     The string regex to use
     * @param callback  An instance of Callback to execute on matches
     */
    public ReplaceCallback(String regex, final Callback callback) {
        this.pattern = Pattern.compile(regex);
        this.callback = callback;
    }

    public String execute(String string) {
        final Matcher matcher = this.pattern.matcher(string);
        Stack<Result> results = new Stack<Result>();
        while(matcher.find()) {
            final MatchResult matchResult = matcher.toMatchResult();
            Result r = new Result();
            r.replace = callback.matches(matchResult);
            if(r.replace == null)
                continue;
            r.start = matchResult.start();
            r.end = matchResult.end();
            results.push(r);
        }
        // Improve this with a stringbuilder...
        while(!results.empty()) {
            Result r = results.pop();
            string = string.substring(0, r.start) + r.replace + string.substring(r.end);
        }
        return string;
    }

    /**
     * If you wish to reuse the regex multiple times with different callbacks or search strings, you can create a
     * ReplaceCallback directly and use this method to perform the search and replace.
     *
     * @param string    The string we are searching through
     * @param callback  A callback instance that will be applied to the regex match results.
     * @return  The modified search string.
     */
    public String execute(String string, final Callback callback) {
        this.callback = callback;
        return execute(string);
    }

    /**
     * Use this static method to perform your regex search.
     * @param search    The string we are searching through
     * @param regex     The regex to apply to the string
     * @param callback  A callback instance that will be applied to the regex match results.
     * @return  The modified search string.
     */
    public static String find(String search, String regex, Callback callback) {
        ReplaceCallback rc = new ReplaceCallback(regex, callback);
        return rc.execute(search);
    }
} 
```

# python - 在 Python 中对 subprocess.PIPE 进行非阻塞读取

> ID：375427
> 
> 赞同：565
> 
> 时间：2008-12-17T17:56:34.367
> 
> 标签：python, io, subprocess, nonblocking

我正在使用[subprocess 模块](http://docs.python.org/library/subprocess.html)来启动一个子进程并连接到它的输出流（标准输出）。我希望能够在其标准输出上执行非阻塞读取。有没有办法使 .readline 非阻塞或在我调用之前检查流上是否有数据`.readline`？我希望它是可移植的，或者至少可以在 Windows 和 Linux 下工作。

这是我现在的做法（`.readline`如果没有可用数据，它会阻止）：

```
p = subprocess.Popen('myprogram.exe', stdout = subprocess.PIPE)
output_str = p.stdout.readline() 
```

* * *

## 回答 #1

> 赞同：450
> 
> 时间：2011-02-04T09:14:38.690

[`fcntl`](https://stackoverflow.com/questions/375427/non-blocking-read-on-a-stream-in-python/4025909#4025909), [`select`](https://stackoverflow.com/questions/375427/non-blocking-read-on-a-stream-in-python/375511#375511),[`asyncproc`](https://stackoverflow.com/questions/375427/non-blocking-read-on-a-stream-in-python/437888#437888)在这种情况下无济于事。

无论操作系统如何，在不阻塞的情况下读取流的可靠方法是使用[`Queue.get_nowait()`](https://docs.python.org/3/library/queue.html#queue.Queue.get_nowait)：

```
import sys
from subprocess import PIPE, Popen
from threading  import Thread

try:
    from queue import Queue, Empty
except ImportError:
    from Queue import Queue, Empty  # python 2.x

ON_POSIX = 'posix' in sys.builtin_module_names

def enqueue_output(out, queue):
    for line in iter(out.readline, b''):
        queue.put(line)
    out.close()

p = Popen(['myprogram.exe'], stdout=PIPE, bufsize=1, close_fds=ON_POSIX)
q = Queue()
t = Thread(target=enqueue_output, args=(p.stdout, q))
t.daemon = True # thread dies with the program
t.start()

# ... do other things here

# read line without blocking
try:  line = q.get_nowait() # or q.get(timeout=.1)
except Empty:
    print('no output yet')
else: # got line
    # ... do something with line 
```

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2009-11-27T21:33:52.117

我经常遇到类似的问题；我经常编写的 Python 程序需要能够执行一些主要功能，同时接受来自命令行 (stdin) 的用户输入。简单地将用户输入处理功能放在另一个线程中并不能解决问题，因为`readline()`阻塞并且没有超时。如果主要功能已完成并且不再需要等待进一步的用户输入，我通常希望我的程序退出，但它不能，因为`readline()`它仍然阻塞在等待一行的其他线程中。我发现这个问题的一个解决方案是使用 fcntl 模块使标准输入成为一个非阻塞文件：

```
import fcntl
import os
import sys

# make stdin a non-blocking file
fd = sys.stdin.fileno()
fl = fcntl.fcntl(fd, fcntl.F_GETFL)
fcntl.fcntl(fd, fcntl.F_SETFL, fl | os.O_NONBLOCK)

# user input handling thread
while mainThreadIsRunning:
      try: input = sys.stdin.readline()
      except: continue
      handleInput(input) 
```

在我看来，这比使用 select 或 signal 模块来解决这个问题要干净一些，但它又只适用于 UNIX ......

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2013-12-20T05:50:15.010

Python 3.4为异步 IO引入了新的[临时 API -](http://www.python.org/dev/peps/pep-0411/)[`asyncio`模块](http://docs.python.org/3/library/asyncio.html)。

该方法类似于[`twisted`@Bryan Ward 的基于 - 的答案](https://stackoverflow.com/a/5750194/4279)——定义一个协议，并在数据准备好后立即调用其方法：

```
#!/usr/bin/env python3
import asyncio
import os

class SubprocessProtocol(asyncio.SubprocessProtocol):
    def pipe_data_received(self, fd, data):
        if fd == 1: # got stdout data (bytes)
            print(data)

    def connection_lost(self, exc):
        loop.stop() # end loop.run_forever()

if os.name == 'nt':
    loop = asyncio.ProactorEventLoop() # for subprocess' pipes on Windows
    asyncio.set_event_loop(loop)
else:
    loop = asyncio.get_event_loop()
try:
    loop.run_until_complete(loop.subprocess_exec(SubprocessProtocol, 
        "myprogram.exe", "arg1", "arg2"))
    loop.run_forever()
finally:
    loop.close() 
```

请参阅[文档中的“子流程”](https://docs.python.org/3/library/asyncio-subprocess.html)。

有一个高级接口`asyncio.create_subprocess_exec()`返回允许使用[协程异步读取行的](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader)[`Process`对象](https://docs.python.org/3/library/asyncio-subprocess.html#process) （使用[/](https://www.python.org/dev/peps/pep-0492/) [Python 3.5+ 语法](https://www.python.org/dev/peps/pep-0492/)）：[`StreamReader.readline()`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader)[`async``await`](https://www.python.org/dev/peps/pep-0492/)

```
#!/usr/bin/env python3.5
import asyncio
import locale
import sys
from asyncio.subprocess import PIPE
from contextlib import closing

async def readline_and_kill(*args):
    # start child process
    process = await asyncio.create_subprocess_exec(*args, stdout=PIPE)

    # read line (sequence of bytes ending with b'\n') asynchronously
    async for line in process.stdout:
        print("got line:", line.decode(locale.getpreferredencoding(False)))
        break
    process.kill()
    return await process.wait() # wait for the child process to exit

if sys.platform == "win32":
    loop = asyncio.ProactorEventLoop()
    asyncio.set_event_loop(loop)
else:
    loop = asyncio.get_event_loop()

with closing(loop):
    sys.exit(loop.run_until_complete(readline_and_kill(
        "myprogram.exe", "arg1", "arg2"))) 
```

`readline_and_kill()`执行以下任务：

*   启动子进程，将其标准输出重定向到管道
*   从子进程的标准输出中异步读取一行
*   杀死子进程
*   等待它退出

如有必要，每个步骤都可能受到超时秒数的限制。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-01-13T03:36:16.937

试试[asyncproc](http://www.lysator.liu.se/~bellman/download/asyncproc.py)模块。例如：

```
import os
from asyncproc import Process
myProc = Process("myprogram.app")

while True:
    # check to see if process has ended
    poll = myProc.wait(os.WNOHANG)
    if poll != None:
        break
    # print any new output
    out = myProc.read()
    if out != "":
        print out 
```

该模块负责 S.Lott 建议的所有线程。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-04-21T21:54:55.013

[你可以在Twisted](http://twistedmatrix.com/trac/)中轻松地做到这一点。根据您现有的代码库，这可能不是那么容易使用，但如果您正在构建一个扭曲的应用程序，那么这样的事情几乎变得微不足道。您创建一个`ProcessProtocol`类，并覆盖该`outReceived()`方法。Twisted（取决于所使用的反应器）通常只是一个`select()`带有回调的大循环，用于处理来自不同文件描述符（通常是网络套接字）的数据。所以该`outReceived()`方法只是安装一个回调来处理来自`STDOUT`. 演示此行为的简单示例如下：

```
from twisted.internet import protocol, reactor

class MyProcessProtocol(protocol.ProcessProtocol):

    def outReceived(self, data):
        print data

proc = MyProcessProtocol()
reactor.spawnProcess(proc, './myprogram', ['./myprogram', 'arg1', 'arg2', 'arg3'])
reactor.run() 
```

[Twisted 文档](http://twistedmatrix.com/documents/current/core/howto/process.html)对此有一些很好的信息。

如果您围绕 Twisted 构建整个应用程序，它会与其他进程（本地或远程）进行异步通信，就像这样非常优雅。另一方面，如果你的程序不是建立在 Twisted 之上的，那么这真的不会有那么大的帮助。希望这对其他读者有所帮助，即使它不适用于您的特定应用程序。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2019-12-11T17:51:31.700

在类 Unix 系统和 Python 3.5+ 上[`os.set_blocking`](https://docs.python.org/3/library/os.html#os.get_blocking)，它完全按照它所说的那样工作。

```
import os
import time
import subprocess

cmd = 'python3', '-c', 'import time; [(print(i), time.sleep(1)) for i in range(5)]'
p = subprocess.Popen(cmd, stdout=subprocess.PIPE)
os.set_blocking(p.stdout.fileno(), False)
start = time.time()
while True:
    # first iteration always produces empty byte string in non-blocking mode
    for i in range(2):    
        line = p.stdout.readline()
        print(i, line)
        time.sleep(0.5)
    if time.time() > start + 5:
        break
p.terminate() 
```

这输出：

```
1 b''
2 b'0\n'
1 b''
2 b'1\n'
1 b''
2 b'2\n'
1 b''
2 b'3\n'
1 b''
2 b'4\n' 
```

评论`os.set_blocking`是：

```
0 b'0\n'
1 b'1\n'
0 b'2\n'
1 b'3\n'
0 b'4\n'
1 b'' 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2011-01-26T01:02:08.777

使用选择和读取（1）。

```
import subprocess     #no new requirements
def readAllSoFar(proc, retVal=''): 
  while (select.select([proc.stdout],[],[],0)[0]!=[]):   
    retVal+=proc.stdout.read(1)
  return retVal
p = subprocess.Popen(['/bin/ls'], stdout=subprocess.PIPE)
while not p.poll():
  print (readAllSoFar(p)) 
```

对于类似 readline() 的：

```
lines = ['']
while not p.poll():
  lines = readAllSoFar(p, lines[-1]).split('\n')
  for a in range(len(lines)-1):
    print a
lines = readAllSoFar(p, lines[-1]).split('\n')
for a in range(len(lines)-1):
  print a 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-12-17T18:16:48.913

一种解决方案是创建另一个进程来执行您对进程的读取，或者使进程的线程超时。

这是超时函数的线程版本：

[http://code.activestate.com/recipes/473878/](http://code.activestate.com/recipes/473878/)

但是，您需要在标准输出进入时阅读它吗？**另一种解决方案可能是将输出转储到文件并使用p.wait()**等待进程完成。

```
f = open('myprogram_output.txt','w')
p = subprocess.Popen('myprogram.exe', stdout=f)
p.wait()
f.close()

str = open('myprogram_output.txt','r').read() 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-06-11T19:09:11.843

这是我的代码，用于尽快捕获子流程的每个输出，包括部分行。它以几乎正确的顺序同时泵送标准输出和标准错误。

在 Python 2.7 linux 和 windows 上测试并正确工作。

```
#!/usr/bin/python
#
# Runner with stdout/stderr catcher
#
from sys import argv
from subprocess import Popen, PIPE
import os, io
from threading import Thread
import Queue
def __main__():
    if (len(argv) > 1) and (argv[-1] == "-sub-"):
        import time, sys
        print "Application runned!"
        time.sleep(2)
        print "Slept 2 second"
        time.sleep(1)
        print "Slept 1 additional second",
        time.sleep(2)
        sys.stderr.write("Stderr output after 5 seconds")
        print "Eol on stdin"
        sys.stderr.write("Eol on stderr\n")
        time.sleep(1)
        print "Wow, we have end of work!",
    else:
        os.environ["PYTHONUNBUFFERED"]="1"
        try:
            p = Popen( argv + ["-sub-"],
                       bufsize=0, # line-buffered
                       stdin=PIPE, stdout=PIPE, stderr=PIPE )
        except WindowsError, W:
            if W.winerror==193:
                p = Popen( argv + ["-sub-"],
                           shell=True, # Try to run via shell
                           bufsize=0, # line-buffered
                           stdin=PIPE, stdout=PIPE, stderr=PIPE )
            else:
                raise
        inp = Queue.Queue()
        sout = io.open(p.stdout.fileno(), 'rb', closefd=False)
        serr = io.open(p.stderr.fileno(), 'rb', closefd=False)
        def Pump(stream, category):
            queue = Queue.Queue()
            def rdr():
                while True:
                    buf = stream.read1(8192)
                    if len(buf)>0:
                        queue.put( buf )
                    else:
                        queue.put( None )
                        return
            def clct():
                active = True
                while active:
                    r = queue.get()
                    try:
                        while True:
                            r1 = queue.get(timeout=0.005)
                            if r1 is None:
                                active = False
                                break
                            else:
                                r += r1
                    except Queue.Empty:
                        pass
                    inp.put( (category, r) )
            for tgt in [rdr, clct]:
                th = Thread(target=tgt)
                th.setDaemon(True)
                th.start()
        Pump(sout, 'stdout')
        Pump(serr, 'stderr')

        while p.poll() is None:
            # App still working
            try:
                chan,line = inp.get(timeout = 1.0)
                if chan=='stdout':
                    print "STDOUT>>", line, "<?<"
                elif chan=='stderr':
                    print " ERROR==", line, "=?="
            except Queue.Empty:
                pass
        print "Finish"

if __name__ == '__main__':
    __main__() 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2012-07-06T12:42:26.753

免责声明：这只适用于龙卷风

您可以通过将 fd 设置为非阻塞，然后使用 ioloop 注册回调来做到这一点。我已经将它打包在一个名为[tornado_subprocess](http://pypi.python.org/pypi/tornado_subprocess/0.1.3)的鸡蛋中，您可以通过 PyPI 安装它：

```
easy_install tornado_subprocess 
```

现在你可以做这样的事情：

```
import tornado_subprocess
import tornado.ioloop

    def print_res( status, stdout, stderr ) :
    print status, stdout, stderr
    if status == 0:
        print "OK:"
        print stdout
    else:
        print "ERROR:"
        print stderr

t = tornado_subprocess.Subprocess( print_res, timeout=30, args=[ "cat", "/etc/passwd" ] )
t.start()
tornado.ioloop.IOLoop.instance().start() 
```

您也可以将它与 RequestHandler 一起使用

```
class MyHandler(tornado.web.RequestHandler):
    def on_done(self, status, stdout, stderr):
        self.write( stdout )
        self.finish()

    @tornado.web.asynchronous
    def get(self):
        t = tornado_subprocess.Subprocess( self.on_done, timeout=30, args=[ "cat", "/etc/passwd" ] )
        t.start() 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-03-15T04:40:40.110

现有的解决方案对我不起作用（详情如下）。最终起作用的是使用 read(1) 实现 readline （基于[this answer](https://stackoverflow.com/a/883166/2039589)）。后者不阻塞：

```
from subprocess import Popen, PIPE
from threading import Thread
def process_output(myprocess): #output-consuming thread
    nextline = None
    buf = ''
    while True:
        #--- extract line using read(1)
        out = myprocess.stdout.read(1)
        if out == '' and myprocess.poll() != None: break
        if out != '':
            buf += out
            if out == '\n':
                nextline = buf
                buf = ''
        if not nextline: continue
        line = nextline
        nextline = None

        #--- do whatever you want with line here
        print 'Line is:', line
    myprocess.stdout.close()

myprocess = Popen('myprogram.exe', stdout=PIPE) #output-producing process
p1 = Thread(target=process_output, args=(myprocess,)) #output-consuming thread
p1.daemon = True
p1.start()

#--- do whatever here and then kill process and thread if needed
if myprocess.poll() == None: #kill process; will automatically stop thread
    myprocess.kill()
    myprocess.wait()
if p1 and p1.is_alive(): #wait for thread to finish
    p1.join() 
```

为什么现有的解决方案不起作用：

1.  需要 readline 的解决方案（包括基于队列的解决方案）总是阻塞。很难（不可能？）杀死执行 readline 的线程。它只会在创建它的进程完成时被杀死，而不是在输出生成进程被杀死时。
2.  正如 anonnn 所指出的，将低级 fcntl 与高级 readline 调用混合可能无法正常工作。
3.  使用 select.poll() 很简洁，但根据 python 文档在 Windows 上不起作用。
4.  对于这项任务，使用第三方库似乎有点过头了，并且会增加额外的依赖项。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2011-04-21T20:51:57.557

我添加这个问题来阅读一些 subprocess.Popen 标准输出。这是我的非阻塞读取解决方案：

```
import fcntl

def non_block_read(output):
    fd = output.fileno()
    fl = fcntl.fcntl(fd, fcntl.F_GETFL)
    fcntl.fcntl(fd, fcntl.F_SETFL, fl | os.O_NONBLOCK)
    try:
        return output.read()
    except:
        return ""

# Use example
from subprocess import *
sb = Popen("echo test && sleep 1000", shell=True, stdout=PIPE)
sb.kill()

# sb.stdout.read() # <-- This will block
non_block_read(sb.stdout)
'test\n' 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2019-05-09T02:12:08.943

在现代 Python 中情况要好得多。

这是一个简单的子程序“hello.py”：

```
#!/usr/bin/env python3

while True:
    i = input()
    if i == "quit":
        break
    print(f"hello {i}") 
```

以及与之交互的程序：

```
import asyncio

async def main():
    proc = await asyncio.subprocess.create_subprocess_exec(
        "./hello.py", stdin=asyncio.subprocess.PIPE, stdout=asyncio.subprocess.PIPE
    )
    proc.stdin.write(b"bob\n")
    print(await proc.stdout.read(1024))
    proc.stdin.write(b"alice\n")
    print(await proc.stdout.read(1024))
    proc.stdin.write(b"quit\n")
    await proc.wait()

asyncio.run(main()) 
```

打印出来：

```
b'hello bob\n'
b'hello alice\n' 
```

请注意，几乎所有先前的答案（包括此处和相关问题）中的实际模式是将子项的 stdout 文件描述符设置为非阻塞，然后在某种选择循环中对其进行轮询。当然，现在这个循环是由 asyncio 提供的。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-05-24T15:55:16.057

此版本的非阻塞读取**不需要**特殊模块，并且可以在大多数 Linux 发行版上开箱即用。

```
import os
import sys
import time
import fcntl
import subprocess

def async_read(fd):
    # set non-blocking flag while preserving old flags
    fl = fcntl.fcntl(fd, fcntl.F_GETFL)
    fcntl.fcntl(fd, fcntl.F_SETFL, fl | os.O_NONBLOCK)
    # read char until EOF hit
    while True:
        try:
            ch = os.read(fd.fileno(), 1)
            # EOF
            if not ch: break                                                                                                                                                              
            sys.stdout.write(ch)
        except OSError:
            # waiting for data be available on fd
            pass

def shell(args, async=True):
    # merge stderr and stdout
    proc = subprocess.Popen(args, shell=False, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    if async: async_read(proc.stdout)
    sout, serr = proc.communicate()
    return (sout, serr)

if __name__ == '__main__':
    cmd = 'ping 8.8.8.8'
    sout, serr = shell(cmd.split()) 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2020-03-20T15:41:53.127

这是一个基于线程的简单解决方案：

*   适用于 Linux 和 Windows（不依赖于`select`）。
*   `stdout`异步读取`stderr`。
*   不依赖于具有任意等待时间的主动轮询（CPU 友好）。
*   不使用`asyncio`（可能与其他库冲突）。
*   运行直到子进程终止。

*打印机.py*

```
import time
import sys

sys.stdout.write("Hello\n")
sys.stdout.flush()
time.sleep(1)
sys.stdout.write("World!\n")
sys.stdout.flush()
time.sleep(1)
sys.stderr.write("That's an error\n")
sys.stderr.flush()
time.sleep(2)
sys.stdout.write("Actually, I'm fine\n")
sys.stdout.flush()
time.sleep(1) 
```

*阅读器.py*

```
import queue
import subprocess
import sys
import threading

def enqueue_stream(stream, queue, type):
    for line in iter(stream.readline, b''):
        queue.put(str(type) + line.decode('utf-8'))
    stream.close()

def enqueue_process(process, queue):
    process.wait()
    queue.put('x')

p = subprocess.Popen('python printer.py', stdout=subprocess.PIPE, stderr=subprocess.PIPE)
q = queue.Queue()
to = threading.Thread(target=enqueue_stream, args=(p.stdout, q, 1))
te = threading.Thread(target=enqueue_stream, args=(p.stderr, q, 2))
tp = threading.Thread(target=enqueue_process, args=(p, q))
te.start()
to.start()
tp.start()

while True:
    line = q.get()
    if line[0] == 'x':
        break
    if line[0] == '2':  # stderr
        sys.stdout.write("\033[0;31m")  # ANSI red color
    sys.stdout.write(line[1:])
    if line[0] == '2':
        sys.stdout.write("\033[0m")  # reset ANSI code
    sys.stdout.flush()

tp.join()
to.join()
te.join() 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-09-26T12:33:05.503

我有原始提问者的问题，但不想调用线程。我将 Jesse 的解决方案与直接`read()`来自管道的解决方案和我自己的用于行读取的缓冲区处理程序混合在一起（但是，我的子进程 - ping - 总是写满行<系统页面大小）。我通过只读取 gobject 注册的 io 手表来避免忙等待。这些天来，我通常在 gobject MainLoop 中运行代码以避免线程。

```
def set_up_ping(ip, w):
    # run the sub-process
    # watch the resultant pipe
    p = subprocess.Popen(['/bin/ping', ip], stdout=subprocess.PIPE)
    # make stdout a non-blocking file
    fl = fcntl.fcntl(p.stdout, fcntl.F_GETFL)
    fcntl.fcntl(p.stdout, fcntl.F_SETFL, fl | os.O_NONBLOCK)
    stdout_gid = gobject.io_add_watch(p.stdout, gobject.IO_IN, w)
    return stdout_gid # for shutting down 
```

观察者是

```
def watch(f, *other):
    print 'reading',f.read()
    return True 
```

主程序设置一个 ping 然后调用 gobject 邮件循环。

```
def main():
    set_up_ping('192.168.1.8', watch)
    # discard gid as unused here
    gobject.MainLoop().run() 
```

任何其他工作都附加到 gobject 中的回调。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-01-28T03:37:45.510

在此处添加此答案，因为它提供了在 Windows 和 Unix 上设置非阻塞管道的能力。

所有`ctypes`细节都感谢[@techtonik 的回答](https://stackoverflow.com/questions/34504970)。

有一个稍加修改的版本可用于 Unix 和 Windows 系统。

*   Python3 兼容*（只需稍作改动）*。
*   包括 posix 版本，并定义了用于任何一个的异常。

这样您就可以对 Unix 和 Windows 代码使用相同的函数和异常。

```
# pipe_non_blocking.py (module)
"""
Example use:

    p = subprocess.Popen(
            command,
            stdout=subprocess.PIPE,
            )

    pipe_non_blocking_set(p.stdout.fileno())

    try:
        data = os.read(p.stdout.fileno(), 1)
    except PortableBlockingIOError as ex:
        if not pipe_non_blocking_is_error_blocking(ex):
            raise ex
"""

__all__ = (
    "pipe_non_blocking_set",
    "pipe_non_blocking_is_error_blocking",
    "PortableBlockingIOError",
    )

import os

if os.name == "nt":
    def pipe_non_blocking_set(fd):
        # Constant could define globally but avoid polluting the name-space
        # thanks to: https://stackoverflow.com/questions/34504970
        import msvcrt

        from ctypes import windll, byref, wintypes, WinError, POINTER
        from ctypes.wintypes import HANDLE, DWORD, BOOL

        LPDWORD = POINTER(DWORD)

        PIPE_NOWAIT = wintypes.DWORD(0x00000001)

        def pipe_no_wait(pipefd):
            SetNamedPipeHandleState = windll.kernel32.SetNamedPipeHandleState
            SetNamedPipeHandleState.argtypes = [HANDLE, LPDWORD, LPDWORD, LPDWORD]
            SetNamedPipeHandleState.restype = BOOL

            h = msvcrt.get_osfhandle(pipefd)

            res = windll.kernel32.SetNamedPipeHandleState(h, byref(PIPE_NOWAIT), None, None)
            if res == 0:
                print(WinError())
                return False
            return True

        return pipe_no_wait(fd)

    def pipe_non_blocking_is_error_blocking(ex):
        if not isinstance(ex, PortableBlockingIOError):
            return False
        from ctypes import GetLastError
        ERROR_NO_DATA = 232

        return (GetLastError() == ERROR_NO_DATA)

    PortableBlockingIOError = OSError
else:
    def pipe_non_blocking_set(fd):
        import fcntl
        fl = fcntl.fcntl(fd, fcntl.F_GETFL)
        fcntl.fcntl(fd, fcntl.F_SETFL, fl | os.O_NONBLOCK)
        return True

    def pipe_non_blocking_is_error_blocking(ex):
        if not isinstance(ex, PortableBlockingIOError):
            return False
        return True

    PortableBlockingIOError = BlockingIOError 
```

为了避免读取不完整的数据，我最终编写了自己的 readline 生成器（它返回每行的字节字符串）。

它是一个生成器，因此您可以例如...

```
def non_blocking_readlines(f, chunk=1024):
    """
    Iterate over lines, yielding b'' when nothings left
    or when new data is not yet available.

    stdout_iter = iter(non_blocking_readlines(process.stdout))

    line = next(stdout_iter)  # will be a line or b''.
    """
    import os

    from .pipe_non_blocking import (
            pipe_non_blocking_set,
            pipe_non_blocking_is_error_blocking,
            PortableBlockingIOError,
            )

    fd = f.fileno()
    pipe_non_blocking_set(fd)

    blocks = []

    while True:
        try:
            data = os.read(fd, chunk)
            if not data:
                # case were reading finishes with no trailing newline
                yield b''.join(blocks)
                blocks.clear()
        except PortableBlockingIOError as ex:
            if not pipe_non_blocking_is_error_blocking(ex):
                raise ex

            yield b''
            continue

        while True:
            n = data.find(b'\n')
            if n == -1:
                break

            yield b''.join(blocks) + data[:n + 1]
            data = data[n + 1:]
            blocks.clear()
        blocks.append(data) 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-17T18:19:25.210

[选择](http://www.python.org/doc/2.5.2/lib/module-select.html)模块可帮助您确定下一个有用的输入在哪里。

但是，您几乎总是对单独的线程更满意。一个执行阻塞读取标准输入，另一个执行您不想阻塞的任何位置。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-01-19T07:39:26.393

为什么要打扰线程和队列？与 readline() 不同，BufferedReader.read1() 不会阻塞等待 \r\n，如果有任何输出进入，它会尽快返回。

```
#!/usr/bin/python
from subprocess import Popen, PIPE, STDOUT
import io

def __main__():
    try:
        p = Popen( ["ping", "-n", "3", "127.0.0.1"], stdin=PIPE, stdout=PIPE, stderr=STDOUT )
    except: print("Popen failed"); quit()
    sout = io.open(p.stdout.fileno(), 'rb', closefd=False)
    while True:
        buf = sout.read1(1024)
        if len(buf) == 0: break
        print buf,

if __name__ == '__main__':
    __main__() 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-02-01T16:32:43.553

就我而言，我需要一个日志模块来捕获后台应用程序的输出并对其进行扩充（添加时间戳、颜色等）。

我最终得到了一个执行实际 I/O 的后台线程。以下代码仅适用于 POSIX 平台。我剥离了非必要的部分。

如果有人打算长期使用这个野兽，请考虑管理开放描述符。就我而言，这不是一个大问题。

```
# -*- python -*-
import fcntl
import threading
import sys, os, errno
import subprocess

class Logger(threading.Thread):
    def __init__(self, *modules):
        threading.Thread.__init__(self)
        try:
            from select import epoll, EPOLLIN
            self.__poll = epoll()
            self.__evt = EPOLLIN
            self.__to = -1
        except:
            from select import poll, POLLIN
            print 'epoll is not available'
            self.__poll = poll()
            self.__evt = POLLIN
            self.__to = 100
        self.__fds = {}
        self.daemon = True
        self.start()

    def run(self):
        while True:
            events = self.__poll.poll(self.__to)
            for fd, ev in events:
                if (ev&self.__evt) != self.__evt:
                    continue
                try:
                    self.__fds[fd].run()
                except Exception, e:
                    print e

    def add(self, fd, log):
        assert not self.__fds.has_key(fd)
        self.__fds[fd] = log
        self.__poll.register(fd, self.__evt)

class log:
    logger = Logger()

    def __init__(self, name):
        self.__name = name
        self.__piped = False

    def fileno(self):
        if self.__piped:
            return self.write
        self.read, self.write = os.pipe()
        fl = fcntl.fcntl(self.read, fcntl.F_GETFL)
        fcntl.fcntl(self.read, fcntl.F_SETFL, fl | os.O_NONBLOCK)
        self.fdRead = os.fdopen(self.read)
        self.logger.add(self.read, self)
        self.__piped = True
        return self.write

    def __run(self, line):
        self.chat(line, nl=False)

    def run(self):
        while True:
            try: line = self.fdRead.readline()
            except IOError, exc:
                if exc.errno == errno.EAGAIN:
                    return
                raise
            self.__run(line)

    def chat(self, line, nl=True):
        if nl: nl = '\n'
        else: nl = ''
        sys.stdout.write('[%s] %s%s' % (self.__name, line, nl))

def system(command, param=[], cwd=None, env=None, input=None, output=None):
    args = [command] + param
    p = subprocess.Popen(args, cwd=cwd, stdout=output, stderr=output, stdin=input, env=env, bufsize=0)
    p.wait()

ls = log('ls')
ls.chat('go')
system("ls", ['-l', '/'], output=ls)

date = log('date')
date.chat('go')
system("date", output=date) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-06-27T21:45:43.647

我的问题有点不同，因为我想从正在运行的进程中收集 stdout 和 stderr，但最终相同，因为我想在生成的小部件中呈现输出。

我不想求助于使用队列或其他线程的许多建议的解决方法，因为它们不应该是执行诸如运行另一个脚本和收集其输出这样的常见任务所必需的。

在阅读了建议的解决方案和 python 文档后，我通过下面的实现解决了我的问题。是的，它仅适用于 POSIX，因为我正在使用`select`函数调用。

我同意这些文档令人困惑，并且对于这样一个常见的脚本任务来说，实现起来很尴尬。我相信旧版本的 python 有不同的默认值`Popen`和不同的解释，所以造成了很多混乱。这似乎适用于 Python 2.7.12 和 3.5.2。

关键是设置`bufsize=1`行缓冲，然后`universal_newlines=True`作为文本文件而不是二进制文件进行处理，这似乎成为设置时的默认值`bufsize=1`。

```
class workerThread(QThread):
   def __init__(self, cmd):
      QThread.__init__(self)
      self.cmd = cmd
      self.result = None           ## return code
      self.error = None            ## flag indicates an error
      self.errorstr = ""           ## info message about the error

   def __del__(self):
      self.wait()
      DEBUG("Thread removed")

   def run(self):
      cmd_list = self.cmd.split(" ")   
      try:
         cmd = subprocess.Popen(cmd_list, bufsize=1, stdin=None
                                        , universal_newlines=True
                                        , stderr=subprocess.PIPE
                                        , stdout=subprocess.PIPE)
      except OSError:
         self.error = 1
         self.errorstr = "Failed to execute " + self.cmd
         ERROR(self.errorstr)
      finally:
         VERBOSE("task started...")
      import select
      while True:
         try:
            r,w,x = select.select([cmd.stdout, cmd.stderr],[],[])
            if cmd.stderr in r:
               line = cmd.stderr.readline()
               if line != "":
                  line = line.strip()
                  self.emit(SIGNAL("update_error(QString)"), line)
            if cmd.stdout in r:
               line = cmd.stdout.readline()
               if line == "":
                  break
               line = line.strip()
               self.emit(SIGNAL("update_output(QString)"), line)
         except IOError:
            pass
      cmd.wait()
      self.result = cmd.returncode
      if self.result < 0:
         self.error = 1
         self.errorstr = "Task terminated by signal " + str(self.result)
         ERROR(self.errorstr)
         return
      if self.result:
         self.error = 1
         self.errorstr = "exit code " + str(self.result)
         ERROR(self.errorstr)
         return
      return 
```

ERROR、DEBUG 和 VERBOSE 只是将输出打印到终端的宏。

恕我直言，该解决方案的效率为 99.99%，因为它仍然使用阻塞`readline`功能，因此我们假设子进程很好并且输出完整的行。

我欢迎提供反馈以改进解决方案，因为我还是 Python 新手。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2021-09-08T09:03:01.817

不是第一个也可能不是最后一个，我已经构建了一个包，它使用两种不同的方法进行非阻塞 stdout PIPE 读取，一种基于 JF Sebastian (@jfs) 的回答，另一种是简单的通信（ ) 使用线程循环以检查超时。

**两种标准输出捕获方法都经过测试，可在 Linux 和 Windows 下工作，截至撰写本文时，Python 版本从 2.7 到 3.9**

由于是非阻塞的，它保证了超时强制执行，即使有多个子进程和孙子进程，甚至在 Python 2.7 下也是如此。

该包还处理字节和文本标准输出编码，在尝试捕获 EOF 时是一场噩梦。

你可以在[https://github.com/netinvent/command_runner找到这个包](https://github.com/netinvent/command_runner)

如果您需要一些经过良好测试的非阻塞读取实现，请尝试一下（或破解代码）：

```
pip install command_runner

from command_runner import command_runner

exit_code, output = command_runner('ping 127.0.0.1', timeout=3)
exit_code, output = command_runner('echo hello world, shell=True)
exit_code, output = command_runner('some command', stdout='some_file') 
```

`_poll_process()`您可以在或`_monitor_process()`根据所采用的捕获方法找到核心非阻塞读取代码。从那里，你可以破解你想要的方式，或者只是使用整个包来执行你的命令作为子进程的替换。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-04-27T20:14:51.850

我创建了一个基于[JF Sebastian 解决方案](https://stackoverflow.com/a/4896288/242451)的库。你可以使用它。

[https://github.com/cenkalti/what](https://github.com/cenkalti/what)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-05-07T17:38:40.687

编辑：这个实现仍然阻塞。请改用 JFSebastian 的[答案](https://stackoverflow.com/a/4896288/2359288)。

~~我尝试了[最佳答案](https://stackoverflow.com/a/4896288/2359288)，但线程代码的额外风险和维护令人担忧。~~

~~浏览[io 模块](http://docs.python.org/2.6/library/io.html)（仅限于 2.6），我找到了 BufferedReader。这是我的无线程、非阻塞解决方案。~~

```
import io
from subprocess import PIPE, Popen

p = Popen(['myprogram.exe'], stdout=PIPE)

SLEEP_DELAY = 0.001

# Create an io.BufferedReader on the file descriptor for stdout
with io.open(p.stdout.fileno(), 'rb', closefd=False) as buffer:
  while p.poll() == None:
      time.sleep(SLEEP_DELAY)
      while '\n' in bufferedStdout.peek(bufferedStdout.buffer_size):
          line = buffer.readline()
          # do stuff with the line

  # Handle any remaining output after the process has ended
  while buffer.peek():
    line = buffer.readline()
    # do stuff with the line 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-10-31T10:09:25.853

根据 JF Sebastian 的回答和其他几个来源，我整理了一个简单的子流程管理器。它提供请求非阻塞读取，以及并行运行多个进程。它不使用任何特定于操作系统的调用（我知道），因此应该可以在任何地方工作。

它可以从 pypi 获得，所以只需`pip install shelljob`. 有关示例和完整文档，请参阅[项目页面](https://pypi.python.org/pypi/shelljob)。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2017-03-25T03:40:11.990

这是一个在子进程中运行交互式命令的示例，标准输出是使用伪终端进行交互的。可以参考：[https ://stackoverflow.com/a/43012138/3555925](https://stackoverflow.com/a/43012138/3555925)

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os
import sys
import select
import termios
import tty
import pty
from subprocess import Popen

command = 'bash'
# command = 'docker run -it --rm centos /bin/bash'.split()

# save original tty setting then set it to raw mode
old_tty = termios.tcgetattr(sys.stdin)
tty.setraw(sys.stdin.fileno())

# open pseudo-terminal to interact with subprocess
master_fd, slave_fd = pty.openpty()

# use os.setsid() make it run in a new process group, or bash job control will not be enabled
p = Popen(command,
          preexec_fn=os.setsid,
          stdin=slave_fd,
          stdout=slave_fd,
          stderr=slave_fd,
          universal_newlines=True)

while p.poll() is None:
    r, w, e = select.select([sys.stdin, master_fd], [], [])
    if sys.stdin in r:
        d = os.read(sys.stdin.fileno(), 10240)
        os.write(master_fd, d)
    elif master_fd in r:
        o = os.read(master_fd, 10240)
        if o:
            os.write(sys.stdout.fileno(), o)

# restore tty settings back
termios.tcsetattr(sys.stdin, termios.TCSADRAIN, old_tty) 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2017-10-02T20:55:47.083

该解决方案使用该`select`模块从 IO 流中“读取任何可用数据”。此功能最初会阻塞，直到数据可用，但随后仅读取可用的数据并且不会进一步阻塞。

鉴于它使用该`select`模块，这仅适用于 Unix。

该代码完全符合 PEP8。

```
import select

def read_available(input_stream, max_bytes=None):
    """
    Blocks until any data is available, then all available data is then read and returned.
    This function returns an empty string when end of stream is reached.

    Args:
        input_stream: The stream to read from.
        max_bytes (int|None): The maximum number of bytes to read. This function may return fewer bytes than this.

    Returns:
        str
    """
    # Prepare local variables
    input_streams = [input_stream]
    empty_list = []
    read_buffer = ""

    # Initially block for input using 'select'
    if len(select.select(input_streams, empty_list, empty_list)[0]) > 0:

        # Poll read-readiness using 'select'
        def select_func():
            return len(select.select(input_streams, empty_list, empty_list, 0)[0]) > 0

        # Create while function based on parameters
        if max_bytes is not None:
            def while_func():
                return (len(read_buffer) < max_bytes) and select_func()
        else:
            while_func = select_func

        while True:
            # Read single byte at a time
            read_data = input_stream.read(1)
            if len(read_data) == 0:
                # End of stream
                break
            # Append byte to string buffer
            read_buffer += read_data
            # Check if more data is available
            if not while_func():
                break

    # Return read buffer
    return read_buffer 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2018-04-07T07:54:10.750

我也遇到了[Jesse](https://stackoverflow.com/users/220256/jesse)描述的问题，并通过使用“选择”来解决它，就像[Bradley](https://stackoverflow.com/users/1220653/bradley-odell)、[Andy](https://stackoverflow.com/users/456552/andy-jackson)和其他人所做的那样，但在阻塞模式下避免了繁忙的循环。它使用虚拟管道作为假标准输入。选择块并等待标准输入或管道准备好。当一个键被按下时，标准输入解除阻塞选择，并且可以使用 read(1) 检索键值。当不同的线程写入管道时，管道会解除对选择的阻塞，这可以被视为对标准输入的需求已经结束的指示。这是一些参考代码：

```
import sys
import os
from select import select

# -------------------------------------------------------------------------    
# Set the pipe (fake stdin) to simulate a final key stroke
# which will unblock the select statement
readEnd, writeEnd = os.pipe()
readFile = os.fdopen(readEnd)
writeFile = os.fdopen(writeEnd, "w")

# -------------------------------------------------------------------------
def getKey():

    # Wait for stdin or pipe (fake stdin) to be ready
    dr,dw,de = select([sys.__stdin__, readFile], [], [])

    # If stdin is the one ready then read it and return value
    if sys.__stdin__ in dr:
        return sys.__stdin__.read(1)   # For Windows use ----> getch() from module msvcrt

    # Must finish
    else:
        return None

# -------------------------------------------------------------------------
def breakStdinRead():
    writeFile.write(' ')
    writeFile.flush()

# -------------------------------------------------------------------------
# MAIN CODE

# Get key stroke
key = getKey()

# Keyboard input
if key:
    # ... do your stuff with the key value

# Faked keystroke
else:
    # ... use of stdin finished

# -------------------------------------------------------------------------
# OTHER THREAD CODE

breakStdinRead() 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-12-07T14:13:37.497

试试[wexpect](https://pypi.org/project/wexpect/)，它是 pexpect 的 windows 替代[品](https://pexpect.readthedocs.io/en/stable/)。

```
import wexpect

p = wexpect.spawn('myprogram.exe')
p.stdout.readline('.')               // regex pattern of any character
output_str = p.after() 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2016-01-16T21:47:15.420

这是一个在python中支持非阻塞读取和后台写入的模块：

[https://pypi.python.org/pypi/python-nonblock](https://pypi.python.org/pypi/python-nonblock)

提供一个功能，

nonblock_read 将从流中读取数据（如果可用），否则返回空字符串（如果流在另一侧关闭并且已读取所有可能的数据，则返回 None）

你也可以考虑 python-subprocess2 模块，

[https://pypi.python.org/pypi/python-subprocess2](https://pypi.python.org/pypi/python-subprocess2)

它添加到子流程模块。因此，在从“subprocess.Popen”返回的对象上添加了一个附加方法，runInBackground。这将启动一个线程并返回一个对象，该对象将在将内容写入 stdout/stderr 时自动填充，而不会阻塞您的主线程。

享受！

# .net - 如何在自定义 WinForms 控件中限制客户端控制区域

> ID：375430
> 
> 赞同：1
> 
> 时间：2008-12-17T17:57:23.723
> 
> 标签：.net, winforms, layout, controls

我有一个自定义控件，它使用从 ParentControlDesigner 继承的设计器来允许删除子控件。我没有使用任何内部设计师，只是简单的单亲材料。

这个控件绘制了一个“标题”，所以我尝试做三件事：

1.  当设置为 Top 或 Fill 时，让子控件停靠在标题的底部而不是控件的顶部。

2.  使用鼠标拖动时，让子控件吸附到标题的底部，而不是控件的顶部。

3.  防止控件被拖到标题区域，句号（我觉得这可能是不可能的）。

(1) 是最重要的 - 我知道这是可能的，因为我已经看到其他控件可以做到这一点。(2) 也会有很大帮助。(3) 我不在乎那么多，如果有就好了。

有没有人能够为我指出如何实施这些规则的正确方向，**而**不必求助于笨拙的子面板和 InternalControlDesigner 方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-19T11:54:33.643

> 防止控件被拖到标题区域，句号（我觉得这可能是不可能的）

让控件（控件本身，而不是设计器）覆盖`Control.DisplayRectangle.get`可能有助于限制其子级。

# java - Java hprof 问题

> ID：375439
> 
> 赞同：7
> 
> 时间：2008-12-17T17:58:33.240
> 
> 标签：java, jvm, profiling

运行 java 类时使用 -agentlib:hprof=cpu=times 与 -agentlib:hprof=cpu=sample 有什么区别？我知道 cpu=sample 会导致 jvm 定期对调用堆栈进行采样，但是 cpu=times 有什么作用呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T18:15:55.840

`hprof=cpu=times`使分析器计算每个方法被调用的次数并测量每个方法花费的时间。

[在这里](http://docs.oracle.com/javase/7/docs/technotes/samples/hprof.html)阅读它（使用浏览器的查找功能：cpu=times）。

# sql-server - 如何在sql中连接两个字符串并用0填充一个字符串？

> ID：375449
> 
> 赞同：5
> 
> 时间：2008-12-17T18:01:00.817
> 
> 标签：sql-server, tsql

我在一个表中有两个字段。一个包含 BTA、BEA、REA 等值。另一个包含诸如 1,2,63,103 之类的值。

我想组合这两个字段，使它们看起来像 BTA001、BTA002、BTA063、BTA103。

请注意，如果数字的长度不是 3 个字符，我想在数字的左侧填充一些 0 以使其等于 3。

我该怎么做呢？表中的字段称为Type，对应BTA、BEA和REA，Id是对应1、2、63和103的字段。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T18:04:53.960

```
select Type + right('00' + cast(id as varchar(10)), 3)
from ... 
```

编辑：如果 id 可以为 null 并且您希望显示零，则可以执行以下操作：

```
select Type + right('00' + cast(isnull(id, 0) as varchar(10)), 3) 
from ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:06:34.877

选择 C1 + right(('000' + cast(C2 as nvarchar(10)),3) 作为

从 t1

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:07:14.970

选择 FIELD1 + RIGHT('000' + CONVERT(VARCHAR,FIELD2), 3)

# perl - 这种洗牌算法的效率和质量如何？

> ID：375450
> 
> 赞同：5
> 
> 时间：2008-12-17T18:01:43.733
> 
> 标签：perl, sorting, random, performance

最近这个关于[使用 C# 随机排序](https://stackoverflow.com/questions/375351/most-efficient-way-to-randomly-sort-shuffle-a-list-of-integers-in-c)的问题让我想到了我有时在 Perl 中对数组进行洗牌的方式。

```
@shuffled = sort { rand() <=> rand() } @array; 
```

上述问题中建议的解决方案是[Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)，它在线性时间内工作。

问题是：我的片段效率如何，这种随机播放“真的”是随机的吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T18:12:43.320

我不是 Perl 内部专家，所以我不知道“排序”在这里如何工作。但是，大多数排序函数都希望它们的比较具有一致性，如果函数本身是随机的，我希望它们会以不可预测的方式工作。不幸的是，不可预测性与随机性不同，所以我对你的洗牌数组没有信心。它可能倾向于将元素按某种顺序排列，就像仓促创建的复杂递归关系可能不是随机的一样。

我建议不要分析排序函数，而是使用 Fisher-Yates。

正如 Knuth 所说，随机性太重要了，不能靠运气。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-17T20:15:23.103

```
$ perldoc List::Util
⋮
  shuffle LIST
       Returns the elements of LIST in a random order

           @cards = shuffle 0..51      # 0..51 in a random order
⋮ 
```

那将是我的建议。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-17T18:15:04.500

我实际上有点惊讶你提出的洗牌工作。在 Perl`sort`函数的实现中，它尝试根据比较函数的值将数组的元素按升序排列。问题是，您的比较函数不会返回一致的答案！有时它可能会说`"foo" lt "bar"`，而其他时候它可能会说`"bar" lt "foo"`。这有可能将排序算法混淆到它永远不会终止，或者以致命错误或其他一些灾难性故障而终止的程度。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-17T19:22:25.830

perl 文档说明了`sort`这一点

> 比较功能需要表现。如果它返回不一致的结果（例如，有时说 $x[1] 小于 $x[2]，有时说相反），则结果定义不明确。

所以这样做是个坏主意。

ETA：我刚刚做了一个基准测试。在 100000 个元素的数组上，使用 FY-shuffle 也快 10 倍以上。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-17T19:49:09.287

一方面，您知道无论您使用什么比较器，sort() 都不可能比 O(n log n) 快。因此，即使它执行的 shuffle 是公平的，它的性能也会更差。

那么洗牌公平吗？对于某些（易于分析的）排序算法来说，这显然是不公平的。考虑一个简单的冒泡排序——为了让一个元素从一端移动到另一端，比较函数必须对 n 次连续调用评估为正值——对于应该是 n 中的 1 事件的概率为 2^n 中的 1。对于快速排序，很难分析，并且最终可能是公平的。但如果它是正确的很重要，那就以正确的方式去做。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-17T18:09:35.620

这只是直觉，但我认为使用这样的排序会产生一个集合，其顺序在某种程度上取决于原始集合的顺序。真正随机排序的结果根本不应该依赖于原始集合的顺序。我无法解释为什么/如何，也许其他人可以（或表明它实际上是随机的）？

至于它的效率如何，我不确定，但它可能不会比任何其他使用 AFAIK 的效率低很多`sort`，因为 AFAIK`rand()`相对便宜。不过，我可能错了。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-17T19:48:28.523

有一个更好的 Fisher-Yates shuffle 函数，它不使用[perlfaq4](http://faq.perl.org/perlfaq4.html)`sort`中的内置函数：How do I shuffle an array random? .

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-08T16:35:45.237

```
 @shuffled = map {
  $_->[1]
} sort {
  $a->[0] <=> $b->[0]
} map {
  [ rand(), $_ ]
} @array; 
```

# visual-studio - 所有这些 Visual Studio 2005 文件的用途是什么？

> ID：375453
> 
> 赞同：11
> 
> 时间：2008-12-17T18:03:11.577
> 
> 标签：visual-studio, visual-studio-2005, file-extension

我刚刚（重新）加入了一家公司，从事一些 C++ 项目。我正在查看这些文件，并试图弄清楚所有与 Visual Studio 相关的文件是什么。我怀疑很多都是以前版本的 IDE 中的孤儿。

我在下面列出了所有文件扩展名，并对我认为我理解的那些进行了注释。如果可以提供有关单个文件或它们不同文件之间关系的更多信息，我将不胜感激。我还想听听有关在某些版本控制系统下处理这些文件的建议（我们现在使用 Visual SourceSafe）。

.dsp - Developer Studio 项目（过时？）
.dsw - Developer Studio 工作区（过时？）
.ncb - 无编译浏览器文件（用于智能感知？）
.sln - 解决方案
.suo - 解决方案用户选项
.vcproj - VC++ 项目文件
.vcproj .$DOMAIN.$USER.user - 嗯？
.vcproj.vspscc - ?
.vsscc - ？
.vsscc - ？
.vc08 - ?
真正让我抓狂的是二进制文件而不是简单的文本文件。为什么 MS 如此讨厌文本文件？叹...

-cr

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-17T18:19:20.920

.dsp - 已过时
.dsw - 已过时
.ncb - 用于智能感知（不应在源代码管理中）
.sln - 解决方案
.suo - 解决方案用户选项（不应在源代码管理中）
.vcproj - VC++ 项目文件
.vcproj.$DOMAIN .$USER.user - 项目用户选项（不应在源代码控制中）
.vcproj.vspscc - 源代码控制文件
.vsscc - 源代码控制文件
.vssscc - 源代码控制文件

VSS = Visual Source Safe
SCC = 源代码控制（VS 中源代码控制插件架构的 TLA）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:06:11.290

vsscc 和 vssscc 与 Visual Source Safe 相关。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:19:10.310

正如您正确陈述的那样，.dsp 和 .dsw 文件是旧的 VC6 项目文件格式，并且在 VS2005 的上下文中已过时 - 好吧，一旦它们被转换。

.ncb 是智能感知数据库，.vcproj.$DOMAIN.$USER.user 文件包含用户特定的项目设置。不过不知道它们是什么——我只是注意到 VS2005 和 VS2008 都倾向于创建这些文件。

# sql - SQL 位运算

> ID：375455
> 
> 赞同：1
> 
> 时间：2008-12-17T18:03:30.983
> 
> 标签：sql, bit-manipulation, implication

我迷上了我正在创建的一种名为 VMAC 的新安全范例。可变矩阵访问控制。我想对位串做逻辑暗示。只是想避免 echoeureka （重新发明轮子）。

1.  在我重新发明轮子之前，是否有一个使用 AND 和 OR 和 NOT 或其他基本 SQL 二元运算符来模拟 ⇒ （逻辑暗示）的捷径？

2.  XNOR 允许我将 ⇒ 仿真减少到四个操作：NOT、XOR、OR 和 AND。但它并没有被广泛使用。任何已知的 XNOR 快捷方式？我正在考虑类似操作数的 AND 操作加上我头顶上的 NOTted 操作数。

3.  关于在 64 位平台上实现按位数据结构所实现的效率，或对使用并发线程在较大数据对象的字大小段上运行的多线程应用程序的速度有何评论？

（对不起，我不是计算机科学家）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:09:35.230

***如果 A 那么 B*** 在逻辑上等价于 ***（不是 A）或 B***

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T19:05:38.737

> 关于通过 0n 64 位平台实现按位数据结构实现的效率的任何评论 (3)？使用并发线程在较大数据对象的字大小段上运行的多线程应用程序的速度？

我个人没有多想，但[Raymond Chen](http://blogs.msdn.com/oldnewthing/archive/2008/11/26/9143050.aspx)有一些意见。

> 在考虑是否应将字段更改为位字段时，这些只是需要考虑的几件事。当然，位域可以节省数据内存，但您必须在代码大小、可调试性和减少多线程方面的成本之间取得平衡。如果你的类只被实例化几次（我认为“几次”不到几千次），那么这些成本很可能超过节省的成本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:13:57.640

如果您正在操作一个位字符串，那么

```
x -> y 
```

可以用 C/C++（或 SQL）表示为：

```
~x | y 
```

就速度而言，单个机器字上的位运算符非常快，因为它们是在单个算术 CPU 指令中实现的。与实际检索数据的工作相比，进行数学运算的性能影响几乎可以忽略不计。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-24T18:47:42.777

的定义`XNOR`是 A*B + !A*!B

因此在 SQL 中可以这样实现：

```
DECLARE @A AS BIT;
DECLARE @B AS BIT;

(@A & @B) | (~@A & ~@B) 
```

可以在这里找到另一种表示法：http: [//michaelmairegger.wordpress.com/2011/10/14/sql-nand-xnor/](http://michaelmairegger.wordpress.com/2011/10/14/sql-nand-xnor/)

# c# - 无法从 VBA 实例化用 C# 编写的 COM 对象（VB6 ok）

> ID：375457
> 
> 赞同：12
> 
> 时间：2008-12-17T18:04:24.770
> 
> 标签：c#, .net, vba, com, com-interop

使用 VS 2008，这是我的 COM 对象

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace TestCom
{    
    [Guid("9E5E5FB2-219D-4ee7-AB27-E4DBED8E123E")]
    [ClassInterface(ClassInterfaceType.AutoDual)]
    [ProgId("Test9.COMINT")]
    public class TestComClass  
    { 
        public void Init(string userid, string password)
        {
            MessageBox.Show(string.Format("{0}/{1}", userid, password));
        }       
    }
} 
```

如果我构建它并在生产机器上注册它，如下所示

```
REGASM /CODEBASE TESTCOM.DLL 
```

从一个简单的 VB6 应用程序可以正常工作

```
Private Sub Form_Load()
  Dim o As Object
  Set o = CreateObject("Test9.COMINT")
  o.Init "A", "B" 
End Sub 
```

在 Excel 中从 VBA 调用的完全相同的代码给出

> “自动化错误”（0x80131700）

在开发机器上一切正常，只是在安装了 .NET 和 MS Office 的生产机器上不行。

## 更新

我认为这与在 Excel 下运行时未正确初始化的 .NET 框架有关。如果我使用 Filemon，我可以看到它四处寻找 MSCORWKS.DLL。当我从 VBScript 调用同一个对象时，它发现 MSCorwks.dll 很好。

当我从 VBA 调用以尝试强制加载 CLR 时，有趣的是，我得到的结果与我在 VBA 中所做`CorBindToCurrentRunTime`的完全相同。`HRESULT (0x80131700)``CreateObject()`

因此我认为这是一个框架初始化问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-17T20:55:11.993

我将回答我自己的问题，希望能让其他人免去我刚刚忍受的乏味的苦差事。

如果你得到这个，那**是**因为基于 .NET 的 COM 程序集找不到 .NET 框架

解决方案很简单。创建一个包含以下内容的文件

```
<?xml version="1.0"?>
<configuration>
  <startup>
   <supportedRuntime version="v2.0.50727"/>
  </startup>
</configuration> 
```

将其命名为“Excel.Exe.Config”并将其放在与“EXCEL.EXE”相同的目录中

问题解决了！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-08T07:27:48.627

安装以下修复程序将解决此问题 [http://www.microsoft.com/downloads/details.aspx?FamilyID=1b0bfb35-c252-43cc-8a2a-6a64d6ac4670&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=1b0bfb35-c252-43cc-8a2a-6a64d6ac4670&displaylang=en)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T19:16:48.433

RC1，我使用您的 VBScript 代码和 Office 2007 的 Excel 中的代码对此进行了测试，一切正常。

由于您能够从 VB6 表单中创建 COM 对象，我们应该假设您的 .net 框架是可以的。你能排除VBA的问题吗？您可以创建一个 .vbs 文件并将其放入其中吗：

```
Dim o As Object  
Set o = CreateObject("Test9.COMINT")  
o.Init "A", "B" 
```

保存文件并双击它。如果您收到错误，那么我会认为它的注册存在问题，如果您没有收到错误，那么我会查看 Office 和 VBA 并查看是否缺少某些内容或未正确安装。

另一种选择是添加对 COM 对象的引用并使用早期绑定？我认为您可能需要先导出类型库，但您应该能够添加引用并简单地新建对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T18:37:25.610

这适用于我的 VBA...我使用 Word & Excel 2003 (SP3) 进行了尝试。

我不确定您所说的“生产”机器是什么意思。因为这是一个“客户端”应用程序，必须使用 Excel 在客户端上执行。

如果您在服务器上自动化 Excel 并通过 VBA 调用触发此“互操作”，那么您就是在自找麻烦 :)

假设通过生产，您的意思是用户将使用 Excel 模板/文档的客户端计算机，这些是以下指针：

1.  确保您拥有适当的 .Net 框架
2.  你有最新的 Office 服务包
3.  尝试确定这是否是权利问题。

如果您喜欢冒险，您可以使用进程资源管理器 [来自 Microsoft sysinternals 站点] 查看加载的 DLL 是什么以及您在哪里得到错误，并将其与您的开发框上的列表进行比较。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-23T15:27:04.177

rc1 是正确的，因为这**是**一个 .net 错误，当 Office 无法决定使用哪个版本的框架时抛出。然而，Office 并没有因为选择太多而摇摇欲坠。Office 2003 如何与.net 2.0 交互存在一个错误。

从 Microsoft ( [KB908002](http://support.microsoft.com/kb/908002/en-us) ) 安装修复程序是一种比强制 Excel 在特定版本的 .net 中运行更灵活的解决问题的方法。

另见： http: [//www.biopdf.com/guide/trouble_shoot_microsoft_office_2003.php](http://www.biopdf.com/guide/trouble_shoot_microsoft_office_2003.php)

# oracle - PL-SQL：从查询结果中获取列数据类型

> ID：375458
> 
> 赞同：5
> 
> 时间：2008-12-17T18:04:46.317
> 
> 标签：oracle, plsql

试图制作一个通用的 PL/SQL 程序以特定的 XML 格式导出数据，例如 Excel XML。假设该过程接受带有 SELECT 查询的字符串以立即执行。

这需要访问结果行集的每一列的数据类型，因为该过程是通用的，所以只有在运行查询后才知道这些数据类型。

我尝试了一种使用临时表的方法，但是对于编译表的过程必须存在并且在编译时知道其结构。

接下来如何处理 EXECUTE IMMEDIATE 结果的行和列，以分析每个值的类型并发出适当的 XML 片段？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T18:13:08.577

你不能用 EXECUTE IMMEDIATE 做到这一点。您将不得不使用更强大（也更复杂）的[DBMS_SQL 包](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_sql.htm#i1026120)- 我已将您链接到 DESCRIBE_COLUMNS 过程，该过程特别相关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T20:15:38.627

或查询 ALL_TAB_COLS 以获取列数据类型。

# algorithm - 如何从线形成多边形

> ID：375471
> 
> 赞同：1
> 
> 时间：2008-12-17T18:07:57.103
> 
> 标签：algorithm, geometry, polygon

我有一堆二维线，它们的起点和终点是已知的。这些线可能偶尔会相互交叉，或者一条线可能会在另一条线的中间结束。我需要从这个线网中形成多边形。如有必要，我可以确保所有线条的左侧都在它们的多边形内。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:25:42.060

您所描述的是我们所说的“包裹化”或“意大利面切割”，然后是我在 GeoVision 工作时的“多边形化”。基本上，您想在与其他线及其自身相交的任何地方切割线，然后您想通过遍历线/节点/线将它们组装成多边形，直到找到一个闭合的多边形。

# architecture - 领域层“呼出”到 UI 的最佳方式是什么

> ID：375472
> 
> 赞同：2
> 
> 时间：2008-12-17T18:07:57.947
> 
> 标签：architecture

当您的领域层或业务层（无论您想怎么称呼它）与您的 UI 完全分离时，它如何收集完成请求所需的信息？

例如，假设 UI 发出向采购订单添加行的请求，并且业务规则确定您出于某种原因需要授权代码。域层如何将其传达回来？返回某种响应代码，表明它需要授权？触发“需要授权”事件并查看是否有人响应？接受 UI 将实现的某种 IAuthorizationProvider 吗？

所有这些看起来都还不错，但我很难应对业务可能需要的大量可能的事情。继续采购订单示例，如果某些商品需要颜色怎么办？有些需要危险材料申报ID？有些人需要一个简单的“这很罕见，你确定吗？”。名单可以继续下去。感觉就像决定您需要此信息绝对属于域层。在非分层应用程序中，您只需弹出一个对话框并获得所需的内容。您如何在适当分层的应用程序中做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:29:57.340

“......业务规则确定您出于某种原因需要授权码。域层如何将其传达回来？”

这就是 API 的用途。你有几个选择。

1.  业务规则 API 简单地列出了业务规则所需的各种内容。UI 负责发出完整的请求。这些东西不是动态的。这不像业务规则是随机变化的。这种事情有版本控制。

2.  例外情况很好。该请求引发异常，因为它不完整。API 指定了异常以及如何使“完整”请求没有异常。

3.  AuthorizationProvider 的计划也不错。将定义 API 以阐明哪些请求执行了 AuthorizationProvider。

“我正在努力应对可能发生的事情的爆炸......这个清单可能会一直持续下去。” 实际上，它没有。只需定义适合问题域的适当 API。

如果——由于某种原因——你害怕你不能定义一个 API，那么你也不能定义问题。

“但是……”例如，一些有颜色或 MSDS 的物品呢？确认对话呢？

1.  颜色 - 或其他详细信息，如 MSDS。首先，模型具有“需要颜色”设置。UI 只是检查是否需要颜色对话框。这些只有有限的数量，所有这些都是您正在解决的问题的一部分，并且都可以列举出来。

2.  确认稀有事物。同样，业务规则具有“需要确认”属性或方法。UI 对此进行检查。这些只有有限的数量，所有这些都是您正在解决的问题的一部分，并且都可以列举出来。

你不会弹出一个新的对话框。使用单独的 UI 和业务规则，您现在可以做两件事：

*   将信息添加到业务规则中；
*   让 UI 检查弹出对话框。

您没有添加大量代码。业务规则属性是几行代码。UI 检查是一行代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:12:04.397

演示者或控制器，取决于您是否使用 MVC 或 MVP 应该知道它，而不是域，域将断言（防御性编码）是所有需要的值，或者抛出异常，而不是请求它。

所以假设你不提供数字，你的模型抛出一个 AuthorizationNumberRequiredException，然后你的演示者从那里处理它。因此，您的域与演示者没有耦合，它只是抛出错误，您的演示者必须知道如何处理它，但它不会重复逻辑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:12:23.553

某个地方的 UI 必须在某个时候将信息传递到业务层。无论您是否通过控制器等中间对象。业务层需要判断 PO 是否处于有效状态。如果不是，则返回说明问题所在的信息。这可以通过 PurchaseOrder.AddLineItem 方法调用或 PurchaseOrder.Validate 方法进行。我的偏好是从 PurchaseOrder.AddLineItem 方法返回验证信息，以便您可以确定对象状态在此处无效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T19:20:36.427

我做了更多的阅读，发现 Martin Fowler 的[Notification Pattern](http://www.martinfowler.com/eaaDev/Notification.html)似乎旨在解决这个问题，以及Jeremy Miller[的 Notification Pattern 的 Domain Centric Validation 。](http://codebetter.com/blogs/jeremy.miller/archive/2007/06/13/build-your-own-cab-part-9-domain-centric-validation-with-the-notification-pattern.aspx)

这是 Fowler 对 Notification 的描述，它几乎准确地描述了我正在寻找的内容：

> *一个对象，它在域层中收集有关错误和其他信息的信息并将其传达给表示。*

# ajax - 如何在 Catalyst 站点上使用多个 Template Toolkit TTSite 视图？

> ID：375474
> 
> 赞同：4
> 
> 时间：2008-12-17T18:09:27.600
> 
> 标签：ajax, perl, frameworks, catalyst, template-toolkit

我使用 Template Toolkit 在 Catalyst 中生成页面视图。为了做一些基本的 Ajax，我想让一些输出页面*不*使用 TTSite 样式，而是使用更基本的结构。我是否在 stash 中添加了一些特殊的东西来使用 .tt2 文件，而没有我的其余模板自动附带的页眉/页脚/等？（网站按照教程说明生成。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T18:34:14.727

啊哈，lib/projectname/View/TT.pm 有：

```
WRAPPER      => 'site/wrapper', 
```

在 root/lib/site/wrapper 中，我发现：

```
[% IF template.name.match('\.(css|js|txt)');
     debug("Passing page through as text: $template.name");
     content;
   ELSE;
     debug("Applying HTML page layout wrappers to $template.name\n");
     content WRAPPER site/html + site/layout;
   END;
-%] 
```

因此，如果我将我的非包装模板命名为 .txt，我可以避免使用站点/html + 站点/布局。

或者甚至更好，我可以制作一个 .ajax 扩展名并将其添加到传递模板列表中。

# asp.net-mvc - MVC Preview 5 和 IIS 5.1 的路由问题

> ID：375492
> 
> 赞同：1
> 
> 时间：2008-12-17T18:13:15.893
> 
> 标签：asp.net-mvc, model-view-controller, iis, routing, preview-5

好的，所以我花了几个小时试图解决这个问题，到目前为止还没有任何线索，继续收到相同的 404 错误。发生的情况是网站选择 Default.aspx 页面并按应有的方式显示它。但是主页有一个可点击的图像，它会路由到另一个视图页面。图像代码是这样的：

```
<a href="<%= Url.Action("SelectPage", "Home") %>" onmouseover="lightup('pic1')" onmouseout="turnoff('pic1') ">
                <img class="imageMain" src="<%= Url.Content("~/Content/Images/image.gif")%>" name="pic1" alt="Image 1" /></a> 
```

单击时，我收到 404 错误。

我的控制器视图设置如下：

```
public ActionResult SelectPage()
        {
            // Add action logic here
            ViewData["Title"] = "Select an option";
            ViewData["Header"] = "NoHeader";

            return View();
        } 
```

在我的全局文件中，我的路由设置如下：

```
routes.IgnoreRoute("{resource}.axd/{*pathInfo}");
routes.MapRoute(
               "Default",                                              // Route name
               "{controller}.aspx/{action}/{id}",                           // URL with parameters
               new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
           ); 
```

我试过通配符把戏，但没有运气我也试过这个教程 [http://www.asp.net/learn/mvc/tutorial-08-cs.aspx](http://www.asp.net/learn/mvc/tutorial-08-cs.aspx)仍然没有运气。

我不知道该去哪里获得任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T18:19:32.073

我注意到您发布的教程链接中有一些奇怪的地方。应取消选中验证文件存在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T07:48:17.517

Check out this post:

[http://www.ee99ee.com/blog/2009/02/08/how-to-get-aspnet-mvc-working-under-iis-51-on-windows-xp/](http://www.ee99ee.com/blog/2009/02/08/how-to-get-aspnet-mvc-working-under-iis-51-on-windows-xp/)

# sharepoint - SharePoint 权限 - 重复登录框

> ID：375498
> 
> 赞同：2
> 
> 时间：2008-12-17T18:14:20.040
> 
> 标签：sharepoint, permissions

我有一个通过标准 Windows 权限锁定的 SharePoint 网站。

我不断收到重复的登录框提示，它似乎与主题图像和 CSS 样式表有关。

[![替代文字](https://i.stack.imgur.com/dXRS0.png)](https://i.stack.imgur.com/dXRS0.png)
[（来源：[oscommerce-ssl.com](http://www.oscommerce-ssl.com/OGS_Authorization_Issues.png)）]

我需要在哪里更新权限，以便这些文件与站点的其余部分具有相同的权限，并且用户只需要登录一次？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-08T18:25:45.117

使用Web 检查工具[Fiddler](http://www.fiddler2.com/fiddler2/)，您实际上可以确定被拒绝的请求正在尝试访问哪些*域。*正如[Kinjal 所](https://stackoverflow.com/questions/375498/sharepoint-permissions-repeated-login-boxes/395005#395005)提到的，某些图像、css 或 javascript 请求可能正在尝试通过 ip 访问，而不是通过域名。

[MacGyver 的](https://stackoverflow.com/questions/375498/sharepoint-permissions-repeated-login-boxes/382123#382123)选项是可能的，尽管这只是掩盖了问题，因为仍在请求多个域（或访问同一域的方式），但是您通过缓存要使用的凭据来隐藏它。如果您是开发解决方案或管理服务器场的人，也不建议使用此解决方案，因为您（通常）不可能将此修补程序应用于网络中的*所有*计算机。

权限可能性（正如[Øyvind](https://stackoverflow.com/questions/375498/sharepoint-permissions-repeated-login-boxes/393998#393998)指出的那样）也应该通过检查哪些文件被拒绝，然后验证 App Pool 用户是否有权访问这些位置中的每一个来验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T13:42:34.743

在您收到 2（两次）提示的特定情况下，可能是第一次使用 IP 地址，第二次使用服务器名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T20:25:07.370

如果您正在运行 Windows XP，以下内容应该可以解决您的问题。

尝试使用存储的用户名和密码应用程序设置您的网络密码。

[http://support.microsoft.com/kb/306992](http://support.microsoft.com/kb/306992)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T17:06:46.453

如果您手动将源文件复制到 12 个 hive 文件夹，则可能会发生这种情况。在 Windows 资源管理器中打开该文件，并确认它与同一文件夹中的其他文件具有相同的 (NTLM) 安全设置。

# javascript - 从选择框中删除项目

> ID：375508
> 
> 赞同：272
> 
> 时间：2008-12-17T18:18:58.940
> 
> 标签：javascript, jquery, html, html-select

如何从选择框中删除项目或将项目添加到选择框中？我正在运行 jQuery，这是否会使任务更容易。下面是一个示例选择框。

```
<select name="selectBox" id="selectBox">
    <option value="option1">option1</option>
    <option value="option2">option2</option>
    <option value="option3">option3</option>
    <option value="option4">option4</option>    
</select> 
```

* * *

## 回答 #1

> 赞同：497
> 
> 时间：2008-12-17T18:41:12.780

删除一个选项：

```
$("#selectBox option[value='option1']").remove();
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<select name="selectBox" id="selectBox">
  <option value="option1">option1</option>
  <option value="option2">option2</option>
  <option value="option3">option3</option>
  <option value="option4">option4</option>	
</select>
```

添加一个选项：

```
$("#selectBox").append('<option value="option5">option5</option>');
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<select name="selectBox" id="selectBox">
  <option value="option1">option1</option>
  <option value="option2">option2</option>
  <option value="option3">option3</option>
  <option value="option4">option4</option>	
</select>
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2011-04-15T13:28:40.267

您可以使用以下方法删除所选项目：

```
$("#selectBox option:selected").remove(); 
```

如果您有一个列表而不是下拉列表，这将很有用。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-17T21:38:07.897

```
window.onload = function ()
{   
    var select = document.getElementById('selectBox');
    var delButton = document.getElementById('delete');

    function remove()
    {
        value = select.selectedIndex;
        select.removeChild(select[value]);
    }

    delButton.onclick = remove;    
} 
```

要添加项目，我将创建第二个选择框并：

```
var select2 = document.getElementById('selectBox2');
var addSelect = document.getElementById('addSelect');

function add()
{
    value1 = select2.selectedIndex;
    select.appendChild(select2[value1]);    
}

addSelect.onclick = add; 
```

虽然不是 jQuery。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2012-01-28T20:56:20.570

删除项目

```
$("select#mySelect option[value='option1']").remove(); 
```

添加项目

```
$("#mySelect").append('<option value="option1">Option</option>'); 
```

检查选项

```
$('#yourSelect option[value=yourValue]').length > 0; 
```

删除选定的选项

```
$('#mySelect :selected').remove(); 
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2012-01-19T11:09:38.007

这应该这样做：

```
$('#selectBox').empty(); 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2008-12-17T18:56:57.457

我发现 jQuery[选择框操作插件](http://www.texotela.co.uk/code/jquery/select/)对这类事情很有用。

您可以通过索引、值或正则表达式轻松删除项目。

```
removeOption(index/value/regex/array[, selectedOnly])

Remove an option by
- index: $("#myselect2").removeOption(0);
- value: $("#myselect").removeOption("Value");
- regular expression: $("#myselect").removeOption(/^val/i);
- array $("#myselect").removeOption(["myselect_1", "myselect_2"]); 
```

要删除所有选项，您可以执行`$("#myselect").removeOption(/./);`.

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-03-06T01:24:57.690

无需硬编码即可动态添加/删除值：

// 从选择中动态删除值

```
$("#id-select option[value='" + dynamicVal + "']").remove(); 
```

// 添加动态值以选择

```
$("#id-select").append('<option value="' + dynamicVal + '">' + dynamicVal + '</option>'); 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-12-17T18:34:22.013

我发现两个页面看起来很有帮助，它是为 ASP.Net 编写的，但同样的内容应该适用：

1.  [如何使用 jQuery 从下拉列表中添加/删除项目](http://codeleacher.wordpress.com/2008/12/09/how-to-addremove-items-from-a-dropdownlist-using-jquery/)
2.  [jQuery 选择器表达式](http://docs.jquery.com/Selectors)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-03-21T06:28:38.910

以下链接将有所帮助-

[http://api.jquery.com/remove/](http://api.jquery.com/remove/)

[http://api.jquery.com/append/](http://api.jquery.com/append/)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-07-17T14:40:04.330

只是为了让任何人都能看到这一点，您还可以：

```
$("#selectBox option[value='option1']").hide(); 
```

和

```
$("#selectBox option[value='option1']").show(); 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-06-05T01:47:48.807

### JavaScript

```
function removeOptionsByValue(selectBox, value)
{
  for (var i = selectBox.length - 1; i >= 0; --i) {
    if (selectBox[i].value == value) {
      selectBox.remove(i);
    }
  }
}

function addOption(selectBox, text, value, selected)
{
  selectBox.add(new Option(text, value || '', false, selected || false));
}

var selectBox = document.getElementById('selectBox');

removeOptionsByValue(selectBox, 'option3');
addOption(selectBox, 'option5', 'option5', true);
```

```
<select name="selectBox" id="selectBox">
    <option value="option1">option1</option>
    <option value="option2">option2</option>
    <option value="option3">option3</option>
    <option value="option4">option4</option>	
</select>
```

### jQuery

```
jQuery(function($) {
  $.fn.extend({
    remove_options: function(value) {
      return this.each(function() {
        $('> option', this)
          .filter(function() {
            return this.value == value;
          })
          .remove();
      });
    },
    add_option: function(text, value, selected) {
      return this.each(function() {
        $(this).append(new Option(text, value || '', false, selected || false));
      });
    }
  });
});

jQuery(function($) {
  $('#selectBox')
    .remove_options('option3')
    .add_option('option5', 'option5', true);
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<select name="selectBox" id="selectBox">
    <option value="option1">option1</option>
    <option value="option2">option2</option>
    <option value="option3">option3</option>
    <option value="option4">option4</option>	
</select>
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-04-27T18:10:20.570

我不得不从选择中删除第一个选项，没有 ID，只有一个类，所以我成功地使用了这段代码：

```
$('select.validation').find('option:first').remove(); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-03-16T11:19:48.883

```
 $("#selectBox option[value='option1']").remove();
$("#selectBox").append('<option value="option1">Option</option>');
```

```
 when you want to totally remove and add option from select box then you can use this code

<select name="selectBox" id="selectBox">
<option value="option1">option1</option>
<option value="option2">option2</option>
<option value="option3">option3</option>
<option value="option4">option4</option>    
</select>
```

```
 $("#selectBox option[value='option1']").hide();
 $("#selectBox option[value='option1']").show();
```

```
sometime we need to hide and show option from select box , but not remove then you can use this code

<select name="selectBox" id="selectBox">
<option value="option1">option1</option>
<option value="option2">option2</option>
<option value="option3">option3</option>
<option value="option4">option4</option>    
</select>
```

```
$('#selectBox :selected').remove();
$("#selectBox option:selected").remove();
```

```
sometime need to remove selected option from select box then

<select name="selectBox" id="selectBox">
<option value="option1">option1</option>
<option value="option2">option2</option>
<option value="option3">option3</option>
<option value="option4">option4</option>    
</select>
```

```
('#selectBox').empty();
```

```
when you need to remove all option then this code

<select name="selectBox" id="selectBox">
<option value="option1">option1</option>
<option value="option2">option2</option>
<option value="option3">option3</option>
<option value="option4">option4</option>    
</select>
```

```
$('#selectBox').find('option:first').remove();
$('#selectBox').find('option:last').remove();
```

```
when need to first option or last then this code

<select name="selectBox" id="selectBox">
<option value="option1">option1</option>
<option value="option2">option2</option>
<option value="option3">option3</option>
<option value="option4">option4</option>    
</select>
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-10-29T10:15:52.173

我只是想建议另一种添加`option`. 除了将`value`and设置`text`为字符串之外，还可以执行以下操作：

```
var option = $('<option/>')
                  .val('option5')
                  .text('option5');

$('#selectBox').append(option); 
```

在动态添加选项的值和文本时，这是一种不易出错的解决方案。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-09-14T17:50:23.730

如果有人需要删除选择中的**所有**选项，我做了一个小功能。

希望对你有帮助

```
var removeAllOptionsSelect = function(element_class_or_id){
    var element = $(element_class_or_id+" option");
    $.each(element,function(i,v){
        value = v.value;
        $(element_class_or_id+" option[value="+value+"]").remove(); 
    })
} 
```

只需要跑

```
removeAllOptionsSelect("#contenedor_modelos"); 
```

# sharepoint - Sharepoint Webpart 安全异常

> ID：375512
> 
> 赞同：2
> 
> 时间：2008-12-17T18:19:30.077
> 
> 标签：sharepoint, sharepoint-2007, web-parts

我有一个引发以下异常的自定义共享点 Web 部件：

```
System.Security.SecurityException: Request for the permission of type 'Microsoft.SharePoint.Security.SharePointPermission, Microsoft.SharePoint.Security, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c' failed.
   at Microsoft.SharePoint.SPSecurity.RunWithElevatedPrivileges(CodeToRunElevated secureCode)
   at Waverly.SharePoint.Features.WebParts.SearchesListWebPart.Render(HtmlTextWriter writer)
The action that failed was:
Demand
The type of the first permission that failed was:
Microsoft.SharePoint.Security.SharePointPermission
The Zone of the assembly that failed was:
MyComputer 
```

我的理论是 Sharepoint 没有运行 Web 部件的信任级别，但我很难弄清楚如何调试这个问题。有人有调试这样的经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T18:25:20.017

您有几种选择。首先是将您的程序集安装到 GAC 中。然后它将获得完全信任，但您必须将其安装在 GAC 中，对其进行强命名等。第二个选项是进入 web.config 并将其添加到受信任列表中。[这篇文章](http://msdn.microsoft.com/en-us/library/ms916855.aspx)和[这篇](http://msdn.microsoft.com/en-us/library/ms452873.aspx)文章将帮助你走上这条路。

第三个选项是将您的程序集放在 C:\inetpub\wwwroot\wss\VirtualDirectories[port]_app_bin 文件夹中。这是在全局 SharePoint 配置中设置的，以完全信任其中的任何程序集。您可能想先尝试一下，看看它是否有帮助，如果有帮助，请使用其他两种方法之一（因为从技术上讲，这是一个未记录的功能，可以更改）

编辑：好的，您可以尝试几件事。尝试提高整体信任级别，如[本文](http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/752bef14-5ea4-481d-ba37-cf49237f3c4c/)所示。基本上寻找：

<trust level="Full" originUrl="" />

如果可行，则表明您依赖的 DLL 不受信任。请注意，您不希望将其保留为完全信任级别，因为这意味着任何 Web 部件都具有完全信任。

这有帮助吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-30T07:05:33.323

这太疯狂了。我无法在 Web 部件中执行以下行：

```
using (SPSite site = new SPSite(parentWebUrl)) 
```

但是我可以不使用 Web 部件来执行它。

尽管 DLL 在 GAC 中，但它给我带来了类似的异常，并且被添加到了安全控件中。

```
Exception: SecurityException
Message: Request failed.
Action: System.Security.Permissions.SecurityAction.Demand
Some stack trace:
    at Microsoft.SharePoint.SPWeb.SPWebConstructor(SPSite site, String url, Boolean bExactWebUrl, SPRequest request)
    at Microsoft.SharePoint.SPWeb..ctor(SPSite site, String url, Boolean bExactWebUrl)
    at Microsoft.SharePoint.SPSite.OpenWeb()
    at .... 
```

它还说

```
((System.Security.SecurityException)($exception)).Demanded
((System.Security.SecurityException)($exception)).DenySetInstance
((System.Security.SecurityException)($exception)).FailedAssemblyInfo
((System.Security.SecurityException)($exception)).FirstPermissionThatFailed
((System.Security.SecurityException)($exception)).GrantedSet 
```

抛出异常。

那有什么问题？

# 解决方案

事实证明，由于 webpart 构造函数中发生了各种操作，因此发生很多次这样的错误。您几乎无法与那里的 SharePoint 对象模型进行交互。

将代码移到其他地方，它可以工作。我将我的代码移动到 CreateChildControls 并且它有效。

# dynamic - 如何使用 ASP.NET 从动态创建的 FileUpload 控件上传文件？

> ID：375518
> 
> 赞同：0
> 
> 时间：2008-12-17T18:21:20.930
> 
> 标签：dynamic, file-upload, viewstate

在下面附加的代码中，我试图通过 ASP.NET 上传文件。我正在动态创建 FileUpload 控件，这意味着它不在我的 ViewState 中，这（我认为）意味着我不能使用该控件来上传文件，除非我使用我不想使用的老式 multipat/form-data 方式做。我需要能够允许用户创建多个 FileUpload 字段，然后当他们单击 Upload File(s) 按钮时，它会遍历所有 FileUpload 字段并将它们上传到服务器。

我敢肯定有一种方法可以做到这一点，我只是没有想到 - TIA！

```
<%@ Page Language="VB" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<script runat="server">

    Protected Sub btnAdd_Click(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim fup As New FileUpload()
        fup.ID = "FileUpload1"

        PlaceHolder1.Controls.Add(fup)
    End Sub

    Protected Sub btnUploadFile_Click(ByVal sender As Object, ByVal e As System.EventArgs)
        ' HOW DO I GET THE FILE THAT WAS SELECTED IN THE DYNAMICALLY CREATE FILEUPLOAD CONTROL?
    End Sub
</script>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
    <div style="padding:13px">
        <asp:Button ID="btnAdd" runat="server" Text="Add FileUpload Control" OnClick="btnAdd_Click" />
        <br /><br />
        <asp:PlaceHolder ID="PlaceHolder1" runat="server" />
        <br /><br />
        <asp:Button ID="btnUploadFile" runat="server" Text="Upload File(s)" OnClick="btnUploadFile_Click" />
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:27:15.210

您可以使用 Request.Files

它包含上传的文件作为 HttpPostedFile 对象。

```
foreach(HttpPostedFile file in Request.Files)
  file.SaveAs(...); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:54:56.400

这是上述内容的更长版本：C#

```
print("HttpFileCollection UploadedFiles = Request.Files;
  HttpPostedFile UserPostedFile;
  int UploadFileCount = UploadedFiles.Count;
  if (UploadFileCount >= 1)
  {
    for (int i = 0; i < UploadFileCount; ++i)
    {
      UserPostedFile = UploadedFiles[i];
      UserPostedFile.SaveAs(UserPostedFile.FileName);
    }
  }"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T18:46:56.793

问题是 FileUpload 控件已锁定 FileName 参数，无法以编程方式设置。这样做的原因是为了保护用户免受某些恶意脚本的影响，该脚本决定将系统文件上传到服务器而不是用户想要的。

在上述情况下，您将无法使用 FileUpload 控件，您需要寻找替代方法。

# rdf - SPARQL 查询 - 类和子类给出类名和命名空间

> ID：375520
> 
> 赞同：1
> 
> 时间：2008-12-17T18:22:18.400
> 
> 标签：rdf, semantic-web, sparql, owl, ontology

在给定类名和命名空间的情况下，如何使用 SPARQL 查询从 RDF 数据源中获取所有类属性及其子类的属性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-11T22:24:12.553

[这个](http://dbpedia.org/snorql/?query=%0D%0ASELECT+%3FsubClass%2C+%3Fpredicate+%0D%0AWHERE+%7B%0D%0A+++%3FsubClass+rdfs%3AsubClassOf+%3Chttp%3A%2F%2Fdbpedia.org%2Fontology%2FWork%3E+.%0D%0A+++%3Fpredicate+rdfs%3Adomain+%3FsubClass%0D%0A%7D)怎么样：

```
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?subClass ?predicate 
WHERE {
   ?subClass rdfs:subClassOf <http://dbpedia.org/ontology/Work> .
   ?predicate rdfs:domain ?subClass
} 
```

尝试使用 SPARQL 工具，例如[DBPedia 的 SNORQL 接口](http://dbpedia.org/snorql/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-29T01:53:08.603

您是否尝试执行递归 SPARQL 查询？换句话说，选择给定的个人及其所有属性。如果属性的对象是另一个个体，则选择其属性，依此类推。

我不相信 SPARQL 支持这一点。

天真的方法是做这样的事情（并且，假设你的意思是个人而不是类，这实际上符合你的要求，但不处理下一个“级别”的三元组）。

```
CONSTRUCT {
    ?s ?p ?o .
    ?o ?p2 ?o2 .
} WHERE {
    ?s ?p ?o .
    ?o ?p2 ?o2 .
} 
```

请注意，如果`?o2`是任何语句的主题，则此查询不会返回它们。

# asp.net - 如何测试 ASP.NET 成员密码是否满足配置的复杂性要求？

> ID：375524
> 
> 赞同：20
> 
> 时间：2008-12-17T18:23:18.273
> 
> 标签：asp.net, security, membership

我有一个 ASP.NET 页面，它允许管理员更改用户的密码。由于管理员不知道用户的密码，我正在使用以下内容：

```
MembershipUser member = Membership.GetUser(_usernameTextBox.Text);
member.ChangePassword(member.ResetPassword(), _passNewTextBox.Text); 
```

- 正如这个[SO 问题](https://stackoverflow.com/questions/287320/how-do-you-change-a-hashed-password-using-aspnet-membership-provider-if-you-don)所描述的。

如果新密码不符合 web.config 文件中配置的复杂性要求，则密码将被重置，但不会更改为所需的密码。如果新密码不满足复杂性要求，则根本不应该更改密码。

是否有一种简单的方法可以根据复杂性要求测试新密码？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-22T11:47:01.107

```
/// <summary>
/// Checks password complexity requirements for the actual membership provider
/// </summary>
/// <param name="password">password to check</param>
/// <returns>true if the password meets the req. complexity</returns>
static public bool CheckPasswordComplexity(string password)
{
    return CheckPasswordComplexity(Membership.Provider, password);
}

/// <summary>
/// Checks password complexity requirements for the given membership provider
/// </summary>
/// <param name="membershipProvider">membership provider</param>
/// <param name="password">password to check</param>
/// <returns>true if the password meets the req. complexity</returns>
static public bool CheckPasswordComplexity(MembershipProvider membershipProvider, string password)
{
    if (string.IsNullOrEmpty(password)) return false;
    if (password.Length < membershipProvider.MinRequiredPasswordLength) return false;
    int nonAlnumCount = 0;
    for (int i = 0; i < password.Length; i++)
    {
        if (!char.IsLetterOrDigit(password, i)) nonAlnumCount++;
    }
    if (nonAlnumCount < membershipProvider.MinRequiredNonAlphanumericCharacters) return false;
    if (!string.IsNullOrEmpty(membershipProvider.PasswordStrengthRegularExpression) &&
        !Regex.IsMatch(password, membershipProvider.PasswordStrengthRegularExpression))
    {
        return false;
    }
    return true;
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-17T18:28:17.110

您可以使用以下属性来测试密码：

*   [Membership.PasswordStrengthRegularExpression](http://msdn.microsoft.com/en-us/library/system.web.security.membership.passwordstrengthregularexpression.aspx)
*   [Membership.MinRequiredPasswordLength](http://msdn.microsoft.com/en-us/library/system.web.security.membership.minrequiredpasswordlength.aspx)
*   [Membership.MinRequiredNonAlphanumericCharacters](http://msdn.microsoft.com/en-us/library/system.web.security.membership.minrequirednonalphanumericcharacters.aspx)

请注意，如果您尚未在 web.config 文件中配置 PasswordStrengthRegularExpression 属性，它将是一个空字符串。

有关正则表达式匹配的信息，请参阅[Regex.IsMatch(String)上的 MSDN 参考](http://msdn.microsoft.com/en-us/library/3y21t6y4.aspx)

*感谢马特的有用评论。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-08T22:02:53.137

我无权访问维基。

应该调整一行以修复一个小错误。

修改 if (nonAlnumCount < Membership.MinRequiredNonAlphanumericCharacters) 如下 if (nonAlnumCount <membershipProvider.MinRequiredNonAlphanumericCharacters)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-10-02T16:59:49.867

基于Bamba的解决方案，我决定在会员提供者上做一个扩展方法（并减少代码：

```
 public static bool IsPasswordValid(this MembershipProvider membershipProvider, string password)
    {
        return (!string.IsNullOrEmpty(password) && // Password is not empty or null AND
            password.Length >= membershipProvider.MinRequiredPasswordLength && // Meets required length AND
            password.Count(c => !char.IsLetterOrDigit(c)) >= membershipProvider.MinRequiredNonAlphanumericCharacters && // Contains enough non-alphanumeric characters AND
            (string.IsNullOrEmpty(membershipProvider.PasswordStrengthRegularExpression) || // Either there is no RegEx requirement OR
                Regex.IsMatch(password, membershipProvider.PasswordStrengthRegularExpression))); // It matches the RegEx
    } 
```

要使用它，您只需`Membership.Provider.IsPasswordValid(...)`在需要的地方调用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T18:26:41.123

您可以使用正则表达式验证器来检查密码是否满足复杂性要求。

您也可以使用[密码强度计](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/PasswordStrength/PasswordStrength.aspx)控件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T18:27:31.603

这可能不是最简单的方法，但在页面上使用正则表达式验证器并使其符合密码要求。这样，如果密码不好，您甚至不必回帖。

# javascript - 拖放和可排序jquery插件之间的冲突

> ID：375525
> 
> 赞同：5
> 
> 时间：2008-12-17T18:23:21.490
> 
> 标签：javascript, jquery, html

我在尝试混合这些插件时遇到了冲突，我在一些演示中基于我的脚本。问题是，当我在同一个列表中拖动某些内容时，它会触发放置事件，并且该项目被添加到列表的末尾，如果该项目被放置在另一个列表中，这是正确的，但当我放下时，不一​​样它在同一个列表中我想将它插入到那个位置（如果我禁用 drop 事件它会起作用）

js代码：

```
$(document).ready(function() {
      $("#sortlist1").treeview();
      $("#sortlist1").droppable({  
        accept: ".item",  
        drop: function(ev, ui) {
            alert(ui.sender)
            $("#sortlist1").append($(ui.draggable));     
        } 
      });  
      $("#sortlist2").droppable({  
            accept: ".item",
            drop: function(ev, ui) {
                $("#sortlist2").append($(ui.draggable));  
            }  
          });
      $("#sortlist3").droppable({  
            accept: ".item",  
            drop: function(ev, ui) {
                $("#sortlist3").append($(ui.draggable));  
            }  
          });
      $('.sortlist').sortable({
          handle : '.icono',
          update : function () {
              $('input#sortlist').val($('.sortlist').sortable('serialize'));
          }
        });
    }); 
```

和html：

```
<ul class="sortlist treeview lista" id="sortlist1">
        <li id="listItem_1" class="expandable closed item">
            <div class="hitarea closed-hitarea expandable-hitarea lastExpandable-hitarea">
                <img src="img/arrow_out.png" class="icono" alt="move" />
            </div>
            numero 1<input type="checkbox" />
            <ul class="sortlist" id="sublist">
                <li id="sublistItem_1"><img src="img/arrow_out.png" class="icono" alt="move" />numero 1<input type="checkbox" /></li>
                <li id="sublistItem_2"><img src="img/arrow_out.png" class="icono" alt="move" />numero 2<input type="checkbox" /></li>
            </ul>
        </li>
        <li id="listItem_2" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 2<input type="checkbox" /></li>
        <li id="listItem_3" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 3<input type="checkbox" /></li>
        <li id="listItem_4" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 4<input type="checkbox" /></li>
        <li id="listItem_5" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 5<input type="checkbox" /></li>
        <li id="listItem_6" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 6<input type="checkbox" /></li>
        <li id="listItem_7" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 7<input type="checkbox" /></li>
        <li id="listItem_8" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 8<input type="checkbox" /></li>
        <li id="listItem_9" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 9<input type="checkbox" /></li>
        <li id="listItem_10" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 10<input type="checkbox" /></li>
        <li id="listItem_11" class="item"><img src="img/arrow_out.png" class="icono" alt="move" />numero 11<input type="checkbox" /></li>
  </ul>
  <ul class="sortlist treeview lista" id="sortlist2">
  </ul>
  <ul class="sortlist treeview lista" id="sortlist3">
  </ul> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T20:52:37.460

您不能混合使用这些插件：它们处理相同的事件，并且不能一起协作。要么重新考虑你的 UI，要么使用不同的工具。

有可能做到吗？是的当然。例如，[Dojo DnD](http://docs.dojocampus.org/dojo/dnd)只允许使用一个组件进行排序和拖放：[test_dnd.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojo/tests/dnd/test_dnd.html)（链接到调试服务器）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-15T20:57:25.593

你可以这样做，有点。

在每个项目中创建两个链接以用作句柄。

使列表可按一个句柄排序。

使列表可由另一个手柄拖动。

现在，当您抓住一个或另一个手柄时，只会激活一个插件，并且会正确处理事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-05T15:01:04.653

如果要将元素从一个列表移动到另一个列表，`<li>`只需使用`connectWith`. `sortable()`只需查看文档即可。

# php - 除了 Haxe 之外，还有没有针对 PHP 的编程语言？

> ID：375542
> 
> 赞同：9
> 
> 时间：2008-12-17T18:28:21.667
> 
> 标签：php, programming-languages

PHP 并没有得到太多的喜爱，但仍然是易于部署的赢家（对于廉价托管）。

是否有任何针对 PHP 的编程语言（除了[Haxe ）？](http://haxe.org/)用这种语言编写应用程序，然后将其翻译成 PHP，就像某些语言以 C 作为中间语言一样？

*   [Scheme](http://en.wikipedia.org/wiki/Scheme_(programming_language))实现[Chicken](http://www.call-with-current-continuation.org/)编译成 [C](http://en.wikipedia.org/wiki/C_programming_language)。
*   [XOTcl](http://macroexpand.org/doku.php/txl:projects:java2tcl:start)将[Java](http://en.wikipedia.org/wiki/Java_(programming_language))代码转换为[Tcl](http://www.tcl.tk/)代码
*   LINJ 是（？）一个将 Lisp 转换为漂亮的 Java 代码的工具
*   …</li>

+ 很多在不接触 JavaScript的情况下生成[JavaScript的方法。](http://en.wikipedia.org/wiki/Javascript)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-01-16T23:01:39.117

[Pharen](http://github.com/scriptor/pharen)，一个 Lisp 变体。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-18T13:01:59.327

基拉 [http://www.mathgladiator.com/projects/kira/](http://www.mathgladiator.com/projects/kira/)

**编辑：**项目停止。新版本现在不再针对 PHP。新项目是 C# 的 Web 框架。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-23T17:52:21.613

[PIL - 平台无关语言](http://pil-lang.org/)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-10-20T06:21:54.977

为什么？

php 到 v 3.0 几乎是一个破解 html 的实用程序，4.0 版是 Perl 或任何其他脚本语言的一个非常不错的替代品。5.0 及更高版本是一种成熟的面向对象语言，能够优雅高效地解决许多问题。

'array()' 结构在使用整数下标时表现得像一个数组，而在你使用字符串下标时表现得像一个哈希，这是迄今为止我在任何语言中看到的最优雅且易于使用的集合处理机制。哈希数组、数组哈希、对象数组、嵌套树结构都是通过直接编码实现的，无需特殊的 API 或声明。

借助 v5.0 中的“批处理”界面，我预测 php 即将脱离 web/html 贫民窟并进入更广泛的用途。

# java - 使用 Joda-Time 有什么缺点吗？

> ID：375544
> 
> 赞同：58
> 
> 时间：2008-12-17T18:29:47.450
> 
> 标签：java, jodatime

我想说服架构经理在我们的产品中包含[Joda-Time](http://www.joda.org/joda-time/) jar。

你知道使用它有什么缺点吗？

我认为 Joda-Time 需要不断更新，因为它包含的文件。这是一个缺点。也许我错了。

您能否就该主题提供一些说明？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-17T19:49:50.393

我对 Joda Time 的体验几乎完全是积极的。我的一个问题是在尝试构建自己的时区时（出于正当原因，我向您保证 :) 我遇到了一些非常奇怪的异常，并且文档对于该特定用例并不是很好。

然而，在大多数情况下，使用它是一种乐趣——不变性使代码更容易推理，并且格式化程序的线程安全非常有用。

是的，有些文件需要保持最新——但至少你*可以*让它们保持最新。这并不是说它们包含 Java 内置的东西不需要的东西，只是使用 Java 的机制，如果没有重大的黑客攻击，你就无法保持时区等信息是最新的！

基本上，+1 用于使用 Joda Time。Java 日期/时间 API 是 Java 平台 IMO 中最糟糕的部分之一。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-11-02T23:08:57.043

在我看来，Joda-Time 最重要的缺点是精度：许多数据库以[微秒](https://en.wikipedia.org/wiki/Microsecond)（甚至[纳秒](https://en.wikipedia.org/wiki/Nanosecond)）精度存储时间戳。Joda-time 只到[毫秒](https://en.wikipedia.org/wiki/Millisecond)。这对我来说是不可接受的：我使用的所有“数据模型”类都需要反映数据库中数据的完整精度。图书馆对我的数据的近似或截断只是不削减它。

以下是选择毫秒精度背后的原因，取自[JSR 310](https://jcp.org/en/jsr/detail?id=310)邮件列表：

> *“Joda-Time 选择使用毫秒，因为它可以更轻松地转换为日期和日历。”* - S.科尔伯恩

对谁更容易？该库的作者会假设...在我看来，当几乎所有数据库都将时间存储到微秒/纳秒精度时，设计决策不正确。对数据库值的忽视令人担忧。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-17T18:46:58.587

我们在使用 Joda Time 时遇到的最大问题是与 Spring 和 Tapestry 的集成，因为它们都想使用内置的日期和时间。我们经常在 getter/setter 中为日期和时间编写包装器：要么我们将其存储为 Joda Time，一组 getter/setter 传递它，另一组即时转换，一些类在内部将其存储为 Java日期/时间，Joda getter/setter 必须即时切换它。

基本上，这是一个令人头疼的问题，因为这些类的名称相似，除非您可以让您的整个架构（包括您正在集成的其他库）切换到 Joda Time，否则您将编写比您可能保存的更多的包装器代码通过使用 Joda 库。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-29T14:50:59.673

Parleys 主持[了 Stephen Colebourne 关于 JSR-310 的演讲，Colebourne](http://www.parleys.com/#st=5&id=100&sl=1)先生是 Joda-Time 和 JSR-310 的作者。他首先解释了 Java 中标准日期/时间支持的弱点以及为什么要使用替代方案。将此演示文稿展示给您的架构经理可能会有所帮助。我似乎无法深层链接

Joda-Time 经常更新其时区文件的原因是因为时区数据一直在变化，通常是在短时间内（今天在 slashdot：[leap second added on 2008-12-31](http://news.slashdot.org/article.pl?sid=08/12/29/0216214)）并且并不总是出于科学动机（例如，我记得一些太平洋岛国改变了时区，成为第一个进入 2000 年的国家）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-17T18:40:44.900

过去，我遇到过不想包含第三方开源软件的公司，或者至少要求公司律师证明许可证不会让他们承担任何责任或病毒传播对其产品的影响。

与任何第三方库一样，您可能应该将其放入源代码管理中，以便在出现问题时可以找到与特定版本的代码一起发布的版本。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-18T04:15:18.033

为基础时间连续体选择毫秒有利于实现古代日历和特殊日历。与许多计数器不同，64 位毫秒计数器对古代日历具有良好的范围覆盖，具有超过 +/- 2.6 亿年的翻转特性。

它不处理闰秒。这是一件好事。原子钟人员提出了一种平滑过渡，以允许未部署闰秒的系统在 100 秒内逐步调整其时钟以适应闰秒校正。

时区表的维护也将是一个问题。

底层连续统一体还允许使用古老的法国日历和时钟，将一天分为 10 个间隔，称为公制时间，而不是 24 小时。经典的中国历法将一天分为 100 个增量，每个增量仅超过 14 分钟。所有这些日历都可以在底层毫秒时间连续体上实施和协调。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-01T06:55:09.247

它的主要问题是供应商锁定，至少在它成为标准的一部分之前。

在大多数情况下，我会使用 long 将任何业务日期信息存储在数据库中。这使我可以灵活地调整我认为合适的精度。在大多数情况下，我只是将它们转换为 java.util.Date。

我将时区视为演示级别问题而不是数据问题。这简化了数据库并增加了可移植性，因为数据库可以以不同的方式表示时间。

标准 Calendar 类为我提供了一些日期操作函数，我将它们转换为自纪元数据以来的毫秒数。

至于纳秒精度，我会将其存储为从 0 开始的偏移量作为单独的长列。

# apache - Hiawatha 和 Apache 上的 CGI 后期处理差异

> ID：375547
> 
> 赞同：0
> 
> 时间：2008-12-17T18:30:48.040
> 
> 标签：apache, post, cgi, common-lisp, hiawatha

我正在尝试建立一个轻量级的开发环境以允许在 Common Lisp 中直接使用 CGI，并且我想使用 Hiawatha 而不是更大的 Apache。我有适用于 Apache 中的 GET 和 POST 的代码，但仅适用于 Hiawatha 中的 GET；Apache 和 Hiawatha 处理 POST 的方式有什么不同吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T18:33:53.200

[CGI 规范](http://hoohoo.ncsa.uiuc.edu/cgi/interface.html)仅指定 POST 数据应使用程序的 发送到 CGI 脚本，`STDIN`而不是在环境变量中发送的 GET `QUERY_STRING`。

# c# - API 设计：公开 XML 或对象 #2

> ID：375548
> 
> 赞同：2
> 
> 时间：2008-12-17T18:30:55.543
> 
> 标签：c#, web-services, architecture, n-tier-architecture

我最近问了这个问题：[Expose XML or Objects](https://stackoverflow.com/questions/368521/api-design-expose-xml-or-objects "公开 XML 或对象") - 感谢大家的回复。

有一点要澄清。

*   API 将始终被远程访问（即作为服务），最有可能通过 web 服务或 WCF。

我同意从理论上讲，将对象公开为输入/输出的强类型 API 是*正确*的方法。但是，我觉得公开 XML 仍有争议。在我看来，使用 XML 的原因是：

1.  业务规则可以由 Schematron 中的业务分析师编写。
2.  该接口是弱类型的，但只要调用它，就可以根据数据和业务规则验证数据。
3.  服务的实现会更简单。不需要创建域对象模型。
4.  XML 模式已经定义（我们有一个模式的数据字典）。
5.  使用 Web 服务技术意味着基于 XML 的 API 不需要在添加新的汽车“类型”时进行更改，例如

    ```
    void AddNewCar( string newCarXml )    
    string[] GetCars( /* some query conditions */ ) 
    ```

    如果我们使用基于对象的 API，那么添加新类型将需要一个新的查询方法来定义可以返回的可能派生类型（请参阅[扩展 Web 服务](https://stackoverflow.com/questions/374253/extend-webservice-without-impacting-existing-clients-returning-derived-types-fr "扩展网络服务")）。像这样更新 Web 服务需要重新构建和重新部署此服务和*所有现有客户端。*

基于对象的 API 给我们带来了什么？一个强类型的声明式接口。它没有提供比 XML 更多的抽象（XML 本身就是一种抽象）。基于对象的 API 的成本是多少？它需要一整套需要业务规则和数据验证的域对象。

那么，我的问题是什么？给我一个不可战胜的、无可争辩的理由，为什么我应该选择对象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T18:46:57.977

*   对象可以执行得更好（这里考虑二进制序列化）。
*   对象可以有更强的简单类型验证。
*   对象允许您将验证和业务规则置于更接近数据结构定义的位置。
*   对象本质上允许您编写更简单的业务规则和验证，因为其中大部分都嵌入在对象定义本身中。
*   **对象也可以定义行为。**
*   .Net 使得通过序列化将对象转换为 XML 并再次返回变得简单，从而为对象提供了与 xml 相同的大部分好处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:46:22.130

如果您正在寻找支持 XML 的论据（不是我特别支持 XML），那么：

*   当涉及到数据时，公开 XML 并提供 XSD 是不言自明的。您可以传递该表单中的所有数据，它是自我记录的，并且可以合理地简单地进行验证。

*   我可以针对我的数据库或代码模型编写一堆安全代码，并且我可以以独立且安全的方式将数据发布给其他业务部门，而这些业务部门需要最少的进一步文档或解释。

*   它非常容易阅读，以至于您通常可以像阅读文档或代码注释一样轻松地阅读它。

然而，反对它的论点还在继续……列举最严重的违规者：

*   过于冗长。
*   巨大的网络开销。
*   需要了解额外的技术，也许是不必要的（？）。
*   你做的东西越复杂，出错的机会就越大。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:49:01.170

当您公开纯 XML 时，您的所有客户端都需要编写代码来生成和解析该 XML。在某些语言中很容易，在其他语言中是 PITA。

但大多数语言都有 Web 服务 API，可以使用 wsdl/xsd 并在几秒钟内生成完整的客户端库。当然，他们必须编写一个映射实用程序来从他们的内部模型映射到您的模型以与您交互，但这是意料之中的。

您的 Web 服务将在内部处理所有 Object<-->XML 内容（对于客户端的视图），您无需担心 SOAP 和所有这些。您将定义您的界面：

```
void addCar(Car newCar);
Car getCar(String make, String model, String year);
void removeCar(...);
List<Car> getAllCars(); 
```

这对您的客户来说很有意义。他们抓取您的 wsdl 并使用 Java、C#、PHP、Python 等生成他们的客户端库。

没有什么能阻止你添加：

```
int addCarXML(String carXML);
String getCarXML(int carID); 
```

但是为什么要添加两个级别的 webservice cruft - 首先是 wsdl，然后是 XML 模式的 xsds...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T18:49:29.487

强类型实际上任何类型都存在，唯一的原因是程序员不会犯任何愚蠢的错误（例如，将字符串传递给期望 int 的函数等）。最重要的是，这发生在编译时并且在运行时不花费任何成本，因此通过避免运行时检查（例如，正确的强制转换）和避免非托管代码在运行时的异常行为来生成高效的代码。

就像你说的，Xml 可以用来定义一个替换对象模型，但是这个对象模型需要在运行时进行相同的检查，以在一定程度上保证可靠性。但这有一定的有限运行时开销。

说了这么多，我想说的是，最终的选择是你的。您是否愿意放弃“刚性”对象模型所提供的安全性（有时是安心），或者您会更愿意使用更灵活但可以自己动手的对象模型？XML 需要更高的程序员纪律和警觉性（因此使用恕我直言是一件苦差事）。

“基于对象”的 API 并不像您想象的那样死板，自动生成的 XML 模式可能无法完成您真正希望它们执行的操作。如果设计得当，基于对象的 API 可以像基于 XML 的 API 一样灵活。动态类型有时也有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T19:19:54.837

在网上查看有关 Contract-First Design 的文章，Spring 网站有一个很好的例子。我现在正在开发一个新的网站，并采取了从 XML Schema 开始并使用它来设计我的应用程序域模型的方法。XML 非常适合在不同系统甚至应用程序层之间发送数据。它与编程语言无关，并且有许多用于编辑、设计和实现基于 XML 的设计的工具。

它很冗长，但在事物的计划中，冗长是一个小麻烦。它可以创建大文件，只需压缩它。处理它有更多的开销，但我们开发人员总是用纯粹的性能来换取易用性、可维护性、可扩展性等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T20:06:01.623

这是另一个随机的想法 - 两者都不使用；-p 我正在考虑其他交换格式。我最近在协议缓冲区方面做了很多工作——这提供了合同优先使用（通过“.proto”定义），但在设计时考虑到了安全的可扩展性——即你可以设计一些东西来传递意外数据而不会破坏或损失。不幸的是，主要的协议缓冲区规范实际上并不包括继承，但我的实现（protobuf-net）通过扩展来填充它。

它是否足够成熟取决于场景 - 我只是认为它可能会引起人们的兴趣。顺便说一句，它（protobuf-net）还插入到 WCF 中，以方便预滚动的 RPC 堆栈；-p

# excel - 如何从 vba 调用 xll 插件函数？

> ID：375552
> 
> 赞同：17
> 
> 时间：2008-12-17T18:31:48.493
> 
> 标签：excel, vba, ms-office

我有一个第 3 方 XLL 插件，我想将其包装在我自己的自定义 vba 函数中。如何从我的代码中调用 3rd 方函数？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-17T19:36:30.623

**编辑：**至少有两种方法可以做到这一点：

* * *

**选项1：** `Application.Run(...)`

这看起来是最好的方法，因为您的参数在发送到 XLL 函数之前会自动转换为适当的类型。

```
Public Function myVBAFunction(A as Integer, B as String, C as Double)
    myVBAFunction = Application.Run("XLLFunction", A, B, C)
End Sub 
```

有关详细信息，请参阅[此页面。](http://www.planatechsolutions.com/xllplus-online/faq.htm#VisualBasic)

* * *

**选项 2：** `Application.ExecuteExcel4Macro(...)`

使用此方法，您必须将任何参数转换为字符串格式，然后再将它们传递给 XLL 函数。

```
Public Function myVBAFunction(A as Integer, B as String, C as Double)
    dim macroCall as String
    macroCall = "XLLFunction(" & A
    macroCall = macroCall & "," & Chr(34) & B & Chr(34)
    macroCall = macroCall & "," & C
    macroCall = macroCall & ")"
    myVBAFunction = Application.ExecuteExcel4Macro(macroCall)
End Sub 
```

有关详细信息，请参阅[此页面。](http://www.planatechsolutions.com/xllplus-online/start_mt_demo_background_xla.htm)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2013-07-04T11:10:36.750

我知道这是一个迟到的答案，但我发现了这种替代方法并认为值得分享。您可以以与 Win32 调用相同的方式声明第 3 方函数。这具有额外的好处，即在您编码时显示在 Intellisense 完成中。

```
Private Declare Function XLLFunction Lib "C:\PathTo3rdPartyDLL\3rdParty.xll" (ByVal A as Integer, ByVal B as String, C as Double) As Double

Sub Function myVBAFunction(A as Integer, B as String, C as Double) as Double
    myVBAFunction = XLLFunction(A, B, C)
End Sub 
```

# php - 为什么这个标准的 Reg Ex 在 PHP 的 ereg 函数中不起作用

> ID：375563
> 
> 赞同：1
> 
> 时间：2008-12-17T18:37:16.797
> 
> 标签：php, html, regex

我对 Reg Ex 有点陌生，并不完全了解不同口味之间的区别。但是，当我通过 UNIX 系统（vi 和 grep）尝试它时，我有一个基本的 Reg Ex，但当我尝试在 PHP 的 ereg 函数中使用它时却不行。我怀疑 PHP ereg 函数有一些不同之处导致它不起作用：

```
<?php
$string = 'Feugiat <em>hendrerit</em> sit iriuredolor aliquam.';
$string = ereg_replace("<em\b[^>]*>(.*?)</em>","\\1",$string);
echo $string;
?> 
```

我希望这个输出**Feugiat hendrerit sit iriuredolor aliquam。**没有 em 标签。但是它只返回一个空字符串。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T18:39:45.637

您可能需要转义反斜杠：

```
$string = ereg_replace("<em\\b[^>]*>(.*?)</em>","\\1",$string); 
```

这是因为`\b`PHP 字符串中的含义与`\b`正则表达式中的 a 不同。在 PHP 字符串中使用`\\`通过单个反斜杠传递到`ereg_replace()`. 这与您需要在替换字符串中使用双反斜杠的原因相同`"\\1"`。

根据您的应用程序，您可能还需要考虑输入`$string`不包含任何`<em>`标签的可能性。在这种情况下，上述语句将产生一个空字符串，这可能不是您想要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T18:53:19.977

如果您使用正则表达式的全部目的是删除 html 标签，也许 php 的 strip_tags() 函数会更合适。

[php.net 手动输入](http://us.php.net/strip_tags)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T19:16:08.793

ereg_replace 不支持单词边界断言 (\b) 或非贪婪修饰符 (*?)。PEZ 是对的，您可能应该使用 preg。

```
preg_replace('!<em\\b[^>]*>(.*?)</em>!', '$1', $string) 
```

额外的反斜杠不是绝对必要的，因为 PHP 不会替换 \b，但最好总是在字符串文字中转义反斜杠。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T19:43:17.817

避免`ereg`将来的兼容性可能是个好主意。看来它在 php6 中已根据[this](http://www.ibm.com/developerworks/opensource/library/os-php-future/?ca=dgr-lnxw01PHP-Future)贬值了。

> 支持可移植操作系统接口 (POSIX) 正则表达式的 ereg 扩展正在从核心 PHP 支持中删除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T18:52:00.603

如果您打算删除`<em>`标签，我建议您执行以下操作：

```
<?php
  $string = 'Feugiat <em>hendrerit</em> sit iriuredolor aliquam.';
  $string = ereg_replace("</?em\\b[^>]*>", "", $string);
  echo $string;
?> 
```

[Greg Hewgill](https://stackoverflow.com/questions/375563/why-wont-this-standard-reg-ex-work-in-phps-ereg-function#375568)关于 PHP 字符串中反斜杠的转义是正确的。您需要这样做才能在正则表达式模式字符串中添加文字反斜杠。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T19:05:00.733

我从来没有理解过 ereg_ 并且总是使用 preg。如果您像 Greg 建议的那样添加反斜杠并更改为 preg_ 它将编译。

```
$string = preg_replace('%<em\\b[^>]*>(.*?)</em>%','\\1',$string); 
```

编辑：我在这里同意其他人的观点，即这种特殊方法可能不适合该问题。但是，preg_ 仍然是在 PHP 中使用正则表达式时最常用的方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-18T02:45:02.973

PHP 的 ereg 函数使用非常有限的正则表达式风格，称为[POSIX ERE](http://www.regular-expressions.info/posix.html)。我的[风味比较](http://www.regular-expressions.info/refflavors.html)表明，与现代风味相比，这种风味所缺乏的一切。

在您的情况下，不支持单词边界 \b 。严格的 POSIX 实现会将 \b 标记为错误。

您的解决方案是改用 preg 函数：

```
preg_replace('!<em\b[^>]*>(.*?)</em>!', '$1', $string); 
```

与您收到的其他答案相比：不要逃避 \b 中的反斜杠，并使用 $1 进行替换。preg_replace 使用与 ereg_replace 不同的替换文本语法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-18T19:22:53.380

据我所知， ereg 不处理 \b 边界的东西，而 preg 可以。另外，我认为正则表达式上的双引号可能会导致反斜杠出现问题

# php - 是否可以使用 PHP 的 ID 更改 HTML 元素属性？

> ID：375567
> 
> 赞同：2
> 
> 时间：2008-12-17T18:38:16.950
> 
> 标签：php, html

我想做这样的事情：

页面 A 有一个指向页面 B 的链接 页面 B
从数据库中获取内容并对其进行处理
页面 B 的结果显示在页面 A 的 div 上

请注意，当页面 B 处理数据库的信息时，我不想离开页面 A。

我真正想做的是避免在网站中使用框架，我想让页面出现在`div`. 这可能吗？

我猜它有点像新手问题，但这真的让我很烦恼，我什至不知道从哪里开始寻找。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-17T18:43:44.457

你想要 AJAX！

AJAX 会这样做，但步骤会与您描述的有所不同

*   页面 A 有一个调用 javascript 函数的链接
*   javascript 函数对页面 B 进行 AJAX 调用，该调用从数据库中获取内容并对其进行处理
*   页面 B 的结果返回给 javascript 函数
*   页面 a 显示在 div 中

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T18:42:00.843

您正在寻找的是 JavaScript 和 AJAX。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T18:42:17.770

你想做这个客户端而不是服务器端。我个人喜欢[JQuery](http://docs.jquery.com/Ajax)

您可能必须有一个简单版本的 Page B。这很常见。如果你想要一些例子，请告诉我。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T20:31:11.120

这个例子可能有很多错误，但它应该让你走上正确的轨道:)

文件 a.php

```
<html>
<body>
<script type="text/javascript" src="stuff.js"></script>
Data to process please: <input type="text" name="datatoprocess" id="datatoprocess" />
<br />
<input type="button" value="Do Something" onclick="dostuff();" />
<hr />
<div id="resultarea">
</div>
</body>
</html> 
```

文件 b.php

```
<?php

$message = '';
if ( isset( $_REQUEST['datatoprocess'] ) ) {
    $datatoprocess = $_REQUEST[ 'datatoprocess' ];
    if ( strlen( $datatoprocess ) > 0 ) {
        if ( $datatoprocess == 'foo' ) {
            $message = '<span style="color:#ffff00;background:#ff0000;">bar</span>';
        } else {
            $message = 'You sent me: &quot;'.htmlentities($datatoprocess).'&quot;';
        }
    } else {
        $message = 'That is really short data.';
    }
} else {
    $message = 'No data to process in request?';
}

echo $message;

?> 
```

文件 stuff.js

```
// poor man quick and dirty ajax :|

function dostuff() {
    var xmlHttp=GetXmlHttpObject();
    if (xmlHttp==null) {
        alert ("Browser does not support HTTP Request.");
        return;
    } 
    var datatoprocess = document.getElementById('datatoprocess').value;
    var url="b.php"
                 +"?datatoprocess=" + escape(datatoprocess)
    ;
    xmlHttp.onreadystatechange = function() {
        if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete") { 
            var AjaxAnswer = xmlHttp.responseText ;
            document.getElementById('resultarea').innerHTML = AjaxAnswer;
        }
    };
    xmlHttp.open("GET",url,true);
    xmlHttp.send(null);
}

function GetXmlHttpObject() { 
    var objXMLHttp=null;
    if (window.XMLHttpRequest) {
        objXMLHttp = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
        objXMLHttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    return objXMLHttp;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T19:06:00.293

简短的回答：没有。

您将需要一些客户端脚本或 AJAX 来执行此操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T19:47:21.163

查看[XAJAX](http://xajaxproject.org)。

它是一个用于 PHP 的 AJAX 库，基本上可以满足您的需求。
它编写处理客户端内容所需的 Javascript。

您将执行以下操作。1\. 在您的 php 页面中包含 XAJAX 库。2\. 注册你的函数 3\. 使用 xajax_phpfunctionName() 从 javascript 在客户端调用它们

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T19:49:58.863

正如其他人所说，这需要通过某种 AJAX 设置来完成。如果您比 JavaScript 更熟悉 PHP（或服务器端脚本比客户端脚本），我还建议您[查看 XAJAX](http://xajaxproject.org/ "厦航")。[在我回答时由亚当发布。]

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T18:06:08.850

好吧，我最初想做的是让 PHP 将一个页面的 HTML（和 PHP）内容转储到另一个页面上的 DIV 上（听起来很奇怪，我知道）。你这样做的方法是使用这个函数：

```
ob_start();  
include($filename);  
$return_str = ob_get_contents();  
ob_end_clean(); 
```

如果您这样做，它将解析 $filename 文件上的 PHP 并以字符串形式返回结果。要使其转储并显示内容，只需删除最后一行。

我有点新手，这可能不是最好的方法，但它对我有用。希望能帮助到你。

# statistics - 网络使用统计

> ID：375574
> 
> 赞同：0
> 
> 时间：2008-12-17T18:41:21.593
> 
> 标签：statistics

什么是检查当前 Web 使用统计数据的好网站——尤其是 Java 版本、操作系统、浏览器。我一直在试图找出谷歌时代精神，因为它应该有这些信息，但我找不到。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T18:50:01.683

Google Zeitgeist 早在 04 年（或那时左右）就停止提供该信息。

[W3Schools 有一些有趣的数据](http://w3schools.com/browsers/default.asp)，但请记住，使用它的受众主要是开发人员，因此它在技术上更加偏颇。

不幸的是，没有一个很好的来源可以在网络上获取详细的浏览器/操作系统统计信息，因为大多数网站都将其视为私人信息。

老实说，您最好的选择是从您自己的网站上获取统计数据。您可以使用您的服务器日志来执行此操作，或者您可以像其他人提到的那样使用 Google Analytics。这可以用来很好地记录和查看有关您网站的统计信息。

您想要获取有关您自己网站的统计数据的原因是，很难说使用一个网站或服务的人口统计数据与您的相同。如果您获取自己网站的统计数据，那么您就**知道**谁在使用您的网站，这比一般的网络统计数据有用得多，因为用户组根据网站的不同而有很多种类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:46:04.250

Zeitgeist 更多的是收集有关谷歌搜索的统计信息。您可能误认为[Google Analytics](http://google.com/analytics)了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T18:45:59.197

您是否尝试过 www.google.com/analytics/？

# objective-c - 为什么我的笔尖的窗口会立即关闭？

> ID：375583
> 
> 赞同：1
> 
> 时间：2008-12-17T18:43:24.023
> 
> 标签：objective-c, cocoa

我有一个按通常方式加载的笔尖

`[NSBundle loadNibNamed:@"AuthorizationWindow" owner:self];`

我在屏幕上短暂地看到了窗口显示，并且使用 NSLog() 我可以确认 -awakeFromNib 被调用，但我无法弄清楚为什么窗口没有留在屏幕上。我让它正常工作了一段时间，但现在我不确定我做了什么改变了它。想从哪里开始寻找？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T20:13:27.087

我猜你的窗口正在从你下面被释放（或者如果在 GC 下，收集）。有大约一百万种可能的原因（我们无法从一行代码中诊断出这些原因），但事实上您使用的 +loadNibNamed:owner: 是一个警告标志。原因是在 nib 中实例化的项目遵循与 Cocoa 其余部分相同的内存管理规则。如果你想让它们留下来，你必须保留它们（或者在 GC 中，保留对它们的引用）。NSWindowController（和 NSViewController 也是）有一些特殊的 nib 处理代码，以便在加载时将所有顶级对象保留在其 nib 中，这样它们就会一直存在*。但是，如果您不使用它，则必须手动完成所有操作。

真正的解决方案是：不要使用+loadNibNamed:owner:。相反，创建一个 NSWindowController 子类并像这样设置它的 -init 方法：

```
@implementation AuthorizationWindowController
- (id)init
{
    self = [super initWithWindowNibName:@"AuthorizationWindow"];
    if (self == nil) return nil;
    // any other initialization code
    return self;
} 
```

*它还有特殊的代码来处理绑定引起的保留周期，这通常会导致它泄漏，这对你自己来说是相当困难的。还有一个使用 NSWindowController 的理由。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T19:17:32.003

我会仔细看看您用来加载笔尖的对象（`self`在您提供的代码中）。由于它是窗口的所有者，因此当该对象被释放时，该窗口将被释放。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T21:22:52.623

原来我已经启用了 GC 并且做到了。将尝试使用窗口控制器方法。谢谢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-25T04:31:20.727

在 windowViewController 头文件中输入：

```
@property (strong) NSWindowController *wc; 
```

在实现中：在顶部合成 wc

```
-(id)init{
    wc = [super initWithWindowNibName:@"NewWindowController"];
    if(wc == nil){
        return nil;
    }

    return wc;
} 
```

当您想让窗口可见时：

```
- (IBAction)mnuNewImageClicked:(id)sender {
    NewWindowController *ivc = [[NewWindowController alloc] init];
    [ivc showWindow:self];
} 
```

这对我有用。

# nhibernate - (N)Hibernate：具有关系的核心/主映射

> ID：375584
> 
> 赞同：0
> 
> 时间：2008-12-17T18:43:26.690
> 
> 标签：nhibernate, hibernate, dns, domain-driven-design

我正在一家中型公司开始工作，主要致力于编写与他们的 ERP 系统交互的自定义​​应用程序。这是我第一次做这种工作，所以 ERP 概念对我来说是新的，我正在学习它。

到目前为止，我只编写了两个应用程序，并且学习了数据库模型，并且只学习了完成工作所需的量，但即使数量有限，我也可以开始看到一个大图景。然后我的想法是编写一个库，其中存储了所有映射/模型对象，以便新应用程序可以引用这个库。之后，每个应用程序将创建自己的存储库，将访问权限限制为只访问他们需要的内容和有意义的视角。

我遇到的问题/问题是如何处理（N）Hibernate 映射中的关系。如果我有一个在此基础库中映射的具有完整关系的订单对象，则没有什么能阻止某人永远旅行这些关系（假设我是唯一的程序员......）。因此，从这个意义上说，使用存储库作为一种范围限制根本行不通。

相反，如果我限制此订单对象的 (N)Hibernate 映射中的关系，则存储库会返回一个订单对象，该对象仅与它的范围所需的关系绑定。缺点是我现在必须为每个项目创建映射，而不是拥有一个“映射存储”。

其他人如何处理这个问题？

有点不相关，但我也一直在将可能由多个关系组成的 (N)Hibernate 持久对象转换为一种更适合特定应用程序的单一非持久对象（通常受 UI 影响更大）。这是一件常见的事情，还是我通过获取返回的对象并将它们转换为其他东西来丢弃 (N)Hibernate 的一些好处？

附言。关于 DDD 标签...我不知道这是否是 DDD 详细介绍的内容，但我确实有订购这本书。不过，在本书到达之前，我不确定是否有好的资源可供查看。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-24T12:55:39.710

很老的问题。我想你已经找到了答案，但万一......

我看到两种解决问题的方法。

1.  通过数据库中的用户帐户限制表访问。例如在 mysql 中，您可以这样做。缺点是如果你的所有域类都映射和编译到你的 nh dll 中，程序员仍然可以看到这些实体。如果他/她试图访问它，它将触发一个异常（nh 试图访问一个数据库表，数据库拒绝）。

2.  为每个案例创建一个 dll。但我想您可能还需要创建多个帐户。

# domain-driven-design - 语言无处不在……迷失在翻译中

> ID：375585
> 
> 赞同：2
> 
> 时间：2008-12-17T18:43:36.893
> 
> 标签：domain-driven-design

我发现了两个崩溃的问题：

*   您应该在领域专家和开发团队 (DDD) 之间使用相同的语言
*   您应该在代码中使用英文命名（.Net 设计指南）

*如果领域专家不会说英语怎么办？*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T18:58:20.357

*   团队之间说相同的语言将促进理解。但是，DDD 项目是指字面的“语言”（舌头）还是“术语”？
*   使用英语进行编码是一个建议，而不是要求。
*   只要您的开发团队可以翻译代码操作/意图，我看不出问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-15T06:11:13.900

如果您问我，您应该使用母语进行业务（如客户、订单等），使用英语作为技术术语（如获取、设置等）。如果你开始翻译你的商业用语，你必须经过一个心理步骤，而且有时你会为两件事得到两种不同的翻译——换句话说，这是一团糟。现在您只需要找出什么是业务术语，什么是技术术语...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-15T06:23:06.773

我们对领域概念使用领域语言（法律意义上的德语），对技术概念使用英语。这导致了看起来很有趣的类名，但总的来说，这是一个胜利。

我对一个密切相关的问题的[回答](https://stackoverflow.com/questions/553082/do-you-code-variables-in-your-language/553164#553164)中有更多详细信息。

# java - 如何在 Java 中使用 Helvetica？

> ID：375588
> 
> 赞同：3
> 
> 时间：2008-12-17T18:44:15.113
> 
> 标签：java, fonts

Helvetica 在 Windows、Mac OS X 和 Linux 上以一种或另一种形式提供。在 Windows 下，我可以从 Microsoft Word 中看到它。在两个 UNIX 平台上，我可以用 xlsfonts | 找到它。grep -i helvetica; 这个名字似乎是 adobe-helvetica。

但是JDK找不到！它没有从 GraphicsEnvironment.getAllFonts() 中列出，也没有在我调用 new Font("Helvetica", ...) [使用多个名称变体，例如 "Adobe Helvetica"] 时出现；相反，我默认为“Dialog”字体，它似乎用我使用的任何名称命名。

这种字体现在在每个相关的 Java 目标平台上都可用。如何在 Java 中使用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T18:57:10.110

```
Font f = new Font("Helvetica", Font.PLAIN, 10);  // make a new font object

ObjectName.setFont(f); // set the objects font using setFont(); 
```

其中“Helvetica”是字体，Font.PLAIN 定义样式，10 定义大小。当然它必须安装才能工作，你可以使用 CreateFont() 捆绑它。

尝试使用[Java API for Fonts](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Font.html)获得更多参考。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-30T17:43:13.630

安装 TrueType 字体通常非常简单。我为我的项目使用 maven，所以我只是将字体文件保存在我的资源目录中并使用类加载器获取它。

```
InputStream is = MyClass.class.getClassLoader().getResourceAsStream("my/package/Avenir.ttf");
Font f = Font.createFont(Font.TRUETYPE_FONT, is);
is.close(); 
```

该字体应加载到内存中，以便使用字体名称在应用程序的其他地方使用。您可以确保这有效，并使用下面的代码查看您的系统上可以使用哪些字体。

```
GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
String[] fontNames = ge.getAvailableFontFamilyNames();

for(String name : fontNames)
    System.out.println(name); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T18:48:40.767

我意识到这实际上并没有回答这个问题，但是......

在 Windows 上，并不总是安装 Helvetica。尽管有 Microsoft Office XP，但我的工作机器（我现在正在使用的机器）却没有。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T19:32:36.810

在 Linux 上，在 jre 或 jdk 目录中的某处有一个 font.properties 文件，您应该能够向其中添加新字体，但我尝试了无数种不同的方法来向其中添加字体，即使是那些操作系统知道并出现在 xlsfonts 中，但从未让它工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T18:56:47.897

正式地，Java 中唯一保证附带的字体是 Lucida fronts（Bright、Sans 和 Typewriter）。根据 Java 的安装和配置，它可能能够从您机器的字体目录中读取前端，但这并不能保证。

如果它必须是 Helvetica，您可以将字体与 Font.CreateFont() 捆绑在一起，将一个表示类型（Font.BOLD 或 Font.PLAIN 等）的 int 和一个 InputStream 传递给 TrueType 字体。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-17T18:59:39.277

我认为如果您将字体文件放在 src 文件夹中并从那里调用它，它将起作用。

# sql - SPARQL 查询，选择除了匹配的东西之外的所有东西？

> ID：375589
> 
> 赞同：3
> 
> 时间：2008-12-17T18:44:27.827
> 
> 标签：sql, sparql

我越来越习惯用 SPARQL 编写常规查询，但我仍然无法处理更高级的内容。我最新的问题是尝试选择除与 where 子句匹配的内容之外的所有内容。例如，假设我想找到所有喜欢他们妻子不喜欢的汽车颜色的丈夫（我正在研究一个专有模型，所以请原谅这个例子并相信它在真实模型中是有意义的）。

我可能有：

```
<bob> <spouse> <alice>
<bob> <likes> <red>
<alice> <likes> <red>
<carl> <spouse> <dorothy>
<carl> <likes> <blue>
<dorothy> <likes> <yellow>
<eric> <spouse> <fannie>
<eric> <likes> <black> 
```

选择 carl 和 eric 但不选择 bob 的查询是什么？如果您可以在同一查询中选择蓝色和黑色，则可以加分。选择 bob 很简单：

```
select ?husband ?color where {?husband <spouse> ?wife . ?husband <likes> ?color . ?wife <likes> ?color} 
```

我正在寻找的是：

```
select ?husband ?color where {?husband <spouse> ?wife . ?husband <likes> ?color . NOT (?wife <likes> ?color)} 
```

但显然这是错误的。那么什么是对的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T19:44:54.413

我通过其他来源找到的一个正确答案是这样的：

```
select ?husband ?color where {?husband <spouse> ?wife . ?husband <likes> ?color . OPTIONAL {?wife <likes> ?wifecolor FILTER (?wifecolor = ?color)} FILTER (!BOUND(?wifecolor))} 
```

它至少适用于 eric，但我没有测试过 carl。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-04-28T08:05:42.787

在 SPARQL 1.1 中有一种更简单、更自然的方法（但它相当于 OPTIONAL/BOUND 解决方案）：

```
SELECT ?husband ?color 
WHERE {
    ?husband <spouse> ?wife .
    ?husband <likes> ?color .
    FILTER NOT EXISTS {?wife <likes> ?color}
} 
```

# c# - 在使用 XDocument.Load() 加载文件之前，如何测试文件以查看它是否是有效的 XML 文件？

> ID：375590
> 
> 赞同：36
> 
> 时间：2008-12-17T18:44:44.393
> 
> 标签：c#, xml, linq-to-xml

我正在使用以下内容在我的 C# 应用程序中加载 XML 文档：

```
XDocument xd1 = new XDocument();
xd1 = XDocument.Load(myfile); 
```

但在此之前，我会进行测试以确保文件存在：

```
File.Exists(myfile); 
```

但是......有没有一种（简单的）方法可以在 XDocument.Load() 之前测试文件以确保它是有效的 XML 文件？换句话说，我的用户可能会不小心在文件浏览器中单击不同的文件并尝试加载，例如，.php 文件会导致异常。

我能想到的唯一方法是将它加载到 StreamWriter 并简单地对前几个字符进行文本搜索以确保它们说“

谢谢！

-阿迪娜

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-12-17T19:01:55.060

如果您想向用户显示消息，可能只需要捕获特定异常：

```
 try
 {
   XDocument xd1 = new XDocument();
   xd1 = XDocument.Load(myfile);
 }
 catch (XmlException exception)
 {
     ShowMessage("Your XML was probably bad...");
 } 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-12-17T19:28:18.283

**[这个问题将“格式良好](http://www.w3.org/TR/REC-xml/#sec-well-formed)”与“[有效](http://en.wikipedia.org/wiki/Valid_XML_document)”XML 文档混淆了**。

根据定义，有效的 xml 文档是格式良好的文档。**此外**，它必须满足[**DTD**](http://www.w3.org/TR/REC-xml/#dt-doctype)或模式（[**xml 模式**](http://www.w3.org/TR/xmlschema-0/)、[**relaxng 模式**](http://relaxng.org/)、[**schematron**](http://www.schematron.com/)或[**其他约束**](http://en.wikipedia.org/wiki/XML_Schema#XML_schema_languages)）才能有效。

从问题的措辞来看，它很可能会问：

**“如何确保文件包含格式正确的 XML 文档？”。**

答案是，如果 XML 文档可以被兼容的 XML 解析器成功解析，那么它就是格式良好的。由于[**XDocument.Load()**](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.load.aspx)方法正是这样做的，因此您只需捕获异常，然后得出文件中包含的文本格式不正确的结论。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-17T18:53:03.317

只需加载它并捕获异常。同样`File.Exists()`- 文件系统是*易变*的，所以仅仅因为`File.Exists()`返回 true 并不意味着您可以打开它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T19:03:39.223

如果您有 XML 的 XSD，请尝试以下操作：

```
using System;
using System.Xml;
using System.Xml.Schema;
using System.IO;
public class ValidXSD 
{
    public static void Main()
    {
        // Set the validation settings.
        XmlReaderSettings settings = new XmlReaderSettings();
        settings.ValidationType = ValidationType.Schema;
        settings.ValidationFlags |= XmlSchemaValidationFlags.ProcessInlineSchema;
        settings.ValidationFlags |= XmlSchemaValidationFlags.ReportValidationWarnings;
        settings.ValidationEventHandler += new ValidationEventHandler(ValidationCallBack);

        // Create the XmlReader object.
        XmlReader reader = XmlReader.Create("inlineSchema.xml", settings);

        // Parse the file. 
        while (reader.Read());
    }

    // Display any warnings or errors.
    private static void ValidationCallBack (object sender, ValidationEventArgs args) 
    {
        if (args.Severity == XmlSeverityType.Warning)
            Console.WriteLine("\tWarning: Matching schema not found.  No validation occurred." + args.Message);
        else
            Console.WriteLine("\tValidation error: " + args.Message);
    }  
} 
```

参考在这里：

[http://msdn.microsoft.com/en-us/library/system.xml.xmlreadersettings.validationeventhandler.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmlreadersettings.validationeventhandler.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T19:33:41.783

如前所述，“有效 xml”由 XmlDocument.Load() 测试。只需捕获异常。如果您需要进一步验证以测试它是否对模式有效，那么这就是您所追求的：

```
using System.Xml; 
using System.Xml.Schema; 
using System.IO; 

static class Program
{     
    private static bool _Valid = true; //Until we find otherwise 

    private static void Invalidated() 
    { 
        _Valid = false; 
    } 

    private static bool Validated(XmlTextReader Xml, XmlTextReader Xsd) 
    { 

        var MySchema = XmlSchema.Read(Xsd, new ValidationEventHandler(Invalidated)); 

        var MySettings = new XmlReaderSettings(); 
        { 
            MySettings.IgnoreComments = true; 
            MySettings.IgnoreProcessingInstructions = true; 
            MySettings.IgnoreWhitespace = true; 
        } 

        var MyXml = XmlReader.Create(Xml, MySettings); 
        while (MyXml.Read) { 
          //Parsing...
        } 
        return _Valid; 
    } 

    public static void Main() 
    { 
        var XsdPath = "C:\\Path\\To\\MySchemaDocument.xsd"; 
        var XmlPath = "C:\\Path\\To\\MyXmlDocument.xml"; 

        var XsdDoc = new XmlTextReader(XsdPath); 
        var XmlDoc = new XmlTextReader(XmlPath); 

        var WellFormed = true; 

        XmlDocument xDoc = new XmlDocument(); 
        try { 
            xDoc.Load(XmlDoc); 
        } 
        catch (XmlException Ex) { 
            WellFormed = false; 
        } 

        if (WellFormed & Validated(XmlDoc, XsdDoc)) { 
          //Do stuff with my well formed and validated XmlDocument instance... 
        } 
    } 
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-09T05:07:58.457

根据接受的答案，我不会 XDocument.Load()；为什么要将整个文件读入内存，它可能是一个巨大的文件？

我可能会将前几个字节读入 byteArray（它甚至可以是任何二进制文件），将 byteArray 转换为字符串，例如`System.Text.Encoding.ASCII.GetString(byteArray)`，检查转换后的字符串是否包含您期望的 Xml 元素，然后才能继续。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-11-03T14:37:39.727

我知道这个线程已经快 12 年了，但我仍然想添加我的解决方案，因为我在其他任何地方都找不到它。我认为您想要的只是一种检查文件是否为 xml 文件的方法，而不是检查文件是否结构良好或其他任何东西。（这就是我理解这个问题的方式）。

我找到了一种方法可以轻松检查文件是否为 xml 文件（或您需要的任何文件，这适用于任何东西），这将是以下代码行：

```
new System.IO.FileInfo(filePath).Extension == ".xml" 
```

只需将“filePath”替换为文件的路径即可。您可以将语句放在需要布尔值的任何位置。

你可以像这样使用它：

```
boolean isXmlFile = new FileInfo("c:\\config.xml").Extension == ".xml" //will return true 
```

# c++ - 查找 STL 迭代器的所有者

> ID：375598
> 
> 赞同：7
> 
> 时间：2008-12-17T18:46:40.677
> 
> 标签：c++, stl, iterator

有什么方法可以找到迭代器指向的容器？具体来说，我希望能够找到`std::vector`特定对象所指向的对象，`std::vector::iterator`以便我可以检查范围，而不必实际传递对该向量的引用。

如果（我怀疑）答案是否定的，为什么不呢？

编辑：感谢您提供一些快速且（大部分）准确的答案。[埃文·特兰 (Evan Teran](https://stackoverflow.com/questions/375598/finding-the-owner-of-an-stl-iterator#375608) ) 做到了。我根本没有考虑优化，但现在很明显。

有几个人问我想这样做是为了什么。这没什么特别重要的。我有一个用向量和指向向量的迭代器初始化的对象。如果我可以只使用迭代器来初始化对象，那将是既可爱又方便的，因为这样我就可以将`vector::iterator`s 直接转换为该对象（这听起来很奇怪，但在特定情况下确实有意义）。但这根本不是关键。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T18:48:48.660

我不相信。如果迭代器必须保留指向其所属容器的引用/指针，那么将它们优化为轻量级指针是不可能的（这可以通过容器保证连续存储，如向量等来完成）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T19:21:27.940

没有办法让它发挥作用。原因很简单：向迭代器添加一种方法来获取它们指向的容器是

*   无意义。迭代器对集合进行迭代。正如其他人所说，仅此而已。
*   与迭代器要求不兼容。请记住，指针是随机访问迭代器。将容器指针放入迭代器对算法没有用处，因为它们是通用的，与特定的迭代器实现分离。用作迭代器的指针不能有指向作为成员从中取出的数组的指针。

你说你需要它来进行范围检查。您可以提供一个结束迭代器，它指向范围的最后一个有效迭代器位置之后的位置。检查您当前的位置是否不在末尾。这就是范围检查所需要做的一切。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T18:56:24.790

您不能以一般方式从迭代器中检索容器。作为一个示例，可以将普通指针用作迭代器：

```
#include <algorithm>
#include <cstdio>
#include <cstring>

int
main(int argc, char *argv[])
{
        const char s[] = "Hello, world!";
        const char *begin = s;
        const char *end = s + strlen(s);

        std::for_each(begin, end, putchar);

        return 0;
} 
```

如何从指针中检索原始字符串（如果它没有指向字符串的开头）？

但是，如果您需要此功能，那么您始终可以围绕存储对容器的引用的迭代器[实现](http://universalvoid.blogspot.com/2007/11/how-to-implement-iterator-in-stl.html)自己的包装器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T18:58:21.543

如果所讨论的迭代器至少是前向迭代器，理论上有一种方法。您可以检查您的迭代器是否是每个候选容器的 [first,last) 中的迭代器之一。由于您使用的是矢量容器，因此您有一个随机访问迭代器，您可以使用小于运算符快速执行此检查。

您必须知道要预先检查的所有候选向量，这不是获取迭代器所属容器的一般方法。

但是，您可以通过使用包含指向创建向量的指针的东西来装饰随机访问迭代器来定义随机访问迭代器的扩展。这可能有点不优雅、低效和不方便。所以先看看你是否可以重写代码来避免这种需要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T19:09:07.153

STL 不允许这样做。

例如，Vecor 迭代器可以简单地实现为指针。并且没有通用的方法可以从指向对象已分配的某些数据的指针中检索对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T18:54:53.907

我不相信有一种公开的方法可以做到这一点。原因是，这不是迭代器的目的。当然，没有技术原因迭代器不能持有指向其父容器的指针。即使它以不需要该指针的方式实现，它仍然可以保存它。

迭代器旨在对集合进行迭代，因此，它们提供了执行此操作所必需的接口，并且仅此而已。这是很好的面向对象编程原则。

请问您的用例是什么，您需要知道带有迭代器的容器的“范围”吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T19:16:35.233

如前所述，最好重写您的代码，这样您就不需要这种行为。这就像拿着硬币一样，但除非你在纸上注明，否则你不知道它是从哪里来的。

如果您无法重写代码，您仍然可以引入一个包含指向容器和迭代器本身的指针的包装对象。你具体需要这个做什么？

# asp.net - 向网络服务帐户授予对 ASP.NET Web 应用程序的读/写权限有什么危险？

> ID：375604
> 
> 赞同：5
> 
> 时间：2008-12-17T18:47:22.157
> 
> 标签：asp.net, permissions, service, networking

向网络服务帐户授予对 ASP.NET Web 应用程序的读/写权限有什么危险？我必须为我的应用程序需要写入的任何目录执行此操作，例如我的 VistaDb 数据库的 App_Data 以及一些用于上传图像和更改文本文件等的随机目录。这样做有什么危险？是否可以只为网络服务的整个 Web 应用程序授予读/写权限？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T19:04:38.393

**在共享主机**中或在同一台服务器上运行多个网站时，会遇到向网络服务帐户授予文件夹写入权限的最大安全风险。

基本上，如果您授予修改权限，则服务器配置为作为网络服务运行的所有其他 ASP.NET 应用程序（默认情况下）也将具有对该文件夹的写入权限，这可能会被利用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T19:04:45.103

这样做的危险在于网络服务是一个共享帐户，并且在该帐户下运行的任何应用程序或服务都可以访问该目录。

根据您使用的 IIS 版本，您可以将 Web 应用程序放在单独的应用程序池中，并让它在不同的用户帐户下运行。然后，您可以专门授予该用户而不是网络服务的访问权限。这仅在 IIS 6 或更高版本中可用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T19:07:01.727

那么直接的危险是网络服务当然可以读/写这些文件夹，但是每个微软 - 这个帐户是权限有限的最低权限机器帐户。如果您在域中，更好的方法可能是使用域帐户 - 有关两者的详细信息，请访问[http://msdn.microsoft.com/en-us/library/ms998320.aspx](http://msdn.microsoft.com/en-us/library/ms998320.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-20T19:35:25.533

好的，所以如果我能弄清楚如何让您的应用程序将文件写入文件系统，因为您授予对*整个*应用程序的虚拟目录的读/写权限，我现在可以为您的网站编写一个 aspx 文件，调用它并运行任意代码，包括 WMI 调用和 COM 互操作等很酷的东西。

您是否有时间和资源最终证明我不能使用您的应用程序（包括您未编写的部分，例如框架本身）将文件写入您的网站？为什么不排除设置 ntfs 权限如此便宜（时间上）的可能性呢？

现在，如果您仅授予 App_Data 权限，即使我确实向该文件夹写入了一个 aspx 文件，我也无法调用它，因为 App_data 文件夹被运行时视为特殊文件夹，并且不会从那里提供任何文件（以免有人只是调用[http://yourserver.com/app_data/data.mdb](http://yourserver.com/app_data/data.mdb)并通过简单地下载文件来破解您的数据库）。显然 App_Data 中的这些文件可以通过使用 ADO 等来访问，但这不是安全问题。

# java - 序列化 JENA OntModel 更改

> ID：375605
> 
> 赞同：1
> 
> 时间：2008-12-17T18:48:23.263
> 
> 标签：java, serialization, jena, ontology

我需要在一个套接字上保持几个[Jena](http://jena.sf.net)模型（特别是 OntModels）同步，并且我想一次做一个更改（出于各种原因——一个是从 OntModels 添加或删除的每个 Statement 是还适应了 JESS 规则库。）。我能够监听 OntModels 上的添加/删除事件，然后创建简单的事件实例，这些实例将添加/删除的语句与指示添加或删除语句的 ChangeType 一起包装，但序列化语句已被证明是问题。

不幸的是，我发现的所有 JENA 序列化文档都与将整个模型序列化为 xml / rdf / n3 / 等有关。由于语句只是字符串的三元组（无论如何，在一个级别上），它似乎应该是微不足道的在语句级别序列化数据。然而，[Jena](http://jena.sf.net)似乎没有提供一个 API 来创建带有“做正确的事情”的纯字符串的语句。类型化文字会出现问题。例如：

我可以创建语句：

```
<http://someuri/myont#foo> <http://someuri/myont#weight> "50.7"^^www.w3.org/2001/XMLSchema#double 
```

但我可以得到的字符串版本如下所示：

```
"http://someuri/myont#foo" "http://someuri/myont#weight" "50.7^^www.w3.org/2001/XMLSchema#double" 
```

（注意^^前没有“）

这不是什么大问题，因为文字仍然可以用正则表达式解析出来，但我无法使用正确的文字创建语句。显而易见的方法 (ModelCon.createStatement(Resource, Property, String)) 生成一个无类型的字符串文字，其中包含传入的字符串的完整值。

有谁知道我如何可靠地序列化（当然还有反序列化）单个 Jena 语句？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-10T00:51:20.280

我会以 N-TRIPLES 格式序列化这些更改。Jena 具有内置的 N-TRIPLES 序列化器和解析器，但 N-TRIPLES 语法（故意）非常简单，因此很容易在您的代码中手动生成。

但是，保留一个普通的 mem 模型来保存更改可能更容易，让事件处理程序将更改写入该模型，然后根据您的同步计划通过线路序列化该模型。同样，在远端，我会将同步通道中的更新读取到临时内存模型中，然后`yourOntModel.add( changesModel )`应该非常直接地添加更新。

伊恩

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-05T14:42:29.067

不是我深入研究过的领域，但我记得 Talis 正在做一些研究，并且能够[按照面包屑导航](http://n2.talis.com/wiki/Changeset_Protocol)到名为“Changeset”的相关词汇。

[http://vocab.org/changeset/schema](http://vocab.org/changeset/schema)

我很惊讶您在使用 JENA 序列化单个语句时遇到问题，但也许如果您根据变更集架构创建一个图表并序列化该图表，您会有更多的运气？或者，将语句添加到新图并序列化一个三元组的图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T16:45:04.877

也许您应该尝试将 createStatement 的 String 参数替换为 Model.createLiteral(String)...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T00:05:26.003

我最终得到的解决方案如下。由于时间限制，我最终使用了 reg-ex 方法（直到最近我才看到关于这个问题的其他建议）

这可能不是最好的方法，但它似乎运作良好（我已经使用一个测试套件对其进行了审查，该套件可以练习我此时需要处理的用例）。

该`createStatement(...)`方法位于 OntUtilities 助手类中。

```
 /**
    * Serialization output method.
    * 
    * @param out
    * @throws IOException
    */
   private void writeObject(final ObjectOutputStream out) throws IOException {
     out.defaultWriteObject();
     out.writeObject(_statement.getSubject().getURI());
     out.writeObject(_statement.getPredicate().getURI());
     out.writeObject(_statement.getObject().toString());
   }

   /**
    * deserialization method.
    * 
    * @param in
    * @throws IOException
    * @throws ClassNotFoundException
    */
   private void readObject(final ObjectInputStream in) throws IOException, 
      ClassNotFoundException {
     in.defaultReadObject();

     final String subject = (String)in.readObject();
     final String predicate = (String)in.readObject();
     final String object = (String)in.readObject();

     _statement = OntUtilities.createStatement(subject, predicate, object);
   }

   /**
    * Creates a statement from a triple of strings.  These strings may be fully
    * qualified uris, or shortened "namespace" uris (eg: shai:TST)
    * 
    * @param sub The resource uri (the subject)
    * @param pred The predicate uri (the property)
    * @param ob The object uri.
    * @return A JENA Statement.
    */
   public static Statement createStatement(final String sub, final String pred,
         final String ob) {
      final Model m = ModelFactory.createDefaultModel();

      final String s = OntUtilities.nsUriToUri(sub);
      final String p = OntUtilities.nsUriToUri(pred);
      final String o = OntUtilities.nsUriToUri(ob);

      Statement stmt = null;
      try {
         // try making a uri as a syntax-verification step.
         new URI(o);
         // it was valid, so well use o as a resource:
         final Resource obj = m.createResource(o);
         stmt = m.createStatement(m.createResource(s), m.createProperty(p), obj);
      } catch (final URISyntaxException e) { 
         // o was *not* a uri.
         if (o.contains("^^")) {
            final int idx = o.lastIndexOf("^^");

            final String value = o.substring(0, idx);
            final String uri = o.substring(idx+2);

            final Literal lit = m.createTypedLiteral(value, getDataType(uri));

            stmt = m.createStatement(m.createResource(s), m.createProperty(p), lit);
         } else {
            // just use the string as-is:
            stmt = m.createStatement(m.createResource(s), m.createProperty(p), o);
         }
      }
      return stmt; 
   } 
```

# python - 防止 ftplib 下载正在进行的文件？

> ID：375620
> 
> 赞同：4
> 
> 时间：2008-12-17T18:54:03.843
> 
> 标签：python, ftp, ftplib

我们有一个 ftp 系统设置来监控/从不受我们控制的远程 ftp 服务器下载。该脚本连接到远程 ftp，并获取服务器上文件的文件名，然后我们检查它是否已下载。如果尚未下载，则我们下载文件并将其添加到列表中。

我们最近遇到了一个问题，远程 ftp 端的某个人将复制一个巨大的单个文件（> 1GB），然后脚本将唤醒并看到一个新文件并开始下载正在复制的文件。

检查这个的最好方法是什么？我想抓住文件大小等待几秒钟再次检查文件大小，看看它是否增加了，如果没有，那么我们下载它。但是由于时间很重要，我们不能为每个文件集等待几秒钟，看看它的文件大小是否增加了。

最好的方法是什么，目前一切都是通过pythons ftplib完成的，除了使用上述方法之外，我们怎么能做到这一点。

让我再次重申这一点，我们对远程 ftp 站点的控制为 0。

谢谢。

更新1：

我在想如果我尝试重命名它会怎样......因为我们对 ftp 拥有完全权限，如果文件上传正在进行中，重命名命令会失败吗？

我们在这里没有任何真正的选择……是吗？

UPDATE2：这里有一些有趣的东西，我们测试过的一些 ftps 似乎会在传输开始后自动分配空间。

例如，如果我将一个 200mb 的文件传输到 ftp 服务器。如果我连接到 ftp 服务器并在上传时进行大小调整，则传输处于活动状态。它显示大小为 200mb。即使文件只完成了 10%。

权限似乎也是随机设置的，IIS 附带的 FTP 服务器在文件复制完成后设置权限。而其他一些较旧的 ftp 服务器会在您发送文件时立即设置它。

:'(

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T19:49:01.270

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T19:03:45.930

您无法知道操作系统副本何时完成。它可能会放慢速度或等待。

为了绝对确定，您确实需要两个文件。

*   海量文件。
*   还有一个很小的触发文件。

他们可以随心所欲地处理大量文件。但是当他们触摸触发文件时，您正在下载两者。

* * *

如果您无法获得触发器，则必须平衡轮询所需的时间与下载所需的时间。

做这个。

1.  获取列表。检查时间戳。

2.  检查大小与以前的文件大小。如果大小甚至不接近，则现在正在复制它。等待; 循环这一步，直到大小接近以前的大小。

3.  虽然你还没有完成：

    一种。获取文件。

    湾。再次获取列表。检查新列表、先前列表和您的文件的大小。如果他们同意：你就完成了。如果他们不同意：下载时文件已更改；你还没有完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T19:19:30.253

正如您所说，您对服务器的控制为 0，并且无法按照 S. Lott 的建议让您的客户发布触发文件，您必须处理不完善的解决方案并冒着文件传输不完整的风险，可能需要等待一段时间并比较文件大小之前和之后。

您可以尝试按照您的建议重命名，但由于您拥有 0 控制权，您无法确定 ftp-server-administrator（或其继任者）不会更改平台或 ftp 服务器或限制您的权限。

对不起。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T19:23:06.000

如果您正在处理多个文件，您可以一次获取所有大小的列表，等待十秒钟，看看哪些是相同的。无论哪个仍然相同，都应该可以安全下载。

# zend-framework - Zend框架如何在域中建立多表继承？

> ID：375639
> 
> 赞同：2
> 
> 时间：2008-12-17T18:59:01.073
> 
> 标签：zend-framework, orm, multiple-inheritance

我有一个数据库结构，其中包含一个 Person 表，其中包含名称、电子邮件、company_id、personType 等字段。因为不是所有的人都必须是系统用户的，所以我有一个单独的表用户，它为系统中的用户定义用户名和密码。

我有以下代码来定义人员表的表数据网关：

```
class Model_Table_Person extends Zend_Db_Table_Abstract
{
    protected $_name = 'person';
    protected $_primary = 'person_id';

    protected $_referenceMap = array(
        'Company' =>    array(
            'columns' => 'company_id',
            'refTableClass' => 'Company',
            'refColumns' => 'id'
        ),
        'Store' =>  array(
            'columns' => 'store_id',
            'refTableClass' => 'Store',
            'refColumns' => 'id'
        )
    );

    public function findByPersonType(string $personType)
    {
        $where = $this->getAdapter()->quoteInto('personType = ?', $personType);
        return $this->fetchAll($where);
    }
} 
```

这段代码定义了 Person 的域对象：

```
class Model_Person
{
    protected static $_gateway;

    protected $_person;

    public static function init()
    {
        if(self::$_gateway == null)
        {
            self::$_gateway = new Model_Table_Person();
        }
    }

    public static function get(string $searchString, string $searchType = 'id') 
    {
        self::init();

        switch($searchString)
        {
            case 'id':
                $row = self::$_gateway->find($id)->current();
                break;
        }

        return self::factory($row);
    }

    public static function getCollection(string $searchString, string $searchType = null)
    {
        self::init();

        switch($searchType)
        {
            case 'userType':
                $row = self::$_gateway->findByPersonType($searchString);
                break;
            default:
                $personRowset = self::$_gateway->fetchAll();
                break;
        }

        $personArray = array ();

        foreach ($personRowset as $person)
        {
            $personArray[] = self::factory($person);
        }

        return $personArray;
    }

    public function getCompany()
    {
        return $this->_person->findParentRow('Company');
    }

    public function getStore()
    {
        return $this->_person->findParentRow('Store');
    }

    protected static function factory(Zend_Db_Table_Row $row) 
    {
        $class = 'Model_Person_' . ucfirst($row->personType);
        return new $class($row);
    }

    // protected constructor can only be called from this class, e.g. factory()
    protected function __construct(Zend_Db_Table_Row $personRow)
    {
        $this->_person = $personRow;
    }
} 
```

最后，我有另一个用户表数据网关：

```
class Model_Table_User extends Zend_Db_Table_Abstract
{
    protected $_name = 'user';
    protected $_primary = 'person_id';

    public function findByUserName()
    {

    }
} 
```

还有一个像这样扩展 Model_Person 表的基本类：

```
class Model_User extends Model_Person
{       
    public function login()
    {

    }

    public function setPassword()
    {

    }   
} 
```

如何正确扩展“Model_User”类（它为除一个以外的所有其他类型的用户提供基本类型）以使用映射到一个表的“Model_Person”类函数，同时还将实际的“Model_User”函​​数映射到使用第二张桌子？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T19:29:14.117

这是 PHP（5.3.0 之前的版本）的一个巨大弱点——它缺乏对[后期静态绑定](http://php.net/oop5.late-static-bindings)的支持。

也就是说，当一个静态方法如`get()`调用另一个静态方法如 时`init()`，它*总是*使用`init()`该类中定义的方法。如果一个子类定义了一个替代方法`init()`并调用`get()`，期望它调用被覆盖的版本`init()`，这不会发生。

```
class A
{
  static $var = null;
  static function init() { self::$var = 1234; }
  static function get() { self::init(); }
}

class B extends A
{
  static function init() { self::$var = 5678; }
}

B::get();
print B::$var . "\n"; 
```

这将打印“1234”，而您可能希望它打印“5678”。好像`A::get()`不知道这是课堂的一部分`B`。解决方法是您必须将方法的实现复制`get()`到子类中，即使它与超类没有什么不同。 **这是很不满意**的。

PHP 5.3.0 试图解决这个问题，但你必须在以下代码中稍有不同`get()`：

```
function get() {
  static::init();
} 
```

PHP 5.3.0 目前仍处于 alpha 版本。

* * *

有几种可能的解决方法：

*   不要子类`Person`化为`User`，而是将登录名和密码属性添加到`Person`类中。如果这些属性是 NULL，那么它是一个非用户的人，并且函数`login()`应该`setPassword()`注意这一点并抛出异常或返回 false 或其他东西。

*   对每个子类型使用不同的`get()`方法： `getUser()`、`getPerson()`等。这些方法中的每一个都将初始化其各自的 Table 对象。

# c++ - 是否需要 C++ 中的#includes 的特定顺序是不良库/头文件设计的标志？

> ID：375647
> 
> 赞同：12
> 
> 时间：2008-12-17T19:02:10.567
> 
> 标签：c++, include, library-design

我使用了一些非常大规模的系统，从未见过所需的订单，但最近遇到了。STL 或 STD 库甚至 Boost 是否存在某些包含必须以特定顺序出现的情况？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-17T19:13:34.833

> STL 或 STD 库甚至 Boost 是否存在某些包含必须以特定顺序出现的情况？

对于标准，答案是肯定的，**不**。我想Boost也是如此，尽管我没有查过。

来自 C 标准：

> 标准标题可以以任何顺序包含；每个都可以在给定的范围内多次包含，与仅包含一次没有任何不同，除了包含的效果`<assert.h>`取决于`NDEBUG`（见 7.2）的定义。

C++ 标准有类似的措辞。

我的偏好是标题应该包含它们自己的依赖项，但我曾与认为这是“浪费”的人合作过。在我看来，不让标头包含它们的依赖项是一个毫无价值的早期优化。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-17T19:05:19.237

这听起来绝对是一个糟糕的设计。如果以某种方式需要特定顺序，则库应提供*一个*标头，其中包含按*正确*顺序的其他标头。

至于 boost 和 STL，我很确定我还没有遇到过这种情况。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-17T19:58:55.743

需要以特定顺序指定包含几乎总是表明存在设计问题。减少无意中执行此操作的可能性的一种方法是练习将类的头文件作为第一个#include 包含在实现文件中。

```
// A.cpp
#include "A.h"
#include "boost/shared_ptr.hpp"
#include <vector>

class A {
// ...
}; 
```

这样，例如，如果 Ah 使用没有正确 #include 的向量，A.cpp 将无法编译。

我不记得我在哪里捡到的；它可能来自 Lakos 的“Large Scale C++ Design”（一本真正可以使用更新的好书）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T19:05:52.027

> STL 或 STD 库甚至 Boost 是否存在某些包含必须以特定顺序出现的情况？

我从来没有遇到过这种情况，如果是这样，那么必须尽快通知作者。哦，是的，这是一个非常糟糕的设计。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-17T19:11:30.970

那是“坏事”。已经提到了更好的方法；但我会详细说明。

> ```
> //a.h
> #ifndef _A_H_
> #define _A_H_
> 
> //... code ...
> 
> #endif
> // -----------------
> //b.h
> #ifndef _B_H_
> #define _B_H_
> #include a.h
> 
> //... code ...
> 
> #endif
> // -----------------
> //main.cpp Try 1
> #include "b.h" //<- okay!  b includes a, then does b
> // -----------------
> //main.cpp Try 2
> #include "a.h" //<- includes a
> #include "b.h" //<- okay!  b includes a, but skips redefining it, then does b
> // -----------------
> //main.cpp Try 3
> #include "b.h" //<- b includes a, then does b
> #include "a.h" //<- okay!  a skips redefining itself!
> // -----------------
> //main.cpp Try 4
> #include "a.h" //<- fail!  b is not included anywhere =( 
> ```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-18T08:03:47.650

将项目级兼容性头文件（比如 compat.h）作为任何 .c/.cpp 源文件的*第一*个头文件是一种常见的技术，它定义了一堆必需的宏，如 __STDC_LIMIT_MACROS、__REENTRANT 和其他项目范围的宏来影响标准标题的后续行为。

很久以前，我第一次看到这种用法是由一位称职的程序员用于内部库的。后来我看到“git”（臭名昭著的 dvcs）项目也使用了这种技术。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-17T19:05:57.020

如果标题中包含的函数和/或类（例如，Ah）依赖于另一个标题（例如，Bh）中定义的函数和/或类，我更愿意将后者包含在第一个中，而不是强制第一个的用户一个以特定顺序包含两者。

是的：

```
// A.h
#pragma once
// or the #ifndef trick
#include "B.h"

// A.cpp
#include "A.h" 
```

不：

```
// A.h
#pragma once
// or the #ifndef trick
//#include "B.h"

// A.cpp
#include "B.h"
#include "A.h" 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-17T20:15:51.807

我喜欢按字母顺序包含标题 - 可以轻松查看我已经完成的工作。

如果一个库因为顺序错误而无法工作，那么它就坏了，应该被修复以便与顺序无关。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-18T00:03:35.437

对我来说，这是一个糟糕的设计，如果我没记错的话，不幸的是，它恰好在带有 socket/socket2 的 win32 API 中。结果是包含顺序中的错误将触发一组错误，这些错误恰好来自无处，并且在依赖项更改定义但代码仍然编译的情况下可能难以调试。

在任何其他情况下，您仍然会遇到麻烦。如果您不包含标头 xh 因为 yh 已经包含它，那么您的代码依赖于 yh 对 xh 的依赖 如果稍后 yh 被重构并且不再需要 yh，则删除包含将破坏您的代码库。这是耦合的标志（即使不是在类级别）：代码库的一部分中的更改需要传播并扩展到代码的其他部分。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-18T00:17:38.077

这可能表明您正在使用 MFC，这反过来又可能表明设计不佳（开玩笑……或者是吗？）

（至少，我上次看MFC的时候，对你包含的地方真的很挑剔`<windows.h>`）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T23:22:00.997

据我所知不是。这是非常糟糕的做法。不过，我最近在我的代码中遇到了一个 Windows 标头和一些奇怪的界面。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-18T00:07:06.507

您应该使用包含警卫和前向声明，这样您就不应该对包含标题的顺序有太大问题。

有时仍然需要首先或最后包含标题，不知道为什么。
（例如：在源 SDK 中）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-23T18:06:43.637

是的，要求 C++ 中包含的特定顺序是不良库/头文件设计的标志。

尽管前向声明可能需要包含多个文件才能完全使用一个类。请参见下面的示例：

//啊

```
class B; // forward declaration

class A
{
    void doStuff(const B& b);
}; 
```

// main.cpp

```
#include <A.h>
#include <B.h>

int main()
{
    A a;
    B b;
    a.doStuff(b);
} 
```

# session - ASP 网页注销用户

> ID：375648
> 
> 赞同：0
> 
> 时间：2008-12-17T19:02:27.057
> 
> 标签：session, authentication, asp-classic

我最近得到了一个较旧的 ASP Web 应用程序来维护。我没有接触太多，据我了解，实际的 VB6 项目文件已经消失，所以我只有 ASP 文件本身可以使用。最近，用户开始抱怨被注销，有时是在一分钟或更短的时间内。我尝试了自己，并登录了一次，单击了另一个链接，该链接在显示页面内容之前检查身份验证，但在返回页面并让它显示内容之前必须再次登录。这种行为似乎是刚刚冒出来的，因为没有人碰过它，而且之前也没有表现出这种行为。关于从哪里开始的任何建议？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T23:17:29.207

由于存储用户会话的方法有很多，如果没有更多信息，很难判断这里发生了什么。

如果用户被“随机”注销，这表明您正在使用 Session 对象来存储身份验证信息。可能会发生以下情况之一：

1.  IIS 正在回收（重新启动）您的应用程序。这会吹走您的 Session 对象。更多信息：http: [//msdn.microsoft.com/en-us/library/ms525803.aspx](http://msdn.microsoft.com/en-us/library/ms525803.aspx)

2.  这有点基本，但是您是否在某种负载平衡配置中使用了多个 Web 服务器？会话对象是特定于机器的。

另一种可能。即使您不使用 Session 对象，这也适用。我已经多次看到这种情况发生。

3.  您的应用程序是否可以通过多个 URL 访问？换句话说，[http://www.mysite.com](http://www.mysite.com)和[http://mysite.com](http://mysite.com)。Cookie（和会话）是特定于域的，它们被视为两个独立的域。由于诸如将来自两个域的页面添加为书签或由于您的站点内的非相对链接/重定向等因素，它们可能会在两个站点之间反弹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T19:05:48.407

身份验证令牌是否存储在 cookie 中，而 cookie 现在已在您的浏览器中关闭？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T19:07:53.940

是否可能更改了应用程序的配置参数？还是 IIS 配置（或更新版本的 IIS）？是否有任何系统级别的更改？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T19:22:05.397

如果没有人修改任何内容，也没有人登录该框，您是否考虑过进行 iisreset 以确保您不会追逐一些罕见的怪事？我讨厌诉诸于 iisreset 但当一切都失败时......

如果您可以提供更多信息，例如身份验证类型、其存储方式（客户端 cookie 或其他方法）等……我们可能会提供更多帮助。

祝你好运

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T19:24:16.687

你用什么来维持状态？您是否有可能因为 webfarm/webgarden 场景而失去会话？我已经看到事情运行良好很长一段时间，然后突然之间，应用程序（好的，asp.net）开始选择/选择它想要与之通信的 proc。

# vim - vim 路径 var，不包括 ** 匹配的目录

> ID：375651
> 
> 赞同：7
> 
> 时间：2008-12-17T19:04:14.417
> 
> 标签：vim

我最喜欢的 vim 功能之一是能够做到

```
set path=/my/project/root/** 
```

然后使用

```
:find SomeClassFile.java 
```

唯一的问题是，我在该级别有一些生成的目录，我无法移动并希望从此类搜索中排除。我似乎无法弄清楚如何排除这些目录。任何人都知道如何/如果可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T19:17:51.783

我很确定您不能从`"**"`搜索中排除某些内容。相反，您可以指定该子目录下*不*包含生成代码的所有子目录，例如

```
set path=/my/project/root/src/**,/my/project/root/com/**,/my/project/root/foo/** 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T20:16:35.190

我不知道使用 vim 语法的方法，但是您可以自己创建一个 .vimrc.proj 文件（我的命名约定）并用您想要的与该项目相关的任何内容填充它，然后“获取”它。

因此，您将在 /my/project/root/.vimrc.proj 中有以下内容（使用 Paul Tomblin 的示例）：

设置路径=/my/project/root/src/**,/my/project/root/com/**,/my/project/root/foo/**

然后从 vim 内部：

:source /my/project/root/.vimrc.proj

基本上，一旦您设置了文件，设置项目路径的击键次数将相似。当然，您也可以在其中放置其他项目特定的设置，例如 cscope 映射或其他。

诚然，它在文件系统中留下了“删除”，但许多其他环境创建了项目文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-18T16:24:34.333

它应该由 &wildignore 选项处理。然而，AFAIK，它没有。我确实发布了关于这个主题的错误报告，但从那以后我没有看到任何补丁。

同时，我开发了一个类似 globpath 的函数，它会忽略包含不需要的模式的路径（如 /CVS/ eg），并且我在类似 find 的命令中使用了这个函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-10-13T02:00:35.130

`"**"`我认为您可以通过设置`wildignore`变量从搜索中排除事物。

例如：

```
set wildignore+=*.swp,*.bak,*.class 
```

或链接此：

```
set wildignore+=*/node_modules/*,*/public/lib/* 
```

现在，如果您使用`find`命令，它不会在这些目录中搜索。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-18T16:52:05.993

如果您使用的是类 unix 系统，则可以使用反引号来运行如下命令行脚本：

```
:e `find . -name foo.java -print` 
```

因此，您可以编写自己的脚本来排除您想要的任何目录。我做了类似的事情来从 .svn 目录中排除 .svn 目录`:grep`。

有关更多信息，请参见`:h backtick-expansion`vim。

# java - 如何调试 Spring NoSuchBeanDefinitionException

> ID：375656
> 
> 赞同：2
> 
> 时间：2008-12-17T19:04:58.270
> 
> 标签：java, spring, testing

我们有一个（非 Web 应用程序）Spring 应用程序，它在 CruiseControl 持续集成 linux 机器上运行测试时抛出 NoSuchBeanDefinitionException。该测试在 Eclipse 中的 Windows 上运行良好。

在 getBean() 方法上抛出异常：

```
ApplicationContext context = new ClassPathXmlApplicationContext(CONTEXT_FILE);

MyBean bean = (MyBean)context.getBean("myBean"); 
```

上下文文件相当大且复杂。上下文文件在类路径中，Spring 正在找到它。如果 Spring 在尝试加载上下文文件并构建依赖项时会抛出异常，我会更喜欢它，这样我们就可以知道从哪里开始。有没有办法强制 Spring 在创建上下文时抛出异常？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T13:43:49.953

解决了。CONTEXT_FILE 中“myBean”的实例化发生在另一个依赖它的 bean 之后。这确实不应该是一个问题，但我怀疑 Linux 机器上的解析器必须更严格。无论如何，改变定义的顺序使它在 Windows 和 Linux 上都可以工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T19:10:51.940

您确定 CONTEXT_FILE 中有一个名为“myBean”的 bean 吗？您是否使用了多个上下文文件？您是否打开了 Spring 的日志记录以验证 CONTEXT_FILE 是否正确加载，此外，Spring 从类路径加载的文件是您认为应该加载的确切文件？

我认为您可能正在为您的问题寻找错误的解决方案——我从未见过 Spring 抛出 NoSuchBeanDefinitionException 异常，除非您要求的 bean 未在上下文中定义，就这么简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-03T15:51:08.713

我有同样的问题。事实证明，这是一个微妙的类路径问题。具体来说 - 我在 linux 上的类路径已设置，因此包含我的 build.xml 文件的配置目录位于我的 x-jars（外部 jars）目录之后 - 并且正在从我的 x-jars 中提取一些其他 beans.xml，如日志消息正确地说，不包含所需的 bean。如果 beans.xml 文件的完整路径已与 Spring 错误消息一起记录，那将会有所帮助。

# open-source - 我如何让 IT 相信 F/OSS 软件不是邪恶的？

> ID：375678
> 
> 赞同：7
> 
> 时间：2008-12-17T19:12:22.217
> 
> 标签：open-source, policy

在尝试将一些完善的工具链接到我公司的活动目录时，我遇到了障碍。有人告诉我：

> “抱歉，我无法信任 [F/OSS] 软件的域管理员密码……”。

这个问题专门涉及**如何让 IT 相信 F/OSS 软件不会（自动）因为它是 free/oss 而比任何其他软件更值得信赖**。

我在采用 OSS 软件方面做得很好（我本质上是一个 linux 忍者）所以换一种说法：**我如何才能在我的公司促进对 OSS的*接受？***

在没有管理员帐户的情况下绑定 AD 的技术问题是另一篇文章。

* * *

**编辑：**

我对这些问题有了一些澄清。这实际上与活动目录几乎没有关系，而通常与 F/OSS 的信任有关。所以我认为我原来的粗体问题仍然有效，只需忽略关于“管理员密码”的部分。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T19:26:15.887

任何称职的 IT 人员都会很清楚开源软件的好处。

给我的答案对我来说听起来像是一个手掌般的答案，为什么他们不想实现它的一些可能性可能是：

*   可能缺乏对特定软件开源软件的企业级支持
*   不希望非 IT 部门员工修改活动目录（您）
*   您发现的软件没有其他同类产品的行业认可度
*   对于 IT 部门需要他们完成的工作（在初始设置和持续维护中）没有感知到的好处

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-17T19:42:03.093

我是系统管理员。从我的角度来看，这个问题与信任开源软件无关。您的 IT 人员提到了一个特定案例，说他不信任域管理员用户名和密码。我认为他可能关心存储该用户名和密码的软件。如果这实际上是它的工作原理，我会拒绝开源或商业软件的请求。没有正确设置的系统应该需要存储域管理员用户名和密码，可能是具有较低凭据的帐户，或者取决于工具是否是交互式的，它设置为在运行时请求凭据并针对域进行身份验证。

最重要的是，您需要与 IT 合作，以更好地了解您和他们的需求。事情不必总是只是一个是或否的问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-17T19:18:54.200

我会这样尝试：

为什么开源软件的可信度不如封闭源软件？如果有的话，其代码的透明度将要求它在密码等私人数据存储方面更加值得信赖，因为任何破坏它的企图都可以通过检查源代码来发现。

当然，这仅在公司自己编译源代码并且不信任二进制分发时才有效。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T19:29:09.890

询问他们是否已阅读**许可证**，因为这也是他们反对的。具体询问他们**许可证**中的哪些内容对他们来说是个问题。如果他们真正抵制的是开源软件，那么这是与抵制 GPL 不同的问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-17T19:38:12.930

为什么不以非域管理员身份运行？我可以理解为什么他们不想为任何软件提供域管理员密码。特别是如果只有一个“域管理员”帐户。

您如何确定运行软件所需的权限并请求仅具有这些权限的新帐户。您可以说服他们将其放在不同的 OU 中，并进行额外的审核。如果软件提供了价值，您正在为他们创建一个“审核”并决定信任 OSS 的流程。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T19:25:39.663

准确地确定他对 F/OSS 软件的不信任之处，然后您可以调整您的解释来解决他的顾虑。

*   是否担心后门被编码？
*   是否担心导致安全风险的代码质量？
*   是否担心安全风险将在多长时间内得到解决？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-17T19:43:06.040

“如何让 IT 相信 F/OSS 软件不会（自动）因为它是免费/开源软件而比任何其他软件更值得信赖。”

“如何促进我公司对 OSS 的接受？”

你不能。

你能做的只有以下。

1.  找到他们当前使用的 F/OSS。这可能很难。在某些情况下，这是微不足道的，因为许多人使用 Apache 和 Java 时没有考虑它。

2.  询问您将使用的内容与他们已经使用的内容有何不同？

这将为恰好一个新的 F/OSS 提供理由。或者，他们会发疯并驱逐他们一直在使用的东西。

你无法做出普遍的理解。您一次只能制作一个具体的详细案例，直到其他人开始自己拼凑全局。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-17T20:22:06.477

有时他们不是，有时他们是。你需要证据来支持你的想法。

**CVE 编号不会说谎。**访问[http://cve.mitre.org/](http://cve.mitre.org/)、[http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)、[http://www.secunia.com](http://www.secunia.com)并比较您的同系列产品的商业版和 OSS 版d 选择。

看看哪个更好，有时这是因为 OSS 产品真的很垃圾，例如 PHPNuke，但有时在安全性方面，例如 qmail，它非常好。

另外不要忘记您需要选择一个拥有良好社区的 OSS 解决方案，否则您可能会看到该项目在一年后就死了。*这在商业世界中是可能的，但让我们面对它不太可能*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-17T19:28:18.033

我会把责任交给 IT 来证明他们的情况。简单地问“为什么不？”，或者可能是“你有什么证据表明这比非 GPL 软件更不安全？”。如果他们试图给出一些解释，你可以采取其他一些建议来向他们解释他们的误解。如果他们只是顽固地坚持自己的立场，那么他们就是在阻碍你做你的工作——而且没有充分的理由。轻轻地向他们解释你是如何发现了为公司增加价值的令人难以置信的价值（即免费）软件，并且你确信更高级别的管理人员会希望你利用它。希望这会提醒他们没有证据。如果连这都失败了而且很重要，那么您可以将其带到更高的管理级别，但要谨慎行事，因为这是制造敌人的可靠方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-17T19:50:03.497

你想用什么工具？制定有关使用这些工具将节省多少时间/$$ 的商业案例。举出使用这些工具的其他非常成功的公司（想到谷歌）的例子。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T19:58:31.467

首先也是最重要的，确保 IT 部门的这些决定被记录在某个地方。电子邮件什么的。如果您因此无法有效地完成工作，请确保您有足够的文档来将责任转移到它所属的地方。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-18T02:40:08.520

超越 IT。您的系统管理员可能会遵循公司其他地方（通常是法律部门）制定的规则。如果是这种情况，您可能有一位不了解软件或 FOSS 的公司律师对公司律师对未知事物的典型反应做出反应——禁止这样做。在证明成本和安全优势后，您可能需要要求公司联系 FOSS 领域的法律专家。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-12-17T19:54:29.200

您在谈论 Windows 管理员。只需指出 MSFT 如何处理最近的安全问题（例如最近主流媒体告诉人们使用备用浏览器的 IE 漏洞），并询问 OSS 如何变得更糟。

# asp.net - ASP.Net 本地化和绑定控件

> ID：375680
> 
> 赞同：1
> 
> 时间：2008-12-17T19:13:09.767
> 
> 标签：asp.net, data-binding, localization

当我本地化一个使用绑定控件（DetailsView 等）的 asp.net 页面时，该页面使用 <%# Bind() #> 语法绑定了 TemplateFields，在本地化之后，所有绑定都被删除，我必须返回& 重新绑定一切。我通过切换到设计视图，然后从菜单中的工具/生成本地资源来创建本地化资源文件。

有没有其他人看到过这个问题，如果是这样，您对解决方法有什么建议吗？

前：

```
<asp:TemplateField HeaderText="First Name:">
    <InsertItemTemplate>
        <uc:FirstNameTextBox runat="server" ID="FirstName" ValidationGroup="Main" Text='<%# Bind("FirstName") %>' />
    </InsertItemTemplate>
</asp:TemplateField> 
```

后：

```
<asp:TemplateField HeaderText="First Name:" meta:resourcekey="TemplateFieldResource1">
    <InsertItemTemplate>
        <uc:FirstNameTextBox runat="server" ID="FirstName" ValidationGroup="Main" />
    </InsertItemTemplate>
</asp:TemplateField> 
```

* * *

编辑：看起来它只是我自己的失去绑定的用户控件。我尝试将 Bindable 和 Localizable(false) 属性添加到属性中，但这似乎没有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T20:12:22.563

刚刚发现这个... [http://blog.smart-ms.ordina.nl/Generate+Local+Resource+Files.aspx](http://blog.smart-ms.ordina.nl/Generate+Local+Resource+Files.aspx)

似乎完全不用修改您的 ASPX 文件就可以做到这一点......我还没有在母版页/用户控件上运行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T19:43:33.853

是的！我遇到过这种情况，但也发生在用户控件上。那么这是一个正常的问题吗？我不知道如何解决它。

出于兴趣，是否可以从菜单中使用工具-> 生成本地资源来构建资源文件？我通常已经将我的 meta:resourcekey 标签附加到我的可本地化内容控件上，并且不希望它为其他任何内容而更改它。

# java - Java Mvc 截屏视频和教程？

> ID：375701
> 
> 赞同：0
> 
> 时间：2008-12-17T19:18:40.567
> 
> 标签：java, model-view-controller

我想看看如何在 Eclipse + Java + Mvc 框架上制作博客？有人看到这样的事情吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-09T10:51:25.583

甚至更好地尝试[appFuse](http://appfuse.org/display/APF/Home)框架来构建 Java Web 应用程序。选择一个 mvc 框架并使用 maven 命令添加项目文件。看看教程

# .net - 从 .aspx 页面调用 SSIS，赋予 NT AUTH\Network Service 帐户什么权限？

> ID：375703
> 
> 赞同：0
> 
> 时间：2008-12-17T19:19:14.730
> 
> 标签：.net, ssis

当我使用 LoadPackage() 从 .aspx 页面（或 Windows 服务）调用 SSIS 包时，如何设置权限以使其正常工作？

事件查看器报告 Sql server 错误：

用户“NT AUTHORITY\NETWORK SERVICE”登录失败。原因：无法打开明确指定的数据库。[客户：192.168.73.118]

如何让该帐户访问我的 sql 服务器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T08:51:13.987

我认为您不应该更改网络服务的权限。这将增加 Sql Server 的安全风险，因为 ASP.NET 或作为 NETWORK SERVICE 运行的任何其他服务的危害都会危害 Sql Server。在 ASP.NET 进程中运行 SSIS 也存在可靠性问题。

我建议使用一些特定的用户帐户在 ASP.NET 进程之外运行 SSIS。

查看有关以编程方式运行 SSIS 的各种方法的一些想法：http: [//blogs.msdn.com/michen/archive/2007/03/22/running-ssis-package-programmatically.aspx](http://blogs.msdn.com/michen/archive/2007/03/22/running-ssis-package-programmatically.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T19:21:28.360

授予它访问权[http://msdn.microsoft.com/en-us/library/ms998320.aspx](http://msdn.microsoft.com/en-us/library/ms998320.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T13:06:43.993

Are you running a non-english Operation System?

For some reasons, some account names like "NT Authority\Network Service" has been localized in other languages.
Sadly, a lot of programs have the account names hard coded to the english names, and won't find the account when running on foreign versions of Windows.

# javascript - 检测加载 iframe 内容失败

> ID：375710
> 
> 赞同：61
> 
> 时间：2008-12-17T19:20:59.470
> 
> 标签：javascript, html, firefox-addon, frames, xulrunner

*我可以使用load*事件检测 iframe 的内容何时加载。不幸的是，就我的目的而言，这有两个问题：

*   如果加载页面时出现错误（404/500 等），则永远不会触发 load 事件。
*   如果某些图像或其他依赖项无法加载，则加载事件将照常触发。

有什么方法可以可靠地确定是否发生了上述任何一个错误？

我正在编写一个基于 Mozilla/XULRunner 的半网页半桌面应用程序，因此欢迎仅在 Mozilla 中工作的解决方案。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-17T19:38:50.243

如果您可以控制 iframe 页面（并且这些页面在同一个域名上），则策略可能如下：

*   在父文档中，初始化一个变量`var iFrameLoaded = false;`
*   加载 iframe 文档时，将父级中的此变量设置为`true`从 iframe 文档调用父级函数`(setIFrameLoaded();`（例如）。
*   使用对象检查`iFrameLoaded`标志`timer`（将计时器设置为您首选的超时限制） - 如果标志仍然为假，您可以判断 iframe 没有定期加载。

*我希望这有帮助。*

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-22T16:29:23.707

我最近遇到了这个问题，不得不求助于在父页面（包含 IFRAME 标记）上设置 Javascript 轮询操作。这个 JavaScript 函数检查 IFRAME 的内容中是否应该只存在于 GOOD 响应中的显式元素。这当然假设您不必处理违反“同源政策”的情况。

而不是检查可能从许多不同的网络资源产生的所有可能的错误。我只是检查了一个我知道应该有良好响应的恒定正元素。

在预定时间和/或尝试检测预期元素的失败次数后，JavaScript 修改 IFRAME 的 SRC 属性（从我的 Servlet 请求）一个用户友好的错误页面，而不是显示典型的 HTTP 错误消息. JavaScript 也可以很容易地修改 SRC 属性以发出完全不同的请求。

```
function checkForContents(){
var contents=document.getElementById('myiframe').contentWindow.document
if(contents){
    alert('found contents of myiframe:' + contents);
    if(contents.documentElement){
        if(contents.documentElement.innerHTML){
            alert("Found contents: " +contents.documentElement.innerHTML);
            if(contents.documentElement.innerHTML.indexOf("FIND_ME") > -1){
                openMediumWindow("woot.html", "mypopup");
            }
        }
    }
} 
```

}

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2019-03-01T22:09:54.297

这是一个很晚的答案，但我会把它留给需要它的人。

**任务：** *加载 iframe 跨域内容，`onLoaded`在成功和`onError`加载错误*时发出。

这是我可以开发的最跨浏览器来源的独立解决方案。但首先，我将简要介绍一下我采用的其他方法以及它们为什么不好。

**1\. iframe**这对我来说有点震惊，iframe 只有`onload`事件，它在加载和错误时调用，无法知道它是否错误。

**2\. performance.getEntriesByType('resource')**。此方法返回加载的资源。听起来像我们需要的。但可惜的是，Firefox 总是在资源数组中添加资源，无论它是加载还是失败。无法通过`Resource`实例知道它是否成功。照常。顺便说一句，这个方法在 ios<11 中不起作用。

**3.脚本**我尝试使用`<script>`标签加载html。遗憾的是，仅在 Chrome 中正确`onload`发射。`onerror`

当我准备放弃时，我的老同事告诉我关于 html4 tag 的事`<object>`。它就像`<iframe>`标签，只是它在未加载内容时有回退。这听起来像我们所需要的！可悲的是，这并不像听起来那么容易。

**代码部分**

```
var obj = document.createElement('object');

// we need to specify a callback (i will mention why later)
obj.innerHTML = '<div style="height:5px"><div/>'; // fallback

obj.style.display = 'block'; // so height=5px will work
obj.style.visibility = 'hidden'; // to hide before loaded

obj.data = src; 
```

在此之后，我们可以将一些属性设置为`<object>`我们想要使用的`iframe`. 唯一的区别是，我们应该使用`<params>`，而不是属性，但它们的名称和值是相同的。

```
for (var prop in params) {
    if (params.hasOwnProperty(prop)) {
        var param = document.createElement('param');
        param.name = prop;
        param.value = params[prop];

        obj.appendChild(param);
    }
} 
```

现在，最困难的部分。像许多类似的元素一样，`<object>`没有回调规范，因此每个浏览器的行为都不同。

*   *铬*。出错和加载时会发出`load`事件。
*   *火狐*。发射`load`并`error`正确。
*   *野生动物园*。什么都不发射……

似乎与`iframe`, `getEntriesByType`, `script`... 没有什么不同。但是，我们有原生浏览器后备！所以，因为我们直接设置了fallback(innerHtml)，所以我们可以判断是否`<object>`加载了

```
function isReallyLoaded(obj) {
    return obj.offsetHeight !== 5; // fallback height
} 
```

```
/**
 * Chrome calls always, Firefox on load
 */
obj.onload = function() {
    isReallyLoaded(obj) ? onLoaded() : onError();
};

/**
 * Firefox on error
 */
obj.onerror = function() {
    onError();
}; 
```

但是如何处理 Safari？好老`setTimeout`。

```
var interval = function() {
    if (isLoaded) { // some flag
        return;
    }

    if (hasResult(obj)) {
        if (isReallyLoaded(obj)) {
            onLoaded();
        } else {
            onError();
        }
    }

    setTimeout(interval, 100);
};

function hasResult(obj) {
    return obj.offsetHeight > 0;
} 
```

是的……没那么快。问题是，`<object>`当失败在规范行为中未提及时：

1.  尝试加载（大小=0）
2.  确实失败（大小=任何）
3.  后备（大小 = 与 innnerHtml 相同）

所以，代码需要一点增强

```
var interval = function() {
    if (isLoaded) { // some flag
        return;
    }

    if (hasResult(obj)) {
        if (isReallyLoaded(obj)) {
            interval.count++;
            // needs less then 400ms to fallback
            interval.count > 4 && onLoadedResult(obj, onLoaded);
        } else {
            onErrorResult(obj, onError);
        }
    }

    setTimeout(interval, 100);
};
interval.count = 0;

setTimeout(interval, 100); 
```

好吧，开始加载

```
document.body.appendChild(obj); 
```

**仅此而已**。我试图详细解释代码，所以它可能看起来不那么愚蠢。

**PS** WebDev 很烂

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-09T20:02:42.857

我认为 pageshow 事件是针对错误页面触发的。或者，如果您是从 chrome 执行此操作，则检查进度侦听器的请求以查看它是否是 HTTP 通道，在这种情况下您可以检索状态代码。

至于页面依赖，我认为您只能通过添加捕获 onerror 事件侦听器从 chrome 中做到这一点，即使那样它也只会发现元素中的错误，而不是 CSS 背景或其他图像。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-02T18:55:12.250

为您的 iframe 中加载的页面中最顶部的（正文）元素设置一个 id。

在 iframe 的 Load 处理程序上，检查 getElementById() 是否返回非空值。如果是，则 iframe 已成功加载。否则它失败了。

在这种情况下，输入 frame.src="about:blank"。确保在执行此操作之前删除负载处理程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-08-22T15:20:37.227

没有准确回答你的问题，但我对答案的搜索把我带到了这里，所以我发帖以防万一其他人对我有类似的疑问。

它并没有完全使用加载事件，但它可以检测网站是否可访问和可调用（如果是，则理论上应该加载 iFrame）。

起初，我想像其他人一样进行 AJAX 调用，只是它最初对我不起作用，因为我使用了 jQuery。如果您执行 XMLHttpRequest，它会完美运行：

```
var url = http://url_to_test.com/
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status != 200) {
        console.log("iframe failed to load");
    }
};
xhttp.open("GET", url, true);
xhttp.send(); 
```

**编辑：**
所以这个方法工作正常，除了它有很多误报（拿起很多会在 iframe 中显示的东西）由于跨域恶意。我解决这个问题的方法是在服务器上执行 CURL/Web 请求，然后检查响应标头 a) 网站是否存在，以及 b) 标头是否已设置`x-frame-options`。

如果您运行自己的网络服务器，这不是问题，因为您可以为它进行自己的 api 调用。

我在 node.js 中的实现：

```
app.get('/iframetest',function(req,res){ //Call using /iframetest?url=url - needs to be stripped of http:// or https://
   var url = req.query.url; 
    var request = require('https').request({host: url}, function(response){ //This does an https request - require('http') if you want to do a http request
        var headers = response.headers;
        if (typeof headers["x-frame-options"] != 'undefined') {
            res.send(false); //Headers don't allow iframe
        } else {
            res.send(true); //Headers don't disallow iframe
        }
    });
    request.on('error',function(e){
       res.send(false); //website unavailable
    });
    request.end();
}); 
```

# microcontroller - 微控制器 + Verilog/VHDL 模拟器？

> ID：375719
> 
> 赞同：15
> 
> 时间：2008-12-17T19:23:59.277
> 
> 标签：microcontroller, simulator, verilog, vhdl

多年来，我参与了许多基于微控制器的项目。主要是Microchip的PIC。我使用过各种微控制器模拟器，虽然它们有时会很有帮助，但我经常发现自己很沮丧。在现实生活中，微控制器永远不会单独存在，固件的行为取决于环境。但是，我使用的模拟程序都没有为微控制器之外的任何东西提供良好的支持。

我的第一个想法是在 Verilog 中对整个电路板进行建模。但是，我宁愿不创建一个完整的 CPU 模型，而且我没有太多运气为我使用的芯片找到现有模型。无论如何，我真的不需要或不想在那个细节级别上模拟 proc，我想保留常规处理器 sim 提供的调试工具。

在我看来，理想的解决方案将是一个混合模拟器，它将传统处理器模拟器与 Verilog 模型接口。

这样的事情存在吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T17:18:23.260

我使用了嵌入在 FPGA 上的 Altera Nios II 处理器。Altera 提供了一个工具链，用于在模拟器中模拟 CPU（及其软件）以及您的自定义逻辑。我想可以通过下载 CPU 的 VHDL/Verilog 内核来实现类似的设置（你尝试过 opencores 吗？那里有很多东西）。

但请记住，它的速度会慢得令人难以置信，所以不要指望以这种方式模拟整个复杂的过程。您可以期望的最好的结果是模拟精细的软件-硬件交互点来调试问题。如果您需要更深入的仿真，请考虑在具有内置监控代码的 FPGA 上运行它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T12:31:50.763

对于“模拟整个电路板”的方法，The Free Model Foundry 有大量的模型，有些是 VHDL 的，有些是 Verilog 的，现在可用。但你需要付费才能创建新模型。这些对于确保正确构建电路板非常有帮助。

但我认为调试 PIC 时更常见的方法是只构建一个板，然后在固件上工作。在芯片世界中，（固件在尚未进入晶圆厂的芯片中的微处理器上运行）人们经常求助于非常昂贵的系统（或在其上租用时间），这些系统允许将设计的一部分编译到仿真器中而其余的设计在正常的模拟器环境中运行。如果没有昂贵的芯片掩模组的障碍，电路板的成本是不合理的。虽然我听说过 Simulink (Mathworks) 与 FPGA 的一些创造性应用，但我记得有人要么在计算机上运行系统，要么对设备进行编程并实时运行相同的东西。

我相信如果您有钱花在 Cadence（询问 Palladium）和 Mentor Graphics 的集成解决方案上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T22:01:44.933

我最近所做的是在模拟环境和主机系统之间创建一个接口。不同的 hdl 模拟器有不同的接口，让模拟器不以批处理模式思考，传统的模拟模型，而是像真正的设计一样永远运行是问题的一半。

然后从使用 C（或其他）的主机上，您可以创建抽象，这些抽象可能允许也可能不允许您为任何目标编写应用程序软件（取决于您拥有的语言和编译器功能）。例如，您可以制作一个通用的 poke 和 peek 函数，并在最终目标上拥有那些实际 poke 和 peek 内存或 I/O，但是对于通过抽象进行的模拟，您可以与模拟相同内存周期的模拟测试台对话。

我更进一步，在主机和测试台之间使用了（Berkeley）套接字，这样模拟可以在主机应用程序停止和启动时继续运行。与拥有一个带有操作系统的真实处理器不同，您正在启动应用程序并运行它们以完成并启动另一个。至少对于测试应用程序，对于交付，您可能只有一个应用程序。

通过创建这些抽象层，我可以编写真正的应用程序，这些应用程序将在构建目标时使用。在此过程中，您最初可以使用逻辑的软件模拟，然后如果您喜欢使用抽象接口（丢弃逻辑）构建一个 fpga，例如说一个 uart。用 uart 接口或其他方式替换应用程序抽象层和模拟器之间的 shim。然后，当您将处理器和逻辑结合在同一个芯片或同一个板上时，再次用直接调用他们一直在与之交谈的任何接口替换抽象层。如果出现问题并且您保留了抽象层，您可以将应用程序带回仿真模型并访问所有内部逻辑。

特别是这一次，我使用的是 sourceforge 上的 hdl 语言循环 cdl，文档需要一些帮助，但示例可能会让你继续前进，它会产生可合成的 verilog，所以你会在那里获得额外的胜利。除了连接和启动 C 仿真模型所需的最低限度之外，我扔掉了所有脚本批处理的东西。所以我的测试台是用 C 语言（从技术上讲是 C++），套接字层是在那里完成的。输出可以是 gtkwave 使用的 .vcd 文件。基本上，您可以使用没有许可证等的开源软件来完成大部分 HDL 设计。通过向 CDL 仿真部分添加一两行代码，我可以让它作为无限循环运行，我可以说它有效很好，似乎没有任何内存泄漏等。

modelsim 和 cadence 都有将宿主 C 程序连接到仿真世界的标准化方法，从那里您可以使用 IPC 来访问与抽象层 api 对话的宿主应用程序。

这对于一张照片来说可能有点矫枉过正，无论如何，我已经放弃了照片，以获得更快和基于 C 的基于手臂的 micros。有/曾经有一个开放的核心图片，您可以简单地将其合并到您的模拟中，即使这不是您在这里想要做的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-08T18:42:26.103

不是我见过的。最好的办法是正确定义 uC 和 FPGA 之间的接口和行为，然后定义一系列可以使用自动测试仪应用的测试波形。您必须使用 FPGA 或 uC（应用波形、观察中断、断点等）制作自动化测试仪（或者逻辑分析仪可能具有某些此类功能）。如果你真的想知道 Opencores.org 有定义为 VHDL 的 PIC 和类似 AVR 的 8 位 uC 内核，那么你可以在 FPGA 上实现你的整个项目，然后调试它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T19:55:20.557

通常不需要在 RTL 级别对 CPU 进行建模。因为你并不真正关心它一点一点地做了什么；您通常关心它的作用，例如寄存器值、存储器和总线访问。

最简单的是调用总线功能模型。这只是生成 CPU 所做的读取和写入，通常基于文本文件。这些可用于某些 CPU 和许多流行的总线（例如 PCI、PCIe）。这些模拟超快。

下一步是功能周期精确模型。那些模拟速度很快。它们通常是加密的。

最后是完整的 RTL 模型。这些通常只有在您与 CPU 供应商密切合作时才可用，例如在您的 ASIC 中使用他们的内核。通常这些都是加密的，除非你是一家大公司。

内存模型通常是周期精确的（例如美光）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T19:32:57.103

我硬件部门的同事经常使用 FPGA 仿真软件来查找时序错误并追踪奇怪的行为。

模拟一到两毫秒可能需要几个小时，因此除了非常小的事情外，使用模拟器是不可行的。

不过，您可能想看看 SystemC。[http://en.wikipedia.org/wiki/SystemC](http://en.wikipedia.org/wiki/SystemC)

# c++ - Boost.format 和宽字符

> ID：375722
> 
> 赞同：23
> 
> 时间：2008-12-17T19:24:58.930
> 
> 标签：c++, unicode, boost, format

有没有办法让 boost.format 使用和返回宽（Unicode）字符串？

我希望能够执行以下操作：

```
wcout << boost::format(L"...") % ... 
```

和

```
wstring s = boost::str(boost::format(L"...") % ...) 
```

这可能吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-17T19:29:00.560

`format_fwd.hpp`包含此类型定义：

```
typedef basic_format<wchar_t >  wformat; 
```

我想这会让你开始。这在这里有效：

```
std::wcout << boost::wformat(L"...") % ... 
```

还有`boost::str`作品使用`wformat`.

# osgi - OSGi 如何管理在不同 JVM 中运行的组件的交互？

> ID：375725
> 
> 赞同：13
> 
> 时间：2008-12-17T19:25:52.937
> 
> 标签：osgi

我一直试图在不阅读整个规范的情况下更多地了解 OSGi 的更广泛的图景。与许多事情一样，对OSGi 的实际[介绍](http://www.osgi.org/About/FAQ#q6)可能是由从事它工作了十年的人编写的，也许不适合将自己置于对它一无所知的人的心态中 :-)

看着 Felix 的例子`DictionaryService`，我真的不明白发生了什么。OSGi 是 JVM 的一个独特实例，您可以在其中加载可以相互找到的捆绑包？

显然**不仅** *如此*，因为 StackOverflow 上的其他答案明确表明 OSGi 可以解决包含部署在不同 JVM 中的模块的分布式系统的依赖问题（加上常见问题解答一直在谈论*网络*）。

在后一种情况下，在一个 JVM 中运行的组件如何与单独 JVM 中的另一个组件交互？这两个组件能否像在同一个 JVM 中运行一样“使用”彼此（即通过本地方法调用），以及 OSGi 如何管理跨网络的数据编组（`Serializable`例如，您是否必须使用）？

或者组件作者是否必须使用其他一些不同的机制（由 OSGi 提供或自己编写）在远程组件之间进行通信？

非常感谢任何帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T23:30:46.743

是的，OSGi 只处理在同一个虚拟机上运行的包和服务。然而，应该注意的是，OSGi 的一个独特特性是它促进了在同一个 JVM 上运行多个应用程序（以受控方式并共享公共模块）。

在访问客户端 JVM 之外的服务时，目前还没有标准化的解决方案。Paremus Infiniflow 和衍生的开源项目 Newton 使用 SCA 方法。即将发布的 4.2 版 OSGi 规范将解决问题的一方面，即如何使用通用分发软件，以便将远程服务带入客户端的 JVM。

正如有人提到 R-OSGi，这种方法还处理了问题的另一面，即如何管理分布式 OSGi 框架之间的依赖关系。由于 R-OSGi 不是通用分发软件，而是明确处理 OSGi 包的生命周期问题和依赖关系管理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-19T17:37:56.690

据我所知，OSGi 并没有开箱即用地解决这个问题。有 OSGi 捆绑包，例如[Remote OSGi](http://r-osgi.sourceforge.net/)，它允许程序员通过网络分发服务。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-28T11:11:24.140

还没有，我认为它正在为下一个版本工作。

但是一些公司已经实现了分布式osgi。我知道的是 Paremus 的 Infiniflow ( [http://www.paremus.com/products/products.html](http://www.paremus.com/products/products.html) )。在linkedin，他们也在努力解决这个问题。更多信息：[使用 osgi 构建 Linkedin 下一代架构，](http://www.slideshare.net/linkedin/building-linkedins-next-generation-architecture-with-osgi-presentation)这里：[Matt raible：构建 Linkedin 下一代架构](http://raibledesigns.com/rd/entry/building_linkedin_s_next_generation)

以下是对 OSGI 4.2 更改的总结：[关于 OSGi R4.2 草案的一些想法](http://osgi.mjahn.net/2008/08/28/some-thought-on-the-osgi-r42-early-draft/)，有一节关于 RFC-119 处理分布式 OSGi。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-18T11:39:26.810

AFAIK，包在同一个 JVM 中运行，但没有使用相同的类加载器加载（这就是为什么你可以同时使用同一个包的两个不同版本的原因）。

要与另一个 JVM 中的组件交互，您必须使用网络协议，例如 rmi。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T22:00:35.000

OSGi 联盟正在制定分布式 OSGi 的标准：

[http://www.osgi.org/download/osgi-4.2-early-draft2.pdf](http://www.osgi.org/download/osgi-4.2-early-draft2.pdf)

* * *

这个新标准甚至有一个早期的 Apache 实现：

[http://cxf.apache.org/distributed-osgi.html](http://cxf.apache.org/distributed-osgi.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-18T15:24:10.833

*@Patriarch24*

[这个问题](https://stackoverflow.com/questions/106222/what-does-osgi-solve)的公认答案似乎另有说明（除非我误读了它）。此外，取自常见问题解答：

> *OSGi服务平台提供了在各种网络*的设备上动态改变组合的功能，无需重启。

（强调我自己的）。尽管在同一个常见问题解答中将 OSGi 描述为*in-VM*。

为什么我对此感到如此困惑？为什么一个关于十年前技术的基本问题不清楚？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T23:10:32.297

OSGI 最初的问题更多是与代码的分配（然后是 bundle 的配置）有关，而不是与执行的分配有关。

关注分布式组件的人更倾向于 SCA

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-10T13:50:49.330

“介绍”链接并不是真正的介绍，它是一个常见问题解答条目。有关详细信息，请参阅[http://www.osgi.org/About/WhatIsOSGi](http://www.osgi.org/About/WhatIsOSGi)我认为不难找到。

无论如何，OSGi 是一个虚拟机内 SOA。也就是说，OSGi 框架是关于虚拟机内部发生的事情，它提供了一个框架来构建虚拟机内部的应用程序，因此您可以在很大程度上从组件构建它。所以核心与分布**无关**，它完全不知道谁实现了服务，它只是为模块提供了一种机制，以一种松散耦合的方式相互满足。

也就是说，µService 模型具体化了模块之间的连接，事实证明，您可以在为其他组件提供分发的框架之上构建支持。在上一个版本中，我们指定了一些机制，使其在核心中标准化，并提供可以管理分布式拓扑的特殊服务 Remote Service Admin。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-26T20:18:04.293

如果您正在寻找以 OSGi 为中心的分布式云运行时 - 那么 Paremus Service Fabric ( [https://docs.paremus.com/display/SF16/Introduction](https://docs.paremus.com/display/SF16/Introduction) ) 提供了这些功能。

一个或多个系统，每个系统都由许多 OSGi 程序集（蓝图或声明式服务）组成，可以在一组 OSGi 运行时框架（Knopflerfish、Felix 或 Equinox）中动态部署和维护。

提供了一个轻量级的 RSA 远程框架，默认情况下使用 DDS（一种非常好的中间件消息传递技术）提供服务发现 - （认为可以使用 ZooKeeper 和其他方法）。当前支持的远程处理协议包括 RMI 和 Avro。

问候

理查德

# html - 从语义上学习 HTML 的最佳网站是什么？

> ID：375763
> 
> 赞同：10
> 
> 时间：2008-12-17T19:40:12.877
> 
> 标签：html, css, semantics

我应该在哪里指导某人学习 HTML/CSS 的基础知识？我个人是从[HTMLGoodies](http://htmlgoodies.com/)开始的，虽然我感谢 Ken Burns 让我继续前进，但我现在不愿意派人去那个网站，因为我认为它已经过时了。

显然有很多网站累积包含所有需要的信息，但是在哪里发送你不想吓跑的新人呢？

* * *

编辑：

老实说，我以为我没有使用[w3schools.com](http://w3schools.com/)错过了一些东西，但我看到在教程的三页中（html 和 xhtml）他们使用`<b></b>`. 该死的耻辱，他们不鼓励语义。

任何人都知道一些让人们右脚离开的东西吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-17T20:23:34.537

我不敢相信有多少人在回答 w3schools。我不能推荐足够的人永远不会再提到这个地方。这是一个可怕的资源。

几个好地方：

**HTML5 的补充：http:** [//diveintohtml5.ep.io/](http://diveintohtml5.ep.io/)

[http://alistapart.com](http://alistapart.com)

[http://www.quirksmode.org/](http://www.quirksmode.org/)

[http://www.thinkvitamin.com/](http://www.thinkvitamin.com/)

不完整，但我们雇用的任何 Web 开发人员都需要阅读 alistapart.com。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-17T20:04:58.973

此外，永远不要低估在编写良好的网站上阅读源代码的力量。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-17T21:06:02.783

我不敢相信这里的人会推荐 W3Schools。这是我推荐任何人去的最后一个地方。

我会推荐用户前往的一个地方是 SitePoint。那里的很多文章都是针对高级用户的，尽管论坛的质量和初学者文章都太好了，不能通过。我也同意[迈克的](https://stackoverflow.com/questions/375763/whats-the-best-website-for-learning-html-semantically#375898)建议，将其作为发送一个完整新手的地方。

至于获得实用技能，我推荐的一件事是在文本编辑器模式下打开一个文本编辑器或一个好的 IDE，然后编写一个网站来看看会发生什么。前往[开源网页设计](http://www.oswd.org/)页面，看看其他人是如何创建基本布局的，然后将该技能应用到您自己的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-17T21:11:45.283

[HtmlDog](http://www.htmldog.com/)为初学者、中级和高级用户提供了一套很好的指南。它还为所有 HTML 和 CSS 提供了有用的参考。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-17T22:56:26.647

我真的很喜欢你的[HTMLsource](http://www.yourhtmlsource.com/)。Quirksmode 和 AlistApart 很棒。而[Ajaxian](http://ajaxian.com/)是更先进和更广泛的事物资源。我从 w3schools 开始，但很快这个网站就成了我最不喜欢的网站。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-17T20:12:43.983

[阅读本书](http://www.zeldman.com/dwws/)（Zeldman 使用 Web 标准进行设计）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-01-25T06:37:16.830

为了使这个问题的答案保持最新，截至 2011 年， [Opera Web 课程](http://dev.opera.com/articles/view/1-introduction-to-the-web-standards-cur/)是学习前端 Web 开发的最佳方式。它是全面的，鼓励最佳实践，对于那些完全不熟悉该领域的人来说，它通常是一种优越的资源。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-05-17T07:05:34.873

我认为您应该检查[www.tutorialrepublic.com](http://www.tutorialrepublic.com)。这个网站有很棒的 HTML/CSS 教程。我从这个网站学习了 HTML/CSS，我真的很喜欢这个，他们非常清楚地解释了这个主题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-17T20:16:00.327

确切地说，我个人也是从 HTMLGoodies 开始的。我认为 tizag.com 更新更多。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-17T21:54:36.023

> 我不敢相信这里的人会推荐 W3Schools。这是我推荐任何人去的最后一个地方。对我来说这是一个很棒的......也许不是“”参考网站，但它是一个非常好的和实用的关于 html 和东西的备忘单......

htmldom 部分对我来说是最好的部分之一......

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-19T15:27:08.457

如果您说德语，学习 HTML 的最佳网站是： [http ://selfhtml.org](http://selfhtml.org)

# c# - 使用 datetime.addhours(-1) 时更新 datetime 对象的日期

> ID：375764
> 
> 赞同：1
> 
> 时间：2008-12-17T19:40:42.847
> 
> 标签：c#

我有一个 datetime 对象，我想删除一小时以在不同时区显示正确时间。我正在使用 datetime.addhours(-1) ，其中 -1 是一个配置值。这在大多数情况下都有效，除非我将时间设置为今天上午 12:59，它显示今天上午 11:59。什么时候应该显示 11:59 PM。是否可以让 addDays() 遵守日期？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T19:48:30.037

有一种方法可以帮助您处理时区：

```
TimeZoneInfo.ConvertTime(..) 
```

[连锁](http://msdn.microsoft.com/en-us/library/system.timezoneinfo.converttime.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T19:43:14.993

如何使用减法功能：

```
DateTime.Now.Subtract(new TimeSpan(1, 0, 0)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T19:46:00.933

我注意到您没有指定您使用的框架版本。如果您使用的是 2.0 SP1、3.0 SP1 或 3.5 SP1，您可能希望改用[DateTimeOffset](http://msdn.microsoft.com/en-us/library/system.datetimeoffset.aspx)结构。然后，您只需指定时区偏移量，一切都应该正常工作。

希望有帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T19:47:34.360

一般来说，如果您正在处理时区问题，您应该使用以 UTC 格式存储日期时间的函数，然后映射到正确的 TZ。

但是，如果这对您的应用程序来说太过分了，那么您正在做的事情是正确的。

```
DateTime datetime = new DateTime( 2008,12,17,0,59, 0 );
datetime = datetime.AddHours(-1); 
```

这导致时间为 2008 年 12 月 16 日晚上 23:59:00 或晚上 11:59。

您喂食的时间可能没有正确的上午/下午指示符。

# c# - 更好的数据表

> ID：375765
> 
> 赞同：2
> 
> 时间：2008-12-17T19:40:49.757
> 
> 标签：c#, linq

我有一个使用 DataTables 执行数据分组、过滤和聚合的应用程序。我想用我自己的数据结构替换数据表，这样我们就不会因为使用数据表而产生任何不必要的开销。所以我的问题是，Linq 是否可以用来对我的数据进行分组、过滤和聚合，它的性能是否可以与数据表相媲美，还是我应该蹲下来编写自己的算法来做到这一点？

谢谢

丹·R。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T19:56:27.260

除非您选择简单的类（POCO 等），否则您自己的实现可能具有几乎与`DataTable`. 就个人而言，我会更多地考虑使用 LINQ-to-SQL、实体框架等工具。然后，您可以针对本地数据使用 LINQ-to-Objects，或者针对复杂数据库查询使用特定于提供程序的实现，而无需提取所有数据给客户端。

LINQ-to-Objects 可以*完成*您提到的所有事情，但它涉及将所有数据保存在内存中。如果您有重要的数据，建议使用数据库。如果您查看 LINQ-to-SQL 或实体框架，SQL Server Express Edition 将是一个很好的起点。

* * *

编辑重新评论：

常规的 TSQL 命令很好，很花哨，但是您询问区别...最大的一点是 LINQ-to-SQL 将为您提供整个 DAL，这可以节省大量时间，并且可以获得更多的编译时安全性。但也允许您使用相同的方法查看本地对象和数据库 - 例如，以下是有效的 C# 3.0（[someDataSource] 除外，见下文）：

```
var qry = from row in [someDataSource]
          group row by row.Category into grp
          select new {Category = grp.Key, Count = grp.Count(),
              TotalValue = grp.Sum(x=>x.Value) };

foreach(var x in qry) {
    Console.WriteLine("{0}, {1}, {2}", x.Category, x.Count, x.TotalValue);
} 
```

如果 [someDataSource] 是本地数据，例如 a `List<T>`，这将在本地执行；但如果这是来自您的 LINQ-to-SQL 数据上下文，它可以在数据库服务器上构建适当的 TSQL。这使得在您的代码中使用单一查询机制成为可能（当然，在[LOLA](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)的范围内）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T20:35:48.053

你最好让你的数据库处理分组、过滤和聚合。DataTables 实际上在这类事情上比较擅长（它们的坏名声似乎主要来自不恰当的使用），但不如实际的数据库好。此外，如果您不做*很多*工作，我会把钱花在 DataTable 的性能上，它比您自己开发的数据结构具有更好的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T19:47:45.077

为什么不使用像 Sqlserver CE 或嵌入式 firebird 这样的本地数据库？（甚至是毫秒访问！:)）。将数据存储在本地数据库中，使用简单的 sql 查询进行处理并拉回数据。简单得多，开销可能更少，而且您不必为分组/聚合等编写所有逻辑，因为数据库系统已经内置、调试和工作了该逻辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T20:41:45.017

是的，您可以使用 LINQ 使用您的自定义对象来完成所有这些事情。

而且我注意到很多人建议您在数据库中执行此类操作……但您从未指出数据库的来源。

如果数据*来自*数据库，那么至少应该在那里进行过滤，除非您正在做一些专门的事情（例如，使用缓存的数据集）。即使那样，如果您正在处理大量缓存数据，您最好将这些数据放入像 SQLite 这样的嵌入式数据库中，正如其他人已经提到的那样。

# oracle - 你可以通过 DBLink 出列吗？

> ID：375768
> 
> 赞同：0
> 
> 时间：2008-12-17T19:41:37.150
> 
> 标签：oracle, advanced-queuing

我正在尝试从另一台服务器上的队列中出列。我无法使用传播将其发送到需要数据的服务器。如果我在出队选项中的队列名称中放置一个 dblink，则会出现错误。

```
Error at line 9
ORA-25200: invalid value prim_queues.prim_trade_q@prim_dbln, QUEUE_NAME should be [SCHEMA.]NAME
ORA-06512: at "SYS.DBMS_AQ", line 619
ORA-06512: at "PSINET_AQ.AQ_INBOUND_TRADES_PKG", line 20
ORA-06512: at line 10 
```

所以我猜这是不可能的。

相反，我会将 DEQUEUE 与队列一起放在服务器上的一个包中，然后通过链接调用该包。

这是正确的吗？

编辑：

Igor 提到使用动态 SQL，但我在服务器上放了一个包和队列。这也是在同一侧解析的。然后问题变成出队对象仅存在于该队列的服务器上。即使我们在对面有一个相同的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T22:35:52.010

您可以使用 DB 链接为动态 SQL（或匿名 PL/SQL 块）调用远程版本的 DBMS_SQL，这意味着该语句在远程数据库中被解析，但作为“本地”语句。

开始 dbms_sql.parse@dblink(...); 结尾;

# html - Silverlight、xhtml 和 100% 高度

> ID：375784
> 
> 赞同：2
> 
> 时间：2008-12-17T19:44:20.793
> 
> 标签：html, silverlight, xhtml

我有一个包含 2 行的 1 个表的 aspx 页面：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <style>
        html, body 
        { 
            height: 100%; 
        } 
        </style>
    </head>
    <body>
        <form id="form1" runat="server">
            <div>
                <asp:ScriptManager ID="ScriptManager1" runat="server">
                </asp:ScriptManager>
                <table style="height:100%; width:100%">
                    <tr>
                        <td>                
                            <img src="img/Logo.png" />
                        </td>
                    </tr>
                    <tr>
                        <td style="height:100%;">                     
                            <asp:Silverlight 
                                ID="sllUI" 
                                runat="server" 
                                Source="~/ClientBin/My.Silverlight.UI.xap" 
                                MinimumVersion="2.0.31005.0" 
                                Width="100%" 
                                Height="100%"
                                OnPluginLoaded="sllUI_OnPluginLoaded"
                                PluginBackground="Transparent"
                                Windowless="true">        
                            </asp:Silverlight>
                        </td>
                    </tr>
                </table>                            
            </div>
        </form>
    <body>
</html> 
```

表格正确填充页面，底部行填充增长到顶部行未填充的表格剩余高度，这就是我想要的。问题是silverlight控件采用页面的高度，而不是它所在行的高度，这导致我的页面出现滚动条，因为silverlight控件的顶部位于它所在行的顶部在，但它的高度是浏览器的 100%。我不知道这是由我的 html 还是由 silverlight 引起的。我所有的 silverlight 用户控件都设置为自动高度和宽度。我也尝试过使用 divs 而不是 table，我得到了相同的结果。我怎样才能解决这个问题？

我发现（至少在 IE7 中）我指定的 doctype 会导致它使用标准模式 IE6，但是如果我将 doctype 拿出来，它会进入怪异模式 IE5（我通过使用 DebugBar v5.1.1 找到该模式） . Quirks 模式会使其正确显示，但我认为如果我可以在标准模式下正确显示，我宁愿避免使用 Quirks 模式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T20:08:08.283

尝试删除控件中的“高度”和“宽度”属性，如果您已经正确定义了内部 XAP 的高度和宽度以进行缩放（即您使用了“自动”），那么它应该尊重它所包含的 DOM 边界在页面上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T20:04:06.217

尝试使用某种脚本来确定页面的总高度......像这样：

```
 function getWindowHeight() {
    var windowHeight = 0;
    if (typeof(window.innerHeight) == 'number') {
        windowHeight = window.innerHeight;
    }
    else {
        if (document.documentElement && document.documentElement.clientHeight) {
            windowHeight = document.documentElement.clientHeight;
        }
        else {
            if (document.body && document.body.clientHeight) {
                windowHeight = document.body.clientHeight;
            }
        }
    }
    return windowHeight;
} 
```

因此，您可以减去徽标高度并正确设置“身体”的高度，并对其进行调整以避免滚动。

# .net - 为 Web 应用程序设置负载平衡环境的最佳/正确方法是什么？

> ID：375787
> 
> 赞同：2
> 
> 时间：2008-12-17T19:45:31.510
> 
> 标签：.net, web-applications, load-balancing

我开发了一个需要在 4 个网络服务器之间进行负载平衡的网络应用程序。我的公司正在购买负载均衡器硬件 (Cisco)。关于如何告诉负载均衡器 Web 服务器应该在轮换中存在混淆。

IT 硬件支持团队希望我创建一个单页 Web 应用程序，该应用程序将位于主 Web 应用程序旁边。有人告诉我，这个小的单页应用程序应该调用数据库并在表上执行 INSERT、UPDATE 和 DELETE。然后应用程序应该返回一个状态码，然后负载均衡器将能够读取并确定是否让这个网络服务器保持轮换。此应用程序必须驻留在所有负载平衡服务器上。然后，负载均衡器将每 5 秒轮询一次单页应用程序。

我认为这听起来像是一个绝对的 HACK。这听起来像是数据库上不必要的工作和开销。硬件团队试图让我相信这是正确的方法。我完全不同意！我的论点是负载均衡器不应该关心数据库连接。我们只是试图在 4 个网络服务器之间分配负载。需要注意的一件事是主 Web 应用程序没有数据库连接就毫无用处。

负载均衡器本身是否有办法确定服务器是否应该在轮换中？这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T19:51:30.343

阅读[可扩展的互联网架构](https://rads.stackoverflow.com/amzn/click/com/067232699X)。

平衡器只能看到 Web 服务器。如果 Web 服务器出现，但无法与数据库通信（例如，Apache 正在运行但您的应用程序已损坏），那么当应用程序损坏时，您将遇到无响应服务器获取请求的问题.

我们有一个返回某些状态的自测应用程序。目前用于调试。将来，将与其他 HA 和负载分担解决方案一起使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T19:51:17.473

我总是在网络服务器上放置一个真正简单的 html 页面。如果 status.html 中的 HTTP 状态返回 200，则保持服务器轮换，如果不是，则暂停 Web 服务器。

如果您的数据库严重崩溃怎么办？在恢复时，您应该能够放置一条状态消息，上面写着“抱歉，很快回来”。您也不想重新配置负载均衡器。没有数据库可以运行您的应用程序的任何部分吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T20:29:23.310

这不是黑客攻击，而是一种检查**Web 服务器**心跳的常用方法。但是，在该页面中查询数据库是有争议的。例如，在数据库超时的情况下，您最终可能会在集群中没有 Web 服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T20:41:19.433

我相信这是一个黑客。负载均衡器应该只使用一个简单的 html 页面来返回负载均衡器，就像 JWMiller 说的那样。我们在所有应用程序中都使用这种方法。检查数据库连接、远程服务等是应用程序健康检查的工作，应该是一个单独的功能。

# python - 如何从内存数据创建 wx.Image 对象？

> ID：375820
> 
> 赞同：4
> 
> 时间：2008-12-17T19:54:46.483
> 
> 标签：python, wxpython, wxwidgets

我正在使用 wxPython 在 Python 中编写 GUI 应用程序，并且我想在静态控件 ( `wx.StaticBitmap`) 中显示图像。

我可以用来[`wx.ImageFromStream`](http://www.wxpython.org/docs/api/wx-module.html#ImageFromStream)从文件中加载图像，这可以正常工作：

```
static_bitmap = wx.StaticBitmap(parent, wx.ID_ANY)
f = open("test.jpg", "rb")
image = wx.ImageFromStream(f)
bitmap = wx.BitmapFromImage(image)
static_bitmap.SetBitmap(bitmap) 
```

但是，我真正想做的是从内存中的数据创建图像。所以，如果我写

```
f = open("test.jpg", "rb")
data = f.read() 
```

我怎样才能创建一个`wx.Image`对象`data`？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T20:08:11.900

您应该能够使用`StringIO`将缓冲区包装在内存文件对象中。

```
...
import StringIO

buf = open("test.jpg", "rb").read()
# buf = get_image_data()
sbuf = StringIO.StringIO(buf)

image = wx.ImageFromStream(sbuf)
... 
```

`buf`可以替换为任何数据字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T20:01:11.820

由于在 Python 中您使用 Duck Typing，您可以编写自己的流类并将该类的实例交给 ImageFromStream。我认为你只需要实现 read 方法并让它返回你的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-06-05T09:31:43.203

如果你是python3.x，你应该使用“ByteIO”和“ImageFromStream”来显示内存中的图片数据。注意，"BytesIO"的参数格式应该是b"\xff\xd8" 下图是代码： [BytesIO的参数格式](https://i.stack.imgur.com/IwNBA.png)

# functional-programming - 有哪些适合初学者的 Erlang Primers/Tutorials？

> ID：375827
> 
> 赞同：16
> 
> 时间：2008-12-17T19:57:16.307
> 
> 标签：functional-programming, erlang

一般来说，有哪些好的链接可以深入研究 Erlang 和函数式编程？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-02-15T17:08:19.770

这可能是一个很好的查看[http://learnyousomeerlang.com/](http://learnyousomeerlang.com/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-17T20:07:09.923

这是[Erlang 中并发编程的前半部分](http://www.erlang.org/download/erlang-book-part1.pdf)[PDF]，免费。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-17T20:23:05.787

我认为语言本身非常容易学习。我推荐[http://www.erlang.org/download/getting_started-5.4.pdf](http://www.erlang.org/download/getting_started-5.4.pdf)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-28T21:19:05.147

让我建议 Erlang 不一定是“一般的函数式编程”的典型。如果你想要一个很好的平衡，我会结合阅读一些已经引用的 Erlang 特定资源（或[Joe Armstrong 的书，*Programming Erlang: Software for a Concurrent World*](https://rads.stackoverflow.com/amzn/click/com/193435600X) [）和Haskell 网站上](http://www.haskell.org/)的一些教程链接。

# silverlight - 如何在 Silverlight 中创建已编译、可再分发的类库？

> ID：375828
> 
> 赞同：0
> 
> 时间：2008-12-17T19:57:40.410
> 
> 标签：silverlight, class-library

是否可以创建可在 Silverlight 应用程序中使用的小型库（类似于 Flash 或 Flex SWC 组件）？

因为我是一名 Flash 和 Flex 开发人员，所以我将把它联系起来。在 Flex 中，如果我有一个 SWC，我可以将它添加到我的构建路径中，然后立即在我的项目中使用它包含的类和函数。同样，在 Flash 中，如果我将 SWC 添加到 Components 文件夹，然后将该 SWC 拖到我的库中，我可以在我的 Flash 项目中使用这些类。

Silverlight 有类似的概念吗？我只需要一个可以发送给其他开发人员的小型代码库，但它应该是预编译的，因此源代码不容易获得。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T20:02:33.487

在 Visual Studio 中预编译“Silverlight 类库”项目类型应该不会像在传统 C# 库中那样遇到问题，并将这些发布给可以在 Silverlight 应用程序中引用它们的开发人员。

# java - Java接口继承与实现

> ID：375831
> 
> 赞同：3
> 
> 时间：2008-12-17T19:59:10.890
> 
> 标签：java, inheritance, interface

我在 apache camel 源代码中看到

```
public class DefaultCamelContext extends ServiceSupport implements CamelContext, Service 
```

我的问题是为什么这个定义因为

`public interface CamelContext extends Service`

并且

`public abstract class ServiceSupport implements Service`

难道不应该只是

```
public class DefaultCamelContext extends ServiceSupport implements CamelContext 
```

?

是否需要明确的“实施服务”而我遗漏了什么？一般来说，在任何情况下可能需要这样做吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T20:02:23.677

它不是必需的，但它向任何阅读代码的人强调它确实实现了服务 - 这意味着他们不需要查看 ServiceSupport 来找出它。

我自己不倾向于这样做，但这样做并没有*错*。

# .net - WPF GridSplitter 不适用于 WebBrowser 控件？

> ID：375841
> 
> 赞同：1
> 
> 时间：2008-12-17T20:03:42.253
> 
> 标签：.net, wpf, xaml, grid

我一直[在为 GridSplitter 苦苦挣扎](https://stackoverflow.com/questions/279557/how-do-i-keep-the-wpf-gridsplitter-from-changing-the-size-of-my-grid)。它似乎与 WPF WebBrowser 控件不兼容。

如果我调整我的窗口大小并移动 GridSplitter，那么我可以使我的网格比我的窗口更宽并且不可见。

前：

[WPF GridSplitter WebBrowser 之前 http://img239.imageshack.us/img239/4061/grid1vn8.gif](http://img239.imageshack.us/img239/4061/grid1vn8.gif)

之后：（注意滚动条）

[WPF GridSplitter WebBrowser http://img101.imageshack.us/img101/4303/grid2so0.gif 之后](http://img101.imageshack.us/img101/4303/grid2so0.gif)

我的 XAML...

```
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        MinWidth="450"
        Width="450"
        Height="300"
        Title="Window3">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="200" Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition MinWidth="200" Width="*"/>
        </Grid.ColumnDefinitions>
        <Button Name="Button2"
                Grid.Column="0"
                Margin="5"
                Content="Button2"/>
        <GridSplitter
            Width="2"
            Grid.Column="1"
            HorizontalAlignment="Center"
            Margin="5"
            Panel.ZIndex="1"
            VerticalAlignment="Stretch"
            ResizeBehavior="PreviousAndNext"
            ResizeDirection="Columns"/>
        <WebBrowser
            Grid.Column="2"
            Margin="5"
            Source="http://www.google.com"/>
    </Grid>
</Window> 
```

重现问题的步骤...

1.  将窗口的右边缘向右拖动到其宽度的两倍左右
2.  将拆分器向左拖到最远
3.  将窗口的右边缘向左拖到最远。

如何防止 GridSplitter 将我的 Grid 的大小更改为 Window 可以包含的大小？

有谁知道更多关于这个问题的信息？...或有解决方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T23:50:21.377

我能够在 ScrollViewer 中使用 Border 来重现这一点（但不是没有 ScrollViewer），所以我的猜测是滚动会以某种方式把它弄乱。

在左列上设置 MaxWidth （一个非常大的 MaxWidth 应该没有实际效果）似乎可以解决它：

```
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Height="300"
        MinWidth="450"
        Width="450"
        Title="Window3">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="200" Width="*" MaxWidth="10000"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition MinWidth="200" Width="*"/>
        </Grid.ColumnDefinitions>
        <Button
            Name="Button2"
            Grid.Column="0"
            Margin="5"
            Content="Button2"/>
        <GridSplitter
            Width="2"
            Grid.Column="1"
            HorizontalAlignment="Center"
            Margin="5"
            Panel.ZIndex="1"
            VerticalAlignment="Stretch"
            ResizeBehavior="PreviousAndNext"
            ResizeDirection="Columns"/>
        <WebBrowser Grid.Column="2" Margin="5" Source="http://www.google.com"/>
    </Grid>
</Window> 
```

似乎在某些时候，星型大小会覆盖没有剩余空间的事实，因此当左列达到 Width = 200，并且 GridSplitter 已将右列的星型大小更改为 3* 左右时，该列将是否有空间是600。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T20:53:15.743

我知道你可能已经厌倦了听到这个，但是当我使用上面的 XAML 时，我无法重现你的问题，稍微修改为纯 XAML：

```
（XAML 代码受到质疑。）
```

您的代码隐藏中是否存在导致该行为的内容？

# virtualization - .NET 3.5 开发的最佳虚拟开发平台

> ID：375847
> 
> 赞同：1
> 
> 时间：2008-12-17T20:04:59.443
> 
> 标签：virtualization, virtual-pc

我基本上已经屈服于这样一个事实，即如果你是一个铁杆计算机用户，你将不得不每隔几个月重新映像你的计算机，因为发生了一些不好的事情。正因为如此，我买了成像软件，然后真正进入了成像领域。我现在准备将我的开发环境完全移动到虚拟机中，这样我就可以像在开发网络上一样在 IIS 上测试站点（并轻松备份这些图像）。

问题是，对于 4 GB 笔记本电脑来说，最好的虚拟开发平台是什么？具有 3 GB 内存的虚拟 Vista Business、具有 3 GB 内存的 Windows XP sp3 或具有 3 GB 可用内存的 Windows Server 2003。

我需要安装的工具：

*sql server 2005 开发版
*vs 2008 sp1
*silverlight 的工具
*和多个其他较小的测试工具

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T20:18:12.443

我尝试了以下组合：

*   虚拟服务器 2005 R2 上的 Windows XP SP3
*   虚拟服务器 2005 R2 上的 Windows Vista Business x64
*   虚拟 PC 2007 上的 Windows XP
*   虚拟服务器 2005 R2 上的 Windows 2003
*   VMWare Fusion 上的 Windows XP

以及本地或托管在服务器上的虚拟服务器安装，它们都运行良好且速度大致相同。

在 OS X 下运行的 VMWare Fusion 虚拟机比其他虚拟机快得多。我还没有在 Windows 上测试过 VMWare，看看是 VMWare 还是硬件有所作为，但这是值得研究的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T20:22:01.017

Server 2008，转换为工作站。没有什么能比得上 IMO，我在过去 3 个月中加载了 3 个不同的操作系统，并且我设置在 Server 2008 上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T20:09:11.027

我认为最大的问题（从我的角度来看）是您是否会进行需要服务器平台的开发（如 SharePoint）。如果您预计会有大量 SharePoint 开发（或者可能是 Exchange、BizTalk 或其他需要在服务器平台上进行开发的产品），那么请使用 Windows Server 2003。如果没有，那么我可能会选择 XP，尽管 Vista不是一个糟糕的开发平台。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T20:19:41.160

我个人更喜欢在服务器平台上进行开发——但是，如果我开发任何类型的 WinForms 应用程序，这种观点可能会发生变化，因为它可以更准确地代表目标受众的操作系统系列。

我确实注意到从 Server 2003 到 Server 2008 的性能略有下降，这是我没有预料到的，但这可能更多是因为进行就地升级而不是开始清洁。

根据您提供的选项，我个人会选择 W2k3。您真的可以精简服务器操作系统以快速运行，尤其是当您没有或摆脱 MS“眼睛糖果”时。

# javascript - javascript中有没有办法获取所有打开的浏览器窗口的名称或计数？

> ID：375858
> 
> 赞同：0
> 
> 时间：2008-12-17T20:10:23.987
> 
> 标签：javascript

我的猜测是答案是否定的，但我只是好奇是否有人有任何想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T20:20:55.447

出于安全考虑，它是故意这样做的。所以你基本上是正确的，没有简单的方法。

但是，如果您正在运行打开窗口的 Web 应用程序，“主”窗口可以保留打开窗口的句柄列表。你可以像这样初始化一个数组：

```
var openWindows = []; 
```

然后有一个看起来像这样的窗口打开方法：

```
function openWindow(url, ... etc)
{
    var w = window.open(url, ... etc);
    openWindows[openWindows.length] = w;
} 
```

假设您使用此方法打开了所有其他窗口，并假设您可以继续使用该集合（如果主窗口导航到另一个页面，则该数组将丢失）您将获得窗口列表。您可以通过遍历数组并检查“window.closed”属性来找出其中有多少仍然打开。

# c# - 获取 .NET Framework 目录路径

> ID：375860
> 
> 赞同：75
> 
> 时间：2008-12-17T20:10:58.493
> 
> 标签：c#, .net, frameworks, directory

如何在我的 C# 应用程序中获取 .NET Framework 目录路径？

我指的文件夹是“C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727”

* * *

## 回答 #1

> 赞同：182
> 
> 时间：2009-01-23T04:32:29.350

当前.NET应用程序的活动CLR安装目录路径可以通过以下方法获取：

```
System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory() 
```

我**强烈**建议不要直接阅读注册表。例如，当 .NET 应用程序在 64 位系统中运行时，CLR 可以从“C:\Windows\Microsoft.NET\Framework64\v2.0.50727”（AnyCPU，x64 编译目标）或“C:\ Windows\Microsoft.NET\Framework\v2.0.50727"（x86 编译目标）。读取注册表**不会**告诉您当前 CLR 使用了两个目录中的哪一个。

另一个重要的事实是，对于 .NET 2.0、.NET 3.0 和 .NET 3.5 应用程序，“当前 CLR”将是“2.0”。这意味着即使在 .NET 3.5 应用程序（从 3.5 目录加载它们的一些程序集）中，GetRuntimeDirectory() 调用也将返回 2.0 目录。根据您对术语“.NET Framework 目录路径”的解释，GetRuntimeDirectory 可能不是您要查找的信息（“CLR 目录”与“来自 3.5 程序集的目录”）。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-12-17T20:39:33.680

一种更简单的方法是包含 Microsoft.Build.Utilities 程序集并使用

```
using Microsoft.Build.Utilities;
ToolLocationHelper.GetPathToDotNetFramework(
        TargetDotNetFrameworkVersion.VersionLatest); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T20:18:03.613

您可以从 Windows 注册表中获取它：

```
using System;
using Microsoft.Win32; 
```

// ...

```
public static string GetFrameworkDirectory()
{
  // This is the location of the .Net Framework Registry Key
  string framworkRegPath = @"Software\Microsoft\.NetFramework";

  // Get a non-writable key from the registry
  RegistryKey netFramework = Registry.LocalMachine.OpenSubKey(framworkRegPath, false);

  // Retrieve the install root path for the framework
  string installRoot = netFramework.GetValue("InstallRoot").ToString();

  // Retrieve the version of the framework executing this program
  string version = string.Format(@"v{0}.{1}.{2}\",
    Environment.Version.Major, 
    Environment.Version.Minor,
    Environment.Version.Build); 

  // Return the path of the framework
  return System.IO.Path.Combine(installRoot, version);     
} 
```

[来源](http://weblogs.asp.net/whaggard/archive/2003/05/23/7464.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-11-26T15:38:02.543

对于 .NET Framework 版本 >= 4.5，[来自 MSDN 的官方方式](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed#detect-net-framework-45-and-later-versions)：

```
internal static class DotNetFrameworkLocator
{
    public static string GetInstallationLocation()
    {
        const string subkey = @"SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full\";
        using (var ndpKey = RegistryKey.OpenBaseKey(RegistryHive.LocalMachine, RegistryView.Registry32).OpenSubKey(subkey))
        {
            if (ndpKey == null)
                throw new Exception();

            var value = ndpKey.GetValue("InstallPath") as string;
            if (value != null)
                return value;
            else
                throw new Exception();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-12-17T20:22:56.083

读取**[HKLM]\Software\Microsoft.NetFramework\InstallRoot**键的值 - 您将获得“C:\WINDOWS\Microsoft.NET\Framework”。然后附加所需的框架版本。

# ruby - 如何用 ruby 解析 word 文档？

> ID：375861
> 
> 赞同：14
> 
> 时间：2008-12-17T20:11:11.473
> 
> 标签：ruby, parsing, ms-word, ms-office

有谁知道我可以在 OS X/Linux 上使用来解析 Word 文件并将内容输出为 HTML 的库？

我看过win32ole，但据我所知，它仅适用于Windows，尽管我可能是错的。

有什么建议么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-17T22:25:36.150

Word 文档格式（暂时忽略 docx）很糟糕，并且在不断变化。恕我直言，这就是为什么有这么少（读取：零）Ruby 库来解析它们的原因。

我建议做的是使用 JRuby 和一些已建立的 Java 库来读取 doc 格式。谷歌应该帮助你：[http](http://schmidt.devlib.org/java/libraries-word.html) ://schmidt.devlib.org/java/libraries-word.html 。

有一个用于读取 MIcrosoft 文件格式的 Java 项目 POI ( [http://poi.apache.org/](http://poi.apache.org/) )，它们确实有 Ruby 绑定 ( [http://poi.apache.org/poi-ruby.html](http://poi.apache.org/poi-ruby.html) ) 但我我不确定这些是最新的。在他们的网站上，它说 Ruby 绑定适用于 1.8.2 ......

# vbscript - VBscript 中 RecordSet 对象的更新函数导致 DBISAM 解析错误

> ID：375866
> 
> 赞同：1
> 
> 时间：2008-12-17T20:14:22.170
> 
> 标签：vbscript, dbisam

在使用 DBISAM 4 ODBC 驱动程序时，我在使用 RecordSet 对象上的 Update 函数时遇到了困难。这是我的代码的样子。

```
dtmNewDate = DateSerial(1997, 2, 3)
 MsgBox(dtmNewDate)

'Create connection object & connection string

Set AConnection = CreateObject("ADODB.Connection")

strConnection = "Driver={DBISAM 4 ODBC Driver}; CatalogName=S:\RAPID\Z998\2008; ReadOnly=False"
Aconnection.Mode = adModeReadWrite

AConnection.Open strConnection

'create SQL statement to be run in order to populate the recordset

strSQLEmployeeBDate = "SELECT * FROM Z998EMPL WHERE state = 'NY'"

'Create Recordset object

Set rsRecSet = CreateObject("ADODB.Recordset")

rsRecSet.LockType = 2

rsRecSet.Open strSQLEmployeeBDate, AConnection

While Not rsRecSet.EOF 

  rsRecSet.Fields("BIRTHDATE").value = dtmNewDate

  rsRecSet.Update

  rsRecSet.MoveNext

Wend 
```

当我尝试执行此代码时，我收到以下错误：

```
"DBISAM Engine Error #11949 SQL Parsing error- Expected ( but instead found = in UPDATE SQL statement at line 1, column 336" 
```

我无法弄清楚是什么导致了这个错误。有没有人对造成它的原因有任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-18T20:39:05.037

[DBISAM 错误消息](http://www.resourcemate.com/support/index.html?DBISAMErrorMessages1)检查字段名称。

# jquery - 在 IE 7 中覆盖以防止在后台弄乱控件

> ID：375868
> 
> 赞同：3
> 
> 时间：2008-12-17T20:14:40.203
> 
> 标签：jquery, html, overlay

我没有一个独特的问题，但对于我的生活，我无法弄清楚我做错了什么。

我有一个包含一系列部分的页面。该部分的一部分是一个小图像。单击图像时，我想显示一个自定义控件。显示控件是微不足道的，将 z-index 设置得更高一点，以确保控件位于所有内容之上。

但是用户仍然可以与控件后面的部分进行交互。

为了阻止这种情况，我添加了一个“毯子”。基本上是一个 div，它是具有以下 CSS（在 jQuery 语法中）的文档大小 -

```
{
  position: 'absolute',
  top: 0,
  left: 0,
  width: '100%',
  height: $(document).height(),
  display: 'none',
  zIndex: 1,
  backgroundColor: '#FF0000'
}; 
```

是的...背景是红色的，所以我可以看到它进行测试。我将不透明度设置为 0.1（光模糊）。然后我将自定义控件的 z-index 设置为 2，使其位于毯子的顶部。

这在 FireFox、Chrome 和 Safari 中完美运行，但在 IE 中却不行。

自定义控件不是毯子的孩子。

目标是让以下文档被毯子覆盖，并在毯子顶部进行控制以与之交互。这是我在除 IE 之外的所有浏览器上得到的。在即...它可以控制文档，并且两者都被毯子覆盖。

**回答**

[scunliffe](https://stackoverflow.com/users/6144/scunliffe)是最接近的（在我无法链接到的评论中回答）。自定义控件位于一个相对定位的 div 内（实际上向下几个）。毯子只是简单地附加在身体的末端。因此，它位于相对定位的 div 之外并启动了它自己的 z-index 堆栈（如此[处](http://aplus.rs/lab/z-pos/)所述）。由于 IE 6/7 在这方面被破坏了，无论我将 z-index 设置为什么，它总是在毯子下面。

所以我将毯子移动到相对定位的 div 中的第一个孩子。这还不是 100% 完成，因为如果你滚动（我无法停止这个解决方案），毯子 div 只是可见内容的高度。我现在必须弄清楚如何获得内容的完整高度（可见和不可见）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T20:48:29.747

养成包含更高 z-index 的习惯。使用以下内容：

```
z-index:20000; 
```

当然，在您的自定义控件上增加 z-index。高 z-index 解决了我的类似问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T21:10:20.717

我也遇到了麻烦。我发现创建不可穿透屏蔽的唯一方法是将图片放在 DIV 的背景中（透明的 GIF 对我有用）。然后您仍然必须拦截键盘事件以防止导航到控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T01:16:30.460

[scunliffe](https://stackoverflow.com/users/6144/scunliffe)是最接近的（在我无法链接到的评论中回答）。自定义控件位于一个相对定位的 div 内（实际上向下几个）。毯子只是简单地附加在身体的末端。因此，它位于相对定位的 div 之外并启动了它自己的 z-index 堆栈（如此[处](http://aplus.rs/lab/z-pos/)所述）。由于 IE 6/7 在这方面被破坏了，无论我将 z-index 设置为什么，它总是在毯子下面。

所以我将毯子移动到相对定位的 div 中的第一个孩子。这还不是 100% 完成，因为如果你滚动（我无法停止这个解决方案），毯子 div 只是可见内容的高度。我现在必须弄清楚如何获得内容的完整高度（可见和不可见）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T20:42:16.030

以下是我们对项目进行不透明性的方式：

```
.SomeStyle
{
filter:alpha(opacity=10);
-moz-opacity:.10;
opacity:.10;
} 
```

这在 IE 6 & 7 和 FF 2 & 3 上测试良好。我相信它也适用于 Safari。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T20:57:00.010

你没有提到自定义控件的组成，但是如果你的自定义控件中有一个选择元素，那么这会导致 ie 中的模式问题（不记得他们是否在 ie7 中解决了这个问题）。无论如何，此信息可以帮助您解决问题。你需要一个 iframe 垫片来防止它通过覆盖显示。许多脚本将为您执行此操作。

[更多信息](http://tanny.ica.com/ICA/TKO/tkoblog.nsf/dx/select-tag-overlap-in-ie-part-iii)

[和这里](http://weblogs.asp.net/bleroy/archive/2005/08/09/how-to-put-a-div-over-a-select-in-ie.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T21:28:09.323

只是为了把我的帽子扔进去......

我不久前刚刚实现了这个，我使用了：

```
div#shade-box {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    background: #000;
    opacity: 0.7;
    filter: Alpha(opacity=70);
} 
```

显然，您可以更改或删除背景颜色。我通过 Javascript 将这个 div 添加到 DOM，所以我不需要担心 z-index。

已知在 FF 和 IE7 中工作。

# svn - Subversion - 合并存储库

> ID：375869
> 
> 赞同：16
> 
> 时间：2008-12-17T20:14:46.833
> 
> 标签：svn

当我第一次为我的不同项目设置 SVN 结构时，我决定将每个不同的项目放在一个单独的存储库中。

这已经有一段时间了，但我开始考虑将所有这些存储库合并到一个整体的“公司范围”存储库中，这样当我让员工检查源代码时，他们可以从顶部并拥有来自所有不同项目的所有代码。

我在`svn-merge-repos`网上找到了该命令，但没有很多用户反馈或使用它的有用提示。这是加入存储库的最佳方法，这样我就不会丢失我的历史数据，还是有更好的方法？有什么我应该注意的陷阱吗？

谢谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-06-29T14:59:39.063

我最近不得不做一些类似的事情，而我所做的本质上是：

```
* svnadmin create X:\Repositories\RepositoryC
* svn mkdir http://localhost:8080/svn/RepositoryC/branches --message "Added the branches folder."
* svn mkdir http://localhost:8080/svn/RepositoryC/tags --message "Added the tags folder."
* svn mkdir http://localhost:8080/svn/RepositoryC/trunk --message "Added the trunk folder."
* svn mkdir http://localhost:8080/svn/RepositoryC/trunk/A --message "Added the trunk\A folder."
* svn mkdir http://localhost:8080/svn/RepositoryC/trunk/B --message "Added the trunk\B folder."
* svn checkout http://localhost:8080/svn/RepositoryC RepositoryC
* svnadmin dump X:\Repositories\RepositoryA > RepositoryA.dmp
* svnadmin dump X:\Repositories\RepositoryB > RepositoryB.dmp
* svnadmin load X:\Repositories\RepositoryC --parent-dir trunk\A < RepositoryA.dmp
* svnadmin load X:\Repositories\RepositoryC --parent-dir trunk\B < RepositoryB.dmp
* svn checkout http://localhost:8080/svn/RepositoryC RepositoryC 
```

注意：上面的代码假定在托管您的 Subversion 存储库的机器上，存储库存在于 X:\Repositories 上，并且 Subversion 服务器的 URL 是[http://localhost:8080](http://localhost:8080)并且一个位于工作文件夹中。

此时，您将得到 RepositoryC，其中 RepositoryA 和 RepositoryB 分别位于 trunk\A 和 trunk\B 下，最重要的是，您的更改历史记录将保留在 RepositoryA 和 RepositoryB 下。您的工作文件夹还包含一个名为 RepositoryC 的文件夹，其中包含检出 RepositoryC。

您现在可以在 RepositoryC 中移动东西以统一两个存储库 RepositoryA 和 RepositoryB 的项目结构。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-18T15:48:56.917

请不要强迫您的用户签出整个存储库来构建东西。这又回到了旧的 sourcesafe 模型，当时并不好。

每个项目有一个存储库*很好*。如果 project1 需要来自 project2 的代码，请在 project1 的主干中添加一个“svn:externals”属性，这会将 project2 带到 project1 目录下的合理位置。如果 project2 需要 project3 的代码，它也可以有一个外部属性并将代码放在它下面。

实际上最好外部引用总是指向一个标签或一个特定的修订，但如果你避免“一个巨大的项目空间”问题，我会让你不要指向主干。

如果您使用外部组件，任何人都可以签出他们想要的项目并*自动*获取所有依赖项并构建 - 就像您想要的那样。他们所有的代码都独立在一个工作目录中，其中包含他们需要的内容，他们可以将多个项目的多个版本检出到单独的工作目录中，而不会浪费空间，并且仍然可以跟踪到底发生了什么。

如果 project1 期望在其项目文件夹之外而不是内部找到 project2，则可能需要对您的工作区进行一些小的重构，但这是总体方案中的一个小调整。

如果您真的将心放在一个存储库上，那也很好（这就是我们在工作场所和家里使用的东西，请考虑一下），但是请确保您有一个结构，其中每个项目都有自己的标签、trunk 和分支文件夹，并且检查 project1 的主干是*你需要做的所有事情*来获取 project1 的代码来构建。

最后，如果您的项目确实需要一个时髦的布局，您可以添加一个额外的存储库，它基本上是一个*元存储库*。该存储库将包含每个顶级项目的 1 个目录（带有主干标签和分支），并使用外部，引用所有其他项目并以您期望的方式构建时髦的工作区。

这样，通过添加额外的存储库，您可以获得签出和一步构建的所有好处，并且至少有机会管理由于与 project2 共享代码而导致 project1 所需的更改破坏 project3 的情况，并且您突然需要为 project3 进行紧急修复。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-17T20:30:23.713

您可以使用[svn-merge-repos.pl](http://www.coelho.net/svn-merge-repos.html)，或者您可以使用[SvnDumpTool](http://svn.borg.ch/svndumptool/)合并多个存储库转储，然后使用`svnadmin load --ignore-uuid`.

请注意，所有修订都将重新编号。

[检查 SvnDumpTool自述](http://svn.borg.ch/svndumptool/0.5.0/README.txt)文件的合并部分。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T20:41:16.297

如果你只是想让存储库*看起来*统一，你可以使用 svn:externals 属性，这样一个单一的检出就会从所有现有的存储库中提取代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-18T16:21:48.487

不要那样做。正如@KeithB 所说，使用 svn:externals 引用它们应该没问题。

最好在自己的存储库中维护每个项目，这样您就可以轻松地归档旧项目，并获得更好的完整性。

例如，apache 基金会为它的所有项目维护[一个单一的存储库](http://svn.apache.org/repos/asf/)（我不知道它是从其他存储库复制的还是实时存储库）。现在，它的历史权重超过 70 万次修订。我不希望看到这个怪物受到伤害。

# c# - 对方法的调用永远不会返回

> ID：375878
> 
> 赞同：0
> 
> 时间：2008-12-17T20:16:35.020
> 
> 标签：c#, .net, com

我正在使用 COM 组件。有一个方法可以对组件进行此调用，并且在我的应用程序中多次使用此方法，对于要处理的每个文档，都会调用此方法。

有时会突然发生一件奇怪的事情，不管处理的文档数量如何，它可能在处理 60、100 或 300 个文档后发生，或者根本不发生。奇怪的是：**对组件的调用没有返回。**该方法停留在调用行中。您知道任何可能导致此问题的 COM 特殊性吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T21:16:01.187

从您的问题中，我了解到您正在使用文档进行 COM 自动化。如果您的 COM 对象是一个文档处理应用程序（MS Office 是正确的猜测吗？），那么可能是该应用程序只是被弹出窗口阻止了。

这种现象在您自动化 Word 或 Excel 时经常发生。你应该做几件事来解决这个问题（我在这里谈论的是 MS Word）：

*   通过相应地设置 Application.DisplayAlerts 来禁用警报
*   安装完整的产品以避免 Windows Installer 弹出窗口询问缺少的功能
*   实现一个超时机制，如果任何模式对话框正在请求用户输入，它将终止应用程序。原因是某些类型的弹出窗口无法被抑制（如果您需要更多信息，请询问）。

# c# - 获取网格列的位置

> ID：375885
> 
> 赞同：3
> 
> 时间：2008-12-17T20:19:57.977
> 
> 标签：c#, forms, devexpress, controls

如何在表单中定位按钮，使其始终位于 DevExpress 网格中的列上方？

网格列已设置为无法调整大小，但网格和列会随表单调整大小。[System.Forms.Control](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.aspx)具有看起来会提供此功能的[PointToScreen 方法，但不是 DevExpress gridviewcolumn 中的方法。](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.pointtoscreen.aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-06-12T10:16:59.653

您可以找到相对于 的列坐标，`GridControl`然后转换为`Form`坐标。为此，您可以使用`GridColumnsInfo`可以从`GridViewInfo.ColumnsInfo`属性中获取的对象。要获取`GridViewInfo`对象，您可以使用`gridView.GetViewInfo()`方法。
找到坐标后，您将需要订阅发生在不同`GridView`和`GridControl`变化的事件。例如，您可以订阅`GridView.Layout`和 `GridView.LeftCoordChanged`事件。要调整大小，您需要订阅`GridControl.Resize`事件。

例子：

```
private void UpdatePosition(GridView gridView, string columnName, Control control)
{
    var column = gridView.Columns[columnName];

    if (column == null) return;

    var viewInfo = (GridViewInfo)gridView.GetViewInfo(); //using DevExpress.XtraGrid.Views.Grid.ViewInfo
    var columnInfo = viewInfo.ColumnsInfo[column];

    if (columnInfo != null)
    {
        var bounds = columnInfo.Bounds; //column's rectangle of coordinates relative to GridControl

        var point = PointToClient(gridView.GridControl.PointToScreen(bounds.Location)); //translating to form's coordinates

        control.Left = point.X;
        control.Top = point.Y - control.Height;
        control.Width = bounds.Width;

        control.Show();
    }
    else
        control.Hide();
} 
```

您可以为您订阅的每个事件调用此方法。

# asp.net - 将 .net 代码添加到经典的 asp 网站，无法在 .dll 文件中引用命名空间

> ID：375887
> 
> 赞同：1
> 
> 时间：2008-12-17T20:20:13.123
> 
> 标签：asp.net, asp-classic

我有一个现有的相当大的经典 asp 网站，虚拟目录配置为集中某些资源。我的问题是由于某种原因我无法访问我的任何命名空间和类。我尝试添加对另一个项目的引用，其中我在命名空间“DAL”中有类，即使智能感知看到这些类并且网站编译正常，当我尝试访问引用“DAL”命名空间中的类的任何页面时它也会出错.

我在浏览器中收到以下错误消息“CS0103：当前上下文中不存在名称‘CMS’”。部分问题是网站项目的根目录与 IIS 中的 Web 根目录不同的文件夹/级别。所以我的库位于网站根目录“/bin”文件夹中，但 iis 正在较低级别的 IIS webroot 中查找这些文件。那么如何让 .net 看到我的二进制文件而不将它们放在较低的 IIS 网站根目录中呢？我尝试为我的 .dll 文件设置一个虚拟目录，但似乎没有效果。

谢谢您的帮助！

======================澄清====================

我想做的事是将我希望我的网站使用的 .dll 文件保存在更高级别的目录中，然后是我在 IIS 中设置为 Web 根目录的文件夹。所以说我想在项目/bin文件夹中使用它“DAL”的库，但在IIS下，默认站点的本地路径设置为“/site/default”。我似乎可以使用“DAL”库的唯一方法是将 /bin 文件夹放入“/site/default/bin”，这对于这个项目不是一个选项。这有帮助吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-18T16:08:46.023

使用 NTFS 连接点来实现听起来相同的目标对我来说一直有效。

举个例子，我有一个包含 20 多个子 IIS 应用程序的网站，这些应用程序基本相同（不要问！），而不是在每个子应用程序中复制“bin”文件夹（它们将是相同的）有一个 'bin' 连接点指向网站根目录中的 'bin' 文件夹。

```
/bin           <- this is the actual 'bin' folder
/app1
/app1/bin      <- this is a junction point
/app2
/app2/bin      <- this is a junction point
/app3
/app3/bin      <- this is a junction point
/images
...
... 
```

要创建这些连接点，如果您使用 Vista/Win2k8 或更高版本，您可以使用内置命令“mklink”，对于早期版本的 Windows，请使用 SysInternals junction.exe 工具 - 可[在此处](http://live.sysinternals.com/junction.exe)获得。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T20:27:09.833

也许让网站路由文件夹成为 IIS 中的嵌套应用程序？

# javascript - 您网站上的自定义 jQuery 脚本中有多少行代码？多少才算太多？

> ID：375891
> 
> 赞同：2
> 
> 时间：2008-12-17T20:21:02.110
> 
> 标签：javascript, design-patterns, jquery-plugins, jquery

对于我们的网站，我使用了很多 jQuery——现在我正在查看基础库之上的 340 行 jQuery 代码。多少是太多了？我将添加更多内容，我什么时候开始尝试压缩代码并最终转向 OOP？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-17T20:28:47.227

行数没有任何意义——重要的是你实际在做什么。你可能有 10 行效率极低的代码，这比精心设计的 1000 行代码造成的损害要大得多。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-17T20:29:40.827

最理想的情况是，您应该尽可能减小脚本大小，但是对于当今的“Web 2.0”网站，您很可能会积累大量 JavaScript 代码。

重要的是，在部署网站之前，请**确保对脚本文件进行压缩和 gzip 压缩，以尽可能减小脚本[文件](http://www.crockford.com/javascript/jsmin.html)的[大小](http://www.gzip.org/)**。

如果您真的对优化和提高网站性能感兴趣，我强烈建议您看看 Steve Souders 的[高性能网站：前端工程师必备知识](https://rads.stackoverflow.com/amzn/click/com/0596529309)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-17T20:26:24.343

多少太多取决于您的应用程序。

您应该力求简洁，但不能以牺牲可读性或用户体验为代价。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T20:30:23.433

我会比代码行更关注脚本加载时间。如果它变得太大，请将文件分解为特定于页面或部分的文件。“太多”仅基于应用程序性能以及您认为用户可以接受的内容。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-17T20:37:34.557

340 行不算什么，尝试使用一些 Telerik 控件……很快就会达到 15k+ 行！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T20:32:03.913

这取决于您正在从事的项目。你应该保持你的代码高效和可读。部署网站后，只需压缩和 gzip 脚本即可提高性能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T20:46:12.637

我不会关心你的 JavaScript 的长度。您可以使用多种选项，例如使用[Packer](http://dean.edwards.name/packer/)压缩 JavaScript 以进行发布（您需要练习一下，因为它确实有一些关于其工作方式的规则）。

专注于确保您的代码易于理解且易于维护。在网站中大量使用 JavaScript 会很快变得棘手。

试图让它变短或变小对你自己的伤害比用户必须等待额外的一秒钟才能加载页面更伤害你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-17T20:53:07.537

对于开发来说，将代码分离到单独的 .js 文件中变得绝对必要，否则事情会变得一团糟。

然而，

不要在生产页面中留下大量的脚本引用。大多数浏览器仅限于 2 个同时 HTTP 请求。这些脚本引用将减慢您的页面加载速度，并且远远超过单独缓存组件的任何可能的好处。

您可以使用 JS Builder 将开发文件连接到一个文件中：

[http://code.google.com/p/js-builder/](http://code.google.com/p/js-builder/)

编辑：通过脚本引用我的意思是 <script src="blah.js">。页面加载时，每一个都需要通过 HTTP 加载。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-20T19:30:43.637

340 行 javascript 不算什么，但是随着您的 javascript 代码库的增长，我会花一些时间研究用于即时压缩和连接 javascript 的框架。如果您使用的是 Java，我建议您使用[JAWR](https://jawr.dev.java.net/)，它可以让您在开发模式下的多个引用和生产中的单个缩小脚本之间切换。只需确保在上线之前在生产模式下测试您的应用程序，因为缩小算法可能会在某些晦涩的情况下搞砸您的代码（如果您编写干净的代码并记住以';'结束每一行你应该没问题） .

如果您不在 Java 上，我不知道任何框架，但是您自己实现类似的东西实际上并不难。我想我有一些代码可以在 eZ Publish 中执行，它是用 PHP 编写的。

# .net - .Net 2.0 服务崩溃时是否调用 ServiceBase.OnStop？

> ID：375894
> 
> 赞同：1
> 
> 时间：2008-12-17T20:22:09.923
> 
> 标签：.net, windows-services

当 .Net 服务崩溃时，是否会调用 ServiceBase.OnStop 方法？无论是否调用 OnStop 方法，服务是否会被标记为已停止？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T20:43:40.473

使用 try-catch 并自己调用 OnStop；不要依赖'自动停止'，即使它是'保证'它仍然不是一个好主意。服务应该尽可能的健壮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T21:01:28.067

如果崩溃意味着您的服务中存在未处理的异常，那么答案是否定的 OnStop 不会被调用。通常，该服务将被标记为已停止。但是 Steven 是正确的，每个“根”方法都必须有一个 try-catch 块，围绕任何可能引发异常的代码，您的服务永远不应该有未处理的异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-03T13:44:20.227

OnStop() 仅在服务实际被告知停止时调用。这不包括例如系统断电，因为有一个单独的方法可以覆盖它（称为`OnShutdown()`）。

无论您放入什么，`OnStop()`都应该放在一个单独的方法中，可以从两者`OnStop()`调用`OnShutdown()`

至于捕获奇怪的意外异常，我建议将`ServiceBase.Run()`调用包装在 try/catch 中，并登录 catch 子句。这几乎可以保证您在发生异常时进行某种日志记录。

# html - 在代码中构建 HTML 的技术

> ID：375895
> 
> 赞同：3
> 
> 时间：2008-12-17T20:22:45.163
> 
> 标签：html, language-agnostic, code-generation

html 模板作为资源编译到应用程序中。HTML 模板的**片段如下所示：**

```
<A href="%PANELLINK%" target="_blank">
   <IMG border="0" src="%PANELIMAGE%" style="%IMAGESTYLE%">
</A><BR>
%CAPTIONTEXT% 
```

我喜欢这样，因为较大的资源 HTML 文件包含样式、无怪癖模式等。

但与往常一样，他们现在希望选择在没有链接的情况下省略 Anchor 标签。此外，如果没有标题，则应省略 BR 标签。

* * *

## 考虑的技术 Nº1

鉴于我不想在 C# 代码中构建整个 HTML 片段，我*考虑*过类似的事情：

```
%ANCHORSTARTTAGPREFIX%<A href="%PANELLINK%" target="_blank">%ANCHORSTARTTAGPOSTFIX%
   <IMG border="0" src="%PANELIMAGE%" style="%IMAGESTYLE%">
%ANCHORENDTAGPREFIX%</A>%ANCHORENDTAGPOSTFIX%CAPTIONPREFIX%<BR>
%CAPTIONTEXT%%CAPTIONPOSTFIX% 
```

我的想法是我可以使用前缀和后缀将 HTML 代码转换为：

```
<!--<A href="%PANELLINK%" target="_blank">-->
   <IMG border="0" src="%PANELIMAGE%" style="%IMAGESTYLE%">
<!--</A>--><!--<BR>
%CAPTIONTEXT%--> 
```

但这太荒谬了，再加上一位回答者提醒我们，它浪费了带宽，而且可能是错误的。

* * *

## 考虑的技术 Nº2

批发更换吊牌：

```
%AnchorStartTag%
   <IMG border="0" src="%PANELIMAGE%" style="%IMAGESTYLE%">
%AnchorEndTag%%CaptionStuff% 
```

并进行查找替换以进行更改

```
%AnchorStartTag% 
```

和

```
"<A href=\"foo\" target=\"blank\"" 
```

* * *

## 考虑的技术 Nº3

我考虑给重要的 HTML 元素一个 ID：

```
<A id="anchor" href="%PANELLINK%" target="_blank">
   <IMG border="0" src="%PANELIMAGE%" style="%IMAGESTYLE%">
</A><BR id="captionBreak">
%CAPTIONTEXT% 
```

然后使用 HTML DOM 解析器以编程方式删除节点。但是要获得一个值得信赖的 HTML DOM 解析器并不容易。如果 HTML 改为 xhtml，我将使用各种内置/原生可用的 xml DOM 解析器。

* * *

## 考虑的技术 Nº4

到目前为止，我实际上拥有的是：

```
private const String htmlEmptyTemplate = 
    @"<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 4.01//EN\"""+Environment.NewLine+
    @"   ""http://www.w3.org/TR/html4/strict.dtd"">"+Environment.NewLine+
    @"<HTML>"+Environment.NewLine+
    @"<HEAD>"+Environment.NewLine+
    @"  <TITLE>New Document</TITLE>"+Environment.NewLine+
    @"  <META http-equiv=""X-UA-Compatible"" content=""IE=edge"">"""+Environment.NewLine+
    @"  <META http-equiv=""Content-Type"" content=""text/html; charset=UTF-8"">"+Environment.NewLine+
    @"</HEAD>"+Environment.NewLine+
    @""+Environment.NewLine+
    @"<BODY style=""margin: 0 auto"">"+Environment.NewLine+
    @"  <DIV style=""text-align:center;"">"+Environment.NewLine+
    @"      %ContentArea%"+Environment.NewLine+
    @"  </DIV>" + Environment.NewLine +
    @"</BODY>" + Environment.NewLine +
    @"</HTML>";

private const String htmlAnchorStartTag = 
    @"<A href=""%PANELLINK%"" target=""_blank"">";

//Image is forbidden from having end tag
private const String htmlImageTag = 
    @"<IMG border=""0"" src=""%PANELIMAGE%"" style=""%IMAGESTYLE%"">";

private const String htmlCaptionArea =
    @"<BR>%CAPTIONTEXT%"; 
```

我已经想挖出我的眼球了。在代码中构建 HTML 是一场噩梦。编写是一场噩梦，调试是一场噩梦，维护是一场噩梦——这会让下一个人的事情变得困难。我希望有另一个解决方案 - 因为我**是**下一个人。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-17T20:48:02.477

我在这个游戏中的声望点已经很低了，这让我可以自由地非常明确地告诉您，先生或女士，您非常需要 XSLT。如果做不到这一点（您可能会这样做），您需要查看 VB.NET 中的[XML 文字](http://dotnetstories.wordpress.com/2008/11/21/xml-literals-and-visual-basic-90/)（它为您提供了您正在寻找的基于模板的解决方案......）。因为我更喜欢留在 C# 中（即使我是在 VBA 出生和长大的），所以我使用 XSLT。

我的两个不受欢迎的建议都要求使用 XHTML 而不是 HTML。对于许多传统开发人员来说，仅此一项要求就相当令人反感。通过您对 HTML 元素使用大写字母，我已经可以看出，您会发现我的言论完全没有用。所以我现在应该停止写作了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T21:06:38.430

怎么样：将 XML 存储为您的片段：

```
<fragment type="link_img_caption">
  <link href="%PANELLINK%" />
  <img src="%PANELIMAGE%" style="%IMAGESTYLE%" />
  <caption text="%CAPTIONTEXT%" />
</fragment> 
```

将其拉出，用“真实”字符串替换占位符（当然，您已经仔细地进行了 XML 转义），

...并使用简单的 XML 转换来生成 HTML 输出：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="html" version="4.0" encoding="iso-8859-1" indent="yes"/>

  <xsl:template match="/">
    <xsl:apply-templates select="fragment" />
  </xsl:template>

  <xsl:template match="fragment[@type = 'link_img_caption']">
    <xsl:choose>
      <xsl:when test="link[@href != '']">
        <a href="{link/@href}" target="_blank">
          <img src="{img/@src}" style="{img/@style}" border="0" />
        </a>
      </xsl:when>
      <xsl:otherwise>
        <img src="{img/@src}" style="{img/@style}" border="0" />
      </xsl:otherwise>
    </xsl:choose>
    <xsl:if test="caption[@text !='']">
      <br />
      <xsl:value-of select="caption/@text" />
    </xsl:if>
  </xsl:template>

</xsl:stylesheet> 
```

`type`由于该属性，可以添加其他片段类型。有很大的改进空间，因此可以将其作为如何*完成*的示例。

输出：

```
<a href="%PANELLINK%" target="_blank">
  <img src="%PANELIMAGE%" style="%IMAGESTYLE%" border="0">
</a>
<br>
%CAPTIONTEXT% 
```

并且，如果 XML 中的链接 href 为空：

```
<img src="%PANELIMAGE%" style="%IMAGESTYLE%" border="0">
<br>
%CAPTIONTEXT% 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T23:12:36.647

使用模板引擎，例如其中[之一](https://stackoverflow.com/questions/340095/can-you-recommend-a-net-template-engine)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T20:48:53.050

1.) 不要使用评论，你会向浏览器发送无用的数据，浪费带宽并遇到[IE 中的 BUG](http://www.positioniseverything.net/explorer/dup-characters.html)。

2.）作为某种方法，这不是更好吗？（我不熟悉 C#）但这样的事情对我来说更有意义。

```
//using PHP in this example
function HTMLImage($imageData, $linkData){
  var str = '';
  //if there is link data, start <a> tag
  $str .= '<a '.{expand any attributes}.'>';

  //add image tag and attributes from $imageData
  $str .= '<img '.{expand any attributes}.'/>';

  //if there is link data, close <a> tag
  $str .= '</a>';
  return $str;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T23:08:34.003

我会使用[Template Toolkit](http://template-toolkit.org/)，不幸的是它目前只在[`Perl`](http://search.cpan.org/perldoc?Template::Toolkit)and中实现[`Python`](http://template-toolkit.org/python/index.html)。

## `test.pl`：

```
use Template;

my $template = Template->new({
  VARIABLES => {
    ImageStyle  => "default",
    CaptionText => "Place Caption Here"
  },
});

$template->process( 'test.tt', {
    panel => {
      link  => "http://Stackoverflow.com/",
      image => "/Content/Img/stackoverflow-logo-250.png",
      alt   => "logo link to homepage"
    }
} ); 
```

## `test.tt`：

```
 [% IF panel.link -%]
<A href="[% panel.link %]" alt="[% panel.alt %]" target="_blank">
[%- END -%]

[%- IF panel.image -%]
   <IMG border="0" src="[% panel.image %]" style="[% ImageStyle %]">
[%- END -%]

[%- IF panel.link %]</A>[% END %]<BR>
[% CaptionText %] 
```

## 输出：

```
<A href="http://Stackoverflow.com/" alt="logo 链接到主页" target="_blank">
   <IMG 边框="0" src="/Content/Img/stackoverflow-logo-250.png" style="default">
</A><BR>
在此处放置标题

```

如果`panel.link`未定义变量，它会跳过锚标记。

```
   <IMG 边框="0" src="/Content/Img/stackoverflow-logo-250.png" style="default">
<BR>
在此处放置标题

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T21:20:06.600

模板是一种严重的代码气味。看看Seaside是如何生成html的。

[编辑] 另一个没有线索的人投了反对票。

# .net - dotnet 崩溃服务是否会终止其自己的线程？

> ID：375901
> 
> 赞同：0
> 
> 时间：2008-12-17T20:25:30.853
> 
> 标签：.net, windows-services

我有一个用 dotNet 编写的 Windows 服务。有一个使用各种 Delegate.BeginInvokes 产生工作线程的工作服务。当服务崩溃时，这些线程会被自动清理吗？如果是这样，什么时候？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T09:44:28.417

您的进程创建的所有线程都在该进程内。当您的应用程序崩溃时，您的进程就会终止，并且该进程中的所有线程都会突然终止。他们不会像友好的一样被终止（他们没有收到中止信号或任何东西），他们只是被杀死了。他们可能会或可能不会获得足够的处理器时间来完成执行——这取决于他们在做什么，以及 Windows 转储进程的速度。

所有强大的 Windows (2000+) 版本都应该隔离您的进程，因此当它死亡时，整个进程空间被转储并回收内存。如果您在崩溃时访问的是非托管资源，那么整个情况都会发生变化，答案是“视情况而定”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T20:39:21.823

仅当服务终止并从内存中卸载时

# asp-classic - 加总总成本 - ASP 而

> ID：375905
> 
> 赞同：1
> 
> 时间：2008-12-17T20:26:44.593
> 
> 标签：asp-classic

我是一个简单的购物车页面，它以表格形式显示内容，我试图找到一种方法来添加成本列，然后在底部显示总价。有没有人有任何建议如何做到这一点？让我感到困惑的部分是该表是通过 ASP 动态创建的。

我的代码可以在这里找到：http: [//pastie.org/341676](http://pastie.org/341676)

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T20:44:02.750

首先，这是一种特殊的痛苦（asp 经典的所有荣耀）

您需要的是另一个变量来保存您的值，然后在每次循环迭代中对其求和

```
While Not objRS.EOF
    totalCost = trim(objRS.Fields("quantity"))*trim(objRS.Fields("p_price"))
    absoluteTotal = absoluteTotal + totalCost 
```

...

```
Wend

Response.Write absoluteTotal 
```

这将输出所有总数的总和，尽管您可能希望使用 html 等更好地格式化它

# sybase - 将 32 位 Advantage Data Provider 包装到 COM+

> ID：375907
> 
> 赞同：2
> 
> 时间：2008-12-17T20:27:09.087
> 
> 标签：sybase, components, advantage-database-server

如何通过包装器公开 Advantage.Data.Provider.dll 中的功能。

我的目标是将 COM+ 安装/部署到 64 位服务器中。Advantage.Data.Provider.dll 是一个 32 位驱动程序。不想升级到支持 64 位的 Advantage Database Server 9。我在 c# 中创建了一个服务的 .NET 组件，设置它没有问题。我不知道在里面放什么。如何将 dll 中的功能公开给客户端代码？如果你问我，我会澄清的。谢谢，切斯特顿

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-11T13:58:03.373

如果我理解正确，您想从 64 位服务器上的 COM+ 对象调用 Advantage.Data.Provider.dll。Advantage.Data.Provider.dll 调用 ads32.dll，它是一个 32 位 dll（9.1 及更早版本）。不能从 64 位进程调用 ace32.dll。只有当您的 COM+ 对象在 32 位进程中运行时，它才能成功调用 ace32.dll。

调用 Advantage.Data.Provider.dll（因此调用 ace32.dll）的 AC# 应用程序必须针对 x86（32 位）。

# vb6 - NAnt/NAntContrib 'VB6' 无法在远程构建中启动

> ID：375909
> 
> 赞同：2
> 
> 时间：2008-12-17T20:27:32.003
> 
> 标签：vb6, continuous-integration, nant, nantcontrib

## 背景

我在本地桌面上运行的两个虚拟机上构建了一个持续集成系统。VM #1 ( *Toolbox* ) 正在运行 CruiseControl.Net、Subversion、BugTracker.Net 和 SQL Server Express。VM #2 ( *BuildMaster* ) 使用 NAntContrib 运行 NAnt，并安装了 VB 6.0 和 1.0/1.1/2.0/3.5 .Net Framework SDK。其目的是严格控制 BuildMaster 上安装的内容，并在 Toolbox 和开发人员工作站上更加宽松。

## 问题

我在 Toolbox 上有一个 CCNet 项目，它成功地在 BuildMaster 上编译了一个测试 VB 6.0 应用程序，但是上周构建开始失败。我记得做的唯一一件事就是在 Toolbox 上安装 BugTracker.Net 和 SQL Server Express。

## 症状

构建失败并返回异常：

```
<![CDATA[Starting 'vb6 ( /make "\\buildmaster\Working\TestApp\TestApp.vbp" /outdir "\\buildmaster\Working\TestApp\build" /out "\\buildmaster\Working\TestApp\TestApp.build.err")' in '\\buildmaster\Working\TestApp']]></message><duration>711.02240000000006</duration></task><duration>761.09440000000006</duration></target><failure><builderror><type>NAnt.Core.BuildException</type><message><![CDATA['vb6' failed to start.]]></message><location><filename>\\buildmaster\Working\TestApp\TestApp.build</filename><linenumber>39</linenumber><columnnumber>4</columnnumber></location><stacktrace><![CDATA[   at NAnt.Core.Tasks.ExternalProgramBase.StartProcess() in c:\Nant\src\NAnt.Core\Tasks\ExternalProgramBase.cs:line 501
   at NAnt.Core.Tasks.ExternalProgramBase.ExecuteTask() in c:\Nant\src\NAnt.Core\Tasks\ExternalProgramBase.cs:line 386
   at NAnt.Contrib.Tasks.Vb6Task.ExecuteTask() in c:\Nant\contrib\src\Tasks\Vb6Task.cs:line 220
   at NAnt.Core.Task.Execute() in c:\Nant\src\NAnt.Core\Task.cs:line 186
   at NAnt.Core.Target.Execute() in c:\Nant\src\NAnt.Core\Target.cs:line 247
   at NAnt.Core.Project.Execute(String targetName, Boolean forceDependencies) in c:\Nant\src\NAnt.Core\Project.cs:line 910
   at NAnt.Core.Project.Execute() in c:\Nant\src\NAnt.Core\Project.cs:line 862
   at NAnt.Core.Project.Run() in c:\Nant\src\NAnt.Core\Project.cs:line 947]]></stacktrace><internalerror><type>System.ComponentModel.Win32Exception</type><message><![CDATA[The system cannot find the file specified]]></message><stacktrace><![CDATA[   at System.Diagnostics.Process.StartWithCreateProcess(ProcessStartInfo startInfo)
   at System.Diagnostics.Process.Start()
   at NAnt.Core.Tasks.ExternalProgramBase.StartProcess() in c:\Nant\src\NAnt.Core\Tasks\ExternalProgramBase.cs:line 498]]></stacktrace></internalerror></builderror></failure><duration>1211.7424</duration></buildresults> 
```

显然，异常的核心是**[CDATA['vb6' failed to start.]]**。我的问题是，当我直接在 BuildMaster 上运行 Nant 构建时，它每次都会成功完成构建。

为了完整起见，这是我的 NAnt 构建脚本：

```
<?xml version="1.0" ?>
<project name="TestApp" default="build">
    <!-- set build.date property to current date in format yyyy-MM-dd -->
    <tstamp property="build.date" pattern="yyyy-MM-dd" />

    <!-- global project settings -->
    <property name="project.name" value="TestApp" />
    <property name="project.version" value="1.00" unless="${property::exists('project.version')}" />
    <property name="project.release.type" value="release" unless="${property::exists('project.release.type')}" /> <!-- nightly / dev / alpha / beta# / rc# / release -->
    <property name="build.warnaserror" value="false" />

    <!-- default configuration -->
    <property name="project.client" value="" />
    <property name="build.defines" value="" />
    <property name="build.number" value="${math::abs(math::floor(timespan::get-total-days(datetime::now() - datetime::parse('01/01/2000'))))}" />

    <!-- platform specific properties. These are the defaults -->
    <property name="current.build.defines" value="${build.defines}" />

    <!-- Build Tasks -->
    <target name="init" description="Initializes build properties">
        <property name="build.dir" value="${project::get-base-directory()}\build" />
        <echo message="Build Directory is ${build.dir}" />
    </target>

    <target name="clean" depends="init" description="Deletes current build configuration">
        <echo message="Clearing out files before recompiling..." />
        <delete verbose="true">
            <fileset basedir="${build.dir}">
                <include name="TestApp*.exe" />
            </fileset>
        </delete>
    </target>

    <target name="build" depends="clean" description="Perform a build of the base TestApp product">
        <mkdir dir="${build.dir}" unless="${directory::exists(build.dir)}" />

        <!-- Actually compile VB6 project into executable -->
        <vb6 project="TestApp.vbp" outdir="${build.dir}" errorfile="TestApp.build.err" verbose="true" />
    </target>
</project> 
```

非常感谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T15:53:50.230

我可能会误解你的问题，所以请多多包涵。CCNet 的**nant**任务在本地机器（运行 CCNet 的机器）上运行。

如果 ToolBox 正在运行 CCNet 但 BuildMaster 正在运行所有工具（即 VB6 等），我相当肯定没有办法做正在尝试的事情。通常，CCNet 需要在实际执行构建的机器上运行。**因此，找不到VB6是因为工具箱上没有安装VB6。**

但是，CCNet 确实有一种方法可以从一个服务器监控/控制多个构建服务器。因此，在您的情况下，您可以配置 ToolBox 来控制 BuildMaster 的构建，但**CCNet 需要安装在两个**. 有关此类内容的参考，您可以查看在 CCNet 网站上[拆分构建。](http://confluence.public.thoughtworks.org/display/CCNET/Splitting+the+build)

# java - 在 Java 中创建临时目录

> ID：375910
> 
> 赞同：10
> 
> 时间：2008-12-17T20:28:25.590
> 
> 标签：java

> **可能重复：**
> [在 Java 中创建一个临时目录](https://stackoverflow.com/questions/617414/create-a-temporary-directory-in-java)

我有一个创建数据库方法的测试，我需要一个临时目录来放置它。测试完成后，该目录将被删除。我尝试使用`File.createTempFile()`，如下所示：

```
tempDir = File.createTempFile("install", "dir");
tempDir.mkdir(); 
```

但是`tempDir`它已经作为文件存在。如何创建临时目录而不是文件？

# c++ - 如何分析在 Linux 上运行的 C++ 代码？

> ID：375913
> 
> 赞同：2038
> 
> 时间：2008-12-17T20:29:24.277
> 
> 标签：c++, linux, profiling

我有一个在 Linux 上运行的 C++ 应用程序，我正在对其进行优化。如何确定我的代码的哪些区域运行缓慢？

* * *

## 回答 #1

> 赞同：1540
> 
> 时间：2008-12-18T14:36:43.940

如果您的目标是使用探查器，请使用建议的探查器之一。

但是，如果您赶时间并且可以在调试器下手动中断您的程序，而它主观上很慢，那么有一种简单的方法可以找到性能问题。

只需将其暂停几次，每次都查看调用堆栈。如果有一些代码浪费了一定百分比的时间，20% 或 50% 或其他任何时间，这就是您在每个样本的行为中捕获它的概率。因此，这大致是您将看到它的样本的百分比。不需要有根据的猜测。如果您确实猜测问题是什么，这将证明或反驳它。

您可能会遇到多个大小不同的性能问题。如果您清除其中任何一个，其余的将占更大的百分比，并且在随后的传球中更容易发现。这种*放大效应*，当复合多个问题时，可以导致真正巨大的加速因素。

**警告**：程序员往往对这种技术持怀疑态度，除非他们自己使用过。他们会说分析器会为您提供此信息，但只有当他们对整个调用堆栈进行采样，然后让您检查一组随机样本时，这才是正确的。（摘要是失去洞察力的地方。）调用图不会为您提供相同的信息，因为

1.  他们没有在指令级别进行总结，并且
2.  在存在递归的情况下，它们给出了令人困惑的摘要。

他们还会说它只适用于玩具程序，而实际上它适用于任何程序，而且它似乎在更大的程序上效果更好，因为它们往往有更多的问题要找到。他们会说它有时会发现不是问题的东西，但只有当你看到某样东西*时*才会这样说。如果您在多个样本上发现问题，那就是真实的。

**PS**这也可以在多线程程序上完成，如果有一种方法可以在某个时间点收集线程池的调用堆栈样本，就像在 Java 中一样。

**PPS**作为一个粗略的概括，您的软件中的抽象层越多，您就越有可能发现这是性能问题的原因（以及获得加速的机会）。

**补充**：这可能并不明显，但堆栈采样技术在存在递归的情况下同样有效。原因是删除一条指令所节省的时间近似为包含它的样本的分数，而不管它在样本中可能出现的次数。

我经常听到的另一个反对意见是：“*它会随机停在某个地方，它会错过真正的问题*”。这来自对真正问题的先验概念。性能问题的一个关键特性是它们违背预期。抽样告诉你有问题，你的第一反应是不相信。这是自然的，但您可以确定它是否发现问题是真实的，反之亦然。

**补充**：让我对它的工作原理做一个贝叶斯解释。假设有一些指令`I`（调用或其他）在调用堆栈`f`中的某个部分时间（因此花费那么多）。为简单起见，假设我们不知道是什么`f`，但假设它是 0.1, 0.2, 0.3, ... 0.9, 1.0，并且这些可能性中的每一个的先验概率都是 0.1，所以所有这些成本都是同样可能的先验的。

然后假设我们只取了 2 个堆栈样本，并且我们`I`在两个样本上都看到了指令，指定为观察`o=2/2`。`f`这为我们提供了 的频率的新估计`I`，根据这个：

```
Prior                                    
P(f=x) x  P(o=2/2|f=x) P(o=2/2&&f=x)  P(o=2/2&&f >= x)  P(f >= x | o=2/2)

0.1    1     1             0.1          0.1            0.25974026
0.1    0.9   0.81          0.081        0.181          0.47012987
0.1    0.8   0.64          0.064        0.245          0.636363636
0.1    0.7   0.49          0.049        0.294          0.763636364
0.1    0.6   0.36          0.036        0.33           0.857142857
0.1    0.5   0.25          0.025        0.355          0.922077922
0.1    0.4   0.16          0.016        0.371          0.963636364
0.1    0.3   0.09          0.009        0.38           0.987012987
0.1    0.2   0.04          0.004        0.384          0.997402597
0.1    0.1   0.01          0.001        0.385          1

                  P(o=2/2) 0.385 
```

最后一列表示，例如，`f`>= 0.5 的概率为 92%，高于之前假设的 60%。

假设先前的假设不同。假设我们假设`P(f=0.1)`是 0.991（几乎确定），而所有其他可能性几乎是不可能的（0.001）。换句话说，我们事先确定的`I`是便宜。然后我们得到：

```
Prior                                    
P(f=x) x  P(o=2/2|f=x) P(o=2/2&& f=x)  P(o=2/2&&f >= x)  P(f >= x | o=2/2)

0.001  1    1              0.001        0.001          0.072727273
0.001  0.9  0.81           0.00081      0.00181        0.131636364
0.001  0.8  0.64           0.00064      0.00245        0.178181818
0.001  0.7  0.49           0.00049      0.00294        0.213818182
0.001  0.6  0.36           0.00036      0.0033         0.24
0.001  0.5  0.25           0.00025      0.00355        0.258181818
0.001  0.4  0.16           0.00016      0.00371        0.269818182
0.001  0.3  0.09           0.00009      0.0038         0.276363636
0.001  0.2  0.04           0.00004      0.00384        0.279272727
0.991  0.1  0.01           0.00991      0.01375        1

                  P(o=2/2) 0.01375 
```

现在它说`P(f >= 0.5)`是 26%，高于之前假设的 0.6%。所以贝叶斯允许我们更新我们对 的可能成本的估计`I`。如果数据量很小，它并不能准确地告诉我们成本是多少，只能告诉我们它足够大，值得修复。

另一种看待它的方式称为[继承规则](http://en.wikipedia.org/wiki/Rule_of_succession)。如果你掷硬币两次，两次都出现正面，这说明硬币的可能重量是什么？尊重的回答方式是说它是一个 Beta 分布，具有平均值`(number of hits + 1) / (number of tries + 2) = (2+1)/(2+2) = 75%`。

（关键是我们看到`I`不止一次。如果我们只看到一次，除了`f`> 0 之外，这并不能告诉我们太多。）

因此，即使是非常少量的样本也可以告诉我们很多关于它所看到的指令成本的信息。（平均而言，它会以与其成本成正比的频率看到它们。如果`n`抽取样本，并且`f`是成本，那么`I`将出现在`nf+/-sqrt(nf(1-f))`样本上。例如，`n=10`，`f=0.3`，即`3+/-1.4`样本。）

* * *

**补充**：为了直观地了解测量和随机堆栈采样之间的区别：
现在有分析器对堆栈进行采样，即使在挂钟时间，但*结果*是测量值（或热点路径，或热点，从中“瓶颈”很容易隐藏）。他们没有向您展示（他们很容易）是实际样品本身。如果您的目标是*找到*瓶颈，那么您需要查看的瓶颈数量*平均*为 2 除以所需时间的分数。因此，如果花费 30% 的时间，则平均 2/.3 = 6.7 个样本会显示它，而 20 个样本显示它的机会是 99.2%。

这是检查测量值和检查堆栈样本之间差异的现成说明。瓶颈可能是这样的一个大块，也可能是许多小块，没有区别。

[![在此处输入图像描述](https://i.stack.imgur.com/FpWuS.png)](https://i.stack.imgur.com/FpWuS.png)

测量是水平的；它告诉您特定例程需要多少时间。采样是垂直的。如果有任何方法可以避免此时整个程序正在做什么，*并且如果您在第二个示例上看到它*，那么您已经找到了瓶颈。这就是不同之处——看到花费时间的全部原因，而不仅仅是多少。

* * *

## 回答 #2

> 赞同：652
> 
> 时间：2009-04-21T04:09:20.267

您可以通过以下选项使用[Valgrind](http://en.wikipedia.org/wiki/Valgrind)

```
valgrind --tool=callgrind ./(Your binary) 
```

它将生成一个名为`callgrind.out.x`. 然后，您可以使用`kcachegrind`工具来读取此文件。它将为您提供图形分析结果，例如哪些线路的成本是多少。

* * *

## 回答 #3

> 赞同：377
> 
> 时间：2008-12-17T20:34:45.107

我假设您使用的是 GCC。标准解决方案是使用[gprof](http://www.math.utah.edu/docs/info/gprof_toc.html)进行分析。

请务必`-pg`在分析之前添加到编译：

```
cc -o myprog myprog.c utils.c -g -pg 
```

我还没有尝试过，但我听说过关于[google-perftools 的](https://github.com/gperftools/gperftools)好消息。绝对值得一试。

相关问题[在这里](https://stackoverflow.com/questions/56672/how-do-you-profile-your-code)。

其他一些流行语如果`gprof`不适合您：[Valgrind](http://en.wikipedia.org/wiki/Valgrind)、Intel [VTune](http://en.wikipedia.org/wiki/VTune)、Sun [DTrace](http://en.wikipedia.org/wiki/DTrace)。

* * *

## 回答 #4

> 赞同：287
> 
> 时间：2010-08-17T11:48:38.520

较新的内核（例如最新的 Ubuntu 内核）带有新的“性能”工具（`apt-get install linux-tools`）AKA [perf_events](https://en.wikipedia.org/wiki/Perf_(Linux))。

这些带有经典的采样分析器（[手册页](http://manpages.ubuntu.com/manpages/trusty/man1/perf.1.html)）以及很棒的[时间表](http://web.archive.org/web/20090922171904/http://blog.fenrus.org/?p=5)！

重要的是这些工具可以是**系统分析**，而不仅仅是进程分析——它们可以显示线程、进程和内核之间的交互，让您了解进程之间的调度和 I/O 依赖关系。

![替代文字](https://i.stack.imgur.com/FMYp4.png)

* * *

## 回答 #5

> 赞同：91
> 
> 时间：2012-06-08T08:01:57.377

如果没有一些选项，运行的答案`valgrind --tool=callgrind`并不完整。我们通常不想在 Valgrind 下分析 10 分钟的缓慢启动时间，而是希望在我们的程序执行某些任务时对其进行分析。

所以这是我推荐的。先运行程序：

```
valgrind --tool=callgrind --dump-instr=yes -v --instr-atstart=no ./binary > tmp 
```

现在，当它工作并且我们想要开始分析时，我们应该在另一个窗口中运行：

```
callgrind_control -i on 
```

这将打开分析。要关闭它并停止整个任务，我们可能会使用：

```
callgrind_control -k 
```

现在我们在当前目录中有一些名为 callgrind.out.* 的文件。要查看分析结果，请使用：

```
kcachegrind callgrind.out.* 
```

我建议在下一个窗口中单击“Self”列标题，否则它表明“main()”是最耗时的任务。“自我”显示每个功能本身花费了多少时间，而不是与依赖项一起。

* * *

## 回答 #6

> 赞同：86
> 
> 时间：2009-05-22T21:44:19.863

我会使用 Valgrind 和 Callgrind 作为我的分析工具套件的基础。重要的是要知道 Valgrind 基本上是一个虚拟机：

> （维基百科）Valgrind 本质上是一个使用即时（JIT）编译技术的虚拟机，包括动态重新编译。原始程序中的任何内容都不会直接在主机处理器上运行。相反，Valgrind 首先将程序转换为一种临时的、更简单的形式，称为中间表示 (IR)，它是一种与处理器无关、基于 SSA 的形式。转换后，在 Valgrind 将 IR 转换回机器代码并让主机处理器运行之前，工具（见下文）可以自由地对 IR 进行任何转换。

Callgrind 是一个基于此的分析器。主要好处是您不必运行应用程序数小时即可获得可靠的结果。即使是一秒钟的运行也足以获得坚如磐石、可靠的结果，因为 Callgrind 是一种**非探测**分析器。

另一个基于 Valgrind 的工具是 Massif。我用它来分析堆内存使用情况。它工作得很好。它的作用是为您提供内存使用情况的快照——详细信息 WHAT 拥有多少内存百分比，以及谁将它放在那里。此类信息在应用程序运行的不同时间点可用。

* * *

## 回答 #7

> 赞同：66
> 
> 时间：2011-06-30T19:30:44.547

这是对[Nazgob 的 Gprof 回答的回应](https://stackoverflow.com/a/375930/321731)。

过去几天我一直在使用 Gprof，并且已经发现了三个重大限制，其中一个我还没有在其他任何地方看到记录（还）：

1.  它不能在多线程代码上正常工作，除非您使用[解决方法](http://sam.zoy.org/writings/programming/gprof.html)

2.  调用图被函数指针弄糊涂了。示例：我有一个调用的函数`multithread()`，它使我能够在指定的数组上对指定的函数进行多线程处理（均作为参数传递）。然而，Gprof 认为所有调用都`multithread()`等同于计算在孩子身上花费的时间。由于我传递的某些函数`multithread()`比其他函数花费的时间要长得多，所以我的调用图大多是无用的。（对于那些想知道线程是否是这里的问题的人：不，`multithread()`可以选择，并且在这种情况下确实只在调用线程上按顺序运行所有内容）。

3.  它[在这里](http://www.cs.utah.edu/dept/old/texinfo/as/gprof.html)说“......呼叫次数数字是通过计数而不是抽样得出的。它们是完全准确的......”。然而，我发现我的调用图给了我 5345859132+784984078 作为我最常调用函数的调用统计信息，其中第一个数字应该是直接调用，第二个是递归调用（它们都来自它自己）。由于这意味着我有一个错误，我将长（64 位）计数器放入代码中并再次运行相同的操作。我的计数：5345859132 直接调用和 78094395406 自递归调用。那里有很多数字，所以我要指出我测量的递归调用是 780 亿，而 Gprof 是 784m：相差 100 倍。两次运行都是单线程和未优化的代码，一个已编译`-g`，另一个`-pg`.

这是在 64 位 Debian Lenny 下运行的GNU [Gprof （Debian 的 GNU Binutils）2.18.0.20080103，如果这对任何人都有帮助的话。](https://en.wikipedia.org/wiki/Gprof)

* * *

## 回答 #8

> 赞同：44
> 
> 时间：2020-02-17T15:15:28.173

**C++分析技术调查：gprof vs valgrind vs perf vs gperftools**

在这个答案中，我将使用几种不同的工具来分析一些非常简单的测试程序，以便具体比较这些工具是如何工作的。

以下测试程序非常简单，并执行以下操作：

*   `main`呼叫`fast`和`maybe_slow`3 次，其中一个`maybe_slow`呼叫速度很慢

    如果我们考虑对子函数的调用，那么慢速调用的`maybe_slow`时间要长 10 倍，并且在运行时占主导地位`common`。理想情况下，分析工具将能够为我们指出特定的慢速调用。

*   和call `fast`，它占程序执行的大部分`maybe_slow``common`

*   程序界面为：

    ```
    ./main.out [n [seed]] 
    ```

    并且程序`O(n^2)`总共循环。`seed`只是为了在不影响运行时获得不同的输出。

主程序

```
#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>

uint64_t __attribute__ ((noinline)) common(uint64_t n, uint64_t seed) {
    for (uint64_t i = 0; i < n; ++i) {
        seed = (seed * seed) - (3 * seed) + 1;
    }
    return seed;
}

uint64_t __attribute__ ((noinline)) fast(uint64_t n, uint64_t seed) {
    uint64_t max = (n / 10) + 1;
    for (uint64_t i = 0; i < max; ++i) {
        seed = common(n, (seed * seed) - (3 * seed) + 1);
    }
    return seed;
}

uint64_t __attribute__ ((noinline)) maybe_slow(uint64_t n, uint64_t seed, int is_slow) {
    uint64_t max = n;
    if (is_slow) {
        max *= 10;
    }
    for (uint64_t i = 0; i < max; ++i) {
        seed = common(n, (seed * seed) - (3 * seed) + 1);
    }
    return seed;
}

int main(int argc, char **argv) {
    uint64_t n, seed;
    if (argc > 1) {
        n = strtoll(argv[1], NULL, 0);
    } else {
        n = 1;
    }
    if (argc > 2) {
        seed = strtoll(argv[2], NULL, 0);
    } else {
        seed = 0;
    }
    seed += maybe_slow(n, seed, 0);
    seed += fast(n, seed);
    seed += maybe_slow(n, seed, 1);
    seed += fast(n, seed);
    seed += maybe_slow(n, seed, 0);
    seed += fast(n, seed);
    printf("%" PRIX64 "\n", seed);
    return EXIT_SUCCESS;
} 
```

**gprof**

gprof 需要使用仪器重新编译软件，并且它还与该仪器一起使用采样方法。因此，它在准确性（采样并不总是完全准确并且可以跳过函数）和执行速度减慢（仪器和采样是相对较快的技术，不会大大减慢执行速度）之间取得平衡。

gprof 内置在 GCC/binutils 中，所以我们所要做的就是使用`-pg`启用 gprof 的选项进行编译。然后，我们使用大小 CLI 参数正常运行程序，该参数会产生合理持续时间的几秒 ( `10000`) 运行：

```
gcc -pg -ggdb3 -O3 -std=c99 -Wall -Wextra -pedantic -o main.out main.c
time ./main.out 10000 
```

出于教育原因，我们还将在未启用优化的情况下进行运行。请注意，这在实践中是没有用的，因为您通常只关心优化优化程序的性能：

```
gcc -pg -ggdb3 -O0 -std=c99 -Wall -Wextra -pedantic -o main.out main.c
./main.out 10000 
```

首先，`time`告诉我们有和没有的执行时间`-pg`是一样的，这很棒：没有减速！然而，我已经看到复杂软件的 2 倍 - 3 倍减速的帐户，例如[在这张票中显示](https://gem5.atlassian.net/browse/GEM5-337)。

因为我们使用 编译`-pg`，所以运行程序会生成一个`gmon.out`包含分析数据的文件文件。

`gprof2dot`我们可以按照以下要求以图形方式观察该文件：[是否可以获得 gprof 结果的图形表示？](https://stackoverflow.com/questions/2439060/is-it-possible-to-get-a-graphical-representation-of-gprof-results)

```
sudo apt install graphviz
python3 -m pip install --user gprof2dot
gprof main.out > main.gprof
gprof2dot < main.gprof | dot -Tsvg -o output.svg 
```

在这里，该`gprof`工具读取`gmon.out`跟踪信息，并在 中生成人类可读的报告`main.gprof`，`gprof2dot`然后读取以生成图表。

gprof2dot 的来源在：[https ://github.com/jrfonseca/gprof2dot](https://github.com/jrfonseca/gprof2dot)

我们在运行中观察到以下内容`-O0`：

[![在此处输入图像描述](https://i.stack.imgur.com/mM8NQ.png)](https://i.stack.imgur.com/mM8NQ.png)

并`-O3`运行：

[![在此处输入图像描述](https://i.stack.imgur.com/31VNy.png)](https://i.stack.imgur.com/31VNy.png)

`-O0`输出几乎是不言自明的。例如，它显示 3 个`maybe_slow`调用及其子调用占总运行时间的 97.56%，尽管`maybe_slow`没有子调用的自身执行占总执行时间的 0.00%，即几乎所有花费在该函数上的时间都花在了孩子来电。

TODO：为什么输出中`main`缺少`-O3`，即使我可以`bt`在 GDB 中看到它？[GProf 输出中缺少函数](https://stackoverflow.com/questions/39041871/missing-function-from-gprof-output)我认为这是因为 gprof 除了其编译的仪器外，也是基于采样的，而且`-O3` `main`速度太快并且没有样本。

我选择 SVG 输出而不是 PNG，因为可以使用`Ctrl`+搜索 SVG，`F`并且文件大小可以小 10 倍左右。此外，对于复杂的软件，生成的图像的宽度和高度可能非常大，有数万像素，`eog`在这种情况下，GNOME 3.28.1 会出现针对 PNG 的错误，而 SVG 会由我的浏览器自动打开。gimp 2.8 运行良好，另见：

*   [https://askubuntu.com/questions/1112641/how-to-view-extremely-large-images](https://askubuntu.com/questions/1112641/how-to-view-extremely-large-images)
*   [https://unix.stackexchange.com/questions/77968/viewing-large-image-on-linux](https://unix.stackexchange.com/questions/77968/viewing-large-image-on-linux)
*   [https://superuser.com/questions/356038/viewer-for-huge-images-under-linux-100-mp-color-images](https://superuser.com/questions/356038/viewer-for-huge-images-under-linux-100-mp-color-images)

但即便如此，您仍需要将图像拖到很多地方以找到您想要的东西，例如这张来自[这张票](https://gem5.atlassian.net/browse/GEM5-337)的“真实”软件示例的图像：

[![在此处输入图像描述](https://i.stack.imgur.com/Nvg9G.jpg)](https://i.stack.imgur.com/Nvg9G.jpg)

如果所有那些细小的未排序的意大利面条线相互重叠，您能否轻松找到最关键的调用堆栈？我敢肯定，可能有更好`dot`的选择，但我现在不想去那里。我们真正需要的是一个合适的专用查看器，但我还没有找到：

*   [在 kcachegrind 中查看 gprof 输出](https://stackoverflow.com/questions/7274095/view-gprof-output-in-kcachegrind)
*   [哪个是 KProf 的最佳替代品？](https://stackoverflow.com/questions/1576666/which-is-the-best-replacement-for-kprof)

但是，您可以使用颜色图来稍微缓解这些问题。例如，在之前的巨幅图像上，当我巧妙地演绎出绿色后红色，最后是越来越深的蓝色时，我终于找到了左边的关键路径。

或者，我们还可以观察`gprof`我们之前保存的内置 binutils 工具的文本输出：

```
cat main.gprof 
```

默认情况下，这会产生一个非常详细的输出，解释输出数据的含义。既然我不能解释得比这更好，我会让你自己读。

`-b`一旦您了解了数据输出格式，您就可以减少冗长以仅显示数据而无需使用以下选项的教程：

```
gprof -b main.out 
```

在我们的示例中，输出用于`-O0`：

```
Flat profile:

Each sample counts as 0.01 seconds.
  %   cumulative   self              self     total           
 time   seconds   seconds    calls   s/call   s/call  name    
100.35      3.67     3.67   123003     0.00     0.00  common
  0.00      3.67     0.00        3     0.00     0.03  fast
  0.00      3.67     0.00        3     0.00     1.19  maybe_slow

            Call graph

granularity: each sample hit covers 2 byte(s) for 0.27% of 3.67 seconds

index % time    self  children    called     name
                0.09    0.00    3003/123003      fast [4]
                3.58    0.00  120000/123003      maybe_slow [3]
[1]    100.0    3.67    0.00  123003         common [1]
-----------------------------------------------
                                                 <spontaneous>
[2]    100.0    0.00    3.67                 main [2]
                0.00    3.58       3/3           maybe_slow [3]
                0.00    0.09       3/3           fast [4]
-----------------------------------------------
                0.00    3.58       3/3           main [2]
[3]     97.6    0.00    3.58       3         maybe_slow [3]
                3.58    0.00  120000/123003      common [1]
-----------------------------------------------
                0.00    0.09       3/3           main [2]
[4]      2.4    0.00    0.09       3         fast [4]
                0.09    0.00    3003/123003      common [1]
-----------------------------------------------

Index by function name

   [1] common                  [4] fast                    [3] maybe_slow 
```

和`-O3`：

```
Flat profile:

Each sample counts as 0.01 seconds.
  %   cumulative   self              self     total           
 time   seconds   seconds    calls  us/call  us/call  name    
100.52      1.84     1.84   123003    14.96    14.96  common

            Call graph

granularity: each sample hit covers 2 byte(s) for 0.54% of 1.84 seconds

index % time    self  children    called     name
                0.04    0.00    3003/123003      fast [3]
                1.79    0.00  120000/123003      maybe_slow [2]
[1]    100.0    1.84    0.00  123003         common [1]
-----------------------------------------------
                                                 <spontaneous>
[2]     97.6    0.00    1.79                 maybe_slow [2]
                1.79    0.00  120000/123003      common [1]
-----------------------------------------------
                                                 <spontaneous>
[3]      2.4    0.00    0.04                 fast [3]
                0.04    0.00    3003/123003      common [1]
-----------------------------------------------

Index by function name

   [1] common 
```

作为每个部分的非常快速的总结，例如：

```
 0.00    3.58       3/3           main [2]
[3]     97.6    0.00    3.58       3         maybe_slow [3]
                3.58    0.00  120000/123003      common [1] 
```

以左缩进 ( ) 的函数为中心`maybe_flow`。`[3]`是该函数的 ID。函数上方是调用者，下方是被调用者。

对于`-O3`，请参见此处，就像在图形输出中一样，`maybe_slow`并且`fast`没有已知的父级，这就是文档所说的`<spontaneous>`意思。

我不确定是否有一种使用 gprof 进行逐行分析的好方法：[`gprof` time 花在特定代码行上](https://stackoverflow.com/questions/9608949/gprof-time-spent-in-particular-lines-of-code)

**valgrind 调用研磨**

valgrind 通过 valgrind 虚拟机运行程序。这使得分析非常准确，但它也会导致程序非常慢。我之前也提到过 kcachegrind：[获取代码的图形函数调用图的工具](https://stackoverflow.com/questions/517589/tools-to-get-a-pictorial-function-call-graph-of-code/31190167#31190167)

callgrind 是 valgrind 的代码分析工具，而 kcachegrind 是一个可以可视化 cachegrind 输出的 KDE 程序。

首先，我们必须删除`-pg`标志才能返回正常编译，否则运行实际上会失败[`Profiling timer expired`](https://stackoverflow.com/questions/2146082/valgrind-profiling-timer-expired)，并且是的，这很常见，以至于我这样做了，并且有一个 Stack Overflow 问题。

所以我们编译并运行为：

```
sudo apt install kcachegrind valgrind
gcc -ggdb3 -O3 -std=c99 -Wall -Wextra -pedantic -o main.out main.c
time valgrind --tool=callgrind valgrind --dump-instr=yes \
  --collect-jumps=yes ./main.out 10000 
```

我启用`--dump-instr=yes --collect-jumps=yes`是因为这还会转储信息，使我们能够以相对较小的额外开销成本查看每个装配线的性能细分。

马上，`time`告诉我们程序执行需要 29.5 秒，所以在这个例子中我们的速度降低了大约 15 倍。显然，这种放缓将成为更大工作负载的严重限制。[在此处提到](https://gem5.atlassian.net/browse/GEM5-337)的“真实世界软件示例”中，我观察到速度下降了 80 倍。

运行会生成一个名为`callgrind.out.<pid>`eg`callgrind.out.8554`在我的例子中的配置文件数据文件。我们通过以下方式查看该文件：

```
kcachegrind callgrind.out.8554 
```

它显示了一个 GUI，其中包含类似于文本 gprof 输出的数据：

[![在此处输入图像描述](https://i.stack.imgur.com/v1kfK.png)](https://i.stack.imgur.com/v1kfK.png)

此外，如果我们转到右下角的“调用图”选项卡，我们会看到一个调用图，我们可以通过右键单击它来导出以下带有不合理数量的白色边框的图像:-)

[![在此处输入图像描述](https://i.stack.imgur.com/ZTdAJ.png)](https://i.stack.imgur.com/ZTdAJ.png)

我认为`fast`没有显示在该图表上，因为 kcachegrind 必须简化了可视化，因为该调用占用的时间太少，这可能是您在真实程序上想要的行为。右键菜单有一些设置来控制何时剔除此类节点，但我无法让它在快速尝试后显示如此短的调用。如果我单击`fast`左侧窗口，它会显示带有 的调用图`fast`，因此实际上捕获了该堆栈。还没有人找到一种方法来显示完整的图调用图：[Make callgrind show all function calls in the kcachegrind callgraph](https://stackoverflow.com/questions/33769323/make-callgrind-show-all-function-calls-in-the-kcachegrind-callgraph)

TODO 在复杂的 C++ 软件上，我看到一些 type 条目`<cycle N>`，例如`<cycle 11>`我期望函数名称的地方，这是什么意思？我注意到有一个“循环检测”按钮可以打开和关闭它，但这是什么意思？

**`perf`从`linux-tools`**

`perf`似乎只使用 Linux 内核采样机制。这使得设置非常简单，但也不完全准确。

```
sudo apt install linux-tools
time perf record -g ./main.out 10000 
```

这增加了 0.2 秒的执行时间，所以我们在时间上很好，但是在`common`使用键盘右箭头扩展节点之后，我仍然没有看到太多的兴趣：

```
Samples: 7K of event 'cycles:uppp', Event count (approx.): 6228527608     
  Children      Self  Command   Shared Object     Symbol                  
-   99.98%    99.88%  main.out  main.out          [.] common              
     common                                                               
     0.11%     0.11%  main.out  [kernel]          [k] 0xffffffff8a6009e7  
     0.01%     0.01%  main.out  [kernel]          [k] 0xffffffff8a600158  
     0.01%     0.00%  main.out  [unknown]         [k] 0x0000000000000040  
     0.01%     0.00%  main.out  ld-2.27.so        [.] _dl_sysdep_start    
     0.01%     0.00%  main.out  ld-2.27.so        [.] dl_main             
     0.01%     0.00%  main.out  ld-2.27.so        [.] mprotect            
     0.01%     0.00%  main.out  ld-2.27.so        [.] _dl_map_object      
     0.01%     0.00%  main.out  ld-2.27.so        [.] _xstat              
     0.00%     0.00%  main.out  ld-2.27.so        [.] __GI___tunables_init
     0.00%     0.00%  main.out  [unknown]         [.] 0x2f3d4f4944555453  
     0.00%     0.00%  main.out  [unknown]         [.] 0x00007fff3cfc57ac  
     0.00%     0.00%  main.out  ld-2.27.so        [.] _start 
```

因此，我尝试对`-O0`程序进行基准测试以查看是否显示任何内容，直到现在，终于，我看到了一个调用图：

```
Samples: 15K of event 'cycles:uppp', Event count (approx.): 12438962281   
  Children      Self  Command   Shared Object     Symbol                  
+   99.99%     0.00%  main.out  [unknown]         [.] 0x04be258d4c544155  
+   99.99%     0.00%  main.out  libc-2.27.so      [.] __libc_start_main   
-   99.99%     0.00%  main.out  main.out          [.] main                
   - main                                                                 
      - 97.54% maybe_slow                                                 
           common                                                         
      - 2.45% fast                                                        
           common                                                         
+   99.96%    99.85%  main.out  main.out          [.] common              
+   97.54%     0.03%  main.out  main.out          [.] maybe_slow          
+    2.45%     0.00%  main.out  main.out          [.] fast                
     0.11%     0.11%  main.out  [kernel]          [k] 0xffffffff8a6009e7  
     0.00%     0.00%  main.out  [unknown]         [k] 0x0000000000000040  
     0.00%     0.00%  main.out  ld-2.27.so        [.] _dl_sysdep_start    
     0.00%     0.00%  main.out  ld-2.27.so        [.] dl_main             
     0.00%     0.00%  main.out  ld-2.27.so        [.] _dl_lookup_symbol_x 
     0.00%     0.00%  main.out  [kernel]          [k] 0xffffffff8a600158  
     0.00%     0.00%  main.out  ld-2.27.so        [.] mmap64              
     0.00%     0.00%  main.out  ld-2.27.so        [.] _dl_map_object      
     0.00%     0.00%  main.out  ld-2.27.so        [.] __GI___tunables_init
     0.00%     0.00%  main.out  [unknown]         [.] 0x552e53555f6e653d  
     0.00%     0.00%  main.out  [unknown]         [.] 0x00007ffe1cf20fdb  
     0.00%     0.00%  main.out  ld-2.27.so        [.] _start 
```

TODO：执行时发生了什么`-O3`？难道就这么简单，`maybe_slow`而且`fast`太快了，没有得到任何样品吗？它是否适用`-O3`于需要更长执行时间的大型程序？我错过了一些 CLI 选项吗？我发现`-F`要控制以赫兹为单位的采样频率，但我把它调到了默认允许的最大值`-F 39500`（可以用 增加`sudo`），我仍然看不到清晰的调用。

一件很酷的事情`perf`是来自 Brendan Gregg 的 FlameGraph 工具，它以一种非常简洁的方式显示调用堆栈时间，让您可以快速查看大调用。该工具可在以下网址获得：[https](https://github.com/brendangregg/FlameGraph) ://github.com/brendangregg/FlameGraph并且在他的 perf 教程中也提到过：[http](http://www.brendangregg.com/perf.html#FlameGraphs)`perf` ://www.brendangregg.com/perf.html#FlameGraphs 当我没有跑步时，`sudo`我得到了[`ERROR: No stack counts found`](https://github.com/brendangregg/FlameGraph/issues/132)这样的结果现在我将这样做`sudo`：

```
git clone https://github.com/brendangregg/FlameGraph
sudo perf record -F 99 -g -o perf_with_stack.data ./main.out 10000
sudo perf script -i perf_with_stack.data | FlameGraph/stackcollapse-perf.pl | FlameGraph/flamegraph.pl > flamegraph.svg 
```

但是在这样一个简单的程序中，输出不是很容易理解，因为我们不能轻易地在该图上看到`maybe_slow`或看到：`fast`

[![在此处输入图像描述](https://i.stack.imgur.com/QFKSS.png)](https://i.stack.imgur.com/QFKSS.png)

在一个更复杂的例子中，图表的含义变得很清楚：

[![在此处输入图像描述](https://i.stack.imgur.com/4Ufpd.png)](https://i.stack.imgur.com/4Ufpd.png)

TODO 在那个例子中有一个`[unknown]`函数日志，这是为什么呢？

另一个可能值得的 perf GUI 界面包括：

*   Eclipse Trace Compass 插件：[https ://www.eclipse.org/tracecompass/](https://www.eclipse.org/tracecompass/)

    但这有一个缺点，您必须首先将数据转换为通用跟踪格式，这可以通过 来完成`perf data --to-ctf`，但它需要在构建时启用/有`perf`足够新的，这两种情况都不适用于 perf in Ubuntu 18.04

*   [https://github.com/KDAB/hotspot](https://github.com/KDAB/hotspot)

    这样做的缺点是似乎没有 Ubuntu 软件包，构建它需要 Qt 5.10，而 Ubuntu 18.04 是 Qt 5.9。

**gperftools**

以前称为“Google 性能工具”，来源：[https](https://github.com/gperftools/gperftools) ://github.com/gperftools/gperftools基于示例。

首先安装 gperftools：

```
sudo apt install google-perftools 
```

然后，我们可以通过两种方式启用 gperftools CPU 分析器：在运行时或在构建时。

在运行时，我们必须将 设置`LD_PRELOAD`为指向`libprofiler.so`，您可以使用 找到它`locate libprofiler.so`，例如在我的系统上：

```
gcc -ggdb3 -O3 -std=c99 -Wall -Wextra -pedantic -o main.out main.c
LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libprofiler.so \
  CPUPROFILE=prof.out ./main.out 10000 
```

或者，我们可以在链接时构建库，`LD_PRELOAD`在运行时分配传递：

```
gcc -Wl,--no-as-needed,-lprofiler,--as-needed -ggdb3 -O3 -std=c99 -Wall -Wextra -pedantic -o main.out main.c
CPUPROFILE=prof.out ./main.out 10000 
```

另请参阅：[gperftools - 配置文件未转储](https://stackoverflow.com/questions/46949407/gperftools-profile-file-not-dumped)

到目前为止，查看这些数据的最佳方法是使 pprof 输出与 kcachegrind 作为输入相同的格式（是的，Valgrind-project-viewer-tool）并使用 kcachegrind 来查看：

```
google-pprof --callgrind main.out prof.out  > callgrind.out
kcachegrind callgrind.out 
```

使用其中任何一种方法运行后，我们都会得到一个`prof.out`配置文件数据文件作为输出。我们可以通过以下方式将该文件以图形方式查看为 SVG：

```
google-pprof --web main.out prof.out 
```

[![在此处输入图像描述](https://i.stack.imgur.com/SiISF.png)](https://i.stack.imgur.com/SiISF.png)

与其他工具一样，它提供了一个熟悉的调用图，但使用的是样本数而不是秒数的笨重单位。

或者，我们还可以通过以下方式获取一些文本数据：

```
google-pprof --text main.out prof.out 
```

这使：

```
Using local file main.out.
Using local file prof.out.
Total: 187 samples
     187 100.0% 100.0%      187 100.0% common
       0   0.0% 100.0%      187 100.0% __libc_start_main
       0   0.0% 100.0%      187 100.0% _start
       0   0.0% 100.0%        4   2.1% fast
       0   0.0% 100.0%      187 100.0% main
       0   0.0% 100.0%      183  97.9% maybe_slow 
```

另请参阅：[如何使用 google perf 工具](https://stackoverflow.com/questions/10874308/how-to-use-google-perf-tools)

**使用原始`perf_event_open`系统调用检测您的代码**

我认为这与`perf`使用的底层子系统相同，但是您当然可以通过在编译时使用感兴趣的事件显式地检测您的程序来获得更大的控制权。

对于大多数人来说，这可能太硬核了，但它很有趣。最小可运行示例：[快速计算在 C 程序中执行的指令数](https://stackoverflow.com/questions/13313510/quick-way-to-count-number-of-instructions-executed-in-a-c-program/64863392#64863392)

**英特尔 VTune**

[https://en.wikipedia.org/wiki/VTune](https://en.wikipedia.org/wiki/VTune)

这似乎是封闭源代码且仅限 x86，但从我所听到的情况来看，这可能是惊人的。我不确定它的使用免费程度，但它似乎可以免费下载。TODO 评估。

在 Ubuntu 18.04、gprof2dot 2019.11.30、valgrind 3.13.0、perf 4.15.18、Linux 内核 4.15.0、FLameGraph 1a0dc6985aad06e76857cf2a354bd5ba0c9ce96b、gperftools 2.5-2 中测试。

* * *

## 回答 #9

> 赞同：32
> 
> 时间：2017-02-23T21:28:10.530

**使用 Valgrind、callgrind 和 kcachegrind：**

```
valgrind --tool=callgrind ./(Your binary) 
```

生成 callgrind.out.x。使用 kcachegrind 阅读它。

**使用 gprof（添加 -pg）：**

```
cc -o myprog myprog.c utils.c -g -pg 
```

（对多线程、函数指针不太好）

**使用谷歌性能工具：**

揭示了使用时间采样、I/O 和 CPU 瓶颈。

**英特尔 VTune 是最好的（免费用于教育目的）。**

**其他：** AMD Codeanalyst（后来被 AMD CodeXL 取代）、OProfile、“perf”工具（apt-get install linux-tools）

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2018-03-17T12:20:45.357

对于单线程程序，您可以使用**igprof**，Ignominous Profiler：[https](https://igprof.org/) ://igprof.org/ 。

它是一个采样分析器，类似于 Mike Dunlavey 的……长……答案，它将结果包装在一个可浏览的调用堆栈树中，并用每个函数花费的时间或内存进行注释，无论是累积的还是每个功能。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2018-09-14T22:56:48.260

另外值得一提的是

1.  HPCToolkit ( [http://hpctoolkit.org/](http://hpctoolkit.org/) ) - 开源，适用于并行程序，并有一个 GUI 可以通过多种方式查看结果
2.  英特尔 VTune ( [https://software.intel.com/en-us/vtune](https://software.intel.com/en-us/vtune) ) - 如果你有英特尔编译器，这非常好
3.  TAU ( [http://www.cs.uoregon.edu/research/tau/home.php](http://www.cs.uoregon.edu/research/tau/home.php) )

我使用过 HPCToolkit 和 VTune，它们在找到帐篷中的长杆时非常有效，并且不需要重新编译您的代码（除非您必须在 CMake 中使用 -g -O 或 RelWithDebInfo 类型构建以获得有意义的输出） . 我听说 TAU 的功能相似。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-11-28T18:21:44.820

这是我用来加速代码的两种方法：

***对于 CPU 绑定的应用程序：***

1.  在 DEBUG 模式下使用分析器来识别代码中有问题的部分
2.  然后切换到 RELEASE 模式并注释掉代码中有问题的部分（不加任何内容），直到看到性能发生变化。

***对于 I/O 绑定应用程序：***

1.  在 RELEASE 模式下使用分析器来识别代码中有问题的部分。

* * *

注意

如果您没有分析器，请使用穷人的分析器。在调试应用程序时点击暂停。大多数开发人员套件将分解为带有注释行号的程序集。从统计上讲，您很可能会进入一个占用您大部分 CPU 周期的区域。

对于 CPU，在**DEBUG**模式下进行分析的原因是，如果您尝试在**RELEASE**模式下进行分析，编译器将减少数学、向量化循环和内联函数，这些函数在汇编时往往会将您的代码弄成无法映射的混乱。**无法映射的混乱意味着您的探查器将无法清楚地识别花费这么长时间的原因，因为程序集可能与优化下的源代码不对应**。如果您需要**RELEASE**模式的性能（例如时序敏感），请根据需要禁用调试器功能以保持可用性能。

**对于 I/O-bound，分析器仍然可以在RELEASE**模式下识别 I/O 操作，因为 I/O 操作要么在外部链接到共享库（大多数情况下），要么在最坏的情况下，将导致 sys-调用中断向量（分析器也很容易识别）。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2019-11-03T14:47:54.107

[实际上，关于google/benchmark](https://github.com/google/benchmark)没有多少人提到有点惊讶，虽然固定代码的特定区域有点麻烦，特别是如果代码库有点大，但我发现这在结合使用时非常有用`callgrind`

恕我直言，识别导致瓶颈的部分是这里的关键。但是，我会先尝试回答以下问题，然后根据这些问题选择工具

1.  我的算法正确吗？
2.  有没有被证明是瓶颈的锁？
3.  是否有特定的代码部分被证明是罪魁祸首？
4.  IO，处理和优化怎么样？

`valgrind`结合`callgrind`和`kcachegrind`应该对上述几点提供一个不错的估计，一旦确定某些代码部分存在问题，我建议做一个微基准测试 -`google benchmark`是一个很好的起点。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-02-24T18:01:00.000

您可以使用 iprof 库：

[https://gitlab.com/Neurochrom/iprof](https://gitlab.com/Neurochrom/iprof)

[https://github.com/Neurochrom/iprof](https://github.com/Neurochrom/iprof)

它是跨平台的，并且允许您不实时测量应用程序的性能。您甚至可以将它与实时图表结合使用。完全免责声明：我是作者。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2019-05-21T13:28:31.817

您可以使用日志框架，[`loguru`](https://github.com/emilk/loguru)因为它包含时间戳和总正常运行时间，可以很好地用于分析：

[![](https://i.stack.imgur.com/eHqdn.png)](https://i.stack.imgur.com/eHqdn.png)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2019-05-17T10:13:01.050

在工作中，我们有一个非常好的工具，可以帮助我们监控我们想要的日程安排。这已经有用过无数次了。

它在 C++ 中，必须根据您的需要进行定制。不幸的是，我不能分享代码，只能分享概念。您使用`volatile`包含时间戳和事件 ID 的“大”缓冲区，您可以在事后或停止日志系统后转储（例如，将其转储到文件中）。

您使用所有数据检索所谓的大缓冲区，然后一个小接口解析它并显示带有名称（向上/向下 + 值）的事件，就像示波器使用颜色（在`.hpp`文件中配置）一样。

您可以自定义生成的事件数量，以仅关注您想要的内容。它对我们调度问题有很大帮助，同时根据每秒记录的事件量消耗我们想要的 CPU 量。

您需要 3 个文件：

```
toolname.hpp // interface
toolname.cpp // code
tool_events_id.hpp // Events ID 
```

这个概念是这样定义事件`tool_events_id.hpp`：

```
// EVENT_NAME                         ID      BEGIN_END BG_COLOR NAME
#define SOCK_PDU_RECV_D               0x0301  //@D00301 BGEEAAAA # TX_PDU_Recv
#define SOCK_PDU_RECV_F               0x0302  //@F00301 BGEEAAAA # TX_PDU_Recv 
```

您还定义了一些函数`toolname.hpp`：

```
#define LOG_LEVEL_ERROR 0
#define LOG_LEVEL_WARN 1
// ...

void init(void);
void probe(id,payload);
// etc 
```

您可以在代码中的任何位置使用：

```
toolname<LOG_LEVEL>::log(EVENT_NAME,VALUE); 
```

该`probe`函数使用几条装配线尽快检索时钟时间戳，然后在缓冲区中设置一个条目。我们还有一个原子增量来安全地找到存储日志事件的索引。当然缓冲区是循环的。

希望这个想法不会因为缺少示例代码而被混淆。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-12-07T12:52:42.283

`-pg`在编译和链接代码并运行可执行文件时使用标志。在执行此程序时，分析数据将收集在文件 a.out 中。
有两种不同类型的分析

1-平面分析：
通过运行命令`gprog --flat-profile a.out`，您可以获得以下数据
- 函数花费的总时间百分比，
- 在函数中花费的秒数 - 包括和不包括对子函数的调用，
- 的数量呼叫，
- 每次呼叫的平均时间。

2-图形分析
我们`gprof --graph a.out`获取每个函数的以下数据的命令，其中包括
- 在每个部分中，一个函数标有索引号。
- 在函数上方，有一个调用该函数的函数列表。
- 在函数下面，有一个函数调用的函数列表。

要获取更多信息，您可以查看[https://sourceware.org/binutils/docs-2.32/gprof/](https://sourceware.org/binutils/docs-2.32/gprof/)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-04-18T19:23:34.600

**使用调试软件** 如何识别代码运行缓慢的地方？

**只是认为你在运动时有障碍物，那么它会降低你的速度**

像不需要的重新分配循环、缓冲区溢出、搜索、内存泄漏等操作会消耗更多的执行能力，这将对代码的性能产生不利影响，请务必在分析之前将 -pg 添加到编译中：

`g++ your_prg.cpp -pg`或`cc my_program.cpp -g -pg`根据您的编译器

还没有尝试过，但我听说过关于 google-perftools 的好消息。绝对值得一试。

`valgrind --tool=callgrind ./(Your binary)`

它将生成一个名为 gmon.out 或 callgrind.out.x 的文件。然后，您可以使用 kcachegrind 或调试器工具来读取此文件。它将为您提供图形分析结果，例如哪些线路的成本是多少。

我认同

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-06-28T04:44:24.423

由于没有人提到 Arm MAP，我个人将其添加为我已成功使用 Map 来分析 C++ 科学程序。

Arm MAP 是并行、多线程或单线程 C、C++、Fortran 和 F90 代码的分析器。它提供对源代码行的深入分析和瓶颈定位。与大多数分析器不同，它旨在能够分析 pthread、OpenMP 或 MPI 以实现并行和线程代码。

MAP 是商业软件。

# .net - 重构Linq表达式的选择部分？

> ID：375915
> 
> 赞同：5
> 
> 时间：2008-12-17T20:30:14.913
> 
> 标签：.net, linq, linq-to-sql

我正在玩一些 Linq-SQL 的东西，做这样的事情：

```
var foo = from f in db.Foo where f.Bar > 5 select f; 
```

这一切都很好，花花公子，我知道我也可以这样做：

```
var foo = from f in db.Foo where f.Bar > 5 select new { f.Bar, f.Baz }; 
```

我想知道的是，如果我想在运行时确定要选择 Foo 的哪些部分，我可以排除该查询的选择部分吗？如：

```
var foo = from f in db.Foo where f.Bar > 5 select SomeMethodThatReturnsThePropertiesOfFooIReallyWant(); 
```

编辑澄清：我正在寻找 SomeMethod...() 的语法和返回类型。

如果我有时想这样做：

```
select new { f.Bar, f.Baz }; 
```

但其他时候这样做：

```
select new { f.Baz, f.Other }; 
```

基于内存中的数据（没有做一个巨大的案例陈述），如果可能的话，我将如何做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T20:35:17.040

当然，虽然在流利的语法中更容易：

```
var query_foo = db.Foo.Where(f=>f.Bar >  5);
//  :
var foo =query_foo.Select(f=>SomeMethodThatReturnsEtc(f)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T06:36:57.643

有时最简单的做法就是创建一个带有一堆公共 get 的简单数据类；并设置；这样您就可以将数据选择到该类中。如果您正在处理可空类型，当您使用数据时会非常清楚，但如果它是所有字符串，您可能会在使用数据时发现其他更干净的东西。

一个简单的例子

```
public class MyData {
public string Bar {get;set;}
public int? Baz {get;set;}
public DateTime? {get;set;}
}

var foo = from f in db.Foo where f.Bar > 5 select new MyData { Bar = f.Bar, Foo = f.Foo }; 
```

如果您希望将 select 放在与 select 语句不同的位置，您也可以像这样将您的语句分开，这只会在您尝试枚举它时访问服务器。

```
var foo = from f in db.Foo where f.Bar > 5 select f;
var fooData = f.Select(new MyData .... } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T06:01:24.560

您将需要动态构建一个小投影（选择）表达式以附加到您的过滤基本查询。有关一些示例，请参见以下内容之一：

VS 2008 附带的动态查询示例中的 Dynamic.cs

[http://www.albahari.com/nutshell/predicatebuilder.aspx](http://www.albahari.com/nutshell/predicatebuilder.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T21:44:51.440

> 我想我真正的问题是，SomeMethod() 的语法是什么？– 乔纳斯（一小时前）

您想要这样做的方式，您只能从方法中返回“对象”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T06:08:33.297

您不能从函数中返回匿名类型，因此您会被声明的类型所困扰，这与您的问题或对象不符，这不会很有帮助。

更重要的是，您希望对结果做什么？如果成员在编译时实际上是未知的，我不确定你能用它做什么......

# c++ - c++ 快板输入

> ID：375918
> 
> 赞同：0
> 
> 时间：2008-12-17T20:30:37.627
> 
> 标签：c++, input, allegro

我正在构建一个简单的冰块滑动拼图来测试 allegro 的用途。到目前为止，我已经完成了整个工作，虽然我还没有真正添加目标或谜题，只是它背后的引擎。我在让“r”将玩家跳回起始点时遇到了一点麻烦，谁能告诉我为什么？

```
#include <allegro.h>
#include "maps.cpp"

BITMAP* buffer;

int x = 15;
int y = 11;

int tempX = 15;
int tempY = 11;

int startX = 15;
int startY = 11;

//This will be our background, 1 = clouds, 2 = brick, 3 = floor
int map[24][32] = //{{2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,3,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,3,3,3,3,2,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2},
                   //{2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2}};

//This will contain all the objects, 100 = player
int objMap[24][32] = //{{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                   //{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}};

void setupGame(){

     buffer = create_bitmap( 640, 480);

    for (int i = 0; i <= 24; i++){

        for( int t = 0; t <= 32; t++){

            if( map[i][t] == 1) rectfill( buffer, t * 20, i * 20, (t + 1) * 20, (i + 1) * 20, makecol( 128, 255, 255));
            else if( map[i][t] == 2) rectfill( buffer, t * 20, i * 20, (t + 1) * 20, (i + 1) * 20, makecol( 255, 128, 0));
            else if( map[i][t] == 3) rectfill( buffer, t * 20, i * 20, (t + 1) * 20, (i + 1) * 20, makecol( 0, 0, 255));

           }       

    }

    for (int i = 0; i <= 24; i++){

        for( int t = 0; t <= 32; t++){

            if( objMap[i][t] == 100) circlefill( buffer, (t * 20) + 10, (i * 20) + 10, 10, makecol( 255, 255, 0));

           }       

    }

    draw_sprite( screen, buffer, 0, 0);

}

void movePlayer(){

    tempX = x;
    tempY = y;

    if(key[KEY_UP] && map[y - 1][x] == 3)
        for ( ; map[y - 1][x] == 3; --y){              
        }

    else if(key[KEY_DOWN] && map[y + 1][x] == 3)
        for ( ; map[y + 1][x] == 3; ++y){
        }

    else if(key[KEY_RIGHT] && map[y][x + 1] == 3)
        for ( ; map[y][x + 1] == 3; ++x){
        }

    else if(key[KEY_LEFT] && map[y][x - 1] == 3)
        for ( ; map[y][x - 1] == 3; --x){
        }
    else if(key[KEY_R] && map[startY][startX] == 3)
         for ( ; map[startY][startX] == 3 ; y = startY, x = startX){ // this is the section
         }

     acquire_screen();

     rectfill( buffer, tempX * 20, tempY * 20, (tempX + 1) * 20, (tempY + 1) * 20, makecol( 0, 0, 255));

     circlefill( buffer, (x * 20) + 10, (y * 20) + 10, 10, makecol( 255, 255, 0));

     draw_sprite( screen, buffer, 0, 0);
     release_screen();

     rest(20);
}

int main(){

    allegro_init();
    install_keyboard();
    set_color_depth(16);
    set_gfx_mode( GFX_AUTODETECT, 640, 480, 0, 0);

    setupGame();

    while( !key[KEY_ESC]){

           movePlayer();

    }

    return 0;

}

END_OF_MAIN(); 
```

除了它似乎跳过的部分之外，它都运行。

如果你能帮忙，谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T20:48:22.990

for 语句在执行最后一节中的语句之前检查其完成条件（中间部分）。由于在输入 for 语句之前完成条件为真 - 也就是说，因为 map[startY][startX] 已经是 3 - 最后一个语句被跳过。

老实说，我认为这里真正的问题是您对 for 语句的使用。即使在它正常工作的部分，你也在以一种非常不自然和不习惯的方式使用它。更好的是（例如）：

```
while (map[y][x - 1] == 3) --x; 
```

在“重新启动”不起作用的情况下，很自然的做法是完全跳过 for 语句：

```
else if(key[KEY_R] && map[startY][startX] == 3)
{
  y = startY;
  x = startX;
} 
```

# c# - 如何在 c# 中导出 asp:GridView 的 TemplateField 字段到 excel？

> ID：375928
> 
> 赞同：0
> 
> 时间：2008-12-17T20:34:25.890
> 
> 标签：c#, asp.net, gridview

有没有人有一个示例（代码或链接）可以让我将 gridview 模板字段导出到 excel 中？这是我的意思的一个例子。假设我有以下 GridView 声明：

```
<asp:GridView Id="gvResults" runat="server">
    <Columns>
        <asp:TemplateField HeaderText="Contact Info">
            <ItemTemplate>
                <b>Name:</b><%# Eval("Name") %><br/>
                <b>Address:</b><%# Eval("Address") %><br/>
                <b>Phone:</b><%# Eval("Phone") %><br/>
                <b>E-mail:</b><%# Eval("Email") %>
            </ItemTemplate>
        </asp:TemplateField>
    </Columns>
</asp:GridView> 
```

当我导出到 excel 时，我想将模板字段中的字段导出到 excel 文件中的列，所以它看起来类似于这样：

姓名 地址 电话 电子邮件

==== ======= ==== =====

约翰 123 Rd 40330 J@j.com

马克 456 街 22039 M@M.com

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T20:50:19.960

我强烈建议任何使用开箱即用的 asp gridview 控件的人考虑花一些钱购买第三方软件包（[DevExpress](http://demos.devexpress.com/ASPxGridViewDemos/)是我的最爱）

话虽[如此](http://www.c-sharpcorner.com/UploadFile/DipalChoksi/exportxl_asp2_dc11032006003657AM/exportxl_asp2_dc.aspx)，我之前别无选择时使用过

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-16T14:18:52.737

```
 For i = 0 To gvExport.Rows.Count - 1
        For j = rowsLeftTrimed To cellCount - 1

            If gvExport.Rows(i).Cells(j).Text = String.Empty Then
                Dim ctl As DataBoundLiteralControl = _
                  TryCast(gvExport.Rows(i).Cells(j).Controls(0), DataBoundLiteralControl)

                If ctl IsNot Nothing Then
                    sw.Write(Chr(34) & ctl.Text.Trim & Chr(34) & ",")
                End If

            'Else
            '    sw.Write(Chr(34) & gvExport.Rows(i).Cells(j).Text & Chr(34))
            End If
        Next
        sw.WriteLine()
    Next 
```

# .net - WCF 冷启动

> ID：375937
> 
> 赞同：3
> 
> 时间：2008-12-17T20:38:20.843
> 
> 标签：.net, wcf

我在相当苛刻的环境中使用 WCF。我观察到的一种行为是我将其称为冷启动。当我第一次启动一个调用服务的客户端时，第一次调用似乎有很多失败。例如，我可以看到前 10 个呼叫通过，然后接下来的 200 个呼叫全部失败。我正在异步与服务交谈。然后服务运行并响应良好。我可以看到这是一个端点（可能）问题而不是操作问题，因为多个不同的操作都会失败。感觉就像有一个锁，端点停止并自行重置，然后就可以了，尽管我没有证据支持这一点。

服务器端跟踪中没有错误。我的客户端日志显示了很多以下异常：

System.ServiceModel.CommunicationException：服务器没有提供有意义的回复；这可能是由于合同不匹配、会话过早关闭或内部服务器错误造成的。

我已经考虑实施一种平滑算法来平衡服务调用，因为在启动时往往会有很多服务调用。有没有其他人看到过类似的行为？谢谢。

史蒂夫

编辑：该服务托管在 Windows 服务中。

编辑：感谢您的评论。

我从一开始就将各个队列上的数字设置得非常高。我对如何扩展 WCF 服务有一些来之不易的知识。我允许 2048 个并发连接。我已经设置了listenBackLog等...

我对前 1000 个调用进行了平滑处理，这似乎得到了它。它可能与 JIT 有关，但我对此没有任何证据。暂时我要离开它，看看它是否会再次发生。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T20:42:19.337

出于兴趣，您如何托管 WCF 服务器？IIS 具有方便的池化（通过 NLB，例如 F5），但存在应用程序池回收问题，以及 IIS 首先生成（按需）应用程序池/域/等引起的滞后。自托管（Windows 服务等）往往对性能更加线性和可预测，特别是如果（在服务启动期间）您强制加载所有内容，也许是通过向自己提出请求（如果您明白我的意思）。

如果您不需要集群服务，请考虑自托管它。看看是否有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T01:21:50.217

您是否尝试过增加端点的排队连接数？可能有 10 个排队，当 .NET CLR 正在 JIT 处理您的代码时，其余的传入连接将被拒绝，直到您的代码开始运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-03T18:51:02.303

这是一个较老的话题，但我发现自己处于类似的情况。OP表示

> 我对前 1000 个调用进行了平滑处理，这似乎得到了它。

他所说的“平滑”到底是什么意思我做了谷歌搜索，它似乎不是一个关键字......

# c# - 查找数组或 XML 中值的频率 (C#)

> ID：375940
> 
> 赞同：2
> 
> 时间：2008-12-17T20:40:19.527
> 
> 标签：c#, xml, linq, linq-to-xml, frequency

我有一个 XML 提要（我无法控制），我试图弄清楚如何检测文档中某些属性值的数量。

我还在解析 XML 并将属性分成数组（用于其他功能）

这是我的 XML 示例

```
<items>
<item att1="ABC123" att2="uID" />
<item att1="ABC345" att2="uID" />
<item att1="ABC123" att2="uID" />
<item att1="ABC678" att2="uID" />
<item att1="ABC123" att2="uID" />
<item att1="XYZ123" att2="uID" />
<item att1="XYZ345" att2="uID" />
<item att1="XYZ678" att2="uID" />
</items> 
```

我想根据每个 att1 值找到卷节点。Att1 值会改变。一旦我知道了 att1 值的频率，我需要提取该节点的 att2 值。

我需要找到前 4 个项目并提取它们的属性值。

所有这些都需要在后面的 C# 代码中完成。

如果我使用 Javascript，我将创建一个关联数组，并以 att1 为键，以频率为值。但由于我是 c# 新手，我不知道如何在 c# 中复制它。

所以我相信，首先我需要在 XML 中找到所有唯一的 att1 值。我可以这样做：

```
IEnumerable<string> uItems = uItemsArray.Distinct();
// Where uItemsArray is a collection of all the att1 values in an array 
```

然后我陷入了如何将每个唯一的 att1 值与整个文档进行比较以获取存储在变量或数组或任何数据集中的卷。

这是我最终使用的片段：

```
 XDocument doc = XDocument.Load(@"temp/salesData.xml");
        var topItems = from item in doc.Descendants("item")
                    select new
                    {
                        name = (string)item.Attribute("name"),
                        sku = (string)item.Attribute("sku"),
                        iCat = (string)item.Attribute("iCat"),
                        sTime = (string)item.Attribute("sTime"),
                        price = (string)item.Attribute("price"),
                        desc = (string)item.Attribute("desc")

                    } into node
                    group node by node.sku into grp
                    select new { 
                        sku = grp.Key,
                        name = grp.ElementAt(0).name,
                        iCat = grp.ElementAt(0).iCat,
                        sTime = grp.ElementAt(0).sTime,
                        price = grp.ElementAt(0).price,
                        desc = grp.ElementAt(0).desc,
                        Count = grp.Count() 
                    };

        _topSellers = new SalesDataObject[4];
        int topSellerIndex = 0;
        foreach (var item in topItems.OrderByDescending(x => x.Count).Take(4))
        {
            SalesDataObject topSeller = new SalesDataObject();
            topSeller.iCat = item.iCat;
            topSeller.iName = item.name;
            topSeller.iSku = item.sku;
            topSeller.sTime = Convert.ToDateTime(item.sTime);
            topSeller.iDesc = item.desc;
            topSeller.iPrice = item.price;
            _topSellers.SetValue(topSeller, topSellerIndex);
            topSellerIndex++;
        } 
```

感谢你的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T20:47:24.787

您使用的是 .NET 3.5 吗？（它看起来像基于您的代码。）如果是这样，我怀疑使用 LINQ to XML 和 LINQ to Objects 很容易。但是，恐怕从您的示例中不清楚您想要什么。具有相同 att1的所有值是否*也*具有相同的 att2？如果是这样，它是这样的：

```
var results = (from element in items.Elements("item")
              group element by element.Attribute("att1").Value into grouped
              order by grouped.Count() descending
              select grouped.First().Attribute("att2").Value).Take(4); 
```

我还没有测试它，但我*认为*它应该可以工作......

*   我们从所有项目元素开始
*   我们按它们的 att1 值对它们（仍然作为元素）进行分组
*   我们按组的大小对组进行排序，降序排列，所以最大的排在第一位
*   从每个组中，我们取第一个元素来找到它的 att2 值
*   我们将这些结果中的前四名

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T20:47:01.120

如果你有这些值，你应该能够使用 LINQ 的 GroupBy ...

```
 XDocument doc = XDocument.Parse(xml);
        var query = from item in doc.Descendants("item")
                    select new
                    {
                        att1 = (string)item.Attribute("att1"),
                        att2 = (string)item.Attribute("att2") // if needed
                    } into node
                    group node by node.att1 into grp
                    select new { att1 = grp.Key, Count = grp.Count() };

        foreach (var item in query.OrderByDescending(x=>x.Count).Take(4))
        {
            Console.WriteLine("{0} = {1}", item.att1, item.Count);
        } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T20:52:13.153

您可以使用 LINQ/XLINQ 来完成此操作。下面是我刚刚编写的一个示例控制台应用程序，因此代码可能没有经过优化，但它可以工作。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Xml.Linq;
using System.Text;

namespace FrequencyThingy
{
    class Program
    {
        static void Main(string[] args)
        {
            string data = @"<items>
                            <item att1=""ABC123"" att2=""uID"" />
                            <item att1=""ABC345"" att2=""uID"" />
                            <item att1=""ABC123"" att2=""uID"" />
                            <item att1=""ABC678"" att2=""uID"" />
                            <item att1=""ABC123"" att2=""uID"" />
                            <item att1=""XYZ123"" att2=""uID"" />
                            <item att1=""XYZ345"" att2=""uID"" />
                            <item att1=""XYZ678"" att2=""uID"" />
                            </items>";
            XDocument doc = XDocument.Parse(data);
            var grouping = doc.Root.Elements().GroupBy(item => item.Attribute("att1").Value);

            foreach (var group in grouping)
            {
                var groupArray = group.ToArray();
                Console.WriteLine("Group {0} has {1} element(s).", groupArray[0].Attribute("att1").Value, groupArray.Length);
            }

            Console.ReadKey();
        }
    }
} 
```

# php - PHP/FTP ftp_put() 抛出奇怪的错误信息——怎么办？

> ID：375956
> 
> 赞同：3
> 
> 时间：2008-12-17T20:45:13.667
> 
> 标签：php, ftp

我`ftp_put / ftp_nb_put`用来将文件从我的 PHP 服务器上传到另一台机器。我经常（90% 的时间）收到荒谬的错误消息，例如：

```
Warning: ftp_nb_put(): 2 matches total 
Warning: ftp_nb_put(): Transfer complete
Warning: ftp_nb_continue(): Opening BINARY mode data connection 
```

现在我可以处理诸如“没有这样的目录”或“密码错误”之类的错误，但这些“错误消息”似乎完全没有意义。

Google 建议这是与防火墙/PASV 相关的问题。我试过 ftp_pasv()，但无济于事。我已经联系了我的服务器管理员，但到目前为止他也没有提出任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-28T06:46:56.687

好吧，因为这些只是警告并且您可以正确完成工作，您可以使用 ini_set() 或更改 php.ini 关闭警告。这不会解决任何问题，但您肯定不会收到错误 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-14T13:33:54.817

服务器出现的一些神秘网络问题的症状的消息。PHP 无法正确诊断此类问题，并从服务器之间的通信中输出看似随机的片段。

实际上不是编程问题，而是“服务器故障”问题（或者更确切地说是“获得更好的虚拟主机”问题）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T11:32:26.200

这不是很有帮助，但我也建议您在查看 php 错误日志时，在另一个窗口中打开 ftp 并尝试找出所有相关的东西。大多数 ftp 服务器都有自己的日志文件，或者记录到 syslog。

也许您可以使用 vmware 磁盘映像或在 virtualbox（或类似的）中复制环境并更快地进行调试。

# legacy - 你有没有研究过每次都会让你死掉一点的“老派代码”？

> ID：375958
> 
> 赞同：0
> 
> 时间：2008-12-17T20:45:37.177
> 
> 标签：legacy

每次我将这个遗留代码转换为 Web 应用程序时，我都觉得自己内心有点死。数据库很垃圾。所有的字段和列都是 nvarchar 和空白（空字符串）假设表示无（Null）而不是使用 Null 表示无。对于百分比之类的东西，而不是使用小数。您标记额外的两个零并将其存储为字符串（nvarchar）。当我深入数据库，处理代码并发现旧的遗留应用程序如何工作时。我死了一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T20:52:43.950

我同情。稍微死掉一点对你的健康有害。感觉更好的一种方法是修复它，一次一点点。让它更正确一点，你会感觉好多了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T20:49:47.387

是的，每天。我们混合了一些实用程序，这些实用程序要么是非常糟糕的 C++ (MFC)，要么是 VB6，这暗示着它们很糟糕；-)

我作为承包商工作了 5 年，其中一部分工作是编写非常糟糕的代码。当承包商被引入时，情况通常很糟糕。我的灵魂早在几年前就死了！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T20:54:34.397

是的，我有过。一种是数据库由类似 excel 的表组成。每个表中都有一些相同的数据。

然后是基于流程图的程序，用于输入数据……没有命名约定，无用或没有注释，到处都是无法解释的常量……甚至不要让我开始使用流程图软件本身……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T20:49:52.970

我现在正在做。我正在对从以下位置迁移**到****.NET**解决方案进行架构评估：

 ***   旧的 VB6 代码，有几十种形式，只有几个类
*   带有 60 多个 DTS 包的 SQL Server 7 后端

这一切都**非常古老**，几乎**没有错误处理**。

我现在去哭...

# delphi - 是否可以在 RAD Studio 2009 中关闭 Unicode 支持？

> ID：375962
> 
> 赞同：2
> 
> 时间：2008-12-17T20:46:21.327
> 
> 标签：delphi, ide, delphi-2009

我在使用 RAD Studio 2009 时遇到了一点问题。
如您所知，可以在 MSVS 中关闭 Unicode 支持（右键单击解决方案->属性->字符集=未设置）。我需要在 RAD Studio 中找到这个功能，我知道它存在但不知道具体在哪里。
这是唯一阻止我在 Socket Chat 大学项目上工作的事情。
PS 这个问题是在我从 CodeGear 官方网站安装更新后出现的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-18T02:08:54.653

简短回答：不，RAD Studio 2009 中没有关闭 Unicode 的功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T02:24:03.680

您必须小心使用 UnicodeString::t_str() 方法。如果在为 Ansi 而不是 Unicode 编译的项目中调用它，t_str() 会更改 UnicodeString 的内部内容。这可能会产生意想不到的副作用，尤其是对于来自控件的 UnicodeString 值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T02:25:36.950

chester - 你不需要直接调用 WideCharToMultiByte()。让 RTL 为您完成工作：

```
AnsiString s = Form2->Edit1->Text;
MessageBoxA(NULL, s.c_str(), "It`s ok", MB_OK); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-04T09:29:10.073

是否可以关闭它？更好的问题是：你应该把它关掉吗？答案是：不。

设计应用程序以便在序列化时正确发送 Unicode 字符（例如，在应用程序的套接字中）比在 Unicode 世界中设计非 Unicode 程序要远得多。即使对于一个简单的项目，原则上也值得学习 Unicode。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T15:07:57.490

准确地说，您可以通过修改“TCHAR maps to char”的项目选项来构建您的 C++ Builder 应用程序，而无需定义 #UNICODE 标志。

这意味着 SendMessage 将调用 SendMessageA 等，而 TCHAR

但是，如果您使用任何 VCL 函数，则没有非 unicode 等效项。VCL 现在是固有的 Unicode，并且无法更改。

回复：您的“解决方案”-有一种更简单的方法。它适用于 TCHAR = char 或 wchar_t：

```
MessageBox(NULL, Form2->Edit1->Text.t_str(), _TEXT("It`s ok"), MB_OK); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-19T14:31:57.630

有一个更好的方法，我这样做：

```
MessageBox(NULL, Form2->Edit1->Text.w_str(), L"It`s ok", MB_OK); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T22:13:17.203

我已经通过这种方式解决了这个问题：

```
 wchar_t* str = Form2->Edit1->Text.w_str();
    char* mystr = new char [Form2->Edit1->Text.Length() + 1];
    WideCharToMultiByte(CP_ACP, 0, str, -1, mystr, Form2->Edit1->Text.Length() + 1, NULL, NULL);
    MessageBox(NULL, mystr, "It`s ok", MB_OK);
    delete []mystr; 
```

但在我看来，还有另一种方式

# oracle - ORA-04091: 表 [blah] 正在变异，触发器/函数可能看不到它

> ID：375968
> 
> 赞同：6
> 
> 时间：2008-12-17T20:48:01.103
> 
> 标签：oracle, hibernate, triggers, ora-04091

我最近开始研究一个大型复杂的应用程序，由于这个错误，我刚刚被分配了一个错误：

```
ORA-04091: table SCMA.TBL1 is mutating, trigger/function may not see it
ORA-06512: at "SCMA.TRG_T1_TBL1_COL1", line 4
ORA-04088: error during execution of trigger 'SCMA.TRG_T1_TBL1_COL1' 
```

有问题的触发器看起来像

```
 create or replace TRIGGER TRG_T1_TBL1_COL1
   BEFORE  INSERT OR UPDATE OF t1_appnt_evnt_id ON TBL1
   FOR EACH ROW
   WHEN (NEW.t1_prnt_t1_pk is not  null)
   DECLARE
        v_reassign_count number(20);
   BEGIN
       select count(t1_pk) INTO v_reassign_count from TBL1
              where  t1_appnt_evnt_id=:new.t1_appnt_evnt_id and t1_prnt_t1_pk is not null;
       IF (v_reassign_count > 0) THEN
           RAISE_APPLICATION_ERROR(-20013, 'Multiple reassignments not allowed');
       END IF;
   END; 
```

该表有一个主键“ `t1_pk`”、一个“约会事件 id” `t1_appnt_evnt_id`和另一列“ `t1_prnt_t1_pk`”，它可能包含也可能不包含另一行的`t1_pk`.

看来触发器正在尝试确保没有其他具有相同内容的人`t1_appnt_evnt_id`引用~~同一~~行，如果该行引用另一行，则该行引用另一行的引用。

DBA 对错误报告的评论说“删除触发器，并在代码中执行检查”，但不幸的是，他们在 Hibernate 之上有一个专有的代码生成框架，所以我什至无法弄清楚它实际上在哪里被写出来，所以我希望有办法让这个触发器工作。有没有？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T21:05:00.867

我想我不同意你对触发器试图做什么的描述。在我看来，它似乎是为了强制执行此业务规则：对于给定的 t1_appnt_event 值，一次只能有一行具有 t1_prnt_t1_pk 的非 NULL 值。（它们在第二列中是否具有相同的值并不重要。）

有趣的是，它是为 UPDATE OF t1_appnt_event 定义的，但不是为另一列定义的，所以我认为有人可以通过更新第二列来打破规则，除非该列有单独的触发器。

可能有一种方法可以创建一个基于函数的索引来强制执行此规则，这样您就可以完全摆脱触发器。我想出了一种方法，但它需要一些假设：

*   该表有一个数字主键
*   主键和 t1_prnt_t1_pk 都是正数

如果这些假设成立，您可以创建如下函数：

```
dev> create or replace function f( a number, b number ) return number deterministic as
  2  begin
  3    if a is null then return 0-b; else return a; end if;
  4  end; 
```

和这样的索引：

```
CREATE UNIQUE INDEX my_index ON my_table
  ( t1_appnt_event, f( t1_prnt_t1_pk, primary_key_column) ); 
```

因此，PMNT 列为 NULL 的行将出现在索引中，主键的倒数作为第二个值，因此它们永远不会相互冲突。不为 NULL 的行将使用列的实际（正）值。如果两行在两列中都具有相同的非 NULL 值，那么您可能会违反约束的唯一方法。

这可能过于“聪明”，但它可能会帮助您解决问题。

Paul Tomblin 的更新：我对 igor 在评论中提出的原始想法进行了更新：

```
 CREATE UNIQUE INDEX cappec_ccip_uniq_idx 
 ON tbl1 (t1_appnt_event, 
    CASE WHEN t1_prnt_t1_pk IS NOT NULL THEN 1 ELSE t1_pk END); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T21:33:49.653

我同意 Dave 的观点，即可以而且应该使用内置约束（例如唯一索引（或唯一约束））来实现所需的结果。

如果您确实需要解决 mutating table 错误，通常的方法是创建一个包，其中包含一个包范围的变量，该变量是一个表，可用于识别更改的行（我认为 ROWID 是可能，否则你必须使用PK，我目前不使用Oracle，所以我无法测试它）。FOR EACH ROW 触发器然后用语句修改的所有行填充此变量，然后有一个 AFTER each 语句触发器读取行并验证它们。

类似的东西（语法可能是错误的，我已经几年没有与 Oracle 合作了）

```
CREATE OR REPLACE PACKAGE trigger_pkg;
   PROCEDURE before_stmt_trigger;
   PROCEDURE for_each_row_trigger(row IN ROWID);
   PROCEDURE after_stmt_trigger;
END trigger_pkg;

CREATE OR REPLACE PACKAGE BODY trigger_pkg AS
   TYPE rowid_tbl IS TABLE OF(ROWID);
   modified_rows rowid_tbl;

   PROCEDURE before_stmt_trigger IS
   BEGIN
      modified_rows := rowid_tbl();
   END before_each_stmt_trigger;

   PROCEDURE for_each_row_trigger(row IN ROWID) IS
   BEGIN
      modified_rows(modified_rows.COUNT) = row;
   END for_each_row_trigger;

   PROCEDURE after_stmt_trigger IS
   BEGIN
      FOR i IN 1 .. modified_rows.COUNT LOOP
         SELECT ... INTO ... FROM the_table WHERE rowid = modified_rows(i);
         -- do whatever you want to
      END LOOP;
   END after_each_stmt_trigger;
END trigger_pkg;

CREATE OR REPLACE TRIGGER before_stmt_trigger BEFORE INSERT OR UPDATE ON mytable AS
BEGIN
   trigger_pkg.before_stmt_trigger;
END;

CREATE OR REPLACE TRIGGER after_stmt_trigger AFTER INSERT OR UPDATE ON mytable AS
BEGIN
   trigger_pkg.after_stmt_trigger;
END;

CREATE OR REPLACE TRIGGER for_each_row_trigger
BEFORE INSERT OR UPDATE ON mytable
WHEN (new.mycolumn IS NOT NULL) AS
BEGIN
   trigger_pkg.for_each_row_trigger(:new.rowid);
END; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T10:45:18.980

对于任何基于触发器（或基于应用程序代码）的解决方案，您需要进行锁定以防止多用户环境中的数据损坏。即使您的触发器有效，或者被重写以避免变异表问题，它也不会阻止 2 个用户同时将 t1_appnt_evnt_id 更新为 t1_appnt_evnt_id 不为空的行上的相同值：假设当前没有 t1_appnt_evnt_id=123 的行并且 t1_prnt_t1_pk 不为空：

```
Session 1> update tbl1 
           set t1_appnt_evnt_id=123 
           where t1_prnt_t1_pk =456;
           /* OK, trigger sees count of 0 */

Session 2> update tbl1
           set t1_appnt_evnt_id=123
           where t1_prnt_t1_pk =789;
           /* OK, trigger sees count of 0 because 
              session 1 hasn't committed yet */

Session 1> commit;

Session 2> commit; 
```

您现在有一个损坏的数据库！

避免这种情况的方法（在触发器或应用程序代码中）是在执行检查之前锁定 t1_appnt_evnt_id=123 引用的表中的父行：

```
select appe_id 
into   v_app_id
from parent_table
where appe_id = :new.t1_appnt_evnt_id
for update; 
```

现在会话 2 的触发器必须等待会话 1 提交或回滚才能执行检查。

实现 Dave Costa 的索引会更简单、更安全！

最后，我很高兴没有人建议将 PRAGMA AUTONOMOUS_TRANSACTION 添加到您的触发器中：这通常在论坛上被建议并且在变异表问题消失时起作用 - 但它使数据完整性问题更加严重！所以不要...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-17T12:30:39.097

我对 Hibernate 有类似的错误。并通过使用刷新会话

```
getHibernateTemplate().saveOrUpdate(o);
getHibernateTemplate().flush(); 
```

为我解决了这个问题。（我没有发布我的代码块，因为我确信所有内容都已正确编写并且应该可以工作 - 但直到我添加了前面的 flush() 语句后才发布）。也许这可以帮助某人。

# asp.net - Zip 文件夹在下载后总是损坏

> ID：375976
> 
> 赞同：0
> 
> 时间：2008-12-17T20:48:56.513
> 
> 标签：asp.net

出于某种原因，当我从服务器的文件夹中下载一个 zip 文件夹时，它总是损坏。这是代码：

```
 protected void gvFiles_RowCommand(object sender, System.Web.UI.WebControls.GridViewCommandEventArgs e)
        {
            string fileUrl = String.Empty; 

            if(e.CommandName.Equals("DownloadFile"))
            {
                fileUrl = e.CommandArgument as String;
                string fileName = Path.GetFileName(fileUrl);

                Response.AppendHeader("content-disposition",
        "attachment; filename=" + fileName);
                Response.ContentType = "application/zip";

                Response.WriteFile(fileUrl);
                Response.End();  

            }
        } 
```

以下是 GridView 的填充方式：

```
private void BindData()
        {
            List<SampleFile> files = new List<SampleFile>(); 

            for(int i=1;i<=3;i++)
            {
                SampleFile sampleFile = new SampleFile();
                sampleFile.Name = "File " + i;
                sampleFile.Url = Server.MapPath("~/Files/File"+i+".txt");
                files.Add(sampleFile);
            }

            SampleFile file = new SampleFile();
            file.Name = "Zip File";
            file.Url = Server.MapPath("~/Files/WebSiteNestedMasters.zip");
            files.Add(file);
            gvFiles.DataSource = files;
            gvFiles.DataBind(); 
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T20:56:52.193

我根本不知道 asp.net，但这通常是在文本模式而不是二进制模式下进行下载的结果。行尾字符从 \r\n 转换为 \n 或反之亦然，一切都变得疯狂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T21:13:48.180

正如@lassevk 建议的那样，您应该下载*损坏*的zip 文件并将其与服务器上的原始文件进行比较。两者长度一样吗？使用十六进制编辑器检查文件的内容。在这个[相关线程](https://stackoverflow.com/questions/372914/zipping-files-and-downloading-them-using-saveas-dialog#375697)中，您说如果您将浏览器直接指向 zip 文件，它也会损坏，这意味着问题可能与标头无关，而是 IIS 有问题。您是否使用了一些可以修改文件的第三方 ISAPI 扩展？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T23:27:54.383

假设您需要这样做：（例如，您无法提供直接链接）

```
<a href='<% Eval("Url")) %>'>download</a> 
```

我将首先观察到，让 RowCommand 处理程序开始返回文件并不是这样做的方法。创建某种下载链接到不同的页面。从包含网格的页面的其余部分单独下载文件。

现在 ...

您已经掌握了正确的基础知识，但是就像[本 CodeProject 教程](http://www.codeproject.com/KB/aspnet/SecureFileDownload.aspx?msg=1094734#xx1094734xx)中的评论一样，您很快就会遇到问题。

> 上面的代码示例失败的地方：
> 
> *   不响应用户
> *   代码将继续运行，您将不知道用户是否实际下载了文件（对您而言可能无关紧要）
> *   不适用于所有浏览器
> *   无法恢复下载
> *   不显示进度
> *   较大的文件将使用更多的服务器内存并需要更长的时间进行流式传输
> *   大量下载将意味着服务器将受到资源冲击

而你可能想要..

> *   就像点击下载一样工作（即使用获取，而不是发布）
> *   以用户期望的方式在所有平台上的所有浏览器中工作（即文件名提示适用于 IE for Mac 或 Netscape 4.1）。
> *   显示下载进度
> *   可恢复下载
> *   跟踪所有下载并了解下载何时完成
> *   看起来像一个文件，即使它不是
> *   网址过期。
> *   允许任何大小的文件的高并发下载数

尽管用 VB .net1.1 编写的文章[在 ASP.NET [devx] 中跟踪和恢复大文件下载在](http://www.devx.com/dotnet/Article/22533/1954?pf=true)解释如何正确执行方面要好得多。

简单的代码很简单，但并不总是有效，并且 100% 的时间有效地将文件流式传输给用户比设置内容标题和在网络上挖掘一些位需要更多的努力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T21:01:58.687

首先，验证文件的内容实际上看起来像一个 zip 文件。您只需将文件放入记事本并查看内容即可。如果文件以 PK 和一些有趣的字符开头，它可能是一个 zip 文件。如果它包含 HTML，这可能是它出错的线索。

查看您的代码，让我感到震惊的是，您正在将文件的 url 传递给 Response.WriteFile。Response.WriteFile 是处理 url 还是使用本地文件名？也许 Response.WriteFile 之前的所有内容都可以正常工作，因此会发送正确的标头等，但随后代码会因异常而崩溃，这可能会使您的“zip 文件”包含 HTML 错误消息。

* * *

**编辑**：好的，第一个解决问题的步骤已完成。文件看起来像记事本中的 zip 文件，而不是 HTML 错误消息。

下一步，由于文件驻留在服务器上，请尝试将 url 直接写入文件，而不是通过您的应用程序。那样有用吗？

如果没有，请尝试不同的 zip 程序（顺便说一下，您使用的是哪一个？）。

例如，为什么您应该直接尝试文件和不同的解压缩程序。FinalBuilder 会生成 PowerArchiver 抱怨的 zip 文件，但 7zip 不会，因此文件或您的程序可能有问题，甚至两者都可能有问题。

但是验证文件是否正确，可以打开，如果您根本不下载它们，并检查如果您直接在应用程序之外下载它们会发生什么。

* * *

**编辑**：好的，您已验证即使您直接从服务器下载该文件也不会打开。

只在资源管理器中打开文件，完全绕过网络服务器怎么样？例如，由于看起来您在本地拥有该文件，请尝试导航到正确的文件夹并直接打开该文件。那样有用吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T21:46:38.193

这是更新的代码：

```
fileUrl = e.CommandArgument as String;
                string fileName = Path.GetFileName(fileUrl);

                FileStream fs = new FileStream(fileUrl, FileMode.Open);
                byte[] buffer = new byte[fs.Length];
                fs.Read(buffer, 0, (int) fs.Length);
                fs.Close(); 

                Response.Clear(); 
                Response.AppendHeader("content-disposition",
        "attachment; filename=" + fileName);
                Response.ContentType = "application/octet-stream";
                Response.AppendHeader("content-length", buffer.Length.ToString());

                Response.BinaryWrite(buffer); 
                Response.Flush(); 
                Response.End(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T22:22:52.627

这是提琴手的统计数据：

HTTP/1.1 200 OK 服务器：ASP.NET Development Server/8.0.0.0 日期：星期三，2008 年 12 月 17 日 22:22:05 GMT X-AspNet-版本：2.0.50727 内容处置：附件；文件名=MyZipFolder.zip 内容长度：148 缓存控制：私有内容类型：应用程序/x-zip 压缩连接：关闭

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-19T19:19:21.837

我刚刚用 .docx 文件尝试了相同的代码，结果相同（文件已损坏）： 这是代码：

```
if(e.CommandName.Equals("DownloadFile"))
            {
                fileUrl = e.CommandArgument as String;
                string fileName = Path.GetFileName(fileUrl);

                FileInfo info = new FileInfo(fileUrl);

                Response.Clear();
                Response.ClearContent();
                Response.ClearHeaders();
                Response.Buffer = true;

                Response.AppendHeader("Content-Length",info.Length.ToString());
                Response.ContentType = GetContentType(fileUrl);
                Response.AppendHeader("Content-Disposition:", "attachment; filename=" + fileName);
                Response.TransmitFile(fileUrl);
                Response.Flush(); 
                Response.End();
            } 
```

# c# - 从背后的子页面代码调用父页面代码背后的方法 - ASP.NET 2.0 页面继承模型

> ID：375977
> 
> 赞同：0
> 
> 时间：2008-12-17T20:49:30.337
> 
> 标签：c#, asp.net, web-site-project

从 ASP.NET 2.0 网站模型中的子页面的代码调用父页面的代码隐藏方法的最佳方法是什么？

**场景：**用户单击父页面中的链接以在子页面中查看数据记录的详细信息（父页面和子页面是分开的页面）。用户将修改客户端页面中的数据。子页面处理完更新后，子页面将关闭，我需要重新绑定父页面以反映更新。

我做了类似的事情，但它是从包含在父页面中的用户控件调用父页面

```
if(Page.GetType().ToString().Contains("ASP.Default_aspx"))
{
    MethodInfo MyMethod = this.Parent.TemplateControl.GetType().GetMethod("MyMethod");
    MyMethod.Invoke(this.Page, null);
    MyMethod = null;
} 
```

**更新：**我必须从后面的代码中执行此操作，因为子页面在数据更新后关闭。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T20:55:07.780

最简单的方法是使用多视图或类似的东西在一页上完成整个事情。

除此之外，您可以使用javascript调用

```
document.opener.location.href = "url"; 
```

更改父页面上的 url。您可以保持不变，或者在查询字符串中粘贴一些内容并在 Page_Load 上使用这些值

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T20:55:51.167

如果您在模式弹出窗口中打开子页面，您可以访问`window.returnValue`父页面（通过 JavaScript），然后调用页面刷新或 Ajaxy 重新绑定调用。

查看[此页面](http://microsoft.apress.com/asptodayarchive/71799/creating-a-pop-up-modal-dialog-box-for-a-login-page-and-redirecting-authenticated-users)以了解如何从模式弹出窗口返回值并根据父页面上的该值执行某些操作。

但是，如果您可以选择，我不会在单独的页面中打开编辑表单。我会将编辑表单放在用户控件中，并以 la lightbox 样式显示/隐藏它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-04T16:37:24.760

不确定这是否正是您想要的，但您可以为此使用跨页发布。这允许您从子页面回发到父页面，并具有访问子页面 ViewState 的优势。为此，您将按钮的 PostBackUrl 属性设置为子页面。然后，您可以在父页面中访问 PreviousPage 属性以从子页面检索值。所以在子页面中有一个按钮，例如：

```
<asp:Button ID="Button1" runat="server" Text="Update data" 
        PostBackUrl="~/Parent.aspx" onclick="Button1_Click" /> 
```

然后在 Parent.aspx Page_Load 事件中：

```
protected void Page_Load(object sender, EventArgs e) {

    if (IsCrossPagePostBack) {

        Page prevPage = this.PreviousPage;
        string myVal = prevPage.FindControl("myTextBox1").ToString();
        string myVal2 = prevPage.FindControl("myTextBox2").ToString();
        //etc

    }
} 
```

# sql-server - 将 Excel 电子表格列导入 SQL Server 数据库

> ID：375991
> 
> 赞同：64
> 
> 时间：2008-12-17T20:54:07.223
> 
> 标签：sql-server, excel, sql-server-2008, import, etl

我有一个 Excel 电子表格，我想将选择的列导入到我的 SQL Server 2008 数据库表中。向导没有提供该选项。

是否存在任何简单的代码选项？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2010-06-09T01:25:23.360

连接到 Sql Server 2005 数据库后，从对象资源管理器窗口中，右键单击要将表导入到的数据库。选择任务 -> 导入数据。这是一个简单的工具，允许您将传入的数据“映射”到适当的表中。您可以保存脚本以在需要时再次运行。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-17T21:02:42.977

[微软建议](http://support.microsoft.com/kb/321686)了几种方法：

*   SQL Server 数据转换服务 (DTS)
*   Microsoft SQL Server 2005 集成服务 (SSIS)
*   SQL Server 链接服务器
*   SQL Server 分布式查询
*   ActiveX 数据对象 (ADO) 和 SQL Server 的 Microsoft OLE DB 提供程序
*   Jet 4.0 的 ADO 和 Microsoft OLE DB 提供程序

如果向导（DTS）不起作用（我认为应该），您可以尝试类似[http://www.devasp.net/net/articles/display/771.html](http://www.devasp.net/net/articles/display/771.html)这基本上建议做类似的事情

```
INSERT INTO [tblTemp] ([Column1], [Column2], [Column3], [Column4])

SELECT A.[Column1], A.[Column2], A.[Column3], A.[Column4]
FROM OPENROWSET 
('Microsoft.Jet.OLEDB.4.0', 'Excel 8.0;Database=D:\Excel.xls;HDR=YES', 'select * from [Sheet1$]') AS A; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-22T02:41:34.907

这可能听起来很长，但您可能希望使用[Excel 生成 INSERT](http://tgrignon.wordpress.com/2007/03/07/using-excel-to-generate-inserts-for-sql-server/) SQL 代码，您可以将其粘贴到查询分析器中以创建表。

如果您无法使用向导，则效果很好，因为 excel 文件不在服务器上

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-17T21:03:20.637

您可以使用 OPENROWSET，例如：

> ```
> SELECT * FROM OPENROWSET('Microsoft.Jet.OLEDB.4.0', 
>   'Excel 8.0;IMEX=1;HDR=NO;DATABASE=C:\FILE.xls', 'Select * from [Sheet1$]' 
> ```

只需确保路径是服务器上的路径，而不是本地计算机上的路径。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-03T17:22:49.700

另一种选择是在 Excel 中使用 VBA，并编写一个宏来解析电子表格数据并将其写入 SQL。

一个例子在这里：[http ://www.ozgrid.com/forum/showthread.php?t=26621&page=1](http://www.ozgrid.com/forum/showthread.php?t=26621&page=1)

```
Sub InsertARecord() 
Dim cnt As ADODB.Connection 
Dim rst As ADODB.Recordset 
Dim stCon As String, stSQL As String 
Set cnt = New ADODB.Connection 
Set rst = New ADODB.Recordset 

stCon = "Provider=MSDASQL.1;Persist Security Info=False;Data Source=JOEY" 
cnt.ConnectionString = stCon 
stSQL = "INSERT INTO MyTable (Price)" 
stSQL = stSQL & "VALUES (500)" 

cnt.Open 
rst.Open stSQL, cnt, adOpenStatic, adLockReadOnly, adCmdText 

If CBool(rst.State And adStateOpen) = True Then rst.Close 
Set rst = Nothing 
If CBool(cnt.State And adStateOpen) = True Then cnt.Close 
Set cnt = Nothing 

End Sub 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-06-14T10:35:07.693

```
go
sp_configure 'show advanced options',1  
reconfigure with override  
go  
sp_configure 'Ad Hoc Distributed Queries',1  
reconfigure with override  
go
SELECT * into temptable
FROM OPENROWSET('Microsoft.Jet.OLEDB.4.0',
                'Excel 8.0;Database=C:\Documents and Settings\abhisharma\Desktop\exl\ImportExcel2SQLServer\ImportExcel2SQLServer\example.xls;IMEX=1',
                'SELECT * FROM [Sheet1$]')

select * from temptable 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-17T21:09:41.323

通过“向导”，我假设您正在谈论“SQL Server 导入和导出向导”。（我也很新，所以我不明白大多数问题，更不用说大多数答案，但我想我明白了）。如果是这样，您不能获取电子表格或其副本，删除您不想导入的列，然后使用向导吗？

我总能找到用它做我需要的能力，而且我只在 SQL Server 2000 上（不确定其他版本有何不同）。

编辑：事实上我现在正在看它，我似乎能够选择我想要映射到现有表中的哪些行的列。在“选择源表和视图”屏幕上，我检查了我正在使用的数据表，选择“目标”，然后单击“编辑...”按钮。从那里您可以选择 Excel 列和表列以将其映射到。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-02-05T22:53:14.037

如果您想要一个带有桌面界面的可视化工具，包括验证......您可能会喜欢这个 Excel 工具。您还可以使用该工具创建多用户数据编辑任务，甚至将数据从任何来源粘贴到 SQL Server。

如何验证 Excel 电子表格并将其导入 SQL Server 数据库：

[http://leansoftware.net/en-us/help/excel-database-tasks/worked-examples/how-to-import-excel-spreadsheet-to-sql-server-data.aspx](http://leansoftware.net/en-us/help/excel-database-tasks/worked-examples/how-to-import-excel-spreadsheet-to-sql-server-data.aspx)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-02-12T19:40:41.933

Microsoft Access 是另一种选择。您可以在您的机器上本地拥有一个 Access 数据库，您可以将 Excel 电子表格导入（可用的向导）并[通过 ODBC 链接到 SQL Server 数据库表](http://office.microsoft.com/en-us/access/HA102004941033.aspx#2)。

然后，您可以在 access 中设计一个查询，将 Excel 电子表格中的数据附加到 SQL Server 表中。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-06-21T10:27:38.507

我用过的最好的工具是[http://tools.perceptus.ca/text-wiz.php?ops=7](http://tools.perceptus.ca/text-wiz.php?ops=7)你试过了吗？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-05-21T08:55:52.560

我想它会帮助你

访问[http://social.msdn.microsoft.com/Forums/en-US/sqlgetstarted/thread/78f8e980-0bb6-4a48-b1b1-5f65bca1d511](http://social.msdn.microsoft.com/Forums/en-US/sqlgetstarted/thread/78f8e980-0bb6-4a48-b1b1-5f65bca1d511)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-04-23T19:55:25.143

Excel + SQLCMD + Perl = [exceltomssqlinsert](http://code.google.com/p/exceltomssqlinsert/)

并且您可以使用 Excel 作为 MSSQL db 的前端...注意每个生成的 sql 插入文件开头的截断表...

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-17T21:01:07.300

导入向导确实提供了该选项。您可以使用该选项为要导入的数据编写自己的查询，也可以使用复制数据选项并使用“编辑映射”按钮忽略不想导入的列。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-03-08T20:55:45.023

我使用了 DTS（现在称为 SQL 服务器导入和导出向导）。我使用了本[教程](http://www.sql-server-performance.com/2008/how-to-import-data-from-excel-2007/1/)，即使在 Sql 2008 和 excel 2010 (14.0) 中对我也很有效

我希望这有帮助

-D

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-01-14T08:10:39.417

首先，尝试导入向导的 32 位版本。这显示了更多受支持的导入格式。

背景：一切都取决于您的 Office（运行时引擎）安装。

如果您没有安装 Office 2007 或更高版本，导入向导（32 位）仅允许您导入 Excel 97-2003 (.xls) 文件。

如果您安装了 Office 2010 和 geater（也有 64 位，不推荐），导入向导还支持 Excel 2007+ (.xlsx) 文件。

要了解运行时的概述，请参阅[“Microsoft.ACE.OLEDB.12.0”提供程序未在本地计算机上注册](https://stackoverflow.com/questions/6649363/microsoft-ace-oledb-12-0-provider-is-not-registered-on-the-local-machine/32247214#32247214)

# asp.net - 类型“System.Web.UI.WebControls.SessionParameter”没有名为“DbType”的公共属性

> ID：375992
> 
> 赞同：0
> 
> 时间：2008-12-17T20:54:25.317
> 
> 标签：asp.net

我读到这个： [链接文本](https://stackoverflow.com/questions/184254/type-systemwebuiwebcontrolssessionparameter-does-not-have-a-public-property-nam)

我的开发盒，一切运行良好。在生产服务器上，他们安装了 V3.5 框架，我到了我的站点，我得到了这个错误。

我必须做些什么才能让它读取 V3.5 程序集吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T21:04:39.150

不久前我有类似的事情，与我的开发盒上的 SP1 和生产上的香草 3.5 有关

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-18T02:13:54.707

马特，原来我和你有同样的问题。开发盒上的 Sp1 和生产服务器上的香草版本

# c# - 比较两个对象的内容是否相等

> ID：375996
> 
> 赞同：20
> 
> 时间：2008-12-17T20:55:16.783
> 
> 标签：c#

我有两个相同类型的复杂对象（即具有字符串、整数、双精度、列表和其他自制数据类型的对象）。我想比较它们两者的内容以确保它们是相同的。注意：该对象没有实现 .Equals（我无法控制），也没有实现 IComparable。

是否有一种通用的方法（反射？）来比较两个对象的内容？

谢谢！

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-09-18T11:54:43.667

我创建了一个类来对 .NET 对象进行深入比较。看：

[https://github.com/GregFinzer/Compare-Net-Objects](https://github.com/GregFinzer/Compare-Net-Objects)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-09-25T05:54:50.037

我的工作解决方案。！

```
private bool Compare(object obj1, object obj2)
{
    if (obj1 == null || obj2 == null)
    {
        return false;
    }
    if (!obj1.GetType().Equals(obj2.GetType()))
    {
        return false;
    }

    Type type = obj1.GetType();
    if (type.IsPrimitive || typeof(string).Equals(type))
    {
        return obj1.Equals(obj2);
    }
    if (type.IsArray)
    {
        Array first = obj1 as Array;
        Array second = obj2 as Array;
        var en = first.GetEnumerator();
        int i = 0;
        while (en.MoveNext())
        {
            if (!Compare(en.Current, second.GetValue(i)))
                return false;
            i++;
        }
    }
    else
    {
        foreach (PropertyInfo pi in type.GetProperties(BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Public))
        {
            var val = pi.GetValue(obj1);
            var tval = pi.GetValue(obj2);
            if (!Compare(val, tval))
                return false;
        }
        foreach (FieldInfo fi in type.GetFields(BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Public))
        {
            var val = fi.GetValue(obj1);
            var tval = fi.GetValue(obj2);
            if (!Compare(val, tval))
                return false;
        }
    }
    return true;
} 
```

希望能帮助到你。！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-01-18T03:31:20.740

我刚刚写了我的版本。该函数使用泛型和反射。它通过递归自身来工作，直到对象中的所有事物都已经比较或找到不相等的事物。

```
public class Utils
{
    public bool CompareObjects<T>(T expectInput, T actualInput)
    {
        // If T is primitive type.
        if (typeof(T).IsPrimitive)
        {
            if (expectInput.Equals(actualInput))
            {
                return true;
            }

            return false;
        }

        if (expectInput is IEquatable<T>)
        {
            if (expectInput.Equals(actualInput))
            {
                return true;
            }

            return false;
        }

        if (expectInput is IComparable)
        {
            if (((IComparable)expectInput).CompareTo(actualInput) == 0)
            {
                return true;
            }

            return false;
        }

        // If T is implement IEnumerable.
        if (expectInput is IEnumerable)
        {
            var expectEnumerator = ((IEnumerable)expectInput).GetEnumerator();
            var actualEnumerator = ((IEnumerable)actualInput).GetEnumerator();

            var canGetExpectMember = expectEnumerator.MoveNext();
            var canGetActualMember = actualEnumerator.MoveNext();

            while (canGetExpectMember && canGetActualMember && true)
            {
                var currentType = expectEnumerator.Current.GetType();
                object isEqual = typeof(Utils).GetMethod("CompareObjects").MakeGenericMethod(currentType).Invoke(null, new object[] { expectEnumerator.Current, actualEnumerator.Current });

                if ((bool)isEqual == false)
                {
                    return false;
                }

                canGetExpectMember = expectEnumerator.MoveNext();
                canGetActualMember = actualEnumerator.MoveNext();
            }

            if (canGetExpectMember != canGetActualMember)
            {
                return false;
            }

            return true;
        }

        // If T is class.
        var properties = typeof(T).GetProperties();
        foreach (var property in properties)
        {
            var expectValue = typeof(T).GetProperty(property.Name).GetValue(expectInput);
            var actualValue = typeof(T).GetProperty(property.Name).GetValue(actualInput);

            if (expectValue == null || actualValue == null)
            {
                if (expectValue == null && actualValue == null)
                {
                    continue;
                }

                return false;
            }

            object isEqual = typeof(Utils).GetMethod("CompareObjects").MakeGenericMethod(property.PropertyType).Invoke(null, new object[] { expectValue, actualValue });

            if ((bool)isEqual == false)
            {
                return false;
            }
        }

        return true;
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T20:59:29.113

> > *有没有一种通用的方法来比较两个对象的内容？*

是的，但通常这被称为 IComparable 接口。

如果您可以从班级下降并创建一个实现 IComparable 的孩子，那可能是理想的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-17T21:00:16.897

反射就是它，但问题是包含的类型 - 例如，您不能只使用`Equals`or `EqualityComparer<T>`，因为如果子数据是 a等，*也*不会方便地进行比较。`List<T>`

您需要多久执行一次？你能序列化它们并比较序列化的值吗？这可能是最稳健的选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-06-10T22:29:37.930

GetHashcode 对我有用。

我在每个类中用所有公共相关属性 X-OR-ed 覆盖 GetHashcode()，例如

```
override GetHashCode()
{
   return A.GetHashCode() ^ B.GetHashCode ^ C.SafeString().Get..
} 
```

我遍历所有类，再次对这些值进行 X-OR。IsModified 将先前的 HashValue 与当前进行比较。两个不同的对象确实*可以*返回相同的 HashValue，有 1 到 40 亿的机会，但对于许多目的，这对我来说已经足够了。

但我有一个更好的主意，使用 MemoryStream

这是一个扩展：

```
public static bool IsBinaryEqualTo(this object obj, object obj1)
{
    using (MemoryStream memStream = new MemoryStream())
    {
        if (obj == null || obj1 == null)
        {
            if (obj == null && obj1 == null)
                return true;
            else
                return false;
        }

        BinaryFormatter binaryFormatter = new BinaryFormatter(null, new StreamingContext(StreamingContextStates.Clone));
        binaryFormatter.Serialize(memStream, obj);
        byte[] b1 = memStream.ToArray();
        memStream.SetLength(0);

        binaryFormatter.Serialize(memStream, obj1);
        byte[] b2 = memStream.ToArray();

        if (b1.Length != b2.Length)
            return false;

        for (int i = 0; i < b1.Length; i++)
        {
            if (b1[i] != b2[i])
                return false;
        }

        return true;
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-10-23T13:02:16.187

将对象序列化为 XML 字符串，您最终可以在被序列化的 2 个对象之间进行字符串比较...

```
private string Serialize<T>(T value)
        {
            if (value == null)
            {
                return string.Empty;
            }
            try
            {
                XmlSerializer xmlserializer = new XmlSerializer(typeof(T));
                StringWriter stringWriter = new StringWriter();
                XmlWriter writer = XmlWriter.Create(stringWriter);
                xmlserializer.Serialize(writer, value);
                string serializeXml = stringWriter.ToString();
                writer.Close();               
                return serializeXml;
            }
            catch (Exception ex)
            {
                return string.Empty;
            }
        }
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-01-13T14:02:27.267

对于我的上一个项目，我对一些功能进行了很好的深度比较。

```
 public class ObjektHelper
    {

        /// <summary>
        /// Compairs two Objects and gives back true if they are equal
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="obj1">Object 1</param>
        /// <param name="obj2">Object 2</param>
        /// <param name="consideredFieldNames">If the list is not mepty, only the field within equal names are compaired.</param>
        /// <param name="notConsideredFieldNames">If you want not compair some fields enter their name in this list.</param>
        /// <returns></returns>
        public static bool DeepCompare<T>(T obj1, T obj2, string[] consideredFieldNames, params string[] notConsideredFieldNames)
        {
            var errorList = new List<object>();
            if (notConsideredFieldNames == null) notConsideredFieldNames = new[] {""};
            DeepCompare(obj1, obj2, errorList, consideredFieldNames, notConsideredFieldNames, false);
            return errorList.Count <= 0;
        }

        /// <summary>
        /// Compairs two Objects and gives an error list back.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="obj1"></param>
        /// <param name="obj2"></param>
        /// <param name="errorList">The error list gives back the names of the fields that are not equal.</param>
        /// <param name="consideredFieldNames">If the list is not mepty, only the field within equal names are compaired.</param>
        /// <param name="notConsideredFieldNames">If you want not compair some fields enter their name in this list.</param>
        /// <param name="endWithErrors">If the value is false, the method end at the first error.</param>
        public static void DeepCompare<T>(T obj1, T obj2, List<object> errorList, string[] consideredFieldNames, string[] notConsideredFieldNames, bool endWithErrors)
        {
            if (errorList == null) throw new Exception("errorListliste ist NULL");

            if (Equals(obj1, default(T)) && Equals(obj2, default(T))) return;
            if (Equals(obj1, default(T)) || Equals(obj2, default(T)))
            {
                errorList.Add("One of the object are null!");
                return;
            }
            if (!endWithErrors && errorList != null && errorList.Count > 0) throw new Exception("ErrorListliste is not empty");
            var type1 = obj1.GetType();
            var type2 = obj2.GetType();
            var propertyInfos1 = type1.GetProperties();
            var propertyInfos2 = type2.GetProperties();
            // To use the access via index, the list have to be ordered!
            var propertyInfoOrdered1 = propertyInfos1.OrderBy(p => p.Name).ToArray();
            var propertyInfoOrdered2 = propertyInfos2.OrderBy(p => p.Name).ToArray();

            if (type1 != type2) errorList.AddRange(new List<object> {type1, type2});
            else
            {
                for (var i = 0; i < propertyInfos1.Length; i++)
                {
                    var t1 = propertyInfoOrdered1[i].PropertyType;
                    var t2 = propertyInfoOrdered2[i].PropertyType;
                    if (t1 != t2)
                    {
                        errorList.AddRange(new List<object> {type1, type2});
                        continue;
                    }

                    var name1 = propertyInfoOrdered1[i].Name;
                    var name2 = propertyInfoOrdered2[i].Name;

                    // Use the next 4 lines to find a bug
                    //if (name1 == "Enter name of field with the bug")
                    //    Console.WriteLine(name1);
                    //if (name2 == "Enter name of field1 with the bug" || name2 == "Enter name of field2 with the bug")
                    //    Console.WriteLine(name2);

                    if (consideredFieldNames != null && !consideredFieldNames.Contains(name1)) continue;
                    if (notConsideredFieldNames != null && notConsideredFieldNames.Contains(name1)) continue;

                    var value1 = propertyInfoOrdered1[i].GetValue(obj1, null);
                    var value2 = propertyInfoOrdered2[i].GetValue(obj2, null);

                    // check Attributes
                    var guiName1 = (propertyInfoOrdered1[i].GetCustomAttributes().FirstOrDefault(a => a.GetType() == typeof(GuiNameofModelAttribute)) as GuiNameofModelAttribute)?.GuiName;
                    var guiName2 = (propertyInfoOrdered2[i].GetCustomAttributes().FirstOrDefault(a => a.GetType() == typeof(GuiNameofModelAttribute)) as GuiNameofModelAttribute)?.GuiName;
                    // create errorListrange
                    var temperrorListRange = new List<object>();
                    if (guiName1 != null && guiName2 != null) temperrorListRange.AddRange(new List<object> { guiName1, guiName2 });
                    else temperrorListRange.AddRange(new List<object> { propertyInfoOrdered1[i], propertyInfoOrdered2[i] });

                    // both fields are null = OK
                    if ((value1 == null && value2 == null) || (value1 is Guid && value2 is Guid)) continue;
                    // one of the fields is null = errorList
                    if (value1 == null || value2 == null) errorList.AddRange(temperrorListRange);
                    // Value types, Enum and String compair
                    else if (t1.BaseType == typeof (ValueType) || t1.BaseType == typeof (Enum) || t1 == typeof (string))
                    {
                        if (!value1.Equals(value2)) errorList.AddRange(temperrorListRange);
                    }
                    // List, array, generic lists, collection and bindinglist compair    
                    else if (t1 == typeof (Array) || (t1.IsGenericType && (t1.GetGenericTypeDefinition() == typeof (List<>) ||
                                                                           t1.GetGenericTypeDefinition() == typeof (IList<>) ||
                                                                           t1.GetGenericTypeDefinition() == typeof (Collection<>) ||
                                                                           t1.GetGenericTypeDefinition() == typeof (ICollection<>) ||
                                                                           t1.GetGenericTypeDefinition() == typeof (ObservableCollection<>) ||
                                                                           t1.GetGenericTypeDefinition() == typeof (BindingList<>) ||
                                                                           t1.GetGenericTypeDefinition() == typeof (BindingList<>)
                        )))
                        DeepListCompare(value1 as IEnumerable<object>, value2 as IEnumerable<object>, errorList, consideredFieldNames, notConsideredFieldNames, endWithErrors);

                    // Clas compair
                    else if (t1.IsClass || t1.IsAnsiClass) DeepCompare(value1, value2, errorList, consideredFieldNames, notConsideredFieldNames, endWithErrors);
                    else throw new NotImplementedException();

                    if (!endWithErrors && errorList.Count > 0) break;
                }

            }

        } // End DeepCompare<T>

        /// <summary>
        /// Compairs two lists and gives back true if they are equal.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="tlist1">Generic list 1</param>
        /// <param name="tlist2">Generic List 2</param>
        /// <returns></returns>
        public static bool DeepListCompare<T>(T tlist1, T tlist2)
        {
            var errorList = new List<object>();
            DeepCompare(tlist1, tlist2, errorList, null, null, false);
            return errorList.Count <= 0;
        }

        /// <summary>
        /// Compairs two lists and gives backthe error list.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="tlist1">Generic list 1</param>
        /// <param name="tlist2">Generic list 2</param>
        /// <param name="errorList">The error list gives back the names of the fields that are not equal.</param>
        /// <param name="consideredFieldNames">If the list is not mepty, only the field within equal names are compaired.</param>
        /// <param name="notConsideredFieldNames">If you want not compair some fields enter their name in this list.</param>
        /// <param name="endWithErrors">If the value is false, the method end at the first error.</param>
        public static void DeepListCompare<T>(T tlist1, T tlist2, List<object> errorList, string[] consideredFieldNames, string[] notConsideredFieldNames, bool endWithErrors)
            where T : IEnumerable<object>
        {
            if (errorList == null) throw new Exception("errorListliste ist NULL");

            if (!endWithErrors && errorList.Count > 0) throw new Exception("errorListliste ist nicht Leer");
            if (Equals(tlist1, null) || Equals(tlist2, null))
            {
                errorList.AddRange(new List<object> {tlist1, tlist2});
                return;
            }
            var type1 = tlist1.GetType();
            var type2 = tlist2.GetType();
            var propertyInfos1 = type1.GetProperties();
            var propertyInfos2 = type2.GetProperties();

            // To use the access via index, the list have to be ordered!
            var propertyInfoOrdered1 = propertyInfos1.OrderBy(p => p.Name).ToArray();
            var propertyInfoOrdered2 = propertyInfos2.OrderBy(p => p.Name).ToArray();

            for (var i = 0; i < propertyInfos1.Length; i++)
            {
                var t1 = propertyInfoOrdered1[i].PropertyType;
                var t2 = propertyInfoOrdered2[i].PropertyType;

                if (t1 != t2) errorList.AddRange(new List<object> {t1, t2});
                else
                {
                    // Kick out index
                    if (propertyInfoOrdered1[i].GetIndexParameters().Length != 0)
                    {
                        continue;
                    }

                    // Get value
                    var value1 = propertyInfoOrdered1[i].GetValue(tlist1, null) as IEnumerable<object>;
                    var value2 = propertyInfoOrdered2[i].GetValue(tlist2, null) as IEnumerable<object>;

                    if (value1 == null || value2 == null) continue;

                    // Only run through real lists.
                    if (t1 == typeof (Array) ||
                        t1.IsGenericType && t1.GetGenericTypeDefinition() == typeof (List<>) ||
                        t1.IsGenericType && t1.GetGenericTypeDefinition() == typeof (Collection<>))
                    {
                        // cast 
                        var objectList1 = value1.ToList();
                        var objectList2 = value2.ToList();
                        if (objectList1.Count == 0 && objectList1.Count == 0)
                        {
                            //errorList.AddRange(new List<Object> { objectList1, objectList1 });
                            continue;
                        }

                        foreach (var item1 in objectList1)
                        {
                            foreach (var item2 in objectList2)
                            {
                                var temperrorListCount = errorList.Count;
                                DeepCompare(item1, item2, errorList, consideredFieldNames, notConsideredFieldNames, endWithErrors);
                                if (temperrorListCount != errorList.Count) continue;

                                objectList2.Remove(item2);
                                break;
                            }
                            if (!endWithErrors && errorList.Count > 0) break;
                        }
                    }
                    else DeepCompare(value1, value2, errorList, consideredFieldNames, notConsideredFieldNames, endWithErrors);
                }
                if (!endWithErrors && errorList.Count > 0) break;
            }

        } // End DeepListCompare<T>

    } // end class ObjectHelper

    [AttributeUsage(AttributeTargets.All)]
    public class GuiNameofModelAttribute : Attribute
    {
        public readonly string GuiName;

        public GuiNameofModelAttribute(string guiName)
        {
            GuiName = guiName;
        }
    } 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-10-21T05:07:59.790

我发现的最快和最简单的方法是使用[MessagePack](https://github.com/neuecc/MessagePack-CSharp/)序列化两个对象，然后比较字节数组。

```
public static bool DeepEquals(object o1, object o2)
{
    var b1 = MessagePackSerializer.Serialize(o1, ContractlessStandardResolver.Instance);
    var b2 = MessagePackSerializer.Serialize(o2, ContractlessStandardResolver.Instance);
    return b1.SequenceEqual(b2);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-17T20:59:41.533

您可以简单地在另一个类中编写一个实用方法来进行比较。但是，这是假设所讨论的类的属性是可公开访问的。他们是吗？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-05-08T15:50:14.883

感谢您的 MemoryStream 方法，Marc。当我在参数中看到“this”时，我认为肯定有一个错误，但令人惊讶的是编译器实际上允许你这样做，对吧？我做了一点改动，然后选择覆盖到 Equals() 。还感谢使用长度和数组比较而不是 SequenceEquals()。需要多花一分钟的时间来编写，但根据[http://www.dotnetperls.com/sequenceequal](http://www.dotnetperls.com/sequenceequal)，性能要好得多。

```
public override bool Equals(object obj)
{
    // If comparison object is null or is a different type, no further comparisons are necessary...
    if (obj == null || GetType() != obj.GetType())
    {
        return false;
    }

    // Compare objects using byte arrays...
    using (MemoryStream memStream = new MemoryStream())
    {
        BinaryFormatter binaryFormatter = new BinaryFormatter(null, new StreamingContext(StreamingContextStates.Clone));

        // Get byte array of "this" object...
        binaryFormatter.Serialize(memStream, this);
        byte[] b1 = memStream.ToArray();

        // Get byte array of object to be compared...
        memStream.SetLength(0);
        binaryFormatter.Serialize(memStream, obj);
        byte[] b2 = memStream.ToArray();

        // Compare array sizes. If equal, no further comparisons are necessary...
        if (b1.Length != b2.Length)
            return false;

        // If sizes are equal, compare each byte while inequality is not found...
        for (int i = 0; i < b1.Length; i++)
        {
            if (b1[i] != b2[i])
                return false;
        }
    }

    return true;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-17T21:01:06.663

好吧，您可以编写一些逻辑来比较两个对象的所有属性。当它是具有复杂子类型的对象图时，这会变得复杂，因此您需要确定多接近才足够好。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-17T21:04:00.620

您将需要其他方法的比较方法；在 C++ 中，您可以只编写一个全局函数，但我认为 c# 不允许这样做，就像 Java 不允许那样。

我要做的是编写一个实现 iComparable 的类，并有一个 ctor 接受您所需类的对象，并包含您的 Equals 函数。将其设置为保留对原始对象的引用，以保存分配错误。
然后你可以写

Foo(A).Equals(新的 Foo(B))

您可以改为从提供的类继承，但这意味着需要创建和跟踪这些东西。**