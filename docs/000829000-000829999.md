# StackOverflow 问答 000829000-000829999

# asp.net - 如何访问 ASP.NET Repeaters ItemDataBound 事件中的数据源字段？

> ID：829002
> 
> 赞同：24
> 
> 时间：2009-05-06T10:31:22.923
> 
> 标签：asp.net, repeater, itemdatabound

我有一个Repeater 控件，它绑定到Linq 查询的结果。

我想在 ItemDataBound 事件中获取数据源字段之一的值，但我不确定如何执行此操作。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2010-02-19T13:34:48.960

取决于 DataSource... 如果您的 DataSource 是 DataTable，那么您的 DataItem 包含一个 DataRowView：

```
protected void rptMyReteater_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
    if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
    {
        Button b = e.Item.FindControl("myButton") as Button; 
        DataRowView drv = e.Item.DataItem as DataRowView;
        b.CommandArgument = drv.Row["ID_COLUMN_NAME"].ToString();
    }
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-05-06T10:35:18.717

您可以使用：`e.Item.DataItem`.

示例：[Repeater.ItemDataBound 事件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.repeater.itemdatabound.aspx)

```
// This event is raised for the header, the footer, separators, and items.
void R1_ItemDataBound(Object Sender, RepeaterItemEventArgs e)
{
  // Execute the following logic for Items and Alternating Items.
  if (e.Item.ItemType == ListItemType.Item ||
      e.Item.ItemType == ListItemType.AlternatingItem)
  {
    if (((Evaluation)e.Item.DataItem).Rating == "Good")
    {
      ((Label)e.Item.FindControl("RatingLabel")).Text= "<b>***Good***</b>";
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-06T10:37:53.797

用于当前项目的数据可以从 EventArgs 中找到。

```
RepeaterItemEventArgs e

e.Item.DataItem 
```

# delphi - 找出哪个进程注册了全局热键？（Windows API）

> ID：829007
> 
> 赞同：132
> 
> 时间：2009-05-06T10:32:49.253
> 
> 标签：delphi, winapi, hotkeys, registerhotkey

据我所知，Windows 没有提供 API 函数来判断哪个应用程序注册了全局热键（通过 RegisterHotkey）。如果RegisterHotkey返回false，我只能发现一个热键被注册，而不是谁“拥有”热键。

在没有直接API的情况下，能有迂回的方式吗？Windows 维护与每个注册的热键关联的句柄——这有点让人抓狂，应该没有办法获得这些信息。

可能不起作用的示例：发送（模拟）注册的热键，然后拦截 Windows 将发送给注册它的进程的热键消息。首先，我认为拦截消息不会泄露目标窗口句柄。其次，即使有可能，这样做也是一件坏事，因为发送热键会触发各种程序的各种潜在有害活动。

这并不重要，但我经常看到对此类功能的请求，并且我自己也是注册热键的应用程序的受害者，甚至没有在 UI 或文档的任何地方公开它。

（在Delphi工作，只是WinAPI的学徒，请善待。）

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2017-04-26T21:46:24.010

一种可能的方法是使用[**Visual Studio 工具 Spy++**](https://msdn.microsoft.com/en-us/library/aa264396(v=vs.60).aspx)。

试试这个：

1.  运行工具（对我来说，它位于`C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\Tools\spyxx_amd64.exe`）
2.  在菜单栏中，选择*Spy* -> *Log messages...*（或点击`Ctrl`+ `M`）
3.  *在附加窗口*框架中检查*系统*中的所有窗口
**   切换到*消息*选项卡*   单击*全部清除*按钮*   在列表框中选择`WM_HOTKEY`，或选中*消息组*中的*键盘*（如果您对更多潜在噪音感到满意）**   单击*确定*按钮*   按有问题的热键（例如`Win`+ `R`）*   选择*Messages (All Windows)*`WM_HOTKEY`窗口中的行，右键单击，然后在上下文菜单中选择*Properties...****   在“*消息属性*”对话框中，单击“*窗口句柄*”链接（这将是接收消息的窗口的句柄）*   单击*窗口属性*对话框上的*同步*按钮。这将在主 Spy++ 窗口树视图中显示该窗口。**   在“*窗口属性*”对话框中，选择“*进程*”选项卡*   单击*进程 ID*链接。这将向您展示该过程（在我的`Win`+`R`案例中`EXPLORER`：）*****

 *** * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-20T09:43:13.683

你的问题引起了我的兴趣，所以我做了一些挖掘，不幸的是，我没有给你正确的答案，我想我会分享我所拥有的。

我发现这个在 1998 年编写[的创建键盘钩子（在 Delphi 中）的示例，但在 Delphi 2007 中可以通过一些调整进行编译。](http://groups.google.com/group/borland.public.delphi.winapi/msg/ceb5818acd623a24)

这是一个`SetWindowsHookEx`通过回调函数调用的 DLL，然后该回调函数可以拦截击键：在这种情况下，它正在修改它们以获得乐趣，将左光标更改为右光标等。然后一个简单的应用程序调用 DLL 并返回报告它的结果基于 TTimer 事件。如果您有兴趣，我可以发布基于 Delphi 2007 的代码。

它有详细的文档和评论，您可能可以将其用作计算按键位置的基础。如果您可以获取发送击键的应用程序的句柄，您可以通过这种方式进行追踪。有了这个句柄，您就可以很容易地获得所需的信息。

其他应用程序已尝试通过查看其快捷方式来确定热键，因为它们可以包含快捷键，这只是热键的另一个术语。然而，大多数应用程序并不倾向于设置此属性，因此它可能不会返回太多。如果您对该路线感兴趣，Delphi 可以访问`IShellLink`COM 接口，您可以使用该接口加载快捷方式并获取其热键：

```
uses ShlObj, ComObj, ShellAPI, ActiveX, CommCtrl;

procedure GetShellLinkHotKey;
var
  LinkFile : WideString;
  SL: IShellLink;
  PF: IPersistFile;

  HotKey : Word;
  HotKeyMod: Byte;
  HotKeyText : string;
begin
  LinkFile := 'C:\Temp\Temp.lnk';

  OleCheck(CoCreateInstance(CLSID_ShellLink, nil, CLSCTX_INPROC_SERVER, IShellLink, SL));

  // The IShellLink implementer must also support the IPersistFile
  // interface. Get an interface pointer to it.
  PF := SL as IPersistFile;

  // Load file into IPersistFile object
  OleCheck(PF.Load(PWideChar(LinkFile), STGM_READ));

  // Resolve the link by calling the Resolve interface function.
  OleCheck(SL.Resolve(0, SLR_ANY_MATCH or SLR_NO_UI));

  // Get hotkey info
  OleCheck(SL.GetHotKey(HotKey));

  // Extract the HotKey and Modifier properties.
  HotKeyText := '';
  HotKeyMod := Hi(HotKey);

  if (HotKeyMod and HOTKEYF_ALT) = HOTKEYF_ALT then
    HotKeyText := 'ALT+';
  if (HotKeyMod and HOTKEYF_CONTROL) = HOTKEYF_CONTROL then
    HotKeyText := HotKeyText + 'CTRL+';
  if (HotKeyMod and HOTKEYF_SHIFT) = HOTKEYF_SHIFT then
    HotKeyText := HotKeyText + 'SHIFT+';
  if (HotKeyMod and HOTKEYF_EXT) = HOTKEYF_EXT then
    HotKeyText := HotKeyText + 'Extended+';

  HotKeyText := HotKeyText + Char(Lo(HotKey));

  if (HotKeyText = '') or (HotKeyText = #0) then
    HotKeyText := 'None';

  ShowMessage('Shortcut Key - ' + HotKeyText);
end; 
```

如果您可以访问[Safari 联机丛书](http://my.safaribooksonline.com/)，那么在 Steve Teixeira 和 Xavier Pacheco 编写的 Borland Delphi 6 开发人员指南中有一个[关于使用快捷方式/shell 链接的好部分。](http://my.safaribooksonline.com/0672321157/ch16lev1sec3)我上面的例子是来自那里和[这个网站](http://delphicikk.atw.hu/listaz.php?id=2351&oldal=1)的屠宰版本。

希望有帮助！

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-10T22:09:31.393

经过一番研究，您似乎需要访问 MS 用来存储热键的内部结构。ReactOS 有一个洁净室实现，它`GetHotKey`通过迭代内部列表并提取与调用的参数匹配的热键来实现调用。

根据 ReactOS 的实现与 MS 实现的接近程度，您可能能够在内存中四处寻找结构，但这超出了我的想象......

```
BOOL FASTCALL
GetHotKey (UINT fsModifiers,
           UINT vk,
           struct _ETHREAD **Thread,
           HWND *hWnd,
           int *id)
{
   PHOT_KEY_ITEM HotKeyItem;

   LIST_FOR_EACH(HotKeyItem, &gHotkeyList, HOT_KEY_ITEM, ListEntry)
   {
      if (HotKeyItem->fsModifiers == fsModifiers &&
            HotKeyItem->vk == vk)
      {
         if (Thread != NULL)
            *Thread = HotKeyItem->Thread;

         if (hWnd != NULL)
            *hWnd = HotKeyItem->hWnd;

         if (id != NULL)
            *id = HotKeyItem->id;

         return TRUE;
      }
   }

   return FALSE;
} 
```

我认为[sysinternals 上的这个线程](http://forum.sysinternals.com/forum_posts.asp?TID=18909)是由与这个问题相关的人提出的，但我想我还是会链接到它以将两者保持在一起。该线程看起来非常有趣，但我怀疑在不访问 MS 内部的情况下需要进行一些深入的探索才能弄清楚这一点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-19T01:46:53.087

在我的脑海中，您可能会尝试使用 EnumWindows 枚举所有窗口，然后在回调中，将 WM_GETHOTKEY 发送到每个窗口。

编辑：显然我错了。[MSDN](http://msdn.microsoft.com/en-us/library/ms646279(VS.85).aspx)有更多信息：

> WM_HOTKEY 与 WM_GETHOTKEY 和 WM_SETHOTKEY 热键无关。WM_HOTKEY 消息针对通用热键发送，而 WM_SETHOTKEY 和 WM_GETHOTKEY 消息与窗口激活热键相关。

注意：[这](http://tds.diamondcs.com.au/dse/detection/hotkeys.php)是一个声称具有您正在寻找的功能的程序。你可以试试反编译。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T13:58:07.957

另一个线程提到了一个全局 NT 级键盘钩子：

[重新分配/覆盖热键 (Win + L) 以锁定窗口](https://stackoverflow.com/questions/301053/re-assign-override-hotkey-win-l-to-lock-windows)

也许您可以通过这种方式获取调用钩子的进程的句柄，然后您可以将其解析为进程名称

（免责声明：我把它放在我的书签里，还没有真正尝试过/测试过）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T19:28:25.150

我知道您可以在您自己的进程中的任何窗口中截取消息流——我们过去在 VB6 中称为子类化。（虽然我不记得该功能，也许是 SetWindowLong？）我不确定您是否可以为自己进程之外的窗口执行此操作。但是为了这篇文章的缘故，让我们假设你找到了一种方法来做到这一点。然后您可以简单地拦截所有顶级窗口的消息，监视 WM_HOTKEY 消息。你不可能马上知道所有的键，但是当它们被按下时，你可以很容易地找出哪个应用程序正在使用它们。如果您将结果保存到磁盘并在每次运行监视器应用程序时重新加载，您可以随着时间的推移提高应用程序的性能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-27T17:56:11.800

这并不能完全回答关于 Windows API 的部分问题，但它回答了关于全局热键列表和“拥有”它们的应用程序的部分问题。

[http://hkcmdr.anymania.com/](http://hkcmdr.anymania.com/)上的免费热键资源管理器显示了所有全局热键和拥有它们的应用程序的列表。这只是帮助我在几秒钟内弄清楚为什么特定于应用程序的快捷键停止工作以及如何修复它（通过在注册它的应用程序中重新配置注册的全局热键）。

# asp.net - 如何在 button_click 中找到 GridView 项目？

> ID：829023
> 
> 赞同：0
> 
> 时间：2009-05-06T10:38:05.777
> 
> 标签：asp.net, gridview

我正在使用以下代码：

```
foreach (GridViewRow dr in gvrejectreq.Rows)
{
    DropDownList ddl=(DropDownList)gvrejectreq.Rows[dr.RowIndex].FindControl("DropDownList1");
    string status = ddl.SelectedValue;
    int userid = gvrejectreq.Rows[dr.RowIndex].
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T13:55:33.930

如果我明白你在问什么......你不需要循环......

```
protected void GridView1_RowCommand(Object sender, GridViewCommandEventArgs e){
   if (e.CommandName == "thiscommandname") {
      int index = Convert.ToInt32(e.CommandArgument);
      GridViewRow selectedRow = ((GridView)e.CommandSource).Rows[index];
      //and then for example...
      string rowText = (LinkButton)selectedRow.Cells[0].Controls[0]).Text;}
} 
```

# php - 我遇到过这种语法： var == "" ？“-”：变量。有人可以解释一下吗？

> ID：829033
> 
> 赞同：3
> 
> 时间：2009-05-06T10:41:57.157
> 
> 标签：php, syntax

代码是这样的：

```
$vendors[] = array(
    "id" => $row['vendorID'],
    "name" => $row['name'] == "" ? "-" : $row['name'],
    "tel1" => $row['phone1'] == "" ? "-" : $row['phone1'],
    "tel2" => $row['phone2'] == "" ? "-" : $row['phone2'],
    "mail" => $row['email'] == "" ? "-" : $row['email'],
    "web" => $row['web'] == "" ? "-" : $row['web']); 
```

有人可以准确地解释一下它是什么吗？看起来像[替代语法](http://ca3.php.net/manual/en/control-structures.alternative-syntax.php)，但我没有设法找到信息。

谢谢

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-06T10:44:34.357

这是一个[三元运算符](http://ru2.php.net/ternary#language.operators.comparison.ternary)：

> 表达式的`(expr1) ? (expr2) : (expr3)`计算结果为`expr2`if`expr1`计算结果为`TRUE`，并且`expr3`if`expr1`计算结果为`FALSE`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T10:46:17.350

这意味着：如果值为“”（空），则设置为“-”（连字符），否则设置为任何值。

只需将 a?b:c 读为«if a then b else c»。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T11:29:43.237

是的，这是其他人所说的，但在代码可读性方面并不推荐。小心使用它，不要在没有括号的情况下使用它。

```
$myvar = ($condition == TRUE) ? $valueIfTrue : $valueIfFalse; 
```

代替

```
if ($condition)
{
    $myvar = $valueIfTrue;
}
else
{
    $myvar = $valueIfFalse;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T10:45:30.347

这就是 PHP 坚持称为“三元运算符”的原因 - 请参阅[http://www.phpbuilder.com/manual/language.operators.comparison.php](http://www.phpbuilder.com/manual/language.operators.comparison.php)以了解语法和示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T13:50:55.627

你也可以这样做`"name" => $row['name'] == "" ?? "-"`

即 a == b ?? c 所以如果 a=b 为真，则使用 a 否则使用 c

# apache-flex - 减少flex柱形图中列之间的空间

> ID：829035
> 
> 赞同：0
> 
> 时间：2009-05-06T10:43:46.450
> 
> 标签：apache-flex, flex3

在flex中如何减少柱状图中列之间的空间。我的columnWidth Ratio是0.4而不改变这个比率如何减少列之间的空间？

谢谢， AravuindakumarThangaraju

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T11:05:57.210

你的意思是 paddingLeft 和 paddingRight 吗？

# c# - 我应该为 Web 应用程序中的延迟加载而烦恼吗？

> ID：829036
> 
> 赞同：0
> 
> 时间：2009-05-06T10:44:05.403
> 
> 标签：c#, .net, performance, lazy-loading

我了解到要进行单例延迟加载，这是要使用的模式：

```
private MyObject()
{
}

public static MyObject Instance
{
    get { return SingletonCreator.CreatorInstance; }
}

private static class SingletonCreator
{
    private static readonly MyObject _instance = new MyObject();

    public static MyObject CreatorInstance
    {
        get { return _instance; }
    }
} 
```

但更简单的模式是：

```
private static readonly MyObject _instance = new MyObject();

private MyObject()
{
}

public static MyObject Instance
{
    get { return _instance; }
} 
```

这不会是延迟加载。但这真的是我应该在 Web 应用程序中烦恼的事情吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T10:50:07.917

延迟加载通常意味着您正在从数据库中延迟加载某些内容。您所做的通常称为“[延迟初始化](http://en.wikipedia.org/wiki/Lazy_initialization)”（技术上“延迟初始化”是延迟加载模式的一种实现方法）。

至于您最初的问题：首先，您不需要单身人士。如果您*仍然*需要它，请按照[以下](http://www.yoda.arachsys.com/csharp/singleton.html)说明正确完成此操作。第三，你不需要单例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T10:48:06.253

除非您有不需要单例的静态方法，否则仅包含静态构造函数就足以使类变得懒惰。如果没有静态构造函数，它仍然*主要是*惰性的。

有关更多详细信息和选项，请参阅我的[单例实现页面](http://pobox.com/~skeet/csharp/singleton.html)。

我通常会使用您在问题底部提供的代码 - 它足够懒惰，除非您*真的*不想初始化单例，除非它将被使用。（基本上使用`beforefieldinit`set，JIT 通常会确保方法中使用的每个类型都被初始化；没有`beforefieldinit`它必须等到执行期间第一次实际使用该类。有关更多信息，请参阅我的[`beforefieldinit`页面](http://pobox.com/~skeet/csharp/beforefieldinit.html)- 但重要的一点是一旦加载程序集或类似的东西，它仍然不会初始化所有单例。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T10:50:31.927

这一切都很好，但是延迟加载的目的是避免加载（通常是非托管的）资源（访问数据库、文件系统等），直到您需要，这样可以避免在您不真正加载时抢先加载它们需要。使用单例模式本身并不一定意味着延迟加载，因为您可以在任何时候完全正确地创建托管实例。

如果您加载的任何资源仅在进行适当的方法调用时才被访问，那么延迟加载方面就会发挥作用；如果在创建该单例实例时，它会执行一大堆数据库查询并存储结果，那么就我而言，它不是延迟加载。

对于 ORM 场景，延迟加载通常直接指将关系中的另一个对象的加载延迟到第一次访问，这样可以避免执行第二次可能不必要的查询。

再说一次，如果你知道你将在使用对象的过程中导航该关系（即，如果你检索 a`User`以列出它们`Posts`或其他东西），那么你可能想要指示你的 ORM同时加载相关对象，这通常会提示它使用连接执行单个查询，而不是循环并稍后执行多个查询；在这种情况下，您并不真正想要延迟加载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T11:12:17.473

确保不要混淆页面加载、会话和应用程序生命周期。也就是说，您确定要使用静态单例实例吗？一旦创建，它将一直存在，直到应用程序（网络服务器）关闭或您运行*iisreset*。

`HttpContext.Current.Items`如果您希望每个页面加载一个延迟加载的实例，或者`HttpContext.Current.Session`如果您希望每个用户一个，则考虑缓存它。

# sql-server-2005 - SQL Server：生成非对称密钥时出错

> ID：829037
> 
> 赞同：1
> 
> 时间：2009-05-06T10:44:09.430
> 
> 标签：sql-server-2005, clr, sqlclr, signing

```
CREATE ASYMMETRIC KEY asymmetrickey 
FROM EXECUTABLE FILE = 'c:\windows\microsoft.net\framework\v2.0.50727\system.windows.forms.dll' 
```

为什么我不能使用上述方法从框架库中生成非对称密钥（用于安装在 SQL Server 中作为 CLR 函数的参考）。它给出了一个错误：

> “在生成非对称密钥期间发生错误。”

如果没有非对称密钥，则需要将数据库设置为可信任才能将程序集添加到 SQL Server (2005)。我意识到框架库不适合在 SQL Server 中使用，但很好奇为什么这不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-22T07:46:08.537

`System.Windows.Forms`不允许在 CLR 函数中使用。

[http://blogs.msdn.com/tims/archive/2004/05/27/142798.aspx](http://blogs.msdn.com/tims/archive/2004/05/27/142798.aspx)

[http://msdn.microsoft.com/en-us/library/ms403279.aspx](http://msdn.microsoft.com/en-us/library/ms403279.aspx)

# .net - ComboBox 的 DropDownStyle 更改 BackColor 行为

> ID：829044
> 
> 赞同：2
> 
> 时间：2009-05-06T10:48:07.220
> 
> 标签：.net, winforms, combobox

我有一个 WinForms 2.0，上面有几个 ComboBox 控件。对于其中一些 ComboBox 的属性`DropDownStyle`设置为`DropDown`，而另一些则设置为`DropDownList`。

现在，为了指示选择的变化`BackColor`，每个 ComboBox 的属性设置为不同的值。具有`DropDownList`样式的具有完整的彩色背景，而具有`DropDown`样式的仅显示彩色框架。我想要两种款式的全彩版本。

我正在使用 VS2005 和 .NET 2.0。

-UPDATE 我应该提到的`ComboBox`是已禁用。虽然背景在启用时是全彩色的，但在禁用时只显示一个小的彩色边框。这就是我要更改的内容，我希望在`ComboBox`禁用时为完整的背景着色。

# ajax - 如何检测用户是否使用后退按钮进入页面？

> ID：829046
> 
> 赞同：101
> 
> 时间：2009-05-06T10:48:14.850
> 
> 标签：ajax, browser, back-button

这个问题类似于[Track when user hits back button on the browser](https://stackoverflow.com/questions/55871/track-when-user-hits-back-button-on-the-browser)，但不一样...我有一个解决方案，并在此处发布以供参考和反馈。如果有人有更好的选择，我会全力以赴！

情况是我有一个带有“就地编辑”的页面，例如 flickr。即有一个“单击此处添加描述”DIV，当单击它变成一个带有保存和取消按钮的文本区域。单击 Save 将数据发布到服务器以更新数据库并将新描述放入 DIV 中以代替 TEXTAREA。如果页面被刷新，新的描述会从数据库中显示，并带有“点击编辑”选项。这些天相当标准的 web 2.0 东西。

问题是，如果：

1.  页面加载时没有描述
2.  用户添加描述
3.  通过单击链接导航离开该页面
4.  用户点击后退按钮

然后显示的（来自浏览器的缓存）是页面的版本，没有包含新描述的动态修改的 DIV。

这是一个相当大的问题，因为用户假设他们的更新已经丢失并且不一定明白他们需要刷新页面才能看到更改。

所以，问题是：如何在页面加载后将页面标记为正在修改，然后检测用户何时“返回”并在这种情况下强制刷新？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2011-04-12T22:58:59.807

使用隐藏表格。当您重新加载或点击后退按钮返回页面时，表单数据（通常）保存在浏览器中。以下内容进入您的页面（可能靠近底部）：

```
<form name="ignore_me">
    <input type="hidden" id="page_is_dirty" name="page_is_dirty" value="0" />
</form> 
```

在您的 javascript 中，您将需要以下内容：

```
var dirty_bit = document.getElementById('page_is_dirty');
if (dirty_bit.value == '1') window.location.reload();
function mark_page_dirty() {
    dirty_bit.value = '1';
} 
```

嗅探表单的 js 必须在 html 完全解析后执行，但如果用户延迟是一个严重问题，您可以将表单和 js 内联放在页面顶部（js 秒）。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2017-08-24T09:31:39.287

这是解决这个老问题的一个非常简单的现代解决方案。

```
if (window.performance && window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD) {
    alert('Got here using the browser "Back" or "Forward" button.');
} 
```

所有主要浏览器目前都支持 window.performance。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-06-15T22:05:18.983

这篇文章解释了它。请参阅下面的代码： [http ://www.webkit.org/blog/516/webkit-page-cache-ii-the-unload-event/](http://www.webkit.org/blog/516/webkit-page-cache-ii-the-unload-event/)

```
<html>
    <head>
        <script>

            function pageShown(evt){
                if (evt.persisted) {
                    alert("pageshow event handler called.  The page was just restored from the Page Cache (eg. From the Back button.");
                } else {
                    alert("pageshow event handler called for the initial load.  This is the same as the load event.");
                }
            }

            function pageHidden(evt){
                if (evt.persisted) {
                    alert("pagehide event handler called.  The page was suspended and placed into the Page Cache.");
                } else {
                    alert("pagehide event handler called for page destruction.  This is the same as the unload event.");
                }
            }

            window.addEventListener("pageshow", pageShown, false);
            window.addEventListener("pagehide", pageHidden, false);

        </script>
    </head>
    <body>
        <a href="http://www.webkit.org/">Click for WebKit</a>
    </body>
</html> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-06-04T04:05:30.663

您可以使用**onbeforeunload**事件解决它：

```
window.onbeforeunload = function () { }
```

拥有一个**onbeforeunload**空事件管理器功能意味着页面将在每次访问时重新构建。Javascript 将重新运行，服务器端脚本将重新运行，页面将像用户第一次点击一样构建，即使用户只是通过点击后退或前进按钮进入页面.

以下是示例的完整代码：

```
<html>
<head>
<title>onbeforeunload.html</title>
<script>
window.onbeforeunload = function () { }

function myfun()
{
   alert("The page has been refreshed.");
}
</script>

<body onload="myfun()">

Hello World!<br>

</body>
</html>
```

试试看，离开此页面，然后使用浏览器中的“后退”或“前进”按钮返回。

它在 IE、FF 和 Chrome 中运行良好。

当然你可以在**myfun**函数中做任何你想做的事情。

更多信息： [http ://www.hunlock.com/blogs/Mastering_The_Back_Button_With_Javascript](http://www.hunlock.com/blogs/Mastering_The_Back_Button_With_Javascript)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2020-01-08T07:28:15.830

对于现代浏览器，现在这似乎是正确的方法：

```
const perfEntries = performance.getEntriesByType('navigation');
if (perfEntries.length && perfEntries[0].type === 'back_forward') {
  console.log('User got here from Back or Forward button.');
} 
```

截至 2020 年 1 月，这仍然是“实验性的”，但似乎得到了很好的支持。

[https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T11:07:04.913

如上所述，我找到了一个解决方案，并在此处发布以供参考和反馈。

解决方案的第一阶段是在页面中添加以下内容：

```
<!-- at the top of the content page -->
<IFRAME id="page_is_fresh" src="fresh.html" style="display:none;"></IFRAME>
<SCRIPT style="text/javascript">
  function reload_stale_page() { location.reload(); }
</SCRIPT> 
```

的内容`fresh.html`并不重要，因此以下内容就足够了：

```
<!-- fresh.html -->
<HTML><BODY></BODY></HTML> 
```

当客户端代码更新页面时，需要将修改标记如下：

```
function trigger_reload_if_user_clicks_back_button()
{
  // "dis-arm" the reload stale page function so it doesn't fire  
  // until the page is reloaded from the browser's cache
  window.reload_stale_page = function(){};

  // change the IFRAME to point to a page that will reload the 
  // page when it loads
  document.getElementById("page_is_fresh").src = "stale.html";
} 
```

`stale.html`做所有的工作：当它被加载时，它会调用`reload_stale_page`函数，如果需要的话会刷新页面。第一次加载（即修改后，该`reload_stale_page`函数不会做任何事情。）

```
<!-- stale.html -->
<HTML><BODY>
<SCRIPT type="text/javascript">window.parent.reload_stale_page();</SCRIPT>
</BODY></HTML> 
```

从我在这个阶段的（最小）测试来看，这似乎可以按预期工作。我有没有忽略什么？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-31T14:20:30.127

这是一个 jQuery 版本。由于 Safari 桌面/移动设备在用户按下后退按钮时处理缓存的方式，我遇到了几次需要使用它的情况。

```
$(window).bind("pageshow", function(event) {
    if (event.originalEvent.persisted) {
        // Loading from cache
    }
}); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-06-02T14:29:03.063

您可以使用 localStorage 或 sessionStorage ( [http://www.w3schools.com/html/html5_webstorage.asp](http://www.w3schools.com/html/html5_webstorage.asp) ) 设置标志（而不是使用隐藏表单）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-02-26T04:20:01.577

使用这个页面，特别是结合@sajith 对@Nick White 的回答和这个页面的评论：[http ://www.mrc-productivity.com/techblog/?p=1235](http://www.mrc-productivity.com/techblog/?p=1235)

```
<form name="ignore_me" style="display:none">
    <input type="text" id="reloadValue" name="reloadValue" value="" />
</form>

$(function ()
{
    var date = new Date();
    var time = date.getTime();

    if ($("#reloadValue").val().length === 0)
    {
        $("#reloadValue").val(time);
    }
    else
    {
        $("#reloadValue").val("");
        window.location.reload();
    }
}); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-06-08T15:29:17.773

我今天遇到了类似的问题，我用 localStorage 解决了它（这里有一点 jQuery）：

```
$(function() {

    if ($('#page1').length) {
        // this code must only run on page 1

        var checkSteps = function () {
            if (localStorage.getItem('steps') == 'step2') {
                // if we are here, we know that:
                // 1\. the user is on page 1
                // 2\. he has been on page 2
                // 3\. this function is running, which means the user has submitted the form
                // 4\. but steps == step2, which is impossible if the user has *just* submitted the form
                // therefore we know that he has come back, probably using the back button of his browser
                alert('oh hey, welcome back!');
            } else {
                setTimeout(checkSteps, 100);
            }
        };

        $('#form').on('submit', function (e) {
            e.preventDefault();
            localStorage.setItem('steps', 'step1'); // if "step1", then we know the user has submitted the form
            checkOrderSteps();
            // ... then do what you need to submit the form and load page 2
        });
    }

    if ($('#page2').length) {
        // this code must only run on page 2
        localStorage.setItem('steps', 'step2');
    }

}); 
```

基本上是：

在第 1 页，当用户提交表单时，我们在 localStorage 中设置了一个值“steps”来指示用户采取的步骤。同时，我们启动一个带超时功能的函数来检查这个值是否已经改变（例如10次/秒）。

在第 2 页，我们立即更改所述值。

因此，如果用户使用后退按钮并且浏览器将第 1 页恢复到我们离开时的确切状态，则 checkSteps 函数仍在运行，并且能够检测到 localStorage 中的值已更改（并且可以采取适当的措施）。一旦这个检查完成了它的目的，就没有必要继续运行它了，所以我们不再使用 setTimeout 了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-05T19:38:09.943

在其他人的评论中发现了这一点（感谢 Mladen）——似乎在 Chrome 88 中运行良好。

```
if(String(window.performance.getEntriesByType("navigation")[0].type) === "back_forward"){
// Actions here, such as refresh page, etc.
} 
```

# mysql - 使用 NHibernate 生成 MySql 模式

> ID：829049
> 
> 赞同：0
> 
> 时间：2009-05-06T10:48:38.060
> 
> 标签：mysql, nhibernate

我使用以下代码生成数据库创建脚本

```
Configuration configuration = new Configuration();
configuration.Configure();
SchemaExport schemaExport = new SchemaExport(configuration);
using(TextWriter stringWriter = new StreamWriter("create.sql"))
{
   schemaExport.Execute(false, false, false, true, null, stringWriter); 
} 
```

和 sql，它生成的 MS SQL 效果很好。当我不得不迁移到 MySql 时，我将 NHibernate 配置更改为：

```
<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
<session-factory>
  <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
  <property name="connection.driver_class">NHibernate.Driver.MySqlDataDriver</property>
  <property name="connection.connection_string">Server=localhost;Database=db;User ID=root;Password=sa;</property>
  <property name="dialect">NHibernate.Dialect.MySQLDialect</property>
</session-factory> 
```

但是这次生成的sql因为错误在MySQL Query Browser中没有执行。以下是 Nhibernate 生成的 mysql 创建脚本示例：

```
alter table Order  drop foreign key FK_User_Order
alter table OrderItem  drop foreign key FK_Order_Item
alter table Item  drop foreign key FK742DC178AD99756A

drop table if exists User
drop table if exists Order
drop table if exists OrderItem
drop table if exists Item
drop table if exists Category
create table User (
  Id INTEGER NOT NULL AUTO_INCREMENT,
   role INTEGER not null,
   is_active TINYINT(1) not null,
   contact_name VARCHAR(100),
   phone VARCHAR(100),
   address VARCHAR(100),
   email VARCHAR(100) not null,
   name VARCHAR(100) not null,
   password_hash LONGBLOB not null,
   login VARCHAR(100) not null unique,
   is_new TINYINT(1) not null,
   price_type INTEGER not null,
   access_id INTEGER not null,
   primary key (Id) 
```

尝试执行时出现以下错误

> 脚本行：2 您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在“Order drop foreign key FK_User_Order”附近使用正确的语法
> 
> 在第 1 行更改表 OrderItem drop foreign k'

任何想法为什么 Nhiberante 生成的 sql 不起作用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-05T12:39:01.450

schemaExport.SetDelimiter(";"); 如果需要分隔（即作为单独的语句运行它们

另外，Order 是关键字吗？您可以将订单重新映射到数据库中的订单，以避免关键字冲突吗？

# asp.net - 不允许更改“ConnectionString”属性。连接的当前状态为打开

> ID：829051
> 
> 赞同：2
> 
> 时间：2009-05-06T10:49:00.820
> 
> 标签：asp.net, sqlconnection

stackoverflow 的第一次用户，但我在 Coding Horror 上关注了它的发展。

我对上述错误感到非常头疼。我安装了 ELMAH 和 Google Analytics，随着网站流量的增加，我看到这个错误的次数也增加了。

我已尽我所能遵循 Microsoft 原则： http: [//msdn.microsoft.com/en-us/library/ms971481.aspx](http://msdn.microsoft.com/en-us/library/ms971481.aspx)在整个开发过程中，我已经根据多种建议来源尽可能优化了我的代码网络。

我在公共课上有我的 SqlConnection；

```
Public Class pitstop
Public Shared oConn As New System.Data.SqlClient.SqlConnection
    Public Shared Sub doConnect()
    If oConn.State = ConnectionState.Closed Then
        oConn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("pitstopConnectionString").ConnectionString
        oConn.Open()
    End If
End Sub
Public Shared Sub doGarbage()
    oConn.Dispose()
End Sub
' /// other code ///
End Class 
```

在我的主要应用程序页面中，我的做法与此大致相同：

```
 Private Sub doPump()
    pitstop.doConnect()
    Dim cmd As New System.Data.SqlClient.SqlCommand("doGetCategory", pitstop.oConn)
    Dim dt As New DataTable
    Dim dr As SqlDataReader

    cmd.Parameters.Add("@cat", SqlDbType.Int)
    cmd.Parameters("@cat").Value = CType(Request.QueryString("id"), Integer)

    cmd.CommandType = CommandType.StoredProcedure

    dr = cmd.ExecuteReader()
    While dr.Read()
        If dr.HasRows = True Then
            litCategory.Text = dr("category")
            litCategoryDesc.Text = pitstop.doMakeReadyForHTML(dr("desc"))
        End If
    End While
    cmd = Nothing
    dr.Close()
    pitstop.doGarbage()
End Sub 
```

我一直在使用这种方法，而且大部分时间效果都很好，但是现在网站变得异常繁忙，戏剧已经开始了！有没有人有任何想法？

我宁愿不必重新编写大量代码，但我愿意接受建议。

:)

克里斯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T10:54:23.087

共享您的连接是问题所在。

无需共享连接并产生您遇到的问题。.net 的连接池在后台处理*真实*连接的共享。

只需在 doPump() 中创建一个新连接

```
Private Sub doPump()
    Using Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("pitstopConnectionString").ConnectionString)
        Using Dim cmd As New SqlCommand("doGetCategory", conn)
        cmd.CommandType = CommandType.StoredProcedure
        cmd.Parameters.AddWithValue("@cat", CType(Request.QueryString("id"), Integer))
        conn.Open()
        Using Dim dr as SqlDataReader = cmd.ExecuteReader()
            While dr.Read()
                    litCategory.Text = dr("category")
                    litCategoryDesc.Text = pitstop.doMakeReadyForHTML(dr("desc"))
            End While
            dr.Close()
        End Using
    End Using
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T10:56:21.990

你的`SqlConnection`对象是`Shared`. 这是在一个网络应用程序中，它本质上是多线程的。

您的数据库访问逻辑在您的代码隐藏页面中。

如果在调用之前发生异常`pitstop.doGarbage()`怎么办？连接要么永远不会关闭，要么会一直徘徊并导致各种错误。

就您当前的代码而言：取消`Shared`连接，将数据访问逻辑移至单独的类，正确管理资源（想想[Using](http://www.pluralsight.com/community/blogs/fritz/archive/2005/04/28/7834.aspx)语句）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T11:43:22.390

我添加了以下代码，从进站类中删除了“共享”连接。Pitstop 被称为“pitstop”，因为这是项目的名称。不合适吗？你们使用什么约定？

我已经废弃了 doGarbage() 函数，现在调用连接和一次性“内联”，就像这样；

```
 Private Sub doPump()
    Dim oConn As New SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings("pitstopConnectionString").ConnectionString)
    Dim cmd As New System.Data.SqlClient.SqlCommand("doGetCategory", oConn)
    oConn.Open()

    Dim dt As New DataTable
    Dim dr As SqlDataReader

    cmd.Parameters.Add("@cat", SqlDbType.Int)
    cmd.Parameters("@cat").Value = CType(Request.QueryString("id"), Integer)

    cmd.CommandType = CommandType.StoredProcedure

    dr = cmd.ExecuteReader()
    While dr.Read()
        If dr.HasRows = True Then
            litCategory.Text = dr("category")
            litCategoryDesc.Text = pitstop.doMakeReadyForHTML(dr("desc"))
        End If
    End While
    cmd = Nothing
    dr.Close()

    oConn.Dispose()
End Sub 
```

它是否正确？

此外，Anton 提到在课堂上具有功能是不正确的——我也会阅读他链接的文档——但是有没有快速回答为什么它是错误的？

非常感谢所有的回复——你们都非常有帮助。

克里斯

# c# - 如何将 FlowDocument 转换为 rtf

> ID：829053
> 
> 赞同：10
> 
> 时间：2009-05-06T10:49:22.973
> 
> 标签：c#, rtf, flowdocument

我使用 WPF RichTextBox 将流文档保存为数据库中的字节 []。现在我需要检索这些数据并在报告 RichTextBox 中显示为 rtf。当我尝试使用 TextRange 或在 XAMLReader 中转换字节 [] 时，我得到了一个 FlowDocument，但是我如何将它转换为 rtf 字符串，因为报告 RichTextBox 只需要 rtf。

谢谢

阿尔文德

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-06T11:04:28.303

您不应该直接保留 FlowDocument，因为它应该被视为文档的运行时表示，而不是实际的文档内容。相反，使用[TextRange 类](http://msdn.microsoft.com/en-us/library/ms598701.aspx)来保存和加载各种格式，包括[Rtf](http://msdn.microsoft.com/en-us/library/system.windows.dataformats.rtf.aspx)。

有关如何创建选择并保存到流的快速示例：

```
var content = new TextRange(doc.ContentStart, doc.ContentEnd);

if (content.CanSave(DataFormats.Rtf))
{
    using (var stream = new MemoryStream())
    {
        content.Save(stream, DataFormats.Rtf);
    }
} 
```

将内容加载到选择中将是类似的：

```
var content = new TextRange(doc.ContentStart, doc.ContentEnd);

if (content.CanLoad(DataFormats.Rtf))
{
    content.Load(stream, DataFormats.Rtf);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-22T11:26:02.833

这对我来说就像一个魅力。毫无困难地在 RTF 框中显示结果。

```
public static string getDocumentAsXaml(IDocumentPaginatorSource flowDocument)
{
     return XamlWriter.Save(flowDocument);
} 
```

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2012-04-26T14:55:12.297

```
 Using conn As New System.Data.SqlClient.SqlConnection(connectionSTRING)
       Dim adapter As New System.Data.SqlClient.SqlDataAdapter(selectSTRING, conn)
       Dim DS As System.Data.DataSet = New System.Data.DataSet
       adapter.Fill(DS)

       Dim ba() As Byte = Text.Encoding.ASCII.GetBytes(DS.Tables(0).Rows(0)("RTF_Field").ToString())

       Dim ms As MemoryStream = New MemoryStream(ba)
       Dim fd As FlowDocument = New FlowDocument
       Dim tr As TextRange = New TextRange(fd.ContentStart, fd.ContentEnd)
       tr.Load(ms, System.Windows.DataFormats.Rtf)
       ms.Close()

            RichTextBox.Document = fd

        End Using 
```

您将需要使用连接字符串和 SQL 选择语句……除此之外，就是这样……

# lua - 如何迭代Lua字符串中的单个字符？

> ID：829063
> 
> 赞同：102
> 
> 时间：2009-05-06T10:55:36.657
> 
> 标签：lua

我在 Lua 中有一个字符串，想在其中迭代单个字符。但是我尝试过的代码都没有，官方手册只显示了如何查找和替换子字符串:(

```
str = "abcd"
for char in str do -- error
  print( char )
end

for i = 1, str:len() do
  print( str[ i ] ) -- nil
end 
```

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-05-07T00:31:47.363

在 lua 5.1 中，您可以通过几种方式迭代字符串 this 的字符。

基本循环是：

```
for i = 1, #str do
    local c = str:sub(i,i)
    -- do something with c
end 
```

`string.gmatch()`但是使用模式来获取字符的迭代器可能更有效：

```
for c in str:gmatch"." do
    -- do something with c
end 
```

甚至用于`string.gsub()`为每个字符调用一个函数：

```
str:gsub(".", function(c)
    -- do something with c
end) 
```

在上述所有内容中，我利用了`string`模块被设置为所有字符串值的元表这一事实，因此可以使用`:`符号将其函数作为成员调用。我还使用 (new to 5.1, IIRC)`#`来获取字符串长度。

您的应用程序的最佳答案取决于很多因素，如果性能很重要，基准测试是您的朋友。

您可能想要评估*为什么*需要迭代字符，并查看已绑定到 Lua 的正则表达式模块之一，或者对于现代方法查看 Roberto 的[lpeg](http://www.inf.puc-rio.br/%7Eroberto/lpeg.html)模块，该模块实现了 Lua 的 Parsing Expression Grammers。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2015-12-24T10:30:05.740

根据手头的任务，它可能更容易使用[`string.byte`](http://www.lua.org/manual/5.1/manual.html#pdf-string.byte)。这也是最快的方法，因为它避免了创建在 Lua 中非常昂贵的新子字符串，这要归功于每个新字符串的散列并检查它是否已知。您可以预先计算您要查找的符号代码，`string.byte`以保持可读性和可移植性。

```
local str = "ab/cd/ef"
local target = string.byte("/")
for idx = 1, #str do
   if str:byte(idx) == target then
      print("Target found at:", idx)
   end
end 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-06T13:05:41.117

如果您使用的是 Lua 5，请尝试：

```
for i = 1, string.len(str) do
    print( string.sub(str, i, i) )
end 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2018-03-11T17:06:21.113

提供的答案中已经有很多好的方法（[here](https://stackoverflow.com/a/832414/2340876)、[here](https://stackoverflow.com/a/34451343/2340876)和[here](https://stackoverflow.com/a/42388144/2340876)）。如果速度是您**主要**寻找的，您绝对应该考虑通过 Lua 的 C API 来完成这项工作，这比原始 Lua 代码快很多倍。当使用预加载的块（例如[load function](https://www.lua.org/manual/5.3/manual.html#pdf-load)）时，差异不是很大，但仍然相当大。

至于*纯粹*的Lua 解决方案，让我分享一下我做的这个小基准。它涵盖了迄今为止提供的所有答案，并添加了一些优化。不过，要考虑的基本事项是：

**您需要迭代字符串中的字符多少次？**

*   如果答案是“一次”，那么您应该查找基准的第一部分（“原始速度”）。
*   否则，第二部分将提供更精确的估计，因为它将字符串解析到表中，这样迭代起来要快得多。您还应该考虑为此编写一个简单的函数，就像@Jarriz 建议的那样。

**这是完整的代码：**

```
-- Setup locals
local str = "Hello World!"
local attempts = 5000000
local reuses = 10 -- For the second part of benchmark: Table values are reused 10 times. Change this according to your needs.
local x, c, elapsed, tbl
-- "Localize" funcs to minimize lookup overhead
local stringbyte, stringchar, stringsub, stringgsub, stringgmatch = string.byte, string.char, string.sub, string.gsub, string.gmatch

print("-----------------------")
print("Raw speed:")
print("-----------------------")

-- Version 1 - string.sub in loop
x = os.clock()
for j = 1, attempts do
    for i = 1, #str do
        c = stringsub(str, i)
    end
end
elapsed = os.clock() - x
print(string.format("V1: elapsed time: %.3f", elapsed))

-- Version 2 - string.gmatch loop
x = os.clock()
for j = 1, attempts do
    for c in stringgmatch(str, ".") do end
end
elapsed = os.clock() - x
print(string.format("V2: elapsed time: %.3f", elapsed))

-- Version 3 - string.gsub callback
x = os.clock()
for j = 1, attempts do
    stringgsub(str, ".", function(c) end)
end
elapsed = os.clock() - x
print(string.format("V3: elapsed time: %.3f", elapsed))

-- For version 4
local str2table = function(str)
    local ret = {}
    for i = 1, #str do
        ret[i] = stringsub(str, i) -- Note: This is a lot faster than using table.insert
    end
    return ret
end

-- Version 4 - function str2table
x = os.clock()
for j = 1, attempts do
    tbl = str2table(str)
    for i = 1, #tbl do -- Note: This type of loop is a lot faster than "pairs" loop.
        c = tbl[i]
    end
end
elapsed = os.clock() - x
print(string.format("V4: elapsed time: %.3f", elapsed))

-- Version 5 - string.byte
x = os.clock()
for j = 1, attempts do
    tbl = {stringbyte(str, 1, #str)} -- Note: This is about 15% faster than calling string.byte for every character.
    for i = 1, #tbl do
        c = tbl[i] -- Note: produces char codes instead of chars.
    end
end
elapsed = os.clock() - x
print(string.format("V5: elapsed time: %.3f", elapsed))

-- Version 5b - string.byte + conversion back to chars
x = os.clock()
for j = 1, attempts do
    tbl = {stringbyte(str, 1, #str)} -- Note: This is about 15% faster than calling string.byte for every character.
    for i = 1, #tbl do
        c = stringchar(tbl[i])
    end
end
elapsed = os.clock() - x
print(string.format("V5b: elapsed time: %.3f", elapsed))

print("-----------------------")
print("Creating cache table ("..reuses.." reuses):")
print("-----------------------")

-- Version 1 - string.sub in loop
x = os.clock()
for k = 1, attempts do
    tbl = {}
    for i = 1, #str do
        tbl[i] = stringsub(str, i) -- Note: This is a lot faster than using table.insert
    end
    for j = 1, reuses do
        for i = 1, #tbl do
            c = tbl[i]
        end
    end
end
elapsed = os.clock() - x
print(string.format("V1: elapsed time: %.3f", elapsed))

-- Version 2 - string.gmatch loop
x = os.clock()
for k = 1, attempts do
    tbl = {}
    local tblc = 1 -- Note: This is faster than table.insert
    for c in stringgmatch(str, ".") do
        tbl[tblc] = c
        tblc = tblc + 1
    end
    for j = 1, reuses do
        for i = 1, #tbl do
            c = tbl[i]
        end
    end
end
elapsed = os.clock() - x
print(string.format("V2: elapsed time: %.3f", elapsed))

-- Version 3 - string.gsub callback
x = os.clock()
for k = 1, attempts do
    tbl = {}
    local tblc = 1 -- Note: This is faster than table.insert
    stringgsub(str, ".", function(c)
        tbl[tblc] = c
        tblc = tblc + 1
    end)
    for j = 1, reuses do
        for i = 1, #tbl do
            c = tbl[i]
        end
    end
end
elapsed = os.clock() - x
print(string.format("V3: elapsed time: %.3f", elapsed))

-- Version 4 - str2table func before loop
x = os.clock()
for k = 1, attempts do
    tbl = str2table(str)
    for j = 1, reuses do
        for i = 1, #tbl do -- Note: This type of loop is a lot faster than "pairs" loop.
            c = tbl[i]
        end
    end
end
elapsed = os.clock() - x
print(string.format("V4: elapsed time: %.3f", elapsed))

-- Version 5 - string.byte to create table
x = os.clock()
for k = 1, attempts do
    tbl = {stringbyte(str,1,#str)}
    for j = 1, reuses do
        for i = 1, #tbl do
            c = tbl[i]
        end
    end
end
elapsed = os.clock() - x
print(string.format("V5: elapsed time: %.3f", elapsed))

-- Version 5b - string.byte to create table + string.char loop to convert bytes to chars
x = os.clock()
for k = 1, attempts do
    tbl = {stringbyte(str, 1, #str)}
    for i = 1, #tbl do
        tbl[i] = stringchar(tbl[i])
    end
    for j = 1, reuses do
        for i = 1, #tbl do
            c = tbl[i]
        end
    end
end
elapsed = os.clock() - x
print(string.format("V5b: elapsed time: %.3f", elapsed)) 
```

**示例输出**（Lua 5.3.4，Windows）**：**

```
-----------------------
Raw speed:
-----------------------
V1: elapsed time: 3.713
V2: elapsed time: 5.089
V3: elapsed time: 5.222
V4: elapsed time: 4.066
V5: elapsed time: 2.627
V5b: elapsed time: 3.627
-----------------------
Creating cache table (10 reuses):
-----------------------
V1: elapsed time: 20.381
V2: elapsed time: 23.913
V3: elapsed time: 25.221
V4: elapsed time: 20.551
V5: elapsed time: 13.473
V5b: elapsed time: 18.046 
```

**结果：**

就我而言，`string.byte`和`string.sub`就原始速度而言是最快的。当使用缓存表并在每个循环中重复使用 10 次时，`string.byte`即使将 charcode 转换回 chars，该版本也是最快的（这并不总是必要的，取决于使用情况）。

您可能已经注意到，我根据之前的基准做了一些假设，并将它们应用到代码中：

1.  如果在循环中使用库函数，则应该始终本地化，因为它要快得多。
2.  将新元素插入 lua 表比`tbl[idx] = value`使用`table.insert(tbl, value)`.
3.  循环遍历表 using`for i = 1, #tbl`比`for k, v in pairs(tbl)`.
4.  总是更喜欢函数调用较少的版本，因为调用本身会增加一点执行时间。

希望能帮助到你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-10-26T20:04:45.380

迭代构造一个字符串并将这个字符串作为一个带有 load() 的表返回...

```
itab=function(char)
local result
for i=1,#char do
 if i==1 then
  result=string.format('%s','{')
 end
result=result..string.format('\'%s\'',char:sub(i,i))
 if i~=#char then
  result=result..string.format('%s',',')
 end
 if i==#char then
  result=result..string.format('%s','}')
 end
end
 return load('return '..result)()
end

dump=function(dump)
for key,value in pairs(dump) do
 io.write(string.format("%s=%s=%s\n",key,type(value),value))
end
end

res=itab('KOYAANISQATSI')

dump(res) 
```

发出...

```
1=string=K
2=string=O
3=string=Y
4=string=A
5=string=A
6=string=N
7=string=I
8=string=S
9=string=Q
10=string=A
11=string=T
12=string=S
13=string=I 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-02-22T09:53:42.210

所有人都建议一种不太理想的方法

将是最好的：

```
 function chars(str)
        strc = {}
        for i = 1, #str do
            table.insert(strc, string.sub(str, i, i))
        end
        return strc
    end

    str = "Hello world!"
    char = chars(str)
    print("Char 2: "..char[2]) -- prints the char 'e'
    print("-------------------\n")
    for i = 1, #str do -- testing printing all the chars
        if (char[i] == " ") then
            print("Char "..i..": [[space]]")
        else
            print("Char "..i..": "..char[i])
        end
    end 
```

# objective-c - 如何将浮点值四舍五入到小数点后 2 位？

> ID：829067
> 
> 赞同：13
> 
> 时间：2009-05-06T10:57:54.013
> 
> 标签：objective-c, cocoa-touch, uikit

我从加速度计得到一个浮点值，如下所示：

-3.04299553323

例如，我想得到 -3.04。有没有一种简单的方法来舍入该浮点值？

编辑：

> [Objective-C 中的舍入数字](https://stackoverflow.com/questions/752817/rounding-numbers-in-objective-c)

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2013-04-21T11:37:27.343

我知道这是旧帖子，但以防万一其他人正在寻找快速的两步选项。

```
float old = -3.04299553323;  
float new = [[NSString stringWithFormat:@"%.2f",old]floatValue]; 
```

**结果 =`-3.04`**

@ " **%.2f"**将四舍五入到小数点后两位。如果您想要三位小数，请输入**@"%.3f"**等等。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2011-07-13T16:00:37.463

您应该只在格式化数字以显示给最终用户时这样做，因为不能保证

```
float rounded = roundf(orig * 100) / 100.0; 
```

或类似的将返回一个确切的答案。

事实上，一般来说，它不会。例如考虑

```
float f = 123456.3;
float r = roundf(f * 100) / 100.0;

printf("%.2f, %.10f\n", r, r); 
```

哪个输出

```
123456.30, 123456.2968750000 
```

哎呀！

使用`double`而不是`float`帮助，但即便如此，如果我们稍微改变一下代码，你会发现它并没有真正解决问题：

```
double f = 123456.3;
double r = round(f * 100) / 100.0;

printf("%.2f, %.20f\n", r, r); 
```

再次，我们得到

```
123456.30, 123456.30000000000291038305 
```

这很清楚地表明它不是完全四舍五入的。

**无论如何，这个故事的寓意是只做大约**`round(f * 100) / 100.0`回合的事情。在某些情况下它可能已经足够好了，但您确实需要记住，结果并不是*真正*的四舍五入。

 ***如果你想要更好的东西，你需要使用十进制算术。[您可以通过将值保持为整数（例如，对于货币值，将它们保持为便士或美分而不是英镑或美元），或者使用您可以在 Wikipedia 的 Decimal Floating Point 页面上](http://en.wikipedia.org/wiki/Decimal_floating_point)找到的各种十进制浮点包之一来做到这一点.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T10:59:54.337

将其乘以 100，（如有必要，向上/向下舍入到最接近的整数），取整数部分，然后再除以 100

适用于任何数字小数位，乘/除以 10^（小数位数）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-09T12:49:42.667

我只是发布我对这个问题的答案，因为这是我快速完成这个工作的唯一方法，因为我合并了两个给定的答案以在 iPad 应用程序中向用户显示一个四舍五入的浮点值：

```
NSString *roundedAmount = [NSString stringWithFormat:@"%.2f", round ((floatValue / 1024) * 100.0) / 100.0]; 
```

# java - 建议从 struts1 → (struts2, spring) 的进展路径

> ID：829070
> 
> 赞同：4
> 
> 时间：2009-05-06T10:59:29.610
> 
> 标签：java, spring, struts2, struts

在阅读和使用之后`Struts1`（使用上学期制作了一个网络应用程序`Struts/Hibernate`），我想进一步学习更好的`MVC framework`. 我一直在想，是`Struts2`现在学，以后学Spring，还是直接跳过`Struts2`会更慎重`Spring`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T15:17:26.933

我建议不要将两者视为相互排斥的。Struts2 与 Spring MVC 竞争，但 Struts2 使用 Spring 的注入容器和 AOP 功能（Spring 核心和 AOP）。

Struts2 和 Spring MVC 都在努力实现相同的结果：一个干净的 MVC Web 框架。在两者之间做出决定在某种程度上是个人喜好。我个人不喜欢使用 Spring MVC 的“感觉”，而使用 Struts2 和它的拦截器堆栈感觉更舒服。

我建议你通过每个框架中的一些教程“hello world”类型的应用程序来工作，看看哪个对你来说更直观。这两种框架都有优点和缺点，但都可以克服。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-28T06:28:17.587

除了 Rich Kroll 点之外，Struts 2 还提供了丰富的标签库，并且框架组织得非常好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-26T18:52:35.220

除了其他答案，请记住 Struts2 并非顾名思义：它实际上不是 Struts (1) 的下一个版本，它更像是 Webworks 的下一个版本。如果您来自 Struts，则 Struts2 和 SpringMVC 是类似的替代方案，同样在易于学习方面。

# iphone - 自定义 UIView 问题

> ID：829072
> 
> 赞同：1
> 
> 时间：2009-05-06T10:59:51.653
> 
> 标签：iphone, uiview

我有一个自定义 UIView 类，并且我已将我在 IB 中的视图与此类链接。在我自己的自定义类中，我有一个功能

```
 -(void)replaceSubview:(UIView*)view1 withSubView:(UIView*)view2; 
```

所以在我的视图控制器中，我这样调用这个函数：

```
 [self.view replaceSubview:view1 withSubview:view2]; 
```

但是，该功能正常工作，但给我警告说，如 UIView 可能不会响应此功能并假定返回 id，我不知道它是如何发生的，因为我已将我的自定义类链接到 IB alr 中的视图，请帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T11:25:28.923

该属性`view`在 UIViewController 中定义，类型为`UIView *`. 如果你想摆脱警告，你需要先施放它：

```
MyView *myView = (MyView *)self.view;
[myView replaceSubview:view1 withSubview:view2]; 
```

# active-directory - DirectoryEntry memberOf 属性返回完整路径

> ID：829074
> 
> 赞同：4
> 
> 时间：2009-05-06T11:00:06.957
> 
> 标签：active-directory, ldap

我只需要用户所属的组的 commonName。

```
DirectoryEntry user = new DirectoryEntry("LDAP://cn=myuser....");
foreach(string path in user.Properties["memberOf"])
    Console.WriteLine(path); 
```

然后 memberOf 属性包含一组字符串，即组的完整路径。这是有道理的，但这不是我想要的。

我很确定我不应该为每个路径新建一个 DirectoryEntry 来获取通用名称，但是从路径中简单地解析出 cn 是不是最好的主意？（这似乎相当野蛮）

必须有更好的方法来获取用户所属组的 SearchResults。

顺便说一句，这是 .NET 2，所以我不能做任何花哨的 LINQ to AD 东西，也不能访问 ActiveDirectory 的 DirectoryServices 中的新位。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T11:40:26.877

CN 不一定等于组的名称。不推荐将其从 DN 中解析出来，因为 DN 已转义。您需要在目录中查询对象。

要检索单个对象，请将搜索基础设置为它的专有名称，将搜索范围设置为“base”并发出查询。

建议在您的应用程序中缓存查询结果以避免多次发出相同的 LDAP 查询（以防您`memberOf`连续检索多个对象）。

示例代码（[就在 MSDN](http://msdn.microsoft.com/en-us/library/ms180881.aspx)上，仅稍作修改）：

```
string dn = "LDAP://CN=Group Name,ON=Groups,DC=fabrikam,DC=com";

// Bind to a specific group.
DirectoryEntry entry = new DirectoryEntry(dn);

// Create a DirectorySearcher object.
DirectorySearcher mySearcher = new DirectorySearcher(entry);
mySearcher.SearchScope = SearchScope.Base;
mySearcher.PropertiesToLoad.Add("displayName"); 

// Use the FindOne method to find the group object.
SearchResult resEnt = mySearcher.FindOne(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:26:44.647

不幸的是，.NET 2.0 中没有比您描述的更好的方法了。该`memberOf`属性仅包含用户所属的所有组的完整专有名称，因此您最好的解决方案是解析每个专有名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-11-25T10:06:54.033

在“相关”部分找到了这个旧线程。

对这个问题还有另外两个建议。他们每个人都可以像一次搜索
一样直接获取 memberOf 属性中的对象。`SearchResult`

所有代码都在 C# 中。

**属性范围查询 (ASQ)：**

```
DirectoryEntry userEntry = new DirectoryEntry("LDAP://<server>/<user DN>", "user", "pwd");

DirectorySearcher searcher = new DirectorySearcher(userEntry);
searcher.SearchScope = SearchScope.Base;
searcher.AttributeScopeQuery = "memberOf";
searcher.PropertiesToLoad.Clear();
// just load any attributes you want, not limited to cn
searcher.PropertiesToLoad.Add("cn");

foreach (SearchResult result in searcher.FindAll())
{
    Console.WriteLine(result.Path);
} 
```

限制：

*   不处理主要组成员身份
*   需要 2003 的功能级别（忘记域/林）
*   ASQ 不能跨域工作（至少 System.DirectoryServices 不能，它会为另一个域中的任何对象抛出异常）

**LDAP_MATCHING_RULE_IN_CHAIN 匹配规则：**

```
DirectoryEntry rootEntry = new DirectoryEntry("GC://<GC server>", "user", "pwd");

DirectorySearcher searcher = new DirectorySearcher(rootEntry);
searcher.SearchScope = SearchScope.Subtree;
searcher.Filter = "(member:1.2.840.113556.1.4.1941:=<user DN>)";
searcher.PropertiesToLoad.Clear();
// just load any attributes you want, not limited to cn
searcher.PropertiesToLoad.Add("cn");

foreach (SearchResult result in searcher.FindAll())
{
    Console.WriteLine(result.Path);
} 
```

限制：

*   不处理主要组成员身份
*   需要 2008 R2 的功能级别（忘记域/森林）
*   它获得嵌套的组成员身份，而不仅仅是一个级别的 memberOf

# winapi - 谁负责从图像列表中清除内存？

> ID：829075
> 
> 赞同：2
> 
> 时间：2009-05-06T11:00:10.763
> 
> 标签：winapi, mfc, memory-management, imagelist

如果我有一个 CImageList 对象（一个简单的 HIMAGELIST 包装器），我调用：

```
m_pImageList->Replace(...); 
```

[http://msdn.microsoft.com/en-us/library/k10cwcdb.aspx](http://msdn.microsoft.com/en-us/library/k10cwcdb.aspx)

谁负责清理内存？图像列表是否创建了我传入的任何位图的副本（即我可以在堆栈上创建一个 CBitmap 对象，然后将其地址传递给函数）？或者我必须在堆上创建它并记住在图像列表被破坏时手动释放所有内存？

MSDN 对谁负责的主题不是很清楚。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:06:57.473

正如你所说，`CImageList`是一个简单的包装器`HIMAGELIST`。`CImageList::Replace`只需调用[`ImageList_Replace`](http://msdn.microsoft.com/en-us/library/bb775213.aspx)，其文档说明：

> 该`ImageList_Replace`函数将位图复制到内部数据结构。一定要使用`DeleteObject`函数删除`hbmImage`和`hbmMask`函数返回后。

这意味着您可以在堆栈上创建一个`CBitmap`对象，调用`CImageList::Replace`，图像列表将从`CBitmap`对象中获取位图的副本。然后，当`CBitmap`对象超出范围时，其析构函数（或者更确切地说，`CGdiObject`基类析构函数）将调用`DeleteObject`以删除位图。因为图像列表会复制添加到其中的任何位图，所以它应该删除为您替换的位图。

当`CImageList`析构函数执行时，这会调用`ImageList_Destroy`删除底层`HIMAGELIST`，这应该删除图像列表拥有的所有位图。

# c# - 如何在 C# 中为 URL 构建查询字符串？

> ID：829080
> 
> 赞同：542
> 
> 时间：2009-05-06T11:02:17.980
> 
> 标签：c#, .net, url, query-string

从代码调用 Web 资源时的一项常见任务是构建查询字符串以包含所有必要的参数。虽然绝对不是火箭科学，但您需要注意一些漂亮的细节，例如附加一个`&`如果不是第一个参数，对参数进行编码等。

执行此操作的代码非常简单，但有点乏味：

```
StringBuilder SB = new StringBuilder();
if (NeedsToAddParameter A) 
{ 
  SB.Append("A="); SB.Append(HttpUtility.UrlEncode("TheValueOfA")); 
}

if (NeedsToAddParameter B) 
{
  if (SB.Length>0) SB.Append("&"); 
  SB.Append("B="); SB.Append(HttpUtility.UrlEncode("TheValueOfB")); }
} 
```

这是一项非常常见的任务，人们期望存在一个实用程序类，使其更加优雅和可读。扫描 MSDN，我没找到——这让我想到了以下问题：

您所知道的执行上述操作的最优雅的清洁方式是什么？

* * *

## 回答 #1

> 赞同：777
> 
> 时间：2009-12-09T21:28:07.030

`HttpValueCollection`您可以通过调用来创建一个新的可写实例`System.Web.HttpUtility.ParseQueryString(string.Empty)`，然后将其用作 any `NameValueCollection`。添加所需的值后，您可以调用`ToString`集合以获取查询字符串，如下所示：

```
NameValueCollection queryString = System.Web.HttpUtility.ParseQueryString(string.Empty);

queryString.Add("key1", "value1");
queryString.Add("key2", "value2");

return queryString.ToString(); // Returns "key1=value1&key2=value2", all URL-encoded 
```

它`HttpValueCollection`是内部的，因此您不能直接构造实例。但是，一旦您获得了一个实例，您就可以像使用其他任何`NameValueCollection`. 由于您正在使用的实际对象是`HttpValueCollection`，因此调用 ToString 方法将调用 on 的覆盖方法`HttpValueCollection`，该方法将集合格式化为 URL 编码的查询字符串。

在搜索 SO 和网络以寻找类似问题的答案后，这是我能找到的最简单的解决方案。

**.NET 核心**

如果您在 .NET Core 中工作，则可以使用`Microsoft.AspNetCore.WebUtilities.QueryHelpers`该类，这大大简化了这一过程。

[https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.webutilities.queryhelpers](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.webutilities.queryhelpers)

示例代码：

```
const string url = "https://customer-information.azure-api.net/customers/search/taxnbr";
var param = new Dictionary<string, string>() { { "CIKey", "123456789" } };

var newUrl = new Uri(QueryHelpers.AddQueryString(url, param)); 
```

* * *

## 回答 #2

> 赞同：317
> 
> 时间：2009-05-06T11:24:56.210

如果您深入了解 QueryString 属性是 NameValueCollection。当我做了类似的事情时，我通常对序列化和反序列化感兴趣，所以我的建议是建立一个 NameValueCollection 然后传递给：

```
using System.Linq;
using System.Web;
using System.Collections.Specialized;

private string ToQueryString(NameValueCollection nvc)
{
    var array = (
        from key in nvc.AllKeys
        from value in nvc.GetValues(key)
            select string.Format(
                "{0}={1}",
                HttpUtility.UrlEncode(key),
                HttpUtility.UrlEncode(value))
        ).ToArray();
    return "?" + string.Join("&", array);
} 
```

我想在 LINQ 中也有一种超级优雅的方式来做到这一点......

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2012-05-31T15:01:07.300

受 Roy Tinker 评论的启发，我最终在 Uri 类上使用了一个简单的扩展方法，以保持我的代码简洁明了：

```
using System.Web;

public static class HttpExtensions
{
    public static Uri AddQuery(this Uri uri, string name, string value)
    {
        var httpValueCollection = HttpUtility.ParseQueryString(uri.Query);

        httpValueCollection.Remove(name);
        httpValueCollection.Add(name, value);

        var ub = new UriBuilder(uri);
        ub.Query = httpValueCollection.ToString();

        return ub.Uri;
    }
} 
```

用法：

```
Uri url = new Uri("http://localhost/rest/something/browse").
          AddQuery("page", "0").
          AddQuery("pageSize", "200"); 
```

* * *

**编辑 - 符合标准的变体**

正如一些人指出的那样，以[不符合标准的](http://msdn.microsoft.com/en-us/library/system.web.httputility.urlencodeunicode.aspx)`httpValueCollection.ToString()`方式对 Unicode 字符进行编码。这是通过调用方法而不是不推荐使用的方法来处理此类字符的同一扩展方法的变体。`HttpUtility.UrlEncode``HttpUtility.UrlEncodeUnicode`

```
using System.Web;

public static Uri AddQuery(this Uri uri, string name, string value)
{
    var httpValueCollection = HttpUtility.ParseQueryString(uri.Query);

    httpValueCollection.Remove(name);
    httpValueCollection.Add(name, value);

    var ub = new UriBuilder(uri);

    // this code block is taken from httpValueCollection.ToString() method
    // and modified so it encodes strings with HttpUtility.UrlEncode
    if (httpValueCollection.Count == 0)
        ub.Query = String.Empty;
    else
    {
        var sb = new StringBuilder();

        for (int i = 0; i < httpValueCollection.Count; i++)
        {
            string text = httpValueCollection.GetKey(i);
            {
                text = HttpUtility.UrlEncode(text);

                string val = (text != null) ? (text + "=") : string.Empty;
                string[] vals = httpValueCollection.GetValues(i);

                if (sb.Length > 0)
                    sb.Append('&');

                if (vals == null || vals.Length == 0)
                    sb.Append(val);
                else
                {
                    if (vals.Length == 1)
                    {
                        sb.Append(val);
                        sb.Append(HttpUtility.UrlEncode(vals[0]));
                    }
                    else
                    {
                        for (int j = 0; j < vals.Length; j++)
                        {
                            if (j > 0)
                                sb.Append('&');

                            sb.Append(val);
                            sb.Append(HttpUtility.UrlEncode(vals[j]));
                        }
                    }
                }
            }
        }

        ub.Query = sb.ToString();
    }

    return ub.Uri;
} 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2014-02-21T07:06:38.900

[Flurl](https://flurl.dev/) [披露：我是作者] 支持通过匿名对象（以及其他方式）构建查询字符串：

```
var url = "http://www.some-api.com".SetQueryParams(new
{
    api_key = ConfigurationManager.AppSettings["SomeApiKey"],
    max_results = 20,
    q = "Don't worry, I'll get encoded!"
}); 
```

可选的 Flurl.Http 配套库允许您直接从同一个流畅的调用链进行 HTTP 调用，将其扩展为成熟的 REST 客户端：

```
T result = await "https://api.mysite.com"
    .AppendPathSegment("person")
    .SetQueryParams(new { ap_key = "my-key" })
    .WithOAuthBearerToken("MyToken")
    .PostJsonAsync(new { first_name = firstName, last_name = lastName })
    .ReceiveJson<T>(); 
```

NuGet 上提供了完整的软件包：

`PM> Install-Package Flurl.Http`

或者只是独立的 URL 构建器：

`PM> Install-Package Flurl`

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-05-06T11:43:16.010

不久前我回答了一个[类似的问题。](https://stackoverflow.com/questions/229925/outputing-a-manipulated-querystring-in-c/)基本上，最好的方法是使用 class ，它实际上是**`HttpValueCollection`**ASP.NET 的属性，不幸的是它在 .NET 框架中是内部的。`Request.QueryString`您可以使用 Reflector 来抓取它（并将其放入您的 Utils 类中）。通过这种方式，您可以像 NameValueCollection 一样操作查询字符串，但所有 url 编码/解码问题都会为您解决。

`HttpValueCollection`extends `NameValueCollection`，并且有一个构造函数，它接受一个*编码*的查询字符串（包括和号和问号），它覆盖了一个`ToString()`稍后从底层集合重建查询字符串的方法。

例子：

```
 var coll = new HttpValueCollection();

  coll["userId"] = "50";
  coll["paramA"] = "A";
  coll["paramB"] = "B";      

  string query = coll.ToString(true); // true means use urlencode

  Console.WriteLine(query); // prints: userId=50&paramA=A&paramB=B 
```

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2012-01-04T19:36:03.030

这是一种 fluent/lambda-ish 作为扩展方法（结合以前帖子中的概念）的方式，它支持同一个键的多个值。我个人的偏好是对包装器的扩展，以便其他团队成员能够发现此类内容。[请注意，关于编码方法存在争议，Stack Overflow（一篇这样的文章](https://stackoverflow.com/questions/602642/server-urlencode-vs-httputility-urlencode)）和 MSDN 博主（比如[这篇](http://blogs.msdn.com/b/yangxind/archive/2006/11/09/don-t-use-net-system-uri-unescapedatastring-in-url-decoding.aspx)文章）上有很多关于它的帖子。

```
public static string ToQueryString(this NameValueCollection source)
{
    return String.Join("&", source.AllKeys
        .SelectMany(key => source.GetValues(key)
            .Select(value => String.Format("{0}={1}", HttpUtility.UrlEncode(key), HttpUtility.UrlEncode(value))))
        .ToArray());
} 
```

**编辑：**使用 null 支持，尽管您可能需要根据您的特定情况对其进行调整

```
public static string ToQueryString(this NameValueCollection source, bool removeEmptyEntries)
{
    return source != null ? String.Join("&", source.AllKeys
        .Where(key => !removeEmptyEntries || source.GetValues(key)
            .Where(value => !String.IsNullOrEmpty(value))
            .Any())
        .SelectMany(key => source.GetValues(key)
            .Where(value => !removeEmptyEntries || !String.IsNullOrEmpty(value))
            .Select(value => String.Format("{0}={1}", HttpUtility.UrlEncode(key), value != null ? HttpUtility.UrlEncode(value) : string.Empty)))
        .ToArray())
        : string.Empty;
} 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2011-08-02T07:29:22.550

这是我迟到的条目。由于各种原因，我不喜欢其他任何一个，所以我写了自己的。

该版本特点：

*   仅使用 StringBuilder。没有 ToArray() 调用或其他扩展方法。它看起来不像其他一些响应那么漂亮，但我认为这是一个核心功能，因此效率比拥有隐藏低效率的“流畅”、“单线”代码更重要。

*   每个键处理多个值。（我自己不需要它，只是为了让毛里西奥沉默；）

    ```
    public string ToQueryString(NameValueCollection nvc)
    {
        StringBuilder sb = new StringBuilder("?");

        bool first = true;

        foreach (string key in nvc.AllKeys)
        {
            foreach (string value in nvc.GetValues(key))
            {
                if (!first)
                {
                    sb.Append("&");
                }

                sb.AppendFormat("{0}={1}", Uri.EscapeDataString(key), Uri.EscapeDataString(value));

                first = false;
            }
        }

        return sb.ToString();
    } 
    ```

## 示例用法

```
 var queryParams = new NameValueCollection()
        {
            { "x", "1" },
            { "y", "2" },
            { "foo", "bar" },
            { "foo", "baz" },
            { "special chars", "? = &" },
        };

        string url = "http://example.com/stuff" + ToQueryString(queryParams);

        Console.WriteLine(url); 
```

## 输出

```
http://example.com/stuff?x=1&y=2&foo=bar&foo=baz&special%20chars=%3F%20%3D%20%26 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2014-07-31T12:23:12.090

我需要为我正在研究的可移植类库 (PCL) 解决相同的问题。在这种情况下，我无权访问 System.Web，因此无法使用 ParseQueryString。

相反，我`System.Net.Http.FormUrlEncodedContent`像这样使用：

```
var url = new UriBuilder("http://example.com");

url.Query = new FormUrlEncodedContent(new Dictionary<string,string>()
{
    {"param1", "val1"},
    {"param2", "val2"},
    {"param3", "val3"},
}).ReadAsStringAsync().Result; 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2021-06-07T19:37:23.130

好奇没有人提到 AspNet.Core 中的 QueryBuilder。

当您有一个带有重复键的查询时，这很有帮助`?filter=a&filter=b`

```
 var qb = new QueryBuilder();
            qb.Add("filter", new string[] {"A", "B"}; 
```

然后您只需将 qb 添加到 URI，它会自动转换为字符串。

[https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.extensions.querybuilder?view=aspnetcore-5.0](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.extensions.querybuilder?view=aspnetcore-5.0)

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2009-05-06T12:18:56.673

如何创建扩展方法，让您可以像这样以流畅的风格添加参数？

```
string a = "http://www.somedomain.com/somepage.html"
    .AddQueryParam("A", "TheValueOfA")
    .AddQueryParam("B", "TheValueOfB")
    .AddQueryParam("Z", "TheValueOfZ");

string b = new StringBuilder("http://www.somedomain.com/anotherpage.html")
    .AddQueryParam("A", "TheValueOfA")
    .AddQueryParam("B", "TheValueOfB")
    .AddQueryParam("Z", "TheValueOfZ")
    .ToString(); 
```

这是使用 a 的重载`string`：

```
public static string AddQueryParam(
    this string source, string key, string value)
{
    string delim;
    if ((source == null) || !source.Contains("?"))
    {
        delim = "?";
    }
    else if (source.EndsWith("?") || source.EndsWith("&"))
    {
        delim = string.Empty;
    }
    else
    {
        delim = "&";
    }

    return source + delim + HttpUtility.UrlEncode(key)
        + "=" + HttpUtility.UrlEncode(value);
} 
```

这是使用 a 的重载`StringBuilder`：

```
public static StringBuilder AddQueryParam(
    this StringBuilder source, string key, string value)
{
    bool hasQuery = false;
    for (int i = 0; i < source.Length; i++)
    {
        if (source[i] == '?')
        {
            hasQuery = true;
            break;
        }
    }

    string delim;
    if (!hasQuery)
    {
        delim = "?";
    }
    else if ((source[source.Length - 1] == '?')
        || (source[source.Length - 1] == '&'))
    {
        delim = string.Empty;
    }
    else
    {
        delim = "&";
    }

    return source.Append(delim).Append(HttpUtility.UrlEncode(key))
        .Append("=").Append(HttpUtility.UrlEncode(value));
} 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2011-03-01T18:06:46.520

```
 public static string ToQueryString(this Dictionary<string, string> source)
    {
        return String.Join("&", source.Select(kvp => String.Format("{0}={1}", HttpUtility.UrlEncode(kvp.Key), HttpUtility.UrlEncode(kvp.Value))).ToArray());
    }

    public static string ToQueryString(this NameValueCollection source)
    {
        return String.Join("&", source.Cast<string>().Select(key => String.Format("{0}={1}", HttpUtility.UrlEncode(key), HttpUtility.UrlEncode(source[key]))).ToArray());
    } 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2013-09-12T08:22:52.837

将此类添加到您的项目中

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

public class QueryStringBuilder
{
    private readonly List<KeyValuePair<string, object>> _list;

    public QueryStringBuilder()
    {
        _list = new List<KeyValuePair<string, object>>();
    }

    public void Add(string name, object value)
    {
        _list.Add(new KeyValuePair<string, object>(name, value));
    }

    public override string ToString()
    {
        return String.Join("&", _list.Select(kvp => String.Concat(Uri.EscapeDataString(kvp.Key), "=", Uri.EscapeDataString(kvp.Value.ToString()))));
    }
} 
```

并像这样使用它：

```
var actual = new QueryStringBuilder {
    {"foo", 123},
    {"bar", "val31"},
    {"bar", "val32"}
};

actual.Add("a+b", "c+d");

actual.ToString(); // "foo=123&bar=val31&bar=val32&a%2bb=c%2bd" 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2009-05-06T11:14:21.870

未经测试，但我认为这些方面的东西会很好地工作

```
public class QueryString
{
    private Dictionary<string,string> _Params = new Dictionary<string,string>();

    public overide ToString()
    {
        List<string> returnParams = new List<string>();

        foreach (KeyValuePair param in _Params)
        {
            returnParams.Add(String.Format("{0}={1}", param.Key, param.Value));
        }

        // return String.Format("?{0}", String.Join("&", returnParams.ToArray())); 

        // credit annakata
        return "?" + String.Join("&", returnParams.ToArray());
    }

    public void Add(string key, string value)
    {
        _Params.Add(key, HttpUtility.UrlEncode(value));
    }
}

QueryString query = new QueryString();

query.Add("param1", "value1");
query.Add("param2", "value2");

return query.ToString(); 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2013-12-10T10:47:50.530

我的提议：

```
public static Uri AddQuery(this Uri uri, string name, string value)
{
    // this actually returns HttpValueCollection : NameValueCollection
    // which uses unicode compliant encoding on ToString()
    var query = HttpUtility.ParseQueryString(uri.Query);

    query.Add(name, value);

    var uriBuilder = new UriBuilder(uri)
    {
        Query = query.ToString()
    };

    return uriBuilder.Uri;
} 
```

用法：

```
var uri = new Uri("http://stackoverflow.com").AddQuery("such", "method")
                                             .AddQuery("wow", "soFluent");

// http://stackoverflow.com?such=method&wow=soFluent 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2016-04-24T17:53:38.327

结合最重要的答案来创建一个**匿名对象版本**：

```
var queryString = HttpUtility2.BuildQueryString(new
{
    key2 = "value2",
    key1 = "value1",
}); 
```

这会产生：

> > 键2=值2&键1=值1

这是代码：

```
public static class HttpUtility2
{
    public static string BuildQueryString<T>(T obj)
    {
        var queryString = HttpUtility.ParseQueryString(string.Empty);

        foreach (var property in TypeDescriptor.GetProperties(typeof(T)).Cast<PropertyDescriptor>())
        {
            var value = (property.GetValue(obj) ?? "").ToString();
            queryString.Add(property.Name, value);
        }

        return queryString.ToString();
    }
} 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2019-10-23T14:53:56.003

在 dotnet 核心 QueryHelpers.AddQueryString() 将接受 IDictionary<string,string> 键值对。为了节省一些内存分配和 CPU 周期，您可以使用 SortedList<,> 而不是 Dictionary<,>，并具有适当的容量和按排序顺序添加的项目...

```
var queryParams = new SortedList<string,string>(2);
queryParams.Add("abc", "val1");
queryParams.Add("def", "val2");

string requestUri = QueryHelpers.AddQueryString("https://localhost/api", queryParams); 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-05-06T11:27:44.973

基于快速扩展方法的版本：

```
class Program
{
    static void Main(string[] args)
    {
        var parameters = new List<KeyValuePair<string, string>>
                             {
                                 new KeyValuePair<string, string>("A", "AValue"),
                                 new KeyValuePair<string, string>("B", "BValue")
                             };

        string output = "?" + string.Join("&", parameters.ConvertAll(param => param.ToQueryString()).ToArray());
    }
}

public static class KeyValueExtensions
{
    public static string ToQueryString(this KeyValuePair<string, string> obj)
    {
        return obj.Key + "=" + HttpUtility.UrlEncode(obj.Value);
    }
} 
```

您可以使用 where 子句来选择将哪些参数添加到字符串中。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-05-06T12:19:43.270

假设您想减少对其他程序集的依赖并保持简单，您可以执行以下操作：

```
var sb = new System.Text.StringBuilder();

sb.Append("a=" + HttpUtility.UrlEncode("TheValueOfA") + "&");
sb.Append("b=" + HttpUtility.UrlEncode("TheValueOfB") + "&");
sb.Append("c=" + HttpUtility.UrlEncode("TheValueOfC") + "&");
sb.Append("d=" + HttpUtility.UrlEncode("TheValueOfD") + "&");

sb.Remove(sb.Length-1, 1); // Remove the final '&'

string result = sb.ToString(); 
```

这也适用于循环。最终的 & 号删除需要在循环之外进行。

请注意，连接运算符用于提高可读性。与使用 StringBuilder 的成本相比，使用它的成本是最小的（我认为[Jeff Atwood](http://www.codinghorror.com/)在这个主题上发表了一些文章）。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2011-08-03T17:18:11.693

HttpValueCollection 的可链接包装类：

```
namespace System.Web.Mvc {
    public class QueryStringBuilder {
        private NameValueCollection collection;
        public QueryStringBuilder() {
            collection = System.Web.HttpUtility.ParseQueryString(string.Empty);
        }
        public QueryStringBuilder Add(string key, string value) {
            collection.Add(key, value);
            return this;
        }
        public QueryStringBuilder Remove(string key) {
            collection.Remove(key);
            return this;
        }
        public string this[string key] {
            get { return collection[key]; }
            set { collection[key] = value; }
        }
        public string ToString() {
            return collection.ToString();
        }
    }
} 
```

示例用法：

```
QueryStringBuilder parameters = new QueryStringBuilder()
    .Add("view", ViewBag.PageView)
    .Add("page", ViewBag.PageNumber)
    .Add("size", ViewBag.PageSize);
string queryString = parameters.ToString(); 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-08-23T15:54:36.153

[我有一个Uri](https://msdn.microsoft.com/en-us/library/system.uri)的扩展方法：

*   接受匿名对象：`uri.WithQuery(new { name = "value" })`
*   接受`string/string`对的集合（例如[Dictionary`2](https://msdn.microsoft.com/en-us/library/xfhwa508)）。
*   接受`string/object`对的集合（例如[RouteValueDictionary](https://msdn.microsoft.com/en-us/library/system.web.routing.routevaluedictionary)）。
*   接受[NameValueCollection](https://msdn.microsoft.com/en-us/library/system.collections.specialized.namevaluecollection)。
*   按键对查询值进行排序，以便相同的值产生相同的 URI。
*   每个键支持多个值，保留其原始顺序。

* * *

文档版本可以在[这里](https://gist.github.com/safakgur/10b8f8c4b3cf944968741b532b5e3c45#file-uriutils-withquery-cs)找到。

**扩展：**

```
public static Uri WithQuery(this Uri uri, object values)
{
    if (uri == null)
        throw new ArgumentNullException(nameof(uri));

    if (values != null)
    {
        var query = string.Join(
            "&", from p in ParseQueryValues(values)
                 where !string.IsNullOrWhiteSpace(p.Key)
                 let k = HttpUtility.UrlEncode(p.Key.Trim())
                 let v = HttpUtility.UrlEncode(p.Value)
                 orderby k
                 select string.IsNullOrEmpty(v) ? k : $"{k}={v}");

        if (query.Length != 0 || uri.Query.Length != 0)
            uri = new UriBuilder(uri) { Query = query }.Uri;
    }

    return uri;
} 
```

**查询解析器：**

```
private static IEnumerable<KeyValuePair<string, string>> ParseQueryValues(object values)
{
    // Check if a name/value collection.
    var nvc = values as NameValueCollection;
    if (nvc != null)
        return from key in nvc.AllKeys
               from val in nvc.GetValues(key)
               select new KeyValuePair<string, string>(key, val);

    // Check if a string/string dictionary.
    var ssd = values as IEnumerable<KeyValuePair<string, string>>;
    if (ssd != null)
        return ssd;

    // Check if a string/object dictionary.
    var sod = values as IEnumerable<KeyValuePair<string, object>>;
    if (sod == null)
    {
        // Check if a non-generic dictionary.
        var ngd = values as IDictionary;
        if (ngd != null)
            sod = ngd.Cast<dynamic>().ToDictionary<dynamic, string, object>(
                p => p.Key.ToString(), p => p.Value as object);

        // Convert object properties to dictionary.
        if (sod == null)
            sod = new RouteValueDictionary(values);
    }

    // Normalize and return the values.
    return from pair in sod
           from val in pair.Value as IEnumerable<string>
            ?? new[] { pair.Value?.ToString() }
           select new KeyValuePair<string, string>(pair.Key, val);
} 
```

* * *

以下是测试：

```
var uri = new Uri("https://stackoverflow.com/yo?oldKey=oldValue");

// Test with a string/string dictionary.
var q = uri.WithQuery(new Dictionary<string, string>
{
    ["k1"] = string.Empty,
    ["k2"] = null,
    ["k3"] = "v3"
});

Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?k1&k2&k3=v3"));

// Test with a string/object dictionary.
q = uri.WithQuery(new Dictionary<string, object>
{
    ["k1"] = "v1",
    ["k2"] = new[] { "v2a", "v2b" },
    ["k3"] = null
});

Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?k1=v1&k2=v2a&k2=v2b&k3"));

// Test with a name/value collection.
var nvc = new NameValueCollection()
{
    ["k1"] = string.Empty,
    ["k2"] = "v2a"
};

nvc.Add("k2", "v2b");

q = uri.WithQuery(nvc);
Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?k1&k2=v2a&k2=v2b"));

// Test with any dictionary.
q = uri.WithQuery(new Dictionary<int, HashSet<string>>
{
    [1] = new HashSet<string> { "v1" },
    [2] = new HashSet<string> { "v2a", "v2b" },
    [3] = null
});

Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?1=v1&2=v2a&2=v2b&3"));

// Test with an anonymous object.
q = uri.WithQuery(new
{
    k1 = "v1",
    k2 = new[] { "v2a", "v2b" },
    k3 = new List<string> { "v3" },
    k4 = true,
    k5 = null as Queue<string>
});

Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?k1=v1&k2=v2a&k2=v2b&k3=v3&k4=True&k5"));

// Keep existing query using a name/value collection.
nvc = HttpUtility.ParseQueryString(uri.Query);
nvc.Add("newKey", "newValue");

q = uri.WithQuery(nvc);
Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?newKey=newValue&oldKey=oldValue"));

// Merge two query objects using the RouteValueDictionary.
var an1 = new { k1 = "v1" };
var an2 = new { k2 = "v2" };

q = uri.WithQuery(
    new RouteValueDictionary(an1).Concat(
        new RouteValueDictionary(an2)));

Debug.Assert(q == new Uri(
    "https://stackoverflow.com/yo?k1=v1&k2=v2")); 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2021-08-05T13:03:14.957

这里有很多很好的答案，但对于那些使用现代 C# 的人来说，这可能是一个很好的实用程序类。

```
public class QueryParamBuilder
{
    private readonly Dictionary<string, string> _fields = new();
    public QueryParamBuilder Add(string key, string value)
    {
        _fields.Add(key, value);
        return this;
    }
    public string Build()
    {
        return $"?{String.Join("&", _fields.Select(pair => $"{HttpUtility.UrlEncode(pair.Key)}={HttpUtility.UrlEncode(pair.Value)}"))}";
    }
    public static QueryParamBuilder New => new();
} 
```

我在这里使用 internal`Dictionary`因为字典在内部是可枚举的键值对，这使得迭代它们比`NameValueCollection`.

那么查询字符串本身就是一个带有连接的简单插值字符串。

此外，我在构造函数中提供了一个静态接口，以使新构建器的构造变得非常容易，并且只允许一个公开的方法`Add`来添加新的查询参数值。最后，您终止链`Build()`以实际获得最终字符串。

这是它的用法示例

```
var queryString = QueryParamBuilder.New
     .Add("id", "0123")
     .Add("value2", 1234.ToString())
     .Add("valueWithSpace","value with spa12!@#@!ce")
     .Build(); 
```

结果如预期

```
?id=0123&value2=1234&valueWithSpace=value+with+spa12!%40%23%40!ce 
```

希望你们中的一些人会觉得这很好，很优雅。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2014-07-04T11:10:38.770

与公认的解决方案相同，但转换为“点”LINQ 语法...

```
private string ToQueryString(NameValueCollection nvc)
{
    if (nvc == null) return String.Empty;
    var queryParams = 
          string.Join("&", nvc.AllKeys.Select(key => 
              string.Join("&", nvc.GetValues(key).Select(v => string.Format("{0}={1}", HttpUtility.UrlEncode(key), HttpUtility.UrlEncode(v))))));
    return "?" + queryParams;
} 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-06-13T14:12:35.830

虽然不优雅，但我选择了一个不使用的更简单的版本`NameValueCollecitons`——只是一个围绕`StringBuilder`.

```
public class UrlBuilder
{
    #region Variables / Properties

    private readonly StringBuilder _builder;

    #endregion Variables / Properties

    #region Constructor

    public UrlBuilder(string urlBase)
    {
        _builder = new StringBuilder(urlBase);
    }

    #endregion Constructor

    #region Methods

    public UrlBuilder AppendParameter(string paramName, string value)
    {
        if (_builder.ToString().Contains("?"))
            _builder.Append("&");
        else
            _builder.Append("?");

        _builder.Append(HttpUtility.UrlEncode(paramName));
        _builder.Append("=");
        _builder.Append(HttpUtility.UrlEncode(value));

        return this;
    }

    public override string ToString()
    {
        return _builder.ToString();
    }

    #endregion Methods
} 
```

根据现有答案，我确保使用`HttpUtility.UrlEncode`电话。它是这样使用的：

```
string url = new UrlBuilder("http://www.somedomain.com/")
             .AppendParameter("a", "true")
             .AppendParameter("b", "muffin")
             .AppendParameter("c", "muffin button")
             .ToString();
// Result: http://www.somedomain.com?a=true&b=muffin&c=muffin%20button 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2019-11-10T16:14:12.800

可以通过以下方式将查询字符串添加到 URL：

1.  创建名称值集合对象
2.  将查询字符串项及其值添加到此对象
3.  将此名称值集合对象编码为 url 代码在以下链接中提供

[https://blog.codingnovice.com/blog](https://blog.codingnovice.com/blog)

```
public ActionResult Create()
{
    //declaring name value collection object
    NameValueCollection collection = new NameValueCollection();

    //adding new value to the name value collection object
    collection.Add("Id1", "wwe323");
    collection.Add("Id2", "454w");
    collection.Add("Id3", "tyt5656");
    collection.Add("Id4", "343wdsd");

    //generating query string
    string url = GenerateQueryString(collection);

    return View();
}

private string GenerateQueryString(NameValueCollection collection)
{
    var querystring = (
        from key in collection.AllKeys
        from value in collection.GetValues(key)
        select string.Format("{0}={1}",
            HttpUtility.UrlEncode(key),
            HttpUtility.UrlEncode(value))
    ).ToArray();
    return "?" + string.Join("&", querystring);
} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-05-06T13:34:58.583

我在我的 PageBase 类中添加了以下方法。

```
protected void Redirect(string url)
    {
        Response.Redirect(url);
    }
protected void Redirect(string url, NameValueCollection querystrings)
    {
        StringBuilder redirectUrl = new StringBuilder(url);

        if (querystrings != null)
        {
            for (int index = 0; index < querystrings.Count; index++)
            {
                if (index == 0)
                {
                    redirectUrl.Append("?");
                }

                redirectUrl.Append(querystrings.Keys[index]);
                redirectUrl.Append("=");
                redirectUrl.Append(HttpUtility.UrlEncode(querystrings[index]));

                if (index < querystrings.Count - 1)
                {
                    redirectUrl.Append("&");
                }
            }
        }

        this.Redirect(redirectUrl.ToString());
    } 
```

致电：

```
NameValueCollection querystrings = new NameValueCollection();    
querystrings.Add("language", "en");
querystrings.Add("id", "134");
this.Redirect("http://www.mypage.com", querystrings); 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2013-11-12T23:22:22.130

只是想投入我的 2 美分：

```
public static class HttpClientExt
{
    public static Uri AddQueryParams(this Uri uri, string query)
    {
        var ub = new UriBuilder(uri);
        ub.Query = string.IsNullOrEmpty(uri.Query) ? query : string.Join("&", uri.Query.Substring(1), query);
        return ub.Uri;
    }

    public static Uri AddQueryParams(this Uri uri, IEnumerable<string> query)
    {
        return uri.AddQueryParams(string.Join("&", query));
    } 

    public static Uri AddQueryParams(this Uri uri, string key, string value)
    {
        return uri.AddQueryParams(string.Join("=", HttpUtility.UrlEncode(key), HttpUtility.UrlEncode(value)));
    }

    public static Uri AddQueryParams(this Uri uri, params KeyValuePair<string,string>[] kvps)
    {
        return uri.AddQueryParams(kvps.Select(kvp => string.Join("=", HttpUtility.UrlEncode(kvp.Key), HttpUtility.UrlEncode(kvp.Value))));
    }

    public static Uri AddQueryParams(this Uri uri, IDictionary<string, string> kvps)
    {
        return uri.AddQueryParams(kvps.Select(kvp => string.Join("=", HttpUtility.UrlEncode(kvp.Key), HttpUtility.UrlEncode(kvp.Value))));
    }

    public static Uri AddQueryParams(this Uri uri, NameValueCollection nvc)
    {
        return uri.AddQueryParams(nvc.AllKeys.SelectMany(nvc.GetValues, (key, value) => string.Join("=", HttpUtility.UrlEncode(key), HttpUtility.UrlEncode(value))));
    }
} 
```

[文档](http://msdn.microsoft.com/en-us/library/system.uribuilder.query%28v=vs.110%29.aspx)说如果它不是空的，`uri.Query`它将以 a 开头，`?`如果你要修改它，你应该把它剪掉。

请注意，`HttpUtility.UrlEncode`在`System.Web`.

**用法：**

```
var uri = new Uri("https://api.del.icio.us/v1/posts/suggest").AddQueryParam("url","http://stackoverflow.com") 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2012-03-18T20:38:19.773

我编写了一些扩展方法，我发现这些方法在使用 QueryStrings 时非常有用。通常我想从当前的 QueryString 开始并在使用它之前进行修改。就像是，

```
var res = Request.QueryString.Duplicate()
  .ChangeField("field1", "somevalue")
  .ChangeField("field2", "only if following is true", true)
  .ChangeField("id", id, id>0)
  .WriteLocalPathWithQuery(Request.Url)); //Uses context to write the path 
```

更多信息和来源： http: [//www.charlesrcook.com/archive/2008/07/23/c-extension-methods-for-asp.net-query-string-operations.aspx](http://www.charlesrcook.com/archive/2008/07/23/c-extension-methods-for-asp.net-query-string-operations.aspx)

这是基本的，但我喜欢这种风格。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2017-09-12T20:06:20.417

我采用了 DSO 提出的解决方案（2011 年 8 月 2 日 7:29 回答），他的解决方案不需要使用 HttpUtility。但是，根据[Dotnetpearls](https://www.dotnetperls.com/namevaluecollection)中发布的一篇文章，使用 Dictionary 比使用 NameValueCollection 更快（在性能上）。这是修改为使用 Dictionary 代替 NameValueCollection 的 DSO 解决方案。

```
 public static Dictionary<string, string> QueryParametersDictionary()
    {
        var dictionary = new Dictionary<string, string>();
        dictionary.Add("name", "John Doe");
        dictionary.Add("address.city", "Seattle");
        dictionary.Add("address.state_code", "WA");
        dictionary.Add("api_key", "5352345263456345635");

        return dictionary;
    }

    public static string ToQueryString(Dictionary<string, string> nvc)
    {
        StringBuilder sb = new StringBuilder();

        bool first = true;

        foreach (KeyValuePair<string, string> pair in nvc)
        {
                if (!first)
                {
                    sb.Append("&");
                }

                sb.AppendFormat("{0}={1}", Uri.EscapeDataString(pair.Key), Uri.EscapeDataString(pair.Value));

                first = false;
        }

        return sb.ToString();
    } 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-06-22T14:24:45.730

```
// USAGE
[TestMethod]
public void TestUrlBuilder()
{
    Console.WriteLine(
        new UrlBuilder("http://www.google.com?A=B")
            .AddPath("SomePathName")
            .AddPath("AnotherPathName")
            .SetQuery("SomeQueryKey", "SomeQueryValue")
            .AlterQuery("A", x => x + "C"));
} 
```

输出：

> [http://www.google.com/SomePathName/AnotherPathName?A=BC&SomeQueryKey=SomeQueryValue](http://www.google.com/SomePathName/AnotherPathName?A=BC&SomeQueryKey=SomeQueryValue)

编码; 你们都可以在某个地方感谢我，不知何故：D

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

// By Demetris Leptos
namespace TheOperator.Foundation.Web
{
    public class UrlBuilder
    {
        public string Scheme { get; set; }

        public string Host { get; set; }

        public int? Port { get; set; }

        public List<string> Paths { get; set; }

        public SortedDictionary<string, string> QueryPairs { get; set; }

        public UrlBuilder(string url)
        {
            this.Paths = new List<string>();
            this.QueryPairs = new SortedDictionary<string, string>();

            string path = null;
            string query = null;
            Uri relativeUri = null;
            if (!Uri.TryCreate(url, UriKind.Relative, out relativeUri))
            {
                var uriBuilder = new UriBuilder(url);
                this.Scheme = uriBuilder.Scheme;
                this.Host = uriBuilder.Host;
                this.Port = uriBuilder.Port;
                path = uriBuilder.Path;
                query = uriBuilder.Query;
            }
            else
            {
                var queryIndex = url.IndexOf('?');
                if (queryIndex >= 0)
                {
                    path = url.Substring(0, queryIndex);
                    query = url.Substring(queryIndex + 1);
                }
                else
                {
                    path = url;
                }
            }
            this.Paths.AddRange(path.Split(new char[] { '/' }, StringSplitOptions.RemoveEmptyEntries));
            if (query != null)
            {
                var queryKeyValuePairs = HttpUtility.ParseQueryString(query);
                foreach (var queryKey in queryKeyValuePairs.AllKeys)
                {
                    this.QueryPairs[queryKey] = queryKeyValuePairs[queryKey];
                }
            }
        }

        public UrlBuilder AddPath(string value)
        {
            this.Paths.Add(value);
            return this;
        }

        public UrlBuilder SetQuery(string key, string value)
        {
            this.QueryPairs[key] = value;
            return this;
        }

        public UrlBuilder RemoveQuery(string key)
        {
            this.QueryPairs.Remove(key);
            return this;
        }

        public UrlBuilder AlterQuery(string key, Func<string, string> alterMethod, bool removeOnNull = false)
        {
            string value;
            this.QueryPairs.TryGetValue(key, out value);
            value = alterMethod(value);
            if (removeOnNull && value == null)
            {
                return this.RemoveQuery(key);
            }
            else
            {
                return this.SetQuery(key, value);
            }
        }

        public override string ToString()
        {
            var path = !string.IsNullOrWhiteSpace(this.Host)
                ? string.Join("/", this.Host, string.Join("/", this.Paths))
                : string.Join("/", this.Paths);
            var query = string.Join("&", this.QueryPairs.Select(x => string.Concat(x.Key, "=", HttpUtility.UrlEncode(x.Value))));
            return string.Concat(
                !string.IsNullOrWhiteSpace(this.Scheme) ? string.Concat(this.Scheme, "://") : null,
                path,
                !string.IsNullOrWhiteSpace(query) ? string.Concat("?", query) : null);
        }
    }
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2013-05-29T00:12:29.500

这与接受的答案相同，只是稍微紧凑一些：

```
private string ToQueryString(NameValueCollection nvc)
{
    return "?" + string.Join("&", nvc.AllKeys.Select(k => string.Format("{0}={1}", 
        HttpUtility.UrlEncode(k), 
        HttpUtility.UrlEncode(nvc[k]))));
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2012-07-28T19:19:55.807

下面的代码是通过 ILSpy`HttpValueCollection`实现的`ToString`，它为您提供了一个 name=value 查询字符串。

不幸的是 HttpValueCollection 是一个内部类，只有在使用`HttpUtility.ParseQueryString()`. 我删除了它的所有视图状态部分，它默认编码：

```
public static class HttpExtensions
{
    public static string ToQueryString(this NameValueCollection collection)
    {
        // This is based off the NameValueCollection.ToString() implementation
        int count = collection.Count;
        if (count == 0)
            return string.Empty;

        StringBuilder stringBuilder = new StringBuilder();

        for (int i = 0; i < count; i++)
        {
            string text = collection.GetKey(i);
            text = HttpUtility.UrlEncodeUnicode(text);
            string value = (text != null) ? (text + "=") : string.Empty;
            string[] values = collection.GetValues(i);
            if (stringBuilder.Length > 0)
            {
                stringBuilder.Append('&');
            }
            if (values == null || values.Length == 0)
            {
                stringBuilder.Append(value);
            }
            else
            {
                if (values.Length == 1)
                {
                    stringBuilder.Append(value);
                    string text2 = values[0];
                    text2 = HttpUtility.UrlEncodeUnicode(text2);
                    stringBuilder.Append(text2);
                }
                else
                {
                    for (int j = 0; j < values.Length; j++)
                    {
                        if (j > 0)
                        {
                            stringBuilder.Append('&');
                        }
                        stringBuilder.Append(value);
                        string text2 = values[j];
                        text2 = HttpUtility.UrlEncodeUnicode(text2);
                        stringBuilder.Append(text2);
                    }
                }
            }
        }

        return stringBuilder.ToString();
    }
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2013-06-07T09:07:32.280

仅适用于那些需要最佳答案的 VB.NET 版本的人：

```
Public Function ToQueryString(nvc As System.Collections.Specialized.NameValueCollection) As String
    Dim array As String() = nvc.AllKeys.SelectMany(Function(key As String) nvc.GetValues(key), Function(key As String, value As String) String.Format("{0}={1}", System.Web.HttpUtility.UrlEncode(key), System.Web.HttpUtility.UrlEncode(value))).ToArray()
    Return "?" + String.Join("&", array)
End Function 
```

没有 LINQ 的版本：

```
Public Function ToQueryString(nvc As System.Collections.Specialized.NameValueCollection) As String
    Dim lsParams As New List(Of String)()

    For Each strKey As String In nvc.AllKeys
        Dim astrValue As String() = nvc.GetValues(strKey)

        For Each strValue As String In astrValue
            lsParams.Add(String.Format("{0}={1}", System.Web.HttpUtility.UrlEncode(strKey), System.Web.HttpUtility.UrlEncode(strValue)))
        Next ' Next strValue
    Next ' strKey
    Dim astrParams As String() = lsParams.ToArray()
    lsParams.Clear()
    lsParams = Nothing

    Return "?" + String.Join("&", astrParams)
End Function ' ToQueryString 
```

没有 LINQ 的 C# 版本：

```
 public static string ToQueryString(System.Collections.Specialized.NameValueCollection nvc)
    {
        List<string> lsParams = new List<string>();

        foreach (string strKey in nvc.AllKeys)
        {
            string[] astrValue = nvc.GetValues(strKey);

            foreach (string strValue in astrValue)
            {
                lsParams.Add(string.Format("{0}={1}", System.Web.HttpUtility.UrlEncode(strKey), System.Web.HttpUtility.UrlEncode(strValue)));
            } // Next strValue

        } // Next strKey

        string[] astrParams =lsParams.ToArray();
        lsParams.Clear();
        lsParams = null;

        return "?" + string.Join("&", astrParams);
    } // End Function ToQueryString 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2011-10-11T08:26:04.410

我使用其他答案中的一些提示为我的剃须刀项目编写了一个助手。

ParseQueryString 业务是必要的，因为我们不允许篡改当前请求的 QueryString 对象。

```
@helper GetQueryStringWithValue(string key, string value) {
    var queryString = System.Web.HttpUtility.ParseQueryString(HttpContext.Current.Request.QueryString.ToString());
    queryString[key] = value;
    @Html.Raw(queryString.ToString())
} 
```

我这样使用它：

```
location.search = '?@Helpers.GetQueryStringWithValue("var-name", "var-value")'; 
```

如果您希望它采用多个值，只需将参数更改为 Dictionary 并将对添加到查询字符串中。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2014-04-21T19:29:36.397

适用于 NameValueCollection 中每个键的多个值。

例如：`{ {"k1", "v1"}, {"k1", "v1"} }`=>`?k1=v1&k1=v1`

```
/// <summary>
/// Get query string for name value collection.
/// </summary>
public static string ToQueryString(this NameValueCollection collection,
    bool prefixQuestionMark = true)
{
    collection.NullArgumentCheck();
    if (collection.Keys.Count == 0)
    {
        return "";
    }
    var buffer = new StringBuilder();
    if (prefixQuestionMark)
    {
        buffer.Append("?");
    }
    var append = false;
    for (int i = 0; i < collection.Keys.Count; i++)
    {
        var key = collection.Keys[i];
        var values = collection.GetValues(key);
        key.NullCheck();
        values.NullCheck();
        foreach (var value in values)
        {
            if (append)
            {
                buffer.Append("&");
            }
            append = true;
            buffer.AppendFormat("{0}={1}", key.UrlEncode(), value.UrlEncode());
        }
    }
    return buffer.ToString();
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-09-20T06:15:24.163

另一种方法是创建返回完整 Url 的类 NameValueCollection 的扩展：

```
public static class CustomMethods
{
    public static string ToUrl(this System.Collections.Specialized.NameValueCollection collection)
    {
        if (collection.Count == 0) return "";

        string completeUrl = "?";
        for (int i = 0; i < collection.Count; i++)
        {
            completeUrl += new Page().Server.UrlEncode(collection.GetKey(i)) + "=" + new Page().Server.UrlEncode(collection.Get(i));
            if ((i + 1) < collection.Count) completeUrl += "&";
        }

        return completeUrl;
    }
} 
```

然后，您可以使用您的新方法，例如：

```
System.Collections.Specialized.NameValueCollection qString = new System.Collections.Specialized.NameValueCollection();
qString.Add("name", "MyName");
qString.Add("email", "myemail@test.com");
qString.ToUrl(); //Result: "?name=MyName&email=myemail%40test.com" 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2016-04-06T10:01:02.443

这是另一种（**可能是多余的:-]**）方法。

概念与此页面中的[**Vedran**](https://stackoverflow.com/users/769137/vedran)答案相同（请看[这里](https://stackoverflow.com/a/10836145/1401886)）。

但是这个类更高效，因为它只遍历所有 Key 一次：when`ToString`被调用。

格式化代码也被简化和改进。

希望这会有所帮助。

```
public sealed class QueryStringBuilder
{
    public QueryStringBuilder()
    {
        this.inner = HttpUtility.ParseQueryString(string.Empty);
    }

    public QueryStringBuilder(string queryString)
    {
        this.inner = HttpUtility.ParseQueryString(queryString);
    }

    public QueryStringBuilder(string queryString, Encoding encoding)
    {
        this.inner = HttpUtility.ParseQueryString(queryString, encoding);
    }

    private readonly NameValueCollection inner;

    public QueryStringBuilder AddKey(string key, string value)
    {
        this.inner.Add(key, value);
        return this;
    }

    public QueryStringBuilder RemoveKey(string key)
    {
        this.inner.Remove(key);
        return this;
    }

    public QueryStringBuilder Clear()
    {
        this.inner.Clear();
        return this;
    }

    public override String ToString()
    {
        if (this.inner.Count == 0)
            return string.Empty;

        var builder = new StringBuilder();

        for (int i = 0; i < this.inner.Count; i++)
        {
            if (builder.Length > 0)
                builder.Append('&');

            var key = this.inner.GetKey(i);
            var values = this.inner.GetValues(i);

            if (key == null || values == null || values.Length == 0)
                continue;

            for (int j = 0; j < values.Length; j++)
            {
                if (j > 0)
                    builder.Append('&');

                builder.Append(HttpUtility.UrlEncode(key));
                builder.Append('=');
                builder.Append(HttpUtility.UrlEncode(values[j]));
            }
        }

        return builder.ToString();
    }
} 
```

* * *

## 回答 #37

> 赞同：-2
> 
> 时间：2010-01-22T23:37:27.267

这是一个使用非常基本的语言特性的实现。它是我们必须在 Objective C 中移植和维护的类的一部分，因此我们选择拥有更多的代码行，但更容易被不太熟悉 C# 的程序员移植和理解。

```
 /// <summary>
        /// Builds a complete http url with query strings.
        /// </summary>
        /// <param name="pHostname"></param>
        /// <param name="pPort"></param>
        /// <param name="pPage">ex "/index.html" or index.html</param>
        /// <param name="pGetParams">a Dictionary<string,string> collection containing the key value pairs.  Pass null if there are none.</param>
        /// <returns>a string of the form: http://[pHostname]:[pPort/[pPage]?key1=val1&key2=val2...</returns>

  static public string buildURL(string pHostname, int pPort, string pPage, Dictionary<string,string> pGetParams)
        {
            StringBuilder sb = new StringBuilder(200);
            sb.Append("http://");
            sb.Append(pHostname);
            if( pPort != 80 ) {
                sb.Append(pPort);
            }
            // Allows page param to be passed in with or without leading slash.
            if( !pPage.StartsWith("/") ) {
                sb.Append("/");
            }
            sb.Append(pPage);

            if (pGetParams != null && pGetParams.Count > 0)
            {
                sb.Append("?");
                foreach (KeyValuePair<string, string> kvp in pGetParams)
                {
                    sb.Append(kvp.Key);
                    sb.Append("=");
                    sb.Append( System.Web.HttpUtility.UrlEncode(kvp.Value) );
                    sb.Append("&");
                }
                sb.Remove(sb.Length - 1, 1); // Remove the final '&'
            }
            return sb.ToString();
        } 
```

* * *

## 回答 #38

> 赞同：-3
> 
> 时间：2010-02-15T19:39:38.553

```
public string UrlQueryStr(object data)
{
    if (data == null)
        return string.Empty;

    object val;
    StringBuilder sb = new StringBuilder();

    foreach (PropertyDescriptor prop in TypeDescriptor.GetProperties(data))
    {
        if ((val = prop.GetValue(data)) != null)
        {
            sb.AppendFormat("{0}{1}={2}", sb.Length == 0 ? '?' : '&',
                HttpUtility.UrlEncode(prop.Name), HttpUtility.UrlEncode(val.ToString()));
        }
    }
    return sb.ToString();
} 
```

* * *

## 回答 #39

> 赞同：-6
> 
> 时间：2009-05-06T11:27:30.823

编辑 - 正如评论中指出的那样，这不是要走的路。

有这样一个类——URI 类。“提供统一资源标识符 (URI) 的对象表示，并轻松访问 URI 的各个部分。” （微软文档）。

以下示例创建 Uri 类的实例并使用它来创建 WebRequest 实例。

C# 示例

Uri siteUri = new Uri(" [http://www.contoso.com/](http://www.contoso.com/) ");

WebRequest wr = WebRequest.Create(siteUri);

看看吧，这个类有很多方法。

# c# - .Net：从多个摄像头捕获视频到flv的方法应该是什么

> ID：829085
> 
> 赞同：0
> 
> 时间：2009-05-06T11:04:22.330
> 
> 标签：c#, .net, flv, webcam, video-capture

我想创建一个应用程序，它将网络摄像头作为输入并将捕获的视频保存为 flv 文件。

我正在查看 Adob​​e 的 Flash Live Media Encoder，但它没有 API，但有一个用于编码的命令行工具。

请建议我可以考虑的其他一些替代方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T11:08:44.567

查看 OpenCV ( [http://opencv.willowgarage.com/wiki/](http://opencv.willowgarage.com/wiki/) ) 和 VLC ( [http://www.videolan.org/vlc/](http://www.videolan.org/vlc/) )。

更新：我将 OpenCV 的这个端口用于 C# [http://www.emgu.com/wiki/index.php/OpenCV](http://www.emgu.com/wiki/index.php/OpenCV)

# c# - 使用 WebService 自动捕获所有未处理的异常

> ID：829086
> 
> 赞同：5
> 
> 时间：2009-05-06T11:04:25.853
> 
> 标签：c#, exception, capture

我有一个 C# WebService 应用程序，我想在其中捕获从应用程序抛出的所有未处理的异常。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T11:12:18.487

由于某种原因，Web 服务不会触发 Application_Error 事件（请参阅[其他问题](https://stackoverflow.com/questions/211530/why-global-asax-applicationerror-method-does-not-catch-exceptions-thrown-by-asmx)）。Jeff Atwood 先生本人[在编码恐怖博客上](http://www.codinghorror.com/blog/archives/000054.html)发表了一些建议。

他写：

> * 对每个 WebService 方法进行 try..catch。这些方法往往是其他类的包装器，所以这并不像听起来那么糟糕，但它仍然不是很好。
> * 使用 Facade 设计模式从父对象派生所有对象......基本上对 .Execute 方法执行 try..catch。嗯，谢谢，但不，谢谢。
> * 编写自定义 SOAP 扩展或 HttpModule。这听起来很合理，但……很难。如果它是一个很酷、很重要的扩展或 HttpModule，难道不是已经有人写了吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T11:12:31.093

一种方法是订阅处理程序`AppDomain.UnhandledException`中某处的事件`App_Start`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-11T23:24:55.880

也许是面向方面的方法的工作。一些例子;

[PostSharp](http://www.sharpcrafters.com/solutions/monitoring)

[春天网](http://www.springframework.net/doc-latest/reference/html/aop.html)

# sql - 如何调用用户定义函数以与 select、group by、order by 一起使用？

> ID：829089
> 
> 赞同：11
> 
> 时间：2009-05-06T11:05:19.003
> 
> 标签：sql, sql-server, sql-server-2005

我有 Table1，我需要让它看起来像 Table2：

### 表格1

```
VisitingCount |  Date
-----------------------
      1       |  15:09
      3       |  15:10
      7       |  15:15
      1       |  15:39
      2       |  15:40
      3       |  15:47 
```

### 表2

```
VisitingCount |  Date
-----------------------------
     11       |  15:00-15:30
     6        |  15:30-16:00 
```

我写了一个这样的sql用户定义函数：

```
create FUNCTION [dbo].[fn_GetActivityLogsArranger] (@time AS nvarchar(max))
RETURNS nvarchar(max)
AS
BEGIN
    declare @Return varchar(30)

    select @Return = 
        case 
            when @time between '15:00' and '15:30' then '15:00-15:30'
            when @time between '15:30' and '16:00' then '15:30-16:00'
            when @time between '16:00' and '16:30' then '16:00-16:30'
            when @time between '16:00' and '16:30' then '16:00-16:30' 
            when @time between '16:30' and '17:00' then '16:30-17:00' 
            when @time between '17:00' and '17:30' then '17:00-17:30' 
            when @time between '17:30' and '18:00' then '17:30-18:00'
            else 'Unknown'
        end

    return @Return
end 
```

在我的 sql 查询中调用 UDF 时，我得到了正确的结果：

```
select 
        Count(Page) as VisitingCount,
        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108))
            as [Time] 
    from 
        scr_SecuristLog     
    where 
        Date between '2009-04-30' and '2009-05-02' AND
        [user] in
        (
            select USERNAME               
            from scr_CustomerAuthorities 
            where customerID = Convert(varchar,4) and ID = Convert(varchar,43) 
        )    
    group by 
        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108))
    order by 
        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108)) asc 
```

但我不喜欢这种方法；我的梦想代码如下所示：

```
select 
        Count(Page) as VisitingCount,
        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108))
            as **[TIME]**
    from 
        scr_SecuristLog     
    where 
        Date between '2009-04-30' and '2009-05-02' and 
        user] in
        (
            select USERNAME               
            from scr_CustomerAuthorities 
            where customerID = Convert(varchar,4) and ID = Convert(varchar,43) 
        )    
    group by **[TIME]** 
    order by **[TIME]** asc 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T11:13:01.327

您可以像视图一样加入您的表格并在那里调用您的函数。这样，您可以在视图中的列上调用 group by 和 order by。

```
select
    Count(Page) as VisitingCount,
    [Time]
from
(
    SELECT
        Page,
        Date,
        [user],
        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108)) as [Time]
    FROM
        scr_SecuristLog
) scr_SecuristLog2
where
    Date between '2009-04-30' and '2009-05-02'
and
    [user] in
(
    select
        USERNAME
    from
     scr_CustomerAuthorities
    where
        customerID=Convert(varchar,4)
    and
        ID=Convert(varchar,43)
)
group by
    [Time]
order by
    [Time] asc 
```

# visual-studio - Windows 7 RC (boot camp) 和 Visual Studio 2008 安装问题

> ID：829094
> 
> 赞同：-3
> 
> 时间：2009-05-06T11:07:45.113
> 
> 标签：visual-studio, windows-7, bootcamp

我在训练营的 MacBook Air 上有一个 Windows 7 RC。一切都很好，除了 VS 2008 不会安装在系统上。它抱怨 Setup.exe 无效。奇怪的是，Visual Studio Express Edition SP1 安装正常。

我曾经在 Parallels 上安装过 Win7 Beta，并且安装成功。

有任何想法吗？

绒球

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T11:26:00.420

Macbook Air 没有 CD，对吧？通过网络复制或保存到 HDD 时，您的安装文件可能会损坏。尝试创建安装版ISO镜像，复制到MacBook并检查两边的MD5。如果它们匹配，安装 ISO 并继续安装。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-19T22:58:36.287

你的VS2008是SP1还是不是？

我在 Windows 7 RC1 上使用 VS2008 SP1 从来没有遇到过问题，即使我使用的是 Windows 7，它也是 beta 阶段（刚发布时）。

我确实在 windows7 上运行某些程序时遇到问题，但 VS2008 不是其中之一。

# iis - 用于测试 IIS 服务器的 VMWare

> ID：829099
> 
> 赞同：1
> 
> 时间：2009-05-06T11:11:47.227
> 
> 标签：iis, vmware-server

我想知道是否有人可以提供帮助。我想在 VMWare 服务器上运行 IIS，但我希望能够使用 PC 上的浏览​​器访问其上的 IIS 服务器。

谁能告诉我这是否可能？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T11:17:11.660

是的，如果您为虚拟服务器设置主机连接，这是可能的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:17:16.010

我使用 WinXP 中的浏览器在 Ubuntu 上使用 Apache 测试了 VM，所以这是可能的。简单检查您从 VMware 获得的 IP 地址（例如使用 ipconfig）。我在设备配置中设置了“以太网：仅限主机”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-14T12:00:25.027

要从网络访问 IIS，您需要为 VirtualBox 进行端口转发。请按照以下说明操作：[http ://www.thecrumb.com/2009/12/08/alternate-virtualbox-port-forwarding-method/](http://www.thecrumb.com/2009/12/08/alternate-virtualbox-port-forwarding-method/)

# eclipse - Eclipse RCP 应用程序中的内存泄漏

> ID：829105
> 
> 赞同：3
> 
> 时间：2009-05-06T11:13:00.687
> 
> 标签：eclipse, memory-leaks, rcp

如何检测 Eclipse RCP 应用程序中的内存泄漏？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T21:18:15.613

[您可能想尝试使用JRockit Mission Control](http://www.oracle.com/technology/products/jrockit/missioncontrol/index.html)和[Eclipse MAT](http://www.eclipse.org/mat/)附带的 Memory Leak Detector 。这是一个强大的组合。这两种工具都可以免费用于开发。

使用 JRockit Mission Control，您可以在线检查堆并查看特定类型的活动对象的确切数量，而无需拍摄耗时的快照。关闭视图/编辑器后，您可以直接查看是否有一个编辑器、视图或侦听器对象留在堆上。它通常是一个框架侦听器，可以保留您的视图/编辑器。请记住，您必须转到 Windows->Preferences->Memory Leak Detector->Trend 并将*Lowest Heap Usage*设置为 0.0 以查看所有对象实例。

[![替代文字](https://i.stack.imgur.com/DSVtH.gif)](https://i.stack.imgur.com/DSVtH.gif)
[（来源：[oracle.com](http://download.oracle.com/docs/cd/E11035_01/jrockit/intro/wwimages/memleak2.gif)）]

使用 MAT，您可以使用到线程根的最短路径来查找持有泄漏对象的链。见下文

[替代文本 http://dev.eclipse.org/blogs/memoryanalyzer/files/2008/04/path2gc_all.png](http://dev.eclipse.org/blogs/memoryanalyzer/files/2008/04/path2gc_all.png)

修改您的代码并使用内存泄漏检测器验证在您关闭编辑器/视图时该对象已被垃圾回收。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T13:46:28.773

您需要某种分析工具。

eclipse ( [wiki](http://wiki.eclipse.org/index.php/MemoryAnalyzer) , [blog](http://dev.eclipse.org/blogs/memoryanalyzer/2008/04/21/immortal-objects-or-how-to-find-memory-leaks/) )上有一个[Memory Analyzer项目。](http://www.eclipse.org/mat/)

此外，看起来[TPTP](http://wiki.eclipse.org/Profiling_with_TPTP_-_plug-in_developmeet)也可以进行分析。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T21:36:48.707

Java JDK 附带最简单的解决方案：Java VisualVM。

自 JDK 6 更新 7 起，它就位于 bin 目录（Windows 下的 jvisualvm.exe）中。

还包括一个内存分析器、一个堆遍历器和一个[Eclipse 集成](https://visualvm.dev.java.net/eclipse-launcher.html)。

[https://visualvm.dev.java.net/images/getstarted/vvm-anagram-profiler.png](https://visualvm.dev.java.net/images/getstarted/vvm-anagram-profiler.png)（太糟糕了，我不允许使用图像标签）

见[https://visualvm.dev.java.net/](https://visualvm.dev.java.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T13:54:43.027

如果您在 Windows 上，最简单的方法就是在使用该工具时在任务管理器中监视例如 eclipse.exe 进程。如果您的 RCP 可执行文件具有不同的名称，那么这就是您需要监控的内容。在 Unix 上，您可以使用类似的工具（可能是 proc？）。

执行可用的最密集的任务（或者如果您怀疑某些功能会导致问题，请使用这些功能）。如果 eclipse.exe 使用的内存量在您完成密集任务后最终没有减少，那么您可能有泄漏。这最终会导致内存不足错误。

您可以通过 eclipse.ini（或 .ini）中的“-Xmx”设置减少应用程序可用的内存量来加速内存不足错误。例如 -Xmx256m 表示最大 256 MB 可用。显然，此设置仍然需要足以运行您的应用程序，但较低的设置将强制更频繁的垃圾收集并使泄漏更加明显。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T20:53:44.580

您需要一个内存分析器（正如其他人提到的那样。）一旦您拥有了一个好的工具，您就可以很容易地找到问题。

我们使用： [http ://www.yourkit.com/](http://www.yourkit.com/)

对于我们的测试，它运行良好，具有浮动许可证，因此开发人员可以在他们的机器上本地使用它。

基本上，您对正在执行的操作进行快照，然后查看已分配但未释放的项目。

编辑：我忘了补充，这个工具直接集成到 eclipse 中。

# jquery - jQuery 循环

> ID：829112
> 
> 赞同：3
> 
> 时间：2009-05-06T11:15:34.893
> 
> 标签：jquery

我有几个带有 class='CCC' 的 Div。我想使用 jQuery 将所有这些 div 放入一个数组中，然后遍历该数组。怎么做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T11:18:14.387

使用 Each() 函数：

```
$(".CCC").each(function(i){
   alert(this.id + " is the " + i + "th div with this class");
 }); 
```

[http://docs.jquery.com/Each](http://docs.jquery.com/Each)

**编辑：**

按照要求：

```
function LoopTroughDivs(selector){
  $(selector).each(function(i){
   alert(this.id + " is the " + i + "th div with this class");
 });
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T11:34:19.607

```
// get an array of the divs (will act like one anyway)
var divs = $('div.CCC');

// do something for each div
divs.each(function() {
   // this refers to the current div as we loop through       
   doSomethingWith(this);
});

// or call your method on the array
LoopThroughDivs(divs); 
```

或者，这些可以写成一个语句（如果你只想做其中一个）：

```
$('div.CCC').each(function() {
   // this refers to the current div as we loop through       
   doSomethingWith(this);
});

LoopThroughDivs($('div.CCC')); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T11:27:40.213

看起来像这样：

```
LoopThroughDivs($('.CCC')); 
```

说真的，这就是全部。您可以将 jQuery 列表用作数组。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-06T11:32:46.253

如果你想把它放在一个数组中：

```
 var divArray = new Array();
 $('.CCC').each( function() { divArray.push(this); }); //add each div to array
 //loop over array
 for(i=0, x=divArray.length, i<x, i++){
  //divArray[i] refers to dom object, so you need to use a jquery wrapper
  //for the jquery functions: 
  $(divArray[i]).animate('height', '100px').html("I'm div the "+i+'th div');
 } 
```

但是请注意，jQuery 对象本身是一个数组，因此您也可以这样做：

```
 for(i=0, x=$('.CCC').length, i<x, i++){
  $('.CCC')[i].animate('height', '100px').html("I'm div the "+i+'th div');
 } 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-06T11:33:13.197

循环每个元素并将其放入您的数组中。

```
var yourArray = new Array();
$(".CCC").each(function(index, element){
    yourArray[i]=element;
 });

Loopthroughdivss(yourArray); 
```

# c# - 使用组合而不是继承的装饰器模式

> ID：829114
> 
> 赞同：0
> 
> 时间：2009-05-06T11:16:12.910
> 
> 标签：c#, design-patterns, decorator, composition

我之前对装饰器模式的理解是，你继承`Window`with ，然后在被覆盖的方法中，在调用' 实现上述方法`WindowDecorator`之前做一些额外的工作。`Window`类似于以下内容：

```
public class Window
{
    public virtual void Open()
    {
        // Open the window
    }
}

public class LockableWindow : Window // Decorator
{
    public virtual void Open()
    {
        // Unlock the window
        base.Open();
    }
} 
```

然而，这本质上是对装饰进行硬编码，那么如何将其重构为使用组合而不是继承呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T11:32:41.810

抱歉，我的 C# 有点（好吧，非常）生锈，所以可能会有一些语法错误，但基本思路是正确的。

```
public interface IWindow
{
    void Open();
}

public class Window : IWindow
{
    public virtual void Open()
    {
        // Open the window
    }
}

public class LockableWindow : IWindow
{
    private IWindow _wrappedWindow;

    public LockableWindow(IWindow wrappedWindow)
    {
        _wrappedWindow = wrappedWindow;
    }

    public virtual void Open()
    {
        // TODO Unlock window if necessary
        _wrappedWindow.open();
    }
} 
```

需要注意的关键是新`IWindow`界面；这就是允许您继续使用多态性的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T11:21:28.513

装饰器模式的重点是以对调用者透明的方式增强具有某些功能的对象（例如，向流中添加缓冲）。为了最有效地使用它，您希望能够在不重构代码的情况下交换修饰的实现，这基本上意味着您需要维护继承层次结构。

您真正关心的是什么，即“这对装饰进行硬编码”的真正含义是什么？你设想想要解决什么样的问题？可能装饰不是很正确的方法......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T11:32:52.900

您只需让 LockableWindow 定义一个构造函数，该构造函数采用将要装饰的类型 Window 的实例。你也可以通过属性来做到这一点。

```
public class Window
{    
  public virtual void Open()    
  {        
   // Open the window    
  }
}

public class LockableWindow // Decorator
{    
  private Window window;

  public LockableWindow(Window w)
  {
     window = w;
  }      

  public virtual void Open()    
  {        
    // Unlock the window        
    window.Open();    
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-04T16:26:17.967

我对装饰器模式的理解是，它旨在允许对象能力的运行时增强。在维基百科的解释中，他们专注于为此目的的组件堆栈。

我根本不会说 C#，所以这（显然）是 php-ish。似乎正确的想法是：

```
class image{

     function open(){ ... }

} //end of class

class decoratedImage extends image{

     private goodies=array(); //the alleged 'component stack'

     function addGoodie($item){
          $this->goodies[]=$item;
     }

     function open()}{

          parent::open();
          foreach ($this->goodies as $componentClassName){

               $component=new $componentClassName();
               $component->apply($this);

          }

     }

} //end of class 
```

哦，有经验的，请解释断开连接。

# python - 通过文件路径导入模块时使用 Python 多处理

> ID：829123
> 
> 赞同：2
> 
> 时间：2009-05-06T11:18:41.327
> 
> 标签：python, import, module, multiprocessing

我正在编写一个程序，它使用文件路径导入模块，函数`imp.load_source(module_name,module_path)`. 当我尝试将此模块中的对象传递到`Process`.

一个例子：

```
import multiprocessing
import imp

class MyProcess(multiprocessing.Process):
    def __init__(self,thing):
        multiprocessing.Process.__init__(self)
        self.thing=thing
    def run(self):
        x=self.thing

if __name__=="__main__":
    module=imp.load_source('life', 'C:\\Documents and Settings\\User\\workspace\\GarlicSim\\src\\simulations\\life\\life.py')
    thing=module.step
    print(thing)
    p=MyProcess(thing)
    p.start() 
```

注意：要使此代码“工作”，您必须将我提供的参数替换为`imp.load_source`其他参数：它必须是您计算机上的某个 Python 文件，最好不在同一个文件夹中。然后， in `thing=module.step`，而不是 step 放入该`.py`文件中定义的一些随机函数或类。

我得到以下回溯：

```
<function step at 0x00D5B030>
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "C:\Python26\lib\multiprocessing\forking.py", line 342, in main
    self = load(from_parent)
  File "C:\Python26\lib\pickle.py", line 1370, in load
    return Unpickler(file).load()
  File "C:\Python26\lib\pickle.py", line 858, in load
    dispatch[key](self)
  File "C:\Python26\lib\pickle.py", line 1090, in load_global
    klass = self.find_class(module, name)
  File "C:\Python26\lib\pickle.py", line 1124, in find_class
    __import__(module)
ImportError: No module named life 
```

那我该怎么办？

**编辑：**

我在 Win XP 上使用 Python 2.6.2c1。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T17:03:28.817

由于将导入代码放入主块，它可能不起作用。下面的代码适用于 Windows XP、Python 2.6。然后生命模块也将在新进程中导入。

```
import multiprocessing
import imp

class MyProcess(multiprocessing.Process):
  def __init__(self,thing):
    multiprocessing.Process.__init__(self)
    self.thing=thing
  def run(self):
    print("Exiting self.thing")
    self.thing()
    print("Finished")

life=imp.load_source('life', r'd:\temp5\life.py')

if __name__=="__main__":
  p=MyProcess(life.step)
  p.start() 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-06T11:59:20.607

`test.py`在任何文件夹上：

```
import multiprocessing
import imp

class MyProcess(multiprocessing.Process):
    def __init__(self,thing):
        multiprocessing.Process.__init__(self)
        self.thing=thing
    def run(self):
        print 'running...', self.thing()

if __name__=="__main__":
    module=imp.load_source('life', '/tmp/life.py')
    thing=module.step
    print(thing)
    p=MyProcess(thing)
    p.start() 
```

`life.py`上`/tmp`：

```
def step():
    return 'It works!' 
```

运行`test.py`：

```
$ python test.py
<function step at 0xb7dc4d4c>
running... It works! 
```

我刚刚测试并且它有效，所以你一定做错了什么。请编辑您的问题并粘贴不起作用的真实代码。

我正在使用带有默认 python 的 ubuntu Jaunty 9.04（Python 2.6.2 release26-maint，2009 年 4 月 19 日，01:56:41）。不知道您的问题是否仅限于 Windows，因为我没有可用于测试的 Windows。

这就是修改导入路径是一个**坏主意**的原因。您永远无法在所有平台/环境中正确使用它，您的用户可能会生气。最好只使用 python 查找模块的方式，即将模块放在 python 模块搜索路径上。这将在任何地方始终如一地工作。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-06T12:50:49.280

我刚刚完成了以下操作，使用 Python 2.5 在 XP 上运行...

`D:\Experiments\ModuleLoading\test.py`

```
import imp

if __name__=="__main__":
    module=imp.load_source('life', r'D:\Experiments\ModuleLoading\somefolder\life.py')
    thing=module.step
    print(thing) 
```

`D:\Experiments\ModuleLoading\somefolder\step.py`

```
def step():
    return 'It works!' 
```

...并运行脚本给出：

```
D:\jcage\Projects\Experiments\ModuleLoading>test.py
<function step at 0x00A0B470> 
```

...所以首先尝试并确保模块可以在没有多处理的情况下加载？

**[编辑]**好的，所以导入分叉进程肯定是个问题。文档中有[一些特定于 windows 的点点滴滴](http://docs.python.org/library/multiprocessing.html#windows)：

> **更易腌制**
> 
> 确保 Process.__init__() 的所有参数都是可挑选的。这尤其意味着，绑定或未绑定的方法不能直接用作 Windows 上的目标参数——只需定义一个函数并使用它来代替。此外，如果您将 Process 子类化，请确保在调用 Process.start() 方法时实例是可挑选的。
> 
> **全局变量**
> 
> 请记住，如果在子进程中运行的代码尝试访问全局变量，那么它看到的值（如果有）可能与调用 Process.start() 时父进程中的值不同. 但是，只是模块级常量的全局变量不会引起任何问题。
> 
> **安全导入主模块**
> 
> 确保新的 Python 解释器可以安全地导入主模块，而不会导致意外的副作用（例如启动新进程）。

**[Edit2]**是否有任何原因导致您无法在此过程中进行导入？我认为问题在于，当您启动新进程时，它并未在同一地址空间中运行，因此尝试访问原始线程中的函数将无法正常工作。

你可以这样做`D:\Experiments\ModuleLoading\test.py`：

```
from multiprocessing import Process
import imp

class MyProcess(Process):
    def __init__(self):
        Process.__init__(self)

    def run(self):
        print 'run called...'
        module=imp.load_source('life', r'D:\Experiments\ModuleLoading\somefolder\life.py')
        print 'running...', module.step()

if __name__=="__main__":
    p=MyProcess()
    p.start() 
```

# c++ - c++ 循环宏

> ID：829125
> 
> 赞同：1
> 
> 时间：2009-05-06T11:19:33.353
> 
> 标签：c++, macros, for-loop

我使用宏来编写这样的展开循环：（愚蠢的例子）

```
#define foreach_small_prime(p, instr) {   \
  int p;                                  \
  p = 2; instr;                           \
  p = 3; instr;                           \
  p = 5; instr;                           \
  p = 7; instr;                           \
}

foreach_small_prime(pp, cout << pp);

int sum = 0;
foreach_small_prime(pp, {
  sum += pp;
  if (sum >= 10) cout << sum << endl;
}); 
```

但在某些情况下，我可能会使用 for 构造：

```
#define foreach_small_even(ii) for(int ii = 0; ii < 20; ii += 2)

int sum = 0;
foreach_small_even(pp) {
  sum += pp;
  if (sum >= 10) cout << sum << endl;
} 
```

我喜欢这个宏，因为我可以将变量*名*作为参数传递。

问题：有没有办法像第二个宏一样以类似 for 的语法定义第一个循环？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T11:43:17.570

您可以查看 Boost[预处理器](http://www.boostpro.com/tmpbook/preprocessor.html)库。它可以做各种循环的事情。语法不是很好，但我相信它有效。但是，我自己没有使用过它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:53:58.857

您是否有充分的理由避免使用迭代器对象？你必须考虑你的第一个宏粘贴 4x 你的 instr 代码......

否则，一个简单的：

```
#define foreach_smallprime(ii) for(int ii = 0; ii <= 7; ii = next_prime(ii) ) 
```

在与`next_prime(ii)`宏相同的文件中定义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T13:13:19.507

> 问题：有没有办法像第二个宏一样以类似 for 的语法定义第一个循环？

我猜你有一个相对较小的素数工作集，所以为你的素数创建一个查找应该不会太麻烦。如果您需要生成更大的素数列表，我敢肯定 Boost 库中提供了一些编译时模板元编程魔法。如果您要生成更复杂的一系列数字，最好将查找转换为在生成结果时缓存结果的函数。

```
const int small_primes[MAX_SMALL_PRIMES] = {2, 3, 5, 7, 11, 13};

#define foreach_small_prime(pp) \
  for (int i = 0; i < MAX_SMALL_PRIMES; pp = small_primes[++i]) 
```

用作：

```
void f() {
  int sum = 0;
  int temp = 0;
  foreach_small_prime(temp) {
    sum += temp;
    if (sum >= 10) cout << sum << endl;
  }
} 
```

可能想要折腾查找表和 MAX_SMALL_PRIMES 他们自己的命名空间以避免混乱......并且在宏中使用常用的标识符“i”可能是一个糟糕的选择。我敢肯定还有其他方法可以改进它，但这基本上是您所要求的。

# php - 如何实现 PHP/HTML 缓存

> ID：829126
> 
> 赞同：2
> 
> 时间：2009-05-06T11:20:18.360
> 
> 标签：php, html, caching

我已经阅读了一些关于实现 php 缓存系统的指南（我的网站是自定义编码的，查询量很大并且不断增长），其中包括：[http ://www.snipe.net/2009/03/quick-and-dirty-php -缓存/](http://www.snipe.net/2009/03/quick-and-dirty-php-caching/)

我完全理解它们，但是页面的某些部分我无法缓存，最好的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T12:27:04.300

如果您进行大量读取但很少更新，则缓存很有用。数据库中的数据更改得越频繁，缓存系统的问题就越多。缓存确实为您的代码库增加了一定的复杂性，这可能会让人很难处理。在最坏的情况下，它甚至会减慢您的网站速度。

**最重要的问题是：**
什么时候必须使缓存无效？它什么时候变得陈旧？在大多数情况下，如果数据库查询返回的行与您缓存该页面时不同。但是你怎么知道的？你没有（也许有办法，但我想不出任何自动取款机），因为要检查它，你可能必须查询结果进行比较。

你可以做什么：

1.  每次更新数据库的相关部分时清除所有缓存
    如果您的数据库很少更新 - 每小时，每天，每周，这确实是可能的。但如果变化不断出现，那就没用了。大多数网络项目都是这种情况。

2.  发生某些事情后清除缓存的项目，
    这仅在不必立即反映更改时才有效（例如，如果一段时间内有*不正确的数据也没关系）。*在这种情况下，如果某个项目的时间超过 X 分钟，或者发生的网页浏览量超过 Y 次，您只需清除该项目的缓存即可。

3.  仅清除此处的相关部分
    ，您必须确定在更新数据库时缓存的哪些部分受到影响。如果做得好，更改会在性能提高的同时立即反映出来。

最可能的是选项 3：你必须找出答案。因此，作为一个例子，让我们以博客的经典案例为例，它由首页、存档页面和每个条目的详细信息页面组成。

更改由：管理面板（条目的 crud）和评论引入

如果条目被编辑或删除，您必须清除缓存：

*   头版，如果条目是新的
*   相关的存档页面，如果条目是旧的
*   条目的详细信息页面

如果有人发表评论，您只需清除详细信息页面，但前提是评论数量未显示在索引或存档中。否则，与 entry-crud 相同。

如果站点范围内的某些内容发生更改，则必须清除整个缓存（不好！）

现在，让我们考虑一下 entry-crud 和存档。如果档案的类型是“每月一页”，则清除条目所属的月份。但如果存档是条目 1-10、11-20、21-30，... 最有可能整个存档缓存必须重建。

等等 ...

**一些问题：**

*   如果您没有正确识别所有受影响的部分，则可能导致数据过时和/或（未）死链接。

*   如果更新发生得太频繁，构建缓存是额外的工作，因为当下一次页面浏览发生时，缓存很可能再次过时并且无论如何都必须重建。

*   页面的某些部分不适合缓存，例如（自定义）搜索功能。如果缓存在其他地方工作，一切都很快而且很好，但搜索仍然非常慢。

*   如果在发生大量请求时必须清除整个缓存，则可能会出现问题。然后它可能会阻塞您的服务器，因为缓存未命中通常比页面一开始没有缓存的情况更昂贵。更糟糕的是，如果有 3 个请求进来，并且第一个请求在处理其他两个请求之前无法缓存页面，则缓存会被请求 3 次而不是一次。

我的建议：

*   优化您的数据库。键和配置好吗？也许它可以在没有缓存的情况下工作。

*   优化您的查询。“解释选择”！

*   只缓存页面的一部分——昂贵的部分。用 str_replace 和占位符填充小的、廉价的更改

*   如果一切正常，请使用 apc 或 memcached 而不是文件（文件通常工作得很好，但 apc/memc 更快）。您还可以使用您的数据库来缓存您的数据库，通常效果很好！

*   你是在构建一个惰性缓存系统还是一个急切的缓存系统？lazy 表示：页面第一次请求时构建缓存， eager 表示：更新后。

嗯，我对你没有任何真正的建议。太多取决于问题:)

### 更新

使用键 256 请求博客条目。它显示博客条目、评论和当前登录的人。查询条目和评论以及格式化所有文本和所有内容的成本很高。当前登录的用户驻留在会话中。

首先，为要缓存的部分创建一个唯一键。在这种情况下，缓存键可能是条目的数据库 ID（带有一些前缀和后缀）。

所以，缓存的文件应该有名字`cache/blogentry_256.tmp`。检查该文件是否存在。

1.  如果它不存在，请执行所有昂贵的查询和格式化，留下一个占位符（例如 {username}），当前用户的名称应该在其中，并将结果保存到`cache/blogentry_256.tmp`. 注意不要将任何不应该显示给所有人或每个请求都更改的数据写入此文件。

2.  现在，读取文件（或重用 1 中的数据）并将用户名 str_replace 放入占位符。`echo`结果。

如果条目被更改或有人发表评论，您必须删除带有条目 ID 的缓存文件。

这是惰性缓存 - 仅当用户请求页面时才会构建缓存。小心 - 如果用户在评论中输入 {username}，它也会被插入其中！这意味着，您必须在 str_replacing 之后转义缓存数据并取消转义。这种技术也适用于 memcached 或 apc。

问题：您必须围绕该缓存设计构建您的设计。例如，如果您想显示“5 分钟前发布的评论”而不是“5 月 6 日下午 3:42 添加的评论”，那么您就有麻烦了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T11:34:33.007

为什么不能缓存它们？如果是因为它们变化非常快，那么您最好尝试减少检索和渲染开销。

如果内容因用户而异，那么您可以为每个用户提供不同的缓存版本。例如，如果您使用对象缓存，则在缓存键中包含用户的标识符或其他一些唯一值。如果您使用的是更通用的 HTTP 级缓存，例如 Squid，那么您可以将`Vary`标头设置为，例如`Vary: Cookie`，这将导致代理再次检查它向谁提供内容。

您仍然应该指示缓存和代理不要将任何敏感信息存储在公共缓存中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:50:24.347

请记住，缓存不是一个单一的解决方案——您的应用程序可以在不同级别上进行缓存，具体取决于变量的范围。在单个请求中，您可能有一个身份映射来防止对相同数据的额外查询。您可以使用 memcached 跨请求缓存数据。数据库本身有一个查询缓存，以及其他类型的低级缓存。您的渲染引擎还可以在不同级别缓存 - 整个页面、页面的各个部分等。您需要弄清楚可以缓存的内容并为此制定策略。

此外，与所有优化一样，请确保在调整任何内容之前进行测量。这将确保 1）您实际上改进了事情，而不是让事情变得更糟； 2）您专注于重要的事情，而不是其他所有事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:56:06.067

这是我的提示：创建一个对象或函数，让您根据其名称缓存“部分”。通过这种方式，您可以缓存部分页面，并将渲染部分包含在 if 块中。我所做的是对传入的文本进行哈希处理并将其用作 内的文件名`'./cache'`，并返回是否需要重新生成的布尔值；您显然需要为此进行输出缓冲。

这将为您提供一个缓存框架，

```
if(Cache::cached('index-recent-articles', 5 /* minutes */)) {
   Cache::start();
   echo 'stuff here';
   Cache::stop('index-recent-articles');
} // And if Cache::cached could echo the cached HTML when the result is false...
  // then this is a tidy else-less bit of code. 
```

我不知道这是否是最优的，像 memcache 这样的基于服务器的解决方案会更好，但这个概念应该对你有所帮助。显然，您如何管理缓存，无论是按文件还是按数据库或扩展名，都取决于您。

*编辑：*

如果您希望使用基于文件的缓存，那么这个简单的系统可能就是您所需要的。显然我没有在你的鞋子上测试过它，这主要是从我的脑后拉出来的，但就目前而言，这对于你可能想要的东西来说是一个不错的开始。

```
abstract class Cache {
  const path = 'cache/';
  static function start()  { ob_start(); }
  static function end($id, $text = null) {
    $filename = sprintf('%s%u', Cache::path, crc32($id));
    file_put_contents($filename, $text === null ? ob_get_clean() : $text);
  }
  static function cached($id, $minutes = 5) {
    $filename = sprintf('%s%u', Cache::path, crc32($id));
    $time = $minutes * 60;
    if(time() - filemtime($filename) > $time) {
      return true;
    } else {
      echo file_get_contents($filename);
      return false;
    }
  }
} 
```

# c# - db4o 复制系统：NullReferenceException？

> ID：829132
> 
> 赞同：0
> 
> 时间：2009-05-06T11:23:03.953
> 
> 标签：c#, db4o

我正在尝试按如下方式进行标准双向复制。但是，我得到一个 NullReferenceException。这是一个单独的复制项目。我确实在这个复制项目中导入了原始项目中涉及的类（如Item、Category等）。我究竟做错了什么？（如果我使用 VS 进行调试，我可以看到 changedObjects 确实具有所有更改的对象；Replicate 函数内部似乎存在一些问题）

```
IObjectContainer local = Db4oFactory.OpenFile(@"G:\Work\School\MIS\VINMIS\Inventory\bin\Debug\vin.db4o");
IObjectContainer far = Db4oFactory.OpenFile(@"\\crs-lap\c$\vinmis\vin.db4o"); ;

IReplicationSession replication = Replication.Begin(local, far);
IObjectSet changedObjects = replication.ProviderA().ObjectsChangedSinceLastReplication();

while(changedObjects.HasNext())
               replication.Replicate(changedObjects.Next()); // Exception!!!
replication.Commit();

changedObjects = replication.ProviderB().ObjectsChangedSinceLastReplication();
while (changedObjects.HasNext())
                replication.Replicate(changedObjects.Next());
replication.Commit(); 
```

问候，

索拉布。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-27T18:01:40.400

听起来您忘记使用 UUID 和版本号设置数据库。从[官方文档](http://developer.db4o.com/Documentation/Reference/db4o-7.12/net35/reference/html/reference/db4o_replication_system_drs/db4o_databases_replication/initial_setup.html)：

```
public static IConfiguration ConfigureReplication()
{
    IConfiguration db4oConfig = Db4oFactory.NewConfiguration();
    db4oConfig.GenerateUUIDs(ConfigScope.Globally);
    db4oConfig.GenerateVersionNumbers(ConfigScope.Globally);
    return db4oConfig;
} 
```

# animation - 动画：计时器与空闲

> ID：829135
> 
> 赞同：2
> 
> 时间：2009-05-06T11:23:28.773
> 
> 标签：animation, timer

其他地方有一个[类似的线程](https://stackoverflow.com/questions/622604/best-approach-for-game-animation)，但它专注于游戏编程，我发现它与带有一些“额外糖”的常规 gui 应用程序有点不同。

驱动小型 gui 动画（如展开/折叠面板、发光按钮等）的正确方法是什么？

最好设置一个计时器以定期触发，还是使用空闲事件更好？

WPF 如何驱动其动画？

我知道有很多关于什么是最好的意见，所以让我们把它们都收集起来:-)

更新：好的。我认为这有点不清楚。我没有使用 WPF，我对如何在 WPF 中触发动画不感兴趣。我所追求的是关于为什么时间比使用 onidle 事件驱动动画更好或更坏的讨论。不启动它，驱动它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T12:49:21.500

你如何驱动你的动画应该基于你的处理优先级。

如果您使用计时器，您将被更一致地调用。这可以让您与更重要的处理能力进程竞争。通过 OnIdle 驱动允许其他进程负责，但这也意味着动画可能会被饿死。

正确的选择取决于您的具体优先事项。

我不确定 WPF 如何处理这个问题，但是将动画基于绝对开始时间而不是在每次调用时增加动画很重要，因为动画可能不会定期调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:51:00.923

也许我弄错了，但是如果 WPF 本机支持动画，为什么需要计时器/空闲事件？您可能想看看 MSDN 上的动画概述文章：http: [//msdn.microsoft.com/en-us/library/ms752312.aspx](http://msdn.microsoft.com/en-us/library/ms752312.aspx)

# java - 对于不支持/未实现的操作，在 Java 中抛出的标准异常是什么？

> ID：829136
> 
> 赞同：378
> 
> 时间：2009-05-06T11:23:29.943
> 
> 标签：java

特别是，`Exception`在这些情况下是否使用了标准子类？

* * *

## 回答 #1

> 赞同：529
> 
> 时间：2009-05-06T11:24:59.283

[java.lang.UnsupportedOperationException](http://java.sun.com/javase/6/docs/api/java/lang/UnsupportedOperationException.html)

> 抛出以指示不支持请求的操作。

* * *

## 回答 #2

> 赞同：242
> 
> 时间：2014-02-26T15:00:48.077

区分您命名的两种情况：

*   要指示请求的操作不受支持并且很可能永远不会支持，请抛出[`UnsupportedOperationException`](http://docs.oracle.com/javase/7/docs/api/java/lang/UnsupportedOperationException.html).

*   要指示请求的操作尚未实现，请在以下选项中进行选择：

    1.  使用[`NotImplementedException`](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/NotImplementedException.html)from [apache commons-lang](http://commons.apache.org/proper/commons-lang/)，它在 commons-lang2 中可用，并已在 3.2 版中重新添加到 commons-lang3。

    2.  实现你自己的`NotImplementedException`.

    3.  抛出[`UnsupportedOperationException`](http://docs.oracle.com/javase/7/docs/api/java/lang/UnsupportedOperationException.html)一条消息，如“尚未实现”。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2017-02-13T10:32:50.683

[**如果您在NetBeans**](https://netbeans.org/)中创建一个新的（尚未实现的）函数，那么它会生成一个带有以下语句的方法体：

```
throw new java.lang.UnsupportedOperationException("Not supported yet."); 
```

因此，我建议使用[UnsupportedOperationException](http://docs.oracle.com/javase/8/docs/api/?java/lang/UnsupportedOperationException.html)。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-05-06T11:43:18.290

[如果你想要更多的粒度和更好的描述，你可以使用来自commons-lang 的](http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/NotImplementedException.html)NotImplementedException

警告：仅在 2.6 版之前和 3.2 版之后可用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-11-09T05:43:08.120

下面的`Calculator`示例类显示了差异

```
public class Calculator() {

 int add(int a , int b){
    return a+b;
  }

  int dived(int a , int b){
        if ( b == 0 ) {
           throw new UnsupportedOperationException("I can not dived by zero, 
                         not now not for the rest of my life!")
        }else{
          return a/b;
       }
   }

   int multiple(int a , int b){
      //NotImplementedException from apache or some custom excpetion
      throw new NotImplementedException("Will be implement in release 3.5");
   } 
} 
```

# jquery - jquery错误放置

> ID：829137
> 
> 赞同：1
> 
> 时间：2009-05-06T11:24:31.720
> 
> 标签：jquery, css, internet-explorer, validation

我有一个 jquery 表单。验证工作正常，但我希望正确放置错误。现在它在 IE 7 中显示为：

[替代文字 http://img412.imageshack.us/img412/1810/errorhma.jpg](http://img412.imageshack.us/img412/1810/errorhma.jpg)

但我想将其显示为：

[替代文字 http://img520.imageshack.us/img520/7089/error1ace.jpg](http://img520.imageshack.us/img520/7089/error1ace.jpg)

这是CSS代码：

```
div.error { display:none; }
           <%-- input { border: 1px solid black; }--%>
            input:focus { border: 1px dotted black; }
            input.error { border: 2px solid red; }
            label.error { color: white; font-size:16px; font-family:Nyala; background-color: red }
            label.valid { color: green; } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T20:18:32.653

试试 label.error{display:block;}

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-01T00:04:47.547

您可以使用 errorPlacement 控制错误消息的位置。默认值为“error.insertAfter(element)”。您可以使用其中之一，例如：

```
errorPlacement: function(error, element) {
    error.insertBefore( element );
    //error.appendTo( element.parent().next() );
    //error.appendTo(label.insertAfter( element ));
    //error.insertAfter(element.sibling(a));
} 
```

甚至在这里放一些条件并使用其他语句：

```
errorPlacement: function(error, element) {
    if ( element.is(".something") ) {
        element.nextAll('div').html(error);
    } else {
        error.insertAfter( element );
    }
} 
```

希望能帮助到你

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T11:31:11.657

有几个问题，第一个是错误着色显示为围绕输入​​元素元素。因此，您要么需要使用错误 div 来包含输入元素，要么只需更改表单元素容器的颜色。我投票赞成改变容器的颜色。

其次，您希望 div.error 左右清晰（*假设您只是更改表单元素容器的颜色*），因此只需添加：

```
div.error {
  clear: both;
} 
```

当然，这假设您出于某种原因将其浮动到左侧。无论如何，请看一个简单的示例，说明一种布局方式

[http://jsbin.com/amaxa](http://jsbin.com/amaxa)

# python - Django：表单类的自定义构造函数，从 request.POST 访问数据时遇到问题

> ID：829156
> 
> 赞同：-1
> 
> 时间：2009-05-06T11:29:49.787
> 
> 标签：python, django, post, webforms

我为表单编写了自定义构造函数，整个表单类如下所示：

```
class UploadForm(forms.Form):
    file = forms.FileField(label = "Plik")

    def __init__(self, coto, naglowek, *args, **kwargs):
        super(UploadForm, self).__init__(*args, **kwargs)
        self.coto = coto
        self.naglowek = naglowek 
```

在我看来，提交表单时，我有类似的东西

```
if request.method == 'POST':
    form = UploadForm(request.POST, request.FILES)
    if form.is_valid():
        add_form(request.FILES['file'])
        return HttpResponseRedirect('uploaded/') 
```

问题是，在我看来，当我以这种方式创建表单时，我没有传递**coto**和**naglowek**，所以当我调用**form.is_valid()** --> 时它返回 false。

通过它的模板如下所示：

```
<table class="uploadform">
<form action="." method="POST" enctype="multipart/form-data">
{% for form in forms %} 
<tr>
    <td>{{ form.naglowek }}</td>
    <td>{{ form.file }}</td>
    <td><input type="submit" name="{{ form.coto }}" id="{{ form.coto }}" value="Wyślij"></td>
</tr>
{% endfor %}
</form>
</table> 
```

我将不胜感激任何建议。

**[编辑]** 我可能说得不够清楚，但我会尽力而为：

当我提交此表单时，我需要知道按下了哪个提交按钮 - 我将其中许多按钮分配给单个表单。据我所知，当我为提交按钮分配 id 时，它应该可以在帖子中使用，对吧？诀窍是，它不可用。

我有两个问题： * 需要做什么，如果我想知道按下了哪个提交按钮？分配名称是唯一的方法吗？* 我的逻辑有错误吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:04:49.790

你的问题一团糟。有代码，并且有另一个问题的编辑。编辑问题与标题无关。

请将此问题更新为您的*真正*问题。

如果您有多个提交按钮，则必须为它们提供不同的名称或值（或两者）。这是我们的代码，它使用不同的值来区分单击了哪个按钮。

```
 <form method="post" action="." enctype="multipart/form-data">
            <input type="hidden" name="object_id" value="{{e.id}}"/>
            {% ifequal object.workflow "uploaded" %}
            <input type="submit" name="action" value="Validate"/>
            <br/>
            <input type="submit" name="action" value="Delete"/>
            {% endifequal %}
            {% ifequal object.workflow "validated" %}
            <input type="submit" name="action" value="Load"/>
            {% endifequal %}
            {% ifequal object.workflow "processed" %}
            <input type="submit" name="action" value="Undo"/>
            {% endifequal %}
            {% ifequal object.workflow "failed" %}
            <input type="submit" name="action" value="Validate"/>
            {% endifequal %}
        </form> 
```

视图函数有这种东西：

```
 if request.POST['action'] == "Delete": 
```

根据按钮更改操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:27:28.167

您重新定义了默认表单构造函数并更改了其参数顺序。因此，您必须使用参数的显式命名来实例化您的自定义表单：

```
form = UploadForm(data=request.POST, files=request.FILES, coto=..., naglowek=...) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T11:39:15.663

```
request.POST['coto']
request.POST['naglowek'] 
```

我猜。

# c# - 有没有一种简单的方法可以将 int 转换为每个数字的 int 数组？

> ID：829174
> 
> 赞同：22
> 
> 时间：2009-05-06T11:36:58.070
> 
> 标签：c#

说我有

```
var i = 987654321; 
```

有没有一种简单的方法来获取数字数组，相当于

```
var is = new int[] { 9, 8, 7, 6, 5, 4, 3, 2, 1 }; 
```

不使用`.ToString()`ing 和迭代字符`int.Parse(x)`？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-06T11:42:20.303

```
public Stack<int> NumbersIn(int value)
{
    if (value == 0) return new Stack<int>();

    var numbers = NumbersIn(value / 10);

    numbers.Push(value % 10);

    return numbers;
}

var numbers = NumbersIn(987654321).ToArray(); 
```

没有递归的替代方案：

```
public int[] NumbersIn(int value)
{
    var numbers = new Stack<int>();

    for(; value > 0; value /= 10)
        numbers.Push(value % 10);

    return numbers.ToArray();
} 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-05-06T13:09:26.770

我知道可能有比这更好的答案，但这是另一个版本：

您可以使用`yield return`以升序返回数字（根据重量或任何名称）。

```
public static IEnumerable<int> Digits(this int number)
{
    do
    {
        yield return number % 10;
        number /= 10;
    } while (number > 0);
} 
```

> 12345 => 5、4、3、2、1

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-06T11:59:58.437

另一种不使用递归并使用避免在每次插入时重新分配的堆栈的替代方案（至少对于前 32 位数字）：

```
var list = new Stack<int>(32);
var remainder = 123456;
do
{
    list.Push(remainder % 10);
    remainder /= 10;
} while (remainder != 0);

return list.ToArray(); 
```

是的，这种方法也适用于 0 和负数。

有趣的是，给这个算法一个负数 -123456，你会得到 {-1, -2, -3, -4, -5, -6}

**更新**：从使用 List 切换到 Stack，因为这会自动给出正确的顺序。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-06T11:47:22.040

```
var x = new Stack<int>();
do
{
    x.Push(i % 10);
    i /= 10;
} while (i > 0);
return x.ToArray(); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2020-11-19T23:01:37.137

刚刚对不同的方法做了一个基准测试，结果如下：

```
BenchmarkDotNet=v0.12.0, OS=Windows 10.0.19041
Intel Core i7-8705G CPU 3.10GHz (Kaby Lake G), 1 CPU, 8 logical and 4 physical cores
.NET Core SDK=3.1.301
  [Host]     : .NET Core 3.1.5 (CoreCLR 4.700.20.26901, CoreFX 4.700.20.27001), X64 RyuJIT
  DefaultJob : .NET Core 3.1.5 (CoreCLR 4.700.20.26901, CoreFX 4.700.20.27001), X64 RyuJIT

                         Method |      Mean |    Error |   StdDev |  Gen 0 | Gen 1 | Gen 2 | Allocated |
------------------------------- |----------:|---------:|---------:|-------:|------:|------:|----------:|
                          Stack |  89.06 ns | 2.130 ns | 6.179 ns | 0.0592 |     - |     - |     248 B |
                    SharedArray |  84.64 ns | 1.765 ns | 3.685 ns | 0.0153 |     - |     - |      64 B |
 PreallocateUsingNumberOfDigits |  39.15 ns | 0.861 ns | 2.499 ns | 0.0153 |     - |     - |      64 B |
                    IEnumerable | 246.53 ns | 4.926 ns | 9.372 ns | 0.0610 |     - |     - |     256 B | 
```

为了平均速度：

## PreallocateUsingNumberOfDigits

平均值：~39.15ns 错误：0.861ns 分配：64 B

```
public static int[] GetDigits(int n)
{
    if (n == 0)
        return new[] {0};

    var x = Math.Abs(n);

    var numDigits = NumberOfDigits(x);

    var res = new int[numDigits];
    var count = 0;

    while (x > 0)
    {
        res[count++] = x % 10;

        x /= 10;
    }

    Array.Reverse(res);

    return res;
}

public static int NumberOfDigits(int n)
{
    if (n >= 0)
    {
        if (n < 10) return 1;
        if (n < 100) return 2;
        if (n < 1000) return 3;
        if (n < 10000) return 4;
        if (n < 100000) return 5;
        if (n < 1000000) return 6;
        if (n < 10000000) return 7;
        if (n < 100000000) return 8;
        if (n < 1000000000) return 9;
        return 10;
    }
    else
    {
        if (n > -10) return 2;
        if (n > -100) return 3;
        if (n > -1000) return 4;
        if (n > -10000) return 5;
        if (n > -100000) return 6;
        if (n > -1000000) return 7;
        if (n > -10000000) return 8;
        if (n > -100000000) return 9;
        if (n > -1000000000) return 10;
        return 11;
    }
} 
```

## 共享数组

平均值：~84.64ns 错误：1.765ns 分配：64 B

```
public static int[] GetDigits_SharedPool(int n)
{
    if (n == 0)
        return new[] {0};

    var x = Math.Abs(n);

    var pool = ArrayPool<int>.Shared.Rent(11);
    var count = 0;

    while (x > 0)
    {
        pool[count++] = x % 10;

        x /= 10;
    }

    var res = new int[count];

    Array.Copy(pool, res, count);

    Array.Reverse(res);

    ArrayPool<int>.Shared.Return(pool);

    return res;
} 
```

## 堆

平均值：~89.06ns 错误：2.130ns 分配：248 B

来自：[@Peter Lillevold 回答](https://stackoverflow.com/a/829232/271106)

```
public int[] Stack()
{
    var list = new Stack<int>(32);
    var remainder = digit;
    do
    {
        list.Push(remainder % 10);
        remainder /= 10;
    } while (remainder != 0);

    return list.ToArray();
} 
```

## IEnumerable

平均值：~246.53ns 错误：4.926ns 分配：256 B

来自[@Svish 的回答](https://stackoverflow.com/a/829476/271106)

```
public static IEnumerable<int> Digits_IEnumerable(int number)
{
    do
    {
        yield return number % 10;
        number /= 10;
    } while (number > 0);
} 
```

# 代码

见这里：[michal-ciechan/GetDigitsBenchmark](https://github.com/michal-ciechan/GetDigitsBenchmark)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T11:42:50.223

简而言之：使用循环将数字模10（％）除以得到提醒（每个数字）并将其放入数组中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-05-13T13:07:05.940

字符串并且可以很有趣（其他一些选项会更快......但这很容易）

```
var @is = 987654321.ToString().Select(c => c - 48).ToArray(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-02-03T11:46:23.330

.NET 4.7.1 或更高版本：

```
IEnumerable<long> GetDigits(long value) =>
  value == 0 ? new long[0] : GetDigits(value / 10).Append(value % 10) 
```

.NET 3.5 - 4.7：

```
IEnumerable<long> GetDigits(long value) =>
  value == 0 ? new long[0] : GetDigits(value / 10).Concat(new[] { value % 10 }); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-24T14:51:56.510

这会将 int 值转换为字符串，然后转换为字符数组，最后转换为 int 数组。

```
var myInt = 31337;
var myIntArray = Array.ConvertAll(myInt.ToString().ToCharArray(), x => (int)Char.GetNumericValue(x)); 
```

我使用`.ToCharArray()`它是因为它应该比`.ToArray()`.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-11T09:37:56.987

对于 LINQ 爱好者作为 ONE LINER =>

```
var number = 8892366;
//Edit 17.11.2021

var splittedList = number.ToString().Select(x => (int)char.GetNumericValue(x)).ToArray();

// Output : int[] {8, 8, 9, 2, 3, 6, 6} 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-05-06T12:54:40.427

这确实会转换为字符串并遍历字符，但它会自动并以单行方式进行：

```
var i = 987654321;
var @is = i.ToString().Select(c => c - '0').ToArray(); 
```

# php - 动态 Javascript 文件换行符和回车符

> ID：829182
> 
> 赞同：0
> 
> 时间：2009-05-06T11:42:26.497
> 
> 标签：php, javascript

我正在使用 .htaccss 将 .php 转换为 .js 使用 php 动态构建 JS 页面

除了 JS 的输出之外，一切都很好。

IE

```
$data = array('one', 'two');

foreach($data as $d){
    echo "document.write('This is a test for array item ".$d."'); \r\n";
} 
```

问题是它全部输出在一行上，即

```
document.write('This is a test for array one');document.write('This is a test for array two'); 
```

无论我尝试了什么，我都无法超过 2 行。

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T11:49:51.940

编辑：看起来我误解了这个问题 - 他在他的 JS 中遇到了换行问题，而不是他的最终 HTML。

* * *

由于字符串末尾的“\r\n”，您的 JavaScript 在单独的行中出现，但随后您将纯文本输出到 HTML 文档中。HTML 不会换行，除非你在一个预先格式化的块中（比如“<pre>”）或者你给它一个明确的换行符（比如“<br>”）。

您可能希望您的代码如下所示：

```
foreach($data as $d){
  echo "document.write('This is a test for array item ".$d."<br>'); \r\n";
} 
```

请务必小心您的数据 - 将随机字符串插入 HTML 是获取安全漏洞的快速方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:52:58.797

呵呵，其实我想如果你查看生成文件的源代码你会发现确实有换行符。:)

# jsf - 如何将选定的值添加到 ice:selectOneMenu？

> ID：829189
> 
> 赞同：0
> 
> 时间：2009-05-06T11:43:41.890
> 
> 标签：jsf, icefaces

我`ice:selectOneMenu`在 Icefaces 中遇到了组件问题。

更多细节：当我填充`SelecItems`arrayList时，我在arrayList的第一个索引处设置了一个空的selcetItem，就像这样：`mainClassificationsSI.add(new SelectItem(""));`，在我的页面中我有以下内容：

```
 <ice:selectOneMenu partialSubmit="true" binding="#
        {editOutgoingBean.mainClassificationSelect}" id="mBookClass" value="#
        {editOutgoingBean.outgoing.main_Classification}" valueChangeListener="#      
        {editOutgoingBean.mainClassificationChanged}">

        <f:selectItems value="#{editOutgoingBean.mainClassificationsSI}"/>
    </ice:selectOneMenu> 
```

首先，我确定：`editOutgoingBean.outgoing.main_Classification`的值是`SelectItems`arrayList中selectItems的值之一，但是当页面显示时，Select标签选择了空值，它没有选择`main_Classification`I的值之前定...

当我从 ArrayList 中删除第一个 Empty`SelectItem`时，Select 标记将选择我设置的值`main_Classification`。请帮我看看该怎么办...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-04T12:57:21.780

试试这个，可能对你有帮助。

```
<ice:selectOneMenu partialSubmit="true" binding="#
    {editOutgoingBean.mainClassificationSelect}" id="mBookClass" value="#
    {editOutgoingBean.outgoing.main_Classification}" valueChangeListener="#      
    {editOutgoingBean.mainClassificationChanged}">
    <f:selectItem itemLabel="Select" itemValue="-1" />
    <f:selectItems value="#{editOutgoingBean.mainClassificationsSI}"/>
</ice:selectOneMenu>` 
```

不要像你做的那样从bean中选择黑色项目

# c# - ToString() 用于类属性？

> ID：829190
> 
> 赞同：10
> 
> 时间：2009-05-06T11:43:49.723
> 
> 标签：c#

假设我有一个类“Item”，它有三个成员变量：字符串名称、十进制数量和字符串单位。我在这三个上都有公共的 get/set 属性。

有时，我想将数量显示为文本以及正确的单位，例如。10m 或 100 英尺。

我的问题是，是否也可以为属性提供某种 ToString() 函数，以便可以自定义它们的文本输出？

谢谢，

索拉布。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-06T11:47:04.520

您可以做的是创建一个返回格式化版本的新（只读）属性：

```
public string QuantityAsString
{
    get
    {
        return string.Format("{0} {1}", this.Quantity, this.Unit);
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-06T11:52:09.703

听起来您的对象模型没有正确分解。您可能想要做的是抽象`Unit`并`Quantity`放入另一个对象，然后您可以覆盖`ToString`它。这具有将相关值保持在一起的优点，并允许您实现诸如将来单位之间的转换（例如从英寸到英尺的转换等）之类的东西，例如

```
public struct Measure
{
    public Measure(string unit, decimal quantity)
    {
        this.Unit = unit;
        this.Quantity = quantity;
    }

    public string Unit { get; private set; }
    public decimal Quantity { get; private set; }

    public override string ToString() 
    { 
        return string.Format("{0} {1}", this.Quantity, this.Unit);
    }
}

public class Item
{
    public string Name { get; set; }
    public Measure Measure { get; set; }

    public override string ToString() 
    { 
        return string.Format("{0}: {1}", this.Name, this.Measure);
    }
} 
```

请注意，我在`Measure`这里创建了一个结构，因为它可能具有值语义。如果您采用这种方法，您应该使其不可变并覆盖 Equals/GetHashCode 以适合结构。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-06T11:49:01.880

一般来说，将值格式化为适当的单位不是`Item`类的责任。相反，这应该由一些外部类来完成。

但是，如果您真的想在类中进行格式化，我建议定义一个`Unit`带有[隐式转换运算符](http://msdn.microsoft.com/en-us/library/z5z9kes2(VS.71).aspx)的类，以转换为`decimal`or `int`s 以及所有必需的格式化逻辑。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T11:49:49.257

我认为从代码质量的角度来看，最好的方法是创建将值与单元包装并提供的类`.ToString()`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-06T11:57:50.907

您可以实现 IFormatable 接口以具有不同的 ToString

```
public class Item : IFormattable
{
    public string Name;
    public decimal Quantity;
    public string Unit;

    public override string ToString(string format, IFormatProvider provider)
    {
        switch(format)
        {
            case "quantity": return Quantity + Unit;
            default: return Name;
        }
    }
} 
```

这可以像这样使用：

```
Item item = new Item();
Console.WriteLine(item.ToString());
Console.WriteLine("Quantity: {0:quantity}", item); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T11:46:31.900

你有两个选择：

1.  让父类的 ToString() 自动将这些片段附加到一个很好的格式中。
2.  将属性包装在类中并为这些类提供 ToString()

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T11:57:55.773

几天前，我实现了相同的模型。我为数量和单位做了单独的类。看起来是这样的（简化了，其实有构造函数和重载的操作符）：

```
class Quantity
{
    public decimal Value;
    public UnitOfMeasure Unit;

    public override string ToString() 
    {
        return string.Format("{0} {1}", Value, Unit); 
    }
}

class UnitOfMeasure
{
    public string Name;

    public override string ToString() { return Name; }
} 
```

# lotus-notes - Lotus Notes R5 电子邮件公式

> ID：829191
> 
> 赞同：0
> 
> 时间：2009-05-06T11:44:33.170
> 
> 标签：lotus-notes

我目前正在运行一个简单的代理来将电子邮件转发到另一个电子邮件地址，不幸的是，我尝试使用的公式也保持主题失败了。主题作为发送它的服务器进入。

最后尝试的代码

"[" + @Implode(SendTo; ";")+ "] " + 主题

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T13:37:09.153

我同意如果您发布一些代码会有所帮助，但无论如何我都会尝试一下。我猜你的意思是说*发件人*显示为发送它的服务器。这是从代理发送电子邮件时的常见问题。代理在服务器上运行并使用服务器的上下文发送电子邮件。

我相信 R5 中的修复是用另一个 id 签署代理。您必须确保此 Notes id 在该服务器上具有运行代理的权限，并且至少对拥有该代理的数据库具有设计者权限。

我仍在使用 R6，并且代理属性中有一个名为“代表运行”的字段，您可以在其中选择一个用户并让代理在该用户的上下文中运行。我不记得这在 R5 中是否可用，但上面的技巧基本上产生了相同的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T14:16:52.827

我想可以通过将字段设置`Principal`为原始发件人来避免您的问题。

您是否有任何理由开发自己的代理而不是使用内置功能（Domino 目录中的“转发地址”）或邮箱中的“邮件规则”？

# database - 使用面向对象数据库的最佳场景是什么？

> ID：829193
> 
> 赞同：3
> 
> 时间：2009-05-06T11:46:30.560
> 
> 标签：database, oop

我们计划使用 OO 数据库来存储配置对象。选项包括：

1.  创建 300 多个关系表。
2.  创建一个包含几个表的通用结构。我们认为这将使对象关系映射的构建和维护更加复杂。
3.  使用 OO 数据库。我们现在正在对此进行测试。

你怎么看 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-04-16T15:41:32.653

**对象数据库**

*   高性能
*   更快，因为不需要连接
*   固有的版本控制机制
*   操作的导航界面（如图形遍历）
*   对象查询语言以声明方式检索对象
*   复杂数据类型
*   对象身份，即。equals() 对象身份独立于值和更新
*   促进对象共享
*   类和层次结构（继承和封装）
*   支持关系
*   与 ODL 等持久性语言集成
*   支持原子性
*   支持嵌套关系
*   语义建模

缺点

*   没有 RDB 的数学基础（参考 Codd）
*   面向对象的缺点
*   复杂结构难以持久化，一些数据必须是瞬态的

**对象关系数据库**（您可能已经看过 UDT！）

*   支持复杂的数据类型，如集合、多集等
*   面向对象的数据建模
*   扩展的 SQL 和丰富的类型
*   支持UDT继承
*   强大的查询语言

不同的应用程序可能需要不同的方法（OO、关系数据库或 OODB）

**参考**

[OODMS 宣言](http://www.cs.cmu.edu/afs/cs.cmu.edu/user/clamen/OODBMS/Manifesto/htManifesto/Manifesto.html)

[ODMG](http://www.odbms.org/odmg/)

[面向对象的数据库系统宣言](http://www.cs.cmu.edu/afs/cs.cmu.edu/user/clamen/OODBMS/Manifesto/htManifesto/Manifesto.html)

[面向对象的数据库系统](http://www.upriss.org.uk/db/42033lecture_one.html)

[DBMS 中的对象关系数据库](http://www.slideshare.net/koolkampus/ch09)

[Completeness Criteria for Object-Relational Database Systems](http://www.slideshare.net/Databaseguys/completeness-criteria-for-objectrelational-database-systems)

**Comparisons**

[http://en.wikipedia.org/wiki/Comparison_of_object_database_management_systems](http://en.wikipedia.org/wiki/Comparison_of_object_database_management_systems)

[http://en.wikipedia.org/wiki/Comparison_of_object-relational_database_management_systems](http://en.wikipedia.org/wiki/Comparison_of_object-relational_database_management_systems)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:04:28.690

主要阅读（或单个用户）；简单的关系；受约束的对象图深度；约束管理非要求；和宽松的对象标识用例有利于 oo db。

# c# - WPF - 动态工具提示

> ID：829195
> 
> 赞同：3
> 
> 时间：2009-05-06T11:46:43.053
> 
> 标签：c#, wpf, data-binding

我有一个`ToolTipProvider` 有方法的类

```
string GetToolTip(UIElement element) 
```

它将根据各种因素（包括 UIElement 本身的属性）以及查找可以动态更改的文档来返回指定 UIElement 的特定工具提示。它也可能在线程中运行，因此当表单首次启动时，工具提示将类似于 Visual Studio 的“仍在构建文档缓存”，然后在后台填充。

我想允许以任何 wpf 形式使用它，而开发人员只需付出最少的努力。本质上，我想将一个`ObjectDataProvider`资源插入`Window.Resources`到包装我的`ToolTipProvider`对象中，然后我认为我需要`MyToolTipProvider`在引用该 ObjectDataProvider 的资源中创建一个工具提示（称为 eg ），然后在任何需要此工具提示功能的元素上创建一个案例但是我无法解决a）如何将`ToolTip="{StaticResource MyToolTipProvider}"` 实际元素本身绑定到objectdataprovider的MethodParameters，或者b）如何在每次打开工具提示时强制它调用该方法。

关于我需要的一般模式的任何想法/指针？不是在寻找完整的解决方案，只是来自那些更有经验的人的任何想法

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-25T16:13:30.310

1.  创建一个用作工具提示视图工厂的新用户控件。

2.  使用您的控件作为工具提示，使用绑定将工厂所需的任何数据传递给您的控件（例如数据，包含控件，...）

```
<任意控件>
    <AnyControl.ToolTip>
        <YourToolTipControl Content="{Binding}" />
    </AnyControl.ToolTip>
</AnyControl>

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T13:16:00.140

不称自己为专家，但我可能会尝试使用附加属性来实现这样的功能。这将可以附加到 UI 中的任何元素，并且您可以指定一个事件处理程序，该处理程序可以访问要附加属性的对象以及传递给附加属性的值。您可以保留对附加属性所附加到的元素的引用，然后您就可以随时更改工具提示。

# windows-server-2003 - 如何找出哪些应用程序使用 Web 服务器上的资源最多 (Win2003)

> ID：829201
> 
> 赞同：1
> 
> 时间：2009-05-06T11:48:48.837
> 
> 标签：windows-server-2003

我的服务器上有很多 ASP.NET 应用程序/网站（一些自定义构建和一些开源）。我想知道是否有一种免费（或内置于 Win2003）的方式来找出哪些应用程序在一天中使用最多的资源？

CPU（s）和内存的分类......我怀疑其中一个开源应用程序不时占用CPU？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T11:52:43.757

我认为 Windows Perfmon 是您正在寻找的。通常会在流程、总体使用情况等方面为您提供所需的一切。涵盖几乎所有内容、网络、磁盘、内存，并制作一些漂亮的图表。您还可以将日志记录结果导出为 CSV，以便您可以根据需要在 Excel 中构建更好的图表。

哦，我忘了，我不知道该怎么做，那是很久以前的事了，但你也可以让你的应用程序向 Perfmon 发布计数器。我在 Java 中做到了这一点，但我确信 .Net 将提供一种方法来做同样的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:54:43.533

Windows 2003 包含一个称为性能监视器 (perfmon.msc) 的工具，它可以跟踪各种资源。这是一个相当强大和复杂的工具，如果你在谷歌上搜索*“windows 2003”性能计数器*，你可以找到很多入门信息以及如何有效地使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T12:01:52.550

在不同的应用程序池中运行您的网站，然后您可以轻松隔离！

[http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/67e39bd8-317e-4cf6-b675-6431d4425248.mspx?mfr=true](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/67e39bd8-317e-4cf6-b675-6431d4425248.mspx?mfr=true)告诉应用程序池如何在 IIS6 中工作

# linq - Linq 删除超过加入

> ID：829203
> 
> 赞同：1
> 
> 时间：2009-05-06T11:48:59.850
> 
> 标签：linq, join, linq-to-sql

我有一个问题表，它连接到一个解决方案表。解决方案与问题相关联，但为了删除问题，我必须先删除该问题的解决方案，然后再删除问题本身。

我有一个 linq 查询，可以检索特定问题的所有解决方案，但是我不确定如何继续删除解决方案，然后继续删除问题。

这是代码，它收到过载错误消息：

```
public static void DeleteSol(string qTextInput)
{
    ExamineDataContext dc = new ExamineDataContext();
    var matchedSol = from q in dc.Questions
                          where q.QuestionText.Contains(qTextInput)
                          join s in dc.Solutions
                          on q.QuestionID equals s.QuestionID
                          into qs // note grouping        
                          select new
                          {
                              solution = qs
                          };
    try
    {
        dc.Solutions.DeleteOnSubmit(matchedSol);
        dc.SubmitChanges();
    }
    catch (Exception ex)
    {
        throw ex;
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T12:01:30.803

如果您的问题和解决方案之间有外键关系，只需设置它以便传播删除（CASCADE ON DELETE）。这样，您只需删除问题，数据库会自动删除解决方案。

使用外键关系还将为您的问题实体提供一个实体集，该实体集将直接加载相关的解决方案实体并使其成为可能，这样您就可以避免一直编写连接逻辑。您需要在添加外键关系后删除并重新添加实体以供设计器拾取 - 或者您可以在设计器中手动[添加关联](http://msdn.microsoft.com/en-us/library/bb629295.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T11:59:52.587

我认为使用 Join 是问题的根本原因。尝试在 DBML 中创建 Questions 和 Soutions 之间的映射，然后您将能够简单地编写：

```
var questions = from q in Questions where q.QuestionText.Contains(qTextInput);
var solutions = questions.SelectMany(q => q.Solutions);
...
dc.Solutions.DeleteAllOnSubmit(solutions); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T12:12:05.567

问题是那`matchedSol`不是 type `IEnumerable<Solution>`。如果您的代码甚至可以编译，我会感到惊讶。

您需要的是这个（示例使用 LINQ2Objects 但这没有什么区别）：

```
static void Main()
{
    var questions = new[]
                        {
                            new { QuestionID = 1, QuestionText = "ABCDEF" },
                            new { QuestionID = 2, QuestionText = "GHIJKL" },
                            new { QuestionID = 3, QuestionText = "ABCXYZ" },
                        };
    var solutions = new[]
                        {
                            new { QuestionID = 1, Solution = "P" },
                            new { QuestionID = 1, Solution = "Q" },
                            new { QuestionID = 2, Solution = "R" },
                            new { QuestionID = 3, Solution = "S" },
                            new { QuestionID = 3, Solution = "T" },
                            new { QuestionID = 4, Solution = "U" },
                        };
    var qTextInput = "ABC";
    var matchedSol = from q in questions
                     where q.QuestionText.Contains(qTextInput)
                     join s in solutions
                     on q.QuestionID equals s.QuestionID
                     select s;

    foreach (var solution in matchedSol)
    {
        Console.WriteLine("Solution " + solution.Solution +
                          " for question " + solution.QuestionID);
    }
} 
```

LINQ 表达式的结果是具有四种解决方案的可枚举：`P`、`Q`和。这个可枚举可以给你的方法。`S``T``DeleteOnSubmit`

# windows - 在 Windows 中，每个进程和每台机器可以使用多少个同步对象？

> ID：829211
> 
> 赞同：3
> 
> 时间：2009-05-06T11:51:28.567
> 
> 标签：windows, synchronization

一个进程和给定机器上的所有进程可以使用多少同步对象（信号量、事件、临界区）很可能存在限制。这个限制究竟是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T12:10:54.820

对于 Windows，内核句柄（信号量、事件、互斥量）的每个进程限制为`2^24`.

来自[MSDN](http://msdn.microsoft.com/en-us/library/ms724485(VS.85).aspx)：

> 内核对象句柄是特定于进程的。也就是说，进程必须要么创建对象，要么打开现有对象以获取内核对象句柄。内核句柄的每个进程限制为**2^24**。但是，句柄存储在分页池中，因此您可以创建的实际句柄数量取决于可用内存。您可以在 32 位 Windows 上创建的句柄数量明显低于 2^24。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T12:09:03.577

这取决于进程可用的配额。我认为在 XP 中每个进程设置为 10000，但它可以增长。我不确定上限是多少。

刚刚再次检查，10000 限制是针对 GDI 句柄而不是针对内核对象。

# latex - 章节最后一页的页眉宽度

> ID：829212
> 
> 赞同：4
> 
> 时间：2009-05-06T11:52:06.333
> 
> 标签：latex

在使用这个使用 multicols 和 chngpage 包的新环境启动新的 multicols 环境时，我试图关闭 marginpar：

```
\newenvironment{multi}[1]{%
\newlength{\newtextwidth}%
\setlength{\newtextwidth}{\marginparwidth}%
\addtolength{\newtextwidth}{-1cm}%
\addtolength{\headheight}{.5cm}%
\let\oldheadrule\headrule%
\addtolength{\headwidth}{\newtextwidth}%
\begin{adjustwidth}{}{-\newtextwidth}\begin{multicols}{#1}}%
{\end{multicols}\end{adjustwidth}} 
```

效果很好： [乳胶标题 http://img6.imageshack.us/img6/6757/screenshotewa.png](http://img6.imageshack.us/img6/6757/screenshotewa.png)

嗯，几乎，因为在当前章节“Lorem ipsum”的最后一页上，它的行为就像我没有指示它：\addtolength{\headwidth}{\newtextwidth}： [章节末尾的乳胶标题http：/ /img11.imageshack.us/img11/6072/screenshotwbd.png](http://img11.imageshack.us/img11/6072/screenshotwbd.png)

我怎么能解决这个问题？

**编辑**：

我也在使用fancyhdr。

**第二次编辑**：

一个 PoC：

```
\documentclass[12pt,a4paper,oneside]{report}
\usepackage[utf8]{inputenc}
\usepackage[top=2cm,left=2cm,right=4.5cm]{geometry}
\usepackage{chngpage}
\usepackage{color}
\usepackage{amsmath}
\usepackage[pdftex,bookmarks,pdfpagemode=UseOutlines,bookmarksopen,backref
,colorlinks,urlcolor=blue,linktocpage]{hyperref}
\usepackage{url}
\usepackage{amssymb}
\usepackage{lipsum}
\usepackage{fancyhdr}
\usepackage{multicol}
\usepackage{indentfirst}
\usepackage{listings}
\usepackage{boxedminipage}
\pagestyle{fancy}

\setlength{\columnseprule}{1pt}

\setlength{\marginparwidth}{4cm}

\rhead{\large\leftmark}
\renewcommand{\chaptermark}[1]{%
  \markboth{#1}{}}

\makeatletter
\renewcommand*\@makechapterhead[1]{%
  {\parindent \z@ \raggedright \normalfont
    \huge\bfseries
    #1\par\nobreak
    \vskip 20\p@
  }}
\makeatother

\let\oldmarginpar\marginpar
\renewcommand\marginpar[1]{\-\oldmarginpar[\sffamily\raggedleft\footnotesize #1]%
{\sffamily\raggedright\footnotesize
\begin{boxedminipage}{\marginparwidth}#1\end{boxedminipage}
}}

\newenvironment{multi}[1]{%
\newlength{\newtextwidth}%
\setlength{\newtextwidth}{\marginparwidth}%
\addtolength{\newtextwidth}{-1cm}%
\addtolength{\headheight}{.5cm}%
\let\oldheadrule\headrule%
\addtolength{\headwidth}{\newtextwidth}%
\begin{adjustwidth}{}{-\newtextwidth}\begin{multicols}{#1}}%
{\end{multicols}\end{adjustwidth}}

\begin{document}
\tableofcontents

\chapter{Lorem ipsum}
\begin{multi}{2}
\lipsum[1-20]
\end{multi}

\chapter{Lorem ipsum}
\begin{multi}{2}
\lipsum[1-20]
\end{multi}

\chapter{Lorem ipsum}
\begin{multi}{2}
\lipsum[1-20]
\end{multi}

\end{document} 
```

在“multi”之后，应该可以在同一页面上继续单列，但标题必须保持与在“multi”环境中启动页面时一样。

为什么在同一页面上的多列之后需要单列并带有边距？想象一下展示这篇文章的源代码，并在页边空白处添加一些小提示。（这就是列表包的用途）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T13:51:03.363

我怀疑您的最后一个标题框是在您的文本完成制作多列框之后构建的，因此您超出了更改的范围。它回到旧值。

您可能会很好地添加[fancyhdr](http://www.ctan.org/tex-archive/macros/latex/contrib/fancyhdr/)包并使用它。我相信它在多列中表现良好。

好的，所以几乎可以肯定是范围的事情。您正在新`multi`环境中进行调整宽度。当您的文本在多环境中用完时，您还没有填写最后一页；在页面填满之前不会设置标题。因此，您的 mutlti 环境完成了该框，您离开了范围，然后页面完成并发出。使用旧的宽度。

在环境之外设置标题宽度和参数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-10T02:55:19.900

我运行了你的测试文档。它似乎有一个`\newlength{\newtextwidth}`具有全局影响的错误，因此会导致错误。不知道为什么会这样，但我把它拉出来`\newenvironment{multi}`没有任何不良影响。

查理的诊断绝对正确。另一种解决方案是在多列之后但在调整宽度之前结束页面，因此：

```
\newenvironment{multi}[1]{%
   ...}
{\end{multicols}\vfill\break\end{adjustwidth}} 
```

我已经测试了这个解决方案，并且在您的示例文档中，它产生了良好的输出。

# jquery - 用炫酷的动画淡化 DIV

> ID：829218
> 
> 赞同：1
> 
> 时间：2009-05-06T11:53:56.407
> 
> 标签：jquery

我正在慢慢淡化一个 DIV，

```
$(ele).fadeIn('slow'); 
```

我怎样才能创建一个非常好的动画以及淡入淡出来展示jquery的真实动画力量

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T12:13:41.663

您还可以查看[JQuery UI](http://jqueryui.com/)，因为它也允许您为颜色设置动画，或者阅读[这篇](http://devsnippets.com/jquery-posts/20-jquery-plugins-for-unforgettable-user-experience.html)关于插件的文章以获得难忘的用户体验。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T12:00:48.527

你在找什么样的动画？您可以[slideDown()](http://docs.jquery.com/Effects/slideDown)，[slideUp()](http://docs.jquery.com/Effects/slideUp#speedcallback)或使用[animate()](http://docs.jquery.com/Effects/animate#paramsdurationeasingcallback)并定义自己的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-04T06:24:14.363

您可以非常轻松地在 jquery 中执行多个动画：

```
/*you can hide your item with the css property first*/

<style>
 #id_of_what_want_to_animate{display:none;height:1px;}
</style> 
```

然后用jquery揭示它

```
//target the item that triggers the animation
$('#clickthis').click(function() {
   //when clicked animate whatever you want, the 5000 is the duration of the animation in
   //milliseconds inside the curly braces you can animate css properties   
  $('#id_of_what_want_to_animate').animate({opacity: 1,height: '200px'},5000,function() {
    //run something else when your animation complete.
  });
}); 
```

您可以参考 jquery 的详细文档：

[http://api.jquery.com/animate/](http://api.jquery.com/animate/)

# .net - 使用 SvnClient 实现更快的 svn cat

> ID：829220
> 
> 赞同：3
> 
> 时间：2009-05-06T11:54:08.200
> 
> 标签：.net, sharpsvn

我正在寻找一种比 .NET 中的 svn cat 从 SVN 检索文件更快的方法。

目前我正在为每个版本运行一个 svn cat 进程，但它非常慢。

然后我尝试了 SvnClient：

```
 Stream st = Console.OpenStandardOutput();

    SvnWriteArgs wargs = new SvnWriteArgs();

    for (int i = 3140; i < 3155; ++i)
    {
        wargs.Revision = i;

        client.Write(new SvnUriTarget("http://filezilla.svn.sourceforge.net/svnroot/filezilla/FileZilla3/trunk/README"), st, wargs);
    }
    st.Flush(); 
```

但是每次迭代都比svn cat还要慢。

SvnClient 中是否有办法“重用”先前打开的与 SVN 服务器的连接，以便可以更快地运行多个 cat 操作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-16T09:31:55.717

您可以使用 FileVersions 命令来执行此操作。这会获取一个完整的文件，以及使用单个连接中每个修订之间的差异的所有其他文件。这应该会带来很好的性能提升。

```
public void WriteRevisions(SvnTarget target, SvnRevision from, SvnRevision to)
{
    using(SvnClient client = new SvnClient())
    {
        SvnFileVersionsArgs ea = new SvnFileVersionsArgs 
            {
                Start = from,
                End = to
            };

        client.FileVersions(target, ea,
            delegate(object sender2, SvnFileVersionEventArgs e)
                {
                    Debug.WriteLine(e.Revision);
                    e2.WriteTo(...);
                 });
    }
} 
```

这需要支持此功能的服务器。我不太确定它是什么时候引入的，但是运行 SvnBridge 的 Codeplex 不支持它。如果我没记错的话，在这种情况下委托只被调用一次，在这种情况下，你将不得不恢复到你的第一个解决方案。在正常情况下，在开始和结束之间的每个修订都会调用委托。

[请参阅此测试用例](http://sharpsvn.open.collab.net/svn/sharpsvn/trunk/src/SharpSvn.Tests/Commands/FileVersions.cs)中的方法 WalkMe（和其他方法）以查看有关其用法的更多详细信息（用户名 guest，无密码）。

# sql - 从 SSIS 中的发送邮件任务强制包失败

> ID：829221
> 
> 赞同：0
> 
> 时间：2009-05-06T11:54:39.230
> 
> 标签：sql, sql-server-2005, ssis

有没有办法强制一个包从发送邮件任务中失败？我们有一个包，如果满足某些条件，它的最后一步是使用发送邮件任务发送失败消息。通常，我们在邮件任务之后直接创建另一个脚本任务，它使用代码使包失败：

```
Dts.TaskResult = Dts.Results.Failure 
```

有没有办法消除脚本任务并直接从发送邮件任务中失败包？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:05:06.880

我有一个类似的场景，我决定从脚本任务发送电子邮件，而不是使用发送邮件任务。这是我发现将发送电子邮件和失败包合并为一个步骤的唯一方法。

```
Dim Message As MailMessage
Dim Smtp As SmtpClient

Message = New MailMessage("email@domain.com", "email@domain.com", "Packaged Failed", "Package Failed because...")

Smtp = New SmtpClient(Dts.Variables("EmailServer").Value.ToString())
Smtp.Credentials = CredentialCache.DefaultNetworkCredentials
Smtp.Send(Message)

Dts.TaskResult = Dts.Results.Failure 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-13T13:08:49.317

右键单击该任务，并将其设置为 Fail Package 为 true AND Forced value = Failure。（如果它在一个容器中，那么你必须使容器失败，然后容器也使包失败）。

# java - Java/Java EE 的构建和集成环境

> ID：829227
> 
> 赞同：0
> 
> 时间：2009-05-06T11:58:09.237
> 
> 标签：java, build-process, build, continuous-integration, build-automation

以标准方式有这样的事情吗？

包含

Java 源代码 - 测试代码 - Ant 或 Maven JUnit 持续集成（可能是 Cruise Control） ClearCase 版本控制工具部署到应用程序服务器

最后，我想要一个自动构建和集成环境。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T11:59:44.210

听起来像是[哈德森](http://hudson-ci.org/)的工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T12:41:24.997

可能的解决方案没有尽头。查看[持续集成矩阵](http://confluence.public.thoughtworks.org/display/CC/CI+Feature+Matrix)，其中详细介绍了常见解决方案及其相关功能。希望您应该能够基于此做出决定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T12:31:06.833

看看[Apache Continuum](http://continuum.apache.org/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T15:38:08.910

工具集可以是

[智能](http://www.jetbrains.com/idea/index.html)

蚂蚁

*   ant文件可以通过intellij生成
*   然后你需要编写一些 ant 来运行你的测试！
*   然后你需要写一些 ant 来打包你的应用程序
*   然后你需要编写一些 ant 来部署你的应用程序
    *   包括配置队列、数据库等（[dbdeploy](http://dbdeploy.com/)可能适用于此）

[团队城市](http://www.jetbrains.com/teamcity/)

Subversion - 它很好很容易。ClearCase 令人震惊，不要靠近。

如果您正在使用 Java EE，那么您可能会有一个网站，如果是这样，您可能想要使用[WebDriver](http://code.google.com/p/webdriver/)，可能与[WindowLicker一起使用](http://code.google.com/p/windowlicker/)

如果您有数据库或 jms 代理，请确保每个开发人员都有自己的！这非常重要——确保每个人都有一份他们可以随心所欲的副本，显然持续集成 (CI) 环境也必须有自己的副本！

这种环境的回报可能是巨大的。在我当前的项目中，我们有一个直接来自 TeamCity 的两次点击生产自动化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-10T08:48:47.503

我建议以下设置：

Spring Tool Suite [www.springsource.org/‎</a> - 带有用于开发的 maven 插件和用于 repo 管理的 Accurev 插件的 IDE。](http://www.springsource.org/%E2%80%8E)

[](http://www.springsource.org/%E2%80%8E)

[Accurev](http://www.springsource.org/%E2%80%8E) [www.accurev.com](http://www.accurev.com) - 用于源代码存储库/版本管理。

Maven [maven.apache.org](http://maven.apache.org) - 用于构建过程。

Hudson [hudson-ci.org/‎</a> - 自动化构建和集成。](http://hudson-ci.org/)

[](http://hudson-ci.org/)

[JIRA](http://hudson-ci.org/) [www.atlassian.com/JIRA‎</a> - 用于错误/问题跟踪。](http://www.atlassian.com/JIRA%E2%80%8E)

[](http://www.atlassian.com/JIRA%E2%80%8E)

[Rally](http://www.atlassian.com/JIRA%E2%80%8E) [www.rallydev.com](http://www.rallydev.com) - 用于项目管理。

# delphi - {$IFOPT A4}？

> ID：829235
> 
> 赞同：4
> 
> 时间：2009-05-06T12:01:06.233
> 
> 标签：delphi, delphi-2009

在 Delphi 2009（或更早版本）中，如何检查代码中的“Align”编译选项？

该`IFOPT`指令似乎只适用于纯开关（`{$IFOPT A4}`不编译）。

我找不到等效的常量或这样定义的（`{$IF Align = 4}`或这样的）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-10T02:34:37.890

您可以通过使用已知打包规则定义记录并使用 SizeOf 检查它来做到这一点。在 Delphi 2009 中测试：

```
type
  TTestRec = record
    A: Byte;
    B: Int64;
  end;

{$IF SIZEOF(TTestRec) = 9}
  {$MESSAGE HINT '$A1'}
{$ELSEIF SIZEOF(TTestRec) = 10}
  {$MESSAGE HINT '$A2'}
{$ELSEIF SIZEOF(TTestRec) = 12}
  {$MESSAGE HINT '$A4'}
{$ELSEIF SIZEOF(TTestRec) = 16}
  {$MESSAGE HINT '$A8'}
{$ELSE}
  {$MESSAGE HINT 'Unknown alignment'}
{$IFEND} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T15:02:00.807

编写代码来测试实际的运行时行为。只有我能想到的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:00:29.380

有 {$IFOPT A+} 指令，但它没有告诉你对齐值。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-06T13:10:29.797

我相信没有办法做到这一点:(

# windows - 有限用户的 Firebird 连接失败

> ID：829237
> 
> 赞同：1
> 
> 时间：2009-05-06T12:01:33.050
> 
> 标签：windows, firebird, limited-user

在我的 Delphi7 应用程序中，我可以在以管理员身份（“Dave”）登录时连接到数据库，但在以标准或受限用户（“Paris”）身份登录时不能。发生在 XP Home 和 Vista Business Ultimate 64 上。我为 db 使用别名，并尝试将 .fdb 文件放在 Program Files 中、C 驱动器上的应用程序文件夹中以及 Users\Application Data & Documents and settings\应用程序数据。

放置 .fdb 文件是否有经过验证的真实规则？我错过了一些明显的东西吗？

* * *

是时候改写这个问题了。我仍然遇到用户访问受限的相同问题，但现在知道 Firebird 作为服务运行 - 它应该能够在任何地方读/写任何文件。而且，mghie，您建议我尝试使用 isql 访问是天才。我可以作为受限用户连接。我可能在我的应用程序中破坏了某些东西。并且 IBO 绊倒了它。

改写的问题：普遍接受的安装 .fdb 文件的最佳位置是什么？

* * *

是的，我可以将 isql 连接为“Paris”。我怀疑困难与 .fdb 所在的位置有关。a) Program Files\Appname\Appname.fdb b) C:\Appname\Appname.fdb c) C:\Documents and Settings\All Users\Application Data\Appname\Appname.fdb

当数据库（&别名）在所有这些地方时，应用程序不能作为受限用户工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T14:02:19.453

您似乎正在使用 Windows 身份验证来登录数据库，而不是 firebird 的本机身份验证。
您是否尝试过提供用户名和密码？
除此之外，当您尝试连接时，实际的错误消息是什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T20:13:50.550

我不相信受限用户有权将文件写入您命名用于存储 .FDB 文件的大多数位置：

1.  程序文件\Appname\Appname.fdb
2.  C:\Appname\Appname.fdb
3.  C:\Documents and Settings\All Users\Application Data\Appname\Appname.fdb

听起来您正在使用 Firebird 作为嵌入式数据库。在这种情况下，最好的办法是将 FDB 文件存储在每个用户的应用程序数据文件夹中。例如：

```
C:\Documents and Settings\Paris\Application Data\Appname\Appname.fdb 
```

# wpf - WPF 列调整大小性能问题

> ID：829242
> 
> 赞同：3
> 
> 时间：2009-05-06T12:01:56.933
> 
> 标签：wpf, resize, performance

WPF 中通常是否存在与网格列调整大小相关的任何已知性能问题？

我有一个应用程序，我需要在列中做一些特定的事情，但是对于所有不同的解决方案，我发现列调整大小变得很慢。这适用于我的列表中通常有 1000 多个元素的情况，但我认为这对于 WPF 来说并不算多..？所以; 一般的问题是您是否经历过缓慢的列大小调整，以及您是否找到了解决方案？是什么造成的？

有关我的特定案例的更多详细信息：

我的专栏中可以有两种不同的东西；组合框或文本块。ComboBox 应该填充整个列并跟随列调整大小，然后单击具有 TextBlock 的列的空白区域应该选择该行。这就是问题所在。对于我必须解决的所有解决方案，列调整大小会变慢。我发现使调整大小变得平滑的唯一方法是在它们之外添加一个 StackPanel，并使用 Orientation="Horizo​​ntal"，但是这样我无法实现上述样式。

以下是一些观察：

*   将样式 Horizo​​ntalContentAlignment="Stretch" 添加到列表的项目使 ComboBoxes 拉伸并且 TextBlocks 可点击，但列调整大小也很慢。
*   将 Background="Transparent" 添加到 StackPanel 或插入其中的元素也可以解决问题，但会使调整大小变慢。
*   添加具有属性 Orientation="Horizo​​ntal" 的外部 StackPanel 使调整大小变得平滑，但我无法应用所描述的样式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T12:17:29.877

您是否尝试过虚拟化 ListView 中的元素？当您进行虚拟化时，虚拟化面板只会为视图中的元素创建视觉效果。这使您可以拥有大量项目而不会出现您提到的性能问题。有关详细信息，请参阅[VirtualizingStackPanel 。](http://msdn.microsoft.com/en-us/library/system.windows.controls.virtualizingstackpanel.aspx)还有[布局系统](http://msdn.microsoft.com/en-us/library/ms745058.aspx)。您可以创建自己的虚拟化面板。如果你在谷歌上查找“virtualizing+wpf”，你会发现很多关于虚拟化 Canvas、WrapPanel 等的点击。

我希望这有帮助。

# database - 预生成 Guid 并将其作为主键插入表中有多安全？

> ID：829244
> 
> 赞同：1
> 
> 时间：2009-05-06T12:02:31.253
> 
> 标签：database, language-agnostic

我以前见过很多情况，PK 是没有默认值的 Guid，因此开发人员会生成随机 Guid 并使用它们插入数据库。

我经常想知道他们生成一个已经存在的数字的可能性有多大？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T12:03:49.707

一些信息： 16 个字节可以容纳的值的数量是 2^128。

Total = 可以表示的总值的数量

实际 = 已使用的值数

将 ID 插入到已经存在的表中的概率可以表述为：

1 - （总计 - 实际）/总计

我做了一些初步计算，得出以下结论：

假设您有一个表中已经有 1000 万条记录，那么概率是

1 - (2 ^ 128 - 10,000,000) / 2 ^ 128

这大约是

0.000000000000000000000000000000003

我想现在我知道为什么这么说：

“虽然不能保证每个生成的 GUID 都是唯一的，但唯一键的总数是如此之大，以至于两次生成相同数字的概率非常小”

[来自维基](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)

# c# - IsPostBack 实际上是什么意思？

> ID：829249
> 
> 赞同：7
> 
> 时间：2009-05-06T12:04:43.790
> 
> 标签：c#, asp.net

我很想知道 Page.IsPostBack 的具体含义。我完全了解它在标准 ASP.NET 页面中的日常使用，它表明用户正在将数据提交回服务器端。查看[页面：IsPostBack 属性](http://msdn.microsoft.com/en-us/library/system.web.ui.page.ispostback.aspx)

但是鉴于这个 HTML

```
<html>
   <body>
      <form method="post" action="default.aspx">
         <input type="submit" value="submit" />
      </form>
   </body>
</html> 
```

单击提交按钮时，将调用页面 Page_Load 方法，但 Page.IsPostBack 返回 false。我不想添加`runat=server`。

如何区分第一次加载的页面和客户端点击提交引起的请求？

**更新**
我添加了`<input type="text" value="aa" name="ctrl" id="ctrl" />`所以 Request.Form 有一个元素，并且 Request.HTTPMethod 是 POST，但 IsPostBack 仍然是假的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T12:10:16.210

检查 Request.Form 集合以查看它是否为非空。只有 POST 将在 Request.Form 集合中包含数据。当然，如果没有表单数据，则请求与 GET 无法区分。

至于标题中的问题，当请求是来自服务器端表单控件的 POST 时，IsPostBack 设置为 true。仅将您的表单设置为客户端会破坏这一点。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-06T12:31:15.833

一种方法是扩展 ASP.NET Page 类，“覆盖” IsPostBack 属性并让所有页面都派生自扩展页面。

```
public class MyPage : Page
{
    public new bool IsPostBack
    {
        get 
        { 
          return 
            Request.Form.Keys.Count > 0 &&
            Request.RequestType.Equals("POST", StringComparison.OrdinalIgnoreCase); 
         }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T12:09:15.263

在您在问题中包含的示例中，不涉及视图状态；服务器无法将此请求链接到页面的先前请求并将它们视为一个单元。导致单击按钮的请求看起来就像进入服务器的任何其他随机请求一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T12:18:40.980

通常，您可以将 PostBack 视为以下各项的组合：

1.  HTTP 请求方法等于“POST”
2.  HTTP 标头 HTTP_REFERER 等于当前 URL

这不是 100% 万无一失的，它没有考虑任何类型的状态（即使您不知道，您也可能想要），但它是一个**帖子**，**返回**当前页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T12:09:15.997

您可以检查标题以查看您的*输入*控件是否返回一个值（使用 Request.Forms tvanfosson 指出）。然而，真正的大问题是为什么你*不想*添加 runat=server. ASP.NET 实现的整个页面处理大厦（MVC 除外）依赖于通过服务器处理页面输出，为回调等设置适当的客户端代码。

# javascript - 如何跨浏览器查找 HTML 按钮或图像的坐标？

> ID：829252
> 
> 赞同：7
> 
> 时间：2009-05-06T12:07:10.993
> 
> 标签：javascript, html, dom

最近在 comp.lang.javascript 中有一个线程，其中宣布了胜利但没有发布代码：

在 HTML 页面上，如何可靠地跨浏览器和页面样式找到元素（例如图像或按钮）的左下角坐标？在某些情况下，“Ajax in Action”（我有副本）中提倡的方法在 IE 中似乎不起作用。为了使问题更容易，我们假设我们可以将全局文档样式设置为“传统”或“过渡”或其他。

请提供代码或代码指针（适用于所有浏览器的完整功能）——不要只说“这很容易”并喋喋不休地谈论遍历 DOM 的内容——如果我想读那种东西我'我会回到 comp.lang.javascript。如果这是重复，请骂我并指出解决方案——我确实试图找到它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T12:23:01.720

根据我的经验，让这样的东西正常工作的唯一可靠方法是使用[JQuery](http://docs.jquery.com/CSS)（不要害怕，它只是你必须包含的外部脚本文件）。然后你可以使用如下语句

```
$('#element').position() 
```

或者

```
$('#element').offset() 
```

获取当前坐标，它在我迄今为止遇到的任何和所有浏览器中都能很好地工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-05T18:27:15.817

我从网上找到了这个解决方案......这完全解决了我的问题。请检查此链接的来源。 [http://www.quirksmode.org/js/findpos.html](http://www.quirksmode.org/js/findpos.html)

```
/** This script finds the real position, 
 * so if you resize the page and run the script again, 
 * it points to the correct new position of the element.
 */
function findPos(obj){
   var curleft = 0;
   var curtop = 0;

   if (obj.offsetParent) {
      do {
         curleft += obj.offsetLeft;
         curtop += obj.offsetTop;
      } while (obj = obj.offsetParent);

      return {X:curleft,Y:curtop};
   }
} 
```

在 Firefox、IE8、Opera 中完美运行（希望其他人也如此）感谢那些分享他们知识的人......问候，

**动态麦克风**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T13:26:40.350

我一直在使用它，适用于 IE 和 Firefox。

```
var Target = document.getElementById('SomeID');
var Pos = findPos(目标);

AnotherObj = document.getElementById('AnotherID');
另一个对象 .style.top = Pos[1] + "px";
另一个对象 .style.left = Pos[0] + "px";

//------------------------------------
函数 findPos(obj) {
//----------------------------------------
    var curleft = curtop = 0;
    如果（obj.offsetParent）{
    做 {
            curleft += obj.offsetLeft;
            curtop += obj.offsetTop;
    } 而 (obj = obj.offsetParent);
    返回 [curleft,curtop];
    }
}

```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T12:17:16.927

试试这个：

```
var elm = document.getElementById('foo');
var point = {x:0,y:elm.offsetHeight}; // Change to y:0 to get the top-left

while (elm)
{
    // This will get you the position relative to the absolute container,
    // which is what you need for positioning an element within it
    if (elm.style.position == 'absolute')
        break;

    point.x += elm.offsetLeft;
    point.y += elm.offsetTop;

    elm = elm.offsetParent;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T12:21:24.593

在 jQuery 中：

```
var jq = $('#yourElement');
var position = jq.offset();
alert('x: ' + position.left + ', y: ' + position.top);

var bottomLeftPixelPosition =
    { left: position.left, top: position.top + jq.height() - 1; }; 
```

# wcf - WCF 票证基础身份验证

> ID：829254
> 
> 赞同：2
> 
> 时间：2009-05-06T12:07:41.477
> 
> 标签：wcf, authentication

我正在编写使用 wsHttpBinding 绑定的 WCF 服务，该绑定不在 IIS 中，而是在 Windows 服务中。我想在服务中有一个 Login(user,pass) 方法，如果用户有效，它将给客户端一张票。

谁能帮助我了解如何在 WCF 中实现票证基础身份验证？是否有任何标准机制或者我必须实施自己的机制？我还想为服务中的每个用户存储其他数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T10:49:50.570

我找到了解决方案，我不知道是否有任何标准机制，但这里的帖子可以帮助我解决问题......
[http://blogs.microsoft.co.il/blogs/bursteg/archive/2006 /04/23/141.aspx](http://blogs.microsoft.co.il/blogs/bursteg/archive/2006/04/23/141.aspx)
如果用户有效，我只是从登录方法返回票证，并在每次调用中发送带有消息头的令牌，可以在其他服务调用中检查

# .net - 你会在棋盘上做什么？（片位）

> ID：829255
> 
> 赞同：3
> 
> 时间：2009-05-06T12:07:58.073
> 
> 标签：.net, algorithm, chess

你会创建3个列表（坐标）

*   空位
*   黑位
*   白位

或者只是在需要时循环遍历数组并每次都使用结果？

什么是最好的？（速度方面）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T12:09:43.687

您的两个主要选择是在速度和代码清晰度之间。

如果速度是您的首要任务，那么您必须为棋盘上的每组棋子使用 64 位数据类型（例如白棋子、黑棋子、过路棋子）。然后，您可以在生成移动和测试移动合法性时利用本机按位运算。

如果代码的清晰性是优先考虑的，那么忘记位改组并像其他人已经建议的那样选择很好的抽象数据类型。请记住，如果您采用这种方式，您可能会达到性能上限。

首先，请查看[Crafty](http://en.wikipedia.org/wiki/Crafty) (C) 和[SharpChess](http://sharpchess.com/) (C#) 的代码。

（原贴[在这里](https://stackoverflow.com/questions/39874/how-do-i-model-a-chessboard-when-programming-a-computer-to-play-chess/39926#39926)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T12:21:29.430

您正在寻找的是*董事会代表*。[Chess Programming Wiki](https://www.chessprogramming.org/Board_Representation)有关于该主题的非常详细的部分（如果您认真编写 AI，绝对值得一读），而[Wikipedia](http://en.wikipedia.org/wiki/Board_representation_(chess))提供了有关该主题的很好的概述。

在选择合适的棋盘表示时要深思熟虑是很重要的——它们都有自己独特的优势（和缺陷）——主要与某些操作的速度/执行有关，例如执行移动和评估棋盘状态（通常从 O( 1) 到 O(n) 时间复杂度取决于方法和任务）。据我所知，对于“最佳”板表示仍然没有达成共识，尽管现在有些人通常比其他人更喜欢（[例如](http://chessprogramming.wikispaces.com/Bitboards)，位板几乎是必备品）。这就是为什么大多数强大的国际象棋 AI 在搜索移动时通常使用几种（最多 4 或 5 个）不同的棋盘表示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T18:35:01.060

我会建议一个包含 64 个项目的数组，例如：

```
byte [64] Squares; 
```

这样你只需要用一个字节来表示棋盘的位置，速度要快得多。

在处理参考棋盘位置的单个索引时，必须知道某些事情才能使生活更轻松。例如，您如何知道两个位置都在同一行或同一列？有一个简单的技巧可以解决这个问题。

**排**

要找出位置的行，您将位置除以 8 并取结果的整数部分。例如，位置 63 除以 8 为 7.875，等于第 7 行。位置 3 除以 8 为 0.375，因此为 0。在 C# 中，通过转换为整数，您将始终只获得数字的整数部分，因此：

```
Row = (int)(position / 8) 
```

**柱子**

要找出位置的列，您可以通过执行位置模数 8 来使用模数运算符。例如，位置 24 模数 8 是第 0 列。位置 15 模数 8 是 7，因此

```
Column = position % 8 
```

有了这两个概念，我们可以将 64 平方板上的任何位置转换为列和行。

如果您想了解有关创建自己的国际象棋引擎的更多信息，请[访问 http://www.chessbin.com](http://www.chessbin.com)

# fitnesse - 如何配置 Fitnesse 以自动将 Test 属性添加到以“Tests”结尾的所有页面

> ID：829256
> 
> 赞同：0
> 
> 时间：2009-05-06T12:08:00.320
> 
> 标签：fitnesse

我的默认配置[fitnesse自动将Test属性添加到所有以“Test”结尾的页面。](http://fitnesse.org/FitNesse.PageProperties)

但是，在我正在工作的项目中，我必须将 Test 属性添加到所有以“Tests”结尾的页面。不幸的是，重命名所有页面以使它们以“测试”结尾不是我的选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T23:54:16.183

由于 Fitnesse 的 2008xxxx 版本，任何以 Test 开头或结尾的页面都会自动设置为测试页面，并且任何以 Suite 开头或结尾的页面都将设置为套件。这是在创建页面时完成的，仅通过重命名页面可能不起作用。

注意：如果你有大量的测试页面需要改造，你可以使用wingrep/grepwin（或者其他一些可以进行大规模文件搜索和替换的工具，我个人使用grepwin）并通过插入来操作properties.xml

```
<Test>true</Test> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T13:47:44.980

通过以下方式之一设置页面测试属性： 1\. 访问页面，单击属性，选中测试复选框。
2\. 使用?properties 访问页面，选中测试复选框
3\. 修改与页面关联的properties.xml 文件以包含块内的标记。

对于大量文件，方法 3 最容易实现自动化。
可能可以使用 grep 文件实用程序进行大规模搜索和替换。
或脚本（powershell）或程序来读取文件并在需要时添加此标签。

# sql-server - 如何从 SSMS 2005 中编辑 SQL 代理作业？

> ID：829259
> 
> 赞同：1
> 
> 时间：2009-05-06T12:08:05.687
> 
> 标签：sql-server, scheduled-tasks, edit, sql-server-agent

我正在尝试从 SSMS 2005 编辑或查看 SQL 代理的作业（我是该作业的所有者），但我不知道如何执行此操作。当我双击一个作业或输入作业的属性时，我得到空的“新作业”窗口。

有什么方法可以纠正这种行为吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T12:20:17.373

您可以为 SQL 作业生成 SQL 脚本，然后对其进行编辑。右键单击作业，然后单击生成 SQL 脚本。在这里您还可以使用 sql 脚本更改作业属性

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:15:43.860

我建议你明确地创建一个新工作，然后尝试以同样的方式编辑你的新工作，看看会发生什么。

特别是，您的旧工作可能真的*是*空的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T14:07:07.193

不确定您对 SSMS 的问题是什么。也许你没有权限？除非您的 sa 您需要成为 MSDB 中 SQLAgentOperatorRole 的成员？

如果您仍然可以运行查询，请查看 MSDB 数据库中的*sysjobs*和*sysjobsteps*表，它具有所有属性您可以使用[*sp_update_job*](http://technet.microsoft.com/en-us/library/ms188745.aspx)修改作业

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:35:34.083

我不久前遇到了这个问题。我不完全确定是什么原因造成的，但修复方法是将 sql server 的 sp2 安装到我的本地机器（或您使用 ssms 的任何机器）上。我当时发现的唯一文件表明这是唯一的解决方案。

# c# - 用于处理 Ajax 弹出窗口的 Watin 脚本

> ID：829262
> 
> 赞同：1
> 
> 时间：2009-05-06T12:09:00.893
> 
> 标签：c#, .net, watin

我正在使用 WatiN 测试工具，并且正在编写 c#.net 脚本。我有一个需要更改网页主题的场景，所以要做到这一点，我需要单击一个图像按钮，该按钮打开一个带有图像的 ajax 弹出窗口，现在我在图像下方的“应用主题”按钮需要点击按钮所以如何做到这一点请提出一些解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T16:12:39.630

因此，首先单击弹出弹出窗口的按钮，然后单击弹出窗口内的按钮 .WaitUntilExists()。

```
IE.Button("ShowPopup").click()
IE.Button("PopupButtonID").WaitUntilExists()
IE.Button("PopupButtonID").click() 
```

如果弹出窗口上的按钮存在但从视图中隐藏，这可能不起作用。在这种情况下，您可以尝试 .WaitUntil() 并指定要查找的属性。

```
IE.Button("ButtonID").WaitUntil("display","") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T09:15:42.817

如果您以异步方式处理控件加载的时间，那么 Ajax 弹出窗口本身不会造成问题。如果你使用的是ajax控制工具包，可以这样解决

```
int timeout = 20;
for (i=0; i < timeout; i++)
{
    bool blocked = Convert.ToBoolean(ie.Eval("Sys.WebForms.PageRequestManager.getInstance().get_isInAsyncPostBack();"));
    if (blocked)
    {
       System.Threading.Thread.Sleep(200);
    }
    else
    {
        break;
    }
 } 
```

随着控件可见，您应该能够正常访问它。

Watin 1.1.4 在控件上也增加了对 WaitUntil 的支持，但我个人没有使用过。

```
// Wait until some textfield is enabled
textfield.WaitUntil("disable", false.ToSting, 10); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-06T17:04:07.123

我写了一篇关于我如何进行 ajax 同步的帖子，因为我遇到了 WaitUntilExists 的问题：http: [//lebobitz.wordpress.com/2011/03/06/synchronizing-watin-and-ajax-with-jquery/](http://lebobitz.wordpress.com/2011/03/06/synchronizing-watin-and-ajax-with-jquery/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T12:24:55.730

我没有使用任何 ajax 控件工具包，并且在弹出窗口中没有文本字段，因为我已经提到它下面只有一个图像和一个按钮，我需要单击它才能将该图像应用为主题。

# c# - 如何在运行时获取构建配置？

> ID：829276
> 
> 赞同：19
> 
> 时间：2009-05-06T12:13:44.160
> 
> 标签：c#, configuration

有谁知道如何`$(Configuration)`在 C# 代码中获取当前的构建配置？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-01-12T00:07:40.673

如果您卸载项目（在右键菜单中）并将其添加到`</Project>`标签之前，它将保存一个包含您的配置的文件。然后，您可以将其读回以在您的代码中使用。

```
<Target Name="BeforeBuild">
    <WriteLinesToFile File="$(OutputPath)\env.config" 
                      Lines="$(Configuration)" Overwrite="true">
    </WriteLinesToFile>
</Target> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-06T12:29:27.663

**更新**

Egors 对这个问题的回答（[在](https://stackoverflow.com/a/60545278/18797)这个答案列表中）是正确的答案。

~~你不能，不是真的。
您可以做的是定义一些“条件编译符号”，如果您查看项目设置的“构建”页面，您可以在那里设置这些，因此您可以编写#if 语句来测试它们。~~

为调试构建自动注入一个 DEBUG 符号（默认情况下，可以关闭它）。

所以你可以写这样的代码

```
#if DEBUG
        RunMyDEBUGRoutine();
#else
        RunMyRELEASERoutine();
#endif 
```

~~但是，除非你有充分的理由，否则不要这样做。在调试和发布版本之间使用不同行为的应用程序对任何人都没有好处。~~

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2020-03-05T12:19:28.413

.NET 中有[AssemblyConfigurationAttribute](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assemblyconfigurationattribute?f1url=https%3A%2F%2Fmsdn.microsoft.com%2Fquery%2Fdev16.query%3FappId%3DDev16IDEF1%26l%3DEN-US%26k%3Dk(System.Reflection.AssemblyConfigurationAttribute);k(DevLang-csharp)%26rd%3Dtrue&view=netframework-4.8)。您可以使用它来获取构建配置的名称

```
var assemblyConfigurationAttribute = typeof(CLASS_NAME).Assembly.GetCustomAttribute<AssemblyConfigurationAttribute>();
var buildConfigurationName = assemblyConfigurationAttribute?.Configuration; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-04-16T05:04:34.607

条件编译符号可以用来实现这一点。您可以在每个项目的属性 > 构建设置窗格中定义自定义符号，并使用 #if 指令在代码中测试它们。

示例显示如何定义符号 UNOEURO 以及如何在代码中使用它。

![此处定义的 UNOEURO 符号](https://i.stack.imgur.com/cpHb2.png)

```
bool isUnoeuro = false;
#if UNOEURO
    isUnoeuro = true;
#endif 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-01-09T15:58:54.503

1.  安装[SlowCheetah](https://marketplace.visualstudio.com/items?itemName=vscps.SlowCheetah-XMLTransforms) Visual Studio 扩展。
2.  右键单击您的配置文件并选择“添加转换”。

[![添加变换](https://i.stack.imgur.com/VgXxp.png)](https://i.stack.imgur.com/VgXxp.png)

3.  请注意每个构建配置的转换。

[![为每个构建配置转换](https://i.stack.imgur.com/fZQO0.png)](https://i.stack.imgur.com/fZQO0.png)

4.  将“构建”appSetting 放入根配置文件：

```
 <?xml version="1.0" encoding="utf-8" ?>
    <configuration>
        <startup> 
          <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.8" />
        </startup>
      <appSettings>
        <add key="Build" value="" />
      </appSettings>
    </configuration> 
```

5.  并在每个转换中放置一个“构建”指令：

```
 <?xml version="1.0" encoding="utf-8"?>
    <!--For more information on using transformations see the web.config examples at http://go.microsoft.com/fwlink/?LinkId=214134\. -->
    <configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
      <appSettings>
        <add key="Build" value="Debug" xdt:Transform="Replace" xdt:Locator="Match(key)"/>
      </appSettings>
    </configuration> 
```

6.  然后在您的 C# 代码中获取“Build”appSetting 值：

`ConfigurationManager.AppSettings["Build"]`

* * *

*   请注意，您在调试时**不会**看到转换：[https ://stackoverflow.com/a/17336009/109941](https://stackoverflow.com/a/17336009/109941)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-05-24T15:45:46.873

您可以使用带有条件属性的通用静态方法来设置标志以检测 DEBUG 或 RELEASE 模式。只有在调试模式下运行时才会调用 SetDebugMode 方法，否则会被运行时忽略。

```
public static class AppCompilationConfiguration
{
    private static bool debugMode;

    private static bool IsDebugMode()
    {
        SetDebugMode();
        return debugMode;
    }

    //This method will be loaded only in the case of DEBUG mode. 
    //In RELEASE mode, all the calls to this method will be ignored by runtime.
    [Conditional("DEBUG")]
    private static void SetDebugMode()
    {
        debugMode = true;
    }

    public static string CompilationMode => IsDebugMode() ? "DEBUG" : "RELEASE";

} 
```

您可以在下面的代码中调用它

```
 Console.WriteLine(AppCompilationConfiguration.CompilationMode); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T12:36:01.797

我不相信您可以在编译时将其注入程序集，但实现它的一种方法是使用 MSBuild 并将其添加到应用程序的配置文件中。

请参阅此博客文章，了解如何使用 MSBuild 执行多环境配置文件 - [http://adeneys.wordpress.com/2009/04/17/multi-environment-config/](http://adeneys.wordpress.com/2009/04/17/multi-environment-config/)

或者，您可以编写一个 MSBuild 任务，该任务将编辑某个编译文件（您的 C# 或 VB 文件）并在`BeforeBuild`任务中运行。这会相当棘手，因为您需要确定将其注入文件的位置，但如果您设置了某种标记化，您应该能够做到。我也怀疑它会很漂亮！

# database - GUID 与 INT 身份

> ID：829284
> 
> 赞同：39
> 
> 时间：2009-05-06T12:17:35.930
> 
> 标签：database, primary-key, guid

> **可能重复：**
> [你喜欢你的主键吗？](https://stackoverflow.com/questions/404040/how-do-you-like-your-primary-keys)

我知道使用 GUID 的好处，以及使用和 INT 作为数据库中的 PK 的好处。考虑到 GUID 本质上是 128 位 INT，而普通 INT 是 32 位，因此 INT 可以节省空间（尽管这一点在大多数现代系统中通常没有实际意义）。

最后，在什么情况下，您会认为自己使用 INT 作为 PK 还是使用 GUID？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-06T12:23:58.707

Kimberley Tripp (SQLSkills.com) 有[一篇](http://www.sqlskills.com/BLOGS/KIMBERLY/post/GUIDs-as-PRIMARY-KEYs-andor-the-clustering-key.aspx)关于使用 GUID 作为主键的文章。由于不必要的开销，她建议不要这样做。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-06T12:31:11.717

回答您的问题：最后，在什么情况下您会认为自己使用 INT 作为 PK 还是使用 GUID？

如果我的系统有一个在线/离线版本，您可以在离线版本中保存数据并且该数据在一天同步期间传输回服务器，我将使用 GUID。这样，您可以确定您的数据库中不会有两次相同的密钥。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-05-06T12:40:25.717

我们在非常复杂的企业软件中到处都有指南。工作顺利。

我相信 Guid 在语义上更适合用作标识符。在您遇到该问题之前，不必要地担心性能也是没有意义的。当心过早的优化。

任何类型的数据库迁移也有一个优势。使用Guids，您将不会发生碰撞。如果您尝试合并多个使用 int 表示身份的 DB，则必须替换它们的值。如果在 url 中使用了这些旧值，那么在 SEO 命中后它们现在会有所不同。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-05-06T12:38:02.947

除了在需要同步多个数据库实例时是一个糟糕的选择之外，INT 还有一个我没有提到的缺点：插入总是发生在索引树的一端。当您有一个有大量移动的表时，这会增加锁争用（因为相同的索引页面必须通过并发插入来修改，而 GUID 将被插入整个索引）。如果使用 B* 树或类似的数据结构，则可能还必须更频繁地重新平衡索引。

当然，在进行手动查询和报告构建时，int 更容易使用，并且空间消耗可能会因 FK 的使用而增加。

我很想看看 SQL Server 实际处理带有 IDENTITY PK 的插入繁重的表的任何测量结果。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-05-06T12:32:36.050

> INT 可以节省空间（尽管这一点在大多数现代系统中通常没有实际意义）。

不是这样。乍一看似乎如此，但请注意，每个表的主键将在整个数据库的索引中重复多次，并在其他表中作为外键重复。并且它将参与几乎所有包含其表的查询 - 当它是用于连接的外键时非常密集。

此外，请记住，现代 CPU 非常非常快，但 RAM 速度却跟不上。缓存行为因此变得越来越重要。获得良好缓存行为的最佳方法是拥有更小的数据集。因此，4 和 16 字节之间看似无关的差异很可能会导致速度上的明显差异。不一定总是 - 但这是需要考虑的事情。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-05-06T12:25:22.493

在比较主键与外键关系等值时，INT 会更快。如果表的索引正确并且表很小，您可能不会看到减速太多，但您必须尝试一下才能确定。INT 也更容易阅读，也更容易与他人交流。说“你能看一下记录 1234 吗？”要简单得多。而不是“你能看一下记录 031E9502-E283-4F87-9049-CE0E5C76B658 吗？”

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-06T12:35:47.523

如果您计划在某个阶段合并数据库，即多站点复制类型设置，Guid 将节省很多痛苦。但除此之外，我发现 Int 更容易。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-05-06T12:31:17.080

如果数据存在于单个数据库中（就像我们通常编写的应用程序的大多数数据一样），那么我使用`IDENTITY`. 它很容易，旨在以这种方式使用，不会分散聚集索引并且绰绰有余。您将用完 20 亿条记录（如果使用负值，则大约 40 亿条记录），但是如果您在一张表中有这么多记录，那么您无论如何都会敬酒，然后您就会遇到数据仓库问题。

如果数据存在于多个独立的数据库中或与第三方服务的接口中，那么我将使用`GUID`可能已经生成的数据。一个很好的例子是数据库中的 UserProfiles 表，它通过`objectGUID`分配给他们的 Active Directory 将 Active Directory 中的用户映射到应用程序中的用户配置文件。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-05-06T12:28:00.537

一些操作系统不再基于独特的硬件功能（CPUID、MAC）生成 GUID，因为它使跟踪用户变得容易（隐私问题）。这意味着 GUID 的唯一性通常不再像许多人想象的那样普遍。

如果你使用数据库的一些自动识别功能，理论上数据库可以绝对确保没有重复。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-06T12:28:09.740

我一直认为 PK 应该是可能的数字。不要忘记将 GUID 作为 PK 可能意味着它们也在其他表中用作外键，因此分页和索引等会更大。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-06T12:29:18.897

我认为数据库也很重要。从 MySQL 的角度来看 - 通常，数据类型越小，性能越快。

它似乎也适用于 int vs GUID - [http://kccoder.com/mysql/uuid-vs-int-insert-performance/](http://kccoder.com/mysql/uuid-vs-int-insert-performance/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-06T12:29:22.500

仅当此键绑定到相似值时，我才会将 GUID 用作 PK。例如，用户 id（WinNT 中的用户用 GUID 描述）或用户组 id。另一个例子。如果你开发分布式文件管理系统，世界各地不同系统的不同部分都可以创建一些文件。在这种情况下，我会使用 GUID，因为它保证在分布式系统的不同部分创建的 2 个文档不会具有相同的 ID。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-06T12:20:54.283

INT 在调试时肯定更容易阅读，而且更小。

但是，我会使用 GUID 或类似的东西作为产品的许可证密钥。你知道它会是独一无二的，而且你知道它不会是连续的。

# ms-access - 在 ms access 2007 的下拉列表中使用活动目录用户列表

> ID：829289
> 
> 赞同：0
> 
> 时间：2009-05-06T12:19:17.470
> 
> 标签：ms-access, active-directory

在工作中，我们有 Windows Server 2003。在我的访问数据库中，我需要链接到用户/组数据，以便它可以填充下拉列表，从而可以与数据库记录相关联。有谁知道如何做到这一点？

谢谢，

克里斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-31T11:53:00.980

尝试这样的事情：

```
 'Use ADO and LDAP to return all users in Active Directory
Dim objRecordSet As Object
Dim objCommand As Object
Dim objConnection As Object

Const ADS_SCOPE_SUBTREE = 2

Set objConnection = CreateObject("ADODB.Connection")
Set objCommand = CreateObject("ADODB.Command")
objConnection.Provider = "ADsDSOObject"
objConnection.Open "Active Directory Provider"
Set objCommand.ActiveConnection = objConnection

objCommand.Properties("Page Size") = 1000
objCommand.Properties("Searchscope") = ADS_SCOPE_SUBTREE
objCommand.Properties("Sort On") = "Name"

objCommand.CommandText = _
    "SELECT Name FROM 'LDAP://dc=<enter domain controler server name here>,dc=<enter full AD domain name here>' WHERE objectCategory='user'"
Set objRecordSet = objCommand.Execute

objRecordSet.MoveFirst
Do Until objRecordSet.EOF
    Debug.Print objRecordSet.Fields("Name").Value
    objRecordSet.MoveNext
Loop 
```

这应该得到用户列表。请注意，您必须提供域控制器服务器名称和 AD 域名。

希望这有助于马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-09T12:01:47.947

我刚刚将 AD 与 Access 集成。这是一个很好的解释和示例代码： [http ://www.accesssecurityblog.com/post/2011/02/05/Securing-Access-databases-using-Active-Directory.aspx](http://www.accesssecurityblog.com/post/2011/02/05/Securing-Access-databases-using-Active-Directory.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:31:56.610

我从来没有这样做过，但我读过它涉及通过 ADO 进行的 LDAP 查询，但不知道实际的提供程序名称或所需的连接字符串。您可以在此站点中搜索有关对 AD 进行 LDAP 查询的文章以获取一些示例。它们不会是 Access 答案，但它们可能会向您展示如何在 Access 中执行。

# c# - 存储过程输出参数+选择不传回输出参数

> ID：829292
> 
> 赞同：4
> 
> 时间：2009-05-06T12:19:58.530
> 
> 标签：c#, parameters, datareader

我有一个存储过程，它返回我使用 GetReader 调用的两个记录集。我迭代第一个，调用 IDataReader.NextResult()，然后迭代第二个。

我在 sp 中为输出参数赋值，但是当我在阅读器完成后检查值时，我的输出参数为空。看起来像一个错误。我不想使用选择，因为我不喜欢软糖。一些片段...

...

```
sp.Command.AddParameter("@SelectedTabID", selectedTabID, DbType.Int32);
sp.Command.AddParameter("@CurrentTabID", 0, DbType.Int32, ParameterDirection.Output);
sp.Command.AddParameter("@TypeID", 0, DbType.Int32, ParameterDirection.Output); 
```

（注意这样做或使用 AddOutputParameter() 会产生相同的结果）

...

```
using(IDataReader reader = sp.GetReader())
{
  while (reader.Read()) {...}
  if (reader.NextResult()) {while (reader.Read()) {...}}

} 
```

...

```
int one = (int)sp.OutputValues[0]; //null expected an int
int two = (int)sp.OutputValues[1]; //null expected an int 
```

期待一些智慧的宝石:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-11-16T05:19:12.293

您需要先关闭阅读器，然后检索输出参数。阅读器打开时，输出参数返回 null。

更多信息可以在这里找到 [http://amilagm.com/2010/11/output-variable-values-not-returned-from-sql-server-sp-in-c-sharp/](http://amilagm.com/2010/11/output-variable-values-not-returned-from-sql-server-sp-in-c-sharp/)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-10T20:14:16.517

获取输出参数的最简单方法是使用实​​例化变量。我的意思是保留对您的参数的引用，然后在执行存储过程后，您可以像这样检查它们：

```
SqlCommand cmd = new SqlCommand();
cmd.Connection = ConfigurationManager.ConnectionStrings["MyCon"].ToString();
cmd.CommandText = "MySproc";

SqlParameter parmOut = new SqlParameter("@StuffIWant", SqlDbType.Int);
parmOut.Direction=ParameterDirection.Output; 

cmd.Parameters.Add(parmOut);
cmd.ExecuteNonQuery();

string theThingIWant = parmOut.Value.ToString(); 
```

这可能没有使用数据阅读器，但您可以使用它来找到正确的答案。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T12:30:24.930

这是亚音速失败，可以作为沼泽标准 SQLConnection/Command 正常工作

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T12:31:58.517

这里有点困惑...您期望输出标量值还是某种记录集？只有当您有一些光标作为输出参数返回时，Get Reader 才会真正有意义......

您可能希望在命令上调用“ExecuteNonQuery()”并确保正确设置 CommandType (CommandType.StoredProcedure)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-17T03:04:40.133

答案是您必须先关闭阅读器才能访问输出参数。

来自：[本页](http://www.dominicpettifer.co.uk/Blog/8/output-parameters-and-recordsets-from-a-stored-procedure)

> *   确保首先通过 cmd.ExecuteReader() 将记录集作为 SqlDataReader 检索到所有记录集，然后...
> *   确保在尝试检索输出参数之前通过 reader.Close() 关闭记录集或 SqlDataReader

# ruby-on-rails - 在 Rails 插件中添加变形的最佳方法是什么？

> ID：829296
> 
> 赞同：1
> 
> 时间：2009-05-06T12:21:18.073
> 
> 标签：ruby-on-rails, ruby-on-rails-plugins

我正在编写一个插件，需要它自己的一些变化。使用嵌入了引擎的 rails 2.3，我应该在哪里放置我的拐点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:11:13.967

我建议在您的插件 lib 目录插件中添加一个单独的文件 (inflections.rb)。通过在插件 Ruby 文件的开头添加以下内容，您应该能够从插件加载 inflections.rb 文件。

```
require 'inflections" 
```

您的 inflections.rb 文件应遵循新 Rails 项目中作为示例提供的格式：

```
# Sample Inflections    
# ActiveSupport::Inflector.inflections do |inflect|
#   inflect.plural /^(ox)$/i, '\1en'
#   inflect.singular /^(ox)en/i, '\1'
#   inflect.irregular 'person', 'people'
#   inflect.uncountable %w( fish sheep )
# end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-09-20T22:00:27.450

**更新**：对于遇到相同问题但使用 Rails 5 的任何人，这是正确的答案。

不要将`inflections.rb`文件放在`plugin/lib`文件夹中，而是放在`plugin/config/initializers`文件夹中。

然后简单地写下你的变化（例如*陈词滥调/陈词滥调*）：

```
ActiveSupport::Inflector.inflections do |inflect|
    inflect.irregular 'cliche', 'cliches'
end 
```

# visual-studio-2008 - vc++[代码片段管理器]的代码片段？

> ID：829299
> 
> 赞同：0
> 
> 时间：2009-05-06T12:21:37.307
> 
> 标签：visual-studio-2008, visual-c++, code-snippets

我在哪里可以获得可与 Visual Studio 2008 中的代码片段管理器一起使用的 VC++ 代码片段？

我安装了 SnippetEditor 如何为**VC++**创建代码片段。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T09:03:57.407

我强烈推荐 Visual Assist X，因为它具有内置的片段管理器以及大量其他功能。

[整个番茄](http://www.wholetomato.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T09:38:49.693

> 如果不使用 3rd 方软件，这在 VS2008 中是不可能的。但是，在 VS2005 中可以使用“Power Pack 安装程序”。有关详细信息，请参阅[此线程](http://social.msdn.microsoft.com/forums/en-US/vcgeneral/thread/015e6988-f9b1-4a7c-b543-d464267f5a54/) 。

因此，您的选择是要么恢复到 VS2005，要么使用第三方代码片段工具，例如已经建议的[Visual Assist](http://www.wholetomato.com/) X。我会选择后者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T15:03:49.727

您所指的视频是关于[http://gotcodesnippets.net/](http://gotcodesnippets.net/)的。该站点仅包含托管代码的片段。

# wcf - WCF 自定义绑定配置

> ID：829301
> 
> 赞同：3
> 
> 时间：2009-05-06T12:22:25.667
> 
> 标签：wcf, web-services

我编写了一个继承自 CustomBinding 的自定义绑定类。我的自定义类重写了 BuildChannelFactory 方法并使用自定义 ChannelFactory 创建自定义通道。

我在使用 WCF 客户端中的自定义绑定类时遇到了困难。如果我在代码中配置它，我可以使用我的自定义绑定类：

```
Binding myCustomBinding = new MyCustomBinding();

ChannelFactory<ICustomerService> factory = 
   new ChannelFactory<ICustomerService>(myCustomBinding, 
        new EndpointAddress("http://localhost:8001/MyWcfServices/CustomerService/"));

ICustomerService serviceProxy = factory.CreateChannel();
serviceProxy.GetData(5); 
```

我的问题是我不知道如何在 App.config 文件中配置它。它是 customBinding 元素还是 bindingExtension 元素？是别的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T17:09:53.357

当您在代码中创建自定义绑定时，您是否还实现了“YourBindingElement”（从 StandardBindingElement 派生）和“YourBindingCollectionElement”（从 StandardBindingCollectionElement 派生）？

如果是这样 - 使用它来配置您的自定义绑定，就好像它是任何其他绑定一样。

第一步是在 <system.serviceModel> 的 extensions 部分的 app.config 或 web.config 文件中注册您的绑定

```
<extensions>
  <bindingExtensions>
    <add name="yourBindingName" 
       type="YourBinding.YourBindingCollectionElement, YourBindingAssembly" />
  </bindingExtensions>
</extensions> 
```

现在，您的新绑定在 WCF 中注册为“正常”可用绑定。与其他绑定一样，在绑定部分中指定您的详细信息：

```
<bindings>
  <yourBinding>
    <binding name="yourBindingConfig" 
             proxyAddress="...." useDefaultWebProxy="false" />
  </yourBinding>
</bindings> 
```

在此处指定其他参数，如“...BindingElement”类中所定义。

最后，在 system.serviceModel 中的服务和/或客户端部分中使用您的绑定，就像普通绑定一样：

```
<client>
  <endpoint
    address="....your url here......"
    binding="yourBinding" 
    bindingConfiguration="yourBindingConfig"
    contract="IYourContract" 
    name="YourClientEndpointName" />
</client> 
```

我真的找不到很多关于如何在网络上用代码编写自己的绑定的资源 - 微软有一个[WCF/WPF/WF 示例工具包](http://www.microsoft.com/downloads/details.aspx?FamilyID=ed9c315c-31ac-4ccb-b62b-721af1e2bfa8&displaylang=en)，其中包括一些示例，我基本上从中学到了足够的知识来弄清楚：- )

[Michele Leroux Bustamante 写](http://www.aspnetpro.com/articles/2009/03/asp200903mb_f/asp200903mb_f.asp)了一篇关于创建自定义绑定的非常好的文章- 系列的第 2 部分，但第 1 部分不公开:-(

这是代码中的示例自定义绑定，您可以下载完整的源代码：[ClearUserNameBinding](http://webservices20.blogspot.com/2008/11/introducing-wcf-clearusernamebinding.html)。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-20T14:09:02.620

如果要通过配置使用此自定义绑定，则必须扩展 BindingCollectionElement 抽象基础并在 web.config 中定义 bindingExtensions 元素。

# java - 如何在 Java Web 应用程序中跟踪连接池 - DBMS_APPLICATION_INFO

> ID：829302
> 
> 赞同：4
> 
> 时间：2009-05-06T12:22:51.017
> 
> 标签：java, oracle, hibernate, logging, application-pool

我需要改进通常在固定数据库用户上运行的 Web 应用程序的可追溯性。DBA 应该能够快速访问有关降低数据库性能的重度用户的信息。

5 年前，我实现了一个 .NET ORM 引擎，它使用 DBMS_APPLICATION_INFO 包记录用户和服务器。在连接管理器上方使用包装器，代码如下：

DBMS_APPLICATION_INFO.SET_MODULE('" + 用户 + " - " + appServerMachine + "','');

每次连接从池中获得连接时，都会执行该包以将信息记录在 V$SESSION 中。

有没有人使用 Toplink 或 Hibernate 发现或实施了解决此问题的方法？这个问题有默认实现吗？

我在这里找到了我 5 年前实施的解决方案，但我想知道任何人都有更好的解决方案并与 ORM 集成。

[将 DBMS_APPLICATION_INFO 与 Jboss 一起使用](https://stackoverflow.com/questions/53379/using-dbmsapplicationinfo-with-jboss)

我的应用程序在 Spring 之上，DAO 是用 JPA（使用休眠）实现的，并且实际上直接在 Tomcat 中运行，并计划（明年）迁移到 SAP Netwevare Application Server。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-02T08:33:46.627

在 Oracle 10g 中，我们可以使用[DBMS_SESSION.SET_IDENTIFIER](http://download.oracle.com/docs/cd/B28359_01/network.111/b28531/app_context.htm#CHDIFCFF)来唯一标识特定会话。Oracle 还提供[了一个内置的 JDBC](http://download.oracle.com/docs/cd/B28359_01/network.111/b28531/app_context.htm#CIHFCFDD)来将其挂接到连接池中。您必须提供自己的唯一标识会话的方法，这取决于您的应用程序。

然后，您的 DBA 将有足够的信息来识别资源匮乏的会话。

我所知道的任何 DBA 都会对从中间层生成的巨大文本文件印象深刻。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T15:12:22.280

如果您想了解运行成本很高的查询，您应该直接进入您的数据库服务器。有针对每台服务器的监控工具。例如，在 PostgreSQL 中，您将以`SELECT * FROM pg_stat_activity`管理员身份运行以检查每个连接及其在做什么、运行了多长时间等。

如果您真的想/需要从容器中执行此操作，那么也许您可以使用 Spring AOP 定义一个拦截器，以在执行任何操作之前执行您需要的语句。请记住，数据库连接并不总是由同一个应用程序用户使用，因为您使用的是池。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T15:00:10.483

您应该能够在您的连接池上配置一个记录器（例如 log4j）。您可能需要一个自定义附加程序来拉回用户 ID。

需要考虑的两点：

1.  在繁忙的系统上，这将生成一个大日志文件。
2.  频繁的连接不一定表明会降低数据库的行为。

# extjs - 具有多行的 ExtJS 工具栏

> ID：829304
> 
> 赞同：14
> 
> 时间：2009-05-06T12:23:12.810
> 
> 标签：extjs

是否可以有一个多行的 ExtJsToolBar？我想要第一行的一些控件和第二行的 3 个 ExtJsButtons。工具栏是面板的顶部工具栏。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-09-16T14:53:32.257

不确定早期版本，但从 ExtJS 4.0 开始，您可以在定义网格时这样做：

```
dockedItems: [
    {
        xtype: 'toolbar',
        dock: 'top',
        items: [
            {text:'Toolbar 1 Button 1'},
            {text:'Toolbar 1 Button 2'}
        ]
    },
    {
        xtype: 'toolbar',
        dock: 'top',
        items: [
            {text:'Toolbar 2 Button 1'}
        ]
    }
], 
```

[http://dev.sencha.com/deploy/ext-4.0.2a/docs/#/api/Ext.panel.Panel](http://dev.sencha.com/deploy/ext-4.0.2a/docs/#/api/Ext.panel.Panel)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-07T08:13:37.927

您还没有提到要添加工具栏的小部件，但通常您可以添加任意数量的工具栏：

```
var panel = new Ext.Panel();
var tool1 = new Ext.Toolbar({...});
var tool2 = new Ext.Toolbar({...});

panel.add(tool1);
panel.add(tool2);
... 
```

如果您想在网格顶部添加额外的工具栏，请找到网格的面板组件并向其添加工具栏。它可能看起来像这样（未经测试）：

```
tPanel = grid.getTopToolbar().ownerCt; // get top toolbar's container panel
tPanel.add(anotherToolbar); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-07-14T07:09:45.403

`dockedItems`那它也简单得多 。

```
var toolbar1 = {
   xtype : 'toolbar',
   dock : 'top', // bottom, right, left
   items: [...]
};

var toolbar2 = {  
   xtype : 'toolbar',
   dock : 'top',
   items: [...]
};

Ext.create('Ext.panel.Panel', {
    dockedItems: [toolbar1,toolbar2]
}); 
```

我知道它很旧并且已经回答了，也许它可以帮助某人:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-20T02:03:08.637

我不确定这是否正是您正在寻找的，但工具栏已在 Ext 3.0 中进行了改进。

您可能想看看： [http ://extjs.com/deploy/ext-3.0-rc1.1/examples/toolbar/toolbars.html](http://extjs.com/deploy/ext-3.0-rc1.1/examples/toolbar/toolbars.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-21T14:05:59.380

在 Ext 论坛中查看此线程。它描述了如何创建工具栏并将其呈现到现有工具栏。

[http://www.extjs.com/forum/showthread.php?t=12433](http://www.extjs.com/forum/showthread.php?t=12433)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T12:43:42.573

我不确定是否可能，但是您始终可以做的是使用行布局将北部区域（例如，如果使用边框布局）分成两行。然后，您可以将一个工具栏添加到顶行，将另一个工具栏添加到第二行。

# c# - IIS 无法解析图像 url

> ID：829305
> 
> 赞同：0
> 
> 时间：2009-05-06T12:23:30.937
> 
> 标签：c#, asp.net, iis

我已将我的网站保存在 wwwroot 文件夹中。当我通过 Visaul Studio 2008 运行它时，它在路径上运行得非常好

```
 http://localhost:3840/GettingUserId/default.aspx 
```

但通过 IIS 无法解析图像 URL，甚至无法解析到其他页面的链接（解析器错误）。路径是

```
 http://bhukrk106154d/GettingUserId/default.aspx 
```

我正在使用 IIS 5.0。是否有任何我遗漏的 IIS 设置。我只是在 C:\Inetpub\wwwroot 文件夹中复制了相同的网站文件夹

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T12:43:56.287

我看到了解析器错误，因为该网站正在尝试使用旧的框架版本。

转到inetmgr 中的默认网站属性-> 转到asp.net 选项卡-> 确保选择了asp.net 2.0 版。

如果您可以发布错误消息，它也会很有用。

# c++ - SQLGetDiagRec 导致 Unicode 版本构建崩溃

> ID：829311
> 
> 赞同：1
> 
> 时间：2009-05-06T12:26:08.403
> 
> 标签：c++, unicode, odbc

我在调用 SQLGetDiagRec 时遇到问题。它在 ascii 模式下工作正常，但在 unicode 中它会导致我们的应用程序崩溃，我就是不明白为什么。我能找到的所有文档似乎都表明它应该在内部处理 ascii/unicode 开关。我正在使用的代码是：

```
void clImportODBCFileTask::get_sqlErrorInfo( const SQLSMALLINT _htype, const SQLHANDLE _hndle )
{
SQLTCHAR      SqlState[6];
SQLTCHAR      Msg[SQL_MAX_MESSAGE_LENGTH];
SQLINTEGER    NativeError;
SQLSMALLINT   i, MsgLen;
SQLRETURN     nRet;

memset ( SqlState, 0, sizeof(SqlState) );
memset ( Msg, 0, sizeof(Msg) );

// Get the status records.
i = 1;

//JC - 2009/01/16 - Start fix for bug #26878
m_oszerrorInfo.Empty();

nRet = SQLGetDiagRec(_htype, _hndle, i, SqlState, &NativeError, Msg, sizeof(Msg), &MsgLen);
m_oszerrorInfo = Msg;
} 
```

一切都很好，直到此函数尝试返回，然后应用程序崩溃。在调用 get_sqlErrorInfo 之后，它永远不会回到代码行。

我知道这就是问题所在，因为我已经将诊断代码放入其中，它可以通过 SQLGetDiagRec 并完成此功能。

如果我评论 SQLGetDiagRec 行，它工作正常。

无论它是在运行发布还是调试，它在我的开发盒上总是可以正常工作。

对此问题的任何帮助将不胜感激。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-07T12:15:08.350

好吧，我找到了正确的答案，所以我想我会把它包括在这里以供将来参考。我看到的文档是错误的。SQLGetDiagRec 不处理我需要使用 SQLGetDiagRecW 的 Unicode。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-23T14:49:09.617

问题可能出在`sizoef(Msg)`. 它应该是字符数：

```
sizeof(Msg)/sizoef(TCHAR) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T12:36:42.497

几个可能的问题。首先，当你说：

```
m_oszerrorInfo = Msg; 
```

m_oszerrorInfo 的类型是什么？如果它是一个指针，那么您将存储一个指向局部变量 (Msg) 的指针。如果您稍后使用该指针，则 Msg 将不再存在。

其次，以下划线开头的名称在命名空间范围内为编译器保留。为了不必担心这意味着什么，请不要使用以下划线开头的名称。

# asp.net - 在文本框中显示表格的字段

> ID：829313
> 
> 赞同：0
> 
> 时间：2009-05-06T12:27:04.517
> 
> 标签：asp.net, sql, sql-server, vb.net, vwdexpress

我有一个表格，我想在其中选择一个字段，然后将其显示在文本框中

就像是：

```
SELECT userName
FROM userTable
WHERE (userLogged = 'ON') 
```

如何在文本框中显示选定的用户名？

顺便说一句，userLogged 表示用户是否登录

如果用户已登录，则 userLogged 将更改为“ON”

如果用户未登录，它将是“关闭”

我知道这不是那么实用，但我仍在练习。

我正在使用 Visual Web Developer 2008 Express

- - - - - 更新 - - - - -

我使用表适配器程序进行查询

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T12:31:14.977

如果您只是拉一个字段，那么最好的方法是以标量执行模式运行 SqlCommand；这将只返回一个字段/值。

```
Imports System.Data.SqlClient
....
Using sqlConn as new SqlConnection("Data Source=YourServer";Trusted_Connection=True;Database=DBName", _
      sqlComm as new Sqlcommand("SELECT userName FROM userTable WHERE userLogged = 'ON'", sqlConn)
    sqlConn.Open();
    dim result as string = sqlComm.ExecuteScalar().ToString
    TextBox1.Text = result
End Using 
```

*注意：* SQL连接字符串中的“Trusted_Connection”表示使用windows认证登录SQL Server；您可以将其替换为“用户 ID=用户名；密码=密码；”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:31:08.003

要在文本框上设置文本属性，您只需调用...

```
TextBox1.Text = "Value"; 
```

从您的代码隐藏中，如果在您的 aspx 页面中有一个文本框控件...

```
<asp:TextBox ID="TextBox1" runat="server"/> 
```

但是，您的代码示例和从数据库访问字段值的许多不同方式缺少很多内容

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T12:32:54.957

好吧，这是一个广泛的问题，因为我们不知道您如何查询数据库或类似的东西。基本上，您只需获取查询的结果，假设它位于名为 dt 的 DataTable 对象中，然后执行以下操作：

```
myTextBox.Text = dt.Rows[0]["userName"].ToString(); 
```

但是，我怀疑你需要的不止这些。我建议在以下位置使用精彩的资源：

[学习 Visual Studio.NET](http://www.learnvisualstudio.net)

它是初学者的好地方，并且有大量关于 ADO.NET 的教程。

# asp.net-mvc - MVC - 启用表单身份验证

> ID：829317
> 
> 赞同：0
> 
> 时间：2009-05-06T12:27:46.530
> 
> 标签：asp.net-mvc, forms-authentication

我有 VS2008 的 MVC 1.0 应用程序。

我已将配置添加到 web.config，但应用程序在后面的 Default.aspx 页面代码中崩溃。不知道为什么它加载该页面。

我只是使用 MVC 1.0 的所有默认设置。

这是我的网络配置。它不应该用这个配置显示我的登录页面吗？？？？

马尔科姆

```
<?xml version="1.0"?>
<configuration>
  <system.web>
    <httpHandlers>
      <add path="*" verb="*"
          type="System.Web.HttpNotFoundHandler"/>
    </httpHandlers>

    <!--
        Enabling request validation in view pages would cause validation to occur
        after the input has already been processed by the controller. By default
        MVC performs request validation before a controller processes the input.
        To change this behavior apply the ValidateInputAttribute to a
        controller or action.
    -->
    <identity impersonate="false"/>
    <pages
        validateRequest="false"
        pageParserFilterType="System.Web.Mvc.ViewTypeParserFilter, System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"
        pageBaseType="System.Web.Mvc.ViewPage, System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"
        userControlBaseType="System.Web.Mvc.ViewUserControl, System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
      <controls>
        <add assembly="System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" namespace="System.Web.Mvc" tagPrefix="mvc" />
      </controls>
    </pages>

    <authentication mode="Forms">
      <forms loginUrl="/Account/LogOn" defaultUrl="/Home/Index"></forms>
    </authentication>

    <authorization>
      <deny users="?"/>
    </authorization>

  </system.web>

  <location path="Content/Site.css">
    <system.web>
      <authorization>
        <allow users="*"/>
      </authorization>
    </system.web>
  </location>

  <system.webServer>
    <validation validateIntegratedModeConfiguration="false"/>
    <handlers>
      <remove name="BlockViewHandler"/>
      <add name="BlockViewHandler" path="*" verb="*" preCondition="integratedMode" type="System.Web.HttpNotFoundHandler"/>
    </handlers>
  </system.webServer>
</configuration> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T12:33:11.803

ASP.NET MVC 中的默认模板项目确实支持用户帐户，包括表单身份验证、创建用户等。看看模板项目并从他们的配置文件和`AccountController`.

# c# - c# / WPF : 浏览文件对话框

> ID：829318
> 
> 赞同：0
> 
> 时间：2009-05-06T12:27:49.897
> 
> 标签：c#, wpf, dialog

我是 WPF 新手，正在尝试使用 VC# Express 制作我的第一个 WPF 桌面应用程序。

如果用户选择一个文件，我试图让三个打开的​​文件对话框完成，其中包含显示指定路径的文本字段。我找到了使对话框在单击按钮时出现的工作代码，但是如何获取文本字段以更新/绑定到文件路径？

类似于 HTML 中的文件输入框的工作方式是理想的。

...

编辑：

好的，我阅读了我下面的帖子并找到了解决方案...

现在，如何将控制台输出重定向到文本字段？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T13:05:28.450

要回答有关重定向控制台输出的问题：

您最好更改代码以使用您希望输出的字符串触发事件。然后在 UI 中为该事件添加一个处理程序，并在处理程序中更新文本字段。

要声明事件，请在处理类中添加类似以下代码：

```
public event EventHandler<StringEventArgs> Process_Message; 
```

where`StringEventArgs`是一个基于该类的类，`EventArgs`它包装了要发送的消息。

要触发事件，请在您的处理类中添加类似以下代码：

```
Process_Message(this, new StringEventArgs(message)); 
```

在 UI 类中附加消息处理程序：

```
process.Process_Message += Process_Message; 
```

要处理该事件，请将类似以下代码的内容添加到您的 UI 类中：

```
private void Process_Message(object sender, StringEventArgs e)
{
     Action action = () => UpdateStatus(e.Message);
     {
         Dispatcher.Invoke(System.Windows.Threading.DispatcherPriority.Normal, action);
     }
     else
     {
            action();
     }         
} 
```

您需要进行线程测试，因为 UI 无法从不同的线程更新。

然后`UpdateStatus`方法：

```
private void UpdateStatus(string message)
{
    statusTextBox.Text = message;
} 
```

显然，您需要重命名内容以适合您的应用程序。

`EventArgs`在 MSDN 中查找事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:47:09.883

如果我理解正确，请使用 FileDialog.FileName 到完整路径..并将其绑定到您的文本框。76梅尔

# asp.net - 固定宽度网站中列过多的网格

> ID：829322
> 
> 赞同：3
> 
> 时间：2009-05-06T12:28:30.583
> 
> 标签：asp.net, gridview, telerik, radgrid

我正在使用 Telerik 的 Radgrid 作为网站。网格列通常超出可用宽度，并延伸到主要内容区域之外（固定宽度）。

那么我有什么选择来呈现非常宽的网格。水平滚动条在我的网站上看起来很丑

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T14:02:09.233

您的选择是以下各项的组合：

1.  较小的字体
2.  将一些单元格合并为多行（例如，如果您有“开始日期”和“结束日期”，则将开始日期放在顶部，将结束日期放在底部。
3.  加宽窗户
4.  使某些单元格有条件地出现（基于用户定义的过滤器）。也许最常用的单元格会正常显示，而复选框会取消隐藏不常用的单元格或单元格组。
5.  允许水平滚动
6.  使窗口具有流体宽度
7.  通过javascript浮动弹出数据，`<div>`而不是将其放在列中

我错过了什么吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T20:54:51.583

我也在使用 Telerik 控件，经过大量使用它们后我学到的一件事是它们的 CSS 通常很好，但我也面临你的问题，这是我的建议。

*   凯尔特克斯所说的。
*   总是向你的 Rad Grid 添加一个自定义类，你可以在其中修复那些讨厌的东西。
*   不要为网格使用固定宽度，而是在列上使用它并使网格流动，页面也是如此。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-18T21:49:37.547

我同意 devmania 并使网格变得流畅，我最近遇到了类似的问题。所以我做了一些我的专栏 nowrap，剩下的留给包装。它在较小的屏幕上看起来不太好，但它仍然可以使用，因为我已经停止了日期+时间列换行之类的操作。但是，一旦您开始在更宽的屏幕上使用它，它看起来很棒。

这完全取决于您拥有多少滚动条。是否可以删除一些列并将该信息放在某个弹出/弹出窗口中？

另一种选择是让哪些列显示为用户可配置，但您并没有真正解决问题，只是让用户有责任让它看起来不错。

如果您无法摆脱水平滚动条，您至少应该尝试将更重要的列放在首位，这样您的用户就不必经常向右滚动。

# python - 为 Python 文档提供补丁的正确程序是什么？

> ID：829341
> 
> 赞同：4
> 
> 时间：2009-05-06T12:32:06.283
> 
> 标签：python

我将再次深入研究 cgi.py 模块的源代码，因为文档中提到了 MiniFieldStorage 类，但实际上并没有记录。我突然想到我已经这样做了很多次，也许我可以为它写文档。如果我提交了，我应该如何提交？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T12:38:02.027

官方网站上有一个关于[文档开发](http://python.org/dev/doc/)的页面，看起来是一个很好的起点。看起来好像您只是添加到问题跟踪器并以正常方式附加补丁。

特别是，它指向*[Documenting Python](http://docs.python.org/documenting/)*，这似乎是关于格式化文档的相当详尽的指南；风格指南等

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T12:41:44.980

我建议将问题发布到[文档错误跟踪器](http://bugs.python.org/issue?%40search_text=&title=&%40columns=title&id=&%40columns=id&stage=&creation=&creator=&activity=&%40columns=activity&%40sort=activity&actor=&nosy=&type=&components=4&versions=&dependencies=&assignee=&keywords=&priority=&%40columns=priority&%40group=priority&status=1&resolution=&nosy_count=&message_count=&%40pagesize=50&%40startwith=0&%40queryname=&%40old-queryname=&%40action=search)，当然包括补丁。[这在有关网站贡献](http://www.python.org/dev/contributing/)的部分中有所提及。

如果这不起作用，或者看起来很慢，我想您可以直接挖掘开发人员来解决问题，但这也可能被认为是不礼貌的，因此请先阅读适当的礼仪。

# regex - 如何为特定的 Perl 变量分配多个值？

> ID：829343
> 
> 赞同：1
> 
> 时间：2009-05-06T12:32:36.737
> 
> 标签：regex, perl, pattern-matching

我正在用 Perl 编写一个脚本，它在蛋白质序列（字符串）中搜索一个主题（子字符串）。要搜索的主题序列（或子字符串）是 hhhDDDssEExD，其中：

*   *h*是任何疏水性氨基酸
*   *s*是任何小氨基酸
*   *x*是任何氨基酸
*   *h,s,x*可以分别有**多个**值

一个变量可以分配多个值吗？如果是，我该怎么做？我想将多个值的列表分配给一个变量。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T12:42:23.903

似乎您想要某种模式匹配。这可以通过使用正则表达式的字符串来完成。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T13:53:04.700

您可以在正则表达式中使用字符类。你提到的课程是：

```
 h -> [VLIM]
 s -> [AG]
 x -> [A-IK-NP-TV-Z] 
```

最后一个意思是“A到I，K到N，P到T，V到Z”。

您的示例的正则表达式将是：

```
/[VLIM]{3}D{3}[AG]{2}E{2}[A-IK-NP-TV-Z]D/ 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T13:49:28.703

我不是 perl 方面的专家，因此很可能有一种更快的方法，但似乎`//`列表上下文中的匹配运算符 " " 是您所需要的。当您将匹配操作的结果分配给列表时，匹配运算符将采用列表上下文并返回一个带有每个括号分隔的子表达式的列表。如果您使用 " `g`" 标志指定全局匹配，它将返回每个子表达式的所有匹配的列表。例子：

```
# print a list of each match for "x" in "xxx"
@aList = ("xxx" =~ /(x)/g);
print(join(".", @aList)); 
```

会打印出来

```
x.x.x 
```

我假设您对这 5 种类型`h`、`D`、`s`、`E`和中的每一种都有一个正则表达式`x`。您没有说这些部分中的每一个是单个字符还是多个字符，所以我假设它们可以是多个字符。如果是这样，您的解决方案可能是这样的：

```
$h = ""; # Insert regex to match "h"
$D = ""; # Insert regex to match "D"
$s = ""; # Insert regex to match "s"
$E = ""; # Insert regex to match "E"
$x = ""; # Insert regex to match "x"

$sequenceRE = "($h){3}($D){3}($s){2}($E){2}($x)($D)"

if ($line =~ /$sequenceRE/) {
    $hPart = $1;
    $sPart = $3;
    $xPart = $5;

    @hValues = ($hPart =~ /($h)/g);
    @sValues = ($sPart =~ /($s)/g);
    @xValues = ($xPart =~ /($x)/g);
} 
```

我确信我错过了一些东西，并且我忽略了一些 perl 的微妙之处，但这应该能让你大部分时间到达那里。有关更多信息，请阅读 perl 的[匹配运算符](http://www.perl.com/doc/manual/html/pod/perlop.html#Regexp_Quote_Like_Operators)和[正则表达式](http://www.perl.com/doc/manual/html/pod/perlre.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:20:26.243

我可能会走得很远，但听起来你想要一个带有内置方法的对象作为字符串输出。

如果你从一个字符串开始，就像你提到的那样，你可以将字符串作为一个新对象传递给类，使用每个人已经建议的正则表达式来解析出你将作为变量分配给该对象的块。最后，您可以让它根据该对象的变量输出一个字符串，例如：

```
 $string = "COHOCOHOCOHOCOHOCOHOC";
 $sugar = new Organic($string);

 Class Organic {
 $chem;
       function __construct($chem) {
           $hydro_find = "OHO";
           $carb_find = "C";
           $this-> hydro = preg_find ($hydro_find, $chem);
           $this -> carb = preg_find ($carb_find, $chem);

        function __TO_STRING() {
           return $this->carb."="$this->hydro;
        }
   }

 echo $sugar; 
```

好吧，那种最终崩溃了，它是伪 php，而不是 perl。但是，如果我正确理解了您的问题，那么您正在寻找一种方法来从字符串中获取所有信息，但将其与该字符串绑定。那将是对象和类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T14:51:31.330

您可能需要一个数组（或 arrayref）或一个模式（qr//）。

或者也许[Quantum::Superpositions](http://search.cpan.org/perldoc/Quantum::Superpositions)。

# java - MQJE018：协议错误 - 收到意外的段类型

> ID：829350
> 
> 赞同：4
> 
> 时间：2009-05-06T12:36:19.567
> 
> 标签：java, websphere, message-queue, messaging

呼叫所有 MQ 大师，

我的桌子下面有一个盒子，我们用它来复制我们的生产环境，它是：

WebSphere 6.1 Fedora Linux MQ 6.0

每当我们的一个应用程序尝试向 MQ 队列发送消息时，我们都会收到以下错误：MQJE018：协议错误 - 收到意外的段类型

任何有关这可能意味着什么的建议都将不胜感激，堆栈跟踪如下。

```
Dump of callerThis =
Object type = com.ibm.ejs.jms.listener.MDBListenerImpl
com.ibm.ejs.jms.listener.MDBListenerImpl@744c744c

==> Performing default dump from com.ibm.ejs.jms.JMSDiagnosticModule  = Wed May 06 13:09:58 BST 2009
Dump of callerThis =
Object type = com.ibm.ejs.jms.listener.MDBListenerImpl
com.ibm.ejs.jms.listener.MDBListenerImpl@744c744c

Linked exception = com.ibm.mq.MQException: MQJE001: An MQException occurred: Completion Code 2, Reason 2195
MQJE018: Protocol error - unexpected segment type received
        at com.ibm.mq.MQManagedConnectionJ11.<init>(MQManagedConnectionJ11.java:238)
        at com.ibm.mq.MQClientManagedConnectionFactoryJ11._createManagedConnection(MQClientManagedConnectionFactoryJ11.java:318)
        at com.ibm.mq.MQClientManagedConnectionFactoryJ11.createManagedConnection(MQClientManagedConnectionFactoryJ11.java:338)
        at com.ibm.mq.StoredManagedConnection.<init>(StoredManagedConnection.java:84)
        at com.ibm.mq.MQSimpleConnectionManager.allocateConnection(MQSimpleConnectionManager.java:168)
        at com.ibm.mq.MQQueueManagerFactory.obtainBaseMQQueueManager(MQQueueManagerFactory.java:774)
        at com.ibm.mq.MQQueueManagerFactory.procure(MQQueueManagerFactory.java:690)
        at com.ibm.mq.MQQueueManagerFactory.constructQueueManager(MQQueueManagerFactory.java:646)
        at com.ibm.mq.MQQueueManagerFactory.createQueueManager(MQQueueManagerFactory.java:153)
        at com.ibm.mq.MQQueueManager.<init>(MQQueueManager.java:544)
        at com.ibm.mq.MQSPIQueueManager.<init>(MQSPIQueueManager.java:69)
        at com.ibm.mq.jms.MQConnection.createQM(MQConnection.java:2401)
        at com.ibm.mq.jms.MQConnection.createQMXA(MQConnection.java:1783)
        at com.ibm.mq.jms.MQQueueConnection.<init>(MQQueueConnection.java:110)
        at com.ibm.mq.jms.MQQueueConnection.<init>(MQQueueConnection.java:67)
        at com.ibm.mq.jms.MQXAQueueConnection.<init>(MQXAQueueConnection.java:57)
        at com.ibm.mq.jms.MQXAQueueConnectionFactory.createXAQueueConnection(MQXAQueueConnectionFactory.java:80) 
```

编辑：我在 IBM 文档中查找了原因代码，但几乎没有帮助

```
2195 (X'0893')
MQRC_UNEXPECTED_ERROR
Explanation:

The call was rejected because an unexpected error occurred.
Completion Code:

MQCC_FAILED
Programmer Response:

Check the application's parameter list to ensure, for example, that the correct number of parameters was passed, and that data pointers and storage keys are valid. If the problem cannot be resolved, contact your system programmer.

    * On z/OS, check whether any information has been displayed on the console. If this error occurs on an MQCONN or MQCONNX call, check that the subsystem named is an active MQ subsystem. In particular, check that it is not a DB2(TM) subsystem. If the problem cannot be resolved, rerun the application with a CSQSNAP DD card (if you have not already got a dump) and send the resulting dump to IBM.
    * On OS/2 and i5/OS, consult the FFST record to obtain more detail about the problem.
    * On HP OpenVMS, Compaq NonStop Kernel, and UNIX systems, consult the FDC file to obtain more detail about the problem. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-09T13:55:25.920

好的，终于设法解决了这个错误。这与 MQ 自行安装无关。我知道这是某种网络问题，所以我将 websphere 中的主机名设置从主机名更改为盒子的 ip，一切正常。

Note, I made the host name changes on the queues and on the queue connection factories.

Hope that helps someone.

Karl

# javascript - 谷歌地图麻烦：关闭和通过引用传递

> ID：829353
> 
> 赞同：5
> 
> 时间：2009-05-06T12:37:04.213
> 
> 标签：javascript, google-maps

我遇到了一些 Google 地图/Javascript 问题。我想我知道问题是什么，但只是不知道解决办法。

我的问题的一个例子是[here](http://www.ltheobald.co.uk/maptest/test.html)。无论您单击什么标记，都会显示第二个标记。我显然将错误的信息传递给我的事件侦听器，但我似乎无法正确获取代码。这是代码的删减部分：

首先，这是我的一部分代码：

```
if (GBrowserIsCompatible() && mapResults != null) {
  // Read in the JSON
  var mapDetailsArray = loadJSON();

  // Create a map
  var map = new google.maps.Map2(document.getElementById(elementId));
  map.setCenter(new google.maps.LatLng(mapDetailsArray[0].getLatitude(),
      mapDetailsArray[0].getLongitude()), 13);
  map.addControl(new google.maps.SmallMapControl());

  // Add the points and center
  var mgr = new google.maps.MarkerManager(map);
  var bounds = new google.maps.LatLngBounds();
  for ( var i = 0; i < mapDetailsArray.length; i++) {
    var mapDetails = mapDetailsArray[i];

    var point = new google.maps.LatLng(mapDetails.getLatitude(), mapDetails
        .getLongitude());
    bounds.extend(point);

    // Create our marker
    var marker = new google.maps.Marker(point);

    // What action do we use to show the hover
    var infoAction = "mouseover";

    marker.value = mapDetails;

    google.maps.Event.addListener(marker, infoAction, function() {
      alert(marker.value);
      map.openInfoWindowHtml(point, getResultInfoContent(marker.value));
    });

    mgr.addMarker(marker, 1);
  }
  mgr.refresh();
} 
```

“marker.value”总是最终设置为 mapDetails 的最后一个值。如果有的话，我希望它是“未定义的”，因为一旦循环完成，该值不应该消失吗？我尝试了各种不同的值（例如marker.value = i+1;），但它仍然会作为两个点的相同值出现。

有谁知道如何将正确的值传递给事件侦听器？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T12:43:34.557

改变这个：

```
google.maps.Event.addListener(marker, infoAction, function() {
      alert(marker.value);
      map.openInfoWindowHtml(point, getResultInfoContent(marker.value));
    }); 
```

对此：

```
google.maps.Event.addListener(marker, infoAction, (function(marker, point, map) { return function() {
      alert(marker.value);
      map.openInfoWindowHtml(point, getResultInfoContent(marker.value));
    }})(marker, point, map)); 
```

这将创建您想要的关闭。

为了清楚起见分开：

```
var f = function(marker, point, map)
{
    return function()
    {
        alert(marker.value);
        map.openInfoWindowHtml(point, getResultInfoContent(marker.value));
    }
}

google.maps.Event.addListener(marker, infoAction, f(marker, point, map)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-23T05:45:32.917

上面的答案虽然不是很直观 - 正如格雷格所说。

当您将事件添加到对象时，该对象将被向下传递，因此您可以通过闭包中的“this”访问它。如果您将“marker.value”替换为“this.value”，您的问题就会得到解决。如果你需要传递更多的东西，你可以将它绑定到对象上并传递下去：

```
marker.a = 1
marker.b = 2
marker.c = 3 
```

在闭包中 this.a 将是 1 等等..

# sql - T-SQL - 什么是内联视图？

> ID：829354
> 
> 赞同：4
> 
> 时间：2009-05-06T12:37:14.400
> 
> 标签：sql, tsql

我最近回答了这个问题[how-to-call-user-defined-function-in-order-to-use-with-select-group-by-order-by](https://stackoverflow.com/questions/829089/how-to-call-user-defined-function-in-order-to-use-with-select-group-by-order-by/829106#829106)

我的回答是使用内联视图来执行该功能，然后对其进行分组。

在评论中，提问者不理解我的回答，并要求提供一些网站/参考资料来帮助解释。

我做了一个快速的 google 并没有找到任何很好的资源来详细解释什么是内联视图以及它们在哪里有用。

有没有人可以帮助解释什么是内联视图？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T12:43:24.650

从[这里](http://www.orafaq.com/wiki/Inline_view)：内联视图是另一个 SELECT 语句的 FROM 子句中的 SELECT 语句。内联视图通常用于通过删除连接操作并将几个单独的查询压缩为单个查询来简化复杂的查询。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T12:48:47.493

我认为另一个术语（可能是 SQL Server 术语）是“派生表”

比如这篇文章：

[http://www.mssqltips.com/tip.asp?tip=1042](http://www.mssqltips.com/tip.asp?tip=1042)

或者

[http://www.sqlteam.com/article/using-derived-tables-to-calculate-aggregate-values](http://www.sqlteam.com/article/using-derived-tables-to-calculate-aggregate-values)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T12:44:50.527

恕我直言，“内联视图”只是行返回子查询的另一个表达式。

换句话说——一个可以完全被视图名称替换的 SQL 表达式（因此，相关的子查询不符合内联视图的条件）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T13:08:46.680

这篇[MSDN 文章](http://msdn.microsoft.com/en-us/magazine/cc163346.aspx)声称内联视图是派生表的另一个术语，并且指的是其他人在此线程中描述的相同事物（FROM 中的子查询）。sql server 2005 及更高版本中的替代方法是公用表表达式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T14:05:12.393

另一个更常用于内联视图的术语是“嵌入式选择语句”

所以选择里面的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-09T23:03:03.740

内联视图是在代码/程序执行期间在 from 语句中创建的**虚拟表**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-08-05T00:47:58.847

*   内联视图介绍 Oracle 7.2。
*   内联视图是 Oracle 数据库中使用的特殊查询类型。
*   我们在子查询中使用内联视图代替父查询中的表名。

它们可以用作

```
Select * from (sub query) ; 
```

# jquery - jQuery同步操作

> ID：829355
> 
> 赞同：3
> 
> 时间：2009-05-06T12:37:45.193
> 
> 标签：jquery

我正在一个一个地淡化元素，但它似乎一下子就消失了。

我怎样才能一个一个地淡化元素。只有当一个完全褪色时，第二个才应该开始褪色。

我像这样循环并淡化它

```
$(ele).fadeIn('slow'); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T12:40:42.877

fadeIn 有一个在淡入淡出完成时执行的回调。将类 elemX 添加到每个元素，其中 x 是淡入淡出的顺序。然后使用以下代码：

```
startFading(1);

function startFading(order) {
   $(".ele" + order).fadeIn('slow', function() {
        if (order < orderMax) {
            startFading(order+1);
        }
   });
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T14:56:34.487

我为您制作了这个快速/简单的 jQuery 插件，让您可以随心所欲。:-)

```
$.fn.extend({
    serial_fade: function(o) {
        if(!o.speed || o.speed == undefined || o.speed == null) { o.speed = 'slow'; }
        if(!o.fade || o.fade == undefined || o.fade == null)    { o.fade = 'in'; }
        if(!o.index || o.index == undefined || o.index == null) { o.index = 0; }
        var s = this.selector;
        if(o.fade.toLowerCase() == 'in') {
            return this.eq(o.index).fadeIn(o.speed, function() {
                o.index++;
                if($(s).eq(o.index).length > 0) {
                    $(s).serial_fade({speed:o.speed,fade:o.fade,index:o.index});
                }
            });
        } else {
            return this.eq(o.index).fadeOut(o.speed, function() {
                o.index++;
                if($(s).eq(o.index).length > 0) {
                    $(s).serial_fade({speed:o.speed,fade:o.fade,index:o.index});
                }
            });
        }
    }
});

// To call it just do this:
$(ele).serial_fade({speed:'slow',fade:'in'});

// Optionally, you can pass which element you want to start with (0-based):
 $('a').serial_fade({speed:'slow',fade:'in',index:2});

// If you want to start with element 2 (3, really) and fade all the rest *out*
// sequentially, verrry slowly:
$(ele).serial_fade({speed:5000,fade:'out',index:2}); 
```

它应该与任何类型的选择器一起使用，就像任何其他 jQuery 方法一样。我希望这对你有用。

**编辑：**我扩展了它，以便它现在可以淡入*和*淡出。只是这样看起来更有用...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T15:49:35.950

你可以把它变成通用的，而不是强迫它只用于褪色。

```
function depth(collection, fun, i) {
    if (i === undefined)
        depth(collection, fun, 0);
    else
        if (i < collection.length)
            fun(collection[i], function(){
                depth(collection, fun, i + 1);
            });
};

depth($("a"), function(elem, fun) {
    $(elem).fadeIn('slow', fun);
}); 
```

# java - Java/Servlet：获取当前 sql.Date

> ID：829358
> 
> 赞同：7
> 
> 时间：2009-05-06T12:39:11.603
> 
> 标签：java, sql, datetime, locale

我需要做的是：

1) 从请求中获取用户的语言环境。

2) 根据用户的语言环境创建具有当前日期和时间的新 sql.Date 对象

3) 写入MySQL db，列类型：TIMESTAMP

我得到的是：

```
java.util.Locale locale = request.getLocale();

java.text.DateFormat dateFormat =
java.text.DateFormat.getDateTimeInstance(
                        java.text.DateFormat.LONG, java.text.DateFormat.LONG, locale );

java.util.Date date = new java.util.Date();

java.sql.Date sqlDate = new java.sql.Date( date.getTime() ); 
```

日期可以，但时间有问题 - 总是 12:00:00 AM。

有什么建议么？有没有更有效的方法来做到这一点？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-03-22T14:07:10.993

甚至更紧凑的解决方案；）

```
java.sql.Date timeNow = new Date(Calendar.getInstance().getTimeInMillis()); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-12-22T08:22:45.970

还有一种更简单的解决方案。使用此代码使用 java.util.Date 获取当前日期

```
java.util.Calendar cal = java.util.Calendar.getInstance();
java.util.Date utilDate = cal.getTime();
java.sql.Date sqlDate = new Date(utilDate.getTime()); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T12:42:06.837

如果需要时间，则需要 java.sql.Timestamp 而不是 java.sql.Date，以及数据库中的时间戳列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T13:10:32.043

请注意，[request.getLocale](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/ServletRequest.html#getLocale())使用 Accept-Language 标题的值，可能并不总是为您提供正确的语言环境。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T14:27:15.400

根据区域设置获取**时区可能不是他们的实际时区**。

一个例子：在澳大利亚，语言环境是“en-AU”，但我们有几个时区最多相差 3 小时。

我猜在美国他们也有这个问题。

一种可能的解决方案是**存储 UTC 时间**。如果用户然后在他的偏好中调整他的时区，或者您使用其他传递时区的方法（通过 AJAX 说客户端/浏览器信息），那么您可以使用`java.util.Calendar`实例根据该方法调整 UTC 时间。

# sql - 如何检查 SQL Anywhere 中是否存在临时表？

> ID：829361
> 
> 赞同：3
> 
> 时间：2009-05-06T12:40:08.260
> 
> 标签：sql, sqlanywhere

我想编写一个 SQL IF 语句来检查是否存在本地临时表，但这些类型的表没有记录在 SQL Anywhere 系统目录中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T15:01:00.327

请注意，您可以在 11.0.1 及更高版本中执行此操作：

```
DROP TABLE IF EXISTS t; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T12:45:08.250

如果您问这个问题，“如果本地临时表不存在，我如何删除它而不引发错误？” 那么答案很简单：只需 DROP 并忽略任何错误：

```
BEGIN
   DROP TABLE t;
   EXCEPTION WHEN OTHERS THEN
END; 
```

如果你真的需要知道“表 t 存在吗？”这个问题的答案。您可以查询该表并分析生成的 SQLSTATE。以下函数利用了几个特性：

*   ON EXCEPTION RESUME 忽略 SELECT 引发的任何异常并将控制权传递给 IF 语句。

*   EXECUTE IMMEDIATE 允许您编写一个查询，其中表名位于字符串变量中。

*   TOP 1 确保即使表包含一百万行，也只选择一行。

*   ORDER BY 1 可以满足 TOP 只能在结果集排序时使用的要求。

*   SELECT 1 减轻了您指定列名的负担。

*   INTO @dummy 表示 SELECT（以及因此 EXECUTE IMMEDIATE）不返回结果集。

如果 SELECT 有效，它会将 SQLSTATE 设置为 '00000' 表示成功或设置为 '02000' 表示未找到行。任何其他 SQLSTATE 都意味着该表存在一些严重问题......就像它不存在一样。

```
CREATE FUNCTION f_table_is_ok
   ( IN @table_name VARCHAR ( 128 ) )
   RETURNS INTEGER
   ON EXCEPTION RESUME
BEGIN
   DECLARE @dummy INTEGER;
   EXECUTE IMMEDIATE STRING (
      'SELECT TOP 1 1 INTO @dummy FROM ',
      @table_name,
      ' ORDER BY 1' );
   IF SQLSTATE IN ( '00000', '02000' ) THEN
      RETURN 1
   ELSE
      RETURN 0
   END IF;
END; 
```

下面是一些测试代码：

```
BEGIN
DECLARE LOCAL TEMPORARY TABLE tt ( c INTEGER );
DECLARE LOCAL TEMPORARY TABLE "t t" ( c INTEGER );
SELECT f_table_is_ok ( 'asdf' );
SELECT f_table_is_ok ( 'tt' );
SELECT f_table_is_ok ( '"t t"' );
SELECT f_table_is_ok ( '"SYS"."SYSTABLE"' );
END; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T12:45:05.753

无论如何都尝试删除它并忽略错误...

BEGIN
DROP TABLE 表；
其他情况除外

结尾;

# c++ - 如何设置 MS Visual Studio 2005 项目依赖项以进行高效编译 (c++)？

> ID：829365
> 
> 赞同：0
> 
> 时间：2009-05-06T12:40:37.073
> 
> 标签：c++, visual-c++, ide, visual-studio-2005, dependencies

如何设置 MS Visual Studio 2005 项目依赖项，以便在更高级别的项目中进行更改不会强制重新编译它所依赖的所有其他项目。

如果我有 5 个 dll 项目，它们以各种方式相关......在“项目”->“依赖项”下，我已经确定了下一个项目，但只下降了一层。当我对较高的项目进行小幅更改时，选择“Build”->“Build myLib”，较低的项目也会重新编译...如果我指定所有依赖项，那么所有依赖项目也会重新编译...这是'对吧？

如果我删除显式依赖项，即使应该重建较低的项目（正如我所期望的那样），也不会重建。

如果我有多个依赖级别（A 依赖 B 依赖 C 等）怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T12:42:23.497

> 如果我有多个依赖级别（A 依赖 B 依赖 C 等）怎么办？

从下拉列表中选择项目 A，将 B 添加为依赖项。同样，对于 B，选择 C ​​作为依赖项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T13:12:55.470

> 如何设置 MS Visual Studio 2005 项目依赖项，以便在更高级别的项目中进行更改不会强制重新编译它所依赖的所有其他项目。

我想你的意思是：

> 如何设置 MS Visual Studio 2005 项目依赖项，以便在更高级别的项目中进行更改不会强制重新编译**可能间接依赖它的所有其他项目？**

我认为您在与我相反的意义上使用诸如“更高”和“更低”之类的术语 - 对于一对项目，我认为“更低”项目是依赖于另一个项目的项目。可能是您的“思维导图”相对于我的简单垂直翻转，这很好；或者您可能误解了 Project Dependencies 框所要求的内容，而事实并非如此。它要求上面下拉列表中的命名项目直接依赖的项目列表，即在可以构建命名项目之前必须是最新的（可能需要重建）的项目。

**所以：您能否澄清一下您打算在什么意义上“更高”和“更低”。**

当您要求构建某个项目 X 时，VC++ 应该（而且我肯定会）做的是检查 X 直接或间接依赖的所有项目是否都是最新的，并构建任何不是的。当这种构建发生时，每个项目总是在它直接或间接依赖的任何项目之后构建。请注意，即使项目本身没有更改，项目也可能需要重建——例如，如果 X 依赖于 Y，Y 依赖于 Z，那么更改 Z 并请求构建 X 需要首先构建 Z，*然后是 Y（未更改），*然后是 X。如果甚至存在依赖于 X 的“较低”（在我的意义上）项目，那么当您请求构建​​ X 时，它们将不会被构建。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-06T13:55:06.723

无论如何，我的项目依赖项仅设置为级别：

*   项目 A 依赖于库 B
*   项目 A 依赖于库 C

但是，库 B 也使用库 C，但我没有将其设置为依赖项。这似乎工作正常。

你在改头文件吗？当然 - 如果您更改标题，那么无论您是否设置了项目依赖关系，都必须重建依赖于该标题的任何项目。

# iphone - 在 iPhone SDK 中设置铃声

> ID：829369
> 
> 赞同：4
> 
> 时间：2009-05-06T12:41:32.017
> 
> 标签：iphone, ios, cocoa-touch

应用程序如何在 iPhone 上设置铃声？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-06T12:43:25.897

API 当前不支持此功能，因为它可用于将铃声设置为用户不打算设置的铃声。如果您希望看到它被添加，最好的办法是向 Apple 提交功能请求。

# java - Netbeans 使用 JBoss5 扩展 EAR 开发

> ID：829371
> 
> 赞同：0
> 
> 时间：2009-05-06T12:41:38.087
> 
> 标签：java, jakarta-ee, netbeans, jboss, jboss5.x

我希望 Netbeans 直接部署到 JBoss 中的爆炸耳朵中，而不是当前部署整个 .ear 文件的过程。如果可以编辑 .jsps 和支持 bean 而无需在每次更改后重新部署，开发将会快得多。

这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:22:45.547

我不明白为什么不。我使用 Eclipse，但除了将分解后的 EAR 中更改的文件移动到 Jboss Deploy 目录中的 ant 任务之外，它没有做任何特别的事情。Netbeans 绝对可以处理蚂蚁，所以应该相当容易。

# collaboration - 您的组织如何处理通用组件？

> ID：829373
> 
> 赞同：5
> 
> 时间：2009-05-06T12:42:00.690
> 
> 标签：collaboration, project-organization

通用组件是由一个组创建和维护并由多个组使用的库或其他一些代码。

我们遇到的一些问题是：

*   用户不会报告组件的问题。
*   用户构建组件的变通方法以满足他们的需求。
*   他们打破与主干版本的兼容性只是为了满足他们的最后期限。
*   用户最终会编写自己的（不太健壮的）解决方案，因为他们认为这样更好。

您的组织如何处理通用组件？

我的想法：

*   将组件视为开源项目，并要求团队提交补丁。
*   完全不允许对代码进行自定义修改。
*   ...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T12:59:31.477

您在这里遇到的可能是人为因素问题，而不是技术问题。事实上，这可能主要是一个学习问题（再加上典型的非此处发明综合症）。

在大公司工作过，我意识到一个新人很难理解所有可用的资源（即共享代码库），更不用说如何以及何时正确使用它们了。

当您有新员工时，他/她是否在您的通用组件库中接受过正式培训？

然后是人们获得奖励的问题。在审查时，管理者是否奖励人们使用通用组件、改进它们并将改进提交回图书馆？或者经理们只是关心他们自己的项目。

至于您维护公共图书馆的小组，他们会给花时间建议或提交改进的人以什么形式或重新认识？他们会写在公司通讯中吗？获得现金红利？让他们的照片出现在公告板上？

请记住，人们极不可能为他们没有得到认可或奖励的公司做某事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T12:59:40.070

我们正在尝试转向更多基于服务的系统，以便如果我们为一个项目创建特定功能，则可以通过 Web 服务从另一个项目中使用它。这样，只有一个代码实例。

自然，这对于某些类型的组件（例如：我们最近创建了一个 PDF 创建服务）比其他组件（对于字符串操作实用程序来说可能是矫枉过正）更有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T12:52:55.390

我在这里看到的唯一成功的组件是以编译版本 (*.dll) 重新分发的。用户直接向拥有团队报告错误和请求功能，然后他们自己实现它们。有一个 api 用于为最有可能更改的内容编写自己的插件，因此人们可以在许多情况下扩展功能。

总是需要权衡取舍

*   说服人们使用你的组件
*   同时保持合理的质量水平

不确定在您的情况下最好的做法是什么，但通常尝试自己实现核心逻辑，保持组件可配置/可扩展，这样人们就不需要一直更改核心并提供良好的支持。出于某种原因，一些开发人员总是倾向于重新发明轮子，无论它多么愚蠢，所以我不会太担心它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T12:54:28.650

一个好方法是定期进行代码审查。在这些过程中，如果您发现重新发明了一个轮子，您可以利用这个机会教育开发人员使用通用组件，或者为什么他们觉得需要重新发明它，并将他们的推理与原始代码结合起来。这样就可以满足每个人的要求，并为每个人改进组件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T12:58:51.243

像对待第三方库一样对待它们。我什至不会让其他团队看到源头——这样做会导致大量浪费时间的批评和回击。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T13:10:06.910

组织有多大？我在一个小型组织（总共几十个程序员）中看到这些东西处理得非常好，其中一两个人已知拥有每个组件的所有权，并且对功能请求做出响应。

前往某人的办公室（或邮寄）更容易，解释您的需求，并获得以下之一：

*   做你想做的事情的预期方式，
*   同意添加所需的功能（或指示奴才这样做），
*   在公共组件中实现所需功能的权限，

不仅仅是开始编写变通方法、启动分叉或编写等效的新组件。如果你的程序员很聪明，他们会做他们认为最简单的事情。诀窍是确保这是正确的事情。

除了像链表这样非常简单的东西之外，并没有进行大量的轮子改造。很少有针对特定产品的私有分叉，最常见的是通过砍掉一些东西来减少代码大小。但是通常的方法是修改原始组件以具有更多构建选项。

# .net - 如何保护.net 中的网络服务？

> ID：829375
> 
> 赞同：13
> 
> 时间：2009-05-06T12:42:11.003
> 
> 标签：.net, web-services, security

我编写了一个简单的 .NET 网络服务，我将托管在可能位于不同大陆的不同服务器上。我真的不知道。现在，我只有它的 URL，我尝试使用 webrequest 和 webresponse 方法来访问那个 web 服务 vai HTTP POST。现在，我想知道有什么方法可以保护 Web 服务访问，这样没人可以利用它吗？

例如：

[http://example.com/Verify/Verification.asmx/Verify?AccountNumber=3223&ProductName=876](http://example.com/Verify/Verification.asmx/Verify?AccountNumber=3223&ProductName=876)

现在，这些都是调用此 Web 服务所需的所有参数。好像现在，任何人都可以利用它。那么我怎样才能使它安全呢？虽然，我打算获得 SSL，这整个事情是从服务器到服务器发生的，而不是从客户端到服务器？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T12:47:22.817

您可以在 Web 请求的授权标头中传递服务密钥（很像 Amazon WS），该服务密钥可以使用您选择的算法进行加密，然后在服务端解密，只有在密钥匹配时才继续执行

请参阅以下 URL 中的第 14.8 节

[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T12:50:37.270

不幸的是，您没有太多选择，因为您使用了旧的 ASMX Web 服务技术。通过 Internet 使用 ASMX Web 服务对某人进行身份验证的唯一方法基本上是“自己动手”。

如果我必须这样做，我会使用 WCF 并给自己一些选择。如果我不能使用 WCF，那么我将创建一个自定义 HTTP 标头来传递用户名和密码（通过 SSL！），并在服务器上对它们进行身份验证。或者，我会在客户端使用证书并要求将它们发送到服务器。IIS 甚至可以将客户端证书转换为服务器上的 Windows 身份。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T12:56:59.563

通常，在 WCF 之前用于保护 .NET Web 服务的是 Microsoft 的[Web 服务扩展 (WSE)](http://msdn.microsoft.com/en-us/library/ms977317.aspx)，现在是 3.0 版。我已经在一个市售产品中成功使用了它，而且它基于 W3C ws-* 标准，相当不错。如果您使用 Apache Axis，则可以成功地与 .NET 客户端（显然）以及 Java 客户端进行互操作。下载地址：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=018a09fd-3a74-43c5-8ec1-8d789091255d&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=018a09fd-3a74-43c5-8ec1-8d789091255d&displaylang=en)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:16:40.683

我们做了相当多的 Web 服务，为了保护它们，我们只是在请求对象中添加了用户名和密码。在您的情况下，您可以为用户名和密码添加 2 个新参数，或者更简单地添加一个并使用身份验证代码之类的东西，您可以根据需要将其设置为复杂或简单。

有些想法很简单，例如 GUID 列表，这些 GUID 是对请求服务器 IP 地址进行加密的可接受的通行密钥，因此身份验证代码仅适用于由 Web 服务验证的 IP 地址。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-08T12:11:10.563

您还可以创建一个令牌并将此令牌ID 作为参数传递给每个 Web 方法。您可以在哈希表中维护令牌，并在会话被放弃后从哈希表中删除。

成功登录后需要生成令牌。要生成令牌 ID，我建议使用`RNGCryptoServiceProvider`.

# c# - 谁是实时 TCP/IP 游戏服务器的好主机？

> ID：829376
> 
> 赞同：6
> 
> 时间：2009-05-06T12:42:22.750
> 
> 标签：c#, sockets, hosting

我试图设置一个实时游戏服务器来运行我正在编写为 C# .NET 3.5 服务的游戏。该游戏类似于经典乒乓球，因此我需要通过连接到服务器的持久套接字向两个客户端发送实时反馈。

这是一个如何编码的例子。 [http://www.codeproject.com/kb/IP/socketsByBobJanova.aspx](http://www.codeproject.com/kb/IP/socketsByBobJanova.aspx)

有谁知道任何可以支持此的托管服务？我只关心获得一个我现在可以测试的价格合理的主机。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T18:44:54.437

好的，这是一个答案，而不是一个简单的托管公司。我不确定你的手段，但我所做的是每月支付大约 300 美元在伊利诺伊州芝加哥购买 1/4 机架托管。为此，我获得了我需要的所有冗余电源和带宽（正常情况下 29Mb 向上，72Mb 向下）。然后我在 EBay 上买了一对 Dell PowerEdge 2850 Dual 2.8GHz Xeon、4GB RAM、3x73GB 15k RPM RAID，每个大约 350 美元。将它们全部放入并*繁荣*的即时数据中心。

我估计我花了大约 15 到 20 个小时来设置所有东西，1000 美元的硬件和每月 300 美元的托管费用。因此，它并不适合所有人，但对于需要控制其服务器但需要比托管更高的性能/可靠性的小型企业来说，这不是一个糟糕的选择。

# java - 如何对来自不同项目的关联类进行排序

> ID：829381
> 
> 赞同：1
> 
> 时间：2009-05-06T12:43:33.073
> 
> 标签：java, packaging

我有一种情况，我正在重构旧代码，拆开一个旧的怪物项目并将其（出于各种原因）拆分为更小的子项目。一个项目最终将包含大部分接口，而它们的相关实现在另一个项目中，我不确定设置包结构的最佳方法。

我应该去吗

> *org.company.interfaceproject.util.InterfaceClass*和
> *org.company.implementationproject.util.ImplementationClass*

或者

> *org.company.project.util.InterfaceClass*和
> *org.company.project.util.ImplementationClass*

其中第一个实现的优点是指出文件属于哪个项目，而第二个实现并没有混合文件在不同项目中的事实。

我想这里没有对错，但我很好奇是否有人对此事有任何意见。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:15:56.003

是的，您只需要提出一个命名约定。通常两者的结合适合我们公司以避免歧义。例如，假设您有一个接口：

```
org.company.service.UserService 
```

然后，我们将对由 spring 依赖项连接或具有 spring 依赖项的实现类使用以下内容：

```
org.company.service.spring.UserServiceImpl 
```

那么这两种观点中最好的：

1.  您将这些类干净地放在一个单独的包中
2.  使用这个类名约定，很明显它是 的实现`UserService`，即使在导入两个包时仍然可以区分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T12:50:32.933

两者都有优点。这最终取决于您对项目的意图。如果您的意图是最终创建接口的替代实现，则使用选项 1 可能更有意义。如果这将是接口的唯一实现，则选项 2 会更合理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T13:00:15.140

Sun 有[命名约定](http://java.sun.com/docs/codeconv/html/CodeConventions.doc8.html)。对于包裹：

> 唯一包名的前缀总是用全小写的ASCII字母写的，应该是顶级域名之一，目前是com, edu, gov, mil, net, org，或者是英文的两字母代码之一识别 ISO 标准 3166, 1981 中指定的国家/地区。
> 
> 包名称的后续组成部分根据组织自己的内部命名约定而有所不同。此类约定可能会指定某些目录名称组件是部门、部门、项目、机器或登录名。

所以我更喜欢您指定项目名称的第二个选项。或者我会像这样合并两者：

```
org.company.project.interfacepackage.util.InterfaceClass and
org.company.project.implementationpackage.util.ImplementationClass 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T12:55:30.690

如果可以的话，您应该将接口类放入单独的插件/包中。当您使用接口时，大多数时候您将拥有该接口的多个实现。

我更喜欢选项1

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T14:33:34.620

大多同意克林顿的观点。

最终，就 Java 而言，每个包名称都是一个孤岛，但根据在构建时组装的内容和内容来分隔事物会很方便，如下所示：

```
com.foo.client.*
com.foo.server.*
com.foo.common.*

```

大多数情况下，这会使您的 ant 文件集保持简单。请注意，即使由于构建方式或其他原因，源文件的布局完全不同，这也适用。我要说的唯一一件事是注意不要在多个源目录中获取相同的包！这可能很丑陋，而且很容易意外地做到。

因此，除非这种想法促使您创建单独的高级包，否则我喜欢将实现包放在接口包中的风格，给 impl 包起一个表明它是如何专业化的名称，并为实现命名`FooImpl`。您几乎从不需要导入多个实现，但有时您确实希望同时导入接口和实现，在这种情况下，如果它们具有相似的名称会很好。

# asp.net - 如何发现 ASP.NET 应用程序重启的原因

> ID：829392
> 
> 赞同：20
> 
> 时间：2009-05-06T12:45:43.507
> 
> 标签：asp.net

有没有办法监视（记录）重新启动 ASP.NET 应用程序的原因？

我们现在遇到了相当复杂的网站的问题。它在文件上传期间重新启动。不是在每个文件上，而是在每 5 到 10 个文件上。我们使用自定义 VirtualPathProvider，所以这可能是一个原因。我们还有一个后台工作线程，这也可能是一个原因。知道原因就好了。

XP (IIS 5.1) 和 Windows Server 2003 (IIS 6) 上出现问题。

**解析度：**

谢谢各位，我们已经抓到了。它是由达到最大重新编译次数引起的。很可能问题出在我们的 VirtualPathProvider 中，但这是完全不同的问题。

方法总结：

1.  在 ScottGu 的博客中破解非常完美。
2.  通过 machine.config 进行监控也很棒，但我更喜欢将其记录到我们的日志中。
3.  事实证明，最简单的解决方案是检查我的**Application_End**方法中的**HostingEnvironment.ShutdownReason**属性。

 *** * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T13:31:48.123

您是否查看过“[记录 ASP.NET 应用程序关闭事件](http://weblogs.asp.net/scottgu/archive/2005/12/14/433194.aspx)”中的记录建议？这将是我对获取有关正在发生的事情的更多信息的方法的建议。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-06T12:58:24.677

在应用程序文件夹中添加或删除文件夹将导致应用程序池回收（在您的情况下最可能的原因）以及许多其他事情。这是一篇有趣的文章：

[http://blogs.msdn.com/johan/archive/2007/05/16/common-reasons-why-your-application-pool-may-unexpectedly-recycle.aspx](http://blogs.msdn.com/johan/archive/2007/05/16/common-reasons-why-your-application-pool-may-unexpectedly-recycle.aspx)

在同一个站点上有一些关于如何监控重启的很好的提示，这正是您实际要求的。选择是 web.config 和 EventViewer 或 Performance Monitor。

[http://blogs.msdn.com/johan/archive/2008/02/18/monitoring-application-pool-and-application-restarts.aspx](http://blogs.msdn.com/johan/archive/2008/02/18/monitoring-application-pool-and-application-restarts.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T15:18:25.963

[ASP.NET 升级工程师Tess Ferrandez](https://docs.microsoft.com/en-us/archive/blogs/tess/)有一个很好的博客，其中包含调试 ASP.NET 应用程序的各种提示和技巧。

您特别感兴趣的帖子是：

*   [ASP.NET 案例研究：丢失的会话变量和应用程序域回收](https://docs.microsoft.com/en-us/archive/blogs/tess/asp-net-case-study-lost-session-variables-and-appdomain-recycles)
*   [对应用程序域重新启动和 ETW 跟踪的其他问题进行故障排除](https://docs.microsoft.com/en-us/archive/blogs/tess/troubleshooting-appdomain-restarts-and-other-issues-with-etw-tracing)

她将引导您完成找出问题所在以及如何解决问题的步骤。

另一件需要注意的事情是防病毒软件扫描站点根目录下的文件——这可能会更改文件的修改日期，并导致应用程序回收。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T14:23:25.720

查看 Microsoft 模式和实践开发人员中心的这篇文章：

[.NET Framework 应用程序的生产调试](http://msdn.microsoft.com/en-us/library/ms954593.aspx)

[另请参阅Jeff Atwood](http://www.codinghorror.com/blog/archives/000021.html)的此博客条目：

[在生产环境中调试 ASPNET_WP](http://www.codinghorror.com/blog/2004/06/debugging-aspnet_wp-in-production.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-07-23T12:57:31.330

正如其他人所说，检查`HostingEnvironment.ShutdownReason`。如果值为`BinDirChangeOrDirectoryRename`，则某些进程正在更改应用程序文件夹中的某些文件（创建、删除、更改属性）。

如果找不到谁在做这个，请使用SysInternals[的](https://docs.microsoft.com/en-us/sysinternals/)[Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon)。就我而言，是防病毒进程设置了文件 CreationTime（到他们之前的 CreationTime！）。

# iphone - 如何将多个项目合并为一个项目

> ID：829394
> 
> 赞同：2
> 
> 时间：2009-05-06T12:46:37.217
> 
> 标签：iphone, xcode, projects

我想把我写的几个 iphone 项目合并成一个项目。最简单的方法是什么？如果我可以从 iphone 主屏幕上的一个按钮访问所有这些项目，我会很高兴。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T12:50:00.267

项目有多复杂？如果它们都是单视图或基于导航的，那么设置一个新的基于选项卡的项目并将每个子项目分配给一个选项卡是将它们组合到一个包中的一种非常有效的方法。还有许多其他方法可以做到这一点，“最佳”方法实际上取决于您正在组合的项目类型。

# php - extract() 有什么问题？

> ID：829407
> 
> 赞同：44
> 
> 时间：2009-05-06T12:51:13.680
> 
> 标签：php, arrays, extract

我最近在阅读[这个线程](https://stackoverflow.com/questions/233030/worst-php-practice-found-in-your-experience/233746)，关于一些最糟糕的 PHP 实践。在第二个答案中有一个关于使用的小型讨论`extract()`，我只是想知道所有的愤怒是关于什么的。

我个人使用它来分割给定的数组，例如`$_GET`或`$_POST`稍后我清理变量的位置，因为它们已方便地为我命名。

这是不好的做法吗？这里有什么风险？您对使用 有什么想法`extract()`？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-05-06T13:04:37.127

我发现这只是一种不好的做法，因为它可能导致未来的维护者（或几周后的你自己）不知道它们来自哪里的许多变量。考虑这种情况：

```
extract($someArray); // could be $_POST or anything

/* snip a dozen or more lines */

echo $someVariable; 
```

是从哪里来`$someVariable`的？谁能告诉我？

我没有看到从它们开始的数组中访问变量的问题，所以你真的需要提供一个很好的案例让*我*`extract()`认为它是值得的。如果您真的担心输入一些额外的字符，那么只需执行以下操作：

```
$a = $someLongNameOfTheVariableArrayIDidntWantToType;

$a['myVariable']; 
```

我认为这里关于它的安全方面的评论有些夸大其词。该函数可以采用第二个参数，该参数实际上使您可以很好地控制新创建的变量，包括不覆盖任何现有变量（`EXTR_SKIP`），仅覆盖现有变量（以便您可以创建白名单）（`EXTR_IF_EXISTS`），或为变量添加前缀( `EXTR_PREFIX_ALL`)。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-05-06T16:42:31.470

现在来吧。人们责怪工具而不是用户。

这就像反对，`unlink()`因为你可以用它删除文件。`extract()`与其他任何功能一样，请明智且负责任地使用它。但不要声称它本身很糟糕，那只是无知。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-05-06T13:07:47.510

风险是：不要信任来自用户的数据，并且提取到当前符号表中意味着，您的变量可能会被用户提供的内容覆盖。

```
<?php
    $systemCall = 'ls -lh';
    $i = 0;

    extract($_GET);

    system($systemCall);

    do {
        print_r($data[$i];
        $i++;
    } while ($i != 3);

?> 
```

（一个荒谬的例子）

但现在猜测或知道代码的恶意用户调用：

```
yourscript.php?i=10&systemCall=rm%20-rf 
```

代替

```
yourscript.php?data[]=a&data[]=b&data[]=c 
```

现在， $systemCall 和 $i 被覆盖，导致您的脚本首先删除您的数据然后挂起。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-06T13:21:01.563

没有什么问题。否则不会实施。当您将变量传递（分配）给视图时，许多（MVC）框架都会使用它。你只需要小心使用它。在将这些数组传递给 extract() 之前对其进行清理，并确保它不会覆盖您的变量。不要忘记这个函数还接受更多参数！使用第二个和第三个参数，您可以控制发生碰撞时的行为。您可以覆盖、跳过或添加前缀。 [http://www.php.net/extract](http://www.php.net/extract)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-06T20:31:40.937

如果不小心使用，它可能会使与您一起工作的其他人感到困惑，请考虑：

```
<?php

    $array = array('huh' => 'var_dump', 'whatThe' => 'It\'s tricky!', 'iDontGetIt' => 'This Extract Function');
    extract($array);
    $huh($whatThe, $iDontGetIt);

?> 
```

产量：

```
string(12) "It's tricky!"
string(21) "This Extract Function" 
```

在混淆中使用会很有用。但我无法克服“那个 var 是从哪里来的？” 我遇到的问题。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-07T02:59:33.470

人们对提取物全力以赴，因为它有*可能*被滥用。在任何情况下，执行类似 extract($_POST) 的操作都不是一个好主意，即使您知道自己在做什么。但是，当您执行诸如将变量暴露给视图模板或类似的事情时，它确实有它的用途。基本上，只有在您非常确定自己有充分的理由这样做时才使用它，并且如果您想到将诸如 $_POST 之类的疯狂的东西传递给它，请了解如何使用提取类型参数。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-06T13:02:28.893

我猜很多人不推荐使用它的原因是提取`$_GET`和`$_POST`（甚至`$_REQUEST`）超全局变量在全局命名空间中注册变量，与这些数组中的每个键同名，这基本上是在模拟 REGISTER_GLOBALS = 1。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-06T17:53:15.047

如果您在函数中提取，则变量将仅在该范围内可用。这通常在视图中使用。简单的例子：

```
//View.php
class View {
    function render($filename = null) {
        if ($filename !== null) {
            $this->filename = $filename;
        }
        unset($filename);
        extract($this->variables);
        ob_start();
        $this->returned = include($this->dir . $this->filename);
        return ob_get_clean();
    }
}

//test.php
$view = new View;
$view->filename = 'test.phtml';
$view->dir = './';
$view->variables = array('test' => 'tset');
echo $view->render('test.phtml');
var_dump($view->returned);

//test.phtml
<p><?php echo $test; ?></p> 
```

使用一些替代目录，检查文件是否存在并定义变量和方法——您几乎复制了 Zend_View。

您还可以添加*$this->outVariables = get_defined_vars();* 在 include 之后运行具有特定变量的代码并获得这些结果以用于旧的 php 代码。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-06T16:48:59.787

我会让[PHP 手册](http://www.php.net/manual/en/security.globals.php)为我说话。

背景：与php.ini`extract($_REQUEST)`中的设置相同`register_globals = On`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-06T19:48:55.360

永远不要在全局范围内提取（$_GET）。除此之外，它还有它的用途，比如调用一个可能（可能）有很多可选参数的函数。

这对 WordPress 开发人员来说应该有点熟悉：

```
function widget (Array $args = NULL)
{
    extract($args);

    if($before_widget) echo $before_widget;

    // do the widget stuff

    if($after_widget) echo $after_widget;
}

widget(array(
    'before_widget' => '<div class="widget">',
    'after_widget' => '</div>'
)); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-11-09T21:29:46.857

正如有人在另一个线程中指出的那样，[这是使用 extract 的一种更安全的方法](http://fr2.php.net/manual/en/function.extract.php#59152)，只允许它提取您指定的变量，而不是提取数组包含的所有内容。

这具有双重目的，即记录从中产生的变量，因此追溯变量不会那么困难。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-03-29T16:54:10.427

只要您以安全的方式使用提取物，它就是安全的。您想要做的是将数组的键过滤为您打算使用的键，如果您的方案需要它们存在，则可能检查所有这些键是否存在。

```
#Extract only the specified keys.
$extract=array_intersect_key(
    get_data()
    ,$keys=array_flip(['key1','key2','key3','key4','key5'])
);

#Make sure all the keys exist.
if ($missing=array_keys(array_diff_key($keys,$extract))) {
    throw new Exception('Missing variables: '.implode(', ',$missing));
}

#Everything is good to go, you may proceed.
extract($extract); 
```

或者

```
#If you don't care to check that all keys exist, you could just do this.
extract(array_intersect_key(
    get_data()
    ,array_flip(['key1','key2','key3','key4','key5'])
)); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-05-06T13:00:24.173

风险与 register_globals 相同。您可以让攻击者在您的脚本中设置变量，只需篡改请求即可。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-07-02T10:09:17.780

每种方法的使用都可能导致某些情况，在这些情况下，它可能成为应用程序的故障点。我个人认为 extract() 不应该用于用户输入（不可预测）和未清理的数据。

甚至 CodeIgniter 核心代码也使用了提取，所以如果数据经过清理和处理，使用该方法一定没有害处。

我在 CodeIgniter 模型中使用了带有 EXTR_IF_EXISTS 开关并限制变量数量的提取，它工作得很好。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-05-03T13:55:03.617

请注意，`extract()`如果您正在处理用户数据（如请求的结果），那么这是不安全的，因此最好将此函数与标志`EXTR_IF_EXISTS`和`EXTR_PREFIX_ALL`.

如果使用得当，就可以放心使用

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-12-12T07:50:24.180

仅对先前的答案进行一些说明... extract() 只要您正确过滤输入就没有问题（正如其他人所说）；否则你可能会遇到像这样的巨大安全问题：

```
<?php

// http://foobar.doo?isLoggedIn=1

$isLoggedIn = (new AdminLogin())->isLoggedIn(); // Let's assume this returns FALSE

extract($_GET);

if ($isLoggedIn) {
    echo "Okay, Houston, we've had a problem here.";
} else {
    echo "This is Houston. Say again, please.";
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-03-26T12:14:54.787

添加到@user10306 我想出了一个简单的函数来安全地加载 $_POST 变量。它只提取指定的变量

```
function diffArr(array $input, array $allowed) {
    foreach ($input as $key => $v) 
        if(!in_array($key, $allowed)) unset($input[$key]);
    return $input;
}

extract(diffArr($_POST, ['title', 'tagline', 'content', 'user_id'])); 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2015-01-28T22:36:03.427

不再使用 extract() 的另一个很好的理由是 PHP 中有一种使用[HHVM](http://hhvm.com/)的势头，它声称可以使 PHP 快 10 倍。Facebook（谁创造了它）正在使用它，维基百科也在上面，据传 WordPress 正在研究它。

[HHVM 不允许 extract()](http://docs.hhvm.com/manual/en/rarentry.extract.php)

它仍然是一种阿尔法，所以它不是最大的问题

# latex - 从tex中提取文本，删除latex标签

> ID：829408
> 
> 赞同：24
> 
> 时间：2009-05-06T12:51:17.487
> 
> 标签：latex

我有一些 .tex 文件，我想从中接收没有任何乳胶标签的纯文本，例如 \section{...} 或 \newpage。
有人对如何实现这一目标有任何想法吗？我也有 .pdf 文件，但是当我从那里复制代码时，有些单词会被连接起来，这真的很糟糕。
有什么你知道的工具吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-06T13:37:14.583

[检测（1）](http://www.cs.purdue.edu/homes/trinkle/detex/)：

> 请参阅[OpenDetex GitHub 页面](https://github.com/pkubowicz/opendetex)以获取最新版本的[OpenDetex](https://github.com/pkubowicz/opendetex)。它是我原来的 DeTeX 的更现代的衍生版本。
> 
> 我的旧版[DeTeX 主页](https://www.cs.purdue.edu/homes/trinkle/detex/index-legacy.html)可[在此处找到](https://www.cs.purdue.edu/homes/trinkle/detex/index-legacy.html)。
> 
> 如果您只想要旧版[detex-2.8.tar](https://www.cs.purdue.edu/homes/trinkle/detex/detex-2.8.tar)源，您可以在[此处](https://www.cs.purdue.edu/homes/trinkle/detex/detex-2.8.tar)获取。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-01-14T13:50:19.757

[opendetex](http://code.google.com/p/opendetex/) 可用于 Windows 和 Linux

从这里下载程序 opendetex
[http://opendetex.googlecode.com/files/opendetex-2.8.1.tar.bz2](http://opendetex.googlecode.com/files/opendetex-2.8.1.tar.bz2)
[http://code.google.com/p/opendetex/downloads/list](http://code.google.com/p/opendetex/downloads/list)

用法： [http ://code.google.com/p/opendetex/wiki/Usage](http://code.google.com/p/opendetex/wiki/Usage)

将其解压缩到您选择的任何目录。假设您将其解压缩到下载目录。

在其中创建另一个任何名称的目录（可选。但如果你创建它会很好）。说目录名称是“my_paper”。将您的论文放在“my_paper”目录中。说你的论文名称是 project.tex

浏览路径

```
cd ~/Downloads/opendetex 
```

运行命令

```
detex -n my_paper/project.tex  > out.txt 
```

通用形式

```
detex -n full_path_to_tex_file.tex > output_text_file.txt 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-10-28T16:56:29.783

也许不是 100% OP 要求的，但也许有一些帮助。

在[poppler-utils](https://en.wikipedia.org/wiki/Poppler_(software)#poppler-utils)`pdftotext`中有。这可以通过以下方式将 PDF 文件转换为 TXT 文件

```
pdftotext yourPDF.pdf 
```

当然这会产生安装这个包的开销，但我认为它可以忽略不计，因为如果我没记错的话，它是在 Linux 上呈现 PDF 的标准库，所以如果你安装了 PDF 查看器（Think Evince 或 Okular），它会已经安装。

[在此处](https://www.howtogeek.com/228531/how-to-convert-a-pdf-file-to-editable-text-using-the-command-line-in-linux/)找到更多说明。

# jquery - 将 RJS/原型代码重构为 JQuery

> ID：829411
> 
> 赞同：0
> 
> 时间：2009-05-06T12:52:04.350
> 
> 标签：jquery, prototypejs

我正在努力为 Prototype（转换为 JQuery）中的方法寻找合适的替代方法，并想知道你们是否可以提供合适的替代方法。

我正在重构的 RJS 代码是：

```
 if request.post? && @success
    page << "window.location.href='/news'"
 else
    page.replace_html :user_overlay, :partial => 'login'
      if @error_msg.blank?
        page.visual_effect :appear, 'user_overlay', :duration => '0.7'
    else
        page.replace_html 'overlay_messages', @error_msg
        page.visual_effect :highlight, 'overlay_messages', :startcolor => "#404040", :endcolor => "#666666"
    end 
```

它通过部分加载，并替换 div [登录错误] 中的元素，我们正在使用 JQuery 运行 Ruby on Rails。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T13:21:37.757

我建议安装插件 [jRails](http://github.com/aaronchi/jrails/tree/master)。

我已经用 RJS 使用它一段时间了，没有任何问题。完美替代原型。

# wpf - 如何将参数从 Xaml 传递给按钮工具的命令对象？

> ID：829415
> 
> 赞同：2
> 
> 时间：2009-05-06T12:53:10.383
> 
> 标签：wpf

如何将参数从 Xaml 传递给按钮工具的命令对象？

```
<igRibbon:ButtonTool Id="btnFindEntity" Caption="Search" LargeImage="Images/Search.png" igRibbon:RibbonGroup.MaximumSize="ImageAndTextLarge" Command="{Binding RibbonSearchCommand}"/> 
```

请帮我处理上面的代码。我必须传递一个组合框和一个文本框值作为参数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T16:56:45.867

如果文本框和组合框的值构成作为数据上下文的业务对象的一部分，则可以将其作为**CommandParameter="{Binding}"**传递。否则，Command 是对象类型，您可以为这两个值创建一个容器并传递它！

# aix - 如何在 AIX 机器上找到 syslog

> ID：829416
> 
> 赞同：1
> 
> 时间：2009-05-06T12:53:26.420
> 
> 标签：aix, syslog

我有一台机器在通常的地方没有系统日志。我将如何找到它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T13:03:15.430

从...开始：

```
man syslogd 
```

然后从那里去。

或者你是说那`/etc/syslog.conf`不存在。

如果它在那里，它应该能够告诉您所有日志文件的位置。如果它不存在，您需要找出`syslogd`运行方式，或者：

*   通过查看它的条目`ps`；或者
*   看着`/etc/rc.d`启动它的条目。

# javascript - 跨浏览器侧边栏组件

> ID：829422
> 
> 赞同：2
> 
> 时间：2009-05-06T12:55:02.017
> 
> 标签：javascript, browser, sidebar

我想为网站创建一个跨浏览器的侧边栏。具有以下特点

*   需要能够获取主页的 URL - 如果仅适用于当前站点，则可以
*   托管在主网站域上
*   不需要更改主要网站页面本身（但可以将代码添加到全局加载的 .js 文件中）
*   在主流浏览器中工作（例如 firefox 有几种方法）。并且 target=_search 已在很大程度上被弃用-效果很好。
*   理想情况下不需要下载（例如，不是 Firefox 扩展或 BHO）
*   理想情况下不会在每个页面加载时重新加载（即不在每个页面中注入 iframe - 闪烁）
*   理想情况下不是框架集 - url 浏览器地址栏不会改变。

想不出一个很好的简单方法来做到这一点。有什么建议么？（我想我已经排除了要求的主要方式 - 但万一遗漏了什么）

（将相关信息显示到当前页面，作为可选插件，供需要的人使用）

感谢您的任何想法！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-23T16:38:08.497

您可以考虑使用其中一种跨浏览器扩展 (google-gears/silverlight/adobe-air/ [jnext](http://www.jnext.org/) ) 来呈现此栏。我的意思是，你可以将你的 UI 添加到任何现有的 DOM 中，并拥有一个这样的平台来为你的“侧边栏”添加功能，而不是实现一个在不同浏览器之间变化的“真实”侧边栏

# apache-flex - 如何获取加载的 swf 的背景颜色？

> ID：829423
> 
> 赞同：3
> 
> 时间：2009-05-06T12:55:03.327
> 
> 标签：apache-flex, actionscript-3, flash, loader

当您在运行时加载外部 swf 时，有什么方法可以获取 swf 的背景颜色？- 那是舞台背景颜色。加载的 swf 由用户上传，他们可能知道也可能不知道正确的颜色。
我知道通常这是在 HTML 代码中指定嵌入 swf，但如果您在独立播放器中运行 swf，它将显示正确的颜色，因此信息应该在某处。
我想要做的是在加载的 swf 后面创建一个背景，所以它会按预期显示。

编辑：如果可能的话，我更喜欢客户端解决方案。如果不是，服务器端是基于 .net 的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T13:33:30.660

您可以读取 .swf 二进制文件中的**SetBackgroundColor**标记。不知道如何找到它，但此链接可能会有所帮助： http: [//www.adobe.com/devnet/swf/pdf/swf_file_format_spec_v10.pdf](http://www.adobe.com/devnet/swf/pdf/swf_file_format_spec_v10.pdf)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T22:32:50.380

有关已加载 SWF 的任何类型的信息最有可能出现`contentLoaderInfo`在 Loader 的属性中。背景颜色没有属性。可能可以抓取`content`加载器的 ，看看您是否可以从中提取`[SWF]`元数据，它可以`backgroundColor`作为属性包含在内。但是，它可能并非在所有情况下都可用，并且很有可能编译器实际上并没有在默认情况下保留此元数据以供 ActionScript 访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:05:08.620

如果你在你的服务器上运行 php，你可以使用[PHP SWF Reader](http://www.sephiroth.it/swfreader.php)来找到它，我相信其他语言也有类似的库。

# java - 从 SQL Exception 对象获取导致异常的字段和表名

> ID：829424
> 
> 赞同：2
> 
> 时间：2009-05-06T12:55:09.397
> 
> 标签：java, sql, hibernate, spring, jpa

我在我的项目中使用 Hibernate JPA 和 Spring。假设如果我尝试插入具有重复键值的记录，插入查询将抛出异常。

现在，是否可以在运行时从 SQL Exception 对象中获取表名、字段名和异常的可能原因！？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:45:03.170

正如其他答案所提到的，大多数情况下，您仅限于数据库提供的内容。但是在某些情况下，Hibernate 可以告诉您问题 - 它不会是表和字段，但可以是实体和属性

例如，如果您尝试在列中放置太大的值，您可以使用以下命令：

```
try {
    entityManager.persist(object);

} catch (InvalidStateException e) {

    log.info("Caught Hibernate exception: #0", e.getClass().getName());

    InvalidValue[] invalidValues = e.getInvalidValues();

    for(InvalidValue invalidValue : invalidValues) {
        log.info("Invalid Property #0 has value: #1", invalidValue.getPropertyName(), invalidValue.getPropertyName());
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T14:01:38.737

SQLExceptions 往往只是包装数据库错误，如果它包含在数据库抛出的错误中，您只能获取此类信息。根据我调试 hibernate 和 JDBC 的经验，我冒昧地认为这个问题的答案通常是“否”，但可能会有例外。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T14:15:34.537

hibernate 将 SQLException 包装为 JDBCException 并尝试使用附加到 SessionFactory 的 SQLExceptionConverter 将其转换为更有意义的完整异常，例如 ConstraintViolationException。

```
SQLException sqlException = ((JDBCException)ex).getSQLException(); 
```

# asp.net-mvc - 动态表单 ASP.NET MVC

> ID：829431
> 
> 赞同：0
> 
> 时间：2009-05-06T12:57:06.677
> 
> 标签：asp.net-mvc

我的问题如下。我有一个创建帐户的系统。但是，不同的用户可以为创建的帐户设置不同的属性。这意味着我为不同的用户获得了具有不同属性的动态表单。我应该如何处理这样的表格？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T13:05:25.767

使用 jQuery 对客户端进行排序后，您可能希望根据是否存在任何类型的条目来处理表单值。查看在控制器上使用以下内容来获取整个表单集合：

```
public ActionResult AddUser(FormCollection formvals)
{
    //Check for existence of form values and save as appropriate

    return View();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:59:54.923

看起来您需要根据用户选择隐藏/显示一些 HTML 元素。看看 jQuery 在客户端操作表单元素。

# c - 我们如何在 Linux 2.6 中从保护模式转换到实模式？

> ID：829434
> 
> 赞同：4
> 
> 时间：2009-05-06T12:57:34.663
> 
> 标签：c, linux, assembly, operating-system, nasm

我们如何在 Linux 2.6 中从保护模式转换到实模式？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T14:48:28.063

你不。

内核在实模式下根本无法运行，也无法（明智地）进行 bios 调用，因此您无论如何都无法做任何事情。

您可能会查看 DosEMU 如何使用 v86 模式来运行您的“实模式”代码，但仅此而已。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T16:55:49.660

如果你真的需要硬件上的实模式，你也可以看看[FreeDOS 。](http://www.freedos.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T22:13:16.480

内核在引导/启动序列的一开始就从实模式切换到保护模式，并且没有回头路。有关更多详细信息，请参阅[引导加载程序的工作原理。](http://www.xs4all.nl/~lennartb/bootloaders/node3.html)

如果你有一些程序需要实模式，有[v86 模式](http://osdev.berlios.de/v86.html)。正在进行[一些](http://v86-64.sourceforge.net/) [工作以在 64 位模式下添加对此的支持。](http://sourceforge.net/projects/v86-64/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:40:33.390

[ELKS](http://elks.sourceforge.net/) Linux 端口可以做实模式，但离 2.6 还差得很远。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-10T10:28:00.373

我们可以通过编写一些代码行作为内核的一部分，从保护模式切换到实模式。

主要是在 cr0 寄存器上禁用**PE 位**后，我们需要加载相应的**GDT、LDT、IDT**。只需点击此链接了解更多详情[http://www.sudleyplace.com/pmtorm.html](http://www.sudleyplace.com/pmtorm.html)。

# java - 没有 IllegalArgumentException 的 Apache commons PredicatedList

> ID：829435
> 
> 赞同：2
> 
> 时间：2009-05-06T12:57:49.403
> 
> 标签：java, api, collections, apache-commons

[如果您尝试添加的内容与谓词不匹配， Apache Commons Collections](http://commons.apache.org/collections/apidocs/index.html?overview-summary.html)中是否有办法拥有一个[PredicatedList](http://commons.apache.org/collections/apidocs/org/apache/commons/collections/list/PredicatedList.html)（或类似的）不会抛出 IllegalArgumentException ？如果不匹配，它将忽略将项目添加到列表的请求。

例如，如果我这样做：

```
List predicatedList = ListUtils.predicatedList(new ArrayList(), PredicateUtils.notNullPredicate());
...
predicatedList.add(null); // throws an IllegalArgumentException 
```

我希望能够执行上述操作，但是添加 null 被忽略而没有抛出异常。

如果 Commons Collections 支持这一点，我无法从 JavaDocs 中弄清楚。如果可能的话，我想在不滚动我自己的代码的情况下这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T13:08:41.033

你不能吞下这个例外吗？

```
try
{
    predicatedList.add(null);
}
catch(IllegalArgumentException e)
{ 
    //ignore the exception
} 
```

您可能需要编写一个包装器来为您执行此操作...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:00:57.757

刚刚找到[CollectionUtils.filter](http://commons.apache.org/collections/apidocs/org/apache/commons/collections/CollectionUtils.html#filter(java.util.Collection,%20org.apache.commons.collections.Predicate))。我可能可以修改我的代码来使用它，尽管首先悄悄地阻止添加到列表中仍然会很好。

```
 List l = new ArrayList();
    l.add("A");
    l.add(null);
    l.add("B");
    l.add(null);
    l.add("C");

    System.out.println(l); // Outputs [A, null, B, null, C]

    CollectionUtils.filter(l, PredicateUtils.notNullPredicate());

    System.out.println(l); // Outputs [A, B, C] 
```

# grep - 如何在包含特定单词的 cpp 文件中查找函数

> ID：829447
> 
> 赞同：5
> 
> 时间：2009-05-06T13:03:08.923
> 
> 标签：grep, vim

使用 grep、vim 的 grep 或其他 unix shell 命令，我想在一个大型 cpp 文件中找到它们的主体中包含特定单词的函数。

在我正在使用的文件中，我正在查找的单词位于缩进行上，相应的函数标题是缩进行上方的第一行，从位置 0 开始，而不是“{”。

例如在以下代码片段中搜索 JOHN_DOE

```
int foo ( int arg1 ) 
{
    /// code 
}
void bar ( std::string arg2  )
{
    /// code
    aFunctionCall( JOHN_DOE );
    /// more code
} 
```

应该给我

```
void bar ( std::string arg2  ) 
```

我希望在 grep/vim/unix shell 脚本中捕获的算法可能最好使用缩进和格式假设，而不是尝试解析 C/C++。

感谢您的建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T10:13:17.670

我可能会因此而被否决！

我是一个狂热的 (G)VIM 用户，但是当我想查看或理解一些代码时，我使用[Source Insight](http://www.sourceinsight.com/)。不过，我几乎从不将它用作实际的编辑器。

在这种情况下，它完全符合您的要求，例如在关系窗口中显示使用某些突出显示的数据类型/定义/常量/等的所有函数/方法...

[![来源洞察网站的关系窗口的 gif](https://i.stack.imgur.com/JOrtX.gif)](https://i.stack.imgur.com/JOrtX.gif)
[（来源：[sourceinsight.com](http://www.sourceinsight.com/docs35/ae1183f1.gif)）]

哎哟! 我的代表去了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T18:09:25.910

据我所知，这是做不到的。原因如下：

首先，您必须跨行搜索。没问题，在 vim 中向字符类添加 _ 会告诉它包含新行。所以 {_.*} 将匹配多行括号之间的所有内容。

所以现在你需要匹配函数头的任何模式（即使你让它工作也很脆弱），然后，这就是问题所在，**它和你的搜索字符串之间的任何行**，最后匹配你的搜索字符串。所以你可能有一个像

```
/^\(void \+\a\+ *(.*)\)\_.*JOHN_DOE 
```

但发生的情况是 vim 第一次找到函数头时，它开始匹配。然后它*匹配每个字符*，直到找到 JOHN_DOE。其中包括文件中的所有函数头。

所以问题是，据我所知，除了这个正则表达式模式之外，没有办法告诉 vim 匹配每个字符。即使有，正则表达式也不是这项工作的工具。这就像用锤子打开啤酒一样。我们应该做的是编写一个简单的脚本，为您提供这些信息，我有。

```
fun! FindMyFunction(searchPattern, funcPattern)
  call search(a:searchPattern)
  let lineNumber = line(".")
  let lineNumber = lineNumber - 1
  "call setpos(".", [0,  lineNumber, 0, 0])

  let lineString = getline(lineNumber)
  while lineString !~ a:funcPattern
    let lineNumber = lineNumber - 1
    if lineNumber < 0
      echo "Function not found :/"
    endif
    let lineString = getline(lineNumber)
  endwhile

  echo lineString

endfunction 
```

这应该会给你你想要的结果，而且它比 Cthulhu 自己口中吐出的正则表达式更容易共享、调试和重新调整用途。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T13:32:51.957

您不能使用正则表达式可靠地做到这一点，因为代码不是正则语言。您需要一个真正的解析器来处理相关语言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:11:37.860

艰难的呼吁，虽然作为一个起点，我会建议这个精彩的[VIM 正则表达式教程](http://www.geocities.com/volontir/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T13:55:43.180

对于那种东西，虽然又是原始搜索，但我会推荐[compview](http://www.vim.org/scripts/script.php?script_id=1803)插件。它将打开一个搜索窗口，因此您可以看到搜索发生的整行并自动跳转到它。提供了一个很好的概述。

[![替代文字](https://i.stack.imgur.com/quor4.jpg)](https://i.stack.imgur.com/quor4.jpg)
[（来源：[axisym3.net](http://axisym3.net/jdany/wp-content/images/compview.jpg)）]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T19:18:21.033

啊！我承认这有点过头了：

一个过滤标准输入、去除注释和将函数体放在同一行的小程序。它会被类声明中的命名空间和函数定义所迷惑，除了其他的东西。但这可能是一个好的开始：

```
#include <stdio.h>
#include <assert.h>

int main() {
    enum {
        NORMAL,
        LINE_COMMENT,
        MULTI_COMMENT,
        IN_STRING,
    } state = NORMAL;
    unsigned depth = 0;
    for(char c=getchar(),prev=0; !feof(stdin); prev=c,c=getchar()) {
        switch(state) {
        case NORMAL:
            if('/'==c && '/'==prev)
                state = LINE_COMMENT;
            else if('*'==c && '/'==prev)
                state = MULTI_COMMENT;
            else if('#'==c)
                state = LINE_COMMENT;
            else if('\"'==c) {
                state = IN_STRING;
                putchar(c);
            } else {
                if(('}'==c && !--depth) || (';'==c && !depth)) {
                    putchar(c);
                    putchar('\n');
                } else {
                    if('{'==c)
                        depth++;
                    else if('/'==prev && NORMAL==state)
                        putchar(prev);
                    else if('\t'==c)
                        c = ' ';
                    if(' '==c && ' '!=prev)
                        putchar(c);
                    else if(' '<c && '/'!=c)
                        putchar(c);
                }
            }
            break;
        case LINE_COMMENT:
            if(' '>c)
                state = NORMAL;
            break;
        case MULTI_COMMENT:
            if('/'==c && '*'==prev) {
                c = '\0';
                state = NORMAL;
            }
            break;
        case IN_STRING:
            if('\"'==c && '\\'!=prev)
                state = NORMAL;
            putchar(c);
            break;
        default:
            assert(!"bug");
        }
    }
    putchar('\n');
    return 0;
} 
```

它的 c++，所以只是它在一个文件中，将它编译成一个名为“剥离器”的文件，然后：

```
cat my_source.cpp | ./stripper | grep JOHN_DOE 
```

所以考虑输入：

```
int foo ( int arg1 ) 
{
    /// code 
}
void bar ( std::string arg2  )
{
    /// code
    aFunctionCall( JOHN_DOE );
    /// more code
} 
```

“”的输出`cat example.cpp | ./stripper`是：

```
int foo ( int arg1 ) { }
void bar ( std::string arg2 ){  aFunctionCall( JOHN_DOE ); } 
```

“”的输出`cat example.cpp | ./stripper | grep JOHN_DOE`是：

```
void bar ( std::string arg2 ){  aFunctionCall( JOHN_DOE ); } 
```

查找函数名称（猜测它的最后一个标识符在“ `(`”之前）的工作留给读者作为练习。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T13:48:49.843

您可以使用`grep -r -n -H JOHN_DOE *`它将从当前目录开始递归地在文件中查找“JOHN_DOE”

您可以使用以下代码实际找到包含文本表达式的函数：

```
 public void findFunction(File file, String expression) {
    Reader r = null;
    try {
        r = new FileReader(file);
    } catch (FileNotFoundException ex) {
        ex.printStackTrace();
    }
    BufferedReader br = new BufferedReader(r);

    String match = "";
    String lineWithNameOfFunction = "";

    Boolean matchFound = false;

    try {
        while(br.read() > 0) {
            match = br.readLine();
            if((match.endsWith(") {")) ||
                    (match.endsWith("){")) ||
                    (match.endsWith("()")) ||
                    (match.endsWith(")")) ||
                    (match.endsWith("( )"))) {
                // this here is because i guessed that method will start
                // at the 0
                if((match.charAt(0)!=' ') && !(match.startsWith("\t"))) {
                    lineWithNameOfFunction = match;                        
                }
            }

            if(match.contains(expression)) {
                matchFound = true;
                break;
            }
        }
        if(matchFound)
            System.out.println(lineWithNameOfFunction);
        else 
            System.out.println("No matching function found");
    } catch (IOException ex) {
        ex.printStackTrace();
    }
} 
```

我用 JAVA 写了这个，测试了它，就像一个魅力。虽然有一些缺点，但对于初学者来说很好。没有添加对包含相同表达式的多个函数的支持，也许还有其他一些东西。试试看。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-06T13:51:26.797

就像罗伯特说的，正则表达式会有所帮助。在命令模式下，通过键入“/”字符后跟您的正则表达式来启动正则表达式搜索。

Ctags [1](http://en.wikipedia.org/wiki/Ctags)也可能对您有用。它可以为项目生成标签文件。这个标签文件允许用户直接从函数调用跳转到它的定义，即使它在另一个文件中使用“CTRL+]”。

# ios - Objective-C/Cocoa 中 Java 的 Thread.sleep() 等价物是什么？

> ID：829449
> 
> 赞同：120
> 
> 时间：2009-05-06T13:03:33.137
> 
> 标签：ios, objective-c, cocoa-touch, sleep

在 Java 中，您可以使用`Thread.sleep()`. Objective-C中有这样的东西吗？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2009-05-06T13:07:35.387

是的，有[+[NSThread sleepForTimeInterval:]](https://developer.apple.com/documentation/foundation/nsthread/1413673-sleepfortimeinterval?language=objc)

（只是为了让你知道未来的问题，Objective-C 是语言本身；对象库（至少其中一个）是 Cocoa。）

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2013-05-29T20:24:59.113

在 Java 中休眠**一秒钟：**

```
Thread.sleep(1000); 
```

在 Objective C 中休眠**一秒钟：**

```
[NSThread sleepForTimeInterval:1.0f]; 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-05-06T18:55:05.863

你为什么睡觉？当你睡觉时，你会阻塞 UI 以及任何不在其他线程中的后台 URL 加载（使用 NSURL 异步方法仍然在当前线程上运行）。

您真正想要的是 performSelector:withObject:AfterDelay。这是 NSObject 上的一个方法，您可以使用它稍后在某个预定时间间隔调用一个方法 - 它安排将在稍后执行的调用，但线程处理的所有其他内容（如 UI 和数据加载）将仍然继续。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-06T14:27:41.047

当然，您也可以使用标准的 Unix sleep() 和 usleep() 调用。（但是，如果编写 Cocoa，我会使用 [NSThread sleepForTimeInterval:]。）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-03-25T08:28:53.863

如果使用 NSThread sleepForTimeInterval（注释代码）休眠，取数据会被阻塞，但是 +[NSThread sleepForTimeInterval:]（checkLoad 方法）不会阻塞取数据。

我的示例代码如下：

```
- (void)viewDidAppear:(BOOL)animated
{
//....
//show loader view
[HUD showUIBlockingIndicatorWithText:@"Fetching JSON data"];
//    while (_loans == nil || _loans.count == 0)
//    {
//        [NSThread sleepForTimeInterval:1.0f];
//        [self reloadLoansFormApi];
//        NSLog(@"sleep ");
//    }
[self performSelector:@selector(checkLoad) withObject:self afterDelay:1.0f];
}

-(void) checkLoad
{
    [self reloadLoansFormApi];
    if (_loans == nil || _loans.count == 0)
    {
        [self performSelector:@selector(checkLoad) withObject:self afterDelay:1.0f];
    } else
    {
        NSLog(@"size %d", _loans.count);
        [self.tableView reloadData];
        //hide the loader view
        [HUD hideUIBlockingIndicator];
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-24T00:48:28.743

usleep() 也可以用作我使用它来暂停当前线程的时候

# linux-kernel - iptables 和 libpcap

> ID：829455
> 
> 赞同：4
> 
> 时间：2009-05-06T13:04:46.800
> 
> 标签：linux-kernel, iptables, libpcap

我已设置规则以丢弃具有匹配字符串的 udp/tcp 数据包。但是，我使用 libpcap 捕获数据包的程序仍然能够看到这个数据包。

为什么是这个/，在libpcap看到之前丢弃数据包的iptable规则应该是什么？

无论如何，也许除了 iptables 规则之外，在 libpcap/tcpdump 看到它之前丢弃这个数据包？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T13:10:23.913

[是的，libpcap 可以看到所有的数据包。](http://mydebian.blogdns.org/?p=85). 它们在被 netfilter 处理之前被捕获。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-06-05T16:08:28.657

您是否尝试更改您使用的 netfilter 挂钩的优先级？如果您尝试使用最高优先级挂钩传入数据包，它将在数据包套接字内核代码之前获取数据包，这是 libpcap 用来捕获数据包的方式。

*** 我假设你使用的是 linux ***

编辑：Libpcap 使用不同的方法来捕获数据包 - 根据操作系统。在 linux 上，它使用数据包套接字，该套接字使用 netfilter 框架在内核代码中实现。

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-06-03T04:55:09.853

libpcap 无法在 netfilter 之前看到数据包，netfilter 是一个内核模块，它会在所有数据包到达用户模式之前对其进行处理，甚至可以在内核看到之前看到数据包。你能解释一下吗？libpcap 也可能在 netfilter 上设置了覆盖 iptables 的钩子。真正的问题是在 netfilter 上查看和设置什么钩子绝非易事，只能在内核模式下完成。调查 libpcap 如何获取数据包。

# java - Spring 原型 bean 与单例 bean 和依赖注入相结合。是否有一种仅用于配置的方法？

> ID：829463
> 
> 赞同：23
> 
> 时间：2009-05-06T13:06:29.167
> 
> 标签：java, spring

我有一个单例 bean，每次调用函数都需要返回对不同（新）原型 bean 的引用。我能想到的唯一方法是通过调用其 getBean() 方法以编程方式从 BeanFactory/ApplicatioContext 检索一个新的原型 bean 实例。代码示例将遵循...

有一个更好的方法吗？希望只能通过配置？（就个人而言，我怀疑有...）

```
<bean id="protoBean" scope="prototype"
        class="com.blahblah.ProtoBean" />

<bean id="singletonBean"
        class="com.blahblah.SingletonBean" />

public class ProtoBean {

    ....
}

public class SingletonBean {

    private BeanFactory factory;

    public ProtoBean dispense() {
        return (ProtoBean) factory.getBean("protoBean");
    }

    ....
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T13:24:22.320

看看[方法注入](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-method-injection)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-01-10T01:15:58.780

从 Spring 3.0 开始，我们可以使用`<aop:scoped-proxy>`适当范围的依赖注入。在幕后，Spring 注入代理对象并负责找到正确的范围上下文，可能是原型、会话或请求等。请参阅[此处](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-factory-scopes-other-injection)的官方文档。

为了让生活更轻松，Spring 还为 @Scope 引入了 proxyMode 属性，因此我们不仅限于 XML 声明。例如：

```
@Scope(value = "prototype", proxyMode = ScopedProxyMode.INTERFACES) 
```

确保清楚地记录注入的 bean 是一个代理，以警告其他人 getClass() 和强制转换可能不会产生预期的结果。此外，确保代理类中的 equals() 和 hashCode() 使用访问方法，而不是直接访问类变量。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-11-01T08:51:53.810

使用方法注入使单例bean 类难以进行单元测试（您需要创建一个子类来实现给出依赖关系的方法）。再加上它的可重用性较低，因为您不能直接实例化它，因此如果您不使用 Spring 并想使用此类，则需要子类化并提供 bean-returning 方法。

恕我直言，更好的方法是使用代理、原型目标源和原型目标 bean，如下所示。这样的单例bean 类很容易进行单元测试并且可以更好地重用。

```
<bean id="targetPooledObject" class="pool.PooledObject" scope="prototype">
    <constructor-arg value="42" />
</bean>

<bean id="prototypeTargetSource" class="org.springframework.aop.target.PrototypeTargetSource">
    <property name="targetBeanName" value="targetPooledObject" />
</bean>

<bean id="pooledObject" class="org.springframework.aop.framework.ProxyFactoryBean">
    <property name="targetSource" ref="prototypeTargetSource" />           
</bean>

<bean id="poolConsumer" class="pool.PoolConsumer">
    <property name="pooledObject" ref="pooledObject" />
</bean> 
```

现在我们可以注入`pooledObject`一个单例 bean（`poolConsumer`如上所示），并且对于我们对该单例 bean 进行的每个方法调用（例如，每次我们调用`poolConsumer.callPooledObjectMethod()`哪个依次调用`pooledObject.foo()`）我们都会得到一个新的 PooledObject bean。

下面是对应的代码：

```
public class PooledObject 
{
    private int x;

    public PooledObject(int x)
    {
        this.x = x;
    }

    public void foo()
    {
        System.out.println("foo called");
    }
}

public class PoolConsumer
{
    private PooledObject pooledObject;

    public PooledObject getPooledObject() 
    {
        return pooledObject;
    }

    public void setPooledObject(PooledObject pooledObject) 
    {
        this.pooledObject = pooledObject;
    }

    public void callPooledObjectMethod()
    {
        pooledObject.foo();
    }
} 
```

# c++ - 如何通过覆盖执行 boost::filesystem copy_file

> ID：829468
> 
> 赞同：50
> 
> 时间：2009-05-06T13:07:53.983
> 
> 标签：c++, windows, boost, boost-filesystem

Windows API 函数`CopyFile`有一个参数`BOOL bFailIfExists`，允许您控制是否要覆盖目标文件（如果存在）。

该`boost::filesystem` `copy_file`函数没有这样的参数，如果目标文件存在则将失败。有没有一种优雅的方式来使用 boost copy_file 函数并覆盖目标文件？还是简单地使用 Windows API 更好？我目前的目标平台是 Windows，但我更喜欢使用 STL 并尽可能使用 boost 来保持我的代码平台独立。

谢谢你。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2010-04-26T23:25:39.467

copy_file还有第三个**枚举**参数**boost::filesystem::copy_option::overwrite_if_exists**

```
copy_file(source_path, destination_path, copy_option::overwrite_if_exists); 
```

[https://www.boost.org/doc/libs/1_75_0/libs/filesystem/doc/reference.html](https://www.boost.org/doc/libs/1_75_0/libs/filesystem/doc/reference.html)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-11-16T14:32:22.087

当心带有 copy_option::overwrite_if_exists 的 boost::copy_file ！如果目标文件存在且小于源文件，则该函数只会覆盖目标文件中的第一个 size(from_file) 字节。

至少对我来说这是一个警告，因为我认为 copy_option::overwrite_if_exists 影响*文件*而不是*内容*

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-06T13:17:08.593

首先测试目标文件是否存在，如果存在则将其删除：

```
if (exists (to_fp))
    remove (to_fp);
copy_file (from_fp, to_fp); 
```

或者，如果您担心文件出现在测试和副本之间，那么您可以写入一个临时文件，然后将其重命名为目标文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T18:06:19.833

> 有没有一种优雅的方式来使用 boost copy_file 函数并覆盖目标文件？

显然没有直接的 API 可以做到这一点。

> 还是简单地使用 Windows API 更好？我目前的目标平台是 Windows，但我更喜欢使用 STL 并尽可能使用 boost 来保持我的代码平台独立。

从文档中：

> C++ 标准委员会接受了在技术报告 2 中包含 Boost.Filesystem 的提案 N1975。Boost.Filesystem 库将与 TR2 文件系统提案保持一致，因为它通过 TR2 流程工作。但是请注意，Boost.Filesystem 和 TR2 提案之间的命名空间和标头粒度不同。

这强烈表明坚持`boost::filesystem`是一个好主意。

# c# - C# 程序在创建 Windows Media Encoder 对象时总是崩溃

> ID：829470
> 
> 赞同：1
> 
> 时间：2009-05-06T13:08:15.497
> 
> 标签：c#, .net, windows, media, encoder

我正在使用 Windows Vista x86 + VSTS 2008。使用语句创建新的 Windows Media Encoder 对象时

WMEncoder 编码器 = 新的 WMEncoder();

我的程序在 VSTS 2008 中总是崩溃。这是屏幕快照。有什么想法有什么问题吗？

[http://i40.tinypic.com/2v96uqo.jpg](http://i40.tinypic.com/2v96uqo.jpg)

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T15:22:54.890

看起来问题可能出在 Windows Media Encoder 中：http: [//support.microsoft.com/kb/929182](http://support.microsoft.com/kb/929182)

您可能只需要更新 WME 即可。作为测试，您可以在 XP 上尝试此操作以查看它是否有效 - 如果有效，则可能是 Vista 上的 WME 版本。

这似乎是[https://stackoverflow.com/questions/493069/wmencoder-issue的副本](https://stackoverflow.com/questions/493069/wmencoder-issue)

# c# - C#：是否可以返回 IOrderedEnumerable ?

> ID：829487
> 
> 赞同：6
> 
> 时间：2009-05-06T13:13:10.630
> 
> 标签：c#, generics, ienumerable

`IOrderedEnumerable<T>`是否可以在不使用`OrderBy`or`OrderByDescending`方法的情况下从方法返回an `IEnumerable<T>`？

我猜也许不是……但是……也许我错了？

* * *

原因：主要是好奇。当我在返回数字中的数字时做出[这个答案时，这让我很受打击。](https://stackoverflow.com/questions/829174/is-there-an-easy-way-to-turn-an-int-into-an-array-of-ints-of-each-digit/829476#829476)我的方法将根据给定数字中的权重以升序返回数字。因此，我认为如果它们以一种框架也可以识别为有序的方式排列出来会很好。当然，我们可以争辩说，从一个共同的数字的角度来看，它们不是有序的。但是，是的......如果他们应该或不应该不是这里的重点。只要有可能。

我想我也是在暗示一个问题（或者至少现在是），如果 an`IOrderedEnumerable<T>`不仅仅是`IEnumerable<T>`具有不同名称的 an。它是否包含更多内容？我知道它有`ThenBy`and`ThenByDescending`方法，但是它们是否使用了内部的任何东西`IOrderedEnumerable<T>`，或者只是直接在 an 上使用它们没有意义`IEnumerable<T>`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T13:20:37.073

好吧，`IOrderedEnumerable<T>`如果你愿意，你也可以自己实现......这并不*难*，这取决于你需要做什么。最简单的选择就是打电话`OrderBy`/`OrderByDescending`虽然:)

你为什么感兴趣？

# sql-server - 在哪里可以找到 SQL Server 开发人员版（2005 或 2008）

> ID：829488
> 
> 赞同：2
> 
> 时间：2009-05-06T13:13:12.240
> 
> 标签：sql-server, download

据我所知，SQL Server 的开发者版可供所有人使用。我似乎无法在任何地方找到下载！我有一个technet plus，但即使在那里我也看不到开发者版。我需要开发者版来获得企业专用功能，或者我会使用 SQL Server Express。

更新 1\. 我不是在寻找 SQL express。

更新 2\. 我已经尝试过谷歌（广泛）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T13:30:19.560

*购买开发人员*版没有特殊许可（如学术） 。唯一的区别是包含的 EULA 许可声明您不能将软件用于生产环境（仅用于测试/开发）。

想买吗？

[微软商店](http://store.microsoft.com/microsoft/SQL-Server-2008-Developer-Edition/product/C5EA00C9?WT.mc_id=productinfocenter)（49.95 美元，与亚马逊出售 2005 年开发者的价格相同）

编辑：澄清一下，开发者版*不是*免费产品。一些 MSDN 订阅（价格远高于 49.95 美元）将其作为一项福利包括在内，但就微软而言，它仍然是一种收缩包装的零售产品。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T13:33:16.107

试试这个： [https ://www.microsoft.com/sqlserver/2008/en/us/developer.aspx](https://www.microsoft.com/sqlserver/2008/en/us/developer.aspx)

瑞安

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T13:15:48.970

你肯定会通过微软的 MSDNAA 学术计划获得开发者版。

开发者版本质上是具有许可证限制的企业版。

那就用企业版吧。

如果您没有企业版的许可证，无论如何您将无法在生产中使用您在开发者版中提出的任何内容。

如果您不关心许可证，您可以从您找到的任何地方下载它。但是，谷歌是一个比 SO 社区更好的地方。

编辑：您不能合法地免费获得企业版的开发人员。如果您的客户没有给您许可证，并且您自己也没有购买许可证，那么您就没有合法的选择来执行这项工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T13:23:19.267

虽然这与编程无关，但无论如何我都会回答。

事实上，开发者版并不是所有人都可以使用的。据我所知，获得它的唯一方法是通过 MSDN 订阅（不是 TechNet，我不认为；对不起！），其中包括服务器软件（因此高于“操作系统”订阅级别）。

我将为您提供疑问，并假设您对企业唯一功能的需求是用于开发环境，并且部署环境具有企业版的有效许可证。如果是这种情况，那么您必须获得 MSDN 订阅。

出于好奇，您打算使用哪些“仅限企业”功能？根据我的经验，一小部分开发人员实际上需要标准版提供的功能之外的任何东西。

# javascript - 处理游戏开发中的战斗效果

> ID：829490
> 
> 赞同：7
> 
> 时间：2009-05-06T13:13:52.143
> 
> 标签：javascript, design-patterns

我正在尝试为我作为个人项目修补的游戏制定高级技术规范。这是一款回合制冒险游戏，就我想要做的事情而言，它可能最接近[执政官。](http://en.wikipedia.org/wiki/Archon_(computer_game))

我遇到的问题是概念化开发战斗系统的最佳方式，我一开始可以简单地实施，但这将允许在未来增加扩展和复杂性。

具体来说，我很难弄清楚如何处理战斗特效，即可能由演员、物品或环境应用或移除的奖励或负面效果。

*   如果游戏本身在每次尝试做出决定性的掷骰时检查每个武器、盔甲、演员和位置，我是否让演员处理所有正在发挥/反对他们的效果。
*   效果是在单个对象中处理的，还是存在“效果”对象或两者兼而有之？

我很可能在这里根本没有很好地解释自己，如果我的要求过于宽泛和空洞，我很乐意尝试扩展这个问题。但我最初的想法是，比我更聪明的人已经花费了时间和精力来弄清楚这样的事情，坦率地说，我不想过早地用我自己愚蠢的死胡同来玷污谈话。

有问题的语言是javascript，尽管在这一点上我认为它不会有很大的不同。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T15:16:14.880

你所说的“特殊效果”过去被称为“修改器”，但现在在 MMO 中流行的术语是“爱好者”。考虑到您可以选择在每个阶段能够赋予多少多功能性，处理这些问题就像您希望的那样容易或困难。

但从根本上说，系统的每个方面通常都会存储一个适用于它的修饰符列表，您可以按需查询它们。通常，在任何给定时间只有少数修改器适用于任何一个玩家，所以这不是问题 - 获取玩家的统计数据和技能/法术/其他任何修改器赋予的任何修改器，添加磨损设备赋予的任何修改器，然后添加所讨论的武器所赋予的任何东西。如果您在此处提出一个供参与者、项目、位置等使用的标准接口（例如 sumModifiersTo(attributeID)），那么实现它可以快速而简单。

通常，“效果”对象将包含在它们所属的实体中：演员有一个效果列表，他们穿着或使用的物品有自己的效果列表。如果效果被明确激活和/或有时间限制，则由您决定将它们存储在哪里 - 例如。如果你有魔法药水或其他消耗品，它们的效果将需要附加到 Actor 而不是（可能被摧毁的）物品上。

不要试图让效果就地修改演员属性，因为如果您不确保所有添加和删除都按照正确的协议完成，您很快就会发现属性很容易“漂移”。这也使得以后绕过某些修饰符变得更加困难。例如。想象一个只保护其他魔法的魔法盾——你可以将某种谓词传递给你的修饰符总计函数，忽略某些类型的效果来做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T13:31:34.457

看看 Elisabeth Freeman 的书[Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)。具体来说，阅读装饰器和工厂模式以及接口编程方法，而不是实现。我发现这本书非常有效地说明了一些可能让你继续下去的复杂概念。

希望这有助于为您指明正确的方向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T21:22:43.380

乍一看，我会说，考虑到所有适用于该战斗员的修饰符，单个战斗员（玩家和 NPC）在确定他们的战斗特征（即护甲值、命中数、伤害范围等）方面发挥着作用. 所以战斗系统不会试图弄清楚角色的职业是否会给他/她带来护甲加成，魔法武器是否会影响命中等等。

但我希望战斗系统本身在单个战斗人员之外。它将获取有关攻击者和所需攻击类型以及目标或一组目标的信息并解决该问题。

对我来说，这种模型反映了我们在纸笔角色扮演游戏中实际进行战斗的方式。DM 询问每个玩家他或她的角色的详细信息，然后使用该信息作为输入进行战斗。它在现实世界中的工作表明它是一个非常灵活的系统。

# java - Netbeans 不兼容类型问题

> ID：829491
> 
> 赞同：1
> 
> 时间：2009-05-06T13:14:02.377
> 
> 标签：java, jsp, netbeans6.5, incompatibility

我在 Netbeans 中收到以下警告：

```
incompatible types
found : carPackage.port.search
required : carPackage.SearchResponse 
```

在我的 JSP 页面中，我有以下代码：

```
CarService service = new CarService();
CarPort port = service.getCarPort();
SearchResponse searchResult = port.search("Toyota"); 
```

错误显然发生在这一行：

```
SearchResponse searchResult = port.search("Toyota"); 
```

我应该输入什么数据类型而不是 SearchResponse？

谢谢，卢卡斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T13:21:31.173

你不见了；从最后。如果 CarPort.search 返回 SearchResponse，那么您的数据类型是正确的。

# math - 给定空间中的一个点和一个向量，绘制一条 X 长度的线

> ID：829496
> 
> 赞同：3
> 
> 时间：2009-05-06T13:15:24.450
> 
> 标签：math, 3d, drawing

在每个人都指责我外包我的作业之前，我的问题不是关于我的作业的问题。我只是无法正确绘制一些东西。

我正在尝试绘制垂直于平面的线。我知道构成飞机的空间的三个点。从这些坐标中，我可以计算矢量并获得平面的法线矢量。使用三个点中心的坐标和法线向量，我可以绘制一条垂直于平面的线。

我的问题是该线的长度与法线向量相关，因为我只是将向量添加到坐标以获得两个点来绘制一条线。在不使用一些可怕的蛮力代码的情况下，如何在给定 3D 空间中的任何点和任何向量的情况下绘制一条固定长度的线。

（我在这里问是因为我不知道在谷歌上搜索时使用的术语，我的教科书没有任何与此相关的内容，而且我的教授在到期之前不会有空。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T13:19:31.943

您需要“规范化”您的法线向量..

为此，将向量除以其大小。

矢量 r 的长度或大小由下式给出：

```
 `l = √ x² + y² + z²` 
```

`然后你将 r 除以它的长度（即除以它的每个组成部分）给出` 

```
``n = { x/l, y/l, z/l }`` 
```

``这将为您提供长度为 1 的新法线向量。``

 ``然后你可以将它乘以你想要的任何长度..达到你需要的任何尺寸线

# java - 在java中获取今天的日期 - 我已经尝试过常规方法

> ID：829510
> 
> 赞同：14
> 
> 时间：2009-05-06T13:19:19.790
> 
> 标签：java, date

我需要今天的日期 - 并将其他任何内容归零（“ 05/06/08 00:00:00 ”）

我试过了

```
Calendar calendar = Calendar.getInstance(); 
calendar.set(Calendar.HOUR, 0);        
Date date1 = calendar.getTime();                             
System.out.println(date1); 
```

运行：（这严重搞砸了）

如果计算机上的时间小于中午 12:00：Sun Mar 08 00:44:39 IST 2009

如果计算机上的时间大于中午 12:00：Sun Mar 08 12:46:53 IST 2009

所以我放弃了这个。

不推荐使用所有日期的设置器（纪元时间除外） - 所以我也不想使用它们

我唯一能想到的是

```
Calendar calendar = Calendar.getInstance();     
SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
String sDate = dateFormat.format(calendar.getTime());
Date today = dateFormat.parse(sDate); 
```

但这是一个蹩脚的代码，我无法让自己编写它。

还有其他选择吗？

谢谢！

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-06T13:26:24.080

我用这个：

```
public static Date startOfDay(Date date) {
   Calendar dCal = Calendar.getInstance();
   dCal.setTime(date);
   dCal.set(Calendar.HOUR_OF_DAY, 0);
   dCal.set(Calendar.MINUTE, 0);
   dCal.set(Calendar.SECOND, 0);
   dCal.set(Calendar.MILLISECOND, 0);

   return dCal.getTime();
 } 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-06T13:24:03.227

我对 Java 日期/时间问题的标准建议：不要使用`java.util.{Calendar,Date}`. 使用[乔达时间](http://joda-time.sourceforge.net/index.html)。这样，您可以将日期表示为[日期](http://joda-time.sourceforge.net/api-release/org/joda/time/LocalDate.html)（没有关联的时区），而不是日期/时间。或者您可以使用 a[`DateMidnight`](http://joda-time.sourceforge.net/api-release/org/joda/time/DateMidnight.html)如果那是您想要表示的内容。*（但要*注意没有午夜的时区和日期的组合......）

你需要用`Date`with 做什么？如果您可以在整个过程中改用 Joda，那就太好了。否则，您可以使用 Joda 做您想做的事，然后`java.util.Date`在您真正需要时转换为毫秒（然后转换为 ）。

（如果您真的想坚持使用损坏的 API，Michael 在使用`Date`/时的解决方案`Calendar`很好......但我不能夸大 Joda 有多好......）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-06T13:27:02.050

您应该使用[HOUR_OF_DAY](http://java.sun.com/javase/6/docs/api/java/util/Calendar.html#HOUR_OF_DAY)而不是[HOUR](http://java.sun.com/javase/6/docs/api/java/util/Calendar.html#HOUR)，并将其与 MINUTE 和 SECOND 结合使用。

```
import java.util.Calendar;
import static java.util.Calendar.HOUR_OF_DAY;
import static java.util.Calendar.MINUTE;
import static java.util.Calendar.SECOND;
import static java.util.Calendar.MILLISECOND;

public class Today { 
    public static void main( String [] args ) { 
        Calendar cal = Calendar.getInstance();
        cal.set( HOUR_OF_DAY, 0 );
        cal.set( MINUTE, 0 );
        cal.set( SECOND, 0 );
        cal.set( MILLISECOND, 0 );
        System.out.println( cal.getTime() );
    }
} 
```

您得到的结果是由于 HOUR 用于 AM/PM 而 HOUR_OF_DAY 是 24 小时。

**HOUR_OF_DAY：**

> *get 和 set 的字段编号，指示一天中的小时。HOUR_OF_DAY 用于 24 小时制。例如，在晚上 10:04:15.250，HOUR_OF_DAY 是 22。*

**小时：**

> *get 和 set 的字段编号，指示上午或下午的时间。HOUR 用于 12 小时制 (0 - 11)。中午和午夜用 0 表示，而不是用 12 表示。例如，在晚上 10:04:15.250，HOUR 是 10。*

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-06T13:23:29.623

时间组件不仅仅是小时（正如您所注意到的，Calendar.HOUR 是 AM/PM）。您需要将*所有*时间字段设置为 0：HOUR_OF_DAY、MINUTE、SECOND、MILLISECOND。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-06T13:26:31.020

请参阅[Apache 的 commons-lang](http://commons.apache.org/lang/api/org/apache/commons/lang/time/DateUtils.html#truncate(java.util.Calendar,%20int)) DateUtils.truncate()

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2021-06-20T10:59:17.560

# *java.time*

`java.util`日期时间 API 及其格式化 API已`SimpleDateFormat`过时且容易出错。建议完全停止使用它们并切换到[现代 Date-Time API](https://www.oracle.com/technical-resources/articles/java/jf14-Date-Time.html) ^*。

另外，下面引用的是来自[**Joda-Time**](https://www.joda.org/joda-time/)[主页](https://www.joda.org/joda-time/)**的通知：**

 **> 请注意，从 Java SE 8 开始，用户被要求迁移到 java.time (JSR-310) - JDK 的核心部分，它取代了这个项目。

**使用`java.time`现代日期时间 API 的解决方案：**

现代 Date-Time API 有[许多类型](https://docs.oracle.com/javase/tutorial/datetime/iso/overview.html)，它们真正表示特定时区中的日期或时间或日期时间。您可以根据您的具体要求从以下选项中进行选择：

1.  如果您正在寻找一种表示[没有时区的日期](https://docs.oracle.com/javase/tutorial/datetime/iso/date.html)的类型，您可以使用[`LocalDate.now`](https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html#now--). 好消息是它的变体[`LocalDate#now(ZoneId)`](https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html#now-java.time.ZoneId-)从指定时区的系统时钟返回当前日期。
2.  如果您正在寻找一个表示没有时区的日期并且时间单位设置为零的对象，您可以调用使用**Option#1**[`LocalDate#atStartOfDay`](https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html#atStartOfDay--)获得的对象。
***   如果您正在寻找表示使用**Option#2**[`Instant`](https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html)获得的 Date-Time 对象，您可以将此对象附加到using以获取 a并将其转换为using 。**`ZoneId.of("Etc/UTC")`[`LocalDateTime#atZone`](https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html#atZone-java.time.ZoneId-)`ZonedDateTime``Instant`[`ZonedDateTime#toInstant`](https://docs.oracle.com/javase/8/docs/api/java/time/chrono/ChronoZonedDateTime.html#toInstant--)****

 ******演示：**

```
import java.time.Instant;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.ZonedDateTime;

public class Main {
    public static void main(String[] args) {
        LocalDate todayInSystemTz = LocalDate.now();
        System.out.println(todayInSystemTz);

        LocalDate todayInIndia = LocalDate.now(ZoneId.of("Asia/Kolkata"));
        System.out.println(todayInIndia);

        LocalDateTime todayInSystemTzWithZeroTimeUnits = todayInSystemTz.atStartOfDay();
        System.out.println(todayInSystemTzWithZeroTimeUnits);

        ZonedDateTime todayInUtcWithZeroTimeUnits = todayInSystemTzWithZeroTimeUnits.atZone(ZoneId.of("Etc/UTC"));
        System.out.println(todayInUtcWithZeroTimeUnits);

        Instant instant = todayInUtcWithZeroTimeUnits.toInstant();
        System.out.println(instant);

        // Can I represent the obtained Instant in India?
        System.out.println(instant.atZone(ZoneId.of("Asia/Kolkata")));

        // Can I represent the obtained Instant in New York?
        System.out.println(instant.atZone(ZoneId.of("America/New_York")));
    }
} 
```

**输出：**

```
2021-06-20
2021-06-20
2021-06-20T00:00
2021-06-20T00:00Z[Etc/UTC]
2021-06-20T00:00:00Z
2021-06-20T05:30+05:30[Asia/Kolkata]
2021-06-19T20:00-04:00[America/New_York] 
```

[`ONLINE DEMO`](https://ideone.com/3HOPKS)

`Z`输出中的 是零时区偏移的时[区指示符](https://en.wikipedia.org/wiki/ISO_8601#Time_zone_designators)。它代表 Zulu 并指定`Etc/UTC`时区（时区偏移量为`+00:00`小时）。

出于任何原因，如果您需要将此对象转换`Instant`为`java.util.Date`^(**)对象，您可以执行以下操作：

```
Date date = Date.from(instant); 
```

**[从Trail: Date Time](https://docs.oracle.com/javase/tutorial/datetime/index.html)**了解有关现代日期时间 API 的更多信息。

* * *

^(* 出于任何原因，如果您必须坚持使用 Java 6 或 Java 7，则可以使用[***ThreeTen-Backport，***](http://www.threeten.org/threetenbp/)它将大部分*java.time*功能向后移植到 Java 6 和 7。如果您正在为 Android 项目和 Android API 工作level 仍然不符合 Java-8，请检查[Java 8+ APIs available through desugaring](https://developer.android.com/studio/write/java8-support-table)和[How to use ThreeTenABP in Android Project](https://stackoverflow.com/questions/38922754/how-to-use-threetenabp-in-android-project)。)

^(**`java.util.Date`对象仅表示自称为“纪元”的标准基准时间（即 1970 年 1 月 1 日 00:00:00 GMT（或 UTC）以来的***毫秒数。***由于它不保存任何时区信息，因此它的函数应用 JVM 的时区以从该***毫秒***值派生的格式**[`toString`](https://docs.oracle.com/javase/8/docs/api/java/sql/Date.html#toString--)**返回 a 。要以不同的格式和时区表示对象，您需要使用所需的格式和适用的时区，例如`String``EEE MMM dd HH:mm:ss zzz yyyy`**`String``java.util.Date``SimpleDateFormat`**)

 **```
Date date = new Date();

SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSXXX", Locale.ENGLISH);

sdf.setTimeZone(TimeZone.getTimeZone("America/New_York"));
String strDateNewYork = sdf.format(date);

sdf.setTimeZone(TimeZone.getTimeZone("Etc/UTC"));
String strDateUtc = sdf.format(date); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-06T13:57:13.367

如上所述，您应该使用

```
Calendar.HOUR_OF_DAY 
```

相对于

```
Calendar.HOUR 
```

`Calendar.MINUTE`您还需要通过将其他字段（ 、`Calendar.SECOND`和`Calendar.MILLISECOND`）设置为零来清除它们。

抱歉，这里没有简单的方法。很痛苦，这就是为什么他们正在为 Java 7 开发新的 API，我相信它基于 Joda Time。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-05T10:03:49.900

...或者您可以通过黑客方式进行操作：

```
long MS_PER_DAY = 86400000L;
Date dateTime=new Date();
long offset = TimeZone.getDefault().getOffset(dateTime.getTime());
Date date= new Date(((dateTime.getTime()+offset)/MS_PER_DAY)*MS_PER_DAY-offset); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-06-24T15:00:24.597

我知道这是一个非常古老的问题，不再活跃，但当我搜索谷歌时，它出现在首位。

虽然所有建议都很好，但我不敢相信没有人简单地回答：

```
Date date = new Date(System.currentTimeMillis());
System.out.println(date); 
```

今天的日期有效地返回。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T13:24:51.960

为什么要进行字符串操作？

在使用 getTime() 转换为 Date 之前，您不能只在 Calendar 对象上设置所需的值吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-06T13:31:01.947

JodaTime 的另一票。

java.util.Date 和 Calendar 太糟糕了，它们坏了。（而且 SimpleDateFormat 也是垃圾！）

值得一提的是，Java 7 将包含一个基于 JodaTime 的新日期时间库。

# sql - 防止递归 CTE 多次访问节点

> ID：829514
> 
> 赞同：20
> 
> 时间：2009-05-06T13:20:22.970
> 
> 标签：sql, sql-server, recursion, graph, common-table-expression

考虑以下简单的 DAG：

```
 1->2->3->4 
```

还有一个表，#bar，描述了这个（我使用的是 SQL Server 2005）：

```
parent_id   child_id
1           2
2           3
3           4
//... other edges, not connected to the subgraph above 
```

现在想象一下，我有一些其他任意标准来选择第一个和最后一个边，即 1->2 和 3->4。我想用这些来找到我的图表的其余部分。

我可以按如下方式编写递归 CTE（我使用的是[MSDN](http://msdn.microsoft.com/en-us/library/ms186243.aspx)中的术语）：

```
with foo(parent_id,child_id) as (
// anchor member that happens to select first and last edges:
select parent_id,child_id from #bar where parent_id in (1,3)
union all
// recursive member:
select #bar.* from #bar
join foo on #bar.parent_id = foo.child_id
)
select parent_id,child_id from foo 
```

但是，这会导致边 3->4 被选择两次：

```
parent_id  child_id
1          2
3          4
2          3
3          4    // 2nd appearance! 
```

如何防止查询递归到已经描述的子图中？如果在查询的“递归成员”部分中，我可以引用*到目前为止由递归 CTE 检索到的所有数据*（并在递归成员中提供一个谓词指示，不包括已访问的节点），我就可以实现这一点。但是，我认为我只能访问递归成员*的最后一次迭代返回的数据。*

当有很多这样的重复时，这将无法很好地扩展。有没有办法防止这种不必要的额外递归？

请注意，我可以在语句的最后一行使用“select distinct”来获得所需的结果，但这似乎是*在完成*所有（重复）递归之后应用的，所以我认为这不是一个理想的解决方案。

*编辑*- hainstech 建议通过添加一个谓词来排除在起始集中显式递归的向下路径来停止递归，即仅递归`where foo.child_id not in (1,3)`。这仅适用于上述情况，因为它很简单——所有重复的部分都从锚节点集中开始。它不能解决它们可能不是的一般情况。例如，考虑将边 1->4 和 4->5 添加到上述集合中。边缘 4->5 将被捕获两次，即使使用建议的谓词。:(

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T13:26:16.153

`CTE`'s 是递归的。

当你`CTE`的 's 有多个初始条件时，这意味着它们也有不同的递归堆栈，并且无法在另一个堆栈中使用来自一个堆栈的信息。

在您的示例中，递归堆栈将如下所示：

```
(1) - first IN condition
(1, 2)
(1, 2, 3)
(1, 2, 3, 4)
(1, 2, 3) - no more children
(1, 2) - no more children
(1) - no more children, going to second IN condition

(3) - second condition
(3, 4)
(3) - no more children, returning 
```

如您所见，这些递归堆栈不相交。

您可能可以将访问过的值记录在临时表中，`JOIN`每个值都带有临时表，如果找到，请不要跟随该值，但`SQL Server`不支持这些东西。

所以你只需使用`SELECT DISTINCT`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-03-18T07:27:07.187

这是我使用的方法。它已针对多种方法进行了测试，并且性能最高。它结合了 Quassnoi 建议的临时表思想以及使用 distinct 和 left join 来消除递归的冗余路径。递归的级别也包括在内。

我在代码中留下了失败的 CTE 方法，以便您可以比较结果。

如果有人有更好的主意，我很想知道。

```
create table #bar (unique_id int identity(10,10), parent_id int, child_id int)
insert #bar  (parent_id, child_id)
SELECT 1,2 UNION ALL
SELECT 2,3 UNION ALL
SELECT 3,4 UNION ALL
SELECT 2,5 UNION ALL
SELECT 2,5 UNION ALL
SELECT 5,6

SET NOCOUNT ON

;with foo(unique_id, parent_id,child_id, ord, lvl) as (
    -- anchor member that happens to select first and last edges:
    select unique_id, parent_id, child_id, row_number() over(order by unique_id), 0
    from #bar where parent_id in (1,3)
union all
-- recursive member:
select b.unique_id, b.parent_id, b.child_id, row_number() over(order by b.unique_id), foo.lvl+1
    from #bar b
    join foo on b.parent_id = foo.child_id
)
select unique_id, parent_id,child_id, ord, lvl from foo

/***********************************
    Manual Recursion
***********************************/
Declare @lvl as int
Declare @rows as int
DECLARE @foo as Table(
    unique_id int,
    parent_id int,
    child_id int,
    ord int,
    lvl int)

--Get anchor condition
INSERT @foo (unique_id, parent_id, child_id, ord, lvl)
select unique_id, parent_id, child_id, row_number() over(order by unique_id), 0
    from #bar where parent_id in (1,3)

set @rows=@@ROWCOUNT
set @lvl=0

--Do recursion
WHILE @rows > 0
BEGIN
    set @lvl = @lvl + 1

    INSERT @foo (unique_id, parent_id, child_id, ord, lvl)
    SELECT DISTINCT b.unique_id, b.parent_id, b.child_id, row_number() over(order by b.unique_id), @lvl
    FROM #bar b
     inner join @foo f on b.parent_id = f.child_id
     --might be multiple paths to this recursion so eliminate duplicates
     left join @foo dup on dup.unique_id = b.unique_id
    WHERE f.lvl = @lvl-1 and dup.child_id is null

    set @rows=@@ROWCOUNT 
END

SELECT * from @foo

DROP TABLE #bar 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T13:27:07.620

您是否碰巧知道两条边中的哪一条在树的更深层次上？因为在这种情况下，您可以将 edge`3->4`设为锚成员并开始沿着树向上走，直到找到 edge `1->2`。

像这样的东西：

```
with foo(parent_id, child_id)
as
(
    select parent_id, child_id
    from #bar
    where parent_id = 3

    union all

    select parent_id, child_id
    from #bar b
    inner join foo f on b.child_id = f.parent_id
    where b.parent_id <> 1
)
select *
from foo 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T14:24:31.600

（我不是图表专家，只是探索了一下）

DISTINCT 将保证每一行都是不同的，但它不会消除不会出现在最后一条边的图形路径。拿这张图：

```
insert into #bar (parent_id,child_id) values (1,2)
insert into #bar (parent_id,child_id) values (1,5)
insert into #bar (parent_id,child_id) values (2,3)
insert into #bar (parent_id,child_id) values (2,6)
insert into #bar (parent_id,child_id) values (6,4) 
```

此处查询的结果包括（1,5），它不是从第一条边（1,2）到最后一条边（6,4）的路线的一部分。

您可以尝试这样的方法，仅查找以 (1,2) 开头并以 (6,4) 结尾的路线：

```
with foo(parent_id, child_id, route) as (
    select parent_id, child_id, 
        cast(cast(parent_id as varchar) + 
        cast(child_id as varchar) as varchar(128))
    from #bar
    union all
    select #bar.parent_id, #bar.child_id, 
        cast(route + cast(#bar.child_id as varchar) as varchar(128)) 
    from #bar
    join foo on #bar.parent_id = foo.child_id
)
select * from foo where route like '12%64' 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T14:25:10.413

这是你想做的吗？

```
create table #bar (parent_id int, child_id int)
insert #bar values (1,2)
insert #bar values (2,3)
insert #bar values (3,4)

declare @start_node table (parent_id int)
insert @start_node values (1)
insert @start_node values (3)

;with foo(parent_id,child_id) as (
    select
        parent_id
        ,child_id
    from #bar where parent_id in (select parent_id from @start_node)

    union all

    select
        #bar.*
    from #bar
        join foo on #bar.parent_id = foo.child_id
    where foo.child_id not in (select parent_id from @start_node)
)
select parent_id,child_id from foo 
```

编辑 - @bacar - 我不认为这是 Quasnoi 提出的临时表解决方案。我相信他们建议在每次递归期间基本上复制整个递归成员内容，并将其用作连接以防止重新处理（并且这在 ss2k5 中不受支持）。支持我的方法，对原始方法的唯一更改是在递归成员中的谓词中，以排除在您的起始集中明确存在的递归向下路径。我只添加了 table 变量，以便您在一个位置定义起始 parent_ids，您可以轻松地将此谓词与原始查询一起使用：

```
where foo.child_id not in (1,3) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-11T23:48:36.987

编辑——这根本不起作用。这是一种停止追逐三角形路线的方法。它没有做OP想要的。

或者您可以使用递归标记分隔字符串。

我在家里的笔记本电脑上（没有 sql 服务器），所以这可能不完全正确，但这里......

```
; WITH NodeNetwork AS (
  -- Anchor Definition
  SELECT
     b.[parent_Id] AS [Parent_ID]
     , b.[child_Id] AS [Child_ID]
     , CAST(b.[Parent_Id] AS VARCHAR(MAX)) AS [NodePath]
  FROM
     #bar AS b

  -- Recursive Definition
  UNION ALL SELECT
     b.[Parent_Id]
     , b.[child_Id]
     , CAST(nn.[NodePath] + '-' + CAST(b.[Parent_Id] AS VARCHAR(MAX)) AS VARCHAR(MAX))
  FROM
     NodeNetwork AS nn
     JOIN #bar AS b ON b.[Parent_Id] = nn.[Child_ID]
  WHERE
     nn.[NodePath] NOT LIKE '%[-]' + CAST(b.[Parent_Id] AS VARCHAR(MAX)) + '%'
  )
  SELECT * FROM NodeNetwork 
```

或类似的。抱歉，太晚了，我无法测试它。我会在星期一早上检查。这必须归功于彼得拉尔森（比索）

这个想法是在这里产生的： [http ://www.sqlteam.com/forums/topic.asp?TOPIC_ID=115290](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=115290)

# internet-explorer - IE8 开发者工具无法选择？

> ID：829518
> 
> 赞同：4
> 
> 时间：2009-05-06T13:21:31.780
> 
> 标签：internet-explorer, internet-explorer-8, ie-developer-tools

我已经非常喜欢 IE8 中的 Devloper 工具（按 F12），但由于某种原因，它不再起作用，按 F12 只会打开选择工具，但不会与我打开该工具的页面发生交互，通常蓝色边框围绕着页面上的“选定”元素，但此功能无法正常工作，我有两个同事，一个他有同样的问题，另一个他的开发工具仍然按预期工作。

我想知道这是否发生在其他人身上，他们是否知道可能导致这种情况的原因？- 一个解决方案也很酷；）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-03-04T11:14:27.313

仅供将来参考，有时要通过单击工具
启用 **选择元素，您必须先单击“**
**刷新**”按钮（在调试面板内）。

不知道为什么，但大部分时间都有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T08:15:12.243

所以我的同事开箱即用，开发者工具没有得到适当的关注。右键单击任务栏中的应用程序，选择移动使其获得焦点，应用程序大小缩小到最小，扩展它使开发人员工具按预期工作:)

回答以防有人遇到相同的“问题”:)

# java - 无法在 Java 中对 SSL 站点进行身份验证：“违反了 pathLenConstraint - 此证书必须是证书路径中的最后一个证书”

> ID：829522
> 
> 赞同：7
> 
> 时间：2009-05-06T13:22:50.467
> 
> 标签：java, http, ssl

我正在尝试从 Java 代码中的安全（即 SSL）网页中读取内容。我正在尝试同时使用 URLConnection (java.net) 和 Apache 的 HTTPClient。在这两种情况下，当我提出请求时，我都会收到以下异常：

> . 13 更多原因：java.security.cert.CertPathValidatorException：基本约束检查失败：违反了 pathLenConstraint - 此证书必须是 sun.security.provider.certpath.PKIXMasterCertPathValidator.validate(PKIXMasterCertPathValidator.java:139 处的证书路径中的最后一个证书) 在 sun.security.provider.certpath.PKIXCertPathValidator.doValidate(PKIXCertPathValidator.java:316) 在 sun.security.provider.certpath.PKIXCertPathValidator.engineValidate(PKIXCertPathValidator.java:178) 在 java.security.cert.CertPathValidator.validate( CertPathValidator.java:206) 在 sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:182) ... 还有 18 个 . 13 更多原因：java.security.cert.CertPathValidatorException：基本约束检查失败：违反了 pathLenConstraint - 此证书必须是 sun.security.provider.certpath.PKIXMasterCertPathValidator.validate(PKIXMasterCertPathValidator.java:139 处的证书路径中的最后一个证书) 在 sun.security.provider.certpath.PKIXCertPathValidator.doValidate(PKIXCertPathValidator.java:316) 在 sun.security.provider.certpath.PKIXCertPathValidator.engineValidate(PKIXCertPathValidator.java:178) 在 java.security.cert.CertPathValidator.validate( CertPathValidator.java:206) 在 sun.security.validator.PKIXValidator.doValidate(PKIXValidator.java:182) ... 还有 18 个

请注意，我已经成功地建立了到不同主机的非 SSL 连接。我还可以使用浏览器查看此页面 - 证书在那里得到正确验证。

您是否需要在从服务器检索证书时以某种方式更改证书的顺序？我缺少一些配置吗？

提前致谢，

里奥

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T14:38:51.220

我进一步挖掘，答案在于我需要将必要的证书导入到 JVM 用来验证 SSL 的密钥库中。密钥库是用于运行程序的 jre 中 jre/lib/security 文件夹下的“cacerts”文件。

我手动导出了站点的证书——所有这些。
然后我使用 Sun 提供的“keytool”实用程序将它导入我的默认密钥库。请注意，您必须以正确的顺序导入它们。
然后我把新的密钥库而不是 JRE 的那个——它工作了。

我想将证书直接导入 JRE 的密钥库会更好，但是该工具要求我输入我不知道的密码。

我相信还有一种方法可以更轻松地解决这个问题，只是还没有找到。我很乐意得到一些指示（JSSE 中的 TrustManager 类？）。

最后，一些功劳。这篇文章在这里：http: [//javaishdiscoveries.blogspot.com/2009/02/battle-with-cacerts-and-https.html](http://javaishdiscoveries.blogspot.com/2009/02/battle-with-cacerts-and-https.html)帮助我指出了正确的方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-26T22:33:26.223

javax.net.ssl.SSLHandshakeException：sun.security.validator.ValidatorException：PKIX 路径验证失败：java.security.cert.CertPathValidatorException：基本约束检查失败：违反了 pathLenConstraint - 此证书必须是证书路径中的最后一个证书

**pathLenConstraint**

请参阅（关于证书链的说明）

[http://groups.google.com/group/google-checkout-developers-forum/web/google-checkout-and-ssl-certificates?version=49](http://groups.google.com/group/google-checkout-developers-forum/web/google-checkout-and-ssl-certificates?version=49)

谷歌说证书链顺序可能有问题，我刚刚发现我的证书不正常，尚未修复，正在处理中。我稍后会更新这个。

* * *

旧帖：

有几乎相同的问题。

手动将证书添加到密钥库会有所帮助，但我更愿意与我的客户一起自动完成。

所以我的解决方案：

我将只为这个应用程序和一个主机使用密钥库 1\. 密钥库不存在 - 使用一些生成的密码创建 2\. 在配置文件中保存密码 3\. 询问用户（或不）他是否想接受这个证书 4\. 如果所以 - 将其保存到密钥库，并在需要时使用它

这是一个好的解决方案吗？任何意见？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-25T09:12:25.093

问题出在证书链顺序上。它是：A->C->B，但应该是 A->B->C，一旦我们固定了链顺序，应用程序就开始工作了。

* * *

我还没有亲自修复证书。但这篇文章很有帮助

[http://groups.google.com/group/google-checkout-api-troubleshooting/browse_thread/thread/99862c11d37d3127](http://groups.google.com/group/google-checkout-api-troubleshooting/browse_thread/thread/99862c11d37d3127)

# apache-flex - MXML 中的强制属性？

> ID：829532
> 
> 赞同：1
> 
> 时间：2009-05-06T13:24:24.583
> 
> 标签：apache-flex, compiler-construction, mxml

是否有可能通过某种元数据来强制设置对象的属性？我们有许多非可视组件，除非设置了一个或多个属性，否则它们根本不做任何事情，例如：

```
<ToolTip target="{this}">
    <mx:Image source="foo.png" />
</ToolTip> 
```

在这种情况下，目标属性最好根据需要标记，因为从不设置它是没有意义的。这不是一个大问题，因为它很容易记录，但最好通过让编译器告诉开发人员他的错误来消除至少一些调试往返。

我们不希望这个标签以任何方式冗余，这可以通过简单地将 ToolTip 组件设置为 UIComponent 并使用 parent 属性来解决（在这种情况下）。但一方面，这增加了不必要的开销，在其他情况下，这根本不合适：

```
<Button id="btn" label="Foo" />
<ToolTip target="{btn}">
    <mx:Image source="foo.png" />
</ToolTip> 
```

那么，强制 mxml 属性是否可能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T17:41:54.497

有一个解决方案，但它不像使用元数据那么简单。只需让您的非可视组件实现 IMXMLObject 接口即可。该接口只有一种方法，“初始化”。实现该接口允许您检查通过 MXML 初始化的对象。

因此...

```
public function initialized(document:Object, id:String):void
{
  if ( target == null ) throw new Error( "You must supply an argument to target!" );
} 
```

有编译时检查会很好，但这很好用。

# c# - 测试字符串中的重复字符

> ID：829537
> 
> 赞同：8
> 
> 时间：2009-05-06T13:24:53.177
> 
> 标签：c#, algorithm, string

我正在使用字符串做一些工作，并且我有一个场景，我需要确定一个字符串（通常是一个小于 10 个字符的小字符串）是否包含重复的字符。

```
`ABCDE`  // does not contain repeats 
`AABCD`  // does contain repeats, ie A is repeated 
```

我可以遍历 string.ToCharArray() 并针对 char[] 中的每个其他字符测试每个字符，但我觉得我错过了一些明显的东西......也许我只需要咖啡。任何人都可以帮忙吗？

**编辑：**

字符串将被排序，所以顺序并不重要，所以 ABCDA => AABCD

重复的频率也很重要，所以我需要知道重复是成对还是三重等。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-06T13:27:58.303

如果字符串已排序，您只需依次记住每个字符并检查以确保下一个字符永远不会与最后一个字符相同。

除此之外，对于十个字符以下的字符串，仅针对所有其余字符测试每个字符可能与大多数其他事情一样快或更快。正如另一位评论者所建议的，位向量可能会更快（如果您有一小部分合法字符，则会有所帮助。）

奖励：这是一个巧妙的 LINQ 解决方案来实现 Jon 的功能：

```
int longestRun =
    s.Select((c, i) => s.Substring(i).TakeWhile(x => x == c).Count()).Max(); 
```

所以，好吧，它不是很快！你对此有看法？！

:-)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-06T13:27:28.820

如果字符串很短，那么循环和测试可能是最简单和最有效的方法。我的意思是您*可以*创建一个哈希集（在您使用的任何平台上）并遍历字符，如果字符已经在集合中则失败，否则将其添加到集合中 - 但这只有在字符串更长。

编辑：现在我们知道它已排序，[mquander 的答案](https://stackoverflow.com/questions/829537/testing-for-repeated-characters-in-a-string/829552#829552)是 IMO 中最好的一个。这是一个实现：

```
public static bool IsSortedNoRepeats(string text)
{
    if (text.Length == 0)
    {
        return true;
    }
    char current = text[0];
    for (int i=1; i < text.Length; i++)
    {
        char next = text[i];
        if (next <= current)
        {
            return false;
        }
        current = next;
    }
    return true;
} 
```

如果您不介意重复使用索引器，则可以使用较短的替代方法：

```
public static bool IsSortedNoRepeats(string text)
{
    for (int i=1; i < text.Length; i++)
    {
        if (text[i] <= text[i-1])
        {
            return false;
        }
    }
    return true;
} 
```

编辑：好的，在“频率”方面，我会稍微扭转一下问题。我仍然会假设字符串是排序的，所以我们想知道最长运行的长度。当没有重复时，最长的运行长度将为 0（对于空字符串）或 1（对于非空字符串）。否则，它将是2个或更多。

首先是特定于字符串的版本：

```
public static int LongestRun(string text)
{
    if (text.Length == 0)
    {
        return 0;
    }
    char current = text[0];
    int currentRun = 1;
    int bestRun = 0;

    for (int i=1; i < text.Length; i++)
    {
        if (current != text[i])
        {
            bestRun = Math.Max(currentRun, bestRun);
            currentRun = 0;
            current = text[i];
        }
        currentRun++;
    }
    // It's possible that the final run is the best one
    return Math.Max(currentRun, bestRun);
} 
```

现在我们也可以将其作为通用扩展方法来执行`IEnumerable<T>`：

```
public static int LongestRun(this IEnumerable<T> source)
{
    bool first = true;
    T current = default(T);
    int currentRun = 0;
    int bestRun = 0;

    foreach (T element in source)
    {
        if (first || !EqualityComparer<T>.Default(element, current))
        {
            first = false;
            bestRun = Math.Max(currentRun, bestRun);
            currentRun = 0;
            current = element;
        }
    }
    // It's possible that the final run is the best one
    return Math.Max(currentRun, bestRun);
} 
```

然后你可以打电话`"AABCD".LongestRun()`给例如。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-06T13:51:36.623

*如果*字符串包含重复项，这将很快告诉您：

```
bool containsDups = "ABCDEA".Length != s.Distinct().Count(); 
```

它只是根据原始长度检查不同字符的数量。如果它们不同，则您有重复...

**编辑：**我想这并没有考虑到你在编辑中提到的重复频率......但是这里的一些其他建议已经解决了这个问题，所以我不会发布代码，因为我注意到其中的一些已经给你一个相当优雅的解决方案。我特别喜欢 Joe 使用 LINQ 扩展的实现。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-06T13:44:26.750

由于您使用的是 3.5，因此您可以在一个 LINQ 查询中执行此操作：

```
var results = stringInput
  .ToCharArray() // not actually needed, I've left it here to show what's actually happening
  .GroupBy(c=>c)
  .Where(g=>g.Count()>1)
  .Select(g=>new {Letter=g.First(),Count=g.Count()})
; 
```

对于在输入中多次出现的每个字符，这将为您提供字符和出现次数。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-06T13:37:15.143

我认为实现这一目标的最简单方法是使用这个简单的正则表达式

```
bool foundMatch = false;
foundMatch = Regex.IsMatch(yourString, @"(\w)\1"); 
```

如果您需要有关比赛的更多信息（开始、长度等）

```
 Match match = null;
    string testString = "ABCDE AABCD";
    match = Regex.Match(testString, @"(\w)\1+?");
    if (match.Success)
    {
        string matchText = match.Value; // AA
        int matchIndnex = match.Index;  // 6
        int matchLength = match.Length; // 2
    } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-06T13:27:43.890

**现在更新**，您需要一组计数器来维护计数。

保留一个位数组，其中一位代表一个唯一字符。遇到字符时打开该位，并在字符串上运行一次。位数组索引和字符集的映射由您决定。如果您看到某个特定位已经打开，请中断。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-06T13:38:17.967

```
/(.).*\1/ 
```

（或您的正则表达式库语法中的任何等效项）

不是最有效的，因为它可能会回溯到字符串中的每个字符，然后再次向前扫描。而且我通常不提倡正则表达式。但如果你想要简洁...

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-06T13:52:56.277

怎么样：

```
string strString = "AA BRA KA DABRA";

var grp = from c in strString.ToCharArray() 
        group c by c into m
        select new { Key = m.Key, Count = m.Count() };

foreach (var item in grp)
{
    Console.WriteLine(
        string.Format("Character:{0} Appears {1} times", 
        item.Key.ToString(), item.Count));
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-03-22T14:08:36.597

我开始在网上寻找一些信息，我得到了以下解决方案。

```
string input = "aaaaabbcbbbcccddefgg";
        char[] chars = input.ToCharArray();
        Dictionary<char, int> dictionary = new Dictionary<char,int>();

        foreach (char c in chars)
        {
            if (!dictionary.ContainsKey(c))
            {
                dictionary[c] = 1; //
            }
            else
            {
                dictionary[c]++;
            }
        }

        foreach (KeyValuePair<char, int> combo in dictionary)
        {
            if (combo.Value > 1) //If the vale of the key is greater than 1 it means the letter is repeated
            {
                Console.WriteLine("Letter " + combo.Key + " " + "is repeated " + combo.Value.ToString() + " times");
            }

        } 
```

我希望它有所帮助，我有一次面试，面试官要求我解决这个问题，我知道这是一个常见问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T14:08:41.420

当没有订单可以处理时，您可以使用字典来保持计数：

```
String input = "AABCD";
var result = new Dictionary<Char, int>(26);
var chars = input.ToCharArray();
foreach (var c in chars)
{
    if (!result.ContainsKey(c))
    {
        result[c] = 0; // initialize the counter in the result
    }
    result[c]++;
}

foreach (var charCombo in result)
{
    Console.WriteLine("{0}: {1}",charCombo.Key, charCombo.Value);   
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-06T17:03:58.923

Jon 描述的哈希解决方案可能是最好的。您可以使用 HybridDictionary，因为它适用于小型和大型数据集。其中字母是键，值是频率。（每次添加失败或 HybridDictionary 为 .Contains(key) 返回 true 时更新频率）

# language-agnostic - 多文化网站

> ID：829540
> 
> 赞同：1
> 
> 时间：2009-05-06T13:26:02.473
> 
> 标签：language-agnostic

如何使用泰米尔语字体而不是英文创建网站？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T13:39:31.863

您应该能够通过创建一个使用 UTF-8 作为编码的站点来使用泰米尔语。这是一个解释如何的网站：

[http://tlt.its.psu.edu/suggestions/international/bylanguage/tamilchart.html](http://tlt.its.psu.edu/suggestions/international/bylanguage/tamilchart.html)

# jquery - 使用 AJAX 加载 ASP.NET MVC 部分视图的正确方法？

> ID：829541
> 
> 赞同：1
> 
> 时间：2009-05-06T13:26:06.467
> 
> 标签：jquery, asp.net-mvc, ajax

大家好。好的，情况就是这样。我希望能够将一系列类似的部分视图加载到父页面上；[与本文](http://www.singingeels.com/Articles/AJAX_Panels_with_ASPNET_MVC.aspx)中所做的方式非常相似（模拟 AJAX 面板）。

在文章中，它似乎工作正常，因为它在控制器上异步调用相应的操作方法。但他使用的方法充其量看起来像是一个黑客，而且看起来不是很优雅。正在发生的事情的简要概述是：

这将是一个异步加载的独立小部件。

```
<% using (Ajax.Form("ReportOne", null,
      new AjaxOptions { UpdateTargetId = "resultOne" },
      new { id="reportFormOne" })) { } %>

<script type="text/javascript">
   $get("reportFormOne").onsubmit();
</script> 
```

相应的输出将采用以下形式：

```
<form action="/Home/ReportOne/reportFormOne" onsubmit="Sys.Mvc.AsyncForm.handleSubmit(this, { insertionMode: 0, updateTargetId: 'resultDiv' }); return false;">

   <!-- Your form elements here... -->

</form> 
```

就像我上面所说的那样，这似乎不是实现这一目标的真正优雅的方式，但我一直在尝试寻找替代方案（使用 jQuery 或其他方式），但没有成功。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T13:35:56.193

jQuery解决方案：页面加载完成后从action中加载html。

```
<script type='text/javascript'>
$(function() {
    $.load('<%= Url.Action( "ReportOne", "Home", new { id = "reportFormOne" } ) %>', null, function(response,status,xhr) {
        $('#partialView').html(reponse);
    });
});
</script>

...

<div id='partialView'>
</div> 
```

# sql - 如何减小我的 sql server 日志文件的大小？

> ID：829542
> 
> 赞同：43
> 
> 时间：2009-05-06T13:26:09.477
> 
> 标签：sql, sql-server

所以我一直忽略对我的fogbugz 数据库进行任何备份，现在fogbugz ldf 文件已超过2 次半。这是我们在使用fogbugz 的六个月中积累起来的。

我备份了数据库，然后备份并截断了事务日志，但事务日志仍然是 2 个半演出。我对日志文件进行了缩小，它仍然是 2 个半演出。我所做的一切似乎都不会缩小文件的大小。

有没有办法解决这个问题？还是此时分离数据库，删除日志文件然后重新附加新文件的唯一方法？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2015-01-09T03:33:10.797

*   执行数据库的完整备份。不要跳过这个。真的。
*   将数据库的备份方法更改为“简单”
*   打开查询窗口并输入“检查点”并执行
*   执行数据库的另一个备份
*   将数据库的备份方法更改回“完整”（或其他任何内容，如果还不是简单的话）
*   执行数据库的最终完整备份。
*   一个一个地运行下面的查询
    1.  `USE Database_Name`
    2.  `select name,recovery_model_desc from sys.databases`
    3.  `ALTER DATABASE Database_Name SET RECOVERY simple`
    4.  `DBCC SHRINKFILE (Database_Name_log , 1)`

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-05-06T13:32:40.290

欢迎来到多变的 SQL Server 日志管理世界。

有些东西是错的，尽管我认为没有一些额外的信息，没有人能告诉你更多。例如，该数据库是否曾用于事务 SQL Server 复制？如果事务尚未复制到订阅者，这可能会导致此类问题。

在此期间，这至少应该允许您终止日志文件：

1.  执行数据库的完整备份。不要跳过这个。真的。
2.  将数据库的备份方法更改为“简单”
3.  打开查询窗口并输入“检查点”并执行
4.  执行数据库的另一个备份
5.  将数据库的备份方法更改回“完整”（或其他任何内容，如果还不是简单的话）
6.  执行数据库的最终完整备份。

您现在应该能够缩小文件（如果执行备份没有为您做到这一点）。

祝你好运！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-06T13:30:37.673

1.  确保数据库的备份模式设置为简单（有关不同模式的概述，请参见[此处）。](http://msdn.microsoft.com/en-gb/library/ms189275.aspx)这将避免 SQL Server 在重用空间之前等待事务日志备份。

2.  使用[`dbcc shrinkfile`](http://msdn.microsoft.com/en-gb/library/ms189493.aspx)或[Management Studio](http://msdn.microsoft.com/en-gb/library/ms190757.aspx)缩小日志文件。

在设置备份模式之前，步骤#2 不会执行任何操作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-06T13:56:11.200

您必须多次收缩和备份日志以使日志文件减小大小，这是因为日志文件页面无法像数据文件页面那样重新组织，只能被截断。有关更详细的解释[，请查看此内容。](https://www.sqlskills.com/blogs/paul/why-is-log_reuse_wait_desc-saying-log_backup-after-doing-a-log-backup/)

警告：**分离数据库并删除日志文件是危险的！除非您想丢失数据，否则不要这样做**

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-10-08T15:49:03.587

这是使用查询完成的最佳建议之一。适合像我一样拥有大量数据库的人。可以使用脚本运行它。

[https://medium.com/@bharatdwarkani/shrinking-sql-server-db-log-file-size-sql-server-db-maintenance-7ddb0c331668](https://medium.com/@bharatdwarkani/shrinking-sql-server-db-log-file-size-sql-server-db-maintenance-7ddb0c331668)

```
USE DatabaseName;
GO
-- Truncate the log by changing the database recovery model to SIMPLE.
ALTER DATABASE DatabaseName
SET RECOVERY SIMPLE;
GO
-- Shrink the truncated log file to 1 MB.
DBCC SHRINKFILE (DatabaseName_Log, 1);
GO
-- Reset the database recovery model.
ALTER DATABASE DatabaseName
SET RECOVERY FULL;
GO 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-07-28T08:31:38.983

我遇到了同样的问题，我的数据库日志文件大小约为 39 GB，在缩小（数据库和文件）之后，它减少到 37 GB，这还不够，所以我做了这个解决方案：（我不需要 ldf 文件（日志文件）不再）

（**重要）：在此过程之前获取数据库的完整备份。

1.  在该数据库上运行“检查点”。

2.  分离该数据库（右键单击数据库并选择任务>>分离...）{如果您看到错误，请执行本文末尾的步骤}

3.  将 MyDatabase.ldf 移动到另一个文件夹，您可以在与数据库相同的文件夹中的硬盘中找到它（以防万一您将来出于某种原因需要它，例如用户执行了某些任务）。

4.  附加数据库（右键单击数据库并选择附加...）

5.  在附加对话框中删除 .ldf 文件（显示“找不到文件”注释）并单击“确定”。（不用担心 ldf 文件会在附件过程之后创建。）

6.  之后，将创建一个大小为 504 KB 的新日志文件！！！。

在第 2 步中，如果您遇到数据库被其他用户使用的错误，您可以：

1.在主数据库“sp_who2”上运行此命令，查看使用您的数据库的进程。

2.读取进程号，例如它是52并输入“kill 52”，现在你的数据库是空闲的，可以分离了。

如果使用数据库的进程数过多：

1.打开服务（在windows start中输入services）找到SQL Server ...进程并重置它（右键选择reset）。

2.  立即单击分离对话框中的确定按钮（之前显示分离错误）。

# .net - 为什么我的 .net Int64 的行为就像 Int32 一样？

> ID：829555
> 
> 赞同：7
> 
> 时间：2009-05-06T13:28:38.630
> 
> 标签：.net, 64-bit, math, integer-overflow, int64

我在 .net 程序中目睹了一种奇怪的行为：

```
Console.WriteLine(Int64.MaxValue.ToString());
// displays 9223372036854775807, which is 2^63-1, as expected

Int64 a = 256*256*256*127; // ok

Int64 a = 256*256*256*128; // compile time error : 
//"The operation overflows at compile time in checked mode"
// If i do this at runtime, I get some negative values, so the overflow indeed happens. 
```

为什么我的 Int64 的行为就好像它们是 Int32 的一样，尽管 Int64.MaxValue 似乎确认它们使用的是 64 位？

如果相关，我使用的是 32 位操作系统，并且目标平台设置为“任何 CPU”

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-06T13:30:51.917

您的 RHS 仅使用`Int32`值，因此整个操作使用`Int32`算术执行，然后将`Int32` *结果*提升为 long。

将其更改为：

```
Int64 a = 256*256*256*128L; 
```

一切都会好起来的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T13:33:35.700

采用：

```
Int64 a = 256L*256L*256L*128L; 
```

L 后缀表示 Int64 字面量，无后缀表示 Int32。

你写的：

```
Int64 a = 256*256*256*128 
```

方法：

```
Int64 a = (Int32)256*(Int32)256*(Int32)256*(Int32)128; 
```

# tsql - 返回刚刚添加的行的id

> ID：829567
> 
> 赞同：2
> 
> 时间：2009-05-06T13:31:37.123
> 
> 标签：tsql, sql-server-2000

[与我之前](https://stackoverflow.com/questions/756240)的问题类似，我再次向 SO 人寻求你们的集体智慧和帮助。

在存储过程中并通过一些检查后，我需要插入一个新行并为其返回新创建的 id。检查是否存在一行是有效的，所以它是我未决定的那一点之后。

该表有两个重要的列：LocationID 和 CaseID。CaseID 是自动递增的，因此当您添加插入新的 l​​ocationid 时，它会自动增加。

我目前有这个：

```
-- previous checks for existance of CaseID

IF @CaseID IS NULL
BEGIN
    INSERT INTO
        Cases(LocationID)
    VALUES
        (@LocationID)

    -- what now?
END 
```

我想在`@CaseID = (SELECT blah)`之后立即发表声明，但我想知道是否有更好的方法？

有没有更好的办法？你会怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T13:33:03.500

```
SELECT @CaseID = SCOPE_IDENTITY() 
```

实际上，您可以这样做（如果这是存储过程的结尾。）：

```
SELECT SCOPE_IDENTITY() 
```

（OUTPUT 子句仅在 SQL Server 2005 及以后版本中可用...）

参考：[SCOPE_IDENTITY](http://msdn.microsoft.com/en-us/library/aa259185.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T13:33:14.267

scope_identity()

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T13:35:40.280

选择范围标识（）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:40:49.833

正如其他人所提到的，SCOPE_IDENTITY() 是可行的方法，尽管一些 ORM 工具也提供此功能。

您唯一需要记住的是 SCOPE_IDENTITY() 将仅返回当前会话期间生成的最后一个身份密钥值。这对于过滤掉其他客户端可能同时创建的新密钥很有用。SELECT @@IDENTITY 将返回任何客户端/会话生成的最后一个密钥。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T13:34:07.070

您需要使用 OUTPUT 子句

[http://blog.jemm.net/articles/databases/how-to-using-sql-server-2005s-output-to-return-generated-identity/](http://blog.jemm.net/articles/databases/how-to-using-sql-server-2005s-output-to-return-generated-identity/)

...正如所指出的，仅在 sqlserver 2005 中可用。请忽略。

# c# - 如何知道流阅读器在文本文件中的位置（行号）？

> ID：829568
> 
> 赞同：10
> 
> 时间：2009-05-06T13:31:45.703
> 
> 标签：c#, streamreader

一个例子（这可能不是现实生活，但要说明我的观点）：

```
public void StreamInfo(StreamReader p)
{
    string info = string.Format(
        "The supplied streamreaer read : {0}\n at line {1}",
        p.ReadLine(),
        p.GetLinePosition()-1);               

} 
```

`GetLinePosition`这是streamreader的一个假想扩展方法。这可能吗？

当然，我可以自己数数，但这不是问题。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2014-04-09T23:10:09.767

我在寻找类似问题的解决方案时遇到了这篇文章，我需要在特定行中寻找 StreamReader。我最终创建了两个扩展方法来获取和设置 StreamReader 上的位置。它实际上并没有提供行号计数，但在实践中，我只是抓住每个之前的位置`ReadLine()`，如果该行感兴趣，那么我保留起始位置以便稍后设置以返回该行，如下所示：

```
var index = streamReader.GetPosition();
var line1 = streamReader.ReadLine();

streamReader.SetPosition(index);
var line2 = streamReader.ReadLine();

Assert.AreEqual(line1, line2); 
```

和重要的部分：

```
public static class StreamReaderExtensions
{
    readonly static FieldInfo charPosField = typeof(StreamReader).GetField("charPos", BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.DeclaredOnly);
    readonly static FieldInfo byteLenField = typeof(StreamReader).GetField("byteLen", BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.DeclaredOnly);
    readonly static FieldInfo charBufferField = typeof(StreamReader).GetField("charBuffer", BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.DeclaredOnly);

    public static long GetPosition(this StreamReader reader)
    {
        // shift position back from BaseStream.Position by the number of bytes read
        // into internal buffer.
        int byteLen = (int)byteLenField.GetValue(reader);
        var position = reader.BaseStream.Position - byteLen;

        // if we have consumed chars from the buffer we need to calculate how many
        // bytes they represent in the current encoding and add that to the position.
        int charPos = (int)charPosField.GetValue(reader);
        if (charPos > 0)
        {
            var charBuffer = (char[])charBufferField.GetValue(reader);
            var encoding = reader.CurrentEncoding;
            var bytesConsumed = encoding.GetBytes(charBuffer, 0, charPos).Length;
            position += bytesConsumed;
        }

        return position;
    }

    public static void SetPosition(this StreamReader reader, long position)
    {
        reader.DiscardBufferedData();
        reader.BaseStream.Seek(position, SeekOrigin.Begin);
    }
} 
```

这对我来说效果很好，并且取决于您对使用反射的容忍度它认为这是一个相当简单的解决方案。

注意事项：

1.  虽然我使用各种 Systems.Text.Encoding 选项进行了一些简单的测试，但我使用的几乎所有数据都是简单的文本文件`(ASCII)`。
2.  我只使用过该`StreamReader.ReadLine()`方法，虽然对 StreamReader 源的简要回顾似乎表明在使用其他读取方法时这仍然有效，但我还没有真正测试过这种情况。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-06T13:36:34.240

不，真的不可能。“行号”的概念是基于已经读取的实际数据，而不仅仅是位置。例如，如果您要将读取器 Seek() 到任意位置，它实际上不会读取该数据，因此它无法确定行号。

做到这一点的唯一方法是自己跟踪它。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-16T07:18:53.233

为任何 TextReader 提供行计数包装器非常容易：

```
public class PositioningReader : TextReader {
    private TextReader _inner;
    public PositioningReader(TextReader inner) {
        _inner = inner;
    }
    public override void Close() {
        _inner.Close();
    }
    public override int Peek() {
        return _inner.Peek();
    }
    public override int Read() {
        var c = _inner.Read();
        if (c >= 0)
            AdvancePosition((Char)c);
        return c;
    }

    private int _linePos = 0;
    public int LinePos { get { return _linePos; } }

    private int _charPos = 0;
    public int CharPos { get { return _charPos; } }

    private int _matched = 0;
    private void AdvancePosition(Char c) {
        if (Environment.NewLine[_matched] == c) {
            _matched++;
            if (_matched == Environment.NewLine.Length) {
                _linePos++;
                _charPos = 0;
                _matched = 0;
            }
        }
        else {
            _matched = 0;
            _charPos++;
        }
    }
} 
```

缺点（为简洁起见）：

1.  不检查构造函数参数是否为 null
2.  不识别终止行的替代方法。读取由原始 \r 或 \n 分隔的文件时，将与 ReadLine() 行为不一致。
3.  不覆盖“块”级方法，如 Read(char[], int, int)、ReadBlock、ReadLine、ReadToEnd。TextReader 实现工作正常，因为它将其他所有内容路由到 Read(); 但是，可以通过以下方式获得更好的性能
    *   通过将调用路由到 _inner 来覆盖这些方法。而不是基地。
    *   将读取的字符传递给 AdvancePosition。请参阅示例 ReadBlock 实现：

* * *

```
public override int ReadBlock(char[] buffer, int index, int count) {
    var readCount = _inner.ReadBlock(buffer, index, count);    
    for (int i = 0; i < readCount; i++)
        AdvancePosition(buffer[index + i]);
    return readCount;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-06T13:37:57.547

不。

考虑使用底层流对象（可以在任何行的任何点）寻找任何位置是可能的。现在考虑一下这会对 StreamReader 保存的任何计数产生什么影响。

StreamReader 是否应该去找出它现在在哪一行？无论文件中的位置如何，它是否应该只读取多行？

恕我直言，除了这些之外，还有更多的问题会使这成为实施的噩梦。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-10-06T07:59:35.970

这是一个使用 ReadLine() 方法实现 StreamReader 的人，该方法注册文件位置。

[http://www.daniweb.com/forums/thread35078.html](http://www.daniweb.com/forums/thread35078.html)

我想应该从 StreamReader 继承，然后将额外的方法与一些属性（_lineLength + _bytesRead）一起添加到特殊类中：

```
 // Reads a line. A line is defined as a sequence of characters followed by
 // a carriage return ('\r'), a line feed ('\n'), or a carriage return
 // immediately followed by a line feed. The resulting string does not
 // contain the terminating carriage return and/or line feed. The returned
 // value is null if the end of the input stream has been reached.
 //
 /// <include file='doc\myStreamReader.uex' path='docs/doc[@for="myStreamReader.ReadLine"]/*' />
 public override String ReadLine()
 {
          _lineLength = 0;
          //if (stream == null)
          //       __Error.ReaderClosed();
          if (charPos == charLen)
          {
                   if (ReadBuffer() == 0) return null;
          }
          StringBuilder sb = null;
          do
          {
                   int i = charPos;
                   do
                   {
                           char ch = charBuffer[i];
                           int EolChars = 0;
                           if (ch == '\r' || ch == '\n')
                           {
                                    EolChars = 1;
                                    String s;
                                    if (sb != null)
                                    {
                                             sb.Append(charBuffer, charPos, i - charPos);
                                             s = sb.ToString();
                                    }
                                    else
                                    {
                                             s = new String(charBuffer, charPos, i - charPos);
                                    }
                                    charPos = i + 1;
                                    if (ch == '\r' && (charPos < charLen || ReadBuffer() > 0))
                                    {
                                             if (charBuffer[charPos] == '\n')
                                             {
                                                      charPos++;
                                                      EolChars = 2;
                                             }
                                    }
                                    _lineLength = s.Length + EolChars;
                                    _bytesRead = _bytesRead + _lineLength;
                                    return s;
                           }
                           i++;
                   } while (i < charLen);
                   i = charLen - charPos;
                   if (sb == null) sb = new StringBuilder(i + 80);
                   sb.Append(charBuffer, charPos, i);
          } while (ReadBuffer() > 0);
          string ss = sb.ToString();
          _lineLength = ss.Length;
          _bytesRead = _bytesRead + _lineLength;
          return ss;
 } 
```

认为代码中有一个小错误，因为字符串的长度用于计算文件位置，而不是使用读取的实际字节（缺乏对 UTF8 和 UTF16 编码文件的支持）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-02-18T23:00:24.570

我来这里是为了寻找简单的东西。如果您只是使用 ReadLine() 并且不关心使用 Seek() 或任何东西，只需创建一个 StreamReader 的简单子类

```
class CountingReader : StreamReader {
    private int _lineNumber = 0;
    public int LineNumber { get { return _lineNumber; } }

    public CountingReader(Stream stream) : base(stream) { }

    public override string ReadLine() {
        _lineNumber++;
        return base.ReadLine();
    }
} 
```

然后你让它成为正常的方式，比如从一个名为 file 的 FileInfo 对象

```
CountingReader reader = new CountingReader(file.OpenRead()) 
```

而您只需阅读该`reader.LineNumber`属性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-23T13:04:18.250

已经针对 BaseStream 提出的观点是有效且重要的。但是，在某些情况下，您想阅读文本并知道您在文本中的位置。将其编写为一个类以使其易于重用仍然很有用。

我现在试着写这样一个类。它似乎工作正常，但速度相当慢。当性能不重要时应该没问题（它不是*那么*慢，见下文）。

无论您是一次读取一个字符、一次读取一个缓冲区还是一次读取一行，我都使用相同的逻辑来跟踪文本中的位置。虽然我确信通过放弃它可以使其执行得更好，但它更容易实现......并且我希望遵循代码。

我对StreamReader的ReadLine方法（我相信这是这个实现的最薄弱点）做了一个非常基础的性能比较，差异几乎是一个数量级。我使用我的 StreamReaderEx 类获得了 22 MB/s，但直接使用 StreamReader 的速度几乎是 9 倍（在我配备 SSD 的笔记本电脑上）。虽然这可能很有趣，但我不知道如何进行正确的阅读测试；也许使用 2 个相同的文件，每个文件都大于磁盘缓冲区，并交替读取它们..？至少我的简单测试在我多次运行时会产生一致的结果，无论哪个类首先读取测试文件。

NewLine 符号默认为 Environment.NewLine 但可以设置为长度为 1 或 2 的任何字符串。读者仅将此符号视为换行符，这可能是一个缺点。至少我知道 Visual Studio 已经多次提示我打开的文件“有不一致的换行符”。

请注意，我没有包括 Guard 类；这是一个简单的实用程序类，从上下文中应该知道如何替换它。您甚至可以删除它，但您会丢失一些参数检查，因此生成的代码将远离“正确”。例如，Guard.NotNull(s, "s") 只是检查 s 是否为空，如果是这种情况，则抛出 ArgumentNullException（参数名称为“s”，因此是第二个参数）。

废话不多说，代码如下：

```
公共类 StreamReaderEx : StreamReader
{
    // 换行符（魔法值 -1：“未使用”）。
    诠释新线1，新线2；

    // 读取的最后一个字符是 NewLine 符号的第一个字符，并且我们使用的是两个字符的符号。
    bool insideNewLine;

    // StringBuilder 用于 ReadLine 实现。
    StringBuilder lineBuilder = new StringBuilder();

    public StreamReaderEx(string path, string newLine = "\r\n") : base(path)
    {
        初始化（新线）；
    }

    public StreamReaderEx(Stream s, string newLine = "\r\n") : base(s)
    {
        初始化（新线）；
    }

    公共字符串换行符
    {
        得到 { 返回 "" + (char)newLine1 + (char)newLine2; }
        私人集
        {
            Guard.NotNull(value, "value");
            Guard.Range(value.Length, 1, 2, "仅支持 1 到 2 个字符的换行符。");

            newLine1 = 值[0];
            newLine2 = (value.Length == 2 ? value[1] : -1);
        }
    }

    公共 int LineNumber { 获取；私人套装；}
    公共 int LinePosition { 获取；私人套装；}

    公共覆盖 int Read()
    {
        int next = base.Read();
        trackTextPosition(下一个);
        下一个返回；
    }

    public override int Read(char[] buffer, int index, int count)
    {
        int n = base.Read（缓冲区，索引，计数）；
        对于 (int i = 0; 我

```

# reporting-services - SSRS：如何计算仅包含组中最后一项的总和

> ID：829569
> 
> 赞同：2
> 
> 时间：2009-05-06T13:31:48.077
> 
> 标签：reporting-services, grouping, aggregate-functions

我有一个 rdlc 报告文件，我正在尝试计算只能包含每个组中的最后一项的总和。我有一张这样的桌子：

```
Place                 = ?                              (Group header 1)
    User              = ?                              (Group header 2)
        Date          =Last(Fields!Number.Value)       (Group header 3)
            Number    =Fields!Number.Value             (Detail row) 
```

所以，换句话说，在`User`那里，我想要一笔`Date`……如果这有意义的话……

每`Number`行包含许多数字`Date`。但`Date`只显示当天的最后一个数字，因为其余的不计算在内（但必须显示）在`User`我想总结该用户所有日期的最后一个数字。与相同`Place`（这将是每个用户每天最后一个数字的总和）。

谁能帮我解决这个问题？我尝试了明显的（至少对我而言）`=Sum(Last(Fields!Number.Value))`，但是（也尝试在这些函数中指定组，但没有产生任何影响，因为）当我尝试编译时出现错误，它说：

> 文本框“numberTextbox”的值表达式在另一个聚合函数（或 RunningValue）的参数中包含聚合函数（或 RunningValue 或 RowNumber 函数）。聚合函数不能嵌套在其他聚合函数中。

我想这有点道理......但是我该怎么做呢？

* * *

**更新：**我通过添加另一列并将最后的数字复制到该列中解决了这个问题。这样我可以显示所有的数字，并对只包含那些将在总和中的列进行求和。我仍然很好奇是否有人可以解决我原来的问题......所以如果你有，请发布答案！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T13:42:28.127

不确定我是否完全理解您要执行的操作。可能类似于 =Last(Fields!Number.Value,"Group 1") + Last(Fields!Number.Value,"Group 2") + Last(Fields!Number.Value,"Group 3")，而不是使用总和功能？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T13:58:41.380

最简单的方法是修改您的数据集，使其仅包含您在日期字段中显示的记录，这样您就可以使用简单的 sum() 而不是尝试做一些奇怪而棘手的事情，并且可能无法正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-20T21:53:11.600

修改数据集可能确实是最简单的解决方案，但如果您真的想在不使查询复杂化的情况下这样做，您可以尝试“自定义聚合”。

确切的技术取决于 SSRS 的版本，我的理解是，在 SSRS 2008 之前它并没有那么好用。

这个想法是，您编写一些自定义代码来维护一个包含每个日期的最后一个值的数组。一个函数更新日期的“最后一个值”，另一个函数对数组中的值求和。您的标头调用后一个函数；您合谋导致在处理标题之前为每个详细信息行调用一次前一个函数。

[这是一个博客](http://blogs.msdn.com/b/robertbruckner/archive/2008/07/20/using-group-variables-in-reporting-services-2008-for-custom-aggregation.aspx)，其中包含解释 SSRS 2008 中的技术的文章。

它还提供了一些关于如何尝试在 SRSS 2005 中进行这项工作的见解，但显然这并不可靠。

# javascript - 通过 JavaScript 清除 HTML 文件上传字段

> ID：829571
> 
> 赞同：67
> 
> 时间：2009-05-06T13:32:01.007
> 
> 标签：javascript, jquery, html, file-upload

当用户选择另一个选项时，我想重置文件上传字段。

这可以通过 JavaScript 实现吗？我怀疑文件上传元素的处理方式不同，因为它与用户的文件系统交互，而且它可能是不可变的。

基本上，我想要的是（伪代码）：

```
// Choose selecting existing file
$('#select-file').bind('focus', function() {
  // Clear any files currently selected in #upload-file
  $('#upload-file').val(''); 
}) ;

// Choose uploading new one - this works ok
$('#upload-file').bind('focus', function() {
  // Clear any files currently selected in #select-file
  $('#select-file').val(''); 
}) ; 
```

注意：**这个问题及其答案跨越了从 2009 年到今天的时期。**浏览器和方法在那个时候发生了变化，请记住这一点选择您的解决方案:)

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-05-07T03:09:31.650

您无法在大多数浏览器中设置输入值，但您可以做的是创建一个新元素，从旧元素复制属性，然后交换两者。

给定如下形式：

```
<form> 
    <input id="fileInput" name="fileInput" type="file" /> 
</form> 
```

直接的 DOM 方式：

```
function clearFileInput(id) 
{ 
    var oldInput = document.getElementById(id); 

    var newInput = document.createElement("input"); 

    newInput.type = "file"; 
    newInput.id = oldInput.id; 
    newInput.name = oldInput.name; 
    newInput.className = oldInput.className; 
    newInput.style.cssText = oldInput.style.cssText; 
    // TODO: copy any other relevant attributes 

    oldInput.parentNode.replaceChild(newInput, oldInput); 
}

clearFileInput("fileInput"); 
```

简单的 DOM 方式。这可能不适用于不喜欢文件输入的旧浏览器：

```
oldInput.parentNode.replaceChild(oldInput.cloneNode(), oldInput); 
```

jQuery方式：

```
$("#fileInput").replaceWith($("#fileInput").val('').clone(true));

// .val('') required for FF compatibility as per @nmit026 
```

通过 jQuery 重置整个表单：[https ://stackoverflow.com/a/13351234/1091947](https://stackoverflow.com/a/13351234/1091947)

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2014-02-04T08:19:35.113

简而言之，在 2014 年，具有 id 的输入元素支持该功能`val('')`。

对于输入 -

```
<input type="file" multiple="true" id="File1" name="choose-file" /> 
```

这个js清除输入元素-

```
$("#File1").val(''); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2015-12-30T12:17:18.150

简单的解决方案：

```
document.getElementById("upload-files").value = ""; 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-06T13:42:14.400

是的，上传元素受到保护，不会在不同浏览器中被直接操作。但是，您可以从 DOM 树中删除元素，然后通过 JavaScript 在其位置插入一个新元素。那会给你同样的结果。

类似于以下内容：

```
$('#container-element').html('<input id="upload-file" type="file"/>'); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-16T12:29:46.980

我最终使用的代码是，

```
clearReviewFileSel: function() {
  var oldInput = document.getElementById('edit-file-upload-review-pdf') ;
  var newInput = document.createElement('input');
  newInput.id    = oldInput.id ;
  newInput.type  = oldInput.type ;
  newInput.name  = oldInput.name ;
  newInput.size  = oldInput.size ;
  newInput.class  = oldInput.class ;
  oldInput.parentNode.replaceChild(newInput, oldInput); 
} 
```

谢谢大家的建议和指点！

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-12-30T12:03:04.190

更短`version`的对我来说很完美，如下所示：

```
document.querySelector('#fileUpload').value = ""; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-12-07T21:18:16.553

真的很喜欢这样简单:)

```
$('input[type=file]').wrap('<form></form>').parent().trigger('reset').children().unwrap('<form></form>'); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-06T14:01:35.633

他们没有获得焦点事件，所以你必须使用这样的技巧：清除它的唯一方法是清除整个表单

```
<script type="text/javascript">
    $(function() {
        $("#wrapper").bind("mouseover", function() {
            $("form").get(0).reset();
        });
    });
</script>

<form>
<div id="wrapper">
    <input type=file value="" />
</div>
</form> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-10-20T01:41:41.373

这个 jQuery 在 IE11、Chrome 53 和 Firefox 49 中为我工作：

```
cloned = $("#fileInput").clone(true);
cloned.val("");
$("#fileInput").replaceWith(cloned); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-03-19T14:31:09.637

试试这个它的工作正常

```
document.getElementById('fileUpload').parentNode.innerHTML = document.getElementById('fileUpload').parentNode.innerHTML; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-10-21T01:29:17.120

为了在 ajax 不可用时保持兼容性，请设置 .val('') 否则它将重新发送仍然存在于输入中的最后一个 ajax 上传文件。以下内容应在保留 .on() 事件的同时正确清除输入：

```
var input = $("input[type='file']");
input.html(input.html()).val(''); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-02-27T15:56:33.047

jQuery 测试方法在 FF 和 Chrome 中运行良好：

```
$(function(){
    $.clearUploadField = function(idsel){
        $('#your-id input[name="'+idsel+'"]').val("") 
    }
}); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-09-14T11:18:36.817

试试这个代码...

```
$("input[type=file]").wrap("<div id='fileWrapper'/>");
$("#fileWrapper").append("<div id='duplicateFile'   style='display:none'>"+$("#fileWrapper").html()+"   </div>");
$("#fileWrapper").html($("#duplicateFile").html()); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-06-05T12:23:12.347

如果您有以下情况：

```
<input type="file" id="FileSelect"> 
```

然后做：

```
$("#FileSelect").val(''); 
```

重置或清除最后选择的文件。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-10-25T17:09:01.157

我知道[FormData](https://developer.mozilla.org/en-US/docs/web/api/formdata) api 对旧浏览器等不是那么友好，但在许多情况下，无论如何你都在使用它（并希望[测试支持](https://github.com/New-Bamboo/example-ajax-upload/blob/master/public/index.html)），所以这会正常工作！

```
function clearFile(form) {
  // make a copy of your form
  var formData = new FormData(form);
  // reset the form temporarily, your copy is safe!
  form.reset();
  for (var pair of formData.entries()) {
    // if it's not the file, 
    if (pair[0] != "uploadNameAttributeFromForm") {
      // refill form value
      form[pair[0]].value = pair[1];
    }

  }
  // make new copy for AJAX submission if you into that...
  formData = new FormData(form);
}
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-06-05T22:11:26.810

只是锅的另一个，但您实际上可以更改输入的类型。如果将类型设置为文本，然后返回文件，则似乎重置了元素。

```
var myFileInput = document.getElementById('myfileinput');
myFileInput.type = "text";
myFileInput.type = "file"; 
```

它重置。在 Google Chrome、Opera、Edge、IE 11 中测试

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-12-04T12:02:02.857

我遇到了 ng2-file-upload 的问题。如果您正在通过 ng2-file-upload 寻找有关 angular 的解决方案，请参阅以下代码

**HTML：**

`<input type="file" name="myfile"` **#activeFrameinputFile** `ng2FileSelect [uploader]="frameUploader" (change)="frameUploader.uploadAll()" />`

**零件**

`import { Component, OnInit, ElementRef, ViewChild } from '@angular/core';`

`@ViewChild('`**activeFrameinputFile** `')`**InputFrameVariable**`: ElementRef;`

`this.frameUploader.onSuccessItem = (item, response, status, headers) => {` `this.`**输入帧变量**`.nativeElement.value = '';` `};`

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-05-15T09:14:57.003

我知道它已经很老了，但是在浏览器中测试：

```
$0.value=null; // when $0 is the file upload element we talking about 
```

删除了该值并允许我像以前一样重新选择相同的文件（意味着它有效！）

在 Chrome 81、FF 76、Safari（iPad mini 上）、360 浏览器、百度浏览器、QQ 浏览器、安卓浏览器中测试。

# 解释：

根据我的观点，选择的文件可能超过 1，您最好不要将值设置为字符串 - 最终值位于 $0.files 中，可能大于 1。浏览器需要解析选择的值来自“价值”，所以它是一个活跃的财产。根据我的理解，将其设置为 null 将导致浏览器将其解析为 $0.files 中的 [] 空列表（这就是发生的事情......）

# javascript - 在 JavaScript 中将 DOM 节点或文档转换为 XML

> ID：829574
> 
> 赞同：3
> 
> 时间：2009-05-06T13:32:41.443
> 
> 标签：javascript, dom, svg

假设您在 JavaScript 中获得了单个 DOM 元素或文档（例如 window.document），您将如何将其转换为有效的 XML？

更具体地说，对于我的示例，我有一个显示 SVG 的网页，这个 SVG 有很多 JavaScript 来允许交互。这是一个图表显示，可以让您放大图表，甚至进行一些转换。现在用户关闭这个想要有一个“保存图像”按钮。我想这样做的方式是获取 SVG 元素的文档节点，并将其转换为 XML，然后将其发送到服务器，然后服务器返回包含 SVG 文档或 PNG 图像的页面。

这一切都在 FireFox 上运行（目前这是用户的要求，尽管它在 Safari 和 Chrome 中也可以正常工作）。在网页的 Firefox 中，我已将 SVG 文档作为对象元素包含在内。在 javascript 中，我可以访问该对象 contentDocument，它指的是 XML 页面的根。它包含 XML 版本、文档标记和具有所有属性的根 svg 标记。

也许有人已经解决了这个问题，所以我可以复制他们的代码。也许有人知道在哪里寻找萤火虫来实现这一目标。或者也许已经有 DOM 方法可以做到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T13:59:31.770

有一个非标准的 API 对象：[XMLSerializer](https://developer.mozilla.org/en-US/docs/Web/API/XMLSerializer)（它不是标准的，但在除 IE 浏览器之外的所有浏览器中都实现了）。

它的 serializeToString 方法需要传递 DOMNode 对象。

```
var sXML = new XMLSerializer().serializeToString(document.body); 
```

在 Internet Explorer 中，没有办法为 HTML 检索正确的 XML，除非获取 .outerHTML 并修复序列化为 HTML 所带来的所有问题（例如属性中缺少引号，而不是闭合标签等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T14:29:19.730

明天我将不得不研究 XMLSerializer。这是我最终编写的代码，以防万一有人感兴趣（未知节点需要原型和 FireBug）：

```
function extractXML(node) {
    switch (node.nodeType) {
        case 1: return extractNodeXML(node);
        case 2: return extractAttributeXML(node);
        // 3 = Text node
        case 3: return node.nodeValue;
        // 8 = Comment node - ignore
        case 8: return "";
        case 9: return extractDocumentNodeXML(node);
        case 10: return extractDocumentTypeXML(node);
        default: console.log(node); return "Unkwon type: "+node.nodeType;
    }
}
function extractNodeXML(node) {
    var xml = "<"+node.nodeName;
    $A(node.attributes).each(function (node) {xml += " "+extractXML(node)});
    xml +=">"
    $A(node.childNodes).each(function (node) {xml += extractXML(node)});
    xml += "</"+node.nodeName+">"
    return xml;
}
function extractAttributeXML(node) {
    return node.nodeName+"=\""+node.nodeValue+"\""
}
function extractDocumentNodeXML(node) {
    var xml = "<?xml version=\""+node.xmlVersion+"\" encoding=\""+node.xmlEncoding+"\"?>"
    $A(node.childNodes).each(function (node) {xml += extractXML(node)});
    return xml;
}
function extractDocumentTypeXML(node) {
    return "<!DOCTYPE "+node.name+" PUBLIC \""+node.publicId+"\" \""+node.systemId+"\">"
} 
```

# java-me - 如何在索尼爱立信手机上直接在 Organizer 文件夹中安装 MIDlet

> ID：829582
> 
> 赞同：2
> 
> 时间：2009-05-06T13:33:32.907
> 
> 标签：java-me, installation, midp, midlet, jad

这个问题只针对运行 Java Platform 8 或更高版本的索尼爱立信手机。可以指示 AMS 在应用程序或游戏文件夹之一中安装应用程序。但我想将 MIDlet 安装在不同的文件夹中。目标文件夹是管理器、娱乐或位置服务。是否可以指示 AMS 在这些文件夹之一中安装我的 MIDlet？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T10:36:13.340

我在索尼爱立信的专有 AMS API 中看不到任何允许这样做的东西。只剩下 jad 属性，并且仅适用于应用程序与游戏。对不起。那里没有运气。

# c# - C# 插件架构与插件之间的接口共享

> ID：829597
> 
> 赞同：17
> 
> 时间：2009-05-06T13:36:08.050
> 
> 标签：c#, plugins, interface, observer-pattern

我将我的问题分为短版和长版，供手头时间不多的人使用。

简洁版本：

我需要一些具有提供者和消费者插件的系统架构。提供者应该实现接口 IProvider，消费者应该实现 IConsumer。执行应用程序应该只知道 IProvider 和 IConsumer。消费者实现可以询问正在执行的程序集（通过 ServiceProcessor）哪些提供者实现了 InterfaceX 并获取一个 List。这些 IProvider 对象应该被强制转换为 InterfaceX（在消费者中），以便能够将消费者挂钩到 InterfaceX 定义的某些事件上。这将失败，因为执行程序集不知何故不知道此 InterfaceX 类型（转换失败）。解决方案是将 InterfaceX 包含到插件和执行程序集都引用的某个程序集中，但这应该意味着对每个新的提供者/消费者对都进行重新编译，这是非常不受欢迎的。

有什么建议么？

长版：

我正在开发某种通用服务，它将使用插件来实现更高级别的可重用性。该服务由某种使用提供者和消费者的观察者模式实现组成。提供者和消费者都应该是主应用程序的插件。让我首先通过列出我的解决方案中的项目来解释服务是如何工作的。

项目 A：用于托管所有插件和基本功能的 Windows 服务项目。TestGUI Windows 窗体项目用于更轻松的调试。来自项目 B 的 ServiceProcessor 类的一个实例正在执行与插件相关的工作。该项目的子文件夹“Consumers”和“Providers”包含子文件夹，其中每个子文件夹分别包含一个消费者或提供者插件。

项目 B：一个类库，包含 ServiceProcessor 类（执行插件之间的所有插件加载和调度等）、IConsumer 和 IProvider。

项目C：一个类库，链接到项目B，由TestConsumer（实现IConsumer）和TestProvider（实现IProvider）组成。TestProvider 实现了一个附加接口（ITest，它本身是从 IProvider 派生的）。

这里的目标是消费者插件可以询问服务处理器它有哪些提供者（至少实现 IProvider）。返回的 IProvider 对象应在 IConsumer 实现中强制转换为它实现的其他接口 (ITest)，以便使用者可以将事件处理程序挂钩到 ITest 事件。

项目 A 启动时，会加载包含使用者和提供者插件的子文件夹。以下是我迄今为止遇到并试图解决的一些问题。

ITest 曾经驻留在项目 C 中的接口，因为这只适用于 TestProvider 和 TestConsumer 知道的方法和事件。总的想法是保持项目 A 简单，不知道插件之间的作用。

使用项目 C 中的 ITest 以及将 IProvider 转换为 ITest 的 TestConsumer 的 Initialize 方法中的代码（当实现 ITest 的对象被称为 IConsumer 对象时，这在单个类库本身中不会失败）会发生无效的转换错误. 可以通过将 ITest 接口放入项目 A 引用的项目 B 中来解决此错误。这是非常不需要的，因为我们需要在构建新接口时重新编译项目 A。

我试图将 ITest 放在仅由项目 C 引用的单个类库中，因为只有提供者和消费者需要了解此接口，但没有成功：加载插件时，CLR 指出找不到引用的项目。这可以通过挂钩当前 AppDomain 的 AssemblyResolve 事件来解决，但不知何故这似乎也不需要。ITest 再次回到项目 B。

我试图将项目 C 拆分为消费者和提供者的单独项目，并且都加载本身运行良好的程序集：两个程序集都驻留在 Assemblies 集合或当前 AppDomain 中：发现程序集：Datamex.Projects.Polaris.Testing.Providers ，版本=1.0.0.0，文化=中性，PublicKeyToken=2813de212e2efcd3 发现程序集：Datamex.Projects.Polaris.Testing.Consumers，版本=1.0.0.0，文化=中性，PublicKeyToken=ea5901de8cdcb258

由于消费者使用提供者，因此消费者对提供者进行了引用。现在再次触发 AssemblyResolve 事件，说明它需要以下文件：AssemblyName=Datamex.Projects.Polaris.Testing.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=2813de212e2efcd3

我的问题：为什么会这样？这个文件已经加载对了吗？为什么从 IProvider 转换到我知道它实现的某个接口是不可能的？这可能是因为执行程序本身不知道这个接口，但是这个不能动态加载吗？

我的最终目标：消费者插件询问 ServiceProcessor 它有哪些提供者实现了接口 x。提供者可以被强制转换为这个接口 x，而无需执行程序集知道接口 x。

有人可以帮忙吗？

在此先感谢，埃里克

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-06T14:18:23.813

我只是尽可能地重新创建您的解决方案，我没有这样的问题。（警告，后面有很多代码示例......）

第一个项目是应用程序，它包含一个类：

```
public class PluginLoader : ILoader
{
    private List<Type> _providers = new List<Type>();

    public PluginLoader()
    {
        LoadProviders();
        LoadConsumers();
    }

    public IProvider RequestProvider(Type providerType)
    {
        foreach(Type t in _providers)
        {
            if (t.GetInterfaces().Contains(providerType))
            {
                return (IProvider)Activator.CreateInstance(t);
            }
        }
        return null;
    }

    private void LoadProviders()
    {
        DirectoryInfo di = new DirectoryInfo(PluginSearchPath);
        FileInfo[] assemblies = di.GetFiles("*.dll");
        foreach (FileInfo assembly in assemblies)
        {
            Assembly a = Assembly.LoadFrom(assembly.FullName);
            foreach (Type type in a.GetTypes())
            {
                if (type.GetInterfaces().Contains(typeof(IProvider)))
                {
                    _providers.Add(type);
                }
            }
        }

    }

    private void LoadConsumers()
    {
        DirectoryInfo di = new DirectoryInfo(PluginSearchPath);
        FileInfo[] assemblies = di.GetFiles("*.dll");
        foreach (FileInfo assembly in assemblies)
        {
            Assembly a = Assembly.LoadFrom(assembly.FullName);
            foreach (Type type in a.GetTypes())
            {
                if (type.GetInterfaces().Contains(typeof(IConsumer)))
                {
                    IConsumer consumer = (IConsumer)Activator.CreateInstance(type);
                    consumer.Initialize(this);
                }
            }
        }
    } 
```

显然，这可以得到极大的整理。

下一个项目是包含以下三个接口的共享库：

```
public interface ILoader
{
    IProvider RequestProvider(Type providerType);
}

public interface IConsumer
{
    void Initialize(ILoader loader);
}

public interface IProvider
{
} 
```

最后是带有这些类的插件项目：

```
public interface ITest : IProvider
{        
}

public class TestConsumer : IConsumer
{
    public void Initialize(ILoader loader)
    {
        ITest tester = (ITest)loader.RequestProvider(typeof (ITest));
    }
}

public class TestProvider : ITest
{        
} 
```

应用程序和插件项目都引用共享项目，并且插件 dll 被复制到应用程序的搜索目录 - 但它们不相互引用。

构造 PluginLoader 时，它会找到所有 IProvider，然后创建所有 IConsumer 并在它们上调用 Initialize。在初始化过程中，消费者可以从加载器请求提供者，在此代码的情况下，构造并返回一个 TestProvider。所有这些都对我有用，无需花哨地控制程序集的加载。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T14:27:51.763

它仍在开发中，但听起来像是 MEF 的完美用例（将包含在 .Net 4 中）并在 VS2010 内部使用。

> MEF 为运行时可扩展性问题提供了一个简单的解决方案。到目前为止，任何想要支持插件模型的应用程序都需要从头开始创建自己的基础架构。这些插件通常是特定于应用程序的，不能在多个实现中重用。

预览版已在[http://www.codeplex.com/MEF上提供](http://www.codeplex.com/MEF)

Glen Block的[博客](http://blogs.msdn.com/gblock/)也很有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T14:26:49.643

您可能会发现我的文章有助于查看插件框架的工作示例，以及如何通过创建包含接口的通用程序集来解决这些问题：

C# 基础教程中的插件：

[http://www.codeproject.com/KB/cs/pluginsincsharp.aspx](http://www.codeproject.com/KB/cs/pluginsincsharp.aspx)

后续文章，带有启用泛型的插件管理器库：

[http://www.codeproject.com/KB/cs/ExtensionManagerLibrary.aspx](http://www.codeproject.com/KB/cs/ExtensionManagerLibrary.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T13:47:50.597

如果您的问题是，两个不相关的程序集如何共享相同的接口，答案是“你不能”解决方案是将接口包含在所有程序集中，也许在插件构建器可以引用的 dll 中，并在您的装载组件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T13:53:40.457

我已经做了类似于您正在尝试做的事情，只要我将程序集放在加载程序自动查看的地方，我就没有遇到任何问题。

您是否尝试过将所有程序集放在 exe 所在的子目录中？我现在不记得细节了，但是有一个步骤列表记录了加载程序在哪里以及以什么顺序查找程序集/类型。

# web-services - 在经典 ASP 中使用 Web 服务的最佳方式是什么？

> ID：829598
> 
> 赞同：2
> 
> 时间：2009-05-06T13:36:09.313
> 
> 标签：web-services, asp-classic, refactoring

我们有一个由经典 ASP 前端、VB COM+ 对象和 MSSql 数据库组成的三层架构。

我们将很快用 ASP.NET Webservice 层替换 VB COM，但我们还不能用新的 .NET 代码替换 Classic ASP，因此我们需要一种**在 Classic 中使用 webservices的方法ASP** ...

我们知道这是可能的，但不确定最好的方法是什么......

我们可以在 web 服务调用中返回 VBScript RecordSets 吗？（目前我们所有的经典 ASP 前端都使用记录集）。如果不是，使用结果的最简单方法是什么？

有没有使它更容易的库/类？

欢迎所有建议、链接、代码示例和评论！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T08:48:57.903

这是一篇关于[codeproject](http://www.codeproject.com/KB/asp/aspcallwebservice.aspx)的文章，应该可以解决您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T08:50:21.097

我建议您编写一个 .NET 客户端并使用 COM 接口对其进行编译，以便您可以像任何其他 COM 组件一样从经典 asp 调用它。

根据您的 Web 服务返回/要求的内容，您可能需要围绕 .NET 客户端编写一个层，以使输入/输出 VB 脚本友好。如果您在 VB 代码中使用记录集，则可以在该层内制作这些记录集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T19:53:43.513

既然它是一个 Web 服务，那么是否有理由避免将 ASP.NET 用于该层？

使用 VBscript 返回记录集当然是可能的，但我不确定您为什么要走这条路，因为您必须将记录集转换为 XML 等。

仅仅在 VB.NET 中解决这个问题（文档非常详细），可能会比您最终在 VBScript 中进行的所有疯狂调试所花费的时间和精力更少。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T08:59:40.163

有一个可以在 ASP/VBScript 中使用的 Microsoft SOAP 客户端 COM 组件，称为 MSSOAP.SoapClient，您可以在此处获取 - [http://www.driverskit.com/dll/mssoap30.dll/2342.html](http://www.driverskit.com/dll/mssoap30.dll/2342.html)

我认为 MS 不再特别支持这个组件，他们网站上的下载链接现在重定向到 WCF 主页。您还必须挖掘一些有关其使用的文档...

# asp.net - ASP.NET、IIS 和 COM

> ID：829601
> 
> 赞同：2
> 
> 时间：2009-05-06T13:36:20.687
> 
> 标签：asp.net, iis, com

我对 COM 不太熟悉，希望有人可以帮助验证我下面的内容是否正确。

如果我有两个完全独立的请求（请求 1 和请求 2），那么这将创建我的 WebApplication 的两个独立实例。到目前为止很无聊。

如果每个实例随后联系相同的 Web 服务，那么大概也实例化了 Web 服务的两个实例。

这就是有趣的地方。

这些 Web 服务创建一个 .NET 程序集，然后引用一个进程内（通过 regsvr32 注册）COM-dll（通过互操作）。

我的图表正确吗？

![替代文字](https://i.stack.imgur.com/CuVik.png)

此 COM-DLL 连接到数据库，执行查询，将数据返回给 Web 服务，然后 Web 服务以 JSON 格式将数据返回给客户端。全部完成 AJAXy。

我的另一个问题是——这在性能方面可以吗？我不明白为什么它不应该扩展，并且能够将数据返回给用户

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T14:26:02.343

似乎可以作为一个逻辑模式。但是，一如既往。魔鬼在细节中。

这一切都取决于您的服务使用 COM 组件的实现，特别是 COM 组件处理线程。如果您的 COM 组件是线程安全的并标记为使用 MTA（多线程单元），那么您应该没问题。然而，许多 COM 对象被标记为 STA（因此使用单线程单元）

关于“这在性能方面可以吗？”，那么如果您的 COM 组件是一个 STA（如果它是在 VB 6.0 中创建的），您将不得不做一些线程解开（否则您的所有服务请求将排队，负载下性能会变差。）

这篇文章解释了这个问题和解决方案（对于 ASMX 服务）......

[http://msdn.microsoft.com/en-us/magazine/cc163544.aspx](http://msdn.microsoft.com/en-us/magazine/cc163544.aspx)

..如果您使用的是 WCF 服务，还有解决方案...

[http://blogs.catalystss.com/blogs/scott_seely/archive/2007/09/27/203.aspx](http://blogs.catalystss.com/blogs/scott_seely/archive/2007/09/27/203.aspx)

# sql - 等效于 SQL Server TOP

> ID：829604
> 
> 赞同：15
> 
> 时间：2009-05-06T13:37:09.047
> 
> 标签：sql, database, keyword

在 SQL Server 中，TOP 可用于返回查询中的前 n 行。例如，

```
SELECT TOP 100 * FROM users ORDER BY id
```

可用于返回注册网站的前 100 人。（这不一定是最好的方法，我只是以它为例）。

我的问题是 - 在其他数据库（如 Oracle、MySQL、PostgreSQL 等）中，什么相当于 TOP？如果没有等效的关键字，您可以推荐哪些解决方法来获得相同的结果？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-06T13:44:15.190

要选择第一`100`行：

`MySQL`和`PostgreSQL`：

```
SELECT  *
FROM    Table
ORDER BY
        column
LIMIT 100 
```

`Oracle`：

```
SELECT  *
FROM    (
        SELECT  t.*
        FROM    table
        ORDER BY
                column
        )
WHERE   rownum <= 100 
```

请注意，您需要一个子查询。如果您不添加子查询，`ROWNUM`将以随机顺序选择第一`10`行，然后按`column`.

要选择 和 之间`100`的行`300`：

`MySQL`：

```
SELECT  *
FROM    TABLE
ORDER BY
        column
LIMIT   100, 200 
```

`PostgreSQL`：

```
SELECT  *
FROM    Table
ORDER BY
        column
OFFSET 100 LIMIT 200 
```

`Oracle`：

```
SELECT  *
FROM    (
        SELECT  t.*, ROW_NUMBER() OVER (ORER BY column) AS rn
        FROM    table
        )
WHERE   rn >= 100
        AND rownum <= 200 
```

请注意，尝试使用`ROWNUM BETWEEN 100 AND 200`（而不是`rn BETWEEN 100 AND 200`在外部查询中）对其进行简化将不会返回任何内容`Oracle`！

`RN BETWEEN 100 AND 200`也可以工作，`Oracle`但效率较低。

有关性能详细信息，请参阅我博客中的文章：

*   [**甲骨文：ROW_NUMBER 与 ROWNUM**](http://explainextended.com/2009/05/06/oracle-row_number-vs-rownum/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-06T13:40:28.070

对于 Postgres 和 MySQL，它是 LIMIT 关键字。

```
SELECT *
  FROM users
 ORDER BY id
 LIMIT 100; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T13:44:17.810

这是标准 SQL（Oracle 和 SQL Server 实现它）。这是一个最多返回 100 行的示例：

```
 SELECT ID_CONTROL FROM (SELECT ROW_NUMBER() OVER (ORDER BY ID_CONTROL) 
        ROWNUMBER, ID_CONTROL FROM IWS_CONTROL WHERE 
        CURRENT_STATE = 15 AND CURRENT_STATUS=0) A WHERE ROWNUMBER <= 100) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T14:33:02.350

在 SQL Anywhere 中，它与 SQL Server 相同：

```
SELECT TOP 100 * FROM users ORDER BY id 
```

如果需要，您甚至可以从结果集的中间开始：

```
SELECT TOP 100 START AT 50 * FROM users ORDER BY id 
```

获取结果集的第 50 到第 150 行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T13:39:47.603

```
LIMIT 100 
```

如在

```
SELECT * FROM foo ORDER BY bar LIMIT 100 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T13:40:34.577

您可以在 Oracle 中使用 RANK() 和 DENSE_RANK()。[这](http://www.oracle.com/technology/oramag/oracle/07-jan/o17asktom.html)是 AskTom 网站的链接，解释了如何在 Oracle 中使用 DENSE_RANK 进行分页和 top-n 查询。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-06T13:40:34.933

甲骨文：

```
select * from (select * from foo ORDER BY bar) where rownum < 100 
```

关于如何在[AskTom](http://www.oracle.com/technology/oramag/oracle/06-sep/o56asktom.html)中工作的很好的解释。

在 Ingres 中，相同的查询将通过：

```
select First 100 * from foo ORDER BY bar 
```

[之前在StackOverflow](https://stackoverflow.com/questions/49602/how-to-limit-result-set-size-for-arbitrary-query-in-ingres)中已经回答了 Ingres 问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T15:14:17.953

在 DB2 中，您可以使查询看起来像这样：

SELECT * FROM tblData**仅获取前 10**行；

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-06T13:58:41.223

在 Oracle 中，您想使用 TOP-N 查询。

例如：

```
select  *
  from  (SELECT  *
           FROM  foo
          where  foo_id=[number]
       order by  foo_id desc)
 where  rownum <= 3 
```

这将为您提供前三个结果（因为我在子查询中按 desc 排序）

# javascript - 测量 IE 中的 Javascript 性能

> ID：829615
> 
> 赞同：3
> 
> 时间：2009-05-06T13:40:23.827
> 
> 标签：javascript, internet-explorer, profiling

我有一个大量使用 Javascript（AJAX 请求、Google Maps API、HTML 构建等）的网页，每当在 Internet Explorer 中打开该页面时，我的电脑都会崩溃。我正在寻找一些工具来帮助我找出哪些功能需要最长时间才能完成。我有一些基本的分析 javascript 函数，但考虑到我不知道具体是什么函数很慢，这些并没有多大帮助。该工具必须适用于 IE，因为该页面在其他浏览器中运行良好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-30T22:02:44.020

对于 IE6、7 和 8 的 JavaScript、XmlHttpRequest、DOM 访问、渲染时间和网络流量，您可以使用免费的[dynaTrace AJAX 版](http://ajax.dynatrace.com)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T13:43:57.267

您实际上可能想查看 IE8 附带的开发人员工具。我知道 js 调试和分析是其中的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:42:25.643

看看[YUI Profiler](http://developer.yahoo.com/yui/profiler/)。

# c++ - 如何使用 OleDb 插入 CLOB

> ID：829622
> 
> 赞同：0
> 
> 时间：2009-05-06T13:40:57.490
> 
> 标签：c++, oracle, oledb

有人可以发布一些示例代码来展示如何将长度超过 4000 个字符的文本插入到 Oracle 10g CLOB 字段中吗？我在 C++ 中使用 Oracle OLEDB 提供程序和 ATL。每当我尝试插入的文本长度超过 4000 个字符时，我的天真尝试都会返回错误“ORA-01704: string literal too long”。我猜我需要以某种方式参数化 4000+ 字符串，但我不知道该怎么做......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T10:57:55.660

我最终得到了这个工作。万一其他人有同样的问题，我插入了值 EMPTY_CLOB() 然后使用 ISequentialStream 接口将文本流式传输到空字段中。Microsoft mydyntext 示例显示了如何执行此操作。

# c++ - 确定表达式的类型

> ID：829623
> 
> 赞同：8
> 
> 时间：2009-05-06T13:41:01.203
> 
> 标签：c++, c

有时我需要在用 C 或 C++ 编程时学习表达式的类型。有时有一个很好的 IDE 或现有的文档可以帮助我，但有时没有。我经常觉得这样的构造可能很有用：

```
void (*myFunc)(int);
printf("%s", nameoftype(myFunc)); //"void (*)(int)"
int i, unsigned int u;
printf("%s", nameoftype(i+u));    //"unsigned int" 
```

对于 C++ 尤其如此。想想 const 对象的访问器——它们返回一个 const 引用还是一个副本？想想动态演员表和模板类。

我怎样才能做到这一点？（即学习表达式的类型）

我使用 GCC，但据我所知，它没有这样的扩展。所以我想我很好奇人们如何解决这个问题。（欢迎使用编译时和运行时解决方案。）

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-06T13:43:26.177

有时我只是这样做：

```
int ***a = expression; 
```

并查找“<表达式类型> 无法分配给指向 ^3 int 的指针”错误。这似乎是最便携的解决方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T13:42:09.720

C++ 有一个`typeid`运算符；

```
typeid(expression).name() 
```

将返回表达式类型的实现定义名称。唉，它通常不是人类可读的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T21:27:22.410

你在找什么？自动类型推断或查找类型以便您可以手动正确声明变量？（您自己的答案看起来像您想要第二个答案）。在这种情况下，请考虑使用[Geordi](https://github.com/Eelis/geordi)：

```
<litb> make type pointer to function taking pointer to array of 10 int returning void
<geordi> void (*)(int (*)[10])

<litb> geordi: { int a = -1; unsigned int b = 0; cout << ETYPE(a + b), ETYPE_DESC(a + b), (a + b); }
<geordi> rvalue unsigned int, rvalue unsigned integer, 4294967295

<litb> geordi: << TYPE_DESC(void (*)(int (*)[10]))
<geordi> pointer to a function taking a pointer to an array of 10 integers and returning nothing 
```

如果没有像 boost.typeof 这样的辅助库，目前无法进行自动类型推断，它将使用像`__typeof__`GCC 这样的编译器扩展。下一个 C++ 将获得`auto`（具有与 current 不同的语义`auto`）并且能够做到这一点，以及`decltype`获得表达式的类型。

如果您可以摆脱本地环境，您总是可以创建一个这样的函数模板：

```
template<typename T> void f(T t) { /* ... */ }
int main() { int a = -1; unsigned int b = 0; f(a + b); } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:44:00.167

试试[Boost.Typeof](http://www.boost.org/doc/libs/1_35_0/doc/html/typeof.html)看看它是否合适。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T14:08:49.047

gcc 在编译时有 typeof() 。它像 sizeof() 一样工作。

[http://gcc.gnu.org/onlinedocs/gcc/Typeof.html](http://gcc.gnu.org/onlinedocs/gcc/Typeof.html)有更多信息。

# c++ - Winsock 2 可移植性

> ID：829625
> 
> 赞同：6
> 
> 时间：2009-05-06T13:42:02.730
> 
> 标签：c++, winsock, portability

我即将在 C++ 中开发一些与套接字相关的东西，并希望该软件从一开始就尽可能地在 Windows 和 Linux 之间移植（让它以后移植很棘手。）

我查看了不同的库，有一个来自[alhem.net](http://www.alhem.net/Sockets/)的 C++ 库，当然还有 boost::asio。boost::asio 看起来很有前途，但对于这么小的应用程序来说将是一个非常大的依赖项。

自己写这些东西是否值得，还是我应该只使用图书馆？如果我自己做，主要的陷阱是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-15T12:25:47.447

我开发了一些围绕套接字的便携式包装器。确保您不会走下由 WinSock2 事件构成的糟糕的不归路。除此之外，在我看来，最大的区别是：

*   要在 Windows 中启动网络，您需要调用`::WSAStartup()`, 在 Windows 中将其关闭，运行`::WSACleanup()`; 在 Linux 中什么都不做，
*   `close()`在 Linux 中是`closesocket()`在 Windows 中，
*   驱动程序和操作系统之间的默认缓冲区大小不同，因此请确保使用`SO_RCVBUF`and来设置它们`SO_SNDBUF`，
*   SO_REUSEADDR 在 Windows 上窃取地址，允许在 Linux 上频繁重新打开；你可能只想在 Linux 中使用这个标志，
*   `::ioctlsocket()`在 Windows、Linux `::fcntl()`、
*   头文件不一样，`<sys/socket.h>`朋友在Linux，`<WinSock.h>`在Windows，
*   要便携，最简单的方法可能是使用`::select()`等待数据到达，
*   `fd_set`s 在 Windows/Linux 上完全不同；这仅在您需要优化`fd_set`s 的初始化时才相关，例如在添加/删除任意套接字时，
*   在 Windows 中，当套接字关闭时，挂在套接字上的任何线程都会被释放并带有错误代码，在 Linux 中，线程保持等待。如果线程正在阻塞套接字，例如`::recvfrom()`，您可以考虑`::sendto()`在 Linux 下使用来释放停止的线程。

我曾经需要的其他一切都是从 låda 中解决的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T14:04:28.683

Winsocks 与 Posix 套接字不太兼容：

*   在 Winsocks 中，套接字的类型是`SOCKET`. 在 Posix 上，它只是一个文件描述符 ( `int`)，您可以在其上执行正常`read()`和`write()`调用。
*   它们不会以相同的方式返回错误。
*   他们不支持`recv()`和上的某些选项`send()`。
*   您必须使用两个特殊函数初始化和统一 Winsocks 库。
*   我认为您不能使用`shutdown()`or关闭 Windows 套接字`close()`。而是类似的东西`closesocket()`。

肯定有更多的不同，但这就是我现在能记住的。如果您希望 Winsocks 具有可移植性，您将拥有一个用于关闭套接字、打印错误消息等的小型库。

我个人可能会选择`boost::asio`（不过我从未使用过它）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-16T07:18:41.897

看看“自适应通信环境”（ACE）库： [（ACE 主页）](http://www.cs.wustl.edu/~schmidt/ACE.html) 它提供了一些很好的抽象和很大的灵活性，所有这些都集中在一个支持 Windows、MacOS 和 Linux 的可移植库中。它的学习曲线有点陡峭，但我从中获得了很好的价值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:46:17.573

老实说，我会优先使用 boost::asio。如果你真的想对套接字 API 感到厌烦，你可以在 Windows 和 Linux 上使用标准的 BSD 风格的套接字 API——只是在 Windows 上你必须链接到（并初始化）Winsock2，而在Linux 你不会有一个单独的库来链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T13:47:46.197

您将使用多少插座的东西？我已经完成了几个应用程序，其中套接字的东西非常高级（打开、读取、写入），并且从 Windows 到 Linux 都可以完美运行。如果它不止于此 - 继续提升。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-24T18:31:36.773

看看这个... [http://sourceforge.net/projects/cpp-sockets/](http://sourceforge.net/projects/cpp-sockets/)

# c - 在 C 中抓取网页的最简单方法是什么？（通过 https）

> ID：829642
> 
> 赞同：2
> 
> 时间：2009-05-06T13:45:01.537
> 
> 标签：c, sockets, webpage

与这里的问题几乎相同： [在 C 中获取网页的最简单方法是什么？](https://stackoverflow.com/questions/825327/whats-the-easiest-way-to-grab-a-web-page-in-c)

但是条件发生了变化，我需要通过 https 连接，这有点棘手，有人有任何片段吗？

我在一个 qnx 平台上，构建和编译额外的库并将其推广到我们的产品上是非常非常困难的。***所以像 libcurl 这样的东西是不可能的。***

**结果：** 事实证明，我毕竟必须在 QNX 上安装 libcurl。这涉及安装 perl 和 openSSL 来构建 libcurl，但是一旦构建好就可以了。这是最不理想的选择，但最终还是值得的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T13:48:02.717

[libcurl](http://curl.haxx.se/libcurl/)应该能够处理您需要做的任何事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T14:17:47.497

如果您无法使用库，那么我猜您要么被迫作弊，例如“调用外壳或其他已经具有此功能的环境”。我对 QNX 或它通常运行的环境不是很熟悉，无论如何我自己都不足以排除这种可能性。

顺便说一句，在跳过这个之前：libcurl*是*基于 QNX 构建的，所以在进一步阅读之前尝试一下。

如果做不到这一点，从字面上理解这个问题，我想你需要自己实现 HTTP 协议的相关部分。由于您现在也需要安全访问，因此您处于一个受伤的世界。你只是不想自己实现那种类型的代码，这是很多工作，需要重新发明很多轮子。

至少，我建议您仔细查看一下您需要执行的*任何操作是否已经实现。*[此页面](http://www.openqnx.com/index.php?name=News&file=article&sid=181)暗示 OpenSSH 可用于 QNX 平台，这是令人鼓舞的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T20:20:01.870

当您发布此后续问题时，我不在。

我现在在[http://pastebin.com/f1cd08b33上发布了一个支持 SSL 的示例程序](http://pastebin.com/f1cd08b33)

这需要与 OpenSSL ( `-lssl`) 链接，但根本不需要`libcurl`。

# json - 在jsp中处理json对象

> ID：829643
> 
> 赞同：1
> 
> 时间：2009-05-06T13:45:07.013
> 
> 标签：json, jsp, browser, object, parsing

我有一个从浏览器发送到 jsp 页面的 JSON 对象。我如何接收该对象并在 jsp 中处理它。我需要任何特定的解析器吗？我使用了以下代码。但它不起作用。基本上我应该读取对象的内容并将它们打印在 jsp 中。

```
<%@page language="java" import="jso.JSONObject"%>

<%
JSONObject inp=request.getParameter("param1");
%>

<% for(int i=0;i<inp.size();i++)
{%>
    <%=inp.getString(i)%>
<%
}
%> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-05-21T21:33:18.273

我对这个问题的首选解决方案是使用 JSON 解析器，该解析器提供实现 java.util.Map 和 java.util.List 接口的输出。这允许在 JSP 表达式语言中简单解析 JSON 结构。

这是一个使用 Apache Wink 提供的 JSON4J 的示例。该示例从 URL 导入 JSON 数据，在 java scriptlet 中对其进行解析并浏览生成的结构。

```
<c:import var="dataJson" url="http://localhost/request.json"/>
<% 
String json = (String)pageContext.getAttribute("dataJson");
pageContext.setAttribute("parsedJSON", org.apache.commons.json.JSON.parse(json));
%>
Fetch the name of the node at index 1 : ${parsedJSON.node[1].name} 
```

为了使这个干净，最好创建一个 JSTL 标记来进行解析并避免使用 java scriplet。

```
<c:import var="dataJson" url="http://localhost/request.json"/>
<json:parse json="${dataJson}" var="parsedJSON" />
Fetch the name of the node at index 1 : ${parsedJSON.node[1].name} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-30T06:22:19.000

You can parse the input string to `JSONValue` and then cast it to `JSONOject` as like shown below

```
 JSONObject inp = (JSONObject) JSONValue.parse(request.getParameter("param1")); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T22:46:46.540

通常，您不会在查询参数中传递 JSON —— 需要过多的引用。相反，您应该使用 JSON 作为有效负载（内容类型“应用程序/json”）等进行 POST。

但除此之外，您还需要一个 json 解析器；[Json.org](http://json.org)列出了吨；我最喜欢的是[Jackson](http://jackson.codehaus.org/Tutorial)，它像页面中的大多数替代方案一样也可以从 jsp 调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:10:29.417

您的示例代码中有几个语法错误。

首先，request.getParameter 返回一个字符串，因此将其设置为 JSONObject 将不起作用。其次，您的 for 循环不完整。

我建议查看可用于 Java 的各种 JSON 库并使用其中之一。

为了帮助您入门，我会看一些[解码](http://json-lib.sourceforge.net/snippets.html#Creating%20a%20JSONObject%20from%20a%20JSON%20formatted%20string) [示例](http://code.google.com/p/json-simple/wiki/DecodingExamples)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T13:53:53.140

svenson [JSON 库](http://code.google.com/p/svenson/)也可以从 JSP 中使用。

# algorithm - 具有离散和连续属性的聚类算法？

> ID：829644
> 
> 赞同：9
> 
> 时间：2009-05-06T13:45:13.380
> 
> 标签：algorithm, artificial-intelligence, data-mining

有谁知道在离散和连续属性上执行聚类的好算法？我正在解决识别一组相似客户的问题，并且每个客户都具有离散和连续属性（考虑客户类型、该客户产生的收入金额、地理位置等。）

像 K-means 或 EM 这样的传统算法适用于连续属性，如果我们混合了连续属性和离散属性怎么办？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T13:53:48.180

如果我没记错的话，COBWEB 算法可以处理离散属性。

您还可以对离散属性执行不同的“技巧”，以创建有意义的距离度量。

您可以在 Google 上搜索分类/离散属性的聚类，这是最热门的作品之一：[ROCK: A Robust Clustering Algorithm for Categorical Attributes](http://www.cis.upenn.edu/~sudipto/mypapers/categorical.pdf)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T23:08:15.887

R 是一个很好的聚类工具 - 标准方法是使用 计算混合数据的相异矩阵[`daisy`](http://stat.ethz.ch/R-manual/R-devel/library/cluster/html/daisy.html)，然后使用该矩阵进行聚类[`agnes`](http://stat.ethz.ch/R-manual/R-devel/library/cluster/html/agnes.html)。

[`cba`CRAN 上](http://cran.r-project.org/web/packages/cba/index.html)的模块包括一个基于 ROCK 对二进制预测器进行聚类的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T13:55:21.577

您还可以将[亲和力传播](http://www.psi.toronto.edu/affinitypropagation/)视为一种可能的解决方案。但是要克服连续/离散的困境，您需要定义一个对离散状态进行估值的函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T11:03:56.067

我实际上会向用户呈现成对的离散属性，并要求他们定义他们的接近度。你会给他们呈现一个从[同义词..非常外国]或类似的尺度。让很多人这样做，您最终会得到一个广泛接受的非线性属性值的邻近函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-31T16:39:41.563

如何将您的每个分类属性转换为一系列 N-1 二元指标属性（其中 N 是类别数）？您不应该害怕高维，因为它是一种稀疏表示（例如`SequentialAccessSparseVector`可以使用 mahout）。一旦你这样做了，你就可以使用经典的 K-means 或任何标准的纯数字聚类算法。

# c# - 电话号码在 ajax 控制工具包掩码中显示不正确？

> ID：829651
> 
> 赞同：0
> 
> 时间：2009-05-06T13:47:35.930
> 
> 标签：c#, asp.net, ajaxcontroltoolkit

我有以下电话号码 866-234-5678。

我有一个 asp 文本框，我正在应用以下掩码：

```
 <cc2:MaskedEditExtender ID="maskPhone" 
                         runat="server" 
                         ClearMaskOnLostFocus="false"
                         AutoComplete="false" 
                         MaskType="None" 
                         Mask="(999)-999-9999" 
                         InputDirection="LeftToRight"
                         TargetControlID="txtPhone">
 </cc2:MaskedEditExtender> 
```

当我使用文本框加载页面时，电话号码显示如下：

(662)-345-678_

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T13:49:45.893

掩码为最后一组表示 4 位数字。显示的下划线“_”是 MaskedEditExtender 的 PromptCharacter。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:55:05.677

当您在 page_load 中设置 .Text 属性时，后面的代码会设置渲染的值`<INPUT`，然后在页面在浏览器中完成渲染后使用 Javascript 应用 Mask。因为第一个字符（`8`）不是掩码的一部分，所以扩展器的 javascript 似乎用`(`掩码的第一个括号覆盖它。这是一种奇怪的行为，但完全可以复制。

如果您将后面的代码更改为

```
tbxPhone.Text = " 8662345678"; 
```

这似乎解决了它，因为填充空间是被截断的空间，但这太糟糕了。可能最好在 CodePlex 上与开发人员记录一张票，或者如果您愿意的话，自己尝试修复扩展器 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-03T17:51:07.100

我也有这个问题，只有我的 (525) 234-5678 显示为 (_25) 234-5678。在将值绑定到 TextBox 之前，用一个额外的字符向左填充将其清除。愚蠢的...

# c++ - 用于游戏编程的 C++ - 爱还是不信任？

> ID：829656
> 
> 赞同：27
> 
> 时间：2009-05-06T13:48:39.347
> 
> 标签：c++, performance

以游戏编程效率的名义，一些程序员不信任几个 C++ 特性。我的一位朋友声称了解游戏行业的运作方式，并会提出以下评论：

*   不要使用智能指针。游戏中没有人这样做。
*   游戏编程中不应（通常也不）使用异常来提高内存和速度。

这些陈述中有多少是真实的？C++ 特性的设计考虑到了效率。对于游戏编程来说，这种效率还不够吗？对于 97% 的游戏编程？

C 思维方式似乎仍然对游戏开发社区有很好的把握。这是真的？

我在 GDC 2009 上观看了另一个关于多核编程的演讲视频。他的演讲几乎完全针对 Cell Programming，其中在处理之前需要 DMA 传输（简单的指针访问不适用于 Cell 的 SPE）。他不鼓励使用多态性，因为对于 DMA 传输，指针必须“重新基于”。多么悲伤。这就像回到广场一。我不知道是否有一个优雅的解决方案可以在 Cell 上编写 C++ 多态性。DMA 传输的主题很深奥，我在这里没有太多背景知识。

我同意 C++ 对于想要使用小语言而不是阅读大量书籍的程序员来说也不是很好。模板也吓坏了调试。您是否同意 C++ 被游戏社区过度恐惧？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-05-06T14:32:12.453

我参与的最后一款游戏是 PS3 上的《天堂之剑》，它是用 C++ 编写的，甚至是单元代码。在此之前，我做过一些 PS2 游戏和 PC 游戏，它们也是 C++。没有项目使用智能指针。不是因为任何效率问题，而是因为通常不需要它们。游戏，尤其是控制台游戏，在正常游戏过程中不会使用标准内存管理器进行动态内存分配。如果有动态对象（导弹、敌人等），那么它们通常会被预先分配并根据需要重新使用。每种类型的对象都会有游戏可以处理的实例数量的上限。

游戏通常不使用异常，因为游戏不应该有错误，因此不能产生异常。对于由游戏机制造商测试游戏的游戏机游戏尤其如此，尽管最近的平台（如 360 和 PS3）似乎确实有一些游戏可能会崩溃。老实说，我没有在网上读到任何关于启用异常的实际成本是多少。如果仅在引发异常时才产生成本，那么没有理由不在游戏中使用它们，但我不确定，它可能取决于所使用的编译器。一般来说，游戏程序员知道什么时候会出现问题，这些问题可以在业务应用程序中使用异常来处理（例如 IO 和初始化），并在不使用异常的情况下处理它们（这是可能的！）。

但随后，在全球范围内，C++ 作为一种游戏开发语言正在慢慢减少。Flash 和 Java 可能拥有更大的市场份额，并且它们确实有异常和智能指针（以托管对象的形式）。

至于 Cell 指针访问，当代码被 DMA'd 到任意基地址的 Cell 时，就会出现问题。在这种情况下，代码中的任何指针都需要用新的基地址“修复”，这包括 v-tables，并且您并不真的希望对加载到 Cell 中的每个对象都这样做。如果代码始终加载到固定地址，则永远不需要修复指针。尽管您限制了代码的存储位置，但您会失去一些灵活性。在 PC 上，代码在执行期间从不移动，因此从不需要在运行时修复指针。

我真的不认为任何人“不信任”C++ 特性——不信任编译器完全是另外一回事，而且像 Cell 这样的新的、深奥的架构往往会在 C++ 编译器之前获得健壮的 C 编译器，因为 C 编译器比制作更容易一个 C++ 的。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-05-06T13:59:55.293

看，你听到的关于编程效率的大部分内容*都是*神奇的思维和迷信。智能指针确实有性能成本；特别是如果你在一个内部循环中做很多花哨的指针操作，它可能会有所作为。

也许。

但是当人们*说*这样的话时，通常是因为很久以前有人告诉他们X是真的，除了直觉之外没有任何东西。现在，细胞/多态性问题*听起来很*合理——我敢打赌，第一个说它的人就是这样。但我还没有验证。

你会听到关于操作系统 C++ 的相同说法：它太慢了，你想做的事情做得好，做得不好。

尽管如此，我们完全用 C++ 构建了 OS/400（从 v3r6 开始），从裸机开始，并获得了一个快速、高效和小型的代码库。这需要一些工作；特别是在裸机上工作，有一些引导问题，使用新的放置，诸如此类。

C++ 可能只是因为它太大而成为一个问题：我现在正在重读 Stroustrup 的腕断器，它非常令人生畏。但我不认为有任何内在的东西说你不能在游戏编程中以有效的方式使用 C++。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-06T14:26:13.013

如果您或您的朋友对性能真的很偏执，那么请阅读有关优化的英特尔手册。乐趣。

否则，每次都追求正确性、可靠性和可维护性。我宁愿有一个运行有点慢的游戏而不是一个崩溃的游戏。如果/当你注意到你有性能问题，PROFILE 然后优化。您可能会发现有些热点代码可以通过使用更有效的数据结构或算法来提高效率。当分析表明它们是获得有价值的加速的唯一方法时，只需担心这些愚蠢的小微优化。

所以：

1.  编写代码要清晰正确
2.  轮廓
3.  **轮廓**
4.  能否使用更高效的数据结构或算法来加速瓶颈？
5.  使用微优化作为最后的手段，并且只有在分析表明它会有所帮助时

PS：许多现代 C++ 编译器提供了一种异常处理机制，该机制增加了零执行开销，除非抛出异常。也就是说，只有在实际抛出异常时才会降低性能。只要异常仅用于*特殊情况*，那么没有充分的理由不使用它们。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-04-03T16:29:46.663

我在 StackOverflow 上看到了一篇文章（我似乎再也找不到了，所以可能没有在这里发布），它查看了异常与错误代码的相对成本。人们经常看“有异常的代码”与“没有错误处理的代码”，这是不公平的比较。如果您要使用异常，那么不使用它们就必须使用其他东西来实现相同的功能，而其他东西通常是错误返回码。他们发现，即使在具有单级函数调用的简单示例中（因此无需将异常传播到调用堆栈的深处），在错误情况发生的时间为 0.1% - 0.01% 的情况下，异常比错误代码更快或更少，而错误代码在相反情况下更快。

与上述关于测量异常与无错误处理的抱怨类似，人们在推理时更常在虚函数方面犯这种错误。就像您不使用异常作为从函数返回动态类型的一种方式（是的，我知道，您的*所有*代码都是异常的），您不会将函数设为虚拟，因为您喜欢它在语法中的外观荧光笔。您将函数虚拟化是因为您需要一种特定类型的行为，因此您不能说虚拟化很慢，除非您将其与具有相同操作的事物进行比较，并且通常替换是大量 switch 语句或大量代码复制。那些也有性能和内存命中。

至于说游戏没有bug，其他软件有，我只能说我明显没玩过他们软件公司的游戏。我在 Pokemon 中的精英 4 的地板上冲浪，在 Oblivion 中被困在一座山里，被 Gloams 杀死，这些 Gloams 不小心将他们的法力伤害与他们的 hp 伤害结合在一起，而不是在暗黑破坏神 II 中单独进行，并把自己推到了在暮光公主中，用大石头和小鸟和弹弓对抗地精的关门。软件有bug。使用异常不会使无错误的软件出现错误。

标准库的异常机制有两种类型的异常：`std::runtime_error`和`std::logic_error`. 我可以看到不想使用`std::logic_error`（我将它用作帮助我测试的临时工具，目的是最终将其删除，并且我也将其作为永久检查保留）。`std::runtime_error`，但是，不是错误。如果我连接的服务器向我发送无效数据（安全编程的规则 #1：不信任任何人，即使是您认为自己编写的服务器），我会抛出异常`std::runtime_error`，例如声称他们正在向我发送一条消息12 个字节，然后他们实际上给我发送了 15 个字节。在这种情况下，只有两种可能性：

1) 我连接到恶意服务器，或者

2) 我与服务器的连接已损坏。

在这两种情况下，我的响应都是相同的：断开连接（无论我在代码中的哪个位置，因为我的析构函数会为我清理东西），等待几秒钟，然后再次尝试连接到服务器。我不能做任何其他事情。我可以给所有东西一个错误代码（这意味着通过引用传递其他所有东西，这是一个性能损失，并且代码严重混乱），或者我可以抛出一个异常，我可以在我的代码中确定哪些服务器的位置捕获到连接到（在我的代码中可能非常高）。

我提到的代码中有任何错误吗？我不这么认为；我认为它接受了我必须与之交互的所有其他代码是不完美或恶意的，并确保我的代码在面对这种歧义时保持高性能。

同样，对于智能指针，您要实现的功能是什么？如果您需要智能指针的功能，那么不使用智能指针意味着手动重写它们的功能。我认为很明显为什么这是一个坏主意。但是，我很少在自己的代码中使用智能指针。我真正做的唯一一次是如果我需要在标准容器中存储一些多态类（例如，根据战斗类型派生的一些基类`std::map<BattleIds, Battles>`在哪里），在这种情况下，我使用了. 我相信有一次我在课堂上使用 a 来处理一些库代码。我大部分时间都在使用`Battles``std::unique_ptr``std::unique_ptr``std::unique_ptr`, 就是让一个不可复制、不可移动的类型可移动。然而，在许多使用智能指针的情况下，在堆栈上创建对象并从等式中完全删除指针似乎是一个更好的主意。

在我个人的编码中，我并没有真正发现很多“C”版本的代码比“C++”版本的代码更快的情况。事实上，通常情况正好相反。例如，考虑许多`std::sort`vs.`qsort`的示例（Bjarne Stroustrup 使用的一个常见示例），其中clobbers`std::sort`或`qsort`我[最近比较的`std::copy`vs.`memcpy`](https://stackoverflow.com/a/9980859/852254)`std::copy`实际上具有轻微的性能优势。

太多“C++ 特性 X 太慢”的说法似乎是基于将其与没有该功能进行比较。性能最高（在速度和内存方面）和无错误的代码是`int main() {}`，但我们编写程序来做事。如果您需要特定的功能，那么不使用为您提供该功能的语言特性将是愚蠢的。但是，您应该首先考虑您希望程序做什么，然后找到最好的方法。显然，您不想以“我想编写一个使用 C++ 的特性 X 的程序”开头，而是想以“我想编写一个做 Z 很酷的程序”开头，也许您最终会以“. ..实现这一点的最佳方式是功能 X”。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-06T14:07:27.863

很多人对事物做出绝对的陈述，因为他们实际上并没有*思考*。他们宁愿只应用一条规则，让事情变得更乏味，但需要更少的设计和深谋远虑。我宁愿在做一些毛茸茸的事情时时不时地认真思考一下，把乏味的东西抽象出来，但我想不是每个人都这么想。当然，智能指针有性能成本。例外也是如此。这只是意味着您的代码中**可能**有*一小部分不应该使用它们。*但是您应该首先分析并确保这实际上是问题所在。

免责声明：我从未做过任何游戏编程。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-06T14:45:51.890

关于 Cell 架构：它有一个*不连贯*的缓存。每个 SPE 都有自己的 256 KB 本地存储。SPE 只能访问该内存；任何其他内存，例如 512 MB 的主内存或另一个 SPE 的本地存储，都必须使用 DMA 访问。您手动执行 DMA 并通过显式启动 DMA 传输将内存复制到本地存储中。这使得同步成为一个巨大的痛苦。

或者，您实际上*可以*访问其他内存。主存和每个 SPE 的本地存储都映射到 64 位虚拟地址空间的某个部分。如果您通过正确的指针访问数据，则 DMA 发生在幕后，这一切看起来就像一个巨大的共享内存空间。问题？巨大的性能冲击。每次访问这些指针之一时，SPE 都会在 DMA 发生时停止。这很慢，而且您不想在性能关键代码（即游戏）中执行此操作。

这将我们带到[Skizz](https://stackoverflow.com/questions/829656/c-for-game-programming-love-or-distrust/829902#829902)关于 vtables 和指针修复的观点。*如果您在 SPE 之间盲目地复制 vtable 指针，那么如果您不*修复指针，您将招致巨大的性能损失，如果您修复您的指针，您也会招致巨大的性能损失指针并将虚拟功能代码下载到 SPE。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-12-26T06:22:35.723

我遇到了 Sony 的一个出色的演示文稿，名为“面向对象编程的陷阱”。这一代控制台硬件确实让很多人重新审视了 C++ 的 OO 方面，并开始质疑它是否真的是最好的前进方式。

您可以在此处找到演示文稿[（](http://research.scee.net/files/presentations/gcapaustralia09/Pitfalls_of_Object_Oriented_Programming_GCAP_09.pdf)[此处](http://research.scee.net/presentations)直接链接）。也许你会发现这个例子有点做作，但希望你会看到这种对高度抽象的面向对象设计的厌恶并不总是基于神话和迷信。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-06T15:03:25.517

我过去曾用 C++ 编写过小游戏，目前将 C++ 用于其他高性能应用程序。无需在整个代码库中使用每一个 C++ 功能。

因为 C++ 是（几乎减去一些东西）C 的超集，所以您可以在需要的地方编写 C 风格的代码，同时在适当的地方利用额外的 C++ 特性。

给定一个体面的编译器，C++ 可以和 C 一样快，因为你可以用 C++ 编写“C”代码。

和往常一样，分析代码。算法和内存管理通常比使用某些 C++ 功能对性能的影响更大。

许多游戏还将 Lua 或其他一些脚本语言嵌入到游戏引擎中，因此显然并不是每行代码都需要最高性能。

我从未编程或使用过 Cell，因此可能会有进一步的限制等。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-05-14T20:21:21.227

游戏社区并不惧怕 C++。在开发了一个销售数百万美元的开放世界游戏引擎后，我可以说这个行业的人非常熟练和知识渊博。

shared_ptr 没有被广泛使用的事实部分是因为它有实际成本，但更重要的是因为所有权不是很清楚。所有权和资源管理是最重要和最难做好的事情之一。部分原因是控制台上的资源仍然稀缺，但也因为大多数困难的错误往往与不明确的资源管理有关（例如，谁和什么控制了对象的生命周期）。恕我直言 shared_ptr 至少对此无济于事。

异常处理会增加成本，这使得它不值得。在最终游戏中，无论如何都不应该抛出异常——直接崩溃比抛出异常要好。另外，无论如何，在 C++ 中确保异常安全确实很困难。

但是 C++ 的许多其他部分在游戏业务中被广泛使用。在 EA 内部，EASTL 是对 STL 的惊人翻拍，非常适合高性能和稀缺资源。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-05-15T02:02:39.360

有句老话说，将军们已经做好了打最后一场战争而不是下一场战争的准备。

大多数关于性能的建议也有类似的情况。它通常与五年前可用的软件和硬件有关。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-15T01:54:42.580

Kevin Frei 写了一篇有趣的文档，“<a href="https://www.slideserve.com/darcie/how-much-does-exception-handling-cost-really" rel="nofollow noreferrer">Exception 有多少处理成本，真的吗？”。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-06T14:03:25.440

这也取决于游戏的类型。如果它是一个处理器轻的游戏（如小行星克隆）或几乎任何 2d 游戏，你可以逃脱更多。当然，智能指针的成本高于普通指针，但如果有人用 C# 编写游戏，那么智能指针绝对不会成为问题。游戏中未使用的异常可能是正确的，但无论如何，许多人滥用异常。异常应该只用于特殊情况......不是预期的错误。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-07-11T19:31:37.250

我在加入游戏行业之前也听说过，但我发现专门游戏硬件的编译器有时……低于标准。（我个人只使用过主要的游戏机，但我相信对于手机等设备来说更是如此。）显然，如果你正在为 PC 开发，这并不是一个真正的大问题，其中编译器经过尝试、真实且种类繁多，但如果您想为 Wii、PS3 或 X360 开发游戏，请猜测您有多少选项以及它们与您选择的 Windows/Unix 编译器的测试情况。

当然，这并不是说这些工具一定很糟糕，但只有当你的代码很简单时，它们才能保证工作——本质上，如果你用 C 编程。这并不意味着你不能使用一个类或创建一个使用 RAII 的智能指针，但是您获得的“保证”功能越远，对标准的支持就越不稳定。我个人使用一些为一个平台编译但不在另一个平台上编译的模板编写了一行代码——其中一个根本不支持 C++ 标准中的某些边缘情况。

其中一些无疑是游戏程序员的传说，但很可能它来自某个地方：一些旧的编译器在抛出异常时会奇怪地解开堆栈，所以我们不使用异常；某个平台没有很好地使用模板，所以我们只在琐碎的情况下使用它们；等等。不幸的是，问题案例和它们发生的地方似乎从来没有被记录在任何地方（而且这些案例通常很深奥，当它们第一次发生时很难追踪），所以没有简单的方法来验证它是否仍然是一个问题或不只是尝试并希望您不会因此受到伤害。不用说，这说起来容易做起来难，所以犹豫还在继续。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-28T09:18:59.647

异常处理从来都不是免费的，尽管这里有一些相反的说法。无论是内存还是速度，总是有代价的。如果它的性能成本为零，那么内存成本就会很高。无论哪种方式，所使用的方法都完全依赖于编译器，因此不受开发人员的控制。这两种方法都不适用于游戏开发，因为 a. 目标平台的内存有限，通常永远不够用，因此，我们需要完全控制，以及 b. 30/60Hz 的固定性能约束。PC 应用程序或工具在处理某些内容时暂时放慢速度是可以的，但这在主机游戏中绝对不能容忍。有依赖于一致帧速率的物理和图形系统等，因此任何 C++“功能” 这可能会破坏这一点 - 并且无法由开发人员控制 - 是一个很好的被放弃的候选者。如果 C++ 异常处理非常好，几乎没有或没有性能/内存成本，那么它将在每个程序中使用，甚至没有禁用它的选项。事实是，编写可靠的 PC 应用程序代码可能是一种整洁的方式，但对于游戏开发的要求来说是多余的。它会增加可执行文件的容量，消耗内存和/或性能，并且完全无法优化。这对于具有巨大指令缓存等的 PC 开发人员来说很好，但游戏机没有这种奢侈。即使他们这样做了，游戏开发社区几乎肯定宁愿将额外的周期/内存花费在游戏相关资源上，而不是将其浪费在我们没有的 C++ 功能上 如果 C++ 异常处理非常好，几乎没有或没有性能/内存成本，那么它将在每个程序中使用，甚至没有禁用它的选项。事实是，编写可靠的 PC 应用程序代码可能是一种整洁的方式，但对于游戏开发的要求来说是多余的。它会增加可执行文件的容量，消耗内存和/或性能，并且完全无法优化。这对于具有巨大指令缓存等的 PC 开发人员来说很好，但游戏机没有这种奢侈。即使他们这样做了，游戏开发社区几乎肯定宁愿将额外的周期/内存花费在游戏相关资源上，而不是将其浪费在我们没有的 C++ 功能上 如果 C++ 异常处理非常好，几乎没有或没有性能/内存成本，那么它将在每个程序中使用，甚至没有禁用它的选项。事实是，编写可靠的 PC 应用程序代码可能是一种整洁的方式，但对于游戏开发的要求来说是多余的。它会增加可执行文件的容量，消耗内存和/或性能，并且完全无法优化。这对于具有巨大指令缓存等的 PC 开发人员来说很好，但游戏机没有这种奢侈。即使他们这样做了，游戏开发社区几乎肯定宁愿将额外的周期/内存花费在游戏相关资源上，而不是将其浪费在我们没有的 C++ 功能上 事实是，编写可靠的 PC 应用程序代码可能是一种整洁的方式，但对于游戏开发的要求来说是多余的。它会增加可执行文件的容量，消耗内存和/或性能，并且完全无法优化。这对于具有巨大指令缓存等的 PC 开发人员来说很好，但游戏机没有这种奢侈。即使他们这样做了，游戏开发社区几乎肯定宁愿将额外的周期/内存花费在游戏相关资源上，而不是将其浪费在我们没有的 C++ 功能上 事实是，编写可靠的 PC 应用程序代码可能是一种整洁的方式，但对于游戏开发的要求来说是多余的。它会增加可执行文件的容量，消耗内存和/或性能，并且完全无法优化。这对于具有巨大指令缓存等的 PC 开发人员来说很好，但游戏机没有这种奢侈。即使他们这样做了，游戏开发社区几乎肯定宁愿将额外的周期/内存花费在游戏相关资源上，而不是将其浪费在我们没有的 C++ 功能上*需要*。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-01-09T07:53:35.640

其中一些是游戏民间传说，也许是针对非常有限的设备（例如移动设备）的游戏开发者传下来的口头禅，而游戏开发者则不是。

但是，关于游戏要记住的一点是，它们的性能特征主要由流畅和可预测的帧速率决定。它们不是任务关键型软件，但它们是“FPS 关键型”软件。帧速率的中断可能会导致玩家在动作游戏中结束游戏，例如，因此，尽管您可能会在任务关键型软件中发现一些健康水平的偏执狂，即不会失败，但您也可以在游戏中找到类似的东西关于不口吃和落后。

与我交谈过的许多游戏开发者甚至都不喜欢虚拟内存，而且我看到他们尝试应用一些方法来最小化在不方便的时间发生页面错误的可能性。在其他领域，人们可能喜欢虚拟内存，但游戏是“FPS-critical”的。他们不希望在游戏过程中的某个地方出现任何奇怪的打嗝或口吃。

因此，如果我们从异常开始，零成本 EH 的现代实现允许正常执行路径比在错误条件下执行手动分支时执行得更快。但它们的代价是抛出异常突然变得更加昂贵，“停止世界”的事件。这种“停止世界”的事情对于寻求最可预测和最流畅的帧速率的软件来说可能是灾难性的。当然，这应该只为真正特殊的路径保留，但游戏可能更愿意找到不面对特殊路径的理由，因为在游戏中间投掷的成本太高了。如果游戏一开始就强烈希望避免面对特殊的道路，那么优雅的恢复是一个没有实际意义的概念。

游戏通常具有这种“启动并开始”的特性，它们可以潜在地完成所有文件加载和内存分配，以及在加载关卡或启动游戏时可能会提前失败的事情，而不是做可能失败的事情在游戏中间。因此，它们不一定有那么多可能或应该遇到异常的去中心化代码路径，这也削弱了 EH 的好处，因为如果只有少数几个区域可以从中受益，它就不会变得那么方便它。

出于与 EH 类似的原因，游戏开发者通常不喜欢垃圾收集，因为它也可能有那种“停止世界”事件，这会导致不可预测的卡顿——在许多领域中可能很容易将其视为无害的最短暂的卡顿，但不是游戏开发者。因此，他们可能会直接避免它或寻求对象池，以防止 GC 收集在不合时宜的时间发生。

完全避免智能指针对我来说似乎有点极端，但是很多游戏可以提前预先分配内存，或者他们可能使用实体组件系统，其中每个组件类型都存储在一个允许它们被索引的随机访问序列中. 智能指针意味着堆分配和拥有单个对象粒度级别的内存的事物（至少除非您使用自定义分配器和自定义删除函数对象），并且大多数游戏可能会发现避免这种粒度堆分配符合他们的最大利益而是在一个大容器中或通过内存池一次分配许多东西。

这里可能有一些迷信，但我认为其中一些至少是有道理的。

# open-source - 你如何评价一个开源项目的主持人？

> ID：829662
> 
> 赞同：1
> 
> 时间：2009-05-06T13:49:21.747
> 
> 标签：open-source, project-hosting

我将创建我的第一个开源项目，并试图决定在哪里托管它 google code 或 codeplex。在我看来，codeplex 有一套更好的社区功能，谷歌代码有真正的 svn 和版本差异工具。决定在哪里托管项目的决定因素是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T14:05:54.530

对我来说，第一个功能是让我的代码进出存储库，这对于 google 代码甚至是 assembla 都非常容易（尽管我不了解最新的 assembla 使用条款）。Codeplex 倾向于 TFS，它很难使用，但你可以让它与 SVNBridge 和 tortoise 一起使用，这更容易。

一旦你解决了输入和输出代码的问题，它真的归结为个人喜好。

你想要一个维基吗？你想要一个问题跟踪器吗？您想要自动构建吗？您是否需要与第三方工具（如fogbugz 或trac）集成？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T18:37:13.130

对于[Task Coach](http://www.taskcoach.org)，我从[Sourceforge](http://sourceforge.net)和[Yahoo](http://groups.yahoo.com/)邮件列表组开始。当我们为 Task Coach 添加翻译时，我们也开始使用[Launchpad](http://launchpad.net)，因为它支持通过 Web 编辑翻译。我考虑将 Task Coach 完全转移到 Launchpad（我喜欢 Bazaar），但 Launchpad 不提供网站托管，而 Sourceforge 提供。此外，Sourceforge 目前还提供多种版本控制系统，包括 Bazaar。目前，我正在考虑使用[Uservoice](http://uservoice.com)来允许 Task Coach 用户为新功能投票。

我想这些是我一直/正在寻找的开源主机的功能：

1.  项目网站托管
2.  支持最终用户下载
3.  源代码版本控制
4.  错误/功能请求/支持请求跟踪器
5.  支持编辑翻译
6.  邮件列表

# internet-explorer - IE6 表单：在输入字段上禁用焦点？（IE8之后的多个IE）

> ID：829665
> 
> 赞同：3
> 
> 时间：2009-05-06T13:49:40.823
> 
> 标签：internet-explorer, internet-explorer-6

我最近安装了 IE8，并发现使用旧版本的 IE 来测试网站的怪癖。重新安装我使用的“多个 IE”后，我发现现在我无法专注于输入字段，无论是使用键盘还是鼠标。

我发现其他人经历过这种行为，但不是解决方案。这里有人有什么建议吗？

**编辑：**

“多个 IE 版本”是指[这个](http://tredosoft.com/Multiple_IE)包，最近，[这个](http://finalbuilds.edskes.net/iecollection.htm). 但我对两者都有同样的问题。我可以阅读“不再支持”的免责声明，但是，这仍然比虚拟化更容易且资源消耗更少。如果它起作用了，它直到几周前才起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T21:02:16.010

如果通过*重新安装我使用的“多个 IE”，*您指的是在同一个 Windows 实例上安装多个 Internet Explorer 副本，我会指出这是一种不受支持的配置，可能会导致各种问题，包括您的问题正在描述。

即使在同一个硬盘上双启动多个 Windows 实例也会出现问题，因为它们都写入 C:\Program Files\Internet Explorer。

解决方案是下载[Microsoft Virtual PC 2007 SP1](http://www.microsoft.com/downloads/details.aspx?familyid=28C97D22-6EB8-4A09-A7F7-F6C7A1F000B5&displaylang=en)（免费下载）。然后下载一个或多个[Internet Explorer Application Compatibility VPC Image](http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en)。在撰写本文时，XP 映像于 2009 年 8 月 31 日到期（Vista 映像在首次运行后 120 天到期），但微软一直在提供更新的映像，只要以前的映像过期了几年。就在今天，我发现即使在过期日期之后，XP 映像仍然一次可以工作一个小时，这应该为您提供足够的时间进行测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-21T22:18:53.420

最新版本的 Internet Explorer Collection 修复了表单选择不下拉的问题。

Internet Explorer Collection 1.5.0.0 中的新功能： - 修复了在安装 IE8 时无法在 IE5 到 IE7 的输入和文本区域字段中输入任何内容的错误

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T02:47:24.653

这对我有用。我在我的计算机中卸载 MultipleIEs 并转到 C:\Program Files\MultipleIEs\IE6 并打开 iexplore.exe 再次运行它。某些注册表值使输入无法选择。

# python - str.format() -> 如何左对齐

> ID：829667
> 
> 赞同：11
> 
> 时间：2009-05-06T13:49:46.520
> 
> 标签：python

```
>>> print 'there are {0:10} students and {1:10} teachers'.format(scnt, tcnt)
there are        100 students and         20 teachers 
```

将是什么代码使输出变为：

```
there are 100        students and 20         teachers 
```

谢谢。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-06T13:53:29.583

```
print 'there are {0:<10} students and {1:<10} teachers'.format(scnt, tcnt) 
```

旧`%`运算符`-`用于对齐，而新`format`方法使用`<`和`>`

# iphone - 如何在键盘上的工具栏中显示键值

> ID：829670
> 
> 赞同：1
> 
> 时间：2009-05-06T13:50:12.603
> 
> 标签：iphone, objective-c, cocoa-touch

我正在开发一个应用程序。因为我在键盘上有工具栏。但我希望当我按下键时，键值应该显示在工具栏文本字段中。所以如果有人知道请回复。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T19:12:29.440

您是否已将 UITextField 添加到您的 NIB 或视图中？这是显示键盘和输入文本的最佳方式。然后，您可以使用 UITextView 的 text 属性检索文本。

# c# - 如何在 Word 等多个页面中显示流文档？

> ID：829676
> 
> 赞同：2
> 
> 时间：2009-05-06T13:51:29.277
> 
> 标签：c#, wpf, richtextbox, flowdocument

我有一个非常类似于 MS Word 的项目，需要显示和编辑包含富文本的一系列页面，并希望在屏幕上以垂直堆叠和滚动以创建效果的多个富文本框控件中显示此内容文档流。

我也希望内容在控件之间自动流动并溢出到下一个控件等。

如果这是不可能的，还有其他方法吗？

# git - 哪些 DVCS 支持 Unicode 文件名？

> ID：829682
> 
> 赞同：23
> 
> 时间：2009-05-06T13:52:41.567
> 
> 标签：git, unicode, mercurial, dvcs, bazaar

我有兴趣尝试分布式版本控制系统。git 听起来很有希望，但我在某个地方看到了一个关于 git 的 Windows 端口的注释，上面写着“不要使用非 ASCII 文件名”。我现在找不到，但是有[这个链接](http://code.google.com/p/msysgit/issues/detail?id=230)。它现在让我离开了 git，但我不知道其他选项是否更好。

对我的日本公司来说，支持非 ASCII 文件名是必不可少的。我正在寻找一种在内部将文件名存储为 Unicode，而不是依赖于平台的编码，这种编码会导致无尽的悲伤。所以：

1.  哪些 DVCS 支持 Unicode 文件名？
2.  在 Windows 和 Linux 中？
3.  理想情况下，可以在 Windows 和 Linux 机器之间传输存储库而问题最少？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T14:56:07.047

请参阅[同一存储库中的问题 80](http://code.google.com/p/msysgit/issues/detail?id=80)。2009 年，在 Git 邮件列表（例如[1](http://marc.info/?l=git&m=123900382804705&w=2)、[2](http://marc.info/?l=git&m=123611400032040&w=2)）上进行了一次讨论，Git 维护者 Junio Hamano 就此提出了一些问题。我这里没有。通过以建设性的方式加入线程，您可能有助于解决问题。

在 Java 实现 JGit 中，我们在创建文本元数据和文件名时总是使用 UTF-8。这是唯一的方法，但有一些事情需要考虑。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-08-13T19:39:07.563

## 混帐

2009 年 8 月：

msysgit 项目正忙于修复 Windows 上对 Git 的 UTF-8 支持。它可能会在下一个版本中修复。

* * *

2012 年 2 月更新

UTF-8 即将出现在 msysgit 中，[提交类似“Update less settings for UTF-8”](https://github.com/msysgit/msysgit/commit/75a84f0c6863602a987dbc41cc969c67f9facfed)

从 Git for Windows Google+ 页面：

> Karsten Blees 的适用于 Windows 的 Git 的 UTF-8 补丁现已合并到“ `devel`”。
> 这意味着即将发布的版本将支持 Unicode 文件名！

* * *

2012 年 4 月更新

它现在在 mSysGit 1.7.10 中发布。

请参阅[Git for Windows Unicode Support](https://github.com/msysgit/msysgit/wiki/Git-for-Windows-Unicode-Support)页面。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-09T12:08:17.997

## 水银

在 Linux 上，我认为 Mercurial 只是以系统的编码方式进行编码（如果我错了，请纠正我）。因此最好将 Linux 设置为 UTF-8 以实现跨平台兼容性。这是许多现代发行版的默认设置。

在 Windows 上，Mercurial（由于 Python 的字节字符串处理）使用系统代码页。这几乎保证了非 ASCII 字符的不良跨平台互操作性。

### 适用于 Windows 的 fixutf8 扩展（Mercurial 2.0 之前）

有一个外部创建的 Mercurial 扩展名为[fixutf8](https://www.mercurial-scm.org/wiki/FixUtf8Extension) for Windows，它可以正确处理所有 Unicode 字符（即使是当前代码页之外的字符）并将文件名编码为 Mercurial 存储库中的 UTF-8。因此，只要 Linux 使用 UTF-8 编码，它就可以与 Linux 进行互操作。上周我尝试在我的 Windows 设置上启用它，但在安装时遇到了一些问题。从那时起，一个问题得到了解决。现在唯一的问题是二进制 Mercurial 发行版是使用 Python 2.4 构建的，而 fixutf8 需要使用 Python 2.5 或更高版本构建 Mercurial 才能加载 fixutf8。我预计这将在不久的将来得到解决。

### 适用于 Windows 的 Mercurial 2.0 及更高版本

[根据fixutf8](https://www.mercurial-scm.org/wiki/FixUtf8Extension)网页，fixutf8 似乎与 Mercurial 2.0 及更高版本不兼容。有关未来解决方案的详细信息，请参阅[WindowsUTF8Plan](https://www.mercurial-scm.org/wiki/WindowsUTF8Plan)。我不确定这预计何时实施。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-06T19:30:59.757

[Bazaar VCS](http://bazaar-vcs.org)在内部使用 unicode 文件名。它对 Linux 和 Windows 上的 unicode 都有很好的支持。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-04-27T11:57:29.157

Windows 1.7.10 上的 Git 现在使用 UTF-8 作为文件名，无论用户的语言环境如何。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-10-20T22:22:58.760

这是一个非常棘手的问题。问题的出现是因为工具在不确定编码时试图解释文件名，或者因为它们翻译但翻译成不能处理所有情况的形式（例如 ASCII 或 UTF-16）。三个主要操作系统都没有就文件名的编码方式达成一致，这使事情变得更加困难。

为了更好地理解这些问题，我建议阅读 Mercurial 的[编码策略](http://mercurial.selenic.com/wiki/EncodingStrategy)页面。它描述了各种平台如何变化，以及 Mercurial 选择其策略的原因。

如果您真的需要这样做，那么最基本的事情是**所有**系统都需要设置为使用 UTF-8 文件名，而不是众多日文代码页之一。虽然说起来容易做起来难，但是一旦完成，系统就不需要将文件名翻译成其他任何东西。

没有翻译，没有问题。

* * *

*：是的，我知道您可以使用默认系统编码，但这与文件系统编码不同。当一个文件系统被多个系统访问或在系统之间物理移动时会发生什么？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-21T05:50:55.427

根据[这个](http://en.wikipedia.org/wiki/Comparison_of_revision_control_software)页面：Bazaar、Codendi、CVSNT、Monotone、Perforce、Rational Team Concert、Subversion、Surround SCM、Synergy。但是该页面上有很多“未知数”。

# vb.net - VB.NET - 如何将 For Each 循环移至下一个项目？

> ID：829689
> 
> 赞同：99
> 
> 时间：2009-05-06T13:53:46.370
> 
> 标签：vb.net, loops

是否有类似的语句`Exit For`，除了它不退出循环而是移动到下一个项目。

**例如：**

```
For Each I As Item In Items

    If I = x Then 
        ' Move to next item
    End If

    ' Do something

Next 
```

我知道可以简单地`Else`在 If 语句中添加一个，因此它的内容如下：

```
For Each I As Item In Items

    If I = x Then 
        ' Move to next item
    Else
        ' Do something
    End If

Next 
```

只是想知道是否有办法跳转到`Items`列表中的下一个项目。我敢肯定大多数人会正确地问为什么不只使用该`Else`语句，但对我来说，包装“做某事”代码似乎不太可读。尤其是当有更多代码时。

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-05-06T13:56:06.317

```
For Each I As Item In Items
    If I = x Then Continue For

    ' Do something
Next 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-05-06T13:56:38.453

我会改用该`Continue`语句：

```
For Each I As Item In Items

    If I = x Then
        Continue For
    End If

    ' Do something

Next 
```

请注意，这与移动迭代器本身略有不同 -`If`将再次执行之前的任何内容。通常这是您想要的，但如果不是，您将不得不使用`GetEnumerator()`then `MoveNext()`/`Current`显式而不是使用`For Each`循环。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-06T13:57:03.520

关于什么：

```
If Not I = x Then

  ' Do something '

End If

' Move to next item ' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T13:59:16.090

**我想清楚以下代码不是好的做法。**您可以使用 GOTO 标签：

```
For Each I As Item In Items

    If I = x Then
       'Move to next item
        GOTO Label1
    End If

    ' Do something
    Label1:
Next 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-28T11:28:42.897

当我尝试`Continue For`失败时，出现编译器错误。在执行此操作时，我发现了“简历”：

```
For Each I As Item In Items

    If I = x Then
       'Move to next item
       Resume Next
    End If

    'Do something

Next 
```

注意：我在这里使用 VBA。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-21T14:21:55.507

只有“继续”是可接受的标准（其余导致“意大利面条代码”）。

至少对于“继续”，程序员知道代码直接进入循环的顶部。

不过，对于纯粹主义者来说，这样的事情是最好的，因为它是纯粹的“非意大利面”代码。

```
Dim bKeepGoing as Boolean 
For Each I As Item In Items
  bKeepGoing = True
  If I = x Then
    bKeepGoing = False
  End If
  if bKeepGoing then
    ' Do something
  endif
Next 
```

不过，为了便于编码，“继续”是可以的。（不过，评论它是个好主意）。

使用“继续”

```
For Each I As Item In Items
  If I = x Then
    Continue For   'skip back directly to top of loop
  End If
  ' Do something
Next 
```

# opengl - 将 OpenGL 渲染合并到一个视图中

> ID：829696
> 
> 赞同：1
> 
> 时间：2009-05-06T13:55:32.043
> 
> 标签：opengl

我有一个简单的实体建模应用程序，我想在其中实现几种“导航模式”，即用户通过 3d 空间导航相机的方式。其中之一是在 SketchUp、Blender 等中使用的无处不在的“拖动和平移/旋转”；我还想实现与我的特定应用程序更相关的东西。具体来说，我想实现一种模式，其中相机漂浮在被建模对象（建筑物）上方的“环”上，并始终注视模型的中心；这样，用户可以轻松地围绕对象“圈”，这是我的应用程序中的常见操作。

所以，我想做的是在我的视图中渲染建筑物，并在视图的右上角显示一个圆环，圆环上有一个小球体来表示相机位置。圆环中会有一个指北针，用户可以通过拖动球体来围绕模型对象拖动相机；移动球体将重新定位相机并重新绘制场景。

看起来我应该做的是：渲染“主视图”，即建筑物；然后将环面和球体（具有不同的透视设置和照明）渲染到屏幕外缓冲区，然后将其从那里传送到我的主视图。

然后我开始进行命中测试。我想检测用户是点击球体还是圆环；根据我对 OpenGL 拾取的理解（这似乎是一个很难的主题：/），所有拾取方法仅适用于在一个“场景”中进行选择。除此之外，很明显，我仍然想检测建筑模型中的“正常”拾取操作。

所以，我的问题：

*   如何渲染到屏幕外缓冲区并进入另一个 OpenGL 上下文（使用 alpha 混合和透明度，如圆环中心）？
*   如何在所描述的场景中进行命中测试？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:00:55.400

我认为您不需要为此进行屏幕外渲染。您应该能够在主场景之后重新设置相机和[视口并渲染叠加层。](http://www.opengl.org/sdk/docs/man/xhtml/glViewport.xml)您可能对 Z 排序和/或缓冲有疑问，但也许“子场景”足够简单，这无关紧要，或者您当然可以在渲染之前清除 Z 缓冲区。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T18:25:42.767

就绘制圆环/球体而言，为此创建一个单独的类并实现“绘制”方法。让类包含球体和圆环的位置，并让 draw() 在屏幕上渲染这些东西。

然后只需在您的主要绘图方法中调用 myRing.draw()，您将拥有一个球体和圆环！

如果您的意思是要在窗口的右上角以 2D 形式呈现一个圆/环（这可能更容易），那么与您的 hitbox 帖子中的想法相同（除非没有那个烦人的投影计算！ )

最后，我会考虑结合使用功能键和鼠标拖动来实现您想要的功能......例如，用户按住“shift”，然后在屏幕上单击并拖动鼠标。这些鼠标事件被捕获，x-delta 用于计算旋转角度。发生这种情况时会更新相机的位置，并且您会获得平滑的滑动动作:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T14:25:11.177

我同意@unwind；您不需要屏幕外缓冲区。无论如何，如果你想，搜索“render-to-texture”。

至于命中测试，[OpenGL FAQ](http://www.opengl.org/resources/faq/technical/selection.htm)上有一个条目。它描述了几种解决方案：使用 GL_SELECTION 渲染模式，使用 gluUnproject() 获得 3D 碰撞射线和使用独特颜色的简单 2D 解决方案。

# c# - 从应用程序中的任何位置访问文本框

> ID：829698
> 
> 赞同：2
> 
> 时间：2009-05-06T13:55:37.347
> 
> 标签：c#, winforms, textbox

如何在我的 winforms 应用程序中创建一个文本框，以从应用程序的任何位置接受新的文本行？

我有一个包含文本框的主表单。我想直接从另一个类中的方法向框中添加文本。

**更新**

我以我的主要形式尝试了这个：

```
public void Output(String value)
    {
        if (txtOutput.Text.Length > 0)
        {
            txtOutput.AppendText(Environment.NewLine);
        }
        txtOutput.AppendText(value);
    } 
```

但我不能从其他类调用输出。我是 C# 新手，所以也许我遗漏了一些明显的东西。

问候，米尔。

PS 是的，我知道这是一个糟糕的设计，但现在这似乎是做我想做的最好的方式。文本框的功能类似于控制台。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T13:58:08.933

您需要将 的`Text`属性公开`TextBox`为表单上的`string`属性。例如...

```
public string TextBoxText
{
    get { return textBoxName.Text; }
    set { textBoxName.Text = value; }
} 
```

**编辑**

阅读问题编辑后，您的问题是无论您尝试执行该代码，都需要对表单的特定实例的引用。您可以传递一个引用（这是更好的选择），或者您可以使用一些臭代码并拥有一个引用表单的一个实例的静态属性。就像是...

```
public partial class MyForm : Form
{
    private static MyForm instance;

    public static MyForm Instance
    {
        get { return instance; }
    }

    public MyForm() : base()
    {
        InitializeComponent();

        // ....

        instance = this;
    }
} 
```

使用这种方法，您可以调用`MyForm.Instance.Output("test");`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T14:13:13.343

为了进一步解耦，您可以稍微反转控制：

```
// interface for exposing append method
public interface IAppend
{
    void AppendText(string text);
}

// some class that can use the IAppend interface
public class SomeOtherClass
{
    private IAppend _appendTarget = null;

    public SomeOtherClass(IAppend appendTarget)
    {
        _appendTarget = appendTarget;
    }

    private void AppendText(string text)
    {
        if (_appendTarget != null)
        {
            _appendTarget.AppendText(text);
        }
    }

    public void MethodThatWillWantToAppendText()
    {
        // do some stuff
        this.AppendText("I will add this.");
    }

}

// implementation of IAppend in the form
void IAppend.AppendText(string text)
{
    textBox1.AppendText(text);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T14:12:31.673

看起来您的设计有点损坏。您不应该让业务逻辑与 GUI 控件混淆。为什么不尝试返回值并在接口端分配它呢？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:16:04.647

这是一种非常糟糕的做法，但只是为了确保所有答案都在那里......

在 VS 设计器中，每个表单控件在“属性”窗口中都有一个项目，名称`Modifiers`默认为`Private`. 将此更改为其他设置之一，例如`Internal`或`Public`，将允许您从表单外部访问它。

我必须强调，这是最糟糕的做法。

# c++ - C++ new[] 在数组访问时进入基类指针崩溃

> ID：829700
> 
> 赞同：3
> 
> 时间：2009-05-06T13:56:05.193
> 
> 标签：c++, arrays, inheritance, polymorphism

当我分配一个对象时，这段代码可以正常工作。当我尝试添加数组语法时，它会出现段错误。为什么是这样？我的目标是向外界隐藏 c 类在内部使用 b 对象的事实。我已将程序发布到[键盘上供](http://codepad.org/DLzw3XQt)您使用。

```
#include <iostream>

using namespace std;

// file 1

class a
{
    public:
        virtual void m() { }
        virtual ~a() { }
};

// file 2

class b : public a
{
    int x;

    public:
        void m() { cout << "b!\n"; }
};

// file 3

class c : public a
{
    a *s;

    public:
        // PROBLEMATIC SECTION
        c() { s = new b[10]; } // s = new b;
        void m() { for(int i = 0; i < 10; i++) s[i].m(); } // s->m();
        ~c() { delete[] s; } // delete s;
        // END PROBLEMATIC SECTION
};

// file 4

int main(void)
{
    c o;

    o.m();

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T14:07:40.830

`b`创建一个 10的数组，`new`然后将其地址分配给 an`a*`只是自找麻烦。

**不要多态地处理数组。**

如需更多信息，请参阅[**ARR39-CPP。不要以多态方式处理数组**](https://www.securecoding.cert.org/confluence/display/cplusplus/ARR39-CPP.+Do+not+treat+arrays+polymorphically)，在第06 节。CERT [C++ 安全编码标准](https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=637)的[数组和 STL (ARR)](https://www.securecoding.cert.org/confluence/display/cplusplus/06.+Arrays+and+the+STL+%28ARR%29)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-06T14:36:55.657

一个问题是表达式`s[i]`使用指针算法来计算所需对象的地址。由于`s`被定义为指向 的指针`a`，因此结果对于 s 数组是正确的，`a`而对于 s 数组是不正确`b`的。继承提供的动态绑定只适用于方法，没有其他（例如，没有虚拟数据成员，没有虚拟`sizeof`）。因此，当调用该方法时`s[i].m()`，`this`指针被设置为数组中的`i`第 th 个`a`对象。但由于实际上该数组是其中之一`b`s，它最终（有时）指向一个对象中间的某个地方，你得到一个段错误（可能是当程序试图访问对象的 vtable 时）。您也许可以通过虚拟化和重载来纠正问题`operator[]()`。（不过，我没有仔细考虑它是否真的有效。）

另一个问题是`delete`在析构函数中，出于类似的原因。您也可以虚拟化和重载它。（再一次，我脑子里突然冒出一个随机的想法。可能行不通。）

当然，铸造（如其他人所建议的那样）也可以。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T14:07:59.500

您有一个“b”类型的数组，而不是“a”类型的数组，并且您将其分配给 a 类型的指针。多态性不会转移到动态数组。

```
 a* s 
```

到一个

```
 b* s 
```

你会看到这开始工作了。

只有尚未绑定的**指针**才能被多态处理。想想看

```
 a* s = new B(); // works
 //a* is a holder for an address

 a* s = new B[10]
 //a* is a holder for an address
 //at that address are a contiguos block of 10 B objects like so
 // [B0][B2]...[B10] (memory layout) 
```

当您使用 s 遍历数组时，请考虑使用了什么

```
 s[i]
 //s[i] uses the ith B object from memory. Its of type B. It has no polymorphism. 
 // Thats why you use the . notation to call m() not the -> notation 
```

在转换为刚刚拥有的数组之前

```
 a* s = new B();
 s->m(); 
```

这里的 s 只是一个地址，它不是像 s[i] 这样的静态对象。只是地址仍然可以动态绑定。s 是什么？谁知道？地址 s 上的东西。

请参阅下面的**Ari**的出色答案，以获取有关为什么这在 C 样式数组的布局方式方面也没有意义的更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T15:30:22.750

根据您的回答，我已经找到了解决方法。它允许我使用间接层隐藏实现细节。它还允许我混合和匹配数组中的对象。谢谢！

```
#include <iostream>

using namespace std;

// file 1

class a
{
    public:
        virtual void m() { }
        virtual ~a() { }
};

// file 2

class b : public a
{
    int x;

    public:
        void m() { cout << "b!\n"; }
};

// file 3

class c : public a
{
    a **s;

    public:
        // PROBLEMATIC SECTION
        c() { s = new a* [10]; for(int i = 0; i < 10; i++) s[i] = new b(); }
        void m() { for(int i = 0; i < 10; i++) s[i]->m(); }
        ~c() { for(int i = 0; i < 10; i++) delete s[i]; delete[] s; }
        // END PROBLEMATIC SECTION
};

// file 4

int main(void)
{
    c o;

    o.m();

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T14:38:24.763

B 的每个实例都包含 X 数据成员和“vptr”（指向虚拟表的指针）。

A 的每个实例仅包含“vptr”

因此，sizeof(a) != sizeof(b)。

现在，当您执行此操作：“S = new b[10]”时，您将内存中的 10 个 b 实例放在 a raw 中，S（其类型为 a*）正在获取原始数据的开头。

在 C::m() 方法中，您告诉编译器迭代“a”数组（因为 s 具有 a* 的类型），**但是**，s 实际上指向“b”数组。因此，当您调用 s[i] 时，编译器实际上所做的是 "s + i * sizeof(a)" ，编译器以 "a" 为单位而不是 "b" 为单位跳转，因为 a 和 b 没有同样大小，你会得到很多mambojumbo。

# c# - 在 VB、C# 中使用 Linq 处理匿名类型

> ID：829705
> 
> 赞同：1
> 
> 时间：2009-05-06T13:56:24.227
> 
> 标签：c#, vb.net, linq, types, set

假设我创建了两组元组，如下所示：

```
 Dim losSPResults As List(Of spGetDataResults) = m_dcDataClasses.spGetData.ToList
    Dim loTupleKeys = From t In losSPResults Select t.key1, t.key2

    '' Query on an existing dataset:
    Dim loTupleExistingKeys = from t in m_losSPResults Select t.key3, t.key4 
```

现在我想对这两个列表执行集合操作，如下所示：

```
 Dim loTupleSetDifference = loTupleKeys.Except(loTupleExistingKeys) 
```

显然，如果 Linq 不知道集合具有统一的定义，它就不能对集合执行比较器，所以它会给我这个构建错误：

> Option Strict On 禁止从“System.Collections.Generic.IEnumerable(Of <anonymous type>)”到“System.Collections.Generic.IEnumerable(Of <anonymous type>)”的隐式转换。

我如何处理这些集合的声明以使它们网格化？（谷歌运气不佳）

[编辑] 仍然得到相同的编译错误：

```
 '*** If we have initialized the list of tools, check to make sure it's up to date
    Dim loTupleDatabaseTools = From tt In lottTorqueTools _
                               Select StationIndex = tt.station_index, SlotNumber = tt.slot_number
    Dim loTupleToolObjects = From tt In m_lottTorqueTools _
                             Select StationIndex = tt.StationIndex, SlotNumber = tt.SlotNumber

    Dim loTupleSetDifference = loTupleDatabaseTools.Except(loTupleToolObjects) 
```

错误在这里：

暗淡 loTupleSetDifference = loTupleDatabaseTools.Except( **loTupleToolObjects** )

> 错误 5 Option Strict On 不允许从“System.Collections.Generic.IEnumerable(Of <anonymous type>)”到“System.Collections.Generic.IEnumerable(Of <anonymous type>)”的隐式转换。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T14:00:54.497

如果匿名类型以相同的顺序具有相同的属性名称和相同的类型，则它们应该是相同的类型（因此是兼容的）。

编辑：根据评论和更新的问题，我怀疑您缺少的一点是能够以匿名类型命名属性。改变这个：

```
Dim loTupleExistingKeys = from t in m_losSPResults Select t.key3, t.key4 
```

进入这个：

```
Dim loTupleExistingKeys = from t in m_losSPResults Select key1=t.key3, key2=t.key4 
```

只要类型正确，您就可以不用再工作了。

# .net - 使用 PDFsharp 打开 AES 128 位加密文件

> ID：829707
> 
> 赞同：1
> 
> 时间：2009-05-06T13:57:01.463
> 
> 标签：.net, vb.net, pdf

我一直在接收使用 PDFsharp 库处理的 pdf 文件。这些文件使用 128 位 RC4 加密。现在我得到了 128 位 AES 加密的文件。

我收到此异常“PDF 文档受 PDFsharp 不支持的加密保护。”

只是不支持 AES，还是我需要更改打开文件的方法？

```
 Using InDoc As PdfDocument = PdfReader.Open(InputFileName, Password, PdfDocumentOpenMode.Import)
            Using OutDoc As PdfDocument = New PdfDocument
                For Each page As PdfPage In InDoc.Pages
                    OutDoc.AddPage(page)
                Next
            End Using
  End Using 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T08:23:22.007

PDFsharp 尚不支持 Adob​​e 7+ 的 AES。

# git - 如何使用 git 插入提交？

> ID：829715
> 
> 赞同：8
> 
> 时间：2009-05-06T13:58:03.520
> 
> 标签：git

我需要在我的 git 存储库的主分支中插入一个提交，同时保留后续的合并和提交。

我目前有这样的东西

```
A--B--C--D--E--F     master
       \     \  
        G--H  I--J   branches 
```

并且需要插入一个提交 K 使得新结构变为

```
A--B--K              master
    \
     C--D--E--F      new branch
      \     \  
       G--H  I--J    old branches 
```

我什至不确定这是否可能。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T16:25:00.547

```
git checkout master
git branch new_branch # copy current branch master to new_branch
git reset --hard B    # now master points to B
(hack, hack, hack)
git commit -m K       # K on B in master 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T14:06:22.127

将“master”分支重命名为“new branch”。然后签出提交 B，从那里启动一个名为“master”的新分支，然后进行更改。像下面这样的东西应该这样做（未经测试）。

```
git branch -m master new_branch
git branch master B
git checkout master 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T15:25:12.547

```
# git checkout -b new-master B 
```

现在对 K 进行更改，提交它们，瞧，这就是你想要的结构。:)

# sql-server - 如何将表转储到 SQL Server 中的文本文件？在 SQL Server 2005 中

> ID：829720
> 
> 赞同：2
> 
> 时间：2009-05-06T13:58:45.280
> 
> 标签：sql-server, export

如何将表格导出到文本文件？

我需要获取现有表的 INSERT 脚本（结构和数据）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T14:11:59.600

在 SQL2k 中，尝试阅读有关批量复制的信息，我认为命令应该是**bcp**

MS帮助文件中的示例类似于...

将数据从表导出到文本文件

```
bcp "SELECT au_fname, au_lname FROM pubs..authors ORDER BY au_lname" queryout Authors.txt -c -Sservername -Usa -Ppassword 
```

将数据从文本文件导入表：

将数据从 Newpubs.dat 批量复制到 publishers2 的命令是：

```
bcp pubs..publishers2 in newpubs.dat -c -t , -r \n -Sservername -Usa -Ppassword 
```

或者，您可以使用查询工具（例如 SQL 查询分析器）中的 BULK INSERT 语句来批量复制数据：

```
BULK INSERT pubs..publishers2 FROM 'c:\newpubs.dat'
WITH (
   DATAFILETYPE = 'char',
   FIELDTERMINATOR = ',',
   ROWTERMINATOR = '\n'
) 
```

加思

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T16:04:36.693

在 SQL Server 2005 Management Studio 中，您可以使用导入/导出向导（不确定您是否特别需要脚本，或者只是一种将结构/数据导出到文件的方法，但此建议无需实际脚本即可完成） ：

*   右键单击包含该表的数据库
*   选择任务->导出数据
*   选择数据源屏幕：（在欢迎屏幕之后）保留默认值，单击下一步
*   选择一个目标：目标字段的“平面文件目标”。然后根据需要填写文件名/路径和其他选项，单击下一步
*   选择复制数据...，单击下一步
*   选择要导出的表，点击下一步
*   在 Save and Execute Package 屏幕上，您可以选择 Execute Immediately，或者如果您想将生成的“脚本”保存为 SSIS 包，您也可以选择该选项。单击下一步，然后单击完成，执行导出

*   您生成的文件将包含表格的内容。如果您随后需要将此数据“插入”到不同的数据库中，您可以使用向导的“导入数据”选项将数据从文本文件导入到其他数据库/表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:08:53.913

尝试这个：

[http://vyaskn.tripod.com/code.htm#inserts](http://vyaskn.tripod.com/code.htm#inserts)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T15:11:16.213

您可以通过从 information_schema 中获取列信息以编程方式构建**INSERT语句，其中每行数据描述一列：**

```
SELECT   table_name, 
         ordinal_position, 
         column_name, 
         data_type, 
         is_nullable, 
         character_maximum_length 
FROM     information_schema.columns 
WHERE    table_name LIKE '%TableName%' 
ORDER BY ordinal_position 
```

对于导出数据，BCP 是工具，BOL 有几个不错的例子：

`bcp AdventureWorks.Sales.Currency out Currency.dat -T -c`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-06T14:09:19.903

[您可以像这样](http://sqltips.wordpress.com/category/insert-script-generator/)运行插入脚本生成器

[或此链接](https://github.com/sytelus/SQLUtils)之类的桌面工具

# visual-studio - 什么是文件类型 .COMPILED

> ID：829721
> 
> 赞同：2
> 
> 时间：2009-05-06T13:58:50.320
> 
> 标签：visual-studio, msbuild

当您发布网站时，您会获得 .compiled 类型的 xml 文件。它包含例如：

```
<?xml version="1.0" encoding="utf-8"?>
<preserve resultType="6" virtualPath="/App_Code/" hash="ffffffffc89f22d3" filehash="" flags="140000" assembly="App_Code" /> 
```

这些文件是干什么用的？应该将它们部署到服务器吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T14:11:08.200

根据[MSDN 文章](http://msdn.microsoft.com/en-us/library/e22s60h9%28VS.85%29.aspx)：

> 对于 ASP.NET Web 应用程序中的可执行文件，编译器程序集和具有 .compiled 文件扩展名的文件。程序集名称由编译器生成。.compiled 文件不包含可执行代码。相反，它只包含 ASP.NET 查找适当程序集所需的信息。

部署预编译的应用程序后，ASP.NET 使用 Bin 文件夹中的程序集来处理请求。预编译输出包括 .aspx 或 .asmx 文件作为页面的占位符。占位符文件不包含代码。它们的存在只是为了提供一种为特定页面请求调用 ASP.NET 的方法，以便可以设置文件权限以限制对页面的访问。

# version-control - 我们应该使用什么源代码控制

> ID：829725
> 
> 赞同：6
> 
> 时间：2009-05-06T13:59:46.667
> 
> 标签：version-control

我正在寻找一个好的源代码控制解决方案。以下是要求：

1.  必须有 GUI 或有可用的 GUI 插件。
2.  必须是免费的。
3.  必须使用 HTTP。

你会选择什么源代码控制？

**背景**

我们的 .Net 开发团队隶属于一家大型母公司。我们正在收购 VS Team System，但是大公司的官僚机构行动缓慢，我们可能需要几个月的时间才能启动并运行 Team System 服务器。与此同时，我们有一个大型项目将外包给印度的供应商。过去，我们团队的流程是这样的：1）指定需求，2）让印度团队创建解决方案，3）一个月后从供应商那里收到解决方案。

我们正在寻找一种更规范的方法，Team System 是我们的长期解决方案，但是我想现在就使用一些东西而不是什么都不用。

以下是我的一些想法：

1.  由于稳定性问题，Source Safe 是不可行的。
2.  易用性比高级功能更重要，比如分支，我真的非常希望它使用 GUI 而不是命令行。
3.  HTTP 访问是必须的，因为开发团队将是远程的。

**到目前为止，作为反馈的后续信息的附加信息**

我们需要一个免费的解决方案，不是因为我们买不起，而是因为公司的企业采购政策会延迟获得它。免费使我们可以随时安装。我想如果它足够便宜，我可以自掏腰包，但它必须相当便宜。

**最终的**

遗憾的是，我们最终没有使用任何建议。我们最终确实获得了 TFS 许可证，但是我们预计要到明年才能获得使用该服务器的许可。在此期间，离岸团队将 zip 文件上传到 ftp 服务器。哎呀！为什么很难说服大公司使用非标准解决方案（例如 GIT）而不是等待数月（或数年），因为他们犹豫不决地试图决定是否购买（在这种情况下是 TFS）值得。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-06T14:01:35.133

我推荐[Subversion](http://subversion.tigris.org/)和[TortoiseSVN](http://tortoisesvn.tigris.org/)。甚至 Subversion 的[文档](http://svnbook.red-bean.com/)也是免费的。

编辑添加：我还强烈推荐[VisualSVN Server](http://www.visualsvn.com/server/)来设置您的 SVN 存储库。设置很简单，而且非常顺利，我不得不去看看它叫什么，因为自从最初的设置以来，我一次都没有碰过它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-06T14:01:27.927

考虑一个分布式系统：[darcs](http://darcs.net/)、[git](http://git-scm.com/)或[mercurial](http://www.selenic.com/mercurial/wiki/)。他们都有自己的追随者，但在操作上他们非常相似。darcs 可能需要很长时间才能构建，因为它是用 Haskell 编写的，并且您最终需要先构建 Haskell。Mercurial 是基于 python 的，易于破解和扩展。当然 git 是用于 Linux 的，非常广泛可用，有很多工具。

[我认为Subversion](http://subversion.tigris.org/)几乎是现代 SCM 的基线。这也是一个不错的选择，但它确实迫使您拥有固定的中央服务器；无论是您还是您的印度同事，都必须检查并提交一个长管道。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T14:17:07.310

Subversion (SVN) 显然是一种流行的选择。它现在也很常用（Google Code、Sourceforge 等），所以应该有很多关于它的使用的文档。Git 也是一个不错的选择，但缺乏可用的 GUI 界面使其不能很好地满足您的要求。

我假设由于您使用的是 .NET，因此您主要是在 Windows 环境中进行开发。查看 VisualSVN 产品。他们制作了一个很棒的（免费）服务器产品，用于在 Windows 环境中实际运行完整的 svn 服务器（它支持 SSL、组/用户身份验证，包括 Active Directory 支持）。

他们还提供了一个 Visual Studio 插件，虽然它不是免费的（尽管 49 美元/开发者相当合理）。AnkhSvn 是另一个 Visual Studio 客户端插件选项。它不是那么好，但它是免费的。

[http://www.visualsvn.com/server/](http://www.visualsvn.com/server/) - 免费的 Windows SVN 服务器

[http://www.visualsvn.com/visualsvn/](http://www.visualsvn.com/visualsvn/) - Visual Studio 客户端插件

[http://ankhsvn.open.collab.net/](http://ankhsvn.open.collab.net/) - 免费的 Visual Studio 客户端插件

因此，我认为使用 VisualSVN 产品的 Subversion 将以非常合理的价格为您提供最好的 windows/gui 集成。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T14:22:19.840

根据我的经验，SVN 在 HTTP 上的表现非常糟糕。如果您的回购规模很大，尤其是其中塞满了跨大西洋往返行程，您将需要拔掉头发。就我个人而言，我会选择 Mercurial。

谷歌最近对 Git 与 Mercurial进行了一些[研究。](http://code.google.com/p/support/wiki/DVCSAnalysis "研究")Mercurial 最大的优势是它与 HTTP 配合得非常好。

TortoiseHg 虽然不如 TortoiseSVN 成熟，但它是一个非常可靠的 Windows GUI。尽管您提到您对分支和合并不是很感兴趣，但这些是所有 DVCS 中的常见活动。幸运的是，因为它们很常见，所以它们在 UI 和总体上相对轻松的活动中得到了很好的支持。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T14:06:07.523

~~Team Foundation Server 非常易于使用，并且从源代码安全的背景（共享命令的通用术语）开始很容易上手。然而，由于部分开发在印度，他们可能对 Subversion 更加了解。~~

如果您使用 Subversion，我会查看[VisualSVN](http://visualsvn.com/)。它非常棒，使用简单，设置迅速（TFS 设置起来有点复杂）。VisualSVN 提供了一个 IDE 插件（50 美元）和一个用于引导 Windows 机器的 Subversion 的服务器对应物（免费）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T14:06:33.763

查看 Subversion：[http ://subversion.tigris.org/](http://subversion.tigris.org/)

有 GUI 插件以及 VS .NET。[http://tortoisesvn.tigris.org/](http://tortoisesvn.tigris.org/) [http://ankhsvn.open.collab.net/](http://ankhsvn.open.collab.net/)

所有开源和免费。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-06T14:08:55.367

我的建议是[Subversion](http://subversion.tigris.org/) + [TortoiseSVN](http://tortoisesvn.tigris.org/)（用于 Explorer 集成）+ [AnkhSVN](http://ankhsvn.open.collab.net/)（与 Visual Studio 集成）。

我认为您不应该使用任何分布式版本控制系统，因为之后您将不得不回到集中式版本控制系统，这可能会很痛苦。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T14:09:54.880

如前所述，SVN 和 Tortoise 是要走的路。

我还获得了视觉 SVN ( [http://www.visualsvn.com/](http://www.visualsvn.com/) ) 的许可证，它不是免费的，但它非常好，它使用 Tortoise svn 并在 IDE 中为您提供它的功能。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-06T15:12:51.890

Mercurial 很棒而且非常简单。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-06T15:49:10.727

给 Mercurial 一个机会。[BitBucket](http://bitbucket.org)有免费帐户，您可以随意使用。我已经写了更多关于为什么我[在这里](https://stackoverflow.com/questions/26845/do-you-use-distributed-version-control/27033#27033)使用它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-06T14:01:31.733

您是否尝试过[SVN](http://subversion.tigris.org/)并使用[TortoiseSVN](http://tortoisesvn.tigris.org/)进行 Shell 扩展？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-06T14:06:20.847

我第二个 SVN 和 TortoiseSVN。

我从 CVS 和 WinCVS 迁移过来，我对这个设置非常满意。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-06T14:07:31.267

我会推荐你​​的大多数团队成员最有经验的源代码控制，或者你的团队中有专家的地方。

在我看来，除了无休止的“git 比 Subversion 比 CVS 更好”的讨论之外，我认为它们之间的差异并不重要。

拥有一个真正知道如何使用您决定使用的系统的人更为重要。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-06T14:12:04.390

为 .Net 开发设置 Subversion 变得更加容易。您可以从[安装 Visual SVN Server](http://www.visualsvn.com/server/)开始。这将在 Windows 机器上安装 Subversion Server，将帮助您设置存储库、身份验证等。

然后对于 Visual Studio 与 Subversion 的集成，您可以尝试[VisualSVN](http://www.visualsvn.com/visualsvn/)，它不是免费的，但非常值得获得许可。但如果你的预算不允许，[Ankhsvn](http://ankhsvn.open.collab.net/)也可以，我每天都用。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-06T14:14:15.010

几个月前，我不得不做出类似的决定。我非常喜欢 SVN，但缺乏用于管理的 GUI 对我的团队来说是一个大问题。TFS 是理想的，但非常昂贵。

我们决定半途而废并获得[SourceGear Vault](http://www.sourcegear.com/vault)的许可。不幸的是，它不符合您对“免费”的要求。虽然我确实发现它[与 SVN 的比较](http://www.sourcegear.com/vault/vs/subversion/)很有趣。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-06T14:33:50.407

如果您确定要使用 Team System，那么我相信您可以使用 180 天试用版。这样，你儿子就不用换了。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-05-06T15:07:25.460

您是否尝试过 unfuddle ( [http://unfuddle.com/](http://unfuddle.com/) )。满足您的所有要求。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-05-06T15:28:13.460

SVN 的另一票。
对于 Windows 上的轻量级 SVN 服务器，请查看[sliksvn](http://www.sliksvn.com/en/download/)。它不进行 http 源浏览，但比基于 apache 的小型服务器设置更小、更容易。

# ruby-on-rails - 突出显示菜单中的选项卡

> ID：829727
> 
> 赞同：16
> 
> 时间：2009-05-06T14:00:05.947
> 
> 标签：ruby-on-rails

我有一个 ul 菜单

```
Home | Calendar | Settings 
```

我想突出显示（通过 css 类）菜单中的选定选项卡。

一些链接（主页和日历）也有子选择

```
Home | *Calendar* | Settings 
------------------------- 
Add event | Edit event 
```

Ofcourse when edit event is selected, Calendar should still be highlighted.

我怎样才能最好地使用rails和css来解决这个问题？

谢谢

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-05-06T15:11:55.620

最简单的方法是检查正在使用哪个控制器。我编写了控制器名称，因此您当然可以用正确的名称替换“home”、“calendar”和“settings”。

```
<ul>
  <li class="<%= "highlighted" if params[:controller] == "home" %>">Home</li>
  <li class="<%= "highlighted" if params[:controller] == "calendar" %>">Calendar</li>
  <li class="<%= "highlighted" if params[:controller] == "settings" %>">Settings</li>
</ul> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-03-06T19:38:29.110

在您的帮助文件中：

```
def is_active?(page_name)
  "active" if params[:action] == page_name
end 
```

在模板文件中：

```
link_to 'Home', '/', :class => is_active?("index")
link_to 'About', '/about', :class => is_active?("about")
link_to 'contact', '/contact', :class => is_active?("contact") 
```

我发现这个：http: [//juliocapote.com/post/52081481/highlight-link-based-on-current-page-in-rails](http://juliocapote.com/post/52081481/highlight-link-based-on-current-page-in-rails)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-10-11T12:28:41.210

我选择了这个我非常喜欢的解决方案：

在帮手

```
def active_if(options)
  if params.merge(options) == params
    'nav-active'
  end
end 
```

并在视图中定义使路线独一无二的原因：

```
<%= link_to 'Home', root_path, class: active_if(action: 'home') %>
<%= link_to 'Aricles', articles_path, class: active_if(controller: 'articles') %> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-14T07:42:23.467

我有同样的问题，最终创建了助手。基本上它替换了 link_to url 帮助程序，因此它用 li 包装链接，如果当前控制器与链接控制器匹配，则添加类“menu_selected”

使用示例

```
<%= menu_link_to "Home", home_path %> 
```

```
 def menu_link_to(*args, &block)
  url = args[1]
  mapping =  ActionController::Routing::Routes.recognize_path(url)   

  class_property = "menu_selected" if mapping[:controller] == controller.controller_path
  content_tag :li, :class => class_property do
    link_to *args, &block
  end
end 

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-09T05:20:23.453

更新@ahmy 对 Rails 3.2 的回答：

```
def menu_list_item(*args, &block)
  url = args[1]
  mapping =  Rails.application.routes.recognize_path(url)   

  li_class = 'active' if mapping[:controller] == controller.controller_path
  content_tag :li, :class => li_class do
    link_to *args, &block
  end
end 
```

即`Rails.application.routes.recognize_path`代替`ActionController::Routing::Routes.recognize_path`.

# sharepoint - SharePoint 2007 日历 - 删除时间

> ID：829730
> 
> 赞同：2
> 
> 时间：2009-05-06T14:00:53.810
> 
> 标签：sharepoint, calendar, sharepoint-designer

有谁知道如何从 SharePoint 2007 日历月视图中删除时间？

我可以使用一些 jQuery 来做到这一点，但想知道是否可以通过配置来实现？

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:14:20.250

试试[这篇](http://www.dlocc.com/sharepoint-main-menu/customization-category/63-sharepoint-calendars-remove-the-time-for-calendar-items.html)关于自定义 SharePoint 2007 日历视图的文章。

# c# - 自定义类中 Linq to SQL 的 DeleteOnNull（关联属性）？

> ID：829745
> 
> 赞同：4
> 
> 时间：2009-05-06T14:02:30.780
> 
> 标签：c#, linq, linq-to-sql

是否可以在自定义类上添加“DeleteOnNull=true”而不是直接修改 DBML（生成）类？

例如，假设这是我生成的 dbml 类的一部分：

```
[Table(Name="OrderDetails")]
public partial class OrderDetail : 
       INotifyPropertyChanging, INotifyPropertyChanged
{
    // deleted for brevity

    [Association(Name="Order_OrderDetail", 
         Storage="_Order", ThisKey="OrderId", 
         OtherKey="OrderId", IsForeignKey=true, DeleteOnNull=true)]
    public Order Order 
    {
        get { /* deleted */ }
        set { /* deleted */ }
    }
} 
```

那么是否可以将“DeleteOnNull = true”放在单独的类上？是吗？如何？我尝试了以下方法，但没有任何运气：

```
[MetadataType(typeof(OrderDetailMetadata))]
public partial class OrderDetail {
    internal sealed class OrderDetailMetadata
    {
        [Association(DeleteOnNull = true)]
        public object Order;
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T11:45:23.367

也许您不需要 MetaData 类型。这是否适用于您的附加部分：

```
public partial class OrderDetail {
    [Association(DeleteOnNull = true)]
    public Order Order;
} 
```

..我知道它本身`Order`没有定义，但你不应该像那样构建。[此 MSDN 文档](http://msdn.microsoft.com/en-us/library/wa80x488.aspx)建议上述内容应该是可能的（如果我没有正确阅读）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-20T00:36:43.390

迟到总比不到好：

如果您一直在使用 Designer 创建您的 LTS 配置和实体，您可以右键单击 DBML 文件，然后选择“打开方式...”。现在选择 XML Editor 并单击 OK。

在此文件中找到您的`Order_OrderDetail`关联，然后添加`DeleteOnNull="true"`到其中。保存文件并让 LTS 为您重新生成类。完毕！不再需要再次覆盖您对生成的代码文件的更改！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:10:59.710

我将构建程序集，然后使用[反射器](http://reflector.red-gate.com/download.aspx)对类进行示例，以查看它是否具有从部分类中设置的属性属性。如果这甚至不起作用，那么您可能需要尝试其他方法。可能不支持这种类型的属性重叠。

你想通过这个实现什么？

# eclipse - 设置环境变量启动 mac eclipse

> ID：829749
> 
> 赞同：30
> 
> 时间：2009-05-06T14:03:31.463
> 
> 标签：eclipse, macos, environment-variables

我的公司提供了一个基于 Eclipse 的开发环境，它需要为底层工具链设置一些环境变量，以便可以同时安装多个版本而不接管系统。

我想在 finder 或 Dock 中提供一个图标来设置这些然后启动 Eclipse，这样客户就不会在没有设置环境的情况下意外启动 Eclipse。这是我到目前为止所尝试的：

1.  在 Info.plist 中为 Eclipse 设置环境：

    这应该是一个不错的方法，但我无法将其添加到现有路径（如 export PATH=/myapp/bin:$PATH）。

2.  bash 脚本包装 eclipse：

    我创建了一个名为 eclipse.command 的 bash 脚本来设置环境，然后启动 eclipse。这将打开一个终端窗口以及 Eclipse 图标，并允许人们“保持停靠”以查看裸月食。我不能将 eclipse.command 放在扩展坞上，因为它不是应用程序。

3.  Applescript 包装 eclipse.command：

    围绕 eclipse.command 的 Applescript 包装器使它看起来像一个应用程序并防止出现终端窗口。不幸的是，我现在得到了一个用于applescript 的dock 图标和一个用于eclipse 的图标，因此仍然可以将裸露的eclipse 保留在dock 上。

有什么建议么？我会以完全错误的方式解决这个问题吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-07-25T18:52:58.367

当用户启动 Eclipse 应用程序时，有一个替代解决方案涉及使用设置环境的 shell 包装器替换 MacOS X 运行的可执行文件。

在 Eclipse 应用程序包目录 /Applications/eclipse/Eclipse.app/Contents/MacOS 中创建一个名为“eclipse.sh”的空文本文件。

在文本编辑器中打开 eclipse.sh 并输入以下内容：

```
#!/bin/sh

export ENV_VAR1=value
export ENV_VAR2=value

logger "`dirname \"$0\"`/eclipse"

exec "`dirname \"$0\"`/eclipse" $@ 
```

在示例中 ENV_VAR1 和 ENV_VAR2 是正在设置的环境变量。这些变量将对从 Eclipse 中启动的进程可见。logger 命令只会将 eclipse 可执行文件的路径记录到 system.log 作为调试帮助。

在终端设置shell脚本eclipse.sh的可执行标志，即：

```
chmod +x /Applications/eclipse/Eclipse.app/Contents/MacOS/eclipse.sh 
```

打开 Eclipse.app Info.plist 并将键 CFBundleExecutable 的值从 eclipse 更改为 eclipse.sh。

MacOS X 不会自动检测 Eclipse.app 的 Info.plist 已更改。因此，您需要使用 lsregister 命令强制更新终端中的 LaunchService 数据库：

```
/System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -v -f /Applications/eclipse/Eclipse.app 
```

下次您从 Dock 或 Finder 启动 Eclipse.app 时，应该设置环境变量。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-07-20T18:09:16.637

我创建了以下内容：

别名 start-eclipse='打开 /Applications/eclipse/Eclipse.app'

如果你从命令行运行 start-eclipse，所有的环境变量都会被选中。这样，您只需要在命令行和 eclipse 环境中维护一组 env var。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-06T14:16:08.687

看看一个相关的问题：[Mac OS X 中的环境变量](https://stackoverflow.com/questions/603785/environment-variables-in-mac-os-x)。

基本上，这涉及到`~/.MacOSX/environment.plist`文件的创建。

注销并登录 environment.plist 以被 .App 获取

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-03-19T00:44:59.843

这在 OS X Yosemite 中完美运行：

1.  打开 /Applications/Automator。
2.  当下拉菜单出现询问您要创建什么样的文档时，选择“应用程序”。
3.  在左数第二个列表中，双击“运行 Shell 脚本”。
4.  在右侧删除自动放在那里的“猫”，并将其替换为：

    ```
    source ~/.bash_profile && /Applications/eclipse/Eclipse.app/Contents/MacOS/eclipse 
    ```

现在转到 File->Save，并将应用程序保存到您的 Applications 目录。我将它命名为“Eclipse”，大写字母“E”，以免与我已经拥有的“eclipse”目录冲突。为了更好地衡量，您甚至可以通过选择真正的 eclipse 应用程序，按 command-i，选择图标，按 command-c，然后选择自动机“Eclipse”应用程序，按 command-i，选择图标来给它 Eclipse 图标，然后按命令-v。

现在您可以打开该应用程序，甚至可以将其拖到您的 Dock 上。请注意，如果您启动它，“真正的”日食仍将作为单独的图标显示在您的 Dock 中，但您不能拥有一切。:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-10T05:46:00.210

sakra 上面的答案很棒，除了它不会自动继承您现有的 bash 环境。为确保 eclipse.sh 选择您现有的 bash 环境，请修改 eclipse.sh 以使用 bash 而不是 sh 并添加一行来获取您现有的 ~/.bash_profile 因此：

```
#!/bin/bash
source ~/.bash_profile
logger "`dirname \"$0\"`/eclipse"
exec "`dirname \"$0\"`/eclipse" $@ 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-05-08T04:55:04.533

以上都不适合我。您必须将 Eclipse -> Preferences -> Terminal -> Arguments 设置为 --login 这将指示 Eclipse 在打开终端后使用您的帐户登录。

看截图：

[![在此处输入图像描述](https://i.stack.imgur.com/eAe0q.png)](https://i.stack.imgur.com/eAe0q.png)

参考：[https ://marketplace.eclipse.org/comment/4259#comment-4259](https://marketplace.eclipse.org/comment/4259#comment-4259)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-08-12T19:48:27.497

指向 Eclipse 的链接[不使用 .bashrc 中设置的路径](https://stackoverflow.com/questions/18099272/eclipse-doesnt-use-the-path-set-in-bashrc/18195507#18195507)

1.  创建简单脚本

> ```
> #!/bin/bash
> source /home/user/.environment_variables
> /home/user/eclipse_cpp/eclipse -Duser.name="My Name" 
> ```

2.接下来将所有系统变量放入文件/home/user/.environment_variables（您想要的任何文件）

我的样子：

```
export COCOS_ROOT=/home/user/Projects/edukoala
export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64/ 
```

3\. 现在你可以删除 .bashrc 中的变量并放行

```
source /home/user/.environment_variables 
```

一切正常:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-03-29T11:06:21.650

[正如https://github.com/atom/atom/issues/7045](https://github.com/atom/atom/issues/7045)中指出的那样，环境变量可以自动加载，无需显式`source ~/.bash_profile`使用

```
#!/usr/bin/env bash -l 
```

代替

```
#!/bin/bash
source ~/.bash_profile 
```

之后，在这两种情况下，都遵循

```
exec "`dirname \"$0\"`/eclipse" $@ 
```

它对我很有用，感谢所有以前的工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-24T16:57:22.770

在 .bash_profile 中设置环境变量后。只需通过终端打开应用程序！

```
open /Application/{path/to/app}.app 
```

# sql-server - 如何让我的 SQL DB 与我的领域驱动设计相匹配

> ID：829761
> 
> 赞同：2
> 
> 时间：2009-05-06T14:06:21.423
> 
> 标签：sql-server, model-view-controller, entity-framework, domain-driven-design

好的，我会直截了当地告诉你们：我不确定我的设计到底是如何领域驱动的，但我确实从构建模型对象开始，完全忽略了持久层。现在我很难确定在 SQL Server 中构建表以匹配模型的最佳方法。

我正在用 ASP.NET MVC 构建一个 Web 应用程序，尽管我认为平台并不那么重要。我有以下对象模型层次结构：

```
属性- 具有地址和邮政编码等属性

 有一个或多个

Case - 从 PropertyObject
继承Quote - 从 PropertyObject 继承

 有一个或多个

Message - 具有 Reference、Text 和 SentDate 属性的简单类

```

Case 和 Quote 有很多相似的属性，所以我也有一个 PropertyObject 抽象基类，它们继承自。所以 Property 有一个 List 类型的 Items 属性，它可以包含 Case 和 Quote 对象。

所以本质上，我可以拥有一个包含一些引用和案例的属性以及可以属于其中任何一个的消息负载。

PropertyObject 具有 Reference 属性（因此 Quote 和 Case 也是如此），因此任何 Message 对象都可以通过其 Reference 属性与 Quote OR Case 相关联。

我正在考虑使用实体框架来让我的模型进出数据库。

我最初的想法是有四个表：Property、Case、Quote 和 Message。

它们都有自己的顺序 ID，并且 Case 和 Quote 将通过 PropertyID 字段与 Property 相关联。

我能想到的将 Message 表关联回 Case 和 Quote 表的唯一方法是同时拥有 RelationID 和 RelationType 字段，但是没有明显的方法可以告诉 SQL Server 这种关系是如何工作的，所以我不会有任何参照完整性。

有什么想法、建议、帮助吗？

谢谢，安东尼

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T14:20:51.750

啊……抽象。

DDD 的诀窍是认识到抽象并不总是你的朋友。在某些情况下，过多的抽象会导致关系模型过于复杂。

你并不总是需要继承。事实上，继承的主要目的是重用代码。重用结构可能很重要，但不那么重要。

您有一个突出的 is-a 关系：`Case`IS-A`Property`和`Quote`IS-A `Property`。

您有几种方法来实现类层次结构和“is-a”关系。

1.  正如您建议使用类型鉴别器来显示这确实是哪个子类。当您经常需要生成各种子类的联合时，这很有效。如果您需要所有属性—— CaseProperty 和 QuoteProperty 的联合，那么这可以解决。

2.  您不必依赖继承；您可以为每组关系设置不相交的表。 `CaseProperty`和`QuoteProperty`。您必须`CaseMessage`并且`QuoteMessage`还必须遵循区别。

3.  您可以在一个公用表中拥有共同特征，在一个单独的表中分离特征，并进行连接以重建单个对象。因此，您可能有一个`Property`表，其中包含所有属性的共同特征，以及`CaseProperty`每个`QuoteProperty`子类的独特特征`Property`。这类似于您提议的内容`Case`并`Quote`具有`Property`.

4.  您可以将多态类层次结构展平为单个表并使用类型鉴别器和 NULL。主表具有和`Property`的类型鉴别器。对于应该是 a 的行， 的属性为空。同样，对于应该是 a 的行的属性为空。`Case``Quote``Case``Quote``Quote``Case`

您的问题“[如何] 将 Message 表关联回 Case 和 Quote 表”源于一组多态子类。在这种情况下，最好的解决方案可能是这个。

`Message`具有对 的 FK 引用`Property`。

`Property`有一个类型鉴别器可以`Quote`与`Case`. 和`Quote`类`Case`定义都映射到`Property`，但依赖于类型鉴别器和（通常）不同的列集。

关键是 和 的责任属于该类层次结构，`Property`而`CaseProperty`不是。`QuoteProperty``Message`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T15:56:13.797

我假设 Property 也不继承自 PropertyObject。

鉴于这些表，Property、Case、Quote 和 Message，导致每个具体类或 TPC 继承策略的表，我通常不推荐。

我的建议是您使用以下任一方法：

*   每个层次结构或 TPH 的表 - Case 和 Quote 存储在同一个表中，其中一个列用作鉴别器，不共享的属性具有可为空的列。
*   每个类型或 TPT 的表 - 添加带有共享字段的 PropertyObject 表以及仅带有这些类型的额外字段的 Case 和 Quote 表

这两种策略都可以让您保持参照完整性，并得到大多数 ORM 的支持。

更多信息请参见： [技巧 12 - 如何选择继承策略](http://blogs.msdn.com/alexj/archive/2009/04/15/tip-12-choosing-an-inheritance-strategy.aspx)

希望这有助于亚历克斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T16:08:39.523

这就是服务的 DDD 概念的用武之地。每个具体类的存储库只保留该实体，而不是相关对象。

所以你有 Property()，并且是你的 CaseProperty() 的基础：Property()。这个特殊实体通过 CasePropertyService() 访问。在这里，您可以对相关表执行 JOIN 等操作，以生成您的 CaseProperty() 特殊实体（这实际上不是 Case() 和 Property 本身，而是组合）。

OT：由于.net 的限制，你不能继承多个类，这是我的工作。DDD 旨在作为对您的领域的整体理解的指导。我经常把我的 DDD 大纲给朋友，让他们试着弄清楚它的作用/代表什么。如果它看起来很干净并且他们弄清楚了，它就是干净的。如果你的朋友看着它说：“我不知道你在这里坚持什么。” 然后回到绘图板上。

But, there's a catch about using any ORM to persist storage of DDD objects (linq, EntityFramework, etc). Have a look at my answer over here:

[Stackoverflow: Question about Repositories and their Save methods for domain objects](https://stackoverflow.com/questions/672836/question-about-repositories-and-their-save-methods-for-domain-objects/675416#675416)

The catch is all objects must have an identity in the database for ORM. So, this helps you plan your DB structure.

I have recently moved away from using ORM to control direct access, and just have a clean DDD layer. I let my repositories and services control access to the DB layer, and use Velocity to entity-cache my objects. This actually works very well for: 1) DB performance, you design however is most efficient not being coupled to your DOmain objects with direct ORM representation, and 2) your domain model becomes much cleaner with no forced identies on Value Objects and such. Free!

# validation - 可搜索的 PDF 文件（图像+文本 PDF）验证

> ID：829765
> 
> 赞同：2
> 
> 时间：2009-05-06T14:06:47.757
> 
> 标签：validation, pdf

如果我可以从 PDF 的每一页中获取任何文本，我正在检查 PDF 文档是否可搜索。

但是，当我尝试从包含超过 500~2000 页的 PDF 中提取文本时，检查每一页似乎需要很长时间。

PDF 是否可以包含一页的文本但不包含其余部分？我在这里要做的是，如果 PDF 的*第一页*包含文本，那么它是可搜索的 PDF，否则不是..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-09T02:06:49.390

是的，PDF 很可能在一页上包含文本，但其余部分不包含。您很可能拥有一个 500 页的 PDF，其中前 499 页包含图像，但最后一页包含文本。

除非您想自己打开 PDF 文件并对其进行扫描以进行文本/文本操作，否则您将需要使用现有的第三方 PDF 库，该库允许您从 PDF 中提取文本。

另外，请参阅 Ferruccio 对相关[问题](https://stackoverflow.com/questions/46869/whats-a-good-method-for-extracting-text-from-a-pdf-using-c-or-classic-asp-vbsc)的回复，即使用 IFilter 接口，专门用于搜索索引和文本提取。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:11:39.227

试试这个版本的[Searcharoo](http://www.codeproject.com/KB/IP/Searcharoo_4.aspx)，它可以让您搜索 Word 和 PDF 文档。

# c# - Silverlight 的拖放控制

> ID：829768
> 
> 赞同：4
> 
> 时间：2009-05-06T14:07:26.943
> 
> 标签：c#, silverlight, drag-and-drop

最近我需要向 Silverlight 应用程序添加拖放功能。谁能推荐一个好的拖放控件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:08:40.747

这是迄今为止我找到的最好的链接：http: [//nickssoftwareblog.com/2008/10/07/silverlight-20-in-examples-part-drag-and-drop-inside-out/](http://nickssoftwareblog.com/2008/10/07/silverlight-20-in-examples-part-drag-and-drop-inside-out/)

该代码可从博客文章下载，但您必须将其重命名为 .zip： http: [//nickssoftwareblog.files.wordpress.com/2008/10/genericdragdropzip.doc](http://nickssoftwareblog.files.wordpress.com/2008/10/genericdragdropzip.doc)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T14:10:40.713

我创建了一个我认为效果很好的拖放控制器。我使用这种技术已经有一段时间了，我对它非常满意。

[http://houseofbilz.com/archive/2009/02/10/drag-and-drop-with-silverlight.aspx](http://houseofbilz.com/archive/2009/02/10/drag-and-drop-with-silverlight.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T13:48:02.370

你可以试试[Blacklight](http://blacklight.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=17382) Controls，它有一个非常简洁的拖拽面板控件。这是一个博客[链接，描述了它是如何工作的。](http://blogs.msdn.com/mgrayson/archive/2008/08/29/silverlight-2-samples-dragging-docking-expanding-panels-part-3.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-12-01T14:48:24.620

我推荐使用[Silverlight Toolkit](http://silverlight.codeplex.com/)在同一应用程序中拖放元素。

它已经针对 Silverlight 5 进行了更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-18T00:55:33.503

我猜你现在已经找到了解决方案。但这是我编写并正在使用的解决方案，它非常灵活且易于使用：[http ://sl4dragdrop.codeplex.com/](http://sl4dragdrop.codeplex.com/)

它在 SL5 上运行得非常好，您所要做的就是在要启用拖放的项目或项目控件上添加依赖属性。

默认情况下，这就足够了。但是，如果您想自定义拖放的部分内容，它为您提供了实现接口，可以控制诸如要拖动的元素、要拖动的元素、拖动时要显示的图像等内容。

我最近对其进行了一些改进，并在进行更多测试后不久将发布更新。

# stored-procedures - .NET RDLC 和多个参数不起作用

> ID：829769
> 
> 赞同：0
> 
> 时间：2009-05-06T14:07:27.833
> 
> 标签：stored-procedures, rdlc

我有一个报告，它从几个文本框中获取两个参数，当传递给存储过程时，这些参数总是最终为空。这是代码。此外，我单步执行了代码，传入的参数具有值，但是在传入参数到执行 proc 之间，它变为空。

```
 protected void btnSearch_Click(object sender, EventArgs e)
        {
            pnlRecords.Visible = true;

            ReportParameter p1 = new ReportParameter("DateStart", ReportDates1.DateStart);
            ReportParameter p2 = new ReportParameter("DateEnd", ReportDates1.DateEnd);

            this.ReportViewer1.LocalReport.SetParameters(new ReportParameter[] { p1, p2 });
            this.ReportViewer1.LocalReport.Refresh();
        } 
```

你怎么看？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T17:25:51.950

我想到了。这是我在 .cs 文件中缺少的内容

```
ObjectDataSource1.SelectParameters[0].DefaultValue = ReportDates1.DateStart;
ObjectDataSource1.SelectParameters[1].DefaultValue = ReportDates1.DateEnd;
ObjectDataSource1.DataBind(); 
```

# c# - Azure：它适用于我的应用程序吗？

> ID：829774
> 
> 赞同：1
> 
> 时间：2009-05-06T14:07:54.120
> 
> 标签：c#, sockets, azure, cloud, gogrid

我正在创建一个要放入云中的应用程序。这个应用程序有一个主要功能。

它代表其他用户托管套接字 CLIENT 会话（想想 iPhone 的 Beejive IM，它为客户端托管 IM 会话以维护这些 IM 网络上的状态，允许客户端随意连接/断开连接，而不会中断 IM 网络连接）。

现在，我现在计划的方式是，一个“工作实例”可能只能处理有限数量的客户端会话（为了争论，假设为 50,000）。这些会话将是非常长期的工作任务。

我试图解决的问题是我有时需要对特定的客户端会话执行任务（例如：如果我需要断开客户端会话）。使用 Azure，我是否能够排队一个较小的任务，只有托管该特定客户端会话的实例才能出列？

现在我正在考虑将 GoGrid 作为我的提供商，我通过使用 Apache 的 Active Messaging Queue 软件解决了这个问题。我的 Web 应用程序将分配给特定实例 ID 的“断开连接”任务排入队列。因此，每个客户端会话都分配给特定的实例 ID。然后，该实例仅将分配给它的“断开连接”任务出列。

我想知道在 Azure 上做类似的事情是否可行，以及我通常会如何做。我喜欢不必设置许多不同的 VM 来扩展的想法，而只需部署一个包。此外，最好使用 Azure 的队列而不是集成第三方产品，例如 Apache ActiveMQ 甚至 MSMQ。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T17:03:38.707

在功能集、定价和许可条款最终确定之前，我会非常担心在 Azure 上构建生产应用程序。对于初学者，您甚至无法在它与例如 GoGrid 或 EC2 或 Mosso 之间进行成本比较。所以我不明白它怎么可能最终成为领跑者。此外，我们知道所有这些系统在成熟时都会出现故障。亚马逊的服务比其他任何服务都更广泛地使用，并且已经公开提供了很多年。恕我直言，选择 Azure 是他们稳定下来的痛苦的秘诀。

你考虑过亚马逊的[简单排队服务](http://aws.amazon.com/sqs/)吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T16:54:09.540

我认为您绝对可以为此使用 Windows Azure。我的建议是为您正在跟踪的每个会话创建一个队列。然后将该会话的队列中的断开连接消息（例如）排入队列。处理该连接的工作实例应该是唯一一个轮询该队列的实例，因此它应该处理在该连接上执行任务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T22:36:33.367

关于客户端连接的应用程序托管套接字连接，我会仔细检查允许的内容，因为我认为 Azure 只允许建立 HTTP 和 HTTPS 连接。

# opengl - 在 3d 视图中实现操纵手柄的方法

> ID：829786
> 
> 赞同：3
> 
> 时间：2009-05-06T14:10:23.147
> 
> 标签：opengl, 3d

我正在构建一个简单的实体建模应用程序。用户需要能够在正交视图和透视视图中操作对象。例如，当屏幕中有一个框并且用户单击它以选择它时，它需要在角落和中心获取“手柄”，以便用户可以将鼠标移动到这样的手柄上并将其拖动到放大或移动框。

有什么策略可以做到这一点，哪一个是最好的？我可以想到两个明显的：

1) 将手柄视为 3d 对象。即对于一个盒子，将小盒子添加到“主”盒子角落的场景中。问题：这在透视图中不起作用，我需要确定相对于当前缩放级别的框的大小（无论用户放大/缩小多远，手柄都需要具有相同的大小）

2) 渲染场景后添加手柄。渲染到屏幕外缓冲区，以某种方式确定角的 2d 位置并使用常规 2d 绘图技术来绘制手柄。问题：我将如何进行命中测试？我还需要做一个两阶段的命中测试方法；如何在 3d 渲染图像上绘制 2d？回退到 GDI？

这两种方法可能存在更多问题。是否有解决此问题的行业标准方法？

我正在使用 OpenGL，如果这有所作为。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T15:33:35.800

我会将手柄视为 3D 对象。这提供了许多优点 - 它更一致，它们表现良好，命中测试很容易等。

如果您希望手柄的大小恒定，您仍然可以将它们视为 3D 对象，但您必须根据与相机的距离适当缩放它们的大小。这有点麻烦，但由于通常只有几个句柄，而且这些通常是小对象，所以在性能方面应该很好。

但是，我实际上会说让手柄随场景缩放。只要您为句柄选择一种使它们突出的渲染样式（即：亮橙色框等），透视效果（背景中的较小句柄）实际上在许多方面使最终用户更容易使用它们. 很难从 3D 场景中获得深度感 - 手柄上的透视效果有助于提供更多关于手柄在屏幕中“深度”的视觉线索。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-25T15:21:37.137

我知道这个问题真的很老了。但以防万一有人需要它：

[三维场景中的交互技术（第 1 部分）：使用 OpenGL 2.1 使用鼠标移动 3D 对象](http://www.codeproject.com/KB/openGL/TranslationController.aspx)

文章很好，底部有一个有趣的链接部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T18:05:26.123

首先，将手柄/角坐标投影到相机的平面上（有效地将它们转换为屏幕上的 2D 坐标；根据屏幕尺寸对其进行标准化。）

下面是一些启用正交/二维叠加绘图的简单代码：

```
void enable2D()
{

    glMatrixMode(GL_PROJECTION);
    glPushMatrix();
    glLoadIdentity();
    int wind[4];
    glGetIntegerv(GL_VIEWPORT,wind);
    glOrtho(0,wind[2],0,wind[3],-1,1);
    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();
    glLoadIdentity();
}

void disable2D()
{
    glMatrixMode(GL_PROJECTION);
    glPopMatrix();
    glMatrixMode(GL_MODELVIEW);
    glPopMatrix();
} 
```

enable2D() 缓存当前的模型视图/投影矩阵，并用一个标准化到屏幕（即屏幕的宽度/高度）的投影矩阵替换投影矩阵，并恢复模型视图的单位矩阵。

进行此调用后，您可以使用屏幕/像素坐标进行 glVertex2f() 调用，从而可以进行 2D 绘图！（这也将允许您进行命中测试，因为您可以轻松获取鼠标的当前像素坐标。）

完成后，调用 disable2D 恢复旧的模型视图/投影矩阵 :)

最难的部分是计算 hitboxes 在 2D 平面上的位置并处理覆盖（如果两个项目到同一个地方，点击时选择哪个？）

希望这有帮助:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T19:03:08.090

我已经为 3d 编辑包编写了一个带有手柄的操纵器，并且遇到了很多相同的问题。

首先，有一个开源操纵器。我在最近的搜索中找不到它，可能是因为这些东西的名称过多 - 3d 小部件、小玩意儿、操纵器、万向节等。

无论如何，我这样做的方式是在场景中添加一个操纵器对象，在绘制时，它会绘制所有手柄。它对边界框计算和选择做同样的事情。

Reed 关于保持它们大小相同的想法对于存在于对象上的句柄很有趣，并且可能在那里起作用。对于一个操纵器，我发现它更像是一个 3d UI 元素，如果它不改变大小，它会更有用。我有一个错误，其中大小仅根据活动视口确定，这导致其他视口中出现可怕的巨大/微小操纵器，非常无用。如果要将它们添加到场景中，您可能希望按视口添加它们，或者使它们实际上具有固定大小。

# uml - 如何将 UML 1.3 - XMI 1.1 格式的文档转换为 UML 2.1 XMI？

> ID：829791
> 
> 赞同：3
> 
> 时间：2009-05-06T14:11:21.787
> 
> 标签：uml, xmi, powerdesigner

我正在尝试将从 PowerDesigner 以 UML 1.3 - XMI 1.1 格式导出的文件转换为来自 Rational Software Architect 的 UML 2.1 XMI 交换模型。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-09-29T12:00:44.067

值得尝试使用基于 Web的[XMI 文件转换器。](http://www.baptisteautin.com/projets-personnels/php_uml/convertisseur-de-fichier-xmi/lang/en/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T23:05:56.447

如果 RSA 不会导入 XMI 1.1，那么您需要找到另一个可以导入的工具。Sparx Systems 的 Enterprise Architect 可以导入 XMI 1.1 并可以编写 XMI 2.1。您可以从他们的网站[http://www.sparxsystems.com](http://www.sparxsystems.com)获得 30 天免费试用。尽管 XMI 有不同的方言，但请注意，因此您可能需要尝试各种工具，看看哪一种效果最好。祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-10T00:39:09.150

我发现 XMI v1.3 从 Power Designer v10 导出的模型（如果我不记得不好的话，v12 也一样）不会导出任何 UML 图（阅读：类、活动、用例图），所以没有任何转换可以解决那么问题来了，因为根本没有关于图表的数据。

关于 Power Designer 新版本、更新、修复、补丁的任何线索？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-03T06:17:31.223

XMI 虽然是一个标准，但并不是跨工具统一实现的。Altova UModel 是最接近 XMI 标准的东西。但是，它的成本很高，因此您可以使用[EA](http://www.sparxsystems.com) 它使您可以导入不同版本的 XMI，也可以将 XMI 导入不同的版本，但您的一些数据可能会丢失。

从 XMI 1.3 转换到 XMI 2.1 的最佳方法实际上是通过 XSLT 进行转换，因为 XMI1.3 和 XMI2.1 都只是 XML 格式。

# c# - 向 C# 公开 Borland C++ 方法

> ID：829792
> 
> 赞同：0
> 
> 时间：2009-05-06T14:11:22.707
> 
> 标签：c#, c++, .net, c++builder

我的 Borland C++ 代码中有以下方法，

```
static bool UploadBitstream(void)
{
   //Some code Implementation
} 
```

我正在尝试将其转换为 DLL 并在 C# 中访问它。

**转换代码 DLL 然后在 C# 中使用它**需要遵循哪些步骤？****

 *** * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:33:24.977

首先，您必须确保方法是在外部定义的。然后你需要声明方法stdcall或pascal调用约定，并将它们标记为dllexport。请参阅下面的代码清单（这对我来说是古老的记忆，如果我对现代 Borland C++ 编译器有点不理解，请见谅）。

```
// code.h
extern "C" {

#define FUNCTION __declspec(dllexport)

FUNCTION int __stdcall   SomeFunction(int Value); 
```

在主要

```
#include "code.h"

FUNCTION int __stdcall SomeFunction(int timesThree)
{
    return timesThree * 3;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T23:29:17.513

注意你的术语。
在您的示例中 UploadBitstream 是函数而不是方法。
如果它确实是类中的方法，那么很难使用 Borland 编译的 DLL 中的类。

如果您的代码实际上是 C 而不是 C++，您应该能够使用 C++ Builder 为您的简单 C 风格函数创建兼容的 DLL。

请参阅以下 SO 问题： [Use a dll from a c++ program。（borland c++ builder 和一般](https://stackoverflow.com/questions/367926/use-a-dll-from-a-c-program-borland-c-builder-and-in-general/370538#370538) 情况下）我列出了各种编译器设置，这些设置也适用于创建兼容的 DLL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T14:21:47.737

编译完 DLL 后，在 .NET 中访问它所需要做的就是使用 DLLImport 属性。

```
public class stuff
{
    [DLLImport("somedll.dll")]
    public static extern void UploadBitstream();
} 
```

如果您需要指针或类似的东西，它会变得更加复杂，但对于 void 函数，它就是这么简单。

应该注意的是，一旦您调用该函数，该 dll 将由您的程序加载，并且在您的程序关闭之前不会被释放。您可以动态加载 dll，但这要复杂得多。如果您有需要，我可以在这里解释。

# c# - 休眠获取和加载

> ID：829793
> 
> 赞同：1
> 
> 时间：2009-05-06T14:11:27.153
> 
> 标签：c#, nhibernate

我正在使用 NHibernate 修复代码库，我发现他们使用查询而不是使用 Get 或 Load 按 ID 查找实体。

喜欢 ：

> `session.CreateCriteria(typeof(T)).Add(Expression.AllEq(propertyNameValues)).List<T>();`

其中 propertyNameValues 是一个包含“ID”和 id 值的 IDictionnary。

尝试将其替换为：

> `session.Get<T>(id);`

Nhibernate 为我的班级抛出了 No Persister。

但显然有一个第一种方法有效，我的 google-fu 只找到人们忘记将给定的 hbm 设置为嵌入式资源或 nhibernate 配置中的映射程序集的链接。

我试过 Get(id) , Get(typeof(T),id), Get("ClassName",id) 都抛出同样的错误。

这是所要求的映射（谢谢）

```
<class name="Domain.Customers.Customer, Domain" table="Customer" lazy ="true">
    <id name="ID" column="id" access="field.lowercase-underscore" type="int">
        <generator class="identity" />
    </id> 
```

这是一个类的映射，但它对我所有的实体都是通用的。

感谢您的任何指示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T14:32:56.197

“ID”是否映射为对象的身份属性？正如马克所说，我们需要查看映射才能给出更好的答案。

# sharepoint - 是否可以在 SharePoint 环境中使用 ELMAH？

> ID：829796
> 
> 赞同：10
> 
> 时间：2009-05-06T14:12:03.783
> 
> 标签：sharepoint, moss, elmah

有没有人将[ELMAH](http://code.google.com/p/elmah/)集成到他们的 SharePoint 环境中？

我想这是可能的，因为它都是 ASP.net，但我只是想知道是否有人做过，是否有关于如何实现它的演练？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-28T18:26:52.313

在设置 ELMAH 或 Sharepoint 中的大多数 HTTPModules 时，重要的一件事是它们需要位于 httpModules 部分的开头。否则，SharePoint 将基本上吞下异常并且不会调用 ELMAH 功能

**作品**

```
<clear />
<add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah"/>  
<add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah"/>
<add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah"/>
<add name="SPRequest" type="Microsoft.SharePoint.ApplicationRuntime.SPRequestModule, Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" />
<add name="OutputCache" type="System.Web.Caching.OutputCacheModule" />
<add name="FormsAuthentication" type="System.Web.Security.FormsAuthenticationModule" />
     ... Rest of SharePoint modules.... 
```

**不工作**

```
<clear />
<add name="SPRequest" type="Microsoft.SharePoint.ApplicationRuntime.SPRequestModule, Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" />
<add name="OutputCache" type="System.Web.Caching.OutputCacheModule" />
<add name="FormsAuthentication" type="System.Web.Security.FormsAuthenticationModule" />
     ... Rest of SharePoint modules....
<add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah"/>  
<add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah"/>
<add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah"/> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-06T14:16:56.530

我们在 MOSS 2007 环境中使用 ELMAH。由于 ELMAH 使用 HttpHandlers 并且是通过 web.config 设置的，因此激活它很容易。只需将 ELMAH 内容添加到您在 SharePoint 中运行的应用程序的 web.config 即可。

如果您希望 ELMAH 报告比您的自定义应用程序更高级别的错误，请将其添加到 SharePoint web.config。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T14:13:49.847

它没有魔法，只需像在任何其他 ASP.NET 站点上一样连接它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-02T19:59:15.807

以下是需要在 SharePoint Web 应用程序的 web.config 中添加的配置条目

在配置部分下添加

```
 <configSections>
    <sectionGroup name="elmah">

    <section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah" />

    <section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah" />

    <section name="errorMail" requirePermission="false" type="Elmah.ErrorMailSectionHandler, Elmah" />

    <section name="errorFilter" requirePermission="false" type="Elmah.ErrorFilterSectionHandler, Elmah" />

    </sectionGroup>
 </configSections> 
```

添加连接字符串部分

```
<connectionStrings>
 <add name="elmah-express" connectionString="Data Source=[server name];Initial Catalog=  [ELMAH_customlogging];User ID=testuser;Password=Welcome1;" />

</connectionStrings> 
```

在连接字符串部分下方添加 elmah 部分

```
<elmah>

  <security allowRemoteAccess="0" />

  <errorLog type="Elmah.SqlErrorLog, Elmah" connectionStringName="elmah-express" />
</elmah> 
```

在 system.web 下的 httphandlers 和 httpmodules 部分添加处理程序和模块条目

```
 <httpHandlers>

      <add verb="POST,GET,HEAD" path="elmah.axd" type="Elmah.ErrorLogPageFactory, Elmah"/>

   </httpHandlers>

   <httpModules>

      <add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah"/>
    </httpModules> 
```

在 system.webserver 下的处理程序和模块部分添加处理程序和模块条目

```
 <modules runAllManagedModulesForAllRequests="true">

    <remove name="ErrorLog"/>

     <add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" preCondition="managedHandler" />

     <add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" preCondition="managedHandler" />

     <add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" preCondition="managedHandler" />

     <add name="ErrorTweet" type="Elmah.ErrorTweetModule, Elmah" preCondition="managedHandler" />
     </modules>

     <handlers>

     <add name="Elmah" path="elmah.axd" verb="POST,GET,HEAD" type="Elmah.ErrorLogPageFactory, Elmah" preCondition="integratedMode" />

     </handlers> 
```

请参阅以下链接以了解 sharepoint 中的 elmah 实施

[http://sidteche.blogspot.in/2014/08/implement-elmah-custom-logging-in.html](http://sidteche.blogspot.in/2014/08/implement-elmah-custom-logging-in.html)

# sql - Oracle 的解释计划的准确性如何？

> ID：829805
> 
> 赞同：4
> 
> 时间：2009-05-06T14:14:26.897
> 
> 标签：sql, oracle, oracle10g, sql-execution-plan

在 Oracle 10g 中有什么好的方法可以客观地衡量查询的性能吗？几天来我一直在[调整一个特定的查询。](https://stackoverflow.com/questions/827108/how-can-i-speed-up-rownumber-in-oracle)我得到了一个似乎运行得更快的版本（至少基于我的初始测试），但 EXPLAIN 成本大致相同。

1.  EXPLAIN 成本遗漏某些东西的可能性有多大？
2.  是否存在 EXPLAIN 成本与查询的实际性能不成比例的特殊情况？
3.  我在这个查询中使用了 first_rows 提示。这有影响吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T14:19:37.133

> EXPLAIN 成本遗漏某些东西的可能性有多大？

非常不可能。实际上，这将是一个级别`1`错误:)

实际上，如果您的统计数据在运行时发生了显着变化`EXPLAIN`，那么实际的查询计划会有所不同。但是一旦查询完成，计划将保持不变。

注意`EXPLAIN PLAN`可能会向您显示在实际查询中*可能*发生但可能永远不会发生的事情。

就像，如果您`EXPLAIN PLAN`在分层查询上运行：

```
SELECT  *
FROM    table
START WITH
        id = :startid
CONNECT BY
        parent = PRIOR id 
```

`id`在和上都有索引`parent`，你会看到一个额外的东西`FULL TABLE SCAN`，这在现实生活中很可能不会发生。

`STORED OUTLINE`无论如何都使用's 来存储和重用计划。

> 是否存在 EXPLAIN 成本与查询的实际性能不成比例的特殊情况？

是的，它经常发生在复杂的查询中。

`CBO`（基于成本的优化器）使用计算的统计信息来评估查询时间并选择最佳计划。

如果你的查询中有很多`JOIN`'s、子查询和这些类型的东西，它的算法无法准确预测哪个计划会更快，尤其是当你达到内存限制时。

这是您询问的特定情况：`HASH JOIN`例如，`probe table`如果哈希表不适合，则需要多次传递`pga_aggregate_table`，但截至`Oracle 10g`，我不记得曾经考虑过这一点`CBO`。

这就是为什么我暗示我希望在最坏的情况下运行超过几秒钟的*每个查询。*`2`

> 我在这个查询中使用了 first_rows 提示。这有影响吗？

此提示将使优化器使用*响应*时间较短的计划：尽管总体查询时间较长，但它将尽快返回第一行。

实际上，它几乎总是意味着使用`NESTED LOOP`'s 而不是`HASH JOIN`'s。

`NESTED LOOP`的在大型数据集上的整体性能较差，但它们返回第一行的速度更快（因为不需要构建哈希表）。

至于您[**原始问题**](https://stackoverflow.com/questions/827108/how-can-i-speed-up-rownumber-in-oracle)的查询，请参阅我的回答[**here**](https://stackoverflow.com/questions/827108/how-can-i-speed-up-rownumber-in-oracle/830005#830005)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T21:29:00.977

**问：**在 Oracle 10g 中，有什么好的方法可以客观地衡量查询的性能吗？

*   Oracle 跟踪是衡量性能的最佳方式。执行查询并让 Oracle 检测执行。在 SQLPlus 环境中，使用 AUTOTRACE 非常容易。

~~[http://asktom.oracle.com/tkyte/article1/autotrace.html](http://asktom.oracle.com/tkyte/article1/autotrace.html)~~（文章已移动）
[http://tkyte.blogspot.com/2007/04/when-explanation-doesn-sound-quite.html](http://tkyte.blogspot.com/2007/04/when-explanation-doesn-sound-quite.html)
[http:// asktom.oracle.com/pls/apex/f?p=100:11:0::::P11_QUESTION_ID:5671636641855](http://asktom.oracle.com/pls/apex/f?p=100:11:0::::P11_QUESTION_ID:5671636641855)

在其他环境中启用 Oracle 跟踪也不是那么困难。

**问：**有一个特定的查询我已经调整了几天。我得到了一个似乎运行得更快的版本（至少基于我的初始测试），但 EXPLAIN 成本大致相同。

*   语句的实际执行是需要衡量的。EXPLAIN PLAN 在预测优化器计划方面做得不错，但它实际上并没有*衡量*性能。

**问：** > 1。EXPLAIN 成本遗漏某些东西的可能性有多大？

*   不太可能，但我见过 EXPLAIN PLAN 提出与优化器不同的计划的情况。

**问：** > 2 。是否存在 EXPLAIN 成本与查询的实际性能不成比例的特殊情况？

*   简短的回答是我没有观察到任何。但是话又说回来，EXPLAIN PLAN 成本与实际观察到的性能之间并没有真正的直接关系。EXPLAIN PLAN 可能会给出一个非常高的成本数字，但要让实际查询在不到一秒的时间内运行。EXPLAIN PLAN 不会测量查询的实际性能，因为您需要 Oracle 跟踪。

**问：** > 3。我在这个查询中使用了 first_rows 提示。这有影响吗？

*   任何提示（如`/*+ FIRST_ROWS */`）都可能影响优化器选择的计划。

* * *

EXPLAIN PLAN 返回的“成本”是相对的。这是一个性能指标，但不是一个准确的衡量标准。您无法将成本数字转换为磁盘操作数或 CPU 秒数或等待事件数。

通常，我们发现一条 EXPLAIN PLAN 成本显示为 1 的语句将“非常快”地运行，而一条 EXPLAIN PLAN 成本为五或六位数的语句将需要更多时间来运行。但不总是。

优化器所做的是比较许多可能的执行计划（全表扫描、使用索引、嵌套循环连接等）。优化器为每个计划分配一个编号，然后选择编号最小的计划。

我见过 EXPLAIN PLAN 显示的优化器计划与执行语句时使用的实际计划*不匹配的情况。*十年前，我在 Oracle8 中看到了这一点，特别是当语句涉及绑定变量而不是文字时。

要获取语句执行的实际成本，请为您的语句启用跟踪。最简单的方法是使用 SQLPlus AUTOTRACE。

```
[http://asktom.oracle.com/tkyte/article1/autotrace.html][4] 
```

在 SQLPlus 环境之外，您可以打开 Oracle 跟踪：

```
    更改会话设置 timed_statistics = true;
    更改会话集 tracefile_identifier = here_is_my_session；
    更改会话集事件'10046 永远跟踪名称上下文，级别 12'
    --alter session set events '10053 永远跟踪名称上下文，级别 1'
    选择 /*-- your_statement_here --*/ ...
    更改会话集事件“10046 跟踪名称上下文关闭”
    --alter session set events '10053 跟踪名称上下文关闭'

```

这会将跟踪文件放入服务器上的 user_dump_dest 目录中。生成的跟踪文件将包含语句计划和所有等待事件。（分配的跟踪文件标识符包含在文件名中，便于在 udump 目录中找到您的文件）

```
    从 v$parameter 中选择值，其中名称如 'user_dump_dest'

```

如果您无权访问跟踪文件，则需要从 dba 获得帮助才能访问。（dba 可以创建一个简单的 shell 脚本，开发人员可以针对 .trc 文件运行该脚本以运行 tkprof，并更改跟踪文件和 tkprof 输出的权限。您还可以使用较新的 trcanlzr。Oracle metalink 上有关于两个都。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:19:35.357

AFAIK，EXPLAIN 正在使用一些数据库统计信息来计算成本，因此它肯定会与实际性能有所不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:21:45.100

根据我的经验，EXPLAIN 是准确且有益的。如果不是，它可能不是有用的工具。你最后一次分析表格是什么时候？我已经看到解释计划在分析之前和之后几乎相同的地方，但是分析带来了巨大的性能提升。

# .net - 作为新手涉足 .NET

> ID：829806
> 
> 赞同：1
> 
> 时间：2009-05-06T14:14:34.477
> 
> 标签：.net

迄今为止，我已经在 Windows 和 UNIX 上使用 C++、C 和 Ada95 完成了大量低级编程（内核模式设备驱动程序、本机代码等）。我正在考虑跳槽到特定于应用程序的编程，在那里我可以在软件开发的同时学习业务，而不仅仅是做一个低级硬件接口的人。

除了学习 SQL 和基本数据库之外，出于各种原因，我决定使用 .NET 堆栈而不是 Java 堆栈。我对 UI 并不真正感兴趣，但目前对服务器和后端开发更感兴趣，所以我现在试图避免使用 WPF 和 CSS/Javascript/AJAX 之类的技术。

我应该尝试学习哪些 .NET 技术以使自己在就业市场上更加“现代”和更具竞争力？我是否也需要尝试掌握 linq、ADO.NET、ASP.NET 和 WCF？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T14:23:59.290

我会先做 ADO.NET 和 SQL。如果您不知道这一点，那么您在业务发展方面会受到严重限制——如果您学习 Web 编程，那么您将能够做到的就是这些。如果您学习数据库访问，您可以编写任何您喜欢的 GUI。

SQL 完成后，您可以选择您喜欢的任何其他部分，但在使用 WCF 之前先执行低级套接字，您可能会发现这很容易，并且您会整理好基础知识。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T14:17:20.617

ASP.NET、ADO.NET 和 WCF 是不错的选择，按此顺序排列。

虽然 LINQ 很有趣，但我在寻找真正受益于它的应用程序时遇到了一些麻烦（但承认，我没有努力尝试）。无论如何，它不如其他三个重要。

学习为连接 DLL（例如硬件附带的）进行互操作也是有用的，并且能够为任意数据库创建自己的提供程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T14:50:12.160

做中间层和后端......对于低级编码人员来说更有趣。WCF、LINQ（对任何东西）、WF……有很多东西要学，而且都很有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:51:16.667

我想说以下对于服务器/后端应用程序可能是最重要的：

*   XML/XSD/XSL/XQuery
*   应用程序通信，即 WCF、.NET Remoting 等
*   LINQ 和 ADO.NET
*   网页服务
*   视窗服务
*   控制台实用程序
*   穿线

如果您不是真的在做 UI，我会说 ASP.NET/MVC/WPF 可能暂时超出了需求，而 XML/XQuery 对于与其他系统的应用程序集成很有用，并且在开发世界中使用如此频繁，这些那些不知道的日子可能比学习它更具障碍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T15:41:31.353

鉴于您对低级工作的兴趣，我可能会建议：

*   [http://msdn.microsoft.com/en-us/netframework/aa497273.aspx](http://msdn.microsoft.com/en-us/netframework/aa497273.aspx)
*   [http://msdn.microsoft.com/en-us/embedded/bb267253.aspx](http://msdn.microsoft.com/en-us/embedded/bb267253.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T15:35:56.920

考虑到您的背景，我认为您会对名为[CLR via C#](https://rads.stackoverflow.com/amzn/click/com/0735621632)的书感兴趣。它可能有点过于学术，暂时无法直接使用，但它确实帮助我理解了它们是如何协同工作的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T14:21:45.647

既然 Microsoft 的 ASP.NET [MVC 堆栈](http://www.asp.net/mvc/)已经发布，您可能希望跳过 ASP.NET WebForms 并使用它来代替。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-06T14:30:34.190

如果您对 UI 的东西不感兴趣，那么我将专注于 .NET 的面向组件方面。目前，这意味着 WCF。

很好地学习 c#，然后获取 Juval Lowy 的“Programming WCF Services”的副本。WCF 代表了使用 .NET 进行面向组件开发的未来，您可以使用它沿着可重用、可互操作和可远程组件的路线做一些非常有趣的事情。

就就业市场而言，我在过去 2 或 3 年面试过的每一份工作都问过 ASP.NET 问题，因此您可能需要学习 ASP.NET 的基础知识。我工作过的大多数应用程序也有 ASP.NET 部分，根据我的经验，大多数 .NET 开发人员都希望能够在数据、业务逻辑和表示层中编写代码。

# c# - C# 中带有 WebServices 的原始 SOAP 数据

> ID：829808
> 
> 赞同：0
> 
> 时间：2009-05-06T14:15:19.780
> 
> 标签：c#, soap, request

使用 WebServices 时，我在哪里可以找到 C# 中 SOAP 请求的 RAW/对象数据。

到处都找不到。它应该在 HttpContext.Current.Request 对象中可用吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:47:56.333

> 它应该在 HttpContext.Current.Request 对象中可用吗？

不，不应该。

你想达到什么目的？如果您只想查看该数据以便记录它，或者作为调试的辅助工具，请查看[SoapExtension 类](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx)中的示例。这是一个可以将输入和输出记录为 XML 的扩展的工作示例。我自己使用了它的修改版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-05T15:53:32.260

如果您只是想调试您的 Web 服务，那么您可以安装[Fiddler](http://www.fiddler2.com/fiddler2/)，它允许您检查发送到您的 Web 服务和从您的 Web 服务发送的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-05T15:43:08.697

我发现

```
Request.Params[null] 
```

指在 C# ASP.NET 中发布到页面的 RAW 数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:42:41.463

如果您想查看原始 XML，听起来您将不得不降低实现级别。查看[通用处理程序](http://www.aspcode.net/Creating-an-ASHX-handler-in-ASPNET.aspx)（ASHX 扩展）。这将允许您直接处理请求/响应流。它的级别非常低，但可以让您完全控制服务生命周期。

# asp.net-mvc - ASP.NET MVC：Bin 在同一台服务器上部署 V1 和 Beta

> ID：829809
> 
> 赞同：0
> 
> 时间：2009-05-06T14:15:20.640
> 
> 标签：asp.net-mvc, iis, gac

我在运行一些应用程序的 Web 服务器上安装了 ASP.NET MVC Beta。我的最新应用程序即将完成，它使用 ASP.NET MVC 版本 1。

我的想法是我可以 bin 部署 V1 程序集并安装 Beta，以便默认使用它。这个想法不起作用，因为它忽略了 bin 文件夹并从 GAC 中获取（两者都是版本 1.0.0.0）。相反，我将 Beta MVC dll 复制到使用 Beta 构建的应用程序的 bin 目录中，并卸载了从 GAC 中删除 dll 的 Beta MVC。

然后我转到一个使用 Beta MVC 的页面，该页面在其 bin 目录中包含 Beta dll，并得到一个错误，即在 GAC 中找不到 system.web.mvc dll。当然不能，我将它们删除并放在 bins 文件夹中！

所以我有点难过。

有没有一种方法可以强制 Web 应用程序查看其 bin 目录而不是 GAC？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T14:22:21.043

我真的认为你看错了方向。与其努力在服务器上同时获得 beta 和 v1 - 假设您拥有服务器上运行的所有应用程序的源并且您不只是提供托管服务 - 我相信您应该尝试投资更新少数几个可能需要干预以实现仍然依赖于 beta 程序集的应用程序的完全兼容性的代码行。无论如何，您可能应该将 iis 标签添加到问题中...

# vb.net - 将 ASP 转换为 ASP.NET

> ID：829812
> 
> 赞同：0
> 
> 时间：2009-05-06T14:16:02.727
> 
> 标签：vb.net

### 复制

> [有什么好的参考资料或工具可用于从 ASP 转换为 ASP.NET？](https://stackoverflow.com/questions/821230/any-good-references-or-tools-available-for-converting-asp-to-asp-net)

如何将 ASP Classic 网页转换为 ASP.NET 网页？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T14:24:44.267

我不会尝试做任何自动化的事情——名字是唯一真正相同的东西。最好的方法是从头开始 - 将现有的工作应用程序作为规范可以使开发非常快。

# visual-studio - Visual Studio 测试项目可以处理事件和委托吗？

> ID：829819
> 
> 赞同：1
> 
> 时间：2009-05-06T14:17:19.073
> 
> 标签：visual-studio, events, testing

我正在为一个主要是遗留代码的大型 C# 项目开发新功能。我正在处理的领域是处理 XML 模式消息，为它们的传输创建一个时间表，并将它们放入一些遗留的计时器代码中，这些代码会在应该发送它们时通知我。

虽然我是新手，但事实证明 Visual Studio 测试项目很有用，因为我可以测试我的代码，而无需尝试启动并运行整个系统（这在测试硬件上最多可能需要 30 分钟！）。

我已经静态地测试了我的事件处理代码，但现在想动态地测试。这可能吗？如果是这样，我该如何让测试项目等待事件而不超时？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:37:17.220

如果我理解正确，您可以使用等待句柄来发出事件信号，并让您的测试项目等待事件句柄发出信号。

```
void Foo()
{
   var eventSource = ...;
   var waitHandle = new ManualResetEvent(false);
   eventSource.SomeEvent += (sender, e) => waitHandle.Set();

   ...

   // Wait for the event to be fired.
   waitHandle.WaitOne();
} 
```

# php - 您可以在 PHP 中动态创建实例属性吗？

> ID：829823
> 
> 赞同：59
> 
> 时间：2009-05-06T14:17:39.743
> 
> 标签：php, design-patterns, oop, class

有没有办法动态创建所有实例属性？例如，我希望能够在构造函数中生成所有属性，并且在类实例化后仍然能够访问它们，如下所示`$object->property`：请注意，我想单独访问属性，而不是使用数组；这是我*不*想要的一个例子：

```
class Thing {
    public $properties;
    function __construct(array $props=array()) {
        $this->properties = $props;
    }
}
$foo = new Thing(array('bar' => 'baz');
# I don't want to have to do this:
$foo->properties['bar'];
# I want to do this:
//$foo->bar; 
```

更具体地说，当我处理具有大量属性的类时，我希望能够选择数据库中的所有列（代表属性）并从中创建实例属性。每个列值都应存储在单独的实例属性中。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-05-06T14:31:26.467

有点。有一些神奇的方法可以让你挂钩自己的代码以在运行时实现类行为：

```
class foo {
  public function __get($name) {
    return('dynamic!');
  }
  public function __set($name, $value) {
    $this->internalData[$name] = $value;
  }
} 
```

这是动态 getter 和 setter 方法的示例，它允许您在访问对象属性时执行行为。例如

```
print(new foo()->someProperty); 
```

在这种情况下，将打印“动态！” 并且您还可以为任意命名的属性分配一个值，在这种情况下，__set() 方法会被静默调用。__call($name, $params) 方法对对象方法调用执行相同的操作。在特殊情况下非常有用。但大多数时候，你会得到：

```
class foo {
  public function __construct() {
    foreach(getSomeDataArray() as $k => $value)
      $this->{$k} = $value;
  }
} 
```

...因为大多数情况下，您只需将数组的内容转储到相应命名的类字段中一次，或者至少在执行路径中非常明确的点。因此，除非您真的需要动态行为，否则请使用最后一个示例为您的对象填充数据。

> 这称为重载 [http://php.net/manual/en/language.oop5.overloading.php](http://php.net/manual/en/language.oop5.overloading.php)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-06T14:26:17.570

这完全取决于你想要什么。你可以动态修改**类吗？**并不真地。但是你能像在那个类的一个特定实例中那样动态地创建**对象属性吗？**是的。

```
class Test
{
    public function __construct($x)
    {
        $this->{$x} = "dynamic";
    }
}

$a = new Test("bar");
print $a->bar; 
```

输出：

> 动态的

因此，在构造函数中动态创建了一个名为“bar”的对象属性。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-06T14:29:18.327

您可以使用实例变量作为任意值的持有者，然后使用 __get 魔术方法将它们作为常规属性检索：

```
class My_Class
{
    private $_properties = array();

    public function __construct(Array $hash)
    {
         $this->_properties = $hash;
    }

    public function __get($name)
    {
         if (array_key_exists($name, $this->_properties)) {
             return $this->_properties[$name];
         }
         return null;
    }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-06T14:31:08.620

是的你可以。

```
class test
{
    public function __construct()
    {
        $arr = array
        (
            'column1',
            'column2',
            'column3'
        );

        foreach ($arr as $key => $value)
        {
            $this->$value = '';
        }   
    }

    public function __set($key, $value)
    {
        $this->$key = $value;
    }

    public function __get($value)
    {
        return 'This is __get magic '.$value;
    }
}

$test = new test;

// Results from our constructor test.
var_dump($test);

// Using __set
$test->new = 'variable';
var_dump($test);

// Using __get
print $test->hello; 
```

**输出**

```
object(test)#1 (3) {
  ["column1"]=>
  string(0) ""
  ["column2"]=>
  string(0) ""
  ["column3"]=>
  string(0) ""
}
object(test)#1 (4) {
  ["column1"]=>
  string(0) ""
  ["column2"]=>
  string(0) ""
  ["column3"]=>
  string(0) ""
  ["new"]=>
  string(8) "variable"
}
This is __get magic hello 
```

此代码将在构造函数中设置动态属性，然后可以使用 $this->column 访问这些属性。使用 __get 和 __set 魔术方法来处理未在类中定义的属性也是一种很好的做法。可以在此处找到更多信息。

[http://www.tuxradar.com/practicalphp/6/14/2](http://www.tuxradar.com/practicalphp/6/14/2)

[http://www.tuxradar.com/practicalphp/6/14/3](http://www.tuxradar.com/practicalphp/6/14/3)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-06-13T08:13:35.057

为什么每个例子都那么复杂？

```
<?php namespace example;

error_reporting(E_ALL | E_STRICT); 

class Foo
{
    // class completely empty
}

$testcase = new Foo();
$testcase->example = 'Dynamic property';
echo $testcase->example; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-06-30T11:40:37.047

这是在不公开类成员的情况下填充对象成员的简单函数。它还将构造函数留给您自己使用，在不调用构造函数的情况下创建对象的新实例！因此，您的域对象不依赖于数据库！

* * *

```
/**
 * Create new instance of a specified class and populate it with given data.
 *
 * @param string $className
 * @param array $data  e.g. array(columnName => value, ..)
 * @param array $mappings  Map column name to class field name, e.g. array(columnName => fieldName)
 * @return object  Populated instance of $className
 */
function createEntity($className, array $data, $mappings = array())
{
    $reflClass = new ReflectionClass($className);
    // Creates a new instance of a given class, without invoking the constructor.
    $entity = unserialize(sprintf('O:%d:"%s":0:{}', strlen($className), $className));
    foreach ($data as $column => $value)
    {
        // translate column name to an entity field name
        $field = isset($mappings[$column]) ? $mappings[$column] : $column;
        if ($reflClass->hasProperty($field))
        {
            $reflProp = $reflClass->getProperty($field);
            $reflProp->setAccessible(true);
            $reflProp->setValue($entity, $value);
        }
    }
    return $entity;
}

/******** And here is example ********/

/**
 * Your domain class without any database specific code!
 */
class Employee
{
    // Class members are not accessible for outside world
    protected $id;
    protected $name;
    protected $email;

    // Constructor will not be called by createEntity, it yours!
    public function  __construct($name, $email)
    {
        $this->name = $name;
        $this->emai = $email;
    }

    public function getId()
    {
        return $this->id;
    }

    public function getName()
    {
        return $this->name;
    }

    public function getEmail()
    {
        return $this->email;
    }
}

$row = array('employee_id' => '1', 'name' => 'John Galt', 'email' => 'john.galt@whoisjohngalt.com');
$mappings = array('employee_id' => 'id'); // Employee has id field, so we add translation for it
$john = createEntity('Employee', $row, $mappings);

print $john->getName(); // John Galt
print $john->getEmail(); // john.galt@whoisjohngalt.com
//... 
```

* * *

PS 从对象中检索数据类似，例如使用 $reflProp->setValue($entity, $value); PPS 这个函数很大程度上受到了[Doctrine2 ORM](http://www.doctrine-project.org/projects/orm.html)的启发，这太棒了！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-03-31T07:33:03.273

```
class DataStore // Automatically extends stdClass
{
  public function __construct($Data) // $Data can be array or stdClass
  {
    foreach($Data AS $key => $value)  
    {
        $this->$key = $value;    
    }  
  }
}

$arr = array('year_start' => 1995, 'year_end' => 2003);
$ds = new DataStore($arr);

$gap = $ds->year_end - $ds->year_start;
echo "Year gap = " . $gap; // Outputs 8 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T14:25:42.983

你可以：

```
$variable = 'foo';
$this->$variable = 'bar'; 
```

`foo`将调用它的对象的属性设置为`bar`.

您还可以使用函数：

```
$this->{strtolower('FOO')} = 'bar'; 
```

这也将`foo`（不是`FOO`）设置为`bar`。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-16T10:40:42.450

扩展标准类。

```
class MyClass extends stdClass
{
    public function __construct()
    {
        $this->prop=1;
    }
} 
```

我希望这是你需要的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-08T22:12:08.143

处理这种快速发展的方式确实很复杂。我喜欢答案和魔术方法，但我认为最好使用 CodeSmith 之类的代码生成器。

我制作了连接到数据库的模板，读取所有列及其数据类型并相应地生成整个类。

这样我就有了无错误（没有拼写错误）可读的代码。如果您的数据库模型更改再次运行生成器......它对我有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-01-11T05:35:10.853

如果你真的必须这样做，最好的方法是重载一个 ArrayObject，它允许保持迭代支持（foreach），它仍然会循环遍历你的所有属性。

我注意到您说“不使用数组”，我只是想向您保证，虽然*从技术上讲*，在后台使用了数组，但您永远不必看到它。您可以通过 ->properyname 或 foreach 访问所有属性（$name => $value 中的 $class）。

这是我昨天正在处理的一个示例，请注意这也是强类型的。因此，如果您尝试提供“字符串”，则标记为“整数”的属性将引发错误。

你当然可以删除它。

还有一个 AddProperty() 成员函数，尽管在示例中没有演示。这将允许您稍后添加属性。

示例用法：

```
 $Action = new StronglyTypedDynamicObject("Action",
            new StrongProperty("Player", "ActionPlayer"),   // ActionPlayer
            new StrongProperty("pos", "integer"),
            new StrongProperty("type", "integer"),
            new StrongProperty("amount", "double"),
            new StrongProperty("toCall", "double"));

    $ActionPlayer = new StronglyTypedDynamicObject("ActionPlayer",
            new StrongProperty("Seat", "integer"),
            new StrongProperty("BankRoll", "double"),
            new StrongProperty("Name", "string"));

    $ActionPlayer->Seat = 1;
    $ActionPlayer->Name = "Doctor Phil";

    $Action->pos = 2;
    $Action->type = 1;
    $Action->amount = 7.0;
    $Action->Player = $ActionPlayer;

    $newAction = $Action->factory();
    $newAction->pos = 4;

    print_r($Action);
    print_r($newAction);

    class StrongProperty {
            var $value;
            var $type;
            function __construct($name, $type) {
                    $this->name = $name;
                    $this->type = $type;
            }

    }

    class StronglyTypedDynamicObject extends ModifiedStrictArrayObject {

            static $basic_types = array(
                    "boolean",
                    "integer",
                    "double",
                    "string",
                    "array",
                    "object",
                    "resource",
            );

            var $properties = array(
                    "__objectName" => "string"
            );

            function __construct($objectName /*, [ new StrongProperty("name", "string"), [ new StrongProperty("name", "string"), [ ... ]]] */) {
                    $this->__objectName = $objectName;
                    $args = func_get_args();
                    array_shift($args);
                    foreach ($args as $arg) {
                            if ($arg instanceof StrongProperty) {
                                    $this->AddProperty($arg->name, $arg->type);
                            } else {
                                    throw new Exception("Invalid Argument");
                            }
                    }
            }

            function factory() {
                    $new = clone $this;
                    foreach ($new as $key => $value) {
                            if ($key != "__objectName") {
                                    unset($new[$key]);
                            }
                    }

                    // $new->__objectName = $this->__objectName;
                    return $new;
            }

            function AddProperty($name, $type) {
                    $this->properties[$name] = $type;
                    return;

                    if (in_array($short_type, self::$basic_types)) {
                            $this->properties[$name] = $type;
                    } else {
                            throw new Exception("Invalid Type: $type");
                    }
            }

            public function __set($name, $value) {
                    self::sdprintf("%s(%s)\n", __FUNCTION__, $name);
                    $this->check($name, $value);
                    $this->offsetSet($name, $value);
            }

            public function __get($name) {
                    self::sdprintf("%s(%s)\n", __FUNCTION__, $name);
                    $this->check($name);
                    return $this->offsetGet($name);
            }

            protected function check($name, $value = "r4nd0m") {
                    if (!array_key_exists($name, $this->properties)) {
                            throw new Exception("Attempt to access non-existent property '$name'");
                    }

                    $value__objectName = "";
                    if ($value != "r4nd0m") {
                            if ($value instanceof StronglyTypedDynamicObject) {
                                    $value__objectName = $value->__objectName;
                            }
                            if (gettype($value) != $this->properties[$name] && $value__objectName != $this->properties[$name]) { 
                                    throw new Exception("Attempt to set {$name} ({$this->properties[$name]}) with type " . gettype($value) . ".$value__objectName");
                            }
                    }
            }
    }

    class ModifiedStrictArrayObject extends ArrayObject {
            static $debugLevel = 0;

            /* Some example properties */

            static public function StaticDebug($message) {
                    if (static::$debugLevel > 1) {
                            fprintf(STDERR, "%s\n", trim($message));
                    }
            }

            static public function sdprintf() {
                    $args = func_get_args();
                    $string = call_user_func_array("sprintf", $args);
                    self::StaticDebug("D            " . trim($string));
            }

            protected function check($name) {
                    if (!array_key_exists($name, $this->properties)) {
                            throw new Exception("Attempt to access non-existent property '$name'");
                    }
            }

            //static public function sget($name, $default = NULL) {
            /******/ public function get ($name, $default = NULL) {
                    self::sdprintf("%s(%s)\n", __FUNCTION__, $name);
                    $this->check($name);
                    if (array_key_exists($name, $this->storage)) {
                            return $this->storage[$name];
                    }
                    return $default;
            }

            public function offsetGet($name) { 
                    self::sdprintf("%s(%s)\n", __FUNCTION__, implode(",", func_get_args()));
                    $this->check($name);
                    return call_user_func_array(array(parent, __FUNCTION__), func_get_args());
            }
            public function offsetSet($name, $value) { 
                    self::sdprintf("%s(%s)\n", __FUNCTION__, implode(",", func_get_args()));
                    $this->check($name);
                    return call_user_func_array(array(parent, __FUNCTION__), func_get_args());
            }
            public function offsetExists($name) { 
                    self::sdprintf("%s(%s)\n", __FUNCTION__, implode(",", func_get_args()));
                    $this->check($name);
                    return call_user_func_array(array(parent, __FUNCTION__), func_get_args());
            }
            public function offsetUnset($name) { 
                    self::sdprintf("%s(%s)\n", __FUNCTION__, implode(",", func_get_args()));
                    $this->check($name);
                    return call_user_func_array(array(parent, __FUNCTION__), func_get_args());
            }

            public function __toString() {
                    self::sdprintf("%s(%s)\n", __FUNCTION__, $name);
                    foreach ($this as $key => $value) {
                            $output .= "$key: $value\n";
                    }
                    return $output;
            }

            function __construct($array = false, $flags = 0, $iterator_class = "ArrayIterator") { 
                    self::sdprintf("%s(%s)\n", __FUNCTION__, implode(",", func_get_args()));
                    parent::setFlags(parent::ARRAY_AS_PROPS);
            }
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-03-16T16:15:54.347

阅读@Udo 的[答案](https://stackoverflow.com/questions/829823/can-you-create-instance-properties-dynamically-in-php#answer-829898)后。我提出了以下模式，它不会用构造函数数组参数中的任何项目使类实例膨胀，但仍然允许您键入更少并轻松地向类添加新属性。

```
class DBModelConfig
{
    public $host;
    public $username;
    public $password;
    public $db;
    public $port = '3306';
    public $charset = 'utf8';
    public $collation = 'utf8_unicode_ci';

    public function __construct($config)
    {
        foreach ($config as $key => $value) {
            if (property_exists($this, $key)) {
                $this->{$key} = $value;
            }
        }
    }
} 
```

然后你可以传递数组，如：

```
[
    'host'      => 'localhost',
    'driver'    => 'mysql',
    'username'  => 'myuser',
    'password'  => '1234',
    'charset'   => 'utf8',
    'collation' => 'utf8_unicode_ci',
    'db'        => 'key not used in receiving class'
] 
```

# sql - 如何使用 Ceiling 或 Flooring 方法在 Sql 中重新格式化 DateTime？

> ID：829825
> 
> 赞同：0
> 
> 时间：2009-05-06T14:18:04.923
> 
> 标签：sql, sql-server, sql-server-2005

我需要这张表，请看表2

* * *

表格1

访问计数日期
1-------------------15:09
3-------15:10
7- ------------------15:15
1-----------------15:39
2----- --------------15:40
3-----------15:47

* * *

我如何更改下表中的此表

* * *

表2

来访日期
11--------------------------------15:00-15:30
6--------------------------------15 :30-16:00

所以，我写了一些 sql 用户定义的函数，请看下面：

```
create FUNCTION [dbo].[fn_GetActivityLogsArranger]
(
@time AS nvarchar(max)
)

RETURNS  nvarchar(max)
AS
BEGIN
declare @Return varchar(30)

select @Return = case 
when @time between '00:00' and '00:30' then '00:00-00:30'
when @time between '00:30' and '01:00' then '00:30-01:00'
when @time between '01:00' and '01:30' then '01:00-01:30'

when @time between '01:30' and '02:00' then '01:30-02:00' 
when @time between '02:00' and '02:30' then '02:00-02:30' 
when @time between '02:30' and '03:00' then '02:30-03:00' 
when @time between '03:00' and '03:30' then '03:00-03:30' 
when @time between '03:30' and '04:00' then '03:30-04:00' 
when @time between '04:00' and '04:30' then '04:00-04:30' 
when @time between '04:30' and '05:00' then '04:30-05:00' 
when @time between '05:00' and '05:30' then '05:00-05:30'

when @time between '05:30' and '06:00' then '05:30-06:00' 
when @time between '06:00' and '06:30' then '06:00-06:30' 
when @time between '06:30' and '07:00' then '06:30-07:00' 
when @time between '07:00' and '07:30' then '07:00-07:30' 
when @time between '07:30' and '08:00' then '07:30-08:00' 
when @time between '08:00' and '08:30' then '08:00-08:30' 
when @time between '08:30' and '09:00' then '08:30-09:00' 
when @time between '09:00' and '09:30' then '09:00-09:30'

when @time between '09:30' and '10:00' then '09:30-10:00' 
when @time between '10:00' and '10:30' then '10:00-10:30' 
when @time between '10:30' and '11:00' then '10:30-11:00' 
when @time between '11:00' and '11:30' then '11:00-11:30' 
when @time between '11:30' and '12:00' then '11:30-12:00' 
when @time between '12:00' and '12:30' then '12:00-12:30' 
when @time between '12:30' and '13:00' then '12:30-13:00' 
when @time between '13:00' and '13:30' then '13:00-13:30'

when @time between '13:30' and '14:00' then '13:30-14:00' 
when @time between '14:00' and '14:30' then '14:00-14:30'
when @time between '14:30' and '15:00' then '14:30-15:00'
when @time between '15:00' and '15:30' then '15:00-15:30'
when @time between '15:30' and '16:00' then '15:30-16:00'
when @time between '16:00' and '16:30' then '16:00-16:30'
when @time between '16:00' and '16:30' then '16:00-16:30' 
when @time between '16:30' and '17:00' then '16:30-17:00' 
when @time between '17:00' and '17:30' then '17:00-17:30' 
when @time between '17:30' and '18:00' then '17:30-18:00'
when @time between '18:00' and '18:30' then '18:00-18:30' 

when @time between '18:30' and '19:00' then '18:30-19:00'
when @time between '19:00' and '19:30' then '19:00-19:30'
when @time between '19:30' and '20:00' then '19:30-20:00'
when @time between '20:00' and '20:30' then '20:00-20:30'
when @time between '20:30' and '21:00' then '20:30-21:00'
when @time between '21:00' and '21:30' then '21:00-21:30'
when @time between '21:30' and '22:00' then '21:30-22:00'
when @time between '22:00' and '22:30' then '22:00-22:30'
when @time between '22:30' and '23:00' then '22:30-23:00'
when @time between '23:00' and '23:30' then '23:00-23:30'
when @time between '23:30' and '24:00' then '23:30-:24:00'

else 'Unknown'
end
 Return @Return
end 
```

* * *

**所以，我在我的 sql 查询中调用了这个 UDF。所以结果是正确的。**

* * *

```
select Count(Page) as VisitingCount,[Time]
from
( SELECT Page,Date,[user],
        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108)) as [Time]
        FROM scr_SecuristLog
) scr_SecuristLog
where
        Date between '2009-05-06' and '2009-05-07'
and
        [user] in
(       select USERNAME
        from scr_CustomerAuthorities
        where customerID=Convert(varchar,4)
        and ID=Convert(varchar,43)
)
group by [Time] order by [Time] asc 
```

**dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108))... 函数方法不是有效方法。因为; 写太多“何时”比较不足以获取数据。是否有任何方法，例如：sql 中的“Math.Round()”而不是 C#。**

例如：

运行（11:28）结果：11:00 但运行（11:31）结果：12:00

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T14:37:27.467

我建议您查看我在您之前的帖子中的回复，但这似乎有效：

```
declare @t datetime
set @t = '2009-05-06 12:29.997'
--truncate anything smaller than minute
set @t = cast (@t as smalldatetime)
select @t
select 
    case
        when datepart(minute, @t) >= 30
            then dateadd(minute, 60-(datepart(minute, @t)), @t)
        else dateadd(minute, -(datepart(minute, @t)), @t)
    end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:40:54.133

将日期转换为自午夜以来的分钟数并使用模将日期转换为时间段（在您的情况下为半小时）并不是更好。

例如：

*   `DATEDIFF(mi, '2009-05-06', '2009-05-06 00:15') / 30`给出 0

*   `DATEDIFF(mi, '2009-05-06', '2009-05-06 00:45') / 30`给 1

所以 SQL 查询看起来像：

```
DECLARE 
    @midnight AS smalldatetime

SET @midnight = dbo.truncatetime(GETDATE()) -- you have to write dbo.truncatetime()

SELECT
    SUM(VisitingCount) AS VisitingCount,
    expression to convert time in minutes to time period
FROM
    TABLE1
GROUP BY
    DATEDIFF(mi, @midnight, Date) / 30 -- should give 0, 1 for every next half of hour 
```

# biztalk - BizTalk 平面文件架构中的填充行

> ID：829830
> 
> 赞同：0
> 
> 时间：2009-05-06T14:18:24.813
> 
> 标签：biztalk

我正在尝试创建一个类似于以下内容的 BizTalk 架构（忽略行之间的空格-它们只是为了清楚起见。）：
“
x 行将被插入
Column1^Column2^Column3^Column4^Column5
Data1a^数据2a^数据3a^数据4a^数据5a数据
1b^数据2b^数据3a^数据4b^数据5b"

因此，在获取实际数据之前，我有一个空白行，然后是行数，然后是标题行。当我尝试设置架构以使空白行（仅包含 {CR}{LF}）并验证实例时，架构失败（没有错误消息，无法启动）。

我正在运行 BizTalk 2009，该文件是一个简单的 .txt 文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T18:26:33.070

好的...我找到了答案：如果您找到/有更好的答案，请随时加入。

将空白行设置为类型为 xs:string 的字段。
将标题行设置为单个记录（将所有字段定义为字符串）。
定义重复记录。

如果有人有更好的方法，我仍然愿意接受进一步的建议，因为这对我来说似乎有点笨拙。

# .net - 如何从 php 实例化的 COM 对象获取服务器端注册表访问？

> ID：829832
> 
> 赞同：0
> 
> 时间：2009-05-06T14:19:13.297
> 
> 标签：.net, php, com, registry

在服务器上，我想从 php 调用一个 dll。使用 COM 对象。这不是问题，直到我尝试使用一些 WPF 功能。

我收到以下错误：

> PHP 致命错误：未捕获的异常“com_exception”和消息“源：mscorlib 描述：不允许请求的注册表访问。”

通过 ProcMon 实用程序，我发现只有 1 次访问被拒绝

> HKU\S-1-5-20\Software\Microsoft\Wisp\Pen\SysEventParameters

此键用于某些[“使用笔擦除”](http://msdn.microsoft.com/en-us/library/ms702533(VS.85).aspx)设置。我对这个类没有做任何事情，似乎它是在初始化时调用的。

此过程由用户 NT AUTHORITY\NETWORK SERVICE 的 php-cgi.exe 调用。在 regedit.exe 中，我看到该用户有权访问密钥。

应该可以在服务器上使用 WPF 吧？我想我必须在某个地方降低安全性。

谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T06:42:50.750

原来是 IIS7 中的一个设置。我将匿名身份验证凭据从 NT AUTHORITY\NETWORK SERVICE 更改为 Application Pool Identity，问题得到解决。

# sql - 如何最好地通过 SQL 对多个布尔值求和？

> ID：829833
> 
> 赞同：0
> 
> 时间：2009-05-06T14:19:13.547
> 
> 标签：sql, ms-access, jet

我有一个表，其中包含大约 30 列表示特定属性的布尔标志。我想将它们按频率排序作为记录集连同它们的列名一起返回，如下所示：

```
Attribute    Count
attrib9      43
attrib13     27 
attrib19     21
etc. 
```

到目前为止，我的努力可以实现类似的效果，但我只能使用条件 SUM 获取列中的属性，如下所示：

```
SELECT SUM(IIF(a.attribIndex=-1,1,0)), SUM(IIF(a.attribWorkflow =-1,1,0))... 
```

此外，对于所有 30 个 SUM/IIF，查询已经变得有点笨拙，并且不会在没有人工干预的情况下处理属性数量的任何变化。

属性列的前六个字符是相同的（attrib）并且在表中是唯一的，是否可以在列名中使用通配符来选择所有适用的列？

另外，我可以旋转结果给我一个排序的两列记录集吗？

我正在使用 Access 2003，查询最终将通过 Excel 中的 ADODB。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:23:51.393

这取决于您是否*在 data*的任何地方都有属性名称。如果你这样做了，那么birdlips 的回答就可以解决问题。但是，如果名称只是列名，那么您还有更多工作要做——而且我担心您无法使用简单的 SQL 来完成。

不，您不能在 SQL 中对列名使用通配符。您需要过程代码来执行此操作（即，Access 中的 VB 模块——如果您在 SQL Server 上，您可以在存储过程中执行此操作）。使用此代码构建 SQL 代码。

不会很漂亮 我*认为*您需要一次执行一个属性：选择一个字符串，其值为该属性名称和 count-where-True，然后 A）运行该字符串并将结果存储在临时表中的新行中, 或 B) 在运行批处理之前将所有这些选择与它们之间的“联合”附加在一起。

我的 Access VB 有点生疏了，所以我不相信自己会给你任何可执行代码之类的东西......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T14:24:44.890

只需简单的计数和分组就可以了

```
 Select attribute_name
         , count(*)
      from attribute_table
    group by attribute_name 
```

要回答您的评论，请使用分析函数：

```
 Select attribute_table.*
        , count(*) over(partition by attribute_name) cnt
   from attribute_table 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T17:00:32.503

在 Access 中，交叉表查询（用于转置数据集的传统工具）至少需要 3 个数字/日期字段才能工作。但是，由于输出到 Excel，您是否考虑过将数据输出到隐藏工作表然后使用数据透视表？

# http - 如何在 Fiddler 中显示 HTTP 请求的大小？

> ID：829834
> 
> 赞同：12
> 
> 时间：2009-05-06T14:19:29.677
> 
> 标签：http, fiddler, web-traffic

我想在提琴手的会话列表中显示每个请求的大小。到目前为止，我尝试的是在 CustomRules.js 文件中添加一个自定义列：

```
public static BindUIColumn("RequestSize")
function CalcMethodCol(oS: Session)
{
  if (null != oS.requestBodyBytes)
    return oS.requestBodyBytes.Length; //this is the relevant line
  else
    return "?";
} 
```

但是当提琴手尝试加载脚本时，这会导致错误。

如果我将带有注释的行更改为：

```
 return typeof(oS.requestBodyBytes.Length); 
```

然后提琴手在 RequestSize 列中显示“数字”。因此，我想我离我想要实现的目标并不遥远。我只是不知道如何显示 requestBodyBytes 字段的大小。

任何提示我做错了什么或缺少什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-07-07T18:23:21.103

**更新**在现代版本的 Fiddler 中，您只需右键单击列标题，选择“自定义列”并添加`Miscellaneous`>`Request Size`列。

* * *

根据您的需要，这可能不是您真正想要做的，因为它只显示请求正文的长度，而不包括标头的大小。

这是一个改进的版本：

```
public  static  BindUIColumn("Req-Size")
function  CalcReqSize(oS:  Session){        
  if (null == oS.oRequest) return String.Empty;
  var cBytesOut: int = 0;

  if (null != oS.requestBodyBytes) cBytesOut += oS.requestBodyBytes.LongLength; 
  if ((null != oS.oRequest) && (null != oS.oRequest.headers)) cBytesOut += 
  oS.oRequest.headers.ByteCount() ; 
  return cBytesOut.ToString();
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T21:35:53.043

好吧，我知道我离我不远了。这是我的问题的答案。

此脚本在放入 CustomRules.js 时，将在 fiddler 中打印 HTTP 请求的长度/大小：

```
public  static  BindUIColumn("Req-Length")
function  CalcMethodCol(oS:  Session){
    if (null != oS.oRequest)
            return oS.requestBodyBytes.LongLength.ToString();
        else
            return String.Empty;
} 
```

# c++ - （高阶）宏可以做多少？

> ID：829837
> 
> 赞同：3
> 
> 时间：2009-05-06T14:19:59.380
> 
> 标签：c++, macros, c-preprocessor

将宏名称作为参数提供给其他宏以模拟高阶函数是否“安全”？

即我应该在哪里寻找不射击自己的脚？

以下是一些片段：

```
#define foreach_even(ii, instr) for(int ii = 0; ii < 100; ii += 2) { instr; }
#define foreach_odd(ii, instr)  for(int ii = 1; ii < 100; ii += 2) { instr; }

#define sum(foreach_loop, accu) \
  foreach_loop(ii, {accu += ii});

int acc = 0;
sum(foreach_even, acc);
sum(foreach_odd, acc); 
```

部分申请呢，可以吗？：

```
#define foreach(ii, start, end, step, instr) \
  for(int ii = start; ii < end; ii += step) { instr; }

#define foreach_even(ii, instr) foreach(ii, 0, 100, instr)
#define foreach_odd(ii, instr)  foreach(ii, 1, 100, instr)

#define sum(foreach_loop, accu) \
  foreach_loop(ii, {accu += ii});

int acc = 0;
sum(foreach_even, acc);
sum(foreach_odd, acc); 
```

我可以在宏中定义宏吗？

```
#define apply_first(new_macro, macro, arg) #define new_macro(x) macro(arg,x) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T14:27:12.293

如果您想尽可能多地使用预处理器，您可能想尝试[boost.preprocessor](http://www.boost.org/doc/libs/1_39_0/libs/preprocessor/doc/index.html)。

但请注意，这样做**并不安全**。例如，逗号在使用预处理器时会引起大量问题。不要忘记预处理器不理解（甚至试图理解）它们生成的任何代码。

我的基本建议是“不要这样做”，或者“尽可能谨慎地做”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T15:22:59.213

我已经完全在 c 预处理器中实现了一个烂的小单元测试框架。几十个宏，很多宏是另一个宏类型东西的参数。

从最佳实践的角度来看，这种事情*并不*“安全”。有一些微妙且非常有效的方法可以让自己在脚下开枪。单元测试项目是一个失控的玩具。

不知道是否可以嵌套宏定义。我对此表示怀疑，但我会去尝试... gcc 不喜欢它，并以

> nested_macro.cc:8：错误：程序中的错误“#”
> nested_macro.cc:3：错误：在“（”标记之前的预期构造函数、析构函数或类型转换
> nested_macro.cc：3：错误：在“}”标记之前的预期声明

**自插入**：如果您有兴趣，可以在[https://sourceforge.net/projects/dut/找到单元测试框架](https://sourceforge.net/projects/dut/)

# security - 如何*正确*存储密码？

> ID：829838
> 
> 赞同：18
> 
> 时间：2009-05-06T14:20:09.863
> 
> 标签：security, cryptography, passwords, hash

我在 SO 中偶然发现的一篇文章提供了指向其他文章的链接，这些[文章](https://stackoverflow.com/questions/797626/is-using-a-salt-all-that-good)[又](https://blog.codinghorror.com/i-just-logged-in-as-you-how-it-happened/)提供了指向[更多](https://blog.codinghorror.com/youre-probably-storing-passwords-incorrectly/) [文章](http://www.matasano.com/log/958/enough-with-the-rainbow-tables-what-you-need-to-know-about-secure-password-schemes/)等的链接。

最后我完全被难住了——那么在数据库中存储密码**的最佳方法是什么？**据我所知，您应该：

*   使用长的（至少 128 个完全随机位）盐，它以明文形式存储在密码旁边；
*   对加盐密码使用多次 SHA-256（或更高的 SHA 级别）迭代。

但是……我对密码学的了解越多，我就越明白我什么都不懂，而且多年来我一直认为是正确的事情实际上是完全错误的。这里有这方面的专家吗？

**补充：**似乎有些人没有抓住重点。我重复上面给出的最后一个链接。这应该澄清我的担忧。

[https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2007/july/enough-with-the-rainbow-tables-what-you-need-to-know-about-安全密码方案/](https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2007/july/enough-with-the-rainbow-tables-what-you-need-to-know-about-secure-password-schemes/)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T15:10:18.383

你答对了。只有两个建议：

1.  如果有一天 SHA1 变得太弱并且您想使用其他东西，则不可能取消旧密码的哈希并使用新方案重新哈希它们。出于这个原因，我建议在每个密码上附加一个“版本”编号，告诉您使用的方案（盐长度、哈希值、次数）。如果有一天您需要从 SHA 切换到更强大的密码，您可以创建新式密码，同时在数据库中保留旧式密码，并且仍然可以将它们区分开来。将用户迁移到新方案将更容易。

2.  密码仍然在没有加密的情况下从用户传递到系统。如果这是一个问题，请查看[SRP 。](http://srp.stanford.edu/)SRP 是如此新，以至于您应该对实施它有点偏执，但到目前为止它看起来很有希望。

编辑：结果 bcrypt 在第 1 个想法上击败了我。存储的信息是（成本、盐、哈希），其中成本是哈希完成的次数。看起来 bcrypt 做对了。无需用户干预即可增加哈希的次数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T14:23:34.690

事实上，这取决于密码的用途。您应该小心存储任何密码，但有时需要比其他密码更加小心。作为一般规则，所有密码都应该经过哈希处理，并且每个密码都应该有一个唯一的盐。

真的，盐不需要那么复杂，即使是很小的盐也会对试图进入系统的饼干造成真正的噩梦。它们被添加到密码中，以防止使用 Rainbow 表破解多个帐户的密码。我不会在密码中添加一个字母并将其称为盐，但您也不需要将其设为在数据库中其他位置加密的唯一 guid。

关于盐的另一件事。在散列时使密码+盐起作用的关键是两者组合的复杂性。如果你有一个 12 个字符的密码并在其中添加一个 1 个字符的盐，盐不会起多大作用，但破解密码仍然是一项不朽的壮举。反之亦然。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:32:50.207

利用：

1.  哈希密码存储
2.  一个 128 位以上的用户级盐，随机，重新生成（即，当您创建新密码散列时创建新盐，您不会为给定用户持续保留相同的盐）
3.  一种强大的、计算量大的散列方法
4.  与这些“标准实现指南”以及您编写的任何其他密码存储实现*有所*不同的方法（哈希算法、您使用多少次哈希迭代、盐连接的顺序等）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:23:03.473

我认为不需要对密码进行额外的迭代，只需确保有一个盐和一个复杂的；）我个人使用 SHA-1 和 2 个盐关键词。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T14:23:36.750

盐的长度并不重要，只要它对用户是唯一的。使用盐的原因是，在哈希匹配中给定的生成尝试仅对数据库中用户表的单行有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T14:23:47.903

简单地说，使用加密安全的哈希算法和一些盐作为密码，这对于 99.99% 的用例来说应该足够好了。弱链接将是检查密码以及密码输入的代码。

# css - 强制图像进入固定 div？

> ID：829842
> 
> 赞同：0
> 
> 时间：2009-05-06T14:21:09.440
> 
> 标签：css

我正在尝试将图像缩放到表格的大小（不幸的是我需要保留表格），其中表格的大小与 div 的大小相同。看下面的链接，右边的图片就是我所期待的。但是，在底部图片中，图像并未停留在其 100% 大小的表格中。为什么身高不缩水？

[http://dl.getdropbox.com/u/139980/image%20size%20experiment/index.html](http://dl.getdropbox.com/u/139980/image%20size%20experiment/index.html)

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:29:50.380

因为您知道表格大小，所以直接应用高度和宽度。

```
<img src="imageName.png" width="20" height="20"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:14:20.183

尝试溢出隐藏到 div

> 溢出：隐藏

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-06T14:57:20.600

好吧，我不得不说我以前从未注意到这种行为。我已经找到了使用 Javascript 解决您的问题的方法。我能够用 CSS 做到这一点的唯一方法是，如果我为图像指定了与 DIV 相同的高度和宽度。

因此，javascript 设置与图像元素的父级 DIV 相同的高度和宽度。希望这对您来说是一个可行的解决方案：

```
<html>
<head>
<script>
function autoSize(i) 
{
    i.style.height = i.parentNode.parentNode.parentNode.parentNode.parentNode.style.height;
    i.style.width = i.parentNode.parentNode.parentNode.parentNode.parentNode.style.width;
};
</script>
</head>
<body>

<div style="position: absolute; width: 400; height: 100;top: 200; left: 10;background-color: #CCCCCC">
    <table width=100% height=100%><tr><td align=center valign=middle>
        <img src="ImagePlaceholder.png" onload="autoSize(this)">
    </td></tr></table>
</div>

</body>
</html> 
```

可能有更好的方法来获取父节点，但我会让你弄清楚:)

# windows - 如何使用 Delphi 从文件扩展名中获取图标和描述？

> ID：829843
> 
> 赞同：15
> 
> 时间：2009-05-06T14:21:25.240
> 
> 标签：windows, delphi, icons, file-association

基本上我有一个 TcxGrid，它将列出各种文件名，我想根据文件扩展名提供更多详细信息，特别是它的描述（例如，对于 .PDF，它是“Adobe Acrobat 文档”）及其相关图标。

我注意到已经有一个[非常相似](https://stackoverflow.com/questions/272035/how-do-i-get-the-icon-associated-with-a-file-type)的问题，但它与 C# 相关，我想要基于 Delphi 的东西。

关于在哪里寻找这种信息的建议会很好，如果有一个类似于上面 C# 帖子中提到的类（显然是在 Delphi 中），那就太好了。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-07T14:28:56.243

感谢 Rob Kennedy 为我指明了 ShGetFileInfo 的方向。然后我在谷歌上搜索并找到了这两个示例 - [Delphi 3000](http://www.delphi3000.com/articles/article_1086.asp?SK=)，[Torry's](http://www.swissdelphicenter.ch/torry/showcode.php?id=421)。从那以后，我编写了以下课程来做我需要的事情。

此外，就在我完成比尔米勒的回答时，我得到了我需要的最后一点帮助。最初我将完整的文件名传递给 ShGetFileInfo，这并不是我想要的。建议通过“* .EXT”的调整很棒。

这门课可以做更多的工作，但它可以满足我的需要。它似乎可以处理没有相关细节的文件扩展名。

最后，在我使用的内容中，我将其切换为使用 TcxImageList 而不是 TImageList，因为我遇到了图标上出现黑色边框的问题，因为这是一个快速修复。

```
unit FileAssociationDetails;

{
  Created       : 2009-05-07
  Description   : Class to get file type description and icons.
                  * Extensions and Descriptions are held in a TStringLists.
                  * Icons are stored in a TImageList.

                  Assumption is all lists are in same order.
}

interface

uses Classes, Controls;

type
  TFileAssociationDetails = class(TObject)
  private
    FImages : TImageList;
    FExtensions : TStringList;
    FDescriptions : TStringList;
  public
    constructor Create;
    destructor Destroy; override;

    procedure AddFile(FileName : string);
    procedure AddExtension(Extension : string);    
    procedure Clear;    
    procedure GetFileIconsAndDescriptions;

    property Images : TImageList read FImages;
    property Extensions : TStringList read FExtensions;
    property Descriptions : TStringList read FDescriptions;
  end;

implementation

uses SysUtils, ShellAPI, Graphics, Windows;

{ TFileAssociationDetails }

constructor TFileAssociationDetails.Create;
begin
  try
    inherited;

    FExtensions := TStringList.Create;
    FExtensions.Sorted := true;
    FDescriptions := TStringList.Create;
    FImages := TImageList.Create(nil);
  except
  end;
end;

destructor TFileAssociationDetails.Destroy;
begin
  try
    FExtensions.Free;
    FDescriptions.Free;
    FImages.Free;
  finally
    inherited;
  end;
end;

procedure TFileAssociationDetails.AddFile(FileName: string);
begin
  AddExtension(ExtractFileExt(FileName));
end;

procedure TFileAssociationDetails.AddExtension(Extension : string);
begin
  Extension := UpperCase(Extension);
  if (Trim(Extension) <> '') and
     (FExtensions.IndexOf(Extension) = -1) then
    FExtensions.Add(Extension);
end;

procedure TFileAssociationDetails.Clear;
begin
  FExtensions.Clear;
end;

procedure TFileAssociationDetails.GetFileIconsAndDescriptions;
var
  Icon: TIcon;
  iCount : integer;
  Extension : string;
  FileInfo : SHFILEINFO; 
begin
  FImages.Clear;
  FDescriptions.Clear;

  Icon := TIcon.Create;
  try
    // Loop through all stored extensions and retrieve relevant info
    for iCount := 0 to FExtensions.Count - 1 do
    begin
      Extension := '*' + FExtensions.Strings[iCount];

      // Get description type
      SHGetFileInfo(PChar(Extension),
                    FILE_ATTRIBUTE_NORMAL,
                    FileInfo,
                    SizeOf(FileInfo),
                    SHGFI_TYPENAME or SHGFI_USEFILEATTRIBUTES
                    );
      FDescriptions.Add(FileInfo.szTypeName);

      // Get icon and copy into ImageList
      SHGetFileInfo(PChar(Extension),
                    FILE_ATTRIBUTE_NORMAL,
                    FileInfo,
                    SizeOf(FileInfo),
                    SHGFI_ICON or SHGFI_SMALLICON or
                    SHGFI_SYSICONINDEX or SHGFI_USEFILEATTRIBUTES
                    );
      Icon.Handle := FileInfo.hIcon;
      FImages.AddIcon(Icon);
    end;
  finally
    Icon.Free;
  end;
end;

end. 
```

这里还有一个使用它的示例测试应用程序，它非常简单，只是一个带有 TPageControl 的表单。我的实际用途不是为了这个，而是为了在 TcxGrid 中使用 Developer Express TcxImageComboxBox。

```
unit Main;

{
  Created       : 2009-05-07
  Description   : Test app for TFileAssociationDetails.
}

interface

uses
  Windows, Forms, FileAssociationDetails, Classes, Controls, ComCtrls;

type
  TfmTest = class(TForm)
    PageControl1: TPageControl;
    procedure FormShow(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
  private
    { Private declarations }
    FFileDetails : TFileAssociationDetails;
  public
    { Public declarations }
  end;

var
  fmTest: TfmTest;

implementation

{$R *.dfm}

procedure TfmTest.FormShow(Sender: TObject);
var
  iCount : integer;
  NewTab : TTabSheet;
begin
  FFileDetails := TFileAssociationDetails.Create;
  FFileDetails.AddFile('C:\Documents and Settings\...\Test.XLS');
  FFileDetails.AddExtension('.zip');
  FFileDetails.AddExtension('.pdf');
  FFileDetails.AddExtension('.pas');
  FFileDetails.AddExtension('.XML');
  FFileDetails.AddExtension('.poo');

  FFileDetails.GetFileIconsAndDescriptions;
  PageControl1.Images := FFileDetails.Images;

  for iCount := 0 to FFileDetails.Descriptions.Count - 1 do
  begin
    NewTab := TTabSheet.Create(PageControl1);
    NewTab.PageControl := PageControl1;
    NewTab.Caption := FFileDetails.Descriptions.Strings[iCount];
    NewTab.ImageIndex := iCount;
  end;
end;

procedure TfmTest.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  PageControl1.Images := nil;
  FFileDetails.Free;
end;

end. 
```

谢谢大家的回答！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T16:13:36.143

打电话[`ShGetFileInfo`](http://msdn.microsoft.com/en-us/library/bb762179.aspx)。它可以告诉您描述（该函数的词汇表中的“类型名称”），它可以为您提供图标句柄，或系统图像列表的句柄，图标所在的位置，或包含模块的路径图片资源。该函数可以做很多不同的事情，因此请务必仔细阅读文档。

[MSDN 表示](http://msdn.microsoft.com/en-us/library/bb761854(VS.85).aspx) `ShGetFileInfo`“可能会很慢”，并称该[`IExtractIcon`](http://msdn.microsoft.com/en-us/library/bb761854(VS.85).aspx)接口是“更灵活、更高效”的替代方案。但它推荐的顺序是使用一个[`IShellFolder`](http://msdn.microsoft.com/en-us/library/bb775075.aspx)接口，然后调用[`GetUIObjectOf`](http://msdn.microsoft.com/en-us/library/bb775073.aspx)来获取文件的`IExtractIcon`接口，然后调用[`GetIconLocation`](http://msdn.microsoft.com/en-us/library/bb761852.aspx)and[`Extract`](http://msdn.microsoft.com/en-us/library/bb761850.aspx)来检索图标的句柄。

据我所知，这正是这样`ShGetFileInfo`做的，但它更麻烦，在你完成所有这些之后，你仍然不会有文件的类型描述。坚持`ShGetFileInfo`到速度和效率成为一个明显的问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T14:00:08.763

```
function GetGenericFileType( AExtension: string ): string;
{ Get file type for an extension }
var
  AInfo: TSHFileInfo;
begin
  SHGetFileInfo( PChar( AExtension ), FILE_ATTRIBUTE_NORMAL, AInfo, SizeOf( AInfo ),
    SHGFI_TYPENAME or SHGFI_USEFILEATTRIBUTES );
  Result := AInfo.szTypeName;
end;

function GetGenericIconIndex( AExtension: string ): integer;
{ Get icon index for an extension type }
var
  AInfo: TSHFileInfo;
begin
  if SHGetFileInfo( PChar( AExtension ), FILE_ATTRIBUTE_NORMAL, AInfo, SizeOf( AInfo ),
    SHGFI_SYSICONINDEX or SHGFI_SMALLICON or SHGFI_USEFILEATTRIBUTES ) <> 0 then
  Result := AInfo.iIcon
  else
    Result := -1;
end;

function GetGenericFileIcon( AExtension: string ): TIcon;
{ Get icon for an extension }
var
  AInfo: TSHFileInfo;
  AIcon: TIcon;
begin
  if SHGetFileInfo( PChar( AExtension ), FILE_ATTRIBUTE_NORMAL, AInfo, SizeOf( AInfo ),
    SHGFI_SYSICONINDEX or SHGFI_SMALLICON or SHGFI_USEFILEATTRIBUTES ) <> 0 then
  begin
    AIcon := TIcon.Create;
    try
      AIcon.Handle := AInfo.hIcon;
      Result := AIcon;
    except
      AIcon.Free;
      raise;
    end;
  end
  else
    Result := nil;
end; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T13:28:58.370

```
uses ShellAPI;

var
AExtension: string;
AFileType: string;    
AListItem: TListItem;
AFileInfo: TSHFileInfo;
begin
// get the extensions file icon
AExtension := ExtractFileExt( FileName );
if SHGetFileInfo( PChar( '*' + AExtension ), FILE_ATTRIBUTE_NORMAL, AFileInfo, SizeOf
  ( AFileInfo ), SHGFI_SYSICONINDEX or SHGFI_SMALLICON or SHGFI_USEFILEATTRIBUTES ) <> 0 then
  AIndex := AFileInfo.iIcon
else
  AIndex := -1;
AListItem.ImageIndex := AIndex;
// get extensions file info
if SHGetFileInfo( PChar( '*' + AExtension ), FILE_ATTRIBUTE_NORMAL, Info, SizeOf( Info ),
  SHGFI_TYPENAME or SHGFI_USEFILEATTRIBUTES ) then
    AFileType := AFileInfo.szTypeName;
end; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T14:38:21.457

不要听起来油嘴滑舌，但谷歌是你的朋友。以下是“delphi 关联图标”的一些初步结果：

[http://www.delphi3000.com/articles/article_453.asp?SK=](http://www.delphi3000.com/articles/article_453.asp?SK=)

[http://www.jpgriffiths.com/tutorial/Snippets%5Cgetassociatedicon.html](http://www.jpgriffiths.com/tutorial/Snippets%5Cgetassociatedicon.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T16:35:00.943

另一种方法是在注册表中查找 HKEY_CLASSES_ROOT 下的扩展名，然后按照默认值（如果可用）中的键，其默认值是描述。第二级也是您可以打开 shell 命令的地方，或打印文件类型以及默认图标的路径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T17:03:01.017

以下是使用 bitwisemag.com 的 ShGetFileInfo 的几个很好的示例：

[http://www.bitwisemag.com/copy/delphi/lpad1.html](http://www.bitwisemag.com/copy/delphi/lpad1.html)

[http://www.bitwisemag.com/copy/delphi/prog_groups2.html](http://www.bitwisemag.com/copy/delphi/prog_groups2.html)

# select - 带有安装选项的 WiX wxs 脚本选择当前用户或所有用户安装

> ID：829844
> 
> 赞同：0
> 
> 时间：2009-05-06T14:21:38.533
> 
> 标签：select, wix

我需要一个可以构建的完整 WiX 脚本。它有

1.  欢迎
2.  最终用户许可协议
3.  安装文件夹
4.  **选择当前用户或所有用户安装**
5.  安装
6.  结束

我只需要一个 wxs 文件，因为它用于一个简单的应用程序。我还需要一个选项来为当前用户或所有用户安装它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T14:36:56.093

你检查过Wix3内置的[WixUI_Advanced UI 吗？](http://wix.sourceforge.net/manual-wix3/WixUI_advanced.htm)

以下是它具有的对话框：

*   高级欢迎EulaDlg
*   浏览Dlg
*   磁盘成本文件
*   特征Dlg
*   安装目录
*   **InstallScopeDlg** （用于选择用户或每台机器）
*   无效目录

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-12T23:34:11.657

我也使用了 WixUI_InstallDir，但是通过在安装程序末尾添加一些“下一步做什么”文本来复制它并根据我的需要对其进行调整。我使用[这个详细的演练](http://dizzymonkeydesign.com/blog/misc/adding-and-customizing-dlgs-in-wix-3/ "这个详细的演练")来获取常用的 Wix GUI，并为我自己的目的更改了几个屏幕。这确实需要您获取 Wix 源代码，但只是为了获取 Wix 开发人员包含用于驱动 WixUI_InstallDir 安装程序的实际 Product.wxs 文件的未编译版本。

所以基本上我在一个解决方案中有这样的东西（使用 VS 的 Votive 插件）：

*   我的网络项目
*   蜡项目
    *   MyWeb.wxs - 我的产品很明显
    *   Product.wxs - 来自 Wix 源的 Wix 文件，它定义了 WixUI_InstallDir 的结构、流程和内容
    *   My_InstallDir.wxs - 这就是有趣的地方。基本上复制了源代码 Wix 文件，对其进行了更改以满足我的需要，然后确保在 Product.wxs 中我引用了**我的**屏幕，而不是原始屏幕。

产品.wxs

```
 <UI>
        <UIRef Id="My_InstallDir"/>
    </UI>

    <!-- Add the customized EULA -->
    <WixVariable Id="WixUILicenseRtf" Value="$(var.SolutionDir)\doc\license.rtf" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLLOCATION" />
    <UIRef Id="My_InstallDir" />
    <!-- Add the customized banner logo -->
    <WixVariable Id="WixUIBannerBmp" Value="$(var.SolutionDir)\doc\InstallerBanner.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="$(var.SolutionDir)\doc\InstallerSidebar.bmp" /> 
```

My_InstallDir.wxs 完全没有改变，除了引用我的退出对话框的那一行，这是我的“下一步做什么”注释所在的位置：

```
<Publish Dialog="MyExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish> 
```

那么真正的变化是在我显示文本的 My_ExitDialog 中：

```
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
<Fragment>
    <UI>
        <Dialog Id="MyExitDialog" Width="370" Height="270" Title="!(loc.ExitDialog_Title) test">
            <Control Id="Finish" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Cancel="yes" Text="!(loc.WixUIFinish)" />
            <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUICancel)" />
            <Control Id="Bitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="234" TabSkip="no" Text="!(loc.ExitDialogBitmap)" />
            <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Disabled="yes" Text="!(loc.WixUIBack)" />
            <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />
            <!--<Control Id="Description" Type="Text" X="135" Y="70" Width="220" Height="40" Transparent="yes" NoPrefix="yes" Text="!(loc.ExitDialogDescription)" />-->
            <Control Id="Title" Type="Text" X="135" Y="20" Width="220" Height="60" Transparent="yes" NoPrefix="yes" Text="!(loc.ExitDialogTitle)" />
            <Control Id="NextSteps" Type="ScrollableText" X="135" Y="70" Width="220" Height="140" Sunken="yes" TabSkip="no">
                <Text SourceFile="$(var.SolutionDir)\doc\GemWebAfterInstall.rtf" />
            </Control>
        </Dialog>

        <InstallUISequence>
            <Show Dialog="MyExitDialog" OnExit="success" />
        </InstallUISequence>

        <AdminUISequence>
            <Show Dialog="MyExitDialog" OnExit="success" />
        </AdminUISequence>
    </UI>
</Fragment> 
```

我知道您正在寻找解决方案，而不是指针。但是，使用我引用的文章作为关键起点，我认为您可以在现成的 WixUI 位中找到所需的所有部分，或者通过替换小块“开箱即用”的东西就像我一样。祝你好运。

# c# - C# 在后台工作线程 DoWork() 中加入线程

> ID：829865
> 
> 赞同：0
> 
> 时间：2009-05-06T14:25:12.643
> 
> 标签：c#, multithreading, join, backgroundworker

在我的 DoWork() 函数中，我向我们的 sip 服务器注册。然后我必须等待回复。但是，我得到的响应是在另一个事件中收到的。但是，在我能够检查 DoWork() 中的标志之前，DoWork() 已经准备就绪，并且响应随之而来。

我试图找到一种方法来等待 DoWork() 直到我在诊断事件中得到响应。我有一个在该事件中设置的全局标志，我必须检查 DoWork()。

感谢您的任何建议，

```
// Do work in background worker
//Will return less than 8 if there are no error message from the library 
        if (!this.bgwProcessLogin.CancellationPending)
        {
                // Register and wait for response
                VaxSIPUserAgentOCX.RegisterToProxy(3600);
        }
        else
        {
                // Update label
                if (this.lblRegistering.InvokeRequired)
                {
                  // do something here
                }
                else
                {
                    // Display error
                }
         }

// WAIT FOR A RESPONSE FROM THE DIAGNOTIC EVENT BEFORE CONTINUING - MAYBE JOIN HERE
        if (!this.bgwProcessLogin.CancellationPending)
        {
            if (this.responseFlag)
            {
                // Do something here   
            }
            else
            {
                // Do something else here
            }
        }

// Another function where I receive the response
private void VaxSIPUserAgentOCX_OnIncomingDiagnostic(object sender, AxVAXSIPUSERAGENTOCXLib._DVaxSIPUserAgentOCXEvents_OnIncomingDiagnosticEvent e)
    {
        string messageSip = e.msgSIP;
        //Find this message in the sip header

        string sipErrorCode = "600 User Found"; 
        if (messageSip.Contains(sipErrorCode))
        {
            // Set global flag for response
            this.responseFlag = true;
        }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T14:41:57.720

您可以使用[ManualResetEvent](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent_methods.aspx)。一旦您的代码遇到 WaitOne 调用，它将阻塞，直到事件被设置。WaitOne 调用也超载，因此您可以在需要时提供等待的持续时间。

```
void SomeFunction()
{
// Do work in background worker
//Will return less than 8 if there are no error message from the library 
        if (!this.bgwProcessLogin.CancellationPending)
        {
                // Register and wait for response
                VaxSIPUserAgentOCX.RegisterToProxy(3600);
        }
        else
        {
                // Update label
                if (this.lblRegistering.InvokeRequired)
                {
                  // do something here
                }
                else
                {
                    // Display error
                }
         }

// WAIT FOR A RESPONSE FROM THE DIAGNOTIC EVENT BEFORE CONTINUING - MAYBE JOIN HERE

        waitEvent.WaitOne();
        if (!this.bgwProcessLogin.CancellationPending)
        {
            if (this.responseFlag)
            {
                // Do something here   
            }
            else
            {
                // Do something else here
            }
        }
}

ManualResetEvent waitEvent = new ManualResetEvent(false);

// Another function where I receive the response
private void VaxSIPUserAgentOCX_OnIncomingDiagnostic(object sender, AxVAXSIPUSERAGENTOCXLib._DVaxSIPUserAgentOCXEvents_OnIncomingDiagnosticEvent e)
    {
        string messageSip = e.msgSIP;
        //Find this message in the sip header

        string sipErrorCode = "600 User Found"; 
        if (messageSip.Contains(sipErrorCode))
        {
            // Set global flag for response
            this.responseFlag = true;
            waitEvent.Set();
        }
} 
```

# asp.net - 带有网络服务的亚音速

> ID：829866
> 
> 赞同：0
> 
> 时间：2009-05-06T14:25:13.440
> 
> 标签：asp.net, vb.net, web-services, subsonic

我试图让亚音速在网络服务中运行我不知道如何返回数据。当它返回任何东西而不是值时，我只会在结果中得到 Object 一词。我错过了什么？

```
<WebMethod(Description:="Method to retrieveCptCode subsonic List")> _
Public Function GetSubCptCodes() As CPTCodeCollection

    Dim coll As CPTCodeCollection = New CPTCodeCollection()
    Dim qry As Query = New Query(CPTCode.Schema)
    coll.LoadAndCloseReader(qry.ExecuteReader())
    Return coll

End Function 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T15:08:24.583

SubSonic + WebService 有一些缺点需要注意。我认为最成功的方法并没有直接返回 SubSonic 对象，而是使用类似的东西`return coll.ToDataTable().`

米奇解释了一些陷阱：

[http://www.enterpriseetc.com/post/SubSonic-Take-2.aspx](http://www.enterpriseetc.com/post/SubSonic-Take-2.aspx)

该线程讨论使用 WCF 而不是“旧 Web 服务”模型

[http://forums.subsonicproject.com/forums/t/542.aspx](http://forums.subsonicproject.com/forums/t/542.aspx)

# c# - 从同一类中的其他构造函数调用构造函数

> ID：829870
> 
> 赞同：146
> 
> 时间：2009-05-06T14:25:59.053
> 
> 标签：c#, constructor

我有一个有 2 个构造函数的类：

```
public class Lens
{
    public Lens(string parameter1)
    {
        //blabla
    }

    public Lens(string parameter1, string parameter2)
    {
       // want to call constructor with 1 param here..
    }
} 
```

我想从第二个构造函数中调用第一个构造函数。这在 C# 中可能吗？

* * *

## 回答 #1

> 赞同：226
> 
> 时间：2009-05-06T14:27:51.530

附加`:this(required params)`在构造函数的末尾以执行**“构造函数链接”**

```
public Test( bool a, int b, string c )
    : this( a, b )
{
    this.m_C = c;
}
public Test( bool a, int b, float d )
    : this( a, b )
{
    this.m_D = d;
}
private Test( bool a, int b )
{
    this.m_A = a;
    this.m_B = b;
} 
```

来源[csharp411.com提供](http://www.csharp411.com/constructor-chaining/)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-05-06T14:28:55.537

是的，您将使用以下内容

```
public class Lens
{
    public Lens(string parameter1)
    {
       //blabla
    }

    public Lens(string parameter1, string parameter2) : this(parameter1)
    {

    }
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2016-03-29T19:46:41.183

链接构造函数时还必须考虑构造函数求值的顺序：

借用 Gishu 的回答，有点（保持代码有点相似）：

```
public Test(bool a, int b, string c)
    : this(a, b)
{
    this.C = c;
}

private Test(bool a, int b)
{
    this.A = a;
    this.B = b;
} 
```

如果我们`private`稍微改变构造函数中执行的求值，我们就会明白为什么构造函数排序很重要：

```
private Test(bool a, int b)
{
    // ... remember that this is called by the public constructor
    // with `this(...`

    if (hasValue(this.C)) 
    {  
         // ...
    }

    this.A = a;
    this.B = b;
} 
```

上面，我添加了一个虚假的函数调用，用于确定属性是否`C`具有值。乍一看，它似乎`C`有一个值——它是在调用构造函数中设置的；但是，重要的是要记住构造函数是函数。

`this(a, b)``public`在执行构造函数的主体之前被调用 - 并且必须“返回” 。换句话说，最后调用的构造函数是评估的第一个构造函数。在这种情况下，`private`在之前评估`public`（只是使用可见性作为标识符）。

# mysql - 在表格上生成报告的最佳方法

> ID：829881
> 
> 赞同：1
> 
> 时间：2009-05-06T14:27:56.910
> 
> 标签：mysql, report

问题是：我有一个包含详细信息的表，用户在注册或更新个人资料或参加不同的考试时使用此表。我需要的报告会有一些计算，比如总分。我会认为最好是创建新表，以包含我需要的报告，或者最好在同一张表上工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T16:12:01.060

你能提供任何进一步的细节吗？您要查询的表中有哪些可用字段？您希望如何显示此信息？在网站上？为了报告？

根据您的描述，您需要两张桌子。一个表（让我们称之为*'users'*）将包含有关每个用户的信息，另一个将包含实际考试成绩（让我们将此表称为*'results'*）。

*'user'*表中的每个人都有一个唯一的 ID 号（我称之为**UID**）来识别他们，*'results'*表中的每个分数也有与分数相关的人的 UID。*通过在“结果”*表中包含用户的 UID，您可以链接无限数量的结果（称为一对多关系）。

“*用户”*表可能如下所示：

```
userUID (UID for each person) | Name | User Details
1 | Barack Obama | President 
2 | George Bush | Ex-President 
```

“*结果”*表可能如下所示：

```
UID for each exam | userUID (UID of the person who look the test) | Score
1 | 1 | 85
2 | 2 | 40    
3 | 1 | 82
4 | 2 | 25 
```

我总是喜欢为考试之类的事情添加 UID，因为它可以让您轻松找到特定的考试结果。

无论如何...获取 Barack Obama 的所有结果的查询如下所示：

```
SELECT Score From 'results' WHERE userUID = 1 
```

要获得 George Bush 的结果，只需将 userUID 更改为 2。显然，在运行此查询之前，您需要知道用户的 UID (userUID)。

请注意，这些是非常基本的示例（涉及虚构人物；））。您可以轻松地将汇总分数字段添加到*“用户”*表，并在每次将新结果添加到*“结果”*表时更新该字段。根据您的代码设置方式，这可以为您节省查询。

祝你好运 - 希望这会有所帮助！

# .net - .net 中的开源文档管理系统？

> ID：829888
> 
> 赞同：13
> 
> 时间：2009-05-06T14:29:28.890
> 
> 标签：.net, open-source

是否有任何基于 .NET 的开源文档管理系统？我们发现了大量基于 Java 的开源 DMS，但在 .NET 上却没有。

另外，请注意，我们寻找的不是（Web）内容管理解决方案，而是文档管理。

谢谢你，卡塔林

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-09-28T09:25:42.927

我建议您查看[Sense/Net](http://sensenet.com/) - 它是免费和开源的。

它是少数支持办公协议文档管理的开源软件之一。因此，您只需单击站点上的链接，它就会自动使用 Microsoft Office 打开您的文件。它还支持版本控制和许多其他功能。

您可以在这里查看他们的源代码和版本：http:
[//sensenet.codeplex.com/](http://sensenet.codeplex.com/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T15:06:48.923

这里有几个：

[http://sourceforge.net/projects/doclib/](http://sourceforge.net/projects/doclib/)

[http://sourceforge.net/projects/clic-dms/](http://sourceforge.net/projects/clic-dms/)

[http://sourceforge.net/projects/dotdms/](http://sourceforge.net/projects/dotdms/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-06T16:48:41.567

问题是，你真的需要开源吗？还是只是不花钱？

如果是后者，那么 Windows Sharepoint Services (WSS) 是一个相当不错的 DMS。它从微软免费获得，如果需要，您可以编写 .NET 代码来增强它。它没有 Office Sharepoint 的所有内容，但非常好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T16:15:19.523

如果您正在寻找提供大量功能的独立应用程序，我会支持 Perceptive Software 的 ImageNow。它并不完全建立在 .NET 之上，因为它都是 Visual C++。它具有基于桌面和基于 Web 的文档管理解决方案。 [现在图像](http://www.imagenow.com)

# sql - * 和显式字段列表的结果不同？

> ID：829890
> 
> 赞同：3
> 
> 时间：2009-05-06T14:29:51.603
> 
> 标签：sql, sql-server, recursion

当我在 Sql Server 2005 中遇到这种行为时，我正在探索[另一个问题。这个查询将耗尽最大递归：](https://stackoverflow.com/questions/829514/prevent-recursive-cte-visiting-nodes-multiple-times)

```
with foo(parent_id,child_id) as (
    select parent_id,child_id
    from #bar where parent_id in (1,3)
    union all
    select #bar.* -- Line that changed
    from #bar
    join foo on #bar.parent_id = foo.child_id
)
select * from foo 
```

但这会很好用：

```
with foo(parent_id,child_id) as (
    select parent_id,child_id
    from #bar where parent_id in (1,3)
    union all
    select #bar.parent_id, #bar.child_id -- Line that changed
    from #bar
    join foo on #bar.parent_id = foo.child_id
)
select * from foo 
```

这是 Sql Server 中的错误，还是我忽略了什么？

这是表定义：

```
if object_id('tempdb..#bar') is not null
    drop table #bar

create table #bar (
    child_id int,
    parent_id int
)

insert into #bar (parent_id,child_id) values (1,2)
insert into #bar (parent_id,child_id) values (1,5)
insert into #bar (parent_id,child_id) values (2,3)
insert into #bar (parent_id,child_id) values (2,6)
insert into #bar (parent_id,child_id) values (6,4) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T14:46:00.517

**编辑**

我想我知道发生了什么，并且是一个很好的例子，说明为什么首先要避免选择 *。

您首先使用 childId 然后 parentId 定义了您的表，但是 CTE Foo 期望 parentId 然后是 childId，

所以基本上当你说选择#bar。*你说选择childId，parentId但是你把它放入parentId，child。当您重新加入自己时，这会产生一个 n 级递归表达式。

所以这不是 SQL 中的错误。

教训的道德：避免选择 * 并省去自己的头疼。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-06T15:00:58.657

我会说这可能是程序员有意选择的安全值，因为您有一个联合，并且联合的所有部分必须具有相同数量的字段。我从不在联合中使用 select *，所以我不能肯定地说。我在 SQL Server 2008 上进行了尝试，并收到以下消息：Msg 205, Level 16, State 1, Line 1 所有使用 UNION、INTERSECT 或 EXCEPT 运算符组合的查询必须在其目标列表中具有相同数量的表达式。

这似乎支持我的理论。

Select * 在任何生产代码中都不是一种糟糕的技术，所以我不明白为什么简单地指定字段会成为问题。

# php - 用于 PHP 的文本到 HTML 转换器

> ID：829894
> 
> 赞同：3
> 
> 时间：2009-05-06T14:31:08.540
> 
> 标签：php, syntax, wysiwyg

你会推荐什么用于 PHP 的文本到 HTML 转换器？

其中一个例子是 Markdown，它在 SO 中使用。用户只需在文本框中输入一些具有自然格式的文本：在行尾输入、在段落末尾输入空行、星号分隔的粗体文本等。这种语法被转换为 HTML 标记。

简单性是我们正在寻找的主要功能，不需要有很多可能性，但那些基本的应该非常直观（自动将 URL 转换为链接、表情符号、段落）。

如果有所见即所得的编辑器，那将是一个很大的优势。就像在 SO 的半所见即所得会更好。

如果它与 Zend 框架很好地匹配，那就是加分项。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T14:46:07.850

请访问[http://en.wikipedia.org/wiki/Lightweight_markup_language](http://en.wikipedia.org/wiki/Lightweight_markup_language)进行选择。

至于 Markdown，我一直在使用一种名为[PHP Markdown](http://michelf.com/projects/php-markdown/)的 PHP 解析器，我特别喜欢[Extra 扩展](http://michelf.com/projects/php-markdown/extra/)。

实际上，我已经尝试使用我自己的（未记录的）功能来扩展它。[如果您有兴趣，可以在 GitHub 上找到](http://github.com/wolfie/php-markdown/tree/extra)它（请记住，这是我修复的额外分支，而不是 masterR）。我打算让它成为一个“适当的分支”有一段时间了，但那是另一个，很大程度上是离题的故事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T14:53:14.340

Zend 框架有一个 WYSIWYG 编辑器与它的 Dojo 集成捆绑在一起。

[http://framework.zend.com/manual/en/zend.dojo.form.html#zend.dojo.form.elements.editor](http://framework.zend.com/manual/en/zend.dojo.form.html#zend.dojo.form.elements.editor)

... 带上加分！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:47:34.180

总是有[纺织品](http://en.wikipedia.org/wiki/Textile_(markup_language))。它被广泛实施，并且与 Markdown 有一些基本的相似之处。但是，我从未见过 Textile 的 WYSIWYG 编辑器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T14:53:59.127

您可能会发现[上流](http://github.com/troelskn/upflow/tree/master)很有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T19:52:52.730

[如果你想要所见即所得，我是FCKeditor](http://www.fckeditor.net/)的忠实粉丝。它在提交表单之前而不是之后将用户输入转换为 HTML，但它有一个很好的 PHP 库来使用它，以及一个用于处理文件上传/浏览的 PHP 连接器（以及其他几种语言）。

如果你想要一些可以作为纯文本读取但输出为 HTML 的东西，我投票支持 Markdown。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T14:36:05.223

我会坚持我最初采用 Texy 的想法。

这里提到的所有产品都没有真正超越它。我对 Texys 语法有疑问，但它似乎很标准，并且也存在于其他产品中。

它非常轻巧，支持非常自然的语法，并具有出色的“一半”所见即所得编辑器[Texyla](http://code.google.com/p/texyla/)（wiki 仅在捷克语中）

# vbscript - VB 脚本文本文件前置

> ID：829897
> 
> 赞同：3
> 
> 时间：2009-05-06T14:31:21.037
> 
> 标签：vbscript, batch-file, text-files

任何人都知道如何使用 VB 脚本或 Bat 文件快速将（添加两行新文本）添加到现有文本文件的开头？最优雅的解决方案得到了勾选。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T14:51:24.513

这个怎么样：

```
Dim fso, f
Set fso = CreateObject("Scripting.FileSystemObject")

Set f = fso.OpenTextFile("test.txt", 1)
ReadAllTextFile =   f.ReadAll
Set f = fso.OpenTextFile("test.txt", 2, True)
f.WriteLine("Blaaa")
f.WriteLine("Blaaaa some more...")
f.Write(ReadAllTextFile) 
```

**资料来源：** [泰克提示](http://www.tek-tips.com/viewthread.cfm?qid=1144240&page=1)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T15:01:59.747

查看 José Basilios 的答案以获取代码和对 FSO 的参考。你将使用它。

*但是*：我不会走这`ReadAllTextFile = f.ReadAll`条路，因为那可能是几千兆字节（谁知道？）。

*代替*：

1.  打开一个新文件
2.  写前置行
3.  从旧文件逐行读取，写入新文件
4.  （关闭两个文件）
5.  删除旧文件
6.  重命名新文件 -> 旧文件

# inheritance - UML 中的构造型和类继承有什么区别？

> ID：829904
> 
> 赞同：22
> 
> 时间：2009-05-06T14:32:53.373
> 
> 标签：inheritance, uml, stereotype

我对 UML 中的“刻板印象”和“超类”之间的区别感到困惑。

假设我想创建一个包含“ `WidgetMaker`.” 的图表。`WidgetMaker`显然是一个`Actor`所以 UML 标准是刻板印象它的演员：

```
<<Actor>> WidgetMaker 
```

但我是在 Java/Ruby/C++ 世界中长大的。在那个世界里，关系是：

```
class Actor
end

class WidgetMaker < Actor
end 
```

在 UML 中看起来像这样：

```
 Actor
    ^
    |
WidgetMaker 
```

所以我的问题是：当你可以使用类继承轻松地对这些概念进行建模时，为什么 UML 有原型，它*也*有。

一旦我们有了更多“种类”的演员，问题就变得更加模糊：

```
 Actor
                ^
                |
    ------------------------
    |           |          |
  Person      Robot      Group
    ^
    |
WidgetMaker 
```

相对

```
<<Actor>> <<Person>> WidgetMaker 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-10-02T06:01:25.320

据我了解，构造型的主要目的是支持 UML 本身的扩展（作为一种建模语言），而不是建模任何东西。

话虽如此，我还认为您的问题暗示了另一个可能的有效答案：有些人更喜欢使用刻板印象来指定（非正式地！）类之间的某些共性。他们可能会这样做只是因为它比子类化更容易并且对于他们的模型而言“足够好”。

例如，许多软件系统都有代表所谓领域实体（如公司、客户、采购订单、产品等）的类。最终，您**可能**希望有一个通用类，例如`Entity`从中派生`Company`等`Customer`。但最初，仅使用诸如此类的定型类可能就足够了`<<Entity>> Company`。`<<Entity>> Customer`本质上，这只是建模工作的方便（和成本/收益！）问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-18T16:38:54.317

在您的示例中，Actor 可能不需要作为一个类来实现，但这可能会或并非总是如此。刻板印象是可以应用于大多数 UML 元素的抽象，而不仅仅是类。

它们封装语义而不暗示这些语义将如何提供。另一个例子可能是一个原型为 HTTP 或 RPC 的通信通道。他们正在与读者交流如何提供一些东西，而不会使模型变得复杂，并增加不必要的细节。

UML 规范提供了许多预定义的构造型，但它们的真正威力来自能够通过配置文件定义您自己的构造型。您可以将域对象标记为 EJB，以节省您自己指定所有样板代码的时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:36:37.640

刻板印象存在并用于呈现有关工件的更多信息，文档或将其分类到特定工件块中可能无法提供。例如，您已经确定了一个数据类，您可以给它命名，解释属性和操作，但它本身可能不会给出完整的信息。当您将其定型为 <> 时，它指定了完整的信息；在此之前，它会像开发人员的任何其他类一样继续存在。

“原型用于扩展 UML 符号元素，对关联、继承关系、类和组件进行分类和扩展”

Stereotype 提供了创建新型建模元素的能力。刻板印象必须基于作为 UML 元模型一部分的元素。类的一些常见原型是实体、边界、控制、实用程序和异常。类的原型显示在用 guillemets 括起来的类名下方（即`«`，和`»`，发音为*gee-may*）。如果需要，图形图标或特定颜色可以与原型相关联。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-02-11T21:05:23.073

从 OMG 如何在 SysML 或 BPMN 配置文件中应用它们可以很好地表明刻板印象背后的意图。具体来说，构造型描述了一组新的建模结构，作为指定域的语言的一部分。例如，SysML 中的 Block 是应用于 Class 的原型。它带来了用于系统工程的类的定制。在这种情况下，它取代了类的使用，并建立了与其他元素和图表类型的新关系，例如块<<满足>>要求（允许的关系）或块可以使用内部框图建模（允许的行为）。刻板印象不用于模拟您的主题空间。它将建模构造的使用分类为系统定义的垂直或水平方面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-09-20T21:39:51.147

我觉得谈论刻板印象而不将 MOF METALEVELS 带入讨论中，实际上无法解释关键点。

刻板印象在 M2 中“存在”（参见“OMG Unified Modeling Language (OMG UML), Infrastructure, Verison 2.4.1”），它专门用于定义建模语言。刻板印象生活在这个级别，而不是在 M1 或 M0 中。换句话说，刻板印象是一种专门用于定义新建模语言的结构，而不是用于定义新领域模型。

因此，在级别 M1 中用泛化替换刻板印象在域建模范围内可能在语义上是可以的，但由于它位于错误的元级别，因此在语义上并不完全等效。

另一点是，刻板印象可能是可选的或强制性的。然而，继承不能是可选的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2018-03-27T15:00:38.167

根据 [https://sites.google.com/site/assignmentssolved/mca/semester2/mc0069/10](https://sites.google.com/site/assignmentssolved/mca/semester2/mc0069/10) 如果您想要标记值，您需要将它们定义为原型上的属性（因为 UML 2.0 是必需的）

> 在 UML 1.3 中，标记值可以扩展模型元素而不需要存在构造型。在 UML 1.4 中，尽管仍受支持，但已弃用此功能，仅出于向后兼容性的原因才使用此功能。
> 
> 从 UML 2.0 开始，标记值只能表示为在构造型上定义的属性。因此，模型元素必须通过构造型扩展才能通过标记值进行扩展。为了支持与 UML 1.3 的兼容性，一些 UML 工具可以自动定义一个原型，“未附加的”属性（标记值）将附加到该原型。
> 
> 标记值可以显示在原型名称下的类隔间中。对于要显示其值的每个应用的构造型，都需要一个额外的隔间。每个这样的隔间都以 guillemets 中应用的刻板印象的名称为标题。

从 2003 年开始，关于刻板印象的有趣读物可能是 [https://www.semanticscholar.org/paper/Systematic-stereotype-usage-Atkinson-K%C3%BChne/3253db03c11f4f99be580277716d3b78d750618a](https://www.semanticscholar.org/paper/Systematic-stereotype-usage-Atkinson-K%C3%BChne/3253db03c11f4f99be580277716d3b78d750618a)

这是摘要：

> 作为 UML 的主要扩展机制之一，构造型在 UML 服务于广泛且不断增长的用户群的能力中起着至关重要的作用。然而，刻板印象的确切含义及其预期的使用方式从未完全清楚，甚至在专家之间引发了激烈的争论。在实践中观察到了使用 UML 原型的两种基本方法：一种支持类分类作为模拟元模型扩展的一种手段，另一种支持对象分类作为为其分配某些属性的一种手段。在本文中，我们分析了这两种公认的刻板印象使用场景，并解释了明确识别第三种使用场景的基本原理。我们提出了一些符号概念，可用于明确区分三种使用场景，并提供关于何时应该使用每种场景的启发式方法。最后，我们提出了对 UML 的增强，它可以干净简洁地支持所有三种形式。

# jsf - JSF 片段使图像在面板网格中居中

> ID：829911
> 
> 赞同：2
> 
> 时间：2009-05-06T14:33:35.947
> 
> 标签：jsf

我正在尝试编写一些 JSF 代码，将图像集中在面板网格中。简单的方法似乎是：

```
<h:panelGrid columns="1" style="text-align:center">
  <h:graphicImage value="/path/to/image.png" />
</h:panelGrid> 
```

但这种方法似乎不起作用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T14:53:54.663

将 div 与 align=center 一起使用

或者使用 CSS：

JSF

```
<h:panelGrid styleClass="centered">
    ...
</h:panelGrid>

CSS

.centered {
    margin: 0px auto;
} 
```

# python - Mosso Python 模块

> ID：829916
> 
> 赞同：1
> 
> 时间：2009-05-06T14:35:07.330
> 
> 标签：python, module, mosso, cloudfiles

有没有人成功安装 Mosso (cloudfiles) python 模块？我正在尝试安装它并收到以下错误。

```
python-cloudfiles-1.3.1]# python setup.py install
running install
running build
running build_py
running install_lib
byte-compiling /usr/lib/python2.3/site-packages/cloudfiles/container.py to container.pyc
  File "/usr/lib/python2.3/site-packages/cloudfiles/container.py", line 74
    @requires_name(InvalidContainerName)
    ^
SyntaxError: invalid syntax
byte-compiling /usr/lib/python2.3/site-packages/cloudfiles/storage_object.py to storage_object.pyc
  File "/usr/lib/python2.3/site-packages/cloudfiles/storage_object.py", line 85
    @requires_name(InvalidObjectName)
    ^
SyntaxError: invalid syntax 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T14:45:39.113

看起来您正在运行 2.4 之前的 Python 版本 - 它所抱怨的语法（@ 符号，称为“装饰器”）是在 Python 2.4 中引入的。

# c++ - C ++中的延迟构造函数

> ID：829919
> 
> 赞同：2
> 
> 时间：2009-05-06T14:35:40.480
> 
> 标签：c++, constructor, default

我一直在查看一些看起来像这样的代码：

```
class A; // defined somewhere else, has both default constructor and A(int _int) defined
class B
{
public:
    B(); // empty
    A a;
};

int main()
{
     B* b;
     b = new B();
     b->a(myInt); // here, calling the A(int _int) constructor,
     //but default constructor should already have been called
} 
```

这行得通吗？在调用默认构造函数后调用特定构造函数？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-06T14:40:20.907

该代码不调用 a 的构造函数。它调用`A::operator()(int)`.

但是*，如果*您在已构建的对象上显式调用构造函数，那么您将进入未定义的行为领域。它在实践中似乎可行，但不能保证它会达到您的预期。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T14:40:49.283

您可以在 B 类中创建另一个构造函数

**B(int _int):a(_int) {}**

在这种情况下，当您编写 b = new B(myInt);

上面的代码不会延迟你的 A 类的构造函数代码。

你不需要调用 b->a(myInt)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:40:24.977

这不是在调用构造函数，[这个](https://stackoverflow.com/questions/829919/delayed-constructor-in-c/829937#829937)答案涵盖了对正在发生的事情的唯一可能解释。

在现有对象上调用构造函数的唯一标准方法是使用placement new，（在前一个实例被破坏之后）：

```
void foo (A * a) {
  a->~A ();           // Destroy previous instance
  new (a) A(myInt);   // Construct new object in same location
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T14:46:31.860

您应该只从 B() 构造函数中调用 A(int) 构造函数，或者创建一个也调用 A(int) 的 B(int) 构造函数。

最佳实践是两者都有，默认一个为 A 设置默认 int，而 B(int) 一个为初始化 A(int)。

# sql - MySQL更改外键类型

> ID：829928
> 
> 赞同：17
> 
> 时间：2009-05-06T14:37:31.177
> 
> 标签：sql, mysql, foreign-keys

我正在使用 MySQL，并且我有一个带有索引的表，该索引在许多其他表中用作外键。我想更改索引的数据类型（从有符号整数到无符号整数），最好的方法是什么？

我尝试更改索引字段上的数据类型，但失败了，因为它被用作其他表的外键。我尝试更改其中一个外键的数据类型，但失败了，因为它与索引的数据类型不匹配。

我想我可以手动删除所有外键约束，更改数据类型并重新添加约束，但这将是很多工作，因为我有很多表使用这个索引作为外键。有没有办法在进行更改时暂时关闭外键约束？另外，有没有办法获取引用索引作为外键的所有字段的列表？

**更新：** 我在关闭外键检查后尝试修改一个外键，但似乎并没有关闭检查：

```
SET foreign_key_checks = 0;

ALTER TABLE `escolaterrafir`.`t23_aluno` MODIFY COLUMN `a21_saida_id` INTEGER DEFAULT NULL; 
```

这是错误：

```
------------------------
LATEST FOREIGN KEY ERROR
------------------------
090506 11:57:34 Error in foreign key constraint of table escolaterrafir/t23_aluno:
there is no index in the table which would contain
the columns as the first columns, or the data types in the
table do not match to the ones in the referenced table
or one of the ON ... SET NULL columns is declared NOT NULL. Constraint:
,
  CONSTRAINT FK_t23_aluno_8 FOREIGN KEY (a21_saida_id) REFERENCES t21_turma (A21_ID) 
```

索引表的定义：

```
DROP TABLE IF EXISTS `escolaterrafir`.`t21_turma`;
CREATE TABLE  `escolaterrafir`.`t21_turma` (
  `A21_ID` int(10) unsigned NOT NULL auto_increment,
  ...
) ENGINE=InnoDB AUTO_INCREMENT=51 DEFAULT CHARSET=latin1; 
```

以及具有指向它的外键的表：

```
DROP TABLE IF EXISTS `escolaterrafir`.`t23_aluno`;
CREATE TABLE  `escolaterrafir`.`t23_aluno` (
  ...
  `a21_saida_id` int(10) unsigned default NULL,
  ...
  KEY `Index_7` (`a23_id_pedagogica`),
  ...
  CONSTRAINT `FK_t23_aluno_8` FOREIGN KEY (`a21_saida_id`) REFERENCES `t21_turma` (`A21_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=387 DEFAULT CHARSET=latin1; 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-02-22T12:04:37.777

这是我对这个线程的小贡献。感谢 Daniel Schneller 的启发，并为我提供了很大一部分解决方案！

```
set group_concat_max_len = 2048;
set @table_name = "YourTableName";
set @change = "bigint unsigned";
select distinct table_name,
       column_name,
       constraint_name,
       referenced_table_name,
       referenced_column_name,
       CONCAT(
           GROUP_CONCAT('ALTER TABLE ',table_name,' DROP FOREIGN KEY ',constraint_name SEPARATOR ';'),
           ';',
           GROUP_CONCAT('ALTER TABLE `',table_name,'` CHANGE `',column_name,'` `',column_name,'` ',@change SEPARATOR ';'),
           ';',
           CONCAT('ALTER TABLE `',@table_name,'` CHANGE `',referenced_column_name,'` `',referenced_column_name,'` ',@change),
           ';',
           GROUP_CONCAT('ALTER TABLE `',table_name,'` ADD CONSTRAINT `',constraint_name,'` FOREIGN KEY(',column_name,') REFERENCES ',referenced_table_name,'(',referenced_column_name,')' SEPARATOR ';')
       ) as query
from   INFORMATION_SCHEMA.key_column_usage
where  referenced_table_name is not null
   and referenced_column_name is not null
   and referenced_table_name = @table_name
group by referenced_table_name 
```

通过设置@table_name 和@change，您可以生成查询。@table_name 应该是具有主键的表的表名（它将查找使用该列作为外键的表）并将其类型更改为@change。

我不得不像这样改变几张桌子，所以这就像一个魅力。我只需要更改@table_name 然后执行查询。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-12T17:05:27.703

为了回答我自己的问题，我找不到更简单的方法来做到这一点。我最终删除了所有外键约束，更改了字段类型，然后添加了所有外键约束。

正如 R. Bemrose 所指出的，使用`SET foreign_key_checks = 0;`仅在添加或更改数据时有帮助，但不允许`ALTER TABLE`使用会破坏外键约束的命令。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T15:04:12.067

要了解外键约束的使用，请对`INFORMATION_SCHEMA`数据库发出以下查询：

```
select distinct table_name, 
       column_name, 
       constraint_name,  
       referenced_table_name, 
       referenced_column_name 
from   key_column_usage 
where  constraint_schema = 'XXX' 
   and referenced_table_name is not null 
   and referenced_column_name is not null; 
```

替换`XXX`为您的架构名称。这将为您提供将其他列作为外键引用的表和列的列表。

不幸的是，架构更改是非事务性的，所以我担心您确实必须暂时禁用此操作的 foreign_key_checks。我建议 - 如果可能的话 - 在此阶段阻止来自任何客户端的连接，以最大程度地减少意外违反约束的风险。

至于键本身：当您更改表数据类型时，它们也需要被删除和重新创建。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-03T10:27:36.277

如果您可以停止数据库，然后尝试将表转储到文本文件，在文件中手动更改列定义并重新导入表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T14:48:15.443

您可以通过键入暂时禁用外键

```
SET foreign_key_checks = 0; 
```

并重新启用它们

```
SET foreign_key_checks = 1; 
```

我认为这需要管理员权限，因为它旨在将数据导入数据库。

**编辑**：作为对您的编辑的反应，它似乎只禁用了 DML 语句（插入、更新、删除）的约束，而不是 DDL 语句（更改表、删除表等）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-05-08T18:28:33.693

这也是我对这个线程的小贡献。感谢 Daniel Schneller 和 Wiktor Jarka 的启发，并为我提供了很大一部分解决方案！此解决方案修复了数据库和自动增量问题。

```
SET group_concat_max_len = 2048;
SET @database_name = "my_database";
SET @table_name = "my_table";
SET @change = "tinyint unsigned";
SELECT DISTINCT 
       `table_name`,
       `column_name`,
       `constraint_name`,
       `referenced_table_name`,
       `referenced_column_name`,
       CONCAT(
           GROUP_CONCAT('ALTER TABLE `',table_name,'` DROP FOREIGN KEY `',constraint_name, '`' SEPARATOR ';'),
           ';',
           GROUP_CONCAT('ALTER TABLE `',table_name,'` CHANGE `',column_name,'` `',column_name,'` ',@change SEPARATOR ';'),
           ';',
           CONCAT('ALTER TABLE `',@table_name,'` CHANGE `',referenced_column_name,'` `',referenced_column_name,'` ',@change, ' NOT NULL AUTO_INCREMENT'),
           ';',
           GROUP_CONCAT('ALTER TABLE `',table_name,'` ADD CONSTRAINT `',constraint_name,'` FOREIGN KEY(',column_name,') REFERENCES ',referenced_table_name,'(',referenced_column_name,')' SEPARATOR ';'), 
           ';'
       ) AS query
FROM   `information_schema`.`key_column_usage`
WHERE  `referenced_table_name` IS NOT NULL
   AND `referenced_column_name` IS NOT NULL
   AND `constraint_schema` = @database_name
   AND `referenced_table_name` = @table_name
GROUP BY `referenced_table_name` 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-09T14:37:50.687

请不要使用上面的答案

1.  group concat 是个坏主意，因为您不控制输出的长度
2.  你应该使用 MODIFY 而不是 CHANGE 因为你不重命名列
3.  其他答案不处理空值，默认值，因此可能会弄乱您的数据库

我的解决方案，处理可空值、默认值、自动增量以及注释：

```
SET @table_schema = "database";
SET @table_name = "table";
SET @column_name = "column";
SET @new_type = "bigint unsigned";

SELECT CONCAT('ALTER TABLE `', table_schema,'`.`', table_name, '` DROP FOREIGN KEY `', constraint_name,  '`;' ) AS drop_fk
FROM information_schema.key_column_usage
WHERE referenced_table_schema =  @table_schema AND referenced_table_name = @table_name and referenced_column_name = @column_name;

SELECT CONCAT('ALTER TABLE `', kcu.table_schema,'`.`', kcu.table_name,'` MODIFY `', kcu.column_name, '` ',
@new_type, 
if(c.is_nullable = 'NO', ' NOT NULL', ' NULL'),
if(c.column_default is not null, CONCAT(' DEFAULT ', QUOTE(c.column_default)), ''),
if(c.extra <> '', CONCAT(' ', c.extra), ''),
if(c.column_comment <> '', CONCAT(' COMMENT ', QUOTE(c.column_comment), ''), ''),
';') AS modify
FROM information_schema.key_column_usage AS kcu
JOIN information_schema.columns AS c ON c.table_schema=kcu.table_schema AND c.table_name=kcu.table_name AND c.column_name=kcu.column_name
WHERE kcu.referenced_table_schema = @table_schema AND kcu.referenced_table_name = @table_name AND kcu.referenced_column_name = @column_name;

SELECT CONCAT('ALTER TABLE `', table_schema,'`.`',table_name,'` ADD CONSTRAINT `',constraint_name ,'` FOREIGN KEY (`', column_name, '`) REFERENCES `',
referenced_table_schema ,'`.`', referenced_table_name , '` (`', referenced_column_name,'`);') AS create_fk
FROM information_schema.key_column_usage
WHERE referenced_table_schema = @table_schema AND referenced_table_name = @table_name AND referenced_column_name = @column_name; 
```

# css - 当 font-family 回退时 CSS 字体大小会发生变化

> ID：829933
> 
> 赞同：15
> 
> 时间：2009-05-06T14:39:14.747
> 
> 标签：css

我想使用一种字体（gill sans），由于 x 高度短等而呈现非常小的字体。如果我将其设置为合理的大小，然后浏览器会退回到我在中指定的更典型的字体字体系列，后备字体呈现非常大 - 我可以根据浏览器使用的字体设置字体大小吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-11-07T16:14:46.523

我在使用 Calibri 时遇到了同样的问题（与大多数 sans 字体相比略小）。我最终做了以下事情（假设你有 jquery）：

1.  获取 Remy Sharp 的字体检测脚本[http://remysharp.com/2008/07/08/how-to-detect-if-a-font-is-installed-only-using-javascript/](http://remysharp.com/2008/07/08/how-to-detect-if-a-font-is-installed-only-using-javascript/)

2.  将以下内容添加到`$(document).ready()`函数中：

    ```
    $(document).ready(function() {
        font.setup();
        if(!font.isInstalled('Calibri'))
            $('body').css('font-size','87.5%');
    }); 
    ```

所以现在如果用户没有 Calibri，我们会看到 Arial 为 87.5%。这仅适用于未定义/继承字体大小的元素。无论在哪里明确定义了字体大小，都必须进行调整（可能为这些元素添加一个类并将 jquery 选择器更改为`$('.adjustClass'))`.

如果你能这样做会很好： `font:11px Calibri, 10px Arial;`-但没有这样的运气:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T14:43:50.303

我建议您尝试指定在字体不可用时优雅降级的级联字体，例如

```
Arial, FontThatsLikeArial, FontThatsALittleLikeArial, FontThatsALittleLessLikeArial, Sans-serif; 
```

或者，如果您想严格控制字体，请查看 cufon，它不需要您的用户拥有任何插件并且可以在大多数现代浏览器上运行。[https://github.com/sorccu/cufon/wiki/about](https://github.com/sorccu/cufon/wiki/about)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T18:54:03.497

几周前有一篇有趣的文章讨论了这个话题。

你可以在这里阅读这篇文章：http: [//kilianvalkhof.com/2009/css-xhtml/combining-cufon-and-font-face/](http://kilianvalkhof.com/2009/css-xhtml/combining-cufon-and-font-face/)

简而言之，这篇文章使用了一些方法……@font-face 用于现代化浏览器，jQuery 字体检测脚本，如果先前的方法失败，则使用 Cufon 进行字体替换。

这不是一个完美的解决方案。就像我上面的许多人所说的那样，你最好的选择是使用优雅降级的字体。

尝试将字体堆栈设置为“GillSans, Calibri, Trebuchet, sans-serif” - 用于段落复制，或“GillSans, Trebuchet, Calibri, sans-serif” - 用于标题和标题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T17:17:21.700

我建议您使用在访问您正在构建的网站的大多数（/所有）机器上找到的典型字体。网站的视图不应该因为浏览器而有所不同（与IE相关的问题是另一个话题......）。使用通用字体或类似的替代字体...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T17:10:44.303

> 我可以根据浏览器使用的字体设置字体大小吗？

不幸的是，不，不是在 CSS 中。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-06T15:56:26.590

您可以在正文选择器中指定字体大小，从而中和浏览器的默认大小，即

```
body { font-size: 62.5%; } 
```

62.5% 是一个很好的基线，因为它允许您轻松使用 em 来相对设置正文中元素的字体大小。

在 62.5% 时，1em = 10px，1.2em = 12px 等等。

只需将正文中的字体大小设置为基线和相应的样式元素。

# vim - Yank 整个文件

> ID：829935
> 
> 赞同：139
> 
> 时间：2009-05-06T14:39:45.197
> 
> 标签：vim, clipboard, vi

我经常在 gVim 中写一些东西，然后需要将它复制粘贴到另一个应用程序中。

有没有简单的方法来拉整个文件？我通常会做这样的事情

`g``g``V``G``"``+``y`

（转到顶部，视觉线模式，转到底部，猛拉）

但是有没有更好的方法让我错过了？

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2009-05-06T15:08:01.917

我使用以下指令：`:%y+`

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-05-06T14:41:13.213

`ggyG`（转到第一行，拉到最后一行）

编辑：啊，系统剪贴板。不完全从手指上滚下来，但是：`gg"+yG`

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-05-06T15:08:15.643

旧 vi 中的工作解决方案在`:r filename`新文件中。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-05-06T14:41:41.340

另一种方法是这样的：

```
ggyG 
```

到顶部，然后拉到底部。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-11-25T06:24:38.747

我使用以下指令：`:%y`.

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-05-06T14:44:19.587

`ggyG`

（转到顶部，拉到底部）

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-06T14:45:25.107

```
:0,$ y 
```

我不知道哪种方式更容易。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-06T15:00:42.573

或者只是在你的`.vimrc`：

```
nmap <silent> <F5> ggVG"+y 
```

所以你可以只使用一个键:)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-06-15T17:54:42.880

在 OSX 中：

```
ggVG
!tee >(pbcopy) 
```

我觉得比：

```
ggVG
:w !pbcopy 
```

由于它不闪现提示：“ `Press ENTER or type command to continue`”

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-04-06T07:23:22.583

`:%y``+`如果您使用的是**neo-vim** (nvim)，则无需在整个系统上运行。

这让我们避免将手指`+`伸向 - 实际上使这个快捷方式比`ggyG`.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-04-16T16:56:53.950

根据您执行此操作的频率，只需为此映射一个键并可选择添加到 vimrc

```
:nnoremap <F5> :%y 
```

或者

```
:nnoremap <leader><whatever> :%y 
```

或您知道的任何安全且最快的密钥 - 然后添加到映射源或其他任何内容。这样做的好处`ggyG`是它不会移动光标（更快）并且要保留光标位置，您必须添加一个`<Ctrl-o><Ctrl-o>`

人们经常忘记命令是基于会话的，除非在 vimrc 中。我经常知道我什么时候要做很多事情，但不需要它作为默认值，只是`:[mode]remap <whatever> <whatever>`

如果需要，我可以关闭并重新打开 vim。

如果`<Ctrl-A><Ctrl-C>`对您有用，那么您在源代码中使用 mswin.vim 并失去了递增`<Ctrl-a>`和递减`<Ctrl-x>`操作的力量（除其他外）。我从 Windows 开始，很久以前就停止使用 mswin.vim。我个人认为最好以正确的方式了解 Vim，然后添加您真正需要的拐杖：P

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-02-27T15:27:07.327

它很脏，但您根本不必使用 shift 键，只有 3 个不同的键可能更快：

```
gg1111yy 
```

（假设文件短于 1111 行）

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2009-05-06T15:06:50.500

在 Windows 上，我通常只使用 CTRL-A、CTRL-C 将所有内容复制到 Windows 剪贴板……再简单不过了！

我正在使用网站上的标准 gvim 7.1 ...

（顺便说一句：也可以在我的 Mac 上使用 MacVim 和那个有趣的 mac-key+A，mac-key+C）

# sql-server - 报表生成器 1.0 和 MandatoryFilter

> ID：829936
> 
> 赞同：0
> 
> 时间：2009-05-06T14:40:03.573
> 
> 标签：sql-server, reporting-services

我们现在使用 ReportBuilder 1.0 (2005)。

我不了解 MandatoryFilter 设置的工作方式。它不会始终提示过滤器，仅当报表中包含某些字段并且仅当以某种方式选择时。

例如，如果我双击一个实体，它会将所有非计算字段添加到报告中。这会提示输入过滤器。

通过单击字段添加这些相同的字段不会提示输入过滤器。

这似乎不一致。

此外，双击实体会产生所有位于一个“选项卡”下的字段 - 标有表名。如果我单击这些字段，它们每个都有一个标题为字段名称的选项卡。这有什么意义吗？

我试过在MS论坛上提问，但没有回复。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T23:37:12.643

[http://blogs.msdn.com/bobmeyers/archive/2006/12/20/getting-grouping-right-in-report-builder.aspx](http://blogs.msdn.com/bobmeyers/archive/2006/12/20/getting-grouping-right-in-report-builder.aspx)

感谢 MSFT 的 Aaron Meyers 的帮助！

# c# - 二进制数据与字符数据混淆

> ID：829940
> 
> 赞同：2
> 
> 时间：2009-05-06T14:40:35.117
> 
> 标签：c#

好的，所以我有一个函数可以获取图像文件的路径，并且应该将二进制数据作为字符串返回。然后调用者将返回的字符串插入到 XML 元素的内部文本中。

它是否正确？：

```
string dataAsString = "";
using (StreamReader sr = new StreamReader(new FileStream(mergedFile, FileMode.Open, FileAccess.Read, FileShare.Read, 2048, FileOptions.DeleteOnClose)))         
dataAsString = sr.ReadToEnd();  
return dataAsString; 
```

这会返回一些看起来像是合法的二进制数据的东西，但是如果我从目标文件中剪切并粘贴内容，将其粘贴到新的测试 tif 文件中，然后尝试打开 tif 图像，这对我很不满意.. .所以我怀疑我读/写数据的方式有问题。

我真的必须做这样的事情吗？

```
using (BinaryReader br = new BinaryReader(new FileStream(mergedFile, FileMode.Open, FileAccess.Read, FileShare.Read, 1024, FileOptions.None)))      
{
  int blockReadSz = 2048;
  int bytesToRead = (int)br.BaseStream.Length;
  int bytesRead = 0;
  byte[] data = new byte[bytesToRead];
  while (bytesRead < bytesToRead)         
    bytesRead += br.Read(data, bytesRead, blockReadSz);       
} 
```

如果是这样，一旦我读完文件，如何从 byte[] 中获取一个字符串？

谢谢你的帮助！:D

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T14:55:22.197

你所要求的并没有真正的意义。您无法将二进制数据读入字符串。

您可以轻松地将数据读入字节数组，而无需使用`BinaryReader`：

```
byte[] data = File.ReadAllBytes(mergedFile); 
```

如果要将数据放入 XML 文档中，则必须以某种方式将其表示为文本，例如使用 base64 编码：

```
string text = Convert.ToBase64String(data); 
```

您不能只将数据解码为字符串，因为它不是一开始就被编码的字符串。无论您使用什么编码，二进制数据总是可以包含不代表任何由编码文本产生的字节序列。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T14:47:18.190

它将像读取文本一样读取文件，`StreamReader`但事实并非如此。所以是的，您必须使用`BinaryReader`or`FileStream`来读取您的数据。实际上`BinaryReader`这里是多余的。`FileStream`它将自行工作。使用`FileStream.Read`. 由于您的文件看起来足够短，可以放入字符串，因此以下代码应该适合您：

```
using (FileStream fs = new new FileStream(mergedFile, FileAccess.Read))          
{
    int length = (int) fs.Length;
    byte[] data = new byte[length];
    fs.Read(data, 0, length);
    // convert to string here... TBD
} 
```

接下来，您要将二进制数据转换为字符串。这取决于您希望如何表示此字符串。如果它是 ASCII（并且您希望每个字节都转换为字符），您将执行以下操作：

```
string myString = System.Text.Encoding.UTF8.GetString( data ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:46:47.117

你的第二种方法更好。虽然第一种方法可以工作，但您可能会遇到编码问题。

如果需要将数据插入 XML 文档，请使用`Convert.ToBase64String(yourByteArray);`. `byte[]`要从字符串中获取返回值，请使用`Convert.FromBase64String(yourStringFromXML);`

# css - 表中的第一条记录与 IE 中的表头重叠

> ID：829943
> 
> 赞同：0
> 
> 时间：2009-05-06T14:41:01.623
> 
> 标签：css, grails, gsp

创建了一个在 IE6,7 中工作正常的表，但在 FF 中，标题隐藏了第一个数据行。

```
<g:if test="${params.history!=null}">
<div style="width:791px;padding-bottom:10px;overflow-y:auto;${(lstDNCallEntries.size()>0)?'height:100px':''}">
<table class="table">
<thead style="position: absolute;">
 <% params=params.findAll{ k,v -> k != 'sort'} %>
<td class="certify_head" width="87" style="text-align: center">title</td>
<td class="certify_head" width="89" style="text-align: center" >action</td>
            <td class="certify_head" width="66" style="text-align: center" >list</td>
            <td class="certify_head" width="118" style="text-align: center" >selection</td>
            <td class="certify_head" width="110" style="text-align: center" >source</td>
            <td class="certify_head" width="64" style="text-align: center" >${message(code:'phoneoptoutgranularity.gsp~title.user')}</td>
            <td class="certify_head" width="82" style="text-align: center" >Office</td>
            <td class="certify_head" width="90" style="text-align: center" >Effective Date</td>
        </thead>
        <tbody class="scrollContent">
            <g:if test="${lstDNCallEntries.size() > 0}">
                <g:each in="${lstDNCallEntries}" var="phoneHistory" status="i">
                    <tr class="${(i % 2) == 0 ? 'normalRow' : 'alternateRow'}"
                            onMouseOver="this.style.backgroundColor='#ffffd9'"
                            onMouseOut="this.style.backgroundColor=''">
                        <td width="90" align="center" valign="center">${phoneHistory.date}</td>
                        <td width="92" valign="center" style="font: normal 12px Arial, Helvetica, sans-serif;">${phoneHistory.action}</td>
                        <td width="71" align="center" valign="center">${phoneHistory.list}</td>
                        <td width="122" align="center" valign="center">${phoneHistory.preferencekey}</td>
                        <td width="110" align="center" valign="center">${phoneHistory.source}</td>
                        <td width="69" align="center" valign="center">${phoneHistory.user}</td>
                        <td width="85" align="center" valign="center">${phoneHistory.office}</td>
                        <td width="90" align="center" valign="center">${phoneHistory.effectiveDate}</td>
                    </tr>
                </g:each>
            </g:if>
            <g:else>
                <tr>
                    <b>
                    <td colspan="7" width="770" align="center"><b><g:message
                        code="phoneoptoutgranularity.gsp~historydetails" /></b></td>
                    </b>
                </tr>
            </g:else>
        </tbody>
    </table>
    </div>
</g:if> 
```

请帮助我可以修改的地方。

-ss

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T15:00:56.427

为什么会`position:absolute`在里面？在我的头顶上， pos:abs 将`thead`消除流量，这会将第一行有效地隐藏起来。可能您可以在第一行使用一些边距/填充来解决此问题，但您必须首先证明 pos:abs 的合理性。

我可以看到的另一件事是所有`thead`内容都不是`td`' `th`s，但我怀疑这会产生这种效果。

编辑：给它一个粗略的测试，它绝对是pos：abs（万恶之根：P）。可能你想要`position:fixed`吗？另一张海报是对的，你错过了一个`tr`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:58:35.213

看起来您缺少`<tr>`顶行中的 。

# database - SQL Server 2005 以不同的顺序索引相同的列

> ID：829945
> 
> 赞同：1
> 
> 时间：2009-05-06T14:41:15.427
> 
> 标签：database, sql-server-2005, indexing

我有一份报告需要很长时间才能执行。我运行了数据库引擎优化顾问，其中一项建议是创建 2 个索引。但是，我注意到索引是相同的列，但顺序不同。

这是表格：

```
---Locations---
| *LocationID |
| Code        |
| ...more...  |
| DivisionID  |
| RegionID    |
--------------- 
```

并且建议添加这两个索引

```
CREATE NONCLUSTERED INDEX [IX_Locations_Region_Loc_Div] ON [dbo].[Locations] 
(
    [RegionID] ASC,
    [LocationID] ASC,
    [DivisionID] ASC
)
INCLUDE ( [Code]) WITH (SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_Locations_Loc_Reg_Div] ON [dbo].[Locations] 
(
    [LocationID] ASC,
    [RegionID] ASC,
    [DivisionID] ASC
)
INCLUDE ( [Code]) WITH (SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF) ON [PRIMARY]
GO 
```

为什么当 SQL Server 仅用于内部连接时，它们需要以不同的顺序索引这 3 列？

```
SELECT UserID, LocationID FROM [User] u INNER JOIN [Locations] l ON u.LocationID = l.LocationID 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T14:46:09.753

它不适用于您包含的 SQL。它必须考虑其他查询以进行推荐。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:46:40.687

当您运行调优引擎时，语句中是否有 where 子句？我还会在语句上放置一个 order by 子句，看看这是否有助于数据库/调整引擎知道如何最好地对齐索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T15:06:35.977

回答您的问题的一种方法是在添加索引之前和索引之后查看查询的 Sql Server Management Studio 中的执行计划。如果那里没有有用的信息，总是很有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T15:34:47.297

我不确定 2005 年的情况，但我知道（至少某些）以前版本的 SQL Server 只会在 where 子句中的列与索引中的列顺序相同的情况下选择要使用的索引。不喜欢，但确实证明了。

我刚刚注意到您在谈论连接——当时，我主要在 where 子句中编写连接，而不是使用 ANSI 语法，所以我认为它仍然适用。

# vba - MS Word 宏 - 删除段落

> ID：829947
> 
> 赞同：3
> 
> 时间：2009-05-06T14:41:46.987
> 
> 标签：vba, ms-word

有人可以帮助我使用 MS Word 宏，它会在整个文档的每个段落中搜索特定符号并删除不包含该符号的段落。

我对 VBA 几乎一无所知，但刚收到一份庞大而笨重的文档，我需要快速编辑。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T16:17:27.677

这是一个可以做你想做的快速宏 - 谨慎使用，不要忘记备份！

将“搜索”的值设置为您要查找的文本。它非常粗糙，如果您的文本没有出现在其中的某处，它将删除该段落。

```
Sub DeleteParagraphContainingString()

    Dim search As String
    search = "delete me"

    Dim para As Paragraph
    For Each para In ActiveDocument.Paragraphs

        Dim txt As String
        txt = para.Range.Text

        If Not InStr(LCase(txt), search) Then
            para.Range.Delete
        End If

    Next

End Sub 
```

我已经在 Office 2007 上尝试过。有点吓人，但似乎有效！

# wpf - 如何在 MFC 应用程序中托管 WPF 内容？

> ID：829952
> 
> 赞同：17
> 
> 时间：2009-05-06T14:43:20.243
> 
> 标签：wpf, mfc, wpf-controls

我将在这里回答我自己的问题，因为我花了几个小时拼凑起来，并想分享我发现的东西，希望我能拯救别人的挖掘。

有一个[MSDN Walkthrough](http://msdn.microsoft.com/en-us/library/ms744829.aspx)可以帮助您了解大部分情况，但是我在其他地方找到了一些关键部分。例如，演练告诉您将行 [System::STAThreadAttribute] 放在 _tWinMain() 定义之前，但如果您正在实现标准 MFC 应用程序，则源代码中没有 _tWinMain()。

如果这里有任何不清楚的地方，请随时提出问题，我将编辑答案以使事情更清楚。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-06T14:43:36.950

**步骤 1：配置 MFC 应用程序以使用 CLR 支持进行编译**

在本机 C++ 和托管 .NET 代码之间实现互操作性的最佳方法是将应用程序编译为托管 C++ 而不是本机 C++。这是通过转到项目的配置属性来完成的。在 General 下有一个选项“Common Language Runtime support”。将此设置为“公共语言运行时支持/clr”。

**步骤 2：将 WPF 程序集添加到项目中**

右键单击解决方案资源管理器中的项目，然后选择“参考”。单击“添加新引用”。在 .NET 选项卡下，添加 WindowsBase、PresentationCore、PresentationFramework 和 System。确保在添加任何引用后重建全部，以便它们被拾取。

**步骤 3：在 MFC 应用程序上设置 STAThreadAttribute**

WPF 要求在主 UI 线程上设置 STAThreadAttribute。通过转到项目的配置属性进行设置。在 Linker->Advanced 下有一个名为“CLR Thread Attribute”的选项。将此设置为“STA 线程属性”。

**第 4 步：创建 HwndSource 实例以包装 WPF 组件**

System::Windows::Interop::HwndSource 是一个 .NET 类，用于处理 MFC 和 .NET 组件之间的交互。使用以下语法创建一个：

```
System::Windows::Interop::HwndSourceParameters^ sourceParams = gcnew     System::Windows::Interop::HwndSourceParameters("MyWindowName");
sourceParams->PositionX = x;
sourceParams->PositionY = y;
sourceParams->ParentWindow = System::IntPtr(hWndParent);
sourceParams->WindowStyle = WS_VISIBLE | WS_CHILD;

System::Windows::Interop::HwndSource^ source = gcnew System::Windows::Interop::HwndSource(*sourceParams);
source->SizeToContent = System::Windows::SizeToContent::WidthAndHeight; 
```

在对话框类中添加一个 HWND 成员变量，然后像这样分配它： m_hWnd = (HWND) source->Handle.ToPointer();

源对象和关联的 WPF 内容将一直存在，直到您调用 ::DestroyWindow(m_hWnd)。

**步骤 5：将 WPF 控件添加到 HwndSource 包装器**

```
System::Windows::Controls::WebBrowser^ browser = gcnew System::Windows::Controls::WebBrowser();

browser->Height = height;
browser->Width = width;
source->RootVisual = browser; 
```

**第 6 步：保留对 WPF 对象的引用**

由于在我们退出创建函数后浏览器变量将超出范围，我们需要以某种方式持有对它的引用。托管对象不能是非托管对象的成员，但您可以使用名为 gcroot 的包装模板来完成工作。

在对话框类中添加成员变量：

```
#include <vcclr.h>
gcroot<System::Windows::Controls::WebBrowser^> m_webBrowser; 
```

然后将以下行添加到第 5 步中的代码中：

```
m_webBrowser = browser; 
```

现在我们可以通过 m_webBrowser 访问 WPF 组件上的属性和方法。

# java - 如何绕过这个无效的类加载器层次结构？

> ID：829953
> 
> 赞同：3
> 
> 时间：2009-05-06T14:43:21.350
> 
> 标签：java, apache, logging, classloader

我运行 iPlanet 的 Java 应用程序服务器，其中的内容正在加载`commons-logging-1.0.4.jar`。

这很好，直到我的一个应用程序调用`AuthSSLProtocolSocketFactory`它是另一个也使用`commons-logging`.

我将 jar 放在 jvm 类路径上并收到此错误：

> `Invalid class loader hierarchy. You have more than one version of 'org.apache.commons.logging.Log' visible, which is not allowed. (Caused by org.apache.commons.logging.LogConfigurationException: Invalid class loader hierarchy....`

似乎`commons-logger`不喜欢在不同的类加载器中加载自身的两个实例。我假设应用程序服务器有自己的类加载器，它第一次加载它（虽然我找不到任何提到它的 appserver 配置）所以当我的应用程序第二次加载它时它会抛出该异常。

我无法更改 Web 服务器，也无法更改 apache 库。建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T14:55:43.147

看看[SLF4J](http://www.slf4j.org)。

此外，[http://www.qos.ch/logging/classloader.jsp](http://www.qos.ch/logging/classloader.jsp)会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T17:09:01.720

不熟悉 iplanet，但在 WebSphere 中，您可以将应用程序类加载策略设置为 PARENT_LAST。然后，这将在查看父级之前加载应用程序类加载器中的所有内容。假设您有类似的设置，这应该可以解决此类问题。

这确实意味着您必须在自己的应用程序中提供所有依赖项（无论如何这是最佳实践）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-26T14:01:37.610

您是否将公共日志记录明确地放入您的类路径中？你说 jvm 类路径，所以我假设你在启动 iPlanet 时在命令行上指定它。这不是在 J2EE 应用程序中加载 jar 的推荐方法。

最简单的事情是让 Apache 库使用 iPlanet 附带的公共日志记录 jar。不要将 commons-logging.jar 放在您的 WEB-INF/lib 目录或任何类路径设置中，iPlanet 应该会被自动拾取。

# xcode - 如何在 Xcode 中缩进多行？

> ID：829954
> 
> 赞同：615
> 
> 时间：2009-05-06T14:43:30.837
> 
> 标签：xcode, code-formatting

当我选择多行代码并想像往常一样用`TAB`键缩进它们时，它只是将它们全部删除。我来自 Eclipse，我总是这样做。在 Xcode 中是如何做到的？我希望不要逐行;)

* * *

## 回答 #1

> 赞同：934
> 
> 时间：2009-05-06T14:47:51.077

键盘快捷键是`⌘</kbd>+`]` for indent and `⌘</kbd>+`[` for un-indent.``

*   在 Xcode 的首选项窗口中，单击 Key Bindings 工具栏按钮。Key Bindings 部分是您自定义键盘快捷键的地方。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2011-11-12T22:32:57.640

选择要重新缩进的代码，然后转到

> 编辑器 -> 结构 -> 重新缩进

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-05-06T14:46:51.700

`⌘</kbd> + `[` and `⌘</kbd> + `]` are the equivalents to `shift+tab` in Xcode.``

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2013-08-16T06:01:35.950

这是在 XCode 中格式化代码的快捷方式

1.  **格式化整个代码（整个类/控制器）**

    选择整个代码并 **在 mac上****按`control`+`I`**来格式化您的代码。

2.  **格式化特定的代码块**

    选择代码并按：

    *   `⌘</kbd>+`]` for right move (indent)`
    *   `⌘</kbd>+`[` for left move (un-indent)`

注意：根据@JavierGiovannini 的建议，您可以使用编辑器菜单选项

3.  **选择您的代码并导航到*编辑器 > 结构 > 重新缩进***

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2018-03-01T16:14:21.573

首先，使用`command`+选择所有代码`a`

二、按住键`ctr`再按`i`

整个选定的代码将很好地缩进。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-11-17T05:49:32.933

另一种快速重新格式化缩进的方法是快速剪切和粘贴。`⌘</kbd>+`x` and `⌘</kbd>+`v`. I often find it faster than `⌘</kbd>+`[` or `⌘</kbd>+`]` as you can do it with one hand (versus two) and it will reformat to the correct indent level in one shot.````

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-06-20T12:28:04.793

如果您使用协同（为两台PC共享一个键盘）并且您使用xcode的PC（MAC）是slave，而master PC是Windows PC

键盘快捷键是`alt`+`]`用于缩进和`alt`+`[`用于取消缩进。

**更新：**

但是从协同 1.5 版开始工作`⌘</kbd>+`[` for indent and `⌘</kbd>+`]` for un-indent``

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2020-02-27T17:23:59.957

快捷键：

> **ctrl + 我**

注意：请选择要重新缩进的*代码，然后在您的 Mac 上按“控制”和“我”。*

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2017-09-18T20:54:03.493

在 Xcode 9 中，您终于可以使用 Tab 和 Shift+Tab 来缩进多行代码。耶！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-10-14T00:45:15.470

在“首选项”->“文本编辑”->“缩进”中选择“Tab 键：始终缩进” 然后您可以通过按`TAB`或`SHIFT`+缩进单行或多行`TAB` 可悲的是，这完全消除了在您想要的位置插入制表符的可能性，并且与用于在“自动完成字段”之间切换的 tab 键。

我想我们在键盘上需要更多的制表键，一个是不够的......

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-10-22T14:01:49.553

对于周围的所有法国 Xcoder，默认键绑定如下：

### 缩进选择：

`⇧</kbd> + `⌘</kbd> + `⌥</kbd> + `)````

### 缩进选择：

`⇧</kbd> + `⌘</kbd> + `⌥</kbd> + `(````

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-02-19T18:13:31.000

对于那些在 mac 上使用**西班牙语键盘的人来说，这是快捷键：**

`⌘</kbd> + `⌥</kbd> + `[` for un-indent``

`⌘</kbd> + `⌥</kbd> + `]` for indent``

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-07-17T05:36:04.097

对于代码缩进，首先选择代码行，然后按：

**命令 + alt + [**

**命令 + alt + ]**

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-06-20T10:15:25.107

这里所有来自另一个问题的重要快捷方式都回答了堆栈溢出 ![这里](https://i.stack.imgur.com/W2Xbg.png)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-12-10T20:23:37.000

如果你想重新映射标准 Xcode 的`⌘</kbd>+`[` to `TAB`, you can do the following:`

1.  安装一个名为“Karabiner”的程序。

2.  转到首选项〜>“杂项和卸载”

3.  在“自定义设置”部分单击“打开 private.xml”按钮

4.  打开文件并将其内容替换为以下代码：

    ```
    <?xml version="1.0"?> 
    <root>
        <item>
            <name>Tab instead of Command+[</name>
            <identifier>private.swap_tab_and_cmnd+[</identifier>
            <autogen>
                __KeyToKey__
                KeyCode::TAB, ModifierFlag::NONE,
                KeyCode::BRACKET_RIGHT, ModifierFlag::COMMAND_L | ModifierFlag::NONE
            </autogen>
        </item> 
    </root> 
    ```

5.  转到首选项〜>“更改密钥”〜>单击“重新加载XML”按钮

6.  在名为“Tab 而不是 Command+[”的复选框中打勾

7.  享受

[![在此处输入图像描述](https://i.stack.imgur.com/s10g6.png)](https://i.stack.imgur.com/s10g6.png)

PS：请注意，此设置在您的机器上全局有效，而不仅仅是在 Xcode 中。但是，我确信 google 可能会帮助您找到如何进一步自定义它的解决方案，仅将更改应用于 Xcode。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-06-10T15:14:49.110

**丹麦语键盘**

缩进：`⌘</kbd> + `⌥</kbd> + 8``

缩进：`⌘</kbd> + `⌥</kbd> + 9``

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-02-27T10:08:44.473

基本上`⌘</kbd> `[` for left multiple indent and `⌘</kbd> `]` right multiple indent.``

对于`TR`键盘，您可以留下多个缩进`⌘</kbd> `⎇</kbd> `8` and right multiple indent with `⌘</kbd> `⎇</kbd> `9`.Because both `8` and `9` are `ALT` characters of the these nums.Or if you have a keyboard which has `[` or `]` characters are belong to `ALT`(`⎇</kbd>) property so you can use `⌘</kbd> `⎇</kbd> `KEYBOARD CHARACTER````````

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-04-10T00:23:21.477

由于我没有看到当前版本的 Xcode 对此问题的更新，我想我会在 Xcode 9.3 中添加它，Tab 用于缩进选定的文本行以及从一个自动完成字段移动到另一个.

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2011-11-27T12:13:57.910

在 Xcode 4.2 中，自动缩进非常好。您现在可以通过按 Tab 键来缩进选定的代码。我发现 Xcode 通常会自动很好地格式化代码，而且你很少需要自己移动东西。我发现选择一段代码更快，右键单击并选择 Structure -> Re-indent 如果某些代码看起来很混乱。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-10-16T07:54:55.357

Tab 缩进 SHIFT + Tab 重新缩进

# mysql - Oracle XE 或 MySQL，我应该选择哪一个？

> ID：829959
> 
> 赞同：6
> 
> 时间：2009-05-06T14:44:30.693
> 
> 标签：mysql, oracle, database-design

我打算开发一个SNS网站。现在我需要在 Oracle XE 和 MySQL 之间做出决定。

我知道你是一群专家。你能对此发表一些评论吗？

最良好的祝愿

阿里索

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T14:53:13.073

我会考虑的事情：

1）您是否可能想要大规模扩展它？如果是这样，Oracle 将允许一条非常直接的路线通往大规模可扩展平台（您几乎可以只备份数据库并将其恢复到完整的 Oracle 实例）。

2) 你打算适度扩展吗？如果是这样，那么 Oracle XE 被限制为 4Gb 的总 DB 大小，MySQL 可以合理地执行更多。

3) Oracle XE 的其他限制可能会影响您吗？例如，它只支持 1Gb 的 RAM 和 1 个 CPU。如果你认为你可能需要更多的东西来获得体面的性能，那么它是一个非首发。有关更多详细信息，请参阅常见问题解答 ( [http://www.oracle.com/technology/products/database/xe/pdf/dbxe_faq.pdf](http://www.oracle.com/technology/products/database/xe/pdf/dbxe_faq.pdf) )。

4) 你在你的组织中具备这两种技能吗？不仅作为开发人员，还作为支持、备份策略等。如果有适当的技能，那么可能会选择你有技能的那个。确保您也与支持人员交谈并获得他们的意见。

我的直觉说 MySQL，但用上面的来衡量它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-06T15:01:47.813

我会选择 MySQL。Oracle XE 只是应该用于概念证明之类的东西。这就像破解经销商给你一个味道然后在你上钩后向你收取对接负载：D

我认为 MySQL 是中小型应用程序的可靠选择。但是您预期的大小将否定您的决定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T15:51:36.780

我想指出，甲骨文最近收购了 MySql，而 MySql 的未来现在有点悬而未决。如果您对 Oracle XE 非常熟悉，您可能想使用它，但我想指出以下不使用 Oracle 的原因。

Oracle 许可证是业内最昂贵的（Sql Express 可能更好，因为 Sql Server 更便宜）

在托管领域几乎没有听说过 Oracle。托管提供商将提供 SqlServer、MySql 和 PostGre Sql，但我什至想不出有 Oracle Hosting 的提供商。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T22:39:37.447

这很像一个问题：我应该使用什么语言？在您解决任何扩展问题之前，您很可能会遇到体验问题。我认为您应该问自己更基本的问题，例如：

1.  如果您遇到问题，可以获得哪些类型的支持？例如：IRC、论坛、博主、朋友；）
2.  文档有多好？
3.  有免费工具吗？
4.  您的语言对您选择的数据库的支持程度如何？
5.  使用您的语言，哪个数据库最常与示例数据库代码一起使用？
6.  你最亲身的经历是什么？

因此，例如，如果您使用 Ruby，您可能希望使用 MySQL。如果您使用的是 PHP，那么选择可能会更加模糊。

# linux - 重命名一系列文件

> ID：829963
> 
> 赞同：2
> 
> 时间：2009-05-06T14:45:36.213
> 
> 标签：linux, file, find, xargs

试图重命名 linux 服务器上的一系列文件。找到我想要的文件很容易：

```
find . -type f -wholename \*.mbox 
```

当然，作为 mbox 文件，其中一些名称中带有空格，因此变为：

```
find . -type f -wholename \*.mbox -print0 
```

我正在传输到 xargs 以便我可以重命名文件：

```
find . -type f -wholename \*.mbox -print0 | xargs -0 -I{} echo ${"{}"/.mbox/} 
```

鉴于 INBOX.mbox，回声应该返回类似于 INBOX 的内容，但是 bash 抱怨：

```
bash: ${"{}"/.mbox/}: bad substitution 
```

我怎样才能解决这个问题？如果可能的话，我想尝试将它保存在 find/xargs 解决方案中，这样我就不会在它周围添加很多循环结构。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T18:17:43.927

尝试

```
find . -type f -wholename \*.mbox | sed 's/\(.*\)\.mbox/mv "\1.mbox" "\1"/' | sh 
```

如果某些文件包含双引号字符，这不是 100% 万无一失的，但我认为您可以忽略它:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-10T18:55:05.130

GNU Parallel [http://www.gnu.org/software/parallel/](http://www.gnu.org/software/parallel/)有 {.} 删除扩展：

```
find . -type f -wholename \*.mbox -print0 | parallel -0 mv {} {.} 
```

如果您知道文件名不包含 \n 那么这也可以：

```
find . -type f -wholename \*.mbox | parallel mv {} {.} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T14:58:14.530

你可以试试：

```
find . -type f -wholename \*.mbox -print0 | sed 's/\.mbox//' 
```

您的问题是试图通过管道输入 xargs。到那时`"{}"`已经没有任何意义了。

重命名文件（假设您在 bash 下）

```
find . -type f -wholename \*.mbox -print0 | \
    while read I ; do
        mv $I $(echo $I | sed 's/\.mbox//') ;
    done ; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T19:09:17.390

我认为你需要这个：

```
find . -wholename \*.mbox | awk '{new=$0; gsub("\.mbox$", "", new) ; system("mv \"" $0 "\" \"" new "\"") }' 
```

（应该同时兼容 gawk 和 mawk，在 mawk 上测试）。它不使用 xargs，但请注意，它不会为每个移动的文件派生一个新进程。如果您需要移动大量文件，您会发现其优势。警告：如果任何文件的名称中包含换行符，你会遇到麻烦（但如果这是一个问题，上帝与你同在）。

您可以通过使用 xargs 在一次`rm`调用中删除多个文件来进一步增强此解决方案。

如果您真的需要速度，我建议您使用 python 脚本而不是 awk。这将在`rm`没有一个叉子的情况下完成所有操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T19:49:04.377

你可以使用重命名（1）吗？它带有 perl。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-02T15:47:41.317

给你，这应该可以解决问题....

```
# find .
.
./test.tst
./test1.tst
./test2.tst
./test/test4.tst
./test/test5.tst

#

for file in `find . -type f`
do
mv $file ${file%.tst}.new
done

# find .
.
./test
./test/test4.new
./test/test5.new
./test1.new
./test2.new 
```

# c - 在不知道名称的情况下如何访问 C 结构的成员？

> ID：829966
> 
> 赞同：2
> 
> 时间：2009-05-06T14:45:44.793
> 
> 标签：c, objective-c

我正在处理一个未记录的 API，我正在尝试对其进行一些逆向工程 - 不要担心这不是恶意的，只是试图以创造性的方式完成一个用例。

我有一个指向 C 结构的指针。有没有办法通过检查内存来确定这个结构有多少成员？他们的价值观？

我怀疑实际的成员名称不可用，但也许是？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T14:59:17.117

你不能。您所能做的就是检查内存，并尝试进行猜测。

例如，指针值有时很容易定位，因为它们通常位于相同的“一般区域”中。如果您有一个结构的地址，请在数字上查找“接近”的值（平台指针大小，通常为 32 或 64 位）。

在您的平台上，可能还值得研究一些“常见”浮点数的位模式，并寻找那些。在这里，应用程序和/或领域的知识当然会有所帮助，也许有一些“应该”在其中的值，那么这些就是要搜索的自然事物。

如果您可以访问 API 中接受和/或返回结构的任何*函数*，您可能想尝试调用它们并检查差异，这可以为正在发生的事情提供线索。

关于这一点，您当然也可以首先单步执行分配/创建结构的代码，看看它在哪里做了什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T14:48:42.977

不，没有办法`struct`仅从记忆中确定成员的“结构”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T14:49:07.187

根据内存布局，您可能能够确定结构的结束位置，并且通过了解结构在更高级别上的作用，您可能能够猜测成员（注意对齐）。但是除非代码带有调试符号，否则知道名称是没有运气的。在那种情况下，这很容易。在使用结构的地方中断并在调试器中检查它。

*编辑：*
假设您确实找到了该结构包含的成员，并且您还知道您的编译器使用相同的对齐方式，那么您可以在代码中定义该结构的传真，并使用指向您的结构的指针来指向真实的结构。然后，您可以轻松访问代码中的所有元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T14:49:56.560

不幸的是，您没有 C 或 C++ 中的类型信息。C++ 中提供了一些 RTTI，它允许 dynamic_cast 检查向下转换的有效性。但它没有提供有关成员（名称或类型）的信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T15:02:42.863

我会说无论你想做什么，都有更好的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T14:58:11.317

在 C 中，我通常创建一个包含所有成员名称、偏移量和大小的元结构。它看起来像这样：

```
#define MEMBER(name,str) { #name, offsetof(struct str, name), sizeof(*(&((struct str *)(0))->name) }
struct A { char *name, int offset; int size; } = {
MEMBER(name,A),
MEMBER(offset,A),
MEMBER(size,A)
}; 
```

然后，如果需要，通过创造性的投射，您可以列出结构的所有成员。

# exception - windbg 命令“kd”有什么作用？

> ID：829969
> 
> 赞同：1
> 
> 时间：2009-05-06T14:46:02.890
> 
> 标签：exception, windbg

我错误地运行了 kd 并得到了一些让我感兴趣的输出，这是对我模块中的一行代码的引用，我在任何线程的调用堆栈上都看不到。这些行不是方法的开始，所以我不认为引用是对函数指针的引用，但可能是异常存储在内存中的结果？？？当然，这恰好是我正在寻找的......

更新：

异常的堆栈跟踪是：

```
0:000> kb
   *** Stack trace for last set context - .thread/.cxr resets it
ChildEBP RetAddr  Args to Child              
0174f168 734ea84f 2cb9e950 00000000 2cb9e950 kernel32!LoadTimeZoneInformation+0x2b
0174f1c4 734ead92 00000022 00000001 000685d0 msvbvm60!    RUN_INSTMGR::ExecuteInitTerm+0x178
0174f1f8 734ea9ee 00000000 0000002f 2dbc2abc msvbvm60!    RUN_INSTMGR::CreateObjInstanceWithParts+0x1e4
0174f278 7350414e 2cb9e96c 00000000 0174f2f0 msvbvm60!    RUN_INSTMGR::CreateObjInstance+0x14d
0174f2e4 734fa071 00000000 2cb9e96c 0174f2fc msvbvm60!RcmConstructObjectInstance+0x75
0174f31c 00976ef1 2cb9e950 00591bc0 0174fddc msvbvm60!__vbaNew+0x21 
```

并进入我们的代码（创建一个新的 Form 派生类）

dds 输出：

```
0:000> dds esp-0x40 esp+0x100
0174f05c  00000000
0174f060  00000000
0174f064  00000000
0174f068  00000000
0174f06c  00000000
0174f070  00000000
0174f074  00000000
0174f078  00000000
0174f07c  00000000
0174f080  00000000
0174f084  00000000
0174f088  00000000
0174f08c  00000000
0174f090  00000000
0174f094  00000000
0174f098  00000000
0174f09c  007f4f9b ourDll!formDerivedClass::Form_Initialize+0x10b [C:\Buildbox\formDerivedClass.frm @ 1452] 
```

ETC

这似乎表明 Initialize 正在被调用，即使它不在此异常或任何线程的堆栈跟踪中。正如建议的那样，这可能都是 pdbs 和 dll 之间的不匹配，但我们最终使用正确的类和方法似乎是一个巧合

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:12:56.460

Kd 代表“堆栈转储”。从文档中：

> kd 命令显示原始堆栈数据。每个 DWORD 值都显示在单独的行上。将显示这些行的符号信息以及相关符号。这种格式创建了比其他 k* 命令更详细的列表。kd 命令相当于使用堆栈地址作为参数的 dds（显示内存）命令。

尝试 .hh 从 ntsd/windbg 中获取调试器帮助。

另见“dds esp-0x40 esp+0x80”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-19T21:39:53.163

对不起，但看起来你实际上运行了“kb”命令——用“B”，而不是“D”。这就是上面会话中出现的内容，[http://www.debuginfo.com/articles/easywindbg.html](http://www.debuginfo.com/articles/easywindbg.html)上的示例肯定会产生类似的输出......

# c# - 如何在 C# 中将 sbyte[] 转换为 byte[]？

> ID：829983
> 
> 赞同：34
> 
> 时间：2009-05-06T14:48:21.947
> 
> 标签：c#, arrays

我有一个填充 sbyte[] 类型数组的函数，我需要将此数组传递给另一个接受 byte[] 类型参数的函数。

我可以在不复制所有数据或使用`unsafe`魔法的情况下快速快速地转换它吗？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2011-03-24T11:09:42.137

是的你可以。由于两者`byte`和`sbyte`具有相同的二进制表示，因此无需复制数据。只需对 Array 进行强制转换，然后将其强制转换`byte[]`为就足够了。

```
sbyte[] signed = { -2, -1, 0, 1, 2 };
byte[] unsigned = (byte[]) (Array)signed; 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-05-06T14:50:33.160

您将不得不复制数据（只有引用类型的数组是协变的） - 但我们可以尝试有效地做到这一点；`Buffer.BlockCopy`似乎工作：

```
 sbyte[] signed = { -2, -1, 0, 1, 2 };
    byte[] unsigned = new byte[signed.Length];
    Buffer.BlockCopy(signed, 0, unsigned, 0, signed.Length); 
```

如果它是引用类型，则可以只转换引用而不复制数组：

```
 Foo[] arr = { new Foo(), new Foo() };
    IFoo[] iarr = (IFoo[])arr;
    Console.WriteLine(ReferenceEquals(arr, iarr)); // true 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-06T15:15:05.033

如果您使用的是 .NET 3.5+，则可以使用以下内容：

```
byte[] dest = Array.ConvertAll(sbyteArray, (a) => (byte)a); 
```

也就是说，我想有效地复制所有数据。

请注意，此函数也在 .NET 2.0 中，但您必须改用匿名方法。

# c++ - 在不使用 activesync/WMDC 的情况下访问 Windows Mobile/CE 设备

> ID：829985
> 
> 赞同：1
> 
> 时间：2009-05-06T14:48:32.447
> 
> 标签：c++, windows-mobile, activesync, wmdc

我目前正在开发一个在多个不同的 Windows Mobile 和 CE 设备上运行的应用程序。该项目是使用 MFC 以非托管 C++ 编写的。此应用程序还附带一个支持 PC 应用程序，我们通过 activesync/WMDC 在两者之间以编程方式传输文件。

我们遇到了许多不同的问题，因为所有使用我们应用程序的 PC 都需要安装 activesync/WMDC。

是否可以在台式计算机和不使用 activesync/WMDC 的 WM 设备之间共享信息和文件？如果是这样，是否有图书馆或如何做到这一点的例子？

这只需要一种方式，如果桌面应用程序能够确定设备已连接然后移动文件，它就可以完成所有工作。虽然如果它双向工作会更方便。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T15:02:26.437

Activesync 将是最可靠的方法，它适用于所有 Windows 移动设备。除此之外，您正在查看一些试验和错误，以了解当您将特定设备连接到未安装 activesync 的机器时会发生什么。如果幸运的话，您关心的设备将显示为外部驱动器。

您还可以选择在较低级别使用 activesync 协议，但我不建议这样做，因为这可能会给安装了 activesync 的人带来问题。

为了独立于 pc 上的软件，我会使用基于网络的东西——假设设备有网络连接，无论如何这都会提供比 activesync 更好的用户体验。

# java - Java中的连续页面/物理内存

> ID：829987
> 
> 赞同：1
> 
> 时间：2009-05-06T14:48:54.833
> 
> 标签：java, memory-management, operating-system, x86, paging

我的目标是确保在 java 中分配的数组是在连续的物理内存中分配的。我遇到的问题是，分配数组的页面在物理内存中往往不是连续的，除非我分配了一个非常大的数组。

我的问题是：

*   为什么一个非常大的数组可以确保物理内存中的页面是连续的？
*   有什么方法可以确保在物理内存中分配数组，而不涉及使数组非常大？
*   如何在不测量缓存命中/缓存未命中的情况下判断 Java 对象/数组存在于哪个页面或物理地址？

我不是在寻找答案，询问我为什么在 java 中这样做。我知道 C 会“解决我的问题”，而且我违背了 java 的基本性质。尽管如此，我有充分的理由这样做。

不需要保证答案一直有效。我正在寻找大部分时间都有效的答案。没有任何合理的 Java 程序员会写出创造性的、开箱即用的答案的额外分数。特定于平台（x86 32 位 64 位）是可以的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T15:15:49.620

不可以。物理上连续的内存需要与操作系统直接交互。大多数应用程序（包括 JVM）只能获得几乎连续的地址。JVM 无法为您提供它无法从操作系统获得的东西。

此外，你为什么要它？如果您正在设置 DMA 传输，那么您可能正在使用除 Java 之外的技术。

**一点背景：**

现代 PC 中的物理内存通常是一个灵活的数量，位于可更换的 DIMM 模块上。它的每个字节都有一个物理地址，因此操作系统在引导期间确定哪些物理地址可用。事实证明，应用程序最好不直接使用这些地址。相反，所有现代 CPU（及其缓存）都使用虚拟地址。有一个到物理地址的映射表，但这不需要完整 - 通过使用未映射到物理地址的虚拟地址启用交换到磁盘。每个进程有一个表，映射不完整，从而获得了另一个级别的灵活性。如果进程 A 有一个映射到物理地址 X 的虚拟地址，而进程 B 没有，那么进程 B 就无法写入物理地址 X，我们可以认为该内存是进程 A 独有的。

映射表在页面级别工作。页或物理地址的连续子集映射到虚拟地址的连续子集。开销和粒度之间的权衡导致 4KB 页面成为常见的页面大小。但是由于每个页面都有自己的映射，因此不能假设超出该页面大小的连续性。特别是，当页面从物理内存中被逐出，交换到磁盘并恢复时，很有可能最终到达一个新的物理内存地址。程序不会注意到，因为虚拟地址不会改变，只有操作系统管理的映射表会改变。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T15:35:38.417

鉴于垃圾收集器在（逻辑）内存中移动对象，我认为您将不走运。

你能做的最好的事情就是使用[ByteBuffer.allocateDirect](http://java.sun.com/javase/6/docs/api/java/nio/ByteBuffer.html#allocateDirect(int))。这（通常）不会被 GC 移动到（逻辑）内存中，但它可能会被移动到物理内存中，甚至可以分页到磁盘。如果您想要任何更好的保证，则必须使用操作系统。

话虽如此，如果您可以将页面大小设置为与您的堆一样大，那么所有数组都必然是物理上连续的（或换出）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T15:05:27.290

可能有一些方法可以诱使特定的 JVM 执行您想要的操作，但这些方法可能很脆弱、复杂，并且很可能非常特定于 JVM、它的版本、它运行的操作系统等。换句话说，浪费了精力。

因此，在不了解您的问题的情况下，我认为没有人能够提供帮助。一般来说，在 Java 中肯定没有办法做到这一点，最多在特定的 JVM 上。

提出替代方案：

如果你真的需要将数据存储在连续的内存中，为什么不在一个小的 C 库中进行并通过 JNI 调用呢？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T14:59:27.570

我认为您会想要使用[sun.java.unsafe](http://www.docjar.com/docs/api/sun/misc/Unsafe.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-08T05:51:14.267

照我看来。你还没有解释为什么

*   原始数组在内存中不是连续的。我不明白为什么它们在虚拟内存中不会连续。（cf 对象数组不太可能使其对象在内存中连续）
*   在物理内存（RAM，即随机存取内存）中不连续的数组将具有显着的性能差异。例如，应用程序性能的可测量差异。

它看起来是你真的在寻找一种低级的方式来分配数组，因为你习惯于在 C 中这样做，而性能是需要这样做的要求。

顺便说一句：使用 getDouble()/putDouble() 访问 ByteBuffer.allocateDirect() 可能比仅使用 double[] 慢，因为前者涉及 JNI 调用，而后者可以优化为根本不调用。

使用它的原因是用于在 Java 和 C 空间之间交换数据。例如 NIO 调用。只有当读/写保持在最低限度时，它才会表现良好。否则你最好在 Java 空间中使用一些东西。

即，除非您清楚自己在做什么以及*为什么*要这样做，否则您最终会得到一个可能会让您感觉更好的解决方案，但实际上比简单的解决方案更复杂且性能更差。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T15:05:14.903

请注意对相关问题的[回答](https://stackoverflow.com/questions/744735/java-array-hashcode-implementation/744760#744760)，该问题讨论了 System.identityHashCode() 和对象内存地址的标识。底线是您可以使用默认数组 hashCode() 实现来识别数组的原始内存地址（以适合 int/32 位为准）

# javascript - 计算web KSLOC的好工具是什么？

> ID：829998
> 
> 赞同：0
> 
> 时间：2009-05-06T14:51:45.230
> 
> 标签：javascript, html, css, size

对于 HTML、CSS 和 JavaScript 文件，在源目录上运行并获取 KSLOC 的好工具是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T15:09:56.060

```
grep -v -P "^\s*$" -R dir/ | wc -l 
```

为您提供忽略空白行的行数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T14:58:03.750

`wc -l`是一个好的开始。**********``*******