# StackOverflow 问答 000706000-000706999

# iphone - 我是否必须检查 LSRequiresIPhoneOS 才能确定摄像头是否可用？

> ID：706011
> 
> 赞同：5
> 
> 时间：2009-04-01T15:16:04.203
> 
> 标签：iphone, ipod-touch

在我的 Xcode 项目中，资源中有`Info.plist`文件。它有一个这样的属性：

```
LSRequiresIPhoneOS 
```

所以我的问题是：我必须检查吗？我想要的是我的应用程序发现自己是否有相机。如果不是，则禁用该功能，如果是：酷！它必须适用于 iPhone 和 iPod Touch！

我想如果我在 中禁用此`Info.plist`功能，我仍然可以使用 iPhone 功能，Apple 不会因此拒绝我的代码，对吧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-02T17:56:37.703

您应该选中 LSRequiresIPhoneOS（这是默认值）。这不会阻止应用程序在 iPod Touch 上运行。这可能看起来令人困惑，但在这种情况下，“IPhoneOS”指的是在 iPhone 和 iPod Touch 上运行的操作系统（假设用户已在 Touch 上安装了 iPhone 操作系统，以便它可以运行第 3 方应用程序）。

关于摄像头的使用，你可以使用类似下面的东西来专门查看摄像头是否可用：

```
BOOL isCameraAvailable = [UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera]; 
```

这种方法——检查特定功能——通常比使用 iPhone 操作系统版本或硬件型号更好。

# .net - .net 的 64 位 smpp 库

> ID：706012
> 
> 赞同：3
> 
> 时间：2009-04-01T15:16:16.370
> 
> 标签：.net, 64-bit, smpp

我目前正在使用 devshock smpp 库。不幸的是，它似乎只在 32 位二进制文​​件中可用。有谁知道他们是否有 64 位版本，或者是否有任何地方可以提供像样的 64 位 smpp 库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T15:22:50.803

[RoaminSMPP](http://roaminsmpp.sourceforge.net/)怎么样？它是开源的，并作为 LGPL 发布。它也应该适用于 x64。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-12T14:12:29.527

Zeocrash，我使用 Jaama SMPP Client 有一段时间了，它运行良好。由于它是用 C# 开发的，我认为您可以将其[优化为 64bits](https://stackoverflow.com/questions/203085/c-sharp-for-64bit-os)，并轻松[迁移它。](http://msdn.microsoft.com/en-us/library/ms973190.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-14T10:45:53.763

这个商业图书馆：

[http://www.tops.com.pl/en/products/smscc/](http://www.tops.com.pl/en/products/smscc/)

是 64 位库。根据我的经验，一个不错的。至少需要存在 .NET 2.0（现在几乎没有 Windows 机器已经没有它了），但是您可以通过 .NET 组件或通过 COM 接口（如过去的 ActiveX）与它进行交互，所以它可以用于例如 64 位 C++，而不仅仅是 CLR 语言。

# ruby-on-rails - Rails 缓存 - XML 文件？

> ID：706015
> 
> 赞同：3
> 
> 时间：2009-04-01T15:16:58.740
> 
> 标签：ruby-on-rails, ruby, caching

我的 Rails 应用程序在 VM 上运行。使用静态页面时，VM 的性能很好。事实上，我正在使用 Apache 虚拟主机运行另一个站点，它只是提供静态 HTML 文件并且响应足够。但是，动态生成 XML 文件的 Rails 应用程序响应非常缓慢。实际上，每个 XML 文件大约需要 10 秒左右的时间。Rails 生成的这些 XML 文件每天不会更改一次以上。

将这些 XML 文件配置为缓存的最佳做法是什么？

编辑1：

我应该提到，浏览器不会查看这些 XML 文件。它们被“领域”中的移动应用程序查看。所以，不幸的是，发送“HTTP/1.0 304 not modified”是行不通的。

编辑2：

如果重要的话，我正在使用 Phusion Passenger 来托管我的 Rails 应用程序。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T15:25:25.367

如果您使用 rails 的静态页面缓存并通过 apache 提供服务，只需在 url 上使用显式 xml 扩展名即可。

如果您只提供 xml 而没有 html，则在查找缓存文件时，您还可以将 apache conf 编辑为默认为 xml 而不是 html。

缓存过期对于编码和测试来说是一件相当无聊的事情，但是由于您很少重新生成文件，因此您可能只会使整个缓存过期。

* * *

以下是我如何在一个很少更新的小型 rails 站点中处理缓存的精选文件和摘录：

在要缓存的控制器中

```
class XmlThingController < ApplicationController
  caches_page :index, :show, :other_actions 
```

在修改将导致 xmls 更改的数据的控制器/操作中：

```
class Admin::SomeCrudController < AppplicationController
  cache_sweeper :stupid_master_sweeper, :only => [ :save, :destroy ] 
```

在 'config/environments/production.rb'

```
config.action_controller.page_cache_directory = 
  File.join(RAILS_ROOT, 'public', 'cache') 
```

在您的 vhost apache conf 中的某处：

```
# 1.4\. Handle caching

# 1.4.1\. prevent direct cache access
RewriteRule  ^/cache - [F,L]

# 1.4.2\. for index
RewriteCond  %{DOCUMENT_ROOT}/cache/index.html -f
RewriteRule  ^/?$ /cache/index.html [L]

# 1.4.3\. for explicitly specified extensions
RewriteCond  %{DOCUMENT_ROOT}/cache%{REQUEST_URI} -f
RewriteRule  ^(.*)$ /cache$1 [L]

# 1.4.4\. with html extension implied
RewriteCond  %{DOCUMENT_ROOT}/cache%{REQUEST_URI}.html -f
RewriteRule  ^(.*)$ /cache$1.html [L]

# 1.5\. Finally, proxy everything else to mongrel
RewriteCond  %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
RewriteRule  ^/(.*)$ balancer://your-website-proxy%{REQUEST_URI} [P,QSA,L] 
```

每次触发时都会清除整个缓存的愚蠢清扫器：

```
class StupidMasterSweeper < ActiveRecord::Observer
  observe Foo, Bar # All models that affect caching here

  def after_save(record); end
  def after_destroy(record); end

  def filter(controller)
    # sweep everything.
    `cd #{RAILS_ROOT} && RAILS_ENV=#{ENV['RAILS_ENV']} rake cache:clear`
  end
end 
```

`lib/tasks/cache.rake`

```
namespace :cache do 

  desc "Remove all cached files" 
  task :clear do
    puts `rm -rf #{RAILS_ROOT}/public/cache/*`
  end 

end 
```

* * *

如果您希望将默认隐含扩展名默认为 xml，请更改 1.4.2 索引规则上的扩展名，如下所示：

```
# 1.4.4\. with html extension implied
RewriteCond  %{DOCUMENT_ROOT}/cache%{REQUEST_URI}.html -f
RewriteRule  ^(.*)$ /cache$1.html [L] 
```

到：

```
# 1.4.4\. with xml extension implied
RewriteCond  %{DOCUMENT_ROOT}/cache%{REQUEST_URI}.xml -f
RewriteRule  ^(.*)$ /cache$1.xml [L] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T15:25:00.173

当请求 XML 文档时，向客户端发送[“HTTP/1.0 304 未修改” HTTP 状态代码。](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)

# oracle - 您如何在协作的、受版本控制的环境中处理 Oracle 包？

> ID：706026
> 
> 赞同：9
> 
> 时间：2009-04-01T15:20:05.100
> 
> 标签：oracle, version-control, package

我在 Oracle 的多开发人员环境中工作，其中包含一个大包。我们有一个 DEV => TST => PRD 推广模式。目前，所有的包编辑都是直接在 TOAD 中进行，然后编译到 DEV 包中。

我们遇到两个问题：

1.  需要在不同的时间表上促进并发更改。例如，开发人员 A 进行了一项明天需要升级的更改，而开发人员 B 正在同时进行一项在两周内不会升级的更改。到了推广时间，我们发现自己手动注释掉尚未推广的内容，然后再取消注释……哎呀！！！

2.  如果两个开发人员同时进行更改并且其中一个编译，它会清除另一个开发人员的更改。没有很好的合并；相反，最新的编译获胜。

你会推荐什么策略来解决这个问题？我们正在使用 TFS 进行源代码控制，但还没有在我们的 Oracle 包中使用它。

**PS**我看过[这个](https://stackoverflow.com/questions/287409/oracle-packages-in-version-control)帖子，但它并没有完全回答我的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T17:33:07.963

关键是采用仅从源代码控制系统部署代码的做法。我不熟悉 TSF，但它必须实现分支、标签等概念。然后部署什么的问题不属于源代码控制系统中的构建和发布标记。

其他提示（针对 Oracle）：

*   如果您将包规范和主体拆分为不同的文件，每个文件使用一致的文件模式（例如，“.pks”用于包规范，“.pkb”用于包主体），则效果最佳。如果您使用可以处理文件模式的自动构建过程，那么您可以构建所有规范，然后构建主体。如果您只部署包主体，这也可以最大限度地减少对象失效。

*   花时间配置一个自动构建过程，该过程由源代码控制系统的发布或构建状态驱动。如果您拥有中等数量的数据库代码对象，那么能够将代码构建到参考系统中并将其与您的质量保证或生产系统进行比较是值得的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-02T15:04:30.853

请参阅我关于[在团队中使用 Oracle 中的存储过程的工具](https://stackoverflow.com/questions/111852/tools-to-work-with-stored-procedures-in-oracle-in-a-team)（我刚刚重新标记）[的答案。](https://stackoverflow.com/questions/111852/tools-to-work-with-stored-procedures-in-oracle-in-a-team/116198#116198)

底线：不要直接使用 TOAD 修改程序。将源存储为文件，您将存储在源代码管理中，修改然后执行。

另外，我强烈建议每个开发人员使用自己的数据库副本（使用免费的 Oracle Express）。如果您将所有脚本存储在源代码管理中以创建数据库，则可以这样做。[可以在这里找到](http://odetocode.com/Blogs/scott/archive/2008/02/03/11746.aspx)更多见解。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T11:29:01.823

为了避免 2 个开发人员同时处理同一个包：

1) 使用您的版本控制系统作为包代码的来源。要处理一个包，开发人员必须首先从版本控制中检出该包；在此开发人员将其重新签入之前，没有其他人可以签出该包。

2) 不要在 Toad 或任何其他 IDE 中直接处理包代码。您**不知道**您正在处理的代码是否正确或已被一位或多位其他开发人员修改。处理您从版本控制中签出的脚本中的代码，并将其运行到数据库中以编译包。我的偏好是使用漂亮的文本编辑器 (TextPad) 和 SQL Plus，但您也可以在 Toad 中执行此操作。

3) 完成后，将脚本重新检查到版本控制中。 **不要**将数据库中的代码复制并粘贴到您的脚本中（再次参见第 2 点）。

这种受控方法的缺点（如果有的话）是一次只有一个开发人员可以处理一个包。这不应该是一个大问题，只要：

*   您将包保持在合理的大小（根据它们的作用，而不是代码行数或其中的过程数）。没有一个包含所有代码的大包。
*   鼓励开发人员仅在准备好处理代码时才签出代码，并在完成更改和测试更改后立即重新签入。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T15:26:32.383

我们使用[Oracle Developer Tools for Visual Studio.NET](http://www.oracle.com/technology/tech/dotnet/tools/index.html) ...直接插入 TFS

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T15:24:49.033

我们使用每个流的开发数据库和不同流的标签来做到这一点。

我们的 Oracle 许可为我们提供了无限的开发/测试实例，但我们是 ISV，您可能有不同的许可选项

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-02T05:06:42.523

您可以使用 VS 的 Oracle 开发人员工具，也可以使用 sql developer。SQL developer 与 Subversion 和 CVS 集成，您可以免费下载。见这里：[http ://www.oracle.com/technology/products/database/sql_developer/files/what_is_sqldev.html](http://www.oracle.com/technology/products/database/sql_developer/files/what_is_sqldev.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-08-19T13:48:37.753

我们针对 TFS 2008 使用 Toad for Oracle 和 TFS MSSCCI 提供程序。我们使用[自定义工具](http://bit.ly/ovpo5U)从源代码管理中提取数据库签入并将它们打包以供发布。

据我所知，Oracle Developer Tools for Visual Studio.Net 没有与 TFS 或其他方式进行任何真正的源代码控制集成。

您可能会考虑[适用于 Visual Studio 的 Toad Extensions，](http://toadextensions.com/index.jspa?product=visualstudio)尽管它并不便宜，我认为可能需要 4000 美元。

Another option is the [Oracle Change Management Pack](http://download.oracle.com/docs/html/A96679_01/overview.htm) but believe it requires the Enterprise edition of Oracle which is much more pricey.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-09T07:05:36.763

You may be interested in Gitora [www.gitora.com](http://www.gitora.com). It helps managing Oracle database objects with Git.

This article about collaborative development with the Oracle database can also be helpful: [http://blog.gitora.com/plsql-how-to-develop-two-features-simultaneously-but-deploy-only-one/](http://blog.gitora.com/plsql-how-to-develop-two-features-simultaneously-but-deploy-only-one/)

Full disclosure: I am the developer and author of the article.

# c++ - 未初始化的结构成员是否总是设置为零？

> ID：706030
> 
> 赞同：29
> 
> 时间：2009-04-01T15:22:36.823
> 
> 标签：c++, c

考虑一个 C 结构：

```
struct T {
    int x;
    int y;
}; 
```

当它被部分初始化时

```
struct T t = {42}; 
```

*ty*是否保证为 0 或者这是编译器的实现决定？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-01T15:25:19.453

如果它被部分初始化，它保证为 0，就像数组初始化器一样。如果它未初始化，它将是未知的。

```
struct T t; // t.x, t.y will NOT be initialized to 0 (not guaranteed to)

struct T t = {42}; // t.y will be initialized to 0. 
```

相似地：

```
int x[10]; // Won't be initialized.

int x[10] = {1}; // initialized to {1,0,0,...} 
```

样本：

```
// a.c
struct T { int x, y };
extern void f(void*);
void partialInitialization() {
  struct T t = {42};
  f(&t);
}
void noInitialization() {
  struct T t;
  f(&t);
}

// Compile with: gcc -O2 -S a.c

// a.s:

; ...
partialInitialzation:
; ...
; movl $0, -4(%ebp)     ;;;; initializes t.y to 0.
; movl $42, -8(%ebp)
; ...
noInitialization:
; ... ; Nothing related to initialization. It just allocates memory on stack. 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-04-01T15:36:08.307

标准草案第8.5.1.7项：

> -7- 如果列表中的初始化器少于聚合中的成员，则每个未显式初始化的成员都应默认初始化（dcl.init）。[例子：
> 
> ```
> struct S { int a; char* b; int c; };
> S ss = { 1, "asdf" }; 
> ```
> 
> 用 1 初始化 ss.a，用“asdf”初始化 ss.b，用 int() 形式的表达式的值（即 0）初始化 ss.c。]

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T15:24:41.267

不，它保证为 0。

# php - WordPress Digg-Like 投票系统插件

> ID：706034
> 
> 赞同：7
> 
> 时间：2009-04-01T15:23:28.007
> 
> 标签：php, wordpress

我刚刚发现了[BuddyPress （将](http://buddypress.org/)[WordPress MU](http://mu.wordpress.org/)安装转换为社交网络的插件集合），现在我想知道是否有任何类似 Digg 的 WordPress 投票插件。这最终将集成到 BuddyPress 网站中，网站成员将在该网站上提交、投票和评论故事（很像 Digg）。

我有一种感觉，我最终将不得不从头开始构建它，但是由于该站点将基于 WordPress 构建，我想知道是否有任何可用的插件可以添加此功能。到目前为止，我的搜索都是空的。我确实找到了一个具有此功能[WpVote](http://wpvote.com/)的 Wordpress 博客。[它甚至使用websnapr](http://www.websnapr.com/)自动创建故事网页的缩略图（我假设）。我浏览了页面源代码，似乎没有找到他们正在使用的 WP 插件的任何提示。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T10:03:23.843

我已经成功地将[TDO Mini Forms](http://wordpress.org/extend/plugins/tdo-mini-forms/)用于用户提交，并结合[Vote it up](http://www.tevine.com/projects/voteitup/)构建了一个 digg 风格的网站。

*您可以使用 Vote it up 中的MostVotedAllTime_Widget()*函数创建“最高票数”页面，或者使用 SortVotes() 或 GetVoteArray() 函数在自定义页面模板中构建和设置您自己的最高票数列表。

您可以在 /vote-it-up/votingfunctions.php 中找到可用函数的完整列表

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T17:14:35.260

或者您可以尝试：

[Pligg 投票 CMS](http://www.pligg.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-10T07:44:58.690

当我开始构建自己的社交书签时，我使用 voteitup 插件，但如果您想构建自己的投票按钮，您可以访问 bavotasan.com 并搜索帖子**“simple-voting for-wordpress-with-php-and-jquery”** 看看我自己的社交书签使用它： http: [//nestdev.com](http://nestdev.com)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-04T22:55:00.160

BuddyPress 链接是您正在寻找的内容： [http ://wordpress.org/extend/plugins/buddypress-links/](http://wordpress.org/extend/plugins/buddypress-links/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-04T01:42:40.467

[http://prothemedesign.com/themes/nominate-for-wordpress/](http://prothemedesign.com/themes/nominate-for-wordpress/)

是我遇到但从未使用过的高级主题。这是 Digg 的 WP 版本，我相信相当不错。

我个人使用Drigg，它是Drupal 版本的Digg。在这里查看它的实际操作：[http](http://weblinks.myfriendshotel.com) : //weblinks.myfriendshotel.com 然而不幸的是，WebSnapr 刚刚更改了他们的代码，因此该站点不再显示缩略图，但希望作为一个“非程序员”我会很快找到解决方案。 ..

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T15:30:07.820

这就是你所追求的吗？

[http://www.tevine.com/projects/voteitup/](http://www.tevine.com/projects/voteitup/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-03T12:39:57.753

我认为 [wpvote][1] 将 drigg 模块用于 drupal。我刚刚找到了具有类似 digg 社交书签功能的 buddypress 插件。[更多详情](http://wpmu.org/buddypress-links-new-must-have-component-allows-rich-media-embedding/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-15T21:52:38.677

不确定这是否仍然相关，但用于 WPVote.com 的主题现已在 Pro Theme Design 上发布 - [http://prothemedesign.com/themes/nominate-for-wordpress/](http://prothemedesign.com/themes/nominate-for-wordpress/)

# data-modeling - 谁必须做数据模型设计

> ID：706047
> 
> 赞同：-1
> 
> 时间：2009-04-01T15:25:49.127
> 
> 标签：data-modeling

请就以下问题澄清我，谁将做伟大的数据模型设计？技术主管/数据库管理员

谢谢， Gunasekaran Sambandhan

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T15:29:56.463

这取决于您的团队有多大以及其结构如何。在以数据为中心的应用程序中，我可以告诉你，作为技术负责人，我通常要么完成数据库设计，要么完成由专门的数据库开发人员改进（有时更改很多）的高级版本。

但没有硬性规定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T15:30:05.357

取决于你的团队的职责是如何划分的。通常，我会说技术主管（应用程序架构师）会进行数据模型设计。然后 DBA 可以实施和调整数据库以提供最佳性能。

不过，这总是会根据技术主管和 DBA 的技能而改变……

# java - 在 Java 中使用线程和递归计算斐波那契数

> ID：706048
> 
> 赞同：13
> 
> 时间：2009-04-01T15:25:52.137
> 
> 标签：java, multithreading, recursion

我在 Java 世界中相对较新，我有一个我不明白的问题。

我有一个类（获取斐波那契行）：

```
class Fib {
    public static int f(int x){
        if ( x < 2 )
            return 1;       
        else 
            return f(x-1)+ f(x-2);      
    }
} 
```

现在的任务是在单独的线程中启动 f(x-1) 和 f(x-2)。一次是实现 Thread 类，另一次是实现 Runnable。你可能知道，这是我教授的练习。

我知道如何在 Java 中启动一个线程，并且我知道这整个线程在理论上是如何工作的，但是我找不到在这个递归函数中启动单独线程的解决方案。

在运行函数中必须做什么？

大概

```
public void run(){
//int foo=start f(this.x-1)
    //int bar=start f(this.x-2)  
    //return foo+bar?
} 
```

以及如何将 x 粘贴到我的可运行函数中？x 是否在创建时传递给对象？

```
Class Fib ...{
  int x;
  public ... run ... 
  public ... f(x)....

} 
```

在主要方法中

```
(new Fib(x)).start(); 
```

还是我走上了完全错误的道路？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-01T15:41:21.037

为此，您需要 1) 将数字传递给新线程的方法，2) 启动线程，3) 等待线程完成，以及 4) 从线程获取结果的方法.

您可以通过构造函数传入数字。您可以有一个名为“answer”的公共数据成员来包含计算结果。可以用`start()`方法启动线程，`join()`方法等待线程完成。

下面的示例演示了这一点。这应该是一个很好的起点；从这里你可以抽象出一些杂乱无章的东西，以根据需要获得更好的 API。

```
public class Fib extends Thread
{
    private int x;
    public int answer;

    public Fib(int x) {
        this.x = x;
    }

    public void run() {
        if( x <= 2 )
            answer = 1;
        else {
            try {
                Fib f1 = new Fib(x-1);
                Fib f2 = new Fib(x-2);
                f1.start();
                f2.start();
                f1.join();
                f2.join();
                answer = f1.answer + f2.answer;
            }
            catch(InterruptedException ex) { }
        }
    }

    public static void main(String[] args)
        throws Exception
    {
        try {
            Fib f = new Fib( Integer.parseInt(args[0]) );
            f.start();
            f.join();
            System.out.println(f.answer);
        }
        catch(Exception e) {
            System.out.println("usage: java Fib NUMBER");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-01T19:50:56.553

使用线程通常旨在提高性能。但是，每个线程都会增加开销，如果执行的任务很小，那么开销可能会比实际完成的工作多得多。此外，大多数 PC 只能处理大约 1000 个线程，如果线程数超过 10K，就会挂起。

在您的情况下，fib(20) 将生成 6765 个线程，fib(30) 创建 832K，fib(40) 创建 102M 线程，fib(50) 创建超过 12 万亿个线程。我希望你能看到这是不可扩展的。

但是，使用不同的方法，您可以在一分钟内计算出 fib(1000000)。

```
import java.math.BigInteger;

/*
250000th fib # is: 36356117010939561826426 .... 10243516470957309231046875
Time to compute: 3.466557 seconds.
1000000th fib # is: 1953282128707757731632 .... 93411568996526838242546875
Time to compute: 58.1 seconds.
*/
public class Main {
    public static void main(String... args) {
        int place = args.length > 0 ? Integer.parseInt(args[0]) : 250 * 1000;
        long start = System.nanoTime();
        BigInteger fibNumber = fib(place);
        long time = System.nanoTime() - start;

        System.out.println(place + "th fib # is: " + fibNumber);
        System.out.printf("Time to compute: %5.1f seconds.%n", time / 1.0e9);
    }

    private static BigInteger fib(int place) {
        BigInteger a = new BigInteger("0");
        BigInteger b = new BigInteger("1");
        while (place-- > 1) {
            BigInteger t = b;
            b = a.add(b);
            a = t;
        }
        return b;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T15:44:49.580

您对在`fib`函数中启动线程以及`x`通过构造函数传递给对象有正确的想法；您还需要有一种方法可以在最后从对象中获取计算结果 - 我相信您可以弄清楚 ;-) 您使用的线程启动过程与您使用`fib`的方式相同总是启动一个线程，`(new Fib(x-1)).start()`尽管您可能希望将线程保存在一个变量中，因为您稍后需要它来获取计算结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T22:58:58.740

因此，在你们所有人的帮助下，我设法通过实现可运行而不是使用线程类来做同样的事情。

如果任务是实现runnable，你们都可以看看并告诉我这是否是如何做到的。守则本身有效。

```
public class Fib implements Runnable
{
private int x;
public  int answer;

public Fib(int x) {
    this.x = x;
}

public void run() {
    if( x < 2 )
        answer = 1;
    else {
        try {
            Fib f1= new Fib(x-1);
            Fib f2= new Fib(x-2);
            Thread threadf1=new Thread(f1);
            Thread threadf2=new Thread(f2);
            threadf1.start();
            threadf2.start();
            threadf1.join();
            threadf2.join();

            answer = f1.answer + f2.answer;

        }
        catch(InterruptedException ex) { }
    }
}

public static void main(String[] args)

{
    try {

            for (int i=0;i<19;i++){
                Fib f= new Fib(i);
                Thread threadf= new Thread(f);
                threadf.start();
                threadf.join();

                System.out.println("Ergebnis:"+f.answer);

            }
        }

    catch(Exception e) {
        System.out.println("usage: java Fib NUMBER");
    }
  }
} 
```

# bash - 如何更改 bash 中的选项卡自动完成功能以浏览文件夹？

> ID：706049
> 
> 赞同：1
> 
> 时间：2009-04-01T15:26:05.083
> 
> 标签：bash, autocomplete

我有一个文件夹“test”，其中包含另一个文件夹“test2”

当我输入“cd te[tab]”时，它会自动完成为“cd test/”

如何使其自动完成到“cd test/test2/”，而无需再次点击选项卡？

澄清一下：test 是文件夹 test 中唯一的文件夹/文件。我希望它递归地工作，所以如果有一个文件夹/with/a/lot/of/single/files/or/folders/in/it

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T15:55:33.237

Bash 支持可编程的自动完成（至少从 3.0 版开始）。bash手册中有一些文档

[http://www.gnu.org/software/bash/manual/bashref.html#Programmable-Completion](http://www.gnu.org/software/bash/manual/bashref.html#Programmable-Completion)

查看现有脚本以了解如何真正利用该功能也可能是一个好主意。例如，Debian 有一个 /etc/bash_completion 文件，其中包含各种程序的完成脚本。我确定其他发行版也有类似的东西

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T15:31:37.160

bash 很难理解您想要跳转到测试还是测试/测试。所以我相信没有标准的设置。

但是您始终可以为特定情况使用别名命令，例如

```
alias cdtest="cd test/test" 
```

# c++ - 构造函数定义和声明不匹配

> ID：706059
> 
> 赞同：5
> 
> 时间：2009-04-01T15:29:54.153
> 
> 标签：c++, g++, solaris

我有以下 C++ 代码，其中声明中构造函数的参数与构造函数的定义具有不同的常量。

```
//testClass.hpp
class testClass {
  public:
     testClass(const int *x);
};

//testClass.cpp
testClass::testClass(const int * const x) {} 
```

我能够使用 g++ 在没有警告的情况下编译它，这段代码应该编译还是至少给出一些警告？事实证明，64 位 solaris 上的内置 C++ 编译器给了我一个链接器错误，这就是我注意到存在问题的原因。

在这种情况下，匹配参数的规则是什么？这取决于编译器吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T15:32:47.550

在这种情况下，允许从*声明*中省略 const 说明符，因为它不会改变调用者的任何内容。

它仅与实现细节的上下文有关。所以这就是为什么它在*定义*上而不是在*声明*上。

例子：

```
//Both f and g have the same signature
void f(int x);
void g(const int x);

void f(const int x)//this is allowed
{
}

void g(const int x)
{
} 
```

任何调用 f 的人都不会关心您是否会将其视为 const，因为它是您自己的变量副本。

与 int * const x 一样，它是你的指针的副本。你是否可以指向其他东西对调用者来说并不重要。

如果您在 const int * const 中省略了第一个 const，那么这会有所不同，因为如果您更改它指向的数据，这对调用者很重要。

**参考：*C++ 标准*，8.3.5 第 3 段：**

> “任何修改参数类型的 cv 限定符都将被删除......这样的 cv 限定符仅影响带有函数体的参数定义；它们不影响函数类型”

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T15:32:39.687

将其视为相同的区别

```
//testClass.hpp
class testClass {
  public:
     testClass(const int x);
};

//testClass.cpp
testClass::testClass(int x) {} 
```

这也可以编译。您不能基于按值传递参数的 const-ness 重载。想象一下这种情况：

```
void f(int x) { }
void f(const int x) { } // Can't compile both of these.

int main()
{
   f(7); // Which gets called?
} 
```

从标准：

> 仅在存在或不存在 const 和/或 volatile 方面不同的参数声明是等效的。也就是说，在确定声明、定义或调用哪个函数时，将忽略每个参数类型的 const 和 volatile 类型说明符。[例子：

```
typedef const int cInt;
int f (int);
int f (const int); // redeclaration of f(int)
int f (int) { ... } // definition of f(int)
int f (cInt) { ... } // error: redefinition of f(int) 
```

> —end example] 只有参数类型说明最外层的 const 和 volatile 类型说明符以这种方式被忽略；隐藏在参数类型规范中的 const 和 volatile 类型说明符很重要，可用于区分重载函数声明。112) 特别是，对于任何类型 T，“指向 T”、“指向 const T 的指针”和“指针to volatile T”被认为是不同的参数类型，“reference to T”、“reference to const T”和“reference to volatile T”也是如此。</p>

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-01T15:39:04.680

此示例在重载解决部分 13.1/3b4 中明确介绍：

> 仅在存在或不存在 const 和/或 volatile 方面不同的参数声明是等效的。也就是说，在确定声明、定义或调用哪个函数时，将忽略每个参数类型的 const 和 volatile 类型说明符。
> 
> [例子：
> 
> ```
> typedef const int cInt;
> int f (int);
> int f (const int); // redeclaration of f(int)
> int f (int) { ... } // definition of f(int)
> int f (cInt) { ... } // error: redefinition of f(int) 
> ```
> 
> ——结束示例]

所以，肯定没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T15:33:15.177

不`const int * const x`一样因为`const int * x`你已经做了const吗？

# wpf - 如何将项目模板中的控件数据绑定到项目本身，而不是其属性之一？

> ID：706072
> 
> 赞同：1
> 
> 时间：2009-04-01T15:32:49.903
> 
> 标签：wpf, data-binding

我有一个 WPF ListBox，它数据绑定到 Employee 类型的 ObservableCollection。在 ItemTemplate 中，我像往常一样将控件的内容绑定到各种属性。但是对于模板中的一个控件，我创建了一个它使用的自定义转换器类，并且我希望转换器作为值传入 Employee 对象本身，而不是它的属性之一。这很容易做到吗？我不想诉诸于向 Employee 添加只读属性的方法，它的 getter 只是说 return this。

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T15:38:18.503

只需使用

```
{Binding} 
```

或者

```
{Binding Converter={...}} 
```

即没有`Path`.

# vim - Vim 删除空行

> ID：706076
> 
> 赞同：708
> 
> 时间：2009-04-01T15:34:13.177
> 
> 标签：vim, vi

我可以运行什么命令来删除 Vim 中的空行？

* * *

## 回答 #1

> 赞同：1309
> 
> 时间：2009-04-01T15:36:32.220

```
:g/^$/d 
```

`:g`将在匹配正则表达式的行上执行命令。正则表达式是“空白行”，命令是`:d`（删除）

* * *

## 回答 #2

> 赞同：195
> 
> 时间：2009-04-01T15:35:46.590

找到了，是：

```
g/^\s*$/d 
```

资料来源：[vim wikia上](http://vim.wikia.com/wiki/Power_of_g)[*g*](http://vim.wikia.com/wiki/Power_of_g)[的力量](http://vim.wikia.com/wiki/Power_of_g)

 *> 简要说明`:g`
> 
> ```
> :[range]g/pattern/cmd 
> ```
> 
> 这作用于指定的*[范围]*（默认整个文件），通过为每个行匹配*模式执行 Ex 命令**cmd*（Ex 命令是以冒号开头的命令，例如删除）。在执行*cmd*之前，“ ”被设置为当前行。*`:d`*`.`**

 *** * *

## 回答 #3

> 赞同：55
> 
> 时间：2009-04-01T15:36:42.250

```
:v/./d 
```

或者

```
:g/^$/d 
```

或者

```
:%!cat -s 
```

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2009-04-07T14:52:09.697

以下可用于仅删除多个空行（将它们减少为单个空行）并保持单个空行完整：

```
:g/^\_$\n\_^$/d 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2012-10-26T07:12:54.980

1.  如何删除所有的空白行

    ```
    :%s,\n\n,^M,g 
    ```

    （多次执行此操作，直到所有空行都消失了）

2.  如何删除所有空白行留下 SINGLE 空行

    ```
    :%s,\n\n\n,^M^M,g 
    ```

    （多次这样做）

3.  如何删除所有空白行，最多留下两个空行，

    ```
    :%s,\n\n\n\n,^M^M^M,g 
    ```

    （多次这样做）

为了输入^M，我必须在windows中控制-Q和控制-M

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-01T15:38:21.000

怎么样：

```
:g/^[ \t]*$/d 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-02-28T16:34:08.283

这对我有用

`:%s/^\s*$\n//gc`

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-05-01T13:17:18.503

在 vim 中使用 perl：

`:%!perl -pi -e s/^\s*$//g`

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-05-01T20:10:55.710

这个函数只删除两个或多个空行，把下面的行放在你的vimrc中，然后用\d调用函数

```
fun! DelBlank()
   let _s=@/
   let l = line(".")
   let c = col(".")
   :g/^\n\{2,}/d
   let @/=_s
   call cursor(l, c)
endfun
map <special> <leader>d :keepjumps call DelBlank()<cr> 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-04-07T16:26:14.210

我在此页面上尝试了一些答案，但其中很多对我不起作用。也许是因为我在 Windows 7 上使用 Vim（不要嘲笑，只是可怜我 :p）？

这是我发现在 Windows 7 中的 Vim 上工作的最简单的一个：

```
:v/\S/d 
```

这是关于 Vim Wikia 的更长答案：http: [//vim.wikia.com/wiki/Remove_unwanted_empty_lines](http://vim.wikia.com/wiki/Remove_unwanted_empty_lines)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-04-30T06:56:19.700

```
:g/^\s*$/d
^ begin of a line
\s* at least 0 spaces and as many as possible (greedy)
$ end of a line 
```

粘贴

```
:command -range=% DBL :<line1>,<line2>g/^\s*$/d 
```

在你的 .vimrc 中，然后重新启动你的 vim。如果您使用命令 :5,12DBL 它将删除第 5 行和第 12 行之间的所有空白行。我认为我的答案是最好的答案！

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-08-01T06:48:33.080

如果某些内容对您的文本进行了双倍行距，则此命令将删除双倍行距并将预先存在的重复空行合并为一个空行。它在行首使用 ^^^ 的临时分隔符，因此如果这与您的内容冲突，请选择其他内容。仅包含空格的行被视为空白。

```
%s/^\s*\n\n\+/^^^\r/g | g/^\s*$/d | %s/^^^^.* 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-08-17T09:26:28.260

在插入模式下按`delete`键删除空行。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-01-03T23:32:33.763

这对我有用：

```
:%s/^[^a-zA-Z0-9]$\n//ig 
```

它基本上删除了所有没有数字或字母的行。由于我列表中的所有项目都有字母，因此它删除了所有空白行。

# dns - DNS：如何从 TLD 中挖掘正确的域名？

> ID：706077
> 
> 赞同：4
> 
> 时间：2009-04-01T15:35:19.897
> 
> 标签：dns, domain-name, tld, dig

我想查询 DNS 记录，直到获得正确的域名。

例如，给定 www.subdomain.site.com.br，可以从 .br 挖掘到 site.com.br。

实现这一目标的最（协议）方式是什么？最好使用 dig/nslookup 的食谱。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T15:36:49.987

```
dig +trace www.subdomain.site.com.br 
```

会告诉你到底发生了什么。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T15:38:06.210

```
dig www.mysite.domain.com @a.root-servers.net 
```

您将从那里获得下一个级别。只需替换“@”之后的部分并继续递归，直到您查询给出答案而不是附加信息的服务器

# java - 将 JBoss 错误页面替换为 Axis2 故障 XML 响应

> ID：706079
> 
> 赞同：0
> 
> 时间：2009-04-01T15:35:49.087
> 
> 标签：java, tomcat, jboss, axis2

我正在 JBoss 4.2.3/Tomcat 5.5.27 和 Java 1.5.0 (15-b04) 上使用 Axis2 1.4.1 开发 Web 服务。它可以完美运行，但是当发生异常时，我会收到 JBoss 错误 500 HTML 页面，而不是 Axis2 XML/SOAP 错误。

这种行为令人烦恼，因为在开发过程中很难处理 web 服务客户端或 SoapUI 中的错误。

我可以更改它以获取 SOAP 错误吗？也许它只是一个 Axis2 或 JBoss 参数，但我没有找到任何线索。

编辑：这是新的堆栈跟踪：

```
[ERROR] WSDoAllReceiver: security processing failed
org.apache.axis2.AxisFault: WSDoAllReceiver: security processing failed
    at org.apache.rampart.handler.WSDoAllReceiver.processBasic(WSDoAllReceiver.java:214)
    at org.apache.rampart.handler.WSDoAllReceiver.processMessage(WSDoAllReceiver.java:86)
    at org.apache.rampart.handler.WSDoAllHandler.invoke(WSDoAllHandler.java:72)
    at org.apache.axis2.engine.Phase.invoke(Phase.java:317)
    at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:264)
    at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:163)
    at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:275)
    at org.apache.axis2.transport.http.AxisServlet.doPost(AxisServlet.java:133)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:647)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:172)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:174)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:875)
    at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:665)
    at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:528)
    at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:81)
    at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:689)
    at java.lang.Thread.run(Thread.java:595)
Caused by: org.apache.ws.security.WSSecurityException: The security token could not be authenticated or authorized
    at org.apache.ws.security.processor.UsernameTokenProcessor.handleUsernameToken(UsernameTokenProcessor.java:155)
    at org.apache.ws.security.processor.UsernameTokenProcessor.handleToken(UsernameTokenProcessor.java:53)
    at org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:311)
    at org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:228)
    at org.apache.rampart.handler.WSDoAllReceiver.processBasic(WSDoAllReceiver.java:211)
    ... 23 more
[ERROR] Servlet.service() para servlet AxisServlet lanzó excepción
java.lang.NullPointerException
    at org.apache.rampart.RampartMessageData.<init>(RampartMessageData.java:308)
    at org.apache.rampart.MessageBuilder.build(MessageBuilder.java:61)
    at org.apache.rampart.handler.RampartSender.invoke(RampartSender.java:64)
    at org.apache.axis2.engine.Phase.invoke(Phase.java:317)
    at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:264)
    at org.apache.axis2.engine.AxisEngine.sendFault(AxisEngine.java:520)
    at org.apache.axis2.transport.http.AxisServlet.handleFault(AxisServlet.java:416)
    at org.apache.axis2.transport.http.AxisServlet.processAxisFault(AxisServlet.java:379)
    at org.apache.axis2.transport.http.AxisServlet.doPost(AxisServlet.java:167)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:647)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:172)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:174)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:875)
    at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:665)
    at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:528)
    at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:81)
    at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:689)
    at java.lang.Thread.run(Thread.java:595) 
```

编辑 2：在给予赏金之后，我发现我对 Axiom 的 1.2.9-SNAPSHOT 版本是错误的。我再次构建它，确保正确复制到 lib 目录的 jar 并且它有效！

最后，正如 Vineet 提供的链接中所说，这是一个 Axiom 错误。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T21:28:56.663

如果没有异常的详细信息，我只能推测 Web 服务实现正在引发运行时异常，该异常不是 SOAPFault 或 AxisFault 类（或其子类）的实例。在这种情况下，JBoss 的默认行为是在响应中传递错误页面，因为 Web 服务毕竟是 servlet。

这通常表明 Web 服务必须适当地处理异常并引发适当的 SOAP 错误，以防止异常在调用堆栈中传播。

**更新**

堆栈跟踪将有助于确定此问题的根本原因。但无论如何我都会在黑暗中拍摄:)

您可以参考问题[RAMPART-164](http://issues.apache.org/jira/browse/RAMPART-164)并查看这是否是问题的实际原因。简而言之，从可用的信息来看，可以使用 SOAP 1.2。不过，我不确定该修复程序是否已传播到 AXIOM 1.2.8，因为我没有看到对[WSCOMMONS-343 的](https://issues.apache.org/jira/browse/WSCOMMONS-343)任何引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-04T14:58:01.753

壁垒核心 jar 文件中有一个错误。RampartSender 中的 MessageBuilder 在将响应发送回客户端时期望消息上下文中的 AxisService。在这种情况下，它为 null 会引发 NUllpointer 异常。在 RampartMessageData 中添加一个空检查并重建壁垒核心 jar 并使用它。该应用程序应该可以正常工作。

```
AxisService service = msgCtx.getAxisService();
if (service != null) {
  this.customClassLoader = msgCtx.getAxisService()
    .getClassLoader();
} 
```

# sql - 如何编写此 SQL 语句

> ID：706096
> 
> 赞同：1
> 
> 时间：2009-04-01T15:38:14.103
> 
> 标签：sql, sql-server

table1 有 3 列：

Id 用户名 SubmittedDate
1 Joe 1/1/2006
2 Joe 1/1/2007
3 Nat 1/1/2008
4 Pat 1/1/2009

我想返回这个：

Id 用户名
2 Joe
3 Nat
4 Pat

我只想要一张给乔的唱片，最近的一张。

如何编写此查询？谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T15:39:51.370

```
SELECT  Id, UserName, SubmittedDate
FROM    (
        SELECT  Id, UserName, SubmittedDate,
                ROW_NUMBER() OVER (PARTITION BY UserName ORDER BY SubmittedDate DESC) rn
        FROM    table1
        ) q
WHERE rn = 1 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T15:41:51.443

```
SELECT MAX(ID), UserName
FROM table
GROUP BY UserName 
```

请注意，这假设更高的 ID 意味着稍后。它不直接查询提交日期字段。为此，请使用 Quassnoi 更复杂的一个 :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T15:45:49.297

仅使用标准 SQL：

```
SELECT Id, UserName
FROM table1
JOIN (
    SELECT UserName, MAX(SubmittedDate) AS MaxDate
    FROM table1
    GROUP BY UserName
    ) AS MaxDateTable ON table1.UserName = MaxDateTable.UserName
WHERE SubmittedDate = MaxDate 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T15:50:39.860

以下是三个潜在的解决方案。试一试，看看哪个更适合您的数据和情况。请记住，在用户名具有两个相同的提交日期值的情况下，结果可能不是您所期望的。

```
SELECT
    T1.id,
    T1.username
FROM
    My_Table T1
INNER JOIN 
  (
   SELECT username, MAX(submitted_date) 
   FROM My_Table T2 GROUP BY username
  ) SQ 
    ON SQ.username = T1.username AND SQ.submitted_date = T1.submitted_date 
```

.

```
SELECT
    T1.id,
    T1.username
FROM
    My_Table T1
WHERE
    NOT EXISTS 
    (
      SELECT * 
      FROM
         My_Table T2 
      WHERE
         T2.username = T1.username AND
         T2.submitted_date > T1.submitted_date
    ) 
```

.

```
SELECT
    T1.id,
    T1.username
FROM
    My_Table T1
LEFT OUTER JOIN My_Table T2 ON
    T2.username = T1.username AND
    T2.submitted_date > T1.submitted_date
WHERE
    T2.id IS NULL 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T15:50:02.187

扯掉@Quassnoi，但我喜欢宣传使用[CTE](http://msdn.microsoft.com/en-us/library/ms190766.aspx)代替子查询和大多数视图。

```
WITH
query1 as(
    SELECT  Id, UserName, SubmittedDate,
            ROW_NUMBER() OVER (PARTITION BY UserName ORDER BY SubmittedDate DESC) rn
    FROM    table1
        )

SELECT  Id, UserName, SubmittedDate
FROM   query1
WHERE rn = 1 
```

# asp.net-mvc - ActionLink 的空引用异常

> ID：706099
> 
> 赞同：0
> 
> 时间：2009-04-01T15:38:36.943
> 
> 标签：asp.net-mvc

我刚刚从 ASP.NET MVC Beta 升级到新发布的 V1 - 但是突然下面的代码抛出了一个空引用异常。这之前工作正常，完全没有问题。有没有人有任何想法？

```
<%= Html.ActionLink<Website.Web.Controllers.PageController>(x => x.Edit(2), "Edit") %> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T15:43:40.673

看起来您正在使用 MvcFutures 程序集中的 ActionLink 扩展。您是否也更新到了最新的期货版本？请注意，我不使用 MvcFutures，所以我不知道最新版本是否适用于 RTW 版本的 ASP.NET MVC。

# python - Python 2.6 JSON 解码性能

> ID：706101
> 
> 赞同：45
> 
> 时间：2009-04-01T15:39:31.480
> 
> 标签：python, json, python-2.6

我正在使用`json`Python 2.6 中的模块来加载和解码 JSON 文件。但是，我目前的表现比预期的要慢。`json.loads()`我正在使用一个大小为 6MB 且需要 20 秒的测试用例。

我认为该`json`模块有一些本机代码来加速解码？

我如何检查是否正在使用它？

作为比较，我下载并安装了`python-cjson`模块，并且`cjson.decode()`对于相同的测试用例需要 1 秒。

我宁愿使用 Python 2.6 提供的 JSON 模块，这样我的代码的用户就不需要安装额外的模块。

（我在 Mac OS X 上开发，但在 Windows XP 上得到了类似的结果。）

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2011-04-28T15:29:52.973

新的[Yajl - Yet Another JSON Library](https://github.com/rtyler/py-yajl/)非常快。

```
yajl        serialize: 0.180  deserialize: 0.182  total: 0.362
simplejson  serialize: 0.840  deserialize: 0.490  total: 1.331
stdlib json serialize: 2.812  deserialize: 8.725  total: 11.537 
```

您可以[自己比较这些库](https://github.com/rtyler/py-yajl/blob/master/compare.py)。

**更新：** [UltraJSON](https://github.com/esnme/ultrajson)更快。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-01T16:30:29.767

它可能因平台而异，但内置 json 模块基于[simplejson](http://pypi.python.org/pypi/simplejson/)，不包括 C 加速。无论如何，我发现 simplejson 和 python-cjson 一样快，所以我更喜欢它，因为它显然具有与内置相同的接口。

```
try:
    import simplejson as json
except ImportError:
    import json 
```

在我看来，这是一段时间内最好的习惯用法，在向前兼容的同时产生可用的性能。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-01-25T00:09:00.147

我正在解析同一个文件 10 倍。文件大小为 1,856,944 字节。

蟒蛇2.6：

```
yajl        serialize: 0.294  deserialize: 0.334  total: 0.627
cjson       serialize: 0.494  deserialize: 0.276  total: 0.769
simplejson  serialize: 0.554  deserialize: 0.268  total: 0.823
stdlib json serialize: 3.917  deserialize: 17.508 total: 21.425 
```

蟒蛇 2.7：

```
yajl        serialize: 0.289  deserialize: 0.312  total: 0.601
cjson       serialize: 0.232  deserialize: 0.254  total: 0.486
simplejson  serialize: 0.288  deserialize: 0.253  total: 0.540
stdlib json serialize: 0.273  deserialize: 0.256  total: 0.528 
```

不知道为什么数字与您的结果不成比例。我猜，更新的图书馆？

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-03-15T19:41:37.283

看看 UltraJSON [https://github.com/esnme/ultrajson](https://github.com/esnme/ultrajson)

这是我的测试（代码来自：[https](https://gist.github.com/lightcatcher/1136415) ://gist.github.com/lightcatcher/1136415 ）

平台：OS X 10.8.3 MBP 2.2 GHz Intel Core i7

JSON：

simplejson==3.1.0

python-cjson==1.0.5

jsonlib==1.6.1

ujson==1.30

yajl==0.3.5

```
JSON Benchmark
2.7.2 (default, Oct 11 2012, 20:14:37)
[GCC 4.2.1 Compatible Apple Clang 4.0 (tags/Apple/clang-418.0.60)]
-----------------------------
ENCODING
simplejson: 0.293394s
cjson: 0.461517s
ujson: 0.222278s
jsonlib: 0.428641s
json: 0.759091s
yajl: 0.388836s

DECODING
simplejson: 0.556367s
cjson: 0.42649s
ujson: 0.212396s
jsonlib: 0.265861s
json: 0.365553s
yajl: 0.361718s 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-10-08T16:58:29.660

对于那些使用 requests 包解析请求输出的人，例如：

```
res = requests.request(...)

text = json.loads(res.text) 
```

对于较大的响应内容，这可能会非常慢，比如我的 2017 MacBook 上的 6 MB 大约 45 秒。它不是由缓慢的 json 解析器引起的，而是由 res.text 调用的缓慢字符集确定引起的。

*您可以通过在调用 res.text之前*设置字符集并使用[cchardet](https://pypi.python.org/pypi/cchardet/)包来解决此问题（另请参见[此处](https://github.com/requests/requests/issues/2359#issuecomment-126411822)）：

```
if res.encoding is None:
    res.encoding = cchardet.detect(res.content)['encoding'] 
```

这使得响应文本 json 解析几乎是即时的！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-01T16:04:36.397

查看我在 Windows 上安装的 Python 2.6.1，该`json`包加载了`_json`内置于运行时的模块。模块的`C`来源在[这里](http://svn.python.org/view/python/trunk/Modules/_json.c?view=markup)。`json speedups`

```
>>> import _json
>>> _json
<module '_json' (built-in)>
>>> print _json.__doc__
json speedups
>>> dir(_json)
['__doc__', '__name__', '__package__', 'encode_basestring_ascii', 'scanstring']
>>> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-04T16:20:30.963

尽管`_json`可用，但我注意到 CPython 2.6.6 上的 json 解码非常慢。我没有与其他实现进行比较，但是在性能关键循环中我已经切换到字符串操作。

# php - 对象和字符串

> ID：706102
> 
> 赞同：1
> 
> 时间：2009-04-01T15:39:36.987
> 
> 标签：php, object

我试图返回一组对象。

但是这段代码给了我以下错误：

可捕获的致命错误：无法将类 User 的对象转换为...

```
 public function fetchObject($psClassname ="",$paParams =array()){
            $lrResource = $this->mrQueryResource;
            $liResult = null; 
            while($row = mysql_fetch_object($lrResource,$psClassname,$paParams)){
                $liResult .= $row;     <-this line produces the error
            }
            return $liResult;
         } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T15:51:10.437

在您的代码中，$row 是一个对象（您使用过 mysql_fetch_object），并且 .= 运算符尝试构建一个字符串，将 $liResult 和 $row 连接起来。我相信这种行为只有在你的对象实现了[toString 方法时才有效](http://uk3.php.net/manual/en/language.oop5.magic.php#language.oop5.magic.tostring)

您可以使用以下代码返回一个行数组：

```
public function fetchObject($psClassname ="",$paParams =array()){
        $lrResource = $this->mrQueryResource;
        $liResult = array();
        while($row = mysql_fetch_object($lrResource,$psClassname,$paParams)){
                $liResult[] = $row;
        }
        return $liResult;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T15:49:53.530

那是因为您正在尝试将 $row 转换为字符串（ .= 假定在右侧给出了字符串）

# java - 是否有等效的 BufferedReader.readLine() 让我选择行尾字符是什么？

> ID：706105
> 
> 赞同：14
> 
> 时间：2009-04-01T15:40:56.547
> 
> 标签：java, io, newline, line-endings

[BufferedReader.readLine()](http://java.sun.com/j2se/1.5.0/docs/api/java/io/BufferedReader.html#readLine())的 Javadoc说：

> 一行被认为是由换行符 ('\n')、回车符 ('\r') 或紧跟换行符的回车符中的任何一个终止的。

我需要比这更好的控制（例如，我希望能够指定行尾是“\r\n”，以便“\n”本身不会终止行）。

是否有任何 JDK 或库函数可以做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-01T15:51:14.773

尝试使用[Scanner](http://docs.oracle.com/javase/7/docs/api/java/util/Scanner.html)类：

```
String line = Scanner(file).useDelimiter("\r\n").next(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T15:54:01.757

根据您需要 BufferedReader 的用例，您可以改用 Scanner 类，该类能够从不同的源（文件、流）读取文本，并具有指定分隔模式的直接方法。请参阅[http://java.sun.com/j2se/1.5.0/docs/api/java/util/Scanner.html#useDelimiter(java.lang.String)](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Scanner.html#useDelimiter(java.lang.String))

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T15:48:48.977

我不知道有任何标准 API 可以实现这一点。

可以简单地将整个文件读入字符串，然后将其拆分为所需的结束字符。

```
for(String line: testFile.split("\r\n")){
...
} 
```

# javascript - Onleftclick 和 onrightClick Javascript 函数

> ID：706107
> 
> 赞同：3
> 
> 时间：2009-04-01T15:41:06.670
> 
> 标签：javascript, c#, asp.net, dom-events

在我的服务器端代码中，我正在动态构建一个表格，现在我正在添加以下代码来处理行点击。

```
tr.Attributes.Add("onclick", "window.open('" + root + document.IPT_Name + "/" + document.IPT_Sub_Name + "/" + document.File_Name + "', 'mywindow', 'toolbar=no,location=no,directories=no,status=no,menubar=yes,scrollbars=yes,copyhistory=no, resizable=yes')"); 
```

有什么方法可以使这项工作仅左键单击，然后在右键单击时添加不同的属性以转到不同的位置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T16:15:45.807

您可以检测到它，但您必须注意一些特定于浏览器的问题。[这是来自http://www.quirksmode.org/js/events_properties.html](http://www.quirksmode.org/js/events_properties.html)的一些代码

```
function doSomething(e) {
  var rightclick;
  if (!e) var e = window.event;
  if (e.which) rightclick = (e.which == 3);
  else if (e.button) rightclick = (e.button == 2);
  alert('Rightclick: ' + rightclick); // true or false
} 
```

还有一个[jQuery](http://jquery.com/)插件，可以检测鼠标右键： http: [//abeautifulsite.net/notebook/68](http://abeautifulsite.net/notebook/68)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-18T23:12:51.933

[这是从jQuery 1.3.2](http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js)中提取的一些代码，其中包含解释`event.which`和`event.button`.

```
// Add which for click: 1 == left; 2 == middle; 3 == right
// Note: button is not normalized, so don't use it
if ( !event.which && event.button )
    event.which = (event.button & 1 ? 1 : ( event.button & 2 ? 3 : ( event.button & 4 ? 2 : 0 ) )); 
```

# php - 根据 $_GET 选择一个选项。这甚至可能吗？

> ID：706110
> 
> 赞同：0
> 
> 时间：2009-04-01T15:41:45.967
> 
> 标签：php, javascript, html, get

我有一个快速的问题。

有可能做这样的事情吗？

这些选项是基于 foreach 循环动态生成的。我希望循环在 $_GET['t'] 等于 $k 的地方停止并使其被选中。

```
<option value="http://domain.com/<?php print $k; ?>/" <?php if ($k == $_GET['t']) print 'selected'; ?>><?php print $v; ?></option> 
```

基本上有一种方法可以根据地址栏上提供的 $_GET[t'] 值来选择/突出显示该选项。我试过了，我得到 undefined index: t 错误。

我错过了什么吗？

非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T15:45:12.870

您收到未定义的错误，因为“t”不在您的`$_GET`请求中。

确保您调用的是正确的网址（即：example.com/script.php?t=test）

请确保您正在检查值（如其他人建议的那样）`isset($_GET['t'])`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T15:43:55.947

你几乎明白了 - xhtml 实际上是 selected="selected"

```
<option value="http://domain.com/<?php print $k; ?>/" <?php if ($k == $_GET['t']) print 'selected="selected"'; ?>><?php print $v; ?></option> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T15:46:15.287

在亚当指出的内容之上，您是否通过最后实际传递“t=something”进行测试？此代码应通过测试是否先设置 t 来消除错误：

```
<option value="http://domain.com/<?php print $k; ?>/" <?php if (isset($_GET['t']) && $k == $_GET['t']) print 'selected="selected"'; ?>><?php print $v; ?></option> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T06:52:56.370

您不应该使用 GET 来更改页面上的表单值。您应该为此使用 POST :)

这样，如果有人抓取您的页面，他们不会有 10 次相同的页面，只是更改了选择框:)

# java - Qt Jambi死了吗？

> ID：706114
> 
> 赞同：5
> 
> 时间：2009-04-01T15:42:53.937
> 
> 标签：java, swing, qt, qt-jambi

我知道他们在 2 月份宣布它将在明年过渡到社区开发的模型......但现在，我在他们的网站上根本找不到它，更不用说应该的 4.5 版了本月发布。

我即将着手一个主要项目的 GUI 部分，虽然我曾考虑使用 Qt Jambi，但我对创建一个明显已被放弃的产品的主要依赖项犹豫不决。有人知道这件事的真实情况吗？我应该放弃并使用 Swing 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T19:00:06.787

Jambi的[邮件列表](http://lists.trolltech.com/qt-jambi-interest/)似乎仍然有效。[您可以在档案](http://lists.trolltech.com/pipermail/qt-jambi-interest/2009-March/thread.html)中查看有关此主题的一些最新帖子。一位奇趣科技员工似乎对占碑的未来做出了回应，但这似乎并没有比他们的新闻稿所说的更多。

> 2009 年 3 月 10 日星期二 14:37:29 CET：
> 
> 我们希望来年会发展出一个贡献者社区，并努力帮助实现这一目标。那一年过去了，我们俩都无法在工作中花时间在这个项目上。但是，如果那时有一个蓬勃发展的社区，我也不希望我们中的任何一个完全消失:-)
> 
> 我们在这个项目上花了一些时间，我们绝对希望看到它在野外取得成功。但是，正如你所说，我们不能承诺超出我们有空闲时间的任何事情。
> 
> 一年的业余时间很长，所以我现在只说希望一年还有兴趣，希望能有机会帮忙。:-)
> 
> -- 埃斯基尔

还有另一个帖子，他们提到他们仍然期待很快发布。最新的代码可以在[这里](ftp://ftp.qtsoftware.com/qtjambi/source/)找到。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-16T17:50:01.630

在他们的 git 存储库的活动页面上有最近的提交。

[https://qt.gitorious.org/qt-jambi/qtjambi-community/activities](https://qt.gitorious.org/qt-jambi/qtjambi-community/activities)

# ruby - 如何使用每个迭代器获取数组索引或迭代号？

> ID：706115
> 
> 赞同：5
> 
> 时间：2009-04-01T15:43:11.907
> 
> 标签：ruby, indexing, iterator

我正在遍历每个 ruby​​ 中的数组。有没有一种简单的方法可以在不返回 for 循环的情况下获取迭代次数或数组索引？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-01T15:45:28.347

啊，明白了。

```
each_with_index 
```

呜！

编辑：哎呀！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-02-03T22:12:09.607

为了完整起见。

```
Thing.each_with_index {|obj, index_num| puts [obj, index_num].join(" has an index of ")} 
```

# c# - 套接字编程

> ID：706117
> 
> 赞同：0
> 
> 时间：2009-04-01T15:43:16.057
> 
> 标签：c#, .net, networking, sockets, tcp

好吧，伙计们，我已经绞尽脑汁，无法找到解决方案。这里的问题是我能够调用一次 begin-receive，但之后我无法找到一种可以一次又一次调用该方法的适当技术。因此，尽管正在建立连接，但消息只能收到一次，之后就不会再收到了。请帮忙，因为它非常紧急。非常感谢。我在这里写下整个代码。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.Net;
using System.Net.Sockets;
using System.Runtime.InteropServices;
using System.IO;
using.System.Threading;

namespace WindowsApplication1
{
public partial class lanmessenger : Form
{

    Socket client;
    Socket newSock, server, hostSock, remote;

    byte[] receiveBuffer = new byte[1024];
    byte[] sendBuffer = new byte[1024];

    String dataEntered;

    StringBuilder textbox1, receivedData, sb;

    IPEndPoint serverIP, clientIP;

    [DllImport("user32.dll")]
    static extern bool HideCaret(IntPtr hWnd);

    Socket s = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
    IPAddress localaddress = IPAddress.Parse("127.0.0.1");

    public void Receive()
    {
        if (remote.Connected)
            remote.BeginReceive(receiveBuffer, 0, receiveBuffer.Length, System.Net.Sockets.SocketFlags.None, new AsyncCallback(OnReceivingData), remote);
        else
            return;
    }

    void OnReceivingData(IAsyncResult ar)
    {

        remote = (Socket)ar.AsyncState;

        int recv = remote.EndReceive(ar);

        receivedData = new StringBuilder(Encoding.ASCII.GetString(receiveBuffer, 0, recv));
        //MessageBox.Show(receivedData.ToString(), "received", MessageBoxButtons.OK);

        sb = new StringBuilder(this.textBox1.Text);
        sb.AppendLine(receivedData.ToString());

        if (textBox1.InvokeRequired)
        {
            this.Invoke((MethodInvoker)delegate { this.textBox1.Text = sb.ToString(); });

        }
        //Receive();     

        return;
    }

    private void Accepted(IAsyncResult ar)
    {
        server = (Socket)ar.AsyncState;
        client = server.EndAccept(ar);
        /*if (client.Connected)
            MessageBox.Show("client connected");*/

        try
        {
            client.BeginReceive(receiveBuffer, 0, receiveBuffer.Length, System.Net.Sockets.SocketFlags.None, new AsyncCallback(OnReceivingData), client);
        }
        catch (ArgumentException)
        {
            MessageBox.Show("arguments incorrect in begin-receive call", "Error", MessageBoxButtons.OK);
        }
        catch (SocketException)
        {
            MessageBox.Show("error in accessing socket while receiving", "Error", MessageBoxButtons.OK);
        }
        catch (ObjectDisposedException)
        {
            MessageBox.Show("socket closed while receiving", "Error", MessageBoxButtons.OK);
        }
        catch (Exception)
        {
            MessageBox.Show("error while receiving", "Error", MessageBoxButtons.OK);
        }

    }

    public void FirstEndPoint()
    {
        newSock = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        clientIP = new IPEndPoint(localaddress, 5555);

        newSock.Bind(clientIP);
        newSock.Listen(100);

        try
        {
            newSock.BeginAccept(new AsyncCallback(Accepted), newSock);
        }
        catch (ArgumentException)
        {
            MessageBox.Show("Error in arguments while using begin-accept", "Error", MessageBoxButtons.OK);
        }
        catch (ObjectDisposedException)
        {
            MessageBox.Show("socket closed while using begin-accept", "Error", MessageBoxButtons.OK);
        }
        catch (SocketException)
        {
            MessageBox.Show("Error accessing socket while using begin-accept", "Error", MessageBoxButtons.OK);
        }
        catch (InvalidOperationException)
        {
            MessageBox.Show("Invalid operation while using begin-accept", "Error", MessageBoxButtons.OK);
        }
        catch (Exception)
        {
            MessageBox.Show("Exception occurred while using begin-accept", "Error", MessageBoxButtons.OK);
        }
    }

    public void CreateThread()
    {
        Thread FirstThread = new Thread(new ThreadStart(FirstEndPoint));
        FirstThread.Start();
    }

    public lanmessenger()
    {
        InitializeComponent();
        CreateThread();   

    }

    void OnSendingData(IAsyncResult ar)
    {
        Socket socket = (Socket)ar.AsyncState;
        int AmtOfData = socket.EndSend(ar);
        //MessageBox.Show(AmtOfData.ToString());

        return;
    }

    public void SendingData(Socket sock, String data)
    {
        textbox1.AppendLine(this.textBox2.Text);

        if (textBox1.InvokeRequired)
        {
            this.Invoke((MethodInvoker)delegate { this.textBox1.Text = textbox1.ToString(); });
        }

        if (textBox2.InvokeRequired)
        {
            this.Invoke((MethodInvoker)delegate { this.textBox2.Text = "\0"; });
        }

        sendBuffer = Encoding.ASCII.GetBytes(data);

        try
        {
            sock.BeginSend(sendBuffer, 0, sendBuffer.Length, SocketFlags.None, new AsyncCallback(OnSendingData), sock);
        }
        catch (ArgumentException)
        {
            MessageBox.Show("arguments incorrect in begin-send call", "Error", MessageBoxButtons.OK);
        }
        catch (SocketException ex)
        {
            String str1 = "error in accessing socket while sending" + ex.ErrorCode.ToString();
            MessageBox.Show(str1, "Error", MessageBoxButtons.OK);
        }
        catch (ObjectDisposedException)
        {
            MessageBox.Show("socket closed while sending", "Error", MessageBoxButtons.OK);
        }
        catch (Exception)
        {
            MessageBox.Show("error while sending", "Error", MessageBoxButtons.OK);
        }
    }

    private void OnClientConnect(IAsyncResult ar)
    {
        Socket sock = (Socket)ar.AsyncState;

        try
        {
            sock.EndConnect(ar);
            if (sock.Connected)
                MessageBox.Show("connected");

        }
        catch (SocketException ex)
        {
            MessageBox.Show("Error in accessing socket while using end-connect" + ex.ErrorCode.ToString(), "Error", MessageBoxButtons.OK);
            return;

        }

        if ((sock.Connected) && (dataEntered != ""))
        {
            SendingData(sock, dataEntered);
        }

    }

    private void button1_Click(object sender, EventArgs e)
    {

        HideCaret(this.textBox1.Handle);

        textbox1 = new StringBuilder(this.textBox1.Text);
        dataEntered = this.textBox2.Text;
        hostSock = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        serverIP = new IPEndPoint(localaddress, 5555);

        try
        {
            hostSock.BeginConnect(serverIP, new AsyncCallback(OnClientConnect), hostSock);
        }
        catch (ArgumentException)
        {
            MessageBox.Show("Error in arguments while using begin-connect", "Error", MessageBoxButtons.OK);
            return;
        }
        catch (SocketException)
        {
            MessageBox.Show("Error in accessing socket while using begin-connect", "Error", MessageBoxButtons.OK);
            return;
        }
        catch (ObjectDisposedException)
        {
            MessageBox.Show("socket closed while using begin-connect", "Error", MessageBoxButtons.OK);
            return;
        }
        catch (InvalidOperationException)
        {
            MessageBox.Show("Invalid operation while using begin-connect", "Error", MessageBoxButtons.OK);
            return;
        }

        catch (Exception)
        {
            MessageBox.Show("Exception while using begin-connect", "Error", MessageBoxButtons.OK);
            return;
        }

    }

} 
```

}

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T15:50:22.843

首先，您可能想用一些更合适的标签来标记您的问题。另外 - 由于这是从用于异步 TCP 客户端消息传递的 MSDN 文档中提取的，因此您可能需要再次参考那里的文档。

（在您本地的 VS 帮助 URL 中：[MSDN 异步客户端套接字示例](http://ms-help://MS.VSCC.v80/MS.MSDN.v80/MS.VisualStudio.v80.en/dv_fxnetwork/html/d4ac53a0-b50b-4232-9726-d47d25fcc38a.htm)）

您没有提到为什么在您的回调方法中启动新的异步接收操作失败 - 您看到什么错误？

如果您的消息被成功接收并在您的异步回调中处理，您可以从那里再次调用您的 Receive（您已将其注释掉）。请记住，如果您重用您的状态对象（在您的情况下是远程的），您需要清除缓冲区和保留在其中的任何其他对象。

在您的 Receive 方法中，您应该初始化您的状态对象并再次为新的异步接收操作做好准备。

另外：我以前使用过的接收回调。其中一些特定于我正在处理的应用程序（例如将消息排入派生的基类中），它相当快速和肮脏，但它可能会有所帮助。

```
 private void ReceiveCallback(IAsyncResult ar)
    {
        int bytesRead = 0;

        try
        {
            // receive finished
            if (ar.IsCompleted)
            {
                TcpIpState stateObject = (TcpIpState)ar.AsyncState;
                bytesRead = stateObject.TcpIpSocket.EndReceive(ar, out seSocketError);
                if (bytesRead > 0)
                {
                    foreach (ArraySegment<byte> asBuffer in stateObject.Buffer)
                    {

                            stateObject.SBuilder.Append(
                                Encoding.ASCII.GetChars(
                                asBuffer.Array,
                                0,
                                asBuffer.Count));

                    }
                    // Let the owner object know of the received message
                    base.EnqueueMessage(new TcpIpMessage(stateObject.SBuilder.ToString()));

                    // Start a new receive operation
                    stateObject.SBuilder = new StringBuilder();
                    stateObject.Buffer.Clear();
                    stateObject.Buffer.Add(new ArraySegment<byte>(new byte[_bufferSize]));
                    stateObject.TcpIpSocket.BeginReceive(
                        stateObject.Buffer,
                        SocketFlags.None,
                        new AsyncCallback(ReceiveCallback),
                        stateObject);
                }
                else
                {
                    OnDisconnected(this, new Exception("Bytes returned are 0"));
                    Disconnect();
                }
            }
        }
        catch (Exception e)
        {
            // Something has gone wrong on a low level portion
            OnDisconnected(this, e);
            Disconnect();
        }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T15:50:56.617

`BeginReceive`在 .NET 中进行异步套接字读取的标准方法是在接收回调结束时重复调用。您似乎有必要的电话`Receive`注释掉。只需取消注释该呼叫，我希望一切都可以正常工作。我没有对您的代码进行最详细的检查，所以我可能遗漏了一些东西，但这绝对是首先要尝试的事情。也许如果您详细说明您在实施该方法时遇到的确切问题，我们可以为您提供更多帮助。

作为一个（轻微的）方面，我强烈建议您[`TcpClient`](http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.aspx)在 .NET 中进行 TCP 通信时使用该类，正如您所清楚的那样。这简化了很多底层套接字的东西，并且通常使 TCP 通信对程序员更加友好！异步读取“循环”当然也差不多。此外，在 MSDN 和许多其他网站（包括 SO）上有大量文档和教程/代码片段，说明如何将`TcpClient`类正确用于各种目的（当您想要执行多线程或重用`TcpClient`对象时，它会变得有点棘手）。

# ruby-on-rails - Rails 未正确加载 environment.rb

> ID：706125
> 
> 赞同：1
> 
> 时间：2009-04-01T15:44:15.540
> 
> 标签：ruby-on-rails, ruby, environment

我最近将我的应用程序从 Rails 2.1.2 版升级到 2.2.2 版。它在开发和我的登台系统上进行了测试。当我转向生产时，它无法通过 environment.rb 文件一直加载。（为什么，哦，为什么，它总是在生产中！？！）

下面是我的 environment.rb 文件

```
# Be sure to restart your web server when you modify this file.

# Uncomment below to force Rails into production mode when 
# you don't control web/app server and can't set it the proper way
# ENV['RAILS_ENV'] ||= 'production'

# Specifies gem version of Rails to use when vendor/rails is not present
#RAILS_GEM_VERSION = '2.1.0'  unless defined? RAILS_GEM_VERSION
RAILS_GEM_VERSION = '2.2.2'  unless defined? RAILS_GEM_VERSION
puts "loading rails..."
# Bootstrap the Rails environment, frameworks, and default configuration
require File.join(File.dirname(__FILE__), 'boot')
puts "require boot file"
require 'socket'
puts "require socket"

Rails::Initializer.run do |config|
puts "inside config section"
  # Settings in config/environments/* take precedence over those specified here

  # Skip frameworks you're not going to use (only works if using vendor/rails)
  # config.frameworks -= [ :action_web_service, :action_mailer ]

  # Only load the plugins named here, by default all plugins in vendor/plugins are loaded
  # config.plugins = %W( exception_notification ssl_requirement )

  # Add additional load paths for your own custom dirs
  # config.load_paths += %W( #{RAILS_ROOT}/extras )

  # Force all environments to use the same logger level 
  # (by default production uses :info, the others :debug)
  # config.log_level = :debug

  # Use the database for sessions instead of the file system
  # (create the session table with 'rake db:sessions:create')
  config.action_controller.session_store = :active_record_store
puts "setting session store type"
  # Use SQL instead of Active Record's schema dumper when creating the test database.
  # This is necessary if your schema can't be completely dumped by the schema dumper, 
  # like if you have constraints or database-specific column types
  # config.active_record.schema_format = :sql

  # Activate observers that should always be running
  # config.active_record.observers = :cacher, :garbage_collector

  # Make Active Record use UTC-base instead of local time
  # config.active_record.default_timezone = :utc
  #config.gem "will_paginate", :source => "http://gems.rubyforge.org"

  # Action Mailer configuration - from page 567-568 of the Agile Development book
  #  config.action_mailer.delivery_method = :smtp
  #  
  config.action_mailer.smtp_settings = {
    :address    => "smtp.redacted.com",
    :port       => "25",
    :domain     => "redacted.com"
  }

puts "setting smtp settings"
  # See Rails::Configuration for more options

end

puts "outside config section ... before inflectors"
# Add new inflection rules using the following format 
# (all these examples are active by default):
ActiveSupport::Inflector.inflections do |inflect|
#   inflect.plural /^(ox)$/i, '\1en'
#   inflect.singular /^(ox)en/i, '\1'
#   inflect.irregular 'person', 'people'
#   inflect.uncountable %w( fish sheep )
   inflect.uncountable %w( sid fcc )
end

puts "after inflectors"
# Add new mime types for use in respond_to blocks:
# Mime::Type.register "text/richtext", :rtf
# Mime::Type.register "application/x-mobile", :mobile

# Include your application configuration below
require 'will_paginate'
puts "require will paginate"

# insert at top of ActiveRecord::Base.rb
    # Indicates whether field names should be lowercased for legacy databse fields.
    # If true, the field Product_Name will be +product_name+. If false, it will remain +Product_Name+.
    # This is false, by default.
    #cattr_accessor :downcase_legacy_field_names, :instance_writer => false
    #@@downcase_legacy_field_names = false

# insert into column_methods_hash of ActiveRecord::Base.rb
#          attr_final = downcase_legacy_field_names ? attr.to_s.downcase : attr

puts "here comes the monkey patch"
module ActiveRecord
  class Base
    # Indicates whether field names should be lowercased for legacy databse fields.
    # If true, the field Product_Name will be +product_name+. If false, it will remain +Product_Name+.
    # This is false, by default.
    cattr_accessor :downcase_legacy_field_names, :instance_writer => false
    @@downcase_legacy_field_names = false

  end
end

puts "monkey patch part 2"
# set all accessor methods to lowercase (underscore)
# add set_columns_to_lower to each model that needs it 
class << ActiveRecord::Base

    # Returns a hash of all the methods added to query each of the columns in the table with the name of the method as the key
    # and true as the value. This makes it possible to do O(1) lookups in respond_to? to check if a given method for attribute
    # is available.
    def column_methods_hash #:nodoc:
      @dynamic_methods_hash ||= column_names.inject(Hash.new(false)) do |methods, attr|

        attr_final = downcase_legacy_field_names ? attr.to_s.downcase : attr

        attr_name = attr_final
        methods[attr_final.to_sym]       = attr_name
        methods["#{attr_final}=".to_sym] = attr_name
        methods["#{attr_final}?".to_sym] = attr_name
        methods["#{attr_final}_before_type_cast".to_sym] = attr_name
        methods
      end
    end

   # adapted from: http://wiki.rubyonrails.org/rails/pages/HowToUseLegacySchemas
    def downcase_legacy_field_methods
      column_names.each do |name|
       next if name == primary_key
       a = name.to_s.underscore

       define_method(a.to_sym) do
         read_attribute(name)
       end

       define_method("#{a}=".to_sym) do |value|
         write_attribute(name, value)
       end

       define_method("#{a}?".to_sym) do
         self.send("#{name}?".to_sym)
       end

      end
    end

end 

puts "monkey patch part 3"

ActiveRecord::Base.downcase_legacy_field_names = true

puts "monkey patch part 4"
module ActiveSupport
  module Inflector
    def textize(str)
      str.to_s.gsub(/'/, '').downcase
        #gsub(/([A-Z]+)([A-Z][a-z])/,'\1_\2').
        #gsub(/([a-z\d])([A-Z])/,'\1_\2').
        #tr("-", "_").
        #downcase
    end

  end
end

puts "monkey patch part 5"
module ActiveSupport #:nodoc:
  module CoreExtensions #:nodoc:
    module String #:nodoc:
      module Inflections
        def textize
          Inflector.textize(self)
        end
      end
    end
  end
end

###################################################################
### Code moved to the specific environment files.
### This way the schema gets reloaded on a deploy
###################################################################
## Establishes connections for the root classes of the various databases that 
## must be connected to for SUI.

puts "load the database if we are in test mode"
if RAILS_ENV == "test" then
puts "if I see this and I'm not loading test, we have a problem"
  Ird.load_database
end

puts "setting up the execption notifier"
ExceptionNotifier.exception_recipients = %w(me@redacted.com)
if RAILS_ENV == "Production"
  ExceptionNotifier.sender_address = %("SUI Service" <service@redacted.com>)
  ExceptionNotifier.email_prefix = "[SUI ERROR] "
else
  ExceptionNotifier.sender_address = %("SUI #{RAILS_ENV.to_s.humanize} Service" <service@redacted.com>)
  ExceptionNotifier.email_prefix = "[#{RAILS_ENV.to_s.humanize}: SUI ERROR] "
end

puts "local_ip function"
def local_ip
  orig, Socket.do_not_reverse_lookup = Socket.do_not_reverse_lookup, true
  UDPSocket.open do |s|
    s.connect '64.233.187.99', 1
    s.addr.last
  end
ensure
  Socket.do_not_reverse_lookup = orig
end
puts "I am located at:#{local_ip}:"
puts "environment.rb is loaded" 
```

如果我将 rails gem 设置为用于 2.1.2 版本，则所有内容都会加载并且所有`puts`语句都按预期打印。当我将 gem 版本更改为 2.2.2 时，我看到的最后一条语句是“ `setting smtp settings`”。

当我将该`Rails::Initializer do |config|`部分移至底部时，它的失败方式比现在更糟。

系统上加载的 ruby​​ 版本是 Ruby 1.8.6 patchlevel 111。它在 RHEL5-64bit 上运行。

我难住了。想法？建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T19:48:43.487

你运行 rake rails:update 了吗？

此外，您可能希望将大部分代码移动到 config/initializers/[anything].rb 中，尽管我几乎不认为它本身会解决您的问题。

# sql - 我想从 Crystal Report .rpt 文件中提取 SQL 查询，有没有办法做到这一点？

> ID：706128
> 
> 赞同：16
> 
> 时间：2009-04-01T15:44:44.930
> 
> 标签：sql, crystal-reports, report

我想从 Crystal Report .rpt 文件中提取 SQL 查询，有没有办法做到这一点？

我没有任何 Crystal Reports 产品，只有 .rpt 文件。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-11-01T16:01:54.133

这是一个 .Net 代码示例，它从给定目录中的所有 Crystal Reports 中获取命令 Sql。它需要安装 Crystal 2008 .Net SDK（您可以从 SAP 下载试用版）：

```
foreach (string file in Directory.GetFiles("c:\\projects\\Reports", "*.rpt"))
{
    Console.WriteLine(String.Format("Processing {0}...", file));
    var doc = new CrystalDecisions.CrystalReports.Engine.ReportDocument();
    doc.Load(file);

    foreach (dynamic table in doc.ReportClientDocument.DatabaseController.Database.Tables)
    {
        if (table.ClassName == "CrystalReports.CommandTable")
        {
            string commandSql = table.CommandText;

            //TODO: do something with commandSql
        }
    }
} 
```

要在运行报表时获取 Crystal 将构建的 SQL，请参阅此链接：[SAP Note 1280515 - 如何使用 RAS sdk 从 Crystal 报表中提取 SQL 查询。](http://www.sdn.sap.com/irj/servlet/prt/portal/prtroot/com.sap.km.cm.docs/oss_notes_boj/sdn_oss_boj_bi/sap%28bD1lbiZjPTAwMQ==%29/bc/bsp/spn/scn_bosap/notes%7B6163636573733d36393736354636443646363436353344333933393338323636393736354637333631373036453646373436353733354636453735364436323635373233443330333033303331333233383330333533313335%7D.do)

我相信要做到这一点，您需要提供报表参数值，以便 Crystal 可以连接到数据库以构建 SQL。在示例中，由于使用了 Report Viewer 控件，Crystal 可以提示用户输入参数。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-11-24T01:40:56.693

在“Crystal Reports ActiveX Designer 设计和运行时库”(craxddrt.dll) 中，Report.SQLQueryString 属性将执行您想要的操作。

我似乎无法在 .Net SDK 中找到等效的属性，相信我，我一直在寻找。

** 编辑 **

似乎可以利用[进程内 RAS 服务器](http://www.sdn.sap.com/irj/boc/go/portal/prtroot/docs/library/uuid/10b840c0-623f-2b10-03b5-9d1913866b32?QuickLink=index&overridelayout=true&30953829322545)来获取此信息：

`CrystalDecisions.ReportAppServer.DataDefModel.CommandTableClass.CommandText`

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-03T21:58:07.757

解决这个问题的另一种方法是，如果您可以运行报告，您可以将 SQL Profiler 连接到您的数据库并在数据库端捕获传入的 SQL。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-05-31T19:16:52.037

JoshL 的回答适用于我的几份报告，但并非全部。以下方法使用`ReportClientDocument.RowsetController.GetSQLStatement`能够提取其他方法遗漏的一些查询。

```
foreach (string file in Directory.GetFiles("c:\\projects\\Reports", "*.rpt"))
{
    Console.WriteLine(String.Format("Processing {0}...", file));
    var doc = new CrystalDecisions.CrystalReports.Engine.ReportDocument();
    doc.Load(file);

    var controller = doc.ReportClientDocument.RowsetController;

    var groupPath = new CrystalDecisions.ReportAppServer.DataDefModel.GroupPath();
    string temp = String.Empty;
    string commandSql = controller.GetSQLStatement(groupPath, out temp);
    //TODO: do something with commandSql
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-02T07:50:35.887

我的经验是使用旧版本的 Crystal (8,9) - 我不知道最新版本的文件格式是什么样的。但是，值得在文本编辑器中打开文件以防万一，但对于我见过的文件格式，查询文本无法通过这种方式访问​​。

如果我没记错的话，Visual Studio 2003 的某些版本附带了用于处理 Crystal .rpt 文件的工具（但我想这对您没有多大用处，因为如果您已经拥有它，您就不会问了！）。

这不是一个很有想象力的建议，但也许您最快的方法是下载[当前 Crystal Reports 的 30 天试用版](http://www.sap.com/solutions/sapbusinessobjects/sme/freetrials/index.epx)，看看是否会为您打开文件。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-10-16T06:25:13.477

在 Visual Studio 中，选择 .rpt 文件并转到字段资源管理器，右键单击 DatabaseFields。单击 SQL 查询选项以查看查询。

# mysql - MySQL 触发器：如果表变得太大，是否可以删除行？

> ID：706137
> 
> 赞同：0
> 
> 时间：2009-04-01T15:46:28.920
> 
> 标签：mysql, sql, triggers, mysql-error-1442

在表 T 中插入新行时，我想检查表是否大于某个阈值，如果是，则删除最旧的记录（最终创建某种 FIFO）。

我以为我可以简单地制作一个触发器，但显然 MySQL 不允许修改我们实际插入的表：

```
Code: 1442  Msg: Can't update table 'amoreAgentTST01' in stored function/trigger because it is already used by statement which invoked this stored function/trigger. 
```

这是我尝试过的触发器：

```
Delimiter $$ 
CREATE TRIGGER test 
       AFTER INSERT ON amoreAgentTST01
       FOR EACH ROW
BEGIN
    DECLARE table_size INTEGER;
    DECLARE new_row_size INTEGER;
    DECLARE threshold INTEGER;
    DECLARE max_update_time TIMESTAMP;

SELECT SUM(OCTET_LENGTH(data)) INTO table_size FROM amoreAgentTST01;
SELECT OCTET_LENGTH(NEW.data) INTO new_row_size;
SELECT 500000 INTO threshold;
select max(updatetime) INTO max_update_time  from amoreAgentTST01;

IF (table_size+new_row_size) > threshold THEN
   DELETE FROM amoreAgentTST01 WHERE max_update_time = updatetime; -- and check if not current
END IF;
END$$
delimiter ; 
```

您对如何在数据库中执行此操作有任何想法吗？

或者这显然是我的程序中要做的事情？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T15:49:55.603

理想情况下，您应该在非高峰时间运行的单独进程中制定专门的归档策略。

您可以将其实现为计划存储过程 (yuck) 或应用程序服务器中的附加后台工作线程，或完全独立的应用程序服务。这将是放置其他常规家政工作的好地方。

这有几个好处。除了避免您看到的触发器问题之外，您还应该考虑触发器中发生的*任何*事情对性能的影响。如果您执行多次插入，该触发器将完成这项工作并有效地降低一半的性能，更不用说当其他进程尝试访问同一个表时会出现的锁争用。

执行内务处理工作的单独进程可最大限度地减少锁争用，并允许在事务中将工作作为高性能批量操作执行。

最后一件事 - 您可能应该考虑将记录归档到另一个表或数据库，而不是删除它们。

# java - Eclipse 继续运行我的旧 Web 应用程序

> ID：706140
> 
> 赞同：4
> 
> 时间：2009-04-01T15:47:04.223
> 
> 标签：java, eclipse

OMG - Eclipse（3.3 Europa）发生了什么 - 有没有人遇到过这个问题（请记住，我一直在搞乱卸载不同的 Tomat 容器并安装其他容器 - 但无论如何那是另一个故事）

当我在项目中更改一行代码或删除一个类时——当我开始调试时——它实际上会转到被注释掉的行并运行该行！！！！例如

//System.out.println("你应该看不懂这个！");

更新：这可以通过设置 Project -> Build Automatically 来解决（见下面的答案）。

* * *

剩下的问题：

Eclipse 没有使我的热部署文件夹与我的项目的最新更改保持同步：

我惊恐地发现，我的项目的一些旧残余“徘徊”在我认为 Eclipse 用于热部署或其他东西的文件夹中

**C:\myJavaCode.metadata.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\myWebApp**

基本上它实际上并没有复制在我的工作目录的类中所做的任何更改！?!??

...无论如何-为了使我的项目保持最新-我也必须修改此文件夹-完全不可接受-因为您不能以这种方式进行开发-这将花费您很多年！无论如何，如果有人能帮我解释一下我做了什么愚蠢的事情让我陷入了这个混乱，以及我如何才能摆脱这个混乱——我将非常感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T15:51:55.177

看一下：

> Windows>首选项>服务器>启动...

和：

> 项目>自动构建

也许您不小心禁用了自动部署功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-03T21:53:24.577

我遇到了类似的问题，只是没有增加网络应用程序的复杂性。我只是在运行 JUnit 测试，它正在运行旧代码。我进入源选项卡底部的配置构建路径，并查看默认输出文件夹，其中显示 myproject/bin。包资源管理器甚至没有显示 bin 文件夹，但是当查看文件系统时，那里有一个 bin 文件夹。我删除了 bin 文件夹，刷新了包资源管理器树，它工作正常。这种行为是在 Helios 中发生的，并且在没有自动选择构建的情况下发生......对我来说看起来像一个错误。

戴夫

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T16:22:12.500

一个超级愚蠢的问题：您所有的 webproject 和相关项目都正确编译了吗？

还要检查您的输出文件夹中的类（项目属性-> Java 构建路径-> 源选项卡），然后转到您的文件系统并检查权限和修改日期。

希望这会帮助你。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T19:40:18.717

可能最简单的解决方法是定义一个新服务器。

右键单击服务器窗口并选择新建，或者当您执行“在服务器上运行”时选择手动定义新服务器。您可以使用相同的 Tomcat 运行时定义多个服务器（它们都将具有由 -Dcatalina.base=... 定义的单独配置和部署目录），但除非您更改它们的端口，否则不要同时运行它们'正在听。

新服务器将使用类似的路径

```
<<yourEclipseWorkspace>>\.metadata\.plugins\org.eclipse.wst.server.core\tmp1 
```

对于 Tomcat conf 和 webapps 目录。

尝试在此服务器上运行。如果它有效，您可以将设置与旧设置进行比较，也许尝试从中删除应用程序并重新部署，并找出您可能做了什么导致问题。或者只是删除原始服务器配置。

至于你的第二个问题，我不确定。我会先尝试一个新的服务器配置，让它工作，停止服务器，对你的项目进行“清理”，删除 tmp1\work\Catalina 目录中的任何内容，然后重新启动服务器（你可以删除并添加你的项目再次到服务器也很干净）。

还要检查控制台消息以确保没有与此相关的错误。

# c# - 数据绑定时从当前行获取值

> ID：706142
> 
> 赞同：1
> 
> 时间：2009-04-01T15:47:25.127
> 
> 标签：c#, data-binding, report, devexpress

我在 WinForms 应用程序中使用 DevExpress XtraReports，但同样可以应用于其他报告工具。

我想在报告中逐行执行一些逻辑，因为它是“渲染”的。具体来说，如果条码的数据不可用，我想隐藏条码。

目前我正在做以下事情：

```
private void xrBarCode2_BeforePrint(object sender, System.Drawing.Printing.PrintEventArgs e)
{
    var barcode = (XRBarCode)sender;

    if (barcode.Text.Trim() == "")
    {
        barcode.Visible = false;
        lblWarning.Visible = true;
    }
    else
    {
        barcode.Visible = true;
        lblWarning.Visible = false;
    }
} 
```

但这只是闻起来很糟糕。我想访问此方法中的当前数据行并处理对象的“真实”属性，但不能。在其他报告生成器中，这种情况的典型模式是什么？我什至使用正确的事件吗？我试过`Detail_BeforePrint`了，但没有其他信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T13:52:36.613

将 Detail_BeforePrint 与 GetCurrentColumnValue() 结合使用，如下所示：

```
private void Detail_BeforePrint(object sender, System.Drawing.Printing.PrintEventArgs e) {
    if (string.IsNullOrEmpty(GetCurrentColumnValue("BarcodeColumnName"))) {
        barcode.Visible = false;
        lblWarning.Visible = true;
    } else {
        barcode.Visible = true;
        lblWarning.Visible = false;
    }
} 
```

# c# - 从更新面板写入文本框

> ID：706157
> 
> 赞同：1
> 
> 时间：2009-04-01T15:50:27.380
> 
> 标签：c#, asp.net, updatepanel

我正在尝试`Text`从更新面板中的部分回发访问文本框的属性。问题是我要访问**的这个文本框不在**这个更新面板中，当我试图写入它时（将内容放入`Text`属性中），这个新内容没有被显示。

我认为这是因为此文本框不是更新面板的一部分，但我不确定。而且，我不能将此文本框放在与触发部分回发的相同的更新面板中。

为什么不显示文字？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T02:47:03.530

在部分页面渲染期间，仅包含在更新面板中的控件将刷新其 html。页面的其余部分将保持不变。

对于您的特定情况，您需要将文本框包装在更新面板中，然后您需要做出决定。您可以将其 UpdateMode 标记为 Always 或 Conditional。如果您将其标记为始终，则该更新面板中包含的所有控件都将在每次部分渲染期间更新。如果您将其标记为有条件的，那么您将需要调用更新面板 Update() 方法来刷新它的 html。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T15:58:14.570

我认为您不能，除非您将文本框放在第二个更新面板中，并将更新模式设置为 Conditional。然后调用更新方法或将第一个更新面板设置为新面板的 asyncpostbacktrigger。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T11:26:37.203

除非您将有问题的文本框放在另一个更新面板中，否则您尝试执行的操作无法完成。如果您想在其他事件下使用文本框的内容，则将新更新面板的更新模式设置为始终。但是，如果您只想在触发其他更新面板的事件期间访问其 Text 属性，则将 updatemode 设置为有条件的，并将两个面板的触发器设置为相同...

如果您不确定触发器和 updatemode（基本上它是如何工作的），那么只需在两个更新面板中将 updatemode 设置为 always 并忘记触发器。然后它会工作得很好......

# asp.net - Session.Start 在触发时在每个请求上调用

> ID：706161
> 
> 赞同：1
> 
> 时间：2009-04-01T15:51:12.310
> 
> 标签：asp.net, session, sessionid

我有一个“在我的机器上工作”的情况。

我有一个网站，我将会话值从一个页面传递到另一个页面

```
Session["foo"] = 'blah'; 
```

并在第 2 页

```
var foo = Session["foo"]; 
```

foo 在 page2 上不存在。

在跟踪页面时，我发现它使用了与原始页面不同的 sessionid。在 Session_start 上放置断点时，看起来对于每个请求，页面都在开始一个新会话。

这不会发生在我的机器上......关于我可以做些什么来解决其他机器的想法？

*   SessionState 是 InProc

*   Page1.aspx 和 Page2.aspx 都是同一个网站的一部分，并且

*   隐私设置为接受目标机器上的所有 cookie。

**编辑：**在我的机器上运行和目标之间的区别在于我在本地使用[http://localhost/blah](http://localhost/blah)而在 XX_0001 是我的机器的另一个客户端使用 http [://XX_0001/blah](http://XX_0001/blah)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T13:56:17.583

好吧，我想我已经找到了解决方案：

看起来我的机器名称中的 _ 导致了这个问题。似乎主机名不允许下划线： http: [//www.faqs.org/rfcs/rfc822.html](http://www.faqs.org/rfcs/rfc822.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T15:55:17.480

我的第一个猜测是检查有问题的计算机上是否启用了 cookie。它是否适用于其他浏览器等？

如果您还要更改 url，请确保您仍在同一站点上，因为不同的站点将使用不同的 cookie。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T16:01:54.733

我认为字符串索引会话区分大小写。你有“foo”和“Foo”。那是错字吗？

否则，cookie 也是我的猜测。

# vb.net - 创建一个使用通用结构的函数？

> ID：706164
> 
> 赞同：0
> 
> 时间：2009-04-01T15:51:46.630
> 
> 标签：vb.net, generics

我正在尝试创建一个通用函数，我的 VB .NET 入门课程中的学生可以使用它来搜索结构的一维数组。

我的结构和数组如下所示：

```
 Private Structure Survey  
    Dim idInteger As Integer
    Dim membersInteger As Integer
    Dim incomeInteger As Integer
    Dim stateString As String
    Dim belowPovertyLevelBoolean As Boolean
End Structure

Private incomeSurvey(199) As Survey 
```

我的通用函数头看起来像：

```
Private Function FindSurveyItem(Of xType As Structure)
 (ByVal surveyIDInInt As Integer, ByVal surveyArrayIn() As xType) As Integer

??????

End Function 
```

我对该函数的调用如下所示：

```
 If FindSurveyItem(Of Survey)(CInt(idTextBox.Text), incomeSurvey) <> -1 Then 
```

我的问题是：有没有办法从函数内部引用数组中的各个结构字段？我试图使其通用，以便学生可以简单地将他们的数组传递给函数 - 它们的结构可能与我的命名不同，并且字段名称可能不同。

我怀疑还有其他方法可以处理这种情况，但我试图将其保留为结构的简单单维数组。我认为不可能做我想做的事，但我想知道其他人的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-03-27T20:02:21.430

> 有没有办法从函数内部引用数组中的各个结构字段？

泛型而不是数组，您需要一个集合类型。添加 LINQ 代码：

```
Dim  Surveys = From svys In xType  
    Where svys.idInteger = surveyIDInInt
    Select svys

For Each rSurveys In svys
    '''' Your Code
Next 
```

这是填写详细信息的粗略答案（我知道想象一下没有 SQL DB 的 LINQ ！！）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T16:02:37.413

If you have a genric type parameter T you are only able to access members of instances of T that are known to exist at compile time. As every type derives from Object you have only the members of Object availiable - ToString(), GetType(), GetHashCode(), and Equals().

If you want to access other members you have to constrain what T is allowed to be. In your situation a interface would be the way to go. See [MSDN](http://msdn.microsoft.com/en-us/library/d5x73970.aspx) for details.

You could also try to use reflection or check the actual type at runtime an perform a cast. The first is hard to impossible to do if you do not know much about the types you will get. And the later requires you to know possible types at compiletime and will not work in your situation, too.

Another way might be to pass a delegate to the search method that performs the actual comparison.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T15:59:40.900

What you're looking for are predicates, if using ,net 3.5

```
dim arr() as structure
Array.Find(arr, function(item)(item.MyMember = MemberToMatch)) 
```

More combersome in earlier versions, [see here](http://vbnotebookfor.net/2007/08/23/how-to-use-the-action-and-predicate-delegates/) for more info

The point being, that your function would look very like an implementation of Array.Find (if you didn't want to use the function provided), and the students would need to write their own predicate function.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T15:59:51.167

No, there isn't. You can't know the type at compile time, therefore you cannot access members of that type. You would need change from a structure to a class that must implement [IComparable](http://msdn.microsoft.com/en-us/library/system.icomparable.aspx) so that you can use [CompareTo](http://msdn.microsoft.com/en-us/library/system.icomparable.compareto.aspx) between the item you pass in and the array you are passing in.

Though it's not entirely clear what you are trying to do within your method so I'm guessing by the name of the method.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T16:11:08.360

You can use reflection to get those fields, but in this case that wouldn't have much meaning. How would you know that the passed type has the field you're looking for? There are other problems with that code as well.

Instead, to do this I would normally create an interface for something like this that had a public ID property, and constrain my input to the function to implement that interface, or as others mentioned use a built-in feature in the clr.

But that may be ahead of where your students are. If you just want an example of a generic function, my suggestion is to show them a type-safe implementation of the old vb `imediate if` function:

```
Public Function IIf(Of T)(ByVal Expression As Boolean, ByVal TruePart As T, ByVal FalsePart As T) AS T
    If Expression Then Return TruePart Else Return FalsePart
End Function 
```

Note that this is obsolete, too, as in VS2008 and beyond you can use the new `If` operator instead, which will work better with type inference and won't try to evaluate the expression that isn't returned.

# filesystems - 在前面截断文件

> ID：706167
> 
> 赞同：21
> 
> 时间：2009-04-01T15:52:10.920
> 
> 标签：filesystems

我最近正在处理的一个问题让我希望我可以去掉文件的前面。有点像“前面截断”，如果你愿意的话。在后端截断文件是一种常见的操作——我们甚至没有考虑太多。但是去掉文件的前面？起初听起来很荒谬，但这只是因为我们被训练认为这是不可能的。但 lop 操作在某些情况下可能很有用。

一个简单的例子（当然不是唯一的或最好的例子）是 FIFO 队列。您正在将新项目添加到文件的末尾并从文件前面拉出项目。该文件随着时间的推移而增长，前面有一个巨大的空白空间。对于当前的文件系统，有几种方法可以解决这个问题：

*   当每个项目被删除时，复制剩余的项目以替换它，并截断文件。虽然它有效，但这个解决方案在时间上非常昂贵。
*   监视前面空白空间的大小，当它达到特定大小或整个文件大小的百分比时，将所有内容向上移动并截断文件。这比以前的解决方案效率更高，但在文件中移动项目时仍然需要时间。
*   在文件中实现一个循环队列，在删除项目时将新项目添加到文件前面的孔中。这可能非常有效，特别是如果您不介意队列中出现故障的可能性。如果您确实关心订单，则有可能不得不四处移动物品。但总的来说，循环队列很容易实现并且可以很好地管理磁盘空间。

但是如果有一个 lop 操作，从队列中删除一个项目就像更新文件开头标记一样容易。事实上，就像截断文件一样简单。那么，为什么没有这样的操作呢？

我对文件系统实现有点了解，并且没有看到任何特殊原因这会很困难。在我看来，它所需要的只是每个分配条目的另一个词（dword，也许是？）来说明文件在块内的开始位置。对于 1 TB 的驱动器低于 100 美元，为这种功能付出的代价似乎很小。

如果您可以像在末尾截断一样有效地删除文件的前面，那么还有哪些任务会变得更容易？

你能想到这个功能不能被添加到现代文件系统的任何技术原因吗？其他非技术原因？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2013-08-08T09:23:36.920

在支持稀疏文件的文件系统上，“打孔”并删除任意文件位置的数据非常容易。操作系统只需要将相应的块标记为“未分配”。从文件开头删除数据只是此操作的一个特例。主要需要一个系统调用来实现这样的操作：ftruncate2(int fd, off_t offset, size_t count)。

在 Linux 系统上，这实际上是通过[fallocate](http://manpages.ubuntu.com/manpages/raring/en/man2/fallocate.2.html)系统调用实现的，方法是指定`FALLOC_FL_PUNCH_HOLE`标志以将范围归零，并指定`FALLOC_FL_COLLAPSE_RANGE`标志以完全删除该范围内的数据。请注意，对于可以指定的范围有限制，并且并非所有文件系统都支持这些操作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-09-17T07:15:20.677

在前面截断文件似乎不太难在系统级别实现。

但也有问题。

*   第一个是在编程级别。在随机访问中打开文件时，当前的范例是使用文件开头的偏移量来指出文件中的不同位置。如果我们在文件开头截断（或从文件中间执行插入或删除），这不再是一个稳定的属性。（虽然从末尾追加或截断不是问题）。

换句话说，截断开头会改变唯一的参考点，这很糟糕。

*   正如您所指出的，在系统级别上存在使用，但很少见。我相信文件的大多数用途都是一次写入多次读取，所以即使截断也不是一个关键特性，我们可能没有它可以做到（有些事情会变得更加困难，但没有什么是不可能的）。

如果我们想要更复杂的访问（确实有需要），我们以随机模式打开文件并添加一些内部数据结构。这些信息也可以在多个文件之间共享。这将我们引向我看到的最后一个问题，可能是最重要的问题。

*   从某种意义上说，当我们使用具有某种内部结构的随机访问文件时……我们仍在使用文件，但我们不再使用文件范例。典型的这种情况是我们想要执行插入或删除记录而不关心它们的物理位置的数据库。数据库可以使用文件作为低级实现，但出于优化目的，一些数据库编辑器选择完全绕过文件系统（考虑 Oracle 分区）。

我看不出为什么我们不能做目前在操作系统中使用数据库作为数据存储层的文件所做的所有事情的技术原因。我什至听说 NTFS 在其内部与数据库有许多共同点。操作系统可以（并且可能在不久的将来）使用另一种范式而不是文件范式。

总而言之，我认为这根本不是技术问题，只是范式的改变，删除开头绝对不是当前“文件范式”的一部分，但不是一个足够大和有用的改变来迫使改变任何东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:39:52.950

NTFS 可以通过它的稀疏文件支持来做这样的事情，但它通常没那么有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T15:59:10.620

我认为这里有一个先有鸡还是先有蛋的问题：因为文件系统没有有效地支持这种行为，人们没有编写程序来使用它，而且因为人们没有编写程序来使用它，所以有文件系统支持它的动力很小。

您总是可以编写自己的文件系统来执行此操作，或者修改现有的文件系统（尽管“在野外”使用的文件系统可能非常复杂，但从头开始可能会更容易）。如果人们发现它足够有用，它可能会流行;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T16:02:50.300

实际上有记录库文件系统——IBM 有一个，我相信 DEC VMS 也有这个功能。我似乎记得两者都允许（允许？我猜它们仍然存在）在文件中的随机位置删除和插入。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-16T01:48:20.007

还有一个名为`head`-- 的 unix 命令，因此您可以通过以下方式执行此操作：

```
head -n1000 file > file_truncated 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-04-12T03:44:46.307

可以分两步实现这个目标

```
long fileLength; //file total length
long reserveLength; //reserve length until the file ending
int fd; //file open for read & write

sendfile(fd, fd, fileLength-reserveLength, reserveLength);
ftruncate(fd, reserveLength); 
```

# .net - 将 DLL 存储在中央非 GAC 位置

> ID：706169
> 
> 赞同：1
> 
> 时间：2009-04-01T15:52:58.607
> 
> 标签：.net, binding, gac, policyfiles

我们正面临一个独特而痛苦的局面。传统上，我们一直使用 GAC 和策略文件来控制 .NET 应用程序的 DLL 版本。但是，我们有一个非常独特的情况，并且遇到了重大问题，因为我们的一些应用程序不尊重策略文件。尤其是引用具有策略文件的 .NET 1.1 dll 的 .NET 2.0 应用程序。

我们在 Windows 应用程序以及大量 Web 应用程序中混合了动态运行（通过反射加载）的项目。我们希望转向更多的“集中式 DLL 存储”，而不是担心 GAC 版本控制。但是我们似乎无法找到一种方法来告诉我们的应用程序“在此处查找任何 DLL”。

查看一些程序集信息节点（[http://msdn.microsoft.com/en-us/library/twy1dw1e.aspx](http://msdn.microsoft.com/en-us/library/twy1dw1e.aspx)），我们可以找到一部分，但我们必须定义每个应该查找的 DLL，这是不可能的，因为我们有大约 200 个不同的应用程序需要定期更新 web.config，因为我们更新了共享 DLL 的版本。

有没有人知道我们如何移动 DLL 引用？CopyLocal 不是一个选项，因为有时我们需要应用程序来使用共享 DLL 的新版本。至少现在，GAC 也不是一个真正的选择。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T19:55:05.920

您可以在 app.config中使用[CodeBase 提示，](http://msdn.microsoft.com/en-us/library/efs781xb(vs.71).aspx)

```
<?xml version="1.0"?>
<configuration>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="MyDll" />
        <codeBase version="1.0.1000.20000" href="file:///c:\SharedDlls" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration> 
```

如果您想在 Machine.Config 文件中使用 DLL，您的 DLL 需要一个严格的名称（如果您来自 GAC 世界并且它是 Microsoft 认证所必需的，这对您来说应该不是问题）。

这是[MSDN 博客上的链接，](http://blogs.msdn.com/junfeng/archive/2004/11/16/258081.aspx)它提供了一些更深入的建议。

# asp.net - 如何从日期时间获取日期部分？

> ID：706172
> 
> 赞同：2
> 
> 时间：2009-04-01T15:53:30.823
> 
> 标签：asp.net, sql, vb.net

> 重复：[如何在 .net 中截断日期？](https://stackoverflow.com/questions/252493/how-to-truncate-a-date-in-net/252494#252494)

我有包含“4/1/2009 8:00:00AM”的日期时间字段。我想在没有时间的情况下获得“2009 年 4 月 1 日”。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-01T15:57:20.080

使用日期时间字段的[日期](http://msdn.microsoft.com/en-us/library/system.datetime.date.aspx)属性（如果您需要在客户端上执行此操作）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T15:57:52.917

如果你想在你的应用程序中传递它，DateTime.Date 只会给你日期时间的日期部分

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T15:58:27.207

如果您在 .NET 内部，因为您似乎基于标签

```
dim myDate as DateTime = DateTime.Parse('4/1/2009 8:00:00AM')
dim myDesiredValue as String = myDate.ToShortDateString() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:01:09.913

这是 C#（是的 - 我知道你想要 VB）但鉴于以下没有使用 DataTime 以外的任何东西，那么它应该给你想要的......

```
 string foo = "4/1/2009 8:00:00AM";
        DateTime bar = DateTime.Parse(foo);
        string output = bar.ToString("M/d/yyyy"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T15:56:32.047

取决于您的数据库服务器，但在 sql server 中，我通常在我的 sql 查询中使用它：

```
CAST(FLOOR(CAST([MyDateTimeColumn] AS float)) AS datetime) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T15:57:39.127

转换（varchar，mydate，101）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T18:37:34.547

```
CONVERT(DATE, dateFieldName) 
```

# vim - 从目录及其子目录关闭 Vim 中的文件

> ID：706173
> 
> 赞同：1
> 
> 时间：2009-04-01T15:53:41.897
> 
> 标签：vim

vim 中有没有办法从某个目录及其子目录中关闭所有文件（缓冲区，让我们不要进入）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T16:02:54.950

将以下内容放入您的 .vimrc 或 vim 插件文件夹内的一些自定义文件中。

```
function! s:close_buffers(name_regexp)
    for buffer_number in range(1, bufnr('$'))
        if !buflisted(buffer_number)
            continue
        endif

        let name = fnamemodify(bufname( buffer_number ), ':p')
        if name =~ a:name_regexp
            exec 'bdelete '.buffer_number
        endif
    endfor
endfunction

command! -nargs=1 CloseBuffers call s:close_buffers(<f-args>) 
```

使用类似的命令

```
:CloseBuffers include
:CloseBuffers in.*e 
```

关闭名称与传递的正则表达式匹配的缓冲区。

这意味着要关闭您可以使用的某个文件夹中的所有文件

```
:CloseBuffers workspace/cpp
:CloseBuffers /home/my/project 
```

关闭当前目录和所有子目录中的所有文件

```
:exec "CloseBuffers ".getcwd() 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-01T20:54:21.893

您可以相当简洁地这样做：

```
:silent! bufdo if expand('%')=~"some_regex"|bd|endif 
```

或者，如果您想要绝对路径名而不是相对路径名：

```
:silent! bufdo if expand('%:p')=~"some_regex"|bd|endif 
```

或者，如果您希望它以交互方式提示您输入正则表达式，您可以将其设置为映射：

```
:let regex=input("> ")|silent! bufdo if expand('%:p')=~regex|bd|endif 
```

等等等等

# ruby-on-rails - 如何将我的主页流量指向我的 Rails 子目录

> ID：706175
> 
> 赞同：0
> 
> 时间：2009-04-01T15:54:50.570
> 
> 标签：ruby-on-rails, ruby, mod-rewrite

我有一个 Rails 控制器处理对 www.mydomain/foo 的请求，现在我希望到 www.mydomain/（域根目录或主页）的所有流量都转到 www.mydomain/foo。我问了一个关于如何使用[ReWrite](https://stackoverflow.com/questions/704284/simple-mod-rewrite-question)执行此操作的类似问题，但还没有得到答案，但我很乐意在控制器中解决它，所以我打开了这个问题以允许任何一种解决方案。请帮忙！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T16:04:26.833

我认为您正在寻找的是[map.root](http://api.rubyonrails.org/classes/ActionController/Routing.html)

您为选项传递的内容将取决于您的控制器/操作设置。

编辑 - 不要忘记从 /public 目录中删除 index.html 文件。

# svn - 有任何使用 xp-dev.com 的经验吗？

> ID：706177
> 
> 赞同：7
> 
> 时间：2009-04-01T15:55:11.270
> 
> 标签：svn

我知道有很多线程推荐[xp-dev.com](http://xp-dev.com)，但我想知道是否有人有任何理由不推荐该服务？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T16:22:43.933

我已经使用 xp-dev 几个月了，到目前为止没有任何抱怨。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-06T12:23:05.237

几周前我刚和他们签约，现在服务中断了。这对我来说是不可接受的。我可以理解，但对偶尔的光点不满意，但到目前为止，整个上午都在下降，这不仅仅是一个光点。没有服务，也没有工作完成。我很想回到数据中心架起我自己的服务器。尝试省钱是不值得的。

而且不仅仅是服务，整个网站都关闭了，这意味着我什至无法让他们的电话号码给他们打电话（我是付费客户，不只是使用免费服务）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-19T13:20:50.487

没有理由 :) 这简直太神奇了。

我会说：试试吧！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-23T07:24:13.020

我刚刚开始使用 xp-dev 1 个月左右，之前已经下降了一次，大约 2-3 天，现在下降了！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-23T19:43:09.390

它以前已经关闭，现在已经关闭（就在我需要提交的时候）。你去别的地方可能会更好。我和我的团队在一家名为 BeanstalkApp 的公司和 Google Code 上获得了更好的运气。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-19T22:24:18.277

使用它快一年了。完美运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-22T18:12:22.583

我已经使用他们的免费服务大约 2 年了，从来没有遇到过任何问题。我刚开始为订阅付费，因为我想要定期备份。

唯一的缺点是免费版本的网络界面非常丑陋，但它*是*免费的。

我会推荐！

# php - 如果安全模式已打开并且您无法安装扩展，如何使用 PHP 解压缩文件？

> ID：706179
> 
> 赞同：1
> 
> 时间：2009-04-01T15:55:32.487
> 
> 标签：php, zip

是否有任何可以解压缩常规 zip 文件的 PHP 脚本？我们的要求是我们必须在 safe_mode 上运行，并且不允许安装任何扩展来启用此功能。因此，任何功能都必须是常规的 php 脚本。

有什么想法吗？

* * *

编辑：不幸的是，发布的解决方案都不适合我们。除非切换主机，否则我们可能不会更改 safe_mode 要求，目前这不是一个选项。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T08:27:49.010

pclzip.lib.php 是一个相当流行且使用良好的 php 类，它能够使用纯 php 提取 zip 文件

[http://www.phpconcept.net/pclzip/index.en.php](http://www.phpconcept.net/pclzip/index.en.php)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T15:58:54.537

这里通常的答案是[this](http://www.php.net/manual/en/function.zip-open.php)或[this](http://www.php.net/manual/en/function.ziparchive-open.php)。但是，根据[PHP 文档](http://www.php.net/manual/en/zip.requirements.php)：

> ## PHP 4
> 
> 捆绑的 PHP 4 版本需要[» ZZIPlib](http://zziplib.sourceforge.net/)，由 Guido Draheim，版本 0.10.6 或更高版本
> 
> ## PHP 5.2.0 或更高版本
> 
> 这个扩展使用了Jean-loup Gailly 和 Mark Adler的[» zlib的功能。](http://www.zlib.net/)

所以，两者都需要外部依赖。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T15:59:16.080

您不能要求他们使用 .htaccess 指令禁用单个文件夹的安全模式，例如：

```
php_value safe_mode "0" 
```

并将解压缩脚本放在那里？

如果是这样，那么类似：

```
$output = shell_exec('unzip /path/to/file'); 
```

会做的

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T15:59:18.063

看看[http://www.phpclasses.org/browse/package/2495.html](http://www.phpclasses.org/browse/package/2495.html)

它使用 gzip 扩展，但它几乎安装在每台服务器上（我希望，检查 phpinfo() ）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T08:33:07.330

如果您在 linux/unix 上运行，则可以运行

```
exec("unzip file.zip"); 
```

> 注意：启用安全模式后，您只能执行`safe_mode_exec_dir.`

# c# - C#：在注册表中存储 .Net 对象

> ID：706181
> 
> 赞同：0
> 
> 时间：2009-04-01T15:55:52.783
> 
> 标签：c#, registry

**是否可以在注册表中存储 .Net 对象？**

我想`List<>`在注册表中存储一个泛型，然后检索它并将其解析回列表。

这可能吗，还是我需要手动序列化它然后反序列化它？

**[更新]**

按照发布的答案，我将序列化对象并将其保存在*当前用户的 AppData 文件夹*中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T15:58:46.690

如果列表中包含的类型是可序列化的，**则**它是*可能的。*如果是这种情况，您可以将其序列化并将其存储在字符串值中。

 **但这可能是一个*非常糟糕的主意*。注册表变得足够大。相反，将这种东西放在*文件系统*的 All Users Application Data 文件夹中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-01T15:58:09.483

为什么是注册表？

存储此类序列化对象的适当位置通常在用户的 Application Data 文件夹或[独立存储](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)中。当然，序列化的方法取决于你。XML，二进制等，它本质上是磁盘上的文件。

您可以考虑诸如“本地数据库”或 SQL Server Express 之类的东西，具体取决于您的数据和并发需求。

一些应用程序确实在注册表中存储了最近使用 (MRU) 列表，但这只是通过迭代给定键的所有值。我不推荐这种方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T15:58:21.637

是的，我认为你必须自己序列化和反序列化它。但是您可以将其存储为二进制块或文本/xml。注册表数据可能存在大小限制...

最大的问题是“这是一件好事吗？”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T15:57:57.347

你必须自己序列化它。请注意，您可以存储的数据量可能会受到限制，具体取决于 Windows 版本。

[http://msdn.microsoft.com/en-us/library/ms724872(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms724872(VS.85).aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T15:58:28.767

我首先要说的是：这听起来是个非常糟糕的主意。

如果你坚持这样做，你将不得不先序列化它。注册表不支持插入 .NET 对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T15:58:00.873

您必须对其进行序列化。注册表只存储原始值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T15:58:05.740

您需要手动对其进行序列化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-01T15:59:31.277

不太确定为什么要将 .NET 对象存储在注册表中，因为 BCL 中已经存在允许您使用 XML 配置文件执行此操作的功能......但话说回来，当然可以存储 .NET 对象。 NET 对象在注册表中。如果对象的大小相对较小，您可能只想这样做，但无论如何这应该不是问题。我想这样做的明显方法是使用[XML 序列化](http://msdn.microsoft.com/en-us/library/system.net.sockets.tcpclient.aspx)（没有格式化/空白）并将对象存储为序列化字符串值。

# bash - 如何删除以双连字符开头的文件？

> ID：706196
> 
> 赞同：73
> 
> 时间：2009-04-01T15:57:39.987
> 
> 标签：bash, unix, filenames

我的 Unix 机器上有一些文件以

```
 -- 
```

例如`--testings.html`

如果我尝试删除它，我会收到以下错误：

```
cb0$ rm --testings.html
rm: illegal option -- -
usage: rm [-f | -i] [-dPRrvW] file ...
       unlink file 
```

我试过

```
rm "--testings.html" || rm '--testings.html' 
```

但没有任何效果。

**如何在终端上删除此类文件？**

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-04-01T15:59:20.217

```
rm -- --testings.html 
```

该`--`选项告诉 rm 将所有进一步的参数视为文件名，而不是选项，即使它们以`-`.

这不是 rm 命令所特有的。getopt 函数实现了它，许多（全部？）UNIX 风格的命令以相同的方式处理它：`--`终止选项处理，以及它之后的任何内容都是常规参数。

[http://www.gnu.org/software/hello/manual/libc/Using-Getopt.html#Using-Getopt](http://www.gnu.org/software/hello/manual/libc/Using-Getopt.html#Using-Getopt)

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-04-01T19:10:56.293

```
rm -- --somefile 
```

虽然这可行，但它是一种依赖于`rm`使用 getopts 来解析其选项的解决方案。有些应用程序会进行自己的解析，并且也会对此感到厌烦（因为它们可能不一定实现“`--`意味着选项结束”逻辑）。

正因为如此，你应该穿过你的头骨的解决方案是这个：

```
rm ./--somefile 
```

它总是有效的，因为这样你的论点永远不会以`-`.

此外，如果您正在尝试制作非常体面的 shell 脚本；从技术上讲，您应该将`./`所有文件名参数扩展放在前面，以防止您的脚本由于时髦的文件名输入而中断（或防止它们被滥用/利用来做他们不应该做的事情：例如，`rm`将删除文件但跳过目录；while`rm -rf *`将删除所有内容。将“ `-rf`”的文件名传递给脚本或某人`touch ~victim/-rf`可能以这种方式被用来改变其行为，后果非常糟糕）。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-01T16:01:45.967

要么`rm -- --testings.html`要么`rm ./--testings.html`。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-01T15:59:14.943

```
rm -- --testings.html 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-02T10:43:43.867

另一种方法是使用 find ... -name "--*" -delete

```
touch -- --file 
find -x . -mindepth 1 -maxdepth 1 -name "--*" -delete 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-22T18:56:30.357

对于删除文件名中包含不可能字符的文件的更通用方法，一种选择是使用文件的 inode。

可以通过`ls -i`.

例如

```
$ ls -lai | grep -i test
452998712 -rw-r--r--  1 dim   dim      6 2009-05-22 21:50 --testings.html 
```

并在 find 的帮助下擦除它：

```
$ find ./ -inum 452998712 -exec rm \{\} \; 
```

在处理具有文件名特性的大量文件时，此过程可能很有用，因为它可以很容易地编写脚本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-01T16:03:02.127

```
rm ./--testings.html 
```

或者

```
rm -- --testings.html 
```

# web-applications - Should there be a limit to concurrent number of sessions for a web application?

> ID：706204
> 
> 赞同：2
> 
> 时间：2009-04-01T15:58:10.357
> 
> 标签：web-applications, concurrency, session

Should there be a limit to concurrent number of sessions for a web application?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T15:59:23.477

No. Better to have your app be slow than to lock users out.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T16:03:00.597

Do you mean on a per user basis or for the whole application?

Per user, the question depends on what the purpose of the web application is. If it's something like an online banking site, you could reasonable decide to only allow a single session per user for security. But if your app can already handle more than one session per user, it doesn't seem to make much sense to set an arbitrary limit.

On a per application basis, it doesn't really make much sense to set an arbitrary limit either unless you know it breaks down after a certain number of sessions for some reason.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T16:15:47.477

不。

通过一个简单的机器人启动最大会话，您的应用程序可以在整个会话超时（例如 20 分钟）内为所有人关闭。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T16:20:07.497

要看。您是否在系统资源非常稀缺的环境中运行，以致冒着被会话使用耗尽它们的风险？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T16:23:13.107

*我假设您正在谈论限制多个会话的同一帐户，否则请忽略这一点:)*

取决于，如果它是高安全性应用程序**是**的，这可以避免会话劫持问题（可以通过多种方式进行，例如 XSS），并且可以帮助用户发现他们的帐户已被盗用并被其他人使用。

在不需要高安全性的普通 Web 应用程序中，**No** . 这很**烦人**。

# java - Java：为什么关闭选项卡或浏览器时不会破坏http会话？

> ID：706224
> 
> 赞同：17
> 
> 时间：2009-04-01T15:59:41.227
> 
> 标签：java, session

我有以下 HttpSessionlistener 的实现

```
public class SessionListener implements HttpSessionAttributeListener, HttpSessionListener {

public void attributeAdded(HttpSessionBindingEvent event) {
   ...

}

public void attributeRemoved(HttpSessionBindingEvent event) {

    ...
}

public void attributeReplaced(HttpSessionBindingEvent event) {

}

//HttpSesion creation & destruction
public void sessionCreated(HttpSessionEvent event) {
    HttpSession session = event.getSession();
    //log created time

}

public void sessionDestroyed(HttpSessionEvent event) {
    HttpSession session = event.getSession();
    long destroyedTime = System.currentTimeMillis();
    //log destroyed time

} 
```

}

基本上我记录会话创建和销毁时间。但是如果会话很长（默认为 30 分钟），并且用户同时关闭了浏览器，则

```
sessionDestroyed 
```

不叫？

这是为什么 ？是否有一种解决方法可以准确记录会话被破坏的时间（当用户关闭浏览器时）？这不应该是浏览器的问题，在会话关闭时终止会话吗？

有没有我必须实现的接口才能工作？

谢谢 ！

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-01T16:04:32.747

服务器如何知道浏览器何时关闭或选项卡何时关闭？此时浏览器不会向服务器发送任何内容。

这是 HTTP 的一个基本部分——它是一个请求/响应协议，而不是一个“永久开放的对话”，您可以在其中判断一方是否离开对话。把它想象成一系列电报而不是一个电话——你不知道什么时候你会收到最后一封电报。

您需要设计自己的方式 - 以避免*需要*知道浏览器何时关闭。有一些丑陋的黑客可以解决它 - 例如，让 AJAX 使用心跳消息轮询服务器 - 但改变设计是一个更好的解决方案。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-13T17:54:49.450

*注意：*正如[jwenting](https://stackoverflow.com/questions/706224/javawhy-http-session-is-not-destroyed-when-tab-or-browser-is-closed/1121034#comment-8129744)在下面评论的那样，这根本不是 100% 安全的。如果 onunload 事件没有被浏览器选项卡或窗口的关闭事件触发，那么这将失败。

我有同样的问题，并使用侵入性 JavaScript 事件解决它：

```
window.onunload 
```

让我简单解释一下，假设您有一个 JavaScript 函数，该函数使用 jQuery 将当前会话 ID 发布到该 Servlet 以使其无效，如下所示：

```
function safeexit(){
   $.post("/SessionKillServlet", { SID = <%=session.getId()%> }, function(data){});
} 
```

要调用该函数，您只需要像这样绑定它：

```
window.onunload =  safeexit;  //without the () 
```

现在，当 TAB 或 BROWSER WINDOW 关闭（或重定向）时，将调用 safeexit 方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T16:04:49.437

会话对象存在于服务器中并由服务器控制。只有服务器可以创建或销毁会话。因此，如果客户端关闭，会话将一直存在，直到过期。客户端只能向服务器建议它可以销毁某些会话。这个请求必须以某种方式明确。因此，当您关闭浏览器窗口时，不会向服务器发出隐式请求，通知它必须销毁给定的会话。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:04:14.493

由于没有大量工作，浏览器不会通知服务器窗口已关闭，因此 Java 无法知道何时销毁会话。因此超时已经到位，并且是服务器首先知道该会话可以被破坏的时间。

[您可以尝试在 javascript 事件 document.onunload https://developer.mozilla.org/en/DOM/window.onunload](https://developer.mozilla.org/en/DOM/window.onunload)上播放 ajax 调用， 但您需要确保当您使用时用户不在您的站点内做这个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T16:10:47.583

如果您需要在关闭浏览器窗口/选项卡时销毁会话，您可以将 JavaScript 处理程序附加到 onunload 事件，该事件对调用终止会话的资源进行某种 AJAX 调用。

请注意，onunload 事件并不总是触发，因此它并不完全值得信赖。一种可靠的方法可能是使用“心跳”系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T22:44:48.260

正如 Eric 提到的，浏览器上的卸载事件可以调用一个 javascript 函数，该函数又可以通过一个 servlet 访问一个 url，从而将您注销。您无需等待 servlet 的实际响应。

Web 浏览器通过 http 协议与服务器交互，并且是无状态的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-05-20T07:16:33.100

当用户关闭浏览器时，有一些技巧可以知道以下代码用于销毁会话

> 客户端：

```
<script src="jquery path"></script>
<script>
  window.onunload = function(){ $.get("${request.contextPath}/logout"); }
</script> 
```

> 服务器端：为“/logout”创建请求映射

```
public void doGet(HttpServletRequest request, HttpServletResponse) {
  request.getSession().invalidate();
  System.out.println('destroy from logout on unload browser');
} 
```

> 以下代码是可选的
> 
> 当想知道会话何时销毁时使用会话侦听器

```
//    in class

import javax.servlet.*;
import javax.servlet.http.*;
public class SesListener implements HttpSessionListener {
  public void sessionCreated(HttpSessionEvent se) {
   System.out.println("Session created...");
  }

  public void sessionDestroyed(HttpSessionEvent se) {
    System.out.println("Session destroyed...");
  }
}

//-----------------------------------------

// in web.xml
<listener>
   <listener-class>SesListener</listener-class>
</listener> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-03-06T04:27:58.363

您可以验证您的会话用户是否不为空，例如：

```
if (session.getAttribute("user") != null )
   sessionsetAttribute("user","null"); 
```

# mysql - MySQL 和检查约束

> ID：706231
> 
> 赞同：6
> 
> 时间：2009-04-01T16:00:28.403
> 
> 标签：mysql, constraints

我继承了一个使用 MySQL 并由 PHP 前端使用的应用程序。编写这个系统的人花了一些相当复杂的长度来确保用户输入的代码是有效的——这意味着这些代码也存在于另一个表中。

当我第一次看到这个时，我想知道为什么他没有使用 CHECK 约束并让 dbms 解决这个问题 - 我看到大量不同的程序实现相同的检查，而不仅仅是 dbms 中的一个地方。然后我发现 MySQL 不支持 Check 约束（严格来说不是这样——它支持语法但只是忽略它）。

有没有办法可以在 MySQL 中实现检查约束？

任何提示、建议等都会很棒。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T16:03:43.403

您可以使用触发器实现与它们类似的东西，但 MySQL 本身（版本 8.0.16 之前）不支持 CHECK 约束。不过别担心，它会让你定义它们，然后默默地忽略它们！

# sql - 如果另一个表中不存在对应的值，则 SQL 选择值

> ID：706236
> 
> 赞同：2
> 
> 时间：2009-04-01T16:02:15.137
> 
> 标签：sql, sql-server, tsql

我有一个数据库，它试图通过拥有一个主表和一个历史表来记录时间点信息，该表记录另一个表中的字段何时/确实发生了变化。例如

**表：员工**

```
Id  | Name      | Department
-----------------------------
0   | Alice     | 1
1   | Bob       | 1 
```

**表：历史**

```
ChangeDate   | Field      | RowId  | NewValue    
---------------------------------------------
05/05/2009   | Department | 0      | 2 
```

记录员工 0 (Alice) 将于 2009 年 5 月 5 日搬到部门 2。

我想写一个查询来确定员工在特定日期的部门。所以它需要：

*   查找给定日期*之前*该字段和员工的第一条历史记录
*   如果不存在，则默认为主员工表中当前的值。

我怎样才能做到这一点？我的直觉是选择一个结果集的第一行，它所有合适的历史记录按日期倒序排列，主表中的值最后（所以如果没有合适的历史记录，它只是第一个结果），但我不'没有实现这一点所需的 SQL-fu。

* * *

*注意：我意识到这可能不是实施该系统的最佳方式——我无法在短期内改变这一点——但如果你能提出更好的实施方式，我会很高兴听到。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T16:05:24.413

```
SELECT  COALESCE (
        (
        SELECT  newValue
        FROM    history
        WHERE   field = 'Department'
                AND rowID = ID
                AND changeDate =
                (
                SELECT MAX(changedate)
                FROM   history
                WHERE  field = 'Department'
                       AND rowID = ID
                       AND changeDate <= '01/01/2009'
                )
        ), department)
FROM    employee
WHERE   id = @id 
```

在`Oracle`和`MS SQL`中，你也可以使用这个：

```
SELECT  COALESCE(newValue, department)
FROM    (
        SELECT  e.*, h.*,
                ROW_NUMBER() OVER (PARTITION BY e.id ORDER BY changeDate) AS rn
        FROM    employee e
        LEFT OUTER JOIN
                history h
        ON      field = 'Department'
                AND rowID = ID
                AND changeDate <= '01/01/2009'
        WHERE   e.id = @id
        )
WHERE rn = 1 
```

但请注意，这`ROWID`是 中的保留字`Oracle`，因此您需要在移植时重命名此列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T16:23:03.060

这应该有效：

```
select iif(history.newvalue is null, employee.department, history.newvalue)
as Department
from employee left outer join history on history.RowId = employee.Id
and history.changedate < '2008-05-20'  // (i.e. given date)
and history.changedate = (select max(changedate) from history h1
where h1.RowId = history.RowId and h1.changedate <= history.changedate) 
```

# java - Entitymanager causing memory leak?

> ID：706238
> 
> 赞同：11
> 
> 时间：2009-04-01T16:02:25.403
> 
> 标签：java, jpa, myeclipse

I have a slow memory leak in my Java application. I was wondering if this could be caused by not always closing the Entitymanager when used. However using myeclipse to generate DB code, I'm getting methods like this:

```
public Meit update(Meit entity) {
    logger.info("updating Meit instance");
    try {
        Meit result = getEntityManager().merge(entity);
        logger.info("update successful");
        return result;
    } catch (RuntimeException re) {
        logger.error("update failed");
        throw re;
    }
} 
```

Which never close the EntityManager. Considering this is generated code, I'm wondering who's right, me or the IDE.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-02-12T18:37:05.157

正如@Ruggs 所说，如果您自己管理 EntityManager 生命周期（而不是由 J2EE 完成 CMP Container Managed Persistence），那么您需要自己关闭 EntityManager 或至少调用`EntityManager.clear()`分离实体。

EntityManager 是轻量级对象，因此不需要一个，您可以为每个事务创建一个，并在事务提交后关闭它。

通过 EntityManager 加载/持久的所有实体都保留在内存中，直到您显式地从它分离实体（通过`EntityManager.detach()`或`EntityManager.clear()`或`EntityManager.close()`）。所以最好有短命的EntityManagers。如果您在获得 OOME 后通过同一个 EntityManager 保留 1000000 个实体而不分离它们（是否将每个实体保留在它自己的 EntityTransaction 中并不重要）。

这一切都在这篇文章[http://javanotepad.blogspot.com/2007/06/how-to-close-jpa-entitymanger-in-web.html](http://javanotepad.blogspot.com/2007/06/how-to-close-jpa-entitymanger-in-web.html)中进行了解释。

作为一个例子（取自之前的帖子），如果你想避免“内存泄漏”，你应该做这样的事情（如果你不使用 CMP）：

```
EntityManager em = emf.createEntityManager();

try {
  EntityTransaction t = em.getTransaction();
  try {
    t.begin();  
    // business logic to update the customer
    em.merge(cust);
    t.commit();
  } finally {
   if (t.isActive()) t.rollback();
  }
} finally {
  em.close();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T16:08:28.820

Entity managers should generally have the same lifecycle as the application and not be created or destroyed on a per-request basis.

Your "memory leak" may be nothing more than the caching JPA is doing. You don't say which JPA provider you use but I know from experience that EclipseLink by default does extensive caching (which is part of the alleged benefits of JPA and ORM in general).

How do you know you have a memory leak?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T16:35:00.193

听起来您正在使用应用程序管理的 EntityManager。您需要自己调用 close EntityManager，这是规范的一部分。关闭 web 应用程序时，您还需要关闭 EntityManagerFactory。

我建议使用 OpenEJB 或 Springframework 之类的东西来为您管理 EntityManager/EntityMangerFactory。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:29:27.960

检查是否真的[泄漏](http://www.dzone.com/links/how_to_fix_memory_leaks_in_java.html)

如果是这样，请获取[Eclipse 内存分析器](http://www.eclipse.org/mat/)并对其进行分析。

[这里](http://kohlerm.blogspot.com/search/label/memory)的博客文章也可能有用。

# ios - How can I change the image displayed in a UIImageView programmatically?

> ID：706240
> 
> 赞同：135
> 
> 时间：2009-04-01T16:02:38.897
> 
> 标签：ios, uiimageview

I have an `IBOutlet` to a `UIImageView`, but when I look at the `UIImageView` doc, I can't see any hints about programmatically changing it. Do I have to fetch an `UIImage` object from that `UIImageView`?

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-04-01T16:21:54.233

如果您已经有一个到 UIImageView 的 IBOutlet，那么您所要做的就是抓取一个图像并在接收器 (UIImageView) 上调用 setImage。下面是两个抓取图像的示例。一个来自网络，一个你添加到 Xcode 中的 Resources 文件夹中。

```
UIImage *image = [[UIImage alloc] initWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:@"http://farm4.static.flickr.com/3092/2915896504_a88b69c9de.jpg"]]]; 
```

或者

```
UIImage *image = [UIImage imageNamed: @"cell.png"]; 
```

一旦你有了一个图像，你就可以设置 UIImageView：

```
[imageView setImage:image]; 
```

上面的行假设 imageView 是您的 IBOutlet。

而已！如果您想变得花哨，可以将图像添加到 UIView，然后添加过渡。

PS 不包括内存管理。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2010-08-22T05:55:23.003

请注意，在将视图添加到场景之前，NIB 文件不会连接所有 IBOutlets。如果您要手动连接东西（如果东西在单独的 NIB 中，您可能会这样做），请记住这一点。

因此，如果我的测试视图控制器有一个由笔尖连接的“imageView”，这可能不起作用：

```
 testCardViewController.imageView.image = [UIImage imageNamed:@"EmptyCard.png"];
  [self.view addSubview:testCardViewController.view]; 
```

但这将：

```
 [self.view addSubview:testCardViewController.view];
  testCardViewController.imageView.image = [UIImage imageNamed:@"EmptyCard.png"]; 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2010-06-07T11:48:45.560

这对我有用

```
[ImageViewName setImage:[UIImage imageNamed: @"ImageName.png"]]; 
```

确保 ImageView 在 .h 文件中正确声明并与 IB 元素链接。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2013-04-24T13:37:37.450

```
imageView.image = [UIImage imageNamed:@"myImage.png"]; 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-07-15T14:16:29.237

对于那些可能正在谷歌搜索以尝试解决他们的问题的人，请记住在头文件中正确声明属性并在实现文件中合成 UIImageView ......如果没有以编程方式设置图像会很困难getter 和 setter 方法。

```
#import <UIKit/UIKit.h>

@interface YOURCONTROLLERNAME : UIViewController {
    IBOutlet UIImageView *imageToDisplay;
}

@property (nonatomic, retain) IBOutlet UIImageView *imageToDisplay;

@end 
```

然后在你的 .m 中：

```
@implementation YOURCONTROLLERNAME

@synthesize imageToDisplay;
//etc, rest of code goes here 
```

从那里您应该可以使用以下内容来设置图像。

```
[YOURCONTROLLER.imageToDisplay setImage:[UIImage imageNamed:value]]; 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2015-03-13T15:49:00.770

**斯威夫特**的例子：

```
import UIKit

class ViewController: UIViewController {

    @IBOutlet var myUIImageView: UIImageView!

    override func viewDidLoad() {
        super.viewDidLoad()
    }

    @IBAction func myAction(sender: UIButton) {
        let newImg: UIImage? = UIImage(named: "profile-picture-name")
        self.myUIImageView.image = newImg
    }

    @IBAction func myAction2(sender: UIButton) {
        self.myUIImageView.image = nil
        self.myUIImageView.image = UIImage(data: NSData(contentsOfURL: NSURL(string: "http://url/image.png")!)!)
    }

} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-07-06T04:44:31.617

按照 Jordan 的建议（实际上应该可以），尝试将 UIImageView 设置为可见：

```
 [imageView setHidden: NO]; 
```

还有 - 不要忘记将它附加到主 UIView：

```
[mainView addSubview: imageView]; 
```

并带到前面：

```
[mainView bringSubviewToFront: imageView]; 
```

希望结合所有这些步骤将帮助您解开谜团。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2011-11-29T21:04:22.193

My problem was that I tried to change the image in an other thread. I did like this:

```
- (void)changeImage {
    backgroundImage.image = [UIImage imageNamed:@"img.png"];
} 
```

Call with:

```
[self performSelectorOnMainThread : @selector(changeImage) withObject:nil waitUntilDone:NO]; 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-06-07T06:26:10.060

如果您想以`UIImageView`编程方式将图像设置为，请不要忘记将`UIImageView` 作为**子**视图添加到主视图。

并且不要忘记设置**ImageView Frame**。

这是代码

```
UIImageView *myImage = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 320, 460)];

myImage.image = [UIImage imageNamed:@"myImage.png"];

[self.view addSubview:myImage]; 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2016-04-01T14:39:31.557

`sizeToFit()`如果您使用 UIImageView 的大小来设置 UIScrollView contentSize 和/或计算缩放比例，请不要忘记在更改图像后调用

```
let image = UIImage(named: "testImage")
imageView.image = image
imageView.sizeToFit()
scrollView.contentSize = imageView.bounds.size 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-12-31T23:21:21.523

```
myUIImageview.image = UIImage (named:"myImage.png") 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2019-08-05T08:02:18.077

使用 Swift 5 (XCode 10.3)

```
yourImageView.image = UIImage(named: "nameOfTheImage") 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-05-28T07:23:21.797

```
UIColor * background = [[UIColor alloc] initWithPatternImage:
    [UIImage imageNamed:@"anImage.png"]];

self.view.backgroundColor = background;
[background release]; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-08-27T15:42:54.330

这个问题已经有很多答案了。不幸的是，没有一个对我有用。因此，为了完整起见，我添加了对我有帮助的内容：

我有多个具有相同名称的图像 - 所以我在子文件夹中订购了它们。我有我想要显示的图像文件的完整路径。使用完整路径`imageNamed:`（如上述所有解决方案中使用的）不起作用并且是错误的方法。

相反，我现在`imageWithContentsOfFile:`这样使用：

```
self.myUIImage.image = [UIImage imageWithContentsOfFile:_currentWord.imageFileName]; 
```

不知道有没有人读到这么远？

如果是这样，并且这个对您有所帮助：请投票。;-)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-06-13T13:22:06.157

要在 imageView 上设置图像，请使用下面的代码行，

```
self.imgObj.image=[UIImage imageNamed:@"yourImage.png"]; 
```

# .net - 在哪里检查对象是否为空？

> ID：706263
> 
> 赞同：19
> 
> 时间：2009-04-01T16:06:08.840
> 
> 标签：.net, null

您在哪里检查您传递给方法的对象是否为空？

在调用方法之前是否需要测试对象？还是在使用参数的方法中？

```
public class Program
{
    public static void Main(string[] args)
    {
        // Check if person is null here? or within PrintAge?

        PrintAge(new Person { Age = 1 });
    }

    private static void PrintAge(Person person)
    {
        // check if person is null here?

        Console.WriteLine("Age = {0}", person.Age);
    }
}

public class Person
{
    public int Age { get; set; }
} 
```

在两个类中进行“空”检查似乎是多余的代码。

**[编辑]**：在调用者或被调用者中检查 null 有什么缺点/优点？

**[EDIT2]**：我刚刚遇到[防御性编程](http://en.wikipedia.org/wiki/Defensive_programming)，它似乎提倡在被调用者中检查 null。我想知道这是否是一种被广泛接受的做法。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-01T16:18:38.173

如果你设计一个库，就会有一些方法暴露给外部世界。您应该检查此方法中的传入数据。在您不公开的方法中不需要检查，因为只有您的代码调用它们，并且它的逻辑应该处理您在调用的公开方法中接受的所有情况。

```
 --------------------------
                   |                          |
                   |         Library          |
                   |                          |
 -------        ---------        ----------   |
|       |      |         |      |          |  |
| Outer |      | Library |      | Library  |  |
|       | ===> | Entry   | ===> | Backend/ |  |
| World |      | Method  |      | Helpers  |  |
|       |      |         |      |          |  |
 -------        ---------        ----------   |
                   |                          |
                   |                          |
                    -------------------------- 
```

如果您在 entry 方法中接受了提供的数据，您应该执行请求的操作并返回预期的结果，即处理所有剩余的情况。

**更新**

澄清图书馆内的情况。可能有空检查，但只是因为逻辑，而不是因为参数验证。库中空检查的位置有两种可能性。第一个，如果被调用的方法知道如何处理空值。

```
private CallingMethod()
{
   CalledMethod(someData);
}

private CalledMethod(Object parameter)
{
   if (parameter == null)
   {
      // Do something
   }
   else
   {
      // Do something else
   }
} 
```

第二种情况，如果您调用无法处理空值的方法。

```
private CallingMethod()
{
   if (someData == null)
   {
      // Do the work myself or call another method
   }
   else
   {
      CalledMethod(someData);
   }
}

private CalledMethod(Object parameter)
{
   // Do something
} 
```

整个想法是拒绝您无法立即处理的案例并正确处理**所有**剩余的案例。如果输入无效，则抛出异常。这迫使库调用者仅提供有效值，并且不允许调用者继续执行无意义的返回值（除了调用者浅化异常并继续）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-01T16:15:21.613

您无需签入`Main`- 您正在使用`new`从不返回 null 的运算符（除了`Nullable<T>`）。

签入是完全合理的`PrintAge`，尤其是在公开的情况下。（对于私有 API，进行参数检查不太重要，但它仍然非常有用。）

```
if (person == null)
{
    throw new ArgumentNullException("person");
} 
```

这些天在 C# 3.0 中，我通常[为此使用扩展方法](https://stackoverflow.com/questions/665454/c-should-i-bother-checking-for-null-in-this-situation/665472#665472)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-01T16:09:39.067

我会说检查它 n PrintAge 似乎更有意义，因为这正在履行例程的合同。当然，您可以将空检查替换为 Debug.Assert() 代码以在测试时进行检查，而不是在发布时进行检查。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-01T16:16:23.560

您可以设计一种仅使用有效对象的方法。

这意味着您希望收到有效的对象（在您的情况下不是 null ）。
这意味着您不知道如何反应以及如何处理无效对象：

*   从函数中静默返回不是解决方案；

*   抛出异常意味着您将责任转移到上层方法，在那里他们可以在传递给您之前检查值。

因此，如果您的方法不确切知道如何处理无效对象，并且该方法在无效情况下不会遵循其他逻辑，您应该放置

```
Debug.Assert( Person ); 
```

在`PrintAge`开始时，这将**迫使您**通过调用堆栈进行检查。

*层次结构中的较低功能是它应该进行的检查较少*。以下是在执行工作的函数中进行检查的**缺点。**

*   做实际工作的功能必须尽可能清晰，没有大量的**if** s
*   函数将被调用多次
*   这样的函数可以调用这样的函数，他们可以再次调用这样的函数。他们每个人都将执行相同的验证

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-01T16:08:37.370

你的意思是检查这两种方法？我肯定会检查 PrintAge，如果它在 Main 中也有意义。我认为一般来说没有明确的答案。这取决于 ：-）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-01T16:11:49.763

我通常让我的空检查由我的期望控制；如果我希望某些内容为空或不确定，我会添加一张支票。否则我不会。Nullpointer 异常是最容易跟踪的问题之一，因此过多的检查会使代码膨胀。在具体示例中，我什么都不检查，因为它很直观，它不为空。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-01T16:11:10.110

如果实例为空，你想做什么？

我认为这取决于您提供和定义合同的 API（.net 框架类的方式）。话虽如此，如果方法定义了在传递给它的 null 引用的情况下的预期结果，则不需要检查 null（在 main 中）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-01T16:15:19.007

只有一次构造函数可以返回 null [ `new()`on a `Nullable<T>`] - 所以调用代码不需要检查。

被调用者可能*应该*检查；`ArgumentNullException`如果它为空，则抛出一个。在 .NET 4.0 中，代码合同将更好地满足这一点。但还没有；-p

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-01T16:36:21.857

据我了解，您的问题比您的示例说明的更为笼统。我的偏好如下：

*   所有可公开访问的方法都必须检查 NULL 输入并酌情抛出异常。因此，如果您正在构建一个供他人使用的框架，请进行防御性编码。
*   如果您知道这是在其他地方完成的，或者参数永远不会为 NULL，私有方法可能会省略 NULL 检查，但总的来说，我更喜欢显式的 ArgumentNullException 而不是 NullRefereceException。

布拉德艾布拉姆斯在这里有更多的输入：http: [//blogs.msdn.com/brada/archive/2004/07/11/180315.aspx](http://blogs.msdn.com/brada/archive/2004/07/11/180315.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-01T16:11:51.120

冗余代码不是最优雅的，但它是安全的。

这取决于您的预期用户是谁，如果是您，那么您可以控制一切的使用方式，并且只有在您不确定变量的状态是什么时才需要进行检查。

如果您将此设置为其他人使用，那么空检查可能是一个好主意。即使您只是抛出 NullPointerException ，也最好快速失败。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-01T16:18:18.657

一定`PrintAge`要检查，这是检查的正确地方。它可能是多余的，但不会伤害任何人，除非您每秒执行 1000 次。（根据检查抛出异常或修复它，如果可以的话）

其他检查取决于您的实际流程，在此示例中您没有流程，因此我无法评论该位。但通常认为您的参数受到污染。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-01T16:22:56.057

PrintAge 应该是 Person 上的一个方法，而不是一个以 Person 作为参数的静态方法。无需检查。

检查空值会使代码变得不必要地复杂。构建您的代码以限制（或消除）null 是可能值的情况，并且您将编写更少的检查。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-08-12T10:05:51.753

我更喜欢方法内部的空检查，原因有两个。

1.  我认为函数应该是“完整的”，即处理空值/“边缘情况”，而不是依赖调用者。这有两个原因，

    *   稍后调用该方法的人可能会忘记添加空检查
    *   在单元测试中使用边缘情况测试方法更容易。
2.  在方法中进行空检查减少了代码中空检查的总数，这通常意味着代码更具可读性

# svn - svn 全转储（移动服务器）

> ID：706268
> 
> 赞同：2
> 
> 时间：2009-04-01T16:07:50.600
> 
> 标签：svn, svn-export

如何获取 SVN 存储库的完整副本并将其导入另一台服务器？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T16:10:12.467

你想执行一个`svnadmin dump`. 您可以通过`svnadmin help dump`或[阅读文档获得有关此命令的](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.maint.html)帮助。然后，您可以使用`svnadmin load`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T22:48:27.817

如果您无权访问物理服务器（并且该服务器运行 Subversion 1.4 或更高版本），您可以使用 svnsync 创建完整存储库的本地副本。

之后，您可以使用 svnadmin 从本地副本创建转储文件。

另请参阅[如何从我的 subversion 托管帐户创建转储文件？](https://stackoverflow.com/questions/354994/how-do-i-create-a-dump-file-from-my-subversion-hosting-account/356353#356353)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T16:10:27.270

这取决于存储库类型。如果您使用的是 fsfs，您可以在停止服务器后复制目录（以确保您不会复制半完成的事务）。我以前做过，而且效果很好。

如果你正在使用`bdb`你应该做一个`svnadmin dump`。（如果新旧计算机在体系结构和操作系统方面相似，您很可能只需使用目录副本即可，但转储存储库会更安全。）

# windows - 如何从 Windows 命令行以国际不可知的方式获取日期时间？

> ID：706276
> 
> 赞同：0
> 
> 时间：2009-04-01T16:09:41.843
> 
> 标签：windows, command-line

从 Windows 命令行，我需要回显系统的本地或 utc 日期和时间，但日期时间的部分按我想要的顺序排列，而不管电脑的当前国际化设置如何。

我已经看到了这个相关的问题：
[如何在 Windows 命令行上以适合在文件名中使用的格式获取当前日期时间？](https://stackoverflow.com/questions/203090/how-to-get-current-datetime-on-windows-command-line-in-a-suitable-format-for-usi)

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-02T11:11:59.087

如果您不介意使用一点 VBScript，您可以使用如下内容：

```
' http://classicasp.aspfaq.com/date-time-routines-manipulation/can-i-make-vbscript-format-dates-for-me.html
' Use MSSTDFMT to mimic VB's Format() function. Provides more flexibility in
' formatting dates than the VBScript FormatDateTime() function.
On Error Resume Next
    dim fmt
    dim rs

    set fmt = WScript.CreateObject("MSSTDFMT.StdDataFormat") 
    set rs = WScript.CreateObject("ADODB.Recordset") 

    rs.Fields.Append "fldExpression", 12 ' adVariant 
    rs.Open 
    rs.AddNew 

    fmt.Format = WScript.Arguments(0)

    rs("fldExpression").DataFormat = fmt 
    rs("fldExpression").Value = Now() 

    WScript.Echo rs("fldExpression").Value 

    rs.close
    set fmt = nothing
    set rs = nothing

    WScript.Quit(0) 
```

我把它放在一个名为 formatDate.vbs 的文件中。然后你可以从命令行调用，传入你想要的格式：

```
C:>cscript //nologo formatDate.vbs "mm-dd-yyyy" 
04-02-2009 
C:>cscript //nologo formatDate.vbs "dd-mm-yyyy"
02-04-2009 
C:>cscript //nologo formatDate.vbs "dd-MMM-yy" 
02-Apr-09
C:>cscript //nologo formatDate.vbs "mm/dd/yyyy hh:mm"
04/02/2009 10:10
C:>cscript //nologo formatDate.vbs "dddddd ttttt"
Friday, April 03, 2009 6:48:57 AM
C:>cscript //nologo formatDate.vbs "General Date"
4/3/2009 6:49:53 AM 
```

有关您可以使用的格式的完整列表，请参阅MSDN 中的[预定义日期/时间格式](http://msdn.microsoft.com/en-us/library/362btx8f(VS.80).aspx)和[用户定义的日期/时间格式](http://msdn.microsoft.com/en-us/library/73ctwf33(VS.80).aspx)。

**注意：** MSSTDFMT 对象取决于由 Visual Studio 6.0 安装的 MSSTDFMT.dll 的可用性。

MSSTDFMT.dll 似乎在 Windows XP 和 Windows 2003 服务器上可用；我检查了几台从未安装过 MS Visual Studio 并且存在 DLL 的机器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-02T13:20:17.110

将以下内容放入名为“GetLocalTime.vbs”之类的文件中。

```
Function Pad( strText, intLen )
    Pad = Right( String( intLen, "0" ) & strText, intLen )
End Function

Dim d
d = Now
wscript.echo Pad(Year(d),4) & "-" & Pad(Month(d),2) & "-" & Pad(Day(d),2) & "T" & Pad(Hour(d),2) & ":" & Pad(Minute(d),2) & ":" & Pad(Second(d),2) 
```

运行：

```
cscript GetLocalTime.vbs //Nologo 
```

这输出：

```
2009-04-02 14:22 
```

并且可以适应以任何顺序写出日期时间部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T14:06:25.307

我使用[`GetDate.cmd`](http://www.ss64.com/nt/syntax-getdate.html)脚本的一个小变体来*仅获取日期*：

```
@SETLOCAL
@ECHO OFF
GOTO :begin
:fixdate
IF "%1:~0,1%" GTR "9" SHIFT
FOR /f "skip=1 tokens=2-4 delims=(-)" %%g IN ('echo.^|date') DO (SET %%g=%1& SET %%h=%2& SET %%i=%3)
GOTO :eof
:begin
FOR /f "tokens=1-4 delims=/-. " %%g IN ('date /t') DO (CALL :fixdate %%g %%h %%i %%j)
ECHO %aa%%yy%%mm%%dd%
ENDLOCAL 
```

它利用输出的格式`date`，处理`date /t`在年/月/日信息之前打印工作日名称的情况。但是，当格式字符串不是**yy**、**mm**和**dd**时，原始脚本的行为不正确。我添加了一个解决方法，使脚本适用于英语和葡萄牙语系统：在葡萄牙语中，年份格式为*aa*；因此该语句`%aa%%yy%`将打印年份 at`%aa%`和空白 at `%yy%`，但在英文系统上则相反。

但是，有一些[更安全的技术涉及从 Registry 解析日期格式](http://www.robvanderwoude.com/datetimentparse.php)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T19:01:20.497

```
echo off
    for /F "tokens=1,2*" %%a in ('date /T') do set date=%%a %%b
    echo %date%
    set strMonth=%date:~0,2%
    set strDay=%date:~3,2%
    set strYear=%date:~6,4%
    set strMonth
    set strDay
    set strYear 
```

顺便说一句：从这里拿了一些代码...... [http://www.computing.net/answers/dos/system-date-to-variable/3874.html](http://www.computing.net/answers/dos/system-date-to-variable/3874.html)

# sql - Dynamic columns when pivoting

> ID：706290
> 
> 赞同：4
> 
> 时间：2009-04-01T16:12:16.067
> 
> 标签：sql, pivot

I have a table of equipment, a table of customers and a sparse table of equipment and customers. I want to produce a query that returns a 1 if the equipment/Customer table record exists and a 0 if it doesn't for each customer. There are only a small number of customers in this problem, so what I want back should look like this:

```
EquipmentID   Cust1   Cust2   Cust3
-----------   -----   -----   -----
       1234       1       0       1
       1357       0       1       0
       2234       1       0       0 
```

I can use a `cross join` to get a master list of possible records, but that returns the information in rows. I want to see it in columns, but the `PIVOT` keyword requires that I name the columns first. What I need is for the column names (`Cust1`, `Cust2`...) to be dynamic.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T16:13:45.250

如果要这样做，则必须动态创建查询字符串，然后将其传递给[`sp_execute`](http://msdn.microsoft.com/en-us/library/ms188001.aspx)存储过程。AFAIK，如果不动态构造查询字符串，就没有办法做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:15:30.640

如果您有方便的报告工具，请使用当前查询并制作“martix”、“交叉表”或“数据透视表”报告。

# java - 确定当前调用堆栈（用于诊断目的）

> ID：706292
> 
> 赞同：54
> 
> 时间：2009-04-01T16:12:42.960
> 
> 标签：java, stack-trace

出于诊断目的，我有时需要存储导致给定状态转换（例如授予锁、提交事务等）的调用堆栈，以便以后出现问题时，我可以找出最初触发状态转换的人。

目前，我知道检索调用堆栈的唯一方法类似于以下代码片段，我认为它非常难看：

```
StackTraceElement[] cause;
try {
  throw new Exception();
} catch (Exception e) {
  cause = e.getStackTrace();
} 
```

有人知道实现此目的的更好方法吗？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-04-01T16:17:32.667

我认为你可以得到同样的东西：

```
StackTraceElement[] cause = Thread.currentThread().getStackTrace(); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-01T16:14:27.823

好吧，您可以通过不实际抛出异常来稍微改进它。

```
Exception ex = new Exception();
ex.fillInStackTrace();
StackTraceElement[] cause = ex.getStackTrace(); 
```

实际上，我刚刚检查过：构造函数已经调用`fillInStackTrace()`了。因此，您可以将其简化为：

```
StackTraceElement[] cause = new Exception().getStackTrace(); 
```

如果在当前线程上调用它，这实际上就是[`Thread.getStackTrace()`](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html#getStackTrace())这样做的，因此您可能更喜欢使用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-05-22T12:58:58.707

如果您希望它作为字符串并使用 Apache Commons：

```
org.apache.commons.lang.exception.ExceptionUtils.getFullStackTrace(new Throwable()) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-06-26T07:49:27.050

自 JDK 9 以来有一个新选项：StackWalker

它不像 Thread.currentThread().getStackTrace() 那样昂贵。

另请参阅[Thread.getStackTrace() 有多贵？](https://stackoverflow.com/questions/2347828/how-expensive-is-thread-getstacktrace)

# asp.net - Datalist 中标签的 ASP.NET 事件处理程序

> ID：706294
> 
> 赞同：0
> 
> 时间：2009-04-01T16:14:18.447
> 
> 标签：asp.net, event-handling, datalist

我正在处理一个 ASP.NET 页面，并且其中有一个带有不可见标签 ID 的 DataList。Datalist 由查询 A 填充。

我试图在我的 VB 代码中添加一个处理程序，它将在 ID 更改后运行查询 B，在项目模板中填充不同的标签。我想我需要去 DataList 中的某个地方，但是通过 Intellisense 和谷歌搜索没有成功。有谁知道我是怎么拿到那个标签的？对不起，如果这是一个愚蠢的问题，并感谢您的帮助。

编辑：我看到了如何在函数内部访问数据列表项，但是如何仅对事件处理程序中的 DataList 控件的一部分进行访问？我看到的所有选项都与涉及数据列表的完整事件有关，而不是单个标签更改。谢谢。

编辑2：

我想我会添加一些代码，以更好地解释我遇到的确切问题。

```
 <asp:DataList ID="DataList1" runat="server" DataSourceID="Omitted,Ilikemyjob">
                <ItemTemplate>
                      <asp:Label ID="FromLabel" runat="server" Font-Size="Small" Text='<%# Eval("IncdntDate") %>'></asp:Label><br />
                      <asp:Label ID="ToLabel" runat="server" Font-Size="Small" Text='<%# Eval("Roadway") %>'></asp:Label><br />
                      <asp:Label ID = "lblCrossroad" runat ="server" Font-Size = "Small" Text = '<%# Eval("Crossroad") %>'></asp:Label><br />
                      <asp:Label ID = "lblRdwyID" runat ="server" Font-Size="Small" Visible = "false" Text = '<%# Eval ("RdwyID") %>'></asp:Label>
                      <asp:Label ID = "DistanceLabel" runat ="server" Font-Size = "Small" Text = '<%# Eval("RptTime") %>'></asp:Label><br />
                      <asp:Label ID = "lblTTime" runat ="server" Font-Size = "small" visible ="false"></asp:Label>
                      <hr />
                 </ItemTemplate>
            </asp:DataList><br /> 
```

我正在做 DataList 的事情，并且我有一个不同的查询，如果 lblRdwyID 设置为某个值范围，我想将其值存储到 lblTTime，我认为它并不总是设置为一个值。

我正在尝试设置一个将在设置 lblRdwyID 时触发的事件，该事件将启动另一个查询并设置该模板化项目 lblTTime 的值并使其可见。有没有好的方法来做到这一点？我试图弄乱 DataList1 的事件，但无法解决问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T16:18:10.997

如果您的标签将其可见性设置为 false，它将不会在屏幕上呈现（与将可见性设置为隐藏的 div 块相反），所以我打赌这就是为什么您在发生了绑定。

您是否尝试过使用 DataKey 属性来存储 ID？它可以在行级别轻松访问，如果需要，您可以存储其他数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T16:16:51.843

假设您有该行，则使用：

row.FindControl("mylabelid")

# c# - MSMQ发送消息问题...(c#)

> ID：706305
> 
> 赞同：4
> 
> 时间：2009-04-01T16:17:24.587
> 
> 标签：c#, msmq

我的代码：

```
 string _path = "mymachine\\Private$\\example";
  // create a message queue object
  MessageQueue MQueue = new MessageQueue(_path);

  // create the message and set the base properties
  Message Msg = new Message("Messagem");
  Msg.ResponseQueue = MQueue;
  Msg.Priority = MessagePriority.Normal;
  Msg.UseJournalQueue = true;
  Msg.Label = "gps1";      

  // send the message
  MQueue.Send(Msg);

  // close the mesage queue
  MQueue.Close(); 
```

没有错误，但我的 MessageQueue 中没有任何内容......有什么帮助吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T16:28:52.687

我发现了问题...我的 MessageQueue 是使用事务 true 创建的...

# java - 在 JPA OneToOne 关系中更改项目后如何删除行？

> ID：706313
> 
> 赞同：2
> 
> 时间：2009-04-01T16:18:55.347
> 
> 标签：java, hibernate, jpa, persistence, one-to-one

如何使用 JPA/Hibernate 自动删除 OneToOne 项目？我希望在包含的类中简单地将 OneToOne 项设置为 null 会足够聪明以允许 Hibernate 删除它。

给定一个简单的对象，简化：

```
@Entity
public class Container {
    private Item item;

    @OneToOne(cascade=CascadeType.ALL)
    public Item getItem() { return item; }

    public void setItem(Item newItem) { item = newItem; }
} 
```

当在 Container 上设置 Item 时，Container 通过合并持久化，插入一行。

```
Container container = new Container();
container.setItem(new Item());
container = entityManager.merge(container);
// Row count is 1 
```

但是当该项设置为空，或者设置为另一个项时，旧的对象仍然存在于表中。

```
container.setItem(null);
container = entityManager.merge(container);
// Row count is STILL 1, leaving orphaned rows. 
```

那么，如何删除这些 OneToOne 孤儿？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-17T17:44:43.557

我*猜想*hibernate不允许关系背后的原因与`DELETE_ORPHAN`这个[问题](http://opensource.atlassian.com/projects/hibernate/browse/HHH-3930?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&focusedCommentId=33303#action_33303)有关。`OneToOne`

如果你**真的**想要这个坏的，你可以通过以下步骤破解你的方式：

*   将您的*OneToOne*关系转换为*OneToMany*：
*   添加一个方法来获取子集合的第一个元素（这是可选的，但很方便）
*   使用*DELETE_ORPHAN*注释

当然，这是一个很大的hack。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T10:55:31.373

尝试更改为

```
@OneToOne
@Cascade(cascade = {CascadeType.ALL, CascadeType.DELETE_ORPHAN}) 
```

另请参阅我对类似帖子的[回答](https://stackoverflow.com/questions/549961/hibernate-removing-item-from-a-list-does-not-persist/550441#550441)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-02T11:06:10.583

不幸的是，如果不将自己绑定到 Hibernate 的实现，就无法在 JPA 中执行此操作。

所以是的，正如 Foxy 所说，您可以使用`org.hibernate.annotations.CascadeType`而不是标准 JPA 注释，它允许您指定`DELETE_ORPHAN`. 如果您想使用 JPA 抽象，您必须自己删除孤儿。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-05-27T06:25:53.030

由于 JPA 2.0 已经发布了很长时间，您可以简单地使用：

```
@OneToOne(cascade = CascadeType.ALL, orphanRemoval = true) 
```

# xslt - XSLT 模板中的超链接

> ID：706314
> 
> 赞同：4
> 
> 时间：2009-04-01T16:19:21.807
> 
> 标签：xslt

我正在尝试使用 XML 信息和 XSLT 模板创建超链接。这是 XML 源代码。

```
<smartText>
Among individual stocks, the top percentage gainers in the S. and P. 500 are 
<smartTextLink smartTextRic="http://investing.domain.com/research/stocks/snapshot
/snapshot.asp?ric=HBAN.O">Huntington Bancshares Inc</smartTextLink>
and 
<smartTextLink smartTextRic="http://investing.domain.com/research/stocks/snapshot
/snapshot.asp?ric=EK">Eastman Kodak Co</smartTextLink>
.
</smartText> 
```

我希望输出看起来像这样，公司名称是基于 Xml 中的“smartTextLink”标签的超链接。

在个股中，标准普尔指数涨幅最大的股票。500 是伊士曼柯达公司和亨廷顿银行股份公司。

这是我现在正在使用的模板。我可以显示要显示的文本，但不能显示超链接。

```
<xsl:template match="smartText">
  <p class="smartText">
    <xsl:apply-templates select="child::node()" />
  </p>
</xsl:template>

<xsl:template match="smartTextLink">
  <a>
    <xsl:apply-templates select="child::node()" />
    <xsl:attribute name="href">
      <xsl:value-of select="@smartTextRic"/>
    </xsl:attribute>
  </a> 
</xsl:template> 
```

我尝试了多种变体以尝试使超链接正常工作。我认为模板 match="smartTextLink" 由于某种原因没有被实例化。有人对我如何使这项工作有任何想法吗？

编辑：在查看了一些答案后，它仍然无法在我的整个应用程序中运行。

我从我的主模板中调用 smartText 模板

使用以下语句...

```
<xsl:value-of select="marketSummaryModuleData/smartText"/> 
```

这也可能是问题的一部分吗？

谢谢

谢恩

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T16:25:46.220

要么`xsl:attribute`在任何孩子之前移动，要么使用[属性值模板](http://www.w3.org/TR/xslt#attribute-value-templates)。

```
<xsl:template match="smartTextLink">
    <a href="{@smartTextRic}">
        <xsl:apply-templates/>
    </a> 
</xsl:template> 
```

从 XSLT 1 规范的[创建属性](http://www.w3.org/TR/xslt#creating-attributes)部分：

> 以下是所有错误：
> 
> *   在添加子元素后向元素添加属性；实现可能会发出错误信号或忽略该属性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T16:28:33.373

试试这个 - 对我有用：

```
<xsl:template match="smartText">
    <p class="smartText">
      <xsl:apply-templates/>
    </p>
  </xsl:template>

  <xsl:template match="smartTextLink">
    <a>
      <xsl:attribute name="href">
        <xsl:value-of select="@smartTextRic"/>
      </xsl:attribute>
      <xsl:value-of select="text()"/>
    </a>
  </xsl:template> 
```

诀窍是 -`<xsl:attribute>`首先，在您进行任何其他处理之前。

马克

# asp.net-mvc - 现有 Web 项目中缺少 MVC 模板

> ID：706317
> 
> 赞同：1
> 
> 时间：2009-04-01T16:21:22.673
> 
> 标签：asp.net-mvc

在现有的 VS2008 SP1 Web 项目中，我正在介绍 MVC 页面。我能够手动创建一个视图并使其正常工作，但我无法从解决方案资源管理器中获取“添加视图”和“添加控制器”。此外，当我尝试添加新项目时，MVC 模板不会显示。

我知道我的 VS2008 设置正确，因为在一个新项目上一切正常（MVC 模板显示在 Web 项目中）并且“添加视图”和“添加控制器”也可以正常工作。有没有什么技巧可以让我的遗留项目看到这些选项。

我试着看看 csproj 文件。那里没有什么明显的。我在我的文件夹中看到了模板 zip 文件 ...Common7\IDE\ItemTemplates\CSharp\Web\MVC

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T17:24:45.673

我的猜测是项目类型可能设置错误。我知道在其中一个测试版之后它确实发生了变化。

试试这个：**首先，将现有文件签入源代码管理**，以防不小心弄乱了项目文件。以文本形式打开两个 *.csproj 文件（“有效”和“无效”的文件）。您必须在 IDE 中卸载项目才能执行此操作。将 <ProjectTypeGuids> 值从“有效”的值复制到“无效”的值。现在重新加载项目。看看是否能解决问题。

# python - 在哪里可以找到正在使用的 bsddb 示例？

> ID：706322
> 
> 赞同：8
> 
> 时间：2009-04-01T16:22:38.707
> 
> 标签：python, berkeley-db, bsddb

我花了几个小时寻找如何使用 bsddb 模块的示例，我发现的唯一示例是这些（[来自这里](http://pybsddb.sourceforge.net/bsddb3.html)）：

```
data = mydb.get(key)
if data:
    doSomething(data)
#####################
rec = cursor.first()
while rec:
    print rec
    rec = cursor.next()
#####################
rec = mydb.set()
while rec:
    key, val = rec
    doSomething(key, val)
    rec = mydb.next() 
```

有谁知道我在哪里可以找到更多（实用）如何使用这个包的例子？

或者有人会介意分享他们自己编写的使用它的代码吗？

**编辑：**

我选择 Berkeley DB 的原因是因为它的可扩展性。我正在对大约 220 万个网页进行潜在语义分析。我对 14 个网页的简单测试生成了大约 500,000 条记录。所以算一算……我的表中将有大约 786 亿条记录。

如果有人知道我可以使用 python 访问的另一种高效、可扩展的数据库模型，请告诉我！（*lt_kije*引起了我的注意，`bsddb`它在 Python 2.6 中已弃用，将在 3.* 中消失）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T18:08:21.310

如今，大多数人使用[anydbm](http://docs.python.org/library/anydbm.html)元模块与类似 db 的数据库进行交互。但是[API](http://docs.python.org/library/bsddb.html)本质上是类似 dict 的；有关一些示例，请参见[PyMOTW](http://www.doughellmann.com/PyMOTW/anydbm/)。请注意，bsddb 在 2.6.1 中已弃用，并将在 3.x 中消失。切换到anydbm会使升级更容易；切换到 sqlite（现在在 stdlib 中）将为您提供更灵活的存储。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-02-18T23:27:46.893

[从http://pypi.python.org/pypi/bsddb3/](http://pypi.python.org/pypi/bsddb3/)下载源码后看：Lib3/bsddb/test

当前发行版包含以下对开始使用 bsddb3 非常有帮助的测试：

```
test_all.py
test_associate.py
test_basics.py
test_compare.py
test_compat.py
test_cursor_pget_bug.py
test_dbenv.py
test_dbobj.py
test_db.py
test_dbshel​​ve.py
test_dbtables.py
test_distributed_transactions.py
test_early_close.py
test_fileid.py
test_get_none.py
test_join.py
test_lock.py
test_misc.py
test_pickle.py
test_queue.py
test_recno.py
test_replication.py
test_sequence.py
test_thread.py

```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-08-09T10:46:39.030

我假设这个线程仍然处于活动状态，所以我们开始吧。这是粗略的代码，没有错误检查，但作为起点，它可能很有用。

我想使用 PHP 的内置 DBA 函数，然后使用 Python (2.x) 脚本读取数据库。这是创建数据库的 PHP 脚本：

```
<?php 
$id=dba_open('visitor.db', 'c', 'db4');
dba_optimize($id);
dba_close($id);
?> 
```

现在，这是插入条目的 PHP 代码：我使用 JSON 来保存“真实”数据：

```
<?php 
/* 
    record a visit in a BSD DB
*/
$id=dba_open('visitor.db', 'w', 'db4');
if (!$id) {
    /* dba_open failed */
    exit;
}
$key  = $_SERVER['REQUEST_TIME_FLOAT']; 
$rip  = $_SERVER['REMOTE_ADDR'];
$now  = date('d-m-Y h:i:s a', time()); 
$data = json_encode( array('remote_ip' => $rip, 'timestamp' => $now) );
$userdata=array($key => $data);
foreach ($userdata as $key=>$value) {
dba_insert($key, $value, $id);
}
dba_optimize($id);
dba_close($id);
?> 
```

现在，这是您和我真正感兴趣的代码，它使用 Python 的 bsddb3 模块。

```
#!/usr/bin/env python
from bsddb3 import db
import json

fruitDB = db.DB()
fruitDB.open('visitor.db',None,db.DB_BTREE,db.DB_DIRTY_READ)
cursor = fruitDB.cursor()
rec = cursor.first()

while rec:
    print rec
    visitordata = rec[1]
    print '\t' + visitordata
    jvdata = json.loads(visitordata)
    print jvdata
    rec = cursor.next()
    print '\n\n'
print '----';

fruitDB.close() 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-01T18:06:11.220

搜索“import bsddb”，我得到：

*   [http://www.mnot.net/python/Cabinet.py](http://www.mnot.net/python/Cabinet.py)
*   [http://www.java2s.com/Code/Python/Utility/Dumpadatabasefiletoapickle.htm](http://www.java2s.com/Code/Python/Utility/Dumpadatabasefiletoapickle.htm)

...但我个人强烈建议您使用 sqlite 而不是 bsddb，人们更多地使用前者是有原因的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-19T09:08:29.977

[Gramps](https://github.com/gramps-project/gramps/tree/master/gramps/plugins/database)家谱程序使用 bsddb 作为其数据库

# c# - 将数据从子窗体发送到父窗体文本框

> ID：706326
> 
> 赞同：4
> 
> 时间：2009-04-01T16:23:06.477
> 
> 标签：c#, winforms, .net-3.5

我有一个父表单，其中包含一个带有名字、姓氏等的“HUD”。其中一个子表单是搜索表单。当用户从 DataGrid 中显示的结果中选择一个成员时，我希望相关信息填写在 HUD 中。我创建了一个 HUD 类，其中包含每个值的变量和一个名为 UpdateHUD() 的方法。我不确定如何让这个工作。我参考了包含 HUD 的父表单的搜索表单，如下所示：

```
public frmWWCModuleHost _frmWWCModuleHost; 
```

这是我用来嵌入表单的代码。我没有使用 MDI。

```
 public static void ShowFormInContainerControl(Control ctl, Form frm)
    {
        frm.TopLevel = false;
        frm.FormBorderStyle = FormBorderStyle.None;
        frm.Dock = DockStyle.Fill;
        frm.Visible = true;
        ctl.Controls.Add(frm);
    } 
```

这是我在 Cell 上运行的代码 单击搜索表单。这是在我尝试实现 HUD 类之前。

```
private void dgvSearchResults_CellContentClick(object sender, DataGridViewCellEventArgs e)
    {
        _frmWWCModuleHost = new frmWWCModuleHost();
        _frmWWCModuleHost.tbxHUD_LastName.Text = dgvSearchResults.CurrentRow.Cells[1].FormattedValue.ToString();
        _frmWWCModuleHost.tbxHUD_LastName.Invalidate();
        _frmWWCModuleHost.FormPaint();
    } 
```

提前致谢！

〜帕特里克

* * *

## 编辑

* * *

dgvSearchResults_CellContentClick 现在是最新的。当我逐步执行此代码时，它会在此处获得正确的值，但它永远不会更新实际的 HUD。

* * *

## 编辑 2

* * *

我的问题是我声明一个新的 frmWWCModuleHost 而不是将 ref 传递给现有的？我对此的理解仍然很薄弱。

* * *

## 编辑 3

* * *

我通过执行以下操作“解决”了这个问题：在我声明子表单的父表单上，我将*其*作为参数传递。然后在子窗体的构造函数中添加了 _frmWWCModuleHost = m_parent; 我的父窗体上有一个 UpdateHUD() 方法，我从子窗体的 _CellClick 事件中调用它。

现在改述我的问题；这样做有什么明显的错误吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T16:25:27.360

当子表单搜索完成时，引发“SearchCompleted”事件。然后任何东西（包括父表单）都可以订阅该事件并检索详细信息。

有关示例，请参见以下 NotepadCode：

```
class ParentForm
{
    private readonly ChildForm childForm;

    public ParentForm()
    {
        InitializeComponent();

        childForm = new ChildForm();

        childForm.SearchCompleted += childForm_SearchCompleted;
    }

    private void childForm_SearchCompleted(object sender, SearchCompletedEventArgs e)
    {
        // Update the display
        lblName.Text = e.DataToDisplay;
    }
}

class ChildForm
{
    public event EventHandler<SearchCompletedEventArgs> SearchCompleted;

    private void Search(string query)
    {
        // Do the searching

        OnSearchCompleted(new SearchCompletedEventArgs([arg values]));
    }

    public void OnSearchCompleted(SearchCompletedEventArgs args)
    {
        if (SearchCompleted != null)
        {
            SearchCompleted(this, args);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T16:26:09.043

在 .NET 中，表单和其他所有事物一样都是对象，因此您应该从这些术语中考虑问题。

这样，子表单将需要访问父表单。您可以通过构造函数、方法或字段/属性将父表单引用传递给子表单来提供它（尽管构造函数最有意义）。

然后，您可以从孩子更改父表单中的值。

**但是**我会说这不是最好的主意。相反，孩子应该公开一个指示数据已更改的事件（以及获取该数据的机制），然后父母应该订阅该事件并在触发时使用数据更新自己。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T18:16:29.637

有时在这种情况下，我会创建一个与我想在父类中调用的方法的签名相匹配的委托（我认为在您的情况下是 UpdateHUD），然后传递该委托的一个实例（即引用到 UpdateHUD）到子表单（在这种情况下为搜索表单）。当子表单完成接受输入时，它会使用表单上收集的数据调用委托。

因此，假设 UpdateHUD 是父表单中的一个方法，看起来像这样。

```
private void UpdateHUD(string firstName, string lastName) {
    //...
} 
```

您将创建一个具有相同签名的委托，如下所示。

```
public delegate void HUDUpdateHandler(string firstName, string lastName); 
```

然后，您将向子表单的构造函数添加 HUDUpdateHandler 参数并将其存储在私有字段中（例如，`this.handler = handler`）。当您的子表单准备好将其数据发回时，您将调用子表单的私有字段（`this.handler.Invoke(firstNameTextBox.Text, lastNameTextBox.Text)`例如）。这将使用子类中的值在您的父类中调用 UpdateHUD，并且您不必公开任何内容。

我发现这种方法比引发和捕获事件更容易实现，并且它允许您将父类的内部保持在内部。

# php - .xml 文件中的 PHP 错误？

> ID：706329
> 
> 赞同：3
> 
> 时间：2009-04-01T16:25:08.890
> 
> 标签：php, xml, .htaccess

好的，首先，我将此行添加到我的 .htaccess 文件中，以便 php 引擎解析 .xml 文件中的 php 代码：

```
AddType application/x-httpd-php .php .php3 .phtml .html .xml 
```

之后，当我查看 .xml 文件时，我收到了这个 PHP 错误：

**解析错误：解析错误，第 1 行 /var/www/vhosts/mydomain.com/httpdocs/test.xml 中的意外 T_STRING**

但是第 1 行甚至不是 php 事实上这是第 1 行：

```
<?xml version="1.0" encoding="utf-8"?> 
```

谁能告诉我问题是什么？

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-01T16:27:16.030

那是因为`<?`是 php 的短开始标签。

尝试`<?php echo '<?xml version="1.0" encoding="utf-8"?>'; ?>`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-01T16:35:39.223

是的，可悲但真实的是，文档类型被视为 PHP 开始短标签。你有几个选择：

1.  将 XML 从文件列表中取出，以便 PHP 在 .htaccess 文件中解析
2.  在 PHP 中包装所有 xml 声明：

    `<?php print('<?xml version="1.0" encoding="utf-8"?>'); ?>`

3.  `short_open_tag`在 .htaccess 或 php.ini 中关闭。这意味着 PHP 将只接受**`<?php`**作为开始标签并忽略**`<?`**.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-01T23:19:45.493

备选方案 4，除了 daniel 的：完全删除 <?xml...?> 声明。

因为 '1.0' 和 'utf-8' 是 XML 的默认值，所以它完全是多余的；包括这里的 XML 声明对您没有任何好处。

# asp.net - 登录控制 - Response.Redirect

> ID：706330
> 
> 赞同：1
> 
> 时间：2009-04-01T16:25:23.693
> 
> 标签：asp.net

我在一个页面上有一个用户控件，其中有一个登录控件。这控制另一个用户控件的显示（如果用户未登录，他们将获得登录控件用户控件）。当用户单击“登录”按钮时，我有一些身份验证代码（见下文）。基本上我希望它回发到同一页面，这样他们就可以登录并现在能够看到其他受保护的用户控件。此代码不起作用。也许另一个页面中发生了一些事情导致它不起作用，但是这段代码本身看起来应该可以工作吗？

字符串用户名 = Membership.GetUserNameByEmail(Login1.UserName);

```
 if (userName != null)
    {
        e.Authenticated = Membership.ValidateUser(userName, Login1.Password);
    }
    else
    {
        e.Authenticated = false;
    }

    if (e.Authenticated)
    {
        Login1.UserName = userName;
        ImageButton loginButton = (ImageButton)Login1.FindControl("LoginButton");
        if (loginButton != null)
        {
            //loginButton.PostBackUrl = Request.Url.ToString();                
            Response.Redirect(Request.Url.ToString());
        }
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T16:29:28.317

问题是登录控件本身会进行重定向，在 url 中设置 cookie 或加密的身份验证票（无 cookie）。

我认为登录控件具有一些属性，您可以在其中告诉它它将重定向到哪里（它会覆盖 web.config 中的那个）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-20T16:51:25.917

DestinationPageUrl 是属性... soo Login1.DestinationPageUrl = "~/whatever.aspx";

# multithreading - Win32 注册表线程安全吗？

> ID：706336
> 
> 赞同：18
> 
> 时间：2009-04-01T16:26:39.963
> 
> 标签：multithreading, winapi, synchronization, registry

如果我有两个进程访问给定的注册表项（例如`HKLM`），我应该将逻辑包装在互斥锁中吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-01T16:29:36.210

注册表将确保操作是原子的，因此您不必自己同步它。

但是，如果您有多个进程/线程同时访问注册表，则不能保证先发生哪个。只是你不会得到乱码数据。

编辑：进一步阅读，请参阅[The inability to lock someone out of the registry is a feature, not a bug](https://devblogs.microsoft.com/oldnewthing/20090326-00/?p=18703)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T16:41:37.507

正如其他人所提到的，单个操作是原子的。如果您需要使更大的操作集原子化，并且您的目标是 Vista 或更好，您可以使用 Vista 中添加的事务性注册表支持。

不幸的是，没有直接的托管支持，因此您需要创建包装器。[http://community.bartdesmet.net/blogs/bart/archive/2006/12/14/Windows-Vista-2D00-Introducing-TxR-in-C_2300_-_2800_Part-1_2900_.aspx展示](http://community.bartdesmet.net/blogs/bart/archive/2006/12/14/Windows-Vista-_2D00_-Introducing-TxR-in-C_2300_-_2800_Part-1_2900_.aspx)*了如何 P/Invoke 这些方法[*。*](http://community.bartdesmet.net/blogs/bart/archive/2006/12/14/Windows-Vista-_2D00_-Introducing-TxR-in-C_2300_-_2800_Part-1_2900_.aspx)*

 ** * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T16:39:41.133

Windows Server 2008 还支持对注册表的事务访问。 [这是 MSDN 上的概述](http://msdn.microsoft.com/en-us/library/cc303705.aspx)。这是[一篇博客文章](http://blogs.msdn.com/because_we_can/archive/2005/06/08/427036.aspx)，其中包含一些问题和答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:32:34.253

快速阅读这篇 Raymond Chen 的文章。它解释了对注册表的单个写入和读取是原子的。但是，其他锁定取决于您，因为现在有办法让钥匙独占打开。

[https://devblogs.microsoft.com/oldnewthing/20090326-00/?p=18703](https://devblogs.microsoft.com/oldnewthing/20090326-00/?p=18703)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T16:29:50.797

这取决于您在交流什么，以及信息的时间紧迫性。例如，假设您有一个应用程序正在工作并将状态结果写入注册表项，另一个应用程序读取该状态并将其显示在屏幕上。在这种情况下，我不会打扰互斥锁，因为读者总是会得到一个“有意义”的值。我认为你要问的是并发设计的一个基本问题。

# vb6 - 在不使用 clireg 的情况下注册 vb6 com+ 应用程序时如何指定 com+ 服务器？

> ID：706343
> 
> 赞同：0
> 
> 时间：2009-04-01T16:29:22.250
> 
> 标签：vb6, wix, com+, clireg32

我找到了很多关于如何使用 WiX 或从 dcomcnfg 导出的 msi 安装 com+ 组件的文档，但是这些方法的问题是我看不到在哪里指定 com+ 服务器。

目前我们使用 clireg 和 -s 开关注册组件，它允许我们像这样指定 com+ 服务器：

```
clireg32.exe BLEH.VBR -s COMSERVER -t BLEH.TLB -d 
```

至少可以说这很混乱，我一直在尝试将其引入某种自动安装形式，而无需调用充满 clireg32 调用的批处理文件。

目前，WiX 是我们包装自动化的支柱，因此使用 WiX 的解决方案将非常棒。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T06:30:51.463

为什么不能使用 Wix3 ComPlus 扩展？（抱歉，没有在线链接，请查看 Wix3 文档以获取参考和示例），或者您可能希望将您的 ComPlus 应用程序注册为**服务**，而目前这些扩展无法实现。

# iphone - 锁定解锁事件 iphone

> ID：706344
> 
> 赞同：37
> 
> 时间：2009-04-01T16:29:23.560
> 
> 标签：iphone, ios, api, locking

如何检测 iPhone 上的锁定/解锁事件？假设只有越狱设备才有可能，你能指出正确的 API 吗？

通过*锁定事件*，我的意思是显示或隐藏锁定屏幕（可能需要密码才能解锁）。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2013-01-08T11:27:34.627

您可以使用[Darwin 通知](https://developer.apple.com/library/mac/#documentation/CoreFoundation/Reference/CFNotificationCenterRef/Reference/reference.html)来监听事件。根据我在越狱的 iOS 5.0.1 iPhone 4 上的测试，我认为这些事件之一可能是您需要的：

```
com.apple.springboard.lockstate
com.apple.springboard.lockcomplete 
```

**注意：**根据发布者[对我在这里回答的类似问题的评论](https://stackoverflow.com/a/14208787/119114)，这也应该适用于未越狱的手机。

要使用它，请像这样注册事件（这仅注册上面的第一个事件，但您也可以添加一个观察者`lockcomplete`）：

```
CFNotificationCenterAddObserver(CFNotificationCenterGetDarwinNotifyCenter(), //center
                                (void*)self, // observer (can be NULL)
                                lockStateChanged, // callback
                                CFSTR("com.apple.springboard.lockstate"), // event name
                                NULL, // object
                                CFNotificationSuspensionBehaviorDeliverImmediately); 
```

`lockStateChanged`您的事件回调在哪里：

```
static void lockStateChanged(CFNotificationCenterRef center, void *observer, CFStringRef name, const void *object, CFDictionaryRef userInfo) {
    NSLog(@"event received!");
    if (observer != NULL) {
        MyClass *this = (MyClass*)observer;
    }

    // you might try inspecting the `userInfo` dictionary, to see 
    //  if it contains any useful info
    if (userInfo != nil) {
        CFShow(userInfo);
    }
} 
```

该`lockstate`事件在设备被锁定**和**解锁时发生，但该`lockcomplete`事件仅在设备锁定时触发。确定事件是针对锁定事件还是解锁事件的另一种方法是使用`notify_get_state()`. 如此处所述，您将获得 lock 与 unlock 不同的[值](https://stackoverflow.com/a/14357568/119114)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-09-20T01:08:14.353

转一转答案：

应用程序将退出活动在各种情况下被调用......并且根据我的所有测试，即使您的应用程序在后台保持唤醒状态，也无法确定屏幕已锁定（CPU 速度不报告，总线速度保持不变，mach_time denom / numer 不变）...

但是，似乎Apple在设备锁定时确实关闭了加速度计......[在屏幕锁定时启用iPhone加速度计](https://stackoverflow.com/questions/2529422/enable-iphone-accelerometer-while-screen-is-locked) （在iPhone 4上测试的iOS4.2有这种行为）

因此...

在您的应用程序委托中：

```
- (void)applicationWillResignActive:(UIApplication *)application
{
    NSLog(@"STATUS - Application will Resign Active");
    // Start checking the accelerometer (while we are in the background)
    [[UIAccelerometer sharedAccelerometer] setDelegate:self];
    [[UIAccelerometer sharedAccelerometer] setUpdateInterval:1]; // Ping every second
    _notActiveTimer = [NSTimer scheduledTimerWithTimeInterval:2 target:self selector:@selector(deviceDidLock) userInfo:nil repeats:NO]; // 2 seconds for wiggle

}
//Deprecated in iOS5
- (void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration
{
    NSLog(@"STATUS - Update from accelerometer");
    [_notActiveTimer invalidate];
    _notActiveTimer = [NSTimer scheduledTimerWithTimeInterval:2 target:self selector:@selector(deviceDidLock) userInfo:nil repeats:NO];
}

- (void)deviceDidLock
{
    NSLog(@"STATUS - Device locked!");
    [[UIAccelerometer sharedAccelerometer] setDelegate:nil];
    _notActiveTimer = nil;
}

- (void)applicationDidBecomeActive:(UIApplication *)application
{
    NSLog(@"STATUS - Application did become active");
    [[UIAccelerometer sharedAccelerometer] setDelegate:nil];
    [_notActiveTimer invalidate];
    _notActiveTimer = nil;
} 
```

我知道......这有点像黑客，但到目前为止它对我来说就像一个魅力。如果您发现任何阻止此操作的问题，请更新。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-01-22T22:43:21.773

有一种更漂亮的方法可以区分任务切换和屏幕锁定发起的`applicationWillResignActive:`回调，它甚至不涉及未记录的功能，例如加速度计状态。

当应用程序移动到后台时，首先向应用程序委托发送一个`applicationWillResignActive:`，然后发送一个`applicationDidEnterBackground:`. 当应用程序因按下锁定按钮或来电而中断时，不会调用后一种方法。我们可以使用这些信息来区分这两种情况。

`screenLockActivated`假设如果屏幕被锁定，您想在方法中被回调。这是魔术：

```
- (void)applicationWillResignActive:(UIApplication*)aApplication
{
    [self performSelector:@selector(screenLockActivated)
               withObject:nil
               afterDelay:0];
}

- (void)applicationDidEnterBackground:(UIApplication*)aApplication
{
    [NSObject cancelPreviousPerformRequestsWithTarget:self];
}

- (void)screenLockActivated
{
    NSLog(@"yaay");
} 
```

解释：

默认情况下，我们假设每次调用`applicationWillResignActive:`都是由于活动->非活动状态转换（如锁定屏幕时），但我们慷慨地让系统通过延迟在超时（在本例中为单个 runloop 循环）内证明相反的情况调用`screenLockActivated`. 如果屏幕被锁定，系统会在不触及任何其他委托方法的情况下完成当前的 runloop 循环。但是，如果这是一个活动->后台状态转换，它还会`applicationDidEnterBackground:`在循环结束之前调用，这允许我们从那里简单地取消先前安排的请求，从而防止它在不应该被调用时被调用。

享受！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-05-07T22:43:18.567

在撰写本文时，有两种相当可靠的方法来检测设备锁定：

* * *

## 数据保护

通过启用[数据保护权利](https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/StrategiesforImplementingYourApp/StrategiesforImplementingYourApp.html#//apple_ref/doc/uid/TP40007072-CH5-SW21)，您的应用程序可以订阅[`applicationProtectedDataWillBecomeUnavailable:`](https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/StrategiesforImplementingYourApp/StrategiesforImplementingYourApp.html#//apple_ref/doc/uid/TP40007072-CH5-SW21)和[`applicationProtectedDataDidBecomeAvailable:`](https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/StrategiesforImplementingYourApp/StrategiesforImplementingYourApp.html#//apple_ref/doc/uid/TP40007072-CH5-SW21)通知，以高概率确定使用密码/TouchID 身份验证的设备何时被锁定/解锁。[`LAContext`](https://developer.apple.com/reference/localauthentication/lacontext)可以查询设备是否使用密码/TouchID 。

**注意事项**：此方法依赖于与手机被锁定同时发生的“受保护的数据变得不可用”。当手机使用 TouchID 并按下睡眠/锁定按钮时，手机将被锁定，受保护的数据将不可用，并且将立即需要密码才能再次解锁。这意味着受保护的数据变得不可用基本上表明手机已被锁定。**当某人仅使用密码时，这不一定是正确的，**因为他们可以将“需要密码”时间设置为从*立即*到*4 小时*之类的任何时间。在这种情况下，手机将报告能够处理受保护的数据，但锁定手机不会导致受保护的数据在相当长的一段时间内变得不可用。

* * *

## 生命周期时序

如果您的应用程序处于前台，则两个生命周期事件之间的时间差将发生显着变化，[`UIApplicationWillResignActiveNotification`](https://developer.apple.com/reference/uikit/uiapplicationwillresignactivenotification)具体[`UIApplicationDidEnterBackgroundNotification`](https://developer.apple.com/reference/uikit/uiapplicationdidenterbackgroundnotification)取决于触发它们的原因。

**（这在 iOS 10 中进行了测试，可能会在未来的版本中更改）**

按下主页按钮会导致两者之间出现明显延迟（即使启用了“减少运动”设置）：

```
15:23:42.517 willResignActive
15:23:43.182 didEnterBackground
15:23:43.184 difference: 0.666346 
```

在应用程序打开时锁定设备会在两个事件之间产生更微不足道的（<~0.2s）延迟：

```
15:22:59.236 willResignActive
15:22:59.267 didEnterBackground
15:22:59.267 difference: 0.031404 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-05-19T03:07:30.767

in iOS 8, you lock the screen or push the home button, all of those make app push in background, but you don't know which operator result in this. My solution same with Nits007ak,use notify_register_dispatch to get state.

```
#import <notify.h>
        int notify_token
        notify_register_dispatch("com.apple.springboard.lockstate",
                             &notify_token,
                             dispatch_get_main_queue(),
                             ^(int token)
                             {
                                 uint64_t state = UINT64_MAX;
                                 notify_get_state(token, &state);
                                 if(state == 0) {
                                     NSLog(@"unlock device");
                                 } else {
                                     NSLog(@"lock device");
                                 }
                             }
                             ); 
```

As long as the app is running, in foreground or background. not suspend, you can get this event.

And you can use notify_token as parameter of notify_get_state to get current state anywhere, this is useful when you want know the state and the screen state don't change.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-09-24T08:33:36.430

只需在使用此代码之前导入#import notify.h。请享用！！

```
-(void)registerAppforDetectLockState {

    int notify_token;
        notify_register_dispatch("com.apple.springboard.lockstate", &notify_token,dispatch_get_main_queue(), ^(int token) {

        uint64_t state = UINT64_MAX;
        notify_get_state(token, &state);

        if(state == 0) {
            NSLog(@"unlock device");
        } else {
            NSLog(@"lock device");
        }

        NSLog(@"com.apple.springboard.lockstate = %llu", state);
        UILocalNotification *notification = [[UILocalNotification alloc]init];
        notification.repeatInterval = NSDayCalendarUnit;
        [notification setAlertBody:@"Hello world!! I come becoz you lock/unlock your device :)"];
        notification.alertAction = @"View";
        notification.alertAction = @"Yes";
        [notification setFireDate:[NSDate dateWithTimeIntervalSinceNow:1]];
        notification.soundName = UILocalNotificationDefaultSoundName;
        [notification setTimeZone:[NSTimeZone  defaultTimeZone]];

        [[UIApplication sharedApplication] presentLocalNotificationNow:notification];

    });
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-07-03T11:12:22.550

如果设置了密码，您可以在 AppDelegate 中使用这些事件

```
-(void)applicationProtectedDataWillBecomeUnavailable:(UIApplication *)application
{
}

- (void)applicationProtectedDataDidBecomeAvailable:(UIApplication *)application
{
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-28T06:56:51.030

通过大量的尝试和错误，发现监控黑屏、锁定完成和锁定状态事件给出了一致的锁定屏幕指示。您需要监视状态转换。

```
// call back
void displayStatusChanged(CFNotificationCenterRef center, void *observer, CFStringRef name, const void *object, CFDictionaryRef userInfo)
{
    // notification comes in order of
    // "com.apple.springboard.hasBlankedScreen" notification
    // "com.apple.springboard.lockcomplete" notification only if locked
    // "com.apple.springboard.lockstate" notification

    AppDelegate *appDelegate = CFBridgingRelease(observer);

    NSString *eventName = (__bridge NSString*)name;
    NSLog(@"Darwin notification NAME = %@",name);

    if([eventName isEqualToString:@"com.apple.springboard.hasBlankedScreen"])
    {
        NSLog(@"SCREEN BLANK");

        appDelegate.bDeviceLocked = false; // clear
    }
    else if([eventName isEqualToString:@"com.apple.springboard.lockcomplete"])
    {
        NSLog(@"DEVICE LOCK");

        appDelegate.bDeviceLocked = true; // set
    }
    else if([eventName isEqualToString:@"com.apple.springboard.lockstate"])
    {
        NSLog(@"LOCK STATUS CHANGE");

        if(appDelegate.bDeviceLocked) // if a lock, is set
        {
            NSLog(@"DEVICE IS LOCKED");
        }
        else
        {
            NSLog(@"DEVICE IS UNLOCKED");
        }
    }
}

-(void)registerforDeviceLockNotif
{
    // screen and lock notifications
    CFNotificationCenterAddObserver(CFNotificationCenterGetDarwinNotifyCenter(), //center
                                    CFBridgingRetain(self), // observer
                                    displayStatusChanged, // callback
                                    CFSTR("com.apple.springboard.hasBlankedScreen"), // event name
                                    NULL, // object
                                    CFNotificationSuspensionBehaviorDeliverImmediately);

    CFNotificationCenterAddObserver(CFNotificationCenterGetDarwinNotifyCenter(), //center
                                    CFBridgingRetain(self), // observer
                                    displayStatusChanged, // callback
                                    CFSTR("com.apple.springboard.lockcomplete"), // event name
                                    NULL, // object
                                    CFNotificationSuspensionBehaviorDeliverImmediately);

    CFNotificationCenterAddObserver(CFNotificationCenterGetDarwinNotifyCenter(), //center
                                    CFBridgingRetain(self), // observer
                                    displayStatusChanged, // callback
                                    CFSTR("com.apple.springboard.lockstate"), // event name
                                    NULL, // object
                                    CFNotificationSuspensionBehaviorDeliverImmediately);
} 
```

要让屏幕锁定指示器在后台运行，您需要在应用启动时调用以下调用来实现后台处理。

```
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    self.backgroundTaskIdentifier =
    [[UIApplication sharedApplication] beginBackgroundTaskWithExpirationHandler:^{

        [[UIApplication sharedApplication] endBackgroundTask:self.backgroundTaskIdentifier];
    }];

    [self registerforDeviceLockNotif];
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-05-04T23:46:27.460

如果您的应用程序正在运行并且用户锁定了设备，您的应用程序委托将收到对“应用程序将退出活动：”的调用。如果您的应用程序在锁定时正在运行，它会在设备解锁时收到对“应用程序已变为活动：”的调用。但是，如果用户接到电话然后选择忽略它，您的应用程序也会收到相同的电话。据我所知，你无法区分。

如果您的应用程序在这些时间没有运行，则由于您的应用程序没有运行，因此无法收到通知。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2015-05-07T07:24:47.240

获取屏幕锁定和解锁事件的最简单方法是在视图控制器中使用 NSNotificationCenter 添加事件观察器。我在 viewdidload 方法中添加了以下观察者。这就是我所做的：

```
[[NSNotificationCenter defaultCenter] addObserver:self
                                         selector:@selector(applicationEnteredForeground:)
                                             name:UIApplicationWillEnterForegroundNotification
                                           object:nil]; 
```

然后我将以下选择器添加到视图控制器。屏幕解锁时将调用此选择器。

```
 - (void)applicationEnteredForeground:(NSNotification *)notification {
    NSLog(@"Application Entered Foreground");
    } 
```

如果要在屏幕锁定时检测事件，可以将*UIApplicationWillEnterForegroundNotification*替换为*UIApplicationDidEnterBackgroundNotification*。

# asp.net - Active/Crystal 报告和最终用户设计师

> ID：706349
> 
> 赞同：0
> 
> 时间：2009-04-01T16:29:42.497
> 
> 标签：asp.net, vb.net

我一直在研究我公司即将开展的一个项目的报告套件，并将候选人范围缩小到 Active Reports 和 Crystal Reports。

在昨天的演示中，我向我澄清说，我们的客户想要的功能之一是最终用户能够创建集成到基于 Web 的客户端的自定义报告。我知道这两个软件包都具有将最终用户设计器集成到基于 WinForms 的应用程序的选项，但是对于是否可以将它们附加到 ASP，我无法为任何一个套件找到明确的直接是或否答案。基于网络的应用程序。

我的直觉是否定的，但我希望在报告套件方面有更多经验的人能给我一个可靠的是或否。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T17:29:22.807

我不能代表 Active Report，但不难找到讨厌 Crystal Reports 的人。在网络上编辑 AFAIK 水晶报表需要 BOXI，它需要成本分配，但包括一个更好的报告工具，称为网络智能或“webbi”，将其视为基于 Web 的数据透视表。

无论您最终选择哪种产品，如果您没有星型模式，最终用户将在创建报告时遇到困难和令人沮丧的时间。即使你有一个抽象层，你也会碰壁。

好奇你为什么决定反对 SSRS？如果您已经拥有 SQL Server，则您已经拥有许可证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T01:01:30.473

我曾经喜欢主动报告。有一段时间没有使用它们了。您知道 Visual Studio 内置了报告功能吗？SQL Server 也是如此。我同意jms，不难找到讨厌水晶报告的人。

# c++ - 对所有 USB 设备使用 RegisterDeviceNotification()

> ID：706352
> 
> 赞同：7
> 
> 时间：2009-04-01T16:30:26.707
> 
> 标签：c++, windows, usb, notifications

我目前有一些代码可以在 Windows 服务（用 C++ 编写）中设置连接的 USB HID 设备的通知。代码如下：

```
 GUID hidGuid;
   HidD_GetHidGuid(&hidGuid);

   DEV_BROADCAST_DEVICEINTERFACE NotificationFilter;
   ZeroMemory(&NotificationFilter, sizeof(NotificationFilter));
   NotificationFilter.dbcc_size = sizeof(DEV_BROADCAST_DEVICEINTERFACE);
   NotificationFilter.dbcc_devicetype = DBT_DEVTYP_DEVICEINTERFACE;
   NotificationFilter.dbcc_classguid = hidGuid;
   HDEVNOTIFY deviceNotify = RegisterDeviceNotification(StatusHandle, &NotificationFilter, DEVICE_NOTIFY_SERVICE_HANDLE); 
```

然后通过 SERVICE_CONTROL_DEVICEEVENT 事件接收通知。（请记住，这是一项服务，因此没有 WM_DEVICECHANGE）。

我以为我可以在 RegisterDeviceNotification() 调用中指定 DEV_BROADCAST_DEVICEINTERFACE 标志，这样它就会覆盖 dbcc_classguid 并获取所有设备，但事实证明，Windows 2000 不支持该标志，这对我来说是个大问题。另外，我猜这将返回的不仅仅是 USB 设备。

我应该如何修改它以获取*所有*USB 设备，而不仅仅是 USB HID？是否应该像提供不同的 GUID 一样简单？是否有所有 USB 的 GUID？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-11T20:30:14.933

使用 GUID_DEVINTERFACE_USB_DEVICE（在“usbiodef.h”中）监视所有 USB 设备。

```
 DEV_BROADCAST_DEVICEINTERFACE NotificationFilter;
  ZeroMemory(&NotificationFilter, sizeof(NotificationFilter));

  NotificationFilter.dbcc_size = sizeof(NotificationFilter);
  NotificationFilter.dbcc_devicetype = DBT_DEVTYP_DEVICEINTERFACE;
  NotificationFilter.dbcc_reserved = 0;

  NotificationFilter.dbcc_classguid = GUID_DEVINTERFACE_USB_DEVICE;

  HDEVNOTIFY hDevNotify = RegisterDeviceNotification(hwnd, &NotificationFilter, DEVICE_NOTIFY_SERVICE_HANDLE); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-14T10:44:50.313

你试过`GUID_DEVCLASS_USB`吗？（在 devguid.h、Windows SDK 中定义）

你说的是`DEVICE_NOTIFY_ALL_INTERFACE_CLASSES`国旗吗？

此外，我发现以下文章很有帮助 - 它是关于设备 GUID 与接口 GUID 的：

[https://web.archive.org/web/20081227101643/http://blogs.msdn.com/doronh/archive/2006/02/15/532679.aspx](https://web.archive.org/web/20081227101643/http://blogs.msdn.com/doronh/archive/2006/02/15/532679.aspx)

# java - 编写长测试方法名称来描述测试与在代码文档中使用

> ID：706354
> 
> 赞同：8
> 
> 时间：2009-04-01T16:30:52.043
> 
> 标签：java, .net, unit-testing

对于编写单元测试，我知道编写看起来像这样的测试方法非常流行

```
public void Can_User_Authenticate_With_Bad_Password()
{
...
} 
```

虽然这可以很容易地查看测试正在测试什么，但我认为它看起来很难看，并且在自动生成的文档（如 sandcastle 或 javadoc）中显示效果不佳。

我很想看看人们对使用命名模式的看法，该命名模式是被测试的方法，下划线 test 然后是测试编号。然后使用 XML 代码文档 (.net) 或 javadoc 注释来描述正在测试的内容。

```
/// <summary>
/// Tests for user authentication with a bad password.
/// </summary>
public void AuthenticateUser_Test1()
{
...
} 
```

通过这样做，我可以轻松地将我的测试按他们正在测试的方法组合在一起，我可以看到我对给定方法进行的测试，并且我仍然对正在测试的内容有完整的描述。

我们有一些针对数据源（xml 文件）运行的回归测试，这些文件可能由无法访问源代码的人（QA 猴子）更新，他们需要能够读取正在测试的内容和位置，来更新数据源。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-01T16:35:32.420

我更喜欢“长名称”版本——尽管只是为了描述会发生*什么*。如果测试需要描述它发生的*原因*，我会将它放在评论中（如果合适的话，还有一个错误编号）。

有了长名称，当您收到一封告诉您哪些测试失败的邮件（或其他）时，出了什么问题就更清楚了。

我会根据它*应*该做什么来写它：

```
LogInSucceedsWithValidCredentials

LogInFailsWithIncorrectPassword

LogInFailsForUnknownUser 
```

我不相信它在自动生成的文档中看起来很糟糕的论点 - 你为什么首先在*测试*中运行 JavaDoc？我不能说我曾经这样做过，或者*想要*生成文档。鉴于测试方法通常没有参数并且不返回任何内容，如果方法名称可以合理地描述它们，那么这就是您需要的所有信息。测试运行程序应该能够列出它运行的测试，或者 IDE 可以向您显示可用的测试。我发现这比通过 HTML 导航更方便 - 浏览器没有“查找类型”，它让我只输入名称中每个单词的首字母，例如......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T16:39:36.997

文档是否显示在您的测试运行程序中？如果不是，那是使用长的描述性名称的一个很好的理由。

就我个人而言，我更喜欢长名称，并且很少看到需要在测试中添加注释。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-07T19:35:53.977

我已经完成了相关主题的论文，所以这是我的两分钱：任何时候你依赖文档来传达不在你的方法签名中的东西，你就冒着没有人会阅读文档的巨大风险。

当开发人员正在寻找特定的东西时（例如，扫描一个类中的一长串方法以查看他们正在寻找的东西是否已经存在），他们中的大多数人都不会费心阅读文档。他们希望处理一种他们可以轻松查看和比较的信息（例如，名称），而不是必须开始重定向到其他材料（例如，悬停足够长的时间以查看 JavaDocs）。

我强烈建议在您的签名中传达所有相关内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T16:35:27.570

我个人更喜欢使用长方法名称。请注意，您还可以在表达式中包含方法名称，如下所示：

```
Can_AuthenticateUser_With_Bad_Password() 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-01T16:36:42.607

我建议更小、更集中（测试）的课程。

为什么要进行 javadoc 测试？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-01T16:39:35.390

改了怎么办

```
Can_User_Authenticate_With_Bad_Password 
```

到

```
AuthenticateDenieTest
AuthenticateAcceptTest 
```

并命名适合类似的东西`User`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T20:42:09.333

作为一个团队，我们对这样的混合命名模式有何感受

```
/// <summary>
/// Tests for user authentication with a bad password.
/// </summary>
public void AuthenticateUser_Test1_With_Bad_Password()
{
...
} 
```

我们得到了最好的。

# objective-c - 关注 URLConnection 有什么问题？

> ID：706355
> 
> 赞同：2
> 
> 时间：2009-04-01T16:30:55.787
> 
> 标签：objective-c, cocoa, asynchronous, nsurlconnection

### 也可以看看：

> [带有 Cookie 的 Objective-C 异步 Web 请求](https://stackoverflow.com/questions/704985/objective-c-asynchronous-web-request-with-cookies)

我花了一天时间编写这段代码，谁能告诉我这里出了什么问题？

WSHelper 继承自 NSObject，我什至尝试过 NSDocument 和 NSObjectController 等等。

```
-(void) loadUrl: (NSString*) urlStr{
    url = [[NSURL alloc] initWithString:urlStr];
    request = [NSURLRequest requestWithURL:url cachePolicy: NSURLRequestReloadIgnoringCacheData timeoutInterval: 60.0];
    connection = [[NSURLConnection alloc] initWithRequest:request delegate:self startImmediately:YES];
    if(connection)
    {
        receivedData = [[NSMutableData data] retain];
            //[connection start];
    }
    else
    {       display error etc...   }
    NSApplication * app = [NSApplication sharedApplication];
    [app runModalForWindow: waitWindow];// <-- this is the problem...
}

-(void)connection: (NSURLConnection*)connection didReceiveData:(NSData*)data{
    progressText = @"Receiving Data...";
    [receivedData appendData:data];
}

-(void)connection: (NSURLConnection *)connection didFailWithError:(NSError *)error{
    progressText = @"Error...";
    NSAlert * alert = [[NSAlert alloc] init];
    [alert setMessageText:[error localizedDescription]];
    [alert runModal];
}

- (void)connectionDidFinishLoading:(NSURLConnection *)connection{
    progressText = @"Done...";
    pData = [[NSData alloc] initWithData:receivedData];
    [self hideWindow];
} 
```

代码不会做任何事情，它根本没有进展。我什至尝试使用/不使用 startImmediately:YES 但没有运气!!!，这是在主窗口中执行的，因此即使线程及其运行循环也成功运行。

我尝试调用同步请求，它工作正常！但我需要异步解决方案。

我已经在项目中添加了 CoreServices.Framework，还有什么我应该添加到项目中的吗？任何编译器设置？还是我必须先初始化任何东西才能使用 NSURLConnection？

任何在其自己的 NSRunLoop、Objective-C 和 MAC 开发上的不同线程上运行 NSURLConnection 的解决方案在文档中的任何地方都没有示例代码，这使得一切都变得如此难以编码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-04-24T05:24:22.300

我也遇到了在模态窗口中使用 NSURLConnection 时没有调用委托方法的问题。

经过一番调查，下面的代码解决了它。

```
NSURLConnection* conn = [[NSURLConnection alloc] initWithRequest:requst delegate:self startImmediately:NO];
[conn scheduleRunLoop:[NSRunLoop currentRunLoop] forMode:NSModalPanelRunLoopMode];
[conn start]; 
```

但是，当调用 connectionDidFinishLoading 时，[NSApp stopModal] 不起作用，需要调用 [NSApp abortModal] 来代替。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-02T14:07:57.633

首先，您使启动连接过于复杂。改成：

```
connection = [[NSURLConnection alloc] initWithRequest:request delegate:self] 
```

删除`[connection start]`. 现在：

*   您的应用程序确定正常运行运行循环吗？NSURLConnection 需要这个才能工作。
*   您是否能够执行 URL 请求的同步加载？
*   在调试器中，您能看到这`url`是您所期望的吗？它是什么？
*   您是否有可能在收到任何委托消息之前释放 WSHelper？NSURLConnection 毕竟是异步的。

使用 NSURLConnection 不需要做任何特别的事情，它是 Foundation 框架的一个简单部分。不需要特殊的编译器设置。使用前无需初始化。没有。请不要开始盲目尝试引入 CoreServices.Framework 之类的东西。

由于同步发送请求是可行的，因此您对异步方面的处理一定有问题。它可能是：

*   runloop 未运行，`NSDefaultRunLoopMode`因此连接无法自行安排。
*   您的代码的其他一些部分`-cancel`在连接有机会加载之前调用它。
*   您正在设法在连接有机会加载之前解除分配。

## 真正的问题

啊，事实上我刚刚意识到发生了什么。您正在调用：

```
-[NSApp runModalForWindow:] 
```

**阅读有关此方法作用的说明**。`NSURLConnection`它没有像预期的那样运行运行循环。我想说的是，你真的不想在运行 URL 连接时呈现一个非常像这样的窗口。

我还建议您也实现`-connection:didReceiveResponse:`委托方法。您想在此处检查服务器是否正在返回预期的状态代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-02T20:38:43.087

你说你在模态对话框中使用它？模态对话框将运行循环置于不同的模式。除了正常的运行循环模式之外，您应该能够通过安排它在模式对话框运行循环模式下运行来使其工作。`connection`分配后尝试添加这行代码`loadURL:`

```
[connection scheduleInRunLoop:[NSRunLoop currentRunLoop] forMode:NSModalPanelRunLoopMode]; 
```

希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:47:21.097

你怎么知道它什么都没做？编译过程中是否有任何错误或警告消息？程序运行时控制台上是否显示任何错误消息？

您是否尝试过在代码中设置断点并遵循您期望发生的事情？

# mysql - 了解 Plesk 看门狗统计信息

> ID：706357
> 
> 赞同：0
> 
> 时间：2009-04-01T16:30:59.233
> 
> 标签：mysql, apache, plesk

我们已经安装了 Plesk 8.3。我已经开始使用他们的看门狗模块来跟踪服务器使用情况。我们的服务器经常遇到流量问题，我认为我们的 MySQL 查询需要更智能。不管怎样，从看门狗的统计数据来看，MySQL 的使用率似乎低于其他构成“整体”使用率的东西。看到这个：

[http://weotch.com/emails/plesk.png](http://weotch.com/emails/plesk.png)

我希望有很多 Plesk 经验的人可以帮助我理解我在这里看到的内容。我可以不相信 Watchdog 的报告还是我遗漏了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T16:54:19.053

看起来肯定有其他东西正在消耗您的资源。我对 Plesk 不是很熟悉，但是您可以通过运行“top”命令并查找使用大量 RAM 或 CPU 的进程来大致了解正在发生的事情（我假设您有一个 Linux 服务器和命令行访问）。

# .net - .NET：如何将 Windows 窗体转换为 Windows 控件

> ID：706358
> 
> 赞同：24
> 
> 时间：2009-04-01T16:31:03.197
> 
> 标签：.net, winforms, visual-studio-2008

我有一个 .NET 3.5 windows 窗体，我想将它嵌入到另一个窗体中。有没有一种快速的方法可以将该表单转换为控件？

谢谢

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-01T16:33:17.950

将表单更改为从 UserControl 继承而不是 Form，然后修复任何编译错误。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-01T19:42:55.653

还有一种方法可以在控件中嵌入表单：这是 VB 中的代码：

```
Public Shared Sub ShowFormInControl(ByRef ctl As Control, ByRef frm As Form)
    If ctl IsNot Nothing AndAlso frm IsNot Nothing Then
        frm.TopLevel = False
        frm.FormBorderStyle = FormBorderStyle.None
        frm.Dock = DockStyle.Fill
        frm.Visible = True
        ctl.Controls.Add(frm)
    End If
End Sub 
```

我想我是从 SO 上的另一篇文章中获得此代码的，但我不记得在哪里，如果这是您的代码片段，请见谅！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-07T13:44:15.007

我使用了@Neil Barnwell 的解决方案，并添加了一些内容。我手动编辑了 .vbprog 文件并将表单的“SubType”更改为“UserControl”：

```
<SubType>UserControl</SubType> 
```

这允许项目资源管理器中的图标显示为用户控件，而不是表单。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-06-24T17:51:12.050

并不是说您现在应该这样做，但将来您可以看看[MEF](http://www.codeplex.com/MEF)。它是一个（除其他外）构建复合应用程序的框架，听起来可能是您想要实现的目标。

# iphone - 如何让 UIImageView 以编程方式更改其图像？

> ID：706360
> 
> 赞同：5
> 
> 时间：2009-04-01T16:31:54.130
> 
> 标签：iphone, uiimageview

我有这个代码：

```
- (void)viewDidLoad {
[super viewDidLoad];
landscape.image = [UIImage imageNamed:@"tenerife1.png"];
} 
```

首先，我创建了一个`UIImageView`with `IBOutlet`。山水就是指着那个`UIImageView`。在`InterfaceBuilder`我告诉在那个中显示一个特定的图像`UIImageView`。它永远不会改变。我总是看到我在 中指定的图像`InterfaceBuilder`。但我想以编程方式设置它。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T16:58:31.507

更改图像后尝试在视图上调用 setNeedsDisplay：

```
 [landscape setNeedsDisplay]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T06:31:05.863

添加此代码，它可能会对您有所帮助：

```
-(void)viewDidAppear:(BOOL)animated 
{
landscape.image = [UIImage imageNamed:@"tenerife1.png"];
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-27T01:08:13.890

您是否可能没有为该 nib 文件设置自定义视图？我有同样的问题。我为该视图控制器创建了一个 UIview 子类，进入 Interface Builder 并将视图设置为该 UIView 子类，然后将 UIView 的导入标头添加到 Controller 类中。这就是为我做的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-10T15:30:13.193

不要忘记在 InterfaceBuilder 中 imageview 和 File's Owner 之间的连接。

之后只有你需要：

```
landscape.image = [UIImage imageNamed:@"tenerife1.png"]; 
```

# c# - 从 C# 中的存储过程中获取返回值

> ID：706361
> 
> 赞同：74
> 
> 时间：2009-04-01T16:31:55.533
> 
> 标签：c#, sql, sql-server

我有以下查询：

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go

ALTER PROCEDURE [dbo].[Validate]
@a varchar(50),
@b varchar(50) output

AS

SET @Password = 
(SELECT Password
FROM dbo.tblUser
WHERE Login = @a)

RETURN @b
GO 
```

这编译得很好。我想执行这个查询并获取返回值。我的代码如下：

```
 SqlConnection SqlConn = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["MyLocalSQLServer"].ConnectionString.ToString());
        System.Data.SqlClient.SqlCommand sqlcomm = new System.Data.SqlClient.SqlCommand("Validate", SqlConn);

        string returnValue = string.Empty;

        try
        {
            SqlConn.Open();
            sqlcomm.CommandType = CommandType.StoredProcedure;

            SqlParameter param = new SqlParameter("@a", SqlDbType.VarChar);
            param.Direction = ParameterDirection.Input;
            param.Value = Username;
            sqlcomm.Parameters.Add(param);

            SqlParameter retval = sqlcomm.Parameters.Add("@b", SqlDbType.VarChar);
            retval.Direction = ParameterDirection.ReturnValue;

            string retunvalue = (string)sqlcomm.Parameters["@b"].Value; 
```

注意：异常处理减少以保持代码简短。每次我到达最后一行时，都会返回 null。这段代码有什么逻辑错误？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-04-01T16:40:21.473

Mehrdad 提出了一些很好的观点，但我注意到的主要一点是你*从不运行查询*......

```
SqlParameter retval = sqlcomm.Parameters.Add("@b", SqlDbType.VarChar);
retval.Direction = ParameterDirection.ReturnValue;
sqlcomm.ExecuteNonQuery(); // MISSING
string retunvalue = (string)sqlcomm.Parameters["@b"].Value; 
```

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2009-04-01T16:32:49.603

```
retval.Direction = ParameterDirection.Output; 
```

`ParameterDirection.ReturnValue`应该用于程序的“返回值”，而不是输出参数。它获取 SQL 语句返回的值`RETURN`（带有名为 的参数`@RETURN_VALUE`）。

而不是`RETURN @b`你应该`SET @b = something`

顺便说一句，返回值参数始终是`int`，而不是字符串。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-01T16:48:29.800

我在返回值方面遇到了很多麻烦，所以最后我只是选择了一些东西。

解决方案只是在最后选择结果并在您的函数中返回查询结果。

就我而言，我正在执行存在检查：

```
IF (EXISTS (SELECT RoleName FROM dbo.Roles WHERE @RoleName = RoleName)) 
    SELECT 1
ELSE
    SELECT 0 
```

然后

```
using (SqlConnection cnn = new SqlConnection(ConnectionString))
{
    SqlCommand cmd = cnn.CreateCommand();
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.CommandText = "RoleExists";
    return (int) cmd.ExecuteScalar()
} 
```

您应该能够使用字符串值而不是 int 来做同样的事情。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-12-16T13:22:36.070

这是建立在[Joel](https://stackoverflow.com/a/706399/241211)和[Mehrdad 的](https://stackoverflow.com/a/706363/241211)答案之上的：你永远不会将参数绑定`retval`到`sqlcommand`. 你需要一个

```
sqlcomm.Parameters.Add(retval); 
```

并确保您正在运行命令

```
sqlcomm.ExecuteNonQuery(); 
```

我也不确定为什么你有 2 个返回值字符串（`returnValue`和`retunvalue`）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-01T16:42:09.753

你说你的 SQL 编译得很好，但我得到：必须声明标量变量“@Password”。

您还试图从存储过程中返回一个 varchar (@b)，但 SQL Server 存储过程只能返回整数。

当您运行该过程时，您将收到错误：

'将 varchar 值 'x' 转换为数据类型 int 时转换失败。'

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-02-09T11:32:51.873

这里有多个问题：

1.  这不可能。您正在尝试返回一个 varchar。存储过程返回值只能是整数表达式。请参阅官方 RETURN 文档： [https](https://msdn.microsoft.com/en-us/library/ms174998.aspx) ://msdn.microsoft.com/en-us/library/ms174998.aspx 。
2.  你`sqlcomm`的从未被处决。您必须调用 `sqlcomm.ExecuteNonQuery();`才能执行您的命令。

* * *

这是使用 OUTPUT 参数的解决方案。对此进行了测试：

*   视窗服务器 2012
*   .NET v4.0.30319
*   C# 4.0

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[Validate]
    @a varchar(50),
    @b varchar(50) OUTPUT
AS
BEGIN
    DECLARE @b AS varchar(50) = (SELECT Password FROM dbo.tblUser WHERE Login = @a)
    SELECT @b;
END 
```

```
SqlConnection SqlConn = ...
var sqlcomm = new SqlCommand("Validate", SqlConn);

string returnValue = string.Empty;

try
{
    SqlConn.Open();
    sqlcomm.CommandType = CommandType.StoredProcedure;

    SqlParameter param = new SqlParameter("@a", SqlDbType.VarChar);
    param.Direction = ParameterDirection.Input;
    param.Value = Username;
    sqlcomm.Parameters.Add(param);

    SqlParameter output = sqlcomm.Parameters.Add("@b", SqlDbType.VarChar);
    ouput.Direction = ParameterDirection.Output;

    sqlcomm.ExecuteNonQuery(); // This line was missing

    returnValue = output.Value.ToString();

    // ... the rest of code

} catch (SqlException ex) {
    throw ex;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-12-28T10:28:17.080

当我们从没有选择语句的存储过程中返回一个值时。我们需要使用“ParameterDirection.ReturnValue”和“ExecuteScalar”命令来获取值。

```
CREATE PROCEDURE IsEmailExists
    @Email NVARCHAR(20)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    -- Insert statements for procedure here
    IF EXISTS(SELECT Email FROM Users where Email = @Email)
    BEGIN
        RETURN 0 
    END
    ELSE
    BEGIN
        RETURN 1
    END
END 
```

**在 C# 中**

```
GetOutputParaByCommand("IsEmailExists")

public int GetOutputParaByCommand(string Command)
        {
            object identity = 0;
            try
            {
                mobj_SqlCommand.CommandText = Command;
                SqlParameter SQP = new SqlParameter("returnVal", SqlDbType.Int);
                SQP.Direction = ParameterDirection.ReturnValue;
                mobj_SqlCommand.Parameters.Add(SQP);
                mobj_SqlCommand.Connection = mobj_SqlConnection;
                mobj_SqlCommand.ExecuteScalar();
                identity = Convert.ToInt32(SQP.Value);
                CloseConnection();
            }
            catch (Exception ex)
            {

                CloseConnection();
            }
            return Convert.ToInt32(identity);
        } 
```

我们使用上面的c#函数得到SP“IsEmailExists”的返回值。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-01T16:44:22.230

这个SP看起来很奇怪。它不会修改传递给@b 的内容。在 SP 中没有任何地方可以为 @b 分配任何东西。并且@Password 没有定义，所以这个SP 根本不起作用。

我猜你实际上想要返回@Password，或者让 SET @b = (SELECT...)

如果您将 SP 修改为（注意，没有 OUTPUT 参数），则简单得多：

```
set ANSI_NULLS ON set QUOTED_IDENTIFIER ON go

ALTER PROCEDURE [dbo].[Validate] @a varchar(50)

AS

SELECT TOP 1 Password FROM dbo.tblUser WHERE Login = @a 
```

然后，您的代码可以使用 cmd.ExecuteScalar，并接收结果。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-06-09T19:50:02.553

有两件事要解决这个问题。首先设置存储过程以将值存储在输出（而不是返回）参数中。

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go

ALTER PROCEDURE [dbo].[Validate]
@a varchar(50),
@b varchar(50) output

AS

SET @b = 
(SELECT Password
FROM dbo.tblUser
WHERE Login = @a)

RETURN
GO 
```

这会将密码输入@b，您将获得它作为返回参数。然后在你的 C# 中得到它：

```
SqlConnection SqlConn = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["MyLocalSQLServer"].ConnectionString.ToString());
    System.Data.SqlClient.SqlCommand sqlcomm = new System.Data.SqlClient.SqlCommand("Validate", SqlConn);

    string returnValue = string.Empty;

    try
    {
        SqlConn.Open();
        sqlcomm.CommandType = CommandType.StoredProcedure;

        SqlParameter param = new SqlParameter("@a", SqlDbType.VarChar, 50);
        param.Direction = ParameterDirection.Input;
        param.Value = Username;
        sqlcomm.Parameters.Add(param);

        SqlParameter retval = new SqlParameter("@b", SqlDbType.VarChar, 50);
        retval.Direction = ParameterDirection.ReturnValue;
        sqlcomm.Parameters.Add(retval);

        sqlcomm.ExecuteNonQuery();
        SqlConn.Close();

        string retunvalue = retval.Value.ToString();
     } 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-04-01T09:36:54.893

可能这会有所帮助。

数据库脚本：

```
USE [edata]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[InsertNewUser](
 @neuname NVARCHAR(255),
 @neupassword NVARCHAR(255),
 @neuposition NVARCHAR(255)
 )

AS

BEGIN 

BEGIN TRY

 DECLARE @check INT;

 SET @check = (SELECT count(eid) FROM eusers WHERE euname = @neuname);

IF(@check = 0)

INSERT INTO  eusers(euname,eupassword,eposition)
VALUES(@neuname,@neupassword,@neuposition);

DECLARE @lastid INT;

SET @lastid = @@IDENTITY;

RETURN @lastid;

END TRY

BEGIN CATCH

SELECT ERROR_LINE() as errline,
       ERROR_MESSAGE() as errmessage,
       ERROR_SEVERITY() as errsevirity

END CATCH

END 
```

应用程序配置文件：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>

  <appSettings>
    <add key="conStr" value="Data Source=User\SQLEXPRESS;Initial Catalog=edata;Integrated Security=True"/>
  </appSettings>
</configuration> 
```

数据访问层 (DAL)：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Configuration;
using System.Data;
using System.Data.SqlClient;
namespace DAL
{
    public static class DAL
    {
        public static SqlConnection conn;

        static DAL()
        {

            conn = new SqlConnection(ConfigurationManager.AppSettings["conStr"].ToString());
            conn.Open();

        }

    }
} 
```

业务逻辑层（BLL）：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Data;
using System.Data.SqlClient;
using DAL;
namespace BLL
{
    public static class BLL
    {

        public static int InsertUser(string lastid, params SqlParameter[] coll)
        {

            int lastInserted = 0;

            try
            {

                SqlCommand comm = new SqlCommand();

                comm.Connection = DAL.DAL.conn;

                foreach (var param in coll)
                {

                    comm.Parameters.Add(param);

                }

                SqlParameter lastID = new SqlParameter();
                lastID.ParameterName = lastid;
                lastID.SqlDbType = SqlDbType.Int;
                lastID.Direction = ParameterDirection.ReturnValue;

                comm.Parameters.Add(lastID);

                comm.CommandType = CommandType.StoredProcedure;

                comm.CommandText = "InsertNewUser";

                comm.ExecuteNonQuery();

                lastInserted = (int)comm.Parameters[lastid].Value;

            }

            catch (SqlException ex)
            {

            }

            finally {

                if (DAL.DAL.conn.State != ConnectionState.Closed) {

                    DAL.DAL.conn.Close();
                }

            }           

            return lastInserted;

        }

    }
} 
```

执行 ：

```
BLL.BLL.InsertUser("@lastid",new SqlParameter("neuname","Ded"),
                 new SqlParameter("neupassword","Moro$ilka"),
                 new SqlParameter("neuposition","Moroz")
                 ); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-12-24T07:39:32.473

您混淆了返回值和输出变量的概念。1- 输出变量：

```
Database----->:
create proc MySP
@a varchar(50),
@b varchar(50) output
AS
SET @Password = 
(SELECT Password
FROM dbo.tblUser
WHERE Login = @a)

C# ----->:

SqlConn.Open();
sqlcomm.CommandType = CommandType.StoredProcedure;

SqlParameter param = new SqlParameter("@a", SqlDbType.VarChar);
param.Direction = ParameterDirection.Input;//This is optional because Input is the default

param.Value = Username;
sqlcomm.Parameters.Add(param);

SqlParameter outputval = sqlcomm.Parameters.Add("@b", SqlDbType.VarChar);
outputval .Direction = ParameterDirection.Output//NOT ReturnValue;

string outputvalue = sqlcomm.Parameters["@b"].Value.ToString(); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-04-12T07:10:25.553

假设您需要传递`Username`和`Password`到**存储过程**并知道登录是否成功，并检查**存储过程**中是否发生任何错误。

```
public bool IsLoginSuccess(string userName, string password)
{
    try
    {
        SqlConnection SQLCon = new SqlConnection(WebConfigurationManager.ConnectionStrings["SqlConnector"].ConnectionString);
        SqlCommand sqlcomm = new SqlCommand();
        SQLCon.Open();
        sqlcomm.CommandType = CommandType.StoredProcedure;
        sqlcomm.CommandText = "spLoginCheck"; // Stored Procedure name
        sqlcomm.Parameters.AddWithValue("@Username", userName); // Input parameters
        sqlcomm.Parameters.AddWithValue("@Password", password); // Input parameters

        // Your output parameter in Stored Procedure           
        var returnParam1 = new SqlParameter
        {
            ParameterName = "@LoginStatus",
            Direction = ParameterDirection.Output,
            Size = 1                    
        };
        sqlcomm.Parameters.Add(returnParam1);

        // Your output parameter in Stored Procedure  
        var returnParam2 = new SqlParameter
        {
            ParameterName = "@Error",
            Direction = ParameterDirection.Output,
            Size = 1000                    
        };

        sqlcomm.Parameters.Add(returnParam2);

        sqlcomm.ExecuteNonQuery(); 
        string error = (string)sqlcomm.Parameters["@Error"].Value;
        string retunvalue = (string)sqlcomm.Parameters["@LoginStatus"].Value;                    
    }
    catch (Exception ex)
    {

    }
    return false;
} 
```

您的连接字符串`Web.Config`

```
<connectionStrings>
    <add name="SqlConnector"
         connectionString="data source=.\SQLEXPRESS;Integrated Security=SSPI;Initial Catalog=Databasename;User id=yourusername;Password=yourpassword"
         providerName="System.Data.SqlClient" />
  </connectionStrings> 
```

这是**存储过程**供参考

```
CREATE PROCEDURE spLoginCheck
    @Username Varchar(100),
    @Password Varchar(100) ,
    @LoginStatus char(1) = null output,
    @Error Varchar(1000) output 
AS
BEGIN

    SET NOCOUNT ON;
    BEGIN TRY
        BEGIN

            SET @Error = 'None'
            SET @LoginStatus = ''

            IF EXISTS(SELECT TOP 1 * FROM EMP_MASTER WHERE EMPNAME=@Username AND EMPPASSWORD=@Password)
            BEGIN
                SET @LoginStatus='Y'
            END

            ELSE
            BEGIN
                SET @LoginStatus='N'
            END

        END
    END TRY

    BEGIN CATCH
        BEGIN           
            SET @Error = ERROR_MESSAGE()
        END
    END CATCH
END
GO 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-05-31T19:42:00.447

当你使用

```
cmd.Parameters.Add("@RETURN_VALUE", SqlDbType.Int).Direction = ParameterDirection.ReturnValue; 
```

然后，您必须确保您的存储过程具有

```
return @RETURN_VALUE; 
```

在存储过程结束时。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-08-17T13:54:39.583

您尝试获取的值不是返回值，而是输出参数。您需要将参数方向更改为输出。

```
SqlParameter retval = sqlcomm.Parameters.Add("@b", SqlDbType.VarChar);
retval.Direction = ParameterDirection.Output;
command.ExecuteNonquery();
string retunvalue = (string)sqlcomm.Parameters["@b"].Value; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-09-10T19:02:51.367

**对于 .net core 3.0 和 dapper：**

如果您的存储过程返回此：

```
select ID, FILE_NAME from dbo.FileStorage where ID = (select max(ID) from dbo.FileStorage); 
```

然后在c#中：

```
 var data = (_dbConnection.Query<FileUploadQueryResponse>
              ("dbo.insertFile", whateverParameters, commandType: CommandType.StoredProcedure)).ToList();
 var storedFileName = data[0].FILE_NAME;
 var id = data[0].ID; 
```

如您所见，您可以定义一个简单的类来帮助从 dapper 的默认返回结构（我发现无法使用）中检索实际值：

```
public class FileUploadQueryResponse
  {
    public string ID { get; set; }
    public string FILE_NAME { get; set; }
  } 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2018-11-28T05:38:20.993

这行代码从 SQL Server 返回 Store StoredProcedure 返回值

```
cmd.Parameters.Add("@id", System.Data.SqlDbType.Int).Direction = System.Data.ParameterDirection.ReturnValue;                
cmd.ExecuteNonQuery(); 
```

Atfer 执行查询值将从 SP 返回

```
id = (int)cmd.Parameters["@id"].Value; 
```

# postgresql - PostgreSQL - 如何检查我的数据是否包含反斜杠

> ID：706364
> 
> 赞同：3
> 
> 时间：2009-04-01T16:33:16.640
> 
> 标签：postgresql, backslash

SELECT count(*) FROM table WHERE column ilike '%/%';

给我包含“/”的值的数量

如何为“\”做同样的事情？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T16:39:03.177

```
SELECT  count(*)
FROM    table
WHERE   column ILIKE '%\\\\%'; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-01T16:37:02.137

[文档](http://www.postgresql.org/docs/current/static/functions-matching.html#FUNCTIONS-LIKE)摘录：

> 请注意，反斜杠在字符串文字中已经具有特殊含义，因此要编写包含反斜杠的模式常量，您必须在 SQL 语句中编写两个反斜杠（假设使用转义字符串语法，请参阅第 4.1.2.1 节）。因此，编写一个实际匹配文字反斜杠的模式意味着在语句中编写四个反斜杠。您可以通过使用 ESCAPE 选择不同的转义字符来避免这种情况；那么反斜杠对于 LIKE 来说不再是特殊的了。（但它对于字符串文字解析器仍然很特殊，因此您仍然需要其中两个。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T18:34:00.267

更好的是 - 不要使用 like，只需使用标准位置：

```
select count(*)  from table where 0 < position( E'\\' in column ); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-07-09T08:21:39.633

我在 12.5 上发现我不需要转义字符

```
# select * from t;
  x  
-----
 a/b
 c\d
(2 rows)

# select count(*) from t where 0 < position('/' in x);
 count 
-------
     1
(1 row)

# select count(*) from t where 0 < position('\' in x);
 count 
-------
     1
(1 row) 
```

而在 9.6 上我做到了。

有点奇怪，但你去。有用的是，

```
position(E'/' in x) 
```

在两个版本上都工作过。你需要小心 - E'//' 似乎工作（即解析）但实际上并没有找到斜线。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T16:53:09.073

您需要`E'\\\\'`，因为 to 的参数`LIKE`是一个正则表达式，并且正则表达式转义字符已经存在`\`（例如`~ E'\\w'`，将匹配任何包含可打印字符的字符串）。

查看[文档](http://www.postgresql.org/docs/8.3/interactive/sql-syntax-lexical.html#SQL-SYNTAX-STRINGS)

# iphone - 这样的图像分配会导致内存泄漏吗？

> ID：706367
> 
> 赞同：1
> 
> 时间：2009-04-01T16:33:22.910
> 
> 标签：iphone, memory, memory-management, memory-leaks

```
- (void)viewDidLoad {
    [super viewDidLoad];
    landscape.image = [UIImage imageNamed:@"tenerife1.png"];
} 
```

`UIImage`我为对象的图像属性分配了一个新`UIImageView`值。我不确定这是否会导致内存泄漏？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T16:37:39.967

不，不应该。设置新的时候应该自动释放旧图像，并且“imageNamed”方法使用自动释放，所以你应该没问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-01T16:53:19.243

嘿，考虑到 imageNamed 存在严重的内存问题，因为您失去了对其缓存的控制 - 即：一旦您完成了图像，您就无法回收该内存。一个快速的谷歌搜索会让你知道有多少人遇到了 imageNamed 的问题

我参加了苹果 iphone 技术讲座，演讲的那个人也证实了同样的事情——他建议使用 imageWithContentsOfFile 而不是 imageNamed

如果你只有几个小图像，它很好，否则使用 imageWithContentsOfFile 即使它有点慢 - 并实现你自己的缓存逻辑 - 检查这个伟大的链接如何在[这里做](http://www.alexcurylo.com/blog/2009/01/13/imagenamed-is-evil/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T16:41:04.420

这取决于如何`image`定义属性。如果它被定义为`retain`or，我想，甚至`copy`，它应该没问题。如果它被定义为`assign`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T16:52:16.343

通常情况下，但这取决于您如何定义landscape.image。见上面的帖子。小心使用其中的很多：

```
[UIImage imageNamed:@"tenerife1.png"]; 
```

由于这些图像倾向于填满内存，而不会被释放。

# cocoa - 如何在 iPhone 上进行 http get in cocoa

> ID：706369
> 
> 赞同：6
> 
> 时间：2009-04-01T16:33:59.023
> 
> 标签：cocoa, http, get

任何人都可以粘贴一些关于如何在可可中进行简单的http获取的代码吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-01T16:48:15.683

干得好！

这个从网络服务器抓取图像。

```
 NSURL *url = [ NSURL URLWithString: [ NSString stringWithFormat:@"http://www.somewebsite.com/demo.png"] ]; 
    image = [ [ UIImage alloc ] initWithData: [ NSData dataWithContentsOfURL: url ] ]; 
```

或者，这个抓取网页...

```
 NSURL *url = [ NSURL URLWithString:[ NSString stringWithFormat: @"http://www.google.com/search?q=%@", query ] ];
    NSURLRequest *request = [ NSURLRequest requestWithURL: url ]; 
```

要异步执行此操作，您应该查看[NSURLConnection](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html#//apple_ref/doc/uid/20001836-BAJEAIEE)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T16:39:10.073

看看`NSURLConnection`。您可以使用它同步或（最好）异步请求 URL。URL 系统的完整文档在这里：

[http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html)

但你真正想要的是：

[http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html#//apple_ref/doc/uid/20001836-BAJEAIEE](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html#//apple_ref/doc/uid/20001836-BAJEAIEE)

Apple 提供了一些示例代码，可以帮助您入门。

# java - 如何让 dbunit 与 MySQL 枚举数据类型配合使用？

> ID：706371
> 
> 赞同：1
> 
> 时间：2009-04-01T16:34:44.560
> 
> 标签：java, mysql, dbunit

我正在尝试使用[dbunit](http://www.dbunit.org/)测试我们的一些数据库访问代码，但遇到了问题。我们使用[MySQL 5](http://www.mysql.com/)或其他东西作为数据库本身。我将一小组数据导出到[FlatXmlDataSet](http://www.dbunit.org/apidocs/org/dbunit/dataset/xml/FlatXmlDataSet.html)，当我设置测试用例时，它会抛出一个异常，上面写着“第 1 行的列 'FHEIGHT_FLAG' 的数据被截断”。FHEIGHT_FLAG 列定义为

```
enum('t','f') default NULL 
```

[枚举](http://dev.mysql.com/doc/refman/5.0/en/enum.html)数据插入数据库的方式，如果数据源的真实值不为真，那么该列实际上包含“”（空字符串）。使用数据库的代码只是假设如果从数据库提供的值不是't'，那么它一定是假的。我怎样才能做到这一点？我无法修复源数据，所以我必须尝试对测试用例做一些事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-02T08:33:43.850

导出一个新数据集，使用`"select case when FHEIGHT_FLAG = 't' then 't' else 'f' end as FHEIGHT_FLAG, ....(all other columns) .... from tablename";`

（当然，按照它们在真实表中的顺序排列列。）

```
final String select = "select case when FHEIGHT_FLAG = 't' then 't' else 'f' end as FHEIGHT_FLAG, ....(all other columns) .... from tablename";
// database connection
Class driverClass = Class.forName("package.of.jdbcDriver");
Connection jdbcConnection = DriverManager.getConnection(
        "jdbc:url:of:db", "user", "pass");
IDatabaseConnection connection = new DatabaseConnection(jdbcConnection);

// partial database export
QueryDataSet partialDataSet = new QueryDataSet(connection);
partialDataSet.addTable("Tablename", select);

FlatXmlDataSet.write(partialDataSet, new FileOutputStream("mydataset.xml")); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T13:46:09.967

我最终将测试数据库 FHEIGHT_FLAG 列修改为

```
enum('','t','f') default NULL 
```

这样所有的空字符串值都被允许插入回来。

# string - VB.NET 中的多行字符串

> ID：706382
> 
> 赞同：153
> 
> 时间：2009-04-01T16:36:48.567
> 
> 标签：string, vb.net

有没有办法像 Python 一样在 VB.NET 中使用多行字符串

```
a = """
multi
line
string
""" 
```

还是 PHP？

```
$a = <<<END
multi
line
string
END; 
```

当然不是

```
"multi" & _
"line 
```

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2009-11-04T15:14:04.773

您可以使用**[XML Literals](https://msdn.microsoft.com/en-us/library/bb384629.aspx)**来实现类似的效果：

```
Imports System.XML
Imports System.XML.Linq
Imports System.Core

Dim s As String = <a>Hello
World</a>.Value 
```

请记住，如果您有特殊字符，则应使用 CDATA 块：

```
Dim s As String = <![CDATA[Hello
World & Space]]>.Value 
```

* * *

## 2015 年更新：

**Visual Basic 14**（在**Visual Studio 2015**中）中引入了多行字符串文字。上面的例子现在可以写成：

```
Dim s As String = "Hello
World & Space" 
```

~~`MSDN article isn't updated yet (as of 2015-08-01), so check some answers below for details.`~~

详细信息已添加到[Roslyn *New-Language-Features-in-VB-14*](https://github.com/dotnet/roslyn/wiki/New-Language-Features-in-VB-14#multiline-string-literals) Github 存储库。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-04-01T18:59:09.347

VB.Net 没有这样的功能，它**不会**出现在 Visual Studio 2010 中。jirwin 所指的功能称为隐式行延续。它与从多行语句或表达式中删除 _ 有关。这确实消除了用 _ 终止多行字符串的需要，但 VB 中仍然没有多行字符串文字。

多行字符串示例

视觉工作室 2008

```
Dim x = "line1" & vbCrlf & _
        "line2" 
```

视觉工作室 2010

```
Dim x = "line1" & vbCrlf & 
        "line2" 
```

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2012-02-28T12:23:14.713

我使用了这个变体：

```
 Dim query As String = <![CDATA[
        SELECT 
            a.QuestionID
        FROM 
            CR_Answers a

        INNER JOIN 
            CR_Class c ON c.ClassID = a.ClassID
        INNER JOIN
            CR_Questions q ON q.QuestionID = a.QuestionID
        WHERE 
            a.CourseID = 1
        AND 
            c.ActionPlan = 1
        AND q.Q_Year = '11/12'
        AND q.Q_Term <= (SELECT CurrentTerm FROM CR_Current_Term)
    ]]>.Value() 
```

它允许 < > 在字符串中

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2013-08-29T15:07:03.697

### 从 Visual Studio 2015 开始提供多行字符串。

```
Dim sql As String = "
    SELECT ID, Description
    FROM inventory
    ORDER BY DateAdded
" 
```

您可以将它们与**字符串插值**相结合，以最大限度地提高实用性：

```
Dim primaryKey As String = "ID"
Dim inventoryTable As String = "inventory"

Dim sql As String = $"
    SELECT {primaryKey}, Description
    FROM {inventoryTable}
    ORDER BY DateAdded
" 
```

请注意，插值字符串以 开头，`$`您需要注意`"`,`{`并`}`包含在其中 - 将它们分别转换为`""`,`{{`或`}}`。

在这里，您可以看到上述代码示例的插值部分的实际**语法突出显示：**

[![在此处输入图像描述](https://i.stack.imgur.com/p28gu.png)](https://i.stack.imgur.com/p28gu.png)

如果您想知道 Visual Studio 编辑器对它们的识别是否也适用于重构（例如批量重命名变量），那么您是对的，**代码重构适用于这些。**更不用说它们还支持 IntelliSense、引用计数或代码分析。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2014-11-26T21:06:12.543

Visual Basic 14.0 中引入了多行字符串文字 - [https://roslyn.codeplex.com/discussions/57188 ​​4](https://roslyn.codeplex.com/discussions/571884)

您可以在 VS2015 预览版中使用，现在发布 - [http://www.visualstudio.com/en-us/downloads/visual-studio-2015-downloads-vs](http://www.visualstudio.com/en-us/downloads/visual-studio-2015-downloads-vs)（请注意，即使针对较旧的版本，您仍然可以使用 VS2015 .NET 框架的版本）

```
Dim multiline = "multi
line
string" 
```

VB 字符串现在基本上与 C# 逐字字符串相同 - 它们不支持像 \n 这样的反斜杠转义序列，并且它们允许字符串中包含换行符，并且您可以使用双引号 "" 转义引号符号

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-06-07T19:17:57.527

这对我来说是一篇非常有用的文章，但没有人提到如何**连接**以防你想发送一些变量，这是你 99% 的时间需要做的。

... **<%=**变量**%>** ...

这是你如何做到的：

`<SQL> SELECT * FROM MyTable WHERE FirstName='<%= EnteredName %>' </SQL>.Value`

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-10-28T17:42:30.563

好吧，既然你似乎在你的 python 上，我可以建议你将你的文本复制到 python 中，比如：

```
 s="""this is gonna 
last quite a 
few lines""" 
```

然后做一个：

```
 for i in s.split('\n'):
    print 'mySB.AppendLine("%s")' % i

#    mySB.AppendLine("this is gonna")
#    mySB.AppendLine("last quite a")
#    mySB.AppendLine("few lines") 
```

或者

```
 print ' & _ \n'.join(map(lambda s: '"%s"' % s, s.split('\n')))

#    "this is gonna" & _ 
#    "last quite a" & _ 
#    "few lines" 
```

那么至少您可以将其复制出来并将其放入您的VB代码中。如果您绑定热键（最快获得：[Autohotkey](http://www.autohotkey.com/)）为粘贴缓冲区中的任何内容执行此操作，则会获得奖励积分。同样的想法也适用于 SQL 格式化程序。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2012-06-11T02:05:31.770

vb.net 中使用 XElement 类的多行字符串文字。

```
Imports System.Xml.Linq

Public Sub Test()

dim sOderBy as string = ""

dim xe as XElement = <SQL>
                SELECT * FROM <%= sTableName %>
                 <ORDER_BY> ORDER BY <%= sOrderBy %></ORDER_BY>
                 </SQL>

'** conditionally remove a section 
if sOrderBy.Length = 0 then xe.<ORDER BY>.Remove

'** convert XElement value to a string 
dim sSQL as String = xe.Value

End Sub 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2011-12-13T23:20:43.387

对我来说，这是 VB 作为一门语言最烦人的地方。说真的，我曾经将字符串写在一个文件中，并编写了如下代码：

```
Dim s as String = file_get_contents("filename.txt") 
```

如果需要，我可以直接在 SQL 服务器上测试查询。

我目前的方法是在 SQL Server 上使用存储过程，然后调用它，这样我就可以将参数传递给查询等

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-06-06T17:34:11.653

我想出了如何将 <![CDATA[ 与 <%= 一起用于变量，这使您可以放心编码。

您基本上必须在 VB 变量之前终止 CDATA 标记，然后在之后重新添加它，这样 CDATA 就不会捕获 VB 代码。您需要将整个代码块包装在标签中，因为您将拥有多个 CDATA 块。

```
Dim script As String = <code><![CDATA[
  <script type="text/javascript">
    var URL = ']]><%= domain %><![CDATA[/mypage.html';
  </script>]]>
</code>.value 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-01-17T16:40:35.287

您可以（应该？）将字符串放入资源文件（例如“我的项目”/Resources）中，然后使用

```
 Dim a = My.Resources.Whatever_you_chose 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2012-04-18T15:48:18.917

免责声明：我喜欢蟒蛇。它的多行字符串只是原因之一。

但我也做 VB.Net，所以这是我的更易读的长字符串的捷径。

```
 Dim lines As String() = {
    "Line 1",
    "Line 2",
    "Line 3"
  }
  Dim s As String = Join(lines, vbCrLf) 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-12-14T09:09:39.637

您可以为此使用 XML

```
dim vrstr as string = <s>
    some words
    some words
    some
    words
</s> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-01-30T09:05:07.050

在 Visual Studio 2010（VB NET）中，我尝试以下并正常工作

```
Dim HtmlSample As String = <anything>what ever you want to type here with multiline strings</anything>

dim Test1 as string =<a>onother multiline example</a> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-10-09T13:41:29.413

在 Visual Basic 14 中作为 Visual Studio 2015 的一部分提供 [https://msdn.microsoft.com/en-us/magazine/dn890368.aspx](https://msdn.microsoft.com/en-us/magazine/dn890368.aspx)

但 R# 尚不支持。好消息是他们很快就会得到支持！请在[Youtrack](https://youtrack.jetbrains.com/issue/RSRP-442744)上投票以通知 JetBrains 您也需要它们。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-03-03T20:20:44.443

如果您需要 VB.Net 中带有行代码变量的 XML 文字，您可以这样做：

```
<Tag><%= New XCData(T.Property) %></Tag> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-04-20T07:29:43.523

您也可以通过`System.Text.StringBuilder`这种方式使用类：

```
Dim sValue As New System.Text.StringBuilder
sValue.AppendLine("1st Line")
sValue.AppendLine("2nd Line")
sValue.AppendLine("3rd Line") 
```

然后你得到多行字符串使用：

```
sValue.ToString() 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2015-07-20T15:42:56.247

由于这是一个可读性问题，我使用了以下代码：

```
MySql = ""
MySql = MySql & "SELECT myTable.id"
MySql = MySql & " FROM myTable"
MySql = MySql & " WHERE myTable.id_equipment = " & lblId.Text 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2016-05-30T23:02:19.563

使用`vbCrLf`或`vbNewLine`。它适用于 MessageBoxes 和我测试过的许多其他控件。

```
Dim str As String
str = "First line" & vbCrLf & "Second line"
MsgBox(str)
str = "First line" & vbNewLine & "Second line"
MsgBox(str) 
```

它将显示两个相同的带有 2 行的 MessageBox。

* * *

## 回答 #20

> 赞同：-9
> 
> 时间：2009-04-01T16:41:05.420

不，VB.NET 还没有这样的功能。它将在 VB（visual basic 10）的下一次迭代中可用，但是（[链接](http://blogs.msdn.com/vbteam/archive/2009/03/27/channel-9-interview-no-more-underscores-in-visual-basic-10-beth-massi-tyler-whitney.aspx)）

* * *

## 回答 #21

> 赞同：-16
> 
> 时间：2009-04-01T17:16:29.030

如果它像 C#（我没有安装 VB.Net），你可以在字符串前面加上 @

```
foo = @"Multiline
String" 
```

这对于 @"C:\Windows\System32\" 之类的东西也很有用——它实际上关闭了转义并打开了多行。

# javascript - 布尔 HTML 属性

> ID：706384
> 
> 赞同：17
> 
> 时间：2009-04-01T16:37:21.327
> 
> 标签：javascript, html, dom, dhtml

HTML 中有一些属性是“布尔值”——如果它们存在，浏览器会将它们视为“真”，而不管值如何。在标签上**选择**了此类属性的一个示例。`<option>`另一个被**选中**。`<input type="checkbox">`

如果您调用`setAttribute()`了此类属性，则似乎没有可以设置的值以使浏览器始终如一地表现该属性一样。

例如

```
option.setAttribute("selected", false) 
```

仍将标记选择的选项。**null**、空字符串或**undefined**也不起作用。如果有人知道我可以设定一个值来实现我的目标，请告诉我，但我认为不存在。（因为我使用了一些框架代码，**不**调用`setAttribute()`，或者调用`removeAttribute()`很困难。）

我正在尝试查找此类属性的详尽列表，以应对特殊情况。这是我到目前为止所拥有的：

*   **选择**的`<option>`
*   **检查**_`<input>`
*   **disabled** , **readonly** of `<input>`, `<select>`, `<option>`, `<optgroup>`, `<button>`,`<textarea>`
*   **倍数**_`<select>`

请帮助我完成此列表 - 或将我指向现有的列表。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-01T23:13:57.127

> （由于我使用了一些框架代码，不调用 setAttribute() 或调用 removeAttribute() 很困难。）

然后我会提交框架代码需要修复或转储。

根据设计，您无法通过 setAttribute 取消设置属性。您发现的任何涉及带外值（如“null”）的解决方案，如果它碰巧在任何特定浏览器中工作，根据 DOM 核心标准，将是完全无效的。

在任何情况下，最好在浏览器（非 XML）HTML 上下文中避免 setAttribute()。IE pre-8 不知道 DOM 属性和 JavaScript 属性之间的区别，这很容易导致许多非常奇怪的问题。如果您尝试将“checked”设置为属性（理论上您应该将其设置为字符串“checked”），不要指望 IE 会配合。

HTML 4.01（以及因此的 XHTML 1.0）中的布尔属性的完整列表是（带有不同大小写的属性名称）：

```
checked             (input type=checkbox/radio)
selected            (option)
disabled            (input, textarea, button, select, option, optgroup)
readonly            (input type=text/password, textarea)
multiple            (select,input)
ismap     isMap     (img, input type=image)

defer               (script)
declare             (object; never used)
noresize  noResize  (frame)
nowrap    noWrap    (td, th; deprecated)
noshade   noShade   (hr; deprecated)
compact             (ul, ol, dl, menu, dir; deprecated) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T16:42:54.743

尝试[removeAttribute](https://developer.mozilla.org/en/DOM/element.removeAttribute)：

```
option.removeAttribute("selected"); 
```

编辑：阅读您的评论后，请阅读[有关](https://developer.mozilla.org/en/DOM/element.setAttribute)setAttribute 的内容。尤其：

> 即使 getAttribute() 为缺少的属性返回 null，您也应该使用 removeAttribute() 而不是 elt.setAttribute(attr, null) 来删除该属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T16:40:05.467

在表格单元格上，例如 TD、TH

```
nowrap 
```

作为记录，您可以更改选中的属性（在复选框/单选元素上）。

```
myCheckBoxElem.checked = true|false; 
```

或者

```
myCheckBoxElem.checked = !myCheckBoxElem.checked;//toggles to the opposite state 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:41:33.063

你不能用[`removeAttribute()`](https://developer.mozilla.org/en/DOM/element.removeAttribute)吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T16:54:07.667

不完全是您要问的，但“类”和“for”属性都接收不同的 DOM 名称

```
element.className
element.htmlFor 
```

# c# - 从列表中删除一个项目 - C#

> ID：706387
> 
> 赞同：0
> 
> 时间：2009-04-01T16:37:46.160
> 
> 标签：c#, linq

我有一个相当复杂的数据结构。简单版本如下所示：

```
public class Field
{

  List<FieldRow> fieldRow;

  //I want to write a delete that iterates and deletes given the key 
  //(Use Linq?)
  public void DeleteByKey(int key)
  {
    //Do Remove
  }
}

public class FieldRow
{
  public int key;
} 
```

感谢您在实施删除方面的任何帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T16:41:32.843

```
public class Field
{
  List<FieldRow> fieldRow;

  public void DeleteByKey(int key)
  {
    fieldRow.RemoveAll(row => key == row.key);
  }
}

public class FieldRow
{
  public int key;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T16:40:36.793

`List<T>().RemoveAll()`会做你想做的。

你给它一个 Predicate 委托类型，它为每个项目执行，就像一个 where 子句：

```
fieldRow.RemoveAll(item => item.Key == key); 
```

但是，您可能需要考虑将数据存储在`Dictionary<int, FieldRow>`. 这样您就可以直接按键访问字典/地图。这将提高性能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T16:42:07.943

您可以找到需要删除的字段的索引，并在 List 上使用 RemoveAt 方法。

~~我将在一分钟内添加一个示例。~~ 没关系，将 RemoveAll 与谓词一起使用的建议似乎是一个更好的选择:-)

# jquery - jQuery ajaxForm 插件未在 IE6 中运行成功功能

> ID：706393
> 
> 赞同：1
> 
> 时间：2009-04-01T16:39:36.123
> 
> 标签：jquery, internet-explorer-6

我正在使用 jQuery 插件[ajaxForm](http://www.malsup.com/jquery/form/)通过 AJAX 提交文件上传表单。该脚本提交表单，该表单在成功后运行`uploadResponse()`，将新行添加到`<table>`页面上的 a 中。它在 Opera、Firefox、Safari、IE7 和 IE8 中运行良好。

但是，IE6 不会`uploadResponse()`在表单提交后运行。来自脚本的 POST 请求运行，您可以在刷新页面时看到该文件。但是，`uploadResponse()`根本不运行并且 DOM 不更新。

这是脚本的一部分：

```
/**
 * Ajaxified upload form
 */
$('form#upload').ajaxForm(
{
    url: 'ajax/upload.php',
    success: uploadResponse,
    dataType: 'xml'
});

/**
 * Upload form response
 *
 * @param responseXML Returned from the AJAX POST
 */
function uploadResponse(responseXML)
{
    var displayName = $('display_name', responseXML).text();
    var fileName = $('name', responseXML).text();
    var directoryID = $('directory_id', responseXML).text();
    var abbrTitle = $('abbr_title', responseXML).text();
    var tableRow = 'file_' + tableRowCount;

    $('table#listing tbody').prepend(row(displayName, null, '', 'delete.php?directory_id=' + directoryID + '&file=' + fileName, 'Delete', null, tableRow, 'fileName jsHide', 'rename jsHide', 'delete jsHide', abbrTitle));
    $('td.jsHide').fadeIn();

    // AJAX renaming
    $('tr#file_' + tableRowCount).find('td.fileName').click(generateRenameForm);

    // Remove "no files" notficiation
    $('p#noFiles').remove();

    alternatingRows();
    tableRowCount++;
} 
```

`uploadResponse()`函数中的特定代码没有问题。它根本不运行（我使用它测试过`alert()`）。

此外，IE6 显示“此页面包含安全和非安全内容”对话框。所有脚本、样式表等都在安全服务器上是本地的，所以据我所知，没有什么是不安全的。我已经非常彻底地检查了这个。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-20T05:10:53.157

数据类型：xml 是问题所在。我不确定我在哪里学到了这个技巧（所有功劳归功于原始来源）。这是最有可能解决此问题的方法：

将“数据类型：xml”替换为

```
datatype: ($.browser.msie) ? "text" : "xml" 
```

在开始使用 xml 响应之前，您需要执行以下操作：

```
function parseXMLResult(result) {
    var xmlDoc;
    if (typeof result == 'string') {
        xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
        xmlDoc.async = "false";
        xmlDoc.loadXML(result);
    } else {
        xmlDoc = result;
    }
    return xmlDoc;

} 
```

希望这可以解决您的问题。

注册安全/不安全警告，您肯定至少有一个元素可能是通过 http 加载的 image/css/js 文件。此问题并非特定于 IE6，您应该在 FireFox 的地址栏中看到证书符号有一个红色的“i”，表示页面中存在问题。使用[FireBug](https://addons.mozilla.org/en-US/firefox/addon/1843)之类的工具找出违规元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:09:35.117

你在另一台电脑上测试过吗？也许是您的 IE6 中的安全设置。

# javascript - 如何使用 jQuery 通过复选框将输入从一个文本框复制到另一个？

> ID：706402
> 
> 赞同：7
> 
> 时间：2009-04-01T16:40:58.790
> 
> 标签：javascript, jquery, forms

我正在清理一个简单的表单，它有一个开始日期文本框和一个结束日期文本框。我想在这些字段之间添加一个复选框，用户可以检查结束日期是否与开始日期相同，因此当他们检查它时，开始日期输入值（例如，09 年 4 月 1 日）将自动出现在结束日期文本框中，因此他们不必输入相同的日期两次。那有意义吗？

顺便说一句，我正在使用性感的 jquery datepicker UI，它很可爱，但我就是无法弄清楚上述问题。

我知道有一个简单的解决方案（事件处理程序？），但我很难过。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-01T16:44:35.113

试试这个代码：

```
$("#checkboxId").click(copyDate);

function copyDate()
{
   var start=$("#startDate").val();
   if (this.checked==true)
     $("#endDate").val(start);
} 
```

将 'id' 替换为您自己的字段 ID。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-01T16:56:53.180

简单的hack来解决你的问题。

```
<html>
<head>
    <script src="js/jquery.js" ></script>
</head>
<body>
    <form>
        <input type="text" name="startdate" id="startdate" value=""/>
        <input type="text" name="enddate" id="enddate" value=""/>
        <input type="checkbox" name="checker" id="checker" />
    </form>
    <script>
    $(document).ready(function(){
            $("input#checker").bind("click",function(o){
                if($("input#checker:checked").length){
                    $("#enddate").val($("#startdate").val());
                }else{
                    $("#enddate").val("");
                }
            });
        }
    );
    </script>
</body>
</html> 
```

# java - 用于 Java 的 Django 管理风格应用程序

> ID：706405
> 
> 赞同：10
> 
> 时间：2009-04-01T16:41:31.020
> 
> 标签：java, python, django

我正在寻找一个 Web 框架或 Java 应用程序，它可以做 Django 管理员所做的事情 - 提供一个友好的用户界面来编辑关系数据库中的数据。我知道可以在 Jython 上运行 Django，这样可以实现某种基于 Java 的解决方案，但我更喜欢纯 Java 的东西来让高层满意。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T10:46:20.917

试试[Grails](http://grails.org/)。它是一个以 Django 为模型的框架，用[Groovy](http://groovy.codehaus.org/)编写。Groovy 是一种基于 JVM 的语言，与 Java 源代码兼容。

要获得类似 Django 的管理界面，您需要编写模型，让 Grails 生成所有其余部分（控制器和视图），然后就完成了。

一些资源：

*   [快速入门教程](http://grails.org/Quick+Start)
*   [显示脚手架的截屏视频](http://mediap1.roadkast.com/hansamann/grails_scaffolding.mov)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-07-21T14:52:26.737

[Spring ROO](http://www.springsource.org/roo)可能是您正在寻找的——它是一个纯 Java 解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-02T08:52:25.397

您的意思是 CRUD 生成（CRUD：创建、读取、更新、删除 = 典型的管理界面）。例如[Rife](http://rifers.org/theater/demo1_rifecrud)可以做到这一点。

# java - 使用 GZIP、JSON 响应和 JQuery

> ID：706412
> 
> 赞同：10
> 
> 时间：2009-04-01T16:42:17.053
> 
> 标签：java, jquery, json, jsp, gzip

但是，我想尽可能用 GZIP 压缩我的回复。我尝试使用可在 headfirst 站点免费下载的[压缩过滤器代码。](http://www.headfirstlabs.com/books/hfsvlt/)它适用于 html、图像、css 和 javascript。

我接下来发布过滤器。它检查 GZIP 是否是可接受的编码，并将 gzip 添加为 Content-Encoding。看：`wrappedResp.setHeader("Content-Encoding", "gzip");`

```
public class CompressionFilter implements Filter {

  private ServletContext ctx;
  private FilterConfig cfg;

    /**
     * The init method saves the config object and a quick reference to the
     * servlet context object (for logging purposes).
     */
  public void init(FilterConfig cfg) 
     throws ServletException {
    this.cfg = cfg;
    ctx = cfg.getServletContext();
    //ctx.log(cfg.getFilterName() + " initialized.");
  }

        /**
         * The heart of this filter wraps the response object with a Decorator
         * that wraps the output stream with a compression I/O stream.
         * Compression of the output stream is only performed if and only if
         * the client includes an Accept-Encoding header (specifically, for gzip).
         */
      public void doFilter(ServletRequest req,
                   ServletResponse resp,
                   FilterChain fc)
         throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) resp;

        // Dose the client accept GZIP compression?
        String valid_encodings = request.getHeader("Accept-Encoding");
        if ( (valid_encodings != null) && (valid_encodings.indexOf("gzip") > -1) ) {

          // Then wrap the response object with a compression wrapper
          // We'll look at this class in a minute.
          CompressionResponseWrapper wrappedResp = new CompressionResponseWrapper(response);

          // Declare that the response content is being GZIP encoded.
          wrappedResp.setHeader("Content-Encoding", "gzip");

          // Chain to the next component (thus processing the request)
          fc.doFilter(request, wrappedResp);

          // A GZIP compression stream must be "finished" which also
          // flushes the GZIP stream buffer which sends all of its
          // data to the original response stream.
          GZIPOutputStream gzos = wrappedResp.getGZIPOutputStream();
          gzos.finish();
          // The container handles the rest of the work.

          //ctx.log(cfg.getFilterName() + ": finished the request.");

        } else {
          fc.doFilter(request, response);
          //ctx.log(cfg.getFilterName() + ": no encoding performed.");
        }   
      }

      public void destroy() {
          // nulling out my instance variables
          cfg = null;
          ctx = null;
      }
    } 
```

我正在使用下一个代码在 Struts Web 应用程序中发送 JSON 响应。

```
public ActionForward get(ActionMapping mapping,
    ActionForm     form,
    HttpServletRequest request,
    HttpServletResponse response) {
       JSONObject json = // Do some logic here
       RequestUtils.populateWithJSON(response, json);
       return null;         
}

public static void populateWithJSON(HttpServletResponse response,JSONObject json) {
    if(json!=null) {
        response.setContentType("text/x-json;charset=UTF-8");       
        response.setHeader("Cache-Control", "no-cache");
        try {
             response.getWriter().write(json.toString());
        } catch (IOException e) {
            throw new ApplicationException("IOException in populateWithJSON", e);
        }               
    }
 } 
```

它在没有压缩的情况下工作正常，但如果我压缩 JSON 响应，我就看不到我的 JSON 对象了。我使用 JQuery 处理 JSON Ajax 调用，代码片段如下：

```
 $.post(url,parameters, function(json) {
    // Do some DOM manipulation with the data contained in the JSON Object
}, "json"); 
```

如果我看到 Firebug 的响应，它是空的。

我应该折射我的压缩过滤器以跳过 JSON 响应中的压缩吗？还是有解决方法？

对我来说，JQuery 似乎无法将响应识别为 JSON，因为我正在添加 Gzip 压缩。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T17:44:50.413

> 如果我看到 Firebug 的响应，它是空的。

有你的线索 - 这不是 JQuery 问题，它是服务器端的。（恐怕我无法帮助您，除了建议您停止查看客户端）

压缩 ajax 响应没有问题 - 如果您在 Firebug 中看不到响应，那么 JQuery 也看不到它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T16:48:15.120

如果要压缩它，则必须再添加一个标头“content-encoding: gzip”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T17:40:05.183

您是否尝试过使用显式的基于 java 的客户端来确保它是 jQuery 或浏览器的问题？如果 java 客户端失败，服务器响应有问题。

但我猜测，虽然浏览器可以处理直接请求的解压缩，但这可能不适用于 Ajax 调用。

这是一个有趣的问题，我希望我们能得到一个更明确的答案。:)

# json - CouchDB 最适合动态语言吗？

> ID：706417
> 
> 赞同：7
> 
> 时间：2009-04-01T16:43:09.033
> 
> 标签：json, scala, couchdb, dynamic-languages

我对[CouchDB](http://couchdb.apache.org)很熟悉，将其结果映射到 Scala 对象以及找到一些自然的方式来迭代它的想法立即出现了。

但我看到动态语言（如 Ruby 和 Javascript）在 CouchDB 的 json/document-centric/shchema-free 方法上做得很好。

用静态语言用 Couch 做事有什么好的方法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-01T17:13:09.197

我知道 CouchDB 纯粹使用 JSON 对象。由于 JSON 是无类型的，因此很容易相信它更自然地适用于动态语言。然而，XML 通常也是无类型的，Scala 为创建和操作 XML 提供了非常好的库支持。有关 Scala 的 XML 功能的探索，请参阅：[http ://www.ibm.com/developerworks/library/x-scalaxml/](http://www.ibm.com/developerworks/library/x-scalaxml/)

JSON 也是如此。有了适当的库支持，即使在静态语言中处理 JSON 也很自然。有关在 Scala 中处理 JSON 数据的一种方法，请参阅这篇文章：[http ://technically.us/code/x/weaving-tweed-with-scala-and-json/](http://technically.us/code/x/weaving-tweed-with-scala-and-json/)

对于一般的对象数据库，有时定义“模型”（例如，使用语言中的类）并使用 JSON 或 XML 或其他一些无类型文档语言作为类的序列化表示是很方便的。然后，适当的库支持可以在序列化形式（如 JSON）和内存数据结构之间进行转换，并带有静态类型和所有附带的好处。有关此方法的一个示例，请参阅 Lift 的记录，其中添加了与 JSON 之间的转换：[http ://groups.google.com/group/liftweb/msg/63bb390a820d11ba](http://groups.google.com/group/liftweb/msg/63bb390a820d11ba)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-08T08:48:24.737

我想知道你是否问对了问题。你为什么使用 Scala 而不是动态语言？可能是因为 Scala 为您提供了一些对您很重要的优点，我假设您的代码质量。那你为什么不使用“静态类型”（即基于模式的）数据库呢？我再次假设，但我想到了应对变化的能力。生产 SQL 数据库具有非常难以更改和重构的可怕趋势。

因此，您的*数据*是弱类型的，而您的*代码*是强类型的。但是你需要在某个地方进行过渡。这意味着在某个地方，即使数据库没有，您也会为您的数据提供一个“模式”。此模式由您将 Couch 文档映射到的类定义。这很有意义；我见过的 Couch 的大多数用途都有一个键，例如“类型”，并且对于每种类型，至少有一组通用键。是否将 JSON 手动映射到这些 Scala 类或使用例如花哨的反射工具（速度较慢但很漂亮），或者我还不熟悉的一些更高级的 Scala 功能是一个细节。从简单但缓慢的开始，然后看看它是否足够快。

*当你的类，即你的模式，改变*时，就会发生大事。您可以更改类，而不是更改您的表，确保在某些文档缺少您期望的键（因为它基于该类的旧版本）时做一些聪明的事情，然后离开。响应变化从未如此简单，而且您的代码仍然是尽可能静态类型的。

如果这对您来说还不够好，并且您根本不需要模式，那么您实际上是在说您不想使用类来定义和操作您的数据。这也很好（尽管我无法想象有什么用），但是问题不在于动态语言与静态语言，而在于是否使用基于类的 OO 语言。

# shell - 检查文件是否是 Linux 上的链接

> ID：706421
> 
> 赞同：3
> 
> 时间：2009-04-01T16:44:36.800
> 
> 标签：shell, unix, scripting, ksh, symlink

我正在尝试使用`-h filename`命令检查 KornShell (ksh) 脚本中是否存在符号链接。这在 HP 盒子上效果很好。

不确定 Linux、AIX 和 Solaris 机器的正确选项是什么。

对此有任何见解吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T05:08:47.633

`-h`是[POSIX 规范](http://www.opengroup.org/onlinepubs/009695399/utilities/test.html)的一部分；它应该在任何合理的地方都有效。

根据`man test`在 Mac OS X 上：

```
     -h file 如果文件存在并且是符号链接则为真。该运算符
                   保留与以前版本的兼容性
                   这个程序。不要依赖它的存在；改用 -L 。

```

`-L`也是标准化的，所以如果你发现任何地方`-h`不起作用，你应该尝试`-L`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T16:52:11.867

至少在 linux 系统上也是 -h （bash 是我的 shell）：

```
lrwxrwxrwx 1 mule mule 37 Feb 27 09:43 mule.log -> /home/mule/runtime/mule/logs/mule.log
[mule@emdlcis01 ~]$ if [[ -h mule.log ]]; then echo "mule.log is a symlink that exists" ; fi
mule.log is a symlink that exists 
```

检查`man test`以查看在给定环境中可用于文件和字符串的可用运算符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T02:18:39.027

最好的答案是尝试系统上“测试”手册页上的任何内容。如果这似乎有效，请不要再犹豫了。但是，如果它似乎不起作用，或者如果您对要测试的更晦涩的选项有疑问，那么您还应该查看您的 shell 的手册页以查看 'expr' 或 '[' 是否是内置的。在这种情况下，shell 可能正在使用内部实现，而不是从 /bin 调用 expr 实用程序。在 Solaris 上，我验证了 ksh93 将 [ 视为内置（即使手册页似乎没有这样说）。从 truss 输出中，您可以看到 ksh 没有为 [.

```
% truss -f -texec /bin/ksh '[ -h /home ]'
26056: execve("/usr/bin/ksh", 0x08047708, 0x08047714) argc = 2
26056: execve("/usr/bin/ksh93", 0x08047708, 0x08047714) argc = 2
26056: execve("/usr/bin/amd64/ksh93", 0x08047704, 0x08047710) argc = 2

% truss -f -texec /bin/ksh '/bin/expr -h /home ]'
26058: execve("/usr/bin/ksh", 0x08047700, 0x0804770C) argc = 2
26058: execve("/usr/bin/ksh93", 0x08047700, 0x0804770C) argc = 2
26058: execve("/usr/bin/amd64/ksh93", 0x080476FC, 0x08047708) argc = 2
26058: execve("/bin/expr", 0x00418360, 0x00418398) argc = 4

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-07T11:41:49.220

有两种可能的选择

```
 if [ -h filename ] 
OR
    ls -ltr | grep filename | grep ^l 
```

如果 $? 为 0 则文件已链接，否则未链接，我将更喜欢第一个选项。

# iphone - 如何从应用程序委托类中的控制器类访问插座？

> ID：706423
> 
> 赞同：0
> 
> 时间：2009-04-01T16:46:22.973
> 
> 标签：iphone

我想从应用程序委托类的 applicationDidFinishLaunching 方法更改 UIImageView 的图像。但恐怕这个班对控制器插座了解不多。在这种情况下我必须做什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T16:59:33.003

您必须将 UIImageView 所在的 ViewController 定义到 AppDelegate 类，以便 applicationDidFinishLaunching 可以引用它。

在 AppDelegate 中，在接口语句前添加*@classwhateverViewController*，并定义实例。

```
#import <UIKit/UIKit.h>

@class WhateverViewController;

@interface WebDemoAppDelegate : NSObject <UIApplicationDelegate> {
    UIWindow *window;
    WhateverViewController *whateverViewController;
} 
```

现在您的应用程序引用了whateverViewController。然后，您可以调用whateverViewController 中的方法来更改UIImageView 或直接设置UIImageView。当然，这假设whateverViewController 已实例化（例如alloc/init 或从nib 加载）；在你尝试设置任何东西之前，它必须存在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T16:48:32.953

您可能需要在您的应用程序委托中为您的 UIImageView 或其控制器放置一个插座，以使其可以在那里访问。

# .net - 不可变对象的约定

> ID：706424
> 
> 赞同：2
> 
> 时间：2009-04-01T16:46:54.500
> 
> 标签：.net, naming-conventions, immutability

当你设计不可变类时，你更喜欢：

```
Layer.ColorCorrect ( layer ) 
```

或者

```
layer.ColorCorrect ( ) 
```

对我来说，#1 似乎更直观，而不是 #2，它看起来像是修改了引用的对象，因为它是一个实例方法，它还不如改变内部结构，对吧？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T16:50:53.710

我更喜欢使用实例方法，但选择名称以反映它不会更改现有实例的事实。例如：

```
layer.AfterColorCorrection() 
```

或者

```
layer.WithCorrectedColors() 
```

使用静态方法很快就会变得很烦人。此外，如果您向用户明确表示该类型是不可变的，他们应该很快就掌握了窍门。每个人都会因为没有真正替换目标中的任何东西而被绊倒`String.Replace`——但他们不会一直犯同样的错误。有了更好的名字*，*你应该没问题。

我问了一个[有关](https://stackoverflow.com/questions/521893/whats-the-best-name-for-a-non-mutating-add-method-on-an-immutable-collection)“添加”到不可变列表的相关问题 - IMO 的最佳解决方案是使用“加号”而不是“添加”；同样，这并不意味着原始值已更改。您可能会发现该问题的其他答案很有用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T17:36:21.137

我个人的偏好是专注于使类型是不可变的。例如，我将其称为 ImmutableLayer vs. Layer。或者如果由于某种原因 Immutable 不是一个好词来作为名称的前缀，我将在类中添加一个属性，表明它是 Immutable （在两种情况下都添加了属性）。

这有它的起起落落。最重要的是它提供了一个检查不变性的中心位置。只需快速浏览一下类型，您就可以开展业务了。无需学习新的方法名称或约定。该方法的缺点是您无法在某些类型的推理场景中判断该值是不可变的。例如，此代码同样适用于 ImmutableCollection 和普通 List

```
var col = GetTheCollection();
col.Add(42); 
```

但是我不喜欢更改方法名称以适应不变性。原因是这是一个你必须反复解决的问题。命名事物应该很容易，但有时却非常困难。想一想您曾经想要使其不可变的所有类型。想象一下，必须为这些类型的每个变异方法找到新的名称或约定。这是一项艰巨的任务，您将花费大量时间来教育用户了解这些新约定。

不过，我的梦想是找到一种方法来增加不可变类型的可见性。因为这是真正的问题，不知道类型是不可变的。目前还没有针对所有场景执行此操作的好方法，但我对下一个版本的语言/IDE 抱有希望。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-04T20:06:16.690

@JaredPar 有最好的答案，IMO，但没有一个答案很好，因为今天没有任何“伟大”的解决方案。我们需要更好的工具，以及与工具一起发展的设计指南，以更好地应对不可变对象日益流行的问题。

@JonSkeet 的答案在几乎所有内容都是可变的 API 上下文中运行良好，但随着不可变对象成为常态（因为所有方法的名称都很糟糕），它就会下降。

“最佳”名称取决于您周围的代码上下文。我认为在“大部分可变”到“大部分不可变”上下文的范围内唯一可行的策略是 Jared 提到的那个，其中工具使给定对象是否不可变变得显而易见，然后每种方法都有“必要性” name (egoAdd) 对接收者对象产生副作用（如果它是可变的）或返回一个新对象（如果它是不可变的）。

（除此之外：遗憾的是，像“StringBuilder”这样的“流利”有效的 API 意味着您不能只查看方法签名来确定接收者对象是否不可变，因为这些示例“返回 this”是流利的，给出相同的签名作为“返回副本”。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T16:52:26.047

通常你会有类似的东西：

```
layer = layer.ColorCorrect([required parameters here]); 
```

这将类似于

```
mystring = mystring.Substring(1, 2); 
```

创建一个新字符串的位置，它是第一个字符串的子字符串。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T17:01:04.450

编写静态方法，传递实例并使其看起来几乎像“C”这样的过程编程，这绝对违反了OOPS原则。同样在第一种方法中，您键入 Layer 两次，这使读者感到模棱两可。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T17:22:42.947

使用静态方法排除继承，不是吗？这似乎是一个非常重要的限制。

# assembly - 自学 Z/OS 汇编程序

> ID：706426
> 
> 赞同：8
> 
> 时间：2009-04-01T16:47:05.280
> 
> 标签：assembly, mainframe, zos

我曾在一家从事大量大型机工作的公司实习。我的大部分大型机经验都是使用 Java 和 Unix 系统服务。我对 ISPF 接口和 C 有一些经验，但对汇编程序没有经验。

我即将毕业，最后一个学期将进行独立学习。我想坚持使用大型机，并想知道哪些资源可以教我大型机汇编程序。

请注意，我没有为任何平台编写汇编程序的经验，但我确实了解二进制、十六进制，并且对寄存器有理论上的了解。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T05:06:54.927

以下都不是教程式的，只是参考资料。不过，一切最终都会派上用场，很高兴知道；感兴趣的是：

*   HLASM 程序员指南
*   HLASM 语言参考
*   HLASM 一般信息
*   MVS 程序管理：用户指南和参考
*   MVS 汇编器服务指南
*   MVS 授权组装商服务指南
*   z/架构操作原理

您可以在 IBM 文档库中找到您所使用的 z/OS 版本的书籍：

*   [http://www-03.ibm.com/systems/z/os/zos/bkserv/](http://www-03.ibm.com/systems/z/os/zos/bkserv/)

z/Architecture 操作原则（“POP 手册”）是系统圣经。对那本书最感兴趣的是第 7 章，它列出了指令和指令格式。

对于教程材料，尽管我可以推荐（这些都在我的书架上）以下任何一种：

*   由 Bill Qualls 编写的 Mainframe Assembler Programming（这个带有一个仿真器 PC/370，用于编译和运行汇编程序）
*   由 Kevin McQuillen 和 Anne Prince 撰写的 MVS 汇编语言

在你掌握了基础知识之后：

*   面向 IBM 系统和应用程序程序员的高级汇编语言和 MVS 接口，作者 Carmine A. Cannatello

如果您有任何疑问，当然可以使用 stackoverflow，但要选择更多以大型机为中心的人才库，请尝试[http://ibmmainframeforum.com/](http://ibmmainframeforum.com/)。它不是很活跃，但版主知道黑暗艺术。

玩得开心！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T16:54:28.820

学习汇编程序当然是了解计算机如何真正工作的好方法，但我建议跳入 390 汇编程序将涉及非常陡峭的学习曲线。我建议获取一个微处理器仿真器，例如[emu8086](http://www.emu8086.com/)，它附带一个教程并从它开始。你学到的基本概念可以转移到其他更复杂的架构中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T16:57:53.430

有一个名为[Hercules 的大型机模拟器，](http://www.hercules-390.org/)一些较旧的大型机操作系统可以免费（合法地）获得。您可能会发现您可以使用它对 Mainframe 汇编器进行一些实验。指令集不会比 386 系列更复杂，所以在这个系统上学习汇编程序可能和任何其他系统一样好。

作为替代方案，[这篇 Stackoverflow 帖子](https://stackoverflow.com/questions/696378/where-and-how-does-software-meet-hardware/696414#696414)讨论了学习汇编程序的其他方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-14T13:00:12.813

我一直处于你的位置；我是学生，我自己。我发现尝试自学大型机汇编程序，尤其是在其他课程之上，没有任何支持，也没有人可以寻求快速答案，最好只是参加一门实际的课程。我用 C++、.NET、Assembler、COBOL、High Level Assembler 和其他语言编写过代码，而在这两个汇编程序类中真正帮助我的是在一个有大量支持的结构化环境中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-08T15:49:36.130

我已经能够使用以下材料以及我可以向其提问的同事自学最基本的知识。为了以一种简单的方式运行和调试基本汇编程序，我使用了[Z390](http://www.z390.org)仿真器，该仿真器带有允许使用辅助指令的选项以及用于交互式调试的测试选项。我用[它](http://www.wiu.edu/users/mflll/cs310/head.html)作为主要的介绍性教程。我用[这个](http://www.jorjabrown.us/csci360.htm)类网站作为另一个参考。最后，这些[共享](http://www.kcats.org/share/)材料可能很有用，尽管我不知道它们有多好，因为我的屏幕阅读器不太容易访问它们。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-07-03T03:37:59.917

[Qualls 书可在http://www.billqualls.com/assembler/index.html](http://www.billqualls.com/assembler/index.html)上免费用于非商业用途。我承认对这本书有些偏见。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2020-07-17T15:51:46.093

在一个古老的线程上发帖，但也许它对某人有用：已故的伟大 John Ehrman 的 IBM z System Servers 2.00 的汇编语言编程是一个很好的资源。此外，David Woolbright 的网站上有很多有用的信息：http: [//csc.columbusstate.edu/woolbright/WOOLBRIG.htm](http://csc.columbusstate.edu/woolbright/WOOLBRIG.htm)

# git - How significant is the bazaar performance factor?

> ID：706428
> 
> 赞同：6
> 
> 时间：2009-04-01T16:47:37.027
> 
> 标签：git, bazaar

I hear all this stuff about bazaar being slower than git. I haven't used too much distributed version control yet, but in [Bazaar vs. Git](http://bazaar-vcs.org/BzrVsGit) on the bazaar site, they say that most complaints about performance aren't true anymore. Have you found this to be true? Is performance pretty much on par now?

I've heard that speed can affect workflow (people are more likely to do good thing X if X is fast). **What specific cases does performance currently affect workflow in bazaar vs other systems (especially git), and how?**

I'm just trying to get at why performance is of particular importance. Usually when I check something in or update it, I expect it to take a little while, but it doesn't matter. I commit/update when I have a second, so it doesn't interfere with my productivity. But then I haven't used DVCS yet, so maybe that has something to do with it?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T16:54:47.413

The python developers recently decided to switch to Mercurial and as part of the process did some basic benchmarking of git, Mercurial and Bazaar which is documented in [PEP-374](http://www.python.org/dev/peps/pep-0374/#tests-impressions).

An incredibly rough eye balling of the numbers they posted showed Bazaar to be 2-4x slower than either git or Mercurial in the use cases tested.

That being said, the message conveyed on python-dev was that all of them (git, Mercurial, Bazaar) are better than Subversion, for the most part they are fast enough and the choice of Mercurial over git/Bazaar was mostly based on the gut feelings of the BFDL and the attendees of PyCon2009.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-27T05:15:41.200

Bazaar is such a fast moving target (and presumably so is git) that any claims about performance are likely to be out of date by the time you read them.

According to many sources including Wikipedia, git is [particularly slow](http://en.wikipedia.org/wiki/Git_(software)#Portability) on Windows because it needs its POSIX environment, but that nothing beats the speed of git in its native, POSIX-y Linux. This is one reason I use Bazaar - apart from personally finding it easy to use, I use Windows 66% of the time and Bazaar has no performance problems on Windows. I don't doubt that git is very fast on Linux though.

Again, though, benchmarks could be skewed by a variety of factors and may be out of date.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-02T09:05:13.930

Bazaar developers now working on new major version that should be released in the June-July 2009. Some technical details here: [http://jam-bazaar.blogspot.com/2009/03/brisbane-core.html](http://jam-bazaar.blogspot.com/2009/03/brisbane-core.html)

UPDATE: bzr 2.0 with mentioned improvements released in September 2009.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-16T14:07:46.060

**Benchmark test 2009-08-16**: *Git 1.6.3.3, Hg 1.3.1, Bzr 1.17*

[http://www.editgrid.com/user/jaalto/vc-test](http://www.editgrid.com/user/jaalto/vc-test)

See also PDF mentioned in the site, which gives more background on these three DVCS (with better benchmark graphs).

**SUMMARY**: Hg and Bzr are practically equal in performance wise. Bzr has improved in leaps (see upcoming 2.0) and the "shared repositories" in Bzr is as fast as "git branch". The development phase and development discussion messages, of both Git and Bzr, suggest that in the future Git and Bzr will advance quicker than Hg.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-03-19T08:29:02.283

**Bazaar 2.0**, [released 2009-09-22](http://doc.bazaar.canonical.com/development/en/release-notes/bzr-2.0.0.html), uses a much more efficient storage format by default. Current [benchmarks](http://wiki.bazaar.canonical.com/Benchmarks) show Bazaar 2.0 performing **pretty much equal speed with Mercurial**, and considerably **more space-efficient** in its repository data.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-01T17:16:42.323

Warning: lot of articles on VCS are quickly outdated, these projects in general, and Bazaar in particular, are quickly evolving.
I found some time ago a recent benchmark: [Mercurial vs. Bazaar speedtest clone and log](http://draketo.de/english/free-software/light/mercurial-vs-bazaar-speedtest-2-hg-1-1-vs-bzr-1-10 "Mercurial vs. Bazaar speedtest clone and log"), it appears Hg is still faster than Bzr.

Now, that's funny, I have just read some threads on the Bazaar mailing list, particularly comments on the PEP-374, and a yet to come switch of Emacs SC to Bzr. On the latter, it looks like they wait for the next release (1.14) which will bring a big speed boost (at least for their needs). On the former, a contributor made a good remark: if it is fast enough for you, it is OK!

Lot of benchmarks tend to check out a large (or very large) codebase/history and measure network speed and such. Indeed, on such cases, Bzr still perform poorly (but they work on it). Disk space is larger too. But hey, modern disks are quite large, that's probably a minor issue.

Personally, I use Bzr for small personal projects, history is still recent, so I don't care much about speed. As others point out, you might want to concentrate instead on usability/ease of use, how it fits to your workflow, if renaming is important for you, if various ways of accessing remote repositories (including SSH and FTP, for example) are important, etc.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-08-04T21:48:27.500

Well i'm checking out emacs on a linux VM (debian) and bzr seems to be continuously consuming memory and cpu, and shows no signs of completing. This is problematic for me.

# asp.net - 使用 AJAX 持续更新 ASP.NET 页面

> ID：706429
> 
> 赞同：0
> 
> 时间：2009-04-01T16:47:46.497
> 
> 标签：asp.net, asp.net-ajax

我有一个与业务类交互的 ASP.NET 页面。我想根据用户输入的值不断更新页面上的控件，例如更新总数。计算嵌入在业务逻辑中，但它们足够简单，可以在其他地方重现。我想了三种方法来实现这一点：

1.  使用 JavaScript 动态更新页面。我不想这样做，因为我不想冒浮点数学问题的风险，因为页面上的值与业务类计算的值不匹配（这些属性是小数）。
2.  清除更改的计算字段并强制用户单击重新计算按钮。这是一个糟糕的用户体验，并且将 JavaScript 连接到 ASP.NET 控件很乏味。
3.  使用AJAX UpdatePanel，将数据输入控件设置为自动回发，并处理控件的“更改”事件，例如TextBox 的TextChanged。

第三种方法对我来说似乎最干净，提供了良好的用户体验，并允许我直接与我存储在会话状态中的业务类进行交互。

我的问题是：这是一个好主意和/或常见做法吗？有没有更好的方法来实现这一点？

我已经有几年没有做过 ASP.NET 工作了，而且我对 autopostback[1] 有偏见。我查看了请求的大小，目前 1.5kB 可以忽略不计。该网站的使用率很低，但我们可能有少数用户使用拨号连接。

1.  和 ASP.NET 一样，但时间很艰难。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T16:54:59.427

个人觉得`UpdatePanel`太重了。您可以将 jQuery 与输出 JSON 的 ASP.NET Web 服务函数一起使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T16:56:20.717

您认为第三个选项是您的最佳选择是正确的。这就是 AJAX 的用途。去吧。

# sql-server - 获取 proc 的选择输出的架构

> ID：706430
> 
> 赞同：3
> 
> 时间：2009-04-01T16:47:51.423
> 
> 标签：sql-server, sql-server-2005, tsql

我想将存储过程的结果放入临时表中。似乎必须事先定义临时表，并且 INSERT INTO 不起作用。

任何人都知道如何获取从选择语句返回的记录集的架构？

sp_help 仅获取有关参数的信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T16:56:44.633

您应该能够在不使用 OPENQUERY 定义架构的情况下插入临时表：

```
SELECT * INTO #TempTable
FROM OPENQUERY(ServerName, ‘EXEC DataBaseName.dbo.StoredProcedureName paramvalues1, paramvalues1′) 
```

其中 ServerName 是您的 Sql Server 实例的名称。有关更多信息，请参阅[本文](http://munishbansal.wordpress.com/2008/04/29/inserting-results-of-a-stored-procedurefunction-into-a-temp-table/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2019-12-10T22:25:10.997

有时您只需要知道架构而不创建表。此命令在不实际执行存储过程的情况下输出结果集的结构。

来自[rachmann](https://social.msdn.microsoft.com/profile/rachmann/?ws=usercard-mini)于 2015 年 4 月 16 日，来自 Microsoft SQL Server 论坛文章[如何在不使用 OPENQUERY 的情况下获取存储过程返回的结果集架构？](https://social.msdn.microsoft.com/Forums/sqlserver/en-US/5add6875-4e27-499a-8388-1062da8ea21d/how-to-get-schema-of-resultset-returned-by-a-stored-procedure-without-using-openquery?forum=transactsql)：

```
SELECT * FROM sys.dm_exec_describe_first_result_set ('owner.sprocName', NULL, 0) ; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T16:57:33.540

能否在查询窗口中执行包括 INSERT INTO 在内的逻辑内容？这应该生成一个可以用作模型的临时表。

最坏的情况是您手动构建模式一次，如果您是编写 SP 的人，这不应该是繁重的。

为了将来的文档，我还是喜欢在 SP 中手工制作 DDL。它有助于调试时明确掌握模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T17:03:49.343

如果可以，请将存储过程更改为用户定义的函数。

[http://www.scottstonehouse.ca/blog/2007/03/stored-procedures-are-not-parameterized.html](http://www.scottstonehouse.ca/blog/2007/03/stored-procedures-are-not-parameterized.html)

# ssl - SSL 和非安全项目消息

> ID：706432
> 
> 赞同：1
> 
> 时间：2009-04-01T16:48:12.517
> 
> 标签：ssl, https

我看到“此页面包含安全和非安全项目”。使用 IE 6 查看我网站上的页面时出现消息。这不会出现在 IE 7 或 Firefox 中。我做了一些研究，似乎问题与指向 HTTP:// 而不是 HTTPS:// 的链接有关

修复是否只是查看页面源代码并在任何有 HTTP:// src 的地方找到并更改它？我相信它们是由 JavaScript 生成的。

谢谢尼克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T16:49:15.680

是的，如果页面是由 HTTPS 引用的，您需要确保脚本和图像是通过 HTTPS 引用的。

或者，尝试使用相对 URL，以便您的页面可以是 HTTP 或 HTTPS，而无需更改 html。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:08:21.767

你在运行prototype.js吗？

那里有一行来检测页面何时加载，它调用 \: 作为 src=

将此 src 替换为系统上的 js 文件。它可以是空白的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-04T13:58:11.613

所以问题是第 3 方控件正在创建一个具有属性 src="about:blank" 的元素。在 IE6 中，此 src 不受信任。我的解决方案是创建一个空白.htm 文件。这个文件只包含一个标签。

然后我设置

这解决了这个问题。根据我的阅读，这在较新版本的 IE 中不是问题。

# python - 复杂的美汤查询

> ID：706443
> 
> 赞同：3
> 
> 时间：2009-04-01T16:51:24.397
> 
> 标签：python, beautifulsoup

这是我正在使用 Beautiful Soup 探索的 HTML 文件的片段。

```
<td width="50%">
    <strong class="sans"><a href="http:/website">Site</a></strong> <br /> 
```

我想`<a href>`为任何包含`<strong class="sans">`和 的行获取`<td width="50%">`.

是否可以使用 Beautiful Soup 查询 HTML 文件中的多个条件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-01T17:15:12.780

BeautifulSoup 的搜索机制接受一个可调用对象，文档似乎为您的情况推荐：“如果您需要对标签的属性施加复杂或互锁的限制，请传入一个可调用对象作为名称，...”。（好吧......他们正在专门讨论属性，但该建议反映了 BeautifulSoup API 的潜在精神）。

如果你想要一个单行：

```
soup.findAll(lambda tag: tag.name == 'a' and \
tag.findParent('strong', 'sans') and \
tag.findParent('strong', 'sans').findParent('td', attrs={'width':'50%'})) 
```

我在此示例中使用了 lambda，但实际上，如果您有多个链式需求，您可能希望定义一个可调用函数，因为此 lambda 必须进行两次调用以避免在标记没有父标记`findParent('strong', 'sans')`时引发异常。使用适当的功能，您可以使测试更有效率。`<a>``strong`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:19:33.673

```
>>> BeautifulSoup.BeautifulSoup("""<html><td width="50%">
...     <strong class="sans"><a href="http:/website">Site</a></strong> <br />
... </html>""" )
<html><td width="50%">
<strong class="sans"><a href="http:/website">Site</a></strong> <br />
</td></html>
>>> [ a for a in strong.findAll("a") 
            for strong in tr.findAll("strong", attrs = {"class": "sans"}) 
                for tr in soup.findAll("td", width = "50%")]
[<a href="http:/website">Site</a>] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-10-22T00:35:06.930

```
from bs4 import BeautifulSoup
html_doc = """<td width="50%">
<strong class="sans"><a href="http:/website">Site</a></strong> <br /> 
"""
soup = BeautifulSoup(html_doc, 'html.parser')
soup.select('td[width="50%"] .sans [href]')
# Out[24]: [<a href="http:/website">Site</a>] 
```

[文档](https://facelessuser.github.io/soupsieve/selectors/basic/)

# asp.net - silverlight 错误 - 相对 uri 不支持操作

> ID：706452
> 
> 赞同：2
> 
> 时间：2009-04-01T16:53:40.273
> 
> 标签：asp.net, silverlight, web-services

我刚刚开始开发 Silverlight 应用程序。我在我的 asp.net 项目中创建了一个网络服务。现在，当我尝试通过我的 silverlight 项目连接到它时，我收到以下错误：

*“相对 uri 不支持操作”*

我正在使用以下网址-->

[http://192.168.1.2/MyWebsite/SubVersionedHistory.svc](http://192.168.1.2/MyWebsite/SubVersionedHistory.svc)

我可以找到该类及其方法，但是当我添加它时，我收到了这个可怕的错误。

感谢您的帮助和建议，

冯迪普洛

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T20:58:42.220

我不认为你一个人在解决这个问题。我今天使用 VS2008SP1 + SL2 尝试为 ADO.NET 数据服务创建服务引用。我第一次遇到错误。

其他人有详细的类似经历来达到这个错误：

[http://silverlight.net/forums/t/87535.aspx](http://silverlight.net/forums/t/87535.aspx) [http://silverlight.net/forums/t/56629.aspx](http://silverlight.net/forums/t/56629.aspx)

目前尚不完全清楚问题是否出在 IDE“添加服务引用”对话框或服务中的某些特定内容导致此错误。然而，就我而言，尽管出现错误消息，我的代码仍然有效。我只是在我的 DataService 代理客户端的构造函数中将 URL 传递给我的服务，如下所示：

```
var context = new DataServiceContext(new Uri("NorthwindDataService.svc", UriKind.Relative)); 
```

总结点：仅仅因为您在 IDE 中遇到了这个错误，您的服务引用可能仍然有效。试一试，如果您在运行时看到错误，请告诉我们。

希望有帮助。

**[更新]**根据我发现并测试的其他一些建议，您也可以尝试：

1.  删除您的服务参考
2.  删除您的 ServiceReferences.ClientConfig 文件
3.  保存您的解决方案
4.  然后在VS中关闭并重新打开它。

关闭和重新打开项目的简单操作已被证明可以解决“添加服务”向导的几个问题。重新运行 Add Service Ref 向导，您可能会有更好的运气。我今天在一个项目中亲自测试了这个解决方案，并且可以确认它有效。希望这可以为您找到解决方案增加额外的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T18:09:38.703

Maybe this response can help you

*You cannot use AbsolutePath, You need to use AbsoluteURL. Build your URL this way: Uri url = new Uri(App.Current.Host.Source, "../settings.xml");client.DownloadStringAsync(url);*

[http://silverlight.net/forums/p/28912/95541.aspx](http://silverlight.net/forums/p/28912/95541.aspx)

HTH Braulio

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T17:17:20.247

你应该更具体地说明你的问题。例如，您在添加引用或实际尝试使用服务时是否遇到此问题？

听起来您需要使用完整路径，包括“http://”，但这只是根据您提供的错误消息在黑暗中拍摄。

[编辑]如果您使用的是内置的 ASP.NET 服务器而不是 IIS，那么请确保您设置了特定的端口号并在您的路径中使用它。例如，我使用[http://localhost:4940/MyService.svc](http://localhost:4940/MyService.svc)进行测试[/edit]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-25T19:03:00.937

检查 ServiceReferences.ClientConfig

如果那里有多个端点，您将收到此异常。可能导致这种情况的一件事是使用 casini 引用服务，然后切换到 IIS express 并重新引用该服务。

# python - Python：使用 minidom 搜索具有特定文本的节点

> ID：706453
> 
> 赞同：2
> 
> 时间：2009-04-01T16:53:41.880
> 
> 标签：python, xml, minidom

我目前面临的 XML 看起来像这样：

```
<ID>345754</ID> 
```

这包含在层次结构中。我已经解析了 xml，并希望通过搜索“345754”来找到 ID 节点。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-06-15T11:11:51.797

vartec 的答案需要更正（对不起，我不确定我能做到），它应该是：

```
xmldoc = xml.dom.minidom.parse('your.xml')
matchingNodes = [node for node in xmldoc.getElementsByTagName("ID") if 
node.firstChild.nodeValue == '345754'] 
```

它有两个问题：（i）标签名称区分大小写，因此匹配`"id"`不起作用和（ii）对于元素节点，您`.nodeValue`需要`None`访问包含值的元素节点内的文本节点你要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-01T17:09:03.760

```
xmldoc = minidom.parse('your.xml')
matchingNodes = [node for node in xmldoc.getElementsByTagName("id") if node.nodeValue == '345754'] 
```

也可以看看：

*   [如何在 xml.minidom 中获取元素的整个文本？](https://stackoverflow.com/questions/666724/how-to-get-whole-text-of-an-element-in-xml-minidom)
*   [解析 XML 时所有 nodeValue 字段均为 None](https://stackoverflow.com/questions/479751/parsing-xml-with-python)

# c# - 遍历 DirectoryEntry 或任何对象层次结构 - C#

> ID：706460
> 
> 赞同：2
> 
> 时间：2009-04-01T16:55:30.500
> 
> 标签：c#, loops, hierarchy, web-crawler, directoryservices

我目前正在开发一个应用程序，它使用 System.DirectoryServices 命名空间来创建一个 DirectoryEntry 对象并遍历整个层次结构以收集信息。

我不知道层次结构中每个 DirectoryEntry 对象的子条目数，因此我无法通过 Children 属性为蜘蛛创建 N 个嵌套循环

这是我的伪代码示例：

```
//root directory
DirectoryEntry root = new DirectoryEntry(path);

if(DirectoryEntry.Childern != null)
{
    foreach(DirectoryEntry child in root.Children)
    {
        //loop through each Children property unitl I reach the last sub directory
    }
} 
```

我的问题是，如果您不知道对象中子目录的数量，那么创建一个循环来收集信息的最佳方法是什么？

（这可以应用于您不知道对象层次结构的任何类型的对象）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T17:01:46.023

如果您不知道层次结构的深度并且需要向下遍历所有级别，请使用递归函数。下面是一个使用深度优先遍历的例子。

```
using (DirectoryEntry root = new DirectoryEntry(someDN))
{
    DoSomething(root);
}

function DoSomething(DirectoryEntry de)
{
    // Do some work here against the directory entry

    if (de.Children != null)
    {
        foreach (DirectoryEntry child in de.Children)
        {
            using (child)
            {
                DoSomething(child);
            }
        }
    }
} 
```

或者，无需递归，您可以通过添加 Queue 或 Stack 数据结构并存储您已经看到但尚未访问的对象来进行遍历。

```
Queue<DirectoryEntry> queue = new Queue<DirectoryEntry>();
DirectoryEntry root = new DirectoryEntry(someDN);
queue.Add(root);

while (queue.Any())
{
    using (DirectoryEntry de = queue.Dequeue())
    {
        // Do some work here against the directory entry

        if (de.Children != null)
        {
            foreach (DirectoryEntry child in de.Children)
            {
                queue.Enqueue(child);
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T17:06:56.807

您必须将递归函数编写为...

```
DirectoryEntry root = new DirectoryEntry(path);
DoForEveryNode(root);

void DoForEveryNode(DirectoryEntry node)
{
    // do something..

    foreach(DirectoryEntry child in node.Children)
    {
        DoForEveryNode(child);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T17:01:33.153

您可以使用递归调用子级的函数。退出条件：没有更多的孩子等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T17:02:11.077

一种选择是使用递归。将该代码设置在一个函数中，然后在 foreach 循环中调用自身，每次都传递下一个目录（子项）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T17:02:48.177

欢迎来到递归的美妙世界。您需要一个接受 Directory 作为参数的函数。给定该目录，它会查找所有子目录，并为每个子目录...调用自身。

# vba - 如何将小数转换为分数？

> ID：706468
> 
> 赞同：8
> 
> 时间：2009-04-01T16:57:21.370
> 
> 标签：vba

如何将不定小数（即 .333333333...）转换为字符串分数表示（即“1/3”）。我正在使用 VBA，以下是我使用的代码（我在“b = a Mod b”行出现溢出错误：

```
Function GetFraction(ByVal Num As Double) As String

    If Num = 0# Then
        GetFraction = "None"
    Else
        Dim WholeNumber As Integer
        Dim DecimalNumber As Double
        Dim Numerator As Double
        Dim Denomenator As Double
        Dim a, b, t As Double

        WholeNumber = Fix(Num)
        DecimalNumber = Num - Fix(Num)
        Numerator = DecimalNumber * 10 ^ (Len(CStr(DecimalNumber)) - 2)
        Denomenator = 10 ^ (Len(CStr(DecimalNumber)) - 2)
        If Numerator = 0 Then
            GetFraction = WholeNumber
        Else
            a = Numerator
            b = Denomenator
            t = 0

            While b <> 0
                t = b
                b = a Mod b
                a = t
            Wend
            If WholeNumber = 0 Then
                GetFraction = CStr(Numerator / a) & "/" & CStr(Denomenator / a)
            Else
                GetFraction = CStr(WholeNumber) & " " & CStr(Numerator / a) & "/" & CStr(Denomenator / a)
            End If
        End If
    End If
End Function 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-01T17:02:28.160

由于 .333333333 不是 1/3，因此如果不添加一些巧妙的“不舍入”逻辑，您将永远不会得到 1/3，而是 333333333/1000000000。

这是我在学校记得的处理具有周期性十进制表示的数字的解决方案。

数字**0。abcd abcd** ... 等于 abcd/9999。所以 0\. **2357** 2357... 正好等于 2357/9999。只需取那么多 9，因为您的模式很长。0\. **1** 1111... 等于1/9，0\. **12** 1212... 等于 12/99，依此类推。所以试着只搜索一个模式并将分母设置为相应的数字。当然，您必须在某些数字后停下来，因为您永远不会知道该模式是永远重复还是重复多次。而且你会遇到最后一位的舍入误差，所以你仍然需要一些聪明的逻辑。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-17T09:16:13.377

这仅适用于 Excel-VBA，但由于您已将其标记为“VBA”，因此我会建议您这样做。Excel 有一个自定义的“分数”格式，您可以通过“格式化单元格”（或 ctrl-1，如果您愿意）访问它。这种特定的数字格式是 Excel 特定的，因此不适用于 VBA.Format 函数。但是，它*确实*适用于 Excel 公式 TEXT()。（这是 VBA.Format 的 Excel 等价物。可以像这样访问：

```
Sub Example()    
    MsgBox Excel.WorksheetFunction.Text(.3333,"# ?/?")
End Sub 
```

要显示多个数字（示例 5/12），只需增加问号的数量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T17:33:36.620

谷歌搜索“小数到分数”，你会得到数不胜数的结果。

我真的很喜欢[这个](http://www.hpcalc.org/details.php?id=1347)，因为它很简单，有源代码（在 RPL 中，类似于 Forth，大约 25 行），而且速度非常快（它是为在 4 位、4MHz CPU 上运行而编写的）。文档说：

> 在 G. Chrystal 所著*的《代数教科书》*（1889 年第 1 版）的第二部分第 32 章中，介绍并证明了这种改进的连分数算法。奇怪的是，Chrystal 把它说成是古老的知识。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T17:52:00.163

[这个网站](http://www.mindspring.com/~alanh/fracs.html)似乎在 JavaScript 中有一个非常好的实现。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-02T17:04:43.397

Python 在其分数模块中有一个很好的例程。这是将 a/d 转换为最接近的近似值 N/D 的工作部分，其中 D <= 某个最大值。例如，如果您想找到最接近 0.347 的分数，让 n=347,d=1000 和 max_denominator 为 100，您将获得 (17, 49)，它与小于或等于 100 的分母一样接近。 '//' 运算符是整数除法，因此 2//3 给出 0，即 a//b = int(a/b)。

```
def approxFrac(n,d,max_denominator):

    #give a representation of n/d as N/D where D<=max_denominator
    #from python 2.6 fractions.py
    #
    # reduce by gcd and only run algorithm if d>maxdenominator
    g, b = n, d
    while b:
        g, b = b, g%b
    n, d = n/g, d/g
    if d <= max_denominator:
        return (n,d)
    nn, dd = n, d
    p0, q0, p1, q1 = 0, 1, 1, 0
    while True:
        a = nn//dd
        q2 = q0+a*q1
        if q2 > max_denominator:
            break
        p0, q0, p1, q1 = p1, q1, p0+a*p1, q2
        nn, dd = dd, nn-a*dd

    k = (max_denominator-q0)//q1
    bound1 = (p0+k*p1, q0+k*q1)
    bound2 = (p1, q1)
    if abs(bound2[0]*d - bound2[1]*n) <= abs(bound1[0]*d - bound1[1]*n):
        return bound2
    else:
        return bound1 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-01T17:06:07.450

我会乘以 10000000（或任何你想要的取决于精度），然后简化得到的分数（即 n*10000000/10000000）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-01T17:09:17.613

你可以近似它。基本上循环遍历所有分子和分母，直到你得到一个接近你想要的分数。

```
int num = 1;
int den = 1;
double limit == 0.1;
double fraction = num / den;

while(den < 1000000 ) // some arbitrary large denominator
{
    den = den + 1;    
    for(num = 0; num <= den; num++)
    {
        fraction = num / den;
        if(fraction < n + limit && fraction > n - limit)
             return (num + "/" + den);
    }
} 
```

这是一种缓慢且蛮力的算法，但您应该了解总体思路。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-01T17:32:34.530

一般来说，如果你找到有理数的重复部分会更容易。如果你找不到，你会很难过。假设 8.45735735735 的数字...

答案是 8 + 45/100 + 735/999/100 = 8 1523/3330。

整数为 8。加上 45/100 - 即 0.45，即重复部分之前的部分。

重复部分为 735/999。一般来说，取重复部分。让它成为分子。分母是 10^（重复数字的数量）- 1。

取重复部分并将其移动适当的位数。在这种情况下，二，这意味着除以 100，所以 735/999/100。

一旦你弄清楚了这些部分，你只需要一些使用最大常见分数来添加和减少分数的代码......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-01T17:45:31.067

类似于 CookieOfFortune 的，但它是在 VB 中并且不使用太多的蛮力。

```
Dim tolerance As Double = 0.1   'Fraction has to be at least this close'
Dim decimalValue As Double = 0.125  'Original value to convert'
Dim highestDenominator = 100   'Highest denominator you`re willing to accept'

For denominator As Integer = 2 To highestDenominator - 1
    'Find the closest numerator'
    Dim numerator As Integer = Math.Round(denominator * decimalValue)

    'Check if the fraction`s close enough'
    If Abs(numerator / denominator - decimalValue) <= tolerance Then
        Return numerator & "/" & denominator
    End If
Next

'Didn't find one.  Use the highest possible denominator'
Return Math.Round(denominator * decimalValue) & "/" & highestDenominator 
```

...让我知道它是否需要考虑大于 1 的值，我可以调整它。

**编辑：** 很抱歉搞砸了语法突出显示。我不明白为什么这一切都错了。如果有人知道我如何使它变得更好，请告诉我。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-01T17:03:38.593

1/ .3333333333 = 3 因为 1/3 = .3333333333333，所以无论你得到什么数字，

双倍 x = 1 / yourDecimal; int y = Math.Ceil(x);

现在显示“1/”+ y

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-01T17:04:26.423

它并非总是可解的，因为并非所有小数都是分数（例如 PI 或 e）。

此外，您必须在转换之前将小数四舍五入到一定长度。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-08-16T12:23:40.993

我在这个链接上分享了一个答案：[https ://stackoverflow.com/a/57517128/11933717](https://stackoverflow.com/a/57517128/11933717)

它也是一个迭代函数，但与在嵌套循环中查找分子和分母不同，它只测试分子，因此应该更快。

下面是它的工作原理 ：

它假设，根据用户输入 x，您想要找到 2 个整数 n / m 。

*   n/m = x ，这意味着
*   n/x 应该给出一个*几乎*整数 m

假设需要找到 x = 2.428571 的分数。将 int 2 放在一边以备后用，算法首先设置 n 和 x 并迭代 n ：

```
// n / x       = m ( we need m to be an integer )
// n = 1 ; x = .428571 ;
   1 / .428571 = 2.333335 (not close to an integer, n++)
   2 / .428571 = 4.666671 (not close to an integer, n++)
   3 / .428571 = 7.000007 
```

此时 n = 3，我们认为 m = 7.000007*足够*整数——基于程序员决定的某种精度——我们回复用户

```
2.428571 =   2  + 3/7 
         = 14/7 + 3/7
         = 17/7 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-02-10T06:02:37.087

我知道这是一个旧线程，但我在 Word VBA 中遇到了这个问题。由于 8 位（16 位）舍入以及 Word VBA 将小数转换为科学记数法等，存在很多限制。但是在解决了所有这些问题之后，我有一个很好的功能，我想分享它提供一些您可能会发现有用的额外功能。

该策略与 Daniel Buckner 所写的内容一致。基本上：第一个）决定它是否是终止小数第二个）如果是，只需设置小数尾部/ 10^n 并减少分数。
3）如果它没有终止，尝试找到一个重复模式，包括重复没有立即开始的情况

在我发布函数之前，这里是我对风险和限制的一些观察，以及一些可以帮助您理解我的方法的注释。

风险、限制、说明：

-> 可选参数“denom”允许您指定分数的分母，如果您希望它四舍五入。即对于英寸，您可能希望使用 16 分。然而，分数仍然会减少，所以 3.746 --> 3 12/16 --> 3 3/4

-> 可选参数“buildup”设置为 True 将使用方程式编辑器构建分数，将文本直接输入到活动文档中。如果您希望该函数简单地返回分数的平面字符串表示，以便您可以通过编程方式存储它等，请将其设置为 False。

-> 一个小数可以在一堆重复后终止......这个函数将假设无限重复。

-> 变量类型 Double 将整数位换成小数位，总共只允许 16 位数字（无论如何从我的观察来看！）。此函数假定如果一个数字使用了所有 16 个可用数字，那么它必须是一个重复的小数。诸如 123456789876.25 之类的大数字会被误认为是重复的小数，然后在找不到模式时返回为十进制数。

-> 要表达 10^n 中非常大的终止小数，VB 似乎只能处理 10^8。我将原始数字四舍五入到小数点后 8 位，可能会失去一些准确性。

-> 对于将重复模式转换为分数背后的数学，请查看[此链接](http://www.quickanddirtytips.com/education/math/how-convert-decimals-don%E2%80%99t-start-repeating-right-away-fractions)

-> 使用[欧几里得算法](https://en.wikipedia.org/wiki/Euclidean_algorithm)减少分数

好的，就是这样，写成 Word 宏：

```
Function as_fraction(number_, Optional denom As Integer = -1, Optional buildup As Boolean = True) As String
    'Selection.TypeText Text:="Received: " & CStr(number_) & vbCrLf
    Dim number As Double
    Dim repeat_digits As Integer, delay_digits As Integer, E_position As Integer, exponent As Integer
    Dim tail_string_test As String, tail_string_original As String, num_removed As String, tail_string_removed As String, removed As String, num As String, output As String
    output = "" 'string variable to build into the fraction answer
    number = CDbl(number_)
    'Get rid of scientific notation since this makes the string longer, fooling the function length = digits
    If InStr(CStr(number_), "E+") > 0 Then 'no gigantic numbers! Return that scientific notation junk
        output = CStr(number_)
        GoTo all_done
    End If

    E_position = InStr(CStr(number), "E") 'E- since postives were handled
    If E_position > 0 Then
        exponent = Abs(CInt(Mid(CStr(number), E_position + 1)))
        num = Mid(CStr(number_), 1, E_position) 'axe the exponent
        decimalposition = InStr(num, ".") 'note the decimal position
        For i_move = 1 To exponent
            'move the decimal over, and insert a zero if the start of the number is reached
            If InStr(num, "-") > 0 And decimalposition = 3 Then 'negative sign in front
               num = "-0." & Mid(num, InStr(num, ".") - 1, 1) & Mid(num, InStr(num, ".") + 1) 'insert a zero after the negative
            ElseIf decimalposition = 2 Then
               num = "0." & Mid(num, InStr(num, ".") - 1, 1) & Mid(num, InStr(num, ".") + 1) 'insert in front
            Else 'move the decimal over, there are digits left
               num = Mid(num, 1, decimalposition - 2) & "." & Mid(num, decimalposition - 1, 1) & Mid(num, decimalposition + 1)
               decimalposition = decimalposition - 1
            End If
        Next
    Else
        num = CStr(number_)
    End If
    'trim the digits to 15, since VB rounds the last digit which ruins the pattern. i.e. 0.5555555555555556  etc.
    If Len(num) >= 16 Then
        num = Mid(num, 1, 15)
    End If
    number = CDbl(num) 'num is a string representation of the decimal number, just to avoid cstr() everywhere
    'Selection.TypeText Text:="number = " & CStr(number) & vbCrLf

    'is it a whole number?
    If Fix(number) = number Then 'whole number
        output = CStr(number)
        GoTo all_done
    End If

    decimalposition = InStr(CStr(num), ".")
    'Selection.TypeText Text:="Attempting to find a fraction equivalent for " & num & vbCrLf
    'is it a repeating decimal? It will have 16 digits
    If denom = -1 And Len(num) >= 15 Then 'repeating decimal, unspecified denominator
        tail_string_original = Mid(num, decimalposition + 1) 'digits after the decimal
        delay_digits = -1 'the number of decimal place values removed from the tail, in case the repetition is delayed. i.e. 0.567777777...
        Do 'loop through start points for the repeating digits
            delay_digits = delay_digits + 1
            If delay_digits >= Fix(Len(tail_string_original) / 2) Then
                'Selection.TypeText Text:="Tried all starting points for the pattern, up to half way through the tail.  None was found.  I'll treat it as a terminating decimal." & vbCrLf
                GoTo treat_as_terminating
            End If
            num_removed = Mid(num, 1, decimalposition) & Mid(num, decimalposition + 1 + delay_digits) 'original number with decimal values removed
            tail_string_removed = Mid(num_removed, InStr(CStr(num_removed), ".") + 1)
            repeat_digits = 0 'exponent on 10 for moving the decimal place over
            'Selection.TypeText Text:="Searching " & num_removed & " for a pattern:" & vbCrLf
            Do
                repeat_digits = repeat_digits + 1
                If repeat_digits = Len(tail_string_removed) - 1 Or repeat_digits >= 9 Then 'try removing a digit, incase the pattern is delayed
                    Exit Do
                End If
                tail_string_test = Mid(num_removed, decimalposition + 1 + repeat_digits)
                'Selection.TypeText Text:=vbTab & "Comparing " & Mid(tail_string_removed, 1, Len(tail_string_removed) - repeat_digits) & " to " & tail_string_test & vbCrLf
                If Mid(tail_string_removed, 1, Len(tail_string_removed) - repeat_digits) = tail_string_test Then
                    'Selection.TypeText Text:=num & ", " & Mid(tail_string_removed, 1, Len(tail_string_removed) - repeat_digits) & " vs " & tail_string_test & vbCrLf
                    GoTo foundpattern
                End If
            Loop

        Loop 'next starting point for pattern

foundpattern:
        If delay_digits = 0 Then 'found pattern right away
            numerator = CLng(Mid(CStr(number), decimalposition + 1 + delay_digits, CInt(repeat_digits)))

            'generate the denominator nines, same number of digits as the numerator
            bottom = ""
            For i_loop = 1 To repeat_digits
                bottom = bottom & "9"
            Next
            denominator = CLng(bottom)
        Else 'there were numbers before the pattern began
            numerator = CLng(Mid(num, decimalposition + 1, delay_digits + repeat_digits)) - CLng(Mid(num, decimalposition + 1, delay_digits))
            'i.e. x = 2.73232323232...  delay_digits = 1, repeat_digits = 2, so numerator = 732 - 7 = 725
            bottom = ""
            For i_loop = 1 To repeat_digits
                bottom = bottom & "9"
            Next
            For i_loop = 1 To delay_digits
                bottom = bottom & "0"
            Next
            denominator = CLng(bottom)
            'i.e. 990...  725/990 = 145/198 = 0.7323232...
        End If

    Else ' terminating decimal
treat_as_terminating:
       'grab just the decimal trail
       If denom = -1 Then
            number = Math.Round(number, 8) 'reduce to fewer decimal places to avoid overload
             'is it a whole number now?
            If Fix(number) = number Then 'whole number
                output = CStr(number)
                GoTo all_done
            End If
            num = CStr(number)
            numerator = CLng(Mid(num, decimalposition + 1))
            denominator = 10 ^ (Len(num) - InStr(num, "."))
       Else 'express as a fraction rounded to the nearest denom'th reduced
            numerator1 = CDbl("0" & Mid(CStr(num), decimalposition))
            numerator = CInt(Math.Round(numerator1 * denom))
            denominator = CInt(denom)
       End If
    End If

    'reduce the fraction if possible using Euclidean Algorithm
    a = CLng(numerator)
    b = CLng(denominator)
    Dim t As Long
    Do While b <> 0
        t = b
        b = a Mod b
        a = t
    Loop
    gcd_ = a

    numerator = numerator / gcd_
    denominator = denominator / gcd_
    whole_part = CLng(Mid(num, 1, decimalposition - 1))

    'only write a whole number if the number is absolutely greater than zero, or will round to be so.
    If whole_part <> 0 Or (whole_part = 0 And numerator = denominator) Then
        'case where fraction rounds to whole
        If numerator = denominator Then
            'increase the whole by 1 absolutely
            whole_part = (whole_part / Abs(whole_part)) * (Abs(whole_part) + 1)
        End If
        output = CStr(whole_part) & " "

    End If

    'if fraction rounded to a whole, it is already included in the whole number
    If numerator <> 0 And numerator <> denominator Then
        'negative sign may have been missed, if whole number was -0
        If whole_part = 0 And number_ < 0 Then
            numerator = -numerator
        End If
        output = output & CStr(numerator) & "/" & CStr(denominator) & " "

    End If
    If whole_part = 0 And numerator = 0 Then
        output = "0"
    End If
all_done:
    If buildup = True Then 'build up the equation with a pretty fraction at the current selection range
        Dim objRange As Range
        Dim objEq As OMath
        Dim AC As OMathAutoCorrectEntry
        Application.OMathAutoCorrect.UseOutsideOMath = True
        Set objRange = Selection.Range
        objRange.Text = output
        For Each AC In Application.OMathAutoCorrect.Entries
            With objRange
                If InStr(.Text, AC.Name) > 0 Then
                    .Text = Replace(.Text, AC.Name, AC.Value)
                End If
            End With
        Next AC
        Set objRange = Selection.OMaths.Add(objRange)
        Set objEq = objRange.OMaths(1)
        objEq.buildup

        'Place the cursor at the end of the equation, outside of the OMaths object
        objRange.OMaths(1).Range.Select
        Selection.Collapse direction:=wdCollapseEnd
        Selection.MoveRight Unit:=wdCharacter, count:=1
        as_fraction = "" 'just a dummy return to make the function happy
    Else 'just return a flat string value
        as_fraction = output
    End If
End Function 
```

# c++ - 测试位以创建字符串 - 有更好的方法吗？

> ID：706477
> 
> 赞同：2
> 
> 时间：2009-04-01T16:59:54.360
> 
> 标签：c++, c, string, loops, bit-manipulation

这段代码有效，但我想知道是否有更好的方法来做到这一点。基本上我需要测试位，并根据位的状态将适当的字符写入字符串。存在空格是因为字符将以固定宽度的字体显示，我想防止它们四处移动。C 或 C++ 都可以。

```
const char* Letters[10] = {"A", "B", "Sl", "St", "R", "L", "U", "D", "RS", "LS"};
const char* Ext[2] = {"X", "Y"};
const char* Spaces[10]  = {" ", " ", "  ", "  ", " ", " ", " ", " ", "  ", "  "};

char str[60];
char FinalString[60];

void MakeBitString(u16 data, u16 dataExt) {

    int x;
    strcpy(str, "");

    for (x = 0; x < 2; x++) {

        //X and Y
        if(dataExt & (1 << x)) {
            strcat(str, Spaces[x]); 
        }
        else
            strcat(str, Ext[x]);
    }

    for (x = 0; x < 10; x++) {

        //the rest
        if(data & (1 << x)) {
            strcat(str, Spaces[x]); 
        }
        else
            strcat(str, Letters[x]);
    }

    strcpy(FinalString, str);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T17:12:59.273

*   使用 std::string 代替 char* 和 strcat；
*   为什么需要带空格的数组？似乎只有一个空间；
*   您的两个 u16 参数的代码几乎相同 - 创建一个小函数并调用它两次；
*   不要将结果写入全局变量 - 返回 std::string

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T19:14:32.553

基本上 C++ 解决方案看起来像

```
Codes convert( std::size_t data,
               const Codes& ext, 
               const Codes& letters )
{
    Codes result;
    std::transform( ext.begin(),
                    ext.end(),
                    std::back_inserter( result ),
                    Converter( data ) );

    std::transform( letters.begin(),
                    letters.end(),
                    std::back_inserter( result ),
                    Converter( data ) );
    return result;
} 
```

在哪里`Converter`实施

```
struct Converter
{
    Converter( std::size_t value ):
        value_( value ), x_( 0 )
    {}
    std::string operator() ( const std::string& bitPresentation )
    {
        return ( value_ & ( 1 << x_++ ) ) ?
            std::string( bitPresentation.size(), ' ' ):
            bitPresentation;
    }
    std::size_t value_;
    std::size_t x_;
}; 
```

这是从代码转换为字符串的函数

```
std::string codesToString( const Codes& codes )
{
    std::ostringstream stringStream;
    std::copy( codes.begin(), codes.end(), 
               std::ostream_iterator<std::string>( stringStream ) );
    return stringStream.str();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T18:04:24.843

我推荐一些更明确的东西，它不使用循环，因为您似乎只有少量位要检查。如果这需要扩展到数万位，那么一定要使用循环。

我还假设您有充分的理由使用全局变量和固定长度的字符数组。

这是我要做的：

```
char FinalString[60];

void ConcatBitLabel(char ** str, u16 data, u16 bitMask, const char * label)
{
    if (data & bitMask)
    {
        // append spaces for strlen(label)
        while (*label) { *((*str)++) = ' '; label++; }
    }
    else
    {
        // append the label
        while (*label) { *((*str)++) = *label; label++; }
    }
}

void MakeBitString(u16 data, u16 dataExt)
{
    char * strPtr = FinalString;

    ConcatBitLabel(&strPtr, dataExt, 0x0001, "X");
    ConcatBitLabel(&strPtr, dataExt, 0x0002, "Y");

    ConcatBitLabel(&strPtr, data, 0x0001, "A");
    ConcatBitLabel(&strPtr, data, 0x0002, "B");
    ConcatBitLabel(&strPtr, data, 0x0004, "Sl");
    ConcatBitLabel(&strPtr, data, 0x0008, "St");
    ConcatBitLabel(&strPtr, data, 0x0010, "R");
    ConcatBitLabel(&strPtr, data, 0x0020, "L");
    ConcatBitLabel(&strPtr, data, 0x0040, "U");
    ConcatBitLabel(&strPtr, data, 0x0080, "D");
    ConcatBitLabel(&strPtr, data, 0x0100, "RS");
    ConcatBitLabel(&strPtr, data, 0x0200, "LS");

    *strPtr = 0; // terminate the string
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T17:27:05.900

以一些动态分配为代价（在 std::string 内部），您可以通过不使用任何硬编码数字来更轻松地修改此代码：

```
#define ARRAYSIZE(A) (sizeof(A)/sizeof((A)[0]))

std::string MakeBitString(u16 data, const std::string* letters, int count) {
    std::string s;
    for (int x = 0; x < count; x++) {
        if (data & (1 << x))
            s.append(letters[x].size(), ' '); 
        else
            s += letters[x];
    }
    return s;
}

std::string MakeBitString(u16 data, u16 dataExt) {
    const std::string Letters[] = {"A", "B", "Sl", "St", "R", "L", "U", "D", "RS", "LS"};
    const std::string Ext[] = {"X", "Y"};

    std::string s = MakeBitString(dataExt, Ext, ARRAYSIZE(Ext));
    s += MakeBitString(dataExt, Letters, ARRAYSIZE(Letters));
    return s;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-02T20:14:25.173

非hacky，干净的解决方案：

```
std::string MakeBitString(u16 data, u16 dataExt) {
    std::string ret;

    static const char *letters = "A B SlStR L U D RSLS";
    static const char *ext = "XY";
    static const char *spaces = "  ";

    for(int bit = 0; bit < 2; ++bit) {
        const char *which = (dataExt & 1) ? &ext[bit] : spaces;

        ret += std::string(which, 0, 1);

        dataExt >>= 1;
    }

    for(int bit = 0; bit < 10; ++bit) {
        const int length = letters[bit * 2 + 1] == ' ' ?  1 : 2;
        const char *which = (dataExt & 1) ? &letters[bit * 2] : spaces;

        ret += std::string(which, 0, length);

        dataExt >>= 1;
    }

    return ret;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T17:27:21.423

那应该没问题；但是，如果您想添加按钮或轴，您可能需要对其进行概括。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-02T19:58:17.240

这是一次完成的一种有点棘手的方法。它甚至可以扩展到最多 16 位，只要您确保`wide`掩码在具有 2 字符指示符的任何位置都设置了位。

```
#define EXT_STR "XY"
#define DATA_STR "ABSlStRLUDRSLS"
const char FullStr[] =  EXT_STR DATA_STR;
#define  EXT_SZ  2 //strlen(EXT_STR);

void MakeBitStr(u16 data, u16 dataExt) {
    char* dest = FinalString;
    const char* src= FullStr;
    u16 input = (data<<EXT_SZ)|dataExt;
    u16 wide = (0x30C<<EXT_SZ)|0;  //set bit for every 2char tag;
    while ((src-FullStr)<sizeof(FullStr))
    {   *dest++ = (input&1)?' ':*src;
        if (wide&1)
        { wide&=~1;
        }
        else
        { input>>=1;wide>>=1;
        }
        src++;
    }
    *dest='\0';
} 
```

# deployment - Outlook 加载项保存配置的位置，C#

> ID：706479
> 
> 赞同：2
> 
> 时间：2009-04-01T17:00:54.107
> 
> 标签：deployment, outlook, outlook-addin

我正在使用 VS2008、C# 为 Outlook 开发一个加载项。

我试图找出一种方法来允许用户在安装过程中指定一些设置并在加载项中使用它们。

寻求方法我不必编写使用注册表。

先谢谢了~

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T23:22:47.053

谢谢，

实际上，我决定阅读安装位置的 Outlook 插件注册表，并在安装期间将配置文件复制到那里。到目前为止它工作正常:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-09T23:27:42.117

Its an Addin, so how exactly is

> app.config, and make sure that it's copied to dll directory?

going to help?

Basically you would need to create a file called Outlook.exe.config and put it in the Office12 folder with Outlook.exe (c:\Program Files\Microsoft Office\Office12)

If you do this it will get loaded, the only potential issue is that it is also available to any other addins that are loaded into the outlook.exe process. A better idea is just as the OP suggested an use an arbitary config file copied to the targetdir and read it from there.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T17:03:31.370

app.config，并确保它被复制到 dll 目录？

# javascript - 使用原型的Javascript类变量范围

> ID：706492
> 
> 赞同：0
> 
> 时间：2009-04-01T17:04:31.667
> 
> 标签：javascript, class, variables, scope, prototypejs

我正在使用prototype.js 编写一个基本类，其中在初始化类时设置了一些类变量-问题是这些变量对类中的其他方法不可用。

```
var Session = Class.create({
initialize: function(){
    // define defaults
    this.source = '';
},
shout: function(){
    alert(this.source);
}}); 
```

我知道这与范围有关，我确信这是一个相当基本的问题 - 感谢所有帮助！

谢谢，亚当

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T17:13:11.940

我测试了你的代码。据我所知，它有效。也许将变量设置为空字符串会让你失望？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T17:13:52.407

看起来不错......它对我有用。

```
document.observe('dom:loaded', function() {
    var s = new Session();
    s.shout();
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T17:21:15.090

你遇到了什么错误？我已经尝试了许多排列，但无法重现任何看起来像您报告的问题的东西。

# .net - 使用不安全代码有什么影响

> ID：706495
> 
> 赞同：23
> 
> 时间：2009-04-01T17:05:38.153
> 
> 标签：.net, clr, unmanaged, unsafe, fixed

除了代码本身可以直接访问内存之外。使用“/unsafe”编译器标志和“fixed”关键字的其他含义是什么？是否有与我的 .exe 的代码签名和部署相关的影响（我的应用程序仅适用于桌面）？

（这不是关于我是否应该这样做，*为什么*我的问题[在这里](https://stackoverflow.com/questions/702188/can-this-code-be-optimised)）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-01T17:26:36.293

您可以将含义分为两个桶。

首先是它如何影响您的应用程序环境。使用不安全代码要求您的程序集在完全信任的环境中运行。无法在受限环境中运行，例如某些 Click Once 安全设置。原因是不安全的代码会阻止 CLR 确保类型安全。尽管没有安全限制，但单击一次应该不会有问题。

第二个是它对你编码方式的意义。使用不安全代码通常涉及使用指针，特别是使用指针通过 PInvoke 执行高级编组。但是，这些行为中的任何一个都没有本质上的错误。与“安全”代码相比，它只需要对 CLR 和编组有更多的了解。对象固定是您在开始使用这些功能之前需要牢牢掌握的知识的一个很好的例子。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-01T17:20:09.757

不安全的代码是不可验证的，所以你必须意识到这一点。在完全信任环境中，这没什么大不了的，但如果您有其他环境具有更受限制的权限集，那么这可能会影响您。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T17:35:27.097

要添加到 Jared 对对象固定的引用...

在 C# 中使用指针直接访问内存时，您很容易受到 CLR 在运行时在内存中移动对象的攻击。这意味着您的指针可能会突然指向错误的内存部分。[Fixed](http://www.dotnetmonster.com/Uwe/Forum.aspx/dotnet-csharp/34463/C-fixed-keyword-explaination)关键字会将对象固定在内存中，从而可以避免此问题。

# c# - 您如何看待我的 IDisposable 模式实现？

> ID：706497
> 
> 赞同：2
> 
> 时间：2009-04-01T17:06:34.327
> 
> 标签：c#, .net, design-patterns, idisposable

您如何看待以下`IDisposable`模式实现？

```
public class Connection : IDisposable 
{
    private Socket _socket;

    public bool IsConnected()
    {
        if (_socket.Poll(1, SelectMode.SelectRead) && _socket.Available == 0)
            return false;
        return true;
    }

    public void Disconnect()
    {
        if (m_socket != null && IsConnected())
        {
            try
            {
                _socket.Shutdown(SocketShutdown.Both);
                _socket.Disconnect(false);
            }
            catch (SocketException se)
            {
                System.Console.WriteLine(se.Message);
            }
        }
    }

    ~Connection()
    {
        Dispose(false);
    }

    private void Dispose(bool disposing)
    {
        if (!IsConnected())
        {
            if (disposing)
            {
                Disconnect();
            }
            else
            {
                AppDomain currentDomain = AppDomain.CurrentDomain;
                if (currentDomain.IsFinalizingForUnload() && !Environment.HasShutdownStarted)
                {
                     System.Console.WriteLine("Client failed to call Destroy");
                }
            }
        }
    }
} 
```

使用上面的代码给了我这个错误：

> {“尝试对非套接字的操作”} System.Net.Sockets.Socket.Poll(Int32 microSeconds, SelectMode 模式)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-01T17:10:24.740

实施存在严重缺陷。你没有真正实现[`IDisposable`](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)，你最终依赖垃圾收集器来清理你的资源，这是一件坏事。

此外，当 GC 确实出现时，您甚至没有正确清理这些资源（它确实正确地清理了这些资源，但它发生是错误的）。

`IDisposable`当您持有实施的引用时，您的班级有责任实施`IDisposable`。然后，在您的实现中[`Dispose`](http://msdn.microsoft.com/en-us/library/system.idisposable.dispose.aspx)，如果您没有被 GCed（这是对 的显式调用`Dispose`），您将调用您所持`Dispose`有的任何`IDisposable`实现。

您检查 的连接状态`Socket`，但这与调用`Dispose`它不同，因此您泄漏了资源（GC 最终将其拾取）。

有关如何正确实施 的指南`IDisposable`，请参阅 MSDN 文档中标题为“实施 Finalize 和 Dispose 以清理非托管资源”的部分，该部分位于此处：

[http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.71).aspx](http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.71).aspx)

我应该指出，我并不完全同意这些指导方针，但它们是最被采用的。对于我的立场，请参见此处：

[http://www.caspershouse.com/post/A-Better-Implementation-Pattern-for-IDisposable.aspx](http://www.caspershouse.com/post/A-Better-Implementation-Pattern-for-IDisposable.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:17:29.337

这个实现是有缺陷的，有几个原因。

首先，您的 Dispose() 方法应该有一个目的 - 调用`socket.Dispose();`. 现在，您在其中放置了太多逻辑，而实际上并没有“处理”您拥有的单个托管 IDisposable 资源。

其次，您根本不需要终结器，因为您不直接拥有或分配任何本机、非托管资源。您要处理的唯一资源是 Socket，它是托管的，并将根据需要实现自己的终结器。如果您想捕获并找到未正确处理 Connection 的情况，我将设置一个仅调试终结器来警告该情况。IDisposable 中的终结器旨在处理 GC 必须进行清理的情况，因为调用者忘记调用 Dispose() - 在您的情况下，套接字的终结器将为您处理。

第三，Microsoft 设计指南中建议的 IDisposable 模式的一部分指出，客户端应该能够多次调用 Dispose() 而不会产生任何后果。在第一次调用 Dispose() 之后，不应该直接使用套接字 - 事实上，我建议 Dispose() 应该调用`socket.Close();`or`(socket as IDisposable).Dispose();`并立即设置`socket = null;`以防止这种情况发生。使用您当前的逻辑，很可能有调用`IsConnected()`导致套接字在随后调用 Dispose() 时抛出异常，这应该避免。

第四，强烈建议对所有使用文件、套接字或其他“可关闭”资源的资源使用 Close() 方法。Close() 应该调用 Dispose()。

最后，应该在处置后检查连接的使用。处置后使用的连接上的任何方法都应引发 ObjectDisposedException。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T18:25:22.953

这似乎没有在其他答案中明确说明，所以如果您对具体出了什么问题感兴趣，就在这里。

当两个对象具有终结器并被 GC 回收时，它们的终结器执行的顺序没有特定的顺序。在您的代码中，Socket 类有一个终结器，而您的类有一个终结器。如果终结器首先在 Socket 实例上执行，那么当终结器执行时，您将尝试调用已终结对象上的方法，因此会出现异常。

终结者基本上很烂。您几乎不需要编写一个（即使您正在处理原始的 Win32 句柄 - 请`SafeHandle`改用。）

相反，只需实现 IDisposable，不要编写终结器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T17:10:43.897

首先，你为什么不实施[`IDisposable`](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)？

这将向您的对象的用户明确指示他们在完成后实际上需要处理它。然后他们也可以将其包装在一个`using`块中等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T17:29:57.157

这是我过去使用的一次性模式（我建议从这个开始）：

```
public class Connection : IDisposable
{
    #region Dispose pattern

    /// <summary>
    /// Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.
    /// </summary>
    /// <filterpriority>2</filterpriority>
    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    private void Dispose(bool disposing)
    {
        ReleaseUnmanagedResources();
        if (disposing)
            ReleaseManagedResources();
    }

    /// <summary>
    /// Derived classes from this class should override this method
    /// to clean up managed resources when Dispose is called.
    /// </summary>
    protected virtual void ReleaseManagedResources()
    {
        // Enter managed resource cleanup code here.
    }

    /// <summary>
    /// Derived classes should override this method to clean up
    /// unmanaged resources when Dispose is called.
    /// </summary>
    protected virtual void ReleaseUnmanagedResources()
    {
        // Enter unmanaged resource cleanup code here.
    }

    #endregion 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-01T17:58:31.973

我只想将此添加到理查森指出的模式中

```
private bool disposed;

private void Dispose(bool disposing)
{
    if(!this.disposed)
    {
        ReleaseUnmanagedResources();
        if (disposing)
            ReleaseManagedResources();
        this.disposed = true;
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-02T00:33:19.980

终结器很痛苦，如果可能的话，你应该避免*调用它们。**但是*，如果您实现了 IDisposable，您几乎总是希望编写一个（结合 Dispose(bool) 方法）。这调用了 Dispose(false) 和 GC.SuppressFinalize()。

如果您没有实现终结器，那么除非您持有的任何 IDisposable 实例正确地实现了终结器，否则您将泄漏。例如说 SafeHandle 没有终结器但依赖于调用 Dispose 的人？如果你持有一个，并且没有实现终结器，那么你允许你的消费者通过不调用 Dispose 来永久泄漏句柄！

假设你的消费者和你消费的对象都会玩得很好，这并不是你自己不玩得好的理由。

此外，即使您使用 SafeHandle，您也应该像处理托管对象一样处理它。否则，如果您根本不处理它，那么它将不得不等到 GC 被释放，如果您在 Dispose 中处理它但没有终结器，并且没有人处理您，那么它将不得不等待直到收集你的那个GC之后。

上面的 b_richardson 具有正确的模式，这并不难，并且通过添加 GC.SuppressFinalize() 可以避免两次 GC，除非没有正确处理您。

至于添加一个布尔值来跟踪我们是否已经被 Disposed，这会起作用，我更喜欢将我的 Dispose 方法编写为可重新运行（检查 null 等）也有助于在对象时这样做可能会在使用过程中获取资源，您只想处置它拥有的资源。

# sql - 为什么 Oracle 认为我缺少右括号？

> ID：706503
> 
> 赞同：11
> 
> 时间：2009-04-01T17:07:53.280
> 
> 标签：sql, oracle, ora-00907

在 Oracle 10i 中，我正在运行以下命令：

```
ALTER TABLE jnrvwchnglst ADD
     ( jnrvwchnglst_userid NUMBER(10) NOT NULL DEFAULT 1 ) 
```

Yes`jnrvwchnglst`是现有表，no`jnrvwchnglst_userid`不是现有列。

Oracle 错误消息是：

```
ORA-00907: missing right parenthesis 
```

这个查询有什么问题，为什么 Oracle 认为我缺少括号？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-01T17:09:41.887

```
ALTER TABLE jnrvwchnglst ADD
     ( jnrvwchnglst_userid NUMBER(10) DEFAULT 1  NOT NULL ) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-10-11T16:46:01.227

“（NOT）NULL”在语法上必须是“ALTER”中的最后一个语句，所以当Oracle看到 - 并且下一个字符（您的“DEFAULT” stmt）不是预期的终止权“）”时，抛出错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T17:17:57.123

在您无法添加列并在同一语句中设置默认/约束之前，我遇到过这个问题。“缺少右括号”是一个红鲱鱼。Oracle 喜欢在与括号无关的情况下使用该错误（我的猜测是它们的解析逻辑一直到 00907）。

尝试

```
ALTER TABLE jnrvwchnglst ADD ( nrvwchnglst_userid NUMBER(10) );
ALTER TABLE jnrvwchnglst ALTER ( nrvwchnglst_userid  SET DEFAULT 1 );
UPDATE jnrvwchnglst SET nrvwchnglst_userid = 1 WHERE nrvwchnglst_userid IS NULL;
ALTER TABLE jnrvwchnglst  ALTER ( nrvwchnglst_userid  SET NOT NULL ); 
```

# vba - 在 VBA 宏中打开/激活 Word 文档

> ID：706516
> 
> 赞同：10
> 
> 时间：2009-04-01T17:10:55.113
> 
> 标签：vba, ms-word

我希望 VB/VBA 专家可以帮助我。考虑以下情况：用户在 Word 2003 中打开一个文档，在 Normal.dot`AutoOpen`宏中，我们查看当前文档，如果它是通过单击网页上的链接打开的，并且满足某些其他特定于应用程序的条件，关闭流式传输的“副本”并打开源文档（在我们可以假设用户有权访问的共享驱动器上找到）：

```
Documents.Open origDoc
Documents(ActiveDocument.FullName).Close SaveChanges:=wdDoNotSaveChanges
Documents(origDoc).Activate

With ActiveDocument
    ''# Do work
End With 
```

我的想法是我需要调用`Activate`以确保原始文档是 . `ActiveDocument`，但我在`.Activate`调用时收到 4160 'Bad file name' 错误。如果我注释掉对 的调用`.Activate`，它似乎`ActiveDocument`设置为 origDoc 文档，即使已经打开了其他文档（我不太确定 Documents Collection 是如何管理的，以及 Word 如何确定接下来`ActiveDocument`会发生什么，如果你以编程方式关闭当前 ActiveDocument）

那么，调用`.Open`文档是否明确地将 Document 设置为`ActiveDocument`? 另外，调用`.Activate`已经激活的文档会导致错误吗？

我真的无法找到很多关于此的文档，所以提前感谢您的任何建议和见解！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-12-04T16:08:57.000

简单的答案是肯定的。通过使用您的代码打开文档，您可以将其设置为活动文档，然后您在下一行关闭它并尝试在下一行激活，但由于文档不再打开而失败。VBA 通常似乎以这种方式工作。

小心使用 ActiveDocument 很重要，因为代码或其他地方的哪些操作会使文档“激活”并不总是不言而喻的（我没有证据，但即使是自动保存也可能会这样做）。如果有任何疑问，您最好通过 Documents 集合引用文档，尽管如果文档不再打开，这也会导致错误，并且您可能不得不求助于遍历集合以确保文档是，其实开。我在使用 excel VBA 时经常遇到这种情况，而 Word VBA 在这方面的功能似乎相同。

此外，VBA 在释放应用程序对象方面存在问题。如果你不小心，你最终会得到多个 WINWORD 进程，可以在任务管理器中查看，无论你是在代码中关闭还是退出它们。我发现解决此问题的代码相当于模拟在任务管理器中选择 END PROCESS 的过程。它有效，但应该有更好的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-08-03T16:47:38.280

请注意，可能会遇到各种问题：

1.  如果您想在关闭文档后重新打开它......Word/Windows 不会“释放”文件名，您会收到“*文件忙*”消息或有关*“创建临时副本*”的消息。为了解决这个问题，我不得不开发一个精心设计的系统来创建/保存和整理我在 Word 应用程序中打开/操作的任何其他文档的多个版本，因为 Office `Open`/ `Close`/`Save`方法中的这个设计缺陷。

2.  将`ReadOnlyRecommended`属性设置为`False`与 `.Open`方法一起使用

3.  `doc`如果在尝试操作之前不能确保该对象仍然存在，那么引用文档对象（上面名为 doc）可能会导致严重错误。永远记住，Word 是一个“开放”的应用程序平台......用户可能会在最后几毫秒左右做一些你没想到的事情。此建议适用于您可能希望在 Word 中操作的任何其他对象或属性。

4.  如果您操作 Documents 集合（或任何其他集合）而不确保文档或其他对象仍然存在并且在集合中删除或移动之前有效，您可能会
    收到“*堆栈溢出*”错误。特别是如果您尝试关闭/删除从`.item(1)`. 您必须从最后一个集合中删除项目，并记住，每当您从其中 .add/.remove/.close 项目时，集合 idicies 和指针都会发生变化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:36:00.043

你在这里有一个错误：

```
Document(origDoc).Activate 
```

应该是Document **。**

是的，您可以激活活动文档。然后什么也没有发生。

是的，打开的文档变为活动状态。如果您不确定，请使用`Documents.Open(origDoc).Activate`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-20T09:50:31.687

除非绝对必要，否则您不应该首先使用该`ActiveDocument`对象，因为它非常不可靠。首选的方法是：

```
Documents(ActiveDocument.FullName).Close SaveChanges:=wdDoNotSaveChanges

Dim doc as Document
Set doc = Documents.Open(origDoc)        
With doc
    'Do work
End With 
```

# iphone - 在这种情况下 NSMutableString 是否比 NSString 更有效？

> ID：706519
> 
> 赞同：2
> 
> 时间：2009-04-01T17:11:44.083
> 
> 标签：iphone, objective-c, cocoa-touch

如果我以这种方式声明一个指针变量：

```
NSString *foo; 
```

然后在我的代码后面的某个地方执行以下操作：

```
foo = @"bar"; 
```

这最终会占用我的 NSString，在内存中创建一个带有附加字符串的新副本，然后删除我的初始字符串吗？foo 作为 NSMutableString 会更好吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-01T17:35:09.690

不，`foo`是变量持有指向`NSString`. 该赋值`foo = @"bar"`将指针存储的值设置`foo`为 NSString 的地址`@"bar"`。没有复制。如果`foo`已经指向另一个*不是*字符串常量（即 like ）的`NSString`实例并且没有对该实例的其他引用，那么您就有内存泄漏。你会*`@"bar"`*

 *```
[foo release];
foo = @"bar"; 
```

在这种情况下。您不需要保留或释放字符串常量，例如`@"bar"`.

字符串常量不能被改变，所以如果你试图修改一个常量字符串的值，你会得到一个运行时错误。`@"bar"`分配给 an`NSString*`和 an之间没有区别`NSMutableString*`。`NSMutableString`当然，仅仅因为你将@"bar"（一个NSString 实例）的地址分配给了一个类型为 的变量，你就不能使用 mutating 方法而不会出现运行时错误`NSMutableString*`。如果你想改变字符串，你会做

```
NSMutableString *mutableFoo = [@"bar" mutableCopy]; 
```

在这种情况下，显然制作了一份副本，您有责任`mutableFoo`在完成后发布。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T17:19:47.650

不，您示例中的 @"bar" 是一个字符串常量，应该包含在您的代码中。您无需担心此常量的内存分配/释放。

当您对字符串进行大量小操作（附加子字符串等）并且您不想在各处分配自动释放的 NSString 时，使用 NSMutableString 会更有效。由于循环中的内存问题，如果可以的话，我倾向于避免在 iPhone 上自动释放字符串。

# asp.net - 自定义菜单/上下文菜单鼠标悬停或右键单击

> ID：706521
> 
> 赞同：3
> 
> 时间：2009-04-01T17:12:51.007
> 
> 标签：asp.net, jquery, gridview, menu, contextmenu

我目前有一个 ASP.NET GridView，它向用户显示几列，其中之一是用于查看特定记录详细信息的链接。从详细信息页面，用户可以访问其他页面以添加新记录（例如，从联系人记录页面，您可以单击链接以添加新的车辆购买）。

如果有一个鼠标悬停或右键单击菜单会出现在 GridView 行或任何真正允许用户直接进入添加新车购买页面的项目上，我认为会很棒。我想尝试减少执行特定操作所需的鼠标点击次数和页面点击次数。

是否可以为此提供任何免费组件或代码示例？我知道我以前在一些网络应用程序中看到过它，只是不想重新发明轮子。

我正在使用的应用程序是 ASP.NET 3.5，如果解决方案需要，已经为 jQuery 使用设置......下面是我的网格代码的简要视图。第一列实际上是一个超链接，但我为本示例删除了它。

```
<asp:GridView ID="gvResults" runat="server" DataKeyNames="PERSONID" AutoGenerateColumns="False"
    CellPadding="4" ForeColor="#333333" OnSelectedIndexChanged="gvResults_SelectedIndexChanged"
    Width="100%" OnRowDataBound="gvResults_RowDataBound" meta:resourcekey="gvResultsResource1">
    <AlternatingRowStyle BackColor="White" ForeColor="#284775" />
    <Columns>
        <asp:BoundField DataField="PERSONID" HeaderText="PERSON ID" meta:resourcekey="BoundFieldResource1" />
        <asp:BoundField DataField="FNAME" HeaderText="FIRST NAME" meta:resourcekey="BoundFieldResource2" />
        <asp:BoundField DataField="LNAME" HeaderText="LAST NAME" meta:resourcekey="BoundFieldResource3" />
        <asp:BoundField DataField="DOB" HeaderText="DATE OF BIRTH" HtmlEncode="False" meta:resourcekey="BoundFieldResource4" />
    </Columns>
    <EditRowStyle BackColor="#999999" />
    <EmptyDataTemplate>
        <span style="color: Red;">
            <asp:Literal ID="litErrorNoResultsFound" runat="server" EnableViewState="False" meta:resourcekey="litErrorNoResultsFoundResource1"
                OnInit="litErrorNoResultsFound_Init"></asp:Literal>
        </span>
    </EmptyDataTemplate>
    <FooterStyle BackColor="#5D7B9D" Font-Bold="True" ForeColor="White" />
    <HeaderStyle BackColor="#3494CC" Font-Bold="True" ForeColor="White" HorizontalAlign="Left" />
    <PagerStyle BackColor="#284775" ForeColor="White" HorizontalAlign="Center" />
    <RowStyle BackColor="#F7F6F3" ForeColor="#333333" />
    <SelectedRowStyle BackColor="#E2DED6" Font-Bold="True" ForeColor="#333333" />
</asp:GridView> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T17:16:52.727

这是一个非常好的 jQuery 上下文菜单。

[http://abeautifulsite.net/notebook/80](http://abeautifulsite.net/notebook/80)

演示：[http ://abeautifulsite.net/notebook_files/80/demo/jqueryContextMenu.html](http://abeautifulsite.net/notebook_files/80/demo/jqueryContextMenu.html)

[https://demos.shieldui.com/aspnet/contextmenu/basic-usage](https://demos.shieldui.com/aspnet/contextmenu/basic-usage)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T07:17:26.880

您还可以尝试以下方法中的示例代码。我们也可以动态加载菜单项。

[http://sites.google.com/site/spyderhoodcommunity/tech-stuff/jquerypopupcontextmenu](http://sites.google.com/site/spyderhoodcommunity/tech-stuff/jquerypopupcontextmenu)

# java - 消息驱动的 Bean 选择器 (JMS)

> ID：706525
> 
> 赞同：4
> 
> 时间：2009-04-01T17:13:46.433
> 
> 标签：java, jakarta-ee, jms, jboss-mdb

我最近发现了消息选择器

```
@ActivationConfigProperty(
        propertyName="messageSelector",
        propertyValue="Fragile IS TRUE") 
```

我的问题是：如何在运行时使选择器动态化？

假设消费者决定他们只想要具有“易碎是假”属性的消息

消费者能否在不重新部署 MDB 的情况下以某种方式更改选择器？

注意：我使用的是 Glassfish v2.1

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T19:04:10.160

据我所知，这是不可能的。可能有一些实现将允许它通过一些自定义服务器挂钩，但这将取决于实现。一方面，它需要更改部署描述符，部署 EAR 后不会读取该描述符。

# ruby-on-rails - Ruby on Rails：errors.add_to_base 与 errors.add

> ID：706533
> 
> 赞同：57
> 
> 时间：2009-04-01T17:15:30.093
> 
> 标签：ruby-on-rails, ruby, validation, model

我已经读过 errors.add_to_base 应该用于与对象关联的错误，而不是特定属性。我很难概念化这意味着什么。有人可以提供一个我什么时候想使用每个的例子吗？

例如，我有一个乐队模型，每个乐队都有一个流派。当我验证一个流派的存在时，如果该流派丢失，是否应该将错误添加到基础中？

例子越多越好

谢谢！

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2012-12-05T20:22:12.030

值得注意的是（因为这出现在搜索引擎中，这就是我发现它的方式），这已被弃用。Rails 3 的做法是：

```
errors[:base] << "Error message" 
```

或者

```
errors.add(:base, "Error message") 
```

[http://apidock.com/rails/ActiveRecord/Errors/add_to_base](http://apidock.com/rails/ActiveRecord/Errors/add_to_base)
[http://apidock.com/rails/v3.2.8/ActiveModel/Errors/add](http://apidock.com/rails/v3.2.8/ActiveModel/Errors/add)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-04-01T17:26:39.427

缺少类型将是字段错误。基本错误类似于现有记录的精确副本，其中问题不与任何特定字段相关，而是与整个记录相关（或至少与某些字段组合相关）。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2010-11-01T20:27:07.530

在此示例中，您可以看到字段验证（必须选择团队）。你可以看到一个类/基础级别的验证。例如，您需要至少一种联系方式、电话或电子邮件：

```
class Registrant
  include MongoMapper::Document

  # Attributes ::::::::::::::::::::::::::::::::::::::::::::::::::::::
  key :name, String, :required => true
  key :email, String
  key :phone, String

  # Associations :::::::::::::::::::::::::::::::::::::::::::::::::::::
  key :team_id, ObjectId
  belongs_to :team
...
  # Validations :::::::::::::::::::::::::::::::::::::::::::::::::::::
  validate :validate_team_selection
  validate :validate_contact_method
...

  private

  def validate_contact_method
    # one or the other must be provided
    if phone.empty? and email.empty?
      errors.add_to_base("At least one form of contact must be entered: phone or email" )
    end
  end

  def validate_team_selection
    if registration_setup.require_team_at_signup
      if team_id.nil?
        errors.add(:team, "must be selected" )
      end
    end
  end
end 
```

# asp.net - 在 Asp.net AJAX 中处理客户端事件

> ID：706535
> 
> 赞同：0
> 
> 时间：2009-04-01T17:15:51.530
> 
> 标签：asp.net, ajax, asp.net-ajax

我有一个 Asp.net AJAX 控件，在客户端控件类中，我想为控件中的某些文本框处理 onFocus 事件。我希望所有文本框只有一个处理程序，但是在处理程序中我不知道如何获取导致焦点事件的源元素。

在我的初始化函数中，每个文本框都有以下代码：

```
this._onfocusFunctionDelegate = Function.createDelegate(this, this._onFocus);
$addHandler(this._textBox1, 'focus', this._onfocusFunctionDelegate);  //repeated for each textbox 
```

在 _onFocus 处理程序中，我希望能够确定哪个文本框触发了事件并为该文本框调用 select()。

```
_onFocus: function(evt) {
// how do I get the source element?  The following doesn't work
evt.srcElement.select(); } 
```

那么如何确定是哪个元素触发了该事件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-06T02:43:11.000

我可以通过访问事件对象并使用目标属性来完成这项工作。在 MSDN 上，我只能找到对 srcElemnt 的引用，但发现目标在网络上提到的更多。尝试目标解决了这个问题。如果有人能找到支持这一点的文档，我将不胜感激。

# javascript - 使用 JavaScript 更改为页面添加书签时使用的 URL

> ID：706545
> 
> 赞同：3
> 
> 时间：2009-04-01T17:18:33.783
> 
> 标签：javascript, url, bookmarks

[JavaScript](http://en.wikipedia.org/wiki/JavaScript)不允许您在`window.location`不触发重新加载的情况下进行更新。虽然我原则上同意此政策（不应该访问我的网站并让 JavaScript 将位置栏更改为 read `www.yourbankingsite.com`，）但我认为应该可以更改`www.foo.org/index`为`www.foo.org/help`.

我关心这个的唯一原因是书签。我正在使用照片浏览器，当用户预览特定图像时，如果他们应该为该页面添加书签，我希望该图像成为默认图像。例如，如果他们正在查看`foo.org/preview/images0-30`并单击图像 #15，则该图像将扩展为中等大小的视图。如果他们随后为页面添加书签，我希望书签 URL 为`foo.org/preview/images0-30/active15`.

有什么想法吗，或者这个也有安全屏障？我当然可以理解这里采用的相同政策，但可以梦想。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T17:30:48.123

听起来你应该看看[真正简单的历史](http://code.google.com/p/reallysimplehistory/)。这就是谷歌（例如，Gmail）允许任何页面被收藏（并且有历史）但不刷新整个页面的方式。

至于事情的另一面（让人们访问您的网站然后自动弹出正确的图像），一旦页面加载并基于此触发事件，我会尝试检查*window.location.hash 。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T17:21:42.093

您可以在不重新加载页面的情况下将锚点添加到 URL 并使用 javascript 获取它：

```
location.href = '.../#' + imageId; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T17:26:11.660

如前所述，通常对于 ajaxy 站点，您可以操纵/检查 URL ( `window.location.hash`) 的哈希部分来确定这种活动。

最大的问题是确保检查 DOM-ready/window-load 中的哈希，就好像用户点击了给定的图像一样。这将适用于浏览器和书签，但可能会妨碍搜索索引。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-12T08:50:03.740

```
<html>

<head>
<script type="text/javascript">
function myHref(){
    document.getElementById('myAnchor').innerHTML="Visit Google"
    document.getElementById('myAnchor').href="http://www.google.com"
}
</script>
</head>

<body>
    <a id="myAnchor" href="http://www.java2s.com">Visit Java2s</a>
    <form>
        <input type="button" onclick="myHref()" value="Change URL and text">
    </form>
</body>

</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T17:20:17.790

您可以在页面上添加   `**[Add to Favorites]**`   按钮。

## 样本：

```
var urlAddress = "http://www.example.com/#image1";
var pageName = "Example Page Title - Image1";
function addToFavorites() {
    if (window.external) {
        window.external.AddFavorite(urlAddress, pageName); 
    } else {
        alert("Sorry! Your browser doesn't support this function."); 
    }
} 
```

或者使用以下 jQuery 插件之一：

*   [http://plugins.jquery.com/project/bookmark](http://plugins.jquery.com/project/bookmark)
*   [http://plugins.jquery.com/project/jqbookmark](http://plugins.jquery.com/project/jqbookmark)
*   [http://plugins.jquery.com/project/AddFavourite](http://plugins.jquery.com/project/AddFavourite)
*   [http://plugins.jquery.com/project/jFav](http://plugins.jquery.com/project/jFav)
*   [http://plugins.jquery.com/project/jBookmarkEngine](http://plugins.jquery.com/project/jBookmarkEngine)

## 与/或

最后使用带有哈希的 URL，并根据该哈希值加载您的内容（图像等）。

```
function onLoad() {
    if (window.location.hash == "image1") {
        // load image1
    }
} 
```

还有很多用于处理 URL 哈希事件的 jQuery 插件，例如：

*   [http://plugins.jquery.com/project/hashhistory](http://plugins.jquery.com/project/hashhistory)
*   [http://plugins.jquery.com/project/hashchange](http://plugins.jquery.com/project/hashchange)

也有很多非 jQuery JavaScript 库，例如：

*   [http://code.google.com/p/reallysimplehistory/](http://code.google.com/p/reallysimplehistory/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T17:20:46.197

如果 URL 包含哈希，如何检测页面加载，如果包含，将它们引导到您希望它们访问的页面？

# css - 如何控制 html 无序列表的样式？

> ID：706557
> 
> 赞同：2
> 
> 时间：2009-04-01T17:21:21.033
> 
> 标签：css, cross-browser, styling

谁能想到为链接列表设置样式会如此麻烦！

*   第一个问题我想使用任意字符作为项目符号。我现在确定这是不可能的，但也许你知道不同？

*   无论如何，我想控制子弹和 <li> 内容之间的距离。

*   我想控制子弹的高度（因此无论字体/大小等如何，它都保持在 <li> 中的文本的中心）。

*   我希望子弹留在包含 <ul> 的 <div> 内，而不是挂在一边。

*   我希望 <li> 中的长项目环绕，让项目符号远离文本。

我希望它可以在 IE6 以上的所有浏览器中运行。尽可能少地特别恳求 IE 的怪异！（这意味着我不能使用`:before`）

我很想使用 <span> 和 </br> 而不是列表！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-02T07:22:31.867

[http://css.maxdesign.com.au/listamatic/](http://css.maxdesign.com.au/listamatic/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:15:09.373

首先，确保您使用 CSS 删除列表元素的填充/边距，这样您就可以为所有浏览器拥有一个干净的状态。然后，如果您总是希望子弹图像居中，请使用图像。

```
 ul{
   margin: 0;
   padding: 0;
}

ul li{
  padding: 0 0 0 20px; /*so text does not appear on top of bullet */
  background: url(error.gif) no-repeat 0 50%; /* this will set the bullet to appear in the middle */
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:05:11.567

对于无序列表，您必须制作一个图形来显示任意字符。其他可用值是：

```
list-style-type: disc | circle | square | none 
```

要使项目符号停留在文本中而不是闲逛，请使用

```
list-style-position: inside 
```

？？？不确定您在最后一点中“环绕”的意思。

# asp-classic - 经典的 ASP 速成课程

> ID：706560
> 
> 赞同：6
> 
> 时间：2009-04-01T17:22:10.110
> 
> 标签：asp-classic

我是 C# 和 PHP 开发人员。在工作中，我刚把一些经典的 ASP 东西扔在我的腿上。我只需要进行几个星期的编辑，所以我不想学习太多关于我永远不会再接触的遗留东西。但是，我确实需要能够在这段时间内完成我的工作。

我怎样才能获得一个好的 ASP 速成课程？我需要很快地变得足够好。哪些网站/书籍/资源最适合这种需求？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-01T17:24:54.143

[http://www.w3schools.com](http://www.w3schools.com)有一个非常好的 ASP 教程。它实际上是我在学校从 PHP 背景进入经典 ASP 时使用的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-02T17:43:39.153

实际上，经典的 ASP 只是 VBScript + 几个处理 Web 交互的库。

最快的方法在这里：

[http://msdn.microsoft.com/en-us/library/d1wf56tt.aspx](http://msdn.microsoft.com/en-us/library/d1wf56tt.aspx)

了解 VBScript 的基础知识（它相对较小）

然后了解经典ASP的基本对象

请求响应服务器会话应用程序 ASPError

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-09-26T12:02:48.220

查看[http://www.devguru.com/](http://www.devguru.com/)并转到 vbscript 部分以快速参考它们的功能

# c# - 数据库连接字符串信息

> ID：706566
> 
> 赞同：11
> 
> 时间：2009-04-01T17:22:46.257
> 
> 标签：c#

在.Net 中是否有一个类，您可以在其中获取数据库名称和所有连接字符串信息，而无需在连接字符串上执行子字符串？

编辑：

我没有创建连接，我正在尝试从连接字符串中获取信息。所以我基本上是在寻找带有连接字符串 arg 并具有 dbName、连接类型等的访问器的东西......

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-01T18:07:50.873

您可以使用特定于提供者的 ConnectionStringBuilder 类（在适当的命名空间内），或者`System.Data.Common.DbConnectionStringBuilder`在需要时抽象连接字符串对象。您需要知道用于指定您要查找的信息的特定于提供程序的关键字，但对于 SQL Server 示例，您可以执行以下两件事之一：

给定

```
string connectionString = "Data Source = .\\SQLEXPRESS;Database=Northwind;Integrated Security=True;"; 
```

你可以做...

```
System.Data.Common.DbConnectionStringBuilder builder = new System.Data.Common.DbConnectionStringBuilder();

builder.ConnectionString = connectionString;

string server = builder["Data Source"] as string;
string database = builder["Database"] as string; 
```

或者

```
System.Data.SqlClient.SqlConnectionStringBuilder builder = new System.Data.SqlClient.SqlConnectionStringBuilder();

builder.ConnectionString = connectionString;

string server = builder.DataSource;
string database = builder.InitialCatalog; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T17:26:03.750

使用连接字符串初始化连接后，您可以从初始化连接对象的属性中获取这些信息。

检查 System.Data.Common.DbConnection。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T17:24:18.280

是的 ConnectionInfo

[http://msdn.microsoft.com/en-us/library/ms226340(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms226340(VS.80).aspx)

编辑：我和 Chris 一起意识到，这只有在导入 Crystal Reports 命名空间时才有效。否则我不确定

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T17:26:06.887

```
ConnectionInfo connectionInfo = new ConnectionInfo ();
connectionInfo = logOnInfo.ConnectionInfo;

connectionInfo.DatabaseName = database;
connectionInfo.ServerName = server;
connectionInfo.Password = password;
connectionInfo.UserID = user; 
```

**编辑**：看起来内森打败了我，因为我的来自同一页。

**再次编辑**：我应该注意 ConnectionInfo 在 CrystalDecisions.Shared 命名空间中。至于如何从通用数据库连接中获取它，我不确定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T17:45:05.093

如果您使用连接字符串构建器（例如 OracleConnectionStringBuilde，并且对于不同的数据库会有所不同）构建连接字符串，那么在这种情况下可以轻松地从中检索信息。

这里解释了：

[http://msdn.microsoft.com/en-us/library/ms254947.aspx](http://msdn.microsoft.com/en-us/library/ms254947.aspx)

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-04-01T17:37:07.843

```
SqlConnection sq = new SqlConnection(ConnectionString); 
```

[参考](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.aspx)

完成“使用”语句（来自 MSDN）

```
using (SqlConnection connection = new SqlConnection(connectionString))
    {
        connection.Open();
        // Do work here; connection closed on following line.
    } 
```

# google-maps - 对大图像使用 Google 地图控件

> ID：706582
> 
> 赞同：0
> 
> 时间：2009-04-01T17:28:02.763
> 
> 标签：google-maps

我有大图像，我希望有像谷歌地图这样的拖动和缩放控件。我开始研究 Google Maps API 和其他一些相关网站，但我找不到简单易行的东西。

MapKi 教程建议我[自动切割瓷砖](http://mapki.com/wiki/Automatic_Tile_Cutter)并将[其添加为自定义地图](http://mapki.com/wiki/Add_Your_Own_Custom_Map)。这是有道理的，但我在文件服务器中有太多图像，我没有时间浏览所有图像并切割瓷砖并计算出每个图像的缩放级别。一个好的解决方案是编写一个可以自动执行此操作的脚本，但这将花费大量精力和时间来寻找另一种解决方案（如果有的话）。

因此，有没有一种方法可以在不从原始图像中创建新图像或图块的情况下，为图像提供与谷歌地图控件类似的功能。如果您可以发布一些代码或链接到教程/文档，那就太好了。或者，如果您知道如何在不制作这些图块的情况下使用 Google API 执行此操作，请引导我找到正确的路径。我是 Google Maps API 的新手。

我找到了适用于 Google 地图的[DragZoom](http://googlemapsapi.blogspot.com/2007/08/you-can-always-go-back-to-where-you.html)，但我认为这不是我想要的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T17:40:26.790

你正在寻找像[Djatoka这样的东西](http://sourceforge.net/projects/djatoka)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-02-16T14:57:23.913

您应该看看图书馆和博物馆使用的 IIIF 协议，用于缩放超大图像（一侧有数万像素 +）、在画布上准备图像集合、在这些图像上显示注释等。

[http://iiif.io](http://iiif.io)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-12T17:45:43.570

查看[https://github.com/Murtnowski/GMap-JSlicer](https://github.com/Murtnowski/GMap-JSlicer)

```
slicer = new JSlicer(document.getElementById('map'), 'myImage.png');
slicer.init(); 
```

超级简单，无需预先切割瓷砖。只需指向一个图像即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-08T15:35:27.980

…只是为了记录，这里是一个带有前端查看器的开源平铺服务器：

[http://iipimage.sourceforge.net/](http://iipimage.sourceforge.net/)

# apache-flex - Flex LineChart 高级水平轴？

> ID：706583
> 
> 赞同：0
> 
> 时间：2009-04-01T17:28:44.680
> 
> 标签：apache-flex, linechart

我想制作一个折线图，允许用户选择数据的日期范围。例如，如果日期范围跨度超过 1 个月，我希望有一个显示月份的栏，如果日期范围约为 30 天或更短，我希望它也显示每一天的日期。类似的东西。

有没有人有什么建议？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-02T17:13:48.587

我建议使用[`DateTimeAxis`](http://livedocs.adobe.com/flex/3/langref/mx/charts/DateTimeAxis.html), 并`labelUnits`酌情将属性设置为“天”或“月”。然后，轴将完成对数据进行相应分组的所有艰苦工作。

在您的特定情况下，当用户从组合框中进行选择时，您应该有一个处理程序，该处理程序根据用户的日期选择计算 x 轴的粒度。

# java - Java StreamCorruptedException

> ID：706592
> 
> 赞同：0
> 
> 时间：2009-04-01T17:30:57.857
> 
> 标签：java, serialization

我有一个客户端和服务器应用程序，通过 TCP 使用序列化传输消息。反序列化对象时出现以下错误：

分析此问题的原因或可能的后续步骤有什么想法吗？

```
java.io.StreamCorruptedException: invalid stream header: 383D4649
    at java.io.ObjectInputStream.readStreamHeader(Unknown Source)
    at java.io.ObjectInputStream.<init>(Unknown Source)
    at com.aqua.NmsApi.ResiliantTCPServer$ServerThread.run(ResiliantTCPServer.java:248)
    at java.lang.Thread.run(Unknown Source) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T17:38:59.507

序列化数据头部的幻数有问题。您可能需要捕获序列化数据并自己查看它。该ascii流是'8 = FI'。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:47:17.367

有两个可能的原因：

*   流实际上已损坏（即您正在阅读的内容与您在另一端写入的内容不同）。在这种情况下，您应该将每个内容（发送和接收）写入本地文件，并进行比较。

*   您正在使用的 ObjectInputStream 的实现所需的幻数在两端都不同，例如，因为您使用的是不同版本的 Java 基础包。这些常量在 ObjectStreamConstants 中声明，您应该检查它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T17:47:45.213

每个套接字 Input/OutputStream 是否只使用一个 ObjectInput/OutputStream？在相同的输入/输出流上重新创建这些是此类错误的常见原因。

# python - 你可以在 Python 中为导入的模块定义别名吗？

> ID：706595
> 
> 赞同：161
> 
> 时间：2009-04-01T17:33:02.143
> 
> 标签：python, module, alias, python-import

在 Python 中，是否可以为导入的模块定义别名？

例如：

```
import a_ridiculously_long_module_name 
```

...所以它有一个别名'short_name'。

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2009-04-01T17:34:00.300

```
import a_ridiculously_long_module_name as short_name 
```

也适用于

```
import module.submodule.subsubmodule as short_name 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-04-01T17:34:03.450

[在这里检查](http://docs.python.org/reference/simple_stmts.html#import)

```
import module as name 
```

或者

```
from relative_module import identifier as name 
```

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2009-04-01T22:22:14.257

如果您已经完成：

```
import long_module_name 
```

你也可以给它一个别名：

```
lmn = long_module_name 
```

没有理由在代码中这样做，但我有时发现它在交互式解释器中很有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-10-17T17:07:51.853

是的，可以使用别名导入模块。**用作**关键字。看

```
import math as ilovemaths # here math module is imported under an alias name
print(ilovemaths.sqrt(4))  # Using the sqrt() function 
```

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2020-05-11T15:06:00.527

从 MODULE 导入 TAGNAME 作为 ALIAS

# java - Eclipse Servlets 需要很长时间才能更新

> ID：706600
> 
> 赞同：0
> 
> 时间：2009-04-01T17:33:47.320
> 
> 标签：java, eclipse, servlets

我正在测试从 Eclipse 中运行一个简单的 Servlet。当我单击“运行”时，控制台说它正在启动 TomCat，然后在 Eclipse 中启动一个内部浏览器，显示我的代码。

但是，如果我在 servlet 中进行任何更改并在浏览器中单击“刷新”，则不会显示更改。然后，几秒钟后，如果我点击刷新，更改开始随机显示。所以我猜想某处有一个缓存设置可以控制它。

如何在我点击刷新后立即关闭该缓存设置或以其他方式使 Eclipse 内部浏览器更新？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T17:37:52.617

这是由 servlet 开发的工作方式引起的。修改你的servlet时，需要在编译后提交给servlet容器。servlet容器本身需要重新加载servlet，servlet必须被实例化（servlet生命周期）。有很多事情要做，这可能会导致您等待几秒钟后在浏览器中看到更新。

# c# - 当前上下文中不存在名称“controlname”

> ID：706603
> 
> 赞同：79
> 
> 时间：2009-04-01T17:34:19.020
> 
> 标签：c#, asp.net, visual-studio-2005, code-behind

我有一个正在开发的 Web 应用程序（带有 C# 的 ASP.NET2.0，使用 VS2005）。一切正常，突然间我得到了错误：

`Error 1 The name 'Label1' does not exist in the current context`

每次我在页面的代码隐藏中使用控件时，还有 43 个其他同类。

这只发生在 1 页。就好像代码隐藏没有识别控件。另一个有趣的事情是智能感知也没有拿起任何控件。

我试图清理解决方案文件，删除 obj 文件，从项目中排除文件然后重新添加它们，关闭 VS 并重新启动它，甚至重新启动我的计算机，但这些都没有奏效。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2009-12-30T17:03:35.730

我知道这是一个老问题，但我有一个类似的问题，想发布我的解决方案，以防它可以使其他人受益。我在学习使用时遇到了问题：

*   ASP.NET 3.5
*   C＃
*   VS2008

我试图创建一个启用 AJAX 的页面（如果您不熟悉，请查看有关使用 ScriptManager 对象的教程）。我尝试通过 C# 代码访问页面中的 HTML 元素，但我收到一条错误消息，指出 HTML ID 值的标识符“在当前上下文中不存在”。

为了解决它，我必须执行以下操作：

**1.在服务器上运行**

要将 HTML 元素作为 C# 代码中的变量访问，必须将以下值放在 aspx 文件的 HTML 元素标记中：

```
runat="server" 
```

Visual Studio IDE 工具箱中的某些对象在添加到页面时不会自动包含此值。

**2\. 重新生成自动生成的 C# 文件：**

*   在解决方案资源管理器中，在 aspx 文件下应该有两个文件：*.aspx.cs 和 *.aspx.designer.cs。设计器文件是自动生成的。
*   删除现有的 *.aspx.designer.cs 文件。确保只删除***设计***器文件。不要删除另一个，因为它包含页面的 C# 代码。
*   右键单击父 aspx 文件。在弹出菜单中，选择**转换为 Web 应用程序**。

现在该元素应该可以在 C# 代码文件中访问。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-04-01T17:37:52.193

检查 @Page 指令上文件名和 Inherits 属性后面的代码，确保它们都匹配。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-10-13T14:15:21.450

排除引用相同代码隐藏文件的任何其他页面，例如您复制和粘贴的旧页面。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-07-12T20:27:52.717

我有同样的问题。事实证明，我的项目中有“MyPage.aspx”和“MyPage.aspx 的副本”。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-04-27T08:19:06.557

此外，请确保您没有意外尝试继承或定义与其他文件相同（部分）类的文件。请注意，这些文件似乎与实际出现错误的文件无关！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-08T15:08:31.280

我遇到了同样的错误，除了它是一个 WPF 错误。我正在重新安排项目，并有一个这样定义的控件：

```
<local:CustomControl Name="Custom" /> 
```

在我后面的代码中，我尝试使用 Custom.Blah，但出现错误：

```
The name 'Custom' does not exist in the current context 
```

对我来说，诀窍是将我在 Xaml 中的控制更改为：

```
<local:CustomControl x:Name="Custom" /> 
```

希望这可以帮助那里的人！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-02T13:13:11.100

在我对数据上下文进行更改后，我得到了同样的错误。但是我遇到了一些我不熟悉的东西。我习惯于手动发布我的文件。通常，当我这样做时，发布文件夹中不会出现 App_Code 文件夹。我开始使用 VS 12 发布，它在您的协助下直接发布到 Web 服务器。然后我得到关于被预编译应用程序的错误。然后我删除它工作的 app_code 文件夹。但后来它给了我你得到的数据上下文错误。所以我只是删除了所有文件并再次运行发布，没有文件限制（每个文件夹和文件都将被发布）然后它就像一个魅力。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-05-09T18:58:08.413

我有同样的问题，我的问题是两个属性之间没有空格”

```
AutoGenerateColumns="False"DataKeyNames="ProductID" 
```

代替

```
AutoGenerateColumns="False" DataKeyNames="ProductID" 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-11-09T14:54:52.127

我在我的项目中通过备份当前文件（所以我仍然有我的代码）、删除当前的 aspx（和子页面）、创建一个新页面并将备份文件的内容复制到新文件中来解决这个问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-05-16T14:05:00.733

这个错误经常发生在你错过的时候`runat="server"`。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-10-05T14:38:40.730

上面提供的解决方案选项 #2 适用于 Windows 窗体应用程序而不是 Web aspx 应用程序。我在 web 应用程序中遇到了类似的错误，我通过删除一个文件来解决这个问题，在该文件中我有一个同名的用户控件，这个 aspx 文件实际上是一个备份文件，在过程中的任何地方都没有引用，但它仍然导致错误，因为在备份文件上注册的用户控件的名称在流程中引用的 aspx 文件上的名称完全相同。所以我删除了备份文件并构建了解决方案，构建成功。

希望这对类似情况的人有所帮助。

维杰亚·拉克西米。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-01T06:00:50.690

我遇到了同样的问题，因为我试图从 Visual Studio 2010 项目重新生成 aspx 文件，因此控件具有 clientidmode="Static" 属性。当它被删除时，它被解决了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-01-03T17:01:10.960

在从 DataList 转换后使用中继器进行调整时，我遇到了类似的问题。

问题是我在删除不需要的属性时不小心合并了 2 个属性。

```
<asp:Repeater runat="server" ID="ClientsRP"DataSourceID="ClientsDS">
    .
    .
    .
</asp:Repeater> 
```

这阻止了在设计文件中生成中继器。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-04-15T18:55:57.480

我有同样的错误信息。我的代码没有错误并且运行良好，然后我决定返回并重命名我的一个按钮，突然它给了我一个编译错误，伴随着蓝色波浪下划线，说控件在当前上下文中不存在......

原来 Visual Studio 是愚蠢的，因为问题与我为我的 aspx.cs 类制作的备份文件有关。我删除了这些，错误就消失了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-18T15:08:37.293

我遇到了同样的问题。显然，您不应该在 BLL 中调用与 .aspx/.aspx.cs 文件之一同名的类。我认为它们不会在同一个范围内，等等，但它与 Visual Studio 的内部工作混淆了太多。如果它会产生这种类型的错误，我有点惊讶没有什么可以阻止你这样做。无论如何，只需删除 .aspx/.aspx.cs 文件并重建您的项目。然后用另一个名字把他们带回来。如果您不想重新输入所有代码，可以将代码复制/粘贴到另一个编辑器中。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-04-30T20:16:12.627

在我的例子中，当我创建 Web 表单时，它被命名为 WebForm1.aspx 和相应的名称 (WebForm1)。信，我把它改名为别的东西。我几乎在所有地方都手动重命名，但设计器文件中的一个地方仍将其显示为“WebForm1”。

我也改变了它并摆脱了这个错误。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-04-05T11:08:52.063

1) 检查“filename.aspx”页面中<%@Page CodeFile="filename.aspx.cs" %> 中的CodeFile 属性，您的Code behind 文件名和该属性名应该相同。

2）你可能会错过代码中的 runat="server"

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-04-02T16:49:38.933

在我的情况下，我必须通过 417“找不到控制名称”错误来查找实际错误：我已经替换了一个 DLL，但没有更新 web.config 中的版本号。修复该问题并成功构建，3 分钟后所有其他错误都自行解决。

# soap - BizTalk 2006 SOAP 适配器 - 仅消息传递 Web 服务调用

> ID：706605
> 
> 赞同：1
> 
> 时间：2009-04-01T17:34:40.220
> 
> 标签：soap, biztalk, adapter

在 BizTalk 2006 中，我试图设置一个仅消息传递的方案，由此将接收到的消息（字符串）传递给采用单个字符串参数的 Web 服务方法。换句话说，应该将 BizTalk 消息的整个正文作为参数传递给 Web 服务调用。

服务方法如下所示：

```
 [WebMethod]
    public void LogAuditEvent(string auditEventMessage) 
```

我已根据需要在 SOAP 适配器配置中设置了带有代理类的程序集，但我不知道如何获取要作为参数传递的消息体。没有做任何特别的事情，我收到以下错误消息：

> 使用命名空间“”将消息部分“auditEventMessage”序列化为“String”类型失败。

我认为这意味着适配器找不到以参数命名的消息部分。所以，我的问题是我需要做什么才能正确设置我的消息？我在想也许我需要添加一个出站地图，但不确定将什么用作源模式以及如何为 Web 服务请求消息生成适当的模式。

有人对这个看似简单的任务有任何指示吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T19:41:39.090

TDL,

我会查看下面的链接以获取有关如何执行此操作的一些提示。SOAP 适配器可能会出现问题，如果您使用 R2，我会推荐 WCF。如果不看看 WSE 适配器。

[http://blogs.digitaldeposit.net/saravana/post/2007/01/31/Calling-Web-Service-from-BizTalk-2006-in-a-Messaging-only-Scenario-(aka-Content-based-Routing ).aspx](http://blogs.digitaldeposit.net/saravana/post/2007/01/31/Calling-Web-Service-from-BizTalk-2006-in-a-Messaging-only-Scenario-(aka-Content-based-Routing).aspx)

-和-

[http://www.pluralsight.com/community/blogs/aaron/archive/2005/10/07/15386.aspx](http://www.pluralsight.com/community/blogs/aaron/archive/2005/10/07/15386.aspx)

-和-

[http://social.technet.microsoft.com/Forums/en-US/biztalkgeneral/thread/92f2cad3-39b9-47d0-9e6f-011ccd2f9e10/](http://social.technet.microsoft.com/Forums/en-US/biztalkgeneral/thread/92f2cad3-39b9-47d0-9e6f-011ccd2f9e10/)

-布莱恩

# javascript - 使用自动完成选项发送附加数据

> ID：706619
> 
> 赞同：0
> 
> 时间：2009-04-01T17:38:37.340
> 
> 标签：javascript, jquery, autocomplete

我有一个自动完成人名的字段，所以它有“奥巴马，巴拉克”，“林肯，安倍”等选项。

这些人还有其他属性，比如“出生地”和“电话号码”。当用户从自动完成中选择一个选项时，我希望该人的附加属性能够自动填充隐藏的表单字段。

提供自动完成选项的 Web 服务也知道每个人的出生地和电话号码，因此它可以将此数据发送给客户端。但是，我使用的 jQuery 自动完成插件不接受任何这样的额外数据——你只能给它自动完成选项。

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:12:20.737

我不熟悉自动完成插件，但是：为什么不从服务器下载所有数据，然后只为自动完成提供它需要的东西。IE

```
var persons = {
 abe: {
   name: 'abe',
   birthplace: 'I\'m not from the US so I have no clue'
  },
 Obama: {
   name: 'Obama',
   birthplace: 'please see abe'
 }
}; 
```

然后执行以下操作：

```
for(name in persons){
 feedAutocomplete(name); //or persons[name].name
} 
```

或者，如果您需要在一个数组中提供自动完成功能：

```
autoCompleteArray = Array();
for(name in persons){
 autoCompleteArray.push(name);
}
feedAutocomplete( autoCompleteArray ); 
```

和 onAutoComplete 回调：

```
function onAutoComplete(name){
  //or if the currect value is not supplied in
  // the function: var name = $('#autocompleField').val();
  var personInfo = persons[name]; 
  $('#hiddenFieldBirthplace').val( personInfo.birthplace );
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:01:03.917

使用 YUI :)

处理所有这些，开箱即用完全可定制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T19:07:44.787

我相信自动完成插件允许回调函数。您可以根据该函数中的用户选择填充隐藏字段。

# asp.net - ASP.NET 输入密钥并在没有 javascript 的情况下提交表单

> ID：706625
> 
> 赞同：1
> 
> 时间：2009-04-01T17:40:23.857
> 
> 标签：asp.net, javascript, postback

当用户按下回车键时，我想提交一个表单。它在 Firefox 中运行良好，但在 IE 中不行。这基本上是相同的问题，除了我不允许使用任何 JavaScript： [Enter button does not submit form (IE ONLY) ASP.NET](https://stackoverflow.com/questions/270494/enter-button-does-not-submit-form-ie-only-asp-net)

不幸的是，看起来 ASP.NET 使用 JavaScript 来处理按钮回发。有没有一种不依赖 JavaScript 的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T17:45:08.057

解决此问题的方法是链接帖子页面底部列出的内容。出于某种原因，IE 需要有一个额外的表单字段才能正常工作。我在许多项目中都使用过它，它绕过了这个错误。只需添加以下内容。

```
<!-- Fix for IE bug submit on pressing "Enter") -->
<div style="display:none">
            <input type="text" name="hiddenText"/>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-18T18:47:49.330

我的解决方案是这样，一个确实单击登录按钮的脚本。

适用于所有浏览器！

```
public partial class Logon : UserControl
{
    protected void Page_Load(object sender, EventArgs e)
    {
        Page.ClientScript.RegisterClientScriptBlock(GetType(), "Logon", "document.getElementById('id_LoginButton').click();", true);
    }
} 
```

# mpmovieplayercontroller - 如何让 MPMoviePlayerController 尊重响铃/静音开关？

> ID：706630
> 
> 赞同：1
> 
> 时间：2009-04-01T17:42:00.797
> 
> 标签：mpmovieplayercontroller, silent

如果 iPhone 上的响铃/静音开关设置为静音，我正在尝试让 MPMoviePlayerController 静音播放电影，但未成功。没有接口方法可以帮助我，播放器也不尊重 AudioSessionProperty() 技巧：

```
UInt32 sessionCategory = kAudioSessionCategory_AmbientSound;

AudioSessionInitialize(NULL, NULL, NULL, NULL);

AudioSessionSetProperty(
    kAudioSessionProperty_AudioCategory,
    sizeof (sessionCategory),
    &sessionCategory); 
```

有没有人成功地使电影播放静音？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-23T14:55:02.043

我花了一些时间试图让这个自己工作。[最终我在尝试、失败并阅读了苹果开发论坛上的这篇文章后](https://devforums.apple.com/message/142085)放弃了 。

> “MPMoviePlayerController 建立了自己的音频会话，您无法做任何事情来影响它”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-24T18:07:34.403

`MPMoviePlayerController`有一个属性`useApplicationAudioSession`可以让玩家尊重设备的静音设置。

```
MPMoviePlayerController *player = [[MPMoviePlayerController alloc] initWithContentURL:fileURL];
player.useApplicationAudioSession = YES;
[player play]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-19T05:09:49.327

在你的代码中添加这个：

```
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryAmbient error:nil]; 
```

# sql-server-2005 - SQL Server 2005 CE 3.5 重新种子 IDENTITY

> ID：706635
> 
> 赞同：0
> 
> 时间：2009-04-01T17:43:31.307
> 
> 标签：sql-server-2005, .net-3.5, sql-server-ce

我已经在数据表中插入了一些行

设置 Identity_insert tblEvent on

然后我尝试“重新播种”身份字段

```
int MaxId = this.MaxID()+1;
string upgrade = "ALTER TABLE " + Table + " ALTER COLUMN ID IDENTITY("+ MaxId.ToString() +",1)";
System.Data.SqlServerCe.SqlCeCommand cmd = new System.Data.SqlServerCe.SqlCeCommand(upgrade, connection);
cmd.CommandType = System.Data.CommandType.Text;
connection.Open();
cmd.ExecuteNonQuery();
connection.Close(); 
```

“MaxId”由下式确定

```
int MaxId = 0;
string upgrade = "select Max(ID) from " + Table;
System.Data.SqlServerCe.SqlCeCommand cmd = new System.Data.SqlServerCe.SqlCeCommand(upgrade, connection);
cmd.CommandType = System.Data.CommandType.Text;
connection.Open();
MaxId = (int)cmd.ExecuteScalar();
connection.Close();
return MaxId; 
```

但是，如果我在播种后再次查询 Max(ID)，它并没有改变任何想法的价值

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-02T18:54:28.453

奇怪，可能是权限问题。不过，您应该已经看到了异常，除非异常被全部捕获。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:47:30.407

尝试这个：

```
string upgrade = " DBCC CHECKIDENT('[" + Table + "]', RESEED, " + (MaxId + 1)+ " )" 
```

# c# - 如果您的错误日志记录失败，您会怎么做，以及如何测试它在生产中的工作情况？

> ID：706638
> 
> 赞同：4
> 
> 时间：2009-04-01T17:44:41.087
> 
> 标签：c#, asp.net, error-handling, enterprise-library, error-logging

1.  如果您的错误日志记录代码失败，您会怎么做？
2.  您如何确保其当前正常工作？
3.  你怎么知道它是否不起作用？
4.  你如何测试它在生产环境中的工作？
5.  如果一切都失败了，我应该抛出异常吗？

下面的代码使用 Microsoft 的 Enterprise Library Logging Application Block。你如何让它“更好”？

```
using Microsoft.Practices.EnterpriseLibrary.Logging;

class Program
{
    static void Main(string[] args)
    {
        try
        {
            // Trying to write some data to the DB
            ...
        }
        catch (Exception ex)
        {
            LogHelper.LogException(ex, "Trying to write to the DB");
        }
    }
}

public class LogHelper
{
    public static void LogException(Exception ex, string exceptionType)
    {
        try
        {
            // Simplified version, only logging the message
            Logger.Write(exceptionType);
        }
        catch
        {
            // What do you do here???
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T18:03:56.517

我的应用程序通常会在出现错误时做两件事。第一种是将其写入本地日志文件（即使它也使用某种类型的数据库日志记录）。然后它将错误的电子邮件发送到为支持而设置的分发列表。

因此，如果数据库日志写入失败，错误仍然在本地日志文件中，并且还通过电子邮件发送。

如果电子邮件失败，仍会记录错误，以便您稍后解决问题。

恕我直言，获得比这更高的容错性只值得为极其关键的应用程序付出努力。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:23:57.263

请参阅我的[相关问题](https://stackoverflow.com/questions/313839/what-is-the-best-way-to-write-event-log-entries)中的答案：

如果其他一切都失败了，请在您的 catch 块中进行“最后的记录”。将异常记录到文本文件中的一个极不可能失败的位置。如果最后的日志记录因抛出另一个异常而失败，您可以吞下该异常，或终止您的应用程序并将错误显示为消息框。

在这种特定（异常）情况下，吞下异常是不终止应用程序的唯一方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T18:34:26.893

我写了一个日志文件，并将一封电子邮件发送到一个永远不会消失的公共地址。两者都不是防弹的，但我认为如果我们的邮件系统出现故障或电子邮件服务器发生变化，我们会知道这一点。我确实有一些应用程序可以同时写入数据库和平面文件并发送电子邮件。因此，这 3 个中的一个将起作用。我发现我的一个应用程序正在为日志写入数据库，并且在捕获中它正在写入同一个数据库，我发现它的唯一方法是应用程序由于数据库连接中的一些变化而失败。我确保修改那个 catch 语句做电子邮件而不是数据库。平面文件的唯一问题是文件系统存储，我们有很多为日志编写平面文件的应用程序，所以我们不断地备份它们并保存它们，或者只是简单地删除它们。

# sharepoint - 我应该如何在 SharePoint 中存储旧日期？

> ID：706642
> 
> 赞同：4
> 
> 时间：2009-04-01T17:45:25.500
> 
> 标签：sharepoint, datetime

我需要在 SharePoint 中存储需要追溯到公元前 5000 年左右的日期。理想情况下，我希望能够进行日期加/减，如下所示：

```
oldDate = '5000 BC';
newDate = '1995 AD';
DateDiff(oldDate, newDate, 'Years'); // equals 6995 
```

我应该如何进行？建立一个基于字符串的 old_date 类？只使用常规日期，但添加一个使日期为负数的 AD 或 BC？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T18:39:05.743

这是一个非常重要的问题，实际上取决于您想要对这些日期做什么。例如，自 1582 年以来，我们只使用当前（公历）日历。在此之前是儒略历，在此之前是旧罗马历。更糟糕的是，此信息实际上仅适用于西欧（以及与文化相关的地区）。因此，如果您希望通过一些简单的数学运算为您提供适当的历史事件可接受日期，那么您将大失所望。

如果您只想将[公历](http://en.wikipedia.org/wiki/Gregorian_Calendar)倒退，我想这是可行的。但是，仍然存在错误，并且在那个规模上它很重要。来自维基百科：

> 在数千年的时间尺度上，公历落后于季节，因为地球自转的减慢使每一天随着时间的推移而略微变长（参见潮汐加速和闰秒），而一年保持更统一的持续时间

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T21:47:51.343

如果您只对年感兴趣而不对天感兴趣，那么您可以使用自定义编辑器构建一个自定义字段并将年份值存储为整数值。

小于零的值意味着 BC，高于或等于零的值意味着 AD。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-25T15:42:25.660

我最终将日期存储为 ISO 8601 格式的文本字段：
`YYYY-MM-DDThh:mm:ss.sTZD`

您不必存储整个字符串，例如，如果您想存储 5000 BC，您可以输入`-5000-01-01`. 我不能很容易地得到我的日期加法和减法，但是以我想要的格式在那里获取数据要容易得多。

# java - 等效于 EasyMock 中的 LastCall.IgnoreArguments

> ID：706647
> 
> 赞同：5
> 
> 时间：2009-04-01T17:46:21.597
> 
> 标签：java, mocking, rhino-mocks, easymock

我已经广泛使用 Rhino.Mocks，目前正在使用 EasyMocks 在 Java 中编写一些测试。但是，我无法在 EasyMocks 中提取 LastCall.IgnoreArguments() Rhino.Mocks 等效项。

无论方法中的参数如何，如何使用 Easy Mocks 返回一个值。

例如：

```
public interface ISoothSayer {

   String SaySomethingSweet(String sweetMsg);
} 
```

无论参数sweetMsg如何，我如何模拟此界面以返回“Hell Oh Wo​​rld”。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T19:42:20.943

您可以使用 isA，如下所示（模拟是 ISoothSayer 模拟）：

```
expect(mock.SaySomethingSweet(isA(String.class))).andReturn("Hell Oh World"); 
```

# .net - 什么会导致 WPF 应用程序因 AppHangB1 问题事件名称而崩溃？

> ID：706649
> 
> 赞同：3
> 
> 时间：2009-04-01T17:47:09.457
> 
> 标签：.net, wpf, debugging, crash

我目前正在处理的程序偶尔会因 AppHangB1 问题事件而挂起。我已经将它追溯到一系列特定的动作，但它似乎是一种黑森错误，因为每当我单步执行代码时，它都不会表现出来。一旦程序挂起，我就无法暂停程序以查看它在 Visual Studio 中的挂起位置。这个应用程序中发生了很多事情（非托管互操作、多线程等），所以在我的特定应用程序中可能有很多事情是错误的。

我不是在寻找任何人来为我解决我的问题，我只是想知道哪些类型的事情会导致这种类型的挂起？我在谷歌上找到了几个点击，但没有任何帮助。任何有助于查明问题的 .NET 应用程序调试技巧也会有所帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T18:02:39.077

当 UI 线程在几秒钟内没有响应消息并且用户尝试终止它时，将触发 AppHangB1 事件。挂起几乎可以由任何原因引起：代码中的繁忙循环、在 UI 线程上执行网络或磁盘 I/O、UI 线程在执行长时间运行任务的后台线程持有的锁上被阻塞，等等。

有点担心 Visual Studio 不能在挂起时中断。您附加的是仅托管调试还是混合模式调试？您可以尝试使用 Windbg ( [http://www.microsoft.com/whdc/devtools/debugging/default.mspx](http://www.microsoft.com/whdc/devtools/debugging/default.mspx) ) 以非侵入方式附加到进程并尝试获取挂起线程的堆栈跟踪 (您想查看在使用 !clrstack 获取托管堆栈跟踪）。Windbg 的学习曲线非常陡峭，因此您可能只想收集可以在 Visual Studio 中调试的转储。

# jquery - 将事件绑定到鼠标右键

> ID：706655
> 
> 赞同：61
> 
> 时间：2009-04-01T17:47:57.443
> 
> 标签：jquery, css

禁用浏览器上下文菜单后如何通过右键单击触发某些操作？

我试过这个。. .

```
$(document).ready(function(){
    $(document).bind("contextmenu",function(e){
        $('.alert').fadeToggle();
        return false;
    });
}); 
```

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-04-01T18:07:48.690

jQuery 中没有内置的 oncontextmenu 事件处理程序，但您可以执行以下操作：

```
$(document).ready(function(){ 
  document.oncontextmenu = function() {return false;};

  $(document).mousedown(function(e){ 
    if( e.button == 2 ) { 
      alert('Right mouse button!'); 
      return false; 
    } 
    return true; 
  }); 
}); 
```

基本上我取消了 DOM 元素的 oncontextmenu 事件以禁用浏览器上下文菜单，然后我使用 jQuery 捕获 mousedown 事件，您可以在事件参数中知道按下了哪个按钮。

[你可以在这里](http://jsbin.com/opare/edit)试试上面的例子。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2010-05-05T03:24:02.537

**函数返回得太早。**我在下面的代码中添加了注释：

```
$(document).ready(function(){
    $(document).bind("contextmenu",function(e){
        return false;
        $('.alert').fadeToggle(); // this line never gets called
    });
}); 
```

尝试`return false;`与下一行交换。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-08-27T17:52:34.623

只需使用事件处理程序。像这样的东西应该工作：

```
$('.js-my-element').bind('contextmenu', function(e) {
     e.preventDefault();
     alert('The eventhandler will make sure, that the contextmenu dosn&#39;t appear.');
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-01-02T14:08:43.903

我在这里找到了这个答案，我正在像这样使用它。

我的库中的代码：

```
$.fn.customContextMenu = function(callBack){
    $(this).each(function(){
        $(this).bind("contextmenu",function(e){
             e.preventDefault();
             callBack();
        });
    }); 
} 
```

我页面脚本中的代码：

```
$("#newmagazine").customContextMenu(function(){
    alert("some code");
}); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-11-25T11:38:04.480

```
document.oncontextmenu = function() {return false;}; //disable the browser context menu
$('selector-name')[0].oncontextmenu = function(){} //set jquery element context menu 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T18:09:49.903

是`contextmenu`事件吗？

我会使用`onmousedown`或`onclick`然后抓取`MouseEvent`的**按钮**属性来确定按下了哪个按钮（0 = 左，1 = 中，2 = 右）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-01T11:37:10.747

要在页面的所有图像上禁用右键单击上下文菜单，只需执行以下操作：

```
jQuery(document).ready(function(){
    // Disable context menu on images by right clicking
    for(i=0;i<document.images.length;i++) {
        document.images[i].onmousedown = protect;
    }
});

function protect (e) {
    //alert('Right mouse button not allowed!');
    this.oncontextmenu = function() {return false;};
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-03-03T07:04:10.197

**.contextmenu**方法：-

尝试如下

```
<div id="wrap">Right click</div>

<script>
$('#wrap').contextmenu(function() {
  alert("Right click");
});
</script> 
```

**.mousedown**方法：-

```
$('#wrap').mousedown(function(event) {

        if(event.which == 3){
            alert('Right Mouse button pressed.');
        }  
}); 
```

# c# - ASP.NET 2.0 - 需要以编程方式单击链接

> ID：706659
> 
> 赞同：2
> 
> 时间：2009-04-01T17:49:48.500
> 
> 标签：c#, asp.net, hyperlink

有没有办法以编程方式单击链接，使其具有与用户单击它相同的效果？

例子：

我有一个 ASP.NET LinkBut​​ton：

```
<asp:LinkButton id="lnkExport" runat="server" CssClass="navclass">Export</asp:LinkButton> 
```

我在侧边栏上有一个链接，指向上面有这个链接按钮的 .aspx 页面。由于各种原因，在页面刷新之前我无法执行 LinkBut​​ton 的代码——所以我正在寻找一种方法，在页面完全加载后在我的代码中强制单击此 LinkBut​​ton。有没有简单/可行的方法来实现这一点？如果涉及触发事件，请尽可能提供代码示例。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:03:04.910

在链接上以编程方式触发点击事件将触发“onclick”事件，但不会触发默认操作（href）。

并且由于链接按钮以 href 形式出现，因此您可以尝试使用 Javascript 来执行此操作。

```
var lnkExport = document.getElementById('<%= lnkExport.ClientID %>');
if(lnkExport){
   window.location = lnkExport.href;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:10:14.627

我当然认为，有一个设计和实现缺陷迫使您按照您的描述得出结论。

好吧，调用点击事件意味着执行事件注册方法。

所以，我能想到的最糟糕的建议是，只需在您希望发生点击事件的时候调用该函数，例如，

lnkExport_Click(lnkExport, new EventArgs());

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T17:55:55.973

如果您只是想以编程方式单击该链接，我不确定为什么需要加载页面。我建议在服务器端使用 Response.Redirect() 将它们重定向到该页面。不确定是否有其他情有可原的原因这种简单的方法不起作用......

——马特

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T18:03:27.950

```
<button onclick="document.getElementById('<%=this.lnkExport.ClienID%>').click()">
 click me</button> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T18:07:56.707

如果我明白你在说什么：

```
<asp:LinkButton id="lnkExport" runat="server" CssClass="navclass" onclick="lnkExport_Click">Export</asp:LinkButton> 
```

然后在您的代码隐藏中或在您需要时调用以下命令...

```
lnkExport_Click( null, null ); 
```

并确保您已连接 lnkExport_Click。

```
protected void lnkExport_Click( object sender, EventArgs e )
{
//DO Whatever here
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T18:30:35.797

Rashack 的帖子展示了如何做到这一点。你可以用javascript来做。

```
 function ClickLink() {
  document.getElementById('').click();
} 
```

如果您希望它在其他事件之后触发，您可以在 c# 中添加代码以在页面加载时在客户端添加对该函数的调用。

```
 Page.ClientScript.RegisterStartupScript(
  this.getType(), 
  "clickLink", 
  "ClickLink();",
  true); 
```

# hibernate - Spring MVC 表单：选择标签，多选未正确绑定？

> ID：706660
> 
> 赞同：7
> 
> 时间：2009-04-01T17:50:28.467
> 
> 标签：hibernate, spring, spring-mvc, jsp-tags

我正在尝试创建一个表单来编辑现有的数据库行。我正在使用 Spring MVC 表单标签将 html 自动绑定到表单支持对象。该行与另一个表有多对多的关系，我试图用一个多选框表示，使用 form:select 标记；

```
<form:select path="rules">
    <form:options items="${bundle.rules}" itemValue="name" itemLabel="name"/>
</form:select> 
```

我使用 Hibernate 进行持久性，因此关系表示为 Bundle pojo 中的 HashSet。

```
 private Set<Rule> rules = new HashSet<Rule>(0); 
```

如果没有页面上的选择框，对象将正确更新到数据库，但是使用选择框，对象将不会更新到数据库，并且我在 log4j 日志中收到此错误，请注意此错误不会导致异常，仅在日志中可见；

```
DEBUG org.springframework.web.servlet.mvc.SimpleFormController.processFormSubmission(SimpleFormController.java:256) - Data binding errors: 1 
```

无论我在选择框中取消选择项目，都会发生这种情况，整个表单拒绝正确提交。谁能帮我？

我知道[How do I bind collection attributes to a form in Spring MVC](https://stackoverflow.com/questions/284368/how-do-i-bind-collection-attributes-to-a-form-in-spring-mvc)，这与这个问题类似，不幸的是，这些建议对我的问题似乎都没有用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T07:44:26.993

问题在于提交表单。Spring 无法绑定命令的对象，因此它不会提交表单，而是将您重定向到 formView。

成功执行绑定后，您将看到以下消息：

```
No errors -> processing submit 
```

要解决您的问题，您需要向控制器注册一个 CustomCollectionEditor。（请参阅此[链接](http://sirinsevinc.wordpress.com/tag/customcollectioneditor/)）。它会是这样的：

```
protected void initBinder(HttpServletRequest request, ServletRequestDataBinder binder) throws Exception
{   
  binder.registerCustomEditor(Set.class, "rules", new CustomCollectionEditor(Set.class)
  {
    protected Object convertElement(Object element)
    {
        String name = "";

        if (element instanceof String)
            name = (String) element;

        return name != null ? new Rule(name) : null;
    }
  });
} 
```

# java - 哪种方法更好地加载 JDBC 驱动程序？

> ID：706662
> 
> 赞同：7
> 
> 时间：2009-04-01T17:50:44.690
> 
> 标签：java, jdbc

加载驱动程序有两种方式：

1.  `Class.forName()`

2.  `DriverManager.registerDriver()`

方法 1 在内部也调用 DriverManager.registerDriver，方法 1 是首选方法。

但为什么？是否有任何小的差异或性能等更好？
任何意见表示赞赏..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T23:58:54.913

如果使用 Class.forName()，则不需要对特定 JDBC 驱动程序有任何编译时依赖项。这在您编写可用于各种数据库的代码时特别有用。

考虑以下代码：

```
// Register the PostgreSQL driver
Class.forName("org.postgresql.Driver"); 
```

现在将其与：

```
import org.postgresql.Driver;

// Register the PostgreSQL driver
DriverManager.registerDriver(new Driver()); 
```

并考虑在第一个示例中，类名也可能来自属性文件、XML 文件等，具体取决于您的应用程序的便利性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T21:05:21.757

[JDBC API 教程和参考](https://rads.stackoverflow.com/amzn/click/com/0321173848)是此类问题的最佳参考，其中的一部分[讨论了 Driver 和 DriverManager 类所扮演的角色](http://java.sun.com/j2se/1.5.0/docs/guide/jdbc/getstart/drivermanager.html)。

**所有 Driver 类都应该有一个静态初始化器，负责创建该 Driver 的实例，并在 Driver 类加载时将其注册到 DriverManager。**

此外，DriverManager.getConnection() 可能是该类中唯一对用户空间友好的方法。大多数使用 JDBC API 的开发人员通常不使用大多数其他方法。所以那句老话仍然存在 - 使用 Class.forName() 加载驱动程序，然后使用 DriverManager.getConnection() 获取到数据库的连接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:17:08.947

阅读[JavaDoc](http://java.sun.com/javase/6/docs/api/java/sql/DriverManager.html)看起来需要 Class.forName 开始，然后事情发生了变化，因此它不再是首选方式（或所需方式）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T18:48:24.193

不得不说，如果你通过静态引用驱动来构造一个驱动实例，你的生活会轻松很多。一旦你有了它，你就可以忽略`DriverManager`哪个是邪恶的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T23:29:03.363

“性能等更好吗？”

我想说的是，这种一次性操作的性能是您最不担心的。

如果您使用的是 Java EE 应用服务器，答案是“两者都不是”。您应该设置一个连接池并让它处理加载驱动程序和分发连接。

# sql - 我如何（快速）整理来自不同表格的 ID？

> ID：706663
> 
> 赞同：2
> 
> 时间：2009-04-01T17:50:47.530
> 
> 标签：sql, sql-server, normalization, etl

我有三个非规范化表，我必须从表面上看（数据来自一些外部资源）。这三个表有不同的定义，但它们各自从不同的角度描述了同一个对象。

```
 object1  A  B
   object2  A
   object3     B  C
   object4        C 
```

这些表之间唯一的共同点是它们的主键。我可以使用 SELECT UNION SELECT 将 ID 聚集在一起，但查询似乎相对较慢，即使每个表都有其 PK 字段索引。我可以创建一个视图来抽象这个查询 vw_object_ids，但它以相同的速度执行。我想我可以添加一个索引来实现视图，但是在 SQL Server 2005 中，您不能使用 UNION 来索引视图。

我想要的是让 ID 的主索引与基础数据同步，这些数据可能随时更新或删除。我想我可以通过一组疯狂的触发器无限期地完成此任务，或者只是满足于未索引视图的速度。但我只是想确保我没有遗漏任何选项，或者这个场景是否有名称或是否表明了一种模式。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T17:58:51.893

创建一个只包含 ID 的主表：

```
CREATE TABLE master (ID INT NOT NULL PRIMARY KEY) 
```

并使用 . 使所有三个表都引用该主表`ON DELETE CASCADE`。

要首次填充表格，请发出

```
INSERT
INTO    master
SELECT  id
FROM    a
UNION
SELECT  id
FROM    b
UNION
SELECT  id
FROM    c 
```

要定期填充表，请在三个表中的每一个上创建一个触发器。

此触发器应尝试插入新`ID`的 to并在违反时`master`静默失败。`PRIMARY KEY`

要查询，请使用：

```
SELECT  *
FROM    master m
LEFT OUTER JOIN
        a
ON      a.id = m.id
LEFT OUTER JOIN
        b
ON      b.id = m.id
LEFT OUTER JOIN
        c
ON      c.id = m.id 
```

这将有效地使用索引。

要删除，请使用：

```
DELETE
FROM    master
WHERE   id = @id 
```

这将触发`ON DELETE CASCADE`并删除所有三个表中的记录（如果有）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T17:56:39.043

为什么不直接进行外部连接，然后合并组件表中的列呢？

# sql - 使用 Query 为现有表生成 SQL 创建脚本

> ID：706664
> 
> 赞同：87
> 
> 时间：2009-04-01T17:51:17.747
> 
> 标签：sql, sql-server, tsql

我正在尝试获取 SQL Server 2008 中现有表的 CREATE 脚本。我假设我可以通过以某种方式查询 sys.tables 来做到这一点，但这并没有返回我的 CREATE 脚本数据。

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2013-05-28T16:53:30.007

这可能对你有帮助。该脚本为任何表生成索引、FK、PK 和通用结构。

例如 -

**DDL：**

```
CREATE TABLE [dbo].[WorkOut](
    [WorkOutID] [bigint] IDENTITY(1,1) NOT NULL,
    [TimeSheetDate] [datetime] NOT NULL,
    [DateOut] [datetime] NOT NULL,
    [EmployeeID] [int] NOT NULL,
    [IsMainWorkPlace] [bit] NOT NULL,
    [DepartmentUID] [uniqueidentifier] NOT NULL,
    [WorkPlaceUID] [uniqueidentifier] NULL,
    [TeamUID] [uniqueidentifier] NULL,
    [WorkShiftCD] [nvarchar](10) NULL,
    [WorkHours] [real] NULL,
    [AbsenceCode] [varchar](25) NULL,
    [PaymentType] [char](2) NULL,
    [CategoryID] [int] NULL,
    [Year]  AS (datepart(year,[TimeSheetDate])),
 CONSTRAINT [PK_WorkOut] PRIMARY KEY CLUSTERED 
(
    [WorkOutID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE [dbo].[WorkOut] ADD  
CONSTRAINT [DF__WorkOut__IsMainW__2C1E8537]  DEFAULT ((1)) FOR [IsMainWorkPlace]

ALTER TABLE [dbo].[WorkOut]  WITH CHECK ADD  CONSTRAINT [FK_WorkOut_Employee_EmployeeID] FOREIGN KEY([EmployeeID])
REFERENCES [dbo].[Employee] ([EmployeeID])

ALTER TABLE [dbo].[WorkOut] CHECK CONSTRAINT [FK_WorkOut_Employee_EmployeeID] 
```

**询问：**

```
DECLARE @table_name SYSNAME
SELECT @table_name = 'dbo.WorkOut'

DECLARE 
      @object_name SYSNAME
    , @object_id INT

SELECT 
      @object_name = '[' + s.name + '].[' + o.name + ']'
    , @object_id = o.[object_id]
FROM sys.objects o WITH (NOWAIT)
JOIN sys.schemas s WITH (NOWAIT) ON o.[schema_id] = s.[schema_id]
WHERE s.name + '.' + o.name = @table_name
    AND o.[type] = 'U'
    AND o.is_ms_shipped = 0

DECLARE @SQL NVARCHAR(MAX) = ''

;WITH index_column AS 
(
    SELECT 
          ic.[object_id]
        , ic.index_id
        , ic.is_descending_key
        , ic.is_included_column
        , c.name
    FROM sys.index_columns ic WITH (NOWAIT)
    JOIN sys.columns c WITH (NOWAIT) ON ic.[object_id] = c.[object_id] AND ic.column_id = c.column_id
    WHERE ic.[object_id] = @object_id
),
fk_columns AS 
(
     SELECT 
          k.constraint_object_id
        , cname = c.name
        , rcname = rc.name
    FROM sys.foreign_key_columns k WITH (NOWAIT)
    JOIN sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id AND rc.column_id = k.referenced_column_id 
    JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id AND c.column_id = k.parent_column_id
    WHERE k.parent_object_id = @object_id
)
SELECT @SQL = 'CREATE TABLE ' + @object_name + CHAR(13) + '(' + CHAR(13) + STUFF((
    SELECT CHAR(9) + ', [' + c.name + '] ' + 
        CASE WHEN c.is_computed = 1
            THEN 'AS ' + cc.[definition] 
            ELSE UPPER(tp.name) + 
                CASE WHEN tp.name IN ('varchar', 'char', 'varbinary', 'binary', 'text')
                       THEN '(' + CASE WHEN c.max_length = -1 THEN 'MAX' ELSE CAST(c.max_length AS VARCHAR(5)) END + ')'
                     WHEN tp.name IN ('nvarchar', 'nchar', 'ntext')
                       THEN '(' + CASE WHEN c.max_length = -1 THEN 'MAX' ELSE CAST(c.max_length / 2 AS VARCHAR(5)) END + ')'
                     WHEN tp.name IN ('datetime2', 'time2', 'datetimeoffset') 
                       THEN '(' + CAST(c.scale AS VARCHAR(5)) + ')'
                     WHEN tp.name = 'decimal' 
                       THEN '(' + CAST(c.[precision] AS VARCHAR(5)) + ',' + CAST(c.scale AS VARCHAR(5)) + ')'
                    ELSE ''
                END +
                CASE WHEN c.collation_name IS NOT NULL THEN ' COLLATE ' + c.collation_name ELSE '' END +
                CASE WHEN c.is_nullable = 1 THEN ' NULL' ELSE ' NOT NULL' END +
                CASE WHEN dc.[definition] IS NOT NULL THEN ' DEFAULT' + dc.[definition] ELSE '' END + 
                CASE WHEN ic.is_identity = 1 THEN ' IDENTITY(' + CAST(ISNULL(ic.seed_value, '0') AS CHAR(1)) + ',' + CAST(ISNULL(ic.increment_value, '1') AS CHAR(1)) + ')' ELSE '' END 
        END + CHAR(13)
    FROM sys.columns c WITH (NOWAIT)
    JOIN sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id
    LEFT JOIN sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] AND c.column_id = cc.column_id
    LEFT JOIN sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 AND c.[object_id] = dc.parent_object_id AND c.column_id = dc.parent_column_id
    LEFT JOIN sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 AND c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id
    WHERE c.[object_id] = @object_id
    ORDER BY c.column_id
    FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, CHAR(9) + ' ')
    + ISNULL((SELECT CHAR(9) + ', CONSTRAINT [' + k.name + '] PRIMARY KEY (' + 
                    (SELECT STUFF((
                         SELECT ', [' + c.name + '] ' + CASE WHEN ic.is_descending_key = 1 THEN 'DESC' ELSE 'ASC' END
                         FROM sys.index_columns ic WITH (NOWAIT)
                         JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id
                         WHERE ic.is_included_column = 0
                             AND ic.[object_id] = k.parent_object_id 
                             AND ic.index_id = k.unique_index_id     
                         FOR XML PATH(N''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, ''))
            + ')' + CHAR(13)
            FROM sys.key_constraints k WITH (NOWAIT)
            WHERE k.parent_object_id = @object_id 
                AND k.[type] = 'PK'), '') + ')'  + CHAR(13)
    + ISNULL((SELECT (
        SELECT CHAR(13) +
             'ALTER TABLE ' + @object_name + ' WITH' 
            + CASE WHEN fk.is_not_trusted = 1 
                THEN ' NOCHECK' 
                ELSE ' CHECK' 
              END + 
              ' ADD CONSTRAINT [' + fk.name  + '] FOREIGN KEY(' 
              + STUFF((
                SELECT ', [' + k.cname + ']'
                FROM fk_columns k
                WHERE k.constraint_object_id = fk.[object_id]
                FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')
               + ')' +
              ' REFERENCES [' + SCHEMA_NAME(ro.[schema_id]) + '].[' + ro.name + '] ('
              + STUFF((
                SELECT ', [' + k.rcname + ']'
                FROM fk_columns k
                WHERE k.constraint_object_id = fk.[object_id]
                FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')
               + ')'
            + CASE 
                WHEN fk.delete_referential_action = 1 THEN ' ON DELETE CASCADE' 
                WHEN fk.delete_referential_action = 2 THEN ' ON DELETE SET NULL'
                WHEN fk.delete_referential_action = 3 THEN ' ON DELETE SET DEFAULT' 
                ELSE '' 
              END
            + CASE 
                WHEN fk.update_referential_action = 1 THEN ' ON UPDATE CASCADE'
                WHEN fk.update_referential_action = 2 THEN ' ON UPDATE SET NULL'
                WHEN fk.update_referential_action = 3 THEN ' ON UPDATE SET DEFAULT'  
                ELSE '' 
              END 
            + CHAR(13) + 'ALTER TABLE ' + @object_name + ' CHECK CONSTRAINT [' + fk.name  + ']' + CHAR(13)
        FROM sys.foreign_keys fk WITH (NOWAIT)
        JOIN sys.objects ro WITH (NOWAIT) ON ro.[object_id] = fk.referenced_object_id
        WHERE fk.parent_object_id = @object_id
        FOR XML PATH(N''), TYPE).value('.', 'NVARCHAR(MAX)')), '')
    + ISNULL(((SELECT
         CHAR(13) + 'CREATE' + CASE WHEN i.is_unique = 1 THEN ' UNIQUE' ELSE '' END 
                + ' NONCLUSTERED INDEX [' + i.name + '] ON ' + @object_name + ' (' +
                STUFF((
                SELECT ', [' + c.name + ']' + CASE WHEN c.is_descending_key = 1 THEN ' DESC' ELSE ' ASC' END
                FROM index_column c
                WHERE c.is_included_column = 0
                    AND c.index_id = i.index_id
                FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + ')'  
                + ISNULL(CHAR(13) + 'INCLUDE (' + 
                    STUFF((
                    SELECT ', [' + c.name + ']'
                    FROM index_column c
                    WHERE c.is_included_column = 1
                        AND c.index_id = i.index_id
                    FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + ')', '')  + CHAR(13)
        FROM sys.indexes i WITH (NOWAIT)
        WHERE i.[object_id] = @object_id
            AND i.is_primary_key = 0
            AND i.[type] = 2
        FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)')
    ), '')

PRINT @SQL
--EXEC sys.sp_executesql @SQL 
```

**输出：**

```
CREATE TABLE [dbo].[WorkOut]
(
      [WorkOutID] BIGINT NOT NULL IDENTITY(1,1)
    , [TimeSheetDate] DATETIME NOT NULL
    , [DateOut] DATETIME NOT NULL
    , [EmployeeID] INT NOT NULL
    , [IsMainWorkPlace] BIT NOT NULL DEFAULT((1))
    , [DepartmentUID] UNIQUEIDENTIFIER NOT NULL
    , [WorkPlaceUID] UNIQUEIDENTIFIER NULL
    , [TeamUID] UNIQUEIDENTIFIER NULL
    , [WorkShiftCD] NVARCHAR(10) COLLATE Cyrillic_General_CI_AS NULL
    , [WorkHours] REAL NULL
    , [AbsenceCode] VARCHAR(25) COLLATE Cyrillic_General_CI_AS NULL
    , [PaymentType] CHAR(2) COLLATE Cyrillic_General_CI_AS NULL
    , [CategoryID] INT NULL
    , [Year] AS (datepart(year,[TimeSheetDate]))
    , CONSTRAINT [PK_WorkOut] PRIMARY KEY ([WorkOutID] ASC)
)

ALTER TABLE [dbo].[WorkOut] WITH CHECK ADD CONSTRAINT [FK_WorkOut_Employee_EmployeeID] FOREIGN KEY([EmployeeID]) REFERENCES [dbo].[Employee] ([EmployeeID])
ALTER TABLE [dbo].[WorkOut] CHECK CONSTRAINT [FK_WorkOut_Employee_EmployeeID]

CREATE NONCLUSTERED INDEX [IX_WorkOut_WorkShiftCD_AbsenceCode] ON [dbo].[WorkOut] ([WorkShiftCD] ASC, [AbsenceCode] ASC)
INCLUDE ([WorkOutID], [WorkHours]) 
```

**另请查看这篇文章 -**

[如何为现有表生成 CREATE TABLE 脚本：第 1 部分](http://www.c-sharpcorner.com/UploadFile/67b45a/how-to-generate-a-create-table-script-for-an-existing-table/)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-01T18:04:33.283

您的意思是您希望创建一个生成 CREATE 脚本的 TSQL 脚本，或者使用 SQL SERVER Management Studio 中的管理工具来生成一个 Create 脚本？

如果是后者，只需右键单击一个表，然后选择 Script Table As -> Create To -> New Query Window。

如果您想编写整个数据库的脚本，请右键单击数据库并选择 Tasks--> Generate Scripts... 然后按照向导进行操作

否则就是从各种系统表中选择各种有趣的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-09T13:27:03.097

我意识到这个问题很老，但它最近出现在我刚刚运行的搜索中，所以我想我会发布上述答案的替代方案。

如果您希望`create`在 .Net 中以编程方式生成脚本，我强烈建议您查看[服务器管理对象](http://msdn.microsoft.com/en-us/library/ms162169.aspx)(SMO) 或[分布式管理对象](http://msdn.microsoft.com/en-us/library/aa258911.aspx)(DMO) - 取决于您使用的 SQL Server 版本（前者是 2005+，后者 2000 年）。使用这些库，编写表格脚本非常简单：

```
Server server      = new Server(".");
Database northwind = server.Databases["Northwind"];
Table categories   = northwind.Tables["Categories"];

StringCollection script = categories.Script();
string[] scriptArray    = new string[script.Count];

script.CopyTo(scriptArray, 0); 
```

[这](http://www.mssqltips.com/sqlservertip/1833/generate-scripts-for-database-objects-with-smo-for-sql-server/)是一篇包含更多信息的博客文章。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-03-08T17:26:16.783

首先我很喜欢 devart 写的脚本，我也想用它，但是我发现了一些限制，所以我决定改进它：

*   我修复了将脚本限制为 4000 个字符的错误（仍然有可能一些疯狂的表格仍然超出限制）
*   我修复了表使用非聚集主键的错误/限制
*   我用引号替换了 '['
*   我添加了默认约束的名称
*   我更改了逻辑以识别源表
*   我添加了删除和重新创建表及其 FK 的可能性
*   我添加了生成特定属性的可能性
*   我添加了对表压缩的支持
*   我添加了为任意数量的表生成脚本的可能性
*   我在打印结果时修复了 4000 varchar() 的限制
*   我用 N'' 替换了 ''
*   我添加了在执行期间生成消息的选项，因为我的最终脚本（插入）可能需要很长时间，以至于我想知道它在做什么
*   我添加了“插入”的生成

我没有时间正确测试它，我只在 SQL Server 2012/4 上测试过

下一个版本将更改 FK 的生成，因为它们需要在最后添加。否则他们可能会失败。

任何评论将不胜感激。

```
set transaction isolation level read uncommitted;
SET NOCOUNT ON;
SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

-- http://stackoverflow.com/questions/12639948/sql-nvarchar-and-varchar-limits
--NB: Crazy table can still have truncation at 4000 because of unexpected number of indexes or other very long list of columns/defaults etc
-- triggers are not supported
-- xml indexes are not supported

DECLARE @Tables table(id int identity(1,1), [name] sysname);
insert into @Tables([name])
values
   ('<yourSchema>.<youTableName>')
  ,('<yourSchema2>.<youTableName2>')
;
DECLARE @object_id                          int;
DECLARE @SourceDatabase nvarchar(max) = N'SourceTest'; --this is used only by the insert 
DECLARE @TargetDatabase nvarchar(max) = N'DescTest';   --this is used only by the insert and USE <DBName>

--- options ---
DECLARE @UseTransaction                     bit = 0; 
DECLARE @GenerateUseDatabase                bit = 0;
DECLARE @GenerateFKs                        bit = 1;
DECLARE @GenerateIdentity                   bit = 1;
DECLARE @GenerateCollation                  bit = 0;
DECLARE @GenerateCreateTable                bit = 1;
DECLARE @GenerateIndexes                    bit = 1;
DECLARE @GenerateConstraints                bit = 1;
DECLARE @GenerateKeyConstraints             bit = 1;
DECLARE @GenerateConstraintNameOfDefaults   bit = 1;
DECLARE @GenerateDropIfItExists             bit = 1;
DECLARE @GenerateDropFKIfItExists           bit = 0;
DECLARE @GenerateDelete                     bit = 0;
DECLARE @GenerateInsertInto                 bit = 0;
DECLARE @GenerateIdentityInsert             int = 0; --0 ignore set,but add column; 1 generate; 2 ignore set and column
DECLARE @GenerateSetNoCount                 int = 2; --0 ignore set,1=set on, 2=set off 
DECLARE @GenerateMessages                   bit = 1; --print with no wait
DECLARE @GenerateDataCompressionOptions     bit = 1; --TODO: generates the compression option only of the table, not the indexes
                                                    --NB: the compression options reflects the design value.
                                                    --The actual compression of a the page is saved here
                                                    --SELECT * from sys.dm_db_database_page_allocations(DB_ID(), @object_ID, 0, 1, 'DETAILED')

-----------------------------------------------------------------------------
------------------------------------------------------------------------------
--- Let's play
DECLARE @DataTypeSpacer                     int = 45; --this is just to improve the formatting of the script ...
DECLARE @name                               sysname;
DECLARE @SQL                                NVARCHAR(MAX) = N''

DECLARE db_cursor CURSOR FOR SELECT [name] from @Tables
OPEN db_cursor  
FETCH NEXT FROM db_cursor INTO @name  

WHILE @@FETCH_STATUS = 0  
BEGIN  
    SET @object_id = object_ID(@name)
    goto CreateScript;
backFromCreateScript:
    FETCH NEXT FROM db_cursor INTO @name 
END 
CLOSE db_cursor  
DEALLOCATE db_cursor 
return;

CreateScript:

DECLARE @CR NVARCHAR(max) = NCHAR(13);
DECLARE @TB NVARCHAR(max) = NCHAR(9);
DECLARE @CurrentIndent nvarchar(max) = ''

;WITH index_column AS 
(
    SELECT 
        ic.[object_id]
        , ic.index_id
        , ic.is_descending_key
        , ic.is_included_column
        , c.name
    FROM sys.index_columns ic WITH (NOWAIT)
    JOIN sys.columns c WITH (NOWAIT) ON ic.[object_id] = c.[object_id] AND ic.column_id = c.column_id
    WHERE ic.[object_id] = @object_id
),
fk_columns AS 
(
    SELECT 
        k.constraint_object_id
        , cname = c.name
        , rcname = rc.name
    FROM sys.foreign_key_columns k WITH (NOWAIT)
    JOIN sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id AND rc.column_id = k.referenced_column_id 
    JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id AND c.column_id = k.parent_column_id
    WHERE k.parent_object_id = @object_id and @GenerateFKs = 1
)
SELECT @SQL = 

    --------------------  USE DATABASE   --------------------------------------------------------------------------------------------------
        CAST(
            CASE WHEN @GenerateUseDatabase = 1
            THEN N'USE ' + @TargetDatabase + N';' + @CR
            ELSE N'' END 
        as nvarchar(max))
        +
    --------------------  SET NOCOUNT   --------------------------------------------------------------------------------------------------
        CAST(
            CASE @GenerateSetNoCount 
            WHEN 1 THEN N'SET NOCOUNT ON;' + @CR
            WHEN 2 THEN N'SET NOCOUNT OFF;' + @CR
            ELSE N'' END 
        as nvarchar(max))
        +
    --------------------  USE TRANSACTION  --------------------------------------------------------------------------------------------------
        CAST(
            CASE WHEN @UseTransaction = 1
            THEN 
                N'SET XACT_ABORT ON' + @CR
                + N'BEGIN TRY' + @CR
                + N'BEGIN TRAN' + @CR
            ELSE N'' END 
        as nvarchar(max))
        +
    --------------------  DROP SYNONYM   --------------------------------------------------------------------------------------------------
        CASE WHEN @GenerateDropIfItExists = 1
        THEN 
            CAST(
                    N'IF OBJECT_ID(''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''',''SN'') IS NOT NULL DROP SYNONYM ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N';' + @CR 
            as nvarchar(max))
        ELSE 
            CAST(
                    N'' 
            as nvarchar(max))
        END 
        +
    --------------------  DROP IS Exists --------------------------------------------------------------------------------------------------
        CASE WHEN @GenerateDropIfItExists = 1
        THEN 
            --Drop table if exists
            CAST(
                N'IF OBJECT_ID(''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''',''U'') IS NOT NULL DROP TABLE ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N';' + @CR 
            as nvarchar(max))
            + @CR
        ELSE N'' END 
        +
    --------------------  DROP IS Exists --------------------------------------------------------------------------------------------------
        CAST((CASE WHEN @GenerateMessages = 1 and @GenerateDropFKIfItExists = 1 THEN 
            N'RAISERROR(''DROP CONSTRAINTS OF %s'',10,1, ''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''') WITH NOWAIT;' + @CR            
        ELSE N'' END) as nvarchar(max)) 
        +
        CASE WHEN @GenerateDropFKIfItExists = 1
        THEN 
            --Drop foreign keys
            ISNULL(((
                SELECT 
                    CAST(
                        N'ALTER TABLE ' + quotename(s.name) + N'.' + quotename(t.name) + N' DROP CONSTRAINT ' + RTRIM(f.name) + N';' + @CR
                    as nvarchar(max))
                FROM sys.tables t
                INNER JOIN sys.foreign_keys f ON f.parent_object_id = t.object_id
                INNER JOIN sys.schemas      s ON s.schema_id = f.schema_id
                WHERE f.referenced_object_id = @object_id
                FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'))
            ,N'') + @CR
        ELSE N'' END 
    +
    --------------------- CREATE TABLE -----------------------------------------------------------------------------------------------------------------
    CAST((CASE WHEN @GenerateMessages = 1 THEN 
        N'RAISERROR(''CREATE TABLE %s'',10,1, ''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''') WITH NOWAIT;' + @CR           
    ELSE N'' END) as nvarchar(max)) 
    +
    CASE WHEN @GenerateCreateTable = 1 THEN 
        CAST(
            N'CREATE TABLE ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + @CR + N'(' + @CR + STUFF((
            SELECT 
                CAST(
                    @TB + N',' + quotename(c.name) + N' ' + ISNULL(replicate(' ',@DataTypeSpacer - len(quotename(c.name))),'')  --isnull(replicate) then len(quotename(c.name)) > @DataTypeSpacer
                    +  
                    CASE WHEN c.is_computed = 1
                        THEN N' AS ' + cc.[definition] 
                        ELSE UPPER(tp.name) + 
                            CASE WHEN tp.name IN (N'varchar', N'char', N'varbinary', N'binary', N'text')
                                    THEN N'(' + CASE WHEN c.max_length = -1 THEN N'MAX' ELSE CAST(c.max_length AS NVARCHAR(5)) END + N')'
                                    WHEN tp.name IN (N'nvarchar', N'nchar', N'ntext')
                                    THEN N'(' + CASE WHEN c.max_length = -1 THEN N'MAX' ELSE CAST(c.max_length / 2 AS NVARCHAR(5)) END + N')'
                                    WHEN tp.name IN (N'datetime2', N'time2', N'datetimeoffset') 
                                    THEN N'(' + CAST(c.scale AS NVARCHAR(5)) + N')'
                                    WHEN tp.name = N'decimal' 
                                    THEN N'(' + CAST(c.[precision] AS NVARCHAR(5)) + N',' + CAST(c.scale AS NVARCHAR(5)) + N')'
                                ELSE N''
                            END +
                            CASE WHEN c.collation_name IS NOT NULL and @GenerateCollation = 1 THEN N' COLLATE ' + c.collation_name ELSE N'' END +
                            CASE WHEN c.is_nullable = 1 THEN N' NULL' ELSE N' NOT NULL' END +
                            CASE WHEN dc.[definition] IS NOT NULL THEN CASE WHEN @GenerateConstraintNameOfDefaults = 1 THEN N' CONSTRAINT ' + quotename(dc.name) ELSE N'' END + N' DEFAULT' + dc.[definition] ELSE N'' END + 
                            CASE WHEN ic.is_identity = 1 and @GenerateIdentity = 1 THEN N' IDENTITY(' + CAST(ISNULL(ic.seed_value, N'0') AS NCHAR(1)) + N',' + CAST(ISNULL(ic.increment_value, N'1') AS NCHAR(1)) + N')' ELSE N'' END 
                    END + @CR
                AS nvarchar(Max))
            FROM sys.columns c WITH (NOWAIT)
                INNER JOIN sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id
                LEFT JOIN sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] AND c.column_id = cc.column_id
                LEFT JOIN sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 AND c.[object_id] = dc.parent_object_id AND c.column_id = dc.parent_column_id
                LEFT JOIN sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 AND c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id
            WHERE c.[object_id] = @object_id
            ORDER BY c.column_id
            FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'), 1, 2, @TB + N' ')
    as nvarchar(max))
    ELSE 
        CAST('' as nvarchar(max)) 
    end 
    + 
    ---------------------- Key Constraints ----------------------------------------------------------------
    CAST(
        case when @GenerateKeyConstraints <> 1 THEN N'' ELSE 
            ISNULL((SELECT @TB + N', CONSTRAINT ' + quotename(k.name) + N' PRIMARY KEY ' + ISNULL(kidx.type_desc, N'') + N'(' + 
                        (SELECT STUFF((
                            SELECT N', ' + quotename(c.name) + N' ' + CASE WHEN ic.is_descending_key = 1 THEN N'DESC' ELSE N'ASC' END
                            FROM sys.index_columns ic WITH (NOWAIT)
                            JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id
                            WHERE ic.is_included_column = 0
                                AND ic.[object_id] = k.parent_object_id 
                                AND ic.index_id = k.unique_index_id     
                            FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'), 1, 2, N''))
                + N')' + @CR
                FROM sys.key_constraints k WITH (NOWAIT) LEFT JOIN sys.indexes kidx ON
                    k.parent_object_id = kidx.object_id and k.unique_index_id = kidx.index_id
                WHERE k.parent_object_id = @object_id 
                    AND k.[type] = N'PK'), N'') + N')'  + @CR
        END 
    as nvarchar(max))
    +
    CAST(
    CASE 
        WHEN 
            @GenerateDataCompressionOptions = 1 
            AND 
            (SELECT top 1 data_compression_desc from sys.partitions where object_ID = @object_id and index_id = 1) <> N'NONE'
        THEN 
            N'WITH (DATA_COMPRESSION=' + (SELECT top 1 data_compression_desc from sys.partitions where object_ID = @object_id and index_id = 1) + N')' + @CR
        ELSE
            N'' + @CR
    END as nvarchar(max))
    + 
    --------------------- FOREIGN KEYS -----------------------------------------------------------------------------------------------------------------
    CAST((CASE WHEN @GenerateMessages = 1 and @GenerateDropFKIfItExists = 1 THEN 
        N'RAISERROR(''CREATING FK OF  %s'',10,1, ''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''') WITH NOWAIT;' + @CR            
    ELSE N'' END) as nvarchar(max)) 
    +
    CAST(
        ISNULL((SELECT (
            SELECT @CR +
            N'ALTER TABLE ' + + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + + N' WITH' 
            + CASE WHEN fk.is_not_trusted = 1 
                THEN N' NOCHECK' 
                ELSE N' CHECK' 
            END + 
            N' ADD CONSTRAINT ' + quotename(fk.name)  + N' FOREIGN KEY(' 
            + STUFF((
                SELECT N', ' + quotename(k.cname) + N''
                FROM fk_columns k
                WHERE k.constraint_object_id = fk.[object_id]
                FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'), 1, 2, N'')
            + N')' +
            N' REFERENCES ' + quotename(SCHEMA_NAME(ro.[schema_id])) + N'.' + quotename(ro.name) + N' ('
            + STUFF((
                SELECT N', ' + quotename(k.rcname) + N''
                FROM fk_columns k
                WHERE k.constraint_object_id = fk.[object_id]
                FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'), 1, 2, N'')
            + N')'
            + CASE 
                WHEN fk.delete_referential_action = 1 THEN N' ON DELETE CASCADE' 
                WHEN fk.delete_referential_action = 2 THEN N' ON DELETE SET NULL'
                WHEN fk.delete_referential_action = 3 THEN N' ON DELETE SET DEFAULT' 
                ELSE N'' 
            END
            + CASE 
                WHEN fk.update_referential_action = 1 THEN N' ON UPDATE CASCADE'
                WHEN fk.update_referential_action = 2 THEN N' ON UPDATE SET NULL'
                WHEN fk.update_referential_action = 3 THEN N' ON UPDATE SET DEFAULT'  
                ELSE N'' 
            END 
            + @CR + N'ALTER TABLE ' + + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + + N' CHECK CONSTRAINT ' + quotename(fk.name)  + N'' + @CR
        FROM sys.foreign_keys fk WITH (NOWAIT)
        JOIN sys.objects ro WITH (NOWAIT) ON ro.[object_id] = fk.referenced_object_id
        WHERE fk.parent_object_id = @object_id
        FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)')), N'')
    as nvarchar(max))
    + 
    --------------------- INDEXES ----------------------------------------------------------------------------------------------------------
    CAST((CASE WHEN @GenerateMessages = 1 and @GenerateIndexes = 1 THEN 
        N'RAISERROR(''CREATING INDEXES OF  %s'',10,1, ''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''') WITH NOWAIT;' + @CR           
    ELSE N'' END) as nvarchar(max)) 
    +
    case when @GenerateIndexes = 1 THEN 
        CAST(
            ISNULL(((SELECT
                @CR + N'CREATE' + CASE WHEN i.is_unique = 1 THEN N' UNIQUE ' ELSE N' ' END 
                        + i.type_desc + N' INDEX ' + quotename(i.name) + N' ON ' + + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + + N' (' +
                        STUFF((
                        SELECT N', ' + quotename(c.name) + N'' + CASE WHEN c.is_descending_key = 1 THEN N' DESC' ELSE N' ASC' END
                        FROM index_column c
                        WHERE c.is_included_column = 0
                            AND c.index_id = i.index_id
                        FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'), 1, 2, N'') + N')'  
                        + ISNULL(@CR + N'INCLUDE (' + 
                            STUFF((
                            SELECT N', ' + quotename(c.name) + N''
                            FROM index_column c
                            WHERE c.is_included_column = 1
                                AND c.index_id = i.index_id
                            FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)'), 1, 2, N'') + N')', N'')  + @CR
                FROM sys.indexes i WITH (NOWAIT)
                WHERE i.[object_id] = @object_id
                    AND i.is_primary_key = 0
                    AND i.[type] in (1,2)
                    and @GenerateIndexes = 1
                FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)')
            ), N'')
        as nvarchar(max))
    ELSE 
        CAST(N'' as nvarchar(max))
    END 
    +
    ------------------------  @GenerateDelete     ----------------------------------------------------------
    CAST((CASE WHEN @GenerateMessages = 1 and @GenerateDelete = 1 THEN 
        N'RAISERROR(''TRUNCATING  %s'',10,1, ''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''') WITH NOWAIT;' + @CR            
    ELSE N'' END) as nvarchar(max)) 
    +
    CASE WHEN @GenerateDelete = 1 THEN
        CAST(
            (CASE WHEN exists (SELECT * FROM sys.foreign_keys WHERE referenced_object_id = @object_id) THEN 
                N'DELETE FROM ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N';' + @CR
            ELSE
                N'TRUNCATE TABLE ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N';' + @CR
            END)
        AS NVARCHAR(max))
    ELSE 
        CAST(N'' as nvarchar(max))
    END 
    +
    ------------------------- @GenerateInsertInto ----------------------------------------------------------
    CAST((CASE WHEN @GenerateMessages = 1 and @GenerateDropFKIfItExists = 1 THEN 
        N'RAISERROR(''INSERTING INTO  %s'',10,1, ''' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N''') WITH NOWAIT;' + @CR            
    ELSE N'' END) as nvarchar(max)) 
    +
    CASE WHEN @GenerateInsertInto = 1
    THEN 
        CAST(
                CASE WHEN EXISTS (SELECT * from sys.columns c where c.[object_id] = @object_id and is_identity = 1) AND @GenerateIdentityInsert = 1 THEN 
                    N'SET IDENTITY_INSERT ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N' ON;' + @CR
                ELSE 
                    CAST('' AS nvarchar(max))
                END 
                +
                N'INSERT INTO ' + QUOTENAME(@TargetDatabase) + N'.' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N'(' 
                + @CR
                +
                (
                    @TB + N' ' + SUBSTRING(
                        (
                        SELECT @TB + ','+ quotename(Name) + @CR 
                        from sys.columns c 
                        where 
                                c.[object_id] = @object_id 
                            AND system_type_ID <> 189 /*timestamp*/ 
                            AND is_computed = 0
                            and (is_identity = 0 or @GenerateIdentityInsert in (0,1))
                        FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)')
                    ,3,99999)

                )
                + N')' + @CR + N'SELECT ' 
                + @CR
                +
                (
                    @TB + N' ' + SUBSTRING(
                        (
                        SELECT @TB + ','+ quotename(Name) + @CR 
                        FROM sys.columns c 
                        WHERE   c.[object_id] = @object_id 
                            and system_type_ID <> 189 /*timestamp*/ 
                            and is_computed = 0                     
                            and (is_identity = 0 or @GenerateIdentityInsert  in (0,1))
                        FOR XML PATH(N''), TYPE).value(N'.', N'NVARCHAR(MAX)')
                    ,3,99999)
                )
                + N'FROM ' + @SourceDatabase +  N'.' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id))            
                + N';' + @CR
                + CASE WHEN EXISTS (SELECT * from sys.columns c where c.[object_id] = @object_id and is_identity = 1)  AND @GenerateIdentityInsert = 1 THEN 
                    N'SET IDENTITY_INSERT ' + quotename(OBJECT_schema_name(@object_id)) + N'.' + quotename(OBJECT_NAME(@object_id)) + N' OFF;'+ @CR
                ELSE 
                    CAST('' AS nvarchar(max))
                END              
        as nvarchar(max))
    ELSE 
        CAST(
                N'' 
        as nvarchar(max))
    END 
    +
    --------------------  USE TRANSACTION  --------------------------------------------------------------------------------------------------
    CAST(
        CASE WHEN @UseTransaction = 1
        THEN 
            @CR + N'COMMIT TRAN; '
            + @CR + N'END TRY'
            + @CR + N'BEGIN CATCH'
            + @CR + N'  IF XACT_STATE() IN (-1,1)'
            + @CR + N'      ROLLBACK TRAN;'
            + @CR + N''
            + @CR + N'  SELECT   ERROR_NUMBER() AS ErrorNumber  '
            + @CR + N'          ,ERROR_SEVERITY() AS ErrorSeverity  '
            + @CR + N'          ,ERROR_STATE() AS ErrorState  '
            + @CR + N'          ,ERROR_PROCEDURE() AS ErrorProcedure  '
            + @CR + N'          ,ERROR_LINE() AS ErrorLine  '
            + @CR + N'          ,ERROR_MESSAGE() AS ErrorMessage; '
            + @CR + N'END CATCH'
        ELSE N'' END 
    as nvarchar(max))

--print is limited to 4000 chars, if necessary, I use multiple print
--to maintain the consistency of the script, I split near the closest CrLF to the max chunk size
DECLARE @i  int = 1;
DECLARE @maxChunk integer = 3990;
DECLARE @len integer = @maxChunk;

WHILE @i < len(@SQL)
BEGIN 
    IF len(@SQL) > (@i + @len)
        set @len = len(substring(@SQL, @i, @maxChunk)) - CHARINDEX(@CR, reverse(substring(@SQL, @i, @len))) + 1
    PRINT substring(@SQL, @i, @len)
    set @i      =  @i + @len
    set @len    =  @maxChunk
END

--SELECT datalength(@SQL), @sql
--EXEC sys.sp_executesql @SQL

goto backFromCreateScript; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-01T18:48:50.713

尝试[sp_helptext 等效于表？](http://social.technet.microsoft.com/Forums/en-US/transactsql/thread/28eeb603-1607-4b56-9461-3c0502cbec9c/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-08T19:56:25.820

“最简单的方法是使用 SQL Management Studio 的内置功能”但是......我已经用一个函数和几个程序解决了它。例如，要为名为“table_name”的表获取创建表，您只需执行名为 sp_ppinScriptTabla 的过程：

```
Exec sp_ppinScriptTabla 'table_name' 
```

这是 tsql 脚本代码：

```
Use Master
GO

Create Function sp_ppinTipoLongitud
(
    @xtype int,
    @length int,
    @isnullable int
)
Returns Varchar(512)
As 
Begin
    -- Función que a partir de un tipo de datos y una logitud, devuelve el texto del tipo.
    -- Por ejemplo: para xtype=varchar y length=10 devolverá "varchar(10)"
    Declare @ret varchar(512)
    Set @ret = ''

    Select @ret = t.name +
    Case When name in ('varchar', 'nvarchar', 'char', 'nchar') Then '(' + Convert(varchar, @length) + ')' Else '' End + ' ' +
    Case @isnullable When 1 Then 'NULL' Else 'NOT NULL' End
    From systypes t 
    Where t.xtype = @xtype

    Return @ret
End
GO

Create Procedure sp_ppinScriptLlavesForaneas
(
    @vchTabla sysname,
    @vchResultado varchar(8000) output
)
AS 
Begin

    DECLARE @tmpFK table(
        TablaF sysname,
        TablaR sysname,
        ColF sysname,
        ColR sysname,
        FKName sysname)

    -- obtengo las llaves foraneas en @vchForeign
    Declare @vchForeign varchar(8000), @FKName sysname, @vchColumnasF varchar(4000), @vchColumnasR varchar(4000), @ColF sysname, @ColR sysname
    Declare @vchTemp varchar(1000), @TablaR sysname

    Insert into @tmpFK
    Select TablaF.name AS TablaF, TablaR.name AS TablaR, ColF.name AS ColF, ColR.name AS ColR, ofk.name AS FKName
    From sysforeignkeys fk, sysobjects ofk, sysobjects TablaF, sysobjects TablaR, 
    syscolumns ColF, syscolumns ColR
    Where TablaF.name = @vchTabla
    And ofk.id = fk.constid
    And TablaF.id = fk.fkeyid
    And TablaR.id = fk.rkeyid
    And ColF.id = TablaF.id And ColF.colid = fk.fkey
    And ColR.id = TablaR.id And ColR.colid = fk.rkey
    order by FKName

    Set @vchForeign = ''
    While Exists ( Select * From @tmpFK )
    Begin
        Select Top 1 @FKName = FKName From @tmpFK
        Set @vchColumnasF = ''
        Set @vchColumnasR = ''
        While Exists ( Select * From @tmpFK Where FKName = @FKName )
        Begin
            Select Top 1 @ColF = ColF, @ColR = ColR, @TablaR = TablaR From @tmpFK Where FKName = @FKName
            Delete From @tmpFK Where ColF = @ColF And ColR = @ColR And TablaR = @TablaR And FKName = @FKName
            Set @vchColumnasF = @vchColumnasF + @ColF + ', '
            Set @vchColumnasR = @vchColumnasR + @ColR + ', '
        End

        Set @vchColumnasF = LEFT(@vchColumnasF, LEN(@vchColumnasF) - 1)
        Set @vchColumnasR = LEFT(@vchColumnasR, LEN(@vchColumnasR) - 1)
        Set @vchTemp = 'Constraint ' + @FKName + ' Foreign Key (' + @vchColumnasF + ') '
        Set @vchTemp = @vchTemp + 'References ' + @TablaR + ' (' + @vchColumnasR + ')'
        Set @vchForeign = @vchForeign + char(9) + @vchTemp + ',' + char(13) 
    End

    Select @vchResultado = Case When Len(@vchForeign) >=2 Then Left(@vchForeign, Len(@vchForeign) - 2) Else @vchForeign End
End
GO

Create Procedure sp_ppinScriptTabla
(
    @vchTabla sysname
)
AS

Set nocount on

-- Obtengo las foreign keys
Declare @foreign varchar(8000)
Exec sp_ppinScriptLlavesForaneas @vchTabla, @foreign output

-- SELECT que devuelve el script de Create Table de la tabla
Select 'Create ' + 
Case o.xtype When 'U' Then 'Table' When 'P' Then 'Procedure' Else '??' End + ' ' +
@vchTabla + char(13) + '('
From sysobjects o
Where o.name = @vchTabla
Union all
-- Campos + identitys + DEFAULTS
select char(9) + c.name + ' ' +                                 -- Nombre
dbo.sp_ppinTipoLongitud(t.xtype, c.length, c.isnullable) +          -- Tipo(longitud)
Case When c.colstat & 1 = 1                                     -- Identity (si aplica)
    Then ' Identity(' + convert(varchar, ident_seed(@vchTabla)) + ',' + Convert(varchar, ident_incr(@vchTabla)) + ')' 
    Else '' 
End + 
Case When not od.name is null                                   -- Defaults (si aplica)
    Then ' Constraint ' + od.name + ' Default ' + replace(replace(cd.text, '((', '('), '))', ')')
    Else ''
End + ', '
from sysobjects o, syscolumns c
LEFT OUTER JOIN sysobjects od On od.id = c.cdefault LEFT OUTER join syscomments cd On cd.id = od.id, 
systypes t
where o.id = object_id(@vchTabla)
and o.id = c.id
and c.xtype = t.xtype
Union all
-- Primary Keys y Unique keys
select char(9) + 'Constraint ' + o.name + ' ' +
Case o.xtype When 'PK' Then 'Primary Key' Else 'Unique' End + ' ' +
dbo.sp_ppinCamposIndice (db_name(), @vchTabla, i.indid) + ', '
from sysobjects o, sysindexes i
where o.parent_obj = object_id(@vchTabla)
and o.xtype in ('PK','UQ')
and i.id = o.parent_obj
and o.name = i.name
Union all
-- Check constraints
select char(9) + 'Constraint ' + o.name + ' Check ' + c.text + ', '
from sysobjects o, syscomments c
where o.parent_obj = object_id(@vchTabla)
and o.xtype in ('C')
and o.id = c.id
Union all
-- Foreign keys
Select @foreign
Union all
Select ')'

Set nocount off
GO 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-01-19T22:06:59.627

您忘记包含存储过程或函数脚本`sp_ppinCamposIndice`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-08-23T14:09:07.910

这是@Devart 答案的细微变化，因此您可以获得临时表的 CREATE 脚本。

请注意，由于 @SQL 变量是一种`NVARCHAR(MAX)`数据类型，您可能无法仅使用 SSMS 从结果中复制它。请参阅此[问题](https://stackoverflow.com/questions/11897950/how-do-you-view-all-text-from-an-ntext-or-nvarcharmax-in-ssms)以了解如何获取**MAX**字段的完整值。

```
DECLARE @temptable_objectid INT = OBJECT_ID('tempdb..#Temp');

DECLARE 
      @object_name SYSNAME
    , @object_id INT

SELECT  
      @object_name = '[' + s.name + '].[' + o.name + ']'
    , @object_id = o.[object_id]
FROM tempdb.sys.objects o WITH (NOWAIT)
JOIN tempdb.sys.schemas s WITH (NOWAIT) ON o.[schema_id] = s.[schema_id]
WHERE object_id = @temptable_objectid

DECLARE @SQL NVARCHAR(MAX) = ''

;WITH index_column AS 
(
    SELECT 
          ic.[object_id]
        , ic.index_id
        , ic.is_descending_key
        , ic.is_included_column
        , c.name
    FROM tempdb.sys.index_columns ic WITH (NOWAIT)
    JOIN tempdb.sys.columns c WITH (NOWAIT) ON ic.[object_id] = c.[object_id] AND ic.column_id = c.column_id
    WHERE ic.[object_id] = @object_id
),
fk_columns AS 
(
     SELECT 
          k.constraint_object_id
        , cname = c.name
        , rcname = rc.name
    FROM tempdb.sys.foreign_key_columns k WITH (NOWAIT)
    JOIN tempdb.sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id AND rc.column_id = k.referenced_column_id 
    JOIN tempdb.sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id AND c.column_id = k.parent_column_id
    WHERE k.parent_object_id = @object_id
)
SELECT @SQL = 'CREATE TABLE ' + @object_name + CHAR(13) + '(' + CHAR(13) + STUFF((
    SELECT CHAR(9) + ', [' + c.name + '] ' + 
        CASE WHEN c.is_computed = 1
            THEN 'AS ' + cc.[definition] 
            ELSE UPPER(tp.name) + 
                CASE WHEN tp.name IN ('varchar', 'char', 'varbinary', 'binary', 'text')
                       THEN '(' + CASE WHEN c.max_length = -1 THEN 'MAX' ELSE CAST(c.max_length AS VARCHAR(5)) END + ')'
                     WHEN tp.name IN ('nvarchar', 'nchar', 'ntext')
                       THEN '(' + CASE WHEN c.max_length = -1 THEN 'MAX' ELSE CAST(c.max_length / 2 AS VARCHAR(5)) END + ')'
                     WHEN tp.name IN ('datetime2', 'time2', 'datetimeoffset') 
                       THEN '(' + CAST(c.scale AS VARCHAR(5)) + ')'
                     WHEN tp.name = 'decimal' 
                       THEN '(' + CAST(c.[precision] AS VARCHAR(5)) + ',' + CAST(c.scale AS VARCHAR(5)) + ')'
                    ELSE ''
                END +
                CASE WHEN c.collation_name IS NOT NULL THEN ' COLLATE ' + c.collation_name ELSE '' END +
                CASE WHEN c.is_nullable = 1 THEN ' NULL' ELSE ' NOT NULL' END +
                CASE WHEN dc.[definition] IS NOT NULL THEN ' DEFAULT' + dc.[definition] ELSE '' END + 
                CASE WHEN ic.is_identity = 1 THEN ' IDENTITY(' + CAST(ISNULL(ic.seed_value, '0') AS CHAR(1)) + ',' + CAST(ISNULL(ic.increment_value, '1') AS CHAR(1)) + ')' ELSE '' END 
        END + CHAR(13)
    FROM tempdb.sys.columns c WITH (NOWAIT)
    JOIN tempdb.sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id
    LEFT JOIN tempdb.sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] AND c.column_id = cc.column_id
    LEFT JOIN tempdb.sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 AND c.[object_id] = dc.parent_object_id AND c.column_id = dc.parent_column_id
    LEFT JOIN tempdb.sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 AND c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id
    WHERE c.[object_id] = @object_id
    ORDER BY c.column_id
    FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, CHAR(9) + ' ')
    + ISNULL((SELECT CHAR(9) + ', CONSTRAINT [' + k.name + '] PRIMARY KEY (' + 
                    (SELECT STUFF((
                         SELECT ', [' + c.name + '] ' + CASE WHEN ic.is_descending_key = 1 THEN 'DESC' ELSE 'ASC' END
                         FROM tempdb.sys.index_columns ic WITH (NOWAIT)
                         JOIN tempdb.sys.columns c WITH (NOWAIT) ON c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id
                         WHERE ic.is_included_column = 0
                             AND ic.[object_id] = k.parent_object_id 
                             AND ic.index_id = k.unique_index_id     
                         FOR XML PATH(N''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, ''))
            + ')' + CHAR(13)
            FROM tempdb.sys.key_constraints k WITH (NOWAIT)
            WHERE k.parent_object_id = @object_id 
                AND k.[type] = 'PK'), '') + ')'  + CHAR(13)
    + ISNULL((SELECT (
        SELECT CHAR(13) +
             'ALTER TABLE ' + @object_name + ' WITH' 
            + CASE WHEN fk.is_not_trusted = 1 
                THEN ' NOCHECK' 
                ELSE ' CHECK' 
              END + 
              ' ADD CONSTRAINT [' + fk.name  + '] FOREIGN KEY(' 
              + STUFF((
                SELECT ', [' + k.cname + ']'
                FROM fk_columns k
                WHERE k.constraint_object_id = fk.[object_id]
                FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')
               + ')' +
              ' REFERENCES [' + SCHEMA_NAME(ro.[schema_id]) + '].[' + ro.name + '] ('
              + STUFF((
                SELECT ', [' + k.rcname + ']'
                FROM fk_columns k
                WHERE k.constraint_object_id = fk.[object_id]
                FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')
               + ')'
            + CASE 
                WHEN fk.delete_referential_action = 1 THEN ' ON DELETE CASCADE' 
                WHEN fk.delete_referential_action = 2 THEN ' ON DELETE SET NULL'
                WHEN fk.delete_referential_action = 3 THEN ' ON DELETE SET DEFAULT' 
                ELSE '' 
              END
            + CASE 
                WHEN fk.update_referential_action = 1 THEN ' ON UPDATE CASCADE'
                WHEN fk.update_referential_action = 2 THEN ' ON UPDATE SET NULL'
                WHEN fk.update_referential_action = 3 THEN ' ON UPDATE SET DEFAULT'  
                ELSE '' 
              END 
            + CHAR(13) + 'ALTER TABLE ' + @object_name + ' CHECK CONSTRAINT [' + fk.name  + ']' + CHAR(13)
        FROM tempdb.sys.foreign_keys fk WITH (NOWAIT)
        JOIN tempdb.sys.objects ro WITH (NOWAIT) ON ro.[object_id] = fk.referenced_object_id
        WHERE fk.parent_object_id = @object_id
        FOR XML PATH(N''), TYPE).value('.', 'NVARCHAR(MAX)')), '')
    + ISNULL(((SELECT
         CHAR(13) + 'CREATE' + CASE WHEN i.is_unique = 1 THEN ' UNIQUE' ELSE '' END 
                + ' NONCLUSTERED INDEX [' + i.name + '] ON ' + @object_name + ' (' +
                STUFF((
                SELECT ', [' + c.name + ']' + CASE WHEN c.is_descending_key = 1 THEN ' DESC' ELSE ' ASC' END
                FROM index_column c
                WHERE c.is_included_column = 0
                    AND c.index_id = i.index_id
                FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + ')'  
                + ISNULL(CHAR(13) + 'INCLUDE (' + 
                    STUFF((
                    SELECT ', [' + c.name + ']'
                    FROM index_column c
                    WHERE c.is_included_column = 1
                        AND c.index_id = i.index_id
                    FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + ')', '')  + CHAR(13)
        FROM tempdb.sys.indexes i WITH (NOWAIT)
        WHERE i.[object_id] = @object_id
            AND i.is_primary_key = 0
            AND i.[type] = 2
        FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)')
    ), '')

SELECT @SQL 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-10-28T22:17:03.860

[https://www.sqlservercentral.com/forums/topic/script-create-table-script-from-linked-server](https://www.sqlservercentral.com/forums/topic/script-create-table-script-from-linked-server)

对于 LinkedServers - 在 SQLServer 上 - 以下效果很好 -

选择 *

进入我的新表

FROM MyLinkedServer.DatabaseName.dbo.TargetTable

其中 1 = 0

--没有数据传输，但表被建立。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-12-21T18:36:57.687

我们可以让 SQL 通过导航来生成创建表脚本

将表编写为 > 创建到 > 新查询编辑器窗口

[![在此处输入图像描述](https://i.stack.imgur.com/DfpRE.png)](https://i.stack.imgur.com/DfpRE.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-01T18:02:46.707

最简单的方法是使用 SQL Management Studio 的内置功能。

右键单击数据库，转到任务、生成脚本，然后完成向导。您可以选择要编写脚本的对象，它会为您完成一切。

现在，如果您试图让自己的 OWN 脚本做同样的事情，那么您可能需要做很多工作......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-01T18:07:44.213

由于我们提供了您所要求的替代方案..

如果您在 .Net 中，您应该查看 Visual Studio 中的数据库发布向导。将表/数据脚本写入文本文件的简便方法。

[http://www.codeplex.com/sqlhost/Wiki/View.aspx?title=Database%20Publishing%20Wizard](http://www.codeplex.com/sqlhost/Wiki/View.aspx?title=Database%20Publishing%20Wizard)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-01T18:33:33.153

使用 SSMS，最简单的方法您也可以为其配置选项（例如排序规则、语法、删除...创建）

否则，SSMS 工具包或 CodePlex 上的 DbFriend 可以帮助您生成脚本

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-09-25T13:47:35.900

请参阅我在此问题中的答案：[如何在 SQL Server 中使用 SQL 查询生成表的创建脚本](https://stackoverflow.com/questions/4213687/how-to-generate-create-script-of-table-using-sql-query-in-sql-server/19006647#19006647)

使用此查询：

```
DROP FUNCTION [dbo].[Get_Table_Script]
Go

Create Function Get_Table_Script
(
    @vsTableName varchar(50)
)

Returns
    VarChar(Max)
With ENCRYPTION

Begin

Declare @ScriptCommand varchar(Max)

Select @ScriptCommand =
    ' Create Table [' + SO.name + '] (' + o.list + ')' 
    +
    (
        Case
        When TC.Constraint_Name IS NULL 
            Then ''
        Else 'ALTER TABLE ' + SO.Name + ' ADD CONSTRAINT ' +
            TC.Constraint_Name  + ' PRIMARY KEY ' + ' (' + LEFT(j.List, Len(j.List)-1) + ')'
        End
    )
From sysobjects As SO
    Cross Apply

    (
        Select 
            '  [' + column_name + '] ' + 
             data_type + 
             (
                Case data_type
                    When 'sql_variant' 
                        Then ''
                    When 'text' 
                        Then ''
                    When 'decimal' 
                        Then '(' + Cast( numeric_precision_radix As varchar ) + ', ' + Cast( numeric_scale As varchar ) + ') '
                    Else Coalesce( '(' + 
                                        Case 
                                            When character_maximum_length = -1 
                                                Then 'MAX'
                                            Else Cast( character_maximum_length As VarChar ) 
                                        End + ')' , ''
                                 ) 
                End 
            ) 
            + ' ' +
            (
                Case 
                    When Exists ( 
                                    Select id 
                                    From syscolumns
                                    Where 
                                        ( object_name(id) = SO.name )
                                        And 
                                        ( name = column_name )
                                        And 
                                        ( columnproperty(id,name,'IsIdentity') = 1 )
                                ) 
                        Then 'IDENTITY(' + 
                                Cast( ident_seed(SO.name) As varchar ) + ',' + 
                                Cast( ident_incr(SO.name) As varchar ) + ')'

                    Else ''

                End
            ) + ' ' +

            (
                Case 
                    When IS_NULLABLE = 'No' 
                        Then 'NOT ' 
                    Else '' 
                End 
            ) + 'NULL ' + 
            (
                Case 
                    When information_schema.columns.COLUMN_DEFAULT IS NOT NULL 
                        Then 'DEFAULT ' + information_schema.columns.COLUMN_DEFAULT 
                    ELse '' 
                End 
            ) + ', ' 
        From information_schema.columns 
        Where 
            ( table_name = SO.name )
        Order by ordinal_position
        FOR XML PATH('')) o (list)

        Inner Join information_schema.table_constraints As TC On (
                                                                    ( TC.Table_name = SO.Name )
                                                                    AND 
                                                                    ( TC.Constraint_Type  = 'PRIMARY KEY' )
                                                                    And 
                                                                    ( TC.TABLE_NAME = @vsTableName )
                                                                 )
        Cross Apply
            (
                Select '[' + Column_Name + '], '
                From  information_schema.key_column_usage As kcu
                Where 
                    ( kcu.Constraint_Name = TC.Constraint_Name )
                Order By ORDINAL_POSITION
                FOR XML PATH('')
            ) As j (list)
Where
    ( xtype = 'U' )
    AND 
    ( Name NOT IN ('dtproperties') )

Return @ScriptCommand

End 
```

你可以这样开火`Function`：

```
Select [dbo].Get_Table_Script '<Your_Table_Name>' 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-06-05T17:33:18.470

试试这个（使用“结果文本”）：

```
SELECT
ISNULL(smsp.definition, ssmsp.definition) AS [Definition]
FROM
sys.all_objects AS sp
LEFT OUTER JOIN sys.sql_modules AS smsp ON smsp.object_id = sp.object_id
LEFT OUTER JOIN sys.system_sql_modules AS ssmsp ON ssmsp.object_id = sp.object_id
WHERE
(sp.type = N'V' OR sp.type = N'P' OR sp.type = N'RF' OR sp.type=N'PC')and(sp.name=N'YourObjectName' and SCHEMA_NAME(sp.schema_id)=N'dbo') 
```

*   C：检查约束
*   D：默认约束
*   F：外键约束
*   L：日志
*   P：存储过程
*   PK：主键约束
*   RF：复制过滤器存储过程
*   S：系统表
*   TR：触发器
*   U：用户表
*   UQ：唯一约束
*   五：查看
*   X：扩展存储过程

干杯，

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-12-29T17:19:27.720

孤独的潜伏者，第一次的海报……

扩展@Devart 和@ildanny 解决方案...

我需要为数据库中的所有表运行它，并且还需要针对链接服务器执行代码。

所有表...

```
/*
Ex. 
EXEC etl.GetTableDefinitions '{friendlyname}', '{DatabaseName}', 'All', 0, NULL;
EXEC etl.GetTableDefinitions '{friendlyname}', '{DatabaseName}', 'dbo', 0, NULL;
EXEC etl.GetTableDefinitions '{friendlyname}', '{DatabaseName}', 'All', 1, '{linkedservername}';
*/
CREATE PROCEDURE etl.GetTableDefinitions
(
  @SystemName NVARCHAR(128)
, @DatabaseName NVARCHAR(128)
, @SchemaName NVARCHAR(128)
, @linkedserver BIT
, @linkedservername NVARCHAR(128)
)

AS

DECLARE @sql NVARCHAR(MAX) = N'';
DECLARE @sql1 NVARCHAR(MAX) = N'';
DECLARE @inSchemaName NVARCHAR(MAX) = N'';

SELECT @inSchemaName = CASE WHEN @SchemaName = N'All' THEN N's.[name]' ELSE '''' + @SchemaName + '''' END;

IF @linkedserver = 0
BEGIN

SELECT @sql = N'
SET NOCOUNT ON;

--- options ---
DECLARE @UseTransaction BIT = 0; 
DECLARE @GenerateUseDatabase BIT = 0;
DECLARE @GenerateFKs BIT = 0;
DECLARE @GenerateIdentity BIT = 1;
DECLARE @GenerateCollation BIT = 0;
DECLARE @GenerateCreateTable BIT = 1;
DECLARE @GenerateIndexes BIT = 0;
DECLARE @GenerateConstraints BIT = 1;
DECLARE @GenerateKeyConstraints BIT = 1;
DECLARE @GenerateConstraintNameOfDefaults BIT = 1;
DECLARE @GenerateDropIfItExists BIT = 0;
DECLARE @GenerateDropFKIfItExists BIT = 0;
DECLARE @GenerateDelete BIT = 0;
DECLARE @GenerateInsertInto BIT = 0;
DECLARE @GenerateIdentityInsert INT = 0; --0 ignore set,but add column; 1 generate; 2 ignore set AND column
DECLARE @GenerateSetNoCount INT = 0; --0 ignore set,1=set on, 2=set off 
DECLARE @GenerateMessages BIT = 0; --print with no wait
DECLARE @GenerateDataCompressionOptions BIT = 0; --TODO: generates the compression option only of the TABLE, not the indexes
                                                    --NB: the compression options reflects the design VALUE.
                                                    --The actual compression of a the page is saved here
--- variables ---
DECLARE @DataTypeSpacer INT = 1; --this is just to improve the formatting of the script ...
DECLARE @name SYSNAME;
DECLARE @sql NVARCHAR(MAX) = N'''';
DECLARE @int INT = 1;
DECLARE @maxint INT;
DECLARE @SourceDatabase NVARCHAR(MAX) = N''' + @DatabaseName + '''; --this is used by the INSERT 
DECLARE @TargetDatabase NVARCHAR(MAX) = N''' + @DatabaseName + '''; --this is used by the INSERT AND USE <DBName>
DECLARE @cr NVARCHAR(20) = NCHAR(13);
DECLARE @tab NVARCHAR(20) = NCHAR(9);

DECLARE @Tables TABLE
(
      id INT IDENTITY(1,1)
    , [name] SYSNAME
    , [object_id] INT 
    , [database_id] SMALLINT
);

BEGIN 

    INSERT INTO @Tables([name], [object_id], [database_id])
    SELECT s.[name] + N''.'' + t.[name] AS [name]
        , t.[object_id]
        , DB_ID(''' + @DatabaseName + ''') AS [database_id]
    FROM [' + @DatabaseName + '].sys.tables t
        JOIN [' + @DatabaseName + '].sys.schemas s ON t.[schema_id] = s.[schema_id]
    WHERE t.[name] NOT IN (''Tally'',''LOC_AND_SEG_CAP1'',''LOC_AND_SEG_CAP2'',''LOC_AND_SEG_CAP3'',''LOC_AND_SEG_CAP4'',''TableNames'')
        AND s.[name] = ' + @inSchemaName + '
    ORDER BY s.[name], t.[name];

    SELECT @maxint = COUNT(0) 
    FROM @Tables;

    WHILE @int <= @maxint
    BEGIN

        ;WITH 
        index_column AS 
        (
            SELECT ic.[object_id]
                , OBJECT_NAME(ic.[object_id], DB_ID(N''' + @DatabaseName + ''')) AS ObjectName
                , ic.index_id
                , ic.is_descending_key
                , ic.is_included_column
                , c.[name] 
            FROM [' + @DatabaseName + '].sys.index_columns ic WITH (NOLOCK)
                JOIN [' + @DatabaseName + '].sys.columns c WITH (NOLOCK) ON ic.[object_id] = c.[object_id] 
                    AND ic.column_id = c.column_id
                JOIN [' + @DatabaseName + '].sys.tables t ON c.[object_id] = t.[object_id]
        ) 
        , fk_columns AS 
        (
            SELECT k.constraint_object_id
                , cname = c.[name]
                , rcname = rc.[name]
            FROM [' + @DatabaseName + '].sys.foreign_key_columns k WITH (NOWAIT)
                JOIN [' + @DatabaseName + '].sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id 
                    AND rc.column_id = k.referenced_column_id 
                JOIN [' + @DatabaseName + '].sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id 
                    AND c.column_id = k.parent_column_id
                JOIN [' + @DatabaseName + '].sys.tables t ON c.[object_id] = t.[object_id]
            WHERE @GenerateFKs = 1
        )
        SELECT @sql = @sql +

            --------------------  USE DATABASE   --------------------------------------------------------------------------------------------------
                CAST(
                    CASE WHEN @GenerateUseDatabase = 1
                    THEN N''USE '' + @TargetDatabase + N'';'' + @cr
                    ELSE N'''' END 
                AS NVARCHAR(200))
                +
            --------------------  SET NOCOUNT   --------------------------------------------------------------------------------------------------
                CAST(
                    CASE @GenerateSetNoCount 
                    WHEN 1 THEN N''SET NOCOUNT ON;'' + @cr
                    WHEN 2 THEN N''SET NOCOUNT OFF;'' + @cr
                    ELSE N'''' END 
                AS NVARCHAR(MAX))
                +
            --------------------  USE TRANSACTION  --------------------------------------------------------------------------------------------------
                CAST(
                    CASE WHEN @UseTransaction = 1
                    THEN 
                        N''SET XACT_ABORT ON'' + @cr
                        + N''BEGIN TRY'' + @cr
                        + N''BEGIN TRAN'' + @cr
                    ELSE N'''' END 
                AS NVARCHAR(MAX))
                +
            --------------------  DROP SYNONYM   --------------------------------------------------------------------------------------------------
                CASE WHEN @GenerateDropIfItExists = 1
                THEN CAST(N''IF OBJECT_ID('''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''',''''SN'''') IS NOT NULL DROP SYNONYM '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'';'' + @cr AS NVARCHAR(MAX))
                ELSE CAST(N'''' AS NVARCHAR(MAX))   END 
                +
            --------------------  DROP TABLE IF EXISTS --------------------------------------------------------------------------------------------------
                CASE WHEN @GenerateDropIfItExists = 1
                THEN 
                    --Drop TABLE if EXISTS
                    CAST(N''IF OBJECT_ID('''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''',''''U'''') IS NOT NULL DROP TABLE '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'';'' + @cr AS NVARCHAR(MAX))
                    + @cr
                ELSE N'''' END 
                +
            --------------------  DROP CONSTRAINT IF EXISTS --------------------------------------------------------------------------------------------------
                CAST((CASE WHEN @GenerateMessages = 1 AND @GenerateDropFKIfItExists = 1 THEN 
                    N''RAISERROR(''''DROP CONSTRAINTS OF %s'''',10,1, '''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''') WITH NOWAIT;'' + @cr            
                ELSE N'''' END) AS NVARCHAR(MAX)) 
                +
                CASE WHEN @GenerateDropFKIfItExists = 1
                THEN 
                    --Drop foreign keys
                    ISNULL(((
                        SELECT 
                            CAST(
                                N''ALTER TABLE '' + QUOTENAME(s.[name]) + N''.'' + QUOTENAME(t.[name]) + N'' DROP CONSTRAINT '' + RTRIM(f.[name]) + N'';'' + @cr
                            AS NVARCHAR(MAX))
                        FROM [' + @DatabaseName + '].sys.tables t
                            INNER JOIN [' + @DatabaseName + '].sys.foreign_keys f ON f.parent_object_id = t.[object_id]
                            INNER JOIN [' + @DatabaseName + '].sys.schemas s ON s.[schema_id] = f.[schema_id]
                        WHERE f.referenced_object_id = t.[object_id]
                        FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''))
                    , N'''') + @cr
                ELSE N'''' END 
            +
            --------------------- CREATE TABLE -----------------------------------------------------------------------------------------------------------------
            CAST((CASE WHEN @GenerateMessages = 1 THEN 
                N''RAISERROR(''''CREATE TABLE %s'''',10,1, '''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''') WITH NOWAIT;'' + @cr           
            ELSE CAST(N'''' AS NVARCHAR(MAX)) END) AS NVARCHAR(MAX)) 
            +
            CASE WHEN @GenerateCreateTable = 1 THEN 
                CAST(
                    N''CREATE TABLE '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + @cr + N''('' + @cr + STUFF((
                    SELECT 
                        CAST(
                            @tab + N'','' + QUOTENAME(c.[name]) + N'' '' + ISNULL(REPLICATE('' '',@DataTypeSpacer - LEN(QUOTENAME(c.[name]))),'''') 
                            +  
                            CASE WHEN c.is_computed = 1
                                THEN N'' AS '' + cc.[definition] 
                                ELSE UPPER(tp.[name]) + 
                                    CASE WHEN tp.[name] IN (N''varchar'', N''char'', N''varbinary'', N''binary'', N''text'')
                                            THEN N''('' + CASE WHEN c.max_length = -1 THEN N''MAX'' ELSE CAST(c.max_length AS NVARCHAR(5)) END + N'')''
                                            WHEN tp.[name] IN (N''NVARCHAR'', N''nchar'', N''ntext'')
                                            THEN N''('' + CASE WHEN c.max_length = -1 THEN N''MAX'' ELSE CAST(c.max_length / 2 AS NVARCHAR(5)) END + N'')''
                                            WHEN tp.[name] IN (N''datetime2'', N''time2'', N''datetimeoffset'') 
                                            THEN N''('' + CAST(c.scale AS NVARCHAR(5)) + N'')''
                                            WHEN tp.[name] = N''decimal'' 
                                            THEN N''('' + CAST(c.[precision] AS NVARCHAR(5)) + N'','' + CAST(c.scale AS NVARCHAR(5)) + N'')''
                                        ELSE N''''
                                    END +
                                    CASE WHEN c.collation_name IS NOT NULL AND @GenerateCollation = 1 THEN N'' COLLATE '' + c.collation_name ELSE N'''' END +
                                    CASE WHEN c.is_nullable = 1 THEN N'' NULL'' ELSE N'' NOT NULL'' END +
                                    CASE WHEN dc.[definition] IS NOT NULL THEN CASE WHEN @GenerateConstraintNameOfDefaults = 1 THEN N'' CONSTRAINT '' + QUOTENAME(dc.[name]) ELSE N'''' END + N'' DEFAULT'' + dc.[definition] ELSE N'''' END + 
                                    CASE WHEN ic.is_identity = 1 AND @GenerateIdentity = 1 THEN N'' IDENTITY('' + CAST(ISNULL(ic.seed_value, N''0'') AS NCHAR(1)) + N'','' + CAST(ISNULL(ic.increment_value, N''1'') AS NCHAR(1)) + N'')'' ELSE N'''' END 
                            END + @cr
                        AS NVARCHAR(MAX)) 
                    FROM [' + @DatabaseName + '].sys.columns c WITH (NOWAIT)
                        INNER JOIN [' + @DatabaseName + '].sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id
                        LEFT JOIN [' + @DatabaseName + '].sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] 
                            AND c.column_id = cc.column_id
                        LEFT JOIN [' + @DatabaseName + '].sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 
                            AND c.[object_id] = dc.parent_object_id 
                            AND c.column_id = dc.parent_column_id
                        LEFT JOIN [' + @DatabaseName + '].sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 
                            AND c.[object_id] = ic.[object_id] 
                            AND c.column_id = ic.column_id
                    WHERE c.[object_id] = t.[object_id]
                    ORDER BY c.column_id
                    FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''), 1, 2, @tab + N'' '') AS NVARCHAR(MAX))
            ELSE CAST(N'''' AS NVARCHAR(MAX)) END 
            + 
            ---------------------- Key Constraints ----------------------------------------------------------------
            CAST(
                CASE WHEN @GenerateKeyConstraints <> 1 THEN N'''' 
                ELSE 
                    ISNULL((SELECT @tab + N'', CONSTRAINT '' + QUOTENAME(k.[name]) + N'' PRIMARY KEY '' + ISNULL(kidx.[type_desc], N'''') + N''('' + 
                                (SELECT STUFF((
                                    SELECT N'', '' + QUOTENAME(c.[name]) + N'' '' + CASE WHEN ic.is_descending_key = 1 THEN N''DESC'' ELSE N''ASC'' END
                                    FROM [' + @DatabaseName + '].sys.index_columns ic WITH (NOWAIT)
                                        JOIN [' + @DatabaseName + '].sys.columns c WITH (NOWAIT) ON c.[object_id] = ic.[object_id] 
                                            AND c.column_id = ic.column_id
                                    WHERE ic.is_included_column = 0
                                        AND ic.[object_id] = k.parent_object_id 
                                        AND ic.index_id = k.unique_index_id     
                                    FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''), 1, 2, N''''))
                        + N'')'' + @cr
                        FROM [' + @DatabaseName + '].sys.key_constraints k WITH (NOWAIT) 
                            LEFT JOIN [' + @DatabaseName + '].sys.indexes kidx ON k.parent_object_id = kidx.[object_id] 
                                AND k.unique_index_id = kidx.index_id
                        WHERE k.parent_object_id = t.[object_id] 
                            AND k.[type] = N''PK''), N'''') + N'')''  + @cr
                END 
            AS NVARCHAR(MAX))
            +
            CAST(
            CASE 
                WHEN @GenerateDataCompressionOptions = 1 AND (SELECT TOP 1 data_compression_desc FROM [' + @DatabaseName + '].sys.partitions WHERE OBJECT_ID = t.[object_id] AND index_id = 1) <> N''NONE''
                THEN N''WITH (DATA_COMPRESSION='' + (SELECT TOP 1 data_compression_desc FROM [' + @DatabaseName + '].sys.partitions WHERE OBJECT_ID = t.[object_id] AND index_id = 1) + N'')'' + @cr
                ELSE N'''' + @cr
            END AS NVARCHAR(MAX))
            + 
            --------------------- FOREIGN KEYS -----------------------------------------------------------------------------------------------------------------
            CAST((CASE WHEN @GenerateMessages = 1 AND @GenerateDropFKIfItExists = 1 THEN 
                N''RAISERROR(''''CREATING FK OF  %s'''',10,1, '''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''') WITH NOWAIT;'' + @cr            
            ELSE N'''' END) AS NVARCHAR(MAX)) 
            +
            CAST(
                ISNULL((SELECT (
                    SELECT @cr +
                    N''ALTER TABLE '' +  QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) +  N'' WITH'' 
                    + CASE WHEN fk.is_not_trusted = 1 
                        THEN N'' NOCHECK'' 
                        ELSE N'' CHECK'' 
                    END + 
                    N'' ADD CONSTRAINT '' + QUOTENAME(fk.[name])  + N'' FOREIGN KEY('' 
                    + STUFF((
                        SELECT N'', '' + QUOTENAME(k.cname) + N''''
                        FROM fk_columns k
                        WHERE k.constraint_object_id = fk.[object_id]
                            AND fk.[object_id] = t.[object_id]
                        FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''), 1, 2, N'''')
                    + N'')'' +
                    N'' REFERENCES '' + QUOTENAME(SCHEMA_NAME(ro.[schema_id])) + N''.'' + QUOTENAME(ro.[name]) + N'' (''
                    + STUFF((
                        SELECT N'', '' + QUOTENAME(k.rcname) + N''''
                        FROM fk_columns k
                        WHERE k.constraint_object_id = fk.[object_id]
                            AND fk.[object_id] = t.[object_id]
                        FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''), 1, 2, N'''')
                    + N'')''
                    + CASE 
                        WHEN fk.delete_referential_action = 1 THEN N'' ON DELETE CASCADE'' 
                        WHEN fk.delete_referential_action = 2 THEN N'' ON DELETE SET NULL''
                        WHEN fk.delete_referential_action = 3 THEN N'' ON DELETE SET DEFAULT'' 
                        ELSE N'''' 
                    END
                    + CASE 
                        WHEN fk.update_referential_action = 1 THEN N'' ON UPDATE CASCADE''
                        WHEN fk.update_referential_action = 2 THEN N'' ON UPDATE SET NULL''
                        WHEN fk.update_referential_action = 3 THEN N'' ON UPDATE SET DEFAULT''  
                        ELSE N'''' 
                    END 
                    + @cr + N''ALTER TABLE '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'' CHECK CONSTRAINT '' + QUOTENAME(fk.[name])  + N'''' + @cr
                FROM [' + @DatabaseName + '].sys.foreign_keys fk WITH (NOWAIT)
                    JOIN [' + @DatabaseName + '].sys.objects ro WITH (NOWAIT) ON ro.[object_id] = fk.referenced_object_id
                WHERE fk.parent_object_id = t.[object_id]
                FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)'')), N'''')
            AS NVARCHAR(MAX))
            + 
            --------------------- INDEXES ----------------------------------------------------------------------------------------------------------
            CAST((CASE WHEN @GenerateMessages = 1 AND @GenerateIndexes = 1 THEN 
                N''RAISERROR(''''CREATING INDEXES OF  %s'''',10,1, '''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''') WITH NOWAIT;'' + @cr           
            ELSE N'''' END) AS NVARCHAR(MAX)) 
            +
            CASE WHEN @GenerateIndexes = 1 THEN 
                CAST(
                    ISNULL(((SELECT
                        @cr + N''CREATE'' + CASE WHEN i.is_unique = 1 THEN N'' UNIQUE '' ELSE N'' '' END 
                                + i.[type_desc] + N'' INDEX '' + QUOTENAME(i.[name]) + N'' ON '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'' ('' +
                                STUFF((
                                SELECT N'', '' + QUOTENAME(c.[name]) + N'''' + CASE WHEN c.is_descending_key = 1 THEN N'' DESC'' ELSE N'' ASC'' END
                                FROM index_column c
                                WHERE c.is_included_column = 0
                                    AND c.[object_id] = t.[object_id]
                                    AND c.index_id = i.index_id
                                FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''), 1, 2, N'''') + N'')''  
                                + ISNULL(@cr + N''INCLUDE ('' + 
                                    STUFF((
                                    SELECT N'', '' + QUOTENAME(c.[name]) + N''''
                                    FROM index_column c
                                    WHERE c.is_included_column = 1
                                        AND c.[object_id] = t.[object_id]
                                        AND c.index_id = i.index_id
                                    FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)''), 1, 2, N'''') + N'')'', N'''')  + @cr
                        FROM [' + @DatabaseName + '].sys.indexes i WITH (NOWAIT)
                        WHERE i.[object_id] = t.[object_id]
                            AND i.is_primary_key = 0
                            AND i.[type] in (1,2)
                            AND @GenerateIndexes = 1
                        FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)'')
                    ), N'''')
                AS NVARCHAR(MAX))
            ELSE N'''' END 
            +
            ------------------------  @GenerateDelete     ----------------------------------------------------------
            CAST((CASE WHEN @GenerateMessages = 1 AND @GenerateDelete = 1 THEN 
                N''RAISERROR(''''TRUNCATING  %s'''',10,1, '''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''') WITH NOWAIT;'' + @cr            
            ELSE N'''' END) AS NVARCHAR(MAX)) 
            +
            CASE WHEN @GenerateDelete = 1 THEN
                CAST(
                    (CASE WHEN EXISTS (SELECT TOP 1 [name] FROM [' + @DatabaseName + '].sys.foreign_keys WHERE referenced_object_id = t.[object_id]) THEN 
                        N''DELETE FROM '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'';'' + @cr
                    ELSE
                        N''TRUNCATE TABLE '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'';'' + @cr
                    END)
                AS NVARCHAR(MAX))
            ELSE N'''' END 
            +
            ------------------------- @GenerateInsertInto ----------------------------------------------------------
            CAST((CASE WHEN @GenerateMessages = 1 AND @GenerateDropFKIfItExists = 1 THEN 
                N''RAISERROR(''''INSERTING INTO  %s'''',10,1, '''''' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'''''') WITH NOWAIT;'' + @cr            
            ELSE N'''' END) AS NVARCHAR(MAX)) 
            +
            CASE WHEN @GenerateInsertInto = 1
            THEN 
                CAST(
                        CASE WHEN EXISTS (SELECT TOP 1 c.[name] FROM [' + @DatabaseName + '].sys.columns c WHERE c.[object_id] = t.[object_id] AND c.is_identity = 1) AND @GenerateIdentityInsert = 1 THEN 
                            N''SET IDENTITY_INSERT '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'' ON;'' + @cr
                        ELSE N'''' END 
                        +
                        N''INSERT INTO '' + QUOTENAME(@TargetDatabase) + N''.'' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N''('' 
                        + @cr
                        +
                        (
                            @tab + N'' '' + SUBSTRING(
                                (
                                SELECT @tab + '',''+ QUOTENAME(c.[name]) + @cr 
                                FROM [' + @DatabaseName + '].sys.columns c 
                                WHERE c.[object_id] = t.[object_id] 
                                    AND c.system_type_ID <> 189 /*timestamp*/ 
                                    AND c.is_computed = 0
                                    AND (c.is_identity = 0 or @GenerateIdentityInsert in (0,1))
                                FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)'')
                            ,3,99999)

                        )
                        + N'')'' + @cr + N''SELECT '' 
                        + @cr
                        +
                        (
                            @tab + N'' '' + SUBSTRING(
                                (
                                SELECT @tab + '',''+ QUOTENAME(c.[name]) + @cr 
                                FROM [' + @DatabaseName + '].sys.columns c 
                                WHERE c.[object_id] = t.[object_id] 
                                    AND c.system_type_ID <> 189 /*timestamp*/ 
                                    AND c.is_computed = 0                     
                                    AND (c.is_identity = 0 or @GenerateIdentityInsert  in (0,1))
                                FOR XML PATH(N''''), TYPE).value(N''.'', N''NVARCHAR(MAX)'')
                            ,3,99999)
                        )
                        + N''FROM '' + @SourceDatabase +  N''.'' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id]))            
                        + N'';'' + @cr
                        + CASE WHEN EXISTS (SELECT TOP 1 c.[name] FROM [' + @DatabaseName + '].sys.columns c WHERE c.[object_id] = t.[object_id] AND c.is_identity = 1) AND @GenerateIdentityInsert = 1 THEN 
                            N''SET IDENTITY_INSERT '' + QUOTENAME(OBJECT_SCHEMA_NAME(t.[object_id], t.[database_id])) + N''.'' + QUOTENAME(OBJECT_NAME(t.[object_id], t.[database_id])) + N'' OFF;''+ @cr
                        ELSE N'''' END              
                AS NVARCHAR(MAX))
            ELSE N'''' END 
            +
            --------------------  USE TRANSACTION  --------------------------------------------------------------------------------------------------
            CAST(
                CASE WHEN @UseTransaction = 1
                THEN 
                    @cr + N''COMMIT TRAN; ''
                    + @cr + N''END TRY''
                    + @cr + N''BEGIN CATCH''
                    + @cr + N''  IF XACT_STATE() IN (-1,1)''
                    + @cr + N''      ROLLBACK TRAN;''
                    + @cr + N''''
                    + @cr + N''  SELECT   ERROR_NUMBER() AS ErrorNumber  ''
                    + @cr + N''          ,ERROR_SEVERITY() AS ErrorSeverity  ''
                    + @cr + N''          ,ERROR_STATE() AS ErrorState  ''
                    + @cr + N''          ,ERROR_PROCEDURE() AS ErrorProcedure  ''
                    + @cr + N''          ,ERROR_LINE() AS ErrorLine  ''
                    + @cr + N''          ,ERROR_MESSAGE() AS ErrorMessage; ''
                    + @cr + N''END CATCH''
                ELSE N'''' END 
            AS NVARCHAR(700))
        FROM @Tables t
        WHERE ID = @int
        ORDER BY [name]; 

        SET @int = @int + 1;

    END

    EXEC [master].dbo.PrintMax @sql;
/* see below for PrintMax code*/

END'

EXEC (@sql);

END
ELSE 
```

和链接服务器位...

```
BEGIN

SELECT @sql = N'EXECUTE (''
SET NOCOUNT ON;
BEGIN

... Same code but be sure to double up on your single quotes

END

... code for the printmax proc (not mine, @Ben B) because it may not exist at destination server

    DECLARE @CurrentEnd BIGINT; /* track the length of the next substring */
    DECLARE @offset TINYINT; /*tracks the amount of offset needed */
    DECLARE @String NVARCHAR(MAX);
    SET @String = REPLACE(REPLACE(@sql, CHAR(13) + CHAR(10), CHAR(10)), CHAR(13), CHAR(10))

    WHILE LEN(@String) > 1
    BEGIN
        IF CHARINDEX(CHAR(10), @String) BETWEEN 1 AND 4000
        BEGIN
            SET @CurrentEnd = CHARINDEX(CHAR(10), @String) -1
            SET @offset = 2
        END
        ELSE
        BEGIN
            SET @CurrentEnd = 4000
            SET @offset = 1
        END   
        PRINT SUBSTRING(@String, 1, @CurrentEnd) 
        SET @String = SUBSTRING(@String, @CurrentEnd + @offset, LEN(@String))   
    END

END'') AT [' + @linkedservername + ']';

EXEC (@sql);

END 
```

[奔B溶液](https://stackoverflow.com/questions/7850477/how-to-print-varcharmax-using-print-statement/10206672)

# java - Java中的无损JPEG旋转（90/180/270度）？

> ID：706665
> 
> 赞同：22
> 
> 时间：2009-04-01T17:51:25.297
> 
> 标签：java, algorithm, jpeg, rotation, lossless

是否有用于以 90 度为增量旋转 JPEG 文件而不会导致图像质量下降的 Java 库？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-01T17:52:11.753

我发现了这个： http: [//mediachest.sourceforge.net/mediautil/](http://mediachest.sourceforge.net/mediautil/)

API： http: [//mediachest.sourceforge.net/mediautil/javadocs/mediautil/image/jpeg/LLJTran.html](http://mediachest.sourceforge.net/mediautil/javadocs/mediautil/image/jpeg/LLJTran.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-03-08T20:24:46.110

基于 Henry 的回答，这里有一个如何使用[MediaUtil](http://mediachest.sourceforge.net/mediautil/)基于 EXIF 数据执行无损 JPEG 旋转的示例：

```
try {
    // Read image EXIF data
    LLJTran llj = new LLJTran(imageFile);
    llj.read(LLJTran.READ_INFO, true);
    AbstractImageInfo<?> imageInfo = llj.getImageInfo();
    if (!(imageInfo instanceof Exif))
        throw new Exception("Image has no EXIF data");

    // Determine the orientation
    Exif exif = (Exif) imageInfo;
    int orientation = 1;
    Entry orientationTag = exif.getTagValue(Exif.ORIENTATION, true);
    if (orientationTag != null)
        orientation = (Integer) orientationTag.getValue(0);

    // Determine required transform operation
    int operation = 0;
    if (orientation > 0
            && orientation < Exif.opToCorrectOrientation.length)
        operation = Exif.opToCorrectOrientation[orientation];
    if (operation == 0)
        throw new Exception("Image orientation is already correct");

    OutputStream output = null;
    try {   
        // Transform image
        llj.read(LLJTran.READ_ALL, true);
        llj.transform(operation, LLJTran.OPT_DEFAULTS
                | LLJTran.OPT_XFORM_ORIENTATION);

        // Overwrite original file
        output = new BufferedOutputStream(new FileOutputStream(imageFile));
        llj.save(output, LLJTran.OPT_WRITE_ALL);

    } finally {
        IOUtils.closeQuietly(output);
        llj.freeMemory();
    }

} catch (Exception e) {
    // Unable to rotate image based on EXIF data
    ...
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-03-10T05:43:39.730

关于 EXIF 数据不一定被正确处理的问题，因为 EXIF 数据在许多情况下是无关紧要的，这里的示例代码仅演示了 LLJTran 无损 JPEG 旋转功能（感谢 user113215）：

```
final File              SrcJPEG  = new File("my-input.jpg");
final File              DestJPEG = new File("my-output.jpg");
final FileInputStream   In       = new FileInputStream(SrcJPEG);

try {
    final LLJTran           LLJT = new LLJTran(In);

    LLJT.read(LLJTran.READ_ALL, true);
    LLJT.transform(LLJTran.ROT_90);

    final FileOutputStream  Out = new FileOutputStream(DestJPEG);

    try {
        LLJT.save(Out, LLJTran.OPT_WRITE_ALL);
    } finally {
        Out.close();
    }

} finally {
    In.close(); 
} 
```

如果你让输入和输出`File`对象引用同一个文件，你可以一遍又一遍地运行它，观察图像不会退化，无论它经过多少次迭代。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-12-30T00:38:47.333

特别是对于 Android，我发现了这个 fork：

[https://github.com/juanitobananas/AndroidMediaUtil](https://github.com/juanitobananas/AndroidMediaUtil)

优于上游的好处：

*   Gradle/Android Studio 项目
*   与 jitpack.io 兼容

它甚至可以在普通 Java 上使用，因为代码不会导入任何 Android 特定的包（虽然我没有尝试过）。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-04-01T18:49:31.553

这种事情不需要外部库，它都内置在 SE 中。最简单的是 Graphics2D 对象的 rotate() 函数。

例如：

```
 Image rotatedImage = new BufferedImage(imageToRotate.getHeight(null), imageToRotate.getWidth(null), BufferedImage.TYPE_INT_ARGB);

    Graphics2D g2d = (Graphics2D) rotatedImage.getGraphics();
    g2d.rotate(Math.toRadians(90.0));
    g2d.drawImage(imageToRotate, 0, -rotatedImage.getWidth(null), null);
    g2d.dispose(); 
```

没有损失！

或者，如果您想格外小心，只需使用 BufferedImage.getRGB(x,y)，并将其逐个像素地转换到新图像上。

# java - Java 的桌面库能否在新的浏览器选项卡或窗口中启动 URL？

> ID：706668
> 
> 赞同：3
> 
> 时间：2009-04-01T17:51:56.777
> 
> 标签：java, desktop, uri

我有一个静态方法用于启动具有给定 URL 的浏览器。当浏览器已经打开时，它将接管活动的浏览器窗口。

如果浏览器用于其他用途，例如数据输入，这将是一个问题。有没有办法在新的浏览器窗口（或选项卡）中打开 URL？

```
public static void openURL(String urlText)
{
    if (Desktop.isDesktopSupported())
    {
        URI uri = URI.create(urlText);
        try
        {
            Desktop.getDesktop().browse(uri);
        }
        catch (IOException e)
        {
            e.printStackTrace();
        }
    }
} 
```

或者，有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T20:39:02.773

看看[BrowserLaunch2](http://browserlaunch2.sourceforge.net/)。特别是[这种](http://browserlaunch2.sourceforge.net/docs.shtml#forcing_new_browser_win)强制打开新窗口的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:42:33.507

您可能需要在浏览器中进行配置，而不是在您的启动代码中。您可能能够找到一些启动标志来导致您想要的行为，但您将在此过程中将您的代码绑定到特定的浏览器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T08:20:41.900

您可以使用 Yose 方法来识别默认浏览器，然后使用以下命令：

firefox.exe -new-tab ie7 [http://blogs.msdn.com/tonyschr/archive/2007/01/19/ie-automation-amp-tabs.aspx](http://blogs.msdn.com/tonyschr/archive/2007/01/19/ie-automation-amp-tabs.aspx) 歌剧-newpage

请注意，某些浏览器不支持选项卡，或者没有命令行参数来在选项卡中打开 url。在这种情况下，您可以使用 AHK 脚本引擎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T18:40:09.470

在 Windows 下，有一种方法可以找到默认浏览器是什么。您将不得不使用命令

```
REG QUERY HKCR\.html /ve 
```

这将返回

```
! REG.EXE VERSION 3.0

HKEY_CLASSES_ROOT\.html
    <NO NAME>   REG_SZ  FirefoxHTML 
```

然后您将使用相同的命令查询 FirefoxHTML（或返回的任何值），并将以下内容附加到键

```
REG QUERY HKCR\FirefoxHTML\shell\open\command /ve 
```

这将返回

```
! REG.EXE VERSION 3.0

HKEY_CLASSES_ROOT\FirefoxHTML\shell\open\command
    <NO NAME>   REG_SZ  "C:\Program Files\Mozilla Firefox\firefox.exe" -requestPending -osint -url "%1" 
```

从这里，您可以解析返回的行以获取浏览器可执行文件的位置。

您可以使用 Java Runtime 类完成所有这些操作：

```
Runtime.getRuntime.exec(cmdString); 
```

这需要大量自定义编码，但您基本上可以创建自己的 API 来访问 Windows 下的默认浏览器。

[这是一个使用 Java 访问 Windows 注册表的示例。](http://www.rgagnon.com/javadetails/java-0480.html)

[您还可以在 Google 上搜索有关在注册表中查找默认浏览器的更多信息。](http://www.google.com/search?hl=en&q=windows+registry+default+browser&btnG=Search)

至于其他平台（Mac、Linux 等），我确信有一种特定的方法可以获取默认浏览器的路径。

希望这可以帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T22:18:11.397

听起来 java.awt.Desktop API 没有提供这种级别的功能。

这是我们在 2006 年找到的[java.net 论坛](http://forums.java.net/jive/thread.jspa?messageID=148747)的链接。

那里的回应提到了[JDIC 的 WebBrowser](https://jdic.dev.java.net/nonav/documentation/javadoc/jdic/org/jdesktop/jdic/browser/WebBrowser.html)。

# java - 确保方法被调用

> ID：706670
> 
> 赞同：4
> 
> 时间：2009-04-01T17:52:00.333
> 
> 标签：java, inheritance

我有这堂课：

```
public abstract class AbstractIncomingCall {

    /*
    class properties
    */

    public void changeStatus(/*some parameters*/){
        //store parameters in class properties
        isValid();
    }

    protected abstract boolean isValid();
} 
```

...由此类扩展：

```
public class IncomingCallImpl extends AbstractIncomingCall{

    //I override the parent's method
    public void changeStatus(/*same parameters as parent's method*/) {
        super.changeStatus(/*same parameters as parent's method*/);
        //do something interesting 
    }

    protected boolean isValid() throws StatusChangeNotOccurredException {
        //implement my validation algorithm
    } 
```

我想要实现的是确保每当调用 changeStatus(/*some parameters*/) 时都会调用 isValid() 方法；请注意，isValid() 方法仅在具体类中实现，它也使用从父类继承的类属性。有没有一种方法可以确保调用 isValid() 而不是调用 super ？我非常不喜欢我必须到处传递参数这一事实，我认为我完全走错了方向，并且有一种更简洁的方法可以实现这一点。我想在我的代码中保留抽象类中的“isValid() 调用逻辑”，因为每个调用都需要验证，我不能指望我将来记住这一点：P

提前致谢 ：]

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-01T17:55:54.723

听起来您希望 changeStatus() 遵循模板方法模式。在此模式中，您在抽象类中定义 changeStatus() （如果您不相信人们会正确扩展，则将其设为 final），并让它调用所需的方法：

```
public final void changeStatus()
{
    doSomethingSubclassSpecific();
    isValid()
}

protected abstract doSomethingSubclassSpecific(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T17:57:53.597

您不需要覆盖`changeStatus()`. 您非常接近实现[模板方法](http://en.wikipedia.org/wiki/Template_method_pattern)设计模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T18:00:54.963

您可以将 changeStatus 设为最终状态，并向其中添加对可能被覆盖的 customChangeStatus 方法的调用。如下所示：

公共抽象类 AbstractIncomingCall {

```
/*
class properties
*/

public final void changeStatus(/*some parameters*/){
    //store parameters in class properties
    isValid();
    customChangeStatus();
}

protected abstract void customChangeStatus();
protected abstract boolean isValid(); 
```

}

您甚至可以为 customChangeStatus 实现一个空方法，因此您不需要总是实现它。在 changeStatus 中使用 final 你确定这将是调用你的类时的逻辑。而且您仍然可以灵活地为其添加自定义行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T18:50:10.507

我建议使用组合而不是继承。事情应该变得更加明显。

# nhibernate - 强制 NHibernate 在插入之前级联删除

> ID：706673
> 
> 赞同：23
> 
> 时间：2009-04-01T17:52:52.360
> 
> 标签：nhibernate, nhibernate-mapping, nhibernate-cascade

我有一个与子对象具有一对多关系的父`ISet`对象。子对象具有唯一约束（`PageNum`和`ContentID`- 父对象的外键）。

```
<set name="Pages" inverse="true" cascade="all-delete-orphan" access="field.camelcase-underscore">
    <key column="ContentId" />
    <one-to-many class="DeveloperFusion.Domain.Entities.ContentPage, DeveloperFusion.Domain, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
</set> 
```

我遇到的问题是，如果我`ContentPage`从父集合中删除一个元素，然后在同一个事务中添加一个具有相同唯一键的新元素......你会得到一个唯一约束违规，因为[NHibernate](http://en.wikipedia.org/wiki/NHibernate)尝试*在*删除。

有没有办法强制 NHibernate 先执行删除？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-01T21:17:15.693

没有选项可以指定事务中的操作顺序，因为它被硬编码如下（来自文档）：

> SQL 语句按以下顺序发出
> 
> *   所有实体插入，以相同的顺序使用 ISession.Save() 保存相应的对象
> *   所有实体更新
> *   所有集合删除
> *   所有集合元素的删除、更新和插入
> *   所有集合插入
> *   所有实体删除，以相同的顺序使用 ISession.Delete() 删除相应的对象
> 
> （一个例外是使用原生 ID 生成的对象在保存时被插入。）

因此，我可以挑战您回答*为什么*要添加具有现有标识符的新实体吗？标识符应该对特定的“实体”是唯一的。如果该实体消失了，它的标识符也应该消失。

另一种选择是对该记录进行更新，而不是删除/插入。这使 ID 保持不变，因此不会违反唯一约束（至少在键上），并且您可以更改所有其他数据，使其成为“新”记录。

编辑：显然，当我回答时，我并没有完全注意这个问题，因为这是对非主键列的唯一约束的问题。

我认为您有两种解决方案可供选择：

1.  在您删除之后调用`Session.Flush()`，它将执行到该点为止对会话的所有更改，之后您可以继续进行其余操作（插入新对象）。这也适用于事务内部，因此您无需担心原子性。
2.  创建一个`ReplacePage`函数，用新数据更新现有实体，但保持主键和唯一列相同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T09:48:55.170

我遇到了同样的问题......我有一个实体，它有一个集合，该集合映射到一个包含唯一约束的表。

我不明白的是，根据 Stuarts 的回复，集合删除应该发生在集合插入之前？当我深入研究 NHibernate 源代码时，我找到了`CollectionUpdateAction`该类，该类在其`Execute`方法中包含以下代码：

```
persister.DeleteRows(collection, id, session);
persister.UpdateRows(collection, id, session);
persister.InsertRows(collection, id, session); 
```

然后，我会假设删除是在插入之前执行的，但显然情况并非如此。这个场景中没有使用 CollectionUpdateAction 吗？何时使用 CollectionUpdateAction？

### 回答：

我已经像这样解决了这个问题：

*   在我的映射中，我将级联选项设置为“delete-orphan”而不是“all-delete-orphan”
*   我所有的数据库访问都通过存储库进行；在我的存储库的保存方法中，我的实体有以下代码：

    ```
    public void Save( Order orderObj )
    {
        // Only starts a transaction when there is no transaction
        // associated yet with the session
       With.Transaction(session, delegate()
       {
           session.SaveOrUpdate (orderObj);
           session.Flush();

           foreach( OrderLine line in orderObj.Lines )
           {
                session.SaveOrUpdate (line);
           }
        };
     } 
    ```

因此，我保存了 orderObj，并且因为级联设置为 delete-orphan，要删除的对象将从数据库中删除。

调用后`SaveOrUpdate`，我必须确保将更改刷新到数据库。

由于 delete-orphan 级联设置确保没有插入或更新 OrderLine，我必须遍历我的集合，并为每个 OrderLine 调用“SaveOrUpdate”。这将确保插入新的 OrderLines，并更新修改过的 OrderLines。不会对未更改的 OrderLines 执行任何操作。

虽然它不是理想的解决方案（恕我直言，这是一个丑陋的黑客攻击），但它确实有效，并且它在存储库后面被抽象出来，所以这就是我现在处理这个问题的方式......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-03T13:35:15.880

如果您摆脱子主键（ContentPage.Id）并将复合键作为主键（即 PageNum 和 ContentID），那么我相信它可能会起作用。这是针对休眠中发生的相同问题提供的解决方案。

# wpf - ItemsSource + Converter + Treeview 不会更新

> ID：706680
> 
> 赞同：3
> 
> 时间：2009-04-01T17:56:48.560
> 
> 标签：wpf, converter, itemssource, inotifycollectionchanged

这个相当复杂，希望我能把这个说清楚，以便有人帮助我。我有一个对象，我们称之为经理，经理有一组他管理的人，这些人都实现了 IPerson，但不同类型的人有不同的属性。我想在树中显示这个经理，在经理节点下我想显示他正在管理的所有项目，这些项目可以从他管理的人中确定。

所以计划是使用转换器将人员转换为项目列表。这是 XAML：

```
<HierarchicalDataTemplate DataType="{x:Type ui:Manager}">
   <TextBlock Text="{Binding Path=Name}"/>
    <HierarchicalDataTemplate.ItemTemplate>
        <DataTemplate>
                    <TextBlock Text="{Binding}"/>
        </DataTemplate>
    </HierarchicalDataTemplate.ItemTemplate>
    <HierarchicalDataTemplate.ItemsSource>
        <Binding Path="People">
            <Binding.Converter>
                <configUtil:ProjectListConverter/>
            </Binding.Converter>
        </Binding>
    </HierarchicalDataTemplate.ItemsSource>
</HierarchicalDataTemplate> 
```

我的 Person 类实现了 INotifyPropertyChanged，而持有人员的列表实现了 INotifyCollectionChanged。当我设置树视图 ItemsSource 时，此代码效果很好，经理与他们的项目列表一起显示。

但是，当我将新人添加到人员列表时，TreeView 不会更新。当我调试时，我可以看到 CollectionChanged 正在使用 Add 操作和添加的项目触发。CollectionChanged 事件也不为空，所以我知道 UI 正在观看它。但是添加项目时转换器不会执行。

这是保存 IPerson 对象的 List 的 Add 方法：

```
public void Add(T item)
{
    list.Add(item);
    OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, item));
} 
```

我是否以某种方式破坏了数据绑定？

我还可以检查哪些其他内容？

转换器只是查看人员列表中的每个项目并确定他们正在处理的项目并将项目名称添加到输出列表中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T18:06:07.180

转换器应用于存储集合的属性。因此，只有在集合实例本身发生变化时才会调用它（而不是在集合中的项目发生变化时）。解决此问题的一种方法是在您希望它刷新时使集合无效。

使集合属性无效并导致转换器代码再次运行的最简单方法是`null`取出集合并重新分配它。另一种方法是获取[`BindingExpression`](http://msdn.microsoft.com/en-us/library/system.windows.data.bindingexpression.aspx)(via [`BindingOperations`](http://msdn.microsoft.com/en-us/library/system.windows.data.bindingoperations.aspx)) 并调用[`UpdateTarget`](http://msdn.microsoft.com/en-us/library/system.windows.data.bindingexpression.updatetarget.aspx). 最后，您可以改为绑定到一个[`CollectionView`](http://msdn.microsoft.com/en-us/library/system.windows.data.collectionview.aspx)（或其子类）并调用[`Refresh`](http://msdn.microsoft.com/en-us/library/system.windows.data.collectionview.refresh.aspx)它。

如果你*真的*想彻底解决问题，你可以绑定到你自己的实现，[`ICollectionView`](http://msdn.microsoft.com/en-us/library/system.componentmodel.icollectionview.aspx)它会根据需要进行过滤并引发事件。

# visual-studio - Windows 7 上的 VS2010 与 VS2008 SP1

> ID：706689
> 
> 赞同：1
> 
> 时间：2009-04-01T17:59:44.763
> 
> 标签：visual-studio, visual-studio-2010, windows-7

与 Windows 7 上的 VS2008 SP1 相比，Visual Studio 2010 的稳定性如何？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-01T18:01:05.087

到目前为止，VS2010 仅作为 VPC 中的早期 CTP（从去年 11 月开始）提供，因此这并不是一个真正相关的比较。是用来看的，不是用来用的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:01:18.503

我不能代表 Windows 7 上的 VS2010，但我一直在 Windows 7 上使用 VS2008sp1 作为我的主要开发机器，它运行良好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:01:50.653

考虑到我从来没有让 VS2008 在任何操作系统上崩溃，我说很难得到比这更好的。诚然，我可能没有完全完成它，但自从搬到 VS2008 以来，我在过去一年左右的时间里已经达到了广泛的能力

编辑：没关系，我只记得当一位前同事坚持使用 Source Safe 时它崩溃了，它运行了一个滞后的服务器，仅滞后就导致 VS2008 崩溃。

# asp.net - Asp.Net Gridview Buttonfield 获取行数据

> ID：706690
> 
> 赞同：5
> 
> 时间：2009-04-01T18:00:10.847
> 
> 标签：asp.net, gridview, buttonfield

我有一个绑定到我创建的数据表的 Gridview。表中的数据是不断变化的。

我在 Gridview 中添加了一个按钮域。单击时，我想通过链接或通过函数发送该行中的特定列值。

你怎么做呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T21:35:35.820

我发现了如何做到这一点。您将 commandName 属性设置为您想要在属性中调用它的任何内容。

然后，如果在设计视图中创建按钮后双击该按钮，它应该会在代码隐藏页面中弹出一个功能。然后，您可以通过执行以下操作来访问该行。

受保护的无效gvUsers_RowCommand（对象发送者，GridViewCommandEventArgs e）{

```
 int rowNum = int.Parse(e.CommandArgument.ToString()); 
```

}

从那里您可以使用行号来访问特定的列数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:56:47.933

这是来自 MSDN 的一个不错的示例：http: [//msdn.microsoft.com/en-us/library/bb907626.aspx](http://msdn.microsoft.com/en-us/library/bb907626.aspx)

# cocoa-touch - 从可可http get请求中提取数据

> ID：706691
> 
> 赞同：3
> 
> 时间：2009-04-01T18:00:41.063
> 
> 标签：cocoa-touch, http, nsurlrequest

我实现了以下代码：

```
NSURL *url = [ NSURL URLWithString:[ NSString stringWithFormat: @"http://www.google.com/search?q=%@", query ] ];
NSURLRequest *request = [ NSURLRequest requestWithURL: url ]; 
```

我想从我从上面的 url 收到的内容中提取正文。我尝试过：

```
NSData *data = [request HTTPBody]; 
```

*数据*变量不返回任何数据？我是否要以正确的方式从请求中提取数据？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T18:12:04.843

如果你只是想获取一个网页，你可以使用它。

```
NSURL *url = [ NSURL URLWithString: [ NSString stringWithFormat: @"http://www.google.com"] ]; 
NSString *test = [NSString stringWithContentsOfURL:url]; 
```

如果你真的想从 NSData 转换数据，你可以使用这个：

```
NSString *myString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:07:35.697

NSURLRequest 只是定义了一个请求——它自己不做任何事情。要实际发出请求，您需要将请求提供给[NSURLConnection](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html#//apple_ref/doc/uid/20001836-BAJEAIEE)。

此外，如[文档](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSURLRequest_Class/Reference/Reference.html#//apple_ref/occ/instm/NSURLRequest/HTTPBody)中所述，HTTPBody 是随请求发送的数据，而不是响应正文。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-29T14:47:08.547

www.eigo.co.uk 上有一篇文章准确地展示了如何执行请求并在字符串变量中获取响应，但您需要的代码块是......

```
NSString * strResult = [[NSString alloc] initWithData:oResponseData encoding:NSUTF8StringEncoding]; 
```

在这里查看文章[http://www.eigo.co.uk/iPhone-Submitting-HTTP-Requests.aspx](http://www.eigo.co.uk/iPhone-Submitting-HTTP-Requests.aspx)

# wpf - 从外部文件或程序集加载 WPF 样式或其他静态资源

> ID：706700
> 
> 赞同：67
> 
> 时间：2009-04-01T18:02:37.050
> 
> 标签：wpf, xaml, assemblies, styles, resourcedictionary

我有几个 WPF 应用程序，我希望我的所有样式都在一个共享程序集中，而不是在每个应用程序中单独声明它们。

我正在寻找一种方法，这样我就不必更改`Style="{StaticResource BlahBlah}"`现有应用程序中的所有内容；我只想添加对这个样式程序集的引用，并从当前应用程序中删除它，所以它是从程序集中获取的。

有什么办法吗？

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-04-01T19:10:39.880

引用外部 ResourceDictionary（XAML 文件）：

```
<Application.Resources>
    <ResourceDictionary Source="MyResources.xaml" />
</Application.Resources> 
```

引用外部资源字典 (DLL)：

```
<Application.Resources>
    <ResourceDictionary Source="/MyExternalAssembly;component/MyResources.xaml" />
</Application.Resources> 
```

# real-time - 实时系统概念验证项目

> ID：706706
> 
> 赞同：0
> 
> 时间：2009-04-01T18:03:40.963
> 
> 标签：real-time

我正在学习关于实时系统设计的入门课程（3 个月），但任何实施。

我想构建一些东西，让我更好地理解我将在理论上学到的东西，但由于我从未做过任何实时系统，我无法估计任何项目需要多长时间。考虑到我可用的时间和知识，这将是一个概念验证项目，或类似的项目。

拜托，你能给我一些想法吗？先感谢您。

我用 TSQL、Delphi 和 C# 编程，但学习另一种语言不会有任何问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T01:57:43.267

建议您考虑探索[Java 的实时规范 (RTSJ)](http://rtsj.org)。虽然它不是构建实时软件的传统环境，但它是一种备受关注的新兴技术。更好的是，您可以见证一些关于实时系统中什么重要、什么不重要的持续辩论。

Sun 的[JavaRTS](http://java.sun.com/javase/technologies/realtime/index.jsp)可以免费下载，并且有一些有趣的演示可用于展示确定性行为，并展示他们的 RT 垃圾收集器。

对于一个具体的项目，我建议你从简单的开始：1）构建一个工作生成器，你可以调整它以消耗给定的 CPU 时间；2) 将其放入一个框架中，该框架可以生成工作生成器任务的分布（作为线程，或作为在线程中执行的工作块）和记录所产生工作的机制；3) 制作这些任务的执行时间、停留时间、截止日期、松弛/超限与其优先级的图表；4）证明在实时线程（副分时）上下文中运行的任务表现不同。

如果您可以通过确定提供的负载（工作生成器任务产生的总 CPU 时间除以挂钟时间）来衡量调度程序中的开销，那么您的任务开始错过最后期限，则可以加分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:12:01.533

尝试考虑时间紧迫的实时任务，例如视频播放，如果任务没有及时完成（例如计算下一帧），它就会失败。

您也可以考虑一些工业解决方案，但在您当地的环境中可能更难研究它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T02:12:25.367

您绝对应该考虑使用配备小型处理器（ARM、PIC、AVR，任何人都可以）的硬件开发板来构建您的系统。当我开始开发时，这确实有助于消除我对低级的恐惧。不过，您必须使用 C 或 C++。

然后，您将有两种选择：要么使用裸机，要么使用实时操作系统。

使用裸机，您可以学习：

*   如何从头开始初始化处理器，最重要的是如何使用中断，这是响应外部事件的最快方式
*   如何实现具有快速上下文切换的轻量级线程，这是每个实时操作系统都实现的
*   为了稍微简化这一点，请寻找带有大量文档和源代码的开发工具包。我使用了 Embedded Artists ARM 板，它们为您提供了很多材料。

与 RT 操作系统一起使用：

*   您将快速跟踪您的项目，并能够学习如何微调 RT 操作系统
*   您可以尝试使用开源操作系统，例如 Linux 或 BSD，并从源代码中学到很多东西

任何一个选择都是好的，你会得到一个非常酷的动手项目来炫耀，并希望能更好地理解你的课程材料。祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-04T00:16:15.693

由于大多数实时系统仍然使用 C 或 C++ 实现，因此复习这些编程语言的知识可能会很好。[许多实时系统也是嵌入式系统，因此您可能想要使用像 BeagleBoard（ http://beagleboard.org/](http://beagleboard.org/) ）这样的廉价开源系统。这也将使您有机会了解交叉编译等。

# c# - 生产/开发中的 ASP.Net 问题

> ID：706710
> 
> 赞同：0
> 
> 时间：2009-04-01T18:04:09.917
> 
> 标签：c#, asp.net

我面临一个奇怪的问题，每当我评论第二个**if**条件时，它在生产中工作，但在开发中失败。

而且，当我不评论代码条件时，它适用于开发而无法用于生产。

```
 protected void Page_Load(object sender, EventArgs e)
        {
            if (!Page.IsPostBack)
            {
                lblDocument.Text = "Document :" + this.Request.QueryString["A_No"].ToString();
                //if (!frmViewer.Action.Contains("?"))
                //{
                //    frmViewer.Action = String.Format("{0}?A_No={1}&A_Format={2}",
                //                                     frmViewer.Action,
                                                     //this.Request.QueryString["A_No"].ToString(),
//                                                     //this.Request.QueryString["A_Format"].ToString());
//                }
            }
        } 
```

这是错误消息：

**CS0117：“System.Web.UI.HtmlControls.HtmlForm”不包含“操作”的定义**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:17:03.020

您是否确认您的 ASPX 文件已通过最新更改迁移到生产环境？

在我看来，Action 控件是在开发中添加的，并且 DLL 文件已迁移到生产环境，但不是相应的 ASPX 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T18:37:47.307

[报告此问题](http://fader.co.uk/post/Action-is-not-a-member-of-SystemWebUIHtmlControlsHtmlForm.aspx)的其他人已经下载了 .NET 3.5 SP1 更新，这解决了他们的问题。

确保生产和开发都运行最新版本的 .NET Framework（当前是上面列出的版本）。

此外，请确保您“清理”您的解决方案，然后重新构建它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T19:17:17.883

# database - 数据库和 Web 服务调用之间的速度差异是什么？

> ID：706712
> 
> 赞同：9
> 
> 时间：2009-04-01T18:04:26.780
> 
> 标签：database, web-services, language-agnostic, optimization

在所有条件相同的情况下，以最简单的形式，哪个更快？
1.) 对 Web 服务方法
的调用 2.) 对数据库的调用

例如，假设您有一个简单的 Web 服务，它只返回一个以 X 时间计算的整数。您还有一个数据库，当以正确的方式查询时，也需要 X 时间来计算答案。（因此两种情况下的**计算时间相同**）在这两种情况下，为简单起见，假设两个方向的数据量相同，例如，单个 32 位整数。

到目前为止，Web 服务和数据库的计算时间完全相同。

环境是 1 台应用程序服务器（应用程序所在的位置）和 1 台同时保存 Web 服务和数据库的服务器。除了重复调用 Web 服务或数据库的应用程序之外，环境中没有其他任何事情发生。**这一切都在一个 LAN**中，因此任何网络延迟都是相等的。

从应用程序调用数据库或调用 Web 服务哪个更快？

我想，我想隔离的是哪个更重。数据库连接的建立、打开、关闭、拆除最终是否比 Web 服务慢，还是一样？此外，如果还有其他事情，例如从 Web 服务解析结果，它们如何影响速度？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-01T18:16:24.253

O(1) 不是指任何时间长度。单个操作在 Web 服务上可能需要 0.001 毫秒，在数据库中需要 100 秒，它们都可能使用 O(1) 函数： [http ://en.wikipedia.org/wiki/Big_O_notation](http://en.wikipedia.org/wiki/Big_O_notation)

很难知道你在问什么。如果您询问访问本地数据库是否通常比通过 Internet 访问类似服务更快，那么我预计，通常，答案是本地数据库会更快。通过 Internet 调用 Web 服务有很多开销，并且通过 Internet 进行的通信相对较慢。Evan 在一台速度较慢的计算机上，数据库每秒可以执行数千个简单查询。相比之下，通过 Internet 访问，您可以幸运地每秒获得 50 个往返请求，甚至不考虑在服务器上执行请求的操作所花费的时间。

如果您要问网络上的服务器是否可以通过避免使用数据库并直接计算结果来更快地提供数据，那么答案取决于它。如果可以在独立函数中轻松计算其中的数据，则在这种情况下对数据库的调用会增加不必要的开销。这个问题的答案与“网络服务”没有任何关系。在函数中计算答案或使用数据库查询访问答案是否更快？正如我所说，答案将取决于您必须使用的特定函数的复杂性，并权衡其计算时间与直接从数据库访问答案（或部分答案）的开销。

简而言之，您的问题的答案取决于您到底要问什么。*了解您为什么*要问这个问题也可能会有所帮助。我怀疑真正的答案是这可能不是您需要担心的事情，除非您有需要优化的特定情况，否则这不是一个真正的实际问题。

如果您担心 web 服务和数据库都在一个局域网上时的速度比较，我很确定 db 的开销小于 web 服务。应用程序通常维护到数据库的有状态连接，而对 Web 服务的请求是通过 http 进行的，它是无状态的，开销相对较高且速度较慢。不过可能是错的。最好的答案是创建一个简单的 Web 服务、查询，并 (1) 测量使用这两种方法检索结果所需的时间，并进行比较，和/或 (2) 创建一个打开大量线程并执行一些负载的应用程序测试。

一个警告：如果您的应用程序没有保持打开的连接或无法访问与 db 的连接池，那么 db 替代方案可能会更慢。数据库连接的初始创建可能相对较慢。但这不应该考虑在内，因为您应该编写应用程序以便始终保持打开的连接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:10:00.353

根据实际经验，我会说数据库调用要快得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T18:08:03.043

这完全取决于您使用的网络拓扑和语言。如果您在谈论 C#...我的钱将花在几乎每次都更快的数据库调用上。

您对数据库服务器的调用将通过本机协议进行。一切都会被优化。

如果您正在调用 Web 服务，您将需要一些机制将请求发送到 Web 服务器，等待 Web 服务器响应，然后将 Web 服务调用的结果解析回您的代码.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T18:08:47.407

可以说，一般来说，网络服务（通常通过互联网）中的网络延迟将比对数据库的调用（通常在 LAN 或其他东西上，这比一个人的连接更快）要慢到互联网）。

当然，这对设置/软件/等做出了很多假设，这有效地将其简化为苹果和橘子的比较，这从来没有一个好的答案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T18:11:21.677

算法复杂度只是影响系统整体性能的一个变量。其他因素可能包括网络延迟或网络带宽，尤其是当返回数据的大小不同时。

如果您在本地机器上运行相同的 O(1) 算法，您将比在另一个大陆的机器上运行算法并需要通过网络发送相同的结果更快地获得结果。

如果调用是在物理上不同的机器上完成的，其他因素可能包括原始 CPU 速度。

这就是为什么过早的优化是万恶之源。

编辑：

我想说它现在更多地取决于系统的细节，即您正在使用什么数据库软件，或者您的 Web 服务是从静态网页读取数据还是动态生成数据。

但我开始忘记你为什么要问这个问题。您似乎说这两种方法都需要相同的时间。所以如果他们花费相同的时间，你怎么能问哪个更快？显然它们同样快。您需要告诉我们更多关于他们如何以及何时停止花费相同时间的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-01T18:33:12.357

O(1) 没有指定速度，它指定了随着基础数据变大所需的“增长”时间。常数从等式中删除。这意味着对于一些非常小的 N，O(N^2) 可以小于 O(N)。

Web 服务是连接某些功能的一种方式。除了网络延迟之外，实时时间还受服务实际执行的限制。例如，下面可能有一个数据库。如果是只返回一个整数的东西，计算时间大多是微不足道的，请求是受网络限制的。

数据库需要解析查询，构建查询树，优化它，然后针对一系列缓存和文件应用一些搜索算法。如果您只是将 Integer 放入普通表或无表 SQL 调用中，那么获取数据可能是微不足道的，它会占用 CPU 的整个事务包装。

在解析琐碎的 SQL 并返回表格结果之前，您能否将数据包来回传送到服务器？大多数情况下，这些天我说这是一个折腾。有些网络比其他网络更快，而有些数据库和服务器则相当不错。没有什么是确定的。

一般来说，Web 服务比数据库快吗？是的，当且仅当服务是微不足道的（如果它隐藏了数据库，那么显然只是额外的时间）。数据库是庞大的引擎，虽然这些年来它们的速度越来越快，但它们的事务完整性基本级别指定了非常多的最低 CPU 使用率。他们的速度较慢，因为他们正在做更多的工作。与隐藏在网络访问后面的一些显式最小计算进行对比。光纤或千兆网络可以快速移动数据。要完成的工作要少得多。

当然，我们不使用自定义编写的 Web 服务替换数据库的原因是时间。写它需要很长时间，然后保持更新。比仅仅将其放入数据库并接受其性能要付出更多的努力。

保罗。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-01T18:33:46.740

恕我直言，我会说数据库调用会更快。我这样说是因为开销要少得多。由于 HTTP 协议和 SOAP 标记的冗长导致您的数据变得更加臃肿。这种膨胀的数据需要额外的打包和解包成本。通过存储过程调用，您可以使用输出参数来返回单个 int 而不是结果集，以使其更轻。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-01T18:07:41.623

如果我们假设您正在与不同的服务器进行 Web 和数据库调用通信，它们会不会几乎相同，因为这两个请求都是通过 TCP/IP 传输的？那么唯一可以比较的是实际结果有多大，以通过网络发送的比特数表示。

# tsql - 如何在以下过程中使用 ROW_NUMBER？

> ID：706720
> 
> 赞同：6
> 
> 时间：2009-04-01T18:06:51.203
> 
> 标签：tsql

我有以下存储过程，它按降序返回`A`,和 count 。`B`我正在尝试使用`ROW_NUMBER`，所以我可以对记录进行分页，但我希望第一行号`1`是计数最高的记录，所以基本上，如果我返回一个包含 3 条记录的表并且计数为`30`, `20`, `10`, 那么行号`1`应该和count对应`30`，row number`2`应该和count对应， `20`row number`3`应该和count对应`10`。 `dbo.f_GetCount`是一个返回计数的函数。

```
create procedure dbo.Test
as
@A nvarchar(300) = NULL,
@B nvarchar(10) = NULL
as

select @A = nullif(@A,'')
      ,@B = nullif(@B,'');

select h.A
      ,hrl.B
      ,dbo.f_GetCount(hrl.A,h.B) as cnt
from dbo.hrl
    inner join dbo.h
        on h.C = hrl.C
where(@A is null
      or h.A like '%'+@A+'%'
     )
     and (@B is null
          or hrl.B = @B
         )
group by hrl.B
        ,h.A
order by cnt desc; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T18:14:46.927

```
WITH q AS
        (
        SELECT h.A, hrl.B,
              dbo.f_GetCount(hrl.A,h.B) as cnt
        FROM dbo.hrl
        INNER JOIN dbo.h on h.C = hrl.C
        WHERE (@A IS NULL OR h.A like '%' + @A + '%') 
          AND (@B IS NULL OR hrl.B = @B)
        GROUP BY hrl.B, h.A
        )
SELECT  q.*, ROW_NUMBER() OVER (ORDER BY cnt DESC) AS rn
FROM    q
ORDER BY rn DESC 
```

要检索第一`10`行，请使用：

```
WITH q AS
        (
        SELECT h.A, hrl.B,
              dbo.f_GetCount(hrl.A,h.B) as cnt
        FROM dbo.hrl
        INNER JOIN dbo.h on h.C = hrl.C
        WHERE (@A IS NULL OR h.A like '%' + @A + '%') 
          AND (@B IS NULL OR hrl.B = @B)
        GROUP BY hrl.B, h.A
        )
SELECT  TOP 10 q.*, 
        ROW_NUMBER() OVER (ORDER BY cnt DESC, A, B) AS rn
FROM    q
ORDER BY cnt DESC, A, B 
```

要检索 和 之间的行`11`，请`20`使用：

```
SELECT  *
FROM    (
        WITH q AS
                (
                SELECT h.A, hrl.B,
                      dbo.f_GetCount(hrl.A,h.B) as cnt
                FROM dbo.hrl
                INNER JOIN dbo.h on h.C = hrl.C
                WHERE (@A IS NULL OR h.A like '%' + @A + '%') 
                  AND (@B IS NULL OR hrl.B = @B)
                GROUP BY hrl.B, h.A
                )
        SELECT  q.*, 
                ROW_NUMBER() OVER (ORDER BY cnt DESC, A, B) AS rn
        FROM    q
        ) qq
WHERE rn BETWEEN 11 AND 20
ORDER BY cnt DESC, A, B 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:15:06.723

我将使用子查询将函数的值获取到结果中，然后使用 ROW_NUMBER 排名函数，如下所示：

```
select
    ROW_NUMBER() over (order by t.cnt desc) as RowId, t.*
from
    (
        SELECT
            h.A, hrl.B, dbo.f_GetCount(hrl.A,h.B) as cnt
        FROM
            dbo.hrl
                INNER JOIN dbo.h on h.C = hrl.C
        WHERE 
            (@A IS NULL OR h.A like '%' + @A + '%') AND 
            (@B IS NULL OR hrl.B = @B)
        GROUP BY
            hrl.B, h.A
    ) as t
order by
    1 
```

如果您只想要结果的某个部分（例如，用于分页），那么您将需要另一个子查询，然后过滤行号：

```
select
    t.*
from
    (
        select
            ROW_NUMBER() over (order by t.cnt desc) as RowId, t.*
        from
            (
                SELECT
                    h.A, hrl.B, dbo.f_GetCount(hrl.A,h.B) as cnt
                FROM
                    dbo.hrl
                        INNER JOIN dbo.h on h.C = hrl.C
                WHERE 
                    (@A IS NULL OR h.A like '%' + @A + '%') AND 
                    (@B IS NULL OR hrl.B = @B)
                GROUP BY
                    hrl.B, h.A
            ) as t
    ) as t
where
    t.RowId between 1 and 10
order by
    t.RowId 
```

请注意，在此查询中，您可以将 ROW_NUMBER 放在选择列表中的任何位置，因为您不再依赖于对 order by 语句使用“order by 1”语法。

多次调用此查询时，这里有一个微妙的问题。如果每个组中的项目数不唯一，则不能保证返回记录的顺序是一致的。为了解决这个问题，您必须更改 ROW_NUMBER 函数以对构成计数中的组的字段进行排序。

在这种情况下，它将是 A 和 B，导致：

```
select
    t.*
from
    (
        select
            ROW_NUMBER() over (order by t.cnt desc, t.A, t.B) as RowId, t.*
        from
            (
                SELECT
                    h.A, hrl.B, dbo.f_GetCount(hrl.A,h.B) as cnt
                FROM
                    dbo.hrl
                        INNER JOIN dbo.h on h.C = hrl.C
                WHERE 
                    (@A IS NULL OR h.A like '%' + @A + '%') AND 
                    (@B IS NULL OR hrl.B = @B)
                GROUP BY
                    hrl.B, h.A
            ) as t
    ) as t
where
    t.RowId between 1 and 10
order by
    t.RowId 
```

当组之间的项目计数不唯一（假设相同的数据集）时，这最终会在调用之间一致地对结果进行排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T18:13:57.287

```
SELECT h.A, hrl.B,
       dbo.f_GetCount(hrl.A,h.B) as cnt,
ROW_NUMBER() over (order by cnt desc) as row_num
FROM dbo.hrl
INNER JOIN dbo.h on h.C = hrl.C
WHERE (@A IS NULL OR h.A like '%' + @A + '%') 
  AND (@B IS NULL OR hrl.B = @B)
GROUP BY hrl.B, h.A
ORDER BY cnt desc 
```

这应该可以解决问题。我面前没有要测试的 SSMS，但是您可能必须将 ROW_NUMBER 的 order by 子句中的“cnt”的使用替换为对函数的第二次调用，但这应该会给您一个大致的想法。

# python - 如何在 Python 中将方法作为参数传递

> ID：706721
> 
> 赞同：232
> 
> 时间：2009-04-01T18:06:53.997
> 
> 标签：python, parameter-passing

是否可以将方法作为参数传递给方法？

```
self.method2(self.method1)

def method1(self):
    return 'hello world'

def method2(self, methodToRun):
    result = methodToRun.call()
    return result 
```

* * *

## 回答 #1

> 赞同：309
> 
> 时间：2009-04-01T18:09:03.977

是的，只需使用您所写的方法名称即可。方法和函数是 Python 中的对象，就像其他任何东西一样，您可以像处理变量一样传递它们。实际上，您可以将方法（或函数）视为一个变量，其值是实际的可调用代码对象。

由于您询问了方法，因此我在以下示例中使用了方法，但请注意，以下所有内容都同样适用于函数（除了没有`self`参数）。

要调用传递的方法或函数，您只需使用它绑定的名称，就像使用方法（或函数）的常规名称一样：

```
def method1(self):
    return 'hello world'

def method2(self, methodToRun):
    result = methodToRun()
    return result

obj.method2(obj.method1) 
```

注意：我相信`__call__()`确实存在一种方法，即您在技术上*可以*`methodToRun.__call__()`这样做，但您可能永远不应该明确这样做。`__call__()`旨在实现，而不是从您自己的代码中调用。

如果你想`method1`用参数调用，那么事情会变得有点复杂。`method2`必须写一些关于如何将参数传递给的信息`method1`，并且它需要从某个地方获取这些参数的值。例如，如果`method1`应该采用一个参数：

```
def method1(self, spam):
    return 'hello ' + str(spam) 
```

然后你可以`method2`用一个传入的参数来调用它：

```
def method2(self, methodToRun, spam_value):
    return methodToRun(spam_value) 
```

或带有它自己计算的参数：

```
def method2(self, methodToRun):
    spam_value = compute_some_value()
    return methodToRun(spam_value) 
```

您可以将其扩展为传入的值和计算的值的其他组合，例如

```
def method1(self, spam, ham):
    return 'hello ' + str(spam) + ' and ' + str(ham)

def method2(self, methodToRun, ham_value):
    spam_value = compute_some_value()
    return methodToRun(spam_value, ham_value) 
```

甚至使用关键字参数

```
def method2(self, methodToRun, ham_value):
    spam_value = compute_some_value()
    return methodToRun(spam_value, ham=ham_value) 
```

如果你不知道，在写的时候`method2`，要带什么参数`methodToRun`，你也可以使用参数解包，以一种通用的方式调用它：

```
def method1(self, spam, ham):
    return 'hello ' + str(spam) + ' and ' + str(ham)

def method2(self, methodToRun, positional_arguments, keyword_arguments):
    return methodToRun(*positional_arguments, **keyword_arguments)

obj.method2(obj.method1, ['spam'], {'ham': 'ham'}) 
```

在这种情况下`positional_arguments`需要是一个列表或元组或类似的，并且`keyword_arguments`是一个字典或类似的。在调用之前，`method2`您可以修改`positional_arguments`and `keyword_arguments`（例如添加或删除某些参数或更改值）`method1`。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-01T18:11:42.707

是的，有可能。只需调用它：

```
class Foo(object):
    def method1(self):
        pass
    def method2(self, method):
        return method()

foo = Foo()
foo.method2(foo.method1) 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-01T18:13:07.820

这是您重新编写的示例以显示一个独立的工作示例：

```
class Test:
    def method1(self):
        return 'hello world'

    def method2(self, methodToRun):
        result = methodToRun()
        return result

    def method3(self):
        return self.method2(self.method1)

test = Test()

print test.method3() 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2019-06-12T00:39:48.407

使用一个`lambda`函数。
因此，如果您没有论据，事情就会变得非常琐碎：

```
def method1():
    return 'hello world'

def method2(methodToRun):
    result = methodToRun()
    return result

method2(method1) 
```

但是假设你有一个（或多个）参数`method1`：

```
def method1(param):
    return 'hello ' + str(param)

def method2(methodToRun):
    result = methodToRun()
    return result 
```

然后你可以简单地调用`method2`as `method2(lambda: method1('world'))`。

```
method2(lambda: method1('world'))
>>> hello world
method2(lambda: method1('reader'))
>>> hello reader 
```

我发现这比这里提到的其他答案要干净得多。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2018-06-13T17:12:17.613

如果您想将类的方法作为参数传递，但还没有要调用它的对象，则可以在将对象作为第一个参数（即“自我”争论）。

```
class FooBar:

    def __init__(self, prefix):
        self.prefix = prefix

    def foo(self, name):
        print "%s %s" % (self.prefix, name)

def bar(some_method):
    foobar = FooBar("Hello")
    some_method(foobar, "World")

bar(FooBar.foo) 
```

这将打印“Hello World”

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-01T18:11:47.277

是的; 函数（和方法）是 Python 中的第一类对象。以下作品：

```
def foo(f):
    print "Running parameter f()."
    f()

def bar():
    print "In bar()."

foo(bar) 
```

输出：

```
Running parameter f().
In bar(). 
```

使用 Python 解释器或使用[IPython](http://ipython.scipy.org/moin/) shell 来回答这些问题是微不足道的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-01T18:14:52.980

方法和其他对象一样是对象。所以你可以传递它们，将它们存储在列表和字典中，对它们做任何你喜欢的事情。它们的特殊之处在于它们是可调用的对象，因此您可以`__call__`对其进行调用。`__call__`当您调用带有或不带参数的方法时会自动调用，因此您只需要编写`methodToRun()`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-04-16T01:35:09.973

不完全是您想要的，但一个相关的有用工具是`getattr()`使用方法的名称作为参数。

```
class MyClass:
   def __init__(self):
      pass
   def MyMethod(self):
      print("Method ran")

# Create an object
object = MyClass()
# Get all the methods of a class
method_list = [func for func in dir(MyClass) if callable(getattr(MyClass, func))]
# You can use any of the methods in method_list
# "MyMethod" is the one we want to use right now

# This is the same as running "object.MyMethod()"
getattr(object,'MyMethod')() 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-11-11T06:47:24.203

示例：一个简单的函数调用包装器：

```
def measure_cpu_time(f, *args):
    t_start = time.process_time()
    ret = f(*args)
    t_end = time.process_time()
    return t_end - t_start, ret 
```

# asp.net-mvc - 有没有办法用 jQuery 或 ASP.NET MVC 触发服务器事件？

> ID：706723
> 
> 赞同：3
> 
> 时间：2009-04-01T18:07:05.557
> 
> 标签：asp.net-mvc, jquery

我有这种情况：我有一个页面，其中有一天的事件列表。这些事件的状态可以更改为“已确认”或“已取消”。

但是，例如，当我单击“已确认”时，此状态将保存在 SQL Server 上，并且此状态显示为“已确认”。但是，如果另一个人在我更改事件状态时打开了相同的页面，则此人将不会看到新状态。他只会查看是否重新加载页面。

我知道有一个 Ajax 设置 TimeOut 每 5...10...15 秒刷新一次页面。但我在想是否有一个 jQuery 或 ASP.NET MVC 触发器，当我更改事件状态时，服务器会以浏览器刷新来响应。

有什么解决办法吗？？

谢谢！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:11:24.657

**选项 1**：使用[**jQuery Timer**](http://plugins.jquery.com/project/Timer)并每 X 秒更新一次页面上的控件。（您不必重新加载整个页面，只需使用确认/取消状态的控件状态，并仅在服务器返回新值时更改它们）。

**选项 2**：您可以使用 Silverlight 2+ 从服务器触发页面上的事件。

**提示**：当您更新控件的状态（确认/取消）时，也会传递初始状态。因此，如果一个用户已将状态从已确认更新为已取消，则尝试将此状态从确认更新为已取消的另一用户将收到一条友好的错误消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T20:37:22.027

简而言之：没有。

服务器不记得将页面发送到何处。一旦服务器向浏览器发送一个页面，它就会结束连接。因此，服务器将不知道将刷新指令或新页面发送到何处。要在网页上进行“实时”更新，浏览器需要发起调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T12:49:15.877

您可以使用 ASP .NET 中的异步处理程序来实现它。这意味着，您可以在服务器上订阅更新事件，服务器持有请求（同时不消耗任何工作线程），当状态更新时，请求结束并以新状态响应发送给客户端。

# sql - 在 SQL Server 2008 中创建新数据库时，自动关闭选项是什么？

> ID：706732
> 
> 赞同：3
> 
> 时间：2009-04-01T18:08:20.670
> 
> 标签：sql, sql-server, sql-server-2008

在 SQL Server 2008 中创建新数据库时，自动关闭选项是什么？

**编辑**：你如何决定是打开还是关闭它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T18:11:26.403

来自 MSDN：

> 如果为 True，则关闭数据库，并在没有用户连接访问数据库时释放其资源。如果为 False（默认），则服务器将数据库保持在打开和就绪状态，而不管用户活动如何。

编辑回答编辑问题：这完全取决于服务器是否需要额外的内存，以及打开和关闭数据库的时间成本是否值得获得额外的内存。如果您不确定，那么 false 可能是要走的路。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:31:48.787

简而言之，永远不要在生产中启用它

仅在不经常访问数据库时启用（例如 Dev/QA）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-10T01:52:18.777

如果您在 SQL Server 2008 中使用数据库镜像，请将 Auto Close 设置为 false。

# c# - Linq To Sql - 更新没有被持久化

> ID：706748
> 
> 赞同：0
> 
> 时间：2009-04-01T18:12:34.280
> 
> 标签：c#, .net, sql-server, linq, linq-to-sql

我真的很困惑为什么没有更新。这很简单：

```
 int goodID = 100;

    DataContext db = new DataContext();

    Schedule schedule = db.Schedules.Single(s => s.ID == goodID);

    // this wont persist - WHY NOT?!
    schedule.Email = txtEmail.Text;

    // this does persist
    schedule.NumberCourses = 5;

    db.SubmitChanges(); 
```

我不明白为什么电子邮件字段没有从文本框中获取值。我可以检查什么？

# 编辑

我设置了一个断点并在分配后检查了值。它分配文本框值但仍然没有更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T18:23:05.190

检查哪些更改将提交到数据上下文。

`db.SubmitChanges()`在该行执行之前添加一个断点并添加以下 Watch：

```
db.GetChangeSet(); 
```

在 Watch（或 Quick Watch）窗口中，您将能够看到正在提交的更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:15:50.760

设置断点并检查该行前后 schedule.Email 的值。此外，使用即时窗口检查 txtEmail.Txt 以查看它是否实际包含数据。

告诉我们你发现了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:27:56.520

该 dbml 是否与数据库表匹配？如果它与数据库不匹配，您可能会得到奇怪的东西。尝试重新导入它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T18:29:10.667

我是一个白痴。它是固定的。为大家投票。我没有像普通人那样检查数据库，而是在刷新页面后查看网络表单。我没有使用数据库中的值初始化文本框。所以更新正在发生。看？我告诉过你我是个白痴。

# bash - 为什么这个 bash 提示行为奇怪/消失，我该如何修复它（OS X）？

> ID：706750
> 
> 赞同：15
> 
> 时间：2009-04-01T18:13:26.117
> 
> 标签：bash, macos, shell, prompt

我承认我使用了一个有点冗长的 bash 提示：

```
--(username)-(Wed April 01|12:00:00)--(~ $
```

最近，我有了一个好主意，将其更改为根据上一个命令的退出值，如果成功，则 () 的内部元素将是绿色的，如果失败，它们将是红色的。我得到了它的大部分工作（一些奇怪的退出状态会将颜色更改为其他颜色，但我可以接受），但是当输入一个多于一行的命令并导致终端滚动时，提示消失！当没有颜色时，我的提示工作正常，所以我猜这与我的颜色转义有关，尤其是我未闭合的 [，但我无法确定它。

```
#.profile
export PS1='--(\e[$((32-${?}))m\u\e[0m)-(\e[$((32-${?}))m\d\e[0m|\e[$((32-${?}))m\T\e[0m)--(\e[$((32-${?}))m\w\e[0m \$ '
```

提前致谢！

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-01T18:45:48.257

听起来[这](http://forums.macosxhints.com/archive/index.php/t-17068.html)应该可以解决您的问题。

这似乎对我有用`*`：

```
export PS1='--(\[\e[$((32-${?}))m\]\u\[\e[0m\])-(\[\e[$((32-${?}))m\]\d\[\e[0m\]|\[\e[$((32-${?}))m\]\T\[\e[0m\])--(\[\e[$((32-${?}))m\]\w\[\e[0m\] \$ ' 
```

`*`嗯，真的很`export PS1='\u@\h:\w\$ '`适合我

引用链接的帖子，答案在于在PS1 声明中的所有颜色序列周围添加**\[ 和 \] ：**

> 在我为 PS1 获得以下值之前：
> 
> '\e[0;34m\h:\w [!]\$\e[0m'
> 
> 这给了我以下形式的漂亮蓝色提示
> 
> 主机名：工作目录 [命令号]$
> 
> 但是，我遇到了与您相同的换行问题。解决方法是在 ANSI 转义符周围插入 \[ 和 \]，以便 shell 知道不将它们包含在换行计算中。这导致 PS1 的值如下：
> 
> '\[\e[0;34m\]\h:\w [!]\$\[\e[m\]'

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-01T19:21:46.187

[http://mywiki.wooledge.org/BashFAQ/053](http://mywiki.wooledge.org/BashFAQ/053) - 我有一个漂亮的颜色提示，现在 bash 似乎不知道我的终端有多宽。线条不正确地环绕。

顺便一提; 供你参考; 这是我的`PS1`，看起来像这样：（ [来源：][[lyndir.com](http://lhunath.lyndir.com/stuff/PS1.png)][）][![替代文字](https://i.stack.imgur.com/vorQL.png "PS1")](https://i.stack.imgur.com/vorQL.png "PS1")

```
\[$reset$bold$green\]\u@\h\[$blue\] \W \[$red\]${?/#0/\[$green\]}\$\[$reset\] 
```

请注意我如何将所有颜色代码放入其中`$parameters`以使其更整洁，但更重要的是，因为**您应该使用`tput`它们来生成它们**。看：

[http://mywiki.wooledge.org/BashFAQ/037](http://mywiki.wooledge.org/BashFAQ/037) -- 如何打印各种颜色的文本？

我在一个实用程序脚本中声明了我的颜色参数，该实用程序脚本由[我的`~/.bashrc`](http://lhunath.lyndir.com/stuff/.bashrc)（以及我编写的任何脚本）提供，称为[`bashlib`](http://lhunath.lyndir.com/stuff/bashlib).

最后一点；把你的`PS1`定义放进去`~/.bashrc`，不要这样做`export`。绝对没有理由将您的`PS1`定义添加到您从 shell 生成的任何和所有进程的环境中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:55:03.400

您似乎只是缺少转义符周围的开始和结束括号（在第一个 '\e' 之前和最后一个 'm' 之后）：

```
PS1='--(\[\e[$((32-${?}))m\u\e[0m)-(\e[$((32-${?}))m\d\e[0m|\e[$((32-${?}))m\T\e[0m)--(\e[$((32-${?}))m\w\e[0m\] \$ ' 
```

如前所述， PS1 var 不需要导出：只有您的 shell 需要看到它。

# javascript - 从 javascript 事件中停止音乐

> ID：706753
> 
> 赞同：1
> 
> 时间：2009-04-01T18:13:59.377
> 
> 标签：javascript, flash

我试图停止我在页面中加载的 flash swf 中的音乐

```
<object id="FlashControl1" type="application/x-shockwave-flash"
data="Flash/Preloader%20-%20Splash.swf" width="980px" height="316px">
<param name="movie" value="Flash/Preloader%20-%20Splash.swf" />
<param name="wmode" value="Transparent" />
<param name="quality" value="High" />
<param name="play" value="True" />
<param name="loop" value="False" />
<param name="menu" value="False" />
<param name="scale" value="Exactfit" />
<param name="flashvars" value="name="FlashControl1"" />
<img src="Images/Banner/Main_Banner.jpg" alt="" width="980px" height="316px" />
</object> 
```

我有一个按钮，可以加载带有 silverlight 视频的模式弹出窗口，我希望通过执行 SoundMixer.stop(); 来停止音频。命令。

我还没有在谷歌上找到解决方案

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T22:20:33.107

在您的 Flash 文件中，您必须具有以下功能：

```
function stopSound():void {
    SoundMixer.stop();
} 
```

然后，您必须使其可用于 JavaScript 调用

```
ExternalInterface.addCallback('stopSound', stopSound); 
```

在你的 JavaScript 代码中，你必须有这个简单的函数来选择你的 swf：

```
function getFlashMovie(movieName) 
{
    var isIE = navigator.appName.indexOf("Microsoft") != -1;
    return (isIE) ? window[movieName] : document[movieName];
} 
```

当您想停止电影中的声音时，您只需从 JavaScript 调用您之前在 swf 中提供的函数：

```
movie = getFlashMovie('your-movie-name');
movie.stopSound(); 
```

那应该这样做。有关 ExternalInterface.addCallback 的更多信息，请查看[Adob​​e AS3 语言参考页面](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/external/ExternalInterface.html#addCallback())。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T17:56:24.490

```
function test() {
movie = document.getElementById('FlashControl1');
movie.stopSound();} 
```

这工作:)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-06-27T07:48:29.240

我尝试了很多东西，例如`$("object").stop();`

对 IE 没有任何作用。

然后我想出了这个肮脏的解决方案。我把整个对象放在一个***div中***

然后在 javascript

```
document.getElementById("outerdiv").innerHTML=""; 
```

繁荣......就像一个魅力......

# sql-server - SQL Server Management Studio - 网格结果另存为 .CSV - 如何输出文本而不是 UTF-16 (Unicode)

> ID：706754
> 
> 赞同：5
> 
> 时间：2009-04-01T18:14:18.050
> 
> 标签：sql-server, csv, unicode, ssms, utf-16

在 SQL Server Management Studio 中，是否可以更改网格“另存为”以写出文本而不是 UTF-16 的编码？

当我在 SQL Server Management Studio 中右键单击结果网格时，它允许另存为 .CSV。目前它保存编码为 UTF-16 (Unicode) 的 .CSV 文件，但 Excel 不会自动打开此格式（Excel 会提示输入分隔符）。为了绕过提示，我在 SlickEdit 中打开了文件并执行了另存为“文本”。当然，这是一个额外的步骤。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-02T07:30:03.037

如果您使用适用于 SQL 2005/2008 的 Sql Server Management Studio，则此答案适用。

在“保存结果”表单上，“保存”按钮的右端有一个小的下拉按钮。

单击此按钮并选择“使用编码保存”。选择 ANSI 以获取单字节字符集。

# python - 在 python 中使用 MySQLdb 插入 mysql 后，如何安全有效地获取行 ID？

> ID：706755
> 
> 赞同：16
> 
> 时间：2009-04-01T18:14:27.770
> 
> 标签：python, mysql

我在 mysql 中有一个简单的表，其中包含以下字段：

*   id -- 主键、整数、自增
*   名称 -- varchar(50)
*   描述 -- varchar(256)

使用 MySQLdb，一个 python 模块，我想在表中插入一个名称和描述，并取回 id。

在伪代码中：

```
db = MySQLdb.connection(...)
queryString = "INSERT into tablename (name, description) VALUES" % (a_name, a_desc);"

db.execute(queryString);
newID = ??? 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-01T18:18:08.027

我想可能是

```
newID = db.insert_id() 
```

* * *

**由原始海报编辑**

事实证明，在我使用的 MySQLdb 版本（1.2.2）中，您将执行以下操作：

```
conn = MySQLdb(host...)

c = conn.cursor()
c.execute("INSERT INTO...")
newID = c.lastrowid 
```

我将此作为正确答案，因为它让我指出了正确的方向。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T19:14:59.870

我不知道是否有针对此的 MySQLdb 特定 API，但通常您可以通过[SELECTing LAST_INSERT_ID()获取最后插入的 id](http://dev.mysql.com/doc/refman/5.0/en/getting-unique-id.html)

它是基于每个连接的，因此如果其他客户端也执行插入操作，您不会冒竞争条件的风险。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-07T22:19:48.573

你也可以做一个

`conn.insert_id`

* * *

## 回答 #4

> 赞同：-8
> 
> 时间：2009-04-01T18:18:29.320

最简单的方法是将带有选择计数查询的插入包装到单个存储过程中，然后在代码中调用它。您将传入存储过程所需的参数，然后它将选择您的行数。

# c# - 为什么编译器为此需要复杂的语法？

> ID：706759
> 
> 赞同：1
> 
> 时间：2009-04-01T18:15:07.707
> 
> 标签：c#, .net, string, mono, char

或者，“我做错了吗”？

我正在编写一个小函数，该函数将返回一个字符串，如有必要，将其引用（作为可引用的可打印），否则按原样返回。一个字符被输入到函数中；结果是一个字符串。

我最初尝试做的是：

```
private string QuotedChar(char ch) {
    if(ch < (char)128 && !char.IsWhiteSpace(ch))
        return(new string(ch));

    // ...
} 
```

但是，编译器在编译返回语句时说 CS0214，“指针和固定大小的缓冲区只能在不安全的上下文中使用”。如果我将代码改为：

```
private string QuotedChar(char ch) {
    if(ch < (char)128 && !char.IsWhiteSpace(ch))
        return(new string(new char[] { ch }));

    // ...
} 
```

...它工作得很好。然而，这似乎毫无意义。我不明白为什么它认为我正在尝试使用指针或固定大小的缓冲区，因为它只是一个字符。我是否错过了一些非常愚蠢的东西，或者这是一个问题/错误？

仅供参考，这是 Mono 2.0，而不是 Microsoft .NET Framework。我不运行 Windows，所以我没有微软的 C# 编译器来查看它是否做同样的事情，这就是为什么我想知道它是否是一个错误。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-01T18:19:37.210

好吧，它不是无法编译的错误。没有字符串构造函数重载需要一个字符。我怀疑 Mono 认为你的意思是`string(char*)`构造函数并尝试过 - 导致错误。

`char`将 a 转换为 a的最简单方法`string`是简单地调用`ToString()`：

```
private string QuotedChar(char ch) {
    if(ch < (char)128 && !char.IsWhiteSpace(ch))
        return ch.ToString()

    // ... 
} 
```

MS C# 编译器猜测相同的重载，但给出不同的错误消息：

> Test.cs(8,20)：错误 CS1502：匹配的最佳重载方法 `'string.String(char*)'`有一些无效参数
> Test.cs(8,31)：错误 CS1503：参数 '1'：无法转换`'char'`为`'char*'`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:25:16.730

在 .NET 中编译的相同代码会给出错误消息，即以 char 作为参数的字符串构造函数没有重载。最接近的匹配是带有指向字符的指针的匹配，因此这可能就是您在 Mono 中收到该错误消息的原因。

您可以使用采用 char 和 count 的重载：

```
return new String(ch, 1); 
```

或者您可以使用 ToString 方法：

```
return ch.ToString(); 
```

或静态 ToString 方法：

```
return Char.ToString(ch); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:20:36.913

[System.String](http://msdn.microsoft.com/en-us/library/system.string.string.aspx)没有采用单个字符的构造函数。

有两种可能：

```
String(Char*) 
```

或者

```
String(Char[]) 
```

这就是为什么您的第二个选项有效的原因，第一个是认为您正在尝试传递一个指针（不安全）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T18:21:35.897

没有重载`new string()`需要一个字符。您实际上得到的是采用 char* 的重载，这意味着它需要一个指向以空字符结尾的字符数组的指针，但仅在不安全的上下文中才允许使用指针。

而不是创建一个数组，你可以做`new string(ch, 1)`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T18:22:46.843

我会将您的“return new string(ch)”更改为“return ch.ToString()”字符串没有采用单个字符的构造函数。但是，它确实有一个需要一个字符和一个计数。

你可以去 "new string(ch, 1 )" 创建一个包含 1 个字符的字符串，这将是 ch 变量中的内容。

# java - 如何复制二维字符串数组？

> ID：706763
> 
> 赞同：4
> 
> 时间：2009-04-01T18:16:11.323
> 
> 标签：java, arrays, pointers, string

我正在使用一个使用二维字符串数组的程序（一开始可能不是那么聪明，但是嗯），我想编写一个函数来获取这些数组之一（比如说array1），使得一个独立的副本，并返回它（比如说array2）。但是，当我随后更改 array2 中的值时，它似乎反映在 array1 中。

我的功能目前看起来像这样：

```
public static String[][] copy(String[][] matrix, int n) {
    String[][] out = new String[n+1][n+1];
    for (int i = 0; i < n+1; i++) 
        for (int j = 0; j < n+1; j++) {
            if(matrix[i][j] != null) {
                String cp = new String(matrix[i][j]);
                out[i][j] = cp;
            }

        }

    return out;
} 
```

我声明了一个新的字符串数组，然后遍历它，分别复制每个值。当这不起作用时，我什至尝试从每个旧字符串中显式声明一个新字符串并将其放入数组中。

谁能告诉我哪里出错了？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T18:20:54.320

我不确定`n`参数的用途，但如果我需要这样的功能，我会使用这样的东西：

```
public static String[][] copy(String[][] matrix) {
  String[][] copy = new String[matrix.length];
  for (int idx = 0; idx < matrix.length; ++idx)
    copy[idx] = matrix[idx].clone();
  return copy;
} 
```

您不需要创建 的副本`String`，因为它们是不可变的。正如迈克尔在评论中指出的那样，`String(String)`如果将原始字符串创建为某个非常大字符串的子字符串，则构造函数可能很有用。另一种用途是当您将`String`对象用作锁（不推荐）并希望使用私有实例来避免死锁时。

此外，在分配之前检查元素是否为空是不必要的；如果您的循环设置正确，则该元素保证为空。（如果不是，覆盖它有什么害处？）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:24:38.697

看看[System.arraycopy](http://java.sun.com/javase/6/docs/api/java/lang/System.html)。这样你就可以摆脱内循环。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T18:25:33.873

您的方法看起来应该可以工作，尽管将 n 作为参数传递会使它变得脆弱，但使用输入数组的长度字段会更好，您甚至可以以这种方式处理锯齿状数组。

不需要复制内容，因为无法更改字符串 - 这导致了主要问题：您进行了哪些似乎反映在副本中的更改？向我们展示执行此操作的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T18:29:57.857

也许[Arrays.copyOf](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html#copyOf(T[],%20int))会有一些用处？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-11T14:31:08.950

我用你的代码试过：得到异常 java.lang.ArrayIndexOutOfBoundsException

它对我有用，请尝试这样：

```
 public static String[][] copy(String[][] matrix, int n) 
 {
     String[][] out = new String[n][n];
     for (int i = 0; i < n; i++) 
       for (int j = 0; j < n; j++) {
        if(matrix[i][j] != null) {
            String cp = new String(matrix[i][j]);
            out[i][j] = cp;
        }
       }
     return out;
 } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T18:35:04.617

看看这个问题[是Java通过引用传递吗？](https://stackoverflow.com/questions/40480/is-java-pass-by-reference)Java 传递对象的方式可能有点令人困惑，但这可以解释为什么对一个数组进行更改也会对另一个数组进行更改。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-02T05:16:49.330

如上所述，您使用 'n' 参数是多余的，但您的 n+1 代码也存在缺陷？如果运行如下代码，您的代码将产生 ArrayIndexoutOfBoundsException：

```
 String [][] m1 = { {"A", "B"}, {"C", "D" } };
String [][] m2 = copy(m1, 2); 

```

您打算如何调用它？

它还将您的函数限制为字符串的平方“矩阵”。但至于你引用的问题，我看不出程序为什么会这样……我什至使用上面的调用运行它（但 n=1 ？？？）然后改变了

```
m2[0][1] = "X";
```

并且 m1 没有像预期的那样受到影响。甚至将最里面的代码行替换为：

```
 out[i][j] = matrix[i][j]; 
```

不会改变这一点，因为编译器会将其重写为您最初拥有的内容。事实上，很多 String 语法只是 StringBuffers 的语法糖（例如连接和赋值）。例如编译器将重写

```
 String s = "Hello ";
s += "World";        // Makes it appear that String is builtin type! 
```

到

```
 String s = new String("Hello ");
s = new StringBuffer(s).append("World").toString(); 
```

这就是为什么你在循环中有很多字符串连接，它们的性能很差。

我也不明白您为什么遇到您引用的问题。

而且由于您没有修改参数“矩阵”，因此“按引用传递”与它无关。

# javascript - next() 的 jQuery 层次结构问题

> ID：706767
> 
> 赞同：0
> 
> 时间：2009-04-01T18:17:05.500
> 
> 标签：javascript, jquery

当图像和 div 标记都是段落的子项时，似乎`$("img").next().hide();`不起作用。

```
<p>
<img src="image.jpg" />
<div>text</div> // this div is set to 'display: none' by default in css
</p> 
```

然而，如果我`<div>`用`<span>`

```
<p>
<img src="image.jpg" />
<span>text</span>
</p> 
```

或者如果我省略`<p>`标签

```
<img src="image.jpg" />
<div>text</div> 
```

jQuery 选择器确实可以正常工作。任何想法为什么会这样？它与内联和块显示有关吗？我怎样才能使它按照顶部代码示例中的描述工作？

这是我正在使用的 jQuery 代码：

```
$(document).ready(function(){
    $("img").hover(
        function()
        {
            $(this).next().show();
        },
        function()
        {
            $(this).next().hide();
        }
    );
}); 
```

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:20:16.740

不应在内联元素 (P) 中使用块元素 (DIV)。而不是 P 使用带有类集的 DIV，如 P。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T18:20:41.793

该[`p`元素](http://www.w3.org/TR/html401/struct/text.html#edef-P)只允许[内联元素](http://www.w3.org/TR/html401/sgml/dtd.html#inline)作为子元素。这可能是您的第一个示例不起作用的原因。

# ajax - 使用 Ajax.BeginForm 发布的 ASP.NET MVC 返回空白视图

> ID：706773
> 
> 赞同：1
> 
> 时间：2009-04-01T18:19:25.153
> 
> 标签：ajax, asp.net-mvc, forms

我有一个包含多个输入的页面 - 我正在使用 Ajax.BeginForm 为每组输入构建一个表单。

```
<% using (Ajax.BeginForm(new AjaxOptions() { InsertionMode = InsertionMode.InsertAfter, HttpMethod = "POST" }))
   { %>
     <input class="smallInput" type="text" name="duration"/>
     <input type="submit" value="Add" />
<% } %> 
```

控制器看起来像这样

```
 [AcceptVerbs("POST")]
   public ActionResult AddExercise(FormCollection form)
   {

       // some save logic...

       return Content(string.Empty);

   } 
```

这行得通 - 数据被提交给我的控制器并被保存。

但是，每次发生这种情况时，我的页面都会被空白页面替换。如果我从我的操作中显式返回一个视图，则会出现该视图。但我希望它提交表单，让我现有的页面保持原样。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-06T15:39:35.393

我的页面中没有包含 MVC Ajax javascript 文件。添加这些包括解决了问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:38:13.470

您需要指定要更新的 DOM 元素的 id：

```
<% using (Ajax.BeginForm(new AjaxOptions() { 
    UpdateTargetId = "someID", 
    InsertionMode = InsertionMode.InsertAfter, 
    HttpMethod = "POST" }))
{ %>
    <input class="smallInput" type="text" name="duration"/>
    <input type="submit" value="Add" />
<% } %> 
```

# java - 完成 JUnit 4 动态套件的细节

> ID：706784
> 
> 赞同：1
> 
> 时间：2009-04-01T18:22:32.133
> 
> 标签：java, unit-testing, junit, junit4

嗨——我想将 JUnit 测试自动扫描到套件中，作为我持续构建的一部分，所以我从 JUnit 的套件中派生了一个运行器，它可以在一个包中找到所有测试类。跑步者工作得很好，但结果显示低于预期。

我的测试支持包中有一个类，我的跑步者带有 @RunWith 注释。跑步者通过读取一个属性来获取被测试的包。设置属性并告诉 JUnit 运行带注释的类，然后执行该包中的所有测试。在 Ant 和 IntelliJ 中，套件的名称报告为具有 @RunWith 注释的类的名称。我的跑步者对 ParentRunner.getName() 有一个覆盖，它返回被测包的名称。我验证了字符串进入了跑步者的描述对象。我错过了什么？

环境：

*   JUnit：4.5
*   蚂蚁：1.7.0
*   IntelliJ IDEA：8.1

感谢您提供的任何方向。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T15:41:05.550

这是因为 ANT 和 IntelliJ 使用他们自己的跑步者，所以他们是根据测试构建名称，而不是从你的跑步者那里获得名称。换句话说，运行者被委派是为了运行测试，而不是为了描述它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-15T15:22:54.867

就在几周前，我遇到了类似的问题，并因此创建了一个开源项目。

您可以通过 maven 包含它

```
<dependency>
   <groupId>com.github.cschoell</groupId>
   <artifactId>junit-dynamicsuite</artifactId>
   <version>0.2.0</version>
   <scope>test</scope>
</dependency> 
```

或者从 github 页面下载它，您也可以在其中找到它的文档。

[https://github.com/cschoell/Junit-DynamicSuite](https://github.com/cschoell/Junit-DynamicSuite)

包含一个 Junit 运行器，它允许扫描目录或类路径以进行单元测试，并通过实现一个简单的接口来过滤它们。

# apache-flex - Flex折线图进阶教程

> ID：706792
> 
> 赞同：-1
> 
> 时间：2009-04-01T18:24:21.707
> 
> 标签：apache-flex

我需要为一家公司构建一个销售图表，并且我需要真正自定义 Flex 中的 LineChart。谁能给我指一个教程，甚至是一本详尽介绍 Flex 中的 LineChart 的书？

**更新** 谢谢你们的回答，但我正在寻找对 LineChart 可以做的所有事情的深入全面报道。我正在尝试构建一个自定义的，但在进一步自定义它时遇到了麻烦，然后这些教程解释了。我想要一些能让我深入了解它们如何工作的东西，这样我就可以智能地对它们进行编程，而不是通过排列进行编程。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T18:34:10.547

首先查看 Adob​​e 的[LineChart](http://livedocs.adobe.com/flex/3/html/help.html?content=charts_types_08.html)教程和[图表格式](http://livedocs.adobe.com/flex/3/html/charts_formatting_05.html)教程。由于您没有指定确切的详细信息，我建议您浏览一下博客。一个好的开始会在[这里](http://blog.flexexamples.com/2007/11/15/displaying-grid-lines-in-a-flex-linechart-control/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T09:30:31.280

查看[flexexamples](http://blog.flexexamples.com/)。这为所有类型的图表提供了大量示例。

# sql-server - 如何编写一个 SQL 查询，在我的数据库的所有列和所有表中查找一个值？

> ID：706803
> 
> 赞同：3
> 
> 时间：2009-04-01T18:28:24.537
> 
> 标签：sql-server, sql-server-2008

我正在尝试在我的 Microsoft SQL Server 2008 数据库中查找一个值，但我不知道要查看哪个列或表。我正在尝试制作一个查询，该查询将在我的所有表和所有列中查找价值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T18:36:55.453

您可能可以使用 sys.cols 和 sys.tables 使用动态 sql 来完成它，您应该能够创建查询。

这很可能是一个运行时间极长的查询。

我重新考虑了我的答案，如果您运行下面的查询，它将生成许多 sql 语句，如果您运行这些语句，您会发现哪一列具有您想要的值。只需将 [your value here] 替换为适当的值即可。这是假设您的值是 varchar。

```
SELECT 'SELECT ''' + TABLE_NAME + '.' + column_name + 
   ''' FROM ' + TABLE_NAME + ' WHERE ' + 
   column_name + ' = ''[your value here]'''
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE DATA_TYPE = 'varchar'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:32:04.920

您不能在单个查询中执行此操作。您将不得不循环浏览 sys.tables 和 sys.columns 信息视图并构建多个查询（每个表一个），这将在一个非常长的 OR 构造中查找所有字段中的值（每个字段一个）场地）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T19:50:25.183

前段时间写了这个，不知道是干什么用的。我记得那是在我知道 sp_msForEachTable 之前！您可能需要调整可变大小（如果您在 2005 + 上，也可以将它们全部设为 MAX）

```
create proc SearchForValues (@search varchar(100))

as

Begin

declare @i int
declare @tbl varchar(50)
declare @col varchar(50)
declare @sql varchar(500)

create table #TEMP (id int identity (1,1), colname varchar(50), tblname varchar(50))

insert into #TEMP
select a.name, b.name from dbo.syscolumns a inner join
(
select * from dbo.sysobjects where xtype = 'U'
) b
on a.ID = b.ID

create table #SEARCHRESULT (TblName varchar(50), ColName varchar(50))

If isnumeric(@search) = 0 and @search is not null
begin
set @search = '''' + @search + ''''
end

set @i = 1

While @i <= (select max(id) from #TEMP)
   Begin
    select @tbl = tblname from #temp where ID = @i
    select @col = colname from #temp where ID = @i

    set @sql = 'If Exists(select *
                          from   [' + @tbl + ']
                          where  convert(varchar(500), [' + @col + ']) = ' + @search + '
                         )
                     Insert Into #SEARCHRESULT (TblName, ColName) Values(''' + @tbl + ''',''' + @col + ''')'

    execute (@sql)

    set @i = @i + 1
   End

drop table #TEMP
select * from #SEARCHRESULT
drop table #SEARCHRESULT
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T18:32:00.927

你不能使用普通的 SQL。除非您使用执行此操作的工具（例如 Oracle 的[PL/SQL 开发人员](http://www.allroundautomations.nl/plsqldev.html)）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T18:32:40.253

在这个美好的日子里，我冒着被否决的风险，但我认为在这种情况下，数据文件`1st april`会更容易。`grep`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T18:42:32.973

存储过程**sp_msForEachTable**对每个表执行查询。这是简单的部分。查看每个表的所有列应该是更难的部分。起初，它们可能具有不同的数据类型。因此，您可能只能执行字符串比较。

但我确信这可以通过使用来自系统表和一些系统存储过程的信息来实现。我会尝试找到一种解决方案来访问单个表上的单个列，其中表名和列名仅作为字符串参数给出。此时想到了[动态 SQL 。](http://www.sommarskog.se/dynamic_sql.html)如果你解决了这个问题，那么从系统表中获取所有表名和所有列名并将每个表名连接在一起或将其放入存储过程中应该变得相对简单。如果您找到解决方案，我想看看结果。

# python - 将方法（带参数）传递给python中的另一个方法的最佳方法是什么

> ID：706813
> 
> 赞同：2
> 
> 时间：2009-04-01T18:31:10.897
> 
> 标签：python

将方法和方法参数传递给另一个方法的最佳方法是什么？

有没有更好的方法来执行以下操作？

```
def method1(name)
    return 'Hello ' + name

def method2(methodToCall, methodToCallParams, question):
    greetings = methodToCall(methodToCallParams)
    return greetings + ', ' + question

method2(method1, 'Sam', 'How are you?') 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-01T18:43:55.967

如果你想一键打包调用，你可以使用 functools 模块：

```
from functools import partial

def some_function(param_one, param_two):
    print "Param One: %s" % param_one
    print "Param Two: %s" % param_two

def calling_function(target):
    target()

calling_function(partial(some_function, "foo", "bar")) 
```

你也可以用 functools.partial 做一些更精细的事情，比如只绑定一些参数，给你一个带有新签名的函数。在很多情况下使用它是矫枉过正的，但它肯定有它的位置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-01T18:46:52.917

你可以这样做：

```
def method1(name):
    def wrapper():
        return 'Hello ' + name
    return wrapper

def method2(method, question):
    output = method()
    return output + ', ' + question

method2(method1(name = 'Sam'), 'How are you?') 
```

当然，您也可以在 method() 调用中传递一些变量：

```
def method1(name):
    def wrapper(greeting):
        return greeting + name
    return wrapper

def method2(method, question):
    output = method(greeting = 'Hello ')
    return output + ', ' + question

method2(method1(name = 'Sam'), 'How are you?') 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-02T00:49:17.883

[正如jkp 指出的那样](https://stackoverflow.com/questions/706813/what-is-the-best-way-to-pass-a-method-with-parameters-to-another-method-in-pyth/706864#706864)，您可以使用[functools.partial](http://docs.python.org/library/functools.html)来执行此操作

但是，functools 是 Python 2.5 中的新功能，因此过去为了处理这个问题，我使用了以下代码（实际上，此代码在 functools.partial 的 Python 文档中）。

```
# functools is Python 2.5 only, so we create a different partialfn if we are
# running a version without functools available
try:
    import functools
    partialfn = functools.partial
except ImportError:
    def partialfn(func, *args, **keywords):
        def newfunc(*fargs, **fkeywords):
            newkeywords = keywords.copy()
            newkeywords.update(fkeywords)
            return func(*(args + fargs), **newkeywords)
        newfunc.func = func
        newfunc.args = args
        newfunc.keywords = keywords
        return newfunc 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T18:56:09.243

如果您正在使用 2.5 之前的 Python 版本，另一种选择是使用 lambda 作为闭包：

```
def some_func(bar):
    print bar

def call_other(other):
    other()

call_other(lambda param="foo": some_func(param)) 
```

高温高压

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T18:37:44.407

您正在考虑使用 currying，将函数和参数绑定在一起以便稍后调用。通常使用currying，以便您可以在实际调用函数时添加其他参数。

而不是重新编写轮子，这里是一个示例的链接： http: [//code.activestate.com/recipes/52549/](http://code.activestate.com/recipes/52549/)。

但是，如果您在问题中模拟的情况确实如此简单，您可以将 args 列表作为位置参数，或将 kwargs 列表作为命名参数传递给另一个函数。

```
def method1(name):
    return 'Hello %s' % name

args = ['Joe']
method1(*args)

def method1a(name=None, salutation=None):
    return 'Hello %s %s' % (name, salutation)

kwargs = {'name':'Joe', 'salutation':'Mr'}
method1a(**kwargs) 
```

# php - 在 PHP 中格式化 SQL 结果的最快方法

> ID：706814
> 
> 赞同：1
> 
> 时间：2009-04-01T18:31:16.077
> 
> 标签：php, sql, mysql, mapping, resultset

什么是 PHP 中转换（My）SQL 结果的最快（最佳性能）方法，例如：

```
array(
 array('user_name' => 'john', 'tag_id' => 1, 'tag_name' => 'foo'),
 array('user_name' => 'john', 'tag_id' => 2, 'tag_name' => 'bar'),
 array('user_name' => 'rick', 'tag_id' => 3, 'tag_name' => 'foobar'),
 array('user_name' => 'rick', 'tag_id' => 2, 'tag_name' => 'bar')
); 
```

进入更容易使用：

```
array(
 array('name' => 'john', 'tags' => array(
  array('id' => 1, 'name' => 'foo'),
  array('id' => 2, 'name' => 'bar')
 ),
 array('name' => 'rick', 'tags' => array(
  array('id' => 3, 'name' => 'foobar'),
  array('id' => 2, 'name' => 'bar')
 )
); 
```

或者是否有一个库已经这样做了，而没有增加完整 ORM 的不灵活性和性能损失？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-01T18:39:40.750

试试这个：

```
$data = array(
    array('user_name' => 'john', 'tag_id' => 1, 'tag_name' => 'foo'),
    array('user_name' => 'john', 'tag_id' => 2, 'tag_name' => 'bar'),
    array('user_name' => 'rick', 'tag_id' => 3, 'tag_name' => 'foobar'),
    array('user_name' => 'rick', 'tag_id' => 2, 'tag_name' => 'bar')
);
$final = array();
foreach ($data as $item) {
    if (!isset($final[$item['user_name']])) {
        $final[$item['user_name']] = array(
            'name' => $item['user_name'],
            'tags' => array()
        );
    }
    $final[$item['user_name']]['tags'][] = array(
        'id'   => $item['tag_id'],
        'name' => $item['tag_name']
    );
}
$final = array_values($final); 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-01T18:41:22.680

[http://www.woyano.com/jv/ezsql](http://www.woyano.com/jv/ezsql)上的 ezSQL应该做你想做的事。我已经接管了一个使用它的项目，它看起来非常好。我自己我更喜欢更接近金属，但如果你想抽象出来，那么在我的经验中它看起来很可靠。

# javascript - 按名称获取表单元素？

> ID：706844
> 
> 赞同：14
> 
> 时间：2009-04-01T18:38:46.680
> 
> 标签：javascript, jquery, forms, element

我想在一个漂亮的原型或 jQuery 风格的快捷方式中轻松地为表单中所有具有相同名称的单选按钮设置样式。

`$('billship').select('name:shipType')`或类似的东西。

是否存在这种表单字段名称的快捷方式？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-01T18:39:40.250

使用 jQuery：

```
$('#billship input:radio[name="shipType"]');  
$('input:radio[name="shipType"]', '#billship'); 
```

两者是等效的，但第二个表现稍好一些，我个人更喜欢它。

使用 Prototype，我相信它会是这样的：

```
$$('#billship input[type="radio"][name="shipType"]'); 
```

# iphone - CoreAudio AudioQueue i/o 重定向到/来自手机应用程序？

> ID：706845
> 
> 赞同：1
> 
> 时间：2009-04-01T18:38:58.053
> 
> 标签：iphone, objective-c, core-audio

在考虑音频录制/播放应用程序时，我一直在阅读一些 iPhone 音频服务，但理想情况下，我希望能够将电话连接的另一端用作输入和输出，即远程扬声器和远程通过蜂窝（或VoIP，但现在蜂窝是问题）的麦克风，当它打开时，作为重定向的输入和输出目标......我似乎找不到任何文件说这是可能或不可能的......显然苹果手机应用程序是封闭源代码，我无法修改它，但我可以连接到它的一个或两个流吗？如果它是由我的应用程序发起的呼叫有什么区别吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T19:20:32.540

恐怕无法在 iPhone 上重新路由电话的音频源和接收器。在其他智能手机平台上是可能的。

您可以通过网络连接路由本地麦克风和扬声器，该网络连接将使用默认网络路由（WiFi 或蜂窝数据）来实现您的目标。

# windows - WiX——检查以前的安装

> ID：706849
> 
> 赞同：3
> 
> 时间：2009-04-01T18:39:28.223
> 
> 标签：windows, wix, windows-installer

我有一个旧版应用程序，它直接安装到用户的 c: 驱动器的目录中（如 c:\MyApp）。讨厌的东西。问题是，用户可以指定在第二个驱动器（如 e:\MyApp）上进行第二次安装，并且他们可以在任一目录中同时安装两个不同版本的应用程序。他们还可以决定将应用程序安装在目录树的其他位置，但这是最常见的两个位置。

我没有写这个方案。就我而言，它让婴儿耶稣哭了。

我必须编写一个安装程序来为这个方案添加一个模块，并且用户需要能够选择他们想要在哪个安装上安装模块。我想我会在 WiX 中尝试这个。

我该怎么做呢？

我打算做一个目录搜索，比如

```
<Property Id="MyAppInstallationSearch">
  <DirectorySearch Id="MyAppDirectory" Path="C:\MyApp">
  </DirectorySearch>
</Property> 
```

接着：

```
<Directory Id="TARGETDIR" Name="MyAppInstallationSearch">
    <Directory Id="INSTALLLOCATION" Name="AdditionalTools">
    </Directory>
</Directory> 
```

有一个安装位置。

那么我该怎么做：

1.  使搜索是相对的，而不是绝对的？（文档指定可以这样做，我只是不知道如何）。

2.  如果用户有多个位置，让他们选择使用哪个安装？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T21:30:33.337

1.  这将是相对含义，AdditionalTools 将在 MyAppInstallationSearch 找到的文件夹下。
2.  这将涉及创建 UI，这在 Wix 中并非易事，有些产品可以创建 Wix 输出或[WixEdit](http://wixedit.sourceforge.net/)。您将需要在所有可能的位置搜索目录并显示用户单选按钮（每个按钮都绑定到搜索结果）以选择安装新产品的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-28T06:53:58.753

我必须实现同样的事情，并使用外部 UI 处理程序来完全自定义安装过程。我还显示了一个向导页面，用户可以在其中选择他想要升级的版本。但请注意，这不是您在一两天内就能完成的事情。

我不知道您使用哪种编程语言，但如果您想使用 .NET，您可以使用 Wix3 附带的开发工具基础。这些库可以在您的 Wix 安装的 SDK 文件夹中找到（您主要需要 Microsoft.Deployment.WindowsInstaller.dll），文档位于 doc 目录中的 DTF.chm 中。您还需要一个引导程序来安装 .NET 框架。

您也可以等到 Wix 3.5，其中将包括 Burn、一个助推器和您可以轻松自定义的外部 UI 处理程序。

高温高压

# ruby-on-rails - 将小型 ruby 应用程序放到网上的最佳方式是什么？

> ID：706855
> 
> 赞同：3
> 
> 时间：2009-04-01T18:41:08.390
> 
> 标签：ruby-on-rails, ruby, sinatra

我有一个我写的小红宝石应用程序，它是一个字谜搜索器。它是用来学习红宝石的，但我想把它放在网上供个人使用。我对 Rails 有一些经验，这里的很多人都推荐过 Sinatra。我都很好，但我找不到任何关于如何使用文本文件而不是数据库的信息。

该应用程序非常简单，根据单词列表的文本文件进行验证，然后找到所有字谜。我一直假设这应该很简单，但我坚持将该文本文件导入 Rails（或者如果我选择这种方式，则为 Sinatra）。在 Rails 项目中，我已将文本文件放在`lib`目录中。

不幸的是，即使路径在 Rails 中看起来是正确的，我还是得到了一个错误：

```
no such file to load -- /Users/court/Sites/cvtest/lib/english.txt 
```

（`cvtest`是 rails 项目的名称）

这是代码。它本身就很好用：

```
file_path = '/Users/court/Sites/anagram/dictionary/english.txt'

input_string = gets.chomp

# validate input to list
if File.foreach(file_path) {|x| break x if x.chomp == input_string}

  #break down the word
  word = input_string.split(//).sort 

  # match word  
  anagrams = IO.readlines(file_path).partition{
    |line| line.strip!
    (line.size == word.size && line.split(//).sort == word)
  }[0] 

  #list all words except the original
    anagrams.each{ |matched_word| puts matched_word unless matched_word == input_string } 

#display error if 
else
  puts "This word cannot be found in the dictionary"
end 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T19:06:02.823

将实际功能（查找字谜）分解为方法。从您的 Web 应用程序调用该方法。

在 Rails 中，您将创建一个调用该方法而不是 ActiveRecord 的控制器操作。在 Sinatra 中，您只需创建一个调用该方法的路由。这是一个 Sinatra 示例：

```
get '/word/:input'
  anagrams = find_anagrams(params[:input])
  anagrams.join(", ")
end 
```

然后，当您访问[http://yourapp.com/word/pool](http://yourapp.com/word/pool)时，它将打印“loop, polo”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T21:52:16.530

我知道问题被标记为已回答，但我更喜欢以下内容，因为它使用查询参数而不是基于路径的参数，这意味着您可以使用常规 GET 表单提交来传递参数：

```
require 'rubygems'
require 'sinatra'

def find_anagrams word
  # your anagram method here
end

get '/anagram' do
  @word = params['word']
  @anagrams = find_anagrams @word if @word
  haml :anagram
end 
```

以及下面的haml（你可以使用任何你喜欢的模板语言）。这将为您提供一个输入表单，如果提供了一个单词并生成了一个字谜列表，则显示字谜列表：

```
%h1 
  Enter a word
  %form{:action => "anagram"}
    %input{:type => "text", :name => "word"}
    %input{:type => "submit"}
- if @word
  %h1 
    Anagrams of 
    &= @word
  - if @anagrams
    %ul
      - @anagrams.each do |word|
        %li&= word
  - else
    %p No anagrams found 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T19:54:59.947

使用 sinatra，您可以做任何事情。这些示例甚至不需要 sinatra，您可以滚动自己的机架接口。

```
require 'rubygems'
require 'sinatra'
require 'yaml'

documents = YAML::load_file("your_data.yml") 
```

或者：

```
require 'rubygems'
require 'sinatra'
content = Dir[File.join(__DIR__, "content/*.textile)].map {|path|
  content = RedCloth(File.read(path)).to_html
} 
```

等等。

# java - 我可以从客户端检测当前用户有权使用哪些 EJB？

> ID：706856
> 
> 赞同：0
> 
> 时间：2009-04-01T18:41:08.437
> 
> 标签：java, jakarta-ee, jboss, ejb, security-roles

我在 J2EE 服务器上有各种 EJB，具有不同的安全角色。

现在，从 Java Swing 客户端应用程序中，当我将用户登录到服务器时，我想发现用户可以访问这些 EJB 中的哪些，而无需实际尝试创建或调用它们。

我想这样做的原因是根据可用的 EJB 来调整用户界面。

例如，如果当前用户可以使用“AdministerMetadata”EJB，我想显示一个用于管理元数据等的菜单选项。

我可以从客户端中已知 EJB 的预定义列表中进行查询，因此我不需要它是完全动态的。

我不想创建一个特殊的 EJB 来仅返回此访问信息，并且我想避免不得不尝试调用方法并捕获异常来进行发现。

我计划在 JBoss 上使用该解决方案，但如果可能的话，我更喜欢标准解决方案。

这可能吗？如果有怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T23:24:08.290

据我所知，J2EE 中没有任何东西可以在客户端为您提供这些信息。即使在服务器端，[EJBContext](http://java.sun.com/j2ee/sdk_1.3/techdocs/api/javax/ejb/EJBContext.html)也只会为您提供调用者拥有的角色以及调用者的主体（例如登录名）。

除了拥有一个额外的 Session Bean 之外，我没有其他办法，您可以在客户端查询它，它将检查服务器端的 EJBContext 以告诉客户端当前用户拥有哪些角色。

# cookies - 哪些信息可以存储在 cookie 中？

> ID：706858
> 
> 赞同：21
> 
> 时间：2009-04-01T18:42:14.270
> 
> 标签：cookies

在考虑安全性和用户体验时，哪些信息是好的、可接受的，甚至是存储在 cookie 中的**好主意？**

编辑：

* * *

了解敏感信息，如用户名、密码、SSN、信用卡号不属于那里，什么**是**？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-01T18:46:19.737

绝对不是密码！或任何敏感的东西……请记住，cookie 存储在人们的计算机上，因此从您（作为网站开发人员）的角度来看，它们基本上是在野外，任何人都可以访问。

一种常见的做法是将会话 ID 存储在 cookie 中，并将所有其他相关信息存储在服务器上的数据库（或文件或其他）中，由会话 ID 索引。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-01T18:48:15.440

回答什么是不可接受的存储在 cookie 中要容易*得多*。任何应该保持安全的东西都不应该被存储。这包括密码、信用卡号、社会保险号等。

我认为*存储*用户的登录名是可以的，因为该信息确实不敏感。用户对您网站的偏好设置也应该没问题。

请记住，cookie 只是某人（或某些应用程序）可以打开并读取*或写入*的纯文本文件，因此您也不应该相信从 cookie 收到的信息。就像任何其他用户输入一样对其进行消毒。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-01T18:45:10.677

一种建议是**不要**在 cookie 中存储数据库的任何密钥。即电子邮件地址、列 ID 等。如果是这样，您应该加密数据。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-01T18:45:37.757

*   用户自定义 ID（存储在数据库中的一组首选项，您在页面加载时获取）
*   没有个人信息

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-01T20:38:17.690

好吧，除了敏感和安全相关数据之外，您不能和可以存储的内容确实没有限制，但请记住，如果该数据没有保存在服务器端，它可能会完全丢失，应该假设如果用户删除cookies，恢复他的设置/配置不会给他带来太多不便。除了使用良好的常识之外，没有其他指导方针。

然而，cookies 是有限制的。[根据IE 限制](http://support.microsoft.com/kb/306070)，每个域不应超过 19 个 cookie，并且任何 cookie 不应大于 4KB（4096 字节）：

> 每个 cookie 都以名称-值对开头。此对后跟零个或多个以分号分隔的属性-值对。对于一个域名，每个 cookie 限制为 4,096 字节。此总数可以作为一个 4 KB (KB) 的名称-值对存在，也可以作为最多 20 个总共 4 KB 的名称-值对存在。如果计算机没有足够的空间来存储 cookie，则丢弃 cookie。它没有被截断。应用程序应使用尽可能少的 cookie 和尽可能小的 cookie。此外，应用程序应该能够处理 cookie 的丢失。
> 
> 如果 Web 应用程序使用超过 19 个自定义 cookie，则 ASP 会话状态可能会丢失。Internet Explorer 4.0 和更高版本允许每个域总共有 20 个 cookie。因为 ASPSessionID 是一个 cookie，如果您使用 20 个或更多自定义 cookie，浏览器将被迫丢弃 ASPSessionID cookie 并丢失会话。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-01T18:49:36.733

不要在 Cookie 中存储任何内容，以免您的网站在不通过适当渠道的情况下被黑客入侵或访问。通常，只有会话 ID 或用户 ID 存储在 cookie 中，并且通常以对除 cookie 消费者之外的任何人不透明的形式存储。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-01T18:49:08.247

我会避免存储任何如果更改会损害网站功能的内容。

因此，存储用户 ID、购物车商品价格、密码、用户角色等内容是有问题的。我在服务器上的用户会话数据中保留了这种东西。

存储用户的姓名或个人资料信息（仅用于显示目的）、自定义首选项（颜色、文本等）都可以。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-06-11T15:51:28.947

将敏感信息保存在 cookie 上没有任何问题，只要该信息是加密的（数据本身不是明文）并且 cookie 是安全 cookie (https)。实际上，将所有敏感数据放在一个可能被黑客入侵的数据库服务器中是最糟糕的，然后您将面临潜在的更大的安全问题。

# c++ - 英特尔 C++ 编译器将 vptr（指向虚函数表的指针）存储在对象中的什么位置？

> ID：706861
> 
> 赞同：3
> 
> 时间：2009-04-01T18:42:39.293
> 
> 标签：c++, intel, icc

英特尔 C++ 编译器将 vptr（指向虚函数表的指针）存储在对象中的什么位置？

我相信 MSVC 把它放在对象的开头， gcc 放在最后。icpc（英特尔 C++ 编译器）是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T23:16:05.657

您始终可以查看此地址和派生类中的第一个地址所在的位置：

```
#include <stdio.h>

class foo
{
public:
    virtual int do_foo()=0;
};

class bar : public foo
{
public:
    int bar;
    int do_foo() {printf ("%08x %08x\n", this, &bar);}
};

int main()
{
    bar a_bar;
    a_bar.do_foo();
} 
```

在我的 linux 机器上，结果是：

```
bfdbef3c bfdbef40 
```

...这正是您所期望的：第一个指针加上虚函数指针的大小就是第二个指针的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T00:10:28.193

对于 Intel C++ 编译器，对于 Linux，我发现它是对象的开头。

代码：

```
#include <cstdio>

class A 
{
  int a, b;
public:
  A(int a1, int b1): a(a1), b(b1) {}
  virtual void p(void) { printf("A\n"); }
};

class B: public A
{
public:
  B(int a1, int b1): A(a1, b1) {}
  void p(void){ printf("B\n"); }
};

int main(void)
{
  A a(1, 2); int p=10; A a1(5, 6);
  B b(3, 4); int q=11; B b2(7, 8);

  a.p();
  b.p();

  int * x=(int*)&a;
  printf("%d %d %d %d\n", x[0], x[1], x[2], x[3]);
  x=(int*)&b;
  printf("%d %d %d %d\n", x[0], x[1], x[2], x[3]);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T18:57:51.020

你是什​​么意思“在函数的开头”？无论如何，Windows 编译器将 vptr 放在对象的偏移量 0 处，而 Unix 编译器将它放在最后一个成员数据之后。英特尔为 Windows 和 Unix 生产编译器，我希望 Win 版本将 vptr 放在开头，将 *nix 版本放在对象的末尾。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T23:03:32.380

vtable 指针在对象中的位置与操作系统无关。这只是编译器和其他工具的约定。

Sid Datta，您可以从 ICC 反汇编某些编译模块中发现该信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-06T03:00:22.910

除了满足您的好奇心之外，您问题的真正答案不会很有用，因为 C++ 标准没有定义这样的细节。因此，任何编译器供应商都可以按照他们认为合适的方式实现这些功能。这也是 C++ 没有跨平台 ABI（应用程序二进制接口）的原因之一。

# c# - 如何从 JScript/VBScript 调用系统代码？

> ID：706865
> 
> 赞同：0
> 
> 时间：2009-04-01T18:44:43.063
> 
> 标签：c#, .net, javascript, vbscript

我有一个 C# 应用程序，它使用 Web 浏览器控件来显示一些 HTML 并在后台执行一些 JScript。

如何将其与其他系统调用集成？我是否从 JScript/VBScript 调用其他 C# 代码？我需要从表格本身做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T18:50:11.863

当我需要托管在 webbrowser 控件中的 javascript 来回调父级时，我让它尝试将页面导航到另一个 URL。然后在 webbrowser 的“BeforeNavigate”事件中，我得到页面试图访问的 URL，解析出所有参数，将请求分派给其他 C# 代码，然后取消原始导航请求。

# linq - LINQ to DataSet，由多列区分

> ID：706866
> 
> 赞同：10
> 
> 时间：2009-04-01T18:45:06.480
> 
> 标签：linq, distinct, linq-to-dataset

只是想检查是否有办法通过多列来区分。提前致谢！！！

顺便说一句，我在[这里](https://stackoverflow.com/questions/520030/why-is-there-no-linq-method-to-return-distinct-values-by-a-predicate/520046#520046)找到了一个很棒的 LINQ 扩展，但需要一些指导才能将它用于多个列

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-01T18:54:52.070

好吧，你可以先做投影：

```
var qry = db.Customers.Select(cust => new {cust.ID, cust.Name, cust.Region})
                    .Distinct(); 
```

或者在查询语法中：

```
var qry = (from cust in db.Customers
          select new {cust.ID, cust.Name, cust.Region}).Distinct(); 
```

那行吗？

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-05-27T08:37:41.107

您可以使用 Groupby 代替 Distinct，然后选择每个组的 Top Most 记录

[如何在没有匿名类型的情况下通过多个字段区分 LINQ](https://stackoverflow.com/questions/6148809/how-to-linq-distinct-by-multiple-fields-without-anonymous-types)

> > 从 objEntity 中的 o 返回
> > 
> > ```
> >  group o by new
> >               {
> >                   o.Field1,
> >                   o.Field2,
> >                   o.Field3,
> >                   o.Field4,
> >                   o.Field5
> >               } into grp
> >               select grp.FirstOrDefault(); 
> > ```

这将为您提供**EntityObject**而不是**AnonymousType**

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-01T18:54:32.510

通过“通过多列区分”，您真正的意思是分组依据。

当您要求不同时，这意味着您将获得所有不同的行，或者通过使用表中的所有列获得一个组。

如果您只想为列的子集获取不同的分组，请在您的子句中使用 group by，指定要分组的列。然后，选择组，因为每个组只需要一组键。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-11-20T17:02:59.820

另一个简单的选择是创建一个不同的字符串。

```
var result = collection.DistinctBy(c => c.Field1 + "." + c.Field2 + "." + c.Field3); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-09T14:51:06.320

var qry = (from cust in db.Customers select new {cust.ID, cust.Name, cust.Region}).GroupBy(x => new { x.Name,x.Region}).select(z => z .OrderBy(i => i.cust).FirstOrDefault()).ToList();

# networking - TCP 和 POSIX 套接字 accept() 语义

> ID：706869
> 
> 赞同：8
> 
> 时间：2009-04-01T18:45:15.947
> 
> 标签：networking, sockets, posix, tcp

情况：服务器调用accept()。客户端向服务器发送一个 SYN。服务器获取 SYN，然后将 SYN/ACK 发送回客户端。但是，客户端现在挂起/死亡，因此它永远不会向服务器发送回 ACK。

发生什么了？accept() 是在收到 SYN 后立即返回，还是在返回客户端的 ACK 之前阻塞？如果它阻塞，它最终会超时吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-02T00:47:42.910

调用`accept()`阻塞，直到它有一个连接。除非并且直到 3 次握手完成，*否则没有连接*，所以`accept()`不应该返回。对于非阻塞套接字，它不会阻塞，但也不会为您提供有关部分完成握手的信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:54:43.960

如果客户端从不发送 ACK，如果套接字标记为非阻塞，accept() 将阻塞或返回 EAGAIN。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T18:54:31.963

它最终会超时，因为该场景实际上面临 DoS（拒绝服务）和接受返回的资源以供操作系统使用。if 可能会导致主套接字阻塞，因为一旦接受返回一个有效的文件描述符，客户端就会连接到服务器

如果在来自客户端的连接期间发生错误，将设置值 errno 并且一个好主意是记录或显示错误消息。，但是阅读手册页，在大多数情况下它是最好的信息来源。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-02T00:59:11.760

如果发生失败，例如由于握手未完成而导致超时，它将返回 -1 并设置 errno。我相信，在查看手册页之后，它会将 errno 设置为 ECONNABORTED。

# c# - 属性网格仅显示某些类别

> ID：706871
> 
> 赞同：2
> 
> 时间：2009-04-01T18:45:44.463
> 
> 标签：c#, .net, propertygrid

我有一个 PropertyGrid 用于具有以下属性类别的对象：样式、计算和杂项

我想要的只是向用户显示 Calcul 类别，但我不想使用 browsable 属性，因为我希望所有这些属性都在 Visual Studio 中可见。

所以，我需要的是一个代码内解决方案。

我使用.Net 3.5 c#

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T18:50:07.467

`PropertyGrid`有一个属性 - `BrowsableAttributes`; 将此分配给您的类别：

```
 propGrid.BrowsableAttributes = new AttributeCollection(
            new CategoryAttribute("Calcul")); 
```

并且（希望）它应该工作。

# wpf - 在主从情况下在两个窗口中绑定控件的最佳方法

> ID：706875
> 
> 赞同：0
> 
> 时间：2009-04-01T18:46:51.560
> 
> 标签：wpf, data-binding, mvvm

假设您有两个窗口，其中一个窗口有一个列表框，而另一个窗口应该有当前在列表框中选择的项目的详细信息。在一个窗口中这很容易做到，但是如何在两个窗口中做到这一点？不幸的是，这里只有两个窗口。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T19:01:01.933

假设它们都是同一个应用程序的一部分，那么必须有某种类型的父容器。

带有列表框的窗口是详细信息窗口的父窗口，或者有一个窗口同时拥有它们。

无论如何，这只是将对象从一个窗口传递到另一个窗口的问题。

例如，您的对象名为 foo，并具有以下参数：fooA、fooB、fooC、fooD。

因此，列表框的数据上下文是一个 observablecollection(of foo)。当用户双击列表框项目之一时，列表框的 selectedItem 是 foo 对象之一。考虑到这一点，您可以通过直接传递 [myWindow.LoadFooForEditing(myFoo)] 或通过向列表框窗口的所有者引发事件并让它传递数据来将其提供给您的详细信息窗口。

如果它们是两个独立的应用程序，那么您需要开始考虑诸如远程处理或 MSMQ 之类的东西作为在两个应用程序之间传递信息的工具。

# asp.net - 如何通过设计器创建类型化数据集

> ID：706879
> 
> 赞同：0
> 
> 时间：2009-04-01T18:47:26.630
> 
> 标签：asp.net, typed-dataset

我需要使用 vs.net 2008 创建一个类型化的数据集。

它不基于数据库表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-02T06:03:44.147

通过添加新项目将数据集添加到项目中。假设您将数据集命名为“myDataSet”。

在设计器模式下打开myDataSet，点击一下，你会发现“ADD”->“DataTable”。

谢谢，拉姆。

# sharepoint - 使用 Team Foundation Server 验证安全设置

> ID：706881
> 
> 赞同：1
> 
> 时间：2009-04-01T18:47:52.993
> 
> 标签：sharepoint, tfs

似乎 TFS 的安全设置有点像噩梦——尤其是当它涉及到 TFS、SharePoint 和 Reporting Services 时。

有没有人知道可以验证安全设置的工具——因为就目前而言，人们无法创建项目，因为 SharePoint 有问题——但所有场管理员和网站集管理员似乎都已设置正确。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T22:42:30.027

要尝试的一件事是使用您用于安装 TFS (tfssetup) 的帐户创建一个登录到 TFS 服务器 (AT) 的新团队项目。

如果这仍然不起作用，那么听起来您可能在 TFS 中错误地设置了 Sharepoint Admin URL。

[如果TFS 2008 Power Tools](http://msdn.microsoft.com/en-us/teamsystem/bb980963.aspx)附带的[TFS 最佳实践分析器](http://msdn.microsoft.com/en-us/teamsystem/bb980963.aspx#bpa)会指出常见的配置问题，您可能想尝试一件事。

您可能还想尝试使用[tfsadminutil ConfigureConnections /View](http://msdn.microsoft.com/en-us/library/bb778396.aspx)命令来查看是否可以在那里看到任何内容。

祝你好运，

马丁。

# php - 重定向用户，然后使用 php 和 mysql 记录他的访问

> ID：706884
> 
> 赞同：3
> 
> 时间：2009-04-01T18:48:47.390
> 
> 标签：php, mysql, redirect, statistics, tracking

我有一个 PHP 重定向页面来跟踪对链接的点击。基本上它是：

```
 - get url from $_GET
 - connect to database
 - create row for url, or update with 1 hit if it exists
 - redirect browser to url using Location: header 
```

我想知道是否可以先将重定向发送到客户端，以便它可以继续工作，然后记录点击。会简单地改变工作吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T19:05:26.150

你可以这样做：

1.  从获取网址`$_GET`
2.  发送`Location:`标头
3.  称呼[`flush()`](http://us3.php.net/flush)
4.  连接到数据库
5.  为 url 创建行，如果存在，则使用 1 次命中进行更新

这不一定会导致浏览器立即继续运行，因为您的连接仍处于打开状态，浏览器对此的处理取决于它，但是（除非导致`flush()`无法工作的条件）它至少会获得`Location:`标头输出到浏览器，以便它可以根据需要进行重定向。

如果这还不够好，我建议将您的数据转储到每分钟或每秒的文件中，然后脚本会选择这些文件进行后处理到数据库中。如果*这*还不够好，你可以玩[`pcntl_fork()`](http://us3.php.net/pcntl_fork); 在 Apache SAPI 下这是一件*非常*麻烦的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T18:55:05.130

大多数数据库使您能够插入延迟查询，因此它只会在数据库空闲时处理。你最有可能这样做......只要数据不重要（如果 mysqld 死掉或 RAM 被刷新，你将丢失查询）。 [http://dev.mysql.com/doc/refman/5.1/en/insert-delayed.html](http://dev.mysql.com/doc/refman/5.1/en/insert-delayed.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T20:30:46.070

没事儿。PHP 将在将重定向标头刷新到客户端之前完成执行。如果您仍有疑问，请尝试将其保存在文件中并从浏览器加载：

```
<?php
header('location: /');
sleep(2);
?> 
```

重定向不应在 2 秒内发生。

# java - 尝试创建 JAXBContext (Jaxb 2.0) 时未处理的异常

> ID：706887
> 
> 赞同：1
> 
> 时间：2009-04-01T18:49:18.573
> 
> 标签：java, jaxb2

我试图让代码超过这一行：

```
JAXBContext jaxbContext = JAXBContext.newInstance("foo.bar.package"); 
```

它抛出了一个异常——这是堆栈跟踪——有什么想法吗？

```
SEVERE: Unhandled exception or error intercepted
java.lang.NoClassDefFoundError: javax/activation/DataSource
at com.sun.xml.bind.v2.model.impl.RuntimeBuiltinLeafInfoImpl.<clinit>(RuntimeBuiltinLeafInfoImpl.java:172)
at com.sun.xml.bind.v2.model.impl.RuntimeTypeInfoSetImpl.<init>(RuntimeTypeInfoSetImpl.java:25)
at com.sun.xml.bind.v2.model.impl.RuntimeModelBuilder.createTypeInfoSet(RuntimeModelBuilder.java:78)
at com.sun.xml.bind.v2.model.impl.RuntimeModelBuilder.createTypeInfoSet(RuntimeModelBuilder.java:41)
at com.sun.xml.bind.v2.model.impl.ModelBuilder.<init>(ModelBuilder.java:97)
at com.sun.xml.bind.v2.model.impl.RuntimeModelBuilder.<init>(RuntimeModelBuilder.java:44)
at com.sun.xml.bind.v2.runtime.JAXBContextImpl.getTypeInfoSet(JAXBContextImpl.java:320)
at com.sun.xml.bind.v2.runtime.JAXBContextImpl.<init>(JAXBContextImpl.java:198)
at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:76)
at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:55)
at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:124)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
at java.lang.reflect.Method.invoke(Unknown Source)
at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:132)
at javax.xml.bind.ContextFinder.find(ContextFinder.java:286)
at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:358)
at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:323)
at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:244) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T18:52:31.470

`activation.jar`您的应用程序中很可能缺少 JAR 文件。编译时必须有此 JAR 可用（除非它是从您正在使用的第 3 方库调用的）。确保此 JAR 位于正确的位置以供应用程序使用。

# delphi - Delphi 的最佳自动更新组件

> ID：706902
> 
> 赞同：6
> 
> 时间：2009-04-01T18:54:44.817
> 
> 标签：delphi, components, auto-update

我正在重写和/或整合我的一堆“应用程序框架”类（基本主窗体、关于框、锁定例程和购买链接、自动更新、数据模块初始化程序等）——基本上，我有一些小的我想要走出门外的潜在共享软件应用程序，并希望尽可能重用代码，以及为以后的应用程序构建框架以节省时间。

在一个应用程序中我有自动更新，我正在使用 LMD 的 WebUpdate，并且对它相当满意，但鉴于我正在重新修改所有内容，我想我会看到关于“最佳方法”的共识是什么这。我不介意为商业付费，也不介意使用开源，如果那是最好的……只是宁愿不重新发明轮子。（我读过：[Delphi：你如何自动更新你的应用程序？](https://stackoverflow.com/questions/277514/delphi-how-do-you-auto-update-your-applications)）

Delphi Win 32 应用程序的最佳自动更新组件是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T05:58:30.613

我使用[TmxWebUpdate](http://www.torry.net/pages.php?id=291)。它是免费、简单且易于定制的。我还拥有带有 TWebUpdate 的 TMS 组件包，但从未真正找到切换的好动机。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-02T08:14:38.357

我使用[TMS Components](http://tmssoftware.com)的 TWebUpdate并且对它非常满意。我没有使用过LMD，所以很遗憾无法提供比较。

TMS 还提供大量其他组件，因此如果您的重写需要任何其他组件，特别是如果您想要一些闪亮的 UI 增强功能（TMS 有一系列 iPhone 风格的组件），那么该网站当然值得一游。

他们在他们的支持论坛中似乎相当活跃（尽管我不需要将它们用于 WebUpdate 组件）并且他们有一个相当定期的发布周期。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T05:36:14.620

我从 Tmssoftware听到了对[TWebUpdate的好评](http://www.tmssoftware.com/site/wupdate.asp)

同样的工作， [torry](http://www.torry.net/pages.php?id=291)也有很多组件，有些是免费的，有些是商业的。

现在什么是最好的？，这取决于您的需求，您已经使用了 LMD 的一个，这是一家很好的公司，我对他们的组件有很好的经验，但从未使用过这个。

如果您需要特定功能，或者您当前正在使用的功能有一些问题，最好列出它们，这样您会得到更好的答案，但很难定义最好的，因为每个人都有不同的体验和意见。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T14:25:06.253

我自己使用 TWebUpdate。它有效，但文档有点有限，有时似乎有点错误。

我研究了 LMD（我有他们的完整组件包），但它似乎比 TWebupdate 更受限制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-17T18:42:41.307

我也在使用 TWebUpdate，并且必须回应 stg 关于支持质量（良好）和文档质量的评论（参差不齐——它很旧，并且并不总是立即反映他们的新功能）。

您还会发现一些强调“自己动手”方法的地方。

请记住，自动更新问题的一部分是您最终创建更新“包”所需的工具。TMS Software 提供了一个可与 TWebUpdate 一起使用的工具，而且做得相当好。就我而言，我“滥用”该组件来处理多个文件，以便我可以刷新其他相关的库、文本文件等。更新构建器工具对此并不是很好。所以有一些手动编辑。但是更新部分效果很好。

我还要提醒您注意 Vista（可能还有 Windows 7）中的更新。写入 Program Files 层次结构中的受保护位置对我来说是个问题。你可能想用你使用的任何组件来检查一下。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-24T11:59:14.607

您是否考虑过 Embarcadero 的[Appwave](http://www.embarcadero.com/products/appwave/resources)。它不是免费的，我不知道价格。

# sql-server - Sql Server 中的索引

> ID：706905
> 
> 赞同：2
> 
> 时间：2009-04-01T18:55:09.433
> 
> 标签：sql-server, indexing, sql-server-2000

什么是聚集索引和非聚集索引？如何使用 sql server 2000 Enterprise manager 对表进行索引？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T19:05:24.823

在 上的`clustered`索引中`ID`，**表行**按 排序`ID`。

在 上的`non-clustered`索引中`ID`，**对表行的引用按**排序`ID`。

我们可以将数据库与`CSV`文件进行比较：

```
ID,Value
-------
1,ReallyReallyLongValue1
3,ReallyReallyLongValue2 
```

在`clustered`表中，当我们插入新行时，我们需要将其挤在现有行之间：

```
ID,Value
-------
1,ReallyReallyLongValue1
2,ReallyReallyLongValue2
3,ReallyReallyLongValue3 
```

，插入速度慢，但检索速度快。

在一个`non-clustered`表中，我们保留一个单独的文件索引文件，用于对我们的行进行排序：

```
Id,RowNumber
------------
1, 1
3, 2 
```

当我们插入新行时，我们只是将它**附加**到我们的主文件并更新短索引文件：

```
ID,Value
-------
1,ReallyReallyLongValue1
3,ReallyReallyLongValue3
2,ReallyReallyLongValue2

Id,RowNumber
------------
1, 1
2, 3
3, 2 
```

，插入速度很快，但检索效率较低。

在实际数据库中，索引使用更高效的二叉树，但原理保持不变。

**聚集索引在 上更快`SELECT`，非聚集索引在 上更快`INSERT / UPDATE / DELETE`**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:58:24.573

聚集索引意味着行按该索引中的值进行物理排序。非聚集索引意味着索引表保持最新，允许基于值快速查找和排序，但不对行进行物理排序。

一个表只能存在一个聚集索引，如果存在主键，那么它就是聚集索引（在 SQL Server 中）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T19:04:09.723

聚集索引定义了实际表的存储方式。这些行的存储方式可以快速搜索聚集索引中的字段。（它们不是按索引字段的排序顺序物理存储的，而是存储在[二叉树](http://en.wikipedia.org/wiki/Binary_tree)或类似的东西中。）

每个表只能有一个聚集索引。聚集索引包含表中的所有字段，例如：

```
 indexfield1 - indexfield2 - field2 - field3 - .... 
```

非聚集索引就像一个单独的表。它包含索引中的字段，以及对表中字段的引用。例如：

```
 secondindexfield1 - secondindexfield2 - reference to table row 
```

搜索非聚集索引时，SQL Server 将在索引中查找值，对表执行“书签查找”，并从那里检索其他行字段。这就是为什么非聚集索引的性能比聚集索引稍差的原因。

要在 SQL Server Management Studio 中添加索引，请在对象视图中展开表节点。右键单击“索引”并选择“新索引”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T19:16:45.420

*   聚集索引：每个表只允许一个聚集索引。如果索引是聚集的，则意味着聚集索引所基于的表是根据该索引进行物理排序的。想想百科全书的页码。

*   非聚集索引：每个表可以有许多非聚集索引。想想书后面的关键字索引。

# javascript - Jquery：在您键入时过滤下拉列表

> ID：706906
> 
> 赞同：37
> 
> 时间：2009-04-01T18:55:29.497
> 
> 标签：javascript, jquery, jquery-plugins

我使用了一个原型插件，它在您键入时过滤下拉列表的内容。因此，例如，如果您在文本框中键入“cat”，则只有包含子字符串“cat”的项目将作为选项留在下拉列表中。

有谁知道可以做到这一点的jquery插件？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-05-10T12:42:47.407

我只是在寻找类似的东西，而我需要的最好的东西似乎是[JQuery UI MultiSelect](http://www.quasipartikel.at/multiselect/)。它将多选框变成一个非常漂亮的双列表视图，并在主列表上进行实时过滤。

**编辑：新的发展！**

> “ [Chosen](http://harvesthq.github.com/chosen/)是一个 JavaScript 插件，它使长而笨重的选择框更加用户友好。它目前在 jQuery 和 Prototype 两种风格中都可用。”

在可预见的将来，我将在所有选择使用项目中完全使用[Chosen 。](http://harvesthq.github.com/chosen/)

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2012-04-13T22:19:41.210

[Select2](http://ivaynberg.github.com/select2/)是 Chosen 的一个相当新的分支，并具有更多的功能（例如 AJAX + 用于单个项目的自定义 HTML）。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-01T19:24:53.793

几年前我写[了一个小脚本来做到这一点。](http://andrew.hedges.name/experiments/narrowing/)很可能，它可以很容易地打包为一个 jQuery 插件。不客气。

如果您想查看那里的代码，我也会在我的[PHP 函数参考仪表板小部件中执行此操作。](http://andrew.hedges.name/widgets/#phpfr)

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-01T19:02:11.337

检查这些插件：

*   [性感组合](http://plugins.jquery.com/project/SexyCombo)
*   [快速选择](http://plugins.jquery.com/project/quickselect)
*   [下拉列表过滤器](http://plugins.jquery.com/project/droplist_filter)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-01T19:00:50.043

jQuery[自动完成](http://docs.jquery.com/Plugins/Autocomplete)插件

编辑：我最初链接到错误的自动完成插件。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-01-11T12:24:30.903

```
$(document).ready(function() {
  $("#myInput").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#filter *").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<h2>Filter</h2>
<input id="myInput" type="text" placeholder="Search..">
<br><br>
<div class="filter-by">
  <span>Filter by:</span>
  <select class="status-filter" id="filter">
    <option value="">All</option>
    <option value="paid">Paid</option>
    <option value="accepted">Accepted</option>
    <option value="pending">Pending</option>
    <option value="rejected">Rejected</option>
    </select>
</div>
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-14T06:37:20.243

尝试基于实际选择框并在选项文本中间匹配的“jquery 选项过滤器”：http: [//plugins.jquery.com/project/jquery_options_filter](http://plugins.jquery.com/project/jquery_options_filter)

为自我主义

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-12-31T15:56:24.433

我只是快速而肮脏地实现了这个功能。它使用一些全局变量，您可能希望改进实现以删除这些变量。

这里的“#xsca_member_filter”是作为文本输入的过滤器，“#members”是选择输入。

```
$('documenet').ready(function(){
    init();
   $('#xsca_member_filter').keyup(function(){
       filter($(this));
   });
});

//save all available options with their values and the empty option.
init = function(){
    options = new Object();
    $('#owner option').each(function(){
        var obj = $(this);
        if(obj.attr("value") != "")
            options[obj.attr('value')] = obj.html();
        else
            emptyOption = obj.html();
    });
    selObj = $('#owner');
};

filter = function(elem){
    var filter = elem.val();
    var selected = $('#owner option:selected').val();

    //delete all options and add the empty option
    selObj.html("");
    selObj.append("<option> "+emptyOption+" </option>");

    //add all options conaining the filter string
    for(value in options){
        var option = options[value];
        if((options[value]).indexOf(filter) != -1){
            selObj.append("<option value='"+value+"'> "+options[value]+" </option>");
        }
    }

    //select the previously selected option
    $("#owner option[value = '"+selected+"']").prop("selected", true);
} 
```

# c++ - 无法转换函数指针参数

> ID：706908
> 
> 赞同：0
> 
> 时间：2009-04-01T18:55:38.903
> 
> 标签：c++, templates, function-pointers, v8

我得到的错误：

```
error C2664: 'v8::FunctionTemplate::New' : cannot convert parameter 1 from 'v8::Handle<T> (__cdecl *)(const v8::Arguments &)' to 'v8::InvocationCallback' 
```

相关定义：

```
typedef Handle<Value> (*InvocationCallback)(const Arguments& args);

template<class C> class V8ScriptClass
{
public:
    template<class C, typename Rtype, typename Ptype1, Rtype (C::*FuncPtr)(Ptype1)> 
    void RegisterFunc(const char* const scriptname)
    {
        objtemplate->Set(
            v8::String::New(scriptname), 
            v8::FunctionTemplate::New(
            V8ScriptClass<C>::RelayCallback<C, Rtype, Ptype1, FuncPtr>
                ));
    };

template<typename Rtype, typename Ptype1, Rtype (*FuncPtr)(Ptype1 param1)>
static v8::Handle<v8::Value> RelayCallback(const v8::Arguments& args)
{
    std::cerr<<__FUNCTION__<<std::endl;
    v8::HandleScope handle_scope;
    return handle_scope.Close(toJSType( ((FuncPtr)(toCType(args[0]))) ));
}; 
```

在我看来 typedef 和实际的函数签名是相同的。

编辑：忘记了一个声明：

```
class EXPORT FunctionTemplate : public Template {
 public:
  /** Creates a function template.*/
  static Local<FunctionTemplate> New(
      InvocationCallback callback = 0,
      Handle<Value> data = Handle<Value>(),
      Handle<Signature> signature = Handle<Signature>()); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T20:27:45.873

我发现了错误。RelayCallback 模板将静态函数指针作为参数，我尝试使用成员函数指针对其进行实例化。我只需要将其更改为成员函数指针模板参数。

# internet-explorer - 如何让 Web 浏览器将所有活动（包括请求、响应、cookie 活动）记录到我可以检查的日志文件中？

> ID：706909
> 
> 赞同：3
> 
> 时间：2009-04-01T18:56:00.900
> 
> 标签：internet-explorer, http, logging, browser, instrumentation

我正在调试 Web 应用程序中的会话不匹配问题。涉及多个服务器，用户在它们之间传递，同时持有会话令牌和 cookie。

协调点是浏览器。我想详细了解浏览器正在采取什么行动，基本上相当于服务器日志的客户端。了解 HTTP 请求的详细信息（包括发送的标头、响应的详细信息以及浏览器为影响请求或响应结果而采取的任何操作（例如，对重定向执行操作））将很有用.

我无法获得各种服务器组件的所有源代码，因此我无法检查源代码以获取有关如何处理会话令牌的线索。证据就在布丁中：浏览器观察到的行为将是毫无疑问的答案。

因为涉及的服务器都使用 SSL 连接，所以恐怕我无法在数据包转储级别跟踪这一点。

如何检测浏览器（最好是 IE）来记录此级别的请求和响应详细信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T19:05:29.550

[提琴手](http://www.fiddler2.com/fiddler2/)是另一种选择

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T18:57:38.447

*   使用**[HttpWatch Pro](http://www.httpwatch.com/)**工具。它可以将日志保存到文件中。稍后，用户可以将此日志文件发送给管理员进行分析。它还可以比较这些日志 - 您可以将一个用户的日志与另一个用户的日志进行比较并轻松发现问题。（顺便说一句，基本版是免费的，专业版可以使用 30 天）

*   **[Fiddler](http://www.fiddler2.com/fiddler2/)**是一个免费的替代品。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T08:05:02.837

Http Watch 的基础版非常有限，它在大多数情况下不显示标题，它没有那么有用。

Fiddler 是一个更好的选择。

[IEWatch](http://iewatch.com)是该类别中的另一个工具，但它不是免费软件

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-09T11:07:28.157

我用查尔斯有一段时间了...

[http://www.charlesproxy.com/](http://www.charlesproxy.com/)

“Charles 是一个 HTTP 代理 / HTTP 监视器 / 反向代理，它使开发人员能够查看他们的机器和 Internet 之间的所有 HTTP 和 SSL / HTTPS 流量。这包括请求、响应和 HTTP 标头（其中包含 cookie 和缓存）信息）。”

它适用于 FF、CHROME 和 IE 以及 Mac、Linux 和 Windows，如果您设置了证书，甚至可以将 SSL 代理作为中间人 HTTPS 服务...

[http://www.charlesproxy.com/documentation/proxying/ssl-proxying/](http://www.charlesproxy.com/documentation/proxying/ssl-proxying/)

这是一个 30 天的试用期，只要您准备好时不时地等待 5 秒 ;-)

# c# - 在gridview中设置boundcolumn宽度不起作用

> ID：706913
> 
> 赞同：1
> 
> 时间：2009-04-01T18:57:37.323
> 
> 标签：c#, asp.net

我有一个可以显示两个不同报告的报告页面。所以我有一个 GridView，我的 aspx 页面上没有列。我在按钮单击事件处理程序中将 4 个 BoundFields 添加到 GridView。第一列是我需要为其中一个报告设置宽度的列（我用来添加此列的代码如下）。

```
gvReport.Columns.Clear();  
BoundField bf1 = new BoundField();  
...  
if (ddReportType.SelectedValue == "full") {  
bf1.HeaderText = "Facility";  
bf1.DataField = "Facility";  
bf1.ItemStyle.Wrap = true;  
bf1.ItemStyle.Width = 150;  
bf1.Visible = true;  
gvReport.Columns.Add(bf1);  
... 
```

问题是这一列中有一行具有 SHA512 哈希值。由于中间没有空间，gridview 不会包装它（我认为这就是正在发生的事情，无论如何）！所以我想我会在 OnRowDataBound 事件中捕获此列，并在哈希中间添加一个空格，以便它可以换行，但我不知道如何引用 BoundField。没有 ID 属性。有人有建议吗？关于如何引用 BoundField 或另一种方法来很好地显示它？

我最初在 aspx 文件中有列，并尝试使用：
gvReport.Columns[0].ItemStyle.Width = 150;
gvReport.Columns[0].ItemStyle.Wrap = true;

但这也没有用。这非常令人沮丧！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T20:50:04.650

所以我们选择了 C 计划。我从来没有弄清楚如何引用 BoundField。我们通过在标记中创建两个 GridView 并更改哪个是可见的来解决这个问题。为了解决文本不换行的问题，我们在 OnRowDataBound 事件处理程序中捕获它并检查文本的长度。我们只是在中间插入一个空格，瞧！它包裹！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T21:57:51.740

BoundField 是错误的。它更像是一个定义。稍后，当绑定或创建行时，您将处理行、单元格和数据项。

你可以这样做：

```
protected void grid_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        string value = e.Row.Cells[1].Text;
        if (!string.IsNullOrEmpty(value))
            e.Row.Cells[1].Text = value.Insert(value.Length / 2, " ");
    }
} 
```

其中 Cell[1] 是包含 long 值的列。在同一个地方，您可以使用 e.Row.DataItem 来获取实际数据，但是您需要知道它的类型。

您可以创建模板字段并绑定到表达式或使用其子项的数据绑定事件来执行相同操作。

此外，如果您使用的是 DataSet，您可以设置计算字段并绑定到它。反正...

# c++ - 设置应用程序图标的问题

> ID：706921
> 
> 赞同：8
> 
> 时间：2009-04-01T18:59:17.910
> 
> 标签：c++, visual-studio-2008, icons

（我使用的是 Visual Studio 2008，但我记得旧版本也有类似的问题。）

我尝试了几种不同的方法（其中许多在[另一个问题](https://stackoverflow.com/questions/320677/how-do-i-set-the-icon-for-my-application-in-visual-studio-2008)中提到），但我仍然遇到一些奇怪的问题：

1.  当包含一个图标作为资源时，它会立即显示为可执行文件的图标，但是要让图标显示在任务栏上，我必须重新启动计算机。在那之前，它会继续显示为之前的图标。清理解决方案，重新启动 VS，没有任何效果。不是一个真正的大问题，因为它不会影响已发布的 exe，但很高兴知道它将旧图标缓存在哪里以及如何摆脱它。

2.  无论我做什么，alt-tabbing 时显示的图标都是默认的应用程序图标（方形和白色和通用）。这包括在可执行文件中嵌入图标，以及`ICON_BIG`使用`WM_SETICON`.

至于第二件事，我的代码看起来像：

```
 hIcon = (HICON)(
      LoadImage( NULL, szFilename, IMAGE_ICON, 32, 32, LR_LOADFROMFILE ) );
   if( hIcon )
      SendMessage( hWnd, WM_SETICON, ICON_BIG, (LPARAM)hIcon ); 
```

但是，发送后`WM_SETICON`，`GetLastError()`返回 6，“句柄无效。”。 `hWnd`是一个有效的窗口句柄，并且`hIcon`似乎是一个有效的图标句柄。我已经尝试寻找`WM_SETICON`可能导致该错误的原因，并且至少要弄清楚它认为哪个句柄无效，但还没有运气。我在调用之前立即清除了错误代码`SendMessage()`，因此必须在处理消息的某个地方设置它。

我尝试了另一种方法，从 exe 本身加载图标，其中资源的 ID 是`101`（它是第一个也是唯一包含的资源）：

```
 hIcon = (HICON)(
      LoadImage( GetModuleHandle( NULL ), MAKEINTRESOURCE( 101 ),
      IMAGE_ICON, 48, 48, 0 ) );
   if( hIcon )
      SendMessage( hWnd, WM_SETICON, ICON_BIG, (LPARAM)hIcon ); 
```

...但同样的事情也会发生；调用后`SendMessage()`，`GetLastError()`给出相同的错误状态。

我尝试了不同的尺寸（例如 48x48，所有这些都存在于图标文件中），但没有不同的效果。我知道它肯定会查找和加载图像，因为如果我指定不存在的大小或无效的资源 ID 或错误的文件名（取决于我加载它的方式），它会在很久以前就失败了`SendMessage()`。

奇怪的是，如果我指定`ICON_SMALL`而不是`ICON_BIG`，则调用成功且没有错误状态，但是从[docs](http://msdn.microsoft.com/en-us/library/ms632643.aspx)中，我需要使用`ICON_BIG`来设置在 alt-tabbing 时使用的图标。此外，如果我使用`ICON_BIG`但加载 16x16 图标，我不会收到错误状态，但没有任何变化。

关于可能导致`WM_SETICON`失败的任何想法？我发布的任何代码有什么严重错误（除了格式/样式/转换问题，因为它被简化为基础知识）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-27T17:00:50.127

我重新审视了这个，看看我是否可以结束我的问题。仅通过将应用程序的图标嵌入到可执行文件中，我无法让应用程序的图标显示在 alt-tab 列表中；它会显示在任务栏中，作为资源管理器中的文件图标，在其他地方就好了。

我想我会尝试一些更简单的方法来手动设置图标，然后`LoadIcon()`改用，如下面的代码所示：

```
HICON hIcon = LoadIcon( GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_ICON1) );
if( hIcon )
{
   SendMessage( GetHandle(), WM_SETICON, ICON_BIG, (LPARAM)hIcon );
   DestroyIcon( hIcon );
}
// ... Same for ICON_SMALL 
```

这似乎成功了。我真的不知道为什么，但到目前为止，这是唯一有效的变化。这真的不是我应该花更多时间处理的问题，所以我会继续这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-18T00:52:48.043

好的，这对我来说是一种享受：

```
HICON hIconSmall =(HICON)LoadImage(handleToYourApplicationInstance, MAKEINTRESOURCE(IDI_ICON1), IMAGE_ICON,16, 16, 0);

HICON hIconLarge =(HICON)LoadImage(handleToYourApplicationInstance, MAKEINTRESOURCE(IDI_ICON1), IMAGE_ICON,256, 256, 0); // Big for task bar, small loaded otherwise.

SendMessage(yourWindowHandle, WM_SETICON, ICON_SMALL, (LPARAM)hIconSmall) ;

SendMessage(yourWindowHandle, WM_SETICON, ICON_BIG, (LPARAM)hIconLarge) ; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-01T20:13:26.733

我使用了一个具有多种分辨率的 .ico 文件 16x16、32x32、48x48、96x96 没有问题，作为应用程序图标。然后窗户会选择正确的尺寸。

Windows shell 有一个[图标缓存](http://www.geocities.com/SiliconValley/4942/iconcache.html)，有一个[技巧](http://blogs.msdn.com/jeffdav/archive/2004/07/22/191636.aspx)可以重新启动它，而无需从当前会话重新启动或注销，或者从任务管理器中杀死 explorer.exe。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-02-28T16:23:37.667

对于遇到同样困难的任何人，如果您要更改 ICON_BIG，您必须首先发送带有 ICON_SMALL 的 WM_SETICON，然后继续进行 ICON_BIG。

例如：

```
SetLastError(0);
SendMessage(windowHandle, WM_SETICON, ICON_SMALL, (LPARAM)iconsmallHandle);
[do error handling]
SetLastError(0);
SendMessage(windowHandle, WM_SETICON, ICON_BIG, (LPARAM)iconbigHandle);
[do error handling] 
```

您需要在第一个 SendMessage 之后使用 SetLastError 来清除任何返回的错误。

如果您只是设置 ICON_SMALL，则可以忽略 ICON_BIG。无论出于何种原因，在我的所有测试中，无论该图标是否需要更改，都必须在尝试更改 ICON_BIG 之前设置 ICON_SMALL，否则您将始终得到错误代码 0x6（无效句柄）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-06T09:41:11.230

如果为我找到解决方案。我创建了一个不可见的 CFrameWnd 应用程序窗口，然后创建了几个其他主窗口（它们是对话框窗口）。神奇的无证规则是：您必须更改第一个创建的 CFrameWnd 中的大图标。虽然每个窗口都有自己的 ICON_BIG 实例，但它不使用它们。因此，似乎不可能在一个应用程序中为不同的窗口显示不同的任务栏图标。

# c# - Convert.FromBase64String()

> ID：706924
> 
> 赞同：0
> 
> 时间：2009-04-01T19:00:16.660
> 
> 标签：c#, asp.net, serialization, encryption, storage

Q1 - 如果字符“C”被保存到视图状态中，那么就在呈现页面之前，Asp.Net 将“C”（连同其他数据）序列化为 Base64 字符串。如果在回发时，我发出以下代码：

```
protected void Page_Load(object sender, EventArgs e)
{
     TextBox1.Text = "ABCDEF";
     if (IsPostBack)
     {
          string viewStateString=Request["__VIEWSTATE"];

          byte[] stringBytes = Convert.FromBase64String(viewStateString);

          for (int i = 0; i < stringBytes.Length; i++)
          {
              if(stringBytes[i] == 67)
                    Label1.Text = ”deserialization successful”; 
          }               
     }
 } 
```

，然后 FromBase64String() 应该将序列化数据转换回其原始格式。因此，“stringBytes”字段之一应包含十进制值 67（表示 ASCII 字符 C）。但似乎并非如此。任何想法我做错了什么？

Q2 - 由于 String 表示一组 Unicode 字符，我假设在上面的示例中，当“ABCDEF”从视图状态反序列化时，“ABCDEF”字符串中的每个字符都由“stringBytes”数组的两个元素表示？

再见

编辑：

我必须为没有提到我确实在 Page 标记中将 enableViewStateMac 设置为 false 表示歉意，但它仍然不起作用

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T19:01:46.767

除了 Base64 编码之外，ASP.NET 还会加密该数据。如果您在不解密的情况下对其进行解码，您将无法获得初始值。

# visual-studio - Visual Studio 2008 宏在头文件和源文件之间切换？

> ID：706938
> 
> 赞同：8
> 
> 时间：2009-04-01T19:04:45.450
> 
> 标签：visual-studio, visual-studio-2008, shortcuts

有谁知道如何制作宏或在 foo.hpp 和 foo.cpp 之间切换的东西？我真的很感激有这样的宏。我想如果它实际上打开了相应的文件，但将旧文件保留在选项卡中，这会有所帮助。

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-01T19:10:33.250

也许以下一项（或组合）会对您有所帮助：

*   [在 .NET 中的头文件和 CPP 文件之间切换](http://www.codeproject.com/KB/macros/h_cpp_switcher.aspx)（codeproject 中的宏）
*   [在 VS.NET 中的头文件和 impl 文件之间切换](http://www.robertwrose.com/2005/06/switch-between-header-and-impl-files.html)（描述如何创建宏并将其绑定到键）
*   [在 C++ 源文件和头文件之间切换](http://www.codeguru.com/cpp/v-s/devstudio_macros/codenavigation/article.php/c14759)（来自 codeguru 的最新宏）
*   [在头文件和 CPP 文件之间切换](http://www.codeguru.com/cpp/v-s/devstudio_macros/article.php/c3093)的宏（来自 codeguru 的旧宏）
*   **[在 Google 上找到的其他几种解决方案...](http://www.google.com/search?q=visual%20studio%20macro%20switch%20header)**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T19:18:33.497

为什么不使用右键单击> 转到声明 | 去定义？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-16T23:23:02.640

在 Visual Studio 2013 中，它被添加为 Ctrl + K、Ctrl + O

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-11T19:38:17.047

在大型项目中，一些选项对我来说运行缓慢。这个不在其他文件夹中查找，但运行速度更快，应该可以满足大多数需求： [在 .cpp 和 .h 文件之间切换](http://www.alteridem.net/2008/02/26/visual-studio-macro-to-switch-between-cpp-and-h-files/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-04T09:47:32.003

您可以尝试使用“Switch”——这是一个在源文件和头文件之间切换的插件，还允许您在其他类型的相关文件之间切换——XAML 和代码隐藏、设计器和代码等。 [切换](http://visualstudiogallery.msdn.microsoft.com/e50c0328-97a1-4842-8821-f0a82640245a)

# tcl - 期待补充

> ID：706947
> 
> 赞同：2
> 
> 时间：2009-04-01T19:06:12.590
> 
> 标签：tcl, expect

我最近一直在期待，我一生都无法弄清楚如何对我传入的变量执行简单的加法。有人知道怎么做吗？另外，是否有不错的 Expect 在线参考资料？我试过用谷歌搜索，结果非常有限。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-01T19:22:11.303

关于 Expect 需要记住的一点是，它实际上只是 Tcl 的一个扩展，所以如果您正在寻找有关编写 Expect 脚本的帮助并且您的问题与 Expect 特定命令之一无关，您应该尝试查看 Tcl 参考资料。一个好的起点是[http://www.tcl.tk](http://www.tcl.tk)以及[http://wiki.tcl.tk](http://wiki.tcl.tk)。

有两种方法可以做你想做的事情： `incr`和`expr`. `incr`可以在将整数值添加到另一个整数时使用。该操作非常快。例如：

```
set value 1
incr value 
```

但是，`incr`它不适用于非整数值，并且除了加法（或减法，如果您否定增量，如 ）之外什么也做不了`incr value -1`。如果您需要更详细的内容，则应使用`expr`：

```
set value 1
set value [expr {$value + 1}] 
```

注意在表达式周围使用花括号！虽然它们通常不是正确操作所必需的，但它们可以提高性能。如果您正在执行许多算术运算，则在表达式周围使用大括号将显着提高脚本的性能。有关详细信息，请参阅[http://wiki.tcl.tk/10225](http://wiki.tcl.tk/10225)。你应该养成*在*使用`expr`.

[您可以在http://wiki.tcl.tk/201](http://wiki.tcl.tk/201)找到多个 Expect 资源的链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T19:13:21.310

啊，好吧，我想通了：

设置计数 [expr $count+1]

这将 1 添加到 count 变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T19:10:56.807

我将从[官方网站](http://expect.nist.gov/)开始。

# c# - ASP.NET 服务器.执行

> ID：706948
> 
> 赞同：1
> 
> 时间：2009-04-01T19:06:39.377
> 
> 标签：c#, asp.net

我在使用 Server.Execute 时遇到了一些问题，我似乎找不到任何详细信息。

```
Page page = new WidgetProcessor(Widget);
Server.Execute(page, htmlTextWriter, true); 
```

上面代码中的 Widget 是一个简单的对象，它知道如何实例化一个用户控件。WidgetProcessor 接受一个小部件并将小部件控件添加到页面。这在初始加载时效果很好，但是它似乎无法处理回发；它实际上从未触发用户控件事件，它只是始终如一地返回原始页面，就好像您从未回发过一样。

我[从 2003 年就找到了这篇文章](http://support.microsoft.com/kb/817036)，尽管我认为他们现在已经解决了这个问题。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T22:40:57.567

我猜测，由于您正在向页面动态添加控件，因此它们没有在正确的时间注册到视图状态，因此会丢失。使用动态控件时，您必须重新添加具有相同 id 的控件，以便它们被拾取并因此可以注册回发。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T22:46:26.180

您需要在 Page_Load 运行之前加载控件。OnInit 通常是它完成的地方。这意味着控件将在 ASP.NET 打开 ViewState 跟踪更改之前注册。打开更改跟踪（就在触发 Page_Load 之前）对该控件的 ViewState 的所有更改都将被视为脏，因此初始值和更改后的值之间没有区别。此外，如果在打开更改跟踪后加载控件，则 ViewState 引擎将无法判断回发时值是否已更改，因为它没有要比较的原始值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-14T17:39:01.987

使用 Server.Execute 时，会将 URL 作为参数传递给它，并且控件会移动到这个新页面。代码的执行发生在新页面上。一旦代码执行结束，控件将返回到初始页面，就在它被调用的位置之后。然而，在 Server.Transfer 的情况下，它的工作原理非常相似，不同之处在于执行停止在新页面本身（意味着控件不会返回到调用页面）。在这两种情况下，浏览器中的 URL 仍然是第一页 URL（不会刷新到新页面 URL），因为没有请求浏览器这样做。

# c# - 互斥存储过程

> ID：706949
> 
> 赞同：3
> 
> 时间：2009-04-01T19:06:40.780
> 
> 标签：c#, sql-server, concurrency, distributed, mutual-exclusion

我想使用数据库表创建一些分布式互斥。在存储过程上有以下接口会很好：

等待（唯一标识符）

我最初是想通过一个唯一标识符表来实现这一点。对该过程的调用将一直等到表中不存在唯一标识符。但是，我不确定当从表中删除指定的唯一标识符时如何使调用线程唤醒。

有任何想法吗？如果数据库不是执行此操作的正确位置，是否有任何第三方工具可以工作（最好是开源的）？

（为了避免死锁，我要么想在等待操作中包含一个超时，要么让 SqlCommand 有一个超时）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T19:10:59.863

看一下系统存储过程：

```
 sp_getapplock 
```

它可以帮助您完成您正在尝试做的事情。

[http://msdn.microsoft.com/en-us/library/ms189823.aspx](http://msdn.microsoft.com/en-us/library/ms189823.aspx)

你可以把它放在一个参数化唯一标识符的过程中......

```
BEGIN TRAN

DECLARE @result int

EXEC @result = sp_getapplock @Resource = 'YOUR_uniqueidentifier_HERE', 
                             @LockMode = 'Exclusive',
                             @LockTimeout = 90

IF @result NOT IN ( 0, 1 )   -- Only successful return codes
BEGIN
  PRINT @result
  RAISERROR ( 'Lock failed to acquire...', 16, 1 )
END 
ELSE
BEGIN
    -- DO STUFF HERE 
END
EXEC @result = sp_releaseapplock @Resource = 'YOUR_uniqueidentifier_HERE'  

COMMIT TRAN 
```

# c# - 平稳移动以通过大气层上升

> ID：706952
> 
> 赞同：1
> 
> 时间：2009-04-01T19:09:39.073
> 
> 标签：c#, math, .net-3.5, virtual-earth

我正在使用 Microsoft Virtual Earth 3D 在大气层中移动，我可以顺利下降，但我不知道如何顺利​​上升。

我是这样下降的：

```
for(int curAlt = startAlt; curAlt < endAlt; curAlt--){
    //do something
    curAlt -= curAlt/150
} 
```

这通过越接近地球（低海拔）减小跳跃的大小来起作用。我需要一个可以做类似的解决方案，只是相反，同时仍将较小的跳跃保持在较低的高度。

我怎样才能做到这一点？或者我正在做的事情是不可接受的，应该以不同的方式做（比如用对数）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-01T19:40:19.683

更好的解决方案可能是使用像[Logistic 函数这样的函数](http://en.wikipedia.org/wiki/Logistic_function)。

```
Double minAlt = 0.0;
Double maxAlt = 500000.0;

Int32 numberSteps = 1000;

Double boundary = +6.0;

for (Int32 step = 0; step < numberSteps; step++)
{
   Double t = -boundary + 2.0 * boundary * step / (numberSteps - 1);
   Double correction = 1.0 / (1.0 + Math.Exp(Math.Abs(boundary)));
   Double value = 1.0 / (1.0 + Math.Exp(-t));
   Double correctedValue = (value - correction) / (1.0 - 2.0 * correction);
   Double curAlt = correctedValue * (maxAlt - minAlt) + minAlt;
} 
```

因为当前高度是明确计算的，所以您不必依赖引入各种精度相关误差的迭代计算。

请参阅示例代码以了解如何调整函数形状。

* * *

这是一个显示该函数的示例控制台应用程序。您可以稍微调整一下参数以了解行为。

```
using System;

namespace LogisticFunction
{
    class Program
    {
        static void Main(string[] args)
        {
            Double minAlt = 5.0;
            Double maxAlt = 95.0;

            Int32 numberSteps = 60;

            // Keep maxAlt and numberSteps small if you don't want a giant console window.
            Console.SetWindowSize((Int32)maxAlt + 12, numberSteps + 1);

            // Positive values produce ascending functions.
            // Negative values produce descending functions.
            // Values with smaller magnitude produce more linear functions.
            // Values with larger magnitude produce more step like functions.
            // Zero causes an error.
            // Try for example +1.0, +6.0, +20.0 and -1.0, -6.0, -20.0
            Double boundary = +6.0;

            for (Int32 step = 0; step < numberSteps; step++)
            {
                Double t = -boundary + 2.0 * boundary * step / (numberSteps - 1);
                Double correction = 1.0 / (1.0 + Math.Exp(Math.Abs(boundary)));
                Double value = 1.0 / (1.0 + Math.Exp(-t));
                Double correctedValue = (value - correction) / (1.0 - 2.0 * correction);
                Double curAlt = correctedValue * (maxAlt - minAlt) + minAlt;

                Console.WriteLine(String.Format("{0, 10:N4} {1}", curAlt, new String('#', (Int32)Math.Round(curAlt))));
            }

            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T19:33:28.733

顺便说一句，你真的应该让提升时间依赖（帧率感知）。这里的所有答案都取决于在特定时间间隔调用的代码；事实并非如此。如果某个过程启动，Virtual Earth 会以某种方式承受压力，如果您将 Virtual Earth 最小化，或者如果发生影响 Virtual Earth 性能的事情，那么运动将不会是平稳的。即使虚拟地球“没有”发生任何事情，有时您的 3D 卡也会停止，这意味着您可能每隔一段时间就会跳一次。

特别是如果用户关闭了垂直同步，你会遇到一些非常讨厌的事情：

*   在慢速机器上，提升将永远持续（即使 VSync 开启）。
*   在快速机器上，它会非常快，你甚至可能不会注意到它。

在你的课堂上：

```
private int lastTime; 
```

在您的循环/事件中：

```
if(lastTime == 0)
{
    lastTime = Environment.TickCount;
    return;
}

int curTime = Environment.TickCount; // store this baby.
int timeDiff = lastTime - curTime;

if(timeDiff == 0)
   return;

curAlt += (maxAlt - curAlt) * timeDiff / (150000); // TickCount reports
                                                   // time in Ticks
                                                   // (1000 ticks per second)

lastTime = curTime; 
```

如果你想变得花哨，你可以从 DX SDK 插入代码。Environment.TickCount 的分辨率为 15 毫秒（因为我检查 timeDiff 是否为零，因为它很容易为零）。托管 DX SDK 示例框架有一个名为 DxTimer（或排序）的类，它具有更好的分辨率。

[有一篇文章使用了相同的 API](http://www.kalme.de/index.php?option=com_content&task=view&id=18&Itemid=26&limit=1&limitstart=1 "文章")。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T19:16:55.310

这取决于你想通过平稳上升来实现什么。您可以将高度限制为某个最大值 maxAlt 并以与地面相同的方式平滑地接近该值。

```
curAlt += (maxAlt - curAlt) / 150 
```

但是如果最大高度是无限的，你必须明确你到底想要什么是平滑的。

另请注意，您的代码仅适用于某些副作用。你接近一个无限循环。我建议如下。

```
epsilon = 0.1; // A small value that fits your needs

curAlt = startAlt;

while (curAlt > endAlt + epsilon)
{
   curAlt -= (curAlt - endAlt) / 150;
} 
```

curAlt -= (curAlt - endAlt) / 150 的迭代在理论上永远不会到达 endAlt，实际上最多只能通过路由错误。您的代码之所以有效，是因为您每次迭代都会减去一个额外的高度单位。我不确定这是设计使然还是防止错误的错误。添加 epsilon 阈值以更合乎逻辑的方式打破循环。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T21:23:55.037

既然您使用 curAlt -= curAlt/150 进行降序，为什么不使用 curAlt += curAlt*150 进行升序呢？

# delphi - Delphi Win32 的最佳共享软件锁

> ID：706958
> 
> 赞同：9
> 
> 时间：2009-04-01T19:10:58.273
> 
> 标签：delphi, components, drm, copy-protection, shareware

与我上一个问题相同的介绍：

我正在重写和/或整合我的一堆“应用程序框架”类（基本主窗体、关于框、锁定例程和购买链接、自动更新、数据模块初始化程序等）——基本上，我有一些小的我想要走出门外的潜在共享软件应用程序，并希望尽可能重用代码，以及为以后的应用程序构建框架以节省时间。

但不同的问题：:)

Delphi Win 32 应用程序的最佳共享软件锁定组件是什么？（如果那是最好的，我不介意为商业付费）。

澄清 - 是的，最好的许可证密钥验证/锁定 + 试用软件组件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-01T19:41:36.703

没有有效的方法来锁定应用程序，期间。您可以让用户在没有您的有效许可的情况下更难使用该程序，冒着产生漏报的风险，这在互联网时代很快就会成为公关噩梦。

有两种方法可以做到这一点。您可以在软件中创建某种内置的 DRM 锁。对于一些有才华的黑客来说，这些都不需要时间进行逆向工程。（最好的往往持续大约 1 个月。）或者您可以创建一个验证系统，要求程序连接到服务器。这些更难破解，但往往存在严重的假阴性问题，如果您的服务器出现故障，您所有的付费客户都会陷入困境。最后，两者都不是一个好的解决方案。

长话短说，如果你想制作一个可以盈利的程序，就让它的质量足够高，人们愿意为它买单，然后把它[推销给那些愿意购买软件而不是偷窃它的人。](http://draginol.joeuser.com/article/303512/Piracy_PC_Gaming) 就是没有捷径可走。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-25T12:27:06.247

我通过将数据记录附加到我编译的应用程序的末尾来创建一个**“自我修改”的 EXE 。**我的应用程序做的第一件事是从计算机内存中获取机器 ID 和 bios 日期。然后，我会将这些与存储在附加数据记录中的机器 ID 和 bios 日期进行比较。寻求结束...备份 XX 个字节...读取结束。

这很好用。如果好友将程序传递给朋友，但它无法识别机器 ID 或 bios 日期并恢复为试用版。当他们成功输入密钥时，我将使用该机器用户信息更新附加记录。

然后诺顿开始将我的软件标记为病毒，因为它是一个自我修改的 EXE。这让我的应用程序锁定天停止了。从那以后我没有尝试过。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-02T01:23:40.123

我倾向于同意激进的 DRM 确实很糟糕并且会惹恼合法用户，但与此同时，让诚实的人保持诚实的激励也不错，只要它不会妨碍......

不是真正的组件参考，而是一些关于保护软件的有趣读物：

防裂提示：
[Fravia 的如何更好地保护。](http://www.woodmann.com/fravia/protec.htm)
[海盗我不是。](http://unsanity.org/archives/000101.php)

对盗版和 DRM 的思考：
[盗版和非传统智慧。](http://www.codeproject.com/KB/architecture/UnconventialWisdom.aspx)
[盗版和 PC 游戏。](http://draginol.joeuser.com/article/303512/Piracy_PC_Gaming)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-01T23:44:35.963

我在几个项目中使用了[OnGuard](http://sourceforge.net/projects/tponguard/) by turbo power，但不要依赖它作为保护软件的唯一方法。您还可以使用[LockBox](http://sourceforge.net/projects/tplockbox/)库来加密数据，例如填充在您的应用程序控制的数据库中的记录，其中包含您通过电子邮件发送给用户的许可证注册数据，他们通过剪切并粘贴到“关于”框中应用。

保护事物的最强有力的方法是拥有一个用户无法访问的片段，并让您的软件“回家”以验证它仍然有效（非常像 DRM）。不幸的是，任何人都可以通过打开他们的软件防火墙并阻止您的应用程序使用互联网来轻松阻止。当然，类似 DRM 的系统现在名声不好，但部分原因是它们对最终用户来说是一个挫折点，因为它们可以工作……只要验证许可证的服务正常运行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-02T06:11:08.623

[Oreans](http://www.oreans.com/index.php)有非常好的生产产品（[Themida](http://www.oreans.com/themida.php)和[WinLicense](http://www.oreans.com/winlicense.php)），并且比其他产品更推荐。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-02T08:22:41.927

过去看到其他人在使用第三方许可和保护软件时遇到麻烦，我认为只有一个可行的系统。首先，不要花太多时间在上面，做一个好的产品，经常更新就行了。其次，将安装代码与保护分开。这样，您可以立即更改保护，而不会影响任何用户。这基本上意味着您必须编写自己的安装代码系统，或者使用像旧的 Turbopower 系统。然后使用一些可以保护您的解码器的东西。我目前使用的[Oreans Code Virtualizer](http://www.oreans.com/codevirtualizer.php)已经足够了。

将它们分开可以为您提供灵活性，并减少麻烦。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-04T22:30:01.650

我更喜欢 Silicon Realms ( [http://www.siliconrealms.com/](http://www.siliconrealms.com/) ) 的犰狳。它具有很好的功能，并与 Digital River/RegNow.com（作为它们的子公司）集成。

有很多可用的反犰狳软件，但自定义构建了一些额外的预防措施，由你做魔法编码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-01T19:31:35.260

我过去使用过[ICE 许可证](http://www.ionworx.com/icelicense.html)。工具易于使用 - 这很好，因为支持令人震惊！

这些类型的产品都不是完美的，但是，如果您决定这是您想要走的路线，您可能会做得比这个产品更差。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-02T13:03:45.853

我也不相信在技术保护上花费大量时间和精力是值得的，想要窃取您的软件的人无论如何都会这样做。

Balsamiq 的 Peldi Guilizzoni 有一篇关于这个主题的不错的博客文章：

[http://www.balsamiq.com/blog/?p=382](http://www.balsamiq.com/blog/?p=382)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-02T14:29:22.683

我可以支持 Oreans 产品的推荐。他们的支持也特别好。

我也用犰狳——没关系，但我不再推荐它了；和 ASProtect，我真的完全不推荐。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-12-25T05:17:31.087

我是 Trial [License Shield SDK](http://www.adeptshare.com)，似乎可以实现想要的功能。

但它是一个 DLL，不是你希望的 VCL 组件。

# html - 是否可以在水平布局的无序列表元素中包含块元素

> ID：706967
> 
> 赞同：0
> 
> 时间：2009-04-01T19:16:53.203
> 
> 标签：html, css

我有一个我想要水平布局的项目列表。它基本上是一排带标题的图片。就像是

```
picture1 picture2 picture3  
caption1 caption2 caption3 
```

所以我认为这是一个无序列表，其中 List 元素的样式为“display: inline”。但是标题必须是块元素，否则它们会像这样打印：

```
picture1 caption1 picture2 caption2 ... 
```

但是当它们是块元素时，列表保持垂直：

```
picture1  
caption1  
picture2  
caption2  
picture3  
caption3 
```

在这种情况下，我是否需要使用浮动 div 而不是列表？完成这项工作的最佳方法是什么？

下面是一个使用 div 代替图像的完整示例。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
<title>Blah</title>
<style type="text/css">

.myclass li{
  list-style: none;
  display: inline;
}
.item{
  display: inline;
}

</style>
</head>
<body>

<div class="myclass">
  <ul>
    <li><div class="item"><a href="http://google.com">one</a><p>uno</p></div></li>
    <li><div class="item"><a href="http://google.com">two</a><p>dos</p></div></li>
    <li><div class="item"><a href="http://google.com">three</a><p>tres</p></div></li>
  </ul>
</div>

</body>  
</html> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T19:26:07.067

每当您有一个块级元素时，所有布局都会向下移动，即使它的容器是内联显示的。

浮动你的 LI 是要走的路；这样你就可以在其中包含任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T19:27:18.873

你不需要`div`s。刚设置`.myclass li`为`display: inline-block`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-02T00:15:17.947

li 元素中的 div 是冗余的。这是最简单的方法：

的HTML：

```
<ul id="captions">
   <li><a href="#"><img /></a><p>Caption here</p></li>
   <li><a href="#"><img /></a><p>Caption here</p></li>
   <li><a href="#"><img /></a><p>Caption here</p></li>
   <li><a href="#"><img /></a><p>Caption here</p></li>
</ul> 
```

CSS：

```
#captions {
   list-style:none;
   margin:0;
   padding:0;
}
#captions li {
   list-style:none;
   margin:0;
   padding:0;
   width:200px;
   height:220px;
   float:left;
   text-align:center;
} 
```

# php - 我可以使用用 C 语言编写的 dll 和 PHP 吗？

> ID：706970
> 
> 赞同：2
> 
> 时间：2009-04-01T19:17:19.833
> 
> 标签：php, c

我们正在与这里开发的一块硬件进行交互，并允许通过网络进行访问。该设备的固件是用 C 语言编写的，其中一部分固件是大约 5000 行代码，用于解析巨大的二进制文件以获取配置数据，并编译为 .dll。

天底下有什么方法可以让我从 PHP 访问用 C 编写的 .dll 吗？

我敢打赌这是一个不，但在开始寻求在 PHP 中复制 5000 行 C 代码之前，我想我应该给这里的专家一个机会。

谢谢大家。

JH

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T19:21:56.843

是的，您可以将其用作 php 扩展（用 C 编写），但您可能需要进行一些修改 .. 等

[http://devzone.zend.com/node/view/id/1021](http://devzone.zend.com/node/view/id/1021)

我认为[这个问题](https://stackoverflow.com/questions/705443)与你的有关。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T23:42:59.990

您可能想查看[SWIG](http://www.swig.org/)，这是一种用于包装库的通用工具，以便可以从各种语言中调用它们。SWIG 支持 PHP，Perl 和 Lua（我个人使用的目标）也支持。引用[SWIG 网站上](http://www.swig.org/compare.html)的功能列表：

> SWIG 当前为 18 种不同的目标语言生成包装器代码：
> 
> *   快板 CL
> *   C＃
> *   CFFI
> *   CLISP
> *   鸡
> *   诡计
> *   爪哇
> *   卢阿
> *   模数 3
> *   方案
> *   OCAML
> *   八度
> *   Perl
> *   PHP
> *   Python
> *   R
> *   红宝石
> *   Tcl
> *   UFFI
> 
> 除此之外，解析树还可以导出为 XML 和 Lisp s 表达式。实验工作也可用于 Pike 模块。

它的一些特性依赖于每种语言包装器生成器的后端支持，但通常它提供了易于使用的包装器，用于将所有纯数据值类型传入和传出函数。在目标语言有概念的地方，它通常也可以映射对象模型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T19:21:22.867

难道你不能把你需要的 DLL 部分编译成一个可执行文件，然后从 php 执行它并利用结果吗？

就像是

```
$data = `someprogram --options` 
```

然后只需使用您想要的数据。

# sql - CTE 和子查询的区别？

> ID：706972
> 
> 赞同：172
> 
> 时间：2009-04-01T19:18:15.213
> 
> 标签：sql, sql-server, tsql, subquery, common-table-expression

从这篇文章[如何在以下过程中使用 ROW_NUMBER？](https://stackoverflow.com/questions/706720/how-to-use-rownumber-in-the-following-procedure/706756#706756)

有两个版本的答案，一个使用 a`sub-query`另一个使用 a`CTE`来解决相同的问题。

那么，使用 a`CTE (Common Table Expression)`而不是“子查询”有什么好处（因此，查询实际在做什么更具***可读性）***

使用`CTE`over的唯一好处`sub-select`是我实际上可以*将*`sub-query`. *当 CTE 用作简单（非递归）CTE 时*，这两者之间还有其他区别吗？

 ** * *

## 回答 #1

> 赞同：122
> 
> 时间：2009-04-01T19:21:09.560

在子查询与*简单*（非递归）CTE 版本中，它们可能非常相似。您必须使用分析器和实际执行计划来发现任何差异，这将特定于您的设置（因此我们无法完整地告诉您答案）。

一般来说; *_* CTE 可以递归使用；子查询不能。这使得它们特别适合树结构。

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2009-04-01T19:22:27.217

[公共表表达式](http://msdn.microsoft.com/en-us/library/ms190766.aspx)的主要优点（当不将其用于[递归查询](http://msdn.microsoft.com/en-us/library/ms186243.aspx)时）是封装，而不是必须在您希望使用它的每个地方声明子查询，您可以定义一次，但有多个引用给它。

但是，这并不*意味着*它只执行一次（根据[这个答案的先前迭代](https://stackoverflow.com/revisions/706983/3)，感谢所有评论过的人）。如果多次引用，查询肯定有可能被多次执行；查询优化器最终决定*如何*解释 CTE。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-01T19:26:26.147

`CTE`'s 对递归最有用：

```
WITH hier(cnt) AS (
        SELECT  1
        UNION ALL
        SELECT  cnt + 1
        FROM    hier
        WHERE   cnt < @n
        )
SELECT  cnt
FROM    hier 
```

将返回`@n`行（最多`101`）。对日历、虚拟行集等很有用。

它们也更具可读性（在我看来）。

除此之外，`CTE`'s 和`subqueries`是相同的。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-02-19T01:59:42.580

一个未提及的区别是单个 CTE 可以在联合的多个部分中引用

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-01T19:22:10.087

除非我遗漏了什么，否则您可以很容易地命名 CTE 和子查询。

我想主要的区别是可读性（我发现 CTE 更具可读性，因为它在前面而不是在中间定义了您的子查询）。

如果你需要用递归做任何事情，那么用子查询来做这件事会有点麻烦；）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2017-08-03T23:55:28.270

没有人提到的一个重要事实是（至少在 postgres 中），CTE 是优化围栏：

[https://blog.2ndquadrant.com/postgresql-ctes-are-optimization-fences/](https://blog.2ndquadrant.com/postgresql-ctes-are-optimization-fences/)

也就是说，它们将被视为自己的原子查询，而不是折叠到整个查询计划中。我缺乏提供更好解释的专业知识，但您应该检查您正在使用的 sql 版本的语义；对于高级用户，如果您是控制查询计划器的专家级别，则能够创建优化围栏可以提高性能；然而，在 99% 的情况下，您应该避免试图告诉查询规划器该做什么，因为您认为会更快的可能比它认为会更快的更糟。:-)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-09-23T21:48:35.733

添加到其他人的答案中，如果您多次使用同一个子查询，则可以用一个 CTE 替换所有这些子查询。这使您可以更好地重用您的代码。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-01-26T16:18:20.507

您还需要了解的一件事是，在旧版本的 SQL Server 中（是的，许多人仍然需要支持 SQL Server 2000 数据库），不允许 CTE，然后派生表是您的最佳解决方案。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-03-31T11:47:51.220

提示：（最大递归 n）

> 您可以通过在子句中使用`MAXRECURSION`提示和**0**到 **32,767**之间的值来限制特定语句允许的递归级别数`OPTION`

例如，您可以尝试：

```
OPTION 
      (MAXRECURSION 150)

GO 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-08-16T11:27:39.987

1.  使用 CTE，您可以使用递归。

2.  使用 CTE，您只需编写一次，但您可以在查询中的多个位置引用它。因此，它可以让您避免重复自己，并且还可以使查询更易于阅读和解释（即使在查询只引用一次的情况下）。

3.  CTE 似乎向查询优化器提供有关其自身的元数据，因此如果在同一查询中多次引用 CTE（例如，如果它连接到自身），则查询优化器可能会使用该元数据来改进整体查询执行计划（这似乎不会发生在子查询中）。

因此，总而言之，如果您想使用递归，或者您认为它会使您的代码更美观且更易于解释，或者您多次使用相同的子查询，请使用 CTE。

# python - 如何在python中调用外部程序并检索输出和返回代码？

> ID：706989
> 
> 赞同：59
> 
> 时间：2009-04-01T19:25:10.453
> 
> 标签：python, return-value, external-process

如何使用 python 脚本调用外部程序并检索输出和返回代码？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-04-01T19:28:30.133

查看[**subprocess**](http://docs.python.org/library/subprocess.html)模块：下面是一个简单的示例...

```
from subprocess import Popen, PIPE

process = Popen(["ls", "-la", "."], stdout=PIPE)
(output, err) = process.communicate()
exit_code = process.wait() 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2013-03-03T20:00:32.397

在 Ambroz Bizjak 之前的评论之后，这里有一个对我有用的解决方案：

```
import shlex
from subprocess import Popen, PIPE

cmd = "..."
process = Popen(shlex.split(cmd), stdout=PIPE)
process.communicate()
exit_code = process.wait() 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-03-14T02:57:53.417

经过一些研究，我有以下代码对我来说效果很好。它基本上实时打印标准输出和标准错误。希望它可以帮助其他需要它的人。

```
stdout_result = 1
stderr_result = 1

def stdout_thread(pipe):
    global stdout_result
    while True:
        out = pipe.stdout.read(1)
        stdout_result = pipe.poll()
        if out == '' and stdout_result is not None:
            break

        if out != '':
            sys.stdout.write(out)
            sys.stdout.flush()

def stderr_thread(pipe):
    global stderr_result
    while True:
        err = pipe.stderr.read(1)
        stderr_result = pipe.poll()
        if err == '' and stderr_result is not None:
            break

        if err != '':
            sys.stdout.write(err)
            sys.stdout.flush()

def exec_command(command, cwd=None):
    if cwd is not None:
        print '[' + ' '.join(command) + '] in ' + cwd
    else:
        print '[' + ' '.join(command) + ']'

    p = subprocess.Popen(
        command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=cwd
    )

    out_thread = threading.Thread(name='stdout_thread', target=stdout_thread, args=(p,))
    err_thread = threading.Thread(name='stderr_thread', target=stderr_thread, args=(p,))

    err_thread.start()
    out_thread.start()

    out_thread.join()
    err_thread.join()

    return stdout_result + stderr_result 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-01T19:30:23.763

在此处查看子流程模块：http: [//docs.python.org/library/subprocess.html#module-subprocess](http://docs.python.org/library/subprocess.html#module-subprocess)。它应该可以完成您需要的工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-08-11T08:19:53.573

我开发了一个小库（[py-execute](https://pypi.python.org/pypi/py-execute/)），它允许您执行外部程序、检索输出和 retcode，同时在控制台中实时获取输出：

```
>>> from py_execute.process_executor import execute
>>> ret = execute('echo "Hello"')
Hello
>>> ret
(0, 'Hello\n') 
```

您可以避免通过模拟 user_io 打印到控制台：

```
>>> from mock import Mock
>>> execute('echo "Hello"', ui=Mock())
(0, 'Hello\n') 
```

我写它是因为使用普通 Popen（在 Python 2.7 中）我在执行带有长输出的命令时遇到了问题

# smtp - VBA SMTP 库

> ID：706993
> 
> 赞同：0
> 
> 时间：2009-04-01T19:26:59.013
> 
> 标签：smtp

有谁知道我可以将任何 SMTP 库作为不依赖 Winsock dll 或 ocx 或任何其他第三方产品的类模块直接放入 MS Access 中？

我们目前在 MS Access 中使用 SendObject 功能，但这会干扰 Access 运行时库。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-02T15:29:37.447

找到了我正在寻找的东西：

[http://www.worksrite.com/CDOMail.htm](http://www.worksrite.com/CDOMail.htm)********