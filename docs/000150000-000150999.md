# StackOverflow 问答 000150000-000150999

# .net - 如何将 ByRef 变量保存到 .net winforms 对话框表单中？

> ID：150010
> 
> 赞同：3
> 
> 时间：2008-09-29T18:29:09.167
> 
> 标签：.net, winforms, reference, modal-dialog

我正在创建一个“部门选择器”表单，它将作为一个模式弹出表单，其中包含我的许多 Winforms 应用程序的“主要”表单。理想情况下，用户将单击将弹出表单的文本框旁边的图标，他们将选择所需的部门，当他们单击确定时，对话框将关闭，我将为我选择值更新文本框。

我已经完成了将对话框的所有者传递到对话框表单并让 OK 按钮单击事件进行正确更新的路线，但这迫使我对表单类型进行 DirectCast，然后我只能重用当前表单上的选择器。

我已经能够在构造函数中使用 ByRef 变量并成功更新了一个值，但它仅在构造函数中有效。如果我尝试将 ByRef 值分配给 Department Picker 类中的某个内部变量，则会丢失它的引用方面。这是附加到我的表单的基本代码：

```
Public Class DeptPicker

   Private m_TargetResult As String

   Public Sub New(ByRef TargetResult As String)

      InitializeComponent()

      ' This works just fine, my "parent" form has the reference value properly updated.
      TargetResult = "Booyah!"

      ' Once I leave the constructor, m_TargetResult is a simple string value that won't update the parent
      m_TargetResult = TargetResult

   End Sub

   Private Sub btnOK_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnOK.Click

      DialogResult = Windows.Forms.DialogResult.OK

      ' I get no love here. m_TargetResult is just a string and doesn't push the value back to the referenced variable I want.
      m_TargetResult = "That department I selected."
      Me.Close()

   End Sub

   Private Sub btnCancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnCancel.Click

      DialogResult = Windows.Forms.DialogResult.Cancel
      Me.Close()

   End Sub

End Class 
```

有人可以告诉我我在这里缺少什么或不同的方法来实现这一点吗？

*注意：代码示例在 VB.NET 中，但我也会接受任何 C# 答案。8^D*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T18:34:22.617

在这种情况下，我通常要么

*   编写一个 ShowDialog 函数来执行我想要的操作（例如返回值）或
*   只需让结果成为对话框中的一个属性。这就是常见文件对话框在 BCL 中的操作方式。然后调用者必须读取属性以获取结果。在我看来这很好。

您还可以组合这些方法，方法是使结果值成为对话框中的属性并创建一个 ShowDialog 方法，该方法返回该属性值，可以根据需要作为 ByRef 或作为返回值，具体取决于您的需要。

例如，我会将其添加为使用说明（抱歉，这里没有 VB，您说欢迎使用 C#）：

```
using (var dlg = new DeptPicker()) {
    if (dlg.ShowDialog() == DialogResult.OK) {
        myTextBoxOrWhatEver.Text = dlg.TargetResult;
    }
} 
```

在对话框本身中，只需执行以下操作：

```
void okButton_Click(object sender, EventArgs e)
{
    TargetResult = whatever; // can also do this when the selection changes
    DialogResult = DialogResult.OK;
    Close();
} 
```

我没有在这个示例中使用新的 ShowDialog 实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T18:35:32.427

问题是在构造函数中分配 TargetResult 是使用字符串作为参考。m_TargetResult 字符串只是 ref 字符串的副本，而不是对原始字符串的引用。

至于如何对原作“指针”，我不知道。

由于 VB.NET 不支持不安全的代码块，因此您无法对字符串进行指针引用，这使得这变得更加困难。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T19:16:34.277

您可以将文本框引用传递给模态表单。

让用户选择任何部门。当用户单击确定时，将引用文本框的文本属性设置为所选部门的文本或 ID（取决于您的需要）

我正在使用您提供的代码。

```
 Public Class DeptPicker

   Private m_TargetTextBox As TextBox

   Public Sub New(ByRef TargetTextBox As TextBox)
      InitializeComponent()

      m_TargetTextBox = TargetTextBox

   End Sub

   Private Sub btnOK_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnOK.Click

      DialogResult = Windows.Forms.DialogResult.OK

      ' I get no love here. m_TargetResult is just a string and doesn't push the value back to the referenced variable I want.
      m_TargetTextBox.Text = "That department I selected."
      Me.Close()

   End Sub

   Private Sub btnCancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnCancel.Click

      DialogResult = Windows.Forms.DialogResult.Cancel
      Me.Close()

   End Sub

End Class 

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:11:09.790

```
 Public Class DeptPicker

    dim dlgResult as DialogResult

    Public Function GetSelectedDepartment() As String
        Me.Show vbModal
        If (dlgResult = Windows.Forms.DialogResult.OK) Then
            return "selected department string here"
        Else
            return "sorry, you didnt canceled on the form"
        End If
    End Function

    Private Sub btnOK_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnOK.Click
        dlgResult = Windows.Forms.DialogResult.OK
        Me.Close()
    End Sub

    Private Sub btnCancel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnCancel.Click
        dlgResult = Windows.Forms.DialogResult.Cancel
        Me.Close()
    End Sub
End Class 

```

注意：我没有测试过这个。我希望你明白我的意思。

OregonGhost：这样看起来更好吗？

用户可以调用 new DeptPicker().GetSelectedDepartment()。我不知道我不需要再次发布答案并且可以使用相同的帖子。

谢谢俄勒冈幽灵。现在，看起来还好吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T18:44:49.057

这可能有效：

```
 // This code in your dialog form.  Hide the base showdialog method 
    // and implement your own versions
    public new string ShowDialog() {
        return this.ShowDialog(null);
    }

    public new string ShowDialog(IWin32Window owner) {
        // Call the base implementation of show dialog
        base.ShowDialog(owner);

        // You get here after the close button is clicked and the form is hidden.  Capture the data you want.
        string s = this.someControl.Text;

        // Now really close the form and return the value
        this.Close();
        return s;
    }

    // On close, just hide.  Close in the show dialog method
    private void closeButton_Click(object sender, EventArgs e) {
        this.Hide();
    }

    // This code in your calling form
    MyCustomForm f = new MyCustomForm();
    string myAnswer = f.ShowDialog(); 
```

# delphi - Delphi 中通过 writeln/readln 的实数精度

> ID：150011
> 
> 赞同：3
> 
> 时间：2008-09-29T18:29:10.257
> 
> 标签：delphi, floating-point, text-files, precision

我的客户应用程序通过使用 writeln 和 readln 的文本文件导出和导入了很多 real 类型的变量。我试图增加所写字段的宽度，因此代码如下所示：

```
writeln(file, exportRealvalue:30); //using excess width of field
....
readln(file, importRealvalue); 
```

当我导出然后再次导入和导出并比较文件时，我得到最后两位数的差异，例如（此处的实际位数可能不正确，但你明白了）：

```
-1.23456789012E-0002
-1.23456789034E-0002 
```

这实际上对应用程序产生了影响，因此客户想知道我能做些什么。现在我不确定是否只有写入/读取才能做到这一点，但我想在我再次深入讨论堆栈之前我会提出一个快速的问题。我需要对此进行二进制处理吗？

这不是一个处理货币或其他东西的应用程序，我只是在文件中写入和读取值。我知道浮点有时有点奇怪，我认为其中一个例程（writeln/readln）可能会发生一些有趣的事情。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T19:28:05.093

您可以尝试切换到**扩展**以获得更高的精度。正如所指出的那样，浮点数只有这么多的有效数字精度，因此仍然可以显示更多数字然后准确存储，这可能会导致您指定的行为。

从德尔福帮助：

基本 Win32 实数类型

```
                                            | 意义重大 | 尺寸
类型 | 范围 | 数字 | 字节
------+----------------------+------ --------+----------
真实 | -5.0 x 10^–324 .. 1.7 x 10^308 | 15-16 | 8  
真实48 | -2.9 x 10^–39 .. 1.7 x 10^38 | 11-12 | 6   
单身 | -1.5 x 10^–45 .. 3.4 x 10^38 | 7-8 | 4   
双 | -5.0 x 10^–324 .. 1.7 x 10^308 | 15-16 | 8   
扩展 | -3.6 x 10^–4951 .. 1.1 x 10^4932 | 10-20 | 10   
比较 | -2^63+1 .. 2^63–1 | 10-20 | 8   
货币 | -922337203685477.5808.. | |
                    922337203685477.5807 | 10-20 | 8   

```

> **注意**：六字节的**Real48**类型在 Object Pascal 的早期版本中称为**Real**。如果您在 Delphi 中重新编译使用旧的六字节 Real 类型的代码，您可能需要将其更改为**Real48**。您还可以使用 {$REALCOMPATIBILITY ON} 编译器指令将**Real**转换回六字节类型。以下说明适用于基本实数类型。
> 
> *   **维护Real48**是为了向后兼容。由于它的存储格式不是英特尔处理器架构的原生格式，因此它的性能比其他浮点类型要慢。
> *   **Extended**比其他真实类型提供更高的精度，但便携性较差。如果您要创建跨平台共享的数据文件，请小心使用 Extended。

请注意，范围大于有效数字。所以你可以有一个更大的数字，然后可以准确地存储。我建议四舍五入到有效数字以防止这种情况发生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T21:01:40.467

如果要使用 WriteLn 指定实数的精度，请使用以下命令：

```
WriteLn(RealVar:12:3); 
```

它输出值 Realvar，至少有 12 个位置，精度为 3。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T19:11:51.293

使用浮点类型时，您应该注意指定类型的精度限制。例如，一个 4 字节的 IEEE-754 类型只有大约 7.5 位有效数字的精度。八字节 IEEE-754 类型的有效数字大约是两倍。显然，delphi 实数类型的精度约为 11 位有效数字。这样做的结果是，您指定的任何额外的格式数字都可能是噪声，可能导致以 10 为基数的格式化值和以 2 为基数的浮点值之间的转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T19:34:00.850

首先，我会尝试看看是否可以通过使用带有不同参数的 Str 或提高应用程序中类型的精度来获得任何帮助。（您是否尝试过使用扩展？）

作为最后的手段，（**警告！解决方法！！**）我会尝试将客户的字符串表示形式与二进制表示形式一起保存在排序列表中。在写回浮点值之前，我会查看表中是否已经存在匹配值，其字符串表示形式是已知的并且可以代替使用。为了快速进行此查找，您可以按数值对其进行排序并使用二进制搜索来查找最佳匹配。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T08:28:14.273

根据您需要进行多少处理，另一种方法是将数字保留为 BCD 格式以保持原始准确性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-16T04:41:06.697

如果不知道您的 ExportRealValue 和 ImportRealValue 是什么类型，很难回答这个问题。正如其他人所提到的，真实类型都有不同的精度。

值得注意的是，与某些想法相反，扩展并不总是更高的精度。扩展是 10-20 有效数字，其中双倍是 15-16。当您在第十个 sig fig 附近遇到问题时，您可能已经在使用扩展了。

为了更好地控制读取和写入，您可以自己将数字转换为字符串，并将它们写入文件流。至少这样你就不必担心 readln 和 writeln 在你背后没有好处。

# .net - 将内存中的文本加载到 WebBrowser 控件中

> ID：150014
> 
> 赞同：8
> 
> 时间：2008-09-29T18:31:03.920
> 
> 标签：.net, controls

在 .Net WebBrowser 控件上，我可以看到加载页面的唯一方法是设置 URL 属性。但是我想给它一些我已经在内存中的 HTML 代码，而不是先把它写到文件中。有没有办法做到这一点？或者是否有任何控件可以做到这一点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T18:35:37.900

你想要 DocumentText 属性：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documenttext.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documenttext.aspx)

?

来自[http://www.codeguru.com/forum/showpost.php?p=1691329&postcount=9](http://www.codeguru.com/forum/showpost.php?p=1691329&postcount=9)：您还应该提供一些东西：

*   不要在构造函数中设置 DocumentText。使用 Form_Load 或您自己的方法。如果您在构造函数中设置 DocumentText，您将无法在应用程序的任何位置再次设置它。一定要检查表单设计器也没有设置它。

*   每个方法调用只能设置一次 DocumentText。这很奇怪，很可能是一个错误，但这是真的。例如：在 for 循环中设置 DocumentText 只会在循环的第一次迭代时正确设置。但是，您可以创建一个小方法将 DocumentText 设置为传入的字符串，然后在 for 循环中调用此方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:38:07.443

您使用 WebBrowser.DeocumentText ( [http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documenttext.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documenttext.aspx) ) 或 WebBrowser.DocumentStream ( [http://msdn.microsoft.com/ en-us/library/system.windows.forms.webbrowser.documentstream.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documentstream.aspx)）更改当前文档中的 HTML。如果您没有文档，您可能需要导航到 about:blank。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T18:38:00.143

此外，通常，在任何可以使用 Stream 的地方，都可以使用 MemoryStream 来包装内存中的数据。

# c# - 使用 OleDB 从 .NET 查询 SQL Server 2005 时区分大小写

> ID：150017
> 
> 赞同：1
> 
> 时间：2008-09-29T18:32:42.980
> 
> 标签：c#, .net, sql-server, oledb, case-sensitive

我有一个从 .NET 应用程序到 SQL Server 数据库的查询，它似乎需要很长时间才能完成（5 分钟以上）。我在 c# 中创建了一个测试应用程序来尝试查看这么长时间的谈话内容（查询应该很快返回）。

当我通过添加元素来重构查询以查看哪个部分花费了这么长时间时，我最终实际上逐字地重构了查询，其中唯一的区别是原始查询中的空格和大小写差异。这种差异在大约 100 毫秒内返回了结果。

有人见过这个吗？我想知道我们的服务器（因为同事有同样的问题）或我们的计算机上是否有服务关闭。

提前感谢您对此的任何帮助。

下面的代码示例（末尾查询第一行的差异（fk_source 与 fk _Source）：

```
//Original
    OleDbCommand comm = new OleDbCommand("select min(ctc.serial_no) as MIN_INTERVAL from countstypecode ctc, source s, countstype ct, counts c where ct.value_id=c.value_id and s.c_id=ct.fk_source and " +
      "ct.timeinterval=ctc.typename and ct.timeinterval in ('15min','1h','1day') and c.time_stamp >=  CONVERT(datetime,'01-01-2008',105)  and c.time_stamp < " +
      "CONVERT(datetime,'01-01-2009',105)  and s.c_id = '27038dbb19ed93db011a315297df3b7a'", dbConn);

//Rebuilt
    OleDbCommand comm = new OleDbCommand("select min(ctc.serial_no) as MIN_INTERVAL from countstypecode ctc, source s, countstype ct, counts c where ct.value_id=c.value_id and s.c_id=ct.fk_Source and " +
      "ct.timeinterval=ctc.typename and ct.timeinterval in ('15min','1h','1day') and c.time_stamp >= CONVERT(datetime,'01-01-2008',105) and c.time_stamp < " +
      "CONVERT(datetime,'01-01-2009',105) and s.c_id='27038dbb19ed93db011a315297df3b7a'", dbConn); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T20:04:19.187

我怀疑这是一个过程缓存问题。存储过程的一个好处是计划是为您存储的，这可以加快速度。不幸的是，有可能在缓存中得到一个糟糕的计划（即使使用动态查询）。

只是为了好玩，我检查了我的过程缓存，运行了一个临时查询，再次检查，然后我用不同的大写字母运行了相同的查询，我惊讶地发现过程计数更高。

试试这个....

连接到 SQL Server Management Studio。

```
DBCC MemoryStatus

Select Columns... From TABLES.... Where....

dbcc MemoryStatus

Select Columns... From tables.... Where....

dbcc MemoryStatus 
```

我想您会发现 TotalProcs 会在语句更改时发生更改（即使唯一的更改是区分大小写的）。

更新您的统计数据可能会有所帮助。这是一个相当缓慢的运行过程，因此您可能希望在缓慢的时间内运行它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T18:36:09.257

由于您使用的是 SQL Server 2005，您是否尝试过使用 SqlCommand 对象而不是 OleDbCommand 对象？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T18:38:32.123

我没有看到您的查询有影响性能的差异 - 运行之间的缓存或索引/统计数据变化怎么样？由于统计信息或索引更改，执行计划可能已更改。

关于这种情况：如果数据库设置为区分大小写，大小写可能很重要，但是对于要在区分大小写的数据库中运行的两个查询，必须有以两种格式命名的列 - 查询解析器将服从大小写 -它不会导致性能差异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:39:26.893

首先，您是否 100% 确定查询出错了？检查 sql server 中的跟踪配置文件，看看它在数据库中占用了多长时间。

其次，您是否获得了相同数量的结果。默认情况下，大写在 sql server 中应该无关紧要，但它可以设置不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T18:40:51.960

如果我有一个需要“5 分钟以上”的查询，我不会担心匹配字符串大小写所需的 100 毫秒。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T19:04:10.297

感谢您的所有回答，我将依次回复：

1) Russ，我同意 SQLConnection 会更好，但不幸的是我没有设置连接类型。我刚刚创建了一个小应用程序来测试这个查询，但查询是在一个更大的应用程序中动态创建的。

2）gbjbaanb，我认为这不是服务器问题，因为我可以同时从管理工作室运行两个查询，这似乎只是在.net（1.1和2.0）中通过oledb运行时出现问题。我们在其上运行了探查器，跟踪文件确认以这种方式调用时完成查询需要 5 多分钟。

3）Joel Coehoorn，同意，但我在这里真正想要了解的是“为什么”，因为现在我们不知道这个问题有多大以及它在哪里。

4）Cade Roux，差异是非常可复制的，所以我不认为这是索引更改或缓存的问题，因为我已经以相同的结果背靠背运行测试并且它们在 SQL Server 中花费大约相同的时间来跑。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T22:12:55.040

感谢 G Mastros 提供最完整的答案，尽管回想起来统计数据的更新是由 Cade 建议的。然而，G Mastos 的解决方案更适合我的 SQL Server 经验水平。

谢谢大家的帮助！

我将研究为什么这种看似无辜的差异会产生如此大的后果

# version-control - 需要检查 Grails 应用程序的哪些内容？

> ID：150020
> 
> 赞同：8
> 
> 时间：2008-09-29T18:33:54.363
> 
> 标签：version-control, grails

Grails 应用程序的哪些部分需要存储在源代码控制中？需要的一些明显的部分：

*   grails-app 目录
*   测试目录
*   网络应用目录

现在我们遇到如下问题：

*   如果我们使用 Grails 插件（如 gldapo），是否需要签入该插件？
*   Grails 插件是否安装在 Grails 目录或您的项目中？

我不打算对 .project 发起一场宗教战争，所以请忽略这一点，但是我需要担心任何“隐藏”的项目文件以及插件问题吗？

转换为社区 wiki，因为新版本的 Grails 改变了其中一些解决方案，尤其是在插件方面。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T02:14:39.077

*   你不想要 ./plugins/core（核心 Grails 插件）在 SVN 下
*   在 SVN 下的 ./web-app/WEB-INF/ 下你不需要任何东西。您通常不需要将文件放在这里。./conf 中的文件被复制到 WEB-INF/classes 中，因此它们位于类路径中，如果您需要提供任何内容。

这是更详细描述的文档的[链接。](http://docs.codehaus.org/display/GRAILS/Checking+Projects+into+SVN)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T18:42:28.010

我想说，把你所有的项目目录都放在版本控制下。即使是库，也不会占用太多磁盘空间，而且您不会经常更改它们。

在我看来，它比依赖外部工具（如 maven）来获取所有依赖项要“更安全”，尤其是当其中一个依赖项默默升级并稍微改变其行为时，会在您自己的项目中引入“错误”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T20:26:48.897

经过一番研究，似乎 Grails 的插件安装在项目目录中，它们不会更改您的 Grails 安装。这意味着您需要在要使用该功能的每个 Grails 项目中安装该插件，并且该插件是每个项目源代码的一部分。

这些插件安装在 grails-app/plugins 目录中，所以如果您已经在 grails-app 目录中检查，那么一切都应该很好。

似乎没有任何需要签入的“隐藏文件”，尽管在启动新项目时创建了一些应该添加到源代码控制的空目录，因为您可能会在以下位置向它们添加文件以后的日期。

# tortoisesvn - 有没有人在 TortoiseSVN 中遇到“作者”未写入日志的问题？

> ID：150027
> 
> 赞同：1
> 
> 时间：2008-09-29T18:35:42.440
> 
> 标签：tortoisesvn, svn

我有人使用 url（替换了 IP 地址）连接到我的存储库： **svn+ssh://craig@123.45.67.89/subversion**

然而，当他们提交文件时，作者条目为“null”。

根据这篇文章：[http](http://tortoisesvn.net/node/80) ://tortoisesvn.net/node/80 它应该可以正常工作。

有没有人有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T19:09:05.200

检查文件中的服务器配置`[repository]/conf/svnserve.conf`是否已设置

```
anon-acces=write
auth-access=write 
```

通常，使用默认设置

```
anon-access = read
auth-access = write 
```

（您可以只注释掉这些行），应保留作者信息。

# c# - 以 C# 形式实现标尺

> ID：150031
> 
> 赞同：3
> 
> 时间：2008-09-29T18:36:14.997
> 
> 标签：c#, winforms, controls

有没有人有很好的技术（或教程）在 C# Windows 窗体应用程序中实现标尺？我想在显示指示鼠标位置的标尺时显示图像，以便更准确地定位光标。就像下图一样：

![描绘光标所在位置的标尺。](https://i.stack.imgur.com/QfIIi.png)

我尝试使用拆分器控件来保留刻度线，但我不知道如何使左上角成为灰色空白区域。有什么建议吗？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T18:42:56.650

我会构建一个自定义控件来在 X 和 Y 位置执行此操作并使用两个控件。

该控件必须覆盖`Paint()`并使用 GDI 方法来显示刻度线，然后它将捕获鼠标事件并适当地更新位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-30T00:47:16.477

这是我在这件事上找到并使用的最好的文章：http: [//www.codeproject.com/KB/miscctrl/ruler.aspx](http://www.codeproject.com/KB/miscctrl/ruler.aspx)

# delphi - 在现金流报告中替换存储过程的想法

> ID：150032
> 
> 赞同：0
> 
> 时间：2008-09-29T18:36:52.423
> 
> 标签：delphi, stored-procedures, report

我们有一个现金流量报告，基本上是这样的结构：

```
Date |Credit|Debit|balance|
09/29| 20   | 10  | 10    |
09/30| 0    | 10  | 0     | 
```

主要问题是余额，由于我们使用 DataSet 作为数据，计算 DataSet 上的余额有点困难，因为我们总是需要前一天的余额。

此外，这些数据来自多个表，并且很难维护此过程，因为数据库元数据经常更改。

任何人都可以给我一些可能的不同解决方案吗？问题？

此报表显示在 DataGrid 上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T20:48:00.063

这对您来说可能变化太大或不合时宜，但现金流量报告向我表明，您可能正在正式或非正式地维护某种总分类账安排。如果您是，那么也许我对此很幼稚，但我认为您应该将总分类帐详细信息保留为单个表格，其中包含最少数量的列，例如 ID、日期、帐户、来源和金额。

来自不同表格的所有数据表明，有几种不同类型的事件会影响您的现金。对我来说，在他们自己的表中表示这些不同类型的事件（如应收账款或应付账款或库存等）是有意义的，但诀窍是在这些其他表中没有任何货币列。相反，让他们参考总账明细中记录该数据的行。如果您强制执行此操作，那么无论对其他表进行更改，现金流量都将始终保持不变。

余额转发问题仍然需要解决，您必须考虑所涉及的交易数量和系统所需的响应能力，但至少您可以决定如何处理一次，而不必进行更改，因为你系统的其他部分会进化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T18:42:54.217

在代码方面，您有两个相对简单的选项，但它们都涉及遍历数据集。

选项 1：数据绑定之前的 For 循环。对于数据表中的每一行，将贷方/借方添加/减去前一行的余额并将其分配到数据表的相应单元格。

选项 2：在数据绑定期间计算。首先，您将有一个全局变量，您可以在其中保存您的值。在数据绑定之前将其设置为零。对于每个项目或替代项目，将贷方/借方添加/减去全局变量并将其分配给数据网格的适当单元格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T14:06:53.420

请注意，这通常意味着网络流量的大幅增加，这会降低整个应用程序的性能（因为您必须获取所有这些数据才能在客户端上处理）。

另一种方法是创建一个*（在您喜欢的实现中）*中间层应用程序，您可以发送请求并在数据库服务器或单独的网段中执行此处理。

如果有SP做这个计算，通常是因为它涉及**大量数据**，目的是避免这种在网络中的循环。

# javascript - 正则表达式匹配非ASCII字符？

> ID：150033
> 
> 赞同：280
> 
> 时间：2008-09-29T18:37:07.633
> 
> 标签：javascript, jquery, regex

在正则表达式中匹配非 ASCII 字符的最简单方法是什么？我想单独匹配输入字符串中的所有单词，但语言可能不是英语，所以我需要匹配诸如 ü、ö、ß 和 ñ 之类的东西。此外，这是在 Javascript/jQuery 中，因此任何解决方案都需要适用于此。

* * *

## 回答 #1

> 赞同：286
> 
> 时间：2008-09-29T18:45:10.797

这应该这样做：

```
[^\x00-\x7F]+ 
```

它匹配任何不包含在[ASCII 字符集中](http://en.wikipedia.org/wiki/American_Standard_Code_for_Information_Interchange)的字符（0-127，即 0x0 到 0x7F）。

你可以用 Unicode 做同样的事情：

```
[^\u0000-\u007F]+ 
```

对于 unicode，您可以查看以下 2 个资源：

*   Unicode 范围的[代码图表列表](http://www.unicode.org/charts/)
*   [此工具](http://kourge.net/projects/regexp-unicode-block)用于创建由 Unicode 块过滤的正则表达式。

* * *

## 回答 #2

> 赞同：183
> 
> 时间：2014-02-27T16:53:35.673

```
var words_in_text = function (text) {
    var regex = /([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+)/g;
    return text.match(regex);
};

words_in_text('Düsseldorf, Köln, Москва, 北京市, إسرائيل !@#$');

// returns array ["Düsseldorf", "Köln", "Москва", "北京市", "إسرائيل"] 
```

此正则表达式将匹配任何语言文本中的所有单词...

* * *

## 回答 #3

> 赞同：97
> 
> 时间：2018-02-21T09:50:08.093

[Unicode 属性转义](https://github.com/tc39/proposal-regexp-unicode-property-escapes)是 ES2018 的功能之一。

### 基本用法

使用 Unicode 属性转义，您可以使用以下简单的正则表达式匹配来自任何语言的字母：

```
/\p{Letter}/u 
```

或者用简写，甚至更简洁：

```
/\p{L}/u 
```

### 匹配词

关于问题的具体用例（匹配单词），请注意您可以在字符类中使用 Unicode 属性转义，从而轻松将字母*与*连字符等其他单词字符匹配：

```
/[\p{L}-]/u 
```

把它们拼接在一起，你可以用这个漂亮的短正则表达式匹配所有^([1]语言的单词：)

```
/[\p{L}-]+/ug 
```

[示例（从上面的答案中](https://stackoverflow.com/a/22075070/2048874)无耻地插入）：

```
'Düsseldorf, Köln, Москва, 北京市, إسرائيل !@#$'.match(/[\p{L}-]+/ug)

// ["Düsseldorf", "Köln", "Москва", "北京市&quot;, "إسرائيل"] 
```

> ^(**[1]**)请注意，我不是语言专家。*除了*字母和连字符，您可能仍想对可能是单词一部分的其他字符进行自己的研究

### 浏览器支持

此功能[在所有主要的常青浏览器中都](https://caniuse.com/#feat=mdn-javascript_builtins_regexp_property_escapes)可用。

### 转译

如果需要对旧版浏览器的支持，可以使用名为[regexpu](https://github.com/mathiasbynens/regexpu)的工具将 Unicode 属性转义转换为 ES5 。[这里](https://mothereff.in/regexpu#input=var+regex+%3D+/%5Cp%7BL%7D/u%3B&unicodePropertyEscape=1)有一个在线演示。正如你在演示中看到的，实际上你可以用以下（非常长的）ES5 正则表达式匹配非拉丁字母：

```
/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])/ 
```

如果你使用 Babel，还有一个 regexpu-powered 插件（[Babel v6 插件](https://github.com/mathiasbynens/babel-plugin-transform-unicode-property-regex)，[Babel v7 插件](https://github.com/babel/babel/tree/master/packages/babel-plugin-proposal-unicode-property-regex)）。

* * *

## 回答 #4

> 赞同：81
> 
> 时间：2009-05-17T00:08:29.337

正则表达式、Unicode 和 Javascript 的情况很糟糕。程序员必须依赖外部库才能识别“Αλφα”是一个词，甚至“é”是一个字母，这太荒谬了。

但事情就是这样。

这个人写了一个很好的库来处理 Javascript 正则表达式中的 Unicode：

[http://blog.stevenlevithan.com/archives/javascript-regex-and-unicode](http://blog.stevenlevithan.com/archives/javascript-regex-and-unicode)

Unicode 的东西是这个正则表达式库的插件：

[http://xregexp.com/](http://xregexp.com/)

这是一篇关于 Unicode 扩展的帖子：

[http://blog.stevenlevithan.com/archives/xregexp-unicode-plugin](http://blog.stevenlevithan.com/archives/xregexp-unicode-plugin)

以及扩展页面本身：

[http://xregexp.com/plugins/](http://xregexp.com/plugins/)

伟大的工作，但它仍然让我感到沮丧的是，Javascript 在这方面是如此落后。

（他为 O'Reilly 写了一本关于这个话题的书，所以他很可能知道他在说什么。）

他实现它的方式是添加具有某些属性的字符表。然后，当您使用他的库构建正则表达式时，`\p{charclass}`将替换为`[allthecharactersintheclass]`.

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2016-03-02T09:47:03.420

Jeremy Ruten 给出的答案很好，但我认为这并不是 Paul Wicks 所要寻找的。如果我理解正确，Paul 询问了表达式以匹配非英语单词，例如`können`or `móc`。Jeremy 的正则表达式只匹配非英文字母，因此需要进行一些小改进：

```
([^\x00-\x7F]|\w)+ 
```

或者

```
([^\u0000-\u007F]|\w)+ 
```

这`[^\x00-\x7F]`和这`[^\u0000-\u007F]`部分允许正则表达式匹配非英文字母。

这`(|)`是合乎逻辑的或并且`\w`是英文字母，因此`([^\u0000-\u007F]|\w)`将匹配单个英文或非英文字母。

`+`在表达式的末尾意味着它可以重复，因此整个表达式允许所有英文或非英文字母匹配。

[在这里](https://regex101.com/r/iS5jK8/1)，您可以使用各种字符串测试第一个表达式，[这](https://regex101.com/r/sV8uK9/1)是第二个。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-29T18:43:57.460

您的方法与任何其他字符匹配相同，但您使用 \uXXXX，其中 XXXX 是字符的 unicode 编号。

看： [http ://unicode.org/charts/charindex.html](http://unicode.org/charts/charindex.html)

[http://unicode.org/charts/](http://unicode.org/charts/)

[http://www.decodeunicode.org/](http://www.decodeunicode.org/)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-29T18:42:31.410

所有支持 Unicode 的 Regex 风格都应该有一个特殊的字符类，如 \w 匹配任何 Unicode 字母。看看[你的具体口味在这里](http://www.regular-expressions.info)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-06-01T03:27:18.887

我遇到了**\p**按预期工作的问题，所以我只是使用了不同的策略，例如：

```
([^\t]+)\t 
```

在下一个制表符之前查找不是制表符的任何内容...显然这取决于您的搜索源，但您明白了。现在我不必弄清楚哪些 unicode 字符有效，哪些无效等。

# oop - 如何将对象的中间层连接到由 DataSet 组成的数据层？

> ID：150038
> 
> 赞同：1
> 
> 时间：2008-09-29T18:38:22.200
> 
> 标签：oop, dataset, relational

我有一个包含多个相关对象的中间层和一个使用具有多个 DataTables 和关系的 DataSet 的数据层。

我想在我的一个对象（父对象）上调用 Save 方法，并将其私有变量数据转换为 DataRow 并添加到 DataTable。一些私有变量数据实际上是其他对象（子对象），每个对象都需要调用自己的 Save 方法并保留自己的变量数据。

我如何将它“系在一起”？应该在 ParentObject 中实例化 DataSet 的哪些部分以及需要将哪些部分传递给 ChildObject 以便它们可以将自己添加到数据集中？

另外，如何将两个表的关系连接在一起？

我看到的关于 Order OrderDetail 关系的示例创建了 OrderRow 和 OrderDetailRow，然后调用 OrderDetailRow.SetParentRow(OrderDetail)

我认为这对我不起作用，因为我的 Order 和 OrderDetail（使用它们的示例命名）位于不同的类中，并且示例都在 Big Honking Method 中发生。

谢谢你，基思

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T22:25:27.660

我不会再开始争论数据集是好是坏。如果您继续使用它们，请考虑以下几点：

*   您需要保留原始数据集并对其进行更新，以便获得正确的插入和更新。
*   你希望你的父母了解他们的孩子，但不是相反。放逐父表。
*   订单及其 OrderDetails 是一个聚合（来自领域驱动设计），应该被视为一个整体。调用 order.Save() 应该可以保存所有内容。

嗯，这就是理论。我们怎么能做到这一点？一种方法是创建以下工件：

*   命令
*   订单详情
*   订单仓库
*   订单地图

OrderMap 是您管理订单到数据集关系的地方。在内部，它可以使用 Hashtable 或 Dictionary。

OrderRepository 是您从中获取订单的地方。存储库将从某处获取包含所有关系的数据集，使用其所有 OrderDetails 构建订单，并将订单/数据集关系存储在 OrderMap 中。

只要 Order 还活着，OrderMap 就必须保持活跃。订单包含所有 OrderDetails。

将订单传递到存储库并让它保存。存储库将从地图中获取数据集，从订单更新订单表并迭代所有订单详细信息以更新订单详细信息表。

检索并保存：

```
var order = repository.GetOrder(id);
repository.Save(order); 
```

在 OrderRepository.GetOrder() 内部：

```
var ds = db.GetOrderAndDetailsBy(id);
var order = new Order();
UpdateOrder(ds, order);
UpdateOrderDetails(ds, order); // creates and updates OrderDetail, add it to order.
map.Register(ds, order); 
```

在 OrderRepository.Save() 内部：

```
var ds = map.GetDataSetFor(order);
UpdateFromOrder(ds, order);
foreach(var detail in order.Details) UpdateFromDetail(ds.OrderDetail, detail); 
```

一些最后的笔记：

*   您可以将地图实现为单例。
*   让地图使用弱引用。然后任何订单都应该在应该的时候被垃圾收集，并且内存将被释放。
*   您需要某种方式将 OrderDetail 与其表行相关联
*   如果您有一点可能升级到 .NET 3.5，那就去做吧。Linq to Sql 或 Linq to Entity 将消除您的一些痛苦。
*   这一切都是凭空创造出来的。我希望它不会太不准确。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T23:59:26.907

So, What I am doing right now is passing a reference to the DataSet and a reference to the DataRow of the parent into the Save method of the Child Object.

Here is a little code showing the concept of what I am doing.

```
// some random save event in a gui.cs//
public void HandleSaveButtonClick()
{ parentObject.Save(); }

// Save inside the parentObject.cs //
public void Save()
{    
    CustomDataSet dataSet = new CustomDataSet();

    ParentObjectTableAdapter parentTableAdapter = new ParentObjectTableAdapter();

    DataTable dt = dataSet.ParentTable;
    DataRow newParentDataRow = dt.NewRow();
    newParentDataRow["Property1"] = "Hello";
    newParentDataRow["Property2"] = "World";
    dt.Rows.Add(newParentDataRow);

    parentTableAdapter.Update(dataSet.ParentTable);

    //save children
    _child1.Save(dataSet, newParentDataRow)

    dataSet.AcceptChanges();
}

//Save inside child1.cs //
public void Save(CustomDataSet dataSet, DataRow parentRow)
{

    Child1TableAdapter childTableAdapter= new Child1TableAdapter();

    DataTable dt = dataSet.ChildTable;

    DataRow dr = dt.NewRow();
    dr.SetParentRow(parentRow);
    dr["CProp1"] = "Child Property 1";    
    dt.Rows.Add(dr);

    childTableAdapter.Update(dataSet.ChildTable);

} 
```

Let me know how this looks. Is this a usable pattern or am I missing something critical?

Thank you,
Keith

# regex - 我可以使用什么正则表达式将字符串拆分为整个单词，但前提是它们以 # 开头？

> ID：150042
> 
> 赞同：5
> 
> 时间：2008-09-29T18:39:34.677
> 
> 标签：regex, vb.net

我试过这个...

```
Dim myMatches As String() = 
System.Text.RegularExpressions.Regex.Split(postRow.Item("Post"), "\b\#\b") 
```

但它正在拆分所有单词，我想要一个以#开头的单词数组

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T18:47:07.140

这似乎工作......

C＃

```
Regex MyRegex = new Regex("\\#\\w+");
MatchCollection ms = MyRegex.Matches(InputText); 
```

或 vb.net

```
Dim MyRegex as Regex = new Regex("\#\w+")
Dim ms as MatchCollection = MyRegex.Matches(InputText) 
```

给定输入文本...

“asdfas asdf #asdf asd fas df asd fas #df asd f asdf”

...这将产生....

“#asdf”和“#df”

我承认这不会给你一个字符串数组，但 MatchCollection 是可枚举的，因此可能已经足够好了。

* * *

此外，我还要补充一点，我是通过使用[Expresso](http://www.ultrapico.com/Expresso.htm)获得的。这似乎是免费的。这对生成我非常不擅长的 c# 非常有帮助。（即它为我做了转义。）（如果有人认为我应该删除这个伪广告，请发表评论，但我认为它可能会有所帮助:) 美好时光）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T18:47:03.130

由于您想在拆分中包含单词，因此您应该使用类似

```
"\b#\w+\b" 
```

这包括表达式中的实际单词。但是我不确定这就是你想要的。您能否提供输入和所需输出的示例？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T18:47:12.477

使用 PHP 的[`preg_match_all()`](http://us2.php.net/manual/en/function.preg-match-all.php)：

```
$text = 'Test #string testing #my test #text.';
preg_match_all('/#[\S]+/', $text, $matches);

echo '<pre>';
print_r($matches[0]);
echo '</pre>'; 
```

输出：

```
大批
(
    [0] => #字符串
    [1] => #我的
    [2] => #文本。
)

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:50:05.840

这是Javascript中的代码：

```
text = "what #regEx can I use to #split a #string into whole words but only" 
// what #regEx can I use to #split a #string into whole words but only"
text.match(/#\w+/g);
// [#regEx,#split,#string] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T18:52:31.573

在 Microsoft RegEx 风格中，尝试：`\#:w`

这对我使用 Visual Studio 中的查找很有用。我不知道它将如何转化为 RegEx 类。

***编辑***：反斜杠被吞下。

# asp.net - 在母版页中多次使用 asp:content 标记

> ID：150044
> 
> 赞同：0
> 
> 时间：2008-09-29T18:39:52.120
> 
> 标签：asp.net

我是 ASP.NET 的新手，希望为页面标题设置一个 asp:content 控件，但我希望将该值用于标记和页眉。当我尝试使用两个具有相同 id 的标签来执行此操作时，它抱怨我不能有两个具有相同 id 的标签。有没有办法使用 contentplaceholders 来实现这一点，如果没有的话，在一个页面中两次使用母版页的单个参数的最简单方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T18:44:22.560

标题实际上是内容页面上的一个属性，因此您可以执行以下操作：

```
<%@ Page Language="C#" MasterPageFile="~/default.master" Title="My Content Title" %> 
```

在内容页面上。要将其放入页眉中，只需在母版页上呈现页面标题：

```
<h1><%= this.Page.Title %></h3> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T19:08:34.843

我看到有人刚刚为这个特定问题提供了一个（远）更好的答案。如果您的母版页在多个位置（不包括标题）具有相同的内容，则可以使用以下解决方案。

我能想出的最佳解决方案如下：

为页面标题添加一个`asp:Label`，为您希望文本出现的第二个位置添加另一个（使用两个不同的 id，例如：`pageTitle`和`sameTitle`）

向母版页添加方法：

```
public void SetPageTitle(string title)
{
    pageTitle.Text = title;
    sameTitle.Text = title;
} 
```

在您的内容页面上，调用母版页方法。如果您的内容页面有一个母版页，它有一个名为`Master`. 您现在可以`SetPageTitle`从内容页面方法调用该`PageLoad`方法：

```
((MyMasterPage) Master).SetPageTitle("My content page"); 
```

您还可以`MasterType`在母版页中使用该指令，查看[此处](http://msdn.microsoft.com/en-us/library/c8y19k6h.aspx)了解更多信息。通过这种方式，您可以获得一个`Master`不必强制转换的强类型属性：

```
Master.SetPageTitle("My content page"); 
```

问候，
罗纳德

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T03:05:57.247

此外，母版页可以有不同的内容标签（具有不同的 ID），如果您希望页面可能更改页面的各个部分，这很好。

# msbuild - MSBuild - 获取从命令行调用的目标

> ID：150047
> 
> 赞同：14
> 
> 时间：2008-09-29T18:40:23.630
> 
> 标签：msbuild, build-automation, automated-deploy

有谁知道如何获取从 MSBuild 命令行调用的目标 (/t) 的名称？可以调用几种类型的目标，我想在给用户的通知中使用该属性。

例子：

```
msbuild Project.proj /t:ApplicationDeployment /p:Environment=DEV 
```

我想访问`ApplicationDeployment`我的 .Proj 文件中的目标词。

有我可以访问的财产吗？任何线索如何做到这一点？

**编辑：**我不想也传递一个属性来获得这个。

**更新：**这是基于使用 MSBuild 脚本的**部署脚本。**我的构建服务器不用于部署代码，仅用于构建。构建服务器本身具有可以选择加入的构建通知。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T19:29:04.513

我不确定如何完全按照您的要求进行操作，但是您可以使用 /p 选项传递该字符串吗？

```
msbuild Project.proj /t:ApplicationDeployment /p:Environment=DEV;MyValue=ApplicationDeployment 
```

* * *

我能看到的唯一另一种方法是在每个目标中使用条件属性，从而建立要调用的第一个目标。

```
<Target Name="ApplicationDeployment">
<PropertyGroup>
  <InvokedTarget Condition="'${InvokedTarget}'==''">ApplicationDeployment</InvokedTarget>
</PropertyGroup>

...
</Target> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T16:04:10.487

我找到了答案！

```
<Target Name="ApplicationDeployment" >
    <CreateProperty Value="$(MSBuildProjectName) - $(Environment) - Application Deployment Complete">
      <Output TaskParameter="Value" PropertyName="DeploymentCompleteNotifySubject" />
    </CreateProperty> 
```

我想部分归功于冷漠。不知道该怎么做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T19:51:26.720

没有办法做到这一点（我知道）。MSBuild 没有请求构建的目标列表的属性。

但是，如果您找到方法，请记住它可能不是单个目标，而是要构建的目标列表。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-29T21:21:27.143

我建议使用像 CCNET 这样的服务器来处理构建执行和通知。当然，您可以对您的 MSBuild 脚本执行操作以发送通知，但该域属于构建服务器。

# visual-studio - 如何仅为调试构建运行 Visual Studio 构建后事件

> ID：150053
> 
> 赞同：642
> 
> 时间：2008-09-29T18:41:33.567
> 
> 标签：visual-studio, build-process

如何将我的构建后事件限制为仅针对一种构建类型运行？

我正在使用这些事件将 DLL 文件复制到本地 IIS 虚拟目录，但我不希望在发布模式下的构建服务器上发生这种情况。

* * *

## 回答 #1

> 赞同：810
> 
> 时间：2008-09-29T18:48:19.120

构建前和构建后事件作为批处理脚本运行。您可以对`$(ConfigurationName)`.

例如

```
if $(ConfigurationName) == Debug xcopy something somewhere 
```

* * *

## 回答 #2

> 赞同：551
> 
> 时间：2010-08-23T13:06:16.457

仅供参考，您不需要使用 goto。shell [IF](https://ss64.com/nt/if.html)命令可以与圆括号一起使用：

```
if $(ConfigurationName) == Debug (
  copy "$(TargetDir)myapp.dll" "c:\delivery\bin" /y
  copy "$(TargetDir)myapp.dll.config" "c:\delivery\bin" /y
) ELSE (
  echo "why, Microsoft, why".
) 
```

* * *

## 回答 #3

> 赞同：136
> 
> 时间：2008-09-29T18:47:13.520

像往常一样添加您的后期构建事件。然后保存您的项目，在[记事本](https://en.wikipedia.org/wiki/Notepad_%28software%29)（或您喜欢的编辑器）中打开它，并将条件添加到 PostBuildEvent 属性组。这是一个例子：

```
<PropertyGroup Condition=" '$(Configuration)' == 'Debug' ">
    <PostBuildEvent>start gpedit</PostBuildEvent>
</PropertyGroup> 
```

* * *

## 回答 #4

> 赞同：109
> 
> 时间：2009-07-24T09:56:39.767

或者（因为将事件放入批处理文件然后调用），使用以下内容（在构建事件框中，而不是在批处理文件中）：

```
if $(ConfigurationName) == Debug goto :debug

:release
signtool.exe ....
xcopy ...

goto :exit

:debug
' Debug items in here

:exit 
```

这样，您可以为任何配置设置事件，并且仍然使用宏对其进行管理，而不必将它们传递到批处理文件中，记住`%1`is`$(OutputPath)`等。

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2020-01-08T16:59:00.620

从 Visual Studio 2019 开始，现代`.csproj`格式支持直接在`Target`元素上添加条件：

```
<Target Name="PostBuild" AfterTargets="PostBuildEvent" Condition="'$(Configuration)' == 'Debug'">
    <Exec Command="nswag run nswag.json" />
</Target> 
```

UI 没有提供设置方法，但`Configuration`如果您通过 UI 进行更改，它似乎可以安全地保留属性。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2016-02-22T13:21:27.410

Visual Studio 2015：正确的语法是（保持一行）：

```
if "$(ConfigurationName)"=="My Debug CFG" ( xcopy "$(TargetDir)test1.tmp" "$(TargetDir)test.xml" /y) else ( xcopy "$(TargetDir)test2.tmp" "$(TargetDir)test.xml" /y) 
```

这里没有错误255。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-29T18:44:05.010

您可以将配置名称传递给构建后脚本并在那里检查它是否应该运行。

使用 传递配置名称`$(ConfigurationName)`。

检查它基于您如何实现构建后步骤——它将是一个命令行参数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-02-04T14:37:22.467

我发现我可以像这样在项目文件中放置多个条件：

```
 <Target Name="PostBuild" AfterTargets="PostBuildEvent" Condition=" '$(Configuration)' != 'Debug' AND '$(Configuration)' != 'Release' ">
      <Exec Command="powershell.exe -ExecutionPolicy Unrestricted -NoProfile -NonInteractive -File $(ProjectDir)postBuild.ps1 -ProjectPath $(ProjectPath) -Build $(Configuration)" />
  </Target> 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-06-29T14:59:13.620

这适用于我在 Visual Studio 2015 中。

我将所有 DLL 文件从位于与我的解决方案文件夹相同级别的库文件夹中的文件夹中复制到正在构建的项目的目标目录中。

使用我的项目目录中的相对路径并使用..\..\lib 将文件夹结构向上两步

MySolutionFolder
....MyProject
库

```
if $(ConfigurationName) == Debug (
xcopy /Y "$(ProjectDir)..\..\lib\*.dll" "$(TargetDir)"
) ELSE (echo "Not Debug mode, no file copy from lib") 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-09-29T18:48:43.767

与任何项目设置一样，构建事件可以按配置进行配置。只需在“属性页”对话框的下拉列表中选择要更改的配置，然后编辑构建后步骤。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2012-12-14T07:46:20.463

在 Visual Studio 2012 中你必须使用（我认为在 Visual Studio 2010 中也是如此）

```
if $(Configuration) == Debug xcopy 
```

`$(ConfigurationName)`被列为宏，但未分配。

![在此处输入图像描述](https://i.stack.imgur.com/CWF67.png)

比较：*[构建命令和属性的宏](https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2012/c02as0cs(v=vs.110))*

# mysql - mysql“删除数据库”需要时间——为什么？

> ID：150058
> 
> 赞同：11
> 
> 时间：2008-09-29T18:42:14.657
> 
> 标签：mysql, database, schema, innodb

mysql5.0 带有一对数据库“A”和“B”，都带有大型 innodb 表。“删除数据库 A；” 冻结数据库“B”几分钟。那时什么都没有使用“A”，那么为什么这是一个如此密集的操作呢？

加分点：假设我们使用“A”，将数据上传到“B”，然后切换到使用“B”，我们怎样才能更快地做到这一点？删除数据库并不是人们通常必须一直做的事情，所以这有点离谱。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-08-29T05:05:05.253

所以我不确定[马特罗吉什的回答](https://stackoverflow.com/a/150763)是否会帮助 100%。

问题是 MySQL* 在打开和关闭表周围有一个互斥锁（互斥锁），因此这基本上意味着如果一个表正在关闭/删除，则*无法*打开其他表。

This is described by a colleague of mine here: [http://www.mysqlperformanceblog.com/2009/06/16/slow-drop-table/](http://www.mysqlperformanceblog.com/2009/06/16/slow-drop-table/)

One excellent impact reduction strategy is to use a filesystem like XFS.

The workaround is ugly. You essentially have to nibble away at all the data in the tables before dropping them (see comment #11 on the link above).

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-29T21:27:21.967

继斯卡夫曼之后：

更改您的 my.cnf（并重新启动 MySQL）以包括：

```
innodb_file_per_table = 1 
```

( [http://mysqldba.blogspot.com/2006/12/innodbfilepertable.html](http://mysqldba.blogspot.com/2006/12/innodbfilepertable.html) )

这将为您的数据库提供专用文件存储并将其从共享池中取出。然后它会让你做一些有趣的事情，比如将表/索引放在不同的物理磁盘上，以进一步拆分 I/O 并提高性能。

请注意，这不会更改现有表；您必须做一些工作才能将它们放入自己的文件中（[http://capttofu.livejournal.com/11791.html](http://capttofu.livejournal.com/11791.html)）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T18:52:47.283

默认情况下，给定 mysql 服务器安装中的所有 innodb 数据库使用相同的数据文件物理池，因此可以想象“删除数据库 A”可能会影响数据库 B。由于“删除数据库”可能涉及大量重组 innodb 数据文件，可以想象这是一个阻塞操作，要么是因为操作的强度，要么是设计使然。

但是，我认为你可以让每个数据库使用不同的物理文件，虽然我自己没有尝试过，所以你必须自己弄清楚细节。如果做不到这一点，那么您可能需要在同一台机器上并排使用两个不同的 mysql 安装，这是完全可行的。

# ruby-on-rails - How Do I Authenticate to ActiveResource to Avoid the InvalidAuthenticityToken Response?

> ID：150076
> 
> 赞同：2
> 
> 时间：2008-09-29T18:45:03.107
> 
> 标签：ruby-on-rails, ruby, activeresource

I created a Rails application normally. Then created the scaffold for an event class. Then tried the following code. When run it complains about a InvalidAuthenticityToken when the destroy method is executed. How do I authenticate to avoid this response?

```
require 'rubygems'
require 'activeresource'

class Event < ActiveResource::Base
  self.site = "http://localhost:3000"
end

e = Event.create(
  :name => "Shortest Event Ever!",
  :starts_at => 1.second.ago,
  :capacity => 25,
  :price => 10.00)

e.destroy 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T19:16:05.060

I found an answer to this issue which works since I am writing a command-line application. I added the following to my controller:

```
 # you can disable csrf protection on controller-by-controller basis:
  skip_before_filter :verify_authenticity_token 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T14:36:55.260

Rails only requires this when you're requesting html, if you're requesting xml (possibly anything other than html?) it doesn't check for that. Looks like the destroy action for your server needs an xml response and the problem should go away.

# .net - 如何隐藏 Pocket Internet Explorer 元素？

> ID：150083
> 
> 赞同：0
> 
> 时间：2008-09-29T18:46:35.380
> 
> 标签：.net, javascript, windows-mobile

如何在 Windows Mobile 6 设备上运行的 Pocket Internet Explorer 上隐藏 html 中的元素。即使正确设置值，以下代码也不起作用。

```
function ShowCollapseElement(sLinkId, sContentId)
    {
    var oLinkElement;
    var oContentElement;

    //Get the elements
    oLinkElement = document.getElementById(sLinkId);
    oContentElement = document.getElementById(sContentId);

    //Toggle the visibility of the content
    oContentElement.style.display = (oContentElement.style.display != 'none' ? 'none' : 'inline');

    //Set the link text
    oLinkElement.innerText = (oContentElement.style.display != 'none' ? '-' : '+');
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T19:08:42.783

我刚刚发现当元素是 div 时代码有效，但不适用于表格行。我将不得不接受使用 div。

# c# - 在 XPath 中抽象存储数据结构

> ID：150084
> 
> 赞同：1
> 
> 时间：2008-09-29T18:46:46.347
> 
> 标签：c#, xml, .net-3.5, datatable

我有一组存储在 XDocuments 和 DataTables 中的数据，我希望将这两个数据都作为一个带有 XPath 查询的统一数据空间来处理。因此，例如，“/Root/Tables/Orders/FirstName”将获取名为“Orders”的 DataTable 的每一行中 Firstname 列的值。

有没有办法在不将 DataTable 中的所有记录复制到 XDocument 的情况下做到这一点？

我正在使用.Net 3.5

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T22:15:08.820

.NETs XPath 的东西在 IXPathNavigable 接口上运行。每个 IXPathNavigable 都有一个返回 IXPathNavigator 的 CreateNavigator() 方法。

为了将所有数据源公开为一个大文档，您需要创建一个实现 IXPathNavigable 的类，其中包含所有 xpath 数据源。CreateNavigator 方法应该返回一个自定义 XPathNavigator，它将内容公开为一个大型数据源。

不幸的是，实现这个导航器有些繁琐，必须小心，尤其是在文档之间跳转时，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T17:45:04.740

我最终自己想出了这个问题的答案。我在 System.Xml.LINQ 中发现了一个名为 XStreamingElement 的类，它可以从 LINQ 表达式动态创建 XML 结构。这是一个将 DataTable 转换为 XML 空间的示例。

```
Dictionary<string,DataTable> Tables = new Dictionary<string,DataTable>();
// ... populate dictionary of tables ...
XElement TableRoot = new XStreamingElement("Tables",
    from t in Tables
    select new XStreamingElement(t.Key,
               from DataRow r in t.Value.Rows
               select new XStreamingElement("row",
                          from DataColumn c in t.Value.Columns
                          select new XElement(c.ColumnName, r[c]))))) 
```

结果是一个具有类似于以下结构的 XElement (TableRoot)，假设字典包含一个名为“Orders”的表，其中包含两行。

```
<Tables>
    <Orders>
        <row>
            <sku>12345</sku>
            <quantity>2</quantity>
            <price>5.95</price>
        </row>
        <row>
            <sku>54321</sku>
            <quantity>3</quantity>
            <price>2.95</price>
        </row>
    </Orders>
</Tables> 
```

这可以与更大的基于 XElement/XDocument 的层次结构合并并使用 XPath 进行查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T18:54:54.970

您是否正在寻找类似于我询问的有关[XPath 外键](https://stackoverflow.com/questions/142010/can-xpath-do-a-foreign-key-lookup-across-two-subtrees-of-an-xml)的内容？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:10:20.743

正如 XPath 建议所说，“XPath 的主要目的是处理 XML 文档的各个部分。” 它没有任何工具来处理多个 XML 文档的各个部分。如果你想做你想做的事，你必须建立一个单一的 XML 文档。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-29T21:26:21.500

您将不得不合并您的文档，或者至少对所有文档执行相同的转换。您可以考虑将文档移动到单个 DataTable，然后在 XPath / XSLT 不可行时过滤 DataTable。

# ruby - Interpolating a string into a regex

> ID：150095
> 
> 赞同：169
> 
> 时间：2008-09-29T18:48:33.673
> 
> 标签：ruby, regex

I need to substitute the value of a string into my regular expression in Ruby. Is there an easy way to do this? For example:

```
foo = "0.0.0.0"
goo = "here is some other stuff 0.0.0.0" 
if goo =~ /value of foo here dynamically/
  puts "success!"
end 
```

* * *

## 回答 #1

> 赞同：290
> 
> 时间：2008-09-29T18:53:54.597

Same as string insertion.

```
if goo =~ /#{Regexp.quote(foo)}/
#... 
```

* * *

## 回答 #2

> 赞同：133
> 
> 时间：2008-09-29T20:51:47.263

Note that the [`Regexp.quote`](http://ruby-doc.org/core/Regexp.html#method-c-quote) in [Jon L.'s answer](https://stackoverflow.com/a/150115/211563) is important!

```
if goo =~ /#{Regexp.quote(foo)}/ 
```

If you just do the "obvious" version:

```
if goo =~ /#{foo}/ 
```

then the periods in your match text are treated as regexp wildcards, and `"0.0.0.0"` will match `"0a0b0c0"`.

Note also that if you really just want to check for a substring match, you can simply do

```
if goo.include?(foo) 
```

which doesn't require an additional quoting or worrying about special characters.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-29T18:52:49.497

Probably `Regexp.escape(foo)` would be a starting point, but is there a good reason you can't use the more conventional expression-interpolation: `"my stuff #{mysubstitutionvariable}"`?

Also, you can just use `!goo.match(foo).nil?` with a literal string.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T18:53:16.987

```
Regexp.compile(Regexp.escape(foo)) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T18:52:42.947

Use Regexp.new:

```
if goo =~ Regexp.new(foo) # Evaluates to /0.0.0.0/ 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-10-31T22:17:56.240

Here's a limited but useful other answer:

I discovered I that I can easily insert into a regex without using Regexp.quote or Regexp.escape if I just used single quotes on my input string: (an IP address match)

```
IP_REGEX = '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'

my_str = "192.0.89.234 blahblah text 1.2, 1.4" # get the first ssh key 
# replace the ip, for demonstration
my_str.gsub!(/#{IP_REGEX}/,"192.0.2.0") 
puts my_str # "192.0.2.0 blahblah text 1.2, 1.4" 
```

single quotes only interpret \\ and \'.

[http://en.wikibooks.org/wiki/Ruby_Programming/Strings#Single_quotes](http://en.wikibooks.org/wiki/Ruby_Programming/Strings#Single_quotes)

This helped me when i needed to use the same long portion of a regex several times. Not universal, but fits the question example, I believe.

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-29T18:54:02.803

```
foo = "0.0.0.0"
goo = "here is some other stuff 0.0.0.0" 

puts "success!" if goo =~ /#{foo}/ 
```

# c# - 抛出异常导致运行时错误

> ID：150104
> 
> 赞同：1
> 
> 时间：2008-09-29T18:51:32.933
> 
> 标签：c#, jquery, exception, web

我们开发了一个使用 MVC、C# 和 jQuery 的网站。在我的一个控制器类中，我们正在验证来自用户的输入，如果失败，我们将抛出 Ajax 错误参数（又名选项）处理的异常。（我们使用 Block UI 来显示错误消息。BlockUI 是一个 jQuery 插件，它会阻止屏幕并显示消息框。）（是的，消息中有文本，没有有趣的字符或无意义的）

在本地或服务器上运行网站时，我们会从抛出的异常中收到不同的效果。

本地：在 BlockUI 中显示正确的异常。服务器：显示消息“运行时错误”而不是异常消息。

```
print(  
    public ActionResult FailUpdateStatus(string id)
    {
        string message = Request.Form["message"];

        throw new Exception(message);
    }
); 
```

我已经能够在服务器上运行该网站并远程附加到该网站。在调试异常时，它应该被抛出，但阻止 UI 显示运行时错误。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T19:16:11.453

默认情况下，ASP.NET Web 应用程序将对访问该站点的远程计算机隐藏错误，并且只会返回通用的“运行时错误”。ASP.NET 只会在本地访问站点时显示特定于应用程序的错误消息（即，如果 ASP.NET 应用程序服务器正在本地开发机器上运行，或者如果您在托管 ASP.NET Web 的服务器上打开 Web 浏览器）应用）。

要查看从本地客户端在远程服务器上生成的消息，请将以下代码添加到您的 web.config 文件中。

```
<configuration><system.web><customErrors mode="Off"/></system.web></configuration> 
```

# .net - 使用 System.Web.Mail 发送邮件时出错

> ID：150113
> 
> 赞同：2
> 
> 时间：2008-09-29T18:53:34.007
> 
> 标签：.net, email, exchange-server

使用 System.Web.Mail 的旧应用程序对来自*hr@domain.com*的电子邮件抛出异常。其他地址似乎工作正常。当错误开始时，我们将邮件服务器更改为 Exchange 2007，所以我认为这就是问题所在。有谁知道发生了什么？

这是异常和堆栈跟踪：

> System.Web.HttpException：无法访问“CDO.Message”对象。---> System.Reflection.TargetInvocationException：调用的目标已抛出异常。---> System.Runtime.InteropServices.COMException (0x80040212)：传输失去了与服务器的连接。
> 
> --- 内部异常堆栈跟踪结束 ---
> 在 System.RuntimeType.InvokeDispMethod(String name, BindingFlags invokeAttr, Object target, Object[] args, Boolean[] byrefModifiers, Int32culture, String[] namedParameters)
> 在 System.RuntimeType .InvokeMember(String name, BindingFlags invokeAttr, Binder binder, Object target, Object[] args, ParameterModifier[] 修饰符, CultureInfo 文化, String[] namedParameters)
> 在 System.Web.Mail.LateBoundAccessHelper.CallMethod(Object obj, String methodName, Object[] args)
> --- 内部异常堆栈跟踪结束 ---
> 在 System.Web.Mail.LateBoundAccessHelper.CallMethod(Object obj, String methodName , Object[] args)
> 在 System.Web.Mail.CdoSysHelper.Send(MailMessage message)
> 在 System.Web.Mail.SmtpMail.Send(MailMessage message)
> 在 ProcessEmail.Main()

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-29T18:55:58.913

您客户的主机是否有权通过 Exchange Sever 发送邮件？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T18:56:24.247

[这是一个诊断这些异常的教程](http://www.systemwebmail.com/faq/4.2.3.aspx)（一个非常常见的具有很多含义的）。

# c# - 解析性能（If、TryParse、Try-Catch）

> ID：150114
> 
> 赞同：33
> 
> 时间：2008-09-29T18:53:35.503
> 
> 标签：c#, parsing, text

我非常了解处理解析文本以获取信息的不同方式。例如，对于解析整数，可以预期什么样的性能。我想知道是否有人知道这方面的任何好的统计数据。我正在从测试过这个的人那里寻找一些真实的数字。

其中哪一个在哪些情况下提供最佳性能？

```
Parse(...)  // Crash if the case is extremely rare .0001%

If (SomethingIsValid) // Check the value before parsing
    Parse(...)

TryParse(...) // Using TryParse

try
{
    Parse(...)
}
catch
{
    // Catch any thrown exceptions
} 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-29T18:56:09.240

始终使用**T.TryParse(string str, out T value)**。*抛出异常是昂贵的，如果你可以先验*地处理这种情况，应该避免。使用 try-catch 块来“节省”性能（因为您的无效数据率很低）是对异常处理的滥用，以牺牲可维护性和良好的编码实践为代价。遵循完善的软件工程开发实践，编写测试用例，运行应用程序，然后进行基准测试和优化。

> “我们应该忘记小的效率，比如大约 97% 的时间：**过早的优化是万恶之**源。但我们不应该放弃那关键的 3% 的机会”——Donald Knuth

因此，您像在碳信用中一样任意指定 try-catch的性能*更差*，而 TryParse 的性能*更好*。只有在我们运行我们的应用程序并确定我们有某种类型的字符串解析速度变慢之后，我们才会考虑使用 TryParse 以外的任何东西。

*（编辑：因为看起来提问者希望计时数据有好的建议，这里是所要求的计时数据）*

来自用户的 10,000 次输入的各种失败率的时间（对于非信徒）：

```
Failure Rate      Try-Catch          TryParse        Slowdown
  0%           00:00:00.0131758   00:00:00.0120421      0.1
 10%           00:00:00.1540251   00:00:00.0087699     16.6
 20%           00:00:00.2833266   00:00:00.0105229     25.9
 30%           00:00:00.4462866   00:00:00.0091487     47.8
 40%           00:00:00.6951060   00:00:00.0108980     62.8
 50%           00:00:00.7567745   00:00:00.0087065     85.9
 60%           00:00:00.7090449   00:00:00.0083365     84.1
 70%           00:00:00.8179365   00:00:00.0088809     91.1
 80%           00:00:00.9468898   00:00:00.0088562    105.9
 90%           00:00:01.0411393   00:00:00.0081040    127.5
100%           00:00:01.1488157   00:00:00.0078877    144.6

/// <param name="errorRate">Rate of errors in user input</param>
/// <returns>Total time taken</returns>
public static TimeSpan TimeTryCatch(double errorRate, int seed, int count)
{
    Stopwatch stopwatch = new Stopwatch();
    Random random = new Random(seed);
    string bad_prefix = @"X";

    stopwatch.Start();
    for(int ii = 0; ii < count; ++ii)
    {
        string input = random.Next().ToString();
        if (random.NextDouble() < errorRate)
        {
           input = bad_prefix + input;
        }

        int value = 0;
        try
        {
            value = Int32.Parse(input);
        }
        catch(FormatException)
        {
            value = -1; // we would do something here with a logger perhaps
        }
    }
    stopwatch.Stop();

    return stopwatch.Elapsed;
}

/// <param name="errorRate">Rate of errors in user input</param>
/// <returns>Total time taken</returns>
public static TimeSpan TimeTryParse(double errorRate, int seed, int count)
{
    Stopwatch stopwatch = new Stopwatch();
    Random random = new Random(seed);
    string bad_prefix = @"X";

    stopwatch.Start();
    for(int ii = 0; ii < count; ++ii)
    {
        string input = random.Next().ToString();
        if (random.NextDouble() < errorRate)
        {
           input = bad_prefix + input;
        }

        int value = 0;
        if (!Int32.TryParse(input, out value))
        {
            value = -1; // we would do something here with a logger perhaps
        }
    }
    stopwatch.Stop();

    return stopwatch.Elapsed;
}

public static void TimeStringParse()
{
    double errorRate = 0.1; // 10% of the time our users mess up
    int count = 10000; // 10000 entries by a user

    TimeSpan trycatch = TimeTryCatch(errorRate, 1, count);
    TimeSpan tryparse = TimeTryParse(errorRate, 1, count);

    Console.WriteLine("trycatch: {0}", trycatch);
    Console.WriteLine("tryparse: {0}", tryparse);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T18:56:37.943

Try-Catch 总是较慢。TryParse 会更快。

IF 和 TryParse 是相同的。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-09-29T18:59:28.563

```
Option 1: Will throw an exception on bad data.
Option 2: SomethingIsValid() could be quite expensive - particularly if you are pre-checking a string for Integer parsability.
Option 3: I like this.  You need a null check afterwards, but it's pretty cheap.
Option 4 is definitely the worst. 
```

异常处理相对昂贵，因此请尽可能避免。

特别是，错误的输入是意料之中的，而不是例外，所以你不应该在这种情况下使用它们。

（尽管在 TryParse 之前，它可能是最好的选择。）

# c# - C# .NET / javascript : Collapsable Table Rows - 这是怎么回事？

> ID：150124
> 
> 赞同：0
> 
> 时间：2008-09-29T18:56:22.983
> 
> 标签：c#, .net, collapsable

我有一个 C# .NET 页面，我想在按下按钮时使行折叠。我发现了很多类似这样的教程（[http://codingforums.com/archive/index.php?t-90375.html](http://codingforums.com/archive/index.php?t-90375.html)），试图实现他们的解决方案，但是当我点击我的按钮时，它们都没有为我做任何事情。为了确保我不会发疯，我制作了一个小测试页来看看这个想法是否有效。出于某种原因，它不是。浏览器是IE6。我正在运行 Visual Studio 2005。有谁知道为什么这不起作用？正如我所期望的那样，呈现的页面显示了一个按钮和一行文本；单击按钮时，文本行不会消失。我知道我可以使用 div，但请记住，这只是一个概念证明；在我的实际应用程序中，必须折叠的是表格行。

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Test.aspx.cs" Inherits="Project.Web.Auth.Test" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head id="Head1" runat="server">
    <title>Shop Financials</title>
    <link href="../StyleSheets/ClaimsV2.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript">     

        function btnClick(control)
        {   
            try
            {
                var id_table = document.getElementById(control).style;

                if(id_table.display == "block") 
                {
                   id_table.display = "none";
                }
                else 
                {
                    id_table.display = "block";
                }
            }
            catch(e)
            {
                alert(e);
            }   
       }

       function toDepositPrinterFriendly()
       {

       }

  </script>
</head>
<body>
    <form id="form1" runat="server">

    <table>
    <tr>
    <td><asp:Button runat="server" OnClientClick="javascript:btnClick('HeaderRow')"/></td>

    </tr>
    <tr id="HeaderRow" runat="server">
    <td>TEST2</td>

    </tr>    

    </table>

    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T19:00:43.100

1）显示器最初（可能）不是“阻塞”。尝试：

> ```
> if(id_table.display == 'none') 
> {
>   id_table.display = '';
> }
> else 
> {
>   id_table.display = 'none';
> } 
> ```

[2) 由于Naming Containers](http://aspadvice.com/blogs/joteke/archive/2007/02/25/Understanding-the-naming-container-hierarchy-of-ASP.NET-databound-controls.aspx)，控件的 id 不会是你想象的那样。检查您的 HTML 源代码

# language-agnostic - 什么是 Lambda？

> ID：150129
> 
> 赞同：94
> 
> 时间：2008-09-29T18:56:51.110
> 
> 标签：language-agnostic, lambda, computer-science, terminology

有人可以很好地描述 Lambda 是什么吗？我们为它们提供了一个标签，它们在 C# 问题的秘密上，但我还没有找到一个很好的定义和解释它们是什么。

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-09-29T19:12:54.160

闭包、lambdas 和匿名函数不一定是同一回事。

匿名函数是没有（或至少不需要）自己的名称的任何函数。

闭包是一个函数，它可以访问在声明时处于其词法范围内的变量，即使它们已经*超出*范围。匿名函数不一定必须是闭包，但它们在大多数语言中都存在，并且当它们不是时变得相当不有用。

就计算机科学而言，lambda 的定义并不十分明确。许多语言甚至不使用该术语。相反，他们只会称它们为闭包或匿名函数或发明自己的术语。在 LISP 中，lambda 只是一个匿名函数。在 Python 中，lambda 是一个匿名函数，专门限于单个表达式；还有什么，你需要一个命名函数。Lambda 是两种语言的闭包。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-29T19:03:25.447

也称为闭包或匿名函数。我在[这里](http://martinfowler.com/bliki/Closure.html)找到了最好的描述。基本上，可以作为参数传递给函数的内联代码块。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-29T19:00:49.993

“Lambda”指的是[Lambda 演算](http://en.wikipedia.org/wiki/Lambda_calculus)或特定的 lambda 表达式。Lambda演算基本上是处理函数的逻辑和数学的一个分支，是[函数式编程语言](http://en.wikipedia.org/wiki/Functional_programming)的基础。

~ 威廉·莱利-兰德

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-29T18:59:49.107

它只是一个内联声明的匿名函数，通常在您不想编写完整的函数时分配给委托。

在像 lisp/scheme 这样的语言中，它们通常作为函数参数被自由地传递，但 C# 中的习惯用法通常会发现 lambdas 仅用于函数的惰性求值，如在 linq 中，或者用于使事件处理代码更简洁。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-29T19:04:17.583

编程中并没有真正的“lambda”之类的东西。这取决于语言等。

简而言之，通常“具有 lambdas”的语言使用匿名函数这个术语，或者在某些情况下，使用闭包。就像这样，在 Ruby 中：

```
f = lambda { return "this is a function with no name" }
puts f.call 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-08-17T07:42:19.883

回应前面的答案：
-关于匿名函数的重要之处不是它们不需要名称。
-闭包是一个单独的概念。
- 一篇巨大的维基百科文章并没有让这一点变得更清楚。

这是我的回答分三部分：
1\. lambda 是一个函数，也是一个表达式。这是重要的事情。
2\. 许多实现所谓的“lambdas”的语言添加了一些*语法糖*以使编写这些短函数更容易和更快，但这不是必需的。
3\. 某些语言可能要求 lambda*没有副作用*。从功能意义上讲，那将是一个更纯粹的 lambda。

当函数是表达式时，它是语言中的“一等公民”。我可以用它做所有重要的事情：

```
x = lambda(){ return "Hello World"; }

doit( 1, 2, lambda(a,b){ return a > b; }, 3 )

x = (lambda(a){ return a+1; }) + 5  // type error, not syntax error

(lambda(a,b){ print(a); log(b); })( 1, 2 )  // () is valid operator here 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T18:59:09.513

摘自维基百科：[http ://en.wikipedia.org/wiki/Lambda#Lambda.2C_the_word](http://en.wikipedia.org/wiki/Lambda#Lambda.2C_the_word)

在 Lisp 和 Python 等编程语言中，lambda 是一个运算符，用于表示匿名函数或闭包，遵循 lambda 演算用法。

# wpf - 使用 WPF MediaElement 渲染 HDVideo 是否成功？WPF 有更好的视频播放器选项吗？

> ID：150143
> 
> 赞同：7
> 
> 时间：2008-09-29T19:00:35.907
> 
> 标签：wpf, video, mediaelement

我正在使用 WPF MediaElement 在应用程序中呈现高清视频。当 MediaElement 的大小超过大约 300 平方单位时，视频会卡顿，并且计算机几乎完全没有响应。我需要全屏渲染视频。

有没有人使用 WPF MediaElement 成功渲染全屏视频？

使用的计算机的处理器/视频规格是什么？

有没有更好的方法在 WPF 应用程序中显示视频？

**编辑：**
[蒂莫西：](https://stackoverflow.com/questions/150143/any-success-rendering-hdvideo-with-wpf-mediaelement-is-there-a-better-video-pla#150613) 我需要能够将文本或其他元素放在图形上，所以我认为托管 WMP 已经过时了。

目前我没有做任何图层或不透明度/透明度。

我目前在 XP 中运行。我希望能够在 Vista 和 XP 中运行该应用程序。

[Mike：](https://stackoverflow.com/questions/150143/any-success-rendering-hdvideo-with-wpf-mediaelement-is-there-a-better-video-pla#150526) 在回来查看这篇文章之前，我正在阅读 MSDN 论坛上的一些 Jeremiah Morrill 的文章。我找到了去他的一些图书馆的路，并将对其进行测试。谢谢。

**更新：**

看来问题出在我的开发机器上。在测试机器上一切正常。我的开发机器是双头的，带有 2 个 1650x1080 CRT，带有 ATI Radon X1650 系列卡和 256MB 内存。

使用 WPF perfmon 工具时，它表明一切都是硬件渲染的，但性能很差。现在我将继续使用它，因为我知道代码在我们分发它的机器上运行良好。在未来的某个时候，我将尝试深入研究为什么它在我的开发机器上表现如此糟糕。（所有机器都是XP）。

感谢所有的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T20:34:49.673

Jeremiah Morrill 最近发布了一个[专门的 WPF 库](http://www.codeplex.com/WPFMediaKit)，支持显示高清媒体（以及其他功能）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T12:06:19.760

我认为这只是 Windows XP 中的一个问题。似乎视频播放没有随着 vsync 更新。因此，它会随时更新屏幕。在 Vista 中，WPF 的视频渲染更智能一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T17:10:10.743

您的高清视频的分辨率/格式是什么？

我在双核 2.6ghz 全屏上完成了 720p WMV，没有任何问题，但里面有 NVidia 9800GXT。仅 WMP 中高清视频的 CPU 使用率是多少？请记住，在 WPF 中呈现任何内容都会产生一些开销。因此，如果您正在运行接近 100% 的 CPU，则渲染到 WPF 可能足以将其设置完毕。此外，如果您的 GPU 太慢，您可能还会遇到断断续续的视频。

-耶利米

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T20:54:05.620

它肯定似乎无法正常工作。可能是测试其他层的不透明度太慢了。您是否尝试过在 Aero 关闭的情况下运行测试？

有人建议托管 Windows Media Player 可能是要走的路。

[演练：使用 XAML 在 Windows Presentation Foundation 中托管 ActiveX 控件](http://msdn.microsoft.com/en-us/library/ms748870.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-13T13:41:30.353

老线程，但只是想分享我自己的经验。我的猜测是您的分配机是单显示器。我曾经在我的笔记本电脑上安装了第二台显示器，发现视频的前几秒是不可见的，然后是令人震惊的视频。删除并禁用附加监视器解决了问题。我看到更多关于媒体元素在双显示器环境中出现问题的报道。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-10T21:34:50.293

使用正确的vsync应该可以解决问题，不一定与wpf和vista有关。一些 ATI 卡带有默认关闭 vsync 选项的图形驱动程序。希望这可以帮助。

# spring - 使用 Spring 分离表示层和业务层

> ID：150146
> 
> 赞同：4
> 
> 时间：2008-09-29T19:02:04.267
> 
> 标签：spring, n-tier-architecture

在我刚刚完成的项目中，我正在努力让分布式事务正常工作。

我们使用 JBoss 的 Arjuna 事务管理器和 Spring 的声明性事务边界来实现这一点。

我们的请求序列如下所示：

```
browser -> secured servlet -> 'wafer-thin' SLSB -> spring TX-aware proxy -> request-handler POJO 
```

这意味着我们有一个 WAR 服务于我们的安全 servlet 和一个 EAR 服务于我们的 SLSB。

我们的 SLSB 有一个静态初始化块来引导我们的 Spring 应用程序上下文。

我不喜欢技术的混合，但我喜欢表示层和业务层的分离，它们可以驻留在不同的物理位置。

我很想知道其他人在使用 Spring 时建议将层分开吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T03:37:38.470

只为作为外观的 SLSB 需要 EJB3 应用程序服务器对我来说似乎不值得付出努力。您没有理由不能直接删除它并让您的 servlet 直接与 Spring 一起工作。您可以将 ContextLoaderListener 添加到 WAR 以加载您的 ApplicationContext，然后添加 WebApplicationContextUtils 以获取它。或者，如果您需要做的事情超出了 Servlet 本身所允许的范围，您可以使用 SpringMVC、Struts 或其他 Web 技术。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T04:06:56.037

一种非常典型的方法是定义 Web 层、服务层和 DAO 层，并将事务语义附加到服务层。例如，服务层可能是一堆带有 @Transactional 注释的 POJO。Web 层可能是 Spring Web MVC 控制器。在这种方法中，Web 层本质上是使服务层适应 HTTP。良好的分离，这里不需要 SLSB。

然而，一个争论的领域是关于域对象，如 Employee 或 PurchaseOrder 或其他。这些跨应用程序层和似乎与注释一起发生的一件事是域对象获得与特定层相关的注释。因此，您可能在此处使用 ORM 注释，然后使用相同的域对象作为表单支持 bean，以避免并行域/表单对象类。有些人反对这违反了架构上的关注点分离。

# .net - 如何在 WPF 中的上下文菜单和常规菜单之间共享菜单定义

> ID：150150
> 
> 赞同：2
> 
> 时间：2008-09-29T19:02:59.130
> 
> 标签：.net, wpf, xaml

我有一个已定义的 MenuItem，我想在一页上的两个不同菜单之间共享它。该菜单包含两个菜单之间相同的功能，我不想要它的两个副本。无论如何要在 Page.Resources 中定义一个 MenuItem 并在下面的 ContextMenu XAML 中引用它？

```
<Page.Resources>
    <MenuItem x:Key="123"/>
</Page.Resources>

<ContextMenu>
    <MenuItem>Something hardcoded</MenuItem>

    <!-- include shared menu here -->

</ContextMenu> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T21:15:27.830

我通过在菜单项本身上设置 x:Shared="False" 来做到这一点。默认情况下，资源在使用它们的每个地方之间共享（意味着所有使用中的一个实例），因此关闭它意味着每次都会制作资源的新“副本”。

所以：

```
<MenuItem x:Key="myMenuItem" x:Shared="False" /> 
```

您仍然会得到它的“副本”，但您只需要在一个地方定义它。看看是否有帮助。您可以在菜单定义中这样使用它：

```
<StaticResource ResourceKey="myMenuItem" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T19:17:12.700

因为你想混合搭配......我会制作一个继承自 ContextMenu 的自定义控件，它具有“SharedMenuItems”依赖属性和 MenuItems 依赖属性。这样，您的控件可以决定如何将这两个集合合并在一起。如果你想要一个这样的例子，请告诉我。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T04:42:31.623

许多选项：a）将 ContextMenu 或菜单数据绑定到相同的底层集合并使用项目模板等到工作 b）使用命令，并将数据绑定到一组命令绑定

# wpf - 如何在画布上使用大量多边形来提高性能和内存使用率？

> ID：150151
> 
> 赞同：5
> 
> 时间：2008-09-29T19:03:21.360
> 
> 标签：wpf, performance

我正在处理的项目需要渲染一个 ESRI 形状文件，该文件可以有大量的多边形/形状。当我将所有这些多边形、线条、点等添加到我正在使用的画布上时，它变得非常慢。

为了在地图上绘制形状，我创建了一个 Path 对象，并将其 Data 属性设置为 StreamGeometry。我最初使用的是多边形，但根据 MSDN，StreamGeometry 的重量要轻得多。

我怎样才能提高性能？将成品转换为位图或 VisualBrush 有帮助吗？有没有更有效的方法将所有这些形状渲染到画布上？

编辑：我忘了提到这需要能够在 Partial-Trust XBAP 中工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T20:27:36.150

无需求助于 GDI，您只需在 WPF API 中向下移动一层并将您的几何图形组合成更少的视觉效果。Pablo Fermicola 提供了一些有用的信息，可根据您的性能需求[选择要使用的层。](http://www.fernicola.org/loquitor/index.php?/archives/17-WPF-Pick-Your-API-Abstraction.html)

我已经设法使用[DrawingVisual](http://msdn.microsoft.com/en-us/library/system.windows.media.drawingvisual.aspx)和[DrawingContext](http://msdn.microsoft.com/en-us/library/system.windows.media.drawingcontext.aspx)类获得出色的性能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T19:53:06.250

您可以尝试使用 GDI+ 或直接 x 而不是 WPF。

我为大约一年前写的一篇 MSDN 杂志文章做了一个类似的项目（通过 WPF 渲染地图数据）。

这只是我写得相当快的东西（文章+应用程序花了大约 1 周时间），并且被设计为“这是你可以做的整洁的事情”，所以我并没有过多关注性能。无论如何，我遇到了同样的问题。一旦画布上的多边形数量变大，渲染性能就会开始下降。例如，调整窗口大小将涉及大约 1/2 秒左右的延迟。

这在很大程度上与 WPF 的开销有关。它主要设计为 GUI 工具包，而不是高性能图形引擎。这意味着它专注于功能丰富而不是高效渲染。使用较少数量的对象（可能在大多数 GUI 应用程序中找到），性能非常好，数据绑定、动画和声明式样式功能（以及它们需要的所有事件路由和其他东西）真的可以派上用场.

然而，在绘制地图时，庞大的数据量可能会导致所有这些简洁的数据绑定功能导致性能问题，正如您似乎很清楚的那样。

如果您不需要声明式样式和动画，那么我只会消除 WPF，并使用 GDI+ 自己绘制地图。它基本上涉及设置正确的变换矩阵以使地图绘制到控制表面上，然后遍历所有多边形并调用一堆 DrawPolygon 方法。

要启用交互，您必须编写自己的命中测试代码，并且您必须在调整表单大小时重新绘制地图。您还必须手动编写任何动画或样式更改或您想要做的事情（例如当鼠标悬停在区域上时突出显示区域）。但是，编写该代码应该不难。我想你可以在大约 1.5 周内完成。

但是，这样做应该会提高性能，因为它只需要进行大约 20-30K 的矢量转换，这在大多数现代 CPU 上不会占用太多的处理器能力。您还可以考虑使用 Direct X，它也可以让您利用 GPU，从而获得更大的性能提升。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T19:27:12.787

您可能会受到画布小部件性能的限制。如果您可以选择使用 3rd 方工具包，请查看[QT。](http://trolltech.com/) 它有一个高性能的[画布小部件](http://doc.trolltech.com/4.4/qgraphicsview.html)，旨在快速渲染复杂的形状。这已经用于[至少一个 GIS 应用程序](http://www.qgis.org/)，因此它在这个领域有一些跟踪记录。

您可以[将 QT 包装为 ActiveX 控件](http://vision.lbl.gov/People/qyang/qt_doc/qaxserver-example-wrapper.html)或使用[Qyoto/Kimono](http://ekarchive.elikirk.com/david/qyoto/index.php?option=com_content&task=view&id=29&Itemid=32) .Net 绑定来连接到 .Net 应用程序。Troll Tech 刚刚改造了他们的网站，我找不到他们曾经在那里的可下载演示，但它显示了 QGraphicsView 小部件，它呈现了一个非常大的矢量绘图并实时缩小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T15:25:40.013

如果性能是一个问题，那么您要避免使用视觉画笔。这些画笔最好用于将屏幕的某些可见部分投影到屏幕上的另一个位置。它们会造成很大的性能损失，因为这些画笔会在画笔的内容更改时自动更新。

此笔刷的任何使用都将被软件渲染，并且无法利用显卡的硬件功能。

[来自 MSDN 关于 VisualBrush 的更多信息](http://msdn.microsoft.com/en-us/library/system.windows.media.visualbrush.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-18T09:04:52.033

如果您不必一次显示所有多边形（例如由于缩放、平移等），请在[此处查看虚拟化画布示例](http://blogs.msdn.com/jgoldb/archive/2008/03/08/performant-virtualized-wpf-canvas.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-04T04:14:59.363

使用 DrawingGroup 并添加/删除绘图对象来解决这个问题。请参阅我对有关[使用 Opacity=0 的 DrawingVisual 性能](https://stackoverflow.com/questions/284766/drawingvisual-performance-with-opacity0)的类似问题的[回答](https://stackoverflow.com/questions/284766/drawingvisual-performance-with-opacity0/716469#716469)。我认为我的回答实际上更适合这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T19:18:30.483

您将发现 GPU 背后的动机以及疯狂超频和冷却的显卡。和双缓冲。

并且：将事物转换为位图：渲染它有什么区别？

毕竟你有 n 个对象 /somehow/ 必须被渲染（除非你能弄清楚哪些对象隐藏在其他对象后面，但这对你没有多大帮助，因为你必须查看 n! 对象关系）。

此外：也许离开正统的 OOP 方法并转而采用程序化是值得的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T19:23:37.897

@xmjx

> 并且：将事物转换为位图：渲染它有什么区别？

我的想法是，我的速度变慢可能是由于画布上有 n 个对象，而不是 1 个位图。也就是说，我不知道性能，或者将具有 n 个对象的画布转换为位图时在后台会发生什么。

我宁愿不使用位图，这样我就可以允许用户与形状/多边形进行交互（修改/删除）。

# c# - NHibernate ICriteria - 排序是否允许为空？

> ID：150153
> 
> 赞同：4
> 
> 时间：2008-09-29T19:03:39.347
> 
> 标签：c#, nhibernate, .net-3.5

使用 NHibernate ICriteria 并添加 .AddOrder ...我想按一个有时为 null 的属性进行排序，所有填充的属性都在顶部。.AddOrder 会允许我这样做吗？如果没有，还有其他选择吗？

ILists 的排序选项还有很多不足之处。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T19:07:50.740

如果你使用类似的东西：

```
IList cats = sess.CreateCriteria(typeof(Cat))
    .AddOrder( Order.Desc("PropertyName") )
    .List(); 
```

给定属性为 NULL 的对象将在列表中的最后一个。

*（部分取自[NHibernate 文档](http://nhforge.org/doc/nh/en/index.html#querycriteria)。）*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T19:07:48.340

您应该首先使用该方法获取非空值。我们在我的项目中以这种方式使用排序，并且空值没有任何问题......它们在最后列出。

# powershell - 等待用户输入超时

> ID：150161
> 
> 赞同：25
> 
> 时间：2008-09-29T19:05:48.063
> 
> 标签：powershell

我已经搜索过，但显然我的 google foo 很弱。我需要的是一种在控制台中提示用户输入并在一段时间后使请求超时并在没有输入时继续执行脚本的方法。据我所知，Read-Host 不提供此功能功能。$host.UI.PromptForChoice() 和 $host.UI.RawUI.ReadKey() 也没有。在此先感谢您的任何指点。

编辑：非常感谢 Lars Truijens 找到了答案。我把他指出的代码封装成一个函数。请注意，我实现它的方式意味着在用户按下键和脚本继续执行之间可能会有长达一秒的延迟。

```
function Pause-Host
{
    param(
            $Delay = 1
         )
    $counter = 0;
    While(!$host.UI.RawUI.KeyAvailable -and ($counter++ -lt $Delay))
    {
        [Threading.Thread]::Sleep(1000)
    }
} 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-29T19:44:47.937

[在这里](http://huddledmasses.org/powershell-xmpp-jabber-snapin/)找到了一些东西：

```
$counter = 0
while(!$Host.UI.RawUI.KeyAvailable -and ($counter++ -lt 600))
{
      [Threading.Thread]::Sleep( 1000 )
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-03-30T10:00:48.633

它现在已经很老了，但是我如何基于相同的 KeyAvailable 方法解决它是在这里：

[https://gist.github.com/nathanchere/704920a4a43f06f4f0d2](https://gist.github.com/nathanchere/704920a4a43f06f4f0d2)

它等待 x 秒，`.`在最长等待时间之前每秒钟显示一个。如果一个键被按下它返回`$true`，否则`$false`。

```
Function TimedPrompt($prompt,$secondsToWait){   
    Write-Host -NoNewline $prompt
    $secondsCounter = 0
    $subCounter = 0
    While ( (!$host.ui.rawui.KeyAvailable) -and ($count -lt $secondsToWait) ){
        start-sleep -m 10
        $subCounter = $subCounter + 10
        if($subCounter -eq 1000)
        {
            $secondsCounter++
            $subCounter = 0
            Write-Host -NoNewline "."
        }       
        If ($secondsCounter -eq $secondsToWait) { 
            Write-Host "`r`n"
            return $false;
        }
    }
    Write-Host "`r`n"
    return $true;
} 
```

并使用：

```
$val = TimedPrompt "Press key to cancel restore; will begin in 3 seconds" 3
Write-Host $val 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-05-10T13:47:51.977

对于正在寻找现代解决方案的人来说，在预定义的按键上退出 PowerShell 脚本有额外的约束，以下解决方案可能会对您有所帮助：

```
Write-Host ("PowerShell Script to run a loop and exit on pressing 'q'!")
$count=0
$sleepTimer=500 #in milliseconds
$QuitKey=81 #Character code for 'q' key.
while($count -le 100)
{
    if($host.UI.RawUI.KeyAvailable) {
        $key = $host.ui.RawUI.ReadKey("NoEcho,IncludeKeyUp")
        if($key.VirtualKeyCode -eq $QuitKey) {
            #For Key Combination: eg., press 'LeftCtrl + q' to quit.
            #Use condition: (($key.VirtualKeyCode -eq $Qkey) -and ($key.ControlKeyState -match "LeftCtrlPressed"))
            Write-Host -ForegroundColor Yellow ("'q' is pressed! Stopping the script now.")
            break
        }
    }
    #Do your operations
    $count++
    Write-Host ("Count Incremented to - {0}" -f $count)
    Write-Host ("Press 'q' to stop the script!")
    Start-Sleep -m $sleepTimer
}
Write-Host -ForegroundColor Green ("The script has stopped.") 
```

示例脚本输出： [![在此处输入图像描述](https://i.stack.imgur.com/IBb2o.png)](https://i.stack.imgur.com/IBb2o.png)

请参阅有关键状态的[Microsoft 文档](https://docs.microsoft.com/en-us/dotnet/api/system.management.automation.host.controlkeystates?view=powershellsdk-1.1.0)以处理更多组合。

致谢：[Technet 链接](https://social.technet.microsoft.com/Forums/windowsserver/en-US/29dc9692-e1b0-4aae-90aa-73a763758534/quit-powershell-script-by-pressing-a-defined-key?forum=winserverpowershell)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-09-27T23:46:08.627

这是一个接受的击键实用函数：

*   验证字符集（作为 1 个字符的正则表达式）。
*   可选消息
*   可选超时时间（以秒为单位）

只有匹配的击键才会反映到屏幕上。

用法：

```
$key = GetKeyPress '[ynq]' "Run step X ([y]/n/q)?" 5

if ($key -eq $null)
{
    Write-Host "No key was pressed.";
}
else
{
    Write-Host "The key was '$($key)'."
} 
```

执行：

```
Function GetKeyPress([string]$regexPattern='[ynq]', [string]$message=$null, [int]$timeOutSeconds=0)
{
    $key = $null

    $Host.UI.RawUI.FlushInputBuffer() 

    if (![string]::IsNullOrEmpty($message))
    {
        Write-Host -NoNewLine $message
    }

    $counter = $timeOutSeconds * 1000 / 250
    while($key -eq $null -and ($timeOutSeconds -eq 0 -or $counter-- -gt 0))
    {
        if (($timeOutSeconds -eq 0) -or $Host.UI.RawUI.KeyAvailable)
        {                       
            $key_ = $host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown,IncludeKeyUp")
            if ($key_.KeyDown -and $key_.Character -match $regexPattern)
            {
                $key = $key_                    
            }
        }
        else
        {
            Start-Sleep -m 250  # Milliseconds
        }
    }                       

    if (-not ($key -eq $null))
    {
        Write-Host -NoNewLine "$($key.Character)" 
    }

    if (![string]::IsNullOrEmpty($message))
    {
        Write-Host "" # newline
    }       

    return $(if ($key -eq $null) {$null} else {$key.Character})
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-03-17T07:45:48.273

```
function ReadKeyWithDefault($prompt, $defaultKey, [int]$timeoutInSecond = 5 ) {
    $counter =  $timeoutInSecond * 10
    do{
        $remainingSeconds = [math]::floor($counter / 10)
        Write-Host "`r$prompt (default  $defaultKey  in $remainingSeconds seconds): " -NoNewline
        if($Host.UI.RawUI.KeyAvailable){
            $key = $host.UI.RawUI.ReadKey("IncludeKeyUp")
            Write-Host 
            return $key
        }
        Start-Sleep -Milliseconds 100
    }while($counter-- -gt 0)

    Write-Host $defaultKey
    return $defaultKey
}

$readKey = ReadKeyWithDefault "If error auto exit( y/n )" 'y' 5 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-17T14:00:58.977

```
timeout.exe 5 
```

仍然可以从 powershell 工作。等待 5 秒或直到按键。

也许不优雅。但是很容易。

然而，

从 Powershell_ISE 它会弹出一个新的命令提示符窗口，并立即返回，因此它不会等待（从 powershell 控制台它使用该控制台并确实等待）。您可以通过更多的工作让它从 ISE 等待（仍然会弹出它自己的窗口）：

```
if ($psISE) {
    start -Wait timeout.exe 5
} else {
    timeout.exe 5
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-09-06T09:16:31.643

另一种选择：您可以使用`choice`自 Windows 2000 以来每个 Windows 版本附带的 shell 命令

```
Choice /C yn /D n /t 5 /m "Are you sure? You have 5 seconds to decide"
if ($LASTEXITCODE -eq "1") # 1 for "yes" 2 for "no"
{
    # do stuff
}
else
{
    # don't do stuff
} 
```

Stackoverflow 语法高亮不适用于 powershell，`#`在此处表示“注释”

# java - 如何从密钥库中列出/导出私钥？

> ID：150167
> 
> 赞同：62
> 
> 时间：2008-09-29T19:07:49.807
> 
> 标签：java, ssl, keystore

如何从密钥库中列出和导出私钥？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2011-04-08T14:49:23.157

您可以使用 Java6 和 OpenSSL 从密钥库中提取私钥。这一切都取决于 Java 和 OpenSSL 都支持 PKCS#12 格式的密钥库这一事实。要进行提取，首先使用`keytool`转换为标准格式。确保您***对两个文件使用相同的密码（私钥密码，而不是密钥库密码）***，否则您稍后会在第二步中遇到奇怪的失败。

```
keytool -importkeystore -srckeystore keystore.jks \
    -destkeystore intermediate.p12 -deststoretype PKCS12 
```

接下来，使用 OpenSSL 对 PEM 进行提取：

```
openssl pkcs12 -in intermediate.p12 -out extracted.pem -nodes 
```

您应该能够足够轻松地处理该 PEM 文件；它是纯文本，其中包含编码的未加密私钥和证书（采用非常明显的格式）。

*执行此操作时，请注意确保创建的文件安全。它们包含秘密凭据。如果您未能正确保护它们，没有任何东西会警告您。*保护它们的最简单方法是在一个目录中完成所有这些操作，该目录对用户以外的任何人都没有任何访问权限。并且永远不要将您的密码放在命令行或环境变量中；其他用户太容易抢了。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-09-29T19:12:01.997

最初来自 Example Depot 的部分代码用于列出密钥存储中的所有别名：

```
 // Load input stream into keystore
    keystore.load(is, password.toCharArray());

    // List the aliases
    Enumeration aliases = keystore.aliases();
    for (; aliases.hasMoreElements(); ) {
        String alias = (String)aliases.nextElement();

        // Does alias refer to a private key?
        boolean b = keystore.isKeyEntry(alias);

        // Does alias refer to a trusted certificate?
        b = keystore.isCertificateEntry(alias);
    } 
```

几个月前，[Sun 论坛](http://forums.sun.com/thread.jspa?threadID=154587&start=15&tstart=0)上出现了导出私钥的问题， [u:turingcompleter](http://forums.sun.com/profile.jspa?userID=505275)提出了一个 DumpPrivateKey 类来拼接到您的应用程序中。

```
import java.io.FileInputStream;
import java.security.Key;
import java.security.KeyStore;
import sun.misc.BASE64Encoder;

public class DumpPrivateKey {
     /**
     * Provides the missing functionality of keytool
     * that Apache needs for SSLCertificateKeyFile.
     *
     * @param args  <ul>
     *              <li> [0] Keystore filename.
     *              <li> [1] Keystore password.
     *              <li> [2] alias
     *              </ul>
     */
    static public void main(String[] args)
    throws Exception {
        if(args.length < 3) {
          throw new IllegalArgumentException("expected args: Keystore filename, Keystore password, alias, <key password: default same tha
n keystore");
        }
        final String keystoreName = args[0];
        final String keystorePassword = args[1];
        final String alias = args[2];
        final String keyPassword = getKeyPassword(args,keystorePassword);
        KeyStore ks = KeyStore.getInstance("jks");
        ks.load(new FileInputStream(keystoreName), keystorePassword.toCharArray());
        Key key = ks.getKey(alias, keyPassword.toCharArray());
        String b64 = new BASE64Encoder().encode(key.getEncoded());
        System.out.println("-----BEGIN PRIVATE KEY-----");
        System.out.println(b64);
        System.out.println("-----END PRIVATE KEY-----");
    }
    private static String getKeyPassword(final String[] args, final String keystorePassword)
    {
       String keyPassword = keystorePassword; // default case
       if(args.length == 4) {
         keyPassword = args[3];
       }
       return keyPassword;
    }
} 
```

注意：这个使用 Sun 包，[这是一个“坏事”](http://java.sun.com/products/jdk/faq/faq-sun-packages.html)。
如果你可以下载[apache commons code](http://commons.apache.org/codec/index.html)，这里有一个可以编译且没有警告的版本：

```
javac -classpath .:commons-codec-1.4/commons-codec-1.4.jar DumpPrivateKey.java 
```

并将给出相同的结果：

```
import java.io.FileInputStream;
import java.security.Key;
import java.security.KeyStore;
//import sun.misc.BASE64Encoder;
import org.apache.commons.codec.binary.Base64;

public class DumpPrivateKey {
     /**
     * Provides the missing functionality of keytool
     * that Apache needs for SSLCertificateKeyFile.
     *
     * @param args  <ul>
     *              <li> [0] Keystore filename.
     *              <li> [1] Keystore password.
     *              <li> [2] alias
     *              </ul>
     */
    static public void main(String[] args)
    throws Exception {
        if(args.length < 3) {
          throw new IllegalArgumentException("expected args: Keystore filename, Keystore password, alias, <key password: default same tha
n keystore");
        }
        final String keystoreName = args[0];
        final String keystorePassword = args[1];
        final String alias = args[2];
        final String keyPassword = getKeyPassword(args,keystorePassword);
        KeyStore ks = KeyStore.getInstance("jks");
        ks.load(new FileInputStream(keystoreName), keystorePassword.toCharArray());
        Key key = ks.getKey(alias, keyPassword.toCharArray());
        //String b64 = new BASE64Encoder().encode(key.getEncoded());
        String b64 = new String(Base64.encodeBase64(key.getEncoded(),true));
        System.out.println("-----BEGIN PRIVATE KEY-----");
        System.out.println(b64);
        System.out.println("-----END PRIVATE KEY-----");
    }
    private static String getKeyPassword(final String[] args, final String keystorePassword)
    {
       String keyPassword = keystorePassword; // default case
       if(args.length == 4) {
         keyPassword = args[3];
       }
       return keyPassword;
    }
} 
```

你可以像这样使用它：

```
java -classpath .:commons-codec-1.4/commons-codec-1.4.jar DumpPrivateKey $HOME/.keystore changeit tomcat 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T19:43:24.087

如果您不需要以编程方式执行此操作，而只是想管理您的密钥，那么我已经使用 IBM 的免费 KeyMan 工具很长时间了。非常适合将私钥导出到 PFX 文件（然后您可以轻松地使用 OpenSSL 对其进行操作、提取、更改密码等）。

[https://www.ibm.com/developerworks/mydeveloperworks/groups/service/html/communityview?communityUuid=6fb00498-f6ea-4f65-bf0c-adc5bd0c5fcc](https://www.ibm.com/developerworks/mydeveloperworks/groups/service/html/communityview?communityUuid=6fb00498-f6ea-4f65-bf0c-adc5bd0c5fcc)

选择您的密钥库，选择私钥条目，然后选择 File->Save to apkcs12 文件（通常为 *.pfx）。然后，您可以使用以下命令查看内容：

$ openssl pkcs12 -in mykeyfile.pfx -info

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-02-01T23:32:48.167

这是上述代码的简短版本，在 Groovy 中。还具有内置的 base64 编码：

```
import java.security.Key
import java.security.KeyStore

if (args.length < 3)
        throw new IllegalArgumentException('Expected args: <Keystore file> <Keystore format> <Keystore password> <alias> <key password>')

def keystoreName = args[0]
def keystoreFormat = args[1]
def keystorePassword = args[2]
def alias = args[3]
def keyPassword = args[4]

def keystore = KeyStore.getInstance(keystoreFormat)
keystore.load(new FileInputStream(keystoreName), keystorePassword.toCharArray())
def key = keystore.getKey(alias, keyPassword.toCharArray())

println "-----BEGIN PRIVATE KEY-----"
println key.getEncoded().encodeBase64()
println "-----END PRIVATE KEY-----" 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-11-29T09:59:05.680

对于android开发，将eclipse ADT中创建的keystore转换为SignApk.jar中使用的公钥和私钥：

导出私钥：

```
keytool.exe -importkeystore -srcstoretype JKS -srckeystore my-release-key.keystore -deststoretype PKCS12 -destkeystore keys.pk12.der
openssl.exe pkcs12 -in keys.pk12.der -nodes -out private.rsa.pem 
```

编辑 private.rsa.pem 并将 "-----BEGIN PRIVATE KEY-----" 保留为 "-----END PRIVATE KEY-----" 段落，然后：

```
openssl.exe base64 -d -in private.rsa.pem -out private.rsa.der 
```

导出公钥：

```
keytool.exe -exportcert -keystore my-release-key.keystore -storepass <KEYSTORE_PASSWORD> -alias alias_name -file public.x509.der 
```

签署apk：

```
java -jar SignApk.jar public.x509.der private.rsa.der input.apk output.apk 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-06-18T13:54:03.013

这个问题出现在 stackexchange 安全性上，其中一个建议是使用[Keystore explorer](http://keystore-explorer.sourceforge.net/)

[https://security.stackexchange.com/questions/3779/how-can-i-export-my-private-key-from-a-java-keytool-keystore](https://security.stackexchange.com/questions/3779/how-can-i-export-my-private-key-from-a-java-keytool-keystore)

刚刚尝试过，效果非常好，我强烈推荐它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T19:16:08.257

首先，要小心！你所有的安全都取决于……呃……你的*私钥的***隐私。**Keytool 没有内置密钥导出功能，以避免意外泄露这种敏感材料，因此您可能需要考虑一些额外的保护措施来保护您导出的密钥。

 *下面是一些简单的代码，可为您提供 OpenSSL 可以使用的未加密的 PKCS #8 PrivateKeyInfo（请参阅`-nocrypt`其[pkcs8 实用程序](http://www.openssl.org/docs/apps/pkcs8.html)的选项）：

```
KeyStore keys = ...
char[] password = ...
Enumeration<String> aliases = keys.aliases();
while (aliases.hasMoreElements()) {
  String alias = aliases.nextElement();
  if (!keys.isKeyEntry(alias))
    continue;
  Key key = keys.getKey(alias, password);
  if ((key instanceof PrivateKey) && "PKCS#8".equals(key.getFormat())) {
    /* Most PrivateKeys use this format, but check for safety. */
    try (FileOutputStream os = new FileOutputStream(alias + ".key")) {
      os.write(key.getEncoded());
      os.flush();
    }
  }
} 
```

如果您需要其他格式，您可以使用 KeyFactory 为不同类型的密钥获取透明的密钥规范。然后，您可以获得例如 RSA 私钥的私钥并以您想要的格式输出。这将成为后续问题的一个很好的话题。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-02-02T09:54:51.670

另一个很棒的工具是 KeyStore Explorer： http: [//keystore-explorer.sourceforge.net/](http://keystore-explorer.sourceforge.net/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-07-13T09:31:02.237

另一种不太传统但可以说更简单的方法是使用[JXplorer](http://jxplorer.org/)。尽管此工具旨在浏览 LDAP 目录，但它具有易于使用的 GUI 来操作密钥库。GUI 上的一个这样的功能可以从 JKS 密钥库中导出私钥。

# sql - 事务隔离问题还是错误的方法？

> ID：150177
> 
> 赞同：7
> 
> 时间：2008-09-29T19:09:48.897
> 
> 标签：sql, sql-server, oracle, transactions, database

我正在帮助我的一些同事解决 SQL 问题。主要是他们想将所有行从表 A 移动到表 B（两个表具有相同的列（名称和类型））。尽管这是在 Oracle 11g 中完成的，但我认为这并不重要。

他们最初的幼稚实现类似于

```
BEGIN
  INSERT INTO B SELECT * FROM A
  DELETE FROM A
  COMMIT;
END 
```

他们担心的是，在从 A 复制到 B 的过程中是否对表 A 进行了 INSERT，并且“从 A 中删除”（或 TRUNCATE 是值得的）会导致数据丢失（删除 A 中较新的插入行）。

当然，我很快建议将复制行的 ID 存储在临时表中，然后仅删除 A 中与临时表中的 IDS 匹配的行。

然而，为了好奇，我们通过在 INSERT 和 DELETE 之间添加一个等待命令（不记得 PL/SQL 语法）进行了一个小测试。然后从不同的连接中，我们将*在 WAIT 期间*插入行。

我们观察到这样做会导致数据丢失。我在 SQL Server 中复制了整个上下文，并将其全部包装在一个事务中，但新数据仍然在 SQL Server 中丢失了。这让我认为最初的方法存在系统性错误/缺陷。

但是，我不知道是因为 TRANSACTION 没有（以某种方式？）与新的 INSERT 隔离，还是因为 INSERT 在 WAIT 命令期间出现。

最后它是使用我建议的临时表实现的，但我们无法得到“为什么数据丢失”的答案。你知道为什么吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T19:26:06.533

根据您的隔离级别，从表中选择所有行不会阻止新的插入，它只会锁定您读取的行。在 SQL Server 中，如果您使用 Serializable 隔离级别，那么它将阻止新行（如果它们已包含在您的选择查询中）。

[http://msdn.microsoft.com/en-us/library/ms173763.aspx](http://msdn.microsoft.com/en-us/library/ms173763.aspx) -

SERIALIZABLE 指定以下内容：

*   语句不能读取已被其他事务修改但尚未提交的数据。

*   在当前事务完成之前，任何其他事务都不能修改当前事务已读取的数据。

*   **在当前事务完成之前，其他事务不能插入键值落在当前事务中的任何语句读取的键范围内的新行。**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T19:17:56.053

我不能谈论事务的稳定性，但另一种方法是从存在的源表中删除第二步（从目标表中选择 id）。

原谅语法，我没有测试过这段代码，但你应该能明白：

```
INSERT INTO B SELECT * FROM A;

DELETE FROM A WHERE EXISTS (SELECT B.<primarykey> FROM B WHERE B.<primarykey> = A.<primarykey>); 
```

这样，您就可以使用关系引擎来强制不会删除较新的数据，并且您不需要在事务中执行这两个步骤。

更新：子查询中的更正语法

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T19:19:30.620

这可以在 Oracle 中使用：

```
Alter session set isolation_level=serializable; 
```

这可以使用 EXECUTE IMMEDIATE 在 PL/SQL 中设置：

```
BEGIN
    EXECUTE IMMEDIATE 'Alter session set isolation_level=serializable';
    ...
END; 
```

请参阅[Ask Tom：关于事务隔离级别](http://www.oracle.com/technology/oramag/oracle/05-nov/o65asktom.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T19:20:05.860

这只是交易的工作方式。您必须为手头的任务选择正确的隔离级别。

您在同一事务中执行 INSERT 和 DELETE。你没有提到隔离模式事务正在使用，但它可能是“读取提交”。这意味着 DELETE 命令将看到同时提交的记录。对于这种工作，使用“快照”类型的事务要好得多，因为这样 INSERT 和 DELETE 都会知道同一组记录——只知道那些，没有别的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T19:13:01.557

我不知道这是否相关，但在 SQL Server 中，语法是

```
begin tran
....
commit 
```

不只是“开始”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T19:14:10.727

您需要设置事务隔离级别，以便来自另一个事务的插入不会影响您的事务。我不知道如何在 Oracle 中做到这一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T20:27:41.690

在 Oracle 中，默认的事务隔离级别是读提交。这基本上意味着当您的查询开始时，Oracle 会返回 SCN（系统更改号）中存在的结果。将事务隔离级别设置为可序列化意味着 SCN 在事务开始时被捕获，因此事务中的所有查询都返回该 SCN 的数据。无论其他会话和事务正在做什么，这都能确保一致的结果。另一方面，由于其他事务正在执行的活动，Oracle 可能会确定它无法序列化您的事务，因此您将不得不处理此类错误，这可能会产生成本。

Tony 与 AskTom 讨论的链接提供了更多关于这一切的详细信息——我强烈推荐它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T19:25:54.363

是的，米兰，我没有指定事务隔离级别。我想这是默认的隔离级别，我不知道它是什么。在 Oracle 11g 和 SQL Server 2005 中都没有。

此外，在 WAIT 命令期间（在第二个连接上）进行的 INSERT 不在*事务*中。应该是为了防止这种数据丢失吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T07:27:28.717

如上所述，这是默认已提交读模式的标准行为。WAIT 命令只会导致处理延迟，没有任何数据库事务处理的链接。

要解决此问题，您可以：

1.  将隔离级别设置为可序列化，但随后您会收到 ORA- 错误，您需要通过重试来处理这些错误！此外，您可能会受到严重的性能影响。
2.  首先使用临时表存储值
3.  如果数据不是太大而无法放入内存，则可以使用 RETURNING 子句将 BULK COLLECT INTO 嵌套表中，并且仅当嵌套表中存在该行时才删除。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-13T14:16:29.040

或者，您可以使用快照隔离来检测丢失的更新：

[快照隔离何时有帮助，何时有害](http://www.devx.com/dbzone/Article/32957)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-08-04T19:27:52.570

```
 I have written a sample code:-

    First run this on Oracle DB:-

     Create table AccountBalance
        (
              id integer Primary Key,
              acctName varchar2(255) not null,
              acctBalance integer not null,
              bankName varchar2(255) not null
        );

        insert into AccountBalance values (1,'Test',50000,'Bank-a');

    Now run the below code 

 package com.java.transaction.dirtyread;
        import java.sql.Connection;
        import java.sql.DriverManager;
        import java.sql.SQLException;

        public class DirtyReadExample {

         /**
          * @param args
         * @throws ClassNotFoundException 
          * @throws SQLException 
          * @throws InterruptedException 
          */
         public static void main(String[] args) throws ClassNotFoundException, SQLException, InterruptedException {

             Class.forName("oracle.jdbc.driver.OracleDriver");
             Connection connectionPayment = DriverManager.getConnection(
                        "jdbc:oracle:thin:@localhost:1521:xe", "hr",
                        "hr");
             Connection connectionReader = DriverManager.getConnection(
                        "jdbc:oracle:thin:@localhost:1521:xe", "hr",
                        "hr");

          try {
              connectionPayment.setAutoCommit(false);
              connectionPayment.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);

          } catch (SQLException e) {
           e.printStackTrace();
          }

          Thread pymtThread=new Thread(new PaymentRunImpl(connectionPayment));
          Thread readerThread=new Thread(new ReaderRunImpl(connectionReader));

          pymtThread.start();
          Thread.sleep(2000);
          readerThread.start();

         }

        }

        package com.java.transaction.dirtyread;

        import java.sql.Connection;
        import java.sql.PreparedStatement;
        import java.sql.ResultSet;
        import java.sql.SQLException;

        public class ReaderRunImpl  implements Runnable{

         private Connection conn;

         private static final String QUERY="Select acctBalance from AccountBalance where id=1";

         public ReaderRunImpl(Connection conn){
          this.conn=conn;
         }

         @Override
         public void run() {
          PreparedStatement stmt =null; 
          ResultSet rs =null;

          try {
           stmt = conn.prepareStatement(QUERY);
           System.out.println("In Reader thread --->Statement Prepared");
           rs = stmt.executeQuery();
           System.out.println("In Reader thread --->executing");
           while (rs.next()){

            System.out.println("Balance is:" + rs.getDouble(1));

           }
           System.out.println("In Reader thread --->Statement Prepared");
           Thread.sleep(5000);
           stmt.close();
           rs.close();
           stmt = conn.prepareStatement(QUERY);
           rs = stmt.executeQuery();
           System.out.println("In Reader thread --->executing");
           while (rs.next()){

            System.out.println("Balance is:" + rs.getDouble(1));

           }
           stmt.close();
           rs.close();
           stmt = conn.prepareStatement(QUERY);
           rs = stmt.executeQuery();
           System.out.println("In Reader thread --->executing");
           while (rs.next()){

            System.out.println("Balance is:" + rs.getDouble(1));

           }
          } catch (SQLException | InterruptedException e) {
           e.printStackTrace();
          }finally{
           try {
            stmt.close();
            rs.close();
           } catch (SQLException e) {
            e.printStackTrace();
           }   
          }
         }

        }

        package com.java.transaction.dirtyread;
        import java.sql.Connection;
        import java.sql.PreparedStatement;
        import java.sql.SQLException;

        public class PaymentRunImpl implements Runnable{

         private Connection conn;

         private static final String QUERY1="Update AccountBalance set acctBalance=40000 where id=1";
         private static final String QUERY2="Update AccountBalance set acctBalance=30000 where id=1";
         private static final String QUERY3="Update AccountBalance set acctBalance=20000 where id=1";
         private static final String QUERY4="Update AccountBalance set acctBalance=10000 where id=1";

         public PaymentRunImpl(Connection conn){
          this.conn=conn;
         }

         @Override
         public void run() {
          PreparedStatement stmt = null;

          try {   
           stmt = conn.prepareStatement(QUERY1);
           stmt.execute();
           System.out.println("In Payment thread --> executed");
           Thread.sleep(3000);
           stmt = conn.prepareStatement(QUERY2);
           stmt.execute();
           System.out.println("In Payment thread --> executed");
           Thread.sleep(3000);
           stmt = conn.prepareStatement(QUERY3);
           stmt.execute();
           System.out.println("In Payment thread --> executed");
           stmt = conn.prepareStatement(QUERY4);
           stmt.execute();
           System.out.println("In Payment thread --> executed");

           Thread.sleep(5000);
            //case 1
           conn.rollback();
           System.out.println("In Payment thread --> rollback");
          //case 2
           //conn.commit();
          // System.out.println("In Payment thread --> commit");
          } catch (SQLException e) {
           e.printStackTrace();
          } catch (InterruptedException e) {    
           e.printStackTrace();
          }finally{
           try {
            stmt.close();
           } catch (SQLException e) {
            e.printStackTrace();
           }
          }
         }

        }

    Output:-
    In Payment thread --> executed
    In Reader thread --->Statement Prepared
    In Reader thread --->executing
    Balance is:50000.0
    In Reader thread --->Statement Prepared
    In Payment thread --> executed
    In Payment thread --> executed
    In Payment thread --> executed
    In Reader thread --->executing
    Balance is:50000.0
    In Reader thread --->executing
    Balance is:50000.0
    In Payment thread --> rollback 
```

U 可以通过插入由 oracle 定义的新行来测试它：- 当事务 A 检索一组满足给定条件的行时发生幻读，事务 B 随后插入或更新一行，使得该行现在满足事务 A 中的条件, 事务 A 稍后重复条件检索。事务 A 现在看到一个额外的行。该行称为幻像。它将避免上述情况以及我使用了 TRANSACTION_SERIALIZABLE。它将对 Oracle 设置最严格的锁定。Oracle 仅支持 2 种类型的事务隔离级别：- TRANSACTION_READ_COMMITTED 和 TRANSACTION_SERIALIZABLE。

# java - 发送电子邮件并检查状态

> ID：150183
> 
> 赞同：16
> 
> 时间：2008-09-29T19:12:25.427
> 
> 标签：java, email, email-bounces

使用 Java 邮件，我想发送一封电子邮件并检查状态。可能的状态包括：

*   硬退回：未找到邮件服务器
*   Soft-bounce：找到邮件服务器，但找不到帐户
*   成功

是否有可能以我上面描述的方式发送电子邮件并获得有关交付尝试的一些反馈？

**编辑：**一位受访者建议寻找一个提供与[ListNanny](http://www.listnanny.net/)相同功能的 Java 库。我四处寻找，但没有找到任何东西。知道这样的图书馆是否存在吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T19:16:27.990

您无法可靠或始终如一地做到这一点。如果您的本地邮件服务器将其传递到公司的外发邮件服务器，然后当该服务器尝试传递它时它会反弹，会发生什么情况？如果邮件服务器无法与其他邮件服务器通信，然后消息在 4 天后超时，会发生什么情况？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T20:32:51.583

如果您要发送 HTML 电子邮件，您可能希望在电子邮件中嵌入一个 1 像素的透明图像。图像 URL 实际上会引用一个返回图像的 servlet。URL 也会有某种消息 id 作为参数。这背后的想法是，当用户阅读消息时，他/她会显示图像，这会触发您的 servlet，该 servlet 将消息已被读取的数据写入数据库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T19:28:10.990

您需要做的是将信封 SMTP 发件人设置为您监视 NDR 邮件的地址。您必须在收到电子邮件时对其进行解析并找出问题所在。这通常用于邮件列表，像[ListNanny](http://www.listnanny.net/)这样的产品用于处理消息（它是一个 .NET 产品，但我确信有一个 Java 等价物，或者您可以自己编写）。

信封“发件人”与邮件“发件人”地址不同。它是您的代码和 MTA 之间发生的 SMTP 对话的一部分。所有 NDR 都将发送到该地址。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T09:35:24.043

You can use **[http://www.mailcounter.info](http://www.mailcounter.info)** free service to check whether your email has been read as well as how many times it has been read by t he user. Its a free service.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T19:22:07.603

查找邮件服务器并连接：简单。检查帐户：可能。但这首先取决于您是否可以访问邮件服务器。它可能会拒绝您的连接尝试（例如，因为您的网络被列入黑名单）

最复杂的就是你所说的“成功”：

简短的回答：没有。

长答案：理论上这是可能的，但是您必须等待数小时甚至数天才能知道状态。使用灰名单、白名单、垃圾邮件阻止邮件服务器，许多邮件服务器只会在多次投递尝试后才接受电子邮件。只有当他们最终交付或放弃邮件时，您才会知道交付成功。并且根据邮件服务器的负载，电子邮件的发送可能会延迟任意时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T19:22:48.863

我不熟悉 Javamail，但我想说：即使“成功”也可能不是成功。

您对硬故障和软故障的定义应该足够简单以便检查。如果您找不到服务器，这很难，如果您连接并且服务器说“找不到邮箱”，那就是“软”。但是，如果服务器接受了该消息，然后稍后将其退回怎么办？许多前端服务器通过设计或必要性接受未知消息（“真实”后端服务器的前端中继），如果后来发现该消息被发送到无效地址，则该消息将被退回给发件人。在这种情况下，当发送确实不成功时，您将报告发送“成功”。

如果没有嵌入在消息中的某种“单击此处”，确保交付几乎是不可能的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T19:41:14.967

不要依赖从服务器返回（如果返回）信息的内容。

由于存在安全漏洞，许多邮件服务器现在设置为**不**指示收件人是否存在。（例如，如果给定域报告（“是”/“否”）电子邮件地址的存在，黑客将简单地对服务器发动字典攻击以确定所有有效用户，因此他们会立即收到垃圾邮件列表。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-25T18:24:49.487

您应该做的实际上是检查收件人电子邮件的 MX 记录（电子邮件地址的域部分的 DNS MX 查询）并通过已解析的 SMTP 服务器发送消息。

这样，如果没有找到 MX 记录，你会得到一个“Hard Bounce”，如果找到但 send 方法抛出异常，你会得到一个“Soft Bounce”，如果它通过 - 你会得到一个“Success” ”。

您可以使用 dnsjava 项目来解析 MX 记录。 [http://www.dnsjava.org/](http://www.dnsjava.org/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-11-12T19:17:02.637

此[链接](http://edelstein.pebbles.cs.cmu.edu/jadeite/main.php?api=javamail&state=package&package=com.sun.mail.dsn)可能对您有所帮助。这在一个使用 RFC 3642 和 RFC 3464 的实验 jar 文件中。它有一些基本类，允许您获取邮件传递状态。而且你还需要[Javamail](http://www.oracle.com/technetwork/java/faq-135477.html#1) jar 文件。

# .net - 如何在 .NET C++ 项目中订购标头

> ID：150186
> 
> 赞同：0
> 
> 时间：2008-09-29T19:12:56.423
> 
> 标签：.net, c++, reference, header

我正在尝试从头开始构建一个新的 .NET C++ 项目。我计划在这个项目中混合托管和非托管代码。

此论坛主题 [IDataObject : ambiguous symbol error](http://www.daniweb.com/forums/thread29742.html)回答了我多次看到的问题。

帖子 #4 声明“将所有 '使用命名空间 XXXX' 从 .h 移动到 .cpp”

这看起来是个好主意，但现在在我的头文件中，我需要引用 .NET Framework 中的参数，例如

```
void loadConfigurations(String^ pPathname); 
```

我应该如何在 .cpp 文件中移动 using 语句并在 .h 文件中使用相应的命名空间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T19:24:02.450

在头文件中始终使用完全限定名称是个好主意。由于该`using`语句会影响所有后续代码`#include`，因此将`using`语句放在头文件中会影响可能包含该头文件的每个人。

因此，您可以将头文件中的函数声明更改为：

```
void loadConfigurations(SomeNamespace::String^ pPathname); 
```

其中 SomeNamespace 是您之前所在的命名空间的名称`using`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T19:21:54.827

我对 .NET 了解不多，所以我的回答仅适用于您问题的非托管 c++ 部分。就个人而言，这是我避免像瘟疫一样“使用命名空间 XXXX；”的主要原因之一。陈述。

我更喜欢明确地使用诸如“std::cout << “hello world” << std::endl; 之类的命名空间

这避免了命名空间冲突，并且对于某些东西的来源永远不会有任何歧义。此外，当您执行“使用命名空间标准；”之类的操作时 你有点撤销命名空间给你的东西。它们旨在避免碰撞，并且通过将所有内容导入全局，您只需将碰撞重新引入。

这完全是一个意见和品味的问题。

至于在标题中做什么，我只是写这样的东西：“void f(const std::string &s);”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T19:23:14.073

为了解决这个问题，我在 .h 文件中这样做了：

```
namespace TestClassNS
{
  class TestClass;
} 
```

然后在 .cpp 文件中，我将 #include TestClass 所在的 .h 并在那里使用 namespaceTestClassNS。

我的 C++ 生锈了，所以可能有更好的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T03:23:32.203

根据我的经验，您必须注意的唯一命名空间是 System 本身。有点烦人的是，最常见、最重要的是你发现问题的地方，但这就是生活。

至少您可以放心，如果您正在创建托管类，那么与非托管类的头文件问题不同，包含问题将在程序集障碍上得到缓解。

# css - 在 firebug 中，如何找出应用于特定元素的所有 css 样式？

> ID：150191
> 
> 赞同：4
> 
> 时间：2008-09-29T19:15:05.980
> 
> 标签：css, firebug

我深陷在许多嵌套的 CSS 级别中，我不知道哪个样式层/级别弄乱了我的显示。如何找出应用于特定元素的所有内容？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-29T19:17:54.743

单击检查（左上角）以选择要检查的元素

然后在右侧面板上选择标有“样式”的选项卡。它还会告诉您特定属性来自哪个 .css 文件

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T19:18:21.450

右键单击该元素并选择“检查元素”，然后您应该会看到该元素以及对其做出贡献的所有 CSS 规则。您只需单击并编辑值即可修改规则，以尝试不同的方法来纠正问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T19:19:19.030

使用检查按钮。单击您感兴趣的项目。在右侧，Firebug 显示元素的所有样式，以及它们源自的文件 + 行号。

找到您要应用的样式，看看它是否有笔触。如果是这样，它就会被层次结构中更高级别的东西覆盖。

现在你必须决定如何解决它。通过使您的 css 条目更具体到所讨论的项目，或以其他方式修改您的样式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T19:20:24.970

从“CSS”选项卡中，单击“检查”，然后单击元素。所有应用的样式（及其来源）都将显示在右侧。

# java - 在 Java 变量和方法名中使用下划线

> ID：150192
> 
> 赞同：89
> 
> 时间：2008-09-29T19:15:06.653
> 
> 标签：java, naming-conventions

即使现在我也经常在 Java 变量和方法中看到下划线，例如成员变量（如“m_count”或“_count”）。据我记得，在这些情况下使用下划线被 Sun 称为坏风格。

唯一应该使用它们的地方是常量（例如“public final static int IS_OKAY = 1;”），因为常量应该全部大写而不是驼峰式。在这里，下划线应该使代码更具可读性。

你认为在 Java 中使用下划线是不好的风格吗？如果是（或不是），为什么？

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2008-09-29T19:17:43.573

如果您现在没有使用它的代码，我建议您继续这样做。如果您的代码库使用它，请继续。

编码风格最重要的是*一致性*。如果您没有什么要一致的，那么语言供应商的建议可能是一个不错的起点。

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2008-09-29T19:41:39.693

```
sunDoesNotRecommendUnunderscoresBecauseJavaVariableAndFunctionNamesTendToBeLongEnoughAsItIs();

as_others_have_said_consistency_is_the_important_thing_here_so_chose_whatever_you_think_is_more_readable();
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-09-29T19:19:46.547

规则：

1.  做你正在编辑的代码所做的事情
2.  如果 #1 不适用，请使用驼峰式，不要使用下划线

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-09-29T23:05:35.913

我不认为在 Java 或任何其他语言中使用 _ 或 m_ 来指示成员变量是不好的。我认为它提高了代码的可读性，因为它允许您查看代码片段并快速识别出本地变量的所有成员变量。

您也可以通过强制用户在实例变量前面加上“this”来实现这一点，但我觉得这有点苛刻。在许多方面它违反了 DRY，因为它是一个实例变量，为什么要对它进行两次限定。

我自己的个人风格是使用 m_ 而不是 _。原因是还有全局变量和静态变量。m_/_ 的优点是它区分了变量范围。所以你不能将 _ 用于全局或静态，而是分别选择 g_ 和 s_ 。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-29T19:21:25.997

“坏风格”是非常主观的。如果某个约定适用于您和您的团队，我认为这将成为一种坏/好的风格。

回答您的问题：我使用前导下划线来标​​记私有变量。我发现它很清楚，我可以快速扫描代码并找出发生了什么。

（不过，我几乎从不使用“this”，除非是为了防止名称冲突。）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-29T19:18:35.350

在变量前面使用“m_”或“_”可以更容易地在整个对象的方法中发现成员变量。

作为附带好处，键入“m_”或“_”将使智能感知首先弹出它们；）

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-29T19:55:07.040

这是Sun 对 Java 的建议的[链接。](http://www.oracle.com/technetwork/java/javase/documentation/codeconvtoc-136057.html)并不是说你必须使用这些，甚至它们的库代码都遵循它们，但如果你从头开始，这是一个好的开始。像 Eclipse 这样的工具内置了格式化程序和清理工具，可以帮助您遵守这些约定（或您定义的其他约定）。

对我来说，'_' 太难输入了:)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-29T20:25:41.240

*   我碰巧喜欢（私有）实例变量的前导下划线，它似乎更容易阅读和区分。当然这件事会让你在边缘情况下遇到麻烦（例如公共实例变量（不常见，我知道） - 无论你用哪种方式命名他们可以说是在打破你的命名约定：
*   `private int _my_int; public int myInt;? _my_int? )`

- 尽管我喜欢它的 _style 并认为它是可读的，但我发现它可能比它的价值更麻烦，因为它不常见，而且它可能与您正在使用的代码库中的任何其他内容都不匹配。

- 自动代码生成（例如 eclipse 的生成 getter、setter）不太可能理解这一点，因此您必须手动修复它或用 eclipse 弄脏它以使其识别。

最终，您将与（java）世界的其他首选项对抗，并且可能会因此而烦恼。正如之前的海报所提到的，代码库的一致性胜过上述所有问题。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-07-09T13:35:42.037

在过去，使用下划线被认为是不好的风格是有原因的。当运行时编译器难以承受并且显示器具有惊人的 320x240 像素分辨率时，通常很难区分`_name`和`__name`.

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-29T20:06:32.317

很高兴有一些东西可以区分私有变量和公共变量，但我不喜欢一般编码中的“_”。如果我可以在新代码中提供帮助，我会避免使用它们。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-29T19:20:35.780

它是编码风格的混合体。一种思想流派是在私有成员前面加上下划线以区分它们。

```
setBar( int bar)
{
   _bar = bar;
} 
```

代替

```
setBar( int bar)
{
   this.bar = bar;
} 
```

其他人将使用下划线表示临时局部变量，该变量将在方法调用结束时超出范围。（我觉得这没什么用——一个好的方法不应该那么长，而且声明就在那里！所以我知道它超出了范围）编辑：上帝禁止这所学校的程序员和 memberData 学校的程序员合作！那将是地狱。

有时，生成的代码会在变量前加上 _ 或 __。这个想法是没有人会这样做，所以它是安全的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-29T19:20:51.553

我认为任何违反语言自身风格准则（没有正当理由）的风格都是丑陋的，因此是“坏的”。

毫无疑问，您所看到的代码是由曾经使用可以接受下划线的语言编写的。

有些人就是无法适应新的编码风格......

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-29T19:34:11.380

人们这样做的原因（根据我的经验）是为了区分成员变量和函数参数。在 Java 中，你可以有一个这样的类：

```
public class TestClass {
  int var1;

  public void func1(int var1) {
     System.out.println("Which one is it?: " + var1);
  }
}
```

如果您将成员变量设置为 _var1 或 m_var1，则函数中不会有歧义。

所以这是*一种*风格，我不会说它不好。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-29T19:54:12.347

就个人而言，我认为一种语言不应该为编码风格制定*规则。*这是关于可读性的偏好、使用、便利性和概念的问题。
现在，一个项目*必须*设置编码规则，以确保列表之间的一致性。你可能不同意这些规则，但如果你想做出贡献（或在团队中工作），你应该遵守它们。

至少，像 Eclispe 这样的 IDE 是不可知的，允许设置变量前缀或后缀等规则，各种样式的大括号放置和空间管理等。因此您可以使用它按照*您的*指南重新格式化代码。

注意：我属于那些保持 C/C++ 的旧习惯的人之一，使用 m_ 为成员变量（静态变量为 s_）编写 Java 代码，为布尔值加上首字母 b，使用首字母大写字母作为函数名并对齐大括号。 .. Java 原教旨主义者的恐怖！;-)
有趣的是，这就是我工作时使用的约定...可能是因为主要的初始开发人员来自 MFC 世界！:-D

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-17T03:21:47.777

这只是你自己的风格，没有不好的风格代码，也没有好的风格代码，只是我们的代码与其他代码不同。

# .net - 在 .NET 2.0 中使用“记住我”功能进行身份验证

> ID：150201
> 
> 赞同：8
> 
> 时间：2008-09-29T19:16:56.350
> 
> 标签：.net, authentication, forms, cookies

我的客户希望我在用户登录时启用“记住我”复选框。我正在加密用户名和密码并将其存储在 cookie 中。

但是，当文本框处于密码模式时，您不能写入文本框。

我已经看过很多次了，他们是怎么做到的？

提前致谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T19:19:13.397

不如不将文本插入登录表单，而是完全绕过表单，直接在登录页面检查 cookie 的内容，怎么样？为用户减少了工作量，它会使它更加无缝。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T19:30:47.347

```
Page_Load( ...)
 {
    ... process cookie ...
    if (cookie is good) Response.Redirect("content.aspx");
 } 
```

只需记住在重定向之前关闭并处理任何数据库活动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T07:53:36.617

我不记得有任何网页像您描述的那样做类似的事情，但我认为这是网络浏览器自动填写密码。我知道这不是一个好的解决方案，但你可以做的可能是，如果有一个 cookie 来验证用户身份，那么在不同的登录页面中设置带有星号或类似内容的普通文本框的文本。无论如何，您都不需要使用文本框中的密码来验证用户身份。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T21:51:46.350

如果您的服务器端代码可以从 cookie 访问他们的用户名和密码，那么您的页面不能像这样填充表单字段的值属性：

```
<input type="text" name="username" value="<%=decryptedUsername%>" />
<input type="password" value="<%=decryptedPassword%>" /> 
```

当然，这是非常不安全的，因为您正在以纯文本形式将用户密码回显给他们（这是一个很大的禁忌）。但是正如您所说，您的客户并不担心安全隐患。如果它们是 SSL，则可能有助于减轻这种风险。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T19:51:31.137

他们不希望用户自动登录，他们只希望预先填写用户名和密码字段。

我知道这很愚蠢，和让你保持登录状态一样，但这是他们的要求。

我已经提到这不是最好的安全实践，但他们不在乎。

像 myspace 这样的网站使用它，你去 myspace.com 并且你的用户名和密码已经填写好了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T12:22:00.033

那很简单，尝试使用：

txtPass.Attributes["value"] = "123456"; （很可能在页面加载事件处理程序上）

其中 txtPass 是密码文本框的 ID（在密码模式下）。你想显示的密码是123456。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T19:24:08.753

您可以将 cookie 的到期时间设置为 2 周以保持用户登录。这就是 ASP.NET 身份验证与持久身份验证一起工作的方式。请记住更新每个请求的到期时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-30T19:50:58.913

文本框是否可以更改类型？如果是这样，你能不能让文本框正常隐藏，然后把密码放在那里，然后把文本框类型改成密码类型，然后取消隐藏...

# .net - 如何在 .NET 中将 HTML 转换为 RTF（富文本）而不为组件付费？

> ID：150208
> 
> 赞同：39
> 
> 时间：2008-09-29T19:17:56.490
> 
> 标签：.net, html, rtf, richtext

是否有免费的第三方或 .NET 类可以将 HTML 转换为 RTF（用于启用富文本的 Windows 窗体控件）？

“免费”要求来自这样一个事实，即我只在开发一个原型，并且可以加载 BrowserControl 并在需要时仅渲染 HTML（即使它很慢），并且 Developer Express 将发布他们自己的此类控制很快。

我不想学习手工编写 RTF，而且我已经知道 HTML，所以我认为这是快速获得一些可演示代码的最快方法。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2011-01-31T18:34:04.107

实际上有一个简单而**免费**的解决方案：使用您的浏览器，好的，这是我使用的技巧：

```
var webBrowser = new WebBrowser();
webBrowser.CreateControl(); // only if needed
webBrowser.DocumentText = *yourhtmlstring*;
while (_webBrowser.DocumentText != *yourhtmlstring*)
    Application.DoEvents();
webBrowser.Document.ExecCommand("SelectAll", false, null);
webBrowser.Document.ExecCommand("Copy", false, null);
*yourRichTextControl*.Paste(); 
```

这可能比其他方法慢，但至少它是免费的并且有效！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-16T03:03:40.967

查看有关[XHTML2RTF](http://www.codeproject.com/KB/HTML/XHTML2RTF.aspx)的 CodeProject 文章。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-02-17T21:01:21.253

扩展 Spartaco 的答案，我暗示了以下内容，效果很好！

```
 Using reportWebBrowser As New WebBrowser
        reportWebBrowser.CreateControl()
        reportWebBrowser.DocumentText = sbHTMLDoc.ToString
        While reportWebBrowser.DocumentText <> sbHTMLDoc.ToString
            Application.DoEvents()
        End While
        reportWebBrowser.Document.ExecCommand("SelectAll", False, Nothing)
        reportWebBrowser.Document.ExecCommand("Copy", False, Nothing)

        Using reportRichTextBox As New RichTextBox
            reportRichTextBox.Paste()
            reportRichTextBox.SaveFile(DocumentFileName)
        End Using
    End Using 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T21:11:35.570

当然它并不完美，但这里是我用来将 HTML 转换为纯文本的代码。

（我不是原作者，我是根据网上找到的代码改编的）

```
public static string ConvertHtmlToText(string source) {

            string result;

            // Remove HTML Development formatting
            // Replace line breaks with space
            // because browsers inserts space
            result = source.Replace("\r", " ");
            // Replace line breaks with space
            // because browsers inserts space
            result = result.Replace("\n", " ");
            // Remove step-formatting
            result = result.Replace("\t", string.Empty);
            // Remove repeating speces becuase browsers ignore them
            result = System.Text.RegularExpressions.Regex.Replace(result,
                                                                  @"( )+", " ");

            // Remove the header (prepare first by clearing attributes)
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*head([^>])*>", "<head>",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"(<( )*(/)( )*head( )*>)", "</head>",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(<head>).*(</head>)", string.Empty,
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // remove all scripts (prepare first by clearing attributes)
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*script([^>])*>", "<script>",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"(<( )*(/)( )*script( )*>)", "</script>",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            //result = System.Text.RegularExpressions.Regex.Replace(result, 
            //         @"(<script>)([^(<script>\.</script>)])*(</script>)",
            //         string.Empty, 
            //         System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"(<script>).*(</script>)", string.Empty,
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // remove all styles (prepare first by clearing attributes)
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*style([^>])*>", "<style>",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"(<( )*(/)( )*style( )*>)", "</style>",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(<style>).*(</style>)", string.Empty,
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // insert tabs in spaces of <td> tags
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*td([^>])*>", "\t",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // insert line breaks in places of <BR> and <LI> tags
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*br( )*>", "\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*li( )*>", "\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // insert line paragraphs (double line breaks) in place
            // if <P>, <DIV> and <TR> tags
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*div([^>])*>", "\r\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*tr([^>])*>", "\r\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<( )*p([^>])*>", "\r\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // Remove remaining tags like <a>, links, images,
            // comments etc - anything thats enclosed inside < >
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<[^>]*>", string.Empty,
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // replace special characters:
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&nbsp;", " ",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&bull;", " * ",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&lsaquo;", "<",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&rsaquo;", ">",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&trade;", "(tm)",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&frasl;", "/",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"<", "<",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @">", ">",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&copy;", "(c)",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&reg;", "(r)",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            // Remove all others. More can be added, see
            // http://hotwired.lycos.com/webmonkey/reference/special_characters/
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     @"&(.{2,6});", string.Empty,
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);

            // make line breaking consistent
            result = result.Replace("\n", "\r");

            // Remove extra line breaks and tabs:
            // replace over 2 breaks with 2 and over 4 tabs with 4\. 
            // Prepare first to remove any whitespaces inbetween
            // the escaped characters and remove redundant tabs inbetween linebreaks
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(\r)( )+(\r)", "\r\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(\t)( )+(\t)", "\t\t",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(\t)( )+(\r)", "\t\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(\r)( )+(\t)", "\r\t",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            // Remove redundant tabs
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(\r)(\t)+(\r)", "\r\r",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            // Remove multible tabs followind a linebreak with just one tab
            result = System.Text.RegularExpressions.Regex.Replace(result,
                     "(\r)(\t)+", "\r\t",
                     System.Text.RegularExpressions.RegexOptions.IgnoreCase);
            // Initial replacement target string for linebreaks
            string breaks = "\r\r\r";
            // Initial replacement target string for tabs
            string tabs = "\t\t\t\t\t";
            for (int index = 0; index < result.Length; index++) {
                result = result.Replace(breaks, "\r\r");
                result = result.Replace(tabs, "\t\t\t\t");
                breaks = breaks + "\r";
                tabs = tabs + "\t";
            }

            // Thats it.
            return result;

    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T08:10:05.650

也许您需要[一个用于编辑 HTML 的控件](http://www.codeplex.com/WinformHtmlTextbox)？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-06-24T09:35:30.830

我推荐一个名为[Pandoc](https://pandoc.org/)的控制台工具。它不是一个组件，它是一个相当大的转换包。我正在使用它在 HTML 和 LaTeX 之间进行转换。真是太棒了。

您可以[在程序页面上](https://pandoc.org/index.html)找到支持格式的完整列表。

为了将 HTML 文档转换为 RTF 格式，您可以在控制台上编写：

```
pandoc filename.html -f html -t rtf -s -o filename.rtf 
```

# c# - 如何使用 LINQ 查询项目，但也包括丢失的项目？

> ID：150213
> 
> 赞同：1
> 
> 时间：2008-09-29T19:18:50.810
> 
> 标签：c#, asp.net, linq

我正在尝试在我们的注册系统中绘制每天的注册数量。我在 sql server 中有一个 Attendee 表，它有一个 smalldatetime 字段 A_DT，它是该人注册的日期和时间。

我从这个开始：

```
var dailyCountList =
    (from a in showDC.Attendee
    let justDate = new DateTime(a.A_DT.Year, a.A_DT.Month, a.A_DT.Day)
    group a by justDate into DateGroup
    orderby DateGroup.Key
    select new RegistrationCount
    {
        EventDateTime = DateGroup.Key,
        Count = DateGroup.Count()
    }).ToList(); 
```

这很好用，但它不包括没有注册的日期，因为这些日期没有与会者记录。我希望包含每个日期，并且当给定日期没有数据时，计数应该为零。

所以这是我目前的工作解决方案，但我知道这很糟糕。我在上面的代码中添加了以下内容：

```
// Create a new list of data ranging from the beginning to the end of the first list, specifying 0 counts for missing data points (days with no registrations)
var allDates = new List<RegistrationCount>();
for (DateTime date = (from dcl in dailyCountList select dcl).First().EventDateTime; date <= (from dcl in dailyCountList select dcl).Last().EventDateTime; date = date.AddDays(1))
{
    DateTime thisDate = date; // lexical closure issue - see: http://www.managed-world.com/2008/06/13/LambdasKnowYourClosures.aspx
    allDates.Add(new RegistrationCount
    {
        EventDateTime = date,
        Count = (from dclInner in dailyCountList
        where dclInner.EventDateTime == thisDate
        select dclInner).DefaultIfEmpty(new RegistrationCount
        {
            EventDateTime = date,
            Count = 0
        }).Single().Count
    });
} 
```

所以我创建了另一个列表，并循环遍历我根据查询中的第一个和最后一个注册生成的日期序列，并且对于日期序列中的每个项目，我查询我的第一个查询的结果以获取有关给定的信息日期，如果没有返回，则提供默认值。所以我最终在这里做了一个子查询，我想避免这种情况。

任何人都可以提出一个优雅的解决方案吗？或者至少是一个不那么尴尬的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T19:47:58.790

O(n) 有 2 个枚举。在尝试之前将项目拉入内存非常好。无需考虑这些东西，数据库就足够了。

```
 if (!dailyCountList.Any())
      return;

  //make a dictionary to provide O(1) lookups for later

  Dictionary<DateTime, RegistrationCount> lookup = dailyCountList.ToDictionary(r => r.EventDateTime);

  DateTime minDate = dailyCountList[0].EventDateTime;
  DateTime maxDate = dailyCountList[dailyCountList.Count - 1].EventDateTime;

  int DayCount = 1 + (int) (maxDate - minDate).TotalDays;

  // I have the days now.
  IEnumerable<DateTime> allDates = Enumerable
    .Range(0, DayCount)
    .Select(x => minDate.AddDays(x));

  //project the days into RegistrationCounts, making up the missing ones.
  List<RegistrationCount> result = allDates
      .Select(d => lookup.ContainsKey(d) ? lookup[d] :
          new RegistrationCount(){EventDateTime = d, Count = 0})
      .ToList(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T20:13:28.960

那么，在 SP1 之后，左外连接的这种语法是否不再有效？

通常，您应该能够执行以下操作，但是您需要 SQL 数据库中的各种日历表连接到注册表中的日期键（日期 id 字段上带有外键），然后尝试：

```
var query =
    from cal in dataContext.Calendar
    from reg in cal.Registrations.DefaultIfEmpty()
    select new
    {
        cal.DateID,
        reg.Something
    }; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T22:12:46.337

问题是如果不执行查询，您就没有日期范围。因此，您可以选择一个日期范围，对您的数据库运行 SELECT MAX 和 SELECT MIN，或者执行您的查询，然后添加缺失的日期。

```
var allDailyCountList =
   from d in Range(dc[0].EventDateTime, dc[dc.Count - 1].EventDateTime) 
   // since you already ordered by DateTime, we don't have to search the entire List
   join dc in dailyCountList on
      d equals dc.EventDateTime
   into rcGroup
   from rc in rcGroup.DefaultIfEmpty(
      new RegistrationCount()
      {
         EventDateTime = d,
         Count = 0
      }
   ) // gives us a left join
   select rc;

public static IEnumerable<DateTime> Range(DateTime start, DateTime end) {
   for (DateTime date = start, date <= end; date = date.AddDays(1)) {
      yield return date;
   }
} 
```

# command-line - SQL 2005 Express Edition - 安装新实例

> ID：150223
> 
> 赞同：6
> 
> 时间：2008-09-29T19:20:21.337
> 
> 标签：command-line, installation, sql-server-express, instance, sql-server-2005-express

寻找一种以编程方式或其他方式将 SQL 2005 Express Edition 的新实例添加到已安装实例的系统的方法。传统上，您像我在下面的命令行中一样运行 Micrsoft 的安装程序，它就可以解决问题。在我的安装程序中执行命令不是问题，更多的是拖动 40 MB 的 MS-SQL 安装程序，如果他们已经安装了 SQL Express，我不需要这些安装程序。这是我的安装程序当前执行的：

```
SQLEXPR32.EXE /qb ADDLOCAL=ALL INSTANCENAME=<instancename> SECURITYMODE=SQL SAPWD=<password> SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0 
```

我不需要启动此命令的帮助，而是添加新的 SQL 2005 Express 实例而无需再次运行完整安装程序的适当方法。

我会详细说明我为什么要这样做，但我只是让每个人都感到厌烦。可以说，无需重新安装 SQL Express 等即可创建新实例的能力将极大地帮助我部署我的应用程序及其安装程序。如果对任何人有任何影响，我将在此安装项目中使用 NSIS 和 Advanced Installer 的组合。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T20:42:15.080

听起来用户实例可能会对您有所帮助。如果您有 MDF 和 LDF 文件，则可以通过指示 SQL Server Express 启动用户实例并将指定文件附加到该实例来连接到这些文件。

这篇文章[http://msdn.microsoft.com/en-us/library/bb264564.aspx](http://msdn.microsoft.com/en-us/library/bb264564.aspx)很好地描述了如何依靠现有的 SQL Server Express 安装在连接期间实例化用户特定的实例.

希望能帮助到你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T19:23:24.247

我不知道如何使用 API 来做到这一点，但如果没有人提供更好的解决方案，您始终可以使用 Process.Start() 按原样执行命令行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-14T21:09:44.460

经过数月/数年的调查，似乎无法完成。哦，好吧，我想我每次想要一个新实例时都重新安装。我想这是因为每个实例都是它自己的服务。

# sql - T-SQL 中的 while 子句永远循环

> ID：150250
> 
> 赞同：7
> 
> 时间：2008-09-29T19:24:07.567
> 
> 标签：sql, sql-server, tsql

我最近的任务是调试电子商务应用程序中的一个奇怪问题。应用程序升级后，网站开始不时挂起，我被派去调试。检查事件日志后，我发现 SQL 服务器在几分钟内写入了大约 200 000 个事件，并显示约束失败的消息。经过多次调试和一些跟踪，我找到了罪魁祸首。我已经删除了一些不必要的代码并对其进行了一些清理，但基本上就是这样

```
WHILE EXISTS (SELECT * FROM ShoppingCartItem WHERE ShoppingCartItem.PurchID = @PurchID)
BEGIN
    SELECT TOP 1 
        @TmpGFSID = ShoppingCartItem.GFSID, 
        @TmpQuantity = ShoppingCartItem.Quantity,
        @TmpShoppingCartItemID = ShoppingCartItem.ShoppingCartItemID,
    FROM
        ShoppingCartItem INNER JOIN GoodsForSale on ShoppingCartItem.GFSID = GoodsForSale.GFSID
    WHERE ShoppingCartItem.PurchID = @PurchID

    EXEC @ErrorCode = spGoodsForSale_ReverseReservations @TmpGFSID, @TmpQuantity
    IF @ErrorCode <> 0
    BEGIN
        Goto Cleanup    
    END

    DELETE FROM ShoppingCartItem WHERE ShoppingCartItem.ShoppingCartItemID = @TmpShoppingCartItemID
    -- @@ROWCOUNT is 1 after this
END 
```

事实：

1.  只有一个或两个记录匹配第一个选择子句
2.  DELETE 语句中的 RowCount 表明它已被删除
3.  WHILE 子句将永远循环

该过程已被重写，以选择应删除到临时内存表中的行，从而解决了眼前的问题，但这确实激发了我的好奇心。

为什么它永远循环？

**澄清**：删除不会失败（@@rowcount 在调试时删除 stmt 后为 1） **澄清 2**：SELECT TOP ... 子句是否按任何特定字段排序都无关紧要，因为记录与返回的 id 将被删除，因此在下一个循环中它应该获得另一条记录。

**更新**：检查颠覆日志后，我发现了导致此存储过程失控的罪魁祸首。我能找到的唯一真正的区别是，以前在 SELECT TOP 1 语句中没有加入，即没有加入，它在没有围绕删除的任何事务语句的情况下工作。似乎是联接的引入使 SQL Server 更加挑剔。

**更新说明**： [brien](https://stackoverflow.com/questions/150250/while-clause-in-t-sql-that-loops-forever#150400)指出不需要连接，但我们确实使用了 GoodsForSale 表中的一些字段，但我删除了它们以保持代码简单，以便我们可以专注于手头的问题

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T19:37:05.367

您是在显式还是隐式[事务模式下操作](http://doc.ddart.net/mssql/sql70/ta-tz_8.htm)？

由于您处于显式模式，我认为您需要使用 BEGIN TRANSACTION 和 COMMIT TRANSACTION 语句来包围 DELETE 操作。

```
WHILE EXISTS (SELECT * FROM ShoppingCartItem WHERE ShoppingCartItem.PurchID = @PurchID)
BEGIN
    SELECT TOP 1 
            @TmpGFSID = ShoppingCartItem.GFSID, 
            @TmpQuantity = ShoppingCartItem.Quantity,
            @TmpShoppingCartItemID = ShoppingCartItem.ShoppingCartItemID,
    FROM
            ShoppingCartItem INNER JOIN GoodsForSale on ShoppingCartItem.GFSID = GoodsForSale.GFSID
    WHERE ShoppingCartItem.PurchID = @PurchID

    EXEC @ErrorCode = spGoodsForSale_ReverseReservations @TmpGFSID, @TmpQuantity
    IF @ErrorCode <> 0
    BEGIN
            Goto Cleanup    
    END

    BEGIN TRANSACTION delete

        DELETE FROM ShoppingCartItem WHERE ShoppingCartItem.ShoppingCartItemID = @TmpShoppingCartItemID
        -- @@ROWCOUNT is 1 after this

    COMMIT TRANSACTION delete
END 
```

**澄清：**您需要使用事务的原因是删除实际上不会在数据库中发生，直到您执行 COMMIT 操作。这通常在原子事务中有多个写入操作时使用。基本上，您只希望在所有操作都成功的情况下对数据库进行更改。

在您的情况下，只有 1 个操作，但由于您处于显式事务模式，您需要告诉 SQL Server**真正**进行更改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T21:50:52.330

```
FROM
  ShoppingCartItem
    INNER JOIN
  GoodsForSale
    on ShoppingCartItem.GFSID = GoodsForSale.GFSID 
```

糟糕，您的联接将结果集降至零行。

```
 SELECT TOP 1
    @TmpGFSID = ShoppingCartItem.GFSID,
    @TmpQuantity = ShoppingCartItem.Quantity,
    @TmpShoppingCartItemID =
      ShoppingCartItem.ShoppingCartItemID 
```

糟糕，您对没有行的集合使用了多重分配。这会导致变量保持不变（它们将具有与上次循环时相同的值）。在这种情况下，变量不会被分配给 null。

如果将此代码放在循环的开头，它将（正确地）更快地失败：

```
 SELECT
    @TmpGFSID = null,
    @TmpQuantity = null,
    @TmpShoppingCartItemID = null 
```

如果您更改代码以获取密钥（不加入），然后在第二个查询中通过密钥获取相关数据，您将获胜。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T19:36:07.990

ShoppingCartItem 中是否有带有 @PurchID 的记录，而 GFSID 不在 GoodsForSale 表中？这可以解释为什么 EXISTS 返回 true，但没有更多记录要删除。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T19:28:20.863

显然，某些内容并没有在应有的地方被删除或修改。如果在下一次迭代中条件仍然相同，它将继续进行。

此外，您正在比较@TmpShoppingCartItemID，而不是@PurchID。我可以看到这些可能有何不同，并且您可以删除与 while 语句中正在检查的行不同的行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T20:38:08.667

如果到目前为止上述评论对您没有帮助，我建议添加/替换：

```
DECLARE Old@ShoppingCartItemID INT

SET @OldShoppingCartItemID = 0

WHILE EXISTS (SELECT ... WHERE ShoppingCartItemID > @ShoppingCartItemID)

SELECT TOP 1 WHERE ShoppingCartItemID > @OldShoppingCartItemID ORDER BY ShoppingCartItemID 

SET @OldShoppingCartItemID = @TmpShoppingCartItemID 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-11T09:25:17.767

如果 GoodsForSale 表中不存在任何购物车项目，那么这将进入无限循环。

尝试更改您的存在声明以考虑到这一点

```
(SELECT * FROM ShoppingCartItem WHERE  JOIN GoodsForSale on ShoppingCartItem.GFSID = GoodsForSale.GFSID where ShoppingCartItem.PurchID = @PurchID) 
```

或者更好的是，重写它，这样它就不需要循环了。像这样的循环是一个等待发生的无限循环。您应该替换为基于集合的操作和事务。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-29T19:33:34.190

我不确定我是否理解这个问题，但在 select 子句中它正在与另一个表进行内部连接。该连接可能导致没有记录，然后删除失败。尝试使用左连接。

# c++ - 在 C++ 应用程序中查找未引用的方法

> ID：150269
> 
> 赞同：3
> 
> 时间：2008-09-29T19:28:52.500
> 
> 标签：c++, code-coverage, legacy-code

我们有一个大型的 C/C++ 遗留源代码树，它已经出现了几次。我们预计有大量的方法不再使用。有没有工具可以帮助我们快速识别未使用的代码？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T19:43:04.823

你应该得到一个好的静态代码分析器。

在这里寻找合适的选择。

1.  [是否有任何有用的免费 C++ 代码覆盖工具？](https://stackoverflow.com/questions/84109/is-there-any-free-c-code-coverage-tool-which-is-useful)
2.  [您使用什么工具进行静态代码分析？](https://stackoverflow.com/questions/20788/what-tools-do-you-use-for-static-code-analysis)
3.  [您最喜欢的代码覆盖率工具是什么（免费和非免费）](https://stackoverflow.com/questions/39329/what-is-your-favourite-code-coverage-tools-free-and-non-free)

另请查看[CTC++ 测试覆盖率分析器](http://www.verifysoft.com/en_ctcpp.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T22:39:03.307

对于 GCC，有[GCov](http://linuxcommand.org/man_pages/gcov1.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T19:30:59.610

在工作中，我们使用[AQTime](http://www.automatedqa.com)来满足任何分析需求。它带有一个静态分析工具，应该是你需要的。但是，如果您不需要其他分析器或在 AQTime 不支持的平台或编译器上运行，则至少在金钱方面是矫枉过正的。

# python - __reduce__ 和 __reduce_ex__ 有什么区别？

> ID：150284
> 
> 赞同：19
> 
> 时间：2008-09-29T19:31:50.077
> 
> 标签：python, pickle

我知道这些方法用于酸洗/解酸，与 reduce 内置函数无关，但是 2 之间有什么区别，为什么我们需要两者？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-29T19:41:37.243

[文档](https://docs.python.org/2/library/pickle.html#pickling-and-unpickling-extension-types)说

> 如果提供，在酸洗时 `__reduce__()`将不带参数调用，它必须返回一个字符串或一个元组。

另一方面，

> 在实现时了解协议版本有时很有用 `__reduce__`。这可以通过实现一个名为 `__reduce_ex__`而不是 `__reduce__`. `__reduce_ex__`，当它存在时，优先调用 `__reduce__`（您仍然可以提供 `__reduce__`向后兼容性）。该`__reduce_ex__` 方法将使用单个整数参数（协议版本）调用。

Guido[说](http://mail.python.org/pipermail/python-3000/2008-February/012094.html)，这是一个可以清理的区域。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-29T19:42:58.537

`__reduce_ex__`是`__reduce__`应该成为但从未成为的。 `__reduce_ex__`工作方式类似`__reduce__`，但通过了 pickle 协议。

# c++ - 如何以编程方式获取 C++ 中的 CPU 缓存页面大小？

> ID：150294
> 
> 赞同：27
> 
> 时间：2008-09-29T19:35:18.273
> 
> 标签：c++, windows, linux, cpu

我希望我的程序读取它在 C++ 中运行的 CPU 的缓存行大小。

我知道这不能移植，所以我需要一个 Linux 解决方案和另一个 Windows 解决方案（其他系统的解决方案可能对其他人有用，所以如果你知道它们，请发布它们）。

对于 Linux，我可以读取 /proc/cpuinfo 的内容并解析以 cache_alignment 开头的行。也许有更好的方法涉及对 API 的调用。

对于 Windows，我根本不知道。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-29T19:38:50.060

在 Win32 上，[`GetLogicalProcessorInformation`](http://msdn.microsoft.com/en-us/library/ms683194.aspx)将返回 a[`SYSTEM_LOGICAL_PROCESSOR_INFORMATION`](http://msdn.microsoft.com/en-us/library/ms686694.aspx)其中包含 a [`CACHE_DESCRIPTOR`](http://msdn.microsoft.com/en-us/library/ms681979.aspx)，其中包含您需要的信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T19:49:21.890

在 Linux 上尝试使用[proccpuinfo 库](https://savannah.nongnu.org/projects/proccpuinfo/)，这是一个独立于架构的 C API，用于读取 /proc/cpuinfo

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T19:46:10.697

对于 x86，[CPUID](http://en.wikipedia.org/wiki/CPUID)指令。一个快速的谷歌搜索揭示了一些用于 win32 和 c++ 的[库。](http://www.google.com/search?hl=en&q=cpuid+library)我也通过内联汇编器使用了 CPUID。

更多信息：

*   [http://www.intel.com/Assets/PDF/appnote/241618.pdf](http://www.intel.com/Assets/PDF/appnote/241618.pdf)
*   [http://softpixel.com/~cwright/programming/simd/cpuid.php](http://softpixel.com/~cwright/programming/simd/cpuid.php)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T19:38:19.997

看起来至少 SCO unix ( [http://uw714doc.sco.com/en/man/html.3C/sysconf.3C.html](http://uw714doc.sco.com/en/man/html.3C/sysconf.3C.html) ) 有 _SC_CACHE_LINE 用于 sysconf。也许其他平台也有类似的东西？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-09-13T09:25:46.607

**在 Windows 上**

```
#include <Windows.h>
#include <iostream>

using std::cout; using std::endl;

int main()
{
    SYSTEM_INFO systemInfo;
    GetSystemInfo(&systemInfo);
    cout << "Page Size Is: " << systemInfo.dwPageSize;
    getchar();
} 
```

**在 Linux 上**

[http://linux.die.net/man/2/getpagesize](http://linux.die.net/man/2/getpagesize)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-05-27T13:56:43.793

以下是那些想知道如何在接受的答案中使用该功能的人的示例代码：

```
#include <new>
#include <iostream>
#include <Windows.h>

void ShowCacheSize()
{
    using CPUInfo = SYSTEM_LOGICAL_PROCESSOR_INFORMATION;
    DWORD len = 0;
    CPUInfo* buffer = nullptr;

    // Determine required length of a buffer
    if ((GetLogicalProcessorInformation(buffer, &len) == FALSE) && (GetLastError() == ERROR_INSUFFICIENT_BUFFER))
    {
        // Allocate buffer of required size
        buffer = new (std::nothrow) CPUInfo[len]{ };

        if (buffer == nullptr)
        {
            std::cout << "Buffer allocation of " << len << " bytes failed" << std::endl;
        }
        else if (GetLogicalProcessorInformation(buffer, &len) != FALSE)
        {
            for (DWORD i = 0; i < len; ++i)
            {
                // This will be true for multiple returned caches, we need just one
                if (buffer[i].Relationship == RelationCache)
                {
                    std::cout << "Cache line size is: " << buffer[i].Cache.LineSize << " bytes" << std::endl;
                    break;
                }
            }
        }
        else
        {
            std::cout << "ERROR: " << GetLastError() << std::endl;
        }

        delete[] buffer;
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T19:45:14.927

我认为你需要[`NtQuerySystemInformation`](http://msdn.microsoft.com/en-us/library/ms724509(VS.85).aspx)从`ntdll.dll`.

# database - 如何从 Compressed ESRI shapefile 数据源中提取地址信息？

> ID：150301
> 
> 赞同：1
> 
> 时间：2008-09-29T19:39:23.083
> 
> 标签：database, csv, gis, dbf, esri

当我从网站下载 zip 文件时，它包含具有以下扩展名的文件：

.dbf .prj .sbn .sbx .shp .shp.xml .shx

这是我下载或购买转换器的常见数据文件格式吗？我认为这是某种映射数据文件，但我只需要它包含的地址来推送到我们现有的数据库中。

具体而言，与编程有关。如何为这组文件或仅实际包含信息的 .dbf 文件设置 .NET 数据源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T19:50:45.053

我猜您要查找的地址信息存储在 dbf 文件中。[您可以从这里](http://arcscripts.esri.com/details.asp?dbid=13794)下载 ESRI dBase 驱动程序。

[在http://forums.esri.com/Thread.asp?c=9&f=85&t=141422](http://forums.esri.com/Thread.asp?c=9&f=85&t=141422)上有显示此驱动程序正在使用的示例代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T21:26:35.633

非常感谢所有提供信息的人。我找到了一个正是我需要的 CodePlex C# 项目。我确实必须做一个小的修改，我把它发回项目讨论板上，这是一个未知的列类型“F”。但是命令行程序 DBF2CSV 可以很好地从 dbf 文件创建格式良好的 csv。使用 Excel 几分钟后，我已准备好将其导入我们的 MySQL 数据库。

***以下项目有一个命令行程序，可以将 DBF 文件转换为 CSV*** [http://www.codeplex.com/fastdbf](http://www.codeplex.com/fastdbf)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T19:43:22.623

这是一个[形状文件](http://en.wikipedia.org/wiki/Shapefile)

页面底部的链接可能会对您有所帮助。我对这些类型文件的唯一经验是使用其他专有（且昂贵）软件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T20:49:24.710

dbf 文件的格式类似于旧的 DBase III 格式。shp 文件包含形状，而 shx 是某种索引。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T03:22:18.043

您可以使用 DBase IV 驱动程序在 MS Access 中打开 shapefile .dbf 文件，也可以直接在 MS Excel 中打开（打开为 *.dbf）

:o)

# c# - 显示请求页面的 404 页面

> ID：150329
> 
> 赞同：1
> 
> 时间：2008-09-29T19:45:40.993
> 
> 标签：c#, asp.net, vb.net, asp-classic, umbraco

我最近将一个网站迁移到一个新的 CMS (Umbraco)。很多链接都发生了变化，但是可以通过在 url 中搜索模式来轻松纠正它们，所以我想写一些东西，如果找不到旧的页面会重定向到正确的页面。那部分没有问题。

浏览器重定向到我的自定义 404 页面后，如何获取请求的 URL。我尝试使用：

```
request.ServerVariables("HTTP_REFERER") 'sorry i corrected the typo from system to server. 
```

但这没有用。

有任何想法吗？

该站点位于 IIS 6.0 上。我们确实考虑过使用 301 重定向，但我们无法知道人们收藏了哪些页面并且有几百页，因此没有人热衷于花时间创建 301。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T20:18:18.340

我在自定义 404 错误处理页面中所做的基本上与您要求的相同。在 IIS 6 上，原始 URL 位于查询字符串中。下面的代码展示了如何获取原始 URL，然后转发用户。在我的例子中，我从旧的 ASP 切换到新的 ASP.NET，所以所有的 .asp 页面都必须转发到 .aspx 页面。此外，一些 URL 发生了变化，所以我在旧 URL 中查找关键字并转发。

```
//did the error go to a .ASP page?  If so, append x (for .aspx) and 
//issue a 301 permanently moved
//when we get an error, the querystring will be "404;<complete original URL>"
string targetPage = Request.RawUrl.Substring(Request.FilePath.Length);

if((null == targetPage) || (targetPage.Length == 0))
    targetPage = "[home page]";
else
{
     //find the original URL
    if(targetPage[0] == '?')
    {
        if(-1 != targetPage.IndexOf("?aspxerrorpath="))
             targetPage = targetPage.Substring(15); // ?aspxerrorpath=
        else
             targetPage = targetPage.Substring(5); // ?404;
        }
        else
        {
             if(-1 != targetPage.IndexOf("errorpath="))
             targetPage = targetPage.Substring(14); // aspxerrorpath=
             else
            targetPage = targetPage.Substring(4); // 404;
        }
    }               

    string upperTarget = targetPage.ToUpper();
    if((-1 == upperTarget.IndexOf(".ASPX")) && (-1 != upperTarget.IndexOf(".ASP")))
    {
        //this is a request for an .ASP page - permanently redirect to .aspx
        targetPage = upperTarget.Replace(".ASP", ".ASPX");
        //issue 301 redirect
        Response.Status = "301 Moved Permanently"; 
        Response.AddHeader("Location",targetPage);
        Response.End();
    }

    if(-1 != upperTarget.IndexOf("ORDER"))
    {
                //going to old order page -- forward to new page
               Response.Redirect(WebRoot + "/order.aspx");
           Response.End();
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T19:48:40.253

怎么样：

```
Request.ServerVariables("HTTP_REFERER"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T19:51:04.210

> 很多链接都发生了变化，但可以通过在 url 中搜索模式轻松纠正它们

您是否考虑过使用 url 重写，而不是将您的用户发送到 404？这样，您的用户（和搜索引擎，如果在这种情况下这对您很重要）将获得[301 或 302](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes)，而不必通过您的 404 处理程序。在你的服务器上处理 url 级别的重写通常比启动你的代码并在那里处理它更快，压力更小。

Microsoft 发布了一个[用于 IIS 7 的 URL 重写模块，](http://iis.net/downloads/default.aspx?tabid=34&g=6&i=1691)[这里](http://www.qwerksoft.com/products/iisrewrite/IISRewriteDocumentation.htm)和[这里](http://www.sitepoint.com/article/guide-url-rewriting/)都有一个不错的介绍。

对于 IIS 6，这里有一个[很好的介绍](http://www.sitepoint.com/blogs/2007/08/22/making-iis-60-play-with-urlrewriting/)来使用它进行 URL 重写，与 IIS7 略有不同。

一个示例重写规则是

```
# $1 will contain the contents of (.*) - everything after new-dir/
RewriteRule /new-dir/(.*) /find_old_page.asp?code=$1 
```

> 有几百页，所以没有人热衷于花时间创建 301

重写规则的美妙之处在于您不需要列出来明确列出所有页面，但可以编写遵循相同模式的规则。最近我们不得不做类似的事情，令人惊讶的是，有多少移动的 url 可以通过几个简单的规则来处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T19:53:32.020

而不是使用 404 页面，我认为正确的做法是使用[301 - Moved Permanently](http://en.wikipedia.org/wiki/HTTP_301)代码进行重定向。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T20:34:40.253

以下是我们在 404 页面上对 init 所做的操作：

```
Dim AttemptedUrl As String = Request.QueryString("aspxerrorpath")
If Len(AttemptedUrl) = 0 Then AttemptedUrl = Request.Url.Query
AttemptedUrl = LCase(AttemptedUrl)
CheckForRedirects(AttemptedUrl) 
```

CheckforRedirects 然后具有自定义逻辑以将旧 URL 与新 URL 匹配。

我认为这是首选方法（与 301 或 URL 重写相反），如果您在内部有足够的信息来匹配来自旧系统的大量 URL 与新系统 - 例如，如果您有一个匹配的表用新 ID 或类似的东西更新旧 ID。

但是，如果有一个一致的模式可用于使用正则表达式将旧 URL 映射到新 URL，那么 URL 重写将是可行的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-27T13:28:56.510

为了构建 Rewrites 建议，Umbraco 已经使用 UrlRewriting.NET 并且可以将新的重写添加到

```
\config\UrlRewriting.config 
```

希望这可以帮助

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T19:48:32.173

更新，你实际上想拿起：

VB.NET：

```
Request.QueryString("aspxerrorpath") 
```

C＃：

```
Request.QueryString["aspxerrorpath"]; 
```

# c# - 在 Lambda/LINQ 中组合列表

> ID：150332
> 
> 赞同：16
> 
> 时间：2008-09-29T19:46:38.777
> 
> 标签：c#, .net, linq, lambda

如果我有类型的变量，`IEnumerable<List<string>>`是否有一个 LINQ 语句或 lambda 表达式我可以应用到它，它将组合返回的列表`IEnumerable<string>`？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-29T19:50:00.983

SelectMany - 即

```
 IEnumerable<List<string>> someList = ...;
        IEnumerable<string> all = someList.SelectMany(x => x); 
```

对于 someList 中的每个项目，这将使用 lambda "x => x" 来获取内部项目的 IEnumerable<T>。在这种情况下，每个“x”都是一个 List<T>，它已经是 IEnumerable<T>。

然后将它们作为连续块返回。本质上，SelectMany 类似于（简化）：

```
static IEnumerable<TResult> SelectMany<TSource, TResult>(
    this IEnumerable<TSource> source,
    Func<TSource, IEnumerable<TResult>> selector) {

    foreach(TSource item in source) {
      foreach(TResult result in selector(item)) {
        yield return result;
      }
    }
} 
```

虽然这有点简化。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T20:16:52.090

怎么样

```
myStrings.SelectMany(x => x) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T19:50:54.087

不完全是单个方法调用，但您应该能够编写

```
var concatenated = from list in lists from item in list select item; 
```

'lists' 是你的`IEnumerable<List<string>>`并且 concatenated 是 type `IEnumerable<string>`。

（从技术上讲，这*是*一个单一的方法调用`SelectMany`——它看起来并不是我在开场白中的全部意思。只是想澄清一下，以防有人感到困惑或发表评论——在我发布它之后我意识到可以读）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T19:56:48.317

做一个简单的方法。不需要 LINQ：

```
IEnumerable<string> GetStrings(IEnumerable<List<string>> lists)
{
   foreach (List<string> list in lists)
   foreach (string item in list)
   {
     yield return item;
   }
 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T20:02:12.997

使用 LINQ 表达式...

```
IEnumerable<string> myList = from a in (from b in myBigList
                                        select b)
                             select a; 
```

...工作得很好。:-)

`b`将是一个`IEnumerable<string>`并且`a`将是一个`string`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T20:10:36.863

这是另一个 LINQ 查询理解。

```
IEnumerable<string> myStrings =
  from a in mySource
  from b in a
  select b; 
```

# api - 如何使用 .NET 在 GAL 中创建 Exchange 分发列表？

> ID：150333
> 
> 赞同：2
> 
> 时间：2008-09-29T19:47:26.497
> 
> 标签：api, list, active-directory, exchange-server, gal

我们需要从 Asp.Net 远程创建一个 Exchange 2007 分发列表。

据我所知，在 GAL 中创建分发列表的唯一方法是通过交换管理工具。如果不在我们的网络服务器上安装它，有没有办法远程创建分发列表？有一些第三方组件允许您创建个人分发列表，但这些组件仅存在于用户联系人文件夹中，并非对公司内的所有用户都可用。

理想情况下，会有某种 Web 服务调用来交换或我们可以使用的 API。Exchange SDK 提供了管理 Exchange 数据（例如电子邮件、联系人、日历等）的能力。似乎没有 Exchange 管理 API。

看起来分发列表作为具有特殊 Exchange 属性的组对象存储在 AD 中，但似乎没有任何关于它们应该如何工作的文档。

编辑：我们可以对 Exchange 对 AD 所做的事情进行逆向工程，但我担心的是，随着 Exchange 的下一个服务包，这一切都会中断。

是否有 API 可用于管理 Active Directory 中的通讯组列表而无需通过 Exchange？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T13:32:06.360

我们在启用以编程方式创建的公用文件夹的邮件时遇到了类似的问题，需要在活动目录中的交换系统对象上设置 msExchHideFromAddressLists 属性...

```
using (DirectoryEntry LDAPConnection = new DirectoryEntry("LDAP://OURDOMAIN/CN=" + name+ ",CN=Microsoft Exchange System Objects,DC=ourdomain,DC=com"))
{
    LDAPConnection.AuthenticationType = AuthenticationTypes.Secure;
    LDAPConnection.Properties["msExchHideFromAddressLists"].Value = false;
    LDAPConnection.CommitChanges();
} 
```

PS。确保正确处理任何 DirectoryEntries ，否则您可能会在 GC 启动之前用完连接，最终不得不重新启动服务器以清除它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T19:53:12.800

寻找 LDAP.NET，我手边没有，但我以前做过，当时效果很好。

编辑：我应该补充一点，LDAP 是轻量级目录访问协议。

另外，我找不到 LDAP.NET（我很好奇并去看了），现在看来有一个内置的 System.DirectoryServices 命名空间可以为您完成。

[http://social.msdn.microsoft.com/forums/en-US/netfxbcl/thread/729d1214-37f5-4330-9208-bc4d9d695ad0](http://social.msdn.microsoft.com/forums/en-US/netfxbcl/thread/729d1214-37f5-4330-9208-bc4d9d695ad0)

# visual-studio - 动态创建 RDLC xml 作为 VS2005 Report Viewer 输入的最佳方法？

> ID：150335
> 
> 赞同：3
> 
> 时间：2008-09-29T19:48:19.037
> 
> 标签：visual-studio, reportviewer, rdlc

动态创建 RDLC xml 作为 VS2005 Report Viewer 的输入的最佳方法是什么？

我想根据数据大小自动调整列的大小。我还想以编程方式控制显示哪些列。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T02:52:14.433

[Lisa Nicholls](http://spacefold.com/lisa/)[在这个线程中](http://social.msdn.microsoft.com/Forums/en-US/vsreportcontrols/thread/8cc4f0d5-52b8-482a-bb30-062f91d52626/)给出了关于动态定义报告的完整答案。在获得有用的答案之前，您需要向下滚动一些。该线程最直接地回答了您关于控制显示哪些列的问题。

这些相同的技术可用于以编程方式调整列的大小，但您的代码必须计算出适当的列宽。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-15T22:39:46.887

Dan Smith 也有一个很好的解决方案：[http ://csharpshooter.blogspot.com/2007/08/revised-dynamic-rdlc-generation.html](http://csharpshooter.blogspot.com/2007/08/revised-dynamic-rdlc-generation.html)

Majid 在该博客条目的评论中还对 Dan 的解决方案进行了改进，不需要将任何文件写入文件系统。

# asp.net - 在 ASP.NET 中生成 Excel 文件

> ID：150339
> 
> 赞同：100
> 
> 时间：2008-09-29T19:49:11.407
> 
> 标签：asp.net, vb.net, export-to-excel

我即将向 ASP.NET 应用程序（VB.NET 代码隐藏）添加一个部分，该部分将允许用户将数据作为 Excel 文件返回给他们，我将根据数据库数据生成该文件。虽然有几种方法可以做到这一点，但每种方法都有其自身的缺点。你将如何*返回*数据？我正在寻找尽可能干净和直接的东西。

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-09-29T20:15:47.677

## CSV

优点：

*   简单的

缺点：

*   它可能不适用于其他语言环境或不同的 Excel 配置（即列表分隔符）
*   无法应用格式、公式等

## HTML

优点：

*   还是很简单
*   支持简单的格式和公式

缺点：

*   您必须将文件命名为 xls，Excel 可能会警告您打开非本地 Excel 文件
*   每个工作簿一张工作表

## OpenXML (Office 2007 .XLSX)

优点：

*   本机 Excel 格式
*   支持所有 Excel 功能
*   不需要Excel 的*安装*副本
*   可以生成数据透视表
*   可以使用开源项目[EPPlus生成](http://epplus.codeplex.com/)

缺点：

*   Excel 2007 以外的有限兼容性（现在应该不是问题）
*   除非您使用第三方组件，否则很复杂

## SpreadSheetML（开放格式 XML）

优点：

*   与原生 Excel 格式相比简单
*   支持大多数 Excel 功能：格式、样式、公式、每个工作簿多个工作表
*   无需安装 Excel 即可使用
*   不需要第三方库 - 只需写出您的 xml
*   Excel XP/2003/2007可以打开文档

缺点：

*   缺乏良好的文档
*   旧版本的 Excel（2000 年之前）不支持
*   只写，一旦您打开它并从 Excel 进行更改，它就会转换为原生 Excel。

## XLS（由第三方组件生成）

优点：

*   生成包含所有格式、公式等的原生 Excel 文件。

缺点：

*   花钱
*   添加依赖项

## COM 互操作

优点：

*   使用本机 Microsoft 库
*   阅读对本机文档的支持

缺点：

*   非常慢
*   依赖/版本匹配问题
*   阅读时 Web 使用的并发/数据完整性问题
*   非常慢
*   Web 使用的扩展问题（不同于并发）：需要在服务器上创建许多重型 Excel 应用程序实例
*   需要视窗
*   我有没有提到它很慢？

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-29T19:54:20.833

您可以将数据输出为 html 表格单元格，在其上粘贴一个`.xls`或`.xlsx`扩展名，Excel 将打开它，就好像它是本机文档一样。您甚至可以通过这种方式进行一些有限的格式化和公式计算，因此它比 CSV 强大得多。此外，从像 ASP.Net 这样的 Web 平台输出 html 表格应该很容易；）

如果您需要 Excel 工作簿中的多个工作表或命名工作表，您可以通过名为`SpreadSheetML`. 这**不是**Office 2007 附带的新格式，而是可以追溯到 Excel 2000 的完全不同的格式。解释其工作原理的最简单方法是使用示例：

```
<?xml version="1.0"?>
<?mso-application progid="Excel.Sheet"?> 
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
        xmlns:o="urn:schemas-microsoft-com:office:office"
        xmlns:x="urn:schemas-microsoft-com:office:excel"
        xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
        xmlns:html="http://www.w3.org/TR/REC-html40">
<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office">
      <Author>Your_name_here</Author>
      <LastAuthor>Your_name_here</LastAuthor>
      <Created>20080625</Created>
      <Company>ABC Inc</Company>
      <Version>10.2625</Version>
</DocumentProperties>
<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">
        <WindowHeight>6135</WindowHeight>
        <WindowWidth>8445</WindowWidth>
        <WindowTopX>240</WindowTopX>
        <WindowTopY>120</WindowTopY>
        <ProtectStructure>False</ProtectStructure>
        <ProtectWindows>False</ProtectWindows>
</ExcelWorkbook>

<Styles>
      <Style ss:ID="Default" ss:Name="Normal">
            <Alignment ss:Vertical="Bottom" />
            <Borders />
            <Font />
            <Interior />
            <NumberFormat />
            <Protection />
      </Style>
</Styles>

<Worksheet ss:Name="Sample Sheet 1">
<Table ss:ExpandedColumnCount="2" x:FullColumns="1" x:FullRows="1" ID="Table1">
<Column ss:Width="150" />
<Column ss:Width="200" />
<Row>
      <Cell><Data ss:Type="Number">1</Data></Cell>
      <Cell><Data ss:Type="Number">2</Data></Cell>
</Row>
<Row>
      <Cell><Data ss:Type="Number">3</Data></Cell>
      <Cell><Data ss:Type="Number">4</Data></Cell>
</Row>
<Row>
      <Cell><Data ss:Type="Number">5</Data></Cell>
      <Cell><Data ss:Type="Number">6</Data></Cell>
</Row>
<Row>
      <Cell><Data ss:Type="Number">7</Data></Cell>
      <Cell><Data ss:Type="Number">8</Data></Cell>
</Row>
</Table>
</Worksheet>

<Worksheet ss:Name="Sample Sheet 2">
<Table ss:ExpandedColumnCount="2" x:FullColumns="1" x:FullRows="1" ID="Table2">
<Column ss:Width="150" />
<Column ss:Width="200" />
<Row>
      <Cell><Data ss:Type="String">A</Data></Cell>
      <Cell><Data ss:Type="String">B</Data></Cell>
</Row>
<Row>
      <Cell><Data ss:Type="String">C</Data></Cell>
      <Cell><Data ss:Type="String">D</Data></Cell>
</Row>
<Row>
      <Cell><Data ss:Type="String">E</Data></Cell>
      <Cell><Data ss:Type="String">F</Data></Cell>
</Row>
<Row>
      <Cell><Data ss:Type="String">G</Data></Cell>
      <Cell><Data ss:Type="String">H</Data></Cell>
</Row>
</Table>
</Worksheet>
</Workbook> 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-29T19:53:33.113

如果来自**DataTable**：

```
public static void DataTabletoXLS(DataTable DT, string fileName)
{
    HttpContext.Current.Response.Clear();
    HttpContext.Current.Response.Charset = "utf-16";
    HttpContext.Current.Response.ContentEncoding = System.Text.Encoding.GetEncoding("windows-1250");
    HttpContext.Current.Response.AddHeader("content-disposition", string.Format("attachment; filename={0}.xls", fileName));
    HttpContext.Current.Response.ContentType = "application/ms-excel";

    string tab = "";
    foreach (DataColumn dc in DT.Columns)
    {
        HttpContext.Current.Response.Write(tab + dc.ColumnName.Replace("\n", "").Replace("\t", ""));
        tab = "\t";
    }
    HttpContext.Current.Response.Write("\n");

    int i;
    foreach (DataRow dr in DT.Rows)
    {
        tab = "";
        for (i = 0; i < DT.Columns.Count; i++)
        {
            HttpContext.Current.Response.Write(tab + dr[i].ToString().Replace("\n", "").Replace("\t", ""));
            tab = "\t";
        }
        HttpContext.Current.Response.Write("\n");
    }
    HttpContext.Current.Response.End();
} 
```

从**Gridview**：

```
public static void GridviewtoXLS(GridView gv, string fileName)
{
    int DirtyBit = 0;
    int PageSize = 0;
    if (gv.AllowPaging == true)
    {
        DirtyBit = 1;
        PageSize = gv.PageSize;
        gv.AllowPaging = false;
        gv.DataBind();
    }

    HttpContext.Current.Response.Clear();
    HttpContext.Current.Response.Charset = "utf-8";
    HttpContext.Current.Response.ContentEncoding = System.Text.Encoding.GetEncoding("windows-1250");
    HttpContext.Current.Response.AddHeader(
        "content-disposition", string.Format("attachment; filename={0}.xls", fileName));
    HttpContext.Current.Response.ContentType = "application/ms-excel";

    using (StringWriter sw = new StringWriter())
    using (HtmlTextWriter htw = new HtmlTextWriter(sw))
    {
        //  Create a table to contain the grid
        Table table = new Table();

        //  include the gridline settings
        table.GridLines = gv.GridLines;

        //  add the header row to the table
        if (gv.HeaderRow != null)
        {
            Utilities.Export.PrepareControlForExport(gv.HeaderRow);
            table.Rows.Add(gv.HeaderRow);
        }

        //  add each of the data rows to the table
        foreach (GridViewRow row in gv.Rows)
        {
            Utilities.Export.PrepareControlForExport(row);
            table.Rows.Add(row);
        }

        //  add the footer row to the table
        if (gv.FooterRow != null)
        {
            Utilities.Export.PrepareControlForExport(gv.FooterRow);
            table.Rows.Add(gv.FooterRow);
        }

        //  render the table into the htmlwriter
        table.RenderControl(htw);

        //  render the htmlwriter into the response
        HttpContext.Current.Response.Write(sw.ToString().Replace("£", ""));
        HttpContext.Current.Response.End();
    }

    if (DirtyBit == 1)
    {
        gv.PageSize = PageSize;
        gv.AllowPaging = true;
        gv.DataBind();
    }
}

private static void PrepareControlForExport(Control control)
{
    for (int i = 0; i < control.Controls.Count; i++)
    {
        Control current = control.Controls[i];
        if (current is LinkButton)
        {
            control.Controls.Remove(current);
            control.Controls.AddAt(i, new LiteralControl((current as LinkButton).Text));
        }
        else if (current is ImageButton)
        {
            control.Controls.Remove(current);
            control.Controls.AddAt(i, new LiteralControl((current as ImageButton).AlternateText));
        }
        else if (current is HyperLink)
        {
            control.Controls.Remove(current);
            control.Controls.AddAt(i, new LiteralControl((current as HyperLink).Text));
        }
        else if (current is DropDownList)
        {
            control.Controls.Remove(current);
            control.Controls.AddAt(i, new LiteralControl((current as DropDownList).SelectedItem.Text));
        }
        else if (current is CheckBox)
        {
            control.Controls.Remove(current);
            control.Controls.AddAt(i, new LiteralControl((current as CheckBox).Checked ? "True" : "False"));
        }

        if (current.HasControls())
        {
            Utilities.Export.PrepareControlForExport(current);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-30T15:42:34.360

这是一个围绕 SpreadML 的免费包装器——效果很好。

[http://www.carlosag.net/Tools/ExcelXmlWriter/](http://www.carlosag.net/Tools/ExcelXmlWriter/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-30T14:47:59.127

根据给出的答案以及与同事的协商，似乎最好的解决方案是生成 XML 文件或 HTML 表并将其作为附件推送。我的同事建议的一个改变是数据（即 HTML 表）可以直接写入 Response 对象，从而无需写出文件，因为权限问题，I/O 可能会很麻烦争用，并确保发生预定的清除。

这是代码片段......我还没有检查过这个，我还没有提供所有被调用的代码，但我认为它很好地代表了这个想法。

```
 Dim uiTable As HtmlTable = GetUiTable(groupedSumData)

    Response.Clear()

    Response.ContentType = "application/vnd.ms-excel"
    Response.AddHeader("Content-Disposition", String.Format("inline; filename=OSSummery{0:ddmmssf}.xls", DateTime.Now))

    Dim writer As New System.IO.StringWriter()
    Dim htmlWriter As New HtmlTextWriter(writer)
    uiTable.RenderControl(htmlWriter)
    Response.Write(writer.ToString)

    Response.End() 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-29T19:54:59.957

由于 Excel 理解 HTML，您可以将数据作为 HTML 表写入扩展名为 .xls 的临时文件，获取文件的 FileInfo，然后使用

```
Response.Clear();
Response.AddHeader("Content-Disposition", "attachment; filename=" + fi.Name);
Response.AddHeader("Content-Length", fi.Length.ToString());
Response.ContentType = "application/octet-stream";
Response.WriteFile(fi.FullName);
Response.End(); 
```

如果你想避免临时文件，你可以写入内存流并将字节写回而不是使用 WriteFile

如果省略了 content-length 标头，您可以直接写回 html，但这可能无法在所有浏览器中始终正常工作

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T19:57:53.007

我个人更喜欢 XML 方法。我将从数据集中的数据库中返回数据，将其保存到 XMl，然后创建一个 xslt 文件，其中包含一个转换规则，该规则将格式化一个正确的文档，一个简单的 XML 转换将完成这项工作。最好的部分是您可以格式化单元格、进行条件格式化、设置页眉和页脚，甚至设置打印范围。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T19:51:40.090

我已经这样做了几次，每次最简单的方法就是简单地返回一个 CSV（逗号分隔值）文件。Excel 可以完美导入，而且速度相对较快。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T15:39:37.317

我们一直将数据从数据网格导出到 Excel。将其转换为 HTML，然后写入 excel 文件

```
Response.ContentType = "application/vnd.ms-excel"
    Response.Charset = ""
    Response.AddHeader("content-disposition", "fileattachment;filename=YOURFILENAME.xls")
    Me.EnableViewState = False
    Dim sw As System.IO.StringWriter = New System.IO.StringWriter
    Dim hw As HtmlTextWriter = New HtmlTextWriter(sw)
    ClearControls(grid)
    grid.RenderControl(hw)
    Response.Write(sw.ToString())
    Response.End() 
```

这种方法的唯一问题是我们的很多网格中都有按钮或链接，所以你也需要这个：

```
'needed to export grid to excel to remove link button control and represent as text
Private Sub ClearControls(ByVal control As Control)
    Dim i As Integer
    For i = control.Controls.Count - 1 To 0 Step -1
        ClearControls(control.Controls(i))
    Next i

    If TypeOf control Is System.Web.UI.WebControls.Image Then
        control.Parent.Controls.Remove(control)
    End If

    If (Not TypeOf control Is TableCell) Then
        If Not (control.GetType().GetProperty("SelectedItem") Is Nothing) Then
            Dim literal As New LiteralControl
            control.Parent.Controls.Add(literal)
            Try
                literal.Text = CStr(control.GetType().GetProperty("SelectedItem").GetValue(control, Nothing))
            Catch
            End Try
            control.Parent.Controls.Remove(control)
        Else
            If Not (control.GetType().GetProperty("Text") Is Nothing) Then
                Dim literal As New LiteralControl
                control.Parent.Controls.Add(literal)
                literal.Text = CStr(control.GetType().GetProperty("Text").GetValue(control, Nothing))
                control.Parent.Controls.Remove(control)
            End If
        End If
    End If
    Return
End Sub 
```

我在某个地方发现了它，它运作良好。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-17T21:13:06.087

这是从存储过程中提取的报告。结果导出到 Excel。它使用 ADO 而不是 ADO.NET，原因是这一行

```
oSheet.Cells(2, 1).copyfromrecordset(rst1) 
```

它完成了大部分工作，但在 ado.net 中不可用。

```
‘Calls stored proc in SQL Server 2000 and puts data in Excel and ‘formats it

Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        Dim cnn As ADODB.Connection
        cnn = New ADODB.Connection
        cnn.Open("Provider=SQLOLEDB;data source=xxxxxxx;" & _
          "database=xxxxxxxx;Trusted_Connection=yes;")

        Dim cmd As New ADODB.Command

        cmd.ActiveConnection = cnn

        cmd.CommandText = "[sp_TomTepley]"
        cmd.CommandType = ADODB.CommandTypeEnum.adCmdStoredProc
        cmd.CommandTimeout = 0
        cmd.Parameters.Refresh()

        Dim rst1 As ADODB.Recordset
        rst1 = New ADODB.Recordset
        rst1.Open(cmd)

        Dim oXL As New Excel.Application
        Dim oWB As Excel.Workbook
        Dim oSheet As Excel.Worksheet

        'oXL = CreateObject("excel.application")
        oXL.Visible = True
        oWB = oXL.Workbooks.Add
        oSheet = oWB.ActiveSheet

        Dim Column As Integer
        Column = 1

        Dim fld As ADODB.Field
        For Each fld In rst1.Fields

            oXL.Workbooks(1).Worksheets(1).Cells(1, Column).Value = fld.Name
            oXL.Workbooks(1).Worksheets(1).cells(1, Column).Interior.ColorIndex = 15
            Column = Column + 1

        Next fld

        oXL.Workbooks(1).Worksheets(1).name = "Tom Tepley Report"
        oSheet.Cells(2, 1).copyfromrecordset(rst1)
        oXL.Workbooks(1).Worksheets(1).Cells.EntireColumn.AutoFit()

        oXL.Visible = True
        oXL.UserControl = True

        rst1 = Nothing

        cnn.Close()
        Beep()

    End Sub 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-05-09T01:42:38.347

我推荐基于 OpenXML 的[免费开源 excel 生成库](http://closedxml.codeplex.com/)

几个月前它帮助了我。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-29T19:55:22.187

如果你用数据填充 GridView，你可以使用这个函数来获取 HTML 格式的数据，但表明浏览器它是一个 excel 文件。

```
 Public Sub ExportToExcel(ByVal fileName As String, ByVal gv As GridView)

        HttpContext.Current.Response.Clear()
        HttpContext.Current.Response.AddHeader("content-disposition", String.Format("attachment; filename={0}", fileName))
        HttpContext.Current.Response.ContentType = "application/ms-excel"

        Dim sw As StringWriter = New StringWriter
        Dim htw As HtmlTextWriter = New HtmlTextWriter(sw)
        Dim table As Table = New Table

        table.GridLines = gv.GridLines

        If (Not (gv.HeaderRow) Is Nothing) Then
            PrepareControlForExport(gv.HeaderRow)
            table.Rows.Add(gv.HeaderRow)
        End If

        For Each row As GridViewRow In gv.Rows
            PrepareControlForExport(row)
            table.Rows.Add(row)
        Next

        If (Not (gv.FooterRow) Is Nothing) Then
            PrepareControlForExport(gv.FooterRow)
            table.Rows.Add(gv.FooterRow)
        End If

        table.RenderControl(htw)

        HttpContext.Current.Response.Write(sw.ToString)
        HttpContext.Current.Response.End()

    End Sub

    Private Sub PrepareControlForExport(ByVal control As Control)

        Dim i As Integer = 0

        Do While (i < control.Controls.Count)

            Dim current As Control = control.Controls(i)

            If (TypeOf current Is LinkButton) Then
                control.Controls.Remove(current)
                control.Controls.AddAt(i, New LiteralControl(CType(current, LinkButton).Text))

            ElseIf (TypeOf current Is ImageButton) Then
                control.Controls.Remove(current)
                control.Controls.AddAt(i, New LiteralControl(CType(current, ImageButton).AlternateText))

            ElseIf (TypeOf current Is HyperLink) Then
                control.Controls.Remove(current)
                control.Controls.AddAt(i, New LiteralControl(CType(current, HyperLink).Text))

            ElseIf (TypeOf current Is DropDownList) Then
                control.Controls.Remove(current)
                control.Controls.AddAt(i, New LiteralControl(CType(current, DropDownList).SelectedItem.Text))

            ElseIf (TypeOf current Is CheckBox) Then
                control.Controls.Remove(current)
                control.Controls.AddAt(i, New LiteralControl(CType(current, CheckBox).Checked))

            End If

            If current.HasControls Then
                PrepareControlForExport(current)
            End If

            i = i + 1

        Loop

    End Sub 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T20:37:55.610

只需通过 Microsoft.Office.Interop 命名空间避免 COM 互操作。它是如此的缓慢、不可靠和不可扩展。不适用于受虐狂。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-06-16T21:54:50.130

您可以使用此库创建格式良好的 Excel 文件，非常容易： http: [//officehelper.codeplex.com/documentation](http://officehelper.codeplex.com/documentation)。

无需在网络服务器上安装 Microsoft Office！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-29T19:50:52.353

我会根据数据创建一个 CSV 文件，因为我认为这是最干净的，而且 Excel 对它有很好的支持。但如果您需要更灵活的格式，我相信有一些第三方工具可以生成真正的 excel 文件。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-29T19:50:57.657

CSV 是最简单的方法。大多数情况下，它链接到 Excel。否则，您必须使用自动化 API 或 XML 格式。API 和 XML 并不难使用。

[有关为 Excel 生成 XML 的信息](http://blogs.msdn.com/brian_jones/archive/2005/06/27/433152.aspx)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-29T19:55:46.680

我要么走 CSV 路线（如上所述），要么这些天更频繁地使用 Infragistics NetAdvantage 来生成文件。（在 Infragistics 发挥作用的绝大多数时间里，我们只是导出现有的 UltraWebGrid，它本质上是一个单行解决方案，除非需要额外的格式调整。我们也可以手动生成 Excel/BIFF 文件，但很少需要这样做。）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-29T19:55:53.573

伙计，在 .net 中，我想您可以拥有一个可以做到这一点的组件，但在经典的 asp 中，我已经创建了一个 html 表并将页面的 mime 提示更改为 vnd/msexcel。我想如果您使用 gridview 并更改 mime 类型也许它应该工作，因为 gridview 是一个 html 表。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-29T19:56:06.460

避免“看起来这些数字存储为文本”绿色三角形的唯一防弹方法是使用 Open XML 格式。值得使用它，只是为了避免不可避免的绿色三角形。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-29T19:57:01.137

我见过的 Excel 报告的最佳方法是用 XML 扩展名写出 XML 中的数据，并将其以正确的内容类型流式传输到客户端。(应用程序/xls)

这适用于任何需要基本格式的报告，并允许您使用文本比较工具与现有电子表格进行比较。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-30T14:59:38.163

假设这是一个 Intranet，您可以在其中设置权限并授权 IE，您可以使用[JScript/VBScript 驱动 Excel](http://www.codepedia.com/1/ASPFAQ_Open_Excel_Application_Client_Side)生成工作簿客户端。这为您提供了本机 Excel 格式，而无需尝试在服务器上自动化 Excel。

我不确定我是否真的会再推荐这种方法，除非在相当小众的情况下，但它在经典的 ASP 鼎盛时期相当普遍。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-30T15:18:56.960

您当然可以随时选择第三方组件。就个人而言，我对 Spire.XLS 有很好的体验[http://www.e-iceblue.com/xls/xlsintro.htm](http://www.e-iceblue.com/xls/xlsintro.htm)

该组件在您的应用程序中非常易于使用：

```
 Workbook workbook = new Workbook();

        //Load workbook from disk.
        workbook.LoadFromFile(@"Data\EditSheetSample.xls");
        //Initailize worksheet
        Worksheet sheet = workbook.Worksheets[0];

        //Writes string
        sheet.Range["B1"].Text = "Hello,World!";
        //Writes number
        sheet.Range["B2"].NumberValue = 1234.5678;
        //Writes date
        sheet.Range["B3"].DateTimeValue = System.DateTime.Now;
        //Writes formula
        sheet.Range["B4"].Formula = "=1111*11111";

        workbook.SaveToFile("Sample.xls"); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-03T00:25:57.660

[我使用上面建议的与此答案](https://stackoverflow.com/questions/150339/generating-an-excel-file-in-aspnet#153384 "通过响应推送 Excel 内容")相似的解决方案之一遇到的问题之一是，如果您将内容作为附件推出（我发现这是非 ms 浏览器最干净的解决方案） ，然后在 Excel 2000-2003 中打开它，它的类型是“Excel 网页”而不是原生 Excel 文档。

然后您必须向用户解释如何使用 Excel 中的“另存为类型”将其转换为 Excel 文档。如果用户需要编辑此文档然后将其重新上传到您的站点，这会很痛苦。

我的建议是使用 CSV。这很简单，如果用户确实从 Excel 中打开它，Excel 至少会提示他们以本机格式保存它。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-08-14T01:12:40.873

这是将数据表作为 CSV 流式传输的解决方案。快速、干净、简单，它可以处理输入中的逗号。

```
public static void ExportToExcel(DataTable data, HttpResponse response, string fileName)
{
    response.Charset = "utf-8";
    response.ContentEncoding = System.Text.Encoding.GetEncoding("windows-1250");
    response.Cache.SetCacheability(HttpCacheability.NoCache);
    response.ContentType = "text/csv";
    response.AddHeader("Content-Disposition", "attachment; filename=" + fileName);

    for (int i = 0; i < data.Columns.Count; i++)
    {
       response.Write(data.Columns[i].ColumnName);
       response.Write(i == data.Columns.Count - 1 ? "\n" : ",");
    }        
    foreach (DataRow row in data.Rows)
    {
        for (int i = 0; i < data.Columns.Count; i++)
        {
            response.Write(String.Format("\"{0}\"", row[i].ToString()));
            response.Write(i == data.Columns.Count - 1 ? "\n" : ",");
        }
    }

    response.End();
} 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2013-05-31T04:14:21.363

刚刚创建了一个从 Web 表单 C# 导出到 excel 的函数希望它对其他人有帮助

```
 public void ExportFileFromSPData(string filename, DataTable dt)
    {
        HttpResponse response = HttpContext.Current.Response;

        //clean up the response.object
        response.Clear();
        response.Buffer = true;
        response.Charset = "";

        // set the response mime type for html so you can see what are you printing 
        //response.ContentType = "text/html";
        //response.AddHeader("Content-Disposition", "attachment;filename=test.html");

        // set the response mime type for excel
        response.ContentType = "application/vnd.ms-excel";
        response.AddHeader("Content-Disposition", "attachment;filename=\"" + filename + "\"");
        response.ContentEncoding = System.Text.Encoding.UTF8;
        response.BinaryWrite(System.Text.Encoding.UTF8.GetPreamble());

        //style to format numbers to string
        string style = @"<style> .text { mso-number-format:\@; } </style>";
        response.Write(style);

        // create a string writer
        using (StringWriter sw = new StringWriter())
        {
            using (HtmlTextWriter htw = new HtmlTextWriter(sw))
            {
                // instantiate a datagrid
                GridView dg = new GridView();
                dg.DataSource = dt;
                dg.DataBind();

                foreach (GridViewRow datarow in dg.Rows)
                {
                    //format specific cell to be text 
                    //to avoid 1.232323+E29 to get 1232312312312312124124
                    datarow.Cells[0].Attributes.Add("class", "text");
                }

                dg.RenderControl(htw);
                response.Write(sw.ToString());
                response.End();
            }
        }
     } 
```

* * *

## 回答 #26

> 赞同：-6
> 
> 时间：2008-09-29T19:55:45.073

如果您必须使用 Excel 而不是 CSV 文件，则需要在服务器之一的 Excel 实例上使用 OLE 自动化。最简单的方法是创建一个模板文件并以编程方式将数据填入其中。您将其保存到另一个文件。

尖端：

*   不要以交互方式进行。让用户启动该过程，然后发布带有文件链接的页面。这可以在生成电子表格时缓解潜在的性能问题。
*   使用我之前描述的模板。它使修改它变得更容易。
*   确保 Excel 设置为不弹出对话框。在 Web 服务器上，这将挂起整个 excel 实例。
*   将 Excel 实例保存在单独的服务器上，最好放在防火墙后面，这样它就不会暴露为潜在的安全漏洞。
*   密切关注资源使用情况。在 OLE 自动化接口上生成一个电子表格（PIA 只是对此进行填充）是一个相当重量级的过程。如果您需要将其扩展到高数据量，您可能需要对您的架构有所了解。

如果您不介意文件的格式有点基本，那么一些“使用 mime 类型来欺骗 excel 打开 HTML 表格”的方法会起作用。这些方法还将 CPU 的繁重工作转移到客户端。如果您想对电子表格的格式进行精细控制，您可能必须使用 Excel 本身来生成上述文件。

# c# - TDD 和模拟 TcpClient

> ID：150341
> 
> 赞同：10
> 
> 时间：2008-09-29T19:49:40.097
> 
> 标签：c#, networking, tdd, mocking

人们如何模拟 TcpClient（或 TcpClient 之类的东西）？

我有一个接受 TcpClient 的服务。我应该用其他更可笑的东西来包装它吗？我应该如何处理这个？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-29T20:23:38.720

当遇到对测试不友好的模拟类（即密封/未实现任何接口/方法不是虚拟的）时，您可能希望使用[适配器](http://en.wikipedia.org/wiki/Adapter_pattern)设计模式。

在此模式中，您添加一个实现接口的包装类。然后，您应该模拟该接口，并确保您的所有代码都使用该接口而不是不友好的具体类。它看起来像这样：

```
public interface ITcpClient
{
   Stream GetStream(); 
   // Anything you need here       
}
public class TcpClientAdapter: ITcpClient
{
   private TcpClient wrappedClient;
   public TcpClientAdapter(TcpClient client)
   {
    wrappedClient = client;
   }

   public Stream GetStream()
   {
     return wrappedClient.GetStream();
   }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T20:50:52.240

我认为@Hitchhiker 是在正确的轨道上，但我也想考虑进一步抽象出类似的东西。

我不会直接模拟 TcpClient，因为即使您已经编写了测试，这仍然会使您与底层实现过于紧密地联系在一起。也就是说，您的实现专门与 TcpClient 方法相关联。就个人而言，我会尝试这样的事情：

```
 [Test]
    public void TestInput(){

       NetworkInputSource mockInput = mocks.CreateMock<NetworkInputSource>();
       Consumer c = new Consumer(mockInput);

       c.ReadAll();
    //   c.Read();
    //   c.ReadLine();

    }

    public class TcpClientAdapter : NetworkInputSource
    {
       private TcpClient _client;
       public string ReadAll()
       { 
           return new StreamReader(_tcpClient.GetStream()).ReadToEnd();
       }

       public string Read() { ... }
       public string ReadLine() { ... }
    }

    public interface NetworkInputSource
    {
       public string ReadAll(); 
       public string Read();
       public string ReadLine();
    } 
```

这个实现将把你与 Tcp 相关的细节完全分离（如果这是一个设计目标），你甚至可以从一组硬编码的值或测试输入文件中输入测试输入。如果您正在长期测试您的代码，这将非常有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T20:46:12.003

使用适配器模式绝对是解决问题的标准 TDD 方法。但是，您也可以只创建 TCP 连接的另一端并让您的测试工具驱动它。

IMO 适配器类的广泛使用混淆了设计中最重要的部分，并且还倾向于从测试中删除许多真正应该在上下文中测试的东西。因此，另一种选择是建立您的测试脚手架以包含更多被测系统。如果您从头开始构建测试，您仍然可以获得将失败原因隔离到给定类或函数的能力，它只是不会被隔离......

# c++ - 以编程方式查找机器上的内核数

> ID：150355
> 
> 赞同：528
> 
> 时间：2008-09-29T19:51:45.580
> 
> 标签：c++, c, multithreading, multiplatform

有没有办法以独立于平台的方式从 C/C++ 中确定一台机器有多少个内核？如果不存在这样的东西，那么如何确定每个平台（Windows/*nix/Mac）呢？

* * *

## 回答 #1

> 赞同：796
> 
> 时间：2008-09-29T22:14:07.143

# C++11

```
#include <thread>

//may return 0 when not able to detect
const auto processor_count = std::thread::hardware_concurrency(); 
```

参考：[std::thread::hardware_concurrency](http://en.cppreference.com/w/cpp/thread/thread/hardware_concurrency)

* * *

在 C++11 之前的 C++ 中，没有可移植的方式。相反，您需要使用以下一种或多种方法（由适当的`#ifdef`行保护）：

*   ### Win32

    ```
    SYSTEM_INFO sysinfo;
    GetSystemInfo(&sysinfo);
    int numCPU = sysinfo.dwNumberOfProcessors; 
    ```

*   ### Linux、Solaris、AIX 和 Mac OS X >=10.4（即 Tiger 以后）

    ```
    int numCPU = sysconf(_SC_NPROCESSORS_ONLN); 
    ```

*   ### FreeBSD、MacOS X、NetBSD、OpenBSD 等。

    ```
    int mib[4];
    int numCPU;
    std::size_t len = sizeof(numCPU); 

    /* set the mib for hw.ncpu */
    mib[0] = CTL_HW;
    mib[1] = HW_AVAILCPU;  // alternatively, try HW_NCPU;

    /* get the number of CPUs from the system */
    sysctl(mib, 2, &numCPU, &len, NULL, 0);

    if (numCPU < 1) 
    {
        mib[1] = HW_NCPU;
        sysctl(mib, 2, &numCPU, &len, NULL, 0);
        if (numCPU < 1)
            numCPU = 1;
    } 
    ```

*   ### HPUX

    ```
    int numCPU = mpctl(MPC_GETNUMSPUS, NULL, NULL); 
    ```

*   ### IRIX

    ```
    int numCPU = sysconf(_SC_NPROC_ONLN); 
    ```

*   ### Objective-C (Mac OS X >=10.5 或 iOS)

    ```
    NSUInteger a = [[NSProcessInfo processInfo] processorCount];
    NSUInteger b = [[NSProcessInfo processInfo] activeProcessorCount]; 
    ```

* * *

## 回答 #2

> 赞同：217
> 
> 时间：2008-09-29T19:58:46.593

此功能是 C++11 标准的一部分。

```
#include <thread>

unsigned int nthreads = std::thread::hardware_concurrency(); 
```

对于较旧的编译器，您可以使用[Boost.Thread](http://www.boost.org/doc/libs/1_46_0/doc/html/thread.html)库。

```
#include <boost/thread.hpp>

unsigned int nthreads = boost::thread::hardware_concurrency(); 
```

无论哪种情况，`hardware_concurrency()`根据 CPU 内核和超线程单元的数量，返回硬件能够同时执行的线程数。

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2008-10-13T10:28:30.553

[许多平台（包括 Visual Studio 2005）都支持OpenMP](http://openmp.org/)，它提供了一个

```
int omp_get_num_procs(); 
```

返回调用时可用的处理器/内核数的函数。

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2008-09-29T20:49:44.913

如果您有汇编语言访问权限，则可以使用 CPUID 指令来获取有关 CPU 的各种信息。它可以在操作系统之间移植，但您需要使用制造商特定的信息来确定如何查找内核数量。这是[一份描述如何在英特尔芯片上执行此操作的文档，](http://www.intel.com/content/www/us/en/processors/processor-identification-cpuid-instruction-note.html)[该](http://support.amd.com/us/Embedded_TechDocs/25481.pdf)文档的第 11 页描述了 AMD 规范。

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2010-06-09T13:48:51.240

（几乎）c代码中的平台无关函数

```
#ifdef _WIN32
#include <windows.h>
#elif MACOS
#include <sys/param.h>
#include <sys/sysctl.h>
#else
#include <unistd.h>
#endif

int getNumCores() {
#ifdef WIN32
    SYSTEM_INFO sysinfo;
    GetSystemInfo(&sysinfo);
    return sysinfo.dwNumberOfProcessors;
#elif MACOS
    int nm[2];
    size_t len = 4;
    uint32_t count;

    nm[0] = CTL_HW; nm[1] = HW_AVAILCPU;
    sysctl(nm, 2, &count, &len, NULL, 0);

    if(count < 1) {
        nm[1] = HW_NCPU;
        sysctl(nm, 2, &count, &len, NULL, 0);
        if(count < 1) { count = 1; }
    }
    return count;
#else
    return sysconf(_SC_NPROCESSORS_ONLN);
#endif
} 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2008-09-29T19:55:25.340

在 Linux 上，您可以读取 /proc/cpuinfo 文件并计算内核数。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-10-12T19:12:17.533

请注意，“核心数”可能不是一个特别有用的数字，您可能需要对其进行更多限定。您想如何计算多线程 CPU，例如 Intel HT、IBM Power5 和 Power6，以及最著名的 Sun 的 Niagara/UltraSparc T1 和 T2？或者更有趣的是，MIPS 1004k 具有两个级别的硬件线程（管理程序和用户级）......更不用说当您进入支持虚拟机管理程序的系统时会发生什么，其中硬件可能有数十个 CPU，但您的特定操作系统只看到几个。

您可以期望的最好结果是告诉您在本地操作系统分区中拥有的逻辑处理单元的数量。除非您是虚拟机管理程序，否则忘记查看真正的机器。今天这个规则的唯一例外是在 x86 领域，但非虚拟机的终结即将到来......

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-13T15:09:15.887

另一个 Windows 秘诀：使用系统范围的环境变量`NUMBER_OF_PROCESSORS`：

```
printf("%d\n", atoi(getenv("NUMBER_OF_PROCESSORS"))); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-29T19:55:28.770

您可能无法以独立于平台的方式获得它。Windows 你得到处理器的数量。

[Win32系统信息](http://msdn.microsoft.com/en-us/library/ms724381(VS.85).aspx)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2017-05-29T16:48:41.343

## Windows（x64 和 Win32）和 C++11

**共享单个处理器内核的逻辑处理器组的数量。**（使用[GetLogicalProcessorInformationEx](https://msdn.microsoft.com/en-us/library/windows/desktop/dd405488(v=vs.85).aspx)，请参阅[GetLogicalProcessorInformation](https://msdn.microsoft.com/en-us/library/windows/desktop/ms683194(v=vs.85).aspx)以及）

```
size_t NumberOfPhysicalCores() noexcept {

    DWORD length = 0;
    const BOOL result_first = GetLogicalProcessorInformationEx(RelationProcessorCore, nullptr, &length);
    assert(GetLastError() == ERROR_INSUFFICIENT_BUFFER);

    std::unique_ptr< uint8_t[] > buffer(new uint8_t[length]);
    const PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX info = 
            reinterpret_cast< PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX >(buffer.get());

    const BOOL result_second = GetLogicalProcessorInformationEx(RelationProcessorCore, info, &length);
    assert(result_second != FALSE);

    size_t nb_physical_cores = 0;
    size_t offset = 0;
    do {
        const PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX current_info =
            reinterpret_cast< PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX >(buffer.get() + offset);
        offset += current_info->Size;
        ++nb_physical_cores;
    } while (offset < length);

    return nb_physical_cores;
} 
```

*请注意，`NumberOfPhysicalCores`恕我直言，实现远非微不足道（即“使用`GetLogicalProcessorInformation`或`GetLogicalProcessorInformationEx`”）。相反，如果阅读MSDN上的文档（显式存在`GetLogicalProcessorInformation`和隐式存在），则相当微妙。`GetLogicalProcessorInformationEx`*

**逻辑处理器的数量。**（使用[GetSystemInfo](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724381(v=vs.85).aspx)）

```
size_t NumberOfSystemCores() noexcept {
    SYSTEM_INFO system_info;
    ZeroMemory(&system_info, sizeof(system_info));

    GetSystemInfo(&system_info);

    return static_cast< size_t >(system_info.dwNumberOfProcessors);
} 
```

*请注意，这两种方法都可以轻松转换为 C/C++98/C++03。*

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-03-21T19:05:24.383

与 C++ 无关，但在 Linux 上我通常这样做：

```
grep processor /proc/cpuinfo | wc -l 
```

对于像 bash/perl/python/ruby 这样的脚本语言很方便。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2012-09-02T20:13:00.977

有关 OS X 的更多信息：`sysconf(_SC_NPROCESSORS_ONLN)`仅适用于 >= 10.5 的版本，而不是 10.4。

另一种选择是在`HW_AVAILCPU/sysctl()`>= 10.2 版本上可用的 BSD 代码。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-29T19:54:54.903

Windows Server 2003 及更高版本允许您利用 GetLogicalProcessorInformation 函数

[http://msdn.microsoft.com/en-us/library/ms683194.aspx](http://msdn.microsoft.com/en-us/library/ms683194.aspx)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-29T19:58:52.787

据我所知，在 linux 上最好的编程方式是使用

```
sysconf(_SC_NPROCESSORS_CONF) 
```

或者

```
sysconf(_SC_NPROCESSORS_ONLN) 
```

这些不是标准的，但在我的 Linux 手册页中。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-07-19T19:11:16.950

hwloc (http://www.open-mpi.org/projects/hwloc/) 值得一看。虽然需要将另一个库集成到您的代码中，但它可以提供有关您的处理器的所有信息（内核数量、拓扑结构等）

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-06-09T19:53:38.103

在 Linux 上，使用它可能不安全，`_SC_NPROCESSORS_ONLN`因为它不是 POSIX 标准的一部分，而且[sysconf](http://man7.org/linux/man-pages/man3/sysconf.3.html)手册也有同样的规定。所以有一种`_SC_NPROCESSORS_ONLN`可能不存在：

```
 These values also exist, but may not be standard.

     [...]     

     - _SC_NPROCESSORS_CONF
              The number of processors configured.   
     - _SC_NPROCESSORS_ONLN
              The number of processors currently online (available). 
```

一个简单的方法是阅读`/proc/stat`或`/proc/cpuinfo`计算它们：

```
#include<unistd.h>
#include<stdio.h>

int main(void)
{
char str[256];
int procCount = -1; // to offset for the first entry
FILE *fp;

if( (fp = fopen("/proc/stat", "r")) )
{
  while(fgets(str, sizeof str, fp))
  if( !memcmp(str, "cpu", 3) ) procCount++;
}

if ( procCount == -1) 
{ 
printf("Unable to get proc count. Defaulting to 2");
procCount=2;
}

printf("Proc Count:%d\n", procCount);
return 0;
} 
```

使用`/proc/cpuinfo`：

```
#include<unistd.h>
#include<stdio.h>

int main(void)
{
char str[256];
int procCount = 0;
FILE *fp;

if( (fp = fopen("/proc/cpuinfo", "r")) )
{
  while(fgets(str, sizeof str, fp))
  if( !memcmp(str, "processor", 9) ) procCount++;
}

if ( !procCount ) 
{ 
printf("Unable to get proc count. Defaulting to 2");
procCount=2;
}

printf("Proc Count:%d\n", procCount);
return 0;
} 
```

* * *

在 shell 中使用 grep 的相同方法：

```
grep -c ^processor /proc/cpuinfo 
```

或者

```
grep -c ^cpu /proc/stat # subtract 1 from the result 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-07-12T20:00:28.150

OS X 替代方案：根据文档，前面描述的基于 [[NSProcessInfo processInfo] processorCount] 的解决方案仅在 OS X 10.5.0 上可用。对于早期版本的 OS X，请使用 Carbon 函数 MPProcessors()。

如果您是 Cocoa 程序员，请不要被 Carbon 的事实吓到。您只需要将 Carbon 框架添加到您的 Xcode 项目中，MPProcessors() 就可以使用了。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-06-27T08:51:02.813

对于 Win32：

GetSystemInfo() 获取*逻辑*处理器的数量，使用 [GetLogicalProcessorInformationEx()](https://msdn.microsoft.com/en-us/library/windows/desktop/dd405488(v=vs.85).aspx) 获取*物理*处理器的数量。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2021-09-16T19:39:47.790

```
#include <stdint.h>

#if defined(__APPLE__) || defined(__FreeBSD__)
#include <sys/sysctl.h>

uint32_t num_physical_cores(void)
{
    uint32_t num_cores      = 0;
    size_t num_cores_len    = sizeof(num_cores);

    sysctlbyname("hw.physicalcpu", &num_cores, &num_cores_len, 0, 0);

    return num_cores;
}
#elif defined(__linux__)
#include <unistd.h>
#include <stdio.h>
uint32_t num_physical_cores(void)
{
    uint32_t lcores = 0, tsibs = 0;

    char buff[32];
    char path[64];

    for (lcores = 0;;lcores++) {
        FILE *cpu;

        snprintf(path, sizeof(path), "/sys/devices/system/cpu/cpu%u/topology/thread_siblings_list", lcores);

        cpu = fopen(path, "r");
        if (!cpu) break;

        while (fscanf(cpu, "%[0-9]", buff)) {
            tsibs++;
            if (fgetc(cpu) != ',') break;
        }

        fclose(cpu);
    }

    return lcores / (tsibs / lcores);
}
#else
#error Unrecognized operating system
#endif 
```

这应该返回系统上的物理核心数。这与大多数答案提供的逻辑核心数量不同。如果您正在寻找不执行阻塞 I/O 并且不休眠的线程池的大小，那么您希望使用物理内核的数量，而不是逻辑（超线程）内核的数量。

此答案仅提供 Linux 和 BSD 的实现。

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-12-21T19:02:21.620

您也可以在 .net 中使用 WMI，但是您依赖于运行的 wmi 服务等。有时它可以在本地工作，但是当在服务器上运行相同的代码时会失败。我相信这是一个名称空间问题，与您正在阅读其值的“名称”有关。

# exchange-server - 我在 EWS UpdateItem 中对 ChangeKey 使用什么？

> ID：150359
> 
> 赞同：4
> 
> 时间：2008-09-29T19:52:44.330
> 
> 标签：exchange-server, exchangewebservices

我正在尝试使用 Exchange Web 服务来更新日历项目。我正在创建一个 ItemChangeType，然后是一个 ItemIdType。我有一个唯一的 ID 可用于 ItemIdType.Id，但我没有任何东西可用于 ChangeKey。当我忽略它时，我得到一个 ErrorChangeKeyRequiredForWriteOperations。但是当我尝试在其中放一些东西时，我得到了一个 ErrorInvalidChangeKey。

我可以用什么来让它工作？

我还试图确定用于 ItemChangeType.Item 的 BaseItemIdType 的最佳实现是什么。到目前为止，我使用的是 ItemIdType，我猜这是正确的，但我还没有找到任何特别有用的文档。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T19:51:49.760

对 Hauge 的回答更明确一点：ChangeKey 存储在 Exchange 中并标识项目的当前状态。对该项目的任何更改都会创建一个新的 ChangeKey。

这使 Exchange 能够“知道”您的更新正在应用于与您查看项目时相同的项目状态 - 自您检查以来它没有更改。

一些代码可在： [http://msdn.microsoft.com/en-us/library/aa563020.aspx](http://msdn.microsoft.com/en-us/library/aa563020.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-14T10:11:02.163

如果您有 ItemIdType.Id 属性，您还应该可以访问 Changekey，它也是 ItemIdType 的属性：

`ItemIdType.ChangeKey`

与Id 属性一样，它是一个字符串，因此您可以在抓取Id 时抓取它。

问候杰斯珀豪格

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-17T08:34:46.850

If you know ID only, you can get ChangeKey easily, for example for folder:

```
 private FolderIdType GetFullFolderID(string folderID)
  {
     GetFolderType request = new GetFolderType();
     request.FolderIds = new BaseFolderIdType[1];

     FolderIdType id = new FolderIdType();
     id.Id = folderID;
     request.FolderIds[0] = id;

     request.FolderShape = new FolderResponseShapeType();
     request.FolderShape.BaseShape = DefaultShapeNamesType.IdOnly;

     GetFolderResponseType response = _binding.GetFolder(request);

     FailOnError(response);

     FolderInfoResponseMessageType firmt = (FolderInfoResponseMessageType)response.ResponseMessages.Items[0];
     FolderType ft = (FolderType)firmt.Folders[0];
     id.ChangeKey = ft.FolderId.ChangeKey;

     return id;
  } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-12T10:36:19.110

我建议您使用 Exchange 托管 API 而不是 Exchange Web 服务来使用 Exchange。它更容易使用。您可以在下面找到更多详细信息：

[https://msdn.microsoft.com/en-gb/library/dd877012(v=exchg.150).aspx](https://msdn.microsoft.com/en-gb/library/dd877012(v=exchg.150).aspx)

# python - 如何从 Python 源代码闯入调试器？

> ID：150375
> 
> 赞同：28
> 
> 时间：2008-09-29T19:55:12.593
> 
> 标签：python, debugging, breakpoints, pdb

你在 Python 源代码中插入了什么来让它进入 pdb（当执行到达那个位置时）？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-29T19:55:20.143

```
import pdb; pdb.set_trace() 
```

请参阅[Python: Coding in the Debugger for Beginners](http://jjinux.blogspot.com/2007/08/python-coding-in-debugger-for-beginners.html)了解更多有用的提示。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2019-12-16T23:51:27.433

从 Python 3.7 开始，您可以使用`breakpoint()`- [https://docs.python.org/3/library/functions.html#breakpoint](https://docs.python.org/3/library/functions.html#breakpoint)

# html - 仅在启用 CSS 时存在的文本

> ID：150384
> 
> 赞同：1
> 
> 时间：2008-09-29T19:55:56.493
> 
> 标签：html, css

我有一个网站，我在其中使用隐藏标签和 JavaScript 为某些事情提供工具提示，`<span>`以跟踪各种鼠标事件。它工作得很好。这个网站有点迎合有视力问题的人，所以如果没有 JavaScript 或 CSS，我会尽量让事情降级，通常我会说它在这方面是成功的。

所以我的问题是，这些是否可能`<span>`仅在使用 CSS 时才存在？我考虑过在文档加载时用 JavaScript 写出工具提示。但我想知道是否有更好的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T19:58:35.503

也许您需要重新考虑提供工具提示的方式。内容是否可以包含在语义适当元素的标题属性中？

编辑：如果您提供更多信息，有人可能会提出更多解决方案。工具提示会弹出哪些类型的元素？图片？缩写标签是否合适？

我刚刚想出的快速解决方案：`<span>`可以访问[核心属性](http://www.w3.org/TR/REC-html40/sgml/dtd.html#coreattrs)，其中包括标题，因此您可以在标题中包含工具提示文本，并使用 jQuery 之类的 javascript 库来显示带有标题的所有跨度的工具提示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T19:59:39.620

一个快速的技巧是将文本着色为与 html 中的背景相同的颜色（例如，白底白字），然后使用 CSS 将颜色更改回可见的颜色（白底黑字）。当然，这仅与能够看到文本的人相关。屏幕阅读器等不会将文本视为隐藏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T07:58:00.453

屏幕阅读器也使用 CSS 来帮助定义哪些页面元素被读取或不被读取。屏幕阅读器几乎总是**会忽略应用了***display:none*的元素，因此不使用 CSS 并不是屏幕阅读器存在的有效指标。

我会同意**Chris**的想法，即使用 javascript 基于标题（或 alt）属性生成工具提示。

您可以使用 JS 来确保仅在设置了有效样式时才显示工具提示，因此如果启用 JS 并禁用 CSS，您可以不同地处理额外信息（例如脚注）。

[http://juicystudio.com/article/screen-readers-display-none.php](http://juicystudio.com/article/screen-readers-display-none.php) [http://www.456bereastreet.com/archive/200711/screen_readers_sometimes_ignore_displaynone/](http://www.456bereastreet.com/archive/200711/screen_readers_sometimes_ignore_displaynone/)

# .net - .NET 文件同步库

> ID：150397
> 
> 赞同：5
> 
> 时间：2008-09-29T19:59:51.897
> 
> 标签：.net, synchronization

有没有好的 .NET 文件同步库？它可以非常基本，只需要在本地和映射驱动器上工作（不需要像 rsync 这样的服务器客户端模型）。

是的，我知道有 MS 同步服务，但这比我需要*的要多得多。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T02:32:14.280

还有微软的[Sync Framework](http://msdn.microsoft.com/en-us/sync/default.aspx)。[SyncToy](http://en.wikipedia.org/wiki/SyncToy)实际上是使用同步框架来实现它的功能。以下是一些 API：

*   [微软同步](http://msdn.microsoft.com/en-us/library/microsoft.synchronization.aspx)
*   [Microsoft.Synchronization.Files](http://msdn.microsoft.com/en-us/library/microsoft.synchronization.files.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T20:01:08.320

您可以根据 FileSystemWatcher 组件自己组合一些东西，还是在寻找更完整的东西？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T20:25:24.127

根据以下文章，Microsoft 的 SyncToy 工具安装了一个 API，您可以从代码中调用该 API：

[http://www.codeproject.com/KB/vb/SyncToy_Helper.aspx](http://www.codeproject.com/KB/vb/SyncToy_Helper.aspx)

# c# - Desktop Applications: Architectural Frameworks?

> ID：150403
> 
> 赞同：22
> 
> 时间：2008-09-29T20:02:35.947
> 
> 标签：c#, java, architecture, frameworks

I'm wondering if there are any architectural frameworks out there to create desktop or standalone applications, in Java or C# for instance. It seems that there are tons of them available for web applications but I can't find many good resources on frameworks or architectural best-practices for desktop development.

Ideally I would like to know if there is any source code available of desktop applications that would be considered to have a good architecture or are built with a certain framework.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T20:36:25.817

While not directly related to desktop applications if you are looking for decent source code for well written projects I asked a similar question:

[Open source C# projects that have extremely high code quality to learn from.](https://stackoverflow.com/questions/143088/open-source-c-projects-that-have-extremely-high-code-quality-to-learn-from)

People gave some pretty good suggestions there:

> *   Scott Hanselman's [The Weekly Source Code](http://www.hanselman.com/blog/CategoryView.aspx?category=Source+Code) series (usually managed C#)
> *   Code written by [Microsoft Patterns & Practices](http://msdn.microsoft.com/en-us/practices/default.aspx) team.
> *   [SharpDevelop](http://www.codeplex.com/SharpDevelop) (written in C#)
> *   [Mono](http://www.go-mono.com/mono-downloads/download.html/) (most of the framework in C#)
> *   [Paint.Net](http://paint.net) (written in C#)
> *   [NHibernate](http://www.hibernate.org/428.html) (written in C#)
> *   [The Castle Project](http://www.castleproject.org/) (written in C#)
> *   [xUnit](http://www.codeplex.com/xunit) (written in C#)
> *   [.Net Framework Source Code](http://referencesource.microsoft.com/netframework.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T20:25:39.417

There's a new [.NET architectural guidance package from Microsoft patterns & practices for WPF that is code named "Prism"](http://www.codeplex.com/CompositeWPF/) -- it's basically a "next generation" Composite UI Application Block (without the SCSF tooling). It uses Dependency injection, Composite pattern throughout, etc.

There is a pretty good [DNRTV](http://www.dnrtv.com/default.aspx?showNum=124) screencast demoing it.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-29T21:45:17.383

In the lightweight app category, JSR 296 for Java (to be in future Java 7 possibly) is a framework handling the basics like resource management and actions. Lots of links here:

*   [http://tech.puredanger.com/java7#jsr296](http://tech.puredanger.com/java7#jsr296)

Scaling up a bit, you could look at various RCP frameworks like:

*   Eclipse RCP: [http://wiki.eclipse.org/index.php/Rich_Client_Platform](http://wiki.eclipse.org/index.php/Rich_Client_Platform)
*   NetBeans Platform: [http://www.netbeans.org/products/platform/](http://www.netbeans.org/products/platform/)
*   Spring RCP: [http://spring-rich-c.sourceforge.net/1.0.0/index.html](http://spring-rich-c.sourceforge.net/1.0.0/index.html)
*   Comparison article: [http://www.infoq.com/news/eclipse-rcp-netbeans-platform](http://www.infoq.com/news/eclipse-rcp-netbeans-platform)

UPDATE: It has been mentioned (by Mark Reinhold at Devoxx '08) that JSR 296 will be included in Java 7.

Further update: JSR 296 is dead. JavaFX is the current direction for client-side Java.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T20:08:33.980

Check Microsoft's [Smart Client Software Factory](http://msdn.microsoft.com/en-us/library/aa480482.aspx). It contains code samples and documentation.

> **Overview**
> 
> This software factory provides proven solutions to common challenges found while building and operating composite smart client applications. It helps architects and developers build modular systems that can be built and deployed by independent teams. Applications built with the software factory use proven practices for operations, such as centralized exception logging.
> 
> The software factory contains a collection of reusable components and libraries, Visual Studio 2008 solution templates, wizards and extensions, How-to topics, automated tests, extensive architecture documentation, patterns, and a reference implementation. The software factory uses Windows Forms, Windows Presentation Foundation, Windows Communication Foundation, and the Enterprise Library 3.1 – May 2007 release. With this release, the Composite UI Application Block is included in the software factory.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T20:19:22.800

In Java, Naked Objects -- [http://nakedobjects.org/home/index.shtml](http://nakedobjects.org/home/index.shtml)

JMatter -- implementation of naked objects -- [http://jmatter.org/](http://jmatter.org/). pretty good.

both of them are open source.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T03:18:08.317

On the Java side, there are several projects aimed at Rich Client Platforms (RCP is the new buzzword for 'desktop' apps):

*   Eclipse RCP (if you are OK using SWT instead of Swing)
*   Spring RCP (which is in the process of being overhauled into Spring Desktop)
*   NetBeans RCP (which I'm not particularly impressed with, but that is getting some traction)
*   JSR 296 (Application Framework) - I actually really like this one

Google any of the above and you'll get tons of info.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T20:08:19.847

You can use some of the same approaches in client development that you use in web development, such as Model View Presenter. The System.Windows.Forms namespace has everything you need to build a client application in C#, with the rest of the .NET Framework available to provide the services you need (such as IO and remoting).

As far as source code for solid architectures in desktop apps, look at the code for [Paint.NET](http://www.getpaint.net/) and [SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/). Both have very different approaches that will be interesting to you.

Sorry for the .NET slant of this reply. It's what I know best. :)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-14T12:52:57.237

I would recommend CSLA .NET framework by Rockford Lhotka: [http://www.lhotka.net/cslanet/Default.aspx](http://www.lhotka.net/cslanet/Default.aspx)

It comes will full source code as well as sample client applications built in ASP.NET, WinForms and WPF.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-19T18:38:27.490

I just found the [Composite Application Guidance for WPF and Silverlight](http://msdn.microsoft.com/en-us/library/dd458809.aspx) which looks very interesting. It was published in February 2009.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-29T23:26:55.237

We develop in .NET technologies here.

Our friends here working on client applications develop their software to the Model View Presenter design pattern that is often associated with Web Development. For them they find it works very well, I believe it may be worth checking out.

The Smart Client Factory (mentioned by Panos) may also be useful to you, though it's not a framework but more of a library of best practice solutions to common problems.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T06:15:54.707

Specifically to organized presentation framework of ui functions we have been using [infonode docking windows](http://www.infonode.net/index.html?idw), that's a windowing framework using an eclipse like appearance (drag views anywhere, close them, undock them etc., skinnable of course). there's a gpl version for open source products out, altough afaik the developer licence is not that expensive ($299 each).

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-15T22:46:21.017

Check IdeaBlade's Cabana For DotNet C#. [http://www.ideablade.com/CAB.html](http://www.ideablade.com/CAB.html)

Cabana Sample App

The Cabana application is a simple smart client reference app with a crisp, feature-rich user experience that is easy to deploy and operate over the web. Cabana demonstrates:

An easy approach to the Composite UI Application Block from Microsoft ’s Patterns & Practices Group. Maintainable, reusable code through UI composition. Separation of Model (business logic and data access) from Presentation. The Model-View-Presenter pattern. Performance tuning. And more.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-11-27T20:27:44.460

I recently published DesktopBootstrap. It's my attempt to factor out many of the common elements of creating medium to large scale desktop apps.

You can find it [here](https://github.com/adamsmith/DesktopBootstrap "DesktopBootstrap").

# javascript - 使用 javascript 读取/操作查询字符串参数的最简单方法是什么？

> ID：150404
> 
> 赞同：13
> 
> 时间：2008-09-29T20:03:04.277
> 
> 标签：javascript, query-string

我在网上看到的示例似乎比我预期的要复杂得多*（手动将 &/?/= 解析成对，使用正则表达式等）。* 我们正在使用 asp.net ajax *（在他们的客户端参考中看不到任何内容）*，如果真的有帮助，我们会考虑添加 jQuery。

我认为那里有一个更优雅的解决方案 - 到目前为止，[这是我找到的最好的代码，](http://www.bloggingdeveloper.com/post/JavaScript-QueryString-ParseGet-QueryString-with-Client-Side-JavaScript.aspx)但我很想找到更多类似 HttpRequest.QueryString 对象*（asp.net 服务器端）*的东西。提前致谢，

谢恩

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-29T20:05:41.773

确实有一个用于 jQuery 的[QueryString 插件](http://plugins.jquery.com/project/query-object)，如果您愿意安装 jQuery 核心和插件，它可能会很有用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-08-02T13:32:12.407

如果我不想使用插件，我正在使用此功能：

```
function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
            return pair[1];
        }
    }
    return null;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T20:08:22.127

看看我的帖子，因为它告诉你具体如何做到这一点：

[http://seattlesoftware.wordpress.com/2008/01/16/javascript-query-string/](http://seattlesoftware.wordpress.com/2008/01/16/javascript-query-string/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-02T13:22:52.757

对于 jQuery，我建议[jQuery BBQ: Back Button & Query Library](http://benalman.com/projects/jquery-bbq-plugin/) By "Cowboy" Ben Alman

> jQuery BBQ 利用 HTML5 hashchange 事件来实现简单但功能强大的可书签 #hash 历史记录。此外，jQuery BBQ 提供了完整的 .deparam() 方法，以及散列状态管理以及片段/查询字符串解析和合并实用程序方法。

例子：

```
// Parse URL, deserializing query string into an object.
// http://www.example.com/foo.php?a=1&b=2&c=hello#test
// search is set to ?a=1&b=2&c=hello
// myObj is set to { a:"1", b:"2", c:"hello" }
var search = window.location.search;
var myObj = $.deparam.querystring( search ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-31T16:54:21.887

使用来自prototypejs.org 的String 实用程序，称为toQueryParams()。

来自他们网站的示例：http: [//prototypejs.org/api/string/toQueryParams](http://prototypejs.org/api/string/toQueryParams)

> 'section=blog&id=45'.toQueryParams();
> // -> {section: 'blog', id: '45'}
> 
> 'section=blog;id=45'.toQueryParams();
> // -> {section: 'blog', id: '45'}
> 
> ' [http://www.example.com?section=blog&id=45#comments](http://www.example.com?section=blog&id=45#comments) '.toQueryParams();
> // -> {section: 'blog', id: '45'}
> 
> 'section=blog&tag=javascript&tag=prototype&tag=doc'.toQueryParams();
> // -> {section: 'blog', tag: ['javascript', 'prototype', 'doc']}
> 
> 'tag=ruby%20on%20rails'.toQueryParams();
> // -> {tag: 'ruby on rails'}
> 
> 'id=45&raw'.toQueryParams();
> // -> {id: '45', raw: undefined}

此外，您可以使用别名 parseQuery() 来获得相同的结果。

```
window.location.search.parseQuery(); 
```

由于 window.location 返回一个对象，因此您必须获取该字符串。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-07T11:24:48.747

```
 *$(document).ready(function () {
            $("#a").click(function () {
                window.location.href = "secondpage.aspx?id='0' & name='sunil'& add='asr' & phone='1234'";
            });
        });*

**then read the query string parameters on another using split method . Here as follows:**

  *$(document).ready(function () {
            var a = decodeURI(window.location.search);
            var id = window.location.search = "id=" + $().val();
            var name = a.split("name=")[1].split("&")[0].split("'")[1];
            var phone = a.split("phone=")[1].split("&")[0].split("'")[1];
            var add = a.split("add=")[1].split("&")[0].split("'")[1];
            alert(id+','+name+','+add+','+phone); 
        });* 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-09-26T20:11:30.500

如果有可能遇到重复的参数（例如 ?tag=foo&tag=bar），那么大多数库都不够用。在这种情况下，您可能需要考虑我从 Jan Wolter 的[非常全面的解析器](http://unixpapa.com/js/querystring.html)开发的这个库。我添加了 .plus() 和 .minus() 函数和往返：

[https://github.com/timmc/js-tools/blob/master/src/QueryString.js](https://github.com/timmc/js-tools/blob/master/src/QueryString.js)

# php - 将 PHP 5.2.5 升级到 5.2.6 会导致任何问题吗？

> ID：150405
> 
> 赞同：2
> 
> 时间：2008-09-29T20:03:27.223
> 
> 标签：php, upgrade

我们目前正在使用 php 5.2.5 运行。我们现在遇到了一个导致段错误的错误。我们对解决方案的第一个想法是升级到版本 5.2.6，但对它会产生的问题持怀疑态度。我们正在运行 Apache 并托管十几个站点。

*   任何现有的代码都会中断吗？
*   是否有任何重大变化需要注意。我正在阅读更改日志，但没有注意到任何内容。
*   如果出现问题，是否容易恢复到 5.2.5？
*   还有什么需要注意的吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T20:05:09.137

如果不先对其进行分析，我们中的任何人都不可能对您现有的代码破坏说绝对是或否。

这正是测试环境的用途。如果您设置了测试环境，则可以执行升级，然后进行回归测试以查看是否有任何问题。没有这种环境，你就是在赌博。

@Grant Wagner：关于虚拟化的要点。建立一个好的测试环境并不难。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T20:11:22.913

有了现代虚拟机选项[VMware Server](http://www.vmware.com/freedownload/login.php?product=server20)、[Microsft Virtual Server](http://www.microsoft.com/windowsserversystem/virtualserver/)、[Microsoft Virtual PC](http://www.microsoft.com/windows/downloads/virtualpc/default.mspx)等，为什么不设置一个运行现有平台的虚拟环境，然后升级和测试呢？

如果您愿意花钱，您可以购买执行 P2V（物理到虚拟）的工具，该工具将采用您现有的设置并为您提供它的虚拟化副本（如果您做了很多工作，这可能很有价值对可能难以生成的虚拟化版本的配置进行定制，该版本与原始版本匹配得足以进行适当的测试）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T20:14:27.117

很可能不是。从 5.2.5 到 5.2.6 的跳跃很小，它是一个错误修复版本（参见[更新日志](http://www.php.net/ChangeLog-5.php)）。

但无论何时升级任何东西，请确保在将代码投入生产之前在开发环境中测试您的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T20:16:24.820

正如大家所说，只有测试才能肯定地告诉你。但是，像这样的次要版本更新很少会导致兼容性问题。

对于它的价值，[这里是更改说明](http://www.php.net/ChangeLog-5.php#5.2.6)。

但从长远来看，您将不得不在某些时候升级，否则可能会面临已知的安全漏洞。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T20:28:25.960

感谢大家的意见。获得测试服务器肯定在路线图上。这应该是最终获得一个设置的一个很好的论据。我们是一家足够小的公司，我们可以轻松摆脱只有一个，但拥有测试服务器有很多好处。

不幸的是，如果不升级就很难让这个项目向前推进，我怀疑是否会有时间进行测试环境。

# theory - 根据评分为用户生成“邻居”

> ID：150410
> 
> 赞同：10
> 
> 时间：2008-09-29T20:05:14.083
> 
> 标签：theory, cluster-analysis, neighbours

我正在寻找为我正在开发的网站上的用户生成“邻居”（具有相似品味的人）的技术；类似于 last.fm 的工作方式。

目前，我有一个可以发挥作用的用户兼容功能。它根据 1) 对相似项目的评分 2) 对项目的相似评分对用户进行排名。该函数的权重为第 2 点，如果我在生成“邻居”时仅使用这些因素之一，这将是最重要的。

我的一个想法是只计算每个用户组合的兼容性，并选择评价最高的用户作为用户的邻居。这样做的缺点是随着用户数量的增加，这个过程可能需要很长时间。对于仅 1000 个用户，它需要 1000C2 (0.5 * 1000 * 999 = = 499 500) 次调用兼容性功能，这对服务器来说也可能非常繁重。

所以我正在寻找关于如何最好地实现这样的系统的任何建议、文章链接等。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T20:18:28.480

在《编程集体智能》一书中
[http://oreilly.com/catalog/9780596529321](http://oreilly.com/catalog/9780596529321)

第 2 章“做出推荐”很好地概述了根据用户之间的相似性向人们推荐物品的方法。您可以使用相似度算法找到您正在寻找的“邻居”。该章节可在此处的谷歌图书搜索中找到：http:
[//books.google.com/books ?id=fEsZ3Ey-Hq4C&printsec=frontcover](http://books.google.com/books?id=fEsZ3Ey-Hq4C&printsec=frontcover)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T03:01:22.910

您需要的是一种聚类算法，它会自动将相似的用户分组在一起。您面临的第一个困难是大多数聚类算法期望它们聚类的项目被表示为欧几里得空间中的点。在您的情况下，您没有点的坐标。相反，您可以计算它们之间的“相似性”函数的值。

这里的一个很好的可能性是使用[光谱聚类](http://en.wikipedia.org/wiki/Data_clustering#Spectral_clustering)，这正是你所拥有的：相似矩阵。缺点是您仍然需要为每对点计算兼容性函数，即算法为 O(n^2)。

如果您绝对需要比 O(n^2) 更快的算法，那么您可以尝试一种称为[dissimilarity spaces](http://ict.ewi.tudelft.nl/~duin/papers/icpr_04_disrep.pdf)的方法。这个想法很简单。您反转您的兼容性函数（例如，通过取其倒数）将其转换为差异或距离的度量。然后，您将每个项目（在您的情况下为用户）与一组原型项目进行比较，并将结果距离视为空间中的坐标。例如，如果您有 100 个原型，那么每个用户将由 100 个元素的向量表示，即由 100 维空间中的一个点表示。然后您可以使用任何标准的聚类算法，例如[K-means](http://en.wikipedia.org/wiki/Data_clustering#K-means_and_derivatives)。

现在的问题是你如何选择原型，你需要多少。已经尝试了各种启发式方法，但是，这里有[一篇论文](http://cs.bc.edu/~dima/papers/thesis.pdf)它认为随机选择原型可能就足够了。它显示了使用 100 或 200 个随机选择的原型的实验产生了良好的结果。在您的情况下，如果您有 1000 个用户，并且您选择其中的 200 个作为原型，那么您需要评估您的兼容性函数 200,000 次，这比比较每一对用户提高了 2.5 倍。然而，真正的优势在于，对于 1,000,000 名用户，200 个原型仍然足够，并且您需要进行 200,000,000 次比较，而不是 500,000,000,000 次改进 2500 倍。您得到的是 O(n) 算法，即比 O(n^2) 好，尽管常数因子可能很大。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:18:09.860

请务必查看[Collaborative Filtering](http://en.wikipedia.org/wiki/Collaborative_filtering)。许多推荐系统使用协同过滤来向用户推荐项目。他们通过寻找“邻居”然后推荐你的邻居评价很高但你没有评价的项目来做到这一点。你可以去寻找邻居，谁知道呢，也许你将来会想要推荐。

[GroupLens](http://grouplens.org/)是明尼苏达大学的一个研究实验室，研究协同过滤技术。他们有大量已发表的研究以及一些示例数据集。

[Netflix 奖](http://netflixprize.com/)是一项旨在确定谁能最有效地解决此类问题的竞赛。按照他们的[排行榜](http://www.netflixprize.com//leaderboard)上的链接。一些竞争对手分享了他们的解决方案。

至于计算成本低廉的解决方案，您可以试试这个：

*   为您的项目创建类别。如果我们谈论音乐，它们可能是古典、摇滚、爵士、嘻哈......或者更进一步：[Grindcore、Math Rock、Riot Grrrl](http://en.wikipedia.org/wiki/List_of_rock_genres) ......
*   现在，每次用户对项目进行评分时，都会在类别级别汇总他们的评分。所以你知道“用户 A”喜欢 Honky Tonk 和 Acid House，因为他们经常给这些项目高评价。频率和强度可能对您的类别总分很重要。
*   当需要寻找邻居时，不要浏览所有评级，只需在类别中寻找相似的分数。

这种方法不会那么准确，但速度很快。

干杯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T20:31:12.430

如果您将其视为构建/批处理问题而不是实时查询，则可以大大减轻对性能的担忧。

可以静态计算该图，然后进行潜在更新，例如每小时、每天等，然后生成边和存储优化以用于运行时查询，例如每个用户的前 10 个相似用户。

+1 也适用于编程集体智能 - 它提供的信息非常丰富 - 希望它不是（或者我曾经是！）面向 Python，但仍然很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T20:14:02.453

这个问题似乎是“分类问题”。是的，有很多解决方案和方法。

要开始探索，请检查： [http ://en.wikipedia.org/wiki/Statistical_classification](http://en.wikipedia.org/wiki/Statistical_classification)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T20:23:00.997

您听说过[kohonen 网络](http://www.cs.bham.ac.uk/~jlw/sem2a2/Web/Kohonen.htm)吗？

它是一种自组织学习算法，将相似的变量聚集到相似的槽中。尽管大多数网站（如我链接到的网站）都将网络显示为二维，但很少涉及将算法扩展到多维超立方体。

使用这样的数据结构，查找和存储具有相似品味的邻居是微不足道的，因为相似的用户应该被存储到相似的位置（几乎就像一个反向哈希码）。

这将您的问题减少为找到将定义相似性的变量并在可能的枚举值之间建立距离的问题之一，例如古典和声学是接近的，而死亡金属和雷鬼是相当遥远的（至少在我看来）

顺便说一句，为了找到好的划分变量，最好的算法是[决策树](http://en.wikipedia.org/wiki/Decision_tree)。更靠近根的节点将是建立“紧密度”的最重要变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T20:28:12.437

看来您需要阅读有关[聚类算法](http://en.wikipedia.org/wiki/Data_clustering)的信息。一般的想法是，每次将它们分成相似点的集群时，不要将每个点与每个其他点进行比较。那么邻域可能是同一个簇中的所有点。聚类的数量/大小通常是聚类算法的参数。

你可以在 Google 关于[集群计算和 mapreduce](http://code.google.com/edu/submissions/mapreduce-minilecture/listing.html)的系列中找到[关于集群的视频](http://www.youtube.com/watch?v=1ZDybXl212Q)。

# c# - 追踪全球化进程

> ID：150416
> 
> 赞同：1
> 
> 时间：2008-09-29T20:07:32.237
> 
> 标签：c#, globalization

在我们的下一个主要版本中，我们希望全球化我们的 ASP.Net 应用程序，我被要求想出一种方法来跟踪在这项工作中已经完成了哪些代码。

我的想法是使用自定义属性并将其放置在所有已“修复”的类上。

你怎么看？

有没有人有更好的主意？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T20:11:28.887

使用属性来确定哪些类已经被全球化，然后需要一个工具来处理代码并确定哪些类已经“处理”了和没有被“处理”，看起来有点复杂。

更传统的项目跟踪过程可能会更好 - 并且不会使用在全球化项目结束后没有功能意义的属性/其他标记“污染”您的代码。为每个需要工作的类提出一个缺陷并以这种方式跟踪它怎么样？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T20:21:55.337

只计算或列出班级然后​​按班级工作呢？虽然属性可能是一个有趣的想法，但我认为它是过度设计的。全球化只不过是遍历每个类并全球化代码:)

无论如何，您都希望在下一个版本之前完成它。因此，继续进行，一件一件地做，您就有了进步。我也认为为每个班级提出的缺陷太多了。

在我的上一个项目中，我开始全面全球化的时间有点晚。我只是从上到下浏览了代码文件列表。在我的情况下按字母顺序排列，一个文件夹接一个文件夹。所以我总是只需要记住我上次处理的文件。这对我来说效果很好。

编辑：另一件事：在我的上一个项目中，全球化主要涉及将硬编码字符串移动到资源文件，并在运行时语言更改时重新生成所有文本。但是您还必须考虑数字格式等问题。微软的 FxCop 帮我解决了这个问题，因为它标记了所有数字转换等，而没有将文化指定为违规。FxCop 会对此进行跟踪，因此当您解决此类违规并重新运行 FxCop 时，它会将违规报告为丢失（即已解决）。这对于这些难以看到的东西特别有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T19:18:46.380

为应用程序中的每个页面编写单元测试怎么样？单元测试将加载页面并执行

```
foreach (System.Web.UI.Control c in Page.Controls)
{
    //Do work here
} 
```

对于工作部分，加载不同的全球化设置并查看 .Text 属性（或您的应用程序的相关属性）是否不同。

My assumption would be that no language should come out the same in all but the simplest cases.

Use the set of unit tests that sucessfully complete to track your progress.

# xml - 在 XML 中存储引用数据的公认方式是什么？

> ID：150423
> 
> 赞同：20
> 
> 时间：2008-09-29T20:09:14.480
> 
> 标签：xml, quotes

在 XML 中存储引用数据的公认方式是什么？

例如，对于一个节点，哪个是正确的？

*   (a) <name>杰西“身体”文图拉</name>
*   (b) <name>杰西\“身体\”文图拉</name>
*   (c) <name>杰西“身体” 文图拉</name>
*   (d) 以上都不是（请注明）

如果（a），你对属性做什么？如果 (c)，混合 HTML 和 XML 真的合适吗？同样，您如何处理单引号和大引号？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-29T20:14:16.323

您的正确答案是 A & C 因为`"`不是必须在元素数据中编码的字符。

您应该始终使用 XML 编码字符，例如`>`、`<`，并`&`确保如果它们不在 CDATA 部分内，您不会遇到问题。这些是元素数据需要关注的关键项目。

在谈论属性时，您还必须注意属性值`'`和`"`内部属性值，具体取决于您用于围绕值的符号类型。

我发现经常编码`"`并且`'`在各个方面都是一个更好的主意，因为它有时会在转换为其他格式时有所帮助，其中`"`or`'`也可能导致问题。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-29T20:46:32.907

XML 元素内的字符数据可以包含引号字符而不转义它们。在 XML 元素中唯一不允许使用的字符是 '<'、'&' 和 '>'（并且 '>' 字符只有在它是 "]]>" 字符序列的一部分时才被允许使用。

这并不是说转义引号不是一个好主意——我只是说不转义引号是完全有效的 XML。请参阅 XML 规范中的第 2.4 节 - “字符数据和标记”。

所以（a）和（c）都可以。

就属性而言，属性值可以用单引号或双引号括起来，因此如果它包含一个或另一个，您可以使用相反的一个来括起该值。如果它包含两者，那么您将不得不为一个或两个使用一个字符实体。

就“弯引号”而言，如果您谈论的是 Word 有时会将引号转换为的特殊非 ASCII 引号 - 它们在 XML 中没有特殊含义，因此您可以做任何事情（但他们不能用于包含属性值”。您还需要确保文档的字符编码正确，以便正确解释它们。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T21:00:02.483

文本节点中的双引号可以表示为双引号字符或`&quot;`实体。属性值中的双引号如果值用单引号分隔，则可以表示为双引号字符，反之亦然；否则，将它们作为`&quot;`

仅当您 a) 在不支持 XML 的文本编辑器中编辑 XML 或 b) 通过字符串操作以编程方式创建 XML 时，这才有意义。一般来说，除非您真的知道自己在做什么，或者至少有办法在编辑完成后检查 XML 的格式是否正确，否则您应该避免 (a)。

在任何情况下，您都应该避免 (b)。永远不要通过字符串操作创建 XML；总是使用 DOM 或其他工具。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-29T20:27:12.453

您不必担心事物在 XML 中的编码方式。您应该始终使用适当的库来生成 XML 文档。XML 有太多的陷阱，无法自己解决。我已经看到大量无效的 XML 文档出现在我面前，因为有人认为他们可以自己生成正确的 XML，而无需使用库。目前使用的所有主要编程语言都有 XML 库。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T21:23:54.267

> 例如，对于一个节点，哪个是正确的？

XML 规范本身不讨论节点（除了将 DTD 语法与有限自动机正则表达式进行比较时）。DOM 节点可以是属性、元素、文本或任何其他节点类型。

在文本节点内，您只需要转义解析器将解释为启动不同节点的字符 - 因此您将*&*和*<*转义为*&* 和*<* .

为了可移植性，转义大引号通常是个好主意，但没有理由转义 XML 文本中的纯引号。

在属性节点内，您必须像以前一样转义小于号和与号，以及用于分隔属性的任何引号。

```
<foo attribute="'ok'" attribute2='"also-ok"' attribute3="&quot;needed&quot;"/> 
```

通常更容易养成只使用一种类型并总是逃避它的习惯。我写了很多 XSLT 并且喜欢在里面使用“外部”和“内部”：

```
<xsl:value-of select="person[@name = 'bob']"/> 
```

如果您对转义感到偏执，则 XPath 的可读性会降低：

```
<xsl:value-of select="person[@name = &apos;bob&apos;"/> 
```

> 如果 (c)，混合 HTML 和 XML 真的合适吗？

XML 定义命名实体*amp*、*gt*、*lt*、*apos*、 & *quot*

HTML 定义了更多的实体。

您可以而且应该在 XML 中使用 XML 命名实体，而不是使用数字实体。

*lt*实体转义*<*并且应该在文本和属性值中使用。*amp*实体转义*&*并且应该在文本和属性值中使用。*apos*和*quot*实体转义*'*和"并且应该在属性值中使用。*gt**实体*有点没用 - 在 XML 中几乎没有语法要求转义*>*。也许 > 只同意与 < 如果它相等计费。

我在生成源代码的 XSLT 中经常使用的另一个是它插入一个新行。*&nl;* 会比*>更有用*

> 同样，您如何处理单引号和大引号？

XML 旨在标记 Unicode 文本，而花引号在其中没有特殊含义。但是，用于 XML 文档的编码在野外被误解的情况并不少见。因此，如果它在一个封闭的环境中并且可以保证生产者和消费者的 Unicode 编码正确，那么我只需将它放在 XML 中。否则使用数字字符实体。代码点高于 127 的任何字符都是如此——花引号没有什么特别之处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T20:39:20.397

这真的取决于。如果您只想在 XML 字符串中加上引号，则使用“A”。

但是如果有含义或者您需要抽象引用（例如 i18n），XML 提供了更丰富的选项。例如：

```
<name>
  <given>Jesse</given>
  <family>Ventura</family>
  <nickName>the Body</nickName>
</name> 
```

在许多情况下矫枉过正。但是，如果您需要正确处理世界上许多不同且经常不一致的命名方案，我会考虑按照这些方式对您的名称进行编码。XML 非常适合这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T20:12:37.653

正确答案是“C”。

单引号并不会真正引起问题，但您需要注意与号和左尖括号。

# ruby-on-rails - 在没有 IIS 的情况下将 NTLM Active Directory 用户数据检索到 Rails

> ID：150429
> 
> 赞同：6
> 
> 时间：2008-09-29T20:11:20.747
> 
> 标签：ruby-on-rails, active-directory, ntlm

我相信我们可以让 Firefox 将 NTLM 数据发送到 SharePoint 网站以进行自动身份验证，我认为这在 IIS 上是可行的。

我想对内部 Rails 站点做同样的事情。

有谁知道我可以通过 Apache/mongrel 设置验证 NTLM 类型用户信息的方式（当然前提是它已经在 Active Directory 域内的 Windows 机器上运行）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-02T16:20:05.847

我创建了[有关如何](http://blog.rayapps.com/2008/12/02/ntlm-windows-domain-authentication-for-rails-application/)在 Linux 上为 Apache 安装修补的 mod_ntlm 模块以及如何将经过 NTLM 身份验证的用户名传递给 Rails 以及如何从中创建 Rails 会话的教程。因此，您不需要 Windows 服务器来运行 Rails 应用程序。

在那里，您还可以找到如何在 Firefox 中启用自动 NTLM 身份验证 - 在位置字段中输入“about:config”，然后搜索“network.automatic-ntlm-auth.trusted-uris”。在那里，您可以输入要使用自动 NTLM 身份验证的服务器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-09-17T17:08:07.100

一些额外的信息，以防有人偶然发现。

我想做一些我认为应该很简单的事情——使用 NTLM 从运行在 Mongrel/Windows 上的 Rails 应用程序（实际上是 InstantRails）中提取用户 Windows 用户名。[编写了管理各种握手操作的基本代码（使用http://rubyforge.org/projects/rubyntlm/](http://rubyforge.org/projects/rubyntlm/)上的伟大 NTLMRuby 库）并让它在 Firefox 中出色地工作后，我发现 IE 无法正常工作有点沮丧。

Mongrel 在 type1/2/3 消息交换期间不支持 keep-alives（至少在本机上，我相信它有一个 hack/fix），这是 IE 要求的，而 Firefox 没有。

因此，针对远程 NTLM 服务（例如 Sharepoint 或其他网站）对运行在 Windows 上的 Rails 服务器进行身份验证是相当直接的，但是针对在 Windows 上运行的 Rails 服务器验证 IE 浏览器的身份并没有使用 Mongrel 那么多。IIS 将是一个选项，可能是带有 FastCGI 的基本 Apache。前者感觉有点笨拙，后者不会像 Mongrel 那样快。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T21:13:29.160

我假设您已经确定了需要发送哪些 HTTP 标头才能让 firefox 和 IE 发回 NTLM 身份验证内容，并且只需要在服务器端处理它？

您可以使用一些 ruby​​ 的[win32 库](http://raa.ruby-lang.org/cat.rhtml?category_major=Library;category_minor=Win32)来访问处理 NTLM 的底层 Windows 身份验证功能。

我建议阻力最小的路径可能是查看是否有可以为您进行身份验证的 COM 组件，如果有，请使用 Win32OLE ruby​​ 库来使用它。

如果没有 COM 组件，您可能会在其他库之一中找到可以为您调用本机 win32 方法的内容。

如果找不到，则必须编写一个 ruby​​ C 扩展。我在 linux 上做过这个，扩展 ruby​​ 很容易，但是你可能会发现 microsoft authentication API 有点痛苦。

希望这能让你走上正确的道路:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T15:10:26.653

您还可以使用[Apache ntlm 模块](http://modntlm.sourceforge.net/)，它应该使用经过身份验证的用户的用户名将标头向前传递给您的应用程序。该模块看起来有点旧，但建议了一些其他可能适合您需求的模块。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-16T19:08:48.063

我知道的老问题，但我在寻找类似的答案时遇到了这个问题。

您可以使用此处描述的方法（[http://blog.rayapps.com/2008/12/02/ntlm-windows-domain-authentication-for-rails-application/](http://blog.rayapps.com/2008/12/02/ntlm-windows-domain-authentication-for-rails-application/)）。但是 mod_ntlm 用于 UNIX/linux 机器上的 Windows 身份验证。mod_auth_sspi 是您在 windows 下从 apache 进行 winNT 身份验证所需要的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-04-08T16:58:47.850

这个特定的项目看起来很有希望，并且正在寻找贡献者：

*   [使用 NTLM 进行透明身份验证的机架中间件](http://github.com/dtsato/rack-ntlm)。

我还没有尝试过。目前我计划实施 Raimonds 的解决方案，因为它似乎取得了很大的成功。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-27T13:43:41.050

看看[华夫饼](http://waffle.codeplex.com)。它使用 Win32 API 在 Windows 上向 Java 服务器提供 SSO。有许多实现的过滤器（servlet、tomcat 阀、spring-security）。

# language-agnostic - 序列图能否以与代码相同的深度真实地捕捉您的逻辑？

> ID：150445
> 
> 赞同：3
> 
> 时间：2008-09-29T20:14:54.403
> 
> 标签：language-agnostic, oop, uml, modeling

我一直使用 UML 序列图，并且熟悉 UML2 符号。

但我只用它们来捕捉我打算做的事情的本质。换句话说，图表总是存在于实际代码之上的抽象级别。每次我使用它们来尝试**准确地**描述我打算做什么时，我最终都会使用如此多的水平空间和如此多的 alt/loop 帧，这不值得付出努力。

所以理论上可能是可能的，但有没有人真正使用过这个详细程度的图表？如果是这样，你能提供一个例子吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T20:30:49.480

我有同样的问题，但是当我意识到我要低级时，我重新阅读了这个：

> 当您想查看单个用例中多个对象的行为时，您应该使用**序列图。**序列图擅长展示对象之间的协作；他们不太擅长对行为进行精确定义。
> 
> 如果您想查看多个用例中单个对象的行为，请使用**状态图**。如果您想查看跨多个用例或多个线程的行为，请考虑使用 **活动图**。
> 
> 如果您想快速探索多种替代交互，则最好使用**CRC 卡**，因为这样可以避免大量的绘制和擦除。有一个 CRC 卡会话来探索设计替代方案，然后使用序列图来捕获您以后想要参考的任何交互，这通常很方便。
> 
> [*摘自 Martin Fowler 的[UML Distilled](https://rads.stackoverflow.com/amzn/click/com/0321193687)书*]

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T20:20:54.530

都是相对的。制作图表时，收益递减法则始终适用。我认为展示对象之间的交互很好（objectA 初始化 objectB 并在其上调用方法 foo）。但是展示函数的内部是不切实际的。在这方面，序列图在与代码相同的深度捕获逻辑是不切实际的。我会争论复杂的逻辑，你会想使用流程图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-22T22:42:37.680

我认为有两个问题需要考虑。

## 是具体的

当序列图用于传达单个具体场景（例如用例）时，它们处于最佳状态。

当您使用它们来描述多个场景时，通常是为了显示通过用例的每条可能路径中发生的情况，它们会很快变得复杂。

由于源代码在这方面就像一个用例（即一般描述而不是特定描述），因此序列图不太适合。想象一下扩展某个方法的调用图的 x 级别，并在单个图上显示所有信息，包括所有 if 和循环条件。

这就是为什么你所说的“捕捉本质”如此重要。

理想情况下，序列图适合单个 A4/Letter 页面，任何更大的东西都会使图表变得笨拙。也许根据经验，将对象数量限制为 6-10，将调用次数限制为 10-25。

## 专注于沟通

序列图旨在突出通信，而不是内部处理。

在指定发生的通信（相关方、异步、同步、立即、延迟、信号、调用等）时，它们非常有表现力，但在涉及内部处理时却没有（实际上只有动作）

此外，尽管您可以使用变量，但它远非完美。顶部的对象是对象。您可以将它们视为变量（即使用它们的名称作为变量），但这不是很方便。

例如，尝试描绘一个链表的遍历，您需要在其中使用序列图来密切关注元素及其前身。您可以使用两个名为“current”和“previous”的“变量”对象，并添加必要的操作以使 current=current.next 和 previous=current 但结果很尴尬。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T11:33:22.027

答案是否定的 - 它确实比您的源代码更好地捕获它！至少在某些方面。让我详细说明。

你——和包括我在内的大多数程序员一样——思考源代码行。但是软件最终产品——我们称之为系统——远不止这些。它只存在于您的团队成员的脑海中。在更好的情况下，它也存在于纸上或其他记录形式中。

有很多标准的“视图”来描述系统。像 UML 类图、UML 活动图等。每个图都从另一个角度显示系统。您有静态视图、动态视图，但在架构/软件文档中您不必止步于此。您可以用自己的话来呈现非标准视图，例如部署视图、性能视图、可用性视图、公司价值视图、老板喜欢的东西视图等。每个视图都捕获并记录了系统的某些属性。

意识到源代码只是一个视图是非常重要的。最重要的是，因为它需要生成计算机程序。但它不包含您系统的每一条信息，也没有显式或隐式地包含。（例如程序模块之间的共享数据，仅通过离线用户活动连接。源中没有跟踪）。它只是一个静态视图，对理解您的流程、您的呼吸程序的运行时动态几乎没有帮助。

观察者模式的一个经典例子。特别是如果它大量使用，您将很难从源代码中理解系统机制。这就是在这种情况下使用序列图的原因。它比源代码更好地捕获系统的“动态逻辑”。

但是，如果您要详细说明某种业务逻辑，则最好使用纯文本/源代码/伪代码等。您不必仅仅因为它们是标准而使用 UML 图。您可以在不绘制用例图的情况下使用用例建模。始终选择最适合您和您的目的的视图。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T20:27:52.407

就我个人而言，我只使用序列图来描述不同对象之间的一般交互，即作为快速的“时间交互草图”。当我试图更深入时，所有人很快就开始感到困惑......

我发现最好的折衷方案是“简化”序列图，然后对下面的逻辑进行清晰而深入的描述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-12T18:36:50.753

**UML 图是指导方针，而不是严格的规则。**

您**不必将它们完全和详细地制作为源代码**，但是，如果您愿意，可以尝试一下。

有时，它可以做到，有时，它不可能，因为系统的细节或复杂性，或者没有时间或细节去做。

干杯。

PD 有适合猫吃的芝士汉堡或金枪鱼汉堡吗？

# ios - 如何检测有人摇晃 iPhone？

> ID：150446
> 
> 赞同：344
> 
> 时间：2008-09-29T20:14:59.737
> 
> 标签：ios, accelerometer, motion-detection, shake

当有人摇晃 iPhone 时，我想做出反应。我并不特别在乎他们如何摇晃它，只是它被大力挥动了一瞬间。有谁知道如何检测这个？

* * *

## 回答 #1

> 赞同：293
> 
> 时间：2009-07-10T21:06:33.907

在 3.0 中，现在有一种更简单的方法 - 挂钩新的运动事件。

主要技巧是您需要有一些 UIView（不是 UIViewController）作为 firstResponder 来接收震动事件消息。以下是您可以在任何 UIView 中用于获取抖动事件的代码：

```
@implementation ShakingView

- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event
{
    if ( event.subtype == UIEventSubtypeMotionShake )
    {
        // Put in code here to handle shake
    }

    if ( [super respondsToSelector:@selector(motionEnded:withEvent:)] )
        [super motionEnded:motion withEvent:event];
}

- (BOOL)canBecomeFirstResponder
{ return YES; }

@end 
```

您可以轻松地将任何 UIView（甚至系统视图）转换为可以获取抖动事件的视图，只需使用这些方法对视图进行子类化（然后在 IB 中选择这种新类型而不是基本类型，或者在分配看法）。

在视图控制器中，您希望将此视图设置为第一响应者：

```
- (void) viewWillAppear:(BOOL)animated
{
    [shakeView becomeFirstResponder];
    [super viewWillAppear:animated];
}
- (void) viewWillDisappear:(BOOL)animated
{
    [shakeView resignFirstResponder];
    [super viewWillDisappear:animated];
} 
```

不要忘记，如果您有其他视图成为用户操作的第一响应者（例如搜索栏或文本输入字段），您还需要在其他视图辞职时恢复摇晃视图的第一响应者状态！

即使您将 applicationSupportsShakeToEdit 设置为 NO，此方法也有效。

* * *

## 回答 #2

> 赞同：180
> 
> 时间：2008-10-01T20:43:58.170

从我的[Diceshaker](http://infinite-labs.net/diceshaker/)应用程序中：

```
// Ensures the shake is strong enough on at least two axes before declaring it a shake.
// "Strong enough" means "greater than a client-supplied threshold" in G's.
static BOOL L0AccelerationIsShaking(UIAcceleration* last, UIAcceleration* current, double threshold) {
    double
        deltaX = fabs(last.x - current.x),
        deltaY = fabs(last.y - current.y),
        deltaZ = fabs(last.z - current.z);

    return
        (deltaX > threshold && deltaY > threshold) ||
        (deltaX > threshold && deltaZ > threshold) ||
        (deltaY > threshold && deltaZ > threshold);
}

@interface L0AppDelegate : NSObject <UIApplicationDelegate> {
    BOOL histeresisExcited;
    UIAcceleration* lastAcceleration;
}

@property(retain) UIAcceleration* lastAcceleration;

@end

@implementation L0AppDelegate

- (void)applicationDidFinishLaunching:(UIApplication *)application {
    [UIAccelerometer sharedAccelerometer].delegate = self;
}

- (void) accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration {

    if (self.lastAcceleration) {
        if (!histeresisExcited && L0AccelerationIsShaking(self.lastAcceleration, acceleration, 0.7)) {
            histeresisExcited = YES;

            /* SHAKE DETECTED. DO HERE WHAT YOU WANT. */

        } else if (histeresisExcited && !L0AccelerationIsShaking(self.lastAcceleration, acceleration, 0.2)) {
            histeresisExcited = NO;
        }
    }

    self.lastAcceleration = acceleration;
}

// and proper @synthesize and -dealloc boilerplate code

@end 
```

滞后性可防止多次触发摇晃事件，直到用户停止摇晃。

* * *

## 回答 #3

> 赞同：154
> 
> 时间：2010-03-08T23:58:19.530

[我终于使用此Undo/Redo Manager Tutorial](http://www.mobileorchard.com/new-in-iphone-30-tutorial-series-part-1-shake-to-undoredo-nsundomanager/)中的代码示例使其工作。
这正是您需要做的：

*   在 App 的 Delegate 中设置***applicationSupportsShakeToEdit属性：***

```
 - (void)applicationDidFinishLaunching:(UIApplication *)application {

        application.applicationSupportsShakeToEdit = YES;

        [window addSubview:viewController.view];
        [window makeKeyAndVisible];
} 
```

*   在视图控制器中添加/覆盖***canBecomeFirstResponder***、***viewDidAppear:***和***viewWillDisappear:方法：***

```
 -(BOOL)canBecomeFirstResponder {
    return YES;
}

-(void)viewDidAppear:(BOOL)animated {
    [super viewDidAppear:animated];
    [self becomeFirstResponder];
}

- (void)viewWillDisappear:(BOOL)animated {
    [self resignFirstResponder];
    [super viewWillDisappear:animated];
} 
```

*   将***motionEnded***方法添加到您的视图控制器：

```
 - (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event
{
    if (motion == UIEventSubtypeMotionShake)
    {
        // your code
    }
} 
```

* * *

## 回答 #4

> 赞同：94
> 
> 时间：2009-08-29T13:47:43.933

首先，肯德尔 7 月 10 日的回答是准确的。

现在......我想做类似的事情（在 iPhone OS 3.0+ 中），只是在我的情况下，我希望它适用于整个应用程序，以便在发生震动时提醒应用程序的*各个部分。*这就是我最终做的事情。

首先，我**继承了 UIWindow**。这很容易。创建一个新的类文件，其接口如`MotionWindow : UIWindow`(feel free to pick your own, natch)。添加这样的方法：

```
- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event {
    if (event.type == UIEventTypeMotion && event.subtype == UIEventSubtypeMotionShake) {
        [[NSNotificationCenter defaultCenter] postNotificationName:@"DeviceShaken" object:self];
    }
} 
```

更改`@"DeviceShaken"`为您选择的通知名称。保存文件。

现在，如果你使用 MainWindow.xib（股票 Xcode 模板的东西），进入那里并将你的 Window 对象的类从**UIWindow**更改为**MotionWindow**或任何你称之为它的东西。保存xib。如果您以编程方式设置**UIWindow**，请在此处使用新的 Window 类。

现在您的应用程序正在使用专门的**UIWindow**类。无论您想在哪里收到关于摇晃的消息，都可以注册他们的通知！像这样：

```
[[NSNotificationCenter defaultCenter] addObserver:self
selector:@selector(deviceShaken) name:@"DeviceShaken" object:nil]; 
```

将自己作为观察者移除：

```
[[NSNotificationCenter defaultCenter] removeObserver:self]; 
```

我将我的放在**viewWillAppear:**和**viewWillDisappear:**中，其中涉及视图控制器。确保您对抖动事件的响应知道它是否“已经在进行中”。否则，如果设备连续摇晃两次，您将遇到交通堵塞。这样，您可以忽略其他通知，直到您真正完成对原始通知的响应。

另外：您可以选择提示**motionBegan**与**motionEnded**。由你决定。在我的情况下，效果总是需要在设备静止*后*发生（相对于它开始摇晃时），所以我使用**motionEnded**。尝试两者，看看哪一个更有意义......或检测/通知两者！

这里还有一个（好奇的？）观察：请注意，此代码中没有第一响应者管理的迹象。到目前为止，我只用 Table View Controllers 尝试过这个，一切似乎都很好地协同工作！不过，我不能保证其他情况。

肯德尔等。al - 谁能谈谈为什么**UIWindow**子类会这样？是因为窗户位于食物链的顶端吗？

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2008-11-10T17:14:52.160

我发现这篇文章正在寻找一个“摇晃”的实现。millenomi 的回答对我来说效果很好，尽管我正在寻找需要更多“摇晃动作”才能触发的东西。我已经用一个 int shakeCount 替换为布尔值。我还在 Objective-C 中重新实现了 L0AccelerationIsShaking() 方法。您可以通过调整添加到shakeCount 的量来调整所需的摇动量。我不确定我是否找到了最佳值，但到目前为止它似乎运作良好。希望这可以帮助某人：

```
- (void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration {
    if (self.lastAcceleration) {
        if ([self AccelerationIsShakingLast:self.lastAcceleration current:acceleration threshold:0.7] && shakeCount >= 9) {
            //Shaking here, DO stuff.
            shakeCount = 0;
        } else if ([self AccelerationIsShakingLast:self.lastAcceleration current:acceleration threshold:0.7]) {
            shakeCount = shakeCount + 5;
        }else if (![self AccelerationIsShakingLast:self.lastAcceleration current:acceleration threshold:0.2]) {
            if (shakeCount > 0) {
                shakeCount--;
            }
        }
    }
    self.lastAcceleration = acceleration;
}

- (BOOL) AccelerationIsShakingLast:(UIAcceleration *)last current:(UIAcceleration *)current threshold:(double)threshold {
    double
    deltaX = fabs(last.x - current.x),
    deltaY = fabs(last.y - current.y),
    deltaZ = fabs(last.z - current.z);

    return
    (deltaX > threshold && deltaY > threshold) ||
    (deltaX > threshold && deltaZ > threshold) ||
    (deltaY > threshold && deltaZ > threshold);
} 
```

PS：我已将更新间隔设置为 1/15 秒。

```
[[UIAccelerometer sharedAccelerometer] setUpdateInterval:(1.0 / 15)]; 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2015-04-20T22:39:56.957

在带有 Swift 的 iOS 8.3（可能更早）中，它就像覆盖视图控制器中的`motionBegan`or方法一样简单：`motionEnded`

```
class ViewController: UIViewController {
    override func motionBegan(motion: UIEventSubtype, withEvent event: UIEvent) {
        println("started shaking!")
    }

    override func motionEnded(motion: UIEventSubtype, withEvent event: UIEvent) {
        println("ended shaking!")
    }
} 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-09-29T21:17:44.377

您需要通过 accelerometer:didAccelerate: 方法检查加速度计，该方法是 UIAccelerometerDelegate 协议的一部分，并检查值是否超过摇动所需移动量的阈值。

GLPaint 示例中 AppController.m 底部的 accelerometer:didAccelerate: 方法中有不错的示例代码，该示例可在 iPhone 开发者网站上找到。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-03-22T21:15:52.407

这是您需要的基本委托代码：

```
#define kAccelerationThreshold      2.2

#pragma mark -
#pragma mark UIAccelerometerDelegate Methods
    - (void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration 
    {   
        if (fabsf(acceleration.x) > kAccelerationThreshold || fabsf(acceleration.y) > kAccelerationThreshold || fabsf(acceleration.z) > kAccelerationThreshold) 
            [self myShakeMethodGoesHere];   
    } 
```

还要在界面中的相应代码中设置。IE：

@interface MyViewController : UIViewController <UIPickerViewDelegate, UIPickerViewDataSource, UIAccelerometerDelegate>

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-29T20:16:00.327

查看 GLPaint 示例。

[http://developer.apple.com/library/ios/#samplecode/GLPaint/Introduction/Intro.html](http://developer.apple.com/library/ios/#samplecode/GLPaint/Introduction/Intro.html)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2012-10-15T12:11:16.310

在 ViewController.m 文件中添加以下方法，它可以正常工作

```
 -(BOOL) canBecomeFirstResponder
    {
         /* Here, We want our view (not viewcontroller) as first responder 
         to receive shake event message  */

         return YES;
    }

    -(void) motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event
    {
            if(event.subtype==UIEventSubtypeMotionShake)
            {
                    // Code at shake event

                    UIAlertView *alert=[[UIAlertView alloc] initWithTitle:@"Motion" message:@"Phone Vibrate"delegate:self cancelButtonTitle:@"OK" otherButtonTitles: nil];
                    [alert show];
                    [alert release];

                    [self.view setBackgroundColor:[UIColor redColor]];
             }
    }
    - (void)viewDidAppear:(BOOL)animated
    {
             [super viewDidAppear:animated];
             [self becomeFirstResponder];  // View as first responder 
     } 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-08-18T15:05:41.763

很抱歉将其发布为答案而不是评论，但正如您所见，我是 Stack Overflow 的新手，所以我还没有足够的声誉来发表评论！

无论如何，一旦视图成为视图层次结构的一部分，我第二次@cire 确保设置第一响应者状态。因此，例如，在您的视图控制器`viewDidLoad`方法中设置第一响应者状态将不起作用。如果您不确定它是否有效，`[view becomeFirstResponder]`则会返回一个可以测试的布尔值。

还有一点：如果您不想不必要地创建 UIView 子类，**可以使用视图控制器来捕获抖动事件。**我知道这不是那么麻烦，但仍然有选择。只需将 Kendall 放入 UIView 子类的代码片段移动到您的控制器中，然后将`becomeFirstResponder`and`resignFirstResponder`消息发送到`self`而不是 UIView 子类。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2015-03-13T14:59:13.347

首先，我知道这是一个旧帖子，但它仍然是相关的，我发现两个最高投票的答案并没有**尽早检测到抖动**。这是如何做到的：

1.  在目标的构建阶段将 CoreMotion 链接到您的项目： ![核心运动](https://i.stack.imgur.com/MuLgk.png)
2.  在您的视图控制器中：

    ```
    - (BOOL)canBecomeFirstResponder {
        return YES;
    }

    - (void)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event
    {
        if (motion == UIEventSubtypeMotionShake) {
            // Shake detected.
        }
    } 
    ```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-07-12T12:46:34.273

最简单的解决方案是为您的应用程序派生一个新的根窗口：

```
@implementation OMGWindow : UIWindow

- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event {
    if (event.type == UIEventTypeMotion && motion == UIEventSubtypeMotionShake) {
        // via notification or something   
    }
}
@end 
```

然后在您的应用程序委托中：

```
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    self.window = [[OMGWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
    //…
} 
```

如果您使用的是 Storyboard，这可能会比较棘手，我不知道您在应用程序委托中需要的代码。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-02-21T09:30:47.530

只需使用这三种方法即可

```
- (void)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event{
- (void)motionCancelled:(UIEventSubtype)motion withEvent:(UIEvent *)event{
- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event{ 
```

[有关详细信息，您可以在那里](http://www.mindyourcode.com/ios/how-to-detect-shake-motion-gesture-on-you-iphone-or-ipad/)查看完整的示例代码

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-09-10T07:44:21.960

基于第一个答案的 swiftease 版本！

```
override func motionEnded(_ motion: UIEventSubtype, with event: UIEvent?) {
    if ( event?.subtype == .motionShake )
    {
        print("stop shaking me!")
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-01-25T05:53:39.217

在 swift 5 中，您可以通过以下方式捕捉动作并检查

```
override func motionEnded(_ motion: UIEventSubtype, with event: UIEvent?) {
   if motion == .motionShake 
   {
      print("shaking")
   }
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2017-09-15T19:45:23.737

为了在应用范围内启用这个应用程序，我在 UIWindow 上创建了一个类别：

```
@implementation UIWindow (Utils)

- (BOOL)canBecomeFirstResponder
{
    return YES;
}

- (void)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event
{
    if (motion == UIEventSubtypeMotionShake) {
        // Do whatever you want here...
    }
}

@end 
```

# agile - 关于 Scrum 的两个问题

> ID：150447
> 
> 赞同：5
> 
> 时间：2008-09-29T20:15:29.223
> 
> 标签：agile, scrum

我有两个关于 Scrum 的相关问题。

我们公司正在努力实施它，并确保我们跳过了篮球。

这两个问题都是关于“完成意味着完成！”

1) 为已经/有的任务定义“完成”真的很容易 - 明确的测试验收标准 - 完全独立 - 最后由测试人员测试

应该如何处理以下任务： - 架构设计 - 重构 - 一些实用程序类开发

它的主要问题是它几乎完全是内部实体，无法从外部检查/测试它。

作为示例功能实现是一种二进制 - 它已完成（并通过所有测试用例）或未完成（不通过某些测试用例）。

我想到的最好的事情是请另一个开发人员审查该任务。但是，任何方式都没有提供明确的方法来确定它是否完全完成。

那么，问题是您如何为此类内部任务定义“完成”？

2) 调试/错误修复任务

我知道敏捷方法不建议执行大任务。至少如果任务很大，应该将其划分为较小的任务。

假设我们有一些相当大的问题 - 一些大的模块重新设计（用新的架构替换新的过时架构）。当然，这个任务分为几十个小任务。但是，我知道最后我们将进行相当长的调试/修复会话。

我知道这通常是瀑布模型的问题。但是，我认为很难摆脱它（尤其是对于相当大的变化）。

我应该为调试/修复/系统集成等分配特殊任务吗？

在这种情况下，如果我这样做，通常这个任务与其他所有任务相比都是巨大的，而且很难将它划分为较小的任务。

我不喜欢这种方式，因为这个庞大的单体任务。

还有另一种方法。我可以创建较小的任务（与错误相关），将它们放在积压中，确定优先级并将它们添加到活动结束时的迭代中，当我知道错误是什么时。

我不喜欢这种方式，因为在这种情况下，整个估计都会变成假的。我们估计任务，随时将其标记为完成。我们将使用新的估计打开新的错误任务。所以，我们最终会得到实际时间 = 估计时间，这绝对是不好的。

你怎么解决这个问题？

问候，维克多

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T20:20:58.973

对于第一部分“架构设计 - 重构 - 一些实用程序类的开发” 这些永远不会“完成”，因为您可以边做边做。成片。

您想要做的架构刚好足以让第一个版本继续运行。然后，对于下一个版本，更多的架构。

重构是您找到实用程序类的方式（您并不打算创建实用程序类——您在重构期间发现它们）。

重构是您在发布之前根据需要分块执行的操作。或者作为一大块功能的一部分。或者当您在编写测试时遇到问题。或者当您无法通过测试并需要“调试”时。

这些事情的一小部分在项目的整个生命周期中一遍又一遍地完成。它们并不是真正的“发布候选者”，因此它们只是在发布过程中完成的 sprint（或 sprint 的一部分）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T00:30:13.970

听起来您正在模糊用户故事和任务的定义。简单地：

*   用户故事增加了价值。它们是由产品所有者创建的。

*   任务是为创造价值而进行的活动。它们是由工程师创建的。

你指出用户故事的关键部分必须有明确的接受标准，它们是独立的，并且可以测试。

架构、设计、重构和实用程序类开发都是**任务**。它们是为完成用户故事所做的工作。每个开发商店都可以为这些设置不同的标准，但在我们公司，至少有其他开发人员必须查看过代码（结对编程、代码阅读、代码审查）。

如果您有“重构类 X”和“设计功能 Y”的用户故事，那么您就走错了路。在编写代码之前可能需要重构 X 或设计 Y，但这些可能是完成用户故事“创建新登录小部件”所必需的任务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T00:43:40.753

我们在“幕后”代码中遇到了类似的问题。我所说的“幕后”是指没有明显或可测试的商业价值。

在这些情况下，我们决定将那部分代码的开发人员定义为真正的“用户”。通过创建开发人员可以使用和测试的示例应用程序和文档，我们有一些“完成”的代码。

但是，通常使用 scrum，您会寻找一个使用一段代码来确定“完成”的业务功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T20:50:43.100

第三个问题“一些大模块重新设计（用新的架构替换新的过时架构）。当然，这个任务分为几十个小任务。但是，我知道最后我们会有相当长的调试/修复会话。”

每个 sprint 都会创造一些可以发布的东西。也许不会，但可能会。

因此，当您进行重大重新设计时，您必须一次吃一小块大象。首先，看看你可以做、完成和发布的最高价值——最重要的——对用户的最大回报。

但是——你说——没有这么小的一块；在发布任何东西之前，每件作品都需要进行大规模的重新设计。

我不同意。我认为你可以创建一个概念架构——当你完成时它会是什么——但不能一次实现整个事情。相反，您创建临时接口、桥梁、胶水、连接器来完成一个 sprint。

然后修改临时接口、桥接和粘合，以便完成下一个 sprint。

是的，您已经添加了一些代码。但是，您还创建了可以测试和发布的 sprint。完整的 Sprint，任何一个都可以成为候选版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T20:25:14.253

“我应该为调试/修复/系统集成等分配特殊任务吗？”

与您使用瀑布方法所做的方式不同，但实际上没有任何效果。

请记住，您正在逐步构建和测试。每个 sprint 都单独进行测试和调试。

当您获得一个候选版本时，您可能希望对该版本进行一些额外的测试。测试会导致错误发现，从而导致积压。通常这是需要在发布之前修复的高优先级积压工作。

有时集成测试会发现在下一个版本之前不需要修复的低优先级积压问题。

发布测试有多大？不是特别的。您已经测试了每个 sprint...*不应该*有太多的惊喜。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T20:27:11.067

我会争辩说，如果内部活动对应用程序有好处（scrum 中的所有积压项目都应该有），那么好处就实现了。例如，“设计架构”过于笼统，无法识别活动的好处。“用户故事 A 的设计架构”确定了您的活动范围。当您为故事 A 创建架构时，您就完成了该任务。

重构同样应该在实现用户故事的背景下进行。“重构客户类以启用多个电话号码以支持故事 B”是当客户类支持多个电话号码时可以识别为已完成的事情。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T15:28:22.603

对于重构等技术任务，您可以检查重构是否真的完成，例如 call X 不再具有任何 f() 方法，或者不再具有 foobar() 函数。

对团队和团队内部也应该有信任。如果任务真的完成了，为什么要复查？您是否遇到过有人声称某项任务已完成但未完成的情况？

* * *

对于您的第二个问题，您应该首先真正努力将其分解为几个较小的故事（积压项目）。例如，如果您正在重新构建系统，请查看新旧架构是否可以共存，以便将所有组件从一个移植到另一个。

如果这**真的**不可能，那么这应该与其余的 sprint backlog 项目分开完成，而不是在“完成”之前**集成。**如果 sprint 在完成该项目的所有任务之前结束，那么您必须估计剩余的工作量并为下一次迭代重新计划它。

这里有[20 种拆分故事](http://xp123.com/xplor/xp0512/index.shtml)的方法，可以帮助处理几个较小的待办事项，这确实是推荐和最安全的方法。

# perl - 有什么方法可以使变量像 $a 和 $b 关于严格？

> ID：150454
> 
> 赞同：5
> 
> 时间：2008-09-29T20:16:37.893
> 
> 标签：perl, timtowtdi

根据迈克尔卡曼的评论，我决定重写这个问题。请注意，在此编辑之前出现了 11 条评论，并相信迈克尔的观察，即我没有以明确我在问什么的方式编写问题。

* * *

*问题：*通过简单地导入模块来伪造严格的特殊状态的标准或最干净的方法是什么*？*`$a``$b`

首先是一些设置。以下作品：

```
#!/bin/perl
use strict;
print "\$a=$a\n";
print "\$b=$b\n"; 
```

如果我再添加一行：

```
print "\$c=$c\n"; 
```

我在编译时遇到错误，这意味着我的*令人眼花缭乱*的打印代码都无法运行。

如果我注释掉`use strict;`它运行良好。在限制之外，`$a`主要`$b`的特殊之处在于`sort`将两个值与这些名称进行比较。

```
my @reverse_order = sort { $b <=> $a } @unsorted; 
```

因此，关于and的主要*功能*区别——即使 Perl“知道它们的名字”——是你最好在排序时知道这一点，或者使用[List::Util](http://search.cpan.org/module?List::Util)中的一些函数。`$a``$b`

只有当您使用严格时，才会`$a`以`$b`全新的方式成为特殊变量。它们是 strict 唯一会通过而不抱怨它们没有被声明的变量。

*:*现在，我喜欢严格，但令我震惊的是，如果 TIMTOWDI（有不止一种方法可以做到）是 Perl 中的第 1 条规则，那么这不是很 TIMTOWDI。它这么说`$a`并且`$b`很特别，就是这样。如果你想使用变量，你不必声明`$a`并且`$b`是你的人。如果您想通过添加来获得三个变量`$c`，那么突然之间就有了另一种方法可以做到这一点。

没关系，在操作哈希时`$k`可能`$v`更有意义：

```
my %starts_upper_1_to_25 
    = skim { $k =~ m/^\p{IsUpper}/ && ( 1 <= $v && $v <= 25 ) } %my_hash
;` 
```

现在，我使用并且我喜欢严格。但我只想`$k`并且对于最紧凑的语法`$v`是可见的。`skim`我希望它可以简单地通过

```
use Hash::Helper qw<skim>; 
```

我问这个问题不是为了知道如何对它施以魔法。我在下面的“答案”应该让你知道我知道的 Perl 足够危险。我在问是否有办法严格接受其他变量，或者什么是*最干净*的解决方案。答案很可能是否定的。如果是这样的话，它根本就不是很TIMTOWTDI。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T20:34:08.147

其他人提到了如何“使用 vars”和“我们的”——我只是想补充一点，$a 和 $b 是特殊情况，因为它们在内部由排序例程使用。这是来自 strict.pm 文档的注释：

```
Because of their special use by sort(), the variables $a and $b are 
exempted from this check. 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T20:25:09.090

如果我理解正确，你想要的是：

```
use vars qw($a $b); # Pre-5.6 
```

或者

```
our ($a, $b); # 5.6 + 
```

你可以在[这里](http://perldoc.perl.org/vars.html)阅读。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T22:26:49.563

$a 和 $b 很特别，因为它们是核心语言的一部分。虽然我可以理解为什么您可能会说无法创建自己的类似特殊变量是反 TIMTOWTDI，但我会说这只不过是无法按“打印”或“的顺序创建新的基本命令”种类'。（您可以在模块中定义 subs，但这并不能使它们成为真正的关键字。这相当于使用 'our $k'，您似乎是在说 $k 对您来说不够像 $a。）

要将名称推送到其他人的命名空间中，这应该是 Exporter 的一个工作示例：

```
package SpecialK;

use strict;

use base 'Exporter';
BEGIN {
  our @EXPORT = qw( $k );
}

our $k;

1; 
```

将此保存到 SpecialK.pm，然后“使用 SpecialK”应该会为您提供 $k。请注意，只能导出“我们的”变量，不能导出“我的”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T20:35:48.800

在 Perl 5.6 及更高版本中，您可以使用我们的：

```
our ($k, $v); 
```

或者您可以坚持使用较旧的“使用变量”：

```
use vars qw($k $v); 
```

或者你可能只是坚持使用“我的”，例如：

```
my %hash;
my ($k,$v);
while (<>) {
  /^KEY=(.*)/ and $k = $1 and next;
  /^VALUE=(.*)/ and $v = $1;
  $hash{$k} = $v;
  print "$k $v\n";
}

__END__
KEY=a
VALUE=1
KEY=b
VALUE=2 
```

在上面的示例中，创建全局 $v 并不是真正必要的，但希望您明白这一点（另一方面，$k 需要在 while 块之外限定范围）。

或者，您可以使用完全限定的变量名：

```
$main::k="foo";
$main::v="bar";
%main::hash{$k}=$v; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T16:00:07.563

如果我理解您的问题，您想编写一个模块，在用户的命名空间中声明变量（因此他们不必这样做）并在回调中自动本地化。是对的吗？

您可以通过声明全局变量并导出它们来做到这一点。（尽管请注意，在不被要求的情况下导出东西通常被认为是不好的形式。）

```
package Foo;
use strict;
use warnings;

require Exporter;
our @ISA    = qw(Exporter);
our @EXPORT = qw(*k *v hashmap);
our ($k, $v);

sub hashmap(&\%) {
    my $code = shift;
    my $hash = shift;

    while (local ($k, $v) = each %$hash) {
        $code->();
    }
} 
```

**注意：**导出是`*k`and `*v`，而不是`$k`and `$v`。如果您不导出整个 typeglob，则`local`in`hashmap`将无法从用户的包中正常工作。这样做的副作用是*所有*各种形式的`k`and `v`( `%k`, `@v`, 等) 都被声明和别名。有关这方面的完整说明，请参阅[perlmod 中的符号表](http://perldoc.perl.org/perlmod.html#Symbol-Tables)。

然后在你的脚本中：

```
use Foo; # exports $k and $v

my %h = (a => 1, b => 2, c => 3);

hashmap { print "$k => $v\n" } %h;

__END__
c => 3
a => 1
b => 2 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T20:24:41.993

`$a`并且`$b`只是全局变量。您可以通过简单地声明`$k`and来实现类似的效果`$v`：

```
use strict;
our ($k, $v); 
```

（在这种情况下`$k`，并且`$v`不是全局变量，而是包变量的词法范围别名。但如果你不跨越边界，它就足够了。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T22:39:45.507

听起来你想做这样的魔法[`List::MoreUtils`](http://search.cpan.org/~vparseval/List-MoreUtils-0.22/lib/List/MoreUtils.pm)：

```
use strict;
my @a = (1, 2);
my @b = (3, 4);
my @x = pairwise { $a + $b } @a, @b; 
```

我建议只查看[source](http://search.cpan.org/src/VPARSEVAL/List-MoreUtils-0.22/lib/List/MoreUtils.pm)[中](http://search.cpan.org/src/VPARSEVAL/List-MoreUtils-0.22/lib/List/MoreUtils.pm)`pairwise`的sub 。它使用一些巧妙的符号表摆弄来注入并进入调用者的命名空间，然后将它们本地化到子主体内。我认为。[`List::MoreUtils`](http://search.cpan.org/src/VPARSEVAL/List-MoreUtils-0.22/lib/List/MoreUtils.pm)`$a``$b`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T22:40:17.063

这对我有用：

```
package Special;
use base qw<Exporter>;
# use staging; -> commented out, my module for development
our $c;

our @EXPORT = qw<manip_c>;

sub import { 
    *{caller().'::c'} = *c;
    my $import_sub    = Exporter->can( 'import' );
    goto &$import_sub;
 } 
```

它也通过严格的 $c 传递。

```
package main;
use feature 'say';
use strict;
use Special;
use strict;
say "In main: \$c=$c";

manip_c( 'f', sub {
    say "In anon sub: \$c=$c\n"; # In anon sub: $c=f
});

say "In main: \$c=$c"; 
```

是的，我用“use strict”括起来我的模块有点愚蠢，但我不知道内部原理，这会解决潜在的排序问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T23:36:50.220

这是你的追求吗？......

```
use strict;
use warnings;
use feature qw/say/;

sub hash_baz (&@) {
    my $code   = shift;  
    my $caller = caller;
    my %hash   = (); 
    use vars qw($k $v);

    no strict 'refs';
    local *{ $caller . '::k' } = \my $k;
    local *{ $caller . '::v' } = \my $v;

    while ( @_ ) {
        $k = shift;
        $v = shift;
        $hash{ $k } = $code->() || $v;
    }

    return %hash;
}

my %hash = ( 
    blue_cat   => 'blue', 
    purple_dog => 'purple', 
    ginger_cat => 'ginger', 
    purple_cat => 'purple' );

my %new_hash = hash_baz { uc $v if $k =~ m/purple/ } %hash;

say "@{[ %new_hash ]}";

# =>  purple_dog PURPLE ginger_cat ginger purple_cat PURPLE blue_cat blue 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T13:04:59.280

我不确定是否有人澄清了这一点，但 strict 不会将 $a 和 $b 列入白名单，因为它们是您在自己的例程中使用的非常方便的变量名。$a 和 $b 对于排序运算符具有特殊含义。从这种排序例程的角度来看，这是好的，但从外部来看，这是一种糟糕的设计。:) 如果你是的话，你不应该在其他情况下使用 $a 和 $b 。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T00:26:18.533

但是，$a 和 $b 不是普通变量，并且不能通过词法声明或显式导出或弄乱符号表来轻松复制。例如，将调试器用作 shell：

```
 DB<1> @foo = sort { $b cmp $a } qw(foo bar baz wibble);

  DB<2> x @foo
0  'wibble'
1  'foo'
2  'baz'
3  'bar'
 DB<3> x $a
0  undef
  DB<4> x $b
0  undef 
```

$a 和 $b 仅存在于传递给 sort() 的块中，之后不存在，并且具有任何进一步的 sort 调用都不会影响它们的范围。

要复制它，您可能需要开始弄乱源过滤器，以转换您喜欢的符号

```
my %starts_upper_1_to_25 
    = skim { $k =~ m/^\p{IsUpper}/ && ( 1 <= $v && $v <= 25 ) } %my_hash
; 
```

有效地进入

```
my %starts_upper_1_to_25
    = map { my $k = $_; my $v = $my_hash{$v};
            $k =~ m/^\p{IsUpper}/ && ( 1 <= $v && $v <=> 25 ) } keys %my_hash
; 
```

$a 和 $b 与 $_ 和 @_ 一样特殊，虽然在 Perl 5 中没有简单的方法可以更改这些名称，但 Perl 6 确实使用给定的关键字解决了这个问题。“给定”是一个垃圾词，可以搜索，但[http://dev.perl.org/perl6/doc/design/syn/S03.html](http://dev.perl.org/perl6/doc/design/syn/S03.html)可能是一个不错的起点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-02T06:44:27.040

建议使用 export 的模块实际上与`use vars`. 但是`use vars`需要在每个使用 $a-like 变量的包中完成。并且`our()`需要在每个外部范围内完成。

请注意，您甚至可以通过使用 $$-prototyped sub 来避免使用 $a 和 $b 进行排序：

```
sub lccmp($$) { lc($_[0]) cmp lc($_[1]) }
print join ' ', sort lccmp
   qw/I met this guy and he looked like he might have been a hat-check clerk/; 
```

当在与排序调用不同的包中使用比较例程时，这是必不可少的。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-09-29T20:53:58.927

**编辑**- 这实际上是**不正确**的，请参阅评论。把它留在这里让其他人有机会从我的错误中学习:)

* * *

哦，您问的是模块是否可以在 CALLER 的命名空间中声明 $k 和 $v？您可以使用 Exporter 将变量推送给调用者：

```
use strict;

package Test; 
use Exporter;

my @ISA = qw/Exporter/; 
my $c = 3; 
my @EXPORT = qw/$c/; 

package main; 
print $c; 
```

# point-of-sale - 与 Compris POS 接口

> ID：150457
> 
> 赞同：0
> 
> 时间：2008-09-29T20:16:52.463
> 
> 标签：point-of-sale, ncr

有没有人有关于如何与 Compris POS 交互的数据？我有一个 Compris POS，我需要从数据库中获取数据。我无法从 NCR 获得有关底层数据格式的信息，我想知道是否有人对设备进行了逆向工程，或者在设备上有任何文档。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-03T15:55:08.157

什么样的数据库？能发一下结构吗？

我与一家 POS 软件公司合作，我很确定我可以很容易地解构它......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-02T14:28:02.390

您可能已经拥有各种工具，例如 pludump.exe、prtme.exe 等，它们可以提供文本提取。然后可以将这些导入 Excel。

# c# - DataGridView 的绑定表在双击时只生成一个 RowChanged 事件。我如何让它做两个？

> ID：150471
> 
> 赞同：4
> 
> 时间：2008-09-29T20:20:44.607
> 
> 标签：c#, .net, datagridview, datatable, double-click

我有一个 DataGridView，它的 DataSource 是一个 DataTable。此 DataTable 有一个布尔列，它被解释为 DataGridView 中的一个复选框。

```
employeeSelectionTable.Columns.Add("IsSelected", typeof(bool));
...
employeeSelectionTable.RowChanged += selectionTableRowChanged;
dataGridViewSelectedEmployees.DataSource = employeeSelectionTable;

...

private void selectionTableRowChanged(object sender, DataRowChangeEventArgs e)
{
    if ((bool)e.Row["IsSelected"])
    {
        Console.Writeline("Is Selected");
    }
    else
    {
        Console.Writeline("Is Not Selected");
    }
    break;
} 
```

当用户单击一个复选框时，它会被选中，并且 selectionTableRowChanged 将输出“Is Selected”。

同样，当用户再次检查时，该框被清除，并且 selectionTableRowChanged 输出“未选中”。

这是我遇到问题的地方：

当用户双击复选框时，复选框被选中，RowChanged 事件被调用（“Is Selected”），然后复选框被清除，不会调用相应的 RowChanged 事件。现在 RowChanged 事件的订阅者不同步。

我现在的解决方案是继承 DataGridView 并覆盖 WndProc 以吃掉 WM_LBUTTONDBLCLICK，因此任何双击控件都会被忽略。有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T21:52:51.920

制作一个空的 DoubleClick 事件方法无济于事的原因是，它是在发生双击时发生的其他操作之外执行的。

如果您查看 Windows 生成的代码或以编程方式添加事件处理程序的示例，您可以使用 += 来分配事件处理程序。这意味着除了已经存在的其他事件处理程序之外，您还添加了该事件处理程序，您可以在保存事件上触发多个事件处理程序。

我的直觉是重写 DataGridView 类，然后重写 OnDoubleClick 方法而不调用基本 OnDoubleClick 方法。

但是，我已经快速测试了这个，并且看到了一些有趣的结果。

我整理了以下测试类：

```
using System;
using System.Windows.Forms;

namespace TestApp
{
    class DGV : DataGridView
    {
        private string test = "";

        protected override void OnDoubleClick(EventArgs e)
        {
            MessageBox.Show(test + "OnDoubleClick");
        }

        protected override void OnCellMouseDoubleClick(System.Windows.Forms.DataGridViewCellMouseEventArgs e)
        {
            MessageBox.Show(test + "OnCellMouseDoubleClick");
        }

        protected override void OnCellMouseClick(System.Windows.Forms.DataGridViewCellMouseEventArgs e)
        {
            if (e.Clicks == 1)
            {
                // Had to do this with a variable as using a MessageBox
                // here would block us from pulling off a double click
                test = "1 click ";
                base.OnCellMouseClick(e);
            }
            else
            {
                MessageBox.Show("OnCellMouseClick");
            }
        }
    }
} 
```

然后将其插入到 Windows 窗体中，添加一个复选框列并运行该程序。

在重新运行时，双击复选框会导致消息框显示显示“1 单击 OnDoubleClick”。

这意味着 OnCellMouseClick 在双击的第一部分执行，然后 OnD​​oubleClick 在第二次单击时执行。

此外，不幸的是，删除对基本方法的调用似乎并没有阻止复选框将点击传递给它。

我怀疑要使这种方法起作用，可能必须采取进一步措施并覆盖忽略双击的 DataGridViewCheckBoxColumn 和 DataGridViewCheckBoxCell 。假设这可行，您将能够停止双击该复选框，但仍允许它在您的其他列控件上。

[我已经发布了关于在此处](https://stackoverflow.com/questions/121274/is-it-possible-to-bind-complex-type-properties-to-a-datagrid#128909)创建自定义 DataGridView 列和单元格的另一个问题的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-01T17:19:36.463

这并不完全是一个优雅的解决方案，但为什么不简单地执行以下操作呢？

```
private void dgv_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
{
    dgv_CellClick(sender, e);
} 
```

这将明确强制第二个 CellClick 事件并避免不同步。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-18T11:15:28.730

如果您想要 DataGridView 中的复选框列，请创建如下内容：

```
DataGridViewCheckBoxCell checkBoxCell = new MyDataGridViewCheckBoxCell();
...
DataGridViewColumn col = new DataGridViewColumn(checkBoxCell);
...
col.Name = "colCheckBox";
...
this.dgItems.Columns.Add(col); 
```

其中 dgItems 是 DataGridView 实例。

如您所见，我有一个 MyDataGridViewCheckBoxCell 类，它是 DataGridViewCheckBoxCell 类的子类。在这个子类中，我定义：

```
protected override void OnContentDoubleClick(DataGridViewCellEventArgs e)
{
    //This the trick to keep the checkbox in sync with other actions.
    //base.OnContentDoubleClick(e);
} 
```

当用户现在双击复选框列中的复选框时，复选框的行为就像是单击了一样。这应该可以解决您的同步问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T20:37:01.277

我已经尝试覆盖 DataGridView 子类中的 OnDoubleClick 方法以不执行任何操作，但它仍然允许第二次更改复选框。

理想情况下，我希望 DataTable 的 RowChanged 事件被调用两次。有没有办法通过重写的 OnDoubleClick 方法影响基础 DataTable？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T20:43:04.180

为什么不让 IsSelected 列无界？使用 CellContentClick 事件将数据推送到底层数据表，并单独保留 CellDoubleClick 或 RowChange 事件。

```
private void dgv_CellContentClick(object sender, DataGridViewCellEventArgs e)
{
  if(e.ColumnIndex == <columnIndex of IsSelected>)
  {
      string value = dgv[e.ColumnIndex, e.RowIndex].EditedFormattedValue;
       if( value == null || Convert.ToBoolean(value) == false)
          {
              //push false to employeeSelectionTable
          }
      else
          {
            //push true to employeeSelectionTable
          }

  }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T20:24:26.737

有什么理由需要做那么低的水平吗？DoubleClick 方法可以只是一个吃掉它的空方法吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-04T19:33:33.380

不知道为什么我必须这样做，但我能够将一个计时器滴答事件附加到一个 datagridview 刷新上，该刷新在第二次点击后刚刚刷新了 dgv。

在单元格点击事件中

```
**          _RefreshTimer = new Timer();
                _RefreshTimer.Tick += new EventHandler(RefreshTimer_Tick);
                _RefreshTimer.Interval = 100;
                _RefreshTimer.Start();

            }
        }

    }

    void RefreshTimer_Tick(object sender, EventArgs e)
    {
        dgv.Refresh();
        _RefreshTimer.Stop();
        _RefreshTimer = null;
    }** 
```

# c# - 类中项目的顺序：字段、属性、构造函数、方法

> ID：150479
> 
> 赞同：737
> 
> 时间：2008-09-29T20:23:21.793
> 
> 标签：c#, .net, coding-style, code-cleanup, code-structure

在类结构方面是否有关于项目顺序的官方 C# 指南？

它去吗：

*   公共领域
*   私有字段
*   特性
*   构造函数
*   方法
    ？

我很好奇是否有关于物品顺序的硬性规定？我有点到处都是。我想坚持一个特定的标准，这样我就可以在任何地方做到这一点。

真正的问题是我的更复杂的属性最终看起来很像方法，并且它们在构造函数之前的顶部感觉不合适。

任何提示/建议？

* * *

## 回答 #1

> 赞同：1149
> 
> 时间：2008-11-22T06:41:49.557

根据[StyleCop 规则文档](https://github.com/DotNetAnalyzers/StyleCopAnalyzers/blob/master/documentation/SA1201.md)，排序如下。

在类、结构或接口内：（SA1201 和 SA1203）

*   常量字段
*   字段
*   构造函数
*   终结器（析构函数）
*   代表们
*   活动
*   枚举
*   接口（*接口实现*）
*   特性
*   索引器
*   方法
*   结构
*   课程

在每个组中按访问顺序排列：（SA1202）

*   上市
*   内部的
*   受保护的内部
*   受保护
*   私人的

在每个访问组中，按静态排序，然后按非静态排序：(SA1204)

*   静止的
*   非静态

在每个静态/非静态字段组中，按只读排序，然后是非只读：（SA1214 和 SA1215）

*   只读
*   非只读

展开的列表有 130 行长，所以我不会在这里展开。展开的方法部分是：

*   公共静态方法
*   公共方法
*   内部静态方法
*   内部方法
*   受保护的内部静态方法
*   受保护的内部方法
*   受保护的静态方法
*   受保护的方法
*   私有静态方法
*   私有方法

文档指出，如果规定的顺序不合适——例如，正在实现多个接口，并且接口方法和属性应该组合在一起——然后使用分部类将相关的方法和属性组合在一起。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-29T20:30:43.913

与其按可见性或按项目类型（字段、属性、方法等）进行分组，不如按功能分组？

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2015-01-17T09:00:20.317

这是一个古老但仍然非常相关的问题，所以我将添加以下内容：当您打开一个您以前可能读过或可能没有读过的类文件时，您首先要查找的是什么？领域？特性？我从经验中意识到，我几乎总是在寻找构造函数，因为要了解的最基本的事情是这个对象是如何构造的。

因此，我开始将构造函数放在类文件中，结果在心理上是非常积极的。将构造函数放在一堆其他东西之后的标准建议感觉不和谐。

C# 6 中即将推出的主构造函数特性证明了构造函数的自然位置是在类的最顶端 - 事实上，主构造函数甚至在左大括号之前就已指定。

有趣的是，像这样的重新排序会产生多大的不同。它让我想起了过去是如何`using`对语句进行排序的——首先是 System 命名空间。Visual Studio 的“组织使用”命令使用此顺序。现在`using`s 只是按字母顺序排列，没有对 System 命名空间进行特殊处理。结果只是感觉更简单，更干净。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-29T20:30:02.417

我不了解语言或行业标准，但我倾向于按此顺序排列，每个部分都包含在#region 中：

使用语句

命名空间

班级

私人会员

公共财产

构造函数

公共方法

私有方法

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-29T20:30:20.777

我建议使用[IDesign的编码标准或](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=0&tabid=1)[Brad Abram 网站](http://blogs.msdn.com/brada/articles/361363.aspx)上列出的标准。这是我找到的最好的两个。

布拉德会说...

> 类成员应按字母顺序排列，并分组为部分（字段、构造函数、属性、事件、方法、私有接口实现、嵌套类型）

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-29T20:40:13.937

通常我会尝试遵循下一个模式：

*   静态成员（通常具有其他上下文，必须是线程安全的，等等）
*   实例成员

每个部分（静态和实例）由以下成员类型组成：

*   运算符（始终是静态的）
*   字段（在构造函数之前初始化）
*   构造函数
*   析构函数（*是遵循构造函数的传统*）
*   特性
*   方法
*   事件

然后成员按可见性排序（从少到多可见）：

*   私人的
*   内部的
*   内部保护
*   受保护
*   上市

**顺序不是教条：简单的类更容易阅读，然而，更复杂的类需要特定于上下文的分组。**

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-29T20:31:18.310

如前所述，C# 语言中没有任何内容规定布局，我个人使用区域，并且我为普通班级做类似的事情。

```
public class myClass
{
#region Private Members

#endregion
#region Public Properties

#endregion

#region Constructors

#endregion
#region Public Methods

#endregion
} 
```

无论如何，这对我来说很有意义

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-12-18T14:00:03.123

我的偏好是按种类订购，然后按如下方式降低知名度

```
public methods
public events
public properties

protected methods
protected events
protected properties

private methods
private events
private properties
private fields

public delegates
public interfaces
public classes
public structs

protected delegates
protected interfaces
protected classes
protected structs

private delegates
private interfaces
private classes
private structs 
```

我知道这违反了 Style Cop，如果有人能给我一个很好的理由，为什么我应该将类型的实现细节放在它的接口之前，我愿意改变。目前，我强烈倾向于将私人会员放在最后。

注意：我不使用公共或受保护字段。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-29T20:30:53.490

来自 StyleCop

私有字段、公共字段、构造函数、属性、公共方法、私有方法

由于 StyleCop 是 MS 构建过程的一部分，您可以将其视为事实上的标准

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-29T20:29:33.620

您可能找到的最接近的是Brad Abrams的“设计指南、托管代码和 .NET 框架”（ [http://blogs.msdn.com/brada/articles/361363.aspx ）](http://blogs.msdn.com/brada/articles/361363.aspx)

这里列出了许多标准。我认为相关部分是2.8。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-29T20:36:05.927

我更喜欢将私有字段与构造函数一起放在顶部，然后将公共接口位放在后面，然后是私有接口位。

此外，如果您的类定义足够长以至于项目的排序很重要，那可能是[代码异味](https://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them)，表明您的类过于庞大和复杂，您应该重构。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-29T20:42:22.153

我尽可能简单（至少对我来说）

枚举
声明
构造函数
覆盖
方法
属性
事件处理程序

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-12-07T07:08:16.247

我知道这是旧的，但我的订单如下：

按照公共、受保护、私有、内部、抽象的顺序

*   常数
*   静态变量
*   字段
*   活动
*   构造函数
*   方法
*   特性
*   代表们

我也喜欢写出这样的属性（而不是速记方法）

```
// Some where in the fields section
private int someVariable;

// I also refrain from
// declaring variables outside of the constructor

// and some where in the properties section I do
public int SomeVariable
{
    get { return someVariable; }
    set { someVariable = value; }
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-29T20:29:28.253

我见过的唯一建议的编码准则是将字段放在类定义的顶部。

我倾向于将构造函数放在下一个。

我的一般意见是你应该坚持每个文件一个类，如果类足够大以至于属性与方法的组织是一个大问题，那么类有多大，你是否应该重构它？它是否代表了多重关注？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-29T20:26:38.790

语言中当然没有任何东西可以以任何方式强制执行它。我倾向于按可见性（公共，然后受保护，然后是私有）对事物进行分组，并使用#regions 在功能上对相关事物进行分组，无论它是属性、方法还是其他。构造方法（无论是实际的 ctor 还是静态工厂函数）通常都位于顶部，因为它们是客户需要了解的第一件事。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-12-01T09:53:49.250

关于我认为更好的布局，我已经重组了接受的答案：

在类、结构或接口中：

*   常量字段
*   只读字段
*   字段
*   活动
*   特性
*   索引器
*   构造函数
*   终结器（析构函数）
*   接口（接口实现）
*   方法
*   课程
*   结构
*   枚举
*   代表们

在这些组中的每一个中，按访问顺序排列：

*   上市
*   内部的
*   受保护的内部
*   受保护
*   私人的

在每个访问组中，按静态排序，然后按非静态排序：

*   静止的
*   非静态

我也觉得嵌套类型应该保持在最低限度。我经常看到人们有嵌套的类、枚举、委托，它们最好是一个单独的实例。使类型嵌套几乎没有任何好处。也将它们放在单独的文件中。一个包含 5 个类的文件让我感觉很混乱。

# .net - 将自动完成添加到 Infragisitcs UltraDateTimeEditor 控件

> ID：150499
> 
> 赞同：0
> 
> 时间：2008-09-29T20:27:53.013
> 
> 标签：.net, winforms, infragistics

我正在尝试修改 Infragisitcs UltraDateTimeEditor 控件，以便在用户仅输入月份和日期的值时插入当前年份和默认时间。

该控件具有 AutoFillDate 属性，但是将其设置为“年份”似乎会完全覆盖用户输入。由于控件开始为空，因此更改 InvalidTextBehavior 似乎也无济于事。

我需要修改哪些事件才能在验证恢复为空字符串之前填充填充数据？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-30T12:05:53.180

原来要处理的事件是“BeforeExitEditMode”。我能够在验证器触发之前检查和修改用户输入。

# unix - Slicehost 安装配置文件

> ID：150501
> 
> 赞同：3
> 
> 时间：2008-09-29T20:28:13.247
> 
> 标签：unix, server-configuration, slicehost

我不是 UNIX Guru，但我不得不为各种 Web 项目设置一些切片。我已经使用那里的文章来设置用户、基本防火墙、nginx 或 apache，以及基本 Web 服务器的其他零碎部分。

我预计未来会有更多的切片管理。**有没有比手动配置更有效的方法来在干净的切片上设置用户、权限和软件？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T23:01:17.780

听起来您可以从现有切片的备份中创建一个新切片。如果切片大小不同、发行版不同等，这可能对您不起作用。他们的论坛提到这一点：[克隆切片？](http://forum.slicehost.com/comments.php?DiscussionID=1902)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T22:52:55.740

根据机器的数量，您可能会发现使用 CFEngine 或 Puppet 之类的东西来配置新安装是有意义的。

这将您的工作归结为将每台新机器配置为 CFEngine，例如客户端。然后可用于安装包、编辑文件等。

我写了几篇关于这个主题的文章，带有 Debian 的偏见，在这里：

[http://www.debian-administration.org/tag/cfengine](http://www.debian-administration.org/tag/cfengine)

# django - Capturing URL parameters in request.GET

> ID：150505
> 
> 赞同：562
> 
> 时间：2008-09-29T20:29:55.223
> 
> 标签：django, url, rest

I am currently defining regular expressions in order to capture parameters in a URL, as described in the tutorial. How do I access parameters from the URL as part the `HttpRequest` object?

My `HttpRequest.GET` currently returns an empty `QueryDict` object.

I'd like to learn how to do this without a library, so I can get to know Django better.

* * *

## 回答 #1

> 赞同：785
> 
> 时间：2008-09-29T20:31:43.347

When a URL is like `domain/search/?q=haha`, you would use `request.GET.get('q', '')`.

`q` is the parameter you want, and `''` is the default value if `q` isn't found.

However, if you are instead just configuring your `URLconf`**, then your captures from the `regex` are passed to the function as arguments (or named arguments).

Such as:

```
(r'^user/(?P<username>\w{0,50})/$', views.profile_page,), 
```

Then in your `views.py` you would have

```
def profile_page(request, username):
    # Rest of the method 
```

* * *

## 回答 #2

> 赞同：406
> 
> 时间：2008-10-01T12:11:50.007

To clarify [camflan](https://stackoverflow.com/users/22445/camflan)'s [explanation](https://stackoverflow.com/a/150518/11573842), let's suppose you have

*   the rule `url(regex=r'^user/(?P<username>\w{1,50})/$', view='views.profile_page')`
*   an incoming request for `http://domain/user/thaiyoshi/?message=Hi`

The URL dispatcher rule will catch parts of the URL *path* (here `"user/thaiyoshi/"`) and pass them to the view function along with the request object.

The query string (here `message=Hi`) is parsed and parameters are stored as a `QueryDict` in `request.GET`. No further matching or processing for HTTP GET parameters is done.

This view function would use both parts extracted from the URL path and a query parameter:

```
def profile_page(request, username=None):
    user = User.objects.get(username=username)
    message = request.GET.get('message') 
```

As a side note, you'll find the request method (in this case `"GET"`, and for submitted forms usually `"POST"`) in `request.method`. In some cases, it's useful to check that it matches what you're expecting.

**Update:** When deciding whether to use the URL path or the query parameters for passing information, the following may help:

*   use the URL path for uniquely identifying resources, e.g. `/blog/post/15/` (not `/blog/posts/?id=15`)
*   use query parameters for changing the way the resource is displayed, e.g. `/blog/post/15/?show_comments=1` or `/blog/posts/2008/?sort_by=date&direction=desc`
*   to make human-friendly URLs, avoid using ID numbers and use e.g. dates, categories, and/or slugs: `/blog/post/2008/09/30/django-urls/`

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2015-01-21T08:08:50.760

Using GET

```
request.GET["id"] 
```

Using POST

```
request.POST["id"] 
```

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2018-06-06T07:20:42.870

Someone would wonder how to set path in file *urls.py*, such as

```
domain/search/?q=CA 
```

so that we could invoke query.

The fact is that it is *not* necessary to set such a route in file *urls.py*. You need to set just the route in *urls.py*:

```
urlpatterns = [
    path('domain/search/', views.CityListView.as_view()),
] 
```

And when you input http://servername:port/domain/search/?q=CA. The query part '?q=CA' will be automatically reserved in the hash table which you can reference though

```
request.GET.get('q', None). 
```

Here is an example (file *views.py*)

```
class CityListView(generics.ListAPIView):
    serializer_class = CityNameSerializer

    def get_queryset(self):
        if self.request.method == 'GET':
            queryset = City.objects.all()
            state_name = self.request.GET.get('q', None)
            if state_name is not None:
                queryset = queryset.filter(state__name=state_name)
            return queryset 
```

In addition, when you write query string in the URL:

```
http://servername:port/domain/search/?q=CA 
```

Do not wrap query string in quotes. For example,

```
http://servername:port/domain/search/?q="CA" 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2010-11-18T18:40:02.590

```
def some_view(request, *args, **kwargs):
    if kwargs.get('q', None):
        # Do something here .. 
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2017-05-05T13:54:15.410

For situations where you only have the `request` object you can use `request.parser_context['kwargs']['your_param']`

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2017-10-04T12:05:31.223

You have two common ways to do that in case your URL looks like that:

```
https://domain/method/?a=x&b=y 
```

Version 1:

If a specific key is mandatory you can use:

```
key_a = request.GET['a'] 
```

This will return a value of `a` if the key exists and an *exception* if not.

Version 2:

If your keys are optional:

```
request.GET.get('a') 
```

You can try that without any argument and this will not crash. So you can wrap it with `try: except:` and return `HttpResponseBadRequest()` in example. This is a simple way to make your code less complex, without using special exceptions handling.

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2013-02-05T02:05:25.607

I would like to share a tip that may save you some time.
If you plan to use something like this in your `urls.py` file:

```
url(r'^(?P<username>\w+)/$', views.profile_page,), 
```

Which basically means `www.example.com/<username>`. Be sure to place it at the end of your URL entries, because otherwise, it is prone to cause conflicts with the URL entries that follow below, i.e. accessing one of them **will** give you the nice error: `User matching query does not exist.`

I've just experienced it myself; hope it helps!

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2019-07-22T14:35:33.747

These queries are currently done in two ways. If you want to access the query parameters (GET) you can query the following:

```
http://myserver:port/resource/?status=1 
```

```
request.query_params.get('status', None) => 1 
```

If you want to access the parameters passed by POST, you need to access this way:

```
request.data.get('role', None) 
```

Accessing the dictionary (QueryDict) with 'get()', you can set a default value. In the cases above, if 'status' or 'role' are not informed, the values ​​are None.

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-09-30T09:19:21.723

This is not exactly what you asked for, but [this snippet](http://www.djangosnippets.org/snippets/826/) is helpful for managing `query_strings` in `templates`.

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2020-08-15T05:58:03.220

If you only have access to the view object, then you can get the parameters defined in the URL path this way:

```
view.kwargs.get('url_param') 
```

If you only have access to the request object, use the following:

```
request.resolver_match.kwargs.get('url_param') 
```

Tested on Django 3.

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2021-01-11T12:15:35.013

If you don't know the name of params and want to work with them all, you can use `request.GET.keys()` or `dict(request.GET)` functions

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2020-03-27T18:38:00.813

This is another alternate solution that can be implemented:

In the URL configuration:

```
urlpatterns = [path('runreport/<str:queryparams>', views.get)] 
```

In the views:

```
list2 = queryparams.split("&") 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2020-10-04T22:03:16.533

You might as well check request.META dictionary to access many useful things like PATH_INFO, QUERY_STRING

```
# for example
request.META['QUERY_STRING']

# or to avoid any exceptions provide a fallback

request.META.get('QUERY_STRING', False) 
```

you said that it returns empty query dict

I think you need to tune your url to accept required or optional args or kwargs Django got you all the power you need with regrex like:

```
url(r'^project_config/(?P<product>\w+)/$', views.foo), 
```

more about this at [django-optional-url-parameters](https://stackoverflow.com/questions/14351048/django-optional-url-parameters#answer-14351174)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-08-18T09:35:04.643

### views.py

 **```
from rest_framework.response import Response

def update_product(request, pk):
    return Response({"pk":pk}) 
```** 

**pk** means **primary_key**.

### urls.py

 **```
from products.views import update_product
from django.urls import path

urlpatterns = [
    ...,
    path('update/products/<int:pk>', update_product)
] 
```** 

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-03-03T03:42:02.047

url parameters may be captured by `request.query_params`

# c# - 获取可用的 Windows 音频文件格式列表

> ID：150509
> 
> 赞同：2
> 
> 时间：2008-09-29T20:30:36.470
> 
> 标签：c#, windows, audio

我有一个应该播放音频文件的 C# 程序。我已经弄清楚如何使用 DirectShow 播放 Windows 具有编解码器的任何声音文件，但现在我想正确填写“打开”对话框上的文件类型过滤器框。我想自动列出 Windows 具有编解码器的任何文件格式。如果某个随机用户安装了一个晦涩格式的编解码器，则其相关的扩展名和文件类型描述需要显示在列表中。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T20:40:58.660

如果我没记错的话，编解码器不知道它支持哪些文件类型，即文件扩展名，因为编解码器将一些流作为输入，而不是实际的文件。因此，如果您想要显示支持的音频文件格式的文件扩展名，除非您拥有大量文件扩展名和相关编解码器的列表，否则您很可能会不走运，但即便如此，您也会遇到容器问题格式等等。

例如，我的 Windows Media Player 可以愉快地播放 m4b 文件，但对它们一无所知。我必须手动将它与文件类型相关联。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-19T20:40:12.953

您可以使用[NAudio](http://www.codeplex.com/naudio)开源 .NET 音频库来枚举系统上安装的所有 ACM 编解码器。看看`AcmDriver`课堂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T06:53:14.960

只需使用 mm 编解码器 api。永远不要使用注册表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T02:29:53.643

您可以在 Windows 注册表中查找内容类型为“audio/*”的所有文件类型。具体来说，查看 HKCR/Software/*/Content Type 下的所有键。

# html - 隐藏框但显示内容的 HTML 输入样式

> ID：150513
> 
> 赞同：4
> 
> 时间：2008-09-29T20:30:54.193
> 
> 标签：html, css, printing

我有一个 HTML 表单，我们的用户在其中填写数据然后打印。数据没有保存在任何地方。这些表格来自我们公司外部，并被构建为 html 页面，以尽可能与原始页面相似，然后被塞进内部网的文件夹中并被遗忘。通常另一个开发人员会做，但我必须在他不在的时候做一些。查看他的代码，他的所有表单都有一堆服务器端代码来获取输入并仅使用内容重新编写页面。似乎应该有更好的方法。

我只想使用媒体选择器设置文本输入的样式，以便在打印时您可以看到文本，但没有看到围绕它的框。有什么想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T20:38:55.873

通过执行以下操作添加单独的 CSS 文件进行打印：

```
<link rel="stylsheet" type="text/css" media="print" href="print.css"> 
```

将其添加到`<head>`页面的部分。

在此（print.css）文件中包含与您希望在打印页面时看到的内容相关的样式，例如：

`input{border: 0px}`打印时应隐藏输入框的边框。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T20:36:50.823

假设您只想从文本中删除边框等，您需要给它们一个类。也许是这样的：

```
<input type="text" class="print-clean" .../> 
```

和 css，加载了 media="print"：

```
<link rel="stylesheet" type="text/css" media="print" href="/css/print.css" /> 
```

将包含如下内容：

```
.print-clean {
    border: none;
    background: transparent;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T20:33:35.293

```
<input type="text" style="border: 0; background-color: #fff;" /> 
```

#fff 是您的背景颜色在哪里..

# ruby-on-rails - 模型中用于返回对象的自定义方法

> ID：150514
> 
> 赞同：1
> 
> 时间：2008-09-29T20:31:02.680
> 
> 标签：ruby-on-rails, ruby

在数据库中，我有一个名为“body”的字段，其中包含一个 XML。我在模型中创建的方法如下所示：

```
def self.get_personal_data_module(person_id) 
    person_module = find_by_person_id(person_id) 
    item_module = Hpricot(person_module.body) 
    personal_info = Array.new 
    personal_info = {:studies => (item_module/"studies").inner_html, 
                            :birth_place => (item_module/"birth_place").inner_html, 
                            :marrital_status => (item_module/"marrital_status").inner_html} 
    return personal_info 
end 
```

我希望函数返回一个对象而不是数组。所以我可以使用 Module.studies 而不是 Model[:studies]。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T20:50:31.197

这个比较简单；你得到一个数组，因为代码正在构建一个。如果你想返回一个对象，你会做这样的事情：

```
class PersonalData
  attr_accessor :studies
  attr_accessor :birth_place
  attr_accessor :marital_status

  def initialize(studies,birth_place,marital_status)
    @studies = studies
    @birth_place = birth_place
    @marital_status = marital_status
  end
end 
```

您的翻译代码如下所示：

```
def self.get_personal_data_module(person_id) 
  person_module = find_by_person_id(person_id) 
  item_module = Hpricot(person_module.body) 
  personal_info = PersonalData.new((item_module/"studies").inner_html,
                                   (item_module/"birth_place").inner_html,
                                   (item_module/"marital_status").innner_html)
  return personal_info 
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T03:18:35.007

或者，如果你想避免一个模型类，你可以做一些奇怪的事情：

```
class Hash
  def to_obj
    self.inject(Object.new) do |obj, ary| # ary is [:key, "value"]
      obj.instance_variable_set("@#{ary[0]}", ary[1])
      class << obj; self; end.instance_eval do # do this on obj's metaclass
        attr_reader ary[0].to_sym # add getter method for this ivar
      end
      obj # return obj for next iteration
    end
  end
end 
```

然后：

```
h = {:foo => "bar", :baz => "wibble"}
o = h.to_obj # => #<Object:0x30bf38 @foo="bar", @baz="wibble">
o.foo # => "bar"
o.baz # => "wibble" 
```

就像魔术一样！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T07:09:27.737

略有不同。

从 OO 的角度来看，使用类方法来执行此操作的想法是错误的。

您真的应该重构它，以便它可以从实例方法中工作。

```
  def 个人数据模块
    item_module = Hpricot(body)
    {
      :studies => (item_module/"studies").inner_html,
      :birth_place => (item_module/"birth_place").inner_html,
      :marrital_status => (item_module/"marrital_status").inner_html
    }
  结尾

```

然后，你需要在哪里使用它，而不是做......

```
Foobar.get_personal_data_module(the_id)

```

你会做的

```
Foobar.find_by_person_id(the_id).personal_data_module

```

这看起来更糟，但实际上，这有点人为，通常，您会从其他对象引用它，实际上您将在 person 对象上有一个“句柄”，因此不必自己构造它。

例如，如果您有另一个类，您将 person_id 作为外键引用，您将拥有

class Organization belongs_to :person end

然后，你有组织的地方，你可以去

```
组织.person.personal_information_module

```

是的，我知道，这会破坏 demeter，所以最好将它包装在代表中

```
班级组织
  归属于：人

  def 个人信息模块
    person.personal_info_module
  结尾
结尾

```

然后从控制器代码中，你可以说

```
组织.personal_info_module

```

完全不用担心它来自哪里。

这是因为“personal_data_module”实际上是该类的属性，而不是通过类方法访问的东西。

但是这也带来了一些问题，比如person_id是这个表的主键吗？这是表的主键不称为“id”的遗留情况吗？

如果是这种情况，您是否将此事告诉了 ActiveRecord，或者您是否必须在您真正想写“find”的地方使用“find_by_person_id”？

# python - 使用 POST 从 Python 脚本发送文件

> ID：150517
> 
> 赞同：7
> 
> 时间：2008-09-29T20:31:37.840
> 
> 标签：python, encoding, post

这几乎是[使用 Python 脚本中的 POST 发送文件](https://stackoverflow.com/questions/68477/send-file-using-post-from-a-python-script)的重复，但我想补充一点：我需要一些能够正确处理字段和附加文件的编码的东西。当您将包含非 ascii 字符的 unicode 字符串放入混合中时，我能够找到解决方案。此外，大多数解决方案不会对数据进行 base64 编码以保持 7 位干净。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T03:22:48.977

我能想到的最好的事情就是自己编码。这个子程序怎么样？

```
from urllib2 import Request, urlopen
from binascii import b2a_base64

def b64open(url, postdata):
  req = Request(url, b2a_base64(postdata), headers={'Content-Transfer-Encoding': 'base64'})
  return urlopen(req)

conn = b64open("http://www.whatever.com/script.cgi", u"Liberté Égalité Fraternité")
# returns a file-like object 
```

（好的，所以这段代码只是发送 POST 数据。但是您显然想要多部分编码的数据，就好像您单击了“上传文件”按钮一样，对吗？嗯，这是我在这里的内容和来自的答案的一个非常简单的组合你链接的问题。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T03:34:54.063

PyCURL 提供了一个从 Python 到 CURL 的接口。

[http://curl.haxx.se/libcurl/python/](http://curl.haxx.se/libcurl/python/)

卷曲会做你需要的一切。它可以正确传输二进制文件，并支持多种编码。但是，您必须确保在 POST 文件时将正确的字符编码作为自定义标头。

具体来说，您可能需要进行“文件上传”样式的 POST：

[http://curl.haxx.se/docs/httpscripting.html](http://curl.haxx.se/docs/httpscripting.html)（第 4.3 节）

使用 curl（或任何其他 HTTP 客户端），您可能必须设置内容编码：

内容类型：文本/html；字符集=UTF-8

另外，请注意请求标头必须是 ascii，其中包括 url（因此请确保正确转义可能的 unicode URL。HTTP 标头有 unicode 转义）最近在 Python 中修复了此问题：

[http://bugs.python.org/issue3300](http://bugs.python.org/issue3300)

我希望这会有所帮助，有关该主题的更多信息，包括在服务器上设置默认字符集等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-24T10:08:44.317

只需使用这个库并发送文件。

[http://github.com/seisen/urllib2_file/](http://github.com/seisen/urllib2_file/)

# configuration - Restlet - 提供静态内容

> ID：150522
> 
> 赞同：3
> 
> 时间：2008-09-29T20:34:06.290
> 
> 标签：configuration, restlet

使用 Restlet，我需要在与我的 Web 服务相同的上下文中提供一些简单的静态内容。我已经用 . 配置了组件`Directory`，但在测试中，我发现它只会提供 'index.html'，其他一切都会导致 404。

```
router.attach("/", new Directory(context, new Reference(baseRef, "./content")); 
```

所以... [http://service](http://service)和[http://service/index.html](http://service/index.html)都可以工作，

但[http://service/other.html](http://service/other.html)给了我一个 404

任何人都可以对此有所了解吗？我希望 ./content 目录中的任何文件都可用。

PS：我最终计划使用反向代理并从另一台 Web 服务器提供所有静态内容，但现在我需要它按原样工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T21:01:04.527

嗯，我想通了这个问题。实际上 Restlet 似乎基于前缀路由请求，但没有正确处理最长匹配前缀，它似乎也忽略了文件扩展名。

例如，如果我有一个附加到“/other”的资源......和一个位于“/”上的目录。我请求/other.html，实际发生的是我得到了“/other”资源。（扩展名被忽略？），而不是我期望的目录中的静态文件。

如果 aynone 知道这是为什么，或者如何改变它，我很想知道。没什么大不了的，只是为了测试。我认为无论如何我们都会将 apache 或 nginx 放在生产环境的前面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-13T04:19:20.650

Restlet 中的路由器默认使用“Template.MODE_STARTS_WITH”匹配模式。您始终可以通过执行 router.setMatchingMode(Template.MODE_EQUALS) 来设置路由器默认值。默认情况下，这将为附加打开严格匹配。您可以选择使用 setMatchingMode 覆盖单个路由。

[关于 Restlet 路由的好文档](http://wiki.restlet.org/docs_2.0/13-restlet/27-restlet/143-restlet.html)

# python - 如何在 Python 中从文件中读取字节

> ID：150532
> 
> 赞同：8
> 
> 时间：2008-09-29T20:37:34.707
> 
> 标签：python, id3

与[此](https://stackoverflow.com/questions/5415/convert-bytes-to-floating-point-numbers-in-python)问题类似，我正在尝试读取 ID3v2 标记标头，但无法弄清楚如何在 python 中获取单个字节。

我首先将所有十个字节读入一个字符串。然后我想解析出各个信息。

我可以获取字符串中的两个版本号字符，但是我不知道如何获取这两个字符并从中获取整数。

struct 包似乎是我想要的，但我无法让它工作。

到目前为止，这是我的代码（顺便说一句，我对 python 很陌生……所以请放轻松）：

```
def __init__(self, ten_byte_string):
        self.whole_string = ten_byte_string
        self.file_identifier = self.whole_string[:3]
        self.major_version = struct.pack('x', self.whole_string[3:4]) #this 
        self.minor_version = struct.pack('x', self.whole_string[4:5]) # and this
        self.flags = self.whole_string[5:6]
        self.len = self.whole_string[6:10] 
```

打印出任何值除了显然是废话，因为它们的格式不正确。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-29T20:50:20.870

如果您有一个包含 2 个字节的字符串，您希望将其解释为 16 位整数，您可以通过以下方式实现：

```
>>> s = '\0\x02'
>>> struct.unpack('>H', s)
(2,) 
```

请注意， > 用于大端（整数的最大部分在前）。这是 id3 标签使用的格式。

对于其他大小的整数，您使用不同的格式代码。例如。"i" 表示带符号的 32 位整数。有关详细信息，请参阅帮助（结构）。

您也可以一次解压缩多个元素。例如，对于 2 条无符号短裤，后跟有符号的 32 位值：

```
>>> a,b,c = struct.unpack('>HHi', some_string) 
```

按照您的代码，您正在寻找（按顺序）：

*   一个 3 字符的字符串
*   2 个单字节值（主要和次要版本）
*   一个 1 字节的标志变量
*   一个 32 位长度的量

格式字符串为：

```
ident, major, minor, flags, len = struct.unpack('>3sBBBI', ten_byte_string) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T20:50:23.630

为什么要自己写？（假设您尚未检查这些其他选项。）有几个选项可用于从 Python 中的 MP3 中读取 ID3 标签信息。看看我在[这个问题上的](https://stackoverflow.com/questions/8948/accessing-mp3-meta-data-with-python)[回答](https://stackoverflow.com/questions/8948/accessing-mp3-meta-data-with-python#102285)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T20:40:45.947

我打算推荐这个`struct`包，但你说你已经试过了。试试这个：

```
self.major_version = struct.unpack('H', self.whole_string[3:5]) 
```

该`pack()`函数将 Python 数据类型转换为位，该`unpack()`函数将位转换为 Python 数据类型。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T21:00:56.837

> 我正在尝试读取 ID3v2 标记标题

FWIW，[已经有一个模块](http://id3-py.sourceforge.net/)。

# javascript - Internet Explorer 中的锯齿状按钮边缘

> ID：150535
> 
> 赞同：5
> 
> 时间：2008-09-29T20:38:29.527
> 
> 标签：javascript, css, internet-explorer

如何从 Internet Explorer 的宽按钮中删除锯齿状边缘？例如：

![替代文字](https://i.stack.imgur.com/em5K0.gif)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T20:56:22.977

您还可以通过在按钮上设置`background-color`和/或来消除 Windows XP 的按钮样式（以及所有其他 Windows 版本） `border-color`。

尝试以下样式：

```
background-color: black;
color: white;
border-color: red green blue yellow; 
```

你当然可以让这更令人赏心悦目。但你明白我的意思:)

Stack Overflow 使用这种方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T20:42:20.857

作为一种解决方法，您可以删除按钮两端的空白区域，这样可以减少锯齿状边缘。这是通过以下 css 和一些 jQuery 完成的：

```
input.button {
   padding: 0 .25em;
   width: 0; /* for IE only */
   overflow: visible;
}

input.button[class] { /* IE ignores [class] */
    width: auto;
} 
```

* * *

```
$(function(){
    $('input[type=button]').addClass('button');
}); 
```

jQuery 用于添加按钮类。[可以在这里](http://latrine.dgx.cz/the-stretched-buttons-problem-in-ie)找到更深入的文章。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T20:44:46.373

您可以使用 CSS 更改按钮的边框样式，如下所示：

```
/**************************************************************************
 Nav Button format settings
**************************************************************************/
.navButtons
{
    font-size: 9px;
    font-family: Verdana, sans-serif;
    width: 80;
    height: 20; 
    position: relative; 
    border-style: solid; 
    border-width: 1;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T12:54:26.433

设置`overflow: visible;`按钮将解决 IE 6 和 7 中的问题。

（见[http://jehiah.cz/archive/button-width-in-ie](http://jehiah.cz/archive/button-width-in-ie)）

### 例外

*   在 IE 6 中，如果`display:block;`也应用于按钮，则上述修复将不起作用。

    在 IE 6 中将按钮设置为`display:inline;`将使修复工作。

*   如果您在表格单元格中有这样的按钮，那么表格单元格将不会收缩到新的较小宽度的按钮。

    `width: 0;`您可以通过设置按钮在 IE 6 中解决此问题。但是，在 IE 7 中，这将使除按钮文本之外的所有内容都消失。

    （见[http://latrine.dgx.cz/the-stretched-buttons-problem-in-ie](http://latrine.dgx.cz/the-stretched-buttons-problem-in-ie)）

### 有关样式按钮的更多信息：

[http://natbat.net/2009/Jun/10/styling-buttons-as-links/](http://natbat.net/2009/Jun/10/styling-buttons-as-links/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T00:16:09.987

你可以做的不多，但好消息是它已在 IE8 中修复

[http://webbugtrack.blogspot.com/2007/08/bug-101-buttons-render-stretched-and.html](http://webbugtrack.blogspot.com/2007/08/bug-101-buttons-render-stretched-and.html)

# asp.net - asp.net 配置文件系统有多强大？准备好迎接黄金时段了吗？

> ID：150539
> 
> 赞同：0
> 
> 时间：2008-09-29T20:39:51.970
> 
> 标签：asp.net, asp.net-profiles

我使用 asp.net 配置文件（使用 AspNetSqlProfileProvider）来保存关于我的用户的少量信息。我开始想知道它如何为大量用户处理强大的配置文件。有没有人有在同时拥有大量用户的大型网站上使用它的经验？性能影响是什么？怎么保养？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T20:44:40.197

我发现通过 SQL 运行它有点棘手，但我曾与将其扩展到数百个属性和 10K+ 用户的客户一起工作，没有任何困难。授予的用户不多，但到目前为止它正在工作。

我认为这真的取决于具体的项目，以及您在使用个人资料信息时的确切需求。您是否需要通过 SQL 定期查询它？您是否只需要用于用户显示，这些类型的东西可能有助于为您的需求提供更可靠的答案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T20:46:32.737

SQL 提供程序的性能与大铁吞吐量更密切相关。性能或多或少与单个 SQL Server 处理查询数量的能力成正比。扩大规模是唯一的选择，因此它并不是真正的五个九点。

您必须弄清楚是否需要横向扩展性能和可用性，例如通过分区、复制、冗余等，以及性能成本。一些功能是可能的 - 当前的实施更多地针对中间市场和企业。

好消息是您可以将自己的配置文件提供程序实现 - 然后将其附加到具有上述功能的服务和系统。

我们编写了一个自定义的身份验证、身份验证和配置文件提供程序，并将其绑定到跨 3 个数据中心的大型 AD/LDS LDAP 集群。我们在 Comscore 前 10 名中 - 所以你可以说我们每天都在处理大量的互联网。每秒 1000 条配置文件查询和 1 亿条配置文件 - 它可以通过良好的规划、工程和运营进行扩展。

# c - 在 C 中转发可变参数函数的调用

> ID：150543
> 
> 赞同：219
> 
> 时间：2008-09-29T20:41:15.087
> 
> 标签：c, variadic

在 C 中，是否可以转发可变参数函数的调用？如中，

```
int my_printf(char *fmt, ...) {
    fprintf(stderr, "Calling printf with fmt %s", fmt);
    return SOMEHOW_INVOKE_LIBC_PRINTF;
} 
```

在这种情况下，以上述方式转发调用显然不是绝对必要的（因为您可以以其他方式记录调用，或使用 vfprintf），但我正在处理的代码库需要包装器做一些实际工作，并且不'没有（也不能添加）类似于 vfprintf 的辅助函数。

[更新：根据迄今为止提供的答案，似乎有些混乱。用另一种方式来表达这个问题：一般来说，你可以包装一些任意可变参数函数*而不修改该函数的定义*。]

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2008-09-29T20:56:19.000

如果你没有一个类似的函数，`vfprintf`它需要 a`va_list`而不是可变数量的参数，**你就不能这样做**。看[http://c-faq.com/varargs/handoff.html](http://c-faq.com/varargs/handoff.html)。

例子：

```
void myfun(const char *fmt, va_list argp) {
    vfprintf(stderr, fmt, argp);
} 
```

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-09-29T20:57:42.897

不是直接的，但是通常（您会在标准库中发现几乎普遍的情况）可变参数函数与`varargs`样式替代函数成对出现。例如`printf`/`vprintf`

v... 函数采用 va_list 参数，其实现通常由编译器特定的“宏魔法”完成，但您可以保证从这样的可变参数函数调用 v... 样式函数将起作用：

```
#include <stdarg.h>

int m_printf(char *fmt, ...)
{
    int ret;

    /* Declare a va_list type variable */
    va_list myargs;

    /* Initialise the va_list variable with the ... after fmt */

    va_start(myargs, fmt);

    /* Forward the '...' to vprintf */
    ret = vprintf(fmt, myargs);

    /* Clean up the va_list */
    va_end(myargs);

    return ret;
} 
```

这应该会给你你正在寻找的效果。

如果您正在考虑编写可变参数库函数，您还应该考虑将 va_list 样式伴侣作为库的一部分。从您的问题中可以看出，它可以证明对您的用户有用。

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-09-29T21:00:00.083

C99 支持[带有可变参数的宏](http://gcc.gnu.org/onlinedocs/cpp/Variadic-Macros.html)；根据您的编译器，您可能可以声明一个执行您想要的宏：

```
#define my_printf(format, ...) \
    do { \
        fprintf(stderr, "Calling printf with fmt %s\n", format); \
        some_other_variadac_function(format, ##__VA_ARGS__); \
    } while(0) 
```

不过，一般来说，最好的解决方案是使用您要包装的函数的**va_list形式，如果存在的话。**

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-29T20:47:25.463

几乎，使用可用的设施`<stdarg.h>`：

```
#include <stdarg.h>
int my_printf(char *format, ...)
{
   va_list args;
   va_start(args, format);
   int r = vprintf(format, args);
   va_end(args);
   return r;
} 
```

请注意，您将需要使用[`vprintf`](http://www.cplusplus.com/reference/clibrary/cstdio/vprintf.html)version 而不是 plain `printf`。在这种情况下，没有办法直接调用可变参数函数而不使用`va_list`.

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-05-27T17:04:22.240

由于实际上不可能以一种好的方式转发此类调用，因此我们通过使用原始堆栈帧的副本设置一个新的堆栈帧来解决此问题。然而，这是*高度不可移植的，并且会做出各种假设*，例如代码使用帧指针和“标准”调用约定。

此头文件允许为 x86_64 和 i386 (GCC) 包装可变参数函数。它不适用于浮点参数，但应该直接扩展以支持这些参数。

```
#ifndef _VA_ARGS_WRAPPER_H
#define _VA_ARGS_WRAPPER_H
#include <limits.h>
#include <stdint.h>
#include <alloca.h>
#include <inttypes.h>
#include <string.h>

/* This macros allow wrapping variadic functions.
 * Currently we don't care about floating point arguments and
 * we assume that the standard calling conventions are used.
 *
 * The wrapper function has to start with VA_WRAP_PROLOGUE()
 * and the original function can be called by
 * VA_WRAP_CALL(function, ret), whereas the return value will
 * be stored in ret.  The caller has to provide ret
 * even if the original function was returning void.
 */

#define __VA_WRAP_CALL_FUNC __attribute__ ((noinline))

#define VA_WRAP_CALL_COMMON()                                        \
    uintptr_t va_wrap_this_bp,va_wrap_old_bp;                        \
    va_wrap_this_bp  = va_wrap_get_bp();                             \
    va_wrap_old_bp   = *(uintptr_t *) va_wrap_this_bp;               \
    va_wrap_this_bp += 2 * sizeof(uintptr_t);                        \
    size_t volatile va_wrap_size = va_wrap_old_bp - va_wrap_this_bp; \
    uintptr_t *va_wrap_stack = alloca(va_wrap_size);                 \
    memcpy((void *) va_wrap_stack,                                   \
        (void *)(va_wrap_this_bp), va_wrap_size);

#if ( __WORDSIZE == 64 )

/* System V AMD64 AB calling convention */

static inline uintptr_t __attribute__((always_inline)) 
va_wrap_get_bp()
{
    uintptr_t ret;
    asm volatile ("mov %%rbp, %0":"=r"(ret));
    return ret;
}

#define VA_WRAP_PROLOGUE()           \
    uintptr_t va_wrap_ret;           \
    uintptr_t va_wrap_saved_args[7]; \
    asm volatile  (                  \
    "mov %%rsi,     (%%rax)\n\t"     \
    "mov %%rdi,  0x8(%%rax)\n\t"     \
    "mov %%rdx, 0x10(%%rax)\n\t"     \
    "mov %%rcx, 0x18(%%rax)\n\t"     \
    "mov %%r8,  0x20(%%rax)\n\t"     \
    "mov %%r9,  0x28(%%rax)\n\t"     \
    :                                \
    :"a"(va_wrap_saved_args)         \
    );

#define VA_WRAP_CALL(func, ret)            \
    VA_WRAP_CALL_COMMON();                 \
    va_wrap_saved_args[6] = (uintptr_t)va_wrap_stack;  \
    asm volatile (                         \
    "mov      (%%rax), %%rsi \n\t"         \
    "mov   0x8(%%rax), %%rdi \n\t"         \
    "mov  0x10(%%rax), %%rdx \n\t"         \
    "mov  0x18(%%rax), %%rcx \n\t"         \
    "mov  0x20(%%rax),  %%r8 \n\t"         \
    "mov  0x28(%%rax),  %%r9 \n\t"         \
    "mov           $0, %%rax \n\t"         \
    "call             *%%rbx \n\t"         \
    : "=a" (va_wrap_ret)                   \
    : "b" (func), "a" (va_wrap_saved_args) \
    :  "%rcx", "%rdx",                     \
      "%rsi", "%rdi", "%r8", "%r9",        \
      "%r10", "%r11", "%r12", "%r14",      \
      "%r15"                               \
    );                                     \
    ret = (typeof(ret)) va_wrap_ret;

#else

/* x86 stdcall */

static inline uintptr_t __attribute__((always_inline))
va_wrap_get_bp()
{
    uintptr_t ret;
    asm volatile ("mov %%ebp, %0":"=a"(ret));
    return ret;
}

#define VA_WRAP_PROLOGUE() \
    uintptr_t va_wrap_ret;

#define VA_WRAP_CALL(func, ret)        \
    VA_WRAP_CALL_COMMON();             \
    asm volatile (                     \
    "mov    %2, %%esp \n\t"            \
    "call  *%1        \n\t"            \
    : "=a"(va_wrap_ret)                \
    : "r" (func),                      \
      "r"(va_wrap_stack)               \
    : "%ebx", "%ecx", "%edx"   \
    );                                 \
    ret = (typeof(ret))va_wrap_ret;
#endif

#endif 
```

最后，您可以像这样包装调用：

```
int __VA_WRAP_CALL_FUNC wrap_printf(char *str, ...)
{
    VA_WRAP_PROLOGUE();
    int ret;
    VA_WRAP_CALL(printf, ret);
    printf("printf returned with %d \n", ret);
    return ret;
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2020-05-01T15:44:12.090

gcc 提供了一个可以做到这一点的扩展：`__builtin_apply`和亲戚。请参阅gcc 手册中的[构造函数调用](https://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Constructing-Calls.html)。

一个例子：

```
#include <stdio.h>

int my_printf(const char *fmt, ...) {
    void *args = __builtin_apply_args();
    printf("Hello there! Format string is %s\n", fmt);
    void *ret = __builtin_apply((void (*)())printf, args, 1000);
    __builtin_return(ret);
}

int main(void) {
    my_printf("%d %f %s\n", -37, 3.1415, "spam");
    return 0;
} 
```

[在godbolt上试试](https://godbolt.org/z/R5qp35)

文档中有一些注意事项，它可能无法在更复杂的情况下工作。而且您必须硬编码参数的最大大小（这里我使用了 1000）。但它可能是其他涉及用 C 或汇编语言剖析堆栈的方法的合理替代方案。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-29T20:45:47.713

使用 vfprintf：

```
int my_printf(char *fmt, ...) {
    va_list va;
    int ret;

    va_start(va, fmt);
    ret = vfprintf(stderr, fmt, va);
    va_end(va);
    return ret;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T20:49:15.863

无法转发此类函数调用，因为您可以检索原始堆栈元素的唯一位置是`my_print()`. 像这样包装调用的常用方法是有两个函数，一个只是将参数转换为各种`varargs`结构，另一个是实际操作这些结构。使用这样的双功能模型，您可以（例如）通过在with`printf()`中初始化结构来包装，然后将它们传递给.`my_printf()``va_start()``vfprintf()`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T21:43:43.830

是的，你可以做到，但它有点难看，你必须知道参数的最大数量。此外，如果您使用的架构不像 x86（例如，PowerPC）那样在堆栈上传递参数，您将必须知道是否使用“特殊”类型（double、float、altivec 等）以及是否使用所以，相应地处理它们。这可能很快就会很痛苦，但如果您使用的是 x86，或者如果原始函数具有明确定义且有限的边界，则它可以工作。 **它仍然是一个 hack**，用于调试目的。不要围绕它构建你的软件。无论如何，这是一个关于 x86 的工作示例：

```
#include <stdio.h>
#include <stdarg.h>

int old_variadic_function(int n, ...)
{
  va_list args;
  int i = 0;

  va_start(args, n);

  if(i++<n) printf("arg %d is 0x%x\n", i, va_arg(args, int));
  if(i++<n) printf("arg %d is %g\n",   i, va_arg(args, double));
  if(i++<n) printf("arg %d is %g\n",   i, va_arg(args, double));

  va_end(args);

  return n;
}

int old_variadic_function_wrapper(int n, ...)
{
  va_list args;
  int a1;
  int a2;
  int a3;
  int a4;
  int a5;
  int a6;
  int a7;
  int a8;

  /* Do some work, possibly with another va_list to access arguments */

  /* Work done */

  va_start(args, n);

  a1 = va_arg(args, int);
  a2 = va_arg(args, int);
  a3 = va_arg(args, int);
  a4 = va_arg(args, int);
  a5 = va_arg(args, int);
  a6 = va_arg(args, int);
  a7 = va_arg(args, int);

  va_end(args);

  return old_variadic_function(n, a1, a2, a3, a4, a5, a6, a7, a8);
}

int main(void)
{
  printf("Call 1: 1, 0x123\n");
  old_variadic_function(1, 0x123);
  printf("Call 2: 2, 0x456, 1.234\n");
  old_variadic_function(2, 0x456, 1.234);
  printf("Call 3: 3, 0x456, 4.456, 7.789\n");
  old_variadic_function(3, 0x456, 4.456, 7.789);
  printf("Wrapped call 1: 1, 0x123\n");
  old_variadic_function_wrapper(1, 0x123);
  printf("Wrapped call 2: 2, 0x456, 1.234\n");
  old_variadic_function_wrapper(2, 0x456, 1.234);
  printf("Wrapped call 3: 3, 0x456, 4.456, 7.789\n");
  old_variadic_function_wrapper(3, 0x456, 4.456, 7.789);

  return 0;
} 
```

出于某种原因，您不能将浮点数与 va_arg 一起使用，gcc 表示它们已转换为双精度，但程序崩溃了。仅此一项就表明该解决方案是一种 hack，并且没有通用解决方案。在我的示例中，我假设参数的最大数量为 8，但您可以增加该数量。包装函数也只使用整数，但它与其他“普通”参数的工作方式相同，因为它们总是转换为整数。目标函数将知道它们的类型，但您的中间包装器不需要。包装器也不需要知道正确数量的参数，因为目标函数也会知道它。要进行有用的工作（除了记录通话），您可能必须同时了解两者。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-05-27T13:06:58.020

不确定这是否有助于回答 OP 的问题，因为我不知道为什么在包装函数中使用类似于 vfprintf 的辅助函数的限制适用。我认为这里的关键问题是转发可变参数列表而不解释它们是困难的。可能的是执行格式化（使用类似于 vfprintf: vsnprintf 的辅助函数）并将格式化的输出转发到带有可变参数的包装函数（即不修改包装函数的定义）。所以，我们开始：

```
#include <stdio.h>
#include <stdarg.h>

int my_printf(char *fmt, ...)
{
    if (fmt == NULL) {
        /* Invalid format pointer */
        return -1;
    } else {
        va_list args;
        int len;

        /* Initialize a variable argument list */
        va_start(args, fmt);

        /* Get length of format including arguments */
        len = vsnprintf(NULL, 0, fmt, args);

        /* End using variable argument list */
        va_end(args);

        if (len < 0) {
            /* vsnprintf failed */
            return -1;
        } else {
            /* Declare a character buffer for the formatted string */
            char formatted[len + 1];

            /* Initialize a variable argument list */
            va_start(args, fmt);

            /* Write the formatted output */
            vsnprintf(formatted, sizeof(formatted), fmt, args);

            /* End using variable argument list */
            va_end(args);

            /* Call the wrapped function using the formatted output and return */
            fprintf(stderr, "Calling printf with fmt %s", fmt);
            return printf("%s", formatted);
        }
    }
}

int main()
{
    /* Expected output: Test
     * Expected error: Calling printf with fmt Test
     */
    my_printf("Test\n");
    //printf("Test\n");

    /* Expected output: Test
     * Expected error: Calling printf with fmt %s
     */
    my_printf("%s\n", "Test");
    //printf("%s\n", "Test");

    /* Expected output: %s
     * Expected error: Calling printf with fmt %s
     */
    my_printf("%s\n", "%s");
    //printf("%s\n", "%s");

    return 0;
} 
```

[我在这里](https://stackoverflow.com/questions/27252757/how-to-mock-variadic-functions-using-googlemock)遇到了这个解决方案。

**已编辑：修正了 egmont 指出的错误**

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-02-12T22:16:43.507

基本上有三种选择。

一种是不传递它，而是使用目标函数的可变参数实现而不传递省略号。另一种是使用可变参数宏。第三个选项是我缺少的所有东西。

我通常选择选项一，因为我觉得这很容易处理。选项二有一个缺点，因为调用可变参数宏有一些限制。

这是一些示例代码：

```
#include <stdio.h>
#include <stdarg.h>

#define Option_VariadicMacro(f, ...)\
    printf("printing using format: %s", f);\
    printf(f, __VA_ARGS__)

int Option_ResolveVariadicAndPassOn(const char * f, ... )
{
    int r;
    va_list args;

    printf("printing using format: %s", f);
    va_start(args, f);
    r = vprintf(f, args);
    va_end(args);
    return r;
}

void main()
{
    const char * f = "%s %s %s\n";
    const char * a = "One";
    const char * b = "Two";
    const char * c = "Three";
    printf("---- Normal Print ----\n");
    printf(f, a, b, c);
    printf("\n");
    printf("---- Option_VariadicMacro ----\n");
    Option_VariadicMacro(f, a, b, c);
    printf("\n");
    printf("---- Option_ResolveVariadicAndPassOn ----\n");
    Option_ResolveVariadicAndPassOn(f, a, b, c);
    printf("\n");
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-05-01T15:25:25.140

最好的方法是

```
static BOOL(__cdecl *OriginalVarArgsFunction)(BYTE variable1, char* format, ...)(0x12345678); //TODO: change address lolz

BOOL __cdecl HookedVarArgsFunction(BYTE variable1, char* format, ...)
{
    BOOL res;

    va_list vl;
    va_start(vl, format);

    // Get variable arguments count from disasm. -2 because of existing 'format', 'variable1'
    uint32_t argCount = *((uint8_t*)_ReturnAddress() + 2) / sizeof(void*) - 2;
    printf("arg count = %d\n", argCount);

    // ((int( __cdecl* )(const char*, ...))&oldCode)(fmt, ...);
    __asm
    {
        mov eax, argCount
        test eax, eax
        je noLoop
        mov edx, vl
        loop1 :
        push dword ptr[edx + eax * 4 - 4]
        sub eax, 1
        jnz loop1
        noLoop :
        push format
        push variable1
        //lea eax, [oldCode] // oldCode - original function pointer
        mov eax, OriginalVarArgsFunction
        call eax
        mov res, eax
        mov eax, argCount
        lea eax, [eax * 4 + 8] //+8 because 2 parameters (format and variable1)
        add esp, eax
    }
    return res;
} 
```

# c# - 您可以在 C# 代码中捕获本机异常吗？

> ID：150544
> 
> 赞同：78
> 
> 时间：2008-09-29T20:41:17.630
> 
> 标签：c#, .net, exception

在 C# 代码中，您能否捕获从某个非托管库的深处抛出的本机异常？如果是这样，您需要做任何不同的事情来捕捉它还是标准的 try...catch 得到它？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-29T20:51:35.797

您可以使用[Win32Exception](http://msdn.microsoft.com/en-us/library/system.componentmodel.win32exception.aspx)并使用其 NativeErrorCode 属性来适当地处理它。

```
// http://support.microsoft.com/kb/186550
const int ERROR_FILE_NOT_FOUND = 2;
const int ERROR_ACCESS_DENIED = 5;
const int ERROR_NO_APP_ASSOCIATED = 1155; 

void OpenFile(string filePath)
{
    Process process = new Process();

    try
    {
        // Calls native application registered for the file type
        // This may throw native exception
        process.StartInfo.FileName = filePath;
        process.StartInfo.Verb = "Open";
        process.StartInfo.CreateNoWindow = true;
        process.Start();
    }
    catch (Win32Exception e)
    {
        if (e.NativeErrorCode == ERROR_FILE_NOT_FOUND || 
            e.NativeErrorCode == ERROR_ACCESS_DENIED ||
            e.NativeErrorCode == ERROR_NO_APP_ASSOCIATED)
        {
            MessageBox.Show(this, e.Message, "Error", 
                    MessageBoxButtons.OK, 
                    MessageBoxIcon.Exclamation);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-29T21:07:28.613

不带 () 的捕获将捕获不符合 CLS 的异常，包括本机异常。

```
try
{

}
catch
{

} 
```

有关详细信息，请参阅以下 FxCop 规则 [http://msdn.microsoft.com/en-gb/bb264489.aspx](http://msdn.microsoft.com/en-gb/bb264489.aspx)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-29T20:43:32.447

C# 和本机代码之间的互操作层会将异常转换为托管形式，允许它被 C# 代码捕获。从 .NET 2.0 开始，`catch (Exception)`应该捕获除不可恢复错误之外的任何内容。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-29T20:52:46.713

在某处使用 .NET Reflector 我看到了以下代码：

```
try {
  ...
} catch(Exception e) {
  ...
} catch {
  ...
} 
```

嗯，C# 不允许抛出不是从 System.Exception 类派生的异常。据我所知，interop marshaller 捕获的任何异常都由继承 System.Exception 的异常类包装。

所以我的问题是是否有可能捕获不是 System.Exception 的异常。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-29T23:35:41.923

这取决于您正在谈论的本机异常类型。如果您指的是 SEH 异常，则 CLR 将执行以下两项操作之一。

1.  如果是已知的 SEH 错误代码，它会将其映射到适当的 .Net 异常（即 OutOfMemoryException）
2.  在不可映射（E_FAIL）或未知代码的情况下，它只会抛出一个[SEHException](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.sehexception.aspx)实例。

这两个都将被一个简单的“catch (Exception)”块捕获。

另一种可以跨越本机/托管边界的本机异常是 C++ 异常。我不确定它们是如何映射/处理的。我的猜测是，由于 Windows 在 SEH 之上实现了 C++ 异常，它们只是以相同的方式映射。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T00:42:02.733

差不多，但不完全。您将捕获异常

```
try 
{
  ...
}
catch (Exception e)
{
  ...
} 
```

但你仍然会有潜在的问题。根据[MSDN](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.sehexception.aspx)，为了确保调用异常析构函数，您必须像这样捕获：

```
try
{
  ...
}
catch
{
  ...
} 
```

这是确保调用异常析构函数的唯一方法（尽管我不确定为什么）。但这使您不得不在蛮力与可能的内存泄漏之间进行权衡。

顺便说一句，如果您使用 (Exception e) 方法，您应该知道您可能遇到的不同类型的异常。RuntimeWrappedException 是任何托管非异常类型将被映射到的对象（对于可以抛出字符串的语言），其他类型将被映射，例如 OutOfMemoryException 和 AccessViolationException。COM 互操作 HRESULTS 或除 E___FAIL 以外的异常将映射到 COMException，最后您将获得 E_FAIL 的 SEHException 或任何其他未映射的异常。

那你该怎么办？最好的选择是不要从您的非托管代码中抛出异常！哈。确实，如果您有选择，设置障碍和失败会使选择更糟，在异常处理期间有可能发生内存泄漏，或者不知道您的异常是什么类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-07T03:50:01.983

使用 .Net Framework 4.8**如果**异常在本机代码中[得到很好](https://docs.microsoft.com/en-us/archive/msdn-magazine/2004/march/throwing-custom-exception-types-from-a-com-server-application)的处理，那么您可以使用标准的 try catch 来捕获它。

```
try 
{
   //call native code method
} 
catch (Exception ex) 
{
   //do stuff
} 
```

**但是**，如果本机代码位于您无法控制的第 3 方 dll 中，您可能会发现开发人员无意中抛出了未处理的异常。我发现除了全局错误处理程序之外，什么都不会捕获这些。

```
private static void Main()
{
    AppDomain.CurrentDomain.UnhandledException += OnUnhandledException;
    try 
    {
       //call native code method
    } 
    catch (Exception ex) 
    {
       //unhandled exception from native code WILL NOT BE CAUGHT HERE
    } 
}

private static void OnUnhandledException(object sender, UnhandledExceptionEventArgs e)
{
    var exception = e.ExceptionObject as Exception;
    //do stuff
} 
```

有一个原因。未处理的本机异常可能表示您无法恢复的损坏状态（例如堆栈溢出或访问冲突）。但是，在某些情况下您仍然想在终止进程之前做一些事情，例如记录刚刚试图使您的 Windows 服务崩溃的错误！！！

## 一点历史

不再需要以下任何一项。
从 .Net 2.0 - 3.5 你可以使用一个空的 catch：

```
try 
{
   //call native code method
} 
catch (Exception ex) 
{
   //do stuff
} 
catch 
{
   //do same stuff but without any exception detail
} 
```

从 .Net 4 开始，他们[关闭了](https://docs.microsoft.com/en-us/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions)能够在默认情况下捕获的本机异常，您需要通过使用属性装饰您的方法来显式地将其重新打开。

```
[HandleProcessCorruptedStateExceptions] 
[SecurityCritical]
private static void Main() 
{ 
    try 
    {
       //call native code method
    } 
    catch (Exception ex) 
    {
       //do stuff
    } 
} 
```

还需要[更改](https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/runtime/legacycorruptedstateexceptionspolicy-element)app.config 文件：

```
<configuration>  
   <runtime>  
      <legacyCorruptedStateExceptionsPolicy enabled="true" />  
   </runtime>  
</configuration> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-29T20:44:36.953

我相信一个标准的 try catch 应该可以解决问题。

我遇到了一个类似的问题，System.data 异常抛出一个未捕获的 sqlClient 异常，在我的代码中添加一个 try..catch 在实例中起到了作用

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-29T20:43:23.523

如果你使用一个

```
try
{

}
catch(Exception ex)
{

} 
```

它将捕获所有异常，具体取决于您调用外部库的方式，您可能会得到一个与 com 相关的异常，该异常封装了错误，但它会捕获错误。

# actionscript-3 - 在 ActionScript (NaN==parseFloat(input.text)) 中警告它总是错误的。为什么？

> ID：150548
> 
> 赞同：7
> 
> 时间：2008-09-29T20:42:49.763
> 
> 标签：actionscript-3, nan

尽管有相当清楚的[文档](http://www.adobe.com/support/flash/action_scripts/actionscript_dictionary/actionscript_dictionary620.html)说[parseFloat()](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/package.html#parseFloat())可以将 NaN 作为值返回，但当我编写如下块时：

```
if ( NaN == parseFloat(input.text) ) {
  errorMessage.text = "Please enter a number."
} 
```

我被警告说，比较总是错误的。并且测试表明警告是正确的。

更正的文档在哪里，我如何编写它以使用 AS3？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-29T20:45:00.023

因为将任何东西与 NaN 进行比较总是错误的。使用 isNaN() 代替。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T20:45:35.420

isNaN(parseFloat(input.text))

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T16:14:51.167

顺便说一句，如果由于某种原因您无法访问 isNaN()，传统的方法是将数字与自身进行比较：

```
if( number != number )
{
    //Is NaN 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T22:08:09.450

可以在[此处](http://livedocs.adobe.com/flex/2/langref/package.html#isNaN())的 Adob​​e Flex 语言参考以及其他全球可用的功能中找到文档。

# sql-server-2005 - 在 SQLServer 2005 函数中执行动态 SQL

> ID：150552
> 
> 赞同：23
> 
> 时间：2008-09-29T20:43:45.723
> 
> 标签：sql-server-2005, function

我会先说这个问题，我不认为这是可以解决的。我也有一个解决方法，我可以创建一个带有 OUTPUT 的存储过程来完成此操作，使用函数对需要此校验和的部分进行编码更容易。

`Exec SP_ExecuteSQL @SQL`由于调用，此代码将不起作用。有人知道如何在函数中执行动态 SQL 吗？（再一次，我认为这是不可能的。如果是的话，我很想知道如何绕过它！）

```
Create Function Get_Checksum
(
    @DatabaseName      varchar(100),
    @TableName         varchar(100)
)
RETURNS FLOAT
AS
BEGIN

 Declare @SQL        nvarchar(4000)
 Declare @ColumnName varchar(100)
 Declare @i          int
 Declare @Checksum   float
 Declare @intColumns table (idRecord int identity(1,1), ColumnName varchar(255))
 Declare @CS         table (MyCheckSum bigint)

 Set @SQL = 
        'Insert Into @IntColumns(ColumnName)' + Char(13) + 
        'Select Column_Name' + Char(13) +
        'From   ' + @DatabaseName + '.Information_Schema.Columns (NOLOCK)' + Char(13) +
        'Where  Table_Name = ''' + @TableName + '''' + Char(13) +
        '       and Data_Type = ''int''' 

 -- print @SQL

 exec sp_executeSql @SQL

 Set @SQL = 
        'Insert Into @CS(MyChecksum)' + Char(13) + 
        'Select '

 Set @i = 1

 While Exists(
       Select 1
       From   @IntColumns
       Where  IdRecord = @i)
 begin
       Select @ColumnName = ColumnName
       From   @IntColumns
       Where  IdRecord = @i

       Set @SQL = @SQL + Char(13) + 
            CASE WHEN @i = 1 THEN 
                 '    Sum(Cast(IsNull(' + @ColumnName + ',0) as bigint))'
                 ELSE
                 '    + Sum(Cast(IsNull(' + @ColumnName + ',0) as bigint))'
            END

       Set @i = @i + 1
 end

 Set @SQL = @SQL + Char(13) + 
      'From ' + @DatabaseName + '..' + @TableName + ' (NOLOCK)'

 -- print @SQL

 exec sp_executeSql @SQL

 Set @Checksum = (Select Top 1 MyChecksum From @CS)

 Return isnull(@Checksum,0)

END
GO 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-29T20:51:26.267

“通常”无法做到这一点，因为 SQL Server 将函数视为确定性，这意味着对于给定的一组输入，它应该始终返回相同的输出。存储过程或动态 sql 可能是不确定的，因为它可以更改依赖的外部状态，例如表。

鉴于 SQL Server 中的函数始终是确定性的，从未来维护的角度来看，试图规避这一点将是一个坏主意，因为这可能会给将来必须支持该代码的任何人造成相当大的混乱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-09-15T04:52:22.467

这是解决方案

**解决方案 1：** 然后从 Function 返回动态字符串

```
Declare @SQLStr varchar(max) 
DECLARE @tmptable table (<columns>)
set @SQLStr=dbo.function(<parameters>)
insert into @tmptable
Exec (@SQLStr)

select * from @tmptable 
```

**解决方案2：** 通过传递参数调用嵌套函数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T20:46:49.660

您可以通过调用扩展存储过程来解决此问题，但会带来所有随之而来的麻烦和安全问题。

[http://decipherinfosys.wordpress.com/2008/07/16/udf-limitations-in-sql-server/](http://decipherinfosys.wordpress.com/2008/07/16/udf-limitations-in-sql-server/)

[http://decipherinfosys.wordpress.com/2007/02/27/using-getdate-in-a-udf/](http://decipherinfosys.wordpress.com/2007/02/27/using-getdate-in-a-udf/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T20:48:54.587

因为函数必须与查询优化器很好地配合，所以对它们有很多限制。 [此链接](http://blog.sqlauthority.com/2007/05/29/sql-server-user-defined-functions-udf-limitations/)引用了一篇深入讨论 UDF 限制的文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T18:27:05.557

谢谢大家的回复。

Ron：仅供参考，使用它会引发错误。

我同意不做我原本打算的最好的解决方案，我决定走另一条路。我的两个选择是`sum(cast(BINARY_CHECKSUM(*) as float))`在存储过程中使用或输出参数。在每个单元测试速度之后，我决定`sum(cast(BINARY_CHECKSUM(*) as float))`为每个表的数据获取可比较的校验和值。

# java - luhn 算法的最小长度是多少？

> ID：150554
> 
> 赞同：1
> 
> 时间：2008-09-29T20:44:29.527
> 
> 标签：java, algorithm

排除校验位，luhn 算法将处理的最小长度数是多少？

我的想法是它适用于任何大于 2 位的数字（同样，不包括校验位）。

我问的原因是：如果我从右到左遍历数字中的所有数字。这会导致 i%2 == 0 （用于查找数字中的备用位置）如果数字为 3 位或更小（例如 125 - 在纸上似乎是有效数字），则在我的 luhn 验证中失败

显然，我可以将我的条件从 i%2== 0 更改为其他内容，但如果它不是算法的正确行为，那就太好了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T21:04:02.880

Luhn 的算法适用于两位数。如果单个数字错误以及某些（但不是全部）数字被转置的情况，它将发出警告。哎呀，理论上它可以使用一位数，但这不是很有用。您可以通过固定一位数字，然后更改另一位数字并验证另一位数字的每个值是否会给出唯一的“校验和”来亲自查看。但是，只有两位数字，只需添加数字 mod 10 即可为您提供相同的属性，但不会捕获任何转置错误。

# .net - 如何确定计时器是否正在运行？

> ID：150575
> 
> 赞同：67
> 
> 时间：2008-09-29T20:48:02.933
> 
> 标签：.net, timer

如果我有一个 System.Timers.Timer 的实例，它的间隔时间很长——比如 1 分钟，我如何才能知道它是否在不等待 Tick 的情况下启动？

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2008-09-29T20:51:45.483

`System.Timer.Timer.Enabled`应该可以工作，当您调用“开始”时，它将启用设置为 TRUE，“停止”将其设置为 FALSE。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-29T20:54:53.980

```
if (timer1.Enabled)
{
   // Do Something
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-29T20:52:47.510

如果 Timer.Enabled 为 true，则您的计时器正在运行。

调用 Timer.Start 将 Enabled 设置为 true。

调用 Timer.Stop 将 Enabled 设置为 false。

如果 Timer.AutoReset 为 true，则 Enabled 将在计时器第一次到期时自动设置为 false。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-29T20:52:47.090

使用计时器的[*Enabled*](http://msdn.microsoft.com/en-us/library/system.timers.timer.enabled.aspx)属性。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T20:57:11.807

您应该检查是否启用了计时器

# html - 目前哪个浏览器对 HTML 5 的支持最好？

> ID：150577
> 
> 赞同：31
> 
> 时间：2008-09-29T20:48:54.603
> 
> 标签：html

我今天在哪里可以测试 HTML 5 功能 - 是否有任何渲染引擎的测试版本可以进行测试，或者是否还早？我知道大部分规范尚未最终确定，但有些已经完成，最好尝试一下！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-04-17T11:42:32.603

要测试**您的**浏览器，请访问[http://html5test.com/](http://html5test.com/)。代码维护在：github dot com slash NielsLeenheer slash html5test。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-29T20:50:55.627

使用最近的 webkit 构建和 Presto 构建的。

Safari 3.1 for webkit
Opera for Presto。

我很确定 Firefox 将在 3.1 中开始部分支持 html5

所有的支持都是非常片面的。在此处查看[有关支持的信息。](http://en.wikipedia.org/wiki/Comparison_of_layout_engines_(HTML_5))

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-29T21:04:14.363

[http://wiki.whatwg.org/wiki/Implementations_in_Web_browsers](http://wiki.whatwg.org/wiki/Implementations_in_Web_browsers)包含由 WHATWG 社区（以及所有访问和编辑它的人）维护的信息。

免责声明：我是该社区的成员。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-08T09:27:59.803

主要浏览器现在提供更多支持。

[http://radar.oreilly.com/2009/05/google-bets-big-on-html-5.html](http://radar.oreilly.com/2009/05/google-bets-big-on-html-5.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-07T12:30:32.520

似乎新浏览器支持大多数标签：`<header>`等`<section>`。对于旧浏览器（IE、Fx2、Camino 等），您可以使用它来允许这些标签的样式：

```
document.createElement('header'); 
```

将使这些较旧的浏览器允许标题标签的 CSS 样式，而不是仅仅忽略它。

这意味着您现在可以在不损失任何功能的情况下使用新标签，这是一个好的开始！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T20:53:50.847

Opera 也有一些支持。

然而，一般来说，现在测试还为时过早。您可能需要等待一两年，才能让任何浏览器获得足够的实际支持来进行测试。

**编辑** Wikipedia 有一篇关于[HTML 5 各种布局引擎实现了多少的](http://en.wikipedia.org/wiki/Comparison_of_layout_engines_(HTML_5))好文章。它包括 HTML 5 的特定方面。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-05T12:53:37.297

我认为现在是 Firefox 3.6.2，但是当 Internet Explorer 9 推出时，它将支持 HTML5

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-12T09:38:48.733

此页面是一个简洁的摘要，但并不完全准确：

[http://findmebyip.com/litmus#target-selector](http://findmebyip.com/litmus#target-selector)

# generics - 何时在 IEnumerable<> 上使用 IEnumerable

> ID：150581
> 
> 赞同：1
> 
> 时间：2008-09-29T20:49:44.927
> 
> 标签：generics, .net-2.0

由于 .NET 框架中缺乏泛型差异，如果方法被设计为处理多种类型，那么拥有处理 System.Collection 接口的非泛型版本的方法是否更“正确”？

理想情况下，一旦迁移到 .NET 3.5，代码将被修改以将这些方法更改为扩展方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T13:29:31.013

不，更“正确”的做法是使处理多种类型的方法本身具有通用性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T15:14:47.227

在这种情况下（IEnumerable），实现泛型版本更好，因为它派生自 IEnumerable（非泛型），所以它成为一个有争议的问题，两者都可供您使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T20:56:35.193

定义“多种类型”是指例如同时包含 Cars 和 Dogs 的 List 吗？或者一个包含汽车的列表和另一个包含狗的列表？除非您正在做一些“特殊”的事情，否则我会说正确的做法是实现通用版本而不是非通用版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:13:06.917

[这是一篇不错的文章来解释它。](http://blogs.msdn.com/rmbyers/archive/2006/06/01/613690.aspx)

我能看到的唯一解决方案是遵循文章的建议，并使该方法也成为通用方法。

但是，我不确定它是否能经得起扩展方法的考验。

# sql - 与 VARCHAR() 相比，BLOB 或 TEXT 有何不同？

> ID：150588
> 
> 赞同：8
> 
> 时间：2008-09-29T20:50:31.617
> 
> 标签：sql, mysql

如果我不知道文本条目的长度（例如博客文章、描述或其他长文本），那么在 MYSQL 中存储它的最佳方式是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T20:56:39.310

TEXT 最适合未知大小的文本。VARCHAR 仅限于 MYSQL 5.0.3 中的 65,535 个字符和以前版本中的 255 个字符，因此如果您可以放心地假设它适合那里，那将是一个更好的选择。

BLOB 用于二进制数据，因此除非您希望您的文本是二进制格式，否则它是最不适合的列类型。

有关详细信息，请参阅有关[字符串列类型](http://dev.mysql.com/doc/refman/5.0/en/string-types.html)的 Mysql 文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T20:56:30.560

如果您希望将其视为带有字符集的字符串，请使用 TEXT。
如果您希望将 BLOB 视为没有字符集的二进制字符串，请使用 BLOB。

我建议使用文本。

# eclipse - 开始使用 Mylyn 的最佳方式是什么？

> ID：150600
> 
> 赞同：25
> 
> 时间：2008-09-29T20:52:34.717
> 
> 标签：eclipse, mylyn

我听说过很多关于在 Eclipse 中使用 Mylyn 的好消息。

我该如何设置它以让我体验如何使用它？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-30T17:49:25.210

2.0 版中的**开创性 Developerworks 文章**是对 Mylyn 的一个很好的介绍，并且仍然具有相关性。由 Mylyn 项目负责人 Mik Kirsten 撰写，它非常清楚地解释了一些非常独特的东西。很多漂亮的图片也展示了它的实际效果。

*   [Mylyn 第一部分 - 集成任务管理](http://www.tasktop.com/mylyn/tutorial)
*   [Mylyn 第 2 部分 - 自动上下文管理](http://www.tasktop.com/mylyn/tutorial-part-2)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-09T15:08:40.860

简单地为自己定义任务，让 Mylyn 专注于它。我无法使用 Mylyn 的 bugtracking 连接，因为我们在工作中使用了非标准的跟踪解决方案（家庭开发和糟糕的），但 Mylyn 的快速任务上下文切换在日常工作中非常有用。我作为高级开发人员工作，所以很多次来或其他人询问他们的代码部分。我有这个中断的任务，激活它，在它们消失后我可以简单地回到我的工作中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-08T02:06:49.497

另一个提示：首先要阻止 Mylyn 实际隐藏与您当前任务无关的内容，这样它只会将它们涂成灰色。隐藏曾经是自动的（也许现在仍然是？）而且它往往会让人失望。实际上，我发现隐藏更分散注意力，并且更喜欢变灰。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-04-14T16:50:29.130

如果您想开始使用 Mylyn，我建议您采用两步流程。

1.  了解 Mylyn 及其优势
2.  配置 Mylyn 以使用您的设置

为了获得 Mylyn 的概述，请考虑以下资源之一：

*   为什么 Mylyn 是不可或缺的，Marc Esher 的[博客](http://blog.mxunit.org/2010/02/why-mylyn-is-indispensible.html)
*   以思维速度编写代码， Mik Kersten 的[演讲](http://tasktop.com/videos/mylyn/webcast-mylyn-3.0.html)（47 分钟）

要以优化您的工作效率的方式配置 Mylyn，遵循几个简单的步骤会有所帮助。我建议使用以下方法之一作为设置指南：

*   入门系列视频（[一](http://tasktop.com/videos/1.6/setup/tasklist/)、[二](http://tasktop.com/videos/1.6/setup/focus/)）
*   Tasktop Pro 中的入门向导（[截图](http://tasktop.com/assets/images/screenshots/dashboard-1.6.png)）
*   Tasktop Pro/Mylyn操作指南[系列](http://tasktop.com/resources/tutorials/)

希望这可以帮助！

大卫·谢泼德，Tasktop Technologies Inc.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-01-10T15:57:22.147

[http://www.vogella.de/articles/Mylyn/article.html](http://www.vogella.de/articles/Mylyn/article.html)是对 Mylyn 的出色介绍，并且经常更新

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-08T02:02:32.920

serg10 指出的 Developer Works 文章很棒。了解更多有关 Mylyn 的另一个好方法是观看视频“Mylyn 3.0：以思维速度编写代码”。

有关最相关的 Mylyn 资源，请参阅[http://tasktop.com/mylyn/ 。](http://tasktop.com/mylyn/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-29T20:53:41.253

将它连接到您的 bugtracker 并使用“专注于活动任务”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T02:24:19.243

好提示，乌里。当您激活新任务时，最新版本的 Mylyn 现在会在包资源管理器中显示一条消息“空任务上下文，取消焦点或 alt+click”。

正如 Uri 指出的那样，开始的一种方法是使用工具栏按钮分散注意力并正常处理您的任务一段时间（无趣的资源会自动变灰）。然后，当您只想查看相关资源时，您可以关注包资源管理器。

其他用户更喜欢将包资源管理器保持在焦点模式并在单击包资源管理器时按住“Alt”键以将新资源添加到活动任务上下文中。在这种工作方式下，只有有趣的资源是可见的，但如果需要，您总是可以不专注于查看所有内容。

# javascript - JavaScript 突出显示字段中选项卡上的表格单元格

> ID：150606
> 
> 赞同：1
> 
> 时间：2008-09-29T20:53:17.227
> 
> 标签：javascript, html

我有一个以表格形式列出的网站。（长按揭表格）

每个表格单元格中都有一个 HTML 对象。（文本框、单选按钮等）

当每个表格单元格被“标记”到其中时，我该怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T21:30:38.840

使用 jQuery 让您的生活更轻松，您可以执行以下操作：

```
$('#mytableid input').focus( function() { 
    $(this).addClass('highlight'); 
}).blur( function() {
    $(this).removeClass('highlight'); 
}); 
```

这基本上是说当您的表格中的任何输入元素处于焦点时，将“突出显示”类添加到它，一旦它失去焦点，就删除该类。

将您的 CSS 设置为：

```
input.highlight { background-color: red; } 
```

你应该被设置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T21:35:23.257

这是我测试我的代码的表：

```
<table id="myTable">
  <tr>
    <td><input type="text" value="hello" /></td>
    <td><input type="checkbox" name="foo" value="2" /></td>
    <td><input type="button" value="hi" /></td>
  </tr>
</table> 
```

这是有效的代码：

```
// here is a cross-browser compatible way of connecting 
// handlers to events, in case you don't have one
function attachEventHandler(element, eventToHandle, eventHandler) {
    if(element.attachEvent) {
       element.attachEvent(eventToHandle, eventHandler);
    } else if(element.addEventListener) {
       element.addEventListener(eventToHandle.replace("on", ""), eventHandler, false);
    } else {
    element[eventToHandle] = eventHandler;
  }
}
attachEventHandler(window, "onload", function() {
  var myTable = document.getElementById("myTable");
  var myTableCells = myTable.getElementsByTagName("td");
  for(var cellIndex = 0; cellIndex < myTableCells.length; cellIndex++) {
    var currentTableCell = myTableCells[cellIndex];
    var originalBackgroundColor = currentTableCell.style.backgroundColor;
    for(var childIndex = 0; childIndex < currentTableCell.childNodes.length; childIndex++) {
      var currentChildNode = currentTableCell.childNodes[childIndex];
      attachEventHandler(currentChildNode, "onfocus", function(e) {
        (e.srcElement || e.target).parentNode.style.backgroundColor = "red";
      });
      attachEventHandler(currentChildNode, "onblur", function(e) {
        (e.srcElement || e.target).parentNode.style.backgroundColor = originalBackgroundColor;
      });
    }
  }
}); 
```

这里可能有一些你可以清理的东西，但我很快就把它整理好了。即使每个单元格中有多个东西，这也有效。

这会容易得多，不用说，如果您使用库来帮助您完成这项工作 - [**jQuery**](http://jquery.com)和[**MochiKit**](http://MochiKit.com)是我喜欢的两个，尽管还有其他的也可以。

* * *

在我开始写这个答案和我发布它的时间之间，有人发布了代码，展示了你将如何在 jQuery 中做这样的事情 - 正如你所看到的，更短！虽然我喜欢图书馆，但我知道有些人不能或不会使用图书馆——在这些情况下，我的代码应该可以完成这项工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T20:58:26.887

可能：

```
<script type="text/javascript">
//getParent(startElement,"tagName");
function getParent(elm,tN){
  var parElm = elm.parentNode;
  while(parElm.tagName.toLowerCase() != tN.toLowerCase())
    parElm = parElm.parentNode;
  return parElm;
}
</script>

<tr><td><input type="..." onfocus="getParent(this,'td').style.backgroundColor='#400';" onblur="getParent(this,'td').style.backgroundColor='';"></td></tr> 
```

# sql - 在一组两种可能性中选择唯一行

> ID：150610
> 
> 赞同：3
> 
> 时间：2008-09-29T20:53:41.737
> 
> 标签：sql, mysql, sql-server, database, postgresql

问题本身很简单，但我无法找出在一个查询中解决问题的解决方案，这是我对问题的“抽象”，以便进行更简单的解释：

**我会保留我原来的解释，但这里有一组示例数据和我期望的结果：**

好的，这是一些示例数据，我用空行分隔了对

```
-------------
| Key |  Col | (Together they from a Unique Pair)
--------------
|  1     Foo |
|  1     Bar |
|            |
|  2     Foo |
|            |
|  3     Bar |
|            |
|  4     Foo |
|  4     Bar |
-------------- 
```

我期望的结果是，**在运行一次查询之后**，它需要能够在一个查询中选择这个结果集：

```
1 - Foo
2 - Foo
3 - Bar
4 - Foo 
```

*原文解释：*

我有一个表，把它称为`TABLE`我有两列的地方`ID`，`NAME`它们一起构成了表的主键。现在我想在哪里选择一些东西，`ID=1`然后首先检查它是否可以找到`NAME`值“John”的行，如果“John”不存在，它应该寻找`NAME`“Bruce”所在的行 - 但只返回“John”如果“布鲁斯”和“约翰”都存在，或者当然只有“约翰”存在。

另请注意，它应该能够为每个查询返回几行匹配上述条件但当然具有不同的 ID/名称组合，并且上述解释只是对实际问题的简化。

我可能完全被自己的代码和思路蒙蔽了双眼，但我就是想不通。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T21:41:07.177

这与您编写的内容非常相似，但应该相当快，因为​​在这种情况下，NOT EXISTS 比 NOT IN... 更有效

```
mysql> select * from foo;
+----+-----+
| id | col |
+----+-----+
|  1 | Bar | 
|  1 | Foo | 
|  2 | Foo | 
|  3 | Bar | 
|  4 | Bar | 
|  4 | Foo | 
+----+-----+

SELECT id
     , col
  FROM foo f1 
 WHERE col = 'Foo' 
  OR ( col = 'Bar' AND NOT EXISTS( SELECT * 
                                     FROM foo f2
                                    WHERE f1.id  = f2.id 
                                      AND f2.col = 'Foo' 
                                 ) 
     ); 

+----+-----+
| id | col |
+----+-----+
|  1 | Foo | 
|  2 | Foo | 
|  3 | Bar | 
|  4 | Foo | 
+----+-----+ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T21:06:29.770

您可以使用这样的 OUTER JOIN 将初始表连接到自身：

```
create table #mytest
   (
   id           int,
   Name         varchar(20)
   );
go

insert into #mytest values (1,'Foo');
insert into #mytest values (1,'Bar');
insert into #mytest values (2,'Foo');
insert into #mytest values (3,'Bar');
insert into #mytest values (4,'Foo');
insert into #mytest values (4,'Bar');
go

select distinct
   sc.id,
   isnull(fc.Name, sc.Name) sel_name
from
   #mytest sc

   LEFT OUTER JOIN #mytest fc
      on (fc.id = sc.id
          and fc.Name = 'Foo') 
```

像那样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-14T13:28:17.430

无需使这过于复杂，您只需使用`MAX()`和`group by ...`

```
select id, max(col) from foo group by id 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:06:27.307

试试这个：

```
select top 1 * from (
SELECT 1 as num, * FROM TABLE WHERE ID = 1 AND NAME = 'John'
union 
SELECT 2 as num, * FROM TABLE WHERE ID = 1 AND NAME = 'Bruce'
) t
order by num 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T21:11:07.763

我自己想出了一个解决方案，但它有点复杂和缓慢 - 它也不能很好地扩展到更高级的查询：

```
SELECT *
FROM users
WHERE name = "bruce"
OR (
    name = "john"
    AND NOT id
    IN (
        SELECT id
        FROM posts
        WHERE name = "bruce"
    )
) 
```

没有重连接等没有替代品？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T21:18:11.147

好的，这是一些示例数据，我用空行分隔了对

```
-------------
| Key |  Col | (Together they from a Unique Pair)
--------------
|  1     Foo |
|  1     Bar |
|            |
|  2     Foo |
|            |
|  3     Bar |
|            |
|  4     Foo |
|  4     Bar |
-------------- 
```

我期望的结果是：

```
1 - Foo
2 - Foo
3 - Bar
4 - Foo 
```

我确实在上面解决了它，但是对于较大的表来说，该查询的效率非常低，还有其他方式吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T21:48:14.293

下面是一个适用于 SQL Server 2005 及更高版本的示例。这是一个有用的模式，您希望根据自定义排序选择顶行（或前 n 行）。这将使您不仅可以在具有自定义优先级的两个值中进行选择，还可以选择任何数字。您可以使用 ROW_NUMBER() 函数和 CASE 表达式：

```
CREATE TABLE T (id int, col varchar(10));

INSERT T VALUES (1, 'Foo')
INSERT T VALUES (1, 'Bar')
INSERT T VALUES (2, 'Foo')
INSERT T VALUES (3, 'Bar')
INSERT T VALUES (4, 'Foo')
INSERT T VALUES (4, 'Bar')

SELECT id,col
FROM 
(SELECT id, col,
    ROW_NUMBER() OVER (
    PARTITION BY id 
    ORDER BY 
    CASE col 
    WHEN 'Foo' THEN 1
    WHEN 'Bar' THEN 2 
    ELSE 3 END
    ) AS RowNum 
    FROM T
) AS X
WHERE RowNum = 1
ORDER BY id 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-29T20:57:20.057

您可以使用连接而不是存在，这可能会在优化器不够智能的情况下改进查询计划：

```
SELECT f1.id
  ,f1.col
FROM foo f1 
LEFT JOIN foo f2
  ON f1.id = f2.id
  AND f2.col = 'Foo'
WHERE f1.col = 'Foo' 
  OR ( f1.col = 'Bar' AND f2.id IS NULL ) 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-29T21:08:34.990

在 PostgreSQL 中，我相信它会是这样的：

```
SELECT DISTINCT ON (id) id, name
FROM mytable
ORDER BY id, name = 'John' DESC; 
```

更新 - 在真之前的错误排序 - 我最初是倒退的。请注意，DISTINCT ON 是 PostgreSQL 功能，而不是标准 SQL 的一部分。这里发生的是它只向您显示它遇到的任何给定 id 的第一行。由于我们按天气排序，名称为 John，因此将选择名为 John 的行而不是所有其他名称。

对于您的第二个示例，它将是：

```
SELECT DISTINCT ON (key) key, col
FROM mytable
ORDER BY key, col = 'Foo' DESC; 
```

这会给你：

```
1 - Foo
2 - Foo
3 - Bar
4 - Foo 
```

# mysql - 如何从 Varchar 中选择“值”不属于组的情况

> ID：150622
> 
> 赞同：1
> 
> 时间：2008-09-29T20:56:53.427
> 
> 标签：mysql

我正在尝试这样做

```
SELECT `Name`,`Value` FROM `Constants` 
WHERE `Name` NOT IN ('Do not get this one'|'or this one'); 
```

但这似乎不起作用。

我如何获得所有值，除了少数几个，而不这样做：

```
SELECT `Name`,`Value` FROM `Constants` 
WHERE `Name` != 'Do not get this one' 
AND `Name` != 'or this one' 
```

第一个适用于 int 值，但不适用于 varchar，是否有类似于第一个的语法，其执行类似于第二个查询？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T20:58:09.353

您应该将常量放在一个表中，然后从该表中执行一个 select 语句。如果您绝对不想要永久表，则可以使用临时表。如果不想这样做，您可以使用 IN 语法：

不在（'一'，'二'）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T20:58:02.507

它是`IN('foo', 'bar')`，带逗号，而不是管道。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T20:58:37.807

IN 语法使用逗号分隔的列表

```
SELECT `Name`,`Value` FROM `Constants` WHERE `Name` NOT IN ('Do not get this one','or this one'); 
```

# ruby - 红宝石出轨

> ID：150638
> 
> 赞同：114
> 
> 时间：2008-09-29T21:00:38.990
> 
> 标签：ruby

有时感觉我的公司是世界上唯一使用 Ruby 但不使用 Ruby on Rails 的公司，以至于 Rails 几乎成为 Ruby 的代名词。

我敢肯定这不是真的，但是听到一些关于非 Rails Ruby 使用的故事会很有趣。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-30T01:24:28.060

Ruby 的巨大优势之一是能够非常轻松地创建 DSL。Ruby 允许您以自然语言的方式创建“业务规则”，这对于业务分析师来说通常很容易使用。出于此目的，存在许多 Web 开发之外的 Ruby 应用程序。

我强烈推荐谷歌搜索“ruby dsl”以获得一些优秀的阅读，但我想特别给你留下一篇文章。Russ Olsen 写了一篇关于[DSL的](http://jroller.com/page/rolsen?entry=building_a_dsl_in_ruby1)[两部分博客文章](http://jroller.com/page/rolsen?entry=building_a_dsl_in_ruby)。我看到他做了一个关于 DSL 的演讲，非常好。我强烈建议阅读这些帖子。

我还发现[了 Obie Fernandez 关于 Ruby DSL 的精彩演示](http://obiefernandez.com/presentations/obie_fernandez-agile_dsl_development_in_ruby.pdf)。强烈推荐阅读！

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-30T03:05:44.227

我在工作中广泛使用 Ruby，但没有一个是基于 Rails（甚至是 Web）的。

我的领域通常是客户端[Windows](http://rubyonwindows.blogspot.com/)应用程序（wxRuby GUI）和脚本，自动化 Excel、Internet Explorer、SQL Server 查询和报告生成（win32ole COM 自动化）。我还将 sqlite、pdf-writer 和 gruff 库用于各种数据处理和图形生成任务。

Rails 的成功对 Ruby 来说意义重大，但我同意 Rails 受到如此多的关注，以至于 Ruby 在 Web 之外的价值经常被忽视。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-30T23:03:11.043

我们主要是一家 C++ 商店，但我们发现了 Ruby 已被证明非常有用的几个领域。这里有几个：

*   代码生成 - 构建了几个 DSL 以从单个输入文件生成 C++/Java/C# 代码
*   建立支持
    *   从 Visual Studio 项目文件为 unix 生成 Makefile 的脚本
    *   用于构建项目和格式化 Cruise Control 输出的脚本
    *   用于运行我们的单元测试和格式化 Cruise Control 输出的脚本
    *   用于从命令行操作 Visual Studio 项目和解决方案的脚本
*   集成测试 - 我们可以使用 Ruby 比 C++ 更快、更清晰地完成测试
*   QA 的整个测试套件都是用 Ruby 编写的

Ruby 基本上是我在有意义的地方的首选工具。这在很多地方都有意义。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-19T06:11:08.157

Google [Sketchup](http://sketchup.google.com/)使用 Ruby 作为嵌入式脚本语言。您可以使用它来执行各种 3D 建模和导入/导出任务。该脚本适用于免费版本，甚至还有不错的[文档](http://sketchup.google.com/community/developers.html)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-30T03:29:29.630

带有用 C++ 编写的自制扩展的 Ruby 为我的摄影处理完成了所有繁重的像素推送。我用的是 Python+numpy，但在做[艺术](http://www.jeffcottwilson.com/)的时候，Ruby 更有趣。此外，良好的图像处理库相对缺乏或不太成熟，这让我感觉不像是在重新发明轮子。我对 Rails 一无所知，除了我听说过之外，对它是什么有一个模糊的概念，实际上有一本书（未打开）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-05T14:12:40.663

我们使用[Watir](http://wtr.rubyforge.org/)（Ruby 库）来测试我们的 .net Web 应用程序。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-29T21:59:00.393

查看[Shoes](http://shoooes.net/)，这是一个简单的 API，用于在 Ruby 中针对新手程序员构建 GUI。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-02T02:36:46.510

或者你可以使用 Ruby 来制作音乐，比如 Giles Bowkett 的 Archaeopteryx。[贾尔斯关于始祖鸟](http://www.infoq.com/presentations/archaeopteryx-bowkett)的演讲是有史以来最好的演讲之一。我强烈推荐它。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-03-03T06:53:56.787

RubyCocoa 和 MacRuby。可以在没有 Rails 的情况下制作完整的基于 Cocoa 的 GUI 应用程序。然后你也可以使用 Interface Builder。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-07-21T07:28:38.563

去年我参与了一个博物馆项目，该项目使用了很多 Ruby。( [http://http://ourspace.tepapa.com/home](http://http://ourspace.tepapa.com/home) )

我花费大部分时间的部分是交互式平面图。地板上的地图有传感器，所以当人们在上面行走时，灯光会被触发，并在墙上显示图像或视频，并播放音轨。

这部分展览的所有控制代码都是红宝石。我用 ruby​​ 包装器编写了 C 接口，以与地板传感器和照明控制器进行通信。系统查询 MYSQL 数据库以获取要显示的媒体文件，然后告诉墙中的计算机通过 UDP 播放媒体。

这是整个展览中最可靠的部分。

Ruby 被用于展览的另一个主要部分，即墙，尽管我与此没有太多关系。在移植到纯 Obj-C 之前，大多数图形都是使用 OpenGL 接口、一些 Cocoa 和一个物理库在 ruby​​ 中制作的原型。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-10-17T23:12:26.187

### 木偶和厨师：DevOps

在我到达之前的 30 个答案中，我没有看到提到[Puppet](http://docs.puppetlabs.com/references/latest/type.html)或[Chef](http://www.opscode.com/chef/)。Ruby 似乎主导了当前云自动化领域的工作，并且是这两个大玩家的基础、扩展和模板语言。它们主要用于为服务器阵列和一般 IT 工作站管理分发系统和应用程序配置信息。

[DevOps](http://en.wikipedia.org/wiki/DevOps)领域非常具有 Ruby 意识。今天，Perl 有一个竞争对手。虽然一个非常简单的脚本通常仍然可以直接为`sh(1),`复杂的任务编写，但现在可以用 Ruby 而不是 Perl 来完成。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-29T21:09:11.230

我在工作中使用 Ruby 完成的唯一网站是使用 Rails，但我想试试[Merb](http://merbivore.com/)。

除此之外，我在 Ruby 中做了很多小实用程序——例如一个读取 RSS 提要并将新帖子导入数据库的应用程序。

这很有趣，所以我也写了一些愚蠢的东西，只是因为它太快了。昨天我写了一个应用程序来玩100,000 次[蒙蒂霍尔问题](http://en.wikipedia.org/wiki/The_monty_hall_problem)，以帮助一位朋友说服她的教授，切换是正确的策略。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-05-27T20:11:37.150

我几乎要侮辱红宝石是一个轨道的东西。就像 CGI 是最新趋势的时候一样，每个人都认为如果你知道 perl，你一定会这样做，因为你编写了 CGI 应用程序。Ruby 对我来说只是一种脚本语言，虽然不如 python 成熟，所以我有点后悔不得不跳过它的一些障碍和最近的变化，我仍然喜欢它并使用它。虽然我在一家 java 商店工作，因此 groovy 是脚本语言的理想选择，但我仍然在家里使用 ruby​​ 并丢弃不需要在工作中共享的脚本。

我正在考虑从所有的嗡嗡声中进入 RoR 以及它是多么快速/简单，但是在查看 Rails 之后，我没有看到任何令人惊奇的东西，甚至没有看到任何与其他任何东西相比的创新或快速快速**的**发展框架。我看到的唯一好处是我可以用 ruby​​ 编码，这很好，但初始设置、服务器维护和扩展更加困难，因此重新抵消了用 ruby​​ 编码的乐趣。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-01-04T18:39:32.297

我创建了一个演示文稿——巧合地命名为 Off The Rails——来讨论基于 Rack 的 Web 应用程序：

[https://github.com/alexch/Off-The-Rails](https://github.com/alexch/Off-The-Rails)

git repo 包括 Markdown 格式的幻灯片和示例代码（以正在运行的应用程序和中间件的形式）。这是摘要：

> Ruby on Rails 是最流行的 Ruby Web 应用程序框架。但它不是唯一的！如果你觉得 Rails 太大了，或者太自以为是，或者其他任何东西，你可能会很高兴了解基于 Rack 构建的新一代所谓的微框架。而且由于 Rails 3 本身就是一个 Rack 应用程序，因此您不必放弃 Rails 即可获得 Sinatra 路由或 Grape API 的好处。

这里有一些参考：

*   该演讲位于[https://github.com/alexch/off-the-rails](https://github.com/alexch/off-the-rails)
*   [Yehuda 最喜欢 Ruby 的 10 件事](http://yehudakatz.com/2009/08/24/my-10-favorite-things-about-the-ruby-language/)
*   [架子](http://rack.rubyforge.org/)
    *   [机架测试](https://github.com/brynary/rack-test)
    *   [机架客户端](https://github.com/halorgium/rack-client)
*   [辛纳特拉](http://sinatrarb.com)
*   [葡萄](https://github.com/intridea/grape)
*   [维加斯](https://github.com/alexch/vegas)
*   [午休](https://github.com/alexch/siesta)
*   [重新运行](https://github.com/alexch/rerun)

希望你觉得它有用！

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-04-13T17:10:03.943

我主要是一名 Web 开发人员，我学习 Ruby 以使用 Rails，但我非常喜欢这种语言，因此我开始使用 JRuby 和 Monkeybars 用 Ruby 开发桌面 Swing 应用程序。我精通 Java，但不太喜欢使用它，而且 Swing API 很糟糕，所以将 Ruby 放在首位是一个巨大的胜利。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-09-29T21:08:06.803

我们主要使用 Rails，但我们还有很多其他非 Rails 的 ruby​​ 东西——例如用于集中验证用户的独立身份验证守护进程，以及运行任意数量的 ruby​​ 进程以并行处理图像的“图像处理服务器”。

哦，别忘了老瑞克 :-)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-30T04:21:44.497

Ruby 也用于桌面应用程序。特别是使用JRuby 开发Swing 桌面应用程序。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-09-30T18:01:31.640

我在工作中使用过 Ruby

*   数据提取器，从二进制输出生成 csv 文件。
*   .ini 文件生成器，将简单的语法转换为重复的 .ini 格式。
*   一个简单的 TCP/IP 服务器，在测试期间充当客户系统的替身。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-10-01T08:40:55.647

我们使用 Ruby 来实现我们的测试自动化软件。这包括 Selenium RC、WATIR 和 AutoIT 的测试框架和驱动程序代码。

Ruby 足够强大，可以创建可以与 Selenium 或 WATIR 等测试工具交互的综合应用程序，同时从数据文件中读取数据，与远程 Windows UI 交互并执行近乎透明的网络通信。在 Windows 或 Linux 上运行时。

整洁的语法使其成为新手和没有经验的程序员阅读的理想选择。虽然它完全 OO 的性质使这些程序员从一开始就可以轻松地应用好的（最近学习的）OO 技术。

Ruby 语法的灵活特性也使得 DSL 的使用和创建更加容易。这允许技术含量较低的人参与、阅读并可能在那里创建自己的测试。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-10-01T10:17:18.707

我曾在一个需求不稳定的项目中使用 Ruby 生成 C# 和 T-SQL 存储过程的代码。数据模型在 YAML 文件中编码，.erb 模板用于类和存储过程。与直接使用 C# 相比，它还允许提供更 DRY 的解决方案，因为重复代码可以分解为代码生成器中的单个方法。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-10-05T14:23:37.257

在我工作的地方，我们使用 Ruby 执行许多不同的一次性类型的批处理作业。其中一个例子是与 Amazon 的 S3 服务交互的作业。当时，Ruby S3 库可能是最容易让我们在短时间内启动和运行的库。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2008-10-07T19:37:59.120

我编写了一个订单处理专家系统（也请参见 DSL 答案），将 100k 行客户特定的 perl 转换为大约 10k 行 ruby​​ 处理数十个客户。根本没有 Web 组件，没有 Rails。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2009-07-08T08:22:29.577

我是网络驱动程序用户。由于 rake，webdriver 使用 ruby​​ 来自动化构建过程。有关详细信息， 请参阅[http://code.google.com/p/webdriver/](http://code.google.com/p/webdriver/)

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2009-09-02T03:16:32.573

呵呵，好问题。

我使用 Ruby 将 Excel 电子表格机场设施数据转换为用于 android 手机平台的 sqlite3，同时为飞行员制作应用程序。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2009-11-13T16:21:46.107

我使用 Ruby 和 Sinatra，它比 Rails 简单得多。我确实使用过 Rails，但发现它已经变成了一个怪物，尽管与 Java 可用的 Web 框架相比，Rails 仍然令人惊叹。

然而，我喜欢 Ruby 的主要特性是“eval”和“method_missing”，Rails 实际上在 ActiveRecord 中使用了它们，以便您可以使用惊人的“find_by-field-name-”查询。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2010-03-31T07:02:06.003

我将 Ruby 用于很多后端代码，仅仅是因为我是唯一一个负责执行此任务的人，并且需要一种干净的语言，让我能够非常高效地编写易于维护的代码。我发现 Ruby 比 Perl 和 Python 更容易做到这一点。其他人的里程可能会有所不同，但对我来说效果很好。

除此之外，我喜欢 Sequel 和 Nokogiri 的工作方式。我还单独使用了一段时间的 ActiveRecord 和 Rails。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2008-09-29T21:07:52.717

我们使用一些 Ruby 进行文件操作，但还不能合并 Rails。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2008-09-29T23:56:39.563

我已经专业地使用 Ruby 来快速编写脚本，例如随机播放文件。在接触 Rails 之前，我首先使用 Ruby。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2008-09-30T03:32:11.717

在 Boulder，有一群优秀的 Ruby 用户每月见面。有人提出了这一点——除了在 Rails 中的使用之外，Ruby 确实存在。普通的 Ruby 用户确实存在，他们正在乞求关注，有漂亮的东西要展示，并且可以在用户组会议上找到彼此。

他们的披萨也比 Python 小组更好，他们也在同一天见面。只能选一个...

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2009-03-05T15:43:14.673

虽然我们确实有几个 Rails 应用程序在工作，但我们也将 Ruby 用于一些相当密集的非 Web 内容。

我们有一个 SMS 传递守护程序，它从队列中提取消息然后传递它们，以及其他应用程序可以调用的信用卡处理守护程序，它确保有一个中央审计跟踪。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-04-16T19:36:08.940

我自己单独使用 ruby​​ 并与框架导轨结合使用。我制作了一个 ruby​​ 应用程序，它每天从网站中提取所有高分并将其放入 mysql 数据库中。这是迄今为止我自己用红宝石制作的第一个也是唯一一个应用程序

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-06-22T10:47:10.790

我在工作中经常使用 Rails，但对于较小的应用程序或简单的基于 REST 的服务，我倾向于使用[Sinatra](http://www.sinatrarb.com)。我也在用 Ruby 编写文字冒险游戏来取乐。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-07-07T19:22:05.400

在工作中，我使用 Ruby 为 Windows 编写所有脚本。多亏了这一点，我可以和 Dos 脚本说再见了

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2011-01-17T06:32:42.503

除了 Rails，我还在以下中小型项目中广泛使用 ruby​​：

1.  在大型分层文本文件解析中（某种程度上类似于 YAML 结构）
2.  专门的小型网络蜘蛛。
3.  三个 Sinatra 应用程序。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2011-07-01T15:57:13.250

Ruby 非常强大，Rails 很好地证明了它在 Web 服务中的强大功能。

尽管如此，Ruby 继续（并将继续）在不同的环境中变得更加普遍，如系统管理、脚本、自动化......

问题是，在此过程中，Rails 获得了如此之多的名声，以至于“遮蔽”了 Ruby，并使它看起来像是 Ruby 追随 Rails。但正如这篇文章中的答案数量所证明的那样，Ruby 不仅仅是 Rails。

当我在搜索 Ruby 时，我也感到“痒”，并且不得不不断偏离 Rails 信息，这会妨碍我……但是，Rails 也为 Ruby 的增长和营销做出了很大贡献：）

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-09-29T21:07:54.477

我没有做过任何非 Rails Ruby Web 开发，但我所有的[Project Euler](http://projecteuler.net/)解决方案都在 Ruby 中，以及其他一些小项目，比如我的[IRC bot](http://lucasoman.com/files/code/rubot/)。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-09-30T18:18:40.493

Rails 的*一部分*是否重要？我们将 Ruby 用于 ETL 应用程序，并插入 ActiveRecord 仅用于模型验证。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2018-04-03T15:09:25.877

我继承了一个遗留应用程序，该应用程序支持一些知名约会网站的移动设备（由于机密性，我不会命名）。

遗留应用程序使用 Ruby，但不使用 Rails。原始应用程序使用 Rails 的前身，称为“Merb”（[https://en.wikipedia.org/wiki/Merb](https://en.wikipedia.org/wiki/Merb)）

部分应用程序已被移植以使用不同的技术将技术分离为后端和前端层。后端层使用纯 ruby​​，前端使用带有一些 NodeJS 集成的 ReactJS。

# .net - 当 ThreadPool.QueueUserWorkItem 返回 false

> ID：150645
> 
> 赞同：6
> 
> 时间：2008-09-29T21:01:47.737
> 
> 标签：.net, multithreading, concurrency, threadpool

MSDN 声明该方法返回

> 如果方法成功排队，则为 true；如果工作项未排队，则会引发 NotSupportedException。

出于测试目的，如何让方法返回`false`？或者它只是一个“次优”的类设计？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T21:10:12.803

在查看 Reflector 中的源代码时，似乎代码中唯一可能返回“false”的部分是对以下内容的调用：

```
[MethodImpl(MethodImplOptions.InternalCall)]
private static extern bool AdjustThreadsInPool(uint QueueLength); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T21:03:41.430

这可能是“保留以备将来使用”的情况。您可能想将其视为失败，但很难测试。

我几乎将此方法视为无效/子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T21:06:48.833

可以想象，当任务并行库 (TPL) 到来时，整个 API（线程池）都会过时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T21:17:29.480

> 如果方法成功排队，则为 true；如果工作项未排队，则会引发 NotSupportedException。

对待 a`return false`的方式与对待 a 的方式相同`NotSupportedException`。

要让它返回 false，请使用模拟方法或对象。
您想测试您自己编写的代码，而不是底层的 Windows 代码。我确信微软已经为此进行了大量测试。

# java - 如何使用 JXL 创建新的 Excel 文件？

> ID：150646
> 
> 赞同：10
> 
> 时间：2008-09-29T21:02:09.517
> 
> 标签：java, jxl

我正在尝试使用 jxl 创建一个新的 Excel 文件，但是很难在他们的 API 文档和在线中找到示例。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T21:16:38.200

在搞砸了一段时间后，我终于找到了一些有用的东西，发现这里还没有发布解决方案，所以这就是我发现的：

```
try {
    String fileName = "file.xls";
    WritableWorkbook workbook = Workbook.createWorkbook(new File(fileName));
    workbook.createSheet("Sheet1", 0);
    workbook.createSheet("Sheet2", 1);
    workbook.createSheet("Sheet3", 2);
    workbook.write();
    workbook.close();
} catch (WriteException e) {

} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-08-28T23:26:47.600

我知道这是一个非常古老的问题。但是，我认为我可以提供一个还添加单元格值的示例：

```
/**
 *
 * @author Almir Campos
 */
public class Write01
{
    public void test01() throws IOException, WriteException
    {
        // Initial settings
        File file = new File( "c:/tmp/genexcel.xls" );
        WorkbookSettings wbs = new WorkbookSettings();
        wbs.setLocale( new Locale( "en", "EN" ) );
        // Creates the workbook
        WritableWorkbook wwb = Workbook.createWorkbook( file, wbs );
        // Creates the sheet inside the workbook
        wwb.createSheet( "Report", 0 );
        // Makes the sheet writable
        WritableSheet ws = wwb.getSheet( 0 );
        // Creates a cell inside the sheet
        //CellView cv = new CellView();
        Number n;
        Label l;
        Formula f;
        for ( int i = 0; i < 10; i++ )
        {
            // A
            n = new Number( 0, i, i );
            ws.addCell( n );
            // B
            l = new Label( 1, i, "by" );
            ws.addCell( l );
            // C
            n = new Number( 2, i, i + 1 );
            ws.addCell( n );
            // D
            l = new Label( 3, i, "is" );
            ws.addCell( l );
            // E
            f = new Formula(4, i, "A" + (i+1) + "*C" + (i+1) );
            ws.addCell( f );
        }
        wwb.write();
        wwb.close();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-04-11T19:58:01.430

首先你需要把 JXL Api 放到你的 java 目录下，从[http://www.andykhan.com/](http://www.andykhan.com/)下载 JXL api解压，复制 jxl 并像 C:\Program Files\Java\jre7\lib\ext 一样粘贴。

```
try {
    String fileName = "file.xls";
    WritableWorkbook workbook = Workbook.createWorkbook(new File(fileName));
    WritableSheet writablesheet1 = workbook.createSheet("Sheet1", 0);
    WritableSheet writablesheet2 = workbook.createSheet("Sheet2", 1);
    WritableSheet writablesheet3 = workbook.createSheet("Sheet3", 2);
    Label label1 = new Label("Emp_Name");
    Label label2 = new Label("Emp_FName");
    Label label3 = new Label("Emp_Salary");
    writablesheet1.addCell(label1);
    writablesheet2.addCell(label2);
    writablesheet3.addCell(label3);
    workbook.write();
    workbook.close();
} catch (WriteException e) {

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:07:38.300

不确定您是否需要坚持使用 JXL，但处理 Excel 文件的最佳库是[Apache 的 POI HSSF](http://poi.apache.org/hssf/index.html)。

我认为我提供的网站上有很多示例，但是如果您需要进一步的帮助，请告诉我。我可能有一些例子。

出于好奇，POI 代表糟糕的混淆接口，而 HSSF 是可怕的电子表格格式。您会看到 Apache 多么喜欢 Microsoft Office 格式 :-)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-06-09T17:44:13.507

```
public void exportToExcel() {
    final String fileName = "TodoList2.xls";

    //Saving file in external storage
    File sdCard = Environment.getExternalStorageDirectory();
    File directory = new File(sdCard.getAbsolutePath() + "/javatechig.todo");

    //create directory if not exist
    if(!directory.isDirectory()){
        directory.mkdirs();
    }

    //file path
    File file = new File(directory, fileName);

    WorkbookSettings wbSettings = new WorkbookSettings();
    wbSettings.setLocale(new Locale("en", "EN"));
    WritableWorkbook workbook;

    try {
        workbook = Workbook.createWorkbook(file, wbSettings);
        //Excel sheet name. 0 represents first sheet
        WritableSheet sheet = workbook.createSheet("MyShoppingList", 0);

        Cursor  cursor = mydb.rawQuery("select * from Contact", null);

        try {
            sheet.addCell(new Label(0, 0, "id")); // column and row
            sheet.addCell(new Label(1, 0, "name"));
            sheet.addCell(new Label(2,0,"ff "));
            sheet.addCell(new Label(3,0,"uu"));
            if (cursor.moveToFirst()) {
                do {
                    String title =cursor.getString(0) ;
                    String desc = cursor.getString(1);
                    String name=cursor.getString(2);
                    String family=cursor.getString(3);

                    int i = cursor.getPosition() + 1;
                    sheet.addCell(new Label(0, i, title));
                    sheet.addCell(new Label(1, i, desc));
                    sheet.addCell(new Label(2,i,name));
                    sheet.addCell(new Label(3,i,family));
                } while (cursor.moveToNext());
            }
            //closing cursor
            cursor.close();
        } catch (RowsExceededException e) {
            e.printStackTrace();
        } catch (WriteException e) {
            e.printStackTrace();
        }
        workbook.write();
        try {
            workbook.close();
        } catch (WriteException e) {
            e.printStackTrace();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
} 
```

# java - Java 混淆 - ProGuard/yGuard/其他？

> ID：150653
> 
> 赞同：19
> 
> 时间：2008-09-29T21:03:07.097
> 
> 标签：java, java-me, obfuscation, proguard, yguard

这与这些最近的问题类似：

[用于减少大小的最佳 Java 混淆应用程序](https://stackoverflow.com/questions/93290/best-java-obfuscation-application-for-size-reduction) [创建不可逆向工程的 Java 程序](https://stackoverflow.com/questions/149937/creating-non-reverse-engineerable-java-programs)

然而，一个人最终推荐了 yGuard 和另一个 ProGuard，但两者都没有提及。我想知道我们是否可以对每一个进行比较，并从围栏两边听取人们的经验。在 ProGuard 网站上查看此[比较图表](http://proguard.sourceforge.net/alternatives.html)，它明显倾向于 ProGuard。但是每个人的真实世界经验如何——哪一个产生的输出更小呢？哪个更难反编译？每个版本都支持哪些 Java 版本？

我个人对 J2ME 的观点特别感兴趣，但请不要将讨论局限于此。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-12-05T20:03:27.233

我的项目的结果。

*   **混淆**- 两者都很好。
*   **优化**- ProGuard 生成的代码速度提高了 20%（针对测量的应用程序瓶颈）。
*   **紧凑性**- ProGuard 小约 5%。
*   **配置 / Ant** - YGuard 更容易配置。

所以，我建议 ProGuard - 但配置和 ant 集成肯定可以改进。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T11:45:24.063

Proguard是更好的产品；特别是如果您花时间检查 J2ME 的设置。

专门针对 J2ME，有一个更好的（商业）产品，称为[mBooster](http://www.innaworks.com/mBooster.html)

在通过 Proguard*之后*，我的应用程序的大小已经得到了大约 25% 的改进。这主要是为了更好地对 Jar 文件进行 Zip 压缩以及对类合并和预验证的全面支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T21:31:16.043

我的意见是 - ProGuard 更好。输出小了一点。优化更好更快。

在这两种情况下，反编译都很简单。好吧，我的意思是，如果你非常了解 Java 并且真的*了解*你正在反编译的业务逻辑，那么从混淆类中将其返回到源代码是没有问题的。

所以，我认为 ProGuard 更好。

# .net - 如何在企业库 4.0 中创建自定义日志过滤器？

> ID：150666
> 
> 赞同：2
> 
> 时间：2008-09-29T21:05:55.123
> 
> 标签：.net, logging, enterprise-library

我正在使用 Enterprise Library 4.0，但找不到任何有关创建自定义日志过滤器的文档。有没有人这样做或看到任何好的在线文档？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T21:53:36.267

[http://geekswithblogs.net/.NETonMyMind/archive/2006/05/15/78201.aspx](http://geekswithblogs.net/.NETonMyMind/archive/2006/05/15/78201.aspx)

伟大的文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T03:30:26.960

如果文档很少，仔细阅读 EntLib 的源代码可能会对您有所帮助；它写得很好，评论也很好。

# rdf - 你使用 Microformats、RDF、Dublin Core 还是其他类型的语义标记？

> ID：150669
> 
> 赞同：6
> 
> 时间：2008-09-29T21:06:23.217
> 
> 标签：rdf, semantic-web, microformats

您使用这些技术中的任何一种吗？哪些是最新的，因此可以包含在网站中？

任何文档似乎都相对稀疏，并且随着搜索引擎变得越来越好，它们中的任何一个的使用都受到限制，它们甚至不再相关了吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T21:20:07.350

我尽可能使用微格式。通常它还是有意义的，当我有一个地址块时，我可能希望对某些元素进行不同于其他元素的样式设置，这使得它非常容易。微格式并不是那么难以弄清楚。

有几个例子，因为我使用的是微格式，我能够在其他地方重用网站某个部分的标记（作为包含），而不必更改标记，只有造型。

最后，自从我真正声明要探索微格式以来，我在编写语义标记和命名 CSS 类方面变得更好了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-16T00:41:32.640

我使用 SIOC、FOAF、DOAP 和其他一些轻量级 RDF 词汇表。现在流行的趋势是使用 RDFa 将 RDF 嵌入到 Web 文档中。那时，黑白 RDF 词汇和微格式的边界开始消失。

随着搜索引擎变得更好，对语义标记的需求将会增加。例如，看看 Yahoo SearchMonkey 应用程序可以使用的微格式和词汇： [SearchMonkey 词汇](http://developer.yahoo.com/searchmonkey/smguide/profile_vocab.html)

一旦搜索引擎能够理解更丰富的数据（即使最初只是为了显示关于找到的匹配的更丰富的数据），人们也会有更多的动机使用语义标记。

您认为缺少哪些额外的文档并且拥有这些文档会有用？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T21:34:30.187

这三个我都用过，但我不得不说微格式现在最有动力。它的优点是非常容易在现有站点上实施，即使是事后考虑。虽然目前微格式消费者似乎并不多，但随着下一代浏览器的出现，这种情况开始发生变化。

至于一般语义标记的相关性，任何使数据收集自动化变得更容易的东西都将有助于使用该数据的应用程序的更丰富的生态系统。依靠搜索引擎进行这种上下文处理并不能满足更集中或利基应用程序的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:42:24.260

我们在 Praized 开发的发布者工具中烘焙了微格式（主要是在[我们提供给博主的插件工具中](http://praizedmedia.com/en/download/)）

由于我们系统中的核心对象是“地点”，我们认为输出微格式对我们来说是明智的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T21:58:21.333

[我使用 RDFa](http://feelitlive.com/events/2009/4/9/NW5/1JY/The+Forum/The+Sisters+Of+Mercy)是因为它的重要功能是可以说出任何事情，甚至是非常奇怪或晦涩的事实（例如[考古发现](http://rdfa.info/2008/12/05/rdfa-used-in-classification-of-ancient-ceramics/)的属性，或者帕丽斯·希尔顿在 MySpace 上[的朋友数量](http://cantorva.com/blog/2009/03/27/rdfa-is-smoking/)），并且可以毫不含糊地做到这一点。

我最近正在开发[一个 Search Monkey 插件来显示嵌入为 RDFa 的 VCal 数据](http://cantorva.com/blog/2009/04/03/vcal-rdfa-and-search-monkey/)，并且偶然发现了一些你只需要额外的一点点数据来连接事物的情况。它们是：将演示文稿连接到演示文稿期间使用的幻灯片，并将网页连接到其主要主题，这样您就可以准确地了解页面的内容。

很难看出您将如何使用微格式回答这些用例，标记中既没有上下文也没有精度。随着时间的推移，我会想在我的 RDFa 中添加更多细节，以帮助不同的人群找到我的页面并购买东西。

Dublin Core 在 RDF 和 RDFa 中可用，但据我所知，旧的 DC 元标记与 Microformats 有类似的问题，甚至更低的活跃使用率。

我同意 CaptSolo 的观点，虽然 DC 和其他元数据标准已经过时，但 RDFa 是一个增长领域。[RDFa.info](http://rdfa.info/)记录每个新用户的出现。我会进一步预测，随着更多人“获得”RDF 和更多 RDF 感知工具的产生，微格式将迅速消亡。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-26T05:08:46.430

在雅虎，我们支持页面标记中的 RDFa、eRDF 和微格式。

要查看我们的收获，请安装我的 SearchMonkey 插件，然后使用 Yahoo 进行任何搜索。您应该会在下方看到一个显示语义数据的信息栏。

由于我是新用户，因此无法发布链接，但请转到 SearchMonkey 库，并查找“结构化数据显示”。它的技术不足。

# c# - AJAX.NET 订阅 Reorderlist ItemCommand 还是 DeleteCommand？

> ID：150687
> 
> 赞同：0
> 
> 时间：2008-09-29T21:09:32.710
> 
> 标签：c#, asp.net, events, ajax.net, reorderlist

我想订阅我页面上的 Reorderlist 的 ItemCommand 事件。前端是这样的...

```
<cc1:ReorderList id="ReorderList1" runat="server" CssClass="Sortables" Width="400"  OnItemReorder="ReorderList1_ItemReorder" OnItemCommand="ReorderList1_ItemCommand">
...
<asp:ImageButton ID="btnDelete" runat="server" ImageUrl="delete.jpg" CommandName="delete" CssClass="playClip" />
...
</cc1:ReorderList> 
```

在后端，我在 Page_Load 上有这个

```
ReorderList1.ItemCommand += new EventHandler<AjaxControlToolkit.ReorderListCommandEventArgs>(ReorderList1_ItemCommand); 
```

并且定义了这个函数

```
protected void ReorderList1_ItemCommand(object sender, AjaxControlToolkit.ReorderListCommandEventArgs e)
    {
        if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
        {
            if (e.CommandName == "delete")
            {
                //do something here that deletes the list item
            }
        }
    } 
```

尽管我尽了最大的努力，但我似乎无法让这个活动开始。如何在 ReorderList 控件中正确订阅此事件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T01:38:49.247

这有效：

```
<cc2:ReorderList ID="rlEvents" runat="server" AllowReorder="True" CssClass="reorderList"
        DataKeyField="EventId" DataSourceID="odsEvents" PostBackOnReorder="False"
        SortOrderField="EventOrder" OnDeleteCommand="rlEvents_DeleteCommand">
...
<asp:ImageButton ID="btnDeleteEvent" runat="server" CommandName="Delete" CommandArgument='<%# Eval("EventId") %>' ImageUrl="~/images/delete.gif" />
...
</cc2:ReorderList> 
```

后面的代码：

```
protected void rlEvents_DeleteCommand(object sender, AjaxControlToolkit.ReorderListCommandEventArgs e)
{
   // delete the item
   // this will give you the DataKeyField for the current record -> int.Parse(e.CommandArgument.ToString());
   //rebind the ReorderList
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T01:29:16.050

由于您的 ImageButton `CommandName="delete"`，您应该连接到 DeleteCommand 事件而不是 ItemCommand。

# algorithm - 找到提供最佳压缩的前缀子字符串

> ID：150690
> 
> 赞同：2
> 
> 时间：2008-09-29T21:10:29.807
> 
> 标签：algorithm, compression, puzzle

**问题：**

给定一个字符串列表，找到子字符串，如果从它匹配的所有字符串的开头减去它并用转义字节替换，则得到最短的总长度。

**例子：**

`"foo"`, `"fool"`,`"bar"`

结果是： "foo" 作为带有字符串 、 和总长度为 9 个字节的`"\0"`基本`"\0l"`字符串`"bar"`。`"\0"`是转义字节。原始字符串的长度之和是 10，所以在这种情况下我们只保存了一个字节。

**一个朴素的算法看起来像：**

```
for string in list
  for i = 1, i < length of string
      calculate total length based on prefix of string[0..i]
      if better than last best, save it
return the best prefix 
```

这会给我们答案，但它有点像 O((n*m)^2)，太贵了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T21:19:26.620

使用前缀树的森林（特里）...

```
 f_2    b_1
 /       |
 o_2     a_1
 |       |
 o_2     r_1
 |
 l_1 
```

然后，我们可以通过最大化`(depth * frequency)`将替换为您的转义字符来找到最佳结果并保证它。您可以通过执行分支和绑定深度优先搜索最大值来优化搜索。

关于复杂性：O（C），如评论中所述，用于构建它并找到最优值，这取决于。如果您订购第一个元素的频率（O(A) - 其中 A 是语言字母表的大小），那么您将能够切出更多的分支，并且很有可能获得次线性时间。

我想这很清楚，我不会写出来——这是什么家庭作业？;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T21:15:36.550

我会尝试从对列表进行排序开始。然后，您只需从一个字符串到另一个字符串，将第一个字符与下一个字符串的第一个字符进行比较。一旦你有一个匹配，你会看下一个字符。您需要设计一种方法来跟踪迄今为止的最佳结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T21:19:28.227

好吧，第一步是对列表进行排序。然后遍历列表，将每个元素与前一个元素进行比较，跟踪最长的 2 字符、3 字符、4 字符等运行。那么数字是 20 个 3 字符前缀优于 15 个 4 字符前缀。

# sql-server - Sql Reporting Server Logs Errors的所有地方都在哪里？

> ID：150695
> 
> 赞同：12
> 
> 时间：2008-09-29T21:11:49.023
> 
> 标签：sql-server, reporting-services

似乎 Sql Reporting Services Server 在多个位置记录信息，包括 Web 服务器日志和数据库中的日志记录表。SSRS 记录到的所有位置在哪里，每个位置记录了哪些类型的错误？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-29T21:55:13.350

据我所知，SSRS 将日志记录到事件日志、文件系统和它自己的数据库中。

数据库通常是最容易获得的数据库。您只需登录 ReportServer 数据库并执行

```
select * from executionlog 
```

不过，这只会记录执行情况。如果您想了解更多信息，您可以访问跟踪日志文件，这些文件通常位于（当然位置可能会有所不同）：

```
C:\Program Files\Microsoft SQL Server\MSSQL.3\Reporting Services\LogFiles 
```

这些内容非常冗长，而且浏览起来并不有趣。但他们确实记录了很多东西。

如果您正在搜索错误，您可以转到 Windows 应用程序日志（在控制面板中的管理工具下）

**编辑**找到了一个不错的链接：
[https ://docs.microsoft.com/en-us/sql/reporting-services/report-server/reporting-services-log-files-and-sources](https://docs.microsoft.com/en-us/sql/reporting-services/report-server/reporting-services-log-files-and-sources)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-11-06T18:32:41.290

对于 SSRS 2008 R2：C:\Program Files\Microsoft SQL Server\MSRS10_50.MSSQLSERVER\Reporting Services\LogFiles

# version-control - Sun Solaris IDE/源代码控制选项

> ID：150698
> 
> 赞同：0
> 
> 时间：2008-09-29T21:13:03.530
> 
> 标签：version-control, ide, ftp, solaris, sun

在我的新工作中，我正在适应 IDE，我们在我们的 sun solaris 工作站上安装了 Visual SlickEdit 8.0，我们可以远程登录（哈哈，是的，ssh 已关闭）。

现在它做了基础知识，但缺少许多我认为必须具备的东西，比如代码隐藏和括号匹配。是否有任何替代方法可以不断地从我们的远程 sun 机器上对我的工作进行 ftp，以便我可以使用 Eclipse 的本地副本对其进行编辑，然后将其 ftp 回来。我们没有任何本地增量更新的源代码控制，所以如果我覆盖我的更改，我会搞砸并且有很多 ftping，我只能假设在我覆盖我的一些工作之前它只是时间问题。有什么想法或建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T21:17:21.053

哎呀，我建议你尽快研究某种类型的持续集成系统！就版本控制而言，Subversion 非常成熟和稳定，或者您可以使用即将推出的[GIT](http://git.or.cz/)系统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T06:17:51.200

我想你问了两个问题。一篇关于 IDE，一篇关于版本控制系统。我不知道有任何 IDE 可以很好地支持在只有 telnet 连接的系统上进行分布式开发。

我会推荐一个非常快速、轻量级的版本控制系统。然后使用您的本地 IDE，并将您的更改“推送”到 Solaris 框以进行构建。这是最简单的答案。

实际上，您可能是 NetBeans 6.5 中称为“远程开发”的新功能的灵长类候选者。NetBeans 还支持使用 gcc/gdb 或 Sun cc/dbx 开发 C/C++ 程序。远程开发就是针对这种情况而设计的。您可以在一台机器上编辑文件并在另一台机器上构建/运行它们。我认为它最适合两台机器之间的 NFS 访问，我不确定在需要更新远程主机时使用源代码控制“推送”更改是否足够聪明。我自己没有尝试太多，但你可能想研究一下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T10:17:44.733

至于补充/替换现有解决方案的本机 IDE，如果您可以运行本地 X 服务器，您有几个选择：

*   太阳工作室

    免费的“快速”版，或为 Sun Developer Network 会员免费的完整版。

*   蚀

    [据称是多平台的，但eclipse.org](http://www.eclipse.org)上不再提供 Solaris 软件包。但是[Blastwave](http://www.blastwave.org/packages.php/eclipse)确实提供了一个 Solaris 包（以及您还需要的多个依赖项）。

*   网豆

    本机 Solaris 包 FOSS 支持多种语言： http: [//www.netbeans.org/](http://www.netbeans.org)。拥有强大的支持和一些不错的功能（例如 Java GUI 设计器）。

*   维姆

    仅适用于顽固的 UNIXer :) Solaris Companion CD 上提供了旧版本的 vim，否则通常的地方有更新的软件包。对于这个解决方案，可以说的最好的事情是它是轻量级的，并且可以直接在您的 telnet (ick) 连接上工作，而无需您导出 X11。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T11:29:24.900

无法回答IDE问题，但是对于源代码控制，我可以衷心推荐GIT。我们最近在我们的 Solaris 环境中从 CVS 过渡到了 GIT，它非常棒。我们应该早点做。

# python - 有没有支持 CSS/样式表的 wxPython 的 Visual Library 替代品？

> ID：150705
> 
> 赞同：1
> 
> 时间：2008-09-29T21:15:09.377
> 
> 标签：python, wxpython

我开发了一个广泛使用 wxPython 的程序——python 的 wxWindow 端口。

即使它是成熟的库，它仍然非常原始且非常面向编程。这既费时又不灵活。

我很想看看是否有类似 Flex/Action Script 的东西，其中所有视觉尺寸都由样式表配置。

有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T21:19:38.490

带有[Qt 样式表的](http://doc.trolltech.com/4.4/stylesheet.html)[PyQt](http://wiki.python.org/moin/PyQt)可能是一个不错的选择。自然，您需要为工具包更改重新编写相当多的 GUI 层。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T21:18:59.427

您可以尝试 XUL，这是 Firefox GUI 使用的语言。它是用 CSS 设计的 XML 和用 Javascript 编写的脚本。

[http://www.mozilla.org/projects/xul/](http://www.mozilla.org/projects/xul/)
[http://en.wikipedia.org/wiki/XUL](http://en.wikipedia.org/wiki/XUL)
[http://developer.mozilla.org/en/XUL](http://developer.mozilla.org/en/XUL)

# c++ - 让 cin 读取返回字符的 C++

> ID：150726
> 
> 赞同：12
> 
> 时间：2008-09-29T21:19:05.480
> 
> 标签：c++, input, return, iostream, cin

我想知道如何使用`cin`，以便如果用户没有输入任何值而只是推动`ENTER`将其`cin`识别为有效输入。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T21:29:19.997

您可能想尝试`std::getline`：

```
#include <iostream>
#include <string>

std::string line;
std::getline( std::cin, line );
if( line.empty() ) ... 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T21:27:12.140

我发现对于用户输入`std::getline`来说效果很好。

您可以使用它来读取一行并丢弃它读取的内容。

做这样的事情的问题，

```
// Read a number:
std::cout << "Enter a number:";
std::cin >> my_double;

std::count << "Hit enter to continue:";
std::cin >> throwaway_char;
// Hmmmm, does this work? 
```

是如果用户输入其他垃圾，例如“4.5 - about”，那么在打印下一次需要查看的提示之前，很容易不同步并阅读用户上次写的内容。

如果您阅读每一个完整的行，`std::getline( std::cin, a_string )`然后解析返回的字符串（例如，使用 istringstream 或其他技术），即使面对乱码输入，也更容易保持打印提示与从 std::cin 读取同步。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T21:23:58.543

有没有cin。[getline 能](http://www.cplusplus.com/reference/iostream/istream/getline.html)解决你的问题吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-03-13T03:43:06.080

要检测用户按下 Enter 键而不是输入整数：

```
char c;
int num;

cin.get(c);               // get a single character
if (c == 10) return 0;    // 10 = ascii linefeed (Enter Key) so exit
else cin.putback(c);      // else put the character back
cin >> num;               // get user input as expected 
```

或者：

```
char c;
int num;
c = cin.peek();           // read next character without extracting it
if (c == '\n') return 0;  // linefeed (Enter Key) so exit
cin >> num;               // get user input as expected 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T21:32:40.533

尝试取消缓冲 cin （默认情况下它是缓冲的）。

# ruby - 在 Ruby 中写入文件的最佳方法是什么？

> ID：150731
> 
> 赞同：14
> 
> 时间：2008-09-29T21:19:34.077
> 
> 标签：ruby, file-io

我想在 Ruby 中将一些数据写入文件。最好的方法是什么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-29T21:23:15.207

```
File.open("a_file", "w") do |f|
    f.write "some data"
end 
```

您也可以使用`f << "some data"`或`f.puts "some data"`根据个人口味/需要来换行。如果要附加到文件而不是在每次打开时截断，请将更改为`"w"`。`"a"`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T11:44:09.380

```
require 'rio'
rio('foo.txt') < 'bar' 
```

[http://rio.rubyforge.org/](http://rio.rubyforge.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T21:33:00.423

除了[File.new](http://www.meshplex.org/wiki/Ruby/File_handling_Input_Output)或[File.open](http://www.ruby-doc.org/core/classes/File.html)（以及所有其他有趣的 IO 内容）之外，您可能希望，特别是如果您正在从 Ruby 保存和加载回 Ruby 并且您的数据在对象中，则可以考虑使用[Marshal](http://www.ruby-doc.org/core/classes/Marshal.html)来保存和加载您的直接对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T03:05:38.347

使用 File::open 是最好的方法：

```
File.open("/path/to/file", "w") do |file|
  file.puts "Hello file!"
end 
```

如前所述，您可以使用“a”而不是“w”来附加到文件。可能还有其他可用的模式，列在 下`ri IO`，或在[Ruby Quickref](http://www.zenspider.com/Languages/Ruby/QuickRef.html)中。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-29T21:21:56.520

```
filey = File.new("/path/to/the/file", APPEND)
filey.puts "stuff to write" 
```

# c# - 获取 VS 2008 工具窗口的 GUID

> ID：150735
> 
> 赞同：0
> 
> 时间：2008-09-29T21:20:13.870
> 
> 标签：c#, vb.net, visual-studio-2008, macros

是否有人可以在 VS 宏编辑器中运行关于如何枚举 VS 2008 中的工具窗口并显示每个工具窗口的 GUID 的简短代码示例？

或者你知道另一种方法来找出这个吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-29T23:40:00.230

您可以枚举 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\ToolWindows 下的子键

# ssh - 如何在 qnx 上安装 ssh 服务器？

> ID：150737
> 
> 赞同：9
> 
> 时间：2008-09-29T21:21:19.470
> 
> 标签：ssh, qnx

我正在使用 qnx 设备，我希望能够通过 ssh 进入它。有没有人了解如何启动和运行 openSSH 之类的东西？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2015-05-14T18:52:19.760

如果您想启动 SSH 服务器以轻松传输文件。SSH 守护程序 (sshd) 已安装，但缺少“配置”。

1.  创建密钥（不要使用密码）：¹

    ```
    random -t
    ssh-keygen -t rsa -f /etc/ssh/ssh_host_key -b 1024
    ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
    ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key 
    ```

2.  使用密码创建不同于 root 的用户帐户。²

3.  将用户添加到 sshd 组中：`/etc/group`=>`sshd:x:6:user1`
4.  首先执行：`/usr/sbin/sshd`

对于 QNX 6.6.0，您还必须执行以下操作：

5.  创建另一个密钥

    ```
    ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key 
    ```

    （仅 QNX 6.6.0 需要 ECDSA 密钥生成 - 另见[此处](https://www.cygwin.com/ml/cygwin/2011-02/msg00144.html)）

6.  相应地创建文件夹以适应此路径`/var/chroot/sshd/`

如果要使用 SFTP：

7.  创建/使用文件并通过将此行添加到文件来`/etc/ssh/sshd_config`启用`Subsystem sftp /usr/libexec/sftp-server`

* * *

QNX 手册中有关 sshd 命令的一些步骤也在[这里介绍。](http://www.qnx.com/developers/docs/660/topic/com.qnx.doc.neutrino.utilities/topic/s/sshd.html?resultof=%22%73%73%68%22%20)

* * *

¹^(此处：`ssh/`创建文件夹`/etc/`并确保文件属于运行 sshd 的用户！)

² ^(（即默认情况下禁用通过 ssh 的直接 root 访问，但可以通过在文件中指定来`PermitRootLogin yes`启用`/etc/ssh/sshd_config`）)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-26T00:12:06.273

QNX 自 6.4 版起已移除对软件包的支持。这意味着很难从 3rd Party Applications CD 安装 SSH 和 SSL，因为不再存在所需的实用程序。

原来他们的qpk文件包其实只是一个变相的tgz。所以你可以做的是解压 openssl 和 openssh 包。它将创建一个像 public/core-//opt 这样的文件结构你需要做的就是将所有内容从 /opt 复制到 /，然后将 /opt/bin:/opt/sbin 添加到你的路径，然后 /opt /lib 到您的 LD_LIBRARY_PATH。

其他需要注意的是：

*   您的随机数生成器需要启动（random -t）
*   如果你想使用服务器，你需要设置一个新的 /etc/openssh/sshd_config，我从 Ubuntu 机器上复制了我的
*   您将需要生成密钥，网上有很多关于这样做的信息

根据我的阅读，QNX 6.4.1 应该预装了 ssh。我还没有确认这一点

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-07T18:10:36.450

根据它是 6.2、6.3 还是 6.4，您实际上会以不同的方式进行处理。

6.2 在 Photon 中有“安装程序”或“从 QNX 安装软件”，这是一个 GUI 程序，可让您下载和安装它，类似于 Fedora 的 Pup、YaST 等。命令行等效项是 cl-installer。

6.3 没有 6.2 包文件系统，但如果需要，它支持它。在 6.3 上，最简单的方法是从[http://download.qnx.com/contrib/repository621a/](http://download.qnx.com/contrib/repository621a/)获取 6.2 的包，解压它（它只是一个 tarball） - 你应该能够找出哪个文件去在哪里。

6.4 支持 pkgsrc，这将是我在那里做的首选方式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-01-31T15:52:25.033

在库存 6.5、6.5.0SP1 或 6.6 系统上，您只需创建密钥：
ssh-keygen -tdsa -f/etc/ssh/ssh_host_dsa_key
ssh-keygen -trsa -f/etc/ssh/ssh_host_rsa_key

然后启动sshd 服务器（您需要指定完整路径）：
/usr/sbin/sshd
如果出现问题，请在启用调试输出的情况下启动服务器，并且问题应该很明显：/usr/sbin/sshd -ddd

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-04T02:46:24.903

据此，[您](http://www.openqnx.com/PNphpBB2-viewtopic-t6387-.html)应该可以从 3rd Party CD ROM 安装它，也可以在此处获得：[3rd Party Apps](http://download.qnx.com/contrib/repository621a/)。这需要使用 qnxinstall 应用程序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T00:14:09.100

> [QNX 的开源应用程序](http://sourceforge.net/project/showfiles.php?group_id=21249) 提供移植的开源工具/应用程序，包括它们的完整源代码和/或可立即使用的 QNX 二进制文件，例如 XFree86、Lesstif、DDD、VNC、Nedit 和集群中间件（例如 PVM）。

我不知道这意味着什么，但我希望它能给你一些开始。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-05-21T17:26:20.370

一旦您按照 qnx 网站（单击[此处](http://www.qnx.com/developers/docs/6.6.0_anm11_wf10/#com.qnx.doc.neutrino.utilities/topic/s/sshd.html)）上提供的步骤操作，您需要从 sshd_config 文件（在 /etc/ssh 下）停用 PAM 模块。将“UsePAM yes”行更改为“UsePAM no”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-06-23T08:51:25.393

仅供参考 - 您可以使用“inetd”启动 telnet，它可以让您启动，并启动 ftp，这样您就可以移动 ssh 库等。

# asp.net - 您实际上可以持有多少应用程序会话数据？

> ID：150739
> 
> 赞同：6
> 
> 时间：2008-09-29T21:21:41.823
> 
> 标签：asp.net, caching, application-cache

我目前有一个应用程序，每天有超过 20,000 名用户使用，他们主要查看一个数据表。该数据表填充了大约 20 行，但从数据库中的“数据表”中提取，表中有 200,000-600,000 条信息记录。**编辑：**这 20 行是“动态的”，如果用户通过文本框输入任何信息，它们会发生变化。

我目前还持有用户数据和个人资料数据。

我目前每次显示数据表时都会进行大约 4 次回调，但我无法将其减少到 1 次。

**问：**我想知道我是否真的可以每 5 秒用 200,000-600,000 行数据填充应用程序状态，它真的会加速系统吗？**编辑：**对用户或任何其他用户输入的动态行执行，内容需要经常刷新。

**问题 2：**我实际上可以在应用程序缓存中保存多少并且仍然可以更快地获得它？

**编辑：**有超过 20,000 名用户访问这 200,000 行，我需要缓存所有这些行，或者至少我认为是最佳实践。当用户访问我的网站时，这是他们查看的主要页面之一，每次访问可能会返回 2-5 次。

**编辑：**用户确实看到了一组独特的 20 行，这*可能*与用户看到的任何其他 20 行不同。这是一个非常动态的网站，几行不同的行可以大约每秒更新一次。

**编辑：**如果存储在会话状态中，那么它只会加快一个人查看页面的次数。不是整个应用程序，因为一个人只能查看一次页面然后离开。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T12:14:14.253

从技术上讲，我相信你想做的事情是可能的，但我不推荐它。在走这条路之前，您必须考虑几个因素。

1.  你有硬件支持吗？如果您没有用于这种配置的内存并且您必须进行页面交换，那么您可能会失去将其缓存在内存中的大部分速度优势。如果您使用的是进程外状态服务器，那么系统会产生处理序列化的开销。

2.  你打算如何在这么多行中搜索一些东西？数据库服务器在幕后为您处理大量搜索和排序。如果您在网络服务器上缓存数据，他们使用的一些非常复杂的算法将会丢失。

对于数据库中的某些内容何时比内存中的更快，没有真正的硬性规则。这实际上取决于应用程序的设置方式以及数据的存储方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T21:24:51.333

你说他们主要看一张桌子，这张桌子从 200 到 600K 行。那张桌子多久拉一次？这是用户主要查看第一页数据的“主页”类型场景吗？为什么缓存所有 200K 行，为什么不缓存前 20 行？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T21:35:36.127

您确定要将其存储在会话状态中吗？如果他们使用相同的数据库，我更喜欢**应用程序状态**，这样只有一个数据集将存储在内存中。

我认为内存限制是由 IIS 控制的。有**最大虚拟内存**和**最大已用内存**限制。不要忘记检查数据的可用性。

检查这个：[Configuring ASP.NET Applications in Worker Process Isolation Mode (IIS 6.0)](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/26d8cee3-ec31-4148-afab-b6e089a0300b.mspx?mfr=true)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:51:36.713

您能否为我澄清一下-您是说用户获得了该用户独有的 20 条记录的数据表，并且是查询 600K 表的结果吗？记录对用户来说是静态的吗？

如果只有 20 条记录在与用户关联后保持静态，您能否创建可根据请求流式传输给用户的序列化对象？也就是说，将它们置于准备就绪的状态，这样您就不必敲击数据库了。

# atom-feed - 如何在 ATOM 文档中生成好的 ID？

> ID：150741
> 
> 赞同：23
> 
> 时间：2008-09-29T21:22:52.680
> 
> 标签：atom-feed

显然使用 URL 是不好的——为什么会这样，你如何生成一个好的？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-29T21:36:20.197

Mark Pilgrim 的文章[How to make a good ID in Atom](http://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id)很好。这是其中的一部分：

> **为什么不应该使用永久链接作为 Atom ID**
> 
> 使用您的永久链接 URL 作为您的 <id> 是有效的，但我不鼓励这样做，因为它可能会混淆哪些元素应该被视为永久链接。不阅读规范的开发人员会查看您的 Atom 提要，他们会看到两条相同的信息，他们会选择一个并将其用作永久链接，其中一些会选择错误。然后他们转到另一个两个元素不相同的提要，他们会感到困惑。
> 
> 在 Atom 中，<link rel="alternate"> 始终是条目的永久链接。<id> 始终是条目的唯一标识符。两者都是必需的，但它们的用途不同。即使永久链接更改，条目 ID 也不应更改。
> 
> “固定链接更改”？是的，永久链接并不像您想象的那么永久。这是发生在我身上的一个例子。我的永久链接 URL 是从我的条目标题自动生成的，但后来我更新了一个条目并更改了标题。你猜怎么着，“永久”链接刚刚改变了！如果你够聪明，你可以使用 HTTP 重定向将访问者从旧的永久链接重定向到新的永久链接（我也这样做了）。但是您不能重定向 ID。
> 
> Atom 条目的 ID 不能更改！理想情况下，您应该生成一次条目的 ID，并将其存储在某处。如果您一次又一次地从随时间变化的数据中自动生成它，那么条目的 ID 将会改变，这与目的不符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T21:24:57.650

对 ID 使用 GUID。

取决于您使用的语言，但您可以使用

.NET 的 System.Guid。

# python - Python 函数可能引发哪些异常？

> ID：150743
> 
> 赞同：10
> 
> 时间：2008-09-29T21:22:56.783
> 
> 标签：python, exception

Python中有什么方法可以确定（内置）函数可能引发哪些异常？例如，内置 int(s)的文档 ( [http://docs.python.org/lib/built-in-funcs.html](http://docs.python.org/lib/built-in-funcs.html) ) 没有说明如果 s 不是它可能会引发 ValueError 的事实一个有效格式化的 int。

* * *

这是[Re.compile() 或任何给定的 Python 库调用是否引发异常的副本？](https://stackoverflow.com/questions/58119/does-recompile-or-any-given-python-library-call-throw-an-exception)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T21:30:29.447

判断可能引发哪些异常的唯一方法是查看文档。int() 文档没有说它可能引发 ValueError 的事实是文档中的一个错误，但很容易解释为 ValueError 正是为了这个目的，并且这是“每个人都知道”的事情。

但是，为了强调这一点，文档是告诉您应该关注哪些异常的唯一方法。事实上，任何函数都可能引发任何异常，即使只是因为信号可能到达并且信号处理程序可能引发异常。但是，您不应预期或处理这些错误；你应该只处理你期望的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T21:25:03.563

我不知道任何确定的来源，除了来源。

# .net - HashSet 与 List 性能

> ID：150750
> 
> 赞同：490
> 
> 时间：2008-09-29T21:24:15.297
> 
> 标签：.net, performance, collections, list, hash

很明显，泛型类的搜索性能`HashSet<T>`高于泛型`List<T>`类。只需将基于散列的键与`List<T>`类中的线性方法进行比较。

然而，计算哈希键本身可能需要一些 CPU 周期，因此对于少量项目，线性搜索可以真正替代`HashSet<T>`.

我的问题：盈亏平衡点在哪里？

为了简化场景（公平起见），让我们假设`List<T>`该类使用元素的`Equals()`方法来标识一个项目。

* * *

## 回答 #1

> 赞同：930
> 
> 时间：2012-05-26T01:35:31.173

很多人都说，一旦你达到了速度实际上`HashSet<T>`总是会被击败的问题的规模`List<T>`，但这取决于你在做什么。

假设您有一个`List<T>`平均只有 5 个项目。在大量循环中，如果每个循环都添加或删除单个项目，则最好使用`List<T>`.

我在我的机器上对此进行了测试，而且，它必须非常小才能从`List<T>`. 对于短字符串列表，大小 5 后优势消失，大小 20 后的对象。

```
1 item LIST strs time: 617ms
1 item HASHSET strs time: 1332ms

2 item LIST strs time: 781ms
2 item HASHSET strs time: 1354ms

3 item LIST strs time: 950ms
3 item HASHSET strs time: 1405ms

4 item LIST strs time: 1126ms
4 item HASHSET strs time: 1441ms

5 item LIST strs time: 1370ms
5 item HASHSET strs time: 1452ms

6 item LIST strs time: 1481ms
6 item HASHSET strs time: 1418ms

7 item LIST strs time: 1581ms
7 item HASHSET strs time: 1464ms

8 item LIST strs time: 1726ms
8 item HASHSET strs time: 1398ms

9 item LIST strs time: 1901ms
9 item HASHSET strs time: 1433ms

1 item LIST objs time: 614ms
1 item HASHSET objs time: 1993ms

4 item LIST objs time: 837ms
4 item HASHSET objs time: 1914ms

7 item LIST objs time: 1070ms
7 item HASHSET objs time: 1900ms

10 item LIST objs time: 1267ms
10 item HASHSET objs time: 1904ms

13 item LIST objs time: 1494ms
13 item HASHSET objs time: 1893ms

16 item LIST objs time: 1695ms
16 item HASHSET objs time: 1879ms

19 item LIST objs time: 1902ms
19 item HASHSET objs time: 1950ms

22 item LIST objs time: 2136ms
22 item HASHSET objs time: 1893ms

25 item LIST objs time: 2357ms
25 item HASHSET objs time: 1826ms

28 item LIST objs time: 2555ms
28 item HASHSET objs time: 1865ms

31 item LIST objs time: 2755ms
31 item HASHSET objs time: 1963ms

34 item LIST objs time: 3025ms
34 item HASHSET objs time: 1874ms

37 item LIST objs time: 3195ms
37 item HASHSET objs time: 1958ms

40 item LIST objs time: 3401ms
40 item HASHSET objs time: 1855ms

43 item LIST objs time: 3618ms
43 item HASHSET objs time: 1869ms

46 item LIST objs time: 3883ms
46 item HASHSET objs time: 2046ms

49 item LIST objs time: 4218ms
49 item HASHSET objs time: 1873ms 
```

这是显示为图表的数据：

![在此处输入图像描述](https://i.stack.imgur.com/O4ly9.png)

这是代码：

```
static void Main(string[] args)
{
    int times = 10000000;

    for (int listSize = 1; listSize < 10; listSize++)
    {
        List<string> list = new List<string>();
        HashSet<string> hashset = new HashSet<string>();

        for (int i = 0; i < listSize; i++)
        {
            list.Add("string" + i.ToString());
            hashset.Add("string" + i.ToString());
        }

        Stopwatch timer = new Stopwatch();
        timer.Start();
        for (int i = 0; i < times; i++)
        {
            list.Remove("string0");
            list.Add("string0");
        }
        timer.Stop();
        Console.WriteLine(listSize.ToString() + " item LIST strs time: " + timer.ElapsedMilliseconds.ToString() + "ms");

        timer = new Stopwatch();
        timer.Start();
        for (int i = 0; i < times; i++)
        {
            hashset.Remove("string0");
            hashset.Add("string0");
        }
        timer.Stop();
        Console.WriteLine(listSize.ToString() + " item HASHSET strs time: " + timer.ElapsedMilliseconds.ToString() + "ms");
        Console.WriteLine();
    }

    for (int listSize = 1; listSize < 50; listSize+=3)
    {
        List<object> list = new List<object>();
        HashSet<object> hashset = new HashSet<object>();

        for (int i = 0; i < listSize; i++)
        {
            list.Add(new object());
            hashset.Add(new object());
        }

        object objToAddRem = list[0];

        Stopwatch timer = new Stopwatch();
        timer.Start();
        for (int i = 0; i < times; i++)
        {
            list.Remove(objToAddRem);
            list.Add(objToAddRem);
        }
        timer.Stop();
        Console.WriteLine(listSize.ToString() + " item LIST objs time: " + timer.ElapsedMilliseconds.ToString() + "ms");

        timer = new Stopwatch();
        timer.Start();
        for (int i = 0; i < times; i++)
        {
            hashset.Remove(objToAddRem);
            hashset.Add(objToAddRem);
        }
        timer.Stop();
        Console.WriteLine(listSize.ToString() + " item HASHSET objs time: " + timer.ElapsedMilliseconds.ToString() + "ms");
        Console.WriteLine();
    }

    Console.ReadLine();
} 
```

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2014-05-30T07:45:00.687

比较两种行为不同的结构的*性能本质上是没有意义的。*使用传达意图的结构。即使您说您`List<T>`不会有重复项，并且迭代顺序与 a 相比并不重要，但`HashSet<T>`它仍然是一个糟糕的选择，`List<T>`因为它的容错性相对较低。

也就是说，我将检查性能的*其他一些方面*，

```
+------------+--------+-------------+-----------+----------+----------+-----------+
| Collection | Random | Containment | Insertion | Addition |  Removal | Memory    |
|            | access |             |           |          |          |           |
+------------+--------+-------------+-----------+----------+----------+-----------+
| List<T>    | O(1)   | O(n)        | O(n)      | O(1)*    | O(n)     | Lesser    |
| HashSet<T> | O(n)   | O(1)        | n/a       | O(1)     | O(1)     | Greater** |
+------------+--------+-------------+-----------+----------+----------+-----------+ 
```

*   尽管在这两种情况下加法都是 O(1)，但在 HashSet 中它会相对较慢，因为它涉及在存储之前预先计算哈希码的成本。

*   HashSet 卓越的可扩展性具有内存成本。每个条目连同其哈希码一起存储为一个新对象。[这篇文章](http://codebetter.com/patricksmacchia/2008/10/29/collections-and-performances/)可能会给你一个想法。

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2010-05-06T03:43:35.023

你看错了。是的，List 的线性搜索将在少量项目中击败 HashSet。但是对于那么小的集合，性能差异通常并不重要。这通常是您必须担心的大型集合，这就是您[认为 Big-O](http://geekswithblogs.net/BlackRabbitCoder/archive/2011/06/16/c.net-fundamentals-choosing-the-right-collection-class.aspx)的地方。但是，如果您测量了 HashSet 性能的真正瓶颈，那么您可以尝试创建一个混合 List/HashSet，但您将通过进行大量经验性能测试来做到这一点 - 而不是问关于 SO 的问题。

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2008-09-29T21:39:39.020

是使用 HashSet<> 还是 List<> 取决于*您需要如何访问您的集合*。如果您需要保证项目的顺序，请使用列表。如果不这样做，请使用 HashSet。让微软担心他们的散列算法和对象的实现。

HashSet 无需枚举集合即可访问项目（复杂度为[O(1)](http://en.wikipedia.org/wiki/Big_O_notation)或接近它），并且因为 List 保证顺序，与 HashSet 不同，必须枚举某些项目（复杂度为 O(n)）。

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2012-10-26T14:45:23.790

只是想我会加入一些针对不同场景的基准来说明以前的答案：

1.  几个 (12 - 20) 个小字符串（长度在 5 到 10 个字符之间）
2.  许多（~10K）小字符串
3.  一些长字符串（长度在 200 到 1000 个字符之间）
4.  许多（~5K）长字符串
5.  几个整数
6.  许多 (~10K) 整数

对于每种情况，查找出现的值：

1.  在列表的开头（“开始”，索引 0）
2.  靠近列表的开头（“早期”，索引 1）
3.  在列表的中间（“中间”，索引计数/2）
4.  接近列表末尾（“迟到”，索引计数为 2）
5.  在列表的末尾（“end”，索引计数-1）

在每个场景之前，我生成随机大小的随机字符串列表，然后将每个列表提供给一个哈希集。每个场景运行 10,000 次，基本上：

*（测试伪代码）*

```
stopwatch.start
for X times
    exists = list.Contains(lookup);
stopwatch.stop

stopwatch.start
for X times
    exists = hashset.Contains(lookup);
stopwatch.stop 
```

## 样本输出

*在 Windows 7、12GB 内存、64 位、至强 2.8GHz 上测试*

```
---------- Testing few small strings ------------
Sample items: (16 total)
vgnwaloqf diwfpxbv tdcdc grfch icsjwk
...

Benchmarks:
1: hashset: late -- 100.00 % -- [Elapsed: 0.0018398 sec]
2: hashset: middle -- 104.19 % -- [Elapsed: 0.0019169 sec]
3: hashset: end -- 108.21 % -- [Elapsed: 0.0019908 sec]
4: list: early -- 144.62 % -- [Elapsed: 0.0026607 sec]
5: hashset: start -- 174.32 % -- [Elapsed: 0.0032071 sec]
6: list: middle -- 187.72 % -- [Elapsed: 0.0034536 sec]
7: list: late -- 192.66 % -- [Elapsed: 0.0035446 sec]
8: list: end -- 215.42 % -- [Elapsed: 0.0039633 sec]
9: hashset: early -- 217.95 % -- [Elapsed: 0.0040098 sec]
10: list: start -- 576.55 % -- [Elapsed: 0.0106073 sec]

---------- Testing many small strings ------------
Sample items: (10346 total)
dmnowa yshtrxorj vthjk okrxegip vwpoltck
...

Benchmarks:
1: hashset: end -- 100.00 % -- [Elapsed: 0.0017443 sec]
2: hashset: late -- 102.91 % -- [Elapsed: 0.0017951 sec]
3: hashset: middle -- 106.23 % -- [Elapsed: 0.0018529 sec]
4: list: early -- 107.49 % -- [Elapsed: 0.0018749 sec]
5: list: start -- 126.23 % -- [Elapsed: 0.0022018 sec]
6: hashset: early -- 134.11 % -- [Elapsed: 0.0023393 sec]
7: hashset: start -- 372.09 % -- [Elapsed: 0.0064903 sec]
8: list: middle -- 48,593.79 % -- [Elapsed: 0.8476214 sec]
9: list: end -- 99,020.73 % -- [Elapsed: 1.7272186 sec]
10: list: late -- 99,089.36 % -- [Elapsed: 1.7284155 sec]

---------- Testing few long strings ------------
Sample items: (19 total)
hidfymjyjtffcjmlcaoivbylakmqgoiowbgxpyhnrreodxyleehkhsofjqenyrrtlphbcnvdrbqdvji...
...

Benchmarks:
1: list: early -- 100.00 % -- [Elapsed: 0.0018266 sec]
2: list: start -- 115.76 % -- [Elapsed: 0.0021144 sec]
3: list: middle -- 143.44 % -- [Elapsed: 0.0026201 sec]
4: list: late -- 190.05 % -- [Elapsed: 0.0034715 sec]
5: list: end -- 193.78 % -- [Elapsed: 0.0035395 sec]
6: hashset: early -- 215.00 % -- [Elapsed: 0.0039271 sec]
7: hashset: end -- 248.47 % -- [Elapsed: 0.0045386 sec]
8: hashset: start -- 298.04 % -- [Elapsed: 0.005444 sec]
9: hashset: middle -- 325.63 % -- [Elapsed: 0.005948 sec]
10: hashset: late -- 431.62 % -- [Elapsed: 0.0078839 sec]

---------- Testing many long strings ------------
Sample items: (5000 total)
yrpjccgxjbketcpmnvyqvghhlnjblhgimybdygumtijtrwaromwrajlsjhxoselbucqualmhbmwnvnpnm
...

Benchmarks:
1: list: early -- 100.00 % -- [Elapsed: 0.0016211 sec]
2: list: start -- 132.73 % -- [Elapsed: 0.0021517 sec]
3: hashset: start -- 231.26 % -- [Elapsed: 0.003749 sec]
4: hashset: end -- 368.74 % -- [Elapsed: 0.0059776 sec]
5: hashset: middle -- 385.50 % -- [Elapsed: 0.0062493 sec]
6: hashset: late -- 406.23 % -- [Elapsed: 0.0065854 sec]
7: hashset: early -- 421.34 % -- [Elapsed: 0.0068304 sec]
8: list: middle -- 18,619.12 % -- [Elapsed: 0.3018345 sec]
9: list: end -- 40,942.82 % -- [Elapsed: 0.663724 sec]
10: list: late -- 41,188.19 % -- [Elapsed: 0.6677017 sec]

---------- Testing few ints ------------
Sample items: (16 total)
7266092 60668895 159021363 216428460 28007724
...

Benchmarks:
1: hashset: early -- 100.00 % -- [Elapsed: 0.0016211 sec]
2: hashset: end -- 100.45 % -- [Elapsed: 0.0016284 sec]
3: list: early -- 101.83 % -- [Elapsed: 0.0016507 sec]
4: hashset: late -- 108.95 % -- [Elapsed: 0.0017662 sec]
5: hashset: middle -- 112.29 % -- [Elapsed: 0.0018204 sec]
6: hashset: start -- 120.33 % -- [Elapsed: 0.0019506 sec]
7: list: late -- 134.45 % -- [Elapsed: 0.0021795 sec]
8: list: start -- 136.43 % -- [Elapsed: 0.0022117 sec]
9: list: end -- 169.77 % -- [Elapsed: 0.0027522 sec]
10: list: middle -- 237.94 % -- [Elapsed: 0.0038573 sec]

---------- Testing many ints ------------
Sample items: (10357 total)
370826556 569127161 101235820 792075135 270823009
...

Benchmarks:
1: list: early -- 100.00 % -- [Elapsed: 0.0015132 sec]
2: hashset: end -- 101.79 % -- [Elapsed: 0.0015403 sec]
3: hashset: early -- 102.08 % -- [Elapsed: 0.0015446 sec]
4: hashset: middle -- 103.21 % -- [Elapsed: 0.0015618 sec]
5: hashset: late -- 104.26 % -- [Elapsed: 0.0015776 sec]
6: list: start -- 126.78 % -- [Elapsed: 0.0019184 sec]
7: hashset: start -- 130.91 % -- [Elapsed: 0.0019809 sec]
8: list: middle -- 16,497.89 % -- [Elapsed: 0.2496461 sec]
9: list: end -- 32,715.52 % -- [Elapsed: 0.4950512 sec]
10: list: late -- 33,698.87 % -- [Elapsed: 0.5099313 sec] 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-29T21:29:32.337

盈亏平衡将取决于计算哈希的成本。哈希计算可以是微不足道的，也可以不是...... :-) 总是有[System.Collections.Specialized.HybridDictionary](https://docs.microsoft.com/en-us/dotnet/api/system.collections.specialized.hybriddictionary?view=net-6.0)类可以帮助您不必担心盈亏平衡点。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-10-23T16:55:51.153

您可以使用自动检测断点并接受空值的 HybridDictionary，使其本质上与 HashSet 相同。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-29T21:32:56.430

一如既往，答案是“视情况而定**”**。我假设您正在谈论 C# 的标签。

你最好的选择是确定

1.  一组数据
2.  使用要求

并编写一些测试用例。

它还取决于您如何对列表进行排序（如果它已经排序），需要进行什么样的比较，对列表中的特定对象执行“比较”操作需要多长时间，甚至您打算如何使用收藏。

一般来说，最好的选择不是基于您正在使用的数据的大小，而是您打算如何访问它。您是否有与特定字符串或其他数据相关联的每条数据？基于散列的集合可能是最好的。您存储的数据的顺序是否重要，或者您是否需要同时访问所有数据？一个常规的列表可能会更好。

额外的：

当然，我上面的评论假设“性能”意味着数据访问。需要考虑的其他事项：当您说“性能”时，您在寻找什么？绩效个人价值是向上的吗？是否管理大型（10000、100000 或更多）值集？是用数据填充数据结构的性能吗？删除数据？访问单个数据位？替换价值观？迭代值？内存使用情况？数据复制速度？例如，如果您通过字符串值访问数据，但您的主要性能要求是最小内存使用量，则您可能会遇到设计冲突问题。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-29T21:28:37.690

这取决于。如果确切的答案真的很重要，请进行一些分析并找出答案。如果您确定集合中的元素数量永远不会超过一定数量，请使用列表。如果数字无界，请使用 HashSet。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-29T21:31:29.850

取决于你在散列什么。如果您的键是整数，那么在 HashSet 更快之前您可能不需要很多项目。如果您在字符串上键入它，那么它会更慢，并且取决于输入字符串。

当然，您可以很容易地制定基准吗？

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-29T22:56:17.417

您没有考虑的一个因素是 GetHashcode() 函数的稳健性。有了完美的散列函数，HashSet 显然会具有更好的搜索性能。但是随着散列函数的减少，HashSet 的搜索时间也会减少。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-29T21:29:49.527

取决于很多因素...列表实现、CPU 架构、JVM、循环语义、equals 方法的复杂性等...当列表变得足够大以有效地进行基准测试（1000 多个元素）时，基于哈希的二进制查找轻松击败线性搜索，并且差异只会从那里扩大。

希望这可以帮助！

# performance - 如何避免堆碎片？

> ID：150753
> 
> 赞同：13
> 
> 时间：2008-09-29T21:24:59.303
> 
> 标签：performance, memory-management, heap-memory, fragmentation

我目前正在从事一个需要大量内存的医学图像处理项目。我可以做些什么来避免堆碎片并加快对已加载到内存中的图像数据的访问？

该应用程序是用 C++ 编写的，可在 Windows XP 上运行。

**编辑：**应用程序对图像数据进行一些预处理，如重新格式化、计算查找表、提取感兴趣的子图像......在处理过程中应用程序需要大约 2 GB RAM，其中大约 1.5 GB 可以使用为图像数据。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-29T21:35:17.533

如果您正在进行医学图像处理，则可能一次分配大块（512x512，每像素 2 字节图像）。如果您在图像缓冲区的分配*之间*分配较小的对象，那么碎片会咬住您。

对于这个特定的用例，编写自定义分配器并不一定很难。您可以为 Image 对象使用标准 C++ 分配器，但对于像素缓冲区，您可以使用全部在 Image 对象中管理的自定义分配。这是一个快速而肮脏的大纲：

*   使用结构的静态数组，每个结构具有：
    *   一块可以容纳 N 个图像的可靠内存块——分块将有助于控制碎片——尝试初始 N 为 5 左右
    *   指示相应图像是否正在使用的布尔值的并行数组
*   要分配，请在数组中搜索一个空缓冲区并设置其标志
    *   如果没有找到，则将一个新结构附加到数组的末尾
*   要解除分配，请在数组中找到相应的缓冲区并清除布尔标志

这只是一个简单的想法，有很大的变化空间。主要技巧是避免释放和重新分配图像像素缓冲区。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T21:43:32.380

答案是有的，但如果不了解问题的细节，就很难笼统地说。

我假设是 32 位 Windows XP。

尽量避免需要 100 MB 的连续内存，如果你不走运，一些随机 dll 会通过你的可用地址空间在不方便的点加载自己，从而迅速减少非常大的连续内存区域。根据您需要的 API，这可能很难防止。除了一些“正常”内存使用之外，仅分配几个 400MB 的内存块会导致您无处分配最终的“小”40MB 块，这可能会非常令人惊讶。

另一方面，一次预分配合理大小的块。大约 10MB 左右是一个很好的折衷块大小。如果您可以设法将数据划分为这种大小的块，您将能够合理有效地填充地址空间。

如果您仍然会用完地址空间，您将需要能够基于某种缓存算法将块分页进出。选择正确的块来分页将在很大程度上取决于您的处理算法，并且需要仔细分析。

选择将内容分页到哪里是另一个决定。您可能决定只将它们写入临时文件。您还可以调查 Microsoft 的地址窗口扩展 API。在任何一种情况下，您都需要在应用程序设计中小心清理任何指向即将被分页的东西的指针，否则会发生非常糟糕的事情（tm）。

祝你好运！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T21:48:26.020

如果您要对大型图像矩阵执行操作，您可能需要考虑一种称为“平铺”的技术。这个想法通常是将图像加载到内存中，以便相同的连续字节块不会在一行中包含像素，而是在 2D 空间中包含一个正方形。这背后的基本原理是您将在 2D 中而不是在一条扫描线上执行更多彼此更接近的操作。

这不会减少您的内存使用，但可能会对页面交换和性能产生巨大影响。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T21:28:49.950

如果没有关于问题的更多信息（例如语言），您可以做的一件事是通过重用分配而不是分配、操作和释放来避免分配流失。[dlmalloc 之](http://g.oswego.edu/dl/html/malloc.html)类的分配器比 Win32 堆更好地处理碎片。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-05T08:38:19.037

您将在这里遇到的是虚拟地址范围限制，在 32b Windows 中最多为您提供 2 GB。您还应该知道，使用 DirectX 或 OpenGL 等图形 API 将使用这 2 GB 的大部分用于帧缓冲区、纹理和类似数据。

32b 应用程序的 1.5-2 GB 很难实现。最优雅的方法是使用 64b 操作系统和 64b 应用程序。即使使用 64b 操作系统和 32b 应用程序，只要您使用`LARGE_ADDRESS_AWARE`.

但是，由于您需要存储图像数据，您也可以通过使用[文件映射作为内存存储](http://www.bistudio.com/developers-blog/breaking-the-32-bit-barrier-2_en.html)来解决此问题- 这可以通过提交和访问内存的方式来完成，但不使用任何虚拟地址。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T21:29:33.757

在这里猜测您的意思是**避免碎片**，而不是**避免碎片整理**。还猜测您正在使用非托管语言（可能是 c 或 C++）。我建议您分配大块内存，然后从分配的内存块中提供堆分配。这个内存池因为包含大块内存，所以不太容易产生碎片。总而言之，您应该实现自定义内存分配器。

[在此处](http://g.oswego.edu/dl/html/malloc.html)查看有关此的一些一般性想法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T21:30:38.557

我猜您正在使用非托管的东西，因为在托管平台中，系统（垃圾收集器）负责处理碎片。

对于 C/C++，您可以使用其他分配器，而不是默认分配器。（在stackowerflow上有一些关于分配器的线程）。

此外，您可以创建自己的数据存储。例如，在我目前正在进行的项目中，我们有一个用于位图的自定义存储（池）（我们将它们存储在一大块连续的内存中），因为我们有很多，并且我们跟踪堆碎片过大时进行碎片整理。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T21:31:10.287

您可能需要实现手动内存管理。图像数据寿命长吗？如果没有，那么您可以使用 apache Web 服务器使用的模式：分配大量内存并将它们包装到内存池中。将这些池作为函数中的最后一个参数传递，以便它们可以使用池来满足分配临时内存的需要。一旦调用链完成，池中的所有内存都应该不再使用，因此您可以清理内存区域并再次使用它。分配很快，因为它们只意味着向指针添加一个值。释放非常快，因为您将立即释放非常大的内存块。

如果您的应用程序是多线程的，您可能需要将池存储在线程本地存储中，以避免跨线程通信开销。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-02-16T22:01:17.420

如果您可以准确地隔离那些您可能分配大块的地方，您可以（在 Windows 上）直接调用 VirtualAlloc 而不是通过内存管理器。这将避免在普通内存管理器中产生碎片。

这是一个简单的解决方案，它不需要您使用自定义内存管理器。

# sql-server - 如何使用 SSIS 从平面文件中删除重复的行？

> ID：150760
> 
> 赞同：6
> 
> 时间：2008-09-29T21:27:04.790
> 
> 标签：sql-server, ssis, duplicates, business-intelligence, duplicate-removal

首先让我说，能够从一个平面文件中获取 1700 万条记录，然后将其推送到远程机器上的数据库并花费 7 分钟，这真是太棒了。SSIS 真的很棒。但是现在我已经有了这些数据，我该如何删除重复项？

更好的是，我想获取平面文件，从平面文件中删除重复项并将它们放回另一个平面文件中。

我正在考虑一个：

**`Data Flow Task`**

*   文件源（带有关联的文件连接）
*   一个 for 循环容器
*   一个脚本容器，包含一些逻辑来判断另一行是否存在

谢谢你，这个网站上的每个人都知识渊博。

**`Update:`** [我找到了这个链接，可能有助于回答这个问题](http://rafael-salas.blogspot.com/2007/04/remove-duplicates-using-t-sql-rank.html)

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-06T14:02:36.827

使用排序组件。

只需选择您希望按哪些字段对加载的行进行排序，在左下角您会看到一个用于删除重复项的复选框。此框仅根据排序标准删除任何重复的行，因此在下面的示例中，如果我们仅对第一个字段进行排序，则这些行将被视为重复：

```
1 | sample A |
1 | sample B | 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T21:48:15.927

我建议使用 SSIS 将记录复制到临时表中，然后根据您的情况创建一个使用 Select Distinct 或 Rank 的任务，以选择将它们汇集到平面文件并从临时表中删除它们的重复项。最后一步是将临时表中的记录复制到目标表中。

确定重复是 SQL 擅长的，但平面文件不太适合。在您提议的情况下，脚本容器将加载一行，然后将其与 1700 万条记录进行比较，然后加载下一行并重复......性能可能不是那么好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-10T22:05:06.107

平面文件源 --> 聚合（您想要唯一的按列分组） --> 平面文件目标

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T22:10:09.353

该策略通常取决于临时表有多少列。列越多，解越复杂。您链接的文章有一些非常好的建议。

到目前为止，我要添加到其他人所说的唯一内容是，具有日期和日期时间值的列将提供此处介绍的一些解决方案。

我想出的一个解决方案是：

```
SET NOCOUNT ON

DECLARE @email varchar(100)

SET @email = ''

SET @emailid = (SELECT min(email) from StagingTable WITH (NOLOCK) WHERE email > @email)

WHILE @emailid IS NOT NULL
BEGIN

    -- Do INSERT statement based on the email
    INSERT StagingTable2 (Email)
    FROM StagingTable WITH (NOLOCK) 
    WHERE email = @email

    SET @emailid = (SELECT min(email) from StagingTable WITH (NOLOCK) WHERE email > @email)

END 
```

在进行重复数据删除时，这比 CURSOR 快很多，并且不会与服务器的 CPU 挂钩。要使用它，请将来自文本文件的每一列分隔成它们自己的变量。在循环之前和内部使用单独的 SELECT 语句，然后将它们包含在 INSERT 语句中。这对我来说非常有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T12:32:25.490

要在平面文件上执行此操作，我使用 unix 命令行工具，排序：

```
sort -u inputfile > outputfile 
```

不幸的是，windows 排序命令没有唯一的选项，但您可以尝试从以下之一下载排序实用程序：

*   [http://unxutils.sourceforge.net/](http://unxutils.sourceforge.net/)
*   [http://www.highend3d.com/downloads/tools/os_utils/76.html](http://www.highend3d.com/downloads/tools/os_utils/76.html)。

（我还没有尝试过，所以恐怕不能保证）。

另一方面，要在记录加载到数据库时执行此操作，您可以使用 ignore_dup_key 在数据库表的键上创建唯一索引。这将使记录在加载时非常有效地唯一。

```
CREATE UNIQUE INDEX idx1 ON TABLE (col1, col2, ...) WITH IGNORE_DUP_KEY 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-07T05:27:38.607

有点肮脏的解决方案是使用跨越所有列的复合键设置目标表。这将保证明显的唯一性。然后在数据目标形状上，将任务配置为忽略错误。所有重复的插入都会被遗忘。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-10-11T09:42:15.510

我们可以为此使用查找表。就像SSIS 提供了两种DFS（数据流转换），即模糊分组和模糊查找。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-08T17:23:32.423

我建议在目标服务器上加载一个临时表，然后将结果合并到目标服务器上的目标表中。如果您需要运行任何卫生规则，那么您可以通过存储过程来执行此操作，因为您一定会获得比通过 SSIS 数据流转换任务更好的性能。此外，重复数据删除通常是一个多步骤的过程。您可能想要对以下内容进行重复数据删除：

1.  分明的线条。
2.  不同的列组，如名字、姓氏、电子邮件地址等。
3.  您可能想要对现有目标表进行重复数据删除。如果是这种情况，那么您可能需要包含 NOT EXISTS 或 NOT IN 语句。或者您可能希望使用新值更新原始行。这通常最好使用 MERGE 语句和源的子查询。
4.  取特定模式的第一行或最后一行。例如，您可能希望在文件中为每次出现的电子邮件地址或电话号码输入最后一行。我通常依靠带有 ROW_NUMBER() 的 CTE 来生成顺序列和逆序列，如下例所示：

.

```
WITH    
    sample_records 
    (       email_address
        ,   entry_date
        ,   row_identifier
    )
    AS
    (
            SELECT      'tester@test.com'
                    ,   '2009-10-08 10:00:00'
                    ,   1
        UNION ALL

            SELECT      'tester@test.com'
                    ,   '2009-10-08 10:00:01'
                    ,   2

        UNION ALL

            SELECT      'tester@test.com'
                    ,   '2009-10-08 10:00:02'
                    ,   3

        UNION ALL

            SELECT      'the_other_test@test.com'
                    ,   '2009-10-08 10:00:00'
                    ,   4

        UNION ALL

            SELECT      'the_other_test@test.com'
                    ,   '2009-10-08 10:00:00'
                    ,   5
    )
,   filter_records 
    (       email_address
        ,   entry_date
        ,   row_identifier
        ,   sequential_order
        ,   reverse_order
    )
    AS
    (
        SELECT  email_address
            ,   entry_date
            ,   row_identifier
            ,   'sequential_order'  = ROW_NUMBER() OVER (
                                        PARTITION BY    email_address 
                                        ORDER BY        row_identifier ASC)
            ,   'reverse_order'     = ROW_NUMBER() OVER (
                                        PARTITION BY    email_address
                                        ORDER BY        row_identifier DESC)
        FROM    sample_records
    )
    SELECT      email_address
            ,   entry_date
            ,   row_identifier
    FROM        filter_records
    WHERE       reverse_order = 1
    ORDER BY    email_address; 
```

在重复文件删除方面有很多选项可供您选择，但最终我建议您在目标服务器上加载临时表后在存储过程中处理此问题。清理数据后，您可以 MERGE 或 INSERT 到最终目的地。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-29T12:46:06.157

发现这个页面[链接文本](http://www.sqllion.com/2010/01/ssis-package-to-remove-duplicates-from-any-database/)可能值得一看，虽然有 1700 万条记录可能需要一点时间

# command-line - 如何测试文件列表是否存在？

> ID：150762
> 
> 赞同：8
> 
> 时间：2008-09-29T21:27:16.943
> 
> 标签：command-line, file, shell

我有一个列出文件名的文件，每个文件名都在它自己的行上，我想测试每个文件名是否存在于特定目录中。例如，文件的一些示例行可能是

```
mshta.dll
foobar.dll
somethingelse.dll 
```

我感兴趣的目录是`X:\Windows\System32\`，所以想看看是否存在以下文件：

```
X:\Windows\System32\mshta.dll
X:\Windows\System32\foobar.dll
X:\Windows\System32\somethingelse.dll 
```

如何使用 Windows 命令提示符执行此操作？另外（出于好奇）我将如何使用 bash 或其他 Unix shell 来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T21:37:13.377

重击：

```
while read f; do 
    [ -f "$f" ] && echo "$f" exists
done < file.txt 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-29T21:38:32.597

在 cmd.exe 中，**FOR /F %** *variable* **IN (** *filename* **) DO** *命令*应该可以满足您的需求。这会一次读取一行文件名的内容*（*它们可能是多个文件名），将该行放在 %variable 中（或多或少；在命令提示符下执行 HELP FOR）。如果没有其他人提供命令脚本，我会尝试。

编辑：我尝试执行请求的 cmd.exe 脚本：

```
@echo off
rem first arg is the file containing filenames
rem second arg is the target directory

FOR /F %%f IN (%1) DO IF EXIST %2\%%f ECHO %%f exists in %2 
```

注意，上面的脚本*必须*是脚本；出于某种奇怪的原因，.cmd 或 .bat 文件中的 FOR 循环必须在其变量之前有两个百分号。

现在，对于与 bash|ash|dash|sh|ksh 一起使用的脚本：

```
filename="${1:-please specify filename containing filenames}"
directory="${2:-please specify directory to check}
for fn in `cat "$filename"`
do
    [ -f "$directory"/"$fn" ] && echo "$fn" exists in "$directory"
done 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T17:26:23.097

```
for /f %i in (files.txt) do @if exist "%i" (@echo Present: %i) else (@echo Missing: %i) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T21:34:25.287

在 Windows 中：

```
 type file.txt >NUL 2>NUL
if ERRORLEVEL 1 then echo "file doesn't exist" 
```

（这可能不是最好的方法；这是我知道的一种方法；另见[http://blogs.msdn.com/oldnewthing/archive/2008/09/26/8965755.aspx](http://blogs.msdn.com/oldnewthing/archive/2008/09/26/8965755.aspx)）

在 Bash 中：

```
 if ( test -e file.txt ); then echo "file exists"; fi 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T21:38:22.657

但是请注意，在 Win32 和 *nix 下使用默认文件系统无法保证操作的原子性，即如果您检查文件 A、B 和 C 是否存在，则其他进程或线程可能在您通过文件 A 之后以及在您寻找 B 和 C 时删除了它。

[Transactional NTFS](http://en.wikipedia.org/w/index.php?title=Transactional_NTFS&oldid=233375400)等文件系统可以克服这一限制。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T22:45:41.873

我想对上述大多数解决方案添加一个小评论。他们实际上并没有测试特定文件是否存在。他们正在检查文件是否存在并且您可以访问它。文件完全有可能存在于您无权访问的目录中，在这种情况下，即使该文件存在，您也无法查看该文件。

# regex - 正则表达式真的可以维护吗？

> ID：150764
> 
> 赞同：17
> 
> 时间：2008-09-29T21:27:42.700
> 
> 标签：regex, coding-style

我见过的任何使用正则表达式的代码都倾向于将它们用作黑匣子：

1.  放入字符串
2.  魔术正则表达式
3.  拿出字符串

在生产代码中使用这似乎不是一个特别好的主意，因为即使是很小的更改通常也会导致完全不同的正则表达式。

除了标准是永久不变的情况外，正则表达式是做事的方式，还是尝试不同的方法更好？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-29T21:33:47.833

如果正则表达式冗长且难以理解，使它们难以维护，那么应该对它们进行评论。

许多正则表达式实现允许您用空格和注释填充正则表达式。
请参阅[https://www.regular-expressions.info/freespacing.html#parenscomment](https://www.regular-expressions.info/freespacing.html#parenscomment)
和编码恐怖：[正则表达式：现在你有两个问题](http://www.codinghorror.com/blog/archives/001016.html)

> 我见过的任何使用正则表达式的代码都倾向于将它们用作黑匣子：

如果黑盒是指抽象，那就是所有编程，试图抽象出困难的部分（解析字符串），以便您可以专注于问题域（我想匹配什么样的字符串）。

> 即使是很小的变化也常常会导致完全不同的正则表达式。

任何代码都是如此。只要您正在测试您的正则表达式以确保它与您期望的字符串匹配，理想情况下使用**单元测试**，那么您应该有信心更改它们。

编辑：还请阅读 Jeff 对此答案关于生产代码的评论。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-29T21:31:37.043

[强制性的。](http://www.codinghorror.com/blog/archives/001016.html)

它真的归结为正则表达式。如果是这个巨大的单体表达式，那么是的，这是一个可维护性问题。如果你能简洁地表达它们（也许通过分解它们），或者如果你有很好的评论和工具来帮助你理解它们，那么它们可以成为一个强大的工具。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-29T21:35:19.107

我不知道您使用的是哪种语言，但 Perl - 例如 - 支持该`x`标志，因此除非转义，否则正则表达式中的空格将被忽略，因此您可以将其分成几行并内联注释所有内容：

```
$foo =~ m{
    (some-thing)          # matches something
    \s*                   # matches any amount of spaces
    (match another thing) # matches something else
}x; 
```

这有助于使长正则表达式更具可读性。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-29T21:32:45.340

如果您不了解正则表达式，这似乎只是魔术。生产代码中的任何微小更改都可能导致重大问题，因此在我看来，这不是不使用正则表达式的好理由。彻底的测试应该指出任何问题。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-29T21:34:12.123

*对任何语言的**任何*代码的微小更改都可能导致*完全*不同的结果。其中一些甚至阻止编译。

 **用“C”或“C#”或“Java”或“Python”或“Perl”或“SQL”或“Ruby”或“awk”或......替换正则表达式，真的，你会得到同样的问题。

正则表达式只是另一种语言，[霍夫曼编码](http://en.wikipedia.org/wiki/Huffman_coding)以有效地进行字符串匹配。就像 Java、Perl、PHP 或特别是 SQL 一样，每种语言都有优点和缺点，并且您需要在编写（或维护）它时了解您正在编写的语言，以便有希望提高生产力。

编辑：迈克，正则表达式是霍夫曼编码的，常见的事情比稀有的事情要短。文本的文字匹配通常是单个字符（您要匹配的字符）。存在特殊字符 - 常见字符很短。特殊结构，例如 (?:) 更长。这些与 Perl、C++ 等通用语言中常见的东西不同，因此 Huffman 编码针对的是这种专业化。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-29T21:31:52.253

复杂的正则表达式对我来说是一劳永逸的。编写它，测试它，当它工作时，写一个评论它做了什么，我们很好。

但是，在许多情况下，您可以将正则表达式分解为更小的部分，也许可以编写一些文档齐全的代码来组合这些正则表达式。但是如果你在你的代码中发现了一个多行的正则表达式，你最好不要去维护它：）

听起来很熟悉？任何代码或多或少都是如此。你不想有很长的方法，你不想有很长的类，你也不想有很长的正则表达式，尽管方法和类更容易重构。但本质上，它是同一个概念。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T21:31:45.810

正则表达式不是做某事的唯一方法。您可以在代码中逻辑地执行正则表达式可以执行的所有操作。正则表达式只是

1.  快速地
2.  经过测试和证明
3.  强大的

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-16T04:23:25.377

如果您**利用**`Perl 5.10`. 我所指的功能是来自`Perl 6`.

*直接从[perlretut](http://perldoc.perl.org/perlretut.html#Defining-named-patterns)复制的示例。*

### 定义命名模式

一些正则表达式在多个地方使用相同的子模式。从 Perl 5.10 开始，可以在模式的一部分中定义命名子模式，以便可以在模式中的任何位置通过名称调用它们。这个定义组的句法模式是`(?(DEFINE)(?<name>pattern)...)`. 命名模式的插入写为`(?&name)`.

下面的示例使用前面介绍的浮点数模式说明了此功能。多次使用的三个子模式是可选符号、整数的数字序列和小数部分。`DEFINE`模式末尾的组包含它们的定义。请注意，小数模式是我们可以重用整数模式的第一个地方。

```
/^
  (?&osg)\ * ( (?&int)(?&dec)? | (?&dec) )
        (?: [eE](?&osg)(?&int) )?
 $
 (?(DEFINE)
     (?<osg>[-+]?)         # optional sign
     (?<int>\d++)          # integer
     (?<dec>\.(?&int))     # decimal fraction
 )
/x 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T21:32:13.593

关于正则表达式的名言：

> “有些人在遇到问题时会想‘我知道，我会使用正则表达式。现在他们有两个问题。” ——杰米·扎温斯基

当我确实使用正则表达式时，我发现它们是可维护的，但它们在特殊情况下使用。通常有一个更好的、非正则表达式的方法来做几乎所有的事情。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-29T21:33:40.703

当有意识地使用正则表达式时，它是一种强大的机制，可以让您免于可能的文本解析行和行。当然，它们应该被正确记录并有效地跟踪，以验证初始假设是否仍然有效，并相应地更新它们。关于维护恕我直言，最好更改一行代码（正则表达式模式），而不是理解解析代码的行和行或任何正则表达式的目的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-29T21:35:36.173

正则表达式是做事的方式吗？这取决于任务。

与所有编程事物一样，没有固定的正确或错误答案。

如果正则表达式快速简单地解决特定任务，那么它可能比更详细的解决方案更好。

如果一个正则表达式试图完成一项复杂的任务，那么更冗长的东西可能更容易理解并因此维护。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-29T21:57:33.347

有很多可能性可以使 RegEx 更易于维护。最后，它只是（好的？）程序员在进行重大（或有时甚至是次要）更改时必须学习的技术。当没有一些真正优秀的专业人士时，没有人会因为它们复杂的语法而打扰他们。但它们在工作中快速、紧凑且非常灵活。

对于 .NET 人来说，可能会有“ [Linq to RegEx](http://weblogs.asp.net/rosherove/archive/2008/05/06/introducing-linq-to-regex.aspx) ”库看起来更糟或“[可读正则表达式库](http://flimflan.com/blog/ReadableRegularExpressions.aspx)”。它使它们更易于维护且更易于编写。我在自己的项目中使用了它们，我知道我用它们分析的 html 源代码可以随时更改。

但请相信我：当你对他们有所了解时，他们甚至可以在写作和阅读方面取笑。:)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T21:37:13.707

我有一个彻底评论非平凡正则表达式的政策。这意味着描述和证明每个与自身不匹配的原子。某些语言（例如 Python）提供忽略空格并允许注释的“冗长”正则表达式；尽可能使用它。否则，在正则表达式上方的评论中逐个原子地进行。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-29T21:54:08.533

问题不在于正则表达式本身，而在于它们被视为黑匣子。与任何编程语言一样，可维护性更多地与编写它的人和阅读它的人有关，而不是与语言本身有关。

使用正确的工具完成工作还有很多要说的。在您在对原始帖子的评论中提到的示例中，正则表达式是用于解析 HTML 的错误工具，正如在 PerlMonks 上经常提到的那样。如果您尝试仅使用正则表达式以类似于一般方式的任何方式解析 HTML，那么您最终将要么以不正确且脆弱的方式进行解析，要么编写一个可怕且无法维护的正则表达式怪物，或者（很可能）两个都。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-04-19T10:57:41.550

您的问题似乎与正则表达式本身无关，而仅与通常用于*表达正则表达式的**语法*有关。在许多核心程序员中，这种语法已经被认为非常简洁和强大，但对于更长的正则表达式，它实际上是不可读和不可维护的。

 *有些人已经在 Perl 中提到了“x”标志，这有点帮助，但没有多大帮助。

我非常喜欢正则表达式，但不喜欢语法。能够从可读的、有意义的方法名称构造正则表达式会很好。例如，而不是这个 C# 代码：

```
foreach (var match in Regex.Matches(input, @"-?(?<number>\d+)"))
{
    Console.WriteLine(match.Groups["number"].Value);
} 
```

你可以有一些更冗长但更具可读性和可维护性的东西：

```
int number = 0;
Regex r = Regex.Char('-').Optional().Then(
    Regex.Digit().OneOrMore().Capture(c => number = int.Parse(c))
);
foreach (var match in r.Matches(input))
{
    Console.WriteLine(number);
} 
```

这只是一个快速的想法；我知道还有其他不相关的可维护性问题（尽管我认为它们越来越少）。这样做的一个额外好处是编译时验证。

当然，如果您认为这太过分而且*过于*冗长，您仍然可以使用介于两者之间的正则表达式语法，也许......

```
instead of:   -?(?<number>\d+)
could have:   ("-" or "") + (number = digit * [1..]) 
```

这仍然是可读性的一百万倍，并且长度只有两倍。这样的语法很容易被制成具有与普通正则表达式相同的表达能力，并且它当然可以集成到编程语言的编译器中进行静态分析。

我真的不知道为什么即使重新考虑整个编程语言（例如 Perl 6，或者当 C# 是新的），也有这么多反对重新考虑正则表达式的语法。此外，上述非常冗长的想法甚至与“旧”正则表达式不兼容；API 可以很容易地实现为在底层构造旧式正则表达式的 API。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-29T21:34:24.977

我在我的应用程序中使用它们，但我将实际的 regEx 表达式保留在配置文件中，因此如果我正在解析的源文本（例如电子邮件）由于某种原因更改格式，我可以快速更新配置以处理更改而无需重新构建应用程序。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-29T21:35:23.693

正则表达式肯定被称为“只写”编程语言。但是，我不认为这意味着你应该避免它们。我只是认为您应该出于他们的意图发表评论。我通常不喜欢解释一行做*什么*的评论，我可以阅读代码，但正则表达式是个例外。评论一切！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-29T21:45:37.273

我通常会编写扫描仪规范文件。扫描仪或“扫描仪生成器”本质上是优化的文本解析器。由于我通常使用 Java，因此我首选的方法是 JFlex ( [http://www.jflex.de](http://www.jflex.de) )，但也有 Lex、YACC 和其他几种方法。

扫描程序处理可以定义为宏的正则表达式。然后当正则表达式匹配部分文本时实现回调。

当涉及到代码时，我有一个包含所有解析逻辑的规范文件。我通过选择的扫描仪生成器工具运行它，以选择语言生成源代码。然后我只是将所有这些包装到解析器函数或某种类中。这种抽象使得管理所有的正则表达式逻辑变得很容易，并且性能非常好。当然，如果你只使用一两个正则表达式，那就太过分了，而且至少需要 2-3 天的时间来了解到底发生了什么，但如果你曾经使用过 5 或 6 或 30 个其中，它成为一个非常好的特性，实现解析逻辑开始只需几分钟，并且它们易于维护和记录。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-10T21:02:04.677

我一直将这个问题视为一个构建块问题。

你不只是写一些 3000 个字符的正则表达式并希望最好。你写了一堆你加在一起的小块。

例如，要匹配一个 URI，你有协议、权限、子域、域、tld、路径、参数（至少）。其中一些是可选的！

我相信你可以编写一个怪物来处理它，但是编写块并将它们加在一起更容易。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-11-11T20:19:03.303

我通常将正则表达式拆分为带有注释的部分，然后将它们全部放在一起进行最后的推动。片段可以是子字符串或数组元素

两个 PHP PCRE 示例（细节或特定用途并不重要）：

```
1)
  $dktpat = '/^[^a-z0-9]*'. // skip any initial non-digits
    '([a-z0-9]:)?'. // division within the district
    '(\d+)'. // year
    '((-)|-?([a-z][a-z])-?)'. // type of court if any - cv, bk, etc.
    '(\d+)'. // docket sequence number
    '[^0-9]*$/i'; // ignore anything after the sequence number
  if (preg_match($dktpat,$DocketID,$m)) {

2)
    $pat= array (
      'Row'        => '\s*(\d*)',
      'Parties'    => '(.*)',
      'CourtID'    => '<a[^>]*>([a-z]*)</a>',
      'CaseNo'     => '<a[^>]*>([a-z0-9:\-]*)</a>',
      'FirstFiled' => '([0-9\/]*)',
      'NOS'        => '(\d*)',
      'CaseClosed' => '([0-9\/]*)',
      'CaseTitle'  => '(.*)',
    );
    // wrap terms in table syntax
    $pat = '#<tr>(<td[^>]*>'.
      implode('</td>)(</tr><tr>)?(<td[^>]*>',$pat).
      '</td>)</tr>#iUx';
    if (preg_match_all ($pat,$this->DocketText,$matches, PREG_PATTERN_ORDER)) 
```

# iphone - 将 Android 的 Java VM 移植到 iPhone 上？

> ID：150781
> 
> 赞同：13
> 
> 时间：2008-09-29T21:31:18.010
> 
> 标签：iphone, android, jvm

有谁知道任何旨在将 Android 的 Java VM 移植到 iPhone 上的现有项目？据我了解，这不会太遥不可及，肯定会带来一些令人兴奋的发展。

**编辑**：我应该指出，我知道使用官方 iPhone SDK 不会发生这种情况。但是，越狱平台将消除任何 Apple 强加的障碍。我想大多数对将 Android 集成到 iPhone 感兴趣的人也会是通常拥有越狱 iPhone 的人群。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T22:04:52.733

目前还没有将[Dalvik 移植](http://en.wikipedia.org/wiki/Dalvik_virtual_machine)到 iPhone 上的努力，因为[谷歌还没有发布源代码](http://code.google.com/android/roadmap.html)。一旦源被释放（假设所有的都会），我认为这会发生。它也可能出现在其他自制平台上，例如 PSP、[Pandora](http://openpandora.org/)、[openmoko](http://www.openmoko.com/)等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-31T09:03:49.773

Android Dalvik 在 iOS 上运行：

“In the box”开源项目首次在他们的网站 (www.in-the-box.org) 上展示，作为他们开源项目的第一步，运行在 iOS 上的 Android Dalvik VM。（无需越狱）。

“In the box”是一个开源项目，旨在在 iOS 之上提供 Gingerbread Android 运行时的移植。它使 Android 应用程序开发人员能够在 iOS 上执行他们的 Android 应用程序。

享受 ：-）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T21:43:21.040

到目前为止，还没有旨在将 Dalvik（Android VM，它不是*真正*的 Java VM，因为它不执行 Java 字节码）移植到 iPhone 的现有项目。但是，至少有一个可用于 iPhone 的“真正的”Java VM。你可以在 Cydia 的越狱手机上找到它。

这些项目的问题在于 Apple 不允许第三方应用程序执行代码，因此 Java VM 只能在越狱的 iPhone 上运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T21:43:23.707

苹果的 iPhone 是一个封闭的系统。他们控制从操作系统部署到应用程序的内容。他们说他们无意支持 JVM。这必须是该控制之外的流氓应用程序，因此对大众不太有吸引力。

* * *

## 回答 #5

> 赞同：-8
> 
> 时间：2008-09-29T21:34:52.323

为了有用，您还必须将连接移植到 Google 的 App Store。是的，Apple 会允许的。我们更有可能看到一些适用于 Android 的 iPhone 仿真工具。

# c++ - 使用同一个窗口类多次调用 RegisterWindow 的副作用？

> ID：150803
> 
> 赞同：4
> 
> 时间：2008-09-29T21:34:17.207
> 
> 标签：c++, windows, winapi

我现在正在开发一个小测试应用程序，我有多个窗口对象浮动，它们每个都使用相同的 WNDCLASSEX 结构调用 RegisterWindowEx（主要是因为它们都是同一类的实例）。

第一个注册成功，然后多个失败，说类已经注册 - 正如预期的那样。

我的问题是——这很糟糕吗？我正在考虑使用哈希表来存储 ATOM 结果，在调用 RegisterWindow 之前进行查找，但似乎 Windows 已经这样做了？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T21:49:36.873

## 如果您的窗口类是在 DLL 中定义的

也许你应该`RegisterClass()`在 DllMain 的 PROCESS_ATTACH 部分调用你的，并在 DllMain`UnregisterClass()`的 PROCESS_DETACH 部分调用你的

## 如果您的窗口类是在可执行文件中定义的

也许你应该`RegisterClass()`在消息循环之前调用你的 main，并在消息循环之后调用你`UnregisterClass()`的 main。

## 在对象构造函数中注册将是一个错误

因为你会反射性地在析构函数中清理它。如果你的一个窗口被破坏，析构函数将被调用并且......如果你有其他窗口漂浮在周围......

并且使用全局数据来计算活动注册的数量需要适当的同步，以确保您的代码是线程友好的，如果不是线程安全的。

## 为什么在 main/DllMain 中？

因为您正在注册某种全局对象（至少，对于您的进程）。因此，以“全局方式”初始化它是有意义的，即在 main 中或在 DllMain 中。

## 为什么它没有那么邪恶？

因为 Windows 不会因为您多次注册它而失败。

一个干净的代码会用来`GetClassInfo()`询问该类是否已经注册。

但同样，Windows 不会崩溃（至少出于这个原因）。

您甚至可以避免注销窗口类，因为当进程结束时，Windows 会清除它们。我在 MSDN 博客上看到了有关该主题的相互矛盾的信息（两年前……不要让我再次查找该信息）。

## 为什么它还是邪恶的？

我个人的观点是你应该干净地处理你的资源，即分配一次，释放一次。仅仅因为 Win32 将清除泄漏的内存不应该阻止您释放动态分配的内存。窗口类也是如此。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T21:48:42.757

您可以测试窗口类是否以前注册过调用**GetClassInfoEx**。

> 如果函数找到匹配的类并成功复制数据，则返回值非零。

[http://msdn.microsoft.com/en-us/library/ms633579(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms633579(VS.85).aspx)

这样，您可以根据**GetClassInfoEx**的返回有条件地注册窗口类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T21:47:42.200

您只需调用 RegisterWindowEx 一次，然后在创建窗口时使用生成的 ATOM。在多个窗口重用这个 ATOM 没有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T22:01:19.857

好吧，你也许可以避免调用内核——RegisterClass 似乎需要到那里去——但是窗口类是每个进程和每个模块的，所以你不应该通过多次注册一个类来伤害任何东西。

鉴于通常没有那么多类，我不会惊讶地发现它实际上是作为链表实现的。通过在哈希表中查找它可能会有所收获，但最好将它作为一个简单的布尔值来做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T08:04:03.980

我最近遇到了这个问题。为了绕过它并将所有代码保留在相关类中，而不是将其散布在程序中，我有一个类静态引用计数，我在调用 RegisterClass() 之前增加了该计数。然后我忽略了 ERROR_CLASS_ALREADY_EXISTS 的返回值，并且仅在引用计数为 0 时在 dtor 中调用 UnregisterClass()。

这不需要任何锁定（使用 InterlockedIncrement() 和 InterlockedDecrement() 来管理引用计数）并且意味着类的使用不需要知道或关心类在内部使用隐藏窗口。

# c# - 追踪仅在一个客户的盒子上可见的内存泄漏 (C#) 的最佳方法

> ID：150805
> 
> 赞同：12
> 
> 时间：2008-09-29T21:34:23.243
> 
> 标签：c#, .net, memory, memory-leaks, garbage-collection

追踪仅在一个客户的测试/发布盒上发现的内存泄漏的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T21:36:40.463

[dotTrace3.1](http://www.jetbrains.com/profiler/index.html)

（这个问题有点有趣，因为我正在跟踪我的机器上不存在的内存泄漏......）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T21:38:54.403

尝试像[ANTS Profiler](http://www.red-gate.com/products/ants_memory_profiler/index.htm)这样的内存分析器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T21:36:01.040

如果用户始终遇到问题，请进行堆栈转储并以标准方式进行分析

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:45:24.920

这是一个选择：给他们一个不存在泄漏的盒子。

有时，它不是代码。

编辑：它可以是代码、数据或配置。

或者 .NET 框架、操作系统、驱动程序、IIS 或 COM（例如自动化 Excel）等等。

我的假设是内存泄漏是不可重现的，除非在客户端的盒子上（不允许开发人员访问以进行调试）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T22:03:04.487

它可以是代码、数据或配置。

既然你说代码 100% 没有错误，我会责怪配置。获取配置的副本（以及可选的一些数据）并尝试复制问题；您不会知道您已经找到并修复了它而无需复制。

最后，用内存分析器解决它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T01:56:18.027

PerfMon 可能会有所帮助（[http://dotnetdebug.ne](http://dotnetdebug.net/2005/06/30/perfmon-your-debugging-buddy/) ​​t/2005/06/30/perfmon-your-debugging-buddy/ ）。有几个计数器可以帮助缩小泄漏的资源范围，以及泄漏的速度等。

# javascript - 如何在 Javascript 中处理 ActiveX 事件

> ID：150814
> 
> 赞同：20
> 
> 时间：2008-09-29T21:35:23.600
> 
> 标签：javascript, events, activex

[这在某种程度上是对此处](https://stackoverflow.com/questions/26536/active-x-control-javascript)答案的跟进。

我有一个自定义 ActiveX 控件，它引发了一个需要由 Web 浏览器中的 Javascript 处理的事件（带有“msg”参数的“ReceiveMessage”）。从历史上看，我们已经能够在不同的项目中使用以下仅限 IE 的语法来完成此操作：

```
function MyControl::ReceiveMessage(msg)
{
   alert(msg);
} 
```

但是，当在控件被隐藏的布局内时，Javascript 无法找到该控件。具体来说，如果我们把它放到一个普通的 HTML 页面中，它可以正常工作，但是如果我们把它放到一个由`<Form>`标签包裹的 ASPX 页面中，我们会得到一个“MyControl is undefined”错误。我们尝试了以下变体：

```
var GetControl = document.getElementById("MyControl");
function GetControl::ReceiveMessage(msg)
{
   alert(msg);
} 
```

...但它会导致 Javascript 错误“GetControl 未定义”。

处理从 ActiveX 控件发送的事件的正确方法是什么？现在我们只对让这个在 IE 中工作感兴趣。这必须是我们正在做的自定义 ActiveX 控件。

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-30T11:58:46.507

我能够使用以下脚本块格式来完成这项工作，但我仍然很好奇这是否是最好的方法：

```
<script for="MyControl" event="ReceiveMessage(msg)">
    alert(msg);
</script> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-07-08T12:19:47.760

我以前在我的应用程序中使用过activex。我将对象标签放在 ASP.NET 表单中，下面的 JavaScript 对我有用。

```
function onEventHandler(arg1, arg2){
    // do something
}

window.onload = function(){
    var yourActiveXObject = document.getElementById('YourObjectTagID');
    if(typeof(yourActiveXObject) === 'undefined' || yourActiveXObject === null){
        alert('Unable to load ActiveX');
        return;
    }

    // attach events
    var status = yourActiveXObject.attachEvent('EventName', onEventHandler);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T01:29:00.833

好的，但是如果您使用带有继承的 UserControl (ActiveX) 的 C# (.NET 2.0)... 使其工作的唯一方法是“扩展”事件的处理程序功能： http: [//www.codeproject.com/KB /dotnet/extend_events.aspx?display=打印](http://www.codeproject.com/KB/dotnet/extend_events.aspx?display=Print)

我们的朋友 Werner Willemsens 先生提供的上述项目链接保存了我的项目。如果您不这样做，则 javascript 无法绑定到事件处理程序。

由于他选择的示例，他以复杂的方式使用了“扩展”，但如果您将其简单化，将句柄直接附加到事件本身，它也可以工作。C# ActiveX 应该支持“ScriptCallbackObject”将事件绑定到一个 javascript 函数，如下所示：

```
 var clock = new ActiveXObject("Clocks.clock");
  var extendedClockEvents = clock.ExtendedClockEvents();
  // Here you assign (subscribe to) your callback method!
  extendedClockEvents.ScriptCallbackObject = clock_Callback; 
  ...
  function clock_Callback(time)
  {
    document.getElementById("text_tag").innerHTML = time;
  } 
```

当然，您必须实现 IObjectSafety 和其他安全性东西才能使其更好地工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T04:34:19.760

如果您的页面上有一个 ID 为“MyControl”的 ActiveX 元素，那么您的 javascript 处理程序语法是这样的：

```
function MyControl::ReceiveMessage(msg)
{
   alert(msg);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-09T03:58:50.533

我发现这段代码在表单标签中工作。本例中，callback是javascript传入ActiveX控件的函数参数，callbackparam是activeX控件内部产生的回调事件的参数。这样，我对任何类型的事件都使用相同的事件处理程序，而不是尝试声明一堆单独的事件处理程序。

> > `<object id="ActivexObject" name="ActivexObject" classid="clsid:15C5A3F3-F8F7-4d5e-B87E-5084CC98A25A"></object>`
> > 
> > `<script>`
> > `function document.ActivexObject::OnCallback(callback, callbackparam){`
> > `callback(callbackparam);`
> > `}`
> > `</script>`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-11T19:07:12.560

就我而言，我需要一种方法来动态创建 ActiveX 控件并监听它们的事件。我能够得到这样的工作：

```
//create the ActiveX
var ax = $("<object></object>", {
    classid: "clsid:" + clsid,
    codebase: install ? cabfile : undefined,
    width: 0,
    height: 0,
    id: '__ax_'+idIncrement++
})
.appendTo('#someHost'); 
```

然后为事件注册一个处理程序：

```
//this function registers an event listener for an ActiveX object (obviously for IE only)
//the this argument for the handler is the ActiveX object.
function registerAXEvent(control, name, handler) {
    control = jQuery(control);

    //can't use closures through the string due to the parameter renaming done by the JavaScript compressor
    //can't use jQuery.data() on ActiveX objects because it uses expando properties

    var id = control[0].id;

    var axe = registerAXEvent.axevents = registerAXEvent.axevents || {};
    axe[id] = axe[id] || {};
    axe[id][name] = handler;

    var script =
    "(function(){"+
    "var f=registerAXEvent.axevents['" + id + "']['" + name + "'],e=jQuery('#" + id + "');"+
    "function document." + id + "::" + name + "(){"+
        "f.apply(e,arguments);"+
    "}"+
    "})();";
    eval(script);
} 
```

此代码允许您使用闭包并最小化 eval() 的范围。

ActiveX 控件的`<object>`元素必须已经添加到文档中；否则，IE 将找不到该元素，您只会得到脚本错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T00:45:57.297

我认为 MyControl::ReceiveMessage 示例不起作用，因为 ActiveX 控件以不同的名称或在不同的范围内公开。

对于示例 GetControl::ReceiveMessage，我相信在设置 GetControl 引用之前解析函数定义，因此它不引用有效对象并且无法将函数绑定到对象。

我将通过使用 MS 脚本调试器并尝试确定控件的默认引用是否存在不同的名称或不同的范围（可能作为表单的子级）来解决这个问题。如果您可以确定控件的正确引用，您应该能够使用 MSDN 文章指定的 Automagic :: 方法正确绑定该函数。

再想一想，引用可能基于对象的名称而不是 ID，因此请尝试同时设置 :)

# java - 集成测试的数据加载和数据库初始化策略

> ID：150820
> 
> 赞同：2
> 
> 时间：2008-09-29T21:35:50.887
> 
> 标签：java, database, integration-testing

我正在为数据密集型 J2EE 企业应用程序开发一个集成测试框架，并且我正在尝试确定初始化和填充数据库的策略。我们有一个相当复杂的模型。

系统必须：

1.  初始化系统本身
2.  加载用户
3.  加载应用程序测试数据

测试数据不会像系统将处理的那样复杂，负载和压力测试是专业测试团队的领域。我们感兴趣的是 UI 显示系统中内容的能力以及从上到下正确集成的功能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T22:45:06.197

[DBUnit](http://www.dbunit.org/ "数据库单元")是一个非常好的框架，用于将数据加载到测试数据库中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T14:27:02.537

[Unitils](http://www.unitils.org/summary.html)支持加载测试数据和保持测试数据库模式是最新的。为了使后者工作，您的架构更改脚本需要遵循特定的命名约定。

# sql-server - Pentaho 与 Microsoft BI Stack

> ID：150825
> 
> 赞同：37
> 
> 时间：2008-09-29T21:36:38.327
> 
> 标签：sql-server, reporting-services, ssas, business-intelligence, pentaho

我的公司在 MS BI Stack（SQL Server Reporting Services、-Analysis Services 和-Integration Services）上投入了大量资金，但我想看看看起来最受关注的开源替代 Pentaho 是什么样的。

我已经安装了一个版本，并且很轻松地启动并运行它。所以这很好。但是我还没有真正开始将它用于实际工作以彻底了解该软件包的时间。

你们中是否有人对 Pentaho 与 MS BI 的优缺点有任何见解，或任何此类比较的链接？

非常感激！

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-01T17:01:10.013

在离开 Business Objects 的路上，我查看了多个 Bi 堆栈。我的很多评论都是偏好。两个工具集都很棒。有些事情是我更喜欢巧克力软糖布朗尼冰淇淋而不是纯巧克力。

Pentaho 有一些非常聪明的人与他们合作，但微软一直走在一条资金充足且计划良好的道路上。请记住，MS 仍然是数据库市场的弱者。甲骨文是这里的王者。为了具有竞争力，当您购买数据库时，MS 一直在赠送很多好东西，并且被迫多次改造他们的平台。我知道这与数据库无关，但数据库之战已经导致 MS 放弃了很多，以便为他们的堆栈增加价值。

1.) 平台
SQL 服务器不在 Unix 或 Linux 上运行，因此它们自动被排除在这个市场之外。Windows 现在的价格与某些版本或 Unix 差不多。Windows 非常便宜，而且现在运行良好。它给我带来的麻烦与 Linux 一样多。

2.) OLAP
分析服务于 2005 年（目前是 2008 年）在 2000 年版本基础上进行了改造。这是一个比 2000 更强大的数量级。pentaho（蒙德里安）一旦变大就不会那么快了。它也有一些特点。它非常好，但工具的方式较少。两者都支持 Excel 作为必不可少的平台。MS版本更强大。

3.) ETL
MS - DTS 已被 SSIS 取代。再一次，速度、力量和能力的数量级增加。它控制任何和所有数据移动或程序控制。如果它不能这样做，你可以在 Powershell 中编写一个脚本。与 2008 版中的 Informatica 相当。Pentaho - 比以前好多了。没有我想的那么快，但我可以做我想做的所有事情。

4.) 仪表板
Pentaho 对此进行了改进。开发起来有点不舒服和不友好，但对于 MS 来说确实没有真正的等价物。

5.) 报告
MS 报告确实很强大，但也不是那么难用。我现在喜欢它，但一开始讨厌它，直到我对它有了更好的了解。我一直在使用水晶报表，而 MS 报表生成器要强大得多。在 MS 中做困难的事情很容易，但做简单的事情就更难了。Pentaho 有点笨拙。我根本不喜欢它，但你可能会。我发现它过于复杂。我希望它更像水晶报表生成器或 MS 报表生成器，但它更像碧玉。我觉得很难。这可能是一种偏好。

6.) ad hoc
MS - 这对我来说是真正的赢家。我与我的用户一起测试了它，他们立即爱上了 MS 用户报告生成器。不同之处在于它不仅易于使用，而且富有成效。Pentaho - 很好但很老派。它使用更典型的基于向导的模型并具有强大的工具，但我讨厌它。它是一个很好的工具，但我们已经从这种风格继续前进，没有人想回去。我对 logiXML 有同样的问题。界面运行良好，但与我们使用 12 年的界面相比并没有太大变化。 [http://wiki.pentaho.com/display/PRESALESPORTAL/Methods+of+Interactive+Reporting](http://wiki.pentaho.com/display/PRESALESPORTAL/Methods+of+Interactive+Reporting)

有一些经验丰富的人可以让 Pentaho 真正运行良好，我只是发现 MS 套件更有效率。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-04T23:16:33.470

警告——有许多网站列出了 SSIS 的许多缺陷、错误和烦恼。不知道为什么 SSIS 在这篇文章中名列前茅——但在你把你的项目押在上面之前，看看人们在博客圈里怎么说。根据我的经验，它以 20:1 的比例抱怨 SSIS 的使用有多糟糕——我也可以同意，目前正在寻找任何替代方案。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-11-29T22:24:40.130

这里有很好的信息吗？我还没有尝试过 Pentaho，但并打算检查一下。我是一位经验丰富的 MS BI 顾问，自 1998 年以来一直在使用它。SSIS 非常快速且非常强大，但批评是当场的。我发现 SSIS 存在以下问题：

(1) 很难调试，你会得到一些神秘的错误，这些错误可能不会给你任何关于问题所在和问题的提示。

(2) 根据之前的评论，这是有史以来最糟糕的开发环境！我不知道他们在想什么。

(a) 创建一个包含 100 列或更多列的表，并在其上放置一个合并连接。现在返回并尝试对合并连接进行更新（例如拉出一个新列）。在合并连接上单击“确定”以保存更改后，即使在最快的机器上也可能需要几分钟。我有一个庞大的数据流，其中包含许多宽记录和许多合并连接。向数据流中添加一列需要半天以上的时间。我更新了一个合并连接，然后必须去做其他事情，并在 5-10 分钟后检查它是否完成。微软对此的回应是将你的包分解成多个包，将数据放在一个表或它们之间的二进制文件中。好吧，如果您要在所有步骤之间进行磁盘操作，那么您可能会在 SQL 中完成所有事情！

(b) 设计师有时会彻底崩溃，丢失自上次保存以来的所有工作（因此，我现在在睡梦中按 ctrl-S）

(c) 我必须想出一个技巧并在 Excel 中生成 SSIS 包 XML 以获取广泛的记录。我有一个医疗保健客户，其中 600 多条列记录很常见。如果您尝试在 SSIS 中定义具有 600 列的文件格式，您必须一次输入每一列！！！即使是 MS 访问权限，您也可以将电子表格中的布局剪切并粘贴到文件布局中，但 SSIS 不允许。所以我必须从布局中生成 XML 并将 XML 代码粘贴到包中的正确位置。这样做的方式很丑陋，但它节省了一整天的工作时间和许多错误。

(d) 与 (c) 类似，如果您需要修剪所有列并且您有 600 多个列，您猜怎么着？在派生列组件中，您必须输入 trim(column1) 600 多次！我现在在 SQL 查询中执行所有类似这样的简单转换来获取数据，因为可以很容易地从 Excel 工作表生成数据。

(e) 有很多古怪的东西，组件变得不可见，有时你打开包装，所有组件都完全重新排列，不连贯。

(f) FTP 功能，可能是 ETL 中最常见的功能之一，它很弱，只支持没有人使用的普通 FTP。现在每个人都使用 SFTP、FTPS、https 等……所以几乎每个实现都需要使用包必须调用的 3rd 方推荐行驱动的文件传输应用程序。

(g) 尝试 CYA，类似于 Windows Vista 中荒谬的安全性，Microsoft 使得将 SSIS 包从一种环境实际推广到另一种环境变得极其困难。它默认为“使用用户密钥加密敏感信息”安全这一愚蠢的事情，这意味着它必须在您将其移动到的环境中与您开发它的环境相同的帐户下运行，这种情况很少见。有更好的配置方法，但它总是试图恢复到这种完全无用的安全保护。

(h) 最后，这些问题中的大多数现在都在第 3 版中，这清楚地表明 Microsoft 没有计划修复它们。

(i) 调试不像其他语言那么容易。

SSIS 仍然有很多好处，但并非没有一些严重的痛苦。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-02T04:53:27.573

多年前我开始使用 MS Reporting Services，并且非常喜欢它。我没有尝试过 Penaho 的报告解决方案，所以我无法对此发表评论。我也没有尝试过 Analysis Services 或 Pentaho 的替代方案。

最近我需要一个 ETL 解决方案，并且熟悉 MSSQL 和 MSRS，很明显我会审查并可能选择 MS 集成服务。但对我来说，MSI 很糟糕。主要是因为它不直观。在花了几天时间尝试学习该工具后，我决定寻找替代方案并遇到了 Pentaho Data Integration，以前称为 Kettle。我在几分钟内启动并运行了它，并立即创建了我的第一个转换。它只是工作。

诚然，我的需求相当简单，但性能非常好，社区似乎很有帮助。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-04-15T15:48:52.800

我使用过 SSIS 和 Pentaho Kettle，我强烈建议您将 Pentaho Kettle 用于您的 ETL 工具，而不是 SSIS。

我的理由：-SSIS 的流程是任务到任务。Kettle 让您考虑流经系统的数据行。Kettle 的方法对我来说似乎更直观。-SSIS 的文档记录很差。有时候是这样的。但似乎有很多角落里的点击和变量设置。非常复杂。Pentaho 有一个非常有用的社区论坛。-我相信 Pentaho 可以与多种类型的数据库集成，包括 SQL Server。您还可以使用很好的 JDBC。此外，我用它在一侧的 SQL Server 和 Oracle 和另一侧的 Vertica 之间切换。它在 Vertica 上有一个可用的散装装载机。这很不错。-相对而言，我发现让 SSIS 包在服务器上运行非常非常困难。这不值得我花时间。- 我发现 Pentaho 很容易将警告或错误消息发送给一个人或一组人。-Pentaho 允许在 JavaScript 中完成需要一些逻辑的任务。使用我们大多数人都遇到过的语言简单易行。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-01T14:56:10.377

我无法就 MS BI Stack 提供任何意见，但在最近的[Barcamp Orlando](http://barcamporlando.com)上，来自 Pentaho 的人们在那里谈论了他们的产品，这是一个非常令人印象深刻的演示。

事实上，它是一个开源项目，您可以扩展自己以及为真正优质的服务付费的包，这让您有很多选择。他们展示了他们为客户所做的一些有偿工作，他们绝对让观众赞叹不已。

我还有机会与一位为 Pentaho 从事数据仓库方面工作的开发人员聊了聊，他非常敏锐，对建议非常开放，回答任何问题都没有问题。

所以就一家公司而言，Pentaho 的工作以及他们所有开发人员的友好和平易近人都给我留下了深刻的印象。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-04-26T18:35:31.900

几点要补充

*   尽管所有 Pentaho 工具都有一个 windows 版本，但 windows 中的设置很繁琐。Pentaho（尤其是与 GUI 工具分开的服务器启动和停止）通常用于 Linux，而不是 windows shop，并且从 Windows 到 Linux 的学习曲线陡峭。
*   当你转向任何工具时，它都有一个学习曲线。当您习惯在遇到问题时总是单击“确定”并刷新元数据时，SSIS 并没有那么糟糕。Pentaho 也可能很不稳定。

工具问题需要根据更大的文化问题来解决——什么样的商店使用开源工具？根据我的经验，我发现尽管 Microsoft 商店似乎更加僵化，但当您在 ​​Microsoft 商店中遇到连接字符串问题时，您可以获得帮助。在 Pentaho 和 Linux 商店中，它更多的是 DYI。

顺便说一句，注意 Pentaho 销售人员在做演示 - 他们展示的所有东西都比看起来更难工作！:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T22:38:32.047

如果您正在寻找一个强大的、低成本的替代大男孩 LogiXML 在 .NET 平台上提供仪表板和临时报告。自 2006 年底 Pentaho 刚开始时，我们就一直在使用它们，但我有一段时间没看它了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-26T00:34:59.190

我最近尝试了 pentaho 开源 BI。我发现它非常笨拙。它不是很直观，开发时间也更长。

它与 Oracle 或 ms BI 解决方案完全不同。也许企业版更好。

# asp.net-mvc - 如何创建此操作链接？

> ID：150845
> 
> 赞同：1
> 
> 时间：2008-09-29T21:42:39.417
> 
> 标签：asp.net-mvc, actionlink

我在使用 Preview 5 创建 ActionLink 时遇到问题。我能找到的所有文档都描述了旧的通用版本。

我正在 /jobs 页面上的工作列表上构建链接。每个工作都有一个 guid，我想构建一个指向 /jobs/details/{guid} 的链接，以便显示有关该工作的详细信息。我的作业控制器有一个索引控制器和一个详细信息控制器。详细信息控制器需要一个向导。我试过这个

```
<%= Html.ActionLink(job.Name, "Details", job.JobId); %> 
```

但是，这给了我网址“/jobs/details”。我在这里想念什么？

* * *

已解决，在您的帮助下。

路线（在包罗万象的路线之前添加）：

```
routes.Add(new Route("Jobs/Details/{id}", new MvcRouteHandler())
{
Defaults = new RouteValueDictionary(new
    {
    controller = "Jobs",
    action = "Details",
    id = new Guid()
    }
}); 
```

动作链接：

```
<%= Html.ActionLink(job.Name, "Details", new { id = job.JobId }) %> 
```

结果在 html 锚点中：

> [http://localhost:3570/WebsiteAdministration/Details?id=2db8cee5-3c56-4861-aae9-a34546ee2113](http://localhost:3570/WebsiteAdministration/Details?id=2db8cee5-3c56-4861-aae9-a34546ee2113)

所以，它令人困惑的路线。我在网站管理员之前移动了我的工作路线定义，现在它可以工作了。显然，我的路线定义很糟糕。我需要阅读更多示例。

附带说明，我的链接没有显示，并且快速观看不起作用（无法快速观看匿名类型的表达式），这使得弄清楚这里发生了什么变得更加困难。事实证明，由于一个非常小的错字，操作链接没有显示：

```
<% Html.ActionLink(job.Name, "Details", new { id = job.JobId })%> 
```

那会再次吸引我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T21:48:46.313

试一试：

```
<%= Html.ActionLink(job.Name, "Details", new { guid = job.JobId}); %> 
```

其中“guid”是路由中参数的实际名称。这指示路由引擎您要将 job.JobId 属性的值放入路由定义的 guid 参数中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T21:48:08.813

您是否在 Global.asax.cs 文件中定义了处理此问题的路线？默认路由是 {controller}/{action}/{id}。您正在传递“JobID”，框架不会自动映射到“id”。您要么需要将其更改为 job.id，要么定义一个路由来明确处理这种情况。

# java - 如何获取具有匹配源的 JRE/JDK？

> ID：150849
> 
> 赞同：10
> 
> 时间：2008-09-29T21:42:57.577
> 
> 标签：java

我想在我的 Windows 机器上获得至少一个 JRE/JDK 级别，我的 JRE/JDK 源代码与 JRE/JDK 的确切级别相匹配。我的目的是能够在调试时进入系统类。关于如何做到这一点的任何建议？提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T21:50:16.327

大多数有用的源代码都在 JDK 的 src.zip 文件中。

您可以从[jdk6.dev.java.net](https://jdk6.dev.java.net/)获取最高 jdk 6u3 的源代码。在 Linux 上，您可以从[openjdk.java.net](http://openjdk.java.net/)获取 OpenJDK 源代码和软件包。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-13T04:27:23.460

我有这个问题很长时间了；源下载站点一定没有在那里维护一段时间。

不过，它现在似乎已修复：

[http://download.java.net/jdk6/6u10/archive/](http://download.java.net/jdk6/6u10/archive/)

（包含所有 JDK 6 源代码下载的链接，而不仅仅是 6u10。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T21:44:51.770

源代码包含在 JDK 1.5+ 安装程序中。只需确保在安装时未取消选中该选项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T21:45:25.153

只需安装JDK。它也将安装私有 JRE，并且源将匹配。

如果您需要特定的 JDK，请参见此处：http: [//java.sun.com/products/archive/](http://java.sun.com/products/archive/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T09:54:37.707

如果您使用的是 Eclipse，则可以将 JDK 绑定到其源，如果它没有自动完成。这是在 Window > Preferences > Java > Installed JREs 中完成的。您编辑列出的 JRE/JDK 之一，并为“系统库”上的每个 jar 指明 src 是什么（例如，您可以设置 JDK 附带的 zip）。这样您就可以调试任何 JDK 类。

# c - 哪些 IDE 和工具可用于 C 语言开发？

> ID：150876
> 
> 赞同：3
> 
> 时间：2008-09-29T21:48:53.333
> 
> 标签：c, ide, development-environment

因为我在[另一个 SO 问题](https://web.archive.org/web/20111127143032if_/http://stackoverflow.com/questions/296/should-i-learn-c)中看到了学习一些 C 语言，所以这对学习语言和历史经验很有帮助。

想知道 IDE 的专业人员在用 C 编程时使用什么以及其他哪些工具有用吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T21:57:32.253

我一直很喜欢[Code::Blocks](http://www.codeblocks.org)这是一个很棒的 C/C++ IDE，有几个有用的插件。至于编译器，我一直使用 MingW，但我听说[DigitalMars C/C++](http://www.digitalmars.com)编译器很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T22:08:59.900

您可以使用 Eclipse，它不是 C 语言中最好的，但它可以工作。对于编译器，我会使用 GNU gcc。对于工具，请查看 CScope、gdb（调试器）。

如果您不喜欢额外的行李，请使用 Microsoft Visual C++ Express 版本，但请记住，里面有很多额外的东西......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T22:35:47.717

我实际上在编辑 C 代码时使用 Vim，所以我不太了解 C IDE。

不过，我经常使用一些工具来提供帮助：

*   Ctags : 为源代码生成标签文件
*   Make : 构建自动化
*   GDB：GNU 调试器
*   GCC：GNU C 编译器

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T21:55:39.013

如果你使用 Windows，我建议使用 Visual Studio。[这里](http://www.microsoft.com/express/vc/)有一个免费的 Express Edition ，但有一个缺点——Visual C++ 为 Win32 和 .Net 开发提供了很多“附加功能”。

在尝试专注于 C 时，这些添加的功能可能会令人困惑。

我学会了使用[Borland 的 Turbo](http://en.wikipedia.org/wiki/Turbo_C) C。不过，那是前一阵子了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T21:58:07.010

我使用 Cygwin 作为开发环境，使用 Notepad++ 作为编辑器；我更喜欢一组简单的应用程序，每个应用程序都做一件事，而不是大量复杂的 IDE。Visual Studio 在这个意义上特别成问题。它不仅非常面向 C++，而且由于其大量的特性，它对新程序员来说完全是压倒性的。

MSVC 也缺乏对大多数 C99 标准的支持，这在用 C 编程时可能非常烦人。例如，您必须在代码块的顶部声明所有变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T22:00:16.007

我最喜欢的是[Slickedit](http://www.slickedit.com)。一个全面的 IDE，第一个具有 C 和 C++ 函数提示（想想，intellisense）的应用程序，可与 GCC 或几乎所有 c/c++ 编译器一起使用，将帮助您管理 make 文件或让您自己完成所有工作，快速，干净，总之很光滑。还与几乎所有版本控制服务器集成。完全可配置，具有 C/C++ 重构，并且将读取/导入几乎任何/所有其他项目类型。

当然，您必须为此付费，但是如果您想要良好的体验，通常会这样做。

或者，有许多免费的代码开发工具，如[Eclipse](http://www.eclipse.org/)、[Textpad](http://www.textpad.com/)、[CodeBlocks](http://www.codeblocks.org/)、[Editpad](http://www.editpadpro.com/editpadlite.html)，它们都具有不同级别的项目集成。Microsoft 的大多数开发应用程序都可以在他们的 Visual Studio Express 应用程序中使用，如果那是你的一杯茶的话。

当然，不要忘记经典：[Vi](http://en.wikipedia.org/wiki/Vi)、[Emacs](http://www.gnu.org/software/emacs/)。人们使用这些工具开发了很长时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T23:58:01.027

如果在**Windows**平台上开发，[Zeus](http://www.zeusedit.com/ccpp.html)编辑器支持 C 语言。

[![替代文字](https://i.stack.imgur.com/pj2wI.jpg)](https://i.stack.imgur.com/pj2wI.jpg)
[（来源：[zeusedit.com](http://www.zeusedit.com/images/_lookmain.jpg)）]

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T22:06:14.447

[Netbeans](http://www.netbeans.org/features/cpp/)提供了一个相当流畅的 C/C++ 开发环境。非常适合已经熟悉 NB 进行 Java、Ruby 或 PHP 开发的任何人。提供许多与 Visual Studio、Borland 或 CodeWarrior 相同的功能（它们还在吗？），但不依赖于专有库。它还提供了一个可移植的开发环境，因此您可以在平台之间获得一致的工作流程和工具集。

当然，使用 GNU 编译器工具正确配置的 Vim 可以提供非常流畅的体验。您不会看到弹出窗口和 gui，但它可以自动化构建过程，甚至跳转到代码中的错误。

# email - 什么会导致 Word 文档附件发生变异？

> ID：150881
> 
> 赞同：2
> 
> 时间：2008-09-29T21:50:12.397
> 
> 标签：email, ms-word, attachment

我们通过电子邮件（自动系统，而不是手动）发送 Word 文档。电子邮件已发送给用户，并抄送给我。

我们收到报告称某些用户的附件已损坏，但当我们打开抄送给我的副本时，它可以正常打开。

当用户将他们收到的副本转发给我们时，我们无法打开它。

下面是两个文件的十六进制比较。任何人都可以识别这里发生了什么吗？

[![](https://i.stack.imgur.com/8sSqA.png)](https://i.stack.imgur.com/8sSqA.png)

邮件标题如下

```
Return-Path: <info@example.co.nz>
Received: from animal.hosts.net.nz (root@localhost) by example.co.nz
 (8.12.11/8.12.11) with ESMTP id m8T52Mw6021168; Mon, 29 Sep 2008 18:02:22
 +1300
X-Clientaddr: 210.48.108.196
Received: from marjory.hosts.net.nz (marjory.hosts.net.nz
 [210.48.108.196]) by animal.hosts.net.nz (8.12.11/8.12.11) with ESMTP id
 m8T52EvU028021; Mon, 29 Sep 2008 18:02:19 +1300
Received: from example.example.co.nz ([210.48.67.48]) by
 marjory.hosts.net.nz with esmtp (Exim 4.63) (envelope-from
 <info@example.co.nz>) id 1KkAtd-0004Ch-I9; Mon, 29 Sep 2008 18:02:09 +1300
Received: from localhost ([127.0.0.1]) by example.example.co.nz with esmtp
 (Exim 4.63) (envelope-from <info@example.co.nz>) id 1KkAtV-0001C3-4s;
 Mon, 29 Sep 2008 18:02:01 +1300
From: "XXX" <info@example.co.nz>
To: "Sue" <sue@example.co.nz>
Reply-To: jayar_navarro@example.com
Subject: XXX: new application received
Date: Mon, 29 Sep 2008 18:02:01 +1300
Content-Type: multipart/mixed;
 charset="utf-8";
 boundary="=_5549133ca51ec83196e2cfd28dad40f7"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
MIME-Version: 1.0
Message-ID: <E1KkAtV-0001C3-4s@example.example.co.nz> 
```

* * *

我想我知道它是什么，但不知道它为什么会发生。

“X-Mimeole：由 Microsoft Exchange V6.5 制作”客户端正在使用 Exchange。现在，比较这些行。

原本的：

```
Content-Type: multipart/mixed;
 charset="utf-8";
 boundary="=_5549133ca51ec83196e2cfd28dad40f7" 
```

他们得到什么：

```
Content-Type: multipart/mixed;
 boundary="----_=_NextPart_001_01C92270.6BBA3EE6" 
```

缺少的 charset="UTF-8" 可能意味着客户端将退回到 Windows-1252，我认为（有人可以确认吗？）会导致附件损坏。

现在的问题是，为什么要剥离字符集？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T21:53:30.610

不知道会发生什么，但是您是否尝试过压缩文件？这有时可以解决电子邮件附件损坏的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T22:00:32.073

损坏的字符中缺少前 3 个字符 - 比较

```
// Your correct version
00000BC0 0D 0D 0D 41

// Their corrupted one
00000BC0 D0 D4 1... 
```

他们的邮件服务器、邮件程序、防病毒程序或某些此类程序已删除了前几个字符，这似乎在 Word 尝试打开它时造成了混乱。

当他们将文件发回给您时，文件仍然是乱码的事实证实，一旦收到文件，他们这边的文件就会发生改变。

# .net - 套接字编程：某些 ISP 是否对 FTP 上传施加了速率限制？

> ID：150886
> 
> 赞同：2
> 
> 时间：2008-09-29T21:52:21.033
> 
> 标签：.net, networking, sockets

我目前正在尝试使用我们的一款产品中的 FTP 上传功能来调试客户的问题。该功能允许客户将文件 (< 1MB) 上传到中央 FTP 服务器以进行进一步处理。FTP 客户端代码是用 VB.NET 内部编写的。

客户报告在尝试上传 300KB 到 500KB 范围内的文件时收到“远程主机强制关闭连接”错误。但是，我们使用更大的文件（相对而言）（即 3MB 及以上）在内部对此进行了测试，但从未收到此错误。我们使用相同的 FTP 登录凭据上传到客户端连接到的同一 FTP 服务器，唯一的区别是我们是在办公室完成的。

我知道 TCP 协议具有内置的流量控制，因此在单个 Send 调用中发送多少数据并不重要，因为该协议会相应地限制自己以匹配服务器的内部限制（如果我没记错的话。 ..)

因此，我唯一能想到的是，客户端和路由器之间的中间主机人为地对客户端进行限速并断开连接（我们以 512 字节块的形式循环发送文件数据）。

这是用于发送数据的循环（缓冲区是包含文件数据的字节数组）：

```
 For i = 0 To buffer.Length - 1 Step 512
                mDataSocket.Send(buffer, i, 512, SocketFlags.None)
                OnTransferStatus(i, buffer.Length)
            Next 
```

客户的 ISP（或他们自己的防火墙）是否有可能对我们的客户端代码在给定时间段内可以发送的数据量施加人为的速率限制？如果是这样，处理这种情况的最佳方法是什么？我想显而易见的解决方案是在我们的发送循环中引入延迟，除非有办法在套接字级别执行此操作。

对我来说，ISP 会通过终止客户端连接来处理速率限制违规，这似乎真的很奇怪。为什么他们不只依赖 TCP/IP 的内部流量控制/节流机制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T22:07:05.913

搜索 Comcast 和 BitTorrent。这是[一篇文章](http://www.alternet.org/columnists/story/69779/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T22:09:53.113

尝试隔离问题：

*   让客户将相同的文件上传到不同的服务器。也许问题出在客户端的... FTP 客户端。
*   从客户端获取文件并自己与客户端一起上传，看看是否可以重现该问题。

最后，即使 3MB 的文件可以正常工作，500KB 的文件也不能保证正常工作，因为问题可能取决于状态，并且在结束文件传输时发生。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T22:24:10.770

是的，ISP 可以在他们认为合适的情况下对数据包施加限制（尽管这在道德上是有问题的）。例如，我的 ISP 在切断其硬件设法嗅出的任何 P2P 流量方面没有问题。它称为[流量整形](http://en.wikipedia.org/wiki/Traffic_shaping)。

然而，对于 FTP 流量来说，这是极不可能的，但你永远不知道。问题是，他们永远不会通过流量整形丢弃你的套接字，他们只会丢弃数据包。tcp 协议在每个 pear 端处理，因此您可以丢弃其间的所有数据包并且套接字保持活动状态。在某些情况下，如果其中一台计算机崩溃，如果您不尝试使用它，则该套接字仍然存在。

我认为你最好的选择是客户端的防火墙/代理配置不好。[这里](http://blogs.msdn.com/sql_protocols/archive/2008/04/08/understanding-connection-forcibly-closed-by-remote-host-errors-caused-by-toe-chimney.aspx)有更好的解释。

客户端安装上的路由器或电缆有故障或配置错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T22:55:11.897

这些天500k非常小，所以如果他们限制这么小的东西，我会有点惊讶。

我知道你已经在分块你的请求，但你能确定是否有任何数据被传输吗？代码是否总是在同一个循环点失败？您可以查看 ftp 服务器日志吗？整个堆栈跟踪呢？您是否尝试过联系 ISP 并询问他们有哪些政策？

也就是说，假设某些数据可以通过，一种想法是 ISP 具有流量整形功能，并且在写入 x 个字节后执行规则。可能发生的情况是在 data > x 时，套接字超时在数据发送之前到期，引发异常。

请记住，ftp 客户端会为数据传输创建另一个连接，但如果服务器检测到控制连接已关闭，它通常会终止数据传输连接。所以要检查的另一件事是确保控制连接仍然存在。

最后，ftp 服务器通常支持可恢复传输，所以如果所有其他补救措施都失败了，恢复失败的传输可能是最简单的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T21:54:45.160

我不认为 ISP 会尝试终止 500KB 的文件传输。我不是套接字事物或 ISP 方面的专家……只是就此事发表我的看法。

# sql - 删除带有警告的重复项

> ID：150891
> 
> 赞同：2
> 
> 时间：2008-09-29T21:53:18.020
> 
> 标签：sql, sql-server, duplicate-data

我有一个带有 rowID、经度、纬度、businessName、url、标题的表。这可能看起来像：

```
rowID | long  | lat |  businessName | url | caption

  1      20     -20     Pizza Hut   yum.com  null 
```

如何删除所有重复项，但仅保留具有 URL 的副本（第一优先级），或者如果另一个没有 URL 则保留具有标题的副本（第二优先级）并删除其余部分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T01:25:49.430

上周“我在 Stack Overflow 上学到的东西”为您带来了这个解决方案：

```
DELETE restaurant
WHERE rowID in 
(SELECT rowID
    FROM restaurant
    EXCEPT
    SELECT rowID 
    FROM (
        SELECT rowID, Rank() over (Partition BY BusinessName, lat, long ORDER BY url DESC, caption DESC ) AS Rank
        FROM restaurant
        ) rs WHERE Rank = 1) 
```

警告：我没有在真实数据库上测试过

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T22:13:07.473

这是我的循环技术。这可能会因为不是主流而被否决——我对此很冷静。

```
DECLARE @LoopVar int

DECLARE
  @long int,
  @lat int,
  @businessname varchar(30),
  @winner int

SET @LoopVar = (SELECT MIN(rowID) FROM Locations)

WHILE @LoopVar is not null
BEGIN
  --initialize the variables.
  SELECT 
    @long = null,
    @lat = null,
    @businessname = null,
    @winner = null

  -- load data from the known good row.  
  SELECT
    @long = long,
    @lat = lat,
    @businessname = businessname
  FROM Locations
  WHERE rowID = @LoopVar

  --find the winning row with that data
  SELECT top 1 @Winner = rowID
  FROM Locations
  WHERE @long = long
    AND @lat = lat
    AND @businessname = businessname
  ORDER BY
    CASE WHEN URL is not null THEN 1 ELSE 2 END,
    CASE WHEN Caption is not null THEN 1 ELSE 2 END,
    RowId

  --delete any losers.
  DELETE FROM Locations
  WHERE @long = long
    AND @lat = lat
    AND @businessname = businessname
    AND @winner != rowID

  -- prep the next loop value.
  SET @LoopVar = (SELECT MIN(rowID) FROM Locations WHERE @LoopVar < rowID)
END 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T22:34:37.717

基于集合的解决方案：

```
delete from T as t1
where /* delete if there is a "better" row
         with same long, lat and businessName */
  exists(
    select * from T as t2 where
      t1.rowID <> t2.rowID
      and t1.long = t2.long
      and t1.lat = t2.lat
      and t1.businessName = t2.businessName 
      and
        case when t1.url is null then 0 else 4 end
          /* 4 points for non-null url */
        + case when t1.businessName is null then 0 else 2 end
          /* 2 points for non-null businessName */
        + case when t1.rowID > t2.rowId then 0 else 1 end
          /* 1 point for having smaller rowId */
        <
        case when t2.url is null then 0 else 4 end
        + case when t2.businessName is null then 0 else 2 end
        ) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T22:43:44.217

```
delete MyTable
from MyTable
left outer join (
        select min(rowID) as rowID, long, lat, businessName
        from MyTable
        where url is not null
        group by long, lat, businessName
    ) as HasUrl
    on MyTable.long = HasUrl.long
    and MyTable.lat = HasUrl.lat
    and MyTable.businessName = HasUrl.businessName
left outer join (
        select min(rowID) as rowID, long, lat, businessName
        from MyTable
        where caption is not null
        group by long, lat, businessName
    ) HasCaption
    on MyTable.long = HasCaption.long
    and MyTable.lat = HasCaption.lat
    and MyTable.businessName = HasCaption.businessName
left outer join (
        select min(rowID) as rowID, long, lat, businessName
        from MyTable
        where url is null
            and caption is null
        group by long, lat, businessName
    ) HasNone 
    on MyTable.long = HasNone.long
    and MyTable.lat = HasNone.lat
    and MyTable.businessName = HasNone.businessName
where MyTable.rowID <> 
        coalesce(HasUrl.rowID, HasCaption.rowID, HasNone.rowID) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T09:36:28.687

与另一个答案类似，但您想根据行号而不是排名来删除。也可以与公用表表达式混合：

```
 ;WITH GroupedRows AS
(   SELECT rowID, Row_Number() OVER (Partition BY BusinessName, lat, long ORDER BY url DESC, caption DESC) rowNum 
    FROM restaurant
)
DELETE r
FROM restaurant r
JOIN GroupedRows gr ON r.rowID = gr.rowID
WHERE gr.rowNum > 1 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T22:23:08.930

如果可能，您可以均质化，然后删除重复项吗？

第1步：

```
UPDATE BusinessLocations
SET BusinessLocations.url = LocationsWithUrl.url
FROM BusinessLocations
INNER JOIN (
  SELECT long, lat, businessName, url, caption
  FROM BusinessLocations 
  WHERE url IS NOT NULL) LocationsWithUrl 
    ON BusinessLocations.long = LocationsWithUrl.long
    AND BusinessLocations.lat = LocationsWithUrl.lat
    AND BusinessLocations.businessName = LocationsWithUrl.businessName

UPDATE BusinessLocations
SET BusinessLocations.caption = LocationsWithCaption.caption
FROM BusinessLocations
INNER JOIN (
  SELECT long, lat, businessName, url, caption
  FROM BusinessLocations 
  WHERE caption IS NOT NULL) LocationsWithCaption 
    ON BusinessLocations.long = LocationsWithCaption.long
    AND BusinessLocations.lat = LocationsWithCaption.lat
    AND BusinessLocations.businessName = LocationsWithCaption.businessName 
```

第 2 步：删除重复项。

# wpf - Windows 窗体 UserControl 覆盖未被调用

> ID：150900
> 
> 赞同：0
> 
> 时间：2008-09-29T21:56:10.820
> 
> 标签：wpf, winforms, c++-cli, user-controls, onpaint

我正在创建一个从 UserControl 派生的 Windows 窗体控件，以嵌入到 WPF 应用程序中。我通常遵循[此链接](http://www.codeproject.com/KB/WPF/WPFOpenGL.aspx?display=Print)中给出的程序。

```
public ref class CTiledImgViewControl : public UserControl
{
...

virtual void OnPaint( PaintEventArgs^ e ) override;

...
}; 
```

在我的 CPP 文件中：

```
void CTiledImgViewControl::OnPaint( PaintEventArgs^ e )
{
    UserControl::OnPaint(e);
    // do something interesting...
} 
```

一切都编译并运行，但是 OnPaint 方法永远不会被调用。

对要寻找的东西有什么想法吗？我用 C++ 做了很多，但对 WinForms 和 WPF 还是很陌生，所以它很可能是显而易见的......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T23:13:26.097

通常`OnPaint`不会在 a 中调用，`UserControl`除非您在使用该`SetStyle`方法构造它时设置了适当的样式。您需要将`UserPaint`样式设置为 true`OnPaint`才能被调用。

```
SetStyle(ControlStyles::UserPaint, true); 
```

### 更新

我最近自己遇到了这个问题，并去寻找答案。我想在绘制期间执行一些计算（以利用绘制消息的独特处理），但我并不总是接到`OnPaint`.

在用反射器挖掘之后，我发现只有在相应消息的剪切矩形不为空`OnPaint`时才会调用它。`WM_PAINT`我的`UserControl`实例有一个子控件，它填充了整个客户区域，因此将其全部剪掉。这意味着剪切矩形是空的，所以没有`OnPaint`调用。

我通过直接覆盖`WndProc`和添加处理程序来解决这个问题，`WM_PAINT`因为我找不到另一种方法来实现我想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T14:13:05.090

我解决了这个问题，以防有人感兴趣。这是因为我的 WinForms 控件嵌入在 ViewBox 中。我将其更改为网格并立即开始获取绘制事件。我想在询问有关 WPF 的问题时，您应该始终在问题中包含 XAML！

# .net - .Net 正则表达式验证表达式 ASCII

> ID：150901
> 
> 赞同：1
> 
> 时间：2008-09-29T21:56:11.897
> 
> 标签：.net, regex, ascii

任何人都知道一个好的正则表达式可以放入 ValidationExpression 以确保我的用户只输入 ASCII 字符？

```
<asp:RegularExpressionValidator id="myRegex" runat="server" ControlToValidate="txtName" ValidationExpression="???" ErrorMessage="Non-ASCII Characters" Display="Dynamic" /> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T15:27:02.167

您可能需要注意的一件事是 ASCII 表的下部有很多控制字符，这可能会导致奇怪的结果。这是我用来只允许“非时髦”字符的表达式：

```
^([^\x0d\x0a\x20-\x7e\t]*)$ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T22:05:35.777

如果要映射可能的 0x00 - 0xff ASCII 值，可以使用此正则表达式 (.NET)。

```
^([\x00-\xff]*)$ 
```

# hibernate - Hibernate -- 根据成员对象的字段加载对象

> ID：150902
> 
> 赞同：2
> 
> 时间：2008-09-29T21:56:20.320
> 
> 标签：hibernate, criteria

如何根据成员对象的字段值通过 Hibernate 加载对象？例如，假设存在以下类，bar 和 foo 之间存在一对一的关系：

```
Foo {
    Long id;
}

Bar {
    Long id;
    Foo aMember;
} 
```

如果您只有 Foo 的 id，如何使用 Hibernate Criteria 加载 Bar？

我想到的第一件事是加载 Foo 对象并将其设置为加载 Bar 对象的标准，但这似乎很浪费。是否有使用 Criteria 执行此操作的有效方法，或者 HQL 是否应该处理？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T22:15:49.247

您绝对可以以有效的方式使用 Criteria 来完成此操作：

```
session.createCriteria(Bar.class).
        createAlias("aMember", "a").
        add(Restrictions.eq("a.id", fooId)); 
```

应该做的伎俩。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T13:00:53.987

您可以使用标准或 HQL。

HQL 示例：

查询 query = session.createQuery("from Bar as bar where bar.aMember.id = :fooId");

query.setParameter("fooId", fooId);

列表结果 = query.list();

# security - 如何以类似于 Apache 的 AuthType / AuthUserFile 机制的方法对 IIS 进行密码保护？

> ID：150923
> 
> 赞同：0
> 
> 时间：2008-09-29T22:05:00.847
> 
> 标签：security, apache, iis, authentication

我习惯于在 Apache 配置文件中使用以下方法为 Apache 进行基本密码保护：

> AuthType Basic
> AuthName “仅限邀请”
> AuthUserFile /path/to/.htpasswd
> 需要有效用户

但是，有人要求我对在 IIS6 之上运行 ColdFusion 的站点的子目录进行一些保护，但我不熟悉如何执行此操作。这是怎么做到的？我应该注意什么？我只需要密码保护一个管理子目录，所以我不需要一个完整的用户登录系统——只是限制谁可以访问该站点的部分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T22:08:36.953

您可以进入 IIS 6 和您要保护的网站文件夹的属性。单击目录安全选项卡并取消选中允许匿名。然后您需要选择一种身份验证类型。如果它通过 SSL，您可以使用基本类型，否则使用其他类型。但是既然你提到了基本的，这可能就足够了。请记住，基本身份验证将以纯文本形式发送密码。Thsi 将要求登录 Windows 以访问该文件夹。您可以为此创建一个受限的 wandows 帐户，不管它是在域上还是在本地。另外，无论您使用现有帐户还是创建新帐户，请确保该文件夹至少具有对该文件夹及其子文件夹的读取权限文件夹。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-29T22:09:04.237

我相信您正在寻找[来自 Parker Software 的 IISPassword](http://www.iistools.com/en/iispassword.html)。

# c# - .NET Windows 窗体应用程序自我更新的最佳方式是什么？

> ID：150935
> 
> 赞同：3
> 
> 时间：2008-09-29T22:07:40.233
> 
> 标签：c#, .net, winforms, auto-update

我使用了一个本土系统，其中应用程序通过 Web 服务进行自我更新。但是，我似乎记得最初的 .NET 销售宣传中关于自动更新组件是 .NET 的内置功能的一些内容。让应用程序更新自身和/或其使用的程序集的最佳实践是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T22:10:05.187

您可能想看看 Click-Once 技术。这些参考资料中有一些很好的例子。

[http://www.codeproject.com/KB/install/QuickClickOnceArticle.aspx](http://www.codeproject.com/KB/install/QuickClickOnceArticle.aspx)

[http://msdn.microsoft.com/en-us/magazine/cc163973.aspx](http://msdn.microsoft.com/en-us/magazine/cc163973.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T22:13:32.853

[ClickOnce](http://msdn.microsoft.com/en-us/library/142dbbz4.aspx)会做你想做的一切吗？

# parsing - 计算机科学教科书进行文本/xml/任何解析的方法

> ID：150937
> 
> 赞同：3
> 
> 时间：2008-09-29T22:07:57.627
> 
> 标签：parsing, computer-science, theory

它已经在我的脑海里嗡嗡作响了一段时间。

我对 Compilers/Flex/Byson 等进行了一些调查，但我从未找到详细讨论“解析堆栈”或如何实现一个的好参考。

有谁知道我可以赶上的好的参考资料？

**编辑**：我非常感谢所有编译器参考，我将列出一些书籍，但我的主要关注点是解析本身，而不是你之后用它做什么。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T22:12:41.000

龙[书](https://rads.stackoverflow.com/amzn/click/com/0321486811)！我最近用它编写了一个编译器（用 PHP！），用于处理用 RTF 编写的模板文件的语言......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-22T20:23:39.837

这是对您接受为正确答案的 Dima 的回答的回应。虽然说解析与自动机理论有关这不是一个糟糕的答案，但我觉得这里有一些误解。

*   首先，*有限状态自动机*只能识别正则语言（例如正则表达式）。为了识别上下文无关语言，您需要更强大的*下推自动机。*有关更多自动机及其与不同语言类别的关系，请参见[http://en.wikipedia.org/wiki/Automata_theory#Classes_of_automata 。](http://en.wikipedia.org/wiki/Automata_theory#Classes_of_automata)

*   其次，**解析**不同于**识别**。识别字符串只会告诉您该字符串是否是您的语法生成的语言。解析器的目的是生成一个更难且通常更有用的具体语法树。

解析方法种类繁多，因此很难为您提供一份具体的参考资料来告诉您需要了解的内容……总的来说，您应该了解自[顶向下解析](http://en.wikipedia.org/wiki/Top-down_parsing)和[自底向上解析](http://en.wikipedia.org/wiki/Bottom-up_parsing)之间的区别。但如果您有兴趣，这里是解析器生成器采用的一些常用技术的概述：

*   [LR Parsing](http://en.wikipedia.org/wiki/LR_parser)、[LL Parsing](http://en.wikipedia.org/wiki/LL_parser)、[SLR Parsing](http://en.wikipedia.org/wiki/Simple_LR_parser)、[LALR Parsing](http://en.wikipedia.org/wiki/LALR_parser)、[GLR Parsing](http://en.wikipedia.org/wiki/GLR_parser)的维基百科文章
*   ANTLR 的[LL(*) 解析](http://www.antlr.org/papers/LL-star-PLDI11.pdf)
*   [Haskell 中的 Monadic Parsing](http://www.cs.nott.ac.uk/~gmh/pearl.pdf)（用于在函数式编程语言中构建解析器）
*   还有更奇特的[Parsing Expression Grammars](http://en.wikipedia.org/wiki/Parsing_expression_grammar)

**EDIT:** I'm sorry for bumping this question again, I just happened across two excellent posts describing the relationship between [regular languages and finite automata](http://scientopia.org/blogs/goodmath/2011/03/29/regular-languages/), [context-free languages and push-down automata](http://scientopia.org/blogs/goodmath/2011/04/26/the-next-step-in-computation-level-2-languages/). Might be interesting for people who find this question.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:27:35.323

解析器基本上是一个有限状态机，也就是一个有限自动机。你应该找到一本关于计算理论的书，它讨论了有限自动机，以及诸如常规语言、上下文无关语言等之类的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T22:11:24.437

试试[亚马逊](http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Dstripbooks&field-keywords=compiler+construction&x=20&y=16)

*编译器构造*只是一个很好的例子

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T05:51:21.630

查看“Brinch Hansen on Pascal Compilers”。它写于 1985 年，但我去年在编译器课程中使用了它（当然是 Per Brinch Hansen。），发现它非常简洁，对编译器设计很有帮助。

# sql-server - 如何在连接到 SQL Server 2005 的 oledb 连接字符串中指定端口号？

> ID：150941
> 
> 赞同：6
> 
> 时间：2008-09-29T22:08:49.387
> 
> 标签：sql-server, connection-string

刚发现这一点，所以我正在回答我自己的问题:)

在通常使用冒号的地方使用逗号。这可能是命名实例的问题，因为您似乎需要指定端口，即使它是默认端口 1433。

例子：

```
Provider=SQLOLEDB;Data Source=192.168.200.123,1433; Initial Catalog=Northwind; User Id=WebUser; Password=windy" 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T22:16:07.030

我总是查看[http://www.connectionstrings.com/](http://www.connectionstrings.com/)。它是连接字符串的绝佳资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T22:19:59.377

好电话 BlackWasp，实际上这就是我找到答案的地方！（但它有点被埋没了，所以我写了这篇希望更清楚的文章）

# ruby - 在 Vista 上安装 RubyGems 时出现错误“set_paths: undefined method uid for nil:NilClass (NoMethodError)”

> ID：150953
> 
> 赞同：0
> 
> 时间：2008-09-29T22:10:29.303
> 
> 标签：ruby, windows-vista, rubygems

尝试安装[RubyGems](http://docs.rubygems.org/)时出现以下错误。我试过谷歌搜索，但没有运气。有没有人遇到过并解决过这个问题？

```
 C:\rubygems-1.3.0> ruby setup.rb
.
.
install -c -m 0644 rubygems/validator.rb C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/validator.rb
install -c -m 0644 rubygems/version.rb C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/version.rb
install -c -m 0644 rubygems/version_option.rb C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/version_option.rb
install -c -m 0644 rubygems.rb C:/Ruby/lib/ruby/site_ruby/1.8/rubygems.rb
install -c -m 0644 ubygems.rb C:/Ruby/lib/ruby/site_ruby/1.8/ubygems.rb
cp gem C:/Users/brian/AppData/Local/Temp/gem
install -c -m 0755 C:/Users/brian/AppData/Local/Temp/gem C:/Ruby/bin/gem
rm C:/Users/brian/AppData/Local/Temp/gem
install -c -m 0755 C:/Users/brian/AppData/Local/Temp/gem.bat C:/Ruby/bin/gem.bat
rm C:/Users/brian/AppData/Local/Temp/gem.bat
Removing old RubyGems RDoc and ri
Installing rubygems-1.3.0 ri into C:/Ruby/lib/ruby/gems/1.8/doc/rubygems-1.3.0/ri
./lib/rubygems.rb:713:in `set_paths': undefined method `uid' for nil:NilClass (NoMethodError)
        from ./lib/rubygems.rb:711:in `each'
        from ./lib/rubygems.rb:711:in `set_paths'
        from ./lib/rubygems.rb:518:in `path'
        from ./lib/rubygems/source_index.rb:66:in `installed_spec_directories'
        from ./lib/rubygems/source_index.rb:56:in `from_installed_gems'
        from ./lib/rubygems.rb:726:in `source_index'
        from ./lib/rubygems.rb:138:in `activate'
        from ./lib/rubygems.rb:49:in `gem'
        from setup.rb:279:in `run_rdoc'
        from setup.rb:296

C:\rubygems-1.3.0>
```

我在运行 Windows Vista 的笔记本电脑上安装了 Ruby 1.8.6。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T22:16:22.567

我假设您没有尝试在 cygwin 下安装；该安装适用于类 Unix 操作系统。编辑：（实际上，从上面的日志看来，正在运行一些特定于 Windows 的东西......也许你遇到了 UAC 保护问题？）

如果你只是使用[Windows ruby​​ 一键安装程序](http://rubyforge.org/projects/rubyinstaller/)，它包括 ruby​​gems。如果您没有获得 ruby​​gems 功能，您可能需要 `require "rubygems"`在脚本中添加 -rubygems 或将 -rubygems 添加到您的 RUBYOPT 环境变量中。（您也可以使用`ruby -rubygems myscript.rb`.

您是否出于其他原因尝试单独安装它？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T22:28:53.160

我在 Vista 上安装了 ruby​​gems 1.2.0，它运行良好。我还没有测试过 ruby​​gems 1.3.0。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T19:53:22.107

我在 Vista 上的 ruby​​gems 1.3 中发现了同样的错误。我降级到 1.2，它似乎已经修复它

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T15:14:55.920

我也可以确认，由于某种奇怪的原因，Windows 上的 ruby​​gems 1.3.0 根本不起作用。

通过在 1.3.0 之上重新安装 1.2.0 来降级。

# sql - 在 SQL 查询中执行正则表达式（替换）

> ID：150977
> 
> 赞同：18
> 
> 时间：2008-09-29T22:16:39.570
> 
> 标签：sql, sql-server, regex, sql-server-2000

`&lt;`在给定的数据库列中替换所有 '<' 的最佳方法是什么？基本执行`s/&lt[^;]/&lt;/gi`

笔记：

*   必须在[MS SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005) 2000中工作
*   必须是可重复的（并且不能以 结尾`&lt;;;;;;;;;;`）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-29T22:46:30.873

需要一些黑客攻击，但我们可以使用**LIKE**、**PATINDEX**、**LEFT** AND **RIGHT**和良好的旧字符串连接来做到这一点。

```
create table test
(
    id int identity(1, 1) not null,
    val varchar(25) not null
)

insert into test values ('&lt; <- ok, &lt <- nok')

while 1 = 1
begin
    update test
        set val = left(val, patindex('%&lt[^;]%', val) - 1) +
                      '&lt;' +
                      right(val, len(val) - patindex('%&lt[^;]%', val) - 2)
    from test
    where val like '%&lt[^;]%'

    IF @@ROWCOUNT = 0 BREAK
end

select * from test 
```

更好的是，这与 SQL Server 版本无关，应该可以正常工作。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-30T15:50:49.473

我认为如果你使用不同的东西，这可以做得更干净:)

```
create table test
(
    id int identity(1, 1) not null,
    val varchar(25) not null
)

insert into test values ('&lt; <- ok, &lt <- nok')

WHILE 1 = 1
BEGIN
    UPDATE test SET
        val = STUFF( val , PATINDEX('%&lt[^;]%', val) + 3 , 0 , ';' )
    FROM test
    WHERE val LIKE '%&lt[^;]%'

    IF @@ROWCOUNT = 0 BREAK
END

select * from test 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T16:05:26.100

怎么样：

```
 UPDATE tableName
    SET columName = REPLACE(columName , '&lt', '&lt;')
    WHERE columnName LIKE '%lt%'
    AND columnName NOT LIKE '%lt;%' 
```

编辑：

我刚刚意识到这将忽略具有部分正确`&lt;`字符串的列。

在这种情况下，您可以忽略 where 子句的第二部分，然后调用它：

```
 UPDATE tableName
    SET columName = REPLACE(columName , '&lt;;', '&lt;') 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T16:26:13.477

如果 MSSQL 的正则表达式支持负前瞻，那将是解决此问题的正确方法。

```
s/&lt(?!;)/&lt;/gi 
```

将捕获**<**的所有实例，这些实例后面没有**;** （即使它们后面没有任何内容，**[^;]**会错过）并且不捕获以下非**;** 字符作为匹配的一部分，消除了关于该字符在替换中丢失的原始问题的评论中提到的问题。

不幸的是，我不使用 MSSQL，所以我不知道它是否支持负前瞻...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-01-03T11:51:58.503

非常具体到这种模式，但我过去做过类似的事情：

`REPLACE(REPLACE(columName, '&lt;', '&lt'), '&lt', '&lt;')`

更广泛的示例（编码可能在 TITLE 属性中不合适的字符）

```
REPLACE(REPLACE(REPLACE(REPLACE(
REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
    columName
    -- Remove existing encoding:
    , '&amp;', '&')
    , '&#34;', '"')
    , '&#39;', '''')
    -- Reinstate/Encode:
    , '&', '&amp;')
    -- Encode:
    , '"', '&#34;')
    , '''', '&#39;')
    , ' ', '%20')
    , '<', '%3C')
    , '>', '%3E')
    , '/', '%2F')
    , '\', '%5C') 
```

# c# - .NET winforms 应用程序在不使用 ClickOnce 的情况下自我更新的最佳方式是什么？

> ID：150994
> 
> 赞同：23
> 
> 时间：2008-09-29T22:24:21.893
> 
> 标签：c#, .net, winforms, compact-framework

由于技术原因，我不能使用 ClickOnce 自动更新我的 .NET 应用程序及其程序集。在 .NET 中处理自动更新的最佳方法是什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-07-04T04:45:29.027

我们有一个商业/开源产品：[wyBuild & wyUpdate](http://wyday.com/wybuild/)。它具有修补功能，并且使用起来非常简单。

编辑：我被选为负数，但我的帖子不仅仅是公然推销。我们的更新程序 wyUpdate 是开源的，用 C# 编写，并在 BSD 许可下获得许可。

我认为它可能会帮助任何尝试使用 .NET 框架从头开始构建更新程序的人。

但是，如果必须，请投票给我。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-29T22:35:17.543

我认为[更新程序应用程序块](http://msdn.microsoft.com/en-us/library/ms978574.aspx)是 ClickOnce 的先驱。可能值得研究。查看它的源代码可能足以激发一些想法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T13:55:42.293

大约 3-4 年前，我发布了一个位于应用程序外部的示例，如果检测到更新，应用程序调用更新程序并关闭，然后更新完成，应用程序重新启动。

我在旧的 GotDotNet 网站上发布了这个示例……我必须尝试找到它。

它工作得很好，写了大约 1-2 个小时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T14:15:27.113

Indigo Rose 有一个名为[TrueUpdate](http://www.indigorose.com/trueupdate/)的产品，它也可以为您执行此操作。我过去曾在托管和非托管应用程序中使用过它们。它基本上是您放在服务器上的文件（http、ftp，无论您喜欢什么）。然后调用客户端 EXE 来检查更新。更新文件被拉取并具有检测客户端上的版本的逻辑（您的选择、DLL 检测、注册表项读取等）。然后它将为它找到适当的更新程序并下载文件以执行。它也可以通过代理很好地工作。

他们唯一不做的就是为你构建补丁。您必须手动执行此操作，或者使用他们拥有的其他产品。这是一个商业解决方案，但如果你需要它，效果很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-29T15:09:13.883

作为自己动手的起点，可能值得看看[Alex Feinman 在 MSDN 上](http://msdn.microsoft.com/en-us/library/aa446487.aspx)题为“使用 .NET Compact Framework 创建自我更新应用程序”的文章。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T22:35:46.343

写你自己的。

我听说他们第一次写有点困难，但之后就变得简单了。

由于我还没有写过（虽然它在我的清单上），我可以给你一些我想到的东西。保持准确的 dll 版本，因为这对于自我更新很重要。并确保更新程序可以自行更新。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T00:39:22.833

在您的 Program.cs 文件中执行以下操作：

```
 static void Main()
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Update();
        Application.Run(new Form1());
    }

    private static void Update()
    {
        string mainFolder;
        string updateFolder;
        string backupFolder;

        foreach (string file in
            System.IO.Directory.GetFiles(updateFolder))
        {
            string newFile = file.Replace(
                updateFolder, mainFolder);

            if (System.IO.File.Exists(newFile))
            {
                System.IO.File.Replace(file, newFile, backupFolder);
            }
            else
            {
                System.IO.File.Move(file, newFile);
            }
        }
    } 
```

此外，如有必要，可以递归获取目录结构。这将允许您更新项目中的任何 .dll；事实上，一切都在主 .exe 之外。然后在应用程序的其他地方，您可以处理从服务器（或任何地方）获取需要更新的文件，然后将其放入 updateFolder 并重新启动应用程序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T14:25:43.097

在很久以前的一个项目中，我使用 .NET Compact Framework 1.0 编写了一个自动更新应用程序。我们使用 SqlCE 的 CAB 部署功能将文件放到设备上（您现在将使用 Sync Framework），并且我们有一个单独的 exe 来解压缩 CAB 并更新文件。

更新会是这样：提示用户更新，单击按钮并退出 UI 应用程序。更新程序 exe 将接管，从服务器获取 cab 文件，备份当前 dll 并使用 wceload 解压缩 cab 文件。然后将重新启动 UI，如果失败，则将回滚更新。这在紧凑型设备上仍然是一个有趣的场景，但现在有比 sqlce 更好的工具。

如果 clickonce 不是一个选项，我当然会查看更新程序应用程序块和同步框架来实现这一点。但我猜你仍然需要一个单独的可执行文件，因为你想要覆盖的 dll 可能在 exe 使用时被文件锁定，就像前面已经说过的答案之一一样。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-21T00:48:02.243

我编写了自己的自动更新程序，自动更新程序使用一个通用配置文件到应用程序，其中包含从/检查是否需要更新的 URL 下载最新版本。

通过这种方式，您运行更新程序，它要么更新应用程序，要么不更新应用程序，然后运行应用程序，作为正常操作的一部分，它检查更新的更新程序并修补它。

# actionscript-3 - 在我的 ActionScript3 类中，我可以拥有一个带有 getter 和 setter 的属性吗？

> ID：150998
> 
> 赞同：4
> 
> 时间：2008-09-29T22:27:30.560
> 
> 标签：actionscript-3

在我的 ActionScript3 类中，我可以拥有一个带有 getter 和 setter 的属性吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-29T22:59:53.647

好的，您可以对 AS3 类的任何属性使用基本的 getter/setter 语法。例如

```
package {

    public class PropEG {

        private var _prop:String;

        public function get prop():String {
            return _prop;
        }

        public function set prop(value:String):void {
            _prop = value;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T23:02:04.330

是的，您可以在 AS3 类中创建 getter 和 setter 函数。

例子：

```
 private var _foo:String = "";

public function get foo():String{
    return _foo;
}

public function set foo(value:String):void {
    _foo= value;
} 
```

关于 getter 和 setter 的更多信息可以在[这里找到](http://livedocs.adobe.com/flex/201/html/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Book_Parts&file=basic_as_139_08.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-02T18:28:19.570

getter 是一个函数，其返回值取决于我们返回的内容。setter 总是有一个参数，因为我们通过参数给变量一个新值。

我们首先创建一个包含 getter 和 setter 的类的实例，在我们的例子中是“a”。然后我们调用setter，如果我们想更改变量并使用点语法我们调用setter函数并使用=运算符填充参数。为了获取变量的值，我们以与示例 (a.myVar) 中所示类似的方式使用 getter。与常规函数调用不同，我们省略了括号。不要忘记添加返回类型，否则会出错。

包裹 {

```
import flash.display.Sprite;
import flash.text.TextField;

public class App extends Sprite 
{
       private var tsecField:TextField;
       private var tField:TextField;

       public function App() 
       {
               myTest();
       }

       private function myTest():void 
       {
               var a:Testvar = new Testvar();

               tField = new TextField();
               tField.autoSize = "left";
               tField.background = true;
               tField.border = true;
               a.mynewVar = "This is the new var.";
               tField.text = "Test is: "+a.myVar;
               addChild(tField);
       }
} 
```

}

导入 flash.display.Sprite；

导入 flash.text.TextField；

类 Testvar 扩展 Sprite { public var test:String;

```
public function Testvar() 
{
}
public function set mynewVar(newTest:String):void 
{
       test = newTest;
}
public function get myVar():String 
{
       return test;
} 
```

}****