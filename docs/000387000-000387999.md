# StackOverflow 问答 000387000-000387999

# msbuild - 是否可以知道 ReSharper 的测试运行器何时构建我的项目？

> ID：387006
> 
> 赞同：3
> 
> 时间：2008-12-22T18:43:01.660
> 
> 标签：msbuild, build-process, nunit, resharper

我正在尝试使用 MSBuild NUnit 社区任务来强制在每个构建上运行测试，但我现在看到，当我使用 ReSharper 的测试运行器并构建项目时，我运行了两次测试。它有效，但并不是真正可取的。

有谁知道我可以在 MSBuild 中检查的变量或条件，以便如果我知道测试运行程序无论如何都要执行测试，我可以跳过社区任务？

注意：我使用的是 VS2008，MSBuild 脚本与解决方案/项目文件集成在一起。我想要世界上最好的。 `CTRL`++ ，`SHIFT`加上`B`命令行，加上 CI 服务器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-22T16:52:31.117

[我在Resharper 社区论坛](http://www.jetbrains.net/devnet/message/5229453)上问了这个问题，虽然我没有直接回答是或否我的问题，但我将答案解释为否。如果有人想附和确认是或否，那会让我放心。

我决定可以通过创建一个名为的解决方案配置来解决我的问题，`DebugResharperTest`并在我想使用 Resharper 测试运行程序时选择该配置。该配置名称变量将阻止构建启动 NUnit msbuild 任务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T01:18:34.097

在 Visual Studio 中构建时，MSBuild 定义了一个额外的属性，可用于禁用 nUnit 任务。

```
<NUnit Condition="'$(BuildingInsideVisualStudio)' != 'true'"
    ...other props 
    /> 
```

# java - 是否有 CheckStyle 规则强制 if else 关键字位于 if/else 阶梯中的同一行？

> ID：387008
> 
> 赞同：2
> 
> 时间：2008-12-22T18:43:56.823
> 
> 标签：java, regex, coding-style, checkstyle

基于[这个问题](https://stackoverflow.com/questions/382633/can-the-checkstyle-module-needbraces-work-with-nested-ifelse-blocks)，CheckStyle 的默认模板似乎将允许 if else 梯子用换行符分隔`if`and 。`else`

这意味着我希望*将此*代码标记为违规：

```
if (true)
{
    System.out.println("20");   
}
else
    if (true)
    {
        System.out.println("30");
    } 
```

是否有 CheckStyle 规则来防止这种情况？查看文档，我没有看到一个，如果我不需要的话，我不想使用通用的正则表达式规则。

此外，如果我使用*GenericIllegalRegexp*模块，多行正则表达式似乎不起作用。有什么补救措施吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T22:13:28.287

我不确定您是否可以轻松编写 Checkstyle 扩展，因为[Checkstyle SDK Gui](http://checkstyle.sourceforge.net/writingchecks.html)的 AST 浏览代码在以下方面没有任何区别：

```
else if 
```

和

```
else
  if 
```

在每种情况下，`else`是一个`LITERAL_ELSE`在其中`if`...

所以通用正则表达式`else[ \t]*[\r\n]+[ \t]*if`确实是检测这种代码的一种快速方法。

* * *

修复正则表达式以包括案例：

*   在换行符之前/之后没有空格而不是制表符
*   这是多个换行符。

当然，您不想使用`\s`空格正则表达式，因为它本身包含换行符。将空格与返回字符分开会更清楚。

* * *

Note: in Checkstyle 5.0beta, do not use "Generic Illegal Regexp", but rather the **"[Regexp" module](http://checkstyle.sourceforge.net/config_misc.html#Regexp)**:
you can configure that RegExp module as 'illegalPattern' (with an associated Severity of 'Warning'), and you do not have to use any kind af 'multi-line' flag: the regexp is enough.

> **Regexp**
> Description
> 
> A check that makes sure that a specified pattern exists, exists less than a set number of times, or does not exist in the file.
> 
> This check combines all the functionality provided by RegexpHeader, GenericIllegalRegexp and RequiredRegexp, except supplying the regular expression from a file.
> 
> **It differs from them in that it works in multiline mode**. It's regular expression can span multiple lines and it checks this against the whole file at once. The others work in singleline mode. Their single or multiple regular expressions can only span one line. They check each of these against each line in the file in turn.

* * *

[Thomas](https://stackoverflow.com/users/1005481/thomas) mentions [in the comments](https://stackoverflow.com/questions/387008/is-there-a-checkstyle-rule-to-force-if-else-keywords-to-be-on-the-same-line-in-a/387528?noredirect=1#comment31182446_387528):

> The checkstyle AST does have line number information.

See "[Is there any Checkstyle/PMD/Findbugs rule to force “<code>else if” to be on the same line?](https://stackoverflow.com/a/20799612/6309)"
(in which one has to use a [custom check](http://checkstyle.sourceforge.net/writingchecks.html), and not a [regex match](http://checkstyle.sourceforge.net/config_misc.html#Regexp)).

# iphone - 你可以在 Xcode 中创建每个用户的项目设置吗？

> ID：387019
> 
> 赞同：5
> 
> 时间：2008-12-22T18:50:49.710
> 
> 标签：iphone, xcode, code-signing

我正在合作开发一个 iPhone 应用程序，并将项目文件（`.xcodeproj`目录）签入源代码管理。一项重要的设置是“代码签名身份”，它指定用于签署应用程序的证书，以便它可以在 iPhone 上运行。

项目中的每个开发人员都有自己的代码签名身份，因此每当有人对项目进行更改时，他的代码签名身份都会保存到项目设置中，然后其他所有人都会继承该更改。然后，他们必须将其更改为他们的 CSI，然后才能继续。

有没有办法将代码签名身份保存在一些未签入源代码控制的本地每用户项目文件中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T19:18:38.810

您可以将 Xcode 项目基于 .xcconfig 文件，然后让每个开发人员使用他们自己的 .xcconfig 文件并在其中保留身份设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T23:57:00.030

或者让你的源代码控制系统忽略包含签名的文件，在 git 中你可以创建一个名为 .gitignore 的文件，你正在使用的可能有类似的东西。这意味着即使您更改了它，更改也不会被镜像。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T20:40:21.737

我通过制作不同的版本来解决这个问题。名为“Dev - Rob”的有我的设置，而名为“Dev - [Other Guy's Name]”的有其他人的设置。

我们还使用它来构建“Release - Beta”和“Release - AppStore”等构建，适用于我们有不同签名配置的所有情况。

# c - 在 C 中确定符号来源的工具

> ID：387028
> 
> 赞同：0
> 
> 时间：2008-12-22T18:54:27.767
> 
> 标签：c, dependencies

我正在寻找一种工具，它会告诉您从给定的头文件中使用了哪些符号（类型、预编译器定义、函数等）。我正在做一个从 Solaris 到 Windows 的大型驱动程序的移植，并且弄清楚事情的来源变得越来越困难，所以这将是一个巨大的帮助。有任何想法吗？

编辑：不是绝对要求，但适用于 Windows 的工具将是一个加号。

编辑#2：为了澄清我正在尝试做的事情，我有一个我正在尝试移植的代码库，它带来了大量的标头。我想要的是一个工具，给定 foo.c，它会告诉我它使用 bar.h 中的哪些符号。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T19:01:11.530

我喜欢[KScope](http://kde-apps.org/content/show.php/KScope?content=9910)，它可以处理非常大的项目。

[KScope http://img110.imageshack.us/img110/4605/99101zd3.png](http://img110.imageshack.us/img110/4605/99101zd3.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T19:10:51.683

我在 Linux 和 Windows 上都使用： [gvim](http://www.vim.org/) + [ctags](http://ctags.sourceforge.net/) + [cscope](http://cscope.sourceforge.net/)。
同样的环境也可以在 solaris 上运行，但这当然会迫使你使用 vim 作为编辑器，我很确定[emacs](http://www.gnu.org/software/emacs/)也可以与 ctags 和 cscope 一起使用。
你可能想尝试一下vim，一开始有点难，但很快你就不能用另一种方式工作了。最高效的编辑器（恕我直言）。

**评论回放：**

查看[cscope 人](http://cscope.sourceforge.net/cscope_man_page.html)：

> ...
> 
> 查找此函数调用的函数：
> 查找调用此函数的函数：
> 
> ...

我认为这正是您要寻找的……如果不是，请澄清。

**评论重播2：**

好的，现在我明白你了。我建议的工具可以帮助您理解代码流，并找到定义了某些符号，但不是您要查找的。

不是您要的，但由于我们在谈论，我对移植和驱动程序有一些经验（请随意忽略）

编译器似乎足以胜任您的任务。您只是从原始文件开始并让编译器找到缺少的部分，这将是很多空存根，您将编译代码。

至少在开始时，我建议您创建大量存根并尽可能少地修改原始代码，稍后一旦您开始工作，您就可以优化。

根据您要移植的驱动程序类型（我假设内核驱动程序），它可能会更复杂，Windows 和 Solaris 子系统不太相似。我们确实有一个在 solaris 和 windows 上工作的驱动程序，但它从一开始就被设计为多平台。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T19:14:27.820

试试[doxygen](http://www.doxygen.nl/manual/config.html#cfg_include_graph)，它可以生成图形和/或 HTML 并且高度可定制

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T22:22:02.963

**`emacs`**和**`etags`**。

我利用 make 为我运行标签索引——这样我就可以用一个命令索引一个大型项目。我一直在考虑建立一个主索引和单独的模块索引，但还没有开始实施这个......

* * *

@Ilya ：黎明[时](http://stackoverflow.com/questions/387028/tool-to-determine-symbol-origin-in-c#387060)的手枪可以接受吗？

# stdout - 控制台输出格式

> ID：387070
> 
> 赞同：2
> 
> 时间：2008-12-22T19:15:06.883
> 
> 标签：stdout

为了可读性和一致性，是否有任何用于格式化命令行应用程序控制台输出的约定？例如，你是否缩进子信息，你什么时候打印一个空行，如果有的话，你应该如何强调重要的陈述。

我发现输出会迅速退化为混乱的模糊。我有兴趣了解其他人的做法。

**更新：**这确实是用于将调试状态吐出终端的嵌入式软件，但它很像控制台应用程序，我想每个人都会更熟悉它。感谢到目前为止。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T19:58:53.957

如果这是针对 *nix 环境的，那么我建议您阅读[Basics of Unix Philosophy](http://www.faqs.org/docs/artu/ch01s06.html)。它不是特定于输出的，但通常有一些关于命令行程序的良好指南。

> 期望每个程序的输出成为另一个未知程序的输入。不要用无关信息使输出混乱。避免严格的列式或二进制输入格式。不要坚持交互式输入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T19:19:53.753

我会区分两种程序：

您是否打印脚本*可能*使用的信息（即它应该是可解析的）？然后定义一个非常严格的格式并只使用它（例如固定字段分隔符）。

您是否打印不需要由脚本解析的信息（或者是否已经有替代的脚本可解析格式）？然后写自然的东西：

我的建议：

*   写出来让你想读
*   缩进子信息 2 或 4 个空格，绝对不会更多
*   最多用一个空行分隔信息块
*   尊重`COLUMN`环境变量（`ROWS`如果它适用于您的输出，则可能）。

# windows - How can a program have a high virtual byte count while the private bytes are relatively low on Windows 32-bit?

> ID：387075
> 
> 赞同：2
> 
> 时间：2008-12-22T19:16:57.333
> 
> 标签：windows, performance, memory, memory-management

I'm trying to get a better understanding of how Windows, 32-bit, calculates the virtual bytes for a program. I am under the impression that Virtual Bytes (VB) are the measure of how much of the user address space is being used, while the Private Bytes (PB) are the measure of actual committed and reserved memory on the system.

In particular, I have a server program I am monitoring which, when under heavy usage, will climb up to the 3GB limit for VBs. Around the same time the PB climb as well, but then quickly drop down to around 1 GB as the usage drops. The PB tend to then stay low, around the 1 GB mark, but the VB stay up around the 3 GB mark. I do not have access to the source code, so I am just using the basic Windows performance counters to monitor all of this. From a programming point of view, what memory concept do I not understand that makes this all possible? Is there a good reference to learn more about this?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T23:44:37.667

What your reporting is most likely being caused by the process heap. There are two pieces to a memory allocation in Windows. The first piece is the continuous address space in your application for the memory to accessed through. On a 32 bit system not running the /3GB switch all your allocations must come out of the lower 2 GB of user address space. The second piece of the memory allocation is the actually memory for the allocation. This can be either RAM or part of the page file system on the hard disk. The OS handles moving allocations between RAM and the page file system in the background.

Most likely your application is using a Windows heap to handle all memory allocations. When a heap is created is reserves 1 MB of address space for the memory it will allocate. Until it actually needs memory associated with this address space no physical memory is actually used. If the heap needs more memory than 1 MB it uses a doubling algorithm to reserve more address space, and then commits physical memory when it needs it. The important thing to note is that once a heap reserves address space it never releases it.

Personally I found the following books and chapters useful when trying to understand memory management.

Advanced Windows Debugging - Chapter 6 This book has the most detailed look into the heap I have seen.

Windows Internals - Chapter 7 This book adds a bit of information not found in Advanced Windows Debugging; however, it does not give as good an overview.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T19:39:24.713

It sounds to me like you have a garbage collector that's only kicking in once the memory pressure hits 1/3 (1 GB out of 3 GB).

As for the VB - don't worry! It's virtual! Honestly, nothing's been allocated, nothing's been committed. Focus on your private bytes - your real allocations.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T19:45:36.603

There is such a thing as "Virtual Memory". It's a rather non-OS-specific concept in computer science. Microsoft has also [written](http://msdn.microsoft.com/lv-lv/library/aa366912(en-us,VS.85).aspx) about Windows implementation of the thing.

A long story short, in Windows you can ask to reserve some memory without actually allocating any physical memory. It's like making some memory addresses reserved for future use. When you really need the memory, you allocate it physically (aka "commit" it).

I haven't needed to use this feature myself, so I don't know how it's used in real life programs, but I know it's there. I think the idea might be something like preserving pointers to some memory address and allocating the memory when needed, without having to change what the pointers actually point to.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T20:08:34.390

Windows is notorious for having a variety of types of memory allocations, some of which are supersets of others. You've mentioned Private Bytes and Virtual Bytes. Private bytes, as you know, refers to memory allocated specifically to your process. Virtual bytes includes private bytes, as well as any shared memory, reserved memory, etc.

Even though in real life you only need to be concerned with private bytes and perhaps shared memory (Windows handles the rest, anyways), the Virtual Bytes count is often what users (and evaluators of your software) see and interpret as the memory usage of your process.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T22:27:20.600

A good and up-to-date reference on the subject is the book titled Windows Via C/C++ by Jeffrey Richter, you should look for Chapter 13: "Windows Memory Architecture".

# linq - How can I use Linq with Dataset.xsd files?

> ID：387076
> 
> 赞同：0
> 
> 时间：2008-12-22T19:17:09.983
> 
> 标签：linq, xsd, linq-to-dataset, linq-to-xsd

How can I use Linq with Dataset.xsd files?

I've looked at Linq-to-Datasets and Linq-to-XSD but they don't really seem to work directly with the Visual Studio DataSet.xsd files.

**EDIT:** I actually found a great link for this: [link text](http://msdn.microsoft.com/en-us/vbasic/bb738035.aspx) but I can't seem to figure out what to do if I want to query on related tables.

```
 Dim taFields As New TestDSTableAdapters.FieldTableAdapter()
    Dim fields = taFields.GetData()

    Dim results = From f In fields Select f

    For Each field In results
        Response.Write(field.FieldID & " " & field.Label & " " & field.FieldTypeRow.FieldTypeLabel)
    Next 
```

I get an "Object reference not set to an instance of an object." error when running the above code because, I guess, field.FieldTypeRow.FieldTypeLabel isn't actually part of the query of data. Do I have to create a method that returns data from that data also? I'm assuming this would be the case (that taFields.GetData has to return all the FieldType data results too if I'm going to reference it - in Linq to SQL it does all this for me so it's a little disappointing)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T19:58:30.963

A DataSet is just a container for your data, so you need to fill it first. **LINQ to SQL** will create SQL and go to the database for you...but when you're working with DataSets, you're using **LINQ to Objects**, which won't create SQL. So you need to make sure that **all** tables you need in the DataSet are filled before you start writing LINQ to query your DataSet.

I think you're looking for something along these lines:

```
Dim taFields As New TestDSTableAdapters.FieldTableAdapter()
Dim taFieldTypes As New TestDSTableAdapters.FieldTypesTableAdapter()

Dim ds As New TestDS

taFields.Fill(ds.Fields)
taFieldTypes.Fill(ds.FieldTypes)

Dim results = From f In ds.Fields Select f

For Each field In results
    Response.Write( _
        field.FieldID & " " & field.Label & " " & 
            field.FieldTypeRow.FieldTypeLabel)
Next 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T20:03:42.620

```
 Dim taFields As New TestDSTableAdapters.FieldTableAdapter()
    Dim fields as TestDSTableAdapters.FieldsDataTable = taFields.GetData()

    Dim results = From f In fields Select f

    For Each field In results
        Response.Write(field.FieldID & " " & field.Label & " " & field.FieldTypeRow.FieldTypeLabel)
    Next 
```

You forgot to set the type for fields. That is why yo uwere getting object reference problems. You do not have to create a new blank dataset.

# email - 如何检查是否已使用 POP3/SMTP 读取电子邮件？

> ID：387078
> 
> 赞同：2
> 
> 时间：2008-12-22T19:17:21.140
> 
> 标签：email, smtp, pop3

如何检查是否已使用 POP3/SMTP 读取电子邮件？

我能够阅读电子邮件，但我无法确定电子邮件是否已被阅读。任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T19:21:22.363

没有完全可靠的方法可以做到这一点，虽然一些服务器支持读取回执，但它依赖于客户端来响应回执请求。

人们这样做的另一种方法是将跟踪图像嵌入到 HTML 电子邮件中，该电子邮件将从服务器中提取，并且命中构成读取，但这通常不准确，因为大多数电子邮件阅读器默认阻止 html 外部内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T19:38:26.743

在 statcounter.com 上注册一个免费帐户。转到安装代码选项，选择不可见的跟踪按钮和仅 HTML 计数器。Statcounter 现在将为您提供一个 HTML 图像片段，您必须将其插入 HTML 电子邮件的正文中。

该图像在电子邮件中不可见，但该人在打开其电子邮件客户端时必须单击“显示图像”。

如果您的服务器或客户端不支持已读回执，这是您可以做到的唯一方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T19:21:54.873

使用 POP3，电子邮件几乎总是在阅读后从服务器中删除。当客户端连接到 POP3 服务器时，服务器通常会将电子邮件传输到客户端，然后将电子邮件从自己的存储中删除。因此，如果您可以阅读电子邮件，则很可能它尚未被阅读。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T19:22:49.303

据我所知，这是关于 POP3 的客户端唯一细节。如果您想让状态反映在多个客户端上，您需要使用 IMAP。使用网络邮件阅读器，它们会跟踪唯一的邮件 ID 以及它是否已在客户端上阅读，但如果您将其加载到桌面 pop3 客户端上，它不会被标记为已读。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-28T10:19:57.020

将最新阅读的电子邮件的消息 ID 存储在某处并检查您何时运行弹出

# asp.net - 64 位 Windows 上的 Asp.Net 开发人员是否可以与拥有 32 位的团队合作？

> ID：387080
> 
> 赞同：2
> 
> 时间：2008-12-22T19:18:22.040
> 
> 标签：asp.net, 64-bit

是否有任何兼容性问题会阻止它工作？为该团队处理项目时，我是否需要使用 32 位 VM？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T19:19:17.890

不，应该工作得很好。

在这里阅读一点：http: [//msdn.microsoft.com/en-us/library/ms973190.aspx](http://msdn.microsoft.com/en-us/library/ms973190.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T19:37:53.470

我运行 Vista 64 而我团队的其他成员运行 XP 32 位，到目前为止，我们遇到的唯一问题是第三方 COM 组件在 64 位机器上不容易生成互操作程序集。一旦它生成，它就搞砸了其他机器。通过在 32 位机器上生成互操作程序集并将其检查到源代码控制中来解决这个问题。

我在最新的 .Net-rocks 播客中听说在构建配置中设置 x86 而不是“任何 CPU”应该可以解决很多问题，但是由于除了我描述的问题之外我没有遇到任何问题，所以我还没有尝试过那。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T03:02:02.910

无论**您的**环境是什么，都可以在您希望的任何机器上进行开发。我会担心 QA、登台和生产环境。如果它们都是 32 位的，我想要一个 32 位的 VM 来测试我的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T03:02:26.980

我不确定在不同的 Windows 32/64 位环境中与其他开发人员合作，但我可以谈论在 Windows 2008 64 位服务器上部署在 Windows XP 32 位中开发的 .NET 应用程序。

我遇到的唯一问题是依赖于第 3 方程序集的应用程序。我们只有一个 32 位版本的程序集。因此，为了在 64 位环境中运行我们的应用程序，我必须为 x86 编译我的项目（如您所述）。它解决了一切。

我能够在不改变任何东西的情况下运行的所有其他应用程序（它们是在“任何 CPU”模式下编译的。

我怀疑除非你有一些外部程序集，否则你不会有问题。如果是这种情况，那么您将不得不重新编译它们或简单地强制您的项目编译为 x86。

我知道这并不能肯定地回答你的问题，但希望它会有所帮助。

安德鲁

# crystal-reports - 水晶报表11：如何调试水晶报表？

> ID：387086
> 
> 赞同：5
> 
> 时间：2008-12-22T19:20:50.740
> 
> 标签：crystal-reports

当我创建水晶报表并将字段和字段添加到数据库时，报表会为我正在创建的发票输出一个完全空白的报表。如何调试水晶报表？

您是否设置了要输出的标记或标志？某处是否有错误日志描述报告的哪个字段与 etcs 有问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T21:15:59.053

您的“无记录”空报告可能是由于每次修改报告所需的表和视图列表时 CR 会添加的表之间的一些意外“默认”链接。有这个“智能链接”选项甚至可以自动创建一些递归链接。在关系屏幕中查看这些时要小心，因为它们可能无法“立即”查看。导致“空”报告的另一种情况是当表使用内连接而不是外连接链接时，或者当外连接应该在左右之间切换时。

如果您找不到导致报告为空的关系（有时不是很明显），我建议您通过添加/删除表格或修改链接来进行一些试错测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T23:45:45.323

如果报告存在问题，您应该会收到错误消息。我猜在连接或显示公式中有一些逻辑使报告空白。你能验证数据源是否正确吗？

如果您处理 CrystalReportViewer 错误事件（您使用的是 .net 吗？），您可以捕获更多错误。我对 VS 内置设计器没有太多经验。我使用 CR XIr2 独立设计器，这使得构建报告变得更加容易。

# java - Java 泛型 - 难以执行强类型检查

> ID：387091
> 
> 赞同：1
> 
> 时间：2008-12-22T19:22:18.070
> 
> 标签：java, generics, strong-typing

这是我的代码：

```
public class Sequence<T> {

    protected List<T> sequence = new ArrayList<T>();

    public Matrix<OrderedPair<T, ?>> createCartesianProduct(Sequence<?> secondSequence) {
        Matrix<OrderedPair<T, ?>> result = new Matrix<OrderedPair<T, ?>>();
        for (int rowIndex = 0; rowIndex < sequence.size(); rowIndex++) {
            Sequence<OrderedPair<T, ?>> row = new Sequence<OrderedPair<T, ?>>();
            for (int columnIndex = 0; columnIndex < secondSequence.length(); columnIndex++) {
                row.add(new OrderedPair(sequence.get(rowIndex), secondSequence.sequence.get(columnIndex)));
            }
        }
        return result;
    }
} 
```

这在 Eclipse 中编译，但在内部 for 循环（ row.add(...) ）内的行上，我收到以下三个警告：

*   `OrderedPair`是原始类型。对泛型类型的引用`OrderedPair()<T1, T2>`应该被参数化。
*   类型安全：OrderedPair 类型的表达式需要未经检查的转换才能符合`OrderedPair<T, ?>`
*   类型安全：构造函数 OrderedPair(Object, Object) 属于原始类型 OrderedPair。对泛型 OrderedPair 的引用`<T1, T2>`应该被参数化

我想在这里使用泛型来强制执行强类型检查，但我想我对泛型的理解不足以让我看到如何。有人可以教育我吗？

谢谢，

——肯

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-22T19:44:02.333

内部 for 循环中的构造函数应该具有泛型：

```
row.add(new OrderedPair **<T, ?>** (sequence.get(rowIndex), secondSequence.sequence.get(columnIndex))); 
```

但是你不能这样使用`?`；所以你需要`?`用一个字母替换所有的 s，比如说`E`。然后`<E>`在签名中添加一个，如下所示：

```
public **<E>** Matrix<OrderedPair<T, E>> createCartesianProduct(Sequence<E> secondSequence) { 
```

否则，编译器将不知道`E`来自哪里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T20:28:48.670

我认为你在这里有点困惑。在类型`Sequence<T>`中会是`T`什么？

如果你定义 a`Sequence<OrderedPair<T, ?>>`那么你最终会在 T 上递归。

请看看你真正需要的是这样的东西：

```
public class Sequence<T> {

    protected List<T> sequence = new ArrayList<T>();

    public <T2> Matrix<OrderedPair<T, T2>> createCartesianProduct(Sequence<T2> secondSequence) {
        Matrix<OrderedPair<T, T2>> result = new Matrix<OrderedPair<T, T2>>();
        for (int rowIndex = 0; rowIndex < sequence.size(); rowIndex++) {
                Sequence<T> row = new Sequence<T>();
                for (int columnIndex = 0; columnIndex < secondSequence.length(); columnIndex++) {
                        row.add(new OrderedPair<T, T2>(sequence.get(rowIndex), secondSequence.sequence.get(columnIndex)));
                }
        }
        return result;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T20:04:13.960

OrderedPair 没有被泛化，但它被添加到一个被泛化的列表（序列）中。您必须使用泛型构造 OrderedPair，例如执行“new OrderedPair<...>(...)”，以消除此警告。

这里我为整个方法添加了泛型，因此返回类型与 secondSequence 的类型相匹配：

```
public <Z> Matrix<OrderedPair<T, Z>> createCartesianProduct(Sequence<Z> secondSequence) {
    Matrix<OrderedPair<T, Z>> result = new Matrix<OrderedPair<T, Z>>();
    for (int rowIndex = 0; rowIndex < sequence.size(); rowIndex++) {
        Sequence<OrderedPair<T, Z>> row = new Sequence<OrderedPair<T, Z>>();
        for (int columnIndex = 0; columnIndex < secondSequence.length(); columnIndex++) {
            addToRow(row, sequence.get(rowIndex), secondSequence.sequence.get(columnIndex));
        }
    }
    return result;
}

static <T, Z> void addToRow(Sequence<OrderedPair<T, Z>> seq, T t, Z z) {
    seq.add(new OrderedPair<T, Z>(t, z));
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T19:29:53.920

信任编译器并在调用 OrderedPair 时始终尝试使用泛型参数 :) 这**不是必需**的，但我认为这是一个好习惯。

由于这个原因，在 Java 中严格的泛型应用是不可能的：

[类型擦除](http://en.wikipedia.org/wiki/Generics_in_Java#Type_erasure)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T19:43:26.483

您需要做的就是向构造函数添加一个泛型类型，如下所示：

```
row.add(new OrderedPair<T, ?>(sequence.get(rowIndex), secondSequence.sequence.get(columnIndex))); 
```

编译器抛出错误，因为在您传递它们时`OrderedPair`期望接收类型而没有任何显式类型。编译器正在谈论的是，因为基本上你是在它想要的时候给构造函数`<T, ?>`，因此正在进行未经检查的转换，如果错误的类型意外传递，它可能会引发异常。`unchecked conversion``<?, ?>``<T, ?>`

# c++ - 手工编码 GUI 与 Qt 设计器 GUI

> ID：387092
> 
> 赞同：116
> 
> 时间：2008-12-22T19:22:42.953
> 
> 标签：c++, qt, user-interface, rad, qt-designer

我正在利用这些假期学习编写 Qt 应用程序。几个小时前，我正在阅读有关 Qt Designer 的文章，这让我想知道：在 Qt 中编写现实世界应用程序的人使用什么来设计他们的 GUI？事实上，人们一般是如何设计 GUI 的？

一方面，我发现手工编写代码在概念上比使用 Qt 设计器更简单，尽管对于复杂的 GUI 设计器可能有意义。使用 Designer 可能会使用大型 GUI，但随着时间的推移，随着复杂性的增加，它们可能会变得非常难以管理（这只是我的看法）。我还下载了 AmaroK 源代码来看看这些人在做什么，并发现许多对 addWidget() 和朋友的调用，但没有一个由 Designer 创建的 XML 文件（除此之外：AmaroK 必须是我最喜欢的应用程序）任何平台）。

那么，创建 GUI 的“正确”方法是什么？设计师还是代码？对于本次讨论，让我们考虑以下类型的 GUI：

1.  只需要输入、显示一些结果并退出的简单对话框。让我们假设一个应用程序获取一个 YouTube URL 并将视频下载到用户的硬盘。新手可能会开始使用的那种应用程序。
2.  中级 GUI，例如带有一些工具栏/菜单项的便签编辑器。我们以 xPad 为例（[http://getxpad.com/](http://getxpad.com/)）。我想说大多数应用程序都属于“实用程序”类别。
3.  非常复杂的 GUI，例如 AmaroK 或 OpenOffice。当你看到他们时你就知道他们，因为他们让你的眼睛流血。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-24T04:40:34.917

我们对 Designer 的体验始于 Qt3。

**Qt3**

那时，Designer 主要用于生成代码，然后将其编译到应用程序中。我们开始为此目的使用所有生成的代码，一旦您编辑它，您就不能再返回并重新生成它而不会丢失您的编辑。我们最终只使用生成的代码并从今以后手工完成所有事情。

**Qt4**

Qt4 对 Designer 进行了显着改进。它不再只生成代码，而是您可以动态加载您的 Designer 文件（在 xml 中）[并将它们动态连接到程序中正在运行的对象](https://doc.qt.io/qt-5.7/qtuitools-index.html)- 但是没有生成代码，您必须在 Designer 中命名项目并粘贴名称不会破坏您的代码。

我的评估是它远不如 Mac OS X 上的 Interface Builder 有用，但在这一点上，我可以看到直接在程序中使用 Designer 文件。

自 Qt3 以来，我们还没有回到 Designer，但仍然使用它来制作原型和调试布局。

对于您的问题：

1.  使用 Qt 提供的标准对话框，您可能会侥幸逃脱。 [QInputDialog](https://doc.qt.io/qt-5.7/qinputdialog.html)或者如果您将 QDialog 子类化，请确保使用[QButtonDialogBox](https://doc.qt.io/qt-5.7/qdialogbuttonbox.html) 以确保您的按钮具有正确的平台布局。

2.  您可能会做一些更有限的事情，比如带有有限 Designer 功能的 xPad。

3.  我不认为您可以仅使用 Designer 编写类似 OpenOffice 的东西，但也许这不是重点。

我会使用 Designer 作为另一种工具，就像您的文本编辑器一样。找到限制后，请尝试使用其他工具来解决该新问题。我完全同意 Steve S 的观点，即 Designer 的一个优势是非程序员的其他人也可以进行布局。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-12-22T19:39:24.183

根据我使用 Qt Designer 和其他工具包/UI 工具的经验：

*   UI 工具加快了工作速度。
*   UI 工具使以后更容易调整布局。
*   UI 工具使非程序员更容易/可能进行 UI 设计。

复杂性通常可以在 UI 工具中通过将设计分解为多个 UI 文件来处理。在每个文件中包含小的逻辑组件组，并将每个组视为用于构建完整 UI 的单个小部件。Qt Designer 的提升小部件概念可以对此有所帮助。

我还没有发现项目的规模有什么不同。您的体验可能会有所不同。

使用 UI 工具创建的文件（如果你真的想的话，我想你可以手动编写它们）通常可以在运行时动态加载（Qt 和 GTK+ 都提供此功能）。这意味着您可以更改布局并对其进行测试，而无需重新编译。

最终，我认为原始代码和 UI 工具都是有效的。它可能很大程度上取决于环境、工具包/UI 工具，当然还有个人喜好。我喜欢 UI 工具，因为它们能让我快速启动和运行，并允许以后轻松更改。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-22T20:22:32.333

我工作的组织在几年前将其 GUI 应用程序移植到了 Qt。我认为有几个方面值得一提：

*   至少在那时，使用 Qt Designer 并不是一个现实的选择：有太多的功能无法使用 Qt Designer 完成；
*   必须保留的约定和结构阻止了 Qt Designer 的使用；
*   一旦您在没有 Designer 的情况下开始使用，可能很难再使用它；
*   不过，最重要的方面是程序员非常习惯于使用 vi 或 emacs 进行编程，而不是使用 GUI IDE。

我自己的经验，可以追溯到大约。4年，使用Qt3.3，是在Designer中无法实现对话框中的动态行为。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-05T11:32:26.847

只是说我在没有使用 Qt Designer 的情况下在 Qt 中编写和维护了复杂的 GUI——不是因为我不喜欢 Qt Designer，而是因为我从来没有用那种方式工作。

这部分是风格问题和你来自哪里：当我开始使用 Qt 时，我在 Dreamweaver 和 Frontpage 以及其他可视化 HTML 工具方面有过可怕的经历，并且更喜欢使用 HomeSite 编写代码并诉诸 Photoshop 进行复杂的布局问题。

可视化代码 IDE 存在危险，您尝试将其保留在可视化工具中，但最终也不得不调整代码 - 以人们不太了解的方式。

例如，学习 iPhone 开发时，我发现点击“魔术”视觉内容（“从 Connections 检查器中的空圆圈拖动到 Interface Builder 窗口中的对象......”）会更简单（对于我）用简单的旧代码来理解。

Qt 祝你好运——它是一个很棒的工具包，无论你如何使用它，Qt Creator 看起来都是一个很棒的 IDE。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-16T05:01:27.807

我要补充一点，例如，使用图形设计器的原因之一是 Win32 中缺少布局管理器。只有绝对定位是可能的，而手动这样做会很糟糕。

自从我从 Delphi 切换到 Java 的 GUI 应用程序（早在 2002 年）之后，我就再也没有使用过设计器了。我更喜欢布局管理器。是的，你得到了样板代码，但在 UI 设计器上移动对象可能需要与更改样板代码一样多的时间。另外，我会被一个缓慢的 IDE 困住；这适用于 Java/C# 案例，好的，而对于 Qt（尤其是 Qt4）则不适用。对于 Qt3，我想知道为什么要编辑生成的代码——难道不能在其他文件中添加代码吗？出于什么原因？

关于讨论的案例： 1）手工编码的 GUI 可能会更快地编写，至少如果您知道您的库的话。如果您是新手并且不了解他们，您可能会节省时间并减少与设计师一起学习的内容，因为您不需要学习您使用的 API。但是“少学”是关键因素，所以在这两种情况下我都会说手工编码的 GUI。

2）菜单栏写代码很烦人。另外，请考虑加速器等细节。不过，这取决于您的习惯。一段时间后，输入样板文件可能比点击进入设计器来修复所有这些属性要快，但前提是你真的可以像打字机一样输入（比如那些输入 Unix 命令比输入更快的管理员）使用任何 GUI）。

3) 我会将案例#2 的答案扩展到这个案例。请注意，对于 Win32 平台，使用生成 Win32 资源的设计器*可能会*更快地加载（不知道这一点）。

但是，我想提一下在那里使用 Qt Designer 的一个潜在问题。真实案例：加载一个带有很多选项的复杂 Java 对话框（程序员文本编辑器的首选项对话框）需要几秒钟（比如 10 秒）。正确的解决方法是仅在程序员想要查看它们时才加载每个选项卡（我后来意识到），通过向每个首选项集添加一个单独的方法来构建它的 GUI。

如果您与设计师一起设计所有选项卡和选项卡切换器，您可以轻松做到吗？我想可能有一个类似的例子，其中手动编码的 GUI 为您提供了更大的灵活性，并且在如此大的应用程序中，您可能需要它，即使只是为了优化目的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-02-24T08:23:41.023

使用设计器创建 GUI 的主要好处之一是其他程序员可以轻松更改或维护表单和小部件，而无需深入研究复杂的代码。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-22T19:58:37.623

奇怪的是，您说编写代码比在图形环境中操作对象更简单。这是不费吹灰之力的。
设计师的存在是为了让您的生活更轻松，从长远来看，它使您的代码更易于维护。在设计器中查看 UI 的外观会更容易，然后阅读代码并尝试想象它可能会是什么样子。
使用当前的 Qt，您几乎可以在设计器中做所有事情，而您不能做的事情很少，您可以在构造函数中用很少的代码行来修复。举个最简单的例子——添加一个信号槽连接。使用设计器就像双击一样简单。如果没有设计器，您需要查找信号的正确签名，编辑 .h 文件，然后在 .cpp 文件中编辑编写代码。设计器允许您超越这些细节并专注于真正重要的事情 - 您的应用程序的功能。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-23T01:09:35.593

我喜欢先求助于设计师来开发 GUI 小部件。正如其他帖子中提到的，它更快。您还可以立即获得反馈，看看它是否“看起来正确”并且不会让用户感到困惑。设计师是我选择 Qt 而不是其他工具包的主要原因。我主要使用设计器来制作一次性对话框。

话虽如此，我还是手动完成了主窗口和任何复杂的小部件。我认为这就是奇趣科技的意图。 [QFormLayout](http://doc.trolltech.com/4.4/qformlayout.html)是他们提供的一个类，可以轻松地以编程方式创建输入对话框。

顺便说一句，Qt 4 中的设计器与 Qt 3 中的设计器不同。它只是一个用于编辑 .ui 文件的编辑器。我喜欢这样。新的跨平台 IDE 将被称为 Qt Creator。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-05-09T10:20:57.627

这是一篇旧文章，但我建议您查看 Clementine - 一种（我认为）源自 Amarok 的音乐播放器。他们使用 Qt4，据我所知，项目的*src文件夹中有一个**ui*文件夹。在*ui*文件夹中，正如人们所期望的那样，它们有各种各样的 .ui 文件。如果您编译并启动 Clementine，您会发现 GUI 相当复杂且非常漂亮。

 *** * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-06-03T13:25:51.667

对我来说，这取决于在小部件/GUI 中封装了多少**逻辑。**如果只是简单的表单，我更喜欢使用 QtDesigner。

如果它包含复杂的检查或交互，我倾向于对其进行编程。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-10-19T06:02:59.037

如果有人需要创建 Gui，我们将使用 Qt Designer。
问题是为某些任务创建小部件（就像你在类设计中所做的那样），然后将它们组合成一个“父 gui”。

这样，您的小部件具有高度可重用性，并且可以以模块化方式用于 Guis。您只需指定每个 Widget 发送哪些信号以及它们提供哪些插槽。

我们还创建了 .ui 文件，这些文件可以在构建过程中生成。到目前为止，无需手动编辑这些文件。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-02-26T19:52:11.873

使用 QtDesigner 在不同的 .ui 文件中构建 UI 的不同部分，
然后在代码中将它们组合在一起（并添加复杂性）。

有些事情你不能在 Qt Designer 中做，你只能在代码中做，
所以 Qt Designer 只是*工具链*的一个（伟大的）部分。

# visual-studio-2008 - 将非 GAC 引用添加到项目

> ID：387093
> 
> 赞同：2
> 
> 时间：2008-12-22T19:22:48.193
> 
> 标签：visual-studio-2008, reference

每次我在我的 GAC 中的 Visual Studio 2008 中添加对 Web 项目的引用时，它都会将该引用添加为 GAC 引用，并且不会将文件复制到我的 bin 目录中。但出于部署目的，我想将引用添加为非 GAC 引用，以便将 dll 添加到我的 bin 目录中。我尝试使用浏览按钮选择引用而不是从列表窗口中选择，但这也添加了 GAC 引用。

这些引用都带有 .refresh 文件，并且在文件的属性中没有复制本地的选项。

请问有什么帮助吗？！？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T19:25:20.887

右键单击引用，选择属性，将 Copy Local 从 False 翻转为 True

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-02T16:08:08.740

克里斯，你可能早就解决了这个问题，但我在 VS 2005 中尝试做同样的事情时偶然发现了你的问题。万一其他人来这里寻找解决方案....

当然，您是正确的，Web 项目不会像普通项目那样在您的引用上为您提供复制本地选项，因此 Copy Local... 解决方案是非首发。

我通过简单地将现有文件添加到我的 Web 应用程序的 bin 目录来解决这个问题。缺点是它不添加刷新引用，所以如果你重建外部文件，你将不得不手动刷新本地副本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T19:25:32.340

将其设置为复制本地

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-09T22:38:46.400

就像其他人提到的那样，你可能早就解决了这个问题，但我想我会把我的解决方案混在一起。

我的问题有点不同。我想要一个非 GAC 版本的 .dll，这样我的构建服务器就可以编译项目，而无需在该服务器上安装有问题的 .dll。

为了解决这个问题，我手动编辑了 .csproj (.vbproj) 文件（使用记事本）并更新了参考文件以指向本地版本。如果这在将来证明很麻烦，我将不得不卸载该项目并只使用 .dll。

就我而言，我改变了这一行：

```
<Reference Include="Microsoft.Data.Entity.CTP, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, processorArchitecture=MSIL" /> 
```

成为：

```
<Reference Include="Microsoft.Data.Entity.CTP, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, processorArchitecture=MSIL">
  <SpecificVersion>False</SpecificVersion>
  <HintPath>..\Lib\Microsoft.Data.Entity.CTP.dll</HintPath>
</Reference> 
```

where`..\Lib`是解决方案级别的目录，是项目文件的上一级目录。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-05T13:21:57.903

**1)**从您的项目中删除 GAC 引用

**2)**关闭 Visual Studio

**3)** gacutil /uf [YourDllName] (gacutil.exe 应该在 "C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\Bin" 中找到)

**4）**重新打开VS并在“浏览”选项卡中添加引用，您将把dll复制到您的bin文件夹和一个.refresh文件（不再依赖GAC）+++

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-09T22:35:03.390

另一种方法是手动创建 XXX.dll.refresh 文件夹并将它们添加到您的 bin 目录中。

我实际上创建了一个小助手项目来添加我的解决方案\Dependencies 文件夹中的所有文件。对 VB.NET 感到抱歉，但它很快并且似乎与 VS 做的一样。

```
 For Each fullFileName In Directory.GetFiles("..\..\..\Dependencies\", "*.DLL")
        Dim shortFileName = Path.GetFileName(fullFileName)
        Dim refreshFileName = shortFileName + ".refresh"

        Dim contents = "..\Dependencies\" + shortFileName

        File.WriteAllText(refreshFileName, contents)
    Next 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T20:16:22.300

如果您引用 .NET Framework 标准程序集，那么据我所知，您无法拥有它的本地副本。唯一的方法是在目标计算机上安装框架。

如果它是第三方程序集，那么您可以将程序集从它所在的目录手动复制到 bin 目录。

您也可以尝试通过 Windows SDK 中的 gacutil.exe 从 GAC 中删除程序集，看看现在如果您尝试通过“浏览”选项卡添加引用会发生什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-20T09:13:04.043

我花了几个小时试图解决这个问题，并遇到一个帖子说要以管理员身份打开 Visual Studio。它解决了这个问题。所有引用的 dll 都添加到 bin 文件夹中。

# ruby-on-rails - 使用 rspec-rails 在所有视图规范上存根模板方法的正确方法是什么？

> ID：387102
> 
> 赞同：3
> 
> 时间：2008-12-22T19:27:14.020
> 
> 标签：ruby-on-rails, rspec

我有许多视图规范需要对某些方法进行存根。这是我认为可行的方法（在 spec_helper.rb 中）：

```
Spec::Runner.configure do |config|
  config.before(:each, :type => :views) do
      template.stub!(:request_forgery_protection_token)
      template.stub!(:form_authenticity_token)
  end
end 
```

但是当我运行任何视图规范时，它会失败

`You have a nil object when you didn't expect it!` `The error occurred while evaluating nil.template`

在每个示例的 before(:each) 块中执行完全相同的操作效果很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T22:23:04.883

我尝试了您的示例，发现与视图规范文件中的“之前”块相比，在“config.before”块中，RSpec 视图示例对象尚未完全初始化。因此，在“config.before”块中，“模板”方法返回 nil，因为模板尚未初始化。您可以通过在这两个块中包含例如“puts self.inspect”来查看它。

在您的情况下，实现 DRYer 规范的一种解决方法是在 spec_helper.rb 中定义

**规格 2**

```
module StubForgeryProtection
  def stub_forgery_protection
    view.stub(:request_forgery_protection_token)
    view.stub(:form_authenticity_token)
  end
end

RSpec.configure do |config|
  config.include StubForgeryProtection
end 
```

**规格 1**

```
module StubForgeryProtection
  def stub_forgery_protection
    template.stub!(:request_forgery_protection_token)
    template.stub!(:form_authenticity_token)
  end
end

Spec::Runner.configure do |config|
  config.before(:each, :type => :views) do
    extend StubForgeryProtection
  end
end 
```

然后在要使用此存根的每个 before(:each) 块中包括

```
before(:each) do
  # ...
  stub_forgery_protection
  # ...
end 
```

# c - C 对称流密码

> ID：387104
> 
> 赞同：6
> 
> 时间：2008-12-22T19:27:58.527
> 
> 标签：c, encryption, stream-cipher

有没有人有一个用纯可移植 C 语言编写的流密码的良好实现？目前我并不十分关心密码的强度，因为它仅用于概念验证，但速度很重要。如果我找不到像样的流密码，我考虑过只用一个常数进行 Xor'ing。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T20:25:27.803

编辑（2018 年）：如果您正在寻找更小的代码占用空间，请使用[NaCl](https://nacl.cr.yp.to/)或[libsodium](https://www.libsodium.org/)或[TweetNaCl 。](https://tweetnacl.cr.yp.to/index.html)它们提供强大的加密，应该比 RC4 快得多。

[RC4](http://en.wikipedia.org/wiki/RC4)是一种实现起来非常简单的算法。

查看[Sterling Camden 的实施](http://www.chipstips.com/?p=177)或[Adam Back 的实施](http://www.cypherspace.org/adam/rsa/rc4.c)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T22:55:19.577

请参阅[ECRYPT eStream](http://www.ecrypt.eu.org/stream/index.html)项目。这些是由安全专家判断的严肃的核心密码算法。据我所知，所有候选算法都需要在纯 C（不是 C++）中包含实现。

编辑：该网站的优点在于它深入探讨了不同的算法，包括它们已知的弱点，并且还包括[性能基准](http://www.ecrypt.eu.org/stream/sw.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T19:44:49.710

对于纯 POC 应用程序，您可以快速将 ROT13 投入使用。 [http://en.wikipedia.org/wiki/ROT13](http://en.wikipedia.org/wiki/ROT13)

但是，我在提出这个建议时非常犹豫，因为过于频繁地打算稍后替换的简单 POC 代码永远不会......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T19:41:53.147

我让[河豚](http://www.schneier.com/blowfish.html)顺利进行。它声称比 DES 更快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T20:27:11.263

这是 C 中流密码的一个非常基本的实现。无论如何，它**不是**安全的。它只是说明了如何执行所需的基本步骤。

真正的魔法需要在`CycleKey`函数中完成，它会在每个数据块通过加密流时生成新的密钥值。

此示例一次加密一个`char`。您必须将该概念扩展到更大的数据块，以使加密接近安全。再一次，我这样做只是为了说明基本步骤。

祝项目顺利！

```
#include <stdio.h>

char staticKey;

void CycleKey(char data)
{
    /* this is where the real magic should occur */
    /* this code does *not* do a good job of it. */

    staticKey += data;

    if (staticKey & 0x80)
    {
        staticKey ^= 0xD8;
    }
    else
    {
        staticKey += 0x8B;
    }
}

void ResetCipher(const char * key)
{
    staticKey = 0;

    while (*key)
    {
        CycleKey(*key);
        key++;
    }
}

void Encrypt(const char * plaintext, char * encrypted)
{
    while (*plaintext)
    {
        *encrypted = *plaintext + staticKey;

        CycleKey(*encrypted);

        encrypted++;
        plaintext++;
    }

    *encrypted = '\0';
}

void Decrypt(char * plaintext, const char * encrypted)
{
    while (*encrypted)
    {
        *plaintext = *encrypted - staticKey;

        CycleKey(*encrypted);

        plaintext++;
        encrypted++;
    }

    *plaintext = '\0';
}

int main(void)
{
    char * key = "123";
    char * message = "Hello, World!";
    char encrypted[20];
    char decrypted[20];

    ResetCipher(key);
    Encrypt(message, encrypted);

    ResetCipher(key);
    Decrypt(decrypted, encrypted);

    printf("output: %s\n", decrypted);

    return 0;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T19:34:44.130

你看过 OpenSSL 吗？它具有许多加密算法和原语的安全实现。您不必将它与任何与网络相关的东西一起使用。但是，它并没有很好的文档记录或易于学习。如果您非常关心安全性（例如，如果您要存储私人用户数据，例如信用卡），则绝对应该使用 OpenSSL 或其他一些安全实现，而不是自己滚动。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-09-16T12:38:22.943

您可以参考以下代码以了解目的。该代码使用伪随机数生成器来生成密钥，并且完全用 C 语言编写。

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/* Function declarations */
int getSize(char *array);
int hashCode(const char *str, int size);
void convertIntToBinaryArray(int num, int *arr, int *index);
void encryptStreamCipher(int key[], int data[], int encypted_data[],int data_size);
void decryptStreamCipher(int key[], int enc_data[], int data_size);
void convertCharToBinary(char c,int *binary_arr,int *index);
void convertStringToBinary(char *str,int *binary_arr, int *size);
void convertBinaryToString(int *data,char *array_string,int *index);
char convertBinaryToChar(char *str);
void displayIntArray(int *array, int size);
void displayCharArray(char *array, int size);
#define MAX_SIZE 10000

int main(int argc, char **argv) {
    char array_string[MAX_SIZE];
    char ascii_key[MAX_SIZE];
    int data[MAX_SIZE];
    int key[MAX_SIZE];
    int encypted_data[MAX_SIZE];
    int seed;
    int key_int;
    int key_size = 0;
    int index;
    int data_size = 0;
    /* 1\. Enter the data to encrypt (Do not use space in between)*/
    fprintf(stdout, "Enter data to encrypt: \n");
    fscanf(stdin, "%s", array_string);

    /* 2\. Convert the string to binary data */
    convertStringToBinary(array_string,data,&data_size);
    printf("Data in binary: \n");
    displayIntArray(data,data_size);

    /* 3\. Read the key string from user */
    fprintf(stdout, "Enter key to encrypt data with: \n");
    fscanf(stdin, "%s", ascii_key);

    /* 4.Get hash code from the key */
    key_size = getSize(ascii_key);
    seed = hashCode(ascii_key, key_size);

    /* 5\. Set the key as seed to random number generator to create a key of random bits */
    srand(seed);
    key_int = rand();

    /* 6\. Convert key to binary int array */
    convertIntToBinaryArray(key_int, key, &index);
    printf("Key in binary: \n");
    displayIntArray(key,index);

    /* 7\. Encrypt : (Binary data) XOR (Binary key) */
    encryptStreamCipher(key, data, encypted_data, data_size);

    /* 8\. Display encrypted data */
    printf("encrypted Data: \n");
    displayIntArray(encypted_data,data_size);

    /* 9.Now, Decrypt data and verify initial data */
    decryptStreamCipher(key, encypted_data, data_size);
    printf("Decrypted binary data: \n");
    displayIntArray(encypted_data,data_size);

    /* 10\. Convert decrypted data in binary to string */
    memset(array_string,0,sizeof(array_string));
    convertBinaryToString(encypted_data,array_string,&data_size);

    /* 11.Display the original message in string */
    printf("Decrypted Data in String: \n");
    displayCharArray(array_string,data_size);

    return 0;
}

int getSize(char *array) {
    int size = 0;
    int i = 0;
    while ((i != MAX_SIZE) && (array[i] != '\0')) {
        i++;
        size++;
    }
    return size;
}

int hashCode(const char *str, int size) {
    int hash = 0;
    for (int i = 0; i < size; i++) {
        hash = 31 * hash + str[i];
    }
    return hash;
}

void convertIntToBinaryArray(int num, int *arr, int *index) {
    if (num == 0 || *index >= MAX_SIZE)
        return;
    convertIntToBinaryArray(num / 2, arr, index);
    if (num % 2 == 0)
        arr[(*index)++] = 0;
    else
        arr[(*index)++] = 1;

}

void encryptStreamCipher(int key[], int data[], int encypted_data[],
        int data_size) {
    for (int i = 0; i < data_size; i++) {
        encypted_data[i] = data[i] ^ key[i];
    }
}

void decryptStreamCipher(int key[], int enc_data[], int data_size) {
    for (int i = 0; i < data_size; i++) {
        enc_data[i] = enc_data[i] ^ key[i];
    }
}

void convertStringToBinary(char *str,int *binary_arr,int *index) {
    *index=0;
    for (int i = 0; i<strlen(str); i++) {
        convertCharToBinary(str[i],binary_arr,index);
    }
}

void convertCharToBinary(char c,int *binary_arr,int *index) {
    for (int i = 7; i >= 0; --i) {
        binary_arr[*index]=((c & (1 << i)) ? 1 : 0);
        (*index)++;
    }
}

void convertBinaryToString(int *data,char *array_string,int *index){
    int data_size=*index;
    char char_array[data_size];
    *index=0;

    for(int i=0;i<data_size;i++){
        char_array[i]=(data[i] == 1?'1':'0');
    }

    for(int i=0;i<data_size;i=i+8){
        char sub_str[8];
        memcpy(sub_str,char_array+i,8);
        array_string[(*index)++]=convertBinaryToChar(sub_str);
    }
}

char convertBinaryToChar(char *str){
    char c=strtol(str,0,2);
    return c;
}

void displayIntArray(int *array, int size)
{
    for (int i = 0; i < size; i++) {
        printf("%d",array[i]);
    }
    printf("\n");
}

void displayCharArray(char *array, int size)
{
    for (int i = 0; i < size; i++) {
        printf("%c",array[i]);
    }
    printf("\n");
} 
```

**输出：**

输入要加密的数据：prateekjoshi

二进制数据：

01110000011100100110000101110100011001010110010101101011011010100110111101110011011 0100001101001

输入密钥以加密数据：

密码

键入二进制：

101010100101110000101101000101

加密数据：

11011010001011100100110001100000011001010110010101101011011010100110111101110011011 0100001101001

解密的二进制数据：

01110000011100100110000101110100011001010110010101101011011010100110111101110011011 0100001101001

字符串中的解密数据：

普拉提克乔希

# java - 文件格式转换库

> ID：387105
> 
> 赞同：1
> 
> 时间：2008-12-22T19:28:10.837
> 
> 标签：java, html, file-format

是否有任何众所周知的解决方案满足/超过以下要求？

*   从多种非图形文档格式到 HTML 的转换（例如 doc<->HTML、pdf<->html、odt<->html 等）
*   命令行或 API（Java API 更好）
*   跨平台
*   商业或开源

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T19:38:03.950

OpenOffice 具有丰富的 API，支持在各种支持的格式之间进行转换。看看[这个](https://stackoverflow.com/questions/156915/good-way-to-create-pdf-from-office-documents-in-java)问题。它建议使用[JODConverter](http://www.artofsolving.com/opensource/jodconverter)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T04:39:39.677

我（已经写了一个 Tex/LaTeX -> HTML 和 ASCII 文本以及 RTF 转换器），会说这将是一项艰巨的任务。

问题在于，这些不同的“文档”格式旨在用于不同的目的。虽然在其中一些格式之间确实存在这样的转换工具，但在“文档”的结构、含义和实现方面通常存在概念上的差异，并且经常需要权衡一种格式支持的功能以将它们组合在一起另一个可接受的输出。例如，PDF 在显示、精确定位和对字体的支持方面非常强大，而 HTML 更关心结构，实际上对这些东西没有考虑（没有 CSS）。

我很好奇，当通常有人只是想要一个转换程序时，您如何设想使用这样的 API？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T22:53:27.037

使用[DocBook](http://www.docbook.org/whatis)，您可以导出为各种输出格式，但还原总是很困难。对于 pdf，您可以尝试[iText](http://www.lowagie.com/iText/)

# vb.net - 如何选择数据绑定到 DataGridView 时将显示哪些属性？

> ID：387112
> 
> 赞同：0
> 
> 时间：2008-12-22T19:35:50.960
> 
> 标签：vb.net

将列表集合绑定到数据网格。如何限制将显示的属性？

```
DataGridViewAirport.DataSource = GlobalDisplayAirports 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T19:41:16.550

关闭 AutoGenerateColumns，然后您可以显式创建您需要的列。例如这里有一个例子：

```
<asp:GridView ID="myGrid" runat="server" AutoGenerateColumns="False" CellSpacing="0">
    <Columns>
     <asp:BoundField DataField="Total" HeaderText="Amount" DataFormatString="{0:C}"/>

    </Columns> 
```

另一种选择是在数据绑定后隐藏列，但以上是更好的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-29T15:08:15.887

根据您的数据源，您可以标记您不想显示的属性，然后您可以保留自动生成列。

我相信这是正确的VB：

```
<System.ComponentModel.Browsable(false)> _ 
```

在 C# 中是

```
[System.ComponentModel.Browsable(false)] 
```

另一个有用的属性是

```
[DisplayName("Total Amount")] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-06T14:29:02.973

我们在所有类上设置了一个主题以创建一个名为 TailorDGV 的方法，我们将一个对数据网格的引用传递给它然后返回的方法。

然后此方法循环并隐藏所有列。然后它打开所需的列并设置固定宽度或将系统设置为自动调整大小以用可见的列填充网格。

```
 With dgvControl
            For i As Integer = 0 To .ColumnCount - 1
                .Columns(i).Visible = False
            Next
        End With 
```

您还可以使用网格列对象上的 DisplayIndex 属性来设置列在网格中的位置。此属性是从零开始的。

# vba - 向后遍历 Excel Range 对象的最快方法是什么？

> ID：387113
> 
> 赞同：5
> 
> 时间：2008-12-22T19:36:12.817
> 
> 标签：vba, excel

我在 Excel VBE 中使用 VBA，但 c# 或 vb 都可以。这个概念应该适用于所有语言。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T23:05:45.780

不明白你的意思。你想从下到上，而不是从上到下？

这应该这样做：

```
Dim myrange As Range
Set myrange = Range("B3:E10")

Dim row As Integer, col As Integer
For row = myrange.Rows.Count To 1 Step -1
    For col = myrange.Columns.Count To 1 Step -1
        Debug.Print myrange(row, col).Value  
    Next col
Next row 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T09:05:16.303

如果您正在处理多个单元格的范围并且不需要修改单元格，请始终考虑将值拉入数组并使用它：代码和工作表之间的交互相对（非常）昂贵。如果您正在使用 .NET 程序集，那会增加一倍（可能是三倍，也许更多），因为往返过程中涉及更多步骤。

在 VBA 中，是这样的：

```
Dim vals As Variant
Dim row As Long, col As Long

vals = Range("A1:Z100") ' or whatever
For col = UBound(vals,2) To LBound(vals,2) Step -1
    For row = UBound(vals) To LBound(vals) Step -1
        DoSomethingInterestingWith vals(row, col)
    Next
Next 
```

# cocoa-touch - 如何在 UIScrollView 中滚动大小不定的 UIView

> ID：387114
> 
> 赞同：7
> 
> 时间：2008-12-22T19:37:34.530
> 
> 标签：cocoa-touch

我正在尝试绘制一个无限大的水平图形，并且与屏幕的高度相同。我在其中添加了一个 UIScrollView 和一个 UIView 的子类，它实现了该`-drawRect:`方法。在模拟器中，一切正常，但在设备上，达到一定大小后似乎无法绘制图形。

我已经缓存了几乎所有可以缓存的东西，基本上只在该`-drawRect:`部分中调用 CGContextAddLineToPoint 。我只画屏幕上可见的东西。我有一个 UIScrollView 的委托，它监听`-scrollViewDidScroll:`它然后告诉图形重绘自身（`[graphView setNeedsDisplay]`）。

我找到了一种方法，它告诉我重写该`+layerClass`方法并返回`[CATiledLayer class]`。这确实允许图表在设备上实际绘制，但它的功能很差。实际绘制速度非常慢，并且出现的淡入是不可取的。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T14:09:12.197

好吧，这是我的答案：我基本上做了类似于 UITableView 如何处理单元格的事情：我有一个 NSMutableSet 的 GraphView 对象，用于存储未使用的图形。当滚动视图的一部分变得可见时，我从该集合中获取一个图形视图（如果该集合为空，则创建一个新视图）。它已经有一个 scrollX 属性来确定应该绘制它的哪一部分。我将 scrollX 属性设置为正确的值，而不是使用屏幕宽度，而是给它一个任意宽度来绘制。当它离开滚动视图时，它会从 UIScrollView 中移除并添加到集合中。

我想知道当它们离开视野时我是否真的需要将它们移除？仅当我收到内存不足警告时，尝试将它们留在屏幕上并删除不在屏幕上的那些可能是谨慎的做法？每当需要重新绘制未更改的图形部分时，这可能会消除暂停。

我的可取之处在于我的 GraphView 已经设置为仅绘制图形的一部分。那时我需要做的就是制作不止一个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T19:50:38.543

我认为这是 iPhone 图形硬件的限制。通过实验，我发现 iPhone 会拒绝绘制高度或宽度大于 2000 像素的框架。它可能与硬件中帧缓冲区的大小有限有关。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-04T04:54:10.303

观看名为“Session 104 - Advanced Scroll View Techniques”的 2011 WWDC 会议视频。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T00:05:28.563

谢谢，这很有帮助。一个问题——UIScrollView 的 contentSize 是用什么做的？只要您不创建缓冲区来填充内容视图中的整个空间，UIScrollView 是否可以容忍较大的内容大小（超过 2000 像素）？或者您是否保持 UIScrollView 的大小恒定（例如，2 个屏幕宽度）并在每次绘制时都保留 UIScrollView contentOffset 属性（使用 scrollX 而不是 contentOffset 来存储您的位置）？

我想我回答了我自己的问题（后者似乎是一个更好的选择），呵呵，但我会继续发布这个以防其他人需要澄清。

# asp.net-mvc - 为什么 ASP.NET MVC 会使用会话状态？

> ID：387124
> 
> 赞同：33
> 
> 时间：2008-12-22T19:41:06.380
> 
> 标签：asp.net-mvc, session-state

ASP.NET 团队建议使用缓存而不是会话，在过去几年中，我们停止使用会话来处理 WebForm 模型。所以我们通常在 web.config 中关闭会话

```
<sessionState mode="Off" /> 
```

但是，现在当我使用此设置测试 ASP.NET MVC 应用程序时，它会`SessionStateTempDataProvider`在 mvc 框架内的类中引发错误，它要求我打开会话状态，我做到了，它工作了。查看它使用会话的源代码：

```
// line 20 in SessionStateTempDataProvider.cs
Dictionary<string, object> tempDataDictionary = 
httpContext.Session[TempDataSessionStateKey] as Dictionary<string, object>; 
```

那么，他们为什么要在这里使用 session 呢？我错过了什么？

==================================================== ======

**编辑**对不起，这篇文章并不是要讨论会话与缓存，而是在 ASP.NET MVC 的上下文中，我只是想知道为什么在这里使用会话。在这篇[博](http://scottw.com/asp-net-web-config-tips-part-two)文中，Scott Watermasysk 还提到关闭会话是一种很好的做法，所以我只是想知道为什么我必须打开它才能从这里开始使用 MVC。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-22T20:14:36.123

Session 用于 TempData 存储。TempData 是一种高度受限的会话状态形式，只会持续到某个用户的下一个请求。（在 MVC 2+ 中**编辑**，它会持续到下一次读取。） TempData 的目的是存储数据，然后进行重定向，并使存储的数据可用于您刚刚重定向到的操作。

将 Session 用于 TempData 存储意味着任何已经处理 Session 的分布式缓存系统都可以用于 TempData。当 TempData 可以使用时避免直接使用 Session 有几个优点。一是你不必自己清理Session；TempData 将自行“过期”。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-22T19:56:01.530

> ASP.NET 团队推荐使用缓存而不是会话

@ray247，你能提供一个参考吗？Session 和 Cache 本质上是不同的，应该根据应用需求来使用。例如，将用户特定数据存储到缓存中可能会导致不良行为。当然，如果您真的想避免使用会话，您可以提供自己的*ITempDataProvider*接口实现。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-22T19:54:28.787

嗯...可能您已经阅读过有关持久化重对象或相对很少访问的对象的内容 - 将它们放入缓存肯定更好，但对于轻对象或每次请求所需的数据，没有比这更好的技术了将它们放入会话中。

如果您正确使用会话，会话就不是邪恶的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-04-17T05:18:33.440

只是一个额外的想法。TempData 有它自己的目的，MS 知道关于 TempData 持久化机制会有不同的思想流派。因此，默认情况下，他们将持久存储设置为 SessionState。但设计仍然非常灵活。根据项目的需求和指导它的治理，您可以创建自己的临时数据提供程序以满足特定要求。

以下是一些指向资源 [TempData](http://msmvps.com/blogs/luisabreu/archive/2008/07/31/the-mvc-framework-the-tempdata-property.aspx)

以下是 TempData 实现中的一些额外改进 [TempData Improvements](http://weblogs.asp.net/jacqueseloff/archive/2009/11/17/tempdata-improvements.aspx)

这是使用 MS Velocity 分布式缓存的替代实现。 [速度 TempData 提供程序](http://consultingblogs.emc.com/jonathangeorge/archive/2009/10/14/using-an-alternative-itempdataprovider-implementation-in-asp-net-mvc.aspx)

# sql - SQL 优先级匹配

> ID：387128
> 
> 赞同：1
> 
> 时间：2008-12-22T19:42:37.873
> 
> 标签：sql, sql-server, stored-procedures, matching

我正在尝试对存储过程中的表进行优先级匹配。要求解释起来有点棘手，但希望这是有道理的。假设我们有一个名为 books 的表，其中包含 id、author、title、date 和 pages 字段。

我们还有一个存储过程，它将与表中的 ONE 行匹配查询。

这是proc的签名：

```
create procedure match
  @pAuthor varchar(100)
  ,@pTitle varchar(100)
  ,@pDate varchar(100)
  ,@pPages varchar(100)

 as

 ... 
```

优先规则如下：

*   首先，尝试匹配所有 4 个参数。如果我们找到匹配返回。
*   接下来尝试使用任意 3 个参数进行匹配。第一个参数在这里具有最高的优先级，而第四个是最低的。如果我们找到任何匹配项，则返回匹配项。
*   接下来我们检查是否有任何两个参数匹配，最后是否有任何一个匹配（仍然遵循参数顺序的优先规则）。

我已经逐案实施了这个。例如：

```
 select @lvId = id 
 from books
 where
  author = @pAuthor 
 ,title = @pTitle 
 ,date = @pDate 
 ,pages = @pPages

if @@rowCount = 1 begin
  select @lvId
  return
end

 select @lvId = id 
  from books
 where
  author = @pAuthor 
 ,title = @pTitle 
 ,date = @pDate 

 if @@rowCount = 1 begin
  select @lvId
  return
end

.... 
```

但是，对于表中的每个新列，单独检查的数量增加了 2。我真的很想将其概括为 X 列；但是，我在想出一个计划时遇到了麻烦。

感谢您的阅读，我可以提供所需的任何其他信息。

* * *

*添加：*

Dave 和其他人，我尝试实现您的代码，但它在第一个 Order by Clause 中令人窒息，我们在其中添加了所有计数。它给了我一个无效的列名错误。当我注释掉总计数并仅按单个别名排序时，proc 编译得很好。

有人有想法么？

这是在 Microsoft Sql Server 2005 中

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T21:23:48.433

我相信您正在研究的答案是迄今为止最简单的。但我也相信，在 SQL Server 中，它们将永远是全表扫描。（在 Oracle 中，如果表没有同时进行大量 DML，您可以使用位图索引）

一个更复杂但性能更高的解决方案是构建您自己的索引。不是 SQL Server 索引，而是您自己的。

创建一个包含 3 列（lookup-hash、rank、Rowid）的表（Hash-index）

假设您有 3 列可供搜索。甲、乙、丙

对于添加到 Books 的每一行，您将通过触发器或 CRUD proc 将 7 行插入 hash_index。

首先你会

```
insert into hash_index 
SELECT HASH(A & B & C), 7 , ROWID
FROM Books 
```

其中 & 是连接运算符，HASH 是一个函数

然后你将为 A & B、A & C 和 B & C 插入哈希值。你现在有一些灵活性，你可以给它们所有相同的排名，或者如果 A & B 与 B & C 更匹配，你可以给它们一个更高的等级。

然后为 A 本身和 B 和 C 插入具有相同等级选择的哈希......所有相同的数字或完全不同......您甚至可以说 A 上的匹配比 B 和 C 上的匹配具有更高的选择. 这个解决方案给你很大的灵活性。

当然，这会增加很多 INSERT 开销，但如果 Books 上的 DML 很低或性能不相关，你就可以了。

现在，当您进行搜索时，您将创建一个函数，该函数返回您的@A、@B 和@C 的哈希表。您将有一个包含 7 个值的小表，您将在散列索引表中加入查找散列。这将为您提供所有可能的匹配以及可能的一些错误匹配（这只是哈希的本质）。你会得到这个结果，在排名列上排序 desc。然后将第一个 rowid 带回 book 表并确保 @A @B @C 的所有值实际上都在该行中。万一不是，并且您收到了误报，您需要检查下一个 rowid。

这个“自己动手”中的每一个操作都非常快。

*   将您的 3 个值散列到一个小的 7 行表变量 = 非常快。
*   将它们加入 Hash_index 表中的索引 = 非常快速的索引查找
*   循环结果集将导致通过 rowid = 非常快的 1 个或 2 个或 3 个表访问

当然，所有这些加起来可能比 FTS 慢……但是 FTS 将继续变得越来越慢。会有一个 FTS 比这慢的大小。你必须玩它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T19:58:23.443

您没有解释如果多个结果与达到的任何给定参数集匹配会发生什么，因此您需要更改它以考虑这些业务规则。现在，我已将其设置为在不匹配的之前返回与后续参数匹配的书籍。例如，作者、标题和页面的匹配将出现在仅匹配作者和标题的匹配之前。

您的 RDBMS 可能有不同的处理“TOP”的方式，因此您可能也需要对此进行调整。

```
SELECT TOP 1
     author,
     title,
     date,
     pages
FROM
     Books
WHERE
     author = @author OR
     title = @title OR
     date = @date OR
     pages = @pages OR
ORDER BY
     CASE WHEN author = @author THEN 1 ELSE 0 END +
     CASE WHEN title = @title THEN 1 ELSE 0 END +
     CASE WHEN date = @date THEN 1 ELSE 0 END +
     CASE WHEN pages = @pages THEN 1 ELSE 0 END DESC,

     CASE WHEN author = @author THEN 8 ELSE 0 END +
     CASE WHEN title = @title THEN 4 ELSE 0 END +
     CASE WHEN date = @date THEN 2 ELSE 0 END +
     CASE WHEN pages = @pages THEN 1 ELSE 0 END DESC 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T19:58:33.067

我没有时间写出查询，但我认为这个想法会奏效。

对于您的谓词，使用“author = @pAuthor OR title = @ptitle ...”，这样您就可以获得所有候选行。

使用 CASE 表达式或您喜欢的任何内容在结果集中创建虚拟列，例如：

```
SELECT CASE WHEN author = @pAuthor THEN 1 ELSE 0 END author_match,
       ... 
```

然后添加此顺序并获取返回的第一行：

```
ORDER BY (author_match+title_match+date_match+page_match) DESC,
         author_match DESC,
         title_match DESC,
         date_match DESC
         page_match DESC 
```

您仍然需要为每个新列扩展它，但只需要一点点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T08:58:29.297

尝试这个：

```
ALTER PROCEDURE match  
  @pAuthor varchar(100)  
 ,@pTitle varchar(100)  
 ,@pDate varchar(100)  
 ,@pPages varchar(100)  
-- exec match 'a title', 'b author', '1/1/2007', 15  
AS

SELECT  id,

        CASE WHEN author = @pAuthor THEN 1 ELSE 0 END
        + CASE WHEN title = @pTitle THEN 1 ELSE 0 END
        + CASE WHEN bookdate = @pDate THEN 1 ELSE 0 END
        + CASE WHEN pages = @pPages THEN 1 ELSE 0 END AS matches,

        CASE WHEN author = @pAuthor THEN 4 ELSE 0 END
        + CASE WHEN title = @pTitle THEN 3 ELSE 0 END
        + CASE WHEN bookdate = @pDate THEN 2 ELSE 0 END
        + CASE WHEN pages = @pPages THEN 1 ELSE 0 END AS score
FROM books
WHERE author = #pAuthor 
    OR title = @pTitle 
    OR bookdate = @PDate 
    OR pages = @pPages
ORDER BY matches DESC, score DESC 
```

但是，这当然会导致表扫描。您可以通过将其合并为一个 CTE 和 4 个 WHERE 子句来避免这种情况，每个属性一个 - 会有重复，但无论如何您都可以只取 TOP 1。

编辑：添加了 WHERE ... OR 子句。如果是我会感觉更舒服

```
SELECT ... FROM books WHERE author = @pAuthor
UNION
SELECT ... FROM books WHERE title = @pTitle
UNION
... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T20:02:48.177

```
 select id, 
               CASE WHEN @pPages = pages 
                    THEN 1 ELSE 0 
               END
             +  Case WHEN @pAuthor=author 
                    THEN 1 ELSE 0 
                END AS 
             /* +  Do this for each attribute. If each of your 
attributes are just as important as the other 
for example matching author is jsut as a good as matching title then 
leave the values alone, if different matches are more 
important then change the values */ as MatchRank  
        from books 

        where  author = @pAuthor OR
               title = @pTitle OR
               date = @pDate

     ORDER BY  MatchRank DESC 
```

# 已编辑

当我运行此查询（仅修改为适合我自己的一个表）时，它在 SQL2005 中运行良好。

我建议使用 where 子句，但您会想尝试一下以查看性能影响。您将需要使用 OR 子句，否则您将失去潜在的匹配

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T07:53:04.403

好的，让我重申一下我对您的问题的理解：您需要一个存储过程，它可以采用可变数量的参数，并将与 SQL Server 2005 上传递的加权优先顺序中的参数匹配的第一行传回。

理想情况下，它将使用 WHERE 子句来防止全表扫描，并利用索引并将“短路”搜索 - 如果可以及早找到一个，您不希望搜索所有可能的组合。也许我们还可以允许除 = 之外的其他比较器，例如 >= 用于日期，LIKE 用于字符串等。

一种可能的方法是像[本文](http://weblogs.asp.net/jgalloway/archive/2007/02/16/passing-lists-to-sql-server-2005-with-xml-parameters.aspx)中那样将参数作为 XML 传递并使用 .Net 存储过程，但现在让我们保持普通的普通 T-SQL。

在我看来，这就像对参数的二进制搜索：搜索所有参数，然后删除最后一个，然后删除倒数第二个但包括最后一个，等等。

让我们将参数作为分隔字符串传递，因为存储过程不允许将数组作为参数传递。这将允许我们在存储过程中获取可变数量的参数，而无需为每个参数变化创建一个存储过程。

为了允许进行任何类型的比较，我们将传递整个 WHERE 子句列表，如下所示： title like '%something%'

传递多个参数意味着将它们分隔在一个字符串中。我们将使用波浪号 ~ 字符来分隔参数，如下所示： author = 'Chris Latta'~title like '%something%'~pages >= 100

然后只需对符合我们有序参数列表的第一行进行二进制加权搜索（希望带有注释的存储过程是不言自明的，但如果不是，请告诉我）。请注意，您始终可以保证得到结果（假设您的表至少有一行），因为最后一次搜索是无参数的。

这是存储过程代码：

```
CREATE PROCEDURE FirstMatch
@SearchParams VARCHAR(2000)
AS
BEGIN
    DECLARE @SQLstmt NVARCHAR(2000)
    DECLARE @WhereClause NVARCHAR(2000)
    DECLARE @OrderByClause NVARCHAR(500)
    DECLARE @NumParams INT
    DECLARE @Pos INT
    DECLARE @BinarySearch INT
    DECLARE @Rows INT

    -- Create a temporary table to store our parameters
    CREATE TABLE #params 
    (
        BitMask int,             -- Uniquely identifying bit mask
        FieldName VARCHAR(100),  -- The field name for use in the ORDER BY clause
        WhereClause VARCHAR(100) -- The bit to use in the WHERE clause
    )

    -- Temporary table identical to our result set (the books table) so intermediate results arent output
    CREATE TABLE #junk
    (
        id INT,
        author VARCHAR(50),
        title VARCHAR(50),
        printed DATETIME,
        pages INT
    )

    -- Ill use tilde ~ as the delimiter that separates parameters
    SET @SearchParams = LTRIM(RTRIM(@SearchParams))+ '~'
    SET @Pos = CHARINDEX('~', @SearchParams, 1)
    SET @NumParams = 0

    -- Populate the #params table with the delimited parameters passed
    IF REPLACE(@SearchParams, '~', '') <> ''
    BEGIN
        WHILE @Pos > 0
        BEGIN
            SET @NumParams = @NumParams + 1
            SET @WhereClause = LTRIM(RTRIM(LEFT(@SearchParams, @Pos - 1)))
            IF @WhereClause <> ''
            BEGIN
                -- This assumes your field names dont have spaces and that you leave a space between the field name and the comparator
                INSERT INTO #params (BitMask, FieldName, WhereClause) VALUES (POWER(2, @NumParams - 1), LTRIM(RTRIM(LEFT(@WhereClause, CHARINDEX(' ', @WhereClause, 1) - 1))), @WhereClause) 
            END
            SET @SearchParams = RIGHT(@SearchParams, LEN(@SearchParams) - @Pos)
            SET @Pos = CHARINDEX('~', @SearchParams, 1)
        END
    END 

    -- Set the binary search to search from all parameters down to one in order of preference
    SET @BinarySearch = POWER(2, @NumParams) 
    SET @Rows = 0
    WHILE (@BinarySearch > 0) AND (@Rows = 0)
    BEGIN
        SET @BinarySearch = @BinarySearch - 1
        SET @WhereClause = ' WHERE '
        SET @OrderByClause = ' ORDER BY '
        SELECT @OrderByClause = @OrderByClause + FieldName + ', ' FROM #params WHERE (@BinarySearch & BitMask) = BitMask ORDER BY BitMask
        SET @OrderByClause = LEFT(@OrderByClause, LEN(@OrderByClause) - 1) -- Remove the trailing comma
        SELECT @WhereClause = @WhereClause + WhereClause + ' AND ' FROM #params WHERE (@BinarySearch & BitMask) = BitMask ORDER BY BitMask
        SET @WhereClause = LEFT(@WhereClause, LEN(@WhereClause) - 4) -- Remove the trailing AND

        IF @BinarySearch = 0
        BEGIN
            -- If nothing found so far, return the top row in the order of the parameters fields
            SET @WhereClause = ''
            -- Use the full order sequence of fields to return the results
            SET @OrderByClause = ' ORDER BY '
            SELECT @OrderByClause = @OrderByClause + FieldName + ', ' FROM #params ORDER BY BitMask
            SET @OrderByClause = LEFT(@OrderByClause, LEN(@OrderByClause) - 1) -- Remove the trailing comma
        END

        -- Find out if there are any results for this search
        SET @SQLstmt = 'SELECT TOP 1 id, author, title, printed, pages INTO #junk FROM books' + @WhereClause + @OrderByClause
        Exec (@SQLstmt)

        SET @Rows = @@RowCount
    END

    -- Stop the result set being eaten by the junk table
    SET @SQLstmt = REPLACE(@SQLstmt, 'INTO #junk ', '')

    -- Uncomment the next line to see the SQL you are producing
    --PRINT @SQLstmt

    -- This gives the result set
    Exec (@SQLstmt)
END 
```

这个存储过程是这样调用的：

```
FirstMatch 'author = ''Chris Latta''~pages > 100~title like ''%something%''' 
```

你有它 - 一个完全可扩展的优化搜索，以加权优先顺序搜索最高结果。这是一个有趣的问题，它展示了使用本机 T-SQL 可以实现的目标。

这有几个小问题：

*   它依赖于调用者知道他们必须在字段名称后留一个空格才能使参数正常工作
*   你不能有带有空格的字段名称 - 可以通过一些努力来修复
*   它假设相关的排序顺序总是升序的
*   下一个必须查看此过程的程序员会认为您疯了 :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T13:41:24.513

关于无法编译的 Order By 子句：

正如递归所说（在评论中），别名'可能不在 Order By 子句中使用的表达式中。为了解决这个问题，我使用了一个返回行的子查询，然后在外部查询中排序。通过这种方式，我可以在 order by 子句中使用别名。有点慢，但更干净。

# latex - 哪个是最好的导入/导出 LaTeX 工具？

> ID：387130
> 
> 赞同：2
> 
> 时间：2008-12-22T19:43:29.010
> 
> 标签：latex, file-conversion

在出版 CS/数学的学术界工作，你迟早会发现自己试图在只接受 .doc/.rtf 的期刊上发表文章。这意味着从 LaTeX 到劣等格式的逐行翻译，尤其是方程式，需要花费数小时的乏味、无聊的时间。多年来，我尝试了许多 LaTeX 导出工具，但没有一个，至少是免费的，我非常满意。我希望这个页面能够收集和监控 LaTeX、.doc/.rtf 或其他有用（例如 HTML、MATHML）格式的最佳导入/导出工具。

因此，您最喜欢的 LaTeX 导入或导出工具是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T19:51:07.530

AFAIK 并没有真正方便有效的方法来实现您想要做的事情。在这种罕见的情况下，我通常会导出为 pdf，然后选择所有文本，然后粘贴到 word 中。这太可怕了，把事情搞砸了，当然不会调整你的引用。

直到今天，我仍然不明白在科学领域写作的人是如何在 Word 中写作和发表的。它在一些人机交互文献中很常见，但我在其他会议和期刊中没有看到它。请问是哪一种？

此外，一些地方，一旦你已经被接受，如果你推送它，他们会愿意接受 PDF。您可能需要自己进行一些调整。谈判有时会解决这个问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T20:01:21.113

UK TeX FAQ 已经收集这方面的答案已经有一段时间了。:)

请参阅[从 (La)TeX 到 HTML](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=LaTeX2HTML)的[转换以及与 (La)TeX 之间的其他转换](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=fmtconv)。还有另一个由 Wilfried Hennings 维护的专门关于[LaTeX 和 PC 文本处理器之间的转换器的常见问题解答。](http://www.tug.org/utilities/texconv/index.html)

对于 LaTeX 到 HTML，有 LaTeX2HTML、TtH、Tex4ht、TeXpider 和 Hevea；以我的经验，TeX4ht 是最好的。对于 LaTeX 到 Word，您可以使用 TeX2RTF（不太好）通过 RTF，或者通过 Adob​​e Acrobat，它可以生成 Word 可以阅读的 PDF（也不好），或者通过上面的 HTML，但最好是使用 tex4ht可以生成OpenOffice ODT格式，很容易转换成Word。

UK TeX FAQ 还有很多其他有用的东西；你应该[看看](http://www.tex.ac.uk/cgi-bin/texfaq2html?introduction=yes)。

# .net - 从 .NET 1.1 迁移到 .NET 3.5

> ID：387134
> 
> 赞同：8
> 
> 时间：2008-12-22T19:45:32.267
> 
> 标签：.net, version, upgrade

将 Web 应用程序从 .NET 1.1 升级到 .NET 3.5 有哪些令人信服的理由？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-22T19:52:47.777

问题不在于“你是否应该”——就特性和添加的编译时检查而言；退出 1.1 框架并进入 2.0 框架几乎是必然的。问题是，你应该多快移植？需要改变什么？

您的第一步是将应用程序移植到 .NET 2.0。原因是 .NET 2.0 中有很多以前不存在的功能，并且以前的功能已被弃用。（在 ASP.NET 中，有许多在 2.0 中弃用的功能）。

.NET 2.0 允许更强的类型安全性、可为空的类型和框架中的更改。2.0 代表（我认为）.NET 平台的第一个“真正”版本。它是一个强有力的竞争者，你会发现你在 1.1 中使用的一些框架东西在 2.0 中已经被修改了。

这不是一个简单的“移植代码并获得好处”的场景。如果你想要这些好处，你将不得不重写一些代码（最值得注意的是，涉及泛型的事情）；但即使在更大的 .NET 框架中，也有如此多的“幕后变化”，您需要逐步移植它：**不要直接从 1.1 跳转到 3.5。**

**1.1 - 2.0**

*   [泛型](http://msdn.microsoft.com/en-us/library/512aeb7t(VS.80).aspx)

*   [静态类](http://www.yoda.arachsys.com/csharp/csharp2/#static.classes)

*   [可空类型](http://www.yoda.arachsys.com/csharp/csharp2/nullable.html)

*   [收益算子](http://www.yoda.arachsys.com/csharp/csharp2/iterators.html)

*   [属性访问修饰符](http://www.yoda.arachsys.com/csharp/csharp2/#property.access)

*   [部分类型](http://www.yoda.arachsys.com/csharp/csharp2/#partial)

*   [别名](http://www.yoda.arachsys.com/csharp/csharp2/#alias)

.NET 2.0 和 .NET 3.0 之间有很多变化。整个范式发生了转变。（尽管不可否认，这是一种自愿的转变）。 [维基百科](http://en.wikipedia.org/wiki/.NET_Framework#.NET_Framework_3.0)有一整节专门介绍它，但我会（一些！）这里的变化：

**.NET 框架更改**

*   Windows 演示基础 (WPF)
*   Windows 通信基础 (WCF)
*   Windows 工作流基础
*   Windows CardSpace

**C# 更改**：

*   [LINQ](http://en.wikipedia.org/wiki/LINQ)
*   对象初始化器
*   集合初始化器
*   匿名类型
*   Lambda 表达式
*   自动属性
*   扩展方法（来源：[维基百科](http://en.wikipedia.org/wiki/C_Sharp_(programming_language)#Features_of_C.23_3.0)）

显然，还会有更多。仅仅从 1.1 到 2.0 的跳跃就值得整个发布周期。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-22T19:48:59.233

.net 1.1 已弃用，未进一步开发。我不确定安全问题。但总的来说，它已被放弃，并且从 2.0 开始，微软确保了较新版本的向后兼容性，而 1.1 并非如此。

所以如果你有机会搬家——搬家。你会得到新的语言特性，你会得到一个不断构建的框架。如果你需要它，你会得到 linq，silverlight 支持，当然还有泛型等等。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T19:53:57.413

实际上，我最近已经完成了从 .NET 1.1 到 .NET 2.0 的整个代码库的转换。考虑到 .NET 3.5 实际上只是 .NET 2.0 的扩展集，它并不是一个全新的基础。

在许多方面，差异确实相当大。对我来说，.NET 1.1 并没有以任何方式被“驯服”，并且需要大量的代码。此外，必须针对 .NET 1.1 使用 VS 7，因此需要较旧的工具。

对于 Web 应用程序，需要不同的 Web 配置，因为它公开了 .NET 版本，这使得它更加混乱。不要陷入“.NET 3.5 具有新功能，因此我必须转向它”的动议，因为您必须根据需求做出决定，而不是根据潜在的工具用途做出决定。正如许多作者正确指出的那样，您很有可能不会使用构成整个框架的一半功能。

另一方面，我建议至少从 .NET 1.1 转移到 .NET 2.0。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-22T19:46:56.633

泛型，lambdas，LINQ，还有很多我忘记的我敢肯定。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-22T20:31:07.887

升级到 .NET 3.5 有许多令人信服的理由。然而，正如其他人指出的那样，3.5 很大程度上（如果不是全部）只不过是对 2.0 的扩展；然而，2.0 带来了大量特性，使其非常值得一试。话虽这么说，在我看来，如果你要采取行动，转移到 2.0 而不仅仅是转移到 3.5 似乎有点愚蠢。

单独的扩展方法*非常*有用。我发现自己使用它们的频率比我想象的要频繁得多。此外，3.5 中的许多新功能都基于它们。泛型极大地简化了我们的开发工作；而且，如果您使用 C# 进行编码，那么自动 setter 和 getter 将是一个福音。Lambda 表达式对我来说还是比较新的，所以我不能和他们说话，但我知道其他人觉得它们特别有用。

WPF 提供了一种全新的编写应用程序的方法，我已经使用过它。它显示出巨大的希望；不幸的是，它似乎还没有得到我（个人）认为它应得的广泛采用。希望这会随着时间的推移而改变，但这将取决于微软本身是否开始更积极地推动它。

就框架本身而言，我发现改进或提供了许多以前在 1.1 中缺少的功能；随着它的成熟，Framewok 似乎正朝着要求我们为那些我们通常执行的任务（例如目录服务、FTP 访问、命名管道等）编写更少代码的方向前进。粗糙的边缘越来越光滑。

因此，简而言之：迁移到 3.5 意味着您可以使用更少的代码编写较新的应用程序，并且可以重构现有应用程序以使用更少的代码（我不建议仅出于此目的这样做）。3.5 为您提供了广泛的生产力工具；我个人的看法是，仅这些工具就值得飞跃。

但是，就像任何业务决策一样，您必须权衡所有这些与项目的状态——以及移植代码库时可能出现的任何潜在缺陷。迄今为止，我的经验是我们遇到了一些障碍，但还不足以让整个行动戛然而止。尽管如此，对于任何迁移，代码总是有可能被破坏。必须牢记这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-22T19:53:08.757

最大的不同是您正在迁移到 .NET 2.0 CLR（这是当前 .NET 正在运行的同一个 CLr）。

这意味着您有大量的错误修正和 CLR 级别的泛型支持。他们其余的更改只是对基础类库的更改，以及编译器中的新语言功能。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-22T23:25:00.920

我认为一个很好的理由是在 ASP.NET 2.0 及更高版本中设置的提供程序框架。能够获取用户是否已登录或用户拥有的角色列表，而无需担心用于检查这些内容的底层机制，这是一个很大的好处。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-22T19:50:24.223

不要忘记 WCF、WF、WPF、CardSpace 等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-23T11:15:31.000

编辑并继续？泛型和可为空的类型也让生活更轻松！

# winapi - 如何检查系统是否处于待机模式？

> ID：387141
> 
> 赞同：1
> 
> 时间：2008-12-22T19:48:23.760
> 
> 标签：winapi, visual-c++, mfc

我想检查系统是否处于待机模式，是否有任何 Win32 API ？我不确定它是否与睡眠模式相同。

在我的应用程序中执行了一些代码，这导致它在退出待机状态时挂起（它在待机模式下执行），所以我想避免在计算机处于睡眠/待机状态时运行该代码。

提前致谢！

丹尼斯

**编辑：**也许这是不可能的，因为程序不应该像下面的答案中所指出的那样运行，所以我将其视为答案:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T19:52:26.467

当系统处于待机模式时，将不会运行任何程序，因此可以执行以下操作：

```
int is_in_standby() {
  return 0;
} 
```

还是我错过了什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T21:55:41.757

据我所知，在 Windows 的待机模式下没有代码正在运行。除了RAM，一切都关闭了。您的代码中的错误可能是由计算机再次唤醒后的窗口消息引起的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T01:36:18.127

如果您的程序正在运行，您就不会处于待机状态。

我认为您想要做的是处理[WM_POWERBROADCAST](http://msdn.microsoft.com/en-us/library/aa373247(VS.85).aspx)消息。这些将告诉您系统何时更改电源状态，并且在 Vista 之前，您可以是邪恶的，如果您愿意，可以否决掉电。

# c++ - C++ - gsoap：参数传递内存管理问题

> ID：387142
> 
> 赞同：3
> 
> 时间：2008-12-22T19:48:34.180
> 
> 标签：c++, web-services, memory-management, soap, gsoap

我正在为它编写一个 Web 服务器和客户端测试存根。我对参数的内存管理有疑问。

我正在从我的客户端调用一个肥皂函数 ns1_func1(input * pInput, output* pOutput) 现在输入和输出类都包含指向其他结构的指针。

例如

类输出 { 类 abc * p1; 类定义 * p2; };

我的问题是 - 谁负责内存分配？客户端负责输入内存分配，服务器负责输出内存管理吗？

现在我的客户端代码看起来像这样

```
client_fn()
{

 ...

 input inp1;
 output * pOutput = NULL;
 ns1_func1(&inp1, pOutput);
 if(pOutput == NULL)
 {
   cout<<"pOut is NULL\n";
   return ERR;
 }
 else
 {
   // retrive output values from pOutput
 }

 ...
} 
```

尽管使用soap_new_Output（soap，-1）从服务器分配pOutput，但在调用ns1_func1后我总是将pOutput设为NULL。

另外，我的理解是我们应该使用soap_new_X 来分配内存，当我们调用soap_destroy 时，这些内存会自动释放。如果我错了，请纠正我。

基本上，我在不知道在这种情况下应该由谁来处理内存分配/释放的情况下苦苦挣扎。

任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T05:39:50.883

因为客户端和服务器一般是不同的进程，或者不同的机器，各自负责各自的内存管理。客户端必须为其输入参数分配内存，然后 gsoap 将其序列化以发送到服务器。

服务器反序列化输入参数，分配它需要的任何内存。它为其输出分配内存，gsoap 将其序列化以发送回客户端。客户端反序列化服务器的响应，分配它需要的任何内存。

您肯定需要使用soap_malloc（等）进行内存分配，这是gsoap库可以跟踪SOAP调用清理时需要释放的唯一方法。

在您给出的特定 ns1_func1 示例中，服务器分配响应，并且生成的客户端代码应该分配它需要的任何内存。该调用的 WSDL 中可能有问题，生成的客户端代码不是您所期望的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-27T23:07:59.263

执行此代码后：

```
output * pOutput = NULL;
ns1_func1(&inp1, pOutput); 
```

无论 ns1_func 做什么，pOutput 都将*始终为 NULL。*您将 pOutput 的*值*传递给函数，在本例中为 NULL。*如果不知道 pOutput 的地址*（写为 &pOutput），该函数无法更改该值。

ns1_func1 要求一个指向“输出”结构的指针，因为这是它想要写入输出数据的地方。这意味着您需要在堆栈上分配该空间：

```
output theOutput;
output * pOutput = &theOutput;
ns1_func1(&inp1, pOutput); 
```

或在堆上：

```
output * pOutput = malloc(sizeof(output));
ns1_func1(&inp1, pOutput);
...
free(pOutput); 
```

如果 ns1_func1 要为您分配内存，它必须返回一个指向输出结构的指针。为此，它需要询问该指针的地址，或指向指针的指针。换句话说，像这样的声明：

```
output * pOutput = NULL;
different_ns1_func1(&inp1, &pOutput);
if (pOutput != NULL) {
    ...
    free(pOutput);
} 
```

抱歉，如果这有点令人困惑，所有关于指针的讨论，但您问题的基本答案是*您*必须为要写入的函数分配内存，因为函数正在询问*数据的地址*而不是*指向数据的指针*的地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T07:05:32.330

ns1_func1 的签名是什么？是 ns1_func1( Input*, Output*) 还是 ns1_func1( Input*, Output*& ) ？对于第一种情况，您将永远无法获得非空值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-28T20:51:54.423

谢谢丹顿，

我面临的问题是，在服务器中，我使用soap_new_abc 和soap_new_def 为类abc 和def 分配内存。这些在清理过程中不会被释放。在清理部分，我调用了soap_destroy、soap_end 和soap_free。根据 gsoap 文档，soap_free 应该调用通过 soap_new_X 分配的类的 ~tors，但那没有发生。我实际上将 DEBUG 语句放在了 soapC.cpp 中的 ctors 和 ~tors 中。ctor 中的 DEBUG 语句出现了，但 ~tors 中没有。所以我担心可能会有内存泄漏。

在从soap_free 清理期间是否应该自动调用soap_delete_X？

# windows - 为什么 malloc 会覆盖 RSP 和 RSP+8？

> ID：387145
> 
> 赞同：2
> 
> 时间：2008-12-22T19:49:05.753
> 
> 标签：windows, 64-bit, malloc

[您可以在此处](http://msdn.microsoft.com/en-us/library/ms794533.aspx)阅读有关 64 位调用约定的信息。x64 函数应该自行清理，但是，当我从 .asm 调用 malloc 时，它会覆盖 RSP 和 RSP+8 处的值。这似乎非常错误。有什么建议么？

```
public TestMalloc

extern malloc : near

.CODE

align 8
TestMalloc proc
    mov rcx, 100h
    000000018000BDB8 48 C7 C1 00 01 00 00   mov         rcx,100h 

    call malloc
    000000018000BDBF E8 CC AC 06 00         call        malloc (180076A90h) 

    ret
    000000018000BDC4 C3                     ret              
    000000018000BDC5 66 66 90               xchg        ax,ax 
TestMalloc endp

END 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T20:41:45.213

对于 x64 调用约定，即使参数在寄存器中传递，调用者也需要在堆栈上为它们节省空间：

> 请注意，总是为寄存器参数分配空间，即使参数本身从未归入堆栈；被调用者保证已为其所有参数分配空间。寄存器参数需要本地地址，因此如果调用的函数需要获取参数列表 (va_list) 或单个参数的地址，则可以使用连续区域。

[http://msdn.microsoft.com/en-us/library/ew5tede7.aspx](http://msdn.microsoft.com/en-us/library/ew5tede7.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T20:11:21.263

老实说，我不确定，但是您是否尝试过在调试器中单步执行程序集？如果您遵循内部逻辑，您可能会发现一些关于正在发生的事情的线索。我推荐[WinDbg](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)。

# iphone - 可编辑文本字段的 UITableView 列表

> ID：387163
> 
> 赞同：3
> 
> 时间：2008-12-22T19:55:34.930
> 
> 标签：iphone, cocoa-touch

我知道这可能不符合 Apple 针对 iPhone 的人机界面指南，但我想摆脱一层推送视图并拥有一个可编辑文本字段列表。此外，我希望键盘在视图出现时从一开始就出现在屏幕上。

问题是当我有超过三个这样的字段时，弹出式键盘将覆盖下面的字段。并且用户无法向下滚动到它们。我认为这是因为表格视图是全屏的。我试图使列表的高度尽可能高，因为它可以让键盘一直可见，但没有运气。

任何人都知道我应该如何安排事情以获得我想要的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T21:48:38.993

如果您真的永远不需要离开键盘，那么 UITableView 没有理由全屏显示。您可以像这样更改框架（其中 HEIGHT 是 tableview 将在其原点和键盘顶部之间占用的像素数）：

tableView.frame = CGRectMake(0,0,320,HEIGHT);

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-31T15:41:28.807

如果你坚持强迫用户一直使用这么小的输入区域，你可以通过覆盖 UITextEditDelegate 方法让返回键自动跳转到下一个文本输入字段来促进文本输入：

```
- (BOOL)textFieldShouldReturn:(UITextField *)textField
    {
        if ( textField == self.firstNameField )
        {
            [self.lastNameField becomeFirstResponder];
        }
        else if ( textField == self.lastNameField )
        {
            [self.addressField becomeFirstResponder];
        }
        else if ( textField == self.addressField )
        {
            [self.cityField becomeFirstResponder];
        }
        else if ( textField == self.cityField )
        {
            [self.stateField becomeFirstResponder];
        }
        else if ( textField == self.stateField )
        {
            [self.zipcodeField becomeFirstResponder];
        }
        else if ( textField == self.zipcodeField )
        {
            [textField resignFirstResponder];

            [self.scrollView scrollRectToVisible:self.firstNameField.frame animated:YES];
        }

        return YES;
    } 
```

此示例将允许用户按顺序输入姓名和地址字段，而无需手动滚动下一个文本字段进入视图，也无需键盘关闭和重新出现。

# continuous-integration - 哈德逊“聚合下游测试结果”的问题

> ID：387164
> 
> 赞同：11
> 
> 时间：2008-12-22T19:55:41.873
> 
> 标签：continuous-integration, hudson

我的 Hudson 项目似乎没有正确聚合下游测试结果，我想知道我是否在某处错过了配置步骤。我有两个项目，Foo 和 Foo-Tests，它们都是自由式工作。

在项目 Foo 我有以下配置：

*   选中“聚合下游测试结果”。
*   选中上一个选项下的“自动聚合所有下游测试”。
*   检查“构建其他项目”并指定“Foo-Tests”来构建。

在项目 Foo-Tests 我有以下配置：

*   检查“发布 JUnit 测试结果报告”并指定我的 JUnit 报告 XML 文件。

当 Foo 构建时，它会成功构建并正确触发 Foo-Tests 构建。Foo-Tests 构建成功并正确发布了 JUnit 报告。但是，当我在 Foo 中查找汇总的测试结果时，有一个构建的“最新测试结果（无测试）”链接将我发送到 404。

这是我尝试过的不能解决问题的方法：

*   告诉 Foo 不带参数“发布 JUnit 测试结果报告”（项目 Foo 中没有测试，只有 Foo-Tests）。这导致了一个错误，因为在项目中没有可供它处理的测试文件。
*   告诉 Foo-Tests 没有参数的“指纹所有已发布的工件”（我想知道 Hudson 是否将 JUnit 报告视为幕后工件）。这导致了一个错误，因为我没有明确定义要发布的任何工件。

我正在使用哈德逊 1.266。

*编辑：* 我应该注意到我在 Hudson 用户邮件列表中发现了两个没有答案的问题，可能有助于解决这个问题：

*   [问题 1（纳布尔）](http://www.nabble.com/Can-someone-explain-how-%22Aggregate-downstream-test-results%22-works--td20947020.html#a20947020)
*   [问题 2（纳布尔）](http://www.nabble.com/Aggregate-Test-Results-td18699694.html#a18699694)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-09-24T21:45:50.397

我们正在使用 Hudson 版本。1.324 并且有类似的麻烦。尽管您提到您尝试启用指纹识别并且它对您不起作用，但它对我们有用。我们按照此处的说明进行操作：

[http://shotgunsandpenguins.blogspot.com/2009/07/how-to-aggregate-downstream-test.html](http://shotgunsandpenguins.blogspot.com/2009/07/how-to-aggregate-downstream-test.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-28T18:24:42.377

我能够用 Hudson 1.266 复制您的问题。这是一个 Hudson 错误，已在以后的版本（1.287 之前）中修复，因此升级 Hudson 或使用此两次单击解决方法：从项目页面，首先转到最新版本，然后是聚合测试结果。

问题是 Foo 的项目页面仅显示最新测试结果链接，该链接的 URL 类似于[http://localhost:8080/hudson-1.266/job/Foo/lastBuild/testReport/](http://localhost:8080/hudson-1.266/job/Foo/lastBuild/testReport/)。由于 Foo 没有自己的测试，因此此链接没有可引用的 JUnit XML 文件并返回您提到的错误。当没有测试时，通过从 latestBuild/testReport/ 重定向到 latestBuild/ 来修复 1.266 和 1.287 之间的某个位置。您在 1.266 中的替代方案是，而不是单击项目页面中的最新测试结果，向下滚动一点并单击永久链接下的最新构建。这会将您带到 latestBuild/ URL，然后您可以从那里单击 Aggregated Test Result，其 URL 类似于[http://localhost:8080/hudson-1.266/job/Foo/lastBuild/aggregatedTestReport/](http://localhost:8080/hudson-1.266/job/Foo/lastBuild/aggregatedTestReport/). 在此页面上，来自下游项目的所有测试结果都将在下钻部分下提供。

不幸的是，即使在 1.287 中，Drill Down 链接仍然存在问题。从 Foo 开始，当您深入到上面概述的 Foo-Tests 时，您将被带到一个格式错误的 URL，它看起来像[http://localhost:8080/hudson-1.287job/Foo-Tests/](http://localhost:8080/hudson-1.287job/Foo-Tests/)。您必须手动修改该 URL 以在 hudson 上下文和其后的作业路径之间插入 /，使其看起来像[http://localhost:8080/](http://localhost:8080/) **hudson-1.287/job** /Foo-Tests/。然后您将能够实际看到下游测试结果。

我还没有机会查看 Hudson 的源代码来查找错误，但是已经有一个问题可以解决。它的[问题 1574](https://hudson.dev.java.net/issues/show_bug.cgi?id=1574)，并且已经开放了将近一年。

顺便说一句，我真的很喜欢 Hudson 的 CI，但他们的界面并没有想象中的那么流畅。我期待他们在 ExtJS 中对 UI 的返工。也许这就是他们花费所有时间的原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T05:42:55.077

我修复了 Hudson 1.288 中缺少的“/”问题

使用聚合下游测试结果的关键是在两个作业上运行指纹。在这种情况下，这将是 'Foo' 和 'Foo-tests'

Hudson 通过查找具有相同指纹的文件将构建与下游测试相匹配。所以这意味着你的指纹必须匹配。有点像犯罪现场。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-03T15:42:47.743

Foo 和 Foo-Test 这两个项目必须知道它们在同一个流上，因此它需要一个公共文件的指纹（并因此归档）。

我必须选择一个在 Foo 和 Foo-Test 运行之间没有改变的文件，并且在它们都运行的时间之间仍然改变。对我来说，这是 Foo 在我的 Foo 和 Foo-Test 版本的自定义/公共工作区中生成的一个不相关的临时 .jar。

即，我不得不让 Foo 和 Foo-Test 指纹同一个文件。

after that, at least with hudson 1.330, things work - aggregated links, drilldown, etc.

# asp.net - 如何使我的 ASP.NET 服务器控件将嵌入的代码块作为属性值？

> ID：387167
> 
> 赞同：7
> 
> 时间：2008-12-22T19:56:57.580
> 
> 标签：asp.net, web-controls, servercontrols

我有一个具有 Title 属性的自定义服务器控件。使用控件时，我想在 aspx 页面中设置标题的值，如下所示：

```
<cc1:customControl runat="server" Title='<%= PagePropertyValue%>' >
more content
</cc1:customControl> 
```

但是，当我这样做时，我得到的是确切的字符串 <%= PagePropertyValue%> 正在显示，而不是我希望看到的属性值。

所以在尝试了数据绑定表达式之后（如下所示）。我没有得到看起来很糟糕的字符串文字，但我也没有得到任何其他东西。

```
<cc1:customControl runat="server" Title='<%# PagePropertyValue%>' >
more content
</cc1:customControl> 
```

我需要对我的自定义控件做些什么来获取这种值？或者我需要对页面做些什么。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T20:09:43.733

你不能。<%= %> 将字符串直接写入响应流，这发生在构造服务器控件之后。请参阅[此帖子](https://stackoverflow.com/questions/370201/why-will-expressions-as-property-values-on-a-server-controls-lead-to-a-compile)以获取解释。

因此，正如 Zachary 所建议的那样，它要么是代码隐藏，要么是 <%# + 数据绑定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T21:13:22.723

作为我自己的问题的后续，我发现我真正想要的是使用 <%$ 语法使用 ASP.NET 表达式，因为我想要做的是放入本地化的内容中。

这可以在服务器控制端显然没有额外处理的情况下完成。

```
<cc1:customControl runat="server" Title='<%$ Resouces: ResourceFile, ContentKey %>' >
more content and controls
</cc1:customControl> 
```

这工作得很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T20:00:15.530

尝试使用数据绑定语法： `<%# PagePropertyValue %>`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T20:56:50.563

为了使绑定属性值按照建议正常工作，您将在 aspx 或 ascx 文件中拥有它：

```
<cc1:customControl runat="server" Title='<%# PagePropertyValue %>' >
more content
</cc1:customControl> 
```

然后，您将需要在页面中实际绑定数据，您必须将其添加到文件后面的代码中（C# 中的代码）

```
protected void Page_Load(object sender, EventArgs e)
{
    DataBind();
} 
```

这样，它将绑定您的 ascx 或 aspx 文件中的数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-19T22:44:19.490

请注意，这是特定于控件属性的。当在控制属性之外使用 <%= 语法时，这意味着页面中的其他任何地方语法都按预期工作。所以这个 <%=GetCapitalUserName()%> 会调用正确的方法并将调用的结果注入到页面中。

# html - Web 显示：分页与长表

> ID：387177
> 
> 赞同：6
> 
> 时间：2008-12-22T19:59:21.380
> 
> 标签：html, pagination, html-table

似乎网页设计的趋势是提供分页输出，其中长表格一次显示一个页面。我的客户不喜欢这样，并要求我为他们设计的网站在长表格中显示所有条目。分页的论点似乎主要基于显示长表的性能影响，而这在高带宽公司 Intranet 中不太受关注。反对分页的论据包括打印整个表格的能力，对整个表格进行字符串搜索，从整个表格中选择任意范围进行复制等。我已经指出，这些功能可以很容易地添加到分页网页设计中（例如打印整个表格的打印按钮，或创建表格的 CSV 文件的按钮），但分页输出对他们来说似乎仍然不方便。我们的典型表大约有 100 到 600 个项目。显然，可能需要对明显更大的表进行分页。

**问题：**

1.  您对长表中分页输出与完整输出的个人或客户偏好有何经验？
2.  网页设计工具似乎正在推动分页范式。他们是脱节了，还是我的客户不寻常？
3.  如果你在想“这取决于桌子的长度”，你会使用什么阈值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T20:05:48.827

1.  我喜欢一页长的列表。我可以看到分页列表的少数原因之一是您指出的有关性能的原因。

2.  我认为您的客户非常平常且保持联系。

3.  阈值与页面加载时间有关。当服务器无法足够快地生成完整列表或列表变得太长以至于浏览器变慢时。（如果您的 CSS 中有非标签悬停内容并且浏览器是 IE，则后者可能发生在相当短的列表中。）

给用户一个强大的搜索功能，他们会自己缩小他们的页面列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T20:04:46.427

为什么不简单地让它成为用户可配置的选项。听起来你打算基本上实现两者。

老实说，我认为无论您选择哪个，都会有人抱怨。至少它是用户可配置的，你有能力把它放回用户身上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T23:03:30.823

提供默认页面长度和可配置参数（例如，在查询字符串中供编程使用，和/或网页上的表单供交互使用）来控制页面中有多少列表。

用户灵活性好。德州仪器 (TI) 有一个参数搜索工具供电气工程师查找符合特定技术特性的 IC，其中包含一个链接，既可以在网页中“显示全部”，也可以“下载全部”为 .csv 文件。这是一个很好的模型，TI 的荣誉。flickr 同上；他们的 API 允许您（在很大程度上）控制在 Web 服务调用上显示多少结果。

我个人讨厌默认为每页 10 个列表而无法增加它的网站。浏览它们需要永远的时间，如果我能一次得到所有的东西，我愿意等待更长的时间。

如果它是一个交互式网页，我会考虑使用一次下载 100 个的 AJAX 解决方案，以便显示进度（如果有 20000 个结果，用户可以停止它）。

我同意 PEZ，这完全取决于响应能力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T20:05:00.013

最佳解决方案：不要提供超过 100 项的列表。

通常您的用户不想阅读超过 100 甚至 600 条内容。他们只是不在乎。他们正在寻找一个（或可能几个）。确保他们有一种方法可以在不通过列表进行[视觉 grep 的情况下访问这些项目。](http://www.jargondb.org/glossary/vgrep)

如果您的客户坚持显示所有项目，则提供具有可配置页面大小的分页，如果他愿意，让他输入“每页 100000 个项目”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T20:09:52.203

一本关于网页设计的开创性书籍（对不起，我忘记了哪一本）曾经说过不要指望你的用户向下滚动，因为他们中的大多数人不知道如何或不能被打扰。我认为最近的更新表明，虽然对于公众来说确实如此，但可以预期某些技术含量更高的用户会向下滚动，并且您可以制作需要滚动的页面 IFF（如果且仅当）您知道您的用户可以处理它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T20:10:00.877

我非常了解你的情况。我也遇到过类似的情况。我将业务工作流程从人工管理转变为自动化。最初它是使用 excel 电子表格进行的。我的软件的利益相关者年龄在 55 岁以上，他们不喜欢任何 ajaxy 或您所说的任何 UI 模式。在这种情况下，可以优化数据检索逻辑。从性能的角度来看，任何触及 1K 标记或具有图像 blob 之类的项目或类似内容的表格都应部分显示。

1.  长输出缓慢渲染并将成为性能水蛭
2.  大多数时候客户都不想改变，除非你能说服他们，否则客户永远是对的。
3.  我已经提出了我的门槛，但这也取决于行的内容。

快乐编码！

# html - 可以进行真正的 HTML 调试吗？

> ID：387183
> 
> 赞同：17
> 
> 时间：2008-12-22T20:01:23.640
> 
> 标签：html, debugging

我已经做了很长一段时间的网络开发人员，帮助我学习的是直观地看到正在发生的事情。

这就是 Aardvark、Web 开发人员、Firebug 和许多其他工具的原因。

但是当我看到[Gecko Reflow 视频](http://redivide.com/blog/gecko-reflow-awesome-visualization-of-web-page-layout/)时，它们让我大吃一惊。

那么我的问题是，是否有可能真正调试 html（逐步检查每个元素）？还是靠近它？

我一直在做很多事情是使用 Aardvark 并删除元素，但 Aardvark 在“背景”和相同大小的元素方面存在问题，并且无法针对这些元素。

更新：我一直在尝试为这个问题写一个好的更新，因为它让我更多地思考它。但是由于英语不是我的主要语言，所以很难。

在过去的几年里，一直是浏览器承担着与标准兼容的任务。随着他们越来越接近这个目标，我们应该考虑在浏览器兼容性最小的情况下我们可以真正创建什么，以及是否有我们可以利用的技术来更快地呈现页面。

我们可以将过去几十年视为 HTML/CSS 的早期阶段，其主要目标只是让其工作。现在我们应该寻找加速当前过程的技术。上面的视频中就是一个例子，Gecko 引擎在代码中运行了两次。这是为什么？还有其他情况下它会做不必要的事情（即使它们有效且兼容）

这显然需要测试才能确认，因此我最初的问题是真正的调试器。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-22T20:40:46.960

我的 0.02 美元：

就您所说的而言，“真正的” HTML 调试在技术上是不可能的，因为不需要 HTML 用户代理（Web 浏览器）以特定顺序呈现 HTML 元素，也没有像原子单元这样的东西像“声明”一样执行。

例如，在渲染表格时，用户代理是否应该`<tr>`在渲染他们的孩子之前为每个人保留空间`<td>s`（广度优先）？还是应该渲染每个孩子`<td>`和每个`<td>s`孩子等等（深度优先）？在实践中，用户代理会做出各种猜测以尽可能快地呈现页面。换句话说，不能保证调试顺序会匹配实际的渲染顺序，也不应该有。

从这个意义上讲，HTML 可以被认为是一种声明性语言，因为它指定了应该做什么（按照规范呈现的页面），但不具体说明如何去做（确切地将元素呈现到屏幕上的顺序）。一般来说，最好假设一切都是同时发生的，尽管[W3C 确实](http://www.w3.org/TR/html401/appendix/notes.html#h-B.5.1.2)`<table>`根据用户代理*应该*如何渲染`<table>`元素提供了一些加速渲染的技巧。

IMO、webdev 工具栏和 Firebug 是我们所拥有的最好的，我们可以在其中编辑/禁用特定的 HTML 元素和 CSS 规则。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T20:26:08.317

好的 - 认真的回答。

从我从该链接关注的网站上的评论来看，我认为您和我都知道可能没有。这些线程上有很多聪明的家伙和笨蛋，他们都接缝指向“不，这都是聪明的 4 美元！# 这不会帮助我们理解渲染。

但是，我认为您的问题可能要强调的是，在浏览器级别进行渲染非常有趣。

让我把这个扔出去。您是否认为将`body { overflow: scroll; }`其设置为默认值可能会加快我们的速度？？？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-01T04:58:30.487

In my professional opinion, there's really only one effective tool for time-factoring / assessing / debugging within the html milieu: [The WebDev Iterator](http://goo.gl/7wg7)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T21:10:52.533

就个人而言，我觉得只要您的 HTML 符合 W3C 规范，这不是最重要的吗？人们应该开发他们的 HTML 来规范，让浏览器公司担心他们的错误（这在当今非常罕见），而不是专注于过去的旧浏览器错误。

[Firefox 的 HTML Validator 插件](https://addons.mozilla.org/en-US/firefox/addon/249)（又名 Tidy）是任何 Web 开发人员都需要查看他们的标记是否正确、哪里出错以及哪里出错了。

即使您可以进行真正的调试，每个浏览器都会以自己的方式解析 HTML，因此即使您可以逐步通过 Firefox 查看呈现错误是如何发生的，这对您使用 IE 或 Safari/Chrome 也没有帮助，因为它们会执行解析以他们自己的方式。这不像 PHP、.NET 或 Java，其中代码的解析对每个人都是一样的，在那里调试是有意义的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T02:03:37.720

> 那么我的问题是，是否有可能真正调试 html（逐步检查每个元素）？还是靠近它？

您可能可以通过在 gdb 下运行 Firefox 来逐步完成页面呈现过程，或者修改开源浏览器以具有“步骤”按钮，但我真的怀疑这会带来什么有用的东西。

CSS 并不复杂，一切基本上都是一个盒子，有一个宽度/高度/填充/边距。Web 开发（尤其是 CSS）的问题是每个浏览器实现渲染的方式略有不同（有些比其他浏览器更不同）..

如果您想知道渲染顺序以加快页面加载速度，我会说您这样做是错误的。渲染页面的浏览器可能占加载时间的 5%，其余的是页面生成时间和网络延迟。

您可以通过重新排序一些标签并使用不同的 CSS 定位方法来减少 2 毫秒的页面加载时间。或者您可以通过缓存将页面生成时间减少 200 毫秒，并通过在更近的位置设置第二个网络服务器来减少一半的网络延迟您的用户.. 更好地压缩您的徽标或缩小您的 javascript 很可能会提高加载时间（普遍适用于所有浏览器！）

基本上，如果您担心加载时间，有*更好*的起点。如果您关心页面的呈现方式，Firebug( [-Lite](http://getfirebug.com/lite.html) ) 和[http://browsershots.org](http://browsershots.org)（或一两个虚拟机）就足够了！

# c# - 在 SQL 2005/2008 中转义双引号

> ID：387198
> 
> 赞同：5
> 
> 时间：2008-12-22T20:06:35.640
> 
> 标签：c#, sql, sql-server, full-text-search

我最近添加了一家国际公司，名称为“BLA“BLAHBLAH”Ltd。（双引号是名称的一部分。）

每当用户尝试通过输入“Blah 或其他相关内容来搜索该公司”时，搜索都会失败，并在 SQL Server 中出现语法错误。

我怎样才能避免这种情况，这样搜索就不会失败？

示例 SQL：

```
SELECT c.companyID, c.companyName, c.dateAdded, count(cm.maxID) as NumDirect
    FROM RussoundGeneral.dbo.Company c  
         LEFT JOIN RussoundGeneral.dbo.CompanyMax cm
                ON (cm.companyId = c.companyId and cm.maxID is not null)  
    WHERE CONTAINS ( companyName,  '"BLAH*' )
    GROUP BY c.companyID, c.companyName, c.dateAdded  
    ORDER BY c.companyName ASC 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T20:22:58.697

不幸的是，双引号在 FTI 中具有特殊含义，因此即使您对其进行参数化，FTI 引擎也会将其视为短语分隔符。我不确定是否有一种简单的方法可以在 FTI 搜索中包含双引号。方括号也是一个特殊字符，但可以用引号括起来以视为查询术语 - 但不是 AFAIK 双引号。

**更新**

一些搜索表明将引号加倍“”可能会解决它 - 值得一试。就个人而言，我会在数据库中执行此操作，因为这是一个 TSQL 实现细节。

同样，在传递给 FTI 之前，需要将 ' 加倍为 ''（与 TSQL 转义完全分开），

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T20:14:19.010

使用参数化查询，所有引用问题都将消失。

编辑：如果您不允许他们在 CONTAINS 中输入多个单词，请通过删除引号来清理参数。无论多词搜索如何，通过删除引号来清理输入无论如何都可以工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T20:12:50.590

我强烈怀疑您正在动态构建 SQL - 例如

```
// Bad code, do not use!
string sql = "SELECT * FROM Foo WHERE X LIKE '" + input + "%'"; 
```

这是一个非常非常糟糕的主意，原因有很多——最明显的是[SQL 注入攻击](http://xkcd.com/327/)。请改用参数化 SQL 语句，在其中单独指定参数。

[查看带有sql-injection 标记](https://stackoverflow.com/questions/tagged/sql-injection)的问题的各种答案，以了解如何正确执行此操作的示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T21:34:50.923

这是一个理论上的答案，但也许会有所帮助。简短的版本是“在查询中使用参数”，但它有助于理解完整的细节。

在标准 SQL 中，字符串用单引号括起来，嵌入的单引号用一行中的两个单引号表示：

```
SELECT * FROM SomeWhere
    WHERE SomeThing = 'He said, "Don''t do it!"'; 
```

在某些 SQL 方言中，您可以改为用双引号关闭字符串；然后，您需要将双引号加倍以嵌入双引号的单个实例：

```
SELECT * FROM SomeWhere
    WHERE SomeThing = "He said, ""Don't do it!""'; 
```

从问题中不清楚公司名称是否包括外部双引号以及中间双引号，或者它是否只包含中间双引号。但是，原则上，规则是相同的。假设所有三个双引号都是必需的，并在 SQL 中使用单引号 - 在这种情况下更容易：

```
SELECT c.companyID, c.companyName, c.dateAdded, count(cm.maxID) as NumDirect
    FROM RussoundGeneral.dbo.Company c  
         LEFT JOIN RussoundGeneral.dbo.CompanyMax cm
                ON (cm.companyId = c.companyId and cm.maxID is not null)  
    WHERE CONTAINS ( companyName,  '"BLAH "BLAHBLAH" Ltd.' )
    GROUP BY c.companyID, c.companyName, c.dateAdded  
    ORDER BY c.companyName ASC; 
```

使用双引号：

```
SELECT c.companyID, c.companyName, c.dateAdded, count(cm.maxID) as NumDirect
    FROM RussoundGeneral.dbo.Company c  
         LEFT JOIN RussoundGeneral.dbo.CompanyMax cm
                ON (cm.companyId = c.companyId and cm.maxID is not null)  
    WHERE CONTAINS ( companyName,  """BLAH ""BLAHBLAH"" Ltd." )
    GROUP BY c.companyID, c.companyName, c.dateAdded  
    ORDER BY c.companyName ASC; 
```

如果您正在使用编程语言构建字符串，那么您必须担心这些引号会超出您的编程语言中对字符串进行评估的任何内容。例如，如果您在 C 中构建字符串文字，则必须使用反斜杠转义双引号：

```
static const char sql_stmt[] =
"SELECT c.companyID, c.companyName, c.dateAdded,\n"
"       COUNT(cm.maxID) AS NumDirect\n"
"    FROM RussoundGeneral.dbo.Company c\n"
"         LEFT JOIN RussoundGeneral.dbo.CompanyMax cm\n"
"                ON (cm.companyId = c.companyId AND cm.maxID IS NOT NULL)\n"  
"    WHERE CONTAINS(companyName,  \"\"\"BLAH \"\"BLAHBLAH\"\" Ltd.\")\n"
"    GROUP BY c.companyID, c.companyName, c.dateAdded\n"
"    ORDER BY c.companyName ASC"; 
```

另一方面，如果您从用户那里读取数据 - 例如公司名称，那么您只需确保正确引用读取的内容。

那些说“使用参数”的人是对的——它更容易、更可靠并且更不容易受到 SQL 注入攻击（如果你还没有看到，请参阅[XKCD ）。](http://xkcd.org/327/)但是，如果您了解基本原理，则可以适应系统的实际要求。

最后说明：在标准 SQL 中，双引号包含“分隔标识符”。也就是说，双引号包含一个名称，该名称必须被视为数据库中某物的名称，而不是字符串文字。在 MS SQL Server 中，[方括号] 具有相同的用途；括号之间是列的名称或数据库中的任何内容。许多系统比这更灵活。并非所有系统在偏离标准的方式上都是相同的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T20:33:21.907

你试过用它的ASCII码代替这个字符吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T20:38:06.280

尝试使用转义关键字：

```
SELECT c.companyID, c.companyName, c.dateAdded, count(cm.maxID) as NumDirect 
FROM RussoundGeneral.dbo.Company c          
LEFT JOIN RussoundGeneral.dbo.CompanyMax cm 
ON (cm.companyId = c.companyId and cm.maxID is not null )  
WHERE CONTAINS ( companyName,  '\"BLAH*' ) escape '\'
group by c.companyID, c.companyName, c.dateAdded  ORDER BY c.companyName ASC 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T21:15:38.980

应该是这样的

```
string sqlCommand = "SELECT c.companyID, c.companyName, c.dateAdded, count(cm.maxID) as NumDirect FROM RussoundGeneral.dbo.Company c LEFT JOIN RussoundGeneral.dbo.CompanyMax cm ON (cm.companyId = c.companyId and cm.maxID is not null ) WHERE CONTAINS ( companyName,  '@strVal' ) group by c.companyID, c.companyName, c.dateAdded ORDER BY c.companyName ASC"
SqlCommand command = new SqlCommand(strSQLCommand, conn); 
SqlCommand.Parameters.AddWithValue("@strval", SearchTextBox.Text); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T07:22:40.643

您最终必须从数据库中提取数据并将其显示在屏幕上或打印在报告上。操作双引号或任何额外的字符会变得非常混乱。

通过在插入或更新之前将字符串转换为 HTML，您可以避免与引号管理相关的所有混淆。在 SELECT 时，很容易从 HTML 转换回来。在报告时（因为报告工具（例如 Crystal Reports）提出了 HTML 格式选项），您甚至不需要做任何事情来以正确的方式显示数据。

顺便说一句，别忘了把发明这个公司名字的人挂起来。

# sql-server-2005 - 新项目 sql server 2005 或 2008

> ID：387217
> 
> 赞同：4
> 
> 时间：2008-12-22T20:12:49.263
> 
> 标签：sql-server-2005, sql-server-2008

我将开始一个新项目（asp.net），我将使用 sql server express。有理由不使用 sql server 2008 吗？

PS：我一直在考虑 Postgres 8.3，直到我做了一些基准测试并发现 sql server 2005 express 对我的需求来说要快得多（我猜是更好的集成）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T20:53:56.123

如果在没有遗留兼容性问题的 SQL Server 2005 和 SQL Server 2008 之间进行选择，您可能应该选择 SQL Server 2008。从 2005 年到 2008 年的跳跃比从 2000 年到 2005 年的跳跃要小得多，而且您可以多获得三年免费为您的应用程序提供生命周期。[这篇 Stackoverflow 帖子](https://stackoverflow.com/questions/189831/should-we-upgrade-to-sql-server-2005-or-2008)中提出了一个类似的问题，并对该主题进行了更深入的讨论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T20:52:16.860

您可能没有考虑过的一个原因：生产托管位置是否支持 SQL Server 2008？

否则没有理由。事实上，如果您仍然坚持使用 SQL Server 2005，那么您应该使用 2008 版的管理工作室！仍然适用于较旧的数据库

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T21:24:48.993

我更喜欢 Sql Server 2008，因为有太多“杀手级”增强功能，例如表值参数、合并语句、动态加密、新的日期时间参数等。表值参数是一种救命改进。如果您曾经不得不处理多行插入操作，您就会知道使用 xml 节点或 openxml 方法来做这件事是多么痛苦。另一方面，您可以将递归数据表作为参数 ( SqlDbType.Structured ) 传递，痛苦就消失了。很明显，对我来说最令人兴奋的功能是新的表值参数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T22:25:04.613

作为旁注：DiscountASP 以相同的价格在 SQL2005 上出售 300Mb，在 SQL2008 上出售 500Mb。因此，事实证明，SQL2005 处于被视为“旧遗留”软件的状态路径上。

跳过未来的迁移总是好的。

我会选择 SQL2008。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T20:20:46.720

我目前正在为我的开发机器使用 SQL Server 2008 Express。您可以使用新的 T-SQL 并节省一些编写这些存储过程的好时间。我安装了[这个](http://www.microsoft.com/downloads/details.aspx?FamilyId=B5D1B8C3-FDA5-4508-B0D0-1311D670E336&displaylang=en)版本的 SQL Server 2008 Express。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T21:29:17.253

这取决于很多因素：

*   您会向客户出售可安装的副本吗？如果是这样，您的客户人口统计有什么样的数据库引擎？2000？2005 年？2008 年？
*   你要自己主持吗？如果是这样，请使用您喜欢的任何内容
*   您要使用第 3 方托管公司吗？如果是这样，他们支持什么，费用是多少？

除非您明确要使用 2008 的功能，否则我不会太担心它，因为通用 T-SQL 适用于所有版本。当您开始使用新功能时，您可能会遇到麻烦。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T07:05:24.440

更新：似乎他们确实允许使用 sql server 2008（销售人员不太擅长技术），所以我将使用 sql server 2008。

好吧，我问了我的主机（我有一个 vps），他们只允许 sql server 2005 express，不允许 sql server 2008 express（这有点奇怪）。所以我现在就选择2005年......谢谢大家的意见。

# ruby-on-rails - 在 Rails 中为 to_xml 序列化程序设置新的默认属性

> ID：387223
> 
> 赞同：0
> 
> 时间：2008-12-22T20:14:27.153
> 
> 标签：ruby-on-rails, xml-serialization

在 Rails 中，我编写了一系列控制器来生成 XML。每次我将一些属性传递给 to_xml 时，例如：

```
to_xml(:skip_types => true, :dasherize => false) 
```

有没有办法可以将这些设置为新的默认属性，每当在我的应用程序中调用 to_xml 时都会应用这些属性，这样我就不必重复自己了？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T20:45:49.120

您是在散列或 ActiveRecord 模型（或其他）上调用 to_xml 吗？

我不是你想要的，但你可以轻松地修补 to_xml 并重新定义它以从这些参数开始。我建议您创建一个新方法 to_default_xml，只需使用您想要的参数调用 to_xml

```
def to_default_xml
  self.to_xml(:skip_types => true, :dasherize => false)
end 
```

更新：

由于您想将它添加到几个 ActiveRecord 模型中，您可以做两件事，打开 ActiveRecord::base （有点老套和脆弱）或创建一个模块并将其导入您要使用的每个模型中。多一点打字，但更干净的代码。

我会在 lib/ 中放置一个看起来像这样的类：

```
module DefaultXml
  def to_default_xml
    self.to_xml(:skip_types => true, :dasherize => false)
  end
end 
```

然后在你的模型中：

```
class MyModel < ActiveRecord::Base
  include DefaultXml
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-28T23:26:05.063

我整理了一个插件来处理默认的序列化选项。在 github.com/laserlemon/dry_serial/tree/master 上查看。

```
class MyModel < ActiveRecord::Base
  dry_serial :skip_types => true, :dasherize => false
end 
```

它还支持多种序列化样式，可以这样调用：

```
@my_model.to_xml(:skinny)
@my_model.to_xml(:fat) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-11T17:39:24.367

假设您正在谈论 AR 的 to_xml 方法，并且根据您的需要，您可以通过创建一个名为 lib\class_extensions.rb 的文件来扩展 AcitveRecord 类

```
class ActiveRecord::Base   
   def to_xml_default
      self.to_xml(:skip_types => true, :dasherize => false)
   end
end 
```

接下来，将其放入初始化程序中，以便在 Rails 启动时包含它：

```
require 'class_extensions' 
```

现在，您可以按如下方式使用它（无需在每个模型中专门包含它）：

```
MyModel.to_xml_default 
```

# html - Outlook Express 无法识别 *一些* HTML 电子邮件

> ID：387229
> 
> 赞同：1
> 
> 时间：2008-12-22T20:17:28.397
> 
> 标签：html, email, outlook

我将 HTML 电子邮件用于客户的时事通讯。不使用 HTML 邮件**不是**一种选择。我使用 PHPMailer 进行邮件发送，但我也尝试过直接使用 PHP 的 mail() 函数。在这两种情况下，我都会遇到下面描述的相同问题。我尝试过发送多部分以及仅发送 HTML 版本。

在我尝试过的每个电子邮件客户端中，电子邮件都可以正常到达。我的意思是电子邮件被识别为 HTML 电子邮件并呈现内容。**Outlook Express**上的某些帐户除外。我无法辨别为什么它适用于某些人以及为什么它不适用于其他人（全部使用 Outlook Express）。我已将 HTML 电子邮件转发到此帐户（来自 gmail 和 Outlook Express），它们显示得很好。所以 Outlook Express 版本绝对能够显示 HTML 电子邮件。

现在，在这些失败的情况下，Outlook Express 会忽略邮件标题的重要部分。我实际上可以看到这一点：当我查看电子邮件的**原始来源**时，它显示了一个粗体部分 - 标题 - 和一个非粗体部分 - 正文。

以下是电子邮件。我已经编辑了一些“个人”部分。

此部分以粗体显示，被 Outlook Express 识别为标题：

```
DomainKey-Status: no signature
Received: (qmail xxxx invoked by uid xxx); 22 Dec 2008 21:04:33 +0100
To: xxxxxxxxxxxxxxxxxx
Subject: Test
Date: Mon, 22 Dec 2008 21:04:33 +0100 
```

而这部分不是粗体，而是显示在 Outlook Express 的邮件内容面板中。

```
From: Root User <xxxxxxxxxxxxxxxxxxxxxx>
Message-ID: <xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx>
X-Priority: 3
X-Mailer: PHPMailer (phpmailer.sourceforge.net) [version 2.0.3]
MIME-Version: 1.0
Content-Type: multipart/alternative;
    boundary="b1_cb79043f473b53e87bfa759755fce3ce"

--b1_cb79043f473b53e87bfa759755fce3ce
Content-Type: text/plain; charset = "iso-8859-1"
Content-Transfer-Encoding: 8bit
test

--b1_cb79043f473b53e87bfa759755fce3ce
Content-Type: text/html; charset = "iso-8859-1"
Content-Transfer-Encoding: 8bit
<p>Test</p>

--b1_cb79043f473b53e87bfa759755fce3ce-- 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T18:37:36.117

好的，我想我解决了这个问题。标题中的各行由 \r\n 分隔，显然 Outlook 希望它们仅由 \n 分隔。甚至 PHPMailer 似乎也这样做，所以我现在使用 PHP 的 mail() 函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T14:49:38.073

在第二个 MIME 块中的 HTML 之前添加换行符将解决您的问题。如果需要，您还可以在该块上设置“Content-Disposition: inline”。在我的测试中，我仍然必须在 Outlook Express 中按 Alt+Shift+H，因为出于安全原因，它默认为纯文本。

这是最终的工作 EML：

```
DomainKey-Status: no signature
Received: (qmail xxxx invoked by uid xxx); 22 Dec 2008 21:04:33 +0100
To: xxxxxxxxxxxxxxxxxx
Subject: Test
Date: Mon, 22 Dec 2008 21:04:33 +0100
From: Root User <xxxxxxxxxxxxxxxxxxxxxx>
Message-ID: <xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx>
X-Priority: 3
X-Mailer: PHPMailer (phpmailer.sourceforge.net) [version 2.0.3]
MIME-Version: 1.0
Content-Type: multipart/alternative;
    boundary="b1_cb79043f473b53e87bfa759755fce3ce"

--b1_cb79043f473b53e87bfa759755fce3ce
Content-Type: text/plain; charset = "iso-8859-1"
Content-Transfer-Encoding: 8bit
test

--b1_cb79043f473b53e87bfa759755fce3ce
Content-Type: text/html; charset = "iso-8859-1"
Content-Transfer-Encoding: 8bit
Content-Disposition: inline

<p>Test</p>

--b1_cb79043f473b53e87bfa759755fce3ce-- 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-15T12:15:21.327

尝试改变边界的创建：

```
/* Set the boundaries */
$uniq_id = md5(uniqid(time()));

$this->boundary[1] = '------------01' . $uniq_id; // was started by b1_

$this->boundary[2] = '------------02' . $uniq_id; // was started by b2_

Tomor.cz 
```

编辑：那不是解决方案：：/

但是我发现，如果我通过 smtp 服务器使用 phpmailer 就可以了，当我通过 mail() 函数发送电子邮件时，outlook 中就会出现问题..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-16T09:18:48.373

我发现如果这个问题是在我使用 PHPMailer v 2.3 时出现的。当我升级到 PHPMailer_v5.0.2 时，邮件在 Outlook 中正确显示。

# asp.net - 将焦点放在由 javascript 发起的回发上

> ID：387233
> 
> 赞同：0
> 
> 时间：2008-12-22T20:18:25.010
> 
> 标签：asp.net, javascript

我正在使用 ASP.NET 做一些客户端 javascript。
我有以下 javascript 来处理 XMLHTTPRequest 回调。在某些情况下，页面将被回发，使用 ASP.NET 提供的 __doPostBack() 函数，在下面的代码中列出。但是，我希望能够在回发发生后将焦点设置为下拉列表控件。有没有办法使用 Javascript 进行设置，或者我需要以其他方式进行设置。

```
 function onCompanyIDSuccess(sender, e) {
       if (sender == 0)
           document.getElementById(txtCompanyIDTextBox).value = "";
       document.getElementById(txtCompanyIDHiddenField).value = sender;
       if (bAutoPostBack) {
           __doPostBack(txtCompanyIDTextBox, '');
       }
   } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T20:27:28.250

由于您正在执行完整的回发，因此您需要在服务器端使用[Page.SetFocus](http://msdn.microsoft.com/en-us/library/e04ah0f4.aspx)来获取在下一页加载时发出的适当 JavaScript。

否则，在纯 AJAX 解决方案中 - document.getElementById('id').focus() 可以解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T18:49:16.120

我已经找到了解决方案。在为每个特定项目调用事件处理程序背后的代码中，我将 Control.Focus() 作为最后一行调用。例如，如果触发了下拉列表事件处理程序，并且要获得焦点的下一个控件是邮政编码文本框：

```
protected void ddl_state_selectedValueChanged(Object sender, EventArgs e)
{
    // ... here is all my code for the event handler

    txtZipCode.Focus();
} 
```

我想要做的事情要容易得多。我一直试图通过动态创建 Javascript 来使事情变得过于复杂，这正是微软已经在框架中为我做的事情。

# c++ - 无法编译 FSM 示例代码

> ID：387234
> 
> 赞同：1
> 
> 时间：2008-12-22T20:19:50.000
> 
> 标签：c++, state-machine

有一个很好的状态机教程，名为[UML 教程：](http://www.objectmentor.com/resources/articles/umlfsm.pdf) Robert C. Martin 的有限状态机。但我无法编译它提供的示例代码。我得到 *FsmTest.cpp(46) : error C2664: 'SetState' : cannot convert parameter 1 from 'class UnlockedState *' to 'class TurnstileState *'*

请帮忙。谢谢。

```
class Turnstile
{
public:
    virtual void Lock();
    virtual void Unlock();
    virtual void Thankyou();
    virtual void Alarm();
};

class TurnstileFSM;
class LockedState;
class UnlockedState;

class TurnstileState
{
public:
    virtual void Coin(TurnstileFSM*) = 0;
    virtual void Pass(TurnstileFSM*) = 0;
protected:
    static LockedState lockedState;
    static UnlockedState unlockedState;
};

class TurnstileFSM : public Turnstile
{
public:
    void SetState(TurnstileState* s) {itsState = s;}
    void Coin() {itsState->Coin(this);}
    void Pass() {itsState->Pass(this);}

private:
    TurnstileState *itsState;
};

class LockedState : public TurnstileState
{
public:
    virtual void Coin(TurnstileFSM* t)
    {
        t->SetState(&unlockedState);
        t->Unlock();
    }
    virtual void Pass(TurnstileFSM* t)
    {
        t->Alarm();
    }
};

class UnlockedState : public TurnstileState
{
public:
    virtual void Coin(TurnstileFSM* t)
    {
        t->Thankyou();
    }
    virtual void Pass(TurnstileFSM* t)
    {
        t->SetState(&lockedState);
        t->Lock();
    }
};

LockedState TurnstileState::lockedState;
UnlockedState TurnstileState::unlockedState; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T20:30:53.970

问题是当您尝试调用`SetState()`inside of`LockedState::Coin()`时，该类`UnlockedState`是一个**不完整的类型**：它已被*声明*但*未定义*。为了修复它，您需要将 of 的定义移到 of`Coin()`之后`UnlockedState`：

```
class LockedState : public TurnstileState
{
public:
    virtual void Coin(TurnstileFSM* t);
    ...
};

class UnlockedState : public TurnstileState
{
    ...
};

void LockedState::Coin(TurnstileFSM* t)
{
    ...
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T20:28:56.330

这很可能是因为它还不知道 UnlockedState 是 TurnstileState 的子类。从类内部删除函数到文件末尾：

```
class TurnstileFSM {
    void SetState(TurnstileState* s);
};

void TurnstileFSM::SetState(TurnstileState* s) {itsState = s;} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-25T09:33:19.770

在示例中，生成的代码应该包含*tscontext.h*，并且*TurnStyle*类是从上下文中派生的，应该在 *tscontext.h" 中声明为*类 TurnStyleContext*。

在我的情况下，生成的代码如下所示：

```
 #include "tscontext.h"   // the header file name for the context class"

    // Forward Declarations

    class TurnStyle;

    //----------------------------------------------
    // TurnStyleState: The base state class
    //----------------------------------------------
    class TurnStyleState
    {
      public: 
        virtual const char* StateName() const = 0;
        virtual void Coin( TurnStyle& );
        virtual void Pass( TurnStyle& );
    };

    //----------------------------------------------
    // State: Unlocked
    //----------------------------------------------
    class TurnStyleUnlockedState : public TurnStyleState
    {
      public: 
        virtual const char* StateName() const
            { return "Unlocked"; }
        virtual void Pass( TurnStyle& );
        virtual void Coin( TurnStyle& );
    };
    //----------------------------------------------
    // State: Locked
    //----------------------------------------------
    class TurnStyleLockedState : public TurnStyleState
    {
      public: 
        virtual const char* StateName() const
            { return "Locked"; }
        virtual void Coin( TurnStyle& );
        virtual void Pass( TurnStyle& );
    };
    //----------------------------------------------
    // TurnStyle: The Finite State Machine class
    //----------------------------------------------
    class TurnStyle: public TurnStyleContext
    {
      public: 
        // Static State variables
        static TurnStyleUnlockedState Unlocked;
        static TurnStyleLockedState Locked;

        TurnStyle(); // default Constructor

        // Event functions
        virtual void Coin() { itsState->Coin( *this ); }
        virtual void Pass() { itsState->Pass( *this ); }

        // State Accessor functions
        void SetState( TurnStyleState& theState ) { itsState = &theState; }
        TurnStyleState& GetState() const { return *itsState; }

        const char* GetCurrentStateName() const { return itsState->StateName(); }
        const char* GetVersion() const;

      private: 
        TurnStyleState* itsState;
    }; 
```

以这种方式定义状态机：

```
Context TurnStyleContext     // the name of the context class
FSMName TurnStyle            // the name of the FSM to create
Initial Locked               // the name of the initial state
                             // for C++ output
pragma Header  tscontext.h"   // the header file name for the context class, note the necessary "
{
    Locked
    {
        Coin     Unlocked    Unlock
        Pass     Locked      Alarm
    }
    Unlocked <BeforeUnlocked >AfterUnlocked
    {
        Coin    Unlocked    Thankyou
        Pass    Locked      Lock
    }
} 
```

上下文实现*FSMError、Thankyou、Lock、Alarm、Unlock、BeforeUnlocked、AfterUnlocked*

# .net - 我需要帮助设置 .NET HttpWebRequest 超时

> ID：387247
> 
> 赞同：3
> 
> 时间：2008-12-22T20:24:42.890
> 
> 标签：.net, timeout, webrequest

我的目标是在最短的时间内从多达 6000 个网址中得到答案。它运行得非常好（5200 个 LAN 地址需要 12 秒），直到开始出现一些延迟。

我的代码最多同时使用 20 个 HttpWebRequest.BeginGetResponse`ThreadPool.RegisterWaitForSingleObject`用于超时处理。

然而，一些请求（最多 5,000 个中的 4 个）从未在第二个参数 (timedOut) 为 true 的情况下命中 TimeoutCallback 函数，并且它们浪费了我 5 分钟的宝贵时间，直到它们命中 BeginGetResponseCallback 函数然后引发 WebException。异常说类似“操作达到时间限制”，但由于异常消息是葡萄牙语（我的母语），我无法谷歌它。

例如，我想知道是否可以将此时间限制减少到 20 秒。有谁知道怎么做？我已经尝试过：

```
<system.web>
    <httpRuntime executionTimeout="20"/>
</system.web> 
```

但是当我将它作为控制台应用程序运行时，ASP.NET 配置不起作用。我也试过：

```
myHttpWebRequest.Timeout = 20*1000; 
```

和

```
ThreadPool.RegisterWaitForSingleObject(result.AsyncWaitHandle, new WaitOrTimerCallback(TimeoutCallback), AsyncState, 20*1000, true); 
```

没有成功。你能帮助我吗？

**更新** 我想说的是异步 HTTP 请求有 4 种可能的结果：

1.  永远不会到达回调函数 -> 超时回调函数
2.  成功到达并回答
3.  到达并引发异常
4.  恰好延迟 5 分钟，直到在回调函数中引发“时间限制”网络异常

第四种可能性是延迟我的申请，我不知道如何缩短延迟

**更新** 是否有可能是方法`GetResponseStream`而不是`GetResponse`导致超时的人？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T20:40:17.007

听起来您需要设置请求对象的 ReadWriteTimeout 属性。

[http://blogs.msdn.com/buckh/archive/2005/02/01/365127.aspx](http://blogs.msdn.com/buckh/archive/2005/02/01/365127.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-11-26T09:59:44.277

.Timeout = 尝试建立连接所花费的时间（不包括查找时间） .ReadWriteTimeout = 建立连接后尝试读取或写入数据所花费的时间

# java - Java 和 C++ 有什么区别？

> ID：387256
> 
> 赞同：1
> 
> 时间：2008-12-22T20:27:16.410
> 
> 标签：java, c++

Java 和 C++ 有什么区别？两者都是面向对象的吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-22T20:31:22.423

这是一个太笼统的问题，无法在这里回答。

Java 是一种明确的面向对象的语言，去掉了更难使用的部分。

C++ 是一种安全关闭的多范式语言。您可以在其中进行面向对象的编程，以及过程和泛型。

如果您有更具体的问题，我们可以提供更多帮助。你为什么问？如果您想要针对特定​​平台或项目或其他任何内容的建议，我们可能会更加响应。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-22T23:12:24.050

C++ 程序员会告诉你 Java 是垃圾。Java 程序员会告诉你 C++ 是垃圾。因此，我得出结论，它们确实是同一件事。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-22T22:58:18.417

每种语言的设计都考虑了不同的目的，因此 IMO 从一个角度比较两者并忽略另一个是不公平的。

一般来说，C++ 是一个开放标准，旨在实现高性能系统，其中速度和性能和关键，有许多使用这种语言设计的令人印象深刻的项目，如 Phoenix Lander、Adobe Acrobat Reader 等。C++ 使开发人员能够使用非常高级的抽象进行编程——例如使用泛型，并且在需要时深入到机器的裸机——例如处理中断。

Java 的设计考虑了其他目的，当 Sun 计划 Oak（后来称为 Java）时，它专注于 Web 应用程序，因此考虑到这一点，它通过大量易于使用的接口库支持该语言。和使用 JVM 的可移植性（编译一次，在任何地方运行），这可以防止程序员编码到特定的机器，而是编码到沙箱，沙箱反过来在主机上运行代码，这显然对性能/速度有负面影响。

这两种语言的比较是程序员之间争论的热门话题，这是由于它们的工作需求和性质不同，IMO每种语言都犯了错误以使其成熟，例如C++的导出模板，以及Java缺乏程序化编程（大错）。另外，每种语言在不同方面都有其优点和缺点，因此平衡生产力/性能问题的语言是正确的语言。

有关更多信息[Wikipedia 关于 Java 和 C++ 比较的综合文章](http://en.wikipedia.org/wiki/Comparison_of_Java_and_C%2B%2B)

[从这里查看](http://www.lextrait.com/vincent/implementations.html)使用（和正在使用）哪些语言来创建主要系统（如 Google）可能会很有趣。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T21:12:55.977

尚未提及最重要的区别之一 - 一个被编译为机器代码，另一个被编译为由虚拟机解释的字节码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T20:28:49.310

两者都是面向对象的，但它们是非常不同的语言。这可能不是询问差异的最佳论坛......我建议您同时查看维基百科并查看那里的描述。您将能够自己很快地看到差异。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-22T20:36:55.893

我喜欢 c++，但除非您绝对需要使用 c++，否则请使用其他东西。当你需要使用 c++ 时，你就会知道区别，Grasshopper。

（提示不要在 java 中编写设备驱动程序、视频解码器、加密库、3-d 图形引擎或语言运行时引擎）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-22T20:39:33.657

是的，两者都是面向对象的编程语言。

C++ 是对 C 的演变。C 是一种系统编程语言。C++ 为语言添加了许多特性，使其面向对象。由于这个原因，它成为了主流的编程语言。

Java 是 C++ 的演变，具有不同的目标（例如跨平台）。它删除了一些使 C++ 难以学习的特性。简化其他并删除其他。

主要区别在于 C++ 程序直接编译为机器代码（CPU 可以理解），而 Java 程序在大多数情况下被编译为在 JVM 的“虚拟机”中运行。由于这些原因，java 程序被另一个程序解释，并且一开始是非常慢的程序。现在虚拟机可以优化这个代码，让它运行得非常非常快。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-22T21:13:35.490

请参阅此链接。[http://www.javacoffeebreak.com/articles/thinkinginjava/comparingc++andjava.html](http://www.javacoffeebreak.com/articles/thinkinginjava/comparingc++andjava.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-04-27T06:14:32.387

*   Java 中的一切都是对象，因为一切都派生自 java.lang.Object 但在 C++ 中并非如此
*   Java 中没有指针，而 C++ 提供了对指针的支持
*   java 中没有析构函数（Java 有自动垃圾回收），但 C++ 有析构函数来做到这一点
*   线程支持是在 Java 中构建的，但不是在 C++ 中
*   Java中没有范围解析运算符
*   Java中没有Goto语句
*   Java 中不允许多重继承，但 C++ 允许
*   Java 中不允许运算符重载，但 C++ 允许
*   Java 大部分是解释的，因此与平台无关

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-22T21:14:02.463

粗略但准确的过度简化：Java 更容易。C++ 更快。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-22T21:53:05.677

只是对 David Thornley 发布的内容的快速补充。C++ 是一种支持对象和面向对象设计的过程语言。Java 是纯 OO。Java 做得更少，但做得更多。

# visual-studio - 这台笔记本电脑对 Visual Studio 是否足够好？

> ID：387259
> 
> 赞同：3
> 
> 时间：2008-12-22T20:28:15.393
> 
> 标签：visual-studio, performance, hardware

对于 HP 2133 迷你：

*   1.2GHz CPU
*   1 GB 内存
*   视窗
*   5400 转硬盘

我打算安装 Visual Studio 2005（假设它比 2008 快）。我已经看到了[https://stackoverflow.com/questions/8440/visual-studio-optimizations](https://stackoverflow.com/questions/8440/visual-studio-optimizations)问题，所以我会将这些问题考虑在内。

但是您认为 Visual Studio 2005 会以可接受的速度使用此硬件吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T20:35:27.190

编译时会有点迟钝，否则应该没问题。不过我建议多一点内存。现在它很便宜，从 1GB 升级到 2GB 确实会产生影响，特别是如果你还在后台运行其他程序。

另外，那么你可能会考虑[这个](https://stackoverflow.com/questions/354254/ramdrive-for-compiling-is-there-such-a-thing)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T20:35:39.983

这取决于您所说的*可接受*。以我的经验，7200RPM 硬盘驱动器将提高 VS.NET 2005 的性能速度，因为它是一个 IO 密集型应用程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T20:36:41.400

这取决于您打算在笔记本电脑上处理的项目类型。Visual Studio 肯定会运行得很好（2-4 GB 的 RAM 会更好），但如果你有大型解决方案，你会看到一些性能下降。此外，可接受的速度在旁观者的眼中。这可能会让我发疯，但其他人可能对那台机器没问题。

另外，请在此处查看 Scott 的帖子：

[http://weblogs.asp.net/scottgu/archive/2007/11/01/tip-trick-hard-drive-speed-and-visual-studio-performance.aspx](http://weblogs.asp.net/scottgu/archive/2007/11/01/tip-trick-hard-drive-speed-and-visual-studio-performance.aspx)

高温高压

科尔比非洲

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T22:06:13.653

Scott Hanselman has a [good post about using netbooks](http://www.hanselman.com/blog/DellMini9PracticalDevelopersReview.aspx) for Visual Studio development. His post specifically covers the Dell mini, but a lot of what he says applies to other netbooks as well.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T20:37:36.407

That laptop is probably pushing the lower limit of "good enough". If you're writing a resource intensive app, it probably will be pretty slow when you're debugging. For a web site, you'll probably only slow down when the IDE is doing something intensive.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T20:32:20.690

一切都与屏幕尺寸有关。任何小于 14/15（英寸）的东西都不能使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T20:51:41.557

I would go for at least 2gb of RAM and a descent screen size, I agree with StingyJack and wont go for anything less than 15"

The requirements of VS 2005 is one thing, but keep in mind that you will probely use servel other applications at the same time.

My laptop has a 17" screen, it works but at times i still miss the 22" wide screen I use at work.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T21:40:27.997

add memory

as much as you can get.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-22T22:03:32.223

Great answers, I'll add more RAM (as mentioned they are really cheap). I'm restricted with the monitor so it'll be 8.9 :)

The idea is I'll use this laptop do some presentation around, and If I need to debug or hack it on the way I should able to do it. There won't be any actual development other than, small hacks (hopefully!).

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-22T23:33:04.570

a 4:3 ratio screen will be much better then a 16:9, you will have much more vertical space

# javascript - 用 Greasemonkey 删除图像？

> ID：387260
> 
> 赞同：4
> 
> 时间：2008-12-22T20:28:17.127
> 
> 标签：javascript, greasemonkey

我想停止加载图像，因为甚至没有机会下载，使用greasemonkey。现在我有

```
var images = document.getElementsByTagName('img');

for (var i=0; i<images.length; i++){
    images[i].src = "";
} 
```

但我不认为这实际上会阻止图像下载。有人知道如何阻止图像加载吗？

感谢您的时间和帮助:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T20:51:35.613

如果您想禁用所有网站的图像下载（我猜您可能没有这样做）并且正在使用 Firefox，为什么不在首选项中禁用它们呢？转到内容选项卡并关闭“自动加载图像”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T21:19:11.127

几乎所有图像都没有下载。所以你的脚本几乎可以正常工作。

我已经测试了以下脚本：

```
// ==UserScript==
// @name           stop downloading images
// @namespace      http://stackoverflow.com/questions/387388
// @include        http://flickr.com/*
// ==/UserScript==

var images = document.getElementsByTagName('img');
for (var n = images.length; n--> 0;) {
  var img = images[n];
  img.setAttribute("src", "");
} 
```

使用专用扩展来管理图像（例如[ImgLikeOpera](https://addons.mozilla.org/en-US/firefox/addon/1672)）。

如果您想在所有浏览器上过滤图像，那么具有过滤功能的代理可能会有所帮助，例如[Privoxy](http://www.privoxy.org/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T20:53:13.677

我相信greasemonkey脚本是在页面加载后执行的，所以我猜图像也被加载了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T21:18:27.290

我知道这不是油脂猴，但您可以尝试“IMG Like Opera”扩展。它绝对可以防止文件下载，并且比仅开/关具有更大的灵活性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T04:15:01.927

不完全相关，但我使用这段代码在 EasyGestures 插件中切换 Firefox 中图像的显示。我不确定这是否可以翻译成greasemonkey，但这可能是一个起点。

```
var prefs = Components.classes["@mozilla.org/preferences-service;1"].
            getService(Components.interfaces.nsIPrefBranch);
var nImgPref = prefs.getIntPref("permissions.default.image");
if (nImgPref == 1) {
  prefs.setIntPref("permissions.default.image",2)
  alert('Images off.');
} else {
  prefs.setIntPref("permissions.default.image",1)
  alert('Images on.');
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T20:35:06.503

你知道图片还在加载吗？也许你应该使用 Firebug 或类似的东西来断言它？

# c++ - C++ 中的单元测试

> ID：387272
> 
> 赞同：22
> 
> 时间：2008-12-22T20:32:56.447
> 
> 标签：c++, unit-testing

如何开始在 C++ 中进行单元测试？

我在 Java 编码时使用过 Junit，发现它非常有用。C++ 中有类似的东西吗？你有什么建议吗 ？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-22T20:40:59.287

以下是您可能想要查看的类似问题：

*   [C++ 代码的单元测试 - 工具和方法](https://stackoverflow.com/questions/91384/unit-testing-for-c-code-tools-and-methodology)

*   [C++ 单元测试框架](https://stackoverflow.com/questions/87794/c-unit-testing-framework)

除了 CppUnit 之外，我建议您查看[Google 的单元测试框架。](http://code.google.com/p/googletest/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-07-19T16:49:23.863

我最近写了一个由 5 部分组成的系列博客文章，涵盖了在 C++ 中使用 boost 进行单元测试。它提供了有关如何在 Visual Studio 中执行此操作的分步说明。

*   [第 1 部分](http://legalizeadulthood.wordpress.com/2009/07/04/c-unit-tests-with-boost-test-part-1/)：如何开始使用 Boost.Test 在 C++ 中进行单元测试。

*   [第 2 部分](http://legalizeadulthood.wordpress.com/2009/07/05/c-unit-tests-with-boost-test-part-2/)：Boost.Test 在演示测试驱动开发的简单编程练习的上下文中提供的断言框架。

*   [第 3 部分](http://legalizeadulthood.wordpress.com/2009/07/05/c-unit-tests-with-boost-test-part-3/)：继续进行测试驱动开发以完成 PrimeFactors::Generate 方法的功能。

*   [第 4 部分](http://legalizeadulthood.wordpress.com/2009/07/05/c-unit-tests-with-boost-test-part-4/)：测试驱动的 UI 开发。

*   [第 5 部分](http://legalizeadulthood.wordpress.com/2009/07/05/c-unit-tests-with-boost-test-part-5/)：Boost.Test 中用于在测试之间共享通用设置和拆卸操作并将测试组织成套件的工具。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-22T20:35:43.680

检查[CppUnit](http://apps.sourceforge.net/mediawiki/cppunit/index.php?title=Main_Page)，它是 C++ 的 jUnit 端口。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-23T03:15:44.013

[UnitTest++](http://unittest-cpp.sourceforge.net/)，传说 UnitTest++ 是由这个单元测试框架[比较的作者编写的。](http://gamesfromwithin.com/?p=29)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-22T20:40:34.700

[很好的](http://gamesfromwithin.com/?p=29)总结。

我们使用[Boost.Test](http://www.boost.org/doc/libs/1_37_0/libs/test/doc/html/index.html)，我们能够很好地跨平台持续集成。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-22T20:40:57.413

看看这个页面：[http ://gamesfromwithin.com/?p=29](http://gamesfromwithin.com/?p=29)

它是 C++ 框架的最佳比较。我个人更喜欢 Boost.Test。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-23T03:19:33.490

我对任何 C++ 单元测试框架都不满意。由于 C++ 没有反射，因此很难编写方便的单元测试工具。 [CxxTest](http://cxxtest.com/index.php?title=Main_Page)和我发现的一样好。我在一些项目中使用过它，但通常我只是在没有框架的情况下编写自己的测试，或者使用我自己编写的粗略框架。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-29T07:22:37.050

我刚开始使用 googletest ( [https://github.com/google/googletest/](https://github.com/google/googletest/) )。它易于集成，我没有遇到任何问题。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-22T20:42:23.557

我个人最喜欢的是TUT。两个主要原因是 1）它不会强迫你使用 Java 主义，而是利用 C++ 的优势，以及 2）你可以控制它，编写可执行文件（我有一个我使用的模板），报告等（默认提供基于流的版本）。

对我来说，它非常遵循 KISS 的哲学，2 个标头，没有宏，没有解析器，只是简单的旧 C++ 代码和一点点骨架代码。

[http://tut-framework.sourceforge.net/](http://tut-framework.sourceforge.net/)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-12-28T03:07:54.630

我刚刚推出了我自己的框架[CATCH](http://www.levelofindirection.com/journal/2010/12/28/unit-testing-in-c-and-objective-c-just-got-easier.html)。它仍在开发中，但我相信它已经超越了大多数其他框架。不同的人有不同的标准，但我试图在没有太多权衡的情况下涵盖大部分内容。请查看我的链接博客条目以供品酒师使用。我的前五个功能是：

*   仅标题
*   基于功能和方法的测试的自动注册
*   将标准 C++ 表达式分解为 LHS 和 RHS（因此您不需要一整套断言宏）。
*   支持基于功能的夹具中的嵌套部分
*   使用自然语言命名测试 - 生成函数/方法名称

它还具有 Objective-C 绑定。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-22T20:38:47.353

在不知道您针对的是哪个平台/编译器的情况下，我只能提出一般性建议。我过去非常成功地使用过[这个](http://cpptest.sourceforge.net/)（CppTest）。有一个名为[UnitTest++](http://unittest-cpp.sourceforge.net/)的简单框架，看起来很有趣。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-23T08:26:28.283

[Aeryn](http://aeryn.tigris.org/)是另一个值得一看的 C++ 测试框架

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-12T22:17:47.500

看看[CUnitWin32](http://code.google.com/p/cunitwin32/)。它包括一个例子。

# .net - 如何正确实现 Office COM 加载项的 IDTExtensibility2 接口？

> ID：387277
> 
> 赞同：4
> 
> 时间：2008-12-22T20:35:13.290
> 
> 标签：.net, outlook, office-interop, comaddin

我正在为 Outlook 实施 COM 加载项。我使用 IDTExtensibility2。我不确定这是否是执行 COM 加载项的最佳方式，但我无法改变这一点。

该接口定义了五个方法：OnConnection、OnStartupComplete、OnAddInsUpdate、OnBeginShutdown、OnDisconnection。

我需要执行以下操作：

1.  从文件加载配置数据
2.  加载注册表数据
3.  开始新会话
4.  创建 *.pst 文件
5.  订阅资源管理器事件
6.  连接到 Internet 服务器以获取一些数据
7.  在主菜单中创建菜单项
8.  创建工具栏
9.  在 Outllok 中添加/删除一些东西（在 *.pst 文件级别）

请指教，我应该什么时候做？

*   我需要在 OnConnection 方法中执行什么操作？
*   只有在 OnStartupComplete 调用时才允许什么？
*   在 OnBeginShutdown / OnDisconnection 期间我需要释放哪些资源？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T22:04:58.227

请注意，1,2 和 6 不是 Outlook 插件特定的任务。

不需要 3：作为插件，您无需创建会话 - 您可以与现有会话连接（通过实现该`OnConnection`方法）。

对于 4 和 9，我建议使用 RDO：[http](http://dimastr.com/redemption/) ://dimastr.com/redemption/ （如果您真的需要另一个会话，也可以用于 3）

对于 5,7 和 8，我建议使用 ADX： http: [//www.add-in-express.com/add-in-net/](http://www.add-in-express.com/add-in-net/) （如果您这样做，您
实际上根本不必担心）`IDTExtensibility2`

`OnConnection`是您获取对`Application`接口的引用的地方，您可以从中获取其他所有内容。

`OnStartupComplete`是您可以放置​​所有初始化代码的地方。

`OnDisconnection`是您应该释放您在会话期间可能积累的所有剩余 OOM 引用的地方，即源自`Application`您通过`OnConnection`.

# visual-studio - 数据生成计划错误

> ID：387301
> 
> 赞同：1
> 
> 时间：2008-12-22T20:42:37.207
> 
> 标签：visual-studio, data-generation

当我尝试运行数据生成计划时，我收到以下错误，但没有要删除的列。

列 XXXXX 已被删除，并且之前已选择用于数据生成。

对此错误的任何帮助将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-08T03:03:34.843

我从来没有遇到过这个错误，但似乎是这样的：

1.  已创建包含 XXXXX 列的数据生成计划
2.  XXXXX 列已删除
3.  您现在正尝试再次运行该计划。

要修复它，要么：

1.  将表中的列放回原处，或
2.  从计划中取出列。

希望有帮助！

# perl - 如何使用 Perl 或 shell 非递归迁移目录？

> ID：387309
> 
> 赞同：3
> 
> 时间：2008-12-22T20:46:02.380
> 
> 标签：perl, shell, directory

我们正在将主文件夹迁移到一个新的文件系统，我正在寻找一种使用 Perl 或 shell 脚本自动化它的方法。我在编程语言方面没有太多选择，因为系统是专有存储集群，应该尽可能保持不变。

任务：在目录 /home/ 下，我有各种用户的主文件夹 aaa、bbb、ccc，...，他们有一定的权限和用户/组所有权，在迁移到 /newhome/ 时需要保持不变。以下是需要从 /home 迁移的内容的示例：

```
drwxr-xr-x    3 aaaaa    xxxxxxxxx   4096 Feb 26  2008 aaaaa/
drwxrwxrwx   88 bbbbbbb  yyyyyy      8192 Dec 16 16:32 bbbbbbb/
drwxr-xr-x    6 ccccc    yyyyyy      4096 Nov 24 04:38 ccccc/
drwxr-xrwx   36 dddddd   yyyyyy      4096 Jun 20  2008 dddddd/
drwxr-xr-x   27 eee      yyyyyy      4096 Dec 16 02:56 eee/ 
```

因此，应在 /newhome 下创建具有权限和所有权的完全相同的文件夹。复制/移动文件不应该是一个问题，因为它将在稍后处理。

有人写过这样的剧本吗？我对 Perl 很陌生，所以我需要帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T20:49:46.803

`cp`的 -a 标志将维护权限、修改时间等。您应该能够执行以下操作：

```
for a in `ls /home`; do cp -a "/home/$a" "/newhome/$a" ; done 
```

用一个目录尝试一下，看看在自动化之前是否能满足你的需要。

编辑：您可以使用 Paul 提到的 rsync 或 tar 禁用递归文件复制。使用 rsync，仍会保留子目录，但不会复制文件：

```
sudo rsync -pgodt /home/ /newhome/ 
```

我没有尝试过 tar 的 --no-recursion，所以无法评论。

编辑2：另一种方式

```
find /home/ -maxdepth 1 -print | sudo cpio -pamVd /newhome 
```

[参考](http://bradthemad.org/tech/notes/cpio_directory.php)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T21:44:51.840

如果您将复制操作设置为 ，则只能保留所有者和组`root`。大多数给出的命令都可以工作 -`tar`和`cp -rp`选项都可以。

唯一需要担心的技巧是不可写目录，但这对于非 root 用户来说是个问题。然后，我倾向于使用：

```
(cd /home; find . -depth) | cpio -pvdumB /newhome 
```

该`-depth`选项表示在目录本身之前处理文件和子目录，因此只有在将目录的所有内容都复制到该目录后，才能设置该目录的不写权限。您还可以使用 ' `sort -r`' 以相反的顺序列出文件，以确保目录出现在其内容之后。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T20:53:31.333

这将创建目录*并*复制所有文件。

```
cd /home; tar cvBf - . | (cd /newhome; tar xvpBf -) 
```

如果您不想复制所有文件，您可以通过在第一个 tar 命令中添加“--no-recursion”来做到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T20:53:49.320

如果这些目录在同一个文件系统上，为什么不简单

```
cp -p /home/* /newhome/ 
```

# authentication - 网络应用认证

> ID：387317
> 
> 赞同：0
> 
> 时间：2008-12-22T20:48:59.237
> 
> 标签：authentication, web-applications

我有一个在外部托管 Web 应用程序的场景（即：Web 服务器不是我的内部活动目录域的成员）。

我想使用他们的活动目录凭据对 Web 应用程序的用户进行身份验证。

有没有我可以使用的产品或一些设置来完成这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T20:50:57.737

通常这是通过使用 LDAP 对 AD 服务器进行身份验证来实现的。我建议使用 LDAP+SSL 来防止密码以明文形式出现，除此之外你应该没问题 - 只要没有任何防火墙。

# iphone - 所有特殊的 iPhone / iPod Touch HTML 标签是什么？

> ID：387318
> 
> 赞同：18
> 
> 时间：2008-12-22T20:49:38.177
> 
> 标签：iphone, html, safari, ipod-touch

在查看 SO[源代码](http://view-source:)后，我注意到了这个标签：

```
<link rel="apple-touch-icon" href="/apple-touch-icon.png" /> 
```

在谷歌快速发布后，在您的主页上[显示](http://allinthehead.com/retro/319/how-to-set-an-apple-touch-icon-for-any-site)了一个 Apple“favicon”类型的东西（确切地说是“WebClip Bookmark”）。

唯一[想到](http://alexking.org/blog/2006/11/12/safari-search-boxes)的另一个是：

```
<input type="search" results="5"/> 
```

[![替代文字](https://i.stack.imgur.com/6mwtB.gif)](https://i.stack.imgur.com/6mwtB.gif)
[（来源：[alexking.org](http://alexking.org/dev/safari-search-box.gif)）]

此 type="search" 使该字段“继承” Apple 搜索图标，并且可选 results="x" 允许维护“x”关键字的历史记录。

因此，我想知道，我不知道还有哪些其他 Apple/Safari (iPhone/iPod Touch) 特定的 HTML 标记和属性！好奇的人需要知道！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-22T22:54:02.043

```
<meta name="viewport" content="width=320, initial-scale=2.3, user-scalable=no"> 
```

允许您设置宽度、高度和比例值

```
<meta name="apple-mobile-web-app-status-bar-style" content="black" /> 
```

设置状态栏样式，非常不言自明。

```
<meta name="apple-mobile-web-app-capable" content="yes" /> 
```

正如 Marc 上面提到的，并且在 daringfireball.net 链接中进行了解释，允许网页以全屏模式运行，而不是通过 safari。

此处支持并记录了其他各种属性：[https ://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html](https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-12-31T22:47:27.707

以为我会用我看到的一些新事物来添加我自己的答案。

1.) 可以选择提供更高清晰度的 iPhone 4 视网膜显示图标

```
<link rel="apple-touch-icon" href="icons/regular_icon.png" />
<link rel="apple-touch-icon" href="icons/retina_icon.png" sizes="114x114"/> 
```

2.) 如果您发现 iPhone/iPod/iPad 在应用程序图标上放置的默认光泽叠加层过多，您可以通过在 rel 属性中添加“precomposed”来请求不添加它。

```
<link rel="apple-touch-icon-precomposed" href="/images/touch-icon.png" /> 
```

3.) 您可以让 iPhone 链接直接用于电话/短信发短信执行所需的操作

```
<a href="tel:01234567890">Call us</a>
<a href="sms:01234567890">Text us</a> 
```

4.) 不完全是 HTML 标记，而是基于方向切换 CSS 的便捷选项

```
<script type="text/javascript">
  function orient(){
    switch(window.orientation){
      case 0:
        document.getElementById("orient_css").href = "css/iphone_portrait.css";
        break;
      case -90: 
        document.getElementById("orient_css").href = "css/iphone_landscape.css";
        break;
      case 90: 
        document.getElementById("orient_css").href = "css/iphone_landscape.css";
        break;
    }
  }
  window.onload = orient();
</script> 
```

5.) 你可以为 iPhone 4 的视网膜显示提供一个特殊的 CSS 样式表，它支持的像素是原来的 4 倍。

```
<link rel="stylesheet" type="text/css" href="../iphone4.css"
   media="only screen and (-webkit-min-device-pixel-ratio: 2)" /> 
```

感谢@Sarah Parmenter 以[24 种方式](http://24ways.org/2010/life-beyond-media-queries)提供此附加信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T21:03:10.537

[apple-mobile-web-app-capable](http://daringfireball.net/linked/2008/10/03/fullscreen-iphone-web-apps)是用于单一用途 webapps 的一个有用的标头标签。当用户为站点创建主屏幕快捷方式时，它将以“全屏”模式启动，与普通的 Mobile Safari 应用程序分开，并且没有 URL 栏或其他 chrome。如果该网站设计得很好，它几乎就像一个原生 iPhone 应用程序。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-09-16T10:05:22.280

上述文档已移动。这些是新的地点。

Safari HTML 参考： [https ://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/](https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/)

Safari 网页内容指南： [https ://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/](https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-15T04:45:21.517

@scunliffe 我将您的方向切换更进一步：

```
function orient(o){
  switch(o){
    case -90:
    case 90: 
      $('#container').removeClass().addClass('landscape');
    break;
    default:
      $('#container').removeClass().addClass('portrait');
    break;
  }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-01T19:10:12.177

事实证明，它们有很多！

我发现这个很有趣：

> 要为整个网站（网站上的每个页面）指定一个图标，请在名为 apple-touch-icon.png 或 apple-touch-icon-precomposed.png 的根文档文件夹中放置一个 PNG 格式的图标文件。如果您使用 apple-touch-icon-precomposed.png 作为文件名，iPhone 上的 Safari 不会为图标添加任何效果。
> 
> precomposed 适用于 iPhone OS 2.0 及更高版本

DaringFireball 链接 Marc 分享了指向 Safari Web 内容指南的链接。正如安迪所说，您必须注册它，但它免费且容易（嗯，不如 OpenID 容易，但很接近）。

[Safari 网页内容指南](https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/)

# winapi - 如何使用 Windows API 将空字符发送到串行端口？

> ID：387322
> 
> 赞同：2
> 
> 时间：2008-12-22T20:50:54.337
> 
> 标签：winapi, serial-port

我正在开发一个 Windows 实用程序，它使用标准 COM 端口与一些自定义硬件进行通信。通信协议（我无法控制）要求我发送和接收原始 8 位数据字节。

我目前正在使用以下 Windows API 函数将数据发送到 COM 端口：

```
WriteFile(hFile, lpBuffer, numberOfBytesToWrite, ...)
```

where`hFile`是对正确打开的 COM 端口的引用，并且`lpBuffer`是我存储在内存中的字节数组。在需要将空字符（ASCII 零）发送到设备之前，该代码运行良好。`WriteFile`一旦检测到空字符就停止发送，因为它假定它已到达字符串的末尾。即使我设置`numberOfBytesToWrite`正确，也会发生这种情况。

如何使用 Windows API 将原始数据发送到 COM 端口？我更愿意使用类似于 的标准 API 调用`WriteFile`，但我愿意接受建议。

我目前正在使用[RapidQ](http://rapidqwiki.altervista.org/)来构建实用程序，但它所做的只是直接调用 Windows API 函数。

**编辑：**我的设置包括通过串行端口连接到自定义硬件模块的 Windows PC。该模块有一个小屏幕，我可以在上面查看传输的字符。我已经用另一个第三方实用程序测试了这个设置。我能够使用这个第三方程序与模块通信，并且空字符正确显示。在我自己的程序中，当我使用 时`WriteFile`，传输流中任何位置的空字符都会停止发送流的其余部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T21:20:12.577

我之前做过 Windows 串口编程，并且确信我已经能够通过串口发送空字符（如果不这样，各种文件传输协议将无法正常工作）。我能想到两种可能的解释：

1.  *接收*设备正在使用在第一个空字符处停止的方法打印它接收到的数据。您如何确定传输设备在第一个空值处终止？问题可能出在更远的地方吗？
2.  串口驱动坏了。这不太可能，但可能是一种解释。如果您正在使用一些狡猾的专有第三方串行端口及其驱动程序，那么他们可能会受到怀疑。如果您使用标准内置串行端口和普通 Windows 驱动程序，那么这可能不是问题。

我只是快速浏览了一下 RapidQ，还有第三种可能的解释：

3.  RapidQ 在调用 Win32 API 函数的过程中可能进行的封送处理可能会遇到要发送的数据中嵌入空字符的问题。我对 RapidQ 一无所知，但这是链条中另一个必须考虑的环节。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T21:18:10.257

[Win32 中的串行通信](http://msdn.microsoft.com/en-us/library/ms810467.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T21:28:18.037

Greg 可能是正确的，但我也会检查您的 com 端口设置。确保正确设置 DCB 设置。查找 SetCommState 和 GetCommState 以获取信息。

通常，串行是 8N1，但您的设备可能正在使用其他奇偶校验或停止位配置等。

像 Greg 一样，我自己在串行方面做了很多工作，这通常是问题的根源……尝试使用 RS485 和不正确的 DCB 结构进行交谈……呵呵……

拉里

PS：如果你还没有，我建议你给自己买一个好的串行分线盒。我在房子周围的某个地方有一个，它会在你所有的通信过程中显示所有信号是什么，在所有线路上，它是一个非常强大的调试工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T21:34:46.370

我过去曾使用过 WriteFile，它在处理空字节时效果很好。我会深入研究 RapidQ，这可能是问题所在。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T21:44:22.870

如果这些都没有帮助，你总是可以做我做的。使用 Greg 的 COMM 代码来测试设备。还记得 Qmodem 吗？:) 非常好的测试/调试串行例程的工具。您甚至可以使用 Qmodem 和一个简单的 Qmodem 脚本来读取另一个盒子（或同一盒子中的另一个端口）上的 COM 端口，并打印出每个发送的字符的十六进制值。等一下。Qmodem 有内置的。:) 使用调试 ASCII 仿真，它将显示串行端口上每个字符的十六进制值。然后，您至少可以验证您的代码是否正常工作。

现在，问题。WriteFile 在遇到 NULL 时会返回，还是只是坐等等待，永远不会返回？

如果它永远不会返回，那么它可能不是您的代码。WriteFile 仅在发送所有 dwBytesToWrite 或出现错误时返回。其他任何东西，它正在尝试写入，但另一端出现故障。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-05-14T16:01:14.087

要通过串行发送 NULL 字符，您可以使用 setEndOfFile() 函数，将端口处理程序作为文件。

如果您有太多 NULL 数据要发送，它可能并不理想，但这是一种解决方法。

[功能详情](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-setendoffile)

# unit-testing - 单元测试 - 视频或播客

> ID：387326
> 
> 赞同：41
> 
> 时间：2008-12-22T20:51:41.837
> 
> 标签：unit-testing

我正在寻找有关如何进行单元测试的播客或视频。

理想情况下，它们应该涵盖基础知识和更高级的主题。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-22T20:57:49.283

在[Dnr TV](http://www.dnrtv.com/)有两集与 JP Boodhoo 合作，他介绍了测试驱动开发：

*   [使用 JP Boodhoo 进行测试驱动开发，第 1 部分](http://www.dnrtv.com/default.aspx?showNum=10)
*   [使用 JP Boodhoo 进行测试驱动开发，第 2 部分](http://www.dnrtv.com/default.aspx?showNum=11)

如果您想看到单元测试和 TDD 与一大堆其他敏捷实践一起使用，我建议您观看 sceencast 系列[**Autumn of Agile**](http://autumnofagile.net/)。本系列从头到尾展示了一个完全单元测试的应用程序的开发。

至于播客，请查看以下内容：

*   [多态播客 - Jason Bock 谈单元测试、代码覆盖率和分析](http://polymorphicpodcast.com/shows/bock/)
*   [Hanselminutes - Scott Hanselman 谈测试驱动开发](http://perseus.franklins.net/hanselminutes_0031.mp3)
*   [Hanselminutes - 关于 TDD 的最后一句话，与 Scott Bellware](http://perseus.franklins.net/hanselminutes_0146.mp3)
*   [软件工程电台 - Gerard Meszaros 谈 XUnit 测试模式](http://www.se-radio.net/podcast/2007-10/episode-70-gerard-meszaros-xunit-test-patterns)

由于模拟对象是单元测试中非常重要的一部分，因此这些播客片段也可能很有趣：

*   [Hanselminutes - Scott Hanselman 谈模拟对象](http://www.hanselminutes.com/default.aspx?ShowID=43)
*   [Dot Net Rocks - TypeMock.Net 上的 Eli Lopian](http://www.dotnetrocks.com/default.aspx?ShowNum=278)
*   [Dot Net Rocks - Oren Eini on RhinoMocks](http://www.dotnetrocks.com/default.aspx?ShowNum=224)
*   [点网岩石 - RhinoMocks 3.5 上的 Oren Eini](http://www.dotnetrocks.com/default.aspx?ShowNum=402)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-23T09:42:10.377

My collected bookmark-dump

*   The [Clean Code Talks](http://www.youtube.com/view_play_list?p=BDAB2BA83BB6588E) has some of [Miško Hevery](http://misko.hevery.com/)s lectures at Google. New episodes are posted at the [Google Testing Blog](http://googletesting.blogspot.com/) as they arrive.
*   Some of the [GTAC 2008](http://www.youtube.com/view_play_list?p=4E81859265562302) (Google Test Automation Conference 2008) videos are pretty interesting.
*   [Automated Testing Patterns and Smells](http://www.youtube.com/watch?v=Pq6LHFM4JvE)
*   [Becoming a Software Testing Expert](http://www.youtube.com/watch?v=3FTwaojNkXw) is not really about unit testing, but helps you get into the tester mindset
*   [How To Design A Good API And Why It Matters](http://www.youtube.com/watch?v=aAb7hSCtvGw) briefly touches on testability.
*   Browsing the [testing](http://www.se-radio.net/tags/testing) tag on se-radio reveals some interesting podcasts
*   Check out the videos from the Test track of Öredev 2007 ([1](http://www.oredev.org/toppmeny/video/november13.4.3f1ff754117a0ed3480800013820.html), [2](http://www.oredev.org/toppmeny/video/november14.4.3f1ff754117a0ed3480800013882.html)), I especially liked the 'testable architecture' one.
*   The [Testing](http://www.infoq.com/Testing) sub-site of InfoQ is also worth a visit for more (text, audio, video) resources

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-23T09:27:02.890

Other hanselminutes episodes on testing:

*   [#112 The Past, Present and Future of .NET Unit Testing Frameworks](http://www.hanselminutes.com/default.aspx?showID=130) - listened a while back, remember being slightly underwhelmed, but still worth a listen
*   [#103 Quetzal Bradley on Testing after Unit Tests](http://www.hanselminutes.com/default.aspx?showID=121) - extremely interesting, giving deep insight into how to think about the purpose of coverage metrics etc.
*   [#146 Test Driven Development is Design - The Last Word on TDD (with Scott Bellware)](http://www.hanselminutes.com/default.aspx?showID=164) - lives up to its name in that it slams home a lot of core concepts that you "always knew anyway". IIRC the podcast gives a favourable mention to the Newkirk/Vorontsov book - which I wouldnt particularly second (it's a long time since I read it -- I might just not have been ready to absorb its messages)

Other podcasts:

*   [Herding Code Episode 42: Scott Bellware on BDD and Lean Development](http://herdingcode.com/?p=176) - recorded after Hanselminutes #146\. Again, very good discussion that helps to cement ideas around "classic tests" vs BDD vs Context Specification and various such other attempts at classifications...
*   [J.B. Rainsberger: "Integration Tests Are A Scam"](http://www.infoq.com/infoq/url.action?i=1487&t=p) is a recording of a presentation covering integration vs unit tests.

Other questions like this:

*   [Good QA / Testing Podcast](https://stackoverflow.com/questions/30311/good-qa-testing-podcast), which among others lists the meta podcast [http://testingpodcast.com/](http://testingpodcast.com/)

Blog posts:

*   [It’s Not TDD, It’s Design By Example](http://bradwilson.typepad.com/blog/2009/04/its-not-tdd-its-design-by-example.html) - Brad Wilson, similar in vein to HC #42, attempting to get across why you're writing the tests.

I know you didn't ask for books but... Can I also mention that Beck's TDD book is a must read, even though it may seem like a dated beginner book on first flick through (and [Working Effectively with Legacy Code by Michael C. Feathers](https://rads.stackoverflow.com/amzn/click/com/0131177052) of course is the bible). Also, I'd append Martin(& Martin)'s Agile Principles, Patterns & Techniques as really helping in this regard. In this space (concise/distilled info on testing) also is the excellent [Foundations of programming ebook](http://codebetter.com/blogs/karlseguin/archive/2008/06/24/foundations-of-programming-ebook.aspx). Goob books on testing I've read are [The Art of Unit Testing](https://rads.stackoverflow.com/amzn/click/com/1933988274) and [xUnit Test Patterns](https://rads.stackoverflow.com/amzn/click/com/0131495054). The latter is an important antidote to the first as it is much more measured than Roy's book is very opinionated and offers a lot of unqualified 'facts' without properly going through the various options. Definitely recommend reading both books though. AOUT is very readable and gets you thinking, though it chooses specific [debatable] technologies; xUTP is in depth and neutral and really helps solidify your understanding. I read [Pragmatic Unit Testing in C# with NUnit](https://rads.stackoverflow.com/amzn/click/com/0974514020) afterwards. It's good and balanced though slightly dated (it mentions RhinoMocks as a sidebar and doesnt mention Moq) - even if nothing is actually incorrect. An updated version of it would be a hands-down recommendation.

More recently I've re-read the [Feathers](https://rads.stackoverflow.com/amzn/click/com/0131177052) book, which is timeless to a degree and covers important ground. However it's a more 'how, for 50 different wheres' in nature. It's definitely a must read though.

Most recently, I'm reading the excellent [Growing Object-Oriented Software, Guided by Tests by Steve Freeman and Nat Pryce](https://rads.stackoverflow.com/amzn/click/com/0321503627). I can't recommend it highly enough - it really ties everything together from big to small in terms of where TDD fits, and various levels of testing within a software architecture. While I'm throwing the kitchen sink in, [Evans's DDD](https://rads.stackoverflow.com/amzn/click/com/0321125215) book is important too in terms of seeing the value of building things incrementally with maniacal refactoring in order to end up in a better place.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-13T13:19:09.253

You could check out the [Unit Testing episodes](http://www.dimecasts.net/Casts/ByTag/Unit%20Testing) of Dime Casts.Net.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-13T15:04:30.983

The following videos are by the author of The Art Of Unit Testing by Roy Osherove:

Understanding Test Driven Development: [http://osherove.com/videos/2009/8/25/understanding-test-driven-development.html](http://osherove.com/videos/2009/8/25/understanding-test-driven-development.html)

Unit Testing Best Practices: [http://osherove.com/videos/2009/8/25/unit-testing-best-practices.html](http://osherove.com/videos/2009/8/25/unit-testing-best-practices.html)

Understanding Mock Objects [http://osherove.com/videos/2009/8/25/tdd-understanding-mock-objects.html](http://osherove.com/videos/2009/8/25/tdd-understanding-mock-objects.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-23T09:10:05.247

[Google employee](http://googletesting.blogspot.com/) and testing evangelist [Misko Hevery](http://misko.hevery.com/) is definitely an authority on unit testing. I'm surprised he hasn't been mentioned yet. He's one of the best lecturers out there, unit testing or no. In fact, I didn't really give a hoot about unit testing until I watched one of his 'casts. He gives clear, professional, to-the-point lectures and 9 times out of ten has something interesting to say. In my book, he's up there with Yegge in terms of influential developers. Plus, he makes subtle nerd jokes as an added bonus too which I find hilarious.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-23T09:18:01.380

[JP Boodhoo](http://blog.jpboodhoo.com) is a great guy on unit testing and BDD. He made several videos on how to do unit testing on mvp patterns.

I agree with Andrew. [Misko Hevery](http://misko.hevery.com/) is quite thoughtful on testing. His project [testability-explorer](http://code.google.com/p/testability-explorer/) is an innovation to measure your code as an evidence for further refactoring, based on some existing metrics.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-19T13:56:54.330

Here are 2 really good introductory talks on TDD,BDD and unit testing. The speakers are both authors on the subject and both books are great.

[Kent Becks's talk developer testing](http://itc.conversationsnetwork.org/shows/detail301.html)
[David Astel's video on BDD](http://video.google.co.uk/videosearch?q=david+astels&hl=en&emb=0#q=TDD&hl=en&emb=0)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-23T09:32:08.853

Unit Testing in Delphi 2005

This [BDNtv](http://dn.codegear.com/article/32846) episode shows the unit testing integration for DUnit for a Delphi/Win32 application in Delphi 2005\. Unit testing for C#, Delphi for .NET, and Delphi for Win32 with both NUnit and DUnit are supported in Delphi 2005

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-19T14:00:30.170

Rob Conery covers a bit of this in his [Store Front](http://blog.wekeroad.com/mvc-storefront/mvc-storefront-part-1/) series. But probably not worth it unless your into the ASP.Net MVC stuff.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-10-10T19:13:16.460

Here is a link to video by Hadi Hariri on how [Mocks make uniting testing easier](http://cc.embarcadero.com/download.aspx?id=27258)

> Make Tests Easier with Mocks Mocking allows functionality to be stubbed out during tests allowing you to concentrate on the system under test and less on other subsystems. This session covers the idea behind mocks and shows some of the existing mocking frameworks available. See how to effectively use mocks and what the differences are between state and behavior tests.

Here is a link to video by Robert Love on how to [Building Unit Tests with DUnit](http://cc.embarcadero.com/download.aspx?id=27294) for delphi

> Building Unit Tests with DUnit Get up to speed with unit testing in DUnit. No prior knowledge of Unit testing or DUnit is required.

# c# - 如何从 DataView 中的列中获取值？

> ID：387334
> 
> 赞同：9
> 
> 时间：2008-12-22T20:53:52.910
> 
> 标签：c#, asp.net, dataview

我有一个数据视图定义为：

```
DataView dvPricing = historicalPricing.GetAuctionData().DefaultView; 
```

这是我尝试过的，但它返回名称，而不是列中的值：

```
dvPricing.ToTable().Columns["GrossPerPop"].ToString(); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T20:57:32.107

您需要指定要获取其值的行。我可能会更倾向于 table.Rows[index]["GrossPerPop"].ToString()

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-22T21:04:21.407

您需要使用 a`DataRow`来获取值；值存在于数据中，而不是列标题中。在 LINQ 中，有一个扩展方法可能会有所帮助：

```
string val = table.Rows[rowIndex].Field<string>("GrossPerPop"); 
```

或没有 LINQ：

```
string val = (string)table.Rows[rowIndex]["GrossPerPop"]; 
```

（假设数据**是**一个字符串......如果不是，使用`ToString()`）

如果你有 a`DataView`而不是 a `DataTable`，那么同样适用于 a `DataRowView`：

```
string val = (string)view[rowIndex]["GrossPerPop"]; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-10-31T08:19:17.627

@Marc Gravell ....您的答案实际上已经回答了这个问题。您可以从数据视图访问数据，如下所示

```
string val = (string)DataView[RowIndex][column index or column name in double quotes] ;
// or 
string val = DataView[RowIndex][column index or column name in double quotes].toString(); 
// (I didn't want to opt for boxing / unboxing) Correct me if I have misunderstood. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-03-21T04:51:41.007

对于 vb.NET 中的任何人：

```
Dim dv As DataView = yourDatatable.DefaultView
dv.RowFilter ="query " 'ex: "parentid = 1 "
for a in dv
  dim str = a("YourColumName") 'for retrive data
next 
```

# database-design - 数据库设计最佳实践

> ID：387339
> 
> 赞同：60
> 
> 时间：2008-12-22T20:56:05.870
> 
> 标签：database-design

我非常精通 SQL Server、MySQL、Oracle 等，但是将这些数据库产品放在一边，是否有资源可以帮助我很好地设计关系数据库？数据库设计是否有模式或最佳实践之类的东西？

我见过几次数据库通常是不可扩展的；人们有个人偏好，喜欢保留像 isChecked 列这样的列，它本质上是布尔值，但存储为 Char(1)，其值像 'Y' 和 'N' 而不是 0 和 1，这对我来说听起来更好。在进行数据库设计时不犯常见错误的方法？

书籍或文章的链接将不胜感激。

提前致谢。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-12-22T21:48:48.960

A few points:

*   Learn as much as you can about **problem domain**. You can't create good data model without knowing what you're designing for
*   Have good knowledge about **data types** provided by your database provider
*   How to properly use **normalisation** and design tables
*   Performance: when and how to apply **indexes**, how to write efficient **queries** etc.
*   When and how to use different DB objects like views, procedures, functions, triggers

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-22T21:32:52.910

There are numerous database design patterns. They aren't often nicely formalized, so you may have to simply look at lots of database design.

See, for example, [Fowler's books](http://martinfowler.com/books.html) on design patterns. Also [Nock's Book](http://books.google.com/books?id=C-31XEKjNj4C&dq=database+design+patterns&printsec=frontcover&source=in&hl=en&sa=X&oi=book_result&resnum=11&ct=result).

There are blogs, like [database programmer](http://database-programmer.blogspot.com/2008/01/table-design-patterns-cross-reference.html).

There's an IEEE book, [On Pattern-Based Database Design and Implementation](http://www2.computer.org/portal/web/csdl/doi/10.1109/SERA.2008.24).

The Google Search ([link](http://www.google.com/search?hl=en&rlz=1C1GGLS_enUS295US303&q=database+design+patterns&btnG=Search)) turned up 24M hits.

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-12-22T21:39:47.717

My take on this is somewhat contrarian. I would advise, don't stress the design of the database too much.

Sometimes this may be hard. With internal LOB applications, the prevailing view of the business is often times that the DATA is the primary asset, where as the software is somewhat expendable.

My advice would be: don't buy it.

In reality the asset is the company's ability to INTERACT with the data. To view it, to manipulate it, and to make decisions based on it.

This means that even though they may place a high value on the data, what they are actually valuing is the software that you are writing.

This means I would focus most of your effort on building an effective user experience, rather than on "designing the perfect database". The database is really just a tool that enables you to deliver on a user experience.

The key feature of relational data models is data and access path independance. You can add columns, change keys, introduce or remove indexes, etc, while having zero impact (or close to zero) on the applications that use it.

This makes the database structure extremely pliable.

Trying to design the database to "be flexible for the future", or to "optimize performance" is mostly a wasted effort.

Changing the structure of the database will have a relatively small impact on your system.

Also, you really can't predict how the database will scale until you run into the scenarios where you need it to scale. Your best bet is to wait until you hit performance issues. and then address them specifically.

Making changes to the user experience of your app, however, is usually more expensive. UI work is time consuming, and usually takes a while to get right.

So, I would recommend that you:

1.  Just produce a crappy DB design
2.  React to the actual performance scenarios you encounter
3.  Focus your efforts on user experience, not on the database

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-22T22:10:38.557

To counter Dillie-O's advice. I'd suggest that you **don't** put all your lookups into one table. In general, this is an attempt to force OO design into a Relational Database. It can be done and it fits the world view of an OO developer, but it leads to crippling database designs.

Bounce over to Google and search for "MUCK Tables" which lead you to discussions of Massively Unified Code-Key Tables. Alternatively, you can look for "one true lookup table" for discussions. Or even read Joe Celko's article [One True Lookup Table](http://www.dbazine.com/ofinterest/oi-articles/celko22) .

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-02T20:41:17.930

I didn't find what I was looking for in this question, but [this one](https://stackoverflow.com/questions/44281/database-patterns) has a bunch of recommendations for design patters in DB design

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-22T21:33:12.097

Dont store calculated values

Example, You have table "Squares" with column "width". No need to make a column "area", because that can be calculated via width ^ 2

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-22T21:15:50.527

与任何事情一样，这里的答案是“视情况而定”。

数据库可以用来做不同的事情，其中​​一些事情在设计和开发中需要相反的方向。

OLTP 数据库系统的设计将与用作报告或仓储解决方案的完全不同。第一个通常是规范化的，而仓库通常是非规范化的。这有助于系统为其预期行为获得所需的性能。

即使在其中的一部分内，根据使用是重读还是重写，不同的设计决策也可能是合适的。

最好的办法是研究与您尝试构建的应用程序类型相对应的更小部分数据库开发的最佳实践。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-22T21:31:08.153

The best book I've ever read in regards to database design is "Database Design for Mere Mortals" by Michael J Hernandez. The name sounds like a beginners book, but people at any level could gain knowledge from it. It's also platform independent as it deals with looking at the data itself and how to properly organize it - not the technology being used.

He also wrote a book on writing queries named "SQL Queries for Mere Mortals" that I've heard (haven't read this one myself yet) is quite good.

[Database Design for Mere Mortals](https://rads.stackoverflow.com/amzn/click/com/0201752840)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-22T23:08:14.060

The relational database is an extremely powerful abstraction; it's a collection of facts and a predicate calculus. Not only that, SQL enforces command query separation by having one clause for examining rows and another for changing rows.

When you think of a database as a truth reasoning engine, it makes sense to have a set-up that does not allow contradictions to flow from the data you're modelling. Therefore, to use a relational database effectively you need to get your database design right. Unlike the design of object orientated programs, there is a consensus view on how a relational database should be designed. The proper approach to database design is [normalise](http://www.datamodel.org/NormalizationRules.htm) as far as it is sensible. Most people normalise up to third normal form but you can in fact go up to fifth normal form.

If possible, you want to expunge null column values from your database. If you agree with my view of the database as a truth reasoning engine, then nulls are a real problem. When you have nulls in a database the law of excluded middle does *not* hold. This makes "proof by contradiction" of any given property of the database more difficult that it would be without the nulls. Nulls unnecessarily complicate the semantics of the database.

Sometimes it will be necessary to break the rules of normalisation for performance reasons. However, don't do this before you have *data* on what is queries in particular are slow. Often you can simply speed up the query by carefully altering indexes rather than denormalising.

Finally, a word on stored procedures rather than direct queries. On a decent database, you can set security permissions on stored procedures independently of the underlying tables. This, by itself, is reason enough to consider using stored procedures extensively. With stored procedures, you build a tighter security model than is possible with direct SQL access.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-22T21:06:24.147

可能最著名的最佳实践是数据库规范化。这组技术允许您设计数据库，以便删除冗余项目，并对字段进行逻辑分组。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-22T21:55:27.107

if you don't document enums in the description column of the schema so that i can figure out what the '5' is in this:

```
Select name from peeps where accountStatusId = 5 
```

**then do this**

Use a table to enumerate a field. eg:

```
Select name 
from peeps p 
join accountStatus s 
on p.accountStatusID = s.asid 
where s.accountStatus = 'ActiveDude' 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-29T18:49:52.467

The book by Michael J. Hernandez *Database Design for Mere Mortals* is well written, and an easy read. It should answer all of your questions.

Hernandez also co-authored *SQL Queries for Mere Mortals* with John L. Viescas.

The books are about $60 a piece. I'm trying to find the CD for Queries for Mere Mortals because I lost mine. If anyone has a copy, let me know.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-22T21:22:35.613

i would say that as long as the database is normalized and if you are making a VLDB then partition it correctly then you should be fine. other best practices include using CRUD for the stored procedures and ensuring that all tables cascade properly. most everything else is subjective. Using "Y/N" is old school database programming from when bit hasn't been introduced yet. It can also be used for scalability purposes like "Y/N/Maybe" but if that were the case bast practices would say to normalize that and make a lookup table.

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2008-12-22T21:16:42.287

我们在这里使用的一个非常好的概念是“查找代码”表。如果您有一个数据库，其中包含对有效编码或类型等项目的大量引用，请将所有这些引用保存在单个 LookupCode 表中，该表基于 CodeGroup 和代码本身。

我们为代码的活动状态保留了一个附加标志，以及一些可选的数字列，如果需要以任何方式对给定的查找代码进行排序或计算，可以使用这些列。

By doing this, you eliminate having tons of tiny little tables scattered around your schema. Now one of the downsides to this is that the primary key for the table is the code group and code itself, so there isn't a foreign key attached to the "master" table that is referencing a given code, but a little bit of enforcement in the application is easily to accommodate for this.

# java - Java 命令行启动器

> ID：387340
> 
> 赞同：3
> 
> 时间：2008-12-22T20:56:22.437
> 
> 标签：java, command-line-interface

我正在开发一个 .jar 文件库来实现一堆帮助类来将 PC 连接到一个外部硬件。我还将添加一些简单的应用程序（命令行或 GUI）来使用该库处理常见任务。

我的问题是，是否有推荐的方法以某种特定方式简化 JVM 的命令行实例化？

例如，而不是要求用户键入一个神秘的容易出错的命令，例如：

```
java -cp TurboBlenderLib.jar -jar TurboBlenderApp.jar -DFoo=Bar arg1 arg2 
```

相反，我做

```
TurboBlenderApp arg1 arg2 
```

?

我想我可以使用 shell 脚本（包括 win32 批处理文件... gackckkk），只是我不擅长这些 + 我想知道是否有一种更直接的独立于平台的方式来运行 Java 应用程序命令行。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T21:00:11.040

1.  当您使用`-jar`， then `-cp`（和`CLASSPATH`变量）将被忽略
2.  只需提供一个可执行的jar。" `java -jar TheApp <whateverargumentsyouwant>`" 不应该太难（但是，您可以在文件清单中包含[Class-Path 属性）。](http://java.sun.com/javase/6/docs/technotes/guides/jar/jar.html#Main%20Attributes)`jar`
3.  如果太难写一个 GUI
4.  或提供那些 shell 脚本/批处理文件。写这些也不是太难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T21:34:34.903

如果您只想简化本地执行，请使用批处理文件，甚至只是创建自定义快捷方式。如果要创建启动器并打包可执行 jar 和部署所需的库，请使用[Launch4j 之](http://launch4j.sourceforge.net/)类的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:24:18.657

如果您用于启动应用程序，则可以通过向主 jar 的清单`java -jar`添加一个条目来向类路径添加其他 jar 。`Class-Path`有关更多信息，请参阅[jar 文件规范](http://java.sun.com/j2se/1.4.2/docs/guide/jar/jar.html#Main%20Attributes)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T21:00:12.833

Shell 脚本和批处理文件是完成您想要的工作的标准方式。（查看任何主要的 Java 产品。）

当然，这绝对是可悲和可笑的。去Java。

您的替代方法是编写一个小 C 程序来执行您需要的操作（创建 java 进程）并为您支持的每个平台编译它。（C 是真正的平台独立语言）。

无论哪种方式，您都需要采取与平台相关的步骤，以使您的应用程序在操作系统中真正感到宾至如归。在 OS X 上，您需要制作一个 .app 包，在 Windows 上，您需要将至少图标和版本信息打包到一个 EXE 中。对于 Linux，shell 脚本就足够了。:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T21:37:49.140

出于某种原因，这个技巧无法解决。您需要做的是为定义`Main-class:`属性的 jar 文件创建自定义清单，并在 jar 文件中包含您正在使用的所有类文件。然后你只需要运行

```
$ java -jar myapp.jar 
```

在真正的操作系统上，您甚至可以只运行 jar 文件，因为它们将使用幻数来启动它。但是，如果必须，只需要包含该行的单行批处理或 shell 脚本即可。

[这在Java 教程](http://java.sun.com/docs/books/tutorial/deployment/jar/appman.html)之一中进行了描述。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T10:20:27.367

与往常一样，在 Jakarta Commons 中可以找到另一个解决方案：[commons-launcher](http://commons.apache.org/launcher/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T20:58:14.210

批处理文件可以完成这项工作。将您要执行的确切命令放入文件 myProg.bat 并运行它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T21:17:53.780

这很容易：

在 TurboBlenderApp.cmd 中写入：

```
java -cp TurboBlenderLib.jar -jar TurboBlenderApp.jar -DFoo=Bar %1 %2 
```

*// 请记住关于 -cp 和 -jar 的 saua 回答*

然后从命令行中编写：

```
TurboBlenderApp arg1 arg2 
```

正是你想要的方式。

如果在 Unix/Linux 中将 th4e %1 %2 替换为 $1 $2 并确保您的应用程序具有执行权限（如果您不知道如何执行此操作，我想您也不需要它）

# oracle - Oracle 10g数据库如何限制全局内存资源

> ID：387342
> 
> 赞同：3
> 
> 时间：2008-12-22T20:57:11.437
> 
> 标签：oracle, oracle10g

我正在运行 oracle 的服务器出现内存不足错误。任何人都知道我是否/如何限制 oracle 将使用的全局内存资源？

我有 SGA_TARGET_MAX = 500M 和 150 的会话/进程限制，但我们的最大并发会话数没有达到 50 以上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T23:24:02.670

您没有说明您的机器实际有多少内存（以及是否所有这些内存都可用于 Oracle 实例）。Oracle 使用两种类型的内存。第一个是共享内存（SGA），第二个是进程内存（PGA）。SGA 通常更容易控制。

在 SQL*Plus 中，尝试 SHOW SGA。看看是否符合你的目标。还可以尝试 SHOW PARAMETER PGA 然后查询 v$process 并将进程的总 PGA 与目标进行比较。您可能将 PGA_AGGREGATE_TARGET/SGA_MAX_SIZE 总数设置得太高。或者，Oracle 可能无法将 PGA 内存保持在目标范围内（例如，由于会话在 PL/SQL 数组中存储了大量信息）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T22:33:56.983

尝试使用配置文件并设置 SESSIONS_PER_USER 限制

# vb.net - 是否有从 XSD 文件创建 VB.NET 类的实用程序？

> ID：387356
> 
> 赞同：2
> 
> 时间：2008-12-22T21:04:50.407
> 
> 标签：vb.net, class, xsd, crud

是否有一个实用程序可以从 Dataset.xsd 文件创建 VB.NET 类？我并不是说像 XSD.exe 实用程序那样——所做的只是将 XSD 文件的 XML 转换为 .vb 中的类——它不附加任何“扩展”功能。

我基本上是在寻找能够从 XSD 文件生成业务层起点的东西。就像为每个数据表创建一个部分类，然后为每个数据表的列创建一个属性作为正确的数据类型，最后也是基本的 CRUD 方法。

这是我必须为每个项目一遍又一遍地手动做的事情。（我做了很多小项目并使用 VistaDB，所以我不能使用 Linq-To-SQL - 希望我可以）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T12:49:59.347

我认为 xsd.exe 会做你需要的。以下是将 purchaseorder.xsd 转换为 Purchasing 命名空间中的 vb 类的示例：

```
xsd.exe -c -l:vb -n:Purchasing purchaseorder.xsd 
```

输入 xsd.exe /? 从 Visual Studio 命令提示符获取所有选项。

[你可以在这里](http://quickstart.developerfusion.co.uk/quickstart/howto/doc/xmlserialization/XSDToCls.aspx)找到更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T21:22:56.830

尝试查看 Visual Studio 中的 T4 和代码生成工具。这就像“写代码的代码”，它非常强大。

一个很棒的视频，对我来说真的是“啊哈体验” [http://www.pnpguidance.net/Screencast/T4TemplatesVisualStudioCodeGenerationScreencast.aspx](http://www.pnpguidance.net/Screencast/T4TemplatesVisualStudioCodeGenerationScreencast.aspx)

MSDN：http: [//msdn.microsoft.com/en-us/library/bb126445.aspx](http://msdn.microsoft.com/en-us/library/bb126445.aspx)

Rob Conery 写了一篇介绍： [http ://blog.wekeroad.com/blog/make-visual-studio-generate-your-repository/](http://blog.wekeroad.com/blog/make-visual-studio-generate-your-repository/)

...斯科特·汉塞尔曼也是如此： [http ://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx)

我知道这可能不是您所希望的，但是当您想要更大的灵活性并且不必一遍又一遍地编写相同的代码时，听起来 T4 确实是一个解决方案。

您将编写一个模板，分析您的 XSD 文件并直接在您的项目中生成 vb 文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T21:09:49.353

我知道这并没有严格回答这个问题，但看起来 VistaDB 已经或即将拥有一个可与 Linq to Entities 一起使用的提供程序 - 请参阅[此处](http://www.vistadb.net/vistadb3/technical/vdb3-specs.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T21:47:59.430

Liquid Studio [XML Data Binder](http://www.liquid-technologies.com/XmlStudio/Xml-Data-Binder.aspx)看起来可以满足您的需求，并且您可以下载 30 天试用版。

# mygeneration - MyGeneration 命令行输入

> ID：387360
> 
> 赞同：0
> 
> 时间：2008-12-22T21:06:31.650
> 
> 标签：mygeneration

我浏览了整个互联网、mygeneration 的论坛和 mygeneration 的网站，但我无法弄清楚如何使用 xmldatapath 开关通过命令行将参数传递到模板中。有谁知道如何做到这一点？

- 编辑 -

我做了一些研究，[这里总结了 MyGeneration 的 xml 输入格式](http://williamsmash.com/blog/show/mygeneration-xml-input-format)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T02:57:29.927

您是否看过[这篇文章](http://community.entityspaces.net/forums/thread/10816.aspx)，这表明该`-i xmldatapath`作品使用由 MyGeneration 本身创建的已保存输出文件。您没有详细说明您的确切问题是什么，您是否尝试过使用 -c 创建然后与 -i 一起使用的文件？如果您仍然遇到问题，请添加更多详细信息，我将从源代码运行 MyGeneration 并查看发生了什么。

# iis-6 - 指向 UNC 共享的虚拟目录

> ID：387369
> 
> 赞同：1
> 
> 时间：2008-12-22T21:12:55.133
> 
> 标签：iis-6, virtual-directory

我有一个通过标准将文档上传到服务器的应用程序

当将我的应用程序发送到生产服务器时，我发现他们已经对服务器进行了负载平衡。我对此的解决方案是将上传目录放到网络共享中，然后创建一个指向该共享的虚拟目录。

我已经对共享和文件本身设置了权限，但是每当我尝试上传文档时，我都会不断收到“拒绝访问”。

我在哪里可能缺少权限？IUSR 是否有可能需要访问该共享？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T21:10:04.260

供参考，

对我来说，这个解决方案的答案是使用有权访问共享、文件夹和虚拟目录的用户帐户设置临时模拟。

这是对我有用的代码的链接：

[http://support.microsoft.com/kb/306158#4](http://support.microsoft.com/kb/306158#4)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T23:44:20.460

我希望您的网站使用匿名访问。否则你会有痛苦的经历。

如果是这样（匿名访问），那么： IUSR 是生产服务器上的本地用户，而不是域用户。所以它无权访问共享。您必须将其更改为域用户（在站点配置中，而不是在应用程序池中）。并确保应用程序池在网络服务上运行（这是默认设置）并且它应该可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:20:49.147

无论您的 ASP.Net 进程正在以何种方式运行，都可能无法访问该共享。

因此，您可能需要设置一个 IIS6 应用程序池以作为域用户运行，并让该域用户有权访问文件共享。

不要忘记 aspnet_regiis -ga {domainuser} 以便域用户可以实际运行 asp.net 应用程序。

# c# - 发布后网络服务出错

> ID：387389
> 
> 赞同：1
> 
> 时间：2008-12-22T21:19:20.457
> 
> 标签：c#, web-services

我创建了一个 Web 服务，当它托管在我的本地计算机上时它工作正常，但是当我将它发布到 Web 主机时，它不再工作了，我想这是一个关于如何配置 Web 服务器的问题，但我可以做一些改变吗web.config 所以它会工作吗？

## 我得到的错误如下：

配置错误描述：处理服务此请求所需的配置文件期间发生错误。请查看下面的具体错误详细信息并适当地修改您的配置文件。

解析器错误消息：无法加载文件或程序集 'MySql.Data, Version=5.0.9.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d' 或其依赖项之一。该系统找不到指定的文件。

源错误：

第 37 行： 第 38 行： 第 39 行： 第 40 行： 第 41 行：

源文件：c:\webs\talkactive\gb1634\qaz.dk\web.config 行：39

## 程序集加载跟踪：以下信息有助于确定为什么无法加载程序集“MySql.Data, Version=5.0.9.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d”。

Web 服务使用 ac# 类放置在 app_code 文件夹中。该 c# 类使用 mysql。当我在普通的 .aspx 文件中使用该类时，它工作正常

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T21:26:26.977

我想显而易见的事情是检查 MySql.Data 是否存在于服务器上的 GAC（或 Web 服务的 bin 文件夹）中，并且版本和公钥是否正确？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T21:27:16.587

基本上，您缺少此 DLL。你应该看看把它放在你的 web 服务的 bin 目录中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T21:35:34.353

您想要的 MySql 客户端和服务器上安装的内容之间也可能存在版本冲突。您可以将以下部分添加到您的 web.config 文件并指定您需要的正确版本/公钥：

```
<compilation debug="false">
   <assemblies>       
      <add assembly="MySql.Data, Version=5.0.9.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d"/>
    </assemblies>
</compilation> 
```

# .net - Rhino Mocks：没有静态 MockRepository 方法的 AAA 测试语法？

> ID：387390
> 
> 赞同：4
> 
> 时间：2008-12-22T21:19:29.223
> 
> 标签：.net, mocking, rhino-mocks

我一直在使用（并且喜欢）新的 Rhino Mocks AAA 语法。然而，令我困惑的一件事是我必须像这样创建我的存根和模拟：

```
var v1 = MockRepository.GenerateStub<MyClass>(); 
```

而不是实例化的 MockRepository：

```
var mr = new MockRepository();
var v1 = mr.GenerateStub<MyClass>(); 
```

这种语法将使我的单元测试更容易转换。

从阅读 Ayende 的 wiki 看来，第二种语法应该可以工作，但我就是无法让它正常工作。如果我这样做，那么我必须使用 Record/Playback 块。在没有静态方法的情况下，我也无法在网上找到任何使用新语法的人的示例。

所以我的问题是，是否有其他人设法在不使用静态方法且无需求助于记录/播放的情况下使 AAA 语法工作？如果是这样，我错过了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T13:11:05.697

我用反射器检查了犀牛模型。

MockRepository.GenerateStub 实际上创建了一个存储库并调用了非静态存根。这是静态方法的实际作用（从反射器复制）

```
public static object GenerateStub(Type type, params object[] argumentsForConstructor)
{
    MockRepository repository = new MockRepository();
    object obj2 = repository.Stub(type, argumentsForConstructor);
    repository.Replay(obj2);
    return obj2;
} 
```

您的代码中似乎缺少对 Repository.Replay 的调用。

# linq-to-sql - 没有 .InsertOnSubmit(...) 的情况下插入 LINQ- 实体？

> ID：387406
> 
> 赞同：2
> 
> 时间：2008-12-22T21:27:40.173
> 
> 标签：linq-to-sql, submitchanges, insertonsubmit, dynamic-linq

我在使用 LINQ 时遇到了一个有趣的问题。当我实例化一个实体时，在 DataContext 上调用 .SubmitChanges() 将在数据库中插入一个新行 - 而无需调用 .Insert[All]OnSubmit(...)。

```
//Code sample:
Data.NetServices _netServices = new Data.NetServices(_connString);

Data.ProductOption[] test = new Data.ProductOption[]
{
        new Data.ProductOption
        {
             Name="TEST1", 
             //Notice the assignment here
             ProductOptionCategory=_netServices.ProductOptionCategory.First(poc => poc.Name == "laminate")
        }
};

    _netServices.SubmitChanges(); 
```

运行上面的代码将在数据库中插入一个新行。我在编写应用程序来解析 XML 文件并填充一些表时注意到了这种效果。当我只期望大约 50 个左右时，我注意到有 1000 多个插入 - 然后我终于隔离了这种行为。

如何防止这些对象被隐式持久化？

谢谢，-查尔斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T08:40:58.707

把这种关系想象成有两个方面。当您设置关系的一侧时，另一侧需要更新，因此在上述情况下以及设置 ProductOptionCategory 时，它实际上是将新对象添加到层压板 ProductOptionCategory 侧的 ProductOptions 关系中。

解决方法是您已经发现并改为设置基础外键，因此 LINQ to SQL 不会以通常的方式跟踪对象，并且需要隐式指示它应该保留对象。

当然，性能的最佳解决方案是从源数据中确定您不想添加哪些对象，并且从一开始就不要创建实例。

# java - 类.getConstantPool()

> ID：387415
> 
> 赞同：1
> 
> 时间：2008-12-22T21:32:57.993
> 
> 标签：java, reflection, jvm, jvm-hotspot

如果你从 rt.jar 库中反编译**java.lang.Class**类，你会注意到有一个本地方法声明：

```
native ConstantPool getConstantPool(); 
```

不久前，我使用 Sun 的 .class 文件规范进行了类反编译，并且能够从每个 .class 文件中获取常量池记录。但这实际上是反编译类。

只是在 Class 类中看到这个签名很惊讶。所以我所做的是我在 Main() 方法中编写了一小段代码：

```
ConstantPool cp = new ConstantPool();
cp.getMethodAtIfLoaded(0); 
```

如果你反编译**sun.reflect.ConstantPool**类，你会注意到它有很多与类、方法、参数、声明的字段等相关的方法。

当我执行应用程序时，我得到了这个 HotSpot 异常：

```
#
# An unexpected error has been detected by HotSpot Virtual Machine:
#
#  EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x6d7e01d3, pid=2816, tid=5464
#
# Java VM: Java HotSpot(TM) Client VM (1.5.0_15-b04 mixed mode)
# Problematic frame:
# V  [jvm.dll+0xa01d3]
#
# An error report file with more information is saved as hs_err_pid2816.log
#
# If you would like to submit a bug report, please visit:
#   http://java.sun.com/webapps/bugreport/crash.jsp
# 
```

为什么我不能得到任何类的**ConstantPool ？**考虑到**getConstantPool()**是本机/非公共方法这一事实，我认为 Sun 不希望我直接调用它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T23:28:36.543

sun.* 下的类不是公共 API，可能会在没有通知的情况下更改并执行各种操作。幸运的是，不受信任的代码根本无法访问它们。javac 对象供其使用。

无需反编译代码 -[原始源代码可用](http://download.java.net/jdk6/6u3/promoted/b05/index.html)，但不一定是最新的。

# java - 嵌套 PreparedStatements 的最佳实践是什么？

> ID：387417
> 
> 赞同：1
> 
> 时间：2008-12-22T21:33:48.197
> 
> 标签：java, sql, prepared-statement

我有几个实例，其中一部分遗留 sql 语句基于依赖项。例如。

```
if (x !=null)
{
  SQL = "SELECT z WHERE x > y";
}
else
{
  SQL = "SELECT z WHERE x <= y";
} 

SQL2 = SQL + " JOIN a ON b"; 
```

我正在用这个遗留代码创建 PreparedStatements。这里的最佳做法是什么。我应该为 var SQL 创建一个 PreparedStatement 并将其嵌套在 SQL2 中吗？是否应该有多个基于 SQL2 的 PreparedStatement 没有嵌套，或者完全不同？

代码比示例复杂得多，因为 SQL var 在许多长而复杂的 SQL 查询中重复使用。

编辑：项目设计需要使用 PreparedStatements，目前我没有选择使用库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T22:37:07.723

*>我应该为 var SQL 创建一个 PreparedStatement 并将其嵌套在 SQL2 中吗*

不

*> 还是应该有多个基于SQL2的PreparedStatement没有嵌套*

是的

此外：如果您可以为每个查询创建一个字符串，那就更好了。我不太喜欢将 SQL 与代码混合使用。它使调试和理解变得更加困难，您无法复制/粘贴到 SQL 工具来轻松对其进行测试。通过将 SQL 从代码中分离出来，您可以将查询与操作（实际的 fetch ）隔离开来，并且更容易维护。另外，如果代码不是你的，它会更容易理解。

看起来你在重复字符串并不重要，重点是尽可能简化语句。

我会做这样的事情：

```
final class DatabaseQueries {
    public final static String SOME_SCENARIO       = "SELECT z WHERE x > y JOIN A, B ";
    public final static String SOME_OTHER_SCENARIO = "SELECT z WHERE x <= y JOIN A, B";
 } 
```

然后在你的课堂上使用它：

```
 PreparedStatement pstmt = getCon().prepareStatement( getQuery() );

 private String getQuery() { 
     if( x != null ) { 
          return DatabaseQueries.SOME_SCENARIO;
     } else { 
           return DatabaseQueries.SOME_OTHER_SCENARIO;
     }
 } 
```

在创建“DatabaseQueries”类时，您会发现重复了很多字符串，我认为用其他常量替换某些部分会很好。

```
final class DataBaseQueries { 
    // this one is private
    private final static String JOIN_A_B = " join A, B ";
    public final static String SOME_SCENARIO       = "SELECT z WHERE x > y " + JOIN_A_B ;
    public final static String SOME_OTHER_SCENARIO = "SELECT z WHERE x <= y " + JOIN_A_B ;

} 
```

这里的重点是让事情变得更简单。这是第一步。在第二步中，您可以创建一个类来创建那些非常复杂的查询，但可能是 YAGNI。

如果查询太多，您可以替换它以从 ResourceBundle 加载它们，就像在这个 [问题中一样](https://stackoverflow.com/questions/382361/how-to-handle-huge-sql-strings-in-the-source-code#382389)

我希望这有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T22:33:41.600

[Ibatis](http://ibatis.apache.org/)非常擅长这一点。

```
<select id="queryName" parameterClass="com.blah.X"><!<[CDATA[
  SELECT z
  FROM a
  JOIN b ON a.id = b.foreign_key
  WHERE

  <isNotNull property="value">
    x > y
  </isNotNull>

  <isNull property="value">
    x <= y
  </isNull>

]]></select> 
```

这只是 Ibatis 可以做的一小部分，但它非常轻量级。优秀的技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:17:16.907

这不是准备好的语句参数的正确使用。参数只能用于代替 SQL 表达式中的文字值。不是表名、列名或其他 SQL 语法。

您可以使用一些库来构建 SQL 查询的一部分。我在 PHP 中开发了一个类似的库，名为[`Zend_Db_Select`](http://framework.zend.com/manual/en/zend.db.select.html).

**编辑：**我用谷歌搜索了一个类似的 Java 库，我发现这个选项可能会有所帮助：

*   [Squiggle](http://code.google.com/p/squiggle-sql/)是一个用于动态生成 SQL SELECT 语句的小型 Java 库。[它的] 甜蜜点适用于需要使用在运行时更改的标准来构建复杂查询的应用程序。通常，弄清楚如何构建此字符串可能会非常痛苦。Squiggle 消除了这种痛苦。

它是免费的，根据 Apache 许可证提供，这是一个非常灵活的开源许可证。

谷歌搜索“java query builder”发现了许多其他选项，但有些不是免费的。有些是可视化查询构建器，而不是程序化查询构建器。

另一种选择是使用像 Hibernate 这样复杂的对象关系映射框架，但这对于您当前的任务来说似乎是多余的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T22:31:19.250

[这是类似的问题](https://stackoverflow.com/questions/370818/cleanest-way-to-build-an-sql-string-in-java)

简短的回答 - 没有最好的方法。你最终可能会得到这样的结果：

```
String selectQuery =
  (new SelectQuery())
  .addColumns(t1Col1, t1Col2, t2Col1)
  .addJoin(SelectQuery.JoinType.INNER_JOIN, joinOfT1AndT2)
  .addOrderings(t1Col1)
  .validate().toString(); 
```

但对我来说，情况更糟。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T22:32:16.627

我想一方面有一种纯粹的对象方法，如果你试图理解遗留代码，这可能对你没有太大帮助。我发现在重构真正令人讨厌的遗留代码而不是力求“完美”时，简化小块通常更好、更容易，尽可能模块化和有据可查，而无需一次重写整个应用程序。我发现重构糟糕代码的最大障碍是，如果我采取的步骤太大，我就不能再确信我没有破坏任何东西——如果它那么糟糕，可能没有单元测试，并且可能存在未定义或未记录的行为。

我至少会打破逻辑和 sql 作为第一遍。你不想要的东西是这样的：

```
String sql = "yadda yadda yadda ? yadda yadda WHERE ";
if (mystery condition 1){
   sql = sql + " page=?"
}
else if (mystery condition 2)
{
 sql = sql + " ORDER BY ? "
} 
```

一段时间后，您将无法判断正在构建哪些语句。不值得节省复制初始 sql 的时间。可能更容易理解为：

```
private static final String FIND_PAGE_QUERY = "...."
private static final String ORDER_BY_QUERY =" ..."

if (mystery condition 1){
   return process(FIND_PAGE_QUERY, parameters);
}
else if (mystery condition 2)
{
  return process(ORDER_BY_QUERY, parameters);
} 
```

然后创建一些东西来包装你的查询和传递的参数，比如[Spring JDBC Row Mappers](http://static.springframework.org/spring/docs/2.0.x/reference/jdbc.html) 或类似的东西。这仍然很丑陋，但是作为您所拥有的增量步骤很容易做到，并且至少可以解决查询生成的一些混乱。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T14:32:07.453

另一种方法是将条件移动到 SQL 语句本身，这样您只需要一个语句。它会是这样的：

```
SELECT z WHERE (? IS NOT NULL AND x > y) OR (? IS NULL AND x <= y) 
```

然后为参数绑定一个适当的值。

不确定这是不是最好的方法......人们可能会发现代码不太清楚。但这是一种可能。

# c# - Windows 窗体：进度条无响应

> ID：387421
> 
> 赞同：4
> 
> 时间：2008-12-22T21:35:14.213
> 
> 标签：c#, winforms

我有一个小应用程序来转换几种文件格式，主窗口窗体包含几个文本框、按钮等。我有另一个“文档”类来处理所有实际的转换工作，我的窗体基本上遍历所有文件，并调用适当的 Document 方法来转换文件。但是，在发生这种情况时，表单会停止响应。我创建了另一个带有进度条和取消按钮的简单表单，当转换开始时会生成一些反馈给我们（很容易紧张）的用户。但是，当新表单加载时，所有控件都是白框，并且它也停止响应。转换完成后，进度条正确关闭，主窗体再次响应。

有没有一种简单的方法可以让这两个表单独立，让进度条在另一个表单无响应的情况下也能运行？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T21:40:30.913

[最简单的解决方案是使用BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx "后台工作者")组件在后台线程上完成处理。您可以从 VS 工具箱中将其拖入。它允许您使用进度通知更新 UI 线程，以便您可以更新进度条以显示实际值（这比拥有“选框”样式的进度条更加用户友好）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T21:40:58.853

您应该使用两个线程，以便表单在您工作时继续响应。

这很常见，以至于 .NET 有一个 BackgroundWorker 控件来为您包装其中的一些内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:02:49.760

只是偶尔调用 Application.DoEvent()，可能在你的循环中。不像BackgroundWorker那样正确，但它更简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T22:43:12.143

最简单的解决方案是使用 BackgroundWorker 组件在后台线程上完成处理。您可以从 VS 工具箱中将其拖入。它允许您使用进度通知更新 UI 线程，以便您可以更新进度条以显示实际值（这比拥有“选框”样式的进度条更加用户友好）。

# c# - 枚举定义中的波浪号 (~) 是什么？

> ID：387424
> 
> 赞同：151
> 
> 时间：2008-12-22T21:36:07.630
> 
> 标签：c#, enums, language-features, enumeration

我总是很惊讶，即使在使用 C# 这么久之后，我仍然设法找到我不知道的东西......

我已经尝试在互联网上搜索这个，但是在搜索中使用“~”对我来说并不那么好，而且我在 MSDN 上也没有找到任何东西（并不是说它不存在）

我最近看到了这段代码，波浪号（~）是什么意思？

```
/// <summary>
/// Enumerates the ways a customer may purchase goods.
/// </summary>
[Flags]
public enum PurchaseMethod
{   
    All = ~0,
    None =  0,
    Cash =  1,
    Check =  2,
    CreditCard =  4
} 
```

看到它我有点惊讶，所以我尝试编译它，它起作用了……但我仍然不知道它的含义/作用。有什么帮助吗？？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-12-22T21:38:17.140

~ 是一元补码运算符——它翻转其操作数的位。

```
~0 = 0xFFFFFFFF = -1 
```

在二进制补码算术中，`~x == -x-1`

~ 运算符几乎可以在任何从 C 中借用语法的语言中找到，包括 Objective-C/C++/C#/Java/Javascript。

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-12-22T21:42:59.987

我认为：

```
[Flags]
public enum PurchaseMethod
{
    None = 0,
    Cash = 1,
    Check = 2,
    CreditCard = 4,
    All = Cash | Check | CreditCard
 } 
```

会清楚一点。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-12-22T21:37:42.587

```
public enum PurchaseMethod
{   
    All = ~0, // all bits of All are 1\. the ~ operator just inverts bits
    None =  0,
    Cash =  1,
    Check =  2,
    CreditCard =  4
} 
```

由于 C# 中有两个补码，`~0 == -1`所以二进制表示中所有位均为 1 的数字。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-12-22T22:38:03.887

它比

```
All = Cash | Check | CreditCard 
```

解决方案，因为如果您稍后添加另一种方法，请说：

```
PayPal = 8 , 
```

您将已经使用波浪号-All，但必须更改其他的所有线。所以它以后不容易出错。

问候

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-12-22T23:00:36.493

只是一个旁注，当你使用

```
All = Cash | Check | CreditCard 
```

你有一个额外的好处，它`Cash | Check | CreditCard`会评估`All`而不是另一个值 (-1)，它不等于 all，同时包含所有值。例如，如果您在 UI 中使用三个复选框

```
[] Cash
[] Check
[] CreditCard 
```

并对它们的值求和，然后用户将它们全部选中，您将`All`在生成的枚举中看到。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-11-04T22:01:01.767

对于发现这个问题很有启发性的其他人，我有一个简单的`~`例子可以分享。以下来自于绘制方法实现的片段，如[本 Mono 文档](http://www.java2s.com/Open-Source/CSharp/2.6.4-mono-.net-core/System.Windows.Forms/System/Windows/Forms/DataGridViewRowPrePaintEventArgs.cs.htm)中所详述，使用`~`效果非常好：

```
PaintCells (clipBounds, 
    DataGridViewPaintParts.All & ~DataGridViewPaintParts.SelectionBackground); 
```

如果没有`~`运算符，代码可能看起来像这样：

```
PaintCells (clipBounds, DataGridViewPaintParts.Background 
    | DataGridViewPaintParts.Border
    | DataGridViewPaintParts.ContentBackground
    | DataGridViewPaintParts.ContentForeground
    | DataGridViewPaintParts.ErrorIcon
    | DataGridViewPaintParts.Focus); 
```

...因为枚举看起来像这样：

```
public enum DataGridViewPaintParts
{
    None = 0,
    Background = 1,
    Border = 2,
    ContentBackground = 4,
    ContentForeground = 8,
    ErrorIcon = 16,
    Focus = 32,
    SelectionBackground = 64,
    All = 127 // which is equal to Background | Border | ... | Focus
} 
```

注意到这个枚举与 Sean Bright 的答案相似吗？

我认为对我来说最重要的一点`~`是枚举中的运算符与普通代码行中的运算符相同。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-22T21:42:52.653

它是一个补码运算符，这是我经常参考的按位运算符的一篇文章

[http://www.blackwasp.co.uk/CSharpLogicalBitwiseOps.aspx](http://www.blackwasp.co.uk/CSharpLogicalBitwiseOps.aspx)

msdn 在他们的枚举文章中也使用了它，这表明它使用得更好

[http://msdn.microsoft.com/en-us/library/cc138362.aspx](http://msdn.microsoft.com/en-us/library/cc138362.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-02-21T03:05:03.867

我个人使用的替代方法与@Sean Bright 的答案相同，但对我来说看起来更好，是这个：

```
[Flags]
public enum PurchaseMethod
{
    None = 0,
    Cash = 1,
    Check = 2,
    CreditCard = 4,
    PayPal = 8,
    BitCoin = 16,
    All = Cash + Check + CreditCard + PayPal + BitCoin
} 
```

请注意这些数字的二进制性质，它们都是 2 的幂，如何使以下断言成立：`(a + b + c) == (a | b | c)`. 恕我直言，`+`看起来更好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-11-15T13:55:37.130

我对 ~ 做了一些实验，发现它可能有陷阱。考虑一下 LINQPad 的这个片段，它表明当所有值一起进行运算时，All 枚举值的行为不符合预期。

```
void Main()
{
    StatusFilterEnum x = StatusFilterEnum.Standard | StatusFilterEnum.Saved;
    bool isAll = (x & StatusFilterEnum.All) == StatusFilterEnum.All;
    //isAll is false but the naive user would expect true
    isAll.Dump();
}
[Flags]
public enum StatusFilterEnum {
      Standard =0,
      Saved =1,   
      All = ~0 
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-04-04T13:09:10.203

[Flags] 枚举中的每个位都表示启用 ( `1`) 或禁用 ( `0`)。
`~`运算符用于反转数字的所有位。示例：`00001001b`变成`11110110b`.
So`~0`用于创建启用所有位的值，例如`11111111b`8 位枚举。

只想补充一点，对于这种类型的枚举，使用按位左移运算符可能更方便，如下所示：

```
[Flags]
enum SampleEnum
{
    None   = 0,      // 0000b
    First  = 1 << 0, // 0001b
    Second = 1 << 1, // 0010b
    Third  = 1 << 2, // 0100b
    Fourth = 1 << 3, // 1000b
    All    = ~0      // 1111b
} 
```

# c# - Intellisense 未显示代码中的新控件

> ID：387426
> 
> 赞同：4
> 
> 时间：2008-12-22T21:37:31.980
> 
> 标签：c#, .net, asp.net, debugging

我已将标签控件添加到网络表单。它在我运行页面时出现，但是当我尝试使用代码隐藏来引用它时，我没有得到智能感知，而且我编写的代码也不起作用。我已经验证项目正在调试中运行，调试编译是在 web.config 中设置的。事实上，我可以调试所有页面。但是，当我转到此页面时，调试会在它上面运行，就好像没有设置断点一样。此外，在断点上，它说'断点当前不会被命中。源代码与当前代码不同，这是主要问题。不知道为什么在我重新编译整个项目时会发生这种情况。

我在页面顶部有这个：

`print("<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="MemberSearch.aspx.cs" Inherits="Portal.EmployerPortal.MemberSearch" Debug="true" %> ");`

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T21:45:58.750

过去我遇到过这个问题，因为自动生成的设计器文件很糟糕。尝试删除它们，然后让 VS 重新创建它们，这可能会解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T21:43:08.287

尝试构建 -> 清洁解决方案

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T08:49:37.020

类似的事情不时发生在我身上……我添加了一个控件，但我没有得到智能感知……VS基本上不知道控件在页面/设计器上。如果我关闭文件（代码隐藏和 HTML）并回来......一切都是 honky dory。笨重，但它的工作原理。值得一试。我正在使用 2008 顺便说一句。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-08T09:51:58.557

这是 VS 的常见问题。通常原因是由于某种布局问题而没有重新生成 .designer 文件。

删除 .designer 文件后，在解决方案资源管理器中右键单击项目名称并选择转换为 Web 应用程序。

如果这没有帮助，请阅读以下文章了解[更多信息](http://www.west-wind.com/WebLog/posts/707067.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-24T06:16:10.800

在 Visual Studio 菜单 Tools|Option 中，在 Text Editor|All Languages 中发现 Statement Completion 的三个复选框既不显示空也未选中，而是显示全彩色框 - 这通常意味着未知设置。因此，将这些全部设置为选中（打勾），我的 Intellisense 开始工作

有关更多详细信息，请使用以下链接

[http://forums.asp.net/t/1520617.aspx?Intellisense+not+displaying+controls+in+the+code+behind](http://forums.asp.net/t/1520617.aspx?Intellisense+not+displaying+controls+in+the+code+behind)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-23T19:06:00.980

在 Windows 8 中，出于某种原因，我必须以管理员身份显式运行 Visual Studio，才能在我的视图中获得智能感知。

# sql - 将一天的名称转换为其整数表示

> ID：387434
> 
> 赞同：6
> 
> 时间：2008-12-22T21:40:01.083
> 
> 标签：sql, sql-server, type-conversion

在 SQL Server 中，您可以使用 DATENAME 函数以字符串形式获取星期几

```
declare @date datetime
set @date = '12/16/08'
select datename(dw, @date) 
```

返回“星期二”

并且您可以使用 DATEPART 函数以整数形式获取星期几

```
declare @date datetime
set @date = '12/16/08'
select datepart(dw, @date) 
```

返回 3

但是假设我有一个包含字符串“Tuesday”的 varchar，我想将其转换为 3 的整数表示。当然，我可以毫不费力地写出转换，但我更愿意使用内置函数. 有这样的功能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-22T22:10:25.907

不幸的是，没有内置函数，但您可以像这样创建自己的函数：

```
 CREATE FUNCTION dbo.WeekDay(@DayOfWeek Varchar(9))
RETURNS INT
            AS
    BEGIN
    DECLARE @iDayofWeek INT
    SELECT @iDayofWeek = CASE @DayOfWeek
                    WHEN 'Sunday' THEN 1
                    WHEN 'Monday' THEN 2
                    WHEN 'Tuesday' THEN 3
                    WHEN 'Wednesday' THEN 4
                    WHEN 'Thursday' THEN 5
                    WHEN 'Friday' THEN 6
                    WHEN 'Saturday' THEN 7
        END
    RETURN (@iDayofWeek)
    END
GO 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-22T21:42:40.707

与其编写函数，不如创建一个包含描述和数值的星期几表。然后你可以简单地加入表格来获取数字。

如果您有多种方式存储天数（可能在基于字符的系统中），您可以将所有变体放入表中，因此 TUE、Tues.、Tuesday 都将映射到同一个整数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-12-16T14:49:35.153

如果我不在海量数据集上运行它，这是我使用的一个肮脏的替代方案。

```
 Select CHARINDEX(SUBSTRING('Thursday',1,3), 'MONTUEWEDTHUFRISATSUN') / 3 + 1 
```

只需将星期四替换为您选择的日期或变量即可。

它是如何工作的：SUBSTRING('Thursday',1,3) 基本上创建了 Thu，然后 charindex 找出 thu 在字符串中的位置，即 10。然后我们将 10 除以一天单词的长度，即 3，等于 3，因为我想要

星期一等于 1 星期二等于 2 星期三等于 3 星期四等于 4

我在末尾加 1

所以结果是 4。

希望对某人有所帮助，但我同意这可能不是最好的解决方案。

注意：您还可以按天数排序结果集，如下所示：

```
SELECT ID,DayNamesColumn from mytable ORDER BY CHARINDEX(SUBSTRING(DayNamesColumn ,1,3), 'MONTUEWEDTHUFRISATSUN') / 3 + 1 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-04-03T13:38:08.843

好吧 6 年后和几个版本的 SQL Server，但仍然没有内置函数来做到这一点（据我所知）。不确定[sql-server-2014](/questions/tagged/sql-server-2014 "显示标记为“sql-server-2014”的问题")是否会这样做。

我对 @RussBradberry 采取了类似的方法，刚刚完成了`IF`声明。

```
CREATE FUNCTION dbo.WeekDayInt (@DayOfWeekName VARCHAR(10))
RETURNS INT
AS
    BEGIN
        DECLARE @DayWeekNumber INT
        IF @DayOfWeekName = 'Sunday'    SET @DayWeekNumber = 1
        IF @DayOfWeekName = 'Monday'    SET @DayWeekNumber = 2
        IF @DayOfWeekName = 'Tuesday'   SET @DayWeekNumber = 3
        IF @DayOfWeekName = 'Wednesday' SET @DayWeekNumber = 4
        IF @DayOfWeekName = 'Thursday'  SET @DayWeekNumber = 5
        IF @DayOfWeekName = 'Friday'    SET @DayWeekNumber = 6
        IF @DayOfWeekName = 'Saturday'  SET @DayWeekNumber = 7;
        RETURN (@DayWeekNumber)
    END 
```

或者作为替代，它可以通过这种方式完成，这可能会更快一些，因为它会在遇到匹配时立即返回值，而不是尝试评估其他值。

```
CREATE FUNCTION dbo.WeekDayInt (@DayOfWeekName VARCHAR(10))
RETURNS INT
AS
    BEGIN
        IF @DayOfWeekName = 'Sunday'    RETURN 1
        IF @DayOfWeekName = 'Monday'    RETURN 2
        IF @DayOfWeekName = 'Tuesday'   RETURN 3
        IF @DayOfWeekName = 'Wednesday' RETURN 4
        IF @DayOfWeekName = 'Thursday'  RETURN 5
        IF @DayOfWeekName = 'Friday'    RETURN 6
        IF @DayOfWeekName = 'Saturday'  RETURN 7;
        RETURN 0;
    END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-12-16T07:45:32.670

您可以使用以下选择来获取`2017-12-15`关于（例如，不管）确定一周第一天的@@datefirst 的当前设置的iso 工作日序号。例如，将 datefirst = 1 设置为星期一。

```
select
  w.weekday_id_iso8601,
  w.weekday_id_datepart,
  w.weekday_name
from (
       values
         (7, 'Monday'),
         (8, 'Tuesday'),
         (9, 'Wednesday'),
         (10, 'Thursday'),
         (11, 'Friday'),
         (12, 'Saturday'),
         (13, 'Sunday'))
     t(weekday_id, weekday_name)
cross apply (
  select
    t.weekday_id - 6 weekday_id_iso8601,
    (t.weekday_id - @@datefirst + 1) % 7 + 1 weekday_id_datepart,
    t.weekday_name
) w
where w.weekday_id_datepart = datepart(weekday, '2017-12-15') 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T22:10:49.137

我不同意添加查找表的答案，因为在这种情况下，值是有限的并且永远不会改变。查找表连接只会增加成本。

恕我直言; 由于您的价值观有限，我只会在我的观点中使用案例陈述。这并不漂亮，但它可能是最快的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T16:00:37.183

这可能没有实际用途，但我想我只是为了好玩。:) 以下作品。

请记住，在使用 DATEPART 或 DATENAME 时，@@DATEFIRST 的值很重要并且可以改变您的结果。在联机帮助中查找 SET DATEFIRST。

```
DECLARE
    @date_name AS VARCHAR(20)

SET @date_name = 'Monday'

SELECT
    DATEPART(dw, my_date)
FROM
    (
    SELECT CAST('1900-01-01' AS DATETIME) AS my_date UNION
    SELECT CAST('1900-01-02' AS DATETIME) AS my_date UNION
    SELECT CAST('1900-01-03' AS DATETIME) AS my_date UNION
    SELECT CAST('1900-01-04' AS DATETIME) AS my_date UNION
    SELECT CAST('1900-01-05' AS DATETIME) AS my_date UNION
    SELECT CAST('1900-01-06' AS DATETIME) AS my_date UNION
    SELECT CAST('1900-01-07' AS DATETIME) AS my_date
    ) AS My_Dates
WHERE
    DATENAME(dw, my_date) = @date_name 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-22T12:56:50.253

`DayID`整数值 1 到 7在哪里。

将 DayID 添加到某个基准日期，例如 1899-12-31。（如果星期日是一周的第一天，则使用初始日期 1899-12-30）

> 1900-01-01 是星期一，1900-01-02 是星期二，依此类推。

**因此 ：**

```
select DayID, 
       datename( weekday, dateadd( day, DayID, '18991231' ) ) 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-08-24T14:33:33.727

在 SQL 2014 中，您可以使用：

SELECT DATEPART(DW, GetDate()) 这将返回星期几作为整数。

# delphi - 有趣的堆栈溢出！编译器错误？

> ID：387438
> 
> 赞同：4
> 
> 时间：2008-12-22T21:40:47.400
> 
> 标签：delphi, delphi-2009

我想知道我是否发现了编译器错误？我从我的应用程序中删除了一些旧代码，现在我在“开始”处获得了 stackoverflow（参见下面的代码和反汇编）。

```
procedure TfraNewRTMDisplay.ShowMeasurement;
var
  iDummy, iDummy2, iDummy3:integer;
begin    // STACK OVERFLOW BEFORE MY CODE STARTS
  iDummy:=0;
  iDummy2:=0;

  case iDummy2 of
    1:
      case iDummy of
        1:m_SelectedRTMMenuData.ChannelMeasSet.MeasKV.ClearMeasurementData;
        2:m_SelectedRTMMenuData.ChannelMeasSet.MeasKV.ClearMeasurementData;
      end;
  end;  
end;

NewRTMDisplay.pas.1601: begin
00983BF8 55               push ebp
00983BF9 8BEC             mov ebp,esp
00983BFB B9D4E40400       mov ecx,$0004e4d4
00983C00 6A00             push $00             // stack overflow loop
00983C02 6A00             push $00             // stack overflow loop 
00983C04 49               dec ecx              // stack overflow loop  
00983C05 75F9             jnz $00983c00        // stack overflow loop
00983C07 56               push esi
00983C08 57               push edi
00983C09 8945FC           mov [ebp-$04],eax
00983C0C 8D856005FFFF     lea eax,[ebp-$0000faa0]
00983C12 8B153C789A00     mov edx,[$009a783c]
00983C18 E88B35A8FF       call @InitializeRecord
00983C1D 8D85D00AFEFF     lea eax,[ebp-$0001f530]
00983C23 8B153C789A00     mov edx,[$009a783c]
00983C29 E87A35A8FF       call @InitializeRecord
00983C2E 33C0             xor eax,eax
00983C30 55               push ebp
00983C31 68F73C9800       push $00983cf7
00983C36 64FF30           push dword ptr fs:[eax]
00983C39 648920           mov fs:[eax],esp
NewRTMDisplay.pas.1602: iDummy:=0;
00983C3C 33C0             xor eax,eax
00983C3E 8945F8           mov [ebp-$08],eax
NewRTMDisplay.pas.1603: iDummy2:=0;
00983C41 33C0             xor eax,eax
00983C43 8945F4           mov [ebp-$0c],eax
NewRTMDisplay.pas.1605: case iDummy2 of
00983C46 8B45F4           mov eax,[ebp-$0c]
00983C49 48               dec eax
00983C4A 7571             jnz $00983cbd
NewRTMDisplay.pas.1607: case iDummy of
00983C4C 8B45F8           mov eax,[ebp-$08]
00983C4F 48               dec eax
00983C50 7405             jz $00983c57
00983C52 48               dec eax
00983C53 7436             jz $00983c8b
00983C55 EB66             jmp $00983cbd
NewRTMDisplay.pas.1608: 1:m_SelectedRTMMenuData.ChannelMeasSet.MeasKV.ClearMeasurementData;
00983C57 8D951872EBFF     lea edx,[ebp-$00148de8]
00983C5D 8B45FC           mov eax,[ebp-$04]
00983C60 8B80F0020000     mov eax,[eax+$000002f0]
00983C66 E895DBE9FF       call TRTMMenuData.ChannelMeasSet
00983C6B 8DB52072EBFF     lea esi,[ebp-$00148de0]
00983C71 8DBD6005FFFF     lea edi,[ebp-$0000faa0]
00983C77 B9A43E0000       mov ecx,$00003ea4
00983C7C F3A5             rep movsd 
00983C7E 8D856005FFFF     lea eax,[ebp-$0000faa0]
00983C84 E81B3F0200       call TDeviceMeas.ClearMeasurementData
00983C89 EB32             jmp $00983cbd
NewRTMDisplay.pas.1609: 2:m_SelectedRTMMenuData.ChannelMeasSet.MeasKV.ClearMeasurementData;
00983C8B 8D9560D9D8FF     lea edx,[ebp-$002726a0]
00983C91 8B45FC           mov eax,[ebp-$04]
00983C94 8B80F0020000     mov eax,[eax+$000002f0]
00983C9A E861DBE9FF       call TRTMMenuData.ChannelMeasSet
00983C9F 8DB568D9D8FF     lea esi,[ebp-$00272698]
00983CA5 8DBDD00AFEFF     lea edi,[ebp-$0001f530]
00983CAB B9A43E0000       mov ecx,$00003ea4
00983CB0 F3A5             rep movsd 
00983CB2 8D85D00AFEFF     lea eax,[ebp-$0001f530]
00983CB8 E8E73E0200       call TDeviceMeas.ClearMeasurementData
NewRTMDisplay.pas.1612: end; 
```

有任何想法吗？

谢谢你！mp

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T21:53:10.013

有些东西正在创建一个 320 KB 的缓冲区。调用链中是否有这些对象中的任何一个在它们内部有一个静态分配的巨大数组？也许它正试图将返回的对象之一放入堆栈。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T21:59:49.470

以下代码似乎是问题所在：

```
m_SelectedRTMMenuData.ChannelMeasSet.MeasKV.ClearMeasurementData; 
```

It looks like ChannelMeasSet is a huge data structure that the compiler is trying to copy to your stack for some reason. I'm not sure why the compiler would attempt to do that without seeing the rest of your object declaration. Furthermore, the compiler appears to have allocated two separate temporary storage areas on the stack, one for each line where you call this (even though only one will be used at any given time).

You have at least two possible solutions:

1.  Make the stack bigger. There is probably a Delphi directive for this.
2.  Rework your data structures so the compiler isn't inclined to copy huge temporary objects around.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:01:56.440

Yuliy is right: The 320KB buffer is likely an array[20] of whatever is returned by ChannelMeasSet - based on the size of the rep movsd loop.

It looks like you've got some code that is returning a very large data structure by value, rather than just a reference to it. Apart from the stack overflow issue, that's likely to be very inefficient.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T22:15:12.607

thank you for your suggestions! here is the call stack (from delphi 2009).

```
NewRTMDisplay.TfraNewRTMDisplay.ShowMeasurement
NewRTMDisplay.TfraNewRTMDisplay.DetectorSelectionChange($46552D0,drmOneAtATime)
NewRTMDisplay.TfraNewRTMDisplay.pumOnDetectorSelectionChange($46129E0)
Menus.TMenuItem.Click
Menus.TMenu.DispatchCommand(???)
Menus.TPopupList.WndProc((273, 386, 0, 0, 386, 0, 0, 0, 0, 0))
Menus.TPopupList.MainWndProc(???)
Classes.StdWndProc(15403740,273,386,0)
:7e418734 USER32.GetDC + 0x6d
:7e418816 ; C:\WINDOWS\system32\USER32.dll
:7e4189cd ; C:\WINDOWS\system32\USER32.dll
:7e418a10 USER32.DispatchMessageW + 0xf
Forms.TApplication.ProcessMessage(???)
:0051e31c TApplication.ProcessMessage + $F8 
```

am working on more of your comments here right now. come back in a few minutes.

admittedly there are some moderately large structs around. i doubt they're anywhere near that big but i'll get back to you shortly.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T22:28:35.917

stupid site; it auto refreshed, wiping out my answer. ChannelMeasSet is a record that surprised me that it occupies 1.2 MB!

```
m_SelectedRTMMenuData    a small object
ChannelMeasSet           a record
MeasKV                   a record with method ClearMeasurementData( ); 
```

strangely, the app was just now having a bunch of old code being stripped out. i have never seen a stack overflow like this one.

i'll post this comment so it doesn't get destroyed before i can finish!

thank you for your help!

# language-agnostic - “你做错了！！” 感觉

> ID：387447
> 
> 赞同：11
> 
> 时间：2008-12-22T21:43:34.917
> 
> 标签：language-agnostic

**注意**- 这个问题不是针对 RoR 或 Redmine 的插件系统的问题

* * *

我一直在为[Redmine](http://redmine.org)开发一个自定义插件，这是一个使用 Ruby on Rails (RoR) 构建的项目管理器平台。现在我不是一个*真正*的 RoR 或就此而言，一个 Ruby 人。尽管幕后一团糟，但我设法编写了插件并且一切正常。“你做错了！！” 感觉是因为我知道 RoR 是一个备受推崇的框架，所以必须有简单、更好、优雅、[在此处插入最佳实践术语]的方法来做我所做的事情。我不太关心让这段代码尽可能完美，唯一的原因是它只在内部使用，而且真的，人们只关心它“有效”（我是唯一会查看代码的人）。

能传出什么智慧之言来压制“你做错了！！” 感觉？我很确定如果这种感觉存在，那么很可能是手头的任务做错了。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-12-22T21:45:26.487

问题是什么？“你做错了！！” 感觉是我们存在的本质。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-12-22T22:35:08.167

不久前，我读了一条建议，在这种情况下对我有帮助。当您对此一无所知时，尝试以“正确”的方式做某事可能会令人瘫痪。

因此，如果我必须构建一个*客户管理应用程序*，我的第一步可能是：

**构建一个非常糟糕** *的客户管理应用程序*。

造一个好的人很难，但造一个做一两件事的蹩脚的人却很容易。虽然很难知道什么时候足够好，但很容易知道什么时候是蹩脚的。

一旦我把蹩脚的东西摆在我面前，我就可以清楚地看到需要改进的地方。而且很容易改变它，因为蹩脚的人实际上做了一些事情；因此，使用 TDD 原则，我在保持其正常工作的同时对其进行了改进。最终，蹩脚的应用程序演变成一个好的应用程序。

我处理过的许多应用程序最终都变得糟糕，一开始就试图不……因此过于复杂，难以更改、调试和改进。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-22T21:47:51.320

不要压抑这种感觉！这种*错误*的感觉是创新的关键。问问自己“如果这是错误的，那么什么会更好？”

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-22T21:50:00.877

不要认为它是“你做错了！！” 把它想象成“有什么更好的方法来做到这一点？” 最好的情况是你最终会更有效地完成它，最坏的情况是你会发现一些可能对你的下一个项目有用的东西。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-22T21:51:50.373

我从来没有完成过一段我 100% 满意的代码。但是，我不相信世界上有一段（非平凡的）代码是无法改进的。

我担心的是开发人员总是认为他们已经交付了很棒的代码。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-23T00:03:26.427

他们说作家应该每天写一些东西，不管它好不好。

[Marc Raibert 的建议](http://www.alice.org/Randy/raibert.htm)是，如果你不能写出好东西，就写出糟糕的东西，然后把它擦掉。

我的编程经验是，当我多次完成某件事时，我终于开始擅长它。

所以不要期望完美。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-22T21:46:44.677

与许多其他框架一样，RoR 使做他们预期的事情变得非常容易，而做他们没有预料到的事情则非常困难。几乎所有不是您专门为项目设计的自定义框架的框架都是如此。你必须在幕后做很多乱七八糟的事情才能做某事，这一点我一点也不惊讶。所以，如果你做了一些没有预料到的事情，那么你很自然会觉得你做错了，因为从框架设计者的角度来看，你根本不应该这样做。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-22T21:52:05.663

在许多情况下，RoR 使用“句法醋”正是为了让您感觉有更好的方法。您可能应该查看其他一些插件以了解使用的约定。一般来说，如果你遵循 RoR 的约定，感觉是对的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-08T05:47:46.510

特别是对于 Redmine，插件系统仍然是新的，我们正在努力制定最佳实践。由于 Redmine（和 Ruby on Rails）是开源的，我建议您在项目论坛上表达您的感受，看看人们的想法。其他人可能会同意您的观点，并可以帮助改进系统。

**注意**：我是Redmine的核心开发人员之一，帮助构建了Redmine插件系统，并发布了大约十几个Redmine插件。甚至我也时不时觉得事情在倒退。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-31T16:20:02.113

如果你在几年后回顾你今天写的任何一段代码，你很可能会震惊它有多糟糕。换句话说，它可能会显示你随着时间的推移取得了多大的进步。你得到的感觉是持续学习的一部分。首先让它正确并使其稳定。优雅与时俱进，而计算机编程风格的时尚变化与其他一切相同。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-06-18T16:38:51.553

“什么问题？”你做错了！感觉是我们存在的本质。”

也许不是真的相关，但是：

“程序员是以解决他之前发明的解决方案所引起的问题为生的人。”

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-02T18:17:04.237

当你第一次使用一种语言、框架等时，你会做一些“错误的”事情。当您开发其他应用程序或对原始应用程序进行调整和改进时，您会发现需要修复的地方，或者可以做得更好的地方。

在每个项目中，我几乎总是觉得我做了一些次优或不完美的事情，但归根结底，代码有效，允许人们做他们需要的事情，并且在某种程度上是成功的. 所以继续写，继续学习！

# c# - 如何使现有的公共 API 可供使用它的外部程序员测试？

> ID：387451
> 
> 赞同：6
> 
> 时间：2008-12-22T21:45:19.670
> 
> 标签：c#, .net, unit-testing

我有一个 C# 公共 API，许多第三方开发人员都在使用它，他们在上面编写了自定义应用程序。此外，该 API 被内部开发人员广泛使用。

编写这个 API 时并没有考虑到可测试性：大多数类方法都不是虚拟的，并且没有将事物分解到接口中。此外，还有一些辅助静态方法。

由于许多原因，我无法在不对程序员使用我的 API 开发的应用程序造成重大更改的情况下对设计进行重大更改。但是，我仍然希望使用此 API 的内部和外部开发人员有机会编写单元测试并能够模拟 API 中的对象。

有几种方法浮现在脑海中，但似乎都不是很好：

1.  传统的方法是强制开发人员创建一个他们控制的代理类来与我的 API 对话。这在实践中是行不通的，因为现在有数百个类，其中许多是有效的强类型数据传输对象，很难重现和维护。

2.  强制所有使用 API 的开发人员想要对其进行单元测试购买[TypeMock](http://www.typemock.com/)。这似乎很苛刻，迫使人们为每位开发人员支付 300 美元以上，并可能要求他们学习与过去不同的模拟对象工具。

3.  遍历整个项目并使所有方法虚拟化。[这将允许使用Moq](http://code.google.com/p/moq/)或[Rhino Mocks](http://ayende.com/projects/rhino-mocks.aspx)等免费工具模拟对象，但它可能会为从未打算派生的类带来安全风险。此外，这可能会导致重大更改。

4.  我可以创建一个工具，给定输入程序集将输出具有相同名称空间、类和成员的程序集，但会使所有方法虚拟化，并且它会使方法体只返回返回类型的默认值。然后，我可以在每次发布 API 更新时发布这个虚拟测试程序集。然后开发人员可以针对虚拟程序集编写 API 测试，因为它具有非常可模拟的虚拟成员。这可能有效，但为此编写自定义工具似乎有点乏味，而且我似乎无法找到一个做得很好的现有工具（尤其是与泛型配合得很好的工具）。此外，它的复杂之处在于它要求开发人员使用两个可能会过时的不同程序集。

5.  与 #4 类似，我可以遍历每个文件并在每个方法和主体中添加类似“#ifdef UNITTEST”的内容，以执行与工具相同的操作。这不需要外部工具，但它会用很多丑陋的“#ifdef”污染代码库。

还有其他我认为不合适的东西吗？我在#4 中提到的工具是否已经存在？

再一次，复杂的因素是这是一个相当大的 API（数百个类和大约 10 个文件）并且有现有的应用程序使用它，这使得很难进行剧烈的设计更改。

[Stack Overflow上有](https://stackoverflow.com/questions/131806/mocking-classes-that-arent-interfaces) 几个[问题](https://stackoverflow.com/questions/42785/how-do-you-retrofit-unit-tests-into-a-code-base) [是关于改造现有应用程序以使其可测试的通用问题，](https://stackoverflow.com/questions/107919/is-it-feasible-to-introduce-test-driven-development-tdd-in-a-mature-project)[但](https://stackoverflow.com/questions/346345/how-do-you-unit-test-a-class-that-is-dependent-on-many-other-classes) 似乎没有一个问题能解决我的担忧（特别是在许多第三方开发人员广泛使用的 API 的上下文中）。我也知道“[有效地使用旧代码](http://www.objectmentor.com/resources/articles/WorkingEffectivelyWithLegacyCode.pdf)”并认为它有很好的建议，但鉴于上述限制，我正在寻找一种特定的 .net 方法。

**更新：**我很欣赏到目前为止的答案。[Patrik Hägne](https://stackoverflow.com/users/46187/patrik-h228gne)提出的一个问题是“为什么不提取接口？” 这在一定程度上确实有效，但存在一些问题，例如现有设计有很多情况下我们需要暴露一个具体的类。例如：

```
public class UserRepository 
{ 
    public UserData GetData(string userName) 
    {
        ...
    } 
} 
```

期望具体类（例如“UserData”）的现有客户如果被赋予“IUserData”，将会中断。

此外，正如评论中提到的，在某些情况下，我们会接受一个类，然后为了方便而将其公开。如果我们接受一个接口然后不得不将它作为一个具体的类公开，这可能会导致问题。

重大重写或重新设计的最大挑战是对当前 API 的巨额投资（数千小时的开发和可能同样多的第三方培训）。因此，虽然我同意一个更好的[SOLID](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)设计重写或抽象层（最终可能成为新的 API），专注于[接口分离原则](http://www.objectmentor.com/resources/articles/isp.pdf)等项目，但从可测试性的角度来看，这将是一项艰巨的任务。目前无法证明成本合理。

我们确实对当前的 API 进行了测试，但它是更复杂的集成测试而不是单元测试。

此外，正如[Chad Myers](https://stackoverflow.com/users/10862/chadmyers)所提到的，这个问题解决了 .NET 框架本身在某些领域面临的类似问题。

我意识到我可能在这里寻找不存在的“银弹”，但感谢所有帮助。重要的部分是保护许多第三方开发人员的大量时间投资以及创建当前 API 的大量现有开发。

所有答案，尤其是那些考虑到问题的商业方面的答案，都将经过仔细审查。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T06:47:43.943

你真正要问的是，“我如何在设计我的 API 时考虑到 SOLID 和类似的原则，以便我的 API 与其他人很好地配合使用？” 这不仅仅是关于可测试性。如果您的客户在用您的代码测试他们的代码时遇到问题，那么他们在用您的代码编写/使用他们的代码时也遇到了问题，所以这是一个比可测试性更大的问题。

简单地提取接口并不能解决问题，因为很可能您现有的类接口（具体类作为其方法/属性公开的内容）在设计时没有考虑到接口隔离原则，因此提取的接口会有各种各样的问题（一些您在对先前答案的评论中提到了其中的内容）。

我喜欢将此称为 IHttpContext 问题。如您所知，由于 HttpContext.Current 的“Magic Singleton Dependency”问题，ASP.NET 很难进行测试。如果没有 TypeMock 使用的花哨的技巧，HttpContext 是不可模拟的。简单地提取 HttpContext 的接口并没有太大帮助，因为它太大了。最终，即使是 IHttpContext 也会成为测试的负担，以至于几乎不值得尝试模拟 HttpContext 本身。

识别对象职责，适当地分割接口和交互，并在设计时考虑到开放/封闭原则，并不是你试图强迫/塞进一个没有考虑这些原则的现有 API 中。

我不想给你留下这么冷酷的答案，所以我会给你一个积极的建议：你如何代表你的客户承担所有的悲伤，并在你的旧 API 之上建立某种服务/外观层。该服务层将不得不处理 API 的细节和痛苦，但会提供一个漂亮、干净、对 SOLID 友好的公共 API，您的客户可以在使用时减少摩擦。

这还有一个额外的好处，即允许您慢慢替换 API 的一部分并最终使您的新 API 不仅仅是一个门面，它就是 API（旧的 API 已被淘汰）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T05:39:45.033

另一种方法是创建 API 的单独分支并在那里执行选项 3。然后，您只需维护这两个版本并弃用前者。大多数情况下，将一个分支的更改合并到另一个分支应该会自动工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T13:10:46.993

作为对您编辑的回复，界面提取在这里确实工作得很好：

```
public interface IUserRepository
{
    IUserData GetData(string userName);
}

public class UserRepository 
    : IUserRepository
{
    // The old method is not touched.
    public UserData GetData(string userName)
    {
        ...    
    }

    // Explicitly implement the interface method.
    IUserData IUserRepository.GetData(string userName)
    {
        return this.GetData(userName);
    }
} 
```

正如我在评论中所说的那样，这可能不是在每个地方都要走的路。我认为你应该在你的 API 中确定一些要点，让你的客户能够伪造交互并从那里开始，这对你来说尤为重要。您不必完全重写整个 API，但它可以逐渐转变。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T21:51:28.893

您没有提到的一种方法（在大多数情况下我更喜欢的方法）是为您希望 API 的用户能够伪造的类提取接口。不知道您的 API 并非其中的每个类都必须提取其接口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T02:45:06.087

第三方用户不应测试您的 API。他们会希望针对您的 API 测试他们的代码，因此他们需要创建 API 的 Mocks 等，但他们将依赖您对 API 的测试来确保其正常工作。或者这就是你的意思？您想让您的 API 易于测试吗？

在这种情况下重新开始，这一次考虑测试人员:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-27T15:57:31.757

我同意金。为什么不使用您解释的最佳实践重新编写您的核心 API，并提供一组暴露旧接口但与您的新 API 通信的代理/适配器类？

老开发人员自然会被鼓励迁移到新的 API，但不会被迫立即这样做。新开发人员将简单地使用您的新 API。如果您担心开发人员仍使用旧 API，请宣布旧 API 接口的 EOL。

# ms-word - 如何以 MS Word 保留格式和语法高亮显示代码片段？

> ID：387453
> 
> 赞同：2411
> 
> 时间：2008-12-22T21:45:26.690
> 
> 标签：ms-word, code-formatting

有谁知道在 Microsoft Word 文档中显示代码并保留颜色和格式的方法？优选地，该方法也将不引人注目并且易于更新。

我试图将代码作为常规文本包含在内，这看起来很糟糕，并且在编辑常规文本时会妨碍您。我还尝试在文档中插入对象、写字板文档和文本框，然后将代码放入这些对象中。代码看起来好多了，并且在编辑其余文本时更容易避免。然而，这些对象只能跨越一页，当需要添加几页代码时，这使得编辑成为一场噩梦。

最后，我知道有更好的编辑器/格式可以毫无问题地处理这个问题，但我一直在使用 MS Word。

* * *

## 回答 #1

> 赞同：2416
> 
> 时间：2010-04-16T13:54:06.967

对我来说，这是在 word 中添加代码的最佳方式：

1.  转到`Insert`选项卡，`Text`部分，单击`Object`按钮（在右侧）
2.  选择`OpenDocument Text`哪一个会打开一个新的嵌入 Word 文档
3.  将您的代码从 Visual Studio / Eclipse 复制并粘贴到这个嵌入的 word 页面中
4.  保存并关闭

### 好处

结果看起来非常好。以下是这种方法的优点：

*   代码保持其原始布局和颜色
*   代码与文档的其余部分分开，就像是图片或图表一样
*   拼写错误不会在代码中突出显示（这很酷！）

而且只需要几秒钟。

* * *

## 回答 #2

> 赞同：1133
> 
> 时间：2010-12-22T20:58:14.650

下载并安装[**Notepad++**](http://notepad-plus-plus.org/download)并执行以下操作：

1.  将代码粘贴到窗口中；

2.  从语言菜单中选择编程语言；

3.  选择要复制的文本；

4.  右键单击并选择***Plugin commands*** -> ***Copy Text with Syntax Highlighting***；

5.  将其粘贴到 MS Word 中，您就可以开始使用了！

**2013 年 6 月 29 日更新：**

Notepad++ 有一个名为“NppExport”（预安装）的插件，允许您复制到 RTF、HTML 和 ALL。它允许数十种语言，而上述 IDE 仅限于少数几种（没有其他插件）。

我使用将所有格式复制到剪贴板并在 MS Word 中“粘贴为 HTML”。

![记事本++截图](https://i.stack.imgur.com/woIcU.jpg)

* * *

## 回答 #3

> 赞同：191
> 
> 时间：2016-11-07T19:09:35.773

[![在此处输入图像描述](https://i.stack.imgur.com/Fz9Fd.jpg)](https://i.stack.imgur.com/Fz9Fd.jpg)

**代码格式**插件现在可在 Office 365 的 Office 插件中使用！只需选择代码并单击转换，它将代码文本转换为带有行号的格式化颜色代码！！！

**小欢喜！**

此处提供代码格式：[https ://appsource.microsoft.com/en-us/product/office/WA104379501?tab=Overview](https://appsource.microsoft.com/en-us/product/office/WA104379501?tab=Overview)

* * *

## 回答 #4

> 赞同：143
> 
> 时间：2016-07-05T14:46:42.597

在阅读了很多相关答案之后，我遇到了自己的解决方案，这对我来说是最合适的。

结果如下所示： [![最终结果](https://i.stack.imgur.com/Qik8H.jpg)](https://i.stack.imgur.com/Qik8H.jpg)

如您所见，它与 Stack Overflow 上的语法突出显示相同，非常棒。

重现步骤：

在堆栈溢出

1.  Goto [Ask Question](https://stackoverflow.com/questions/ask)（最好使用**Chrome**）
2.  粘贴代码并添加**语言标签**（例如 Java）以获得语法高亮
3.  从预览中复制代码

在 Word 中

1.  插入 > 表格 > 1x1
2.  粘贴代码（您可能需要使用“编辑”菜单中的“选择性粘贴...> 格式化文本 (RTF)，以免丢失语法高亮显示）
3.  表格设计>边框>无边框
4.  选择代码>编辑>查找>替换
    搜索文档**^p**（段落标记）替换为**^l**（手动
    换行符）（这是删除某些行之间的间隙所必需的）
5.  再次选择代码 > 审阅 > 语言 > 选中“不检查拼写或语法”
6.  最后使用 References > Insert Caption > New Label > 将其命名为“Listing”或 sth 添加标题

感谢[这个人的示例代码](https://stackoverflow.com/a/9563438/4367848)

* * *

## 回答 #5

> 赞同：126
> 
> 时间：2017-03-24T21:01:44.663

有一个不错的在线工具：[http ://www.planetb.ca/syntax-highlight-word](http://www.planetb.ca/syntax-highlight-word)

↑ 此应用自 2020 年起不再可用，这是一个新的分叉工具： [https ://www.troye.io/planetb/](https://www.troye.io/planetb/)

只需复制生成的代码并将其粘贴到您的文字编辑软件中即可。到目前为止，我已经在*MS Word*和*WPS Writer*上尝试过，效果非常好。与 Firefox 不兼容，但在 Chrome 上运行良好（和 IE 也一样，但谁想使用它）。

主要好处之一是，与 Word 的代码格式加载项不同，它不会**弄乱**您的代码，并尊重各种语言的语法。我尝试了其他答案中提供的许多其他选项，但我发现这是最有效的（快速且*非常*有效）。

另一个答案（markup.su）中还引用了另一个 onlinz 工具，但我发现planetB 输出更优雅（尽管用途较少）。

**输入 ：**

[![在此处输入图像描述](https://i.stack.imgur.com/mlfmm.png)](https://i.stack.imgur.com/mlfmm.png)

**输出 ：**

[![在此处输入图像描述](https://i.stack.imgur.com/ByCak.png)](https://i.stack.imgur.com/ByCak.png)

* * *

## 回答 #6

> 赞同：78
> 
> 时间：2008-12-22T22:10:49.230

我在 Visual Studio 中键入我的代码，然后复制粘贴到 word 中。它保留了颜色。

* * *

## 回答 #7

> 赞同：33
> 
> 时间：2010-04-16T14:10:51.247

完成此操作后，我已广泛使用样式。它有很大帮助。

我所做的是创建一个段落样式（可能称为“ `Code Example`”或类似的东西），它使用等宽字体、精心挑选的标签、非常浅的灰色背景、上下细黑色边框（这有助于提高可见性）和拼写关闭。我还确保行间和段落间的间距设置正确。然后，我在顶部创建额外的字符样式（例如，“ `Comment`”、“ `String`”、“ `Keyword`”、“ `Function Name Decl`”、“ `Variable Name Decl`”），然后将它们叠加在上面；那些设置颜色以及文本是否为粗体/斜体。然后很容易通过并将粘贴的示例标记为代码并让它看起来非常好，这对于简短的片段非常有效。很长的代码块通常不应该出现在死树上。:-)

这样做的一个优点是很容易适应你正在做的任何代码。您不必依赖某些 IDE 来弄清楚发生了什么。（主要问题？打印的页面通常没有编辑器窗口那么宽，所以换行会很糟糕......）

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2008-12-22T22:02:34.753

也许这过于简单，但是您是否尝试过粘贴代码并将其上的字体设置为 Courier New？

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2008-12-22T21:48:44.750

尝试定义一种称为“代码”的样式并使其使用固定宽度的小字体，这样看起来应该会更好。

使用`CTRL`+`SPACEBAR`重置样式。

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2015-08-27T16:52:51.580

如果您使用的是**Sublime Text**，您可以将代码从 Sublime 复制到 MS Word 中，保留语法突出显示。

安装名为[SublimeHighlight](https://github.com/n1k0/SublimeHighlight)的包。

在 Sublime 中，使用光标选择要复制的代码，右键单击它，选择“复制为 rtf”，然后粘贴到 MS Word 中。

* * *

## 回答 #11

> 赞同：24
> 
> 时间：2016-09-08T16:20:12.150

如果你和我一样懒惰或赶时间不想下载额外的软件，你可以使用[http://markup.su/highlighter/](http://markup.su/highlighter/)。它非常直截了当，并支持几个突出主题和许多编程语言。[![http://markup.su/highlighter/](https://i.stack.imgur.com/scFrH.png)](https://i.stack.imgur.com/scFrH.png)在我的情况下，我使用的是[Visual Studio Code ，由于样式中涉及 CSS（如此](https://code.visualstudio.com/)[处所](https://github.com/Microsoft/vscode/issues/3518)报告），它不允许使用格式复制。

从预览框中复制文本，然后在 Word 中转到插入 -> 文本框，从网站粘贴预览，突出显示所有文本，然后[禁用该文本框的拼写检查](https://superuser.com/questions/256247/word-disable-spell-checker-for-a-paragraph/256258#256258)。

这就是代码最终的样子。[![Word 中看到的代码](https://i.stack.imgur.com/BNSdu.png)](https://i.stack.imgur.com/BNSdu.png)

* * *

## 回答 #12

> 赞同：23
> 
> 时间：2019-04-29T16:09:21.807

我正在使用[Easy Code Formatter](https://appsource.microsoft.com/en-us/product/office/WA104382008?tab=Overview)。它也是一个 Office 加载项。它允许您选择编码风格 / 并有一个快速格式化按钮。漂亮整齐。

[![在此处输入图像描述](https://i.stack.imgur.com/OxEwO.png)](https://i.stack.imgur.com/OxEwO.png)

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2020-04-03T12:00:39.560

我发现的最好方法是使用表格。

创建一个 1x1 的表。然后复制代码并粘贴。
如果您使用的是桌面应用程序，那么它将继承代码编辑器主题颜色并相应地粘贴它，否则您可以将表格样式更改为任何颜色。

[![在此处输入图像描述](https://i.stack.imgur.com/F5FlN.png)](https://i.stack.imgur.com/F5FlN.png)

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2008-12-22T21:49:37.493

这有点间接，但效果很好。获取 LiveWriter 并安装此插件：

[http://lvildosola.blogspot.com/2007/02/code-snippet-plugin-for-windows-live.html](http://lvildosola.blogspot.com/2007/02/code-snippet-plugin-for-windows-live.html)

使用插件将您的代码插入博客文章中。全选并复制到Word。

它看起来很棒，并且可以包含行号。它还可以很好地跨越页面。

高温高压

科尔比非洲

* * *

## 回答 #15

> 赞同：13
> 
> 时间：2016-01-29T10:03:08.753

[Vim](http://www.vim.org/about.php)有一个漂亮的功能，可以将代码转换为 HTML 格式，保留语法高亮、字体样式、背景颜色甚至行号。运行`:TOhtml`并 vim 创建一个包含 html 标记的新缓冲区。

接下来，在 Web 浏览器中打开这个 html 文件，然后复制/粘贴它呈现给 Word 的任何内容。Vim 技巧 wiki 有[更多信息](http://vim.wikia.com/wiki/Pasting_code_with_syntax_coloring_in_emails)。

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2012-04-14T22:53:02.273

根据我的经验，来自 eclipse 和 Notepad++ 的复制粘贴直接与 word 一起使用。

出于某种原因，我遇到了一个没有保留颜色的文件的问题。我创建了一个新的 .java 文件，将代码复制粘贴到该文件，然后将其复制粘贴到 word 并且它起作用了......

正如其他人所说，创建一个新的段落样式。我所做的是使用像 courier new 这样的单行距字体，字体接近 8px 的小尺寸，段落之间没有空格的单行距，使制表位变小（0.5cm，1cm，..，5cm），放置一个简单的线条边框围绕文本并禁用语法检查。这样我就实现了日食的线制动，所以我不必再做任何事情了。

希望我有所帮助；）

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2017-06-20T09:58:52.500

这是我遵循的最简单的方法。考虑我想粘贴 java 代码。

1.  我在这里粘贴代码，以便整齐地格式化空格、制表符和花括号[http://www.tutorialspoint.com/online_java_formatter.htm](http://www.tutorialspoint.com/online_java_formatter.htm)

2.  然后我在这里粘贴从第 1 步得到的代码，以便将颜色、字体添加到代码[http://markup.su/highlighter/](http://markup.su/highlighter/)

3.  然后将步骤 2 中获得的预览代码粘贴到 MS 字中。最后它看起来像这样

[![在此处输入图像描述](https://i.stack.imgur.com/9WW8s.png)](https://i.stack.imgur.com/9WW8s.png)

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2018-07-28T10:18:40.930

您可以使用 VS 代码来保持代码格式和突出显示。直接从VS复制粘贴代码。[![在此处输入图像描述](https://i.stack.imgur.com/rNQTi.png)](https://i.stack.imgur.com/rNQTi.png)

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2019-07-14T06:52:10.663

**2019 年试图解决此问题的人们的答案：**

这个问题的大多数答案现在已经过时了。我希望有一种方法可以不时地重新检查旧的问题和答案！

我为这个问题找到的适用于 Office 365 及其相关程序的方法可以在[这里](https://stackoverflow.com/a/37665153/5851759)找到。

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2011-03-25T19:55:51.700

我正在使用 Word 2010，我喜欢从 github gist 复制和粘贴。只要记住保持源格式！

然后我将字体更改为 DejaVu Sans Mono。

您可以选择复制或不复制编号。

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2008-12-23T00:18:59.110

使用Windows 附带的等宽字体[，例如 Lucida Console 。](http://www.ascendercorp.com/font/lucida-console/)如果您从 Visual Studio 或支持语法突出显示的东西中剪切/粘贴，通常可以保留语法突出显示的配色方案。

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2012-03-12T18:23:59.147

复制到 Eclipse 中并将其粘贴到 Word 中也是另一种选择。

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2018-08-14T09:40:59.287

如果您使用的是 Intellij IDEA，只需从 IDE 中复制代码并将其粘贴到 word 文档中即可。

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2021-03-01T12:36:39.447

您可以在任何办公程序上简单地使用此插件。

转到**insert**选项卡，然后**Get Add-ins**，然后搜索**[Easy Syntax Highlighter](https://appsource.microsoft.com/en-us/product/office/WA200000011?src=office&corrid=ed792760-d49c-44d9-ba0e-8ecff21788cd&omexanonuid=34dd7a07-8ed2-480c-88ec-67b6b4e688fc&referralurl=)**

它支持

*   185 种语言和 89 个主题。

*   自动语言检测。

*   多语言代码高亮。

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2011-03-11T07:08:40.257

如果您不想安装繁重的 IDE，也可以使用 SciTE 粘贴代码，然后为您正在制作的所有代码下载插件。只需从语言菜单中选择您的语言，键入您的代码，突出显示代码，选择编辑-> 复制为 RTF，粘贴到 Word 格式（默认粘贴）。

SciTE 支持以下语言，但可能支持其他语言：Abaqus*、Ada、ANS.1 MIB 定义文件*、APDL、汇编程序（NASM、MASM）、Asymptote*、AutoIt*、Avenue*、批处理文件（MS-DOS） , Baan*, Bash*, BlitzBasic*, Bullant*, C/C++/C# *, Clarion* , cmake*, conf (Apache) *, CSound* , CSS*, D, diff files*, E-Script*, Eiffel*, Erlang* , 旗舰 (Clipper / XBase) *, Flash (ActionScript)*, Fortran*, Forth*, GAP*, Gettext, Haskell, HTML*, HTML with embedded JavaScript, VBScript, PHP and ASP*, Gui4Cli*, IDL - MSIDL and XPIDL*, INI, properties* and similar, InnoSetup*, Java*、JavaScript*、LISP*、LOT*、Lout*、Lua*、Make、Matlab*、Metapost*、MMIXAL、MSSQL、nnCron、NSIS*、Objective Caml*、Opal、Octave*、Pascal/Delphi*、Perl , 大部分情况除外*、PL/M*、Progress*、PostScript*、POV-Ray*、PowerBasic*、PowerShell*、PureBasic*、Python*、R*、Rebol*、Ruby*、Scheme* 、scriptol*、Specman E*、Spice、Smalltalk、SQL 和 PLSQL、TADS3*、TeX 和 LaTeX、Tcl/Tk*、VB 和 VBScript*、Verilog*、VHDL*、XML*、YAML*。

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2016-03-29T11:42:14.217

我也在寻找它并最终为我的代码显示创建了一些东西。这是一个好方法：

*   创建一个矩形并将文本放入其中。
*   将字体更改为 Consolas，大小约为 10。
*   将文本字体更改为接近黑色的灰色（灰色 25%，深色 75%）
*   如果需要，使用较深的颜色突出显示您的文本，并选择一种作为轮廓。

[![在此处输入图像描述](https://i.stack.imgur.com/cCmAX.png)](https://i.stack.imgur.com/cCmAX.png)

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2020-05-28T15:11:22.543

一个有多种语言的着色网站。 [http://hilite.me/](http://hilite.me/)

您可以自己托管一个，因为它是开源的。代码在[github 上](https://github.com/alexkay/hilite.me)。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2008-12-22T21:50:11.080

确实没有一种干净的方法可以做到这一点，根据您的确切样式设置，它仍然可能看起来很可疑。

您可以尝试做的是首先运行代码到 HTML 的转换（有很多程序可以做到这一点），然后尝试用 word 打开 HTML 文件，这可能会为您提供格式化和漂亮的代码，然后将其复制并粘贴到您的文档中。

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2018-11-05T12:35:39.690

我使用**表格**创建了一种更简单的方法，因为它们更易于创建、管理和更一致（*可以将表格的样式保存在文档本身中*），但我找不到更好的代码着色方案方法，对此感到抱歉。

**脚步：**

1.  创建一个 3x3 表。

2.  选择表格，使其边框不可见（“***无边框****”选项*），然后激活“**查看网格线**”选项。 [![在此处输入图像描述](https://i.stack.imgur.com/QKNJ1.png)](https://i.stack.imgur.com/QKNJ1.png)

3.  调整单元格的间距和列的宽度以获得所需的方面。（*您必须进入“**表属性**”进行微调*）。 [![在此处输入图像描述](https://i.stack.imgur.com/rkWQT.png)](https://i.stack.imgur.com/rkWQT.png)

4.  为您的代码片段创建一个名为“**代码”的“****段落样式”（***如**[https://stackoverflow.com/a/25092977/8533804](https://stackoverflow.com/a/25092977/8533804)*中所述）

***   创建另一个名为“ **Code_numberline ”的“****段落样式**” ，它将基于先前创建的样式，但是您将在其定义中添加一个编号行（这将自动进行行编号）。 **[![在此处输入图像描述](https://i.stack.imgur.com/4ve2B.png)](https://i.stack.imgur.com/4ve2B.png)**

    ***   将“ **Code_numberline** ”应用于第一列，将“ **Code** ”应用于第 3 列。 [![在此处输入图像描述](https://i.stack.imgur.com/A7xiI.png)](https://i.stack.imgur.com/A7xiI.png)

    *   在中间列中添加一个填充。 [![在此处输入图像描述](https://i.stack.imgur.com/DAYWF.png)](https://i.stack.imgur.com/DAYWF.png)

    *   保存该表格样式并享受！**** 

 ***** * *

## 回答 #30

> 赞同：4
> 
> 时间：2009-01-07T19:55:44.240

文档中代码的最佳表示是固定宽度的字体（它应该出现在 IDE 中），带有模糊的阴影背景或浅色边框，以将块与其他文本区分开来。

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2010-11-29T15:52:59.070

如果它的 Java 源代码将其复制到 Visual Studio，然后将其复制回 Word。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2012-03-15T21:37:18.393

好的，这很奇怪，但是为了解决我在文本中正常粘贴的背景颜色问题，选择整个块，单击荧光笔工具进行高亮（即使高亮设置为“无颜色”），然后我可以设置文本块的样式，而不会使文本的背景颜色保持白色。我正在使用 VS 11 和 Word 2010，但问题已经存在了很长时间（请参阅[http://www.visualstudiodev.com/visual-studio-setup-installation/copypaste-code-from-vs-1305.shtml](http://www.visualstudiodev.com/visual-studio-setup-installation/copypaste-code-from-vs-1305.shtml) )

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2015-08-30T00:15:11.753

如果您使用的是**Android Studio**，您可以简单地复制和粘贴，并且将保留代码方面和颜色。够简单！

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2016-04-01T13:02:27.100

从 Powershell ISE**复制并粘贴**到 Word。
与 Visual Studio 相同。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2019-02-04T14:26:35.163

我已阅读并尝试了所有帖子，我想概述一下所有解决方案。最好的方法取决于您的要求。如果只有不超过一页的短片段，则使用插入对象。如果代码长于一页，请使用 RTF 格式。

**插入文本框**

*   不能分页
*   拼写检查可用
*   格式化会很快被破坏
*   在数千页的文档中，Word 2016 开始出现问题。在某些时候，Word 在尝试插入新文本框时总是崩溃。

**插入对象 > 文档**

*   不能分页
*   没有拼写检查
*   格式和内容保持安全

**RTF 格式**

*   可能的分页符
*   拼写检查可用
*   从word再次复制代码时烦人的行号
*   在线：Planet2b.ca [http://www.planetb.ca/syntax-highlight-word](http://www.planetb.ca/syntax-highlight-word)
*   离线：高亮[http://www.andre-simon.de/doku/highlight/highlight.php](http://www.andre-simon.de/doku/highlight/highlight.php)

或任何其他所见即所得的编辑器/在线工具/库来设置代码样式。

**一些插件/附加组件**

全部关闭或不再工作。

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2015-04-04T12:09:50.877

只需将您的代码粘贴到 MS Words 中，选择它 -> 然后右键单击 -> 编号。在这种情况下，MS Word 会将您的代码解释为标记/编号列表。

这是屏幕：

[屏幕1](https://drive.google.com/open?id=0BxqHIsjAh-jWQV9IV09fZmY2cWM&authuser=0)。

[屏幕2](https://drive.google.com/open?id=0BxqHIsjAh-jWOFM4a1ppU0dCd00&authuser=0)。

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2015-11-12T15:19:11.823

如果您使用的是 TextMate（在 OS X 上），请使用“copy as rtf”命令。它将漂亮打印的文本放在剪贴板上。[![rtf 命令](https://i.stack.imgur.com/crdqp.png)](https://i.stack.imgur.com/crdqp.png)

从那里您可以粘贴到 word 或其他任何内容中。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2018-05-31T16:06:36.053

我使用的一种快速方法是使用带有堆栈溢出预览的 Snipping Tool（已经内置在 Microsoft 工具中）。

一旦我将代码输入到“提问”框中，我就会捕获预览并将其作为图片插入到 MS Word 文档中。

[![在此处输入图像描述](https://i.stack.imgur.com/QqC8I.png)](https://i.stack.imgur.com/QqC8I.png)

以上是结果，一张图片，（不是SO代码）你可以用文字表达。

无需担心格式化、语法检查或下载新软件或插件！

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2016-09-08T10:03:37.170

如果您已经创建了包含大量代码片段的文档，并且您正在与时间赛跑（不幸的是我就是这样）。将文件另存为`.doc`，`.docx`然后瞧！为我工作。呸！

**注意：**显然您的文档不能具有 > word 2007 中的花哨功能。

**注意 2：**如果您担心，文件大小会变大。

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2018-02-01T10:06:45.463

至少对我来说，最简单的解决方案是将代码粘贴到文档中，突出显示它，然后导航到：

主页 -> 样式 -> << 按样式单击下拉箭头 >> -> 代码

这样做的好处是现在可以在文档中搜索代码（与 gargamel 的解决方案不同），并且能够格式化多页的代码。

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2019-02-01T14:33:31.313

只需右键单击并使用**“保留源格式”**选项进行粘贴。我几乎每天都这样做来记录我的工作。此外，您可以在**File/Options/Advanced/Cut,CopyPaste中设置****“默认粘贴”**以从各种来源粘贴。也很有用：在 Word 选项的同一部分中启用**“显示粘贴选项”**。

 ****请注意，代码编辑器主题中的所有文本属性（颜色、字体等）都将添加到 Word 文档的样式表中，因此我建议您**不要直接对粘贴的文本进行任何更改，**因为这会添加样式表混乱，随后的粘贴将不匹配。快速研究一下在 Word 中使用“样式”（实际上是 CSS）对您大有裨益。他们非常强大。使用 Word 的样式表可以对粘贴的文本进行全局更改，但可能会导致后续粘贴的文本添加新样式。

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2020-11-05T15:58:57.343

您可以将代码粘贴到[LINQPad](https://www.linqpad.net)中。然后从 LINQPad 复制到 MS Word。LINQPad 支持以下编程语言：C#、VB、SQL、ESQL 和 F#

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2019-06-17T11:56:26.937

答案中似乎还没有提到 Hilite，所以：Hilite 支持多种语言（20 多种），也可以通过 API 在线使用，并且在 Github 上（因此您可以在您[的](http://hilite.me/)如果您不信任在线服务，请拥有）。在线版本也可以通过 CSS 规则根据自己的需要进行调整。

我几分钟前才发现它，因为我需要一个将 xQuery 复制到 Word 中的工具，但找不到合适的工具。源程序是baseX，由于某种原因，它的格式无法传输到Word（粘贴时也不能通过*保持格式等）。*此外，许多给定的答案现在（即 06/2019）不再工作或不支持 xQuery。然而，海力达的工作做得很好。

**编辑：** 代码块不是结果的一部分，不幸的是，只是突出显示。尽管如此，总比没有好，通过添加块来调整结果仍然比手动格式化每一行要少

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2021-11-20T10:35:46.643

*   我所做的是使用 Google Backup and Sync 并将 docx 文件放在与 Google Drive 同步的文件夹中。
*   然后在 chrome 中打开文件，因为谷歌驱动器具有解析 docx 文件的功能。
*   然后运行这个插件[https://workspace.google.com/marketplace/app/code_blocks/100740430168](https://workspace.google.com/marketplace/app/code_blocks/100740430168)它将代码格式化为具有良好主题的不同语言。
*   完成后保存并在同步后在系统中打开 docx 文件。

# php - 如何检查 html 表单中的必填字段是否已填写？

> ID：387466
> 
> 赞同：1
> 
> 时间：2008-12-22T21:49:29.723
> 
> 标签：php, javascript, validation, forms

我在 php 中有一个提交页面，其中包含一个指向同一页面的 html 表单。我希望能够检查表单中的必填字段是否未填写，以便通知用户。我想知道如何分别使用 php 和 javascript 来做到这一点。但是，我想这是一个常见问题，因此欢迎任何其他答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T21:59:03.277

检查发布部分 php

```
 if(isset($_POST['save']))
    {
            $fields=array();
            $fields['Nimi']   = $_POST['name'];
            $fields['Kool'] = $_POST['school'];
            $fields['Aadress'] = $_POST['address'];
            $fields['Telefon'] = $_POST['phone'];
            $fields['Email'] = $_POST['email'];

            foreach ($fields as $key => $val)
            {   if(trim($val)=='')
                {   $errmsg=$key." is not filled!";
                    break;
                }
            }
    }

if($errmsg == '')
{ //do your saving here
  exit();
}

if(!isset($_POST['save']) || $errmsg != '')
{ //show your form here
 // and make it to return to the same page on submit
 //<input name="save" type="submit" value="Save" onclick="return true;">
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T22:19:19.117

为了获得额外的荣誉，一旦您从 Riho 和 anakata 的答案中知道如何在 PHP 和 JavaScript 中执行此操作，然后构建一种以单一表单定义字段约束的方法，该表单既可以呈现为 JavaScript 以进行客户端验证，也可以在服务器。

由于您需要两者（客户端方便用户，服务器端因为我们现在真的非常信任客户端），所以从单个基础架构支持两者似乎是一个不错的主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:03:32.880

就 JS 而言，您必须在提交之前进行检查。通常，这涉及将一些验证函数绑定到表单的 onsubmit 事件触发器，并且该验证函数将包含对您感兴趣的每个字段的一些测试。

大多数 JS 库都有验证实现，可以为您完成大部分工作，这听起来对您来说可能是个好主意。谷歌搜索“客户端验证”将产生无限的结果，但这（我与库无关，请自行阅读和选择）应该让你开始*：

[http://blog.jquery.com/2007/07/04/about-client-side-form-validation-and-frameworks/](http://blog.jquery.com/2007/07/04/about-client-side-form-validation-and-frameworks/)

[http://tetlaw.id.au/view/blog/really-easy-field-validation-with-prototype/](http://tetlaw.id.au/view/blog/really-easy-field-validation-with-prototype/)

[http://dojotoolkit.org/book/dojo-book-0-4/part-4-more-widgets/forms/validation](http://dojotoolkit.org/book/dojo-book-0-4/part-4-more-widgets/forms/validation)

*这是教你钓鱼计划

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T00:36:36.450

LiveValidation 库会帮助你很多： [http ://www.livevalidation.com/](http://www.livevalidation.com/)

# jsf - 企业应用程序中的 JSF

> ID：387469
> 
> 赞同：0
> 
> 时间：2008-12-22T21:50:04.980
> 
> 标签：jsf

JSF 是否正在企业中使用，或者至少在使用中增长？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T22:02:40.040

是的，它正在被使用。

用途广泛吗？我不这么认为。它的使用可能比 Wicket 多，但比 Spring MVC 少，至少在与我自己的同行的对话中是这样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T13:05:28.860

我们在我的公司以“企业”的方式使用它，我知道我工作过的前两家公司已经在各种项目中使用它。另一个更受欢迎的框架是 Struts 1。

[该页面](http://wiki.java.net/bin/view/Projects/RealWorldJSFLinks)提供了一些“真实世界”的 JSF 链接。

# java - 具有优先级的消息处理

> ID：387471
> 
> 赞同：6
> 
> 时间：2008-12-22T21:50:30.127
> 
> 标签：java, message-queue

在 Java Web 应用程序中，我有一个 A 类型的重复消息负载（例如，每小时 20,000 条）。然后我有第二种类型的消息（B 型）偶尔出现，但优先级高于 A 型（比如 3,000）。我希望能够使用开源软件在一台或多台机器上处理这些消息。

在我看来，如果我有一个 JMS 服务器可以根据优先级从其队列中发送消息（例如，发送三个 B 类型的消息，然后发送一个 A 类型的消息，即使所有 A 类型的消息都是在消息队列的顶部）。

您知道可以执行此操作的 JMS 服务器吗？或者您知道实现此操作的另一种方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T21:58:50.750

JMS 标准支持的消息优先级默认为 4，可以指定其他）。我认为您需要在消息生产者和消息本身中设置它（两者都有方法）。

我认为 ActiveMQ 确实支持它。

但是，许多 JMS 代理默认禁用优先级处理。在代理配置的某处，您可能需要更改一个标志，例如“supportJMSPriority”。

此外，Apache Camel 允许您编写自己的消息重排序器，以便您可以实现任何形式的优先级。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T00:09:46.023

在 MessageProducer（QueueSender 等）上调用“send(..)”时设置消息优先级。或者，您可以将 MessageProducer 的默认优先级设置为 0-9（9 为最高）。设置消息本身的优先级是行不通的。它被 Producer 覆盖。

Uri 是正确的——是否尊重优先级是特定于实现的。我相信 OpenJMS 通常尊重开箱即用的优先级，但不保证这一点。

JMS 规范指出：`"JMS does not require that a provider strictly implement priority ordering of messages; however, it should do its best to deliver expedited messages ahead of normal messages."`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T20:40:21.933

为什么不考虑使用另一个 MDB 显式处理其他消息类型。上面的优先级细节仍然适用，此外，您可以更好地控制每种消息类型的并发处理。

对于大多数情况，我更喜欢每种消息类型有 1 个 mdb 或消息接收器。这样，如果事务回滚，您会立即知道是哪种类型的消息导致了问题

卡尔

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T20:56:51.907

您可以使用多个主题。即使有优先级，如果您的处理器忙于处理较低优先级的消息，它也不会停止它的工作。

If you have separate processors, a high priority message can start processing as soon as it can be delivered, not waiting for any other message to be processed.

# html - 如何在不被防火墙阻止的情况下显示网页？

> ID：387476
> 
> 赞同：0
> 
> 时间：2008-12-22T21:52:39.233
> 
> 标签：html, browser

我希望我们的应用程序显示在线帮助页面（因此它始终是最新的）甚至是本地页面。但是，它很可能被防火墙（区域警报）阻止。

顺便说一句，我用区域警报测试了这个。它阻止了对本地 .html 文件以及 Internet 上的 .asp 文件的访问。（即，尝试在 Internet Explorer 中显示一个页面，然后出现区域警报对话框，询问我是否要授予显示权限

有没有解决的办法？也许在 Web 浏览器控件中显示网页？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T21:57:55.120

如果网络浏览器没有被防火墙阻止，那么他们可能会为任何应用程序打开端口 8080，因此您的应用程序不应被阻止。

如果防火墙只允许 8080 端口访问 IE；您必须在防火墙上打一个洞才能使用新的浏览器，例如 firefox 或 chrome。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T22:05:25.730

实际上，防火墙阻止网络流量的可能性很小（除非您的意思是文件类型被阻止？）。但是，在这样的设置中，您可能需要使用与 IE 相同的代理，因为可能会阻止直接流量。

最简单的方法是使用高级 Windows API 或 IE 本身，如果有新的帮助文件，HTTP 会下载最新的帮助文件——这些机制应该知道任何代理。

当然，您的用户可能没有使用 IE，即使大多数用户都在使用。因此，您可能需要允许用户指定代理，或者能够以与浏览器相同的方式自动配置代理。

*编辑：我明白你的意思是 zonealarm 是问题的一部分。是的，这很棘手，因为您必须让客户组织中管理 zonealarm 的人集中“祝福”您的应用程序，或者（如果没有中央管理）那么用户将不得不允许应用程序进行通信。也许您应该咬紧牙关，让在线帮助只是一个网站，并按照另一个答案中的建议通过“执行”URL 来生成首选浏览器。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:08:18.890

要使用用户的首选浏览器（使用适当的代理和身份验证设置）打开网页，请使用`ShellExecute`与要加载的文档的 URL 类似的内容。像这样的事情会做到（`page`要加载的 URL 在哪里）：

```
HINSTANCE r = ShellExecute(NULL, "open", page, NULL, NULL, SW_SHOWNORMAL); 
```

# netbeans - Netbeans 解决缺少的服务器

> ID：387479
> 
> 赞同：1
> 
> 时间：2008-12-22T21:53:19.047
> 
> 标签：netbeans, glassfish

我的 Netbeans 6.1 IDE 遇到问题。

更新不成功后，Netbeans 停止识别 Apache 和 Glassfish 服务器，并要求我解决缺少的服务器错误，然后我打开一个窗口来添加服务器，但没有列出。尝试在列表中添加服务器不会产生任何结果，因为甚至没有一个服务器类型可供选择。

重新安装 Netbeans 并没有解决问题。有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T22:08:45.690

重新安装时是否手动删除了“C:\Documents and Settings\omuhammed.netbeans”目录？除了删除“程序文件”中的文件夹？重新安装之前？这通常对我有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T22:27:36.217

重新安装后我没有这样做，结果是一样的。更多的人对此有抱怨，但我没有找到直接的答案。我已经完成了“硬”的方式并下载了 6.5 版本，安装后一切正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T12:27:44.110

同样的事情也发生在我身上。当我打开一个由其他用户创建的项目时。但是这里它说，服务器丢失了，我需要解决它。When select Resolve server missing problem, window with blank list of servers is shown. 当我打开“服务器管理器”窗口时，它显示 Bundled Tomcat。但是无法将相同的服务器添加到所需的项目中。同时，在同一台机器上创建的一些项目运行正常。

即使在网络资源中，我也看不到任何适当的原因和解决方案。

任何和所有建议都受到高度赞赏。

萨扬

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T07:26:19.177

卸载 netbeans 后，我删除“C:\Documents and Settings.netbeans”、“C:\Documents and Settings.nbi”、“C:\Documents and Settings.netbeans-derby”和“C:\Documents”和 Settings.netbeans-registration”目录。之后我重新安装netbeans。有用！谢谢奥默穆罕默德！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-07T11:19:55.160

右键单击您的项目，然后单击*resolve missing server*。打开对话框，您将在当前 glash fish 服务器中添加服务器，然后解决您的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-30T05:07:39.407

安装时选择自定义按钮。只选择tomcat，取消选中glass fish，然后继续安装。它会像魅力一样起作用。

# wpf - 在 WPF TabControl 中隐藏选项卡标题

> ID：387480
> 
> 赞同：40
> 
> 时间：2008-12-22T21:53:42.273
> 
> 标签：wpf, tabcontrol

当只有一个可见选项卡时隐藏选项卡标题的最佳方法是什么？

我想完全隐藏 TabControl chrome，同时让 Tab 的内容可见。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-22T22:24:36.767

您可以将应用于 TabItem 的 Style 与 DataTrigger 一起使用，如果父 TabControl 只有一个项目，它将折叠它：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid.Resources>
        <x:Array x:Key="tabData" Type="{x:Type sys:String}">
            <sys:String>do</sys:String>
            <sys:String>re</sys:String>
            <sys:String>mi</sys:String>
        </x:Array>
    </Grid.Resources>
    <TabControl ItemsSource="{StaticResource tabData}">
        <TabControl.ItemContainerStyle>
            <Style TargetType="{x:Type TabItem}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabControl}}, Path=Items.Count}" Value="1">
                        <Setter Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>
                </Style.Triggers>                
            </Style>
        </TabControl.ItemContainerStyle>
    </TabControl>
</Grid> 
```

如果您想在只有一项的情况下完全摆脱 TabControl，那么该逻辑可能应该处于更高级别。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-06-26T12:16:32.617

如果你必须在后面的代码中做到这一点......

```
foreach (var item in tabControl.Items)
            (item as TabItem).Visibility = tabControl.Items.Count > 1 ? Visibility.Visible : Visibility.Collapsed; 
```

# mysql - 如何从 MySQL 5.1 发送电子邮件

> ID：387483
> 
> 赞同：25
> 
> 时间：2008-12-22T21:54:34.923
> 
> 标签：mysql, email, notifications, navicat

当将新行插入表中时，我正在尝试向多个收件人发送电子邮件。收件人列表各不相同。我希望能够使用 select 语句设置此列表。我还安装了 Navicat，它允许我发送电子邮件通知，但仅限于预定的一组人。

谢谢。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-11-04T21:57:10.610

如果您正在运行 SMTP 服务，则可以将文件输出到投递目录。如果您的容量很大，则可能会导致文件名重复，但有一些方法可以避免这种情况。

否则，您将需要创建一个 UDF。

这是一个示例触发解决方案：

```
CREATE TRIGGER test.autosendfromdrop BEFORE INSERT ON test.emaildrop
FOR EACH ROW BEGIN
      /* START THE WRITING OF THE EMAIL FILE HERE*/      
      SELECT  concat("To: ",NEW.To),
              concat("From: ",NEW.From),
              concat("Subject: ",NEW.Subject),
              NEW.Body
          INTO OUTFILE 
                   "C:\\inetpub\\mailroot\\pickup\\mail.txt" 
              FIELDS TERMINATED by '\r\n' ESCAPED BY '';            
END; 
```

要标记消息正文，您将需要这样的内容...

```
CREATE FUNCTION `HTMLBody`(Msg varchar(8192)) 
    RETURNS varchar(17408) CHARSET latin1 DETERMINISTIC
BEGIN
  declare tmpMsg varchar(17408);
  set tmpMsg = cast(concat(
      'Date: ',date_format(NOW(),'%e %b %Y %H:%i:%S -0600'),'\r\n',
      'MIME-Version: 1.0','\r\n',
      'Content-Type: multipart/alternative;','\r\n',
      ' boundary=\"----=_NextPart_000_0000_01CA4B3F.8C263EE0\"','\r\n',
      'Content-Class: urn:content-classes:message','\r\n',
      'Importance: normal','\r\n',
      'Priority: normal','\r\n','','\r\n','','\r\n',
      'This is a multi-part message in MIME format.','\r\n','','\r\n',
      '------=_NextPart_000_0000_01CA4B3F.8C263EE0','\r\n',
      'Content-Type: text/plain;','\r\n',
      '  charset=\"iso-8859-1\"','\r\n',
      'Content-Transfer-Encoding: 7bit','\r\n','','\r\n','','\r\n',
      Msg,
      '\r\n','','\r\n','','\r\n',
      '------=_NextPart_000_0000_01CA4B3F.8C263EE0','\r\n',
      'Content-Type: text/html','\r\n',
      'Content-Transfer-Encoding: 7bit','\r\n','','\r\n',
      Msg,
      '\r\n','------=_NextPart_000_0000_01CA4B3F.8C263EE0--'
      ) as char);
  RETURN tmpMsg;
END ; 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-12-22T22:02:45.627

我会非常担心将发送电子邮件的负载放在我的数据库服务器上（尽管它可能很小）。我可能会建议以下替代方案之一：

1.  让应用程序逻辑检测是否需要发送电子邮件并发送。
2.  让一个 MySQL 触发器填充一个将要发送的电子邮件排队的表，并让一个进程监视该表并发送电子邮件。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-22T22:12:15.497

我同意吉姆暴雪的观点。数据库不是应该发送电子邮件的技术堆栈的一部分。例如，如果您发送了一封电子邮件，但随后回滚了触发该电子邮件的更改，该怎么办？您无法收回电子邮件。

在您的应用程序确认 SQL 更改已成功进行并提交*后*，最好在您的应用程序代码层发送电子邮件。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2016-03-04T01:03:33.503

如果您有 vps 或专用服务器，您可以使用 C 编程编写自己的模块。

段

```
/* 
 * File:   para.h
 * Author: rahul
 *
 * Created on 10 February, 2016, 11:24 AM
 */

#ifndef PARA_H
#define  PARA_H

#ifdef  __cplusplus
extern "C" {
#endif

#define From "<dgdfg@dgfdgd.com>"
#define To "<dfgdfg.dfg@gmail.com>" 
#define From_header "Rahul<fdgdfg@dfgdfg.com>"   
#define TO_header "Mini<dfgdffefg@gmail.com>"   
#define UID "smtp server account ID"
#define PWD "smtp server account PWD"
#define domain "dfgdfgdfg.com"

#ifdef  __cplusplus
}
#endif

#endif  
/* PARA_H */ 
```

主程序

```
/* 
 * File:   main.c
 * Author: rahul
 *
 * Created on 10 February, 2016, 10:29 AM
 */
#include <my_global.h>
#include <mysql.h>
#include <string.h>
#include <ctype.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <netdb.h>
#include <arpa/inet.h>
#include <unistd.h>
#include "time.h"
#include "para.h"

/*
 * 
 */

my_bool SendEmail_init(UDF_INIT *initid,UDF_ARGS *arg,char *message);
void SendEmail_deinit(UDF_INIT *initid __attribute__((unused)));
char* SendEmail(UDF_INIT *initid, UDF_ARGS *arg,char *result,unsigned long *length, char *is_null,char* error);

/*
 * base64
 */
int Base64encode_len(int len);
int Base64encode(char * coded_dst, const char *plain_src,int len_plain_src);

int Base64decode_len(const char * coded_src);
int Base64decode(char * plain_dst, const char *coded_src);

/* aaaack but it's fast and const should make it shared text page. */
static const unsigned char pr2six[256] =
{
    /* ASCII table */
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 62, 64, 64, 64, 63,
    52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 64, 64, 64, 64, 64, 64,
    64,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
    15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 64, 64, 64, 64, 64,
    64, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
    41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,
    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64
};

int Base64decode_len(const char *bufcoded)
{
    int nbytesdecoded;
    register const unsigned char *bufin;
    register int nprbytes;

    bufin = (const unsigned char *) bufcoded;
    while (pr2six[*(bufin++)] <= 63);

    nprbytes = (bufin - (const unsigned char *) bufcoded) - 1;
    nbytesdecoded = ((nprbytes + 3) / 4) * 3;

    return nbytesdecoded + 1;
}

int Base64decode(char *bufplain, const char *bufcoded)
{
    int nbytesdecoded;
    register const unsigned char *bufin;
    register unsigned char *bufout;
    register int nprbytes;

    bufin = (const unsigned char *) bufcoded;
    while (pr2six[*(bufin++)] <= 63);
    nprbytes = (bufin - (const unsigned char *) bufcoded) - 1;
    nbytesdecoded = ((nprbytes + 3) / 4) * 3;

    bufout = (unsigned char *) bufplain;
    bufin = (const unsigned char *) bufcoded;

    while (nprbytes > 4) {
    *(bufout++) =
        (unsigned char) (pr2six[*bufin] << 2 | pr2six[bufin[1]] >> 4);
    *(bufout++) =
        (unsigned char) (pr2six[bufin[1]] << 4 | pr2six[bufin[2]] >> 2);
    *(bufout++) =
        (unsigned char) (pr2six[bufin[2]] << 6 | pr2six[bufin[3]]);
    bufin += 4;
    nprbytes -= 4;
    }

    /* Note: (nprbytes == 1) would be an error, so just ingore that case */
    if (nprbytes > 1) {
    *(bufout++) =
        (unsigned char) (pr2six[*bufin] << 2 | pr2six[bufin[1]] >> 4);
    }
    if (nprbytes > 2) {
    *(bufout++) =
        (unsigned char) (pr2six[bufin[1]] << 4 | pr2six[bufin[2]] >> 2);
    }
    if (nprbytes > 3) {
    *(bufout++) =
        (unsigned char) (pr2six[bufin[2]] << 6 | pr2six[bufin[3]]);
    }

    *(bufout++) = '\0';
    nbytesdecoded -= (4 - nprbytes) & 3;
    return nbytesdecoded;
}

static const char basis_64[] =
    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

int Base64encode_len(int len)
{
    return ((len + 2) / 3 * 4) + 1;
}

int Base64encode(char *encoded, const char *string, int len)
{
    int i;
    char *p;

    p = encoded;
    for (i = 0; i < len - 2; i += 3) {
    *p++ = basis_64[(string[i] >> 2) & 0x3F];
    *p++ = basis_64[((string[i] & 0x3) << 4) |
                    ((int) (string[i + 1] & 0xF0) >> 4)];
    *p++ = basis_64[((string[i + 1] & 0xF) << 2) |
                    ((int) (string[i + 2] & 0xC0) >> 6)];
    *p++ = basis_64[string[i + 2] & 0x3F];
    }
    if (i < len) {
    *p++ = basis_64[(string[i] >> 2) & 0x3F];
    if (i == (len - 1)) {
        *p++ = basis_64[((string[i] & 0x3) << 4)];
        *p++ = '=';
    }
    else {
        *p++ = basis_64[((string[i] & 0x3) << 4) |
                        ((int) (string[i + 1] & 0xF0) >> 4)];
        *p++ = basis_64[((string[i + 1] & 0xF) << 2)];
    }
    *p++ = '=';
    }

    *p++ = '\0';
    return p - encoded;
}

/*
 end of base64
 */

const char* GetIPAddress(const char* target_domain) {
    const char* target_ip;
    struct in_addr *host_address;
    struct hostent *raw_list = gethostbyname(target_domain);
    int i = 0;
    for (i; raw_list->h_addr_list[i] != 0; i++) {
        host_address = raw_list->h_addr_list[i];
        target_ip = inet_ntoa(*host_address);
    }
    return target_ip;
}

char * MailHeader(const char* from, const char* to, const char* subject, const char* mime_type, const char* charset) {

    time_t now;
    time(&now);
    char *app_brand = "Codevlog Test APP";
    char* mail_header = NULL;
    char date_buff[26];
    char Branding[6 + strlen(date_buff) + 2 + 10 + strlen(app_brand) + 1 + 1];
    char Sender[6 + strlen(from) + 1 + 1];
    char Recip[4 + strlen(to) + 1 + 1];
    char Subject[8 + 1 + strlen(subject) + 1 + 1];
    char mime_data[13 + 1 + 3 + 1 + 1 + 13 + 1 + strlen(mime_type) + 1 + 1 + 8 + strlen(charset) + 1 + 1 + 2];

    strftime(date_buff, (33), "%a , %d %b %Y %H:%M:%S", localtime(&now));

    sprintf(Branding, "DATE: %s\r\nX-Mailer: %s\r\n", date_buff, app_brand);
    sprintf(Sender, "FROM: %s\r\n", from);
    sprintf(Recip, "To: %s\r\n", to);
    sprintf(Subject, "Subject: %s\r\n", subject);
    sprintf(mime_data, "MIME-Version: 1.0\r\nContent-type: %s; charset=%s\r\n\r\n", mime_type, charset);

    int mail_header_length = strlen(Branding) + strlen(Sender) + strlen(Recip) + strlen(Subject) + strlen(mime_data) + 10;

    mail_header = (char*) malloc(mail_header_length);

    memcpy(&mail_header[0], &Branding, strlen(Branding));
    memcpy(&mail_header[0 + strlen(Branding)], &Sender, strlen(Sender));
    memcpy(&mail_header[0 + strlen(Branding) + strlen(Sender)], &Recip, strlen(Recip));
    memcpy(&mail_header[0 + strlen(Branding) + strlen(Sender) + strlen(Recip)], &Subject, strlen(Subject));
    memcpy(&mail_header[0 + strlen(Branding) + strlen(Sender) + strlen(Recip) + strlen(Subject)], &mime_data, strlen(mime_data));
    return mail_header;
}

my_bool SendEmail_init(UDF_INIT *initid,UDF_ARGS *arg,char *message){
     if (!(arg->arg_count == 2)) {
        strcpy(message, "Expected two arguments");
        return 1;
    }

    arg->arg_type[0] = STRING_RESULT;// smtp server address
    arg->arg_type[1] = STRING_RESULT;// email body
    initid->ptr = (char*) malloc(2050 * sizeof (char));
    memset(initid->ptr, '\0', sizeof (initid->ptr));
    return 0;
}

void SendEmail_deinit(UDF_INIT *initid __attribute__((unused))){
    if (initid->ptr) {
        free(initid->ptr);
    }
}

char* SendEmail(UDF_INIT *initid, UDF_ARGS *arg,char *result,unsigned long *length, char *is_null,char* error){
   char *header = MailHeader(From_header, TO_header, "Hello Its a test Mail from Codevlog", "text/plain", "US-ASCII");
    int connected_fd = socket(AF_INET, SOCK_STREAM, IPPROTO_IP);
    struct sockaddr_in addr;
    memset(&addr, 0, sizeof (addr));
    addr.sin_family = AF_INET;
    addr.sin_port = htons(25);
    if (inet_pton(AF_INET, GetIPAddress(arg->args[0]), &addr.sin_addr) == 1) {
        connect(connected_fd, (struct sockaddr*) &addr, sizeof (addr));
    }
    if (connected_fd != -1) {
        int recvd = 0;
        const char recv_buff[4768];
        int sdsd;
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char buff[1000];
        strcpy(buff, "EHLO "); //"EHLO sdfsdfsdf.com\r\n"
        strcat(buff, domain);
        strcat(buff, "\r\n");
        send(connected_fd, buff, strlen(buff), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char _cmd2[1000];
        strcpy(_cmd2, "AUTH LOGIN\r\n");
        int dfdf = send(connected_fd, _cmd2, strlen(_cmd2), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char _cmd3[1000];
        Base64encode(&_cmd3, UID, strlen(UID));
        strcat(_cmd3, "\r\n");
        send(connected_fd, _cmd3, strlen(_cmd3), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char _cmd4[1000];
        Base64encode(&_cmd4, PWD, strlen(PWD));
        strcat(_cmd4, "\r\n");
        send(connected_fd, _cmd4, strlen(_cmd4), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char _cmd5[1000];
        strcpy(_cmd5, "MAIL FROM: ");
        strcat(_cmd5, From);
        strcat(_cmd5, "\r\n");
        send(connected_fd, _cmd5, strlen(_cmd5), 0);
        char skip[1000];
        sdsd = recv(connected_fd, skip, sizeof (skip), 0);

        char _cmd6[1000];
        strcpy(_cmd6, "RCPT TO: ");
        strcat(_cmd6, To); //
        strcat(_cmd6, "\r\n");
        send(connected_fd, _cmd6, strlen(_cmd6), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char _cmd7[1000];
        strcpy(_cmd7, "DATA\r\n");
        send(connected_fd, _cmd7, strlen(_cmd7), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        send(connected_fd, header, strlen(header), 0);
        send(connected_fd, arg->args[1], strlen(arg->args[1]), 0);
        char _cmd9[1000];
        strcpy(_cmd9, "\r\n.\r\n.");
        send(connected_fd, _cmd9, sizeof (_cmd9), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);
        recvd += sdsd;

        char _cmd10[1000];
        strcpy(_cmd10, "QUIT\r\n");
        send(connected_fd, _cmd10, sizeof (_cmd10), 0);
        sdsd = recv(connected_fd, recv_buff + recvd, sizeof (recv_buff) - recvd, 0);

        memcpy(initid->ptr, recv_buff, strlen(recv_buff));
        *length = recvd;
    }
    free(header);
    close(connected_fd);
    return initid->ptr;
} 
```

要配置您的项目，请观看此视频： [https](https://www.youtube.com/watch?v=Zm2pKTW5z98) ://www.youtube.com/watch?v=Zm2pKTW5z98 （在 Linux 上从 MySQL 发送电子邮件）它适用于任何 mysql 版本（5.5、5.6、5.7）

如果上述代码中出现任何错误，我会解决，请在评论中告知

# css - 模拟位置：在 IE6 中固定，div 为 100% 高度？

> ID：387485
> 
> 赞同：0
> 
> 时间：2008-12-22T21:55:39.290
> 
> 标签：css, xhtml, internet-explorer-6, css-position

我的网页上有一个侧边栏，它应该跨越页面的 100%（垂直）。然后它应该留在那里，所以当其余内容滚动时它不会。为此，我使用了：

```
body
{
    height: 100%;
}

#sidebar
{
    height: 100%;
    width: 120px;
    position: fixed;
    top: 0;
    left: 0;
} 
```

这适用于所有现代浏览器！不幸的是，我必须为不支持 position:fixed 的 IE6 编写代码。你知道我会怎么做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T21:59:25.727

[这是修复 »](http://home.tampabay.rr.com/bmerkey/examples/fake-position-fixed.html)

我？我会尽快使用更常见的导航方法，或者使用 ( *gasp* ) 框架。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T23:06:43.157

[如此处](http://home.tampabay.rr.com/bmerkey/examples/fake-position-fixed.html)所述

1.  首先，通过使用严格的 DOCTYPE 将 IE6 置于“标准模式”。请注意，IE6 的标准模式以其极其奇怪的怪癖而闻名。我们现在正在利用一个。
2.  使用 IE 条件注释来设置 HTML 和 BODY 标签的样式，如下所示：

    html, 身体 {高度:100%; 溢出：自动；}

3.  将您想要保持固定的任何样式设置为位置：绝对。

# vb.net - 删除或重置 Cookie

> ID：387488
> 
> 赞同：5
> 
> 时间：2008-12-22T21:57:56.743
> 
> 标签：vb.net, cookies, reset

我在`Request.Cookies("TemplateName").value`我的应用程序的一个页面（第 3 页）上设置了一个 cookie。现在我可以从第 3 页导航到第 4 页和第 2 页，并保留 cookie 的值。但是现在当我注销并再次登录时它仍然有值，当我启动一个新实例时，如何将 cookie 的值重置为空白“”？

我试过：

```
Request.Cookies("TemplateName").Expires = Now
Request.Cookies("TemplateName").value = "" 
```

在我的主页上，但 cookie 仍然保留第 2 页和第 3 页的值。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T22:11:26.280

您需要使用响应而不是请求

```
Response.Cookies["TemplateName"].Value = "";

Response.Cookies["TemplateName"].Expires = DateTime.Now; 
```

为 VB 编辑。

```
Dim subkeyName As String
subkeyName = "userName"
Dim aCookie As HttpCookie = Request.Cookies("userInfo")
aCookie.Values.Remove(subkeyName)
aCookie.Expires = DateTime.Now.AddDays(1)
Response.Cookies.Add(aCookie)

Response.Cookies("userName").Value = "patrick"
Response.Cookies("userName").Expires = DateTime.Now.AddDays(1) 
```

这些示例来自[MSDN 站点](http://msdn.microsoft.com/en-us/library/ms178194.aspx)

*边注*

人们经常尝试使用

```
Request.Cookies.Remove("MyCookie"); 
```

这只会从“请求集合”中删除 cookie，如果要删除 cookie，则需要使其过期。更多信息[在这里](http://briancaos.wordpress.com/2008/07/22/add-and-remove-cookies/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T22:30:32.403

这听起来可能很愚蠢。

But are you trying to set cookie from any other place? Search for the code for TemplateName, if that helps.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:39:46.300

I'm not as familiar with .Net but with web apps in general you need to make sure that you set your response headers before writing out any body, otherwise they may not be sent. Just something to double check.

# c++ - MFC 中的 OwnerDrawn 控件

> ID：387492
> 
> 赞同：1
> 
> 时间：2008-12-22T21:59:49.360
> 
> 标签：c++, mfc, visual-c++-6, ownerdrawn

我正在创建一个 MFC 应用程序，其中有一个皮肤库，用于处理呈现控件的 UI 效果（在 oninitdialog 中调用它）。但是，与此同时，我还需要在按钮上显示一个图标。为此，我将按钮标记为 ownerdrawn=true，并且能够显示图标，但在这种情况下，那些由我完成所有者绘制的按钮不会发生皮肤效果。所以，我的问题是，如何确保控件由我以及任何其他库拥有。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T15:21:35.663

您不需要所有者绘制来在按钮中显示图标！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T22:41:34.237

调用 OnPaint 的默认处理程序以确保蒙皮库有机会绘制按钮，然后在顶部绘制您自己的内容。

```
void OnPaint()
{
    Default();
    CClientDC dc(this);
    // your painting code goes here
} 
```

# ascii - 旧 ASCII 协议头像问题

> ID：387511
> 
> 赞同：-1
> 
> 时间：2008-12-22T22:06:08.163
> 
> 标签：ascii, modem, avatar, text-compression

对于任何记得协议 Avatar 的人，（我很确定这是它的名字）我正在尝试查找有关它的信息。到目前为止，我发现它是一种 ANSI 风格的压缩协议，通过压缩常见的 ANSI 转义序列来完成。

但是，回到那天，（90 年代初）我发誓我记得它被用来压缩调制解调器的 ASCII 文本，比如早期的 2400 波特 BIS 调制解调器。（我不记得当时的所有协议版本、名称等，抱歉）。

无论如何，由于显示速度，这使得阅读消息和使用远程 shell 变得更好。它对文件传输没有任何作用，它只是一种将 ASCII 文本压缩到尽可能小的方式。

我正在尝试对这个主题进行研究，并认为这是一个开始寻找的好地方。我认为该协议使用了书中的所有技巧来压缩 ASCII，例如将常用单词替换为单个字节，甚至可能是一个字节。

我不记得你能从中得到的比例，但我记得，它相当不错。

有人有这方面的信息吗？将 ASCII 文本压缩到少于 7 位，或 Avatar 上的协议信息，或者甚至可能是对我所说的任何 ASCII 压缩的答案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T22:17:58.917

维基百科有一些关于[AVATAR 协议](https://en.wikipedia.org/wiki/Advanced_Video_Attribute_Terminal_Assembler_and_Recreator)的内容：

> AVATAR 协议（高级视频属性终端汇编器和重建器）是一个转义序列系统，偶尔用于公告板系统 (BBS)。它具有与更流行的 ANSI 转义码大致相同的功能，但具有转义序列更短的优点。因此，AVATAR 可以比慢速连接更快地渲染彩色文本和艺术品。
> 
> 该协议由 FidoNet 技术标准提案 FSC-0025 定义。
> 
> Avatar 后来在 1989 年末扩展到 AVT/0（有时称为 AVT/0+），其中包括滚动屏幕区域的功能（用于分屏聊天或全屏邮件编写程序），以及更多高级模式压缩。
> 
> Avatar 最初是在 Opus BBS 中实现的，但后来被 RemoteAccess 推广。RemoteAccess 附带一个实用程序 AVTCONV，它允许将 ANSI 文档轻松翻译成 Avatar，帮助其采用。

还：

*   [FSC-0025](http://www.ftsc.org/docs/fsc-0025.001) - FidoNet 技术标准委员会的 AVATAR 提案。
*   [FSC-0037](http://www.ftsc.org/docs/fsc-0037.001) - AVT/0 扩展

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T22:12:57.400

如果我没记错的话，Avatar 压缩方案是一种简单的[RLE（运行长度编码）](http://en.wikipedia.org/wiki/Run-length_encoding)，它将相同字符的重复字符串压缩成更小的字符串。不幸的是，我也不记得细节。

你在 Wikipedia 上查看了[AVATAR吗？](http://en.wikipedia.org/wiki/AVATAR)

# .net - Windows 事件调度程序自定义服务

> ID：387514
> 
> 赞同：2
> 
> 时间：2008-12-22T22:07:58.797
> 
> 标签：.net, windows-services, scheduled-tasks

我需要创建一个与任务调度程序一样工作的 Windows 服务，因为我可以配置它运行的时间，并且它基本上只是在该预定时间（重复）调用一个 .NET 类。推荐的方法是什么？此外，任何有关安装/删除该服务的信息将不胜感激！

更新：不能选择使用任务调度程序（客户要求，与他们的 IT 标准有关）。这也是我对他们的建议，但它不会奏效。

解决方案：感谢大家的回答，Quartz.Net 解决方案看起来特别好，但是我发现以下正是我需要的：

[http://www.c-sharpcorner.com/UploadFile/ajifocus/AppScheduler05262006074807AM/AppScheduler.aspx?ArticleID=b52f76da-943f-4807-9675-869f135ef2cd](http://www.c-sharpcorner.com/UploadFile/ajifocus/AppScheduler05262006074807AM/AppScheduler.aspx?ArticleID=b52f76da-943f-4807-9675-869f135ef2cd)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-25T04:56:03.217

您可以将[Quartz.Net 调度程序](http://quartznet.sourceforge.net/index.html)嵌入到服务中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T23:02:50.420

如果您可以访问该框，为什么不使用 Windows 任务调度程序并从控制台 exe 调用功能。比重新发明轮子要容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-25T04:35:07.453

我之前也遇到过同样的问题，任务调度器本身就有一点问题。它永远不能成为 linux cron 的可靠替代品。曾经我不得不编写一个服务来做到这一点。我`System.Threading.Timer`在 1 秒的循环中运行。然后它根据我存储在 xml 文件中的配置检查需要触发的事件（外部 exe）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T17:59:24.960

您可以尝试 .NET 任务计划程序[http://TaskService.Codeplex.com](http://TaskService.Codeplex.com)。该项目提供了安排 .NET 程序集在一天中的任何时间以不同类型的重复（如每天、每小时、每周、每 5 小时或每三天）运行的能力。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-14T00:52:46.850

如果您正在创建一个调度系统，您最好编写一个 Windows 服务。尽管它们很难调试，但如果您将所有功能从服务中移出并放入帮助程序和服务代理类中，您可以轻松地测试功能而无需打扰服务。

然后，您可以通过 WCF 服务向前端公开您需要提供的任何信息。它们现在可以托管在任何可执行文件中，因此 Windows 服务可以正常工作。Windows 服务策略的优点是您不需要桌面。计划任务旨在（或应该）在后台运行。Windows 服务是处理后台任务的好方法。

我看过售后市场的第 3 方调度系统、开源调度程序和quartz.net。我们选择了后者。如果您的预算可以买单，请查看 JAMS 或其他调度系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T22:19:44.437

哦，有这么多。

我将从 .Net 中的标准 Windows 服务开始，并使用 Properties\Settings 功能来存储我的预定时间（这实际上只适用于一次 - 多次需要更复杂的配置）。

我还将包含一个字符串来定义我想在该配置中运行的程序集/类，并确保程序集有一个从基类继承或实现接口的类，以便我可以将其加载为已知类型并执行一个称为 Execute() 之类的已知方法。

或者您也可以在配置文件中定义要调用的方法，并使用反射来调用该方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-25T05:10:32.297

对不起，我的回复没有告诉你如何实现这一点。

为什么您的客户会禁止使用某些内置操作系统功能，同时允许运行它的本地克隆？

我认为尝试说服您的客户这是一个胡说八道的要求比将 Windows 调度程序重新创建为稳定的服务要少得多。除了通过使用现有的来节省时间之外，您最终可能会得到一个更好的解决方案。对每个人都是双赢的:)

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-25T05:19:52.717

最重要的是要意识到创建一个 Windows 服务是相当复杂的。在版本 6 和更高版本的产品上尤其如此，因为服务与桌面隔离。这里有一些评论

*   服务比基本用户模式程序更难调试。
*   在 V6 和更高版本的操作系统上，服务无法与用户交互。所以你不能给他们一个控制台或让他们直接弹出消息框。
*   与服务的通信通常通过远程过程调用或进程外 COM 完成。即使对于看似竞争的事情，两者都可能很复杂。
*   服务运行必不可少，因此它们必须比其他可执行文件更加可靠和高效。
*   根据安全上下文，可能很难让服务导致系统中发生其他事情。

而不是服务，我会推荐一个“deamon”。这将是一个具有隐藏用户界面的小程序 - 就像任何其他应用程序一样在启动时运行它。它将在用户的上下文中运行，并且可以做用户可以做的任何事情（这可能是你想要的）。如果需要，您可以给它一个托盘图标，或者使用来自其他应用程序之一的信号让它显示其简单的 UI。

# sql - SQL 本地客户端 ODBC 应用程序在 SQLDisconnect 后未断开连接且未池化？

> ID：387525
> 
> 赞同：4
> 
> 时间：2008-12-22T22:12:04.280
> 
> 标签：sql, sql-server, odbc, sqlncli

**背景：**
我正在使用用 C++ 编写的程序，它使用 SQL Native Client 上的 ODBC 建立连接以与 SQL Server 2000 数据库进行交互。

**问题：**
我的连接被抽象为一个对象，当对象被实例化时打开连接，当对象被销毁时关闭连接。我可以看到对象正在被销毁：它们的析构函数正在触发并且在这些析构函数内部`SQLDisconnect( ConnHandle )`被调用，然后是`SQLFreeHandle( SQL_HANDLE_DBC, ConnHandle );` 但是，使用`sp_Who2`SQL 中的性能监视器观察连接计数显示连接计数不断增加，尽管有这些连接被摧毁。

在执行运行足够长的函数链以创建数千个这样的对象并因此创建数千个连接之前，这并没有被证明是有问题的。

**问：**
有没有人见过这样的事情？这可能是什么原因造成的？我最初的谷歌搜索并没有证明很有成效！

**编辑：**
我已经验证`SQLDisconnect`返回没有错误。

连接池已关闭。事实上，当我尝试使用 启用它`SQLSetEnvAttr`时，我的应用程序在第二次调用时崩溃`SQLDriverConnect`。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T22:47:19.140

检查您是否没有使用连接池。如果它打开，它将缓存打开的连接一段时间（可配置）。

如果不使用连接池，则必须检查 SQLDisconnect() 的返回值。您可能有一些事务正在执行或回滚，不会让 SQL Disconnect() 释放您的连接。

[您可以在MSDN](http://msdn.microsoft.com/en-us/library/ms713946.aspx)获得有关如何检查 SQLDisconnect 错误的更多详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T16:47:24.820

我相信我在使用 MFC 和 ODBC，而不是直接使用 SQL 本机客户端 API 的应用程序中看到了同样的问题。有时我的应用程序在关机时挂起，堆栈跟踪是：

```
sqlncli!CCriticalSectionNT::Enter
sqlncli!SQLFreeStmt
sqlncli!SQLFreeConnect
sqlncli!SQLFreeHandle
odbc32!UnloadDriver
odbc32!FreeDbc
odbc32!DestroyIDbc
odbc32!FreeIdbc
odbc32!SQLFreeConnect
mfc42!CDatabase::关闭
mfc42!CDatabase::免费
mfc42!CDatabase::~CDatabase

```

尽我所能，我看不到任何可能导致这种挂起的东西。如果有人可以提出解决方案，我将不胜感激。似乎其他人在网上看到了类似的问题，但到目前为止我还没有找到任何解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-17T01:33:02.750

```
    sqlncli!CCriticalSectionNT::Enter
    sqlncli!SQLFreeStmt
    sqlncli!SQLFreeConnect
    sqlncli!SQLFreeHandle
    odbc32!UnloadDriver
    odbc32!FreeDbc
    odbc32!DestroyIDbc
    odbc32!FreeIdbc
    odbc32!SQLFreeConnect
    mfc42!CDatabase::关闭
    mfc42!CDatabase::免费
    mfc42!CDatabase::~CDatabase

```

从您的堆栈跟踪没有底部，我们可以假设 CDatabase 是一个全局变量吗？可能在dll中？

如果尝试从全局变量的析构函数中断开与 SQL Server 的连接，我们发现了您的确切症状。

使用 MDAC ODBC 驱动程序成功。将代码移出析构函数可以成功。

这似乎与不喜欢从 DllMain 内部调用的 sql 本机客户端有关。

# datetime - 使用文本属性在 TemplateField 中显示 HH:mm 24H 格式

> ID：387530
> 
> 赞同：1
> 
> 时间：2008-12-22T22:14:10.737
> 
> 标签：datetime, date-formatting, templatefield

我正在尝试使用此行显示 24 小时格式：

```
Text='<%# Bind("Appointment", "{HH:mm}") 
```

那么它将如何格式化以显示例如 16:40 而不是 4:40？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T23:10:04.913

如果您不需要*绑定*它，请尝试：

Text='<%# string.Format("{0:HH:mm}", Eval("Appointment"))%>'

否则我想你可以更新 OnDataBound 事件中的字段值。

# javascript - 您如何正确检测浏览器对不透明度的支持？

> ID：387534
> 
> 赞同：2
> 
> 时间：2008-12-22T22:16:08.390
> 
> 标签：javascript, internet-explorer, transparency, opacity, filter

我有一些应用 alpha 透明度的 javascript 代码。在此之前，它会尝试检测浏览器支持的透明度类型并将其存储在变量中以供以后使用。代码如下所示：

```
// figure out the browser support for opacity
if (typeof br.backImg.style.opacity != 'undefined') 
    opacityType = 'opacity';
else if (typeof br.backImg.filters == 'object') 
    opacityType = 'filter';
else 
    opacityType = 'none'; 
```

对于 Firefox 和 Safari，第一个条件为真，对于 IE7，第二个条件为真，但对于 IE6，它属于最后一个条件。为什么 IE6 没有过滤器对象？有没有更好的检测方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T10:43:54.607

在 IE7 中是 filter **，**在 IE6 中是 filter。

下面的代码返回：

*   'opacity' 如果 style.opacity 被支持
*   MS过滤器的“过滤器”（IE < 7）
*   MS过滤器的“过滤器”（IE7）
*   其他一切都“无”

.

```
var opacityType=(
  (typeof o.style.opacity !== 'undefined') ? 'opacity' :
  /*@cc_on @if (@_jscript)
    (typeof o.filters === 'object') ? 'filters' :
    (typeof o.filter === 'string') ? 'filter' :
  @end @*/
  'none'
); 
```

[@cc_on](http://msdn.microsoft.com/en-us/library/8ka90k2e(VS.85).aspx)、@if和[@_jscript](http://msdn.microsoft.com/en-us/library/58dz2w55(VS.85).aspx)[用于](http://msdn.microsoft.com/en-us/library/s59bkzce(VS.85).aspx)仅 IE 支持的[条件注释。](http://msdn.microsoft.com/en-us/library/121hztk3(VS.85).aspx)

我已经在 FF3、IE6、IE7、Opera9 和 Chrome 1 上测试过这个，但没有在 IE4、5 或 8 上测试过。

According to [quirksmode](http://www.quirksmode.org/css/opacity.html) MS has changed the CSS from *filter* to *-ms-filter* so I don't know what result you get with IE8.

According to [mozilla](https://developer.mozilla.org/en/CSS/opacity) *[opacity](http://www.w3.org/TR/css3-color/#transparency)* has been supported since FF 0.9, Opera 9 and Safari 1.2 and *[filter](http://msdn.microsoft.com/en-us/library/ms532847(VS.85).aspx)* since IE4\.

I don't like to do browser sniffing, but sometimes it is necessary and conditional comments make it so much easier to handle specific IE things.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T22:21:55.197

您所理解的过滤器称为不透明度。真正的过滤器是一个专有的 IE 扩展，它可以使该浏览器的许多其他内容不透明。

试试[这篇文章](http://css-tricks.com/css-transparency-settings-for-all-broswers/)了解跨浏览器透明度技术。

JS 等效项与描述的完全相同：style.opacity 或 style.filter。更可能的问题是您的文档类型是过渡性的和/或您尝试使其透明的项目没有神奇的[hasLayout](http://www.satzansatz.de/cssd/onhavinglayout.html)

# ruby - 红宝石中的常量或类变量？

> ID：387536
> 
> 赞同：50
> 
> 时间：2008-12-22T22:16:34.100
> 
> 标签：ruby, constants, class-variables

我已经用 Ruby 编程几个月了，我想知道什么时候适合在类变量上使用常量，反之亦然。（我在 Rails 工作，考虑模型中的常量）。

```
class Category
  TYPES = %w(listing event business).freeze
end 
```

或者

```
class Category
  @@types = %w(listing event business).freeze
  cattr_reader :types
end 
```

是否存在一种优于另一种的情况？还是只是品味/风格的问题？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-12-22T22:31:01.293

主要的是，通过使用 CONSTANT 表示法，您可以让读者清楚地了解它。小写，冻结的字符串给人的印象是*可能*是可设置的，迫使某人回去阅读 RDoc。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-22T22:37:43.700

如果这些确实是您在源代码中定义的常量值并且不想在代码执行期间更改，那么我建议使用常量。

如果您计划在执行期间动态设置和/或更改这些值，则将类变量与 getter 和 setter 一起使用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-25T10:10:24.173

基本上，你可以这样说：如果你想要一些不变的东西，那就使用一个常数。如果您想要可变的东西，请使用变量。看起来你的类型列表是常量，看到它是一个冻结的数组，所以我想说在这种情况下使用常量是有意义的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-05-28T14:59:48.970

如果您不希望值在程序运行时发生变化，*并且*您愿意允许在类之外访问该值，请使用常量。

否则，您可以使用类变量。但是，请注意类变量在子类和子类实例之间共享。因此，如果您将来可能会实现子类，则必须非常小心使用类变量。

有关更多信息，请参阅此处的答案：[Ruby 中的类变量](https://stackoverflow.com/questions/10594444/class-variables-in-ruby)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-09-28T16:05:04.773

请注意，类变量对于类及其实例是私有的（参见[http://phrogz.net/programmingruby/tut_classes.html](http://phrogz.net/programmingruby/tut_classes.html)）。但是，如果您想将常量设为私有，您可以随时执行以下操作：

```
FOO = 18
private_constant :FOO 
```

# ruby-on-rails - OpenSocial 服务器实现

> ID：387540
> 
> 赞同：6
> 
> 时间：2008-12-22T22:18:09.540
> 
> 标签：ruby-on-rails, social-networking, opensocial, apache-shindig

实施 OpenSocial 平台的首选方法是什么？我知道 Apache Shindig，但实际上找不到任何有用的信息。另外，是否可以使用现有的解决方案，如基于 Rails 的[lovdbyless](http://lovdbyless.com/)并为其添加 OpenSocial 功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T21:40:23.703

[我已经在http://code.google.com/p/pesta/](http://code.google.com/p/pesta/)将 shindig 移植到 .NET，并在[http://www.codeplex.com/raya](http://www.codeplex.com/raya)上从 partuza 使用它的示例站点

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T17:12:13.370

似乎有人启动了一个插件，Ruby on Rails，[OpenSocial Container plugin 0.1.0](http://rails.elctech.com/blog/ruby-on-rails-opensocial-container-plugin-0-0-2)，评论中有来自 Apache Shindig 的人建议它作为 Ruby 服务器实现被引入那里。

我还发现了一篇关于滚动你自己的文章，[Google 的 OpenSocial with Ruby on Rails](http://blog.new-bamboo.co.uk/2007/11/7/opensocial-with-ruby-on-rails)。

我也没有尝试过。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-23T11:42:50.403

甚至 Shindig 团队中的一些人也承认文档非常稀少，以至于他们说源代码*就是*文档——相信我，有相当多的源代码可供查看。

我发现的最有用的链接是：

[http://mail-archives.apache.org/mod_mbox/incubator-shindig-dev/200805.mbox/raw/%3CF60DD781-F361-4865-AEC6-284644D0DFF3@xs4all.nl%3E/](http://mail-archives.apache.org/mod_mbox/incubator-shindig-dev/200805.mbox/raw/%3CF60DD781-F361-4865-AEC6-284644D0DFF3@xs4all.nl%3E/)

[http://cwiki.apache.org/confluence/display/SHIINDIG/The+rough+guide+to+deploying+shindig](http://cwiki.apache.org/confluence/display/SHINDIG/The+rough+guide+to+deploying+shindig)

[http://mail-archives.apache.org/mod_mbox/incubator-shindig-dev/200905.mbox/%3c4CC1540B3EC8D54AA01CC6BC40F71030E0991E@EXCHANGE.corp.shop.com%3e](http://mail-archives.apache.org/mod_mbox/incubator-shindig-dev/200905.mbox/%3c4CC1540B3EC8D54AA01CC6BC40F71030E0991E@EXCHANGE.corp.shop.com%3e)

以及如何替换默认类以便与数据库交互的示例：

[http://cwiki.apache.org/confluence/display/SHIINDIG/Providing+your+own+data+service+implementation](http://cwiki.apache.org/confluence/display/SHINDIG/Providing+your+own+data+service+implementation)

# c# - System.Collections.Generic.Dictionary 是什么 .Equals实际上是做什么的？

> ID：387547
> 
> 赞同：2
> 
> 时间：2008-12-22T22:20:02.050
> 
> 标签：c#, generics, collections, comparison, equality

我今天在对通用字典进行单元测试时遇到了这个问题。

```
System.Collections.Generic.Dictionary<int, string> actual, expected;
actual = new System.Collections.Generic.Dictionary<int, string> { { 1, "foo" }, { 2, "bar" } };
expected = new System.Collections.Generic.Dictionary<int, string> { { 1, "foo" }, { 2, "bar" } };
Assert.AreEqual(expected, actual); //returns false 
```

失败，除非`actual == expected`（对象引用相同）。显然，`actual.Equals(expected)`也返回 false。

很好，但是如果`System.Collections.Generic.Dictionary<int, string>.Equals`只执行引用相等，那有什么意义`IEquatable`呢？换句话说，为什么没有内置的方法来为泛型集合做值相等？

**编辑**感谢到目前为止的回复。显然我的例子是使用值类型，但我认为我的抱怨适用于所有对象。为什么泛型集合相等不能只是其类型相等的并集？意外的行为并没有真正削减它，因为有单独的规定来寻找参考平等。`IEquatable`正如 Konrad Rudolph 指出的那样，我想这将引入集合的约束，即仅持有实现的对象。但是，在像 Dictionary 这样的对象中，这似乎并不过分要求。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T22:24:09.420

`Dictionary<T,T>.Equals`是从 Object.Equals 继承的，因此对对象引用进行了简单的比较。

为什么泛型集合不做值相等语义？因为那可能不是你想要的。有时您想检查它们是否是同一个实例。替代方案会做什么？在每个键和值上调用 Equals？如果这些从 Object 继承 Equals 怎么办？这不会是一个完整的深度比较。

因此，如果有必要，您可以提供一些其他语义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T22:25:35.283

> 换句话说，为什么没有内置的方法来为泛型集合做值相等？

可能是因为很难用通用术语来表述，因为这只有在字典的值类型（和键类型）也实现的情况下才有可能`IEquatable`。但是，要求这个太强了，使得`Dictionary`许多没有实现这个接口的类型无法使用。

这是受限泛型的固有问题。Haskell 为这个问题提供了解决方案，但这需要更强大和更复杂的泛型机制。

请注意，与容器相比，类似的情况是正确的`IComparable`，但对此有支持，`Comparer<T>.Default`如有必要，请使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:25:32.193

`Dictionary<TKey, TValue>`不实现 IEquatable，因此没有正式的方法来确定/知道将一个这样的字典与另一个具有相同内容的字典进行比较实际上会产生什么。

事实上，`Dictionary<TKey, TValue>`根本没有实现任何比较接口。

在我看来，让两个对象相互比较是一件相当特别的事情，因此将其放入接口中比仅在基 Object 类中放入默认的通常不需要的实现更有意义。它应该是一个类的一个比每个对象都可以做的更广为宣传的特性，尽管它不是你期望的那样。

但是你现在有了。它就在那里，您需要知道何时使用它。

就像在这种情况下。

# documentation - 插件开发人员需要我的应用程序的哪些信息？

> ID：387571
> 
> 赞同：0
> 
> 时间：2008-12-22T22:25:36.657
> 
> 标签：documentation, plugins

我正在开发一个可以使用“插件”进行扩展的应用程序。插件将非常基本，允许开发人员向我的应用程序添加新的“操作”。

我需要提供哪些文档/信息，以便开发人员可以做他们需要做的事情？

我在想一个简短的例子和应用程序/插件如何工作的一般概述？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T22:38:56.630

你需要培养一种社区意识。像：

*   多个真实插件的示例代码；
*   插件编写者的入门指南；
*   有关如何部署插件以及您的应用程序如何发现它们的详细信息；
*   一个 wiki，以便插件编写者可以协作，以及
*   插件作者贡献其插件的简单方法

可能有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T22:43:44.497

您还必须决定 API 的详细程度。如果您要提供丰富的 API，请确保对其进行良好的记录，并明确突出显示指令（明确的“做”或“不做”指令）。

大多数用户不会费心阅读文档并从名称中找出内容，或者浏览您的文档。所以最好能避免“让他们吃惊”，如果不能，至少给他们一个发现问题的机会。

最后，在检查正确使用和发送异常时要小心谨慎，而不是指望用户满足您的指示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:45:46.943

另外，请提前考虑好您是否真的希望任何人使用您的插件，因为核心产品会成为“热门产品”。

乐观地犯错是很常见的，并认为当您编写插件基础设施时，有人会实际使用它。

但是，在开箱即用的核心产品成功并流行之前，没有人可能编写插件。在担心其他人的扩展之前，您最好发布和分发自己的插件。

# vb.net - 收容树？

> ID：387577
> 
> 赞同：0
> 
> 时间：2008-12-22T22:27:33.097
> 
> 标签：vb.net, garbage-collection, dispose

好的，我认为我理解 IDipose，但只是阅读了 Accelerated VB.NET 的最佳实践部分，它指出“该对象不包含任何实现 iDispose 的对象，因此您不需要遍历调用 iDispose 的包含树”

这个“收容树”是程序所知道的他已经使用然后破坏的东西，还是当我破坏一个对象时我应该查看一个包含类/集合？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T22:34:59.820

我没有读过这本书，但我从未听说过这种“遏制树”。在上下文中，这听起来好像仅意味着（给定类的）所有字段也实现`IDisposable`并因此必须在类的`Dispose`方法中处置（如果`disposing`参数是`True`） - 或者更确切地说，在您的情况下，因为*没有*您不必采取任何进一步的行动。

# iphone - 匹配 NSString 中单词的开头

> ID：387589
> 
> 赞同：1
> 
> 时间：2008-12-22T22:32:08.827
> 
> 标签：iphone, objective-c, cocoa, string

NSString 中是否有内置方法可以标记字符串并搜索每个标记的开头？该`compare`方法似乎只做字符串的开头，并且 using`rangeOfString`还不够，因为它不了解标记。现在我在想最好的方法是打电话

```
[myString componentsSeparatedByString:@" "] 
```

然后遍历生成的数组，对字符串的每个组件调用 compare。这是内置的，我只是错过了它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T22:36:11.753

使用[CFStringTokenizer](http://developer.apple.com/documentation/CoreFoundation/Reference/CFStringTokenizerRef/Reference/reference.html)对字符串进行标记将比拆分更健壮`@" "`，但搜索结果仍由您决定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-29T07:19:16.840

您可能想查看 RegexKit Lite：

[http://regexkit.sourceforge.net/#RegexKitLite/](http://regexkit.sourceforge.net/#RegexKitLite/)

虽然它是一个第三方库，但它基本上是一个非常小的（一个类）包装器，它围绕内置的相当强大的正则表达式引擎构建。

看起来这会更有用，因为您可以在令牌分隔符周围匹配非捕获表达式，然后捕获部分包括或不包括您要查找的文本以及令牌之间的剩余文本。如果您以前没有使用过多的正则表达式，您将需要阅读某种参考资料，但请注意，您可以使用一种神秘但非常强大的语法将匹配模式与您想要查看的内容区分开来。

我也不确定您是否可以在 iPhone 上使用 CFStringTokenizer，因为 iPhone 特定的文档集没有它的参考。

# javascript - 自动滚动到不断增长的页面底部的 Javascript 机制？

> ID：387592
> 
> 赞同：11
> 
> 时间：2008-12-22T22:32:25.037
> 
> 标签：javascript, browser, scroll

希望这对于有 Javascript 时间的人来说是一个简单的答案......

我有一个脚本正在监视一个日志文件，该脚本将日志中的新行提供给任何连接的浏览器。一些人评论说，他们希望看到的更多的是“tail -f”行为——最新的行将始终位于浏览器页面的底部，直到查看器向上滚动查看某些内容。滚动回底部应该让您回到自动滚动行为。

我的谷歌三振-希望-只是对javascript一无所知，因此不知道要搜索什么关键字。我不需要一个完整的解决方案——只要一个“足够接近”，让我跳进去弄脏我的手。

编辑：

我一直在尝试 scrollTop/scrollHeight 的想法，但显然缺少一些东西。我几乎没有用 Javascript 做任何事情，所以我可能再次提出了非常低级的问题：

```
<html><body>
<script type="text/javascript">
for (i=0; i<100; i++)
{
    document.write("" + i + "<br />");
    document.scrollTop = document.scrollHeight;
}
</script>
</body></html> 
```

这是许多排列之一。显然，我无法在 javascript 中逐行输出日志，但我只是想查看正确的行为。我在这里需要什么缺失的链接？

再次编辑：这已经变成了我最初预期的一个更有趣的问题。使用 window.scroll 的代码建议确实可以解决问题。我开始尝试将滚动限制为仅在浏览器位于文档正文底部时发生。这在理论上很容易做到，但在实践中却遇到了困难：

每次从服务器获取新文本时，正文的大小都会增加，并且您当前的滚动位置不再位于文档的底部。您无法再区分（使用 scrollHeight、clientHeight 和 scrollTop）是用户向上滚动还是文本刚刚超出他们的视图。

我认为如果这行得通，我将不得不承诺让自己有一个 JS 事件，当用户滚动并在窗口底部上方关闭滚动时触发该事件，但如果它们已经向下滚动到它们实际上位于视图底部的位置。我正在查看 onScroll 事件，并且鉴于我提到的变量的数学计算结果非常好，我认为我在这里走的是正确的道路。谢谢大家的意见！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-22T23:16:42.653

```
x = 0;  //horizontal coord
y = document.height; //vertical coord
window.scroll(x,y); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-06-14T15:32:55.260

要滚动整个文档，请使用以下命令：

```
window.scrollTo(0, document.body.scrollHeight); 
```

如果您只有一个可滚动的 div 或其他东西，那么过程会有所不同：

```
var obj = $('id');
obj.scrollTop = obj.scrollHeight; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T00:01:48.193

```
for (i = 0; i < 100; i++) {
    document.write("" + i + "<br />");
    window.scroll(0,document.body.offsetHeight);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-12-15T08:43:07.823

不错的 jQuery 函数完成了这项工作

```
$('html,body').animate({ scrollTop: element.offset().top }, 'slow'); 
```

这对我有用，用它来自动滚动到下拉菜单以使其成为焦点

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-23T20:04:40.650

这解释了设置的时间间隔是什么 - [http://www.w3schools.com/jsref/met_win_setinterval.asp](http://www.w3schools.com/jsref/met_win_setinterval.asp)

这解释了什么设置超时 - [http://www.w3schools.com/jsref/met_win_settimeout.asp](http://www.w3schools.com/jsref/met_win_settimeout.asp)

这将使用 javascript 滚动页面并在 6 秒后停止

```
 <script type = "text/javascript" >

    var x;
    function autoscroll(){
    self.scrollBy(0,x)
    }

    function playautoscroll(){
    x = 1;
    setInterval('autoscroll()',0.01);
    stop();}

    function onetozero(){
    x=0;
    }

    function stop(){
    setTimeout ("onetozero()",6000);
    }
    window.onload=playautoscroll

    </script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T22:38:51.373

```
obj.scrollTop = obj.scrollHeight; 
```

# c# - C# 开源项目命名空间

> ID：387594
> 
> 赞同：8
> 
> 时间：2008-12-22T22:32:59.730
> 
> 标签：c#, .net, open-source, namespaces

我正在考虑将我用 C# 编写的类库之一作为开源发布。在此之前，我正在尝试进行一些重构，以满足公众的需求:)

我想知道最好使用的命名空间模式是什么？基本上，我看到以下选项：

*   namespace **MyTool**：这对我来说看起来并不像是有组织的。我的意思是，（几乎）.NET Framework 中的所有命名空间都以 System 为前缀，所以我想这并不是真正的标准方法。
*   namespace **MyOrganization.MyTool**：问题在于根本没有“MyOrganization”。是闲暇时写的。
*   namespace **MyName.MyTool**：我更喜欢更谦虚的东西。我的意思是，我真的不想在命名空间中有我的名字。

现在 Stackoverflow 上已经有几个相关的问题了，比如[this](https://stackoverflow.com/questions/240033/how-do-you-come-up-with-names-for-your-namespaces)和[this](https://stackoverflow.com/questions/123114/how-do-you-organize-your-namespaces)，但没有一个能真正回答我的问题。

有什么建议么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T22:49:29.120

我会选择类似的东西：

```
namespace OpenSourceProjectCodeName.MajorFunctionalArea 
```

例如：

```
namespace VideoWizardMagicThing.Audio
namespace VideoWizardMagicThing.Audio.Codecs
namespace VideoWizardMagicThing.Video
namespace VideoWizardMagicThing.Video.Codecs 
```

您不必对命名空间完全发疯，您可能需要的只是一两个 MajorFunctionalArea。但是，如果不知道项目的结构或它的作用，就很难说。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T22:35:50.847

如果它是开源的并且会有贡献者，我会选择**MyTool**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:38:08.597

如果您以后有能力更改它，我会选择**MyName.MyTool**。如果您是唯一一个编写该工具的人，那么您需要充分的信任，并且将您的名字放在命名空间中不会伤害任何人。

如果您接受新的贡献者，您可以从命名空间中删除您的名字，但**前提**是其他人确实做出了重大贡献。如果大部分工作是你的，我会把它留在里面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T22:39:29.593

**`MyTool`**存在名称不唯一的问题；您正面临名称冲突。**`MyCompany.MyTool`**如果您不想给自己贴上标签，则不适用于您的情况。

实际上，我更喜欢反转与产品关联的 URI 的 Java 约定。对于公司，这是公司网站。对您而言——您是否有一个地址不太可能很快更改的博客/个人主页？然后使用名称，将 TLD 和二级域颠倒过来。在我的情况下：**`net.madrat.MyTool`**。

我知道有几个人使用`TheirName.MyTool`哪个很好。但是，一旦有第二个贡献者，这就会成为一个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T22:48:16.407

我建议获取 MyOrganization 并使用它。如果您曾经为工作拿过钱，您将需要一个实体，它可以保护您免于承担责任。设置一些东西相当容易。

或者只是使用 MyOrganization 名称并稍后创建实体，但如果您不先设置它，您将面临合法名称冲突等风险。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T22:48:22.337

你可以做 MyToolProject.MyTool。或者，您可以为您的“组织”想出一些有创意的名称，然后将其作为您未来所有开源项目的名称，即使它现在只是一个。然后你可以拥有 MyCreativeOrgName.MyTool。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T07:14:18.507

*MyOrganization.Technology*仍然是启动命名空间的推荐方式。

我曾经有过类似的问题，我以前的项目命名空间是我的爱好。所以我刚刚为一个开发组编了一个名字（你想要一个简短易读的）并开始使用它。

但是，请记住，可用性仍然是关键。例如，这是该规则的一个例外。我们的开源[Lokad 共享库](https://github.com/Lokad/lokad-shared-libraries)遵循 .NET 本身的命名空间（即：*System*或*System.Threading*）。这是因为我们的开发人员应该可以使用许多日常帮助程序和扩展，而他们甚至没有注意到他们正在利用非 BCL 代码。

它还使 using 声明看起来更好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T07:56:44.710

**MyTool**听起来很像项目代码/品牌名称？

在这种情况下，如果您希望在不使用您的组织或个人名称的情况下对其进行进一步分类，请选择它要解决的*行业*或*问题领域*。

视频编辑.MyTool

会计.MyTool

家庭自动化.MyTool

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-22T22:39:25.893

我以 Idunno.* 结束了几个项目（我的网站），SharpSTS.* 用于主要项目（因为那是项目名称）

# sql-server-ce - SQL CE 插入失败，直到我查看表

> ID：387595
> 
> 赞同：1
> 
> 时间：2008-12-22T22:33:29.463
> 
> 标签：sql-server-ce

我注意到发生了一些奇怪的事情。我正在移植一个应用程序以使用 Sql Server CE 3.5，并发现发生了一些奇怪的事情。

我看到的是插入将失败（违反主键约束），并且会一直失败，直到我使用 Visual Studios Server Explorer 并使用 Show Data 函数打开表。

无论是`SQL`在我的代码中参数化填充所有列（主键除外），还是从服务器资源管理器中运行“INSERT INTO SecurityUser (UserName) VALUES ('ch00k')”，它始终是一个主键约束（在这种情况下是主键是 SecurityUserID，我已经仔细检查了它是否是一个自动增量字段），并且一旦我在 Visual Studio 中打开表格，它就会一直工作（并继续工作）。

有没有人遇到过这样的事情？`SQL`或者当我创建表时，我应该运行一些额外的东西，以使主键工作？创建表代码刚刚从 Sql Server 2005 代码直接移植，并且运行没有错误。

# storage - 轻量级存储机制

> ID：387603
> 
> 赞同：2
> 
> 时间：2008-12-22T22:36:10.160
> 
> 标签：storage

我即将编写一个小实用程序来组织和标记我的 mp3。

存储少量数据的最佳方法是什么。更重要的是，是否存在不需要安装客户端/服务器环境的数据库，我只包含库就可以了吗？

我可以使用 XML，但我担心文件会变得很大且难以处理，更不用说保持较小的内存占用了。

谢谢

编辑：我还没有决定语言，我想让我的决定独立于平台。如果我必须选择，最有可能的是 .NET，第二个 Java，第三个 C++。

抱歉，这是针对 Windows 应用程序的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T18:50:02.577

在 Windows 上，您可以使用内置的 esent 数据库引擎。有一个可以从 C++ 使用的 API

[http://blogs.msdn.com/windowssdk/archive/2008/10/23/esent-extensible-storage-engine-api-in-the-windows-sdk.aspx](http://blogs.msdn.com/windowssdk/archive/2008/10/23/esent-extensible-storage-engine-api-in-the-windows-sdk.aspx)

还有一个托管互操作层，您可以从 C# 代码中使用它：

[http://www.codeplex.com/ManagedEsent](http://www.codeplex.com/ManagedEsent)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T22:39:12.057

您在谈论哪种语言/平台？

在 Java 世界中，我更喜欢使用嵌入式数据库，例如[HSQLDB](http://hsqldb.org/)、[H2](http://www.h2database.com/html/main.html)或[JavaDB](http://developers.sun.com/javadb/) (fka Derby)。

它们不需要安装，并且仍然提供您习惯于从“真实”DBMS 进行的简单访问。

在 C/Python/Unixy 世界中， [SQLite](http://www.sqlite.org/)是该领域的热门竞争者。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T22:43:39.070

另一种选择是各种形式的伯克利数据库（例如，db3、db4、[SleepyCat](http://en.wikipedia.org/wiki/Sleepycat_Software)。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T22:39:33.023

[SQLITE](http://www.sqlite.org/)如果您想在没有服务器安装或麻烦的情况下享受关系数据库的痛苦。

我会使用许多文本序列化格式中的一种。我个人认为[YAML 1.1](http://www.yaml.org/spec/current.html)是最强大的（对引用对象图的内置支持）并且最容易被人类阅读/修改（解析是熊，使用诸如[PyYAML](http://pyyaml.org/wiki/PyYAML)或[JYaml](http://jyaml.sourceforge.net/)或[一些 .NET libaray](https://stackoverflow.com/questions/42071/net-yaml-library)之类的库）。

否则 XML 或 JSON 是足够的文件格式。

无论您使用哪种格式，如果您担心磁盘使用情况，只需压缩文件即可。如果您担心内存使用情况，那么我看不出您的序列化格式有多重要......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T23:15:43.980

看看[Prevayler](http://www.prevayler.org) - 它是一个序列化持久性框架（如果您想人工读取数据，请使用 xstream 等），它非常快，不需要注释并且“正常工作”。一些基本信息：

*   它确实强加了更严格的事务模式，因为它不会自动回滚：
    *   确保交易会成功（系统的当前状态）——例如现在有意义吗？
    *   [事务添加到队列]，并存储（用于电源重置等）
    *   事务被执行并应用于对象结构。
*   每秒写入 1000 次事务
*   每秒读取 100,000 个事务

我没怎么用过，但是用在小项目上要好得多（持久化*任何*可序列化的对象都很好）

哦 - 至于每个人说“你在什么平台上运行？”，Prevayler（java）有/有很多平台的端口，但我找不到一个像样的列表:(。我记得大约有 5- 7，但只能记住.NET。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-22T23:40:08.690

如果您计划在程序运行时将所有内容存储在内存中，那么使用您编写的基本 load() 和 save() 函数将其序列化到文件会很好，并且比完整的 DB 更少痛苦。

在 Java 中，可以使用标准序列化来完成（或者可以序列化到 XML 或从 XML 序列化以使其在某种程度上具有人类可读性和可编辑性）。

它根本不应该影响您的内存占用，因为它只是保存和恢复您的对象。你只是不会得到交易、随机访问和查询以及所有这些好东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T22:42:10.227

你甚至可以使用 xml、json、.ini 文件……甚至是文本文件

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T21:11:48.863

我建议使用类似 SQL 的数据库（例如 SQLLite）。今天，您的要求可能会使完整的 SQL 数据库看起来很愚蠢。但你永远不知道这个“小项目”多年来会增长多少。当它确实发展到您必须拥有 SQL 引擎时，您会很高兴您不只是序列化一些 Java 对象或以 JSON 格式存储内容。

# python - 使用用户输入在 Mysql 数据库中查找信息

> ID：387606
> 
> 赞同：1
> 
> 时间：2008-12-22T22:37:08.520
> 
> 标签：python, sql, user-input

我需要使用 python 设计一个程序，它会要求用户输入条形码。然后，使用这个条形码，它将搜索一个 mysql 以找到其对应的产品。

我对如何开始有点困惑。有人对我有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-26T01:07:53.753

使用[python-mysql](http://mysql-python.sourceforge.net/MySQLdb.html#using-and-extending)。它是一个[兼容 dbapi 的](http://www.python.org/dev/peps/pep-0249/)模块，可让您与数据库通信。

```
import MySQLdb

user_input = raw_input("Please enter barcode and press Enter button: ")

db = MySQLdb.connect(passwd="moonpie",db="thangs")
mycursor = db.cursor()
mycursor.execute("""SELECT name, price FROM Product
                 WHERE barcode = %s""", (user_input,))

# calls fetchone until None is returned (no more rows)
for row in iter(mycursor.fetchone, None):
    print row 
```

如果您想要更高级的东西，请考虑使用[SQLAlchemy](http://www.sqlalchemy.org/)作为层。它可以让你做：

```
product = session.query(Product).filter(Product.barcode == user_input).scalar()
print product.name, product.price 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T22:40:49.107

条形码只是一系列字符（字母数字）的图形表示

因此，如果您有一种方法让用户输入此代码（条形码扫描仪），那么它只是查询 mysql 数据库以获取字符串的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T23:01:49.313

这是一个非常模棱两可的问题。根据您实际想要做的事情，您可以通过多种方式完成您想要做的事情。

您的用户将如何输入条形码？他们会使用条形码扫描仪吗？他们是否手动输入条形码编号？

这是要在台式机/笔记本电脑上运行还是要在手持设备上运行？

条形码扫描仪是存储条形码以供以后检索，还是将它们直接发送到计算机。它会通过 USB 电缆还是无线发送它们？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T23:47:58.033

首先，将条形码输入视为普通的旧文本。

自从我使用条形码扫描仪以来已经有一段时间了，但我怀疑它们已经发生了很大的变化，旧的那些过去只是搭载键盘输入，所以从编程的角度来看，最终结果是一个字符流键盘缓冲区，无论是键入还是扫描都没有区别。

如果您的目标设备与此不同，您将需要编写一些东西来处理它，然后再进行数据库查询。

如果您有其中一种设备可以玩，请将其插入，启动记事本，开始扫描一些条形码，看看会发生什么。

# python - Mysql Connection，一个还是多个？

> ID：387619
> 
> 赞同：2
> 
> 时间：2008-12-22T22:40:09.153
> 
> 标签：python, mysql

我正在用 python 编写一个脚本，它基本上查询 WMI 并更新 mysql 数据库中的信息。其中之一是“写你需要的东西”来学习编程练习。

如果脚本中间出现问题，例如远程计算机关闭，它会被分离成函数。

查询一些 WMI 数据
更新到数据库
查询其他 WMI 数据
更新到数据库

是在开始时打开一个mysql连接并在每次更新后保持打开还是关闭连接更好？

似乎一个连接会使用更少的资源。（虽然我只是在学习，所以这是一个完整的猜测。）但是，每次更新打开和关闭连接似乎更“整洁”。函数将更加独立，而不是依赖于该函数之外的代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T01:36:24.633

“然而，每次更新打开和关闭连接似乎更‘整洁’。”

这也是一笔巨大的开销——而且没有实际的好处。

创建和处理连接的成本相对较高。更重要的是，真正的原因是什么？它如何改进、简化、澄清？

通常，大多数应用程序从启动到停止都使用一个连接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T23:16:46.663

我认为没有“更好”的解决方案。现在考虑资源还为时过早。而且由于 wmi 很慢（与 sql 连接相比），db 不是问题。

让它工作。然后让它变得更好。

在这里使用开放连接的好处是，“自然”的解决方案是使用对象而不仅仅是函数。所以这将是一次学习体验（如果你正在学习 python 而不是 mysql）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T23:26:00.637

想一想以下场景：

```
for dataItem in dataSet:
    update(dataItem) 
```

如果您在*更新*函数中打开和关闭连接并且您的*数据集*包含一千个项目，那么您将破坏应用程序的性能并破坏任何事务功能。

更好的方法是打开一个连接并将其传递给*更新*函数。您甚至可以让您的*更新*函数调用各种连接管理器。如果您打算定期执行单个更新，请围绕*更新*函数调用打开和关闭连接。

通过这种方式，您将能够使用函数来封装您的数据操作并能够在它们之间共享连接。

但是，这种方法不适用于执行批量插入或更新。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T16:36:23.320

S.Lott 和 Igal Serban 的答案中的有用线索。我认为您应该首先找出您的实际需求并相应地编写代码。

只是提一个不同的策略；一些应用程序保留一个数据库（或其他）连接池，如果有事务，只需从该池中提取一个。很明显，这种应用程序只需要一个连接。但是您仍然可以保留一个连接池并应用以下连接；

*   每当需要数据库事务时，就会从池中拉出连接并在最后返回。
*   （可选）连接在一定时间后过期（并被新连接替换）。
*   （可选）连接使用一定量后过期。
*   （可选）在将连接交给程序之前，池可以检查（通过发送廉价查询）连接是否处于活动状态。

这在某种程度上介于*单个连接*和*每个事务*策略的连接之间。

# search - 在文件中查找唯一字符

> ID：387623
> 
> 赞同：21
> 
> 时间：2008-12-22T22:41:00.167
> 
> 标签：search, parsing, scripting

我有一个包含 450,000 多行条目的文件。每个条目的长度约为 7 个字符。我想知道的是这个文件的独特字符。

例如，如果我的文件如下；

> ```
> Entry
> -----
> Yabba
> Dabba
> Doo 
> ```

那么结果将是

> 独特字符：{abdoy}

请注意，我不关心大小写，也不需要订购结果。有些东西告诉我，这对 Linux 人来说很容易解决。

## 更新

我正在寻找一个非常快速的解决方案。我真的不想创建代码来遍历每个条目，遍历每个字符......等等。我正在寻找一个不错的脚本解决方案。

## 更新 2

通过**Fast**，我的意思是快速实施......不一定要快速运行。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-22T23:13:58.447

BASH shell 脚本版本（无 sed/awk）：

```
while read -n 1 char; do echo "$char"; done < entry.txt | tr [A-Z] [a-z] |  sort -u 
```

**更新**：只是为了它，因为我很无聊并且还在考虑这个问题，这里是一个使用 set 的 C++ 版本。如果运行时间很重要，这将是我推荐的选项，因为 C++ 版本需要半秒多一点的时间来处理一个包含 450,000 多个条目的文件。

```
#include <iostream>
#include <set>

int main() {
    std::set<char> seen_chars;
    std::set<char>::const_iterator iter;
    char ch;

    /* ignore whitespace and case */
    while ( std::cin.get(ch) ) {
        if (! isspace(ch) ) {
            seen_chars.insert(tolower(ch));
        }
    }

    for( iter = seen_chars.begin(); iter != seen_chars.end(); ++iter ) {
        std::cout << *iter << std::endl;
    }

    return 0;
} 
```

请注意，我忽略了空格，并且按要求不区分大小写。

对于超过 450,000 个条目的文件 (chars.txt)，这是一个示例运行时间：

```
[user@host]$ g++ -o unique_chars unique_chars.cpp 
[user@host]$ time ./unique_chars < chars.txt
a
b
d
o
y

real    0m0.638s
user    0m0.612s
sys     0m0.017s 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-22T23:06:36.247

根据要求，一个纯 shell 脚本“解决方案”：

```
sed -e "s/./\0\n/g" inputfile | sort -u 
```

这不好，它不快，输出也不完全符合规定，但它应该可以工作......主要是。

更可笑的是，我在一行中展示了将输出转储的版本：

```
sed -e "s/./\0\n/g" inputfile | sort -u | while read c; do echo -n "$c" ; done 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-22T22:42:56.980

使用`set`数据结构。大多数编程语言/标准库都带有一种或另一种风格。如果他们不这样做，请使用哈希表（或通常是字典）实现并省略 value 字段。使用您的角色作为键。这些数据结构通常会过滤掉重复的条目（因此名称`set`，从它的数学用法来看：集合没有特定的顺序，只有唯一的值）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-23T01:21:02.510

快速而肮脏的 C 程序，速度非常快：

```
#include <stdio.h>

int main(void)
{
  int chars[256] = {0}, c;
  while((c = getchar()) != EOF)
    chars[c] = 1;
  for(c = 32; c < 127; c++)  // printable chars only
  {
    if(chars[c])
      putchar(c);
  }

  putchar('\n');

  return 0;
} 
```

编译它，然后执行

```
cat file | ./a.out 
```

获取 中唯一可打印字符的列表`file`。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-23T00:57:32.183

Python w/sets（又快又脏）

```
s = open("data.txt", "r").read()
print "Unique Characters: {%s}" % ''.join(set(s)) 
```

Python w/sets（输出更好）

```
import re

text = open("data.txt", "r").read().lower()
unique = re.sub('\W, '', ''.join(set(text))) # Ignore non-alphanumeric

print "Unique Characters: {%s}" % unique 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-23T02:24:22.510

这是一个**PowerShell**示例：

```
gc file.txt | select -Skip 2 | % { $_.ToCharArray() } | sort -CaseSensitive -Unique 
```

产生：

> D
> Y
> a
> b
> o

我喜欢它易于阅读。

**编辑**：这是一个更快的版本：

```
$letters = @{} ; gc file.txt | select -Skip 2 | % { $_.ToCharArray() } | % { $letters[$_] = $true } ; $letters.Keys 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-22T22:51:55.230

一个非常快速的解决方案是制作一个小型 C 程序来读取其标准输入、进行聚合并输出结果。

为什么需要一个“脚本”来完成它的任意限制？

到底什么是脚本？

Python会吗？

如果是这样，那么这是一种解决方案：

```
import sys;

s = set([]);
while True:
    line = sys.stdin.readline();
    if not line:
        break;
    line = line.rstrip();
    for c in line.lower():
        s.add(c);

print("".join(sorted(s))); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-22T22:56:54.113

算法： 将文件[吸到](http://www.perl.com/pub/a/2003/11/21/slurp.html)内存中。

```
Create an array of unsigned ints, initialized to zero.

Iterate though the in memory file, using each byte as a subscript into the array.
    increment that array element.

Discard the in memory file

Iterate the array of unsigned int
       if the count is not zero,
           display the character, and its corresponding count. 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-22T23:15:12.530

```
cat yourfile | 
 perl -e 'while(<>){chomp;$k{$_}++ for split(//, lc $_)}print keys %k,"\n";' 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-22T23:17:28.673

~~使用 bash 的替代解决方案：~~

```
sed "s/./\l\0\n/g" inputfile | sort -u | grep -vc ^$ 
```

**编辑**对不起，我实际上误读了这个问题。上面的代码*计算*了唯一字符。只是在最后省略`c`开关显然可以解决问题，但是，这个解决方案对 saua 没有真正的优势（特别是因为他现在使用相同的`sed`模式而不是显式捕获）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-23T00:24:53.857

虽然不是脚本，但这个 java 程序可以完成这项工作。快速（跑）很容易理解

```
import java.util.*;
import java.io.*;
public class  Unique {
    public static void main( String [] args ) throws IOException { 
        int c = 0;
        Set s = new TreeSet();
        while( ( c = System.in.read() ) > 0 ) {
            s.add( Character.toLowerCase((char)c));
        }
        System.out.println( "Unique characters:" + s );
    }
} 
```

您将像这样调用它：

```
type yourFile | java Unique 
```

或者

```
cat yourFile | java Unique 
```

例如，这个问题的 HTML 中的唯一字符是：

```
Unique characters:[ , , ,  , !, ", #, $, %, &, ', (, ), +, ,, -, ., /, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, :, ;, <, =, >, ?, @, [, \, ], ^, _, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, {, |, }] 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-22T22:47:29.217

在 C++ 中，我将首先遍历字母表中的字母，然后在每个字母上运行 strchr()，并将文件作为字符串。这将告诉您该字母是否存在，然后将其添加到列表中。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-22T22:49:24.470

Python 不使用集合。

```
file = open('location', 'r')

letters = []
for line in file:
    for character in line:
        if character not in letters:
            letters.append(character)

print(letters) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-22T23:21:12.317

[用JSDB Javascript](http://www.jsdb.org)试试这个文件（包括 Firefox 浏览器中的 javascript 引擎）：

```
var seenAlreadyMap={};
var seenAlreadyArray=[];
while (!system.stdin.eof)
{
  var L = system.stdin.readLine();
  for (var i = L.length; i-- > 0; )
  {
    var c = L[i].toLowerCase();
    if (!(c in seenAlreadyMap))
    {
      seenAlreadyMap[c] = true;
      seenAlreadyArray.push(c);
    }
  }
}
system.stdout.writeln(seenAlreadyArray.sort().join('')); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-23T00:51:52.477

Python 使用字典。我不知道为什么人们如此依赖于集合或列表来存放东西。当然，集合可能比字典更有效。但是，两者都应该花费恒定的时间来访问项目。并且两者都围绕一个列表运行圆圈，您搜索列表中的每个字符以查看该字符是否已经在列表中。列表和字典也是在 Python 数据类型中构建的，每个人都应该一直使用它们。因此，即使没有想到 set，字典也应该。

```
file = open('location.txt', 'r')
letters = {}
for line in file:
  if line == "":
    break
  for character in line.strip():
    if character not in letters:
      letters[character] = True
file.close()
print "Unique Characters: {" + "".join(letters.keys()) + "}" 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-23T01:09:51.147

交流解决方案。诚然，它并不是世界上最快的编码解决方案。但由于它已经编码并且可以剪切和粘贴，我认为它对于海报来说算是“快速实施”:) 我实际上没有看到任何 C 解决方案，所以我想发布一个纯粹的虐待狂乐趣 :)

```
#include<stdio.h>

#define CHARSINSET 256
#define FILENAME "location.txt"

char buf[CHARSINSET + 1];

char *getUniqueCharacters(int *charactersInFile) {
    int x;
    char *bufptr = buf;
    for (x = 0; x< CHARSINSET;x++) {
        if (charactersInFile[x] > 0)
            *bufptr++ = (char)x;
    }
    bufptr = '\0';
    return buf;
}

int main() {
    FILE *fp;
    char c;
    int *charactersInFile = calloc(sizeof(int), CHARSINSET);
    if (NULL == (fp = fopen(FILENAME, "rt"))) {
        printf ("File not found.\n");
        return 1;
    }
    while(1) {
        c = getc(fp);
        if (c == EOF) {
            break;
        }
        if (c != '\n' && c != '\r')
            charactersInFile[c]++;
    }

    fclose(fp);
    printf("Unique characters: {%s}\n", getUniqueCharacters(charactersInFile));
    return 0;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-23T01:34:46.820

其中`C:/data.txt`包含 454,863 行 7 个随机字母字符，如下代码

```
using System;
using System.IO;
using System.Collections;
using System.Diagnostics;

namespace ConsoleApplication {
    class Program {
        static void Main(string[] args) {
            FileInfo fileInfo = new FileInfo(@"C:/data.txt");
            Console.WriteLine(fileInfo.Length);

            Stopwatch sw = new Stopwatch();
            sw.Start();

            Hashtable table = new Hashtable();

            StreamReader sr = new StreamReader(@"C:/data.txt");
            while (!sr.EndOfStream) {
                char c = Char.ToLower((char)sr.Read());
                if (!table.Contains(c)) {
                    table.Add(c, null);
                }
            }
            sr.Close();

            foreach (char c in table.Keys) {
                Console.Write(c);
            }
            Console.WriteLine();

            sw.Stop();
            Console.WriteLine(sw.ElapsedMilliseconds);
        }
    }
} 
```

产生输出

`4093767
mytojevqlgbxsnidhzupkfawr
c
889
Press any key to continue . . .`

输出的第一行告诉您`C:/data.txt`（454,863 * (7 + 2) = 4,093,767 字节）中的字节数。接下来的两行输出是其中的唯一字符`C:/data.txt`（包括换行符）。最后一行输出告诉您代码在 2.80 GHz Pentium 4 上执行所需的毫秒数。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-23T01:56:38.617

使用 grep 的快速而肮脏的解决方案（假设文件名为“file”）：

```
for char in a b c d e f g h i j k l m n o p q r s t u v w x y z; do 
    if [ ! -z "`grep -li $char file`" ]; then 
        echo -n $char; 
    fi; 
done; 
echo 
```

我本可以把它做成单行的，但只是想让它更容易阅读。

（编辑：忘记了 -i 切换到 grep）

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-23T03:36:04.267

好吧，我的朋友，我想这就是你的想法......至少这是python版本！

```
f = open("location.txt", "r") # open file

ll = sorted(list(f.read().lower())) #Read file into memory, split into individual characters, sort list
ll = [val for idx, val in enumerate(ll) if (idx == 0 or val != ll[idx-1])] # eliminate duplicates
f.close()
print "Unique Characters: {%s}" % "".join(ll) #print list of characters, carriage return will throw in a return 
```

它不会遍历每个字符，它也相对较短。您不想用它打开一个 500 MB 的文件（取决于您的 RAM），但对于较短的文件，它很有趣 :)

我还要加上我的最后一击！！！！诚然，我通过使用标准输入而不是文件消除了两行，我还将活动代码从 3 行减少到 2 行。基本上，如果我将打印行中的 ll 替换为上面一行中的表达式，我本来可以有 1 行活动代码和一行导入.....无论如何，现在我们玩得很开心:)

```
import itertools, sys

# read standard input into memory, split into characters, eliminate duplicates
ll = map(lambda x:x[0], itertools.groupby(sorted(list(sys.stdin.read().lower()))))
print "Unique Characters: {%s}" % "".join(ll) #print list of characters, carriage return will throw in a return 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-03T03:54:34.320

上面提到的这个[答案](https://stackoverflow.com/questions/387623/find-unique-characters-in-a-file#387882)使用字典。

如果是这样，那里提供的代码可以简化一点，因为[Python 文档](http://docs.python.org/tutorial/datastructures.html#dictionaries)指出：

> 最好将字典视为一组无序的键：值对，并要求键是唯一的（在一个字典中）......如果您使用已在使用的键进行存储，则旧值与该密钥相关联的内容被遗忘。

因此，可以删除这行代码，因为字典键始终是唯一的：

```
 if character not in letters: 
```

这应该让它更快一点。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-11-19T05:47:30.620

```
s=open("text.txt","r").read()
l= len(s)
unique ={}
for i in range(l):
 if unique.has_key(s[i]):
  unique[s[i]]=unique[s[i]]+1
 else:
  unique[s[i]]=1
print unique 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-11-17T21:03:29.217

# 打印唯一字符（ASCII 和 Unicode UTF-8）

```
import codecs
file = codecs.open('my_file_name', encoding='utf-8')

# Runtime: O(1)
letters = set()

# Runtime: O(n^2)
for line in file:
  for character in line:
    letters.add(character)

# Runtime: O(n)
letter_str = ''.join(letters)

print(letter_str) 
```

另存为`unique.py`，并运行为`python unique.py`。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-02-05T18:16:12.247

老问题，我知道，但这是一个快速的解决方案，这意味着它运行速度很快，而且如果你知道如何复制/粘贴，编码也可能很快；）

**背景** 我有一个巨大的 csv 文件（12 GB，134 万行，127.2 亿个字符），我正在将其加载到 postgres 中，但由于其中包含一些“坏”字符而失败，所以我自然而然地试图找到一个不在其中的字符我可以用作引号字符的那个文件。

### 1.第一次尝试：Jay的C++方案

我从[@jay 的 C++ 答案](https://stackoverflow.com/a/387720/9638991)开始：

（注意：所有这些代码示例都是用 编译的`g++ -O2 uniqchars.cpp -o uniqchars`）

```
#include <iostream>
#include <set>

int main() {
    std::set<char> seen_chars;
    std::set<char>::const_iterator iter;
    char ch;

    /* ignore whitespace and case */
    while ( std::cin.get(ch) ) {
        if (! isspace(ch) ) {
            seen_chars.insert(tolower(ch));
        }
    }

    for( iter = seen_chars.begin(); iter != seen_chars.end(); ++iter ) {
        std::cout << *iter << std::endl;
    }

    return 0;
} 
```

这个时间：

```
real    10m55.026s
user    10m51.691s
sys     0m3.329s 
```

### 2.一次读取整个文件

我认为一次将整个文件读入内存会更有效，而不是所有对`cin.get()`. 这将运行时间减少了一半以上。

（我还添加了一个文件名作为命令行参数，并使其打印出由空格而不是换行符分隔的字符）。

```
#include <set>
#include <string>
#include <iostream>
#include <fstream>
#include <iterator>

int main(int argc, char **argv) {
    std::set<char> seen_chars;
    std::set<char>::const_iterator iter;
    std::ifstream ifs(argv[1]);

    ifs.seekg(0, std::ios::end);
    size_t size = ifs.tellg();
    fprintf(stderr, "Size of file: %lu\n", size);
    std::string str(size, ' ');
    ifs.seekg(0);
    ifs.read(&str[0], size);

    /* ignore whitespace and case */
    for (char& ch : str) {
        if (!isspace(ch)) {
            seen_chars.insert(tolower(ch));
        }
    }

    for(iter = seen_chars.begin(); iter != seen_chars.end(); ++iter) {
        std::cout << *iter << " ";
    }
    std::cout << std::endl;

    return 0;
} 
```

这个时间：

```
real    4m41.910s
user    3m32.014s
sys     0m17.858s 
```

### 3.删除`isspace()`检查和`tolower()`

除了 set insert，`isspace()`and`tolower()`是 for 循环中唯一发生的事情，所以我想我会删除它们。它又剃掉了1.5分钟。

```
#include <set>
#include <string>
#include <iostream>
#include <fstream>
#include <iterator>

int main(int argc, char **argv) {
    std::set<char> seen_chars;
    std::set<char>::const_iterator iter;
    std::ifstream ifs(argv[1]);

    ifs.seekg(0, std::ios::end);
    size_t size = ifs.tellg();
    fprintf(stderr, "Size of file: %lu\n", size);
    std::string str(size, ' ');
    ifs.seekg(0);
    ifs.read(&str[0], size);

    for (char& ch : str) {
        // removed isspace() and tolower()
        seen_chars.insert(ch);
    }

    for(iter = seen_chars.begin(); iter != seen_chars.end(); ++iter) {
        std::cout << *iter << " ";
    }
    std::cout << std::endl;

    return 0;
} 
```

最终版本的时间：

```
real    3m12.397s
user    2m58.771s
sys     0m13.624s 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-04-21T08:48:29.427

[@Triptych](https://stackoverflow.com/a/387890/5634162)的简单解决方案已经帮助了我（我的输入是一个 124 MB 的文件，所以这种将整个内容读入内存的方法仍然有效）。

但是，我遇到了编码问题，python 没有正确解释 UTF8 编码的输入。所以这里有一个稍微修改过的版本，适用于 UTF8 编码的文件（并且还对输出中收集的字符进行排序）：

```
import io
with io.open("my-file.csv",'r',encoding='utf8') as f:
    text = f.read()
    print "Unique Characters: {%s}" % ''.join(sorted(set(text))) 
```

# c# - C# TreeView 子节点计数.. 像 Outlook

> ID：387626
> 
> 赞同：1
> 
> 时间：2008-12-22T22:41:51.023
> 
> 标签：c#, treeview

在 C# 2.0 中，是否有人知道如何显示子节点的计数，就像 Outlook 对未读电子邮件所做的那样。此外，如果显示的计数可以与节点文本的颜色不同。

有没有人用“安全”代码实现了这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T22:46:52.650

为了显示具有多种颜色的字符串，您必须在树视图中进行自定义 GDI 绘图。这里有一章关于如何做 OwnerDrawn 控件：

[http://books.google.com/books?id=zDi4LIDvd4wC&pg=PA396&lpg=PA396&dq=treeview+ownerdrawn&source=web&ots=hJIvexSusO&sig=XR8-ktfgllcjFmGs0FSfP0HYqIc&hl=en&sa=X&oi=book_result&resnum=5&ct=result#PPA398,M1](http://books.google.com/books?id=zDi4LIDvd4wC&pg=PA396&lpg=PA396&dq=treeview+ownerdrawn&source=web&ots=hJIvexSusO&sig=XR8-ktfgllcjFmGs0FSfP0HYqIc&hl=en&sa=X&oi=book_result&resnum=5&ct=result#PPA398,M1)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-22T23:00:29.660

从树视图控件继承然后更改它以满足您的需要

# database-design - 几个数据库设计问题

> ID：387628
> 
> 赞同：0
> 
> 时间：2008-12-22T22:42:12.830
> 
> 标签：database-design

如果我有一个客户表，它将存储姓名、地址、电子邮件地址、电话号码，甚至可能还有一些关于客户的详细信息，例如年龄、偏好等。

如果我把它分成更小的表，我会做一件好事吗？例如 customer_contact 与联系人字段，并在原始客户表中只留下姓名、出生日期等。

此外，对于查找表，它们只是将不同表中的字段组合到一个大表中，对吗？

此外，在我自己的系统中，我有一个代表产品的表，但它只有一个 ID。该表的唯一字段是适用于许多产品的字段/属性（例如道路合法），这是另一个表的字段，因此两个表之间存在约束（关系）。我会假设查找表会将这两个表合并在一起，对吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T22:51:18.647

在大多数情况下，分解通常更好。当然，对于您列出的所有内容。

尝试将您的数据库设计想象为使用 Java 等语言编写的 OOP 程序，其中链接了复杂的对象。任何可以“链接”到您的实体的东西，特别是如果它可以链接到多个实体，都可能是候选对象，因此可能是一个表。

只向主要客户表提供有关个人的核心信息，这些信息对于按照您的建议识别他是必要的。

然后可以将所有其他元数据和辅助数据绑定到它。例如，地址、电话号码或电子邮件都是很好的候选对象，应该有自己的表，尤其是因为它们可能具有其他属性。然后另一个表可以将地址与客户相关联（例如，如果您有一个全家使用您的系统怎么办）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T22:55:48.810

我认为数据库设计就是平衡和判断。如果您看不到数据库变得非常大，请对其进行规范化。如果您可以看到它变得非常大，那么恕我直言，除非它必要的 IE 不会在任何地方使用映射表，否则无论任何人说扁平化数据库运行得更快，否则恕我直言阻止规范化。

除非您认为客户可能需要地址历史记录或单独的帐单和送货地址，否则我会将地址存储在同一张表中。我永远不会破坏联系方式和生日，因为它们并不是重点。

我使用像枚举这样的查找表，实际上它们中的大多数都变成了枚举。

每个人对数据库设计都有自己的想法......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:57:17.293

你在问正确的问题。将数据划分为可重用表的概念称为“规范化”。典型的客户关系经理 (CRM) 系统有一些表格，如电话、地址、个人……非常通用的表格，可以重复用于各种目的。

例如，电话和地址不仅可以用于客户，还可以用于托运人、供应商、员工等。

一旦你有了一个基本的结构，你就可以开始将客户链接到地址和电话。请记住，每个客户都可以有一个 ShippingAddress、BillingAddress、HomePhone、BillingPhone、MobilePhone 等。您将创建像 CustomerAddress 和 CustomerPhone 这样的表来将客户与他们各自的信息相匹配。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T23:46:36.477

比我聪明得多的人曾经说过：“正常化直到它受伤，非正常化直到它起作用”

将一个长表分解成更小的语义块是明智的，这些块通过一对一的关系连接起来。然后，您可以通过视图调用它们。甚至许多 ORM 都是 View 友好的

但是，如果您的数据库受到很多点击，这些额外的连接会对您造成伤害，就像在 Web 或 Intranet 场景中所做的那样。

如果您想在高压力情况下保持表分开，您可能需要使用许多公共 Web 项目中使用的肮脏和丑陋的作弊方法，并通过在主表上委派一列来创建假视图，以将相关数据存储在一个集合。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T22:50:33.813

这取决于。

当每个客户可能有多个（未知）联系人行数时，customer_contacts 表将很有用。另一方面，如果您确定每个客户有 3 个联系方式，则可以将其存储在与客户相同的表中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T22:52:51.657

一般来说，如果您有大量列（在这种情况下，可能需要重新设计），或者您对不同数据（SSN 或薪水）有不同的安全要求，您只会（垂直）分区表数据与正常数据分开）。

当您说“查找表”时，我认为您实际上指的是“外键”。如果您有一个包含产品可用性的表，那么每一行都会有一个 ProductID，它指向所有其余的产品信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T22:54:46.317

通常，术语查找表被过度使用。如果您再从标准编程的角度考虑，查找表相当于使用常量来引用幻数或常量对象。

因此，您为另一个通常是原子的实体使用唯一标识符，因为它不包含其他对象（例如，状态、地址、产品详细信息等）。在核心表中，您将拥有 ID 而不是实际的详细信息。

如果一个表指的是一个中心实体，最好从关系而不是查找表的角度来考虑。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T22:57:03.597

这是一种平衡行为，将所有列放在一个表中（非规范化）将导致更少的连接和更好的性能，但如果您以后必须更改内容，维护起来会很痛苦。正如[Uri 所提到](https://stackoverflow.com/questions/387628/a-few-database-design-questions#387657)的，从 OOP 角度考虑您的数据库设计将帮助您确定哪些表应该是独立的。我强烈建议学习如何组合一个简单的[实体关系图](http://en.wikipedia.org/wiki/ER_diagram)。这将允许您规划您的数据库设计，并计算出所有内容将如何链接在一起，然后再因实施而感到厌烦。

# css - Ems 到像素的转换 - 为什么是 62.5% 而不是 6.25%？

> ID：387631
> 
> 赞同：13
> 
> 时间：2008-12-22T22:43:08.413
> 
> 标签：css, fonts, font-size

我知道我们很多人都熟悉将 CSS 中 body 元素的字体大小设置为 62.5%。这意味着 1em 将等于 10px 并有助于保持像素完美，但也允许缩放字体。

那么这是否意味着将其设置为 6.25% 就等于 1em = 1px？似乎是一个更简单的转换，而不必弄乱小数......

* * *

多谢你们！我非常了解 em 及其历史（设计学位），但我相信其他人可能会觉得它有帮助:)

至于 1em = 1px，我不认为这是不可取的。em 是正方形的，不管你的单位是什么（无论是点还是像素），没有人会将它们的类型设置为 1px（就像没有人会将打印类型设置为 1pt）。此外，即使您的文章也承认，在大多数数字字体中，大写字母“M”通常小于 1em，并且 em 只是点大小的反映（48pt 字体会为 em 呈现 48pt x 48pt 正方形，12pt类型将产生 12x12 等）

此外，人们这样做的原因更多是为了设置页面上其他元素的尺寸，以便在用户调整字体大小时一切都可以很好地缩放。当然，总会有少数人将默认值设置为 16 像素以外的其他值，但值得为可以很好地缩放的像素完美布局付出的代价。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-22T23:14:05.810

首先，不要假设 1 em 等于 10 像素。em 单位与所使用的排版直接相关。如果某人的字体大小为 16 像素，那么 62.5% 确实是 10 像素（16 * 0.625 = 10），但是当有人修改他们的默认字体大小时，这显然会改变。

其次，这是我第一次听说使用 62.5% 的基体`font-size`。我总是使用`font-size`基于[Owen Briggs 的 Sane CSS Typography](http://www.thenoodleincident.com/tutorials/typography/)的 76% 。

最后，要回答您的问题，是的，您可以使用 6.25% 的字体大小，然后使用`12em`而不是`1.2em`，例如。但是，我强烈反对这种方法。在排版的世界中，一个 em 旨在成为[大写字母 'M' 的宽度](http://en.wikipedia.org/wiki/Em_(typography))。这种方法完全违反了这种惯例，并且会严重混淆将来可能维护您的 CSS 的任何人。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T23:01:09.003

可以说，但是你失去了对规模的控制。不要忘记标题通常会按照它们的排名比例继承这些相同的大小（即`<h1>`最大，`<h2>`稍小）。如果要减少这些元素，则需要使用带有大量小数占位符的 em 值。想象一下`<h4> font-size: 0.005em`。

或者更糟的是，如果你想让字体放大，你可能会看到`font-size: 40em`一些可笑的东西。

简而言之，1em = 10px 对于字体的缩放值更实用。虽然 1:1 的比例在纸面上可能是有意义的，但它并不适合明智和可维护的 CSS。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-10-27T15:30:36.173

我尝试做同样的事情，但遇到了使用 rems 作为边距和填充的问题。设置`font-size`为 62.5% 可避免这些问题。

例如，下面的 CSS

```
html { 
  font-size: 6.25% /* 16px * .0625 => 1px */
}

p {
  font-size: 1rem;
  margin:    1rem;
} 
```

呈现为：

```
p {
  font-size: 1px;
  margin:    9px; /* WTF?! */
} 
```

奇怪，对吧？我假设这是由最小字体大小的一些奇怪冲突引起的。

* * *

现在，如果你使用`font-size: 62.5%`另一方面，事情会按预期呈现：

```
html { 
  font-size: 62.5% /* 16px * .625 => 10px */
}

p {
  font-size: .1rem;
  margin:    .1rem;
} 
```

呈现为：

```
p {
  font-size: 1px;
  margin:    1px;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-22T23:11:46.547

转换可能更简单，但 em 并不意味着它应该意味着什么。

如果给定字体中的大写“M”，则 1em 应该等于宽度。如果字母 M 的宽度为 1 像素，则您的字体将不可读。

[http://en.wikipedia.org/wiki/Em_（排版）](http://en.wikipedia.org/wiki/Em_(typography))

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-11-17T19:07:14.427

无论如何，整个“62.5%=10px”的东西从根本上被打破了——62.5% 可能是也可能不是 10px，这取决于浏览器、用户的设置，尤其是最小字体大小设置。因此，您不能仅以像素为单位进行设计，然后在假设 62.5%=10px 的情况下“转换”为 em，因为您的设计会一直中断。如果你想要一个像素完美的设计，你必须以像素为单位。如果你想要一个灵活的设计，你需要为网站的不同元素考虑适当的单位 - ems 表示应该与文本大小相关的元素，百分比表示应该相对于窗口大小缩放的元素，以及元素的像素（像图像）根本不应该缩放。

任何在他们的 CSS 中包含 font-size: 62.5% 的人基本上都不了解如何为 Web 设计。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-05-02T07:04:25.310

好问题。

**对于自适应/响应式网页设计**和***弹性*模板**，我认为 6.25% 是一个有趣的提议。

特别是带有`rem`单位的字体大小可以根据您的论点自行调整... 1:1 的比例*更容易*。

> **rem** : "root em"... 根元素的字体大小。 [http://www.w3.org/TR/css3-values/](http://www.w3.org/TR/css3-values/)

请参阅以下`rem`示例：[http ://snook.ca/archives/html_and_css/font-size-with-rem#c67739](http://snook.ca/archives/html_and_css/font-size-with-rem#c67739)

```
html { font-size: 62.5%; } 
body { font-size: 14px; font-size: 1.4rem; } /* =14px */
h1   { font-size: 24px; font-size: 2.4rem; } /* =24px */ 
```

现在有了你的建议......

```
html { font-size: 6.25%; } /* 1em = 1px if browser has 1em = 16px */
body { font-size: 14px; font-size: 14rem; } /* =14px */
h1   { font-size: 24px; font-size: 24rem; } /* =24px */ 
```

... 使用我的 JSBin 示例：[测试弹性内容的 CSS3“rem”单元](http://jsbin.com/acide4)

1:1 em 与 px 的比例应该会减少拼写错误。

*REM 注释：*通过适当的 CSS 重置并在两者中`body`声明基础，您的样式会优雅地降级...如果支持，并在 之后声明，则应用它的值。否则浏览器会退回到.`font-size``px``rem``rem``px``px`

确定对`rem`. 请使用任何/所有浏览器/设备访问此页面... [http://ahedg.es/w/rem.html](http://ahedg.es/w/rem.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-30T17:36:29.500

您可能会发现这也很有用。[http://pixel2em.kleptomac.com](http://pixel2em.kleptomac.com) 这提供了一个在线像素到 em 转换器，您还可以进行完整的 CSS 文件转换。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-16T07:43:02.010

更新版本可在[http://pixelconverter.kleptomac.com](http://pixelconverter.kleptomac.com)获得。 它是一个在线单位转换器，用于转换像素、点、em、百分比。这支持从/到任何这些单位的转换。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-27T19:57:14.240

对于看到这篇有用帖子的任何人，我想分享一个关于良好网络排版的 youtube 视频（大约 48 分钟）的链接。它是真实的，并为每个人提供了重要的洞察力，从而改变了您为网络设置类型的方式。

我只是根据这个会议视频做了一些细微的改变，所取得的结果甚至被我们的用户认为是令人惊讶的。

演示文稿来自[Richard Rutter](https://stackoverflow.com/users/3104912/richard-rutter)，演示文稿的链接是[Richard Rutter | 网页排版](https://youtu.be/hbIZX6tE9JY)

# c++ - 在 C++ 中调度异常

> ID：387633
> 
> 赞同：3
> 
> 时间：2008-12-22T22:43:35.387
> 
> 标签：c++, oop, exception

应该如何分派异常，以便以集中、用户友好的方式处理错误处理和诊断？

例如：

*   DataHW 类处理与某些数据采集硬件的通信。
*   DataHW 类可能会根据许多可能的错误抛出异常：间歇性信号、无信号、CRC 故障、驱动程序错误。每种类型的错误都有自己的异常类。
*   DataHW 类由许多不同的代码段调用，这些代码段执行不同类型的采集和分析。

正确的错误处理策略取决于异常的类型和正在尝试的操作。（对于间歇性信号，重试 X 次然后告诉用户；对于驱动程序错误，记录错误并重新启动驱动程序；等等。）应该如何调用这种错误处理策略？

*   将错误恢复编码到每个异常类中：这将导致异常类相当大并且包含高级 UI 和系统管理代码。这似乎很糟糕。
*   为每种类型的异常提供一个单独的`catch`块：由于 DataHW 类是从许多不同的地方调用的，因此每个`catch`块都必须在每个调用点复制。这似乎很糟糕。
*   使用带有基于 RTTI 的巨大语句`catch`调用某个函数的单个块：RTTI 并且通常表示应用 OO 设计失败，但这似乎是最不坏的选择。`ExceptionDispatch``switch``switch`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T22:52:51.140

通过 catch (...) 并调用重新抛出和调度的共享处理函数来避免在每个调用站点重复 catch 块：

```
f()
{
    try
    {
        // something
    }
    catch (...)
    {
        handle();
    }
}

void handle()
{
    try
    {
        throw;
    }
    catch (const Foo& e)
    {
        // handle Foo
    }
    catch (const Bar& e)
    {
        // handle Bar
    }
    // etc
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T23:14:05.530

我一直遇到的一个想法是异常应该被可以处理它们的级别捕获。例如，传输数据的函数可能会捕获 CRC 错误，并且在捕获此异常后，它可能会尝试重新传输，而“无信号”异常可能会在更高级别捕获并丢弃或延迟整个操作.

但我的猜测是，这些异常中的大多数都会被同一个函数捕获。*单独捕获和处理它们是*个好主意（如在 soln #2 中），但您说这会导致大量重复代码（导致 soln #3。）

我的问题是，如果有很多代码要复制，为什么不把它变成一个函数呢？

我在想...

```
void SendData(DataHW* data, Destination *dest)
{
    try {
        data->send(dest);
    } catch (CRCError) {
        //log error

        //retransmit:
        data->send(dest);
    } catch (UnrecoverableError) {
        throw GivingUp;
    }
} 
```

我想这就像您的 ExceptionDispatch() 函数，只是不是`switch`对异常类型进行 ing，而是包装异常生成调用本身和`catch`异常。

当然，这个函数被过度简化了——你可能需要一个完整的围绕 DataHW 的包装类；但我的观点是，最好有一个集中点来处理所有 DataHW 异常——如果该类的不同用户处理它们的方式相似的话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T01:54:06.610

我认为有三种方法可以解决这个问题。

### 编写包装函数

为每个可以抛出异常的函数编写一个包装函数来处理异常。然后所有调用者调用该包装器，而不是原始的抛出函数。

### 使用函数对象

另一种解决方案是采用更通用的方法并编写一个函数，该函数采用函数对象并处理所有异常。下面是一些例子：

```
class DataHW {
public:
    template<typename Function>
    bool executeAndHandle(Function f) {
        for(int tries = 0; ; tries++) {
            try {
                f(this);
                return true;
            }
            catch(CrcError & e) {
                // handle crc error
            }
            catch(IntermittentSignalError & e) {
                // handle intermittent signal
                if(tries < 3) {
                    continue;
                } else {
                    logError("Signal interruption after 3 tries.");
                } 
            }
            catch(DriverError & e) {
                // restart
            }
            return false;
        }
    }

    void sendData(char const *data, std::size_t len);
    void readData(char *data, std::size_t len);
}; 
```

现在，如果你想做某事，你可以这样做：

```
void doit() {
    char buf[] = "hello world";
    hw.executeAndHandle(boost::bind(&DataHW::sendData, _1, buf, sizeof buf));
} 
```

由于您提供函数对象，因此您也可以管理状态。假设 sendData 更新 len 以便它知道读取了多少字节。然后，您可以编写读取和写入的函数对象，并维护到目前为止读取的字符数。

第二种方法的缺点是您无法访问抛出函数的结果值，因为它们是从函数对象包装器中调用的。没有简单的方法来获取函数对象绑定器的结果类型。一种解决方法是编写一个结果函数对象，该函数对象在函数对象执行成功后由 executeAndHandle 调用。但是，如果我们在第二种方法中投入过多的工作，只是为了让所有的家务工作做好，那么结果就不再值得了。

### 将两者结合

还有第三种选择。我们可以结合这两种解决方案（包装器和函数对象）。

```
class DataHW {
public:
    template<typename R, typename Function>
    R executeAndHandle(Function f) {
        for(int tries = 0; ; tries++) {
            try {
                return f(this);
            }
            catch(CrcError & e) {
                // handle crc error
            }
            catch(IntermittentSignalError & e) {
                // handle intermittent signal
                if(tries < 3) {
                    continue;
                } else {
                    logError("Signal interruption after 3 tries.");
                } 
            }
            catch(DriverError & e) {
                // restart
            }
            // return a sensible default. for bool, that's false. for other integer
            // types, it's zero.
            return R();
        }
    }

    T sendData(char const *data, std::size_t len) {
        return executeAndHandle<T>(
            boost::bind(&DataHW::doSendData, _1, data, len));
    }

    // say it returns something for this example
    T doSendData(char const *data, std::size_t len);
    T doReadData(char *data, std::size_t len);
}; 
```

诀窍是`return f();`模式。即使 f 返回 void，我们也可以返回。这最终将是我最喜欢的，因为它既允许将句柄代码集中在一个地方，也允许在包装函数中进行特殊处理。您可以决定是否最好将其拆分并创建一个具有该错误处理函数和包装器的自己的类。可能这将是一个更清洁的解决方案（我在这里想到了[关注点分离](http://en.wikipedia.org/wiki/Separation_of_concerns)。一个是基本的 DataHW 功能，一个是错误处理）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T02:07:23.213

也许您可以为 DataHW 类编写一个包装类？包装器将提供与 DataHW 类相同的功能，但还包含所需的错误处理代码。好处是您将错误处理代码放在一个地方（DRY 原则），所有错误都将被统一处理。例如，您可以将所有低级 I/O 异常转换为包装器中的高级异常。基本上防止向用户显示低级异常。

正如 Butler Lampson 所说：计算机科学中的所有问题都可以通过另一个层次的间接性来解决

# sql - 添加到 LinQ-to-Entities 中 Update 的 Where 子句

> ID：387636
> 
> 赞同：5
> 
> 时间：2008-12-22T22:43:50.987
> 
> 标签：sql, linq, entity-framework, linq-to-entities

假设我有一个名为 Product 的表，其中包含三列：Id、CustomerId、Name。Id 是主键。该架构不在我的组的控制范围内，我们现在需要始终提供 CustomerId 作为所有查询（选择、更新、删除）的参数。这是一个很长的故事，我不想进入......它涉及触发器：-P

所以我的问题是，当我在 LinqToEntities 中有一个附加实体时，我想保存一些更新（比如在这种情况下我正在更新名称）。我怎样才能让它生成 SQL：

```
update Product set Name = @Name where Id=@Id and CustomerId=@CustomerId 
```

where 子句中除了主键外还包含 customerId 参数。

谢谢 ：-）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T14:56:38.903

CustomerId 是否有助于唯一标识经过@Id 的行？我并没有真正遵循“触发器”位，因为触发器不知道用于更新的谓词。或者您确实希望每次都重新更新 CustomerId（可从`UPDATE(...)`触发器中检测到）

最简单的选择是将其作为对象更新：

```
var qry = from product in model.Products
          where Id == @Id && CustomerId == @CustomerId
          select product;

foreach(Product p in qry) {
    p.Name = @Name;
}

model.SaveChanges(); // or whatever the method is in EF 
```

如果你知道你期待一个记录，你可以使用：

```
Product prod = (from product in model.Products
          where Id == @Id && CustomerId == @CustomerId
          select product).Single();

prod.Name = @Name;
mode.SaveChanges(); // ditto 
```

您**也**可以将其编写为 Entity-SQL，但我不确定我是否会亲自打扰......（更新：我刚刚检查过，我认为 Entity-SQL 不包含 DML，所以不，你不能——你必须使用上面的或者常规的 SQL 命令/SPROC）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T14:28:53.747

一种方法是[使用存储过程进行更新](http://msdn.microsoft.com/en-us/library/cc716731.aspx)。这使您可以完全控制 SQL。

另一种方法是将 CustomerId 添加到实体键。

# sql-server - Sql 存储过程 Like Operator 变量

> ID：387638
> 
> 赞同：5
> 
> 时间：2008-12-22T22:44:02.920
> 
> 标签：sql-server, tsql

```
print("select CustomerNo, CustomerName, Address, City, State, Zip,
    Phone, Fax, ContactName, Email  
    from Customers where CustomerName like '%field%'"); 
```

大家好。这是一个简单的问题，但我无法弄清楚，因为我对 tsql 和 sql 很陌生。

我使用上面的存储过程进行搜索。我的问题是'%field%'。您使用什么变量或它在 tsql 中如何工作？例如，“其中客户 = @CustomerNo”。通配符怎么样？您如何将变量与通配符一起传递？我想我可以在代码中执行“%”+“field”+“%”，但有没有办法不这样做？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-22T22:47:36.143

通配符只是字符串文字的一部分，例如 '%field%' 只是一个字符串。

您可以将通配符连接到您的字符串上，然后使用该字符串：

```
@Pattern = '%' + @CustomerName + '%';

...WHERE CustomerName LIKE @Pattern 
```

或者，您可以在涉及连接的 SQL 中编写表达式：

```
WHERE CustomerName LIKE '%' + @CustomerName + '%' 
```

对此没有其他神奇的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T00:07:10.897

这很简单。"=" 和 "Like" 都是运算符。你可以在一个之后做什么，你可以在另一个之后做什么。

因此，如果在 C# 中并使用 SQLClient 调用，您可以说：

```
string value;
...
value = "Some name";
...
myCommand.CommandText = "Select...from Customers Where CustomerName Like @Var";
myCommand.Parameters.AddWithValue("@Var", "%" + value + "%");
myCommand.ExecuteNonQuery(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T22:47:17.720

如果你使用 =，你说“等于”，它不会使用通配符。

如果你使用 LIKE，它只适用于文本字段，它可以使用通配符。

您无法使用 = 获得通配符匹配。

请注意，根据数据，通配符搜索可能会进行表扫描，因此我会在您允许之前确保这是您想要的。

例如，这将进行表扫描：

```
WHERE CustomerID LIKE '%1' 
```

IE。所有具有以 1 结尾的客户标识符（即文本）的客户。这无法通过索引来解决。

最后的想法。我不是 100% 确定我完全理解你在问什么。请你澄清一下。“将变量与通配符一起传递”具体是什么意思？

# c# - BackgroundWorker 中的同步工作

> ID：387640
> 
> 赞同：1
> 
> 时间：2008-12-22T22:45:01.983
> 
> 标签：c#, multithreading, backgroundworker

我的应用程序在多个文件上独立执行耗时的工作。我创建了一个 BackgroundWorker 来将工作传递给每个文件，但似乎 backgroundworker 只能执行异步工作。是否可以同时执行多个异步任务，或者是否有类似的对象可以执行同步操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T23:21:34.563

后台工作人员通常用于更新 UI 和/或传递工作，这样您就不会在长时间运行的进程发生时冻结 UI。这意味着您“传递”后台工作进程“文件工作”，然后使用回调来更新 UI（通常），在此期间您的 APP 保持响应。

如果这些项目是独立的，那么您可能需要处理几个线程来拆分工作。再说一次，如果我理解正确的话。如果我是，那么您可能想查看[Jon Skeet 的](http://www.yoda.arachsys.com/csharp/threads/)线程文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T23:19:52.617

虽然您可以使用 BackgroundWorker，但我认为您应该简单地分拆几个线程来完成这项工作。一个线程（可能是主线程）将创建并启动这些工作线程，然后对所有工作线程执行 Join 以等待处理完成。

或者，如果您使用的是 .Net 3.5，请[查看 .Net 的并行扩展。](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)该库中的 Task 对象可能非常适合您的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T19:18:43.057

您可以通过在代码中创建多个 BackgroundWorker 对象来执行多个异步任务。我们创建了一个 JobPool 类，该类创建了许多要运行的 BackgroundWorker 对象，以便我们可以随时控制运行的总数。但是，如果只有几个文件，您将要处理这将是矫枉过正。

# java - 为什么 Java 编译器不能解决这个问题？

> ID：387646
> 
> 赞同：3
> 
> 时间：2008-12-22T22:47:29.327
> 
> 标签：java, generics, collections

在以下示例中，为什么编译器无法从 Collections.emptySet() 推断出正确的类型？

```
import java.util.*;
import java.io.*;

public class Test {
    public interface Option<A> {
        public <B> B option(B b, F<A,B> f);
    }

    public interface F<A,B> {
        public B f(A a);
    }

    public Collection<String> getColl() {
        Option<Integer> iopt = null;

        return iopt.option(Collections.emptySet(), new F<Integer, Collection<String>>() {
            public Collection<String> f(Integer i) {
                return Collections.singleton(i.toString());
            }
        });
    }
} 
```

这是编译器错误消息：

```
knuttycombe@knuttycombe-ubuntu:~/tmp/java$ javac Test.java 
Test.java:16: <B>option(B,Test.F<java.lang.Integer,B>) in 
Test.Option<java.lang.Integer> cannot be applied to (java.util.Set<java.lang.Object>,
<anonymous Test.F<java.lang.Integer,java.util.Collection<java.lang.String>>>)
            return iopt.option(Collections.emptySet(), new F<Integer, Collection<String>>() {
                   ^
1 error 
```

现在，getColl() 的以下实现当然可以工作：

```
 public Collection<String> getColl() {
        Option<Integer> iopt = null;

        Collection<String> empty = Collections.emptySet();
        return iopt.option(empty, new F<Integer, Collection<String>>() {
            public Collection<String> f(Integer i) {
                return Collections.singleton(i.toString());
            }
        });
    } 
```

并且 Collections 上的类型安全方法的全部目的是避免单例集合出现此类问题（而不是使用静态变量。）那么编译器是否根本无法跨多个泛型级别执行推理？这是怎么回事？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T22:51:57.647

Java 的推理需要大量的帮助。在很多情况下，类型系统可以更好地推断，但在您的情况下，以下将起作用：

```
print("Collections.<String>emptySet();"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T23:25:14.553

首先，您可以将问题缩小到此代码：

```
public class Test { 
    public void option(Collection<String> b) {
    }

    public void getColl() {
        option(Collections.emptySet());
    }
} 
```

这不起作用，您需要一个临时变量，否则编译器无法推断类型。这是对这个问题的一个很好的解释：[为什么临时变量在调用泛型方法的情况下很重要？](http://www.angelikalanger.com/GenericsFAQ/FAQSections/TechnicalDetails.html#Why%20do%20temporary%20variables%20matter%20in%20case%20of%20invocation%20of%20parameterized%20methods?)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:58:17.010

`Collections.emptySet()`不是 a `Collection<String>`，除非 Java 知道它需要 a `Collection<String>`。在这种情况下，编译器似乎对它尝试确定类型的顺序有些愚蠢，并`Collections.emptySet()`在尝试确定 B 的预期模板参数类型之前尝试确定返回类型实际上是`String`.

解决方案是明确声明您需要`Collections.<String>emptySet()`，如 GaryF 所述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T22:52:20.753

它看起来像一个类型转换问题 - 即，它需要将`Object`（在 中`Set<Object>`，这将是空集的类型）转换为`String`. 在一般情况下，向下转型并不安全。

# estimation - FogBugz 估计和结对编程

> ID：387653
> 
> 赞同：4
> 
> 时间：2008-12-22T22:50:14.827
> 
> 标签：estimation, fogbugz, extreme-programming

我使用 FogBugz 作为工具，让我们“展望未来”。该程序需要我们的工作时间，发布任务，分配开发人员对该任务的估计，以及开发人员倾向于低估/高估的倾向，并试图提出在未来的一系列日期发布发布的概率.

现在，由于 FogBugz 考虑到了工作时间，它假设开发人员会将时间投入到分配给他们的任务中，这在 XP 中是不正确的，因为他们之前的决定是完成开发人员的一项任务一起。

这是否意味着我在进行结对编程时不能使用 FogBugz 进行估算？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T17:59:13.090

在这种情况下，我会做的是让每个开发人员估计他的每个发布案例，以在结对编程时完成它所需的工作时间表示（即与实际工作的合作伙伴一起工作的时间）。然后弄清楚你在自己的任务上和别人的任务上花费了多少时间结对编程，并在你的工作计划中将“花费在 FogBugz 任务上的时间百分比”设置为你花费在自己任务上的时间的大致百分比。

然后，当您处理您的任务时，将您自己标记为 Working On -> 案例 ID，当您处理其他人的任务时，设置 Working On -> Nothing。

实际上有很多不同的方法可以让它发挥作用（这里的其他答案可能会更好，具体取决于具体情况），但这就是我的做法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T23:03:11.977

如果两个程序员一起工作，那么实际上他们就像一个有两个脑袋的程序员，不是吗？为什么不在 FogBugz 中创建另一个代表它们的用户帐户？然后他们还应该一起产生他们的估计。这实际上可能会提高精度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T22:59:35.993

> 这是否意味着我在进行结对编程时不能使用 FogBugz 进行估算？

我没有任何 FogBogz 经验，但我会说“试一试”。FogBogz 中时间估计的全部意义在于该软件从经验中学习并基于此自动更正估计。这是一个非常强大的机制，因为在实践中，大多数人的估计都值得深究。看看 FogBugs 是否也能处理配对估计会很有趣。我预计误差范围会更高一些，但估计值可能仍然可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T23:25:58.017

> 这是否意味着我在进行结对编程时不能使用 FogBugz 进行估算？

我没有这方面的经验，但直觉会告诉我“这取决于”

详细说明 - 假设您有 2 个程序员，John 和 Bob，他们都拥有 FB 帐户：

John 是否总是与 Bob 结对编程？
- 约翰的估计应该与他的实际完成时间一致。即使他根据自己的想法进行估计，“速度”计算也应该弥补这一点

John 有时会与 Bob 结对编程，有时会与他自己结对编程吗？
- 如果约翰提前知道哪些项目将配对，哪些不会配对，他将相应地调整他的估计。他们可能仍然是错误的，但速度计算应该仍然可以吗？也许？

John 是否与各种各样的合作伙伴结对编程？（可选地包括单独编程）
- 你被搞砸了。有太多的变量在运行，John 无法做出任何有用的估计，更不用说 FB 或其他任何东西（或任何人）来补偿它们了。

# c++ - 为什么 C/C++/rtl 中没有 Z80 之类的 LDIR 功能？

> ID：387654
> 
> 赞同：5
> 
> 时间：2008-12-22T22:50:16.670
> 
> 标签：c++, c, z80

在 Z80 机器代码中，一种将缓冲区初始化为固定值的廉价技术，例如所有空白。所以一段代码可能看起来像这样。

```
LD HL, DESTINATION             ; point to the source
LD DE, DESTINATION + 1         ; point to the destination
LD BC, DESTINATION_SIZE - 1    ; copying this many bytes
LD (HL), 0X20                  ; put a seed space in the first position
LDIR                           ; move 1 to 2, 2 to 3... 
```

结果是 DESTINATION 处的内存块完全被空白填充。我已经尝试过 memmove 和 memcpy，但无法复制这种行为。我希望 memmove 能够正确地做到这一点。

**为什么 memmove 和 memcpy 会这样？**

**有没有合理的方法来做这种数组初始化？**

我已经知道 char array[size] = {0} 用于数组初始化

我已经知道 memset 将为单个字符完成这项工作。

这个问题还有哪些其他方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-22T23:32:15.400

`memmove`并且`memcpy`不要那样工作，因为它不是移动或复制内存的有用语义。在 Z80 中填充内存很方便，但是为什么你会期望一个名为“memmove”的函数用一个字节填充内存呢？它用于移动内存块。无论块如何重叠，它的实现都是为了获得正确的答案（源字节被移动到目的地）。获得移动内存块的正确答案很有用。

如果您想填充内存，请使用 memset，它旨在满足您的需求。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-23T08:56:12.203

有一种使用堆栈清空内存区域的更快方法。尽管 LDI 和 LDIR 的使用非常普遍，但 David Webb（他以各种方式推动 ZX Spectrum，例如包括边框在内的全屏数字倒计时）提出了这种快 4 倍的技术：

*   保存堆栈指针，然后将其移动到屏幕的末尾。
*   将 HL 寄存器对加载为零，
*   进入一个巨大的循环，将 HL 推入堆栈。
*   堆栈在内存中上下移动屏幕，并在此过程中清除屏幕。

上面的解释取自[对 David Webbs 游戏 Starion](http://www.users.globalnet.co.uk/~jg27paw4/yr15/yr15_36.htm)的评论。

Z80 例程可能看起来像这样：

```
 DI              ; disable interrupts which would write to the stack.
  LD HL, 0
  ADD HL, SP      ; save stack pointer
  EX DE, HL       ; in DE register
  LD HL, 0
  LD C, 0x18      ; Screen size in pages
  LD SP, 0x4000   ; End of screen
PAGE_LOOP:
  LD B, 128       ; inner loop iterates 128 times
LOOP:
  PUSH HL         ; effectively *--SP = 0; *--SP = 0;
  DJNZ LOOP       ; loop for 256 bytes
  DEC C
  JP NZ,PAGE_LOOP
  EX DE, HL
  LD SP, HL       ; restore stack pointer
  EI              ; re-enable interrupts 
```

但是，该例程的速度略低于两倍。LDIR 每 21 个周期复制一个字节。内部循环每 24 个周期复制两个字节—— 11 个周期 for`PUSH HL`和 13 个 for `DJNZ LOOP`。要获得近 4 倍的速度，只需展开内部循环：

```
LOOP:
   PUSH HL
   PUSH HL
   ...
   PUSH HL         ; repeat 128 times
   DEC C
   JP NZ,LOOP 
```

这几乎是每两个字节 11 个周期，比 LDIR 的每字节 21 个周期快大约 3.8 倍。

毫无疑问，这项技术已经被重新发明了很多次。例如，它出现在 1980 年[用于 TRS-80 的 sub-Logic 的 Flight Simulator 1中。](http://www.trs-80.org/t80-fs1/ "用于 TRS-80 的 sub-Logic 飞行模拟器 1")

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-22T23:35:21.710

我相信这与 C 和 C++ 的设计理念有关。正如[Bjarne Stroustrup](http://en.wikipedia.org/wiki/Bjarne_Stroustrup)曾经[说过](http://www.research.att.com/~bs/crc.pdf)的，C++ 设计的主要指导原则之一是“你不使用什么，你就不用付钱”。而[丹尼斯·里奇](http://en.wikipedia.org/wiki/Dennis_Ritchie)可能没有用完全相同的话说出来，我相信这也是指导他设计 C（以及后来的人设计 C）的指导原则。现在您可能会认为，如果您分配内存，它应该自动初始化为 NULL，我倾向于同意您的看法。但这需要机器周期，如果您在每个周期都很关键的情况下进行编码，那么这可能不是一个可以接受的权衡。基本上，C 和 C++ 尽量不妨碍你——因此，如果你想要初始化某些东西，你必须自己做。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-22T22:54:49.857

> 为什么 memmove 和 memcpy 会这样？

可能是因为没有针对 Z80 硬件的特定现代 C++ 编译器？写一个。;-)

这些语言没有指定给定硬件如何实现任何东西。这完全取决于编译器和库的程序员。当然，为每个可以想象的硬件配置编写一个自己的、高度指定的版本是一项艰巨的工作。这就是原因。

> 有没有合理的方法来做这种数组初始化？有没有合理的方法来做这种数组初始化？

好吧，如果一切都失败了，你总是可以使用内联汇编。除此之外，我希望`std::fill`在一个好的 STL 实现中表现最好。是的，我完全意识到我的期望太高了，而且`std::memset`在实践中通常表现更好。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-23T04:02:56.677

你展示的 Z80 序列是最快的方法——在 1978 年。那是 30 年前。从那时起，处理器已经取得了很大进步，而今天这几乎是最慢的方法。

Memmove 旨在在源和目标范围重叠时工作，因此您可以将一块内存向上移动一个字节。这是 C 和 C++ 标准规定的行为的一部分。Memcpy 未指定；它的工作方式可能与 memmove 相同，也可能不同，具体取决于您的编译器决定如何实现它。编译器可以自由选择比 memmove 更高效的方法。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-22T23:34:08.577

如果您在硬件级别上摆弄，那么一些 CPU 具有 DMA 控制器，可以非常快速地填充内存块（比 CPU 可以做的快得多）。我在飞思卡尔 i.MX21 CPU 上完成了这项工作。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-23T04:21:06.097

这可以在 x86 汇编中轻松完成。事实上，它归结为与您的示例几乎相同的代码。

```
mov esi, source    ; set esi to be the source
lea edi, [esi + 1] ; set edi to be the source + 1
mov byte [esi], 0  ; initialize the first byte with the "seed"
mov ecx, 100h      ; set ecx to the size of the buffer
rep movsb          ; do the fill 
```

但是，如果可以的话，一次设置多个字节会更有效。

最后，`memcpy`/`memmove`不是您要查找的内容，它们用于将内存块从一个区域复制到另一个区域（memmove 允许 source 和 dest 成为同一缓冲区的一部分）。`memset`用您选择的字节填充块。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-22T22:56:33.020

还有一个[calloc](http://www.opengroup.org/onlinepubs/000095399/functions/calloc.html)在返回指针之前分配并初始化内存为 0。当然，calloc 只初始化为 0，而不是用户指定的值。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-23T08:27:31.370

如果这是在 Z80 上将内存块设置为给定值的最有效方法，那么很有可能`memset()`如您在针对 Z80s 的编译器上描述的那样实现。

它可能也`memcpy()`可能在该编译器上使用类似的序列。

但是，为什么编译器针对具有与 Z80 完全不同的指令集的 CPU 会期望使用 Z80 习语来处理这些类型的事情呢？

请记住，x86 架构有一组类似的指令，可以以 REP 操作码为前缀，让它们重复执行以执行复制、填充或比较内存块等操作。然而，当英特尔推出 386（或者可能是 486）时，CPU 实际上会比循环中的简单指令更慢地运行这些指令。所以编译器经常停止使用面向 REP 的指令。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-23T09:14:43.413

说真的，如果您正在编写 C/C++，只需编写一个简单的 for 循环，让编译器为您服务。例如，这里有一些代码 VS2005 为这种情况生成（使用模板大小）：

```
template <int S>
class A
{
  char s_[S];
public:
  A()
  {
    for(int i = 0; i < S; ++i)
    {
      s_[i] = 'A';
    }
  }
  int MaxLength() const
  {
    return S;
  }
};

extern void useA(A<5> &a, int n); // fool the optimizer into generating any code at all

void test()
{
  A<5> a5;
  useA(a5, a5.MaxLength());
} 
```

汇编器输出如下：

```
test PROC

[snip]

; 25   :    A<5> a5;

mov eax, 41414141H              ;"AAAA"
mov DWORD PTR a5[esp+40], eax
mov BYTE PTR a5[esp+44], al

; 26   :    useA(a5, a5.MaxLength());

lea eax, DWORD PTR a5[esp+40]
push    5               ; MaxLength()
push    eax
call    useA 
```

它没有*比*这更有效的了。停止担心并相信你的编译器，或者至少在尝试找到优化方法之前看看你的编译器产生了什么。为了比较，我还使用`std::fill(s_, s_ + S, 'A')`and`std::memset(s_, 'A', S)`而不是 for 循环编译了代码，编译器产生了相同的输出。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-14T18:13:44.887

如果你在 PowerPC 上，_dcbz()。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-04-19T22:59:28.767

在许多情况下，拥有一个“memspread”函数会很有用，该函数的定义行为是在整个事物中复制内存范围的起始部分。尽管如果目标是传播单个字节值， memset() 做得很好，但有时可能希望用相同的值填充整数数组。在许多处理器实现中，一次将一个字节从源复制到目标将是一种非常糟糕的实现方式，但设计良好的函数可以产生良好的结果。比如先看数据量是不是小于32字节左右；如果是这样，只需按字节复制；否则检查源和目标对齐；如果它们对齐，则将大小向下舍入到最接近的单词（如有必要），然后将第一个单词复制到任何地方，

我有时也希望有一个函数被指定为自下而上的 memcpy，*用于*重叠范围。至于为什么没有标准，我想没有人认为这很重要。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-23T03:26:01.980

`memcpy()`应该有这种行为。`memmove()`并非设计使然，如果内存块重叠，它会复制从缓冲区末尾开始的内容以避免这种行为。但是要使用特定值填充缓冲区，您应该`memset()`在 C 或`std::fill()`C++ 中使用，大多数现代编译器将优化到适当的块填充指令（例如 x86 架构上的 REP STOSB）。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-12-29T16:05:27.370

如前所述，memset() 提供了所需的功能。

memcpy() 用于在源缓冲区和目标缓冲区不重叠或 dest < 源缓冲区的所有情况下移动内存块。

memmove() 解决了缓冲区重叠和 dest > source 的情况。

在 x86 架构上，好的编译器直接用内联汇编指令替换 memset 调用，非常有效地设置目标缓冲区的内存，甚至应用进一步的优化，例如使用 4 字节值尽可能长地填充（如果以下代码在语法上不完全正确它在我很长一段时间没有使用 X86 汇编代码）：

`lea edi,dest
;copy the fill byte to all 4 bytes of eax
mov al,fill
mov ah,al
mov dx,ax
shl eax,16
mov ax,dx
mov ecx,count
mov edx,ecx
shr ecx,2
cld
rep stosd
test edx,2
jz moveByte
stosw
moveByte:
test edx,1
jz fillDone
stosb
fillDone:` 

实际上这段代码比你的 Z80 版本效率高得多，因为它不做内存到内存，而只是寄存器到内存移动。您的 Z80 代码实际上是一个 hack，因为它依赖于每个复制操作都填充了后续副本的源。

如果编译器一半好，它可能能够检测到可以分解为 memset 的更复杂的 C++ 代码（见下面的帖子），但我怀疑这是否真的发生在嵌套循环中，甚至可能调用初始化函数。

# asp.net - 单个表单域的最大限制？

> ID：387658
> 
> 赞同：1
> 
> 时间：2008-12-22T22:51:37.320
> 
> 标签：asp.net, iis-6

我遇到了一个随机发生的问题，看起来我们正在使用的第三方控件中存在错误，或者表单字段的大小受到限制。我已经看到经典 asp [http://support.microsoft.com/default.aspx?scid=kb;EN;q273482](http://support.microsoft.com/default.aspx?scid=kb;EN;q273482)有限制，但.net 有限制吗？

我相信如果我们达到整个帖子正文的最大限制设置，asp.net 会生成错误而不是截断表单字段。我知道这很可能是第三方控制中的一个错误，但我想审查所有其他可能的选项。基本上发生的事情是他们在正文中发布了一个 url 编码的 xml msg，并且 xml 有时会被截断。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T23:12:54.890

检查数据库表或存储过程中是否没有限制。如果那里没有限制，那么参数变量可能在 .net 代码中用限制声明。machine.config 中设置的默认 maxRequestLength 是 4096，它应该适应表单中的任何发布

不应该有任何限制，因为我有一些项目，人们在一个表单字段中发布超过 200,000 个字符。

# file-permissions - PHP-CLI + 文件权限

> ID：387659
> 
> 赞同：2
> 
> 时间：2008-12-22T22:51:37.993
> 
> 标签：file-permissions, php

当您在命令行中运行 php 脚本时，是以当前用户的读/写权限执行还是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T22:59:15.917

是的，它确实。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T22:59:36.290

是的，它以当前用户的权限运行。就像执行任何其他命令行程序一样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T23:03:41.073

是的，它将在默认设置中以当前用户身份运行。

如果您在 unix 系统上，您可以通过调整 php cli 二进制文件的 setuid 位来更改它。当然，这样做是个坏主意。

# estimation - 结对编程时如何估计

> ID：387664
> 
> 赞同：0
> 
> 时间：2008-12-22T22:52:42.733
> 
> 标签：estimation, extreme-programming, pair-programming

阅读[XP 书](https://rads.stackoverflow.com/amzn/click/com/0321278658)，我心中有一个我无法解决的矛盾，想知道你们是否可以提供帮助。

XP 说在索引卡上写故事，分配给开发人员，让她估计任务需要多长时间，然后使用结对编程来完成编码。

因此，她和她配对的开发人员必须选择执行他或她的任务。根据该选择，他们执行的工作将计入她为该任务所做的估计。这个估计是否仍然有效，因为它似乎取决于她与谁一起工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T22:57:53.830

必须在知道谁将执行任务的情况下进行估算。

否则他们没有任何意义。

开发者：“我可以在 17 小时内从多伦多开车到洛杉矶”（这是世界上随机的两个城市，110% 的数字，如果这两个城市之间甚至不可能开车，请不要起诉我）

经理：“好的，那我就送你这辆生锈的小孩自行车。17 小时后洛杉矶见”

显然那是行不通的。

因此，必须在确定谁将从事这些任务之后进行估算。

如果没有，你将不得不建立一个由克隆人或其他东西组成的大型同质团队，这将花费与执行特定任务的每个其他团队成员相同的时间。

请注意，这有点像一个人估计一项任务，另一个人去执行它的问题。除非两人非常熟悉（或者至少估计的人 100% 了解对方），否则你会得到不正确的估计。

“我估计鲍勃会用 2 个小时来做​​这件事”

就像那永远会飞一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T23:02:36.660

估算故事时，团队中的所有开发人员都应参与其中。估计不应该取决于谁来做这项工作。这在估计时​​甚至都不知道。我们使用[Planning Poker](http://en.wikipedia.org/wiki/Planning_poker)既有趣又能产生良好的效果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T23:30:58.177

> 因此，她和她配对的开发人员必须选择执行他或她的任务。根据该选择，他们执行的工作将计入她为该任务所做的估计。这个估计是否仍然有效，因为它似乎取决于她与谁一起工作？

我读对了吗？似乎暗示：

*   John 估计构建一个 Widget 需要 2 天时间
*   Lisa 估计修复一个 bug 需要 7 周时间
*   John 和 Lisa 聚在一起，决定着手修复错误。
*   发生 7 周，即使小部件没有启动，它也会被预订 7 周。

我还没有读过 XP 的书，但那肯定是不对的吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T07:53:17.413

我没有看到我可以同意的答案，所以这里有一个 wiki 描述了我现在如何看待这个问题。

实际上，负责该任务的开发人员将提出估算。假设我们可以更正该估计（例如，基于该特定开发人员的历史），我们可以推断出任务将花费的最长时间是她更正的估计，因为成对工作可能允许开发人员按时完成使用在与她配对的人的帮助下，她自己的专业知识或更快。所以在最坏的情况下，估计太长了，允许一些松弛。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T22:54:43.943

您可以创建相关估计：

如果我和 Bob 一起工作，这需要 3 天，其他人需要 5 天。

我不确定我是否理解问题的最后一部分，但是当一对组合在一起时，它是基于一个开发人员要求另一个开发人员配对。提出要求的开发人员要求他们完成他的任务，并且他们一次只能完成一项任务。如果他们很快完成，他们就会分开并分道扬镳。如果时间长了，可能还没完成任务就分手了，原来的开发者还得找人配对才能完成任务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-12T22:58:36.840

我配对时的基本规则之一：

永远不要将破解与初学者配对。小伙伴们的技能必须相当。否则，您将获得低性能、沮丧和麻烦。

因此，估计结果应该或多或少是现实的——不管是谁做的。

我的个人意见。

# c# - 更改 NHibernate 中的初始 LazyLoad 行为

> ID：387672
> 
> 赞同：4
> 
> 时间：2008-12-22T22:55:02.603
> 
> 标签：c#, .net, nhibernate, orm

我刚刚开始使用我认为很棒的 NHibernate 和 fluent-NHibernate。我一直在配置我的所有映射以将 LazyLoading 用于类之间的任何关系，因为通常我发现不需要预先加载所有内容。但是，有时您知道 100% 您将加载所有关系或至少一个关系，如果您预先获取数据，它将节省额外的连接。

无论如何，您可以告诉 NHibernate 加载关系的关系数据并覆盖初始设置吗？

我之前使用的是 LinqToSql，因为我会创建存储库，这些存储库会在必要时在哪些关系中加载哪些项目。这非常有效，所以我想要 NHibernate 类似的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-31T12:42:07.933

我发现这可以用于 NHibernate 查询的 LazyLoading / Eager loading 功能。

以正常方式创建您的 ICriteria，然后是关联名称（关系属性，对我来说是价格），然后是可以加入、选择、延迟加载、急切的获取类型

```
.SetFetchMode("Prices", FetchMode.Join) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-18T15:37:31.537

如果您正在执行 HQL，您可以使用“left outer join fetch”或“left join fetch”来加入您想要获取的关联，而不是延迟加载，例如

如果您有一个 Building 类，该类的属性返回一个 Address 对象，并且此关系是延迟加载的，您可能具有类似于以下内容的 HQL：

```
string hql = "from Building bld where bld.Type.Id = 1"; 
```

当为每个建筑物访问地址属性时，将执行另一个 SQL 语句。将 HQL 更改为以下内容将获取地址作为原始 SQL 语句的一部分：

```
string hql = "from Building bld left outer join fetch bld.Address as addr where bld.Type.Id = 1"; 
```

# svn - 可以将一组旧的导出文件与颠覆存储库进行比较吗？

> ID：387685
> 
> 赞同：2
> 
> 时间：2008-12-22T22:58:22.503
> 
> 标签：svn, version-control, export

问题是：我们的所有开发都在 subversion 下，但我们的 beta 版本只是一些杂乱无章的导出文件，它们并没有同时放在那里。或者，换一种说法，我们对版本化文件进行更改，然后当我们认为满意时，我们通过简单地将它们复制到不同的目录来手动导出它们。

好吧，我们希望整个作品都由 Subversion 管理，而 beta 版本作为树干头部的简单工作副本。我知道我可以从主干头开始，然后简单地回滚特定区域，直到我到达相同的文件，但很高兴知道每个文件需要回滚到哪个修订版。

是否存在这样的工具，它将获取一组文件/目录并将其与存储库进行比较，为每个文件/目录提供修订号？如果没有，我将如何将脚本放在一起来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T23:15:23.997

我对您的问题表示同情，但这是您将来必须以不同的方式解决的问题。

Subversion 有一个“目录副本”的概念，它是轻量级的，根本不占用存储库中的太多空间。

通常，如果您使用标签/分支/主干的常用布局，那么当您发布某些内容时，您会将主干复制到标签目录的新子文件夹中。

这样你就不必在事后试图找出每个文件的版本，Subversion 会为你跟踪它。

这很像说“我知道我的车撞到了岩壁上，但你能帮我把车放回去吗？”。答案当然是一开始就避免开车撞到岩壁上。

据我所知，Subversion 中没有任何功能可以告诉您磁盘上的文件看起来像每个文件的哪个版本，因此您要么制作一些脚本来逐个测试每个文件的版本，要么您做它手动。

哦，是的，以后不要开车撞到那堵岩壁上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T23:10:10.140

是啊！“弗兰肯版本”！

这是我推荐像[CruiseControl](http://cruisecontrol.sourceforge.net/)或[Hudson](http://hudson-ci.org/)这样的构建管理系统的地方。这些系统将为他们所做的每个构建创建一个标签（副本），因此您可以放心，与您的一个构建对应的所有内容都是一致的。

我喜欢将代码添加到我的构建脚本中，甚至从 CruiseControl 获取构建号并将它们放入我的构建中（比如我的“关于”文件、我的程序集元数据等）。这将使您可以轻松地交叉引用您的实际工作软件和 svn 中的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T21:55:21.933

[您可以尝试使用SharpSvn](http://sharpsvn.net/)编写一个工具来执行此操作。您面临的挑战是找出与您的文件相对应的存储库 url。之后，您可以获取日志，并针对该文件的日志调用 diff 的每个修订来验证它是否不同。

同样，我认为您必须解决的最大问题是找到每个文件的 Subversion URL

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-22T16:19:51.923

我想扩展桑德在上面的回答并坚持到底。

使用遵循以下算法的 SharpSvn 库创建一个工具。

```
FOR EACH of the exported files
  ITERATE backwards through the revisions of that file
  IF the revisioned file matches your exported copy
    SVN COPY that revisioned file to another branch 
```

为所有文件完成此操作后，您的新分支应该具有导出版本的工作副本。这很混乱，但它应该能让你到达你需要的地方。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T16:37:37.830

忘记 SharpSVN，还有 perl 和 python 绑定也可以，或者你可以在 bash 中使用 svn 命令行。毕竟你说的是脚本。

如果使用命令行，您需要在目录树中搜索等效文件，然后使用 svn log 命令获取单个文件的修订号列表；您还需要 svn diff 命令（使用 -r 选项）将您的文件与 repo 中的修订版进行比较。

我会打印出所有匹配的路径和修订号并手动整理它（以防万一您有重复！），但您希望 svn cp 命令将受控文件的分支创建到新目录。

# python - 使 ModelForm 与 Django 中的中间模型的多对多关系工作的步骤是什么？

> ID：387686
> 
> 赞同：31
> 
> 时间：2008-12-22T22:58:24.593
> 
> 标签：python, django, django-models, django-templates, django-forms

*   我有一个*客户*和*集团*模型。
*   一个*客户端*可以是多个*组*的一部分。
*   *属于某个组的客户*可以随时使用其组的免费租金，但只能使用一次。这就是中间模型（*ClientGroupe*）与额外数据一起出现的地方。

现在，当我尝试保存 m2m 数据时，它就死了，并说我应该使用 ClientGroupe 管理器......所以缺少什么？

## 这是我的模型：

```
class Groupe(models.Model):
    nom = models.CharField(max_length=1500, blank=True)

class Client(models.Model):
    nom = models.CharField(max_length=450, blank=True)
    prenom = models.CharField(max_length=450, blank=True)
    groupes = models.ManyToManyField(Groupe, null = True, blank = True, through='ClientGroupe')

class ClientGroupe(models.Model):
    client = models.ForeignKey(Client)
    groupe = models.ForeignKey(Groupe)
    dt = models.DateField(null=True, blank=True) # the date the client is using its group's free rental rate    

    class Meta:
        db_table = u'clients_groupes' 
```

## 这是我的观点：

```
def modifier(request, id):
    client = Client.objects.get(id=id)    
    form = ClientForm(instance = client)

    dict = {
        "form": form
        , "instance" : client
    }

    if request.method == "POST":
        form = ClientForm(request.POST, instance = client)

        if form.is_valid():
            client_mod = form.save()

            id = client_mod.id
            return HttpResponseRedirect(
                "/client/%(id)s/?err=success" % {"id" : id}
            )
        else:
            return HttpResponseRedirect(
                "/client/%(id)s/?err=warning" % {"id" : id}
            )

    return render_to_response(
        "client/modifier.html"
        , dict
        , context_instance=RequestContext(request)
    ) 
```

**编辑**：

这是 ClientForm 代码：

```
class ClientForm(ModelForm):
    class Meta:
        model = Client 
```

**编辑＃2**：这是错误消息：

```
AttributeError at /client/445/

Cannot set values on a ManyToManyField which specifies an intermediary model. Use ClientGroupe's Manager instead.

Request Method:     POST
Request URL:    http://localhost/client/445/
Exception Type:     AttributeError
Exception Value:    Cannot set values on a ManyToManyField which specifies an intermediary model.  Use ClientGroupe's Manager instead.

Exception Location:     C:\Python25\lib\site-packages\django\db\models\fields\related.py  in __set__, line 574
Python Executable:  C:\xampp\apache\bin\apache.exe
Python Version:     2.5.2 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-31T15:27:30.123

如果您现在使用 save 方法，Django 将尝试使用管理器进行保存（Django 不允许）。`ModelForm`不幸的是，您想要的行为比默认的行为有点棘手。您需要做的是创建一个*formset*。

首先，您需要更改您的选项`ClientForm`，使其不显示该`groupes`属性。

```
class ClientForm(ModelForm):
    class Meta:
        model = Client
        exclude = ('groupes',) 
```

接下来，您必须更改视图以显示表单集：

```
from django.forms.models import inlineformset_factory

def modifier(request, id):
    client = Client.objects.get(id=id)    
    form = ClientForm(instance = client)
    # Create the formset class
    GroupeFormset = inlineformset_factory(Client, Groupe)
    # Create the formset
    formset = GroupeFormset(instance = client)

    dict = {
        "form": form
        , "formset" : formset
        , "instance" : client
    }

    if request.method == "POST":
        form = ClientForm(request.POST, instance = client)
        formset = GroupeFormset(request.POST, instance = client)

        if form.is_valid() and formset.is_valid():
            client_mod = form.save()
            formset.save()

            id = client_mod.id
            return HttpResponseRedirect(
                "/client/%(id)s/?err=success" % {"id" : id}
            )
        else:
            return HttpResponseRedirect(
                "/client/%(id)s/?err=warning" % {"id" : id}
            )

    return render_to_response(
        "client/modifier.html"
        , dict
        , context_instance=RequestContext(request)
    ) 
```

显然，您还必须调整模板以呈现表单集。

如果您需要有关表单集的任何其他建议，请参阅以下文章：

[模型表单](http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#inline-formsets)
[集](http://docs.djangoproject.com/en/dev/topics/forms/formsets/#topics-forms-formsets)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-10-07T14:41:20.297

```
…
if form.is_valid():
    client_mod = form.save(commit=False)
    client_mod.save()
    for groupe in form.cleaned_data.get('groupes'):
        clientgroupe = ClientGroupe(client=client_mod, groupe=groupe)
        clientgroupe.save()
    … 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T03:15:42.767

您可能需要从 Client 模型中删除 ManyToMany 字段，或者小心地将其从表单中排除。不幸的是，ManyToMany 字段的默认小部件无法正确填充 ClientGroupe 模型（即使缺失的字段 dt 已设置为 autonow=True）。这是您需要分解为另一种形式或在您的视图中处理的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T21:56:02.757

当您保存表单时，您将保存 Client 对象。现在，如果您想将客户端分配给组，您应该这样做：

```
clientgroupe = ClientGroupe.objects.create(client=client_instance, groupe=groupe_instance, dt=datetime.datetime.now()) 
```

其中 client_instance 和 groupe_instance 您的客户端和 groupe 对象。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-01-15T18:11:46.580

由于我遇到的未调用 forms_valid 的问题，我提供了一种替代解决方案：

```
class SplingCreate(forms.ModelForm):
class Meta:
    model = SplingModel
    fields = ('Link', 'Genres', 'Image', 'ImageURL',)

def save(self, commit=True):
    from django.forms.models import save_instance

    if self.instance.pk is None:
        fail_message = 'created'
    else:
        fail_message = 'changed'
    fields = set(self._meta.fields) - set(('Genres',))
    instance = save_instance(self, self.instance, fields,
                             fail_message, commit, construct=False)

    genres = self.cleaned_data.get('Genres')
    for genre in genres:
        SplingGenreModel.objects.get_or_create(spling=instance, genre=genre)

    return instance 
```

我已经从 djangos forms/models.py 复制了逻辑，我的字段 Genres 是一个带有中间表的多线程 - 我将它从 save_instance 中排除，然后单独保存。

# perl - 我怎样才能挂钩到 Perl 的打印？

> ID：387702
> 
> 赞同：21
> 
> 时间：2008-12-22T23:06:07.963
> 
> 标签：perl, printing, hook, tie

这是一个场景。你有大量的遗留脚本，都使用一个公共库。所述脚本使用“打印”语句进行诊断输出。不允许对脚本进行任何更改——它们的范围很广，得到了他们的批准，并且早已离开了富有成效的监督和控制谷。

现在一个新的需求出现了：现在必须将日志记录添加到库中。这必须自动且透明地完成，标准库的用户无需更改他们的脚本。公共库方法可以简单地添加日志调用；这是容易的部分。困难在于这些脚本的诊断输出总是使用“打印”语句显示。必须存储此诊断输出，但同样重要的是，必须对其进行处理。

作为这种处理的一个例子，库应该只记录包含单词“警告”、“错误”、“通知”或“注意”的打印行。下面的非常琐碎和人为的示例代码（tm）将记录一些所说的输出：

```
sub CheckPrintOutput
{
    my @output = @_; # args passed to print eventually find their way here.
    foreach my $value (@output) {
         Log->log($value) if $value =~ /warning|error|notice|attention/i;
    }
} 
```

（我想避免诸如“实际应该记录什么”、“打​​印不应该用于诊断”、“perl 很烂”或“这个例子有 xy 和 z 的缺陷”之类的问题......这是为了简洁明了，大大简化了。）

基本问题归结为捕获和处理传递给打印（或任何 perl 内置，沿着这些推理）的数据。是否可以？有什么办法可以干净利落的吗？是否有任何带有钩子的日志记录模块可以让你做到这一点？还是像瘟疫一样应该避免，我应该放弃捕获和处理打印输出？

附加：这必须跨平台运行 - windows 和 *nix 一样。运行脚本的过程必须保持不变，脚本的输出也必须保持不变。

附加附加：在codelogic的回答的评论中提出的一个有趣的建议：

> 您可以继承[http://perldoc.perl.org/IO/Handle.html](http://perldoc.perl.org/IO/Handle.html)并创建自己的文件句柄来完成日志记录工作。– 卡米尔·基塞尔

这可能会做到这一点，但有两个警告：

1）我需要一种方法将此功能导出给使用公共库的任何人。它必须自动适用于 STDOUT，也可能适用于 STDERR。

2) [IO::Handle](http://perldoc.perl.org/IO/Handle.html)文档说你不能子类化它，到目前为止我的尝试都没有结果。使子类化 IO::Handle 工作需要什么特别的东西吗？标准的 'use base 'IO::Handle' 然后覆盖 new/print 方法似乎什么都不做。

最终编辑：看起来 IO::Handle 是一个死胡同，但 Tie::Handle 可能会这样做。感谢所有的建议; 他们都很好。我要试试 Tie::Handle 路线。如果它引起问题，我会回来的！

附录：请注意，在处理了这个之后，我发现 Tie::Handle 可以工作，如果你不做任何棘手的事情。如果您将 IO::Handle 的任何功能与绑定的 STDOUT 或 STDERR 一起使用，那么让它们可靠地工作基本上是一个废话——我找不到让 IO::Handle 的 autoflush 方法在我的绑定上工作的方法处理。如果我在绑定手柄之前启用了自动冲洗，它会起作用。如果这对您有用，则 Tie::Handle 路线可能是可以接受的。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-23T04:57:59.110

您可以覆盖许多内置函数（请参阅[perlsub](http://perldoc.perl.org/perlsub.html#Overriding-Built-in-Functions)）。但是，`print`它是不能以这种方式工作的内置插件之一。覆盖的困难`print`在这个[perlmonk 的线程](http://www.perlmonks.org/?node=!Overriding%20Builtin%20print)中有详细说明。

但是，您*可以*

1.  创建一个包
2.  系一个把手
3.  选择此手柄。

现在，有几个人给出了基本框架，但它的工作原理是这样的：

```
package IO::Override;
use base qw<Tie::Handle>;
use Symbol qw<geniosym>;

sub TIEHANDLE { return bless geniosym, __PACKAGE__ }

sub PRINT { 
    shift;
    # You can do pretty much anything you want here. 
    # And it's printing to what was STDOUT at the start.
    # 
    print $OLD_STDOUT join( '', 'NOTICE: ', @_ );
}

tie *PRINTOUT, 'IO::Override';
our $OLD_STDOUT = select( *PRINTOUT ); 
```

`printf`您可以以相同的方式覆盖：

```
sub PRINTF { 
    shift;
    # You can do pretty much anything you want here. 
    # And it's printing to what was STDOUT at the start.
    # 
    my $format = shift;
    print $OLD_STDOUT join( '', 'NOTICE: ', sprintf( $format, @_ ));
} 
```

请参阅[Tie::Handle](http://search.cpan.org/perldoc?Tie::Handle)了解您可以覆盖 STDOUT 行为的所有内容。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-22T23:29:46.637

您可以使用 Perl 的[select](http://perldoc.perl.org/functions/select.html)来重定向 STDOUT。

```
open my $fh, ">log.txt";
print "test1\n";
my $current_fh = select $fh;
print "test2\n";
select $current_fh;
print "test3\n"; 
```

文件句柄可以是任何东西，甚至是通往另一个处理您的日志消息的进程的管道。

[PerlIO ::Util](http://search.cpan.org/~gfuji/PerlIO-Util-0.60/)模块中的PerlIO [::tee](http://search.cpan.org/~gfuji/PerlIO-Util-0.60/lib/PerlIO/tee.pm)似乎允许您将文件句柄的输出“tee”到多个目的地（例如日志处理器和 STDOUT）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-23T01:57:32.407

很多选择。使用 select() 更改打印默认的文件句柄。或配合 STDOUT。或者重新打开它。或者对它应用一个 IO 层。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-06-08T15:51:04.003

这不是您问题的答案，但您应该能够采用自己使用的逻辑。如果没有，也许其他人会发现它有用。

在它们发生之前捕获格式错误的标题......

```
package PsychicSTDOUT;
use strict;

my $c = 0;
my $malformed_header = 0;
open(TRUE_STDOUT, '>', '/dev/stdout');
tie *STDOUT, __PACKAGE__, (*STDOUT);

sub TIEHANDLE {
    my $class = shift;
    my $handles = [@_];
    bless $handles, $class;
    return $handles;
}

sub PRINT {
    my $class = shift;
    if (!$c++ && @_[0] !~ /^content-type/i) {
        my (undef, $file, $line) = caller;
        print STDERR "Missing content-type in $file at line $line!!\n";
        $malformed_header = 1;
    }
    return 0 if ($malformed_header);
    return print TRUE_STDOUT @_;
}
1; 
```

用法：

```
use PsychicSTDOUT;
print "content-type: text/html\n\n"; #try commenting out this line
print "<html>\n";
print "</html>\n"; 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-22T23:37:51.643

您可以从捕获原始脚本的标准输出并将输出写入合理位置的包装脚本运行脚本。

# javascript - 哪些技术可用于在 JavaScript 中定义一个类，它们的取舍是什么？

> ID：387707
> 
> 赞同：695
> 
> 时间：2008-12-22T23:07:04.047
> 
> 标签：javascript, oop, class

我更喜欢在大型项目中使用 OOP，比如我现在正在做的项目。我需要在 JavaScript 中创建几个类，但如果我没记错的话，至少有几种方法可以做到这一点。语法是什么，为什么要这样做？

我想避免使用第三方库——至少一开始是这样。
在寻找其他答案时，我找到了文章*[Object-Oriented Programming with JavaScript, Part I: Inheritance - Doc JavaScript](http://www.webreference.com/js/column79/)*，它讨论了 JavaScript 中的面向对象编程。有没有更好的继承方式？

* * *

## 回答 #1

> 赞同：748
> 
> 时间：2008-12-22T23:16:04.293

这是不使用任何外部库的方法：

```
// Define a class like this
function Person(name, gender){

   // Add object properties like this
   this.name = name;
   this.gender = gender;
}

// Add methods like this.  All Person objects will be able to invoke this
Person.prototype.speak = function(){
    alert("Howdy, my name is" + this.name);
};

// Instantiate new objects with 'new'
var person = new Person("Bob", "M");

// Invoke methods like this
person.speak(); // alerts "Howdy, my name is Bob" 
```

现在真正的答案比这复杂得多。例如，JavaScript 中没有类之类的东西。JavaScript 使用`prototype`基于 - 的继承方案。

此外，还有许多流行的 JavaScript 库，它们有自己的风格来近似 JavaScript 中的类功能。你至少要检查一下[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)和[jQuery](http://en.wikipedia.org/wiki/JQuery)。

决定哪一个是“最好的”是在 Stack Overflow 上发起一场圣战的好方法。如果你正在着手一个大型的 JavaScript 密集型项目，那么绝对值得学习一个流行的库并按照他们的方式去做。我是原型人，但 Stack Overflow 似乎更倾向于 jQuery。

就只有“一种方法”而言，没有任何对外部库的依赖，我写的方式差不多就是这样。

* * *

## 回答 #2

> 赞同：214
> 
> 时间：2008-12-23T16:44:21.913

在 JavaScript 中定义类的最好方法是不定义类。

严重地。

面向对象有几种不同的风格，其中一些是：

*   基于类的 OO（首先由 Smalltalk 引入）
*   基于原型的 OO（Self 首次引入）
*   基于多方法的 OO（我认为是由 CommonLoops 首次引入的）
*   基于谓词的 OO（不知道）

可能还有其他我不知道的。

JavaScript 实现了基于原型的 OO。在基于原型的 OO 中，通过复制其他对象（而不是从类模板实例化）来创建新对象，并且方法直接存在于对象中而不是类中。继承是通过委托完成的：如果一个对象没有方法或属性，则在它的原型（即它被克隆的对象）上查找它，然后是原型的原型等等。

换句话说：没有类。

JavaScript 实际上对该模型进行了很好的调整：构造函数。您不仅可以通过复制现有对象来创建对象，还可以“凭空”构建它们，可以这么说。如果您使用关键字调用函数，则`new`该函数将成为构造函数，并且`this`关键字不会指向当前对象，而是指向新创建的“空”对象。因此，您可以以任何您喜欢的方式配置对象。通过这种方式，JavaScript 构造函数可以承担传统基于类的 OO 中类的角色之一：充当新对象的模板或蓝图。

现在，JavaScript 是一种非常强大的语言，因此如果您愿意，可以很容易地*在 JavaScript中实现基于类的 OO 系统。*但是，只有在确实需要它时才应该这样做，而不仅仅是因为 Java 就是这样做的。

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2015-06-08T04:46:28.367

# ES2015 课程

在 ES2015 规范中，您可以使用类语法，它只是原型系统的糖。

```
class Person {
  constructor(name) {
    this.name = name;
  }
  toString() {
    return `My name is ${ this.name }.`;
  }
}

class Employee extends Person {
  constructor(name, hours) {
    super(name);
    this.hours = hours;
  }
  toString() {
    return `${ super.toString() } I work ${ this.hours } hours.`;
  }
} 
```

## 好处

主要好处是静态分析工具更容易定位这种语法。其他来自基于类的语言的人也更容易将该语言用作多语种。

## 注意事项

警惕其当前的局限性。要实现私有属性，必须[使用 Symbols 或 WeakMaps](http://davidvujic.blogspot.se/2015/03/what-wait-really-oh-no-a-post-about-es6-classes-and-privacy.html)。在未来的版本中，很可能会扩展类以包含这些缺失的功能。

## 支持

[目前浏览器支持](https://kangax.github.io/compat-table/es6/#class)不是很好（除了 IE 之外几乎所有人都支持），但是你现在可以通过像[Babel](http://babeljs.io/docs/learn-es2015/#classes)这样的编译器来使用这些功能。

## 资源

*   [ECMAScript 6 中的类（最终语义）](http://www.2ality.com/2015/02/es6-classes-final.html)
*   [什么？等待。真的吗？不好了！（一篇关于 ES6 类和隐私的帖子）](http://davidvujic.blogspot.se/2015/03/what-wait-really-oh-no-a-post-about-es6-classes-and-privacy.html)
*   [兼容性表 - 类](https://kangax.github.io/compat-table/es6/#class)
*   [巴别塔 – 课程](http://babeljs.io/docs/learn-es2015/#classes)

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2010-09-16T22:14:51.380

我更喜欢使用 Daniel X. Moore 的**`{SUPER: SYSTEM}`**. 这是一门提供诸如真实实例变量、基于特征的继承、类层次结构和配置选项等好处的学科。下面的例子说明了真实实例变量的使用，我认为这是最大的优势。如果您不需要实例变量并且只对公共或私有变量感到满意，那么可能会有更简单的系统。

```
function Person(I) {
  I = I || {};

  Object.reverseMerge(I, {
    name: "McLovin",
    age: 25,
    homeState: "Hawaii"
  });

  return {
    introduce: function() {
      return "Hi I'm " + I.name + " and I'm " + I.age;
    }
  };
}

var fogel = Person({
  age: "old enough"
});
fogel.introduce(); // "Hi I'm McLovin and I'm old enough" 
```

哇，这本身并不是很有用，但看看添加一个子类：

```
function Ninja(I) {
  I = I || {};

  Object.reverseMerge(I, {
    belt: "black"
  });

  // Ninja is a subclass of person
  return Object.extend(Person(I), {
    greetChallenger: function() {
      return "In all my " + I.age + " years as a ninja, I've never met a challenger as worthy as you...";
    }
  });
}

var resig = Ninja({name: "John Resig"});

resig.introduce(); // "Hi I'm John Resig and I'm 25" 
```

另一个优点是能够拥有基于模块和特征的继承。

```
// The Bindable module
function Bindable() {

  var eventCallbacks = {};

  return {
    bind: function(event, callback) {
      eventCallbacks[event] = eventCallbacks[event] || [];

      eventCallbacks[event].push(callback);
    },

    trigger: function(event) {
      var callbacks = eventCallbacks[event];

      if(callbacks && callbacks.length) {
        var self = this;
        callbacks.forEach(function(callback) {
          callback(self);
        });
      }
    },
  };
} 
```

具有 person 类的示例包括可绑定模块。

```
function Person(I) {
  I = I || {};

  Object.reverseMerge(I, {
    name: "McLovin",
    age: 25,
    homeState: "Hawaii"
  });

  var self = {
    introduce: function() {
      return "Hi I'm " + I.name + " and I'm " + I.age;
    }
  };

  // Including the Bindable module
  Object.extend(self, Bindable());

  return self;
}

var person = Person();
person.bind("eat", function() {
  alert(person.introduce() + " and I'm eating!");
});

person.trigger("eat"); // Blasts the alert! 
```

披露：我是 Daniel X. Moore，这是我的**`{SUPER: SYSTEM}`**. 这是在 JavaScript 中定义类的最佳方式。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2009-07-23T04:46:05.830

```
var Animal = function(options) {
    var name = options.name;
    var animal = {};

    animal.getName = function() {
        return name;
    };

    var somePrivateMethod = function() {

    };

    return animal;
};

// usage
var cat = Animal({name: 'tiger'}); 
```

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2013-03-04T06:49:01.043

以下是我目前使用的在 javascript 中创建对象的方法

示例 1：

```
obj = new Object();
obj.name = 'test';
obj.sayHello = function() {
    console.log('Hello '+ this.name);
} 
```

示例 2：

```
obj = {};
obj.name = 'test';
obj.sayHello = function() {
    console.log('Hello '+ this.name);
}
obj.sayHello(); 
```

示例 3：

```
var obj = function(nameParam) {
    this.name = nameParam;
}
obj.prototype.sayHello = function() {
    console.log('Hello '+ this.name);
} 
```

示例 4：[Object.create() 的实际好处。请参考[此链接]](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create)

```
var Obj = {
    init: function(nameParam) {
        this.name = nameParam;
    },
    sayHello: function() {
        console.log('Hello '+ this.name);
    }
};
var usrObj = Object.create(Obj);  // <== one level of inheritance

usrObj.init('Bob');
usrObj.sayHello(); 
```

示例 5（自定义 Crockford 的 Object.create）：

```
Object.build = function(o) {
   var initArgs = Array.prototype.slice.call(arguments,1)
   function F() {
      if((typeof o.init === 'function') && initArgs.length) {
         o.init.apply(this,initArgs)
      }
   }
   F.prototype = o
   return new F()
}
MY_GLOBAL = {i: 1, nextId: function(){return this.i++}}  // For example

var userB = {
    init: function(nameParam) {
        this.id = MY_GLOBAL.nextId();
        this.name = nameParam;
    },
    sayHello: function() {
        console.log('Hello '+ this.name);
    }
};
var bob = Object.build(userB, 'Bob');  // Different from your code
bob.sayHello(); 
```

* * *

使用 ES6/ES2015 更新答案

一个类是这样定义的：

```
class Person {
    constructor(strName, numAge) {
        this.name = strName;
        this.age = numAge;
    }

    toString() {
        return '((Class::Person) named ' + this.name + ' & of age ' + this.age + ')';
    }
}

let objPerson = new Person("Bob",33);
console.log(objPerson.toString()); 
```

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2008-12-23T02:06:08.147

我认为您应该阅读 Douglas Crockford 的[Prototypal Inheritance in JavaScript](http://javascript.crockford.com/prototypal.html)和[Classical Inheritance in JavaScript](http://javascript.crockford.com/inheritance.html)。

他页面中的示例：

```
Function.prototype.method = function (name, func) {
    this.prototype[name] = func;
    return this;
}; 
```

影响？它将允许您以更优雅的方式添加方法：

```
function Parenizor(value) {
    this.setValue(value);
}

Parenizor.method('setValue', function (value) {
    this.value = value;
    return this;
}); 
```

我还推荐他的视频： [Advanced JavaScript](http://yuiblog.com/blog/2006/11/27/video-crockford-advjs/)。

您可以在他的页面上找到更多视频：http: [//javascript.crockford.com/](http://javascript.crockford.com/) 在 John Reisig 的书中，您可以从 Douglas Crockfor 的网站上找到许多示例。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-12-28T22:11:29.487

因为我不会承认 YUI/Crockford 工厂计划，并且因为我喜欢让事物保持自包含和可扩展性，所以这是我的变体：

```
function Person(params)
{
  this.name = params.name || defaultnamevalue;
  this.role = params.role || defaultrolevalue;

  if(typeof(this.speak)=='undefined') //guarantees one time prototyping
  {
    Person.prototype.speak = function() {/* do whatever */};
  }
}

var Robert = new Person({name:'Bob'}); 
```

理想情况下，typeof 测试是在类似于第一个原型方法的地方

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2008-12-22T23:22:24.403

如果您想要简单，您可以完全避免使用“new”关键字，而只使用工厂方法。有时我更喜欢这个，因为我喜欢使用 JSON 来创建对象。

```
function getSomeObj(var1, var2){
  var obj = {
     instancevar1: var1,
     instancevar2: var2,
     someMethod: function(param)
     {  
          //stuff; 
     }
  };
  return obj;
}

var myobj = getSomeObj("var1", "var2");
myobj.someMethod("bla"); 
```

不过，我不确定大型对象的性能影响是什么。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2016-03-15T09:47:43.453

```
var Student = (function () {
    function Student(firstname, lastname) {
        this.firstname = firstname;
        this.lastname = lastname;
        this.fullname = firstname + " " + lastname;
    }

    Student.prototype.sayMyName = function () {
        return this.fullname;
    };

    return Student;
}());

var user = new Student("Jane", "User");
var user_fullname = user.sayMyName(); 
```

这就是 TypeScript 将带有构造函数的类编译为 JavaScript 的方式。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2008-12-22T23:33:03.977

简单的方法是：

```
function Foo(a) {
  var that=this;

  function privateMethod() { .. }

  // public methods
  that.add = function(b) {
    return a + b;
  };
  that.avg = function(b) {
    return that.add(b) / 2; // calling another public method
  };
}

var x = new Foo(10);
alert(x.add(2)); // 12
alert(x.avg(20)); // 15 
```

原因`that`是，`this`如果您将方法作为事件处理程序提供，则可以将其绑定到其他东西，因此您可以在实例化期间保存该值并稍后使用它。

编辑：这绝对不是最好的方法，只是一种简单的方法。我也在等待好的答案！

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2013-04-07T00:43:50.257

您可能希望使用折叠模式创建一个类型：

```
 // Here is the constructor section.
    var myType = function () {
        var N = {}, // Enclosed (private) members are here.
            X = this; // Exposed (public) members are here.

        (function ENCLOSED_FIELDS() {
            N.toggle = false;
            N.text = '';
        }());

        (function EXPOSED_FIELDS() {
            X.count = 0;
            X.numbers = [1, 2, 3];
        }());

        // The properties below have access to the enclosed fields.
        // Careful with functions exposed within the closure of the
        // constructor, each new instance will have it's own copy.
        (function EXPOSED_PROPERTIES_WITHIN_CONSTRUCTOR() {
            Object.defineProperty(X, 'toggle', {
                get: function () {
                    var before = N.toggle;
                    N.toggle = !N.toggle;
                    return before;
                }
            });

            Object.defineProperty(X, 'text', {
                get: function () {
                    return N.text;
                },
                set: function (value) {
                    N.text = value;
                }
            });
        }());
    };

    // Here is the prototype section.
    (function PROTOTYPE() {
        var P = myType.prototype;

        (function EXPOSED_PROPERTIES_WITHIN_PROTOTYPE() {
            Object.defineProperty(P, 'numberLength', {
                get: function () {
                    return this.numbers.length;
                }
            });
        }());

        (function EXPOSED_METHODS() {
            P.incrementNumbersByCount = function () {
                var i;
                for (i = 0; i < this.numbers.length; i++) {
                    this.numbers[i] += this.count;
                }
            };
            P.tweak = function () {
                if (this.toggle) {
                    this.count++;
                }
                this.text = 'tweaked';
            };
        }());
    }()); 
```

该代码将为您提供一个名为**myType**的类型。它将具有称为**toggle**和**text**的内部私有字段。它还将有这些公开的成员：字段**count**和**numbers**；属性**toggle**、**text**和**numberLength**；方法**incrementNumbersByCount**和**tune**。

折叠模式在此处详细介绍： [Javascript 折叠模式](http://intrepidis.blogspot.com/2013/04/javascript-folding-pattern.html)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-08-15T23:42:49.950

@liammclennan[答案](https://stackoverflow.com/a/1169656/298782)的代码高尔夫。

```
var Animal = function (args) {
  return {
    name: args.name,

    getName: function () {
      return this.name; // member access
    },

    callGetName: function () {
      return this.getName(); // method call
    }
  };
};

var cat = Animal({ name: 'tiger' });
console.log(cat.callGetName());
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-05-30T02:22:36.113

[MooTools](http://mootools.net)（我的面向对象工具）以[类](http://mootools.net/docs/core/Class/Class)的思想为中心。您甚至可以通过继承来扩展和实现。

掌握后，它可以生成可笑的可重用、强大的 javascript。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-02-02T16:36:46.727

具有继承性的基于对象的类

```
var baseObject = 
{
     // Replication / Constructor function
     new : function(){
         return Object.create(this);   
     },

    aProperty : null,
    aMethod : function(param){
      alert("Heres your " + param + "!");
    },
}

newObject = baseObject.new();
newObject.aProperty = "Hello";

anotherObject = Object.create(baseObject); 
anotherObject.aProperty = "There";

console.log(newObject.aProperty) // "Hello"
console.log(anotherObject.aProperty) // "There"
console.log(baseObject.aProperty) // null 
```

简单，甜美，并完成。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-08-23T08:39:38.343

基于三联画的例子，这可能更简单：

```
 // Define a class and instantiate it
    var ThePerson = new function Person(name, gender) {
        // Add class data members
        this.name = name;
        this.gender = gender;
        // Add class methods
        this.hello = function () { alert('Hello, this is ' + this.name); }
    }("Bob", "M"); // this instantiates the 'new' object

    // Use the object
    ThePerson.hello(); // alerts "Hello, this is Bob" 
```

这只会创建一个对象实例，但如果您想在一个类中封装一堆变量和方法的名称，它仍然很有用。通常，构造函数不会有“Bob，M”参数，例如，如果方法将调用具有自己数据的系统，例如数据库或网络。

我对 JS 还是太陌生了，不明白为什么这不使用这个`prototype`东西。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-07-18T11:22:20.400

一个基地

```
function Base(kind) {
    this.kind = kind;
} 
```

一类

```
// Shared var
var _greeting;

(function _init() {
    Class.prototype = new Base();
    Class.prototype.constructor = Class;
    Class.prototype.log = function() { _log.apply(this, arguments); }
    _greeting = "Good afternoon!";
})();

function Class(name, kind) {
    Base.call(this, kind);
    this.name = name;
}

// Shared function
function _log() {
    console.log(_greeting + " Me name is " + this.name + " and I'm a " + this.kind);
} 
```

行动

```
var c = new Class("Joe", "Object");
c.log(); // "Good afternoon! Me name is Joe and I'm a Object" 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-22T23:32:28.627

JavaScript 是[面向对象的](http://en.wikipedia.org/wiki/Object-orientation)，但它与 Java、C# 或 C++等其他[OOP](http://en.wikipedia.org/wiki/Object-oriented_programming)语言完全不同。不要试图那样理解它。扔掉那些旧知识，重新开始。JavaScript 需要不同的想法。

我建议获得一本很好的手册或有关该主题的东西。~~我自己发现[ExtJS 教程](http://extjs.com/learn/Tutorial:What_is_that_Scope_all_about)对我来说是最好的，尽管我在阅读它之前或之后都没有使用过这个框架。但它确实很好地解释了 JavaScript 世界是什么。~~抱歉，该内容似乎已被删除。这是一个指向[archive.org 副本](http://web.archive.org/web/20120213180147/http://www.sencha.com/learn/legacy/Tutorial:What_is_that_Scope_all_about)的链接。今天上班。:P

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-09-13T03:03:51.853

```
//new way using this and new
function Persons(name) {
  this.name = name;
  this.greeting = function() {
    alert('Hi! I\'m ' + this.name + '.');
  };
}

var gee=new Persons("gee");
gee.greeting();

var gray=new Persons("gray");
gray.greeting();

//old way
function createPerson(name){
 var obj={};
 obj.name=name;
 obj.greeting = function(){
 console.log("hello I am"+obj.name);
 }; 
  return obj;
}

var gita=createPerson('Gita');
gita.greeting();
```

# .net - 您会将新的开源 .NET 项目放在哪里？

> ID：387710
> 
> 赞同：4
> 
> 时间：2008-12-22T23:10:02.447
> 
> 标签：.net, open-source

我目前正在开发一个可能会开源的 .NET 项目。

不过有很多地方可以放它，有人有无摩擦的经验吗？代码复合体？谷歌代码？

注意：对于项目源代码控制，我更喜欢 Subversion。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T06:58:21.300

**[谷歌代码](http://code.google.com/)是我的最爱。**与 Gmail 的其他产品一样，它具有类似强大的简单性和可靠性。

**我不会**向任何人推荐 SourceForge。原因：

*   版本控制很慢
*   如果您将集成服务器连接到他们的版本控制，他们可能会禁止您的 IP 只是为了经常 ping 版本控制
*   UI 很糟糕，很难导航。您不想因此而失去用户。

CodePlex 比 SourceForge 更好，但它仍然有我想要的更多开发摩擦。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T23:18:22.713

我喜欢 Codeplex，它也支持 Subversion。

扩展：不是真正的 .NET，但我只是发现网站的界面非常易于导航，并且问题跟踪器部分工作得非常好（易于添加/易于更新）。我也喜欢这样一个事实，即您可以在项目的首页上显示图片和语法突出显示的代码片段。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T23:15:32.420

SourceForge，我想。那不是开源项目的领导者吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T23:15:35.353

我会推荐[Assembla.com](http://www.assembla.com)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T23:23:48.113

我使用 CodePlex 是因为 Visual Studio 中的 Team Foundation 集成非常好，您可以将它与 CodePlex 一起使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T23:27:41.977

如果您喜欢 git 作为版本控制系统，您可以查看 gitorious.org 进行托管。我在 gitorious 有一个项目，我的代码在 gitorious，但在 google code 有问题跟踪等

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T00:21:19.777

我一直在使用[Assembla](http://www.assembla.com)（直到他们切断了免费的私人项目）、Google Code（仅限开放项目），最近我发现[Origo](http://www.origo.ethz.ch/)作为 Assembla 的替代品。

# language-agnostic - 非常大的列表使用什么语言？

> ID：387713
> 
> 赞同：2
> 
> 时间：2008-12-22T23:10:37.127
> 
> 标签：language-agnostic, containers, capacity

对于 java.util 中的数组和容器，Java（可能还有底层的 C-ish 代码）的最大容量为 Integer.MAX_VALUE（约 20 亿）。是否有其他语言具有更大容量的容器？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-22T23:25:57.003

你不需要语言，你需要**数据库**。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T23:22:22.063

如果您开始达到与可以存储在列表/数组/集合中的元素数量相关的数字的 32 位限制，那么我会认真地开始寻找一种新的方法来实现您的算法。

您将有很多“我们需要这种专门的硬件来执行我们的程序”类型的要求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T23:28:57.900

C++ 中的 STL 容器使用 size_t 索引，它在 64 位机器上是 64 位的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T23:13:06.733

`long`您可以用两种支持索引的语言编写自己的容器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T23:14:07.883

你有一台机器有足够的内存来使用更多吗？O_o 如果你这样做，我会说你需要你自己的集合，因为内置的性能可能会扩展......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T23:20:40.647

我通常使用数据库来存储大量数据。解决了很多缩放问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T23:29:20.770

对象数据库可能更适合您的目的。

例如，[db4o](http://www.db4o.com/)。

或者，对于固定大小的对象数组，可能值得尝试使用内存映射文件，但为此您需要 OS API 的语言接口。

编辑：或仅在 ORM 上使用将您的集合映射到标准 SQL 数据库。这些存在于大多数语言中。例如，ruby 有 activerecord，Java 有 hibernate。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T23:32:49.237

没有人愿意同时处理内存中如此大量的数据。我不知道您要做什么，但是如果您需要最大化居民数据量，您必须考虑：

*   首先使用动态内存分配。
*   如果可以选择，您可以尝试（在您的操作系统中）最大化用户模式虚拟内存寻址空间。例如，32 位 Windows 可以为用户模式/内核或 3GB/1GB 使用典型的 2GB/2GB 寻址空间。
*   始终监视您的提交内存/操作系统提交限制，这样您就不会强迫操作系统崩溃，从而减慢整个系统的速度。
*   您可以锁定最少量的内存以供您的应用程序独占使用。这因操作系统而异，但例如，您可以让用户为您的应用程序修复 256MB、512MB、1GB 内存空间。
*   如果您需要超越可用的用户模式地址空间，您可以使用 64 位系统，或带有 PAE 等扩展的 32 位系统。

好吧，有很多东西要研究，但只有我的 2c。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-22T23:14:11.707

如果您编写自己的容器，则没有限制。

# wpf - WPF：如何获取列表视图行的高度

> ID：387714
> 
> 赞同：2
> 
> 时间：2008-12-22T23:10:38.687
> 
> 标签：wpf, listview

我需要知道列表视图控件中的一行有多高（以像素为单位）。该行只包含文本，没有什么花哨的

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T23:20:52.567

我想你会在这里找到你的答案：http: [//social.msdn.microsoft.com/forums/en-US/wpf/thread/446cd40b-ec43-4e9f-a2cc-ee6932fd09a9/](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/446cd40b-ec43-4e9f-a2cc-ee6932fd09a9/)

# javascript - 如何使用内联 onclick 属性停止事件传播？

> ID：387736
> 
> 赞同：348
> 
> 时间：2008-12-22T23:17:16.223
> 
> 标签：javascript, html, events, dom

考虑以下：

```
<div onclick="alert('you clicked the header')" class="header">
  <span onclick="alert('you clicked inside the header');">something inside the header</span>
</div> 
```

我怎样才能做到这一点，当用户点击跨度时，它不会触发`div`的点击事件？

* * *

## 回答 #1

> 赞同：329
> 
> 时间：2008-12-22T23:22:52.797

使用[event.stopPropagation()](https://developer.mozilla.org/en/DOM/event.stopPropagation)。

```
<span onclick="event.stopPropagation(); alert('you clicked inside the header');">something inside the header</span> 
```

对于 IE：`window.event.cancelBubble = true`

```
<span onclick="window.event.cancelBubble = true; alert('you clicked inside the header');">something inside the header</span> 
```

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2008-12-23T00:20:54.973

有两种方法可以从函数内部获取事件对象：

1.  第一个参数，在符合 W3C 的浏览器（Chrome、Firefox、Safari、IE9+）中
2.  Internet Explorer 中的 window.event 对象 (<=8)

如果您需要支持不遵循 W3C 建议的旧版浏览器，通常在函数内部您会使用如下内容：

```
function(e) {
  var event = e || window.event;
  [...];
} 
```

它将检查第一个，然后是另一个并存储在事件变量中找到的任何一个。但是，在内联事件处理程序中没有`e`要使用的对象。在这种情况下，您必须利用`arguments`始终可用的集合并引用传递给函数的完整参数集：

```
onclick="var event = arguments[0] || window.event; [...]" 
```

但是，一般来说，如果您需要像停止传播这样复杂的事情，您应该避免使用内联事件处理程序。从中期和长期来看，单独编写事件处理程序并将它们附加到元素是一个更好的主意，无论是可读性还是可维护性。

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2008-12-23T00:06:03.473

请记住，FireFox 不支持 window.event，因此它必须类似于以下内容：

```
e.cancelBubble = true 
```

或者，您可以使用 FireFox 的 W3C 标准：

```
e.stopPropagation(); 
```

如果你想变得花哨，你可以这样做：

```
function myEventHandler(e)
{
    if (!e)
      e = window.event;

    //IE9 & Other Browsers
    if (e.stopPropagation) {
      e.stopPropagation();
    }
    //IE8 and Lower
    else {
      e.cancelBubble = true;
    }
} 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2011-02-24T17:28:13.573

使用此功能，它将测试是否存在正确的方法。

```
function disabledEventPropagation(event)
{
   if (event.stopPropagation){
       event.stopPropagation();
   }
   else if(window.event){
      window.event.cancelBubble=true;
   }
} 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2012-05-25T09:58:10.290

我有同样的问题 - IE 中的 js 错误框 - 据我所知，这在所有浏览器中都可以正常工作（event.cancelBubble=true 在 IE 中完成了这项工作）

```
onClick="if(event.stopPropagation){event.stopPropagation();}event.cancelBubble=true;" 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2014-08-13T15:01:01.017

这对我有用

```
<script>
function cancelBubble(e) {
 var evt = e ? e:window.event;
 if (evt.stopPropagation)    evt.stopPropagation();
 if (evt.cancelBubble!=null) evt.cancelBubble = true;
}
</script>

<div onclick="alert('Click!')">
  <div onclick="cancelBubble(event)">Something inside the other div</div>
</div> 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-06-30T22:00:40.440

对于 ASP.NET 网页（不是 MVC），您可以使用`Sys.UI.DomEvent`对象作为本机事件的包装器。

```
<div onclick="event.stopPropagation();" ... 
```

或者，将事件作为参数传递给内部函数：

```
<div onclick="someFunction(event);" ... 
```

在某些功能中：

```
function someFunction(event){
    event.stopPropagation(); // here Sys.UI.DomEvent.stopPropagation() method is used
    // other onclick logic
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-22T23:28:31.490

根据[this page](http://www.quirksmode.org/js/events_order.html)，在IE中你需要：

event.cancelBubble = true

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2019-10-23T04:50:37.527

由于 Karma，我无法发表评论，因此我将其写为完整答案：根据 Gareth (var e = arguments[0] || window.event; [...]) 的答案，我在 onclick 上使用了这个 oneliner inline快速破解：

```
<div onclick="(arguments[0] || window.event).stopPropagation();">..</div> 
```

我知道已经晚了，但我想让你知道这在一行中有效。大括号返回一个事件，在这两种情况下都附加了 stopPropagation 函数，所以我尝试将它们封装在大括号中，就像 if 和...一样。:)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-10-31T18:38:51.003

为什么不只检查单击了哪个元素？如果单击某物，`window.event.target`则将其分配给被单击的元素，**并且**单击的元素也可以作为参数传递。

**如果目标和元素不相等，则它是向上传播的事件。**

```
function myfunc(el){
  if (window.event.target === el){
      // perform action
  }
}
<div onclick="myfunc(this)" /> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-12-06T21:20:45.183

使用单独的处理程序，例如：

```
function myOnClickHandler(th){
//say let t=$(th)
} 
```

并在 html 中这样做：

```
<...onclick="myOnClickHandler(this); event.stopPropagation();"...> 
```

甚至 ：

```
function myOnClickHandler(e){
  e.stopPropagation();
} 
```

为了：

```
<...onclick="myOnClickHandler(event)"...> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-06-06T15:36:56.140

这也有效 - 在链接 HTML 中使用 onclick 并返回如下：

```
<a href="mypage.html" onclick="return confirmClick();">Delete</a> 
```

然后 comfirmClick() 函数应该是这样的：

```
function confirmClick() {
    if(confirm("Do you really want to delete this task?")) {
        return true;
    } else {
        return false;
    }
}; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-01-03T22:04:35.107

```
<div onclick="alert('you clicked the header')" class="header">
  <span onclick="alert('you clicked inside the header'); event.stopPropagation()">
    something inside the header
  </span>
</div> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-02-23T02:37:37.517

最好的解决方案是通过 javascript 函数处理事件，但是为了使用直接使用 html 元素的简单快速的解决方案，一旦“事件”和“window.event”被弃用并且不被普遍支持（[https://developer.mozilla.org/en-US/docs/Web/API/Window/event](https://developer.mozilla.org/en-US/docs/Web/API/Window/event)），我建议使用以下“硬代码”：

```
<div onclick="alert('blablabla'); (arguments[0] ? arguments[0].stopPropagation() : false);">...</div> 
```

# java - Windows 上的 PNG TrayIcon 透明度

> ID：387768
> 
> 赞同：6
> 
> 时间：2008-12-22T23:29:54.030
> 
> 标签：java, png, transparency, trayicon

我正在尝试使用透明 PNG 作为我的 Java 应用程序的图标。JFrame 和任务栏上的图像效果很好。但是，当我将图像与 TrayIcon 一起使用时，PNG 的边缘周围会出现黑色哑光背景。

有没有其他人遇到过这个问题？我真的很想使用 PNG 而不是 GIF 或 JPEG。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T13:40:18.480

使用[Java6](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/systemtray/)时，应使用 PNG 图片`TrayIcon`，但如此[SO 问题](https://stackoverflow.com/questions/331407)中所述，请检查：

*   选择用来表示透明像素的背景颜色
*   透明度[选项](http://en.wikipedia.org/wiki/Portable_Network_Graphics)
*   图标的分辨率
*   像 SVG 这样的替代格式（前提是你使用像[Batik](http://xmlgraphics.apache.org/batik/)这样的外部库，以及[转换机制到`java.awt.Image`](http://markmail.org/message/pfcceqjgy2mxvy6m)）

# c# - LINQ 是否使用 DataRelations 来优化连接？

> ID：387772
> 
> 赞同：6
> 
> 时间：2008-12-22T23:32:15.150
> 
> 标签：c#, linq, join, dataset, datarelation

我在任何地方都找不到答案，在我开始使用 Reflector 浏览生成的代码之前，我认为值得一问：

假设我对 DataSet 中的 DataTables 运行以下 LINQ 查询：

```
var list = 
   from pr in parentTable.AsEnumerable()
   join cr in childTable.AsEnumerable() on cr.Field<int>("ParentID") equals pr.Field<int>("ID")
   where pr.Field<string>("Value") == "foo"
   select cr; 
```

如果父表和子表之间存在使用所示关键字段的 DataRelation，LINQ 会使用它吗？也就是说，它会在父表中找到值为“foo”的行，然后调用`GetChildRows`投影子行吗？

或者这是我必须明确指定的东西？（如果是这样，我该怎么做？）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T20:09:27.180

在 Reflector 中挖掘似乎并没有表明 LINQ 使用 DataRelations，但该代码非常难以阅读。所以我写了一个小性能测试，除非我错过了一些关于测试的愚蠢的东西，否则结果是非常确定的：不，LINQ 不使用 DataRelations 和 GetChildRows() 来投影连接的行。如果要遍历子行，则必须制定 LINQ 查询以显式调用 GetChildRows()。并且这两种方法都没有编写代码迭代 GetChildRows() 返回的数组的性能。

有点不幸，因为大型数据集的性能差异非常显着，以至于用显式实现的代码替换 LINQ 通常是值得的，而 LINQ 通常不是这样。

我的测试代码如下。使用连接的 LINQ 迭代的时间保持不变（在我的机器上大约 580-590 毫秒），无论 DataRelation 是在它之前还是之后创建的。使用 GetChildRows() 的 LINQ 迭代大约需要 280 毫秒，

直接在 GetChildRows() 上的迭代需要不到一毫秒。这对我来说非常令人惊讶 - 足以让我在第一次运行测试时假设我的代码中有一个错误。（这就是为什么我每次都写出计数 - 以确保编译器没有优化循环。）

```
class Program
{
    static void Main(string[] args)
    {
        Stopwatch sw = new Stopwatch();
        DataSet ds = new DataSet();
        DataTable t1 = new DataTable();
        t1.Columns.Add(new DataColumn
                           {
                               ColumnName = "ID",
                               DataType = typeof (int),
                               AutoIncrement = true
                           });
        t1.PrimaryKey = new [] { t1.Columns["ID"]};
        ds.Tables.Add(t1);

        DataTable t2 = new DataTable();
        t2.Columns.Add(new DataColumn
        {
            ColumnName = "ID",
            DataType = typeof(int),
            AutoIncrement = true
        });
        t2.Columns.Add("ParentID", typeof(int));
        t2.PrimaryKey = new[] { t2.Columns["ID"] };
        ds.Tables.Add(t2);

        sw.Reset();
        sw.Start();
        PopulateTables(t1, t2);
        sw.Stop();
        Console.WriteLine("Populating tables took {0} ms.", sw.ElapsedMilliseconds);
        Console.WriteLine();

        var list1 = from r1 in t1.AsEnumerable()
                   join r2 in t2.AsEnumerable()
                       on r1.Field<int>("ID") equals r2.Field<int>("ParentID")
                   where r1.Field<int>("ID") == 1
                   select r2;

        sw.Reset();
        sw.Start();
        int count = 0;
        foreach (DataRow r in list1)
        {
            count += r.Field<int>("ID");
        }
        sw.Stop();
        Console.WriteLine("count = {0}.", count);
        Console.WriteLine("Completed LINQ iteration in {0} ms.", sw.ElapsedMilliseconds);
        Console.WriteLine();

        sw.Reset();
        sw.Start();
        ds.Relations.Add(new DataRelation("FK_t2_t1", t1.Columns["ID"], t2.Columns["ParentID"]));
        sw.Stop();
        Console.WriteLine("Creating DataRelation took {0} ms.", sw.ElapsedMilliseconds);

        sw.Reset();
        sw.Start();
        var list2 =
            from r1 in t1.AsEnumerable()
            from r2 in r1.GetChildRows("FK_t2_t1")
            where r1.Field<int>("ID") == 1
            select r2;

        count = 0;
        foreach (DataRow r in list2)
        {
            count += r.Field<int>("ID");
        }
        sw.Stop();
        Console.WriteLine("count = {0}.", count);
        Console.WriteLine("Completed LINQ iteration using nested query in {0} ms.", sw.ElapsedMilliseconds);
        Console.WriteLine();

        sw.Reset();
        sw.Start();
        DataRow parentRow = t1.Select("ID = 1")[0];
        count = 0;
        foreach (DataRow r in parentRow.GetChildRows("FK_t2_t1"))
        {
            count += r.Field<int>("ID");
        }
        sw.Stop();
        Console.WriteLine("count = {0}.", count);
        Console.WriteLine("Completed explicit iteration of child rows in {0} ms.", sw.ElapsedMilliseconds);
        Console.WriteLine();

        Console.ReadLine();
    }

    private static void PopulateTables(DataTable t1, DataTable t2)
    {
        for (int count1 = 0; count1 < 1000; count1++)
        {
            DataRow r1 = t1.NewRow();
            t1.Rows.Add(r1);
            for (int count2 = 0; count2 < 1000; count2++)
            {
                DataRow r2 = t2.NewRow();
                r2["ParentID"] = r1["ID"];
                t2.Rows.Add(r2);
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T10:53:01.827

我不这么认为。在这种情况下，LINQ to Objects 可能只会将两侧视为常规可枚举对象，并手动进行连接（不查看`DataRelation`）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T02:33:43.193

这是一个解释：http: [//msdn.microsoft.com/en-us/library/bb386969.aspx](http://msdn.microsoft.com/en-us/library/bb386969.aspx)

但是在上面的示例中，您使用“JOIN”语法告诉 linq 父子关系。如果可能的话，我建议你制作一个强类型数据集，所有的关系和加入都会为你处理。

# scheme - 在 Scheme 中使用 AND 和 apply 函数

> ID：387775
> 
> 赞同：19
> 
> 时间：2008-12-22T23:32:36.083
> 
> 标签：scheme

为什么以下不起作用？

```
(apply and (list #t #t #f)) 
```

虽然以下工作正常。

```
(apply + (list 1 3 2)) 
```

R5RS 和 R6RS 似乎都是这种情况？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-22T23:49:02.713

`and`不是一个正常的函数，因为它只会根据需要评估尽可能少的参数，以了解结果是真还是假。例如，如果第一个参数为假，那么无论其他参数是什么，结果都必须为假，因此它不会评估其他参数。如果`and`是一个普通函数，它的所有参数都将首先被评估，所以`and`被设为一个特殊的关键字，这就是它不能作为变量传递的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-07-17T23:46:15.530

```
(define and-l (lambda x 
    (if (null? x)
        #t
        (if (car x) (apply and-l (cdr x)) #f)))) 
```

请注意这是 lambda **variadic**！应用示例`(and-l #t #t #f)`

或者您可以通过应用程序（如要求）使用它，例如`(apply and-l (list #t #t #f))`

两个选项都可以...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-23T00:38:18.743

`and`实际上是一个宏，其定义[在 R5RS 第 4 章](http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-7.html#%_idx_118)中有概述。该页面上的符号“库语法”实际上意味着它是作为宏实现的。

第[7.3 节，派生表达式类型](http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-10.html#%_sec_7.3)给出了`and`宏的可能定义：

```
(define-syntax and
  (syntax-rules ()
    ((and) #t)
    ((and test) test)
    ((and test1 test2 ...)
     (if test1 (and test2 ...) #f)))) 
```

鉴于此定义，不可能将其`and`用作`apply`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-01-24T13:23:54.213

在 Scheme 方言[MIT/GNU Scheme](http://www.gnu.org/software/mit-scheme/)中，您可以使用[函数`boolean/and`](http://www.gnu.org/software/mit-scheme/documentation/mit-scheme-ref/Booleans.html#index-boolean_002fand-1445)而不是[特殊形式`and`](http://www.gnu.org/software/mit-scheme/documentation/mit-scheme-ref/Conditionals.html#index-and-319)。

```
(apply boolean/and (list #t #t #f)) ;Value: #f 
```

[另外，作为记录，我在Guile Scheme](http://www.gnu.org/software/guile/)的[过程索引](http://www.gnu.org/software/guile/manual/html_node/Procedure-Index.html#Procedure-Index)中找不到任何等效函数。

（其他答案已经解释了为什么特殊形式`and`不起作用，并展示了如果您的方言中还没有这样的函数，如何编写自己的替换函数。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T14:08:31.913

如果你真的想要一个函数指针指向一个函数，并且你不介意与“真实”不同的行为，那么这将起作用：

```
(define and-l (lambda (a b) (and a b))) 
```

您可以像这样申请：

```
(apply and-l (list #t #f)) 
```

两个警告是：

1.  所有的 args 都被评估，违反了 and 的定义，应该有快捷行为。
2.  只允许两个参数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-09T16:16:50.887

我偶然发现了同样的问题，并在 Racket 中找到了一个优雅的解决方案。由于问题在于“and”是一个宏而不是一个函数，以防止对其所有参数进行评估，我读了一些关于“lazy racket”的文章，发现“and”是*该*语言中的一个函数。所以我想出了以下解决方案，我只是将惰性导入为“惰性和”：

```
#lang racket
(require (only-in lazy [and lazy-and]))

(define (mm)
  (map number? '(1 2 3)))

(printf "~a -> ~a\n" (mm) (apply lazy-and (mm))) 
```

产生

```
(#t #t #t) -> #t 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-07T03:57:11.197

试试这个：

```
(define list-and (lambda (args) (and (car args) (list-and (cdr args))))) 
```

那么你可以使用apply to list-and！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-06-14T19:54:38.077

你也可以使用

`(define (andApply lBoo) (if (not (car lBoo)) #f (if (= 1(length lBoo)) (car lBoo) (andApply (cdr lBoo)))))`

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-12-26T07:22:52.053

我在使用 PLT-Scheme 372 时也遇到了这个问题，我已经深入研究了 and-syntax 的行为，并找出了下面的代码，它的工作原理就好像人们直觉地期望`(apply and lst)`返回一样，但我没有做过详尽的测试.

```
(define (list-and lst) 
  (cond 
    ((null? lst) '())
    ((not (pair? lst)) (and lst)) 
    ((eq? (length lst) 1) (car lst))
    (else
     (and (car lst)
          (list-and (cdr lst))))
    )
  )

Welcome to DrScheme, version 372 [3m].
Language: Textual (MzScheme, includes R5RS).

> (eq? (and '()) (list-and '()))
#t
> (eq? (and '#f) (list-and (list '#f)))
#t
> (eq? (and 'a) (list-and (list 'a)))
#t
> (eq? (and 'a 'b) (list-and (list 'a 'b)))
#t
> (eq? (and 'a 'b '()) (list-and (list 'a 'b '())))
#t
> (eq? (and 'a 'b '#t) (list-and (list 'a 'b '#t)))
#t
> (eq? (and 'a 'b '#f) (list-and (list 'a 'b '#f)))
#t 
```

我还想出了另一个**令人费解的**解决方法。我称它为**心灵陷阱**，因为一开始我不知道如何将它变成一个函数......这里是（只是我直观想法的演示）：

```
Welcome to DrScheme, version 372 [3m].
Language: Textual (MzScheme, includes R5RS).
> (eval (cons 'and (list ''#f ''#f ''#t)))
#f
> (eval (cons 'and (list ''a ''b ''c)))
c 
```

但是后来我问了一个问题，在这里得到了答案：[是否可以动态生成 (quote (quote var)) 或 ''var？](https://stackoverflow.com/questions/20797505/is-it-possible-to-generate-quote-quote-var-or-var-dynamically/20797614#20797614). 有了这个答案，人们可​​以很容易地将上述想法变成一个函数。

```
(define (my-quote lst)
  (map (lambda (x) `'',x) lst))

(cons 'and (my-quote (list 'a 'b 'c)))
=> '(and ''a ''b ''c) 
```

# payment-gateway - 可变金额定期计费

> ID：387780
> 
> 赞同：13
> 
> 时间：2008-12-22T23:34:57.623
> 
> 标签：payment-gateway, recurring-billing

嗨，我正在寻找一个支付网关，可以进行每月更改的定期计费。Fogbugz 这样做，他们根据当月有多少活跃用户收费。我发现的所有 API 只允许您设置固定金额，并且很难/不可能每月更改订阅金额。

有没有人遇到过这样做的任何服务？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-08-10T04:45:00.077

如果您每月手动触发重新[计费，BrainTree可能是一个很好的解决方案。](http://www.braintreepaymentsolutions.com/)他们会给你一个代表最初提供的信用卡号的“令牌”。

您可以存储此号码，这对潜在的小偷来说毫无价值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-18T14:21:43.560

Authorize.Net[客户信息管理器 (CIM)](http://developer.authorize.net/api/cim/)允许您存储客户信用卡信息，以便将来的付款可以半自动化。然后，您将创建自己的定期计费服务（可能是一项 cron 作业），以确定要收取的金额（因为它每月波动），然后调用适当的客户资料并向他们收取该金额。无需人工交互。

否则，没有支付网关提供任何允许自动灵活支付的服务，因为它无法提前知道支付方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-06T16:58:07.977

反复执行此操作。您只需要跟踪自己的使用情况并将其发布到 Recurly API。我们支持“计量计费”。

[全面披露——我是 Recurly 的联合创始人，因此有偏见……但客观]

这是一个演示视频，介绍如何使用 Recurly 的 API 完成可变金额计费。 [视频：使用 Recurly 进行定期计费的可变或分层定价教程](http://www.youtube.com/watch?v=Cm0C7JQURz8)

此场景的文档。

[http://docs.recurly.com/subscription-plans/metered-billing](http://docs.recurly.com/subscription-plans/metered-billing)

干杯丹

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T15:39:54.747

我稍微倾向于管理我的重复发生并让商家网关尽可能地愚蠢。这意味着我需要进行更多的簿记，但是一旦内置了额外的跟踪，您就会知道每笔交易并可以在您的系统中将其呈现给您的客户，而计费网关只需获取未结交易的总和，运行单个收费，并关闭交易。站在你这边也意味着你不会有一个经常性的费用无情地朝着它的重复日期前进，如果你的应用程序和网关之间出现问题并且没有设置新的费用，你必须疯狂地修复它。

最后，它应该与弄清楚如何删除或更改现有的经常性费用一样多的工作，但您会受益于每次都知道正确的费用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-15T21:28:49.510

市场上有一个相对较新的入口，称为 recurly.com，它位于 Authorize 等支付网关之上。他们专注于定期计费。我还没有深入了解这项服务，但我听过一位创始人在播客上谈论定期计费，他提出了一些在处理定期计费时出现的边缘案例（例如，退款、逾期付款等）难以处理。我的意见是尽可能把这样的事情留给专家。不幸的是，我目前没有足够的信息来说明 recurly 是否配得上专家的标签。有人有服务经验吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T23:39:42.233

我合作过的所有商家服务提供商（顺便说一句，其中不少）都提供定期计费。关于每月更改金额，由您通知商家服务。您可以通过在添加/删除新用户时调用服务来做到这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T23:39:55.290

我不确定是否有任何支付网关可以本机执行此操作，但是，您可以设置定期计费配置文件，然后根据需要在代码中对其进行修改。假设您为每次登录收取 0.05，然后每次他们登录时更改配置文件以添加 0.05，并在月底将其设置回默认值。

底线是，如果没有通信，支付网关就无法知道向您的客户收取多少或多少费用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-09T03:12:16.127

我们的网关完全可以满足您的要求：

*   存储加密和标记化的支付信息（支票或信用卡）。
*   计费可变金额
    *   按任何时间表添加固定的经常性金额
    *   将多张卡添加到帐户中，因此如果一张失败，它会级联到下一张
    *   设置任何开始日期，停止日期等。
    *   此外，您可以接受来自所有输入的付款——零售、移动、电子发票、电子商务、网页支付页面。它取代了 authorize.net、Payflow Pro 等。有一个 API 可用。有多种方法可以重新向客户收费。最简单的是在这个循环计费视频中。与上述其他人一样，系统确实需要被告知要计费的内容，无论是通过 API 还是手动输入。

# c# - DI/IoC、NHibernate 并帮助他们一起工作

> ID：387783
> 
> 赞同：5
> 
> 时间：2008-12-22T23:37:07.637
> 
> 标签：c#, nhibernate, dependency-injection, inversion-of-control

我试图让我的头脑围绕 DI/IoC、NHibernate 并让它们为我正在开发的应用程序很好地协同工作。我对 NHibernate 和 DI/IoC 都很陌生，所以不太确定我正在做的事情是否是明智的做法。这是场景：

该应用程序为用户提供了计算特定金融交易的特定价值（称为保证金）的能力。每个交易的保证金值的计算是通过抽象 MarginCalculator 类的具体实现来执行的，而要使用的具体实现取决于特定交易的产品类型（由产品对象的某个字段给出）。具体的计算器类是通过产品类的属性访问的。IE

```
public class Transaction
{
    private double _margin;
    private Product _product;
    private Client _client;

    public double Margin { get; }
    public Product Product { get; }
    public Client Client { get; }

    public Transaction(Product p, Client c)
    {
        _product = p;
        _client = c;
    }

    public void CalculateMargin()
    {
        _margin = _product.MarginCalculator.CalculateMargin();
    }
}

public class Product
{
    private string _id;
    private string _productType;
    ... Other fields

    public string Id { get; }
    public string ProductType { get; }
    public MarginCalculator MarginCalculator
    {
        get { return MarginCalculatorAssembler.Instance.CreateMarginCalculatorFor(this.ProductType); }
    }
}

public class MarginCalculatorAssembler
{
    public static readonly MarginCalculatorAssembler Instance = new MarginCalculatorAssembler();

    private MarginCalculatorAssembler ()
    {
    }

    public MarginCalculator CreateMarginCalculatorFor(string productType)
    {
        switch (productType)
        {
            case "A":
                return new ConcreteMarginCalculatorA();
            case "B":
                return new ConcreteMarginCalculatorB();
            default:
                throw new ArgumentException();
        }
    }
}

public abstract class MarginCalculator
{
    public abstract double CalculateMargin();
}

public class ConcreteMarginCalculatorA : MarginCalculator
{
    public override double CalculateMargin
    {
        // Perform actual calculation
    }
}

public class ConcreteMarginCalculatorB : MarginCalculator
{
    public override double CalculateMargin
    {
        // Perform actual calculation
    }
} 
```

用户从下拉列表中选择特定的客户端和产品，并将相应的客户端 ID 和产品 ID 传递到存储库，然后使用 NHibernate 填充产品和客户端对象，然后再将它们注入事务对象。在我当前的设置中，事务通过构造函数依赖注入（尚未使用 IoC 容器）接收其产品和客户端依赖项，即

```
public class ProductRepository : IRepository<Product>
{
    public Product GetById(string id)
    {
        using (ISession session = NHibernateHelper.OpenSession())
            return session.Get<Product>(id);
    }
}

/* Similar repository for Clients */

IRepository<Client> clientRepository = new ClientRepository();
IRepository<Product> productRepository = new ProductRepository();
Client c = clientRepository.GetById(clientId);
Product p = productRepository.GetById(productId);

Transaction t = new Transaction(p, c); 
```

以下是我希望得到的想法：

**A.** ***是否可以通过 Product 域对象访问 MarginCalculator（本质上是一项服务），或者应该按照此处的建议（[http://stackoverflow.com/questions/340461/dependency-injection-with-nhibernate -objects](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/03/31/ptom-the-dependency-inversion-principle.aspx) ) 重构代码以从域对象中删除服务依赖项，而是创建一个新的 TransactionProcessor 类，该类将抽象 MarginCalculator 作为依赖项（按照此处描述的内容 ( [http://www.lostechies.com ) /blogs/jimmy_bogard/archive/2008/03/31/ptom-the-dependency-inversion-principle.aspx](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/03/31/ptom-the-dependency-inversion-principle.aspx)）即***

```
public class TransactionProcessor
{
    private readonly MarginCalculator _marginCalculator;

    public TransactionProcessor(MarginCalculator marginCalculator)
    {
        _marginCalculator = marginCalculator;
    }

    public double CalculateMargin(Transaction t)
    {
        return _marginCalculator.CalculateMargin(Transaction t);
    }
}

public abstract class MarginCalculator
{
    public abstract double CalculateMargin(Transaction t);
} 
```

**B.** ***是否可以使用 IoC 容器来获取注入 NHibernate 填充/生成的产品和客户端依赖项的事务对象？***即给定一个由用户提供的productId和clientId，是否有可能有类似的东西：

```
// pseudocode
Transaction t = IoC.Resolve<Transaction>(productId, clientId); 
```

这样容器就解决了 Transaction 对象的 Product 和 Client 依赖关系，NHibernate 用于根据 productId 和 clientId 填充 Product 和 Client，然后将填充的 Product 和 Client 注入到 Transaction?

**C.**在典型的 DI 场景中，如果类 A 依赖于接口 B，则可能会执行以下操作：

```
IInterfaceB b = new ClassB();
A a = new A(b);

interface IInterfaceB
{
}

class B : IInterfaceB
{
}

public class A
{
    private IIntefaceB _b;

    public A(IInterfaceB b)
    {
        _b = b;
    }
} 
```

但是，这实际上是所有 DI 示例的显示方式，它假定 IInterfaceB 的实现者（在本例中为 B 类）在设计时是已知的。***有没有办法以在运行时确定实现者的方式使用 DI？***

非常感谢

马修

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T01:15:26.843

A) 如果你打算通过 Product 域对象访问 MarginCalculator，你不妨去掉中间人，让 DI/IOC 容器为你注入 MarginCalculator。您甚至可以摆脱 MarginCalculatorAssembler，因为大多数 DI/IOC 容器为您完成了对象构造的大部分样板代码。

**B 和 C** ) 很有可能。事实上，如果您使用[LinFu](http://www.codeproject.com/KB/cs/LinFu_IOC.aspx) ，您的代码如下所示：

```
// 无需更改 Transaction 类
公共类事务
{
    私人双倍保证金；
    私有产品_product；
    私人客户_client；

    公共双倍保证金 { 得到；}
    公共产品产品 { 获取；}
    公共客户客户{得到; }

    公共交易（产品 p，客户 c）
    {
        _产品 = p;
        _client = c;
    }

    公共无效计算保证金（）
    {
        _margin = _product.MarginCalculator.CalculateMargin();
    }
}

```

如果您可以使用 DI/IOC 将产品和客户端实例注入到构造函数中，那就太好了——但在我们这样做之前，您需要向容器注册依赖项。以下是使用 LinFu.IOC 的方法：

```
// 接下来，您必须告诉 LinFu 自动注册您的产品类：
[工厂（类型（产品））]
公共类 ProductFactory : IFactory
{
     对象 CreateInstance（IServiceRequest 请求）
     {
          // 从容器中获取 IRepository 的副本
          var repository = container.GetService>();

          // 获取 id（假设你的 id 是 Int32）
          var id = (int)request.Arguments[0];

          // 返回产品本身
          返回存储库.GetById(id);
     }
}

// 对 Client 类做同样的事情
//（注意：为了简单起见，我做了一个简单的剪切和粘贴——请原谅重复）
[工厂（类型（客户端））]
公共类 ClientFactory : IFactory
{
     对象 CreateInstance（IServiceRequest 请求）
     {
          // 从容器中获取 IRepository 的副本
          var repository = container.GetService>();

          // 获取 id（假设你的 id 是 Int32）
          var id = (int)request.Arguments[0];

          // 返回客户端本身
          返回存储库.GetById(id);
     }
}

[工厂（类型（交易））]
公共类 TransactionFactory : IFactory
{
     对象 CreateInstance（IServiceRequest 请求）
     {
        // 注意：为简洁起见，已删除参数检查
        var 容器 = request.Container;
        var arguments = request.Arguments;
        var productId = (int)arguments[0];
        var clientId = (int)arguments[1];

        // 获取产品和客户端
        var product = container.GetService(productId);
        var client = container.GetService(clientId);

        // 创建交易本身
        返回新交易（产品，客户）；
     }
}

// 使这个实现成为一个单例
[实现(typeof(MarginCalculator), LifecycleType.Singleton)]
公共类 ConcreteMarginCalculatorA : MarginCalculator
{
    公共覆盖双CalculateMargin（）
    {
        // 执行实际计算
    }
}

```

在您的一个程序集中编译完所有代码后，您只需执行以下操作即可将其加载到容器中：

```
var container = new ServiceContainer();
container.LoadFrom(AppDomain.CurrentDomain.BaseDIrectory, "YourAssembly.dll");

```

...现在是有趣的部分。为了使用给定的产品和客户 ID 创建您的交易对象，您需要对 LinFu.IOC 的容器进行以下调用：

```
整数产品 ID = 12345；
int 客户端 ID = 54321;
字符串服务名称=空；

// 不是伪代码 :)
var transaction = container.GetService(serviceName, productId, clientId);

```

有趣的是，尽管您可能拥有大量依赖项，但 LinFu 的 IOC 容器将为您处理 90% 的样板代码，因此您不必自己做所有这些事情。**最好的部分是上面的所有实现都将在运行时确定/解决**。

您实际上可以在程序运行时交换实现，甚至可以在不重新编译应用程序的情况下替换实现。您可以在此处找到更多信息：

[http://www.codeproject.com/KB/cs/LinFu_IOC.aspx](http://www.codeproject.com/KB/cs/LinFu_IOC.aspx)

HTH :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-25T00:48:21.563

这是我对您的问题的第二次看法：

答：就最佳实践而言，只要确保依赖于接口类型，就可以将服务依赖项留在域对象中。大多数（如果不是全部）容器可以为您执行这种类型的注入，并且模拟每个服务依赖项非常简单，因此您可以测试具体类中的每个行为。如果您想重构特定接口实现的样板实现，例如使用基类来执行通用 CRUD 持久性工作，我只建议使用抽象类。

乙和丙：

> 很高兴知道这种功能是可用的。我想一个更重要的问题是我正在尝试做的实际上是否是常见的做法，以及它是否被认为是好的做法。IE
> 
> 1.  让容器解析并注入已预先填充的依赖项 > 使用持久性框架（例如 NHibernate）和
> 2.  让容器注入抽象依赖项的具体实现，具体实现在运行时确定。
> 
> 另外，在 IoC/DI/NHibernate 术语中，我在说什么，有一个特定的名称吗？例如，它是此比较或 .net IoC 框架比较中列出的功能之一吗？我想了解其他 IoC 框架（如 Castle Windsor）是否像 LinFu 那样包含这些功能，但我不知道我所描述的内容是否具有特定名称，所以我不知道要搜索什么:)

我相信您实际上指的是[此链接](http://code.google.com/p/net-ioc-frameworks/wiki/Charts)上发布的比较。

1) AFAIK，进行服务注入是标准做法，但是您所指的注入类型对于其他一些框架来说很难做到，因为您必须在运行时使用域对象 ID 来解决这些依赖关系，并不是所有的容器都支持这种类型的动态解析（又名“上下文绑定”）。在所有条件相同的情况下（并假设这可以通过其他容器完成），似乎适用于 DI/IoC 的唯一“最佳实践”是您必须为服务依赖项使用接口。

这些依赖项最终应该如何构建和解决应该完全取决于您，并且在您的情况下，是否从持久性框架中填充这些依赖项并不重要，只要容器本身能够消除大部分为您提供样板解析代码。

2）具体的服务注入是DI/IOC框架中的标配，大部分可以在运行时解析依赖；但是，这些框架在注入的方式和位置上有所不同。

仅供参考，您应该注意的两个功能是**构造函数注入**和**属性注入**。根据您的代码示例，我会说您更倾向于使用构造函数注入，因此您可能需要密切注意每个各自的框架如何为您执行这种类型的注入。HTH :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T16:41:46.817

巴勃罗，

谢谢你的评论。

也许如果我详细说明我打算在项目中使用 DI 的一个领域（正如你所说，不仅要了解 DI，而且因为我认为这是必要的），然后可以就它是否是使用 DI 的正确位置。

如原始帖子中所述，该应用程序将使用 MarginCalculator 服务：

```
public abstract class MarginCalculator
{
    public abstract double CalculateMargin();
} 
```

注意：服务可能是抽象类或接口。

具体实现（DI 术语中的组件？）如下：

```
public class ConcreteMarginCalculatorA : MarginCalculator
{
    private IDependencyService1 _dependencyService1;
    private IDependencyService2 _dependencyService2;

    // Constructor dependency injection
    public ConcreteMarginCalculatorA(
        IDependencyService1 dependencyService1,
        IDependencyService2 dependencyService2)
    {
        this._dependencyService1 = dependencyService1;
        this._dependencyService2 = dependencyService2;
    }

    public override double CalculateMargin
    {
        // _dependencyService1 and _dependencyService2 
        // required here to perform calcuation.
    }
}

public class ConcreteMarginCalculatorB : MarginCalculator
{
    private IDependencyService3 _dependencyService3;
    private IDependencyService4 _dependencyService4;

    // Constructor dependency injection
    public ConcreteMarginCalculatorB(
        IDependencyService3 dependencyService3,
        IDependencyService4 dependencyService4)
    {
        this._dependencyService3 = dependencyService3;
        this._dependencyService4 = dependencyService4;
    }

    public override double CalculateMargin
    {
        // _dependencyService3 and _dependencyService4 
        // required here to perform calcuation.
    }
} 
```

***具体的保证金计算器及其构造难道不是应该在何处使用依赖注入以及如何使用 IoC 容器来处理依赖注入的完美示例吗？***

我认为我正在尝试做的与[本文](http://www.codeproject.com/KB/architecture/di-with-autofac.aspx#autofac-in-applications)和[本文等文章中描述 DI/IoC 的方式非常相似](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/03/31/ptom-the-dependency-inversion-principle.aspx)。

最后，我将使用一个工厂类，可能带有一个内部/子容器，以便根据参数值动态解析组件/实现器（ConcreteMarginCalculatorA、ConcreteMarginCalculatorB 等...）。为了实现这一点，我倾向于[Autofac](http://code.google.com/p/autofac/)（[http://code.google.com/p/autofac/](http://code.google.com/p/autofac/)），它允许根据参数值（[http://code.google.com/p/autofac选择实现者/wiki/ComponentCreation](http://code.google.com/p/autofac/wiki/ComponentCreation) - “基于参数值选择实施者”部分）：

```
public class MarginCalculatorFactory
{
    private readonly IContainer _factoryLevelContainer;

    public MarginCalculatorFactory(IContainer mainContainer)
    {
        _factoryLevelContainer = mainContainer.CreateChildContainer()
        _factoryLevelContainer.RegisterType<MarginCalculator, ConcreteMarginCalculatorA>("ConcMC1");
        _factoryLevelContainer.RegisterType<MarginCalculator, ConcreteMarginCalculatorB>("ConcMC2");
}

public MarginCalculator CreateCalculator(string productType)
{
    return _factoryLevelContainer.Resolve<MarginCalculator>(productType);
} 
```

}

所以最后我可以做到：

```
marginCalculatorFactory.CreateCalculator(productType); 
```

在客户端代码中并获得一个完全解析的计算器。然后计算器可以反过来被依赖注入到 TransactionProcessor 服务中：

```
public class TransactionProcessor
{
    private readonly MarginCalculator _marginCalculator;
    private readonly Transaction _transaction;

    public TransactionProcessor(MarginCalculator marginCalculator
        ,Transaction transaction)
    {
            _marginCalculator = marginCalculator;
            _transaction = transaction
    }

    public double CalculateMargin(Transaction t)
    {
            return _marginCalculator.CalculateMargin(transaction);
    }
} 
```

我可能是错的，因为我是整个 IoC/DI 游戏的新手，但在我看来，这*正是*Di/IoC 用于的那种场景。***别人怎么看？***

谢谢

马修

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-25T13:45:09.513

看看这篇文章 [http://fabiomaulo.blogspot.com/2008/11/entities-behavior-injection.html](http://fabiomaulo.blogspot.com/2008/11/entities-behavior-injection.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T07:51:33.660

菲利普，

感谢您的回答！

**乙和丙**：

很高兴知道这种功能是可用的。我想一个更重要的问题是***我正在尝试做的实际上是否是常见的做法，以及它是否被认为是好的做法。***IE

1.  让容器解析并注入使用持久性框架（例如 NHibernate）预先填充的依赖项，并且
2.  让容器注入抽象依赖项的具体实现，具体实现在运行时确定。

***另外，在 IoC/DI/NHibernate 术语中，我在说什么，有一个特定的名称吗？***例如，它是[此比较](http://blog.ashmind.com/index.php/2008/08/19/comparing-net-di-ioc-frameworks-part-1/)或.net IoC 框架[比较中列出的功能之一吗？](http://blog.ashmind.com/index.php/2008/09/08/comparing-net-di-ioc-frameworks-part-2/)我想了解其他 IoC 框架（如 Castle Windsor）是否像 LinFu 那样包含这些功能，但我不知道我所描述的内容是否具有特定名称，所以我不知道要搜索什么：）

***A：***

就最佳实践（即松散耦合、测试等）而言，从域对象中删除服务依赖项或将其保留在那里会更好吗？

谢谢

马修

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T13:18:21.143

根据“域驱动设计”，您的服务将是“域服务”，您的域的其余部分可以直接调用它或依赖它。

如果您打算使用 Nhibernate，请查看 Spring.net，这是一个非常流行的 DI 框架，它为您提供 DAOS，它已经在它们上注入了一个会话。它还允许您使用声明性事务（使用属性标记方法）。该项目的文档非常好。

最后但并非最不重要的一点，不要误会我的意思，我认为您使用该技术只是因为（我不认为您有 DI 的需要），如果您这样做是为了学习东西，这很酷，但在其他所有情况下都是错误的。

问候

# c++ - c++模板的Vim缩进？

> ID：387792
> 
> 赞同：6
> 
> 时间：2008-12-22T23:40:38.097
> 
> 标签：c++, vim, templates, pretty-print, indentation

有没有人知道或知道可以很好地缩进 C++ 模板的 vim 插件/宏/函数？

当我在 vim .hpp/.h 文件中突出显示模板定义并使用 '=' 缩进它时，我得到如下内容：

```
>     template <
>         class TFilter,
>               class TParser,
>               class TConsumer,
>               class TDataProcessor,
>               class TDataFeed,
>               class TSymbolMap
>                   >
>                   struct DataFeedTraits
>                   {
>                       typedef TFilter             Filter;
>                       typedef TParser<TSymbolMap> Parser;
>                       typedef TConsumer<Parser>   Consumer;
>                       typedef TDataProcessor<Filter,Consumer>  DataProcessor;
>                       typedef TDataFeed<Filter,DataProcessor,Parser,Ccnsumer> DataFeed;
>                   }; 
```

我认为 cindent 将结构/类声明与右括号“>”对齐。我想最终得到这样的东西，或者类似的，确切的格式并不重要，只要它是格式化的：

```
template <
    class TFilter,
    class TParser,
    class TConsumer,
    class TDataProcessor,
    class TDataFeed,
    class TSymbolMap
    >
struct DataFeedTraits
{
    typedef TFilter             Filter;
    typedef TParser<TSymbolMap> Parser;
    typedef TConsumer<Parser>   Consumer;
    typedef TDataProcessor<Filter,Consumer> DataProcessor;
    typedef TDataFeed<Filter,DataProcessor,Parser,Ccnsumer> DataFeed;
}; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-06-11T08:04:20.830

我的解决方案：

```
" 不要缩进命名空间和模板
功能！CppNoNamespaceAndTemplateIndent()
    让 l:cline_num = line('.')
    让 l:cline = getline(l:cline_num)
    让 l:pline_num = prevnonblank(l:cline_num - 1)
    让 l:pline = getline(l:pline_num)
    而 l:pline =~# '\(^\s*{\s*\|^\s*//\|^\s*/\*\|\*/\s*$\)'
        让 l:pline_num = prevnonblank(l:pline_num - 1)
        让 l:pline = getline(l:pline_num)
    结束时
    让 l:retv = cindent('.')
    让 l:pindent = indent(l:pline_num)
    如果 l:pline =~# '^\s*template\s*\s*$'
        让 l:retv = l:pindent
    elseif l:pline =~# '\s*typename\s*.*,\s*$'
        让 l:retv = l:pindent
    elseif l:cline =~# '^\s*>\s*$'
        让 l:retv = l:pindent - &shiftwidth
    elseif l:pline =~# '\s*typename\s*.*>\s*$'
        让 l:retv = l:pindent - &shiftwidth
    elseif l:pline =~# '^\s*namespace.*'
        让 l:retv = 0
    万一
    返回 l:retv
结束功能

如果有（“自动命令”）
    autocmd BufEnter *.{cc,cxx,cpp,h,hh,hpp,hxx} setlocal indentexpr=CppNoNamespaceAndTemplateIndent()
万一

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T03:08:55.010

您可以使用[identexpr选项通过计算](http://vimdoc.sourceforge.net/htmldoc/options.html#%27indentexpr%27)[表达式](http://vimdoc.sourceforge.net/htmldoc/indent.html#indent-expression)来指定缩进（即编写 vim 脚本函数）。这个函数应该接受一个字符串——行——并返回要缩进的空格数。这使您可以灵活地为此模板条件返回缩进级别，或者在正常的类似 C 的情况下回退到[autoindent](http://vimdoc.sourceforge.net/htmldoc/options.html#%27autoindent%27)、[smartindent](http://vimdoc.sourceforge.net/htmldoc/options.html#%27smartindent%27)或[cindent 。](http://vimdoc.sourceforge.net/htmldoc/options.html#%27cindent%27)

[这是一个为处理 Qt 的信号和插槽扩展而创建的示例。](http://vim.wikia.com/wiki/Indenting_for_Qt_C%2B%2B)它演示了回退到 cindent 函数。

# cocoa-touch - 键盘启动时手指可滚动的 UIWebView

> ID：387794
> 
> 赞同：1
> 
> 时间：2008-12-22T23:44:12.440
> 
> 标签：cocoa-touch

在我正在编写的应用程序中，我在顶部有一个 UIWebview，在底部有一些 UITextField，我希望用户能够根据 webview 中的内容输入。但是当他们触摸文本字段并弹出键盘时，用户将失去操作网页以查看不同部分的能力。

有没有办法让键盘保持向上并且仍然能够操作 UIWebView？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T00:56:32.263

不，我相信键盘是模态的，所以你不能访问它下面的表单。

您可以回复

```
- (void)keyboardWillShow:(NSNotification*)aNotification;
- (void)keyboardWillHidde:(NSNotification*)aNotification; 
```

通知并在显示键盘时向上或向下滚动视图...

[这里的例子](http://alanduncan.net/?q=node/13)

# java - 如何在 Hibernate 中使用链接表映射多对多列表

> ID：387806
> 
> 赞同：7
> 
> 时间：2008-12-22T23:49:41.417
> 
> 标签：java, hibernate, mapping

我想使用链接表在 Hibernate 中映射多对多。我有两个类，父类和子类，例如：

```
public class Parent{

private List<Child> _children;

//...getters and setters
} 
```

我使用具有三列`link_id`、`parent_id`和的链接表 (link_table) `child_id`。数据库是 SQL server，id 类型是 uniqueidentifier。因此，我通常将 guid 用于 id 字段。

**`<list />`**如果这是要使用的正确标签，您如何使用该标签来实现这一点？你知道有什么好的文档来完成这个吗？

我目前正在收到 ConstraintViolationException，但找不到任何好的文档或示例。

**我认为一个主要问题是：如何指定`link_id`要在链接表中自动生成的。**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T01:30:42.133

我使用注释来做到这一点，特别是@ManyToMany 和@JoinTable：

[休眠文档：](http://www.hibernate.org/hib_docs/annotations/reference/en/html/entity.html#eentity-mapping-association-collection-manytomany)

```
@Entity
public class Employer implements Serializable {
    @ManyToMany(
        targetEntity=org.hibernate.test.metadata.manytomany.Employee.class,
        cascade={CascadeType.PERSIST, CascadeType.MERGE}
    )
    @JoinTable(
        name="EMPLOYER_EMPLOYEE",
        joinColumns=@JoinColumn(name="EMPER_ID"),
        inverseJoinColumns=@JoinColumn(name="EMPEE_ID")
    )
    public Collection getEmployees() {
        return employees;
    }
}

@Entity
public class Employee implements Serializable {
    @ManyToMany(
        cascade = {CascadeType.PERSIST, CascadeType.MERGE},
        mappedBy = "employees",
        targetEntity = Employer.class
    )
    public Collection getEmployers() {
        return employers;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T02:49:50.787

我认为不可能（或没有必要）将 link_id 主键添加到连接表中。连接表通常由两个参与表的主键组成。

使用 XML，您将需要如下语法：

```
 <class name="Parent">
    ....
    <list name="children" table="link_table">
    <key column="parent_id"/>
    <many-to-many column="child_id"
        class="Children"/>
    </list>
    ...
 </class>

<class name="Child">
...
<list name="parents" inverse="true" table="link_table">
    <key column="child_id"/>
    <many-to-many column="parent_id"
        class="Parent"/>
</list>
...
</class> 
```

虽然我发现注释更好用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T00:33:08.287

我不确定您是否可以轻松地为具有现有数据的现有数据库完成此操作。Hibernate 通常最好在您第一次连接时定义自己的数据模式......

我只用注释完成了多对多，但我认为休眠文档提供了基于 XML 的示例：[链接文本](http://www.hibernate.org/hib_docs/reference/en/html/collections-mapping.html#collections-ofvalues)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-21T07:34:52.250

我在网上找到了一个非常好的博客，它提供了两种方法来向多对多映射的休眠列添加额外的字段。传统上，我们期望多对多映射给一个新表将 FK 的表映射。但是有一些方法可以调整它并向这个连接表添加更多字段/列。

此连接表可能包含一个 PK 或可能包含一些没有 PK 的额外字段。有关确切实施，请参阅此博客[请参阅此处](http://www.codejava.net/frameworks/hibernate/hibernate-many-to-many-association-with-extra-columns-in-join-table-example)

根据您的示例，您需要在表中添加一个额外的 PK，以便声明一个新表 ParentChildren 并将您的主键声明为 linkId。我只展示了带注释的父子类，因为可以从上面的帖子中引用父类和子类中多对多映射的注释。

```
@Entity
@Table(name = "parent_children")
public class ParentChildren{
    @Id @GeneratedValue
    private long linkId;

    @ManyToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "parent_id") 
    private Parent parent;

    @ManyToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "children_id) 
    private Children children;

    // additional fields if you want
    private boolean activated;

    //getters and setters
    }
} 
```

因此，这将创建一个映射表，其中 linkId 作为主键，parent_id 和 children_id 作为外键。请清楚为什么要单独使用 link_id 作为主键以及如何使用它。

# maintenance - 您如何熟悉没有文档的代码库？

> ID：387815
> 
> 赞同：11
> 
> 时间：2008-12-22T23:59:31.757
> 
> 标签：maintenance, codebase

我不知道，有人告诉我，以前的开发人员在学习并直接进入编码方面做得很好，没有什么大问题。我想知道我是否做错了，我要求我的经理在这里与一些高级程序员进行一些简短的会议。是谨慎地完成这个时间敏感的跟踪器，还是赶在最后期限前完成？

顺便说一句，以前维护这个应用程序的程序员都在公司不到一年就走了。不知道有没有什么关系。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-23T00:12:36.237

一年前在 Slashdot 上有一个[关于这个的帖子。](http://ask.slashdot.org/article.pl?sid=08/01/18/1554257)在通常的 Slashdot 杂乱无章中，有一些很好的答案；也许有人可以在这里提取它们。

一些不错的方法是[使用调试器](http://ask.slashdot.org/comments.pl?sid=422996&cid=22094862)、Doxygen（当然）（以及 ctags/etags/GNU Global 等相关工具）、[放弃](http://ask.slashdot.org/comments.pl?sid=422996&cid=22095174)和[几本关于这个主题的书](http://ask.slashdot.org/comments.pl?sid=422996&cid=22097350)逐步完成程序：Michael 的**[《有效地使用遗留代码》](https://rads.stackoverflow.com/amzn/click/com/0131177052)** Feathers and **[Code Reading: The Open Source Perspective](https://rads.stackoverflow.com/amzn/click/com/0201799405)** by Diomidis Spinellis。

而且我个人推荐阅读[PG Wodehouse Method Of Refactoring](http://basildoncoder.com/blog/2008/03/21/the-pg-wodehouse-method-of-refactoring/)；如果没有的话，它至少是一个有趣的阅读！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T01:16:51.163

阅读单元测试。没有单元测试？写一些单元测试。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T00:32:14.810

你看到[这个问题了](https://stackoverflow.com/questions/215076/whats-the-best-way-to-become-familiar-with-a-large-codebase)吗？

一致的答案似乎是：
深入研究并修复错误。选择一个仅限于代码库的一小部分。经常使用调试器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T00:20:25.130

我做过几份类似的工作，*所有*的程序员都离开了公司。我称之为红旗。

该项目没有文档可能并非巧合，但很难判断其中是否存在因果关系。真相可能是以下任何一种：

*   程序员离开了，因为管理层不允许他们记录他们的工作。
*   管理层要求程序员离开，因为他们拒绝记录他们的工作。
*   程序员在项目变得太难工作后离开，没有文档。

熟悉代码的最好方法可能是编写测试。为自己设置一个生成代码覆盖率报告的单元测试工具。编写运行所有代码的测试。代码覆盖可视化可帮助您发现尚未练习的边缘情况。当你经历这个过程时，我保证你会学到很多关于代码是如何工作的。作为附带的好处，您将生成一个完整的单元测试套件。

其他人提到，获取生成 API 文档的工具是另一种选择。此类文档仅供参考。它对于向您展示如何或何时*最好*地使用给定的类或方法没有用处。

另一个练习是为系统的各个部分构建 UML 图。即使代码的面向对象架构存在缺陷，序列图也很有用[。](http://en.wikipedia.org/wiki/Sequence_diagram)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T00:13:54.533

我会说有很多测试，如果他们设置了某种单元测试框架，那么你很好，如果没有，那么你可能想要开始一个。因为几乎没有什么比在你试图修复另一件事时破坏某件事更令人沮丧的了。

作为参考，你可能想看看这个，这个家伙似乎比你更紧张：

[继承-a-php-噩梦-从哪里开始](https://stackoverflow.com/questions/353795/inherited-a-php-nightmare-where-to-start)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T00:01:13.420

哪种编程语言？代码库有多大（1k、10k、100k 行？）

无论如何，我建议使用[Doxygen](http://www.doxygen.org/)创建易于浏览的 HTML 交叉引用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T00:16:27.227

如果它足够小（比如 10,000 行或更少），我已经在老式列表中取得了相当程度的成功。打印出代码，拿一些荧光笔和那些彩色的便利贴标记，然后查看清单、涂鸦笔记、查找参考资料并拼凑整体结构。去一个安静的地方做这件事，然后花时间检查代码。

如果它是用你可以使用 ctags 或类似的东西写的，拿一台笔记本电脑，这样你就可以搜索代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-23T02:49:49.430

我总是做的第一件事（在 VisualStudio 中）是为解决方案中的每个项目创建一个类图。这让我看到了我正在使用的图形表示。

出于某种原因，我只是带着黄色的便笺簿完成了主要课程，并记下了关于什么与什么对话的笔记。这似乎对我有用。真的不知道为什么，或者为什么它比仅仅阅读代码更好。

此外，如果有一些令人困惑的代码，您不知道它应该如何工作，那么通过调试器运行它并逐步执行它。我总是尽量保持调用堆栈可见，以便对不同的代码路径有所了解。

最后一件事（这可能不会发生在每个人身上）是通过探查器运行它。您不一定要寻找性能数据，但您对捕获的代码路径感兴趣。它实际上对于查看运行时实际发生的情况非常有用。

# c# - Sharepoint 作为模板应用程序

> ID：387817
> 
> 赞同：0
> 
> 时间：2008-12-23T00:00:56.823
> 
> 标签：c#, sharepoint, sharepoint-2007

我们有一个站点需要（作为我们流程的一部分）生成一个文档（例如 Word docx 文档），该文档源自与模板文档合并的应用程序中的数据。生成该文档后，用户可以在运行时对其进行编辑。我们知道我们正在寻找一个类似 CMS 的系统（因为用户需要能够编辑/创建新模板）但我想知道 Sharepoint 是否可以更好地使用（因为我们不需要很多开销传统的 CMS 系统）。任何sharepoint专家都可以权衡一下，给我一些在哪里看的指示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T01:34:41.673

我正在研究一个类似的问题——从存储在 SharePoint 站点中的信息生成 Word 文档。这里真正的魔力在于使用 Office 2007 中的内容控件 - 由于新版本的 Office 套件基于 Office Open XML，因此从数据生成文档几乎是微不足道的。

使文档在创建后可编辑是一个简单的配置更改，可以通过编程方式或在文档模板本身中进行。事实上，我认为当您可以看到您的组织将业务流程轻松地转移到 SharePoint 时，该平台的真正价值就会大放异彩。

一旦一切配置正确，通过各种批准步骤从您公司的某个部门内部获取内容到面向公众的 Internet 站点非常简单。

这里有一些关于在服务器上生成 OOXML 文档的好博文

*   [ECMA Office Open XML - 用于生成 Word 文档的选项（在服务器上；））](http://blogs.msdn.com/mszcool/archive/2007/07/09/ecma-office-open-xml-options-for-generating-word-documents-on-the-server.aspx)
*   [在服务器上生成 Word 文档（第 2 部分） - 使用 System.IO.Packaging 动态添加内容控件/结构化文档标签 (SDT)](http://blogs.msdn.com/mszcool/archive/2007/07/31/generating-word-documents-on-the-server-part-2-dynamically-adding-content-controls-structured-document-tags-sdt-using-system-io-packaging.aspx)

请注意，客户端无需运行 Office 2007 即可打开这些文档，您可以进行转换过程，也可以安装[适用于 Office XP、2000 和 2003 的免费兼容包](http://office.microsoft.com/en-us/products/HA101686761033.aspx)

就 SharePoint 和 CMS 而言，我认为这是一个非常引人注目的提议。肯定存在一些配置和实施挑战，但我认为任何企业 CMS 软件包都会出现这种情况。一个重要的考虑因素是您的 CMS 站点将看到的流量。我认为 SharePoint 还没有准备好扩展到谷歌式的流量，但对于典型的企业互联网存在来说，它肯定会足够好。

以下是一些[运行 MOSS 的公共站点的列表](http://blogs.msdn.com/sharepoint/archive/2007/05/03/top-17-case-studies-for-microsoft-office-sharepoint-server-2007-and-several-new-moss-based-web-sites.aspx)

一旦您克服了初始配置的障碍，就可以很容易地在整个组织中启用 CMS 任务，因为它在防火墙的两侧都运行良好。

我认为它是一款很棒的产品，并且对它的灵活性和可扩展性感到惊讶。

jt

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T00:47:54.293

[Infopath](http://msdn.microsoft.com/en-us/library/ms573938.aspx)是 Sharepoint 人员将向您推荐的表单技术。大多数 Infopath 表单功能都需要完整的 MOSS 安装和相关的许可费用。我认为你可以通过 WSS 来实现你想要的。

如果 DOCX 文件作为表单模板是您的应用程序的硬性要求，您可以；

1.  自动化 Word（物理隔离这个），这个**不是**MS 官方支持的
2.  探索使用[OpenXML](http://openxmldeveloper.org/)（假设所有客户端都使用 Word 2007）。

如果您最终需要生成 PDF 或 Word 2003 DOC 文件作为输出，那么您将无法自动执行 Word，否则 #2 是最适合服务器的解决方案。

无论哪种方式，我认为您都可以使用[SP 文档库](http://msdn.microsoft.com/en-us/library/ms954724.aspx)来保存 DOCX 文件，并且您的用户可以通过这种方式共享和编辑带有版本控制的模板。您可以在应用程序特定代码中以编程方式访问这些文件并“带外”执行数据合并。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T03:28:58.600

这是基于自定义模板生成文档的组件。文档是从共享点列表生成的......因此数据会从列表项中动态提取到文档中：http: [//store.sharemuch.com/products/generate-word-documents-from-sharepoint-list](http://store.sharemuch.com/products/generate-word-documents-from-sharepoint-list)

希望有帮助，

雅罗斯拉夫·彭萨斯基博客：www.sharemuch.com

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-23T00:10:37.693

Sharepoint 不会减轻您传统 CMS 系统的重量和包袱。如果有的话，与那里的许多 CMS 工具相比，它会增加你的负担。

所以简而言之 - 不要看 Sharepoint - 看看别处！

# apache-flex - 如何确定 TileList 中最后一个取消选择的项目？

> ID：387824
> 
> 赞同：3
> 
> 时间：2008-12-23T00:06:36.250
> 
> 标签：apache-flex, actionscript-3

我的 TileList 有 allowMultipleSelection 。我正在使用 itemClick 来调用一个函数。如果我正在选择，我可以使用 listEvent.currentTarget.selectedItem 来确定刚刚单击的对象，但是当我 ctrl + 单击取消选择一个项目时，它会自动选择 TileList 中的其他内容，从而更改 selectedItem。在 itemClick 函数运行之前，似乎 ctrl + 单击取消选择会更改目标。有没有办法找出刚刚取消选择的内容？

我可以使用 selectedItems 来获得我需要的相同的最终功能。但是，当 selectedItems 集合变得非常长时，我担心性能。我们正在使用 blazeds 来回发送数据，如果我们每次发送添加/删除的一项，然后发送整个内容，速度会快得多。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T02:16:16.270

我有点惊讶您似乎在说在每种情况下都没有发送“itemClick”。我想知道您是否应该尝试收听“更改”事件？

添加一个名为“previouslySelectedItems”的属性并在它和“selectedItems”之间进行比较以找出发生了什么变化呢？比较完成后，设置previousSelectedItems = selectedItems。

# data-modeling - 一些 snarks 是 boojums：boojums 列表，还是所有 snarks 上的 is_boojum 属性？

> ID：387829
> 
> 赞同：4
> 
> 时间：2008-12-23T00:10:30.330
> 
> 标签：data-modeling

问题域以大量命名的蛇为特征。有些蛇是boojums。

至少有两种方法可以对此建模：

```
// 作为属性：
    类蛇{
      字符串名称；
      布尔 is_boojum;
    };  

// 作为一个列表：
    类蛇{
      typedef 长 ID；
      身份证号码；
      字符串名称；
    };  

    树<Snark::Id> boojums;

```

看起来很直观，如果我们确定 snark 分为男性和女性，我们将在 snark 类定义中添加“sex”属性；如果我们确定除了 5 条蛇以外的其他人都是被征服的臣民，我们就会列出一份皇室成员名单。

是否有可以应用的原则，或者是架构偏好的问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T00:21:05.580

你想解决什么问题？

如果记录蛇的版税的目的是在 GUI 中显示他们头上的王冠，那么它只是一个属性是有意义的。（或者，可能有一个 RoyalSnark 子类，带有一个重写的 Render 方法。）

如果目的是快速找到所有皇家蛇，那么列表更合适 - 否则您需要查看每个蛇并检查其属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T00:38:33.207

作为派生类：

```
class Snark 
{
   virtual void Approach(Creature& approacher) {};
};

class Boojum : public Snark
{
   virtual void Approach(Creature& approacher) 
   { 
      approacher.softlySuddenlyVanishAway(); 
   }
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-23T04:43:27.610

我相信与分类相关的信息熵可以指导使用哪种方法。低熵分类（即大多数对象具有相同的值）建议使用列表实现来跟踪例外情况，而高熵分类（您无法很好地预测对象将具有哪种分类）建议使用属性实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T00:29:53.240

在所有情况下，这种自然的方式似乎都是一种属性。

您可以使用列表来提高性能或优化空间。这两个原因都让我觉得过早优化、破坏封装和/或存储冗余数据的潜在情况会导致缺乏完整性的风险（因为我仍然应该能够查询对象本身以查明它是否是皇家的——我应该'不必知道出于性能原因以特殊方式处理*此属性）。*我可以假设将列表实现隐藏在 getter 后面，以使其表现为属性。

此外，如果这些对象存储在 DB 中，性能问题几乎就消失了，因为 DB 层可以在运行时使用查询来创建列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T00:31:48.460

如果您要询问数据库建模，那么将其`is_boojum`视为 table 中的属性列是最直接的`Snarks`。如果你需要搜索所有 boojums，查询很简单：

```
SELECT * FROM Snarks WHERE is_boojum = 1 
```

这给出了逻辑上正确的答案，并且很容易建模。它可能不会那么快，因为索引具有低选择性的列（许多行具有相同的值）效率不高，并且可能根本无法从索引中受益。

但是您的问题是关于建模，而不是优化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T02:45:11.280

嗯。我的第一个想法是，的确，Boojum 是 Snark 的一个子类型。但规范似乎反对它，因为“你看，蛇是一个boojum”。好吧，这意味着 snark is_a Boojum，这将使继承图循环。不能这样。

另一方面，我认为没有任何迹象表明 Snark 可以*变成*Boojum。要么是 Boojum，要么不是。

我想你可能想要一个 Boojum mixin——

```
abstract class Snark { /*...*/ };
class PlainSnark extends Snark {/*...*/};
class RoyalSnark extends Snark implements Boojum {/*...*/}; 
```

# windows-services - Windows UPS（不间断电源）服务 - 关闭 UPS？

> ID：387830
> 
> 赞同：0
> 
> 时间：2008-12-23T00:10:34.557
> 
> 标签：windows-services, ups

我正在使用 UPS 服务从应用程序监控我的 UPS 的状态 - HKLM\SYSTEM\CCS\Services\UPS\Status 的键包含您可以从电源控制面板获得的所有信息。但是——我也希望能够告诉 UPS 从我的应用程序中关闭。我知道该服务可以告诉 UPS 关闭 - 例如，在使用电池运行一定分钟数后 - 我想知道是否可以向服务发送某种命令以手动启动关闭.

我在搜索这些信息时遇到了麻烦——人们倾向于拼错“Uninterruptible”（hrm，Firefox 用红线标记了它，但没有其他选择），而“UPS”只是在运输服务中得到了点击。也许我可以通过 System.ServiceController 或 WMI 做点什么？

澄清：是的，我说的是关闭物理 UPS 设备。我知道如何停止服务。我认为这将是一个常见问题——我希望我的 UPS 与 PC 一起关闭。[基于此页面](http://msdn.microsoft.com/en-us/library/ms789319.aspx)，我有一个想法要尝试。你看，APC（和其他所有人）必须提供一个 DLL 供 UPS 服务调用，而且由于函数调用有据可查，我没有理由不能 P/Invoke 它们。一旦我知道它是否有效，我会重新编辑它。

更新：我尝试调用 UPSInit，然后调用 UPSTurnOff，但没有任何反应。我会再修改一些，但直接调用 apcups.dll 可能是死路一条。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T00:49:36.740

查看我对 Herman 的评论，您要关闭 UPS，而不是 UPS SERVICE，对吗？我的意思是，你想让那个东西关闭，切断电源等等，对吧？

如果是这样，您正在通过 UPS 型号查看 UPS。我怀疑其中两个会起作用。

在您的搜索中，请尝试“APC”或“电池”，而不是 UPS。我认为很多代码是在笔记本电脑上运行以处理电池等问题......

一些地方隐藏在一些尘土飞扬的旧文件中使用串行电缆...您实际上可以使用 Qmodem 或 Hyperterm 与 UPS 通话...

从与 APC 的人交谈中学到的。他们非常好，乐于助人。现在，我认为您只需发布一个来自您的 Powerchute 软件的 URL，它就会直接与 UPS 对话，并执行您的命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T15:08:29.673

好的，我有答案（经过测试！），但它并不漂亮。我的 APC UPS 使用[APC“智能”协议](http://www.apcupsd.org/manual/APC_smart_protocol.html)进行通信（[更多信息在此处](http://eu1.networkupstools.org/protocols/apcsmart.html)）。在我的情况下，您需要的是“软关机”、“S”命令。但首先您需要确保它处于“智能”模式（“Y”）。现在，如果您想让 Windows UPS 服务监控状态，该服务将牢牢抓住 COM 端口。因此，您可以 a) 让 Windows 服务关闭 UPS，或 b) 终止服务并自行关闭 UPS。

UPS 本身在收到“S”命令后有一个“宽限期”，让您有时间关闭操作系统。这意味着要执行上述 (a)，您必须：

*   终止公用事业（市电）电源
*   等待 Windows UPS 服务超时（默认，最少 2 分钟）
*   等待 Windows 关闭——就在接近尾声时，它会发送“S”命令
*   等待 UPS 宽限期，之后它实际上会自行关闭

我认为我们将选择 (a)，因为 (b) 涉及额外的工作来终止服务和实现串行通信。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-23T00:33:05.620

请告诉您您尝试使用哪种语言...如果您使用的是 .NET，您可以使用 ServiceController 类来做到这一点（阅读文档）。

用于使用 C/C++ 控制 Win32 API 中的服务，[Service Functions (Windows)](http://msdn.microsoft.com/en-us/library/ms685942(VS.85).aspx)。

例如，要停止服务，您可以按如下方式使用 ControlService 函数（这是一个快速而肮脏的示例）：

```
OpenService (hServMgr, TEXT("\\UPS_SERVICE_0"), SC_MANAGER_ALL_ACCESS);

SERVICE_STATUS stat;
ControlService (hUpsService, SERVICE_CONTROL_STOP, &stat) 
```

请注意，您需要在 hServMgr 中提供服务管理器句柄，并且 \\UPS_SERVICE_0 名称是必须与您所需的 UPS 服务（Windows 内置或其他）匹配的名称。

请记住，要停止服务，您需要适当的安全权限。这不是管理员帐户的问题，但请记住使用非管理员帐户登录时会发生什么。

希望有帮助。

关于关闭物理 UPS 设备，我记得在 WIn98 天我能够关闭通过 COM 端口与 UPS 通话的设备，虽然我不记得品牌或编程接口是如何的。

# sql - 如何使这个 Ruby on Rails 页面更高效？

> ID：387850
> 
> 赞同：3
> 
> 时间：2008-12-23T00:25:07.040
> 
> 标签：sql, ruby-on-rails, activerecord, performance

我正在建立一个网站，用户可以在其中跟踪他们为龙与地下城 (www.ddmdb.com) 收集的人物。此功能中涉及的模型/关系如下：

**用户：**

*   ID
*   登录名（用户名）
*   *一堆其他领域*

**微型：**

*   ID
*   姓名
*   number（集合中的#，不计数）
*   release_id（外键）
*   *一堆其他字段和外键*

**所有权：**

*   id（这真的需要吗？）
*   用户身份
*   微型ID
*   have_count
*   最喜欢的（布尔值）

我建立的相关关系如下：

**用户：**

*   has_many :所有权
*   has_many :miniatures, :through => :ownerships, :uniq => true, :conditions => "ownerships.have_count > 0"
*   has_many :favorites, :through => :ownerships, :source => :miniature, :uniq => true, :conditions => "ownerships.favorite = true"

**缩影：**

*   has_many :所有权
*   has_many :owners, :through => :ownerships, :source => :user, :uniq => true, :conditions => "ownerships.have_count > 0"

**所有权：**

*   属于_to：用户
*   属于_to：微型

我有一个页面，用户既可以查看和更新​​他们的收藏，也可以查看其他用户的收藏。它包含网站上所有微缩模型的列表和每个旁边的文本框，用户可以在其中输入他们拥有的每个微缩模型的数量。此功能也存在于微型模型的子列表中（按类型、版本、大小、稀有度等过滤）

当用户创建帐户时，他们没有所有权条目。当他们使用收藏页面或微缩模型子列表更新他们的收藏时，我在所有权表中创建条目，仅用于提交页面上的微缩模型。因此，如果它是完整的收藏列表，我会更新所有迷你图（即使计数为 0），或者如果它是子列表，我只会更新那些微缩图。因此，在任何时候，我可能拥有的特定用户： - 没有所有权条目 - 一些缩影的条目 - 所有缩影的条目。

我遇到的问题是我不知道如何使用“Rails 方法”通过 LEFT JOIN 查询数据库，因此如果用户在所有权中没有微型条目，则默认为 has_count 0\. 目前，当我遍历所有缩影时，我分别查询每个 user_id/miniature_id 组合，这显然效率很低。

**看法：**

```
<% for miniature in @miniatures %>
  <td><%= link_to miniature.name, miniature %></td>
  <td><%= text_field_tag "counts[#{miniature.id}]", get_user_miniature_count(current_user, miniature), :size => 2 %></td>
<% end %> 
```

**帮手：**

```
def get_user_miniature_count(user, miniature)
  ownerships = user.ownerships
  ownership = user.ownerships.find_by_miniature_id(miniature.id)
  if ownership.nil?
    return 0
  else
    return ownership.have_count
  end
end 
```

另一种解决方案是在用户注册时为所有微缩模型创建条目，但是当所有用户在注册后将新微缩模型添加到数据库时，我还必须为所有用户添加 0 have_count。这似乎会变得有点复杂，但也许这是正确的方法？

有没有办法为特定用户的所有权表中没有条目的微型模型进行连接并提供默认值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T01:34:11.800

我要说的第一件事是用户模型应该拥有计算出用户拥有多少给定微型模型的代码，因为它看起来像“业务逻辑”而不是视图格式。

我的建议是为您的用户模型添加一个方法：

```
def owns(miniature_id)
  o = ownerships.detect { |o| o.miniature_id == miniature_id }
  (o && o.have_count) || 0
end 
```

干编码，ymmv。

编辑：请注意，一旦加载，所有权就会被 Rails 缓存，并且检测不会像 find 那样被 ActiveRecord 覆盖，因此就像您期望它在数组上一样（即没有数据库操作）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T03:48:10.997

使用 fd 的建议和在[http://www.ruby-forum.com/topic/52385](http://www.ruby-forum.com/topic/52385)找到的信息，我创建了以下方法：

```
def miniature_count(miniature_id)
  if @counts.nil?
    @counts = Hash.new
    ownerships.collect{|o| @counts[o.miniature_id] = o.have_count }
  end
  count = @counts[miniature_id] || 0
end 
```

这最终比*检测*方法更快。

我选择了*minimize_count*而不是*owns*作为名称，因为*owns*听起来像是一个应该返回布尔值而不是整数的方法。

**查询每个条目**

完成于 2.61783 (0 reqs/sec) | 渲染：1.14116 (43%) | 数据库：1.34131 (51%) | 200 OK [ [http://ddmdb/collection/1]](http://ddmdb/collection/1])

**检测方法**

完成于 2.20406 (0 reqs/sec) | 渲染：1.87113 (84%) | 数据库：0.21206 (9%) | 200 OK [ [http://ddmdb/collection/1]](http://ddmdb/collection/1])

**哈希方法**

在 0.41957（2 个请求/秒）内完成 | 渲染：0.19290 (45%) | 数据库：0.10735 (25%) | 200 OK [ [http://ddmdb/collection/1]](http://ddmdb/collection/1])

我肯定需要添加缓存，但这绝对是一个改进。我也怀疑我过早地优化了这段代码，但它是一个小网站，2.5 秒的加载时间并不让我高兴。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T00:46:02.100

也许我遗漏了一些东西，但是您指定关系的方式似乎足以让 Rails 自己计算出计数？你试过吗？

编辑：重新在评论中讨论......怎么样：

```
<% ownerships=current_user.ownerships %> 
<% for miniature in @miniatures %>
  <td><%= link_to miniature.name, miniature %></td>
  <td><%= text_field_tag "counts[#{miniature.id}]", get_miniature_count(ownerships, miniature), :size => 2 %></td>
<% end %> 
```

如果`get_miniature_count()`缩影出现在列表中，则只需遍历提供的所有权并返回 0 或计数？我认为这将避免在“for”的每次迭代中再次返回数据库。

编辑 2：我还建议启动脚本/控制台并尝试直接在 ruby​​ 中执行您想要的操作，即根据 ruby​​ 而不是 SQL 来测试所有权列表中的缩影成员资格。通常，rails 和 activerecord 足够聪明，可以在幕后为您执行必要的 SQL 黑魔法，因为它知道这些关系。如果你找到一个用户然后执行 user.methods 你会看到什么是可用的。

# database - 批量导入大型数据集时的数据库性能建议

> ID：387858
> 
> 赞同：0
> 
> 时间：2008-12-23T00:30:32.193
> 
> 标签：database, performance, hibernate, caching, jpa

我正在使用 Java 和 Hibernate 的 JPA 实现构建一个数据库 Web 应用程序。应用程序跟踪对象。它还必须从遗留源批量导入对象。

例如，假设我们正在跟踪人员。该数据库有名为 Person 和 Address 的表。有对应的 JPA 实体和 DAO 类。

在 JPA 层之上是负责各种操作的服务层。一个操作是从外部遗留源（例如电话簿中的人）导入一组可能很大的数据。对于每个人，它必须检查它是否已经存在于数据库中。然后它必须根据需要创建或更新人员。每个人都有一个地址，因此还必须进行适当的交叉引用和地址创建。

我的问题是，对于大型数据集，此操作可能会很慢。我目前的算法是：

```
for (Person person: allPersons)
{
    check if person exists in database
    check if address exists in database
    create or update person and address as necessary
} 
```

你会建议什么来提高性能？

在我的脑海中，我能想到：

1.  更改导入逻辑以使用查询检索数据并将其存储到数据库。例如，不是在 for 循环中检查人员是否存在，而是在一个查询中将所有人员键提交到数据库，该过程每个检索到的人员在内存中。
2.  在 DAO 类中添加我自己的缓存。
3.  使用外部缓存解决方案（例如 memcached）。

我总是可以通过重组以最小化查询来选择#1。缺点是我的服务层现在非常了解 DAO 层。它的实现现在由较低的数据库层决定。还有其他问题，例如使用过多的内存。这种从数据库中抓取然后在内存中处理的方法似乎非常本土化，并且与 JPA 等现成的解决方案背道而驰。我很好奇其他人在这种情况下会怎么做。

编辑：缓存无济于事，因为在循环中被查询的每个人都是不同的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T03:46:28.600

我发现有两种解决方案有效。一种是一次处理一个块。每个块关闭后重新启动会话。我曾尝试在会话中使用 flush clear 方法，但有时它的功能与您预期的一样。在批次之间启动和停止事务似乎效果最好。

如果性能是一个主要问题，您只需分解并在 JDBC 中执行。Hibernate 为大型数据集的批处理增加了太多开销，其中内存和性能很重要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T06:10:58.020

您的方法将导致对数据库的单独查询过多；看起来像 4n + 1。如果可能，我会编写一个查询（可能在原始 SQL 中），一次性检查人员 + 地址是否存在。

您可能希望使用 StatelessSession 而不是标准的 Hibernate Session。由于它没有一级缓存，它应该可以降低您的内存需求。

[http://www.hibernate.org/hib_docs/reference/en/html/batch-statelesssession.html](http://www.hibernate.org/hib_docs/reference/en/html/batch-statelesssession.html)

如果这对您不起作用，那么您需要查看 Hibernate 中的批处理选项：

[http://www.hibernate.org/hib_docs/reference/en/html/batch.html](http://www.hibernate.org/hib_docs/reference/en/html/batch.html)

# zend-framework - Zend Framework：如何在表单元素上设置自定义验证器？

> ID：387865
> 
> 赞同：3
> 
> 时间：2008-12-23T00:36:38.967
> 
> 标签：zend-framework, zend-form, zend-validate

我正在编写一个自定义验证器来检查至少一个字段是否有值。我想验证“namefield”或“idfield”是否有值。其中之一可以为空，或者两者都可以有值，但至少其中之一必须有值。

```
$nameField = new Zend_Form_Element_Hidden('namefield');
$nameField->setValue($this->nameFieldValue)
          ->addValidator('AtLeastOneHasValue', false, array('idfield')); 
```

据我了解，除非我将表单元素设置为必需，否则我的验证器不会验证。

```
->setRequired(true) 
```

但是如果我将它设置为必需，它会自动验证它不是空的，并且错误消息说它是空的。我想允许该字段为空，并使用我的自定义验证器验证多个字段。如何在不将表单元素设置为必需的情况下使用自定义验证器验证表单元素？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T00:41:01.967

检查[此文档页面](http://framework.zend.com/manual/en/zend.form.elements.html)以获取 setAllowEmpty() 方法。这应该可以帮助您到达您想要去的地方。

> setAllowEmpty($flag) 和 getAllowEmpty() 允许您修改可选元素的行为（即，所需标志为假的元素）。当“允许空”标志为真时，空值将不会传递到验证器链。

# php - PHP多站点登录

> ID：387879
> 
> 赞同：7
> 
> 时间：2008-12-23T00:51:19.233
> 
> 标签：php, login, single-sign-on, multiple-domains

我目前正在从事一个跨越多个领域的项目。我想要的是用户能够登录一个站点并同时登录所有其他站点。

用户会话存储在数据库中，我在每个域上设置的 cookie 都包含会话 ID。

所以基本上当用户登录到 example.com 时，会使用他们的会话 ID 创建一个 cookie，会话数据存储在数据库中。完成此操作后，需要在具有此唯一会话 ID 的所有其他域上创建一个 cookie，以便当用户从一个站点到另一个站点时，他们将自动登录。

现在我找到了一种在 Firefox 中执行此操作的方法（使用在其他域上执行 PHP 脚本的图像标签，本质上是在不同域上创建不同的 cookie）但是这种方法在 IE 中不起作用（没有测试过 Opera 或Safari 等）。

有没有人对我如何让它在 IE 中工作有任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T14:35:10.753

看看我的问题[Cross Domain User Tracking](https://stackoverflow.com/questions/216430/cross-domain-user-tracking)。

您需要做的是向“图像”添加另一个 HTTP 标头。

[如果您在 Internet Explorer 6 中使用 FRAMESET，来自 Session 变量的](http://support.microsoft.com/kb/323752/EN-US/)引用将丢失：

> 您可以将 P3P 紧凑策略标头添加到您的子内容中，并且您可以声明不会对用户的数据执行任何恶意操作。如果 Internet Explorer 检测到令人满意的策略，则 Internet Explorer 允许设置 cookie。
> 
> 满足此标准的简单紧凑策略如下：
> 
> P3P: CP="CAO PSA OUR"
> 
> 此代码示例显示您的站点为您提供了对您自己的联系信息 (CAO) 的访问权限，任何分析的数据都只是“伪分析的”，这意味着数据与您的在线角色相关联，而不是与您的物理身份相关联（PSA )，并且您的数据不会提供给任何外部机构供这些机构使用 (OUR)。
> 
> 如果您在 ASP 页中使用 Response.AddHeader 方法，则可以设置此标头。在 ASP.NET 中，您可以使用 Response.AppendHeader 方法。您可以使用 IIS 管理管理单元 (inetmgr) 添加到静态文件。
> 
> 按照以下步骤将此标头添加到静态文件：
> 
> 1.  单击开始，单击运行，然后键入 inetmgr。
> 2.  在左侧导航页面中，单击您的网站中要添加标头的相应文件或目录，右键单击该文件，然后单击“属性”。
> 3.  单击 HTTP 标头选项卡。
> 4.  在“自定义 HTTP 标头”组框中，单击“添加”。
> 5.  键入 P3P 作为标头名称，然后键入 CP=... 作为紧凑策略字符串，其中“...”是您的紧凑策略的相应代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T02:04:01.443

不确定这在您的开发中是否是一个好的建议，但如果您想以“正确”的方式进行操作，您绝对应该查看[单点登录。](http://en.wikipedia.org/wiki/Single_sign-on)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T14:27:49.443

只是我，还是听起来像你的 CSRF 使用你的技术使用在 Firefox 中工作的图像？

有趣的方法，尽管我希望你不会在那里面临安全威胁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T14:20:58.537

我自己没有这样做，但我认为你走对了。我可能会这样做，除了我会使用 Javascript 文件而不是图像。它将在服务器端生成，并在客户端更新 cookie。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-23T14:34:18.417

可能我有点傻，但你能不能在登录时为每个域名设置cookies？因此，当他们登录到站点 A 时，他们不是只有一个 cookie，而是有五个，或者你有多少个站点？

```
setcookie(A, $sessid, expire, path, domainA.com);
setcookie(B, $sessid, expire, path, domainB.com);
setcookie(C, $sessid, expire, path, domainC.com);
setcookie(D, $sessid, expire, path, domainD.com); 
```

# cocoa-touch - UInavigationBar 和 UIPickerView 的背景

> ID：387883
> 
> 赞同：1
> 
> 时间：2008-12-23T00:52:33.800
> 
> 标签：cocoa-touch

我知道当您创建带有导航栏的导航控制器时，您只能为此选择三个背景（例如：半透明黑色等）。我见过具有“半透明黑色”类型功能的其他颜色（如绿色）的应用程序。他们是否只是创建自己的背景视图并将其设置为 UINavigationBar？他们是如何获得这种“半透明”效果的呢？就像整个视图不是单一的颜色，但顶部就像一个小透明，底部是不同的颜色。类似于 UIPickerView 在后台有一个很好的设计。

我怎样才能做到这一点？用图形设计程序设计图形？或者只是在视图上使用石英（渐变等）来获得这个？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T01:07:44.020

您可以通过更改UINavigationBar的[tintColor属性来更改颜色](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UINavigationBar_Class/Reference/UINavigationBar.html#//apple_ref/occ/instp/UINavigationBar/tintColor)

```
myBar.tintColor = [UIColor greenColor]; 
```

# c# - 如何使用 C# 读取和写入结构到文件？

> ID：387893
> 
> 赞同：2
> 
> 时间：2008-12-23T01:01:24.203
> 
> 标签：c#

当我使用 C 时，我可以使用 write(&stName,sizeof(stName),&FileName) 并在其他程序中定义相同的结构来读取文件（XXX.h），但我想使用 C# 做同样的事情，我不应该使用不安全模式。如何解决问题？

**编辑：**

谢谢大家。我会试试看

**编辑：**

现在，如果我想使用 C 将 Struct 写入 file.h 并使用 C# 从 file.h 读取结构，我是否有机会解决这个问题而不计算偏移量？因为当我想在结构中添加一些变量或其他结构时，计算偏移量不是一个好的答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T01:06:39.700

看一下[ISerializable](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.aspx)接口和一般的序列化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T06:25:50.587

即使在 C 中，做 IMO 也是一件危险的事情。如果你使用不同的编译器、操作系统、架构等，你可以很容易地“破坏”你的数据文件——你完全依赖于内存中数据的布局。这有点像直接公开字段而不是属性 - 内存中的布局应该是一个实现细节，可以在不更改公共表单（文件）的情况下进行更改。

当然，存储数据的方法有很多种。例如：

*   二进制序列化（仍然很脆弱，IMO）
*   XML 序列化
*   [Google 的协议缓冲区](http://code.google.com/apis/protocolbuffers/)
*   [节约](http://incubator.apache.org/thrift/)
*   [YAML](http://en.wikipedia.org/wiki/Yaml)
*   手写序列化/反序列化，例如使用 BinaryReader 和 BinaryWriter

在文件是否可读、速度、大小等方面存在平衡。有关 Java 的类似问题的答案，请参[见此问题。](https://stackoverflow.com/questions/352117)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T01:09:17.043

你应该看看[NetDataContractSerializer](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.netdatacontractserializer.aspx)。您可以标记您希望序列化的结构部分并使用文件流将它们写出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T01:11:44.263

查看[StructLayoutAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.structlayoutattribute.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-23T02:07:43.930

使用托管 C++ 或 C++/CLI。它可以读取您的 .h 文件结构。它可以使用以下方式读写：

```
read(in, &structure, sizeof(structure));
write(out, &structure, sizeof(structure)); 
```

它可以非常简单地将数据传输到 .NET 中的任何其他内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T01:59:39.533

您必须使用 Bitconverter.convert() 单独转换结构的每个成员。当您的结构包含数字数据类型时，这很有效，但在使用包含更复杂数据类型（如字符串、数组和集合）的结构时，您可能需要做一些更复杂的事情。出于这样的目的，您需要查看其他人提到的 .Net 序列化工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T02:09:31.510

您也可以查看[Google 协议缓冲区](http://code.google.com/apis/protocolbuffers/)。您可能不想在代码中添加另一个依赖项，但这意味着您可以执行此类操作。

# c++ - 单元测试 C++ 模板

> ID：387894
> 
> 赞同：16
> 
> 时间：2008-12-23T01:04:47.803
> 
> 标签：c++, unit-testing, templates

我在实现我的库时使用了函数和类模板。到目前为止，我刚刚在库单元测试 (CppUnit) 中实例化了一个模板，然后几乎像任何其他普通类或函数一样对其进行测试。

最近我一直在计划将一些模板也添加到库 API 中。好的界面当然是最重要的，模板与否。使用精心设计和实施的模板，即使不能完全防止，至少也可以让用户更难自爆。无论如何，我觉得与纯粹的内部模板相比，单元测试公共模板需要更加严格。

那么，您是如何对您的 C++ 模板进行单元测试的呢？你有没有想出任何优雅的解决方案，尤其是公共图书馆 API 中的模板？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T01:13:45.833

对于初学者，使用您认为用户最有可能提供的参数对您的模板代码进行单元测试。我经常制作模板“以防万一”，但最终只使用了我在编写原始代码时想到的一种类型。因此，在这种情况下，测试最可能的情况涵盖所有情况！

如果您觉得需要进行更多测试，请使用与第一个参数尽可能不同的另一个模板参数。可能没有必要再次测试所有方法。有些方法实际上可能并不依赖于模板参数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T22:24:03.943

**我有一个*额外*的建议。** 除了对每个模板进行单元测试之外，还要检查有助于**限制**库用户可能尝试传递给模板的大量模板参数的技术。

例如：假设您只使用类型参数“string”和“char”测试模板。您没有证据表明其他类型参数对于此特定模板会出现问题，但出于某种原因，您“怀疑”其他未经测试的类型参数*会*出现问题。

在上述示例的情况下，并不一定意味着您应该详尽地测试其他类型的参数。相反，您的情况可能暗示您应该使用一些编译时模板元编程技术来确保您的模板永远不会与“string”和“char”以外的任何其他参数一起使用。

一种资源：

[现代 C++ 设计——作者 Andrei Alexandrescu](https://rads.stackoverflow.com/amzn/click/com/0201704315)

在本书的早期，作者展示了以下示例：

*   **如何制作一个模板，该模板将自我强制其第一种类型 arg 的类型小于其第二种类型 arg**

*   **如何在编译时检测可转换性和继承性**

“现代 C++ 设计”（尽管它的标题相当宽泛/模糊）是对模板编程技术的相当高级的探索。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-26T18:12:10.783

Boost.Test 有一个组件，便于根据模板参数集测试模板。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T11:16:02.450

在单元测试中实例化模板是为了测试一个模板类。

有什么风险？它们取决于您的库对模板参数所做的事情；考虑根据用于实例化模板类和编写新测试的类可能会出现什么问题。

至少您将准备好您的单元测试环境来重现将报告的任何问题。

# wcf-data-services - ADO.NET DataService：将参数传递给 [WebInvoke] 方法

> ID：387895
> 
> 赞同：4
> 
> 时间：2008-12-23T01:05:01.047
> 
> 标签：wcf-data-services

考虑以下示例：

```
public class SomeBusinessLayerService : DataService<MyEntityContainer>
{
 [WebInvoke]
 void DoSomething(string someParam)
 {
 }
} 
```

我找不到关于如何将参数传递给函数的示例或任何帮助！使用 WebClient （或 goofinfg 与 fiddler 一起使用）我可以触发函数调用，但无论我尝试什么参数 someParam 始终为 null 更糟糕的是 - 如果我将类型更改为 int - 我所有的尝试都以以下错误结束：

```
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<error xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">
  <code></code>
  <message xml:lang="en-US">Bad Request - Error in query syntax.</message>
</error> 
```

任何人都可以帮助我如何调用 POST 内容的工作示例吗？

注意：这是 DataService，而不是 WCF 服务。我可以让它与 WCF 服务使用相同的方法而没有任何问题。

编辑：我还需要 POST 示例而不是在 URI 中嵌入参数，因为 URI 有大小限制和清理字符串的要求。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T07:46:15.083

经过数小时的“错误请求 - 查询语法错误”响应拉扯我的头发后，我终于通过在 URI 中传递参数来让它工作。

特别注意字符串参数周围的引号：

错误：DoSomething?someParam=param 正确：DoSomething?someParam='param'

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:06:03.850

也许您应该尝试在 URI 中使用引号 (DoSomething?someParam='param') 来包含参数。我试过这个，它工作正常，在其他情况下我收到与你相同的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T21:34:55.560

我从未收到 Microsoft 团队对该问题的回复，因此我找到了以下解决方法：

使用 RequestID、Result 和参数字符串创建一个名为 FunctionRequest 的表
要执行请求，我只需创建对象。
如果我需要发送复杂对象 - 我使用 DataContext 序列化将其发送到服务器。
所有呼叫现在也记录在数据库中 - 这非常适合记录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-15T11:17:33.060

要完成一点[antcode 响应](https://stackoverflow.com/questions/387895/ado-net-dataservice-passing-parameter-to-webinvoke-method/844890#844890)，您不仅必须密切注意用引号括起来的参数值...

**但！**您还必须在 Guid 值前面加上“guid”。像这样：

```
var y = ctx.Execute<bool>(new Uri("ReportExists?id=guid'" + Guid.NewGuid() + "'", UriKind.Relative)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-20T14:46:10.973

我遇到了类似的问题，我正在使用 POST 将`x-www-form-urlencoded`格式 ( ) 的表单参数发送到标记的方法，并且很难弄清楚如何获取参数。我最终通过以下方式实现了它：`param1=value1&param2=value2...``[WebInvoke]`

```
[WebInvoke]
void DoSomething(Stream requestStream)
{
    StreamReader reader = new StreamReader(stream);
    var requestContent = reader.ReadToEnd();
    var parameters = HttpUtility.ParseQueryString(requestContent);
    var param1 = parameters["param1"];
    var param2 = parameters["param2"]; //and so on...
} 
```

# php - 在运行时更改对象的类

> ID：387912
> 
> 赞同：0
> 
> 时间：2008-12-23T01:15:13.210
> 
> 标签：php, casting

我正在使用 CMS，Joomla，并且有一个核心类将一组参数呈现给一个表单，JParameter。基本上它有一个`render()`功能，可以输出一些与我网站的其余部分不一致的表格 HTML。

对于可维护性的问题，并且因为我不知道在哪里使用它，我不想更改核心代码。理想的情况是能够定义一个扩展 JParameter 的新类，然后将我的 $params 对象向下转换为这个新的子类。

```
// existing code --------------------
class JParameter {
    function render() {
        // return HTML with tables
    }
    // of course, there's a lot more functions here
}

// my magical class -----------------
class MyParameter extends JParameter {
    function render() {
        // return HTML which doesn't suck
    }
}

// my code --------------------------
$this->params->render();    // returns tables
$this->params = (MyParameter) $this->params;  // miracle occurs here?
$this->params->render();    // returns nice html 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T02:00:38.907

总是有[PECL 的 Classkit](http://pecl.php.net/package/classkit)，但我感觉你真的不想这样做。假设您直接调用`$this->params->render()`，您可能只想创建一个执行备用渲染 ( `MyParamRenderer::render($this->params)`) 的函数/对象，并避免执行该语言本身不支持的 OO 体操。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T09:58:24.730

如何创建一个装饰器，将除 JParameter::render() 之外的任何内容委托给现有对象

```
class MyJParameter {
    private $jparm;
    function __construct( JParameter $jparm ) {
        $this->jparm = $jparm;
    }
    function render() {
        /* your code here */
    }
    function __get( $var ) {
        if( isset( $this->$jparm->$var ) {
            return $this->$jparm->$var;
        }
        return false;
    }
    function __set( $var, $val ) {
        /* similar to __get */
    }
    function __call( $method, $arguments ) {
        if( method_exists( $this->jparm, $method ) {
           return call_user_func_array( array( $this->jparm, $method ), $arguments );
        }
        return false;
    }
} 
```

还是这太臭了？

# c# - C# 卫星程序集？我需要链接默认文化资源吗

> ID：387915
> 
> 赞同：1
> 
> 时间：2008-12-23T01:15:43.380
> 
> 标签：c#, resources, satellite-assembly

我们想使用附属程序集来包含各种依赖于语言环境的资源文件。

问题是......我们需要链接默认文化吗？

我们有一个单独的项目，它将包含我们所有不同的文化资源文件。如下所示，我们有一个项目，里面有两个资源文件。

项目RES

*   资源.resx
*   资源.it-IT.resx

我假设“Resource.resx”将作为默认文化，如果选择意大利文化，应用程序将采用 it-IT 资源文件。

我们需要做什么才能让应用程序和项目的其余部分访问资源文件。我们如何设置资源文件的名称空间以便能够引用它们。

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T02:29:40.830

基本上，

如果操作系统使用的当前文化与您发布的某个文化相匹配，则会使用该文化，如果当前文化与您发布的任何文化都不匹配，它将使用中性文化。

在最简单的情况下，您只需要在部署中包含任何本地化的 dll，一切都会好起来的。

当您使用资源管理器时，我认为您还可以传递要明确使用的文化，运行时将搜索匹配的资源 - 当 ASP.Net 站点的用户可能具有某种文化时，这会更好与运行站点的机器不同的首选项。

[http://msdn.microsoft.com/en-us/magazine/cc163609.aspx](http://msdn.microsoft.com/en-us/magazine/cc163609.aspx)似乎是一个很好的起点。

# asp.net - ASP.NET 客户端/浏览器 URL

> ID：387921
> 
> 赞同：2
> 
> 时间：2008-12-23T01:21:09.920
> 
> 标签：asp.net, localization, url-rewriting, globalization

我想知道如何从 ASP.NET 中的浏览器获取 URL。

我有一个用于全球化/本地化的页面，并且我正在（通过服务器而不是代码）从`www.spanishversion.com`to重定向`www.englishversion.com`，但 URL 被屏蔽以仍然显示`www.spanishversion.com`. 我想获取浏览器的 URL，但是当我尝试以下操作时：

*   `Request.Url.ToString()`
*   `Request.Url.OriginalUrl`
*   `Request.Path Request.RawUrl`
*   `Request.ServerVariables["SERVER_NAME"]`

它总是以`www.englishversion.com`. 有没有办法可以从浏览器显式读取 URL？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T14:57:47.740

try

```
HttpContext.Current.Request.Url.PathAndQuery 
```

from [MSDN](http://msdn.microsoft.com/en-us/library/system.uri.pathandquery.aspx)

I use it to set variables in a master page.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T01:28:31.810

您可以使用 Javascript 和[`location.href`](http://www.w3schools.com/htmldom/prop_loc_href.asp).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T01:31:11.603

尝试`Request.Url.Host`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-28T08:45:42.737

您可以尝试使用：

```
Request.Rawurl 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-16T15:55:03.323

我想`Request.Url.AbsoluteUri`是你的朋友。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-11T05:05:58.603

猜猜你把这种情况弄错了。您说地址栏被屏蔽显示`www.spanishversion.com`，但它是否显示`www.spanishversion.com`？

# javascript - 如何在 javascript 中访问请求内容正文中的查询参数？

> ID：387925
> 
> 赞同：2
> 
> 时间：2008-12-23T01:30:11.010
> 
> 标签：javascript, post, request

如果我使用 GET 请求页面，那么我可以使用 window.location.search 从 javascript 访问任何查询参数。当页面是 POST 的结果时，是否有类似的方法来访问请求内容正文中而不是请求位置中的查询参数？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T01:32:44.220

因为数据是在服务器端处理的，所以客户端（JS 所在的地方）无法访问这些变量。

# iphone - iPhone：如何以编程方式响应 SMS 消息

> ID：387934
> 
> 赞同：15
> 
> 时间：2008-12-23T01:39:28.560
> 
> 标签：iphone, sms

在查看了 iPhone SDK 文档之后，我还***没有***找到一种编写应用程序的方法，以便它可以在 iPhone 平台内以编程方式处理传入 SMS 消息的内容。这个想法是让这样的应用程序*在后台*运行，并且基于特定格式的 SMS 消息将能够采取特定的操作。

有人知道这是否可以通过 iPhone SDK 应用程序实现，如果可以，请提供有关如何完成此操作的信息的指针？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-23T01:46:19.857

遗憾的是，您无法使用 iPhone SDK 拦截或收到通知接收的 SMS 消息。

一种可能的替代方法是注册一个自定义 URL 方案，当具有该方案的 url 嵌入到 sms 消息中并且用户点击它时，该方案启动您的应用程序。

要设置自定义 url 方案，您必须在应用程序的 info.plist 中实现 CFBundleURLSchemes 和 CFBundleURLName 键。

在您的应用程序的委托中，您可以实现 application:handleOpenURL: 方法以获取从 SMS 消息中的 url 传递给您的应用程序的任何参数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T01:44:38.843

我相信目前 SDK 不允许后台应用程序（苹果除外）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T09:59:36.427

BREW 和 J2ME 有（并且可能仍然有）通过特殊格式的 SMS 启动您的应用程序的方法，这可能是 Jeff 所指的。

Apple 确实有即将推出的 Push Server，它允许您向用户发送警报，让他们选择启动您的应用程序，但您不能为他们启动您的应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T11:06:18.950

不幸的是，仅仅注册一个 URL 方案根本没有帮助你，因为 SMS 应用程序使“http://”url 只能点击......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-11T08:47:06.983

您可以使用 CoreTelephony 框架。但您必须使用一些私有 api。我有一些演示代码。[https://github.com/edison0951/AppNotifyBySMSDemo](https://github.com/edison0951/AppNotifyBySMSDemo)

# c++ - 如何检测 WinCE C/C+ 运行时库下的泄漏？

> ID：387936
> 
> 赞同：2
> 
> 时间：2008-12-23T01:41:31.800
> 
> 标签：c++, windows-mobile, memory-leaks, windows-ce, crtdbg.h

*我知道使用crtdbg.h*头文件对 Win32 进行基本泄漏检测的可能性，但是这个头文件在 CE CRT 库头文件中不可用（我使用的是最新的 SDK v6.1）。

任何人都知道如何使用 VC 9.0 自动检测 WinCE/ARMV4I 配置中的泄漏？我不想为我的类层次结构覆盖 new/delete，我更愿意准备好使用和测试过的代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T16:10:10.143

在工作中（开发基于 WindowsCE 的操作系统 + 应用程序），我们创建了自己的内存管理器，大致基于[Fluid Studios 内存管理器](http://www.paulnettle.com/pub/FluidStudios/MemoryManagers/Fluid_Studios_Memory_Manager.zip)（我使用 SO 找到的链接！）。我很确定通过一些简单的修改，您可以调整它以在您的平台上使用。

基本上它不会覆盖 new 和 delete，而是使用预处理器向它添加额外的报告。然后，一旦程序退出，它就会生成一个内存泄漏的输出文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T02:20:32.830

您想使用[AppVerifier](http://msdn.microsoft.com/en-us/library/aa934674.aspx)或[Entrek CodeSnitch](http://entrek.com/products.htm#CodeSnitch)。我在短时间内让 CodeSnitch 工作的运气要好得多。需要注意的是我没有做很多WinMo - 主要是香草CE。我相信 CodeSnitch 和更新的 WinMo 设备（Platman 与 Corecon）存在连接问题，但我也相信 Entrek 要么有一个测试版，要么有一个适用于它的补丁。我的建议是打电话给 Entrek（不要发电子邮件，他们很忙，所以打电话将是您获取信息的最快途径），只有当您发现它不起作用时，然后查看 AppVerifier。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-13T09:20:28.983

我认为有一个 SourceForge 项目：

[http://sourceforge.net/projects/crtdbg4wince/](http://sourceforge.net/projects/crtdbg4wince/)

如果我正确理解您的问题，那**就是**您正在寻找的

# c# - 为什么暴露 List 被认为不好 ?

> ID：387937
> 
> 赞同：62
> 
> 时间：2008-12-23T01:44:05.197
> 
> 标签：c#, fxcop

根据 FXCop，List 不应该在 API 对象模型中公开。为什么这被认为是不好的做法？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-23T02:04:35.683

我同意这里的 moose-in-the-jungle：`List<T>`是一个不受约束的、臃肿的物体，里面有很多“行李”。

`IList<T>`幸运的是，解决方案很简单：改为暴露。

它公开了一个准系统接口，该接口具有大多数`List<T>`'s 方法（除了类似的方法`AddRange()`），并且不会将您限制为特定`List<T>`类型，这允许您的 API 使用者使用他们自己的自定义实现`IList<T>`.

为了获得更大的灵活性，请考虑`IEnumerable<T>`在适当的时候将一些集合公开给 。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-12-23T01:53:34.333

有两个主要原因：

*   List<T> 是一种相当臃肿的类型，其中许多成员在许多场景中都不相关（对于公共对象模型来说太“忙”了）。
*   该类是未密封的，但不是专门为扩展而设计的（您不能覆盖任何成员）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-23T01:57:33.827

如果您正在编写一个将被成千上万的开发人员使用的 API，那么它只会被认为是不好的做法。

.NET 框架设计指南适用于 Microsoft 的公共 API。

如果你有一个没有被很多人使用的 API，你应该忽略这个警告。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T01:46:17.080

我认为您不希望您的消费者在您的退货中添加新元素。API 应该清晰完整，如果它返回一个数组，它应该返回确切的数据结构。我认为这与 T per say 无关，而是直接返回 List<> 而不是数组 []

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-23T03:57:21.183

一个原因是因为 List 不是您可以模拟的东西。即使在不太受欢迎的库中，由于此建议，我也看到用于将 List 对象公开为 IList 的迭代，并且在以后的版本中决定根本不将数据存储在列表中（可能在数据库中）。因为它是一个 IList，所以更改客户端下的实现并保持每个人的工作并不是一个重大更改。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-23T12:27:19.220

One of the reason is that user will be able to change the list and owner of the list will not know about this, while in some cases it must do some stuff after adding/removing items to/from the list. Even if it isn't required now it can become a requirement in future. So it is better to add AddXXX / RemoveXXX method to the owner of the class and expose list an an IEnumerable or (which is better in my opinion) expose it as an IList and use ObservableCollection from WindowsBase.

# cocoa-touch - UIEvent 传入 -[UIView hitTest:]

> ID：387938
> 
> 赞同：5
> 
> 时间：2008-12-23T01:44:15.537
> 
> 标签：cocoa-touch

我正在覆盖`-hitTest:`自定义 UIWebView 子类中的方法。传递给此方法的 UIEvent 始终具有空的触摸集（`[[event allTouches] count]`is == 0 ）。UIEvent 对象中不应该有触摸信息还是这是一个错误？

我尝试过其他 UIVIew 类型（例如 UIView、UIWindow）并看到相同的行为，因此它不限于 UIWebView。这适用于 2.* SDK 的任何版本。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T03:09:20.010

我永远无法弄清楚为什么 UIEvent 传递给 hitTest:withEvent 有一组空的触摸。

不过，我确实想出了解决问题的方法。我只关心单击，所以我不确定它是否适用于其他人的情况。请参阅我的博客文章： [http ://ryan-brubaker.blogspot.com/2009/01/iphone-sdk-uiwebview.html](http://ryan-brubaker.blogspot.com/2009/01/iphone-sdk-uiwebview.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T02:45:07.723

看起来你必须在它上面实现一个透明视图，然后将所有事件委托给 UIWebView：

*   [http://discussions.apple.com/thread.jspa?messageID=8486052](http://discussions.apple.com/thread.jspa?messageID=8486052)

有很多关于他们如何让它工作的信息。

# google-maps - 谷歌街景网址

> ID：387942
> 
> 赞同：52
> 
> 时间：2008-12-23T01:46:42.367
> 
> 标签：google-maps, google-street-view

嗨，我有一个属性的地址，我的应用程序可以启动浏览器来访问[http://maps.google.com?q=searchStringHere](http://maps.google.com?q=searchStringHere)。如果找到一个好的匹配，它会直接把它带到那里。有什么我可以附加到 url 以使其切换到街景而没有确切坐标的东西吗？我不想编写任何 javascript 或 flash 代码。

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2009-02-12T19:56:03.457

构建 Google 街景 URL

基本 Google 地图网址 [http://maps.google.com/maps?q=](http://maps.google.com/maps?q=)

q= 查询 - 在此参数中传递的任何内容都被视为已输入到 maps.google.com 页面上的查询框中。

显示 GPS 线位置的基本 url

[http://maps.google.com/maps?q=31.33519,-89.28720](http://maps.google.com/maps?q=31.33519,-89.28720)

[http://maps.google.com/maps?q=&layer=c](http://maps.google.com/maps?q=&layer=c)

layer= 激活覆盖。当前选项是“t”交通，“c”街景。同时追加（例如 layer=tc）。

[http://maps.google.com/maps?q=&layer=c&cbll=](http://maps.google.com/maps?q=&layer=c&cbll=)

cbll= 街景的纬度、经度

[http://maps.google.com/maps?q=&layer=c&cbll=31.33519,-89.28720](http://maps.google.com/maps?q=&layer=c&cbll=31.33519,-89.28720)

[http://maps.google.com/maps?q=&layer=c&cbll=31.335198,-89.287204&cbp=](http://maps.google.com/maps?q=&layer=c&cbll=31.335198,-89.287204&cbp=)

cbp= 接受 5 个参数的街景窗口：

1.  街景/地图排列，11=上半部街景和下半部地图，12=大部分街景和角落地图

2.  旋转角度/方位（度）

3.  倾斜角度，-90（笔直向上）至 90（笔直向下）

4.  缩放级别，0-2

5.  俯仰（以度为单位）-90（垂直向上）到 90（垂直向下），默认 5

下面的一个是：(11) 上半部分街景和下半部分地图，(0) 朝北，(0) 正前方，(0) 正常缩放，(0) 间距为 0

这个按原样工作，只需更换电线，如果您想面向不同的方向（11 后的 0） [http://maps.google.com/maps?q=&layer=c&cbll=31.335198,-89.287204&cbp=11 ,0,0,0,0](http://maps.google.com/maps?q=&layer=c&cbll=31.335198,-89.287204&cbp=11,0,0,0,0)

[更多谷歌街景代码交互](http://mapki.com/wiki/Google_Map_Parameters)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-23T04:33:16.227

不幸的是，没有简单的答案，基于地址。

首先，[此处记录了 Google 地图站点的参数列表](http://web.Archive.org/web/20110903160743/http://mapki.com/wiki/Google_Map_Parameters#Street_View)，因此您可以以此为起点。

简单的部分是您需要选择街景图层“&layer=c”。

但是，在该图层中显示任何内容之前，您需要指定视图的位置。您可以通过 cbll 中的纬度和经度以及 cbp 中的一些选项设置相机的角度。

要从地址中获取纬度和经度，您需要使用[地理编码服务](http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders)，例如[google maps api](http://code.google.com/apis/maps/)。

但是，这只会让您看到该地址附近的街景。除了知道街景需要从哪里拍摄外，您还需要知道将相机指向哪个角度 - 每个地址都会有所不同，具体取决于街景相机拍摄照片的最近点的位置，所以自动完成并不容易（我知道的任何信息都可用......）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2018-10-30T20:08:11.920

## 更新 10/2018

GET API（见 Haygood 的回答）似乎已经过时，但有些调用似乎仍然有效。

**基本网址：**

更改为[http://www.google.com/maps（map.google.com/maps](http://www.google.com/maps)仍然有效，但会重定向）

**参数：**

*   q：被忽略，可以跳过 [更多谷歌街景代码解释](http://mapki.com/wiki/Google_Map_Parameters)

*   layer：该参数必须设置为*c*（不再支持*t并破坏它）*

*   cbll：**经纬度（不变）**
*   cbp：仅支持参数 2（旋转角度）和 5（俯仰角）

    1.  被忽略，可以是 0 或空字符串

    2.  **旋转角度/方位（度）**

    3.  被忽略，可以是 0 或空字符串

    4.  被忽略，可以是 0 或空字符串

    5.  **俯仰（度数）-90（直线向上）到 90（直线向下）**

更新示例：[http ://www.google.com/maps?layer=c&cbll=31.335198,-89.287204](http://www.google.com/maps?layer=c&cbll=31.335198,-89.287204)

或[http://www.google.com/maps?layer=c&cbll=31.335198,-89.287204&cbp=,30,,,20](http://www.google.com/maps?layer=c&cbll=31.335198,-89.287204&cbp=,30,,,20)旋转 30 和间距 20。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2019-07-03T12:27:13.113

**更新 07/2019**：

截至目前，10/2018 的解决方案仍然适用于我，但我找到了一种官方记录的方式来构建街景 URL：

**形成街景 URL**

[https://www.google.com/maps/@?api=1&map_action=pano¶meters](https://www.google.com/maps/@?api=1&map_action=pano&parameters)

**参数**

*   **map_action=pano**（必需）：指定要显示的视图类型。地图和街景共享同一端点。为确保显示全景图，必须将动作指定为全景图。

还需要以下 URL 参数之一：

*   **视点**：查看器显示最接近视点位置拍摄的全景图，指定为以逗号分隔的纬度/经度坐标（例如 46.414382,10.013988）。由于街景图像会定期刷新，而且每次拍摄的照片位置可能略有不同，因此您的位置可能会在图像更新时捕捉到不同的全景图。

*   **pano**：要显示的图像的特定全景 ID。如果你指定一个全景，你也可以指定一个视点。仅当 Google 地图无法找到全景 ID 时才使用视点。如果指定了 pano 但未找到，并且未指定视点，则不显示全景图像。相反，谷歌地图以默认模式打开，显示以用户当前位置为中心的地图。

以下 URL 参数是可选的：

*   **航向**：指示相机的罗盘航向，以从北顺时针的度数为单位。可接受的值为 -180 到 360 度。如果省略，则根据查询的视点（如果指定）和图像的实际位置选择默认标题。

*   **pitch**：指定相机的角度，向上或向下。俯仰角以 -90 到 90 度为单位指定。正值将使摄像机向上倾斜，而负值将使摄像机向下倾斜。默认间距 0 是根据拍摄图像时相机的位置设置的。因此，0 的间距通常是水平的，但并不总是水平的。例如，在山上拍摄的图像可能会呈现非水平的默认间距。

*   **fov**：确定图像的水平视野。视野以度数表示，范围为 10 - 100。默认为 90。在处理固定大小的视口时，视野被认为是缩放级别，数字越小表示缩放级别越高.

**示例 1：仅使用视点指定位置。**

[https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=48.857832,2.295226&heading=-45&pitch=38&fov=80](https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=48.857832,2.295226&heading=-45&pitch=38&fov=80)

来源：[https](https://developers.google.com/maps/documentation/urls/guide) ://developers.google.com/maps/documentation/urls/guide （滚动到底部查看街景网址）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-04-27T22:46:08.987

您可以通过按街景顶部的链接按钮获取值。

# rest - REST 返回一个对象图

> ID：387943
> 
> 赞同：10
> 
> 时间：2008-12-23T01:46:53.240
> 
> 标签：rest, object, composite

我是 REST 架构设计的新手，但我认为我已经掌握了它的基础知识。

我从 RESTful 调用返回对象时遇到问题。如果我发出诸如[http://localhost/](http://localhost/) {type A}/{id} 之类的请求，我将从数据库中返回一个具有指定 ID 的 A 实例。

我的问题是当 A 包含 B 对象的集合时会发生什么？目前，我生成的 XML 返回 A，其中包含 B 对象的集合。可以想象，如果 B 类型有一个 C 对象的集合，那么返回的 XML 最终将是一个相当复杂的对象图。

我不能 100% 确定，但这感觉违反了 RESTful 原则，A 的 XML 应该将 A 的字段等以及 URI 的集合返回到它拥有的 B 的集合。

抱歉，如果这有点令人困惑，我可以尝试详细说明。这似乎是一个相对基本的问题，但是我无法确定哪种方法“更”RESTful。

干杯，

艾多斯

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-23T02:41:26.593

一个基本的 RESTful 原则是一切都有一个 URI。

你有这样的URI。

*   /A/ and /A/id/ to get a list of A's and a specific A. The A response includes the ID's of B's.
*   /B/ and /B/id/ to get a list of B's and a specific B. The B response includes the ID's of C's.
*   /C/ and /C/id/ to get a list of C's and a specific C.

You can, through a series of queries, rebuild the A-B-C structure. You get the A, then get the relevant B's. When getting a B, you get the various C's that are referenced.

* * *

*Edit*

Nothing prevents you from returning more.

For example, you might have the following kinds of URI's.

*   `/flat/A/id/`, `/flat/B/id/` and `/flat/C/id/` to return "flat" (i.e., no depth) structures.

*   `/deep/A/id/`, `/deep/B/id/` and `/deep/C/id/` to return structures with complete depth.

The `/deep/A/id/` would be the entire structure, in a big, nested XML document. Fine for clients that can handle it. `/flat/A/id/` would be just the top level in a flat document. Best for clients that can't handle depth.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T01:54:22.490

没有什么说你的 REST 接口不能是相关的。

1.  /书店/ **{书店ID}**
2.  /bookstore/ **{bookstoreID}** /books
3.  /book/ **{bookID}**

基本上，您与您的数据库模式有 1:1 的对应关系。

除了形成子列表的多对多关系。例如，/bookstore/657/books 应该返回书籍 ID 或 URL 的列表。然后，如果您想要特定书籍的数据，您可以调用第三个 URL。

这只是我的想法，请辩论是非曲直。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-23T06:29:03.420

Make a flat Universe that you expose to the world.

Even when I use SOAP, which can easily handle hierarchical object graphs up to whatever depth, I flatten the graph and link everything with simple IDs (you could even use your database IDs, although the idea is that you want you don't want to expose your PKs to the world).

Your object universe inside your app is not necessarily the same one you expose to the world. Let A have children and let B have children, but there's no need to reflect that in the REST request URLs.

Why flatten? Because then you can do things like fetch the objects later by ID, or send them in bursts (both the same case, more or less)... And better than all that, the request URIs don't change when the object hierarchy changes (object 37252 is always the same, even when it's been reclassed).

**Edit: Well, you asked for it...** Here's the architecture I ended up using: package: server - contains the superclasses that are shared between the front-end server and the back-end server

package: frontEndServer - contains a Server interface which the front-end server must adhere to. The interface is nice because if you decide to change from SOAP to a straight Web client (that uses JSON or whatever, as well), you've got the interface all laid out. It also contains all the implementations for the frontEnd classes that will be tossed to the client, and **all the logic for the interaction between classes except how to talk to the client**.

package: backEndServer - contains a Server interface which the back-end server will adhere to. An example of a Server implementation would be one that talks to a MySql DB or one that talks to an XML DB, but the Server interface is neutral. This package also contains all the classes that the implementations of the Server interface use to get work done, and **all the logic for the backend except for persistence.**

then you have implementation packages for each of these... which include stuff like how to persist for the backend and how to talk to the client for the front end. The front-end implementation package might know, for instance, that a user has logged in, whereas the frontEndServer just knows that it has to implement methods for creating users and logging in.

After beginning to write this up I realize that it would take a while more to describe everything, but here you have the gist of it.

# javascript - 为什么 jQuery 将自己包装在一个函数中？

> ID：387944
> 
> 赞同：14
> 
> 时间：2008-12-23T01:46:54.830
> 
> 标签：javascript, jquery

我正在阅读[jQuery 源代码](http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js)，我想知道为什么整个源文件都包含在一个匿名函数中。

```
(function(){
  ...
})(); 
```

这是否有助于不污染全局命名空间？为什么它在那里以及它是如何工作的？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-23T01:55:38.823

它使用函数体来提供自己的作用域，而不是引入大量可能被外部代码意外更改的全局变量。

例如。

```
(function (){
    var someConstantValue = ...;
    myCoolFunction = function(){ return someConstantValue * 5; }
})();

myCoolFunction(); 
```

如果未引入函数范围，则可能会`someConstantValue`通过引入其他代码（或其他库）而意外更改

```
someConstantValue = someOtherValue; // this won't change the behaviour of myCoolFunction 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-23T01:58:55.587

你是对的，它将防止对全局命名空间的污染。

jQuery 需要的所有变量和函数都是在该函数内部创建的，这样可以防止这些函数和变量溢出到全局命名空间中。如果您查看此代码块：

```
var jQuery = window.jQuery = window.$ = function( selector, context ) {
// The jQuery object is actually just the init constructor 'enhanced'
return new jQuery.fn.init( selector, context );
}; 
```

它实际上是通过将 window.jQuery 和 window.$ 设置为初始化函数来将 jQuery 初始化程序连接到外部世界。这是包装器函数内部的变量在包装器外部直接可用的唯一地方。

还要注意，整个函数是这样包装的 (function,,,)() 它将在文件加载后立即执行该函数。

# multithreading - 启动和停止分叉进程

> ID：387949
> 
> 赞同：0
> 
> 时间：2008-12-23T01:49:45.793
> 
> 标签：multithreading, fork, scheduled-tasks

父进程是否可以在 Unix 中启动和停止子（分叉）进程？

我想实现一个任务调度程序（[见这里](https://stackoverflow.com/questions/369948/event-driven-simulation-class)），它能够同时运行多个进程，我认为这需要单独的进程或线程。

如何停止子进程的执行并在给定时间后恢复它？

（如果这只能通过线程实现，那么线程是如何实现的？）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T02:22:50.483

您可以使用信号编写一个简单的调度程序模仿。如果您有权限，则*停止*信号 (SIGSTOP) 会停止进程的执行，并*继续*信号 (SIGCONT) 继续它。

有了信号，您就不会对“调度”进行任何细粒度的控制，但我猜操作系统级调度程序无论如何都不是这种执行的目的。

检查 kill (2) 和 signal (7) 手册页。在网络上也有许多使用 Unix 信号的指南。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T02:33:07.187

您可以使用信号，但在通常的 UNIX 世界中，使用信号量可能更容易。一旦您将信号量设置为不让其他进程继续进行，调度程序将在正常过程中将其换出；当您清除信号量时，它将准备好再次运行。

当然，你可以用线程做同样的事情；唯一显着的区别是您保存了重量级上下文切换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T02:41:21.290

附带说明：如果您使用的是 signal()，则在不同的 unix 上行为可能会有所不同。如果您使用的是 Linux，请查看信号手册页的“可移植性”部分和*sigaction 手册*页，这是首选。

# objective-c - NSString 属性：复制还是保留？

> ID：387959
> 
> 赞同：334
> 
> 时间：2008-12-23T01:56:34.313
> 
> 标签：objective-c, cocoa, cocoa-touch

假设我有一个使用属性名称调用的`SomeClass`类`string`：

```
@interface SomeClass : NSObject
{
    NSString* name;
}

@property (nonatomic, retain) NSString* name;

@end 
```

我知道名称可能会被分配，`NSMutableString`在这种情况下，这可能会导致错误的行为。

*   对于一般的字符串，使用属性而不是*总是*一个好主意吗？`copy``retain`
*   “复制”的财产是否比这种“保留”的财产效率低？

* * *

## 回答 #1

> 赞同：442
> 
> 时间：2008-12-23T02:23:36.130

对于类型是符合`NSCopying`协议的不可变值类的属性，您几乎总是应该`copy`在`@property`声明中指定。`retain`在这种情况下，您几乎不需要指定。

这就是您要这样做的原因：

```
NSMutableString *someName = [NSMutableString stringWithString:@"Chris"];

Person *p = [[[Person alloc] init] autorelease];
p.name = someName;

[someName setString:@"Debajit"]; 
```

属性的当前值`Person.name`会有所不同，具体取决于是否声明了属性，`retain`或者`copy`——如果属性被标记，则属性会`@"Debajit"`被标记`retain`，但`@"Chris"`如果属性被标记`copy`。

因为在几乎所有情况下，您都希望*防止*在其背后改变对象的属性，所以您应该标记代表它们的属性`copy`。（如果您自己编写 setter 而不是使用`@synthesize`，您应该记住实际使用`copy`而不是`retain`在其中。）

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2008-12-23T02:11:39.163

**NSString 应该使用**副本。**如果它是可变的，那么它会被复制。如果不是，那么它就会被保留。正是您在应用程序中想要的语义（让类型做最好的事情）。**

 *** * *

## 回答 #3

> 赞同：68
> 
> 时间：2012-05-23T07:14:45.567

> ### 对于一般的字符串，使用复制属性而不是保留总是一个好主意吗？

**是的 - 通常总是使用复制属性。**

这是因为您的***NSString 属性***可以传递一个***NSString 实例***或一个***NSMutableString 实例***，因此我们无法真正确定传递的值是不可变对象还是可变对象。

> ### “复制”的财产是否比这种“保留”的财产效率低？

*   如果您的属性被传递一个***NSString 实例***，答案是“**否**”——复制的效率不低于保留。
    *（它的效率并不低，因为 NSString 足够聪明，不会实际执行复制。）*

*   如果您的属性被传递一个***NSMutableString 实例***，那么答案是“**是**” - 复制的效率低于保留。
    *（它的效率较低，因为必须进行实际的内存分配和复制，但这可能是可取的。）*

*   一般来说，“复制”的属性可能会降低效率 - 但是通过使用`NSCopying`协议，可以实现一个复制和保留“一样有效”的类。***NSString 实例***就是一个例子。

> ### 通常（不仅适用于 NSString），我什么时候应该使用“复制”而不是“保留”？

`copy`当您不希望属性的内部状态在没有警告的情况下更改时，您应该始终使用。即使对于不可变对象 - 正确编写的不可变对象也将有效地处理复制（请参阅下一节关于不可变性和`NSCopying`）。

对象可能存在性能原因`retain`，但它带来了维护开销 - 您必须管理代码外部内部状态更改的可能性。正如他们所说 - 最后优化。

> ### 但是，我写我的类是不可变的——我不能只是“保留”它吗？

不使用`copy`。如果您的类真的是不可变的，那么最好实现`NSCopying`协议以使您的类在`copy`使用时返回自身。如果你这样做：

*   您班级的其他用户在使用`copy`.
*   注释使您自己的`copy`代码更易于维护——`copy`注释表明您真的不需要担心这个对象在其他地方改变状态。

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2013-12-03T15:20:17.070

我尝试遵循这个简单的规则：

*   **当我将它分配**给我的财产时，我是否想保留该对象的**价值？**使用**复制**。

*****   我是否想持有该**对象**并且**我不在乎它的内部价值**目前是什么或将来会是什么？使用**强**（保留）。**** 

 ****举例说明：我要坚持“丽莎米勒”这个**名字（***复制*）还是我要坚持丽莎米勒这个**人**（*强*）？她的名字以后可能会更改为“Lisa Smith”，但她仍将是同一个人。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2012-09-20T08:17:45.557

通过这个例子，复制和保留可以解释如下：

```
NSMutableString *someName = [NSMutableString stringWithString:@"Chris"];

Person *p = [[[Person alloc] init] autorelease];
p.name = someName;

[someName setString:@"Debajit"]; 
```

如果该属性的类型是副本，则

`[Person name]`将为保存字符串内容的字符串创建一个新副本`someName`。现在对 string 的任何操作`someName`都不会影响`[Person name]`.

`[Person name]`和`someName`字符串将有不同的内存地址。

但在保留的情况下，

两者都`[Person name]`将保存与 somename 字符串相同的内存地址，只是 somename 字符串的保留计数将增加 1。

因此 somename 字符串中的任何更改都将反映在`[Person name]`字符串中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-05-21T21:52:57.073

面对使用面向对象的环境，堆上的对象是通过引用传递的，肯定在属性声明上放置“副本” - 您在这里获得的好处之一是，当更改对象时，对该对象的所有引用查看最新更改。许多语言提供'ref' 或类似的关键字以允许值类型（即堆栈上的结构）从相同的行为中受益。就个人而言，我会谨慎使用复制，如果我觉得应该保护属性值免受对其分配对象的更改，我可以在分配期间调用该对象的复制方法，例如：

```
p.name = [someName copy]; 
```

当然，在设计包含该属性的对象时，只有您知道设计是否受益于分配复制的模式 - [Cocoawithlove.com](http://cocoawithlove.com/2010/06/assign-retain-copy-pitfalls-in-obj-c.html)有以下说法：

*“当 setter 参数可能是可变的但您不能在没有警告的情况下更改属性的内部状态*时，您应该使用复制访问器” - 因此，您是否可以忍受值意外更改的判断完全是您自己的。想象一下这个场景：

```
//person object has details of an individual you're assigning to a contact list.

Contact *contact = [[[Contact alloc] init] autorelease];
contact.name = person.name;

//person changes name
[[person name] setString:@"new name"];
//now both person.name and contact.name are in sync. 
```

在这种情况下，不使用副本，我们的联系人对象会自动获取新值；但是，如果我们确实使用了它，我们必须手动确保检测到并同步更改。在这种情况下，可能需要保留语义；在另一种情况下，副本可能更合适。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-07T03:10:41.400

```
@interface TTItem : NSObject    
@property (nonatomic, copy) NSString *name;
@end

{
    TTItem *item = [[TTItem alloc] init];    
    NSString *test1 = [NSString stringWithFormat:@"%d / %@", 1, @"Go go go"];  
    item.name = test1;  
    NSLog(@"-item.name: point = %p, content = %@; test1 = %p", item.name, item.name, test1);  
    test1 = [NSString stringWithFormat:@"%d / %@", 2, @"Back back back"];  
    NSLog(@"+item.name: point = %p, content = %@, test1 = %p", item.name, item.name, test1);
}

Log:  
    -item.name: point = 0x9a805a0, content = 1 / Go go go; test1 = 0x9a805a0  
    +item.name: point = 0x9a805a0, content = 1 / Go go go, test1 = 0x9a84660 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-29T18:33:07.610

你应该一直使用**copy**来声明 NSString 属性

```
@property (nonatomic, copy) NSString* name; 
```

您应该阅读这些以获取有关它是返回不可变字符串（如果传递了可变字符串）还是返回保留字符串（如果传递了不可变字符串）的更多信息

[NSCopying 协议参考](https://developer.apple.com/library/mac/documentation/cocoa/reference/foundation/Protocols/NSCopying_Protocol/Reference/Reference.html)

> 当类及其内容不可变时，通过保留原始副本而不是创建新副本来实现 NSCopying

[值对象](http://www.objc.io/issue-7/value-objects.html)

> 所以，对于我们的不可变版本，我们可以这样做：

```
- (id)copyWithZone:(NSZone *)zone
{
    return self;
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-08-05T22:30:34.630

由于 name 是 (immutable) `NSString`，如果将另一个设置`NSString`为 name，则复制或保留没有区别。换句话说，复制的行为就像保留一样，将引用计数增加一。我认为这是对不可变类的自动优化，因为它们是不可变的，不需要克隆。但是当 a`NSMutalbeString` `mstr`设置为 name 时，`mstr`为了正确起见，会复制 of 的内容。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2015-01-17T17:11:39.393

如果字符串非常大，则复制将影响性能，并且大字符串的两个副本将使用更多内存。

# sql-server-2005 - 无法从 Vista x64 Windows 服务连接到 SQL Server 2005 Db

> ID：387966
> 
> 赞同：1
> 
> 时间：2008-12-23T02:00:14.647
> 
> 标签：sql-server-2005, windows-services, windows-vista, permissions

我正在尝试从在 Vista Home Premium x64 中运行的 .NET Windows 服务连接到远程 SQL Server 2005 db。我可以毫无问题地从控制台应用程序访问远程数据库。我可以毫无问题地从 Windows 服务连接到本地数据库。我能够毫无问题地从 XP 服务连接。没有运行防火墙或防病毒软件。如何配置此服务以能够连接到远程数据库？

我尝试通过将 Windows 服务作为本地管理员帐户、LocalSystem、LocalService 和 NetworkService 运行来进行连接。

连接字符串：

数据源=SERVER_NAME；初始目录=DB_NAME；集成安全=True；

错误：

建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：命名管道提供者，错误：40 - 无法打开与 SQL Server 的连接）

更多信息：

我也尝试使用 SQL Server 身份验证进行连接，但没有成功：

数据源=SERVER_NAME；用户ID=USER_ID；密码=PWD；初始目录=DB_NAME

此连接字符串也适用于控制台应用程序。

更多信息：

我为 Windows 服务和控制台应用程序运行进程监视器。Windows 服务显示 \SERVER_NAME\pipe\sql\query 被拒绝访问，但控制台应用程序在读取/写入文件到 \SERVER_NAME\pipe\sql\query 时显示成功。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T06:22:29.860

好主！为什么这个网站上所有的胡言乱语和复杂的反应。创建
本地或域用户帐户，并将服务设置为使用该帐户。然后进入您的 SQL Server 并将您的新帐户添加到数据库并设置权限。瞧！

哦，是的，不要用 SQL 身份验证来困扰自己。集成安全性更容易维护，并且在 web.config 中没有密码更安全。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T03:11:55.063

1）打开命令提示符。键入“ping SERVER_NAME”。它有反应吗？如果这不起作用，您可能会遇到 DNS 或连接问题。

2）“远程登录服务器名称 1443”。您是否看到任何东西，或者它是否拒绝您的连接？这将明确告诉您是否有人在另一端收听。

3) 进入 SQL Server Management Studio。右键单击服务器的属性。从左侧选择“连接”。是否选中了“允许远程连接”？

4) 由于您使用网络服务/系统运行，您需要确保在服务器上为机器帐户 DOMAIN\CLIENTSYSTEMNAME$ 配置了登录名。注意 $ 符号。这是您的计算机帐户，这将是 SQL Server 将看到的用户。

# vb.net - 你如何实施？帮助，用户点击哪里？然后单击控件以获得更多帮助？

> ID：387972
> 
> 赞同：0
> 
> 时间：2008-12-23T02:04:30.147
> 
> 标签：vb.net

我什至不知道这叫什么。但是一些 Windows 应用程序曾经有一个“？” 在右上角的 X 附近。您可以单击它，然后单击屏幕上的某些内容并获得帮助。

任何人都知道这叫什么或者（更好）有任何关于如何实现它的指示的指针？

哦，我正在使用 vb.net 2005。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T02:18:15.937

它被称为“这是什么？” 帮助。

这是一篇关于在 Visual Basic 中实现它的 Microsoft 文章。如果您想要另一种语言，我希望这足以让您到达那里。

[如何实施“这是什么？” Visual Basic 帮助](http://support.microsoft.com/kb/142249)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T02:17:02.990

在 .NET 中，您可以通过在表单控件上设置布尔字段“HelpButton”来打开它。有关更多信息，请参阅[此链接](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.helpbutton.aspx)。此外，单击此按钮会触发一个事件。链接[在这里](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.helpbuttonclicked.aspx)。

希望对您有所帮助...您使用的是 .NET 还是其他东西？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T02:12:22.500

它被称为[上下文相关帮助](http://en.wikipedia.org/wiki/Context-sensitive_help)；这就是我所知道的一切。

# python - 打印一份拥有多个家庭的人员列表，每个家庭拥有多个电话号码

> ID：387991
> 
> 赞同：2
> 
> 时间：2008-12-23T02:15:08.423
> 
> 标签：python, django, django-templates

我有一个 Person 类，它可以有多个 Home，每个 Home 都有一个或多个电话号码。

我已经定义了类，但是现在我正在尝试创建一个视图，其中列出了每个人，包括所有家庭和每个家庭地址的所有电话号码......类似于：

```
john smith
123 fake str
  305-99-8877
  305-99-8876
321 oak road
  444-98-7654

peter guy
453 north ave... 
```

到目前为止，我有这样的事情：

（根据我的意见.py）

```
def ViewAll(request):
  people = Person.objects.all()
  render_to_response('viewall.html', {'people': people}) 
```

（在我的模板上）

```
{% for guy in people %} 
  {{ guy.name }}
  {% if person.home_address_set.all %}
    {{ home_address }}

    {% for ?????? in ???? %}
      #print phone numbers in each home
    {% endfor %}

  {% endif %}
{% endfor %} 
```

任何想法如何写我失踪的？当然，如果有另一种方式（更好更优雅或更有效的方式）来做我需要的事情，我很想听听。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T02:25:53.753

您似乎拥有三个嵌套集合：Person、Home、Phone Number。

第 1 步 - 你将如何在视图函数中编写它？

```
for p in Person.objects.all():
    print "person", p
    for h in p.home_address_set.all():
         print " home", h
         for ph in h.phone_set.all():
             print "  phone", ph 
```

不要省略这一步。如果你不能让它在视图函数中工作，那么你的模型是错误的。花点时间把这部分做好。

第 2 步 - 将其转换为模板语法。

```
{% for p on people %}
    {% for h in p.home_address_set.all %}
        {% fpr ph in h.phone_set.all %}
        {% endfor %}
    {% endfor %}
{% endfor %} 
```

结果应该与您的视图功能相同。****************