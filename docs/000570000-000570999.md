# StackOverflow 问答 000570000-000570999

# visual-studio-2008 - .lib 文件未创建（VS2008）

> ID：570013
> 
> 赞同：11
> 
> 时间：2009-02-20T15:34:37.877
> 
> 标签：visual-studio-2008

我在我的解决方案中添加了一个 dll 项目，并由一个可执行项目明确引用它。可执行文件抱怨它找不到库。

任何想法如何设置项目以创建所需的 lib 文件？并且可能为什么该项目不会创建一个？！？

干杯

**注意** 我已经搜索了项目，并且没有在任何地方创建文件。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T15:49:41.973

在 DLL 项目的 Linker -> Advanced 属性选项卡中，验证 Import Library（您要查找的 .lib 文件）的值是否正确/合理。此属性的值将确定导入库的名称以及链接器将其写入的位置。

您可能还需要在项目中生成导入定义文件 (.def)，或检查头文件并确保在头文件中使用 __declspec(dllexport) 限定符标记导出的函数。这通常由#define 切换，例如：

```
#ifdef MYAPI_EXPORTS
#define MYAPI_API __declspec(dllexport)
#else
#define MYAPI_API __declspec(dllimport)
#endif

void MYAPI_API foo(int bar); 
```

基本上，您希望编译器在构建库时看到 dllexport，但当您的客户端代码#include 头文件时，您希望看到 dllimport。如果 Visual Studio 生成了基本的项目结构，它可能已经创建了一个合适的#define 来使用。

您不必同时创建 .def 文件并添加 dllexport，只需其中一个即可。我更喜欢后者。此外，如果您选择使用 .def 文件，则需要在库项目的链接器属性中指定它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-22T21:41:05.643

我以前见过这个。而实际上刚刚打的又是最近。如果没有导出任何内容，则不会创建 .lib 文件。导出函数有两种方式。

1) 使用 __declspec(dllexport) 标记函数。

或者

2) 使用 .def 文件列出所有要导出的函数。

解决方案：

1) 通常需要设置编译时标志以激活预处理器块以将一些#define 设置为 __declspec()。其他人在他们的帖子中列出了这一点。

2) 需要设置行 Properties->Linker->Input->Module Definition File。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T15:39:21.953

您是否在 Exe 项目的项目属性->链接器->输入表中包含了 lib 文件。

并确保您在链接器选项卡中包含了附加引用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T15:50:54.483

检查构建 DLL 的项目。如果它没有生成 .lib，那么您可能没有告诉它这样做。您可以在 Properties->General->Configuration Type 中将项目的输出从 DLL 更改为静态库（选择 Static Library .lib）

# javascript - 如何在 Javascript 中重新加载没有 POSTDATA 警告的页面？

> ID：570015
> 
> 赞同：72
> 
> 时间：2009-02-20T15:35:20.307
> 
> 标签：javascript, refresh, reload, postdata

我想使用以下方法重新加载页面：

```
window.location.reload(true); 
```

但我收到 POSTDATA 警告，因为刷新功能想要重新发送以前的 POST 表单数据。如何在没有此警告的情况下刷新我的页面？

更新：我无法控制该项目！我无法解决 POST 本身！

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2009-02-20T15:38:31.347

如果没有警告，您将无法刷新；refresh 指示浏览器重复上一个操作。如果重复最后一个操作涉及重新提交数据，则由浏览器选择是否警告用户。

您可以通过执行以下操作重新导航到具有新会话的同一页面：

```
window.location = window.location.href; 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-02-20T15:46:59.033

仅仅更改`window.location`JavaScript 是**危险**的，因为用户仍然可以点击**返回按钮**并重新提交帖子，这可能会产生意想不到的结果（例如**重复购买**）。PRG 是一个更好的解决方案

[使用发布/重定向/获取 (PRG) 模式](http://en.wikipedia.org/wiki/Post/Redirect/Get)

> 为了避免这个问题，许多 Web 应用程序使用 PRG 模式——而不是直接返回 HTML 页面，POST 操作返回一个重定向命令（使用 HTTP 303 响应代码（有时是 302）和 HTTP“Location”响应标头），指示浏览器使用 HTTP GET 请求加载不同的页面。然后可以安全地为结果页面添加书签或重新加载，而不会产生意外的副作用。

### 客户端

如果您想完全在客户端执行此操作，则需要在刷新之前更改浏览器历史记录：

```
if ( window.history.replaceState ) {
    window.history.replaceState( null, null, window.location.href );
}
window.location = window.location.href; 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2014-10-22T10:46:56.333

我在使用 Rex 的解决方案无法重新加载锚点/哈希 URL（包括 #）时遇到了一些问题...

所以我最终删除了哈希部分：

```
window.location = window.location.href.split("#")[0]; 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-02-19T08:59:40.593

要绕过 POST 警告，您必须使用完整的 URL 重新加载页面。工作正常。

```
window.location.href = window.location.protocol +'//'+ window.location.host + window.location.pathname; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-05-28T14:41:06.603

您可以使用 JavaScript：

```
window.location.assign(document.URL); 
```

在 Firefox 和 Chrome 上为我工作

检查此链接： http: [//www.codeproject.com/Tips/433399/PRG-Pattern-Post-Redirect-Get](http://www.codeproject.com/Tips/433399/PRG-Pattern-Post-Redirect-Get)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-11-19T20:36:31.460

怎么样 window.location.replace(window.location.href);

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-01-22T16:09:48.177

这有效

```
<button onclick="window.location.href=window.location.href; return false;">Continue</button> 
```

没有它就无法工作的原因

```
返回假；
```

是以前它将其视为表单提交按钮。使用明确的 return false ，它不会执行表单提交，而只会重新加载作为先前 POST 到该页面的结果的同一页面。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-20T15:39:41.607

如果您处于完成发布数据的阶段并且只想重新查看页面，您可以只使用 window.location 甚至可以附加一个随机字符串作为查询参数以保证新版本的页。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-06T16:34:06.340

Nikl的版本不传get查询参数，我使用了如下修改版本：

```
window.location.href = window.location.protocol +'//'+ window.location.host + window.location.pathname + window.location.search; 
```

或者在我的情况下，我需要刷新最顶层的页面\框架，所以我使用了以下版本

```
window.top.location.href = window.top.location.protocol +'//'+ window.top.location.host + window.top.location.pathname + window.top.location.search; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-02-11T04:28:16.723

```
<html:form name="Form" type="abc" action="abc.do" method="get" onsubmit="return false;"> 
```

`method="get"`- 解决问题。

`if method="post"`然后只有警告来了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-11-08T14:06:18.260

我编写了一个函数，它可以在不提交后重新加载页面，它也可以使用哈希。

我通过在调用的 URL 中添加/修改 GET 参数来做到这一点，方法是`reload`使用当前时间戳（以 ms 为单位）更新其值。

```
var reload = function () {
    var regex = new RegExp("([?;&])reload[^&;]*[;&]?");
    var query = window.location.href.split('#')[0].replace(regex, "$1").replace(/&$/, '');
    window.location.href =
        (window.location.href.indexOf('?') < 0 ? "?" : query + (query.slice(-1) != "?" ? "&" : ""))
        + "reload=" + new Date().getTime() + window.location.hash;
}; 
```

请记住，如果您想在 href 属性中触发此功能，请以这种方式实现：`href="javascript:reload();void 0;"`使其工作，成功。

我的解决方案的缺点是它会更改 URL，所以这个“重新加载”不是真正的重新加载，而是使用不同查询的加载。尽管如此，它仍然可以满足您的需求，就像对我一样。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-04-25T07:15:43.670

你不必被迫使用 javascript 来做每一件事。许多问题都有像这样的简单解决方案。你可以使用这个棘手的锚：

```
<a href=".">Continue</a> 
```

当然，我知道您可能需要一个自动解决方案，但这在许多情况下会有所帮助。

祝你好运

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-06-17T20:28:28.080

只需使用

```
location.reload(true); 
```

没有`window`。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2018-05-14T14:43:42.430

在 html 中使用元刷新

```
<meta http-equiv='refresh' content='1'> 
```

在 php 中使用元刷新

```
echo "<meta http-equiv='refresh' content='1'>" 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-10-15T20:16:42.303

这是一个应该始终有效且不会删除哈希的解决方案。

```
let currentPage = new URL(window.location.href);
currentPage.searchParams.set('r', (+new Date * Math.random()).toString(36).substring(0, 5));
window.location.href = currentPage.href; 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2018-10-29T10:49:41.957

其他解决方案`window.location`对我不起作用，因为它们根本没有让它刷新，所以我所做的是我使用一个空表单将新的和空的 postdata 传递到同一页面。这是一种基于[此答案](https://stackoverflow.com/a/43482781/4284627)的方法：

```
function refreshAndClearPost() {
    var form = document.createElement("form");
    form.method = "POST";
    form.action = location.href;
    form.style.display = "none";

    document.body.appendChild(form);
    form.submit();    //since the form is empty, it will pass empty postdata
    document.body.removeChild(form);
} 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2009-07-03T09:16:24.263

如果您使用`GET`方法而不是`POST`那么我们不能表单字段值。如果您使用`window.opener.location.href = window.opener.location.href;`，那么我们可以触发 db 并且我们可以获得值，但唯一的问题是`JSP`即使 scriplet 具有表单值，它也不会刷新。

# c# - 将压缩流解压缩到网络位置

> ID：570019
> 
> 赞同：0
> 
> 时间：2009-02-20T15:36:43.410
> 
> 标签：c#

如果我编写一个 Windows 服务，它将通过压缩字节将文件从本地计算机写入网络，然后解压缩为代表网络驱动器的文件流，这会起作用吗？

例如，我压缩了一个本地文件。我设置了一个封装网络路径的文件流对象（例如，网络驱动器可能是 N:/，因此路径是 N:/..../...），然后我将字节解压缩到该文件位置。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T15:43:44.157

是的，它会工作，但它不会为您节省任何东西——您将从本地机器加载未压缩的数据，在内存中压缩，在内存中解压缩，然后将未压缩的数据写入网络位置。您也可以只复制文件。

您将需要该服务以已映射网络驱动器的用户身份运行。请注意，`LocalSystem`服务的默认用户没有映射网络驱动器。

# mysql - 将静态文件转换为 MySQL 条目

> ID：570020
> 
> 赞同：0
> 
> 时间：2009-02-20T15:37:05.297
> 
> 标签：mysql, html, xml, xslt, transform

我正在将大约 4000 个包含 HTML 的文本文件转换为 MySQL 数据库条目。似乎一个简单的方法是在 HTML 中添加几行以使它们显示为 XML 文件，然后将 XML XSLT 转换为 MySQL INSERT 语句。（构建 CSV 也可以，但不太理想，恕我直言）。我已经尝试过这样做，但让我的 XSL 玩得好一点运气不佳。

我在 Windoze 机器上，但可以通过 SSH 连接到我的虚拟主机并运行 PHP，也许是 Perl。希望尽可能自动化。我可以构建文件列表并将其轻松输入脚本。

文件名模式：ab12345.html（数字部分为 3-6 位不等）

文件名内容示例——这是整个文件，没有 HTML 页脚/页眉：

```
<div class="abEntry"><a name="top"><img width="1" height="1" src="images/common/blank.gif"/></a><div id="abEntryTitle"><div id="abEntryTitleText">What does error note "90210 Cannot Do This Thing" mean?</div></div>
            <div class="abEntryParagraph">This error means your McWhopper drive is frazzled. Read me the number off the modem--thats the little boxy thing attached to the big boxy thing--thanks.</div>
        <div class="abEntryDocumentNumber">ab90210</div> 
```

MySQL 列以及我希望它们如何映射回上面的内容

```
EntryID = auto increment
title = contents of #abEntryTitleText
content = contents of #abEntryParagraph
lastupdated = curdate
related = "1"
visible = "1"
sortorder = "0"
userid = "1"
views = "0"
posvotes = "1"
negvotes = "0"
score = null
emailed = null
detectrelated = "1"
metakeywords = null
metadescription = contents of #abEntryDocumentNumber
startdate = curdate
enableexpiry = "0"
expirydate = null
featured = "0"
workflowstatus = "auto_approved" 
```

我尝试过的 XSL：

```
<xsl:transform version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform ">
<xsl:output method="html" indent="no"/>
<xsl:template match="/"><xsl:apply-templates/></xsl:template>
<xsl:template match="content">
<xsl:text>INSERT INTO questions (approved, title, description, publishDate) VALUES </xsl:text><xsl:text>(1, </xsl:text><xsl:value-of select="id(abEntryTitleText)"/><xsl:text>, </xsl:text>
<xsl:copy-of select="node()|@*"/>
<xsl:text>, </xsl:text>TODAY<xsl:text>,1, 1)</xsl:text>
</xsl:template>
</xsl:transform> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T15:50:35.530

我不熟悉 xsl，所以我会使用[php 的 DOM](http://php.net/dom)来解决这个问题。IIRC它可以解析html而不是正确的xml。

www.phpro.org 上的[教程](http://www.phpro.org/examples/Parse-HTML-With-PHP-And-DOM.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T11:27:29.147

您正在寻找从 <div> 元素创建插入语句的 xslt 将是

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:msxsl="urn:schemas-microsoft-com:xslt" 
    exclude-result-prefixes="msxsl">

    <xsl:output method="text" indent="no"/>

    <xsl:template match="div[@class='abEntry']">
INSERT INTO questions (approved, title, content, metadescription, publishDate)
VALUES (1, '<xsl:value-of select="normalize-space(*/div[@id='abEntryTitleText']/text())" />', '<xsl:value-of select="normalize-space(div[@class='abEntryParagraph']/text())" />', '<xsl:value-of select="normalize-space(div[@class='abEntryDocumentNumber']/text())" />', TODAY)
    </xsl:template>

</xsl:stylesheet> 
```

您可以进一步修改它以包含其他常量列值。

之后，您显然需要一个脚本或应用程序来在每个文件上运行 xstl。如果您愿意，我可以在 .Net 中快速编写一些东西，但是如果您有一些其他工具/脚本功能方便，使用它可能会更快。

# c# - 表单在 C# 中失去焦点

> ID：570021
> 
> 赞同：16
> 
> 时间：2009-02-20T15:37:16.903
> 
> 标签：c#, winforms, .net-2.0, focus

这可能是一个简单的 C# 问题，但我需要一个解决方案。

我有两种形式**form1**和**form2**，其中**form1**有一个*button*。*点击*按钮，我想显示**form2**。当**form2**失去焦点时，我想隐藏它（**form2**）。我怎样才能做到这一点？我试图订阅**form2的***LostFocus*事件，但它不起作用。

 **请帮我解决一下这个。

注意——我使用 .Net 2.0

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-20T15:40:29.297

使用`Deactivate`事件处理程序

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-20T15:42:50.460

如果我理解您的问题，我认为您实际上想要捕获停用。主窗体内的按钮处理程序：

```
private void button1_Click(object sender, EventArgs e)
{
    Form childForm = new Form();
    childForm.Deactivate += delegate
    {
        childForm.Close();
    };

    childForm.Show();
} 
```

# math - 以 R 为重点学习应用统计学

> ID：570029
> 
> 赞同：21
> 
> 时间：2009-02-20T15:38:36.667
> 
> 标签：math, r, statistics

我知道麻省理工学院和斯坦福大学已经在网上发布了许多关于他们课程的视频。有人知道应用统计学的课程（有在线视频）吗？

我一直在使用 R 并且该工具（从技术方面）非常简单。但是，在统计方面（回归、递归分区等），我一无所知。我已经阅读了一些应用统计学的课程描述，它似乎正是我正在寻找的课程类型。但是，如果有我可以在线观看的视频，我会更喜欢它（而不是试图找到当地的社区大学）。

有没有学习统计学的好视频？最好关注 R?

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-21T02:18:17.423

刚刚通过[Hacker News找到了](http://news.ycombinator.com/item?id=489361)[斯坦福统计 202](http://stats202.com/)课程，这似乎正是我正在寻找的。[这是一门统计课程，使用 R 和youtube](http://www.youtube.com/results?search_type=&search_query=stats+202)上的完整视频讲座。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-21T00:43:05.157

所以每个人都想给你一本书而不是视频？

看看这些是否符合要求。

*   [康奈尔 INFO 747 类 - 社会和经济数据](http://www.vrdc.cornell.edu/info747/2005/course_outline.html)
*   [多伦多大学，嗯？- 精算学的统计方法](http://www.utstat.toronto.edu/sjaimung/courses/2008-2009/sta2502/main.htm)
*   [俄勒冈大学 - 经济学 421 - 计量经济学](http://economistsview.typepad.com/economics421/)
*   [加州大学伯克利分校 - 离散选择经济学](http://webcast.berkeley.edu/course_details.php?seriesid=1906978197)

[我最初从 Data Wrangling 博客](http://www.datawrangling.com/hidden-video-courses-in-math-science-and-engineering)中得到了一堆这样的链接，但我注意到许多链接都是错误的。截至 2009 年 2 月 20 日，以下链接有效。

如果有您想要涵盖的特定主题，请对此发表评论。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-07-28T15:39:44.433

Although this is a late answer, [Drew Conway has placed a number of R user group videos on Vcasmo](http://www.vcasmo.com/user/drewconway). Sometimes it's very stimulating to see the motivation for an application and then the tools that support it, rather than just learning the tools before the application.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T15:43:20.040

我推荐[The R Book](https://rads.stackoverflow.com/amzn/click/com/0470510242)。它很贵，大约 100 美元，但它是我找到的最好的书。超过 900 页，易于阅读。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T15:46:02.047

[S 的现代应用统计](http://www.amazon.co.uk/Modern-Applied-Statistics-S-Computing/dp/0387954570/ref=sr_1_1?ie=UTF8&s=books&qid=1235144546&sr=8-1)很好，[R 的介绍性统计](http://www.amazon.co.uk/Introductory-Statistics-R-Computing/dp/0387790535/ref=sr_1_1?ie=UTF8&s=books&qid=1235144596&sr=8-1)也很好。

R和S之间的差异对我来说可以忽略不计。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-06T22:03:48.850

USGS 去年开设了一门名为 LearnR 的课程。

[http://www.fort.usgs.gov/BRDScience/LearnR.htm](http://www.fort.usgs.gov/BRDScience/LearnR.htm)

它使用克劳利的书作为文本，涵盖了许多主题。一些视频的链接需要从 Learn to learn 更改。我记得主要是前几个。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T18:03:01.497

您可能想看看[Introduction to Statistical Thought](http://www.math.umass.edu/~lavine/Book/book.html)，这是一本带有 R 示例（和练习）的教科书。但是，没有视频讲座。

# java - 将旧版 Web 应用程序迁移到现代框架的建议

> ID：570031
> 
> 赞同：6
> 
> 时间：2009-02-20T15:38:47.787
> 
> 标签：java, web-applications, servlets, migration

我目前正在为一家运行基于 Java Servlet 的遗留 Web 应用程序的公司做一些工作（该系统早于 JSP，尽管他们现在在构建新页面时使用它们）。代码库是一个大杂烩，因为它在一个过时的框架之上构建了大约 10 年。他们在代码库中几乎没有一致性（该应用程序多年来由不同的人开发，其中大部分不再在这里工作），没有 DRY 的概念（每个页面基本上都是从头开始创建的）很多不可读/神秘代码和一般来说非常不一致的基础设施。

因为我一直在这里工作，所以我一直在添加现代功能/尝试稍微清理代码库。我在我暴露的地方添加了一些 jQuery，通过输入验证引入了一些安全性，清理了一些模块以采用不显眼的 JavaScript 原则等。我在这里的工作是关于新模块，所以我不会接触到很多旧的模块逻辑。我试图在他们当前的基础架构下为我的所有工作引入最佳实践，但我不得不调用他们的许多旧代码以使我的东西保持一致。

他们已经到了现在正在考虑对系统进行大规模更新的地步。他们希望提高代码库的可维护性，并尝试转向某种现代框架/MVC 类型的应用程序。许多系统早于 XHTML，带有内联样式标记、javascript:function() 调用、无单元测试、早于 Hibernate 等。在 Servlet 中混合了 out.println html 生成和调用 jsp。

他们一直在研究的一些应用程序包括 Wicket、Struts、Tapestry 和可能的 Grails。问题是，迁移到其中任何一个都可能需要对已经在使用的系统进行大量重写，并且他们无法重新开始。

我的问题是：在保留现有业务逻辑的同时将诸如此类的遗留代码库迁移到更现代的框架的最佳方法是什么（重写已经过测试和工作的东西没有意义）。

正在考虑的一些想法包括：

*   编写一个可以与他们当前的基础设施一起工作的内部模板系统（以一致的方式生成页面）

*   将代码移植到 Tapestry 等框架（重用大量旧代码）

*   使用现代框架从头开始重写系统，但从旧系统复制逻辑（如果可能）

*   保持旧系统不变，只需更新前端页面以使其具有更现代的外观（最好给予时间/金钱等）

在保持逻辑完整的同时，将遗留 Java Servlet 代码更新为现代框架（使用现代实践以方便维护、单元测试、DRY）的最佳方法是什么？

欢迎任何见解。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:50:57.400

重构它，朝着一致的设计风格努力，作为将其移植到在精神上最接近该风格最终成为的框架的初步。

我所说的“重构”是指 - 在战略位置、单元和功能中引入测试，并疯狂地工作以减少重复，依靠这些测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T16:11:15.930

几个月前我问了一个非常相似的问题，一些答案可能对你有用：

[将现有凌乱的 web 应用程序迁移到优雅的 MVC 的最佳方法是什么？](https://stackoverflow.com/questions/40242/what-is-the-best-way-to-migrate-an-existing-messy-webapp-to-elegant-mvc)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T16:00:22.930

这类问题没有明确的答案，但我的主要建议是首先**阅读该主题**。阅读了解他们所谈论内容的人的书籍。

例如，代码完成 (Steve McConnell)，ch。24 重构。

*   保存您开始使用的代码

*   保持少量重构

*   一次做一个重构

*   添加例程、类、修复缺陷时进行重构

*   在干净和丑陋的代码之间定义一个接口

*   ...

您可以使用许多其他资源，包括印刷的和在线的。之后，如果您有更具体的问题，您可以使用 SO 之类的网站来获得比这个更有用的答案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T15:50:02.987

最好的方法：使用现有的应用程序作为功能规范并从头开始构建新的应用程序（在有意义的地方进行一些可能的剪切-粘贴重用或实际的类重用）。

根据我的经验，试图将一个写得不好的遗留应用程序硬塞进一个新的框架中，或者试图用好的代码“包装”垃圾代码只会导致从长远来看更加难以维护和昂贵的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T13:41:12.040

这只是我的意见，因为我认为这个问题是人们付钱给昂贵的顾问来解决的问题（通常最终只是浪费钱！参见 thedailywtf.com 的例子）。

我认为它不值得完全重写，因为在重写过程中，您可能还必须维护原始应用程序*，因此重写将有一个移动的目标。更好的方法是在重构时还清代码债务 - 即，实现一个简单功能需要 2 倍、3 倍甚至 10 倍的努力，仅仅是因为以一种好的方式进行涉及重构堆。但是这种努力是必要的，因为这个应用程序所欠的债务很高，最终必须以某种方式偿还。

它可能会痛，但好药会痛。

*   如果您有大量时间进行重写，即原始应用程序被冻结且未维护（甚至没有错误修复），那么它可能会作为您认为合适的任何框架的完全重写。但我非常怀疑任何机构都会出现这种情况。

# wpf - WPF DataBinding - 从重复的控制按钮触发事件

> ID：570037
> 
> 赞同：1
> 
> 时间：2009-02-20T15:39:38.800
> 
> 标签：wpf, data-binding, event-handling

根据[我关于一般绑定的问题](https://stackoverflow.com/questions/545366/wpf-bind-datatable-to-repeated-user-controls)，我想就以下情况寻求帮助。

我有一个通过 ListBox 控件中的 DataTemplate 显示的对象集合（imageFileData）。该控件绑定到 ObservableCollection。集合和模板都在我的应用程序 xaml 和 xaml.cs 文件中定义。向集合中动态添加项目按预期工作，并在我的列表框中显示一个新的模板项目。好的。

我想做的一件事是通过单击 DataTemplate 中定义的按钮从集合中删除特定项目。为按钮定义 Click 处理程序允许我处理事件，但我不知道从哪里获取与模板化按钮相关的 imageFileData 对象。我的按钮事件处理程序显然将按钮作为发送者和一组 RoutedEventArgs 传递，但我无法弄清楚如何将这些数据与集合中的项目相关联，以便允许我将其删除。

任何人都可以帮我解决这个问题，还是因为我不知道从哪里开始，所以我注定要在谷歌搜索中进行尴尬而毫无结果的搜索？;)

谢谢ZS

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T15:46:58.627

用于生成项目的数据将位于`Button`'s中`DataContext`（它从容器继承 -`ListBoxItem`在您的情况下为 a ）：

```
private void ButtonClicked(object sender, EventArgs e)
{
    var button = sender as Button;
    var imageFileData = button.DataContext as ImageFileData;

    ...
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T13:45:27.897

另一种方法是将可视化树向上移动到 a `ListBoxItem`（包含您在 中定义的所有元素`datatemplate`）。当您拥有`ListBoxItem`包含单击的按钮时，您可以轻松获取和删除`ListBoxItem`.

在[此处](http://marlongrech.wordpress.com/2007/12/28/drag-drop-using-listboxes-part-1/)`GetObjectDataFromPoint`和[此处](http://www.wpftutorial.net/DragAndDrop.html)可找到向上遍历视觉树的示例`FindAncestor`。

# perl - 为什么我的 DBI 程序抱怨“未定义的子例程 &DBD::Pg::db::_login”？

> ID：570040
> 
> 赞同：1
> 
> 时间：2009-02-20T15:39:47.240
> 
> 标签：perl, login, dbd

我正在尝试使用 PostgreSQL 数据库来存储 Apache 的会话信息，但我无法让它工作。它失败并出现以下错误：

```
 Undefined subroutine &DBD::Pg::db::_login 
```

似乎 MySQL 用户在 DBD::MySQL::db 中遇到了同样的问题。我有 DBI 和 DBD::Pg 的最新 CPAN 版本。模块中似乎没有该`_login`功能。任何想法如何解决这个问题？我感谢您的帮助！

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:57:33.843

回顾历史，从来没有`_login`在包中定义过名为的 Perl 方法`DBD::Pg::db`（在 Pg.pm 中定义），并且调用是显式的`DBD::Pg::db::_login()`。

这是一个猜测，但我认为这`_login`是一个通过 XS 绑定的 C 函数，这就是为什么您无法在模块中找到它的源代码的原因。这表明它正在尝试使用的 Postgres 库存在一些问题。

# c# - 使用 C# 获取服务器和映射驱动器的 ACL 列表

> ID：570042
> 
> 赞同：15
> 
> 时间：2009-02-20T15:40:07.597
> 
> 标签：c#, .net, security, permissions, security-roles

我们 IT 组的生产变更实施人员的任务是审查我们组中所有各种对象的安全性，主要是确保离开我们的员工或转移到其他组的人不再有权访问我们的服务器共享、web 目录、sql 数据库等。我们最近完成了 SQL 部分，并且我们有一个可重复使用的脚本，可以每年运行一次（或以我们想出的任何频率运行）。它工作得很好，我们在几分钟内审计了 10 台左右的服务器上的 20 个数据库。

现在，对于服务器的东西。我有一个使用 .NET 2.0 在 C# 中编写的应用程序，它将递归地扫描目录列表并将 ACL 转储到文本文件中。这很好用。在本地机器上。UNC 和映射路径不起作用，我收到以下异常消息：进程不具备此操作所需的“SeSecurityPrivilege”权限。

在这条线上：

```
DirectorySecurity DirSec = di.GetAccessControl(AccessControlSections.All); 
```

其中 di 是从 DirectoryInfo[] 数组枚举的 DirectoryInfo 对象。

我们不太可能被授予 SeSecurityPrivilege 特权。但是我不认为这应该是必要的。我可以打开文件夹并右键单击属性，然后单击安全选项卡并在 GUI 中查看它。我*也应该*能够以编程方式访问它。

关于如何更改这部分代码以获取目标文件夹的权限的任何想法？

```
private void CheckSecurity(DirectoryInfo[] DIArray)
{
    foreach (DirectoryInfo di in DIArray)
    {
        DirectorySecurity DirSec = di.GetAccessControl(AccessControlSections.All);
        string sAccessInfo = string.Empty;

        foreach (FileSystemAccessRule FSAR in DirSec.GetAccessRules(true, true, typeof(System.Security.Principal.NTAccount)))
        {
            sAccessInfo += GetAceInformation(FSAR);
        }

        if (sAccessInfo != string.Empty)
        {
            // Write info to text file
        }
    }
}

private string GetAceInformation(FileSystemAccessRule ace)
{
    StringBuilder info = new StringBuilder();
    string line = string.Format("Account: {0}", ace.IdentityReference.Value);
    info.AppendLine(line);
    line = string.Format("Type: {0}", ace.AccessControlType);
    info.AppendLine(line);
    line = string.Format("Rights: {0}", ace.FileSystemRights);
    info.AppendLine(line);
    line = string.Format("Inherited ACE: {0}", ace.IsInherited);
    info.AppendLine(line);
    return info.ToString();
} 
```

编辑：当获取根文件夹的“GetAccessControl()”方法失败时，我将如何检查 ACL 中读取属性的远程文件夹？（如果我传入 \server\path，则会在获取 \server\path 的信息时出错）。

用户帐户是域帐户，我有权读取文件结构。我可以从文件夹/文件的属性中查看安全性。

我将检查进程监视器，但我不确定我是否能够在服务器上运行它（我不是相关服务器的管理员）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-22T07:03:01.567

由于“审核”选项卡，您会收到错误，但我很确定您真正想要在屏幕上访问的只是“权限”选项卡上的数据。SeSecurityPrivilege 控制对 SACL 的访问。

尝试改变

```
DirectorySecurity DirSec = di.GetAccessControl(AccessControlSections.All); 
```

到

```
DirectorySecurity DirSec = di.GetAccessControl(AccessControlSections.Access); 
```

那么你应该停止收到错误

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:51:30.847

检查远程文件夹是否授予用户在 ACL 中运行代码读取属性的权限。

还要记住，权限是在远程（服务器）机器上解析的，因此本地组（用户和管理员）成员资格可能不包括在客户端上运行的用户帐户。

在服务器上运行[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx "系统内部")（过滤到有问题的文件夹/文件）可能有助于解决失败原因的详细信息。

# multithreading - TMonitor 同步/Application.ProcessMessages

> ID：570052
> 
> 赞同：2
> 
> 时间：2009-02-20T15:41:54.817
> 
> 标签：multithreading, delphi, synchronization, delphi-2009, tmonitor

我回来了另一个关于线程和同步的问题。想象一个服务器应用程序必须执行一个冗长的操作，而客户端希望他的 GUI 在等待服务器响应时保持响应。我想到了以下模式：

```
TMonitor.Enter (FTCPClient);
try
  WorkerThread := TWorkerThread.Create (SomeLengthyServerOperation);
  while (not WorkerThread.Ready) do
    Application.ProcessMessages;
  DoSometingWithResults (WorkerThread.Result);
  WorkerThread.Free;      
finally
  TMonitor.Exit (FTCPClient);
end; 
```

WorkerThread 是一个从 TThread 派生的简单类，它执行传递给其构造函数的函数，然后终止（Ready=True，结果在 Result 中）。每当单击按钮时，都会执行呈现的代码。

现在我的问题是：如果我非常快速地单击按钮两次，我会收到一些奇怪的错误，看起来很像服务器和客户端之间的通信以某种方式混淆，我想通过锁定 FTCPClient 对象来避免这种情况。Application.ProcessMessages 执行后的事件处理程序在哪个线程中？TMonitor 的锁是每个线程吗？这是否意味着如果我使用 Application.ProcessMessages 锁定不起作用？

我现在无法更好地解释它。我希望有人明白我的意思。如果没有，请随时提出问题。

编辑：对于按钮的禁用和启用：我对客户端代码一无所知。可能是按钮事件处理程序，也可能是其他东西。基本上我想隐藏客户端代码的锁定。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T16:00:12.260

TMonitor 只阻止**不同**的线程获取锁。正在发生的事情是这样的：通过处理来自锁内的消息，您将回到同一个线程中的同一个函数，这导致了对锁的递归获取。然后，您的代码将创建一个新的工作线程，并重新开始循环。您可以禁用该按钮，以便在工作线程完成之前无法再次单击它。**确保在开始处理消息之前**禁用该按钮并使用另一个 try..finally 块以确保它被重新启用。根据其余代码的排列方式，您甚至可能不需要锁。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T15:55:05.127

一些评论：

1.  您的 WorkerThread 听起来就像您刚刚重新实现了[AsyncCalls](http://andy.jgknet.de/blog/?page_id=100)。使用久经考验的实现可能比自己编写更好（除非您这样做是为了学习效果或因为您有非常特殊的要求）。请查看[AsyncCalls](http://andy.jgknet.de/blog/?page_id=100)和[OmniThreadLibrary](http://otl.17slon.com/)。

2.  锁定应该尽可能短，因此将您的整个反应包装到 Monitor.Enter() 和 Monitor.Exit() 中的按钮单击似乎是错误的。这也不是很容易理解的目的。

3.  在持有锁时调用 Application.ProcessMessages() 会带来各种令人讨厌的意外。如果您需要防止重新输入代码，通常最好禁用所有 UI 元素作为 OnClick 处理程序执行的第一件事，并在处理程序完成时重新启用它们。还要注意，锁可以从同一个线程多次进入，它们只能实现*多个*线程的独占访问。

4.  所有的 VCL 都在主 GUI 线程中执行，因此只有当您从后台线程调用相同的代码时才需要锁定。

5.  如果你看一下这段代码，你会发现你可以通过在 GUI 线程中工作而不是产生一个工作线程来实现同样的事情。

我已经在 StackOverflow 上多次发布了此链接，但请考虑遵循[此列表发布](http://newsgroups.cryer.info/borland/public.delphi.internet.winsock/200507/0507273541.html)中的建议，以了解在进行多线程编程时要记住的一些事项。它有一些很好的建议，尤其是关于第五点。

**编辑：**很难准确地说，但你的代码应该是这样的：

```
procedure TForm1.ActionStartExecute(Sender: TObject);
begin
  ActionStart.Enabled := FALSE;
  fWorkerThread := TWorkerThread.Create (Handle, SomeLengthyServerOperation);
end;

procedure TForm1.ActionStartUpdate(Sender: TObject);
begin
  ActionStart.Enabled := fWorkerThread = nil;
end;

procedure TForm1.WMThreadFinished(var AMsg: TWMThreadFinishedMsg);
begin
  // process results
  fWorkerThread := nil;
end; 
```

TWorkerThread 释放自己，但作为最后一个操作，它向表单发布一条消息（这就是它获取窗口句柄作为参数的原因）。在此消息的处理程序中，您将 fWorkerThread 设置为 nil，以便在下一个空闲循环中重新启用该操作。使用 TAction 意味着您不必关心线程创建是由哪个 UI 元素发起的——它们在线程创建时都将被禁用，并在线程完成后重新启用。不需要锁定，并且在线程处于活动状态时不能创建新线程。

# c# - 将动态控件插入控件集合的中间

> ID：570056
> 
> 赞同：5
> 
> 时间：2009-02-20T15:43:05.517
> 
> 标签：c#, asp.net, user-controls, dynamic-controls

这是我的第一篇文章！我非常绝望，所以我超越了我的标准谷歌搜索。我相信这是一个高级或专家级的 .NET 问题。

问题是我已经构建了一个 .NET Web 应用程序，它需要能够将用户控件动态插入到列表的中间。我对动态控件很满意，只要将它们添加到列表的末尾（即：我熟悉这样的文章：http: [//msdn.microsoft.com/en-us/library/ ms972976.aspx](http://msdn.microsoft.com/en-us/library/ms972976.aspx)）。但是，如果我需要将 UserControl 添加到 Controls 集合的前面或中间的某个位置，我几乎会迷失方向，因为控件的 UniqueID 被丢弃了。

作为一个简化的示例，假设我有一个面板，我正在向其中添加一个名为 MyControl.ascx 的用户控件列表。我还有一些可以在页面上触发的事件，需要将 MyControl.ascx 动态插入到面板控件集合的指定索引中。我还需要订阅 MyControl.ascx 上的一个或多个事件。这意味着需要在这些控件上的事件触发之前加载控件，否则它们将不会触发。如果您不知道我指的是什么，那么我要么措辞不佳，要么这个问题对您来说太难了:)

下面是一些 C# 伪代码来演示该问题。问题是 Controls.AddAt(index, control) 方法不会相应地调整控件的 UniqueID 值。例如，考虑 Controls 集合中的以下控件：

无论我是否实际编写直接依赖于 UniqueID 的代码，.NET 都间接使用 UniqueID 将在前一个回发中触发的事件与在新回发中加载的控件链接在一起。以我之前的例子：

在初始`Page Load (Page.IsPostback == false)`

```
<table>
  <tr>
    <td width='100'>Control index</td>
    <td width='75'>UniqueID</td>
    <td>Value</td>
  </tr>
  <tr>
    <td>0</td>
    <td>ctl00</td>
    <td>value1</td>
  </tr>
  <tr>
    <td>1</td>
    <td>ctl01</td>
    <td>value2</td>
  </tr>
  <tr>
    <td>2</td>
    <td>ctl02</td>
    <td>value3</td>
  </tr>
</table> 
```

`Page.IsPostback == false`在某个其他控件想要在索引 0 处插入控件的回发 ( ) 之后：

如果我这样做，`Controls.AddAt(0, newControl)`那么 Controls 集合看起来像这样：

```
<table>
  <tr>
    <td width='100'>Control index</td>
    <td width='75'>UniqueID</td>
    <td>Value</td>
  </tr>
  <tr>
    <td>0</td>
    <td>ctl03</td>
    <td>value0  <== the controls' unique IDs do not shift!</td>
  </tr>
  <tr>
    <td>1</td>
    <td>ctl00</td>
    <td>value1</td>
  </tr>
  <tr>
    <td>2</td>
    <td>ctl01</td>
    <td>value2</td>
  </tr>
  <tr>
    <td>3</td>
    <td>ctl02</td>
    <td>value3</td>
  </tr>
</table> 
```

因此，如果我使用 Value == value0 和 UniqueID == ctl03 单击控件中的链接按钮，则控件将在回发时按以下顺序排序，并且 UniqueID 不会按我想要的顺序排列。这将导致点击事件附加到错误的控件：

```
<table>
  <tr>
    <td width='100'>Control index</td>
    <td width='75'>UniqueID</td>
    <td>Value</td>
  </tr>
  <tr>
    <td>0</td>
    <td>ctl00</td>
    <td>value0  <== the control i wanted to throw the event</td>
  </tr>
  <tr>
    <td>1</td>
    <td>ctl01</td>
    <td>value1</td>
  </tr>
  <tr>
    <td>2</td>
    <td>ctl02</td>
    <td>value2</td>
  </tr>
  <tr>
    <td>3</td>
    <td>ctl03</td>
    <td>value3  <== the actual control to which the event is attached</td>
  </tr>
</table> 
```

如果我不必处理来自这些动态控件的事件，这可能不会成为问题。这是我的代码：

```
// on init i just need to pull the records from the DB, turn them
// into a MyControl.ascx, and then add them to my panel
protected override void OnInit(EventArgs e)
{
    base.OnInit(e);

    // get my List<SomethingFromDB> ordered by value and iterate through, 
    // adding controls to the control collection
    List<SomethingFromDB> myList = remoteService.GetSomeListFromTheDB();
    foreach(SomethingFromDB something in List<SomethingFromDB>)
    {
        // load a new MyControl.ascx
        MyControl myControl = (MyControl )LoadControl("~/Controls/MyControl .ascx");
        // populate the values of myControl with the "something"
        this.populateMyControl(something);
        // dynamically add the control to my panel
        this.myPanel.Add(myControl);     
        // subscribe to event
        myControl.SomeArbitraryEvent += new EventHandler(MyArbitraryHandler);
    }

    // This event gets fired by a magical control on the page and passes a 
    // new SomethingFromDB which needs to be inserted into the DB and then 
    // dynamically inserted into the Controls collection at the specified index
    private void SomeOtherControl_ClickInsert(object sender, MyControlEventArgs e)
    {
        // insert this record into the DB             
        remoteService.InsertIntoDB(e.SomethingFromDB);     
        // dynamically load this control
        MyControl myControl = (MyControl )LoadControl("~/Controls/MyControl .ascx");
        // get the index into which we will be inserting this control
        int index = e.NewIndex;                   
        //dynamically add the control to my panel at the specified index.
        // THIS DOES NOT ADJUST THE UNIQUEID VALUES ACCORDINGLY
        // AND IS THE SOURCE OF MY PROBLEM!
        this.myPanel.AddAt(index, myControl);
    } 
```

请帮忙。这个要死我了。如果您需要更多信息或有疑问，请告诉我，我很乐意提供更多信息。非常感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T16:03:21.317

要使自动编号起作用，您希望在每次回发时以相同的顺序将控件添加到面板中。显然，在回发时，必须为控件分配其唯一 ID，否则您将无法获得控件事件。

`UniqueID`在第一次使用时初始化为`Control.ID`* 属性的值。如您所见，如果未设置该属性，它会自动生成为`ctlxx`。一旦分配，控件`UniqueID`就是只读的。

因此，如果您有某种形式的主键，您可以`ID`在创建控件时根据该主键设置控件的属性。然后`UniqueID`，当页面加载其状态时，将设置为该值。

*   脚注：`UniqueID`属性实际上是命名容器的前缀和`ID` 属性的组合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-05T05:54:46.143

请在页面指令中使用以下属性。

```
MaintainScrollPositionOnPostback = true 
```

我相信这会有所帮助。

# c# - 如何在 PrintPreviewDialog 中捕获打印事件

> ID：570057
> 
> 赞同：0
> 
> 时间：2009-02-20T15:43:11.320
> 
> 标签：c#, printing

我从 C# 中的 PrintPreviwDialog 类继承。我想覆盖工具栏上的打印按钮，以便我可以选择打印机。

不幸的是，带有打印按钮的工具栏控件看起来是私有的，我看不到任何可以覆盖的事件。

必须有一些解决方案来获取打印预览对话框，然后被允许使用 PrintDialog 控件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:44:57.253

看来我只需要使用控件以新形式重新创建我想要的所有功能。PrintPreviewDialog 类毫无价值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-19T20:07:08.170

首先使用 PrintDialog 选择打印机，然后打开 PrintPreviewDialog。

# .net - ASP.NET 2.0 & Web.config：这是正确的吗 ?

> ID：570062
> 
> 赞同：0
> 
> 时间：2009-02-20T15:44:29.147
> 
> 标签：.net, asp.net, xml, web-config

我正在 Web.Config 中添加一个简单的（来自一本书的）修正 -

```
<configuration>
 <appSettings>
   <add key="SupportEmail" value="dfgh@dfghj.com" />. 
 </appSettings>
</configuration> 
```

但是在 web.config 我看到只有以下符号/括号/块（？）：

```
 <appSettings/> 
```

我找不到开口。这不是写块的不正确方式吗？

或者这是一种告诉我我可以修改它并添加我自己的打开和关闭块的方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T15:45:38.350

您确实可以修改它（格式 /> 是一个自闭合标签，如果其中没有任何内容则有效）

# iis - Server 2008 上的 IIS7 身份验证

> ID：570070
> 
> 赞同：1
> 
> 时间：2009-02-20T15:47:12.697
> 
> 标签：iis, iis-7

我最近将运行 IIS6 的 Server 2000 升级到了运行 IIS7 的 Server 2008。服务器是独立的，没有 A/D。我有一个使用 Frontpage 2003 设计的网站，运行 Server Extensions 2003，我还迁移到了我的新 Server 2008。旧服务器上的站点需要用户名和密码，我通过禁用匿名访问来设置允许访问。如何在 Server 2008 上使用 IIS7 做同样的事情？我更喜欢使用 Windows 身份验证。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T15:50:13.377

在站点的身份验证设置中，禁用匿名并启用集成 Windows 身份验证。

# svn - Subversion 分支/主干最佳实践 - 使分支保持最新？

> ID：570071
> 
> 赞同：23
> 
> 时间：2009-02-20T15:47:43.553
> 
> 标签：svn

我的开发团队使用 subversion 已经有一段时间了。管理主干和分支的方式如下：

*   我们（几乎）总是从后备箱中释放

*   每个版本都有自己的分支。

*   当一个版本准备好进行 QA 时，我们将分支合并回主干并为下一个版本创建一个新分支。

*   开发人员在主干或分支上工作，但没有开发人员特定的分支。

最近，我们遇到了一些噩梦般的合并会议，部分原因是应用程序发生了一些重大变化。这些并不总是顺利进行，有时会在 QA 期间弹出问题，其中 subversion 没有完全正确地合并。

一种解决方案可能是定期（例如每周）将主干更改合并到发布分支中，以确保分支中包含最新的主干更改。然后可以更接近实时地修复冲突。

你对这个问题有什么经验？有标准的最佳实践吗？此外，您是否有一个好方法来跟踪哪些修订已合并到分支中（subversion 中的体面评论可能会处理这个问题）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-20T15:58:28.257

首先，在管理代码分支和发布方面，我认为没有一种万能的解决方案。但是从我的角度来谈谈你的一些观点：

*   是的，我会更频繁地将主干中的更改合并到发布分支中。较小的块总是比一个大的集成更易于管理。当然，这意味着您正在使用最新最稳定的代码。

*   主动教导人们如何很好地融合。进行更改的开发人员应该进行（或密切参与）合并。了解您正在服用什么以及服用完毕后应该是什么样子。我经常看到人们在运行集成时并不真正知道他们在做什么以及他们对结果的期望。

*   也许您想要一个不是主干的集成分支。这可以每天进行测试，并且在他们去打破树干并吓唬所有人之前在这里发现任何问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-20T17:47:43.283

所以假设我在这里有你的模型：你在一个可能会变得很旧的分支（离开主干）中对项目进行重大更改。

您继续在始终拥有“实时”软件的主干上进行其他开发，因此这些更改是次要更新和错误修复。当您将不朽的开发分支合并回主干时，您会遇到问题。

您只能使用该模型有效地管理 2 个并发产品版本，这目前可能就足够了，但无论如何可能会以其他方式对您不利，如果您需要管理 3 或 4 个版本，情况会变得更糟。我可以建议颠倒你的工作方式吗？

每个版本都有一个版本分支。这应该从主干分支（在任何版本中）。修改版本分支的唯一方法是合并来自主干的修订。

这意味着您可以主要在主干上工作，而不是在大型开发分支中工作。您还可以将错误修复直接应用于主干 - 因此您没有为下一个版本存储重大集成问题。要发布对以前版本的错误修复，只需将所需的主干修订合并到适当的版本分支中。

这样，您可以将想要发布的所有内容保留在分支中，但实际上只会发布您满意的内容，因为这就是您合并到版本分支中的全部内容。

如果需要，您仍然可以使用开发分支，但您可以将它们保持为有针对性的小型，也许是单个功能，而不是大型项目。

这将允许您以理智的方式管理多个版本，并使用 svn 的合并信息很好地跟踪每个版本中的内容。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-20T15:53:49.017

我们的经验是明确区分：

*   **开发分支**
*   **合并分支**（用于合并开发的分支，我们肯定会投入生产

Trunk 仅用于录制稳定发布的版本，我们可以从中进行分支。

在“开发分支”中，我们可以管理重要的更改，包括一些不会在下一个版本中结束的更改（因为太复杂，没有及时准备好，依赖于其他后期开发，...）

合并分支代表完成发布所需的最后步骤（注意复数）。它发生在会议之后，需要交付的所有功能都经过验证。

我们只将我们确定投入生产的东西合并到“合并分支”中。我们继续那个分支直到最终版本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T16:07:59.340

完全同意 Andy 的观点：没有“一刀切的解决方案”，但问题不应该是让您的发布分支保持最新，而是相反。

良好的变更控制应该可以防止您的分支不稳定。门控问题应在发布分支上修复，然后立即合并到主干。准备好让这个“合并”变得不平凡，发布门控问题甚至可能不存在于主干上，但无论如何您都需要对其进行分析和测试。

从您所说的听起来您正在分支上进行开发，然后在您释放之前立即将所有内容合并到您的主干中，并且只是交叉手指。我想知道您这样做会引入多少错误。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T16:26:39.687

首先，我完全同意之前的响应者的观点，即没有一刀切的解决方案。

在我们的例子中，我们有许多相对较小的应用程序，每个应用程序通常只有一个开发人员。当我们确实参与协作开发时，往往只有 2 到 4 个开发人员。

我们的一般政策是：

*   主干包含当前项目状态；
*   我们使用分支来开发新功能、错误修复等。分支完成后合并回主干；
*   要发布，我们从当前主干创建一个标签并释放该标签。

安迪还提出了一个需要强调的重点：“主动教导人们如何很好地融合。” 我们的许多问题（如果不是大部分的话）似乎都源于糟糕的合并实践。

# sql - SQL IsNumeric 返回 True 但 SQL 报告“转换失败”

> ID：570075
> 
> 赞同：12
> 
> 时间：2009-02-20T15:48:44.300
> 
> 标签：sql, sql-server, tsql

假设以下数据：

```
Column1 (data type: varchar(50))
--------
11.6
-1
1,000
10"    
Non-Numeric String 
```

我有一个查询，它正在从该列中提取数据，并想确定该值是否为数字，然后在我的查询中返回它。所以我正在做以下事情

```
SELECT CASE
       WHEN IsNumeric(Replace(Column1, '"', '')) = 1 THEN Replace(Column1, '"', '')
       ELSE 0
   END AS NumericValue 
```

SQL 正在报告：

> 将 varchar 值“11.6”转换为数据类型 int 时转换失败。

为什么？我也试图强制转换：

```
SELECT CASE
       WHEN IsNumeric(Replace(Column1, '"', '')) = 1 THEN cast(Replace(Column1, '"', '') AS float)
       ELSE 0
   END AS NumericValue 
```

我得到了：

> 将数据类型 varchar 转换为浮点数时出错。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T15:56:35.110

您需要用句点替换逗号：

```
CAST(REPLACE(column, ',', '.') AS FLOAT) 
```

`SQL Server`输出用语言环境定义的小数点分隔符，但除了`CAST`s 中的句点之外什么都不理解为数字类型。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-18T15:12:07.957

首先将字符串转换为货币，然后将其转换为任何其他数字格式，因为货币类型总是给出真正的数字字符串。那时您将永远不会看到错误。

在您的查询中尝试以下内容，您就会知道我在说什么。两者都将返回 2345.5656。Money 数据类型四舍五入到小数点后 4 位，因此转换导致四舍五入到小数点后 4 位。

```
SELECT CAST('2,345.56556' as money), CAST('$2,345.56556' as money) 
```

Cast( cast('2,344' as money) as float) 可以完美运行，或者 cast( cast('2,344' as money) as decimal(7,2)) 也可以。

即使 cast(CAST('$2,345.56556' as money) as int ) 也可以完美地将其四舍五入到最接近的整数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T16:28:18.230

SQL 非数字存在许多问题。例如：

```
select isnumeric('1e5') 
```

这将返回 1 但在许多语言中，如果您尝试将其转换为数字，它将失败。更好的方法是使用您需要检查的参数创建您自己的用户定义函数：

[http://www.tek-tips.com/faqs.cfm?fid=6423](http://www.tek-tips.com/faqs.cfm?fid=6423)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T15:52:30.423

当输入表达式计算为有效整数、浮点数、货币或小数类型时，ISNUMERIC 返回 1；

所以问题是它是一个有效的数字，但不是一个有效的 int。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T15:56:34.687

凯尔，

我认为这可以解决问题。问题在于 ELSE 子句将您的结果初始化为 INTEGER。通过对 FLOAT 进行显式类型转换并添加 Quassnoi 的建议，它似乎有效。

```
DECLARE @MyTable TABLE (Column1 VARCHAR(50))
INSERT INTO @MyTable VALUES('11.6')
INSERT INTO @MyTable VALUES('-1')
INSERT INTO @MyTable VALUES('1,000')
INSERT INTO @MyTable VALUES('10"    ')
INSERT INTO @MyTable VALUES('Non-Numeric String')

SELECT CASE WHEN ISNUMERIC(REPLACE(Column1,'"','')) = 1 THEN REPLACE(REPLACE(Column1,'"',''), ',', '.') ELSE CAST(0 AS FLOAT) END
FROM @MyTable 
```

问候，
利文

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-27T14:15:16.387

`IsNumeric(' ')`也返回 1，但随后 CAST as int 爆炸了。上面的 Brendan 说编写你自己的函数。他是对的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-11-02T23:14:56.987

此解决方案并非在所有情况下都有效（特别是带有货币和/或千位分隔符的数字）。将指数表示连接到由字符串表示的数字的末尾...ISNUMERIC() 从那里可以正常工作。以下示例：

```
-- CURRENT ISNUMERIC RESULTS
SELECT ISNUMERIC('11.6'); --1
SELECT ISNUMERIC ('-1'); --1
SELECT ISNUMERIC('1,000'); --1
SELECT ISNUMERIC('10"'); --0
SELECT ISNUMERIC('$10'); --1

-- NEW ISNUMERIC RESULTS
SELECT ISNUMERIC('11.6'+'e+00'); --1
SELECT ISNUMERIC ('-1'+'e+00'); --1
SELECT ISNUMERIC('1,000'+'e+00'); --0
SELECT ISNUMERIC('10"'+'e+00'); --0
SELECT ISNUMERIC('$10'+'e+00'); --0 
```

这至少标准化了使用 REPLACE() 函数的格式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-04-22T06:41:25.180

我刚刚遇到这个问题。

如果您不介意十进制长度的限制，您可以尝试此解决方案。

```
CONVERT(numeric, CONVERT(money, '.')) 
```

**笔记：**

1.  它在**SQL Server 2008**或更高版本中**受支持。**
***   货币**范围**是：-922,337,203,685,477.5808 到 922,337,203,685,477.5807 -**小数点后四位**。**

 **# java - Netbeans 转发 X11 字体问题

> ID：570076
> 
> 赞同：4
> 
> 时间：2009-02-20T15:49:04.457
> 
> 标签：java, netbeans, fonts, x11, xming

我正在尝试通过 ssh 将我的 IDE Netbeans 转发到我的 Windows 桌面上的 Xming 服务器。我能够让 Netbeans 启动并运行，但字体看起来很糟糕，因为它们没有被抗锯齿。我在[这里](http://www.compucatedsolutions.com/~jmc/badnetbeans.jpg)上传了一个截图。

如果我在 linux 机器上从 Gnome 启动 Netbeans，字体看起来很好，所以它一定是 Xming 或 Windows 字体渲染的问题。有人对如何让 Xming 显示抗锯齿字体有任何想法吗？

**更新：**

我只是在主机上设置了一个字体服务器，但字体仍然在客户端出现像素化。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T19:01:04.543

我最终在启动器脚本中设置了一些 netbeans 命令行选项来强制抗锯齿和强制亚像素字体渲染。这解决了这个问题。

**更新：添加步骤**

我将 /etc/netbeans.conf 下的 netbeans_default_options 设置为：

```
netbeans\_default\_options="-J-client -J-Xss2m -J-Xms32m -J-XX:PermSize=32m -J-XX:MaxPermSize=200m -J-Xverify:none -J-Dapple.laf.useScreenMenuBar=true -J-Dawt.useSystemAAFontSettings=lcd" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T19:23:11.823

Java 在 Linux 上决定是否抗锯齿有点奇怪。

它似乎检测 KDE 或 GNOME 是否正在运行，如果没有，则决定不打扰。

如果您需要其他解决方案，请在启动 netbeans 之前尝试确保“gnome-settings-daemon”正在运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-28T08:04:16.030

如[本博客](http://lovingthepenguin.blogspot.com/2010/12/java-swing-anti-aliased-font-rendering.html)所述，您可以在系统范围内为所有 Swing 应用程序激活[上一个答案](https://stackoverflow.com/questions/570076/netbeans-forwarded-over-x11-font-problem/744988#744988)中提到的选项

```
_JAVA_OPTIONS="-Dawt.useSystemAAFontSettings=lcd" 
```

到您的个人资料。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-09-05T01:50:22.290

我用的是 Mint Linux，下面的配置在这里没问题。

**正确的形式是这样的：**

```
netbeans_default_options="-J-client -J-Xss2m -J-Xms32m -J-XX:PermSize=32m -J-Dapple.laf.useScreenMenuBar=true -J-Dapple.awt.graphics.UseQuartz=true -J-Dsun.java2d.noddraw=true -J-Dsun.zip.disableMemoryMapping=true --laf GTK" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T16:56:58.740

允许 Linux 机器成为 X11 字体服务器并告诉您的 Xming 会话将 Linux 机器用作 X11 字体服务器。

# .net - 返回值数组时的最佳实践 (.NET)

> ID：570083
> 
> 赞同：3
> 
> 时间：2009-02-20T15:50:14.827
> 
> 标签：.net, arrays, generics

通常我的方法如下：

```
public List<int> Method1(int input)
{
    var output = new List<int>();
    //add some items to output
    return output;
} 
```

但是 FxCop 建议使用另一个 IList 实现而不是 List，但我不记得是哪个。替代方法包括将其作为 IList、ICollection 或 IEnumerable 返回，以获得更大的灵活性或完全不同的方式，如下面的代码：

```
public int[] Method2(int input)
{
    var output = new List<int>();
    //add some items to output
    return output.ToArray();
} 
```

在所有备选方案、所有提供的所有可能性中，哪一个被认为是最佳实践？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T15:51:40.597

IEnumerable / IEnumerable <T> 除非你特别需要一个列表，那么你应该返回 IList <T>

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T16:04:07.883

§8.3.1 中的“框架设计指南”（第 2 版）对集合作为返回值有很多话要说，总结：

*   **不要**提供可设置的集合属性。
*   **请**使用for 属性或表示读/写集合的返回值`Collection<T>`的子类。`Collection<T>`
*   **务必**使用`ReadOnlyCollection<T>`、 的子类`ReadOnlyCollection<T>`，或者在极少数情况下`IEnumerable<T>`用于表示只读集合的​​属性或返回值。

（还有更多，但这三个抓住了核心）。

上面的第一个：不要返回对内部集合的引用，除非您希望用户能够更改它（然后您可能应该有一个自定义类型，以便您有一定程度的控制）。

我会返回`IList<T>`并确保我没有定义我返回的实际类型，除非我返回一个迭代器（当我使用 时`IEnumerable<T>`）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-20T16:04:15.700

Eric Lippert 有一篇关于为什么[返回数组通常是个坏主意](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)的好帖子。

通常，您应该尽可能地笼统，而不会给将要调用您的方法的人造成过度的悲伤。更喜欢接口而不是具体类，并选择您可以摆脱的最通用的接口。

返回接口可以更好地封装您的实现，并使将来更容易更改。如果你从一个具体类型开始，你承诺*总是*返回那个类型。

`IEnumerable<T>`是最好的起点。随着 LINQ 的出现，调用者只需给出一个枚举就可以轻松完成很少的事情。如果调用者偶尔需要一个列表，调用`.ToList()`.

如果调用者可能有特定需要索引到返回的集合，或者如果他们可能想要自己修改集合（插入/删除/重新排序项目），请考虑使用`IList<T>`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T15:52:54.510

`ReadOnlyCollection<T>`是另一种选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T15:52:43.713

在调用此方法的代码中返回您需要的接口。

如果您需要对结果执行列表操作，请返回`IList<T>`. 如果您只需要枚举结果，请返回`IEnumerable<T>`.

实际上，这些是我最常用的。除非有充分的理由，否则我从不从公共接口返回数组。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T15:53:13.027

这取决于。

您是否希望调用者能够修改项目并让您看到这些更改？可以修改数组。IList 接口定义了修改方法（但实现可能不允许这样做）。

您能否详细说明 FxCop 警告？

肯特

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T15:54:14.910

这取决于您的要求。综上所述，强类型数组的迭代是所有集合类型中最快的。如果您不需要调整它们的大小/添加/搜索它们，则数组非常好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T15:55:12.367

我几乎总是选择这样做，`List`因为它为我提供了我经常发现最有用的方法。

返回 an 的一个潜在负面后果`IEnumerable`是，在枚举时抛出的任何异常都来自可能与实际构建对象的代码相距甚远的代码区域，从而使错误跟踪变得更加困难。

# command-line - Nant cmd.exe 重定向在 c:\ 驱动器上创建名为“程序”的文件

> ID：570087
> 
> 赞同：1
> 
> 时间：2009-02-20T15:51:10.737
> 
> 标签：command-line, continuous-integration, nant

我有 NAnt 脚本，它作为其项目的一部分使用以下任务调用批处理文件：

```
<target name="makeplane">   
  <exec program="C:\WINDOWS\system32\CMD.EXE" 
      commandline="/C ${make.file} &gt; ${make.log}"          
      verbose="false" 
      workingdir="${make.dir}" 
      basedir="${make.dir}">         
      </exec>
    <delete>
      <fileset basedir="c:\">
        <include name="program" />
      </fileset>
    </delete>
</target> 
```

不幸的是，我无法控制批处理文件上的内容，它会在屏幕上喷出很多垃圾，这些垃圾在日志中没有用。因此，为了解决这个问题，我使用 bat 文件将输出重定向到文本文件

```
 &gt; ${make.log} 
```

相当于“> log.txt”的部分。

这种重定向似乎在 C 驱动器上创建了一个名为“程序”的文件，并弄乱了各种服务，Windows 通常不喜欢它。为了解决这个问题，我在 bat 文件执行后手动删除了这个文件。

问题是我现在需要完全为另一个项目运行类似的任务，如果它们同时运行，那么第一个将锁定名为“程序”的文件，第二个将失败。对于持续集成来说，这并不是一个很好的情况。

我在网上搜索，但因为该文件被称为程序，所以我得到了各种垃圾结果。任何人都对解决方法有任何想法。我在 exec 任务上尝试了输出参数，但问题仍然存在。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T19:21:48.547

如果日志的文件路径包含空格，则通常需要将路径括在引号中。为了在 nant 中执行此操作，可以使用`&quot;`实体。

听起来这就是您的特定情况下正在发生的事情。因此，如果您将示例更改为以下示例，我认为事情应该按预期工作。

```
<target name="makeplane">   
    <exec program="C:\WINDOWS\system32\CMD.EXE" 
        commandline="/C ${make.file} &gt; &quot;${make.log}&quot;"          
        verbose="false" 
        workingdir="${make.dir}" 
        basedir="${make.dir}">         
    </exec>
</target> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T15:56:22.973

通常发生这种情况是因为脚本试图创建一个带有长文件名的文件，其中包含空格（**`c:\program files`**在您的情况下），但它没有在长文件名周围使用引号。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-14T20:53:24.933

这就是我所做的。我认为对于复杂的命令来说它更干净一些。

```
<property name="cmd.label" value="\${ss.previous.label}@$Project.SSPath" />
<echo message="Getting $Project.Name source code with label \${cmd.label}" />
<property name="cmd" value="&quot;\${tfs.root}\tf.exe&quot; get $Project.SSPath &quot;/version:L\${cmd.label}&quot; /force /recursive /noprompt"/>
<exec program="cmd.exe"
  workingdir="\${shadow.dir}"
  failonerror="true"
  verbose="true">
 <arg value="/c" />
 <arg value="&quot;\${cmd}&quot;" />
 <arg value="> nul" />
</exec> 
```

# oracle - 甲骨文应用服务器；组织中的什么角色通常支持中间层？

> ID：570090
> 
> 赞同：0
> 
> 时间：2009-02-20T15:52:11.640
> 
> 标签：oracle, roles, oracleapplications

**在大中型组织中，哪个团队或小组通常支持像 Oracle 应用服务器这样的中间层组件？**

（Unix 团队、DBA 团队或应用程序开发/支持团队）

在客户端服务器应用程序设计中，服务器和客户端之间的所有权划分非常清晰。在客户端服务器的情况下，Unix 管理员管理服务器，开发支持团队管理和支持客户端。（以及 DBA 的支持/管理数据库）

最近在我们店里，线条变得模糊了；推出了 Oracle 应用服务器 (OAS)；

OAS 似乎需要一套非常独特的技能，但也显示出与客户端服务器技能有一些相似之处。（部分 Unix 管理员，部分 Dba，部分应用程序开发人员/客户支持）

**其他人在面对这种挑战时做了什么......？？**

**是否有一个全新的团队形式，专门支持中间层？**

我们的 IT 小组有 3 名 Unix 管理员；3 应用支持人员；3 Dba 给出团队规模的观点......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T16:04:18.600

对于大型组织，您通常最终会得到专门的团队来管理中间层 Web 服务器和应用程序服务器。

小型组织的问题通常是，当您第一次部署应用程序服务器时，可能没有足够的管理工作来证明一个单独的人担任该角色的合理性，此时您必须从其他团队拼凑时间。DBA 管理应用程序服务器并不少见（尤其是 Oracle DBA 管理 Oracle 应用服务器）。Unix 管理员管理应用服务器也不是什么特别的事。不管怎样，一些工作将不可避免地从其他团队的投入中受益。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T03:07:49.870

恕我直言，应该有一个单一的“Oracle”团队，包括 DBA、unix 管理员、应用程序管理员，甚至是大型安装的网络人员。实际上只有一个系统，尽管它有多个层次和技术。当系统故障发生时，您不希望四个团队都推卸责任。问我怎么知道的；）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T03:50:24.993

在我看来，有几种不同的选择：

1) 将其纳入应用程序开发/支持团队，因为这是应用程序的一部分，不一定只有管理员才有用。在某种程度上应该将开发和支持分开，因为可能会使用不同的工具，并且有些工具可能比另一种具有更强的技能，例如，如果一个人更喜欢调查事物，那么支持可能更适合。

2) 平台管理团队是一个独立的团队，公司生产的应用程序所涉及的层是分开的。我曾经在一家公司工作，其中中间层和后端由一个独立于应用程序组的团队管理，如果有计划让中间层和后端层成为公司的平台，这似乎是合适的向其他公司推销，以使用他们认为合适的方式在此 API 之上制作自己的应用程序。

我可以看到使用任何一种方法的逻辑，这取决于人们如何看待 IT 部门在某种意义上提供的东西。

# .net - 如何从 .NET 调查基于 Java 的 Web 服务？

> ID：570096
> 
> 赞同：1
> 
> 时间：2009-02-20T15:53:13.680
> 
> 标签：.net, web-services

我已经将 Java 方法作为 Web 服务公开，我使用 Eclipse 中的 Web 服务资源管理器来调用它，它按预期工作。有关屏幕截图（不是我拍摄的），请参阅[http://soa2world.blogspot.com/2008/05/soap-client-eclipse-web-service.html](http://soa2world.blogspot.com/2008/05/soap-client-eclipse-web-service.html)。

为了确保这也适用于用 .NET 编写的客户端，我想在基于 .NET 的 GUI 中重复相同的练习，因为 WSDL 创建了一个允许我输入值的 GUI 界面（独立或基于 Web），并执行结果。

Visual Studio Express 很好，因为它是免费提供的，而完整的 Visual Studio 需要购买许可证，所以如果我需要它，我需要一个很好的理由 :)

什么是完成这项特定任务的干净、简单的方法？如果它可以进行简单的负载测试，那就太好了:)

谢谢，

* * *

编辑：带有 Visual Web Studio Express 2008 的 WCF 测试客户端只使用 SOAP 1.2。Sun 的 Metro 堆栈只使用 SOAP 1.1。是否有使用 SOAP 1.1 的 WCF 测试客户端版本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:22:29.057

鉴于您的原因，我不确定为什么 Visual Studio express 比完整的 VS.NET 更好。两者都是为基于 Windows 的平台开发的。

您是否查看过 WCF 测试客户端 (WcfTestClient.exe)？您可以在此处找到有关它的更多信息：

[http://msdn.microsoft.com/en-us/library/bb552364.aspx](http://msdn.microsoft.com/en-us/library/bb552364.aspx)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-20T16:27:33.007

这真的很简单，或者当我使用托管在 tomcat 中的基于 Java 的 Web 服务时，我发现它真的很简单。

*   在 Visual Studio 中启动任何类型的新解决方案（应该快速工作）。
*   右键单击项目中的 References 文件夹，然后选择 Service Reference。
*   然后将您的 wsdl 路径放入地址框中，然后单击 Go。
*   这将从 wsdl 检索有关您的 Web 服务的信息，您将能够从中创建 WebService 引用。
*   然后，您可以像使用 Class 一样使用它并调用方法。

对不起，这不是很好的写和深思熟虑，但我目前没有太多时间，祝你好运。

# php - 更改资源的父级 - Zend ACL - 1.7.3

> ID：570097
> 
> 赞同：1
> 
> 时间：2009-02-20T15:53:23.260
> 
> 标签：php, zend-framework, acl

我们的应用程序有以下结构

```
require_once "Zend/Loader.php";
Zend_Loader::registerAutoload();
$acl = new Zend_Acl();

// application
$acl->add(new Zend_Acl_Resource('application1'));
// groups
$acl->add(new Zend_Acl_Resource('group1'), 'application1');
$acl->add(new Zend_Acl_Resource('group2'), 'application1');
// fields
$acl->add(new Zend_Acl_Resource('field1'), 'group1');
$acl->add(new Zend_Acl_Resource('field2'), 'group1');
$acl->add(new Zend_Acl_Resource('field3'), 'group2');
$acl->add(new Zend_Acl_Resource('field4'), 'application1');

// roles
$acl->addRole(new Zend_Acl_Role('applicant'));
$acl->addRole(new Zend_Acl_Role('admin'), 'applicant');

// permissions
$acl->allow('applicant', 'application1', 'view');
$acl->allow('applicant', 'group1', 'edit'); 
```

这表示大学申请的数据库，组/字段是大学申请的组成部分。从上述情况来看，申请人确实具有编辑字段2的编辑权限。

整个结构存储为 mysql 数据库中的 acl 对象。

在管理员决定将 field2 从 group1 移动到 group2 之后，如何更改 acl 对象？

我检查了 Acl.php 文件，但没有任何方法可以更改资源的父级，从而自动更新规则/权限。

谢谢。

沙什康特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:25:12.497

就个人而言，我不希望将序列化的 ACL 对象存储在数据库中。我宁愿将有关角色、资源和权限的信息直接存储在数据库表中，并在引导应用程序时动态创建一个新的 ACL 对象。

如果您确实想将 ACL 对象序列化到数据库，则删除有问题的资源并将它们重新添加到 ACL 可能对您有用。代码看起来像这样，尽管我没有将它提供给 PHP 解释器：

```
$acl->remove('field2');
$acl->add(new Zend_Acl_Resource('field2'), 'group2'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-02T13:30:01.613

第一个答案为什么你会在数据库中存储这个访问逻辑？？？它是所谓业务逻辑的一部分，通常属于脚本。数据库是存放原始源数据的地方，就像事实一样，哪个用户有哪个角色。我理解为了性能而缓存了逻辑部分。

# c# - 在 C# 中，如何检查 TCP 端口是否可用？

> ID：570098
> 
> 赞同：132
> 
> 时间：2009-02-20T15:53:37.783
> 
> 标签：c#, .net, tcp, tcpclient

在 C# 中使用 TcpClient 或通常连接到套接字我如何首先检查我的机器上的某个端口是否空闲？

*更多信息：* 这是我使用的代码：

```
TcpClient c;
//I want to check here if port is free.
c = new TcpClient(ip, port); 
```

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2009-02-20T17:17:29.563

由于您使用的是`TcpClient`，这意味着您正在检查打开的 TCP 端口。[System.Net.NetworkInformation](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.aspx)命名空间中有很多好的对象可用。

使用`IPGlobalProperties`对象获取对象数组`TcpConnectionInformation`，然后您可以查询端点 IP 和端口。

* * *

```
 int port = 456; //<--- This is your value
 bool isAvailable = true;

 // Evaluate current system tcp connections. This is the same information provided
 // by the netstat command line application, just in .Net strongly-typed object
 // form.  We will look through the list, and if our port we would like to use
 // in our TcpClient is occupied, we will set isAvailable to false.
 IPGlobalProperties ipGlobalProperties = IPGlobalProperties.GetIPGlobalProperties();
 TcpConnectionInformation[] tcpConnInfoArray = ipGlobalProperties.GetActiveTcpConnections();

 foreach (TcpConnectionInformation tcpi in tcpConnInfoArray)
 {
   if (tcpi.LocalEndPoint.Port==port)
   {
     isAvailable = false;
     break;
   }
 }

 // At this point, if isAvailable is true, we can proceed accordingly. 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-02-20T17:25:53.490

你在 Intertube 的错误一端。服务器只能打开一个特定端口。一些代码：

```
 IPAddress ipAddress = Dns.GetHostEntry("localhost").AddressList[0];
  try {
    TcpListener tcpListener = new TcpListener(ipAddress, 666);
    tcpListener.Start();
  }
  catch (SocketException ex) {
    MessageBox.Show(ex.Message, "kaboom");
  } 
```

失败：

> 每个套接字地址（协议/网络地址/端口）通常只允许使用一次。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-07T02:59:05.043

当您建立 TCP 连接时，4 元组（源 IP、源端口、目标 IP、目标端口）必须是唯一的 - 这是为了确保数据包被传递到正确的位置。

*在服务器*端还有一个限制，只有一个服务器程序可以绑定到一个传入的端口号（假设一个 IP 地址；多网卡服务器还有其他权力，但我们不需要在这里讨论它们）。

因此，在服务器端，您：

*   创建一个套接字。
*   将该套接字绑定到一个端口。
*   监听那个端口。
*   接受该端口上的连接。并且可以有多个连接（每个客户端一个）。

在客户端，它通常更简单一些：

*   创建一个套接字。
*   打开连接。当客户端打开连接时，它会指定*服务器*的 IP 地址和端口。它*可以*指定其源端口，但通常使用零，这会导致系统自动为其分配一个空闲端口。

没有要求目标 IP/端口是唯一*的*，因为这将导致一次只有一个人能够使用 Google，这很可能会破坏他们的商业模式。

这意味着您甚至可以执行多会话 FTP 等奇妙的事情，因为您设置了多个会话，唯一的区别是您的源端口，允许您并行下载块。Torrent 略有不同，因为每个会话的目的地通常不同。

而且，在所有这些胡扯（抱歉）之后，您的具体问题的答案是您不需要指定自由端口。如果您使用未指定源端口的调用连接到服务器，则几乎可以肯定它会在幕后使用零，并且系统会给您一个未使用的端口。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-11-12T13:59:19.183

感谢您的提示。我需要相同的功能，但在服务器端检查端口是否正在使用，因此我将其修改为这段代码。

```
 private bool CheckAvailableServerPort(int port) {
    LOG.InfoFormat("Checking Port {0}", port);
    bool isAvailable = true;

    // Evaluate current system tcp connections. This is the same information provided
    // by the netstat command line application, just in .Net strongly-typed object
    // form.  We will look through the list, and if our port we would like to use
    // in our TcpClient is occupied, we will set isAvailable to false.
    IPGlobalProperties ipGlobalProperties = IPGlobalProperties.GetIPGlobalProperties();
    IPEndPoint[] tcpConnInfoArray = ipGlobalProperties.GetActiveTcpListeners();

    foreach (IPEndPoint endpoint in tcpConnInfoArray) {
        if (endpoint.Port == port) {
            isAvailable = false;
            break;
        }
    }

    LOG.InfoFormat("Port {0} available = {1}", port, isAvailable);

    return isAvailable;
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-04-03T08:48:28.167

```
TcpClient c;

//I want to check here if port is free.
c = new TcpClient(ip, port); 
```

> ...我如何首先检查我的机器上的某个端口是否空闲？
> 
> 我的意思是它没有被任何其他应用程序使用。如果一个应用程序正在使用一个端口，其他人在它空闲之前不能使用它。——阿里

你误解了这里发生的事情。

TcpClient(...) 参数是您希望连接的服务器 ip 和服务器端口。

TcpClient 从可用池中选择一个临时本地端口与服务器通信。无需检查本地端口的可用性，因为它由 winsock 层自动处理。

如果您无法使用上述代码片段连接到服务器，则问题可能是多个中的一个或多个。（即服务器 ip 和/或端口错误，远程服务器不可用等。）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-05-08T07:37:23.337

谢谢jro的回答。我不得不调整它以适应我的使用。我需要检查一个端口是否正在被监听，并且不一定是活动的。为此，我更换了

```
TcpConnectionInformation[] tcpConnInfoArray = ipGlobalProperties.GetActiveTcpConnections(); 
```

和

```
IPEndPoint[] objEndPoints = ipGlobalProperties.GetActiveTcpListeners();. 
```

我迭代了端点数组，检查是否找不到我的端口值。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-20T16:02:32.597

```
string hostname = "localhost";
int portno = 9081;
IPAddress ipa = (IPAddress) Dns.GetHostAddresses(hostname)[0];

try
{
    System.Net.Sockets.Socket sock = new System.Net.Sockets.Socket(System.Net.Sockets.AddressFamily.InterNetwork, System.Net.Sockets.SocketType.Stream, System.Net.Sockets.ProtocolType.Tcp);
    sock.Connect(ipa, portno);
    if (sock.Connected == true)  // Port is in use and connection is successful
            MessageBox.Show("Port is Closed");
    sock.Close();

}
catch (System.Net.Sockets.SocketException ex)
{
    if (ex.ErrorCode == 10061)  // Port is unused and could not establish connection 
        MessageBox.Show("Port is Open!");
    else
        MessageBox.Show(ex.Message);
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2019-11-25T14:53:14.657

为了回答在 dotnet core 3.1 中找到空闲端口（这是我在单元测试中需要的）的确切问题，我想出了这个

```
public static int GetAvailablePort(IPAddress ip) {
        TcpListener l = new TcpListener(ip, 0);
        l.Start();
        int port = ((IPEndPoint)l.LocalEndpoint).Port;
        l.Stop();
        Log.Info($"Available port found: {port}");
        return port;
    } 
```

注意：基于@user207421 关于端口零的评论，我搜索并找到[了这个](https://devblog.dymel.pl/2016/05/05/find-free-tcp-port-system/)并稍微修改了它。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2018-07-10T10:13:09.983

从可用端口中，我将排除：

*   活动 TCP 连接
*   活动 TCP 侦听器
*   活跃的 UDP 监听器

使用以下导入：

```
using System.Net.NetworkInformation; 
```

您可以使用以下函数来检查端口是否可用：

```
private bool isPortAvalaible(int myPort)
{
    var avalaiblePorts = new List<int>();
    var properties = IPGlobalProperties.GetIPGlobalProperties();

    // Active connections
    var connections = properties.GetActiveTcpConnections();
    avalaiblePorts.AddRange(connections);

    // Active tcp listners
    var endPointsTcp = properties.GetActiveTcpListeners();
    avalaiblePorts.AddRange(endPointsTcp);

    // Active udp listeners
    var endPointsUdp = properties.GetActiveUdpListeners();
    avalaiblePorts.AddRange(endPointsUdp);

    foreach (int p in avalaiblePorts){
        if (p == myPort) return false;
    }
    return true;
} 
```

我为那些使用**VB.NET**的人提供了一个类似的功能：

```
Imports System.Net.NetworkInformation
Private Function isPortAvalaible(ByVal myPort As Integer) As Boolean
  Dim props As IPGlobalProperties = IPGlobalProperties.GetIPGlobalProperties()

  ' ignore active connections
  Dim tcpConnInfoArray() As TcpConnectionInformation = props.GetActiveTcpConnections()
  For Each tcpi As Net.NetworkInformation.TcpConnectionInformation In tcpConnInfoArray
    If tcpi.LocalEndPoint.Port = myPort Then
      Return False
    End If
  Next tcpi

  ' ignore active TCP listeners
  Dim activeTcpListeners() As Net.IPEndPoint = props.GetActiveTcpListeners
  For Each tcpListener As Net.IPEndPoint In activeTcpListeners
    If tcpListener.Port = myPort Then
      Return False
    End If
  Next tcpListener

  ' ignore active UPD listeners
  Dim activeUdpListeners() As Net.IPEndPoint = props.GetActiveUdpListeners
  For Each udpListener As Net.IPEndPoint In activeUdpListeners
    If udpListener.Port = myPort Then
      Return False
    End If
  Next udpListener

  Return True
End Function 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-20T15:58:16.697

网络统计！这是 Windows 附带的网络命令行实用程序。它显示所有当前已建立的连接和当前正在侦听的所有端口。您可以使用此程序进行检查，但如果您想从代码中执行此操作，请查看 System.Net.NetworkInformation 命名空间？从 2.0 开始，它是一个新的命名空间。那里有一些好东西。但最终，如果您想获得通过命令 netstat 可用的相同类型的信息，您需要生成 P/Invoke ...

### 更新：System.Net.NetworkInformation

该命名空间包含一堆类，您可以使用它们来了解有关网络的信息。

我无法找到那段旧代码，但我认为您可以自己编写类似的代码。一个好的开始是查看[IP Helper API](http://msdn.microsoft.com/en-us/library/aa366073.aspx)。谷歌 MSDN 获取 [GetTcpTable](http://msdn.microsoft.com/en-us/library/aa366026(VS.85).aspx) WINAPI 函数并使用 P/Invoke 进行枚举，直到获得所需的信息。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-24T16:21:11.350

`ipGlobalProperties.GetActiveTcpConnections()`在侦听状态下不返回连接。

端口可以​​用于监听，但是没有人连接到它上面描述的方法将不起作用。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-04-09T18:20:51.133

如果我没记错的话，你可以使用 System.Network.whatever 来检查。

但是，这总是会导致竞争条件。

检查的规范方法是尝试侦听该端口。如果您收到端口未打开的错误。

我*认为*这就是为什么 bind() 和 listen() 是两个独立的系统调用的部分原因。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-20T16:34:30.150

你说

> 我的意思是它没有被任何其他应用程序使用。如果一个应用程序正在使用一个端口，其他人在它空闲之前不能使用它。

但是，如果有人在那里监听，您总是可以在其他人使用它时连接到一个端口。否则，http 端口 80 将是一团糟。

如果你的

```
 c = new TcpClient(ip, port); 
```

失败了，那么那里什么也听不见。否则，即使其他机器/应用程序有一个对该 ip 和端口开放的套接字，它也会连接。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-09T11:35:20.603

请注意，您进行检查和尝试建立连接之间的时间窗口可能会占用端口 - 经典[TOCTOU](http://en.wikipedia.org/wiki/Time-of-check-to-time-of-use)。你为什么不尝试连接？如果它失败，那么您知道该端口不可用。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-09T17:38:16.103

您不必知道本地计算机上打开了哪些端口来连接到某个远程 TCP 服务（除非您想使用特定的本地端口，但通常情况并非如此）。

每个 TCP/IP 连接由 4 个值标识：远程 IP、远程端口号、本地 IP、本地端口号，但您只需要知道远程 IP 和远程端口号即可建立连接。

当您使用创建 tcp 连接时

```
TcpClient c;
c = new TcpClient(remote_ip, remote_port);

```

您的系统会自动为您的连接分配许多可用的本地端口号之一。你不需要做任何事情。您可能还想检查远程端口是否打开。但是没有比尝试连接它更好的方法了。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-04-17T08:14:48.270

```
 public static bool TestOpenPort(int Port)
    {
        var tcpListener = default(TcpListener);

        try
        {
            var ipAddress = Dns.GetHostEntry("localhost").AddressList[0];

            tcpListener = new TcpListener(ipAddress, Port);
            tcpListener.Start();

            return true;
        }
        catch (SocketException)
        {
        }
        finally
        {
            if (tcpListener != null)
                tcpListener.Stop();
        }

        return false;
    } 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-12-03T06:58:11.770

检查错误代码 10048

```
try
{
    TcpListener tcpListener = new TcpListener(ipAddress, portNumber);
    tcpListener.Start();
}
catch(SocketException ex)
{
    if(ex.ErrorCode == 10048)
    {
        MessageBox.Show("Port " + portNumber + " is currently in use.");
    }
    return;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-01-08T14:54:58.917

```
test_connection("ip", port);

public void test_connection(String hostname, int portno) {
  IPAddress ipa = (IPAddress)Dns.GetHostAddresses(hostname)[0];
  try {
    System.Net.Sockets.Socket sock = new System.Net.Sockets.Socket(System.Net.Sockets.AddressFamily.InterNetwork, System.Net.Sockets.SocketType.Stream, System.Net.Sockets.ProtocolType.Tcp);
   sock.Connect(ipa, portno);
   if (sock.Connected == true) {
     MessageBox.Show("Port is in use");
   }

   sock.Close();
 }
 catch (System.Net.Sockets.SocketException ex) {
   if (ex.ErrorCode == 10060) {
     MessageBox.Show("No connection.");
   }
 }
} 
```

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2016-05-06T19:52:07.420

试试这个，在我的情况下，创建对象的端口号不可用，所以我想出了这个

```
IPEndPoint endPoint;
int port = 1;
while (true)
{
    try
    {
        endPoint = new IPEndPoint(IPAddress.Any, port);
        break;
    }
    catch (SocketException)
    {
         port++;
    }
} 
```

# javascript - 带有 jquery 的仪表板跨域 AJAX

> ID：570100
> 
> 赞同：5
> 
> 时间：2009-02-20T15:53:52.510
> 
> 标签：javascript, jquery, ajax, widget, dashboard

大家好，我正在为 Apple 的仪表板开发一个小部件，但在尝试使用 jquery 的 ajax 函数从我的服务器获取数据时遇到了问题。这是我的 JavaScript 代码：

```
$.getJSON("http://example.com/getData.php?act=data",function(json) { 
    $("#devMessage").html(json.message)
    if(json.version != version) {
        $("#latestVersion").css("color","red")
    }
    $("#latestVersion").html(json.version)
}) 
```

服务器用这个 json 响应：

```
{"message":"Hello World","version":"1.0"} 
```

但是，由于某种原因，当我运行它时，小部件上的字段不会改变。通过调试，我了解到该小部件甚至不会向服务器发出请求，因此这让我认为 Apple 设置了某种外部 URL 块。我知道这不可能是真的，因为许多小部件都会打电话回家检查更新。

有没有人对可能出现的问题有任何想法？

编辑：此外，此代码在 Safari 中运行良好。

* * *

根据 Luca 的要求，下面是正在运行的 PHP 和 Javascript 代码：

PHP：

```
echo $_GET["callback"].'({"message":"Hello World","version":"1.0"});'; 
```

Javascript：

```
function showBack(event)
{
var front = document.getElementById("front");
var back = document.getElementById("back");

if (window.widget) {
    widget.prepareForTransition("ToBack");
}

front.style.display = "none";
back.style.display = "block";
stopTime();
if (window.widget) {
    setTimeout('widget.performTransition();', 0);
}
$.getJSON('http://nakedsteve.com/data/the-button.php?callback=?',function(json) { 
    $("#devMessage").html(json.message)
    if(json.version != version) {
        $("#latestVersion").css("color","red")
    }
    $("#latestVersion").html(json.version)
})
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-19T16:59:10.637

在 Dashcode 中单击**小部件属性**，然后单击**允许网络访问**，确保选中该选项。我已经构建了一些根本拒绝工作的东西，这就是解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T16:24:58.253

[根据W3C 规范](http://www.w3.org/TR/XMLHttpRequest/)，当前标准不允许跨域 Ajax 请求（使用 XMLHttpRequest / ActiveX 对象）：

> 本规范不包括正在考虑用于本规范的未来版本的以下功能：
> 
> *   跨站 XMLHttpRequest；

然而，有 1 种跨域的*ajax请求技术*[JSONP](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/)，通过在页面上包含一个脚本标签，并带有一点服务器配置。

jQuery 支持[这个](http://docs.jquery.com/Ajax/jQuery.getJSON)，但不是用这个在你的服务器上响应

```
{"message":"Hello World","version":"1.0"} 
```

你会想用这个来回应：

```
myCallback({"message":"Hello World","version":"1.0"}); 
```

**myCallback**必须是您在 $.getJSON() 函数中传递的“回调”参数中的值。因此，如果我使用的是 PHP，这将起作用：

```
echo $_GET["callback"].'({"message":"Hello World","version":"1.0"});'; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-04T13:12:41.960

> Apple 设置了某种外部 URL 块。

在您的 Info.plist 中，您需要将键 AllowNetworkAccess 设置为 true。

```
<key>allowNetworkAccess</key>
<true/> 
```

您的代码可以在 Safari 中运行，因为它在仪表板服务器中不受限制，并且它不符合标准，因为它确实允许跨站点 AJAX。FF IS 标准兼容，因为它不允许跨站点 ajax。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T16:40:39.557

如果您正在创建仪表板小部件，为什么不使用 DashCode 代码库中的 XMLHttpRequest 设置功能。Apple 内置了这些，因此您无需安装 3rd 方 JS 库。我不确定 JSON 支持，但也许从这里开始会引导你走向更好的方向。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-07-12T23:55:13.893

因此，另一种解决方案是创建自己的服务器端 Web 服务，您可以在其中控制 CORS，用户的 Web 浏览器无法访问另一个站点，但是如果您将该其他站点包装在您自己的 Web 服务中（在同一个域上），那么它不会引起问题。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-20T16:16:36.120

有趣的是它可以在 Safari 中运行。据我所知，要执行 x-domain ajax 请求，您需要使用 jsonp dataType。

[http://docs.jquery.com/Ajax/jQuery.getJSON](http://docs.jquery.com/Ajax/jQuery.getJSON)

[http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/](http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/)

基本上你需要添加`callback=?`到你的查询字符串中，jquery 会自动用正确的方法替换它，例如：

```
$.getJSON("http://example.com/getData.php?act=data&callback=?",function(){ ... }); 
```

编辑：`callback=?`为了安全起见，将位放在查询字符串的末尾。

# html - 防止锚点将页面推到底部 (HTML)

> ID：570101
> 
> 赞同：0
> 
> 时间：2009-02-20T15:53:55.770
> 
> 标签：html, css, anchor

我有一个带有 style="overflow: auto" 的 div，里面有一些文字。该文本有一些锚点，我在 div 左侧有链接（不在 div 内），每次单击转到锚点时，页面都会移到底部，就像锚点在页面底部一样。

有什么办法可以防止这种情况发生吗？

```
<a href='#id2'>Link</a>
<div style='width: 100px; overflow: auto;'>
Text Inside, Big text with <hr id='#id10' /> here
Text Inside, Big text with <hr id='#id5' /> here
Text Inside, Big text with <hr id='#id6' /> here
Text Inside, Big text with <hr id='#id27' /> here
Text Inside, Big text with <hr id='#id24' /> here
Text Inside, Big text with <hr id='#id20' /> here
Text Inside, Big text with <hr id='#id21' /> here
Text Inside, Big text with <hr id='#id23' /> here
Text Inside, Big text with <hr id='#id22' /> here
Text Inside, Big text with <hr id='#id2' /> here
<div> 
```

编辑：我既不使用 Javascript 也不使用 Iframe

编辑：在 Firefox 3 中测试

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T16:05:14.057

在我看来，正在发生的所有事情都是浏览器试图将您的锚点带到页面顶部，这是这种情况下的正常行为。所以它不是滚动到底部，而是试图让你的链接到页面顶部，而是在它到达之前点击滚动条的底部。

不过，一些示例代码会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T16:14:48.950

每页只能有一个`id`（id2、id3、id4 等）。id2 列出了 10 次，这很可能导致链接中断。此外，您不能`id`以井号开头 s；有效 ID 以 ([A-Za-z]) 开头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T16:22:33.703

这是浏览器的原生功能。如果您想在不使用 javascript 的情况下破坏它，那么您不妨用水枪冲向地狱，因为您不会非常成功。

使用像 jQuery 这样的简单框架可能只需几行代码就可以解决这个问题。您可以将元素滚动到视图中，并阻止默认活动或锚点。

# flash - 如何在 CS3 中将查询字符串传递给 flash？

> ID：570106
> 
> 赞同：0
> 
> 时间：2009-02-20T15:55:52.567
> 
> 标签：flash

我试图将字符串传递给 Flash 电影，就像在 CS2 中一样，它抛出错误“访问未定义的属性 imgSrc”

我希望将动态图像加载到电影中。

```
//vars
var myrequest:URLRequest=new URLRequest (imgSrc);
var myLoader:Loader = new Loader();

//load image into holder
myLoader.load(myrequest); 
```

我从 HTML 文件中传递 imgSrc，它曾经在 CS2 上工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T15:59:00.937

如果您使用的是 actionscript 3，您的参数 imgSrc 将可以像这样访问：

```
//vars
var myrequest:URLRequest=new URLRequest ( this.loaderInfo.parameters.imgSrc);
var myLoader:Loader = new Loader();

//load image into holder
myLoader.load(myrequest); 
```

另外，请尝试接受您在网站上获得的先前答案。有一个徽章等着你！（对我来说还有 15 个声望点）

# gdb - 如何在 gdb/ada 中进行字符串连接

> ID：570113
> 
> 赞同：2
> 
> 时间：2009-02-20T15:57:42.283
> 
> 标签：gdb, ada

根据手册，gdb[中没有实现字符串连接。](http://sourceware.org/gdb/current/onlinedocs/gdb_14.html#SEC149)但是我需要它，那么有没有办法实现这一点，也许使用数组函数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T18:09:58.150

我没有 gdb 的副本来尝试这个，但也许文档的 Ada 部分后面的这一行会对你有所帮助？

> 与其使用连接和符号字符名称将特殊字符引入字符串，不如使用一种特殊的括号表示法，它也用于打印字符串。["""]'形式的字符序列`["XX"]' within a string or character literal denotes the (single) character whose numeric encoding is XX in hexadecimal. The sequence of characters`也表示字符串中的单引号。例如，"One line.["0a"]Next line.["0a"]"
> 
> 每个句点后包含一个 ASCII 换行符 (Ada.Characters.Latin_1.LF)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-03T18:59:35.937

对于 Objective-C：

```
[@"asd" stringByAppendingString:@"zxc"]

[@"ID: " stringByAppendingString:(NSString*) [aTaskDict valueForKey:@"ID"]] 
```

# c# - 为什么在尝试 Assembly.ReflectionOnlyLoad 时未执行 ReflectionOnlyAssemblyResolve？

> ID：570117
> 
> 赞同：8
> 
> 时间：2009-02-20T15:58:35.743
> 
> 标签：c#, .net, assemblies, clr, assembly.reflectiononly

我正在尝试通过挂钩`AppDomain.AssemblyResolve`和`AppDomain.ReflectionOnlyAssemblyResolve`事件来加载一些模块。当我让前者工作时，我在后者上失败了。我把我的问题归结为这个小程序：

```
public static class AssemblyLoader
{
    static void Main(string[] args)
    {
        AppDomain.CurrentDomain.ReflectionOnlyAssemblyResolve += 
            ReflectionOnlyAssemblyResolve;

        // fails with FileNotFoundException
        Assembly.ReflectionOnlyLoad("Foo");
    }

    public static Assembly ReflectionOnlyAssemblyResolve(object sender, 
        ResolveEventArgs args)
    {
        Trace.TraceInformation(
            "Failed resolving Assembly {0} for reflection", args.Name);

        return null;
    }
} 
```

`FileNotFoundException`尝试运行此程序失败`Assembly.ReflectionOnlyLoad`，但它不调用 ReflectionOnlyAssemblyResolve 处理程序。我很困惑。

有谁知道这可能是什么根本原因以及如何让它发挥作用？

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T16:17:05.090

看起来 ReflectionOnlyAssemblyResolve 事件仅用于解决依赖关系，而不是顶级程序集，如下所示：

[http://codeidol.com/csharp/net-framework/Assemblies,-Loading,-and-Deployment/Assembly-Loading/](http://codeidol.com/csharp/net-framework/Assemblies,-Loading,-and-Deployment/Assembly-Loading/)

和这里：

[http://blogs.msdn.com/junfeng/archive/2004/08/24/219691.aspx](http://blogs.msdn.com/junfeng/archive/2004/08/24/219691.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T17:06:08.797

扩展 casperOne 的答案。

如果要拦截直接的 Assembly Resolve 事件，则需要挂钩 AppDomain.AssemblyResolve 事件。虽然这是一个全局钩子，但它本身并不适合您的场景。但是，如果您的应用程序是单线程的，您可以进行短期连接以拦截特定的解析事件。

```
static void LoadWithIntercept(string assemblyName) {
  var domain = AppDomain.CurrentDomain;
  domain.AssemblyResolve += MyInterceptMethod;
  try {
    Assembly.ReflectionOnlyLoad(assemblyName);
  } finally {
    domain.AssemblyResolve -= MyInterceptMethod;
  }
}

private static Assembly MyInterceptMethod(object sender, ResolveEventArgs e) {
 // do custom code here 
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-09-07T11:08:03.843

您可以通过在程序集上调用 ExportedTypes 来强制它，如下所示：

```
var dummy = asm.ExportedTypes; 
```

因此，如果您想以递归方式加载具有所有引用的程序集：

```
 private void _forceAssemblyResolve(Assembly asm) { var dummy = asm.ExportedTypes; }

 var result= Assembly.ReflectionOnlyLoad("Foo");
 _forceAssemblyResolve(result);

public static Assembly ReflectionOnlyAssemblyResolve(object sender, ResolveEventArgs args)
{
    var childAssembly = _resolve(args);
    _forceAssemblyResolve(childAssembly);
} 
```

# c# - c#线程和属性第二部分

> ID：570123
> 
> 赞同：1
> 
> 时间：2009-02-20T16:00:47.953
> 
> 标签：c#, winforms, multithreading

我有这个代码：

```
public partial class FrmPrincipal : Form
{
    private Image imagen;

    public FrmPrincipal()
    {
        InitializeComponent();
        ...
    }

    private void menuItem1_Click(object sender, EventArgs e)
    {
        Thread t = new Thread(RequestImage);
        t.Start();
    }

    private void RequestImage()
    {
        try
        {
            ...

            // I want to update this.token
            this.imagen = retrieveImageFromWebService();

            ...
        }
        catch (Exception ex)
        {
            ...
        }
    }
} 
```

如何更新图像？我想保存图像副本以在用户需要时更新图片框。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T16:06:48.453

你的代码会很好地工作。但是，如果您想从另一个线程读取值并确保始终获取最新值，则应使其成为 volatile 或在每次读取或写入时获取锁。

有关更多信息，请参阅[我的线程文章的内存模型部分](http://www.yoda.arachsys.com/csharp/threads/volatility.shtml)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:13:46.503

您那里的代码应该可以正常工作。如果您在另一个线程中使用令牌，您可能需要同步获取和设置以避免数据损坏：

```
private string token {
  [MethodImpl(MethodImplOptions.Synchronized)] get;
  [MethodImpl(MethodImplOptions.Synchronized)] set;
} 
```

这种同步方法[在所有情况下都不是 100% 安全的](http://www.ddj.com/windows/184406245;jsessionid=5ECUPWMHDQV2CQSNDLOSKHSCJUNN2JVN?_requestid=8098)，但为了您的目的，它应该可以工作

# crystal-reports - 如何跟踪用于创建报告的数据？

> ID：570133
> 
> 赞同：0
> 
> 时间：2009-02-20T16:04:11.783
> 
> 标签：crystal-reports

我正在使用 CR 9。对此感到抱歉。

我从未使用过水晶报表；但是，我的老板要求我向他提供为我们的一位客户生成的报告中使用的“逻辑”。该报告是几年前创建的，客户联系人是新的。他想知道我们使用什么信息来计算每列报告的数据。有没有一种简单的方法可以在 Crystal 中追踪这些信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:07:11.323

你没有说你使用的是什么版本的 CR，所以我会做一个假设。使用可能需要的任何参数运行报告。从文件菜单中，单击“数据库”，在下拉菜单中，应该有一个“显示 SQL 查询”选项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:35:47.957

我想如果你运行报告，它会要求你提供日期信息。然后，一旦完成，就执行“显示 sql 查询”，它应该在查询中为您填写日期。

# python - 使用 numpy 进行统计

> ID：570137
> 
> 赞同：1
> 
> 时间：2009-02-20T16:04:25.480
> 
> 标签：python, numpy

我正在处理一些工作的情节和统计数据，但我不确定如何使用 numpy 进行一些统计：我有一个价格列表和另一个 basePrices。我想知道有多少价格高于basePrice X%，有多少价格高于basePrice Y%。

有没有一种简单的方法可以使用 numpy 做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T16:12:39.297

说你有

```
>>> prices = array([100, 200, 150, 145, 300])
>>> base_prices = array([90, 220, 100, 350, 350]) 
```

那么高于基准价格 10% 以上的价格数量是

```
>>> sum(prices > 1.10 * base_prices)
2 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T16:58:35.787

只是为了娱乐，这里对 dF 的回答略有不同：

```
>>> prices = array([100, 200, 150, 145, 300])
>>> base_prices = array([90, 220, 100, 350, 350])
>>> ratio = prices / base_prices 
```

然后你可以提取高于 5%、高于 10% 等的数字

```
>>> sum(ratio > 1.05)
2
>>> sum(ratio > 1.10)
2
>>> sum(ratio > 1.15)
1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T16:19:14.883

除了 df 的回答，如果您想知道高于基本价格的具体价格，您可以这样做：

价格[价格 > (1.10 * base_prices)]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T16:21:24.283

我不认为你需要 numpy ...

```
prices = [40.0, 150.0, 35.0, 65.0, 90.0]
baseprices = [45.0, 130.0, 40.0, 80.0, 100.0]
x = .1
y = .5

# how many are within 10%
len([p for p,bp in zip(prices,baseprices) if p <= (1+x)*bp]) # 1

# how many are within 50%
len([p for p,bp in zip(prices,baseprices) if p <= (1+y)*bp]) # 5 
```

# python - manytomany 的管理模板

> ID：570138
> 
> 赞同：1
> 
> 时间：2009-02-20T16:05:00.877
> 
> 标签：python, django, django-admin, many-to-many

我在出版和病理学之间有着多对多的关系。每个出版物可能有许多病态。当某个出版物出现在管理模板中时，我需要能够查看与该出版物相关的许多病状。这是模型声明：

```
class Pathology(models.Model):
    pathology = models.CharField(max_length=100)
    def __unicode__(self):
        return self.pathology
    class Meta:
        ordering = ["pathology"]

class Publication(models.Model):
    pubtitle = models.TextField()
    pathology = models.ManyToManyField(Pathology)
    def __unicode__(self):
        return self.pubtitle
    class Meta:
        ordering = ["pubtitle"] 
```

这是admin.py。我尝试了以下变体，但总是收到错误消息，指出出版物或病理学没有关联的外键。

```
from myprograms.cpssite.models import Pathology
class PathologyAdmin(admin.ModelAdmin):
    # ...
    list_display = ('pathology', 'id')

admin.site.register(Pathology, PathologyAdmin)

class PathologyInline(admin.TabularInline):
    #...
    model = Pathology
    extra = 3

class PublicationAdmin(admin.ModelAdmin):
    # ...
    ordering = ('pubtitle', 'year')
    inlines = [PathologyInline]
admin.site.register(Publication,PublicationAdmin) 
```

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:19:30.530

除非您使用此处记录的中间表[http://docs.djangoproject.com/en/dev/ref/contrib/admin/#working-with-many-to-many-intermediary-models](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#working-with-many-to-many-intermediary-models)，否则我不认为您需要创建一个内联类。尝试删除线`includes=[PathologyInline]`，看看会发生什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T17:57:57.373

我现在意识到 Django 非常适合网站的管理（数据输入）、简单的搜索和模板继承，但是 Django 和 Python 对于复杂的 Web 应用程序来说不是很好，因为数据在数据库和 html 之间来回移动模板。我决定将 Django 和 PHP 结合起来，希望能发挥两者的优势。谢谢你的帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T20:41:15.413

这对我来说更像是一对多的关系，尽管我不太清楚病理学到底是什么。另外，据我了解，内联不适用于多线程。如果您颠倒模型的顺序，删除 manytomany 并将 ForeignKey 字段添加到 Publication in Pathology，这应该可以工作。

```
class Publication(models.Model):
    pubtitle = models.TextField()
    def __unicode__(self):
        return self.pubtitle
    class Meta:
        ordering = ["pubtitle"]

class Pathology(models.Model):
    pathology = models.CharField(max_length=100)
    publication = models.ForeignKey(Publication)
    def __unicode__(self):
        return self.pathology
    class Meta:
        ordering = ["pathology"] 
```

# c++ - 编写编程语言解析器的最佳实践

> ID：570144
> 
> 赞同：26
> 
> 时间：2009-02-20T16:07:48.437
> 
> 标签：c++, parsing, programming-languages, conventions

在编写解析器时，我应该遵循哪些最佳实践？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-20T17:16:27.553

公认的智慧是使用解析器生成器+语法，这似乎是个好建议，因为您使用的是严格的工具，并且可能会减少这样做的工作量和潜在的错误。

要使用解析器生成器，语法必须是上下文无关的。如果您正在设计要解析的语言，那么您可以控制它。如果您不确定，那么如果您从语法路线开始，可能会花费您很多精力。即使在实践中它是上下文无关的，除非语法非常庞大，否则手动编写一个像样的递归解析器会更简单。

上下文无关不仅使解析器生成器成为可能，而且还使手动编码的解析器变得更加简单。你最终得到的是每个短语一个（或两个）功能。也就是说，如果您干净地组织和命名代码并不比语法更难看到（如果您的 IDE 可以显示调用层次结构，那么您几乎可以看到语法是什么）。

优点：-

*   更简单的构建
*   更好的性能
*   更好地控制输出
*   可以处理小的偏差，例如使用不是 100% 上下文无关的语法

我并不是说语法总是不合适的，但通常好处是微乎其微的，而且往往被成本和风险所抵消。

（我相信他们的论点似是而非地吸引人，并且普遍存在对他们的偏见，因为这是一种表明人们更具有计算机科学素养的方式。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-20T16:11:58.487

几点建议：

*   了解你的语法 - 以合适的形式写下来
*   选择正确的工具。使用 Spirit2x 在 C++ 中执行此操作，或选择外部解析器工具，如 antlr、yacc 或任何适合您的工具
*   你需要解析器吗？也许正则表达式就足够了？或者也许破解一个 perl 脚本来解决这个问题？编写复杂的解析器需要时间。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-20T16:44:57.940

不要过度使用正则表达式——虽然它们有自己的位置，但它们根本没有能力处理任何类型的真正解析。你可以推动它们，但你最终会碰壁或陷入无法维护的混乱局面。您最好找到一个可以处理更大语言集的解析器生成器。如果您真的不想使用工具，可以查看递归下降解析器 - 这是一种非常简单的手写小解析器模式。它们不像大型解析器生成器那样灵活或强大，但它们的学习曲线要​​短得多。

除非您有非常严格的性能要求，否则请尝试将您的层分开 - 词法分析器读取单个标记，解析器将它们排列成树，然后语义分析检查所有内容并链接引用，然后在最后阶段输出任何内容正在生产。保持逻辑的不同部分分开将使以后的维护更容易。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-20T17:18:37.517

首先阅读大部分[龙书](http://en.wikipedia.org/wiki/21st_Century_Compilers)。

如果您知道如何构建解析器，它们并不复杂，但是如果您投入足够的时间，它们并不是那种类型的东西，您最终会到达那里。建立在现有知识库上会更好。（否则期望写它并把它扔掉几十次）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-20T16:13:34.273

是的。尝试生成它，而不是编写。考虑使用 yacc、ANTLR、Flex/Bison、Coco/R、GOLD 解析器生成器等。仅当现有解析器生成器都不符合您的需求时，才使用手动编写解析器。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-20T16:57:06.617

*   选择正确的解析器类型，有时递归后代就足够了，有时您应该使用 LR 解析器（还有很多类型的 LR 解析器）。
*   如果您有复杂的语法，请构建抽象语法树。
*   尝试很好地识别词法分析器中的内容，语法的一部分以及语义的问题。
*   尽量使解析器与词法分析器实现的耦合最小。
*   为用户提供一个好的接口，这样他就可以不知道解析器的实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-20T17:17:45.570

首先，不要尝试将相同的技术应用于解析所有内容。有许多可能的用例，从 IP 地址（一些临时代码）到 C++ 程序（需要工业强度的解析器和符号表的反馈），以及用户输入（需要非常快速）到编译器（通常可以花一点时间解析）。如果您想要有用的答案，您可能需要指定您正在做什么。

其次，要记住一个语法来解析。越复杂，规范就越需要正式。尽量避免过于正式。

第三，嗯，这取决于你在做什么。

# apache-flex - flex 数据网格问题

> ID：570145
> 
> 赞同：0
> 
> 时间：2009-02-20T16:07:55.270
> 
> 标签：apache-flex, datagrid

我的应用程序中有一个数据网格，并且正在使用 php 从 MYSQL DB 中提取数据。有没有办法将所有数据存储到一个数组中并将其传递给一个函数，或者是否可以将数据直接存储到一个数组中而不是从数据网格中提取它是代码

```
<mx:DataGrid id="dgUserRequest" x="150" y="10" dataProvider="  {userRequest.lastResult.users.user}" editable="false">

    <mx:columns>
        <mx:DataGridColumn headerText="UserID" dataField="userid"/>
        <mx:DataGridColumn headerText="Ip Address" dataField="ip"/>
        <mx:DataGridColumn headerText="latitude" dataField="lat"/>
        <mx:DataGridColumn headerText="longitude" dataField="lng"/>
    </mx:columns>

</mx:DataGrid>
<mx:HTTPService id="userRequest" url="http://localhost/post.php" useProxy="false" method="POST">
    <mx:request xmlns="">
    </mx:request>
    </mx:HTTPService> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T20:36:11.193

为 HTTPService 的“结果”事件添加一个侦听器，并让侦听器函数中的代码填充本地存储的数组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-16T21:11:23.823

这样的事情应该有帮助

```
[Bindable]
public var dp:ArrayCollection;

protected function samplePhp_resultHandler(event:ResultEvent):void
{
dp = event.result as ArrayCollection;
}

<mx:HTTPService id="userRequest" url="http://localhost/post.php"                               useProxy="false"         
   method="POST" result="samplePhp_resultHandler">
<mx:request xmlns=""> 
```

# asp.net-mvc - 是否绝对需要手动配置 IIS6 才能使用 ASP.NET MVC？

> ID：570147
> 
> 赞同：4
> 
> 时间：2009-02-20T16:08:30.883
> 
> 标签：asp.net-mvc, deployment, iis-6

我有一个虚拟主机回复我，无法更改 IIS6 设置来设置 .mvc 到 Asp.Net ISAPI dll 的映射，也无法启用通配符应用程序映射。

简而言之，我无法更改任何 IIS 设置。

有没有办法在这种情况下运行 ASP.NET Mvc？

**注意**：我在这里阅读了一些相关的问题，但在某些情况下不理解它们，这不是我在其他情况下需要的。如果在将其作为重复项关闭之前，我将不胜感激，有一个解释为什么，也许是对另一个问题的解释。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:24:13.107

如果存在到 .aspx 的映射，请尝试在[此处](http://forums.asp.net/p/1239943/2294813.aspx)找到的解决方案以添加路由以在 *.mvc.aspx 中结束

```
routes.Add(new Route("{controller}.mvc.aspx/{action}", new MvcRouteHandler())
{
    Defaults = new RouteValueDictionary (new{ controller = "YourController"} )
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T16:13:46.800

对于我调查的你必须采取的方法，一种是告诉 IIS 所有页面都必须通过 ASP.NET - gif 、 css 等 - 这样 asp.net 知道如何处理每个页面。另一种是写一个HttpModule，或者类似的东西。我做了第一个。我不相信你有任何其他选择。

也许这会有所帮助： [IIS6 上的 ASP.NET MVC](https://stackoverflow.com/questions/34194/asp-net-mvc-on-iis6)

# .htaccess - 对使用 .htaccess 输入的任何 URI 强制使用 SSL 和 www 子域？

> ID：570148
> 
> 赞同：5
> 
> 时间：2009-02-20T16:08:39.447
> 
> 标签：.htaccess, mod-rewrite, ssl, subdomain

我有一个我们称为 example.com 的网站的“www”子域的 SSL 证书。

因此我可以强制使用 SSL，但如果用户没有在浏览器中输入“www.example.com”，则 SSL 证书将显示为无效。

我希望在网站根目录的 .htaccess 文件中使用 mod_rewrite 规则来完成此操作。

无论用户输入什么 URI（例如 example.com、www.example.com、[https](https://example.com) ://example.com、example.com/folder/file.html 等） ，我都想强制 HTTPS*和*www 子域，当然保留他们提供的任何 URI。

我正在玩弄 .htaccess 文件和一些规则，因为我已经做了一些研究，但我对 mod_rewrite 或 .htaccess 没有太多经验。我想我找到了*几乎*对我有用的 SVN 修订版，但并不完全。这里是：

```
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
RewriteCond %{HTTP_HOST} ^example.com [nc]
RewriteRule ^(.*)$ https://www.example.com/$1 [r=301,nc] 
```

尽量不要对我的档案笑得太厉害；它主要来自我在网上找到的示例。

任何指针表示赞赏！=)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T16:10:41.410

试试这个：

```
RewriteCond %{HTTPS} !on [OR]
RewriteCond %{HTTP_HOST} !^www\.example\.com$ [NC]
RewriteRule ^ https://www.example.com%{REQUEST_URI} [R=301] 
```

# php - 创建自己的 Wordpress 循环的最佳方法是什么？

> ID：570152
> 
> 赞同：8
> 
> 时间：2009-02-20T16:09:40.053
> 
> 标签：php, wordpress, loops

使用 Wordpress 的内置功能从 Wordpress 输出内容似乎有三种主要方法，`WP_Query`推荐的一种方法是：

*   [WP_Query](http://codex.wordpress.org/Function_Reference/WP_Query)
*   [查询帖子](http://codex.wordpress.org/Template_Tags/query_posts)
*   [获取帖子](http://codex.wordpress.org/Template_Tags/get_posts)

它们之间有什么区别？（我理解`WP_Query`是类，另外两个是方法）。

在同一页面上有多个循环而不相互干扰的最干净的方法是什么？

我正在寻找有关如何编写 WP 循环的示例；例如，按类别输出 2 个单独的帖子列表，包括附件、元数据等。

这是迄今为止我找到的最佳参考：

*   [使用 WP_Query 定义您自己的 WordPress 循环](http://weblogtoolscollection.com/archives/2008/04/13/define-your-own-wordpress-loop-using-wp_query/)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T17:33:34.120

我已经使用了 WP_Query 和 get_posts。在我的一个侧边栏模板上，我使用以下循环显示来自特定类别的帖子，方法是使用自定义字段，其键为“category_to_load”，其中包含类别标签或类别名称。真正的区别在于这两种方法的实现。

get_posts 方法在我的一些模板中看起来像这样：

```
<?php    
    global $post;
    $blog_posts = get_posts( $q_string );
    foreach( $blog_posts as $post ) : 
    setup_postdata( $post );
?>
    <div class="blog_post">
        <div class="title">
            <h2>
                <a href="<?php the_permalink(); ?>"><?php the_title(); ?></a>
            </h2>
            <span class="date"><?php the_time( 'F j, Y' ); ?> by <?php the_author(); ?></span>
        </div>
        <?php the_excerpt(); ?>
    </div>
    <?php endforeach; 
?> 
```

实现`WP_Query`如下所示：

```
$blog_posts = new WP_Query( 'showposts=15' );

while ( $blog_posts->have_posts() ) : $blog_posts->the_post(); ?>

    <div <?php post_class() ?> id="post-<?php the_ID(); ?>" class="blog_post">
        <div class="title">
            <h2>
                <a href="<?php the_permalink() ?>" rel="bookmark" title="Permanent Link to <?php the_title_attribute(); ?>"><?php the_title(); ?></a>
            </h2>
            <span class="date"><?php the_time( 'F jS, Y' ) ?> <!-- by <?php the_author() ?> --></span>
        </div>
        <div class="entry">
            <?php the_content(); ?>
        </div>
        <p class="postmetadata"><?php the_tags( 'Tags: ', ', ', '<br />' ); ?> Posted in <?php the_category(', ') ?> | <?php edit_post_link('Edit', '', ' | '); ?>  <?php comments_popup_link('No Comments &#187;', '1 Comment &#187;', '% Comments &#187;'); ?></p>
    </div>

<?php endwhile; ?> 
```

主要区别在于您不必重置全局 $post 变量，也不必在使用 WP_query 时通过在每个帖子对象上调用 setup_postdata($post) 来设置帖子数据。您还可以在 WP_Query 函数上使用可爱的 have_posts() 函数，而使用 get_posts() 则无法使用该函数。

你不应该使用 query_posts() 函数，除非你真的想这样做，因为它修改了页面的主循环。请参阅[文档](http://codex.wordpress.org/Template_Tags/query_posts#Parameters)。因此，如果您正在构建一个特殊页面来显示您的博客，那么调用 query_posts 可能会打乱页面的循环，因此您应该使用 WP_Query。

那只是我的两分钱。我的最终建议，您的首选应该是 WP_Query。

-克里斯

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T22:13:20.897

来自 get_posts 的 WP 文档：

> get_posts() 也可以使用 query_posts() 可以使用的参数，因为这两个函数现在在内部使用相同的数据库查询代码。

这两个函数之间的唯一区别是 get_posts 返回一个包含帖子记录的数组，而 query_posts 将记录存储在查询对象中以供模板函数（has_posts、the_post 等）检索。

他们都使用 WP_Query 对象来执行查询。

[Wordpress 文档](http://codex.wordpress.org/The_Loop#Multiple_Loops)中介绍了创建第二个循环。那里有一些链接可用于多个循环的其他示例。您会注意到每个人的做法都不同，但他们似乎都对自己的结果感到满意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-23T19:33:44.900

WP 使用一个称为`$wp_query`主循环的对象。我们通常看不到这个对象，因为它隐藏在后面`have_posts()`，`the_post()`并且只是和的包装 `$wp_query->have_posts()`器`$wp_query->the_post()`

如果要修改主循环，则应`query_posts()`在循环之前使用。

如果您想要另一个循环，您可以在该新循环之前重新利用`$wp_query`对象。`query_posts()`如果需要，可以多次执行此操作。

如果由于某种原因您需要保留 $wp_query 对象，那么您应该使用`WP_Query`. 当然，因为`have_posts()`和`the_post()`是对象的包装器，`$wp_query`所以不能将它们与`WP_Query`. 你应该使用`$your_query_obj->have_posts()`ie

```
$sidebar= WP_Query('category_name= sidebar');

while( $sidebar->have_posts() ): $sidebar->the_post();
  the_title();
  the_content();
endwhile; 
```

一个比左侧边栏`WP_Query`更好的好案例。`query_posts()`由于侧边栏的代码循环可能会放在主循环的顶部，因此`query_posts()`调用将更改`$wp_query`对象并更改主循环。在这种情况下，要`query_posts()`在侧边栏代码中使用，您还需要`query_posts()`在主循环之前使用来查询该循环的正确内容。

因此，在这种情况下使用 WP_Query 将保持 $wp_query 并因此保持主循环不变。

但同样，对于一个常见的情况`query_posts()`，查询您的内容是一种很好的方式：

```
query_posts('category_name=blog');

while( have_posts() ): the_post();
  the_title();
  the_content();
endwhile; 
```

# .net - 是什么让 CLR 显示断言？

> ID：570153
> 
> 赞同：2
> 
> 时间：2009-02-20T16:10:01.660
> 
> 标签：.net, debugging, clr, assertions

如果我在 Visual Studio 中为我的 C# 项目定义 Debug 常量，我可以确定断言将被评估，并且当它们失败时会显示一个消息框。但是什么标志、属性使 CLR 在运行时**实际**决定是否评估和显示断言。定义 DEBUG 时，断言代码是否不会在 IL 中结束？还是程序集的 DebuggableAttribute 中的[DebuggableAttribute.DebuggingModes](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggableattribute.debuggingmodes.aspx)标志是关键？如果是这样，它必须存在什么枚举值？这在引擎盖下是如何工作的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T16:12:40.373

如果您在未定义 DEBUG 预处理器符号的情况下进行编译，则对 Debug.Assert 的任何调用都将从编译的代码中省略。

如果您查看[Debug.Assert 的文档，](http://msdn.microsoft.com/en-us/library/system.diagnostics.debug.assert.aspx)您会`[ConditionalAttribute("DEBUG")]`在声明中看到它。[ConditionalAttribute](http://msdn.microsoft.com/en-us/library/system.diagnostics.conditionalattribute.aspx)用于决定是否在编译时实际发出方法调用。

如果条件属性意味着未进行调用，则任何参数评估也将被忽略。这是一个例子：

```
using System;
using System.Diagnostics;

class Test
{
    static void Main()
    {
        Foo(Bar());
    }

    [Conditional("TEST")]
    static void Foo(string x)
    {
        Console.WriteLine("Foo called");
    }

    static string Bar()
    {
        Console.WriteLine("Bar called");
        return "";
    }
} 
```

定义 TEST 时，会调用这两种方法：

```
c:\Users\Jon> csc Test.cs /d:TEST
c:\Users\Jon> test.exe
Bar called
Foo called 
```

当未定义 TEST 时，也不调用：

```
c:\Users\Jon> csc Test.cs /d:TEST
c:\Users\Jon> test.exe 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T16:12:12.747

System.Diagnostics.Debug 类和 DEBUG 定义的方法上的 ConditionalAttribute。

# html - HTML表格：保持列的宽度相同

> ID：570154
> 
> 赞同：84
> 
> 时间：2009-02-20T16:10:13.843
> 
> 标签：html, css

我有一个包含几组列的表。该表比我的页面大，所以我有一个控件来显示/隐藏其中一些组以适应页面。初始表看起来不错：组内所有列的宽度大致相同。但是当我隐藏一个组时，列的宽度不再相同，而且看起来很糟糕。

~~示例：[http](http://www.reviews-web-hosting.com/companies/apollohosting.html)~~ ://www.reviews-web-hosting.com/companies/apollohosting.html （断开的链接）

到目前为止，该表看起来不错。点击>>。“Ecommerce Pro”下的第一列比“Ecommerce Pro”下的其他列宽得多，看起来很奇怪。点击<<，这次“Value”下的第一列太宽了。至少在火狐上。

我试过用

```
<colgroup><col /><col span="5" />... 
```

但没有运气。如果我将 col 设置为 style="display: none"，则仍然显示列集。

任何 HTML/CSS 提示可以使组内的列保持相同的宽度？

**编辑：**

*   要隐藏一列，我必须使用可见性：折叠
*   现在似乎调整大小很好，我不知道为什么

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2009-02-20T22:06:16.123

如果您`table-layout: fixed;`在表格上设置样式，则可以覆盖浏览器的自动列大小调整。然后浏览器将根据表格第一行中单元格的宽度设置列宽。更改您的`<thead>`to`<caption>`并删除`<td>`它的内部，然后为 中的单元格设置固定宽度`<tbody>`。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2015-02-11T20:07:13.187

将此样式赋予 td: width: 1%;

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T17:58:17.437

在您的情况下，因为您只显示 3 列：

```
Name    Value       Business
  or
Name    Business    Ecommerce Pro 
```

为什么不将所有 3 个设置为 33.3% 的宽度。由于一次只显示 3 个，浏览器*应该*将它们都呈现为相似的宽度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T19:54:04.170

好吧，您为什么不（摆脱侧边栏并）挤压表格，使其没有显示/隐藏效果？现在我觉得很奇怪。表太健壮了。
否则，我认为斯昆利夫的建议应该这样做。或者，如果您愿意，您可以设置表格的确切宽度，并为表格单元格设置百分比或像素宽度。

# svn - Build report from tortoise svn client

> ID：570158
> 
> 赞同：3
> 
> 时间：2009-02-20T16:11:11.797
> 
> 标签：svn, reporting

I am looking for a solution to build release notes from svn. What I want is a command line utility or something which can get me all the comments of checked in files from a given date.

Thanks

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T16:30:28.443

Try something like this:

```
svn log -r {2008-05-28}:{2008-12-31} 
```

from inside the working copy.

(See the [Subversion Book](http://svnbook.red-bean.com/en/1.5/svn.tour.revs.specifiers.html#svn.tour.revs.dates) for details)

* * *

Clarification: I believe Tortoisesvn doesn't bring a set of svn command-line binaries with it. You will need to install the [Subversion package from here](http://subversion.tigris.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T16:22:11.693

You can get that using the svn command line tools and the log command:

`svn log svn://server/repos/trunk -r HEAD:{2009-02-19}`

If you want, you can also get an XML formatted output.

see also the SVN Book section on [Revision Dates](http://svnbook.red-bean.com/en/1.0/ch03s03.html#svn-ch-3-sect-3.3)

# security - 限制登录尝试

> ID：570160
> 
> 赞同：19
> 
> 时间：2009-02-20T16:11:30.563
> 
> 标签：security, language-agnostic, login, throttling

（这主要是一个与语言无关的问题，尽管在我的情况下我使用的是 ASP.NET 3.5）

我正在使用标准的 ASP.NET[登录控件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.login.aspx)，并希望实现以下失败的登录尝试限制逻辑。

*   处理[`OnLoginError`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.login.loginerror.aspx)事件并在[Session](http://msdn.microsoft.com/en-us/library/ms972429.aspx)中维护失败登录尝试的计数
*   当此计数达到*[某个可配置值]*时，阻止来自原始 IP 地址或该用户/那些用户的进一步登录尝试 1 小时

这听起来像一个明智的方法吗？我是否错过了可以绕过此类检查的明显方法？

注意：ASP.NET Session 使用 cookie 与用户的浏览器相关联

## 编辑

这适用于仅在英国和印度使用的管理站点

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-20T16:21:14.987

[Jeff Atwood](https://stackoverflow.com/users/1/jeff-atwood)提到了另一种方法：与其在多次尝试后锁定帐户，不如增加时间直到允许再次登录尝试：

```
1st failed login    no delay
2nd failed login    2 sec delay
3rd failed login    4 sec delay
4th failed login    8 sec delay
5th failed login    16 sec delay 
```

这将降低这种保护措施被滥用于拒绝服务攻击的风险。

见[http://www.codinghorror.com/blog/archives/001206.html](http://www.codinghorror.com/blog/archives/001206.html)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-21T15:02:01.080

您要做的最后一件事是将所有不成功的登录尝试存储在数据库中，这将工作得很好，但也使得 DDOS 攻击使您的数据库服务器停机变得极其微不足道。

你可能在你的网络服务器上使用某种类型的服务器端缓存，memcached 或类似的。这些是用于通过 IP 地址和/或用户名跟踪失败尝试的完美系统。如果超过了登录尝试失败的某个阈值，您可以决定停用数据库中的帐户，但是您将为不需要的失败登录计数器保存一堆读取和写入到您的持久存储中坚持。

如果您试图阻止人们强制进行身份验证，那么像 Gumbo 建议的节流系统可能效果最好。它将使攻击者对蛮力攻击不感兴趣，同时在正常情况下甚至在攻击正在进行时最小化对合法用户的影响。我建议只计算 memcached 或类似中 IP 的不成功尝试，如果您成为极端分布式蛮力攻击的目标，您始终可以选择开始跟踪每个用户名的尝试，假设攻击者是实际上经常尝试相同的用户名。只要尝试不是非常分散的，因为仍然来自大量的 IP 地址，初始的 IP 代码应该可以很好地阻止攻击者。

防止来自 IP 地址数量有限的国家/地区的访问者出现问题的关键是不要让您的阈值过于严格；如果您在几秒钟内没有收到多次尝试，那么您可能不必担心重新。脚本暴力破解。如果您更关心人们试图手动解开其他用户的密码，您可以通过用户名为后续失败的登录尝试设置更广泛的界限。

另一个不能回答您的问题但有些相关的建议是对您的最终用户强制执行一定级别的密码安全性。我不会过分要求混合大小写、至少 x 个字符、非字典等密码，因为你不想在他们还没有注册的时候给他们带来太多麻烦，但是简单地阻止人们使用他们的用户名作为他们的密码应该可以在很长一段时间内保护您的服务和用户免受最简单的攻击——猜猜他们为什么称他们为蛮力；）——攻击。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-10-23T16:43:25.993

接受的答案会在连续的登录尝试中插入越来越多的延迟，在 ASP.NET 中可能会执行得很差，具体取决于它的实现方式。ASP.NET 使用线程池来处理请求。一旦这个线程池用完，传入的请求将排队，直到有一个线程可用。

如果您使用 Thread.Sleep(n) 插入延迟，您将在延迟期间占用一个 ASP.NET 线程池线程。该线程将不再可用于执行其他请求。在这种情况下，一个简单的 DOS 样式攻击将是继续提交您的登录表单。最终，每个可用于执行请求的线程都将处于休眠状态（并且时间会越来越长）。

我能想到的正确实现这种延迟机制的唯一方法是使用异步 HTTP 处理程序。请参阅[演练：创建异步 HTTP 处理程序](http://msdn.microsoft.com/en-us/library/ms227433.aspx)。实施可能需要：

1.  在 BeginProcessRequest 期间尝试身份验证并确定失败时的延迟
2.  返回一个 IAsyncResult 暴露一个 WaitHandle 将在延迟后触发
3.  确保在 EndProcessRequest 中已触发 WaitHandle（或阻塞直到触发）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-20T16:18:44.697

这也可能会影响您的真正用户。例如。在新加坡等国家/地区，可供家庭用户使用的 ISP 数量有限，IP 数量较少。

或者，您可以在 x 尝试阻止脚本小子失败后插入验证码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-20T16:19:46.160

我认为您需要将计数保留在会话之外 - 否则微不足道的攻击是在每次登录尝试之前清除 cookie。

否则计数和锁定是合理的 - 尽管更简单的解决方案可能是在每次登录失败之间设置双倍超时。即第一次登录尝试后 2 秒，下次登录后 4 秒，8 等。

您可以通过在超时期限内拒绝登录来实现超时 - 即使用户提供了正确的密码 - 只需回复人类可读的文本，说明该帐户已被锁定。

还监视相同的 ip/不同的用户和相同的用户/不同的 ip。

# ruby-on-rails - 对 HABTM 关系中的对象使用 collection_select 视图助手

> ID：570164
> 
> 赞同：1
> 
> 时间：2009-02-20T16:12:01.717
> 
> 标签：ruby-on-rails

模型*项目*和*类别*处于 has_and_belongs_to_many 关系。下面看到的部分用于不同的视图，以显示包含所有可用类别的下拉菜单。下拉菜单下方列表中的项目根据用户在下拉菜单中所做的选择显示。

除了其他类别之外，还有一个名为“Everything”的类别，每个项目都是其中的成员。它也是 category-db-table 中的第一个条目，因为它是在将迁移加载到数据库时插入的。

现在没有错误，但无论我选择哪个类别，它都会重新加载显示“Everything”类别的页面。

知道我需要在下面提到的代码中更改什么以使其按我想要的方式工作吗？谢谢你的帮助！

**带有下拉菜单和项目列表的部分**

```
<!-- category dropdown -->
<% form_for category_url(:id), :html => {:method => :get} do |f| %>
    <label>Categories</label>
     <%= f.collection_select(:category_ids , Category.find(:all), :id , :name) %>
     <%= f.submit "Show" %>
<% end %>

<!-- project list -->
<ul class="projectlist">
  <% @projects.each do |_project| %>
    <li>
      <%= link_to(_project.name, _project) %>
    </li>
  <% end %>
</ul> 
```

**在下拉菜单中选择 id 为 2 的类别后的日志输出**

```
Processing ProjectsController#index (for 127.0.0.1 at 2009-02-20 17:26:10) [GET]
  Parameters: {"commit"=>"Show", "http://localhost:3000/categories/id"=>{"category_ids"=>"2"}} 
```

**类别模型**

```
class Category < ActiveRecord::Base
  has_and_belongs_to_many :projects, :join_table => "categories_projects"
end 
```

**类别控制器**

```
class CategoriesController < ApplicationController
  def show
    @projects = Category.find(params[:id]).projects.find(:all)

    respond_to do |format|
      format.html # show.html.erb
    end
  end
end 
```

**项目模型**

```
class Project < ActiveRecord::Base
  has_and_belongs_to_many :categories, :join_table => "categories_projects"
end 
```

**项目控制器**

```
class ProjectsController < ApplicationController
  def show
    @projects = Project.find(:all)
    @project = Project.find(params[:id])

    respond_to do |format|
      format.html # show.html.erb
    end
  end

  def index
    @projects = Project.find(:all)

    respond_to do |format|
      format.html # index.html.erb
    end
  end
end 
```

**'rake routes' 输出的一部分**

```
category GET    /categories/:id  {:controller=>"categories", :action=>"show"} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T22:21:08.647

您正在传递一个名为 的参数`:category_ids`，但您没有在任何地方访问它。

```
form_for category_url(:id) 
```

这会将您的表单提交到路径`/categories/1`或您当前正在查看的任何 id。然后，您将使用*它* `:id`来查找您的类别项目：

```
@projects = Category.find(params[:id]).projects.find(:all) 
```

因此，您只是再次显示相同的内容。因为它是一个表单，所以您使用 :category_ids 参数提交查询：

```
POST /categories/1?category_ids=2 
```

您可以更改 Category.find 以改用其他参数。但是，通常要查看类别 2，您只需使用 url `/categories/2`，其中 2 是您的 :id 参数。您在该路径中有两个 id，您应该决定如何解决该问题。

一种选择是使用`categories_path`表单操作，并将 collection_select :category_ids 参数更改为 just `:id`：

```
/categories?id=2  # from the form
/categories/2     # from a link 
```

但是，如果您只是列出项目，我会将此逻辑移动到项目控制器（索引操作）中，因此您的 URL 如下所示：

```
/projects?category_id=2` # from the form
/categories/2/projects   # from a link 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T20:40:57.670

谢谢安德鲁，但我自己解决了这个问题：

我摆脱了*collection_select*，改为*select*，添加了过滤器操作（在 config/routes.rb 中有相应的路由），现在一切都按我预期的那样工作。

...我试图在选择菜单上获得一个观察者，只要用户更改选择菜单中的选择，它就会将其值提交给过滤器操作，但这是另一回事。;-)

**带有下拉菜单和项目列表的新部分**

```
 <% form_tag(filter_category_path(:id), :method => :post, :class => 'categories') do %>
       <label>Categories</label>
       <%= select_tag(:category, options_for_select(Category.all.map {|category| [category.name, category.id]}, @category.id)) %>
       <%= submit_tag "Go" %>
     <% end %>

   <ul class="projects">
     <% @projects.each do |_project| %>
       <li>
         <%= link_to(_project.name, _project) %>
       </li>
     <% end %>
   </ul> 
```

**新类别控制器**

```
class CategoriesController < ApplicationController
  def show
    @category = Category.find(params[:id])
    @projects = @category.projects.find(:all)

    respond_to do |format|
      format.html 
    end
  end

  def filter
    @category = Category.find(params[:category])
    @projects = @category.projects.find(:all)

    respond_to do |format|
      format.html
    end    
  end
end 
```

# php - 为什么有这么多 PHP 站点只提供 MySQL 作为数据库？

> ID：570166
> 
> 赞同：2
> 
> 时间：2009-02-20T16:12:08.333
> 
> 标签：php, mysql

我曾涉足 MySQL，就个人而言，我发现它远不如 Postgres 等更好的 RDBMS；虽然我承认它已经走了很长一段路并得到了改进，但据我所知，即使是最新版本甚至也不支持`CHECK`验证数据完整性的约束（它允许使用关键字，但不做任何事情）。

作为一个正在考虑从 Microsoft 技术转向开源的人，我对**仅**使用 MySQL 作为底层数据库的 PHP 支持的应用程序的数量感到震惊。其中许多应用程序非常好，可以节省大量开发工作，但事实上它们没有被抽象为与数据库无关，这对我和我的技术同事来说通常是一个交易杀手。

所以我很好奇——我明白为什么 MySQL 如此受欢迎以及为什么它几乎总是与 PHP 一起使用，但为什么这么多 PHP 支持的网站拒绝正确开发以允许其他数据库，而是在有更好的时候强制使用 MySQL还有更多“类似数据库”的选项？我对这些我想使用的应用程序越来越感到沮丧，但它们只适用于 MySQL，我不会让自己使用它，因为我个人认为 Postgres 是一个更好的数据库，而且我个人认为你的数据库应该强制执行它自己的约束，而不是仅在代码级别执行此操作。

我意识到 MySQL 很受欢迎，而且它不是一个*糟糕*的系统，但我讨厌当我找到一个很棒的应用程序时，它只会在数据库是 MySQL 时工作，因为开发人员使用 MySQL 特定的模块和/或语法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T16:16:05.717

我相信这也是有这么多只支持 MSSQL 的 ASP.NET 的原因。它是按照惯例与语言配对的传统数据库。另外，使用/构建独立于数据库的解决方案很困难，而且当大多数其他人都遵循该约定时，这是“你不需要”的事情之一。当它需要它时，它可能是“页面错误”的那些东西之一。

如果你需要一个 php 应用程序来使用另一个数据库，php 可能是开源的，也许你可以自己做这项工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T16:20:40.340

`Cross-platform support`，只要`SQL`是关心，就像**鸭子**一样。

你知道，**鸭子会走路、会飞、会游泳——而且做这一切同样糟糕**。

固守一个平台，开发一个优化好的应用程序，然后努力满足所有人，实际上满足noboby，要好得多。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T16:23:35.857

大多数 PHP 开发人员使用 PHP 进行开发是因为它免费、易于上手且功能强大。所有相同的品质都与 MySQL 共享，所以它很自然。

话虽如此，许多专业开发人员创建了数据抽象层，使他们能够轻松地与其他后端集成。但是大多数项目不需要这些类型的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T16:23:18.430

这主要是因为几乎所有支持 PHP 的共享托管服务都提供 MySQL 并且只有 MySQL。当几乎没有人使用应用程序时，抽象数据库的额外工作通常被认为是不必要*的*。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T16:29:13.923

LAMP 是一个极其常见的开发堆栈。很常见，即使不使用 PHP 的人也知道 LAMP 代表什么。

对于那些不知道的人（你们所有人），LAMP 最常代表**L** inux、**A** pache、**M** ySQL 和**P** HP。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T16:24:15.307

我认为关键点正是您所说的，“它几乎总是与 PHP 一起使用”。通过为 MySQL 开发，他们最大限度地扩大了目标受众。是的，如果他们将其开发为能够与多个数据库一起使用，那将是理想的，但这可能是相当多的额外工作。许多这些项目只是从某人的个人项目中发展而来的，该项目最初可能不是为了与多个引擎兼容而设计的。一旦他们走得很远，重写代码以支持多个数据库系统就开始变成一项主要工作，并且通常还有他们的用户希望拥有的其他功能/修复。

我也非常喜欢 pgsql，但我认为如果您打算使用其他人的 PHP 应用程序（论坛、博客等），那么您可能必须运行 MySQL 来支持它们，这只是现实。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T16:25:08.877

回到过去，易用性存在巨大差异。MySQL 易于使用，并且对于简单的任务非常快速。那时它没有提供完整的 ACID、触发器、子选择和过程。另一方面，你有 PostgreSQL（当时称为 Postgres），它速度慢得多，安装和维护起来很复杂，但提供了真正的 RDBMS 的全部功能。问题是，Web 应用程序并不真正需要 RDBMS 的全部功能，因此 MySQL 获得了极大的普及，而 PostgreSQL 则很少有人使用。

啊，还有一件事：从 PHP5 开始嵌入 SQLite。所以我预计很快会有很多不需要完整 RDBMS 的新 PHP 应用程序将使用 SQLite，而不是 MySQL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T16:30:08.633

你是对的，PostgreSQL 对 SQL 和其他高级特性有更好的支持，所以有一个很好的例子来说明为什么 PostgreSQL 优于 MySQL。

然而，对于刚入门的人来说，MySQL 更容易安装和管理，相对于 PostgreSQL，它获得了很多采用。与 MySQL 相比，在 PostgreSQL 服务器上配置登录和赋予特定权限等简单任务非常令人困惑。

此外，早在几年前，MySQL 就为 Windows 提供了本机二进制文件，但 PostgreSQL 没有。你可以让它在 Cygwin 下工作，但这对于真正的 Windows 开发人员来说很难令人满意。到 PostgreSQL 确实原生支持 Windows 时，MySQL 在市场份额和知名度方面已经取得了巨大的领先优势。

顺便说一句： [http ://www.postgresql.org/support/professional_hosting_northamerica](http://www.postgresql.org/support/professional_hosting_northamerica)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T16:51:19.720

IMO 这么多仅 MySQL 的网站的最大问题是 MySQL 不支持“真实”数据库的一半功能，因此如果您需要数据完整性，那么您几乎搞砸了，将不得不编写自己的软件而不是利用现有的解决方案，或者破坏您的应用程序并且在数据库级别没有任何真正的完整性检查。你最终在一块岩石和一个坚硬的地方之间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T21:16:10.550

我们想要我们的蛋糕，也带着这个问题吃掉它。首先，我们需要数据库抽象。然后，我们想要在我们选择在该抽象后面使用的 RDBMS 中的 CHECK 约束。

嗯？这意味着我们将忽略在 PHP 本身中进行数据检查，并且使用没有 CHECK 的数据库会出现问题。要么这样，要么我们将在 PHP 中实现检查以支持没有检查的抽象数据库，做两倍的工作。

我认为完整的数据库抽象不值得付出努力，并且主要是寻找问题的解决方案。

# java - 将字节从一个 ByteBuffer 传输到另一个

> ID：570168
> 
> 赞同：6
> 
> 时间：2009-02-20T16:12:24.370
> 
> 标签：java, javadoc, nio

将尽可能多的字节从 ByteBuffer`bbuf_src`放入另一个 ByteBuffer的最有效方法是什么`bbuf_dest`（以及知道传输了多少字节）？我正在尝试`bbuf_dest.put(bbuf_src)`，但它似乎想抛出一个 BufferOverflowException 并且当我需要它们时，我现在无法从 Sun 获取 javadocs（网络问题）。>:(啊。

* * *

编辑：darnit，如果 bbuf_src 是只读缓冲区，@Richard 的方法（使用支持数组中的 put() `bbuf_src`）将不起作用，因为您无法访问该数组。这种情况下我能做什么？？？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-10-12T23:28:12.213

正如您所发现的，获取支持数组并不总是有效（对于只读缓冲区、直接缓冲区和内存映射文件缓冲区，它会失败）。更好的选择是复制源缓冲区并为要传输的数据量设置新的限制：

```
int maxTransfer = Math.min(bbuf_dest.remaining(), bbuf_src.remaining());
// use a duplicated buffer so we don't disrupt the limit of the original buffer
ByteBuffer bbuf_tmp = bbuf_src.duplicate ();
bbuf_tmp.limit (bbuf_tmp.position() + maxTransfer);
bbuf_dest.put (bbuf_tmp);

// now discard the data we've copied from the original source (optional)
bbuf_src.position(bbuf_src.position() + maxTransfer); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T16:58:50.450

好的，我改编了@Richard 的回答：

```
public static int transferAsMuchAsPossible(
                     ByteBuffer bbuf_dest, ByteBuffer bbuf_src)
{
  int nTransfer = Math.min(bbuf_dest.remaining(), bbuf_src.remaining());
  if (nTransfer > 0)
  {
    bbuf_dest.put(bbuf_src.array(), 
                  bbuf_src.arrayOffset()+bbuf_src.position(), 
                  nTransfer);
    bbuf_src.position(bbuf_src.position()+nTransfer);
  }
  return nTransfer;
} 
```

并进行测试以确保其正常工作：

```
public static boolean transferTest()
{
    ByteBuffer bb1 = ByteBuffer.allocate(256);
    ByteBuffer bb2 = ByteBuffer.allocate(50);
    for (int i = 0; i < 100; ++i)
    {
        bb1.put((byte)i);
    }
    bb1.flip();
    bb1.position(5);
    ByteBuffer bb1a = bb1.slice();
    bb1a.position(2);
    // bb3 includes the 5-100 range
    bb2.put((byte)77);
    // something to see this works when bb2 isn't empty
    int n = transferAsMuchAsPossible(bb2, bb1a);
    boolean itWorked = (n == 49);

    if (bb1a.position() != 51)
        itWorked = false;
    if (bb2.position() != 50)
        itWorked = false;
    bb2.rewind();
    if (bb2.get() != 77)
        itWorked = false;
    for (int i = 0; i < 49; ++i)
    {
        if (bb2.get() != i+7)
        {
            itWorked = false;
            break;
        }
    }
    return itWorked;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T16:33:00.387

你得到 BufferOverflowException 因为你的 bbuf_dest 不够大。

您需要使用 bbuf_dest.remaining() 来找出可以从 bbuf_src 传输的最大字节数：

```
int maxTransfer = Math.min(bbuf_dest.remaining(), bbuf_src.remaining());
bbuf_dest.put(bbuf_src.array(), 0, maxTransfer); 
```

# html - 哪个 HTML 元素具有最多的某种类型的子元素，例如标签？

> ID：570172
> 
> 赞同：1
> 
> 时间：2009-02-20T16:12:51.967
> 
> 标签：html, language-agnostic, xslt, xpath

在任何语言中，[XSLT](http://en.wikipedia.org/wiki/XSL_Transformations)、PHP、Ruby、Perl 等任何语言：如何获取包含最多`<p>`标签的元素的 XPath 或其他路径或标识符？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T17:22:29.707

此答案假定 html 输入是格式良好的 XML 文档（例如 XHtml 文档）。

**在 XSLT 1.0 中：**

给定以下 XML

```
<html>
    <div id='A1'>
        <p/>
        <p/>
    </div>
    <div id='A2'>
        <p/>
        <p/>
        <p/>
        <p/>
    </div>
    <div id='A3'>
        <p/>
        <p/>
        <p/>
    </div>
</html> 
```

**此转换生成具有最多`p`子**元素的元素：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes"/>

 <xsl:key name="kElByP" match="*" use="boolean(p)"/>

    <xsl:template match="/*">
      <xsl:for-each select="key('kElByP', 'true')">
        <xsl:sort data-type="number" order="descending"
         select="count(p)"/>

         <xsl:if test="position() = 1">
           <xsl:copy-of select="."/>
         </xsl:if>
      </xsl:for-each>
    </xsl:template>
</xsl:stylesheet> 
```

**当对 XML 文档应用上述转换时，会产生正确的结果**：

```
<div id="A2">
        <p />
        <p />
        <p />
        <p />
    </div> 
```

**使用 XPath 2.0：**

```
//*[count(p) = max(//*/count(p))] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T16:29:03.737

您可以使用 getElementsByTagName 来查找您的 <p> 并遍历结果以使用 Javascript 找到 childNodes.length 的最大值（假设您可以选择在客户端执行此操作）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T16:51:31.327

答案取决于语言。例如，JavaScript 可以自然地处理查看 HTML DOM，并且有诸如 ProtoType 之类的库可以快速处理它。同样，Garann 的回答会让您上路。

在其他语言中，我建议使用正则表达式来查找其中包含段落标签的标签。这可能涉及将整个 html 转换为单个字符串并对其进行处理。

假设它是格式正确的 HTML，您可以删除所有内容，只留下标签。首先这样做会使后续步骤更快。那么这可能是一些循环和一些计数器的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T17:06:03.040

Perl 中一个非常暴力的解决方案，使用 XML::Twig：

```
#!/usr/bin/perl

use strict;
use warnings;

use XML::Twig;

my $max=0; # max number of p's
my $path;  # path to the element

XML::Twig->new( twig_handlers => 
                  { # _all_ is called for every single element in the XML
                    _all_ => sub { # $_ is the element
                                   my $nb_p= $_->children( 'p'); 
                                   if( $nb_p > $max)
                                     { $max= $nb_p; 
                                       $path= $_->xpath;
                                     }
                                 }
                  },
              )
         ->parsefile( $ARGV[0]);
print "$path  ($max p)\n"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-21T15:22:02.883

在尝试构建这是一个递归设计之后......我看到了简单的 2.0 解决方案。那好吧。无论如何，另一种解决方案。

```
<xsl:template match="/">
    <xsl:variable name="MaxElements">
            <xsl:call-template name="MaxElements">
                <xsl:with-param name="elements" select="//div[p]"/>
                <xsl:with-param name="largestSoFar" select="0"/>
            </xsl:call-template>
    </xsl:variable>
    <xsl:value-of select="$MaxElements"/>
</xsl:template>
<xsl:template name="MaxElements">
    <xsl:param name="elements"/>
    <xsl:param name="largestSoFar"/>
    <xsl:choose>
        <xsl:when test="$elements">
            <xsl:variable name="CurrentNumber" select="count($elements[1]/p)"/>
            <xsl:variable name="LargerNumber" select="if ($CurrentNumber > $largestSoFar) then ($CurrentNumber) else $largestSoFar"/>
            <xsl:call-template name="MaxElements">
                <xsl:with-param name="elements" select="$elements[position()>1]"/>
                <xsl:with-param name="largestSoFar" select="$LargerNumber"/>
            </xsl:call-template>
        </xsl:when>
        <xsl:otherwise>
            <xsl:value-of select="$largestSoFar"/>
        </xsl:otherwise>
    </xsl:choose>
</xsl:template> 
```

# c# - 从原始 HTML/CSS 内容从 ASP.NET 生成 PDF？

> ID：570179
> 
> 赞同：10
> 
> 时间：2009-02-20T16:14:20.603
> 
> 标签：c#, asp.net, html, pdf

我正在发送以 PDF 格式附加发票的电子邮件。我已经 - 在应用程序的其他地方 - 在 .aspx 页面中创建发票。我想使用 Server.Execute 返回输出 HTML 并从中生成 PDF。否则，我必须使用报告工具在 PDF 上“绘制”发票。这有很多原因，其中最重要的原因是我必须为每个微小的更改更新 .aspx 页面和报告。该怎么办...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T16:14:55.970

无法直接在 .NET 中从 HTML 字符串生成 PDF，但有许多第三方控件可以正常工作。

我在这个方面取得了成功： http: [//www.html-to-pdf.net](http://www.html-to-pdf.net) 和这个：[http ://www.htmltopdfasp.net](http://www.htmltopdfasp.net)

要问的重要问题是：

1.  与 IE、FF 和 Safari/Chrome 三大浏览器相比，它是否正确呈现？
2.  它可以很好地处理 CSS 吗？
3.  控件是否有自己的渲染引擎？如果是这样，反弹它。你不想相信一个自制的渲染引擎 - 浏览器有一个很难让所有像素完美的问题。
4.  第三方控件需要哪些依赖项？越少越好。

还有一些其他的，但它们处理 ActiveX 显示等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T20:17:30.537

我们为此使用了一个名为 ABCPDF 的产品，它的效果非常好。

[http://www.websupergoo.com/abcpdf-1.htm](http://www.websupergoo.com/abcpdf-1.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T20:21:01.120

这听起来像是[Prince](http://www.princexml.com/)的工作。它可以采用 HTML 和 CSS 并生成 PDF，然后您可以将其呈现给您的用户。它比大多数 Web 浏览器更好地支持 CSS3（工作人员包括 CSS 的发明者 Håkon Wium Lie）。

查看[示例](http://www.princexml.com/samples/)，尤其是 Wikipedia 页面的示例，了解它可以生成的精美输出。还有一个有趣的[谷歌技术谈话](http://www.youtube.com/watch?v=vcXUrNSvjhU)与作者。

***编辑：***有一个[.NET 包装器](http://www.princexml.com/download/accessories/)可用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-03-09T01:43:52.583

[wkhtmltopdf](http://wkhtmltopdf.org)是一个免费且酷的 exe，用于从 html 生成 pdf。它是用 C++ 编写的。但是[nReco htmltopdf](http://www.nrecosite.com/pdf_generator_net.aspx)是这个很棒的工具的包装 dotnet 库。我使用这个 dotnet 库实现了它，它非常好，它自己做所有事情，你只需要提供 html 作为数据源。

```
/// <summary>
/// Converts html into PDF using nReco dll and wkhtmltopdf.exe.
/// </summary>       
private byte[] ConvertHtmlToPDF()
{
  HtmlToPdfConverter nRecohtmltoPdfObj = new HtmlToPdfConverter();
  nRecohtmltoPdfObj.Orientation = PageOrientation.Portrait;
  nRecohtmltoPdfObj.PageFooterHtml = CreatePDFFooter();
  nRecohtmltoPdfObj.CustomWkHtmlArgs = "--margin-top 35 --header-spacing 0 --margin-left 0 --margin-right 0";           
  return nRecohtmltoPdfObj.GeneratePdf(CreatePDFScript() + ShowHtml() + "</body></html>");
} 
```

上面的函数摘自下面的链接帖子，详细解释了它。 [ASP.Net 中的 HTML 到 PDF](https://deepasp.wordpress.com/2015/03/08/html-to-pdf-in-asp-net/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-09-22T14:42:58.277

最初的问题是将另一个包含发票的 aspx 页面转换为 PDF 文档。发票可能正在使用一些会话数据，用户建议使用***Server.Execute()***获取发票页面 HTML 代码，然后将该代码转换为 PDF。直接转换发票页面 URL 是不可能的，因为在转换过程中会创建一个新会话并且会话数据会丢失。

这实际上是一种在转换期间保留会话数据的好技术，该技术在 EvoPdf 库的[相同会话 ASP.NET 演示中将 HTML 页面转换为 PDF 中应用。](http://www.evopdf.com/demo/HTML_to_PDF/Convert_Page_in_Same_Session.aspx)获取发票页面呈现的 HTML 字符串并将该字符串转换为 PDF 的完整 C# 代码是：

```
// Execute the invoice page and get the HTML string rendered by this page
TextWriter outTextWriter = new StringWriter();
Server.Execute("Invoice.aspx", outTextWriter);

string htmlStringToConvert = outTextWriter.ToString();

// Create a HTML to PDF converter object with default settings
HtmlToPdfConverter htmlToPdfConverter = new HtmlToPdfConverter();

// Use the current page URL as base URL
string baseUrl = HttpContext.Current.Request.Url.AbsoluteUri;

// Convert the page HTML string to a PDF document in a memory buffer
byte[] outPdfBuffer = htmlToPdfConverter.ConvertHtml(htmlStringToConvert, baseUrl);

// Send the PDF as response to browser

// Set response content type
Response.AddHeader("Content-Type", "application/pdf");

// Instruct the browser to open the PDF file as an attachment or inline
Response.AddHeader("Content-Disposition", String.Format("attachment; filename=Convert_Page_in_Same_Session.pdf; size={0}", outPdfBuffer.Length.ToString()));

// Write the PDF document buffer to HTTP response
Response.BinaryWrite(outPdfBuffer);

// End the HTTP response and stop the current page processing
Response.End(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T19:59:56.177

只要确保使用正确的 XHTML，也可以使用[Alt-Soft 的 Xml2PDF 之](http://www.alt-soft.com/)类的产品，通过 XSLT/XSL-FO 将 XML (XHTML) 转换为 PDF。

掌握它需要一些学习曲线，但是一旦你“掌握”它，它就会很好地工作！

马克

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-21T14:34:04.317

由于您正在生成答案，因此您可以使用 Report.NET 之类的工具：http: [//sourceforge.net/projects/report/](http://sourceforge.net/projects/report/)

我不同意那些说您不能直接从输出转换为 PDF 的答案，但是，因为您可以“重新调用”页面并将 HTML 作为流获取并进行转换。但是，我不确定您要使用什么工具来执行此操作。换句话说，这是可能的，但我不确定它是否值得。PDF 创建库，如 Report.NET，即使它们强制重用某些逻辑并且没有自动转换，它也更容易。

我还没有尝试过这个组件，但我从那些尝试过的人那里听说了它的好消息。该模型更像 HTML，但我不确定您是否可以简单地将渲染的 ASPX 发送给它以创建 PDF： [http ://www.websupergoo.com/abcpdf-8.htm](http://www.websupergoo.com/abcpdf-8.htm)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-04T11:01:41.113

如果你尝试通过**GOOGLE**找到一些 html 到 pdf 的软件，你会得到一堆这样的东西。大约有 10 个领导者，但他们中的大多数在后台模式下使用 IE dll。他们中只有几个使用自己的解析引擎。如果您希望以编程方式创建 PDF，请在您的 ASP.NET 项目中尝试[PDF Duo .NET组件。](http://www.duodimension.com/html_pdf_asp.net/component_html_pdf.aspx)它是用于生成 PDF 调用的轻量级组件，例如报告

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-25T00:33:33.663

我会走不同的路线。假设您使用的是 SQL Server，请使用 SSRS 并以这种方式生成 PDF。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-10-06T09:22:03.077

使用 Server.Execute() 获取发票页面的 HTML 并使用[winnovative html to pdf api for .net](http://www.winnovative-software.com/)将该代码转换为 PDF 的一种可能的最小解决方案是：

```
TextWriter outTextWriter = new StringWriter();
Server.Execute("Invoice.aspx", outTextWriter);

HtmlToPdfConverter htmlToPdfConverter = new HtmlToPdfConverter();

byte[] pdfBytes = htmlToPdfConverter.ConvertHtml(outTextWriter.ToString(),
            httpContext.Current.Request.Url.AbsoluteUri); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-06T09:26:22.323

您可以使用 PDFSharp 或 iTextSharp 将 html 转换为 pdf。PDFSharp 不是免费的。

# perl - 我可以在 shebang 行中使用 perl 的开关和 /bin/env 吗？

> ID：570183
> 
> 赞同：17
> 
> 时间：2009-02-20T16:15:52.753
> 
> 标签：perl, command-line, scripting, system

我想`perl -w`使用`env`. 这在*命令行*上工作正常：

```
$ /bin/env perl -we 'print "Hello, world!\n"'
Hello, world! 
```

但它不适用于脚本中的 shebang 行：

```
#!/bin/env perl -w
print "Hello, world!\n"; 
```

这是错误：

```
/bin/env: perl -w: No such file or directory 
```

显然`env`不明白`-w`我传递给的标志`perl`。怎么了？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-20T16:37:27.583

hash-bang 不是普通的 shell 命令行，解析和空格处理是不同的——这就是你所遇到的。看：

*   [http://www.in-ulm.de/~mascheck/various/shebang/](http://www.in-ulm.de/~mascheck/various/shebang/)
*   [http://homepages.cwi.nl/~aeb/std/hashexclam-1.html#ss1.3](http://homepages.cwi.nl/~aeb/std/hashexclam-1.html#ss1.3)
*   [http://en.wikipedia.org/wiki/Shebang_(Unix)](http://en.wikipedia.org/wiki/Shebang_(Unix))

基本上许多/大多数unix将第一个空格之后的所有剩余文本放入一个参数中。

所以：

```
#!/bin/env perl -w 
```

相当于：

```
/bin/env "perl -w" 
```

所以你需要以其他方式处理 perl 解释器的任何选项。IE

```
use warnings; 
```

（如[@Telemachus](https://stackoverflow.com/questions/570183/-bin-env-perl-w/570192#570192)）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-20T16:17:38.227

而不是`-w`使用警告编译指示（对于现代版本的 Perl）：

```
#!/bin/env perl
use warnings;
use strict; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-27T02:01:00.567

我认为提出“-w”与“使用警告”不同可能会很有用。-w 将适用于您使用的所有包，“使用警告”仅适用于词法。您通常不想使用或依赖“-w”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-28T03:10:27.383

值得注意的是，Mac OS X 将 shebang 之后的字符解释为参数，因此在 OS X 上，以下将起作用：

```
#!/usr/bin/env perl -wT
enter code here 
```

但是，由于使用 #!/usr/bin/env 的目的之一是促进跨平台兼容性，因此即使您主要使用 Mac，也最好不要使用该语法。

# xml - 如何在没有 IIS 的情况下部署我的 WCF 服务？

> ID：570190
> 
> 赞同：11
> 
> 时间：2009-02-20T16:17:12.610
> 
> 标签：xml, wcf, deployment

我正在做一些快速的 Java-.NET 互操作，并决定使用 WCF 进行 POX。但是，我不想——也无权访问——部署到 IIS。

将其包装为 .NET 服务是否可行？（多年来，我已经建立了相当多的 Windows 服务。）

这附近有什么好的样本吗？

如果我不使用 IIS，什么会处理 HTTP？

我愿意接受任何允许我创建简单的基于 http 的 xml 合同的建议。

此外，重要的是要注意这只会暴露给内部服务器场，因此安全性和所有这些都非常小。

（由于所有博客垃圾邮件，搜索 Google 并不能提供很好的结果。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T16:21:53.223

您可以将其部署为 Windows 服务并公开一个 http 端点。检查以下网址。

[http://msdn.microsoft.com/en-us/library/ms751414.aspx](http://msdn.microsoft.com/en-us/library/ms751414.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-20T16:22:08.010

如果您已经习惯编写 Windows 服务，那么这可能是您最好的选择。我相信 WCF 本身可以处理 IIS 之外的 HTTP 内容。

[Michele Bustamante 在她出色的“ Learning WCF](http://oreilly.com/catalog/9780596101626/index.html) ”一书中有一个关于设置 Windows 服务的教程。

本文[介绍](http://msdn.microsoft.com/en-us/library/bb332338.aspx#msdnwcfhc_topic4)了托管 WCF 服务的不同方法。它提到了 VS2005，但 VS2008 足够相似，您应该能够跟随。

# wpf - WPF 中的焦点数据模板

> ID：570194
> 
> 赞同：1
> 
> 时间：2009-02-20T16:18:00.797
> 
> 标签：wpf, xaml, focus, datatemplate

我正在寻找的行为是在 ListView 中选择 Item 会导致聚焦第一个可聚焦的 visualchild。

问题：ItemsControler 中的数据模板化数据没有获得初始焦点。在下面的示例中，有 4 个字符串，然后通过 Datatemplate 填充到 TextBox 中。

例子：

```
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
        xmlns:sys="clr-namespace:System;assembly=mscorlib" 
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
   <Grid>
      <ListView>
         <ListView.Resources>
            <DataTemplate DataType="{x:Type sys:String}" >
               <TextBox Width="100" Text="{Binding Mode=OneWay}"/>
            </DataTemplate>
         </ListView.Resources>
         <ListView.ItemsSource>
            <x:Array Type="{x:Type sys:String}">
               <sys:String>test</sys:String>
               <sys:String>test</sys:String>
               <sys:String>test</sys:String>
               <sys:String>test</sys:String>
            </x:Array>
         </ListView.ItemsSource>
      </ListView>
   </Grid>
</Window> 
```

我已经尝试了一些组合

```
FocusManager.FocusedElement="{Binding ElementName=[...]}" 
```

无意义的说：没有成功。任何人都知道如何在不遍历 c# 中的可视化树的情况下获得我想要的东西？应该可以做到这一点，不是吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-10T00:36:41.067

FocusManager 对此很有效。

```
 <DataTemplate x:Key="MyDataTemplate" DataType="ListBoxItem">
            <Grid>
                <WrapPanel Orientation="Horizontal" FocusManager.FocusedElement="{Binding ElementName=tbText}">
                    <CheckBox IsChecked="{Binding Path=Completed}" Margin="5" />
                    <Button Style="{StaticResource ResourceKey=DeleteButtonTemplate}" Margin="5" Click="btnDeleteItem_Click" />
                    <TextBox Name="tbText" 
                             Text="{Binding Path=Text}" 
                             Width="200" 
                             TextWrapping="Wrap" 
                             AcceptsReturn="True" 
                             Margin="5" 
                             Focusable="True"/>
                    <DatePicker Text="{Binding Path=Date}" Margin="5"/>
                </WrapPanel>
            </Grid>
        </DataTemplate> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T18:02:23.340

在 C# 中使用绑定语法将不起作用，因为这是在 XAML 中描述绑定的方式。它可能会创建 的新实例`System.Windows.Data.Binding`，并将其属性设置为您在 XAML 中设置的等价物，但我不确定`ElementName`您可以绑定什么以使其正常工作。

我能想到的唯一其他选择是为`SelectionChanged`事件添加一个处理程序，并手动设置焦点，但这听起来不像您想要的解决方案。

经过进一步检查，我认为绑定解决方案是不可能的。`FocusManager.FocusedElement`是一个`IInputElement`，它没有任何与绑定相关的成员。我认为您需要遍历视觉树才能找到第一个可聚焦的对象。像这样的东西应该工作：

```
// Event handler for the ListBox.SelectionChanged event
private void ListBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    ListBox listBox = sender as ListBox;
    ItemContainerGenerator = generator.listBox.ItemContainerGenerator;
    ListBoxItem selectedItem =
        (ListBoxItem)generator.ContainerFromIndex(listBox.SelectedIndex);
    IInputElement firstFocusable = FindFirstFocusableElement(selectedItem);
    firstFocusable.Focus();
}

private IInputElement FindFirstFocusableElement(DependencyObject obj)
{
    IInputElement firstFocusable = null;

    int count = VisualTreeHelper.GetChildrenCount(obj);
    for(int i = 0; i < count && null == firstFocusable; i++)
    {
        DependencyObject child = VisualTreeHelper.GetChild(obj, i);
        IInputElement inputElement = child as IInputElement;
        if(null != inputElement && inputElement.Focusable)
        {
            firstFocusable = inputElement;
        }
        else
        {
            firstFocusable = FindFirstFocusableElement(child);
        }
    }

    return firstFocusable;
} 
```

# wcf - WCF/Silverlight/SQL 数据库缓存策略

> ID：570215
> 
> 赞同：3
> 
> 时间：2009-02-20T16:23:00.367
> 
> 标签：wcf, silverlight, caching

好的，我有一个非常复杂的 Silverlight 应用程序，它从 WCF 服务（asp.net 托管服务层）获取其数据，该服务又调用一个数据层，该数据层调用 SQL 2005 DB 中的存储过程以提取所需的数据。所以往返是这样的：

Silverlight App --> WCF 服务 --> 数据层 --> DB --> 数据层 --> WCF 服务将数据实体转换为相应的 DTO（数据传输对象）或其列表<> --> Silverlight 应用程序

许多数据是高度相关的（因此它需要存在于数据库中），但它不会经常更改。似乎我有几个位置可供选择来缓存这个“半常数”数据：

1.  我可以将其缓存在数据层中。我的数据层已经设置为使用 SQLDependency 类并缓存存储过程调用的结果。我认为这是或可以是应用程序级缓存。
2.  我可以在 WCF 服务本身的应用程序级别（或会话级别，取决于调用）缓存中缓存生成的 DTO。2(a) 我什至可以更进一步，将生成的 DTO(s) 的 XML 序列化到 WCF 服务端的文件中，以便我可以 (a) 检查内存缓存，然后 (b) 检查文件缓存和(c) 命中数据层
3.  我可以在 SL 应用程序的客户端使用隔离存储来执行类似于 2(a) 的操作。我可以使用散列（或修改日期或其他东西）将数据序列化到本地隔离存储，然后调用检查。

还有一件事要补充：我在 IIS7 中托管这个 WCF 服务，并启用了动态压缩，以便（通常非常大且易于压缩）XML 响应得到 gzip-ed。理想情况下，似乎我希望 IIS 缓存这个 gzip 编辑的结果以避免所有额外的处理。我认为它可能已经这样做了，但我不确定。

我很确定这个问题的最终答案是某种“取决于”，但我很想听听其他人是如何解决这个问题的。Do X 的一个很好的战术配方，使用工具 Y 测试性能，如果需要的话，do Z 会很棒。

一些链接（我会在研究时添加）：

[WCF 缓存方法](http://weblogs.asp.net/pglavich/archive/2007/08/10/architecture-wcf-services-and-caching.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T10:22:02.787

我的方法是这样的：

1.  确定性能是否确实存在问题（我的用户还不能接受吗？）
2.  衡量每个阶段的性能（数据库需要多长时间才能提供数据？服务需要多长时间才能响应数据？从服务到客户端需要多长时间？）
3.  然后根据测量结果，我将确定在哪里进行缓存。请记住，您进行缓存的数据存储越接近，它就越容易，但是您进行缓存的客户端越近，性能增益（通常）就越好。

还要记住，缓存不应该是提高性能的第一件事。您还应该研究其他性能提升。存储过程慢吗？WCF 消息中是否有很多开销？服务中是否存在一些低效的处理？我真的需要一条消息中的所有数据吗？

HTH，乔纳森

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T13:37:41.130

如果您的用户数据很少更改并且需要快速响应，那么使用基于本地存储的自定义机制比等待服务器往返要快得多。

Dino Sposito 在 MSDN 杂志上发表了一篇关于本地存储和缓存的有趣文章，您可以在那里找到捕获程序集的方法（想象一下只需加载所需的最小包，然后在后台加载其余程序集，......性能火箭，您的代码更复杂:))。

正如你所说，重要的是要平衡并做出决定。

HTH布劳里奥

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T22:28:19.847

当 WCF 未在 ASP.NET 兼容模式下运行时，它是否可以使用 System.Web 缓存？可能最好不要依赖它并自己编写。

另一方面，看看微软的 Velocity 项目，它看起来会产生一种非常有趣的缓存技术，不依赖于 ASP.NET。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-03T11:35:41.497

如果您使用 RIA 服务，那么一个简单的方法是拥有两个单独的 edmx 定义。一种用于缓存实体，一种用于事务性实体。

一个域上下文可以通过 AddReference 引用另一个域上下文上的实体，[请参阅](http://msdn.microsoft.com/en-us/library/system.servicemodel.domainservices.client.domaincontext.addreference%28VS.91%29.aspx)。

用户通过身份验证后，可以立即加载缓存的实体。为简单起见，在缓存实体加载之前，不应加载事务数据。

根据缓存的大小，您可能还希望考虑将这些值序列化到本地存储。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T16:55:03.847

我认为＃2是可维护性和架构的最佳选择。IIS提供缓存，为什么不使用呢？

您不想从数据层引用 System.Web。客户端也不是最好的选择，因为您必须编写一堆额外的代码来保持数据同步。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-04T17:15:35.507

我们最近刚刚实现了#3，即使用独立存储的客户端缓存。

在我们的应用程序中，我们有很多下拉菜单和自定义字段，应用程序每次加载时都会从服务器获取这些字段。将这些数据转移到 IS 确实很有帮助。该应用程序现在调用以检查服务器上是否有任何更改，如果没有 - 从 IS 加载数据，否则（这非常罕见）刷新 IS。

这消除了许多 WCF 调用和数据传输，SL 页面的加载时间更短，并且由于网络流量和数据库访问的减少，应用程序总体上变得更具可扩展性。

是的，其中涉及到一些编码，但最终用户的利益是必不可少的。

安德鲁

# java - 使用 Xerces 解析 XML 文档时是否可以获得当前行号？

> ID：570216
> 
> 赞同：4
> 
> 时间：2009-02-20T16:23:16.357
> 
> 标签：java, xml, xerces, line-numbers

我有一个使用 xerces API 解析 XML 文档的 java 程序。

我的解析类扩展了 org.apache.xerces.parsers.XMLDocumentParser，重载了 startElement、endElement、characters 方法。

由于是手工编写的复杂 XML 文档（主要是某种配置元素），经典的 xsd 或 dtd 验证是不够的，我必须向用户返回 XML 文档无效。

但是我无法实现的一件事是在错误消息中添加有关当前正在解析的行号（以及为什么不列号）的信息以及发生错误的位置。

我认为这是可能的，因为当 XML 文档不是 XML 有效时解析器生成的异常 (org.apache.xerces.xni.parser.XMLParseException) 包含这些信息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T17:55:17.727

我从来没有用 xerces 尝试过这个，但是 SAX 解析器可以存储一个 SAX [Locator](http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/Locator.html)，您可以在解析文档时（或在异常之后）从中获取行号和列号。

看起来`XMLDocumentParser`也许可以做同样的事情。它的父类`AbstractXMLDocumentParser`有一个[startDocument](http://xerces.apache.org/xerces2-j/javadocs/xerces2/org/apache/xerces/parsers/AbstractXMLDocumentParser.html#startDocument(org.apache.xerces.xni.XMLLocator,%20java.lang.String,%20org.apache.xerces.xni.NamespaceContext,%20org.apache.xerces.xni.Augmentations))方法，该方法传递了一个`XMLLocator`参数。如果你重写了这个方法，你可以保存`XMLLocator`并使用它的`getLineNumber`和`getColumnNumber`方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:46:17.830

不确定“正确”的方式是什么，但查看 API，假设您提供的 XMLInputSource 采用 InputStream 或 Reader，您可以在使用 LineNumberInputStream 或 LineNumberReader 包装的 InputStream/Reader 中提供，然后查询它的行数字。

例如：

```
输入流；

流 = ...;

新的 XMLInputSource（流）；

```

会成为：

```
输入流；
LineNumberInputStream 线流；

流 = ...;
lineStream = new LineNumberInputStream(lineStream);

新的 XMLInputSource(lineStream);

// 现在可以通过 getLineNumber() 询问线路流它在哪一行

```

我猜您还需要将 LineNumberInputStream/LineNumberReader 传递给扩展 XMLDocumentParser 的类。

不确定所有这些在您的代码中是否可行。

或者深入研究源代码并找出他们是如何做到的。如果您需要访问的变量/方法是私有的，并且您不担心将来会破坏代码，则可以使用反射并删除访问权限来获取它。

# java - 下载 Sun javadocs / 镜像网站

> ID：570218
> 
> 赞同：4
> 
> 时间：2009-02-20T16:23:32.983
> 
> 标签：java, javadoc

我们公司和 Sun 的 javadocs 之间的网络似乎中断了。我在哪里可以获得给定包的 javadocs 副本，以便我可以保留自己的存储库以处理将来的网络中断？Sun javadocs 有镜像吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T16:30:02.003

每个主要版本都有一个大的文档包，例如[这里的 JDK 1.6](http://java.sun.com/javase/6/download.jsp#docs)。

（我希望链接是正确的，它是从我刚才下载的文档中挑选出来的。也无法从这里连接到 SUN。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T16:29:15.733

最可靠的赌注：下载源代码并自己在上面运行 Javadoc，然后将其粘贴到内部 Web 服务器上。

（FWIW - 我现在也无法从我的内部网络访问他们的 javadocs。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T16:33:59.857

对我来说也很失望（java.sun.com 目前似乎是 MIA）。

一些形式的 JDK 文档在这里： http: [//www.docjar.com/docs/api/java/](http://www.docjar.com/docs/api/java/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T17:46:23.083

我在本地的 MacMini 上运行[classfinder](http://www.roblisa.com/classfinder/)。它是一个小型网络服务器，专门为 Javadoc 和相关源提供服务。您只需获取压缩的 Javadoc 和（可选）源包，并将它们放在适当的目录中。Classfinder 计算出所有文档之间的依赖关系，并将所有内容呈现为一组统一的文档。

如果您有多个版本的包（例如不同的`servlet`文档），您可以动态选择要显示的内容。这一切都很漂亮，值得比现在更多的名气。

# c# - 如何从 MFC 的 COleDateTime 转换为 C# DateTime？

> ID：570224
> 
> 赞同：5
> 
> 时间：2009-02-20T16:24:28.880
> 
> 标签：c#, datetime, mfc, coledatetime

我有一个较旧的库，它使用 COleDateTime 作为 C++ MFC Dll 中的返回类型。当我执行 PInvoke 时，我可以放心地将其编组到 DateTime 对象吗？或者我应该做一些古怪的事情，比如将 COleDateTime 转换为自 1970 年以来的滴答数，然后将这些滴答转换回 C# 调用项目中的 DateTime 对象？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T16:34:02.180

[您可以通过访问class](http://msdn.microsoft.com/en-us/library/38wh24td.aspx)上的[`m_dt`成员](http://msdn.microsoft.com/en-us/library/d3yyz5xk.aspx)来返回 double 。 [`COleDateTime`](http://msdn.microsoft.com/en-us/library/38wh24td.aspx)

然后，您将该 double 传递给[结构](http://msdn.microsoft.com/en-us/library/system.datetime.aspx)上的静态[`FromOADate`方法](http://msdn.microsoft.com/en-us/library/system.datetime.fromoadate.aspx)，以将 double 转换为实例。[`DateTime`](http://msdn.microsoft.com/en-us/library/system.datetime.aspx)`DateTime`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T16:32:43.447

使用 DateTime.FromOADate()。

# java - Hibernate HQL 查询：如何将集合设置为查询的命名参数？

> ID：570229
> 
> 赞同：67
> 
> 时间：2009-02-20T16:26:56.987
> 
> 标签：java, hibernate, hql

给定以下 HQL 查询：

```
FROM
    Foo
WHERE
    Id = :id AND
    Bar IN (:barList) 
```

我`:id`使用 Query 对象的`setInteger()`方法进行设置。

我想`:barList`使用一个`List`对象进行设置，但是查看 Hibernate 文档和方法列表，我看不到要使用的明显选择。有任何想法吗？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-02-20T16:40:11.650

使用`Query.setParameterList()`，[Javadoc 这里](http://docs.jboss.org/hibernate/core/3.2/api/org/hibernate/Query.html#setParameterList%28java.lang.String,%20java.util.Collection%29)。

有四种变体可供选择。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-02-20T16:33:04.537

我不确定 HQL，但在 JPA 中，您只需`setParameter`使用参数和集合调用查询。

```
Query q = entityManager.createQuery("SELECT p FROM Peron p WHERE name IN (:names)");
q.setParameter("names", names); 
```

`names`您要搜索的名称集合在哪里

```
Collection<String> names = new ArrayList<String();
names.add("Joe");
names.add("Jane");
names.add("Bob"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-01T02:25:48.087

在[TorpedoQuery 中](http://torpedoquery.org)它看起来像这样

```
Entity from = from(Entity.class);
where(from.getCode()).in("Joe", "Bob");
Query<Entity> select = select(from); 
```

# java - Java Applet 是否无法在 Mac OS 上的 Firefox 中与 javascript 通信？

> ID：570230
> 
> 赞同：12
> 
> 时间：2009-02-20T16:27:01.090
> 
> 标签：java, javascript, macos, firefox, applet

我有一个在浏览器中运行的 java 小程序，它正在调用一些 javascript 函数并期待这些函数的结果。这适用于以下配置：

*   IE浏览器
*   火狐/视窗
*   Safari / Mac

但它不适用于 MAC OS 上的 Firefox

问题的根源似乎是总是返回 null 的 win.eval 调用。我在 Mac OS X 10.4.11 上使用 Firefox 3.0.6 对此进行了测试

一点代码：

```
JSObject win = (JSObject) JSObject.getWindow(this);
Object exp = win.eval("testfunc()");
System.out.println("exp = " + exp.toString()); 
```

这会触发 java.lang.NullPointerException (exp.toString()) 语句）。testfunc javascript 函数只返回 true。

我尝试了 win.call 并得到了相同的结果。

我的小程序标签包括 mayscript 和 scriptable 属性。

* * *

感谢特里斯坦，我找到了答案。测试他的解决方案我创建了一个非常简单的测试，它可以工作并以我的方式找到罪魁祸首。我确信我用一个返回 true 的空 testfunc() 进行了测试，但我可能没有这样做，因为在这种情况下它确实有效。这里真正的问题是该函数调用了小程序的公共方法。Liveconnect 似乎无法在 Firefox Mac 中处理这种情况。

让我给你举个例子 ：

Java类：

```
public class MyApplet extends Applet {  
     public int getMyValue() {
         return 5;
     }

     public void somefunction() {
         JSObject win = (JSObject) JSObject.getWindow(this);
         Object exp = win.eval("jsfunc()");
         System.out.println("exp = " + exp.toString());
     }
} 
```

和javascript代码：

```
function jsfunc() {
    var myApplet = document.getElementById("applet_id");
    return myApplet.getMyValue() + 5;
} 
```

exp 将在 somefunction 中为空，因为 jsfunc 调用了小程序的 getMyValue() 方法。如果您删除对小程序属性的所有调用，那您就很酷。
为了解决我的问题，我决定将我需要的小程序的所有值作为我的 javascript 函数的参数，我现在很好。
情况可能并非总是如此，如果 javascript 改变了小程序的状态......我很幸运 :)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T09:48:44.343

我有一段时间没有使用applet api，但是如果我没记错的话，为了让Applet 能够处理JS 代码，你应该在你的applet 标记中启用属性mayscript 或在对象标记表示法中启用参数mayscript。

对于以其他方式 JS 与 Applet 的通信，您还应该使用可编写脚本的属性或参数，例如：

```
<applet code="..." mayscript="true" /> 
```

这允许您的小程序使用脚本函数。

```
<applet code="..." scriptable="true" /> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T08:48:50.883

它可以通过访问屏幕上的全局对象之一来工作吗？因此，

在 JavaScript 中：

```
window.testfunc = function() { //... } 
```

在小程序中：

```
win.eval("window.testfunc()") // or maybe just win.eval("testfunc()") 
```

那将是我的实验。但是我一直在 Mac OS X 上的 FF 上调用“window.close()”，并且仍然有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-26T06:15:05.900

*如果您删除对小程序属性的所有调用，那您就很酷。*

这也可能发生在其他情况下。我在谷歌搜索类似的问题后发现了这个页面，所以我想我会添加一个数据点。唯一的区别是我使用的是 win.call() 而不是 win.eval()。

我在 JavaScript 中调用了 alert() 以确保调用成功，并看到 Firefox 3.0.9、OS X 10.5.6、Java 1.5.0_16 上的锁定似乎完全相同。Firefox 100% 可重复，在 Safari 上没问题（我没有在这个盒子上安装 Windows）。

当我摆脱 alert() 并简单地返回一个值时，问题就消失了。

Sooooo ...也许在一段时间后调用JavaScript超时并简单地折腾null？

# asp.net - Web 服务响应编码问题

> ID：570231
> 
> 赞同：1
> 
> 时间：2009-02-20T16:27:04.067
> 
> 标签：asp.net, encoding, service

我正在开发基于 ASP.Net asmx Web 服务的 Web 服务。服务器端将字节[] 以UTF-8 编码响应客户端，客户端将字节[] 转换为字符串。

我的困惑是，服务器端的英镑字符（我在写 Http 响应之前转储，服务器端的字符正确为英镑）将被接收为 ?? 从客户端。

有什么想法有什么问题吗？我怀疑这是编码问题，但我不知道如何进一步调试以及任何会影响的设置（来自客户端 Web 服务代理的设置？）？

这是我从 Fiddler 那里得到的标题部分。

HTTP/1.1 200 OK 日期：2009 年 2 月 20 日星期五 16:51:30 GMT 服务器：Microsoft-IIS/6.0 缓存控制：无缓存编译指示：无缓存 X-Powered-By：ASP.NET X-AspNet-版本：2.0.50727 缓存控制：私有内容类型：文本/xml 内容长度：22752

xml 版本="1.0" 编码="utf-8"

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:43:15.387

首先要做的是根据标头、XML 声明和构成文本本身的字节来嗅探实际发送的内容。

[Fiddler](http://www.fiddlertool.com/fiddler/)作为 HTTP 代理很好，或者您可以使用[WireShark](http://wireshark.org)在网络级别进行嗅探。

一旦您获得了这三位信息（Content-Type 标头、XML 声明和构成井号的字节），如果您更新您的答案，我们将看看我们能做什么。听起来确实很奇怪，因为通常 ASP.NET 会正确处理所有这些问题。

您的客户端代码是什么样的？这也只是普通的 .NET Web 服务客户端代码吗？

编辑：尝试在 Fiddler 中找到二进制（十六进制转储）显示，以便您可以找到*字节*。

但是，我强烈怀疑问题仅仅是将结果转储到控制台。这是一些用于转储 unicode 代码点的代码：

```
static void DumpString (string value)
{
    foreach (char c in value)
    {
        Console.Write ("{0:x4} ", (int)c);
    }
    Console.WriteLine();
} 
```

我怀疑你会在输出中看到一个 00A3，它是井号的 Unicode。这意味着字符串实际上已经很好地到达了您的客户端 - 但是将其写入控制台失败了。

# c# - 如何在 .Net 中从 WSDL 生成自定义集合类型？

> ID：570234
> 
> 赞同：1
> 
> 时间：2009-02-20T16:27:28.687
> 
> 标签：c#, .net, collections, wsdl, svcutil.exe

我正在运行一个自定义应用程序，它导入 WSDL 并生成 C# 源代码，使用 WSDLImporter 类来读取合同。

XSD 序列类型被转换为本机数组。为了能够生成自定义集合类型，我可以设置哪些选项？

架构：

```
<xs:complexType name="getAllSourcesResponse">
    <xs:sequence>
        <xs:element maxOccurs="unbounded" minOccurs="0" 
            name="return" type="tns:Source"/>
    </xs:sequence>
</xs:complexType> 
```

变成代码：

```
public partial class getAllSourcesResponse
{
    [System.Xml.Serialization.XmlElementAttribute("return",
        Form=System.Xml.Schema.XmlSchemaForm.Unqualified)]
    public PaymentSource[] @return;

    public getAllSourcesResponse()
    {
    }

    public getAllSourcesResponse(Source[] @return)
    {
        this.@return = @return;
    }
} 
```

我查看了 SvcUtil.exe 代码，它似乎执行以下操作，但它似乎对我的应用程序生成的代码没有任何影响。

```
WsdlImporter importer = ... 

XsdDataContractImporter contractImporter = 
    new XsdDataContractImporter(codeCompileUnit); 

ImportOptions importOptions = new ImportOptions();
importOptions.ReferencedCollectionTypes.Add(
    typeof(System.Collections.Generic.IList<>)); 

contractImporter.Options = importOptions; 

importer.State.Add(typeof(XsdDataContractImporter), contractImporter); 
```

* * *

@CasperOne，这个模式片段

```
<xs:complexType name="getClassesForPackageResponse">
     <xs:sequence>
         <xs:element maxOccurs="unbounded" minOccurs="0" name="return" type="xs:string"/>
     </xs:sequence>
 </xs:complexType> 
```

生成一个 string[] 类型：

```
public partial class getClassesForPackageResponse
{
    public string[] @return;
    public getClassesForPackageResponse() {}

    public getClassesForPackageResponse(string[] @return)
    {    this.@return = @return;    }
} 
```

这不会导致字符串集合使用 List：

```
ImportOptions importOptions = new ImportOptions();
importOptions.ReferencedCollectionTypes.Add(
    typeof(System.Collections.Generic.List<string>)); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T16:36:10.787

首先，我相信您需要指出一个集合实现，而不仅仅是接口，所以这意味着`List<T>`代替`IList<T>`（尽管您当然可以使用接口尝试它）。

其次，需要指定类型参数T：

```
ImportOptions importOptions = new ImportOptions();

importOptions.ReferencedCollectionTypes.Add(
    typeof(System.Collections.Generic.List<getAllSourcesResponse>)); 
```

实际上，您传递的是开放的泛型类型，当导入器尝试解析集合时，它不会与任何内容匹配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-02T07:20:46.367

只是在试图弄清楚如何在 Mono 的 WSDL 导入器中执行此操作时偶然发现了这一点。

在阅读了一些 MSDN 文档并对此进行了一些尝试之后，我使用 .NET 4.5 让它像这样工作：

```
 var importer = new WsdlImporter (mset);
    var xsdImporter = new XsdDataContractImporter ();
    var options = new ImportOptions ();
    options.ReferencedCollectionTypes.Add (typeof (LinkedList<>));
    xsdImporter.Options = options;
    importer.State.Add (typeof (XsdDataContractImporter), xsdImporter); 
```

您还可以指定特定的通用实例类型，例如`List<int>`.

这也记录在这里：http: [//msdn.microsoft.com/en-us/library/aa702680.aspx](http://msdn.microsoft.com/en-us/library/aa702680.aspx)

# click - 单击带有填充的跨度

> ID：570254
> 
> 赞同：3
> 
> 时间：2009-02-20T16:31:51.343
> 
> 标签：click, padding, html

我有一个没有文本的跨度，它看起来像一个图像，它有背景和填充。但它不执行 onclick 事件。该怎么办？我是否需要将跨度更改为其他所有内容？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T16:38:08.317

确保跨度内有东西，例如：

```
<span>&nbsp;</span> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T16:45:09.890

据我所知，如果您希望其背景可见，则需要为跨度设置宽度和高度。至少你需要在 span 中包含一个空格

```
<span style='height:20px; width:100px; display:block;'> & n b s p ;</span> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T17:13:59.930

不需要空间或任何东西，它工作得很好，没有任何变化，那是我的错！

# jit - JIT 编译和 DEP

> ID：570257
> 
> 赞同：3
> 
> 时间：2009-02-20T16:32:20.747
> 
> 标签：jit, dep

我正在考虑尝试一些 jit 编译（只是为了学习），让它跨平台工作会很好，因为我在家里运行所有主要的三个（windows、os x、linux）。考虑到这一点，我想知道是否有任何方法可以摆脱使用虚拟内存窗口函数来分配具有执行权限的内存。最好只使用 malloc 或 new 并将处理器指向这样的块。

有小费吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-02-08T02:22:13.063

DEP 只是关闭了每个内存非代码页的执行权限。应用程序代码加载到有执行权限的内存中；并且有很多 JIT 可以在 Windows/Linux/MacOSX 中运行，即使 DEP 处于活动状态也是如此。这是因为有一种方法可以使用所需的权限集动态分配内存。

通常不应使用普通的 malloc，因为权限是每页的。以一些开销为代价，仍然可以将分配的内存与页面对齐。如果你不会使用malloc，一些自定义的内存管理（只针对可执行代码）。自定义管理是一种常见的 JIT 方式。

Chromium 项目有一个解决方案，它为 javascript V8 VM 使用 JIT 并且是跨平台的。为了跨平台，所需的功能在几个文件中实现，并在编译时选择它们。

Linux: (chromium src/v8/src/platform-linux.cc) 标志是 mmap() 的 PROT_EXEC。

```
void* OS::Allocate(const size_t requested,
                   size_t* allocated,
                   bool is_executable) {
  const size_t msize = RoundUp(requested, AllocateAlignment());
  int prot = PROT_READ | PROT_WRITE | (is_executable ? PROT_EXEC : 0);
  void* addr = OS::GetRandomMmapAddr();
  void* mbase = mmap(addr, msize, prot, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
  if (mbase == MAP_FAILED) {
    /** handle error */
    return NULL;
  }
  *allocated = msize;
  UpdateAllocatedSpaceLimits(mbase, msize);
  return mbase;
} 
```

Win32 (src/v8/src/platform-win32.cc): flag 是 VirtualAlloc 的 PAGE_EXECUTE_READWRITE

```
void* OS::Allocate(const size_t requested,
                   size_t* allocated,
                   bool is_executable) {
  // The address range used to randomize RWX allocations in OS::Allocate
  // Try not to map pages into the default range that windows loads DLLs
  // Use a multiple of 64k to prevent committing unused memory.
  // Note: This does not guarantee RWX regions will be within the
  // range kAllocationRandomAddressMin to kAllocationRandomAddressMax
#ifdef V8_HOST_ARCH_64_BIT
  static const intptr_t kAllocationRandomAddressMin = 0x0000000080000000;
  static const intptr_t kAllocationRandomAddressMax = 0x000003FFFFFF0000;
#else
  static const intptr_t kAllocationRandomAddressMin = 0x04000000;
  static const intptr_t kAllocationRandomAddressMax = 0x3FFF0000;
#endif

  // VirtualAlloc rounds allocated size to page size automatically.
  size_t msize = RoundUp(requested, static_cast<int>(GetPageSize()));
  intptr_t address = 0;

  // Windows XP SP2 allows Data Excution Prevention (DEP).
  int prot = is_executable ? PAGE_EXECUTE_READWRITE : PAGE_READWRITE;

  // For exectutable pages try and randomize the allocation address
  if (prot == PAGE_EXECUTE_READWRITE &&
      msize >= static_cast<size_t>(Page::kPageSize)) {
    address = (V8::RandomPrivate(Isolate::Current()) << kPageSizeBits)
      | kAllocationRandomAddressMin;
    address &= kAllocationRandomAddressMax;
  }

  LPVOID mbase = VirtualAlloc(reinterpret_cast<void *>(address),
                              msize,
                              MEM_COMMIT | MEM_RESERVE,
                              prot);
  if (mbase == NULL && address != 0)
    mbase = VirtualAlloc(NULL, msize, MEM_COMMIT | MEM_RESERVE, prot);

  if (mbase == NULL) {
    LOG(ISOLATE, StringEvent("OS::Allocate", "VirtualAlloc failed"));
    return NULL;
  }

  ASSERT(IsAligned(reinterpret_cast<size_t>(mbase), OS::AllocateAlignment()));

  *allocated = msize;
  UpdateAllocatedSpaceLimits(mbase, static_cast<int>(msize));
  return mbase;
} 
```

MacOS (src/v8/src/platform-macos.cc)：flag 是 mmap 的 PROT_EXEC，就像 Linux 或其他 posix 一样。

```
void* OS::Allocate(const size_t requested,
                   size_t* allocated,
                   bool is_executable) {
  const size_t msize = RoundUp(requested, getpagesize());
  int prot = PROT_READ | PROT_WRITE | (is_executable ? PROT_EXEC : 0);
  void* mbase = mmap(OS::GetRandomMmapAddr(),
                     msize,
                     prot,
                     MAP_PRIVATE | MAP_ANON,
                     kMmapFd,
                     kMmapFdOffset);
  if (mbase == MAP_FAILED) {
    LOG(Isolate::Current(), StringEvent("OS::Allocate", "mmap failed"));
    return NULL;
  }
  *allocated = msize;
  UpdateAllocatedSpaceLimits(mbase, msize);
  return mbase;
} 
```

而且我还想注意，`bcdedit.exe`类似的方式应该只用于非常旧的程序，它会在内存中创建新的可执行代码，但不会在此页面上设置 Exec 属性。对于较新的程序，如 firefox 或 Chrome/Chromium，或任何现代 JIT，DEP 应该处于活动状态，并且 JIT 将以细粒度的方式管理内存权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T02:53:33.847

一种可能性是要求运行您的程序的 Windows 安装配置为 DEP AlwaysOff（坏主意）或 DEP OptOut（更好的主意）。

这可以通过将 boot.ini 文件更改为具有以下设置来配置（至少在 WinXp SP2+ 和 Win2k3 SP1+ 下）：

```
/noexecute=OptOut 
```

然后通过选择（在 XP 下）将您的个人程序配置为退出：

```
Start button
    Control Panel
        System
            Advanced tab
                Performance Settings button
                    Data Execution Prevention tab 
```

这应该允许您在程序中执行代码，这些代码是在`malloc()`块中动态创建的。

请记住，这会使您的程序更容易受到 DEP 旨在防止的攻击。

看起来这在 Windows 2008 中也可以使用以下命令：

```
bcdedit.exe /set {current} nx OptOut 
```

* * *

但是，老实说，如果您只想最小化依赖于平台的代码，只需将代码隔离为单个函数即可轻松实现，例如：

```
void *MallocWithoutDep(size_t sz) {
    #if defined _IS_WINDOWS
        return VirtualMalloc(sz, OPT_DEP_OFF); // or whatever
    #elif defined IS_LINUX
        // Do linuxy thing
    #elif defined IS_MACOS
        // Do something almost certainly inexplicable
    #endif
} 
```

如果您将所有与平台相关的函数放在它们自己的文件中，那么您的其余代码将自动与平台无关。

# javascript - JavaScript - SQL 报告服务

> ID：570262
> 
> 赞同：1
> 
> 时间：2009-02-20T16:33:02.337
> 
> 标签：javascript, reporting-services, reporting

我们可以在 sql 报告服务呈现的报告中插入 javascript 吗？

例如：- 当鼠标悬停在一个单元格上时，我想打开一个 div，以防 ajax 模式弹出控件的使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-18T20:26:35.877

是的，使用 SQL 查询的结果添加 JavaScript 和 jQuery 是完全可行的。我们获取了结果并遍历它们以构建一个字符串，该字符串可以将 DIV 或 CLASS 分配给行、列或单元格。然后对它们应用悬停效果以在脚本中进行最终渲染。我们这样做是为了根据值有条件地突出显示和有条件地隐藏数据，以及在悬停的行/列上淡入颜色的悬停效果。

这并不难，但考虑到您的查询结果可能有成百上千行的可能性，它也可能不是最有效的方法。

我会说可行，但请检查效率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:51:37.097

我从未见过它完成并且不完全喜欢这个想法，但这里有一些我挖掘的关于 javascript 和 Reporting Services 的信息。

[http://geekswithblogs.net/mnf/archive/2007/11/25/sql-server-reporting-services-notes.aspx](http://geekswithblogs.net/mnf/archive/2007/11/25/sql-server-reporting-services-notes.aspx)

# c# - System.Windows.Forms.DataVisualization 命名空间在一个类中很好，但在另一个类中没有

> ID：570274
> 
> 赞同：7
> 
> 时间：2009-02-20T16:34:34.720
> 
> 标签：c#, .net, winforms, namespaces

我收到此错误

`The type or namespace name 'DataVisualization' does not exist in the namespace 'System.Windows.Forms' (are you missing an assembly reference?)`

这是我`using`的课程部分：

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Windows.Forms.DataVisualization.Charting;
using System.Windows.Forms.DataVisualization.Charting.Borders3D;
using System.Windows.Forms.DataVisualization.Charting.ChartTypes;
using System.Windows.Forms.DataVisualization.Charting.Data;
using System.Windows.Forms.DataVisualization.Charting.Formulas;
using System.Windows.Forms.DataVisualization.Charting.Utilities;

namespace myNamespace {
    public class myClass {
        // Usual class stuff
    }
} 
```

问题是我在另一个类中使用了相同的 DataVisualization。我认为唯一不同的是，给出这个缺少命名空间错误的类是解决方案项，而不是特定于项目。这些项目通过链接引用它们。有人对问题有什么想法吗？我已经安装了图表组件、.Net 3.5 SP1 和 Visual Studio 2008 的图表插件。

更新：我将解决方案项目中的项目移到我项目的常规成员中，但我仍然看到相同的行为。

更新 2：从解决方案项目中删除项目并将它们放在我的项目下工作。另一个项目仍在引用这些文件，这就是为什么我认为它以前不起作用的原因。不过，我仍然很好奇，为什么当类是解决方案项时我不能使用命名空间，但将它们移动到项目下（请注意，无需修改）立即使它们可识别。:\

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-16T08:26:18.953

您很可能缺少对 DataVisualization DLL 的引用。请注意，尽管它们共享 System.Windows.Forms.dll 的命名空间，但它们实际上并不包含在其中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T08:13:17.897

已编译的程序集不使用解决方案项。

[http://msdn.microsoft.com/en-us/library/1ee8zw5t.aspx](http://msdn.microsoft.com/en-us/library/1ee8zw5t.aspx) “它们可以被项目引用，但永远不会包含在解决方案或项目构建中”

据我所知，解决方案文件夹/项目实际上只是用于组织事物。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T16:45:56.783

您是否收到实际的构建错误或只是曲线？尝试构建并查看输出窗口，它是成功还是失败？

在 VS 2008 SP1 C# 中引入了顶级错误曲线功能。如果您打开文件的解决方案项版本，它可能会因为缺少默认引用而出现波浪线。不过，该解决方案仍应正确构建。

如果不是这种情况，请尝试将文件直接添加到项目中（无链接）。看看这是否消除了错误。如果是这样，那么我们知道它必须与链接文件有关，它可以帮助追踪问题。

# jquery - 使用 jquery ui 选项卡更改 location.hash

> ID：570276
> 
> 赞同：47
> 
> 时间：2009-02-20T16:35:06.717
> 
> 标签：jquery, jquery-ui, tabs, fragment-identifier

我一直在尝试找到一种方法将 window.location.hash 更改为[Jquery UI Tabs](http://docs.jquery.com/UI/Tabs "Jquery UI 选项卡")中当前选定的选项卡。

我试过了：

```
$("#tabs > ul").tabs();
$("#tabs > ul").bind("tabsshow", function(event, ui) { 
window.location.hash = ui.tab;
}) 
```

这会导致在更改选项卡时将哈希更改为#undefined。

我也试过：

```
$("#tabs > ul").tabs({ 
select: function(event, ui) { 
window.location.hash = ui.tab }
}); 
```

但这似乎根本没有被触发。

任何帮助，将不胜感激。谢谢。

编辑：看起来我最初的问题的一部分与其他地方干扰这个的 js 有关。接受的答案和稍作修改的其他建议答案都可以工作。谢谢大家。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-02-20T17:16:27.787

在您的事件处理函数`ui.tab`中是一个锚元素。您可以像这样检索其哈希值：

```
$("#tabs > ul").tabs();
$("#tabs > ul").bind("tabsshow", function(event, ui) { 
    window.location.hash = ui.tab.hash;
}) 
```

这对你有用吗？

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2010-10-19T13:46:45.180

```
$('#tabs').tabs({
    select: function(event, ui) {
        window.location.hash = ui.tab.hash;
    }
}); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-10-05T17:44:18.400

虽然上述一些解决方案有效，但在某些情况下它们会导致页面跳转，因为 window.location.hash API 旨在将您带到页面的特定部分。

[这里](http://lea.verou.me/2011/05/change-url-hash-without-page-jump/)提出的这个巧妙的解决方案解决了这个问题

```
 $("#tabs").bind("tabsshow", function(event, ui) { 
    history.pushState(null, null, ui.tab.hash);
  }); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-02-28T12:04:49.703

这对我有用，jQuery UI 1.10：

```
$('#elexumaps_events_tabs').tabs({
    activate: function(event, ui) { 
       window.location.hash=ui.newPanel.selector; 
    }
}); 
```

另请参阅：[http ://api.jqueryui.com/tabs/#event-activate](http://api.jqueryui.com/tabs/#event-activate)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-02-17T15:42:03.207

我没有跳跃的简单解决方案：

```
 $("#tabs").tabs({
        activate: function (event, ui) {
            var scrollPos = $(window).scrollTop();
            window.location.hash = ui.newPanel.selector;
            $(window).scrollTop(scrollPos);
        }
    }); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-20T16:52:11.590

这会是你想要的吗？

```
$("#tabs > ul").tabs({ 
   select: function(event, ui) 
   { 
      window.location = "#" + ui.tab;
   }
}); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-06-19T12:35:45.203

上述许多答案不适用于当前版本的 jQuery UI 选项卡。这是我目前正在使用的：

```
var tabsUi = $('#tabs');
tabsUi.tabs();

// Add hash to URL when tabs are clicked
tabsUi.find('> ul a').click(function() {
    history.pushState(null, null, $(this).attr('href'));
});

// Switch to correct tab when URL changes (back/forward browser buttons)
$(window).bind('hashchange', function() {
    if (location.hash !== '') {
        var tabNum = $('a[href=' + location.hash + ']').parent().index();
        tabsUi.tabs('option', 'active', tabNum);
    } else {
        tabsUi.tabs('option', 'active', 0);
    }
}); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-09T14:43:41.467

```
$('#tabs').tabs({
    select: function(event, ui){
      window.location = ui.tab.href;
    }
}); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-09-23T11:39:52.800

我的 jQuery UI 1.10.3 方式

```
$("#tabs").tabs({
   beforeActivate: function(event, ui) {
        var hash = ui.newTab.children("li a").attr("href");
        window.location.hash = hash;
   }
}); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-09-27T09:18:36.847

我正在使用一个选项卡插件，您可以在 github 上找到它：[https ://github.com/jquerytools/jquerytools.github.com](https://github.com/jquerytools/jquerytools.github.com)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-10-31T20:46:10.223

这对我使用 Jquery 1.8 有效

```
$('#tabs').tabs({
    activate: function(event, ui) {
       window.location.hash = ui.newPanel.attr('id');
    }
}); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-01-12T19:54:57.293

在查看了其他一些问题和 jQueryUI API 文档后，我发现这最终对我有用。

```
$(document).ready(function() {
    $("#tabs").tabs({
        activate: function( event, ui ) {
            location.hash = ui.newTab.children(".ui-tabs-anchor").attr("href").substr(1);
        }
    });
}); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-20T15:07:35.323

似乎 ui.tab 本身没有返回有效的字符串。（相反它返回未定义，所以你会说它根本不返回任何东西。）

尝试在 ui.jquery.js 的开发版本中查看是否有任何返回，也许你必须调用 ui.tab 的孩子;-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-02-05T12:43:03.227

这段代码对我来说没问题：

```
$('#tabs').tabs({
    select: function(event, ui) { 
        window.location = $(ui.tab).attr('href');
    }
}); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-03-23T09:18:41.783

这段代码对我有用：

```
$("#tabs").tabs({
    activate: function(event, ui) { 
       window.location.hash=ui.newPanel.selector; 
    }
}); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-02-07T04:45:17.413

以下代码对我有用..

```
$("#tabs").tabs({
   activate : function(event, ui) {
     window.location.hash = ui.newPanel[0].id;
  }
}); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-06-03T12:17:49.687

我的工作解决方案。

jQuery v3.5.1、jQuery UI v1.12.1

```
$(".detail-groups").tabs({ activate: function(event, ui) {
                            window.location.hash = ui.newPanel[0].id;
                         }
                    }); 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2014-07-11T11:14:24.867

这段代码对我有用：

```
window.location.hash=""; 
```

# c# - WCF URL 主机段更改为完整域名

> ID：570277
> 
> 赞同：2
> 
> 时间：2009-02-20T16:36:08.447
> 
> 标签：c#, wcf

我有一个通过 AJAX 从 WCF REST 服务获取 HTML 内容的页面。我开始在 IE 上看到错误，大意是“此页面正在访问不受其控制的信息......”。对于某些内容，WCF 服务将不直接返回内容，而是返回一个对象或 iframe 标记，该标记以不同的参数指向自身。WCF 服务看到的 URL 与请求的 URL 不同，并且差异导致“安全”错误，因为 IE 认为它正在从不同的域加载内容。

因此，例如，XHR 请求要求

“ [http://localhost/Services/Content.svc?id=123](http://localhost/Services/Content.svc?id=123) ...”甚至“ [http://mymachine/Services/Content.svc?id=123](http://mymachine/Services/Content.svc?id=123) ...”

但是，一旦请求到达 WCF 服务，URL 就会变成：

“ [http://mymachine.mydomain.com/Services/Content.svc?id=123](http://mymachine.mydomain.com/Services/Content.svc?id=123) ...”

如何在 WCF 服务中获取最初请求的 URL？我检查了 WebOperationContext.Current.IncomingRequest.UriTemplateMatch 属性无济于事，没有“localhost”的剩余痕迹。我还查看了以下帖子，但仍然找不到原始 URL：

[什么是 HttpContext.Current.Request.RawUrl 的 WCF 等效项？](https://stackoverflow.com/questions/444010/what-is-the-wcf-equivalent-of-httpcontext-current-request-rawurl)

[http://jstawski.com/archive/2008/05/01/wcf-wsdl-location-address-with-https.aspx](http://jstawski.com/archive/2008/05/01/wcf-wsdl-location-address-with-https.aspx)

有什么办法可以达到吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-11-04T00:54:58.307

请注意，在 IIS 中运行的任何服务都将使用 IIS 绑定中指定的主机名。要更改此设置，您需要更改 IIS 中的设置。

# optimization - Lua 挑战：你能提高 fannkuch 实现的性能吗？

> ID：570283
> 
> 赞同：2
> 
> 时间：2009-02-20T16:38:18.083
> 
> 标签：optimization, lua

Lua 是目前最快的脚本语言，对于某些程序来说，它并不比 C/C++ 慢多少（与 pidgits 1:1 相当），但是 Lua 在一些针对 C/C++ 的基准测试中得分非常低。

其中之一是 fannkuch 测试（对微小整数序列的索引访问），它的得分是可怕的 1:148

```
-- The Computer Language Benchmarks Game
-- http://shootout.alioth.debian.org/
-- contributed by Mike Pall

local function fannkuch(n)
  local p, q, s, odd, check, maxflips = {}, {}, {}, true, 0, 0
  for i=1,n do p[i] = i; q[i] = i; s[i] = i end
  repeat
    -- Print max. 30 permutations.
    if check < 30 then
      if not p[n] then return maxflips end  -- Catch n = 0, 1, 2.
      io.write(unpack(p)); io.write("\n")
      check = check + 1
    end
    -- Copy and flip.
    local q1 = p[1]             -- Cache 1st element.
    if p[n] ~= n and q1 ~= 1 then       -- Avoid useless work.
      for i=2,n do q[i] = p[i] end      -- Work on a copy.
      for flips=1,1000000 do            -- Flip ...
    local qq = q[q1]
    if qq == 1 then             -- ... until 1st element is 1.
      if flips > maxflips then maxflips = flips end -- New maximum?
      break
    end
    q[q1] = q1
    if q1 >= 4 then
      local i, j = 2, q1 - 1
      repeat q[i], q[j] = q[j], q[i]; i = i + 1; j = j - 1; until i >= j
    end
    q1 = qq
      end
    end
    -- Permute.
    if odd then
      p[2], p[1] = p[1], p[2]; odd = false  -- Rotate 1<-2.
    else
      p[2], p[3] = p[3], p[2]; odd = true   -- Rotate 1<-2 and 1<-2<-3.
      for i=3,n do
    local sx = s[i]
    if sx ~= 1 then s[i] = sx-1; break end
    if i == n then return maxflips end  -- Out of permutations.
    s[i] = i
    -- Rotate 1<-...<-i+1.
    local t = p[1]; for j=1,i do p[j] = p[j+1] end; p[i+1] = t
      end
    end
  until false
end

local n = tonumber(arg and arg[1]) or 1
io.write("Pfannkuchen(", n, ") = ", fannkuch(n), "\n") 
```

那么如何优化它（当然，与任何优化一样，您必须测量您的实现以确保它更快）。并且你不能为此改变 Lua 的 C 核心，或者使用 LuaJit，它是关于寻找优化 Lua 弱点之一的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T22:31:57.747

Robert Gould >*其中之一是 fannkuch 测试（对微小整数序列的索引访问），它的得分是可怕的 1:148*

当您引用基准游戏中的数字时，请说明这些数字的来源，以便读者了解一些背景信息。

在这种情况下，您似乎已经在四核机器上测量了数字，其中最快的程序已被重写以利用多核。而不是查看[按 CPU 时间排序的经过时间，您会看到比率下降到**1:43**](http://shootout.alioth.debian.org/u32q/benchmark.php?test=fannkuch&lang=all&sort=fullcpu)。

或者查看中位数和四分位数，以便更好地[了解 C++ 测量集与 Lua 测量集的比较](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=all&d=data&gpp=on&gcc=on&luajit=on&lua=on&calc=calculate&box=1)。

或者有一整套测量程序被迫只使用一个内核 - [Lua 与 C++ 相比](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=lua&lang2=gpp&box=1)- 如果你看一下[那些 Lua **pi-digits**程序](http://shootout.alioth.debian.org/u32/benchmark.php?test=pidigits&lang=lua&id=1)，你会发现它们使用 C 语言 GNU GMP 库。

# perl - 一行中的简洁 foreach 表达式

> ID：570285
> 
> 赞同：6
> 
> 时间：2009-02-20T16:38:38.363
> 
> 标签：perl, syntax, foreach

在 Perl 中，通常可以避免使用控制块，如下所示：

```
print "$_\n" foreach(@files); 
```

代替：

```
foreach(@files){
  print "$_\n";
} 
```

此语法在以下更复杂的情况下如何工作：

```
die("Not a file: $_") unless -f $_ foreach(@files); 
```

它给了我一个语法错误。我不是想写混淆代码，它只是程序中不重要的部分，所以我想尽可能简洁地表达它。

**总结答案：**

我只能接受一个答案作为已接受的答案，但我最喜欢 Chris 和 Jon 的以下答案。

这个`foreach`按我的意图使用，但没有`syntax error`：

```
-f or die "Not a file: $_" foreach @files; 
```

下面的一个至少也一样好。我喜欢`die`在声明的开头，因为这就是读者的注意力应该指向的内容：

```
die("Not a file: $_") for grep {!-f} @files; 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T18:01:21.847

只是要成为 Perlish (TMTOWTDI)，您可以使用逻辑短路：

```
-f or die "Not a file: $_" foreach @files; 
```

在 OS X 上测试并且可以工作。

作为旁注，`-f or die`看起来像`open() or die`我在 Perl 中看到的许多常见结构，并且（*我*认为）仍然显示了该行的意图（`die`在某些条件下）。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-20T16:52:08.330

您可以使用@Brent.Longborough 的答案，或者如果您真的想要后缀，请执行以下操作：

```
do { die("Not a file: $_") unless -f $_ } foreach(@files); 
```

但是，我同意其他人的观点，仅仅因为这是“不重要的部分”并不意味着简洁更好。 **可读性很重要。**

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-20T16:47:12.227

好吧，您可能不*打算*编写混淆代码，但我想说您肯定*在尝试*。

两条线（或者甚至一条线上的一个街区，就像 Brent.Longborough 建议的那样）而不是一条线会那么糟糕吗？老实说，这就是我通常讨厌尝试调试/编辑其他人的 perl 代码的原因，大量使用 perl 编写的人似乎痴迷于以最“聪明”的方式做几乎所有事情，而不是这样做以一种其他人阅读时易于理解的方式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-20T17:47:52.347

如果错误测试是此代码的主要点，那么将主要位置放在行首可能是有意义的。一个轻微的改进是使用`grep`：

```
die("Not a file: $_") for grep {!-f} @files; 
```

但是，如果您计划在该部分代码中出于其他原因循环文件，最好将其添加到循环体中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-20T16:48:33.300

如果您不尝试编写混淆代码，那么您不应该尝试像这样编写它。你正在接受一些应该很简单的东西，却使它难以理解。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-20T18:08:42.673

你想太多了。这是一条没有杂技的行：

```
 foreach ( @files ) { die( "Not a file!" ) unless -f } 
```

您可能会玩弄块内的东西以将其击倒，但移除括号和大括号对您没有任何帮助，并且可能会使下一个必须查看它的程序员感到困惑。

你可能有更复杂的东西，这只是一个例子。在现实世界中，它变得更加容易：

```
not_a_file_die_die_die( \@files ); 
```

然后你将所有复杂的东西移到一个子程序中。真正的诀窍是使*想法*和*意图*简洁，而不是实现想法的代码。在许多情况下，机制真的无关紧要。你更关心结果。在这些情况下，不要让机械师出汗。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T17:53:37.713

该死的，乔恩刚刚打败了我`grep`。

但我有一个更大的问题：如果您在阵列中发现一些非文件，您是否真的要退出，这有什么不重要的？（与删除这些项目、警告用户然后处理列表的其余部分相反。）我认为杀死整个 shebang 是程序中相当重要的部分。

在任何情况下，你都不能完全用后缀修饰符来做你想做的事，因为你只能在它们的两边都有一个东西。所以你不能同时拥有`unless`和`foreach`。从相关位的顶部开始[`perldoc perlsyn`](http://perldoc.perl.org/perlsyn.html#Statement-Modifiers)：

> 任何简单的语句都可以选择后跟一个*SINGLE*修饰符，就在终止分号（或块结束）之前。

# c# - 将对象集合导出到 XML 文件

> ID：570288
> 
> 赞同：5
> 
> 时间：2009-02-20T16:40:26.687
> 
> 标签：c#, xml, collections, export

使用 C#...我有一个小应用程序，它从一个类创建对象，并将它们添加到一个对象集合中，它在显示集合中当前选定对象的某些值的过程中执行了一些 UI 工作（使用 WPF UI） . 所以我想添加让用户将他的对象集合保存到文件的功能，这样他们就可以在下次运行应用程序时将其加载回来。

我猜 XML 是一种显而易见的方法，但我对如何去做一无所知。那么，如何将对象集合导出或转储到 xml 文件中，然后，也许更重要的是，我将如何将该 XML 文件读回我的应用程序以重新创建集合？

[这是应用程序的屏幕截图](http://wpfholepatterns.codeplex.com/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T16:47:17.047

如果您决定使用 XML， [System.Runtime.Serialization是您的朋友。](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.aspx)

在我的一个测试应用程序中，有时我需要能够将对象序列化为 XML，以便我可以离线查看它。这是我使用的片段（没有以任何方式优化，只是一天很快就拼凑起来，它已经按照我的需要工作了）。

```
public static string ObjectToXml<T>(T objectToSerialise)
{
    StringWriter Output = new StringWriter(new StringBuilder());
    XmlSerializer xs = new XmlSerializer(objectToSerialise.GetType());
    XmlSerializerNamespaces ns = new XmlSerializerNamespaces();
    ns.Add("MyNs", "http://www.someXmlNamespace/namespace1"); // add as many or few as you need
    xs.Serialize(Output, objectToSerialise, ns);
    return Output.ToString();
} 
```

之后，将数据喷出到文件中是微不足道的。

**注意**：
我需要能够将 XML 内容作为字符串获取，以便我可以通过多种方式之一来持久保存它。如果您需要的话，构建一种直接进入磁盘的方法也很容易。
尽管这对我有用，但您可能需要进行调整以满足自己的需求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T23:44:16.240

XML 序列化在许多情况下都可以并且很好，但是由于 XML 固有的开销，输出会有点大。在这种文件内容不需要人类可读的情况下，这会打开其他选项。

JSON 序列化将有助于减小文件大小。JavaScriptSerializer 可以在 System.Web.Script.Serialization (System.Web.Extensions.dll) 中找到。

在下面的示例中，我有一个 ConfigurationItem 的 Typed 通用列表。配置项与任何其他类一样，但属性应该是公共的，以便它们被序列化。

```
var strFileData = System.IO.File.ReadAllText("FileName.data");
var jss = new JavaScriptSerializer();
var objItemsList = jss.Deserialize<List<ConfigurationItem>>(strFileData);
// {insert code here tomanipulate object "objItemsList"}
var strNewData = jss.Serialize(objItemsList);
System.IO.File.WriteAllText("FileName.data", strNewData); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-25T22:58:27.707

Serialization to XML 的问题在于，如果您的类被序列化更改（新属性），则 xml 不能用于重新创建该类的实例。

如果该类相当简单（或者即使不是），您也可以手动完成：

```
XmlDocument doc = new XmlDocument();
XmlNode root = doc.CreateNode(XmlNodeType.Element,"root")
doc.AppendChild(root)
XmlNode newPage = doc.CreateNode(XmlNodeType.Element,"pattern")
root.AppendChild(newPage)
newPage.Attributes.Append(doc.CreateAttribute("Name",pattern.Name)
foreach (Hole h in pattern.Holes)
{
  XmlNode hole = doc.CreateNode(XmlNodeType.Element,"hole")
  hole.Attributes.Append(doc.CreateAttribute("XCoord",h.Xcoord)
  hole.Attributes.Append(doc.CreateAttribute("YCoord",h.Ycoord)
  newPage.AppendChild(hole)
}
// etc
doc.Save("output.xml") 
```

这段代码很粗糙，但它会生成如下内容：

```
<root>
  <pattern name="Pattern1">
    <hole XCoord="100" YCoord="50" />
  </pattern>
</root> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T16:52:48.873

StackOverflow 上有很多关于 XML 序列化的主题，包括一些关于一些隐藏问题的优秀帖子：

[使用序列化保存数据结构](https://stackoverflow.com/questions/370624/saving-data-structures-in-c)

[序列化问题](https://stackoverflow.com/questions/67959/c-xml-serialization-gotchas)

# c# - ASP.NET / C#：服务器控件中的 DropDownList SelectedIndexChanged 未触发

> ID：570294
> 
> 赞同：11
> 
> 时间：2009-02-20T16:42:01.770
> 
> 标签：c#, asp.net, drop-down-menu, custom-server-controls, selectedindexchanged

我正在创建一个服务器控件，它基本上绑定了两个下拉列表，一个用于国家，一个用于州，并更新国家/地区的 selectedindexchanged 事件的状态下拉列表。但是，它不会发回。任何想法为什么？将它们包装在 UpdatePanel 中的奖励积分（存在渲染问题；可能是因为我没有要参考的页面？）

这是我所拥有的（去除了一些额外的数据访问内容）：

```
public class StateProv : WebControl
{
    public string SelectedCountry;
    public string SelectedState;

    private DropDownList ddlCountries = new DropDownList();
    private DropDownList ddlStates = new DropDownList();

    protected override void OnLoad(EventArgs e)
    {
        base.OnLoad(e);

        IList<Country> countries = GetCountryList();
        IList<State> states = new List<State>();

        if (SelectedCountry != null && SelectedCountry != "")
        {
            states = GetStateList(GetCountryByShortName(SelectedCountry).CountryShortName);
        }
        else
        {
            states.Add(new State { CountryId = 0, Id = 0, StateLabelName = "No states available", StateLongName = "No states available", StateShortName = "" });
        }

        ddlCountries.DataSource = countries;
        ddlCountries.DataTextField = "CountryLongName";
        ddlCountries.DataValueField = "CountryShortName";
        ddlCountries.SelectedIndexChanged += new EventHandler(ddlCountry_SelectedIndexChanged);
        ddlCountries.AutoPostBack = true;

        ddlStates.DataSource = states;
        ddlStates.DataTextField = "StateLongName";
        ddlStates.DataTextField = "StateShortName";

        ddlCountries.DataBind();
        ddlStates.DataBind();

        if (!string.IsNullOrEmpty(SelectedCountry))
        {
            ddlCountries.SelectedValue = SelectedCountry;

            if (!string.IsNullOrEmpty(SelectedState))
            {
                ddlStates.SelectedValue = SelectedState;
            }
        }            
    }

    protected override void RenderContents(HtmlTextWriter output)
    {
        ddlCountries.RenderControl(output);
        ddlStates.RenderControl(output);
    }

    private IList<Country> GetCountryList()
    {
        //return stuff
    }

    private IList<State> GetStateList(Country country)
    {
        //return stuff
    }

    private IList<State> GetStateList(string countryAbbrev)
    {
        Country country = GetCountryByShortName(countryAbbrev);
        return GetStateList(country);
    }

    private Country GetCountryByShortName(string countryAbbrev)
    {
        IList<Country> list = dataAccess.RetrieveQuery<Country>();
        //return stuff
    }

    private IList<State> GetAllStates()
    {
        //return stuff
    }

    protected void ddlCountry_SelectedIndexChanged(object sender, EventArgs e)
    {
        IList<State> states = GetStateList(GetCountryList()[((DropDownList)sender).SelectedIndex]);
        ddlStates.DataSource = states;
        ddlStates.DataBind();
    }
} 
```

**编辑：**视图状态在页面上，页面上的其他控件正确执行回发，只是不是这个。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T16:45:04.633

视图状态是否打开？

**编辑：** 也许你应该重新考虑覆盖渲染功能

```
 protected override void RenderContents(HtmlTextWriter output)
    {
        ddlCountries.RenderControl(output);
        ddlStates.RenderControl(output);
    } 
```

而是将下拉列表添加到控件并使用默认的 RenderContents 呈现控件。

**编辑：** 请参阅我在之前的评论中提到的丹尼斯的答案：

```
Controls.Add ( ddlCountries );
Controls.Add ( ddlStates ); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T17:30:57.253

我看不到您正在将这些控件添加到控件层次结构中。尝试：

```
Controls.Add ( ddlCountries );
Controls.Add ( ddlStates ); 
```

除非控件是控件层次结构的一部分，否则不会调用事件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T16:45:39.810

您需要将`AutoPostBack`Country 设置为 true `DropDownList`。

```
protected override void OnLoad(EventArgs e)
{
    // base stuff

    ddlCountries.AutoPostBack = true;

    // other stuff
} 
```

**编辑**

我想念你做了这件事。在这种情况下，您需要检查 ViewState 是否已启用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-14T12:48:37.183

我遇到了同样的问题，但通过将 AutoPostBack 设置为 true 并在更新面板中将触发器设置为下拉列表控件 id 并将事件名称设置为 SelectedIndexChanged 例如

```
 <asp:UpdatePanel ID="UpdatePanel1" runat="server" UpdateMode="Always" enableViewState="true">
        <Triggers>
            <asp:AsyncPostBackTrigger ControlID="ddl1" EventName="SelectedIndexChanged" />
        </Triggers>
        <ContentTemplate>
            <asp:DropDownList ID="ddl1" runat="server" ClientIDMode="Static" OnSelectedIndexChanged="ddl1_SelectedIndexChanged" AutoPostBack="true" ViewStateMode="Enabled">
                <asp:ListItem Text="--Please select a item--" Value="0" />
            </asp:DropDownList>
        </ContentTemplate>
    </asp:UpdatePanel> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T17:14:04.080

首先，我想澄清一点。这是回发（返回服务器）永远不会发生，还是回发发生，但它永远不会进入 ddlCountry_SelectedIndexChanged 事件处理程序？

我不确定您遇到的是哪种情况，但是如果是第二种情况，我可以提供一些建议。如果是第一种情况，那么以下是仅供参考。

对于第二种情况（即使发出请求，事件处理程序也不会触发），您可能需要尝试以下建议：

1.  查询 Request.Params[ddlCountries.UniqueID] 看是否有值。如果有，请手动触发事件处理程序。
2.  只要视图状态是打开的，只有在不是回发时才绑定列表数据。
3.  如果视图状态必须关闭，则将列表数据绑定放入 OnInit 而不是 OnLoad。

请注意，调用 Control.DataBind() 时，控件将不再提供视图状态和回发信息。在视图状态打开的情况下，在回发之间，DropDownList 的值将保持不变（列表不会被反弹）。如果您在 OnLoad 中发出另一个 DataBind，它将清除其视图状态数据，并且永远不会触发 SelectedIndexChanged 事件。

在视图状态关闭的情况下，你只能每次都重新绑定列表。当回发发生时，有内部 ASP.NET 调用将值从 Request.Params 填充到适当的控件，我怀疑发生在 OnInit 和 OnLoad 之间。在这种情况下，恢复 OnInit 中的列表值将使系统能够正确触发事件。

感谢您花时间阅读本文，如果我错了，欢迎大家纠正。

# .net - 我可以在 VB6 中生成一个同步进程并检索它的返回值吗？

> ID：570295
> 
> 赞同：1
> 
> 时间：2009-02-20T16:42:12.347
> 
> 标签：.net, vb6, process

是否可以在 VB6 中生成一个同步进程（即调用外部 .exe），等待它终止，然后获取返回值？

我们有遗留代码（显然是在 VB6 中），我们需要调用 .NET 应用程序来执行一些复杂的任务，并根据 .NET 应用程序的返回值，继续或失败。有没有更好的方法来做这样的事情？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T16:48:09.447

您的第一个选项可能应该是公开一个接口以将 .NET 接口公开给 COM 并使用它（它更干净），但如果由于某种原因您必须通过生成的进程执行此操作，请使用此 VB6 代码。

```
 Private Type STARTUPINFO
      cb As Long
      lpReserved As String
      lpDesktop As String
      lpTitle As String
      dwX As Long
      dwY As Long
      dwXSize As Long
      dwYSize As Long
      dwXCountChars As Long
      dwYCountChars As Long
      dwFillAttribute As Long
      dwFlags As Long
      wShowWindow As Integer
      cbReserved2 As Integer
      lpReserved2 As Long
      hStdInput As Long
      hStdOutput As Long
      hStdError As Long
   End Type

   Private Type PROCESS_INFORMATION
      hProcess As Long
      hThread As Long
      dwProcessID As Long
      dwThreadID As Long
   End Type

   Private Declare Function WaitForSingleObject Lib "kernel32" (ByVal hHandle As Long, ByVal dwMilliseconds As Long) As Long
   Private Declare Function CreateProcessA Lib "kernel32" (ByVal lpApplicationName As Long, ByVal lpCommandLine As String, ByVal lpProcessAttributes As Long, ByVal lpThreadAttributes As Long, ByVal bInheritHandles As Long, ByVal dwCreationFlags As Long, ByVal lpEnvironment As Long, ByVal lpCurrentDirectory As Long, lpStartupInfo As STARTUPINFO, lpProcessInformation As PROCESS_INFORMATION) As Long
   Private Declare Function CloseHandle Lib "kernel32" (ByVal hObject As Long) As Long
   Private Declare Function GetExitCodeProcess Lib "kernel32" (ByVal hProcess As Long, lpExitCode As Long) As Long

   Private Const NORMAL_PRIORITY_CLASS = &H20&
   Private Const INFINITE = -1&
   Private Const SW_HIDE = 0
   Private Const SW_SHOWMINNOACTIVE = 7

   Public Function ExecCmd(cmdline As String, workdir As String) As Integer
      Dim proc As PROCESS_INFORMATION
      Dim start As STARTUPINFO
      Dim ret as Long

        ChDrive Left(workdir, 1) & ":"
        ChDir workdir

        start.cb = Len(start)
        start.wShowWindow = SW_SHOWMINNOACTIVE

        Call CreateProcessA(0&, cmdline, 0&, 0&, 1&, NORMAL_PRIORITY_CLASS, 0&, 0&, start, proc)
        Call WaitForSingleObject(proc.hProcess, INFINITE)
        Call GetExitCodeProcess(proc.hProcess, ret)
        Call CloseHandle(proc.hThread)
        Call CloseHandle(proc.hProcess)
        ExecCmd=ret
   End Function 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:08:28.273

```
' References: "Windows Script Host Shell Object Model" '
Function ExecuteCommand(cmd As String, ExpectedResult as Long) As Boolean
  Dim shell As New IWshRuntimeLibrary.WshShell
  Dim Result As Long

  Result = shell.Run(Command:=cmd, WindowStyle:=WshHide, WaitOnReturn:=True)

  ExecuteCommand = (Result = ExpectedResult)
End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T15:41:12.733

你可以使用：

```
Option Explicit

Private Const INFINITE = &HFFFF&
Private Const SYNCHRONIZE = &H100000
Private Const PROCESS_QUERY_INFORMATION = &H400&

Private Declare Function CloseHandle Lib "kernel32" ( _
    ByVal hObject As Long) As Long

Private Declare Function GetExitCodeProcess Lib "kernel32" ( _
    ByVal hProcess As Long, _
    lpExitCode As Long) As Long

Private Declare Function OpenProcess Lib "kernel32" ( _
    ByVal dwDesiredAccess As Long, _
    ByVal bInheritHandle As Long, _
    ByVal dwProcessId As Long) As Long

Private Declare Function WaitForSingleObject Lib "kernel32" ( _
    ByVal hHandle As Long, _
    ByVal dwMilliseconds As Long) As Long

Private Function SyncShell( _
    ByVal PathName As String, _
    ByVal WindowStyle As VbAppWinStyle) As Long
    'Shell and wait.  Return exit code result, raise an
    'exception on any error.
    Dim lngPid As Long
    Dim lngHandle As Long
    Dim lngExitCode As Long

    lngPid = Shell(PathName, WindowStyle)
    If lngPid <> 0 Then
        lngHandle = OpenProcess(SYNCHRONIZE _
                             Or PROCESS_QUERY_INFORMATION, 0, lngPid)
        If lngHandle <> 0 Then
            WaitForSingleObject lngHandle, INFINITE
            If GetExitCodeProcess(lngHandle, lngExitCode) <> 0 Then
                SyncShell = lngExitCode
                CloseHandle lngHandle
            Else
                CloseHandle lngHandle
                Err.Raise &H8004AA00, "SyncShell", _
                          "Failed to retrieve exit code, error " _
                        & CStr(Err.LastDllError)
            End If
        Else
            Err.Raise &H8004AA01, "SyncShell", _
                      "Failed to open child process"
        End If
    Else
        Err.Raise &H8004AA02, "SyncShell", _
                  "Failed to Shell child process"
    End If
End Function 
```

# optimization - Lua 挑战：你能提高 mandelbrot 实现的性能吗？

> ID：570297
> 
> 赞同：10
> 
> 时间：2009-02-20T16:42:37.073
> 
> 标签：optimization, lua, mandelbrot

**状态：**到目前为止，最佳答案的程序执行时间是原始程序的 33%！但可能还有其他方法可以优化它。

* * *

Lua 目前是最快的脚本语言，但是 Lua 在一些针对 C/C++ 的基准测试中得分非常低。

其中之一是 mandelbrot 测试（生成 Mandelbrot 设置便携式位图文件 N=16,000），它的得分是可怕的 1:109（多核）或 1:28（单核）

由于速度的 Delta 非常大，因此这是一个很好的优化候选者。另外我敢肯定，那些知道 Mike Pall 是谁的人可能会认为不可能进一步优化这个，但这是明显错误的。任何做过优化的人都知道，总是有可能做得更好。此外，我确实设法通过一些调整获得了一些额外的性能，所以我知道它是可能的 :)

```
-- The Computer Language Shootout
-- http://shootout.alioth.debian.org/
-- contributed by Mike Pall

local width = tonumber(arg and arg[1]) or 100
local height, wscale = width, 2/width
local m, limit2 = 50, 4.0
local write, char = io.write, string.char

write("P4\n", width, " ", height, "\n")

for y=0,height-1 do
  local Ci = 2*y / height - 1
  for xb=0,width-1,8 do
    local bits = 0
    local xbb = xb+7
    for x=xb,xbb < width and xbb or width-1 do
      bits = bits + bits
      local Zr, Zi, Zrq, Ziq = 0.0, 0.0, 0.0, 0.0
      local Cr = x * wscale - 1.5
      for i=1,m do
        local Zri = Zr*Zi
        Zr = Zrq - Ziq + Cr
        Zi = Zri + Zri + Ci
        Zrq = Zr*Zr
        Ziq = Zi*Zi
        if Zrq + Ziq > limit2 then
          bits = bits + 1
          break
        end
      end
    end
    if xbb >= width then
      for x=width,xbb do bits = bits + bits + 1 end
    end
    write(char(255-bits))
  end
end 
```

那么如何优化它（当然，与任何优化一样，您必须测量您的实现以确保它更快）。并且你不能为此改变 Lua 的 C 核心，或者使用 LuaJit，它是关于寻找优化 Lua 弱点之一的方法。

**编辑：**为此设置赏金以使挑战更有趣。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-03T19:07:21.377

通过 2，（在我的机器上）比我以前的要好 30%。主要节省来自展开内部循环以摊销开销。

还包括（已注释掉）是当您卡在中央心形指向时提前退出（并将像素设置为黑色）以节省时间的中止尝试。它有效，但无论我如何调整它都会变慢。

我得跑了，但我会留下一个离别建议。通过运行长度编码结果可能会进行一些优化（因此，您可以保存一个列表（白点数、黑点数、白点数等），而不是保存一堆比特旋转字符。 ）。这个会：

1.  减少存储/GC 开销
2.  允许对输出生成进行一些优化（当数字为 >> 8 时）
3.  允许一些轨道探测。

不知道它是否可以编码得足够紧密，可以飞行，但如果我有更多时间，我接下来会尝试这样做。

```
-- The Computer Language Shootout
-- http://shootout.alioth.debian.org/
-- contributed by Mike Pall
-- with optimizations by Markus J. Q. (MarkusQ) Roberts

local width = tonumber(arg and arg[1]) or 100
local height, wscale = width, 2/width
local m, limit2 = 50, 4.0
local write, char = io.write, string.char

local h2 = math.floor(height/2)
local hm = height - h2*2
local top_half = {}

for y=0,h2+hm do
    local Ci = 2*y / height - 1
    local line = {""}
    for xb=0,width-1,8 do
        local bits = 0
        local xbb = xb+7
        for x=xb,xbb < width and xbb or width-1 do
            bits = bits + bits
            local Zr, Zi, Zrq, Ziq = 0.0, 0.0, 0.0, 0.0
            local Cr = x * wscale - 1.5
            local Zri = Zr*Zi
            for i=1,m/5 do
                Zr = Zrq - Ziq + Cr
                Zi = Zri + Zri + Ci
                Zri = Zr*Zi

                Zr = Zr*Zr - Zi*Zi + Cr
                Zi = 2*Zri +         Ci
                Zri = Zr*Zi

                Zr = Zr*Zr - Zi*Zi + Cr
                Zi = 2*Zri +         Ci
                Zri = Zr*Zi

                Zr = Zr*Zr - Zi*Zi + Cr
                Zi = 2*Zri +         Ci
                Zri = Zr*Zi

                Zr = Zr*Zr - Zi*Zi + Cr
                Zi = 2*Zri +         Ci
                Zri = Zr*Zi

                Zrq = Zr*Zr
                Ziq = Zi*Zi
                Zri = Zr*Zi
                if Zrq + Ziq > limit2 then
                    bits = bits + 1
                    break
                    end
                -- if i == 1 then
                --    local ar,ai       = 1-4*Zr,-4*Zi
                --    local a_r         = math.sqrt(ar*ar+ai*ai)
                --    local k           = math.sqrt(2)/2
                --    local br,bi2      = math.sqrt(a_r+ar)*k,(a_r-ar)/2
                --    if (br+1)*(br+1) + bi2 < 1 then
                --        break
                --        end
                --    end
                end
            end
        for x=width,xbb do 
            bits = bits + bits + 1 
            end
        table.insert(line,char(255-bits))
        end
    line = table.concat(line) 
    table.insert(top_half,line)
    end

write("P4\n", width, " ", height, "\n")
for y=1,h2+hm do
    write(top_half[y])
    end
for y=h2,1,-1 do
    write(top_half[y])
   end 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T06:10:39.200

所以这里是〜40％的开始：

```
-- The Computer Language Shootout
-- http://shootout.alioth.debian.org/
-- contributed by Mike Pall

local width = tonumber(arg and arg[1]) or 100
local height, wscale = width, 2/width
local m, limit2 = 50, 4.0
local write, char = io.write, string.char

function addChar (line, c)
    table.insert(line, c)
    for i=table.getn(line)-1, 1, -1 do
        if string.len(line[i]) > string.len(line[i+1]) then
            break
            end
        line[i] = line[i] .. table.remove(line)
        end
    end

local h2 = math.floor(height/2)
local hm = height - h2*2
local top_half = {}
for y=0,h2+hm do
    local Ci = 2*y / height - 1
    local line = {""}
    for xb=0,width-1,8 do
        local bits = 0
        local xbb = xb+7
        for x=xb,xbb < width and xbb or width-1 do
            bits = bits + bits
            local Zr, Zi, Zrq, Ziq = 0.0, 0.0, 0.0, 0.0
            local Cr = x * wscale - 1.5
            for i=1,m do
                local Zri = Zr*Zi
                Zr = Zrq - Ziq + Cr
                Zi = Zri + Zri + Ci
                Zrq = Zr*Zr
                Ziq = Zi*Zi
                if Zrq + Ziq > limit2 then
                    bits = bits + 1
                    break
                    end
                end
            end
        for x=width,xbb do 
            bits = bits + bits + 1 
            end
        addChar(line,char(255-bits))
        end
    line = table.concat(line) 
    table.insert(top_half,line)
    end

write("P4\n", width, " ", height, "\n")
for y=1,h2+hm do
    write(top_half[y])
    end
for y=h2,1,-1 do
    write(top_half[y])
    end 
```

——马库斯

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-03T07:37:06.933

现在至少有一个比我的解决方案更快的答案，我将发布我的答案

```
-- The Computer Language Shootout
-- http://shootout.alioth.debian.org/
-- contributed by Mike Pall

local width = tonumber(arg and arg[1]) or 100
local height, wscale = width, 2/width
local m, limit2 = 50, 4.0
local write, char = io.write, string.char
local insert = table.insert
local results={}
write("P4\n", width, " ", height, "\n")

for y=0,height-1 do
  local Ci = 2*y / height - 1
  for xb=0,width-1,8 do
    local bits = 0
    local xbb = xb+7
    for x=xb,xbb < width and xbb or width-1 do
      bits = bits + bits
      local Zr, Zi, Zrq, Ziq = 0.0, 0.0, 0.0, 0.0
      local Cr = x * wscale - 1.5
      for i=1,m do
        local Zri = Zr*Zi
        Zr = Zrq - Ziq + Cr
        Zi = Zri + Zri + Ci
        Zrq = Zr*Zr
        Ziq = Zi*Zi
        if Zrq + Ziq > limit2 then
          bits = bits + 1
          break
        end
      end
    end
    if xbb >= width then
      for x=width,xbb do bits = bits + bits + 1 end
    end
    insert(results,(char(255-bits)))
  end
end
write(table.concat(results)) 
```

诀窍是在将值发送到输出之前将它们存储到表中。像这样简单的事情将运行时间减少到 58%。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T10:22:29.867

我不知道 Lua 能很好地生成工作代码，但你应该能够通过使用一些数学技巧来大大提高 Mandelbrot 的性能。有一个关于使用对称性来加速它的建议，使用这种优化可以完成另一个重大改进：

使用使用 Mandelbrot 部分的矩形坐标的递归函数。然后它计算矩形边界线和中间分开的两条线的值。在此之后，有 4 个子矩形。如果其中一个具有所有相同的边框像素颜色，则可以简单地用该颜色填充它，如果没有，则递归调用该部分的函数。

我搜索了这个算法的另一种解释，并在[这里](http://www.metabit.org/~rfigura/figura-fractal/math.html)找到了一个- 以及一个很好的[可视化](http://www.metabit.org/~rfigura/figura-fractal/tesseral.gif)。旧的 DOS 程序 FRACTINT 将此[优化](http://spanky.triumf.ca/www/fractint/drawing_method.html)称为“Tesseral 模式”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-01T15:43:33.763

在基准测试游戏中，通过生成更多进程来使用可用内核，经过的时间[从 674 秒减少到 211 秒](http://shootout.alioth.debian.org/u32q/benchmark.php?test=mandelbrot&lang=lua&id=6)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-19T11:19:58.567

为什么要使用局部变量 Zri？可以通过重新排序接下来的两个语句来避免使用它：

Zi = 2*Zr*Zi + Ci Zr = Zrq - Ziq + Cr

也可以使用简单的周期性检查，但加速取决于 m。“m”越大，从周期性检查中获得的加速越好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T22:13:55.887

Robert Gould >*其中之一是 mandelbrot 测试（生成 Mandelbrot 集便携式位图文件 N=16,000），它的得分是可怕的 1:109*

当您引用基准游戏中的数字时，请说明这些数字的来源，以便读者了解一些背景信息。

在这种情况下，您似乎已经在四核机器上测量了数字，其中最快的程序已被重写以利用多核。而不是查看[按 CPU 时间排序的经过时间，您会看到比率下降到**1:28**](http://shootout.alioth.debian.org/u32q/benchmark.php?test=mandelbrot&lang=all&sort=fullcpu)。

或者查看中位数和四分位数，以便更好地[了解 C++ 测量集与 Lua 测量集的比较](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=all&d=data&gpp=on&gcc=on&luajit=on&lua=on&calc=calculate&box=1)。

或者有一整套测量程序被迫只使用一个内核 - [Lua 与 C++ 相比](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=lua&lang2=gpp&box=1)- 如果你看看[那些 Lua **pi-digits**程序](http://shootout.alioth.debian.org/u32/benchmark.php?test=pidigits&lang=lua&id=1)，你会发现它们使用 C 语言 GNU GMP 库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T07:40:58.233

我做的下一步是缓存一遍又一遍计算的东西，并将bit+bit替换为bit*2，这些简单的优化非常强大......

```
local width = tonumber(arg and arg[1]) or 100
local height, wscale = width, 2/width
local m, limit2 = 50, 4.0
local write, char = io.write, string.char
local results={}
write("P4\n", width, " ", height, "\n")
local height_minus_one = height - 1
local width_minus_one = width -1

for y=0,height_minus_one do
  local Ci = 2*y / height_minus_one
  for xb=0,width_minus_one,8 do
    local bits = 0
    local xbb = xb+7
    for x=xb,xbb < width and xbb or width_minus_one do
      bits = bits *2
      local Zr, Zi, Zrq, Ziq = 0.0, 0.0, 0.0, 0.0
      local Cr = x * wscale - 1.5
      for i=1,m do
        local Zri = Zr*Zi
        Zr = Zrq - Ziq + Cr
        Zi = Zri + Zri + Ci
        Zrq = Zr*Zr
        Ziq = Zi*Zi
        if Zrq + Ziq > limit2 then
          bits = bits + 1
          break
        end
      end
    end
    if xbb >= width then
      for x=width,xbb do bits = bits *2 + 1 end
    end
    table.insert(results,(char(255-bits)))
  end
end
write(table.concat(results)) 
```

这种优化使程序运行时间是原来的 34%，但 Markus Q 的优化仍然击败了我的；）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-03T08:11:18.897

这是另一种尝试，但结果比本地访问变量要慢（我想象使用干净的环境可以更快地找到变量，但事实并非如此，本地的虚拟寄存器稍微快一些）这个将运行时间降低到 41%。

```
local env={}
env.width = tonumber(arg and arg[1]) or 100
env.height = env.width
env.wscale = 2/env.width
env.m = 50
env.limit2 = 4.0
env.write = io.write
env.char = string.char
env.results={}
env.height_minus_one = env.height - 1
env.width_minus_one = env.width -1
env.insert = table.insert

setfenv(function()
    write("P4\n", env.width, " ", env.height, "\n")
    for y=0,height_minus_one do
      local Ci = 2*y / height_minus_one
      for xb=0,width_minus_one,8 do
        local bits = 0
        local xbb = xb+7
        for x=xb,xbb < width and xbb or width_minus_one do
          bits = bits *2
          local Zr, Zi, Zrq, Ziq = 0.0, 0.0, 0.0, 0.0
          local Cr = x * wscale - 1.5
          for i=1,m do
            local Zri = Zr*Zi
            Zr = Zrq - Ziq + Cr
            Zi = Zri + Zri + Ci
            Zrq = Zr*Zr
            Ziq = Zi*Zi
            if Zrq + Ziq > limit2 then
              bits = bits + 1
              break
            end
          end
        end
        if xbb >= width then
          for x=width,xbb do bits = bits *2 + 1 end
        end
        insert(results,(char(255-bits)))
      end
    end
end,env)()

io.write(table.concat(env.results)) 
```

# .net - 什么时候需要接口？

> ID：570302
> 
> 赞同：27
> 
> 时间：2009-02-20T16:44:35.743
> 
> 标签：.net, inheritance, interface, graph-theory, composite

（在 .NET 的上下文中，它的价值是什么）

我倾向于不使用继承，也很少使用接口。我遇到了一个认为接口是自吐槽以来最好的东西的人。他到处使用它们。我不明白这一点，因此接下来的问题。我只是想检查一下我对接口的理解。

如果您在任何地方都使用界面，我假设您可以预测未来，您的应用程序需求已确定并且您的应用程序不会发生任何变化。对我来说，尤其是在早期开发过程中，界面成为了拖累。该应用程序在其生命周期中非常动态。如果您需要在界面中减去或添加成员，很多东西都会中断。上面的人说他创建了另一个接口来处理新成员。什么都没有。

不是组合吗？为什么不使用没有接口的组合？更灵活。

他如何处理必须从接口中减去成员的情况？基本上他不会。事情刚刚破裂，这很好，因为现在您可以看到所有受影响的区域并修复它们。我们不应该更优雅地找出所有相关代码路径的位置，而应该通过蛮力撕掉部分类？

我将软件应用程序视为图形。完整图是最坏的情况，具有 n(n-1)/2。这意味着每个班级都与每个班级交谈。令人困惑的蜘蛛网。n-1 是最好的，其中它们是严格的通信等级。添加另一个接口只是为了补偿一个新的需要的成员，会在图中添加一个顶点，这意味着更多的边和更强的 n(n-1)/2 方程的实现。没有接口的组合更像是 mixin。只有选择类使用特定的方法。使用接口，所有类都被迫使用成员，即使它们不需要它们。组合/混合方法不会添加新的不需要的边缘。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-20T16:54:03.473

接口不强制类*使用*方法。他们强制实现类来*实现*所有方法，但那是另一回事。

我喜欢接口将 API 从实现中分离出来的方式。诚然，这也可以通过访问修饰符完成，但接口使其更清晰。更重要的是，接口还使模拟变得更容易——这意味着您甚至可以在实现接口之前对依赖于接口的类进行单元测试。

是的，这意味着我经常会得到一个只有一个生产实现的接口。在我看来这不是问题，因为我已经获得了可测试性。

另一方面，我不会为*每个*类都写一个接口。我喜欢编写对象本质上提供*服务*的接口——身份验证、数据访问等。普通数据对象（即使具有重要行为）在接口、IME 方面没有那么有用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-20T16:54:11.663

根据[维基百科](http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming)，

*多态性在工业（面向对象编程理论）中的主要用途是属于不同类型的对象能够响应同名的方法、字段或属性调用，每个调用都根据适当的特定于类型的行为。程序员（和程序）不必事先知道对象的确切类型，因此确切的行为是在运行时确定的（这称为后期绑定或动态绑定）。*

这就是接口如此有用的原因。

*“上面的那个人说他创建了另一个接口来处理新成员。没有任何问题。”*

我只是在这里猜测，但听起来这家伙来自旧学校的 COM 背景（当然，我可能是错的！）。想到我所编写的所有代码，我都会畏缩，因为我看到过这样的事情：

*   小部件管理器
*   IWidgetManager2
*   IWidgetManager3

这不是使用接口的好方法。以我的经验，我看到了两个极端：害怕更改接口到每当添加新成员时创建新接口的地步，或者根本不使用接口并且拥有遭受高度[耦合](http://en.wikipedia.org/wiki/Coupling_(computer_science))的产品。你需要找到一个很好的平衡点。改变界面并不总是世界末日。

您正在从事的项目的规模是多少？如果它是一个相对较小的项目，则很难看到接口的好处。另一方面，如果它是一个有几十万行代码并且由许多模块组成的项目，那么好处就会变得更加明显。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-20T17:13:10.727

接口有许多有用的情况。当您需要将特定行为添加到可以在各种类中找到的类时，这就是接口的最佳时机。一个很好的例子是`IDisposable`界面——你有一些资源，当你完成后，需要及时离开。是数据库连接吗？是一些窗户把手吗？没关系。

另一个例子是当你真的*不*知道它应该如何实现时，例如一个还不存在的对象的接口。也许该对象应该由您的库的客户端提供，或者必须由不受您控制的完全不同的模块实现。您基本上可以为类上可用的方法设计一个契约。

也就是说，我只在需要的地方使用它们。如果我可以用一个普通的类来做，或者如果它是特定对象固有的东西，我会把它变成一个类。正如其他人所说，为每个类使用接口有一些优点，但这是额外的开销，我看不到它有不错的净收益。大多数时候，我设计了我的类结构，使它们扁平而宽泛，尽可能少的依赖。

总而言之：如果您需要实现显着不同的通用功能，那么接口正是您所需要的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T20:51:46.137

接口帮助你**保持对抽象的依赖。**

使用接口的代码只依赖于接口，所以你知道对细节没有人为的依赖。这为您在将来更改代码方面提供了很大的自由，因为您确切地知道在“修复”错误或重构时应该和不应该破坏什么。

在我看来，这是好的代码设计的本质。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T17:48:35.603

“上面的人说他创建了另一个接口来处理新成员。没有什么问题。

不是组合吗？为什么不使用没有接口的组合？更灵活。”

您似乎在考虑继承方面的组合，例如，“我会将所有这些功能继承到这个对象中来完成这项工作。” 这是编写代码的糟糕方式。这就像在说，“我想建造一座摩天大楼，所以我会学习所有需要知道的工作，从如何创建蓝图到如何打地基和安装照明......”

考虑组合，而不是根据每个执行单个任务的单独对象。为了完成一项复杂的工作，我现在可以依靠这些单独的对象来执行它们各自的任务。这就像雇用建筑师和施工人员来建造摩天大楼。我不需要非常详细地知道他们每个人是如何工作的，只要他们能做到就行。在代码中，这意味着将依赖项注入对象以执行复杂的任务，而不是继承。

那么接口适合哪里呢？它们是各个对象之间的契约。它们使您能够不关心个别的具体实现。它们允许您与一堆共享相同职责但实际上可能具有不同实现的对象说共同语言。接口成为执行任务的对象的抽象。我不需要知道每个拿着锤子的人是如何工作的，只要他知道如何使用 HitNail()。

当你开始用许多具有单一职责的小类来编写复杂的代码系统时，你很快就会发现，如果你过分依赖给定类的具体实现，你可能会遇到严重的问题，并且该类开始发生变化...因此，我们不依赖具体的实现，而是创建一个接口 - 一个抽象。我们说，“我不在乎你如何做 JobX，只在乎你做。”

接口还有其他好处，如测试、模拟等……但这些并不是为接口编码的原因。原因是创建一个不依赖于细节的代码系统，因此彼此高度耦合。这就是为什么用你的图形思维大脑，你应该害怕将一堆具体的类相互耦合。因为其中一个类的变化会引起连锁反应。

当你把自己耦合到一个抽象而不是一个具体的类时，你就限制了耦合。你说，我只会和我们都同意的合同耦合，其他什么都没有。如果实现该契约的类改变了其完成任务的内部方式，您不必在意，因为您不依赖于非契约属性或方法。你只依赖于商定的合同。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T17:54:29.303

如果您想了解何时使用接口，以及它们的用途是什么，我认为您应该看看这本书：[Head First Desing Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)。

这本书真正帮助我理解了接口的魅力所在。

在读这本书之前，我知道什么是界面，但我完全不知道什么时候应该使用它们。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-21T15:56:50.717

它是关于依赖关系的。您希望您的代码在适当的情况下依赖于接口类型而不是具体类型。例如，您可能有多个具体类型，它们都执行类似的行为，但实现方式不同。您是否希望您的代码库依赖于这些多种具体类型或一个接口？当您需要进行更改时，您认为您的代码库有多灵活？

对于您不想通过使用组合来使用公共成员的观点，我想说您只是封装了不必要的依赖项。如果您想使用组合，那么您可以通过组合接口类型而不是具体类型来大大减少依赖关系。

要获得更好的解释，请尝试查看有关[控制反转](http://martinfowler.com/articles/injection.html)的文献。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T17:05:48.657

在依赖注入和 IoC 框架的上下文中，接口对我来说最有意义。我喜欢您可以定义一组行为（方法）并通过实现接口“保证”这些行为的想法。现在，您可以通过单个程序集和配置文件更新将全新功能插入现有系统。

界面的有效设计确实需要大量的前瞻性规划，我发现它们在大型系统和框架的上下文中最有用。当它们有用时，它们*真的*很有用。我最喜欢的几个：

*   `IComparable`（您决定您的对象如何相互比较）
*   `IQueryable`（LINQ有人吗？）
*   `IDisposable`（把你的`using`陈述放在手边）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T17:20:26.217

我认为您描述[了自上而下的设计](http://en.wikipedia.org/wiki/Top-down)方法。
您不必这样做，但有时他确实会提供帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-21T02:15:21.017

我会参考 .net 设计指南：http: [//msdn.microsoft.com/en-us/library/ms229013.aspx](http://msdn.microsoft.com/en-us/library/ms229013.aspx)

使用接口的原因有很多，但我也发现它们经常因为错误的原因而被过度使用。接口在处理值类型时提供了更大的灵活性，并且在处理集合等时非常有用，但是在为我自己的项目设计类层次结构时，我总是尝试首先考虑简单性，并且接口通常会导致（不必要的）更复杂的情况。

我的经验法则是实现每个有意义的 BCL 接口，并且只有在我自己的接口真正提供了非常有价值的东西时才将其添加到我的设计中。与其拥有 IWidgetManager、IWidgetManager2 等...我更愿意拥有抽象类 WidgetManager 并根据需要实现具体方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-23T20:36:28.343

这个人听起来像是误解了对接口编程的概念。它不是指仅使用`interface`.Net/Java 中的关键字进行编程，也不是指仅使用 C++ 中的纯虚函数的类，该原则中所指的接口是封装了低级接口的高级构造的一个系统。与乘法一样，它封装了将数字添加到自身特定数量的重复的想法。但是当我们说 3 * 2 时，我们不在乎缓存括号中的部分是 3 + 3、2 + 2 + 2 还是 (2 + 2) + 2。只要我们从它那里收到 6。

事实上，接口的概念可以由这些中的一个或一个组合来填充，`interface`就像`abstract class`许多 GoF 模式的情况一样。只是`interface`关键字模糊了水。

这很有趣。这家伙的想法可能是产生评论的原因，例如围绕 StackOverflow 第 38 集的评论。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-27T06:54:18.100

听起来你的朋友严重误用了界面。

我还看到到处都有界面的网络应用程序。有些人似乎认为接口比普通的方法签名更好。简单的参数已经为我们提供了一个契约——在大多数情况下，我相信这已经足够了，并且可以简化代码。

在我看来，接口在 IDisposable 或 ICollection 等情况下*最有用*——它们指向对象期望的一组特定功能。在这些情况下，它们似乎是完成这项工作的正确工具。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-27T07:01:16.600

我们在自定义 UI 元素上大量使用接口，每个元素都期望某种方法存在于另一个元素上（并且接口强制存在）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-04T20:16:11.607

接口的主要用途是允许实现的变化，允许在运行时切换代码。这样做有很多原因/理由。

过去有些人认为系统中的每个类都应该有一个接口，但这被广泛认为是矫枉过正。现在使用接口，其中类的实例可以作为系统操作的一部分进行更改（表示状态）：诸如 Strategy 和 Command 之类的 GoF 模式捕获了这种使用，和/或需要替换系统的某些部分以进行测试（即依赖项）注射）。如果开发人员遵循测试驱动的开发实践，关键基础设施对象将具有接口。这允许测试对这些对象进行“模拟”，以测试系统的控制流。接口的这种使用与 Liskov Substitution Principle（OO 设计的原则之一）之间存在关系

不太关心调用者可用的接​​口的另一个用途是标记接口。这是一种将元数据与类定义相关联的方法。这可能会影响系统查看对象的方式（例如允许对其进行序列化），或者它可能只是用作文档。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-12-27T00:12:52.607

使用接口的最重要原因之一是它们允许我们为类编写单元测试并传入我们自己的依赖项。通过将依赖项放在接口后面，我们在应用程序代码中打开了“Seams”，可以轻松编写单元测试。我在很多答案中都没有看到这个测试角度，但是了解没有接口，这些依赖项（例如 Web 服务或文件系统引用）可能变得非常难以测试或充其量是非常重要的是相当有条件的。我在这里写了一篇文章：http: [//jeffronay.com/why-use-an-interface/](http://jeffronay.com/why-use-an-interface/)更详细的代码示例显示了一个没有接口的服务类，然后使用接口重新编写了同一个类，以展示使用接口时的测试灵活性。

# widget - Nokia Widget：如何传递启动参数？

> ID：570309
> 
> 赞同：2
> 
> 时间：2009-02-20T16:45:32.917
> 
> 标签：widget, nokia

我们正在为其中一个产品开发一个新的 UI，我们正在探索使用诺基亚小部件，它似乎可以完成我们需要的几乎所有事情，但我们需要在启动时将初始令牌传递给小部件。

到目前为止，我还没有找到任何方法（查看诺基亚论坛和谷歌），所以我想知道这是否可能。

我希望我的应用程序使用单个参数启动小部件，这就是我所需要的。

# optimization - Lua 挑战：你能提高谱范数实现的性能吗？

> ID：570311
> 
> 赞同：1
> 
> 时间：2009-02-20T16:45:53.913
> 
> 标签：optimization, lua

Lua 是目前最快的脚本语言，对于某些程序来说，它并不比 C/C++ 慢多少（与 pidgits 1:1 相当），但是 Lua 在一些针对 C/C++ 的基准测试中得分非常低。

其中之一是谱范数测试（使用幂法 N=5,500 的特征值），它的得分是可怕的 1:148

```
-- The Computer Language Shootout
-- http://shootout.alioth.debian.org/
-- contributed by Isaac Gouy, tuned by Mike Pall

local function A(i, j)   
    local ij = i + j   
    return 1.0 / (ij * (ij + 1) * 0.5 + i + 1) 
end

local function Av(n, x, y)   
    for i = 0, n - 1 do
        local a = 0
        for j = 0, n - 1 do 
            a = a + A(i,j) * x[j] 
        end
        y[i] = a   
    end 
end

local function Atv(n, x, y)   
    for i = 0, n - 1 do
        local a = 0
        for j = 0, n - 1 do 
            a = a + A(j,i) * x[j] 
        end
        y[i] = a   
    end 
end

local function AtAv(n, x, y, t)   
    Av(n, x, t)   
    Atv(n, t, y) 
end

local n = tonumber(arg and arg[1]) or 100 
local u, v, t = {}, {}, {} 
for i = 0, n - 1 do 
    u[i] = 1 
end

for i = 1, 10 do 
    AtAv(n, u, v, t) 
    AtAv(n, v, u, t) 
end

local vBv, vv = 0, 0 
for i = 0, n - 1 do  
    local ui, vi = u[i], v[i]   
    vBv = vBv + ui * vi   
    vv = vv + vi * vi 
end

io.write(string.format("%0.9f\n", math.sqrt(vBv / vv))) 
```

那么如何优化它（当然，与任何优化一样，您必须测量您的实现以确保它更快）。并且你不能为此改变 Lua 的 C 核心，或者使用 LuaJit，它是关于寻找优化 Lua 弱点之一的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T22:29:44.133

罗伯特·古尔德：

> *其中之一是谱范数测试（使用幂法 N=5,500 的特征值），它的得分是可怕的 1:148*

当您引用基准游戏中的数字时，请说明这些数字的来源，以便读者了解一些背景信息。

在这种情况下，您似乎已经在四核机器上测量了数字，其中最快的程序已被重写以利用多核。而不是查看[按 CPU 时间排序的经过时间，您会看到比率下降到**1:24**](http://shootout.alioth.debian.org/u32q/benchmark.php?test=spectralnorm&lang=all&sort=fullcpu)。

或者查看中位数和四分位数，以便更好地[了解 C++ 测量集与 Lua 测量集的比较](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=all&d=data&gpp=on&gcc=on&luajit=on&lua=on&calc=calculate&box=1)。

或者有一整套测量程序被迫只使用一个内核 - [Lua 与 C++ 相比](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=lua&lang2=gpp&box=1)- 如果你看一下[那些 Lua **pi-digits**程序](http://shootout.alioth.debian.org/u32/benchmark.php?test=pidigits&lang=lua&id=1)，你会发现它们使用 C 语言 GNU GMP 库。

# asp.net - ASP.net -2147467259 (0x80004005) 错误

> ID：570312
> 
> 赞同：0
> 
> 时间：2009-02-20T16:45:56.487
> 
> 标签：asp.net

我正在尝试调试一些遗留的 asp.net 1.1 代码。我已将应用程序移至本地计算机进行调试。当我尝试加载任何 aspx 页面时，我收到以下错误。-2147467259 (0x80004005)

这就是页面上的全部内容。任何人都知道我应该从哪里开始解决这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T17:50:31.030

So it turned out to be a problem with the asp.net 1.1 install.

To debug it I created a new blank page and still got the error. Created a new application with a hello world type form same error.

**Solution:** "%windir%\Microsoft.NET\Framework\v1.1.4322\aspnet_regiis.exe" -i

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:52:49.233

你必须喜欢所有这些带有相对模糊文本的错误消息，大量的解决方案已经出现。

Research I dug into really quick indicated that something good have gone wacky with the .NET 2.0 Framework after getting the 1.1 stuff on your machine. They recommended to do a repair/reinstall of the 2.0 Framework and reboot the machine. That solved their woes.

Just go down the list and one of us will have the right answer. 8^D It doesn't help when MS sends you generic errors. 8^D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T16:50:03.700

看起来像“访问被拒绝”错误，如果您在 Windows 中查找该错误代码，我会检查是否正在生成“临时 ASP.Net 文件”以及用于编译代码的身份可以阅读源文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T16:50:54.183

0x80004005 是 COM 错误代码 E_FAIL “未指定错误”。所以一些 COM 方法调用失败了。

是时候找到一个重新创建，然后使用分而治之来找到发生这种情况的地方。

它很容易在非托管代码中，因此启用本机调试并检查您是否配置了 MS 的符号服务器。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-20T16:47:34.893

对我来说，这看起来像是一个 COM 错误。如果您在收到错误时提供有关您正在做什么的更多详细信息，将会有所帮助。也许发布一些代码？

通常我看到这是在连接到数据库时。当您移动您的应用程序时，您是否适当地更改了您的数据库连接字符串？

另外，当您在本地服务器上设置 IIS 时，您是否[检查了必要的权限](http://msdn.microsoft.com/en-us/library/aa954062.aspx)？

# c - 从错误返回后释放内存的最佳方法是什么？

> ID：570317
> 
> 赞同：12
> 
> 时间：2009-02-20T16:46:54.863
> 
> 标签：c, memory, free, malloc

假设我有一个为调用者分配内存的函数：

```
int func(void **mem1, void **mem2) {
    *mem1 = malloc(SIZE);
    if (!*mem1) return 1;

    *mem2 = malloc(SIZE);
    if (!*mem2) {
        /* ... */
        return 1;
    }

    return 0;
} 
```

如果第二个 malloc() 失败，我想听听您对 free() 分配内存的最佳方式的反馈。你可以想象一个更复杂的情况，有更多的错误退出点和更多的分配内存。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-20T17:05:56.080

我知道人们不愿意使用它们，但这是`goto`C语言中的完美情况。

```
int func( void** mem1, void** mem2 )
{
    int retval = 0;
    *mem1 = malloc(SIZE);
    if (!*mem1) {
        retval = 1;
        goto err;
    }

    *mem2 = malloc(SIZE);
    if (!*mem2) {
        retval = 1;
        goto err;
    }
// ...     
    goto out;
// ...
err:
    if( *mem1 ) free( *mem1 );
    if( *mem2 ) free( *mem2 );
out:
    return retval;
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-20T17:08:46.230

在我看来，这就是 goto 合适的地方。我曾经遵循反 goto 教条，但当有人向我指出 do { ... } while (0); 时，我改变了这一点。编译成相同的代码，但不那么容易阅读。只需遵循一些基本规则，例如不使用它们，将它们保持在最低限度，仅将它们用于错误条件等......

```
int func(void **mem1, void **mem2)
{
    *mem1 = NULL;
    *mem2 = NULL;

    *mem1 = malloc(SIZE);
    if(!*mem1)
        goto err;

    *mem2 = malloc(SIZE);
    if(!*mem2)
        goto err;

    return 0;
err:
    if(*mem1)
        free(*mem1);
    if(*mem2)
        free(*mem2);

    *mem1 = *mem2 = NULL;

    return 1;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-20T17:12:23.927

这有点争议，但我认为`goto`Linux 内核中使用的方法实际上在这种情况下效果很好：

```
int get_item(item_t* item)
{
  void *mem1, *mem2;
  int ret=-ENOMEM;
  /* allocate memory */
  mem1=malloc(...);
  if(mem1==NULL) goto mem1_failed;

  mem2=malloc(...);
  if(mem2==NULL) goto mem2_failed;

  /* take a lock */
  if(!mutex_lock_interruptible(...)) { /* failed */
    ret=-EINTR;
    goto lock_failed;
  }

  /* now, do the useful work */
  do_stuff_to_acquire_item(item);
  ret=0;

  /* cleanup */
  mutex_unlock(...);

lock_failed:
  free(mem2);

mem2_failed:
  free(mem1);

mem1_failed:
  return ret;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-17T06:33:25.873

这是一个可读的替代方案：

```
int func(void **mem1, void **mem2) {
  *mem1 = malloc(SIZE);
  *mem2 = malloc(SIZE);
  if (!*mem1 || !*mem2) {
    free(*mem2);
    free(*mem1);
    return 1;
  }
  return 0;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-17T06:38:13.710

亲自; 我有一个资源跟踪库（基本上是一个平衡的二叉树），并且我有所有分配函数的包装器。

资源（例如内存、套接字、文件描述符、信号量等——您分配和释放的任何东西）都可以属于一个集合。

我还有一个错误处理库，其中每个函数的第一个参数是一个错误集，如果出现问题，遇到错误的函数会将错误提交到错误集中。

如果错误集包含错误，*则不执行任何函数*。（我在每个函数的顶部都有一个宏，它会导致它返回）。

所以多个 malloc 看起来像这样；

```
mem[0] = malloc_wrapper( error_set, resource_set, 100 );
mem[1] = malloc_wrapper( error_set, resource_set, 50 );
mem[2] = malloc_wrapper( error_set, resource_set, 20 ); 
```

无需检查返回值，因为如果发生错误，*将不会执行后续函数*，例如以下 malloc 永远不会发生。

因此，当我需要释放资源时（比如在函数结束时，该函数内部使用的所有资源都已放入一个集合中），我会释放该集合。这只是一个函数调用。

```
res_delete_set( resource_set ); 
```

我不需要专门检查错误——我的代码中*没有*if()s 检查返回值，这使得它可以维护；我发现内联错误检查的泛滥破坏了可读性和可维护性。我只有一个很好的简单的函数调用列表。

这是*艺术*，伙计:-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T16:59:50.980

调用者是否对失败前已正确分配的内存块做任何有用的事情？如果不是，被调用者应该处理释放。

有效进行清理的一种可能性是使用`do..while(0)`，它允许`break`您的示例在哪里`return`：

```
int func(void **mem1, void **mem2)
{
    *mem1 = NULL;
    *mem2 = NULL;

    do
    {
        *mem1 = malloc(SIZE);
        if(!*mem1) break;

        *mem2 = malloc(SIZE);
        if(!*mem2) break;

        return 0;
    } while(0);

    // free is NULL-safe
    free(*mem1);
    free(*mem2);

    return 1;
} 
```

如果你做了很多分配，你可能也想在`freeAll()`这里使用你的函数进行清理。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T16:53:55.017

我自己的倾向是创建一个变量参数函数来释放所有非 NULL 指针。然后调用者可以处理错误情况：

```
void *mem1 = NULL;
void *mem2 = NULL;

if (func(&mem1, &mem2)) {
    freeAll(2, mem1, mem2);
    return 1;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-17T06:12:32.460

如果上面的 goto 语句由于某种原因让您感到恐惧，您可以随时执行以下操作：

```
int func(void **mem1, void **mem2)
{
    *mem1 = malloc(SIZE);
    if (!*mem1) return 1;

    *mem2 = malloc(SIZE);
    if (!*mem2) {
        /* Insert free statement here */
        free(*mem1);
        return 1;
    }

    return 0;
} 
```

我经常使用这种方法，但只有在非常清楚发生了什么时才使用。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-05-17T04:31:57.617

我对 goto 语句的所有建议感到有点害怕！

我发现使用 goto 会导致代码混乱，这更有可能导致程序员错误。我现在的偏好是完全避免使用它，除非在最极端的情况下。我几乎从不使用它。不是因为学术完美主义，而是因为一年或更长时间后，回忆整体逻辑似乎总是比我建议的替代方案更难。

作为一个喜欢重构事物以最小化我忘记东西的选择（比如清除指针）的人，我会先添加一些函数。我假设我很可能会在同一个程序中重用这些。函数 imalloc() 将使用间接指针执行 malloc 操作；ifree() 将撤消此操作。cifree() 将有条件地释放内存。

有了这个，我的代码版本（带有第三个参数，为了演示）将是这样的：

```
// indirect pointer malloc
int imalloc(void **mem, size_t size)
{
   return (*mem = malloc(size));
}

// indirect pointer free
void ifree(void **mem)
{
   if(*mem)
   {
     free(*mem);
     *mem = NULL;
   }
}

// conditional indirect pointer free
void cifree(int cond, void **mem)
{
  if(!cond)
  {
    ifree(mem);
  }
}

int func(void **mem1, void **mem2, void **mem3)
{
   int result = FALSE;
   *mem1 = NULL;
   *mem2 = NULL;
   *mem3 = NULL;

   if(imalloc(mem1, SIZE))
   {
     if(imalloc(mem2, SIZE))
     {
       if(imalloc(mem3, SIZE))
       {
         result = TRUE;
       }            
       cifree(result, mem2);
     }
     cifree(result, mem1);
   }
  return result;
} 
```

最后，我更喜欢从一个函数返回一个。在两者之间跳出很快（在我看来，有点脏）。但更重要的是，允许您无意中轻松绕过相关的清理代码。

# c# - 在 Windows Mobile 中加载动态 DLL 失败并出现 IOException

> ID：570325
> 
> 赞同：0
> 
> 时间：2009-02-20T16:49:27.837
> 
> 标签：c#, windows-mobile

我是 Windows Mobile 开发的新手，遇到了 DLL 问题。

我正在使用 Assembly.LoadFrom() 在我的手持设备上加载 DLL，但它失败并显示以下内容： System.IO.IOException：找不到文件或程序集名称“MyCustom.dll”或其依赖项之一。

DLL 确实存在，在此之前我正在执行 File.Exists()。这是我用来得到这个错误的代码： **Assembly asb = Assembly.LoadFrom(@"MyCustom.dll");**

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T19:39:28.903

只是更详细地说明此失败的其他可能原因。

如果您查看[LoadLibrary](http://msdn.microsoft.com/en-us/library/aa909187.aspx)文档，它的状态如下：

> 除非指定模块的完整路径，否则 Windows Embedded CE 会在以下路径中搜索模块：
> 
> ```
> . The absolute path specified by the lpLibFileName parameter.
> . The .exe launch directory.
> . The Windows directory.
> . ROM DLL files.
> . An OEM-specified search path. 
> ```
> 
> 以下注册表子项指定与 LoadLibrary 和 CreateProcess 一起使用的搜索路径：复制代码

```
 HKEY_LOCAL_MACHINE\Loader   
 SystemPath=multi_sz:\\path1\\
                        \\path2\\ 
```

> 仅在未明确指定要查找的文件的路径时才搜索该路径。

这样可以帮助理解为什么它可能无法找到 dll。

如果原因是无法找到 DLL，那么这里是一篇文章的[链接](http://geekswithblogs.net/BruceEitman/archive/2008/12/23/windows-ce-loadlibrary-fails-with-error-code-193.aspx)，该链接是关于出现此问题的其他常见原因的文章：

> 造成这种情况的可能原因是：
> 
> 1.  dll 不是为 Windows CE 构建的 当从 Big Windows（NT、XP、Vista）获取 dll 并尝试在 Windows CE 设备上使用它时，会发生这种情况。
> 2.  DLL 不是为处理器系列构建的 当获取为与目标处理器不同的处理器构建的 DLL 时，会发生这种情况
> 3.  dll 需要加载的另一个 dll 不可用 当您正在加载的 DLL 然后加载另一个 DLL 并且当该 DLL 尝试加载另一个失败的 DLL 时出现故障时，就会发生这种情况。
> 4.  如果需要的函数不在 dll 中。如果系统上的 dll 与创建您链接到的 lib 时正在构建的 dll 不同，则会发生这种情况。有时这是为您的目标使用错误 SDK 的症状。

我发现我遇到的最常见的问题是它所依赖的另一个 DLL 不可用，或者其他 DLL 中的函数不可用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T16:53:08.810

您是否为此文件提供了正确的路径？

[这](http://msdn.microsoft.com/en-us/library/1009fa28.aspx)是该方法的参考

# powershell - PowerShell - “删除此文件夹中的所有文件，除了一个”的最紧凑方式

> ID：570330
> 
> 赞同：3
> 
> 时间：2009-02-20T16:51:28.830
> 
> 标签：powershell, powershell-2.0

除了PowerShell脚本中的一个文件*之外*，从文件夹中删除所有文件的最紧凑方法是什么。我根本不关心保存哪个文件，只要保存一个即可。

我正在使用 PowerShell 2 CTP。

**更新：**
到目前为止所有答案的合并......

```
$fp = "\\SomeServer\SomeShare\SomeFolder"
gci $fp |where {$_.mode -notmatch "d"} |sort creationtime -desc |select -last ((@(gci $fp)).Length - 1) |del 
```

有人看到使用这个有什么问题吗？-notmatch 部分怎么样？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T16:00:44.437

在 PS V2 中，我们添加了 -SKIP 到 Select 以便您可以执行以下操作：

目录 | 其中 {$_.mode -notmatch "d"} |select -skip 1 |del

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T17:14:55.140

如果没有任何内置函数，这有点令人费解，因为函数需要处理确定的长度。但是您可以这样做，这涉及两次查看目录

```
gci $dirName | select -last ((@(gci $dirName)).Length-1) | del 
```

我写了几个 powershell 扩展，使这样的任务更容易。一个例子是 Skip-Count，它允许在管道中跳过任意数量的元素。所以代码可以快速搜索到只看目录一次

```
gci $dirName | skip-count 1 | del 
```

跳过计数的来源：http: [//blogs.msdn.com/jaredpar/archive/2009/01/13/linq-like-functions-for-powershell-skip-count.aspx](http://blogs.msdn.com/jaredpar/archive/2009/01/13/linq-like-functions-for-powershell-skip-count.aspx)

**编辑**

为了杀死文件夹使用“rm -re -fo”而不是“del”

**编辑2**

为了避免所有文件夹（空或不），您可以这样修改代码

```
gci $dirName | ?{ -not $_.PSIsContainer } | skip-count 1 | del 
```

PSISContainer 成员仅适用于文件夹。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T17:04:09.627

怎么样：

```
dir $dirName | select -first ((dir $dirName).Length -1) | del 
```

删除除最后一个之外的所有内容。

**编辑：**一个更灵活的版本，另外你不必输入 dir 命令两次：

```
$include=$False; dir $dirNam | where {$include; $include=$True;} | del 
```

请注意，这恰恰相反，它会删除除第一个之外的所有内容。它还允许您添加子句，例如不作用于目录：

```
$include=$False; dir $dirNam | where {$include -and $_.GetType() -ne [System.IO.DirectoryInfo]; $include=$True;} | del 
```

**关于使用 Mode 属性排除目录的**编辑 2 。**我想这应该可以工作，前提是框架不会改变模式字符串的生成方式（我无法想象它会）。虽然我可能会将正则表达式收紧为：**

 **```
$_.Mode -notmatch "^d.{4}" 
```

如果您想避免打字，最好向您的个人资料添加功能：

```
function isNotDir($file) { return $file.GetType() -ne [System.IO.DirectoryInfo];}
dir $dirName | where {isNotDir($_)} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T16:52:57.493

我的最爱：

```
move file to preserve elsewhere
delete all files
move preserved file back 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T16:55:15.530

德尔*_* -排除 (dir | 排序创建时间 -desc)[0] -whatif

这将删除除最近创建的文件之外的所有文件。

# java - 将字节数组转换为浮点数组

> ID：570338
> 
> 赞同：5
> 
> 时间：2009-02-20T16:52:47.407
> 
> 标签：java, delphi, arrays

我目前正在将用于随机二进制文件访问的 Delphi 方法转换为 Java。Delphi 程序使用：

```
TSingleArray  = Array[0..MAXSIZE] of Single
...
procedure GetLinkValues(const LinkVar: Integer;  const TimePeriod: Integer; var Value: PSingleArray);
...
BlockRead(Fout, Value^, Nlinks*SizeOf(Single)); 
```

将字节数组读入 Single 数组。在 Java 中是否有一种等效的方法可以在不遍历数组的情况下执行此操作？

我目前正在使用

```
List<Float> l = new ArrayList<Float>();
…
for (int i = 0 ; i < nLinks ; i++ )
l.add( resultsFile.readFloat()); 
```

但我担心速度。字节顺序不是问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T16:57:11.470

您是否分析了代码并实际上发现它是一个问题？*有些东西*必须循环......你真的确定这是你代码中的瓶颈吗？

说了这么多，您应该能够使用我怀疑可以满足您需求的 FloatBuffer。不幸的是，Sun 的 JavaDoc 已关闭，因此我现在无法轻松链接或检查文档。

要使用 FloatBuffer，您可能需要：

*   创建与文件关联的 FileChannel（例如使用 FileInputStream.getChannel）
*   创建一个字节缓冲区
*   使用 ByteBuffer.asFloatBuffer 创建一个包装 ByteBuffer 的 FloatBuffer
*   使用 FileChannel.read(byteBuffer) 读入 ByteBuffer
*   从 FloatBuffer 读取

我对 java.nio 不是特别熟悉/熟悉，所以我*希望*这一切都是正确的——但它可能非常繁琐。你当前的循环几乎肯定更简单，所以我强烈建议你先检查一下它的性能！您可能希望将当前的 FileInputStream 包装在 BufferedInputStream 中，顺便说一句。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T11:42:09.220

根据 Jon 提供的帮助，最终代码如下所示：

```
byte[] bt = new byte[nLinks * 4];
List<Float> l = new ArrayList<Float>();
if (linkVar != 0 && timePeriod < nPeriods) {
    long p1 = RECORDSIZE * (nNodes * NODEVARS + nLinks * LINKVARS);
    long p2 = RECORDSIZE * (nNodes * NODEVARS + nLinks * (linkVar - 1));
    long p3 = offset2 + (timePeriod * p1) + p2;
    resultsFile.seek(p3);

    resultsFile.read(bt, 0, nLinks * 4);
    ByteBuffer bb = ByteBuffer.wrap(bt);
    bb.rewind();
    bb.asFloatBuffer().get(values);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-11T16:29:09.643

在某处总会有一个循环——无论是你自己的，还是在缓冲区复制方法/操作内部。加快速度的唯一方法是找到支持向量运算的硬件和编译器。

# linq-to-sql - LINQ to SQL - 截断而不是舍入的十进制数据类型

> ID：570342
> 
> 赞同：4
> 
> 时间：2009-02-20T16:53:08.857
> 
> 标签：linq-to-sql

我有一个十进制（6,1）的数据库列当使用 LINQ to SQL 保存记录时，它会截断值而不是四舍五入。

例如，如果在生成的 LINQ to SQL 查询中传递给该列的参数具有此值... -- @p1: Input Decimal (Size = 0; Prec = 6; Scale = 1) [222.259] 数据将在数据库中显示为 222.2 而不是 222.3

然后，如果我将数据库中的同一列更改为十进制（7,2）并且我不重新生成 LINQ to SQL 类，使用 LINQ 保存记录仍将截断... -- @p1：输入十进制（ Size = 0; Prec = 6; Scale = 1) [222.259] 数据将在数据库中显示为 222.20 而不是 222.26（或 222.30）

有谁知道这是否是 LINQ 的正确行为？还是 SqlServer 提供者？它的行为方式与在 mgmt studio 中手动编写查询不同，这就是为什么我对它为什么截断而不是舍入感到困惑的原因。

mgmt studio 中的以下查询... UPDATE TheTable SET TheDecimalColumn = 222.259 将在列为十进制（6,1）时将 val 设置为 222.3，当它是十进制（7,2）时将设置为 222.26

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-21T10:36:09.987

这是 sql 参数，它必须这样做，因为舍入分数不是标准化的：有不同类型的舍入算法，用于不同类型的领域，例如银行使用不同类型的舍入标准。

如果要舍入，请在设置实体值之前通过舍入值自行定义。这是合乎逻辑的，因为您将单个数字定义为比例，因此 .256 不适合单个数字，这意味着您要么应该得到一个异常（linq to sql 不支持对此进行内存验证），要么它被截断在较低的级别。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T17:24:56.970

您是否尝试过使用 DataContext.Log 从 LINQ 查询中提取原始 SQL？如果当您通过管理工作室手动执行查询时查询有效，则提供程序可能会截断查询中的值。 [这](http://mattberseth.com/blog/2008/01/profiling_linq_to_sql_using_th.html)是一篇关于如何获取原始 SQL 的文章。您可能还想检查列的类型在 .dlinq 文件中是否正确表示。

PS-[找到](http://social.msdn.microsoft.com/Forums/en-US/linqtosql/thread/0006625b-cb16-4a2b-b533-917d9d5c55cc/)你的问题..小网吧？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-09-02T14:09:32.220

我遇到过同样的问题。您可以通过将 EntityConfiguration 添加到您的实体来控制 LINQ/EF 将数据导出到 SQL 的精度：

```
namespace your.namespace.in.here
{
    class foobarEntityConfiguration : EntityTypeConfiguration<foobarEntity>
    {
        public foobarEntityConfiguration()
        {
            this.Property(x => x.foobarPropertyBeingTruncated)
                .HasPrecision(18, 5);
        }
    }
} 
```

由于 LINQ/EF 有这个错误，并且作为一般规则，我发现在显示时间之前保持尽可能高的精度是一件好事。让表示层根据需要进行任何舍入/截断。然后，如果在 SQL 或报表生成器中有一个 post-LINQ-export 计算，那么您的货币中的便士更有可能匹配。

请注意，在我的情况下，没有明显的原因，LINQ 之前被截断到小数点后 2 位。根据文档，LINQ/EF 根据相关小数的精度做出决定。

# debugging - 最难追踪的错误类型？

> ID：570353
> 
> 赞同：50
> 
> 时间：2009-02-20T16:55:10.133
> 
> 标签：debugging, language-agnostic, testing

您必须跟踪和修复哪些最讨厌、最困难的错误，为什么？

在我们说话的过程中，我真的很好奇，也深深地沉浸在这个过程中。正如他们所说 - 苦难喜欢陪伴。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-02-20T16:59:32.930

[海森虫](http://en.wikipedia.org/wiki/Unusual_software_bug#Heisenbug "维基百科")：

> heisenbug（以海森堡不确定性原理命名）是一种计算机错误，当尝试对其进行研究时，它会消失或改变其特征。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-02-20T16:57:22.467

竞争条件和死锁。我做了很多多线程进程，这是最难处理的事情。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-02-20T17:06:00.013

在发布模式下编译而不是在调试模式下编译时发生的错误。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-02-20T17:04:39.517

基于时间条件的任何错误。这些通常在处理线程间通信、外部系统、从网络读取、从文件读取或与任何外部服务器或设备通信时出现。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-02-20T17:03:48.177

错误不在您的代码本身中，而是在您所依赖的供应商模块中。特别是当供应商没有响应并且您被迫破解解决方法时。非常令人沮丧！

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-02-20T17:06:17.470

我们正在开发一个数据库来保存另一种语言的单词和定义。事实证明，这种语言只是最近才被添加到 Unicode 标准中，并且没有进入 SQL Server 2005（尽管它是在 2005 年左右添加的）。这在整理时产生了非常令人沮丧的效果。

单词和定义很好，我可以在 Management Studio 中看到所有内容。但是，每当我们试图找到给定单词的定义时，我们的查询什么都没有返回。经过 8 个小时的稳定调试后，我一度认为我已经失去了编写简单 SELECT 查询的能力。

也就是说，直到我注意到英文字母与其他英文字母匹配，并带有任意数量的外国字母。例如，**EnglishWord**将匹配**E!n@gl##$ish$&Word**。（用 !@#$%^&* 代表外国字母）。

当排序规则不知道某个字符时，它无法对它们进行排序。如果它不能对它们进行排序，它就无法判断两个字符串是否匹配（对我来说很惊讶）。如此令人沮丧，一整天都在为一个愚蠢的整理设置而浪费掉。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-02-20T16:58:24.943

线程错误，尤其是竞争条件。当您无法停止系统时（因为错误消失了），事情很快就会变得艰难。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-02-20T17:53:03.050

我通常遇到的最难的是那些没有出现在任何日志跟踪中的。你永远不应该默默地吃异常！问题是吃异常通常会使您的代码进入无效状态，稍后它会在另一个线程中以完全不相关的方式失败。

也就是说，我真正遇到过的最困难的是函数调用中的 C 程序，其中调用签名与被调用签名不完全匹配（一个是 long，另一个是 int）。编译时或链接时没有错误，并且大多数测试都通过了，但是堆栈被 sizeof(int) 关闭，因此堆栈上的变量会随机具有错误的值，但大多数时候它会正常工作（该错误参数后面的值通常被传入为零）。

那是一个要跟踪的婊子。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2009-02-20T19:12:31.363

由于硬件损坏，负载下的内存损坏。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-02-20T16:58:50.060

*   发生在一台服务器上而不是另一台服务器上的错误，并且您无权访问有问题的服务器来调试它。
*   与线程有关的错误。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-02-20T17:08:01.303

对我来说最令人沮丧的是编译器错误，其中代码是正确的，但我遇到了未记录的极端情况或编译器错误的地方。我从假设我犯了一个错误开始，然后花了几天时间试图找到它。

编辑：另一个最令人沮丧的是我的测试用例设置有点错误，所以我的代码是正确的，但测试不是。这需要几天时间才能找到。

总的来说，我猜我遇到的最糟糕的错误不是我的错。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-02-21T13:15:10.637

最难追踪和修复的错误是那些结合了所有困难案例的错误：

*   由第三方报告，但您无法在自己的测试条件下复制；
*   错误很少发生且不可预测（例如，因为它是由竞争条件引起的）；
*   错误在嵌入式系统上，您无法附加调试器；
*   当您尝试获取日志信息时，错误消失了；
*   错误存在于第三方代码中，例如库...
*   ...您没有源代码，因此您只能使用反汇编；
*   并且该错误位于多个硬件系统之间的接口处（例如网络协议错误或总线争用错误）。

本周我正在研究具有所有这些功能的错误。有必要对库进行逆向工程以找出它在做什么；然后生成关于哪两个设备正在竞速的假设；然后制作程序的特殊仪器版本，旨在引发假设的竞争条件；然后，一旦其中一个假设得到确认，就可以同步事件的时间，以便图书馆在 100% 的时间内赢得比赛。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-02-20T18:38:50.100

有一个项目使用 beowulf 集群构建化学工程模拟器。碰巧网卡不会传输一个特定的字节序列。如果数据包包含该字符串，则该数据包将丢失。他们通过更换硬件解决了这个问题——首先找到它要困难得多。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-03-12T23:05:09.050

我必须找到的最难的错误之一是仅在程序运行数小时后才发生的内存损坏错误。由于破坏数据所需的时间很长，我们假设硬件并首先尝试了两三台其他计算机。

该错误需要数小时才能出现，并且当它确实出现时，通常只有在程序变得如此混乱它开始出现异常行为之后的相当长的一段时间内才被注意到。将代码库缩小到错误发生的位置非常困难，因为由于内存损坏而导致的崩溃从未发生在损坏内存的函数中，而且该错误花了很长时间才显现出来。

事实证明，该错误是一个很少被调用的代码中的一个错误，用于处理有问题的数据行（内存中的无效字符编码）。

最后，调试器被证明几乎没用，因为在调用树中从未发生过有问题的函数的崩溃。代码中的 fprintf(stderr, ...) 调用顺序良好，并将输出转储到文件中，这最终使我们能够确定问题所在。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-03-12T23:52:53.367

并发错误很难跟踪，因为当您还不知道错误是什么时，重现它们可能非常困难。这就是为什么每次在日志中看到无法解释的堆栈跟踪时，都应该搜索该异常的原因，直到找到它。即使它只发生百万分之一，但这并不意味着它不重要。

由于不能依靠测试来重现错误，因此必须使用演绎推理来找出错误。这反过来需要深入了解系统的工作原理（例如 Java 的内存模型如何工作以及并发错误的可能来源）。

这是我几天前发现的[Guice 1.0](http://code.google.com/p/google-guice/)中的并发错误示例。您可以通过尝试找出导致该异常的错误来测试您的错误发现技能。这个错误并不难找到——我在大约 15-30 分钟内找到了它的原因（答案在[这里](http://groups.google.com/group/google-guice/browse_thread/thread/7cdff66a4b7acc9d?hl=en)）。

```
java.lang.NullPointerException 
    at com.google.inject.InjectorImpl.injectMembers(InjectorImpl.java:673) 
    at com.google.inject.InjectorImpl$8.call(InjectorImpl.java:682) 
    at com.google.inject.InjectorImpl$8.call(InjectorImpl.java:681) 
    at com.google.inject.InjectorImpl.callInContext(InjectorImpl.java:747) 
    at com.google.inject.InjectorImpl.injectMembers(InjectorImpl.java:680) 
    at ... 
```

PS 有缺陷的硬件可能会导致比并发更严重的错误，因为您可能需要很长时间才能自信地断定代码中没有错误。幸运的是，硬件错误比软件错误少。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-02-20T17:03:42.687

我的一个朋友有这个错误。他不小心将 C 程序中的函数参数放在方括号中，而不是像这样的括号：`foo[5]`而不是`foo(5)`. 编译器非常高兴，因为函数名是一个指针，并且对指针进行索引并不违法。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-02-20T19:16:44.690

对我来说最令人沮丧的事情之一是软件规范中的算法错误。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2009-02-25T16:00:14.903

可能不是最难的，但它们非常常见且并非微不足道：

*   关于可变状态的错误。如果数据结构具有许多可变字段，则很难在数据结构中维护不变量。而且你有操作顺序依赖性 - 交换两行并且发生了一些不好的事情。我最近发现的一个难以发现的错误是，当我发现我维护的系统的前一个开发人员使用可变数据作为哈希表键时——在一些罕见的情况下，它会导致无限循环。
*   初始化错误的顺序。找到时可能很明显，但在编码时并非如此。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-02-25T16:57:03.300

有史以来最难的一个实际上是我帮助朋友解决的一个错误。他在 MS Visual Studio 2005 中编写 C，忘记包含 time.h。他进一步调用了没有所需参数的时间，通常为 NULL。这隐含声明的时间如：int time(); 这破坏了堆栈，并且以一种完全不可预测的方式。这是大量的代码，我们有一段*时间*没有想到看 time() 调用。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-02-20T17:00:17.873

缓冲区溢出（在本机代码中）

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-02-20T17:04:52.853

去年，我花了几个月的时间来跟踪一个最终成为下游系统错误的问题。来自违规系统的团队负责人一直声称在我们的处理过程中一定很有趣，即使我们按照他们要求的方式传递了数据。如果领导能更合作一点，我们可能会更快地解决这个错误。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2009-02-20T17:05:06.660

未初始化的变量。（或者现代语言已经废除了这个？）

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2009-02-20T21:21:57.073

对于嵌入式系统：

客户在现场报告的异常行为，但我们无法重现。

在那之后，结果是由于一系列怪异事件或事件同时发生的错误。这些至少是可重现的，但显然它们可能需要很长时间 - 以及大量的实验 - 才能实现。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-02-20T16:57:25.697

追踪难度：

*   一个错误
*   边界条件错误

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2009-02-20T17:02:24.123

当对象被缓存并且它们的equals和hashcode实现实施得非常糟糕以至于hash码值不是唯一的并且equals在它不相等时返回true。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-02-20T17:07:45.827

机器相关问题。

我目前正在尝试调试为什么应用程序在 try{} catch{} 块中存在未处理的异常（是的，在 try / catch 中未处理），该异常仅在某些 OS / 机器版本上出现，而在其他版本上不出现。

相同版本的软件，相同的安装媒体，相同的源代码，适用于一些 - 未处理的异常，应该是其他代码中处理得很好的部分。

嘎。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-02-20T17:41:48.787

涉及各种浏览器 O/S 配置中的样式的装饰性网络错误，例如，在 Firefox 和 IE 中，页面在 Windows 和 Mac 中看起来不错，但在 Safari 中的 Mac 上看起来有些混乱。这些有时很烦人，因为它们需要非常关注细节，并且进行更改以修复 Safari 可能会破坏 Firefox 或 IE 中的某些内容，因此必须小心行事并意识到样式可能是一系列修复页面后的黑客行为。我会说那些是我最讨厌的，有时只是没有得到修复，因为它们不被视为重要。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-02-20T17:45:24.847

回到过去，内存泄漏。值得庆幸的是，现在有很多工具可以找到它们。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2009-02-20T18:45:40.817

内存问题，尤其是在旧系统上。我们有一些遗留的 16 位 C 软件暂时必须保持 16 位。64K 内存块很难使用，我们不断添加静态或代码逻辑，使我们超越 64K 组的限制。

更糟糕的是，内存错误通常不会导致程序崩溃，但会导致某些功能偶尔中断（并且并不总是相同的功能）。调试是不可选择的——调试器没有相同的内存限制，所以程序在调试模式下总是运行良好......另外，我们不能添加内联 printf 语句进行测试，因为这会增加内存使用率。

因此，我们有时可能会花费 DAYS 来寻找要重写的单个代码块，或者花费数小时将静态字符移动到文件中。幸运的是，系统正在慢慢脱机。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2009-02-20T18:48:34.040

多线程、内存泄漏、任何需要大量模拟的东西、与第三方软件的接口。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2009-02-25T16:51:24.530

毫无疑问，内存泄漏。尤其是当您在 ASP.NET 中动态创建控件和添加处理程序时。在页面加载时。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-03-12T21:36:24.987

线程泄漏，你经常忘记计算线程数

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-03-12T22:42:56.467

这纯粹是虚构的，但Ellen Ullman[的 The Bug](https://rads.stackoverflow.com/amzn/click/com/1400032350)是一个很好的故事，讲述了一个很难找到的 bug，它产生了悲惨的后果。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-04-13T18:40:11.567

edbdic 系统上的字符转换问题，其中处理此问题的系统机制已被禁用 - 呃

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2013-10-01T20:00:00.653

处理用户在与网站交互时打开多个选项卡的情况。很难避免数据连续性问题。我猜这取决于应用程序，但这是我们花费大量时间来解决的问题！

# html - 如何在 HTML 中为图像添加边框？

> ID：570356
> 
> 赞同：29
> 
> 时间：2009-02-20T16:55:28.180
> 
> 标签：html, css

如何使用 HTML 为图像添加边框？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-20T16:58:31.870

两种方式：

```
<img src="..." border="1" /> 
```

或者

```
<img style='border:1px solid #000000' src="..." /> 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-02-20T17:05:00.857

这是一些可以解决您的问题的 HTML 和 CSS 代码：

**CSS**

```
.ImageBorder
{
    border-width: 1px;
    border-color: Black;
} 
```

**HTML**

```
<img src="MyImage.gif" class="ImageBorder" /> 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-02-20T16:59:39.217

您还可以添加填充以获得良好的效果。

```
<img src="image.png" style="padding:1px;border:thin solid black;"> 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-20T20:00:16.910

我也更喜欢 CSS 而不是 HTML；HTML 是关于内容的，CSS 是关于呈现的。

使用 CSS，您有三个选择。

1.  内联 CSS（如 Trevor 和 Diodeus 的解决方案）。难以维护，并且不能保证一致性：您必须检查自己是否每个图像都具有相同的边框宽度和边框颜色。
2.  内部样式表。解决了页面上所有具有 class="hasBorder" 的图像的一致性问题，但您必须为每个页面包含一个样式表，并再次确保每次都定义相同的“hasBorder”。
3.  外部样式表。如果您在每个页面上包含指向外部 CSS 文件的链接，则所有页面上*所有*带有 class="hasBorder" 的图像都将具有相同的边框。

使用内部样式表的示例：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
              "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Image with border</title>

<style type="text/css">
  img.hasBorder { border:15px solid #66CC33; }
</style>

</head>

<body>
  <img class="hasBorder" src="peggy.jpg" alt="" />
</body>
</html> 
```

如果您想要一个外部样式表，请将 <style>...</style> 块替换为

```
<link rel="stylesheet" type="text/css" href="somestylesheet.css" /> 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-20T16:57:16.990

`border="1"`ON IMAGE 标签或使用 css`border:1px solid #000;`

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-08-28T14:46:01.277

CSS

```
img{border:2px solid black;} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-20T22:26:53.097

杰克，

[您可以在http://www.w3schools.com/css/css_border.asp](http://www.w3schools.com/css/css_border.asp)了解很多关于边框以及如何使用它们的知识。话虽如此，有几种不同的方法可以实现这一点。

以下是我通常的做法，但阅读 w3schools 上的文档，您可能会找到自己想要的方法。

```
.addBorder {
  /* Thickness, Style, and Color */
  border: 1px solid #000000;
}

<img src="mypicture.jpg" alt="My Picture" class="addBorder" /> 
```

**编辑：**

我注意到最初的问题不是“如何为图像添加边框”，而是“如何使用 html 在图像周围添加一个框？” 这个问题是由其他人重写的，所以我不能 100% 确定你想要在你的图像上加一个边框。

如果您只想在图像周围放置一个框，则可以使用具有自己样式的 DIV：

```
.imageBox {
  background-color:#f1f1f1;
  padding:10px;
  border:1px solid #000000;
}

<div class="imageBox">
  <img src="picture.jpg" alt="My Picture" />
</div> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-16T20:52:03.400

如上所述，简单的代码行将解决您的问题

```
border: 1px solid #000; 
```

还有另一种为图像添加边框的选项，使用 Photoshop，您可以在下面的本教程中看到它是如何完成的：http: [//bannercheapdesign.com/articles-and-tutorials/learn-how-to-add-border-to -your-banner-design-using-photoshop/](http://bannercheapdesign.com/articles-and-tutorials/learn-how-to-add-border-to-your-banner-design-using-photoshop/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T17:29:19.333

正确的方法取决于您是只希望内容中的特定图像有边框，还是代码中存在某些图像需要有边框的模式。在第一种情况下，使用 img 元素的 style 属性，否则给它一个有意义的类名并在样式表中定义该边框。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-12-07T21:17:32.513

我敢肯定，上面的答案非常好。但是对于像我这样的笨蛋，我推荐 Snagit 10。在将图像插入网页之前，您可以为图像添加任意宽度、样式和颜色的边框。他们在 30 天试用期执行完整的工作计划。

# sql - 使用 RegExp (PREG) 提取函数参数

> ID：570357
> 
> 赞同：1
> 
> 时间：2009-02-20T16:55:44.983
> 
> 标签：sql, regex, pcre

考虑以下函数参数（它们已经从函数中提取）：

```
Monkey,"Blue Monkey", "Red, blue and \"Green'",  'Red, blue and "Green\'' 
```

有没有办法使用正则表达式提取参数以获取以下数组输出并去除空格：

```
[Monkey, "Blue Monkey", "Red, blue and \"Green'", 'Red, blue and "Green\''] 
```

我坚持使用这个不够宽松的 RegExp：

```
/(("[^"]+"|[^\s,]+))/g 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T17:22:10.987

这看起来有点讨厌，但它有效：

```
/(?:"(?:[^\x5C"]+|\x5C(?:\x5C\x5C)*[\x5C"])*"|'(?:[^\x5C']+|\x5C(?:\x5C\x5C)*[\x5C'])*'|[^"',]+)+/g 
```

我使用`\x5C`的不是普通的反斜杠字符`\`，因为太多可能会造成混淆。

此正则表达式由以下部分组成：

1.  `"(?:[^\x5C"]+|\x5C(?:\x5C\x5C)*[\x5C"])*"`匹配双引号字符串声明
2.  `'(?:[^\x5C']+|\x5C(?:\x5C\x5C)*[\x5C'])*'`匹配单引号字符串声明
3.  `[^"',]+`匹配任何其他内容（逗号除外）。

的部分`"(?:[^\x5C"]+|\x5C(?:\x5C\x5C)*[\x5C"])*"`是：

1.  `[^\x5C"]+`匹配除退格和引号字符之外的任何内容
2.  `\x5C(?:\x5C\x5C)*[\x5C"]`匹配正确的转义序列，如`\"`, `\\`, `\\\"`,`\\\\`等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T17:14:07.933

不确定您正在寻找什么，也不知道如何在 SQL 中执行此操作，但这样的内容还不够：

（以python为例）

```
import re
x = '''Monkey, "Blue Monkey", "Red, blue and "Green\\"", 'Red, blue and "Green\\'\''''
l = re.split(',\s*',x)
print x
for a in l:
    print a 
```

# windows - 面向 Web 开发人员的 Windows 许可

> ID：570375
> 
> 赞同：-1
> 
> 时间：2009-02-20T16:58:56.723
> 
> 标签：windows, licensing, upgrade

我现在和将来都需要在 Windows 上测试我的网站。我还没有Windows。我只需要软件，但不介意购买硬件来获取软件。什么是最便宜的道德方式来做到这一点？

一些选项：

*   在 eBay 上购买二手电脑。如果我还升级硬件（包括除硬盘驱动器之外的所有设备），我是否能够升级到 Windows 的未来版本？我正在考虑在 eBay 上购买一个装有 Windows XP Pro 的 100 美元盒子。

*   购买 Windows XP Pro（在 eBay 上大约 140 美元），并随着时间的推移支付升级费用。

*   在网络上使用屏幕捕获服务。（根据我的经验，这些要么太贵，要么不能提供足够的控制）。

更新：我从亚马逊的经销商处购买了密封版的 XP Pro。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T17:18:11.560

VMWare Server 是免费提供的，并且可用于 Linux。您仍然需要为 Windows 付费，但您不需要额外的硬件。

此外，考虑到除了 XP 之外，您可能还想在 Vista 和 Windows 7 上进行测试。虚拟化是一个很好的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T17:46:38.790

另一个免费的解决方案是来自 Sun 的[VirtualBox](http://www.virtualbox.org/)，它能够安装在 Windows XP Home（VMWare Server 不会）上。可能不是您需要的，因为您不是 Windows，但无论如何它是另一种选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T18:07:18.477

如果您购买收缩包装副本，则家庭 Windows 许可证仅花费这么多钱。与新 PC (OEM) 捆绑在一起的版本要便宜得多——如果你愿意按照你所说的那样购买硬件，Windows 许可证的成本可能低至总成本的 25 美元。

只需 299 美元，您就可以买到一台不错的上网本；这个有 160GB 的硬盘空间、Windows XP Home、1GB 的内存，并且对于网页浏览来说非常快（我还运行 SQL Server 以在升级到 2GB 的一个上进行测试）。如果分辨率成为问题 (1024x600)，只需插入外接显示器即可。作为奖励，它是一台小型机器，因此它不会像另一个桌面那样占用大量空间。

[EEE 900HA XP](http://www.newegg.com/Product/Product.aspx?Item=N82E16834220441)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T18:16:09.220

如前所述，您可以获得 Microsoft 免费的 VPC 映像。然后使用[VMware vCenter Converter将它们转换为 VMWare 映像（服务器版本是免费的）](http://www.vmware.com/products/converter/overview.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T17:02:16.120

下载虚拟 PC：[http ://www.microsoft.com/downloads/details.aspx?FamilyID=b07c9ef0-265a-4237-ae3b-25bc8937d40f&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=b07c9ef0-265a-4237-ae3b-25bc8937d40f&displaylang=en)

并使用这个：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=7c2b5317-a40f-4e86-8835-d37170c5923e&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=7c2b5317-a40f-4e86-8835-d37170c5923e&displaylang=en)

编辑：如果你没有 Windows，Virtual PC 可以在 Wine 上运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T17:05:35.333

[browsershots.org](http://browsershots.org)应该可以满足基本需求，尽管它只是展示了它的外观，而不是任何功能。

# java - 奇怪的 .bat 文件行为

> ID：570376
> 
> 赞同：1
> 
> 时间：2009-02-20T16:59:19.810
> 
> 标签：java, windows, character-encoding, batch-file

我有一个包含以下内容的 bat 文件：

```
set logfile=  D:\log.txt

java com.stuff.MyClass %1 %2 %3  >> %logfile% 
```

但是，当我运行 bat 文件时，我得到以下信息：

```
C:\>set logfile= D:\log.txt

C:\>java com.stuff.MyClass <val of %1> <val of %2> <val of %3>   1>>D:\log.txt
The parameter is incorrect. 
```

我几乎肯定“参数不正确”。是因为里面有多余的1。我还认为这可能与 .bat 文件的编码有关，但我不太清楚是什么原因造成的。任何人以前遇到过这种情况或知道可能导致它的原因以及如何解决它？

**编辑**

和往常一样，教训是在寻求帮助之前先检查它是否已插入。版本控制中的 bat 文件使用 D:\log.txt，因为它旨在从包含 D 驱动器的服务器运行。在没有 D 驱动器的计算机上测试我的更改并在本地运行时，我未能进行更改以使用 C:\log.txt，这就是导致错误的原因。很抱歉浪费您的时间，感谢您的帮助，尽量抵制过度投票给我的冲动。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T17:07:19.713

我怀疑这就是问题所在 - 我希望命令处理器为您处理该部分。

这是它对我有用的证据：

测试.java：

```
public class Test
{
    public static void main(String args[]) throws Exception
    {
        System.out.println(args.length);
        for (String arg : args)
        {
            System.out.println(arg);
        }
    }
} 
```

测试.bat：

```
set logfile= c:\users\jon\test\test.log
java Test %1 %2 %3 >> %logfile% 
```

在命令行上：

```
c:\Users\Jon\Test> [User input] test.bat first second third

c:\Users\Jon\Test>set logfile= c:\users\jon\test\test.log

c:\Users\Jon\Test>java Test first second third  1>>c:\users\jon\test\test.log

c:\Users\Jon\Test> [User input] type test.log
3
first
second
third 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:12:36.160

the 1 is not extraneous: it is inserted by cmd.exe meaning stdout (instead of ">>", you can also write "1>>". contrast this to redirecting stderr: "2>>"). so the problem must be with your parameters.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T18:09:40.950

This may seem like a stupid question, but is there an existing D: drive in the context that the bat file runs in?

Once I had a case where a bat file was used as the command line of a task within the Task Manager, but the Run As user was set to a local user on the box, giving no access to network drives.

Interpolated for your case, if the D: drive were a network drive, running the bat file as, say, the local administrator account on that machine instead of a domain user account would likely fail to have access to D:.

# java - 从 Java 调用 mysql.exe

> ID：570384
> 
> 赞同：2
> 
> 时间：2009-02-20T17:00:52.927
> 
> 标签：java, mysql, windows

我正在从 Java 调用 mysql.exe 来加载数据库。因为进程只是挂起，我需要创建一个命令文件并传入用户名和密码。

command.bat 的示例内容：

```
mysql --user="%1" --password="%2" mydatabase < myscript.sql 
```

问题是我看不到 mysql 命令的输出以查看是否有任何错误。它们显示在命令行上，但我似乎无法将它们捕获到文件中以进行解析或 InputStream。

如何查看 mysql 命令的输出？

注意：直接从 Java 调用 mysql.exe 会挂起，因为 mysql 似乎没有将信息发送到缓冲区。

注意：我们使用 mysql.exe 而不是 JDBC，因为我们需要更新触发器之类的东西。为了将所有语句提交到数据库，我们需要解析所有命令并一次将它们传递给它们。

注意：这是一个正在运行的 MySQL 数据库，需要升级。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T17:18:32.837

如果您仅从 Java 中访问此数据库，更好的解决方案是[Connector/MXJ](http://dev.mysql.com/downloads/connector/mxj/5.0.html)。这将允许您简单地进行格式良好的 JDBC 调用，并且该库将自动为您处理数据库启动。

基本上，jar 文件包含 mysql 服务器可执行文件的实例（或者，对于多个平台，实例）。它还包含一个框架，您可以在其中为数据库加载预填充的数据。

第一次访问 JDBC 连接时，它将从 jar 中拉出正确的 mysql 服务器，并在当前目录中创建数据库（使用上面的预填充数据）。正如预期的那样，从那时起的任何更改都将是持久的。

这里有更多信息：

[通过 JDBC 启动](http://dev.mysql.com/doc/refman/5.0/en/connector-mxj-configuration-driver-launched.html)

[通过 Java 对象启动](http://dev.mysql.com/doc/refman/5.0/en/connector-mxj-configuration-java-object.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T19:22:15.443

您应该查看[Process Builder](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/ProcessBuilder.html)。它使您可以处理输入/输出和错误流。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T18:06:41.660

不知道为什么你不能查看它的输出。尝试将其输出到文件，然后同时使用 Java 从文件中读取。

我自己没有试过这个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-01T20:38:07.300

> 问题是我看不到 mysql 命令的输出以查看是否有任何错误。> 它们显示在命令行上，但我似乎无法将它们捕获到用于解析的文件或 InputStream 中。

使用 2>你的文件名

例如

mysql --user="%1" --password="%2" mydatabase < myscript.sql 2>myoutput.txt

应该捕获 STDERR（MySQL.exe 将其输出发送到此处）

例如

mysql --user="%1" --password="%2" mydatabase < myscript.sql >myoutput.txt 2>&1

将在同一个文件 (=myoutput.txt) 中捕获 STDOUT 和 STDERR。

# visual-studio-2008 - Xsd2code 在 VS 2008 中不起作用

> ID：570387
> 
> 赞同：1
> 
> 时间：2009-02-20T17:02:27.150
> 
> 标签：visual-studio-2008, xsd, add-in

我正在尝试使用 Xsd2Code，但是当我在解决方案资源管理器中右键单击 xsd 文件时，插件没有显示。安装顺利进行，没有任何故障，但我仍然无法看到或使用插件 VS 2008。我的操作系统是 Vista x64。任何帮助都感激不尽。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T12:37:39.893

有同样的问题。2.8.1 安装没有任何错误但它没有显示为右键单击选项。我可以打开命令窗口并从那里运行它，而不是通过 gui。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-11T01:03:27.527

我在 64 位 Windows 7 Enterprise (SP1) 下运行 Visual Studio 2010 (SP1) 时遇到了这个问题。

加载项不会显示在上下文菜单或加载项管理器中。

然后我从我的计算机上卸载了 xsd2code 并以管理员权限安装，问题得到解决。

由于“以管理员身份运行”不适用于 MSI 文件，我启动了管理员命令提示符并运行了安装程序，这解决了问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-27T19:08:41.873

我的环境 Window7 - VS2010 SP1。在尝试了所有可能性之后，最简单的解决方案对我有用 - 查找 xsd2code 安装插件的位置 => 可能在 c:\users[YourName]\My Documents\Visual Studio 2010\Addins 或 c:\Visual Studio 2010\Addins - 在视觉工作室。转到工具->选项->加载项/宏安全性->添加-找到加载项的路径并添加到此选项。- 重启你的电脑。- 当您右键单击 .Xsd 时，“运行 Xsd2Code 生成”将可用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-21T18:00:33.750

安装可能将文件放置在 VS 未查看的位置。有一个问题单提到了这一点

[http://xsd2code.codeplex.com/WorkItem/View.aspx?WorkItemId=6988](http://xsd2code.codeplex.com/WorkItem/View.aspx?WorkItemId=6988)

# arrays - Postgres整数数组作为参数？

> ID：570393
> 
> 赞同：44
> 
> 时间：2009-02-20T17:03:18.223
> 
> 标签：arrays, postgresql, argument-passing

我知道在 Postgres pure 中，您可以将整数数组传递给函数，但 .NET 数据提供程序 Npgsql 不支持此功能。

我目前有一个 DbCommand，我在其中加载对存储过程的调用，添加参数并执行标量以获取 Id 以填充对象。

现在需要将 n 个整数作为参数。这些用于创建子记录，通过它的 id 将新创建的记录链接到整数参数。

理想情况下，我宁愿不必为每个整数在我的 DbCommand 上进行多次 ExecuteNonQuery 调用，因此我将构建一个 csv 字符串作为将在数据库端拆分的参数。

我通常生活在 LINQ 2 SQL 中，享受 Db 抽象，在这个项目上使用手动数据访问，这一切都变得有点脏，人们通常如何将这些类型的参数传递给 postgres？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-02-20T20:54:55.827

见：[http ://www.postgresql.org/docs/9.1/static/arrays.html](http://www.postgresql.org/docs/9.1/static/arrays.html)

如果您的非本地驱动程序仍然不允许您传递数组，那么您可以：

*   传递数组的字符串表示形式（然后您的存储过程可以将其解析为数组——请参阅[`string_to_array`](http://www.postgresql.org/docs/current/static/functions-array.html)）

    ```
    CREATE FUNCTION my_method(TEXT) RETURNS VOID AS $$ 
    DECLARE
           ids INT[];
    BEGIN
           ids = string_to_array($1,',');
           ...
    END $$ LANGUAGE plpgsql; 
    ```

    然后

    ```
    SELECT my_method(:1) 
    ```

    与：1 =`'1,2,3,4'`

*   依赖 Postgres 本身将字符串转换为数组

    ```
    CREATE FUNCTION my_method(INT[]) RETURNS VOID AS $$ 
           ...
    END $$ LANGUAGE plpgsql; 
    ```

    然后

    ```
    SELECT my_method('{1,2,3,4}') 
    ```

*   选择不使用绑定变量并发出一个明确的命令字符串，其中包含所有参数的拼写（确保验证或转义来自外部的所有参数，以避免 SQL 注入攻击。）

    ```
    CREATE FUNCTION my_method(INT[]) RETURNS VOID AS $$ 
           ...
    END $$ LANGUAGE plpgsql; 
    ```

    然后

    ```
    SELECT my_method(ARRAY [1,2,3,4]) 
    ```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2011-10-11T23:30:12.863

我意识到这是一个老问题，但我花了几个小时才找到一个好的解决方案，并认为我会传递我在[这里](http://fxjr.blogspot.com/2009/05/npgsql-tips-using-in-queries-with.html)学到的东西并为其他人省去麻烦。试一下，例如，

```
 SELECT * FROM some_table WHERE id_column = ANY(@id_list) 
```

where`@id_list`被绑定到一个`int[]`参数

```
 command.Parameters.Add("@id_list", NpgsqlDbType.Array|NpgsqlDbType.Integer).Value = my_id_list; 
```

其中 command 是 NpgsqlCommand（在 Visual Studio 中使用 C# 和 Npgsql）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-09-01T23:36:37.483

您*始终*可以使用格式正确的字符串。诀窍是格式。

`command.Parameters.Add("@array_parameter", string.Format("{{{0}}}", string.Join(",", array));`

请注意，如果您的数组是一个字符串数组，那么您将需要使用`array.Select(value => string.Format("\"{0}\", value))`或等效的。我在 PostgreSQL 中将这种样式用于枚举类型的数组，因为数组没有自动转换。

在我的例子中，我的枚举类型有一些值，比如`'value1'`, `'value2'`, `'value3'`，而我的 C# 枚举有匹配的值。在我的例子中，最终的 SQL 查询最终看起来像`(E'{"value1","value2"}')`，这很有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-01-26T05:11:03.853

> 完整的编码结构

**PostgreSQL 函数**

```
CREATE OR REPLACE FUNCTION admin.usp_itemdisplayid_byitemhead_select(
    item_head_list int[])
    RETURNS TABLE(item_display_id integer) 
    LANGUAGE 'sql'

    COST 100
    VOLATILE 
    ROWS 1000

AS $BODY$ 
        SELECT vii.item_display_id from admin.view_item_information as vii
where vii.item_head_id = ANY(item_head_list);
    $BODY$; 
```

**模型**

```
public class CampaignCreator
    {
        public int item_display_id { get; set; }
        public List<int> pitem_head_id { get; set; }
    } 
```

**.NET CORE 函数**

```
DynamicParameters _parameter = new DynamicParameters();
                _parameter.Add("@item_head_list",obj.pitem_head_id);

                string sql = "select * from admin.usp_itemdisplayid_byitemhead_select(@item_head_list)";
                response.data = await _connection.QueryAsync<CampaignCreator>(sql, _parameter); 
```

# python - 使用 Twisted，“connectionMade”如何触发特定的 Deferred？

> ID：570397
> 
> 赞同：2
> 
> 时间：2009-02-20T17:03:48.787
> 
> 标签：python, connection, twisted, reactor

这是一个更大计划的一部分；我将仅解释相关部分。基本上，我的代码想要创建到远程主机的新连接。这应该返回一个 Deferred，一旦建立连接就会触发，所以我可以在上面发送一些东西。

我正在与`twisted.internet.interfaces.IReactorSSL.connectSSL`. 这会调用`buildProtocol`我的`ClientFactory`实例来获取一个新的连接 ( `twisted.internet.protocol.Protocol`) 对象，并返回一个`twisted.internet.interfaces.IConnector`. 当连接开始时，Twisted 调用`startedConnecting`工厂，给它一个`IConnector`. 当实际建立连接时，将调用协议的`connectionMade`回调，不带任何参数。

现在，如果每个主机/端口只需要一个连接，其余的就很容易了。在调用 之前`connectSSL`，我会创建一个 Deferred 并将其放入以（主机、端口）为键的字典中。然后，在协议的 connectionMade 中，我可以使用`self.transport.getPeer()`它来检索主机/端口，用它来查找 Deferred，并触发它的回调。但是，如果我想创建多个连接，这显然会失败。

问题是我看不到任何其他方法可以将我在调用之前创建的 Deferred`connectSSL`与`connectionMade`稍后创建的关联。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T17:39:22.943

再看看这个，我想我已经想出了一个解决方案，尽管希望有更好的方法；这似乎有点奇怪。

Twisted 有一个类，`ClientCreator`用于生成简单的一次性连接。理论上它可以满足我的需求；连接并返回一个`Deferred`在建立连接时触发的。不过，我认为我不能使用它，因为我将失去将参数传递给协议构造函数的能力，因此无法在连接之间共享状态。

但是，我刚刚意识到`ClientFactory`构造函数确实接受`*args`传递给协议构造函数。或者至少看起来像；几乎没有这方面的文档。在这种情况下，我可以给它一个我的工厂的引用（或者其他任何东西，如果工厂不再需要的话）。并且我得到了`Deferred`建立连接时触发的那个。

# java - 在Windows下的java中，如何找到重定向的Desktop文件夹？

> ID：570401
> 
> 赞同：11
> 
> 时间：2009-02-20T17:04:20.797
> 
> 标签：java, windows, redirect, find, desktop

我知道使用 .NET 语言，例如 C#，可以做类似的事情

```
Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory) 
```

找到桌面的重定向位置。但是，在 Java 下，我想不出一个好的方法来做到这一点。在不使用 JNI 的情况下，从 Java 中查找重定向的用户桌面目录的最合适方法是什么？此处的特定目的是为了管理 Java Web Start 应用程序的桌面快捷方式（如果用户需要）。

此应用程序需要写入“应用程序数据”树以及可选地写入桌面。我假设`%APPDATA%`始终正确填充，即使文件夹被重定向，以查找“应用程序数据”树。所以我的悬而未决的问题是如何可靠地找到桌面文件夹。

注意：我相信 Java 系统属性`${user.home}`实际上（[并且错误地](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4787931)）通过注册表项定位用户的桌面目录，然后尝试向上导航一个目录以找到“主”目录。当没有目录被重定向时，这可以正常工作，否则可能会或可能不会返回有用的东西。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-20T17:32:56.687

```
FileSystemView filesys = FileSystemView.getFileSystemView();

filesys.getHomeDirectory() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-12-19T15:51:09.587

```
String desktopPath = System.getProperty("user.home") + File.separator + "Desktop"; 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-04-18T02:02:05.140

```
public class Sample {
   public static void main(String[] args) {    
      String desktopPath =System.getProperty("user.home") + "\\"+"Desktop";
      String s = "\"" + desktopPath.replace("\\","\\\\") + "\\\\" +"satis" + "\"";

      System.out.print(s);
      File f = new File(s);

      boolean mkdir = f.mkdir();
      System.out.println(mkdir);
   }
} 
```

# java - 如何允许两个使用不同 jre 的小程序工作

> ID：570409
> 
> 赞同：2
> 
> 时间：2009-02-20T17:05:24.773
> 
> 标签：java, applet

有两个小程序。

*   小程序 A 需要 1.6+
*   Applet B 在 1.6 中不工作（1.4 工作）

我如何让他们都工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:47:24.540

如果我可以控制小程序 B，我可以指定它使用 1.4 JRE。

[http://java.sun.com/javase/6/webnotes/family-clsid.html](http://java.sun.com/javase/6/webnotes/family-clsid.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T17:20:16.797

从 6u10 开始，有一个进程外插件。这允许多个 JRE 进程运行，因此版本选择可以选择多个 JRE 版本。

更好：让 Applet B 在 1.6 上运行。

# iphone - 检索 CGImageRef 对象的保留计数？

> ID：570412
> 
> 赞同：0
> 
> 时间：2009-02-20T17:05:49.623
> 
> 标签：iphone, objective-c, memory-management

虽然您可以使用“CGImageRelease”释放对 CGImageRef 对象的引用，根据 SDK，这会“减少位图图像的保留计数”，但有没有办法检查 CGImageRef 实例的当前保留计数？[cgImageRef retainCount] 无效，因为 CGImageRef 不是 retainCount 消息的有效接收者。

换句话说，在呈现 EAGLContext 的类中的 dealloc 期间，我想确保释放对 CGImageRef 对象的任何未完成的引用，但如果它的保留计数已经是 0，我显然不想调用 CGImageRelease(someCGImageRef)。我我们在实践中发现，仅检查图像 ref 是否为 nil 与当前的保留计数值不一致。

在你完成它并且你已经释放它之后简单地将 CGImageRef 实例设置为 nil 是一个最佳实践，以便检查 (someCGImageRef == nil) 让你知道是否有一个优秀的引用它？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:07:02.970

如果我正确阅读了文档，那么 CGImageRelease 就像 CFRelease 一样，只是它处理 NULL 的方式不同。这意味着只要 cgImageRef 不为 NULL，CFGetRetainCount 就应该工作。

好的，所以我在那之后阅读了你剩下的问题。您不应该对可能已经具有 0 的 retainCount 的对象调用 CFGetRetainCount，因为到那时该对象已经被销毁。相反，将其设置为 NULL。

（NULL 和 nil 是等价的，但 nil 用于 Objective-C 对象。CGImageRef 不是其中之一，因此您可能应该使用 NULL 以避免以后混淆。）

# excel - Excel 中的自动连接

> ID：570422
> 
> 赞同：1
> 
> 时间：2009-02-20T17:07:36.390
> 
> 标签：excel, concatenation

我有一个巨大的（约 950 个变量）调查响应电子表格，比它需要的大 2-4 倍，因为每个项目的单独响应选项都在单独的列中报告。例如，如果问题 2 在单元格 A1 中并且有 3 个响应选项，则这些选项将在单元格 A2-C2、A3-C3 等中的问题下方列出。注意：只有 A2-C2 等中的一个被填充了数据每次观察。

很明显，我*可以*手动浏览电子表格并使用类似于以下的代码连接 A2-C2：

```
=CONCATENATE(IF(ISBLANK(A4),"",A4),IF(ISBLANK(B4),"",B4),IF(ISBLANK(C4),"",C4)) 
```

但是，以上需要手动更改代码（问题有 2-6 个响应选项）并通过对 960 个变量中的每一个变量的所有观察单独复制/粘贴它。因为我想在年老之前完成这项工作，所以我很想有一些方法可以使上述过程自动化。

在每个变量的最后一个响应选项之后插入一个标识符列（没有数据，但有一些明显的第一行名称）很容易，这样代码就知道从哪里开始查找要连接的数据。代码必须知道在遇到先前连接的结果时停止，并开始与后续列的当前连接。一旦它到达某一行（比如说，60？我只有大约 55 个观察值），它就可以查找下一个标识符列并重复该过程。

任何想法将*不胜*感激。

我需要检查空格，以免数据中有多余的空格（以帮助将来分析）。

希望下文能进一步阐明情况。您之前的评论是正确的；每个问题后面都有 55 行观察结果。例如：

```
 | |   Q1   |         |        ||   Q2    |        || 
 |-|--------|---------|--------||---------|--------||
 |1|   1    |         |        ||         |    2   ||
 |2|        |    2    |        ||         |    2   ||
 |3|        |         |    3   ||         |    2   ||
 |4|        |    2    |        ||    1    |        ||
 |5|        |         |    3   ||         |        ||
 |6|   1    |         |        ||         |    2   ||
 |7|   1    |         |        ||    1    |        ||
 |8|        |         |    3   ||    1    |        ||
 |9|        |    2    |        ||         |    2   || 
```

在每个问题的最后一个响应选项之后当前没有空白列，但是（如最初的帖子中所述）我可以轻松地将其放入其中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T17:17:31.857

我不是 100% 确定我理解您的布局，但您可以通过使用 & 大大简化串联，如下所示：

```
=A4&B4&C4 
```

这将与您的代码具有相同的效果，并且不需要检查空白单元格。

当信息可用时，我将解决剩下的问题。

**编辑：**这是我的解决方案。我假设问题在第 1 行，第一组观察结果在第 2 行，所以最后一组观察结果在第 56 行。

1.  在单元格 A58 中键入数字 1
2.  将公式： =IF(ISBLANK(B1),A58,A58+1) 放入单元格 B58
3.  在你所有的问题中一直填写这个公式
4.  在单元格 A59 中，输入公式 =MATCH(COLUMN(),58:58,0)
5.  在单元格 A60 中，输入公式 =MATCH(COLUMN(),58:58,1)
6.  在单元格 A61 中，输入公式 =INDEX(1:1,,A59)
7.  为 17 个单元格填写所有这三个公式（假设您有 17 个问题）
8.  在单元格 A62 中，输入公式 =SUM(INDIRECT(ADDRESS(ROW(A2),A$59)&":"&ADDRESS(ROW(A2),A$60)))
9.  将此公式填充到 17 个单元格中，然后向下填充 55 个单元格。

以下是它会如何寻找三个问题：

```
 |  A  |  B  |  C  |  D  |  E  |  F  |  G  |
  |----|------------------------------------------
  |  1 | Qn1               Qn2         Qn3        
  |  2 |  1                       2     1         
  |  3 |        2                 2           2   
  | .. |
  | 58 |  1     1     1     2     2     3     3
  | 59 |  1     4     6
  | 60 |  3     5     8
  | 61 | Qn1   Qn2   Qn3
  | 62 |  1     2     1
  | 63 |  2     2     2 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T20:57:59.953

@EJames：感谢您以图形方式布置示例的建议和指针。我需要检查空格，以免数据中有多余的空格（以帮助将来分析）。

希望下文能进一步阐明情况。您之前的评论是正确的；每个问题后面都有 55 行观察结果。例如：

```
 | |   Q1   |         |        ||   Q2    |        || 
 |-|--------|---------|--------||---------|--------||
 |1|   1    |         |        ||         |    2   ||
 |2|        |    2    |        ||         |    2   ||
 |3|        |         |    3   ||         |    2   ||
 |4|        |    2    |        ||    1    |        ||
 |5|        |         |    3   ||         |        ||
 |6|   1    |         |        ||         |    2   ||
 |7|   1    |         |        ||    1    |        ||
 |8|        |         |    3   ||    1    |        ||
 |9|        |    2    |        ||         |    2   || 
```

在每个问题的最后一个响应选项之后当前没有空白列，但是（如最初的帖子中所述）我可以轻松地将其放入其中。

非常感谢。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-28T19:02:45.987

老帖子，但我做了这个函数来连接单元格。工作类似于 SUMIF。

```
Function CONCIF(rng As Range, criteria As Range, sums As Range)
'Function to concatenate a range of cells if the chosen adjacent cells matches
'the criteria.
'To use:
'  Copy and Paste this into a module in VB Editor
'  In a cell type =CONCIF(rng, criteria, sums) where:
'       rng is the range of cells to match the criteria
'       criteria is the value you would to match
'       sums is the range of cells to concatenate if criteria matches
'  To change what is put between the concatenations, edit the " / " below and put
'  whatever you would like in between the quotes.
'  Enjoy! -RP

Dim rCell As Range
Dim concat As String
Dim dist As Integer

dist = sums.Column - rng.Column
concat = ""

For Each rCell In rng
    If rCell = criteria Then
        If concat = "" Then
            concat = rCell.Offset(0, dist).Value
        Else
            concat = concat & " / " & rCell.Offset(0, dist).Value
        End If
    End If
Next rCell

CONCIF = concat
End Function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T21:09:06.590

最快的方法：

1.  在 D 列之后添加一个新列
2.  将“Q1”放入单元格 B1
3.  将以下公式代入： =SUM(B2:D2)
4.  将公式复制到最后一行
5.  对所有问题重复上述步骤
6.  选择所有数据 (ctrl-*)
7.  复制选择
8.  从上下文菜单中选择“选择性粘贴”，然后选择“值”
9.  删除原始列

如果您愿意，您可以创建一个自动执行此操作的宏。

这是宏。这不是我有史以来最好的编码。你会在 15 分钟内期待什么。它完成了这项工作，尽管完成后它会崩溃。;o)

1.  打开你的 Excel 工作表
2.  制作备份副本
3.  按 Alt-F11
4.  插入新模块
5.  粘贴下面的代码
6.  将光标放在宏内
7.  按 F8 单步执行代码

由于您在 Stack Overflow，我假设您将能够调整宏以进一步定制您的需求。

```
Sub Main()

    Dim ColumnsCount As Integer
    ColumnsCount = Range("A1").CurrentRegion.Columns.Count

    For i = 2 To 20000

        Dim CurrentCell As Range
        Set CurrentCell = Range("A1").Offset(0, i - 1)

        If CurrentCell.Value <> "" Then

            CurrentCell.Select
            Selection.End(xlToRight).Select

            Dim AnswersCount As Integer
            AnswersCount = Selection.Column - CurrentCell.Column

            CurrentCell.Offset(0, AnswersCount).Select
            Selection.EntireColumn.Insert

            Selection.Value = CurrentCell.Value
            i = i + AnswersCount

            Selection.Offset(1, 0).Select
            Selection.FormulaR1C1 = "=SUM(RC[" + CStr(AnswersCount * -1) + "]:RC[-1])"

            Selection.Copy
            Range(Selection, Selection.Offset(100, 0)).Select
            ActiveSheet.Paste

            Selection.EntireColumn.Select
            Application.CutCopyMode = False
            Selection.Copy
            Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False

        End If

    Next i

End Sub 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T05:46:08.900

感谢您提供的信息。除了您的方式之外，您还可以使用 & 字符进行连接，因此您可以使用 =concatenate(B1," ",C1," ",D1) 代替： =B1 & ” ” & C1 & ” ” & D1

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-10T16:35:56.653

或者，如果您只想要一种简单的方法来选择水平范围并连接非空白单元格：

```
Function CONCIF(rng As Range)

Dim rCell As Range
Dim concat As String
Dim dist As Integer

dist = 0
concat = ""

For Each rCell In rng
    If rCell.Value <> "" Then
        If concat = "" Then
            concat = rCell.Value
        Else
        concat = concat & ", " & rCell.Value
        End If
    End If
Next rCell

CONCIF = concat
End Function 
```

# documentation - 如何将换行符转换为 标签（所见即所得）

> ID：570426
> 
> 赞同：0
> 
> 时间：2009-02-20T17:08:08.400
> 
> 标签：documentation, javadoc

如何确保隐式换行符反映在输出 Javadoc 中，即换行符转换为`<br/>`标记？我觉得必须记住`<br/>`在我的评论的每一行添加标签很烦人。当然，如果没有`<br/>`标签，整个注释就会被压缩成一个不可读的块。

`<br/>`也许一个 doclet 只会用标签替换换行符？我google了很多，但没有想出任何东西。在开始编写自己的 doclet 之前，我想确保没有遗漏任何内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T01:18:16.443

更好的是在您想要分节的地方插入一个`<p>`标签。在您想要换行的任何地方都放置换行符非常难看 - 当有人使用比您中断的窗口更宽或更窄的窗口时，这会很糟糕。

注意：如果您有想要包含在 JavaDoc 中的预格式化文本，那么您可以`<pre>`在此内容周围使用标签，您的文本不会被重新格式化为一个巨大的 blob。事实上，如果您想明确决定每个换行符的位置，您可以`<pre>`在整个 JavaDoc 周围使用该标记，尽管这是对该标记意图的滥用。

# iphone - 在 iPhone 上将声音录制为 WAV

> ID：570430
> 
> 赞同：14
> 
> 时间：2009-02-20T17:09:42.250
> 
> 标签：iphone, audio, core-audio

我正在制作一个 iPhone 录音应用程序，需要将声音文件作为 .wav 提交到外部服务器。

从 SpeakHere 示例开始，我可以将声音录制为文件，但只能录制为 .caf

有谁知道如何将其录制为 wav？或者如何在 iPhone 上将 .caf 转换为 .wav？（转换必须在手机上进行）

编辑：

我想知道在 AudioFileCreateWithURL 中使用 kAudioFileWAVEType 而不是 kAudioFileCAFType 是否可以做任何事情

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-23T21:50:33.593

是的，关键是 kAudioFileWAVEType

```
AudioFileCreateWithURL (
            audioFileURL,
            kAudioFileWAVEType,
            &audioFormat,
            kAudioFileFlags_EraseFile,
            &audioFileID
        ); 
```

在 SpeakHere 示例中从 CAF 更改为 WAVE 会导致录音变为 wav。我还在播放类中编辑了相同的内容，并将文件名更改为 Recording.wav

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:24:46.567

看看[libsndfile](http://www.mega-nerd.com/libsndfile/)。它是一个很好用（包括 Audacity）的 C 库，用于处理许多文件格式。它支持多种CAF和WAV格式的读写。

[CAF 文件结构](http://developer.apple.com/DOCUMENTATION/MusicAudio/Reference/CAFSpec/CAF_overview/chapter_2_section_1.html)和WAV[格式](http://ccrma.stanford.edu/courses/422/projects/WaveFormat/)非常相似。如果最坏的情况发生在最坏的情况下，转换应该不会太难。

这将涉及获取音频数据块，并按原样复制到 WAV 文件中，并使用音频描述块中的信息为 WAV 文件添加等效的*fmt*子块。这是相当简单的字节复制。

但是，请注意（正如 Eric 指出的那样）存在许可问题，请参阅：[能否在 iPhone iOS 上使用 Libsndfile 库？](https://stackoverflow.com/questions/4939268/can-the-libsndfile-library-be-used-on-the-iphone-ios)

# php - 我将如何在 codeigniter 中生成/解析这个 RESTful url

> ID：570431
> 
> 赞同：1
> 
> 时间：2009-02-20T17:09:47.303
> 
> 标签：php, codeigniter, rest, codeigniter-routing

我是 MVC 的新手，是 RESTful 和 CodeIgniter。我想在业余时间深入了解它们，所以这在很大程度上是一个学术问题。我正在尝试构建一个 URL，该 URL 将显示特定酒店的特定酒店房间的可用性。我认为执行此操作的 RESTful 方式如下：

```
http://url/Hotel/2/RoomAvailability/3/ 
```

*   “酒店”是控制器
*   “2”是酒店ID
*   “RoomAvailability”是方法
*   “3”是房间号

我将如何在 codeigniter 中设置我的控制器来处理这个问题？目前，我认为我可以执行以下任一操作：

*   使用 mod_rewrite 执行某些操作以重定向到 RoomAvailability() 方法
*   使用 index() 方法做一些事情并重定向到 RoomAvailability() 方法

真的这是一个非常笼统的问题，因为我只想能够做到以下几点：

`http://url/model/method-argument/method-name/more-method-arguments`

老实说，我很难想出搜索词来找出要使用的内容（除了 RESTful 和 CodeIgniter，它们并没有太大帮助0。

我真的只是在寻找指导；不是为了有人为我写我的控制器。另外，如果我要访问的这个 URL 很糟糕，而且根本不是 RESTful 的；请随时指出更好的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T17:29:09.677

这个网址设置怎么样：

```
http://url/hotel/method/hotel_id/room_id 
```

然后你可以做这样的事情：

```
class Hotel extends Controller {

 function RoomAvailability() {
   $hotel = url_segment(3);
   $room = url_segment(4);
   do_magic();
 }

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:19:05.130

查看 CI 用户指南，特别是关于路由的部分。

[https://www.codeigniter.com/user_guide/general/routing.html](https://www.codeigniter.com/user_guide/general/routing.html)

# python - 如何从 FTP 服务器获取最新文件？

> ID：570433
> 
> 赞同：3
> 
> 时间：2009-02-20T17:10:20.453
> 
> 标签：python, ftp

我正在使用 Python 连接到一个 FTP 服务器，该服务器每小时包含一个新的数据列表。我每天只连接一次，我只想下载目录中的最新文件。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T22:02:56.257

似乎任何每小时自动生成一次文件的系统都可能使用自动命名方案。您是否通过向服务器询问最新文件而不是更轻松地解析文件名来考虑问题？

这并非在所有情况下都有效，如果目录变大，获取文件列表可能会变得很耗时。但它似乎在大多数情况下都有效。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-20T21:49:10.550

查看当前版本的 python 中的 ftplib。您可以看到一个函数来处理您将发出执行目录的 LIST 命令的结果，如果您知道最后一次运行成功的脚本，那么您可以解析来自 LIST 的结果并对新文件采取行动目录。有关如何执行此操作的更多信息，请参阅[ftplib 。](https://docs.python.org/3/library/ftplib.html)retrlines 函数是我期望使用的。

# asp.net - ReportViewer“导出到 Excel”将小数添加到百分比值。我怎样才能覆盖这个？

> ID：570434
> 
> 赞同：0
> 
> 时间：2009-02-20T17:10:31.937
> 
> 标签：asp.net, excel, reportviewer

我在我的 aspx 页面上有一个 ReportViewer 控件，它呈现一个很好的报告，其中一列是百分比。我已将单元格的格式设置为 p0，它工作正常。将报告导出到 excel 的用户会注意到值后出现小数点。

IE。过去的“20%”现在是“20.%”。我怎样才能摆脱“。”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T17:26:47.047

如果这是使用 CR 制作的，我发现如果要始终将报告导出到 Excel，最好删除 CR 具有/执行的所有格式。否则你会遇到奇怪的异常，就像你正在经历的那样，并且会为你节省很多痛苦。

我为我的一些用户所做的是创建一份没有格式的报告，专门用于导出，以及一份包含 CR 的所有花里胡哨的报告。

# jms - WLI JMSControl 中的顺序单元

> ID：570438
> 
> 赞同：0
> 
> 时间：2009-02-20T17:12:03.430
> 
> 标签：jms, weblogic, weblogic-integration

我们的一位客户打算使用[Unit-Of-Order Weblogic Server Feature (UOO)](http://download.oracle.com/docs/cd/E12840_01/wls/docs103/jms/uoo.html)。

在纯 Java 代码中使用 UOO 发送带有自定义 UOO 名称的 JMS 消息，以及将 Aqualogic 服务总线中的 UOO 名称从代理服务传播到业务服务（两者都使用 JMS 作为传输协议），一切正常。

但是，在 Weblogic 集成中使用 UOO 以及 WLI JMSControl 无法正常工作。

考虑这段代码：

```
@com.bea.control.JMSControl.Properties(value = {
        @com.bea.control.JMSControl.PropertyValue(name = "JMS_BEA_UnitOfOrder", value = "MyUOONameFromWLI"),
        @com.bea.control.JMSControl.PropertyValue(name = "MyCustomProperty", value = "MyCustomValue") })
public void sendTextMessage(String payload); 
```

它将属性发送`MyCustomProperty`给 JMS 使用者，但`JMS_BEA_UnitOfOrder`与 UOO 名称相关的属性被忽略。而是使用默认的用户生成的 UOO 名称。

**那么，如何使用 Weblogic JMSControl 自定义我的 UOO 名称？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-10T15:56:23.137

我发现它没有任何支持！

# java - 使用 Java 通过 ssh 运行命令

> ID：570450
> 
> 赞同：10
> 
> 时间：2009-02-20T17:14:55.343
> 
> 标签：java, ssh, openssh

Scenerio：我想通过 ssh 从 Java 程序在远程机器上运行命令（我在我的开发机器上使用 OpenSSH）。我还想通过传递密码而不是像“期望”那样设置密钥来建立 ssh 连接。
问题：当尝试执行密码登录等“期望”时，使用 ProcessBuilder 创建的进程似乎看不到密码提示。当运行常规的非 ssh 命令（例如“ls”）时，我可以获取流并与它们进行很好的交互。我将标准错误和标准输出组合成一个流`redirectErrorStream(true);`所以我没有在标准错误中错过它...当我使用“-v”选项运行 ssh 时，我看到了流中的所有日志记录，但没有看到提示。这是我第一次尝试将 ProcessBuilder 用于这样的事情。我知道使用 Python、Perl 或良好的期望会更容易，但我的老板想利用我们试图在现有 Java 程序中取回的内容（远程日志文件和运行脚本），所以我有点卡住了。

在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T17:17:29.267

提示可能仅在`ssh`连接到 TTY 时才会显示，而在 Java 中则不会。

可能有一种方法可以在应用程序的命令行中提供密码`ssh`。这将是通过提示的方法。

或者，考虑从本机 Java 代码直接连接到主机服务器，而不是运行外部应用程序。有[一百万个图书馆](http://www.google.com/search?q=java+ssh+library)可以做到这一点。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-20T17:22:22.250

与其使用外部 ssh 程序，不如使用 Java ssh 库：

*   [三铅](http://www.trilead.com/Products/Trilead_SSH_for_Java/)
*   [JTA](http://javassh.org/space/start)

是我在谷歌上找到的两个 - 这将避免 openssh 将非常努力地阻止在标准输入上输入密码的问题 - 它将直接打开终端。expect 必须非常努力地模拟一个 tty 才能工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T17:25:01.557

为什么不使用 Java ssh 客户端？[这个是 BSD 许可的，](http://www.jcraft.com/jsch/)[这里](http://linuxmafia.com/ssh/java.html)列出了更多的客户端。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T17:18:19.203

大多数具有安全意识的程序不使用标准输入/标准输出来捕获密码，它们捕获 TTY 或一些等效方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-06T18:26:06.670

回应其他人使用 Java SSH 库的建议。但想评论科恩的回应。在建立连接时通过命令行发送密码是不安全的，并且许多 sshd 服务器也不允许（基于配置）。

您可能需要考虑为此设置密钥，以便无需密码即可在机器之间执行 ssh 命令。

**基本步骤** - 使用 openssh 创建一个密钥对（我已经完成了 RSA，但我知道现在有更好的方法） - 在 SOURCE 机器上的主文件夹中创建一个 .ssh 目录 - 在你的主文件夹中创建一个 .ssh 目录目标机器 - 将您的私钥保存在源机器的 .ssh 文件夹中 - 将您的公钥复制到目标机器的 .ssh 文件夹中名为 authorized_keys 的文件中

一些说明可以在[这里找到](http://www.linuxproblem.org/art_9.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-09T09:52:46.707

[您可以使用edtFTPj/PRO](http://www.enterprisedt.com/products/edtftpjssl/overview.html)运行命令，也可以通过 SFTP 执行文件传输。是Java。

# unit-testing - 如何最好地为 Web 应用程序进行单元测试

> ID：570451
> 
> 赞同：10
> 
> 时间：2009-02-20T17:15:14.577
> 
> 标签：unit-testing

我正在编写一个在 UI 方面非常复杂并且严重依赖 AJAX、DOM 和图像操作的 Web 应用程序。

有没有可以遵循的标准做法（我不想要工具）来减少错误？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T17:17:09.847

一个非常简单的技术是冒烟测试，您可以在其中自动点击所有应用程序。如果脚本运行并且日志中的任何地方都没有错误，那么您至少具有一个定义的质量级别。

这种技术实际上捕获了大量的回归中断，并且比听起来更有效。我们为此使用[硒。](http://seleniumhq.org/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-20T17:35:21.580

将逻辑和 UI 部分分开 - 不要将所有业务逻辑和复杂代码都放在代码隐藏页面中。而是在标准层结构（数据层、业务规则/逻辑层、UI 层）上构建它们。这将确保您要测试的逻辑代码不引用表单，而是使用易于单元测试的类。

对于一个非常基本的示例，没有执行此操作的代码：

```
string str = TextBox1.Text.ToString();
//do whatever your code does
TextBox2.Text = str; 
```

而是使用方法将逻辑提取到单独的类中：

```
TextBox2.Text = DoWork(TextBox1.Text.ToString());

public class Work
{
    public string DoWork(string str)
    {
      //do work
      return str2;
    }
} 
```

这样您就可以编写单元测试来验证 DoWork 是否返回了正确的值：

```
string return = DoWork("TestThisString"); 
```

Now all of your logic is unit testable, with only code that HAS to reference the page directly still in your UI layer.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T17:17:55.023

[Watin](http://watin.sourceforge.net/)是一个很好的工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T17:20:05.190

一个简单的清单（甚至在一张纸上！）是确保您永远不会跳过重要事情的最佳方法。这是一个很好的“冒烟测试”，没有任何“标准”被打破。

# .net - .NET 中的“CLSCompliant”属性是什么？

> ID：570452
> 
> 赞同：186
> 
> 时间：2009-02-20T17:15:39.270
> 
> 标签：.net, cls-compliant

[`CLSCompliant`](https://docs.microsoft.com/dotnet/api/system.clscompliantattribute)属性是什么？

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2009-02-20T17:18:34.600

`CLSCompliant`当您想确保它可以被任何其他 .NET 语言使用时，您可以使用该属性标记类。
这些是基本规则：

1.  无符号类型不应该是类的公共接口的一部分。这意味着公共字段不应该有像`uint`or这样的无符号类型`ulong`，公共方法不应该返回无符号类型，传递给公共函数的参数不应该有无符号类型。但是，无符号类型可以是私有成员的一部分。

2.  **像指针**这样的不安全类型不应该与`public`成员一起使用。但是它们可以与`private`成员一起使用。

3.  类名和成员名不应仅因大小写而异。例如，我们不能有两个名为`MyMethod`和的方法`MYMETHOD`。

4.  只有属性和方法可以重载，运算符不应该重载。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-02-20T17:20:23.690

它告诉您的代码的其他使用者它是[符合 CLS](http://msdn.microsoft.com/en-us/library/12a7a7h3.aspx)的，并且还会让 C# 编译器*检查*它是否符合您的 CLS。

引用的文章包含有关 CLS 合规性的更多详细信息。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-02-20T18:18:51.850

其他答案都是正确的。让我澄清一些事情——CLS 代表公共语言规范。它是 .NET 语言必须实现和理解的最小规则集和所需的语言特性。该集合是[通用类型系统](http://msdn.microsoft.com/en-us/library/zcx1eb1e.aspx)的一个子集，它定义了在 .NET 中如何定义类型。

符合 CLS 意味着您可以编写任何可以在 CLR 上编译和运行的语言使用的代码。但 CLS 合规性不是必需的，在 CLS 合规性难以或不可能实现的情况下，您可以灵活应对。

如果您打算让其他开发人员使用您的代码，那么您的 API（您的公共类和方法）应该符合 CLS。您应该通过将 CLSCompliantAttribute 添加到您的程序集来声明这一点。如果您不是为他人写作，则无需遵守 CLS，尽管[FxCop](http://en.wikipedia.org/wiki/FxCop)（*Framework* Cop）不同意我的观点。

当您的程序集标有 CLSCompliantAttribute 时，编译器将（应该！）检查您的代码，以查看在编译时它是否违反任何 CLS 规则（其中一些*ocdecio*提到）并向您报告违规情况以进行修复。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-20T17:20:05.267

符合 CLS 是 CLR 允许的完整语言范围的子集。它将其限制为大多数以 CLR 为目标的语言可能可用的子集。这会增加，但不能保证所有面向 CLR 的语言都可以使用您的库。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-09-21T16:09:22.147

因为它适合这里：要标记整个项目符合 CLS，请将此行添加到`AssemblyInfo.cs`（可以在解决方案资源管理器的属性下找到）

```
[assembly:CLSCompliant(true)] 
```

或等效地在 VB.NET 中（`AssemblyInfo.vb`隐藏在我的项目下）

```
<Assembly: CLSCompliant(True)> 
```

感谢[使您的代码符合 CLS 标准](http://www.devarticles.com/c/a/C-Sharp/Making-Your-Code-CLS-Compliant)。

# c# - WCF 直通

> ID：570454
> 
> 赞同：1
> 
> 时间：2009-02-20T17:16:10.457
> 
> 标签：c#, wcf, serialization

我有一个由 WCF 节点组成的 N 层结构。我偶尔需要将大量数据从终端节点传递到顶部节点，并且我想避免在中间跃点期间反序列化非常大的数据字段。由于我们的跌倒策略，我无法直接到达顶部。有什么办法可以避免反序列化我的领域？谢谢你的帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T17:23:22.030

也许你可以用 [OnDeserializing] 事件做点什么？

看到[这个](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.ondeserializingattribute.aspx)。

此外，Juval Lowy 在第 3 章第 107-110 页的“ [Programming WCF Services ”（第 2 版）中介绍了序列化事件。](http://oreilly.com/catalog/9780596521301/index.html)

我不确定你是否可以完全短路反序列化......我从未尝试过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T17:44:12.587

我认为特里在正确的轨道上。我会查看该事件，并通过使用消息合同，您应该能够标记您只想传递的消息部分。您可能需要进行一些消息操作（拆分传入消息，创建“自定义”传出消息），但您应该能够让消息继续而不被查看。

也搜索 WS-Addressing；它可能会为此提供一种模式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T22:25:01.103

我想知道您的故障转移策略是否适合“捕捉链接”之类的事情。您将对中间节点进行初始调用，最终将其转发到终端节点。终端节点将响应初始节点直接连接到它所需的信息。

这样，负载平衡或故障转移可以确定应该使用哪个终端节点，但是在做出该确定之后，可以进行直接连接。当然，您会希望限制该直接连接的持续时间，以允许故障转移策略随着时间的推移而改变主意。

# windows - 带有 Windows XP SP3 的远程 WMI

> ID：570464
> 
> 赞同：4
> 
> 时间：2009-02-20T17:17:49.500
> 
> 标签：windows, wmi, dcom

全新的 Windows XP SP3 安装不允许像 Windows XP SP2 那样进行远程 WMI 访问。

[如果我按照http://support.microsoft.com/kb/875605](http://support.microsoft.com/kb/875605)上的“如何解决 Windows XP SP2 中与 WMI 相关的问题”文档中的步骤操作，我将无法让 SP3 响应远程 WMI 请求。

每个请求，甚至是对内置管理员帐户、管理员组中的新帐户，甚至是不在管理员组中但被授予访问远程 DCOM 和 WMI 命名空间的新帐户（如 Microsoft 文档中所述）都返回错误代码0x80070005，访问被拒绝。

为了验证我没有愚蠢的系统配置，我安装了一个新的 Windows XP SP3 映像（使用来自 MSDN 的 .ISO 映像）并且除了通过防火墙启用 RemoteAdmin 之外没有执行任何配置更改。在这种情况下也看到了访问被拒绝行为。

Windows XP SP3 对远程 DCOM/WMI 访问有何变化以及如何最好地启用它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T19:16:13.730

事实证明，该问题并非特定于 SP3，而是域中缺少这些系统。

如果 XP 不在域中，那么“文件夹选项”控制面板小程序中的“使用简单文件共享”选项就可以发挥作用。如果启用此选项（默认），所有文件共享连接都使用来宾用户凭据完成，但这也适用于传入的 DCOM 连接。

禁用此选项允许按预期验证 DCOM 连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:08:12.323

假设 SP3 没有选中“在这台计算机上启用分布式 COM”。进入组件服务 (dcomcnfg.exe) 组件服务，计算机。右键单击“我的电脑”并转到属性。“默认属性”是您想要的选项卡。我还听说将 DTC 登录帐户更改为 NT AUTHORITY\NetwerkService（注意 e 而不是 o）会起作用。您可以在 MSDTC 选项卡下找到此内容，安全配置遵循与我的电脑相同的路径。

我们通过使用这些技巧解决了一些非常相似的问题。希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T18:57:18.077

我不确定 RemoteAdmin 是否需要在防火墙中关闭。

一个建议是先完全关闭防火墙并尝试。如果它有效，那么你知道它是防火墙。如果是这种情况，那么我会尝试直接添加端口 tcp 135 并重试。

您也可以尝试使用 telnet [XP_SP3 机器的ip 地址] 135 看看是否可以建立连接。

希望这可以帮助。

# java - Java LDAP - 确定用户是否在给定组中？

> ID：570466
> 
> 赞同：29
> 
> 时间：2009-02-20T17:18:06.973
> 
> 标签：java, active-directory

我们使用 Java LDAP API 通过 LDAP 将用户登录到 Active Directory。我们希望增强我们的登录功能，以进一步检查用户是否在给定的 AD 组中。有谁知道如何做到这一点？

当前代码：

```
import javax.naming.*;
import javax.naming.ldap.*;

LdapContext ctx = null;
Hashtable env = new Hashtable();
env.put(Context.INITIAL_CONTEXT_FACTORY,"com.sun.jndi.ldap.LdapCtxFactory");
env.put(Context.SECURITY_AUTHENTICATION,"simple");
env.put(Context.PROVIDER_URL, Config.get("ldap-url"));

try {
    Control[] connCtls = new Control[] {new FastBindConnectionControl()};
    ctx = new InitialLdapContext(env, connCtls);
    ctx.addToEnvironment(Context.SECURITY_PRINCIPAL, "DOMAIN\\" + username);
    ctx.addToEnvironment(Context.SECURITY_CREDENTIALS, password);
    ctx.reconnect(connCtls);
    /* TODO: Only return true if user is in group "ABC" */
    return true; //User authenticated
} catch (Exception e) {
    return false; //User could NOT be authenticated
} finally {
    ...
} 
```

* * *

**更新**：请参阅下面的解决方案。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-10-13T17:09:01.263

我们通过下面的课程解决了这个问题。只需调用验证方法：

```
import java.text.MessageFormat;
import java.util.*;    
import javax.naming.*;    
import org.apache.log4j.Level;

public class LdapGroupAuthenticator {
    public static final String DISTINGUISHED_NAME = "distinguishedName";
    public static final String CN = "cn";
    public static final String MEMBER = "member";
    public static final String MEMBER_OF = "memberOf";
    public static final String SEARCH_BY_SAM_ACCOUNT_NAME = "(SAMAccountName={0})";
    public static final String SEARCH_GROUP_BY_GROUP_CN = "(&(objectCategory=group)(cn={0}))";

    /*
     * Prepares and returns CN that can be used for AD query
     * e.g. Converts "CN=**Dev - Test Group" to "**Dev - Test Group"
     * Converts CN=**Dev - Test Group,OU=Distribution Lists,DC=DOMAIN,DC=com to "**Dev - Test Group"
     */
    public static String getCN(String cnName) {
        if (cnName != null && cnName.toUpperCase().startsWith("CN=")) {
            cnName = cnName.substring(3);
        }
        int position = cnName.indexOf(',');
        if (position == -1) {
            return cnName;
        } else {
            return cnName.substring(0, position);
        }
    }
    public static boolean isSame(String target, String candidate) {
        if (target != null && target.equalsIgnoreCase(candidate)) {
            return true;
        }
        return false;
    }

    public static boolean authenticate(String domain, String username, String password) {
        Hashtable env = new Hashtable();
        env.put(Context.INITIAL_CONTEXT_FACTORY,"com.sun.jndi.ldap.LdapCtxFactory");
        env.put(Context.PROVIDER_URL, "ldap://1.2.3.4:389");
        env.put(Context.SECURITY_AUTHENTICATION, "simple");
        env.put(Context.SECURITY_PRINCIPAL, domain + "\\" + username);
        env.put(Context.SECURITY_CREDENTIALS, password);
        DirContext ctx = null;
        String defaultSearchBase = "DC=DOMAIN,DC=com";
        String groupDistinguishedName = "DN=CN=DLS-APP-MyAdmin-C,OU=DLS File Permissions,DC=DOMAIN,DC=com";

        try {
            ctx = new InitialDirContext(env);

            // userName is SAMAccountName
            SearchResult sr = executeSearchSingleResult(ctx, SearchControls.SUBTREE_SCOPE, defaultSearchBase,
                    MessageFormat.format( SEARCH_BY_SAM_ACCOUNT_NAME, new Object[] {username}),
                    new String[] {DISTINGUISHED_NAME, CN, MEMBER_OF}
                    );

            String groupCN = getCN(groupDistinguishedName);
            HashMap processedUserGroups = new HashMap();
            HashMap unProcessedUserGroups = new HashMap();

            // Look for and process memberOf
            Attribute memberOf = sr.getAttributes().get(MEMBER_OF);
            if (memberOf != null) {
                for ( Enumeration e1 = memberOf.getAll() ; e1.hasMoreElements() ; ) {
                    String unprocessedGroupDN = e1.nextElement().toString();
                    String unprocessedGroupCN = getCN(unprocessedGroupDN);
                    // Quick check for direct membership
                    if (isSame (groupCN, unprocessedGroupCN) && isSame (groupDistinguishedName, unprocessedGroupDN)) {
                        Log.info(username + " is authorized.");
                        return true;
                    } else {
                        unProcessedUserGroups.put(unprocessedGroupDN, unprocessedGroupCN);
                    }
                }
                if (userMemberOf(ctx, defaultSearchBase, processedUserGroups, unProcessedUserGroups, groupCN, groupDistinguishedName)) {
                    Log.info(username + " is authorized.");
                    return true;
                }
            }

            Log.info(username + " is NOT authorized.");
            return false;
        } catch (AuthenticationException e) {
            Log.info(username + " is NOT authenticated");
            return false;
        } catch (NamingException e) {
            throw new SystemException(e);
        } finally {
            if (ctx != null) {
                try {
                    ctx.close();
                } catch (NamingException e) {
                    throw new SystemException(e);
                }
            }
        }
    }

    public static boolean userMemberOf(DirContext ctx, String searchBase, HashMap processedUserGroups, HashMap unProcessedUserGroups, String groupCN, String groupDistinguishedName) throws NamingException {
        HashMap newUnProcessedGroups = new HashMap();
        for (Iterator entry = unProcessedUserGroups.keySet().iterator(); entry.hasNext();) {
            String  unprocessedGroupDistinguishedName = (String) entry.next();
            String unprocessedGroupCN = (String)unProcessedUserGroups.get(unprocessedGroupDistinguishedName);
            if ( processedUserGroups.get(unprocessedGroupDistinguishedName) != null) {
                Log.info("Found  : " + unprocessedGroupDistinguishedName +" in processedGroups. skipping further processing of it..." );
                // We already traversed this.
                continue;
            }
            if (isSame (groupCN, unprocessedGroupCN) && isSame (groupDistinguishedName, unprocessedGroupDistinguishedName)) {
                Log.info("Found Match DistinguishedName : " + unprocessedGroupDistinguishedName +", CN : " + unprocessedGroupCN );
                return true;
            }
        }

        for (Iterator entry = unProcessedUserGroups.keySet().iterator(); entry.hasNext();) {
            String  unprocessedGroupDistinguishedName = (String) entry.next();
            String unprocessedGroupCN = (String)unProcessedUserGroups.get(unprocessedGroupDistinguishedName);

            processedUserGroups.put(unprocessedGroupDistinguishedName, unprocessedGroupCN);

            // Fetch Groups in unprocessedGroupCN and put them in newUnProcessedGroups
            NamingEnumeration ns = executeSearch(ctx, SearchControls.SUBTREE_SCOPE, searchBase,
                    MessageFormat.format( SEARCH_GROUP_BY_GROUP_CN, new Object[] {unprocessedGroupCN}),
                    new String[] {CN, DISTINGUISHED_NAME, MEMBER_OF});

            // Loop through the search results
            while (ns.hasMoreElements()) {
                SearchResult sr = (SearchResult) ns.next();

                // Make sure we're looking at correct distinguishedName, because we're querying by CN
                String userDistinguishedName = sr.getAttributes().get(DISTINGUISHED_NAME).get().toString();
                if (!isSame(unprocessedGroupDistinguishedName, userDistinguishedName)) {
                    Log.info("Processing CN : " + unprocessedGroupCN + ", DN : " + unprocessedGroupDistinguishedName +", Got DN : " + userDistinguishedName +", Ignoring...");
                    continue;
                }

                Log.info("Processing for memberOf CN : " + unprocessedGroupCN + ", DN : " + unprocessedGroupDistinguishedName);
                // Look for and process memberOf
                Attribute memberOf = sr.getAttributes().get(MEMBER_OF);
                if (memberOf != null) {
                    for ( Enumeration e1 = memberOf.getAll() ; e1.hasMoreElements() ; ) {
                        String unprocessedChildGroupDN = e1.nextElement().toString();
                        String unprocessedChildGroupCN = getCN(unprocessedChildGroupDN);
                        Log.info("Adding to List of un-processed groups : " + unprocessedChildGroupDN +", CN : " + unprocessedChildGroupCN);
                        newUnProcessedGroups.put(unprocessedChildGroupDN, unprocessedChildGroupCN);
                    }
                }
            }
        }
        if (newUnProcessedGroups.size() == 0) {
            Log.info("newUnProcessedGroups.size() is 0\. returning false...");
            return false;
        }

        //  process unProcessedUserGroups
        return userMemberOf(ctx, searchBase, processedUserGroups, newUnProcessedGroups, groupCN, groupDistinguishedName);
    }

    private static NamingEnumeration executeSearch(DirContext ctx, int searchScope,  String searchBase, String searchFilter, String[] attributes) throws NamingException {
        // Create the search controls
        SearchControls searchCtls = new SearchControls();

        // Specify the attributes to return
        if (attributes != null) {
            searchCtls.setReturningAttributes(attributes);
        }

        // Specify the search scope
        searchCtls.setSearchScope(searchScope);

        // Search for objects using the filter
        NamingEnumeration result = ctx.search(searchBase, searchFilter,searchCtls);
        return result;
    }

    private static SearchResult executeSearchSingleResult(DirContext ctx, int searchScope,  String searchBase, String searchFilter, String[] attributes) throws NamingException {
        NamingEnumeration result = executeSearch(ctx, searchScope,  searchBase, searchFilter, attributes);

        SearchResult sr = null;
        // Loop through the search results
        while (result.hasMoreElements()) {
            sr = (SearchResult) result.next();
            break;
        }
        return sr;
    }
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-08-05T09:54:44.510

以上代码片段都不适用于我。在 Google 和 tomcat 上花费 1 天后，以下代码可以很好地找到用户组。

```
import java.util.Hashtable;

import javax.naming.CompositeName;
import javax.naming.Context;
import javax.naming.Name;
import javax.naming.NameParser;
import javax.naming.NamingEnumeration;
import javax.naming.NamingException;
import javax.naming.directory.Attribute;
import javax.naming.directory.Attributes;
import javax.naming.directory.InitialDirContext;
import javax.naming.directory.SearchControls;
import javax.naming.directory.SearchResult;

public class MemberOfTest{
    private static final String contextFactory = "com.sun.jndi.ldap.LdapCtxFactory";
    private static final String connectionURL = "ldap://HOST:PORT";
    private static final String connectionName = "CN=Query,CN=Users,DC=XXX,DC=XX";
    private static final String connectionPassword = "XXX";

    // Optioanl
    private static final String authentication = null;
    private static final String protocol = null;

    private static String username = "XXXX";

    private static final String MEMBER_OF = "memberOf";
    private static final String[] attrIdsToSearch = new String[] { MEMBER_OF };
    public static final String SEARCH_BY_SAM_ACCOUNT_NAME = "(sAMAccountName=%s)";
    public static final String SEARCH_GROUP_BY_GROUP_CN = "(&(objectCategory=group)(cn={0}))";
    private static String userBase = "DC=XXX,DC=XXX";

    public static void main(String[] args) throws NamingException {
        Hashtable<String, String> env = new Hashtable<String, String>();

        // Configure our directory context environment.

        env.put(Context.INITIAL_CONTEXT_FACTORY, contextFactory);
        env.put(Context.PROVIDER_URL, connectionURL);
        env.put(Context.SECURITY_PRINCIPAL, connectionName);
        env.put(Context.SECURITY_CREDENTIALS, connectionPassword);
        if (authentication != null)
            env.put(Context.SECURITY_AUTHENTICATION, authentication);
        if (protocol != null)
            env.put(Context.SECURITY_PROTOCOL, protocol);

        InitialDirContext   context = new InitialDirContext(env);
        String              filter  = String.format(SEARCH_BY_SAM_ACCOUNT_NAME, username);
        SearchControls      constraints = new SearchControls();
        constraints.setSearchScope(SearchControls.SUBTREE_SCOPE);
        constraints.setReturningAttributes(attrIdsToSearch);
        NamingEnumeration results = context.search(userBase, filter,constraints);
        // Fail if no entries found
        if (results == null || !results.hasMore()) {
            System.out.println("No result found");
            return;
        }

        // Get result for the first entry found
        SearchResult result = (SearchResult) results.next();

        // Get the entry's distinguished name
        NameParser parser = context.getNameParser("");
        Name contextName = parser.parse(context.getNameInNamespace());
        Name baseName = parser.parse(userBase);

        Name entryName = parser.parse(new CompositeName(result.getName())
                .get(0));

        // Get the entry's attributes
        Attributes attrs = result.getAttributes();
        Attribute attr = attrs.get(attrIdsToSearch[0]);

        NamingEnumeration e = attr.getAll();
        System.out.println("Member of");
        while (e.hasMore()) {
            String value = (String) e.next();
            System.out.println(value);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-01-11T13:15:43.547

最简单的方法是使用“查找”：（打开 Ldap 上下文：查看上面的示例）

```
 /**
  * Tests if an Active Directory user exists in an Active Directory group. 
  * @param ctx LDAP Context.
  * @param dnADGroup distinguishedName of group.
  * @param dnADUser distinguishedName of user.
  * @return True if user is member of group.
  */

public static boolean isMemberOfADGroup(LdapContext ctx, String dnADGroup, String dnADUser) {
  try {
   DirContext lookedContext = (DirContext) (ctx.lookup(dnADGroup));
   Attribute attrs = lookedContext.getAttributes("").get("member");
   for (int i = 0; i < attrs.size(); i++) {
    String foundMember = (String) attrs.get(i);
    if(foundMember.equals(dnADUser)) {
     return true;
    }
   }
  } catch (NamingException ex) {
   String msg = "There has been an error trying to determin a group membership for AD user with distinguishedName: "+dnADUser;
   System.out.println(msg);
   ex.printStackTrace();
  }
  return false;
 } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-04-08T13:02:15.233

查找用户是否是组成员的 LDAP 查找方法不正确，尤其是在您谈论已登录用户时。对于实际登录的用户，组列表因用户登录的计算机而异。该列表需要包括来自域信任、嵌套组和本地组的组。

如果您正在寻找当前登录用户的组成员身份或您正在使用 Java 中的用户名和密码登录的用户，请尝试[Waffle](http://waffle.codeplex.com)。

```
IWindowsAuthProvider prov = new WindowsAuthProviderImpl();
IWindowsIdentity identity = prov.logonUser("username", "password"); 
System.out.println("User identity: " + identity.getFqn()); 
for(IWindowsAccount group : identity.getGroups()) { 
    System.out.println(" " + group.getFqn() + " (" + group.getSidString() + ")"); 
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-10-08T12:09:19.427

跟进 Sundaramurthi 的回答，它可以用更直接的方式完成，您不需要查询所有用户组：

```
(&(objectClass=user)(sAMAccountName=XXXX)(memberOf=CN=YYY,OU=_Common-Access,OU=Groups,OU=_CORP,DC=XXX,DC=XX)) 
```

其中 XXXX - 用户名 XXX.XX - 域名 YYY - 组名

无论用户是否在组中，这都可以让您得到答案。

所以就这样做：

```
String userBase = "DC=XXX,DC=XX";
String CHECK_IF_USER_IN_GROUP = "(&(objectClass=user)(sAMAccountName=%s)(memberOf=CN=%s,OU=...,OU=...,OU=...,%s))";

String queryFilter = String.format(CHECK_IF_USER_IN_GROUP, user, group, userBase);

SearchControls constraints = new SearchControls();
constraints.setSearchScope(SearchControls.SUBTREE_SCOPE);

NamingEnumeration results = context.search(userBase, queryFilter, constraints);

if (results == null) {
    throw new Exception("No answer from LDAP");
}

if (!results.hasMore()) {
    System.out.println("No result found");
    // user is not in the group
}
// user is in the group 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T17:29:11.063

不确定 Java API 的细节，但这样做的通用方法是向查询/绑定添加组检查。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T17:27:53.813

我不能给你一个使用 java 命名 ldap 的工作代码。我使用了 Spring LDAP，以及你这样做的方式：获取用户对象，对用户名进行搜索，例如 sAMAccountName=USERNAME

获得对象后，您将检索属性 memberOf -> 这将是一个列表并检查 Java 中的特定列表。

这是我能想到的唯一方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-05-19T05:29:05.537

要在建立连接后查询用户是否属于给定组，您可以使用 Active Directory 中的 member 或 memberOf 属性进行查询。

使用 memberOf 属性：使用的过滤器：(&(Group Member Attribute=Group DN)(objectClass=Group Object class)) 例如：(&(memberOf=CN=group,ou=qa_ou,dc=ppma,dc=org)(objectClass =组））

使用成员属性：使用的过滤器：(&(Group Member Attribute=User DN)(objectClass=Group Object class)) 例如：(&(member=CN=user,ou=qa_ou,dc=ppma,dc=org)(objectClass =组））

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T17:23:43.247

不幸的是，答案因安装 AD 以及其他类型的 LDAP 服务器而异。

我们必须解决同样的问题。最后，我们允许系统管理员为我们提供一个 LDAP 查询模式，我们将用户名（和组名，如果它也需要可变的话）替换到模式中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-02-26T16:58:22.390

我发现这很有用：

[检索 Active Directory 的组成员身份](https://blogs.msdn.microsoft.com/alextch/2007/06/18/sample-java-application-that-retrieves-group-membership-of-an-active-directory-user-account/)

我有这段工作代码：

```
import java.util.Hashtable;
import javax.naming.CompositeName;
import javax.naming.Context;
import javax.naming.Name;
import javax.naming.NameParser;
import javax.naming.NamingEnumeration;
import javax.naming.NamingException;
import javax.naming.directory.Attribute;
import javax.naming.directory.Attributes;
import javax.naming.directory.DirContext;
import javax.naming.directory.InitialDirContext;
import javax.naming.directory.SearchControls;
import javax.naming.directory.SearchResult;
import javax.naming.ldap.InitialLdapContext;
import javax.naming.ldap.LdapContext;

public class TestAD1 {

    private static String userBase = "DC=SomeName,DC=SomeName,DC=SomeName,DC=SomeName,DC=COM,DC=US";

    public static void main(String[] args) {
        TestAD1 tad = new TestAD1();
        try {
            // Create a LDAP Context
            Hashtable env = new Hashtable();
            env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
            env.put(Context.SECURITY_AUTHENTICATION, "simple");
            env.put(Context.SECURITY_PRINCIPAL, "ldap.serviceaccount@domain.com");
            env.put(Context.SECURITY_CREDENTIALS, "drowssap");
            env.put(Context.PROVIDER_URL, "ldap://fully.qualified.server.name:389");
            LdapContext ctx = new InitialLdapContext(env, null);
            InitialDirContext inidircontext = new InitialDirContext(env);
            DirContext dirctx = new InitialLdapContext(env, null);
            System.out.println("Connection Successful.");

            // Print all attributes of the name in namespace
            SearchControls sctls = new SearchControls();
            String retatts[] = {"sn", "mail", "displayName", "sAMAccountName"};
            sctls.setReturningAttributes(retatts);
            sctls.setSearchScope(SearchControls.SUBTREE_SCOPE);
            String srchfilter = "(&(objectClass=user)(mail=*))";
            String srchbase = userBase;
            int totalresults = 0;

            NamingEnumeration answer = dirctx.search(srchbase, srchfilter, sctls);
            while (answer.hasMoreElements()) {
                SearchResult sr = (SearchResult) answer.next();
                totalresults++;
                System.out.println(">>>  " + sr.getName());

                Attributes attrs = sr.getAttributes();
                if (answer == null || !answer.hasMore()) {
                    System.out.println("No result found");
                    return;
                }

                if (attrs != null) {
                    try {
                        System.out.println("    surname: " + attrs.get("sn").get());
                        System.out.println("    Email - ID: " + attrs.get("mail").get());
                        System.out.println("    User - ID: " + attrs.get("displayName").get());
                        System.out.println("    Account Name: " + attrs.get("sAMAccountName").get());
                        tad.GetGroups(inidircontext, attrs.get("sAMAccountName").get().toString());
                    } catch (NullPointerException e) {
                        System.out.println("Error listing attributes..." + e);

                    }
                }
                System.out.println("Total Results : " + totalresults);
                // close dir context
                dirctx.close();
            }

            ctx.close();
        } catch (NamingException e) {
            System.out.println("Problem Search Active Directory..." + e);
            //e.printStackTrace();
        }

    }

    // Get all the groups.

    public void GetGroups(InitialDirContext context, String username) throws NamingException {
        String[] attrIdsToSearch = new String[]{"memberOf"};
        String SEARCH_BY_SAM_ACCOUNT_NAME = "(sAMAccountName=%s)";
        String filter = String.format(SEARCH_BY_SAM_ACCOUNT_NAME, username);
        SearchControls constraints = new SearchControls();
        constraints.setSearchScope(SearchControls.SUBTREE_SCOPE);
        constraints.setReturningAttributes(attrIdsToSearch);
        NamingEnumeration results = context.search(userBase, filter, constraints);
        // Fail if no entries found
        if (results == null || !results.hasMore()) {
            System.out.println("No result found");
            return;
        }
        SearchResult result = (SearchResult) results.next();
        Attributes attrs = result.getAttributes();
        Attribute attr = attrs.get(attrIdsToSearch[0]);

        NamingEnumeration e = attr.getAll();
        System.out.println(username + " is Member of the following groups  : \n");
        while (e.hasMore()) {
            String value = (String) e.next();
            System.out.println(value);
        }
    }

} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-03-13T12:27:26.797

您也可以从这里修改接受的答案：[Authenticating against Active Directory with Java on Linux](https://stackoverflow.com/questions/390150/authenticating-against-active-directory-with-java-on-linux/390437) with following:

```
String group="name of the group";
Iterator ig = groups.iterator();
Boolean bool=false;
while (ig.hasNext()) {
      String a=ig.next().toString();
      if (a.equals(group)) { 
                JOptionPane.showMessageDialog(this, "Authentication succeeded!");   
                bool=true;
                // here you can do smth in case of success  
      }
}
if (bool==false){
             JOptionPane.showMessageDialog(this, "Permission denied");   
} 
```

# c# - ref 参数有什么不好？

> ID：570471
> 
> 赞同：15
> 
> 时间：2009-02-20T17:18:37.063
> 
> 标签：c#, oop

我面临一种情况，我认为只能通过使用 ref 参数来解决。但是，这将意味着当我只需要 5% 的 ref 参数提供的功能时，将方法更改为始终接受 ref 参数。

这让我觉得“哇，疯了，必须找到另一种方式”。我是不是很傻？ref 参数会导致什么样的问题？

**编辑**

要求提供更多详细信息，我认为它们与我的要求并不完全相关，但我们开始了。

我想保存一个新实例（它将使用稍后可能使用的 ID 进行更新）或检索一个与某些逻辑匹配的现有实例并更新它，保存它然后将新实例的引用更改为指向现有的。

代码可能会更清楚：

```
protected override void BeforeSave(Log entity)
{
    var newLog = entity;

    var existingLog = (from log in repository.All()
                           where log.Stuff == newLog.Stuff 
                                 && log.Id != newLog.Id
                           select log).SingleOrDefault();

    if (existingLog != null)
    {
        // update the time
        existingLog.SomeValue = entity.SomeValue;
        // remove the reference to the new entity
        entity = existingLog;
    }
}

// called from base class which usually does nothing before save
public void Save(TEntity entity)
{
    var report = validator.Validate(entity);

    if (report.ValidationPassed)
    {
        BeforeSave(entity);
        repository.Save(entity);
    }
    else
    {
        throw new ValidationException { Report = report };
    }
} 
```

事实上，我只会为基类的一个孩子（到目前为止）添加它，这会阻止我使用重载（因为我必须复制 Save 方法）。我也有一个问题，即我需要强制他们在这种情况下使用 ref 版本，否则事情将无法按预期工作。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-20T17:23:07.007

可以加个重载吗？有一个没有 ref 参数的签名，一个有它的签名。

Ref 参数*很有*用，我很高兴它们存在于 C# 中，但不应不加思索地使用它们。通常，如果一个方法有效地返回两个值，最好将方法拆分为两个部分，或者将两个值封装在一个类型中。但是，这些都不能涵盖所有情况-肯定有`ref`最好的选择。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-20T17:22:12.580

或许在这**5% 的情况下**使用**重载函数**，而让其他函数保持原样。

 **不必要的 ref 参数可能会导致糟糕的设计模式，但如果您有特定需求，这样做*没有问题*。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-20T17:26:55.530

如果您将 .NET Framework 作为人们对 API 期望的晴雨表，请考虑几乎所有 String 方法都*返回修改后的值*，但保持传递的参数不变。例如，String.Trim() 返回修剪后的字符串 - 它不会修剪作为参数传入的字符串。

现在，显然，这只有在您愿意将返回值放入您的 API 时才可行。此外，如果您的函数已经返回一个值，您可能会遇到创建包含原始返回值以及新更改的对象的自定义结构的令人讨厌的可能性。

最终，这取决于您以及如何记录您的 API。根据我的经验，我发现我的程序员同事倾向于期望我的函数表现得“像 .NET Framework 函数一样”。:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-20T17:21:32.237

`ref`参数本身不会引起问题。这是该语言的文档化功能。

然而，它可能会引起社会问题。具体来说，您的 API 的客户端可能不会`ref`仅仅因为它很少见而期望一个参数。您可能会修改客户不期望的引用。

当然，您可以争辩说这是客户没有阅读您的 API 规范的错，这是真的。但有时最好减少惊喜。编写好的代码不仅仅是遵循规则和记录内容，还包括让人类用户*自然而然地看到一些东西。*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T20:27:26.097

过载不会杀死您的应用程序或其设计。只要清楚地记录了意图，就应该没问题。

可以考虑的一件事是`ref`通过不同*类型*的参数减轻您对参数的恐惧。例如，考虑一下：

```
public class SaveArgs
{
   public SaveArgs(TEntity value) { this.Value = value; }

   public TEntity Value { get; private set;}
   public int NewId { get; internal set; }
   public bool NewIdGenerated { get; internal set; } 
} 
```

在您的代码中，您只需传递 SaveArgs 而不是 TEntity，以便您可以使用更有意义的信息修改其属性。（当然，它会比我上面的类设计得更好。）但是你不必担心模糊的方法接口，你可以在一个详细的类中返回尽可能多的数据。

只是一个想法。

编辑：修复了代码。我的错。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T17:21:34.997

使用我能想到的 ref 参数并没有错，实际上它们有时会非常方便。我认为他们有时会因为调试而受到不好的评价，因为变量的值可能会在代码逻辑中发生变化，并且有时很难跟踪。当转换为 WebServices 之类的东西时，它也使事情变得困难，其中“值”仅传递就足够了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T17:23:20.907

我对 ref 参数的最大问题是它们使使用类型推断变得困难，因为您有时必须显式声明用作 ref 参数的变量的类型。

大多数时候，我在 TryGet 场景中使用 ref 参数。一般来说，我已经停止在那种情况下使用 ref，而是选择通过一个选项来使用更实用的样式方法。

例如。字典中的 TryGetValue 从

```
bool TryGetValue(TKey key, out TValue value) 
```

到

```
Option<Value> TryGetValue(TKey key) 
```

此处提供选项：http: [//blogs.msdn.com/jaredpar/archive/2008/10/08/functional-c-providing-an-option-part-2.aspx](http://blogs.msdn.com/jaredpar/archive/2008/10/08/functional-c-providing-an-option-part-2.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T17:27:48.323

我见过的 ref 参数最常见的用途是作为返回多个值的一种方式。如果是这种情况，您应该考虑创建一个将所有值作为一个对象返回的类或结构。如果您仍想使用 ref 但想让它成为可选，请添加函数重载。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-09-24T04:35:28.270

ref 只是一个工具。你应该想：对于我正在构建的东西，最好的设计模式是什么？

*   有时使用重载方法会更好。

*   其他人会更好地返回自定义类型或元组。

*   其他人会更好地使用全局变量。

*   其他裁判将是正确的决定。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T17:25:03.353

如果您的方法在 5% 的时间里只需要这个 ref 参数，那么您可能需要分解这个方法。当然，如果没有更多细节很难说，但这对我来说就像是违反单一责任原则的案例。也许超载会有所帮助。

至于您的问题，我认为将参数作为参考传递是没有问题的，尽管这并不常见。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T19:50:04.127

这是 F# 或其他函数式编程语言通过返回元组值更好地解决的问题之一。它的语法更加简洁和简洁。在我正在阅读的关于 F# 的书中，它实际上指出了使用 ref 在 C# 中执行相同操作以返回多个参数的 C# 等效项。

我不知道这是一种不好的做法，还是关于 ref 参数有一些潜在的“booga booga”，对我来说，他们只是觉得语法不干净。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-20T20:22:25.437

带有单个引用参数的 void 返回函数对我来说当然看起来很有趣。如果我正在查看此代码，我建议重构 BeforeSave() 以包含对 Repository.Save() 的调用 - 显然是重命名它。为什么不只使用一种方法来获取您可能的新实体并保证所有内容都正确保存？无论如何，调用者不会对返回的实体做任何事情。

# rss - DBMS 存储 RSS 提要

> ID：570474
> 
> 赞同：1
> 
> 时间：2009-02-20T17:19:08.170
> 
> 标签：rss, database

我对 DBMS 系统不是很有经验，所以我需要一些关于使用哪个 DBMS 来存储 RSS 提要的建议。

DBMS 必须在 Linux 上可用并且是免费的。我对 MySQL 有一些经验，但我不确定它的执行速度是否足以处理数十万个 xml 文档的存储和更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T17:31:16.193

您将不得不提供更多信息，但几乎所有 DBMS 都可以在这方面做得很好。

SQL Server Express 是免费且易于使用的，所以这应该是一个起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T17:31:55.927

任何 DBMS 都足以存储 RSS 提要，问题应该是：

*   你有什么 DBMS 经验？
*   你买得起什么 DBMS？
*   哪些 DBMS 为您的平台提供客户端库？

# asp.net - IE6 的拼写检查器好用吗？

> ID：570479
> 
> 赞同：0
> 
> 时间：2009-02-20T17:20:17.530
> 
> 标签：asp.net, ajax, internet-explorer-6, spell-checking

请推荐一个 IE6 的拼写检查器。

偏好（但不是强制性的）：

*   开源
*   自由
*   对 ajax 友好

如果您需要澄清，请发表评论。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:11:44.580

*   ieSpell（非开源，免费供个人使用，部分编程接口）

它实际上是 IE 的插件，而不是服务器端的东西（因为您的 IE6 参考似乎是您正在寻找的东西）。

# javascript - 如何创建一个 jquery 函数来设置每个 div 的最大高度？

> ID：570486
> 
> 赞同：1
> 
> 时间：2009-02-20T17:21:58.227
> 
> 标签：javascript, jquery

我想做一个jquery函数，当窗口调整大小时，它使用css类名称“taskbox”搜索div并将最大高度设置为父div高度-任务框的当前偏移量能够小于可用空间，但不要扩展它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T23:11:35.517

我不确定您到底要做什么，但是要获取包​​含可以使用 taskbox 类的元素的所有元素：

```
$(":has(.taskbox)").height(300); 
```

这将调整所有这些元素的高度。要根据窗口调整大小时父元素的高度调整所有任务框的高度，您可以执行以下操作：

```
$(window).resize(function() {
  var parent = $(".taskbox");
  $(".taskbox").each(function() {
    $(this).height($(this).parent().height() - 50);
  });
}); 
```

请记住，父元素需要指定高度才能正常工作。您可以通过以下方式获取窗口的高度：

```
$(window).height(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:26:42.147

您可以尝试寻找[现有的解决方案](http://www.filamentgroup.com/lab/setting_equal_heights_with_jquery/)（jQuery 有一个庞大的插件社区）：

至少这会让你开始。

# web-services - 大量持久连接

> ID：570487
> 
> 赞同：2
> 
> 时间：2009-02-20T17:22:10.147
> 
> 标签：web-services, persistence, load-balancing

我正在建立一个项目，主要问题之一是如何实现一个简单的消息队列系统（类似于信使聊天系统的东西）。我想避免轮询，但很可能会有很多并发连接（数万个）。这些将是 HTTP+SSL 连接，从应用程序而不是浏览器开始。

我发现的一个解决方案是 DNS 负载平衡：将这些持久连接分布在一堆 nginx 网络服务器上。

你怎么看？还有其他可能的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T17:45:10.590

对于负载平衡，保持应用程序服务器无状态将显着打开该领域。一旦你有了它，你就可以自由地使用几乎任何通用的负载均衡器。从特定协议（如 HTTP 负载平衡器）到通用 TCP 级负载平衡器。

保持无状态，相比之下，其余的将是微不足道的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T17:56:33.620

如果您计划使用 Web 服务（XML 消息传递），您可以使用 gsoap，它包含一个使用线程池的 Web 服务器示例应用程序。我已经使用这个和 mysql 运行了一个服务器（用于持久状态）。我同意 Ryan 关于减少/消除应用程序状态的观点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T17:32:05.037

DNS 负载平衡将允许您在多个 IP 地址（可能是多个服务器）之间分配查询。请记住，您的客户端可能会从一个请求到另一个请求获得不同的服务器，因此您的应用程序不能使用本地状态管理。您的应用程序必须将其状态存储在一个集中的位置，例如数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T17:36:15.417

你考虑过点对点吗？突破防火墙的最新技术实际上非常有效，特别是因为您在每个实例中都运行自己的客户端软件，并且您有服务器来启动连接。

更多的工作，但服务器资源显着减少。

另外，编写自己的服务器软件——确保它可以处理大量连接并且非常轻量级，并且在进行负载平衡之前，您应该能够处理每台服务器的数千个连接。

-亚当

# ruby-on-rails - 获取实例变量的名称

> ID：570505
> 
> 赞同：3
> 
> 时间：2009-02-20T17:26:27.483
> 
> 标签：ruby-on-rails, ruby

浏览 rails 2.3 RC1 release note 我看到了这个：

```
# Equivalent of render :partial => 'articles/_article', :object => @article
render @article 
```

因此，该方法以某种`render`方式找出传递 int 的那个对象，它被分配给一个名为 的实例变量`article`。它是如何做到的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T18:03:31.933

它实际上使用对象（模型）的类型而不是实例变量的名称来确定部分路径。因此，只要类型是 Article，即使实例变量是 @foo，它也可以工作。

请参阅 ActionController::RecordIdentifier.partial_path 的代码，了解如何从对象计算路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T18:12:31.477

Dave Ray 的回答是正确的——Rails 在这里没有对变量名做任何事情。[在一般情况下， ParseTree](http://parsetree.rubyforge.org/)库可以实现您所询问的那种内省，但这存在可移植性问题（JRuby、Ruby 1.9 等）。

# http - 用于将完整的 http 正文（包括标头）发送到服务器的 Windows 工具

> ID：570515
> 
> 赞同：1
> 
> 时间：2009-02-20T17:28:42.237
> 
> 标签：http, networking, sockets, soap

我想知道是否有人知道我可以将完整的 HTTP 正文（标头和内容）发送到 Web 服务器的工具。到目前为止，我得到的最好的东西是腻子，但我希望有一些东西可以让我查看@并编辑有效负载，然后单击一个按钮并发送它。（我可能会在几分钟内写出这样的东西，但希望有一个已经完成和半抛光的应用程序。

背景：我正在测试一个多部分/相关的soap请求，并试图想出一些想法来编辑在其旅程中某处被吃掉的有效载荷的一个元素。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T17:35:39.787

[Fiddler](http://fiddler2.com/fiddler2/)中有一个请求生成器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T18:27:35.933

[cURL](http://curl.haxx.se/download.html)是一个方便的命令行工具（提供 Windows 二进制文件）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T17:35:19.333

像[netcat](http://en.wikipedia.org/wiki/Netcat)这样的东西会很完美。显然[这](http://joncraton.org/files/nc111nt.zip)是一个windows版本。

# javascript - .getElementById IE

> ID：570516
> 
> 赞同：1
> 
> 时间：2009-02-20T17:28:51.313
> 
> 标签：javascript, internet-explorer, dhtml, getelementbyid

我有一个运行 2 个`".getElementById('').style"`更改的 JavaScript。两者都在 FF 中完美运行，但第一个在 IE7 中不起作用。

感谢所有帮助:)

第一个源代码：

```
function ingen() {
    document.getElementById('merInfo1').style.display='none';
    document.getElementById('merInfo2').style.display='none';
    document.getElementById('merInfo3').style.display='none';
    document.getElementById('merInfo4').style.display='none';
    document.getElementById('merInfo5').style.display='none';
    document.getElementById('merInfo6').style.display='none';
    document.getElementById('merInfo7').style.display='none';
} 
```

HTML：

```
<span class="enkeltSkjema" id="avtaleInput">
    <select name="radio1" id="radio1">
        <option value="1" onClick="ingen()">lorem</option>
        <option value="2" onClick="some()">lorem</option>                                  
        <option value="3" onClick="other()">lorem</option>
        <option value="4" onClick="func()">lorem</option>
        <option value="5" onClick="tion()">lorem</option>
        <option value="6" onClick="names()">lorem</option>
        <option value="7" onClick="goes()">lorem</option>
        <option value="8" onClick="here()">lorem</option>
    </select>
</span>                          
<span class="enkeltSkjema" id="merInfo">
    <span id="merInfo1" name="merInfo1"></span>
    <span id="merInfo2" name="merInfo2"></span>
    <span id="merInfo3" name="merInfo3"></span>
    <span id="merInfo4" name="merInfo4"></span>
    <span id="merInfo5" name="merInfo5"></span>
    <span id="merInfo6" name="merInfo6"></span>
    <span id="merInfo7" name="merInfo7"></span>
</span> 
```

其次，在 IE 中运行良好：

```
function levAdresse() {
    if (document.getElementById('egenLevAdr').checked == true) {
        document.getElementById('levAdrBox').style.display='block';
    }   
    else {
        document.getElementById('levAdrBox').style.display='none';
    }
} 
```

HTML：

```
<div id="levAdrBox">
    <div id="levAdr">Field
        <span class="" id="levAdrInput"><input type="text" id="text12" name="text12" /></span>
    </div>
    <div class="" id="levPostSted"> field:*
        <span class="" id="levPostStedInput">
            <input type="text" id="text18" name="text18" />
            <span class="" id="levPostNr">field:*
                <span class="" id="levPostNrInput">
                    <input type="text" id="text17" name="text17" />
                </span>
            </span>
        </span>
    </div>
</div> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T18:18:33.193

嗯……也许如果你在 SELECT 上使用“OnChange()”而不是在 OPTION 上使用“OnClick”？

```
<select name="radio1" id="radio1" onChange="ingen(this.value)">
        <option value="1">lorem</option>
        <option value="2">lorem</option>                                  
        <option value="3">lorem</option>
        <option value="4">lorem</option>
        <option value="5">lorem</option>
        <option value="6">lorem</option>
        <option value="7">lorem</option>
        <option value="8">lorem</option>
</select> 
```

并在 ingen(something) 中做一个条件，或者调用与传递的值相关的其他函数......？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:32:36.983

您是否有可能在 DOM 完全构建之前调用 ingen() 函数？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T17:42:37.553

您在页面上是否有任何其他元素的“名称”属性设置为：

```
merInfo1
merInfo2
merInfo3
merInfo4
merInfo5
merInfo6
merInfo7 
```

（任何情况下：例如 MerInfo1、merinfo1、MERinfo1 在 IE 中都是一样的）

如果是这样，那就是错误。IE 认为 name 与 ID 相同（这显然是一个错误）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T17:37:52.727

如果您有选择/可能，我会使用 jQuery 并摆脱（大部分）跨浏览器不兼容性：

```
function ingen() {
  $("#merInfo span").css("display", "none");
}

$(document).ready(function() {
  $("#egenLevAdr").click(function() { $("#levAdrBox").toggle(); });
}); 
```

# php - 如何使用 PHP 获取 Mysql 数据库中的最后一个字段？

> ID：570521
> 
> 赞同：5
> 
> 时间：2009-02-20T17:29:44.153
> 
> 标签：php, mysql, database

我有 mysql 数据库，我想从表中的字段中获取最后一个 ID。

例子 ： -

```
id   Value
1    david
2    jone
3    chris 
```

如果此表存在，我想要一个函数返回 3。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-20T17:34:33.237

您可以使用：

```
SELECT MAX(id) FROM table 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-20T17:30:16.850

```
SELECT id
FROM table
ORDER BY id DESC
LIMIT 1 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-23T02:01:11.707

如果您想在具有 AUTO_INCREMENT 列的表中选择最近插入的行的 ID，您可能会对 MySQL 的[LAST_INSERT_ID](http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_last-insert-id)函数感兴趣。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-03-03T20:32:13.357

您也可以使用以下代码::

```
 $lastId = mysql_insert_id(); 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-02-19T23:37:20.463

```
SELECT * FROM table ORDER BY id DESC LIMIT 1 
```

# python - 如何在 Django 的表单集中向表单添加纯文本信息？

> ID：570522
> 
> 赞同：6
> 
> 时间：2009-02-20T17:30:00.673
> 
> 标签：python, django, django-forms

我想在每个表单中显示来自 db 查询的标题和描述，但我不希望它位于字符域中，我希望它是 html 格式的文本。

示例模板代码：

```
{% for form, data in zipped_data %}
   <div class="row">
      <div class="first_col">
         <span class="title">{{ data.0 }}</span>
         <div class="desc">
            {{ data.1|default:"None" }}
         </div>
      </div>
      {% for field in form %}
         <div class="fieldWrapper" style="float: left; ">
            {{ field.errors }}
            {{ field }}
         </div>
      {% endfor %}
{% endfor %} 
```

这是最惯用的方法吗？或者，有没有办法将不会显示在文本区域或文本输入中的文本添加到我的模型：

```
class ReportForm(forms.Form):
   comment = forms.CharField() 
```

?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T21:39:03.350

您可以覆盖表单上的构造函数并将标题/描述保存为*实例级*成员变量，而不是使用附加数据压缩表单。这有点面向对象，学习如何做到这一点将帮助您解决其他问题，例如动态选择字段。

```
class MyForm (forms.Form):
    def __init__ (self, title, desc, *args, **kwargs):
        self.title = title
        self.desc = desc
        super (MyForm, self).__init__ (*args, **kwargs) # call base class 
```

然后在您的视图代码中：

```
form = MyForm ('Title A', 'Description A') 
```

如果您需要这些值来自数据库，请进行相应调整。然后在您的模板中，您可以像执行其他任何操作一样访问实例变量，例如：

```
 <h1>{{ form.title }}</h1>
   <p>{{ form.desc }}</p> 
```

从您提出问题的方式来看，我认为您可能对 Django 使用 Python*类属性*提供声明性表单 API 与应用于类的单个实例（在本例中为表单对象）的*实例级*属性的方式有些混淆.

*   [查看此链接以获得有关区别的良好讨论](https://stackoverflow.com/questions/207000/python-difference-between-class-and-instance-attributes)
*   [和这个](https://stackoverflow.com/questions/206734/why-do-attribute-references-act-like-this-with-python-inheritance)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-22T04:35:57.287

我刚刚通过子类化文本输入字段之一创建了一个只读小部件：

```
class ReadOnlyText(forms.TextInput):
  input_type = 'text'

  def render(self, name, value, attrs=None):
     if value is None: 
         value = ''
     return value 
```

和：

```
class ReportForm(forms.Form):
  comment = forms.CharField(widget=ReadOnlyText, label='comment') 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-14T22:37:37.543

我必须解决一个类似的问题，并且喜欢你的想法 Andrei。不过，我在使用它时遇到了一些问题，因为如果出现验证错误，只读字段的值就会丢失。为了解决这个问题，我做了类似的事情，但覆盖了 HiddenInput 并将值保存在隐藏的表单字段中。IE：

```
class ReadOnlyText(forms.HiddenInput):
    input_type = 'hidden'

    def render(self, name, value, attrs=None):
        if value is None:
            value = '' 
        return mark_safe(value + super(ReadOnlyTextWidget, self).render(name, value, attrs))

class ReportForm(forms.Form):
  comment = forms.CharField(widget=ReadOnlyText, label='comment') 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-25T19:30:00.027

我认为您可以使用“{{ field.value }}”获得它。也许这是更简单的方法。

```
{% for form in formset %}
    {% for field in form %}
        {% if forloop.counter = 1 %}
            <td><img src="{{ MEDIA_URL }}{{ field.value }}"/></td>
        {% endif %}
        {% if forloop.counter = 2 %}
            <td>{{ field.value }}</td>
        {% endif %}
        {% if forloop.counter > 2 %}
            <td>{{ field }}{{ field.errors }}</td>
        {% endif %} 
    {% endfor %}
{% endfor %} 
```

# c# - 序列化字节数组与 XML 文件

> ID：570535
> 
> 赞同：4
> 
> 时间：2009-02-20T17:32:44.207
> 
> 标签：c#, .net, networking, file-io

我大量使用字节数组在网络上来回传输对象、原始数据。我通过让一个类型实现 ISerializable 来适应 java 的方法，它包含两个方法，作为接口的一部分，ReadObjectData 和 WriteObjectData。任何使用此接口的类都会将日期写入字节数组。类似的东西

```
 class SerializationType:ISerializable
    {
       void ReadObjectData (/*Type that manages the write/reads into the byte array*/){}
       void WriteObjectData(/*Type that manages the write/reads into the byte array*/){}  
    } 
```

在所有对象的写入完成后，我发送一个网络数组。

* * *

这实际上是两个问题。它是通过网络发送数据以获得最高效率（在速度、大小方面）的正确方法吗？

您是否会使用这种方法将对象写入文件，而不是通常使用 xml 序列化？

**编辑#1**

*Joel Coehoorn*提到了 BinaryFormatter。我从来没有使用过这个类。除了我目前在 msdn 上看到的内容之外，您能否详细说明、提供好的示例、参考资料、建议、当前做法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T17:47:26.480

这应该没问题，但是您正在做已经为您完成的工作。看看[`System.Runtime.Serialization.Formatters.Binary.BinaryFormatter`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatters.binary.binaryformatter.aspx)班级。

无需为每种特定类型实现您自己的 Read/WriteOjbectData() 方法，您只需使用已经可以处理大多数任何对象的此类。它基本上获取几乎所有 .Net 对象的内存表示的精确副本，并将其写入流或从流中读取：

```
BinaryFormatter bf = new BinaryFormatter();
bf.Serialize(outputStream, objectToSerialize);

objectToDeserialize = bf.Deserialize(inputStream) as DeserializedType; 
```

确保您通读了链接的文档：unicode 字符串可能存在问题，并且准确的内存表示并不总是合适的（例如，诸如打开套接字之类的东西）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T21:05:58.983

如果你追求简单、轻量和高效的二进制序列化，可以考虑[protobuf-net](http://code.google.com/p/protobuf-net/)；基于 google 的协议缓冲区格式，但从头开始实现典型的 .NET 使用。特别是，它既可以独立使用（通过 protobuf-net's `Serializer`），也可以`BinaryFormatter`通过实现`ISerializable`（并委托给`Serializer`）使用。

除了高效之外，这种格式还被设计为可扩展和可移植的（即与 java/php/C++“协议缓冲区”实现兼容），这与 BinaryFormatter 不同的是，它既是实现特定的又是版本不容忍的。这意味着您不必乱写任何序列化代码......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T17:38:34.020

当框架中已经有一个 ISerializable 接口时创建自己的 ISerializable 接口听起来有点像灾难的秘诀。至少给它一个不同的名字。

在阅读时您会遇到一些问题 - 您将没有实例来调用该方法。你可能想把它变成一种“工厂”：

```
public interface ISerializationFactory<T>
{
    T ReadObjectData(Stream input);
    void WriteObjectData(Stream output);
} 
```

至于 XML 与二进制……这完全取决于情况：会有多少数据，您是否需要向后和向前兼容性，.NET 中的 XML 序列化是否已经为您提供了足够的控制权等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T17:38:46.423

是的，这将比发送 XML 更快，因为您将通过网络发送更少的数据。即使您压缩了 XML（这将大大减少其大小），您仍然会有压缩和解压缩的开销。所以我想说，在您目前正在做的事情和 XML 序列化之间，您目前正在使用最有效的解决方案。

但是，我很好奇使用 XML 而不是编组对象会对性能造成多大影响。我鼓励您研究 XML 序列化的原因是因为您将以人类可读的与应用程序无关的格式存储数据。如果您能够以不会在应用程序中导致性能损失的方式将数据序列化为 XML，我建议您研究一下。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T17:39:31.290

关于写入文件，如果您希望能够读取序列化或可能更改它，通常您希望将对象序列化为 XML。如果您不希望序列化是人类可读的，那么您不妨重用您的二进制序列化。

如果您确实希望它是人类可读的，那么 XML 是值得考虑的，但这取决于您需要序列化的数据类型。XML 本质上是递归的，因此非常适合序列化同样的递归数据。它不太适合其他类型的数据。

换句话说，选择适合您需求的持久序列化。这里没有万能的解决方案。

至于网络，通常您希望将大小保持在最低限度，因此 XML 通常不是一个好的选择，因为它很冗长。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T17:42:06.133

序列化（在 Java 中）看似简单。只要你做一些简单的事情（比如从不改变课程），这很容易——但它也有很多“有趣”的事情。

关于 Java 序列化的一个很好的讨论请看[Effective Java](http://books.google.com/books?id=ZZOiqZQIbRMC&pg=PA97&sig=JgnunNhNb8MYDcx60Kq4IyHUC58#PPP1,M1)（特别是第 10 章）。

对于 C#，不确定，但核心问题可能是相同的。

这里有一个关于 C# 序列化的示例：http: [//www.codeproject.com/KB/cs/objserial.aspx](http://www.codeproject.com/KB/cs/objserial.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T19:01:41.653

[XStream](http://xstream.codehaus.org/)库提供了一种非常好的处理序列化的方法，包括支持 XML、JSON 和支持自定义转换器。具体来说，自定义转换器的使用使我们能够减少 XML 的冗长并严格序列化所需的内容。

XStream 不需要将所有内容都声明为可序列化，这在使用第三方库并需要从该库中序列化未声明为可序列化的类的实例时非常重要。

* * *

答案已经被接受，但为了讨论的完整性，这里是一个链接，可以很好地比较不同的序列化方法/库：

[http://code.google.com/p/thrift-protobuf-compare/wiki/Benchmarking](http://code.google.com/p/thrift-protobuf-compare/wiki/Benchmarking)

kryo库看起来非常适合 Java 序列化[。](http://code.google.com/p/kryo/)与 XStream 类似的是支持自定义转换器。

# winforms - 在 Windows 窗体中处理时更新标签

> ID：570537
> 
> 赞同：37
> 
> 时间：2009-02-20T17:33:00.617
> 
> 标签：winforms, label, progress

在处理时更新 Windows 窗体应用程序上的标签的最佳方法是什么？

当用户单击按钮时，我有一个循环对用户系统上的文件进行一些处理。

```
foreach (System.IO.FileInfo f in dir.GetFiles("*.txt"))
{
   // Do processing
   // Show progress bar
   // Update Label on Form, "f.Name is done processing, now processing..."
} 
```

什么是一些示例代码？

这到底叫什么？是线程还是委托？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-02-20T17:42:13.060

一个快速的解决方法是：

```
Label1.Text = f.Name + " is done processing, now processing...";
Label1.Refresh(); 
```

您真的想避免`DoEvents`，否则如果您的用户反复按下表单上的按钮，您将遇到问题。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-20T17:38:06.427

您*应该*在另一个线程上执行此操作，然后从该线程更新您的 UI 线程。您正在通过在 UI 线程上执行此工作来阻止进一步的处理。

如果您*不能*将此代码移动到 UI 线程，那么您可以随时调用[`Application.DoEvents`](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.doevents.aspx)，但我**强烈**建议您先探索这些选项：

*   [`System.ComponentModel.BackgroundWorker`](http://msdn.microsoft.com/en-us/library/8xs8549b.aspx)
*   [`System.Threading.ThreadPool`](http://msdn.microsoft.com/en-us/library/3dasc8as.aspx)
*   [`System.Threading.Thread`](http://msdn.microsoft.com/en-us/library/system.threading.thread.aspx)
*   [`System.Threading.Tasks`命名空间](http://msdn.microsoft.com/en-us/library/system.threading.tasks.aspx)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-21T15:57:37.673

您需要将数据从一个线程传输到另一个线程。这可以通过几种方式来完成......

首先，您的“背景”线程可以更新某种“CurrentStatus”字符串变量，它会随着它的进行而改变。然后，您可以在表单上放置一个计时器，然后获取 CurrentStatus 变量并使用它更新标签。

其次，您可以使用标签控件的 InvokeRequired 属性通过委托简单地将操作从后台线程调用到 UI 线程。所以例如...

```
private delegate void UpdateStatusDelegate(string status);
private void UpdateStatus(string status)
{
    if (this.label1.InvokeRequired)
    {
        this.Invoke(new UpdateStatusDelegate(this.UpdateStatus), new object[] { status });
        return;
    }

    this.label1.Text = status;
} 
```

您可以从任何线程（UI 或后台）调用该 UpdateStatus() 方法，它会检测是否需要在主 UI 线程上调用操作（如果需要，是否需要）。

要实际设置线程，您可以这样做：

```
 private void StartProcessing()
    {
        System.Threading.Thread procThread = new System.Threading.Thread(this.Process);

        procThread.Start();
    }

    private void Process() // This is the actual method of the thread
    {
        foreach (System.IO.FileInfo f in dir.GetFiles("*.txt"))
        {
            // Do processing
            // Show progress bar
            // Update Label on Form, "f.Name is done processing, now processing..."
            UpdateStatus("Processing " + f.Name + "...");                
        }
    } 
```

然后，当用户单击“开始”按钮时，您只需调用 StartProcessing()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T17:37:31.667

如果您的处理时间很长，请在后台工作线程中进行。

[http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-03-14T09:23:51.283

我还建议使用：

```
Application.DoEvents(); 
```

处理当前在消息队列中的所有 Windows 消息。

# file - 在 Adob e AIR 中读取 txt 文件时出现问题

> ID：570542
> 
> 赞同：1
> 
> 时间：2009-02-20T17:34:54.013
> 
> 标签：file, character-encoding, air

我一直在开发在浏览器中运行的应用程序，我想尝试将其转换为 AIR 应用程序。

在我的网络应用程序中，加载文档后，我正在使用 jquery 将文本文件加载到字符串中。

```
var info;
$.get('media/info.txt',function(data) {
   info=data;
   alert("the info is "+info.length+" bytes long");
}); 
```

在我的 AIR 应用程序中，在本地加载文档后，我正在使用 AIR 文件 API 将 SAME 文本文件（但这里由 AIR 应用程序本地托管）加载到一个字符串中。

```
var info;
var file=air.File.applicationDirectory.resolvePath("media/info.txt");
var filestream=new air.FileStream();
filestream.addEventListener(air.Event.COMPLETE, function() {
   info=filestream.readUTFBytes(filestream.bytesAvailable);
   alert("the info is "+info.length+" bytes long");
});
filestream.openAsync(file, air.FileMode.READ); 
```

上面的两个警报**为同一个文件提供了两个不同的值**，而我的应用程序在浏览器中运行良好，AIR 信息更大，并且似乎引入了一些无法跟踪的字符，破坏了我的应用程序！

我猜这可能与 AIR 中使用的阅读方法（UTF 狗屎）有关，但我找不到另一个真正有效的阅读方法。

有人可以提示我在两种情况下获得相同的数据吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T17:43:15.743

readUTFBytes [()](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/utils/IDataInput.html#readUTFBytes())期望读取 UTF-8 编码的字符。你能检查你的原始文件是否是 UTF-8 吗？一个好的文本编辑器可能会有所帮助。

# wpf - 将 FrameworkElementFactory 绑定到数据对象属性

> ID：570552
> 
> 赞同：4
> 
> 时间：2009-02-20T17:37:09.297
> 
> 标签：wpf, templates, binding, frameworkelementfactory

我有一个**ListBox**，其**DataTemplate**是使用 3 个 FrameworkElementFactory 对象（带有 2 个附加子项（**CheckBox**和**TextBox**）的**StackPanel ）在代码中创建的。**集合中绑定到**ListBox的****ItemsSource**的item 对象与您通常在任何类型的**ListControl**中看到的 Item 对象类型基本相同。我要做的是将**DataTemplate中****CheckBox**的**IsChecked**属性绑定到 Item 对象上的布尔属性。列表**框********************支持 3 种模式，单选、多选和多选。我试图实现的模式是多重检查，以便**CheckBox的****IsChecked**属性绑定到项目对象的**Selected**属性。**这会创建一种行为，其中仅当ListBoxItem上的****CheckBox**的**IsChecked**属性为真时才认为该项目被选中，而不是当 WPF **ListBoxItem**的 IsSelected 属性为真时。应该发生的是数据对象上的布尔属性应该绑定到 IsChecked 属性，并且当 IsChecked 属性更改时，项目对象上的**Selected**属性将更新，从而更新一个****************幕后的 **SelectedItems集合。************************************

 ****这是我刚刚描述的一些简化代码。

```
ListBox innerListBox = new ListBox();
//The ItemsSource of the ListBox being set to the collection of items            
this.innerListBox.ItemsSource = this.Manager.ItemManagers;
this.innerListBox.ItemTemplate = this.GetMultipleCheckTemplate();    

public System.Windows.DataTemplate GetMultipleCheckTemplate()  
{  
    DataTemplate dt = new DataTemplate;  

FrameworkElementFactory factorySP = new FrameworkElementFactory(typeof(StackPanel));  

FrameworkElementFactory factoryCB = new FrameworkElementFactory(typeof(CheckBox));      
factoryCB.SetBinding(CheckBox.IsCheckedProperty, new Binding("Selected");  

RoutedEventHandler clickHandler = new RoutedEventHandler(ItemCheckBox_Click);  
factoryCheckBox.AddHandler(CheckBox.ClickEvent, clickHandler, true);   

factorySP.AppendChild(factoryCB);  

FrameworkElementFactory factoryTB = new FrameworkElementFactory(typeof(TextBlock));    
factoryTB .SetBinding(TextBlock.TextProperty, new Binding("Description");  

factorySP.AppendChild(factoryTB);   

template.VisualTree = factorySP;    
return template;  
} 
```

有一些我没有包括的代码是**CheckBox**上的事件处理程序。如果 Wpf **ListBox**上有多项选择，则该范围内的所有 CheckBox 都将切换为单击的 CheckBox 的值。我可以手动将 Item 上的 Selected 属性设置为发送者的 IsChecked 属性，一切正常，但是我认为数据绑定应该可以正常工作，我不必手动执行此操作。在这种情况下，数据绑定是异步的还是我需要明确地做一些事情？

# c# - 用于 C# 中值相等的自定义类的最强大的 Equals 实现

> ID：570560
> 
> 赞同：2
> 
> 时间：2009-02-20T17:39:20.977
> 
> 标签：c#, .net, class, equals

假设我有一个 Point2 类，我想实现以下 Equals：

```
public override bool Equals ( object obj )

public bool Equals ( Point2 obj ) 
```

这是来自有效的 C# 3 书：

```
public override bool Equals ( object obj )
{
    // STEP 1: Check for null
    if ( obj == null )
    {
        return false;
    }

    // STEP 3: equivalent data types
    if ( this.GetType ( ) != obj.GetType ( ) )
    {
        return false;
    }
    return Equals ( ( Point2 ) obj );
}

public bool Equals ( Point2 obj )
{
    // STEP 1: Check for null if nullable (e.g., a reference type)
    if ( obj == null )
    {
        return false;
    }
    // STEP 2: Check for ReferenceEquals if this is a reference type
    if ( ReferenceEquals ( this, obj ) )
    {
        return true;
    }
    // STEP 4: Possibly check for equivalent hash codes
    if ( this.GetHashCode ( ) != obj.GetHashCode ( ) )
    {
        return false;
    }
    // STEP 5: Check base.Equals if base overrides Equals()
    System.Diagnostics.Debug.Assert (
        base.GetType ( ) != typeof ( object ) );

    if ( !base.Equals ( obj ) )
    {
        return false;
    }

    // STEP 6: Compare identifying fields for equality.
    return ( ( this.X.Equals ( obj.X ) ) && ( this.Y.Equals ( obj.Y ) ) );
} 
```

这是不是矫枉过正？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T17:45:27.733

用继承层次支持相等是很棘手的。你需要弄清楚你的意思。你真的需要在这里继承吗？如果不是 - 如果 Point2 直接从 System.Object 派生，并且您可以将其密封，生活会变得更容易一些。在这种情况下，我会使用：

```
public override bool Equals (object obj)
{
    return Equals(obj as Point2);
}

public bool Equals (Point2 obj)
{
    // STEP 1: Check for null if nullable (e.g., a reference type)
    // Note use of ReferenceEquals in case you overload ==.
    if (object.ReferenceEquals(obj, null))
    {
        return false;
    }

    // STEP 2: Check for ReferenceEquals if this is a reference type
    // Skip this or not? With only two fields to check, it's probably
    // not worth it. If the later checks are costly, it could be.
    if (object.ReferenceEquals( this, obj))
    {
        return true;
    }

    // STEP 4: Possibly check for equivalent hash codes
    // Skipped in this case: would be *less* efficient

    // STEP 5: Check base.Equals if base overrides Equals()
    // Skipped in this case

    // STEP 6: Compare identifying fields for equality.
    // In this case I'm using == instead of Equals for brevity
    // - assuming X and Y are of a type which overloads ==.
    return this.X == obj.X && this.Y == obj.Y;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T17:45:03.053

不是真的-您几乎考虑了所有可能性。如果此代码用于临时应用程序以外的任何内容，您应该考虑这种方法的好处，因为由于奇怪的对象相等行为导致的逻辑错误很难调试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T17:44:44.070

在我看来，这正是你想要的。整个块归结为：

“如果是完全相同的实例，则返回 true。如果它们是具有相同 X 和 Y 值的单独实例，则返回 true。所有其他情况（null、不同类型、不同 x/y 值）返回 false。”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T17:45:20.683

它肯定比*我想*为 equals 方法编写的代码多。有很多冗余检查，例如检查 ReferenceEquals 和 HashCodes（我知道这些检查是多余的，因为函数中的最后一行检查结构相等性）。专注于简单易读的代码。

```
public bool Equals(object o)
{
    Point2 p = o as Point2;
    if (o != null)
        return this.X == o.X && this.Y == o.Y;
    else
        return false;
} 
```

由于您的 equals 方法使用结构相等，因此请确保使用基于您的字段的实现来覆盖 GetHashCode。

# c# - 检测 Shift 键被按下而不使用 Windows 窗体中的事件？

> ID：570577
> 
> 赞同：15
> 
> 时间：2009-02-20T17:44:12.603
> 
> 标签：c#

我需要能够检测到正在按住 shift 键，但我不想使用事件或全局变量来确定这一点。C# 中是否有一个 API 可以让您询问当前按下了哪些键而不是使用事件？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-07-09T16:08:52.687

```
if ((Control.ModifierKeys & Keys.Shift) != 0) 
```

`true`如果另一个修饰键也按下（例如，Ctrl+Shift），也会出现这种情况。如果要检查是否在没有任何其他修饰符的情况下单独按下 Shift，请使用

```
if (Control.ModifierKeys == Keys.Shift) 
```

`true`请注意，即使另一个非修饰符关闭（例如，Shift+A）也会出现这种情况。如果要检查是否按下了 Shift 并且*仅*按下了 Shift，则必须使用 API 调用。

* * *

如果您在继承的类`Control`（例如表单）中，则可以删除`Control`限定符。（`static`继承类中的属性不需要限定符）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T18:02:13.933

`Form.ModifierKeys` （静态属性）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T18:14:43.233

您可以安装一个[低级键盘挂钩](http://blogs.msdn.com/toub/archive/2006/05/03/589423.aspx)。

```
using System;
using System.Diagnostics;
using System.Windows.Forms;
using System.Runtime.InteropServices;

class InterceptKeys
{
    private const int WH_KEYBOARD_LL = 13;
    private const int WM_KEYDOWN = 0x0100;
    private static LowLevelKeyboardProc _proc = HookCallback;
    private static IntPtr _hookID = IntPtr.Zero;

    public static void Main()
    {
        _hookID = SetHook(_proc);
        Application.Run();
        UnhookWindowsHookEx(_hookID);
    }

    private static IntPtr SetHook(LowLevelKeyboardProc proc)
    {
        using (Process curProcess = Process.GetCurrentProcess())
        using (ProcessModule curModule = curProcess.MainModule)
        {
            return SetWindowsHookEx(WH_KEYBOARD_LL, proc,
                GetModuleHandle(curModule.ModuleName), 0);
        }
    }

    private delegate IntPtr LowLevelKeyboardProc(
        int nCode, IntPtr wParam, IntPtr lParam);

    private static IntPtr HookCallback(
        int nCode, IntPtr wParam, IntPtr lParam)
    {
        if (nCode >= 0 && wParam == (IntPtr)WM_KEYDOWN)
        {
            int vkCode = Marshal.ReadInt32(lParam);
            Console.WriteLine((Keys)vkCode);
        }
        return CallNextHookEx(_hookID, nCode, wParam, lParam);
    }

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr SetWindowsHookEx(int idHook,
        LowLevelKeyboardProc lpfn, IntPtr hMod, uint dwThreadId);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool UnhookWindowsHookEx(IntPtr hhk);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode,
        IntPtr wParam, IntPtr lParam);

    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr GetModuleHandle(string lpModuleName);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T17:49:02.653

不确定这在 C# 中是否可用，但您可以调用[GetAsyncKeyState](http://msdn.microsoft.com/en-us/library/ms646293(VS.85).aspx)。此方法返回调用该方法时键的状态。

要从 C# 调用它，您需要像使用任何其他 Win32 API 一样使用互操作。

# c# - 传入 到 GetEnum 的方法 叫做

> ID：570578
> 
> 赞同：0
> 
> 时间：2009-02-20T17:44:13.417
> 
> 标签：c#, ienumerable

我正在使用一个 API，它有一个返回的对象`IEnumerable<T>`，所以类似于 `Object.GetEnum<T>`.

我有一个方法，其中将调用 GetEnum，但我想向方法的参数添加传递参数类型的能力。所以例如我想做：

```
private void myMethod(apiClass???  apiclass)  
{
IEnumerable< itemType > enumX = ObjectGetEnum< itemType >
}
private void Main()
{
    myMethod(apiClass1);
    myMethod(apiClass2);
} 
```

所以如上所述我不知道myMethod中的参数类型应该是什么，也不知道如何编写获取枚举器的代码。我尝试传递“apiClass”，即 apiClass1 和 apiClass2 继承自的类。但是后来被困在那里做什么......而且我认为无论如何这都行不通。

所以我不确定我是否只是不知道如何在 C# 中做到这一点，或者是否有可能，......。或者我在 API 中遗漏了一些东西（或者 API 遗漏了一些东西来促进这一点）。

谢谢 FKC

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T17:49:58.533

好的，尽管我想澄清这个问题，但我将对此进行尝试。我怀疑你只需要使方法通用：

```
private void MyMethod<TItem>() where TItem : ApiClass
{
    IEnumerable<TItem> enumX = ObjectGetEnum<TItem>();
}

private static void Main()
{
    MyMethod<ApiClass1>();
    MyMethod<ApiClass2>();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T17:54:08.133

您是否尝试在方法内访问封闭构造类型的类型参数？也许这样的事情会起作用：

```
using System;

class Foo<T> { }

class Program
{
    static void Main()
    {
        myMethod(new Foo<String>());
    }

    private static void myMethod<T>(Foo<T> foo)
    {
        // use the T parameter in here
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T17:54:46.743

你需要这样的东西：

```
private void myMethod<T>()
{
    IEnumerable<T> enumX = ObjectGetEnum<T>();
} 
```

# moss - SharePoint 导航菜单 - 多级

> ID：570581
> 
> 赞同：2
> 
> 时间：2009-02-20T17:44:46.127
> 
> 标签：moss, navigation, telerik

我正在考虑将一些 Telerik 组件集成到我们的 MOSS 安装中。我想我会用一块石头杀死几只鸟，然后先在导航菜单上工作。

我对 SharePoint 有点陌生，并且对其中的一些奇怪之处有所了解。

我们对导航菜单有一些要求：

*   安全修整
*   多级导航

据我所知，似乎没有办法在不使用 SharePoint 开箱即用的导航设置的情况下进行安全调整。我错了吗？

有没有办法让这些导航设置的深度超过两个级别？

### 编辑

*   我正在使用全球导航，位于`/ > Site Settings > Modify Navigation`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-09T19:40:17.353

Savageguy 在数据源上修改它是正确的，例如：

```
<PublishingNavigation:PortalSiteMapDataSource 
    ID="MainNavigationDataSource" 
    runat="server" 
    EnableViewState="true"
    SiteMapProvider="GlobalNavSiteMapProvider"
    StartingNodeOffset="0" 
    ShowStartingNode="false" /> 
```

然后您可以使用任何类型的控件（数据绑定）来呈现您的菜单。我正在为我的菜单使用中继器：

```
<asp:Repeater runat="server" ID="MenuRepeater" 
DataSourceID="MainNavigationDataSource"> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T17:23:47.873

没有使用 Telerik 控件。

我怀疑您应该能够使用基本属性来完成此操作，例如 StaticDisplayLevels="2" ，其中 2 是您想要的数字。

我相信将在控件使用的数据源上处理安全性。

同样，我没有使用 Telerik 控件，所以我确信它有点不同，查看此控件的产品信息似乎是弄清楚您需要调整哪些属性的问题。必须有一些文档吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T08:13:35.803

您不需要使用除 SharePoint 菜单以外的任何其他组件，但您必须在 body 标记中添加一小段脚本：

<body onload="javascript:if (typeof(_spBodyOnLoadWrapper) != 'undefined') _spBodyOnLoadWrapper();">

# c# - 用鼠标移动图片框

> ID：570582
> 
> 赞同：2
> 
> 时间：2009-02-20T17:44:52.180
> 
> 标签：c#, winforms, picturebox, onmousemove

我正在为 windows mobile (Compact Framework 2.0) 开发一个应用程序。它有一个带有 PictureBox 的 WinForms。

我想移动PictureBox的图像但我不知道怎么做所以我选择移动PictureBox的孔。

为此，我使用此事件：

```
private void imagenMapa_MouseMove(object sender, MouseEventArgs e)
{
      imagenMapa.Left = e.X;
      imagenMapa.Top = e.Y;
      this.Refresh();
} 
```

但是当我移动 PictureBox 时，它会闪烁并到处移动。

我做错了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T17:57:37.953

和是相对于图片框的（例如，如果鼠标在图片框的左上角，则为 0,0）`e.X`。`e.Y`

`imagenMapa.Left`和的值`imagenMapa.Top`相对于表单（或任何控件包含`imagenMapa`）

如果您尝试混合来自这两个系统的值而不进行转换，您将会得到跳跃（就像您所看到的那样）。

您最好将鼠标位置转换为包含图片框的事物所使用的相同坐标系。

您可以使用[`imagenMapa.PointToScreen`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.pointtoscreen.aspx)在屏幕坐标中获取鼠标坐标（或[`Cursor.Position`](http://msdn.microsoft.com/en-us/library/system.windows.forms.cursor.position.aspx)直接获取位置），并将[`yourForm.PointToClient`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.pointtoclient.aspx)它们返回到表单坐标中。

请注意，根据您的需要，您可以通过覆盖/处理控件的[`Paint`事件](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.paint.aspx)并自己绘制图像来完成“在控件中移动图像”。如果你这样做了，你可以把所有的东西都保存在图片框坐标中，因为当你调用[`graphicsObject.DrawImage`](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.drawimage.aspx).

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-02-01T06:49:04.847

实际代码（需要 .NET Framework 3.5 及更高版本，不确定在 Compact Framework 中是否可用）...

```
// Global Variables
private int _xPos;
private int _yPos;
private bool _dragging;

// Register mouse events
pictureBox.MouseUp += (sender, args) =>
{
    var c = sender as PictureBox;
    if (null == c) return;
    _dragging = false;
};

pictureBox.MouseDown += (sender, args) =>
{
    if (args.Button != MouseButtons.Left) return;
    _dragging = true;
    _xPos = args.X;
    _yPos = args.Y;
};

pictureBox.MouseMove += (sender, args) =>
{
    var c = sender as PictureBox;
    if (!_dragging || null == c) return;
    c.Top = args.Y + c.Top - _yPos;
    c.Left = args.X + c.Left - _xPos;
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T17:58:12.133

eX & eY 在pictureBox 的坐标空间，imagenMapa.Left & imagenMapa.Top 在Form 的坐标空间。:-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T19:10:02.773

另外不要忘记将表单设置为双缓冲，这可能有助于闪烁，但对于它的实际定位，我喜欢 Daniel L 的建议

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-19T00:06:21.183

拥抱数学！

```
control.Left = control.Left - (_lastMousePos.X - currentMousePos.X);
control.Top = control.Top - (_lastMousePos.Y - currentMousePos.Y); 
```

快速解释：您从鼠标位置获得差异并将其应用于您要移动的对象。

示例：如果旧鼠标 X 位置是 382，而新鼠标 X 位置是 385，则差值为 -3。如果控件当前 X 位置为 10，则 10 - (-3) = 13

为什么：它适用于任何事情，并且比不断地来回转换坐标便宜得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-02-08T10:23:39.333

其实你所做的是正确的。但是您将 MouseMove 属性赋予了图片框。您应该将该属性提供给表单（背景）。

前任：

```
private void Form1_MouseMove(object sender, MouseEventArgs e)
{
  imagenMapa.Left = e.X;
  imagenMapa.Top = e.Y;
} 
```

# windows - 32 位进程能否在 64 位 Windows 操作系统上访问更多内存？

> ID：570589
> 
> 赞同：8
> 
> 时间：2009-02-20T17:45:57.170
> 
> 标签：windows, process, 64-bit

据我了解，在没有 /3GB 开关的情况下，32 位进程只能在 32 位 Windows 上访问 2 GB 内存，并且操作系统出于自身的恶魔原因占用了其中的一些内存。这似乎与我的经验相吻合，因为我们有一个应用程序在达到大约 1.2 - 1.5 GB 的 RAM 时崩溃，没有内存异常，即使仍有大量可用内存。

将这个 32 位应用程序移动到 64 位 Windows 上是否允许它现在可以访问超过 1.5 GB 的空间？应用程序本身是否必须升级到 64 位？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T17:54:26.277

较新版本的 Visual Studio 有一个新标志，它使 32 位应用程序“感知大地址空间”。基本上它的作用是说，如果它加载到 64 位版本的 Windows 上，那么它将获得 4GB（32 位指针的限制）。这肯定比您在 32 位版本的 Windows 上获得的 2 或 3 GB 更好。请参阅[http://msdn.microsoft.com/en-us/library/aa366778.aspx](http://msdn.microsoft.com/en-us/library/aa366778.aspx)：

最值得注意的是它说：

> 内存和地址空间的限制因平台、操作系统以及 LOADED_IMAGE 结构的 IMAGE_FILE_LARGE_ADDRESS_AWARE 值和 4 GB 调整 (4GT) 是否正在使用而异。使用 /LARGEADDRESSAWARE 链接器选项设置或清除 IMAGE_FILE_LARGE_ADDRESS_AWARE。

另请参阅：http: [//msdn.microsoft.com/en-us/library/wz223b1z.aspx](http://msdn.microsoft.com/en-us/library/wz223b1z.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T18:01:10.940

是的，在适当的情况下，Windows 上的 32 位进程可以访问完整的 4GB 内存，而不是通常限制的 2Gb。

为此，您需要以下内容：

*   该应用程序必须在 64 位操作系统上运行
*   必须使用 /LARGEADDRESSAWARE 标志编译应用程序。
*   应测试该应用程序以确保它在这种情况下确实可以正常工作。;)（具体来说，依赖于所有指向 2GB 边界以下地址的指针的代码显然在这里不起作用）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T17:50:12.217

您的应用程序将受到指针大小的限制，在您的示例中为 32 位。

如果您的应用程序要访问更多内存，那么您将需要某种分段内存架构，就像我们在 16 位时代使用的应用程序使用 16 位指针和偏移量来访问完整的 32 位内存空间一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T17:56:34.960

WOW64 允许在 64 位 Windows 上使用 32 位 Windows 应用程序，将 32 位指针转换为真正的 64 位指针。实际上 32 位寻址应该允许访问 4GB 的内存。

# javascript - 可能是一个快速：在 .innerHTML 调用中转义问题（我认为）

> ID：570591
> 
> 赞同：1
> 
> 时间：2009-02-20T17:46:25.640
> 
> 标签：javascript, internet-explorer-7, innerhtml

设置：

我有一个 Suckerdiv 菜单，其中包含调用函数的链接。所述功能如下所示：

```
function F(string)
{
    var s = '';
    var c = '';
    var t = '';
    if(string == 'cat')
    {
        s = "cat";
        c = "animal";
        t = "fluffy";
    }
   // ...
    document.getElementById("title").innerHTML = t;
    document.getElementByID("category").innerHTML = c;
    document.getElementByID("description").innerHTML = s;
} 
```

工作正常。但是，在实际实现中，description 变量中带有一点点 HTML，似乎是在甩 IE。Firefox 处理得很好，但如果我有，说，

```
c = 'Stuff<br><ul><li>listed stuff</li><li>more listed stuff</li><li>some more listed stuff</li></ul><br>bla bla<br>bla'; 
```

然后 IE 抛出一个未知的运行时错误并在我单击该特定链接时死掉。

上面的三个 ID 是嵌套在表中的 div，如下所示：

```
<table border=1>
<tr><td><div id="title"></div></td></tr>
<tr><td><div id="category"></div></td></tr>
<tr><td><div id="description"></div></td></tr>
</table> 
```

我知道表格本身在 IE 中是只读的，但我也知道 TD 不是。标题和类别都可以正常工作，所以我认为它与该字符串中的 html 有关。我应该逃避其中的一部分吗？我尝试用 < 等 html 转义代码填充它，但它只是没有评估 HTML，我留下了一堆难看的文本。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:54:36.070

嗬！

抱歉浪费了你们的时间，伙计们——事实证明这完全不相关。由于 div 的 id，这条线断了；由于页面中间的 HTML 嵌套在内容管理系统生成的包含 div 中，显然页面中的其他地方还有另一个 div。将“div id=description”更改为“div id=dynDescription”解决了它。

不过，感谢您的回答！绝对赞赏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T17:56:10.500

我只能猜测您可能想尝试自动关闭您的 BR 标签：`<br />`

当您使用像[Prototype](http://prototypejs.org)或[jQuery](http://jquery.com/)这样的库进行 DOM 操作时，这种情况通常会消失。通常在内部考虑浏览器怪癖。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T18:11:36.033

我创建了以下测试用例：

```
<html><head></head><body>
<script type="text/javascript">
function F(str) {
  var s = '';
  var c = '';
  var t = '';
  if (str == 'cat') {
    s = "cat";
    // c = "animal";
    c = 'Stuff<br><ul><li>listed stuff</li><li>more listed stuff</li><li>some more listed stuff</li></ul><br>bla bla<br>bla';
    t = "fluffy";
  }
  // ...
  document.getElementById("title").innerHTML = t;
  document.getElementById("category").innerHTML = c;
  document.getElementById("description").innerHTML = s;
}
</script>
<table border="1">
<tr><td><div id="title"></div></td></tr>
<tr><td><div id="category"></div></td></tr>
<tr><td><div id="description"></div></td></tr>
</table>
<form><input type="button" onclick="F('cat');"></form>
</body></html> 
```

它似乎在 Internet Explorer 7 中正常工作。您确定没有您正在做的事情`// ...`导致您的错误吗？您是否确认 Internet Explorer 7 的每个副本都会发生这种情况（您的副本可能有附加组件、损坏或过时的组件或不正确的注册表项导致您看到的错误）。您是否将问题缩小到使用如上所示的简单而简洁的代码示例将字符串分配给 innerHTML？

# .net - 手动创建未绑定的数据网格

> ID：570600
> 
> 赞同：2
> 
> 时间：2009-02-20T17:48:31.500
> 
> 标签：.net, wpf, windows

谁能告诉我是否可以创建数据并将数据添加到未绑定的 WPF Toolkit 数据网格。

如果实际上可以做到，有人可以提供以下示例：

以编程方式： 创建 datagrid 创建 datagridtextcolumn 将 datagridtextcolumn 添加到 datagrid 创建 datagridrow 将 datagridtextcolumn 的文本设置为“测试” 将 datagridrow 添加到 datagrid

我想创建一个未绑定的数据网格。我的原因是我想创建一个模板列，其中包含多个不同类型和编号的控件 - 2 个复选框、4 个单选按钮、5 个复选框等 - 在运行时动态添加，并且由于类型和编号未知，所以无法想到一种数据绑定它们的方法。我很高兴不受约束地工作。

先感谢您！

**[编辑：我还没有找到这个问题的合适答案并开始赏金]**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:24:04.800

我从来没有使用网格而不将其绑定到某些东西。

***但是***看看根本原因，可以在仍然使用数据绑定的同时解决这个问题。

例如：如果您为网格绑定到的对象使用 ViewModel 类，那么您可以使该类的一个方面成为各种控件的可见性设置器。

在对象中，您将拥有以下内容：

```
Public ReadOnly Property CheckboxAVisibility As Windows.Visibility
   Get
     ' Do Logic 
     Return Visiblity 
   End Get
End Property 
```

在 XAML 中你会这样做：

```
<CheckBox IsChecked="{Binding IsBoxAChecked}" Visibility={Binding CheckboxAVisibility}" /> 
```

这也使事情变得更容易，因为您将能够通过修改行内的其他控件来修改各种控件的可见性（例如：取消选中 CheckboxA 会导致 RadioButtons B、C 和 D 出现）。

第二个选项是在网格中仅列出“标题”信息，当用户双击一行时，您将在辅助面板或窗口中显示具有可编辑方面的编辑器（类似于 MVC 编辑的工作方式）。

**由于评论而编辑**

这是另一个建议，而不是数据网格，使用 StackPanel。对于您需要的每一行，您可以添加一个网格面板或堆栈面板或类似的东西，在运行时根据您的规则创建。例如：

XAML：

```
<StackPanel Name="stkItems" Orientation="Vertical" /> 
```

代码：

```
Public Sub AddItems(dt as DataTable)
   For Each row As DataRow in dt.Rows
     Select Case row("Which")
          Case 1:
             Dim i As New Checkbox
             i.Content = "Foo"
             i.IsChecked = row("Content")
             stkItems.Children.Add(i)
          Case 2:
              Dim i as New TextBox
              i.Text = row("Content")
              stkItems.Children.Add(i)
     End Select
   Next
End Sub 
```

这是高度简化的，你可以做一些事情，比如有你可以使用的预定义用户控件，或者只是将一堆控件构建到一个以编程方式定义的容器中，然后将其添加到 StackPanel

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T23:39:15.987

您可以使用将创建所需控件的 UserControl。

Window1.xaml（片段）

```
<dg:DataGrid ItemsSource="{Binding}" CanUserAddRows="False" AutoGenerateColumns="False">
    <dg:DataGrid.Columns>

       <dg:DataGridTemplateColumn Header="Test" MinWidth="100">
            <dg:DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                    <my:ControlA Foo="{Binding}"></my:ControlA>
                </DataTemplate>
            </dg:DataGridTemplateColumn.CellTemplate>
        </dg:DataGridTemplateColumn>

    </dg:DataGrid.Columns>
</dg:DataGrid> 
```

Window1.xaml.cs

```
public partial class Window1 : Window
{
    List<Foo> _items = new List<Foo>();

    public Window1()
    {
        InitializeComponent();

        _items.Add(new Foo { CheckBoxCount = 2, TextBoxCount = 1 });
        _items.Add(new Foo { CheckBoxCount = 3, TextBoxCount = 0 });

        DataContext = _items;
    }
} 
```

控制A.xaml

```
<UserControl x:Class="Demo.ControlA"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <StackPanel x:Name="_placeHolder">
    </StackPanel>
</UserControl> 
```

控制A.xaml.cs

```
public partial class ControlA : UserControl
{
    public ControlA()
    {
        InitializeComponent();

        Loaded += new RoutedEventHandler(ControlA_Loaded);
    }

    void ControlA_Loaded(object sender, RoutedEventArgs e)
    {
        if (Foo != null)
        {
            for (int it = 0; it < Foo.CheckBoxCount; it++)
                _placeHolder.Children.Add(new CheckBox());

            for (int it = 0; it < Foo.TextBoxCount; it++)
                _placeHolder.Children.Add(new TextBox());
        }
    }

    public static readonly DependencyProperty FooProperty =
        DependencyProperty.Register("Foo", typeof(Foo), typeof(ControlA));

    public Foo Foo
    {
        get { return (Foo)GetValue(FooProperty); }
        set { SetValue(FooProperty, value); }
    }
} 
```

Foo.cs

```
public class Foo
{
    public int TextBoxCount { get; set; }
    public int CheckBoxCount { get; set; }
} 
```

希望这可以帮助。

**PS**应该可以将DataGridTemplateColumn[重构](https://stackoverflow.com/questions/705024/wpf-decomposition-datagridtemplatecolumn)为单独的UserControl。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-13T09:08:46.553

我创建了一个简单的 DataGridUnboundedColumn 类，它派生自 DataGridBoundColumn，可用于为单元格提供 FrameworkElement 的自定义文本。

您只需订阅 CellFormating 事件并将 EventArgs 中的 CellElement 设置为将要显示的自定义元素。也可以在 EventArgs 中仅设置 CellText - 在这种情况下，带有 CellText 的 TextBlock 将显示在网格中。

以下示例显示了如何使用它：

XAML：

```
<dg:DataGrid Name="DataGrid1" AutoGenerateColumns="False">
    <dg:DataGrid.Columns>
        <dg:DataGridTextColumn Header="Name" Binding="{Binding Path=Name}"/>
        <myColumn:DataGridUnboundedColumn x:Name="AddressColumn" Header="Address" />
    </dg:DataGrid.Columns>
</dg:DataGrid> 
```

代码：

```
 public MyPage()
    {
        InitializeComponent();

        AddressColumn.CellFormating += new UnboundedColumnEventHandler(AddressColumn_CellFormating);
    }

    void AddressColumn_CellFormating(object sender, UnboundedColumnEventArgs e)
    {
        IPerson person;

        person= e.DataItem as IPerson;

        if (person!= null)
            e.CellText = string.Format("{0}, {1} {2}", person.Address, person.PostalCode, person.City);
    } 
```

DataGridUnboundedColumn 实现在这里：

```
class DataGridUnboundedColumn : DataGridBoundColumn
{
    public event UnboundedColumnEventHandler CellFormating;

    public DataGridUnboundedColumn()
    {
        this.IsReadOnly = true;
    }

    protected override FrameworkElement GenerateEditingElement(DataGridCell cell, object dataItem)
    {
        return null;
    }

    protected override FrameworkElement GenerateElement(DataGridCell cell, object dataItem)
    {
        FrameworkElement shownElement;
        UnboundedColumnEventArgs eventArgs;

        if (CellFormating == null)
            return null;

        eventArgs = new UnboundedColumnEventArgs(cell, dataItem);

        // call the event
        CellFormating(this, eventArgs);

        shownElement = null;

        // check the data set in the eventArgs
        if (eventArgs.CellElement != null)
        {
            // show the set eventArgs.CellElement
            shownElement = eventArgs.CellElement;
        }
        else if (eventArgs.CellText != null)
        {
            // show the CellText in TextBlock
            TextBlock textBlock = new TextBlock();
            textBlock.Text = eventArgs.CellText;

            shownElement = textBlock;
        }
        else
        {
            // nothing set
        }

        return shownElement;
    }
}

public delegate void UnboundedColumnEventHandler(object sender, UnboundedColumnEventArgs e);

public class UnboundedColumnEventArgs : EventArgs
{
    public DataGridCell Cell { get; set; }
    public object DataItem { get; set; }

    /// <summary>
    /// The subscriber of the event can set the CellText.
    /// In this case the TextBlock is used to display the text.
    /// NOTE that if CellElement is not null, the CellText will not be used but insted a CellElement will be shown
    /// </summary>
    public string CellText { get; set; }

    /// <summary>
    /// The subscribed can set the FrameworkElement that will be shown for this cell.
    /// If the CellElement is null, the CellText will be used to show the TextBlock
    /// </summary>
    public FrameworkElement CellElement { get; set; }

    public UnboundedColumnEventArgs()
        : base()
    { }

    public UnboundedColumnEventArgs(DataGridCell cell, object dataItem)
        : base()
    {
        Cell = cell;
        DataItem = dataItem;
    }
} 
```

# jquery - jQuery FlyDown/FlyUp 菜单子容器

> ID：570604
> 
> 赞同：0
> 
> 时间：2009-02-20T17:49:23.450
> 
> 标签：jquery, menu, containers

我想知道是否有人可以为我提供使用 jQuery 创建菜单的指南，该指南类似于 Telerik 的 MultiColumn RadMenu ( [http://demos.telerik.com/aspnet-ajax/menu/examples/multicolumnmenu/defaultcs. .aspx](http://demos.telerik.com/aspnet-ajax/menu/examples/multicolumnmenu/defaultcs.aspx)）。我迫切希望完成这项工作，而且我不想花一大笔钱买一个组件套件。我正在使用 jQuery 的 hover(); 功能，但菜单容器由于某种原因不想滑回。

提前谢谢你！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T18:19:34.530

***这是为了点击***

```
<script type="text/javascript">
    $(document).ready(function() {

        $(".subMenu").hide();

        $(".btnJQUERYSubMenu").click(function() {
            $(this).next(".subMenu").slideToggle("fast");
            $(this).toggleClass("active");
            return false;
        });
    });
</script> 
```

***这是 mouserover 和 mouseout 的另一个脚本***

```
<script type="text/javascript">
        $(document).ready(function() {

            $(".subMenu").hide();

            $(".btnJQUERYSubMenu").mouseover(function() {
                $(this).next(".subMenu").slideToggle("fast");
                $(this).toggleClass("active")
            }).mouseout(function() {
                $(this).next(".subMenu").slideToggle("fast");
                $(this).toggleClass("active")
            });

            $(".subMenu").mouseout(function() {
                $(this).slideToggle("fast"); // or you can user hide instead of slideToogle. Something happens to css it might be about that i have css classes on testing
            });
        });
    </script>

<ul class="menu-panel">
    <li>
        <asp:HyperLink  runat="server" Text="Home"></asp:HyperLink>
    </li>
    <li>
        <asp:HyperLink ID="lnkSideMenuEstates" runat="server" Text="Estates" ></asp:HyperLink>
    </li>        
    <%--SubMenu--%>
    <li>
        <asp:HyperLink runat="server" Text="About Us" CssClass="btnJQUERYSubMenu plus" NavigateUrl="#"></asp:HyperLink>
        <div class="subMenu">
            <ul class="menu-panel paddingleft10">
                <li>
                    <asp:HyperLink runat="server" Text="Who are we"></asp:HyperLink>
                </li>                   
           </ul>
        </div>
    </li>
</ul> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:00:48.180

查看 jQuery 的 UI 工具。鉴于您使用 Telerik，我猜您使用 ASP.NET 或他们的 MVC 东西。MS 正在寻求将 jQuery 集成到他们的东西（ASP.NET AJAX 框架）中，因此熟悉整个 she-bang 会有所回报。Accordion 小部件或幻灯片效果可能正是您正在寻找的。

补充：在实验分支中有一个菜单 ui 小部件，但现在，你会被困住自己滚动。

添加：这是一个插件（[jdMenu](http://jdsharp.us/jQuery/plugins/jdMenu/)或[droppy](http://onehackoranother.com/projects/jquery/droppy/#)），如果您更喜欢那条路。

# c# - 处理 HttpListener 时基本身份验证如何工作？

> ID：570605
> 
> 赞同：0
> 
> 时间：2009-02-20T17:49:47.363
> 
> 标签：c#, authentication, windows-services, authorization, webdav

这似乎是一个基本问题，回到 Http 协议 101。但我很难理解基本身份验证的工作原理。我正在实施一个 Windows 服务，并且需要它是安全的。我想获取用户名和密码并对用户进行身份验证以访问自定义用户存储。我还想尽量减少登录调用的次数，因为登录调用代表对我们 SQL 服务器的调用。到目前为止我已经开始是这样的：

在我看来，UserAuthorized 函数必须进行我的自定义登录调用。但是，我不想每次都这样做。如果您已登录，基本身份验证是否会保持，或者是否有我应该探索的缓存线程安全解决方案。

哦，是的，我还想这样做，以便当用户通过身份验证并在线程中创建和维护对象时，侦听器可以在用户/连接的后续回调中引用。但由于 ListenerCallback 是静态的，我不确定如何实现。

在此先感谢您的帮助，我非常感谢它和 StackOverflow。

```
public void ThreadProc() {
    string uriPrefix = ConfigurationManager.AppSettings["ListenerPrefix"];
    HttpListener listener = new HttpListener();
    listener.Prefixes.Add(uriPrefix);
    listener.AuthenticationSchemes = AuthenticationSchemes.Basic;

    listener.Start();

    Console.WriteLine("Start listening on " + uriPrefix);
    Console.WriteLine("Press Control-C to stop listener...");

    while (listening) {
        IAsyncResult result = listener.BeginGetContext(new AsyncCallback(ListenerCallback), listener);
        result.AsyncWaitHandle.WaitOne();
    }
}

public static void ListenerCallback(IAsyncResult result) {
    HttpListener listener = (HttpListener)result.AsyncState;
    HttpListenerContext context = listener.EndGetContext(result);
    WebDavEngine engine = new WebDavEngine(context.User);

    context.Response.SendChunked = false;
    FileLogger.Level = LogLevel.Debug;

    engine.IgnoreExceptions = false;

    if (UserAutorized(context)) {
        try {
            engine.Run(context, listener.Prefixes);
            engine.CommitTransaction();
        } catch {
            engine.RollBackTransaction();
        } finally {
            engine.CloseConnection();
        }
    } else
        context.Response.StatusCode = 401;

    if (context.Response.StatusCode == 401)
        ShowLoginDialog(context, context.Response);

    try {
        context.Response.Close();
    } catch {
        // client closed connection before the content was sent
    }
}

private static bool UserAutorized(HttpListenerContext context) {
    HttpListenerBasicIdentity identity = (HttpListenerBasicIdentity)context.User.Identity;

    if (!identity.IsAuthenticated) {
        string username = identity.Name;

        // workaround for Windows Vista Basic authentication. User name may be submitted in the following format: Machine\User.
        int ind = username.LastIndexOf('\\');
        if (ind > 0)
            username = username.Remove(0, ind + 1);

        Console.WriteLine("Trying Authentication since identity is NOT authenticated");

        return false;
    } else {
        Console.WriteLine("identity.IsAuthenticated: " + identity.IsAuthenticated.ToString());
        return identity.IsAuthenticated;
    }            
} 
```

**编辑：**仅针对文档+1，这让我真正了解了身份验证方案及其工作原理。除非我准备好这个错误，否则似乎摘要方案可能能够维持“会话”或至少过期以重试我的自定义身份验证。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T17:52:17.717

[HTTP Basic](http://www.faqs.org/rfcs/rfc2617.html)在每个请求中都需要登录凭据。HTTP 没有任何会话的概念，因此您无法真正判断某人是否“已经登录”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T06:22:16.537

感谢您的规范，我很感激。我确实设法解决了我的问题，它与规范无关，而是设计/托管问题。

# sharepoint - Sharepoint 数据库服务器重命名

> ID：570625
> 
> 赞同：1
> 
> 时间：2009-02-20T17:56:36.443
> 
> 标签：sharepoint, sharepoint-2007, moss

我有一个应用程序服务器和一个数据库服务器我已经在应用程序服务器上安装了 MOSS，它的内容数据库在数据库服务器上。由于政策原因，我不得不重命名 Sharepoint 数据库服务器

现在的问题是MOSS 不工作。那么我如何使其工作是 stsadm 命令 renameserver 但那是更改主机名

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:25:27.153

进入 Central Admin，然后在 Content Databases 下，从 Web 应用程序中删除数据库。不幸的是，您无法使用 Central Admin 重新附加内容数据库，因此您需要使用 stsadm。这是命令：

```
STSADM –o addcontentdb –url <URL name> -databasename <database name> -databaseserver <database server name> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T16:55:27.283

你在找这个命令吗？？

[stsadm -o setconfigdb](http://technet.microsoft.com/en-us/library/cc261712.aspx)

当数据库服务器被重命名或者你想将 MOSS 连接到其他配置数据库时，你必须使用它。

如果要重命名应用程序数据库，您必须使用“stsadm -o addcontentdb”来完成，就像之前的回答所说的那样。

# javascript - myHandler 函数是如何工作的？

> ID：570635
> 
> 赞同：1
> 
> 时间：2009-02-20T18:00:07.497
> 
> 标签：javascript, yui

你最喜欢的法语又回来了^^ 我有一个小问题。

在 YUI 示例中，此函数允许获取信息，我不确定 myHandler 所做的参考是什么：

```
var myHandler = function(sType, aArgs){
            myAC = aArgs[0]; // reference back to the AC instance
            elLI = aArgs[1]; // reference to the selected LI element
            oData = aArgs[2]; // object literal of selected item's result data
            } 
```

有人可以举例说明（如果可能的话）myAC、elLI、oData 的对应关系吗？这个功能是如何工作的？(sType, aArgs) ? 迈克？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:48:04.583

法比恩，

您正在查看为处理 YUI AutoComplete 中的特定自定义事件而编写的处理程序函数。The event is the itemSelectEvent ( [http://developer.yahoo.com/yui/docs/YAHOO.widget.AutoComplete.html#event_itemSelectEvent](http://developer.yahoo.com/yui/docs/YAHOO.widget.AutoComplete.html#event_itemSelectEvent) ), which fires when an item in the AutoComplete list is selected. 如果您为该事件订阅了一个函数——例如，上面代码片段中的 myHandler——您的函数将在任何时候被选择一个项目时被调用，并且它将被传递给您记录的参数。

YUI 网站上的这个示例向您展示了如何使用 itemSelectEvent：

[http://developer.yahoo.com/yui/examples/autocomplete/ac_itemselect.html](http://developer.yahoo.com/yui/examples/autocomplete/ac_itemselect.html)

如果您还有其他问题，请告诉我。

问候， 埃里克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T20:28:37.670

谢谢埃里克，

您指向我想引用的示例（[http://developer.yahoo.com/yui/examples/autocomplete/ac_itemselect.html](http://developer.yahoo.com/yui/examples/autocomplete/ac_itemselect.html)）。紧接着，在示例中，我们有：

```
// update hidden form field with the selected item's ID
myHiddenField.value = oData.id; 
```

oData.id 定义了 myHiddenField.value，但是在示例中定义 (myAC = aArgs[0];) 和 (elLI = aArgs[1];) 是什么？我不明白，这个 myAC 和 elLI 示例中的实用程序是什么？aArgs[0], aArgs[n] ... 是如何工作的？

我同时学习 javascript 和 yui，有时我失去了我的拉丁语（或英语）。你在网上还有其他例子吗？

# python - 检测 Python 模块何时卸载

> ID：570636
> 
> 赞同：10
> 
> 时间：2009-02-20T18:00:23.297
> 
> 标签：python

我有一个模块，它使用 ctypes 将静态库中的一些功能包装到一个类中。当模块加载时，它会调用静态库中的初始化函数。当模块被卸载时（可能是解释器退出时），库中有一个我想调用的卸载函数。我怎样才能创建这个钩子？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-20T18:19:37.480

使用[atexit](http://docs.python.org/library/atexit.html)模块：

```
import mymodule
import atexit

# call mymodule.unload('param1', 'param2') when the interpreter exits:
atexit.register(mymodule.unload, 'param1', 'param2') 
```

文档中的另一个简单示例，[`register`](http://docs.python.org/library/atexit.html#atexit.register)用作装饰器：

```
import atexit

@atexit.register
def goodbye():
    print "You are now leaving the Python sector." 
```

# javascript - Javascript 无法按名称找到 Div 元素

> ID：570641
> 
> 赞同：1
> 
> 时间：2009-02-20T18:01:23.170
> 
> 标签：javascript, html

这段代码昨天让我感到惊讶，我很好奇发生了什么。

如果我引用我知道在表单中的页面上的 Div 元素，即使复制/粘贴确切的名称，使用 getElementsByName 以下也找不到它。

```
var coll = document.getElementsByName("txtState"); //coll will be null 
```

如果我得到页面上的所有 Div 标签并遍历它们查看 name 属性，我可以找到正确的 Div 元素。

```
var coll = document.getElementsByTagName("Div");
for (var i = 0; i < coll.length; i++) {
    var el= coll[i];
    if (el.name != null) {
        if (el.name.length > 0) {
            if (el.name == "txtState") {
                alert("Found");
            }
        }
    }
} 
```

那么这是什么一回事？为什么 Javascript 对获取特定元素视而不见？为什么我必须遍历集合？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-20T18:07:51.440

从[这里](http://www.aglasshalffull.org/css-resources/Using-getElementsByTagName-and-getElementsByName.htm)：

*在我们继续之前，我们应该消除一些书籍和互联网上的一些错误信息：与某些人所说的相反，根据 W3C HTML，没有合法的方式使用 div 或 span 等标签中的 name 属性4.01 规格。您必须将此属性的使用限制在 input、img、frame、iframe、form、map、param、meta、object、A、select、applet、textarea 或 button 等标签上。*

因此，“name”不是 div 的有效属性，这就是 getElementsByName 不起作用的原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T18:23:59.683

我一直依赖使用 getElementById('SomeId') 并确保设置了 DIV 标记的 ID 属性。

用你的 DIV 试试这个，它应该可以解决你的 javascript 问题。

# html - HTML 选择框的高度（下拉菜单）

> ID：570642
> 
> 赞同：89
> 
> 时间：2009-02-20T18:02:12.233
> 
> 标签：html, html-select

有人可以确认**无法**更改单击选择框时显示的下拉列表的高度。

select 的 size 属性使它看起来像一个列表，CSS 中的 height 属性也没有多大用处。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-02-20T18:04:19.140

确认的。

下拉的部分设置为：

1.  显示所有条目所需的高度，或
2.  显示条目所需的高度`x`（使用滚动条查看剩余部分），`x`其中
    *   20 在 Firefox 和 Chrome
    *   IE 6、7、8 中的 30
    *   16 为 Opera 10
    *   14 为 Opera 11
    *   22 用于 Safari 4
    *   18 用于 Safari 5
    *   IE 5.0、5.5 中的 11
3.  在 IE/Edge 中，如果没有选项，则会出现 11 个空白条目的愚蠢高列表。

对于上面的 (3)，您可以在此[JSFiddle中看到结果](http://jsfiddle.net/c9Ltzwa5/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2017-05-09T07:16:45.640

**没有**。无法更改选择下拉菜单的高度，因为该属性是特定于浏览器的。

但是，如果您想要该功能，那么有很多选择。您可以使用引导程序`dropdown-menu`并定义它的`max-height`属性。像这样的东西。

```
$('.dropdown-menu').on( 'click', 'a', function() {
    var text = $(this).html();
    var htmlText = text + ' <span class="caret"></span>';
    $(this).closest('.dropdown').find('.dropdown-toggle').html(htmlText);
});
```

```
.dropdown-menu {
    max-height: 146px;
    overflow: scroll;
    overflow-x: hidden;
    margin-top: 0px;
}

.caret {
	  float: right;
    margin-top: 5%;
}

#menu1 {
    width: 160px; 
    text-align: left;
}
```

```
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<div class="container" style="margin:10px">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">Tutorials
    <span class="caret"></span></button>
    <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
      <li><a href="#">HTML</a></li>
      <li><a href="#">CSS</a></li>
      <li><a href="#">JavaScript</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">HTML</a></li>
      <li><a href="#">CSS</a></li>
      <li><a href="#">JavaScript</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">HTML</a></li>
      <li><a href="#">CSS</a></li>
      <li><a href="#">JavaScript</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">HTML</a></li>
      <li><a href="#">CSS</a></li>
      <li><a href="#">JavaScript</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">HTML</a></li>
      <li><a href="#">CSS</a></li>
      <li><a href="#">JavaScript</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">HTML</a></li>
      <li><a href="#">CSS</a></li>
      <li><a href="#">JavaScript</a></li>
      <li><a href="#">About Us</a></li>
    </ul>
  </div>
</div>
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-05-04T15:38:23.047

我一直在研究一个下拉替换 jquery 插件来解决这个问题。**在这篇文章中，就外观和功能**而言，它与原生下拉菜单几乎没有区别。

这是一个演示（也是下载链接）： http: [//programmingdrunk.com/current-projects/dropdownReplacement/](http://programmingdrunk.com/current-projects/dropdownReplacement/)

这是插件的项目页面：

~~[http://plugins.jquery.com/project/dropdownreplacement](http://plugins.jquery.com/project/dropdownreplacement)~~

(更新:) jquery 插件页面似乎不再工作。当他们开始工作时，我可能不会把我的插件放在他们的新网站上，所以请随意使用programmingdrunk.com链接进行演示/下载

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-21T07:42:47.570

其实你有点可以！不要为 javascript 烦恼...我只是在我正在制作的网站上停留在同一件事上，如果您在 CSS 中为标签增加“font-size”属性，那么它也会自动增加高度。琐碎，但它让我很困扰哈哈

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-19T21:43:00.253

这不是一个完美的解决方案，但它确实有效。

在选择标签中，包括以下属性，其中“n”是可见的下拉行数。

```
<select size="1" position="absolute" onclick="size=(size!=1)?n:1;" ...> 
```

这个解决方案存在三个问题。1) 在第一次鼠标单击期间显示的所有元素都会快速闪烁。2) 位置设置为“绝对” 3) 即使少于“n”个项目，下拉框仍然是“n”个项目的大小。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-12T13:04:43.747

**Chi Row**的答案是解决这个问题的一个不错的选择，但我在`onclick`论点中发现了一个错误。相反，将是：

```
<select size="1" position="absolute" onclick="size=(size!=1)?1:n;" ...> 
```

（并提到您必须将“ *n* ”替换为您需要的行数）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-23T16:24:26.343

我知道这不是更改高度的最佳做法`select`，但是有一个代码可能可以帮助您更改高度。

使用标签的`size`属性：`select`

```
<select onfocus='this.size=6;' onblur='this.size=6;' onfocusout='this.size=null;' onchange='this.size=6; this.blur();'>
    <option>Option 1</option>
    <option>Option 2</option>
    <option>Option 3</option>
    <option>Option 4</option>
    <option>Option 5</option>
    <option>Option 6</option>
    <option>Option 7</option>
    <option>Option 8</option>
    <option>Option 9</option>
    <option>Option 10</option>
    <option>Option 11</option>
    <option>Option 12</option>
    <option>Option 13</option>
    <option>Option 14</option>
    <option>Option 15</option>
</select>
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2020-05-20T05:29:53.813

你可以改变一个的高度。不要使用`height="500"`（只是一个示例数字）。使用风格。您可以使用`<style>`标签或只使用它：

```
<!DOCTYPE html>
<html>
<body>
  <select id="option" style="height: 100px;">
    <option value="1">Option 1
    <option value="2">Option 2
  </select>
</body>
</html> 
```

我强调变化：

```
 <select id="option" style="height: 100px;"> 
```

甚至更好...

```
style="height: 100px;"> 
```

你看到了吗？

有帮助就点个赞吧！

# sql - 管理 DBA 的生产更改/调整与开发人员的待处理 DB 更改脚本的合并

> ID：570650
> 
> 赞同：0
> 
> 时间：2009-02-20T18:04:12.697
> 
> 标签：sql, change-management

我们维护了一组更改脚本，当我们的 Web 应用程序发布时，这些脚本必须在数据库上运行。我们浪费了很多时间并且经历了一些难以保持更新的过程，但是，我们的 DBA 喜欢（正确地）调整实时系统上的存储过程和模式以保持系统性能。

每隔一段时间，我们就必须将补丁重新定位到当前模式和存储过程，然而，检​​测哪些更改可能会发生冲突并找出我们可能破坏哪些 DBA 更改是非常困难的。

其他人如何管理对实时数据库的更改需求以应对待处理的更改？

我们可以采取哪些流程来使此流程更加顺畅？

存储、管理我们的模式和应用我们/他的变更集的最佳方式是什么？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T18:11:01.183

DBA 不应该只在 prod 上调整 procs。他们还应该使用源代码控制并将更改放在其他环境中，以便其他进行更改的人知道它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T18:17:46.097

对数据库模式脚本进行任何和所有 DDL 更改，然后将其存储在您的源代码控制中。特别是您的 DBA 所做的更改 - 我建议在将您的基本架构和存储过程检查到您的源代码控制之前，由数据库开发人员和 DBA 检查（HLGEM 表示支持）。进入 prod 应该在应用之前编写脚本并获得批准（即，如果 DBA 发现需要更改的内容，让 DBA 打开缺陷并通过该过程进行处理）。

锁定所有此类 DDL 更改，远离您的开发人员。编写 Java 和 C# 的聪明人应该与您的团队数据库“专家”就如何最好地完成数据库方面的设计目标和需求进行沟通。

将生产调整限制在那些高度依赖情况的情况下，例如，许多 IT 商店都有一个 DBA，他将根据您的应用程序提供的数据库部署脚本定义物理存储设置，这通常是可以的。带有您的应用程序的向导可以帮助经验不足的人，以及设置和基本调整的前 10 项建议列表，这将大有帮助。

# .net - JScript.NET 能否区分不同的 .NET 异常类型

> ID：570652
> 
> 赞同：2
> 
> 时间：2009-02-20T18:04:31.057
> 
> 标签：.net, javascript, exception

我正在使用 JScript.NET 在我编写的 C# WinForms 应用程序中编写脚本。它工作得非常好，但我只是尝试在脚本中放置一些异常处理，我不知道如何判断我的 C# 代码中抛出了哪种类型的异常。

下面是一些示例 JScript 代码，它抛出两种不同类型的 CLR 异常，然后尝试捕获它们并将它们区分开来。

```
function ErrorTest(name)
{
    try
    {
        if (name.length < 5)
        {
            throw new ArgumentException();
        }else
        {
            throw new InvalidOperationException();
        }
    }catch (e)
    {
        return e.name + " " + (e.number & 0xFFFF) + ": " + e.message;
    }
} 
```

如果我打电话`ErrorTest("foo")`，我就回来`"Error 5022: Value does not fall within the expected range."`，如果我打电话`ErrorTest("foobar")`，我就回来`"Error 5022: Operation is not valid due to the current state of the object."`

name 和 number 属性是相同的，唯一的区别是消息。我不想根据错误消息开始编写错误处理逻辑，那么有什么方法可以获取原始异常而不是 JScript`Error`对象吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-30T07:28:55.273

使用 JScript .NET 的类型注释支持，如下所示：

```
 try { }
  catch (e : ArgumentException) {
    // ...
  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T00:14:08.327

[您可以使用ErrorObject.ToException 方法](http://msdn.microsoft.com/en-us/library/microsoft.jscript.errorobject.toexception.aspx)获取原始异常，然后使用`instanceof`它来决定如何处理它。

这行得通，但我还没有决定是否使用它。我认为这是在滥用框架，因为文档说：

> 此 API 支持 .NET Framework 基础结构，不打算直接从您的代码中使用。

此外，您必须添加对 Microsoft.JScript 程序集的引用并导入 Microsoft.JScript 命名空间。

这是新代码：

```
function ErrorTest(name)
{
    try
    {
        if (name.length < 5)
        {
            throw new ArgumentException();
        }else
        {
            throw new InvalidOperationException();
        }
    }catch (e)
    {
        var ex = ErrorObject.ToException(e);
        if (ex instanceof ArgumentException)
        {
            return "bad argument";
        }
        return "something bad";
    }
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-20T18:41:47.113

你应该能够做到：

```
function ErrorTest(name)
{
    try
    {
        if (name.length < 5)
        {
            throw new ArgumentException();
        }else
        {
            throw new InvalidOperationException();
        }
    }
    catch (ArgumentException e)
    {
        return "Argument Exception: " + e.message;
    }
    catch (InvalidOperationException e)
    {
        return "Operation Exception: " + e.message;
    }
    catch (e)
    {
        return "Unknown Exception: " + e.message;
    }
} 
```

并以这种方式对每种异常类型进行单独的错误处理。

# actionscript-3 - AS3 XML 和行间距问题

> ID：570656
> 
> 赞同：1
> 
> 时间：2009-02-20T18:06:38.323
> 
> 标签：actionscript-3

**背景：**我在 AS3 中构建这个照片库，当用户单击缩略图时，会显示从 XML 文件收集的文本。

**问题描述：**一切都在我的本地机器上运行得很好，但是当我将文件上传到服务器并从服务器预览站点时，描述文本上的行距与我在本地预览站点时的行距不同。

下面看两张图，这样你就可以看出区别

## 更正一项（从本地计算机预览）

[正确的间距 http://www.olemedia.net/lineSpacing1.jpg](http://www.olemedia.net/lineSpacing1.jpg)

## 不正确的一个（来自浏览器）

[不正确的间距 http://www.olemedia.net/lineSpacing2.jpg](http://www.olemedia.net/lineSpacing2.jpg)

解决方案：有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T16:29:43.817

这确实是一个换行问题，取决于您使用的平台，或者更确切地说。xml 文档是如何保存的。Windows 上的换行符是 \r\n （回车 + 换行）。如果我没记错的话。Flash 播放器将两者都解释为换行符。我通常会这样做：

```
var text:String = xml.whatever.text().split("\r").join(""); 
```

这将摆脱所有的\r（如果它们在那里），只留下\n。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:10:42.760

您的图片没有显示（我认为发布图片需要最低信誉），但根据描述，我猜您的本地计算机是 windows 而服务器是 unix。这可能是行尾是 \r\n 而不是 \n 的问题，大多数编辑器都可以为您进行此转换，或者有各种工具可以转换。

如果这不正确，请链接到图像，以便我们可以看到正在发生的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T18:42:51.340

我找到了解决方案。是 Flash CS4（mac 和 windows）的错误。

我将我的闪存文件放到 Linux 服务器和 Windows 服务器上。绝对是Windows服务器的问题。我不知道为什么，但确实如此。我正在使用 mac 工作，并且可能这也会影响您发布 swf 文件的服务器类型。

谢谢大家，非常感谢您的时间和奉献精神。

# groovy - 如何将 Groovy 字符串集合转换为 Java 字符串数组？

> ID：570659
> 
> 赞同：56
> 
> 时间：2009-02-20T18:06:59.350
> 
> 标签：groovy, collections

我正在尝试从 Groovy 类调用 Java 类的方法。Java 方法有一个字符串数组作为参数，我的 Groovy 类中有一个字符串集合。如何将 Groovy 集合转换为 Java 字符串数组？

Java方法：

```
public class SomeJavaClass{
  public void helpDoSomething(String[] stuff){

  }
} 
```

Groovy 代码

```
class SomeGroovyClass {
  def data = ["a", "b", "c"]

  def doSomething = {
    def javaClass = new SomeJavaClass()
    javaClass(data) //Groovy passes ArrayList, Java class expects String[] ???
  }
} 
```

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2009-02-20T18:32:38.947

正确地说，`def data = ["a","b","c"]`它是一个列表，而不是一个数组。

试着像这样投射：

```
def data = ["a","b","c"] as String[] 
```

# .net - .NET 大对象堆和 JSON 交互

> ID：570666
> 
> 赞同：1
> 
> 时间：2009-02-20T18:09:03.497
> 
> 标签：.net, asp.net, memory, fragmentation

我有一个使用 JSON 将数据序列化到客户端的 asp.net 应用程序。一旦负载达到一定水平，应用程序将在 GC 中花费大量时间，并且在使用 WinDbg/SOS 和相关工具一段时间后，由于生成的 JSON 的大小，似乎发生了大量 LOH 碎片通常大到足以超过 LOH 的 86K 边界。

我的问题是 2 倍 1) 有没有人运行这种 JSON 生成的特定场景会影响并导致 LOH 碎片和 2) 有没有人对如何处理它有任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:21:47.193

如果您要生成大量 > 85K 的字符串，那么无论如何这都是有问题的性能。

在将数据发送给客户端之前，您是否需要完全生成数据？如果您的 JSON 库支持将数据写入 Stream/TextWriter 并且客户端响应 api 支持它，我将简单地将一个链接到另一个完全解决问题。

如果你不能做到这一点，你可能不得不求助于对象池，这对字符串不起作用，你将不得不求助于 char[] 或 byte[] （A MemoryStream 将使这变得容易）并重用支持数组. 可能每个线程一个就足够了。您可能需要处理不常见的大规模响应导致底层数组膨胀然后被保留的情况。

# c++ - 在 C++ 中检查双精度（或浮点数）是否为 NaN

> ID：570669
> 
> 赞同：401
> 
> 时间：2009-02-20T18:09:53.290
> 
> 标签：c++, double, nan

有 isnan() 函数吗？

PS.：我在[MinGW](http://en.wikipedia.org/wiki/MinGW)（如果这有什么不同的话）。

我通过使用 isnan() from 解决了这个问题`<math.h>`，它在 中不存在`<cmath>`，我一开始是在`#include`ing 中。

* * *

## 回答 #1

> 赞同：383
> 
> 时间：2009-02-20T18:17:35.987

根据 IEEE 标准，NaN 值具有奇数特性，即涉及它们的比较*总是*错误的。也就是说，对于浮点数 f，*仅*当 f 为 NaN时才`f != f`为真。

 *请注意，正如下面的一些评论所指出的，并非所有编译器在优化代码时都尊重这一点。

对于任何声称使用 IEEE 浮点的编译器，这个技巧*应该可以*工作。但我不能保证它*会*在实践中发挥作用。如果有疑问，请检查您的编译器。

* * *

## 回答 #2

> 赞同：228
> 
> 时间：2010-01-23T16:19:05.740

`isnan()`当前 C++ 标准库中没有可用的函数。它是在[C99](http://en.wikipedia.org/wiki/C99)中引入的，并被定义为[宏](http://en.wikipedia.org/wiki/C_preprocessor)而不是函数。C99 定义的标准库元素不是当前 C++ 标准 ISO/IEC 14882:1998 的一部分，也不是其更新 ISO/IEC 14882:2003 的一部分。

2005 年提出了技术报告 1。TR1 为 C++ 带来了与 C99 的兼容性。尽管事实上它从未被正式采用成为 C++ 标准，但许多（[GCC 4.0+](http://gcc.gnu.org/gcc-4.0/changes.html)或[Visual C++ 9.0+](http://msdn.microsoft.com/en-us/library/bb982198.aspx) C++ 实现确实提供了 TR1 特性，全部或仅提供一些特性（Visual C++ 9.0 不提供 C99 数学函数） .

如果 TR1 可用，则`cmath`包括 C99 元素，如`isnan()`,`isfinite()`等，但它们通常在`std::tr1::`命名空间中定义为函数，而不是宏，尽管许多实现（即 Linux 上的 GCC 4+ 或 Mac OS X 10.5+ 上的 XCode）注入它们直接到`std::`，所以`std::isnan`定义明确。

此外，C++ 的一些实现仍然使 C99`isnan()`宏可用于 C++（通过`cmath`or包含`math.h`），这可能会导致更多的混淆，开发人员可能会认为这是一种标准行为。

关于 Viusal C++ 的注释，如上所述，它`std::isnan`既不提供`std::tr1::isnan`，但提供了定义为自[Visual C++ 6.0](http://msdn.microsoft.com/en-us/library/aa298428%28VS.60%29.aspx)`_isnan()`以来可用的扩展函数

在 XCode 上，还有更多的乐趣。如前所述，GCC 4+ 定义了`std::isnan`. 对于旧版本的编译器和库形式的 XCode，似乎（这里是[相关讨论](http://lists.apple.com/archives/Xcode-users/2006/Aug/msg00619.html)），没有机会检查自己）`__inline_isnand()`在 Intel 和`__isnand()`Power PC 上定义了两个函数。

* * *

## 回答 #3

> 赞同：208
> 
> 时间：2013-05-30T13:30:09.487

# 第一个解决方案：如果您使用的是 C++11

既然有人问了这个问题，就有了一些新的发展：重要的是要知道这`std::isnan()`是 C++11 的一部分

## 概要

在标题中定义`<cmath>`

```
bool isnan( float arg ); (since C++11)
bool isnan( double arg ); (since C++11)
bool isnan( long double arg ); (since C++11) 
```

确定给定的浮点数 arg 是否不是数字 ( `NaN`)。

**参数**

`arg`: 浮点值

**返回值**

`true`如果 arg 是`NaN`,`false`否则

**参考**

[http://en.cppreference.com/w/cpp/numeric/math/isnan](http://en.cppreference.com/w/cpp/numeric/math/isnan)

请注意，如果您使用 g++，这与 -fast-math 不兼容，请参阅下面的其他建议。

* * *

# 其他解决方案：如果您使用不符合 C++11 的工具

对于 C99，在 C 中，这被实现为`isnan(c)`返回 int 值的宏。的类型`x`应为浮点型、双精度型或长双精度型。

不同的供应商可能包含也可能不包含或不包含某个功能`isnan()`。

据称可移植的检查方法是使用不等于自身`NaN`的 IEEE 754 属性：即 ie将是false 。`NaN``x == x``x``NaN`

但是，最后一个选项可能不适用于每个编译器和某些设置（特别是优化设置），因此在最后的手段中，您始终可以检查位模式......

* * *

## 回答 #4

> 赞同：81
> 
> 时间：2009-02-20T20:40:03.117

Boost 中还有一个[仅包含标头的库](http://www.boost.org/doc/libs/1_38_0/libs/math/doc/sf_and_dist/html/math_toolkit/special/fpclass.html)，它具有处理浮点数据类型的简洁工具

```
#include <boost/math/special_functions/fpclassify.hpp> 
```

您将获得以下功能：

```
template <class T> bool isfinite(T z);
template <class T> bool isinf(T t);
template <class T> bool isnan(T t);
template <class T> bool isnormal(T t); 
```

如果您有时间，请查看 Boost 的整个数学工具包，它有许多有用的工具并且正在快速增长。

此外，在处理浮点数和非浮点数时，查看[Numeric Conversions](http://www.boost.org/doc/libs/1_38_0/libs/numeric/conversion/doc/html/index.html)可能是个好主意。

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2011-03-26T09:08:46.197

共有三种“官方”方式：posix**`isnan`宏**、c++0x**`isnan`函数模板**或可视化 c++**`_isnan`函数**。

不幸的是，检测使用哪些是相当不切实际的。

不幸的是，没有可靠的方法来检测您是否具有带有 NaN 的 IEEE 754 表示。标准库提供了官方的这种方式（`numeric_limits<double>::is_iec559`）。但在实践中，诸如 g++ 之类的编译器搞砸了。

理论上可以简单地使用**`x != x`**，但是像 g++ 和 visual c++ 这样的编译器会把它搞砸。

所以最后，测试特定的**NaN 位模式**，假设（并希望在某个时候强制执行！）特定的表示，例如 IEEE 754。

* * *

**编辑**：作为“诸如 g++ 之类的编译器……搞砸”的一个例子，考虑

```
#include <limits>
#include <assert.h>

void foo( double a, double b )
{
    assert( a != b );
}

int main()
{
    typedef std::numeric_limits<double> Info;
    double const nan1 = Info::quiet_NaN();
    double const nan2 = Info::quiet_NaN();
    foo( nan1, nan2 );
} 
```

使用 g++ (TDM-2 mingw32) 4.4.1 编译：

```
C:\test> 键入“C:\Program Files\@commands\gnuc.bat”
@rem -finput-charset=windows-1252
@g++ -O -pedantic -std=c++98 -Wall -Wwrite-strings %* -Wno-long-long

C:\test> gnuc x.cpp

C:\test> 一个 && 回声工作... || 回声！失败
作品...

C:\test> gnuc x.cpp --fast-math

C:\test> 一个 && 回声工作... || 回声！失败
断言失败：a != b，文件 x.cpp，第 6 行

此应用程序已请求运行时以不寻常的方式终止它。
请联系应用程序的支持团队以获取更多信息。
！失败的

C:\测试> _

```

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2009-02-20T18:14:58.817

如果您的编译器支持 c99 扩展，则有一个 std::isnan，但我不确定 mingw 是否支持。

如果您的编译器没有标准功能，这是一个应该可以工作的小功能：

```
bool custom_isnan(double var)
{
    volatile double d = var;
    return d != d;
} 
```

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2009-02-20T19:18:12.580

您可以使用标准库中`numeric_limits<float>::quiet_NaN( )`定义的`limits`来进行测试。为 定义了一个单独的常量`double`。

```
#include <iostream>
#include <math.h>
#include <limits>

using namespace std;

int main( )
{
   cout << "The quiet NaN for type float is:  "
        << numeric_limits<float>::quiet_NaN( )
        << endl;

   float f_nan = numeric_limits<float>::quiet_NaN();

   if( isnan(f_nan) )
   {
       cout << "Float was Not a Number: " << f_nan << endl;
   }

   return 0;
} 
```

我不知道这是否适用于所有平台，因为我只在 Linux 上使用 g++ 进行了测试。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2009-02-20T18:18:31.837

您可以使用该`isnan()`函数，但您需要包含 C 数学库。

```
#include <cmath> 
```

由于此功能是 C99 的一部分，因此并非随处可用。如果您的供应商不提供该功能，您也可以定义自己的变体以实现兼容性。

```
inline bool isnan(double x) {
    return x != x;
} 
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2017-02-09T13:49:12.287

从 C++14 开始，有多种方法可以测试浮点数`value`是否为 NaN。

在这些方法中，只有**检查**数字表示的位才能可靠地工作，如我原来的答案中所述。特别`std::isnan`是经常提出的检查`v != v`，不能可靠地工作，不应该使用，以免当有人决定需要浮点优化时你的代码停止正常工作，并要求编译器这样做。这种情况可以改变，编译器可以变得更加符合，但是对于这个问题，自从最初的答案以来已经 6 年没有发生过。

大约 6 年来，我最初的答案是这个问题的选定解决方案，这没问题。`v != v`但最近选择了一个推荐不可靠测试的高度赞成的答案。因此，这个额外的更新的答案（我们现在有 C++11 和 C++14 标准，以及即将到来的 C++17）。

* * *

从 C++14 开始，检查 NaN 的主要方法是：

*   `std::isnan(value) )`
    是自 C++11 以来预期的标准库方式。`isnan`显然与同名的 Posix 宏冲突，但实际上这不是问题。主要问题是，当请求浮点算术优化时，至少使用一个主编译器，即 g++，`std::isnan` **返回`false`NaN 参数**。

*   `(fpclassify(value) == FP_NAN) )`
    遇到与 相同的问题`std::isnan`，即不可靠。

*   `(value != value) )`
    在许多 SO 答案中推荐。遇到与 相同的问题`std::isnan`，即不可靠。

*   `(value == Fp_info::quiet_NaN()) )`
    这是一个测试，标准行为不应该检测到 NaN，但优化行为可能可以检测到 NaN（由于优化的代码只是直接比较位级表示），并且可能结合另一种方法来覆盖标准的未优化行为，可以可靠地检测到 NaN。不幸的是，结果证明它不能可靠地工作。

*   `(ilogb(value) == FP_ILOGBNAN) )`
    遇到与 相同的问题`std::isnan`，即不可靠。

*   `isunordered(1.2345, value) )`
    遇到与 相同的问题`std::isnan`，即不可靠。

*   `is_ieee754_nan( value ) )`
    这不是标准功能。它根据 IEEE 754 标准检查位。它是完全可靠的*，但*代码有点依赖于系统。

* * *

在下面的完整测试代码中，“成功”是表达式是否报告值的 Nan-ness。对于大多数表达式，这种衡量成功的方法、检测 NaN 和仅检测 NaN 的目标对应于它们的标准语义。然而，对于`(value == Fp_info::quiet_NaN()) )`表达式，标准行为是它不能用作 NaN 检测器。

```
#include <cmath>        // std::isnan, std::fpclassify
#include <iostream>
#include <iomanip>      // std::setw
#include <limits>
#include <limits.h>     // CHAR_BIT
#include <sstream>
#include <stdint.h>     // uint64_t
using namespace std;

#define TEST( x, expr, expected ) \
    [&](){ \
        const auto value = x; \
        const bool result = expr; \
        ostringstream stream; \
        stream << boolalpha << #x " = " << x << ", (" #expr ") = " << result; \
        cout \
            << setw( 60 ) << stream.str() << "  " \
            << (result == expected? "Success" : "FAILED") \
            << endl; \
    }()

#define TEST_ALL_VARIABLES( expression ) \
    TEST( v, expression, true ); \
    TEST( u, expression, false ); \
    TEST( w, expression, false )

using Fp_info = numeric_limits<double>;

inline auto is_ieee754_nan( double const x )
    -> bool
{
    static constexpr bool   is_claimed_ieee754  = Fp_info::is_iec559;
    static constexpr int    n_bits_per_byte     = CHAR_BIT;
    using Byte = unsigned char;

    static_assert( is_claimed_ieee754, "!" );
    static_assert( n_bits_per_byte == 8, "!" );
    static_assert( sizeof( x ) == sizeof( uint64_t ), "!" );

    #ifdef _MSC_VER
        uint64_t const bits = reinterpret_cast<uint64_t const&>( x );
    #else
        Byte bytes[sizeof(x)];
        memcpy( bytes, &x, sizeof( x ) );
        uint64_t int_value;
        memcpy( &int_value, bytes, sizeof( x ) );
        uint64_t const& bits = int_value;
    #endif

    static constexpr uint64_t   sign_mask       = 0x8000000000000000;
    static constexpr uint64_t   exp_mask        = 0x7FF0000000000000;
    static constexpr uint64_t   mantissa_mask   = 0x000FFFFFFFFFFFFF;

    (void) sign_mask;
    return (bits & exp_mask) == exp_mask and (bits & mantissa_mask) != 0;
}

auto main()
    -> int
{
    double const v = Fp_info::quiet_NaN();
    double const u = 3.14;
    double const w = Fp_info::infinity();

    cout << boolalpha << left;
    cout << "Compiler claims IEEE 754 = " << Fp_info::is_iec559 << endl;
    cout << endl;;
    TEST_ALL_VARIABLES( std::isnan(value) );                    cout << endl;
    TEST_ALL_VARIABLES( (fpclassify(value) == FP_NAN) );        cout << endl;
    TEST_ALL_VARIABLES( (value != value) );                     cout << endl;
    TEST_ALL_VARIABLES( (value == Fp_info::quiet_NaN()) );      cout << endl;
    TEST_ALL_VARIABLES( (ilogb(value) == FP_ILOGBNAN) );        cout << endl;
    TEST_ALL_VARIABLES( isunordered(1.2345, value) );           cout << endl;
    TEST_ALL_VARIABLES( is_ieee754_nan( value ) );
} 
```

使用 g++ 的结果（再次注意，它的标准行为`(value == Fp_info::quiet_NaN())`是它不能用作 NaN 检测器，它在这里非常具有实际意义）：

```
[C:\my\forums\so\282（检测 NaN）]
> *g++ --版本 | 找到“++”*
g++ (x86_64-win32-sjlj-rev1, 由 MinGW-W64 项目构建) 6.3.0

[C:\my\forums\so\282（检测 NaN）]
> *g++ foo.cpp && a*
编译器声称 IEEE 754 = true

v = nan, (std::isnan(value)) = true 成功
u = 3.14, (std::isnan(value)) = false 成功
w = inf, (std::isnan(value)) = false 成功

v = nan, ((fpclassify(value) == 0x0100)) = true 成功
u = 3.14, ((fpclassify(value) == 0x0100)) = false 成功
w = inf, ((fpclassify(value) == 0x0100)) = false 成功

v = nan, ((value != value)) = true 成功
u = 3.14, ((value != value)) = false 成功
w = inf, ((value != value)) = false 成功

v = nan, ((value == Fp_info::quiet_NaN())) = false 失败
u = 3.14, ((value == Fp_info::quiet_NaN())) = false 成功
w = inf, ((value == Fp_info::quiet_NaN())) = false 成功

v = nan, ((ilogb(value) == ((int)0x80000000))) = true 成功
u = 3.14, ((ilogb(value) == ((int)0x80000000))) = false 成功
w = inf, ((ilogb(value) == ((int)0x80000000))) = false 成功

v = nan, (isunordered(1.2345, value)) = true 成功
u = 3.14, (isunordered(1.2345, value)) = false 成功
w = inf, (isunordered(1.2345, value)) = false 成功

v = nan, (is_ieee754_nan( value )) = true 成功
u = 3.14, (is_ieee754_nan( value )) = false 成功
w = inf, (is_ieee754_nan( value )) = false 成功

[C:\my\forums\so\282（检测 NaN）]
> *g++ foo.cpp -ffast-math && a*
编译器声称 IEEE 754 = true

v = nan, (std::isnan(value)) = false 失败
u = 3.14, (std::isnan(value)) = false 成功
w = inf, (std::isnan(value)) = false 成功

v = nan, ((fpclassify(value) == 0x0100)) = false 失败
u = 3.14, ((fpclassify(value) == 0x0100)) = false 成功
w = inf, ((fpclassify(value) == 0x0100)) = false 成功

v = nan, ((value != value)) = false 失败
u = 3.14, ((value != value)) = false 成功
w = inf, ((value != value)) = false 成功

v = nan, ((value == Fp_info::quiet_NaN())) = true 成功
u = 3.14, ((value == Fp_info::quiet_NaN())) = true 失败
w = inf, ((value == Fp_info::quiet_NaN())) = true 失败

v = nan, ((ilogb(value) == ((int)0x80000000))) = true 成功
u = 3.14, ((ilogb(value) == ((int)0x80000000))) = false 成功
w = inf, ((ilogb(value) == ((int)0x80000000))) = false 成功

v = nan, (isunordered(1.2345, value)) = false 失败
u = 3.14, (isunordered(1.2345, value)) = false 成功
w = inf, (isunordered(1.2345, value)) = false 成功

v = nan, (is_ieee754_nan( value )) = true 成功
u = 3.14, (is_ieee754_nan( value )) = false 成功
w = inf, (is_ieee754_nan( value )) = false 成功

[C:\my\forums\so\282（检测 NaN）]
> _

```

Visual C++ 的结果：

```
[C:\my\forums\so\282（检测 NaN）]
> *cl /nologo- 2>&1 | 找到“++”*
Microsoft (R) C/C++ 优化编译器版本 19.00.23725 for x86

[C:\my\forums\so\282（检测 NaN）]
> *cl foo.cpp /Feb && b*
foo.cpp
编译器声称 IEEE 754 = true

v = nan, (std::isnan(value)) = true 成功
u = 3.14, (std::isnan(value)) = false 成功
w = inf, (std::isnan(value)) = false 成功

v = nan, ((fpclassify(value) == 2)) = true 成功
u = 3.14, ((fpclassify(value) == 2)) = false 成功
w = inf, ((fpclassify(value) == 2)) = false 成功

v = nan, ((value != value)) = true 成功
u = 3.14, ((value != value)) = false 成功
w = inf, ((value != value)) = false 成功

v = nan, ((value == Fp_info::quiet_NaN())) = false 失败
u = 3.14, ((value == Fp_info::quiet_NaN())) = false 成功
w = inf, ((value == Fp_info::quiet_NaN())) = false 成功

v = nan, ((ilogb(value) == 0x7fffffff)) = true 成功
u = 3.14, ((ilogb(value) == 0x7fffffff)) = false 成功
w = inf, ((ilogb(value) == 0x7fffffff)) = true 失败

v = nan, (isunordered(1.2345, value)) = true 成功
u = 3.14, (isunordered(1.2345, value)) = false 成功
w = inf, (isunordered(1.2345, value)) = false 成功

v = nan, (is_ieee754_nan( value )) = true 成功
u = 3.14, (is_ieee754_nan( value )) = false 成功
w = inf, (is_ieee754_nan( value )) = false 成功

[C:\my\forums\so\282（检测 NaN）]
> *cl foo.cpp /Feb /fp:fast && b*
foo.cpp
编译器声称 IEEE 754 = true

v = nan, (std::isnan(value)) = true 成功
u = 3.14, (std::isnan(value)) = false 成功
w = inf, (std::isnan(value)) = false 成功

v = nan, ((fpclassify(value) == 2)) = true 成功
u = 3.14, ((fpclassify(value) == 2)) = false 成功
w = inf, ((fpclassify(value) == 2)) = false 成功

v = nan, ((value != value)) = true 成功
u = 3.14, ((value != value)) = false 成功
w = inf, ((value != value)) = false 成功

v = nan, ((value == Fp_info::quiet_NaN())) = false 失败
u = 3.14, ((value == Fp_info::quiet_NaN())) = false 成功
w = inf, ((value == Fp_info::quiet_NaN())) = false 成功

v = nan, ((ilogb(value) == 0x7fffffff)) = true 成功
u = 3.14, ((ilogb(value) == 0x7fffffff)) = false 成功
w = inf, ((ilogb(value) == 0x7fffffff)) = true 失败

v = nan, (isunordered(1.2345, value)) = true 成功
u = 3.14, (isunordered(1.2345, value)) = false 成功
w = inf, (isunordered(1.2345, value)) = false 成功

v = nan, (is_ieee754_nan( value )) = true 成功
u = 3.14, (is_ieee754_nan( value )) = false 成功
w = inf, (is_ieee754_nan( value )) = false 成功

[C:\my\forums\so\282（检测 NaN）]
> _

```

总结上述结果，仅使用`is_ieee754_nan`此测试程序中定义的函数直接测试位级表示，在 g++ 和 Visual C++ 的所有情况下都可靠地工作。

* * *

附录：
在发布上述内容后，我意识到另一种可能测试 NaN 的方法，在此处的[另一个答案](https://stackoverflow.com/questions/570669/checking-if-a-double-or-float-is-nan-in-c/35005408#35005408)中提到，即`((value < 0) == (value >= 0))`. 事实证明，这在 Visual C++ 上工作得很好，但在 g++ 的`-ffast-math`选项下失败了。只有直接位模式测试才能可靠地工作。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2011-04-05T01:53:33.510

以下代码使用 NAN 的定义（所有指数位设置，至少一个小数位设置）并假设 sizeof(int) = sizeof(float) = 4。您可以在 Wikipedia 中查找 NAN 以获取详细信息。

`bool IsNan( float value ) { return ((*(UINT*)&value) & 0x7fffffff) > 0x7f800000; }`

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2013-08-16T22:41:23.033

# 楠预防

我对这个问题的回答是**不要对`nan`**. 改为使用**预防性**检查来检查表格的各个部分**`0.0/0.0`**。

```
#include <float.h>
float x=0.f ;             // I'm gonna divide by x!
if( !x )                  // Wait! Let me check if x is 0
  x = FLT_MIN ;           // oh, since x was 0, i'll just make it really small instead.
float y = 0.f / x ;       // whew, `nan` didn't appear. 
```

`nan`运算的结果`0.f/0.f`，或`0.0/0.0`。 `nan`是代码稳定性的可怕克星，必须非常小心地检测和*防止*¹ . 其性质`nan`与普通数不同：

*   `nan`有毒，(5* `nan`= `nan`)
*   `nan`不等于任何东西，甚至不等于自身 ( `nan`!= `nan`)
*   `nan`不大于任何东西（`nan`！> 0）
*   `nan`不小于任何东西 ( `nan`!< 0)

列出的最后 2 个属性是反逻辑的，将导致依赖于与`nan`数字比较的代码的奇怪行为（倒数第三个属性也是奇数，但您可能永远不会`x != x ?`在代码中看到（除非您正在检查对于nan（不可靠）））。

在我自己的代码中，我注意到`nan`值往往会产生难以发现的错误。（请注意，对于or而言，情况*并非*如此。 ( < 0) 返回， ( 0 < ) 返回 TRUE，甚至 ( < ) 返回 TRUE。因此，根据我的经验，代码的行为*通常*仍符合预期）。`inf``-inf``-inf``TRUE``inf``-inf``inf`

 *# 在nan下做什么

你想要发生的事情`0.0/0.0` **必须作为一个特殊情况来处理**，但你所做的事情必须取决于你期望从代码中得出的数字。

在上面的例子中， ( `0.f/FLT_MIN`)的结果`0`基本上是 。您可能想要`0.0/0.0`生成`HUGE`。所以，

```
float x=0.f, y=0.f, z;
if( !x && !y )    // 0.f/0.f case
  z = FLT_MAX ;   // biggest float possible
else
  z = y/x ;       // regular division. 
```

因此，在上面，如果 x 是`0.f`，`inf`将导致（实际上如上所述，它具有非常好的/非破坏性行为）。

请记住，[整数除以 0 会导致运行时异常](https://stackoverflow.com/questions/16777456/what-is-the-fastest-integer-division-supporting-division-by-zero-no-matter-what)。因此，您必须始终检查整数除以 0。仅仅因为`0.0/0.0`悄悄地评估为`nan`并不意味着您可以懒惰并且`0.0/0.0`在它发生之前不检查。

1[检查`nan`via`x != x`有时是不可靠的（`x != x`被一些破坏 IEEE 合规性的优化编译器剥离，特别`-ffast-math`是在启用开关时）。]

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-10-03T10:32:12.343

```
inline bool IsNan(float f)
{
    const uint32 u = *(uint32*)&f;
    return (u&0x7F800000) == 0x7F800000 && (u&0x7FFFFF);    // Both NaN and qNan.
}

inline bool IsNan(double d)
{
    const uint64 u = *(uint64*)&d;
    return (u&0x7FF0000000000000ULL) == 0x7FF0000000000000ULL && (u&0xFFFFFFFFFFFFFULL);
} 
```

如果`sizeof(int)`为 4 且`sizeof(long long)`为 8，则此方法有效。

在运行期间，它只是比较，铸件不需要任何时间。它只是更改比较标志配置以检查相等性。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-04-03T22:03:16.073

不依赖于所用 NaN 的特定 IEEE 表示的可能解决方案如下：

```
template<class T>
bool isnan( T f ) {
    T _nan =  (T)0.0/(T)0.0;
    return 0 == memcmp( (void*)&f, (void*)&_nan, sizeof(T) );
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-01-26T01:06:53.473

考虑到 NaN 并不总是保证 (x != x) （例如，如果使用 -ffast-math 选项），我一直在使用：

```
#define IS_NAN(x) (((x) < 0) == ((x) >= 0)) 
```

数字不能同时为 < 0 和 >= 0，所以实际上只有当数字既不小于、也不大于或等于零时，此检查才会通过。这基本上根本就不是数字，或者是 NaN。

如果您愿意，也可以使用它：

```
#define IS_NAN(x) (!((x)<0) && !((x)>=0) 
```

我不确定这如何受到 -ffast-math 的影响，因此您的里程可能会有所不同。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2012-12-11T09:08:56.793

至于我，解决方案可能是一个宏，使其显式内联，因此速度足够快。它也适用于任何浮点类型。它基于这样一个事实，即值不等于自身的唯一情况是值不是数字时。

```
#ifndef isnan
  #define isnan(a) (a != a)
#endif 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-08-03T22:38:29.977

这有效：

```
#include <iostream>
#include <math.h>
using namespace std;

int main ()
{
  char ch='a';
  double val = nan(&ch);
  if(isnan(val))
     cout << "isnan" << endl;

  return 0;
} 
```

输出：伊斯南

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-10-08T17:20:07.160

在我看来，最好的真正跨平台方法是使用联合并测试双精度的位模式以检查 NaN。

我还没有彻底测试过这个解决方案，并且可能有一种更有效的方式来处理位模式，但我认为它应该可以工作。

```
#include <stdint.h>
#include <stdio.h>

union NaN
{
    uint64_t bits;
    double num;
};

int main()
{
    //Test if a double is NaN
    double d = 0.0 / 0.0;
    union NaN n;
    n.num = d;
    if((n.bits | 0x800FFFFFFFFFFFFF) == 0xFFFFFFFFFFFFFFFF)
    {
        printf("NaN: %f", d);
    }

    return 0;
} 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2014-01-31T19:26:31.673

IEEE 标准规定，当指数全为`1`s 且尾数不为零时，数字为 a `NaN`。Double 是`1`符号位、`11`指数位和`52`尾数位。做一点检查。

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2013-06-26T21:33:59.863

正如上面的评论所说 a != a 在 g++ 和其他一些编译器中不起作用，但是这个技巧应该。它可能效率不高，但它仍然是一种方式：

```
bool IsNan(float a)
{
    char s[4];
    sprintf(s, "%.3f", a);
    if (s[0]=='n') return true;
    else return false;
} 
```

基本上，在 g++ 中（我不确定其他人）如果变量不是有效的整数/浮点数，printf 会在 %d 或 %.f 格式上打印“nan”。因此，此代码检查字符串的第一个字符是否为“n”（如“nan”）

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2018-11-30T08:45:36.507

这通过检查它是否在双重限制内来检测 Visual Studio 中的无穷大和 NaN：

```
//#include <float.h>
double x, y = -1.1; x = sqrt(y);
if (x >= DBL_MIN && x <= DBL_MAX )
    cout << "DETECTOR-2 of errors FAILS" << endl;
else
    cout << "DETECTOR-2 of errors OK" << endl; 
```

# asp.net - 处理关联的 HttpModule 时不处理 HttpHandler

> ID：570680
> 
> 赞同：1
> 
> 时间：2009-02-20T18:12:34.877
> 
> 标签：asp.net, httphandler, httpmodule

在我们的 asp.net 2.0 应用程序中，我们有一个 HttpModule 和 HttpHandler。它们在 web.config 中注册以处理对某些文件类型的请求。使用 MS AJAX 从客户端异步发起请求。我注意到一些奇怪的事情：没有在每个 HttpModule:EndRequest 上输入 HttpHandler:ProcessRequest，这似乎是不正确的行为，因为我对事件流的理解：HttpModule:BeginRequest > HttpHandler:ProcessRequest > HttpModule:EndRequest。由于某种原因，有时会跳过处理程序部分。这可能是什么原因造成的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:32:55.513

您是否在 IIS 中设置了要由 .net 处理的文件类型？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:15:28.140

如果我理解正确的话，HttpModule 会为您的应用程序的每个请求执行，而 HttpHandler 只会为注册的扩展程序执行。

因此，除了您向处理程序发出的请求之外，可能还有其他请求给应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T19:12:02.610

我相信对 Server.Transfer 和 Response.End 的调用可以使管道短路，您的逻辑分支是否可能这样做？

# delphi - 哪个 Delphi 组件包含最多的事件？

> ID：570681
> 
> 赞同：0
> 
> 时间：2009-02-20T18:12:50.943
> 
> 标签：delphi, events, components

几天前，我正在根据 Hallvard 的[Hack #10](http://hallvards.blogspot.com/2006/05/hack-10-getting-parameters-of.html)编写一些代码，这让我想知道，有多少事件往往会发生？到目前为止，我发现的最高计数来自我工作的公司的 DevExpress 网格的内部自定义后代，该网格在 Object Inspector 中有 83 个已发布事件。任何人都知道可以超越它的组件吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T18:41:53.730

[`TVirtualStringTree`](http://www.soft-gems.net/index.php?option=com_content&task=view&id=12&Itemid=33)除了在其祖先中发布的任何事件之外，在版本 4.7.0 中有 100 个已发布的事件属性。它的表弟`TVirtualDrawTree`, 有 97。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T20:35:32.480

这确实是一个无法回答的问题，因为这里提出的任何数字都可能在明天轻松超过。除非组件可以拥有的已发布事件的数量有上限，否则没有答案。一旦达成一致，那么有人可以发布具有 N+1 事件的内容。永远重复。

# c# - INotifyPropertyChanged 与 DependencyProperty

> ID：570684
> 
> 赞同：19
> 
> 时间：2009-02-20T18:13:42.050
> 
> 标签：c#, .net, wpf

我需要观察属性的变化。哪种方法在性能和内存使用方面更好：实现`INotifyPropertyChanged`或使用`DependencyProperty`？

注意：是的，我已经阅读了另一个问题[INotifyPropertyChanged vs. DependencyProperty in ViewModel](https://stackoverflow.com/questions/291518/inotifypropertychanged-vs-dependencyproperty-in-viewmodel)。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-20T18:23:59.373

内存使用：INotifyPropertyChanged 是一个接口，因此内存开销接近于零。“接近于零”，因为我假设您将编写 OnPropertyChanged 方法，并且可能在其他类中编写一些事件处理程序（除非您真的只是在谈论绑定到 WPF），因此会有一点代码开销。

性能：DependancyProperties 在幕后发生了很多事情。除非您编写了有史以来性能最差的 OnPropertyChanged 方法，否则我敢打赌 INotifyPropertyChanged 也将成为性能赢家。

除非您有明确的理由想要/需要 DP 提供的行为，否则我只会使用 INotifyPropertyChanged。

**更新**

正如评论中提到的，由于直接属性的查找/连接所需的反射量，DP 的绑定性能要快一些（快 15-20%，但对于 1000 次绑定仍然只有不到 50 毫秒的差异）。这在技术上与更新数据绑定 UI 元素的性能不同，这是我的评论所针对的。但这并不意味着我的赌注仍然正确。因此，一些示例和大量 .NET Reflector 挖掘器稍后看起来......尚无定论。两条路径都在幕后做了大量工作，我无法获得任何示例来显示更新性能的明确差异。

我仍然坚持使用 INotifyPropertyChanged，除非我对 DP 有特殊需求，但这至少是一个有趣的练习，可以进一步深入 WPF 核心。:)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-20T18:24:24.410

没关系，我刚刚在以下[问题](https://stackoverflow.com/questions/156538/dependence-on-dependencyobject-and-dependencyproperty)中找到了我正在寻找的答案。

为了您的方便，我将通过“LBugnion”重新发布答案（所以所有功劳归他所有）：

* * *

实现 INotifyPropertyChanged 与 DependencyObjects（我将缩写此 DO 以使其更容易）和使用 DependencyProperties (DPs) 相比具有许多优点：

*   这个比较轻
*   让您在建模对象时更加自由
*   可以轻松序列化
*   您可以在需要时引发事件，这在某些情况下可能很有用，例如，当您希望仅在一个 UI 操作中捆绑多个更改时，或者当您需要在数据没有更改的情况下引发事件时（以强制重绘...）

另一方面，在 WPF 中继承 DO 有以下优点：

*   更容易实施，尤其是对于初学者。
*   您（几乎）免费获得回调机制，允许您在属性值更改时收到通知
*   您将获得一个强制机制，允许您为属性的最大值、最小值和现值定义规则。

还有其他考虑因素，但这些是主要的。

我认为普遍的共识是 DP 非常适合控件（即使在 Silverlight 中，您也可以使用自定义 DP 实现 CustomControl），但对于数据对象，您应该实现 INotifyPropertyChanged。

HTH，洛朗

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-15T19:59:12.337

正如 MSDN 所说，WPF 绑定到 DependencyProperties 比使用 INotifyPropertyChanged 绑定到自定义 CLR 对象更快。

请参阅[http://msdn.microsoft.com/en-us/library/bb613546.aspx](http://msdn.microsoft.com/en-us/library/bb613546.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T18:27:22.657

恕我直言，与 DP 相比，INotifyPropertyChanged 非常轻量级且易于使用。就性能/内存而言，您*真的*需要知道吗？克努特想知道。

显然，您必须确定您的要求并查看您希望每秒创建多少个 DP，它们的寿命，并运行一些测试。我以前做过这个，并没有看到以 ~10k/sec (YMMV) 创建短命 DP 的任何问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-18T03:54:41.463

我建议你问错问题。而不是询问性能，您应该查看每种方法的功能和优点。基本上，不应该基于性能来决定使用哪个。如果你正在创建一个控件，那么从我所做的阅读来看，你应该使用dependencyProperty，否则使用INotifyPropertyChanged。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-18T00:10:41.383

恕我直言，这是一个非常有趣且重要的问题。我已经在下一个纯（无绑定）任务中对其进行了测试。DP事实上必须非常快......（每个标准控件的100..属性，可动画） **所以，问题是**

假设 3D 坐标轴。我们在每个轴附近放置了***x***、***y***和***z***之类的标签。WPF 中的 3D 文本渲染相对[较难 WPF 3D 性能](http://msdn.microsoft.com/en-us/library/bb613553.aspx)

任务是在 3D 场景中的鼠标旋转时检测到标签的旋转，顺便说一下，当标签可以直接看到用户时（在 3D 场景旋转时，它们与轴一起平移，但以特殊方式旋转）。此任务由**相同的 CallBack 函数**解决。实现如下所示：

1.  方法 - INotifyPropertyChanged 包括）

    公共属性 T3D_LabelAngleX() As Double Get Return _T3D_LabelAngleX End Get Set(ByVal value As Double) _T3D_LabelAngleX = value t3d_SetLabelTransform() End Set End Property

2.  方法 - DP

    公共共享只读 MDS_AngleLabelRotation_XProperty 作为 DependencyProperty = _ DependencyProperty.Register("MDS_AxisAngleRotation_X", _ GetType(Double), GetType(MainDecartsSystem), _ New PropertyMetadata(MDS_AngleLabelRotation_XDefault, AddressOf MDS_RotationChanged))

    ```
    Public Property MDS_AngleLabelRotation_X() As Double
        Get
            Return CType(GetValue(MDS_AngleLabelRotation_XProperty), Double)
        End Get
        Set(ByVal value As Double)
            SetValue(MDS_AngleLabelRotation_XProperty, value)
        End Set
    End Property 
    ```

    重点是**MDS_RotationChanged**和**t3d_SetLabelTransform()**是**相等**的。 ![轮换标签...](https://i.stack.imgur.com/rYJRB.png). 我可怜的老鼠....两者都非常快！我无法发现任何差异。似乎 DP 有点快，可能......（我不确定）。谢谢你的问题。

# sql - 存储过程参数插入错误值

> ID：570688
> 
> 赞同：1
> 
> 时间：2009-02-20T18:15:20.347
> 
> 标签：sql, stored-procedures, parameters, null

大家下午好，

我遇到了插入错误值的存储过程的问题。下面是我的存储过程的总结......

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go
CREATE PROCEDURE [dbo].[InsertDifferential]
    @differential int = null
AS
    BEGIN TRY
        BEGIN TRANSACTION
            UPDATE
                DifferentialTable
            SET
                differential = @differential
        COMMIT
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0
        ROLLBACK
        DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int, @ErrorState INT
        SELECT @ErrMsg = ERROR_MESSAGE(), 
               @ErrSeverity = ERROR_SEVERITY(),
               @ErrorState = ERROR_STATE();
        RAISERROR(@ErrMsg, @ErrSeverity, @ErrorState);
    END CATCH 
```

下面是我用来调用存储过程的代码...

```
SqlConnection dbEngine = new SqlConnection(connectionString);
SqlCommand dbCmd = new SqlCommand("InsertDifferential", dbEngine);
SqlDataAdapter dataAdapter = new SqlDataAdapter(dbCmd);

dbCmd.CommandType = CommandType.StoredProcedure;

if (myobject.differential.HasValue)
{ dbCmd.Parameters.AddWithValue("@differential", myobject.differential); }
else
{ dbCmd.Parameters.AddWithValue("@differential", DBNull.Value); }

dbCmd.ExecuteNonQuery(); 
```

在数据库表中，差异列是一个可以为空的 int，没有默认值。

“myobject”的微分属性是一个int？数据类型默认设置为 null。

问题是当我运行存储过程时，差异列以 0 结束。即使“myobject.differential”为空并且我传入了 DBNull.Value，该列仍然以 0 结束。我试过不将@differial 传递到存储过程中，它仍然将列设置为0。

我尝试了许多不同的解决方案，但没有任何效果。

预先感谢您的任何帮助，

斯科特·维库斯基

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:17:58.170

我相信当您在参数上设置默认值时

```
@differential int = null 
```

您不需要将它添加到您的 SQL 命令中。

仅使用此代码尝试代码，不要包含其他...

```
if (myobject.differential.HasValue)
{ 
   dbCmd.Parameters.AddWithValue("@differential", myobject.differential); 
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:47:10.020

您是否确定差异列上没有**默认值约束**为零？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T21:42:21.813

还要检查表上是否存在将空值设置为零的触发器。

# json - 如何在没有格式化的情况下序列化 JObject？

> ID：570689
> 
> 赞同：123
> 
> 时间：2009-02-20T18:15:53.510
> 
> 标签：json, serialization, json.net

我有一个`JObject`用 LINQ to JSON 构建的（我正在使用 Json.Net）（也由同一个库提供）。当我在 上调用该`ToString()`方法时`JObject`，它会将结果输出为格式化的 JSON。

如何为此将格式设置为“无”？

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2009-02-21T03:27:07.320

调用 JObject 的`ToString(Formatting.None)`方法。

或者，如果您将对象传递给 JsonConvert.SerializeObject 方法，它将返回不带格式的 JSON。

文档：[**使用 JToken.ToString 编写 JSON 文本**](http://www.newtonsoft.com/json/help/html/ToString.htm)

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-06-23T13:01:58.620

您还可以执行以下操作；

```
string json = myJObject.ToString(Newtonsoft.Json.Formatting.None); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2018-01-31T10:13:47.487

您可以使用`JsonConvert.SerializeObject()`

```
JsonConvert.SerializeObject(myObject) // myObject is returned by JObject.Parse() method 
```

[JsonConvert.SerializeObject()](https://www.newtonsoft.com/json/help/html/M_Newtonsoft_Json_JsonConvert_SerializeObject.htm)

[JObject.Parse()](https://www.newtonsoft.com/json/help/html/M_Newtonsoft_Json_Linq_JObject_Parse.htm)

# c++ - 使用提升指针会改变您的 OO 设计方法吗？

> ID：570693
> 
> 赞同：3
> 
> 时间：2009-02-20T18:17:22.103
> 
> 标签：c++, boost, oop

在从 C++ 切换到 C++ w/boost 之后，您认为您的 OOD 技能提高了吗？

您是否注意到“普通”C++ 代码中的模式您不会认为您已经切换，或者您是否发现它支持更抽象的设计？

我想我真的想知道您是否只是将它用作工具，或者您是否更改了整个面向对象设计的方法，以便在使用提升指针时更有效地使用对象。

编辑：总结

这个问题有点奇怪——我之所以这么问，是因为我遇到了太多根本不是 OO 的 C++ 代码。我相当确定（在迁移到托管语言之前，我在这方面的工作）在 C++ 中的 OO 中比托管语言更难思考。

通过查看这些帖子，我猜您在发现需要更好的内存管理方法之前了解了 OO 的价值，所以当您开始寻找 Boost 之类的东西时，您已经在大量使用 OO 方法.

我有点期待一堆答案说它帮助他们在 OO 中思考，但现在我想起来了，如果你不使用 OO，boost 指针不是很有帮助，你不会看到需要他们（所以你不会回复）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T18:23:35.537

在大约六年前我做的一个 C++ 项目中，我们实现了我们自己的类似 boost 的自动指针方案。它工作得很好，除了其中的各种错误。（当然希望我们使用了 boost ......）

尽管如此，它并没有改变我们开发代码的方式。面向对象的设计，不管有没有托管指针，都非常相似。有时您需要返回对象，或者有时指向对象的指针更重要。智能指针的好处与您设计应用程序的方式无关。您可以传递相同的数据并相当肯定它不会泄漏，而不是传递潜在危险的内存泄漏。

在这方面，您可以使用智能指针做更多的事情：简化您的代码。无需在任何地方返回整数或基本结构，您可以更自由地传递复杂的数据结构或类而无需担心。您可以更快地构建更复杂的应用程序，而不必担心太多。它让您在需要时拥有 C 和 C++ 的原始功能（如果不需要它，为什么要使用 C 或 C++？），并且易于内存管理，这对生产力有如此惊人的提升。如果自动管理的内存没有用，那么地球上几乎所有其他语言都不会使用它！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T18:20:53.217

STL/Boost 是完成这项工作的工具。他们帮助我实现我的想法，而不是相反。澄清：Boost 并没有提升我的 OOD 技能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T23:26:33.233

它深深地改变了我的编码方式，我正在传播这个词。特别是通过使用 Boost.Graph 和 Boost.PropertyMap，我意识到我可以在一个简单的类中编写“真正的”算法，而不是（还）不知道如何访问信息，甚至不知道（或关心）哪些子操作可能在执行算法时完成。我的团队现在正在使用图形工具设计复杂的计算功能。

有人可能会争辩说，模板确实是这种变化的基础，但 Boost 显然铺平了道路。对我来说，发现新的 Boost 库通常是学习可以应用于我们日常工作的重要内容的好机会！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T00:17:34.863

一旦我发现`boost::bind`（并且`boost::function`）我发现，我不再考虑继承和抽象基类（java/c#-speak 中的“接口”），而是开始将一切都视为函子。

例如，pre-boost 我已经构建了一个菜单系统，其中菜单是`IActionable*`项目的容器，任何想要连接到菜单系统的东西都必须继承 IActionable 并提供一个操作方法。提升后，我正在实现包含`boost::function<void()>`对象的菜单，并使用`boost::bind`.

另一件事：仅仅看看 boost 成功使用模板的方式真的让我提高了我对它们可能实现的期望，并努力在我自己的代码中更好地利用它们，所以我写了很多“通用”和更少的“OOP”代码。

智能指针当然很有用并且得到了很多覆盖，但除了清理一些显式删除之外，它们几乎不是范式转变。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T18:25:25.920

对我来说，它并没有改变我的设计方式，但 Boost 确实为我提供了额外的工具，让某些事情变得更容易。例如，使用“智能”指针，我不再需要考虑确保必须在适当的时间销毁某些对象创建（主要是在例外情况下）。但就像任何工具一样，我必须了解何时使用它们以及何时不使用它们。

# database - 将 postgres 服务器扩展到多个服务器

> ID：570699
> 
> 赞同：22
> 
> 时间：2009-02-20T18:18:29.497
> 
> 标签：database, postgresql, replication, scalability, load-balancing

我们的 postgres 服务器即将达到其容量，我们正在考虑添加第二个数据库服务器。有没有特别适合 postgres 设置的扩展解决方案？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-20T20:40:59.590

您正在查看一组有限的选择，很大程度上取决于您的具体要求（读写比率以及您的应用程序对偶尔不一致读取的容忍度[同步与异步复制？主从与多主?]，您的表的连接程度如何 [集群] 等）

*   [http://www.postgresql.org/download/products/3](http://www.postgresql.org/download/products/3)
    *   [http://pgpool.projects.postgresql.org/](http://pgpool.projects.postgresql.org/)
    *   [http://www.slony.info/](http://www.slony.info/)

* * *

# 更新

距离最初的答案已经过去了六年多。**请参阅**PostgreSQL 文档中的**[高可用性、负载平衡和复制一章，了解您可用的最新解决方案。](http://www.postgresql.org/docs/9.4/interactive/high-availability.html)**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-25T08:59:48.860

你检查过你的瓶颈是什么吗？哪些查询使您的服务器努力工作？也许它可以更好地调整。

如果调优没有帮助，升级服务器通常比设置复制容易得多。在 RAID1 或 RAID10 中添加一些磁盘，添加一些 RAM，更多内核和更快的处理器。具有电池后备缓存的良好 RAID 控制器也会产生很大的不同。

复制 id 有利于高可用性，但如果您遇到性能问题，通常更大的服务器会更具成本效益。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-19T14:49:02.257

Postgres Advanced Server 和 Continuent Tungsten 也值得研究企业级解决方案。

# asp.net - ASP.NET MVC 对于大型企业项目来说是不是一个糟糕的选择？

> ID：570705
> 
> 赞同：25
> 
> 时间：2009-02-20T18:20:27.617
> 
> 标签：asp.net, asp.net-mvc

我们即将着手开发一个大型企业应用程序。我正在认真考虑使用 ASP.NET MVC，因为：

1.  我们需要使用微软技术（biz逻辑都是C#）
2.  性能至关重要
3.  我想尽可能多地测试

我的团队只使用 PHP 进行 Web 开发，但对 .NET winforms 非常有经验（因此无论哪种方式，我们都有一个学习曲线）。我担心的是，有些人对 ASP.NET MVC 对大型应用程序的可伸缩性表示担忧。但从我读到的内容来看，网络表单也有自己的问题。

我应该重新考虑网络表单，还是坚持我的直觉并使用 ASP.NET MVC？

**有关的：**

> [我应该在 ASP.NET MVC 中构建我的下一个 Web 应用程序吗？](https://stackoverflow.com/questions/247115/should-i-build-my-next-web-app-in-asp-net-mvc) [https://stackoverflow.com/questions/521388/from-webforms-to-asp-net-mvc](https://stackoverflow.com/questions/521388/from-webforms-to-asp-net-mvc)

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-20T18:33:56.027

ASP.NET 网络表单是重量级的，会在您的网页上放置大量内容，包括 html/javascript 和序列化视图状态。我记得我的第一个 ASP.NET 网站导致 GC 崩溃，因为所有短暂的对象都从那个可怕的视图状态中重新水化。哦，当我年轻和天真的时候（即 2 年前）......你必须对 webforms 有很好的理解才能从它们构建可扩展的网站。可能的？确实。简单的？不是。

*ASP.NET MVC最初*更难编码，但比**webforms**更容易开发。最难学习的是 1) 约定俗称“魔术字符串”，2) Html + 内联代码，即 ASP 和 3) html 表单。

使用 MVC，您将无法摆脱 webforms 开发中常见的状态噩梦，这意味着您的网页是冰毒成瘾者。这也意味着你必须更聪明地编码你的状态。恕我直言，该代码也比传统的网络表单更简单，并且可扩展性更好。

此外，使用 ASP.NET 进行测试几乎是不可能的，因为框架中包含硬编码和不可修改的依赖项。ASP.NET MVC 将所有这些替换为 System.Web.Abstractions 成员，这些成员是围绕这些设计不佳且无法测试的对象的可模拟包装器。

跑，不要走路，去 MVC。

* * *

对于明显受损的人，如果您使用位于 ASP.NET 框架之上的框架，例如 MVC 或您编写或其他人编写的任何其他框架，**显然**其中一些评论不适用。

另一方面，如果您像早期人类那样针对 ASP.NET webforms 模型（例如 Page_Load 中的 Response.Write()）进行编码，我的评论适用。

您能否编写可针对 ASP.NET 进行测试的代码？当然。您可以在不包含您或其他人编写的特殊测试代码的情况下做到这一点吗？当然。如果你有 TypeMock。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-02-20T18:24:57.793

ASP.NET WebForms 与 Winforms 非常相似，并且允许 RAD（快速应用程序开发）。很快就可以得到一些东西。这个问题是测试可能是一个主要的痛苦，如果用于任何面向公众的东西可能意味着 ViewState 的一些主要问题。WebForms 可以保持状态，使使用向导之类的东西变得轻而易举。

另一方面，使用 ASP.NET MVC 进行开发可能需要更长的时间，并且需要开发人员了解 HTTP 的工作原理。这是一个无状态的架构，这意味着每个请求都是它自己的小世界，通常不知道以前的请求。该框架还允许高可测试性。

就性能而言，它们可能是相同的，因为 ASP.NET MVC 只是一个构建在现有 ASP.NET 体系结构之上的框架。虽然对于客户端体验，我会说 MVC 更快一些。

至于可扩展性，我会说它们在技术上大致相同。至于如何使用 API 并集成它 MVC 可能会更容易一些。

您现在用来询问此版本问题的网站是建立在 ASP.NET MVC 之上的，它们有 2 个 Web 服务器和一个强大的 db 服务器。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-23T00:08:53.350

ASP.NET MVC 对企业来说不是问题，但 ASP.NET、Silverlight 等也不是问题，它们都是 UI 技术。无论如何，您的大多数应用程序逻辑都应该存在于 UI 层下方的库中，因此几乎可以使用任何 UI。

1.  我们需要使用微软的技术
2.  性能至关重要
3.  我想尽可能多地测试

基于以上，ASP.NET MVC 就可以工作了。但是，您可以将代码移到 UI 下方并进行测试。如果您的算法低于 UI，您可以在不更改 UI 的情况下调整它们。而且，如果 UI 层非常薄，则对 UI 的性能影响可以忽略不计。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T18:55:43.447

不。ASP.NET MVC 在性能方面优于 ASP.NET Web 窗体的一件事是它不使用控制树。控制树消耗大量服务器端内存，并使垃圾收集器在具有许多控件的页面上非常忙碌。我认为您会从 ASP.NET MVC 获得卓越的性能。它的单元测试方面是真正的胜利。

不利的一面是，您不能使用 ASP.NET Web 窗体提供的所有方便的开箱即用控件，并且您可能最终会进行更多的客户端 JavaScript 开发，因此最初的开发预算可能会如果您选择 ASP.NET MVC 而不是 Web 窗体，则需要更大，但从长远来看，您将拥有一个出色的解决方案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T18:21:34.480

坚持你的直觉。ASP.NET MVC 有助于促进测试，因为几乎整个 API 都派生自接口。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-15T12:45:14.097

多年来一直使用 WebForms，但从未喜欢过它们。现在使用 Asp.Net MVC 几年了，这好多了。当然会推荐 MVC。

Asp.Net MVC 具有出色的架构并且是开源的。因此，如果您要识别 http 处理链中的瓶颈，您可以修复它。大多数时候，您可以使用 Asp.Net MVC 提供的众多扩展点之一来解决性能问题，例如 Binders。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T18:47:04.810

如果您需要或想要它的功能，我会说使用 MVC。如果您正在构建一个业务线应用程序，例如 ERP 或 CRM 系统，我会使用 Webforms；如果您正在构建一个门户网站或社区 wiki 类型的网站，我会选择 MVC。最终归结为偏好以及您的企业应用程序究竟需要完成什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T19:53:25.693

“有了 MVC，你就无法摆脱 webforms 开发中常见的状态噩梦，这意味着**你的网页是 meth-addict slim** ”

为该报价而升级！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-15T09:47:02.647

我的意见：使用 ASP.NET Webforms。

在 Web.Config 中禁用 ViewState。

无需保留状态，因为您真正需要的一切都在 Request 对象中。结合使用 Javascript 和 AJAX 进行数据检索，以在客户端呈现您的 UI 控件。

以控制标签的形式为您的客户端组件渲染器创建服务器端包装器。这就是我多年来一直工作的方式，它快速、可靠、可测试且有条理。

为这种工作方法建立一个体面的框架确实需要一些时间，但最终它会统治。

我宁愿没有像 MVC 这样的意大利面条代码。曾经使用 PERL/PHP 和经典的 ASP。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-02-20T19:39:23.777

我读到的关于 asp.net MVC 的所有内容都表明它能够提供比 asp.net webforms 更多的页面请求。

不过，我对它的稳定性和安全性有些怀疑。这两者都源于它甚至还没有发布，即使是 RC，我们也看到了框架的一些变化。我相信随着时间的推移和事情的发现会有更多的变化。它是新的，因此没有真正的“最佳实践”，并且没有丰富的经验详细说明您可能遇到的小问题或陷阱。

我一直在使用它，它确实使页面更小，性能更快。但是我可以在 webforms 中做很多事情，我不知道如何使用 mvc，因为 mvc 不提倡使用 webforms 控件。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2012-02-01T21:31:22.700

如果您能够使用存储过程，那么您就不需要像 MVC 生成的那样大的中间层。您所要做的就是通过一个简单的 HTTP 处理程序将 XML 传递给您的存储过程，从存储过程中获取结果，并将结果转换为 JSON。MVC 和其他中间层的东西只能为销售 VS 之类的 IDE 的公司赚钱。

# configuration - grails base.dir 系统属性

> ID：570713
> 
> 赞同：5
> 
> 时间：2009-02-20T18:22:56.630
> 
> 标签：configuration, grails

我有一个简单的 grails 文件上传应用程序。

我正在使用 transferTo 将文件保存到文件系统。

为了在我的控制器中获取基本路径，我正在使用

```
def basePath = System.properties['base.dir'] // HERE IS HOW I GET IT

        println "Getting new file"
        println "copying file to "+basePath+"/files"
        def f = request.getFile('file')
        def okcontents = ['application/zip','application/x-zip-compressed']
        if (! okcontents.contains(f.getContentType())) {
            flash.message = "File must be of a valid zip archive"
            render(view:'create', model:[zone:create])
            return;
        }
              if(!f.empty) {
                  f.transferTo( new File(basePath+"/files/"+zoneInstance.title+".zip") )
              }
              else 
              {
                  flash.message = 'file cannot be empty'
                      redirect(action:'upload')
              }
        println "Done getting new file" 
```

由于某种原因，当部署到我的 WAS 6.1 服务器时，它始终为空。

为什么在 WAS 服务器上运行 dev 而不是 prod 时它可以工作？我应该以不同的方式访问这些信息吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T20:14:59.060

谢谢j，

我找到了最好的动态解决方案。作为一项规则，我从不喜欢将绝对路径编码到任何软件中。属性文件或没有。

所以这是如何完成的：

```
def basePath = grailsAttributes.getApplicationContext().getResource("/files/").getFile().toString() 
```

grailsAttributes 在任何控制器中都可用。

getResource(some relative dir) 将在 web-app 文件夹中查找任何内容。

因此，例如在我的开发系统中，它会将字符串输出到“C:\WORKSPACEFOLDER\PROJECTFOLDER\web-app\，并将相关目录连接到末尾

就像我上面的例子一样 C:\WORKSPACEFOLDER\PROJECTFOLDER\web-app\files

我在 WAS 6.1 中尝试过，它在容器中工作没有问题。您必须对其进行 toString 处理，否则它将尝试返回该对象。

穆加富加

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-08-19T02:56:06.043

有一个确定的方法...

```
grailsApplication.parentContext.getResource("dir/or/file").file.toString() 
```

没有控制器（例如引导程序）？注入就行了。。

```
def grailsApplication 
```

最好的祝福！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T19:54:52.807

Grails 在开发模式下运行时，会依次为其 Gant 脚本和应用程序提供大量环境属性，包括 basedir。

查看***grails.bat***或***grails.sh***脚本，您会发现以下几行：

```
Unix: -Dbase.dir="." \
Windows: set JAVA_OPTS=%JAVA_OPTS% -Dbase.dir="." 
```

当这些脚本以开发模式启动您的环境时，您将免费获得这些脚本。

当您使用 WAR 并进行部署时，您不再使用这些脚本，因此您需要以另一种方式解决问题；你可以

1.  自行为应用服务器的启动脚本指定属性，例如：-Dbase.dir=./some/dir .. 然而
    *   ...通常使用允许[每个环境属性的 Grails Config 对象更有意义](http://www.grails.org/Config)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-06-05T20:47:18.037

另外一个选项：

def basePath = BuildSettingsHolder.settings.baseDir

# sql - 将存储过程的返回值分配给 SQL 中的变量的最佳方法是什么？

> ID：570716
> 
> 赞同：6
> 
> 时间：2009-02-20T18:23:32.760
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个返回值的存储过程我从需要检索此值的其他存储过程中调用它。调用存储过程在事务内部，返回值的存储过程（实际上创建值并将其存储在没有其他过程接触的表中）不在其自己的事务内部，而是调用者事务的一部分。

问题是，检索存储过程的返回值并将其存储在调用过程中的变量中的最有效方法是什么？

目前我有以下内容，我想知道它是否效率很低？

```
DECLARE @tmpNewValue TABLE (newvalue int)
INSERT INTO @tmpNewValue EXEC GetMyValue

DECLARE @localVariable int
SET @localVariable = (SELECT TOP 1 newvalue FROM @tmpNewValue ) 
```

没有更直接的方法吗？这不是一种昂贵的（就性能而言）方式吗？

我的存储过程没有输出参数，它只是返回一个值。使用输出参数会更快吗？

值得我使用 MS SQL Server 2005

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T18:30:48.793

如果您获得单个返回变量，那么是的，您可以这样做：

```
declare @localVariable int
exec @localVariable =GetMyValue
select @localVariable 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T18:51:52.583

请参阅[如何在存储过程之间共享数据](http://www.sommarskog.se/share_data.html)
由于某些原因，'exec @localVariable =GetMyValue' 对我不起作用（MS SQL 2005），它总是返回 0 值（[它们有相同的问题](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=119470)）。

我的意见是：
如果可以更改存储过程，请添加输出参数。
否则，如果您可以删除过程，请将其重写为函数。
否则像你一样使用表变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T18:36:26.237

此过程是返回 1 行 1 列的行集还是根本没有行集，而您只想捕获返回码？

如果你只想要返回码，那么使用 Josh 的方法，否则使用 OUTPUT 参数 sicne 它会比你现在做的快得多

解释我的意思运行这段代码

```
use tempdb
go

create proc GetMyValue
as
select 1
go

create table #temp (id int)
declare @localVariable int

insert #temp
exec @localVariable =GetMyValue
select @localVariable,* from #temp 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T08:13:02.647

试试这个：

```
create proc AvilableSeats
as
declare @v1 int,@v2 int
exec @v1= determinPath_Capacity 1,'Sat-Tue',32
exec @v2=Student_fGroup '6/12/2009'
select @v1-@v2 
```

# .net - Windows 工作流类型加载异常

> ID：570729
> 
> 赞同：0
> 
> 时间：2009-02-20T18:26:51.940
> 
> 标签：.net, workflow-foundation

我正在使用 Windows 工作流构建一个状态机，并且我正在尝试从我的解决方案中的另一个程序集中新建一个对象。当我构建解决方案时，我从 StateActivityValidator 获得一个 TypeLoadException（它在成功构建后运行以查看所有必需的属性都已设置等）。

我试图创建实例的类型非常简单，它有一个默认的公共构造函数，并且两个程序集都已签名。任何想法可能是什么问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:48:35.753

此问题是由 GAC 中这些程序集的不匹配版本引起的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:58:43.907

我的猜测是在 WF 试图反序列化之前没有加载这个其他程序集。您可以通过在应用程序开始执行之前简单地新建一个这种类型的实例来测试这一点（即，在您的 Program 类的 Main 方法中，对于 winforms 应用程序）。

如果是这种情况，您可以尝试一些方法。

**首先**，在反序列化之前强制加载内存中需要的所有程序集（如上面的测试）。这个方法，恕我直言，糟透了。

**其次**，[您可以将逻辑添加到运行时类型解析。](http://msdn.microsoft.com/en-us/library/system.appdomain.typeresolve.aspx) 这似乎是可能的，但我从来没有这样做过。

**第三**，修改您的序列化工作流程，为其提供加载类型所需的信息。

我不确定你是如何序列化你的工作流程的，所以我不能确切地告诉你如何做到这一点。我可以告诉你，工作流被序列化为 xaml。XamlReader 可以在反序列化时加载 xaml 中包含的类型的程序集。这是通过使用一种[特殊类型的 XML 名称空间](http://msdn.microsoft.com/en-us/library/ms747086.aspx)来完成的。

假设这是您缺少的类型（在序列化工作流程中）：

```
<MyType><!--blahblah--></MyType> 
```

并且 MyType 在程序集 MyCode.DLL 中定义：

```
namespace MyCodeNamespace
{
  public class MyType { /*yadda*/ }
} 
```

那么这种类型的命名空间将是： `clr-namespace:MyCodeNamespace;assembly=MyCode` 并且它将在您的序列化工作流程中显示为：

```
<MyType namespace="clr-namespace:MyCodeNamespace;assembly=MyCode"><!--blahblah--></MyType> 
```

XamlReader 识别该命名空间，确定程序集称为 MyCode.DLL 或 MyCode.EXE，查找它，将其加载到内存中，然后查找 MyCodeNamespace.MyType。

然后问题变成了，“我如何让我的工作流程序列化该命名空间？？？” 答案是“我不知道”。也许您可以使用以下程序集属性：

```
[assembly: XmlnsPrefix("clr-namespace:MyCodeNamespace;assembly=MyCode", "MyCode")]
[assembly: XmlnsDefinition("clr-namespace:MyCodeNamespace;assembly=MyCode", "MyCodeNamespace")] 
```

但我不确定工作流序列化程序是否会尊重这些。见鬼，我什至不确定工作流序列化程序是否会首先尊重 clr-命名空间。您可以尝试一下，如果没有基于此就 SO 提出另一个问题。

# windows-server-2003 - Commerce Server：自定义计数器文件视图内存不足

> ID：570736
> 
> 赞同：0
> 
> 时间：2009-02-20T18:29:47.190
> 
> 标签：windows-server-2003, performancecounter, commerceserver2007

Commerce Server 似乎为每个目录/站点添加了大量计数器，我们目前正在推送其中的 45 个。我尝试增加 machine.config 中的大小，这有帮助，但还不够。

有谁知道如何以编程方式清除商务服务器计数器？除此之外，禁用它们？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T17:04:11.473

因此，经过大量研究，我最终将这个 .reg 文件放在一起，该文件将禁用所有计数器。将其复制/粘贴到 .reg 文件中，运行它，然后重新启动服务器，它将停止为商业服务器注册计数器

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Commerce: Catalog\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Commerce: Catalog Pipeline\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Commerce: Marketing\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Commerce: Orders\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Commerce: Pipelines\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Commerce: PromoCode Pipeline\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\csauthperf\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\cscustomperf\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\csdwperf\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\csmarketingperf\Performance]
"Disable Performance Counters"=dword:00000001

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\csupmperf\Performance]
"Disable Performance Counters"=dword:00000001 
```

# math - 如何计算入射角？

> ID：570739
> 
> 赞同：4
> 
> 时间：2009-02-20T18:31:18.233
> 
> 标签：math, raytracing

我正在为一个大型项目开发光线追踪器，目标是在不担心 CPU 时间的情况下生成逼真的渲染。基本上是预渲染，所以我要追求准确性而不是速度。

我在理解事物照明方面的一些更高级的数学时遇到了一些麻烦。基本上，我的观点是有道理的。假设没有距离衰减，我应该能够使用我找到的多边形上的点，并将该点的法线与光线的入射角进行比较，以计算出我的照明值。因此，给定平面上的一个点、该平面的法线和点光源，我将如何计算出该角度？

我问的原因是我似乎找不到任何关于找到入射角的参考。我可以找到很多参考资料，详细说明一旦获得它该怎么做，但没有告诉我如何首先获得它。我想这很简单，但我无法将其逻辑化。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T18:35:31.747

如果您已经对向量进行了归一化，则表面法线向量和入射光向量的[**点积将为您提供入射角的余弦值。**](http://en.wikipedia.org/wiki/Dot_product)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T19:01:32.527

在我看来，您正在尝试计算漫反射照明。假设你有[Surface Point http://www.yourequations.com/eq.latex?%5Cinline%20%5Coverrightarrow%7Bp_o%7D 表面](http://www.yourequations.com/eq.latex?%5Cinline%20%5Coverrightarrow%7Bp_o%7D)上的点，[Light Position http://www.yourequations.com/eq.latex ?%5Cinline%20%5Coverrightarrow%7Bp_L%7D](http://www.yourequations.com/eq.latex?%5Cinline%20%5Coverrightarrow%7Bp_L%7D)和[法线向量 http://www.yourequations.com/eq.latex?%5Cinline%20%5Coverrightarrow%7Bn%7D](http://www.yourequations.com/eq.latex?%5Cinline%20%5Coverrightarrow%7Bn%7D)法线向量。您可以像这样计算漫射照明：

[漫射照明 http://www.yourequations.com/eq.latex?%5Coverrightarrow%7BL%7D%3D%5Coverrightarrow%7Bp_L%7D-%5Coverrightarrow%7Bp_o%7D%5C%5C%0AI_d%3Dk%2a%5Cfrac% 7B%5Coverrightarrow%7BL%7D%5Ccdot%5Coverrightarrow%7Bn%7D%7D%7B%5C%7C%5Coverrightarrow%7BL%7D%5C%7C%2a%5C%7C%5Coverrightarrow%7Bn%7D%5C%7C% 7D](http://www.yourequations.com/eq.latex?%5Coverrightarrow%7BL%7D%3D%5Coverrightarrow%7Bp_L%7D-%5Coverrightarrow%7Bp_o%7D%5C%5C%0AI_d%3Dk%2a%5Cfrac%7B%5Coverrightarrow%7BL%7D%5Ccdot%5Coverrightarrow%7Bn%7D%7D%7B%5C%7C%5Coverrightarrow%7BL%7D%5C%7C%2a%5C%7C%5Coverrightarrow%7Bn%7D%5C%7C%7D)

从技术上讲，您不需要计算实际的入射角，因为您只需[要点积](http://en.wikipedia.org/wiki/Dot_product)方便地为您提供的余弦值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T19:02:05.803

注意：从我现在坐的地方，我无法为您上传图片。不过，我会尝试用文字为您说明。

以下是您可以想象的这个过程：

[将alt 文本 http://www.yourequations.com/eq.latex?%5Chat%7Bn%7D](http://www.yourequations.com/eq.latex?%5Chat%7Bn%7D)定义为标准化法线（来自平面多边形的垂直向量，具有单位长度，使数学更容易）。

[将替代文本 http://www.yourequations.com/eq.latex?p_0](http://www.yourequations.com/eq.latex?p_0)定义为您的眼球。

[将替代文本 http://www.yourequations.com/eq.latex?p_1](http://www.yourequations.com/eq.latex?p_1)定义为“眼球射线”在多边形上的影响点。

[将替代文本 http://www.yourequations.com/eq.latex?%5Chat%7Bv%7D](http://www.yourequations.com/eq.latex?%5Chat%7Bv%7D)定义为从[替代文本 http://www.yourequations.com/eq.latex?p_1](http://www.yourequations.com/eq.latex?p_1)指向[替代](http://www.yourequations.com/eq.latex?p_0)文本的归一化向量[http://www.yourequations.com/eq.latex?p_0](http://www.yourequations.com/eq.latex?p_0)。你可以这样写：

[替代文字 http://www.yourequations.com/eq.latex?%5Chat%7Bv%7D%20=%20%5Cfrac%7B%5Coverrightarrow%7B(p_0%20-%20p_1)%7D%7D%7B| |p_0%20-%20p_1||%7D](http://www.yourequations.com/eq.latex?%5Chat%7Bv%7D%20=%20%5Cfrac%7B%5Coverrightarrow%7B(p_0%20-%20p_1)%7D%7D%7B||p_0%20-%20p_1||%7D)

因此，您创建了一个从[alt 文本 http://www.yourequations.com/eq.latex?p_1](http://www.yourequations.com/eq.latex?p_1)指向[alt 文本 http://www.yourequations.com/eq.latex?p_0](http://www.yourequations.com/eq.latex?p_0)的向量，然后分割该向量通过它自己的长度，给你一个长度为 1 的向量，它从[alt 文本 http://www.yourequations.com/eq.latex?p_1](http://www.yourequations.com/eq.latex?p_1)指向[alt 文本 http://www.yourequations.com/eq.latex?p_0](http://www.yourequations.com/eq.latex?p_0)

我们遇到所有这些麻烦的原因是我们真的想要角度[替代文本 http://www.yourequations.com/eq.latex?%5Ctheta](http://www.yourequations.com/eq.latex?%5Ctheta)这是正常[替代文本 http://www 之间的角度。 yourequations.com/eq.latex?%5Chat%7Bn%7D](http://www.yourequations.com/eq.latex?%5Chat%7Bn%7D)和您刚刚创建的矢量[替代文本 http://www.yourequations.com/eq.latex?%5Chat%7Bv%7D 。](http://www.yourequations.com/eq.latex?%5Chat%7Bv%7D)theta 的另一个词是*入射角*。

计算这个入射角的一个简单方法是使用[点积](http://en.wikipedia.org/wiki/Dot_product#Geometric_interpretation)。使用上面定义的术语，您获取每个单位长度向量的 x、y 和 z 分量，将它们相乘并相加得到点积。

[替代文字 http://www.yourequations.com/eq.latex?%5Chat%7Bn%7D%20%5Ccdot%20%5Chat%7Bv%7D%20=%20%5Ccos%7B%5Ctheta%7D%20= %20n_x%20%20v_x%20+%20n_y%20%20v_y%20+%20n_z%20%20v_z](http://www.yourequations.com/eq.latex?%5Chat%7Bn%7D%20%5Ccdot%20%5Chat%7Bv%7D%20=%20%5Ccos%7B%5Ctheta%7D%20=%20n_x%20%20v_x%20+%20n_y%20%20v_y%20+%20n_z%20%20v_z)

因此，要计算[替代文本 http://www.yourequations.com/eq.latex?%5Ctheta](http://www.yourequations.com/eq.latex?%5Ctheta)，您只需在点积上使用反余弦：

[替代文字 http://www.yourequations.com/eq.latex?%5Ctheta%20=%20%5Carccos%28%5Chat%7Bn%7D%20%5Ccdot%20%5Chat%7Bv%7D%29](http://www.yourequations.com/eq.latex?%5Ctheta%20=%20%5Carccos%28%5Chat%7Bn%7D%20%5Ccdot%20%5Chat%7Bv%7D%29)

编辑：修改以上内容以添加[yourequations.com](http://yourequations.com/)格式。

# eclipse - 我可以使用 jtracert 对在 Eclipse 中运行的单元测试进行序列图吗？

> ID：570740
> 
> 赞同：0
> 
> 时间：2009-02-20T18:31:29.323
> 
> 标签：eclipse, junit, sequence-diagram, jtracert

我将如何使用 jtracert 对在 eclipse 中运行的 junit 测试进行序列图？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-13T10:41:02.980

在“运行”对话框中，选择您的 JUnit 配置并转到“参数”选项卡。将 jTracert 参数添加到“VM 参数”部分（类似于 -javaagent:/home/dmitrybedrin/work/jtracert/deploy/jTracert.jar）

单击“运行”按钮。

您将在“控制台”选项卡中看到以下内容：

jTracert 代理已启动 等待来自端口 7007 上的 jTracert GUI 的连接

现在执行 jTracert gui 并连接到 jTracert 代理。

就是这样 - 您现在将看到序列图！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T09:13:12.170

我之前的回答中有一个小错误 - 您应该将 -javaagent:/home/dmitrybedrin/work/jtracert/deploy/jTracert.jar= **7007**指定到“VM arguments”部分。

# .net-3.5 - 如何在 RDLC 报告上显示图像

> ID：570747
> 
> 赞同：9
> 
> 时间：2009-02-20T18:34:05.933
> 
> 标签：.net-3.5, reportviewer, rdlc

我有一份 RDLC 报告，并希望此报告的表格中的一列显示图像。我的报告的数据源是一个类，它有一个名为 Image 的类型的属性`System.Drawing.Image`。

在我的报告中，我将图像控件拖到列上，并设置了以下属性：

```
MIMEType:  image/png
Source:  Database
Value:  =Fields!Image.Value 
```

当我运行我的报告时，我得到一个损坏的图像。

我真的很感激任何建议！

在此先感谢 :o)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T19:50:46.013

我不知道这是否是最好的解决方案，但我得到了它的工作。看起来问题出在使用 System.Drawing.Image 上。

在我的课堂上，我创建了一个名为 ImageByte 的新属性，类型为 byte[]。我没有为 ImageByte 制作 setter，但我制作了一个执行以下操作的 getter：

```
MemoryStream ms = new MemoryStream();
Image.Save(ms, System.Drawing.Imaging.ImageFormat.Png);
return ms.ToArray(); 
```

我更新了我的报告以将 =Fields!ImageByte.Value 作为值，现在一切似乎都按预期工作:o)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-01-25T07:17:25.190

首先，您在 Load 事件的项目中采用一个新表单，您在下面写下这一行：

```
reportViewer1.LocalReport.EnableExternalImages = true; 
```

之后在该页面上获取reportViewer并设置智能标记，选择设计新报表并从工具箱中获取图像控件，设置其属性

```
Source = External Value = file:\D:Images\Sunset.jpg 
```

**注意：图片（Sunset.jpg）保存在 D 盘的 Images 文件夹中。您根据您的要求更改了它。**

# security - SharePoint 开发权限

> ID：570755
> 
> 赞同：2
> 
> 时间：2009-02-20T18:37:36.423
> 
> 标签：security, sharepoint

您好我正在使用 SharePoint 命名空间从整个网站的各种列表中提取项目。我的 Web 部件有效，但仅在我的帐户上有效。当我在另一个帐户上尝试它时，它给了我页面的“错误：访问被拒绝”。我已取出所有 Web 部件，页面上只有这个 Web 部件。当我删除以下行时，页面会为每个人加载，当我重新添加它时它不起作用。我猜这是一些权限问题。我想知道是否可以通过分配要使用的用户 ID 以编程方式查询 SharePoint 上的不同列表？感谢您的任何帮助

```
...
SPSite site = new SPSite(_SPSite);           
SPWeb eachWeb = site.AllWebs[0];
SPListItemCollection myItemCollection = eachWeb.Lists["Listings"].Items;
... 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T18:51:08.060

您是对的，当您使用的帐户无权访问当前网站中的“列表”列表时，会发生访问被拒绝错误。

解决此问题的最简单方法是使用 SPSecurity.RunWithElevatedPrivileges 调用：

```
SPSecurity.RunWithElevatedPrivleges(delegate()
{
     //Your code here
}); 
```

它将使用 SharePoint/System 帐户运行匿名方法中包含的任何代码，从而授予完全控制权。不过在使用这种技术时要小心，因为它等同于在完全信任的情况下使用超级用户帐户运行代码。还有[其他](http://blogs.technet.com/jasbro/archive/2007/12/12/spsecurity-runwithelevatedprivileges.aspx) [注意事项](http://daniellarson.spaces.live.com/Blog/cns!D3543C5837291E93!1993.entry)需要注意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T18:46:32.110

尝试：

```
SPWeb eachWeb = SPContext.Current.Site.RootWeb.Webs[0];
SPListItemCollection myItemCollection = eachWeb.Lists["Listings"].Items; 
```

请记住，SPWeb 应该在一个`using`块中使用，或者在使用后显式处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T00:31:00.923

关于 EvilGoatBob 的第一个警告，我引用：

“如果您在提升的方法中操作任何对象模型元素，则需要在此调用中获取新的 SPSite 引用。例如

```
SPSecurity.RunWithElevatedPrivileges(delegate(){
   SPSite mySite = new SPSite(http://sharepoint/);
   SPWeb myWeb = SPSite.OpenWeb();
   // further implementation omitted
});" 
```

请注意，站点参数是硬编码的——这是因为一个错误。如果您尝试过：

使用 (SPSite 站点 = new SPSite("http://" + System.Environment.MachineName)) {}

您将收到相当通用的“指定 URL 处不存在 SharePoint 网站...”错误。这让我悲痛欲绝。底线是您*必须对*服务器名称进行硬编码（除非有人有替代方案）。首次使用 VSeWSS 1.3 调试 Web 部件时，您也会收到类似的错误消息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T11:15:52.887

在这种情况下，您*不需要*对服务器名称进行硬编码，因为您的要求是从与 Web 部件*相同*的站点内的列表中检索项目。你是对的，如果你的帐户没有足够的权限，那么你会得到拒绝访问。解决方案是在不同的安全上下文中创建一个新的 SPSite 对象，然后执行您的工作：

```
 SPSecurity.RunWithElevatedPrivileges(delegate()
    {
        using (SPSite site = new SPSite(SPContext.Current.Site.Url))
        {
            using (SPWeb web = site.OpenWeb())
            {
                //the web object was retrieved with elevated privileges under the system account.

                //do your work here:
                SPListItemCollection myItemCollection = web.Lists["Listings"].Items;

                //...
            }
        }
    }
    ); 
```

使用上面的代码，您的 webpart 是可移植的，因为没有硬编码，并且在正确的安全上下文中运行，同时处理由 SPSite 和 SPWeb 构造函数创建的所有非托管 SPRequest 对象。

# perl - 当我无法在目标主机上安装模块时，如何创建可移植的 perl？

> ID：570762
> 
> 赞同：12
> 
> 时间：2009-02-20T18:41:54.947
> 
> 标签：perl, cross-platform, cygwin, solaris

我需要在 HP unix / Solaris 主机上运行我在 cygwin Windows 上开发的 Perl 应用程序。我不是 unix 机器上的超级用户，我无法触及默认的 Perl 模块位置，也无法将模块安装到默认的 Perl 模块位置。此外，unix 安装缺少最基本的模块，我无法更改。

例如，我有一个需要[Expect](http://search.cpan.org/dist/Expect)的 Perl 应用程序，它具有本地 C 编译部分。我如何将这个应用程序推出到 unix 及其所需的依赖项，而不必在那个盒子上安装任何其他东西？

有没有办法在 Cygwin Windows 下构建整个 Perl 应用程序，然后将一个可执行文件推出到 unix 并从我的主目录运行它？

* * *

根据迄今为止的答案编辑添加：

[特别感谢 brian](https://stackoverflow.com/questions/570762/how-can-i-create-a-portable-perl-when-i-cant-install-modules-on-the-target-host/571517#571517)，本地 LIB 目录解决方案似乎适用于本机 Perl，但在 Perl 模块需要 C 组件的情况下，跨平台编译，即在 cygwin 上编译以在 Solaris 上运行，实际上是不可能的，因为我担心.

但是，是否有其他 linux 安装帮助，即这在不同风格的 Unix 之间是否可能更容易，例如 linux 上的 Perl 包，然后部署到 Solaris/HP？[像lcc](http://www.cs.princeton.edu/software/lcc/)这样的东西呢？

另外，如果有人在 Windows 上推出了一个本地 Perl 包，其中包含复杂 Perl 应用程序的所有依赖项，然后可以将其作为一个文件移动到 unix，我仍然希望听到更多信息？（我现在明白，如果像 Expect.pm 中那样包含原生 C 代码，它将无法工作，但是如果应用程序仅使用纯 perl 模块呢？）

基本上出于多种原因，我试图尽量减少登录这些“生产”unix 主机所需的时间，并尽可能多地事先在本地进行操作。

* * *

添加了一个新的交叉编译[问题](https://stackoverflow.com/questions/579695/cross-compile-c-code-on-windows-for-a-binary-to-be-run-on-unix-solaris-hpux-linu)，因为我觉得我可能偏离了原来的 perl 问题太远了。

* * *

编辑[——Par](http://par.perl.org/wiki/Main_Page)看起来对纯 Perl 很有希望，虽然同样的交易，但它并不能解决原生扩展的跨平台编译问题

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T22:35:38.737

在这种情况下，我会考虑提供一个完整的应用程序，其中包含它自己的 Perl。你可以选择你喜欢的任何版本和你喜欢的任何模块。编译所有内容，将所有内容组织到一个目录中，然后对结果进行 tar。要部署，请复制文件并解压缩。使用其他人已经注意到的关于库搜索路径等的建议。本质上，您的应用程序有自己的堆栈。

现在，诀窍是交叉编译。为什么要在 Cygwin 上开发？这也是目标吗？您没有 HP/UX 或 Solaris 开发机器是有原因的吗？您的目标是什么架构（RISC、SPARC、英特尔等）。如果您无法获得运行这些硬件的硬件，请为您的目标获取一些虚拟机并在那里进行开发。

除此之外，您可以在任何有权限的地方安装模块。见[perlfaq8](http://faq.perl.org/perlfaq8.html)：

*   [如何保留自己的模块/库目录？](http://faq.perl.org/perlfaq8.html#How_do_I_keep_my_own)
*   [如何将我的程序所在的目录添加到模块/库搜索路径中？](http://faq.perl.org/perlfaq8.html#How_do_I_add_the_dir)
*   [如何在运行时将目录添加到我的包含路径 (@INC)？](http://faq.perl.org/perlfaq8.html#How_do_I_add_a_direc)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T19:09:19.637

使用 Cygwin 在 Windows 上编译一个 Perl 脚本及其所有依赖项并在 Solaris 上运行它是行不通的。

现在的问题是：您可以访问那台 Solaris 计算机上的编译器吗？这并不是因为您没有 root 访问权限，因此您无法通过以下方式在您的主目录中编译和安装 Perl 模块：

```
perl Makefile.PL PREFIX=$HOME 
```

如果您的 Solaris 系统上有可用的 CPAN，您可以通过以下方式在 CPAN shell 中设置前缀：

1.  启动外壳`perl -MCPAN -e shell`；
2.  更改前缀`conf makepl_arg PREFIX=/path/to/your/home/directory`

为了让您的脚本运行，您可以使用`-I $HOME`命令行开关启动 perl，例如：

```
perl -I $HOME script.pl 
```

您的另一个选择是将其放在脚本的开头

```
use lib $ENV{'HOME'}; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T21:38:36.783

我还没有尝试过这个特殊功能，但是[perl2exe](http://www.indigostar.com/perl2exe.htm)说它支持跨平台构建。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T18:47:52.997

将您的环境变量设置`PERLLIB`为您的个人 Perl lib 目录或使用 -I 命令行切换到 Perl 来指示它。

如果您可以访问 HP-UX 机器，您可以在那里编译 Expect 并将其安装在您的目录中。但是从 Windows 到 HP-UX 的交叉编译可能要困难**得多。**您必须构建一个 GCC 交叉编译器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T21:09:03.487

如果您在每个系统上都有一个编译器（以及配置所需的其他一些工具，例如 grep），那么您不仅应该能够编译模块，而且还应该能够构建自己的 perl 可执行文件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T21:57:24.913

你会想要[local::lib](http://search.cpan.org/perldoc?local::lib)。完成后，纯 Perl 模块应该可以跨平台工作，但您必须在外部平台上识别并重新安装已编译的模块。在真正的 unix 上进行初始安装，cygwin 上的 cpan 很慢。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-20T22:53:10.380

我在我的工作系统上遇到过几次。我们有 Perl 5.8 的基本安装，但我无法添加模块。这是我使用的解决方案：

1.  在项目根目录中创建一个名为“lib”的文件夹（例如：~/projects/MyProject/lib）
2.  您从 CPAN 下载的任何模块都应该有一个 Makefile 以及一个名为“lib”的目录。将 lib 文件夹的内容复制到新创建的 lib 文件夹中。一些模块可能只包含一个 .pm 文件，没有 lib 结构。只需复制 .pm 文件。

您的代码应该执行以下操作：首先，使用已正常安装的任何模块，然后取消转换 @INC 环境变量以使用本地库：

```
# Declare Includes --------------------------------------------------------------------------------
use Getopt::Long;
use vars qw($VERSION);
use DirHandle;
use FileHandle;

# Force perl to use our local 'lib' directory for imported modules, this allows us to
# use modules without having to install them in th emain perl assembly. However, this
#also prevents these modules from being used in other projects.
BEGIN { unshift @INC, "lib"; }
use Error qw(:try);
use SOAP::Transport::HTTP;
#use LWP::Protocol::https;
use XML::Simple;
use XML::Writer;
use XML::Writer::String; 
```

这种方法的警告是一些 Perl 模块不使用“lib”方法或有额外的依赖关系。如果遇到问题，请检查模块的 Makefile.PL 并查看它在做什么。

# asp.net-mvc - IIS 和 MVC 的授权问题

> ID：570769
> 
> 赞同：3
> 
> 时间：2009-02-20T18:43:42.150
> 
> 标签：asp.net-mvc, iis, iis-7, authorization

设置授权时遇到一些问题。首先我得到：

```
<authorization>
  <deny users="?" />
</authorization> 
```

所以我拒绝所有未知用户，然后允许他们查看这些页面：

```
<location path="Default.aspx">
  <system.web>
    <authorization>
      <allow users="*" />
    </authorization>
  </system.web>
</location>

<location path="Public">
  <system.web>
    <authorization>
      <allow users="*" />
    </authorization>
  </system.web>
</location> 
```

现在的问题.. 他们可以访问公共页面和 Default.aspx .. 但不能访问 www.mydomain.com 或 www.mydomain.com/ .. 所以 www.mydmain.com/Default.aspx 工作正常。那么如何使这些工作？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T20:18:02.907

请记住，WebForms 和 MVC 之间的受保护资源存在根本区别。在 WebForms 中，您要保护的资源是页面本身，并且由于页面存在于磁盘上的众所周知的路径中，因此您可以使用 Web.config 来保护它们。但是，在 MVC 中，您尝试保护的资源实际上是控制器和操作，而不是单独的路径和页面。如果您尝试保护路径而不是控制器，您的应用程序可能存在安全漏洞。

在 MVC 中，默认情况下，所有控制器 + 操作都可供所有用户访问，包括经过身份验证的用户和访客。为了保护控制器或操作，提供了 [Authorize] 属性。看[http://www.asp.net/learn/mvc/#MVC_Security](http://www.asp.net/learn/mvc/#MVC_Security)了解更多信息。

In short, it sounds like for your application you'd want to attribute every controller *except* the default controller and the Public controller with the [Authorize] attribute.

# python - Python c-api 和 unicode 字符串

> ID：570781
> 
> 赞同：4
> 
> 时间：2009-02-20T18:47:34.793
> 
> 标签：python, c, python-c-api

我需要在 python 对象和各种编码的 c 字符串之间进行转换。使用 PyUnicode_Decode 从 ac 字符串到 unicode 对象非常简单，但是我不知道如何走另一条路

```
//char* can be a wchar_t or any other element size, just make sure it is correctly terminated for its encoding
Unicode(const char *str, size_t bytes, const char *encoding="utf-16", const char *errors="strict")
    :Object(PyUnicode_Decode(str, bytes, encoding, errors))
{
    //check for any python exceptions
    ExceptionCheck();
} 
```

我想创建另一个函数，该函数采用 python Unicode 字符串并使用给定的编码将其放入缓冲区中，例如：

```
//fills buffer with a null terminated string in encoding
void AsCString(char *buffer, size_t bufferBytes,
    const char *encoding="utf-16", const char *errors="strict")
{
    ...
} 
```

我怀疑它与 PyUnicode_AsEncodedString 有关系，但是它返回一个 PyObject 所以我不知道如何把它放到我的缓冲区中......

注意：以上两种方法都是 c++ Unicode 类的成员，该类包装了我正在使用 Python 3.0 的 python api

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T19:26:50.703

> 我怀疑它与 PyUnicode_AsEncodedString 有关系，但是它返回一个 PyObject 所以我不知道如何把它放到我的缓冲区中......

返回的 PyObject 是一个 PyStringObject，因此您只需要使用`PyString_Size`and`PyString_AsString`获取指向字符串缓冲区的指针并将其 memcpy 到您自己的缓冲区。

如果您正在寻找一种*直接*从 PyUnicode 对象进入您自己的 char 缓冲区的方法，我认为您无法做到这一点。

# java - 为什么我的 JMenuBar 不显示？

> ID：570785
> 
> 赞同：3
> 
> 时间：2009-02-20T18:48:19.393
> 
> 标签：java, user-interface, swing

我正在尝试用 java 制作一个 GUI，但是 JMenuBar 已经让我很难过了两天。有人可以告诉我为什么它没有出现吗？

```
import java.awt.*;
import javax.swing.*;
import javax.swing.JPanel;
import java.awt.event.*;
import java.awt.image.*;     
import java.io.*;
import java.util.Arrays;
import javax.imageio.ImageIO;

public class selectionFrame extends JFrame
 {
  Font name;
  Font title;

  public void setup() //can't use constructer because this isn't given a size until after it is constructed.
  { 
   //getContentPane().add(menuBar);
   setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
   getContentPane().setLayout(new FlowLayout());
   //getContentPane().add(j);

   setJMenuBar(createMenuBar());
   //getContentPane().add(createMenuBar());  
  }

  public JMenuBar createMenuBar()
  {
   JMenuBar menuBar;
   JMenu m_file;
   JMenuItem mi_save;
   JMenuItem mi_load;

   JMenu m_edit;
   JMenuItem mi_tileHeight;
   JMenuItem mi_tileWidth;

   menuBar = new JMenuBar();
   m_file = new JMenu("File");
   m_edit = new JMenu("Edit");

   mi_save = new JMenuItem("Save file", KeyEvent.VK_S);
   mi_load = new JMenuItem("Load file", KeyEvent.VK_L);
   mi_tileHeight = new JMenuItem("Set tile height", KeyEvent.VK_H);
   mi_tileWidth = new JMenuItem("Set tile width", KeyEvent.VK_W);

   menuBar.add(m_file);
   m_file.add(mi_save);
   m_file.add(mi_load);

   menuBar.add(m_edit);
   m_edit.add(mi_tileHeight);
   m_edit.add(mi_tileWidth);

   return menuBar;
  }

  public static void main(String[] args) //run
  { 
   selectionFrame sel = new selectionFrame();
   sel.setLocationRelativeTo(null);
   sel.setSize((int) 400 + (sel.getInsets().left + sel.getInsets().right),(int) 400  + (sel.getInsets().top + sel.getInsets().bottom));

   sel.setVisible(true);
   sel.setTitle("Tiles/Meta");
   sel.setResizable(false);
   sel.setFocusable(true);
   sel.getContentPane().setSize(sel.getSize());
   sel.setLocation((int) sel.getX() - (sel.getWidth()/2),(int) sel.getY() -  (sel.getHeight()/2));
   sel.setup();
   sel.repaint();

   } 
 } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T19:57:22.050

你有很多额外的代码。

> ```
> public class SelectionFrame extends JFrame
> {
>     Font name;
>     Font title;
> 
>     public SelectionFrame()
>     {
>         setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
>         setJMenuBar(createMenuBar());
>     }
> 
>     public JMenuBar createMenuBar()
>     {
>         JMenuBar menuBar;
>         JMenu m_file;
>         JMenuItem mi_save;
>         JMenuItem mi_load;
> 
>         JMenu m_edit;
>         JMenuItem mi_tileHeight;
>         JMenuItem mi_tileWidth;
> 
>         menuBar = new JMenuBar();
>         m_file = new JMenu("File");
>         m_edit = new JMenu("Edit");
> 
>         mi_save = new JMenuItem("Save file", KeyEvent.VK_S);
>         mi_load = new JMenuItem("Load file", KeyEvent.VK_L);
>         mi_tileHeight = new JMenuItem("Set tile height",
>         KeyEvent.VK_H);
>         mi_tileWidth = new JMenuItem("Set tile width",
>         KeyEvent.VK_W);
> 
>         menuBar.add(m_file);
>         m_file.add(mi_save);
>         m_file.add(mi_load);
> 
>         menuBar.add(m_edit);
>         m_edit.add(mi_tileHeight);
>         m_edit.add(mi_tileWidth);
> 
>         return menuBar;
>     }
> 
>     public void main( String args[] )
>     {
> 
>         SelectionFrame sel = new SelectionFrame();
>         sel.setLocationRelativeTo(null);
>         sel.setSize(400 + (sel.getInsets().left + > sel.getInsets().right), 400
>         + (sel.getInsets().top + sel.getInsets().bottom));
> 
>         sel.setTitle("Tiles/Meta");
>         sel.setResizable(false);
>         sel.setFocusable(true);
> 
>         sel.getContentPane().add( new JLabel( "Content", SwingConstants.CENTER),
>          BorderLayout.CENTER );
>         sel.setLocation(sel.getX() - (sel.getWidth() / 2), sel.getY() - >             (sel.getHeight() / 2));
>         sel.setVisible(true);
> 
>     }
> } 
> ```

这会显示一个菜单栏和所有内容。如果您将内容添加到内容窗格的 CENTER（默认情况下为边框布局），则中心会自动填充整个内容区域，您无需调整任何大小。

这显示为一个带有菜单栏的窗口，一切正常。

你在什么平台上做这个？我在 Vista 上，我得到了我期望看到的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:07:06.367

您使用的是什么 Java 版本？您的菜单栏在我的系统上的 1.6.0_10 中显示良好。尝试将 main 方法的主体包装在`invokeLater()`调用中，以便它在正确的线程上运行，如下所示：

```
public static void main(String[] args)
    {
        SwingUtilities.invokeLater(new Runnable() {
            public void run() {
                selectionFrame sel = new selectionFrame();
                sel.setLocationRelativeTo(null);
                sel.setSize((int) 400 + (sel.getInsets().left + sel.getInsets().right), 
                            (int) 400 + (sel.getInsets().top + sel.getInsets().bottom));
                sel.setTitle("Tiles/Meta");
                sel.setResizable(false);
                sel.setFocusable(true);
                sel.getContentPane().setSize(sel.getSize());
                sel.setLocation((int) sel.getX() - (sel.getWidth() / 2),
                                (int) sel.getY() - (sel.getHeight() / 2));
                sel.setup();
                sel.setVisible(true); // Follow Kendrick's advice too.
            }
        });
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T20:18:51.267

原来你必须在**JFrame**的构造函数中设置 JMenuBar。我在查看我的代码和标记的答案代码之间的差异时发现了这一点。

谢谢你的精彩回答，约翰·加德纳。如果没有你，我很可能会被困几个月。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-16T08:41:04.250

在我的情况下，我已经找到了一个缺少的菜单栏，我在其中设置了**RootPane**布局，tsk tsk。RootPane（参见例如[http://download.java.net/jdk7/archive/b123/docs/api/javax/swing/JRootPane.html](http://download.java.net/jdk7/archive/b123/docs/api/javax/swing/JRootPane.html)）控制菜单栏的布局，所以当我更改它的布局管理器时它丢失了酒吧。

相反，应该使用**ContentPane**来布局和添加组件，例如：

```
frame.getContentPane().setLayout(...);
frame.getContentPane().add(...); 
```

供将来参考...这与可见的组件无关（正如OP所说，框架可见但菜单栏不可见），我有工作代码将 JMenuBar 设置在构造函数之外，并且在摆动时-thread-safe 是良好实践，它不是问题的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T18:55:45.177

当我编译并运行它时，它会显示一个带有文件和编辑菜单项的菜单栏。你期待更多吗？

另外，将您的课程大写 - SelectionFrame

编辑：我忘了看的一件事，你的代码和这里的每个答案在技术上都是错误的。通常，它恰好可以工作，但是除非您在[AWT 工作线程](http://en.wikipedia.org/wiki/Event_dispatching_thread)中，否则不允许您对 Swing 组件做任何事情。

通常，您不必过多考虑工作线程，因为来自窗口的每个事件无论如何都将在工作线程上，但是当您构建初始框架时往往会忘记它 - 而且更常见的是不是它只是工作。

Sun 曾经建议您可以在 AWT 线程之外使用组件，直到实现窗口（使用 pack() 或 setVisible(true)），但这[不再被认为是安全](http://www.javaworld.com/javaworld/jw-08-2007/jw-08-swingthreading.html?page=5)的。

解决此问题的最简单方法可能是让您的主线程在更新您的 SelectionFrame 之前创建一个摆动工作线程。

只有 50-50 的机会可以解决您的问题，但在使用 GUI 时仍应考虑到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T18:58:03.283

sel.setVisible(true);

应该是你打电话的最后一件事......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T19:24:18.777

此外，就在调用`sel.setVisible(true);`请调用之前`sel.pack();`

请注意，在框架打包期间`setSize`使用它会更好，而不是使用它。`setPreferredSize`

与您的问题没有直接关系，但在使用 Swing 时，使用一个好的布局管理器是一个巨大的时间和挫折救星。[MigLayout](http://www.miglayout.com/)简直就是一个优秀的一站式布局管理器。

# c - 如何停止对套接字的读取操作？

> ID：570793
> 
> 赞同：4
> 
> 时间：2009-02-20T18:49:18.673
> 
> 标签：c, networking

从一个线程我得到以下代码：

```
int next_stuff(char **code){
    ...       
    len=read(file_desc,buffer+end_len,packet_size-end_len);
    if(len<=0)
    {
        if(len==-1 && errno==EAGAIN) return(0);
        else return(-1);
    }
    ...
}

while (next_stuff(&buff) == 0)
{
    ...
} 
```

在另一个线程上，我想完成那个套接字并退出这个操作，但只做一个

```
close(file_desc); 
```

不会导致 read 返回非阻塞。我错过了什么吗？

编辑：

关机也不起作用。我正在 Linux 2.6.23 上尝试

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T19:41:46.673

关机（fd，SHUT_RD）；

$ man -s 2 关机

NAME shutdown -- 关闭全双工连接的一部分

概要

```
 #include <sys/socket.h>

 int     shutdown(int socket, int how); 
```

描述

```
 The shutdown() call causes all or part of a full-duplex connection on the socket 
 associated with socket to be shut down.  
 If how is SHUT_RD, further receives will be disallowed.  If how is 
 SHUT_WR, further sends will be
 disallowed.  If how is SHUT_RDWR, further sends and receives will be disallowed. 
```

返回值

```
 The shutdown() function returns the value 0 if successful; otherwise the value -1 is 
 returned and the global variable errno is set to indicate the error. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:08:23.290

一般来说，如果您不想阻塞套接字调用，您会使用 select() 来查看套接字是否准备好读取、写入或处于错误状态。此外，将超时值传递给 select() 以便此调用不会永远阻塞。在 select() 调用返回后，您可以查看应用程序是否要退出，如果是，请执行“正确”的操作（由您决定）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T19:06:21.657

如果您的 read() 调用是非阻塞的，它应该会很快返回，因为它所做的只是插入内存。为了防止造成任何损害，您可以在调用 read() 和 close() 周围使用互斥锁，这样它们就不能同时运行。

如果您的套接字阻塞，我认为您应该将其设为非阻塞。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T19:42:18.483

关于非阻塞套接字的其他答案很好，我建议重新编码以使用该方法。

但是，作为对您问题的直接回答，请尝试调用 shutdown() 并查看这是否会使另一个线程无法读取。恐怕 close() 只是减少使用次数，而 shutdown() 会主动拆除套接字。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T22:33:03.360

我认为您还没有提供足够的信息来回答这个问题。例如，如果您打开的套接字是 UDP，那么发送端的关闭对接收端没有影响。如果是 TCP，那么其他东西就坏了。我建议，如果您真的在处理套接字，请使用`recv`or`recvfrom`代替`read`.

在 TCP 的情况下，您的读取将返回 0 字节，表示另一端已关闭连接。

If you are really doing this between two threads instead of two processes, a pipe may be more appropriate. That's not to say that a pipe could not also be used between two separate processes, it just takes a bit more set up in that case.

# c# - 以编程方式在 Asp.Net ListView 中选择项目

> ID：570801
> 
> 赞同：6
> 
> 时间：2009-02-20T18:51:03.537
> 
> 标签：c#, asp.net, listview, listviewitem, selecteditemtemplate

快速搜索后，我找不到这个看似简单的事情的答案。

**如何在 Asp.Net ListView 中手动选择项目？**

我有一个 SelectedItemTemplate，但我不想使用 asp:button 或 asp:LinkBut​​ton 来选择一个项目。我希望从 URL 完成。例如，像 QueryString 一样。

我想象的方式是在 ItemDataBound 上，检查一个条件，然后将其设置为选中（如果为真），但我该怎么做呢？

**例如：**

```
protected void lv_ItemDataBound(object sender, ListViewItemEventArgs e) {

  using (ListViewDataItem dataItem = (ListViewDataItem)e.Item) {

     if (dataItem != null) {
        if( /* item select condition */ ) {   

            // What do I do here to Set this Item to be Selected?
            // edit: Here's the solution I'm using :
            ((ListView)sender).SelectedIndex = dataItem.DisplayIndex;

            // Note, I get here and it gets set
            // but the SelectedItemTemplate isn't applied!!!

        }
     }
  }
} 
```

我确定这是一两行代码。

**编辑：**我更新了代码以反映解决方案，似乎我可以选择 ListView 的 SelectedItemIndex，但是，它实际上并没有呈现 SelectedItemTemplate。我不知道我是否应该按照**下面的建议在 ItemDataBound 事件中**执行此操作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T20:26:27.567

我查看了引擎盖下 ListView 中发生的一些事情，并认为这可能是最好的方法。

```
void listView_ItemCreated(object sender, ListViewItemEventArgs e)
{
    // exit if we have already selected an item; This is mainly helpful for
    // postbacks, and will also serve to stop processing once we've found our
    // key; Optionally we could remove the ItemCreated event from the ListView 
    // here instead of just returning.
    if ( listView.SelectedIndex > -1 ) return; 

    ListViewDataItem item = e.Item as ListViewDataItem;
    // check to see if the item is the one we want to select (arbitrary) just return true if you want it selected
    if (DoSelectDataItem(item)==true)
    {
        // setting the SelectedIndex is all we really need to do unless 
        // we want to change the template the item will use to render;
        listView.SelectedIndex = item.DisplayIndex;
        if ( listView.SelectedItemTemplate != null )
        {
            // Unfortunately ListView has already a selected a template to use;
            // so clear that out
            e.Item.Controls.Clear();
            // intantiate the SelectedItemTemplate in our item;
            // ListView will DataBind it for us later after ItemCreated has finished!
            listView.SelectedItemTemplate.InstantiateIn(e.Item);
        }
    }
}

bool DoSelectDataItem(ListViewDataItem item)
{
    return item.DisplayIndex == 0; // selects the first item in the list (this is just an example after all; keeping it simple :D )
} 
```

**笔记**

*   ListView 选择项目在 DataBinding 事件触发后将使用的模板。因此，如果在此之前设置了 SelectedIndex，则无需进行更多工作
*   在 DataBinding 工作后的任何位置设置 SelectedIndex，您只是没有获得 SelectedItemTemplate。为此，您要么重新绑定数据；要么 或在 ListViewItem 上重新实例化 SelectedItemTemplate。*请务必先清除 ListViewItem.Controls 集合！*

**更新**我已经删除了大部分原始解决方案，因为这应该会更好并且适用于更多情况。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T18:59:55.107

您可以设置 ListViews SelectedIndex

```
list.SelectedIndex = dataItem.DisplayIndex; // don't know which index you need
list.SelectedIndex = dataItem.DataItemIndex; 
```

## 更新

如果您在页面加载时加载数据，您可能必须遍历数据以查找索引，然后在调用 DataBind() 方法之前设置 SelectedIndex 值。

```
public void Page_Load(object sender, EventArgs e)
{
  var myData = MyDataSource.GetPeople();
  list.DataSource = myData;
  list.SelectedIndex = myData.FirstIndexOf(p => p.Name.Equals("Bob", StringComparison.InvariantCultureIgnoreCase));
  list.DataBind();
}

public static class EnumerableExtensions
{
    public static int FirstIndexOf<T>(this IEnumerable<T> source, Predicate<T> predicate)
    {
        int count = 0;
        foreach(var item in source)
        {
            if (predicate(item))
                return count;
            count++;
        }
        return -1;
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T18:59:29.473

```
list.SelectedIndex = list.Items.IndexOf(item); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T19:05:56.993

扩展@Jeremy 和@bendewey 的答案，您不需要在ItemDataBound 中执行此操作。您只需要在设置 SelectedValue 之前已经发生 ListView 绑定。您应该能够在 PreRender 期间执行此操作。有关何时发生绑定的更多信息，请参阅此页面生命周期[文档](http://msdn.microsoft.com/en-us/library/ms178472.aspx)。

# sql-server - 如何使用 SSIS 在 SQL Server 2005 中复制和覆盖数据库？

> ID：570805
> 
> 赞同：4
> 
> 时间：2009-02-20T18:52:03.580
> 
> 标签：sql-server, database, copy

我必须在这里错过一些非常简单的东西！

我的开发环境中有一个名为 Project 的数据库。我的测试环境中有一个名为 Project_UAT 的数据库。

我创建了一个 SSIS 包，它成功地将我的数据库从 Project 复制到 Project_UAT。我很确定这消除了大多数权限和配置问题。

现在，我想重新创建包，这一次允许它覆盖目标，即 Project_UAT。这仅仅是因为有时我想单击 Microsoft SQL Management Studio 中的一个按钮，该按钮将新的数据库模式、数据、用户和所有内容推送到我的测试环境中。我想覆盖数据。

所以我像以前一样创建包，但是这次我将已经存在的数据库名称指定为“目标数据库”，然后选择名为“在目标服务器上删除具有相同名称的任何数据库，然后继续”的单选按钮与数据库传输，覆盖现有的数据库文件。”

我单击下一步，它告诉我什么？

“数据库名称已存在于目的地”

好吧，我知道！我刚刚告诉你我想覆盖它！

我该如何进行这项工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T19:37:27.807

不确定我是否遗漏了重点，但您为什么不使用任务在部署步骤之前删除/删除现有数据库？

也许您可以限定您在 SSIS 包中使用的 SSIS 组件任务。

干杯，约翰

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T20:09:27.233

您可以将执行 SQL 任务添加到控制流中以删除数据库。只需将 SQLStatement 属性设置为

```
DROP DATABASE Project_UAT 
```

执行此步骤后，Project_UAT 数据库的新副本将不必覆盖旧副本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-26T17:12:47.570

我遇到了这个问题，因为我事先删除了数据库。数据库不在目标文件夹中，但 SQL Server 2008 仍然认为它在那里。刷新没有用。并且 SQL Server 不会尊重选择“在目标服务器上删除任何数据库......”它只是抱怨数据库已经存在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-23T12:06:23.053

伙计们，这是一个常识性的解决方案。很多复杂性都是徒劳的。

备份要复制到的目标数据库并删除目标数据库。

打开复制数据库向导并按照步骤操作。

使用分离和附加方法。

当您到达配置目标数据库时，如果目标数据库存在，请使用选项在目标服务器上选择删除具有相同名称的数据库。

现在它将继续到下一个屏幕。

但这仅在您在启动向导之前先删除目标数据库时才有效。

我可能错过了一些东西，但这对我有用。

# .net - .net 的视觉工作室中的导航面板在哪里？

> ID：570814
> 
> 赞同：1
> 
> 时间：2009-02-20T18:59:24.450
> 
> 标签：.net, visual-studio

我习惯了Netbeans环境，现在我在Visual Studio中学习C#，我似乎无法弄清楚导航器在VS设置中的位置，在NB中它向我显示了一个类的成员，我相信它必须存在于VS中，有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T19:02:10.263

您正在寻找类视图。在“查看”菜单项下查看。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T19:01:32.077

我相信您正在寻找解决方案资源管理器或类视图。两者都位于“查看”菜单中。

# java - 附加到 HTML 内容时，如何保持 SWT 浏览器小部件的底部可见？

> ID：570818
> 
> 赞同：1
> 
> 时间：2009-02-20T19:00:12.077
> 
> 标签：java, javascript, eclipse, swing, swt

我正在 SWT 浏览器小部件中查看 HTML。我将日志消息附加到内容的末尾，并希望始终保持底部可见。目前，每当我将文本附加到内容时，我首先设置新文本：

```
browser.setText(content); 
```

然后我通过 JavaScript 向下滚动浏览器小部件：

```
browser.execute("window.scrollTo(0,100000);"); 
```

这样做的问题是，当我设置文本时，小部件在向下滚动之前再次切换到顶部，所以当我快速附加大量消息时，浏览器小部件大部分时间都显示顶部，切换到时偶尔会闪烁底端。这使得无法跟踪底部记录的内容。

我知道我可以使用树查看器并获得 Eclipse 平台的所有便利，但也有一个 Swing 版本的应用程序，两者都应该使用相同的 HTML 和 CSS 表示。

理想情况下，我想避免嵌入 Swing 组件，但如果有一个允许这样做，我会很高兴听到它。我已经在 J​​ScrollPane 中使用 JEditorPane 进行了尝试，通过编辑器工具包的读取方法附加到内容：

```
editorPane.getEditorKit().read(/*...*/); 
```

然后像这样向下滚动：

```
editorPane.setCaretPosition(editorPane.getDocument().getLength()); 
```

这对于独立的 Swing 应用程序来说非常顺利，但是嵌入在 Eclipse 中它会闪烁并且跟不上 HTML 内容的快速更新。

现在，我可以在 Eclipse 中顺利完成这项工作的唯一方法是在浏览器小部件的内容之前添加而不是添加，但我真的更喜欢在底部添加新消息，而不是在顶部。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T00:47:02.183

每次重写整个 HTML 内容似乎是不必要的忙碌工作，并且可能没有办法阻止某些浏览器在每次重绘整个页面时滚动到顶部。特别是如果您允许您显示的日志变得很长，那么随着日志的变长，这将变得越来越慢。

更好的解决方案可能是使用 JavaScript 附加到页面。你已经在使用

```
browser.execute() 
```

像这样的东西怎么样（假设“ `itemID`”是`DIV`包含内容的ID）：

```
String newContent = newContent.replaceAll("\n", "<br>").replaceAll("'", "\\\\'");
browser.execute("document.getElementById(\"itemID\").innerHTML += '"
                newContent + "'"); 
```

您必须这样做，`replaceAll()`并且您可能需要更多的转换，具体取决于您的日志内容。例如，如果脚本包含换行符，并且需要引用字符串中的单引号，我已经注意到它`browser.execute()`不喜欢它，如上所示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-16T07:35:20.450

我本来只是将其添加为评论，但它不会让我（没有足够的声誉）。您可以通过设置系统属性将 XUL 发送到 mac 上的非标准位置。

System.setProperty("org.eclipse.swt.browser.XULRunnerPath", "/fubar/xul/Versions/1.9.0.7/");

# xhtml - XHTML 兼容的实时信使嵌入

> ID：570819
> 
> 赞同：0
> 
> 时间：2009-02-20T19:00:21.080
> 
> 标签：xhtml, windows-live-messenger

可以将以下代码嵌入网站以添加 windows live messenger 功能。有什么方法可以使这个 XHTML 1.0 Translitional 兼容？

```
 <div
          id="Microsoft_Live_Messenger_PresenceButton_e17530aa6eff7871"
          msgr:width="100"
          msgr:backColor="#DBDBDB"
          msgr:altBackColor="#FFFFFF"
          msgr:foreColor="#424542"
          msgr:conversationUrl="http://settings.messenger.live.com/Conversation/IMMe.aspx?invitee=e17530aa6eff7871@apps.messenger.live.com&mkt=de-DE&useTheme=true&themeName=gray&foreColor=676769&backColor=DBDBDB&linkColor=444444&borderColor=8D8D8D&buttonForeColor=99CC33&buttonBackColor=676769&buttonBorderColor=99CC33&buttonDisabledColor=F1F1F1&headerForeColor=729527&headerBackColor=B2B2B2&menuForeColor=676769&menuBackColor=BBBBBB&chatForeColor=99CC33&chatBackColor=EAEAEA&chatDisabledColor=B2B2B2&chatErrorColor=760502&chatLabelColor=6E6C6C"></div>
        <script type="text/javascript" src="http://messenger.services.live.com/users/e17530aa6eff7871@apps.messenger.live.com/presence?dt=&mkt=de-DE&cb=Microsoft_Live_Messenger_PresenceButton_onPresence"></script> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T22:29:17.007

在 XHTML 中，& 符号总是启动一个实体。因此，您需要将所有 & 替换`&amp;`为 以获取有效的 XML。

由于 XHTML1.0 是在 DTD 中指定的，并且 DTD 不能处理名称空间，因此代码在技术上永远不会是有效的 XHTML1.0 过渡。无论如何，任何理智的应用程序都会这样对待它。

# svn - svn update 锁定不再存在的文件夹

> ID：570824
> 
> 赞同：0
> 
> 时间：2009-02-20T19:02:03.337
> 
> 标签：svn, locking

当我去更新时，我不断收到一个不再存在的文件夹的锁定错误。我的第一个想法是去使用 svn-cleanup 修复任何损坏的东西。相反，清理也会引发错误：

> 运行日志
> svn 出现问题：在目录“C:\xxxxx\xxx\”
> 中 svn：在“C:\xxxxx\xxx\”中处理命令“append”时出错 svn：C:\xxxxx\xxx\
> 中缺少“xyz”属性

除了重新下载整个项目之外，还有什么想法可以清理这个混乱吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:31:16.810

我们使用 TortoiseSVN，由于某种原因，这种情况经常发生（每年 3-4 次）。对我们来说最快的解决方案是删除文件夹并再次检查。十分简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T19:14:24.633

跑

```
svn update 
```

这将找回丢失的文件夹。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T19:14:54.633

我刚刚从tortisesvn 论坛找到了一个[链接。](http://tortoisesvn.tigris.org/ds/viewMessage.do?dsForumId=4061&dsMessageId=1074741)基本上说要再拉项目。如果有人有更好的答案，我愿意知道另一种解决方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T19:15:56.067

您可以删除包含丢失文件夹的父文件夹，还是太大了？

删除父文件夹后，再进行一次 svn 更新。过去，这对我来说适用于您的同样问题。对我来说幸运的是，包含问题文件夹的父文件夹很小。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T19:16:19.480

您可以尝试在其上运行 Revert。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T19:23:56.063

我会尝试再次提取源代码并使用[WinMerge](http://winmerge.org/)进行目录范围的差异。这应该允许您重新应用对任何文件所做的更改并使用*svn remove*正确删除文件夹。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T19:34:15.943

发生这种情况时，我通常会删除有问题的目录（而不是整个项目），然后运行`svn update`以删除丢失的位。

如果这不起作用，那么我再次将整个事情拉下来。

# css - 你是把 IE 条件放在 css 文件还是 html 文件里？

> ID：570827
> 
> 赞同：6
> 
> 时间：2009-02-20T19:02:14.290
> 
> 标签：css

我尝试将 IE 条件放在 CSS 文件中，但这似乎不起作用。是否有 CSS 的构造，所以如果浏览器是 IE，您可以告诉它使用此背景颜色吗？我也找不到任何关于 if then else 条件的东西，它存在吗？有人可以提供一个例子。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-20T19:04:46.793

IE 条件进入 HTML，并且应该用于包含一个额外的 CSS 文件，该文件将根据 IE hack 的需要覆盖 CSS。

* * *

例子：

```
<head>
    <style type="text/css">
    @import url(/styles.css);
    </style>
    <!--[if lte IE 6]>
        <link rel="stylesheet" type="text/css" href="ie6.css" />
    <![endif]-->
</head> 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-20T19:15:33.337

我从 jQuery 中得到启发，并使用我的条件格式来创建容器元素

```
<body class="center">
<!--[if IE 5]><div id="ie5" class="ie"><![endif]-->
<!--[if IE 6]><div id="ie6" class="ie"><![endif]-->
<!--[if IE 7]><div id="ie7" class="ie"><![endif]-->
<!--[if IE 8]><div id="ie8" class="ie"><![endif]-->
    <div class="site text-left">

    </div>
<!--[if IE]></div><![endif]-->
</body> 
```

然后我可以像这样将条件信息放在css中

```
.site { width:500px; }
.ie .site { width:400px; }
#ie5 .site { width:300px; } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T19:23:43.300

CSS 中没有这样的条件，但如果不同版本的 IE 之间的差异不显着，您可以使用“Holly hack”：

```
div.class { /* whatever */ }
* html div.class { /* IE-only */ } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T19:05:37.137

[条件注释]( [http://msdn.microsoft.com/en-us/library/ms537512(VS.85).aspx)](http://msdn.microsoft.com/en-us/library/ms537512(VS.85).aspx))是 HTML 注释，因此不能在 CSS 上下文中使用。

如果您只想针对 IE 使用特定的 CSS 规则，则必须使用 CSS hack。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-01T14:21:29.590

我建议使用与bendewey 提出的解决方案类似的东西，但改为使用 html 标记周围的条件类。据我所知，这是在 Paul Irish 的博客中首次提到的 ( [http://paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/](http://paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/) )

```
<!--[if lt IE 7 ]> <html class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class=""> <!--<![endif]--> 
```

然后在你使用的 css 中：

```
.box {background: blue;}
.ie7 .box {background: green;} 
```

与使用额外 div 的解决方案相比，这具有一些优势。有关详细信息，请查看上面的帖子。

# php - 等价于 PHP 中的 ASP.NET HttpModules

> ID：570833
> 
> 赞同：5
> 
> 时间：2009-02-20T19:05:57.930
> 
> 标签：php, asp.net

PHP 中 ASP.NET HttpModules 的等价物是什么？

如果有的话，我怎样才能将它们包含在该特定应用程序（不是全局）中，换句话说，什么是 web.config

示例：我需要记录请求和标头，如果服务器返回 HTTP 500 错误，而与运行的代码无关。

在 ASP.NET 中，我将有一个 HTTP 模块，我可以在其中获取响应代码和其他详细信息，然后再发送给客户端。我也可以处理开始请求。

我在 PHP 中需要类似的东西

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T19:10:08.247

不幸的是，PHP 更像 ASP，因为“应用程序”是一个松散的概念，文件没有紧密相关，因此您所做的任何事情都可能必须在 Web 服务器级别

假设您在 linux/apache 服务器上。一种方法是使用.htaccess，这些可以在目录（即应用程序级别）进行修改并具有强大的功能。

一个例子是 url 重写：

[http://roshanbh.com.np/2008/02/hide-php-url-rewriting-htaccess.html](http://roshanbh.com.np/2008/02/hide-php-url-rewriting-htaccess.html)

官方 Apache 文档：[http ://httpd.apache.org/docs/1.3/mod/mod_rewrite.html](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T20:56:11.783

您可以查看 Apache 的 ModSecurity：[http ://www.modsecurity.org/](http://www.modsecurity.org/)

它将允许您根据您定义的规则记录完整的 POST 和标题数据。ModSecurity 配置非常强大，但也非常复杂。

> HTTP 流量记录
> 
> Web 服务器通常装备精良，可以以对营销分析有用的形式记录流量，但无法将流量记录到 Web 应用程序。特别是，大多数都无法记录请求正文。您的对手知道这一点，这就是为什么现在大多数攻击都是通过 POST 请求执行的，从而使您的系统失明。ModSecurity 使完整的 HTTP 事务记录成为可能，允许记录完整的请求和响应。它的日志记录工具还允许对记录的确切内容和时间做出细粒度的决策，确保只记录相关数据。由于某些请求和/或响应可能在某些字段中包含敏感数据，因此可以将 ModSecurity 配置为在将这些字段写入审核日志之前对其进行屏蔽。

# perl - 为什么 Date::Calc 抱怨“日期无效”？

> ID：570837
> 
> 赞同：0
> 
> 时间：2009-02-20T19:07:09.377
> 
> 标签：perl, date, date-manipulation

以前，此功能对我有用...

```
$this_day = Day_of_Week($lyear, $month, $day); 
```

使用这个库..

```
use Date::Calc qw(Add_Delta_Days Day_of_Week Delta_Days); 
```

但我需要另一种方法来获取相同的信息。

它返回的错误是

```
Date::Calc::Day_of_Week(): not a valid date 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T19:41:26.597

错误消息说您传递 Date::Calc 一个无效的日期。不要那样做。您可以使用 Date::Calc 的 check_date 函数来确定日期是否有效。

```
use Date::Calc qw(Add_Delta_Days check_date Day_of_Week Delta_Days);

$this_day = (check_date($lyear, $month, $day)
             ? Day_of_Week($lyear, $month, $day)
             : 'INVALID'); 
```

更正无效日期更复杂，因为这取决于您如何获得无效日期，以及您想对它们做什么。例如，如果日期可能超出范围，并且您想将 4 月 31 日更正为 5 月 1 日，则可以使用

```
($lyear, $month, $day) = Add_Delta_Days($lyear, $month, 1,  $day-1); 
```

但这不会纠正无效的年份或月份。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T19:10:04.223

```
use Posix qw(mktime);
my $epoch = mktime(sec, min, hour, mday, mon, year);
my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime($epoch); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T19:10:13.490

它有点巴洛克风格，但我一直很喜欢 Date::Manip。

不过，我认为您不需要替代方法。更有可能的是，您需要停止提供 Date::Calc 无效日期。

它在什么值上出错？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T19:13:42.497

您可以使用[Date::Simple](http://search.cpan.org/dist/Date-Simple/)。

```
use Date::Simple (':all');
my $date = ymd($year, $month, $day);
my $dow = $date->day_of_week(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T19:26:19.097

作为 heeen 答案的替代方案，您可以使用 strftime：

```
use Posix qw(strftime);
my $wday = strftime('%w', sec, min, hour, mday, mon, year); # 0 = Sunday, 1 = Monday, etc...
my $day_name = strftime('%a', sec, min, hour, mday, mon, year); # Sun, Mon, etc...
my $day_name_long = strftime('%A', sec, min, hour, mday, mon, year); # Sunday, Monday, etc... 
```

# oracle - 可能出了什么问题： ping 工作正常，但 tnsping 间歇性工作

> ID：570840
> 
> 赞同：1
> 
> 时间：2009-02-20T19:07:53.387
> 
> 标签：oracle, ora-12560

我们在 Windows Server 2003 上运行了 oracle 10g。几周前，一台使用该数据库运行应用程序的机器突然开始出现连接问题。今天我们为 windows server 运行了自动更新，问题只会变得更糟。我意识到这对于任何人来说都不足以诊断问题，但也许你可以通过以下更具体的场景让我指出正确的方向：

从这台机器上，我们可以毫无问题地 ping 服务器，并且在物理上靠近并且在 Intranet 上返回非常快。

但是，当我们运行 tnsping 时，我在几分钟内看到了 3 个不同的结果。

1.  tnsping 在合理的时间内返回就好了
2.  tnsping 返回但仅在很长一段时间后（几秒钟）
3.  tnsping 导致 ora-12560 协议适配器错误

同时，我可以毫无问题地从我的机器上 tnsping 服务器。

谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:27:30.810

为了帮助消除等式中的 DNS 问题，请在 TNSNAMES.ora 文件中为您的连接指定主机的 IP 地址，而不是主机名。你在使用 DHCP 吗？

您是否消除了硬件问题 - 您是否尝试过不同的 NIC？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:55:36.533

我会尝试检查以下内容：

*   从应用服务器和您的机器执行跟踪路由检查是否有任何异常
*   从其他各种机器检查 tnsping 并尝试识别模式
*   尝试使用 tcp/ip 嗅探器查看连接两端发生的情况
*   获得 Oracle 支持

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T15:30:42.040

在让 oracle 参与此问题之前，请从您的网络管理员处获得一些帮助以进行以下测试。首先在侦听器中的数据库上启用详细日志记录。通过 sqlnet 在客户端上启用日志记录。转到出现 tnsping 问题的机器，让网络管理员运行网络工具从那里跟踪 tcp 数据包。执行 tnsping 并查看是否正在发送什么数据包，正在进行什么 dns 查找，正在采用什么路由。在数据库上查看侦听器是否真的收到来自客户端的 ping。如果没有，请查看网络到数据库的哪个位置出现问题。是名称服务器解析吗？是不是网线坏了，交换机端口坏了，等等。您的网络管理员是解决这个问题的最好朋友。使用简单的连接通过 sqlplus 进行相同的测试，然后查看客户端记录的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T15:13:16.840

在调用 Oracle 之前，我会为 Fail 案例创建一个跟踪文件。

TNSPING.TRACE_LEVEL

目的

使用参数 TNSPING.TRACE_LEVEL 打开、在特定级别或关闭 TNSPING 实用程序跟踪。

默认

离开

值 * off：无跟踪输出 * user：用于用户跟踪信息 * admin：用于管理跟踪信息 * support：用于 Oracle 支持服务跟踪信息

例子

TNSPING.TRACE_LEVEL=管理员

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T19:14:39.673

确保网络上没有其他机器具有相同的 IP 地址。一种方法是将您的机器从网络上拔下，看看您是否仍然可以 ping 它。如果可以，那么这就是问题所在。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T20:15:40.353

如果服务器没有在 dns 服务器上设置域名，则将其 ip 地址和名称添加到服务器上的主机文件中；这（服务器无法在 dns 中找到自己）已知会导致 tns 超时。

# git - 如何删除 git 子树合并？

> ID：570849
> 
> 赞同：3
> 
> 时间：2009-02-20T19:11:14.983
> 
> 标签：git

我有一个项目依赖于使用子树合并策略合并的另外 2 个子项目（如[这里](http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html)和[那里](http://blog.nuclearsquid.com/writings/subtree-merging-and-you)所述）？

一段时间后，我注意到其中一个子项目在当前项目中有自己的生命周期，所以我想将它与原始项目解耦，但我不知道如何实现这一点。

基本上，我注意到子项目列在 .git/config 文件中，所以我想知道从那里删除它是否足够。

在 Jakub 的回答/问题之后，我将尝试在我的问题中添加更多细节。我在 ProjectA 上工作的项目依赖于一个库 LibraryB，它有自己的 git 存储库和自己的生命周期。在设置 ProjectA 时，我使用了子树合并技术来添加 LibraryB 的依赖项（这些步骤正是 VonC 添加的链接中描述的步骤）。现在，ProjectA 需要对 LibraryB 进行一些自定义更改，这些更改不够通用，无法推送回 LibraryB 存储库。所以，我想将 ProjectA 中的 LibraryB 与其主存储库分离（通过分离，我的意思是 ProjectA 中的 LibraryB 将无法从其主存储库更新，并且只会在 ProjectA 内部跟踪其自己的历史记录）。

更多详细信息：检查我的 ProjectA 存储库后，我发现对 LibraryB 存储库的唯一引用位于 ProjectA/.git/config 文件中，格式为：

```
[remote "gaelib"]
    url = ../libraries/gaelib
    fetch = +refs/heads/*:refs/remotes/gaelib/* 
```

并且目录 LibraryB 中没有额外的 git 相关信息包含在 ProjectA (../libraries/gaelib) 中

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-20T18:26:41.493

听起来您想“撤消”子树合并并将其提交回上游。[git subtree split](http://github.com/apenwarr/git-subtree)命令应该这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T22:02:22.140

我不明白。如果您使用子树合并方法将 libraryB 包含在 projectA 存储库中，则无需进行任何解耦。你已经拥有了你需要的东西：

*   您可以从 libraryB 存储库中提取 libraryB 的更新。我猜，这是一件好事。

*   您可以在 projectA 的存储库中提交对 libraryB 的更改。除非您决定将它们推送/拉到另一个存储库，否则此更改将保留在此存储库的本地。它们将仅是 projectA 历史记录的一部分，不会自动传播到 libraryB 存储库。

这就是子树合并方法与子模块方法相反的全部要点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-22T22:11:48.433

是的，从配置文件中删除指向 libraryB 的远程。这将防止任何使用您的仓库的人无意中从远程更新您的本地代码。

您无需做任何其他事情——您不再需要从 LibraryB 存储库中拉取或推送到该存储库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T09:53:34.903

如果您想维护自己的 LibraryB 版本，您有几个选择：

*   您可以使 LibraryB 成为项目的固有部分：只需删除或注释掉`[remote "LibraryB"]`配置文件中的部分，并对项目中的 LibraryB 进行更改。

    缺点是更难为 LibraryB 的规范（第三方）版本发送补丁

*   您可以继续使用“子树”合并，但不是来自 LibraryB 的规范版本，而是来自您自己的该库的克隆（fork）。您将更改 remote.LibraryB.url 以指向您的本地版本，并且您的本地版本将是原始 LibraryB 的克隆。请注意，您应该合并自己的分支，而不是规范 LibraryB 的远程跟踪分支。

    缺点是您必须维护单独的克隆，并记住您自己对 LibraryB 的更改（嗯，至少是那些通用的）必须在 LibraryB 的分支中进行，而不是直接在 ProjectA 中进行。

*   您可能希望从将 ProjectA 和 LibraryB 的历史交织在一起的“子树”合并转移到可以使用[子模块](http://git-scm.com/docs/git-submodule "混帐子模块（1）")（[教程](http://git.or.cz/gitwiki/GitSubmoduleTutorial "Git wiki 上的 Git 子模块教程")）实现的更多分离。在这种情况下，您将拥有 LibraryB 的单独存储库（分支），但它将位于 ProjectA 的工作区域内；ProjectA 中的提交将具有指向 LibraryB 存储库中提交的指针，而不是将 LibraryB 的树作为子树。然后，如果您不想关注 LibraryB 的开发，只需不使用“git submodule update”就足够了（也许只是为了以防万一注释掉或删除指向 LibraryB 规范版本的链接）。

    这样做的好处是可以轻松地将您的改进发送到规范库 B，并且您可以在 ProjectA 的工作区域内进行更改。它的缺点是必须学习略有不同的工作流程。

    此外，还有一个问题是如何从“子树”合并到子模块。您可以：

    *   通过在超级项目工作存储库中的子项目子树中创建 git 存储库（即适当子目录中的“git init”+适当的“git submodule init”等），从子树合并移动到子模块。这意味着您将拥有“子树”直到某个历史点，然后是子模块。
    *   [使用git filter-branch](http://git-scm.com/docs/git-filter-branch "混帐过滤器分支（1）")重写历史以通过子模块替换子树合并。这具有重写历史的缺点（如果有人将他/她的工作基于当前历史，则大不），以及“干净开始”的优点。或者你可以等待“git submodule split”（[git mailing list 上的线程](http://thread.gmane.org/gmane.comp.version-control.git/109667 "[RFC] 'git submodule split' 的最佳 UI 是什么？")）进入 git...
        *不幸[的是，拆分 git 存储库](http://www.ishlif.org/blog/linux/splitting-a-git-repository/)博客文章返回“找不到主机”*

我希望这个版本能解决你的问题。

***免责声明：*** *我个人既没有使用子树合并，也没有子模块，也没有使用 git-filter-branch。*

# batch-file - 如何在 bash 脚本的批处理文件的参数中包含管道字符？

> ID：570851
> 
> 赞同：8
> 
> 时间：2009-02-20T19:11:53.470
> 
> 标签：batch-file, cygwin

我有一个要执行这一行的 shell 脚本：

```
qtvars.bat vsstart "qt.sln" /BUILD "Debug|Win32" 
```

~~这很好用（虽然我不得不修改`qtvars.bat`，但这不是重点）。问题是我希望执行的命令位于变量中：~~ 编辑：如果我将它输入 bash，这也不起作用。以前我将它输入到`cmd.exe`中，这很难进行公平比较。

```
command="qtvars.bat"
args="vsstart"

$command $args "qt.sln" /BUILD "Debug|Win32" 
```

现在它在管道上窒息！我收到这条消息：

```
'Win32' is not recognized as an internal or external command,
operable program or batch file. 
```

我尝试了很多形式的转义引号和/或管道，但都无济于事。有趣的是，当它是可执行文件而不是批处理文件时，它可以工作，例如：

```
command="devenv.exe"
args=""

$command $args "qt.sln" /BUILD "Debug|Win32" 
```

感谢您的任何想法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-03-26T15:15:35.677

我知道您使用 ^ 字符“转义”批处理文件中的管道字符，所以...

回声^| 这里有一些文字^|

会显示...

| 这里有一些文字 |

我不知道在这种情况下这是否对您有帮助？也许尝试在每个管道字符前加上 ^ 看看会发生什么？:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T19:21:41.293

这是双重转义的经典案例，需要指示 bash 和 CMD.EXE 忽略特殊的 | （管道）字符。

尝试以下操作：

```
$command $args "qt.sln" /BUILD '"Debug|Win32"' 
```

这相当于您在 CMD.EXE 提示符下键入：

```
qtvars.bat vsstart qt.sln /BUILD "Debug|Win32" 
```

使用上述内容，您实际上是在强制将双引号传递给 CMD.EXE（而不是 bash 吃掉它们。）最外面的单引号指示 bash 不要以任何方式解释或触摸其中的内容；内部双引号指示 CMD.EXE 忽略其中的任何特殊字符（在本例中为管道）。

或者，您也可以尝试：

```
$command $args "qt.sln" /BUILD 'Debug\|Win32' 
```

这应该相当于您在 CMD.EXE 提示符下键入：

```
qtvars.bat vsstart qt.sln /BUILD Debug\|Win32 
```

请注意*单*引号 (!) 的使用，它确保 bash 不会解释 \（而是将其按原样传递给 CMD.EXE。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-28T14:27:06.383

这是我发现的另一个解决方案（解决方法？）：

首先，确保环境变量定义了管道字符，例如：
`set PIPE="|"`

稍后，运行指定上述定义的环境变量名称的命令：
`"c:\(...)\devenv.com" foo.sln /build Debug%PIPE%Win32`

即使调用者和被调用者之间有多个包装器，它也能完成这项工作。我现在将它与很长的包装链一起使用：Python/Linux -> VirtualBox guest's executeProcess -> Cmd/Windows -> devenv.com

（交叉发布到：[如何将带引号的管道字符传递给 cmd.exe？](https://stackoverflow.com/questions/1200235/how-to-pass-a-quoted-pipe-character-to-cmd-exe/6492191#6492191)）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-11T03:01:58.087

在 Windows 脚本语言中转义管道字符是使用插入符号 (^) 完成的。前几天我不得不这样做。我知道这很旧，但我想我会发布我发现的内容，以防其他人像我一样遇到这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T19:22:16.330

有趣的！逃避`|`做什么？

这些有用吗？

*   回声“调试|Win32”
*   echo "qt.sln" /BUILD '调试|Win32'

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-14T17:47:52.363

我会考虑走简单的路线，而是传递一个占位符令牌 - “$P”，然后在 CMD/Batch 文件中替换它；例如使用 'UnxUtils' SEd 命令进行替换：

```
For /F "usebackq delims=" %%r in (`Echo %Cmd% ^| sed -e "s/$P/|/g"`) do @Set Cmd2=%%r

REM  Now run the command, with the proper pipe symbol in place

%Cmd2% 
```

因此，通过了命令 arg/CMD 脚本 args -“git status $P wc -l”。

# svn - 合并 Subversion 中丢失的更改

> ID：570857
> 
> 赞同：1
> 
> 时间：2009-02-20T19:12:45.497
> 
> 标签：svn, merge

我的开发团队遵循 Subversion 中不稳定的主干、稳定的分支模式。每个月，都会从主干创建一个稳定的发布分支。有时，更改需要从这些发布分支合并到后续发布分支，并最终合并到主干。

问题是，在过去的几个月里，所有这些分支的合并都不正确。由于开发人员误解了他们需要合并哪些修订，许多修订被跳过。

一个不正确的合并历史示例如下所示：

```
 ------------------------------------------------------------------------
r57 | Bob | 2008-11-27 04:02:46 -0600 (Thu, 27 Nov 2008) | 1 line

action:merge; origin:branches/1; target:branches/2; range:28-55
------------------------------------------------------------------------
r28 | Alice | 2008-11-25 10:14:00 -0600 (Tue, 25 Nov 2008) | 1 line

action:merge; origin:branches/1; target:branches/2; range:10-25 
```

在这里，Bob 应该从 Alice 的合并结束的 r25 开始他的合并，而不是 r28。

所以现在我有 6 个分支自 10 月初以来以这种方式错误地合并。这会导致主干中的测试失败和许多回归。所以现在，我想返回并合并所有错过的更改。

有没有一种简单而**正确**的方法来做到这一点？我目前的计划是回到起点，开始在每个间隙中合并。因此，在示例中，我会将修订版 25-28 从分支 1 合并到分支 2。但我预计会有很多冲突，我希望有更好的方法。

确实没有快速简便的解决方法。强制开发人员在 Subversion 中维护多个并发分支是容易出错且耗时的。在这种情况下，许多开发人员的签入评论无论如何都是不准确的。所以真的没有办法回去追溯他们的脚步。相反，我们将全面测试最新的分支并关闭其余分支。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:23:28.747

如果开发人员一路检查他们在分支中的更改，您不能在合并之前创建一个新分支，正确合并更改，然后合并他们的新代码吗？也许我错过了一些东西。

我不熟悉各种 Subversion 模式，但我公司遵循的流程是我们的主干始终稳定，开发人员无法更改它（只能更改分支）。因此，我们从未遇到过合并问题，我们在 SVN 中有超过 10,000 个修订版和 100 个分支。我之所以提出这个问题，是因为如果有多个开发人员遇到合并问题，听起来您的流程/模式存在重大缺陷。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-06T09:17:10.693

好吧，要获得所有内容，您只需合并到没有特定修订的 URL。如：

```
cd /path/to/working/copy/of/stable/brunch
svn merge https://company.com/repo/project/branch/stable https://company.com/repo/project/trunk 
```

这样你就可以从主干中得到你忘记合并到稳定中的所有东西。查看、还原不需要的内容并提交。

# entity-framework - LINQ to Entity 减去 2 个日期

> ID：570858
> 
> 赞同：66
> 
> 时间：2009-02-20T19:13:16.027
> 
> 标签：entity-framework, datetime, linq-to-entities

我正在尝试使用带有实体框架的 LINQ 确定两个日期之间的天数。它告诉我它无法识别 System.TimeSpan 类上的 Subtract

这是我的 LINQ 查询的 where 部分。

```
where ((DateTime.Now.Subtract(vid.CreatedDate).TotalDays < maxAgeInDays)) 
```

这是我在 VS.NET 调试器中收到的错误

> {"LINQ to Entities 无法识别方法 'System.TimeSpan Subtract(System.DateTime)' 方法，并且此方法无法转换为存储表达式。"}

我做错了什么还是有更好的方法来获取实体框架中 2 个 DateTimes 之间的天数？

谢谢迈克尔

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2011-05-12T07:02:45.303

在这种情况下，接受的答案更好，但作为参考，您可以使用[`EntityFunctions`](http://msdn.microsoft.com/en-us/library/dd412643.aspx)该类对日期执行操作等。

```
where (vid.CreatedDate >= EntityFunctions.AddDays(DateTime.Now, -maxAgeInDay)) 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-02-20T19:54:28.313

这是我如何让它工作的

我定义了一个代表最早日期的日期时间变量

```
DateTime oldestDate = DateTime.Now.Subtract(new TimeSpan(maxAgeInDays, 0, 0, 0, 0));
... 
```

然后我修改了 LINQ 查询的 where 部分

```
where (vid.CreatedDate >= oldestDate ) 
```

工作就像一个魅力 - 感谢 Micah 让我思考表达式树

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2011-05-12T07:30:57.337

您还可以使用`System.Data.Objects.EntityFucntions`：

```
currentDate = DateTime.Now;

...
where  EntityFunctions.DiffDays(currentDate, vid.CreatedDate) < maxAgeIdDays 
```

from 的所有函数`EntityFunctions`仅适用于 Linq-to-entities 并映射到 SQL 函数。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-20T19:35:26.923

您会遇到此类问题，因为谓词需要转换为表达式树。并且翻译过程无法识别 DateTime.Now.Subtract 方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-04T04:48:06.370

事实上，根据设计，LINQ to Entities 需要将整个查询转换为 SQL 语句。那就是它无法识别 Subtract 方法的地方。每当您尝试在查询中使用 C#/VB 方法时，都会发生这种情况。在这些情况下，您必须想办法从查询中提取该部分。这篇文章解释了更多： http: [//mosesofegypt.net/post/LINQ-to-Entities-what-is-not-supported.aspx](http://mosesofegypt.net/post/LINQ-to-Entities-what-is-not-supported.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-12-12T15:47:42.607

您可以在模型中定义新属性：

```
 public DateTime StartDate{ get; set; }
    public DateTime EndDate{ get; set; }
    public TimeSpan CalculateTime{
        get
        {
            return EndDate.Subtract(StartDate);
        }
    } 
```

现在，您可以使用类似的东西：

```
var query = from temp in db.Table
select new MyModel {
    Id = temp.Id,
    Variable1 = temp.Variable1,
    ...
    EndDate = temp.EndDate,
    StartDate = temp.StartDate
} 
```

当您查看结果时，您可以使用 return ，例如：

```
return query 
```

现在，在查询中，我们有计算时间（EndDate 和 Startdate 之间的减法）。

# asp.net - 带有选项卡样式（圆角）的 Asp.Net 菜单控件

> ID：570871
> 
> 赞同：0
> 
> 时间：2009-02-20T19:16:54.660
> 
> 标签：asp.net, menu, rounded-corners

任何人都可以给我一个更好的主意来提出一个带圆角的 Asp.net 2.0 菜单控件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T23:52:35.620

最简单的方法是使用圆形图形设置 CSS。如果您希望所选选项卡具有不同的颜色，您可以使用来自各种站点的窗帘脚本。考虑看看爆炸男孩：

[http://exploding-boy.com/images/cssmenus/menus.html](http://exploding-boy.com/images/cssmenus/menus.html)

您可以从该站点获取图形、CSS 和 JavaScript。如果您希望 ASP.NET 菜单控件看起来最好，请使用 CSS 友好的菜单适配器（可从 www.asp.net 下载），因为它使用设置菜单的无序列表方法。

# c# - What is the Keycode for % sign?

> ID：570887
> 
> 赞同：1
> 
> 时间：2009-02-20T19:23:28.917
> 
> 标签：c#, .net

I am using C#.Net. I have textbox which allow only number, decimal and percentage(%) sign. I have the keycode for all number and decimal, but what is the "%" sign's keycode?

How can I check the `keydown` event for %?

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T19:27:00.923

Something like this:

```
private void yourControl_KeyDown(object sender, KeyEventArgs e)
{
   if((e.KeyCode == Keys.D5) && e.Shift)
   {
      // User pressed '%' ...
   }
} 
```

or

```
private void yourControl_KeyDown(object sender, KeyEventArgs e)
{
    switch(e.KeyCode)
    {
        //... 
        case Keys.D5:
            if(e.Shift)
            {
                // Handle '%'
            }
            else
            {
                // Handle '5'
            }
            break;
        // ...
    }
} 
```

You want to check that the key being pressed is the 5 key, and that it has been modified by pressing the shift key.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T19:30:30.383

Ascii code for "%" is 37, and in unicode &#37.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T13:58:46.617

Here is a textbox restricting pattern:

```
 private void AmountPaidTextBox_KeyPress(object sender, KeyPressEventArgs e)
    {
        switch ((byte)e.KeyChar)
        {
            case 48:
            case 49:
            case 50:
            case 51:
            case 52:
            case 53:
            case 54:
            case 55:
            case 56:
            case 57:
            case 58:
            case 59:
            case 46:
            case 35:

                //This is a valid character
                e.Handled = false;
                break;
            default:
                //This is an invalid character
                e.Handled = true;
                break;

        }
    } 
```

# asp.net - Amazon S3 URL 重写

> ID：570890
> 
> 赞同：13
> 
> 时间：2009-02-20T19:24:07.137
> 
> 标签：asp.net, iis, amazon-s3

如何将 Amazon S3 url 从 [http://bucket.amazons3.com/imagepath.jpg](http://bucket.amazons3.com/imagepath.jpg)更改 为 [http://image.mydomain.com/imagepath.jpg](http://image.mydomain.com/imagepath.jpg)

编辑：基本上，这样做的全部原因是对我的用户隐藏 amazon s3 url。

我正在考虑一个 HttpModule，它将请求从 image.mydomain.com 重定向到 bucket.amazons3.com。但这需要我的服务器首先处理所有请求，然后再转发。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-20T19:34:19.470

如果我理解，您需要指定您的域名而不是 S3。为此，您需要编写一个处理程序，它将充当亚马逊服务器的代理。

但是，这实际上会使您的带宽加倍，因为您需要将图像发送到客户端以及为 S3 获取图像。

我不确定是否有任何 S3 特定的方法来处理这个问题。

以下是取自[Amazon S3、CNAME 记录的 Amazon S3 特定方式](http://5thirtyone.com/archives/1763)

> 普通用户可以注册 Amazon S3 托管并开始上传文件 - 接受托管文件的默认 URL 结构：
> 
> [http://s3.amazonaws.com/your-bucket/some-file.txt](http://s3.amazonaws.com/your-bucket/some-file.txt) 如果您计划使用 S3 来托管媒体文件 - 更具体地说是 Flash 文件 - 您将遇到 Adob​​e 的跨域安全策略。该修复需要映射您托管的 S3 文件，使其看起来好像是从您自己的域（虚拟主机）提供的。最简单和最有吸引力的方法是托管文件 URL，如下所示：
> 
> [http://s3.your-site.com/some-file.txt](http://s3.your-site.com/some-file.txt) 要开始使用，请在 S3 上创建一个您希望作为托管文件根目录的存储桶。对于此示例，您的 S3 存储桶将是：
> 
> s3.your-site.com 最重要​​的一步是将适当的 CNAME 记录添加到您的 DNS 设置中。
> 
> 名称类型数据 s3.your-site.com CNAME s3.amazonaws.com。预计您的新 DNS 设置最多需要 24-48 小时才能解决。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-12-27T02:53:45.050

**在s3.amazonaws.com**上创建 CNAME 。足够了。无需预先添加存储桶名称。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-07-16T23:58:53.517

为了详细说明 Tez 的答案，Amazon S3 提供了对通过[虚拟托管 Buckets](http://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html "虚拟的")映射自定义域的支持。

要完成这项工作，您的存储桶的名称必须是您希望映射的完整主机名。

因此，使用原始问题中的示例，创建一个名为的 S3 存储桶`image.mydomain.com`并为其设置一个 CNAME：

```
image.mydomain.com  CNAME  image.mydomain.com.s3.amazonaws.com. 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-03T17:36:05.017

听起来你想生成过期链接，

[http://www.ioncannon.net/s3/21/creating-s3-urls-that-expire-using-php/](http://www.ioncannon.net/s3/21/creating-s3-urls-that-expire-using-php/)

然后，您可以即时生成这些，并通过您的应用程序将它们作为重定向提供。所以有人要求， http: [//images.mydomain.com/img123.jpg](http://images.mydomain.com/img123.jpg)

并且您生成了一个不错的自动过期 s3 url， [http ://mydomain.s3.amazonaws.com/T154456.jpg?AWSAccessKeyId=1ESOMESPECIALIDJJAKJ6RA82&Expires=1241372284&Signature=ddfr%2BlkoSEPAL%2BGbMwlMzj6q%2BCY%3D](http://mydomain.s3.amazonaws.com/T154456.jpg?AWSAccessKeyId=1ESOMESPECIALIDJJAKJ6RA82&Expires=1241372284&Signature=ddfr%2BlkoSEPAL%2BGbMwlMzj6q%2BCY%3D)

然后将用户重定向到自动生成的 url。这样，即使用户查看 html 源代码，他们也只会看到指向您网站的 url，但是当他们点击链接时，他们会被重定向到亚马逊，因此您不必担心通过代理请求您的服务器并占用不必要的带宽。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-11-01T12:39:24.127

Bryan 的回答是正确的，而 Ramesh 和 Vincent 的回答有误。将 CNAME 设置为 s3.amazonaws.com 会导致不必要的重定向，正如 AWS Virtual Hosting of Buckets 指南中所警告的[那样](http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?VirtualHosting.html)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-03T17:43:32.347

如果您可以控制 DNS，为什么不设置 CNAME？

我们有一个 cname 设置指向 js.our-domain.com 指向我们的一个存储桶（奇怪的是 javascript 文件），然后我们只引用 js.our-domain.com/jquery.js （例如）然后我们就走了。

根据您的主机，有多种设置 CNAME 的方法 - 谷歌搜索[显示许多](http://www.google.co.uk/search?q=setting+up+CNAME&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-GB:official&client=firefox-a)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T23:15:05.430

在我看来，你有两个选择：

1.  按照您的说明进行重定向，或
2.  从 S3 请求资源，然后通过您的响应将它们返回给用户。

因此，如果用户想查看**[http://image.mydomain.com/imagepath.jpg资源，您可以在内部从](http://image.mydomain.com/imagepath.jpg)****[http://bucket.amazons3.com/imagepath.jpg](http://bucket.amazons3.com/imagepath.jpg)**请求原始资源，将其保存在本地并返回它给请求的用户。

它确实花费了大量带宽，但如果这是您的关键要求，那么这应该是可行的方法。

# c# - 在 C# 中 null 是否也从 Object 继承？

> ID：570892
> 
> 赞同：7
> 
> 时间：2009-02-20T19:25:50.177
> 
> 标签：c#, .net

在 C# 中 null 是否也从 Object 继承？

null 本身在哪里定义？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T19:28:32.650

> 在 C# 中 null 是否也从 Object 继承？

与其他一些系统不同，`null`它不是根据类或实例定义的。相反，它表示*没有*任何实例，并且它没有类型。它被隐式转换为适合上下文的任何引用类型。最广泛的转换（即当无法推断出其他转换时）是到`object`. 但是，`null`通常不是 type `object`。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-20T19:28:40.137

`null`不是对象 - 它是一个语言关键字，表示缺少对象引用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T20:01:03.540

> null 本身在哪里定义？

[null](http://msdn.microsoft.com/en-us/library/edakx9da.aspx)是一个关键字。null 不是类型。

有两种变量，每种都有自己的一组可空性规则。

## 引用类型变量

变量是有类型的，可以引用相同或不同类型的实例。

```
//The reference type is System.Object and
//  the instance type is System.String
object s = "123"; 
```

对于引用类型变量，null 表示没有实例。

```
//The reference type is System.Object and
//  there is no instance.
object x = null; 
```

使用没有实例的引用类型变量将导致空引用异常。

```
string s = null;
s = s + "a"; //BOOM. 
```

## 值类型变量

值类型变量具有单一类型，分配的值必须是这种类型，不能是其他类型。

```
int i = 3; 
```

对于某些值类型变量（仅限于 type 的变量`Nullable<T>`），可以分配 null。这表明没有价值。

```
int? i = null; 
```

使用没有值的值类型不会产生空引用异常——不涉及*引用*。

```
int? i = null
if (i < 3) //false 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T23:35:48.000

null 属于“null 类型”，它确实从对象继承。

请参阅 ECMA-334 11.2.7

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T22:03:16.460

我认为 null 本身不是一个对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T21:40:01.803

null 不是类型，它是一个值。更具体地说，它是一个值，根据定义，它是一个值的缺失。在 C# 中，null 可以转换为任何引用类型。

因此 null 不继承自 System.Object，但它是可转换为任何不继承自 System.ValueType 的对象的值。

# html - 格式化文本，如何建议？

> ID：570893
> 
> 赞同：0
> 
> 时间：2009-02-20T19:26:16.757
> 
> 标签：html, css, html-lists

我试图弄清楚如何格式化下面的代码，以便前两个信息块并排显示，然后在其下方居中显示第三个信息块。我尝试使用带有 css 的列表样式来格式化它，但似乎并不适合我。

帮助/建议？

```
<div class="inauguration-content">
<h3>Inauguration</h3>
Friday, April 17, 2009<br />
3:00 p.m.<br />
Sarkus-Busch Theater<br />
Robert McLaughlin College Center</p>

<h3>Inaugural Gala</h3>
7-11 p.m.<br />
Robert McLaughlin College Center<br />
Featuring hors d'oeuvres, open bar and dinner and dessert stations<br />
Entertainment by Frankie Michaels<br />
Cocktail Attire Recommended<br />
Tickets are $100 per person<br />
Proceeds benefit the Herkimer County College Foundation</p>

<h3>Important Information for Delegates</h3>
<a href="http://www.herkimer.edu/admissions/directions/" target="_blank">Direction to HCCC</a><br />
<a href="http://www.herkimer.edu/pdfs/campusmap.pdf" target="_blank">Campus Map</a><br />
<a href="http://www.herkimer.edu/admissions/hotels/" target="_blank">Lodging Information</a><br />
Delegates marching in the Inaugural Procession should report to the Open Student Area, first floor of the Library Complex at 2:00 p.m. for robing and assembly.<br />
Delegates are expected to furnish their own academic regalia.</p>
</div> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T19:31:57.680

您可以创建三个 div。

1.  第一个 div（左上角）的宽度设置为容器（例如视口）的 50% 并且**向左浮动**。
2.  第二个 div（右上角）的宽度设置为容器的 50%（例如视口）并**浮动到右侧**。
3.  第三个 div（底部中心）将有一个 witdh 设置，例如，100% 的容器（例如视口）**使用 CSS 'clear:both'**将自身定位在两个浮动中最高的下方。要居中，请使用较小的宽度（例如 50% 或 20em）并将 CSS margin-left 和 margin-right 设置为 auto（参见下面的示例。）

以上将动态打包三个 div 以适应三个 div 中的任何一个中的任何换行和垂直增长（包括因为用户为可访问性目的而增加字体大小）。

```
<html><body>

<div style="width:50%; float:left">
Inauguration<br/>
Friday, April 17, 2009<br/>
3:00 p.m.<br/>
Sarkus-Busch Theater<br/>
Robert McLaughlin College Center
</div>

<div style="width:50%; float:right">
Inaugural Gala<br/>
7-11 p.m.<br/>
Robert McLaughlin College Center<br/>
Featuring hors d'oeuvres, open bar and dinner and dessert stations<br/>
Entertainment by Frankie Michaels<br/>
Cocktail Attire Recommended<br/>
Tickets are $100 per person<br/>
Proceeds benefit the Herkimer County College Foundation
</div>

<div style="width:50%; margin-left:auto; margin-right:auto; clear:both">
Important Information for Delegates<br/>
Direction to HCCC<br/>
Campus Map<br/>
Lodging Information<br/>
Delegates marching in the Inaugural Procession should report to the Open Student Area, first floor of the 

Library Complex at 2:00 p.m. for robing and assembly.<br/>
Delegates are expected to furnish their own academic regalia.
</div>

</body></html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T14:10:30.207

只是为了好玩，这是您想要使用列表的布局。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>container Title</title>
        <style type="text/css" media="screen">
            body {
                font-family:Georgia;
            }
            #container { 
                width:700px;
                margin:0 auto;
            }
            ul {
                display:block;
                margin:0;
                padding:0px;
                width:50%;
                float:left;
            }
            ul.full { 
                margin:0 auto; 
                float:none; 
                clear:both;
                padding-top:5px;
            }
            ul li {
                list-style-type:none;
                margin:0;
                padding:0;
                padding-left:10px;
             }
        </style>
    </head>
    <body>
        <div id="container">

        <ul>
            <li><h4>Inauguration</h4></li>
            <li>Friday, April 17, 2009</li>
            <li>3:00 p.m.</li>
            <li>Sarkus-Busch Theater</li>
            <li>Robert McLaughlin College Center</li
        ></ul>
        <ul>
            <li><h4>Inaugural Gala</h4></li>
            <li>7-11 p.m.</li>
            <li>Robert McLaughlin College Center</li>
            <li>Featuring hors d'oeuvres, open bar and dinner and dessert stations</li>
            <li>Entertainment by Frankie Michaels</li>
            <li>Cocktail Attire Recommended</li>
            <li>Tickets are $100 per person</li>
            <li>Proceeds benefit the Herkimer County College Foundation</li>
        </ul>
        <ul class="full">
            <li><h4>Important Information for Delegates</h4></li>
            <li>Direction to HCCC</li>
            <li>Campus Map</li>
            <li>Lodging Information</li>
            <li>Delegates marching in the Inaugural Procession should report to the Open Student Area, first floor of the Library Complex at 2:00 p.m. for robing and assembly.</li>
            <li>Delegates are expected to furnish their own academic regalia. </li>
        </ul>
        </div>
    </body>
</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T19:35:46.267

我不会用列表来设置它的样式，只需使用 div。

```
<style type="text/css">
    .left { float:left; }
    .right { float:right; }

    .half { width:50%; }
    .centered { text-align:center; }

    // from http://www.webtoolkit.info/css-clearfix.html
    .clearfix:after {
        content: ".";
        display: block;
        clear: both;
        visibility: hidden;
        line-height: 0;
        height: 0;
    }

    .clearfix {
        display: inline-block;
    }

    html[xmlns] .clearfix {
        display: block;
    }

    * html .clearfix {
        height: 1%;
    }
</style>

<div class="clearfix">
    <div style="left half">
    <strong>Inauguration</strong><br />
    Friday, April 17, 2009<br />
    3:00 p.m.<br />
    Sarkus-Busch Theater<br />
    Robert McLaughlin College Center<br />
    </div>

    <div style="right half">
    <strong>Inaugural Gala</strong><br />
    7-11 p.m.<br />
    Robert McLaughlin College Center<br />
    Featuring hors d'oeuvres, open bar and dinner and dessert stations<br />
    Entertainment by Frankie Michaels<br />
    Cocktail Attire Recommended<br />
    Tickets are $100 per person<br />
    Proceeds benefit the Herkimer County College Foundation<br />
    </div>
</div>
<div class="centered">
    <strong>Important Information for Delegates</strong><br />
    Direction to HCCC<br />
    Campus Map<br />
    Lodging Information<br />
    Delegates marching in the Inaugural Procession should report to the Open Student Area, first floor of the Library Complex at 2:00 p.m. for robing and assembly.<br />
    Delegates are expected to furnish their own academic regalia.<br />
</div> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T20:15:13.490

```
<div style="width:49%; float:left"><p>
Inauguration<br/>
Friday, April 17, 2009<br/>
3:00 p.m.<br/>
Sarkus-Busch Theater<br/>
Robert McLaughlin College Center</p>
</div>

<div style="width:49%; float:left"><p>
Inaugural Gala<br/>
7-11 p.m.<br/>
Robert McLaughlin College Center<br/>
Featuring hors d'oeuvres, open bar and dinner and dessert stations<br/>
Entertainment by Frankie Michaels<br/>
Cocktail Attire Recommended<br/>
Tickets are $100 per person<br/>
Proceeds benefit the Herkimer County College Foundation</p>
</div>

<div style="width:50%;margin:auto "><p>
Important Information for Delegates<br/>
Direction to HCCC<br/>
Campus Map<br/>
Lodging Information<br/>
Delegates marching in the Inaugural Procession should 
report to the Open Student Area, first floor of the 
Library Complex at 2:00 p.m. for robing and assembly.<br/>
Delegates are expected to furnish their own academic regalia.</p>
</div> 
```

# silverlight - 使用 Silverlight 的商业网站？

> ID：570898
> 
> 赞同：4
> 
> 时间：2009-02-20T19:27:23.963
> 
> 标签：silverlight

除了微软自己的网站，有谁知道目前使用 Silverlight 的任何商业网站？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T19:29:20.057

silverlight 网站有一个巨大的展示画廊，你可以去看看。

[http://silverlight.net/Showcase/](http://silverlight.net/Showcase/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T19:38:43.047

Netflix 即时流媒体。

（顺便说一句，上面链接的网站在我的机器上不起作用。完全无视网络标准！）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T20:46:05.367

我喜欢 AOL 的网络邮件客户端。 [http://ria.mail.aol.com/](http://ria.mail.aol.com/) 它仍处于测试阶段，但速度很快。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-12T06:15:15.440

我发现了另一个很棒的 Silverlight 网络邮件客户端——叫做 Silvermail：

[http://silvermail.com.au](http://silvermail.com.au)

它非常流畅而且非常快，而且在公共领域完全免费使用……我将它与 gmail 一起使用，因为我们的公司防火墙不允许我在工作时检查电子邮件，而且我发现 gmail 界面太混乱了。 .. Silvermail 真的很简单。

几个朋友已经成功地将它用于 POP3，它也适用于 Hotmail 和 Yahoo。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-12T15:51:55.280

这个 Silverlight 网站曾在 2008 年、2009 年时代与 Moonlight 合作过——至少是 Moonlight 的 2 个版本：[http ://www.recreation.gov/camping/Furnace_Creek_Ca/r/campgroundDetails.do?contractCode=NRSO&parkId= 70978&topTabIndex=露营点](http://www.recreation.gov/camping/Furnace_Creek_Ca/r/campgroundDetails.do?contractCode=NRSO&parkId=70978&topTabIndex=CampingSpot)。我刚刚下载了最新版本的 Moonlight 3.99.0.3，它不起作用。Silverlight 仅用于地图选项，因此单击标有设施地图的按钮。它就在第一页的中心（从上到下，从一侧到另一侧）。

# parsing - 在 F# 中针对列表开头进行模式匹配的更简单方法

> ID：570899
> 
> 赞同：2
> 
> 时间：2009-02-20T19:27:27.973
> 
> 标签：parsing, list, f#, pattern-matching

我正在尝试在 F# 中编写一个字符串处理函数，如下所示：

```
let rec Process html =
  match html with
  | '-' :: '-' :: '>' :: tail -> ("&rarr;" |> List.of_seq) @ Process tail
  | head :: tail -> head :: Process tail
  | [] -> [] 
```

我对几个元素的模式匹配表达式有点难看（整个`'-' :: '-' :: '>'`事情）。有没有办法让它变得更好？另外，如果我要处理大文本，我正在做的事情是否有效？还是有其他方法？

**澄清**：我的意思是，例如，能够写出这样的东西：

```
match html with
| "-->" :: tail -> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T06:34:44.160

我同意其他人的观点，即使用字符列表进行严重的字符串操作可能并不理想。但是，如果您想继续使用这种方法，一种接近您所要求的方法的方法是定义一个活动模式。例如：

```
let rec (|Prefix|_|) s l =
  if s = "" then
    Some(Prefix l)
  else
    match l with
    | c::(Prefix (s.Substring(1)) xs) when c = s.[0] -> Some(Prefix xs)
    | _ -> None 
```

然后你可以像这样使用它：

```
let rec Process html =  
  match html with  
  | Prefix "-->" tail -> ("&rarr;" |> List.of_seq) @ Process tail  
  | head :: tail -> head :: Process tail  
  | [] -> [] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-06T10:58:06.023

> 有没有办法让它变得更好？

当然：

```
let process (s: string) = s.Replace("-->", "&rarr;") 
```

> 另外，如果我要处理大文本，我正在做的事情是否有效？

不，这是非常低效的。分配和垃圾收集是昂贵的，而且你为每个角色都这样做。

> 还是有其他方法？

试试`Replace`会员。如果这不起作用，请尝试使用正则表达式。如果这不起作用，请编写一个词法分析器（例如使用`fslex`）。最终，您想要提高效率的是状态机处理字符流并通过就地变异输出其结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T19:56:15.033

我认为您应该避免使用 list<char> 和使用字符串，例如 String.Replace、String.Contains 等。System.String 和 System.StringBuilder 在处理文本方面会比 list<char> 好得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T20:26:40.717

对于简单的问题，Brian 提到的直接使用 String 和 StringBuilder 可能是最好的方法。对于更复杂的问题，您可能需要查看一些复杂的解析库，例如[FParsec](http://www.quanttec.com/fparsec/) for F#。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T08:29:27.780

[这个问题](https://stackoverflow.com/questions/174418/can-you-improve-this-lines-of-code-algorithm-in-f)可能有助于为您提供解决问题的另一种方法的想法 - 使用 list<> 包含行，但在每行中使用 String 函数。

# c - 严格的 C Win GUI 编程

> ID：570907
> 
> 赞同：2
> 
> 时间：2009-02-20T19:29:55.907
> 
> 标签：c, windows, user-interface

大家好，我需要一些指导。

基本上，我是一个知道一些 C 的网络开发者，但我只为 *nix 开发了一些简单的控制台应用程序。

很快，我想开发一个带有 GUI 的简单 Win 程序，而不是涉足以下任何技术：

.NET C# Java C++（尤其是这个）

因为我现在既没有时间也没有必要。

1）。我可以在不求助于 cpp 的情况下使用 wxWidgets 吗（如果不能，你会建议什么其他具有原生外观和轻量级的小部件工具包？） 2）。我可以将 OpenCV 与严格的 C 一起使用吗？（没有模板，内联函数等）3）。除了 MinGW，我还应该寻找其他编译器选项吗？英特尔值得研究吗？（AFAIK，它有一个限制性许可证）。4）。您建议以下哪种 IDE 用于 windows / c 编程

*   开发-C++
*   带有适当插件的 Eclipse（不记得确切的插件）
*   任何文本编辑器 + *.bat 用于编译？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T19:36:25.580

对于 C Windows GUI 编程，最简单的方法是 VC++（自 6.0 以来的任何版本）和 Charles Petzold *Programming Windows*书。

Microsoft 编译器的免费 Express 版本应该可以正常工作 - 我不确定您是否必须下载 Platform SDK 或者它是否附带一个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T19:38:28.693

如果您有兴趣直接学习基于 C 的 Windows 编程，而不是使用其他中间工具：

Charles Petzold 有一本非常好的参考书，名为[Programming Windows](http://www.charlespetzold.com/pw5/)。这绝对是开始的方式。绝对一切都一清二楚，你永远不需要 C++。

作为一个整体，Windows API 是为 C 程序员构建的。所有像实际应用程序窗口这样的花哨的东西都作为“HANDLE”传回，它或多或少只是指向操作系统对象表的指针。作为程序员，您永远不必处理对象，只需处理它们的 HANDLE。

此外，这本特别的书很好地描述了[Windows 事件循环](http://en.wikipedia.org/wiki/Program_loop#Windows_applications)。如果您不熟悉它，它会被详细描述。

祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T19:38:02.987

您可以直接用 C 语言编写 Windows GUI 程序。下载 Windows SDK 并查看“通用”示例（我假设它仍在其中）。这几乎是 Win32 应用程序所需的最少代码，它是普通的 C 语言。

编辑：嗯，它似乎没有安装在这台笔记本电脑上。你可以在[这里](http://msdn.microsoft.com/en-us/library/aa383668.aspx)在线找到它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T19:40:10.360

可能值得重新考虑 C#.NET。您可以在几天内轻松学习 C#，并很快开发出流畅的应用程序。相比之下，直接基于 C 的 windows 库，尤其是 Win32，是 BRUTAL。你会花一周的时间来编写一个简单的应用程序，而这需要几分钟的 C# 时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T19:40:40.763

我能想到的唯一基于 C 的工具包是 GTK+ 的 Windows 端口。我没有在 Windows 环境中使用它的经验。不过，它在 Linux 方面非常成熟，如果您的需求很简单，可能就足够了。

学习 Win32 API 很难！但就像其他人所说的那样，如果你坚持走这条路，Petzold 的书就是你要走的路。

我的观点是，仅使用 C 和 Win32 API 开发 Windows GUI 比使用足够的 C++ 来利用基于 C++ 的框架之一更难学习。你仍然可以用纯 C 语言完成大部分工作。

至于免费的 IDE，我会选择 Visual Studio 2008 Express Edition。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-21T10:22:24.810

你什么都不需要。

像真正的程序员一样使用 C 和 Win32 api，而不是孩子..

请参阅 VS Win32 向导

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T19:35:10.590

关于 wxWidgets，你可以使用[https://sourceforge.net/projects/wxc](https://sourceforge.net/projects/wxc) 我从来没有真正使用过它，所以我不知道它的成熟度。

Mingw 和 Microsoft Visual C++ 是我最喜欢的编译器。请记住，您始终可以使用严格的 C 并使用 C++ 编译器对其进行编译，因为有效的 C 几乎总是有效的 C++。

对于 windows，我过去使用过 Dev-C++，但现在 Microsoft Visual C++ 似乎是一个更好的解决方案。

如果您要使用文本编辑器+bat，请查看 Notepad++。

编辑：澄清一下，使用 Microsoft Visual C++ 并不意味着学习 C++。您可以在其中完美地使用 C，因为 - 我重复一遍 - 有效的 C 通常是有效的 C++。不想要 C++？没问题。只要远离仅限 C++ 的功能，您在 C++ 编译器中仍然是安全的。

编辑：Roger Lipscombe 在评论中指出，纯 C 编译器在 Microsoft 的 Visual C 中可用，使用 /TC 开关。

# php - PHP 与 JavaScript 的限制有哪些例子？

> ID：570908
> 
> 赞同：1
> 
> 时间：2009-02-20T19:30:14.020
> 
> 标签：php, javascript

我正在寻找我可以概括的问题，稍后（在设计中）识别，然后说

> *“嘿，如果我继续走这条路，我会遇到麻烦。PHP + JS 不适合这个。”*

如果我使用 PHP+JS，我不能做什么？我不应该尝试什么？你有什么建议呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T19:37:34.330

它是软件，只要有足够的时间和资源，几乎任何你能想象到的事情都是可能的。我看不出 PHP 会如何阻止您在 JavaScript 中做任何事情，或者 JavaScript 中的任何事情会阻止您在 PHP 中做某事。它们是独立的技术，运行在客户端/服务器架构的每一端，可以构建为协同工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:36:34.517

不使用某种类型的框架，自己很容易遇到 PHP 和 JS 的麻烦。如果您不遵循 Zend Framework 等某种约定，PHP 可能会很快退化为一堆意大利面条式代码。

也就是说，我不认为你会发现 PHP 不能做的任何事情......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T19:37:06.140

我会看看[这个](http://jamesward.com/census)，看看JS的局限性是什么。了解这一点很重要的原因是 JS 上的 xml 性能很差，请使用 JSON。另外需要注意的是，如果你真的需要在一个页面上显示那么多行数据，最好使用 flash/flex 解决方案。[警告，该链接不适用于 Firefox 3，它会死掉]

我会注意到，尽管我的大部分经验都向我指出了这样一个事实，即通常没有理由在页面上显示这么多东西。如果我遇到一个用例，我通常可以即时 AJAX 一些东西，以避免一次加载这么多东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T00:18:52.703

您将遇到的唯一问题是至少 10 年后 Javascript 或某种开源脚本框架成为 Web 标准。PHP、ASP、JSP 等服务器端脚本语言和 Flash、SVG、VRML 等插件填补了 JavaScript 等相对较慢的客户端脚本语言无法适应的空白。未来，随着 PC 速度越来越快，Javascript 引擎越来越高效，您将看到服务器端脚本和插件等 3rd 方解决方案逐渐衰落。那么你将面临的唯一问题是一堆旧代码，它们被在他们的反重力板上放大的赛博朋克所嘲笑。当然，这是在未来，从外观上看，人们喜欢的规格都拖了后腿。

所以简而言之，PHP 是您在可预见的未来在浏览器中做任何有用的事情的唯一希望。您唯一担心的应该是您是否想学习 ASP，它非常酷。尽管 PHP 拥有庞大的社区和大量的代码片段。

# python - 如何编制时间表

> ID：570912
> 
> 赞同：3
> 
> 时间：2009-02-20T19:31:09.197
> 
> 标签：python, scheduling

我必须构建一个基于某些规则进行调度的程序。我不知道如何解释它，所以让我举个例子..

你有五个人 A、B、C、D、E。而你还有另一组人S1 S2 S3 S4 S5 S6 S7。

如果 ABCD 和 E 从 9 点到 5 点每小时都有空，并且 S1 S2 S3 S4 S5 S6 和 S7 有一个他们想从 {A,B,C,D,E} 看到的 3 个人的列表

那是我的问题，我不知道从哪里开始......

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T20:58:29.830

这是一些可以解决问题的python代码。您将需要更新 VISITOR_PEOPLE。如果有些人先于其他人安排时间，则您需要重新排序 VISITOR_IDS。

**编辑：**我添加了更多代码来说明人们不能同时在不同的地方。您可能希望提高效率（即不要尝试安排不起作用的时间）。不过，我会让你弄清楚；）

```
import sys

HOURS = ['9:00AM', '10:00AM', '11:00AM', '12:00PM', '1:00PM', '2:00PM', '3:00PM', '4:00PM']
PEOPLE_IDS = ['A', 'B', 'C', 'D', 'E']
VISITOR_IDS = ['S1', 'S2', 'S3', 'S4', 'S5', 'S6', 'S7']
VISITOR_PEOPLE = {'S1': ['A', 'B', 'C'], 
                  'S2': ['A', 'D', 'E'], 
                  'S3': ['B', 'E', 'D'], 
                  'S4': ['D', 'E', 'A'], 
                  'S5': ['C', 'D', 'E'], 
                  'S6': ['A', 'D', 'C'], 
                  'S7': ['B', 'C', 'D']
                  }

def main():
    people = {}
    for id in PEOPLE_IDS:
        people[id] = Person(id)
    visitors = {}
    for id in VISITOR_IDS:
        visitors[id] = Visitor(id, VISITOR_PEOPLE[id], people)
    for v in visitors.values():
        v.printSchedule()

class Person:
    def __init__(self, id):
        self.id = id
        self.schedule = [False]*8  # False = free, True = busy
    def scheduleTime(self):
        # schedules next available hour and returns that hour
        for i in range(len(self.schedule)):
            if not self.schedule[i]:
                self.schedule[i] = True
                return HOURS[i]
        return 'unavailable'
    def unscheduleTime(self, index):
        self.schedule[index] = False

class Visitor:
    def __init__(self, id, people_requests, people):
        self.id = id
        self.schedule = {} # {person_id: hour}
        for p in people_requests:
            bad_times = set()  # times that Visitor is busy
            time = people[p].scheduleTime()
            while time in self.schedule.values():  # keep scheduling a time until you get one that works for both the Visitor and Person
                bad_times.add(time)
                time = people[p].scheduleTime()
            self.schedule[p] = time
            for t in bad_times:  # unschedule bad_times from Person
                people[p].unscheduleTime(HOURS.index(t))
    def printSchedule(self):
        print 'Schedule for %s [Person (time)]:' % self.id
        for p,t in self.schedule.items():
            print '    %s (%s)' % (p,t)

if __name__ == '__main__':
    sys.exit(main()) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T19:44:58.867

这是一种方法：

从 S1 开始，在上午 9 点将他想要的三个人分配给他，然后转到 S2 并尝试将他的会议安排在上午 9 点。继续直到发生冲突，然后将会议移至上午 10 点。回到上午 9 点进行下一个。如果 10 点也有冲突，请移至 11 点，依此类推。

一旦该程序尝试在下班后安排会议，您就会知道您遇到了无法在一天内召开所有会议的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T20:54:45.720

关于[调度算法](http://en.wikipedia.org/wiki/Scheduling_algorithms)有很多话要说，所以为了你自己，你可能想打开你的文本（或者至少做一些维基研究）并感受一下最常用的技术。

就个人而言，我会首先考虑创建此计划所需的功能。

例如，您需要一个函数`def testAppointment(meetingSubject, meetingTime):`来测试给定的约会是否有效。

您可能还需要一个函数，该函数在每次特定会议主题可用时`def listAvailableTimes(meetingSubject)):`返回一个。`list`

你知道我要去哪里吗？建立功能，为您提供解决问题所需的信息，然后开始您的“主循环”，可以这么说。

# wpf - WPF listview / gridview 性能糟糕，建议

> ID：570918
> 
> 赞同：7
> 
> 时间：2009-02-20T19:32:10.643
> 
> 标签：wpf, performance, gridview, listview

我有一个使用绑定到 ObservableCollection 的 WPF ListView/GridView 的窗口。表演是完全可怕的。每次添加/删除/修改项目时，应用程序在尝试加载 300-400 个项目时会阻塞，并且 CPU 使用率会达到峰值。剖析没有揭示任何明显的东西。

有人有什么建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T06:23:25.460

检查这些属性：

```
VirtualizingStackPanel.IsVirtualizing="True"
VirtualizingStackPanel.VirtualizationMode="Recycling"
ScrollViewer.IsDeferredScrollingEnabled="True" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-13T11:59:09.723

您需要虚拟化 ListView 的 ItemSource，如本文所述：**[WPF：](http://www.codeproject.com/KB/WPF/WpfDataVirtualization.aspx)** **Paul McClean的**[CodeProject](http://www.codeproject.com/)上的数据虚拟化

 *** * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T20:28:26.593

首先猜测，您是否为每个 ListViewItem 使用复杂的数据模板？这可能是任何东西，从大量图像到（旧）BitmapEffects，甚至是从数据库中按需获取数据的延迟加载属性（这可能会导致您执行许多数据库调用来呈现每个视觉对象，具体取决于您的数据模型的方式）作品）。

第二个猜测，列表本身是否能够快速运行其加载/添加/修改/删除例程（意味着在呈现数据时会出现问题），或者列表本身是否能够缓慢地完成这些工作（表明列表存在某种问题）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T02:01:09.397

And the obvious one, make sure you have upgraded to .net 3.5 SP1, there were a lot of performance gains there.

Also it may be worth looking into the WPF datagridview control as a lot of the performance work in .net 3.5 SP1 were so the datagridview would have good performance on large datasets.

[http://wpf.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=25047](http://wpf.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=25047)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T22:19:42.753

您是否按照此问题的建议尝试过虚拟化？

[WPF ListView 性能非常慢 - 为什么？（ElementHost，还是其他原因？）](https://stackoverflow.com/questions/296533/wpf-listview-very-slow-performance-why-elementhost-or-other-reason)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-01-16T08:04:26.987

我有类似的问题。多亏了这里的答案，设置为大于实际高度的值立即为我解决了这个问题[，](https://stackoverflow.com/a/19426279/720425)但`MaxHeight`我仍然无法理解它是如何工作的。`ListView`

# standards - 为什么浏览器对 W3C 标准的支持这么差？

> ID：570928
> 
> 赞同：4
> 
> 时间：2009-02-20T19:36:12.727
> 
> 标签：standards, web-standards, standards-compliance

我想不通。

是因为制作浏览器的人不在乎吗？是因为我们作为开发人员已经编写了 hack 代码来解决在浏览器 X 和 Y 中不起作用的问题吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-20T19:48:44.880

我讨厌成为链接 Joel 文章的人，但这篇文章是该问题的最佳答案之一。

[http://www.joelonsoftware.com/items/2008/03/17.html](http://www.joelonsoftware.com/items/2008/03/17.html)

不幸的是，它太长了，以至于当您阅读它并认为哇这是一篇了不起的文章时，您会忘记您是如何到达那里的以及应该升级谁。:)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-20T19:45:19.303

## 历史

有[一场浏览器大战](http://en.wikipedia.org/wiki/Browser_war)，最终被 Internet Explorer 赢得，其中供应商故意实现与其他浏览器不兼容的功能，以使那些带有*为 Netscape 4.5 设计的*小徽章的网站。

通过不兼容和拥有独特的功能，微软赢得了浏览器之战，至少在几年之内。

## 这个很难（硬

你有没有试过在标准兼容的浏览器中使用复杂的 CSS？很难创造任何东西，因为标准很复杂。我想实现更加复杂。

## 旧网站

许多网站在设计时都考虑到了错误的 HTML 实现（请参阅我的第一部分）。如果所有浏览器都实现了 100% 兼容的渲染引擎，那么很多网站都会崩溃。他们正试图逐渐把它弄好。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-20T19:48:59.997

*   规范中的许多边缘情况**未指定/未指定**，浏览器最终以不同的方式实现它们（例如，HTML 在 v5 之前未能指定错误恢复）。

*   大范围的“标准”是浏览器战争遗留下来**的事实标准**，没有适当的规范——如果有的话（例如 DOM0）

*   一些规范简直难以理解且**难以实现**（例如 CSS 视觉格式化模型——匿名框、折叠边距和内联格式化上下文的细节可能会让你头晕目眩）

*   对于浏览器供应商而言，与现有页面完美兼容比实施不会很快为他们带来竞争优势的新功能/标准更为重要。**如果标准和网站不一致，网站总是会赢**（这就是为什么 W3C 不得不采用 HTML5 以避免变得无关紧要）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T19:42:37.313

也许是因为浏览器在 w3c 标准之前就已经存在，并且不会为了满足不断变化的需求而从头开始重写。我认为他们在逐步实现新功能方面做得很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T19:46:55.397

你在说什么浏览器？WebKit 和 Opera 的引擎都对 W3C 标准有相当好的支持（例如，不久前都通过了 Acid3）。火狐在某些方面有些欠缺，但还是很不错的。IE...嗯，IE 如此流行，以至于微软并*不在乎*，而且微软也不知道如何与其他人相处融洽。

当然，即使是最符合标准的浏览器仍然允许在解析 Web 标记时有点松散，但这主要是因为从历史上看，网页设计师/开发人员也没有真正努力地*符合*标准。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T19:57:29.023

实际上，*大多数*浏览器在支持开放标准方面都非常出色，包括世界上一些最古老的浏览器，例如 Opera（大约 15 岁）和 FireFox，它在某种程度上基于 Netscape，就像 1993 年或我思考。

唯一有“w3c 标准问题”的是微软，坦率地说，为什么他们“有这么多问题”我认为你应该问他们。但我的猜测是，他们在支持标准方面看不到任何“钱”，因为这将使创建便携式应用程序和促进竞争等变得更加容易......

话虽如此，目前挪威正在进行一场*大规模*的运动，以永久杀死地球表面的 IE6，请在此处阅读一些亮点；[http://ra-ajax.org/ground-zero-in-the-ongoing-war-against-ie6.blog](http://ra-ajax.org/ground-zero-in-the-ongoing-war-against-ie6.blog)

这个是我最喜欢的；）

[http://ra-ajax.org/facebook-joins-the-war-against-ie6.blog](http://ra-ajax.org/facebook-joins-the-war-against-ie6.blog)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T19:46:47.863

为了“保护” IE（尤其是对标准的支持更差），他们声明要保持与最后 1 亿个期望 IE 中的“旧”行为的网站向后兼容。

好消息是，在 IE8 中，如果您的页面设置正确，您可以在默认情况下期待更好的基于标准的渲染和脚本执行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T19:42:56.610

Dilbert 希望加入促进 Web 服务标准的行业联盟。

华而不实 - [http://www.dilbert.com/strips/comic/2005-12-31/](http://www.dilbert.com/strips/comic/2005-12-31/)

不那么浮华-http: [//www.dilbert.com/fast/2005-12-31/](http://www.dilbert.com/fast/2005-12-31/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T19:49:40.993

这只是拥有所有供应商都不会支持的标准的一部分。我们可能会猜到，浏览器开发人员在为浏览网页的用户添加或增强功能而不是重构他们的解析器和布局代码以使其更加一致方面感到压力更大。

基本上，它似乎“足够好”，因为我们都知道如何跳过箍来绕过它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T19:52:19.550

问题之一是保持向后兼容旧站点。例如，如果许多符合标准的浏览器是为 IE6 和更早版本制作的，则它们将无法正确显示网站。作为补偿，更流行的浏览器（IE7/8 和 Firefox 3）试图弥补上限 - 保留尽可能多地显示 Web 的能力（即使页面不兼容），同时也接近 W3C 标准.

我怀疑这将在几年内成为一个非问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T19:54:38.220

这是一个“[**多对多市场**](http://www.joelonsoftware.com/items/2008/03/17.html)”。

阅读 Joel Spolsky 的优秀文章。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-20T20:31:01.360

如果浏览器完全符合标准，那么大多数网站将无法访问。必须有一个妥协。

# java - Java/JSP 中的 Response.End()

> ID：570929
> 
> 赞同：4
> 
> 时间：2009-02-20T19:36:25.563
> 
> 标签：java, jsp

在 .net 中，您可以在任何您想要的上下文中使用 Response.End()。Java/JSP 中是否有类似的功能？

谢谢，

山姆

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T21:04:18.020

根据我的经验，您必须执行以下操作：

```
out.flush(); // Send out whatever hasn't been sent out yet.
out.close(); // Close the stream. Future calls will fail.
return; // Return from the JSP servelet handler. 
```

**注意：**
这在函数内部**不起作用**，因为您最终只会从函数返回，而不是从 JSP 服务程序处理程序返回（我假设这是您的意图）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T20:06:07.723

你可以试试

```
servletResponse.getOutputStream().close(); 
```

不太确定这是否会产生奇怪的副作用，以防服务器需要在您的内容之后发送任何数据......

[Javadoc](http://java.sun.com/j2se/1.5/docs/api/java/io/OutputStream.html#close())

# vb.net - OOP - 在哪里调用数据访问层？

> ID：570931
> 
> 赞同：7
> 
> 时间：2009-02-20T19:36:29.043
> 
> 标签：vb.net, oop, theory

我正在实现一个数据访问层 (DAL)，它基本上是一组具有 (VB.NET) 共享函数的类，用于实际执行数据库 (CRUD) 调用。我试图找出在类层次结构中调用 DAL 的最佳位置。让我举个例子吧。

假设我有一个类 Customer，它只有标准 ID、Name、Address1 等属性，可能还有一个被覆盖的 ToString 函数左右。我还有一个带有共享方法的 DAL 类，例如：

```
(pseudocode)

Namespace Dal

Public Class Customer

Public Shared Function Read(id As Integer) As Customer

Public Shared Function ReadList() As List(Of Customer)

Public Shared Sub Create(c As Customer)

'etc. 
```

现在，我可以像这样从表示层调用 Dal：

```
Me.DataGridView1.Datasource = Dal.Customer.ReadList 
```

但是，让表示层完全了解 Dal 不是一个好习惯吗？我应该像这样将方法放在客户对象中并调用 Dal 吗？

```
Public Function ReadList() As List(Of Customer)
    Return Dal.Customer.ReadList()
End Sub

Public Sub Create()
    Dal.Customer.Create(Me)
End Sub 
```

这会是“更清洁”的 OOP 吗？或者让演示文稿调用 Dal 并像我之前的示例一样传递业务对象是否可以接受：

```
Me.DataGridView1.Datasource = Dal.Customer.ReadList

Dim c As New Customer
c.Name = "Alpha Corporation"
c.Address1 = "123 Main Street"
Dal.Customer.Create(c) 
```

感谢您的反馈意见。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T19:48:58.310

您的应用程序对您的 DAL 了解得越少越好。有几种方法可以做到这一点，我认为你在正确的轨道上。我认为您可能希望研究此实现的[工厂模式](http://www.dofactory.com/Patterns/PatternFactory.aspx)，因为您将能够将 DAL 实现隐藏在工厂后面并从工厂返回实体和实体集合。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T19:50:07.933

我同意数据调用不属于 UI 层。这些仅用于演示。

我认为它们适当地属于服务层。服务实现使用模型对象和持久层来实现其目标。无论是基于 XML 的 Web 服务还是本地接口，服务都是映射到用例并了解工作单元的对象。

要么将数据库调用放入单独的持久层，要么将它们嵌入模型对象中以获得额外的面向对象的纯度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T20:03:25.903

您之所以要将 CRUD 操作拉入一个单独的层，是为了以防万一您想要更改数据库系统。嗯，这就是我这样做的原因。我不建议这样做只是为了做好 OOD。但是给你...

几组类/接口

BusinessObject - 表示诸如客户之类的业务类型实体，具有 DataManager 作为属性。

DataManager - 也许你可以想出一个更好的名字，但是这个东西为 BusinessObjects 提供了 Load() 和 Save() 函数

SearchList - 返回事物列表，您的 SQL 查询在这里。这也应该表现得像带有 Next()、Eof() 和 CurrentRecord 类型成员的 RecordSet

构造函数/工厂 - 请参阅 FactoryPattern。您已经将数据库操作与业务对象分离，这会以必要的方式重新耦合它们。为 BusinessObject 分配适当的数据管理器实现

想出你想要的任何实际名称，但让我们再谈谈客户。假设您有一个 Oracle 数据库。你最终可能会得到这些类：

继承自 BusinessObject 的 boCustomer

oracleDMCustomer 继承或实现 DataManager

继承自 searchlist 的 searchlistCustomer 已通过抽象方法或作为接口公开，例如：

*   SearchAll() - 应该返回所有客户
*   SearchByZip(String zip) 应该返回给定邮政编码的所有客户

oracleSearchlistCustomer - 实现 searchlistCustomer，实际上将实现 SearchAll() 和 SearchByZip()

boFactory - 具有类似于 CreateObject(Type type) 的方法的静态类

searchlistFactory - 具有类似于 CreateSearchList(Type type) 的方法的静态类；

我会让你填补一些空白，但我认为重要的东西在那里。其他人可能有不同的想法，需要较少的抽象。在使用一种策略之前，我会模拟几种策略。

# ruby-on-rails - 填充常量值表

> ID：570940
> 
> 赞同：3
> 
> 时间：2009-02-20T19:38:01.097
> 
> 标签：ruby-on-rails, testing, migration

在 Rails 应用程序中，我需要数据库中的一个表来包含常量数据。

该表格内容暂时不打算更改，但我不想将内容放入代码中，以便能够在需要时更改它。

我尝试在创建它的迁移中填充此表，但这似乎不适用于测试环境并破坏了我的单元测试。在测试环境中，我的模型在我的开发环境中正常时永远无法返回任何值。

即使在测试环境中，有没有办法正确填充该数据库？有没有另一种方法来处理这些不应该在代码中的数据？

**编辑**

感谢大家的回答，尤其是 Vlad R 对问题的解释。

我现在明白为什么我的数据没有在测试中加载。这是因为测试环境使用`db:load`rake 命令直接加载模式而不是运行迁移。仅将我的值放在迁移中而不是在模式中，这些值不会被加载以进行测试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T20:14:12.667

您可能观察到的是测试框架没有运行迁移 (db:migrate)，而是直接加载 db/schema.rb (db:load)。

你有两个选择：

1.  继续将迁移用于生产和开发；对于测试环境，将您的常量数据添加到 db/fixtures 中的相应 yml 文件中
2.  保持现有的 db/fixtures 文件不变，并以与 db/fixtures 相同的方式创建另一组 yml 文件（包含常量数据），但在执行 rake db:load 模式初始化时可用于测试和生产/开发环境

为了覆盖那些使用 db:load 的场景（而不是 db:migrate - 例如测试，使用更快的 db:load 而不是 db:migrate 在新的开发机器上建立一个新数据库等）创建一个插件RAILS_APP/lib/tasks 中的 rakefile 通过将“种子”yml 文件（每个模型一个）中的常量初始化数据加载到数据库中来增加 db:load 任务。

以 db:seed rake 任务为例。将您的种子数据放入 db/seeds/.yml

```
#the command is: rake:db:load
namespace :db do
  desc 'Initialize data from YAML.'
  task :load => :environment do
    require 'active_record/fixtures'
    Dir.glob(RAILS_ROOT + '/db/seeds/*.yml').each do |file|
      Fixtures.create_fixtures('db/seeds', File.basename(file, '.*'))
    end
  end
end 
```

要涵盖增量方案 (db:migrate)，请定义**一个**与上面定义的任务执行相同操作的迁移。

如果您的种子数据发生变化，您将需要添加另一个迁移以删除旧的种子数据并加载新的数据，这在外键依赖等情况下可能很重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T20:14:46.207

看看我关于[加载种子数据](http://railspikes.com/2008/2/1/loading-seed-data)的文章。

有很多方法可以做到这一点。我喜欢一个名为[db:populate](http://code.google.com/p/db-populate/)的 rake 任务，它允许您在正常的 ActiveRecord 创建语句中指定固定数据。为了让数据进入测试，我只是在我的 test_helper 中加载了这个填充文件。但是，我想我将切换到已经填充了种子数据的测试数据库。

还有一个名为[SeedFu](http://www.intridea.com/posts/seed-fu-simple-seed-data-for-rails)的插件可以帮助解决这个问题。

无论您做什么，我都建议您不要为此使用固定装置，因为它们不会验证您的数据，因此很容易创建无效记录。

# .net - 在 ASP .NET 中访问 UNC 驱动器？

> ID：570944
> 
> 赞同：0
> 
> 时间：2009-02-20T19:39:01.190
> 
> 标签：.net, asp.net, security, unc

我有两组不同的图像文件，它们位于两个不同 Web 服务器上两个不同网站的根图像目录中。为了论证起见，假设第一个 Web 服务器称为 web1，主 IP 地址为 111.111.111.111，第二个 Web 服务器称为 web2，主 IP 地址为 111.111.111.112。

现在，我想在 web1 上编写一个从第一个网站读取文件的 Web 应用程序。我可以使用 System.IO 命名空间中的类轻松地做到这一点。但是如何才能为第二个 Web 服务器实现相同的功能。换句话说，我如何通过 UNC 以编程方式访问该目录并发送访问该驱动器中的资源所需的域用户帐户凭据。例如，我希望能够编写如下内容：Directory.GetFiles("\111.111.111.112\C$\inetpub\wwwroot\images", domain_user_name, domain_user_password)。理想情况下，我希望完成这项任务，而无需触及 Web 应用程序或 IIS 中的模拟设置。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T20:47:41.727

默认的 ASP.NET 帐户是本地帐户，没有网络权限。

您可以尝试在代码中进行模拟。请参阅： http: [//support.microsoft.com/default.aspx ?scid=KB;EN-US;306158](http://support.microsoft.com/default.aspx?scid=KB;EN-US;306158)

# svn - git-svn 树的 git 克隆？

> ID：570945
> 
> 赞同：17
> 
> 时间：2009-02-20T19:39:21.547
> 
> 标签：svn, git, workflow, git-svn

我有一个“git-svn”工作树。我想从这里克隆一个“纯”git repo，然后使用 git push/pull 在 git-svn 树和 git 树之间移动更改，同时还使用 'git svn dcommit/rebase' 在两者之间移动更改git-svn 树和它所基于的 SVN 存储库。

就使用 git 方法在 git 树之间来回移动事物而言，这似乎可以正常工作，但是一旦我与 git-svn 树中的 SVN 存储库进行交互，事情就会变得不稳定——要么我在推送时出错，要么在 git 树之间拉动，或者我在 git-svn 树中丢失了提交，或者其他奇怪的东西。

是否完全支持这种类型的 SVN <-> git-svn <-> git 工作流，还是我应该停止吠叫这棵树？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T20:20:49.153

我为我的一些项目设置了一个桥接器，但它只是从 git 到 svn 的单向（提供我们的 git master 分支的公共只读 SVN 镜像）。但是，由于它运行良好，它可能会帮助您或在双向场景中为您指明正确的方向，因为我认为是 git-> svn 会产生问题，而不是 svn-> git：

我的单向方案：github 上的现有 git 存储库，需要 git master 分支的只读 svn 镜像

*   在服务器上创建并初始化目标 subversion 存储库：

    ```
    svnadmin create svnrepo
    mkdir trunk
    svn import trunk svn://yoursvnserver/svnrepo
    rmdir -rf trunk 
    ```

*   创建混合 Git-Svn 签出并初始化 subversion 存储库

    ```
    git svn clone svn://yoursvnserver/svnrepo/trunk
    cd trunk
    git remote add github git://github.com/yourname/repo.git
    git fetch github
    git branch tmp $(cat .git/refs/remotes/github/master)
    git tag -a -m "Last fetch" last tmp
    INIT_COMMIT=$(git log tmp --pretty=format:%H | tail -1)
    git checkout $INIT_COMMIT .
    git commit -C $INIT_COMMIT
    git rebase master tmp
    git branch -M tmp master
    git svn dcommit --rmdir --find-copies-harder 
    ```

*   更新镜像

    ```
    git fetch github
    git branch tmp $(cat .git/refs/remotes/github/master)
    git tag -a -m "Last fetch" newlast tmp
    git rebase --onto master last tmp
    git branch -M tmp master
    git svn dcommit --rmdir --find-copies-harder
    mv .git/refs/tags/newlast .git/refs/tags/last 
    ```

来自 googlecode 的这两篇文章也可能有所帮助：

*   [从 Git 导入](http://code.google.com/p/support/wiki/ImportingFromGit)
*   [导出到 Git](http://code.google.com/p/support/wiki/ExportingToGit)
*   [将 Git 与 Google 代码托管一起使用](http://quirkygba.blogspot.com/2007/10/using-git-with-google-code-hosting.html)
*   [在 Google 代码项目中使用 Git 进行开发](http://google-opensource.blogspot.com/2008/05/develop-with-git-on-google-code-project.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-02-15T23:41:43.153

可能给您带来麻烦的一件事是，`git svn dcommit`它将重写它发送到 SVN 的所有提交——至少如果它被配置为将 SVN 元数据注释添加到提交消息的底部。因此，您将不得不采用一个流程，其中任何从您的 git-svn 工作区提交的存储库都针对它进行变基，从而丢失所有无论如何都无法存储在 SVN 中的合并历史记录。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-02-15T23:29:39.653

根据我所见，由于 SVN 表示合并的方式，git-svn 不支持此工作流程，并且不会支持。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-15T23:37:17.657

正如我在#git 上经常说的：

> git-svn 就像一辆会飞的汽车。每个人都想要一辆飞行汽车，直到他们意识到飞行汽车无论是汽车还是飞机都非常糟糕。

真正的解决方案是尽快完全摆脱 SVN。使用 git-svn 进行一次性迁移，然后将所有人迁移过来。Git*并不*难学。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-16T14:26:07.363

如果您能够将自定义挂钩安装到 Subversion 存储库中，请考虑使用[SubGit](http://subgit.com)。

SubGit 是一个自动同步 SVN 和 Git 存储库的服务器端解决方案。为了安装 SubGit，请执行以下操作：

```
 $ subgit configure $SVN_REPOS
    $ # Adjust $SVN_REPOS/conf/subgit.conf 
    $ #     to specify your branches and tags
    $ # Adjust $SVN_REPOS/conf/authors.txt 
    $ #     to introduce svn author names to their git counterparts
    $ subgit install $SVN_REPOS
    $ ...
    $ INSTALLATION SUCCESSFUL 
```

此时 SubGit 已经安装了由 every`svn commit`和触发的钩子`git push`。这样 SubGit 会转换任何传入的修改。

另请参阅与[git-svn 的](http://subgit.com/documentation/gitsvn.html)比较。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-08-20T07:09:29.223

使用 git 和 git-svn 1.7.1，看来我刚刚做的测试似乎工作得很好。

```
git svn init [url]
git svn fetch 
```

然后，您必须创建并签出一个虚拟分支才能推送到主分支。

```
git checkout -b dummy 
```

然后你可以将它克隆（`git clone ...`）到另一个纯 git 存储库，修改它，提交它（`git commit`）然后推送（`git push`）到 git-svn 存储库。

回到 git svn 仓库：

```
git checkout master
git svn dcommit 
```

将提交所有已推送的 git 提交。

# c# - WPF：在 UserControl 的构造函数中加载数据会破坏设计器

> ID：570949
> 
> 赞同：7
> 
> 时间：2009-02-20T19:40:21.297
> 
> 标签：c#, wpf, constructor, user-controls

我有一个带有用户控件的主窗口。在用户控件的默认构造函数中添加代码时，设计器停止显示主窗口。它给出了一条消息：

> 加载问题
> 
> 该文档包含在加载设计器之前必须修复的错误。
> 修复错误后重新加载设计器。
> 
> 重新加载设计器

为什么是这样？

这是我在构造函数中的代码：

```
using (var context = new Data.TVShowDataContext())
{
    var list = from show in context.Shows
               select show;

    listShow.ItemsSource = list;
} 
```

如果我不能使用构造函数来填充 gui 数据，我应该什么时候做呢？用绑定来做这件事会更好吗？有什么建议吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-20T20:50:41.593

WPF 设计器将在显示子元素时对子元素执行构造函数。我的猜测是，您的构造函数中有代码在设计时抛出异常，可能是因为它使用的对象仅在运行时可用。一个解决方案是用检查包围您的构造函数逻辑，以防止它在设计器中显示时执行。

```
if (!System.ComponentModel.DesignerProperties.GetIsInDesignMode(this))
{
  using (var context = new Data.TVShowDataContext())
  {
    var list = from show in context.Shows
               select show;

    listShow.ItemsSource = list;
  }    
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T19:54:40.777

我个人会为我的数据源使用可观察的集合。那里有很多示例，但基本上您的代码看起来像这样。我没有测试过这段代码。如果您有任何问题，请添加一些评论。

这里有两个要点。一，除非您不在设计模式下，否则不要加载任何数据（如果您需要设计支持，您可以放置​​和 else 语句并加载存根 POCO 数据）。二，你应该在一个单独的线程上加载你的数据，然后是你的 UI 线程。

## 更新

代码有几个更新。我将（新线程）更改为使用 QueueUserWorkItem，我更改了 AddItems 方法，因为 ObservableCollection 不支持 AddRange，并且我更改了 IEnumerable 上的拼写

```
public class TvShowsDataSource
{
    public ObservableCollection<Show> Shows { get; set; }

    private void AddItems(IEnumerable<Show> shows)
    {
            foreach(var show in shows)
                   Shows.Add(show);
    }

    public void LoadShowsAsync(Dispatcher dispatcher)
    {
            ThreadPool.QueueUserWorkItem((state) =>
                   LoadShows(dispatcher));
    }

    private void LoadShows(Dispatcher dispatcher)
    {
        if (dispatcher == null)
            throw new ArgumentNullException("dispatcher");

        using (var context = new Data.TVShowDataContext())
        {
            var list = from show in context.Shows
                       select show;

            dispatcher.Invoke(AddItems(list));
        }
    }
}

public class UserControl1
{
    private readonly TvShowsDataSource tvShowsDataSource;

    public UserControl1() : this(new TvShowsDataSource()) {}

    public UserControl1(TvShowsDataSource tvShowsDataSource )
    {
        InitializeComponent();
        this.tvShowsDataSource = tvShowsDataSource;
        listShow.ItemsSource = tvShowsDataSource.Shows;
        this.Loaded += UserControl1_Loaded;
    }

    public void UserControl1_Loaded(object sender, RoutedEventArgs e)
    {
        if (!System.ComponentModel.DesignerProperties.GetIsInDesignMode(this))
        {
            tvShowsDataSource.LoadShowsAsync(this.Dispatcher);
        }
    }
} 
```

# python - 删除上传的文件时出现 Django“SuspiciousOperation”错误

> ID：570952
> 
> 赞同：2
> 
> 时间：2009-02-20T19:41:08.110
> 
> 标签：python, windows, django

我正在使用`manage.py runserver`提供文件的命令在 Windows XP 上的 Django 中进行开发。Apache 没有参与。当我登录管理并尝试删除文件时，我收到“SuspiciousOperation”错误。

这是回溯：
[http ://dpaste.com/123112/](http://dpaste.com/123112/)

这是我的完整模型：
[http ://dpaste.com/hold/123110/](http://dpaste.com/hold/123110/)

我怎样才能摆脱这个“SuspiciousOperation”错误？

**编辑：**这是我的媒体设置：

```
MEDIA_ROOT = 'C:/Server/Projects/postnzb/static/'
MEDIA_URL = '/static/' 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T20:08:44.190

你`MEDIA_ROOT`在`settings.py`什么？从回溯来看，您似乎已将您的设置`MEDIA_ROOT`为`/static/`.

出现此错误是因为 Django 试图访问`/static/`它无法访问的内容。`MEDIA_ROOT`为like设置一个绝对路径名，`C:/Documents/static/`并授予 Django 访问该目录的完全权限。

那应该可以解决您的问题。

**附录**：既然你`MEDIA_ROOT`似乎没问题，我猜你是`MEDIA_URL`用来删除文件而不是`MEDIA_ROOT`. 事实上，从错误看来，Django 试图访问`/static/files/8.nzb`并被拒绝访问。显然，`/static/`是你的`MEDIA_URL`而不是你的`MEDIA_ROOT`。模型方法永远不应该尝试使用`MEDIA_URL`. 我相信对您的代码的审查会发现错误。

**更新**：我浏览了您的代码，似乎您正在设置`File.nzb`使用`%(1)sfiles/%(2)s.nzb' % {'1': settings.MEDIA_URL, '2': self.pk}`它的方法`MEDIA_URL`，然后在`delete()`方法中调用as`delete()`的超类的方法，这显然是错误的，因为它将尝试删除并尝试通过. 修复它将摆脱错误。我将把确切的解决方案留给你作为练习:)`File``super(File, self).delete()``File.nzb``MEDIA_URL`

# architecture - 用于建造/设计房屋的开源软件？

> ID：570953
> 
> 赞同：3
> 
> 时间：2009-02-20T19:41:17.953
> 
> 标签：architecture, open-source, 3d, modeling

是否有任何用于建造或设计房屋的开源工具？它是否具有许多功能，例如计算成本或模拟极端天气条件/老化等？

我有想法开始这样的项目，或者加入它；我认为它会非常整洁，但我在上面找不到任何东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T19:45:02.890

[这](http://www.osalt.com/autocad)是 AutoCAD 的开源替代品列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T19:59:59.453

几年前，红帽杂志曾报道过使用开源理念从头到尾建造房屋[的故事。](http://www.redhat.com/magazine/014dec05/features/construction/)它包括一些关于可用软件工具的段落。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T20:24:14.670

对于外部视图（带有天气照明等）谷歌草图是好的。
对于任何免费 cad 都可以做的工程图，请查看 windows 上基于 intellicad 的工程图

# javascript - 如何使用 Firebug 或类似工具调试 JavaScript / jQuery 事件绑定？

> ID：570960
> 
> 赞同：618
> 
> 时间：2009-02-20T19:42:51.523
> 
> 标签：javascript, jquery, event-handling, firebug, jquery-events

我需要调试一个使用 jQuery 进行一些相当复杂和混乱的[DOM](http://en.wikipedia.org/wiki/Document_Object_Model)操作的 Web 应用程序。在某一时刻，一些绑定到特定元素的事件不会被触发，只是停止工作。

如果我有能力编辑应用程序源代码，我会向下钻取并添加一堆[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29) `console.log()`语句和注释/取消注释代码片段以尝试查明问题。但是让我们假设我无法编辑应用程序代码并且需要使用 Firebug 或类似工具完全在 Firefox 中工作。

Firebug 非常擅长让我导航和操作 DOM。不过，到目前为止，我还没有弄清楚如何使用 Firebug 进行事件调试。具体来说，我只想查看在给定时间绑定到特定元素的事件处理程序列表（使用 Firebug JavaScript 断点来跟踪更改）。但要么 Firebug 没有能力查看绑定事件，要么我太笨了，找不到它。:-)

有什么建议或想法吗？理想情况下，我只想查看和编辑绑定到元素的事件，类似于我今天编辑 DOM 的方式。

* * *

## 回答 #1

> 赞同：357
> 
> 时间：2009-02-20T20:21:09.293

请参阅[如何在 DOM 节点上查找事件侦听器](https://stackoverflow.com/questions/446892/how-to-find-event-listeners-on-a-dom-node/447106#447106)。

简而言之，假设某个事件处理程序附加到您的元素（例如）：`$('#foo').click(function() { console.log('clicked!') });`

你像这样检查它：

*   jQuery 1.3.x

    ```
    var clickEvents = $('#foo').data("events").click;
    jQuery.each(clickEvents, function(key, value) {
      console.log(value) // prints "function() { console.log('clicked!') }"
    }) 
    ```

*   jQuery 1.4.x

    ```
    var clickEvents = $('#foo').data("events").click;
    jQuery.each(clickEvents, function(key, handlerObj) {
      console.log(handlerObj.handler) // prints "function() { console.log('clicked!') }"
    }) 
    ```

请参阅[`jQuery.fn.data`](http://docs.jquery.com/Core/data#name)（jQuery 在其中存储您的处理程序内部）。

*   jQuery 1.8.x

    ```
    var clickEvents = $._data($('#foo')[0], "events").click;
    jQuery.each(clickEvents, function(key, handlerObj) {
      console.log(handlerObj.handler) // prints "function() { console.log('clicked!') }"
    }) 
    ```

* * *

## 回答 #2

> 赞同：162
> 
> 时间：2009-02-20T19:52:50.687

有一个很好的书签，叫做[Visual Event](http://www.sprymedia.co.uk/article/Visual+Event+2)，它可以显示所有附加到元素的事件。它具有针对不同类型事件（鼠标、键盘等）的颜色编码突出显示。当您将鼠标悬停在它们上时，它会显示事件处理程序的主体、它的附加方式以及文件/行号（在 WebKit 和 Opera 上）。您也可以手动触发事件。

它无法找到每个事件，因为没有标准方法来查找附加到元素的事件处理程序，但它适用于流行的库，如 jQuery、Prototype、MooTools、YUI 等。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-10-07T03:26:22.197

您可以使用[FireQuery](http://firequery.binaryage.com/#features)。它显示附加到 Firebug 的 HTML 选项卡中的 DOM 元素的任何事件。它还显示通过 附加到元素的任何数据`$.data`。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-02-20T21:04:56.600

这是一个插件，它可以列出任何给定元素/事件的所有事件处理程序：

```
$.fn.listHandlers = function(events, outputFunction) {
    return this.each(function(i){
        var elem = this,
            dEvents = $(this).data('events');
        if (!dEvents) {return;}
        $.each(dEvents, function(name, handler){
            if((new RegExp('^(' + (events === '*' ? '.+' : events.replace(',','|').replace(/^on/i,'')) + ')$' ,'i')).test(name)) {
               $.each(handler, function(i,handler){
                   outputFunction(elem, '\n' + i + ': [' + name + '] : ' + handler );
               });
           }
        });
    });
}; 
```

像这样使用它：

```
// List all onclick handlers of all anchor elements:
$('a').listHandlers('onclick', console.info);

// List all handlers for all events of all elements:
$('*').listHandlers('*', console.info);

// Write a custom output function:
$('#whatever').listHandlers('click',function(element,data){
    $('body').prepend('<br />' + element.nodeName + ': <br /><pre>' + data + '<\/pre>');
}); 
```

Src：（我的博客）-> [http://james.padolsey.com/javascript/debug-jquery-events-with-listhandlers/](http://james.padolsey.com/javascript/debug-jquery-events-with-listhandlers/)

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2010-08-21T18:21:26.617

WebKit 开发者控制台（可在 Chrome、Safari 等中找到）允许您查看元素的附加事件。

[此 Stack Overflow 问题中的更多详细信息](https://stackoverflow.com/questions/10213703/how-do-i-view-events-fired-on-an-element-in-chrome-web-developer)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-08-20T15:12:59.060

`$._data(htmlElement, "events")`在 jquery 1.7+ 中使用；

前任：

`$._data(document, "events")`或者`$._data($('.class_name').get(0), "events")`

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-11-18T16:31:20.010

正如一位同事建议的那样，console.log > alert：

```
var clickEvents = $('#foo').data("events").click;
jQuery.each(clickEvents, function(key, value) {
    console.log(value);
}) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-20T20:12:39.563

jQuery 将事件存储在以下位置：

```
$("a#somefoo").data("events") 
```

做一个`console.log($("a#somefoo").data("events"))`应该列出附加到该元素的事件。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-09-03T22:49:53.953

在最新的 Chrome (v29) 中使用 DevTools，我发现这两个技巧对调试事件非常有帮助：

1.  列出[最后选择的 DOM 元素的 jQuery 事件](https://developers.google.com/chrome-developer-tools/docs/console#accessing_recently_selected_elements_and_objects)

    *   检查页面上的元素
    *   在控制台中键入以下内容：

        > $._data( [$0](https://developers.google.com/chrome-developer-tools/docs/console#accessing_recently_selected_elements_and_objects) , "events") //假设 jQuery 1.7+

    *   它将列出与其关联的所有 jQuery 事件对象，展开感兴趣的事件，右键单击“处理程序”属性的函数并选择“显示函数定义”。它将打开包含指定函数的文件。
2.  利用[monitorEvents](https://developers.google.com/chrome-developer-tools/docs/commandline-api#monitoreventsobject_events) () 命令

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-10-28T13:35:02.960

看起来 FireBug 工作人员正在开发 EventBug 扩展。它将向 FireBug - 事件添加另一个面板。

“事件面板将列出页面上按事件类型分组的所有事件处理程序。对于每种事件类型，您可以打开以查看侦听器绑定到的元素以及函数源的摘要。” [EventBug 上升](http://blog.getfirebug.com/2009/09/18/eventbug-rising/ "Getfirebug 博客上的条目")

虽然他们现在不能说什么时候发布。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2012-04-27T16:15:35.223

我还在 chrome 商店中找到了[jQuery Debugger](https://chrome.google.com/webstore/detail/dbhhnnnpaeobfddmlalhnehgclcmjimi)。您可以单击一个 dom 项目，它将显示绑定到它的所有事件以及回调函数。我正在调试一个没有正确删除事件的应用程序，这有助于我在几分钟内找到它。显然这是针对chrome，而不是firefox。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-11-17T10:40:02.770

**`ev`元素旁边的图标**

在 Firefox 开发者工具的*Inspector*面板中列出了绑定到一个元素的所有事件。

首先选择一个带有`Ctrl`++的元素，例如 Stack Overflow 的 upvote 箭头`Shift`。`C`

单击`ev`元素右侧的图标，将打开一个对话框：

[![事件工具提示](https://i.stack.imgur.com/9QYSA.png)](https://i.stack.imgur.com/9QYSA.png)

单击`||`所需事件的暂停符号符号，这将打开处理程序行上的调试器。

现在，您可以像往常一样在调试器中放置断点，方法是单击该行的左边距。

这在以下位置提到：[https ://developer.mozilla.org/en-US/docs/Tools/Page_Inspector/How_to/Examine_event_listeners](https://developer.mozilla.org/en-US/docs/Tools/Page_Inspector/How_to/Examine_event_listeners)

不幸的是，我找不到一种方法让它与漂亮化很好地配合，它似乎只是在缩小的行处打开：[如何在 Firefox / Firebug 中美化 Javascript 和 CSS？](https://stackoverflow.com/questions/3216583/beautify-javascript-and-css-in-firebug/33753982#33753982)

在 Firefox 42 上测试。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-02-20T20:03:29.977

根据[这个线程](http://groups.google.com/group/firebug/browse_thread/thread/607400c545ce6048?pli=1 "这个线程")，Firebug 无法查看哪些事件附加到 DOM 元素上的侦听器。

看起来您可以做的最好的事情是 tj111 建议的内容，或者您​​可以右键单击 HTML 查看器中的元素，然后单击“记录事件”，这样您就可以看到针对特定 DOM 元素触发了哪些事件。我想可以这样做以查看哪些事件*可以*触发特定功能。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-01-15T22:33:31.060

Firebug 2.0 版引入了一个[*事件*面板](https://getfirebug.com/wiki/index.php/Events_Side_Panel)，它列出了当前在[*HTML*面板](https://getfirebug.com/wiki/index.php/HTML_Panel)中选择的元素的所有事件。

[![Firebug 中的 *Events* 侧面板](https://i.stack.imgur.com/p9fUo.png)](https://i.stack.imgur.com/p9fUo.png)

*如果选中了Show Wrapped Listeners*选项，它还可以显示包装到 jQuery 事件绑定中的事件侦听器，您可以通过[*事件*面板的选项菜单](https://getfirebug.com/wiki/index.php/Events_Side_Panel#Options_Menu)访问该选项。

使用该面板，调试事件处理程序的工作流程如下：

1.  选择带有要调试的事件侦听器的元素
2.  在*事件*侧面板中，右键单击相关事件下的函数并选择*设置断点*
3.  触发事件

=> 脚本执行将在事件处理函数的第一行停止，您可以对其进行单步调试。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-06-11T14:33:03.763

[Firebug 2](https://blog.getfirebug.com/2014/06/10/firebug-2-0/#dom-events-inspector)现在确实包含 DOM 事件调试/检查。

# .net - JQuery Ajax 表单提交

> ID：570962
> 
> 赞同：1
> 
> 时间：2009-02-20T19:43:04.907
> 
> 标签：.net, javascript, jquery, ajax

不完全确定为什么会发生这种情况，但是单击按钮后，我调用了 JQuery Ajax 控件，之后我不想继续提交表单，但在页面仍然提交之前。

```
<asp:ImageButton id="btnContinue" OnClick="btnContinue_Click" runat="server" OnClientClick="return false;" /> 
```

和 jQuery：

```
 $("#<%=btnContinue.ClientID%>").click(function() {
            var currentpickupLocation = document.getElementById("<%=ddlPickupLocation.ClientID %>").value;
            var currentpickupDate = document.getElementById("<%=txtPickupDate.ClientID %>").value;
            var currentCulture = "<%= GetCulture() %>";
            var params = $.toJSON({pickupLocation: currentpickupLocation, pickupDate: currentpickupDate});
            $.ajax({
                type: "POST",
                url: "LocationService.asmx/GetBlackoutDates",
                data: params,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(locations) {
                    return false;
                }
            });
        }); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T19:53:56.630

您需要在单击区域中返回 false，如下所示：

```
$("#<%=btnContinue.ClientID%>").click(function() {
    var currentpickupLocation = document.getElementById("<%=ddlPickupLocation.ClientID %>").value;
    var currentpickupDate = document.getElementById("<%=txtPickupDate.ClientID %>").value;
    var currentCulture = "<%= GetCulture() %>";
    var params = $.toJSON({
        pickupLocation: currentpickupLocation, 
        pickupDate    : currentpickupDate
    });
    $.ajax({
        type: "POST",
        url: "LocationService.asmx/GetBlackoutDates",
        data: params,
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(locations) {
            return false;
        }
    });
    return false;  //this tells the browser not to submit
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T20:28:21.570

使用 preventDefault() 也可以：

[http://docs.jquery.com/Events/jQuery.Event#event.preventDefault.28.29](http://docs.jquery.com/Events/jQuery.Event#event.preventDefault.28.29)

# jquery - mootools Array.include() 的 jQuery 等价物是什么？

> ID：570963
> 
> 赞同：1
> 
> 时间：2009-02-20T19:43:44.953
> 
> 标签：jquery, arrays, include, mootools

仅当数组中尚不存在元素时，我才尝试将元素添加到数组中。我曾经使用 mootools 的[Array.include](http://mootools.net/docs/Native/Array#Array:include)方法来执行此操作，但现在我使用的是 jquery。

有没有办法在 jquery 中做到这一点？

[http://mootools.net/docs/Native/Array#Array:include](http://mootools.net/docs/Native/Array#Array:include)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T19:48:27.953

没关系，我找到了...

[jQuery.unique();](http://docs.jquery.com/Utilities/jQuery.unique#array)

[http://docs.jquery.com/Utilities/jQuery.unique#array](http://docs.jquery.com/Utilities/jQuery.unique#array)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T19:45:29.880

删除我愚蠢的答案...

作为一般规则，我建议使用[jQuery 文档](http://docs.jquery.com)和[jQuery API 浏览器](http://api.jquery.com)

# oracle - Primavera 支持哪种导入功能？

> ID：570983
> 
> 赞同：0
> 
> 时间：2009-02-20T19:49:07.390
> 
> 标签：oracle, primavera

我有一个客户希望我们将数据从 Oracle 导入现有的 Primavera 项目管理系统。我知道 Oracle 及其导入/导出功能，但我不知道 Primavera。我的客户也没有。我试图通过 Primavera 支持站点查找此信息，但它需要站点 ID 才能搜索它的知识库（我没有）。谷歌没有发现任何有用的东西。

有人有将数据导入 Primavera 的经验吗？如果是这样，它有多强大？任何好的在线资源如何使用它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-01T23:47:58.223

在一个层面上，P6 允许您导入 MS Project 文件，甚至是 P3 和 SureTrak 文件。但是，我认为这不是您要寻找的。

在另一个层面上，Oracle 提供了一个工具，可让您使用 Excel 上传多种项目：

*   活动代码（全局和
*   项目特定）
*   基线类型 - 项目代码
*   费用类别
*   资源
*   项目阶段
*   OBS
*   文档类别
*   用户
*   文件状态
*   角色
*   开销代码
*   资金来源
*   风险类型
*   资源代码
*   笔记本主题
*   成本帐户
*   资源转移
*   资源曲线
*   资源费率
*   日历（全局和项目特定）

一旦您或您的客户获得 Oracle 支持编号，您将获得一份 Excel 副本并通过搜索文档 ID 编号 893942.1 了解更多信息

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-10-25T00:14:39.193

我知道这是一个老问题，但我们只使用[P6 Loader](http://www.emerald-associates.com/p6-loader.html)进行这种导入/导出操作。

我知道这是一个私人解决方案，但它确实让我们的生活更轻松。在您的情况下，您只需将 oracle 数据导出到 excel 即可完成剩下的工作。

# linux - 如何将标准压缩到文件中并将标准打印到标准输出？

> ID：570984
> 
> 赞同：33
> 
> 时间：2009-02-20T19:49:11.993
> 
> 标签：linux, bash, shell, tee

我想执行一个命令，让该命令的输出得到 gzip'd 的运行，并回显/发出该命令的输出。

即，类似：

```
echo "hey hey, we're the monkees" | gzip --stdout > my_log.gz 
```

除了行执行时，我想在标准输出上看到这个：

```
hey hey, we're the monkees 
```

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-02-20T20:05:32.997

另一种方式（假设 shell 像`bash`or `zsh`）：

```
echo "hey hey, we're the monkees" | tee >(gzip --stdout > my_log.gz) 
```

公认的奇怪`>()`语法基本上执行以下操作：

*   创建新的 FIFO（通常在 FIFO 中`/tmp/`）
*   在内部执行命令`()`并将 FIFO 绑定到该子命令上的标准输入
*   将 FIFO 文件名返回到命令行。

那么`tee`，最终看到的是这样的：

```
tee /tmp/arjhaiX4 
```

所有`gzip`看到的是它的标准输入。

对于 Bash，请参阅[`man bash`](http://www.gnu.org/software/bash/manual/bashref.html)详细信息。它在[重定向](http://www.gnu.org/software/bash/manual/bashref.html#Redirections)部分。对于 Zsh，请参阅[`man zshexpn`](http://www.manpagez.com/man/1/zshexpn/)“进程替换”标题下。

据我所知，Korn Shell、经典 Bourne Shell 的变体（包括 ash 和 dash）以及 C Shell 不支持这种语法。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-02-20T19:51:17.493

```
echo "hey hey, we're the monkees" | tee /dev/tty | gzip --stdout > my_log.gz 
```

正如评论中指出的那样，`/dev/stdout`可能比`/dev/tty`在某些情况下效果更好。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-20T19:53:38.953

喝杯漂亮的[T恤](http://www.gnu.org/software/coreutils/manual/html_node/tee-invocation.html)！

> tee 命令将标准输入复制到标准输出以及作为参数给出的任何文件。当您不仅想通过管道发送一些数据，而且还想保存副本时，这很有用

当我度过一个缓慢的下午时，这里有一些精彩的说明性 ascii-art...

```
 +-----+                   +---+                  +-----+  
stdin ->   |cmd 1|    -> stdout ->   |tee|   ->  stdout  -> |cmd 2|
           +-----+                   +---+                  +-----+
                                       |
                                       v
                                     file 
```

正如 grayfade 在另一个答案中所展示的那样，“文件”不必是常规文件，而可以是 FIFO，让您将 tee 的输出通过管道传输到第三个命令中。

```
 +-----+                   +---+                  +-----+  
stdin ->   |cmd 1|    -> stdout ->   |tee|   ->  stdout  -> |cmd 2|
           +-----+                   +---+                  +-----+
                                       |
                                       v
                                     FIFO
                                       |
                                       v
                                    +-----+
                                    |cmd 3|
                                    +-----+ 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-01-04T22:52:09.627

只是发布一种不涉及触摸磁盘的方式：

```
echo "hey hey, we're the monkees" | (exec 1>&3 && tee /proc/self/fd/3 | gzip --stdout > my_log.gz) 
```****************