# StackOverflow 问答 000558000-000558999

# .net - ASP.NET MVC = 带有 .NET 类库的经典 ASP。真的吗？

> ID：558002
> 
> 赞同：12
> 
> 时间：2009-02-17T18:00:17.940
> 
> 标签：.net, asp.net-mvc

[这篇](http://geekswithblogs.net/AzamSharp/archive/2007/12/11/117590.aspx)博文和我们的一位资深开发人员认为，Web 开发已经通过 ASP.net MVC 完成了一个完整的循环。这并不是关于 VB 脚本与 VB9/10 或任何最新版本的问题。除了路由引擎，辅助类和方法。你可以提出哪些强有力的论据

> **ASP.net MVC != 经典 ASP + .net BCL**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-17T18:08:06.830

在 ASP 中，“视图”接收请求。在 ASP.NET-MVC 中，控制器接收请求，随后它可以从许多不同的视图中选择来创建响应。

请求处理与响应处理的这种分离与 ASP 非常不同。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-17T18:10:38.523

该论点是在 MVC 中的所有内容都是视图的假设下起作用的。

现实情况是，视图只是拼图中的一小部分，而认为它是整体则表明对模式和框架都缺乏理解。如果不先教育这个人，你就不能提出论点，而在教育的过程中，论点将变得无关紧要。

为了解决博客文章本身的问题，是的，您确实会因为放弃丰富的控件而失去很多功能，尤其是当您谈论从第三方供应商处购买的控件时。然而，现在有全套的 javascript 小部件，即使不是更好，也可以与任何可用于 asp 的东西一样好，而且它们是免费的。不仅如此，使用 ASP.net 意味着要购买一个在大约 90% 的时间内都可以工作的极其复杂的框架。这样做的问题是 90% 对任何不平凡的事情都是不够的，而围绕框架工作来获得额外的 10% 可能是生活地狱。另一件事是，购买这种复杂性所带来的性能绝对糟糕透顶。

MVC 和 ASP.net 之间的比较需要在小部件与良好的架构、灵活的直接标记和良好的性能之间进行。如果您需要这些小部件，请坚持使用 ASP.net，上帝知道它不会很快消失。如果您对 html、javascript 和 CSS 等 Web 技术感到满意，那么失去那些开箱即用的小部件会很糟糕，但您得到的将大大超过您失去的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-17T18:08:37.983

这篇博文并不是基于对 MVC 框架的非常完整的理解。MVC 促进了良好的关注点分离，视图文件中包含的代码应该非常基础；所有实际的编码都发生在控制器内。博客文章作者说 ASP.Net 的真正优势在于控件，我认为优势在于事件驱动模型和有状态环境的呈现超越了几乎无状态的环境。MVC 保持了这种优势，同时也促进了与实际 UI 的进一步分离。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T18:19:05.837

经典 ASP 和 ASP.NET MVC 之间存在显着的基本设计差异。最显着的区别是业务逻辑与显示逻辑的分离。在经典的 ASP 中，这两种类型的逻辑在大多数情况下都混合在标记中。在 ASP.NET MVC 中——正确使用——视图组件中的唯一代码是呈现页面所需的代码。业务逻辑、显示在页面上的数据的选择以及解释和处理输入的逻辑都可以在控制器和模型中找到。

由于这种差异，ASP.NET MVC 显着提高了代码在经典 ASP 和 WebForms 上的可测试性。所有业务逻辑都可以在与渲染引擎分离的类中找到，因此可以（更）轻松地通过单元测试进行测试。在经典的 ASP 和 WebForms 中，在某种程度上，这种逻辑大部分是在页面或代码隐藏中找到的，这更难测试。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-17T18:20:30.823

> 另外，在我看来，一旦您将经典的 ASP 之类的代码浮动在页面的 HTML 中，维护应用程序将更加困难。

我同意用意大利面条代码维护页面可能更难。

但是 ASP.NET MVC 视图仍然像 ASP.NET WebForms 一样编译 - 这与 ASP 3 有很大不同，并且您可以在 .aspx 中使用 IntelliSense。

使用 MVC 进行整体应用程序维护实际上要简单得多。为您的代码创建单元测试要容易得多，这可以创建一个很好的网络来捕获错误（并且还可以增加开发人员对代码真正有效的信心）。

在 Web 窗体中创建页面非常容易，但很多时候很难测试页面背后的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T22:12:41.583

我是那篇博文的原作者，以下是我对此的看法：

ASP.NET MVC 是针对不同受众和目的的不同框架。ASP.NET MVC 的主要目的是关注点分离和可测试性。视图代码和 HTML 混合代码确实会创建意大利面条式代码，但您应该始终将视图保留为小组件。这将使调试应用程序和发现问题变得更容易，而不是将所有视图保持在同一页面上并造成混乱。

ASP.NET MVC 不得不放弃许多强大的 ASP.NET 控件。但幸运的是，许多 JavaScript 库都推出了新的酷控件，可以插入到 ASP.NET MVC 中。

软件就是权衡取舍。您正在交易 ASP.NET 强大的控件、ViewState 管理、回发等，并完全控制请求/响应周期。如果您对 ViewState、回发问题感到满意并且对单元测试不感兴趣，那么也许 ASP.NET MVC 不适合您。

此外，随着 IronRuby 的开发，我认为 ASP.NET MVC 是一个非常强大的框架。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T18:07:01.217

新的 ASP.NET MVC 的 View 组件支持类似于 ASP 3.0 的语法。

事实上，这种语法 (<% %>) 在 ASP.NET WebForms 中总是可用的。

您仍然可以在 MVC 中使用 ASP.NET 控件（ < asp:control > ），或者您可以使用新语法（恕我直言，这很奇怪）或使用 NVelocity 等其他框架。

这一系列可用技术不能被视为 .NET BCL 上的旧 ASP。

# c - ANSI C 无回音键盘输入

> ID：558009
> 
> 赞同：4
> 
> 时间：2009-02-17T18:01:20.900
> 
> 标签：c

我一直在谷歌搜索没有运气。我正在寻找一种方法来执行 getc() 或 gets() 或任何不会回显到终端的方法。我看到了 kbhit() 但这似乎不是 ANSI 的一部分。理想情况下，我想要看起来像的代码

```
char s[100];
no_echo_gets(s); /* Won't echo to screen while being typed */
printf("%s\n", s); 
```

有没有人知道一个好的 ANSI 兼容方式来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T18:14:07.453

对于类 UNIX 系统，您想使用 ECHO 标志...

```
#include <termios.h>
...
struct termios t;
tcgetattr(fd, &t);
t.c_lflag &= ~ECHO;
tcsetattr(fd, TCSANOW, &t);
... 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-09-24T06:02:49.187

getpass 命令存在于 Linux 中。但是您可以制作一个更漂亮的版本，单独的系统回显不会消除对输入命令的需求，而取消缓冲并不会消除数据输入后回车的产生。将两者结合起来可以很好地近似安静的进入。您可以添加一个星号来给出一个秘密条目的外观，所以这里是两个建议的组合：

```
 #include <stdio.h>
    #include <termios.h>
    #include <unistd.h>
    int getche(void);
    int main(int argc, char **argv){
    int i=0;       
    char d,c='h',s[6];
    printf("Enter five secret letters\n");
    s[5]='\0'; //Set string terminator for string five letters long
    do{
      d=getche();//Fake getche command silently digests each character
    printf("*");
      s[i++]=d;} while (i<5);
    printf("\nThank you!!\n Now enter one more letter.\n");
    c=getchar();
    printf("You just typed %c,\nbut the last letter of your secret string was %c\n",c,d);   
    printf("Your secret string was: %s\n",s);   
        return 0;
    }
    /* reads from keypress, echoes */
        int getche(void)
        {
            struct termios oldattr, newattr;
            int ch;
            tcgetattr( STDIN_FILENO, &oldattr );
            newattr = oldattr;
            newattr.c_lflag &= ~( ICANON | ECHO);\\knock down keybuffer
            tcsetattr( STDIN_FILENO, TCSANOW, &newattr );
            system("stty -echo");\\shell out to kill echo
            ch = getchar();
            system("stty echo");
            tcsetattr( STDIN_FILENO, TCSANOW, &oldattr );
            return ch;
        } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T18:15:06.423

您不能使用 ANSI C 以跨平台方式执行此操作。您必须使用一些特定于操作系统的代码，或使用诸如[ncurses](http://www.gnu.org/software/ncurses/)之类的库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T18:40:39.683

由于您的任务相当基本，如果幸运的话，您的系统将具有以下[`getpass()`](http://pubs.opengroup.org/onlinepubs/7908799/xsh/getpass.html)功能：

```
char * getpass(const char *prompt); 
```

如果您不想要提示，只需执行以下操作：

```
char *s = getpass("");
if (s != NULL)
    printf("Your password was %s!\n", s); 
```

[`getpass()`](http://pubs.opengroup.org/onlinepubs/7908799/xsh/getpass.html)与所有与回显和缓冲相关的 C 函数一样，它是非标准的，但存在于 Mac OS X（可能是 Linux）上，并且列在 GNU C 库中，因此它可能存在于任何使用 glibc 的系统上。

如前所述，ANSI 和 ISO 标准*没有*指定读取输入而不回显或读取无缓冲输入（即一次读取一个字符）的标准方式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-22T03:45:46.347

也许你可以这样尝试：

```
#include<stdio.h>
char s[100];
system("stty -echo");
scanf("%s",s); /* Won't echo to screen while being typed */
system("stty echo");
printf("You have entered:");
printf("%s\n", s);
return 0;
} 
```

在 Linux 中，系统功能“stty -echo”是在没有回显的情况下输入某事。希望这会有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T18:08:46.577

没有一个；ANSI C 和 ISO C++ 都没有这样的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T18:14:26.597

这将取决于您的环境，这不是语言提供的。如果您打算进行广泛的字符模式 I/O，您可能会查看类似 curses 之类的库。否则，您将不得不手动操作终端或 Windows 控制台。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-17T18:15:17.733

ANSI 和 ISO C 没有定义此功能，但是大多数 C 编译器都有 getch() 或类似的变体。

您需要为您使用的每个编译器进行预处理器定义，该编译器为此具有不同的库和函数。这并不难，尽管您可能会认为它很烦人。

-亚当

# c# - 为什么我不能在 C# 中执行 ??=？

> ID：558010
> 
> 赞同：16
> 
> 时间：2009-02-17T18:01:40.340
> 
> 标签：c#, language-features

我经常发现自己在做：

```
foo = foo ?? x; 
```

为什么我不能这样做：

```
foo ??= x; 
```

**编辑**：我知道这不是语言的一部分......我的问题是“为什么不”？我发现重复“foo”的必要性令人不快并且可能容易出错。它看起来和以下一样丑陋：

```
foo = foo + x; 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-17T18:07:09.640

当我想到它时，

```
foo = foo ?? x 
```

真的只是

```
foo = foo != null ? foo : x 
```

在那一点上，与 += 的类比开始分崩离析。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-17T18:07:51.230

没有理由*不能*有这样的运算符，但我怀疑语言增加的复杂性虽然轻微，但超过了好处（我认为“非常轻微”）。

基本上，该语言的任何添加都有一个相当高的标准。你说你经常使用这个 - 多久一次，真的？虽然我认为`??`很方便，但我不能说我使用得非常频繁。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-17T18:57:46.647

通常，C# 语言设计团队对添加新语法持保守态度。他们说，添加语言的价值必须与增加语言复杂性的成本进行权衡。

Peter Hallam 曾担任 C# 编译器开发负责人一段时间，也是 C# 语言设计团队的成员。尽管他更关注交互式 GUI 功能而不是语言功能，但他写了关于测量新功能的方法，称为**Yardstick 。**

本文与以下问题特别相关`??=`：

> 通常正确的设计决策是不改变任何东西。这可能是我从观看 Anders 在 C# 语言设计会议上学到的最重要的一课。通常会提出语言的一个领域，在该领域中似乎可以获得一些真正的收获。我们可以防止用户出现常见的编码错误，或者我们可以针对某个问题域提高语言的可用性。然后经过认真思考，通过所有解决问题的选项，答案是……什么都不做！即使问题是有效的，并且看起来我们应该能够添加一些东西来改善这种情况，但经过仔细考虑，没有办法解决问题，而成本不超过解决方案的收益。我见过 Anders 做出的许多最重要和最有价值的决定都是不增加语言复杂性的决定，除非增加的价值证明了复杂性是合理的。在边缘情况下，他几乎总是什么都不选择，而不是添加一些边缘的东西。

## 参考：

*   [标尺](http://blogs.msdn.com/peterhal/archive/2004/08/11/213120.aspx)
*   [程序员到底在做什么？](http://blogs.msdn.com/peterhal/archive/2006/01/04/509302.aspx)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-17T18:45:24.900

`??`不是“运算符”，因为它对操作数的值进行“操作”。您应该将其视为一种**语言结构**。

假设你有：

```
node = node.next; 
```

那么您是否希望能够执行以下操作？

```
node .= next; 
```

我认为`??=`不存在的原因与`.=`不存在的原因相同。

此外，像`+=`,`*=`等一元运算符在汇编级别有直接对应物。伪组装：

```
add reg0, 1
mul reg1, 5 
```

这些运算符的存在是“自然的”。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-17T18:06:09.017

没有执行此操作的操作员。但是，对于该语言的未来版本，这是一个有趣的建议。我怀疑它到目前为止还没有被包括在内，因为合并运算符的主要用例`??`是 Nullable 类型并获取如下所示的值：

```
int? testValue;

return testValue ?? 0; 
```

而不是像您的示例那样在分配操作中。此外，while`+=`保证在所有情况下都会修改 foo 的值，但`+= 0`不会`??=`。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-17T19:04:00.783

`??=`在讨论to的类比是否`+=`有意义时，每个人都缺少一个更简单的答案。

问题：为什么你不能`foo ??= x;`在 C# 中做？

答：因为[每个功能都以负 100 分](http://blogs.msdn.com/ericgu/archive/2004/01/12/57985.aspx)开始，所以[功能一开始不存在，必须有人来实现它们](http://blog.ryjones.org/2005/07/12/product-development/)，如果他们添加了该功能，很可能[这些资源已经花在对客户群有更大总体利益的事情上](http://blogs.msdn.com/oldnewthing/archive/2008/01/14/7103585.aspx)：

> ...考虑设计该功能应如何工作所需的所有时间和精力，确定所有边界条件，然后对其进行编码，为其编写自动化测试，...编写文档和帮助文本，并继续维护功能预期生命周期的代码、测试和文档（在这种情况下可能是永远的）。所有这些资源是否都花在了对客户群有更大总体利益的事情上？（答案总是“是”——每个人和她的嫂子都能想办法完成这句话，“我不敢相信他们把所有时间都浪费在这个愚蠢的功能上而不是修复......” )

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-17T18:21:48.403

我看不出你为什么要使用 ?? 运算符自分配变量。

也许您是`foo`根据一些恰好是的数据库值进行设置的`NULL`，所以使用 ?? 该分配期间的运算符（消除了对 ??= 的需要）：

```
foo = (int?)rows["possiblyNullCount"] ?? 0; 
```

相对于：

```
foo = (int?)rows["possiblyNullCount"];
foo = foo ?? 0; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-06-13T15:51:36.920

**2017 年更新**：Null-coalescing assignment 是 C# 语言设计团队正在考虑的一个积极提案。[请在https://github.com/dotnet/cshaplang/issues/34](https://github.com/dotnet/csharplang/issues/34)投票或加入讨论

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-17T18:09:04.690

主要是因为 +=、-= 等几乎都是事后才添加的，以保持与 C 和 C++ 的兼容性。(*) 因为 ?? 不是 C 或 C++ 的一部分，因此无需添加额外的运算符。

(*) 请注意，在 C++ 中，为类定义运算符时，通常定义 operator+=()，然后基于它实现 operator+()。（这通常是最有效的方式）。但是，在C#中，实现了operator+，编译器会在oper+的基础上自动添加operator+=。这就是为什么我说 += 运算符是事后才想到的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-17T18:37:59.067

虽然不完全是您所要求的（它不是 ??=）...您也许可以利用扩展方法。

```
static void Main(string[] args)
{
    object foo = null;
    object x = "something";
    Console.WriteLine(foo.NullToValue(x));
}

public static class ObjectExtensions
{
    public static object NullToValue(this object obj, object value)
    {
        return obj != null ? obj : value;
    }
} 
```

我没有花费大量时间思考这不起作用的可能方式，但它似乎确实通过了我的示例应用程序中的气味测试......

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-17T22:24:56.617

我也想念它——Ruby毁了我。这是一个可以在表达式中使用的类似结构（如果您对副作用不过敏）：

```
foo ?? foo = x; 
```

如：

```
return foo ?? foo = x; 
```

或（仅供说明！）：

```
DoStuff( foo ?? foo = x ); 
```

在属性 getter 之外使用这种模式可能不是一个好主意。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-17T18:19:49.860

这种风格的陈述感觉就像是来自属性 getter 的延迟加载。在这种情况下，我会选择这种语法

```
private Foo myFoo;
public Foo MyFoo
{
    get
    {
        return myFoo ?? (myFoo = new Foo());
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-05-25T13:36:49.563

空合并赋值运算符`??=`是在 C# 8.0 中引入的

[https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#null-coalescing-assignment](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#null-coalescing-assignment)

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-02-17T18:05:06.540

因为 C# 中没有这样的 ??= 运算符。

虽然 += 看起来像是用不同语法表示的两个运算符，但它只是一个运算符。

# rss - 开发提要聚合器/代理的最佳实践？

> ID：558011
> 
> 赞同：4
> 
> 时间：2009-02-17T18:01:56.547
> 
> 标签：rss, feed, google-feed-api, atom-feed, aggregators

我正在考虑为提要编写一个代理聚合器，其中少数用户指定提要 URL 和一些条件，系统会输出与这些条件匹配的条目的不断更新的 RSS/Atom 提要。

提要聚合器是否有最佳实践？（或过滤提要代理？）

例如：

*   是否有某些 Feed 元素应该或不应该被修改为代理？
*   提要代理/解析器应该如何表明它*没有*传递原始提要的原始副本？
*   将下载/更新工作委托给第三方聚合平台（例如[Google Feed API](http://www.niallkennedy.com/blog/2007/04/google-feed-api-json.html) ）是否有意义？我认为这将节省大量工作，而不必自己进行更新、301 处理等。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T18:17:07.743

查询任何提要的频率不要超过 30 分钟。使用缓存。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T18:14:43.803

[不要被 Ask.com 收购](http://thenextweb.com/2008/10/21/outsourcing-to-china-and-failed-auction-killed-bloglines/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T22:13:03.043

我猜你也可以使用 Yahoo Pipes……或者这个：planetplanet.org

# c# - DataGrid Width 在 Windows Mobile 中没有影响。C＃

> ID：558026
> 
> 赞同：2
> 
> 时间：2009-02-17T18:05:55.040
> 
> 标签：c#, windows-mobile

我是 Windows Mobile 开发的初学者，发现当我使用 DataGridTextBoxColumn 设置宽度时，它不会影响 DataGrid 列的大小。这是我的代码：

```
 DataGridTableStyle tableStyle = new DataGridTableStyle();
        tableStyle.MappingName = "MainStyle";

        DataGridTextBoxColumn tbcName = new DataGridTextBoxColumn();
        tbcName.Width = 120;
        tbcName.MappingName = "Name";
        tbcName.HeaderText = "Name";
        tableStyle.GridColumnStyles.Add(tbcName);

        DataGridTextBoxColumn tbcValue = new DataGridTextBoxColumn();
        tbcValue.Width = 200;
        tbcValue.MappingName = "Value";
        tbcValue.HeaderText = "Value";
        tableStyle.GridColumnStyles.Add(tbcValue);

        // dgUserAttributes is defined as a System.Windows.Forms.DataGrid
        dgUserAttributes.TableStyles.Clear();
        dgUserAttributes.TableStyles.Add(tableStyle); 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T22:18:38.037

正如[Henk Holterman](https://stackoverflow.com/users/60761/henk-holterman)所说，您必须将 DataGridTableStyle 映射**到**绑定到**DataGrid的****DataTable**的名称。作为替代方案，您可以将每个**DataGridTextBoxColumn的***MappingName*设置为绑定**DataTable中****DataColumn**的列名。

 *******假设您已在表单设计器中将名为*dgUserAttributes的***DataGrid**添加到名为*Form1的***表单**中，您可以使用以下代码测试**DataGridTextBoxColumn** *width属性如何更改显示的***DataGrid**中列的宽度。

 *********还要检查您是否没有在设计时为**dgUserAttributes** *TableStyles*集合设置一个值，该值可能会覆盖您以编程方式设置的值。

```
 public Form1()
    {
        InitializeComponent();

        //Create In-Memory DataTable
        DataTable myTable = new DataTable();

        // Add DataColumns to the DataTable.
        DataColumn myNameColumn = new DataColumn("Name");
        myNameColumn.DataType = System.Type.GetType("System.String");
        myNameColumn.DefaultValue = "default string";
        myTable.Columns.Add(myNameColumn);
        DataColumn myValueColumn = new DataColumn("Value");
        myValueColumn.DataType = System.Type.GetType("System.String");
        myValueColumn.DefaultValue = "default string";
        myTable.Columns.Add(myValueColumn);

        //Bind DataTable to dataGrid1
        dgUserAttributes.DataSource = myTable;

        DataGridTableStyle tableStyle = new DataGridTableStyle();
        //tableStyle.MappingName = "MainStyle";
        DataGridTextBoxColumn tbcName = new DataGridTextBoxColumn();
        tbcName.Width = 12; 
        tbcName.MappingName = "Name";
        tbcName.HeaderText = "Name";
        tableStyle.GridColumnStyles.Add(tbcName);
        DataGridTextBoxColumn tbcValue = new DataGridTextBoxColumn();
        tbcValue.Width = 300;
        tbcValue.MappingName = "Value";
        tbcValue.HeaderText = "Value";
        tableStyle.GridColumnStyles.Add(tbcValue);
        // dgUserAttributes is defined as a System.Windows.Forms.DataGrid
        dgUserAttributes.TableStyles.Clear();        
        dgUserAttributes.TableStyles.Add(tableStyle);           
    } 
```

# c++ - 如何使用win32编写socket通信程序

> ID：558028
> 
> 赞同：2
> 
> 时间：2009-02-17T18:06:03.747
> 
> 标签：c++, windows, sockets, winsock

新手想学习win32中的socket编程。我知道一点 MFC 但这不是开始的好点，因为它只是隐藏了程序员的内部细节。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T18:13:27.363

使用 winsock 函数 (Winsock2.h)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T18:18:28.223

[http://beej.us/guide/bgnet/](http://beej.us/guide/bgnet/)

Beej 的指南是一个非常常见的起点。自从我开始使用这些东西已经有几年了，但是 iirc，该指南使用 Berkeley 套接字并在适当的地方指出了与 winsock 的区别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T18:14:15.317

你说得对，MFC 会掩盖一些细节，我不知道他们为什么决定包装它。

有许多关于 WinSock 编程的好书和教程。这是一个；

[http://www.codeproject.com/KB/IP/winsockintro01.aspx](http://www.codeproject.com/KB/IP/winsockintro01.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T18:14:31.573

答案是使用win32 socket API。

MSDN 中有关于此 API 的信息。

它（所谓的“Winsock”API）类似于（基于）Unix/Posix API，因此和 MSDN 一样，很多关于在 Unix 上使用套接字的文献（书籍）也是相关的。

谷歌搜索会找到你的代码示例，大概。

你会想知道一点关于网络的知识：例如，“IP 地址”和“端口”是什么。

您需要选择一种协议（UDP 或 TCP）。

Win32 的不同之处之一是您可以在连接套接字时使用 ReadFile 和 WriteFile，这意味着您可以使用与 ReadFile 和 WriteFile 关联的重叠 I/O 选项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T21:39:21.890

我全心全意地同意 ChrisW 并赞扬你传递 MFC。

请参阅[MSDN Winsock 参考](http://msdn.microsoft.com/en-us/library/ms741416(VS.85).aspx)以获取大量重要的 WinSock 信息。

此外，虽然它可能太大而无法学习，但我有一个我认为非常好的[Socket 服务器类](http://www.networkdls.com/Software.Asp?Review=23)——如果你觉得它有用，请告诉我。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T21:59:07.897

一个小提示是（假设您使用 Visual Studio 和 Winsocket 库）您需要手动链接 WS2_32.Lib。我发现这个小步骤是很多初学者错过的，因此会出现一些奇怪的错误（在旁观者看来很奇怪）。 [http://social.microsoft.com/Forums/en-US/vcgeneral/thread/cfefa4a5-1f1a-4987-8bc7-f3197cb5826c](http://social.microsoft.com/Forums/en-US/vcgeneral/thread/cfefa4a5-1f1a-4987-8bc7-f3197cb5826c)

还; 恕我直言，您不应该使用 MFC。google-net 上有很多很棒的 winsocket 编程指南 :)

祝你好运

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T17:13:51.570

我建议看

[Winsock 入门 (Windows)](http://msdn.microsoft.com/en-us/library/ms738545(VS.85).aspx)

并且

[解开编写 Winsock 2 分层服务提供程序的奥秘](http://www.microsoft.com/msj/0599/LayeredService/LayeredService.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T18:13:41.433

两种选择：

1.  编写与串行端口对话的基于文件流的代码。
2.  使用 C++ 库进行串行端口通信（谷歌为此）

第一个选项意味着编写“样板”代码，因此最好使用 3rd 方库。

串行端口编程最常见的“开始问题”是与设备建立通信链接。您需要正确设置端口名称、波特率、奇偶校验等（通常由设备制造商提供）。

然后还会有一个设备的“命令集”。例如，如果您发送“？” 到设备，它将返回制造商名称等设备信息（“？”命令是一个示例，它不是标准 - 命令集因设备而异）。

所有串行通信都是这样工作的： - 您向串行端口写入命令 - 轮询读取缓冲区以获取设备的响应

据我所知，C++ 或 MFC 中没有内置的串行端口通信类，但有很多 3rd 方库用于此目的。

# php - PHP UTF-8 问题 - 如果我在 PHP 中创建一个字符串......它是 UTF-8 吗？

> ID：558033
> 
> 赞同：4
> 
> 时间：2009-02-17T18:06:58.533
> 
> 标签：php, unicode, utf-8

在 PHP 中，如果我创建这样的字符串：

```
$str = "bla bla 这是我的字符串";

```

然后我可以使用 mbstring 函数将该字符串作为 UTF8 进行操作吗？

```
// 这行得通吗？
$str = mb_strlen($str);

```

此外，如果我有另一个我*知道*是 UTF-8 的字符串（比如说它是一个 POSTed 表单值，或者来自数据库的一个 UTF-8 字符串），那么我可以将这两个字符串连接起来并且没有任何问题吗？

```
// 这个怎么样，这行得通吗？
$str = $str 。$utf8_string_from_database;

```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T18:26:44.630

**第一个问题：这取决于字符串中的确切内容。**

在 PHP（无论如何，直到 PHP5）中，字符串只是字节序列。没有与它们相关的隐含或显式字符集；这是程序员必须跟踪的东西。因此，如果您只在引号之间放置有效的 UTF-8 字节（如果文件本身被编码为 UTF-8，则相当容易），那么字符串将是 UTF-8，您可以安全地在其上使用 mb_strlen()。

此外，如果您使用 mbstring 函数，则需要明确告诉它您的字符串是什么字符集，可以使用[mbstring.internal_encoding](http://php.net/manual/en/mbstring.configuration.php#ini.mbstring.internal-encoding)或作为任何 mbstring 函数的最后一个参数。

**第二个问题：是的，有警告。**

两个独立有效的 UTF-8 字符串可以安全地按字节连接（如 PHP 的`.`运算符）并且仍然是有效的 UTF-8。但是，如果不自己做一些工作，您永远无法确定 POSTed 字符串是有效的 UTF-8。如果您仔细设置连接字符集，数据库字符串会更容易一些，因为大多数 DBMS 会为您进行任何转换。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T18:29:14.330

如果您的源代码是 UTF-8 格式，那么字符串是 UTF-8 格式，如果不是 - 它不是。由于您的示例字符串仅限英文，因此它是有效的 UTF-8。

PHP 本身并不了解字符集。如果您将内容传递给 mb* 函数，它会将其视为 UTF-8 字符串。

Concatenation must work fine no matter what, if I understand UTF-8 right :-) Just make sure *both* strings are UTF-8, otherwise you will get *strange* string as a result.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:28:59.993

确保在执行任何此操作之前将您的 default_charset 指令设置为 UTF-8。

直接修改 php.ini 或在运行时使用

```
<?php

ini_set( 'default_charset', 'UTF-8' ); 
```

# java - Java 的 IPv4/IPv6 网络计算和验证？

> ID：558038
> 
> 赞同：10
> 
> 时间：2009-02-17T18:08:01.917
> 
> 标签：java, networking, ip-address

我正在寻找一个类似于[Net_IPv4](http://pear.php.net/package/Net_IPv4)和[Net_IPv6](http://pear.php.net/package/Net_IPv6)但为 Java 编写的包。它需要能够执行以下操作：

*   验证地址是否有效（例如 127.0.0.1 有效，127.0.0.257 无效）
*   如果地址包含在子网中，则返回（例如 127.0.0.11 在 127.0.0.0/28 中）
*   返回给定子网的广播地址（例如，对于 127.0.0.0/28，它是 127.0.0.15）

如果它还可以：

*   按顺序返回子网的地址列表
*   对地址列表进行排序

我可能会写一个包来完成这一切，但如果有人已经经历了麻烦并且很可能做得更好，我就会使用它。任何人都知道这样一个或多个可以做到这一切的包吗？我们正在扩展到 IPv6，因此如果可能，它需要同时适用于 IPv4 和 IPv6。

我很感激任何帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-02-23T14:20:39.827

也许[CIDRUtils](https://github.com/edazdarevic/CIDRUtils)可以帮助你。它使您能够将 CIDR 表示法转换为 IP 范围。

免责声明：我是 CIDRUtils 的作者。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T18:30:40.370

它仅适用于 IPv4，但属于[Commons Net的](http://commons.apache.org/net/)[SubnetUtils](http://commons.apache.org/net/apidocs/org/apache/commons/net/util/SubnetUtils.html)类具有您正在寻找的功能。基于此，您可以编写 IPv6 版本并将其贡献回项目！:)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-10-17T06:29:29.593

[IPAddress Java 库](https://seancfoley.github.io/IPAddress/)以包括子网的多态方式同时支持 IPv4 和 IPv6。链接中提供了 javadoc。免责声明：我是项目经理。

您列出的所有用例都透明地支持 IPv4 和 IPv6。换句话说，它与大多数其他实用程序的不同之处在于下面的代码与 IPv4 或 IPv6 作为输入字符串的工作方式相同。

验证地址是否有效

```
 String str = "::1";
    IPAddressString addrString = new IPAddressString(str);
    try {
         IPAddress addr = addrString.toAddress();
         ...
    } catch(IPAddressStringException e) {
        //e.getMessage provides validation issue
    } 
```

如果地址包含在子网中，则返回

```
 String str = "1::1";
    String subnetStr = "1::/64";
    IPAddressString addrString = new IPAddressString(str);
    IPAddressString subnetString = new IPAddressString(subnetStr);
    try {
         IPAddress addr = addrString.toAddress();
         IPAddress subnet = subnetString.toAddress();
         boolean isContained = subnet.contains(addr); //true in this case
         ...
    } catch(IPAddressStringException e) {
        //e.getMessage provides validation issue
    } 
```

返回给定子网的广播地址

```
 String subnet = "127.0.0.0/28";
    IPAddressString subnetString = new IPAddressString(subnet);
    try {
         IPAddress subnet = subnetString.toAddress();
         IPAddress broadcastAddr = subnet.getHighest();
         ...
    } catch(IPAddressStringException e) {
        //e.getMessage provides validation issue
    } 
```

按顺序返回子网的地址列表

```
 String subnet = "127.0.0.0/28";
    IPAddressString subnetString = new IPAddressString(subnet);
    try {
         IPAddress subnet = subnetString.toAddress();
         for(IPAddress addr : subnet) {
             ...
         }
    } catch(IPAddressStringException e) {
        //e.getMessage provides validation issue
    } 
```

对地址列表进行排序

```
 List<IPAddressString> addrs; 
    Collections.sort(addrs); //IPAddressString implements Comparable 
```

获取一组子网和地址列表（响应 AhmedRana）：

```
 IPAddress subnet = new IPAddressString("192.168.0.0/28").getAddress();
    IPAddress newSubnets = subnet.adjustPrefixLength(1, false);
    System.out.println(newSubnets); //192.168.0.0-8/29
    HashSet<IPAddress> subnetSet = new HashSet<IPAddress>();
    ArrayList<IPAddress> addrList = new ArrayList<IPAddress>();
    for(IPAddress addr : newSubnets.getIterable()) {
        subnetSet.add(addr.toPrefixBlock());
        addrList.add(addr);
    }
    System.out.println(subnetSet);//[192.168.0.0/29, 192.168.0.8/29]

    System.out.println(addrList);
                //[192.168.0.0/29, 192.168.0.1/29, 192.168.0.2/29,
                //192.168.0.3/29, 192.168.0.4/29, 192.168.0.5/29,
                //192.168.0.6/29, 192.168.0.7/29, 192.168.0.8/29,
                //192.168.0.9/29, 192.168.0.10/29, 192.168.0.11/29,
                //192.168.0.12/29, 192.168.0.13/29, 192.168.0.14/29,
                //192.168.0.15/29] 
```

可以有很多地址。获取新子网列表更有效的方法是使用前缀块迭代器，它遍历前缀块子网，如下所示：

```
 IPAddress subnet = new IPAddressString("192.168.0.0/28").getAddress();
    IPAddress newSubnets = subnet.adjustPrefixLength(1, false);
    System.out.println(newSubnets); // 192.168.0.0-8/29
    Iterator<? extends IPAddress> iterator = newSubnets.prefixBlockIterator();
    while (iterator.hasNext()) {
        System.out.println(iterator.next());
    }
    // 192.168.0.0/29
    // 192.168.0.8/29 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-04-06T21:14:24.777

我是[commons-ip-math](https://github.com/jgonian/commons-ip-math)的主要贡献者，这是一个开源 Java 库，它提供了丰富的 API 来处理最常见的 IPv4、IPv6 和 AS 编号计算。尽管它只是最近才开源，但它已经在[RIPE NCC](https://www.ripe.net/)内部进行了多年的实战测试。看看如何在下面使用它。

（所有示例都使用类似的 IPv6 和 AS 编号语法。只需使用 Ipv6、Ipv6Range、Asn 和 AsnRange 类代替）。

> *   验证地址是否有效（例如 127.0.0.1 有效，127.0.0.257 无效）

```
Ipv4.parse("127.0.0.1");     // IPv4 representation of "127.0.0.1"
Ipv4.parse("127.0.0.257");   // IllegalArgumentException 
```

> *   如果地址包含在子网中，则返回（例如 127.0.0.11 在 127.0.0.0/28 中）

```
Ipv4Range.parse("127.0.0.0/28").contains(Ipv4.parse("127.0.0.11"));  //true 
```

> *   返回给定子网的广播地址（例如，对于 127.0.0.0/28，它是 127.0.0.15）

```
Ipv4Range.parse("127.0.0.0/28").start().upperBoundForPrefix(28)  // 127.0.0.15 
```

> *   按顺序返回子网的地址列表

```
// Range types are Iterable
for (Ipv4 ipv4 : Ipv4Range.parse("127.0.0.0/30")) {
  System.out.println(ipv4);
}
// Will print:
127.0.0.0
127.0.0.1
127.0.0.2
127.0.0.3 
```

> *   对地址列表进行排序

尽管该库提供了范围类型的比较器（例如比较子网的大小），但没有针对单个地址的比较器。然而，编写自己的代码相当简单，因为 IPv4、IPv6 和 ASN 类型实现了 Comparable 接口：

```
List<Ipv4> list = new ArrayList<Ipv4>();
list.add(Ipv4.of("0.0.0.3"));
list.add(Ipv4.of("0.0.0.4"));
list.add(Ipv4.of("0.0.0.2"));
list.add(Ipv4.of("0.0.0.1"));
Collections.sort(list, new Comparator<Ipv4>() {
    @Override
    public int compare(Ipv4 left, Ipv4 right) {
        return left.compareTo(right);
    }
});
System.out.println(list);
// Will print:
[0.0.0.1, 0.0.0.2, 0.0.0.3, 0.0.0.4] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T07:42:21.770

[InetAddress](https://docs.oracle.com/javase/1.5.0/docs/api/java/net/InetAddress.html)类和相关的子类将是一个很好的起点。

# php - 你认为什么系统是 PHP 杀手？

> ID：558043
> 
> 赞同：2
> 
> 时间：2009-02-17T18:08:41.087
> 
> 标签：php

（系统=编程语言、框架等）

PHP 有一些重要的好处，这些好处被其他编程语言及其框架所忽略。

其中之一是易于部署。将文件放入与 URL 匹配的目录中感觉很脏。但这令人难以置信的简单明了。无论您如何看待语言本身。

在 Apache 上，您有 mod_php 和 FastCGI。在所有其他 Web 服务器上，您可以使用 FastCGI，它的行为就像普通的旧 mod_php。目录中的文件并继续。

如果您更改代码中的某些内容，则不会重新启动。只需重新加载页面。

我使用了很多语言，包括 4 大脚本编写者 Perl、Ruby、PHP、Python。每当我有选择时，我都会使用 Python。

但这个选择很容易。如果我想使用 Python 进行 Web 开发该怎么办？

1.  [阿帕奇](http://httpd.apache.org/)+ [mod_python](http://www.modpython.org/)
2.  [WSGI](http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface)
3.  [电脑动画](http://en.wikipedia.org/wiki/Common_Gateway_Interface)
4.  [快速CGI](http://www.fastcgi.com/)
5.  Python 网络服务器
6.  代理背后的 Python 网络服务器
7.  [SCGI](http://python.ca/scgi/)
8.  放弃吧

与任何其他语言类似。

目前或正在开发中是否有任何可用的东西，这可能是未来的 PHP 杀手？具有易于部署的好处，但语言更好？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T20:25:03.207

您描述的 php 编程风格对于新开发人员来说非常简单易懂。然而，我喜欢该语言的一件事是，它可以超越“将文件放到目录中”的方法，并且仍然保持其易用性。

有几个成熟的 MVC 框架可以促进良好的编码实践、关注点分离、干净的 url 等。一些不同的包提供了 ORM 功能。有测试驱动开发的选项。

这个问题暗示 PHP 作为一种语言本质上是不好的，只是因为它易于部署而流行。

我敢冒昧地说，世界上有很多糟糕的 PHP 代码，但也有大量好的 PHP 代码。随着时间的推移，该语言将继续作为一个坚实的发展平台。

现实可能是 Good PHP*是*PHP Killer。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T18:15:11.617

您的问题意味着需要“PHP 杀手”。PHP有它的用途；事实上，它已在一些非常知名的网站上被广泛使用。Python 也有它的用途。

在构建网站的上下文中，我会（并且已经）使用这两种技术 - PHP 用于主网站，Python 用于特定的脚本任务，这些任务在 PHP 中是不可能的，或者在 Python 中更快。其他人会以不同的方式使用它。

我认为你应该使用最适合的，我不确定你可以直接比较它们（Python 和 PHP）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T20:05:20.867

首先必须有人强迫所有免费的虚拟主机支持这个 PHP 杀手。阅读大多数免费虚拟主机的注册信息，它们支持 PHP、服务器端包括、一些 Perl/cgi、大约 2.2 或 2.3 的 Python 版本以及 Rails？忘了它。没有 Apache 项目将语言移植到所有版本的 apache http 服务器上，PHP 杀手不会很快出现。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T18:52:56.613

**Javascript**。Steve Yegge 在这里解释了一种近乎完美的语言的[属性](http://steve-yegge.blogspot.com/2007/02/next-big-language.html)。他在谈论 javascript 2，他说它是“下一个大语言”（NBL）。

在客户端和服务器上拥有相同语言的一致性不是很好吗？写一次验证逻辑？

编辑：此外，由于 javascript 和 actionscript 相似（都基于 ECMAScript），开发人员可以过渡到编写 flex 应用程序。因此，javascript 可以涵盖传统的客户端和服务器脚本、Flash，甚至是带有 AIR 的桌面应用程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T18:11:14.997

恕我直言，这将是某种 Ruby 框架和[Phusion Passenger(aka mod_rails / mod_rack)](http://www.modrails.com/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T18:15:20.493

很好地考虑了这个问题，但 ColdFusion 提供了您上面列出的许多相同的功能，以及内联标记和代码，以及许多可供使用的库。如果它像 PHP 一样是开源和免费的，我认为它会比作为专有产品更受欢迎。但是，如果您正在寻找一个具有上面提到的好处的平台，但要以一种更直接的方式与其他 Web 服务和丰富的内容（如 Flash）互连，我肯定会看看 CF。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T17:59:10.740

我同意，如果我们有 PHP 的更便宜的替代品 - 它会死的。值得庆幸的是，该语言正在朝着一个好的方向 (OOP) 发展，我们正在分享一些高质量的框架（Cake、Symfony、CodeIgniter、Kohana 等），并且工具变得越来越重要。

我认为 PHP 的简单性很容易实现，这既是该语言的优点，也是该语言的缺点。说真的，有时你无法弄清楚在执行过程中所有东西是如何被包含和动态加载弄平的，以至于很难调试。

我同意 GloryFish 的观点，Good PHP*是*下一个 PHP Killer。我绝对希望看到开发人员更多地在 PHP 和 PHPDocs 中实施 OOP，以便这些工具可以真正开始使用它，我们可以开始专注于更好地处理对象以及在何处以及如何发生的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T18:03:45.800

我认为如果 XAMPP/LAMPP 人推出了一个使用 python 而不是 php 的版本，那可能是一个潜在的“php 杀手”。一键安装让新手很容易上手 php，而且我可以看到这确实有助于 Python 的采用。

# php - Flash 上传器有自己的会话 ID ..... 为什么？

> ID：558046
> 
> 赞同：0
> 
> 时间：2009-02-17T18:09:25.593
> 
> 标签：php, flash

我现在把头撞在桌子上。我有一个 Flash 批量上传器，它通过 upload.php 放置每个文件，该文件对图像进行缩略图，并将它们移动到适当的目录。当我在 IE 中上传时，它运行良好（从没想过我会这么说），但是在 Firefox 中，当 flash 执行 upload.php 时，它有自己的会话变量，这与用于浏览其余部分的会话变量不同站点，因此已登录的用户不再登录，因此他们的用户 ID 不会被读取或插入到数据库中，并且永远是这样的简单代码：

```
$_SESSION["uploaded_ids"][] = $inserted_id; 
```

仅用最后一个 ID 覆盖整个数组，因为它无法读取它来追加它。

我能做些什么？有问题的上传者是这样的：

[多点上传](http://www.element-it.com/MultiPowUpload.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T23:49:42.380

Flash 确实可以正常访问您的 cookie，但 FileReference 在 MSIE 中是一个奇怪的例外，您显然已经注意到不会发送当前会话 cookie。

我通过将会话 ID 传递到 flash（使用 flashvars 或单独的远程服务）然后在发布 FileReference 上传时在查询字符串中传递会话 ID 来解决这个问题。然后，您可以使用强制 id 在 PHP 中启动会话。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T16:01:36.407

Flash 连接充当单独的浏览器，flash 无法直接访问您的 cookie，因此它通常无法发送 phpsessid。（除非它通过 JS 调用绕过它）

但是 MultiPowUpload 说他们在 v2.0 中修复了这个问题，所以只要你使用 v2.0 并且没有配置 sendBrowserCookie=false 它应该可以工作。

我们的团队通过在创建页面时在 $_SESSION 中生成一个令牌来解决这个问题。然后将此令牌添加到上传 url，php 将文件与 xcache 中的此令牌相关联。然后一个完整的 ajax 函数使用正确的 phpsessid 和令牌调用 php 以将它们配对。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-04T00:28:56.757

如果您想鼓励 Adob​​e 修复此错误，请参阅此问题的错误跟踪器链接：

[https://bugs.adobe.com/jira/browse/FP-1044](https://bugs.adobe.com/jira/browse/FP-1044)

不幸的是，您必须创建一个帐户才能查看问题，但无论如何它们都存在。

还有 3 个其他链接，但堆栈溢出阻止我发布它们，因为我的声誉太低。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-06T06:24:44.273

当您向 PHP 发送请求时，flash 应该与它一起传递当前会话 id，不幸的是，flash 没有做同样的事情，因此需要将会话 id 作为 URL 变量传递给 php 页面，以便您的 php 获取该会话。有关更多信息，请检查[此。](https://stackoverflow.com/questions/1006758/setting-php-session-variables-using-flash-actionscript/1013937#comment-8806489)

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-02-17T18:36:46.307

如果 php 文件是通过某种形式的 ajax 执行的，而不是直接从浏览器执行，我相信会话不是持久的。IICRC Firefox 将 ajax 调用视为新的浏览器会话。

如果这听起来可能是这种情况，我通常通过手动将 PHPSESSID 附加到 ajax 调用的末尾来解决这些问题。希望这会有所帮助。

# c# - 如何知道 Linq To SQL 中的字段是否为数字

> ID：558054
> 
> 赞同：9
> 
> 时间：2009-02-17T18:10:50.083
> 
> 标签：c#, sql-server, linq-to-sql

我需要选择列值为数字的表的行，有什么帮助吗？

编辑：我有一个 varchar 列，我需要选择那些是数字的和那些不是的。

编辑 2： Integer.TryParse 不能使用，因为它不能转换为 SQL。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-04T12:17:45.820

在 XML 编辑器中打开您的 DBML (LINQ-to-SQL) 文件，向下到文件末尾并将其粘贴到 '</Database>' 节点之前：

```
<Function Name="ISNUMERIC" IsComposable="true">
    <Parameter Name="Expression" Parameter="Expression" Type="System.String" DbType="NVarChar(4000)" />
    <Return Type="System.Boolean" DbType="BIT NOT NULL"/>
</Function> 
```

现在，您可以使用名为“ISNUMERIC”的*已在 SQL 中的函数。*就是这样：

```
var blah = myDataContext.Accounts.Where(account=>
    myDataContext.ISNUMERIC(account.ID) == true); 
```

你去吧:)

您可能还会发现这些函数对复制有用：

```
<Function Name="RAND" IsComposable="true">
  <Return Type="System.Double" DbType="Float NOT NULL" />
</Function>
<Function Name="NEWID" IsComposable="true">
  <Return Type="System.Guid" DbType="UniqueIdentifier NOT NULL" />
</Function> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T18:29:39.507

我不知道 LinqToSQL 中是否存在 int.TryParse() 的映射，但您可以通过执行查询分两步完成，转换为列表，然后使用 LinqToObjects 从列表中选择。

```
int i;
var query = context.Table.ToList();
var intQuery = query.Where( t => int.TryParse( t.Column, out i ) ); 
```

您可能还想查看[Dynamic LINQ](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)。这将允许您执行以下操作：

```
var query = context.Table.Where( "IsNumeric(Column)" ); 
```

**编辑**动态 LINQ 可在 VS2008 代码示例中找到，链接自 Scott Guthrie 的博客，我已在上面链接。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-12-16T19:07:27.857

SqlFunctions.IsNumeric

[http://msdn.microsoft.com/en-us/library/system.data.objects.sqlclient.sqlfunctions.isnumeric.aspx](http://msdn.microsoft.com/en-us/library/system.data.objects.sqlclient.sqlfunctions.isnumeric.aspx)

例如：

```
 private int GetLastGoodNumber(string PartNum)
    {
        return (from row in Db.SerialNo
                where
                   row.PartNum == PartNum
                let nullable = System.Data.Objects.SqlClient.SqlFunctions.IsNumeric(row.SerialNumber)
                where nullable != null
                select nullable.Value).Max();
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-07T21:32:30.987

```
<>.Where(x=>"0123456789".IndexOf(x.value.substring(0,1))>-1) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T18:15:14.113

查看 Int32.TryParse ...这可能对您有用。

伊恩

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-17T18:27:25.877

如果不加载客户端上的所有记录，您将无法使用 LINQ2SQL 执行此操作。

我可以建议使用附加计算列创建视图或表值函数，然后使用此列过滤结果。或者使用 DataContext.ExecuteQuery 执行常规 SQL。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-17T18:19:39.330

（根据您的需要进行编辑）

因此，鉴于您不能使用`Integer.TryParse`，以下是不可行的：

```
int i;
var rowsWithInts = (From r In dc.YourRows Where Integer.TryParse(r.Column, i));
var rowsWithoutInts = (From r In dc.YourRows Where !Integer.TryParse(r.Column, i)); 
```

是否可以创建存储过程并通过方法窗格将其链接到 DataContext？在这种情况下，您可以在 SQL 中执行以下操作：

```
-- Rows with integers
SELECT * FROM your_table WHERE ISNUMERIC(varchar_column) = 1
-- Rows without integers
SELECT * FROM your_table WHERE ISNUMERIC(varchar_column) = 0 
```

这有帮助吗？

# c# - 我想了解如何在 C# 运行时创建图形对象

> ID：558064
> 
> 赞同：0
> 
> 时间：2009-02-17T18:13:12.107
> 
> 标签：c#, graphics

我想了解如何创建一个程序，我可以绘制简单的形状并能够选择它们进行编辑——比如调整大小、显示顺序、颜色变化。是否有人知道可以帮助我实现目标的在线资源。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T18:14:50.557

“GDI+”就是你要找的。您可以从这里开始：http: [//msdn.microsoft.com/en-us/library/da0f23z7.aspx](http://msdn.microsoft.com/en-us/library/da0f23z7.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:41:03.907

我以前做的一个偷偷摸摸的方法是创建一个自定义控件，从中删除背景并在其上绘制我的形状和大小。然后，您可以轻松实现选择（覆盖 OnClick）、拖动和调整大小（OnMouseDown、OnMouseMove、OnMouseUp）。然后，您可以通过属性（请参阅可浏览属性和属性 get/setter）和 PropertyGrid 控件来实现颜色等选项。

不过，除此之外的任何东西——贝塞尔曲线等——都需要一些更高级的东西。

另一种方法是仅对尺寸控制手柄使用此类控件，并在一个中央画布上进行所有绘图 - 唯一的缺点是弄清楚如何在画布上选择形状。

# firefox - Firefox 工具栏按钮应该有多大？

> ID：558069
> 
> 赞同：2
> 
> 时间：2009-02-17T18:13:52.650
> 
> 标签：firefox, firefox-addon, icons, toolbar

**自定义 Firefox 工具栏按钮图标的大小（以像素为单位）应该是多少？**

我见过各种各样的。最常见的是我遇到了 32x32、24x24 和 16x16，但也遇到了 10x10、15x15、16x14 等。我找不到明确的参考。

另请参阅：[Internet Explorer 图标应该有多大？](https://stackoverflow.com/questions/711105/how-big-should-an-internet-explorer-icon-be)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T19:34:25.700

不知道我是怎么找到它的，但是[Mozilla 开发者中心的](https://developer.mozilla.org/)[创建工具栏按钮](https://developer.mozilla.org/en/Creating_toolbar_buttons#Icon_size)文章将 Firefox 的大图标大小定义为 24x24，小图标大小定义为 16x16。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T18:22:47.027

没有给出明确的尺寸。

图标的大小将取决于用户是否启用了大/小图标。32x32 通常是一个很好的中点。

# wpf - 如何在动态资源中更新动态资源？

> ID：558090
> 
> 赞同：9
> 
> 时间：2009-02-17T18:18:13.403
> 
> 标签：wpf, xaml, resources

我有一个视觉画笔，它是一组形状，其​​主要颜色是动态资源本身 - 因此形状是例如 MyShape 和由 Shape 对象引用的颜色 MyColour。
我的问题是当我为此更新颜色时 - 它仅在第一次加载形状时发生（需要首先设置颜色）但是尽管我更改颜色它不会更新使用颜色的动态资源- 我如何使这项工作？
只需要使一个动态资源在另一个动态资源中工作，并在我更改颜色时让它们都更新。
我不知道如何让它工作 - 我花了时间为 WPF 创建一个颜色选择器，却发现我无法更改这个项目的颜色 - 1-Tier 资源在我直接设置画笔/颜色而不是颜色的地方工作在另一个对象或 2 层资源中。

编辑：我的问题似乎特定于在单独的资源/字典中使用这些，因为我的程序需要从一个类而不是窗口访问这个项目，当 MyColor 位于单独的资源中时，提到的主要示例不起作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T18:58:32.683

除非我误解了情况，否则您所说的确实效果很好。我刚刚用这个 Xaml 试了一下：

```
<Window x:Class="ConditionalTest.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">

    <Window.Resources>
        <SolidColorBrush x:Key="MyColor" Color="Aqua" />

        <VisualBrush x:Key="MyBrush">
            <VisualBrush.Visual>
                <Ellipse Height="50" Width="100" Fill="{DynamicResource MyColor}" />
            </VisualBrush.Visual>
        </VisualBrush>
    </Window.Resources>
    <Grid Background="{DynamicResource MyBrush}">
        <Button Height="30" Width="Auto" VerticalAlignment="Center" HorizontalAlignment="Center" Content="ChangeColor" Click="Button_Click" />
    </Grid>
</Window> 
```

然后更改该按钮的单击处理程序中的颜色：

```
private void Button_Click(object sender, RoutedEventArgs e)
{
    ((SolidColorBrush)Resources["MyColor"]).Color = Colors.Purple;
} 
```

它就像一个冠军。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T00:19:18.533

您能否发布一个示例，说明您如何尝试更改资源字典中的颜色？

When I make a sample app and try to change the resource value it appears that the SolidColorBrush in the resource dictionary has been frozen so it can't be modified. To get around this I just set the new value to a new SolidColorBrush.

# sql-server - 在 SQL Server 2005 中，len() 和 datalength() 有什么区别？

> ID：558102
> 
> 赞同：5
> 
> 时间：2009-02-17T18:21:08.593
> 
> 标签：sql-server, sql-server-2005, datalength

SQL Server 2005 中的 len() 和 datalength() 有什么区别？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T18:25:23.823

DATALEN 将返回用于存储值的字节数：

[http://msdn.microsoft.com/en-us/library/ms173486(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms173486(SQL.90).aspx)

LEN 将返回字符串中的字符数。由于字符串可以使用单字节或双字节字符，这与 DATALENGTH 的不同之处在于，无论单个字符有多长，您总是会得到 1：

[http://msdn.microsoft.com/en-us/library/ms190329.aspx](http://msdn.microsoft.com/en-us/library/ms190329.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T18:23:36.963

DATALENGTH 以字节为单位返回字符串的长度，包括尾随空格。LEN 返回字符长度，不包括尾随空格。例如，

SELECT LEN('string'), LEN('string'), DATALENGTH('string'), DATALENGTH('string'), LEN(N'string'), LEN(N'string'), DATALENGTH(N'string '), DATALENGTH(N'字符串 ')

将返回 6、6、6、9、6、6、12、18

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:23:24.483

Len() 将从数据中修剪（删除尾随空格）。

DataLength() 函数不

示例： Select Len('Test ') -- 这将返回 4

选择 DATALENGTH ('Test ') - 这将返回 5

FURTHERMORE（从其他奇妙而有用的答案汇总）：

DATALENGTH 以 BYTES 为单位返回字符串的长度，包括尾随空格 [http://msdn.microsoft.com/en-us/library/ms173486(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms173486(SQL.90).aspx)

LEN 返回 CHARACTERS 中的长度，不包括尾随空格 [http://msdn.microsoft.com/en-us/library/ms190329.aspx](http://msdn.microsoft.com/en-us/library/ms190329.aspx)

由于字符串可能包含 1 个或 2 个字节 (Unicode)，因此使用任一字节的结果将取决于字符串的数据类型以及字符串中是否有尾随空格

例如，

SELECT LEN('string'), LEN('string'), DATALENGTH('string'), DATALENGTH('string'), LEN(N'string'), LEN(N'string'), DATALENGTH(N'string '), DATALENGTH(N'字符串 ')

将返回 6、6、6、7、6、6、12、14

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T18:24:36.447

关于字符串，datalength() 返回字节数，len() 返回字符数的整数值。

# regex - 所需格式的字符串分离，Pythonic 方式？（带或不带正则表达式）

> ID：558105
> 
> 赞同：6
> 
> 时间：2009-02-17T18:22:07.530
> 
> 标签：regex, string, format, python

我有一个格式为：

```
t='@abc @def Hello this part is text' 
```

我想得到这个：

```
l=["abc", "def"] 
s='Hello this part is text' 
```

我这样做了：

```
a=t[t.find(' ',t.rfind('@')):].strip()
s=t[:t.find(' ',t.rfind('@'))].strip()
b=a.split('@')
l=[i.strip() for i in b][1:] 
```

它在大多数情况下都有效，但是当文本部分有“@”时它会失败。例如，当：

```
t='@abc @def My email is red@hjk.com' 
```

它失败。@names 在开头，@names 后面可以有文本，其中可能包含@。

显然，我可以在最初添加一个空格并找出没有'@'的第一个单词。但这似乎不是一个优雅的解决方案。

解决这个问题的pythonic方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-17T19:32:42.337

以 MrTopf 的努力为基础：

```
import re
rx = re.compile("((?:@\w+ +)+)(.*)")
t='@abc   @def  @xyz Hello this part is text and my email is foo@ba.r'
a,s = rx.match(t).groups()
l = re.split('[@ ]+',a)[1:-1]
print l
print s 
```

印刷：

> ['abc', 'def', 'xyz']
> 你好，这部分是文本，我的电子邮件是 foo@ba.r

* * *

[hasen j](https://stackoverflow.com/users/35364/hasen-j)刚刚要求负责，让我澄清一下这是如何工作的：

```
/@\w+ +/ 
```

匹配单个标签 - @ 后跟至少一个字母数字或 _ 后跟至少一个空格字符。+ 是贪心的，所以如果有多个空格，它会全部抓取。

要匹配任意数量的这些标签，我们需要在标签模式中添加一个加号（一个或多个事物）；所以我们需要用括号对其进行分组：

```
/(@\w+ +)+/ 
```

它匹配一个或多个标签，并且贪婪地匹配所有标签。然而，这些括号现在与我们的捕获组一起摆弄，所以我们通过将它们变成一个匿名组来撤销它：

```
/(?:@\w+ +)+/ 
```

最后，我们把它变成一个捕获组并添加另一个来清扫其余的：

```
/((?:@\w+ +)+)(.*)/ 
```

最后总结一下：

```
((?:@\w+ +)+)(.*)
 (?:@\w+ +)+
 (  @\w+ +)
    @\w+ + 
```

* * *

请注意，在查看此内容时，我对其进行了改进 - \w 不需要在一个集合中，现在它允许标签之间有多个空格。谢谢，哈森-j！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T19:32:42.570

```
t='@abc @def Hello this part is text'

words = t.split(' ')

names = []
while words:
    w = words.pop(0)
    if w.startswith('@'):
        names.append(w[1:])
    else:
        break

text = ' '.join(words)

print names
print text 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T19:03:38.083

这个怎么样：

1.  按空间分割。
2.  foreach 单词，检查

    2.1。如果单词以 @ 开头，则推送到第一个列表

    2.2\. 否则只需用空格连接剩余的单词。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T18:37:22.470

```
 [i.strip('@') for i in t.split(' ', 2)[:2]]     # for a fixed number of @def
 a = [i.strip('@') for i in t.split(' ') if i.startswith('@')]
 s = ' '.join(i for i in t.split(' ') if not i.startwith('@')) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-17T18:40:23.897

您还可以使用正则表达式：

```
import re
rx = re.compile("@([\w]+) @([\w]+) (.*)")
t='@abc @def Hello this part is text and my email is foo@ba.r'
a,b,s = rx.match(t).groups() 
```

但这一切都取决于您的数据的外观。所以你可能需要调整它。它所做的基本上是通过 () 创建组并检查其中允许的内容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-17T19:21:39.850

[**编辑**：这是实施上面奥萨马的建议]

这将基于字符串开头的 @ 变量创建 L，然后一旦找到非 @ var，就抓取字符串的其余部分。

```
t = '@one @two @three some text   afterward with @ symbols@ meow@meow'

words = t.split(' ')         # split into list of words based on spaces
L = []
s = ''
for i in range(len(words)):  # go through each word
    word = words[i]
    if word[0] == '@':       # grab @'s from beginning of string
        L.append(word[1:])
        continue
    s = ' '.join(words[i:])  # put spaces back in
    break                    # you can ignore the rest of the words 
```

您可以将其重构为更少的代码，但我试图让正在发生的事情变得明显。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T23:14:31.793

这只是另一个使用 split() 且没有正则表达式的变体：

```
t='@abc @def My email is red@hjk.com'
tags = []
words = iter(t.split())

# iterate over words until first non-tag word
for w in words:
  if not w.startswith("@"):
    # join this word and all the following
    s = w + " " + (" ".join(words))
    break
  tags.append(w[1:])
else:
  s = "" # handle string with only tags

print tags, s 
```

这是一个较短但可能有点神秘的版本，它使用正则表达式来查找后跟非@字符的第一个空格：

```
import re
t = '@abc @def My email is red@hjk.com @extra bye'
m = re.search(r"\s([^@].*)$", t)
tags = [tag[1:] for tag in t[:m.start()].split()]
s = m.group(1)
print tags, s # ['abc', 'def'] My email is red@hjk.com @extra bye 
```

如果没有标签或没有文本，这将无法正常工作。格式未指定。您需要提供更多测试用例进行验证。

# c# - `Using Namespace;` 会消耗更多内存吗？

> ID：558110
> 
> 赞同：7
> 
> 时间：2009-02-17T18:23:51.877
> 
> 标签：c#, mobile-application

是否`Using Namespace;`消耗更多内存？

我目前正在开发一个移动应用程序，我只是好奇 Visual Studio 在创建类时放置的那些不需要的 using 语句是否使我的应用程序需要一些额外的内存才能运行。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-17T18:24:19.333

简单地说：没有。

这些语句不会被翻译成任何形式的 IL。它们只是避免使用（丑陋！）完全限定类型名称的捷径。但是，如果您使用的是 VS2008 和/或 R#，您可以自动删除未使用的那些。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T18:27:06.317

命名空间是 C# 的仅编译时功能，可让您在开发过程中节省时间。编译器使用这些`using`指令来查找代码中的速记类型名称。

基本上每次编译器在您的代码中遇到一个它不知道的类型名称时，它都会接受每个`using`指令并将其添加到类型名称之前，并查看该完全限定名称是否解析。

一旦你的应用程序被编译，命名空间和`using`指令就消失了，因为 IL 不需要它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T18:28:43.067

如果通过“记忆”你的意思是“我必须记住为什么我首先将那些 using 语句放在首位”，那么是的。

但是，不，不是你的意思。.NET 程序集通常是按需加载的，因此使用这些额外的语句不会导致任何性能损失。但是，为了可维护性，您需要删除它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T18:33:35.737

这是在这种情况下“使用”关键字的微软信息：http: [//msdn.microsoft.com/en-us/library/sf0df423.aspx](http://msdn.microsoft.com/en-us/library/sf0df423.aspx)。它基本上提供了在程序集中使用完全限定名称的替代方法，但它实际上并没有使用该特定关键字将程序集导入或包含在内存中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T18:27:26.377

不，不是的。它只是允许您仅使用类型名称的简写

字符串生成器

与命名空间限定的类型名称相反：

System.Text.StringBuilder

在声明 using 语句的文件中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T18:26:46.533

不，它只会让编译器运行得慢一点:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T18:27:11.387

它不是。使用它是为了不必用全名定义正在使用的对象。如果您使用 System.IO，您可以只使用 File 而不是 System.IO.File。

在您实际创建对象之前，它不会加载到内存中。与 C++ 不同，不导入整个库，因为 .NET 框架安装在目标机器上并加载到 GAC 中，而您的自定义 .dll 位于应用程序文件夹的 bin 文件夹中。

# c - 什么是 C 中的“静态”函数？

> ID：558122
> 
> 赞同：609
> 
> 时间：2009-02-17T18:26:02.043
> 
> 标签：c, c++方法。, c, function, static, terminology

正如评论中所阐明的，问题是关于普通的[c](/questions/tagged/c "显示标记为“c”的问题")函数，而不是[c++方法。](/questions/tagged/c%2b%2b "显示标记为“c++”的问题") `static`

我明白什么是`static`变量，但什么是`static`函数？

为什么如果我声明一个函数，比方说`void print_matrix`，比方说`a.c`(WITHOUT `a.h`) 并包含`"a.c"`- 我得到`"print_matrix@@....) already defined in a.obj"`了，但是如果我声明它，`static void print_matrix`那么它会编译？

**更新**`.c`只是为了澄清问题-正如你们中的许多人指出的那样，我知道包含是不好的。我只是暂时清理空间，`main.c`直到我更好地了解如何将所有这些功能分组到适当的`.h`文件`.c`中。只是一个临时的、快速的解决方案。

* * *

## 回答 #1

> 赞同：796
> 
> 时间：2009-02-17T18:27:31.853

`static`函数是仅对同一文件中的其他函数可见的函数（更准确地说*是相同的[翻译单元](http://en.wikipedia.org/wiki/Translation_unit_%28programming%29)*）。

**编辑**：对于那些认为问题的作者意味着“类方法”的人：由于问题被标记`C`，他的意思是一个普通的旧 C 函数。对于 (C++/Java/...) 类方法，`static`意味着可以在类本身上调用此方法，不需要该类的实例。

* * *

## 回答 #2

> 赞同：219
> 
> 时间：2009-02-17T18:44:01.157

C 中的静态函数和 C++ 中的静态成员函数之间存在很大差异。在 C 语言中，静态函数在其编译单元之外是不可见的，这是编译到的目标文件。换句话说，将函数设为静态会限制其范围。您可以将静态函数视为其 *.c 文件的“私有”函数（尽管这并不完全正确）。

在 C++ 中，“静态”也可以应用于类的成员函数和数据成员。静态数据成员也称为“类变量”，而非静态数据成员是“实例变量”。这是 Smalltalk 术语。这意味着只有一个静态数据成员的副本由类的所有对象共享，而每个对象都有自己的非静态数据成员副本。所以静态数据成员本质上是一个全局变量，即类的成员。

非静态成员函数可以访问类的所有数据成员：静态和非静态。静态成员函数只能对静态数据成员进行操作。

考虑这一点的一种方法是，在 C++ 中，静态数据成员和静态成员函数不属于任何对象，而是属于整个类。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2015-05-19T07:56:24.103

**最小可运行多文件范围示例**

在这里，我说明了如何`static`影响跨多​​个文件的函数定义范围。

交流

```
#include <stdio.h>

/* Undefined behavior: already defined in main.
 * Binutils 2.24 gives an error and refuses to link.
 * https://stackoverflow.com/questions/27667277/why-does-borland-compile-with-multiple-definitions-of-same-object-in-different-c
 */
/*void f() { puts("a f"); }*/

/* OK: only declared, not defined. Will use the one in main. */
void f(void);

/* OK: only visible to this file. */
static void sf() { puts("a sf"); }

void a() {
    f();
    sf();
} 
```

主程序

```
#include <stdio.h>

void a(void);        

void f() { puts("main f"); }

static void sf() { puts("main sf"); }

void m() {
    f();
    sf();
}

int main() {
    m();
    a();
    return 0;
} 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/tree/728f3c11a357967eaa3b5805229a4b09b298d6d7/static/function).

编译并运行：

```
gcc -c a.c -o a.o
gcc -c main.c -o main.o
gcc -o main main.o a.o
./main 
```

输出：

```
main f
main sf
main f
a sf 
```

**解释**

*   有两个独立的函数`sf`，每个文件一个
*   有一个共享功能`f`

像往常一样，范围越小越好，所以`static`如果可以的话，总是声明函数。

在 C 编程中，文件经常被用来表示“类”，`static`函数表示类的“私有”方法。

一个常见的 C 模式是传递一个`this`结构体作为第一个“方法”参数，这基本上是 C++ 在幕后所做的。

**关于它的标准是什么**

[C99 N1256 草案](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1256.pdf)6.7.1“存储类说明符”说这`static`是一个“存储类说明符”。

6.2.2/3“标识符的链接”说`static`暗示`internal linkage`：

> 如果对象或函数的文件范围标识符的声明包含存储类说明符 static，则该标识符具有内部链接。

并且 6.2.2/2 表示其`internal linkage`行为类似于我们的示例：

> 在构成整个程序的一组翻译单元和库中，具有外部链接的特定标识符的每个声明都表示相同的对象或函数。在一个翻译单元中，具有内部链接的标识符的每个声明都表示相同的对象或函数。

其中“翻译单元”是预处理后的源文件。

**GCC 如何为 ELF (Linux) 实现它？**

与`STB_LOCAL`绑定。

如果我们编译：

```
int f() { return 0; }
static int sf() { return 0; } 
```

并使用以下命令反汇编符号表：

```
readelf -s main.o 
```

输出包含：

```
Num:    Value          Size Type    Bind   Vis      Ndx Name
  5: 000000000000000b    11 FUNC    LOCAL  DEFAULT    1 sf
  9: 0000000000000000    11 FUNC    GLOBAL DEFAULT    1 f 
```

所以绑定是它们之间唯一的显着区别。`Value`只是它们在该`.bss`部分中的偏移量，因此我们希望它会有所不同。

`STB_LOCAL`记录在[http://www.sco.com/developers/gabi/2003-12-17/ch4.symtab.html](http://www.sco.com/developers/gabi/2003-12-17/ch4.symtab.html)的 ELF 规范中：

> STB_LOCAL 局部符号在包含其定义的目标文件之外不可见。同名的本地符号可以存在于多个文件中，互不干扰

这使它成为代表的完美选择`static`。

没有 static 的函数是`STB_GLOBAL`，并且规范说：

> 当链接编辑器组合几个可重定位的目标文件时，它不允许同名的 STB_GLOBAL 符号的多个定义。

这与多个非静态定义上的链接错误一致。

如果我们用 来加速优化`-O3`，该`sf`符号将从符号表中完全删除：无论如何它不能从外部使用。TODO 为什么在没有优化的情况下将静态函数保留在符号表上？它们可以用于任何事情吗？

**也可以看看**

*   变量相同：[https ://stackoverflow.com/a/14339047/895245](https://stackoverflow.com/a/14339047/895245)
*   `extern`是相反的`static`，并且函数`extern`默认情况下已经存在：[How do I use extern to share variables between source files?](https://stackoverflow.com/questions/1433204/how-do-i-use-extern-to-share-variables-between-source-files-in-c)

**C++ 匿名命名空间**

在 C++ 中，您可能希望使用匿名命名空间而不是静态，这可以达到类似的效果，但进一步隐藏了类型定义：[未命名/匿名命名空间与静态函数](https://stackoverflow.com/questions/154469/unnamed-anonymous-namespaces-vs-static-functions)

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2013-04-25T22:49:07.437

以下是关于普通 C 函数的 - 在 C++ 类中，修饰符 'static' 有另一个含义。

如果您只有一个文件，则此修饰符绝对没有区别。不同之处在于具有多个文件的较大项目：

在 C 中，每个“模块”（sample.c 和 sample.h 的组合）都是独立编译的，然后每个编译的目标文件（sample.o）都通过链接器链接到一个可执行文件。

假设您有几个文件包含在主文件中，其中两个有一个仅为方便起见在内部使用的函数`add(int a, b)`- 编译器很容易为这两个模块创建目标文件，但链接器会抛出错误，因为它找到了两个同名的函数，但它不知道应该使用哪一个（即使没有要链接的东西，因为它们没有在其他地方使用，而是在它自己的文件中使用）。

这就是为什么您将这个仅在内部使用的函数设为静态函数的原因。在这种情况下，编译器不会为链接器创建典型的“你可以链接这个东西”——标志，这样链接器就看不到这个函数，也不会产生错误。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-02-17T18:28:44.940

静态函数定义会将此符号标记为内部符号。所以它对于从外部链接是不可见的，而只对同一个编译单元中的函数是可见的，通常是同一个文件。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-02-17T18:40:41.087

第一：`.cpp`在另一个文件中包含一个文件通常是一个坏主意——它会导致这样的问题:-) 通常的方法是创建单独的编译单元，并为包含的文件添加一个头文件。

第二：

C++ 在这里有一些令人困惑的术语——直到在评论中指出，我才知道它。

a) `static functions`- 从 C 继承，以及您在此处谈论的内容。任何课外。静态**函数**意味着它在当前编译单元之外不可见 - 因此在您的情况下 a.obj 有一个副本，而您的其他代码有一个独立的副本。（使用多个代码副本使最终可执行文件膨胀）。

b) [`static member function`](http://www.research.att.com/~bs/glossary.html#Gstatic-member-function)- 什么是面向对象术语的静态**方法**。住在一个班级里。您使用类而不是通过对象实例调用它。

这两个不同的静态函数定义是完全不同的。小心——这里是龙。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2020-06-08T12:44:53.593

> "*什么是 C 中的“<code>静态”函数？* "

让我们从头开始。

这一切都基于一个叫做“链接”的东西：

> “*在不同范围或同一范围内多次声明的标识符可以通过称为链接的过程来引用同一对象或函数。29）链接分为三种：外部，内部和无。* “

> 资料来源：C18，6.2.2/1

* * *

> “在构成整个程序的一组翻译单元和库中，具有*外部链接的特定标识符的每个声明都表示相同的对象或函数。在一个翻译单元中，具有**内部链接*的标识符的每个声明都表示相同的对象或函数. 每个没有链接的标识符声明都表示一个唯一的实体。

> 资料来源：C18，6.2.2/2

* * *

如果在没有存储类说明符的情况下定义函数，则`extern`默认情况下该函数具有所有链接：

> “如果函数标识符的声明没有存储类说明符，则它的链接将完全确定，就好像它是使用存储类说明符**extern**声明的一样。”

> 资料来源：C18，6.2.2/5

这意味着 - 如果您的程序包含多个翻译单元/源文件（`.c`或`.cpp`） - 该功能在您的程序具有的*所有翻译单元/源文件中可见。*

在某些情况下，这可能是一个问题。如果您想使用 fe 两个不同的函数（定义），但在两个不同的上下文（实际上是文件上下文）中使用相同的函数名称怎么办。

在 C**和**C++ 中，`static`应用于文件范围内的函数（不是 C++ 中的类的*静态成员函数*或另一个块中的函数）的存储类限定符现在会有所帮助，并表示相应的函数仅在内部可见它是在其中定义的翻译单元/源文件，而不是在其他 TLU/文件中。

> “如果对象或函数的文件范围标识符的声明包含存储类说明符**static**，则该标识符具有内部链接。30)”

* * *

> 30.  只有在文件范围内，函数声明才能包含存储类说明符 static；见 6.7.1。

> 资料来源：C18，6.2.2/3

* * *

因此，A`static`函数只有当当且仅当：

1.  您的程序包含多个翻译单元/源文件（`.c`或`.cpp`）。

**和**

2.  您希望将函数的范围限制在定义特定函数的文件中。

如果*这两个*要求不匹配，则您无需费心将函数限定为`static`.

* * *

旁注：

*   如前所述，`static`函数在 C 和 C++ 之间完全*没有区别*，因为这是 C++ 继承自 C 的一个特性。

无关紧要的是，在 C++ 社区中，与使用*未命名*`static`的命名空间相比，合格函数的贬值存在令人心碎的争论，首先由 C++03 标准中的错误段落初始化，声明使用不推荐使用的静态函数很快由委员会自己修改并在 C++11 中删除。

 *这受到各种 SO 问题的影响：

[未命名/匿名命名空间与静态函数](https://stackoverflow.com/questions/154469/unnamed-anonymous-namespaces-vs-static-functions/49679073#49679073)

[未命名命名空间优于静态命名空间？](https://stackoverflow.com/questions/4422507/superiority-of-unnamed-namespace-over-static)

[为什么未命名的命名空间是静态的“优越”替代品？](https://stackoverflow.com/questions/4977252/why-an-unnamed-namespace-is-a-superior-alternative-to-static)

[弃用 static 关键字...不再？](https://stackoverflow.com/questions/4726570/deprecation-of-the-static-keyword-no-more)

事实上，它还没有按照 C++ 标准被弃用。因此，`static`函数的使用仍然是合法的。即使未命名的*命名空间*有优势，关于在 C++ 中使用或不使用静态函数的讨论仍受制于一个人的想法（基于意见），并且不适合本网站。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-02-17T18:28:32.880

静态函数是可以在类本身上调用的函数，而不是类的实例。

例如，非静态将是：

```
Person* tom = new Person();
tom->setName("Tom"); 
```

此方法适用于类的实例，而不是类本身。但是，您可以拥有一个无需实例即可工作的静态方法。这有时用于工厂模式：

```
Person* tom = Person::createNewPerson(); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-02-17T18:50:57.117

次要问题：静态函数对翻译单元是可见的，对于大多数实际情况，翻译单元是定义函数的文件。您遇到的错误通常被称为违反单一定义规则。

该标准可能会说：

> “每个程序都应包含该程序中使用的每个非内联函数或对象的一个​​定义；不需要诊断。”

这就是 C 语言看待静态函数的方式。然而，这在 C++ 中已被弃用。

此外，在 C++ 中，您可以将成员函数声明为静态的。这些主要是元功能，即它们不描述/修改特定对象的行为/状态，而是作用于整个类本身。此外，这意味着您不需要创建对象来调用静态成员函数。此外，这也意味着，您只能从此类函数中访问静态成员变量。

我将在 Parrot 的示例中添加基于这种静态成员函数的单例模式，以在程序的整个生命周期中获取/使用单个对象。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2016-03-06T13:31:35.497

静态函数的答案取决于语言：

1) 在像 C 这样没有 OOPS 的语言中，这意味着该函数只能在其定义的文件中访问。

2）在像 C++ 这样具有 OOPS 的语言中，这意味着可以直接在类上调用该函数，而无需创建它的实例。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-05-08T08:08:43.097

由于静态函数仅在此文件中可见。实际上，如果您将某个函数声明为“静态”，编译器可以为您做一些**优化。**

这是一个简单的例子。

主程序

```
#include <stdio.h>

static void test() 
{
    ghost(); // This is an unexist function.
}

int main()
{
    int ret = 0;

#ifdef TEST
#else
    test();
#endif
    return (ret);
} 
```

并编译

```
gcc -o main main.c 
```

你会看到它失败了。因为你甚至没有实现 ghost() 函数。

但是，如果我们使用以下命令怎么办。

```
gcc -DTEST -O2 -o main main.c 
```

**成功**了，这个程序就可以正常执行了。

为什么？有3个关键点。

1.  -O2 ：编译器优化级别至少为 2。
2.  -DTEST : 定义 TEST，所以 test() 不会被调用。
3.  将“静态”定义为 test()。

只有这三个条件都满足，才能通过编译。由于这个“静态”声明，编译器可以确认 test() 永远不会在其他文件中被调用。您的编译器可以在编译时删除 test()。由于我们不需要 test()，ghost() 是定义还是实现都没有关系。

# apache - 在大多数情况下使用像 Lighttpd 和 nginx 这样的 Web 服务器只是过早优化吗？

> ID：558134
> 
> 赞同：1
> 
> 时间：2009-02-17T18:28:17.810
> 
> 标签：apache, webserver, nginx, lighttpd

我目前在 VPS 上使用 Lighttpd。在那之前是 nginx，但我回到 Lighttpd 因为我需要 CGI。

Apache 的 HTTPD 是主流。所有文档都包含 Apache 的示例，并且大多数模块仅适用于 Apache。

使用不同于 Apache 的东西的努力真的值得吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T18:32:23.963

我不会认为它是过早的优化。这两个网络服务器是很好的产品，并且在静态内容方面很强大。仅仅因为 Apache 被广泛使用，并不意味着其他产品只是“优化”。根据我的经验，lighttpd 和 nginx 很容易配置，并且您可以将 fcgi 绑定用于大多数编程语言。

您应该考虑您需要的功能并选择提供这些功能的服务器，可能是使用较少资源的服务器，很可能不是 Apache。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-12T15:03:00.253

> 使用不同于 Apache 的东西的努力真的值得吗？

这完全取决于您的需求：如果您的并发用户少于几十个（并且不打算很快看到这个数字增长），那么这只是一个口味问题。

但是，如果您担心成本是因为您的应用程序旨在随负载扩展，那么使用最高效的服务器会将您的成本分摊至多几个数量级。

这就是为什么有选择是伟大的！

一个非常好的测试工具是 weighttp（与 ApacheBench 的语法相同，但速度更快并且......多线程 - 测试在多核 CPU 上扩展的 SMP 服务器的必要条件）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T18:30:56.040

这取决于您的需求。我在 nginx 做我需要的事情时使用它，它通常会这样做。Apache 支持许多我不经常使用的东西。只使用需要的东西很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T18:32:27.550

是的，如果您需要类似 10k 的并发连接，我认为您有机会使用 LigtHTTPd，但不能使用 apache。

如果在开发时值得切换，我不确定。可能使用您最了解的网络服务器来开发和优化它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T19:37:21.327

这实际上取决于您的一组要求。是的，过早的优化是邪恶的，但老实说，我真的不明白这是怎么回事。

您将对此网络服务器有一定的要求 - 可能与它的安装难易程度有关？可移植性？功能集？等等，这决定了你的大部分决定。

我想说，不要担心您选择的 Web 服务器的过早优化 - 相反，客观地看看您想要它是什么以及您想要它做什么，然后从那里做出决定并构建您的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T19:44:56.423

如果您正在运行 Rails，那么使用 Lighttpd 会过早地去优化。:) 所以这一切都取决于你需要什么。您的 IT 人员，如果/一旦您拥有它们，会感谢您尽可能使用 apache。

# coldfusion - 为什么 CFAbort 不起作用？

> ID：558135
> 
> 赞同：1
> 
> 时间：2009-02-17T18:28:22.117
> 
> 标签：coldfusion

我有一个奇怪的问题。我正在调试一个很大的请求，因此在进行某些处理之前，我在特定位置投入了一个 cfabort。它似乎没有工作，因为请求继续在浏览器中运行并显示在 CF 监视器中，我手动将其杀死。抛出错误会立即生效，但使用“showerror”执行 cfabort 不会。有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T18:32:15.727

好吧，我找到了罪魁祸首。我进行了调试并设置将输出发送到 ColdFire。我猜有大量与查询相关的数据，当我调用 cfabort 时仍在创建这些数据，但在抛出错误时被忽略了。我知道我以前遇到过这个，所以我想现在我有一个地方可以再次找到答案:-)

# php - 通过 AJAX 传递希伯来语编码的文本（Windows 1255）

> ID：558146
> 
> 赞同：0
> 
> 时间：2009-02-17T18:30:08.570
> 
> 标签：php, javascript, ajax, encoding

当从客户端进行 AJAX 调用时，服务器会以希伯来文文本进行响应。返回结果的 PHP 页面位于 Windows-1255 中。出于某种原因，结果编码不是 Windows-1255，我看到的只是乱码而不是希伯来语。结果故意包含 HTML 标记。

我尝试过 urlencoding、base64 编码，没有任何效果。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T19:02:53.077

您不能更改它以使服务器返回 UTF-8 而不是 1255？

现在绝对没有理由继续使用 ANSI。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:14:27.727

我需要做的就是把它放在响应 php 文件中

header('Content-Type: text/html; charset=windows-1255');

大家10倍！！！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T19:18:01.233

注意：AJAX 仅适用于 UTF8，因此请务必在发送字符之前对其进行转换，否则您可能会在 Javascript 中得到错位字符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-25T13:05:04.430

你也不应该使用 get data 中的字符串，创建一个新的 srting ...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T18:59:02.057

包含 AJAX 调用/显示的网页是什么编码？

# delphi - Delphi MSBuild 从命令行构建配置

> ID：558147
> 
> 赞同：31
> 
> 时间：2009-02-17T18:30:13.220
> 
> 标签：delphi, msbuild, build-automation, delphi-2009, delphi-2007

Delphi 2009 使用**构建配置**。当您创建一个新项目时，您有两个默认构建配置“调试”和“发布”。

现在我问自己如何使用 MSBuild（自 2007 版以来由 Delphi 支持）自动化构建。

您可以在某些 Delphi 项目目录的“RAD Studio 命令提示符”中启动“msbuild”命令，它将构建**默认**构建配置（Delphi IDE 中最后激活的构建配置）。

现在，我想通过命令行参数指定某个（非默认）构建配置。

Delphi帮助断言参数是[/p:configuration= `<configuration name`>]，这是**错误**的（Delphi 2009，Help Update 1）！

什么是正确的方法？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-17T19:25:51.307

现在，如果您想更改构建配置，您必须添加参数
**/p:config= `<BUILD_CONFIG_NAME`>**

例如：

```
C:\Projects\TestDelphiApp001>msbuild /target:Build /p:config=Release
```

或者

```
C:\Projects\TestDelphiApp001>msbuild /target:Build /p:config=Debug
```

* * *

*从原始“问题”复制；注意社区维基。*

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-10-01T05:26:32.767

我用 Delphi XE 试过这个。直到我发现我需要设置文件引用的环境变量，它才起作用`.dproj`：

```
SET BDS=C:\Program Files (x86)\Embarcadero\RAD Studio\8.0
SET BDSBIN=C:\Program Files (x86)\Embarcadero\RAD Studio\8.0\bin
SET BDSAPPDATABASEDIR=BDS
msbuild myproject.dproj /target:Build /p:config=Release 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-27T11:23:08.870

我遇到了同样的问题并找到了解决方案：

1.  写`/p:config`而不是`/p:configuration`
2.  写`"Release Build"`or `"Debug Build"`（用双引号）而不是`Release`or`Debug`

它为我做到了。

# asp.net - ASP.NET：不熟悉接口

> ID：558152
> 
> 赞同：0
> 
> 时间：2009-02-17T18:31:19.270
> 
> 标签：asp.net, vb.net, interface

我正在用各种对象在 ASP.NET/VB.NET 中构建一个大小合适的应用程序……我以前从未使用过接口，当我向他提到这一点时，一位程序员同事犹豫了。谁能给我快速概述一下它们是如何使用的，它们的用途是什么，以及我为什么要使用它们？也许我不需要在这个项目中使用它们，但如果它们有帮助，我当然很想尝试。

非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T19:20:53.270

一旦你“获得”了接口，OOP 就真正到位了。简单地说，一个接口定义了一组公共方法签名，你创建一个实现这些方法的类。这允许您为任何实现特定接口的类（即具有相同方法的类）泛化函数，即使这些类不一定彼此继承。

```
Module Module1

    Interface ILifeform
        ReadOnly Property Name() As String
        Sub Speak()
        Sub Eat()
    End Interface

    Class Dog
        Implements ILifeform

        Public ReadOnly Property Name() As String Implements ILifeform.Name
            Get
                Return "Doggy!"
            End Get
        End Property

        Public Sub Speak() Implements ILifeform.Speak
            Console.WriteLine("Woof!")
        End Sub

        Public Sub Eat() Implements ILifeform.Eat
            Console.WriteLine("Yum, doggy biscuits!")
        End Sub
    End Class

    Class Ninja
        Implements ILifeform

        Public ReadOnly Property Name() As String Implements ILifeform.Name
            Get
                Return "Ninja!!"
            End Get
        End Property

        Public Sub Speak() Implements ILifeform.Speak
            Console.WriteLine("Ninjas are silent, deadly killers")
        End Sub

        Public Sub Eat() Implements ILifeform.Eat
            Console.WriteLine("Ninjas don't eat, they wail on guitars and kick ass")
        End Sub
    End Class

    Class Monkey
        Implements ILifeform

        Public ReadOnly Property Name() As String Implements ILifeform.Name
            Get
                Return "Monkey!!!"
            End Get
        End Property

        Public Sub Speak() Implements ILifeform.Speak
            Console.WriteLine("Ook ook")
        End Sub

        Public Sub Eat() Implements ILifeform.Eat
            Console.WriteLine("Bananas!")
        End Sub
    End Class

    Sub Main()
        Dim lifeforms As ILifeform() = New ILifeform() {New Dog(), New Ninja(), New Monkey()}
        For Each x As ILifeform In lifeforms
            HandleLifeform(x)
        Next

        Console.ReadKey(True)
    End Sub

    Sub HandleLifeform(ByVal x As ILifeform)
        Console.WriteLine("Handling lifeform '{0}'", x.Name)
        x.Speak()
        x.Eat()
        Console.WriteLine()
    End Sub
End Module 
```

上面的所有类都不是彼此继承的，但是我的 HandleLifeform 方法被概括为对所有这些类进行操作——或者实际上是任何实现 ILifeform 接口的类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T19:23:02.983

由于已经涵盖了基础知识，让我们继续进行实际示例。

假设我将拥有一个存储字符串键和 Person 对象的字典，并且我将把这个字典（实际上是对它的引用）传递给我拥有的一些方法。

现在，我的接收方法看起来像

```
Imports System.Collections.Generic
Public Sub DoSomething(ByVal myDict As Dictionary(Of String, Person))
    ' Do something with myDict here
End Sub 
```

对？

但是如果有人发明了一些新的高性能字典类呢？我必须转身，将每一个对 Dictionary 的引用更改为 FastDictionary！

但是，如果我一开始就对接口进行了编码，就不会遇到这个问题：

```
Imports System.Collections.Generic
Public Sub DoSomething(ByVal myDict As IDictionary(Of String, Person))
    ' Do something with myDict here
End Sub 
```

现在它需要任何字典！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:33:26.597

接口基本上允许您在不指定其实现的情况下定义类型的协定。

这个想法是，如果您知道给定类型实现了某个接口，则可以保证某些方法和属性是该类型的成员。

所以任何实现以下接口的类型：

```
Interface ISpinnable
    Sub Spin()
End Interface 
```

必须实现该`Spin`方法。但是实现这种类型的调用者`ISpinnable`并不关心它是*如何*实现的，它只关心方法是否存在。这是一个实现的类型`ISpinnable`：

```
Class Top Implements ISpinnable
    Sub Spin()
        ' do spinning stuff
    End Sub
End Class 
```

这样做的好处是您可以创建类型的方法参数`ISpinner`并允许这些方法的调用者将任何类型传递给您，只要它实现了接口。您的方法不再与调用者正在使用的具体类型紧密耦合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T18:38:29.923

接口是没有实现的契约。它允许您定义类型的外观，而无需指明该类型的实现是什么。

这使您可以拥有适合您特定需求的接口的各种实现。

一个很好的例子是`IComparer(Of T)`界面。您可以有一个实现将根据哪个较大比较两个项目，然后另一个将根据哪个较小返回一个值。

然后，您可以将其中一个或另一个传递给 Array 类的静态 Sort 方法，以分别按升序或降序对项目进行排序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T19:32:20.667

接口可能有用的一件事是浏览不同类型但共享相同接口的对象数组。不能说对于 VB，但在 C# 中，您可以使用方便的“is”运算符来确定对象的类型是否实现给定的接口，并且通过强制转换访问该接口的方法是安全的。对不起 C#，但我会尝试在 =)) 中添加一些评论

```
//we declare 3 different interfaces each requiring to implement one method
                    interface IProgrammer
                    {
                        void WriteCode();
                    }

                    interface ITester
                    {
                         void FindBugs();
                    }

                    interface IWorker
                    {
                         void StartShift();
                    }

        // each programmer will be able to start his shift and write code
                    class Programmer : IWorker, IProgrammer
                    {

                        public void StartShift()
                        {
                          // ...
                        }

                        public void WriteCode()
                        {
                          // ...
                        }

                    }

        // each tester will be able to start his shift and find bugs

                    class Tester : IWorker, ITester
                    {
                        public void StartShift()
                        {
                            // ...
                        }

                        public void FindBugs()
                        {
                            // ...
                        }
                    }

            //then in code you can rely on objects implementing the interface to 
            // be able to do tasks interface requires to do
                    static void Main()
                    {
                        IWorker[] workers = new IWorker[3];
                        workers[0] = new Programmer();
                        workers[1] = new Tester();
                        workers[2] = new Tester();

       // now we can browse through array of different workers because they all share
       // the IWorker interface
                    foreach(IWorker worker in workers)
                    {
                        // All IWorkers can StartShift so we access its methods without casts
                        worker.StartShift();
                        if(worker is IProgrammer)
                        {
                            // Since that worker also implements IProgrammer
                            // we cast worker as IProgrammer and access IProgrammer method(s)
                            (worker as IProgrammer).WriteCode();
                        }
                        if(worker is ITester)
                        {
                            // Same,
                            // we cast worker as ITester and access ITester method(s)
                            // handy! =)
                             (worker as ITester).FindBugs();
                        }
                    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T19:49:05.913

一个经典的例子是数据层，您可以在其中使用它来支持多种数据库格式。在 ORMappers 进入主流编程之前，这实际上非常有用。

你的接口只是告诉你的对象有什么类型的方法和属性，然后对象本身必须实现这些方法。

```
IMyDatabase myDb;

switch case myDbFormat {
     case "mysql":
        myDb = new MyDbMySql();
        break;
     case "mssql" :
        myDb = new MyDbMsSql();
        break;    
}

myDb.SaveToDatabase(some data) 
```

当然，myDb 类必须实现 ImyDatabase 接口。我假设您可以看到这是多么有用:)。

# actionscript-3 - 您如何决定使用抽象类和接口？

> ID：558164
> 
> 赞同：19
> 
> 时间：2009-02-17T18:33:42.697
> 
> 标签：actionscript-3, oop, interface, abstract-class

**重复**：[接口与基类](https://stackoverflow.com/questions/56867/interface-vs-base-class)

* * *

我一直在深入了解 OOP、设计模式和 actionscript 3 的世界，但我仍然很好奇如何知道何时使用抽象类（不支持抽象类的 AS3 的伪类）和接口。对我来说，两者都只是作为确保在给定类中实现某些方法的模板。区别仅在于抽象类需要继承而接口仅扩展这一事实吗？

谢谢， [布赖恩霍奇 hodgedev.com](http://www.hodgedev.com)

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-17T18:34:35.737

如果您希望其子类具有某些功能，请使用抽象类。例如，如果您有一组函数，希望所有基本抽象类的子类都具有。

如果您只想要关于行为/功能的一般合同，请使用界面。如果您有一个函数或对象要接收一组不同的对象，请使用接口。然后您可以更改传入的对象，而无需更改正在使用它的方法或对象。

与抽象类相比，接口通常是松散的。在不断为接口的所有方法编写相同代码的情况下，您不希望使用接口。使用抽象类并定义每个方法一次。

此外，如果您尝试创建特定的对象继承层次结构，您真的不想尝试仅使用接口来执行此操作。

同样，在某些语言中，你只能有一个基类，如果一个对象已经有一个基类，你将不得不进行一些重构才能使用抽象基类。这可能意味着也可能不意味着您可能想要使用接口。

正如@tvanfosson 所说，使用大量接口并不是一个坏主意，当您真正了解抽象类和接口时，这并不是一个非此即彼的情况。特定情况可以使用抽象类和接口，也可以不使用。我有时喜欢使用接口来限制方法或对象可以访问传入参数对象的内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T18:41:09.213

抽象类提供了实现特定方法的可能性，并要求在继承类中实现其他方法。对于接口，一切都必须在实现类中实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:56:52.250

正如@m4bwav 所指出的，主要区别在于抽象类可以并且经常为至少某些方法提供默认实现。这允许您使用抽象类来保持代码 DRY（不要重复自己），方法是保持从抽象类本身中继承自抽象类的所有类的代码通用。

不过，我认为这是一个错误的困境。您不需要也可以说不应该在接口和抽象类之间进行选择。在大多数情况下，您会想要定义接口，然后让您的抽象类提供一个默认的框架实现（如果需要/需要）。对我来说，问题是我需要一个接口还是一个接口和一个抽象类，而不是一个接口或一个抽象类。使用该接口可以将您的代码与任何特定实现分离，甚至是抽象类实现。如果您应该选择使用替代实现，则使用接口将允许这样做，而如果您只有抽象类，则必须重构以稍后添加接口。

The only situation where I can see that providing an interface in such a situation would not be desired is where you **want** to restrict it so that only your implementation can be used. Using the abstract class and having certain methods be not be virtual would enforce the use of your code in all circumstances where the implementer is deriving from your class.

# sql - 如何从asp页面访问sql server

> ID：558176
> 
> 赞同：2
> 
> 时间：2009-02-17T18:35:44.610
> 
> 标签：sql, sql-server, asp-classic, ado

我们有一个传统的本土时间表系统（ASP，microsoft sql server 2005），我需要将其克隆到另一台计算机以进行备份。（我对这些东西知之甚少，所以请温柔）

我已经完成了大部分工作（IIS、Sql Server、表导入/创建）。但是，访问时间表页面的 ASP 页面在访问 sql 服务器时阻塞。

这是它崩溃的行： conn.open Session("sConnStr")

这是连接字符串；

```
sConnStr = "Server=MYSERVER-D01;DATABASE=MYDATABASE;UID=MyDatabaseUser;PWD=MyDatabaseUser;QuotedID=No;DRIVER={SQL Server};Provider=MSDASQL" 
```

这是错误：

> 错误类型：Microsoft OLE DB Provider for ODBC Drivers (0x80004005) [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified /mydir/mypage.asp, line 17 <== 如上所示

请注意，可以使用 Server Management Studio 将 Windows 指定为身份验证来访问 SQL Server 上的数据库。但是，当我尝试使用 SQL 身份验证时，我收到消息“用户未与受信任的 SQL 连接关联”。

**问题：**

*   如何在 SQL Server 2005 上设置用户/密码？
*   什么是默认驱动程序，我需要获取/设置它吗？
*   当它谈到数据源名称时（参见上述连接字符串中的“MYDATABASE”），它是在谈论您在管理工作室对象资源管理器的“数据库”下看到的条目之一吗？

感谢您的回复！到目前为止，没有运气。通过这样做，我设法通过管理工作室对象资源管理器访问数据库；

1.  [启用 SQL 身份验证](http://social.msdn.microsoft.com/Forums/en-US/sqlsecurity/thread/48ee6a1b-9aad-48a6-90e4-b8f4b93d0107/?ffpr=0)：

    > ....解决方案 要解决此问题，请按照说明设置用户身份验证。SQL Server 2000：
    > 
    > 转到开始 > 程序 > Microsoft SQL Server > 企业管理器 右键单击​​服务器名称，选择属性 > 安全 在身份验证下，选择 SQL Server 和 Windows 服务器必须停止并重新启动才能生效
    > 
    > SQL Server 2005：
    > 
    > 转到开始 > 程序 > Microsoft SQL Server 2005 > SQL Server Management Studio 右键单击​​服务器名称，选择属性 > 服务器身份验证下的安全性，选择 SQL Server 和 Windows 身份验证模式服务器必须停止并重新启动，然后才能执行此操作影响...”

2.  [还有这个](http://www-1.ibm.com/support/docview.wss?uid=swg21119906)；

    > 将所有者更改为用于访问数据库的所有者
    > 
    > Microsoft SQL Server 管理工作室
    > 
    > 右键单击数据库，更改所有者

但我仍然收到完全相同的错误消息！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T18:49:16.513

要创建新用户并将其分配给数据库，您需要执行以下操作，

> 1.  在 SQL Server Management Studio 中，打开对象资源管理器并展开要在其中创建新登录的服务器实例的文件夹。
> 2.  右键单击安全文件夹，指向新建，然后单击登录。
> 3.  在“常规”页面上，在“登录名”框中输入新登录名。
> 4.  选择 SQL Server 身份验证。Windows 身份验证是更安全的选项。
> 5.  输入登录密码。
> 6.  选择应应用于新登录的密码策略选项。通常，强制执行密码策略是更安全的选择。
> 7.  单击确定。

然后，您将希望通过创建新的数据库用户将该登录名分配给数据库，

> 1.  在 SQL Server Management Studio 中，打开对象资源管理器并展开数据库文件夹。
> 2.  展开要在其中创建新数据库用户的数据库。
> 3.  右键单击安全文件夹，指向新建，然后单击用户。
> 4.  在“常规”页面上，在“用户名”框中输入新用户的名称。
> 5.  在登录名框中，输入 SQL Server 登录名以映射到数据库用户。
> 6.  单击确定。

您需要将该用户设为 db_owner。对您的数据库运行以下命令。

```
sp_addrolemember @rolename = 'db_owner', @membername = 'usernamehere' 
```

然后使用下面的连接字符串格式连接数据库。

```
Data Source=ServerAddress;Initial Catalog=DatabaseName;User Id=UserName;Password=UserPassword; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:34:03.300

如果您从登录中获得受信任的连接，即 IIS 正在使用运行 SQL Server 的机器，我将避免使用用户名/密码，并在您的连接字符串中声明该连接是受信任的：

sConnStr = "Server=MYSERVER-D01;DATABASE=MYDATABASE; ~~UID=MyDatabaseUser;PWD=MyDatabaseUser;~~ QuotedID=No;DRIVER={SQL Server};Provider=MSDASQL; **Integrated Security=SSPI** "

这是为了说明更改，但在实践中，您可能需要改变连接字符串多一点，请查看[http://www.connectionstrings.com/sql-server-2005](http://www.connectionstrings.com/sql-server-2005)示例。

> > 当它谈论数据源名称时（参见上述连接字符串中的“MYDATABASE”），它是在谈论您在管理工作室对象资源管理器的“数据库”下看到的条目之一

是的，您输入的“MYDATABASE”应该是您在“Databases”下看到的数据库的确切名称。确保您的“服务器”也正确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T20:28:28.753

我建议您创建一个可以为您完成所有连接工作的 DAL（数据访问层）。只需传递您的命令，dit 就可以打开和关闭您的连接等。在任何应用程序中，您都希望尽可能多地抽象这些不同的层，这意味着当您的 aspx 页面具有由 dal 处理并进行数据库调用的方法时，应该调用一个对象。

这是连接到数据库的格式。您可以将连接字符串放在 web.config 文件中，甚至可以使用 hte connectionstringbuilder 在代码中进行。

您还需要确保您的项目包含 system.data.sqlclient 库，否则这将不起作用。

Web 配置文件中的条目如下所示。

```
<add name="ConString" connectionString="Data Source=localhost;Integrated Security=True;Initial Catalog=&quot;DBtouse&quot;;Persist Security Info=True;" providerName="System.Data.SqlClient"/> 
```

或者

```
<add key="ConString" value="Server=localhost;user=username;password=password;Initial Catalog=MyDBtouse;pooling=false"/> 
```

后面的代码是这样的：

```
Dim MyConnection As Data.SqlClient.SqlConnection
Dim Constring As New SqlClient.SqlConnectionStringBuilder
Constring.ConnectionString = System.Configuration.ConfigurationSettings.AppSettings("ConString")
Constring.ConnectTimeout = 30
MyConnection.ConnectionString = Constring.ConnectionString
MyConnection.Open()

'Execute code here

MyConnection.Close()
MyConnection = Nothing 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T19:02:40.130

```
Microsoft OLE DB Provider for ODBC Drivers error '80004005' 
```

[Microsoft][ODBC Driver Manager]未找到数据源名称且未指定默认驱动程序。

这通常发生在以下情况之一：

```
* you referenced your connection incorrectly (e.g. spelled the DSN name, or one of the DSN-less string components wrong);
* you referenced a DSN that doesn't exist;
* the user connecting to the DSN or DSN-less connection doesn't have access to the information stored in the registry (see KB #306345);
* you used an English or localized driver detail for your connection string when your system is not set up in that language (see KB #174655); or,
* you are missing the connection string entirely (this can happen if you maintain your connection string in a session variable, and your sessions aren't working; see Article #2157). 
```

这是上述文章的链接（注意它非常详细）。 [关联](http://tutorials.aspfaq.com/8000xxxxx-errors/80004005-errors.html)

要回答最后一个问题，MYDATABASE 按名称调用数据库。如果在字符串中使用“MYDATABASE”，则需要在 SQL Server 中使用名为“MYDATABASE”的数据库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T19:16:07.743

如果这是一个 SQL 服务器，这个连接字符串*应该*可以在 ASP 中正常工作。在明显使用之前替换您的值。

```
sConnStr = "provider=SQLOLEDB;Data Source=YourServerName;Initial Catalog=YourDBName;UID=YourUserName;PWD=YourUserPWD;" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T19:56:09.190

我发现处理这些问题的最简单方法是创建一个 udl 文件。在您的桌面上创建一个新的文本文件并将其重命名为 filename.udl。双击 udl 文件。单击提供程序选项卡 > 选择 Microsoft OLE DB Provider for SQL Server > 下一步。使用连接选项卡，您应该能够连接到您的数据库。一旦测试连接成功，单击确定。您现在可以在文本编辑器中打开该文件，然后将启动 Provider... 的行复制并粘贴到您的 asp 文件中。您应该以 sConnStr = "Provider..textfromUDLfile" 结尾

[MSDN - 创建和配置通用数据链接 (.udl) 文件](http://msdn.microsoft.com/en-us/library/e38h511e(VS.71).aspx)

# asp.net - n 层设计、查找表和自定义实体

> ID：558177
> 
> 赞同：4
> 
> 时间：2009-02-17T18:36:24.297
> 
> 标签：asp.net, architecture, n-tier-architecture

在使用自定义实体的 n 层应用程序中，您如何发现自己处理查找表所需的数据？您是否为这些查找表中的每一个创建实体或采用其他策略？

例如。我有一个“评级”查找表，用于填充下拉列表。您会创建一个带有 ratingid 和 rating 属性的 rating 对象并将其传递给您的 UI，还是有更有效的方法来实现它？

欣赏你的想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T19:10:56.303

我建议解决方案取决于查找数据更改的频率、是否需要可编辑以及您是否在数据库中强制执行参照完整性。我认为如果将每种查找类型放入单独的表中，它会使模式更易于理解。

我通常不会为每个查找表创建实体，而是将大多数常见查找加载到应用程序易于重用的结构中 - 例如，对于 asp.net 应用程序，我将创建哈希表或排序可以轻松绑定到大多数 Web 控件的字典。

而且，可怕的是，我有时会创建一个单例来管理对所有这些查找的访问，这些查找可以存储为静态变量或缓存中，具体取决于要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T18:59:55.783

我们将不同的查找类型分离到不同的对象中。这似乎需要更多的工作，但它使我们能够在需要时对每个单独的对象进行更改，例如向对象添加附加信息。

# c# - 我可以依赖哪些版本的 .NET Framework？

> ID：558184
> 
> 赞同：6
> 
> 时间：2009-02-17T18:38:11.267
> 
> 标签：c#, .net

我正在编写一个应用程序来发现 pc 上存在哪些功能。用户将进入网页，下载应用程序并执行它（带有所有适当的警告，这不是间谍软件）。该应用程序将使用标准的 MS api 来确定连接速度、安装的内存、防火墙运行状况等。编写应用程序不是问题，我可以使用 Scripting Host、C#、C++ 等。问题是，如果我选择 C# 是否可以保证某种风格的 Windows 会安装 .net？目标电脑是 XP SP2 或更好的和 Vista。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T18:42:27.323

Vista 确实安装了 .NET 3.0。XP SP2 默认没有安装任何 .NET 框架。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T19:57:25.990

您可能想阅读[Scott Hanselman 的](http://www.hanselman.com/blog/)博客文章[SmallestDotNet：论 .NET 框架的大小](http://www.hanselman.com/blog/SmallestDotNetOnTheSizeOfTheNETFramework.aspx)，特别是以下`What's the "Client Profile?"`部分：

> 对于 XP 上的 .NET 3.5 SP1，客户端配置文件是一个更小的安装选项。这是[小型的 277k 引导程序](http://www.microsoft.com/downloads/details.aspx?FamilyId=8CEA6CD1-15BC-4664-B27D-8CEBA808B28B&displaylang=en)。当它在没有安装 .NET Framework 的 Windows XP SP2 机器上运行时，它将下载一个 28 兆的有效负载并为您提供一个特定于客户端的 .NET 3.5 子集。如果客户端配置文件引导程序在具有任何版本的 .NET 的机器上运行，它将与 3.5 SP1 Web 安装程序相同，并检测它需要下载的内容，然后去获取它。[客户端配置文件部署指南](http://download.microsoft.com/download/5/a/a/5aa86d6c-969b-42d8-bc6b-30e02bfeccf0/NETFXClientProfile_DeploymentGuide.htm)中有更多详细信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:45:18.597

Mehrdad 说得对，SP2 默认没有 .NET 安装。然而，值得注意的是，您可以为缺少运行时的用户提供下载，提供您正在使用的任何捆绑版本。这是通过其中一个安装包的创建向导的选项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T18:47:35.987

Pre-Vista：很有可能*不会*安装 .NET。如果是事件，它可能是 1.0 或 1.1。

Vista 在 RTM 中包含 .NET 3.0，但它是 Server 2008 中的可选组件。

我也会考虑 .NET 的大小和启动时间。总的来说，这听起来像是用尽可能少的依赖项编写的东西。

编辑：更正的 Vista 包括 3.0 而不是 3.5。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T18:50:05.683

如上所述，默认情况下未安装 .NET。但是，如果您使用带有 C# 的 ASP .NET，只需查看网站（计算机名称、域、用户 ID 等）就可以得到很多东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T19:37:35.647

好吧，如果您害怕使用 .Net 但尚未安装客户端，您可以尝试一个产品，该产品包含您所有的 .Net 依赖项并创建一个可在每台计算机上运行的隔离安装程序，这可能会带来所有风险您的用户（没有更新，没有错误修复等）。
这是链接：
[http](http://www.remotesoft.com/linker/index.html)
://www.remotesoft.com/linker/index.html希望这会有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T19:57:44.287

我建议尽可能避免使用 .NET，因为大多数 Windows 版本都没有它，安装程序只会增加使用程序的痛苦。除非它已经是一个大型应用程序......但从它的声音来看，您可以使用几 KB 的 C++ 可执行文件（即几乎即时下载）获得您想要的东西。

# count - 如何在 Web 应用程序中创建可靠且强大的页面查看计数器？

> ID：558188
> 
> 赞同：4
> 
> 时间：2009-02-17T18:38:58.457
> 
> 标签：count, views, visitor-pattern

我想统计一个网页上的访问量，这个页面代表了我模型的一个元素，就像 Stack Overflow 问题页面浏览量一样。

如何以可靠（一次访问，一次综合浏览，无重复）和稳健（考虑性能，而不仅仅是新表属性“visits_count”）来做到这一点

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T18:48:55.217

你不能。

*   多个人可以从同一个 IP 访问您的站点（使 ip 存储无用）
*   多人可以从同一台 PC 访问您的网站
*   多个人可以从同一个浏览器访问您的网站（使 cookie 无用）

您可以获得的最接近的方法是将访问者 IP 与 cookie 结合起来存储，以便将来不计算在内。这是一个权衡，如果他们清除 cookie，他们就是新访客。如果您只存储 IP，则将整个代理计为一个访问者。

另一种选择是使用用户帐户并准确跟踪哪个用户查看了哪个页面，但这对于公共站点来说并不是一个很好的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:32:14.397

实际上，我建议使用 Google Analytics。虽然没有什么是真正准确的，但他们确实在这方面做得非常好，而且您可以提取的报告和有用信息的水平令人惊叹。

更不用说每月最多可免费获得 4,000,000 次页面浏览量。

[http://www.google.com/analytics](http://www.google.com/analytics)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T18:52:13.697

处理性能问题的一种方法是在插入时进行计算。就像是

```
UPDATE stat SET viewcount = viewcount+1 WHERE date = CURDATE() 
```

这不是完美的解决方案，但可以为您提供一些帮助。

不重复地做到这一点可能是一个棘手的问题。我会简单地依赖使用会话或 cookie，但您可以想出各种策略来过滤爬虫、不支持 cookie 的客户端等等。

# vbscript - QTP：当对象有效时，对象需要错误

> ID：558198
> 
> 赞同：4
> 
> 时间：2009-02-17T18:43:08.447
> 
> 标签：vbscript, automated-tests, qtp

我在可重用的操作中有以下 VBScript：

```
'Gather links
Browser("1").Navigate "http://InternalWebmail/something/inbox.nsf"
set oDesc = Description.Create()
oDesc("micclass").Value = "Link"
set links = Browser("1").Page("Webmail").ChildObjects(oDesc)
Dim links2
links2 = ""

'Filter out irrelevant links
For i = 0 To links.Count-1
    If lcase(trim(links(i).GetROProperty("text"))) = lcase(trim(DataTable("ExpectedFrom", dtGlobalSheet))) Then
    links2 = links2 + "," + links(i).GetROProperty("url")
    End If
Next

Dim final
final = split(mid(links2,2),",")  'Remove leading comma and split into array

'For each link (i.e. for each E-mail received):
'Effectively giving a reusable action an input parameter, I hope

For i = 0 To final.Count - 1  'error: Object Required
    DataTable("url","CheckHeader") = final(i)
    RunAction "CheckHeader", oneIteration
Next 
```

一切都运行得很好，直到我到达片段底部的循环声明。在那里，QTP 给了我一个错误“需要对象”并且拒绝详细说明。

*   i 的前导值为 58，尽管我在进入循环之前尝试将其设置为 0。
*   final 是一个由 6 个字符串组成的数组，每个字符串都是一个 URL。都有价值。
*   如果我使用 msgbox(final(2))，我认为 final(2) 的值是有效的。
*   isobject（最终（1））=假
*   final(1) 具有正确的值
*   msgbox(final is nothing) 和 msgbox(final(1) is nothing) 产生相同的错误。

看起来好像数组为空，但不知何故数组有成员？这怎么可能？QTP 在说什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T19:11:36.067

在 vbscript 数组中没有`Count`属性，你应该使用[`UBound`](http://www.w3schools.com/VBScript/func_ubound.asp)

```
x = split("how now brown cow")
' MsgBox x.Count ' error
MsgBox UBound(x) ' 3 
```

`.Count`第一个循环起作用的原因是它`ChildObjects`不返回一个数组，它返回一个 COM 集合对象。这也是为什么您必须`Set`在分配 to 时使用语句，`links`而不是在分配 to时使用该语句的原因`final`。

# php - 单个结果的切换方法

> ID：558208
> 
> 赞同：1
> 
> 时间：2009-02-17T18:46:36.970
> 
> 标签：php, code-formatting

我有一种情况，我需要通过不同的方法查询 PHP 中的不同对象以查找一些数据。

这个问题更多地涉及格式化代码而不是实际的编程问题。我想做的是不使用几个`if`'s 来收集这些数据，例如：

```
$data = obj->getData();
if (!isset($data)) $data = othObj->getThisData();
if (!isset($data)) $data = anothObj->getTheData();
if (!isset($data)) $data = anothOne->getAData();
...
process($data) 
```

我想知道这种情况下的最佳做法是什么，如果有更好的方法使用其他程序，比如`foreach`or `switch/case`。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T19:15:38.727

您可以创建一个您想尝试的可能对象的数组，然后运行一个循环。可能更易于维护。可以修改此代码以包含参数并改用 call_user_func_array。

```
$dataCallback = array(
    array($othObj, 'getData'),
    array($othObj, 'getThisData'),
    array($anothObj, 'getTheData'),
    array($anothOne, 'getAData'),
);

for($i = 0, $t = count($dataCallback); !isset($data) && $i < $t; $i++) {
  $callback = $dataCallback[$i];
  $data = call_user_func($callback);
}

if (isset($data))
  process($data);
else
  //no valid data returned at all ... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T18:56:22.983

1.  它看起来并不太糟糕。
2.  如果 if 是嵌套的，它可能会更有效率。例如

    ```
     if (!isset($data = othObj->getData()))
     if (!isset($data = othObj->getThisData()))
     if (!isset($data = anothObj->getTheData()))
     $data = anothOne->getAData()))
     // ...
     process($data) 
    ```

    由于对 isset 的调用较少（尽管它们仍然很便宜，所以我不会担心）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T19:01:11.897

我个人会做这样的事情：

```
$data = null;

if (isset($obj->getData()) $data = $obj->getData();
else if (isset($othObj->getThisData()) $data = $othObj->getThisData();
else if (isset($anothObj->getTheData()) $data = $anothObj->getTheData();
else if (isset($anothOne->getAData()) $data = $anothOne->getAData();

process($data) 
```

如果较早的对象实际返回某些内容，这将节省处理时间。由于它是一个 elseif 设置，一旦它找到数据，它将停止处理其他 if 子句。

在这种情况下，我认为 switch 语句不合适。开关倾向于测试一个变量的值（$a = 1、2、3 或 4）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T20:02:54.993

```
($data = $ob1->get()) || ($data = $ob2->get()) || ($data = $ob3->get()); 
```

会工作，但如果你的 get 函数返回一个空数组或 false 或空字符串而不是 NULL，它会继续寻找数据......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T03:58:11.350

我可能会将要请求数据的对象分组到一个数组中：

```
$objArray = array($obj, $othObj, $anothObj, ... ); 
```

然后运行一个while循环，直到我有数据：

```
$i = 0;
do {
   $data = $objArray[$i]->getData();
   $i++;
} while(!isset($data) && $i < count($objArray)); 
```

# python - 用于确定两个数字在舍入到 n 个有效十进制数字时是否几乎相等的函数

> ID：558216
> 
> 赞同：55
> 
> 时间：2009-02-17T18:49:20.757
> 
> 标签：python, math, floating-point, numpy

我被要求测试第 3 方提供的库。已知该库精确到*n 个*有效数字。任何不太重要的错误都可以安全地忽略。我想写一个函数来帮助我比较结果：

```
def nearlyequal( a, b, sigfig=5 ): 
```

此函数的目的是确定两个浮点数（a 和 b）是否近似相等。如果 a==b（完全匹配）或者如果 a 和 b 在以十进制形式写入时舍入到**sigfig**有效数字时具有相同的值，则该函数将返回 True。

任何人都可以提出一个好的实施方案吗？我写了一个迷你单元测试。除非您可以在我的测试中看到错误，否则一个好的实现应该通过以下内容：

```
assert nearlyequal(1, 1, 5) 
assert nearlyequal(1.0, 1.0, 5) 
assert nearlyequal(1.0, 1.0, 5) 
assert nearlyequal(-1e-9, 1e-9, 5) 
assert nearlyequal(1e9, 1e9 + 1 , 5) 
assert not nearlyequal( 1e4, 1e4 + 1, 5) 
assert nearlyequal( 0.0, 1e-15, 5 ) 
assert not nearlyequal( 0.0, 1e-4, 6 ) 
```

补充笔记：

1.  值 a 和 b 可能是 int、float 或 numpy.float64 类型。值 a 和 b 将始终属于同一类型。转换不会在函数中引入额外的错误，这一点至关重要。
2.  让我们保留这个数字，因此转换为字符串或使用非数学技巧的函数并不理想。该程序将由数学家审核，他希望能够证明该函数完成了它应该做的事情。
3.  速度...我必须比较很多数字，所以越快越好。
4.  我有 numpy、scipy 和标准库。其他任何东西对我来说都很难得到，尤其是对于项目的一小部分。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2016-04-04T16:24:31.437

从 Python 3.5 开始，执行此操作的标准方法（使用标准库）是使用[`math.isclose`](https://docs.python.org/3/library/math.html#math.isclose)函数。

它具有以下签名：

```
isclose(a, b, rel_tol=1e-9, abs_tol=0.0) 
```

绝对容错的使用示例：

```
from math import isclose
a = 1.0
b = 1.00000001
assert isclose(a, b, abs_tol=1e-8) 
```

如果您希望它具有***n 个***有效数字的精度，只需将最后一行替换为：

```
assert isclose(a, b, abs_tol=10**-n) 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-17T19:16:25.010

(source [here)](https://github.com/numpy/numpy/blob/1225aef37298ec82048d0828f6cb7e0be8ed58cc/numpy/testing/utils.py#L513)`assert_approx_equal`中有一个函数可能是一个很好的起点。`numpy.testing`

```
def assert_approx_equal(actual,desired,significant=7,err_msg='',verbose=True):
    """
    Raise an assertion if two items are not equal up to significant digits.

    .. note:: It is recommended to use one of `assert_allclose`,
              `assert_array_almost_equal_nulp` or `assert_array_max_ulp`
              instead of this function for more consistent floating point
              comparisons.

    Given two numbers, check that they are approximately equal.
    Approximately equal is defined as the number of significant digits
    that agree. 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-17T19:07:04.783

这是一个例子。

```
def nearly_equal(a,b,sig_fig=5):
    return ( a==b or 
             int(a*10**sig_fig) == int(b*10**sig_fig)
           ) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-17T19:24:29.047

我相信您的问题定义得不够好，您提供的单元测试证明了这一点：

如果“四舍五入到 N sig-fig 小数位”是指“小数点右侧的 N 个小数位”，那么测试`assert nearlyequal(1e9, 1e9 + 1 , 5)`应该会失败，因为即使将 1000000000 和 1000000001 舍入到 0.00001 精度，它们仍然不同。

如果“四舍五入到 N sig-fig 小数位”是指“N 个最高有效数字，无论小数点如何”，那么测试`assert nearlyequal(-1e-9, 1e-9, 5)`应该失败，因为从这种方式来看，0.000000001 和 -0.000000001 完全不同。

如果您的意思是第一个定义，那么此页面上的第一个答案（由 Triptych 提供）很好。如果你的意思是第二个定义，请说出来，我保证会考虑一下 :-)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T05:50:20.877

已经有很多很好的答案，但这里有一个想法：

```
def closeness(a, b):
  """Returns measure of equality (for two floats), in unit
     of decimal significant figures."""
  if a == b:
    return float("infinity")
  difference = abs(a - b)
  avg = (a + b)/2
  return math.log10( avg / difference )

if closeness(1000, 1000.1) > 3:
  print "Joy!" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-17T19:10:06.993

十进制中的“有效数字”是调整小数点并截断为整数的问题。

```
>>> int(3.1415926 * 10**3)
3141
>>> int(1234567 * 10**-3)
1234
>>> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T04:30:15.123

这是浮点数的一个相当普遍的问题。我根据 Demmel[1] 第 1.5 节中的讨论解决了这个问题。(1) 计算舍入误差。(2) 检查舍入误差是否小于某个 epsilon。我已经有一段时间没有使用 python 了，只有 2.4.3 版本，但我会尽量做到这一点。

步骤 1\. 舍入误差

```
def roundoff_error(exact, approximate):
    return abs(approximate/exact - 1.0) 
```

步骤 2\. 浮点相等

```
def float_equal(float1, float2, epsilon=2.0e-9):
    return (roundoff_error(float1, float2) < epsilon) 
```

这段代码有几个明显的缺陷。

1.  如果精确值为零，则除以零错误。
2.  不验证参数是否为浮点值。

修订 1。

```
def roundoff_error(exact, approximate):
    if (exact == 0.0 or approximate == 0.0):
        return abs(exact + approximate)
    else:
        return abs(approximate/exact - 1.0)

def float_equal(float1, float2, epsilon=2.0e-9):
    if not isinstance(float1,float):
        raise TypeError,"First argument is not a float."
    elif not isinstance(float2,float):
        raise TypeError,"Second argument is not a float."
    else:
        return (roundoff_error(float1, float2) < epsilon) 
```

这样好一点。如果精确值或近似值中的任何一个为零，则误差等于另一个值。如果提供了除浮点值之外的其他内容，则会引发 TypeError。

此时，唯一困难的是为 epsilon 设置正确的值。我在 2.6.1 版的文档中注意到 sys.float_info 中有一个 epsilon 属性，因此我将使用该值的两倍作为默认 epsilon。但正确的值取决于您的应用程序和算法。

[1] James W. Demmel，*应用数值线性代数*，SIAM，1997 年。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T04:55:15.780

如前所述，Oren Shemesh 解决了部分问题，但还有更多问题：

断言几乎相等（0.0, 1e-15, 5）

也没有通过第二个定义（这是我在学校学到的定义。）

无论您查看多少位数，0 都不等于非零。如果您有一个正确答案为零的案例，这对于此类测试可能会令人头疼。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-20T14:36:50.867

[B. Dawson（使用 C++ 代码）在“比较浮点数”](http://www.cygnus-software.com/papers/comparingfloats/comparingfloats.htm)中有一个有趣的解决方案。他的方法依赖于两个数字的严格 IEEE 表示以及当所述数字表示为无符号整数时的强制字典顺序。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-08-22T09:27:22.230

> 我被要求测试第 3 方提供的库

如果您使用的是默认 Python[`unittest`框架](https://docs.python.org/3/library/unittest.html#module-unittest)，则可以使用[`assertAlmostEqual`](https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertAlmostEqual)

```
self.assertAlmostEqual(a, b, places=5) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-12-14T17:11:49.207

有很多方法可以比较两个数字，看看它们是否同意 N 个有效数字。粗略地说，您只想确保它们的差异小于被比较的两个数字中最大数字的 10^-N 倍。这很容易。

但是，如果其中一个数字为零怎么办？与零比较时，相对差异或有效数字的整个概念会下降。要处理这种情况，您还需要有一个绝对差异，它应该与相对差异不同地指定。

我在这篇博文中讨论了比较浮点数的问题——包括处理零的特定情况：

[http://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/](http://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/)

# python - 用于 Python 的贝叶斯垃圾邮件过滤库

> ID：558219
> 
> 赞同：19
> 
> 时间：2009-02-17T18:50:18.117
> 
> 标签：python, spam-prevention, bayesian, bayesian-networks

我正在寻找一个执行贝叶斯垃圾邮件过滤的 Python 库。我查看了 SpamBayes 和 OpenBayes，但两者似乎都没有维护（我可能错了）。

谁能推荐一个实现贝叶斯垃圾邮件过滤的优秀 Python（或 Clojure、Common Lisp，甚至 Ruby）库？

提前致谢。

**澄清**：我实际上是在寻找*贝叶斯垃圾邮件分类*器，而不一定是垃圾邮件过滤器。我只想使用一些数据来训练它，然后告诉我某些给定的数据是否是垃圾邮件。很抱歉有任何混淆。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-17T19:35:52.873

您想要垃圾邮件过滤还是贝叶斯分类？

对于贝叶斯分类，有许多 Python 模块。我最近刚刚审查了看起来非常令人印象深刻的[Orange 。](http://www.ailab.si/orange/)R 有许多贝叶斯模块。您可以使用[Rpy](http://rpy.sourceforge.net/)连接到 R。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-18T15:50:37.477

试试[牧师](http://bazaar.launchpad.net/~divmod-dev/divmod.org/trunk/files/head:/Reverend/)。这是一个垃圾邮件过滤模块。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-08-11T20:11:51.980

RedisBayes 对我来说看起来不错：

[http://pypi.python.org/pypi/redisbayes/0.1.3](http://pypi.python.org/pypi/redisbayes/0.1.3)

以我的经验，Redis 是你堆栈的一个很棒的补充，与 MySQL、PostgreSQL 或任何其他 RDBMS 相比，它可以帮助以极快的速度处理数据。

```
import redis, redisbayes
rb = redisbayes.RedisBayes(redis=redis.Redis())

rb.train('good', 'sunshine drugs love sex lobster sloth')
rb.train('bad', 'fear death horror government zombie god')

assert rb.classify('sloths are so cute i love them') == 'good'
assert rb.classify('i fear god and love the government') == 'bad'

print rb.score('i fear god and love the government')

rb.untrain('good', 'sunshine drugs love sex lobster sloth')
rb.untrain('bad', 'fear death horror government zombie god') 
```

希望有点帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T19:10:11.767

尝试使用[bogofilter](http://bogofilter.sourceforge.net/)，我不确定如何从 Python 中使用它。Bogofilter 与许多邮件系统集成，这意味着接口相对容易。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-30T09:31:01.917

[SpamBayes](http://spambayes.org) **得到**维护，并且已经成熟（即它无需一直发布新版本即可工作）。它会很容易地做你想做的事。请注意，SpamBayes 只是松散的贝叶斯（它使用卡方组合），但可能您正在使用任何类型的基于统计标记的分类，而不是特定的贝叶斯分类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-10T20:44:01.667

Python 自然语言工具包 (nltk) 中的一个模块执行朴素贝叶斯分类：[`nltk.classify.naivebayes`](http://nltk.googlecode.com/svn/trunk/doc/api/nltk.classify.naivebayes-module.html).

*免责声明：*我对贝叶斯分类一无所知，无论是幼稚的还是世俗的。

# c++ - va_copy -- 移植到 Visual C++？

> ID：558223
> 
> 赞同：18
> 
> 时间：2009-02-17T18:50:58.973
> 
> 标签：c++, c, visual-studio-2008, visual-c++

[上一个问题](https://stackoverflow.com/questions/69738/c-how-to-get-fprintf-results-as-a-stdstring-w-o-sprintf#69911)显示了一种打印到字符串的好方法。答案涉及 va_copy：

```
std::string format (const char *fmt, ...);
{
   va_list ap;
   va_start (ap, fmt);
   std::string buf = vformat (fmt, ap);
   va_end (ap);
   return buf;
}

std::string vformat (const char *fmt, va_list ap)
{
   // Allocate a buffer on the stack that's big enough for us almost
   // all the time.
   s ize_t size = 1024;
   char buf[size];

   // Try to vsnprintf into our buffer.
   va_list apcopy;
   va_copy (apcopy, ap);
   int needed = vsnprintf (&buf[0], size, fmt, ap);

   if (needed <= size) {
       // It fit fine the first time, we're done.
       return std::string (&buf[0]);
   } else {
       // vsnprintf reported that it wanted to write more characters
       // than we allotted.  So do a malloc of the right size and try again.
       // This doesn't happen very often if we chose our initial size
       // well.
       std::vector <char> buf;
       size = needed;
       buf.resize (size);
       needed = vsnprintf (&buf[0], size, fmt, apcopy);
       return std::string (&buf[0]);
   } 
```

}

我遇到的问题是上面的代码没有移植到 Visual C++，因为它没有提供 va_copy（甚至 __va_copy）。那么，有谁知道如何安全地移植上述代码？据推测，我需要做一个 va_copy 复制，因为 vsnprintf 破坏性地修改了传递的 va_list。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T19:00:28.013

您应该能够摆脱常规任务：

```
va_list apcopy = ap; 
```

它在技术上是不可移植和未定义的行为，但它适用于大多数编译器和架构。在 x86 调用约定中，`va_list`s 只是指向堆栈的指针，可以安全地复制。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-11-29T18:17:25.437

对于 Windows，您可以简单地自己定义 va_copy：

```
#define va_copy(dest, src) (dest = src) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T19:19:49.527

您可以做的一件事是，如果您不需要该`vformat()`函数，请将其实现移到该`format()`函数中（未经测试）：

```
#include <stdarg.h>
#include <string.h>
#include <assert.h>
#include <string>
#include <vector>

std::string format(const char *fmt, ...)
{
   va_list ap;

   enum {size = 1024};

   // if you want a buffer on the stack for the 99% of the time case 
   //   for efficiency or whatever), I suggest something like
   //   STLSoft's auto_buffer<> template.
   //
   //   http://www.synesis.com.au/software/stlsoft/doc-1.9/classstlsoft_1_1auto__buffer.html
   //
   std::vector<char> buf( size);

   //
   // where you get a proper vsnprintf() for MSVC is another problem
   // maybe look at http://www.jhweiss.de/software/snprintf.html
   //

   // note that vsnprintf() might use the passed ap with the 
   //   va_arg() macro.  This would invalidate ap here, so we 
   //   we va_end() it here, and have to redo the va_start()
   //   if we want to use it again. From the C standard:
   //
   //       The object ap may be passed as an argument to
   //       another function; if that function invokes the 
   //       va_arg macro with parameter ap, the value of ap 
   //       in the calling function is indeterminate and 
   //       shall be passed to the va_end macro prior to 
   //       any further reference to ap.   
   //
   //    Thanks to Rob Kennedy for pointing that out.
   //
   va_start (ap, fmt);
   int needed = vsnprintf (&buf[0], buf.size(), fmt, ap);
   va_end( ap);

   if (needed >= size) {
       // vsnprintf reported that it wanted to write more characters
       // than we allotted.  So do a malloc of the right size and try again.
       // This doesn't happen very often if we chose our initial size
       // well.
       buf.resize( needed + 1);

       va_start (ap, fmt);
       needed = vsnprintf (&buf[0], buf.size(), fmt, ap);
       va_end( ap);

       assert( needed < buf.size());
   }

   return std::string( &buf[0]);
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-09-13T20:02:20.553

`va_copy()`[从Visual Studio 2013](http://msdn.microsoft.com/en-us/library/kb57fad8.aspx)开始直接支持。因此，如果您可以依靠它可用，则无需做任何事情。

# c++ - 在 C 程序中使用单个 C++ 类的最佳方法

> ID：558227
> 
> 赞同：4
> 
> 时间：2009-02-17T18:52:23.040
> 
> 标签：c++, c

我必须从一个 C++ 类中导入/翻译代码，以便可以在 C 程序中使用它。

C 程序很大，并且对打开和关闭的 C 库有很多依赖关系。

C++ 类 .cpp 文件为 650 行

我没有混合 C 和 C++ 的经验，所以即使我看过一个关于如何做到这一点的指南，我也不相信该走哪条路。

我只需要在几个地方使用 C++ 代码（相当孤立的使用

我正在使用 gcc (gcc/g++)

这是一个linux环境

那么我需要做什么才能导入它呢？会比翻译时间更短吗？

谢谢，

麦克风

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-17T19:01:12.380

嗯，650 行并不算长——我会重写它。您可能会花费至少同样多的时间来尝试包装它，并且您可能会发现很难保持结果。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T18:58:21.997

这可能有用： http: [//www.parashift.com/c++-faq-lite/mixing-c-and-cpp.html](http://www.parashift.com/c++-faq-lite/mixing-c-and-cpp.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-17T18:56:44.623

您需要在 C++ 中创建“extern "C"”的函数，因此它们可以从 C 中调用。

您可以通过使 this 指针显式（并且类型为 void *）来获得 OO，实现将指针转换并转发到真正的成员函数。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-17T18:59:39.920

在您的 C++ 代码中，您必须使用 extern "C" 构造来指示编译器/链接器生成兼容的链接，以便 C 代码可以调用您的 C++ 代码。

```
extern "C"
{
   void my_function_that_can_be_called_from_c()
   {
      // ...
   }
} 
```

C 代码对对象一无所知，因此您不能轻松地从 C 中使用 C++ 对象。一种常见的技术是在“外部”函数内操作 C++ 对象。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-17T21:19:04.000

假设您有以下 C++ 类：

```
#if __cplusplus // only C++ programs see this part of foo.h

class foo {
public:
    // a couple constructors
    foo();

    foo( int);

    // and a couple methods
    bool dosomething();
    bool doSomethingElse( std::string const&);

private:
    // a bunch of private stuff which is immaterial to the C interface
}

#endif 
```

您可以做的是拥有一组包装 C++ 接口的 C 可调用函数：

```
// both C and C++ programs can see this part of foo.h

#if __cplusplus // but C++ programs need to know that no name mangling should occur
extern "C" {
#endif

struct CFoo_struct;
typedef struct CFoo_struct foo_t;   // used as a handle to a foo class pointer

// constructors

foo_t* CreateFoo( void);
foo_t* CreateFoo_int( int);

int CFooDoSomething( foo_t*);
int CFooDoSomethingElse( foo_t*, char const*);

#if __cplusplus
}               // end the extern "C" block
#endif 
```

那么 foo.cpp 中的实现可能类似于：

```
// in foo.cpp
extern "C" {

    struct CFoo_struct {
    };

    // constructors

    foo_t* CreateFoo( void) 
    {
        foo* pFoo = new Foo;

        // a bit of ugliness - the need for this cast could be 
        //  avoided with some overhead by having the foo_t
        //  struct contain a foo* pointer, and putting a foo_t
        //  structure inside the foo class initialized with 
        //  the this pointer.

        return reinterpret_cast<foo_t*>( pFoo);
    }

    // something similar for CreateFoo_int()...

    // method wrappers

    int CFooDoSomethingElse( foo_t* pHandle, char const* s)
    {
        foo* pFoo = reinterpret_cast<foo*>( pHandle);

        std::string str( s);

        return pFoo->doSomethingElse( str);
    }

    // something similar for CFooDoSomething()

} // end extern "C" block 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T20:55:04.290

如果您想将 C++ 类转换为 C 程序可访问的 Linux 共享库，[此](https://stackoverflow.com/questions/496664/c-dynamic-shared-library-on-linux/497158#497158)对上一个问题的回答将向您展示如何使用一个小示例类。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T21:22:22.570

你可以做各种各样的事情。

你可以用 C 重写它。没有实际看到代码，我不知道这会有多麻烦。许多 C++ 代码只是带有一些插件的 C，有些代码大量使用模板和重载函数等。

如果您不这样做，则需要使其与 C 良好通信。这意味着为 C 提供一个接口，并将其包围，`extern "C"{ ... }`以便 C++ 编译器知道使该接口与 C 兼容。同样，在不了解 C++ 代码的情况下，我无法判断这将是多少工作。您将需要以下任一解决方案的包装器。

你可以把它变成一个 C++ 项目，用 包围每个 C 文件`extern"C" { ... }`，然后把它链接进去。如果你有任何 C++ 文件，整个编译必须是 C++。

您可以创建一个单独的库来链接。

您不能做的是将 C 和 C++ 与 C main() 函数或 C 编译器一起编译。C++ 要求更高，并且需要更多来自 main() 函数。

您总是可以尝试重新编译您作为 C++ 使用的 C 文件，并将库的 .h 文件包装在`extern "C" { ... }`. 编写良好的 C90 与合法的 C++ 相差不远（尽管 C99 标准远离了某些标准），并且编译器将标记您发现的任何转换问题。

其中哪一个对您来说最好取决于以下问题：转换 C++ 代码的难易程度？为您想要的 C++ 功能编写 C 包装器有多容易？您愿意对 C 代码进行多少更改？你对制作 Linux 库有多熟悉？

# sql - 如果已经存在，你能在 Emacs 中创建一个新的 SQL 缓冲区吗？

> ID：558247
> 
> 赞同：5
> 
> 时间：2009-02-17T18:58:02.793
> 
> 标签：sql, emacs, sql-mode

假设您已经在 Emacs 中打开了一个 *SQL* 缓冲区，该缓冲区连接到特定的服务器和数据库。现在，您的意图是连接到不同的服务器和数据库，同时保持其他 SQL 缓冲进程处于活动状态。

如何在不杀死原始 SQL 缓冲区的情况下创建新的 *SQL* 缓冲区进程？这可以做到吗？有没有办法改变现有缓冲区的连接信息？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T19:29:34.277

跑步：

```
M-x sql-rename-buffer 
```

在连接`*SQL*`的缓冲区上，将在当前连接之后重命名当前缓冲区。所以：

```
*SQL* 
```

变成：

```
*SQL user/database* 
```

然后你可以这样做：

```
M-x sql-mysql 
```

或者无论您使用何种 DB 来创建另一个 SQL 缓冲区。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T20:38:33.403

作为一个小小的简化，你可以这样做：

```
(add-hook 'sql-interactive-mode-hook 'sql-rename-buffer) 
```

（即，您不需要`lambda`）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T17:21:28.430

此外，如果像我这样的人喜欢这种连接的另一种表示，这是我的。这就是我的 sql 缓冲区命名的方式：“driver://user@server/database”

```
 (defun sql-make-alternate-buffer-name ()
  (concat (concat (prin1-to-string sql-interactive-product) "://")
      (if (string= "" sql-user)
          (if (string= "" (user-login-name))
          ()
        (concat (user-login-name) "/"))
        (concat sql-user "@"))
      (concat sql-server "/")
      (if (string= "" sql-database)
          (if (string= "" sql-server)
          (system-name)
        sql-server)
        sql-database))) 
```

*sql-interactive-mode中创建的SQL* buffers，运行sql-interactive-mode-hook，所以不需要手动运行sql-rename-buffer

```
 (add-hook 'sql-interactive-mode-hook
    (lambda () (sql-rename-buffer))) 
```

# .net - asp.net 中 DataBinding 的最佳实践以实现可维护性

> ID：558260
> 
> 赞同：7
> 
> 时间：2009-02-17T19:00:53.177
> 
> 标签：.net, asp.net, data-binding, oop, maintenance

我想知道在可维护性方面使用 asp.net DataBinding 的最佳实践是什么。

当我必须对数据库进行更改时，我不希望应用程序崩溃。

我应该在代码隐藏中完全绑定数据吗？我计划使用 ObjectDataSources 进行数据绑定。有没有比使用数据绑定更容易维护的东西，如果有，它是什么？

在设计我的数据访问层和业务层时，我应该考虑哪些因素？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T19:46:08.510

我的理念是数据访问的东西在标记中没有业务。对象数据源比 SQL 数据源更好，但我喜欢将我的标记保留为只会呈现到页面上的内容。我也更喜欢你对哪些东西是数据绑定的控制，你总是从后面的代码中得到它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:30:52.943

好问题！

就数据绑定而言，您应该仅将其视为*整体数据访问策略的一个组成部分。* 我的策略包含三个组件（我在组件 2 中找到您的 DataBinding）：

首先，我总是创建（或重用）数据访问层 (DAL) 以简化数据访问。这*并不是*因为有一天我可能会将您的数据库换成另一个 - 这种可能性很小，以至于它不能保证所需的所有工作（YAGNI）。这样做是为了 A) 消除正常数据库代码中的所有杂乱（例如获取连接字符串、设置和关闭连接等）和 B) 使用专用函数简化常见操作。

其次，您绝对*应该*实现为您的 UI 控件封装 DataBinding 的 ObjectDataSource。如果您构建了一个好的 DAL，这将变得非常简单。例如，这是一个使用我的 DAL 的 ObjectDataSource：

```
 [DataObjectMethodAttribute(DataObjectMethodType.Select, true)]
    public List<EnrollListMemberData> GetNameList(int classID, DateTime classDate)
    {
        using (BSDIQuery qry = new BSDIQuery())
        {
            return
                qry.Command(
                    "Select a.ClassDate, a.ClientID, b.FirstName, b.LastName, b.ID From ClassEnroll a inner join Folder b on (a.ClientID = b.ClientID) Where (a.ClassID=@ClassID) AND ")
                    .ParamVal(classID)
                    .Append("(DateDiff(d, a.ClassDate, @ClassDate) = 0) Order By LastName;")
                    .ParamVal(classDate)
                    .ReturnList<EnrollListMemberData>();
        }
    } 
```

需要注意的几点：“DataObjectMethodAttribute”属性将使该方法对设计时环境可见，以便在链接网格（或其他）时在数据源的下拉列表中看到它. 您还需要提供此方法的类的 [DataObjectAttribute] 属性（如果该类是我的业务层的一部分）。最后，这是一个非常简单的示例，并且没有一些常见的构造，例如用于返回分页结果的 startRowIndex 和 maximumRows 参数。

请注意，这里的特定调用来自我的 DAL - 它不是 LinqToSQL，即使它具有表面相似性。我喜欢 SQL，而且我不*希望*C# 惯用语[有任意映射回 SQL](https://stackoverflow.com/questions/458802/doesnt-linq-to-sql-miss-the-point-arent-orm-mappers-subsonic-etc-sub-opti)。请注意，如果我试图在直接的 ADO 调用中实现所有这些，那么这个函数的长度将是原来的三倍，并且有很多代码与表达我的目标并不密切相关。

第三，我总是将多步数据库操作放在存储过程中，以尽量减少通过线路调用数据库的次数。例如，我在一个产品中提供了“签到”功能，它接受签到请求，根据会员表检查它，检索以前的签到历史记录（上个月有多少访问？），如果合适，奖励奖励积分，等等等等。在 C# 代码中运行多个查询和对数据库的更改将非常复杂且非常昂贵。为了与我们的 DAL 理念保持一致，我还将对存储过程的调用封装在我的 DAL 中，以便来自代码的实际调用只是：

int status = dal.CheckIn(userID, ref checkInHistory);

如您所见，使用存储过程并将其封装在 C# 类方法中也使代码*更*易于阅读。我的代码只是说明了它的作用（如上所述），而不是有 100 多行代码设置查询等。

我希望这个对你有用！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T15:27:40.583

只是为了完整起见，我想在第一个答案中添加关于我的评论。

我问了以下问题：

> 如果您从代码隐藏中进行数据绑定，您仍然必须在标记中定义您的字段。您将如何确保业务对象中的更改不会破坏页面？

当数据绑定时，如果你转换你的对象，它会在编译时被检测到，如果一个属性名称已经改变或者它不再存在。

示例：

```
<%# ((ObjetType)Container.DataItem).PropertyName %> 
```

Also, doing this, will avoid the use of Eval, which is reported to be slow because it uses reflection. (Didn't really check the performance impact myself)

# c# - 与 Double.NaN 相等

> ID：558267
> 
> 赞同：36
> 
> 时间：2009-02-17T19:01:50.193
> 
> 标签：c#, equality, nan

我有以下代码...

```
if (Price_Foreign != Double.NaN)
{
   output.Append(spacer);
   output.Append(String.Format("{0,-10:C} USD",Price_Foreign));
} 
```

哪个输出：

```
NaN USD 
```

是什么赋予了？

我使用 Double.NaN 表示该值不存在，不应输出。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-02-17T19:05:30.357

也许您正在寻找`IsNaN`静态功能？

尝试这样的事情：

```
if (!Double.IsNaN(Price_Foreign))
{
   output.Append(spacer);
   output.Append(String.Format("{0,-10:C} USD",Price_Foreign));
} 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-02-17T19:05:40.200

[IEEE 754 浮点标准](http://en.wikipedia.org/wiki/IEEE_754)规定将 NaN 与 NaN 进行比较将始终**返回**false。如果您必须这样做，请使用`Double.IsNaN()`.

但是，这不是做你想做的事情的最好方法。双打并不精确，您在这里使用它们来表示价格。我敢打赌，在某个时候，你也会想比较价格是否平等。那是行不通的，因为[你不能依赖浮点相等](https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/)。

您应该真正考虑为这些值使用一些整数类型（支持相等比较），而不是尝试使用双精度数。双打用于科学问题；不是为了金融。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-17T19:06:09.420

`Double.NaN`不等于任何东西，甚至不等于它自己。

请参阅.NET Framework 类库文档中的[Double.NaN 字段：](http://msdn.microsoft.com/en-us/library/system.double.nan(VS.71).aspx)

> 使用[IsNaN](http://msdn.microsoft.com/en-us/library/system.double.isnan(VS.71).aspx)确定值是否不是数字。无法通过将一个值与另一个等于 NaN 的值进行比较来确定一个值是否不是数字。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-05-24T14:47:31.800

作为背景信息：该`IsNaN()`方法的作用是`return v != v;`

# c# - 将 Silverlight Toolkit AutoCompleteBox 与所选项目附加

> ID：558271
> 
> 赞同：0
> 
> 时间：2009-02-17T19:02:49.427
> 
> 标签：c#, silverlight, autocomplete, silverlight-2.0, silverlight-toolkit

我正在使用 Silverlight Tookit（12 月发布）中的自动完成框。当用户键入时，我使用 web 服务返回一个 ItemsSource，其中仅包含用户当前在 AutoCompleteBox 中键入的单词的查找（与整个短语相反，这是默认行为）。我现在想做的是，如果用户从下拉列表中选择一个选项，我想将该选项附加到 AutoComplteBox，而不是像现在那样替换它。

例如，如果最后一项应该读作“John Smith”。目前，当用户键入 JOHN 时，将出现一个包含 John 的列表，他们可以根据需要选择 John。当他们继续键入 SMITH 时，我已经处理了填充事件以仅将 .Text 属性中的最后一个单词传递给 Web 服务，他们将获得一个包含 smith 的列表。到现在为止还挺好。但是，当从下拉菜单中选择“Smith”时，内容“John”会被内容“Smith”替换，只剩下“Smith”，而不是我们想要的“John Smith”。

我试图通过为 DropDownClosing 和/或 SelectionChanged 事件编写自定义处理程序来解决这个问题。这些似乎都不是要处理的正确事件。

有人可以指导我去哪里管理这种行为吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T00:27:26.400

既然您已经附加到 on populating 事件并且可能会启动对服务器的数据请求，为什么不在返回之前将“John”附加到 itemssource 中的所有项目？然后，当您匹配时，它就已经存在了。

# .net - 对象捕获自己的异常并将消息存储在属性中是不好的做法吗？

> ID：558273
> 
> 赞同：3
> 
> 时间：2009-02-17T19:03:03.017
> 
> 标签：.net, oop, exception, exception-handling

假设我有一个相同类型的对象列表。我想遍历该对象列表并在每个对象上执行“危险”方法。如果该方法中发生异常，让方法本身捕获异常并在对象上设置错误属性是不好的做法吗？

下面是一个快速示例，其中 Car 的 Start() 方法捕获自己的异常并将其存储在其“问题”属性中：

```
Sub Main()

    // Build cars.
    Dim ford As New Car("ford", "1988")
    Dim chevy As New Car("chevy", "1992")
    Dim honda As New Car("honda", "2002")

    // Create a list of cars.
    Dim carList As New List(Of Car)
    carList.Add(ford)
    carList.Add(chevy)
    carList.Add(honda)

    // Start all of the cars.
    For Each c As Car In carList
        // I don't want to stop processing if an exception occurs.
        // And I don't care to report any errors now.
        c.Start()
    Next

    // other stuff...

    // Now report errors.
    Dim cr As New CarReport
    cr.ReportProblems(carList)

End Sub 
```

报告任何问题的类：

```
Public Class CarReport

    Public Sub ReportProblems(ByVal c As List(Of Car))
        // Report any problems.
        For Each c In carList
            If Not String.IsNullOrEmpty(c.Problem) Then
                Console.WriteLine(c.Problem)
            End If
        Next
    End Sub

End Class 
```

简单的汽车类：

```
Public Class Car

    Private _make As String
    Private _year As String
    Private _problem As String = String.Empty

    Public Sub New(ByVal make As String, ByVal year As String)
        _make = make
        _year = year
    End Sub

    Public Sub Start()
        Try
            // Do something that could throw an exception.
        Catch ex As Exception
            _problem = "Car would not start."
        End Try
    End Sub

    Public ReadOnly Property Problem() As String
        Get
            Return _problem
        End Get
    End Property

End Class 
```

**编辑：**如果调用者（即`Sub Main()`上面）捕捉到异常，然后在 Car 对象上设置 Problem 属性怎么办？这似乎更清洁。我真正需要完成的是将错误文本与特定的 Car 对象一起保存，以便可以将其传递给另一个系统进行报告。

**注意：**汽车场景是一个简单的例子来说明一个场景，我没有在类设计上花太多心思。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T19:06:33.257

我会说绝对，因为这只是一个单一电话的规定。如果您对对象进行其他调用并且它也抛出异常会发生什么？属性值被覆盖，然后您不确定对象的状态是什么。

您最好在 try/catch 块中捕获异常信息，然后单独处理它。一般来说，除非您将对象的方法设计为不修改对象的状态，否则我会考虑在调用对象的方法/属性时抛出异常以使对象不可用，作为对象的状态在那一点上是不确定的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T19:36:04.620

这不是一个坏习惯，**它是 ADO.Net 中使用的一种设计模式。**

数据集中的每一行都有一个名为[HasErrors](http://msdn.microsoft.com/en-us/library/system.data.datarow.haserrors.aspx)的属性。这在各种验证场景中很有用。

这是 Beth Massi 的一个示例：“[在 WPF 中显示数据验证消息](http://blogs.msdn.com/bethmassi/archive/2008/06/27/displaying-data-validation-messages-in-wpf.aspx)”

**编辑**：@casperOne：感谢您的评论。是的， HasError 行为违反了封装的理想——一旦对象出现错误，某些外部操作必须收集/使用该信息，然后销毁/重置对象。

但这是对简单性的一个很好的折衷。涉及包装器的“正确”实现将是复杂且昂贵的，因此不切实际。

这不仅是对权威的诉求，也是对“该死的东西有效！”的诉求。;)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T19:12:37.877

我这么认为有几个原因：

(1)延迟报告问题违反了[快速失败原则。](http://blogs.msdn.com/micahel/archive/2005/08/17/FailFast.aspx)

(2) 它不是一个非常模块化的设计。car 和 carReport 类耦合得太紧了。

(3) 它要求调用者对 main() 的实现有特殊的了解才能知道如何处理错误，这使得客户端代码更有可能忽略处理错误条件，或者由于对错误处理机制的无知，或者懒惰。

(4) 如果您遇到这样的情况，可能会出现多个错误，那么它有一定的味道，也许应该将操作分解为更小的工作单元。

(5) 如另一个答案所述。car.problem 和 car.start 方法耦合太紧。例如，如果你调用 car.start 两次但它只失败了一次，会发生什么？你保留第一个问题吗？在这种情况下，调用者如何知道如何解释 car.problem 属性。总的来说，这似乎是糟糕的封装。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T19:59:41.553

我认为需要区分“数据验证”和“程序错误”。
在数据验证场景中：

如果验证完全或部分由异常驱动，则通过 ADO.NET HasErrors 或 IDataErrorInfo 或任何您需要的方式捕获异常并将其应用于属性是一件好事。关于使用异常进行验证是否是良好的编程习惯存在许多争论，我在围栏两边都看到了很好的代码。

但是，如果出现与您的验证无关的异常（NullReferenceException 或 MemoryException），导致您的对象由于其状态未定义而无法再正常运行，那么出于 JohnFx 回答中提到的原因，需要引发异常.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T20:00:40.270

```
var errors = new string[carList.Length];
for(var i = 0; i < carList.Length; i += 1) {
    try {
        carList[i].Start();
    } catch(Exception ex) {
        errors[i] = ex.Message;
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T19:52:33.003

以这种特殊的方式使用它，我认为这是不好的做法，是的。我看到的主要问题是使用该对象的类没有被告知发生的问题，它必须检查自己，尽管它负责错误处理。如果汽车本身进行错误处理，则没有什么可以阻止它，因为它可以确保对象状态保持一致。

尽管正如“Tom A”所说，这种模式在 ADO.Net 中使用，但我认为它在另一个上下文中使用。正如明确指出的那样，这是一个验证上下文。那里没有发生真正的错误/异常，但它可能！在此处使用的上下文中，您可以更正可能崩溃的数据，错误已经发生。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-14T23:00:47.460

在某些情况下，人们可能想要尝试多种操作并查看哪些操作成功。在某些情况下，即使较早的操作失败，人们也可能希望继续尝试以后的操作。不过，我不喜欢你的特定模式。我建议最好`Start`包含一个接受类似`Func<Exception,someEnumeratedType>`（可能是`Action<Exception,somethingElse>`）的重载。如果出现问题，代码将创建一个`Exception`并将其传递给提供的`Action`; 默认函数会简单地抛出传入的异常，但该函数也可以记录失败并返回一个值，指示事情应该继续进行，或者应该正常退出。

我建议当且仅当操作失败表明对象处于无用状态时，对象应保持“操作失败”标志。除了设置标志之外，对状态已损坏的对象的操作应该抛出异常，除非在已知调用者准备处理故障的特殊情况下。

# logging - 如何在不从 stdout 和 stderr 缓冲的情况下记录 make 输出

> ID：558274
> 
> 赞同：10
> 
> 时间：2009-02-17T19:03:07.070
> 
> 标签：logging, makefile, stderr, buffering

我在从自动构建记录到输出时遇到问题。

构建是使用 Makefile 和 makefile 实用程序完成的。

问题是像编译器命令行这样的正常输出会转到 stdout，而编译错误会转到 stderr。

我想从构建中获取输出，就像它在屏幕上显示的那样。所以像：

```
(stdout) CC -c file.cpp
(stderr) Compile error at file.cpp line 232, blah blah blah
(stdout) CC -c file2.cpp 
```

我尝试过的（来自 ksh 脚本）是：

制作 -k > build.log 2> build.log

这会产生一个日志文件，但问题是流被缓冲，因此日志文件中的结果全部混淆了。

我可以将输出捕获到 2 个单独的日志文件中，但是我没有关于如何将它们重新粘合到一个日志文件中的信息。

在这种情况下，有没有办法关闭 stdout 和 stderr 的缓冲？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-17T19:11:31.513

```
make -k > build.log 2>&1 
```

这应该对您更好，因为它不是单独重定向 stderr 和 stdout，而是将 stderr 重定向到 stdout，这应该使缓冲同步。

如果要将其记录到文件并将其打印到控制台：

```
make -k 2>&1 | tee build.log 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T19:06:15.240

试试这个

```
make -k > build.log 2>&1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T07:44:05.350

> 我可以将输出捕获到 2 个单独的日志文件中，但是我没有关于如何将它们重新粘合到一个日志文件中的信息。

将它们重新粘合在一起很棘手，但也有一个正确的答案，而且它有效！请参阅 Vivek Gite 的“[如何将 stdout 和 stderr 保存或重定向到不同](http://www.cyberciti.biz/faq/saving-stdout-stderr-into-separate-files/)的文件？”。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-05-06T06:44:02.657

setbuf（标准输出，NULL）；-> 关闭标准输出缓冲

# sql - How do I find all references from other tables to a specific row?

> ID：558283
> 
> 赞同：0
> 
> 时间：2009-02-17T19:05:36.550
> 
> 标签：sql, postgresql

So I have an address table that is shared among various other tables, such as schools, parks, churches, etc. Schools, parks, etc all foreign key to a row in address.

What I'm wondering is, if I have a specific row in the address table, is there a way to find out which row in which table points to it. So basically just this:

```
SELECT * FROM schools WHERE address_id = 1 
```

But that would mean I would have to know that the address in row 1 is connected to a school. But what if I don't know that? It could be 1 of 10 other tables...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T19:12:50.263

You're going to have to query each of the other tables.

I would do it as a UNION query:

```
 SELECT id, "schools" as whichTable from schools where address_id=1
  UNION
  SELECT id, "parks" as whichTable from parks where address_id=1
  UNION
  ... 
```

so that you only have to run one query and get back the results as a single dataset that you work with.

If you have a list of tables (or a table of tables), you could generate the query programmaticly -- that would save you having to update your query when the tables are changed.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T19:28:05.310

What you are looking for - assuming you have an ISO compliant RDBMS - is the INFORMATION_SCHEMA tableset (actually viewset, but hey).

You can find dependent tables like so:

```
select 
    cons.CONSTRAINT_NAME 'ConstraintName',
    keys.TABLE_NAME 'PKTable',
    keys.COLUMN_NAME 'PKColumn',
    cols.TABLE_NAME 'FKTable',
    cols.COLUMN_NAME 'FKColumn'
from INFORMATION_SCHEMA.REFERENTI cons
join INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE cols on cols.CONSTRAINT_NAME = cons.CONSTRAINT_NAME
join INFORMATION_SCHEMA.KEY_COLUMN_USAGE keys on keys.CONSTRAINT_NAME = cons.UNIQUE_CONSTRAINT_NAME 
```

**NOTE:** This is a very rough, untested query. You get the idea, though.

# asp.net - ASP.NET 和 SQL Server 中的注释编号

> ID：558292
> 
> 赞同：0
> 
> 时间：2009-02-17T19:08:17.153
> 
> 标签：asp.net, sql-server, linq, database-design, comments

根据文章，我刚刚考虑了将评论存储在数据库中的最佳方法，并带有适当的数字。

这个想法是使用复合主键（commentId，articleId）存储评论，其中commentId是根据给定的articleId生成的。生成系统应该和SQL Server中IDENTITY生成列的原理一样，因为如果有人删除了评论，这个数字就再也不会被使用了。我想 Microsoft SQL Server 中没有任何功能可以使用复合 PK 来做到这一点，所以我想问一些替代这个解决方案的方法。

首先想到的是使用事务来获取 MAX(commentId) + 1，但我正在寻找更抽象的东西（可能是 INSTEAD OF 触发器），例如可以在不了解背景的情况下在 LINQ 中使用的东西，只需插入适当的表所有必需的值（所以没有commentId）并保存它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T19:20:25.440

我会为 commentId 使用一个自动生成的标识列，并让它单独作为主键。我会在 articleId 上创建一个索引以进行查找。我还会在插入时使用当前日期自动填充 createdDate 列——在 LINQ 中将其标记为 db 生成和只读，因此它不需要或尝试插入/更新值。要获得编号——如果按日期显示它们还不够——我会按 createdDate 倒数排序，并在选择中使用 Row_Number() 或在客户端编号分配一个数值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:16:53.717

我会使用标识列作为评论的键，为什么需要对存储在数据库中的评论进行编号？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T19:12:42.857

感谢您的回复，由于在评论文本中引用，我想要一些带有编号的评论。我不想用名字做出反应，有时一个人反应更多次，所以有了这个系统，我会知道这个人在回复哪一个。

所以今天我做了这个 INSTEAD OF INSERT 触发器：

```
CREATE TRIGGER InsertComments ON Comments
INSTEAD OF INSERT
AS
DECLARE @Inserted TABLE
(
    ArticleId INT NOT NULL,
    UserId INT NOT NULL,
    CommentDate DATETIME NOT NULL,
    Content NVARCHAR(1000) NOT NULL,
    RowNumber INT NOT NULL
)
INSERT INTO @Inserted
SELECT ArticleId, UserId, CommentDate, Content, ROW_NUMBER() OVER (ORDER BY CommentDate) AS RowNumber
FROM INSERTED
DECLARE @NumberOfRows INT = (SELECT COUNT(*) FROM @Inserted)
DECLARE @i INT = 1
WHILE (@i <= @NumberOfRows)
BEGIN
    SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
    BEGIN TRAN
    DECLARE @CommentId INT = (SELECT ISNULL(MAX(CommentId), 0)
        FROM Comments WHERE ArticleId = (SELECT ArticleId
            FROM @Inserted WHERE RowNumber = @i)) + 1
    INSERT INTO Comments(CommentId, ArticleId, UserId, CommentDate, Content)
    SELECT @CommentId, ArticleId, UserId, CommentDate, Content
    FROM @Inserted WHERE RowNumber = @i
    COMMIT
    SET @i = @i + 1
END 
```

我知道这不是完美的解决方案，但它完全符合我的需要。如果你们中的任何人有一些意见，我会很乐意阅读。

# iphone - 如何更改 Cocos2d MenuItem 的颜色？

> ID：558300
> 
> 赞同：6
> 
> 时间：2009-02-17T19:10:24.463
> 
> 标签：iphone, objective-c, cocos2d-iphone

```
[MenuItemFont setFontSize:20];
[MenuItemFont setFontName:@"Helvetica"];
//I'm trying to change the color of start (below item)
MenuItem *start = [MenuItemFont itemFromString:@"Start Game" 
                                        target:self 
                                      selector:@selector(startGame:)];
MenuItem *help = [MenuItemFont itemFromString:@"Help"
                                       target:self 
                                     selector:@selector(help:)];
Menu *startMenu = [Menu menuWithItems:start, help, nil];
[startMenu alignItemsVertically];
[self add:startMenu]; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-15T16:46:51.940

```
MenuItemFont *start =  [MenuItemFont itemFromString:@"Start Game" 
                                             target:self 
                                           selector:@selector(startGame:)];

[start.label setRGB:0 :0 :0]; // Black menu item 
```

Label 是 MenuItemFont 的一个属性，它是 MenuItem 的子类，因此在隐式转换为 MenuItem 期间会丢失它。

或者，您可以这样做：

```
[((MenuItemFont *)start).label setRGB:0 :0 :0] 
```

（但这很丑陋，并且 startMenu 将采用 MenuItemFont 没有任何抱怨）。

请记住，颜色大部分是在 MenuItemFont 中硬编码的，因此调用“setIsEnabled”会将颜色设置回灰色或白色。如果您需要调整它，这会发生在 MenuItem.m 的第 239 行附近。如果我开始制作补丁以在 MenuItemFont 上公开此功能（假设它尚未在 pre-.7.1 源中），我将更新我的帖子。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-04-06T18:55:56.463

setRGB 在较新版本中已设置为 setColor。例如：

```
[start.label setColor: ccc3(200,0,200)]; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-06T15:21:02.147

您可以这样更改（至少在 Cocos2d 版本 0.99.5 上）

```
CCMenuItemFont *startMenuItem = [CCMenuItemFont itemFromString:@"Start" target:self selector:@selector(startTapped:)];
[startMenuItem setColor:ccBLACK]; 
```

# c# - 任何人都可以向我解释 IEnumerable 和 IEnumerator 吗？

> ID：558304
> 
> 赞同：314
> 
> 时间：2009-02-17T19:11:51.870
> 
> 标签：c#, ienumerable, ienumerator

`IEnumerable`任何人都可以向我解释`IEnumerator`吗？

例如，何时在 foreach 上使用它？`IEnumerable`和有什么区别`IEnumerator`？为什么我们需要使用它？

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2009-02-17T19:41:33.280

> 例如，何时在 foreach 上使用它？

你不使用`IEnumerable`"over" `foreach`。实施`IEnumerable`使使用成为`foreach` *可能*。

当您编写如下代码时：

```
foreach (Foo bar in baz)
{
   ...
} 
```

它在功能上等同于编写：

```
IEnumerator bat = baz.GetEnumerator();
while (bat.MoveNext())
{
   bar = (Foo)bat.Current
   ...
} 
```

通过“功能等效”，我的意思是这实际上就是编译器将代码变成的内容。你不能在这个例子中使用`foreach`on*除非*implements 。 `baz` *`baz``IEnumerable`*

 *`IEnumerable`表示`baz`实现该方法

```
IEnumerator GetEnumerator() 
```

此方法返回的`IEnumerator`对象必须实现方法

```
bool MoveNext() 
```

和

```
Object Current() 
```

第一个方法前进到`IEnumerable`创建枚举器的对象中的下一个对象，`false`如果完成则返回，第二个方法返回当前对象。

.Net 中可以迭代的任何内容 implements `IEnumerable`。如果您正在构建自己的类，并且它还没有从实现的类继承，则可以通过实现（并通过创建其新方法将返回的枚举器类）使您的类在语句中`IEnumerable`可用。`foreach``IEnumerable``GetEnumerator`

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2014-08-31T00:29:04.243

**IEnumerable 和 IEnumerator 接口**

要开始研究实现现有 .NET 接口的过程，让我们首先看看 IEnumerable 和 IEnumerator 的作用。回想一下，C# 支持名为 foreach 的关键字，它允许您遍历任何数组类型的内容：

```
// Iterate over an array of items.
int[] myArrayOfInts = {10, 20, 30, 40};
foreach(int i in myArrayOfInts)
{
   Console.WriteLine(i);
} 
```

虽然看起来只有数组类型可以使用此构造，但事实是任何支持名为 GetEnumerator() 的方法的类型都可以由 foreach 构造求值。为了说明，请跟我来！

假设我们有一个 Garage 类：

```
// Garage contains a set of Car objects.
public class Garage
{
   private Car[] carArray = new Car[4];
   // Fill with some Car objects upon startup.
   public Garage()
   {
      carArray[0] = new Car("Rusty", 30);
      carArray[1] = new Car("Clunker", 55);
      carArray[2] = new Car("Zippy", 30);
      carArray[3] = new Car("Fred", 30);
   }
} 
```

理想情况下，使用 foreach 构造迭代 Garage 对象的子项会很方便，就像数据值数组一样：

```
// This seems reasonable ...
public class Program
{
   static void Main(string[] args)
   {
      Console.WriteLine("***** Fun with IEnumerable / IEnumerator *****\n");
      Garage carLot = new Garage();
      // Hand over each car in the collection?
      foreach (Car c in carLot)
      {
         Console.WriteLine("{0} is going {1} MPH",
         c.PetName, c.CurrentSpeed);
      }
      Console.ReadLine();
   }
} 
```

遗憾的是，编译器通知您 Garage 类没有实现名为 GetEnumerator() 的方法。此方法由 IEnumerable 接口形式化，该接口隐藏在 System.Collections 命名空间中。支持此行为的类或结构宣传它们能够向调用者公开包含的子项（在本示例中，为 foreach 关键字本身）。下面是这个标准 .NET 接口的定义：

```
// This interface informs the caller
// that the object's subitems can be enumerated.
public interface IEnumerable
{
   IEnumerator GetEnumerator();
} 
```

如您所见，GetEnumerator() 方法返回对另一个名为 System.Collections.IEnumerator 的接口的引用。此接口提供了允许调用者遍历 IEnumerable 兼容容器所包含的内部对象的基础结构：

```
// This interface allows the caller to
// obtain a container's subitems.
public interface IEnumerator
{
   bool MoveNext (); // Advance the internal position of the cursor.
   object Current { get;} // Get the current item (read-only property).
   void Reset (); // Reset the cursor before the first member.
} 
```

如果要更新 Garage 类型以支持这些接口，则可以走很长的路并手动实现每个方法。虽然您当然可以自由地提供 GetEnumerator()、MoveNext()、Current 和 Reset() 的自定义版本，但还有一种更简单的方法。由于 System.Array 类型（以及许多其他集合类）已经实现了 IEnumerable 和 IEnumerator，您可以简单地将请求委托给 System.Array，如下所示：

```
using System.Collections;
...
public class Garage : IEnumerable
{
   // System.Array already implements IEnumerator!
   private Car[] carArray = new Car[4];
   public Garage()
   {
      carArray[0] = new Car("FeeFee", 200);
      carArray[1] = new Car("Clunker", 90);
      carArray[2] = new Car("Zippy", 30);
      carArray[3] = new Car("Fred", 30);
   }
   public IEnumerator GetEnumerator()
   {
      // Return the array object's IEnumerator.
      return carArray.GetEnumerator();
   }
} 
```

更新 Garage 类型后，您可以安全地在 C# foreach 构造中使用该类型。此外，鉴于 GetEnumerator() 方法已公开定义，对象用户还可以与 IEnumerator 类型交互：

```
// Manually work with IEnumerator.
IEnumerator i = carLot.GetEnumerator();
i.MoveNext();
Car myCar = (Car)i.Current;
Console.WriteLine("{0} is going {1} MPH", myCar.PetName, myCar.CurrentSpeed); 
```

但是，如果您希望从对象级别隐藏 IEnumerable 的功能，只需使用显式接口实现：

```
IEnumerator IEnumerable.GetEnumerator()
{
  // Return the array object's IEnumerator.
  return carArray.GetEnumerator();
} 
```

通过这样做，临时对象用户将找不到 Garage 的 GetEnumerator() 方法，而 foreach 构造将在必要时在后台获取接口。

改编自[Pro C# 5.0 和 .NET 4.5 Framework](http://www.apress.com/9781430242338)

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2009-02-17T19:16:14.857

实现 IEnumerable 意味着您的类返回一个 IEnumerator 对象：

```
public class People : IEnumerable
{
    IEnumerator IEnumerable.GetEnumerator()
    {
        // return a PeopleEnumerator
    }
} 
```

实现 IEnumerator 意味着您的类返回迭代的方法和属性：

```
public class PeopleEnumerator : IEnumerator
{
    public void Reset()...

    public bool MoveNext()...

    public object Current...
} 
```

无论如何，这就是区别。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2016-10-25T20:46:44.513

## 通过类比解释 + 代码演练

类比：你是飞机上的中央情报局特工。您想知道有关乘客的信息，即您需要“遍历”它以便逮捕您的嫌疑人：

*   你从飞机的前部开始，然后一路走到后部，询问乘客：他们是谁，他们来自哪里等。

飞机只能这样做，如果它是：

1.  可数的，并且
2.  如果它有一个柜台。

*为什么有这些要求？*因为这就是接口所需要的。

（如果这是信息过载，您只需要知道您希望能够向每位乘客提出一些问题）

**可数是什么意思？**

如果一家航空公司是“可数的”，这意味着飞机上必须有一名空乘人员，其唯一的工作就是数数——而且该空乘人员必须以一种非常具体的方式进行数数：

1.  柜台/乘务员必须在第一位乘客之前开始（在他们演示安全、如何穿上救生衣等的每个人的前面）。
2.  他/她（即空乘人员）必须“下一个”沿着过道走到第一个座位。
3.  然后，他/她将记录：(i) 该人坐在座位上的人，以及 (ii) 他们当前在过道中的位置。

*计数程序*

航空公司的机长希望在对每位乘客进行调查时得到一份报告。因此，在与第一个座位上的人交谈后，乘务员/柜台然后向机长报告，报告完成后，柜台会记住他/她在过道的确切位置，并从他/她离开的地方继续计数离开。

以这种方式，船长总是能够获得有关当前正在调查的人的信息。这样一来，如果他发现这个人喜欢曼城，那么他可以给予那个乘客优惠等等。

*   柜台一直走，直到他到达飞机的尽头。

**让我们将其与 IEnumerables 联系起来**

*   可枚举只是飞机上乘客的集合。民航法 - 这些基本上是所有 IEnumerables 必须遵守的规则。每次空乘人员带着乘客信息去找机长时，我们基本上是在将乘客“让步”给机长。机长基本上可以对乘客做任何他想做的事——除了重新安排飞机上的乘客。在这种情况下，如果他们跟随曼城，他们会得到优待（呃！）

    ```
     foreach (Passenger passenger in Plane)
     // the airline hostess is now at the front of the plane
     // and slowly making her way towards the back
     // when she get to a particular passenger she gets some information
     // about the passenger and then immediately heads to the cabin
     // to let the captain decide what to do with it
     { // <---------- Note the curly bracket that is here.
         // we are now cockpit of the plane with the captain.
         // the captain wants to give the passenger free 
         // champaign if they support manchester city
         if (passenger.supports_mancestercity())
         {
             passenger.getFreeChampaign();
         } else
         {
             // you get nothing! GOOD DAY SIR!
         }
     } //  <---- Note the curly bracket that is here!
           the hostess has delivered the information 
           to the captain and goes to the next person
           on the plane (if she has not reached the 
           end of the plane) 
    ```

**概括**

换句话说，如果某物*有一个 counter* ，它就是可数的。并且计数器必须（基本上）：（i）记住它的位置（*状态*），（ii）能够*下一步移动*，（iii）并且知道他正在处理的*当前人。*

可枚举只是“可数”的一个花哨的词。换句话说，可枚举允许您“枚举”（即计数）。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2009-02-17T19:19:16.143

[IEnumerable](http://msdn.microsoft.com/en-us/library/system.collections.ienumerable_members.aspx)实现 GetEnumerator。调用时，该方法将返回一个实现 MoveNext、Reset 和 Current的[IEnumerator 。](http://msdn.microsoft.com/en-us/library/system.collections.ienumerator_members.aspx)

因此，当您的类实现 IEnumerable 时，您是在说您可以调用一个方法 (GetEnumerator) 并获得一个返回的新对象（一个 IEnumerator），您可以在诸如 foreach 之类的循环中使用。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-02-17T19:12:48.640

实现 IEnumerable 使您能够获取列表的 IEnumerator。

IEnumerator 允许 foreach 样式顺序访问列表中的项目，使用 yield 关键字。

在 foreach 实现之前（例如在 Java 1.4 中），迭代列表的方法是从列表中获取一个枚举器，然后向它询问列表中的“下一个”项目，只要返回的值作为下一个项目不为空。Foreach 只是将其作为一种语言功能隐式执行，就像 lock() 在幕后实现 Monitor 类一样。

我希望 foreach 可以在列表上工作，因为它们实现了 IEnumerable。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2009-02-17T19:17:05.463

*   实现**IEnumerable**的对象允许其他人访问它的每个项目*（通过枚举器）*。
*   实现**IEnumerator**的对象正在执行迭代。它在一个可枚举的对象上循环。

将可枚举对象想象成列表、堆栈、树。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2017-06-03T01:46:41.480

IEnumerable 和 IEnumerator（以及它们的通用对应物 IEnumerable<T> 和 IEnumerator<T>）是[.Net Framework 类库集合中](https://msdn.microsoft.com/en-us/library/system.collections)[迭代器](https://en.wikipedia.org/wiki/Iterator)实现的基本接口。

*IEnumerable*是您在大多数代码中看到的最常见的接口。它启用了 foreach 循环、生成器（想想*yield*），并且由于它的接口很小，它被用来创建紧密的抽象。[IEnumerable 取决于 IEnumerator](https://msdn.microsoft.com/en-us/library/system.collections.ienumerable.getenumerator)。

*另一方面，*IEnumerator提供了一个稍低级别的迭代接口。*它被称为[显式迭代器](https://en.wikipedia.org/wiki/Iterator#C.23_and_other_.NET_languages)，它使程序员可以更好地控制迭代周期。*

 *# IEnumerable

IEnumerable 是一个标准接口，可以对支持它的集合进行迭代（事实上，我今天能想到的所有集合类型都实现了*IEnumerable*）。编译器支持允许语言特性，如`foreach`. 一般而言，它启用了这种[隐式迭代器实现](https://en.wikipedia.org/wiki/Iterator#Implicit_iterators)。

### foreach 循环

```
foreach (var value in list)
  Console.WriteLine(value); 
```

我认为循环是使用*IEnumerable*接口`foreach`的主要原因之一。*与经典的C*风格 for 循环相比，它的语法非常简洁且易于理解，您需要检查各种变量以查看它在做什么。*`foreach`*

 **### 产量关键字

可能一个鲜为人知的特性是*IEnumerable*还可以[在 C#](https://en.wikipedia.org/wiki/Generator_(computer_programming)#C.23)中使用`yield return`and`yield break`语句启用生成器。

```
IEnumerable<Thing> GetThings() {
   if (isNotReady) yield break;
   while (thereIsMore)
     yield return GetOneMoreThing();
} 
```

### 抽象

实践中的另一个常见场景是使用*IEnumerable*来提供简约抽象。因为它是一个很小的只读接口，所以鼓励您将您的集合公开为*IEnumerable*（而不是*List*例如）。这样您就可以在不破坏客户代码的情况下自由更改您的实现（例如，将 List 更改为*LinkedList*）。

### 明白了

需要注意的一种行为是，在流实现中（例如，从数据库中逐行检索数据，而不是先将所有结果加载到内存中），您*不能*对集合进行多次迭代。*这与诸如List*之类的内存集合形成对比，您可以在其中迭代多次而不会出现问题。例如，ReSharper[*对 IEnumerable 的可能多重枚举进行*](https://www.jetbrains.com/help/resharper/PossibleMultipleEnumeration.html)[了代码检查](https://www.jetbrains.com/help/resharper/PossibleMultipleEnumeration.html)*。*

 *# IEnumerator

另一方面，IEnumerator 是使*IEnumerble-foreach-magic*工作的幕后界面。严格来说，它启用了显式迭代器。

```
var iter = list.GetEnumerator();
while (iter.MoveNext())
    Console.WriteLine(iter.Current); 
```

根据我的经验， *IEnumerator*很少在常见场景中使用，因为它的语法更冗长且语义稍显混乱（至少对我而言；例如*MoveNext()*也返回一个值，但名称根本不建议这样做）。

### IEnumerator 的用例

我只在提供*IEnumerable*接口的地方特别使用了*IEnumerator*（稍微低一点的）库和框架。一个例子是数据流处理库，它在循环中提供一系列对象，即使在幕后使用各种文件流和序列化收集数据。*`foreach`*

 ***客户端代码**

```
foreach(var item in feed.GetItems())
    Console.WriteLine(item); 
```

**图书馆**

```
IEnumerable GetItems() {
    return new FeedIterator(_fileNames)
}

class FeedIterator: IEnumerable {
    IEnumerator GetEnumerator() {
        return new FeedExplicitIterator(_stream);
    }
}

class FeedExplicitIterator: IEnumerator {
    DataItem _current;

    bool MoveNext() {
        _current = ReadMoreFromStream();
        return _current != null;           
    }

    DataItem Current() {
        return _current;   
    }
} 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2015-06-18T12:06:11.763

**IEnumerable 和 IEnumerator 之间的区别：**

*   IEnumerable 在内部使用 IEnumerator。
*   IEnumerable 不知道正在执行哪个项目/对象。
*   每当我们将 IEnumerator 传递给另一个函数时，它就知道项目/对象的当前位置。
*   每当我们将 IEnumerable 集合传递给另一个函数时，它不知道项目/对象的当前位置（不知道它正在执行哪个项目）

    ***IEnumerable 有一个方法 GetEnumerator()***

> ```
> public interface IEnumerable<out T> : IEnumerable
> {
>     IEnumerator<T> GetEnumerator();
> } 
> ```

***IEnumerator 有一个名为 Current 的属性和两个方法，Reset() 和 MoveNext()（这对于了解列表中项目的当前位置很有用）。***

```
public interface IEnumerator
{
     object Current { get; }
     bool MoveNext();
     void Reset();
} 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-02-17T19:19:00.043

实现`IEnumerable`本质上意味着可以迭代对象。这并不一定意味着它是一个数组，因为某些列表无法被索引，但您可以枚举它们。

`IEnumerator`是用于执行迭代的实际对象。它控制列表中从一个对象到下一个对象的移动。

大多数时候，`IEnumerable`&`IEnumerator`被透明地用作`foreach`循环的一部分。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2019-05-04T22:59:14.140

IEnumerable 是一个包含 Ienumerator 的框。IEnumerable 是所有集合的基本接口。如果集合实现了 IEnumerable，则 foreach 循环可以运行。在下面的代码中，它解释了拥有我们自己的枚举器的步骤。让我们首先定义我们将要收集的类。

```
public class Customer
{
    public String Name { get; set; }
    public String City { get; set; }
    public long Mobile { get; set; }
    public double Amount { get; set; }
} 
```

现在我们将定义类，它将充当我们的类 Customer 的集合。请注意，它正在实现接口 IEnumerable。这样我们就必须实现方法GetEnumerator。这将返回我们的自定义枚举器。

```
public class CustomerList : IEnumerable
{
    Customer[] customers = new Customer[4];
    public CustomerList()
    {
        customers[0] = new Customer { Name = "Bijay Thapa", City = "LA", Mobile = 9841639665, Amount = 89.45 };
        customers[1] = new Customer { Name = "Jack", City = "NYC", Mobile = 9175869002, Amount = 426.00 };
        customers[2] = new Customer { Name = "Anil min", City = "Kathmandu", Mobile = 9173694005, Amount = 5896.20 };
        customers[3] = new Customer { Name = "Jim sin", City = "Delhi", Mobile = 64214556002, Amount = 596.20 };
    }

    public int Count()
    {
        return customers.Count();
    }
    public Customer this[int index]
    {
        get
        {
            return customers[index];
        }
    }
    public IEnumerator GetEnumerator()
    {
        return customers.GetEnumerator(); // we can do this but we are going to make our own Enumerator
        return new CustomerEnumerator(this);
    }
} 
```

现在我们将创建我们自己的自定义枚举器，如下所示。所以，我们必须实现方法 MoveNext。

```
 public class CustomerEnumerator : IEnumerator
    {
        CustomerList coll;
        Customer CurrentCustomer;
        int currentIndex;
        public CustomerEnumerator(CustomerList customerList)
        {
            coll = customerList;
            currentIndex = -1;
        }

        public object Current => CurrentCustomer;

        public bool MoveNext()
        {
            if ((currentIndex++) >= coll.Count() - 1)
                return false;
            else
                CurrentCustomer = coll[currentIndex];
            return true;
        }

        public void Reset()
        {
            // we dont have to implement this method.
        }
    } 
```

现在我们可以在我们的集合上使用 foreach 循环，如下所示；

```
 class EnumeratorExample
    {
        static void Main(String[] args)
        {

            CustomerList custList = new CustomerList();
            foreach (Customer cust in custList)
            {
                Console.WriteLine("Customer Name:"+cust.Name + " City Name:" + cust.City + " Mobile Number:" + cust.Amount);
            }
            Console.Read();

        }
    } 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-10-20T15:56:56.907

了解迭代器模式将对您有所帮助。我建议阅读相同的内容。

[迭代器模式](http://www.oodesign.com/iterator-pattern.html)

在高层次上，迭代器模式可用于提供一种标准方法来迭代任何类型的集合。我们在迭代器模式中有 3 个参与者，实际集合（客户端）、聚合器和迭代器。聚合是一个接口/抽象类，它有一个返回迭代器的方法。Iterator 是一个接口/抽象类，它具有允许我们遍历集合的方法。

*为了实现该模式，我们首先需要实现一个迭代器来生成一个可以迭代相关集合（客户端）的具体实例，然后集合（客户端）实现聚合器以返回上述迭代器的实例。*

这是UML图 [![迭代器模式](https://i.stack.imgur.com/EzZMm.png)](https://i.stack.imgur.com/EzZMm.png)

所以基本上在 c# 中，IEnumerable 是抽象聚合，IEnumerator 是抽象迭代器。IEnumerable 有一个方法 GetEnumerator，它负责创建所需类型的 IEnumerator 实例。Lists 之类的集合实现了 IEnumerable。

例子。假设我们有一个`getPermutations(inputString)`返回字符串所有排列的方法，并且该方法返回一个`IEnumerable<string>`

为了计算排列的数量，我们可以执行以下操作。

```
 int count = 0;
        var permutations = perm.getPermutations(inputString);
        foreach (string permutation in permutations)
        {
            count++;
        } 
```

c# 编译器或多或少将上述内容转换为

```
using (var permutationIterator = perm.getPermutations(input).GetEnumerator())
        {
            while (permutationIterator.MoveNext())
            {
                count++;
            }
        } 
```

如果您有任何问题，请随时提问。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-04-28T18:19:10.367

一个小的贡献。

正如他们中的许多人解释“何时使用”和“与 foreach 一起使用”。我想在这里添加另一个**州差异**，作为关于 IEnumerable 和 IEnumerator 之间差异的问题。

我根据以下讨论线程创建了以下代码示例。

[IEnumerable，IEnumerator vs foreach，什么时候用](https://stackoverflow.com/questions/1085638/ienumerable-ienumerator-vs-foreach-when-to-use-what) [IEnumerator和IEnumerable有什么区别？](https://stackoverflow.com/questions/619564/what-is-the-difference-between-ienumerator-and-ienumerable)

Enumerator 保留函数调用之间的状态（迭代位置），而 Enumerable 则不保留迭代。

这是经过测试的示例，带有要理解的注释。

**请专家补充/纠正我。**

```
static void EnumerableVsEnumeratorStateTest()
{
    IList<int> numList = new List<int>();

    numList.Add(1);
    numList.Add(2);
    numList.Add(3);
    numList.Add(4);
    numList.Add(5);
    numList.Add(6);

    Console.WriteLine("Using Enumerator - Remembers the state");
    IterateFrom1to3(numList.GetEnumerator());

    Console.WriteLine("Using Enumerable - Does not Remembers the state");
    IterateFrom1to3Eb(numList);

    Console.WriteLine("Using Enumerable - 2nd functions start from the item 1 in the collection");
}

static void IterateFrom1to3(IEnumerator<int> numColl)
{
    while (numColl.MoveNext())
    {
        Console.WriteLine(numColl.Current.ToString());

        if (numColl.Current > 3)
        {
            // This method called 3 times for 3 items (4,5,6) in the collection. 
            // It remembers the state and displays the continued values.
            IterateFrom3to6(numColl);
        }
    }
}

static void IterateFrom3to6(IEnumerator<int> numColl)
{
    while (numColl.MoveNext())
    {
        Console.WriteLine(numColl.Current.ToString());
    }
}

static void IterateFrom1to3Eb(IEnumerable<int> numColl)
{
    foreach (int num in numColl)
    {
        Console.WriteLine(num.ToString());

        if (num>= 5)
        {
            // The below method invokes for the last 2 items.
            //Since it doesnot persists the state it will displays entire collection 2 times.
            IterateFrom3to6Eb(numColl);
        }
    }
}

static void IterateFrom3to6Eb(IEnumerable<int> numColl)
{
    Console.WriteLine();
    foreach (int num in numColl)
    {
        Console.WriteLine(num.ToString());
    }
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-07-27T08:53:10.780

我注意到了这些差异：

A. 我们以不同的方式迭代列表，foreach 可用于 IEnumerable，while 循环可用于 IEnumerator。

B. 当我们从一种方法传递到另一种方法时，IEnumerator 可以记住当前索引（它开始使用当前索引）但 IEnumerable 不记得索引并且它将索引重置为开始。此视频中的更多内容[https://www.youtube.com/watch?v=jd3yUjGc9M0](https://www.youtube.com/watch?v=jd3yUjGc9M0)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-04-12T23:52:59.543

`IEnumerable`两者`IEnumerator`都是 C# 中的接口。

`IEnumerable`是一个接口，它定义了一个`GetEnumerator()`返回`IEnumerator`接口的方法。

`IEnumerable`这适用于对实现可与`foreach`语句一起使用的集合的只读访问。

`IEnumerator`有两种方法，`MoveNext`和`Reset`。它还有一个名为`Current`.

下面展示了 IEnumerable 和 IEnumerator 的实现。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-11-02T18:28:37.523

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Enudemo
{

    class Person
    {
        string name = "";
        int roll;

        public Person(string name, int roll)
        {
            this.name = name;
            this.roll = roll;
        }

        public override string ToString()
        {
            return string.Format("Name : " + name + "\t Roll : " + roll);
        }

    }

    class Demo : IEnumerable
    {
        ArrayList list1 = new ArrayList();

        public Demo()
        {
            list1.Add(new Person("Shahriar", 332));
            list1.Add(new Person("Sujon", 333));
            list1.Add(new Person("Sumona", 334));
            list1.Add(new Person("Shakil", 335));
            list1.Add(new Person("Shruti", 336));
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
           return list1.GetEnumerator();
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            Demo d = new Demo();  // Notice here. it is simple object but for 
                                //IEnumerator you can get the collection data

            foreach (Person X in d)
            {
                Console.WriteLine(X);
            }

            Console.ReadKey();
        }
    }
}
/*
Output : 

Name : Shahriar  Roll : 332
Name : Sujon     Roll : 333
Name : Sumona    Roll : 334
Name : Shakil    Roll : 335
Name : Shruti    Roll : 336
  */ 
```

# .net - 在表单之间传递连接对象的最佳方式？

> ID：558308
> 
> 赞同：0
> 
> 时间：2009-02-17T19:12:47.220
> 
> 标签：.net, sql-server, vb.net, security

背景：我正在将使用 MS Access 进行数据存储的 VB6 应用程序重写为使用 VB.NET 和 MS SQL Server 的应用程序。

我很好奇在我的应用程序中需要连接到数据库的不同表单之间传递连接的最佳方式。现在我已经建立了一个类来管理连接字符串以安全的方式在表单之间传递：

```
公共类登录凭据
    私有 unname 作为字符串
    私有密码哈希（）作为字节 = {0}
    Private server_name As String '未用于访问样式数据库
    私有数据库名作为字符串
    Private st As ServerType '允许不同连接的枚举
    Private tdes As TripleDES '加密类来加密内存中的密码

    公共子新（）
        unname = ""
        server_name = ""
        数据库名 = ""
        st = ServerType.stNotDefined
    结束子
    Public Sub New(ByVal 用户名作为字符串，_
                   ByVal 密码为字符串，_
                   ByVal ServerName 作为字符串，_
                   ByVal 数据库名称作为字符串，_
                   ByVal ServType 作为 ServerType)
        tdes = 新的 TripleDES
        uname = 用户名
        password_hash = tdes.Encrypt(密码)
        server_name = 服务器名
        dbname = 数据库名称
        st = 服务类型
       tdes = 没有
    结束子

    公共只读属性 Server_Type() As ServerType
        得到
            回程
        结束获取
    结束属性
    公共只读属性 CompanyName() 作为字符串
        得到
            返回 dbname.Remove(0, 4)
        结束获取
    结束属性
    公共属性 UserName() 作为字符串
        得到
            返回名称
        结束获取
        设置（ByVal 值作为字符串）
            unname = 值
        结束集
    结束属性
    公共属性密码（）作为字符串
        得到
            tdes = 新的 TripleDES
            返回 tdes.Decrypt(password_hash)
            tdes = 没有
        结束获取
        设置（ByVal 值作为字符串）
            tdes = 新的 TripleDES
            password_hash = tdes.Encrypt(值)
            tdes = 没有
        结束集
    结束属性
    公共属性 ServerName() 作为字符串
        得到
            返回 server_name
        结束获取
        设置（ByVal 值作为字符串）
            server_name = 值
        结束集
    结束属性
    公共属性 DatabaseName() 作为字符串
        得到
            返回数据库名
        结束获取
        设置（ByVal 值作为字符串）
            数据库名称 = 值
        结束集
    结束属性

    公共函数 GetConnectionString() 作为字符串
        暗淡 cstring As String = ""
        tdes = 新的 TripleDES
        选择案例
            案例服务器类型.stSQLServer
                cstring = "用户 ID=" & uname & ";" &_
                        "密码=" & tdes.Decrypt(password_hash) & ";" &_
                        "初始目录=" & dbname & ";" &_
                        “数据源=”& server_name
        结束选择
        tdes = 没有
        返回字符串
    结束功能
结束类
```

我一直在将我的对象的引用传递给我需要连接到数据库的任何表单，如下所示：

```
'在表格声明中
私有 myLC​​ 作为 LoginCredentials
Public Sub New(ByRef lc As LoginCredentials)
    初始化组件（）
    myLC = lc
结束子
```

然后我会创建一个新的连接对象，做我需要做的，然后关闭连接并销毁连接对象。当我不久前在 ADO 中使用 VB6 完成此操作时，连接创建的进程在连接对象被销毁时被终止，但情况似乎不再如此。现在每次我创建一个新的连接对象并连接到我的服务器时，都会创建一个新进程，然后在我关闭连接时进入睡眠状态。一段时间后，服务器将开始拒绝连接，直到我登录并终止我的应用程序创建的所有进程。显然这不是正确的，我想学习正确的方法。

在我的表单中通过引用（或在包装类中）简单地传递相同的连接对象，让连接对象保持打开状态会更好吗？

关闭连接的正确方法是什么，以便我最终不会在我的 SQL 服务器上获得一堆睡眠进程？SQL Server 中是否有一个设置可以调整为在一段时间不活动后自动终止进程？

您会考虑在运行时内存中加密密码过大吗？

感谢您的任何帮助。:)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-17T19:20:20.743

您***不应该***在表单之间传递连接对象。基本上，使用与 SQL Server 的连接时的模式是创建连接，打开它，执行您的操作，然后关闭连接。

为此，您应该在某处有一个公共静态方法，该方法将生成您将在 Using 语句中使用的 SqlConnection，如下所示：

```
Using connection As SqlConnection = GetConnection
    ' Use connection here.

End Using 
```

这应该可以防止进程在服务器上堆积。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:21:03.737

您可以使用 Using 语句，它会在完成后关闭并处理连接。

```
Using _conn as New SqlConnection(<connstring>)
  _conn.Open()
  'get your data'

End Using 
```

如果你不打电话`.Close()`，那可能是问题所在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T19:30:40.297

我同意卡斯珀的观点。例如，如果您确实需要在页面之间共享对象以减少负载，那么您可以使用静态成员变量来执行此操作。只需确保在执行最后一条语句时关闭连接。您还可以创建一个可以在最后一个事务完成时释放的连接范围。如果您没有这样做的经验，那么只需尽早打开和关闭您的连接，不要传递它。

我有一个 Web 应用程序，为了减少一些延迟，在某些情况下我使用我为 DAL 创建的范围，这样如果子函数中有调用，它们可以使用相同的连接而不是提升到 MSDTC。然而，这实际上只在事务系统中是必需的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T03:31:59.937

由于您使用的是 VB.NET，请尝试以下操作（代码来自内存，而不是从应用程序复制）：

```
Namespace Helpers

Public NotInheritable Class Connections

    Private Sub New()

    End Sub

    Public Shared Function GetConnection(ByVal connString As String) As SqlConnection
        Dim c as New SqlConnection(connString)
        c.Open
        Return c
    End Sub

    Public Shared Sub AdoCleanup(cn As SqlConnection, cmd As SqlCommand)
        cmd.Dispose
        cn.Close
    End Sub

End Class

End Namespace 
```

然后像这样使用它：

```
Private Sub LoadMyData()

    Dim connString As String = <your conn string>
    Dim cn As SqlConnection = Helpers.Connections.GetConnection(connString)
    Dim cmd As New SqlCommand

    Try
        ' data access code
    Catch ex As Exception
        ' handle exception
    Finally
        Helpers.Connections.AdoCleanup(cn, cmd)
    End Try

End Sub 
```

您甚至可以将获取连接字符串的代码放入 GetConnection，除非您需要灵活地打开具有不同连接字符串的多个连接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-08-09T03:36:00.857

永远不要通过连接。

我通常做的，我创建一个主控制器，每个控制器都从它继承，我在那边的连接上定义。然后当我每次启动我使用（使用）的连接对象时。

# wpf - WPF 使用自定义 RoutedUICommands 还是简单的事件处理程序？

> ID：558311
> 
> 赞同：5
> 
> 时间：2009-02-17T19:13:23.490
> 
> 标签：wpf, xaml, routed-commands

今天我正在和某人谈论如何选择一种设计模式来处理他们的 WPF 程序中的逻辑，并希望 SO 社区可以提供进一步的建议以使决策更容易。**哪些因素有利于命令胜过不便？**

我准备了一个完整的[示例](http://www.aussiedesignedsoftware.com/files/WPFDispatchDemoSrc.zip)以及三种方法中前两种的一些[UML 图：](http://aussiedesignedsoftware.com/blog/?p=51)

1.  在按钮和菜单上使用 Click 事件处理程序。
2.  使用 XAML 中绑定的命令。
3.  使用代码中绑定的命令，并为纯 GUI 布局和样式保留 XAML。

他参加的入门课程和许多书籍都将简单的 Click 事件处理程序作为将逻辑连接到 UI 对象的自然方式。

他对使用命令所需的开销量感到有些震惊，而命令是在代码隐藏文件中创建的：

```
public static readonly ICommand cmdShow2 = new RoutedUICommand(
  "Show Window2", "cmdShow2", 
  typeof(TestDespatchWindow)); 
```

然后是 XAML 中的更多代码，必须以冗长的方式识别和绑定命令：

```
<Window x:Class="WPFDispatchDemo.TestDespatchWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:w="clr-namespace:WPFDispatchDemo"..>

    <Window.CommandBindings>
      <CommandBinding Command="{x:Static w:TestDespatchWindow.cmdShow2}"
        Executed="OnShow2" />
    </Window.CommandBindings>
      <DockPanel>
        <StackPanel Margin="0,8,0,0">
          <Button x:Name="Show2EventBased" 
                  Margin="10,2,10,2" 
                  Click="OnShow2" 
                  Content="Show2 via WPF Event"/>
          <Button x:Name="Show2Command" 
                  Command="{x:Static w:TestDespatchWindow.cmdShow2}"
                  Margin="10,2,10,2" 
                  Content="Show2 via WPF"/>
        </StackPanel>
    </DockPanel>
  </Window> 
```

我（还）不能声称自己是 WPF 专家，所以我可能把事情画得比实际更复杂，但我怀疑你不能比上面更简单地简化事情。

**编辑：**

我在 DelegateCommand、RoutedCommand 和 Event 之间发现了一个有趣的[3 路比较。](http://mikestedman.blogspot.com/2008/11/delegatecommand-vs-routedcommand-vs.html)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T09:04:25.863

掌握它们的优缺点，你要根据自己的情况来选择，我强烈建议你根据具体情况做出选择，不要为整个项目选择“一成不变的方式”。

在某些情况下，发送者和接收者之间的分离以及仅使用 XAML 发送命令的能力是一个很大的优势（作为一个很好的示例，请查看 ScrollBar 控件模板如何与[http://msdn.microsoft.com/en上的控制逻辑进行通信-us/library/ms742173.aspx](http://msdn.microsoft.com/en-us/library/ms742173.aspx)）。

在其他情况下，命令可以将原本是 2 行的事件处理程序变成一些不可能遵循的怪物，涉及更改应用程序中的 4 个不同位置（[ViewModel 应该如何关闭表单？](https://stackoverflow.com/questions/501886)）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T19:42:10.190

唯一的原因是要熟悉命令注册表。意味着事件可能是私有方法，我觉得它们与窗口的代码紧密结合。同时，Commands 提供了将实现（事件）和定义（命令）分开的能力，你甚至可以使用另一个类（看看 ApplicationCommands）。

此外，当我做我的 WPF 工作时，我使用 ICommand([命令模式](http://en.wikipedia.org/wiki/Command_pattern)) 的实现。该命令的所有逻辑都转到 Execute 方法。这有助于我以更结构化的方式保持逻辑分离，而不会过度复杂化窗口代码。使用此选项，您可以在模型上创建命令，从而在没有噪音的情况下绑定它们。看一看。

创建模型。

```
public class Model
{
  ICommand CloseMessagePopupCommand {get; set;}
} 
```

然后分配数据上下文

```
public MainWindow()
{

  this.DataContext = new Model();
} 
```

并使用以下 XAML 代码。

```
<Button 
    Command="{Binding CloseMessagePopupCommand}"
    Content="{StaticResource Misc.Ok}" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T03:12:24.057

在开发 WPF 应用程序时，我尝试忠实于 Mike 在开发 WPF 应用程序时提到的命令模式，并结合使用了 Andy 的 #2 和 #3 方法。

在我看来，我只能想到命令的一个缺点：只有某些 UI 元素的某些操作会调用命令。解决此问题的一种方法是让您的事件处理程序在命令上调用 Execute 方法。我认为命令提供了一种非常好的封装执行逻辑的方法。如果您维护一大块 UI 并使用 MVC/MVC/MVVM 模式实现它，这将变得非常明显。

我鼓励您查看 Dan Crevier 关于[DataModel-View-ViewModel](http://blogs.msdn.com/dancre/archive/2006/10/11/datamodel-view-viewmodel-pattern-series.aspx)模式的系列，特别是关于命令和封装命令的部分。即使这种模式不能满足您的需求，它也很好地概述了如何将逻辑封装在一个单独的类中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T08:01:01.583

ICommand 的其他变体似乎是实现复杂命令结构的流行方式。

Brian Noyes 在他[关于 PRISM 的文章中](http://www.code-magazine.com/article.aspx?quickid=0811041)说

*WPF 中的路由命令非常强大和有用，但是在应用于复合应用程序时它们存在一些缺点。首先是它们与可视树完全耦合——调用者必须是可视树的一部分，并且命令绑定必须通过可视树绑定。...第二个缺点是它们与UI的焦点树紧密相关，*并继续谈论CAL（Prism）包含的DelegateCommand和CompositeCommand。

# jsf - G4jsf 是否仍在开发/支持？

> ID：558312
> 
> 赞同：2
> 
> 时间：2009-02-17T19:13:47.857
> 
> 标签：jsf, gwt, richfaces

我一直在评估不同的 Java Web 应用程序 UI 框架。我有大约 8 个月的密集[JSF](http://en.wikipedia.org/wiki/JavaServer_Faces)经验，我想继续使用。JSF 还为我提供了蜘蛛可读的标记以及无需接触太多 Java 代码即可创建非常简单的表单的能力。

我还需要在服务器往返次数很少的情况下运行良好的胖客户端接口。[GWT](http://en.wikipedia.org/wiki/Google_Web_Toolkit)似乎是一个理想的选择。

所以，当我找到[G4jsf](https://ajax4jsf.dev.java.net/nonav/ajax/gwt/gwt-cdk.html)时，我以为我找到了两全其美的东西。但是，我似乎找不到任何积极的发展。我希望它没有死，但似乎就是这样。

这方面有积极的发展吗？还是我晚了两年？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T01:05:30.873

好吧，根据下面参考中的对话，似乎不再支持 G4jsf。如果海报实际上是谢尔盖·斯米尔诺夫，我想他会是一个非常可靠的消息来源。:)

[http://www.jboss.org/index.html?module=bb&op=viewtopic&t=150674](http://www.jboss.org/index.html?module=bb&op=viewtopic&t=150674)

# asp.net - ASP.NET Webforms 中的异常处理

> ID：558314
> 
> 赞同：10
> 
> 时间：2009-02-17T19:13:59.807
> 
> 标签：asp.net, exception-handling, webforms

在 ASP.NET Webforms 中处理异常的首选方法是什么？

您有在 web.config 级别添加（我认为）的 Page_Error 方法，当发生错误时，整个站点都会被重定向到那里。

这是否意味着您不应该在 webforms 应用程序的任何地方使用 try-catch ？（假设您不想隐藏任何错误）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-17T19:17:35.697

只捕获您可以处理的错误。如果您可以以允许页面继续加载的方式处理它们，那么就这样做。任何其他会破坏页面的异常都不应该在任何控件或页面中处理，因为无论如何您都无法执行任何操作。让它转到 global.asax 处理程序并确保记录异常。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T19:22:19.663

除了 Andrew 的建议之外，请确保更新 web.config 文件以将 CustomErrors 设置为“On”，并指定一个通用错误页面来重定向这些顶级错误。Global_asax 仍然会记录错误，然后用户可以看到一个友好的页面。它还允许您配置一些标准类型的错误，例如 404 和 200，以及更多。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-14T11:14:01.187

*   Web 应用程序通常由 UI、业务和数据访问层组成。每一层都必须在异常处理方面发挥作用。每个层都必须（为了代码重用性）检查错误条件并包装异常（在记录它之后），并可能传播到调用层。UI 层应该隐藏异常并显示友好的消息。在 UI 中捕获所有异常可能不是一个好主意。如果可能，应将异常记录在数据库中。这将便于维护和纠正错误

*   尽可能避免捕获异常。在使用它们之前尝试并验证所有输入。在验证控件、自定义控件和正则表达式的帮助下严格验证（客户端和服务器端）输入是必须的。

    ```
    string fname = "abc";
    //Always check for condition, like file exists etc...
    if (System.IO.File.Exists(fname))
    {

    }
    else
    {

    } 
    ```

*   始终确保调用了清理代码。使用语句或最后尝试。

*   您可以在 Global.asax（asp.net 应用程序文件）中捕获所有异常

    ```
    void Application_Error(object sender, EventArgs e) 
    { 
        // Code that runs when an unhandled error occurs
        Exception objErr = Server.GetLastError().GetBaseException();
        string err = "Error Caught in Application_Error event\n" +
           "Error in: " + Request.Url.ToString() +
           "\nError Message:" + objErr.Message.ToString()+ 
           "\nStack Trace:" + objErr.StackTrace.ToString();
        EventLog.WriteEntry("Sample_WebApp",err,EventLogEntryType.Error);
        Server.ClearError();
        //additional actions...

    } 
    ```

并在您的网络配置中添加`<customerror>`部分以将用户重定向到单独的页面

```
 <customErrors defaultRedirect="error.htm" mode="On">
    </customErrors> 
```

*   有用的链接

    [MSDN](http://msdn.microsoft.com/en-us/library/seyhszts(VS.71).aspx)

    [MSDN](http://msdn.microsoft.com/en-us/library/8ey5ey87(VS.71).aspx)

    [异常记录 - Peter Bromberg](http://www.eggheadcafe.com/articles/20060531.asp)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T19:20:34.550

你应该在可以对错误做一些有意义的事情的地方使用 try/catch，比如修复它或采取不同的方法。

对于所有其他情况，您应该使用全局 try/catch 使用 web.config 自定义错误页面或 Application_Error 事件来记录错误并可能将其显示给用户。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T19:22:31.440

如果您在后面的代码中使用验证控件或检查和验证用户输入，这将大大有助于防止错误。我确实建议有一个可以为您记录错误的通用错误页面。如果您不确定会发生什么，我建议尽可能捕捉错误并处理它，并努力寻找一种方法来知道您将要运行的内容在执行之前会起作用。

您是否有一个特定的示例来说明您可能会在哪里遇到此类错误。我知道的一个是会话到期并且您无法再处理该页面。在运行其他任何内容之前，我会在每次页面加载时检查这一点，然后在发生这种情况时重定向用户。

# c# - 使用 c# 从 id 集合中获取 4 个（或任何计数）随机唯一 id 的最简单方法是什么？

> ID：558315
> 
> 赞同：1
> 
> 时间：2009-02-17T19:14:18.557
> 
> 标签：c#, asp.net, generics, c#-3.0

假设您有一个 idCollection`IList<long>`并且您有一个获取 4 个唯一 ID 的方法。每次调用它时，它都会给您随机的 4 个唯一 ID？

```
var idCollec = new[] {1,2,3,4,5,6,7,8,9,10,11,12}.ToList();

For example {2,6,11,12}
            {3,4,7,8}
            {5,8,10,12}
            ...
            .. 
```

最聪明的方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T19:46:37.030

似乎最简单的方法是拥有类似的东西：

```
if(idCollection.Count <4)
{
    throw new ArgumentException("Source array not long enough");
}
List<long> FourUniqueIds = new List<long>(4);
while(FourUniqueIds.Count <4)
{
    long temp = idCollection[random.Next(idCollection.Count)];
    if(!FourUniqueIds.Contains(temp))
    {
        FourUniqueIds.add(temp);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T19:46:22.847

它可以通过一个不错的 LINQ 查询来完成。避免重复的关键是创建一个永无止境的 IEnumerable 随机整数。然后您可以从中获取 n 个不同的值，并将它们用作列表中的索引。

示例程序：

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace TestRandom
{
    class Program
{
    static void Main(string[] args)
    {
        // Just to prepopulate a list.
        var ids = (from n in Enumerable.Range(0, 100)
                   select (long)rand.Next(0, 1000)).ToList();

        // Example usage of the GetRandomSet method.
        foreach(long id in GetRandomSet(ids, 4))
            Console.WriteLine(id);
    }

    // Get count random entries from the list.
    public static IEnumerable<long> GetRandomSet(IList<long> ids, int count)
    {
        // Can't get more than there is in the list.
        if ( count > ids.Count)
            count = ids.Count;

        return RandomIntegers(0, ids.Count)
            .Distinct()
            .Take(count)
            .Select(index => ids[index]);
    }

    private static IEnumerable<int> RandomIntegers(int min, int max)
    {
        while (true)
            yield return rand.Next(min, max);
    }

    private static readonly Random rand = new Random();
} 
```

}

如果您使用这种方法，请确保您不要尝试采用比传递给 RandomIntegers 的范围内的可用值更多的不同值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T20:14:19.847

洗牌然后每次只拿前四个怎么样？

```
public static IEnumerable<T> Shuffle<T>(this IEnumerable<T> e)
{
    var r = new Random();
    return e.OrderBy(x => r.Next());
} 
```

然后是这样的？使用 for 循环而不是 Take 和 except 可能会更快。

```
 var ordered = new List<int> {1, 2, 3, 4, 5, 6, 7, 8, 10};

 var random = ordered.Shuffle();
 while(random.Count() > 0)
 {
     var ourSet = random.Take(4).ToList();            
     random = random.Except(ourSet);
 } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T19:23:07.787

如果 IList`<long>`填充了非唯一值，则可以将 LINQ 的 Distinct() 与 Take() 结合使用，如果它已经具有唯一值，则只需使用 Take()。

```
List<long> myUniqueIds = //prepoulation
var first4UniqueUnused = myUniqueIds.Take(4);

var next4UniqueUnused = myUniqueIds.Where(l=>!first4UniqueUnused.Contains(l)).Take(4); 
```

另一种太容易的方式，我认为我们已经让它太难了：

```
List<long> myIDs = //prepopulation;
List<long> my4Random = new List<long>();
Random r = new Random();

for(int i=0; i< 4; i++)
{
     int j = r.Next();
     while(j>myIDs.Count || my4Random.Contains(myIDs[j]))
          j = r.Next();

     my4Random.Add(myIDs[j]);
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-17T19:24:12.043

```
Random random = new Random(); 

long firstOne = idCollection[random.Next(idCollection.Count)];
long secondOne = idCollection[random.NExt(idCollection.Count)]; 
```

...等等

# sql - 我如何将这个包含多个子选择的 SQL 压缩成更理智的东西？

> ID：558316
> 
> 赞同：0
> 
> 时间：2009-02-17T19:14:40.727
> 
> 标签：sql, mysql

以下查询根据需要返回单行。“合同”表有 6 个字段，每个字段都有不同的用户名，我想从单独的“用户”表中检索名字/姓氏。这很好用，但是还有更简洁的吗？我认为解决方案必须是使用 GROUP BYcontracts.id 来保持一行，但我似乎找不到比这一系列子选择更好的东西了。

帮助！

```
SELECT contracts.field1, contracts.field2, 
(SELECT first_name FROM users WHERE username = service_provider_1),
(SELECT last_name FROM users WHERE username = service_provider_1),
(SELECT first_name FROM users WHERE username = service_provider_2),
(SELECT last_name FROM users WHERE username = service_provider_2),
(SELECT first_name FROM users WHERE username = service_org_business_contact),
(SELECT last_name FROM users WHERE username = service_org_business_contact),
(SELECT first_name FROM users WHERE username = client_service_contact_1),
(SELECT last_name FROM users WHERE username = client_service_contact_1),
(SELECT first_name FROM users WHERE username = client_service_contact_2),
(SELECT last_name FROM users WHERE username = client_service_contact_2),
(SELECT first_name FROM users WHERE username = client_business_contact),
(SELECT last_name FROM users WHERE username = client_business_contact)
FROM contracts
WHERE id = ? 
```

*如果我可以从单个子选择中同时*获得名字/姓氏，那就不会那么糟糕了......所以即使使用粗糙的子选择解决方案，我的冗长程度也是我认为我需要的两倍......

编辑：我现在明白了。能够多次加入同一个表的答案是使用表的别名。谢谢各位！新代码是：

```
SELECT contracts.field1, contracts.field2, 
sp1.first_name, sp1.last_name, 
sp2.first_name, sp2.last_name, 
sobc.first_name, sobc.last_name, 
csc1.first_name, csc1.last_name, 
csc2.first_name, csc2.last_name, 
cbc.first_name, cbc.last_name
FROM contracts
JOIN users AS sp1 ON service_provider_1 = sp1.username
JOIN users AS sp2 ON service_provider_2 = sp2.username
JOIN users AS sobc ON service_org_business_contact = sobc.username
JOIN users AS csc1 ON client_service_contact_1 = csc1.username
JOIN users AS csc2 ON client_service_contact_2 = csc2.username
JOIN users AS cbc ON client_business_contact = cbc.username
WHERE contracts.id = ? 
```

可悲的是，使用连接几乎和使用子选择一样冗长，但我认为它可能更快？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T19:19:27.673

为什么不加入用户表 6 次？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T19:23:45.040

```
SELECT contracts.field1, contracts.field2, 
sp1.first_name,
sp1.last_name 
sp2.first_name,
sp2.last_name,
/* etc, etc */
FROM
contracts
INNER JOIN
users sp1
ON
contracts.id = sp1.id
AND sp1.username = service_provider_1
INNER JOIN 
users sp2
ON contracts.id = sp2.id
AND sp2.username = service_provider_2
INNER JOIN 
users sobc
ON contracts.id = sobc.id
AND sobc.username = service_org_business_contact
INNER JOIN
/* etc, etc */
WHERE contracts.id = @myid 
```

您是否还想为每个用户名组合`first_name`和？`last_name`你可以这样做

```
RTRIM(sp1.first_name) + ' ' + RTRIM(sp1.last_name) as sp1_name 
```

在您的 SELECT 子句中。如果数据类型是 (N)CHAR，则 RTRIM 是必需的，如果类型是 (N)VARCHAR，则不需要

**编辑：如**[对此答案](https://stackoverflow.com/questions/558316/how-do-i-condense-this-sql-of-multiple-sub-selects-into-something-more-sane/558333#558333)的评论中所述，可能不需要 JOIN id ，在这种情况下它变成

```
SELECT 
contracts.field1, 
contracts.field2, 
sp1.first_name,
sp1.last_name 
sp2.first_name,
sp2.last_name,
/* etc, etc */
FROM
contracts
INNER JOIN
users sp1
ON
sp1.username = service_provider_1
INNER JOIN 
users sp2
ON
sp2.username = service_provider_2
INNER JOIN 
users sobc
ON 
sobc.username = service_org_business_contact
INNER JOIN
/* etc, etc */
WHERE contracts.id = @myid 
```

我的布局可能使它看起来更长！如果用户表中的某个字段可能没有`first_name`和，则您可能需要使用 LEFT OUTER JOINS 。`last_name`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T19:39:26.920

```
select 
 c.field1,c.field2
,SP1.first_name ,SP1.last_name
,SP2.first_name ,SP2.last_name
,SOBC.first_name,SOBC.last_name
,CSC1.first_name,CSC1.last_name
,CSC2.first_name,CSC2.last_name
,CBC.first_name ,CBC.last_name
from contracts C
left join users as SP1  on SP1.Username  = C.service_provider_1 
left join users as SP2  on SP2.Username  = C.service_provider_2 
left join users as SOBC on SOBC.Username = C.service_org_business_contact 
left join users as CSC1 on SP1.Username  = C.client_service_contact_1 
left join users as CSC2 on SP1.Username  = C.client_service_contact_2 
left join users as CBC  on CBC.Username  = C.client_business_contact 

where c.ID = ? 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T19:32:21.463

我不禁认为，将名称与名称类型的列一起推送到单独的表中可能是一个好主意。

编辑：或者在合同和用户之间有另一个连接表来正确地进行多对多连接。

# web-applications - 安全文件交换

> ID：558330
> 
> 赞同：2
> 
> 时间：2009-02-17T19:18:18.300
> 
> 标签：web-applications, security

我想在我公司的 Linux 机器上设置一个 Web 应用程序，以便与我们的客户进行安全的文件交换。我正在寻找一个支持这些功能的开源应用程序，最好是拥有大量用户群：

*   通过 HTTPS 工作（所以 SFTP 或其他类似的解决方案是不可能的）
*   允许用户使用我们提前提供的凭据上传文件
*   这样上传的文件只有在使用相同帐户（或管理员帐户）时才可见
*   允许管理员将文件上传到用户帐户以供用户下载（这不一定必须通过 webapp 发生）
*   （可选）它应该在用户上传新文件时提供电子邮件通知
*   （可选）它应该确保自动清理上传的文件，最好是在上传者可以设置的一段时间后

我花了一些时间在谷歌和堆栈溢出上搜索这样的应用程序，但我还没有发现任何令人信服的东西。也许这里有人知道这样的事情并且可以帮助我指针？提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T19:20:30.367

[WebDAV](http://www.webdav.org/)怎么样？这是[subversion](http://subversion.tigris.org/)用来通过 HTTPS 同步文件的方法。这是[开源 WebDAV 项目的列表](http://www.webdav.org/projects/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-25T12:35:13.397

解决方案可以是 F*EX，参见[http://fex.rus.uni-stuttgart.de/](http://fex.rus.uni-stuttgart.de/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-04T23:02:49.980

你也许可以用 Bugzilla 廉价地组装一些东西，也许需要仔细重新设计。将其设置为客户端创建的票证是私有的，仅对他们自己和管理员组可见。要将文件发送到客户端，您将创建一个仅对正确组可见的新票证并将文件附加到它。您几乎可以免费获得电子邮件接口，并且您可能会发现您可以自动过期旧的“票证”。

# linq-to-sql - LINQ to SQL，在 db.SubmitChanges() 上失败

> ID：558335
> 
> 赞同：1
> 
> 时间：2009-02-17T19:19:29.123
> 
> 标签：linq-to-sql, exception, insert-update

我在尝试更新时遇到异常，Insert 工作得很好。所以这是： System.Data.Linq.dll 中出现“System.InvalidCastException”类型的第一次机会异常另一个提示......可以插入一个表中首先然后更新另一个表，最后在同一个代码块中提交更改（）？我也评论 InsertOnSubmit(); 我重建 dbml（删除并再次创建）更改了名称、上下文等。代码：

```
using (DB db = new DB())
            {
                //db.ObjectTrackingEnabled = false;
                INFORMEMEDICO varInf = (from i in db.INFORMEMEDICOs
                                        where i.numeroinforme == codigo
                                        select i).SingleOrDefault();

                EXAMENXATENCION varExA = (from ea in db.EXAMENXATENCIONs
                                          where ea.codigo == codigo
                                          select ea).Single();

                if (varInf == null)
                {
                    varInf = new INFORMEMEDICO();
                    varInf.firmauno = getJPGFromImageControl(firmaUno.Source as BitmapImage);
                    varInf.firmados = getJPGFromImageControl(firmaDos.Source as BitmapImage);
                    varInf.tecnica = GetText(rtbTec);
                    varExA.estadoestudio = 'I';                    
                    try
                    {
                        db.SubmitChanges(System.Data.Linq.ConflictMode.ContinueOnConflict);
                        //db.INFORMEMEDICOs.InsertOnSubmit(varInf);
                        MessageBox.Show("Informe Medico Registrado con exito: " + "\n" + "Nro Informe :" + codigo);
                    }
                    catch (Exception ex)
                    {
                        sucessfull = 0;
                        MessageBox.Show("Error en Registro : " + ex.Message);
                    }

                } 
```

堆 ：

```
System.InvalidCastException was caught
  Message="No se puede convertir un objeto de tipo 'System.Int32' al tipo 'System.String'."
  Source="System.Data.Linq"
  StackTrace:
       en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
       en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
       en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
       en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
       en System.Data.Linq.IdentityManager.StandardIdentityManager.IdentityCache`2.Find(Object[] keyValues)
       en System.Data.Linq.IdentityManager.StandardIdentityManager.Find(MetaType type, Object[] keyValues)
       en System.Data.Linq.CommonDataServices.GetCachedObject(MetaType type, Object[] keyValues)
       en System.Data.Linq.ChangeProcessor.GetOtherItem(MetaAssociation assoc, Object instance)
       en System.Data.Linq.ChangeProcessor.BuildEdgeMaps()
       en System.Data.Linq.ChangeProcessor.SubmitChanges(ConflictMode failureMode)
       en System.Data.Linq.DataContext.SubmitChanges(ConflictMode failureMode)
       en System.Data.Linq.DataContext.SubmitChanges()
       en Demo.View.InformeMedico.btnGuardar_Click(Object sender, RoutedEventArgs e) en D:\cs_InformeMedico\app\InformeMedico.xaml.cs:línea 433
  InnerException: 
```

感谢您一直以来的支持

XML：

```
<?xml version="1.0" encoding="utf-8"?>
<ordesignerObjectsDiagram dslVersion="1.0.0.0" absoluteBounds="0, 0, 11.625, 14" name="DataClasses1">
  <DataContextMoniker Name="/DB" />
  <nestedChildShapes>
    <classShape Id="578a0699-bcf4-45c5-9bec-2beb667a6a06" absoluteBounds="5.75, 1.25, 2, 3.23266845703125">
      <DataClassMoniker Name="/DB/EXAMENXATENCION" />
      <nestedChildShapes>
        <elementListCompartment Id="10f26c82-1f06-45d2-9488-da3d7d92e231" absoluteBounds="5.7650000000000006, 1.71, 1.9700000000000002, 2.67266845703125" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <classShape Id="1f3a6a96-bcc1-41c3-8d57-b9987a3cdec1" absoluteBounds="2.625, 2.875, 2, 1.4248478190104168">
      <DataClassMoniker Name="/DB/ESTUDIO" />
      <nestedChildShapes>
        <elementListCompartment Id="86092ab5-554b-402d-a8cf-938b89f4473e" absoluteBounds="2.64, 3.335, 1.9700000000000002, 0.86484781901041674" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <associationConnector edgePoints="[(4.625 : 3.58742390950521); (5.75 : 3.58742390950521)]" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/ESTUDIO/ESTUDIO_EXAMENXATENCION" />
      <nodes>
        <classShapeMoniker Id="1f3a6a96-bcc1-41c3-8d57-b9987a3cdec1" />
        <classShapeMoniker Id="578a0699-bcf4-45c5-9bec-2beb667a6a06" />
      </nodes>
    </associationConnector>
    <classShape Id="e4ab888d-5eb4-4b81-a562-baa1ff7393f8" absoluteBounds="7.875, 5.625, 2, 2.5752791341145831">
      <DataClassMoniker Name="/DB/PACIENTE" />
      <nestedChildShapes>
        <elementListCompartment Id="239b98aa-995d-458c-b0e6-4211e108c99d" absoluteBounds="7.8900000000000006, 6.085, 1.9700000000000002, 2.015279134114583" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <classShape Id="516b8633-e8ba-43f7-bf23-8c18e055e9b4" absoluteBounds="1.625, 5, 2, 2.9039737955729166">
      <DataClassMoniker Name="/DB/ATENCION" />
      <nestedChildShapes>
        <elementListCompartment Id="c3ec622f-93e5-4418-bb4d-7903b46ac639" absoluteBounds="1.6400000000000001, 5.46, 1.9700000000000002, 2.3439737955729165" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <associationConnector edgePoints="[(3.625 : 6.24307135546875); (4.07291666666667 : 6.24307135546875 : JumpStart); (4.23958333333333 : 6.24307135546875 : JumpEnd); (7.21875 : 6.24307135546875); (7.21875 : 4.48266845703125)]" manuallyRouted="true" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/ATENCION/ATENCION_EXAMENXATENCION" />
      <nodes>
        <classShapeMoniker Id="516b8633-e8ba-43f7-bf23-8c18e055e9b4" />
        <classShapeMoniker Id="578a0699-bcf4-45c5-9bec-2beb667a6a06" />
      </nodes>
    </associationConnector>
    <associationConnector edgePoints="[(7.875 : 7.5486477109375); (4.23958333333333 : 7.5486477109375 : JumpStart); (4.07291666666667 : 7.5486477109375 : JumpEnd); (3.625 : 7.5486477109375)]" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/PACIENTE/PACIENTE_ATENCION" />
      <nodes>
        <classShapeMoniker Id="e4ab888d-5eb4-4b81-a562-baa1ff7393f8" />
        <classShapeMoniker Id="516b8633-e8ba-43f7-bf23-8c18e055e9b4" />
      </nodes>
    </associationConnector>
    <classShape Id="f479daef-94e3-451a-b060-f4644304ec8c" absoluteBounds="0.5, 0.5, 2, 2.4109318033854166">
      <DataClassMoniker Name="/DB/MEDICOEXTERNO" />
      <nestedChildShapes>
        <elementListCompartment Id="964d649c-c39e-48c6-b130-215c40080462" absoluteBounds="0.515, 0.96, 1.9700000000000002, 1.8509318033854165" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <associationConnector edgePoints="[(2.0625 : 2.91093180338542); (2.0625 : 5)]" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/MEDICOEXTERNO/MEDICOEXTERNO_ATENCION" />
      <nodes>
        <classShapeMoniker Id="f479daef-94e3-451a-b060-f4644304ec8c" />
        <classShapeMoniker Id="516b8633-e8ba-43f7-bf23-8c18e055e9b4" />
      </nodes>
    </associationConnector>
    <classShape Id="5ce0ebb2-391e-46de-b85c-c6a50434ea12" absoluteBounds="3.125, 0.5, 2, 1.26050048828125">
      <DataClassMoniker Name="/DB/FIRMA" />
      <nestedChildShapes>
        <elementListCompartment Id="a21918ee-6f48-470d-9f0e-a9160faab27e" absoluteBounds="3.1399999999999997, 0.96, 1.9700000000000002, 0.70050048828125" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <classShape Id="8080f6a7-cd0f-4e38-a667-8aa34c40969e" absoluteBounds="5.375, 9, 2, 1.9178898111979166">
      <DataClassMoniker Name="/DB/PLANTILLA" />
      <nestedChildShapes>
        <elementListCompartment Id="b6606488-da97-4a5c-9204-1c1874f1fb29" absoluteBounds="5.39, 9.46, 1.9700000000000002, 1.3578898111979165" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <classShape Id="2ecb0a31-9312-4243-9d5a-dcecc886146c" absoluteBounds="1.375, 8.875, 2, 1.75354248046875">
      <DataClassMoniker Name="/DB/EQUIPO" />
      <nestedChildShapes>
        <elementListCompartment Id="b72b559d-fea0-4615-a2ac-08b4dc715230" absoluteBounds="1.3900000000000001, 9.335, 1.9700000000000002, 1.19354248046875" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <associationConnector edgePoints="[(3.375 : 8.90625); (4.07291666666667 : 8.90625 : JumpStart); (4.23958333333333 : 8.90625 : JumpEnd); (7.59375 : 8.90625); (7.59375 : 4.48266845703125)]" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/EQUIPO/EQUIPO_EXAMENXATENCION" />
      <nodes>
        <classShapeMoniker Id="2ecb0a31-9312-4243-9d5a-dcecc886146c" />
        <classShapeMoniker Id="578a0699-bcf4-45c5-9bec-2beb667a6a06" />
      </nodes>
    </associationConnector>
    <classShape Id="8a332fc0-58f9-4d58-ae99-d84b9ef09d01" absoluteBounds="9.375, 10.5, 2, 3.23266845703125">
      <DataClassMoniker Name="/DB/INFORMEMEDICO" />
      <nestedChildShapes>
        <elementListCompartment Id="2696f44c-b32e-4a93-b012-c19292012a86" absoluteBounds="9.39, 10.96, 1.9700000000000002, 2.67266845703125" name="DataPropertiesCompartment" titleTextColor="Black" itemTextColor="Black" />
      </nestedChildShapes>
    </classShape>
    <associationConnector edgePoints="[(9.625 : 8.20027913411458); (9.625 : 10.5)]" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/PACIENTE/PACIENTE_INFORMEMEDICO" />
      <nodes>
        <classShapeMoniker Id="e4ab888d-5eb4-4b81-a562-baa1ff7393f8" />
        <classShapeMoniker Id="8a332fc0-58f9-4d58-ae99-d84b9ef09d01" />
      </nodes>
    </associationConnector>
    <associationConnector edgePoints="[(4.15625 : 4.29984781901042); (4.15625 : 12.3565291341146); (9.375 : 12.3565291341146)]" fixedFrom="NotFixed" fixedTo="NotFixed">
      <AssociationMoniker Name="/DB/ESTUDIO/ESTUDIO_INFORMEMEDICO" />
      <nodes>
        <classShapeMoniker Id="1f3a6a96-bcc1-41c3-8d57-b9987a3cdec1" />
        <classShapeMoniker Id="8a332fc0-58f9-4d58-ae99-d84b9ef09d01" />
      </nodes>
    </associationConnector>
  </nestedChildShapes>
</ordesignerObjectsDiagram> 
```

XML : 哦哦 :)

```
<?xml version="1.0" encoding="utf-8"?>
<Database Name="DATABASEGENERAL" EntityNamespace="Demo.View.Data" ContextNamespace="Demo.View" Class="DB" xmlns="http://schemas.microsoft.com/linqtosql/dbml/2007">
  <Connection Mode="AppSettings" ConnectionString="Data Source=192.168.0.3;Initial Catalog=DATABASEGENERAL;Integrated Security=True" SettingsObjectName="SRIMedico.Properties.Settings" SettingsPropertyName="DATABASEGENERALConnectionString1" Provider="System.Data.SqlClient" />
  <Table Name="dbo.EXAMENXATENCION" Member="EXAMENXATENCIONs">
    <Type Name="EXAMENXATENCION">
      <Column Name="codigo" Type="System.Int32" DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true" IsDbGenerated="true" CanBeNull="false" />
      <Column Name="numeroatencion" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigopaciente" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="numerocita" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigocompaniaseguro" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="ruc" Type="System.String" DbType="Char(11) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigoequipo" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="horaatencion" Type="System.DateTime" DbType="DateTime NOT NULL" CanBeNull="false" />
      <Column Name="codigoestudio" Type="System.String" DbType="Char(12) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigoclase" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigomodalidad" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigounidad" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="estadoestudio" Type="System.Char" DbType="Char(1) NOT NULL" CanBeNull="false" />
      <Column Name="prioridad" Type="System.String" DbType="VarChar(20) NOT NULL" CanBeNull="false" />
      <Column Name="turnomedico" Type="System.String" DbType="Char(5)" CanBeNull="true" />
      <Association Name="ATENCION_EXAMENXATENCION" Member="ATENCION" ThisKey="numeroatencion,codigopaciente,codigomodalidad,codigounidad,codigocompaniaseguro,ruc,numerocita" OtherKey="numeroatencion,codigopaciente,codigomodalidad,codigounidad,codigocompaniaseguro,ruc,numerocita" Type="ATENCION" IsForeignKey="true" />
      <Association Name="EQUIPO_EXAMENXATENCION" Member="EQUIPO" ThisKey="codigoequipo" OtherKey="codigoequipo" Type="EQUIPO" IsForeignKey="true" />
      <Association Name="ESTUDIO_EXAMENXATENCION" Member="ESTUDIO" ThisKey="codigoestudio,codigoclase" OtherKey="codigoestudio,codigoclase" Type="ESTUDIO" IsForeignKey="true" />
    </Type>
  </Table>
  <Table Name="dbo.ATENCION" Member="ATENCIONs">
    <Type Name="ATENCION">
      <Column Name="fechayhora" Type="System.DateTime" DbType="DateTime NOT NULL" CanBeNull="false" />
      <Column Name="numeroatencion" Type="System.Int32" DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true" IsDbGenerated="true" CanBeNull="false" />
      <Column Name="codigopaciente" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="cmp" Type="System.String" DbType="Char(6) NOT NULL" CanBeNull="false" />
      <Column Name="codigocompaniaseguro" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="ruc" Type="System.String" DbType="Char(11) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="numerocita" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigomodalidad" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigounidad" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="peso" Type="System.Int32" DbType="Int NOT NULL" CanBeNull="false" />
      <Column Name="talla" Type="System.Single" DbType="Real NOT NULL" CanBeNull="false" />
      <Column Name="edad" Type="System.Int32" DbType="Int NOT NULL" CanBeNull="false" />
      <Column Name="codigousuario" Type="System.String" DbType="VarChar(20) NOT NULL" CanBeNull="false" />
      <Association Name="ATENCION_EXAMENXATENCION" Member="EXAMENXATENCIONs" ThisKey="numeroatencion,codigopaciente,codigomodalidad,codigounidad,codigocompaniaseguro,ruc,numerocita" OtherKey="numeroatencion,codigopaciente,codigomodalidad,codigounidad,codigocompaniaseguro,ruc,numerocita" Type="EXAMENXATENCION" />
      <Association Name="PACIENTE_ATENCION" Member="PACIENTE" ThisKey="codigopaciente" OtherKey="codigopaciente" Type="PACIENTE" IsForeignKey="true" />
      <Association Name="MEDICOEXTERNO_ATENCION" Member="MEDICOEXTERNO" ThisKey="cmp" OtherKey="cmp" Type="MEDICOEXTERNO" IsForeignKey="true" />
    </Type>
  </Table>
  <Table Name="dbo.INFORMEMEDICO" Member="INFORMEMEDICOs">
    <Type Name="INFORMEMEDICO">
      <Column Name="numeroinforme" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigoestudio" Type="System.String" DbType="Char(12) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="turnosocio" Type="System.String" DbType="Char(5) NOT NULL" CanBeNull="false" />
      <Column Name="fechainforme" Type="System.DateTime" DbType="DateTime NOT NULL" CanBeNull="false" />
      <Column Name="horainforme" Type="System.DateTime" DbType="DateTime NOT NULL" CanBeNull="false" />
      <Column Name="tecnica" Type="System.String" DbType="VarChar(3000) NOT NULL" CanBeNull="false" />
      <Column Name="hallazgo" Type="System.String" DbType="VarChar(5000) NOT NULL" CanBeNull="false" />
      <Column Name="conclusion" Type="System.String" DbType="VarChar(3000) NOT NULL" CanBeNull="false" />
      <Column Name="impreso" Type="System.Boolean" DbType="Bit NOT NULL" CanBeNull="false" />
      <Column Name="codigoclase" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigopaciente" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="medicoinforma" Type="System.String" DbType="Char(5) NOT NULL" CanBeNull="false" />
      <Column Name="firmados" Type="System.Data.Linq.Binary" DbType="Image" CanBeNull="true" UpdateCheck="Never" />
      <Column Name="firmauno" Type="System.Data.Linq.Binary" DbType="Image" CanBeNull="true" UpdateCheck="Never" />
      <Column Name="nombreinforme" Type="System.String" DbType="VarChar(150) NOT NULL" CanBeNull="false" />
      <Association Name="ESTUDIO_INFORMEMEDICO" Member="ESTUDIO" ThisKey="codigoestudio,codigoclase" OtherKey="codigoestudio,codigoclase" Type="ESTUDIO" IsForeignKey="true" />
      <Association Name="PACIENTE_INFORMEMEDICO" Member="PACIENTE" ThisKey="codigopaciente" OtherKey="codigopaciente" Type="PACIENTE" IsForeignKey="true" />
    </Type>
  </Table>
  <Table Name="dbo.EQUIPO" Member="EQUIPOs">
    <Type Name="EQUIPO">
      <Column Name="fechaadquirio" Type="System.DateTime" DbType="DateTime NOT NULL" CanBeNull="false" />
      <Column Name="intensidad" Type="System.Single" DbType="Real NOT NULL" CanBeNull="false" />
      <Column Name="modelo" Type="System.String" DbType="VarChar(40)" CanBeNull="true" />
      <Column Name="marca" Type="System.String" DbType="VarChar(40) NOT NULL" CanBeNull="false" />
      <Column Name="nombreequipo" Type="System.String" DbType="VarChar(35) NOT NULL" CanBeNull="false" />
      <Column Name="codigoequipo" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Association Name="EQUIPO_EXAMENXATENCION" Member="EXAMENXATENCIONs" ThisKey="codigoequipo" OtherKey="codigoequipo" Type="EXAMENXATENCION" />
    </Type>
  </Table>
  <Table Name="dbo.ESTUDIO" Member="ESTUDIOs">
    <Type Name="ESTUDIO">
      <Column Name="nombreestudio" Type="System.String" DbType="VarChar(100) NOT NULL" CanBeNull="false" />
      <Column Name="codigoestudio" Type="System.String" DbType="Char(12) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigoclase" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="indicacion" Type="System.String" DbType="VarChar(500)" CanBeNull="true" />
      <Association Name="ESTUDIO_EXAMENXATENCION" Member="EXAMENXATENCIONs" ThisKey="codigoestudio,codigoclase" OtherKey="codigoestudio,codigoclase" Type="EXAMENXATENCION" />
      <Association Name="ESTUDIO_INFORMEMEDICO" Member="INFORMEMEDICOs" ThisKey="codigoestudio,codigoclase" OtherKey="codigoestudio,codigoclase" Type="INFORMEMEDICO" />
    </Type>
  </Table>
  <Table Name="dbo.PACIENTE" Member="PACIENTEs">
    <Type Name="PACIENTE">
      <Column Name="nacionalidad" Type="System.String" DbType="VarChar(20) NOT NULL" CanBeNull="false" />
      <Column Name="direccion" Type="System.String" DbType="VarChar(80)" CanBeNull="true" />
      <Column Name="email" Type="System.String" DbType="VarChar(60)" CanBeNull="true" />
      <Column Name="celular" Type="System.String" DbType="VarChar(20)" CanBeNull="true" />
      <Column Name="telefono" Type="System.String" DbType="VarChar(20) NOT NULL" CanBeNull="false" />
      <Column Name="fechanace" Type="System.DateTime" DbType="DateTime NOT NULL" CanBeNull="false" />
      <Column Name="sexo" Type="System.Char" DbType="Char(1) NOT NULL" CanBeNull="false" />
      <Column Name="nombres" Type="System.String" DbType="VarChar(35) NOT NULL" CanBeNull="false" />
      <Column Name="apellidos" Type="System.String" DbType="VarChar(45) NOT NULL" CanBeNull="false" />
      <Column Name="dni" Type="System.String" DbType="VarChar(20)" CanBeNull="true" />
      <Column Name="codigopaciente" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Association Name="PACIENTE_ATENCION" Member="ATENCIONs" ThisKey="codigopaciente" OtherKey="codigopaciente" Type="ATENCION" />
      <Association Name="PACIENTE_INFORMEMEDICO" Member="INFORMEMEDICOs" ThisKey="codigopaciente" OtherKey="codigopaciente" Type="INFORMEMEDICO" />
    </Type>
  </Table>
  <Table Name="dbo.MEDICOEXTERNO" Member="MEDICOEXTERNOs">
    <Type Name="MEDICOEXTERNO">
      <Column Name="cmp" Type="System.String" DbType="Char(6) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="apellidos" Type="System.String" DbType="VarChar(45) NOT NULL" CanBeNull="false" />
      <Column Name="nombres" Type="System.String" DbType="VarChar(35) NOT NULL" CanBeNull="false" />
      <Column Name="telefono" Type="System.String" DbType="VarChar(20)" CanBeNull="true" />
      <Column Name="direccion" Type="System.String" DbType="VarChar(80)" CanBeNull="true" />
      <Column Name="email" Type="System.String" DbType="VarChar(60)" CanBeNull="true" />
      <Column Name="fechanacio" Type="System.DateTime" DbType="DateTime" CanBeNull="true" />
      <Column Name="codigoespecialidad" Type="System.Int32" DbType="Int" CanBeNull="true" />
      <Column Name="activo" Type="System.Boolean" DbType="Bit NOT NULL" CanBeNull="false" />
      <Column Name="celular" Type="System.String" DbType="VarChar(20)" CanBeNull="true" />
      <Association Name="MEDICOEXTERNO_ATENCION" Member="ATENCIONs" ThisKey="cmp" OtherKey="cmp" Type="ATENCION" />
    </Type>
  </Table>
  <Table Name="dbo.PLANTILLA" Member="PLANTILLAs">
    <Type Name="PLANTILLA">
      <Column Name="codigoplantilla" Type="System.Int32" DbType="Int NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="codigoequipo" Type="System.Int32" DbType="Int NOT NULL" CanBeNull="false" />
      <Column Name="codigoestudio" Type="System.String" DbType="Char(12) NOT NULL" CanBeNull="false" />
      <Column Name="tituloplantilla" Type="System.String" DbType="VarChar(150) NOT NULL" CanBeNull="false" />
      <Column Name="tecnica" Type="System.String" DbType="VarChar(3000) NOT NULL" CanBeNull="false" />
      <Column Name="hallazgo" Type="System.String" DbType="VarChar(5000) NOT NULL" CanBeNull="false" />
      <Column Name="conclusion" Type="System.String" DbType="VarChar(3000) NOT NULL" CanBeNull="false" />
    </Type>
  </Table>
  <Table Name="dbo.FIRMA" Member="FIRMAs">
    <Type Name="FIRMA">
      <Column Name="codigofirma" Type="System.String" DbType="VarChar(20) NOT NULL" IsPrimaryKey="true" CanBeNull="false" />
      <Column Name="siglas" Type="System.String" DbType="Char(5) NOT NULL" CanBeNull="false" />
      <Column Name="imagen" Type="System.Data.Linq.Binary" DbType="Image NOT NULL" CanBeNull="false" UpdateCheck="Never" />
    </Type>
  </Table>
</Database> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T21:23:37.293

看起来您的数据库架构与您的 DBML 不匹配。仔细检查您的属性类型和属性是否匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T21:49:23.207

表中的`estadoestudio`字段`EXAMENXATENCION`是 VarChar(1) 吗？如果是这样，LINQ to SQL 设计器已将此解释为 Char 字段，请将 DBML 设计器或基础 XML 中的列编辑为`System.String`而不是`System.Char`. 如果该字段可以为空，因为您不能有空字符，我也建议您在 LINQ to SQL 中表示的任何其他 VarChar(1) 字段使用此方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T22:43:37.367

解决方案：

打开一个新项目，添加新的 Linq2SQL 模型，然后复制并粘贴 XML 和 Designer.cs 文件，在此行重命名：

```
public DB() :
            base(global::SRIMedico.Properties.Settings.Default.DATABASEGENERALConnectionString, mappingSource)
        {
            OnCreated();
        } 
```

其中 SRIMedico 将是您的默认命名空间...而 DATABASEGENERALConnectionString 将是您的 ConnectionString 名称..

希望有所帮助

# .net - ClickOnce appref.ms 参数

> ID：558344
> 
> 赞同：4
> 
> 时间：2009-02-17T19:21:19.213
> 
> 标签：.net, clickonce

我有一个在线或离线可用的 ClickOnce 应用程序。该程序接受一个参数。在线时，我在 URL 上传递参数，如“url?argument”，效果很好。离线我使用应用程序的开始菜单链接启动一个进程。

是否可以通过此链接将参数传递给我的应用程序？我想我可以以某种方式计算出应用程序文件的位置，但是还有其他选择吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-06-24T12:46:46.570

我可以通过将应用程序引用为“%userprofile%\Desktop\Your Shortcut Name Here.appref-ms”来实现这一点

然后，要传递参数，将它们作为一个单一的无空间实体传递，如下所示：arg1,arg2,arg3

整个事情在命令行上看起来像这样：

```
"%userprofile%\Desktop\Your Shortcut Name Here.appref-ms" arg1,arg2,arg3 
```

然后在您的代码中，使用

```
AppDomain.CurrentDomain.SetupInformation.ActivationArguments.ActivationData[0] 
```

检索参数。

我昨天刚刚写了一篇博客：http: [//www.developingfor.net/net/processing-command-line-arguments-in-an-offline-clickonce-application.html](http://www.developingfor.net/net/processing-command-line-arguments-in-an-offline-clickonce-application.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-08T20:49:06.503

您可以将参数传递给离线 ClickOnce 应用程序。我只是设置一个指向 ClickOnce 快捷方式的快捷方式，并在最后添加参数。[单击此处](http://robindotnet.wordpress.com/2010/03/21/how-to-pass-arguments-to-an-offline-clickonce-application/)查看有关如何为离线 ClickOnce 应用程序传递和处理参数的文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T06:41:17.720

不，您不能从“开始”菜单快捷方式传递参数。如果您找到方法，请告诉我，因为我已经尝试了很长时间:)。

以下是我在我的情况下解决问题的方法......

如果[ActivationUri](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.activationuri.aspx)属性*不*为空，则应用程序是从浏览器启动的，并通过查询字符串传递参数（就像您描述的那样）。

如果 ActivationUri*为*空，则应用程序是从开始菜单启动的。在这些情况下，我从与应用程序一起部署的配置文件中获取参数。

你的论点传递了什么类型的信息？这对于确定如何存储参数（app.config、应用程序设置、用户设置、隔离存储等）很有用

**旁注**
我认为我通过使我的应用程序“单个实例”并尝试处理 StartupNextInstance 应用程序事件来完成一些事情，但没有运气。您只能通过这种方式获取传统的命令行参数，而不是 ClickOnce 查询字符串参数。

# database - 在 Web 应用程序中的何处存储数据库凭据？

> ID：558360
> 
> 赞同：17
> 
> 时间：2009-02-17T19:24:31.123
> 
> 标签：database, security, web-applications, credentials

我想知道您使用什么技术来存储应用程序的数据库凭据。我特别关心java webapps，但我认为没有必要将问题限制在这个范围内。

需要考虑的事情：
您是否使用属性文件、xml 配置等？
它是捆绑到您的应用程序中（即在 jar 文件中）还是单独存储在某个文件系统中？
密码是否加密？如果是这样，您使用什么加密方案？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T19:33:29.167

由于您将问题留给平台，我将添加 .NET 应用程序的数据库凭据存储在 web.config 文件中。从 2.0 及更高版本开始，有一个特定的 ConnectionStrings 部分允许更轻松地以编程方式访问连接字符串。

除了默认情况下 IIS 自动阻止对 web.config 文件的直接请求之外，您还可以使用 IIS 命令来加密 web.config 文件的 ConnectionString 部分。这种加密是特定于机器的，增加了它的优势，当你访问它时，.NET 运行时也会动态解密连接字符串，所以你的应用程序不需要额外的编码来使用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T19:29:14.107

使用 Java，数据库连接池应该由容器传递到 webapps。这是在 WEB-INF/web.xml 中可声明为资源的标准。这同样适用于邮件会话和其他可能因安装而异的外部资源。查找 JNDI 以获取更多信息）

这样做的好处是应用程序并不关心如何实际连接到外部的任何东西。它不会看到任何密码，因为容器本身会使用它们。

在 tomcat 中，这可以从 conf/Catalina/localhost/ 、 conf/server.xml 中的上下文文件（例如）配置，或者 - 最好仅用于开发环境，从 webapps META-INF/context.xml 配置。其他环境有自己的配置位置或应用程序。

密码的加密实际上取决于容器。Tomcat 以明文形式存储它们，但应用程序本身不会看到它。我不知道其他环境中的机制。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T19:39:45.593

在 Microsoft 堆栈上，事情可能非常好。

您在 Active Directory 中创建一个几乎没有权限的网络用户帐户。您将 IIS 配置为以该用户身份运行您的 webapp。您授予该用户对磁盘上的 Web 文件夹和文件的读取权限。您将 SQL Server 配置为授予该用户对所需表的读/写权限。在连接字符串中，您指示 db 客户端以当前运行 webapp 的用户帐户进行连接。

只有一个实际的用户帐户，尽管它在多个地方都可见。此用户帐户的权限极其有限。即使加密，也不会在任何地方存储密码。无需在代码中进行任何配置即可使其正常工作（这一切都在设置权限中）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T19:29:32.390

取决于应用服务器。

我通常使用 JNDI 查找数据源，因此凭据存储在处理连接池的应用服务器上。除了 JNDI 名称之外，无需以这种方式在配置中添加任何内容。

是的，密码在 WebLogic 上已加密。

在 Tomcat 上，事情可能很冒险。连接信息在 META-INF/context.xml 中，表示密码的纯文本。我这样做只是为了开发，从不在生产中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T19:40:23.313

在 Django 中，凭据在您的`settings.py`配置文件中。由于这通常不会保存在您的`/var/www/`目录树中，因此非常安全。

此外，单个 Django 应用程序可以用于（和重用）同一主机上的许多网站或 Web 服务器，每个网站或 Web 服务器都有自己不同的设置。因此`settings.py`配置不与应用程序捆绑在一起，而是应用程序的单个部署的一部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T19:58:00.417

对于 asp.net：

我将全局参数（例如连接字符串和存储库路径）存储在注册表中，然后在 web.config 中存储对注册表条目的引用。

主要原因是我经常发现我必须编写一个独立的可执行文件来运行需要访问相同参数的后台任务和其他自动化功能。因此，将真正全球化的所有东西都放在一个易于访问的地方可以让生活更轻松。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-10-14T06:13:00.693

其中哪些是保存 Web 应用程序数据库凭据的好地方？在源代码的单独文件中 在 Web 服务器主机上的单独文件中 在数据库中 无。永远不应存储数据库凭据

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-05-01T10:29:32.840

如前所述，没有指定平台，并使用早期答案中的一些想法：

我正在考虑一个容器化的应用程序。您可以将数据库的密码存储在容器中的文件中。您的应用程序的第一步是建立数据库连接，甚至在侦听 Web 请求之前。数据库连接成功后，带有凭据的文件将被删除，包含这些凭据的变量也将被删除。因此，当您开始为请求提供服务时，唯一剩下的就是从此刻开始使用的开放数据库句柄。如果由于任何原因数据库连接丢失，您只需退出并等待重新启动容器，凭证文件将再次出现。

# .net - 错误消息“无法安装或运行应用程序。应用程序需要 GAC 中的 stdole 版本 7.0.3300.0”

> ID：558361
> 
> 赞同：56
> 
> 时间：2009-02-17T19:24:58.017
> 
> 标签：.net, clickonce, gac, stdole

当一个用户尝试运行应用程序时，我们的 ClickOnce 应用程序会报告：

> 无法安装或运行应用程序。该应用程序需要 GAC 中的 stdole 版本 7.0.3300.0。

有趣的是，[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache) (C:\Windows\assembly) 中没有安装 stdole。我怎么把它弄到那里？

我们使用的是 .NET 3.5，它已安装在这台计算机上。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-02-17T19:42:26.850

尝试转到项目属性中的“*发布*”选项卡，然后选择“*应用程序文件”*按钮。然后设置以下属性：

*   *stdole.dll 的*文件名**
**   *发布状态*以*包含**   *将组下载*到*必需**

 *之后，您需要重新发布您的应用程序。

如果引用的 CopyLocal=true，则引用将随应用程序一起发布。如果引用的 CopyLocal=false，则该引用将被标记为先决条件。这意味着在安装 ClickOnce 应用程序之前，必须将程序集安装在客户端的 GAC 中。

由于 Visual Studio 安装而不是 .NET Framework 安装，一些程序集安装到 GAC 中。这可能是你的情况。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-18T15:32:38.940

所以事实证明 .NET 文件被复制到`C:\Program Files\Microsoft.NET\Primary Interop Assemblies\`. 但是，它们从未在[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache)中注册。

我最终手动将文件拖入其中`C:\Program Files\Microsoft.NET\Primary Interop Assemblies`，`C:\windows\assembly`并且该应用程序在该问题机器上运行。您也可以使用[Gacutil](http://msdn.microsoft.com/en-us/library/ex0ss12c%28v=vs.110%29.aspx)以编程方式执行此操作。

因此，在安装过程中 .NET 似乎发生了一些事情，但这似乎可以解决问题。我希望这可以帮助别人！

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-09-30T21:41:33.037

我的情况是，我解决了这个问题，转到**项目属性中的“****发布**”选项卡，然后选择“**应用程序文件”**按钮。然后只是：

 ******注意：** *在应用此解决方案之前，请确保您已经（像我一样）检查了您解决方案的所有项目，并且没有发现对**stdole.dll**程序集的引用。*

1 - 位于**stdole.dll**文件；

2 - 将其**发布状态**更改为**排除**

3 - 之后，您需要**重新发布您的应用程序**。

从 Visual Studio 2010 迁移后，此问题发生在 Visual Studio 2012 上。

希望能帮助到你。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-17T19:44:15.880

我在 ClickOnce 部署中遇到了同样的问题。

我通过转到项目属性中的“发布”选项卡，然后选择“应用程序文件”按钮解决了这个问题。

然后我选择了以下选项：

*   “stdole.dll”的“文件名”
*   “发布状态”到“包括”和
*   “下载组”为“必需”。

这解决了我重新发布时的问题。

我希望这对你有帮助：D

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-04-29T16:00:04.203

我们在使用与 Microsoft Office 互操作的 ClickOnce 应用程序时遇到了同样的问题。它只发生在公司的几台电脑上。

我们发现的最佳解决方案是修改有问题的计算机上的 MS Office 安装（通过“*程序和功能*”面板）并确保“.NET 可编程性功能”（不确定组件的名称 - 我们的 Microsoft_Office 版本不是英文）为每个 MS Office 应用程序（Excel、Word、Outlook 等）安装。这似乎不包含在默认安装中。

然后解决了 stdole.dll 的问题。

我希望这可能会有所帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-01T22:49:26.697

好吧，您不能使用 ClickOnce 安装到 GAC。这在[此 MSDN 文章](http://msdn.microsoft.com/en-us/library/142dbbz4.aspx)中有记录。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-08T19:57:03.393

我的解决方案：我在解决方案资源管理器中打开了引用文件夹（显示所有文件），并且对于安装抱怨的每个程序集（程序集的名称可能与程序集的文件名不完全相同 - 在对象资源管理器中，但是很容易弄清楚），我将*Copy Local*更改为*True*。我最终需要对每个与 Microsoft Office/ [COM](http://en.wikipedia.org/wiki/Component_Object_Model)相关的程序集执行此操作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T15:04:39.027

检查您是否真的在使用 EnvDTE 参考。如果没有，请将其删除并重新编译。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-19T15:19:59.423

有趣的是，我的项目中没有对 stdole 的任何引用，但我仍然有一个用户收到错误。我必须添加参考，然后将设置更改为包含。希望这会奏效。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-03-29T06:26:26.463

对于 H2oRider——您的应用程序是否访问 GAC 中的 Oracle dll？我建议您这样做：将 dll 添加到您的项目中并将构建操作设置为“内容”并将“复制到输出目录”设置为“始终复制”。

然后删除您对 GAC 中 dll 的引用。重新添加引用，但这次深入到您刚刚添加到项目中的引用。

现在发布它。应用程序将在本地查找 dll，并且 dll 包含在部署中，因此它会找到它。

如果这不起作用，那么如果包含在本地而不是 GAC 中，则可能无法使用该 dll。这适用于某些程序集，例如 Office PIA。在这种情况下，部署它的唯一方法是将其包装在设置和部署包中，并使用 Bootstrapper Manifest Generator 将其转换为您可以使用 ClickOnce 部署发布的先决条件。

# c++ - 在 gdb 中跟踪对类实例/内存范围的写访问

> ID：558366
> 
> 赞同：6
> 
> 时间：2009-02-17T19:25:48.017
> 
> 标签：c++, debugging, gdb, trace

我正在尝试调试我在 C++ 大学课程中编写的小型操作系统。在运行时，我的某个对象之一正在损坏。这似乎是由于意外写入错误的内存地址而发生的。由于我无法通过纯粹查看代码来找到发生这种情况的地方，因此我需要另一种方法。

由于这是一个操作系统，我无法将 valgrind 之类的工具附加到它，但我可以在附加了 gdb 的模拟器（bochs/qemu）中运行它。

gdb 中有没有办法跟踪对类实例或更一般的特定内存范围的写访问？我想在写访问发生时立即中断，这样我就可以验证这是否有效。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T19:36:17.193

您可以放置​​一个观察点：

```
watch x 
```

这将在`x`修改时中断。 `x`可以是任何类型的变量。如果你有：

```
class A;
A x; 
```

然后，只要 x 被修改，gdb 就会中断。

您实际上可以在任何表达式上放置一个观察点，当表达式更改时 gdb 将中断。不过要小心这一点，因为如果表达式不是底层硬件支持的东西，gdb 将不得不在每条指令之后评估它，这会导致糟糕的性能。例如，如果`A`上面是一个有很多成员的类，那么 gdb**可以**监视整个实例`x`，但它的工作方式是：

*   执行指令
*   跳转到调试断点
*   检查是否`x`已更改
*   返回程序

自然，这是**非常**缓慢的。If `x`is an `int`then gdb 可以使用硬件断点。

如果您有特定的内存地址，您也可以查看它：

```
watch *0x1234 
```

当 [0x1234] 的内容发生变化时，这将中断。

您还可以使用`rwatch`, 或`awatch`设置读/写断点来设置读断点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:52:51.483

如果您至少知道它发生的大致位置，您也可以只使用“显示”而不是观察并手动逐行逐行直到您看到更改发生的时间。使用“watch”查看地址实在是太慢了。

# c - 如何从 C 中的字符串解析令牌？

> ID：558368
> 
> 赞同：4
> 
> 时间：2009-02-17T19:26:00.590
> 
> 标签：c, string, tokenize

我如何从输入字符串中解析标记。例如：

```
char *aString = "Hello world". 
```

我希望输出为：

> “你好世界”

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T19:27:27.123

您将要使用`strtok`-[这是一个很好的例子。](http://www.java2s.com/Code/C/String/Truncatestringbydelimiterhowtousestrtok.htm)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T19:26:51.383

看看[strtok](http://www.opengroup.org/onlinepubs/000095399/functions/strtok.html)，标准库的一部分。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-17T22:09:54.250

`strtok`是一个简单的答案，但你真正需要的是一个能够正确执行它的词法分析器。考虑以下：

*   “hello”和“world”之间是否有一两个空格？
*   这实际上可以是任何数量的空格吗？
*   可以包括垂直空格（\n、\f、\v）还是只包括水平空格（\s、\t、\r）？
*   可以包含任何 UNICODE 空白字符吗？
*   如果单词之间有标点符号（“hello, world”），标点符号是单独的标记，是“hello”的一部分，还是被忽略？

如您所见，编写一个合适的词法分析器并不简单，`strtok`也不是一个合适的词法分析器。

其他解决方案可能是精确执行您需要的单字符状态机，或者是基于正则表达式的解决方案，可以使定位单词与间隙更加通用。有很多方法。

当然，这一切都取决于你的实际需求是什么，我不知道，所以从`strtok`. 但最好了解各种限制。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T19:39:53.363

对于可重入版本，您可以使用 [strtok_s for visual studio](http://msdn.microsoft.com/en-us/library/ftsafwz3.aspx)或[strtok_r for unix](http://www.mkssoftware.com/docs/man3/strtok_r.3.asp)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T20:22:01.560

请记住，strtok**很难**正确处理，因为：

*   它修改输入
*   分隔符替换为空终止符
*   合并相邻的分隔符，当然，
*   不是线程安全的。

您可以阅读有关此[替代方案](http://groups.google.co.in/group/comp.lang.c/msg/ae19c3d96edd5297)的信息。

# c# - 您是否为域模型中的每个公共类定义了一个接口？优点和缺点？

> ID：558379
> 
> 赞同：4
> 
> 时间：2009-02-17T19:28:47.603
> 
> 标签：c#, interface, dependencies, loose-coupling

您是否为域模型中的每个公共类实现了一个接口？优点和缺点？

更新：如果 Repositories 接口和域模型类在单独的程序集中定义，如果我们不为每个域类定义接口，就不会有循环依赖。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-17T19:31:17.473

不。

缺点。

1.  噪声代码。
2.  更多要写。
3.  雅尼。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T19:39:15.407

您应该为层之间的依赖关系定义接口，而不是为每个类定义接口。因此，您的服务层应该依赖于存储库接口，而您的表示层应该依赖于服务接口。除此之外，没有太多硬性规定，除了在有意义的地方使用它们。

常识是任何优秀设计的重要组成部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T19:53:22.737

通过为类在特定情况下所扮演的角色命名，可以使用接口使代码更具表现力。一个类可能扮演多个角色。例如，当人与猫交互时，猫可能有一个宠物接口，而当鼠标与猫交互时，猫可能有一个捕食者接口。

您可能会发现[Mock Roles，而不是 Objects](http://www.jmock.org/oopsla2004.pdf)是相关且有趣的读物。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T19:31:04.260

不，只连接你当时需要的东西。如果你想得太早，你的代码将变得复杂和不可维护。过一会儿，程序员就会放弃接口，因为它太难遍历所有接口来弄清楚需要什么。为了做而做的任何事情都会导致灾难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T19:31:26.147

从我的角度来看，这是矫枉过正。只是我的2美分...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T19:33:27.887

不，我不这样做......如果目前没有必要，你为什么要这样做？

如果将来它应该变成必要的（那些“应该”表明它是 YAGNI），您可以执行“提取接口”重构。
（现代 IDE 使得这样做非常容易）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T19:38:19.343

我可能会在我的下一个 Asp.Net 项目中这样做。

我的原因是我们在当前项目中需要在某个地方存储一些与 UI 相关的额外状态。如果我们为域模型类使用了接口，我们可以在用户控制代码中对实体类进行子类化，并用我们自己的具有额外状态的类替换。

我知道，这似乎有点脏。我希望有一些类似于 Java 的 Seam 框架和对话机制的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T19:40:16.810

这取决于项目的类型。如果您正在编写一个将被大量重用的 API（例如 Sharepoint API 包装器），我会更倾向于这样做。

对于其他不会被大量重用的项目，默认情况下，我不会强调每个公共类都有一个接口。相反，我会专注于使用精心设计的界面链接层。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T19:49:46.600

从不变性的角度来看，您可能会考虑将接口放在域对象上：

在代码中的大多数地方，您都希望您的对象是不可变的，这样您就可以保证它们不会被更改 - 在这种情况下，您将使用某种返回接口的数据访问对象，确保您的域对象无法更改。

如果您正在编写某种管理页面，用户最终将在其中编辑域对象，则您需要公开设置器 - 您的数据访问对象将需要返回“MutableDomainObject”实例（类或子接口）。

话虽如此，我同意上面表达的 YAGNI 哲学——如果你现在不需要保证不变性，那么目前可能不值得投资。以后排除接口应该不会太难。

# c# - 现有 XPS 文档中的数据绑定

> ID：558394
> 
> 赞同：2
> 
> 时间：2009-02-17T19:32:54.537
> 
> 标签：c#, data-binding, forms, xps

我有一个现有的 XPS 文件，我想将其用作模板并可能将数据绑定到它。我尝试了几种方法，但似乎无法使其正常工作。

有没有人有任何更改现有 XPS 文件以在运行时添加数据然后打印或保存的经验？

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T20:37:24.207

XPS 文档符合 Open XML 标准。有一个用于处理这些文档的 SDK。这是 Beth Massi 的一篇操作指南文章：“[使用 Open XML SDK 访问 Open XML 文档部件](http://blogs.msdn.com/bethmassi/archive/2008/07/30/accessing-openxml-document-parts-with-the-openxml-sdk.aspx)”。

由于您使用的是内部文档结构，您还可以查看“打开 XML 包编辑器”，它可以让您使用 Visual Studio 浏览文档。这是 Beth Massi 的另一个操作指南：“ [Handy Visual Studio Add-In to View Office 2007 年文件](http://blogs.msdn.com/bethmassi/archive/2008/07/29/handy-visual-studio-add-in-to-view-office-2007-files.aspx)”。

+汤姆

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T20:53:29.490

用 XPS 做到这一点有点挑战，但这是可能的。

您可以使用我们的 NiXPS SDK 做到这一点。不久前，我在我的博客上发布了一个示例：

[XPS 可变数据示例](http://nixps.blogspot.com/2008/09/xps-variable-data-example-with-nixps.html)

问候，

缺口

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-30T21:17:10.527

在写入 XPS 文档的过程中会评估绑定。因此，您无法在 FixedDocument 中设置 {Binding}，将该 FD 写入 XpsDocument，并期望在您下次打开该保存的文档时再次获取该原始 FD。

此外，标准的 XpsWriter 确实将所有内容转换为画布上的字形，因此您不能说，原始文本框并希望在将其保存到文档后能够找到它。

我从来没有使用过 NiXPS 库，所以如果尼克说可以做到，你可能想检查一下。

最后一种可能性--您可以以稍后可以找到的形式创建占位符。它们必须是带有某种分隔符方案的文本（类似于 [[{{FORMFIELDHERELOL}}]]），以将文本与其他所有内容区分开来。然后，您可以在 XML 中寻找适合分隔符模式的文本，并为您的绑定文本切换出这些字形。当然，THAT 的问题在于，如果您不使用 X 字符代替 X 字符，您可能会发现必须进行一些重新定位。由于它的所有字形都在画布上，这可能比用鞋带穿针头稍微难一些。

# flash - JW Player 需要流媒体服务器？

> ID：558414
> 
> 赞同：2
> 
> 时间：2009-02-17T19:37:37.660
> 
> 标签：flash, audio, streaming, jwplayer

目前，我开发的一个站点使用文件属性和 mp3 文件的公共 URL直接在[JW Player中播放 mp3 文件。](http://www.longtailvideo.com/players/jw-flv-player/)由于法律原因，这现在是客户端的问题，他们现在需要流式传输音频文件，以便用户在下载后无法打开缓存并直接获取文件。

JW 播放器网站有大量流式*视频*示例，但没有*音频*示例。是否可以使用 JW 播放器流式传输音频文件，我们是否需要为流媒体提供商支付很多钱？可以在本地php服务器上做吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T20:11:28.840

我认为在没有捕获风险的情况下，您将难以流式传输媒体。您是否尝试过[http://www.longtailvideo.com/support/tutorials/HTTP-Video-Streaming](http://www.longtailvideo.com/support/tutorials/HTTP-Video-Streaming)上的教程？它说它可以在[http://www.longtailvideo.com/players/jw-flv-player/](http://www.longtailvideo.com/players/jw-flv-player/)处理音频（AAC、MP3 是音频文件）。

我的理解是，如果您想要更高级别的保护，您需要查看流媒体提供商和特殊的流媒体服务器，也许还有 DRM。甚至可以捕获 Windows Media Server 流。

# php - Fedora 8 如何重建自定义 PHP？

> ID：558415
> 
> 赞同：0
> 
> 时间：2009-02-17T19:37:54.367
> 
> 标签：php, sql-server, fedora, rebuild

我在工作中为我的团队运行一个 wiki 服务器，最近将它移到了 Fedora 8 操作系统。一切都很好，除了我编写的与 MsSql 服务器联系的扩展失败，因为函数 mssql_connect 不存在。

在我的旧服务器上，我使用“免费 TDS”（使用 ./configure --prefix=/usr/local/freetds --enable-msdblib）并使用以下命令构建 PHP： ./
configure \
--with-apxs2=/usr/local /apache/bin/apxs \
--with-mysql=/usr/local/mysql \
**--with-mssql=/usr/local/freetds** \
--enable-safe-mode \
--enable-ftp \
--enable -inline-optimization \
--enable-magic-quotes --enable-xml \
--with-gd \
--with-zlib-dir=/usr/lib \
--with-jpeg-dir=/usr/local/库

有没有一种方法可以在 Fedora 上使用“--with-mssql=/usr/local/freetds”配置轻松重建 PHP？我想用 yum 来做这件事，但我不知道怎么做。更重要的是，我想避免从头开始构建所有东西。不是我不知道怎么做，我只是想避免它。

谢谢你的建议，
~埃里克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T20:05:54.843

请发布您构建的输出。是否因为 /usr/local/freetds 丢失而失败？

如果是，能不能用yum安装，或者自己下载编译[freetds](http://www.freetds.org/)。我还没有这样做，但它会是这样的......

1.  打开 shell 并导航到具有 freetds 存档的目录。
2.  执行 tar zxvf 解压。
3.  执行光盘
4.  为 freetds 构建运行 ./configure
5.  运行 make, (sudo) make install

然后找到 freetds 的安装位置并将该文件夹传递给 PHP 的 ./configure 命令。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T00:14:45.660

因此，添加 mssql 的答案就像“yum install php-mssql”一样简单。解决了我的问题，没有任何混乱。FreeTDS 安装了一个易于配置的。感谢所有试图回答或发表评论的人。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-24T07:30:54.543

获取[SQL Server Driver for PHP](http://www.microsoft.com/sqlserver/2005/en/us/PHP-Driver.aspx)，我认为您不必重建 php 即可使用此驱动程序。我建议你使用供应商的驱动程序。

# c# - 为什么 X509Certificate2 有时无法从 blob 创建？

> ID：558423
> 
> 赞同：10
> 
> 时间：2009-02-17T19:39:48.993
> 
> 标签：c#, blob, x509certificate2

我有一个 ASP.NET Web 服务，它正在接收一个字节数组，该数组表示`.pfx`包含 X.509 证书的文件的内容。服务器端代码使用`System.Security.Cryptography.X509Certificate2`构造函数从字节加载证书：

```
X509Certificate2 native_cert = new X509Certificate2(
                pkcs12_buf /*byte array*/,
                password,
                X509KeyStorageFlags.PersistKeySet |
                X509KeyStorageFlags.Exportable
            ); 
```

根据我的服务进程以谁的身份运行，此调用要么成功，要么因“内部错误”异常而失败。异常堆栈上的最后一次调用是 to `X509Utils._LoadCertFromBlob`，它是`mscore.dll`.

此代码在使用服务帐户凭据在交互式登录中从控制台应用程序运行时成功。`w3wp.exe`在使用服务帐户凭据的应用程序池中运行时，它会失败。将应用程序池身份更改为管理员可以解决问题，因此它一定是权限问题，但我不知道为此可能需要什么权限。该代码不涉及文件系统或 Windows 证书存储。

**[更新：更多信息]**
此错误出现在 Windows 事件日志中：

```
*Cryptographic Parameters:*   
**Provider Name:**  Microsoft Software Key Storage Provider  
**Algorithm Name:** Not Available.  
**Key Name:**   {E182E13B-166D-472A-A24A-CBEF0808E9ED}  
    **Key Type:**   User key.

*Cryptographic Operation:*  
**Operation:**  Open Key.  
    **Return Code:**    0x2 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-27T05:28:35.170

我自己刚刚找到了解决方案：

```
X509KeyStorageFlags flags = X509KeyStorageFlags.PersistKeySet | X509KeyStorageFlags.MachineKeySet;

X509Certificate2 cert = new X509Certificate2(pkcs12_buf, password, flags); 
```

这里的技巧是使用本地密钥存储`MachineKeySet`标志而不是用户配置文件密钥存储，如果您不指定替代位置，这是默认设置。因为 ASP.NET 进程标识不加载用户配置文件存储，所以在以编程方式导入证书时无法访问存储，但可以访问机器存储。

我认为`PersistKeySet`只是保持加载私钥，但我不确定它究竟做了什么 - 如果您出于某种原因需要访问私钥，这是必需的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T19:56:33.777

尝试授予 ASP.NET 帐户对以下文件夹的权限：（`C:\Documents And Settings\All Users\Microsoft\Crypto\RSA\MachineKeys\`可能因您的环境而异）

# iphone - 有人有 Cocos2d 中 ParticleExplosion 的工作示例吗？

> ID：558432
> 
> 赞同：1
> 
> 时间：2009-02-17T19:43:17.317
> 
> 标签：iphone, objective-c, cocos2d-iphone

我是 iPhone 开发的新手，我真的很想看到这种特殊效果的工作示例。提前致谢。

[粒子爆炸](http://www.sapusmedia.com/cocos2d-iphone-api-doc/interface_particle_explosion.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T23:14:36.770

如果您在 Xcode 中打开 Cocos2d 源代码，您应该能够启动包含所有粒子效果的 ParticleTest 示例。或者，在 youtube 上搜索 cocos2d，有一个演示视频展示了所有这些效果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-18T18:38:59.083

```
 CCParticleSystem *emitter = [CCParticleExplosion node];

    //set the location of the emitter
    emitter.position = mySprite.position;

    //set size of particle animation
    emitter.scale = 0.5;

    //set an Image for the particle
    emitter.texture = [[CCTextureCache sharedTextureCache] addImage:@"particle.png"];

    //set length of particle animation
    [emitter setLife:0.5f];

    //add to layer ofcourse(effect begins after this step)
    [self addChild: emitter]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T07:35:38.807

就这么简单：

ParticleSystem *emitter = [ParticleExplosion 节点]; [self addChild: 发射器];

# oop - OO 设计 - 将特定于实例的函数与特定于类的函数分离

> ID：558439
> 
> 赞同：1
> 
> 时间：2009-02-17T19:45:52.303
> 
> 标签：oop, design-patterns

给定一个在语义上应该是某种类型的对象的类，但也有多个操作来操作它自己类型的对象，在这种类型的场景中组织类的最佳方式（模式？）是什么*？*我发现当开发人员创建对象但以程序性思维方式思考时，这种情况很常见。

例子：

```
Class User {
  private m_userData;
  function User() {}
  function GetUserData() {}

  function KillAllUsers(){}
  function MaimAllUsers(){}
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T19:52:11.600

从您的描述中不是很清楚，但似乎“KillAllUsers”和“MainAllUsers”方法正在对一组用户进行操作。我建议创建一个自定义 UserCollection，将这些方法作为实例方法，或者将它们创建为静态变量并传入一组用户。在现代领域模型术语中，您将处理 UserRepository。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T19:52:18.403

我宁愿将这两个目的分为 User 和 UserManager 类。IMO 这提供了类应该做什么的更清晰的分离。

编辑：正如 Dunk 正确观察到的，应用程序中的实际名称不应该是 UserManager，而是更能描述其实际用途的名称。很多时候，您会为您将要使用的功能找到一个设计模式，因此类的名称将由该模式提供。这可能会导致诸如 UserRepository 或 UserFactory 之类的名称。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T19:55:58.487

对要对对象执行的操作进行抽象，例如通过创建接口。然后您可以稍后担心如何提供实际逻辑的实现。

通常，当处理类型为 User 的对象集合时，实现它的*不是*User 本身，而是另一个对象，例如 UserService。如果绝对希望它在类级别可用，您可以定义一个返回接口类型和默认实现的静态方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-29T10:20:24.793

像 killAllUsers() 或 MaimAllUsers() 这样的方法只是封装了预期的操作“what”，它在交互方面的不完整信息，特别是“who”。您可以 .kill() 或 .maim() 一个用户实例，但需要有人（JackTheReaper）打算对用户这样做，因此 kill() 和 maim() 是 JackTheReaper 和用户之间的交互， killAllUsers() 中“All”表达的部分意图是 JackTheReaper 类如何管理所有用户的引用的责任。本质上，这里的技巧是将类型级别的功能抽象为与实体的交互

# c# - 解决方案结构/最佳实践

> ID：558440
> 
> 赞同：1
> 
> 时间：2009-02-17T19:45:56.453
> 
> 标签：c#, .net, asp.net, visual-studio-2008

我最近刚刚开始了一个新的个人项目，目标是让它从一开始就可以扩展。

我得到了一个关于结构的建议，创建这样的东西：

```
<solution>
|-- project.client.sql.queries
|-- project.admin.sql.queries
|-- project.client.business.logic
|-- project.admin.business.logic
|-- project.client.web.ui (include references of the business logic + SQL queries projects )
|-- project.admin.web.ui 
```

这样，我就可以将所有内容结构化且易于遵循，以供将来扩展。我的问题在于我只想使用 SQL express 来启动，并且可能稍后在必要时继续使用 SQL Server。

因此，如果我将`.mdf`文件添加到`app_code`客户端并创建一个`.dbml`（linq 结构文件），我如何在 SQL 查询中使用 linq？我无权访问`ConfigurationManager`web.ui 项目。我是否必须像对 web.ui 那样在 SQL 查询项目中包含一个引用？否则 linq 似乎无法正常工作。

我主要在寻找最佳实践，因为有人告诉我后面的代码不应该包含任何业务逻辑或 SQL 查询——它们应该有自己的类库。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T20:01:23.373

这是目前任何人都可以给您的最佳建议：

> 蹩脚的第一个版本比不存在的完美版本要好得多。

我忘记了我从哪里得到的，我在很多地方都看到过这个建议。这是 100% 正确的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T21:04:03.643

附加数据库并在您的数据项目中创建一个 linq to sql dbml 文件。初始化数据服务类时，从 web.config 传入连接字符串并在 datacontext 构造函数中设置连接字符串。更多信息：[.NET / LINQ-SQL / ASP.NET 中的连接字符串地狱](https://stackoverflow.com/questions/236412/connection-string-hell-in-net-linq-sql-asp-net)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:56:30.127

可能不是您最初要求的，但请考虑文件布局和结构的 MVC 模型

[http://www.asp.net/mvc/](http://www.asp.net/mvc/)

它将使开发更容易维护

# javascript - 使用 jQuery 动态填写表单值

> ID：558445
> 
> 赞同：24
> 
> 时间：2009-02-17T19:48:04.060
> 
> 标签：javascript, jquery, database, ajax, dynamic

我知道如何使用纯 PHP 来做到这一点，但我需要在不重新加载页面的情况下做到这一点。无论如何，jQuery 是否可以有效地拉回一些数据库结果（基于用户在表单的第一个文本字段中输入的内容）然后用从数据库查询中拉回的数据填充一些剩余的字段？

本质上，我希望看到用户离开文本字段（通过跳出或单击下一个字段）并繁荣，使用在该字段中输入的值提交查询，然后填充后续字段 w/ oa 页面重新加载。

我熟悉 jQuery 的基础知识，但我没有用它来做这样的事情，我从服务器拉回数据并尝试在客户端填充它。

任何有关如何最好地开始使用此功能的建议/示例将不胜感激。谢谢。

*   尼古拉斯

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-17T20:05:19.370

假设这个示例 HTML：

```
<input type="text" name="email" id="email" />
<input type="text" name="first_name" id="first_name" />
<input type="text" name="last_name" id="last_name" /> 
```

你可以有这个javascript：

```
$("#email").bind("change", function(e){
  $.getJSON("http://yourwebsite.com/lokup.php?email=" + $("#email").val(),
        function(data){
          $.each(data, function(i,item){
            if (item.field == "first_name") {
              $("#first_name").val(item.value);
            } else if (item.field == "last_name") {
              $("#last_name").val(item.value);
            }
          });
        });
}); 
```

然后你有一个 PHP 脚本（在本例中为 lookup.php），它在查询字符串中接收一封电子邮件，并返回一个 JSON 格式的数组，其中包含你想要访问的值。这是实际命中数据库以查找值的部分：

```
<?php
//look up the record based on email and get the firstname and lastname
...

//build the JSON array for return
$json = array(array('field' => 'first_name', 
                    'value' => $firstName), 
              array('field' => 'last_name', 
                    'value' => $last_name));
echo json_encode($json );
?> 
```

你会想做其他事情，比如清理电子邮件输入等，但应该让你朝着正确的方向前进。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2015-02-03T15:50:38.927

自动填充数组中的所有表单域

[http://jsfiddle.net/brynner/wf0rk7tz/2/](http://jsfiddle.net/brynner/wf0rk7tz/2/)

JS

```
function fill(a){
    for(var k in a){
        $('[name="'+k+'"]').val(a[k]);
    }
}

array_example = {"God":"Jesus","Holy":"Spirit"};

fill(array_example); 
```

HTML

```
<form>
<input name="God">
<input name="Holy">
</form> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-17T19:59:25.360

如果您需要访问数据库，则需要再次访问 Web 服务器（大部分情况下）。

您可以做的是使用 AJAX，它向您站点上的另一个脚本发出请求以检索数据、获取数据，然后更新您想要的输入字段。

可以使用 $.ajax() 函数调用在 jquery 中进行 AJAX 调用，因此会发生这种情况

用户的浏览器输入触发触发 AJAX 调用的输入

```
$('input .callAjax').bind('change', function() { 
  $.ajax({ url: 'script/ajax', 
           type: json
           data: $foo,  
           success: function(data) {
             $('input .targetAjax').val(data.newValue);
           });
  ); 
```

现在您需要将 AJAX 调用指向脚本（听起来像是您正在使用 PHP），它将执行您想要的查询并发送回数据。

您可能希望使用 JSON 对象调用，以便可以传回一个 javascript 对象，这将比返回 XML 等更容易使用。

php 函数 json_encode($phpobj); 会有用的。

# .net - .NET 远程处理、版本控制和接口

> ID：558451
> 
> 赞同：0
> 
> 时间：2009-02-17T19:50:03.557
> 
> 标签：.net, remoting, interface, versioning

我有一个使用 2.0 框架的大型 .NET 远程处理项目。服务器的 API 通过接口公开，共享类型包含在与客户端应用程序共享的程序集中。

我有一些方法可以接受基类的数组，该基类有许多不同的类继承自它。

例如，我有一个基类“Vehicle”，它有两个继承自它的类，分别是“Car”和“Truck”。

我有一个方法 IFoo.Save(List 车辆)

稍后，我添加了一个从名为“Motorcycle”的“Vehicle”继承的新类，并且只有服务器或客户端具有新的共享程序集，但不是两者都有。其中一个将无法解析新类型。

你觉得处理这种情况最灵活的方法是什么？

编辑：这是一个 Windows 窗体客户端应用程序和托管在 Windows 服务中的远程服务器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T20:01:21.253

发布更新。对于这样的事情，你总是必须让所有东西都在同一个版本上。也许考虑 ClickOnce 让每个人都保持最新状态。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:33:05.497

ClickOnce 是一个很好的解决方案。

或者采用与类无关的 Web 服务方法。传递可以重新构建为对象的版本化、二进制流式字典。如果这很重要，请编写对象重构内容以处理*向前*和向后兼容性，否则只需拒绝具有“未来”版本号的数据。

Web 服务非常适合解耦。字典非常适​​合传递一般数据。基于程序集的类版本控制是可怕的（即使最近版本的 .Net 中的序列化更改）并导致疯狂......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:01:12.437

这似乎更像是一个部署问题。服务器和客户端必须有权访问相同版本的共享程序集。您的策略将取决于平台 - 这是网络还是表单？

一种方法是强制客户端使用特定版本的共享程序集，并向客户端提供该程序集的交付方法。

# c# - ADO EF - TPH 中派生类型之间的错误映射关联

> ID：558462
> 
> 赞同：12
> 
> 时间：2009-02-17T19:55:27.770
> 
> 标签：c#, entity-framework, orm

## 背景

我正在使用 .NET Framework 3.5 SP1 在 Visual Studio 2008 SP1 中使用 ADO 实体框架编写数据访问库。我正在尝试在两个都派生自抽象类型的实体之间创建关联。我使用[Table Per Hierarchy](http://www.hibernate.org/hib_docs/reference/en/html/inheritance.html) (TPH) 来表示两个实体继承层次结构，这意味着只有两个表 - 每个实体继承层次结构一个。

**注意**您可以使用 Table Per Type (TPT) 来避免此问题，但它也有其自身的缺点。在继承持久性模型之间进行选择时，请参阅[此处](https://stackoverflow.com/questions/190296/how-do-you-effectively-model-inheritance-in-a-database)和[此处了解更多详细信息。](http://blogs.microsoft.co.il/blogs/bursteg/archive/2007/09/30/how-to-model-inheritance-in-databases.aspx)

这是实体模型的设计器视图的屏幕截图：

[![Visual Studio 2008 SP1 中实体模型的设计视图](https://i.stack.imgur.com/vgMgb.jpg)](http://img153.imageshack.us/my.php?image=adoefgraphexamplescreenxz0.png)

这是数据库模式的屏幕截图：

[![数据库模式](https://i.stack.imgur.com/6lQWf.jpg)](http://img7.imageshack.us/my.php?image=graphexampledatabaseschik0.png)

## 假设

当您在 ADO 实体框架设计器中使用 Visual Studio 2008 SP1 和 .NET Framework 3.5 SP1 在使用 TPH 建模的派生类型之间创建关联时，您可能会收到以下“错误 3034：具有不同键的两个实体映射到同一个行。确保这两个映射片段不会将具有重叠键的两组实体映射到同一组行。

根据我在[网上阅读](http://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/thread/12191f0d-3010-425d-9c52-ed0542458eaf/)的内容，为了解决此问题，您必须在外键上的关联中添加一个条件，如下所示：

```
<Condition ColumnName="Endpoint1" IsNull="false" /> 
```

这是 PersonPersonToPerson1 关联的此编辑的屏幕截图：

[![GraphModel.edmx 的 Visual Studio 2008 SP1 编辑](https://i.stack.imgur.com/neseQ.jpg)](http://img153.imageshack.us/my.php?image=edmxassociationsetmappiah8.png)

## 约束

*   每个层次结构（即节点和链接）的基类*必须*是抽象的。
*   来自两个派生类型之间关联的导航属性*必须*通过链接类型（例如 PersonToPerson 和 PersonToLocation）来区分。这意味着您*不能*在 Link 和 Node 抽象基类之间创建关联。

## 问题：

当我如上所述创建实体模型并将条件添加到上面假设中所述的关联映射时，我在构建/验证模型时收到“错误 3023”。

```
Error   1   Error 3023: Problem in Mapping Fragments starting at lines 146, 153, 159, 186, 195, 204, 213: Column Link.Endpoint1 has no default value and is not nullable. A column value is required to store entity data.
An Entity with Key (PK) will not round-trip when:
((PK is NOT in 'LinkSet' EntitySet OR PK does NOT play Role 'PersonToPerson' in AssociationSet 'PersonPersonToPerson1') AND (PK is in 'LinkSet' EntitySet OR PK plays Role 'PersonToPerson' in AssociationSet 'PersonPersonToPerson1' OR PK plays Role 'PersonToPerson' in AssociationSet 'PersonPersonToPerson'))
C:\Documents and Settings\Demo\My Documents\Visual Studio 2008\Projects\GraphExample2.BusinessEntities\GraphExample2.BusinessEntities\GraphModel.edmx   147 15  GraphExample2.BusinessEntities 
```

在上述场景中，实体框架被挂断的事情是有两个属性被映射到相同的外键。例如，Endpoint1 的列和外键映射到 PersonToLocation 派生类型中的 Person 属性，并映射到 PersonToPerson 派生类型中的 Leader 属性。

我不明白为什么这是一个问题。由于 Leader/Follower 属性仅在 PersonToPerson 派生类型中 - 而不是任何其他派生类型或基类型 - 而且 Person/Location 属性也是如此，为什么 TypeDiscriminator 字段不足以让 EF 找出哪个设置给定的行属于？

在我看来，如果您正在处理 TypeDiscriminator = 1 的对象，则将 Endpoint1 放在 Leader 中，将 Endpoint2 放在 Follower 中。同样，如果您正在处理 TypeDiscriminator = 2 的对象，则将 Endpoint1 放置在 Person 中，将 Endpoint2 放置在 Location 中。

## 问题：

**您如何解决错误 3023 以允许这些关联发生？**

或者

**您如何在我上面描述的 ADO 实体框架中创建关联类型？**

## 参考：

*   MSDN 论坛 -[错误 3034：从行开始映射片段时出现问题...](http://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/thread/4aa46c4a-05d5-49e7-82ef-33b79904fcc9/)
*   Zeeshan Hirani 的博客 -[对实体框架社区的贡献](http://weblogs.asp.net/zeeshanhirani/archive/2008/12/05/my-christmas-present-to-the-entity-framework-community.aspx)
*   Zeeshan Hirani 的[实体框架学习指南](http://cid-245ed00edb4c374e.skydrive.live.com/self.aspx/Public/entity%20framework%20learning%20guide.pdf)（这是一个优秀的 514 页分步指南，介绍了 ADO EF 的众多概念和陷阱。强烈推荐！）

## 代码

SQL：

```
USE [GraphExample2]
GO
/****** Object:  Table [dbo].[Node]    Script Date: 02/17/2009 14:36:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Node](
    [NodeID] [int] NOT NULL,
    [NodeTypeDiscriminator] [int] NOT NULL,
    [Name] [varchar](255) NOT NULL,
    [Description] [varchar](1023) NULL,
 CONSTRAINT [PK_Node] PRIMARY KEY CLUSTERED 
(
    [NodeID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Link]    Script Date: 02/17/2009 14:36:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Link](
    [LinkID] [int] NOT NULL,
    [LinkTypeDiscriminator] [int] NOT NULL,
    [Endpoint1] [int] NOT NULL,
    [Endpoint2] [int] NOT NULL,
    [Name] [varchar](255) NULL,
    [Description] [varchar](1023) NULL,
 CONSTRAINT [PK_Link] PRIMARY KEY CLUSTERED 
(
    [LinkID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
/****** Object:  ForeignKey [FK_Link_Node_Endpoint1]    Script Date: 02/17/2009 14:36:12 ******/
ALTER TABLE [dbo].[Link]  WITH CHECK ADD  CONSTRAINT [FK_Link_Node_Endpoint1] FOREIGN KEY([Endpoint1])
REFERENCES [dbo].[Node] ([NodeID])
GO
ALTER TABLE [dbo].[Link] CHECK CONSTRAINT [FK_Link_Node_Endpoint1]
GO
/****** Object:  ForeignKey [FK_Link_Node_Endpoint2]    Script Date: 02/17/2009 14:36:12 ******/
ALTER TABLE [dbo].[Link]  WITH CHECK ADD  CONSTRAINT [FK_Link_Node_Endpoint2] FOREIGN KEY([Endpoint2])
REFERENCES [dbo].[Node] ([NodeID])
GO
ALTER TABLE [dbo].[Link] CHECK CONSTRAINT [FK_Link_Node_Endpoint2]
GO 
```

EDMX：

```
<?xml version="1.0" encoding="utf-8"?>
<edmx:Edmx Version="1.0" xmlns:edmx="http://schemas.microsoft.com/ado/2007/06/edmx">
  <!-- EF Runtime content -->
  <edmx:Runtime>
    <!-- SSDL content -->
    <edmx:StorageModels>
      <Schema Namespace="GraphModel.Store" Alias="Self" Provider="System.Data.SqlClient" ProviderManifestToken="2005" xmlns:store="http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator" xmlns="http://schemas.microsoft.com/ado/2006/04/edm/ssdl">
        <EntityContainer Name="GraphModelStoreContainer">
          <EntitySet Name="Link" EntityType="GraphModel.Store.Link" store:Type="Tables" Schema="dbo" />
          <EntitySet Name="Node" EntityType="GraphModel.Store.Node" store:Type="Tables" Schema="dbo" />
          <AssociationSet Name="FK_Link_Node_Endpoint1" Association="GraphModel.Store.FK_Link_Node_Endpoint1">
            <End Role="Node" EntitySet="Node" />
            <End Role="Link" EntitySet="Link" />
          </AssociationSet>
          <AssociationSet Name="FK_Link_Node_Endpoint2" Association="GraphModel.Store.FK_Link_Node_Endpoint2">
            <End Role="Node" EntitySet="Node" />
            <End Role="Link" EntitySet="Link" />
          </AssociationSet>
        </EntityContainer>
        <EntityType Name="Link">
          <Key>
            <PropertyRef Name="LinkID" />
          </Key>
          <Property Name="LinkID" Type="int" Nullable="false" />
          <Property Name="LinkTypeDiscriminator" Type="int" Nullable="false" />
          <Property Name="Endpoint1" Type="int" Nullable="false" />
          <Property Name="Endpoint2" Type="int" Nullable="false" />
          <Property Name="Name" Type="varchar" MaxLength="255" />
          <Property Name="Description" Type="varchar" MaxLength="1023" />
        </EntityType>
        <EntityType Name="Node">
          <Key>
            <PropertyRef Name="NodeID" />
          </Key>
          <Property Name="NodeID" Type="int" Nullable="false" />
          <Property Name="NodeTypeDiscriminator" Type="int" Nullable="false" />
          <Property Name="Name" Type="varchar" Nullable="false" MaxLength="255" />
          <Property Name="Description" Type="varchar" MaxLength="1023" />
        </EntityType>
        <Association Name="FK_Link_Node_Endpoint1">
          <End Role="Node" Type="GraphModel.Store.Node" Multiplicity="1" />
          <End Role="Link" Type="GraphModel.Store.Link" Multiplicity="*" />
          <ReferentialConstraint>
            <Principal Role="Node">
              <PropertyRef Name="NodeID" />
            </Principal>
            <Dependent Role="Link">
              <PropertyRef Name="Endpoint1" />
            </Dependent>
          </ReferentialConstraint>
        </Association>
        <Association Name="FK_Link_Node_Endpoint2">
          <End Role="Node" Type="GraphModel.Store.Node" Multiplicity="1" />
          <End Role="Link" Type="GraphModel.Store.Link" Multiplicity="*" />
          <ReferentialConstraint>
            <Principal Role="Node">
              <PropertyRef Name="NodeID" />
            </Principal>
            <Dependent Role="Link">
              <PropertyRef Name="Endpoint2" />
            </Dependent>
          </ReferentialConstraint>
        </Association>
      </Schema>
    </edmx:StorageModels>
    <!-- CSDL content -->
    <edmx:ConceptualModels>
      <Schema xmlns="http://schemas.microsoft.com/ado/2006/04/edm" Namespace="GraphModel" Alias="Self">
        <EntityContainer Name="GraphModelContainer" >
          <EntitySet Name="NodeSet" EntityType="GraphModel.Node" />
          <EntitySet Name="LinkSet" EntityType="GraphModel.Link" />
          <AssociationSet Name="PersonPersonToPerson" Association="GraphModel.PersonPersonToPerson">
            <End Role="Person" EntitySet="NodeSet" />
            <End Role="PersonToPerson" EntitySet="LinkSet" />
          </AssociationSet>
          <AssociationSet Name="PersonPersonToPerson1" Association="GraphModel.PersonPersonToPerson1">
            <End Role="Person" EntitySet="NodeSet" />
            <End Role="PersonToPerson" EntitySet="LinkSet" />
          </AssociationSet>
          <AssociationSet Name="Person_PersonToLocation" Association="GraphModel.Person_PersonToLocation">
            <End Role="Person" EntitySet="NodeSet" />
            <End Role="PersonToLocation" EntitySet="LinkSet" />
          </AssociationSet>
          <AssociationSet Name="Location_PersonToLocation" Association="GraphModel.Location_PersonToLocation">
            <End Role="Location" EntitySet="NodeSet" />
            <End Role="PersonToLocation" EntitySet="LinkSet" />
          </AssociationSet>
        </EntityContainer>
        <EntityType Name="Node" Abstract="true">
          <Key>
            <PropertyRef Name="NodeId" />
          </Key>
          <Property Name="NodeId" Type="Int32" Nullable="false" />
          <Property Name="Name" Type="String" Nullable="false" />
          <Property Name="Description" Type="String" Nullable="true" />
        </EntityType>
        <EntityType Name="Person" BaseType="GraphModel.Node" >
          <NavigationProperty Name="Leaders" Relationship="GraphModel.PersonPersonToPerson" FromRole="Person" ToRole="PersonToPerson" />
          <NavigationProperty Name="Followers" Relationship="GraphModel.PersonPersonToPerson1" FromRole="Person" ToRole="PersonToPerson" />
          <NavigationProperty Name="Locations" Relationship="GraphModel.Person_PersonToLocation" FromRole="Person" ToRole="PersonToLocation" />
        </EntityType>
        <EntityType Name="Location" BaseType="GraphModel.Node" >
          <NavigationProperty Name="Visitors" Relationship="GraphModel.Location_PersonToLocation" FromRole="Location" ToRole="PersonToLocation" />
        </EntityType>
        <EntityType Name="Link" Abstract="true">
          <Key>
            <PropertyRef Name="LinkId" />
          </Key>
          <Property Name="LinkId" Type="Int32" Nullable="false" />
          <Property Name="Name" Type="String" Nullable="true" />
          <Property Name="Description" Type="String" Nullable="true" />
        </EntityType>
        <EntityType Name="PersonToPerson" BaseType="GraphModel.Link" >
          <NavigationProperty Name="Leader" Relationship="GraphModel.PersonPersonToPerson" FromRole="PersonToPerson" ToRole="Person" />
          <NavigationProperty Name="Follower" Relationship="GraphModel.PersonPersonToPerson1" FromRole="PersonToPerson" ToRole="Person" />
        </EntityType>
        <EntityType Name="PersonToLocation" BaseType="GraphModel.Link" >
          <NavigationProperty Name="Person" Relationship="GraphModel.Person_PersonToLocation" FromRole="PersonToLocation" ToRole="Person" />
          <NavigationProperty Name="Location" Relationship="GraphModel.Location_PersonToLocation" FromRole="PersonToLocation" ToRole="Location" />
        </EntityType>
        <Association Name="PersonPersonToPerson">
          <End Type="GraphModel.Person" Role="Person" Multiplicity="1" />
          <End Type="GraphModel.PersonToPerson" Role="PersonToPerson" Multiplicity="*" />
        </Association>
        <Association Name="PersonPersonToPerson1">
          <End Type="GraphModel.Person" Role="Person" Multiplicity="1" />
          <End Type="GraphModel.PersonToPerson" Role="PersonToPerson" Multiplicity="*" />
        </Association>
        <Association Name="Person_PersonToLocation">
          <End Type="GraphModel.Person" Role="Person" Multiplicity="1" />
          <End Type="GraphModel.PersonToLocation" Role="PersonToLocation" Multiplicity="*" />
        </Association>
        <Association Name="Location_PersonToLocation">
          <End Type="GraphModel.Location" Role="Location" Multiplicity="1" />
          <End Type="GraphModel.PersonToLocation" Role="PersonToLocation" Multiplicity="*" />
        </Association>
      </Schema>
    </edmx:ConceptualModels>
    <!-- C-S mapping content -->
    <edmx:Mappings>
      <Mapping xmlns="urn:schemas-microsoft-com:windows:storage:mapping:CS" Space="C-S">
        <Alias Key="Model" Value="GraphModel" />
        <Alias Key="Target" Value="GraphModel.Store" />
        <EntityContainerMapping CdmEntityContainer="GraphModelContainer" StorageEntityContainer="GraphModelStoreContainer">
          <EntitySetMapping Name="LinkSet">
            <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Link)">
              <MappingFragment StoreEntitySet="Link">
                <ScalarProperty Name="Description" ColumnName="Description" />
                <ScalarProperty Name="Name" ColumnName="Name" />
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
              </MappingFragment>
            </EntityTypeMapping>
            <EntityTypeMapping TypeName="IsTypeOf(GraphModel.PersonToPerson)">
              <MappingFragment StoreEntitySet="Link" >
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
                <Condition ColumnName="LinkTypeDiscriminator" Value="1" />
              </MappingFragment>
            </EntityTypeMapping>
            <EntityTypeMapping TypeName="IsTypeOf(GraphModel.PersonToLocation)">
              <MappingFragment StoreEntitySet="Link" >
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
                <Condition ColumnName="LinkTypeDiscriminator" Value="2" />
              </MappingFragment>
            </EntityTypeMapping>
          </EntitySetMapping>
          <EntitySetMapping Name="NodeSet">
            <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Node)">
              <MappingFragment StoreEntitySet="Node">
                <ScalarProperty Name="Description" ColumnName="Description" />
                <ScalarProperty Name="Name" ColumnName="Name" />
                <ScalarProperty Name="NodeId" ColumnName="NodeID" />
              </MappingFragment>
            </EntityTypeMapping>
            <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Person)">
              <MappingFragment StoreEntitySet="Node" >
                <ScalarProperty Name="NodeId" ColumnName="NodeID" />
                <Condition ColumnName="NodeTypeDiscriminator" Value="1" />
              </MappingFragment>
            </EntityTypeMapping>
            <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Location)">
              <MappingFragment StoreEntitySet="Node" >
                <ScalarProperty Name="NodeId" ColumnName="NodeID" />
                <Condition ColumnName="NodeTypeDiscriminator" Value="2" />
              </MappingFragment>
            </EntityTypeMapping>
          </EntitySetMapping>
          <AssociationSetMapping Name="PersonPersonToPerson1" TypeName="GraphModel.PersonPersonToPerson1" StoreEntitySet="Link">
            <EndProperty Name="Person">
              <ScalarProperty Name="NodeId" ColumnName="Endpoint1" />
            </EndProperty>
            <EndProperty Name="PersonToPerson">
              <ScalarProperty Name="LinkId" ColumnName="LinkID" />
            </EndProperty>
            <Condition ColumnName="Endpoint1" IsNull="false" />
          </AssociationSetMapping>
          <AssociationSetMapping Name="PersonPersonToPerson" TypeName="GraphModel.PersonPersonToPerson" StoreEntitySet="Link">
            <EndProperty Name="Person">
              <ScalarProperty Name="NodeId" ColumnName="Endpoint2" />
            </EndProperty>
            <EndProperty Name="PersonToPerson">
              <ScalarProperty Name="LinkId" ColumnName="LinkID" />
            </EndProperty>
            <Condition ColumnName="Endpoint2" IsNull="false" />
          </AssociationSetMapping>
          <AssociationSetMapping Name="Person_PersonToLocation" TypeName="GraphModel.Person_PersonToLocation" StoreEntitySet="Link">
            <EndProperty Name="Person">
              <ScalarProperty Name="NodeId" ColumnName="Endpoint1" />
            </EndProperty>
            <EndProperty Name="PersonToLocation">
              <ScalarProperty Name="LinkId" ColumnName="LinkID" />
            </EndProperty>
            <Condition ColumnName="Endpoint1" IsNull="false" />
          </AssociationSetMapping>
          <AssociationSetMapping Name="Location_PersonToLocation" TypeName="GraphModel.Location_PersonToLocation" StoreEntitySet="Link">
            <EndProperty Name="Location">
              <ScalarProperty Name="NodeId" ColumnName="Endpoint2" />
            </EndProperty>
            <EndProperty Name="PersonToLocation">
              <ScalarProperty Name="LinkId" ColumnName="LinkID" />
            </EndProperty>
            <Condition ColumnName="Endpoint2" IsNull="false" />
          </AssociationSetMapping>
        </EntityContainerMapping>
      </Mapping>
    </edmx:Mappings>
  </edmx:Runtime>
  <!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) -->
  <edmx:Designer xmlns="http://schemas.microsoft.com/ado/2007/06/edmx">
    <edmx:Connection>
      <DesignerInfoPropertySet>
        <DesignerProperty Name="MetadataArtifactProcessing" Value="EmbedInOutputAssembly" />
      </DesignerInfoPropertySet>
    </edmx:Connection>
    <edmx:Options>
      <DesignerInfoPropertySet>
        <DesignerProperty Name="ValidateOnBuild" Value="true" />
      </DesignerInfoPropertySet>
    </edmx:Options>
    <!-- Diagram content (shape and connector positions) -->
    <edmx:Diagrams>
      <Diagram Name="GraphModel" ZoomLevel="114" >
        <EntityTypeShape EntityType="GraphModel.Node" Width="1.5" PointX="5.875" PointY="1.375" Height="1.427958984375" />
        <EntityTypeShape EntityType="GraphModel.Person" Width="1.5" PointX="5.875" PointY="3.25" Height="1.4279589843749996" />
        <EntityTypeShape EntityType="GraphModel.Location" Width="1.5" PointX="7.75" PointY="4.625" Height="1.0992643229166665" />
        <InheritanceConnector EntityType="GraphModel.Location">
          <ConnectorPoint PointX="7.375" PointY="2.0889794921875" />
          <ConnectorPoint PointX="8.5" PointY="2.0889794921875" />
          <ConnectorPoint PointX="8.5" PointY="4.625" />
        </InheritanceConnector>
        <EntityTypeShape EntityType="GraphModel.Link" Width="1.5" PointX="2.875" PointY="1.375" Height="1.427958984375" />
        <EntityTypeShape EntityType="GraphModel.PersonToPerson" Width="1.75" PointX="2.625" PointY="3.125" Height="0.9349169921875" />
        <InheritanceConnector EntityType="GraphModel.PersonToPerson">
          <ConnectorPoint PointX="3.625" PointY="2.802958984375" />
          <ConnectorPoint PointX="3.625" PointY="3.125" />
        </InheritanceConnector>
        <InheritanceConnector EntityType="GraphModel.Person">
          <ConnectorPoint PointX="6.625" PointY="2.802958984375" />
          <ConnectorPoint PointX="6.625" PointY="3.25" />
        </InheritanceConnector>
        <EntityTypeShape EntityType="GraphModel.PersonToLocation" Width="1.875" PointX="0.75" PointY="4.625" Height="1.2636116536458326" />
        <InheritanceConnector EntityType="GraphModel.PersonToLocation">
          <ConnectorPoint PointX="2.875" PointY="2.0889794921875" />
          <ConnectorPoint PointX="1.65625" PointY="2.0889794921875" />
          <ConnectorPoint PointX="1.65625" PointY="4.625" />
        </InheritanceConnector>
        <AssociationConnector Association="GraphModel.PersonPersonToPerson">
          <ConnectorPoint PointX="5.875" PointY="3.8193058268229163" />
          <ConnectorPoint PointX="4.375" PointY="3.8193058268229163" />
        </AssociationConnector>
        <AssociationConnector Association="GraphModel.PersonPersonToPerson1">
          <ConnectorPoint PointX="5.875" PointY="3.4721529134114579" />
          <ConnectorPoint PointX="4.375" PointY="3.4721529134114579" />
        </AssociationConnector>
        <AssociationConnector Association="GraphModel.Person_PersonToLocation">
          <ConnectorPoint PointX="6.625" PointY="4.677958984375" />
          <ConnectorPoint PointX="6.625" PointY="5.1875" />
          <ConnectorPoint PointX="2.625" PointY="5.1875" />
        </AssociationConnector>
        <AssociationConnector Association="GraphModel.Location_PersonToLocation">
          <ConnectorPoint PointX="7.75" PointY="5.4791666666666661" />
          <ConnectorPoint PointX="2.625" PointY="5.4791666666666661" />
        </AssociationConnector>
      </Diagram>
    </edmx:Diagrams>
  </edmx:Designer>
</edmx:Edmx> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T19:00:30.703

## 可能的解决方法

1.  为派生类型之间的每个关联创建一个单独的列，并使这些列中的每一个都可以为**空**
2.  在每个新列和主键表之间创建一个外键。
3.  将实体模型中的每个关联映射到特定的唯一列和外键，以便每个列和外键只使用一次。

* * *

## 问题

这是一个非常不受欢迎的解决方案，因为它会爆炸您需要的列数。

*   **更多列**- 为派生类型之间的每个关联添加一列会导致列数激增。
*   **空列**在 TPH 的情况下，这意味着您的表中有很多*空*列。
*   **SQL JOIN** - 从 TPH 切换到 TPT 以避免空列的数量导致 EF 必须使用 JOIN，这将不得不非常频繁地发生（几乎每次您处理任何派生类型时）。
*   **重构**如果您将来添加派生类型，您不仅需要更新实体模型 (*.edmx) 及其映射，还必须通过添加额外的列来更改数据库模式！

    * * *

## 例子

对于上面的链接/节点示例，生成的数据库模式如下所示：

[![GraphExample 解决方法数据库架构](https://i.stack.imgur.com/D7QFw.jpg)](http://img230.imageshack.us/my.php?image=graphexampledatabasewor.png)

* * *

## 代码

SQL：

```
USE [GraphExample2]
GO
/****** Object:  Table [dbo].[Node]    Script Date: 02/26/2009 15:45:53 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Node](
    [NodeID] [int] IDENTITY(1,1) NOT NULL,
    [NodeTypeDiscriminator] [int] NOT NULL,
    [Name] [varchar](255) NOT NULL,
    [Description] [varchar](1023) NULL,
 CONSTRAINT [PK_Node] PRIMARY KEY CLUSTERED 
(
    [NodeID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Link]    Script Date: 02/26/2009 15:45:53 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[Link](
    [LinkID] [int] IDENTITY(1,1) NOT NULL,
    [LinkTypeDiscriminator] [int] NOT NULL,
    [LeaderID] [int] NULL,
    [FollowerID] [int] NULL,
    [PersonID] [int] NULL,
    [LocationID] [int] NULL,
    [Name] [varchar](255) NULL,
    [Description] [varchar](1023) NULL,
 CONSTRAINT [PK_Link] PRIMARY KEY CLUSTERED 
(
    [LinkID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
/****** Object:  ForeignKey [FK_Link_Node_Follower]    Script Date: 02/26/2009 15:45:53 ******/
ALTER TABLE [dbo].[Link]  WITH CHECK ADD  CONSTRAINT [FK_Link_Node_Follower] FOREIGN KEY([FollowerID])
REFERENCES [dbo].[Node] ([NodeID])
GO
ALTER TABLE [dbo].[Link] CHECK CONSTRAINT [FK_Link_Node_Follower]
GO
/****** Object:  ForeignKey [FK_Link_Node_Leader]    Script Date: 02/26/2009 15:45:53 ******/
ALTER TABLE [dbo].[Link]  WITH CHECK ADD  CONSTRAINT [FK_Link_Node_Leader] FOREIGN KEY([LeaderID])
REFERENCES [dbo].[Node] ([NodeID])
GO
ALTER TABLE [dbo].[Link] CHECK CONSTRAINT [FK_Link_Node_Leader]
GO
/****** Object:  ForeignKey [FK_Link_Node_Location]    Script Date: 02/26/2009 15:45:53 ******/
ALTER TABLE [dbo].[Link]  WITH CHECK ADD  CONSTRAINT [FK_Link_Node_Location] FOREIGN KEY([LocationID])
REFERENCES [dbo].[Node] ([NodeID])
GO
ALTER TABLE [dbo].[Link] CHECK CONSTRAINT [FK_Link_Node_Location]
GO
/****** Object:  ForeignKey [FK_Link_Node_Person]    Script Date: 02/26/2009 15:45:53 ******/
ALTER TABLE [dbo].[Link]  WITH CHECK ADD  CONSTRAINT [FK_Link_Node_Person] FOREIGN KEY([PersonID])
REFERENCES [dbo].[Node] ([NodeID])
GO
ALTER TABLE [dbo].[Link] CHECK CONSTRAINT [FK_Link_Node_Person]
GO 
```

EDMX：

```
<?xml version="1.0" encoding="utf-8"?>
  <edmx:Edmx Version="1.0" xmlns:edmx="http://schemas.microsoft.com/ado/2007/06/edmx">
    <!-- EF Runtime content -->
    <edmx:Runtime>
      <!-- SSDL content -->
      <edmx:StorageModels>
        <Schema Namespace="GraphModel.Store" Alias="Self" Provider="System.Data.SqlClient" ProviderManifestToken="2005" xmlns:store="http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator" xmlns="http://schemas.microsoft.com/ado/2006/04/edm/ssdl">
          <EntityContainer Name="GraphModelStoreContainer">
            <EntitySet Name="Link" EntityType="GraphModel.Store.Link" store:Type="Tables" Schema="dbo" />
            <EntitySet Name="Node" EntityType="GraphModel.Store.Node" store:Type="Tables" Schema="dbo" />
            <AssociationSet Name="FK_Link_Node_Follower" Association="GraphModel.Store.FK_Link_Node_Follower">
              <End Role="Node" EntitySet="Node" />
              <End Role="Link" EntitySet="Link" />
            </AssociationSet>
            <AssociationSet Name="FK_Link_Node_Leader" Association="GraphModel.Store.FK_Link_Node_Leader">
              <End Role="Node" EntitySet="Node" />
              <End Role="Link" EntitySet="Link" />
            </AssociationSet>
            <AssociationSet Name="FK_Link_Node_Location" Association="GraphModel.Store.FK_Link_Node_Location">
              <End Role="Node" EntitySet="Node" />
              <End Role="Link" EntitySet="Link" />
            </AssociationSet>
            <AssociationSet Name="FK_Link_Node_Person" Association="GraphModel.Store.FK_Link_Node_Person">
              <End Role="Node" EntitySet="Node" />
              <End Role="Link" EntitySet="Link" />
            </AssociationSet>
          </EntityContainer>
          <EntityType Name="Link">
            <Key>
              <PropertyRef Name="LinkID" />
            </Key>
            <Property Name="LinkID" Type="int" Nullable="false" StoreGeneratedPattern="Identity" />
            <Property Name="LinkTypeDiscriminator" Type="int" Nullable="false" />
            <Property Name="LeaderID" Type="int" />
            <Property Name="FollowerID" Type="int" />
            <Property Name="PersonID" Type="int" />
            <Property Name="LocationID" Type="int" />
            <Property Name="Name" Type="varchar" MaxLength="255" />
            <Property Name="Description" Type="varchar" MaxLength="1023" />
          </EntityType>
          <EntityType Name="Node">
            <Key>
              <PropertyRef Name="NodeID" />
            </Key>
            <Property Name="NodeID" Type="int" Nullable="false" StoreGeneratedPattern="Identity" />
            <Property Name="NodeTypeDiscriminator" Type="int" Nullable="false" />
            <Property Name="Name" Type="varchar" Nullable="false" MaxLength="255" />
            <Property Name="Description" Type="varchar" MaxLength="1023" />
          </EntityType>
          <Association Name="FK_Link_Node_Follower">
            <End Role="Node" Type="GraphModel.Store.Node" Multiplicity="0..1" />
            <End Role="Link" Type="GraphModel.Store.Link" Multiplicity="*" />
            <ReferentialConstraint>
              <Principal Role="Node">
                <PropertyRef Name="NodeID" />
              </Principal>
              <Dependent Role="Link">
                <PropertyRef Name="FollowerID" />
              </Dependent>
            </ReferentialConstraint>
          </Association>
          <Association Name="FK_Link_Node_Leader">
            <End Role="Node" Type="GraphModel.Store.Node" Multiplicity="0..1" />
            <End Role="Link" Type="GraphModel.Store.Link" Multiplicity="*" />
            <ReferentialConstraint>
              <Principal Role="Node">
                <PropertyRef Name="NodeID" />
              </Principal>
              <Dependent Role="Link">
                <PropertyRef Name="LeaderID" />
              </Dependent>
            </ReferentialConstraint>
          </Association>
          <Association Name="FK_Link_Node_Location">
            <End Role="Node" Type="GraphModel.Store.Node" Multiplicity="0..1" />
            <End Role="Link" Type="GraphModel.Store.Link" Multiplicity="*" />
            <ReferentialConstraint>
              <Principal Role="Node">
                <PropertyRef Name="NodeID" />
              </Principal>
              <Dependent Role="Link">
                <PropertyRef Name="LocationID" />
              </Dependent>
            </ReferentialConstraint>
          </Association>
          <Association Name="FK_Link_Node_Person">
            <End Role="Node" Type="GraphModel.Store.Node" Multiplicity="0..1" />
            <End Role="Link" Type="GraphModel.Store.Link" Multiplicity="*" />
            <ReferentialConstraint>
              <Principal Role="Node">
                <PropertyRef Name="NodeID" />
              </Principal>
              <Dependent Role="Link">
                <PropertyRef Name="PersonID" />
              </Dependent>
            </ReferentialConstraint>
          </Association>
        </Schema>
      </edmx:StorageModels>
      <!-- CSDL content -->
      <edmx:ConceptualModels>
        <Schema xmlns="http://schemas.microsoft.com/ado/2006/04/edm" Namespace="GraphModel" Alias="Self">
          <EntityContainer Name="GraphModelContainer" >
            <EntitySet Name="NodeSet" EntityType="GraphModel.Node" />
            <EntitySet Name="LinkSet" EntityType="GraphModel.Link" />
            <AssociationSet Name="PersonPersonToPerson_Leader" Association="GraphModel.PersonPersonToPerson_Leader">
              <End Role="Person" EntitySet="NodeSet" />
              <End Role="PersonToPerson" EntitySet="LinkSet" />
            </AssociationSet>
            <AssociationSet Name="PersonPersonToPerson_Follower" Association="GraphModel.PersonPersonToPerson_Follower">
              <End Role="Person" EntitySet="NodeSet" />
              <End Role="PersonToPerson" EntitySet="LinkSet" />
            </AssociationSet>
            <AssociationSet Name="Person_PersonToLocation" Association="GraphModel.Person_PersonToLocation">
              <End Role="Person" EntitySet="NodeSet" />
              <End Role="PersonToLocation" EntitySet="LinkSet" />
            </AssociationSet>
            <AssociationSet Name="Location_PersonToLocation" Association="GraphModel.Location_PersonToLocation">
              <End Role="Location" EntitySet="NodeSet" />
              <End Role="PersonToLocation" EntitySet="LinkSet" />
            </AssociationSet>
          </EntityContainer>
          <EntityType Name="Node" Abstract="true">
            <Key>
              <PropertyRef Name="NodeId" />
            </Key>
            <Property Name="NodeId" Type="Int32" Nullable="false" />
            <Property Name="Name" Type="String" Nullable="false" />
            <Property Name="Description" Type="String" Nullable="true" />
          </EntityType>
          <EntityType Name="Person" BaseType="GraphModel.Node" >
            <NavigationProperty Name="Leaders" Relationship="GraphModel.PersonPersonToPerson_Leader" FromRole="Person" ToRole="PersonToPerson" />
            <NavigationProperty Name="Followers" Relationship="GraphModel.PersonPersonToPerson_Follower" FromRole="Person" ToRole="PersonToPerson" />
            <NavigationProperty Name="Locations" Relationship="GraphModel.Person_PersonToLocation" FromRole="Person" ToRole="PersonToLocation" />
          </EntityType>
          <EntityType Name="Location" BaseType="GraphModel.Node" >
            <NavigationProperty Name="Visitors" Relationship="GraphModel.Location_PersonToLocation" FromRole="Location" ToRole="PersonToLocation" />
          </EntityType>
          <EntityType Name="Link" Abstract="true">
            <Key>
              <PropertyRef Name="LinkId" />
            </Key>
            <Property Name="LinkId" Type="Int32" Nullable="false" />
            <Property Name="Name" Type="String" Nullable="true" />
            <Property Name="Description" Type="String" Nullable="true" />
          </EntityType>
          <EntityType Name="PersonToPerson" BaseType="GraphModel.Link" >
            <NavigationProperty Name="Leader" Relationship="GraphModel.PersonPersonToPerson_Leader" FromRole="PersonToPerson" ToRole="Person" />
            <NavigationProperty Name="Follower" Relationship="GraphModel.PersonPersonToPerson_Follower" FromRole="PersonToPerson" ToRole="Person" />
          </EntityType>
          <EntityType Name="PersonToLocation" BaseType="GraphModel.Link" >
            <NavigationProperty Name="Person" Relationship="GraphModel.Person_PersonToLocation" FromRole="PersonToLocation" ToRole="Person" />
            <NavigationProperty Name="Location" Relationship="GraphModel.Location_PersonToLocation" FromRole="PersonToLocation" ToRole="Location" />
          </EntityType>
          <Association Name="PersonPersonToPerson_Leader">
            <End Type="GraphModel.Person" Role="Person" Multiplicity="1" />
            <End Type="GraphModel.PersonToPerson" Role="PersonToPerson" Multiplicity="*" />
          </Association>
          <Association Name="PersonPersonToPerson_Follower">
            <End Type="GraphModel.Person" Role="Person" Multiplicity="1" />
            <End Type="GraphModel.PersonToPerson" Role="PersonToPerson" Multiplicity="*" />
          </Association>
          <Association Name="Person_PersonToLocation">
            <End Type="GraphModel.Person" Role="Person" Multiplicity="1" />
            <End Type="GraphModel.PersonToLocation" Role="PersonToLocation" Multiplicity="*" />
          </Association>
          <Association Name="Location_PersonToLocation">
            <End Type="GraphModel.Location" Role="Location" Multiplicity="1" />
            <End Type="GraphModel.PersonToLocation" Role="PersonToLocation" Multiplicity="*" />
          </Association>
        </Schema>
      </edmx:ConceptualModels>
      <!-- C-S mapping content -->
      <edmx:Mappings>
        <Mapping xmlns="urn:schemas-microsoft-com:windows:storage:mapping:CS" Space="C-S">
          <Alias Key="Model" Value="GraphModel" />
          <Alias Key="Target" Value="GraphModel.Store" />
          <EntityContainerMapping CdmEntityContainer="GraphModelContainer" StorageEntityContainer="GraphModelStoreContainer">
            <EntitySetMapping Name="LinkSet">
              <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Link)">
                <MappingFragment StoreEntitySet="Link">
                  <ScalarProperty Name="Description" ColumnName="Description" />
                  <ScalarProperty Name="Name" ColumnName="Name" />
                  <ScalarProperty Name="LinkId" ColumnName="LinkID" />
                </MappingFragment>
              </EntityTypeMapping>
              <EntityTypeMapping TypeName="IsTypeOf(GraphModel.PersonToPerson)">
                <MappingFragment StoreEntitySet="Link" >
                  <ScalarProperty Name="LinkId" ColumnName="LinkID" />
                  <Condition ColumnName="LinkTypeDiscriminator" Value="1" />
                </MappingFragment>
              </EntityTypeMapping>
              <EntityTypeMapping TypeName="IsTypeOf(GraphModel.PersonToLocation)">
                <MappingFragment StoreEntitySet="Link" >
                  <ScalarProperty Name="LinkId" ColumnName="LinkID" />
                  <Condition ColumnName="LinkTypeDiscriminator" Value="2" />
                </MappingFragment>
              </EntityTypeMapping>
            </EntitySetMapping>
            <EntitySetMapping Name="NodeSet">
              <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Node)">
                <MappingFragment StoreEntitySet="Node">
                  <ScalarProperty Name="Description" ColumnName="Description" />
                  <ScalarProperty Name="Name" ColumnName="Name" />
                  <ScalarProperty Name="NodeId" ColumnName="NodeID" />
                </MappingFragment>
              </EntityTypeMapping>
              <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Person)">
                <MappingFragment StoreEntitySet="Node" >
                  <ScalarProperty Name="NodeId" ColumnName="NodeID" />
                  <Condition ColumnName="NodeTypeDiscriminator" Value="1" />
                </MappingFragment>
              </EntityTypeMapping>
              <EntityTypeMapping TypeName="IsTypeOf(GraphModel.Location)">
                <MappingFragment StoreEntitySet="Node" >
                  <ScalarProperty Name="NodeId" ColumnName="NodeID" />
                  <Condition ColumnName="NodeTypeDiscriminator" Value="2" />
                </MappingFragment>
              </EntityTypeMapping>
            </EntitySetMapping>
            <AssociationSetMapping Name="PersonPersonToPerson_Follower" TypeName="GraphModel.PersonPersonToPerson_Follower" StoreEntitySet="Link">
              <EndProperty Name="Person">
                <ScalarProperty Name="NodeId" ColumnName="FollowerID" />
              </EndProperty>
              <EndProperty Name="PersonToPerson">
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
              </EndProperty>
            </AssociationSetMapping>
            <AssociationSetMapping Name="PersonPersonToPerson_Leader" TypeName="GraphModel.PersonPersonToPerson_Leader" StoreEntitySet="Link">
              <EndProperty Name="Person">
                <ScalarProperty Name="NodeId" ColumnName="LeaderID" />
              </EndProperty>
              <EndProperty Name="PersonToPerson">
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
              </EndProperty>
            </AssociationSetMapping>
            <AssociationSetMapping Name="Person_PersonToLocation" TypeName="GraphModel.Person_PersonToLocation" StoreEntitySet="Link">
              <EndProperty Name="Person">
                <ScalarProperty Name="NodeId" ColumnName="PersonID" />
              </EndProperty>
              <EndProperty Name="PersonToLocation">
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
              </EndProperty>
            </AssociationSetMapping>
            <AssociationSetMapping Name="Location_PersonToLocation" TypeName="GraphModel.Location_PersonToLocation" StoreEntitySet="Link">
              <EndProperty Name="Location">
                <ScalarProperty Name="NodeId" ColumnName="LocationID" />
              </EndProperty>
              <EndProperty Name="PersonToLocation">
                <ScalarProperty Name="LinkId" ColumnName="LinkID" />
              </EndProperty>
            </AssociationSetMapping>
          </EntityContainerMapping>
        </Mapping>
      </edmx:Mappings>
    </edmx:Runtime>
    <!-- EF Designer content (DO NOT EDIT MANUALLY BELOW HERE) -->
    <edmx:Designer xmlns="http://schemas.microsoft.com/ado/2007/06/edmx">
      <edmx:Connection>
        <DesignerInfoPropertySet>
          <DesignerProperty Name="MetadataArtifactProcessing" Value="EmbedInOutputAssembly" />
        </DesignerInfoPropertySet>
      </edmx:Connection>
      <edmx:Options>
        <DesignerInfoPropertySet>
          <DesignerProperty Name="ValidateOnBuild" Value="true" />
        </DesignerInfoPropertySet>
      </edmx:Options>
      <!-- Diagram content (shape and connector positions) -->
      <edmx:Diagrams>
        <Diagram Name="GraphModel" ZoomLevel="114" >
          <EntityTypeShape EntityType="GraphModel.Node" Width="1.5" PointX="5.875" PointY="1.375" Height="1.427958984375" />
          <EntityTypeShape EntityType="GraphModel.Person" Width="1.5" PointX="5.875" PointY="3.25" Height="1.4279589843749996" />
          <EntityTypeShape EntityType="GraphModel.Location" Width="1.5" PointX="7.75" PointY="4.625" Height="1.0992643229166665" />
          <InheritanceConnector EntityType="GraphModel.Location">
            <ConnectorPoint PointX="7.375" PointY="2.4176741536458342" />
            <ConnectorPoint PointX="8.5" PointY="2.4176741536458342" />
            <ConnectorPoint PointX="8.5" PointY="4.625" />
          </InheritanceConnector>
          <EntityTypeShape EntityType="GraphModel.Link" Width="1.5" PointX="2.875" PointY="1.375" Height="1.427958984375" />
          <EntityTypeShape EntityType="GraphModel.PersonToPerson" Width="1.75" PointX="2.75" PointY="3.25" Height="1.2636116536458326" />
          <InheritanceConnector EntityType="GraphModel.PersonToPerson" ManuallyRouted="false">
            <ConnectorPoint PointX="3.625" PointY="2.802958984375" />
            <ConnectorPoint PointX="3.625" PointY="3.25" />
          </InheritanceConnector>
          <InheritanceConnector EntityType="GraphModel.Person">
            <ConnectorPoint PointX="6.625" PointY="3.4603483072916683" />
            <ConnectorPoint PointX="6.625" PointY="3.25" />
          </InheritanceConnector>
          <EntityTypeShape EntityType="GraphModel.PersonToLocation" Width="1.875" PointX="0.75" PointY="4.625" Height="1.2636116536458326" />
          <InheritanceConnector EntityType="GraphModel.PersonToLocation">
            <ConnectorPoint PointX="2.875" PointY="2.4176741536458342" />
            <ConnectorPoint PointX="1.65625" PointY="2.4176741536458342" />
            <ConnectorPoint PointX="1.65625" PointY="4.625" />
          </InheritanceConnector>
          <AssociationConnector Association="GraphModel.PersonPersonToPerson_Leader">
            <ConnectorPoint PointX="5.875" PointY="3.8818058268229163" />
            <ConnectorPoint PointX="4.5" PointY="3.8818058268229163" />
          </AssociationConnector>
          <AssociationConnector Association="GraphModel.PersonPersonToPerson_Follower">
            <ConnectorPoint PointX="5.875" PointY="3.5034029134114579" />
            <ConnectorPoint PointX="4.5" PointY="3.5034029134114579" />
          </AssociationConnector>
          <AssociationConnector Association="GraphModel.Person_PersonToLocation">
            <ConnectorPoint PointX="6.625" PointY="4.677958984375" />
            <ConnectorPoint PointX="6.625" PointY="5.0078214863281243" />
            <ConnectorPoint PointX="2.625" PointY="5.0078214863281243" />
          </AssociationConnector>
          <AssociationConnector Association="GraphModel.Location_PersonToLocation">
            <ConnectorPoint PointX="7.75" PointY="5.40018798828125" />
            <ConnectorPoint PointX="2.625" PointY="5.40018798828125" />
          </AssociationConnector>
        </Diagram>
      </edmx:Diagrams>
    </edmx:Designer>
  </edmx:Edmx> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-03T08:19:53.457

啊啊啊！

EntityModelCodeGenerator 在两个表之间创建**0..1 to many**关系，使其**1 to many**。

在这种情况下，它可能是一个可能的解决方案。

最好的祝福！萨拉赫丁

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-16T16:00:26.607

我有这个错误，它表明我在数据库中删除的列没有在模型中删除。我从模型中删除了它，错误就消失了。不过，那是*我的*情况。也许它会帮助某人。

# c# - C# 扩展面板

> ID：558464
> 
> 赞同：0
> 
> 时间：2009-02-17T19:55:59.503
> 
> 标签：c#

[![替代文字](https://i.stack.imgur.com/TH6TL.png)](https://i.stack.imgur.com/TH6TL.png)
[（来源：[ctho.org](http://www.ctho.org/blog/wp-content/uploads/2008/10/error-dialog.png)）]

c# 是否有类似的控件？ control and coudnt find any options for it 有人知道它的名称或将实现相同行为的技术吗？

编辑：是的，它专门是一个桌面应用程序窗口。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T20:00:44.263

我不知道有什么控件可以做到这一点，因为坦率地说，实现自己非常简单。只需在您的表单上放置一个显示“更多详细信息”的按钮，然后在 OnClick 事件中更改面板的大小（如果需要，还可以更改表单），同时标记您希望显示的控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T19:58:47.547

没有本机模仿该功能的 WinForms 控件。您必须以一种或另一种形式自行滚动，或找到第三方控件。

您可能可以强制进行竞标的一种类似的控制是水平方向的 SplitContainer。如果您连接一个按钮以打开和关闭顶部面板上的可见性，则会产生“扩展/隐藏”效果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T19:58:30.370

假设这是一个 Web 应用程序，有一个[Ajax Toolkit Control](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/CollapsiblePanel/CollapsiblePanel.aspx)用于此，或者您可以使用[jQuery](http://docs.jquery.com/Effects/slideToggle)。

# c - 如何从任意 pthread_t 获取线程 ID？

> ID：558469
> 
> 赞同：44
> 
> 时间：2009-02-17T19:57:42.680
> 
> 标签：c, linux, unix, pthreads, system-calls

我有一个 pthread_t，我想更改它的 CPU 亲和力。问题是我使用的是 glibc 2.3.2，它没有[pthread_setaffinity_np()](http://www.kernel.org/doc/man-pages/online/pages/man3/pthread_setaffinity_np.3.html)。不过没关系，因为 pthread_setaffinity_np() 本身就是[sched_setaffinity()](http://linux.die.net/man/2/sched_setaffinity)的包装器，可以通过传递线程 ID 而不是进程 ID 来调用它来设置任意线程的亲和性。

**但是**...... sched_setaffinity 可以使用的线程 id 是操作系统线程 id，您可以从[gettid()](http://linux.die.net/man/2/gettid)系统调用中获得这种类型。**这与不透明类型 pthread_t 不同**，gettid() 只会返回*当前线程*的线程 ID 。我需要能够设置任意线程的 CPU 亲和性。

不幸的是，我无法访问 pthread 的私有部分，这会让我通过将 pthread_t 强制转换为 a 来窃取线程 ID `struct pthread *`。我猜这样会更好，因为依赖私有实现会带来*更多*麻烦。

我也一直在阅读[pthread_getunique_np](http://cs.pub.ro/~apc/2003/resources/pthreads/uguide/users-23.htm)函数，但是这会返回一个“唯一的整数标识符”——我不相信它在任何形状或形式上都等同于操作系统线程 ID。

因此，问题是：如何从任意 pthread_t 获取线程 ID？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-17T21:29:49.683

由于`pthread`s 不需要使用 Linux 线程（或内核线程，就此而言）实现，并且某些实现完全是用户级的或混合的，因此`pthread`s 接口不提供访问这些实现细节的函数，因为那些不可移植（即使跨`pthread`Linux 上的 s 实现）。使用这些的线程库可以将其作为扩展提供，但似乎没有任何这样做。

除了访问线程库的内部数据结构（这是可以理解的，尽管您对处理器亲和性和 Linux 线程 ID 的假设，您的代码无论如何都不会是可移植的），您也许可以在创建时玩一个技巧，如果您控制创建线程的代码：

给出`pthread_create()`一个调用的入口函数`gettid()`（顺便说一下，您可能不得不`syscall`直接使用宏，因为它并不总是由 导出`libc`），将结果存储在某处，然后调用原始入口函数。`arg`如果您有多个线程具有相同的入口函数，则可以将递增的指针传递到参数中的数组中`pthread_create`，然后将其传递给您创建的入口函数以存储线程 ID。将 的`pthread_t`返回值存储`pthread_create`在相同的顺序，然后您将能够在给定`pthread_t`值的情况下查找您创建的所有线程的 Linux 线程 ID 。

这个技巧是否值得，取决于在您的情况下设置 CPU 亲和性的重要性，而不是不访问线程库的内部结构或取决于提供`pthread_setaffinity_np`.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-09-10T02:06:49.247

实际上`pthread_self`返回`pthread_t`而不是您可以使用的整数线程 id，以下帮助函数将以可移植的方式在不同的 POSIX 系统中为您提供。

```
uint64_t gettid() {
    pthread_t ptid = pthread_self();
    uint64_t threadId = 0;
    memcpy(&threadId, &ptid, std::min(sizeof(threadId), sizeof(ptid)));
    return threadId;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-09-06T10:40:08.807

```
pthread_t pthread_self() 
```

这返回当前的 pthread_t，即线程 id，你可以将其转换为类型“unsigned int”，

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-09-21T11:56:04.667

在*glibc 2.24*中，`pthread_t`返回的只是指向 opaque 的指针`struct pthread`。您可以在 中查找定义`nptl/descr.h`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T21:23:13.083

我建议使用共享 int 数组的简单解决方法，您可以在其中从线程中写入线程 id 以便稍后访问它。

希望有帮助。

# eclipse - 由于OOME，其他任何人都有带有Flex Builder 的Eclipse 3.4 经常崩溃吗？

> ID：558471
> 
> 赞同：1
> 
> 时间：2009-02-17T19:57:54.443
> 
> 标签：eclipse, memory, flexbuilder, ganymede

我首先应该说我对配置 Eclipses 内存设置非常熟悉。我目前正在使用已发布配置之一的变体：

... --launcher.XXMaxPermSize 256m -vmargs -Xms40m -Xmx512m -Xss2m -Djava.net.preferIPv4Stack=true -Dcom.sun.management.jmxremote

根据 JConsole 和内部堆监视器，Eclipse 永远不会接近堆用完。

它所做的是不断因 OOME 而崩溃，例如每 30-50 分钟一次。有时它告诉我有一个 OOME，有时它只是默默地关闭。奇怪的是，一直运行的 OTHER eclipse 实例（J2EE 版本）从未崩溃过一次，即使有更多的源文件。

崩溃后有一次或两次它是僵尸进程，我看到它的内存占用量 - 大约 1.5gigs，远高于堆监视器所说的使用量。那么，有什么关系呢？有什么泄漏？我确实注意到活动线程的数量似乎在不断增加。

有人遇到这个问题并解决了吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T22:04:10.310

根据[这个站点](http://polygeek.com/508_flex_improving-performance-of-eclipseflexbuilder)，Eclipse/Flex Builder 的正确内存设置是：

```
-Xms256m
-Xmx512m 
```

这些是我用于 eclipse 的内存设置，它似乎工作正常。希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-18T12:13:18.653

根据项目的规模和复杂性，您可能需要提高分配给 FlexBuilder 的内存。您可以尝试使用不同的 JVM。如果 Flexbuidler 无法启动，那么您可能会给它太多内存。

这个问题没有圣杯，但分享我的`FlexBuilder.ini`可能会有所帮助：

```
-vm
C:\Program Files\Java\jdk1.6.0_20\bin\javaw.exe

-vmargs
-Xms1024m
-Xmx1224m
-XX:MaxPermSize=365m
-XX:PermSize=256m
-Djava.net.preferIPv4Stack=true 
```

# c++ - 使用 System.Diagnostics C++.Net 2003 fx1.1

> ID：558473
> 
> 赞同：0
> 
> 时间：2009-02-17T19:58:22.930
> 
> 标签：c++, c#-3.0, clickonce

当 ClickOnce 部署应用程序时，它会生成一个允许您执行应用程序的 .application 文件，因此当我告诉他调用第一个文件（来自 ClickOnce 的 .application 文件时，主应用程序是使用 Fx1.1 在 C++.Net 2003 上构建的部署 C# 3.0 应用程序）他不知道如何¿？！

我试图编写一些代码片段，下面的代码无法“打开”从 ClickOnce 生成的 .application 文件。谢谢

```
private: System::Void button1_Click(System::Object^  sender, System::EventArgs^  e) {
             System::Diagnostics::Process app ;
             app.StartInfo->FileName = "C:\INFORME\SRIMedico.application";
             app.StartInfo->Arguments = "";
             app.Start();

         } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T20:20:56.587

我不太清楚您正在寻找什么，但据我所知 ClickOnce 它并不意味着用于部署 VC++ 应用程序。

请参阅[Visual C++ 的 ClickOnce 部署](http://msdn.microsoft.com/en-us/library/ms235287(VS.80).aspx)

编辑：

在您的代码示例中，有一件事让我大吃一惊：您没有转义“\”字符（这是 C++ 中的特殊字符），在这种情况下，您提供的路径将无效。请像这样重试：

```
 // .. rest of code in your sample ommited 
    app.StartInfo->FileName = "C:\\INFORME\\SRIMedico.application";
    // .. rest of code in your sample ommited 
```

我之前忽略的另一件事是，虽然您可以使用 System::Diagnostics::Process 启动 ClickOnce 应用程序安装程序，但它只能使用您最初安装应用程序的位置，而不是安装应用程序的位置。请参阅[Process.StartInfo 文档中的备注部分](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.startinfo.aspx#remarksToggle)。

如果您已将应用程序安装在计算机上，您也可以使用**.appref-ms应用程序参考文件来启动该应用程序。**假设这个文件位于 C:\INFORME\ 你可以这样写：

```
 System::Diagnostics::Process^ app = gcnew System::Diagnostics::Process()
    app->StartInfo->FileName = "C:\\INFORME\\SRIMedico.appref-ms";
    app->StartInfo->Arguments = "";
    app->StartInfo->CreateNoWindow = "false";
    app->Start(); 
```

我希望这有帮助！

# c++ - 什么更有意义 - char* string 或 char *string？

> ID：558474
> 
> 赞同：32
> 
> 时间：2009-02-17T19:58:24.427
> 
> 标签：c++, string, pointers

我目前正在学习 C++，并且遇到了很多以空字符结尾的字符串。这让我想到，在声明指针时更有意义的是：

```
char* string 
```

或者

```
char *string 
```

? 对我来说，char* 格式更有意义，因为“字符串”的类型是指向 char 的指针，而不是 char。但是，我通常看到后一种格式。显然，这也适用于引用。

有人能告诉我后一种格式是否有合理的原因吗？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-02-17T19:59:28.743

在以下声明中：

```
char* string1, string2; 
```

`string1`是一个字符指针，但`string2`只是一个字符。因此，声明的格式通常如下：

```
char *string1, string2; 
```

这使得`*`适用于`string1`但不适用于更清楚一点`string2`。好的做法是避免在一个声明中声明多个变量，特别是如果其中一些是指针。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-02-17T20:04:11.743

Bjarne Stroustrup 对此有[话要说](http://www.stroustrup.com/bs_faq2.html#whitespace)：

> （仅）当人们试图用一个声明声明多个指针时，才会出现严重的混淆：

```
int* p, p1; // probable error: p1 is not an int* 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-19T15:02:17.867

从技术上讲，写是有意义的

```
char *f 
```

因为`*f`是其中的声明符，而`char`是声明说明符，它指定所有声明符的基本类型。声明符包含诸如`()`,之类的运算符`[]`，`&`可以考虑修改基本类型和实际标识符。

我使用上面的形式放入`*`标识符是因为它强调`*f`实际上是声明符，而是`char`基本类型。

在某种程度上，当运算符应用于标识符时，可以考虑使用声明符中的修饰符在声明说明符中生成类型。但它并不总是有效：

```
int a, *b, &c = a, d(), e[1], C::*f; 
```

请注意所有的、 和`a`静态`*b`解析为 int - 除了分别声明引用（因此需要初始化）和指向类成员的指针之外。`d()``e[1]``&c``C::*`

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-17T20:36:35.240

没有人提到的是以下内容

```
char *string 
```

也可以读作将表达式的类型`*string`（读作：应用于指针的间接运算符`string`）声明为`char`. 从这个角度来看，这个符号是完全合理的。

话虽如此，我使用

```
char * string 
```

我自己;)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-17T20:36:22.383

（在大多数情况下，std::string 比 char* 好。）

我总是将 * 与类型放在一起，就像在 char* 中一样，因为[正如 Stroustrup 指出](http://www.stroustrup.com/bs_faq2.html#whitespace)的那样，这强调了类型。

而且我从不在一行上声明变量，以避免在此处的回复中讨论的常见问题；

```
char* p, q;  // oops, probably not what was meant
// this is mandated by our style guide:
char* p;
char* q; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-17T20:07:45.887

在 C++ 中，将 * 放在像 char* 这样的类型标识符上是有意义的，因为它是类型本身的一部分。

但是，如果您在同一个语句中定义多个变量，这会变得模棱两可和误导。

```
char* foo, bar; 
```

虽然 foo 现在具有 char* 类型，但 bar 具有 char 类型。所以很多人喜欢

```
char *foo, bar; 
```

说清楚。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-17T20:21:27.663

我的回答：两者都不是，你应该使用：

```
char * string; 
```

考虑一下，如果 Dennis Ritchie（C 语言的设计者）使用关键字“ptr”而不是使用“*”字符，我们都会说：

```
char ptr string; 
```

并且没有进行这些讨论。

恕我直言，它也更具可读性。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-17T20:00:55.077

鉴于您可以在一行上进行多个声明，对我来说，它属于变量而不是类型更有意义，例如

```
char *pString, arrString[20]; 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-17T20:13:44.607

在大多数情况下，`std::string str`比 a 更可取`char *`。

话虽如此，我通常会做类似的事情`DataType * ptr`，以使`*`脱颖而出。或者，更常见的是`std::tr1::smart_ptr<DataType> ptr`，，或者可能是一个`auto_ptr`。

很简单，在很多方面使用原始指针都是危险的，如果我要使用其中一种，我希望它能够脱颖而出。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-17T20:13:48.023

我真的很喜欢 " `char* foo`" 成语，因为它将有关变量类型的所有信息都放在一个地方。如果 " " 部分在屏幕的一半处被标记， " `char *foo`" 可能会很混乱！`*foo`

另一方面，我确实同意其他发帖人的观点，即在一行上声明多个变量时会让人感到困惑。在一行上声明多个变量时，我尽量不要混合类型，并且`char`在`char*`我看来是单独的类型，因此这种特殊情况不会出现在我的代码中。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-17T20:03:41.387

我也认为 char* foo 在声明单个变量时更有意义。

我使用另一种格式的唯一一次是在一行上声明多个变量，例如：

字符 *foo, 酒吧;

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-17T20:13:02.660

就我个人而言，我从不在一行上声明多个变量。

正因为如此，而且我真的觉得模式很好，我发现这个简单的模式很有吸引力：

```
type varname 
```

这意味着我几乎总是说 int[] iArray 或 int* piArray （或者无论匈牙利符号是什么，我已经有十年没有使用 C++）了。

这也意味着我从不使用 int iArray[]，因为它是一个数组这一事实是类型的一部分，而不是变量名。

以这种方式思考也帮助我简化了几次定义。

只是提供另一个 POV

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-17T22:34:54.720

只要您每行只声明一个变量，第一个建议（char* var）就可以了，但就个人而言，我更喜欢“char *var;” **每行**一个变量 - 它可能会使函数的行数更长，但非常清楚。

最后，C++ 应该使用“string var”，但我们总是最终要么用“char *”继承代码，要么必须连接到非 C++ 库。

# matlab - 如何在 MATLAB 匿名函数中执行多个语句？

> ID：558478
> 
> 赞同：44
> 
> 时间：2009-02-17T19:59:02.973
> 
> 标签：matlab, command-line, anonymous-function

我想做这样的事情：

```
>> foo = @() functionCall1() functionCall2() 
```

所以当我说：

```
>> foo() 
```

它将执行`functionCall1()`然后执行`functionCall2()`。（我觉得我需要像[C , operator](http://www.eskimo.com/~scs/cclass/int/sx4db.html)之类的东西）

编辑：

`functionCall1`并且`functionCall2`不一定是返回值的函数。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-02-17T21:49:09.340

尝试通过命令行完成所有操作而不将函数保存在 m 文件中可能是一项复杂而混乱的工作，但这是我想出的一种方法......

首先，创建你的[匿名函数](http://www.mathworks.com/help/matlab/matlab_prog/anonymous-functions.html)并将它们的[句柄](https://www.mathworks.com/help/matlab/function-handles.html)放在一个[单元格数组](https://www.mathworks.com/help/matlab/cell-arrays.html)中：

```
fcn1 = @() ...;
fcn2 = @() ...;
fcn3 = @() ...;
fcnArray = {fcn1 fcn2 fcn3}; 
```

...或者，如果您已经定义了函数（例如在 m 文件中），请将函数句柄放在一个元胞数组中，如下所示：

```
fcnArray = {@fcn1 @fcn2 @fcn3}; 
```

然后，您可以创建一个新的匿名函数，该函数使用内置函数调用数组中的每个函数，[`cellfun`](https://www.mathworks.com/help/matlab/ref/cellfun.html)并且[`feval`](https://www.mathworks.com/help/matlab/ref/feval.html)：

```
foo = @() cellfun(@feval,fcnArray); 
```

虽然看起来很有趣，但它确实有效。

**编辑：**如果`fcnArray`需要使用输入参数调用函数，您首先必须确保数组中的所有函数都需要相同数量的输入。在这种情况下，以下示例显示如何调用具有一个输入参数的函数数组：

```
foo = @(x) cellfun(@feval,fcnArray,x);
inArgs = {1 'a' [1 2 3]};
foo(inArgs);  %# Passes 1 to fcn1, 'a' to fcn2, and [1 2 3] to fcn3 
```

**警告词：**用于[`cellfun`](https://www.mathworks.com/help/matlab/ref/cellfun.html)说明计算输出元素的*顺序*的文档未指定且不应依赖。这意味着不能保证在或`fcn1`之前得到评估。如果顺序很重要，则不应使用上述解决方案。`fcn2``fcn3`

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T05:39:24.810

Matlab 中的匿名函数语法（像其他一些语言一样）只允许一个表达式。此外，它具有不同的变量绑定语义（不在参数列表中的变量在函数创建时具有词法绑定的*值*，而不是绑定引用）。这种简单性允许 Mathworks 在幕后进行一些优化，并在脚本中使用它们时避免很多混乱的范围和对象生命周期问题。

如果您在函数（而不是脚本）中定义此匿名函数，则可以创建命名内部函数。内部函数具有正常的词法引用绑定并允许任意数量的语句。

```
function F = createfcn(a,...)
  F = @myfunc;
  function b = myfunc(...)
    a = a+1; 
    b = a; 
  end
end 
```

有时你可以通过像 gnovice 的建议这样的技巧侥幸逃脱。

使用 eval 时要小心……它的效率非常低（它绕过了 JIT），而且 Matlab 的优化器可能会混淆在 eval 表达式内部使用的外部范围的变量和函数。也很难调试和/或扩展使用 eval 的代码。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-10-17T18:55:24.673

这是一种保证执行顺序的方法，并且（在最后提到的修改）允许将不同的参数传递给不同的函数。

```
call1 = @(a,b) a();
call12 = @(a,b) call1(b,call1(a,b)); 
```

关键是`call1`调用它的第一个参数并忽略它的第二个参数。`call12`调用它的第一个参数，然后调用它的第二个，从第二个返回值。它之所以有效，是因为函数不能在其参数之前进行评估。要创建您的示例，您将编写：

```
foo = @() call12(functionCall1, functionCall2); 
```

**测试代码**

这是我使用的测试代码：

```
>> print1=@()fprintf('1\n');
>> print2=@()fprintf('2\n');
>> call12(print1,print2)
1
2 
```

**调用更多函数**

要调用 3 个函数，您可以编写

```
call1(print3, call1(print2, call1(print1,print2))); 
```

4个功能：

```
call1(print4, call1(print3, call1(print2, call1(print1,print2)))); 
```

更多功能，继续嵌套模式。

**传递参数**

如果您需要传递参数，您可以编写一个带有`call1`参数的版本，然后对`call12`.

```
call1arg1 = @(a,arg_a,b) a(arg_a);
call12arg1 = @(a, arg_a, b, arg_b) call1arg1(b, arg_b, call1arg1(a, arg_a, b)) 
```

您还可以制作带有多个参数的 call1 版本，并根据需要混合和匹配它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-01-14T18:00:57.707

可以使用用于创建逗号分隔列表的[curly函数。](http://blogs.mathworks.com/loren/2013/01/24/introduction-to-functional-programming-with-anonymous-functions-part-2/#eadbce51-e1cc-46e9-80ea-58f1108621fc)

```
curly = @(x, varargin) x{varargin{:}};
f=@(x)curly({exp(x),log(x)})
[a,b]=f(2) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T12:30:29.690

如果`functionCall1()`and `functionCall2()`return something 并且这些东西可以连接起来，那么你可以这样做：

`>> foo = @() [functionCall1(), functionCall2()]`

或者

`>> foo = @() [functionCall1(); functionCall2()]`

这样做的一个副作用是，`foo()`它将返回任何内容的串联`functionCall1()`并`functionCall2()`返回。

不知道`functionCall1()`and的执行顺序`functionCall2()`是否有保证。

# design-patterns - 我在哪里可以了解生物力学算法？

> ID：558490
> 
> 赞同：2
> 
> 时间：2009-02-17T20:01:49.160
> 
> 标签：design-patterns

我计划开始开发人体运动识别软件，该软件将监控加速度并识别运动模式（跑步、步行、跳跃......）。

我已经开始收集有关生物力学的书籍，如果能得到一些关于模式比较和检测的好书会很好。

我可以从哪里开始阅读一些可能对项目有用的阅读材料？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T20:23:40.170

> 我可以从哪里开始阅读一些可能对项目有用的阅读材料？

我建议开始与该领域的领域专家交谈......和/或在大学图书馆。

我发现我所在的当地大学从政府那里获得了一些资金，因此允许包括非学生在内的任何人以少量费用获得借书证……而且图书馆`*`很大`*`。

除了书籍，一个好的大学图书馆还可以让您访问（可能是在线访问）专业期刊（例如关于生物力学的）。

# sql - 全文索引未更新 (SQL 2005)

> ID：558491
> 
> 赞同：3
> 
> 时间：2009-02-17T20:02:29.533
> 
> 标签：sql, sql-server-2005, full-text-search

直到上周，我有一张表格在全文搜索方面做得很好。有超过 700 万条记录，我看到它在全文索引中有超过 700 万条条目。

但是搜索结果中不会出现比一周前的更新。我可以在表格的全文索引属性中看到，“待定”条目的数量在不断增加（今天可能有 30000 个），可能对应于它尚未添加到索引中的内容。

我检查的第一件事是索引是否启用。不是，所以我启用了它，启动“ALTER FULLTEXT INDEX”作业的进程开始阻塞服务器上的所有其他请求，所以我把它杀死了。

我已确认全文索引服务正在运行并自动启动。我还确认它会自动检查更改，尽管从“自动”到“手动”再到“关闭”似乎并没有做太多，除了重置排队结果的数量。（将其转回“自动”会将数字重置为 30,000。）

我试图重建全文索引，但对于“完整”和“增量”，它会返回一条关于“已经存在索引”的消息。“更新”说“命令成功完成”，但似乎没有任何效果。

我今天做的最后一件事是：

1.  禁用全文索引
2.  重建 FTI 所基于的聚集索引
3.  重新启用 FTI

这开始了“ALTER FULLTEXT INDEX”作业，该作业再次阻止了所有正在执行实际工作的进程。

我们正在尝试在选项 A：擦除现有 FTI 并从头开始重建和选项 B：执行禁用/重建/重新启用技巧之间做出决定，这似乎开始了一些有用的事情。（我们会先做 B，然后再做 A，但我们预计两者都有一两个小时的停机时间，而 A 过去曾工作过。）

有没有更快的方法来做到这一点？知道我最初是怎么遇到这种情况的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T21:20:16.243

这是一个有趣的问题。我认为你让自己陷入其中是因为它被禁用了。我可能已经找到了一种方法让你摆脱它而不会阻止其他一切。

首先，要知道这种行为是 SQL Server 2005 pre SP1 中的一个错误，请确保您有 SP1。

如果您已经这样做了，请尝试：

ALTER FULLTEXT INDEX ON tablename SET CHANGE_TRACKING MANUAL

ALTER FULLTEXT INDEX ON tablename START UPDATE POPULATION

如果可行，那么我认为您遇到了与[此](http://www.eggheadcafe.com/software/aspnet/30096293/still-have-stuck-pending.aspx)人相同的问题。他只是设置了一个每隔一小时左右运行一次的工作。当然，这是一个临时解决方案，但它会给您时间，直到您可以真正重建索引。

刚刚想到的其他事情，您是否尝试过重新组织索引？我知道它不会阻塞，但我不确定它是否会导致刷新以防止它阻塞的方式发生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T10:15:28.787

只是为了澄清您已检查创建索引的分区是否有空间。我们在全文索引不会更新的 DEV 环境中遇到了这个问题。

# java - servlet 如何获取 servlet 外部文件的绝对路径？

> ID：558502
> 
> 赞同：3
> 
> 时间：2009-02-17T20:06:14.733
> 
> 标签：java, tomcat, servlets, filepath, os-agnostic

我们一直在使用 System.getProperties("user.dir") 来获取属性文件的位置。现在它已部署在 Tomcat（通过 servlet）上，系统调用将位置作为 Tomcat，而不是属性文件所在的位置。

我们如何动态调用属性文件？

**鉴于：**

*   Tomcat 不是应用程序部署的唯一方式
*   我们无法控制应用程序的放置位置。
*   相对路径将不起作用，因为正在使用 Vista 并且 Vista 会破坏相对路径。
*   这必须适用于所有操作系统，包括（但不限于）Linux、XP 和 Vista。
*   **编辑**我暗示了这一点，但如果我不够清楚，我无法知道路径字符串。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T20:13:00.240

看看`ServletContext`'s [getResource](http://java.sun.com/products/servlet/2.3/javadoc/javax/servlet/ServletContext.html#getResource(java.lang.String))和[getResourceAsStream](http://java.sun.com/products/servlet/2.3/javadoc/javax/servlet/ServletContext.html#getResourceAsStream(java.lang.String))方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T22:42:03.910

您必须有办法知道属性文件的路径，然后您可以将其包装在 File 中并传递给属性对象的 load() 方法。

如果您在 Tomcat 服务中运行，则您没有以安装它的用户身份运行，因此您无法派生主目录。你很可能需要硬编码一些东西。

* * *

编辑：属性文件是相对于应用程序的。有关如何获取给定类的字节码文件名的示例，请参见[http://www.exampledepot.com/egs/java.lang/ClassOrigin.html 。](http://www.exampledepot.com/egs/java.lang/ClassOrigin.html)您应该可以从那里继续。

```
Class cls = this.getClass();
ProtectionDomain pDomain = cls.getProtectionDomain();
CodeSource cSource = pDomain.getCodeSource();
URL loc = cSource.getLocation();  // file:/c:/almanac14/examples/ 
```

您应该知道，一些安全管理器不允许这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:48:15.457

我认为[ClassName.class.getResourceAsStream()](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Class.html#getResourceAsStream(java.lang.String))会为你工作。该方法的注释指向[ClassLoader.getResource()](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/ClassLoader.html#getResource(java.lang.String))，它告诉您如何在类路径中指定文件。

像这样的东西应该工作：

```
InputStream foo = ClassName.class.getResourceAsStream("file.name"); 
```

其中 file.name 在某个地方的类路径的基础上。如果 file.name 在 com.foo.bar 包中，您将使用“/com/foo/bar/file.name”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-25T08:40:50.370

如果我正确理解了这个问题，另一种选择可能是`ServletContext.getRealPath()`在您的应用程序中调用 jsp 或静态文件并从结果中派生路径。

这意味着 webapp 部署为“扩展” - 即不是作为压缩的 war 文件 - 但这就是大多数 appservers 所做的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T20:27:32.593

您可以将您的属性文件放在您的类路径中，并使用以下内容将它们作为输入流读取：

ClassName.class.getResourceAsStream(filePath + fileName);

其中 filePath 是文件从类路径根目录的相对路径，fileName 是文件的名称。

如果您需要获取作为资源读取的文件的绝对路径，您可以执行以下操作：

ClassName.class.getResource(filePath + fileName).getPath()

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T21:19:03.093

是否可以将配置文件放在类路径中并通过 springs [ClassPathResource](http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/core/io/ClassPathResource.html)之类的东西引用它？

您应该可以像这样使用它：

```
ClassPathResource foo = new ClassPathResource("file.name"); 
```

其中 file.name 存在于类路径中最低级别的某个位置，例如：

*   /webapps/WEB-INF/classes/
*   您的 jar 文件之一的基础

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T22:05:24.870

另一种方法可能是使用 -D 参数将变量值传递给 JVM。这样，您可以将代码绑定到相同的变量名称，然后在启动时传递不同的值。我还没有尝试过，但我认为它也应该适用于部署在 Tomcat 中的应用程序，如果您修改 startCatalina 脚本以将 -D 参数传递给 JVM

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T14:10:14.817

您可以将属性文件的位置存储在 JNDI 中吗？

这应该可以跨 Tomcat 移植，并且适用于 Java EE 应用程序服务器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-03-19T13:55:34.557

我们有同样的要求。到目前为止，最简单的方法是将 basedir 属性存储在我们已经加载的属性文件之一中。然后定义一个类似 getExternalDocPath(String path) 的方法。

这使我们能够扩展 Tomcat 的文档库（只有 Tomcat 7 支持？）。在网上，有人发布了一个类，它实际上扩展了 Tomcat 的 docbase 以允许多个路径，即“alpha;baker;charlie”。

# winapi - Windows 中可以挂载的 USB 驱动器的数量是否有物理限制？

> ID：558509
> 
> 赞同：3
> 
> 时间：2009-02-17T20:09:05.650
> 
> 标签：winapi, usb-drive

我知道可以使用连接点来解决驱动器限制，但是在注册表中识别/安装并使用 MOUNTVOL 命令或 Win32 API 显示的物理设备的数量是否有限制？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T20:14:50.253

我不确定 Windows 是否施加了限制，但 USB 协议标准对每个主机控制器有 128 个设备的限制。允许的设备地址范围是 0 到 127。

您可以在此处下载 USB 规范：[http ://www.usb.org/developers/docs/](http://www.usb.org/developers/docs/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T20:19:56.980

我相信每个 USB 驱动器也可以分成多个逻辑分区。

如果最终您没有得到答案，请选择一个数字，如果超出您的预期，请优雅地失败。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T20:23:10.187

Win32 下存在限制，因为 MOUNTVOL 安装驱动器，必须为其分配驱动器号（DOS 遗留问题）。这意味着，由于 A 和 B 是为软盘驱动器保留的，而 C 是（默认情况下）第一个硬盘驱动器，因此您最多可以安装 23 个其他驱动器并为其分配驱动器号。驱动器的类型无关紧要 - USB、HDD 或 CD/DVD。

根据 Win32 文档，MountVol 具有以下语法：

```
mountvol [Drive:]Path VolumeName

mountvol [Drive:]Path /d

mountvol [Drive:]Path /L

mountvol Drive: /s 
```

# .net - 让 WCF 输出 XHTML 的最佳/最灵活的方法是什么？

> ID：558515
> 
> 赞同：2
> 
> 时间：2009-02-17T20:12:27.513
> 
> 标签：.net, wcf, web-services, rest

让 WCF 输出 XHTML 的最佳/最灵活的方法是什么？如果没有“WCF 方式”(tm) 来执行 XHTML 输出 - 是否有任何通用工具可供使用？还是我需要自己动手？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T22:18:36.133

WCF 关注数据的传输。它允许您为客户端/主机设置服务合同以进行对话。它抽象出您的传输，以便您可以轻松配置您的服务，无论是通过 HTTP/TCP/NamedPipes/Tibco EMS/任何您想要的。根据我的经验，通过网络传输的消息本身都默认序列化为 SOAP，但这当然也是可配置的。XHTML 是表示（是的，您可以说 CSS 是真正的表示，而 XHTML 是您的数据表示）。您基本上希望以一种可以通过网络浏览器呈现的方式返回您的数据。

这对我来说没有意义的原因是您似乎试图将 WCF 服务放置在 Web 服务器所属的位置。

但是让我们看看它是如何做到的：

您是否希望 WCF 基础结构通过网络将消息实际格式化为 XHTML？如果是这样并且您想向服务发送 REST 样式请求，请从[WCF REST Starter Kit](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)开始。

主要挑战是序列化。我知道 .Net 3.5 SP1 中的 WCF 允许使用 JsonDataContractSerializer 运行 WCF，而不是使用将对象序列化为 XML 的标准 DataContractSerializer。您可以编写自己的 XHTMLDataContractSerializer。但是，生成的 XHTML 将是您自己的。[这是](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/dcd48a7f-4494-455f-8504-cbdc372badcf/)一个让你开始的线程。

编辑：刚刚发现[这个](http://blogs.msdn.com/carlosfigueira/archive/2008/04/17/wcf-raw-programming-model-web.aspx)。我认为这绝对是一个选择。而且它似乎很容易实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T22:14:21.370

WCF 是一种组件技术 - 您编写接口及其实现，然后指示 WCF 如何处理安全性、传输等。

从 WCF 组件返回 XHTML 与从任何其他 .NET 组件返回 WCF 相同 - 可能作为字符串。只要您可以以基本类型或通过有效的数据协定从组件返回数据，您就应该很酷。

您可能想查看 Juval Lowy 编写的 Programming WCF Services 中的第 3 章 - 它全部是关于数据契约以及您可以从组件中吐出的所有内容。也许您正在寻找一些简洁的方法来在客户端从您的组件中取回某些内容后反序列化数据......如果是这样，Lowy 将向您展示如何。

因此，简短的回答是从您的组件返回 XHTML，但是您愿意。据我所知，没有从 WCF 组件发出 XHTML 的特殊方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T15:18:21.627

从 .NET 3.5 SP1 开始，我不相信有一种“官方”WCF 方式可以返回 XHTML。[Aaron Lerch 在 2007 年 7 月建议让 WCF 应用默认的 XSLT 样式表](http://www.aaronlerch.com/blog/2007/07/16/a-humble-wcf-feature-request-or-four/)，但是 WCF 团队尚未采用类似的方法。

[正如其他答案所述，您可以使用WCF Starter Kit](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)中的示例或使用[Carlos Figueira 描述的原始编程模型](http://blogs.msdn.com/carlosfigueira/archive/2008/04/17/wcf-raw-programming-model-web.aspx)来推出自己的 XHTML 支持。Michele Leroux Bustamante 在线提供的一些[WCF 示例代码](http://www.thatindigogirl.com)，作为她的[Learning WCF](http://oreilly.com/catalog/9780596101626/)书籍的一部分，如果您决定自己动手，将会很有帮助。

我们从基于 WCF 的 Web 服务返回 XHTML 以及 JSON 和 XML。虽然我不确定我们的方法是不是*最好*的方法，但它确实有效。

我们的方法是使用`DataContractSerializer`生成 XML，然后应用 Complied XSLT 转换并返回结果流，现在应该包含 XHTML。这是我们代码的简化版本：

```
public Stream GetItemAsHtml(string id) {
    Item obj = GetItem(objectId);
    Stream xml = GetXmlStream(obj);    
    return TransformXmlStream(xml, defaultTransform);
}        

public static Stream GetXmlStream(IXmlSerializable item) {
    MemoryStream stream = new MemoryStream();
    using (XmlWriter writer = XmlWriter.Create(stream, new XmlWriterSettings { Encoding = Encoding.UTF8 })) {
        if (writer != null) {
            DataContractSerializer dcs = new DataContractSerializer(item.GetType());
            dcs.WriteObject(writer, item);

            writer.Flush();
            writer.Close();
        }
    }
    stream.Seek(0, SeekOrigin.Begin);
    return stream;
}

public static Stream TransformXmlStream(Stream xml, string xsltFile) {
    XmlReader reader = XmlReader.Create(xml);

    XslCompiledTransform trans = new XslCompiledTransform();
    trans.Load(xsltFile);

    MemoryStream stream = new MemoryStream();
    using (XmlWriter writer = XmlWriter.Create(stream, trans.OutputSettings)) {
        if (writer != null) {
            trans.Transform(reader, writer);

            writer.Flush();
            writer.Close();
        }
    }
    stream.Seek(0, SeekOrigin.Begin);
    return stream;
} 
```

它完成了这项工作，但我不认为这是 WCF 的设计者所预期的场景。:-)

# javascript - 将对象序列化为 JSON

> ID：558518
> 
> 赞同：212
> 
> 时间：2009-02-17T20:13:15.933
> 
> 标签：javascript, json

如何在 JavaScript 中将对象序列化为 JSON？

* * *

## 回答 #1

> 赞同：296
> 
> 时间：2009-02-17T20:16:50.577

你正在寻找[`JSON.stringify()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-02-17T20:18:54.830

下载[`https://github.com/douglascrockford/JSON-js/blob/master/json2.js`](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)，包含它并执行

```
var json_data = JSON.stringify(obj); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-06-01T11:36:04.023

只是为了保持向后兼容，如果没有提供原生 JSON 支持，我会从[cloudflare CDN加载 Crockfords JSON 库（为简单起见，使用 jQuery）：](http://www.cloudflare.com/)

```
function winHasJSON(){
  json_data = JSON.stringify(obj);
  // ... (do stuff with json_data)
}
if(typeof JSON === 'object' && typeof JSON.stringify === 'function'){
  winHasJSON();
} else {
  $.getScript('//cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.min.js', winHasJSON)
} 
```

# perl - PostgreSQL 是否保持其 pl* 解释器持续加载？

> ID：558519
> 
> 赞同：3
> 
> 时间：2009-02-17T20:13:36.357
> 
> 标签：perl, postgresql, plperl

如果我在 plperlu 中写了一些东西，什么时候会重新加载该模块？每次函数运行时？第一次跑？如果 Perl DLL 有一段时间没有使用，它是否会被卸载，然后再重新加载另一个模块？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T16:20:09.013

我认为在该会话中首次使用该语言时，该模块将为每个服务器进程（即新会话/连接）加载一次。

根据和[的手册，`shared_preload_libraries`](http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-SHARED-PRELOAD-LIBRARIES)您可以预加载它们以避免在首次使用时出现任何延迟 [`local_preload_libraries`](http://www.postgresql.org/docs/current/static/runtime-config-client.html#GUC-LOCAL-PRELOAD-LIBRARIES)。

旧的 PostgreSQL 版本只有一个`preload_libraries`设置；如果您使用的是非常旧的东西，请参阅您的版本的手册。

# refactoring - Evolution 或 Revolution 修复写得不好的代码

> ID：558521
> 
> 赞同：6
> 
> 时间：2009-02-17T20:13:45.887
> 
> 标签：refactoring

我已经为我的个人项目做了一些工作，现在我明白为什么人们告诉我们在编码*之前计划好所有的界面和设计。*我有一些很好的课程并且已经有了一些工作代码，但总而言之，组织（架构）有点乱，我已经在说“如果我再做一次，我会这样做。 ……”。问题是，我是否应该草拟一个我希望我的代码外观的计划，并将现有代码重构为新模型，或者我是否应该采用最有效的方法，并为有缺陷的部分编写所有新代码（基本上是从从头开始，从这个项目中复制和粘贴了大量的内容）。

我有 git 历史我不确定我想失去，但慢慢重写一切的任务似乎令人生畏。所以我要问的问题是：在重构一个年轻的项目时，应该使用进化还是革命来第二次把它做好？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T20:16:02.027

重构旧代码（演进）。重写代码总是会引入你没有想到的问题。我确信现有代码已经更新，其中很多更新是错误修复增强等。您可能不知道当时为什么要进行更改，但是您需要这样做，并且重写代码可能会删除所需的改变。

采取小步骤还可以帮助您避免“哦，‘咒骂’”的场景，在这种场景中，您尝试做出一些巨大的改变，却遇到了它的行为与您期望的不同的情况。随着演进，您可以撤回更改并仍然拥有一个工作系统，因为架构已经完成了一些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:20:10.537

你如何修复一个大而糟糕的项目？那么，你如何清理奥吉安马厩...

### 稳定的清洁技术：

1.  如果你是大力神，你会以一种引人注目的、呃、华而不实的方式一次完成。
2.  如果你*不是*Hercules，你就拿一把铁锹，开始慢慢地一次一个地改进事情。

诀窍是提前认识到你是否有能力和能力来处理重写。低估自己，你会浪费很多时间在粪肥中涉水。高估了，你只会弄得更大的烂摊子……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:19:03.177

取决于您的情况 - 如果您有时间重新编写......并且不太明显地重新测试所有内容......把它吹走并重新开始。但要诚实地告诉自己那个时候会是什么样子。

Evolution 通常工作得更好——因为时间就是金钱，从头开始可能代表着巨大的投资......

很多人没有得到的另一点 - 进化实际上可以很好地工作 - 只是需要更多的思考......你必须弄清楚如何将现有的东西模块化 - 但通常这是很有可能的 - 只是额外的时间在白板。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T20:20:30.300

弄清楚*你*真的*想怎么做*。制作一张贴在墙上的图表，尝试考虑所有细节。

当您*进行*更改时，请尝试找出每个更改如何使您更接近最终目标。如果您在进行更改时心中有这个目标，那么您可以编写和测试与您想去的地方一致的东西。我经常发现我可以引入一些不太激进（但必要）的变化，并且仍然可以从中获利。

所以我提倡进化论，但要清楚地知道你（认为）你想去哪里。无论如何，你最终会去别的地方。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T20:16:15.477

通常，我使用进化，但在大的步骤中，两者都有一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T20:22:06.413

您需要将缓慢重写所有内容的任务（您可能在精神上夸大其词）与尝试快速重写所有内容的任务（您可能严重低估）进行比较。不要低估保留工作代码的价值，这是通过逐步重构获得的。

由于您没有描述您的平台，我不知道有哪些软件可用于重构支持。例如，Java 有很多，但 C++ 却很少。

对您和您的项目几乎一无所知，我建议以一种更进化的方式进行重构，并在您对旧代码感到反感或编写太多依赖于坏旧事物的新代码之前相当快地进行重构。您可能会发现代码太丑而无法生存并且需要重写；在这种情况下，请继续。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T20:25:05.750

革命的问题是需要很长时间，在此期间对最终用户没有价值。通过增量更改（演进），可以改进系统并使其始终运行。

Bob大叔对此事的看法：http: [//blog.objectmentor.com/articles/2009/01/09/the-big-redesign-in-the-sky](http://blog.objectmentor.com/articles/2009/01/09/the-big-redesign-in-the-sky)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T20:27:38.367

我认为这取决于几个因素：

1.  你有单元测试吗？这支持重构。
2.  最初用了多长时间？一两天争论重写，一两周争论重构。
3.  你每天都依赖它吗——你需要让它保持运行吗？如果是，请重构。如果没有，重写。
4.  究竟有多糟糕呢？如果**真的**不好，重写它。

在任何情况下，在开始之前就知道你要去哪里！

（就我个人而言，我不赞成你永远不应该重写的论点。我也不赞成精心设计的系统可以完全来自重构的论点......）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T20:43:44.443

[用弗雷德·布鲁克斯（ Fred Brooks](http://en.wikiquote.org/wiki/Fred_Brooks)）的话来说，“计划把第一个扔掉”。如果您还没有计划这样做，那么无论如何您最终都会将其丢弃。唯一的问题是，经过多少工作？

# web-applications - Web 应用程序应该自动更新吗？

> ID：558535
> 
> 赞同：0
> 
> 时间：2009-02-17T20:18:41.680
> 
> 标签：web-applications, auto-update

在看到微软从 Internet Explorer 6 升级人们遇到的一些问题以及 Firefox 如何自动更新之后，这让我考虑了我们的 Web 应用程序推送式升级系统的优点和缺点。在您看来，网络应用程序应该自动更新吗？为什么或者为什么不？如果是，有哪些需要考虑的问题以及您将采用哪些策略来使升级尽可能无缝？您是否可以指出具有类似系统的 Web 应用程序的任何现有示例？

编辑：为澄清起见，网络应用程序是一个具有网站前端的内容管理系统，类似于 Joomla 或 Drupal。我们会将 CMS 作为产品提供，因此任何更新都会在我们客户的服务器上安装最新版本的应用程序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T20:26:53.327

将客户端应用程序更新推送到某人的计算机只会危及该用户的计算机和数据。

但是，您不能自动将更新推送到其他人的服务器。您不知道他们的环境是什么，以及通过推送更新可以打破什么。鉴于您的用户将使用您的应用程序将他们的内容发布给他们的用户，您将冒着您用户业务的风险。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T20:30:48.093

是和否。

需要明确的是，它应该是一个选择加入。您想要自动更新，您可以选择自动更新。您将遇到一些实施问题/限制，但这是另一个问题。

我可以看到混合，一些用户可能更喜欢推送安全更新，而不是新版本。其他人可能两者都想要，有些人都不想要。如果您保持灵活性，这可能是您的 CMS 的一个显着特点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:30:30.963

如果您决定添加这样的功能，明智的做法是让用户选择退出。CMS 是定制很常见的东西，更新可能会以可怕的结果破坏它。在我的一个工作地点，我们一直在走这条路，CMS 框架升级导致我们进行了很多很多小时的返工。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T20:34:42.763

我认为 Wordpress 具有自动检查更新的功能，如果您正在运行过期的副本，它会在管理界面中显示一个 nag 屏幕。这似乎是在强制更新可能会破坏用户安装和简单地在您的项目网站上发布用户可能看不到的通知之间的一个相当不错的折衷方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T20:31:35.813

如果我直截了当：有些用户会去网站使用您的系统，而其他用户会下载二进制文件？

在这种情况下，我会强制下载人员升级。如果您对影响客户端与其交互方式的底层数据库进行更改怎么办？当您已经使用 4.0 版本时，编写每个新版本以与使用 0.1 版本的顽固的人一起工作会很痛苦。

我假设 Web 应用程序和下载的二进制文件使用相同的数据库。如果您有一个组织维护自己的数据库的设置，绝对不要强制更新。

# iphone - 在 iPhone 上创建粒子最有效的方法是什么

> ID：558537
> 
> 赞同：2
> 
> 时间：2009-02-17T20:19:00.150
> 
> 标签：iphone, objective-c, animation, core-animation, cocos2d-iphone

我正在寻找在 iPhone 上创建降雪效果，我正在寻找有关如何最好地实现这一点的建议。我计划使用 png 图像作为精灵。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T21:27:49.453

这听起来对 CALayers 很有用。看看 Scott Stevenson 的[NanoLife](http://theocacao.com/document.page/555)示例。它适用于 Mac 而不是 iPhone，但它是使用 Core Animation 处理粒子的一个很好的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T20:35:12.327

您可以动态地创建一堆`UIImageView`s 并在循环中为它们的位置设置动画（或者可能使用核心动画），或者可以将图像绘制到 CoreGraphics 层，并使用循环更新它。

第三个选项是 OpenGL 解决方案，但我很确定您不会问这个问题。此外，UIKit 视图上的 OpenGL 内容不会很好地执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:16:23.803

如果您有一系列关键帧动画作为 PNG，我会建议使用 UIImageView 的动画方法。UIImageView 本身支持通过一系列 UIImage 循环动画，您可以使用 UIKit 内置动画来为位置设置动画。

虽然它不会非常有效。为了获得高性能，我认为您将不得不降级到 OpenGL，这需要更多的学习。

我还建议看看[Matt Gallagherts Quartzeroids](http://cocoawithlove.com/2009/02/asteroids-style-game-in-coreanimation.html)。使用 CoreAnimation 作为渲染器的游戏。

# python - 我在 Python 中的嵌套循环有什么问题？

> ID：558539
> 
> 赞同：0
> 
> 时间：2009-02-17T20:19:26.543
> 
> 标签：python, loops, nested

如何在 Python（3.0 版）中创建嵌套循环？

我试图让以下循环向我展示两个数字的乘积：

```
def PrintProductsBelowNumber(number):
    number1 = 1
    number2 = 1
    while number1 <= number:
        while number2 <= number:
            print(number1, "*", number2, "=", number1 * number2)
            number2 += 1
        number1 += 1

PrintProductsBelowNumber(2) 
```

结果我得到：

```
1 * 1 = 1
1 * 2 = 2 
```

所以看起来 number1 的外循环没有运行。

如何让 number1 上的循环运行，从而获得：

```
1 * 1 = 1
1 * 2 = 2
2 * 1 = 2
2 * 2 = 4 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T20:22:58.470

`number2`只初始化一次，您需要为内部循环的每次迭代重新初始化它。但是，此代码非常类似于 C，而不是 Pythonic。更好的方法是使用`for number in range(n)`构造：

```
def PrintProductsBelowNumber(number):
    for number1 in range(1, number+1):
        for number2 in range(1, number+1):
            print(number1, "*", number2, "=", number1 * number2) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-17T20:22:32.310

因为您没有在内循环第一次完成后将 number2 设置回 1 。number1 然后递增，但由于 number2 仍然太高，内部循环不会再次运行。

```
def PrintProductsBelowNumber(number):
    number1 = 1
    while number1 <= number:
        number2 = 1
        while number2 <= number:
            print(number1, "*", number2, "=", number1 * number2)
            number2 += 1
        number1 += 1

PrintProductsBelowNumber(2) 
```

**编辑**：一般来说，亚当的解决方案要好得多，但这是为了说明为什么你的解决方案没有按照你最初认为的方式工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:54:59.387

您可以使用列表理解来修改 Adam 的解决方案：

```
def PrintProductsBelowNumber(number):

    results = [(i, j, i * j) for i in range(1, number + 1) 
                             for j in range(1, number + 1)]

    for number1, number2, result in results:
        print(number1, "*", number2, "=", result) 
```

或其一些变体。

# authentication - 这是一个合理的用户注册过程吗？

> ID：558540
> 
> 赞同：9
> 
> 时间：2009-02-17T20:19:44.000
> 
> 标签：authentication, web-applications

我正在处理内部应用程序的注册过程。我的初始设计如下。

我的主要问题是是否真的有必要包含一个`registration_confirmation_code`. 它是保护应用程序免受现实威胁还是只是增加了不必要的复杂性？对此我不确定。

* * *

*   用户输入电子邮件地址。由于这是一个内部应用程序，因此它必须是代理地址。

*   如果它是有效的代理地址，应用程序会在用户表中创建一个新行。

    *   `registration_confirmed`该表有一个`false`默认列。`registration_confirmed`除非是，否则应用程序不会让用户登录`true`。

    *   该表有一列`registration_confirmation_code`是随机生成的字符串。

*   应用程序向用户输入的地址发送电子邮件。它包含一个指向页面的链接，该页面将让用户确认他们的注册并设置他们的用户名和密码。

    该链接在查询字符串中有用户的`id`和：`registration_confirmation_code`

    `http://agencydomain.com/users?id=123&registration_confirmation_code=fab49dk34nw97d`

*   通过单击链接，用户可以验证他们输入的地址是否有效并且他们可以访问它。

*   该应用程序通过 ID 查找用户。在允许他们访问可以设置用户名和密码的页面之前，该应用程序会检查...

    *   `registration_confirmed`是`false`。他们应该只能确认一次注册。

    *   `registration_confirmation_code`请求参数与该用户的数据库中的值匹配。这可确保这是目标用户的合法注册确认，而不是其他人使用随机 ID 访问 URL 试图劫持注册。

*   如果一切顺利，应用程序会将他们带到一个页面，其中包含用于设置用户名和密码的表单。

*   当他们提交带有有效数据的表单时，应用程序设置`registration_confirmed`为`true`并注册。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T20:24:59.527

不要相信别人，即使他们是您组织的内部人员。这听起来很糟糕，但除非您与一个非常小的群体打交道，否则您的方法是一个明智的选择。

还有一件事，您可能希望确保他们的电子邮件是独一无二的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T20:30:02.087

另一种方法是使用集中式身份验证并跳过整个注册过程。

首次登录尝试时，从模板创建用户配置文件。

可以通过多种方式进行身份验证。理想情况下，像 LDAP（或 Active Directory，如果您愿意的话）之类的东西。也可以使用邮件服务器进行身份验证，具体取决于它的配置方式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T20:29:45.240

验证您从访问者那里收到的任何类型的输入都是一种很好的做法。经验法则是始终确保你得到你所期望的，而不是别的。我会说你做得很好，包括电子邮件验证。

不过是一个小问题；为什么要分两步进行？为什么不允许用户立即输入密码？这通常会让用户感觉更舒服。

此外，您可能需要考虑使用用户电子邮件地址的 MD5 哈希（或类似），而不是使用 registration_confirmation_code。这样，您就不需要额外的字段，如果您愿意，甚至可以省略 ID。

-戴夫

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T20:51:40.430

[OpenID](http://en.wikipedia.org/wiki/OpenID)系统基本上就是为了解决这个问题而发明的。基本上，有人来到您的网站并说“我是 XYZ，您可以通过与 ABC 核对来验证这一点”。然后，您可以让他们的 OpenID 提供者（可能是您公司中的服务器；如果您有 LDAP，那么您已经大部分时间在那里）验证他们是他们所说的身份（通过他们登录 OpenID 提供者的站点）。如果您可以信任 OpenID 提供者，并且 OpenID 帐户没有被盗用，那么您刚刚验证了您的用户。您可能无需经过正式的注册过程就可以逃脱...只需在首次登录时将它们发送到帐户设置屏幕（假设您需要的不仅仅是示例中的密码 + 电子邮件，因为这两者都是通过 OpenID 提供的）。

请注意，OpenID 只能验证用户是否拥有给定 OpenID 的凭据，而不能验证用户是唯一的，或者他们就是他们所说的那个人。但这实际上与任何现有的方案没有什么不同。

它的优点是不需要用户向您提供他们可能忘记的密码（他们可以通过 OpenID 提供商更改密码，并且所有使用 OpenID 的网站都会更改密码）。大多数主要语言都有可用的 OpenID 库，滚动您自己的库应该不会太复杂。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T20:26:08.540

您似乎确实为内部应用程序付出了很多努力？您预计会有多少欺诈行为？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T20:22:15.820

我喜欢使用电子邮件地址作为登录 ID 的网站。另外，为什么不在注册时预先获取密码？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T20:26:22.173

保护您的应用程序免受比通常验证更少的用户的攻击是一件好事，但更好的是，您可以保护随机的人免受来自您系统的电子邮件的垃圾邮件。通过要求选择加入，您可以确保 X 无法注册您声称是 Y 的服务，并导致每次您想联系用户时都会向 Y 发送电子邮件。它还让 Y 有机会说“什么？不，这不是我”，然后单击拒绝、发送 ARF 报告或以其他方式让您知道有人在欺骗您。

如果您收集电子邮件地址，则应始终对其进行验证。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-17T20:27:08.850

您仍然需要通过电子邮件向他们发送确认代码。

根据应用程序，您不希望人们使用同事的电子邮件地址进行注册。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-17T20:27:17.430

我会在用户单击电子邮件中的链接后立即让他们进入，并向他们发送一个他们可以稍后更改的虚拟通行证。（使用电子邮件作为用户名）

这消除了流程中的一个步骤，并使注册变得更加容易。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-21T18:53:56.623

您通过电子邮件确认解决的唯一“攻击”是使用随机电子邮件地址注册新帐户。

IOW，如果你离开那一步，“攻击者”可以：

1.  仅使用随机乱码地址注册帐户
2.  使用其他人的地址注册帐户

幸运的是，在大多数应用程序中，这种攻击的破坏性不是很大。它可能会帮助攻击者在社交网络应用程序中伪造他人的身份，或者让垃圾邮件发送者的生活*稍微*轻松一些，或者它可能只是用来惹恼电子邮件地址的合法所有者——但仅此而已。

我会说保留注册要求以防万一，但放弃两步过程（让用户立即创建用户名+密码）。

# java - 复制/扩展静态类功能的最佳方法是什么？

> ID：558546
> 
> 赞同：5
> 
> 时间：2009-02-17T20:21:27.770
> 
> 标签：java, class, oop, static

我正在处理的应用程序有一个维护数据库连接的类。此类的所有成员都是静态的以强制执行类似单例的模式，因此实际的连接逻辑在静态初始化程序块中执行：

```
public class HibernateUtil {

    private static final SessionFactory sessionFactory;

    static {
        sessionFactory = new Configuration().configure().buildSessionFactory();
    }

    static void openSession() {
        //open session with sessionFactory
    }

    public static Session currentSession() {
        //return the currently open session
    }

    static void closeSession() {
        //close the currently open session
    }

} 
```

但是，应用程序现在需要打开与第二个数据库的数据库连接。现在这个类的结构方式，在保持上述模式的同时保持第二个连接的唯一方法是创建第二个类（类似于 SecondHibernateUtil）并更改初始化程序块中的一行配置。这感觉就像是真正浪费了大量的复制/粘贴。

任何人都可以提出一种方法，我可以重新设置此设置以同时维护多个连接，同时不会过度破坏已经调用现有方法的代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T20:22:49.703

也许它一开始就不应该是静态的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:38:20.010

保留静态方法并让它们委托给默认实例的相应实例方法。

对于辅助数据库，允许通过任何方式创建更多实例并通过它们的实例方法访问它们。

然后你可以减少静态方法的调用者，当它们都消失时，删除静态方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:19:12.283

嗯，这是正确的时机。

无法添加第二个连接并保留您描述的模式。

相反，你可能会尝试把事情做好。

你有两个选择。

**第一个选项**。保持混乱，让它变得更糟（不告诉你的客户）

1.  创建一个为您处理连接的实用程序类。这次不仅限于两个。改用地图，不要让它成为静态的。
2.  使用新的实用程序对象更改您的静态类。
3.  创建您的新连接实用程序 (HibernateUtility2) 并使用该新实用程序对象。

    ```
    // Create a new utility class using a map instead.
    class HibernateUtility { 

        private Map<String, SessionFactory> factories;
        private HibernateUtility instance;

        public  static HibernateUtility getInstance() { 
            if( instance == null ) { 
            instance = new HibernateUtility();
            }
            return instance;
        }

        private HibernateUtility() {}

        private void check( String whichConnection ) { 
            if( !factories.containsKey( whichConnection ) ) {
                // start the connection
                factories.put( whichConnection, new Configu..
                //... etc etc ().configure().buildSessionFactory() );
            }
        }

        void openSession( String whichConnection ) {
            check( whichConnection );
            //open session with sessionFactory
            factories.get( whichConnection ).open(); //etcetc
        }

        Session currentSession( whichConnection ) {
            check( whichConnection );
            //return the currently open session
            factories.get( whichConnection ) .....
        }

        void closeSession( String whichConnection ) {
            check( whichConnection );
            //close the currently open session
            factories.get( whichConnection );
        }       
    }

    //------------------------------------------
    // Make your existing class call that class
    public class HibernateUtil {

        static void openSession() {
            //open session with sessionFactory
            HibernateUtility.getInstance( "one" ).openSession();
        }

        public static Session currentSession() {
            //return the currently open session
            HibernateUtility.getInstance( "one" ).currentSession();
        }

        static void closeSession() {
            //close the currently open session
            HibernateUtility.getInstance( "one" ).closeSession();
        }
    }

    //------------------------------------------            
    // Make the new connection use that class too.
    public class HibernateUtil {

        static void openSession() {
            //open session with sessionFactory
            HibernateUtility.getInstance( "two" ).openSession();
        }

        public static Session currentSession() {
            //return the currently open session
            HibernateUtility.getInstance( "two" ).currentSession();
        }

        static void closeSession() {
            //close the currently open session
            HibernateUtility.getInstance( "two" ).closeSession();
        }
    } 
    ```

这样现有的客户端代码就不会中断。

**第二种选择**。清理混乱并相应地修改代码。

在第二个选项中，您创建一个与之前描述的 HibernateUtility 非常相似的对象，但这次您不添加不属于该接口的方法**openSession**或**closeSession 。**

使用这种非静态方法，您可以创建可以连接到不同配置的不同实例。

您只需使用**currentSession**，如果会话不存在则创建一个新会话，并接收一个标识符作为参数（很像前面示例中的“一”和“二”）

在第二个选项中，您必须更改客户端代码以使用正确的实现。

*注意：* SO 中的代码格式有问题，我花了一些时间来按原样格式化它，而且看起来不太好:(

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T21:26:59.987

我很久以前看过这个问题，由于您提出的确切问题，我决定永远不要制作这样的静态类。它实际上有2个问题......

首先，它不可重用（正如您所注意到的），修复它是一个艰难的重构。

其次，你不能有第二个实例（似乎程序员假设只有一个事情几乎和他们假设他们永远不需要更改日期的前两位数字一样多！）

如果您决定要使用工厂模式（或类似 spring）的第二个实例，这是一个微不足道的更改 - 只需将变量传递给工厂以指示您想要哪个实例 - 但从静态类重构只是一个婊子。

你甚至应该小心不要滥用工厂模式。如果你真的倾向于那个方向，学习并拥抱春天——它将与你的自然倾向相结合，大大地改进你的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T20:29:36.537

没有真正的好方法，有时除了复制班级整体销售并接受复制之外没有真正的选择。

我知道这听起来很*糟糕*，但是自从它从休眠文档复制以来，这个类实际上改变了多少次？

我敢肯定有人会建议将整个应用程序转换为管理弹簧`SessionFactory`和所有这些东西，但除非你的应用程序是 Hibernate “Hello World”，否则我猜这可能需要几个小时以上的时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T20:51:40.303

学习春天。如果您已经在使用 Hibernate，那么学习足够多的 Spring 来处理这个问题并不是一件容易的事。Spring Source 的人已经比以往任何时候都更好地解决了这个问题。

Spring 事务适用于 JDBC、Hibernate、iBatis 或 Spring 支持的任何其他持久性技术。如果您已经在使用 Spring，请不要重新发明他们已经做得更好的东西。使用他们的交易。

如果您有多个数据库，并且您将写入这两个数据库作为一个单一的工作单元，那么您知道的足够多，可以同时为这两个数据库使用 XA 驱动程序，对吧？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T21:04:03.550

有两种可能的答案；让我们看看两者。

一种是将其转换为非静态的。可以说这首先比静态接口要好，因为在接口后面有一个具体的对象（SessionFactory）。这样做的好处是您将 SessionFactory 的创建推迟到您需要它时（如果不需要，则永远不要创建它）。创建一个静态方法来获取默认的 HibernateUtil 对象，如果不存在则创建它。您可能希望也可能不希望允许第二个 HibernateUtil。

另一种方法是创建一个全新的静态对象 HibernateUtil2，它在必要时委托给 HibernateUtil。但是请注意，这些不会以任何类似继承的方式相互关联，因为静态不能在接口中使用。

我会推荐第一条路线，在其他条件相同的情况下，但您的具体情况可能需要第二条路线。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T21:43:37.810

解决此问题的破坏性最小的方法是将第二个静态变量添加到类中，在静态块中初始化第二个 SessionFactory，然后修改“currentSession”静态方法以具有字符串参数以根据您的业务/代码逻辑选择适当的实例。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-16T12:05:02.263

我不知道这个问题的一般解决方案，但在这里你可以`SessionFactory`在你的代码而不是你的文件中声明 non-static 和设置配置`hibernate.cfg.xml`！因此，您可以`SessionFactory`将多个数据库连接到多个数据库以进行更多不同的映射。

# list - 如何将可滚动的项目列表添加到 SWT 消息框？

> ID：558555
> 
> 赞同：1
> 
> 时间：2009-02-17T20:23:02.917
> 
> 标签：list, swt, messagebox

我想在 SWT 中弹出一个带有可能很长的项目列表的消息框。我可以添加一个列表小部件，还是应该制作一个新外壳并用标签、列表和两个按钮填充它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T20:32:09.337

通常 MessageBox 保留用于简单消息，是/否，确定/取消，诸如此类。

如果您想弹出一个可能很长的列表，我建议您创建自己的对话框。这样您就可以自定义它以使其看起来像您想要的那样（包括可滚动列表）

[以下](http://www.java2s.com/Code/Java/SWT-JFace-Eclipse/List.htm)是一些 SWT 列表示例

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-23T21:49:16.963

eclipse ui 包为这些场合提供了一些有用的对话框。退房`org.eclipse.ui.dialogs.ListDialog`。

# iphone - 如何使用 NSLog(@"Inside of the iPhone Simulator") 进行调试？

> ID：558568
> 
> 赞同：55
> 
> 时间：2009-02-17T20:26:37.870
> 
> 标签：iphone, objective-c, cocoa, xcode, nslog

我习惯于编程和查看日志消息。我知道您曾经能够`NSLog()`在调试 Cocoa 应用程序时使用它来跟踪消息。在 iPhone Xcode 开发环境中编码时“跟踪”消息的最佳方式是什么？

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2009-02-19T17:55:38.960

在 Xcode 中有一种更方便的方式来跟踪日志消息，那就是使用断点操作。

在您想添加 printf 或 NSLog 的代码行上，设置一个断点，然后按住 Control 键单击它并选择“编辑断点”。在出现的蓝色气泡中，单击右侧的 + 按钮打开断点操作： [替代文本 http://idisk.mac.com/cdespinosa/Public/Breakpoint%20Actions.png](http://idisk.mac.com/cdespinosa/Public/Breakpoint%20Actions.png)

在此处输入您的日志文本。任何可以在调试器中打印的表达式都可以在用 @ 符号分隔时使用。

对于调试 Objective-C，通常更有用的是从弹出窗口中选择“Debugger Command”并输入“po [[object method] method]”来打印 Objective-C 对象的描述字符串或方法调用的结果。

确保单击右上角的“继续”复选框，以便在日志后继续执行。

这比 NSLog 和 printf 的优点：

*   它在飞行中。您无需重新编译和重新启动即可添加或编辑日志消息。这可以为您节省大量时间。
*   您可以有选择地启用和禁用它们。如果您从其中学到了足够多的东西，但它的喷吐干扰，只需取消选中它的启用框。
*   所有输出都在您的 Mac 上生成，而不是在 iPhone 上生成，因此您不必事后下载和解析日志。
*   在您的应用程序中发送控制台喷吐的机会显着降低。

另请查看“发言”按钮；它非常适合调试无法查看调试日志的全屏应用程序。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-03-12T17:21:28.947

这是我在网上某处找到的大量代码。它定义了新函数 DLog() 和 ALog()。DLog 消息仅在使用 -DDEBUG 标志（定义 DEBUG）编译应用程序时出现。ALog 消息总是出现（即使在发布模式下）。

```
// DLog is almost a drop-in replacement for NSLog
// DLog();
// DLog(@"here");
// DLog(@"value: %d", x);
// Unfortunately this doesn't work DLog(aStringVariable); you have to do this instead DLog(@"%@", aStringVariable);
#ifdef DEBUG
#       define DLog(fmt, ...) NSLog((@"%s [Line %d] " fmt), __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__);
#else
#       define DLog(...)
#endif

// ALog always displays output regardless of the DEBUG setting
#define ALog(fmt, ...) NSLog((@"%s [Line %d] " fmt), __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T08:46:56.060

在我的项目中，我有一个基于[DebugOutput.m](http://iphonedevelopertips.com/cocoa/filename-and-line-number-with-nslog-part-ii.html)的定制解决方案，这会将文件和行号添加到调试输出中，从而更容易识别输出文本的来源，同时仍然保持简短。

我使用调试掩码增强了标准解决方案，以便我可以为我的应用程序中的特定功能区域打开和关闭调试。在 Debug.h 中，我有

```
typedef enum {
kDebugMaskAp- = 1,
kDebugMaskXMLParser = 1 << 1,
kDebugMaskNetwork = 1 << 2,
kDebugMaskAnalytics = 1 << 3,
kDebugMaskCache = 1 << 4,
} debugBitMask;

#define debugForComponent(mask,format,...) if( currentDebugMask() & mask) [[DebugOutput sharedDebug]  output:__FILE__ lineNumber:__LINE__ input:(format), ##__VA_ARGS__] 
```

在 Debug.m

```
-(void)output:(char*)fileName lineNumber:(int)lineNumber input:(NSString*)input, ...
{
  va_list argList;
  NSString *filePath, *formatStr;

  // Build the path string
  filePath = [[NSString alloc] initWithBytes:fileName length:strlen(fileName) encoding:NSUTF8StringEncoding];

  // Process arguments, resulting in a format string
  va_start(argList, input);
  formatStr = [[NSString alloc] initWithFormat:input arguments:argList];
  va_end(argList);

  // Call NSLog, prepending the filename and line number
  NSLog(@"File:%s Line:%d %@",[((DEBUG_SHOW_FULLPATH) ? filePath : [filePath lastPathComponent]) UTF8String], lineNumber, formatStr);

  [filePath release];
  [formatStr release];
} 
```

在应用程序中，调用看起来像这样：

```
debugForComponent(kDebugMaskApp,@"Request failed - error %@", [error localizedDescription]); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-28T06:58:21.390

将此粘贴到您的前缀标题中。项目中的所有日志肯定会消失。

```
#ifndef __OPTIMIZE__

#    define NSLog(...) NSLog(__VA_ARGS__)

#else

#    define NSLog(...) {}

#endif 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-01T09:07:43.963

您可以使用[NSLogger](https://github.com/fpillet/NSLogger)，它带来的不仅仅是记录您的消息。我使用宏来禁用发布版本中的日志，同时让它们中的每一个都在调试版本中处于活动状态。日志量不是问题，因为 NSLogger 提供了强大的日志过滤选项。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-25T20:56:35.253

我只是使用替换所有功能....

我通过将 NSLog(@" 替换为 //***NSLog(@"

这样我就可以用 //***NSLog(@" 简单地找到它（在所有项目文件中使用 find ）并重新启用它们

没什么花哨的，但它有效:)

# jquery - 我想将一个 HTML 表单分解为几个 JQuery UI 选项卡，并有一个“全部”选项卡，其中包含所有表单位

> ID：558571
> 
> 赞同：4
> 
> 时间：2009-02-17T20:27:13.157
> 
> 标签：jquery, html, jquery-ui

我希望在 JQuery UI 选项卡布局中将大型 HTML 表单分解为几个较小的子表单。但我想要一个特殊的“全部”选项卡，其中包含该选项卡上的所有子表单。因此，当用户单击“全部”选项卡时，他们可以查看和编辑通常在多个选项卡上划分的所有表单字段。

我怎么能用 JQuery 轻松做到这一点？我想避免拥有实际字段的两个副本，因为在子表单版本和特殊的“全部”表单版本之间复制/粘贴数据似乎很痛苦。

请注意：我使用的是 ui.jquery.com 选项卡布局。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T20:58:14.190

似乎您只需要将字段分组到 DIV 中，然后一次只能看到一个 DIV，除非查看器选择了“全部”。这是一个非常快速的模型，但应该清楚地说明我的观点。

```
<!-- Clicking a groupButton hides all groups, save for the href'd group -->
<a href="#group1" class="groupButton">Group 1</a>
<a href="#group2" class="groupButton">Group 2</a>

<!-- If the href'd group is '0', show all groups -->
<a href="#group0" class="groupButton">View All</a>

<div id="group1" class="group">
  <!-- Group 1 Form Elements -->
</div>
<div id="group2" class="group">
  <!-- Group 2 Form Elements -->
</div> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T20:49:05.380

**假设您已经有不同的选项卡在工作/显示，您可以在用户单击全部**并全部显示时遍历所有元素（具有您显示和隐藏的表单字段的块） 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:49:21.620

听起来没那么难。将每个子表单包装在它自己的容器 div 中。将所有 div 元素相对于彼此放置在 ready() 方法中的“所有”页面上，并将每个 div 设置为可见。然后在单击选项卡按钮/字段时设置 div 的可见性，将选定的栏隐藏起来。单击“全部”只需调用您在 ready() 方法中使用的相同函数，以在第一个实例中放置 div。

您绝对不需要两个字段副本（或者必须在它们之间进行任何复制）。

但是，那里有大量的 javascript / jquery 选项卡组件，我可能会从其中一个开始，首先，看看其他人是如何做到的，其次，如果你能适应它。

一些标签插件：

[http://stilbuero.de/jquery/tabs/](http://stilbuero.de/jquery/tabs/)

[http://docs.jquery.com/UI/Tabs](http://docs.jquery.com/UI/Tabs)

设置 div 可见性：

[http://drupal.org/node/287259](http://drupal.org/node/287259)

[http://waxtadpole.wordpress.com/2008/11/26/jquery-toggle-visibility-of-a-div/](http://waxtadpole.wordpress.com/2008/11/26/jquery-toggle-visibility-of-a-div/)

# html - 在等间距的列中布局 HTML 列表

> ID：558576
> 
> 赞同：3
> 
> 时间：2009-02-17T20:28:26.023
> 
> 标签：html, css, layout

我想在 2/3 均匀间隔的列中列出如下列表

```
<ul>
  <li>one<li>
  <li>two<li>
  <li>three<li>
  <li>four<li>
  <li>five<li>
  <li>six<li>
  <li>seven<li>
  <li>eight<li>
  <li>nine<li>
</ul> 
```

一种解决方案是将列表分成两个列表并将其中一个向右浮动，可能带有边距，例如

```
 <div id="col2">
    <ul>
      <li>one<li>
      <li>two<li>
      <li>three<li>
      <li>four<li>
      <li>five<li>
    </ul>
  </div>

  <ul>
    <li>six<li>
    <li>seven<li>
    <li>eight<li>
    <li>nine<li>
  </ul>

#col2 {
    float: right;
    margin-right: 450px;
} 
```

这工作正常，但有许多缺点：

1.  (Un)semantic markup - 它不是真正的 2 个列表，我将一个列表分成 2 个，只是为了更容易设置样式
2.  边距必须手动设置为看起来均匀分布的东西
3.  如果浏览器足够窄，右侧的列将运行到第二列。

有没有更好的方法来做到这一点，最好不使用桌子？

* * *

## 更新：

我尝试了[Method 1](http://www.alistapart.com/d/multicolumnlists/example1.html)，但我看到了一些奇怪的结果。如果您查看此[3 列列表](http://chaletsdesbouleaux.com/activity.shtml#act1)，您会发现前 2 列中有“漏洞”。知道为什么吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T20:32:03.207

[**来自 A List Apart 的这篇文章**](http://www.alistapart.com/articles/multicolumnlists)涵盖了普遍接受的、接近最佳实践的方法，这些方法可以用于执行您所描述的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:34:35.987

<li>-s 的高度不同。尝试为 css 中的列表项设置固定高度。你也可以使用类似的东西

```
border: 1px solid red; 
```

作为列表项的规则之一，看看发生了什么。

我也在这里投票给一张桌子，因为使用方法一会破坏项目的顺序。但是，如果这对您来说不是问题，那么请继续。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T20:36:20.433

我不知道你是否想要 2 直接低于 1 或者它是否可以在 1 旁边，例如：

```
 1    2    3
    4    5    6 
```

因为如果是这样的话，你可以给你的**li**一个 33% 的固定宽度并浮动它们或内联显示它们。

**编辑：**这基本上是**Rex M**提到的文章的方法 1（只是阅读它，很好）：

您可以使用已经存在的 html，第一个完整列表并添加样式：

```
ul {
    width: 100%;        // for example
}
li {
    float: left;        // option 1
    display: inline;    // option 2, just one of the two
    width: 33%;         // for 3 columns, use 50% for two columns
} 
```

这一切也都在文章中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-17T20:35:48.470

为什么不用桌子？这*正是*表格的用途。

# c# - C# Powershell 管理单元未使用 installutil 注册

> ID：558577
> 
> 赞同：13
> 
> 时间：2009-02-17T20:28:28.177
> 
> 标签：c#, powershell, installutil, pssnapin

我有一个非常简单的 powershell 脚本（见下文）。我在我的个人资料中使用以下内容获得了 installutil 别名：

```
set-alias installutil $env:windir\Microsoft.NET\Framework\v2.0.50727\installutil 
```

在powershell中，我只是：

```
installutil assemplylocation.dll 
```

这成功返回。（安装/提交都成功完成）。然而，当我检查注册表或在 powershell 中使用 get-pssnapin -registered 时，它不会显示我的程序集。前几天我做了这个，效果很好，但我似乎无法复制它......请指教。

```
using System;
using System.Management.Automation;
using System.ComponentModel;

namespace PSBook_2_1
{
    [RunInstaller(true)]
    public class PSBookChapter2MySnapIn : PSSnapIn
    {
        public PSBookChapter2MySnapIn()
            : base()
        { }

    // Name for the PowerShell snap-in.
    public override string Name
    {
        get
        {
            return "Wiley.PSProfessional.Chapter2";
        }
    }

    // Vendor information for the PowerShell snap-in.
    public override string Vendor
    {
        get
        {
            return "Wiley";
        }
    }

    // Description of the PowerShell snap-in
    public override string Description
    {
        get
        {
            return "This is a sample PowerShell snap-in";
        }
    }
}

// Code to implement cmdlet Write-Hi
[Cmdlet(VerbsCommunications.Write, "Hi")]
public class SayHi : Cmdlet
{
    protected override void ProcessRecord()
    {
        WriteObject("Hi, World!");
    }
}

// Code to implement cmdlet Write-Hello
[Cmdlet(VerbsCommunications.Write, "Hello")]
public class SayHello : Cmdlet
{
    protected override void ProcessRecord()
    {
        WriteObject("Hello, World!");
    }
} 
```

}

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-11-07T12:01:47.953

downatone 的回答让我走上了正轨，但我的问题恰恰相反。我的项目设置为任何 CPU，并且我在 Win7 x64 上，因此从我的代码启动然后使用 snapin 安装 dll 的 powershell 是 64 位的。但是我使用的安装命令指向 32 位 .net 运行时，即

```
C:\Windows\Microsoft.net\Framework\V4.0.30319\installutil myDLL.dll 
```

应该是什么时候

```
C:\Windows\Microsoft.net\Framework64\V4.0.30319\installutil myDLL.dll 
```

注意框架路径中的 64。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-12T14:17:50.793

原来问题是我有一个 32 位 cmdlet - 但只检查 64 位版本的 powershell ...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-30T20:20:02.733

这里的关键点是记住 Visual Studio 2010 仍然是一个 32 位应用程序，这意味着当我使用命令提示符时，它默认为 InstallUtil 的 32 位变体。在这种情况下，注册表项因此写入 Wow64 位节点而不是 64 位注册表本身并不是很明显。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T06:22:11.417

您是否以提升用户身份运行 installutil？它将信息写入注册表的受保护部分。如果您以非管理员身份在 Vista 上执行此操作，可能会产生奇怪的结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-08T07:35:07.003

以管理员身份运行以运行ps

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-16T23:43:40.037

我必须使用 x86（32 位）版本的 PowerShell 来添加 Snapin。因为我发现它不像它应该的那样直接，这里有一个有用的链接如何打开 PowerShell 32bit：

[http://technet.microsoft.com/en-us/library/hh847733.aspx](http://technet.microsoft.com/en-us/library/hh847733.aspx)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-08-28T06:27:45.207

遇到同样的问题 - 我试图使用命令

```
C:\Windows\Microsoft.net\Framework\V4.0.30319\installutil myDLL.dll 
```

代替

```
C:\Windows\Microsoft.net\Framework64\V4.0.30319\installutil myDLL.dll 
```

在 OS win2k8 x64 上具有 64 位 cmdlet（项目配置。任何 CPU）。

# database - 当并非所有连接表列都是外键时保存 HABTM 记录

> ID：558580
> 
> 赞同：-1
> 
> 时间：2009-02-17T20:29:00.983
> 
> 标签：database, cakephp, has-and-belongs-to-many

我正在尝试更新具有并属于许多（HABTM）关系的表。

当我的连接表看起来像这样时：

```
CREATE TABLE IF NOT EXISTS `items_labels` (
  `item_id` int(11) NOT NULL,
  `label_id` int(11) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8; 
```

我使用 CakePHP，所以我可以用 $this->Item->save($data) 更新表，其中 $data 是：

```
Array
(
    [Item] => Array
        (
            [id] => 1
        )
    [Label] => Array
        (
            [Label] => Array
                (
                    [0] => 4
                    [1] => 5
                    [2] => 7
                    [3] => 8
                )
        )
) 
```

我在连接表中添加了一列，现在看起来像：

```
CREATE TABLE IF NOT EXISTS `items_labels` (
  `item_id` int(11) NOT NULL,
  `label_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8; 
```

当我保存 $data 时，我还想保存一个用户 ID。在单个保存操作中，所有记录的用户 ID 都是相同的。

有人可以帮助我了解 $data 数组需要是什么样子才能合并用户 ID 吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T22:42:18.487

这应该有效：

```
Array
(
    [Item] => Array
        (
            [id] => 1
        )

    [Label] => Array
        (
            [Label] => Array
                (
                    [0] => Array
                        (
                            [label_id] => 4
                            [user_id] => 1
                        )

                    [1] => Array
                        (
                            [label_id] => 5
                            [user_id] => 1
                        )

                    [2] => Array
                        (
                            [label_id] => 7
                            [user_id] => 1
                        )

                    [3] => Array
                        (
                            [label_id] => 8
                            [user_id] => 1
                        )

                )

        )

) 
```

它将生成多个 INSERT，但将使用一个保存调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T21:36:22.170

CakePHP 的 model::save() 方法不会为您AFAIK 执行此操作。我认为您必须使用 model::saveAll() 并在“with”模型上调用它。CakePHP 会自动识别您的连接表，并且可以对其进行建模，而无需您自己创建物理模型文件和类。您所要做的就是以 saveAll 期望的格式格式化数据数组。

我还没有尝试过，但类似下面的东西应该可以工作。

```
<?php
class Item extends AppModel {
  var $name = 'Item';
  var $_habtmData = null;
  function beforeSave() {
    $this->unbindModel(array('hasAndBelongsToMany' => array('Label')));
    $this->_habtmData = $this->data['Label'];
  }
  function afterSave() {
    if (is_array($this->_habtmData) && !empty($this->_habtmData)) {
      foreach ($this->_habtmData['Label'] as $k => $labelId) {
        $this->_habtmData['Label'][$k] = array(
          'item_id' => $this->id,
          'label_id' => $labelId,
          'user_id' => $userId, // Get this from somewhere
        );
      }
      $this->bindModel(array('hasMany' => array('ItemsLabel')));
      $this->ItemsLabel->saveAll($this->_habtmData);
    }
  }
}
?> 
```

这一切都在模型中完成（应该如此），因此您的控制器和视图保持干净。我们在 afterSave 中完成所有操作，因此只有在 Item 数据验证时才会尝试。

本质上，我们在 beforeSave 中临时取消绑定 Item hasAndBelongsToMany Label 关联，因此不会保存 HABTM 数据，我们将 HABTM 数据存储在模型的属性中，因此我们可以在 afterSave 中使用它（尽管它可能仍然可用） ）。

然后我们通过 hasMany 关联将“with”模型绑定到 Item，并按照 CakePHP 的核心 model::saveAll() 方法的要求格式化数据，最后在“with”模型上调用它，传入新数据。

它应该在理论上有效 - 祝你好运，让我知道你的进展;-)

# jquery - 在 jquery wordCount 中允许特殊字符和空格

> ID：558589
> 
> 赞同：1
> 
> 时间：2009-02-17T20:31:19.777
> 
> 标签：jquery, parsing, tokenize

我正在使用带有 wordCount 的 jquery DynaCloud 来创建动态标记云。我有特定的术语要包含在云中（尽管每个用户的频率不同），其中一些术语是多个单词，或者有特殊字符（“&”、“'”、“”等）作为一部分的术语。

我用特定的 html 块打破了条款：

```
<pre><span class="tag">this isn't the last tag</span></pre> 
```

举个例子。

wordCount 的工作方式（据我所知）是只接受特定的字符并在单词之间的空格上进行拆分。

我一直在尝试编辑脚本以允许所有字符（包括特殊字符），并且只在`<span class=tag>`.

但是，我所做的任何更改似乎都没有任何效果。

知道如何更改此代码以获取标签之间的所有内容并在标签上中断吗？

```
//accept Latin-1 basic + Latin-1 extended characters
testChar: function(c) {
    return((c >=   0 && c <= 500)
        || (c >= 128 && c <= 151)
        || (c >= 160 && c <= 164)
        || (c >=  48 && c <=  57)
        || (c >= 224 && c <= 246)
        || (c >= 249 && c <= 255));
},

//split words
splitWords: function(words) {
    var w = new Array(), str = '';
    for(var i = 0, j = words.length; i < j; i++) {
        c = words.charCodeAt(i);
        if(this.testChar(c)) str += words.substring(i, i + 1);
        else {
            w.push(str);
            str = '';
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T20:17:46.250

我最终得到了这个。我一直在尝试使用类似于脚本原作者使用的编码字符`(so c>=0 && c<=500)`。但我想太多了。

这一切都可以用简单的字符来完成，所以编辑它说

```
<pre>
    testChar: function(c) {
        return((c >= 97 && c <= 122)
            || (c >= 128 && c <= 151)
            || (c >= 160 && c <= 164)
            || (c >= 48 && c <= 57)
            || (c >= 224 && c <= 246)
            || (c >= 249 && c <= 255)
            || (c = "'" || " " || "&"));
    },

</pre> 
```

现在我需要的所有角色都出现了。

# asp.net - AJAX.NET 和列表框

> ID：558592
> 
> 赞同：1
> 
> 时间：2009-02-17T20:32:05.827
> 
> 标签：asp.net, asp.net-ajax

我有一个 UpdatePanel，里面有两个 ListBox。我想要发生的是，当页面加载第一个 ListBox 时会填充一些数据。当用户选择和项目时，第二个 ListBox 应该填充相关数据。

这是发生了什么，第一个 ListBox 填充了数据，用户选择了一个项目并且 SelectedIndexChanged 事件触发，但是在方法可以看到选择了哪个项目之前，选择被清除了？

```
<asp:UpdatePanel ID="UpdatePanel2" runat="server">
<ContentTemplate>
    <table class="listBoxTable">
        <thead>
            <tr>
                <th>
                    Please select a magazine to add articles to.</th>
            </tr>
        </thead>
        <tr>
            <td>                    
                <asp:ListBox ID="lbMagazines" runat="server" Height="300px" Width="250px" 
                    onselectedindexchanged="lbMagazines_SelectedIndexChanged" DataTextField="Title" 
                    DataValueField="Id" AutoPostBack="True">

                </asp:ListBox>
            </td>
            <td>                    
                <asp:ListBox ID="lbIssues" runat="server" Height="300px" Width="250px" 
                    Enabled="False" DataTextField="Title" DataValueField="Id">

                </asp:ListBox>
            </td>
        </tr>
    </table>
</ContentTemplate>
</asp:UpdatePanel> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T20:44:18.153

如果只需要更改第二个列表框的内容，则将第一个列表框放在 UpdatePanel 之外并使用 triggers 属性会更合适：

```
<Triggers>
    <asp:AsyncPostBackTrigger ControlID="lbMagazines" EventName="OnSelectedIndexChanged" />
</Triggers> 
```

这样，当您执行 AJAX 回发时，只会更新第二个列表框。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:47:20.393

听起来您的初始列表绑定代码未包含在 Page.IsPostBack 中。

```
If (!Page.IsPostBack)
{
    //List bind code
} 
```

在这种情况下，原始列表将像您所看到的那样继续重新绑定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:43:16.003

根据提供的信息，我最初的想法是您在页面加载时重新填充 lbMagazines，以便在它到达事件时，已清除选定项/索引。

# flash - 如何在 Flash CS4 中重命名影片剪辑？

> ID：558597
> 
> 赞同：0
> 
> 时间：2009-02-17T20:33:36.197
> 
> 标签：flash, flash-cs4

我在 Flash CS4 中重命名了一个影片剪辑。在重命名和更新我对它的任何引用之后，swf 仍然可以正常播放。但是，我无法再看到电影剪辑中的任何动作脚本。它仍然会执行，但我无法在 Flash CS4 UI 中的任何位置访问脚本。有任何想法吗？我能够取回代码的唯一方法是回滚我的更改而不是重命名它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T13:00:18.790

也许问题是这样的：

您的原始影片剪辑：'originalMC' 影片剪辑中对动作脚本的调用：'originalMC.someRandomFunction()'

如果您在 Flash IDE 中重命名您的影片剪辑，该调用将不起作用。

否则我不得不说你的说法很模糊。如果您可以展示您的代码示例。我不明白“但我无法在 Flash CS4 UI 的任何地方访问脚本”。

哦……我想我现在明白了。如果你在一个movieclip 中有actionscript，这在as1 和as2 中很常见，那么如果你改变movieclip 的类型或者即使你重命名它，该代码也很容易消失。

我到底在说什么……

# .net - .NET Framework 3.5（LINQ 除外）有什么优点？

> ID：558600
> 
> 赞同：1
> 
> 时间：2009-02-17T20:35:10.593
> 
> 标签：.net, .net-3.5

我正在从 .NET Framework 2.0 迁移到 3.5。

我不是 LINQ 的忠实粉丝。那么除了这些和“扩展”之外，在 .NET Framework 3.5 中我应该知道和利用什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T20:36:50.730

Lambdas, Type Inferance.. 大多数为支持 LINQ 而创建的底层事物。

为什么你不是 LINQ 的粉丝？

编辑：作为后续，当我说 LINQ 时，我不是在谈论 LINQ to SQL，而是在谈论 LINQ（语言集成查询）。我认为这种区别一般需要做出，因为像“LINQ is Dead”这样的语句是错误的，应该读作“LINQ to SQL is Dead”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T20:37:36.937

我已经成为 WCF 的粉丝：JSON/POX/SOAP...IPC、TCP、HTTP。足以让参与跨平台通信的程序员流口水

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T20:42:07.253

我建议你看看以下两篇文章：

*   [.NET Framework 3.5 版中的新增功能](http://msdn.microsoft.com/en-us/library/bb332048.aspx)
*   [.NET Framework 版本 3.5 SP1 中的新增功能](http://msdn.microsoft.com/en-us/library/cc713697.aspx)

如果您使用的是 C#，这里有一个新的语言特性列表：

*   [Visual C# 中的新增功能](http://msdn.microsoft.com/en-us/library/bb383815.aspx)

最后对于 ASP.NET 开发人员：

*   [ASP.NET 和 Web 开发中的新增功能](http://msdn.microsoft.com/en-us/library/s57a598e.aspx)

有这么多新功能，我相信你会找到你喜欢的;-)

就个人而言，我真的很喜欢 LINQ。它允许以更易读的形式重写大量代码，例如，大量多行 foreach 循环可以替换为简单（可读）的 LINQ 版本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T20:39:32.470

WPF 有一些潜力。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-17T20:40:42.220

如果您对此主题感兴趣并想深入探索，我强烈建议您获取 Jon Skeet 的[C# In Depth](https://rads.stackoverflow.com/amzn/click/com/1933988363)的副本。您将在此处获得的每个答案都只是故事的一部分，而 Jon 的书将引导您了解 C# 1 到 2 到 3，并向您展示每个版本中新功能的应用。

更新：这本书也可以在 O'Reilly 的[Safari](http://my.safaribooksonline.com/9781933988368?portal=oreilly)中找到。不过，这确实是一本阅读和思考的书，所以我认为您会更喜欢枯木版本。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-17T20:38:26.810

*   拉姆达斯
*   所有与 LINQ 相关的函数，如 .Where、.Except、.Intersect

C#-中心...

*   var 关键字

    > ```
    > var name = "hello world"; 
    > ```

*   速记属性

    > ```
    > public string Name {get;set;} 
    > ```

*   合并

    > ```
    > bob = bob ?? 55; 
    > ```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T20:39:48.383

好吧，如果你不是 Linq 的忠实粉丝，你说的是 Linq2Sql 吗？因为 Linq2Objects 的功能对我来说是无价的。扩展方法同上。我不能回去，因为使用了这些功能。而且，如果您不使用 Linq，那么 Linq 命名空间中的所有 IEnumerable<> 扩展对我来说都是无价之宝。

更不用说使用 .NET 3.0 获得的所有东西（WPF、WCF 等）

3.5 是 2.0 的一大进步

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T20:40:06.540

扩展方法、Lambda、表达式树。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T20:51:06.903

C# 3.0 语言

# .net - CMS 类似于 Umbraco 但在 PHP 中？

> ID：558603
> 
> 赞同：3
> 
> 时间：2009-02-17T20:35:27.363
> 
> 标签：.net, php, umbraco

是否有与 .NET CMS Umbraco 工作方式相同的 PHP CMS？

IE。所有数据输出都以 XML 形式出现，并使用 xslt 进行转换。作为开发人员，您或多或少有完全的自由来创建您希望的任何结构和输出。

问的原因：主要在 OS X / Mac 上工作，我对 .NET 和 Microsoft Web 开发不是很有经验。环境。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-10T16:13:40.370

Umbraco 真的非常好，你不需要知道.net，这就是美丽，只是一些 xslt。它甚至是在 mac 平台上开发的（诚然在 Fusion 中）。

但我知道你想坚持自己的优势，所以试试 symphony cms [http://symphony-cms.com/](http://symphony-cms.com/)

周杰伦

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T22:03:46.043

XML/XSLT 管道在 PHP 世界中并没有真正流行，原因有两个：1）与使用 PHP 或其他类似的模板语言相比，它被认为是重量级的；2）由于 PHP 的无状态特性，性能是'不太好（或者至少很难做到正确）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-11T19:22:55.970

您是否将 Joomla 视为 PHP CMS 解决方案？它在“非.Net”世界中与 Umbraco 一样受欢迎或可能更受欢迎......

只是一个想法，我当时真的对此了解不多，但我正在自己研究它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-10T19:31:10.497

结帐 Modx ( [http://modx.com/](http://modx.com/) )。我认为它最像 Umbraco。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T20:07:45.410

您是否看过在 Mac 上运行的其他技术（例如 Java）？如果是这样，您可以看看 Alfresco 吗？否则，您可以在 VirtualBox（免费）或 Fusion 等 Windows 虚拟机中运行 Umbraco

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-05T11:08:19.330

查看 EZPublish .. 我不认为它使用 xml/xslt，但允许完全控制内容等，就像 Umbraco 一样。

# c++ - 如何在 C++ 中进行网络 IP 扫描？

> ID：558610
> 
> 赞同：0
> 
> 时间：2009-02-17T20:36:40.153
> 
> 标签：c++, winsockets

我正在试验 C++ winsockets。我想创建一种方法，在不知道它的 IP 的情况下，我可以在网络上找到服务器。为此，我只需通过 IP 地址 192.168.1.0 到 192.168.1.255 循环我的连接方法。但是，每次连接之间的时间相当长，程序倾向于在 connect(nBytes, (sockaddr*)&server, sizeof(server)) 语句处等待至少 30 秒，如果不是更长的话。我的问题如下：为什么会发生这种情况，我该如何解决这个问题，是否有完全不同的更好的方法来查找服务器？

我的连接方法：

```
SOCKET connect(char *ipAdress)
{
WSAData wsaData;

if ((WSAStartup(MAKEWORD(2, 2), &wsaData)) == SOCKET_ERROR)
    return errorReport("Could not create startup struct");

nBytes = socket(AF_INET, SOCK_STREAM, 0);

if (nBytes == SOCKET_ERROR)
    return errorReport("Socket could not be created");

struct hostent *host_entry;

if ((host_entry = gethostbyname(ipAdress)) == NULL)
    return errorReport("Cannot find server.");

struct sockaddr_in server;
server.sin_family = AF_INET;
server.sin_port = htons(1337);
server.sin_addr.s_addr = *(unsigned long*) host_entry->h_addr;

if (connect(nBytes, (sockaddr*)&server, sizeof(server)) == SOCKET_ERROR)
{
    WSACleanup();
    return errorReport("Failed to connect to server.");
}

if (nBytes == -1)
{
    WSACleanup();
    disconnect(nBytes); 
    return errorReport("Could not connect");
}

return 0;
} 
```

另外，请随时告诉我我在当前连接方法中做错的任何事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T20:42:58.687

长时间的延迟是由于套接字在返回调用者之前需要超时造成的。为了减少总执行时间，您应该创建多个同时连接到不同 IP 地址的工作线程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T20:48:21.140

好的，这里有几件事。

首先，连接被设计为在超时之前等待一段时间，以防服务器繁忙。您可以调整超时长度，尽管我不记得究竟是如何做到这一点的。

其次，你的代码会找到一个服务器，但是你怎么知道它是你要找的服务器呢？它可能是其他一些正在侦听同一端口的应用程序。除非您只是专门对任何服务器进行扫描，否则您需要进行一些验证以确保您在另一端与谁交谈。

最后，假设您正在编写客户端和服务器，更好的解决方案是让客户端发送广播/多播消息并让服务器（或服务器，如果有多个）监听并响应该消息. 然后，客户端只需等待某个指定的时间段以获取响应以确定服务器的位置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:47:41.860

我会做一个研究，看看winsock是否支持异步I/O。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T20:49:39.980

服务器 IP 地址是否如此随机，以至于您每次都需要这样做？我很长一段时间没有做过任何套接字编程，但是有超时和这样的情况可能不会变得更好。

其他选项：

*   使用 IP 地址的网络共享上的配置文件怎么样？这可以在服务器启动时重写。
*   将服务器的 IP 地址设为静态和硬编码或放入配置文件
*   通过机器的 DNS 或 NETBIOS 名称查找

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T21:00:18.163

如果你知道服务器在子网上，为什么不发送一个带有本地接收端口号的广播消息作为消息数据呢？然后服务器可以简单地侦听此消息并连接回该端口，或者将其自己的配置数据发送回该端口，以便客户端可以直接连接。这样，您只需要发送一条消息，而不是循环超过 256 个 IP 地址。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T21:20:17.850

过去，在“每个人都有 139 端口”开放日，我已经成功地做到了这一点。

我发现使用多个线程（遗憾的是，我使用了大约 500 个线程，但这是一次性的，只是为了好玩）并且我在尝试连接之前 ping 服务器允许我每秒遍历几个 thourand IP。

我仍然有源代码（C++），如果您想查看它，请给我留言。

另外，到底为什么需要扫描 IP？即使它是动态的，您也应该能够通过其主机名查找 ip。请参阅 gethostbyname() 或 getaddrinfo()。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T21:49:40.023

我看到你正在使用窗户。但是，如果您使用的是 Linux，您可以通过组合非阻塞套接字并选择来创建一个具有超时的连接函数：

```
int connect_with_timeout(int sock, struct sockaddr *addr, int size_addr, int timeout) {
#if defined(Linux)
    int             error = 0;
    fd_set          rset;
    fd_set          wset;
    int             n;

    // set the socket as nonblocking IO
    int flags = fcntl (sock, F_GETFL, 0);
    fcntl(sock, F_SETFL, flags | O_NONBLOCK);

    errno = 0;

    // we connect, but it will return soon
    n = connect(sock, addr, size_addr);

    if(n < 0) { 
        if (errno != EINPROGRESS) {
            return -1;
        }
    } else if (n == 0) {
        goto done;
    }

    FD_ZERO(&rset);
    FD_ZERO(&wset);
    FD_SET(sock, &rset);
    FD_SET(sock, &wset);

    struct timeval tval;
    tval.tv_sec = timeout;
    tval.tv_usec = 0;

    // We "select()" until connect() returns its result or timeout
    n = select(sock + 1, &rset, &wset, 0, timeout ? &tval : 0);
    if(n == 0) {    
        errno = ETIMEDOUT;
        return -1;
    }

    if (FD_ISSET(sock, &rset) || FD_ISSET(sock, &wset)) {
        socklen_t len = sizeof(error);
        if (getsockopt(sock, SOL_SOCKET, SO_ERROR, &error, &len) < 0) {
            return -1;
        }
    } else {
        return -1;
    }

done:
    // We change the socket options back to blocking IO
    if (fcntl(sock, F_SETFL, flags) == -1) {
        return -1;
    }
    return 0;
#else
    return connect(sock, addr, size_addr);
#endif
} 
```

# javascript - 重新排序 Div

> ID：558614
> 
> 赞同：23
> 
> 时间：2009-02-17T20:37:57.920
> 
> 标签：javascript, jquery, html, css

如何在不更改 HTML 源代码的情况下重新排序 div？

例如，我希望 div 以 #div2、#div1、#div3 的顺序出现，但在 HTML 中它们是：

```
<div id="#div1"></div>  
<div id="#div2"></div>  
<div id="#div3"></div> 
```

谢谢！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-17T20:46:18.367

没有用 css 重新排序元素的万能方法。

您可以通过将它们全部向右浮动来水平反转它们的顺序。或者，您可以将它们绝对相对于正文或其他包含元素进行定位——但这对元素的大小以及相对于页面上其他元素的定位有严格的限制。

简短的回答：你只能在非常有限的情况下实现这一点。重新排序元素最好在标记中完成。

如果您无法控制 html，则可以使用 javascript。这里使用jQuery：

```
$("#div2").insertAfter("#div3");
$("#div1").prependTo("#div2"); 
```

我当然不建议这样做，除非你的手被绑住了。这将更难维护，并且对于您的最终用户来说，它会使您的页面在设置页面时“晃动”。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-17T20:55:01.997

我会使用Javascript相应地遍历节点。如果你想使用像 jQuery 这样的库，你可以使用上面的建议。如果您不想臃肿，请使用以下简单而简约的解决方案...

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Test</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script type="text/javascript">
      function swapSibling(node1, node2) {
        node1.parentNode.replaceChild(node1, node2);
        node1.parentNode.insertBefore(node2, node1); 
      }

      window.onload = function() {
        swapSibling(document.getElementById('div1'), document.getElementById('div2'));
      }
    </script>
  </head>
  <body>
    <div id="div1">1</div>
    <div id="div2">2</div>
    <div id="div3">3</div>
  </body>
</html> 
```

最好的祝福...

**编辑：**将函数名称从 swapNode 更改为 swapSibling，因为我相当确定这仅适用于具有相同父节点的节点。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2016-09-13T09:13:35.423

由于现在[flexbox](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)得到广泛支持，您还可以使用它来仅使用 css 重新排序 div：

```
<div id="container">
    <div id="div1">1</div>  
    <div id="div2">2</div>  
    <div id="div3">3</div>
</div> 
```

和CSS：

```
#container{
  display: flex;
  flex-direction: column;
}

#div2{
  order:2
}

#div3{
  order:1
} 
```

它会显示：

```
1
3
2 
```

你可以在这个[fiddle](https://jsfiddle.net/2jse4h44/)上试试。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-17T20:52:12.003

在 jQuery 中，您可以执行以下操作：

```
$("#div1").insertAfter("#div2"); 
```

这会将具有 id 'div1' 的元素移动到具有 id 'div2' 的元素之后。这假设您从 id 属性中消除了“#”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-17T20:54:27.880

你可以用Javascript做：

```
function reOrder() {
  divOne = document.getElementById('#div1');
  divTwo = document.getElementById('#div2');
  divThree = document.getElementById('#div3');
  container = divOne.parentNode;
  container.appendChild(divTwo);
  container.appendChild(divOne);
  container.appendChild(divThree);
} 
```

编辑：修正了 ID 中的拼写错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T20:44:52.880

由于您标记了 jQuery，您可以使用 javascript[删除](http://docs.jquery.com/Manipulation/remove#expr)元素，然后[重新插入它们](http://docs.jquery.com/Manipulation/insertAfter#content)，尽管这可能不太灵活。

我认为，拥有更多背景信息会为您提供更好的答案。

# c# - Asp.Net MVC - Rob Conery 的 LazyList - Count() 或 Count

> ID：558615
> 
> 赞同：2
> 
> 时间：2009-02-17T20:38:12.070
> 
> 标签：c#, asp.net, asp.net-mvc, linq-to-sql, lazy-loading

我正在尝试为客户的订单日志创建一个 html 表。客户被定义为（我遗漏了很多东西）：

```
public class Customer
{
    public LazyList<Order> Orders { get; set; }
} 
```

LazyList 在获取客户时设置：

```
public Customer GetCustomer(int custID)
{
    Customer c = ...
    c.Orders = new LazyList<Order>(_repository.GetOrders().ByOrderID(custID));
    return c;
} 
```

订单日志模型：

```
public class OrderLogTableModel
{
    public OrderLogTableModel(LazyList<Order> orders)
    {
        Orders = orders;
        Page = 0;
        PageSize = 25;
    }

    public LazyList<Order> Orders { get; set; }
    public int Page { get; set; }
    public int PageSize { get; set; }
} 
```

我在加载客户后传递了客户。订单。现在我正在尝试制作的日志看起来像：

```
<table>
<tbody>
<% 
    int rowCount = ViewData.Model.Orders.Count();
    int innerRows = rowCount - (ViewData.Model.Page * ViewData.Model.PageSize);
    foreach (Order order in ViewData.Model.Orders.OrderByDescending(x => x.StartDateTime)
                            .Take(innerRows).OrderBy(x => x.StartDateTime)
                            .Take(ViewData.Model.PageSize))
    {
        %>
        <tr>
            <td>
                <%= order.ID %>
            </td>
        </tr>
        <%
    }
%>
</tbody>
</table> 
```

哪个工作正常。但问题是评估 ViewData.Model.Orders.Count() 从字面上看需要大约 10 分钟。

我已经尝试使用 ViewData.Model.Orders.Count 属性，结果是相同的 - 需要永远。

我还尝试直接从视图中调用 _repository.GetOrders().ByCustomerID(custID).Count() 并且在几毫秒内完美执行。

任何人都可以看到为什么使用 LazyList 进行简单计数需要这么长时间吗？在获得简单计数时，它似乎试图遍历列表。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T20:46:01.940

LazyList 在首次使用时加载所有数据，因此您在 Count 调用中加载列表中的所有订单。从数据库中获取所有数据，实例化对象等。当您调用 _repository.GetOrders().ByCustomerID(custID).Count() 时，它只计算数据库中的行数并返回一个数字。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-22T13:40:32.717

您遇到的问题是[LazyList<T>](http://blog.wekeroad.com/blog/lazy-loading-with-the-lazylist/)正在填充数据库中的整个订单列表，以便您可以计算它们。只是为了得到一个简单的计数就需要做很多工作。

您可以将 LazyList<T> 类的 Count 方法修改为以下内容：

```
public int Count 
{
    get 
    { 
        if(inner == null)
            return query.Count;
        else
            return inner.Count;
    }
} 
```

如果订单列表尚未补充，它将改为向 IQueryable 询问计数。通过在 IQueryable 上调用 .Count() 您要求 LINQ to SQL 仅获取结果数，这将被转换为类似“SELECT COUNT(*) FROM Orders”的内容。这样做**比**将所有结果水合然后计算它们更有效，特别是如果您只对数字感兴趣！

# iphone - 动画 CGContextStrokeEllipseInRect

> ID：558617
> 
> 赞同：0
> 
> 时间：2009-02-17T20:38:22.723
> 
> 标签：iphone, objective-c, cocoa, core-animation

我正在尝试动画绘制一个圆圈。Shazaam 应用程序在录制时正在执行的操作，但要简单得多。
我在 drawRect: 方法中有这个代码来绘制圆：

```
CGContextRef currentContext = UIGraphicsGetCurrentContext();
CGContextSetRGBStrokeColor(currentContext, 0.86, 0.86, 0.86, 1.0);
CGContextSetLineWidth(currentContext, kLineWidth);
CGContextStrokeEllipseInRect(currentContext, CGRectMake(0.0, 0.0, 150.0, 150.0)); 
```

我尝试使用以下方法为圆圈设置动画：

```
[CATransaction begin];
[CATransaction setValue:[NSNumber numberWithFloat: 3.0f] forKey: kCATransactionAnimationDuration];
// Drawing code above
[CATransaction commit]; 
```

它唯一做的就是按照说明画圆，但它不是动画的。

谁能帮我这个？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T22:01:34.473

您将无法以这种方式为绘图设置动画。相反，您必须循环（例如使用 NSTimer）并不断重绘。

我不确定这是否是 Shazaam 的工作方式。

另一种选择是创建一系列图像并在 UIImageView 中为它们设置动画。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T16:09:50.927

Omni 的人们已经发布[了一种动画 CALayer 内容的](http://blog.omnigroup.com/2008/11/14/animating-calayer-content/)方法，这将是实现此动画的一种方法。（通常，Core Animation 只处理更改预渲染层的大小、位置、旋转或不透明度，而不是其内容。）他们的示例使用动画正弦波，但您可以将其替换为弧形图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:18:07.213

此外，如果您只是创建一个圆形“微调器”动画，您可以只创建一个圆形图像，其线“渐变”从 1 到 0 并旋转它。但听起来您实际上是在尝试为线条的绘制设置动画，而不仅仅是创建一个微调器，因此 August 建议的在计时器上重绘的解决方案听起来像是要走的路。

# c# - 为什么我的验证事件没有在 C# 中触发？

> ID：558621
> 
> 赞同：21
> 
> 时间：2009-02-17T20:39:43.767
> 
> 标签：c#, winforms, validating-event

我有一个动态创建的表单。它是一个winForms 应用程序。

此表单只是一个菜单和一系列文本框和标签。在本示例中，您可以忽略标签。

我的问题是：当我在文本框中编辑内容时，然后单击菜单发出“保存”，最后一个文本框中的文本仍未发出其“验证”方法。这似乎是因为控件仍然具有焦点，并且菜单位于单独的线程中。

当用户单击“保存”时，如何强制触发验证事件？我不知道用户在哪个文本框上（如果有的话），并且`SomeKnownControl.Focus();`在“保存”功能中发出似乎没有帮助。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-17T20:49:44.223

我以前有过这个。在您的表格中：

```
private void SaveButtonClick(...)
{
    if (this.ValidateChildren())
    {
        // do save
    }
} 
```

[MSDN 上的 ValidateChildren](http://msdn.microsoft.com/en-us/library/ms159409.aspx)

# iphone - UINavigationController 在模态视图之上

> ID：558626
> 
> 赞同：0
> 
> 时间：2009-02-17T20:40:44.747
> 
> 标签：iphone, cocoa-touch

我有一个模态视图控制器，我使用`presentModalViewController:animated`. 这个特定的视图控制器，一个实例`UIViewController`，有一个`UITableView`和 带有更多`detailAccessory`选项的单元格。单击日期行应允许控制器`UIDatePicker`在屏幕上填充。问题是这样的：

1.  您不能一次将两个模态视图放到屏幕上。
2.  由于约束 #1，我必须使用`UINavigationController`and `pushViewController:animated:`。这样做是将我的控制器推`UIDatePicker`到堆栈顶部，但在物理上位于我的模态视图控制器之下。

这是否意味着我的模态视图控制器需要它自己的`UINavigationController`？最好的选择是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T21:17:26.250

如果我没看错，你就是

1.  呈现模态视图
2.  响应单元格确实选择了消息
3.  在某处推入一个新视图，可能在您的模态视图下方使用导航控制器

如果你想以模态方式呈现一个新的 UINavigationController，你可以。一个很好的例子是人员选择器。

我认为当用户执行操作时，从模态视图底部滑入 UIDatePicker 可能更容易。这将消除推入新视图控制器的需要，但您需要调整表格视图的大小以适应日期选择器的显示/隐藏。

# core - 核心转储到 SAN

> ID：558627
> 
> 赞同：0
> 
> 时间：2009-02-17T20:41:09.067
> 
> 标签：core, san

如果应用程序安装到 SAN 并且进程崩溃，是否可以将核心转储写入 SAN 分区？我一直在试图找出一个问题，即我们的进程死亡并且没有生成核心，因此没有堆栈。这两种情况都在两个完全独立的 Solaris 环境中。ulimit -c 是无限的，pstack 在路径中。在我最初的研究中，我发现了一个声明，声称无法将核心转储到 SAN 磁盘。我无法再次找到此信息，导致我质疑其有效性。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-22T19:52:48.933

您发现对 SAN 的核心转储不起作用的参考可能是指内核本身的核心转储。（在 Solaris 上通常称为故障转储）

也许该进程没有有用的当前目录。使用 coreadm 强制将核心转储写入合理的地方。请参阅[http://developers.sun.com/solaris/articles/manage_core_dump.html](http://developers.sun.com/solaris/articles/manage_core_dump.html)

如果您的进程意外死亡，并且您有可能破坏其性能，请尝试在 truss 下运行它。如果这是 Solaris 10，dtrace 在这里可能会很有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T09:56:59.043

未生成或未列出内核时的条件`core(4)`，`man core`用于阅读手册页。如果用户 id*没有人*参与，那可能会发生（或者更确切地说，什么都没有发生）。

您还可以使用`gcore`来查看手动获取核心转储是否会有所帮助。检查`coreadm`默认情况下核心转储的位置 - 也许它们不在当前工作目录中，而是在某个地方`/var`？

沃尔克

# http - 是否有任何 http 自动化工具/库可以直接执行 http 请求而不是自动化浏览器？

> ID：558629
> 
> 赞同：1
> 
> 时间：2009-02-17T20:42:41.607
> 
> 标签：http, automation

我正在寻找一个可以进行网页记录/播放的工具/库（最好是基于 .NET）。出于性能原因，我希望此工具直接发出 http 请求，而不是使浏览器自动化。想一想，我非常想找一个记录器，它可以生成使用 .NET 中的 WebClient 类的代码。

我发现的所有工具都是为基于 Web 的 UI 测试而设计的，因此它们与浏览器交互以支持 javascript、对话框等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T08:52:18.660

我不知道您是否对此感兴趣，但我使用了 fiddler 和 curl 的组合，有时还使用 Wireshark：

提琴手：[http](http://www.fiddler2.com/fiddler2/) ://www.fiddler2.com/fiddler2/ 卷曲：[http](http://curl.haxx.se/) ://curl.haxx.se/ Wireshark： http: [//www.wireshark.org/](http://www.wireshark.org/)

没有脚本的录制/回放，但是我发现这两个工具非常有用，

Fiddler 用于查看请求和响应，Curl 用于重放它们，wireshark 用于当它变得非常混乱时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T01:50:46.247

LoadRunner 虚拟用户生成器 (VUGen) 通过记录和回放 HTTP 请求来工作。您可以从 HP 下载 LoadRunner 的试用版，如果您想使用它，只需安装 VUGen。它以 C 的专有风格生成脚本，但它可能会为您提供一些关于如何在 .NET 中执行相同操作的想法。

还有一个名为[WebLoad](http://www.webload.org/)的开源负载测试工具，我相信它是由 LoadRunner 的原始开发人员创建的。我的猜测是他们有一个类似于 VUGen 的脚本组件。您可以在 SourceForge 上找到[WebLoad 的源代码。](http://sourceforge.net/project/showfiles.php?group_id=189476)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T19:55:04.357

我不熟悉基于.Net 的工具可以满足您的需求，但如果您可以容忍Java UI，[JMeter](http://jakarta.apache.org/jmeter/)将完全满足您的需求。

它基本上是一个在传输（即请求/响应）级别运行的负载测试工具。它具有记录/播放/脚本功能，并支持多种不同的协议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T20:46:59.253

我已经使用[NUnitASP](http://nunitasp.sourceforge.net/)来验证页面是否加载并且不会抛出异常，但它并没有真正做很多 UI 交互；并且没有javascript。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T20:55:36.067

我在 Java 中使用过很多 HttpUnit。一个快速的谷歌搜索发现[这个页面](http://xprog.blogspot.com/2004/07/web-page-unit-tests.html)有几个 HttpUnit 克隆项目，所以这可能是一个开始的地方。

我之前曾尝试将 Java HttpUnit 测试与 .NET 应用程序一起使用，但 .NET 对回发和视图状态的使用使其非常难看（如果它确实有效的话）。

# iphone - iPhone UIWebView 播放 MP3。解雇协议？

> ID：558636
> 
> 赞同：5
> 
> 时间：2009-02-17T20:44:41.397
> 
> 标签：iphone, audio, uiwebview

所以我找不到任何关于如何做到这一点的文档，也许有人知道这里发生了什么。

我在我的应用程序中的 UITableView（带有 UINavigationController）中，并通过将 Web 视图的控制器推送到导航控制器的堆栈上来启动在互联网上加载 mp3 文件的 UIWebView。这很好用，文件在 Safari 使用的 quicktime 播放器中启动和播放。

问题是，一旦音频文件播放完毕，或者用户单击完成按钮，播放器就会被释放，并且应用程序会返回到带有导航栏的空 webView。我可以点击后退按钮回到我原来的 UITableView，但是那个空白屏幕很难看，需要离开。

那么，我可以使用什么操作将 [webviewcontroller.navigationcontroller popviewcontroller] 消息放入？它是否加载了其他类的实例（如 AVAudioPlayer）来播放音频？我需要子类化一些东西吗？Apple 关于如何在 UIWebView 中播放音频的文档基本上不存在。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-21T02:26:04.363

好的，所以我找到了一个更好、更简单的解决方案；我必须从我的应用程序中删除代码行才能使用。我只是使用了 UIWebview initWithFrame:CGRectMake(0.0,0.0,1.0,1.0)，没有将其添加到视图中，然后调用了 NSURLRequest，并将其连接到我的按钮。媒体播放器自动全屏，无需调用导航控制器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-17T22:25:22.923

这可能会为某人节省一两个小时：UIWebView 在设备和模拟器上的行为不同（大约 iOS 4.1）。

我只是花了一些时间试图关闭模拟器上的 webview，但它一直在设备上工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:39:10.050

您可以通过一些 javascript 更改 location.href 来伪造它，然后执行以下操作：

```
- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request
        navigationType:(UIWebViewNavigationType)navigationType {

    NSString* path=[[request URL] relativePath];
    BOOL shouldContinue=YES;

    if ([path isEqualToString:@"/_my_custom_link"])
    {
        shouldContinue=NO;
        // do magical stuff
    }
    return shouldContinue;
} 
```

如果这不起作用，您可以随时通过执行

```
stringByEvaluatingJavaScriptFromString 
```

# flash - 为什么我不能在 Flash CS4 的回调方法中访问组合框？

> ID：558639
> 
> 赞同：3
> 
> 时间：2009-02-17T20:45:02.973
> 
> 标签：flash, actionscript-2, flash-cs4

看看这段代码：

```
import mx.core.View;
var accordianPane = my_acc.createSegment("mcElectrical", "panel0", "Electrical", "payIcon");
accordianPane.comboBox.addItem("test"); 
```

这会将带有标签“test”的项目添加到影片剪辑中的组合框中。它工作得很好。但是，当我将相同的代码放在回调函数中时，它会失败。

```
import mx.core.View;

// Load Cost Guide feed.
var costGuideUrl:String = "http://test/cost-guide.ashx";
var costGuideXml:XML = new XML();
costGuideXml.onLoad = function(success) {
    if(success) { 
        populateAccordian(this); 
    } else {
        // Display error message.
    }
};
costGuideXml.load(costGuideUrl);

// Populate Accordian with retrieved XML.
function populateAccordian(costGuideXml:XML) {

    var accordianPane = my_acc.createSegment("mcElectrical", "panel0", "Electrical", "payIcon");
    accordianPane.comboBox.addItem("test");
    // This line definitely executes...
} 
```

关于为什么我无法从回调内部进入组合框的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T21:12:11.410

好的，所以首先看起来你正在使用 AS2。

因为它是 as2，所以问题可能是范围问题。作用域在 as2 到 as3 中的工作方式不同。回想我的 as2 天，当你设置这个回调函数时，你就在 costGuideXML 的范围内。由于您在此范围内，因此您无权访问 my_acc 变量。

您可能需要使用 Delegate 类来使 populateAccordian 方法在原始类的范围内执行（如果它在时间轴上，则可能是一个影片剪辑）。

类似的东西（虽然这是未经测试的）：

```
import mx.utils.Delegate;

    // Load Cost Guide feed.
    var costGuideUrl:String = "http://test/cost-guide.ashx";
    var costGuideXml:XML = new XML();
    costGuideXml.onLoad = Delegate.create(this, xmlLoadedHandler);
    costGuideXml.load(costGuideUrl);

    function xmlLoadedHandler() : Void
    {
     populateAccordian(costGuideXml); 
    }

    // Populate Accordian with retrieved XML.
    function populateAccordian(costGuideXml:XML) {

        var accordianPane = my_acc.createSegment("mcElectrical", "panel0", "Electrical", "payIcon");
        accordianPane.comboBox.addItem("test");
        // This line definitely executes...
    } 
```

# dos - How can I delete all files/subdirs except for some files in DOS?

> ID：558648
> 
> 赞同：11
> 
> 时间：2009-02-17T20:48:07.113
> 
> 标签：dos

I'm looking for a DOS script to delete all files and subdirectories in a root directory except for a set of batch files (*.bat) that are in the root directory. Any DOS jocks out there that know an easy way to do this?

**Update**

Thanks for your help everyone. This is where I'm at now (see below). I'm using Ken's suggestion for the delete of the files. I would like to know how I can stop this script running if the `del` or `RD` commands fail due to a lock on a file/dir. Anyone know how? Right now, this script will do a bunch of things after the deletes and I'd like to stop the script if any of the deletes fail.

```
@echo off

REM *********************************************************************
REM *  Delete all files and subdirs except for batch files in the root  *
REM *********************************************************************

REM Delete all files in current dir except bat files.  Does this by a) setting the attributes of *.bat files to 
REM readonly and hidden, b) deleting the rest, c) reseting the attributes 

attrib +r +s *.bat
del *.* /S /Q
attrib -r -s *.bat

REM Deletes ALL subdirectories 

FOR /D  %%G in (*) DO RD /s /q %%G 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-17T20:55:25.490

YOu can set the attributes of the files you want to keep to readonly and hidden first, delete the rest, and then reset the attributes of the hidden, readonly files back.

```
attrib +r +s *.bat
del *.*
attrib -r -s *.bat 
```

I used to do that quite often, and wrote a batch file that automated this:

```
@echo off
@ if "%1" == "%9" goto help
@ if /i %1 EQU ? goto help
@ if /i %1 EQU help goto help
@ attrib +h +s %1
@ %2 %3 /Q
@ attrib -h -s %1
@ goto :EOF
:help
@echo        ╔═══════════════════════════════════════════════════════╗
@echo        ║ except filespec1 doscommand filespec2                 ║
@echo        ║                                                       ║
@echo        ║  filespec1  The files to exclude from doscommand      ║
@echo        ║  doscommmand The DOS command to execute on filespec2  ║
@echo        ║  filespec2  The files to execute doscommand against   ║
@echo        ║                                                       ║
@echo        ║ Example:                                              ║
@echo        ║                                                       ║
@echo        ║ except *.txt del *.*                                  ║
@echo        ║                                                       ║
@echo        ║Deletes all files except text files in the directory   ║
@echo        ╚═══════════════════════════════════════════════════════╝ 
```

It's probably OK just to use the hidden attribute, but I know that del doesn't touch hidden system files, so I set both. Better safe than sorry, IMO.

Based on a comment from Marcus: If you want to extend this to include subdirectories of the current directory, simply change both attrib lines to

```
attrib <remainder of line>  /S 
```

and change the line between the two attrib lines to

```
@ %2 %3 /Q /S 
```

That should work for most things you'd want except.bat to do.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T20:51:42.037

Fixed based on @Ken's comment:

```
>d:
>mkdir bats
>c:
>copy *.bat d:\bats
>del *.* / Y
>copy d:\bats\*.bat c:\ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:36:05.300

This is based on Alex's method of backing up the .BAT files, but deletes all subfolders too, using the RD command.

```
@echo off

rem !WARNING!
rem THE_DELETE_DRIVE is the drive to delete
rem THE_BACKUP_DRIVE is the drive to use for backup
set THE_DELETE_DRIVE=T:
set THE_BACKUP_DRIVE=C:
rem !WARNING!

echo This will recursively delete everything from %THE_DELETE_DRIVE%\ (except batch files).
echo Are you sure? Press Ctrl+C to cancel, or any other key to continue...
echo.
pause

rem Make the backup folder
md %THE_BACKUP_DRIVE%\bak12345

rem Copy all batch files from delete-drive root to backup folder
copy %THE_DELETE_DRIVE%\*.bat %THE_BACKUP_DRIVE%\bak12345

rem Delete everything in the delete-drive root
rd /s/q %THE_DELETE_DRIVE%\

rem Copy all backed-up files back to delete-drive root
copy %THE_BACKUP_DRIVE%\bak12345\*.bat %THE_DELETE_DRIVE%\

rem Remove the backup folder
rd /s/q %THE_BACKUP_DRIVE%\bak12345

echo ************************************
echo All Done!
echo ************************************
echo.

pause 
```

# php - 如何在 Flash 播放器中隐藏 .flv 文件的 url？

> ID：558653
> 
> 赞同：2
> 
> 时间：2009-02-17T20:49:36.550
> 
> 标签：php, flash

我使用过期 url 来隐藏我在我的网站上使用的图像的 url，以便它们只能在哈希的生命周期（1 小时）内被热链接。

我检查与文件 url 一起发送的哈希值，与服务器上的哈希值相匹配，如果它们匹配，脚本将调用以下代码：

```
if (isset($_GET["hash"])) {
        $this_min = date('Y-m-d-g',time()) . "salt" . $vid_id;
        $current_hash =  substr(md5($this_min),0,12);
        $submitted_hash = mysql_real_escape_string($_GET["hash"]);
        if ("$current_hash" == "$submitted_hash") {
            $file_url2 = "directory/" .  $vid_file;
            header('Content-Type: application/octet-stream');
            header("Content-Transfer-Encoding: Binary"); 
            header("Content-disposition: inline; filename=\"".md5($vid_file)."\""); 
            readfile($file_url2);
            exit;
        } else {
            $_SESSION["message"] = "Download link expired, refresh the page and try again";
            $_SESSION["message_type"] = 0;
            header("Location:" . $_SERVER['HTTP_REFERER']);
            exit;       
        }
    } 
```

我在标签中使用它（例如，`<img src="index.php?id=123&hash=ew6rg5reg4">`它工作得很好。如果图像是热链接的，它会在哈希更改时停止工作，每小时（或必要时每分钟）。不幸的是，当我使用它将.flv 文件加载到flash 播放器中，例如JW 播放器。没有.flv 文件被加载。

有什么办法可以解决这个问题或用另一种方法实现同样的目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T00:55:37.143

您不能真正非常有效地隐藏下载 URL。例如，Safari 会公开通过“活动”窗口下载的所有资源。只需查找大小为 MB 的项目，即您的 FLV 文件。

阻止人们翻录您的 FLV 的唯一方法是使用 RTMP 流，他们永远无法访问完整文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T01:55:17.190

您可以使用 htaccess fils 停止除您的域之外的引荐来源网址（仅限 apache 服务器）

```
RewriteEngine On
Options +FollowSymLinks
        <ifmodule mod_rewrite.c>
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^http://(www\.)?yourdomain.com/.*$ [NC]
    RewriteRule \.(gif|jpg|png|mp3|mpg|avi|mov|flv)$ - [F]  
    </ifmodule> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T23:31:30.437

知道播放器脚本抛出什么运行时错误会很有趣吗？

您可能有更多机会使其与设置为**video/x-flv**或**flv-application/octet-stream**的 MIME 类型一起工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T00:26:38.557

它也应该适用于 JW 播放器等。

一些服务器，例如 nginx，有模块可以非常有效地进行这种验证，因此您不必在 PHP 中进行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T12:47:24.010

真正限制对 flv 文件的访问的唯一方法是在文件所在或流式传输的服务器上实现一些 ACL 之王。我正在使用 Wowza Media 进行实时视频流，并且服务器已经实现了多种机制来保护您的文件/流：基于 ACL 的身份验证、StreamNameAlias ...

# algorithm - 算法和设计模式有什么区别

> ID：558657
> 
> 赞同：26
> 
> 时间：2009-02-17T20:50:59.277
> 
> 标签：algorithm, design-patterns, semantics

我正在搜索“撤消/重做算法”并找到标记为重复的内容，但该副本是对“撤消设计模式”的请求。我真的很想要一个算法。我认为我不一定需要设计模式。

“设计模式”和“算法”之间是否存在根本区别，或者有人可以互换使用两者？

我会挂断我的回答。

好吧，请原谅我认为设计模式只是算法的抽象。这是我从答案中得出的一些发现的小表格，这些结果都非常好。

```
   设计模式 | 算法
------------------|----------------
摘要 | 具体的
控制结构 | 一组动作    
模板 | 执行
灵活 | 确定性
蓝图 | 食谱

```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-17T20:54:06.710

算法就像一个食谱：执行某些活动的逐步过程。

设计模式就像一个蓝图：一个结构化的对象、关联和动作的集合，以完成某个目标。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-17T20:58:19.587

是，有一点不同。

**算法**是执行某些任务的秘诀——一组明确的有限指令，通过对输入进行操作并产生输出来实现某个目标。通常，算法以与语言无关的伪代码表示，然后可以用您选择的语言实现。

**设计模式**是一种结构化代码的方式，以便优雅地表达功能组件之间的关系。您可以在算法的实现中使用设计模式。例如，您可以使用一种算法进行树的有序遍历，以确保您按特定顺序访问树数据结构的所有节点。您还可以实现*访问者*设计模式来表达您的实现如何将控制权返回给调用上下文以指示节点已被访问。这不是算法的一部分，而是软件设计的一部分，以及如何构建软件每个组件可以使用的接口。

算法和设计模式是正交的，尽管它们很可能同时使用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-17T20:55:36.207

设计模式是对如何在架构级别解决问题的相对模糊的描述，强调灵活性和可维护性。算法是对如何计算特定事物的精确描述，强调正确性和效率。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T20:57:58.823

设计模式不能直接转换为代码。它是一种“策略”，可用于应用程序的设计。该术语的起源是计算机科学之外的。阅读有关[克里斯托弗·亚历山大](http://en.wikipedia.org/wiki/Christopher_Alexander)的信息以了解更多信息。

另一边的算法可以用代码表示。它是针对任何输入解决特定问题的一系列操作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T21:40:21.140

算法是一组步骤/动作/命令/指令，在所有情况或状态变化中以指定的顺序/方式工作。在撤消/重做的情况下，它将涉及在每个接合点存储先前的状态，然后根据命令再现它（通过应用程序具有的任何方式）。但由于这个定义非常模糊，并且每个特定情况都不同，我们希望创建一个更通用的设计模式，可以将特定应用程序的功能插入其中。

> 在软件工程中，**设计模式**是针对软件设计中常见问题的通用可重复解决方案。设计模式不是可以直接转换为代码的完成设计。它是关于如何解决问题的描述或模板，可以在许多不同的情况下使用。--[源头制作](https://sourcemaking.com/design_patterns)

Christopher Alexander 是建筑师，他首先研究了建筑物和社区中的模式，并开发了一种“模式语言”来生成它们。

> 每个模式都描述了一个在我们的环境中反复出现的问题，然后描述了该问题的解决方案的核心，这样您就可以使用该解决方案一百万次，而不必以同样的方式重复使用两次. ——克里斯托弗·亚历山大

所以这些术语是不可互换的，因为它们指的是不同的设计水平。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T20:55:37.050

我会说设计模式定义了结构，而算法定义了行为。

例如，您可以将几种不同的算法与[策略设计模式](http://en.wikipedia.org/wiki/Strategy_pattern)结合使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T21:00:04.620

算法是执行任务的一组特定步骤。解码音频或视频文件将使用算法。

设计模式更像是设计具有某些特征的系统的模板。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-17T21:05:38.710

它们是不同的： http://en.wikipedia.org/wiki/Design_pattern_( [computer_science)](http://en.wikipedia.org/wiki/Design_pattern_(computer_science)) vs [http://en.wikipedia.org/wiki/Algorithm](http://en.wikipedia.org/wiki/Algorithm)

使用命令设计模式（[http://en.wikipedia.org/wiki/Command_pattern](http://en.wikipedia.org/wiki/Command_pattern)），很容易实现撤销/重做：[http ://www.cs.mcgill.ca/~hv/classes/CS400/ 01.hchen/doc/command/command.html](http://www.cs.mcgill.ca/~hv/classes/CS400/01.hchen/doc/command/command.html)

相关问题：[Undo Engine 的设计模式](https://stackoverflow.com/questions/49755/design-pattern-for-undo-engine)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-08-21T15:55:02.803

当我第一次研究设计模式的概念时，我也很惊讶为什么在算法存在的情况下引入了设计模式。随着我对设计模式的了解不断增加，我在这一点上得出结论，算法是完全不同的解决问题的方法，设计模式也不同。

设计模式基本上是针对特定上下文中的软件应用程序的相同问题的重复解决方案，它在某种程度上与算法无关，因为算法是解决问题的分步说明。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-17T20:53:41.610

设计模式将决定您如何设计算法（或者可能与算法无关，但假设我们正在处理的算法），而算法将是一组可靠的、可重复的、可实现的步骤某物。所以不，我不会称它们为可互换的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-08-06T04:38:58.570

如何组织**特征类型**而不是特定特征可能是将“设计模式”与“算法”分开的关键......

设计模式描述了常见设计问题的通用解决方案。“每个模式都描述了一个在我们的环境中反复出现的问题，然后描述了该问题解决方案的核心，以这样一种方式，您可以使用该解决方案一百万次，而无需以相同的方式使用它两次”（[克里斯托弗亚历山大](http://en.wikipedia.org/wiki/Design_pattern)）在编程中，这是通过描述软件对象之间的特定关系集来完成的（代表概念或现实世界的对象）。应该避免描述具体的实现，因为它会降低设计模式的通用性。

算法是一组定义如何执行任务的步骤。算法中每个步骤的执行不需要创造性技能。相反，它只需要遵循指示的能力。（警告：非确定性算法，不符合这个限制，是一个重要的研究课题）

因此，我认为对这种关系的一种描述可能是将功能与功能分开。然而，一个对象的特征集合将决定它的功能，因为每个子特征都有封装在其中的功能。当您将许多小对象组合成一个更大的对象（例如，将不同类的实例放入程序中）时，其中一些将协同工作以创建它们自己没有的新功能（整体大于其部分的总和） ）。你可以说这只是一个新算法，但它也是一个新对象。特性和功能是同一枚硬币的两个方面，不可能完全分开。但是如何组织**特征类型**而不是特定功能可能是将“设计模式”与“算法”区分开来的关键，因为如果设计模式是关于组织特定功能，即特定类的实例，那么算法将已经被呈现并且实现将完全相同时间，即它不会是通用的，你不能“使用这个解决方案一百万次，而不是以同样的方式做两次”。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-10-22T03:31:48.670

设计模式：

*   一个常见但普遍的问题的解决方案。
*   一般问题的一般解决方案。
*   通常每次使用时都必须执行。

算法：

*   您可以遵循的特定步骤来回答特定问题。
*   直接实施以解决具体问题。

# asp.net - 在 asp.net 网站中显示图片/照片

> ID：558663
> 
> 赞同：2
> 
> 时间：2009-02-17T20:51:59.243
> 
> 标签：asp.net, jquery, image

我想要一种非常好的方法来将图片加载到网页上，比如我的作品集（假设是我在网上出售的陶器）-各种淡入淡出效果等-您能推荐什么？jQuery中有什么东西吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T21:20:55.773

最受欢迎的可能是：

*   [灯箱](http://www.huddletogether.com/projects/lightbox/)
*   [灯箱2](http://www.huddletogether.com/projects/lightbox2/)
*   [厚盒 jquery 插件](http://jquery.com/demo/thickbox/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T20:56:53.850

有很多 jQuery 插件可以为你做到这一点。我喜欢的一个是[Cycle](http://jquery.malsup.com/cycle/)插件。如果您不需要那么多效果，还有[Cycle Lite 。](http://jquery.malsup.com/cycle/lite/)如需更多信息，您可以在[jQuery 插件数据库](http://plugins.jquery.com/)中搜索幻灯片或轮播——也许还有其他关键字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:47:06.787

我真的很喜欢[花式](http://fancy.klade.lv/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T00:09:21.437

我在我的网站上使用 LightBox，但没有发现更容易使用的东西。最重要的是它是免费的。这是我网站上的实现示例。

[意大利的照片](http://www.rsolberg.com/Album.aspx?id=4)

[您可以在此处](http://www.huddletogether.com/projects/lightbox2/#download)下载灯箱代码...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T21:19:11.720

[Lightbox 2](http://www.huddletogether.com/projects/lightbox2/)可能值得一看。从缩略图链接加载图像的好方法。实现起来也非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T21:37:03.767

除了已经提到的之外，我还使用了 slideshowpro 并且非常喜欢它。一个非常便宜的下载（比如 20 美元或类似的东西），它可以免费试用，并且被广泛使用。但是它是一个 flash 插件，所以你需要接受它（你不需要知道 flash 才能使用它）

它使用 xml 文件来定义画廊/图片，并具有许多易于配置的选项。还有一个 Picasa 插件，它会自动从文件列表中为您生成 XML。

[http://slideshowpro.net/](http://slideshowpro.net/)

# sql - 为什么我在 SQL 中收到多部分标识符错误？

> ID：558666
> 
> 赞同：0
> 
> 时间：2009-02-17T20:52:38.197
> 
> 标签：sql, sql-server

我们想要搜索一些表。
我不明白为什么会发生这个错误，请帮忙。
我应该对专家来说很容易，

```
SELECT * FROM passenger
INNER JOIN [passenger-flylist] ppff 
ON ppp.[passenger-id] = ppff.[passenger-id] 
```

**错误 ：**

> 消息 4104，级别 16，状态 1，行 1
> 无法绑定多部分标识符“ppp.passenger-id”。

表格是：

```
CREATE TABLE [dbo].[passenger](
    [passenger-id] [int] IDENTITY(1,1) NOT NULL,
    [name] [char](50) COLLATE Arabic_CI_AS NOT NULL,
    [sex] [char](10) COLLATE Arabic_CI_AS NULL,
    [mobile] [char](20) COLLATE Arabic_CI_AS NULL,
    [address] [varchar](50) COLLATE Arabic_CI_AS NULL,
    [flylist-id] [int] NOT NULL,
    [chair-number] [char](10) COLLATE Arabic_CI_AS NOT NULL,
    [Age] [char](10) COLLATE Arabic_CI_AS NULL,
    [ticket-number] [char](10) COLLATE Arabic_CI_AS NULL,
 CONSTRAINT [PK_passenger] PRIMARY KEY CLUSTERED 
(
    [passenger-id] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

GO 
```

**第二**

```
CREATE TABLE [dbo].[flylist](
    [flylist-id] [int] IDENTITY(1,1) NOT NULL,
    [fly-number] [varchar](50) COLLATE Arabic_CI_AS NOT NULL,
    [go-date] [char](15) COLLATE Arabic_CI_AS NOT NULL,
    [return-date] [char](15) COLLATE Arabic_CI_AS NOT NULL,
    [go-time] [char](5) COLLATE Arabic_CI_AS NOT NULL,
    [return-time] [char](5) COLLATE Arabic_CI_AS NOT NULL,
    [start-from] [varchar](50) COLLATE Arabic_CI_AS NOT NULL,
    [destination] [varchar](50) COLLATE Arabic_CI_AS NULL,
    [airline-company-id] [int] NOT NULL,
    [airplane-id] [int] NOT NULL,
 CONSTRAINT [PK_flylist] PRIMARY KEY CLUSTERED 
(
    [flylist-id] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

GO 
```

**第三**

```
CREATE TABLE [dbo].[passenger-flylist](
    [passenger-id] [int] NOT NULL,
    [flylist-id] [int] NOT NULL,
 CONSTRAINT [PK_passenger-flylist] PRIMARY KEY CLUSTERED 
(
    [passenger-id] ASC,
    [flylist-id] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

GO
USE [AirlineSx]
GO
ALTER TABLE [dbo].[passenger-flylist]  WITH CHECK ADD  CONSTRAINT [FK_passenger-flylist_passenger-flylist] FOREIGN KEY([passenger-id], [flylist-id])
REFERENCES [dbo].[passenger-flylist] ([passenger-id], [flylist-id]) 
```

如果我在设置关系时遇到问题，请告诉我该怎么做，

## 谢谢

## **编辑部分**

谢谢，我发现与您并行，但我遇到了另一个错误：（在我的真实代码中，我想获取Passenger-id，但它不允许我）

```
SELECT [passenger-id] FROM passenger ppp -- <<<< This line
INNER JOIN [passenger-flylist] ppff 
ON ppp.[passenger-id] = ppff.[passenger-id]
INNER JOIN flylist fff ON ppff.[flylist-id] = fff.[flylist-id]
WHERE ppp.[name] = @name AND
fff.[start-from] = @flightDate AND
ppp.[ticket-number] = @ticketNo 
```

错误是：

> 消息 209，级别 16，状态 1，过程 SearchForPassenger，第 19 行
> 不明确的列名称“乘客 ID”。

它指的是我们要选择的第一行 [passenger-id]

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-17T20:55:56.830

问题是缺少别名 ppp

```
SELECT * FROM passenger ppp
INNER JOIN [passenger-flylist] ppff 
ON ppp.[passenger-id] = ppff.[passenger-id] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T01:22:19.780

至于第二个问题……

由于passenger-id 存在于passenger 和passenger-flylist 中，您需要指定表的别名。

```
SELECT ppp.[passenger-id] FROM passenger ppp
INNER JOIN [passenger-flylist] ppff 
ON ppp.[passenger-id] = ppff.[passenger-id]
INNER JOIN flylist fff ON ppff.[flylist-id] = fff.[flylist-id]
WHERE ppp.[name] = @name AND
fff.[start-from] = @flightDate AND
ppp.[ticket-number] = @ticketNo 
```

# sql-server - 如何获取唯一约束中的字段列表

> ID：558667
> 
> 赞同：0
> 
> 时间：2009-02-17T20:53:05.963
> 
> 标签：sql-server, sql-server-2005

我有一个对一个或多个字段具有唯一约束的表。给定约束名称，我想查询系统视图以获取属于该约束的字段列表。

SQL 服务器 2005。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T20:58:17.980

查看 information_schema.constraint_column_usage

```
select column_name from information_schema.constraint_column_usage
where constraint_name = 'your constraint' 
```

# sql - SQL 查询在一系列 ID 中返回每个 ID 的前 N 行

> ID：558670
> 
> 赞同：2
> 
> 时间：2009-02-17T20:53:51.780
> 
> 标签：sql, sql-server, database, optimization

假设我有一个包含几亿行的表，看起来像这样：

```
memID | foo  | bar  | foobar
1     | blah | blah | blah
1     | blah | blah | blah
1     | blah | blah | blah
1     | blah | blah | blah
1     | blah | blah | blah
1     | blah | blah | blah
1     | blah | blah | blah
2     | blah | blah | blah
2     | blah | blah | blah
2     | blah | blah | blah
2     | blah | blah | blah
2     | blah | blah | blah
.
.
.
10001 | blah | blah | blah
10001 | blah | blah | blah 
```

我需要一个查询，它将返回一系列成员 ID 中每个 memID 的前 N ​​行。例如，如果 N = 3 并且范围是 0-2 它应该返回

```
memID | foo  | bar  | foobar
1     | blah | blah | blah
1     | blah | blah | blah
1     | blah | blah | blah
2     | blah | blah | blah
2     | blah | blah | blah
2     | blah | blah | blah 
```

我考虑了几种方法，首先创建一个巨大的

```
SELECT TOP (3) *
FROM table
WHERE memID = 0
UNION ALL
SELECT TOP (3) *
FROM table
WHERE memID = 1
.
.
. 
```

在代码中查询。由于可能显而易见的原因，这并不是一个真正现实的选择。

第二种方法是创建一个临时表并循环遍历 memID 的范围，将每个 memID 的 TOP 3 插入到该临时表中。

```
WHILE @MemID < 10000 AND @MemID > 0
  BEGIN
    INSERT INTO tmp_Table
    SELECT TOP (3) *
     FROM table
     WHERE memID = @MemID

    SET @MemID = @MemID + 1
    END 
```

这行得通，但我想知道是否有一个更优雅的单一查询解决方案我错过了。

Cadaeic 给了我一个无需修修补补​​的答案，但感谢所有建议分析的人，看来我需要认真阅读。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T21:22:52.413

```
declare @startID int, @endID int, @rowsEach int
select @startID = 0, @endID = 2, @rowsEach = 3

select *
from
(
    select memID, foo, bar, foobar, row_number() over (partition by dense_rank order by dense_rank) [rank_row]
    from
    (
        select memID, foo, bar, foobar, dense_rank() over (order by memID) [dense_rank]
        from #test
        where memID between @startID and @endID
    ) a
) b
where rank_row <= @rowsEach 
```

结果：

```
memID       foo  bar  foobar rank_row
----------- ---- ---- ------ --------------------
1           blah blah blah   1
1           blah blah blah   2
1           blah blah blah   3
2           blah blah blah   1
2           blah blah blah   2
2           blah blah blah   3 
```

如果您想在本地测试，这里是设置代码：

```
create table #test
(
      memID     int not null
    , foo       char(4) not null
    , bar       char(4) not null
    , foobar    char(4) not null
)

insert into #test (memID, foo, bar, foobar)
select 1, 'blah', 'blah', 'blah'
union all
select 1, 'blah', 'blah', 'blah'
union all
select 1, 'blah', 'blah', 'blah'
union all
select 1, 'blah', 'blah', 'blah'
union all
select 1, 'blah', 'blah', 'blah'
union all
select 1, 'blah', 'blah', 'blah'
union all
select 1, 'blah', 'blah', 'blah'
union all
select 2, 'blah', 'blah', 'blah'
union all
select 2, 'blah', 'blah', 'blah'
union all
select 2, 'blah', 'blah', 'blah'
union all
select 2, 'blah', 'blah', 'blah'
union all
select 10001, 'blah', 'blah', 'blah'
union all
select 10001, 'blah', 'blah', 'blah'
union all
select 10001, 'blah', 'blah', 'blah' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T21:21:39.327

```
SQL> select ename,sal,
  2   row_number()
  3     over (order by sal desc)rn,
  4   rank()
  5     over (order by sal desc)rnk,
  6   dense_rank()
  7     over (order by sal desc)drnk
  8   from emp
  9  order by sal desc
 10  /

ENAME    SAL   RN   RNK   DRNK
-----   ----   --   ---   ----
 KING   5000    1     1      1
 FORD   3000    2     2      2
SCOTT   3000    3     2      2
JONES   2975    4     4      3
BLAKE   2850    5     5      4
CLARK   2450    6     6      5 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:03:41.070

如果您使用的是 SQL Server 2005 或 2008，您可能需要调查[排名函数](http://msdn.microsoft.com/en-us/library/ms189798(SQL.90).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T21:13:48.660

使用分析。我没有对此进行测试，但应该很接近：

```
SELECT memID, foo, bar, foobar 
FROM  (
       SELECT memID, foo, bar, foobar, 
              RANK() OVER (PARTITION BY memID ORDER BY memID) AS 'nRank'
       FROM   table
       WHERE  memID BETWEEN 0 AND 2)
WHERE  nRank <= 3 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T21:18:52.890

```
SELECT * FROM Member m
Join ( Select TOP(3) * From Table Order By Table.Id) as t 
    On t.MemberId = m.MemberId
Where m BETWEEN 0 and 10000 
```

应该做的伎俩

# mysql - 如何预测 MySQL 的临界点？

> ID：558680
> 
> 赞同：7
> 
> 时间：2009-02-17T20:55:36.613
> 
> 标签：mysql, database, innodb

我在一个使用 MySQL 5.0 数据库和 InnoDB 表的大型 Web 应用程序上工作。在过去的几个月里，我们两次经历了以下情况：

1.  数据库服务器运行良好数周，负载低且查询速度慢。
2.  以前快速运行的频繁执行的查询将突然开始运行非常缓慢。
3.  数据库负载峰值和站点挂起。

这两种情况的解决方案都是在慢查询日志中找到慢查询，并在表上创建一个新的索引来加速它。应用索引后，数据库性能恢复正常。

最令人沮丧的是，在这两种情况下，我们都没有对即将到来的厄运发出警告。我们所有的监控系统（例如，系统负载、CPU 使用率、查询执行率、慢查询）都告诉我们数据库服务器运行良好。

问题 1：**我们如何预测或完全避免这些临界点？**

我们没有定期做的一件事是运行 OPTIMIZE TABLE 或 ANALYZE TABLE。我们很难找到关于手动执行这些操作的频率（如果有的话）的良好经验法则。（由于这些命令 LOCK 表，我们不想不加选择地运行它们。）这些场景听起来像是未优化表的结果吗？

问题 #2：**我们应该手动运行 OPTIMIZE 还是 ANALYZE？如果有，多久一次？**

有关该应用程序的更多详细信息：数据库使用模式约为 95% 读取，5% 写入；数据库每秒执行大约 300 个查询；在这两种情况下，慢查询中使用的表是相同的，并且有数十万条记录。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T21:09:57.780

MySQL 性能博客是一个很棒的资源。也就是说，[这篇](http://www.mysqlperformanceblog.com/2007/11/01/innodb-performance-optimization-basics/)文章涵盖了正确调整 InnoDB 特定参数的基础知识。

我还发现[MySQL 参考手册](http://dev.mysql.com/doc/#refman)的 PDF 版本是必不可少的。[第 7 章介绍了一般优化](http://dev.mysql.com/doc/refman/5.1/en/optimization.html)，[第 7.5 节](http://dev.mysql.com/doc/refman/5.1/en/optimizing-the-server.html)介绍了您可以玩弄的特定于服务器的优化。

从您的服务器的声音来看，[查询缓存](http://dev.mysql.com/doc/refman/5.1/en/query-cache.html)对您来说可能具有巨大的价值。

参考手册还为您提供了一些关于慢查询、缓存、查询优化甚至使用索引进行磁盘查找分析的详细信息。

可能值得您花时间研究多主复制，允许您完全锁定一台服务器并运行 OPTIMIZE/ANALYZE，而不会影响性能（因为 95% 的查询是读取，另一台服务器可以只管理写入美好的）。

第 12.5.2.5 节详细介绍了 OPTIMIZE TABLE，第 12.5.2.1 节详细介绍了 ANALYZE TABLE。

更新您的编辑/重点：

**问题#2**很容易回答。从参考手册：

优化：

> 如果您删除了表的大部分内容，或者您​​对具有可变长度行的表进行了许多更改，则应使用 OPTIMIZE TABLE。[...] 您可以使用 OPTIMIZE TABLE 回收未使用的空间并对数据表进行碎片整理。

并分析：

> ANALYZE TABLE 分析并存储表的键分布。[...] MySQL 使用存储的键分布来决定当您对常量以外的其他内容执行连接时应该连接表的顺序。此外，在决定将哪些索引用于查询中的特定表时，可以使用键分布。

OPTIMIZE 很适合在您有空闲时间时运行。MySQL 对已删除的行进行了很好的优化，但是如果您从表中删除 20GB 的数据，那么运行它*可能*是个好主意。在大多数情况下，绝对不需要良好的性能。

ANALYZE 更为关键。如前所述，当涉及到几乎*任何查询*时，让 MySQL 所需的表数据（由 ANALYZE 提供）非常重要。它应该在共同的基础上运行。

**问题 #1**更像是一个技巧。发生这种情况时，我会非常仔细地观察服务器，即磁盘 I/O。我敢打赌，您的服务器正在破坏您的交换或（InnoDB）缓存。在任何一种情况下，它都可能与查询、调整或负载相关。未优化的表可能会导致此问题。如前所述，运行 ANALYZE 可以极大地提高性能，并且可能也会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T01:51:38.180

我还没有找到任何预测 MySQL“临界点”的好方法——而且我遇到了一些。

话虽如此，我发现引爆点与桌子大小有关。但不仅仅是原始表大小，而是查询的“感兴趣区域”有多大。例如，在一个超过 300 万行和大约 40 列（大约四分之三的整数）的表中，大多数可以根据索引轻松选择其中一部分的查询速度很快。但是，当一个索引列的查询中的一个值意味着三分之二的行现在“有趣”时，查询现在比正常情况慢约 5 倍。教训：尝试整理您的数据，这样就不需要进行此类扫描。

但是，这种行为现在为您提供了一个可供查找的大小。这个大小将在很大程度上取决于您的服务器设置、MySQL 服务器变量以及表的模式和数据。

同样，如果周期为两周，我看到报告查询在合理的时间（约 45 秒）内运行，但如果周期延长至四周，则需要半小时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:01:30.733

使用[慢查询日志](http://dev.mysql.com/doc/refman/5.1/en/slow-query-log.html)，这将帮助您缩小要优化的查询范围。

对于时间紧迫的查询，有时最好通过使用提示来保持稳定的计划。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T00:00:19.273

听起来您遇到了令人沮丧的情况，并且可能不是最好的代码审查流程和开发环境。

每当您向代码中添加新查询时，您都需要检查它是否已准备好适当的索引并将其添加到代码版本中。

如果您不这样做，您的第二个选择是不断监控慢查询日志，然后击败开发人员；我的意思是去添加索引。

有一个选项可以启用对不使用索引的查询的日志记录，这对您很有用。

如果有一些查询“工作并停止工作”（但正在“使用和索引”），那么查询可能一开始就不是很好（索引中的基数低；连接效率低；...）并且在添加查询时仔细评估查询的第一条规则将适用。

对于问题 #2 - 在 InnoDB 上，“分析表”基本上可以免费运行，所以如果你的连接性能不好，运行它并没有什么坏处。除非表中键的平衡发生很大变化，否则它不太可能有帮助。它几乎总是归结为错误的查询。“优化表”重建 InnoDB 表；以我的经验，它的帮助足以值得让表在持续时间内不可用（或在它运行时进行主-主故障转移）的麻烦，这是相对罕见的。

# javascript - Uservoice 和 stackoverflow 共享用于 Flash 消息的通用 JavaScript 库？

> ID：558683
> 
> 赞同：1
> 
> 时间：2009-02-17T20:56:02.807
> 
> 标签：javascript, html

我在使用 UserVoice 并注意到 Flash 消息就像 StackOverflow。

是否有任何通用库来构建这样的东西？

```
 <div class="uservoice-component">
      <div id="flashes" class="has-layout">
    <script type="text/javascript">
//<![CDATA[
setTimeout("$$('.message').each(function(element){ new Effect.Appear(element); });", 0);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
setTimeout("$$('.temporary-message').each(function(element){ new Effect.Fade(element); });", 7000);
//]]>
</script>
    <noscript>
      <p class="error">Please enable Javascript <small>(it's required)</small></p>
    </noscript>
  </div> 
```

谢谢！巴勃罗

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T21:36:35.173

不完全确定您要的是什么。您提供的示例代码在我看来类似于[jQuery](http://jquery.com/)，这是一个相对标准的库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T21:38:59.520

它只是使用 JQuery 导致弹出警报，如果你问我，这是非常标准的 JQuery。只需使用您想要的消息制作一个 div，然后调用类似`$('#someid').show();`

亚历克斯

# php - 什么时候适合使用 AJAX？

> ID：558684
> 
> 赞同：4
> 
> 时间：2009-02-17T20:56:22.320
> 
> 标签：php, ajax, webforms

什么时候适合使用 AJAX？
使用 AJAX 的优缺点是什么？

回答我的最后一个问题：有些人似乎非常坚持我应该只在适当的情况下使用 AJAX： [我应该将 AJAX 逻辑添加到我的 PHP 类/脚本中吗？](https://stackoverflow.com/questions/549280/should-i-add-ajax-logic-to-my-php-classes-scripts)

回应 Chad Birch 的回答：是的，我指的是在开发一个“标准”站点时，该站点将使用 AJAX 来获得好处，并且不会被其应用程序削弱。以会破坏搜索排名的方式使用 AJAX 是不可接受的。因此，如果“保持网站完整”需要更多的工作，那将是一个“骗局”。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T21:07:56.537

这是一个相当大的主题，但您应该使用 AJAX 来增强用户体验，而不是让网站完全依赖它。请记住，搜索引擎和其他一些访问者将无法执行 AJAX，因此如果您依赖它来加载您的内容，那将不会对您有利。

例如，您可能认为让用户访问您的博客会很好，然后让页面在他们已经存在时使用 AJAX 动态加载最新文章。但是，当 Google 尝试为您的博客编制索引时，它只会获取空白站点。

查找与该主题相关的资源的一个很好的搜索词是“渐进式增强”。那里有很多好东西，花一些时间关注周围的链接。这是一个开始：

[http://www.alistapart.com/articles/progressiveenhancementwithjavascript/](http://www.alistapart.com/articles/progressiveenhancementwithjavascript/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T21:05:33.547

当您只更新页面的一部分或执行一个根本不更新页面的操作时，AJAX 可能是一个非常好的工具。对于这样的事情，它比整个页面刷新要轻巧得多。相反，如果您的整个页面重新加载或您更改为不同的视图，您真的应该只是链接（或发布）到新页面，而不是通过 AJAX 下载并替换整个内容。

使用 AJAX 的一个缺点是它需要 javascript 才能工作，或者您需要以这样一种方式构建视图，即 UI 在没有它的情况下仍然可以工作。这比仅通过普通链接/帖子更复杂。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T21:07:51.950

AJAX 通常用于在页面已经加载（不加载另一个页面）时执行 HTTP 请求。

最常见的用途是更新部分[视图](http://en.wikipedia.org/wiki/Model-view-controller)。请注意，这不包括刷新整个视图，因为您可以导航到新页面。

另一个常见的用途是提交表单。在所有情况下，尤其是对于表单，重要的是要有好的方法来处理没有 javascript 或禁用 javascript 的浏览器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T21:11:07.980

我认为使用*ajax*技术的优势不仅在于创造更好的用户体验，而且使服务器只调用特定数据的能力是一个巨大的性能优势。

想象一下有一个巨大的带宽消耗者网站（如 stackoverflow），用户完成的大部分导航都是通过页面重新加载和通过 HTTP 连续发送的数据来完成的。

当然，缓存和其他技术有助于解决带宽开销问题，但我个人认为每次发送大量 HTML 确实是一种浪费。

缺点是 SEO（不适用于高度基于 ajax 的网站）和禁用 JavaScript 的人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T21:44:57.243

当您的应用程序（或您的用户）需要比传统网页能够提供的更丰富的用户体验时。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T22:16:38.417

Ajax 为您提供了两件大事：

响应性 - 如果需要，您一次只能更新网页的一部分（节省重新加载页面的时间）。例如，它还可以更轻松地对表格中显示的数据进行分页。

用户体验——这伴随着响应能力。使用 AJAX，您可以添加动画、更酷的弹出窗口和特殊效果，为您的网页提供更新、更清洁和更酷的外观和感觉。如果没有人认为这很重要，那么看看 iPhone。用户体验将人们吸引到应用程序中并让他们想要使用它，这是确保应用程序成功的关键步骤之一。

要获得一个好的案例研究，请查看此站点。AJAX 效果，例如在发布时为您的新答案添加动画效果、弹出窗口告诉您无法执行某些操作以及自您开始自己的答案以来已发布新答案的提示，这些都是吸引人们进入该网站并使其成功的一部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T21:05:11.833

当您想要重新加载页面的一部分而不将所有信息重新发布到服务器时，主要使用 Ajax。

缺点：

*   比做一个普通的帖子更复杂（使用不同的浏览器，编写服务器端代码来处理部分回发）
*   引入潜在的安全漏洞（您正在引入与服务器交互的附加代码。这可能是客户端和服务器上的问题。
    在客户端上，您需要发送和接收响应的方式。这是与浏览器交互的另一种方式意味着还有另一个入口点必须被保护。执行任意代码，将数据发布到非预期来源等。随着时间的推移，Ajax 应用程序有几个漏洞，但总会有更多。）

优点：

*   对于最终用户来说，它看起来更华丽
*   允许在页面上显示大量信息，而无需同时加载所有信息
*   页面更具交互性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T21:08:08.020

Javascript 应该始终只是您网站功能的补充。您应该能够在不涉及任何 Javascript 的情况下使用和浏览该网站。您可以使用 Javascript 作为现有功能的补充，例如避免整页重新加载。这是可访问性的一个重要因素。Javascript 永远不应被用作访问或完成您网站上的请求的唯一可能性。

由于 AJAX 使用 Javascript，因此这里同样适用。

# apache-flex - 在分配文本之前如何设置动态 UITextField 的正确宽度？

> ID：558685
> 
> 赞同：3
> 
> 时间：2009-02-17T20:56:24.007
> 
> 标签：apache-flex, actionscript-3, actionscript, flex3

在 Flex 3.2 中，我正在创建一个 UITextField，然后测量我将要分配给该字段的文本属性的文本。然后我使用这些指标来设置字段的大小。但是，计算出的宽度不足以容纳文本。是否有不同的顺序来实现正确的测量，或者我看到 measureText() 函数有问题？我怎样才能得到准确的结果？

```
// UITextField's default size appears to be 100x100
// Measure the text then set width and height
var tf:UITextFormat = uiTextField.getUITextFormat();
var tlm:TextLineMetrics = tf.measureText(this.labelText);

// Text within the field is clipped unless 'padding' is added to the size
// Flex Documentation specifies there is a 2 px gutter on each side, so
// the expected padding would be 4 px.  However, clipping occurs, for 
// "Hello, World" up to 9 px.
uiTextField.width = tlm.width + 9; 
uiTextField.height = tlm.height + 4;
uiTextField.border = true;
uiTextField.name = "uiTextField";               
uiTextField.text = this.labelText; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T21:37:55.357

我之前在测量 textFields 的宽度和高度时遇到了各种各样的麻烦。看起来您只想自动调整文本字段的大小。你有没有尝试过：

```
uiTextField.autoSize = TextFieldAutoSize.LEFT; 
```

？？？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:33:20.857

不幸的是，当 Flex 尝试动态获取 textWidth 时，它经常会感到非常困惑。更糟糕的是，很难可靠地捕获错误并让 Flex 正确更新自身。我发现的最佳选择：

1.  手动破解它——大多数情况下是可靠的，并且有在一切完成渲染之前发生的好处： [mx.controls.Text hack AS3](http://rosettastone.allen-poole.com/?subject=Raw_Code&center=mx.controls.Text%20hack%20AS3)描述了一种方法来做到这一点。
2.  使用 callLater 或 FlexEvent.CREATION_COMPLETE 事件监听器——这不太可靠，但绝对不是黑客
3.  使用延迟小于每秒 1/10 的 setTimeout（我喜欢 25-50 毫秒）——我发现这是最可靠的，但它可能会导致屏幕上出现一个小“光点”（通常短期内不会很明显代码）。

# delphi - 在我的 Delphi 应用程序中使用 Googlemap？

> ID：558686
> 
> 赞同：15
> 
> 时间：2009-02-17T20:56:44.927
> 
> 标签：delphi, internet-explorer, google-maps

我是维护一个相当大的内部 Delphi 应用程序的团队中的一员。现在我们已经开始研究地图支持了。而且我们认为与某些地图组件相比，Googlemap 似乎是最物有所值的。当前的解决方案（这真的很糟糕）通过从 ShellExecute 启动 Internet Explorer 来工作，在 Googlemap URL 中加载一些坐标。然后谷歌地图显示通过坐标的最佳方向。

它可以工作，但是如果坐标的数量高于 10，它可能会很慢。此外，IE 中似乎有很大的内存泄漏......

另一种选择是改用 TWebBrowser 组件并加载 Googlemap html 文件以显示相同的内容。是的，我知道 Googlemaps 许可政策，我们准备在实际使用该解决方案时向 Google 支付费用。

现在我已经为我自己的网站注册了一个 API 密钥，只是为了测试。我还发现它可以加载本地 html 文件。根据 Googlemap 文档，我可以从 Javascript 调用 GUnload 来消除内存泄漏。由于 API 密钥绑定到域或本地文件，我想我必须保存一个带有坐标的 javascriptfile，然后在每次调用地图时将其加载到 TWebBrowser 中。我发现这很笨拙，但我没有其他办法......？

还有其他使用 Googlemaps 的选项吗？由于性能和内存管理不佳，我不知道除了 TWebBrowser 之外的 Delphi 的其他 html 组件。我想使用 Mozilla 组件，但它似乎只适用于 C++。

对此有何评论和建议？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-18T03:29:18.243

我前段时间封装了 Google Maps API。它是一个包含 TWebBrowser 的组件，它加载一个本地 html 文件，该文件包含一些 javascript 帮助函数并设置一个基本的 Google 地图页面。HTML 文件作为资源嵌入到 exe 中，以便于部署。

它可以使用一些工作，但它已经为我做了一些很好的工作。它扩展了这里提出的想法：http: [//www.stevetrefethen.com/blog/UsingGoogleMapsFromVCLSampleApplication.aspx](http://www.xs4all.nl/~niff/GoogleMaps.zip)

我在这里放了一个演示可执行文件和源代码： [http ://www.xs4all.nl/~niff/GoogleMaps.zip](http://www.xs4all.nl/~niff/GoogleMaps.zip)

在此屏幕截图中，我已切换到 Google 地球视图：

![](https://www.xs4all.nl/~niff/GoogleMapsDemo.png)

以下是一些如何使用它的示例：

*   将地图居中放置在荷兰的某个狗屎洞，坐标非常圆润：

    > ```
    > GoogleMaps1.SetCenter(52,5,True); 
    > ```

*   加载 KML 或 KMZ 文件：

    > ```
    > GeoXML := TGGeoXML.Create('http://mywebsite.com/mykml.kmz');
    > GeoXML.GoogleMaps := GoogleMaps1;
    > GoogleMaps1.AddOverlay( GeoXML ); 
    > ```

*   切换到 Google 地球的嵌入式版本，以获得快速流畅的 3d 动作：

    > ```
    > GoogleMaps1.MapType := MT_SATELLITE_3D; 
    > ```

*   保留覆盖列表，并通过 Delphi 结构对其进行管理：

    > ```
    > GoogleMaps1.Overlays[2].hide; // hide overlay 2
    > GoogleMaps1.RemoveOverlayByIndex(3); // delete overlay 3 
    > ```

*   它允许您使用快速 Delphi 数组创建多边形，然后在 GMaps 中绘制它；

> ```
> MyPolygon := TGPolygon.Create(MyPointArray);
> MyPolygon.Color := clBlue; 
> MyPolygon.Name := 'Awesome Polygon 1';
> GoogleMaps1.AddPolygon( MyPolygon ); 
> ```

它不打算包装完整的 API；这只是为了在处理谷歌地图时让生活更轻松。DouglasPeuckers 单位并不是真正需要的。它用于在资源耗尽时简化多边形。

祝你好运，如果你用它创造了一些有用的东西，请告诉我。

```
{—————————————————————————————————————————————————————————————————————————}
{ Project : uGoogleMaps.pas                                               }
{ Comment : Google Maps API wrapper                                       }
{                                                                         }
{    Date : 14 mrt 2008                                                   }
{  Author : Wouter van Nifterick                                          }
{—————————————————————————————————————————————————————————————————————————}
{ The aim of this unit is to wrap the Google Maps API in such a way that  }
{ users don't need to know that map operations end up being rendered by   }
{ a browser component and JavaScript.                                     }
{                                                                         }
{ JavaScript classes have a Delphi counterpart, and each Delphi class     }
{ takes care of proper JavaScript rendering and execution.                }
{                                                                         }
{ For many things, like constructing detailed polygons, this provides a   }
{ major performance boost and adds compile-time type checking.            }
{                                                                         }
{ A big limitation so far is that I didn't find a way to directly pass    }
{ complex types from and to the JavaScript engine in IE via COM, so for   }
{ now, everything needs to be (de)serialized to and from strings. :(      }
{—————————————————————————————————————————————————————————————————————————}
{ Last modified                                                           }
{    Date :                                                               }
{  Author :                                                               }
{—————————————————————————————————————————————————————————————————————————}

{$M+}

unit uGoogleMaps;

interface

uses
  Controls,
  Dialogs,
  ActiveX,
  StdCtrls,
  ExtCtrls,
  SysUtils,
  Classes,
  Contnrs,
  Forms,
  SHDocVw,
  MSHTML,
  StrUtils,
  DouglasPeuckers
//  ,  uGoogleEarth_intf
  ;

const
  GoogleMapsFileName = 'GoogleMaps.html';
  WGS84_MULT_FACT    = 100000; // multiply lat/lon values by this value in order to fit them into integers
  DEFAULT_SIMPLIFY_TOLERANCE = 0.5;

{$R GoogleMaps_html.res}

type

  TGoogleMapControl = (MC_NONE=1,MC_SMALL,MC_LARGE);
  TGoogleMapType    = (MT_NORMAL=1,MT_SATELLITE,MT_HYBRID,MT_PHYSICAL,MT_SATELLITE_3D);

  TGoogleMaps       = class; // forward declaration

  GIcon             = class end; // to be implemented

  IJsClassWrapper=interface(IInterface)
    function JsClassName:String;

    function GetJsVarName:String;
    procedure SetJsVarName(const aVarName:String);
    property JsVarName:String read GetJsVarName write SetJsVarName;

    function ToJavaScript:String;
  end;

  IHidable=interface(IInterface)
    procedure hide;                         // Hides the object if the overlay is both currently visible and the overlay's supportsHide() method returns true. Note that this method will trigger the respective visibilitychanged event for each child overlay that fires that event (e.g. GMarker.visibilitychanged, GGroundOverlay.visibilitychanged, etc.). If no overlays are currently visible that return supportsHide() as true, this method has no effect. (Since 2.87)
    function  isHidden           : Boolean; // Returns true if the GGeoXml object is currently hidden, as changed by the GGeoXml.hide() method. Otherwise returns false. (Since 2.87)
    procedure show;                         // Shows the child overlays created by the GGeoXml object, if they are currently hidden. Note that this method will trigger the respective visibilitychanged event for each child overlay that fires that event (e.g. GMarker.visibilitychanged, GGroundOverlay.visibilitychanged). (Since 2.87)
    function  supportsHide       : Boolean; // 
  end;

  // marker class
  GMarkerOptions=record
    icon          : GIcon;    // Chooses the Icon for this class. If not specified, G_DEFAULT_ICON is used. (Since 2.50)
    dragCrossMove : Boolean;  // When dragging markers normally, the marker floats up and away from the cursor. Setting this value to true keeps the marker underneath the cursor, and moves the cross downwards instead. The default value for this option is false. (Since 2.63)
    title         : String;   // This string will appear as tooltip on the marker, i.e. it will work just as the title attribute on HTML elements. (Since 2.50)
    clickable     : Boolean;  // Toggles whether or not the marker is clickable. Markers that are not clickable or draggable are inert, consume less resources and do not respond to any events. The default value for this option is true, i.e. if the option is not specified, the marker will be clickable. (Since 2.50)
    draggable     : Boolean;  // Toggles whether or not the marker will be draggable by users. Markers set up to be dragged require more resources to set up than markers that are clickable. Any marker that is draggable is also clickable, bouncy and auto-pan enabled by default. The default value for this option is false. (Since 2.61)
    bouncy        : Boolean;  // Toggles whether or not the marker should bounce up and down after it finishes dragging. The default value for this option is false. (Since 2.61)
    bounceGravity : Integer;   // When finishing dragging, this number is used to define the acceleration rate of the marker during the bounce down to earth. The default value for this option is 1\. (Since 2.61)
    autoPan       : Boolean;  // Auto-pan the map as you drag the marker near the edge. If the marker is draggable the default value for this option is true. (Since 2.87)

    // to implement:
    //    zIndexProcess : Function; // This function is used for changing the z-Index order of the markers when they are overlaid on the map and is also called when their infowindow is opened. The default order is that the more southerly markers are placed higher than more northerly markers. This function is passed in the GMarker object and returns a number indicating the new z-index. (Since 2.98)
  end;

  TGPoint=class

  end;

  TGLatLng=class(TInterfacedObject,IJsClassWrapper)
  private
    FLat,
    FLng:Double;
    FJsVarName: String;
    function GetJsVarName: String;
    procedure SetJsVarName(const Value: String);
  published
    constructor Create(aLat,aLng:Double);
    property Lat:Double read FLat write FLat;
    property Lng:Double read FLng write FLng;
    function ToJavaScript:String;
    function Equals(const AGLatLng:TGLatLng):Boolean;
    function ToString:String;
    function JsClassName:String;virtual;
    property JsVarName:String read GetJsVarName write SetJsVarName;
  end;

  TGBounds=class(TInterfacedObject,IJsClassWrapper)
  private
    FJsVarName: String;
    FMinX, FMinY, FMaxX, FMaxY:Double;
    FMin,FMax,FMid:TGLatLng;
    function GetMax: TGLatLng;
    function GetMid: TGLatLng;
    function GetMin: TGLatLng;
    procedure SetJsVarName(const Value: String);
    function GetJsVarName: String;
  published
    destructor Destroy;override;
    property minX : Double read FMinX write FMinX;
    property minY : Double read FMinY write FMinY;
    property maxX : Double read FMaxX write FMaxX;
    property maxY : Double read FMaxY write FMaxY;
    function ToString:String;
    function Equals(aGBounds:TGBounds):Boolean;
    property Min:TGLatLng read GetMin;
    property Mid:TGLatLng read GetMid;
    property Max:TGLatLng read GetMax;
    function JsClassName:String;virtual;
    property JsVarName:String read GetJsVarName write SetJsVarName;
    function ToJavaScript:String;
  end;

  TGLatLngBounds=class
  private
    procedure setNorthEast(const Value: TGLatLng);
    procedure setSouthWest(const Value: TGLatLng);
  published
    constructor Create(sw,ne:TGLatLng);
    destructor Destroy;override;
    function contains(aLatLng:TGLatLng):Boolean; deprecated; // Returns true iff the geographical coordinates of the point lie within this rectangle. (Deprecated since 2.88)
    function containsLatLng(aLatLng:TGLatLng):Boolean; // Returns true iff the geographical coordinates of the point lie within this rectangle. (Since 2.88)
    function intersects(aGLatLngBounds:TGLatLngBounds):Boolean;
    function containsBounds(aGLatLngBounds:TGLatLngBounds):Boolean;
    procedure extend(aLatLng:TGLatLng); // Enlarges this rectangle such that it contains the given point. In longitude direction, it is enlarged in the smaller of the two possible ways. If both are equal, it is enlarged at the eastern boundary.

    function toSpan()       :   TGLatLng; //    Returns a GLatLng whose coordinates represent the size of this rectangle.
    function isFullLat()    :   Boolean ; //    Returns true if this rectangle extends from the south pole to the north pole.
    function isFullLng()    :   Boolean ; //    Returns true if this rectangle extends fully around the earth in the longitude direction.
    function isEmpty()      :   Boolean ; //    Returns true if this rectangle is empty.
    function getCenter()    :   TGLatLng; //    Returns the point at the center of the rectangle. (Since 2.52)

    function getSouthWest() :   TGLatLng; //    Returns the point at the south-west corner of the rectangle.
    function getNorthEast() :   TGLatLng; //    Returns the point at the north-east corner of the rectangle.
    property SouthWest : TGLatLng read getSouthWest write setSouthWest;
    property NorthEast : TGLatLng read getNorthEast write setNorthEast;

    function ToString:String;
    function Equals(aGLatLngBounds:TGLatLngBounds):Boolean;
  end;

  TColor = integer;

  // abstract class.. subclassed by TGMarker and TGPolygon and TGPolyLine..

  TGOverlay=class(TInterfacedObject,IJsClassWrapper,IHidable)
  private
    FID: Integer;
    FGoogleMaps: TGoogleMaps;
    FName: String;
    FJsVarName:String;
    procedure SetID(const Value: Integer);
    procedure SetGoogleMaps(const Value: TGoogleMaps);
    procedure SetName(const Value: String);
    function GetJsVarName: String;
    procedure SetJsVarName(const Value: String);
  public
    procedure hide;virtual;
    function isHidden: Boolean;virtual;
    procedure show;virtual;
    function supportsHide: Boolean;virtual;
  published
    property ID:Integer read FID write SetID;
    function ToJavaScript:String;virtual;abstract;
    property JsVarName:String read GetJsVarName write SetJsVarName;
    property GoogleMaps:TGoogleMaps read FGoogleMaps write SetGoogleMaps;
    property Name:String read FName write SetName;
    function JsClassName:string;virtual;
  end;

  TOverlayList=class(TObjectList)
  private
    AutoIncrementID:Integer;
    function GetItems(Index: Integer): TGOverlay;
    procedure SetItems(Index: Integer; const Value: TGOverlay);
  public
    property Items[Index:Integer]:TGOverlay read GetItems write SetItems; default;
  published
    constructor Create;
    destructor Destroy;override;
    function Add(aGOverlay:TGOverlay):Integer;
    procedure Clear;override;
    function ToString:String;
  end;

  TGInfoWindow=class(TGOverlay,IJsClassWrapper,IHidable)
    procedure Maximize;
    procedure Restore;
  private
    FHTML: String;
    procedure SetHTML(const Value: String);
  public
    property HTML:String read FHTML write SetHTML;
    function JsClassName:String;override;
    constructor Create(const aCenter:TGLatLng);
    destructor Destroy;override;
    function ToJavaScript:String;override;
    function supportsHide: Boolean;override;
  end;

  // used to show a location on a map
  // can be dragged, can show a popup, can have custom colors and icon
  TGMarker=class(TGOverlay,IJsClassWrapper,IHidable)
  private
    FCenter: TGLatLng;
    FDraggingEnabled: Boolean;
    procedure setLatLng(const Value: TGLatLng);
    procedure SetDraggingEnabled(const Value: Boolean);
  public
    function supportsHide: Boolean;override;
  published
    function JsClassName:String;override;
    constructor Create(const aCenter:TGLatLng);
    destructor Destroy;override;
    property Center:TGLatLng read FCenter write setLatLng;
    property DraggingEnabled:Boolean read FDraggingEnabled write SetDraggingEnabled;
    function ToJavaScript:String;override;
   { TODO 3 -oWouter : implement all marker methods and events }

    procedure openInfoWindow(aContent:String); // Opens the map info window over the icon of the marker. The content of the info window is given as a DOM node. Only option GInfoWindowOptions.maxWidth is applicable.
    procedure openInfoWindowHtml(aContent:String); // Opens the map info window over the icon of the marker. The content of the info window is given as a string that contains HTML text. Only option GInfoWindowOptions.maxWidth is applicable.
{    procedure openInfoWindowTabs(tabs, opts?) : none; // Opens the tabbed map info window over the icon of the marker. The content of the info window is given as an array of tabs that contain the tab content as DOM nodes. Only options GInfoWindowOptions.maxWidth and InfoWindowOptions.selectedTab are applicable.
    procedure openInfoWindowTabsHtml(tabs, opts?) : none; // Opens the tabbed map info window over the icon of the marker. The content of the info window is given as an array of tabs that contain the tab content as Strings that contain HTML text. Only options InfoWindowOptions.maxWidth and InfoWindowOptions.selectedTab are applicable.
    procedure bindInfoWindow(content, opts?) : none; // Binds the given DOM node to this marker. The content within this node will be automatically displayed in the info window when the marker is clicked. Pass content as null to unbind. (Since 2.85)
    procedure bindInfoWindowHtml(content, opts?) : none; // Binds the given HTML to this marker. The HTML content will be automatically displayed in the info window when the marker is clicked. Pass content as null to unbind. (Since 2.85)
    procedure bindInfoWindowTabs(tabs, opts?) : none; // Binds the given GInfoWindowTabs (provided as DOM nodes) to this marker. The content within these tabs' nodes will be automatically displayed in the info window when the marker is clicked. Pass tabs as null to unbind. (Since 2.85)
    procedure bindInfoWindowTabsHtml(tabs, opts?) : none; // Binds the given GInfoWindowTabs (provided as strings of HTML) to this marker. The HTML content within these tabs will be automatically displayed in the info window when the marker is clicked. Pass tabs as null to unbind. (Since 2.85)
    procedure closeInfoWindow() : none; // Closes the info window only if it belongs to this marker. (Since 2.85)
    procedure showMapBlowup(opts?) : none; // Opens the map info window over the icon of the marker. The content of the info window is a closeup map around the marker position. Only options InfoWindowOptions.zoomLevel and InfoWindowOptions.mapType are applicable.
    procedure getIcon() : GIcon; // Returns the icon of this marker, as set by the constructor.
    procedure getTitle() : String; // Returns the title of this marker, as set by the constructor via the GMarkerOptions.title property. Returns undefined if no title is passed in. (Since 2.85)
    procedure getPoint() : GLatLng; // Returns the geographical coordinates at which this marker is anchored, as set by the constructor or by setPoint(). (Deprecated since 2.88)
    procedure getLatLng() : GLatLng; // Returns the geographical coordinates at which this marker is anchored, as set by the constructor or by setLatLng(). (Since 2.88)
    procedure setPoint(latlng) : none; // Sets the geographical coordinates of the point at which this marker is anchored. (Deprecated since 2.88)
    procedure setLatLng(latlng) : none; // Sets the geographical coordinates of the point at which this marker is anchored. (Since 2.88)
    procedure enableDragging() : none; // Enables the marker to be dragged and dropped around the map. To function, the marker must have been initialized with GMarkerOptions.draggable = true.
    procedure disableDragging() : none; // Disables the marker from being dragged and dropped around the map.
    procedure draggable() : Boolean; // Returns true if the marker has been initialized via the constructor using GMarkerOptions.draggable = true. Otherwise, returns false.
    procedure draggingEnabled() : Boolean; // Returns true if the marker is currently enabled for the user to drag on the map.
    procedure setImage(url) : none; // Requests the image specified by the url to be set as the foreground image for this marker. Note that neither the print image nor the shadow image are adjusted. Therefore this method is primarily intended to implement highlighting or dimming effects, rather than drastic changes in marker's appearances. (Since 2.75)
}

  end;

  TGGeoXml=class(TGOverlay,IJsClassWrapper,IHidable)
  private
    FUrlOfXml: String;
    procedure SetUrlOfXml(const Value: String);
  published

//    function  getTileLayerOverlay: GTileLayerOverlay; // GGeoXml objects may create a tile overlay for optimization purposes in certain cases. This method returns this tile layer overlay (if available). Note that the tile overlay may be null if not needed, or if the GGeoXml file has not yet finished loading. (Since 2.84)
//    function  getDefaultCenter   : GLatLng;           // Returns the center of the default viewport as a lat/lng. This function should only be called after the file has been loaded. (Since 2.84)
//    function  getDefaultSpan     : GLatLng;           // Returns the span of the default viewport as a lat/lng. This function should only be called after the file has been loaded. (Since 2.84)
//    function  getDefaultBounds   : GLatLngBounds;     // Returns the bounding box of the default viewport. This function should only be called after the file has been loaded. (Since 2.84)
    procedure gotoDefaultViewport(Map:TGoogleMaps);     // Sets the map's viewport to the default viewport of the XML file. (Since 2.84)
//    function  hasLoaded          : Boolean; // Checks to see if the XML file has finished loading, in which case it returns true. If the XML file has not finished loading, this method returns false. (Since 2.84)
//    function  loadedCorrectly    : Boolean; // Checks to see if the XML file has loaded correctly, in which case it returns true. If the XML file has not loaded correctly, this method returns false. If the XML file has not finished loading, this method's return value is undefined. (Since 2.84)
    function  supportsHide       : Boolean; override; // Always returns true. (Since 2.87)

    function JsClassName:String;override;
    constructor Create(const aUrlOfXml:String);
    destructor Destroy;override;
    property UrlOfXml:String read FUrlOfXml write SetUrlOfXml;
    function ToJavaScript:String;override;
  end;

  // polygon class
  TGPolygon=class(TGOverlay,IJsClassWrapper,IHidable)
  private
    FCoordinates:Array of TGLatLng;
    FOpacity: double;
    FWeightPx: integer;
    FColor: TColor;
    FSimplified: TGPolygon;
    FIsDirty: Boolean;
    procedure SetColor(const Value: TColor);
    procedure SetOpacity(const Value: double);
    procedure SetWeightPx(const Value: integer);
    function GetCount: Integer;
    procedure SetSimplified(const Value: TGPolygon);
    function GetSimplified: TGPolygon;
  public
    constructor Create(const aCoordinates: array of TGLatLng);overload;
    constructor Create(const aPoints:Array of TPointFloat2D);overload;
    function supportsHide: Boolean;override;
  published
    function JsClassName:String;override;
    procedure Clear;
    function ToJavaScript:String;override;
    function AddPoint(const aGLatLng:TGLatLng):integer;
    property Color:TColor read FColor write SetColor;
    property WeightPx:integer read FWeightPx write SetWeightPx;
    property Opacity:double read FOpacity write SetOpacity;// number between 0 and 1
    property Count:Integer read GetCount;
    destructor Destroy;override;
    property IsDirty:Boolean read FIsDirty write FIsDirty;
    property Simplified:TGPolygon read GetSimplified write SetSimplified;
    function getSimplifiedVersion(Tolerance:Double=DEFAULT_SIMPLIFY_TOLERANCE):TGPolygon;
    class function PolyTypeStr: String;virtual;
  end;

  TGPolyLine=class(TGPolygon,IJsClassWrapper,IHidable)
  published
    class function PolyTypeStr:String;override;
    function JsClassName:String;override;
  end;

  TGCopyright=class(TGOverlay,IJsClassWrapper,IHidable)
  private
    FminZoom: Integer;
    Fid: Integer;
    Fbounds: TGLatLngBounds;
    Ftext: String;
    procedure Setbounds(const Value: TGLatLngBounds);
    procedure Setid(const Value: Integer);
    procedure SetminZoom(const Value: Integer);
    procedure Settext(const Value: String);
  published
    property id         : Integer        read Fid write Setid; // A unique identifier for this copyright information.
    property minZoom    : Integer        read FminZoom write SetminZoom; // The lowest zoom level at which this information applies.
    property bounds     : TGLatLngBounds read Fbounds write Setbounds; // The region to which this information applies.
    property text     : String         read Ftext write Settext; // The text of the copyright message.
    constructor Create (aId : Integer; aBounds:TGLatLngBounds;aMinZoom:Integer;aText:String);
  end;

  TGoogleMaps=class(TPanel)
  private
    FWebBrowser:TWebBrowser;
    FhasEnd: Boolean;
    FhasStart: Boolean;
    FLogLines: TStrings;
    FOverlays: TOverlayList;
    FMapType: TGoogleMapType;
    FLatLngCenter: TGLatLng;
    FEnableDoubleClickZoom: Boolean;
    FEnableContinuousZoom: Boolean;
    FStatusPanel: TPanel;
    FJsVarName: String;
    procedure LoadHTML(URL:String);
    procedure SetLogLines(const Value: TStrings);
    procedure SetOverlays(const Value: TOverlayList);
    procedure Init;
    procedure SaveGoogleMapsHtml(const aFileName:String);
    procedure SetLatLngCenter(const Value: TGLatLng);
    procedure SetEnableContinuousZoom(const Value: Boolean);
    procedure SetEnableDoubleClickZoom(const Value: Boolean);
    function GetLatLngCenter: TGLatLng;
    property WebBrowser : TWebBrowser read FWebBrowser write FWebBrowser;
    procedure SetMapType(AMapType:TGoogleMapType);
    procedure SaveHTML(const FileName:String);
    function GetHTML: String;
    property hasStart     : Boolean read FhasStart write FhasStart;
    property hasEnd       : Boolean read FhasEnd write FhasEnd;
    procedure SetStatusPanel(const Value: TPanel);
    procedure SetJsVarName(const Value: String);
    property DragKind;
    property DragMode;
    property DockSite;
    property Ctl3D;
    property BiDiMode;
    property AutoSize;
    property HelpContext;
    property HelpKeyword;
    property HelpType;
    property Owner;
    property ParentBackground;
    property ParentBiDiMode;
    property ParentCtl3D;
    property Showing;
    property UseDockManager;
    property VerticalAlignment;
    property WheelAccumulator;

  public
    constructor Create(AOwner: TComponent);override;
    destructor Destroy;override;
    procedure SetCenter(Lat,Lng,Alt:Double;doPan:Boolean=false);overload;
    procedure SetCenter(Lat,Lng:Double;doPan:Boolean=false);overload;
    procedure SetCenter(LatLng:TGLatLng;doPan:Boolean=false);overload;
    procedure HandleOnResize(Sender:TObject);
    function GetJsValue(aJavaScript:String):OleVariant;
    property HTML: String read GetHTML;
    procedure CheckResize;
  published
    property StatusPanel  : TPanel read FStatusPanel write SetStatusPanel;
    property LogLines     : TStrings read FLogLines write SetLogLines;
    property Overlays     : TOverlayList read FOverlays write SetOverlays;
    property LatLngCenter : TGLatLng read GetLatLngCenter write SetLatLngCenter;
    property EnableContinuousZoom:Boolean read FEnableContinuousZoom write SetEnableContinuousZoom default true;
    property EnableDoubleClickZoom:Boolean read FEnableDoubleClickZoom write SetEnableDoubleClickZoom default true;
    property MapType:TGoogleMapType read FMapType write SetMapType;
    property JsVarName:String read FJsVarName write SetJsVarName;
    procedure AddControl(ControlType:TGoogleMapControl);
    procedure AddStartMarker;
    procedure AddEndMarker;
    procedure AddMarker(Lat,Lon:Double);
    procedure AddPolygon(GPolygon:TGPolygon);
    procedure AddOverlay(aOverlay:TGOverlay);
    procedure RemoveOverlay(aOverlay:TGOverlay);
    procedure RemoveOverlayByIndex(Index:Integer);
    procedure ClearOverlays;
    procedure SwapBeginEndMarkers;
    procedure GetDirections;
    procedure ShowAddress(const Street,City,State,Country:String);
    procedure openInfoWindow(aLatlng : TGLatLng; aHTML:String);
    procedure closeInfoWindow;
    procedure ExecJavaScript(const aScript:String);
    procedure WebBrowserDocumentComplete(ASender: TObject; const pDisp: IDispatch; var URL: OleVariant);
    procedure OnMouseOver;

    property Align;
    property OnClick;
    property OnCanResize;
    property OnResize;
    property OnEnter;
    property OnExit;
    property OnKeyDown;
    property OnKeyPress;
    property OnKeyUp;
    property OnDblClick;
    property OnMouseWheel;
    property OnMouseWheelDown;
    property OnMouseWheelUp;
    property OnConstrainedResize; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-21T00:30:24.250

如果您正在寻找路线并且准备编写一些 javascript，则可以使用 GDirections，它是 GoogleMaps API 的一部分。

我在 Delphi[的 TWebBrowser 中的 Google Maps 中有一个示例 Delphi 程序：](http://www.jasontpenny.com/blog/2009/01/11/google-maps-in-a-twebbrowser-from-delphi-directions/)您可能会觉得有帮助的方向。[（项目邮编）](http://www.jasontpenny.com/Delphi/GoogleMapsDirectionsTest.zip)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T21:05:35.530

在“Google maps delphi”上的快速 Google 搜索出现了 10 多页的点击量。前 3 名是[从 VCL 示例应用程序中使用 Google 地图](http://www.stevetrefethen.com/blog/UsingGoogleMapsFromVCLSampleApplication.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T21:41:03.510

谨防法律后果。我们尝试了类似的方法但将其删除，因为我们发现无法合法解决它。看起来 Googlemaps 不是为桌面设计的。这并不奇怪。

顺便说一句，您可以使用 kml 和 google earth 获得不错的结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T21:08:29.983

您是对的，没有其他 [合法] 方法可以将谷歌地图嵌入桌面应用程序：您必须使用 WeBrowser 类型的控件。当然，它因语言而异（正如您在 Mozilla C++ 组件中注意到的那样），但您的选择非常有限。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T00:49:18.207

[几年前，在 Delphi 中嵌入 Mozilla 的](http://delphi.mozdev.org/)工作似乎停滞不前，但[Irongut](http://www.paranoia.clara.net/articles/taming_the_lizard_with_delphi.html)仍然有一篇关于嵌入它的文章。据我了解，这从来都不是一个完全令人满意的解决方案，因为它需要大量额外的 Mozilla 文件分发（即使用户已经安装了 Mozilla/FF）。

正如 Gamecat 建议的那样，Google Earth 可以取得一些不错的效果。[我在“谷歌地球航空公司网站](http://www.googleearthairlines.com/demo/DelphiDEmoGePlugin.rar)”上找到了一个简单的在 Delphi 应用程序中嵌入谷歌地球的示例项目。这可能足以向您展示此解决方案是否适合您的需求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T00:39:54.717

我能找到的唯一为桌面应用程序提供良好支持的服务是 MapQuest。我在八月份写了一篇介绍性文章，介绍如何在[此处](http://ruminatedrumblings.blogspot.com/2008/08/mapquest-and-delphi.html)使用 MapQuest 和 Delphi来提取 Lat/Lng 值。基本上所有的 XML 消息格式都与他们的服务器交互。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T17:33:19.117

我在本月早些时候的 Delphi Developer Days 上看到了 Marco Cantù 的演示。太棒了。可以肯定的是，他在所有事情上都使用了 Indy。

# asp.net - .NET 用户管理自定义

> ID：558690
> 
> 赞同：2
> 
> 时间：2009-02-17T20:57:04.300
> 
> 标签：asp.net, asp.net-membership

我想知道是否有人可以向我指出一些有关定制 .NET 中构建的用户管理系统的资源。我在说的是：http: [//msdn.microsoft.com/en-us/library/ms998347.aspx](http://msdn.microsoft.com/en-us/library/ms998347.aspx)

我想知道，如何扩展用户字段来存储不仅仅是普通密码、用户名？我想存储例如：生日和其他结果集。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T21:20:23.590

在我看来，您根本不应该扩展成员资格表。相反，您应该创建自己的表并引用成员数据。我使用的一种技术是使用 Membership GUID ID 作为我自己的“用户”表的外键，其中包含我的扩展数据。

这样做是最好的，因为如果 Microsoft 决定将来扩展 Membership 表，您的代码不会中断。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T21:01:36.910

您正在寻找配置文件 API [http://msdn.microsoft.com/en-us/magazine/cc163724.aspx](http://msdn.microsoft.com/en-us/magazine/cc163724.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:02:04.850

看：

*   [ASP.NET 配置文件属性概述](http://msdn.microsoft.com/en-us/library/2y3fs9xs.aspx)
*   [定义 ASP.NET 配置文件属性](http://msdn.microsoft.com/en-us/library/d8b58y5d.aspx)
*   [检查 ASP.NET 2.0 的成员资格、角色和配置文件 - 第 1 部分](http://aspnet.4guysfromrolla.com/articles/101106-1.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T21:06:20.863

本教程非常详细地介绍了扩展 Membership API ：

[Microsoft ASP.NET 2.0 成员资格 API 扩展](http://www.devx.com/codemag/Article/34492/1763/page/1)

# winforms - SSRS WinForm 报表查看器操作

> ID：558701
> 
> 赞同：4
> 
> 时间：2009-02-17T21:00:29.940
> 
> 标签：winforms, reporting-services, report, reportviewer

我正在查看 SSRS 2005 中的报表查看器 WinForms 控件，并想知道除了调用 URL 或显示另一个报表之外，您是否可以让操作执行其他操作。我的老板喜欢报表查看器控件，但想知道您是否可以设置它，以便如果您单击一个单元格，它可以打开另一个表单。

我认为“操作”属性是正确的工具，但我没有看到任何运行代码的选项......我看到的只是“转到书签”、“跳转到报告”和“转到 URL” . 是否存在控件公开的事件，我可以使用该事件来确定单击了哪个单元格或其他方式可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T21:48:28.437

查看文档，ReportViewer 控件上有一个[Hyperlink](http://msdn.microsoft.com/en-us/library/microsoft.reporting.winforms.reportviewer.hyperlink.aspx)事件，只要用户单击报表中的链接，就会触发该事件。您可能能够处理该事件，将 Cancel 设置为 true，然后采取您自己的操作。

澄清一下 - 这意味着使用“转到 URL”操作，但指定一个您可以自己解析的 URL。例如，“ [http://example.com?action=ShowHelloWorld](http://example.com?action=ShowHelloWorld) ”。然后你可以解析[e.Hyperlink](http://msdn.microsoft.com/en-us/library/microsoft.reporting.winforms.hyperlinkeventargs.hyperlink.aspx)属性并决定采取什么行动。

# c - 用于 C 语言的低级、网络相关软件的读物、工具和库

> ID：558703
> 
> 赞同：1
> 
> 时间：2009-02-17T21:00:47.397
> 
> 标签：c, networking, drivers, low-level, firmware

我即将毕业，电子和 tlc 工程，我有一些不错的 PHP 和 Java OO 编程经验。
现在我想尝试以 C 程序员的身份开始职业生涯。

我对 C 很感兴趣，因为我认为这是最适合开发设备驱动程序、固件和其他低级软件的语言，而不考虑汇编语言。特别是我希望能够从事与网络相关的主题。我想在硬件附近工作，因为我认为这是我能够在获得学位的同时获得作为程序员的满足感的唯一途径。

所以我想问一下你认为我应该读什么，因为我已经可以用 C 写一些东西了，虽然没有什么花哨的，而且我已经读了几次 K&R。

如果您知道任何工具或库（如 libevent 和 libev），它们是低级、网络相关、C 编程领域的事实上的标准，也很高兴知道。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T21:21:07.910

没有特别的顺序：

*   [Unix网络编程](https://rads.stackoverflow.com/amzn/click/com/0131411551)
*   [标准 C 库](https://rads.stackoverflow.com/amzn/click/com/0131315099)
*   [开始 Linux 编程](https://rads.stackoverflow.com/amzn/click/com/0470147628)
*   [专业的 Linux 编程](https://rads.stackoverflow.com/amzn/click/com/0471776130)
*   [Linux 设备驱动程序](http://lwn.net/Kernel/LDD3/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T21:12:05.793

必读书籍：

*   TCP/IP 图解，史蒂文斯
*   UNIX 网络编程，Stevens 等人

对于系统级网络代码（您表示对驱动程序等感兴趣），请参阅[OpenBSD 源代码](http://www.openbsd.org/cgi-bin/cvsweb/src/sys/net/)，因为它紧凑、干净，并且标准网络 API 几乎完全基于 BSD。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:28:51.853

取决于你想去多低的水平。有一个名为[uIP](http://www.sics.se/~adam/uip/index.php/Main_Page)的小堆栈 ，读起来很不错，它有据可查，并且有几篇关于它的论文。它比任何 linux socket/io 编程都更接近硬件，因为没有内核阻碍。

您可能还想看看 tcpdump，它是一个不错的基于 cli 的嗅探器（用 c 编写），因此您既可以使用它，也可以将它拆开！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T22:41:24.130

[Beej 的网络编程指南](http://beej.us/guide/bgnet/output/html/multipage/reference.html#books)是入门的好地方。如果您想深入兔子洞，那么正如许多其他人所推荐的那样，请查看 W. Richard Stevens 的 Unix Network Programming, 第 1-2 卷。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T21:04:17.933

libcurl 源代码如何？看看[这里](http://curl.haxx.se/devel.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T21:19:05.480

我已经多次使用过这个[“Linux I/O 端口编程 mini-HOWTO”](http://www.faqs.org/docs/Linux-mini/IO-Port-Programming.html)。这是 C 代码。

还有一些用于[串行 I/O](http://www.taltech.com/freesoftware/fs_sw.htm#completec)的 C 代码示例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T21:33:09.987

不完全是 C 特定的，但像 Wireshark 这样的数据包嗅探器对于测试和调试网络相关程序非常有用。

# c# - Mono mkbundle 工具无法创建二进制文件并抱怨输出文件不可用

> ID：558707
> 
> 赞同：2
> 
> 时间：2009-02-17T21:02:13.710
> 
> 标签：c#, compiler-construction, mono, linker, mkbundle

根据[这个线程](https://stackoverflow.com/questions/551554/can-you-compile-c-without-using-the-net-framework)关于运行无 .NET 的 C# 应用程序的建议，我使用单声道编译了我的应用程序。我使用最新的 Visual C# .NET Express Edition 构建了原始应用程序。它在 Windows 上的 .NET 上运行良好。然后我打开 Cygwin 并导航到我再次编译项目的源代码，在 mono 下使用以下命令：

```
$ mcs <myProjectHere>.cs 
```

这将生成 MyProject.exe，它可以在 Cygwin 中成功运行，并且可以从 Window 命令行成功运行。使用的命令是：

```
$ mono MyProject.exe
C:\...>mono MyProject.exe 
```

只是为了踢球，简单地说：

```
C:\...>MyProject.exe 
```

一切都按预期工作。然后我尝试使用 mkbundle 命令将单声道编译的可执行文件构建为静态链接的二进制文件，如下所示：

```
$ mkbundle -o MyProject MyProject.exe --deps 
```

这是事情开始走下坡路的地方。它开始得很好，然后抱怨输出文件（大概是 MyProject.exe）因为忙而无法打开。这一切的完整输出在这里：

```
    $ mkbundle -o 程序 Program.exe --deps
    操作系统是：Windows
    来源：1 自动依赖：真
       嵌入：c:\Documents and Settings\bsweeney\My Documents\Visual Studio 2008
    \Projects\TestConsole\TestConsole\Program.exe
       嵌入：C:\PROGRA~1\Mono-2.2\lib\mono\2.0\mscorlib.dll
    编译：
    as -o temp.o temp.s
    gcc -mno-cygwin -g -o 程序 -Wall temp.c `pkg-config --cflags --libs mono|dos2
    Unix`temp.o
    /usr/lib/gcc/i686-pc-mingw32/3.4.4/../../../../i686-pc-mingw32/bin/ld：无法操作
    en 输出文件 Program.exe: 设备或资源忙
    collect2: ld 返回 1 个退出状态
    [失败]

```

我声称我的 unix gcc 工具链已安装并且状况良好，因为我最近能够使用它在 eclipse 中成功编译一些 c++ 应用程序（尽管我认为我应该对任何数量的问题持开放态度......）。

有人遇到过这样的事情吗？我被难住了...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T22:00:33.010

似乎它正在尝试输出到`MyProject.exe`，这与输入文件相同。

尝试运行

```
$ mkbundle -o ProgramOutput Program.exe --deps 
```

顺便说一下，这只是一个猜测，因为我不知道`mkbundle`。

# php - 从 MySQL 中选择可变数量的随机记录

> ID：558719
> 
> 赞同：3
> 
> 时间：2009-02-17T21:06:47.320
> 
> 标签：php, mysql, random

我想显示数据库中的随机记录。如果我选择，我希望能够显示 X 条随机记录。因此，我需要从随机选择的 ID 列表中选择前 X 条记录

（永远不会有超过 500 条记录可供选择，除非地球的大小急剧增加。目前有 66 种可能。）

此功能有效，但我怎样才能使它变得更好？

```
/***************************************************/
/* RandomSite */
//****************/
//  Returns an array of random site IDs or NULL
/***************************************************/   
function RandomSite($intNumberofSites = 1) {
    $arrOutput = NULL;
    //open the database
    GetDatabaseConnection('dev');

    //inefficient
    //$strSQL = "SELECT id FROM site_info WHERE major <> 0 ORDER BY RAND() LIMIT ".$intNumberofSites.";";

    //Not wonderfully random
    //$strSQL = "SELECT id FROM site_info WHERE major <> 0 AND id >= (SELECT FLOOR( COUNT(*) * RAND()) FROM site_info ) ORDER BY id LIMIT ".$intNumberofSites.";";

    //Manual selection from available pool of candidates  ?? Can I do this better ??
    $strSQL = "SELECT id FROM site_info WHERE major <> 0;";

    if (is_numeric($intNumberofSites))
    {
        //excute my query
        $result = @mysql_query($strSQL);
        $i=-1;

        //create an array I can work with  ?? Can I do this better ??
        while ($row = mysql_fetch_array($result, MYSQL_NUM))
        {
            $arrResult[$i++] = $row[0];
        }

        //mix them up
        shuffle($arrResult);

        //take the first X number of results  ?? Can I do this better ??
        for ($i=0;$i<$intNumberofSites;$i++)
        {
            $arrOutput[$i] = $arrResult[$i];
        }
    }   

    return $arrOutput;
    } 
```

**更新问题：** 我知道 ORDER BY RAND()，我只是不想使用它，因为有传言说它在扩展和性能方面不是最好的。我对我的代码过于挑剔。我有什么作品，ORDER BY RAND() 作品，但我可以做得更好吗？

**更多更新** ID 中有漏洞。没有大量的流失，但是发生的任何流失都需要得到我们团队的批准，因此可以处理转储任何缓存。

感谢您的回复！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T21:14:27.130

为什么不在数据库查询的 orderby 中使用 Rand 函数？然后你不必进入代码中的随机化等......

类似的东西（我不知道这是否合法）

```
Select *
from site_info
Order by Rand()
LIMIT N 
```

其中 N 是您想要的记录数...

**编辑**
您是否分析了您的代码与查询解决方案？我认为您只是在这里进行了预优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:20:30.733

如果您不想按 rand() 的顺序进行选择。

在结果上使用[array_rand](http://no.php.net/manual/en/function.array-rand.php)而不是改组：

```
$randKeys = array_rand($arrResult, $intNumberofSites);
$arrOutput = array_intersect_key(array_flip($randKeys), $arrResult); 
```

编辑：返回键数组不是键=>值的新数组

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:22:28.577

好吧，我认为 ORDER BY RAND() 在只有 66 行的表中不会那么慢，但是无论如何您都可以研究一些不同的解决方案。

数据真的很稀疏和/或经常更新吗（所以 id 有很大的差距）？

假设它不是很稀疏，您可以从表中选择最大 id，使用 PHP 的内置随机函数在 1 和最大 id 之间选择 N 个不同的数字，然后尝试从表中获取具有这些 id 的行。如果返回的行数少于选择的数字，请获取更多的随机数并重试，直到获得所需的行数。这也可能不是特别快。

如果数据稀疏，我会设置一个辅助“id-type”列，确保它是连续的。因此，如果表中有 66 行，请确保新列包含值 1-66。每当在表中添加或删除行时，您都必须做一些工作来调整此列中的值。然后使用与上面相同的技术，在 PHP 中选择随机 ID，但您不必担心“缺少 ID？重试”的情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T18:13:50.770

这是我编写和测试的三个函数

我的答案

```
/***************************************************/
/* RandomSite1 */
//****************/
//  Returns an array of random rec site IDs or NULL
/***************************************************/   
function RandomSite1($intNumberofSites = 1) {
    $arrOutput = NULL;
    GetDatabaseConnection('dev');
    $strSQL = "SELECT id FROM site_info WHERE major <> 0;";
    if (is_numeric($intNumberofSites))
    {
        $result = @mysql_query($strSQL);
        $i=-1;
        while ($row = mysql_fetch_array($result, MYSQL_NUM)) {
            $arrResult[$i++] = $row[0]; }
        //mix them up
        shuffle($arrResult);
        for ($i=0;$i<$intNumberofSites;$i++) {
            $arrOutput[$i] = $arrResult[$i]; }
    }   
    return $arrOutput;
    } 
```

JPunyon 和许多其他人

```
/***************************************************/
/* RandomSite2 */
//****************/
//  Returns an array of random rec site IDs or NULL
/***************************************************/   
function RandomSite2($intNumberofSites = 1) {
    $arrOutput = NULL;
    GetDatabaseConnection('dev');
    $strSQL = "SELECT id FROM site_info WHERE major<>0 ORDER BY RAND() LIMIT ".$intNumberofSites.";";
    if (is_numeric($intNumberofSites))
    {
        $result = @mysql_query($strSQL);
        $i=0;
        while ($row = mysql_fetch_array($result, MYSQL_NUM)) {
            $arrOutput[$i++] = $row[0]; }
    }   
    return $arrOutput;
    } 
```

OIS 具有满足我的问题意图的创造性解决方案。

```
/***************************************************/
/* RandomSite3 */
//****************/
//  Returns an array of random rec site IDs or NULL
/***************************************************/   
function RandomSite3($intNumberofSites = 1) {
    $arrOutput = NULL;
    GetDatabaseConnection('dev');
    $strSQL = "SELECT id FROM site_info WHERE major<>0;";
    if (is_numeric($intNumberofSites))
    {
        $result = @mysql_query($strSQL);
        $i=-1;
        while ($row = mysql_fetch_array($result, MYSQL_NUM)) {
            $arrResult[$i++] = $row[0]; }
        $randKeys = array_rand($arrResult, $intNumberofSites);
        $arrOutput = array_intersect_key($randKeys, $arrResult);
    }   
    return $arrOutput;
    } 
```

我做了一个简单的 10,000 次迭代循环，其中我拉出 2 个随机站点。我为每个功能关闭并打开了一个新浏览器，并在运行之间清除了缓存。我运行了 3 次测试以获得一个简单的平均值。

注意 - 第三种解决方案在提取少于 2 个站点时失败，因为如果 array_rand 函数返回一个集合或单个结果，则它具有不同的输出。我变得懒惰并且没有完全实现条件来处理这种情况。

*   1 平均：12.38003755 秒
*   2 平均：12.47702177 秒
*   3 平均：12.7124153 秒

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T21:15:10.887

```
mysql_query("SELECT id FROM site_info WHERE major <> 0 ORDER BY RAND() LIMIT $intNumberofSites") 
```

编辑该死的，JPunyon 快一点:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T21:57:56.837

试试这个：

```
SELECT
  @nv := @min + (RAND() * (@max - @min)) / @lc,
  (
  SELECT
    id
  FROM  site_info
  FORCE INDEX (primary)
  WHERE id > @nv
  ORDER BY
    id
  LIMIT 1
  ),
  @max,
  @min := @nv,
  @lc := @lc - 1
FROM
  (
  SELECT @min := MIN(id)
  FROM site_info
  ) rmin,
  (
  SELECT @max := MAX(id)
  FROM site_info
  ) rmax,
  (
  SELECT @lc := 5
  ) l,
  site_info
LIMIT 5 
```

这将使用索引在每次迭代中按降序选择一个随机 ID。

但是，您获得所需结果的可能性很小，因为它不会给错过的 id 提供第二次机会。

您选择的行的百分比越高，机会就越大。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-17T21:17:17.217

我会简单地使用 rand() 函数（我假设你使用的是 MySQL）......

```
SELECT id, rand() as rand_idx FROM site_info WHERE major <> 0 ORDER BY rand_idx LIMIT x; 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-17T22:07:00.530

我和JPunyon在一起。使用`ORDER BY RAND() LIMIT $N`. 我认为`$arrResult`拥有和改组这么多（未使用的）条目会比使用 MySQL RAND() 函数对性能产生更大的影响。

```
function getSites ( $numSites = 5 ) {

    // Sanitize $numSites if necessary

    $result = mysql_query("SELECT id FROM site_info WHERE major <> 0 "
                         ."ORDER BY RAND() LIMIT $numSites");

    $arrResult = array();

    while ( $row = mysql_fetch_array($result,MYSQL_NUM) ) {
        $arrResult[] = $row;
    }

    return $arrResult;
} 
```

# css - CSS 类和子类

> ID：558721
> 
> 赞同：110
> 
> 时间：2009-02-17T21:07:13.263
> 
> 标签：css

是否有可能，除了我正在做的事情，因为它似乎不起作用，这样做？我希望能够拥有一个类下的子类，以便专门为该 class.subclass 使用 CSS。

CSS

```
.area1
{
    border:1px solid black;
}
.area1.item
{
    color:red;
}
.area2
{
    border:1px solid blue;
}
.area2.item
{
    color:blue;
} 
```

HTML

```
<div class="area1">
    <table>
        <tr>
            <td class="item">Text Text Text</td>
            <td class="item">Text Text Text</td>
        </tr>
    </table>
</div>
<div class="area2"> 
    <table>
        <tr>
            <td class="item">Text Text Text</td>
            <td class="item">Text Text Text</td>
        </tr>
    </table>
</div> 
```

这样我就可以对父 CSS 类“area1”、“area2”下的元素使用 class="item"。我知道我可以使用 class="area1 item" 来让它工作，但我不明白为什么它必须如此冗长。css子类不应该查看它所在的父类来定义它吗？

注意：这在 IE 中有效（现在使用 7），但在 FF 中无效，所以我假设这不是 CSS 标准的做事方式。

* * *

## 回答 #1

> 赞同：196
> 
> 时间：2009-02-17T21:09:18.717

只需要添加一个空格：

```
.area2 .item
{
    ...
} 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-02-17T21:20:47.380

仅供参考，当您像上面那样定义规则时，将两个选择器链接在一起：

```
.area1.item
{
    color:red;
} 
```

它的意思是：

> 将此样式应用于同时具有“area1”和“item”类的任何元素。

如：

```
<div class="area1 item"> 
```

遗憾的是它在 IE6 中不起作用，但这就是它的意思。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-02-17T21:09:43.180

您的问题似乎是 CSS 中两个类之间缺少空格：

```
.area1.item
{
    color:red;
} 
```

应该

```
.area1 .item
{
    color:red;
} 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-02-17T21:10:33.147

你想强制只选择孩子吗？ [http://css.maxdesign.com.au/selectutorial/selectors_child.htm](http://css.maxdesign.com.au/selectutorial/selectors_child.htm)

```
.area1
{
        border:1px solid black;
}
.area1>.item
{
    color:red;
}
.area2
{
    border:1px solid blue;
}
.area2>.item
{
    color:blue;
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-02-17T21:09:45.737

只需在 .area1 和 .item 之间放置一个空格，例如：

```
.area1 .item
{
    color:red;
} 
```

此样式适用于类为 area1 的元素中的 item 类元素。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-17T21:13:09.380

只需在您的课程之间留一个空格

```
.area1 .item
{
    ...
} 
```

[这是CSS Selectors](http://www.w3.org/TR/CSS2/selector.html)的一个很好的参考。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-06-12T07:03:28.160

继上面 kR105 的回复之后：

我的问题类似于OP（原始海报）的问题，只发生在表之外，所以子类不是从父类（表）范围内调用的，而是在它之外，所以我不得不添加选择器，如 kR105 所述。

这就是问题所在：我有两个框（div），每个框都具有相同的边框半径（HTML5）、填充和边距，但需要使它们具有不同的颜色。而不是为每个颜色类重复这 3 个参数，我想要一个“超类”来包含边框半径/填充/边距，然后只是单独的“子类”来表达它们的差异（每个都用双引号括起来，因为它们不是真正的子类 -见我后面的帖子）。下面是它的结果：

HTML：

```
<body>
  <div class="box box1"> Hello my color is RED </div>
  <div class="box box2"> Hello my color is BLUE </div>
</body> 
```

CSS：

```
div.box {border-radius:20px 20px 20px 20px; padding:10px; margin:10px}
div.box1 {border:3px solid red; color:red}
div.box2 {border:3px solid blue; color:blue} 
```

希望有人觉得这很有帮助。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-18T13:39:29.400

这是 CSS 的支柱，即*级联*样式表中的“级联”。

如果您在一行中编写 CSS 规则，则可以更轻松地查看结构：

```
.area1 .item { color:red; }
.area2 .item { color:blue; }
.area2 .item span { font-weight:bold; } 
```

使用多个类也是 CSS 的一种很好的中级/高级用法，不幸的是，在编写跨浏览器代码时有一个众所周知的 IE6 错误限制了这种用法：

```
<div class="area1 larger"> .... </div>

.area1 { width:200px; }
.area1.larger { width:300px; } 
```

IE6*忽略*多类规则中的第一个选择器，因此 IE6 实际上将 .area1.larger 规则应用为

```
/*.area1*/.larger { ... } 
```

这意味着它将影响所有 .larger 元素。

这是 IE6 中一个非常讨厌和不幸的错误（其中之一），如果您想要一个干净的跨浏览器 CSS 文件，它会迫使您几乎从不使用 CSS 的该功能。

然后解决方案是使用 CSS 类名前缀来避免与通用类名冲突：

```
.area1 { ... }
.area1.area1Larger { ... }

.area2.area2Larger { ... } 
```

也可以只使用一个类，但这样您可以将 CSS 保持在您想要的逻辑中，同时知道 .area1Larger 只会影响 .area1 等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-18T03:47:07.577

你也可以在这样的元素中有两个类

`<div class = "item1 item2 item3"></div>`

类中的每个项目都是它自己的类

```
.item1 {
  background-color:black;
}

.item2 {
  background-color:green;
}

.item3 {
  background-color:orange;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-18T10:11:29.500

例如，您在 div 上应用的类可用作使用该 div 样式元素的参考点。

```
<div class="area1">
    <table>
        <tr>
                <td class="item">Text Text Text</td>
                <td class="item">Text Text Text</td>
        </tr>
    </table>
</div>

.area1 { border:1px solid black; }

.area1 td { color:red; } /* This will effect any TD within .area1 */ 
```

要成为超级语义，您应该将类​​移到桌子上。

```
 <table class="area1">
        <tr>
                <td>Text Text Text</td>
                <td>Text Text Text</td>
        </tr>
    </table> 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-06-12T07:37:16.597

kR105 写道：

> 你也可以在这样的元素中有两个类

```
<div class = "item1 item2 item3"></div 
```

> 我看不出这个的价值，因为按照层叠样式的原则，最后一个优先。例如，如果在我之前的示例中，我将 HTML 更改为阅读

```
 <div class="box1 box2"> Hello what is my color? </div> 
```

框的边框和文本将是蓝色的，因为 .box2 的样式分配了这些值。

同样在我之前的帖子中，我应该强调**添加**选择器与在类中创建**子**类（该线程中的第一个解决方案）不同，尽管效果相似。

# asp.net - 在 ASP.NET 成员资格提供程序中从散列到加密密码类型是否可以？

> ID：558722
> 
> 赞同：1
> 
> 时间：2009-02-17T21:07:35.117
> 
> 标签：asp.net, asp.net-membership, forms-authentication, membership-provider

我有一个 asp.net web 应用程序，表单身份验证，它使用散列密码类型。如果我将密码类型更改为加密，我会遇到任何问题吗？

我看到，如果我更改为加密，尝试恢复旧散列密码的密码会优雅地失败，这很好。如果我改变，有没有什么不好的事情会出现。

如果有人在我更改为 Encrypted 后更改了他们的密码，则密码类型将保持为 Hashed。有什么方法可以强制它将新密码存储为 Encrypted 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T21:27:20.937

> 如果我将密码类型更改为加密？

为什么？

散列更安全（密码恢复：生成新密码并发送）。

我可以看到使用加密的唯一原因是系统本身是否需要密码（例如，以用户身份向另一个系统进行身份验证）。

# database - 在应用程序或数据库中定义数据库模式？

> ID：558724
> 
> 赞同：0
> 
> 时间：2009-02-17T21:07:52.060
> 
> 标签：database, orm, schema

我知道标题可能听起来有点矛盾，但我要问的是关于 ORM 框架（在这种情况下是 SQLAlchemy，但我想这将适用于其中任何一个），它允许您在应用程序中定义架构.

是直接更改数据库模式，然后手动更新程序中的列类型更好，还是在应用程序中定义表，然后使用 ORM 框架的表生成函数制作模式，然后构建更有意义？数据库端的表适合你吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T21:23:38.310

请记住，应用程序和数据库在任何情况下都倾向于存在 M:M 关系，但最微不足道的情况除外。如果您的应用程序很可能具有与其他系统、报告、数据提取或加载的接口，或者数据迁移到另一个系统或从另一个系统迁移出去，那么数据库有*多个利益相关者。*

善待应用程序中的其他利益相关者。花点时间正确地建立架构，并在设计应用程序时考虑数据质量。密切关注使用该应用程序的其他任何人，并确保您不会在不告诉他们的情况下破坏他们所依赖的架构的一部分。这意味着数据库或多或少都有自己的生命。集成度越高，数据库越独立。

当然，如果没有其他人使用或关心数据，请随意忽略我的建议。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T21:22:15.177

我个人认为，您应该根据自身的优点来设计数据库。数据库是处理领域数据建模的最佳场所。数据库也是应用程序减速的最大来源，让您的 ORM 设计您的数据库对我来说似乎是个坏主意。:)

当然，我身后只有几个大项目。我还在每天学习。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T22:23:50.800

定义数据库模式的最佳方法是从对应用程序域建模（域驱动设计吗？）开始，并根据您定义的域对象查看哪些表形成。

我认为这是最好的方法，因为实际上数据库只是一个保存应用程序信息的地方，它永远不应该主导设计。它也不是唯一保存信息的地方。例如，我们有想要使用平面文件或数据库的用户。他们还可以使用 XML 文件。因此，从您的域对象开始，然后从那里生成表（或平面文件或 XML 模式或其他）将最终导致更好的设计。

虽然这可能取决于您使用面向对象的语言，但使用 Hibernate/NHibernate、SubSonic 等 ORM 工具确实可以让您轻松完成此转换，包括生成数据库创建脚本。

关于性能，性能应该是您在应用程序中看到的最后一件事，它永远不应该驱动设计。在根据您的域启动并运行良好的架构后，您可以随时进行调整以提高其性能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T03:20:20.400

很大程度上取决于您对要使用的特定数据库产品的技能水平。可以将其视为“手动”和“自动”变速箱汽车之间的区别。ORM 为您提供“自动”传输，只需开始设计您的类，然后让 ORM 担心以某种方式将其存储到数据库中。

听起来不错。大多数 ORM 的问题在于，在他们追求 PI“无知”的过程中，他们通常不会利用可以为给定任务提供优雅解决方案的特定数据库功能。请注意，我没有说所有 ORM，只是说大多数。

我的看法是首先自己设计概念数据模型。然后您可以朝任一方向前进，向上朝向应用程序空间，或向下朝向物理数据库。但是请记住，只有您知道使用视图而不是表是否更有利，如果您对表进行规范化或反规范化，该表对哪些非聚集索引有意义，是自然键还是代理键适合这个表等等……当然，如果你觉得这些问题超出了你的掌握，那就让ORM来帮你吧。

还有一件事，您确实需要将应用程序设计与数据库设计分开。它们几乎不一样。这些数据有多重要？是否可以设计另一个应用程序来使用该数据？重构一个应用程序比重构一个包含分布在数千个表中的十亿行数据的数据库要容易得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T21:13:57.410

好吧，如果你能摆脱它，那么在应用程序中执行它可能是最好的方法。因为它是 DRY 原则的完美示例。

话虽如此，但要摆脱它总是很难实现，因为您实际上选择放弃大多数特定于数据库的优化。（更重要的是，通过查询，但它仍然适用于模式（索引等））。

无论如何，您最终可能会手动更改架构，然后您将陷入脆弱的数据库架构，这将成为您最糟糕的噩梦的根源:)

我的 2 美分

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T05:27:52.357

尽可能根据自己的要求进行设计。试图让它们保持过于严格的同步是增加耦合/降低内聚的一个很好的例子。

想想看，ORM 可以很容易地用于传播耦合（即使在某种程度上可以避免）。

# performance - 在未排序的整数列表中优化搜索 k 最小值

> ID：558729
> 
> 赞同：5
> 
> 时间：2009-02-17T21:09:16.690
> 
> 标签：performance, computer-science, complexity-theory

我刚刚接受了一个问题的采访，我很好奇答案应该是什么。问题本质上是：

假设您有一个未排序的 n 个整数列表。您如何找到此列表中的 k 个最小值？也就是说，如果你有一个 [10, 11, 24, 12, 13] 的列表并且正在寻找 2 个最小值，你会得到 [10, 11]。

我有一个 O(n*log(k)) 解决方案，这是我最好的，但我很好奇其他人想出了什么。我将通过发布我的解决方案来避免污染人们的大脑，并将在稍后对其进行编辑。

编辑#1：例如，类似的函数：list getMinVals(list &l, int k)

编辑#2：它看起来像是一个选择算法，所以我也会加入我的解决方案；遍历列表，并使用优先级队列来保存最小值。优先级队列的规范是最大值将在优先级队列的顶部结束，因此在将顶部与元素进行比较时，顶部将被弹出，较小的元素将被推送。这假设优先级队列有一个 O(log n) 推送和一个 O(1) 弹出。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T21:16:13.927

这是[快速选择](http://en.wikipedia.org/wiki/Quick_select)算法。它基本上是一种快速排序，您只对数组的一部分进行递归。这是一个简单的 Python 实现，是为了简洁和可读性而不是效率而编写的。

```
def quickSelect(data, nLeast) :
    pivot = data[-1]
    less = [x for x in data if x <= pivot]
    greater = [x for x in data if x > pivot]
    less.append(pivot)

    if len(less) < nLeast :
        return less + quickSelect(greater, nLeast - len(less))
    elif len(less) == nLeast :
        return less
    else :
        return quickSelect(less, nLeast) 
```

这将平均在 O(N) 中运行，因为在每次迭代中，您都希望将 的大小减小`data`一个乘法常数。结果不会被排序。最坏的情况是 O(N^2)，但这与快速排序的处理方式基本相同，使用诸如中值 3 之类的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T21:17:52.940

这通常在算法书籍中的[选择算法](http://en.wikipedia.org/wiki/Selection_algorithm)或“线性选择”下。[这是 list 中关于 min/max k 值](http://en.wikipedia.org/wiki/Selection_algorithm#Selecting_k_smallest_or_largest_elements)的具体部分。它是 O(nlog(k))。

# exception - 为什么这个 groovy 代码会抛出 MultipleCompilationErrorsException？

> ID：558755
> 
> 赞同：0
> 
> 时间：2009-02-17T21:16:51.600
> 
> 标签：exception, scripting, groovy

我有以下常规代码：

```
 class FileWalker {
    private String dir

    public static void onEachFile(String dir,IAction ia) {
        new File(dir).eachFileRecurse {
            ia.perform(it)
        }
    }
}

walker = new FileWalker()
walker.onEachFile(args[0],new PrintAction()) 
```

我注意到如果我在 walker 前面放置一个**def ，脚本就可以工作。**这不应该像现在这样工作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T03:47:30.227

您不需要 groovyConsole 或 groovy 脚本中的 def 。我认为拥有它是一种很好的编程习惯，但是没有它，语言也可以工作，并将这些类型的变量添加到脚本绑定中。

我不确定您的其余代码（因为它不会像您发布的那样编译）。但是您要么有一个非常旧的 groovy 版本，要么您的配置或其余代码有其他问题。

通过为缺少的 IAction 接口和 PrintAction 类添加一个存根，我可以让它在不修改的情况下运行：

```
interface IAction {
    def perform(obj)
}

class PrintAction implements IAction{
    def perform(obj) {
        println obj
    }
}
class FileWalker {
    private String dir

    public static void onEachFile(String dir,IAction ia) {
        new File(dir).eachFileRecurse {
            ia.perform(it)
        }
    }
}

walker = new FileWalker()
walker.onEachFile(args[0],new PrintAction()) 
```

我用“foo/bar”和“foo/baz”文件创建了一个虚拟目录。

如果我将它保存到“walkFiles.groovy”并从命令行调用它

```
groovy walkFiles.groovy foo 
```

它打印：

```
foo/bar
foo/baz 
```

这是最新版本的 groovy：

```
groovy -v
Groovy Version: 1.6-RC-3 JVM: 1.5.0_16 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T23:30:24.947

在脚本模式下（或通过“groovyConsole”），您需要在使用之前使用“def”声明walker。Groovy 脚本文件在编译之前被翻译成类 Script 的派生类。因此，每个声明都需要正确完成。

另一方面，当您在“groovysh”（或使用 GroovyShell 类的实例）中运行脚本时，其机制会自动绑定每个引用对象，而无需声明。

**更新**：我上面的答案是错误的，因为我反编译了 Groovy 的 .class 并发现它也在脚本中使用了绑定对象。因此，我的第一段确实是错误的。

# c# - 条件取消引用运算符在 C# 中会是一件好事吗？

> ID：558756
> 
> 赞同：5
> 
> 时间：2009-02-17T21:17:12.897
> 
> 标签：c#, language-features

在函数式语言中，通常有一个`Maybe`monad，它允许您将多个调用链接到一个对象并让整个表达式返回`None`/`null`如果链的任何部分计算为空，而不是`NullReferenceException`通过链接调用在 C# 中获得的典型对象可能为空。

这可以通过编写`Maybe<T>`一些扩展方法来轻松实现，以允许使用查询理解在 C# 中进行类似行为，这在处理带有可选元素/属性的 XML 时非常有用，例如

```
var val = from foo in doc.Elements("foo").FirstOrDefault().ToMaybe()
          from bar in foo.Attribute("bar").ToMaybe()
          select bar.Value; 
```

但是这种语法有点笨拙和不直观，因为人们习惯于在 Linq 中处理序列而不是单个元素，并且它在末尾留下了 a`Maybe<T>`而不是 a 。`T`条件取消引用运算符（例如`..`）是否足够有用以使其成为语言？例如

```
var val = doc.Elements("foo").FirstOrDefault()..Attribute("bar")..Value; 
```

有条件的取消引用将扩展为：

```
object val;
var foo = doc.Elements("foo").FirstOrDefault();
if (foo != null)
{
    var bar = foo.Attribute("bar");
    if (bar != null)
    {
        val = bar.Value;
    }
    else
    {
        val = null;
    }
} 
```

我可以看到这可能会导致可怕的滥用，例如`..`在任何地方使用来避免 a `NullReferenceException`，但另一方面，如果使用得当，它在很多情况下可能会非常方便。想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T21:22:47.843

将多个调用链接到一个对象让我害怕违反[Demeter 法则](http://en.wikipedia.org/wiki/Law_of_Demeter)。因此，我怀疑此功能是否是一个好主意，至少在解决您用作示例的特定问题方面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T21:24:03.020

这是一个有趣的想法，可以通过扩展方法来实现。例如，像这样的东西（注意，只是举例 - 我相信它可以被改进）：

```
public static IEnumerable<T> Maybe<T>(this IEnumerable<T> lhs, Func<IEnumerable<T>, T> rhs)
{
  if (lhs != null)
  {
    return rhs(lhs);
  }

  return lhs;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:24:31.210

我怀疑 NUllable 和扩展方法的组合可以实现其中的很大一部分。

当然，这会将 T 限制为值类型。

（TBH 我宁愿看到语言中的元组支持并消除参数，就像 F# 一样。）

您可以简化代码，将 val 设置为 null 并消除 else 分支。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-17T21:24:58.227

我可以看到潜在的用处，但除了元素经常为空时对性能的轻微影响之外，为什么不用 try..catch 块围绕代码块来代替 NullReferenceException 呢？

# python - 检测脚本从命令提示符启动或在 Windows 上“双击”

> ID：558776
> 
> 赞同：8
> 
> 时间：2009-02-17T21:20:24.790
> 
> 标签：python, windows

是否可以检测 Python 脚本是从命令提示符启动还是通过用户“双击”Windows 文件资源管理器中的 .py 文件启动的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2013-01-18T08:05:45.597

如果从命令行运行，则定义了一个额外的环境变量“PROMPT”。

如果从资源管理器中单击此脚本将暂停，如果从命令行运行则不会暂停：

```
import os

print 'Hello, world!'

if not 'PROMPT' in os.environ:
    raw_input() 
```

使用 Python 2.7 在 Windows 7 上测试

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:26:13.013

命令提示符启动的脚本有一个名为的父进程`cmd.exe`（或一个不存在的进程，以防控制台同时关闭）。

双击启动的脚本应该有一个名为`explorer.exe`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-21T17:27:56.643

下面是一个如何获取当前运行脚本的父进程id和名称的例子。正如[Tomalak](https://stackoverflow.com/users/18771/tomalak)所建议的，这可用于检测脚本是从命令提示符启动还是通过在资源管理器中双击启动。

```
import win32pdh
import os

def getPIDInfo():
    """ 
    Return a dictionary with keys the PID of all running processes.
    The values are dictionaries with the following key-value pairs:
        - name: <Name of the process PID>
        - parent_id: <PID of this process parent>
    """

    # get the names and occurences of all running process names
    items, instances = win32pdh.EnumObjectItems(None, None, 'Process', win32pdh.PERF_DETAIL_WIZARD)
    instance_dict = {}
    for instance in instances:
        instance_dict[instance] = instance_dict.get(instance, 0) + 1

    # define the info to obtain 
    counter_items =  ['ID Process', 'Creating Process ID']

    # output dict
    pid_dict = {}

    # loop over each program (multiple instances might be running)
    for instance, max_instances in instance_dict.items():
        for inum in xrange(max_instances):
            # define the counters for the query 
            hq = win32pdh.OpenQuery()
            hcs = {}
            for item in counter_items:
                path = win32pdh.MakeCounterPath((None,'Process',instance, None,inum,item))
                hcs[item] = win32pdh.AddCounter(hq,path)
            win32pdh.CollectQueryData(hq)

            # store the values in a temporary dict
            hc_dict = {}
            for item, hc in hcs.items():
                type,val=win32pdh.GetFormattedCounterValue(hc,win32pdh.PDH_FMT_LONG)
                hc_dict[item] = val
                win32pdh.RemoveCounter(hc)
            win32pdh.CloseQuery(hq)

            # obtain the pid and ppid of the current instance
            # and store it in the output dict
            pid, ppid = (hc_dict[item] for item in counter_items) 
            pid_dict[pid] = {'name': instance, 'parent_id': ppid}

    return pid_dict

def getParentInfo(pid):
    """
    Returns a PID, Name tuple of the parent process for the argument pid process.
    """
    pid_info = getPIDInfo()
    ppid = pid_info[pid]['parent_id']
    return ppid, pid_info[ppid]['name']

if __name__ == "__main__":
    """
    Print the current PID and information of the parent process.
    """
    pid = os.getpid()
    ppid, ppname = getParentInfo(pid)

    print "This PID: %s. Parent PID: %s, Parent process name: %s" % (pid, ppid, ppname)
    dummy = raw_input() 
```

从命令提示符运行时，将输出：

> 此 PID：148。父 PID：4660，父进程名称：cmd

通过双击资源管理器启动时，此输出：

> 此 PID：1896。父 PID：3788，父进程名称：资源管理器

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T21:26:57.613

好问题。您可以做的一件事是在 Windows 中创建脚本的快捷方式，并传递参数（使用快捷方式的 Target 属性）来表示脚本是通过双击启动的（在本例中为快捷方式）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-08T17:03:50.460

我把这个小函数 (pybyebye()) 放在我的一些程序中的 return 语句之前。我已经在我的台式机和笔记本电脑上的 Windows 10 下对其进行了测试，它可以满足我的要求，即只有在文件资源管理器中双击程序启动程序时，它才会暂停等待用户输入。这可以防止临时命令窗口在用户说之前消失。在 Linux 下，它什么也不做。反正没坏处！在 Mac 上也是如此。

```
##  PYBYEBYE :
def pybyebye (eprompt="PROMPT",efps="FPS_BROWSER_"):
    "nice exit in Windows according to program launch from: IDLE, command, clix."

##  first examine environment (os & sys having been imported) :
ui = None
platform = sys.platform
##  print("os =",platform)
if not platform.lower().startswith("win"):
    return  ui  ##  only relevant in windows
fromidle = False
launched = "Launched from"
if sys.executable.endswith("pythonw.exe"):
    fromidle = True  ##  launched from within IDLE
envkeys = sorted(os.environ)
prompter = eprompt in envkeys
browser = False
for ek in envkeys:
    ##  print(ek)
    if ek.startswith(efps):
        browser = True
        break
##  next decide on launch context :
if fromidle and not prompter:  ##  surely IDLE
    ##  print(launched,"IDLE")
    pass  ##  screen won't disappear
elif browser and not prompter:  ##  run with double click
    ##  print(launched,"File Explorer")
    print("Press Enter to finish ....") ; ui=input()
elif prompter and not fromidle:  ##  run from preexisting command window
    ##  print(launched,"Command Window")
    pass  ##  screen won't disappear
else:  ##  something funny going on, Mac or Linux ??
    print("launch mode undetermined!")

return  ui 
```

# linux - 如何在 Linux 中为 GCC 添加默认包含路径？

> ID：558803
> 
> 赞同：331
> 
> 时间：2009-02-17T21:25:57.133
> 
> 标签：linux, gcc, include, environment-variables

除了通常的包含目录之外，我希望 gcc 包含文件`$HOME/include`，但似乎没有`$LD_LIBRARY_PATH`.

我知道我可以在编译时（或在 makefile 中）在命令行中添加包含目录，但我真的很喜欢这里的通用方法，就像在库案例中一样。

* * *

## 回答 #1

> 赞同：444
> 
> 时间：2009-02-17T21:31:18.180

尝试设置`C_INCLUDE_PATH`（对于 C 头文件）或`CPLUS_INCLUDE_PATH`（对于 C++ 头文件）。

正如 Ciro 提到`CPATH`的，将为 C 和 C++（以及任何其他语言）设置路径。

[GCC 文档](https://web.archive.org/web/20090129230009if_/http://www.network-theory.co.uk/docs/gccintro/gccintro_23.html)中的更多详细信息。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-02-17T21:31:54.980

使用您最喜欢的包含为 gcc 创建一个别名。

```
alias mygcc='gcc -I /whatever/' 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-10-06T17:22:12.787

gcc 规范文件可以完成这项工作，但是机器上的所有用户都会受到影响。

请参阅[HOWTO 使用 GCC 规范文件](https://web.archive.org/web/20200616193104/http://www.mingw.org/node/25)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2018-12-09T09:08:21.213

只是一个注释：`CPLUS_INCLUDE_PATH`并且`C_INCLUDE_PATH`不等同于`LD_LIBRARY_PATH`. `LD_LIBRARY_PATH`为`ld`（运行时的动态链接器）提供服务，而为 C/C++ 编译器提供库位置的前两者的等价物是`LIBRARY_PATH`.

# sql - 是否总是需要创建 Dim 表？

> ID：558818
> 
> 赞同：1
> 
> 时间：2009-02-17T21:30:57.497
> 
> 标签：sql, data-warehouse, multidimensional-array

我有一个事实表，其中有一列将保存两个值之一（占用/空置）。是否有必要为此创建一个 Dim 表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T12:12:53.990

如果您只需要案例计数，那么 Occupancy 是一个值为 0/1 而不是维度的度量，因此您将没有维度表。

如果你想，我不知道，按入住率和地区分析租金和税收，那么入住率是一个维度。同样，它应该存储为 0/1，因为在事实表中减小列宽是必要的。您的报告工具可能允许您将 0/1 的转换存储为元数据，但您最好使用维度表，因为这使您的数据仓库应用程序保持中立。

# windows-installer - MSI 对话框无法正确重绘

> ID：558824
> 
> 赞同：0
> 
> 时间：2009-02-17T21:33:24.043
> 
> 标签：windows-installer, dialog

我有一个用于验证安装密钥的 MSI 对话框。该对话框包含：

*   一个文本字段（供用户输入密钥）
*   一个标签（用于显示错误信息，例如密钥是否无效或过期）
*   一个按钮（“下一步”按钮）

当用户单击“下一步”按钮时，密钥被验证，如果它无效或过期，标签会更新为描述错误的文本。问题在于，如果使用多个不同的文本值更新标签（例如，用户输入了无效的密钥，然后输入了过期的密钥），则标签不会正确地重新绘制自己；看起来新文本打印在旧文本之上。有没有办法强制对话框（或只是标签）正确地重新绘制自己？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:43:15.700

我能够通过隐藏控件并重新显示它来解决这个问题。我添加了条件以在文本为空时隐藏控件并在文本不为空时显示它。在验证密钥之前，我将文本设置为空，然后，如果密钥未验证，我将文本设置为适当的文本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T21:48:02.580

不知道，但我们会弹出一个单独的错误对话框来显示问题，而不是更新现有标签。即时对话更新只是引起了太多麻烦，现在我考虑一下肯定会重新绘制问题。

# sql-server-2005 - 在 SQL Server 2005 上执行使用 VS2008 创建的 SSIS 包

> ID：558827
> 
> 赞同：3
> 
> 时间：2009-02-17T21:34:07.520
> 
> 标签：sql-server-2005, dts, ssis

也许是一个愚蠢的问题，但是......我使用 VS2008 Professional 创建了一个 SSIS 包。我想在运行 SQL Server 2005 的服务器上部署和执行它。当我尝试运行它时，我收到一条错误消息，指出`Execute Package Utility`服务器上的版本与我尝试执行的包的版本不同（有意义，因为我使用较新版本的 VS 创建了包）。

据我所知，Microsoft 不会简单地提供 EPU 的下载来“升级”它，那么如何在运行 SQL Server 以前版本的服务器上执行该包？我是否需要安装 SQL 2008 的“一次性”副本来更新包，还是什么？在我的工作站（有 VS2008）上，它在 SQL 2005 上运行良好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T16:30:55.527

不幸的是，你不能这样做。这是没有意义的，因为您可以针对不同的数据库运行 SSIS（如果您在甚至不使用 SQL Server 的服务器上运行一个包怎么办？）但是如果您在 BIDS 2008 中创建它，您将收到该版本错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T23:29:06.993

您可以尝试安装 SQL Server 2008 的 Express 版本，看看包含的 dtexec 是否可以工作。不幸的是，您尝试运行的配置不受支持，并且可能会导致错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-05T19:46:40.760

由于我即将开始同类型的项目，所以解决方案似乎是使用VS2005创建SSIS包，并进行部署。该包仍然可以通过我们的 VS2008 代码执行，但无法创建/部署到 2005。

为什么？！哦为什么！？:(

# html - Outlook 2007 消息中的“创建”按钮

> ID：558831
> 
> 赞同：0
> 
> 时间：2009-02-17T21:35:29.810
> 
> 标签：html, vba, outlook, outlook-2007

我正在尝试创建 Outlook 2007 消息并在消息中放置一个按钮。我相信这曾经是可能的。但是我读到这在 Outlook 2007 中可能不再可能。谁能证实这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T00:22:48.940

我猜你可以使用[OlkCommandButton VBA 对象](http://msdn.microsoft.com/en-us/library/bb177074.aspx)。该链接指向 MSDN 站点，其中包含有关在 Outlook 中通过 VBA 使用自定义表单的参考和其他有用信息。

# java - 数组作为适当的对象

> ID：558839
> 
> 赞同：2
> 
> 时间：2009-02-17T21:38:32.733
> 
> 标签：java, arrays, oop, java-7

我在这里写了一个页面，介绍使用数组作为具有自己的方法的适当对象，而不是依赖像 Arrays、Arrays 和 ArrayUtils 这样的辅助类。

```
ints.sort(); // instead of Arrays.sort(ints);
// instead of int[] onemore = ArrayUtils.add(ints, 8);
int[] onemore = ints.add(8); 
```

我确信我不是第一个有这个想法的人，但我很难找到以前写过这个想法的其他人。

任何人都可以帮助我提供有关此主题的一些参考资料吗？

如果您有关于为什么这是一个坏主意或一个好主意的参考，您可以添加评论吗？

**链接已删除。添加要点**

这源于 Project Coin 的想法

```
OVERVIEW
Provide a two sentence or shorter description of these five aspects of the feature:
FEATURE SUMMARY: Should be suitable as a summary in a language tutorial. 
```

将数组视为具有自己方法的对象，而不是传递给辅助方法的值。这导致更自然的编码并使方法更加直接。例如通过代码完成。

```
MAJOR ADVANTAGE: What makes the proposal a favorable change? 
```

它将面向对象编程引入数组，支持已经可用和编写的方法。

```
MAJOR BENEFIT: Why is the platform better if the proposal is adopted? 
```

数组的面向对象一致性。

```
MAJOR DISADVANTAGE: There is always a cost. 
```

必须有人编写并测试它。

```
ALTERNATIVES: Can the benefits and advantages be had some way without a language change? 
```

调用辅助方法。

```
EXAMPLES
Show us the code!
SIMPLE EXAMPLE: Show the simplest possible program utilizing the new feature.

int[] ints = {5,4,3,2,1};
ints.sort(); // instead of Arrays.sort(ints);
int pos = ints.indexOf(5); // instead of Arrays.asList(ints).indexOf(5); or ArraysUtils.indexOf(ints, 5);
ints.reverse(); // instead of Arrays.reverse(ints);
Array array = ints; // cast to super class.
int length = array.getLength(); // instead of Array.getLength(array);
Object n = array.get(3); // instead of Array.get(array, 3);
array.set(3, 7); // instead of Array.
Object obj = array;
System.out.println(obj); // prints [5,4,7,2,1] instead of having to if (obj instanceof int[]) System.out.println(Array.toString((int[]) obj)); else if (....) 
```

> 高级示例：显示功能的高级用法。

```
int[] ints = {5,4,3,2,1};
int[] ints2 = ints.copyOf(2);
int[] ints3 = ints.subArray(2,4);
ints.sort(myComparator);
List<Integer> list = ints.asList();
Set<Integer> set = ints.asSet();
long total = ints.sum();
double avg = int.average();
int max = ints.max();
int max2 = ints.max(myComparator);
http://commons.apache.org/lang/api/org/apache/commons/lang/ArrayUtils.html
int[] onemore = ints.add(8); // instead of ArrayUtils.add(ints, 8);
int[] moreInts = ints.addAll(ints2); // instead of ArraysUtils.addAll(ints, ints2);
int[] oneless = int.remove(3); // instead of ArrayUtils.remove(ints, 3);
Integer[] integers = int.toObject();
int[] intsAgain = integers.toPrimitive();

DETAILS
SPECIFICATION: Describe how the proposal affects the grammar, type system, and meaning of expressions and statements in the Java Programming Language as well as any other known impacts. 
```

需要将诸如 java.lang.Array 之类的类添加为所有数组的父级。可能还需要特定 int[]、boolean[] 的子类。语法不应该有很大的不同。

```
COMPILATION: How would the feature be compiled to class files? Show how the simple and advanced examples would be compiled. Compilation can be expressed as at least one of a desugaring to existing source constructs and a translation down to bytecode. If a new bytecode is used or the semantics of an existing bytecode are changed, describe those changes, including how they impact verification. Also discuss any new class file attributes that are introduced. Note that there are many downstream tools that consume class files and that they may to be updated to support the proposal! 
```

在提供了可以使用数组的新父级时，编译将与现在相同。但是，JVM 需要接受数组具有不同的超类。

```
TESTING: How can the feature be tested? 
```

检查新方法与辅助方法的作用相同。（如果他们确实只是调用相同的辅助方法，应该很简单）

```
LIBRARY SUPPORT: Are any supporting libraries needed for the feature? 
```

这应该添加到 rt.jar

```
REFLECTIVE APIS: Do any of the various and sundry reflection APIs need to be updated? This list of reflective APIs includes but is not limited to core reflection (java.lang.Class and java.lang.reflect.*), javax.lang.model.*, the doclet API, and JPDA. 
```

数组的超类需要返回 java.lang.Array 等而不是 java.lang.Object。但是，这可能是 JVM 而不是 rt.jar 代码的更改。

```
OTHER CHANGES: Do any other parts of the platform need be updated too? Possibilities include but are not limited to JNI, serialization, and output of the javadoc tool. 
```

更改应反映在 javadoc 中。

```
MIGRATION: Sketch how a code base could be converted, manually or automatically, to use the new feature. 
```

将对 Arrays.xxx(array, args) 的调用替换为 array.xxx(args);

```
COMPATIBILITY
BREAKING CHANGES: Are any previously valid programs now invalid? If so, list one. 
```

如果采用每种方法，对 hashCode() 和 equals() 的调用将被更改。这可能是不可接受的，在这种情况下，这些方法可以保持原样，而不是调用 Arrays.hashCode() 或 Arrays.equals();

```
EXISTING PROGRAMS: How do source and class files of earlier platform versions interact with the feature? Can any new overloadings occur? Can any new overriding occur? 
```

不。

```
REFERENCES
EXISTING BUGS: Please include a list of any existing Sun bug ids related to this proposal. 
```

*这就是我正在寻求帮助、错误报告或其他参考的内容*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T21:43:26.577

我建议您改为查看各种集合类。

# mysql - 为什么全文搜索字符串“FDR”在 MySQL 中没有结果？

> ID：558841
> 
> 赞同：3
> 
> 时间：2009-02-17T21:38:41.020
> 
> 标签：mysql, search, full-text-search

我正在尝试基于全文搜索对用户进行搜索。

SELECT * FROM users WHERE MATCH (name) AGAINST ('FDR' IN BOOLEAN MODE);

但是，查询不会产生任何结果。我可以用其他字符串替换搜索值并产生结果。

我什至尝试使用空停用词列表但没有成功。问题似乎与这个特定的字符串有关。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T21:48:41.370

来自[dev.mysql.com/doc/refman/5.1/en/fulltext-fine-tuning.html](http://dev.mysql.com/doc/refman/5.1/en/fulltext-fine-tuning.html)

> 默认最小值为四个字符；默认最大值取决于版本。如果更改任一值，则必须重建 FULLTEXT 索引。
> 
> 要索引的单词的最小和最大长度由 ft_min_word_len 和 ft_max_word_len 系统变量定义。

另请参阅[服务器系统变量](http://dev.mysql.com/doc/refman/5.1/en/server-system-variables.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T21:45:08.147

如果[这篇文章](http://www.databasejournal.com/features/mysql/article.php/1578331/Using-Fulltext-Indexes-in-MySQL---Part-1.htm)仍然有效，那是因为 MySQL 全文索引没有索引长度为 <= 3 个字符的词。

# mysql - INNODB 级联语法/逻辑问题

> ID：558847
> 
> 赞同：-1
> 
> 时间：2009-02-17T21:41:13.710
> 
> 标签：mysql, innodb, mysql-error-1005

我正在创建的 SQL 数据库有问题。我正在尝试将其切换为使用 INNODB，但我似乎无法获得正确的级联语法（或可能的逻辑）。

这是[代码错误的一部分](http://pastebin.com/m7216314f)。它不喜欢第 40 行。

以通常的神秘（至少对我而言）形式的错误输出：

```
ERROR 1005 (HY000) at line 36: Can't create table './school/staff.frm' (errno: 150) 
```

编辑：

如果有帮助，这是我尝试输入的[整个 SQL 文件。](http://pastebin.com/m45174ae7)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T22:04:05.233

外键必须是索引。（**角色名称**）

试试这个：

```
CREATE TABLE IF NOT EXISTS `role` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` char(30) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `name` (`name`)
) ENGINE=InnoDB; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T00:01:05.233

您的意思是“角色”列的外键约束使用名称而不是 ID？它看起来像以下行（第 43 行）：

```
FOREIGN KEY (role) REFERENCES role(name) 
```

应该：

```
FOREIGN KEY (role) REFERENCES role(id) 
```

这执行没有错误。

或者，“staff.role”列的数据类型（第 40 行，角色 INT NOT NULL）可以更改为 CHAR(30) NOT NULL。

# c++ - 我可以在多核 x86 CPU 上强制缓存一致性吗？

> ID：558848
> 
> 赞同：38
> 
> 时间：2009-02-17T21:42:21.587
> 
> 标签：c++, multithreading, x86, multicore, cpu-cache

另一周，我写了一个小线程类和一个单向消息管道来允许线程之间的通信（显然，每个线程有两个管道，用于双向通信）。在我的 Athlon 64 X2 上一切正常，但我想知道如果两个线程都在查看同一个变量并且每个内核上该变量的本地缓存值不同步，我是否会遇到任何问题。

我知道*volatile*关键字会强制变量从内存中刷新，但是多核 x86 处理器有没有办法强制所有内核的缓存同步？这是我需要担心的事情吗，或者轻量级锁定机制的*volatile*和正确使用（我使用 _InterlockedExchange 设置我的 volatile 管道变量）会处理我想为多核 x86 CPU 编写“无锁”代码的所有情况？

我已经知道并使用了关键部分、互斥体、事件等。我主要想知道是否有 x86 内在函数我不知道哪种力或可用于强制缓存一致性。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-17T21:58:05.247

`volatile`仅强制您的代码重新读取该值，它无法控制从何处读取该值。如果您的代码最近读取了该值，那么它可能会在缓存中，在这种情况下，volatile 将强制它从缓存中重新读取，而不是从内存中读取。

x86 中没有很多缓存一致性指令。有类似的预取指令[`prefetchnta`](http://www.felixcloutier.com/x86/PREFETCHh.html)，但这不会影响内存排序语义。它过去是通过在不污染 L2 的情况下为 L1 缓存带来价值来实现的，但是对于具有大型共享*包容性*L3 缓存的现代英特尔设计来说，事情变得更加复杂。

x86 CPU 使用[MESI 协议](https://en.wikipedia.org/wiki/MESI_protocol)的变体（英特尔的 MESIF，AMD 的 MOESI）来保持它们的缓存彼此一致（包括不同内核的私有 L1 缓存）。想要写入高速缓存行的核心必须强制其他核心使其副本无效，然后才能将自己的副本从共享状态更改为修改状态。

* * *

您不需要任何栅栏指令（如 MFENCE）来在一个线程中生成数据并在 x86 上的另一个线程中使用它，因为 x86 加载/存储具有内置的[获取/释放语义。](http://preshing.com/20120913/acquire-and-release-semantics/)您确实需要 MFENCE （完全障碍）来获得顺序一致性。（此答案的先前版本建议`clflush`需要，这是不正确的）。

您确实需要防止[编译时重新排序](http://preshing.com/20120625/memory-ordering-at-compile-time/)，因为 C++ 的内存模型是弱排序的。 `volatile`是一种旧的、不好的方法；C++11 std::atomic 是编写无锁代码的更好方法。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-17T22:06:09.550

由于 x86 处理器采用 MESI 协议，内核之间的缓存一致性得到了保证。在处理可能在数据仍位于内核缓存上时访问内存的外部硬件时，您只需要担心内存一致性。不过，这里看起来不像是您的情况，因为文本表明您正在用户空间中编程。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-17T21:54:47.733

您无需担心缓存一致性。硬件会解决这个问题。您可能需要担心的是由于缓存一致性导致的性能问题。

如果 core#1 写入一个变量，这会使其他核心中缓存行的所有其他副本无效（因为它必须在提交存储之前获得缓存行的[独占所有权）。](https://en.wikipedia.org/wiki/MESI_protocol)当 core#2 读取相同的变量时，它将在缓存中丢失（除非 core#1 已经将其写回缓存的共享级别）。

由于必须从内存中读取整个缓存行（64 字节）（或写回共享缓存，然后由 core#2 读取），因此会产生一些性能成本。在这种情况下，这是不可避免的。这是期望的行为。

* * *

问题是，当您在同一高速缓存行中有多个变量时，即使内核在同一高速缓存行中读取/写入不同的变量，处理器也可能会花费额外的时间来保持高速缓存同步。

通过确保这些变量不在同一个高速缓存行中，可以避免这种成本。这种效果称为*错误共享*，因为您正在强制处理器同步线程之间实际上未共享的对象的值。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-17T21:51:30.707

挥发性不会这样做。在 C++ 中，volatile 只影响编译器优化，例如将变量存储在寄存器而不是内存中，或者完全删除它。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-17T21:54:52.290

您没有指定您使用的是哪个编译器，但如果您使用的是 Windows，请在[此处查看这篇文章](http://msdn.microsoft.com/en-us/library/ms686355(VS.85).aspx)。还可以在此处查看可用的[同步功能](http://msdn.microsoft.com/en-us/library/ms686360(VS.85).aspx)。您可能要注意，通常`volatile`不足以做您希望它做的事情，但在 VC 2005 和 2008 下，添加了非标准语义，在读写周围添加了隐含的内存屏障。

如果你想让东西便携，你将面临更加艰难的道路。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-18T13:30:52.510

这里有一系列解释现代内存架构的文章[，](http://duartes.org/gustavo/blog/category/software-illustrated)包括[Intel Core2 缓存](http://duartes.org/gustavo/blog/post/intel-cpu-caches)和更多现代架构主题。

文章可读性很强，插图也很好。享受 ！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-13T20:52:40.173

您的问题中有几个子问题，因此我会尽我所能回答。

1.  目前没有在 C++ 中实现无锁交互的可移植方式。C++0x 提案通过引入原子库解决了这个问题。
2.  Volatile 不能保证在多核上提供原子性，并且它的实现是特定于供应商的。
3.  在 x86 上，您不需要做任何特别的事情，除了将共享变量声明为 volatile 以防止某些可能破坏多线程代码的编译器优化。Volatile 告诉编译器不要缓存值。
4.  有一些算法（例如 Dekker）即使在带有 volatile 变量的 x86 上也无法工作。
5.  除非您确定在线程之间传递对数据的访问是程序中的主要性能瓶颈，否则请远离无锁解决方案。使用按值或锁传递数据。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-22T02:18:17.910

以下是一篇关于使用`volatile`带线程程序的好文章。

[易失性对于多线程编程几乎没用](http://software.intel.com/en-us/blogs/2007/11/30/volatile-almost-useless-for-multi-threaded-programming/)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-17T21:59:31.920

Herb Sutter 似乎只是[建议](http://www.ddj.com/cpp/211601363)任何两个变量都应该驻留在不同的缓存行上。他在他的并发队列中执行此操作，并在他的锁和节点指针之间进行填充。

编辑：如果您使用的是 Intel 编译器或 GCC，则可以使用[atomic builtins](http://gcc.gnu.org/onlinedocs/gcc-4.1.1/gcc/Atomic-Builtins.html)，这似乎会尽可能地抢占缓存。

# c# - 在 C# 中清理永久线程的正确方法

> ID：558853
> 
> 赞同：3
> 
> 时间：2009-02-17T21:43:35.610
> 
> 标签：c#, multithreading, termination

我有一个对象，一个时间线，它封装了一个线程。可以在时间线上安排活动；线程将等到执行任何事件的时间，执行它，然后返回睡眠（对于（a）到达下一个事件所需的时间，或者（b）如果没有更多事件，则无限期地）。

睡眠由 WaitEventHandle 处理，当事件列表改变（因为可能需要调整睡眠延迟）或应该停止线程（因此线程可以优雅地终止）时触发。

析构函数调用 Stop()，我什至实现了 IDisposable，Dispose() 也调用了 Stop()。

尽管如此，当我在表单应用程序中使用这个组件时，当我关闭表单时，我的应用程序永远不会正确关闭。出于某种原因，Stop() 永远不会被调用，因此*在*.NET 决定等待所有线程完成之前，我的对象的析构函数都不会触发，也不会调用 Dispose() 方法。

我想解决方案是我自己在 FormClose 事件上显式调用 Dispose()，但是由于这个类将在一个库中，*而且*它实际上是更深的一层（也就是说，应用程序开发人员永远不会真正看到时间轴类），这看起来很丑陋，对于应用程序开发人员来说是一个额外的（不必要的）陷阱。我通常在资源释放成为问题时使用的 using() 子句不适用，因为这将是一个长期存在的对象。

一方面，我可以理解 .NET 在进行最后一轮垃圾回收之前会希望等待所有线程完成，但在这种情况下会产生非常笨拙的情况。

如何在不向我的库的使用者添加要求的情况下正确地清理我的线程？换句话说，如何让 .NET 在应用程序退出时通知我的对象，但在它等待所有线程完成之前？

* * *

编辑：回应人们说客户端程序可以知道线程是可以的：我恭敬地不同意。

正如我在原始帖子中所说，线程隐藏在另一个对象（动画师）中。我为另一个对象实例化了一个 Animator，并告诉它执行动画，例如“使此灯闪烁 800 毫秒”。

作为 Animator 对象的使用者，我不关心 Animator 如何确保灯光闪烁 800 毫秒。它会启动一个线程吗？我不在乎。它是否创建一个隐藏窗口并使用系统计时器（ew）？我不在乎。它会雇用侏儒来打开和关闭我的灯吗？我不在乎。

而且我*特别*不想关心如果我创建了一个 Animator，我必须跟踪它并在我的程序退出时调用一个特殊的方法，这与其他所有对象不同。这应该是图书馆实现者的关注点，而不是图书馆消费者的关注点。

* * *

编辑：代码实际上足够短，可以显示。我将它包括在内以供参考，*没有*将事件添加到列表的方法：

```
internal class Timeline : IDisposable {
    private Thread eventThread;
    private volatile bool active;
    private SortedList<DateTime, MethodInvoker> events = new SortedList<DateTime,MethodInvoker>();
    private EventWaitHandle wakeup = new EventWaitHandle(false, EventResetMode.AutoReset);

    internal Timeline() {
        active = true;
        eventThread = new Thread(executeEvents);
        eventThread.Start();
    }

    ~Timeline() {
        Dispose();
    }

    private DateTime NextEvent {
        get {
            lock(events) 
                return events.Keys[0];
        }
    }

    private void executeEvents() {
        while (active) {
            // Process all events that are due
            while (events.Count > 0 && NextEvent <= DateTime.Now) {
                lock(events) {
                    events.Values[0]();
                    events.RemoveAt(0);
                }
            }

            // Wait for the next event, or until one is scheduled
            if (events.Count > 0)
                wakeup.WaitOne((int)(NextEvent - DateTime.Now).TotalMilliseconds);
            else
                wakeup.WaitOne();
        }
    }

    internal void Stop() {
        active = false;
        wakeup.Set();
    }

    public void Dispose() {
        Stop();
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T21:55:10.870

也许将 T [thread.IsBackground](http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx)属性设置为 true？

```
eventThread = new Thread(executeEvents);
eventThread.IsBackground = true;
eventThread.Start(); 
```

另一种选择是使用[中断](http://msdn.microsoft.com/en-us/library/system.threading.thread.interrupt.aspx)方法将其唤醒。只要确保你`ThreadInterruptedException`在你正在中断的线程中捕捉到，并且当它发生时它会关闭。

```
active = false;
eventThread.Interrupt();
try { eventThread.Join(); }   // Wait for graceful shutdown
catch (Exception) { } 
```

不太确定你的那个`EventWaitHandle`是如何工作的......当我做过一次类似的事情时，我只是使用了常规`Thread.Sleep`=）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:50:30.397

我认为要求客户端 Stop() 关闭线程完全不是不合理的。有一些方法可以创建线程，这些线程的继续执行不会阻止应用程序退出（尽管我没有想到细节）。但是期望启动和终止一个工作线程对客户端来说并没有太大的负担。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T21:53:37.160

如果没有客户的合作，就无法让 .NET 通知您的线程。如果您将库设计为具有长时间运行的后台线程，则必须将客户端应用程序设计为了解它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T22:27:30.807

[Application::ApplicationExit](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.applicationexit.aspx)是一个静态事件，是否可以接受监听并进行特殊清理工作？

实现 IDisposable 应该足以表明您的客户应该在“使用”块中使用您的类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T23:33:23.567

[正确](http://msdn.microsoft.com/en-us/library/b1yfkh5e.aspx)实现 IDisposable ，包括实现调用 Dispose(true) 的终结器。然后，您的 Animator 对象可以进行任何它希望进行的清理，包括在必要时停止线程。

# sql-server - 为具有多个可选条件的搜索屏幕编码存储过程

> ID：558858
> 
> 赞同：1
> 
> 时间：2009-02-17T21:44:57.370
> 
> 标签：sql-server, stored-procedures, parameters, optional

我有一个搜索屏幕，用户可以在其中指定名字、姓氏、学期或课程的任意组合。我不确定如何以最佳方式对 SQL Server 2005 存储过程进行编码以处理这些潜在的可选参数。最有效的方法是什么？每个组合的单独程序？将项目作为可为空的参数并构建动态 SQL？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T21:54:59.060

我将每个参数设置为可选（默认值为空）

然后在*WHERE* ....

```
FirstName=ISNULL(@FirstName,FirstName)
AND
LastName=ISNULL(@LastName,LastName)
AND
SemesterID=ISNULL(@SemesterID,SemesterID) 
```

那将只处理名字，只有姓氏，所有三个等等，等等。

它也比动态构建 SQL 字符串并执行它更漂亮/易于管理/健壮得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T23:05:16.333

最好的解决方案是利用 sp_execute_sql。例如：

```
--BEGIN SQL
declare @sql nvarchar(4000)

set @sql = 
'select * from weblogs.dbo.vwlogs 
where Log_time between @BeginDate and @EndDate'
+ case when @UserName is null then '' else 'and client_user = @UserName' end

sp_execute_sql
@sql
, @params = '@UserName varchar(50)'
, @UserName = @UserName
--END SQL 
```

正如 muerte 所提到的，与 exec() 类似的语句相比，这将具有性能优势。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:49:43.457

我会使用**sp_executesql**来执行此操作，因为该计划将仅针对第一个模式或第一组条件进行缓存。

看看这篇[TechNet 文章](http://technet.microsoft.com/en-us/library/ms188001.aspx)：

*当语句的参数值更改是唯一的变化时，可以使用 sp_executesql 代替存储过程多次执行 Transact-SQL 语句。因为 Transact-SQL 语句本身保持不变并且只有参数值发生变化，所以 SQL Server 查询优化器可能会重用它为第一次执行生成的执行计划。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T22:01:20.170

刚刚发布了与 Kevin Fairchild 相同的概念，这就是我们通常处理它的方式。

您可以在代码中执行动态 sql 以根据需要创建语句，但如果是这样，您需要注意 sql 注入。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T22:07:16.783

正如 muerte 指出的那样，计划将为第一组参数缓存。当它每次使用备用参数运行时，这可能会导致性能下降。要解决这个问题，请在过程中使用 WITH RECOMPILE 选项。

# vba - 如何将函数的结果返回到 Excel 中的单元格？

> ID：558860
> 
> 赞同：3
> 
> 时间：2009-02-17T21:46:37.037
> 
> 标签：vba, excel

假设我有一个附加到我的 Excel 工作表的函数：

```
Public Function foo(bar As Integer) as integer
    foo = 42
End Function 
```

如何获得`foo`返回到工作表单元格的结果？我试过`"=foo(10)"`了，但它给我的只是`"#NAME?"`

我也试过`=[filename]!foo(10) and [sheetname]!foo(10)`没有改变。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T22:11:32.017

尝试按照[此处](http://web.archive.org/web/20090220142331/http://exceltip.com/st/Writing_Your_First_VBA_Function_in_Excel/631.html)的说明进行操作，以确保您正确执行所有操作，尤其是放置位置。( `Insert->Module`)

我可以确认打开 VBA 编辑器，使用`Insert->Module`和以下代码：

```
Function TimesTwo(Value As Integer)
    TimesTwo = Value * 2
End Function 
```

并在一张纸上放入`"=TimesTwo(100)"`一个单元格给了我`200`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:53:37.393

将该函数放入一个新的单独模块（插入->模块）中，然后在单元格公式中使用 =foo(10) 来调用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T22:22:02.710

你把“foo”函数放在哪里了？我不知道为什么，但每当我看到这个时，解决方案就是记录一个凹坑宏，并让 Excel 为该宏的代码创建一个新模块。然后，将您的“foo”函数放入该模块中。当我遵循此过程时，您的代码可以工作，但如果我将它放在附加到“ThisWorkbook”的代码模块中，我会得到您报告的#NAME 结果。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-17T21:50:18.183

包括这样的文件名

```
=PERSONAL.XLS!foo(10) 
```

# asp.net - 为什么我的 asp.net 缓存会引发异常？

> ID：558864
> 
> 赞同：3
> 
> 时间：2009-02-17T21:48:07.890
> 
> 标签：asp.net, caching, content-expiration

我在我的 asp.net 应用程序中缓存了一堆简单的查找表，因为源数据位于与我们的主要 Web 架构不同的服务器上，并且很少更改。我一直在这里关注答案和各种文档，并且我的初始加载函数调用如下：

```
HttpContext.Current.Cache.Insert("CheckLocations", GetAllCheckLocations(), _
                                 Nothing, DateAdd(DateInterval.Day, 1, Now()), _
                                 System.Web.Caching.Cache.NoSlidingExpiration, _
                                 CacheItemPriority.Normal, _
                                 New CacheItemRemovedCallback(AddressOf CheckLocationsExpired)) 
```

对于我的缓存过期回调，我有以下代码。

```
Public Shared Sub CheckLocationsExpired(ByVal key As String, ByVal value As Object, ByVal reason As CacheItemRemovedReason)

   Dim dtCheckLocation As New ReferenceSchema.CheckLocationDataTable
   dtCheckLocation = GetAllCheckLocations()

   HttpContext.Current.Cache.Insert("CheckLocations", dtCheckLocation, Nothing, _
                                    DateAdd(DateInterval.Day, 1, Now()), _
                                    System.Web.Caching.Cache.NoSlidingExpiration, _
                                    CacheItemPriority.Normal, _
                                    New CacheItemRemovedCallback(AddressOf CheckLocationsExpired))

End Sub 
```

作为记录，GetAllCheckLocations 方法只是调用 Web 服务并将结果解析到正在存储的数据表中。

现在，当我重新编译应用程序以进行本地测试时，一切仍然正常，但我在日志文件中发现以下异常消息：

> System.NullReferenceException：对象引用未设置为对象的实例。在 C:\Projects\HR\EAF 2.0\DAL\CacheMethods.vb 中的 EAF.CacheMethods.CheckLocationsExpired（字符串键，对象值，CacheItemRemovedReason 原因）：System.Web.Caching.CacheEntry.CallCacheItemRemovedCallback（CacheItemRemovedCallback 回调，CacheItemRemovedReason）的第 434 行原因）

我验证数据确实存在并且是最新的，当我单步调试调试器时，命令参数中的任何内容似乎都不合适。

有人知道我在这里想念什么吗？这是像 Reponse.Redirect 问题这样的“细微差别”中的另一个，在技术上终止处理会引发线程中止异常？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T22:35:33.813

您可能想改用[HttpRuntime.Cache](http://msdn.microsoft.com/en-us/library/system.web.httpruntime.cache.aspx)。如果您从单元测试等中调用 HttpContext.Current ，则它可能为 null 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T21:59:08.787

当你不给它一个回调函数时它仍然异常吗？似乎委托函数在空对象方面存在问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:55:12.930

我最初的想法是 GetAllCheckLocations 正在抛出异常或返回 null。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T07:21:15.183

也许你用`AJAXPro`什么来调用方法。

# c# - .NET 中的 XPath 选择节点

> ID：558870
> 
> 赞同：18
> 
> 时间：2009-02-17T21:49:30.837
> 
> 标签：c#, xml, xpath

```
<Document>
  <A> 
    <B> 
      <C></C>
    </B>
  </A>
  <E>
   <F>
    <C></C>
   </F>
   <G>
    <C></C>
  </G>
 </E>
</Document> 
```

如果我将上述 XML 加载到 XmlDocument 中并使用 XPath 查询在 A 上执行 SelectSingleNode //C

```
XmlNode oNode = oDocument.SelectSingleNode("E");
XmlNodeList oNodeList = oNode.SelectNodes("//C");

```

为什么它会从 B 下返回节点，而我期望它只从 E 下返回节点

有道理？

编辑：我如何让它只从该节点返回？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-17T21:55:06.860

简单地说：前导 // 表示与所选节点在同一*文档中的“任何级别”。*

从[规格](http://www.w3.org/TR/xpath)：

*   //para 选择文档根的所有 para 后代，从而选择与上下文节点在同一文档中的所有 para 元素
*   .//para 选择上下文节点的para元素后代

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-17T21:56:11.880

指定`.//C`将实现您想要的，否则，XPath 从文档根而不是当前节点开始。

混淆在于[XPath 标准](http://www.w3.org/TR/xpath#path-abbrev)`//`的定义如下：

> // 是 /descendant-or-self::node()/ 的缩写。例如，//para 是 /descendant-or-self::node()/child::para 的缩写，因此将选择文档中的任何 para 元素（即使是文档元素的 para 元素也会被 / /para 因为文档元素节点是根节点的子节点）；div//para 是 div/descendant-or-self::node()/child::para 的缩写，因此将选择 div 子项的所有 para 后代。

因为它是从文档级别开始的`//`缩写，除非您在开始时指定一个节点。`/descendant-or-self::node()/`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-17T21:58:00.817

`//C`是整个文档中的所有C节点

`/E//C`将只有 E 下的 C 个节点

`/C`将只是根 C 节点

请参阅[xpath 语法参考](http://www.w3schools.com/XPath/xpath_syntax.asp)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T21:58:11.830

在[XPATH 规范](http://www.w3.org/TR/xpath#axes)中，您将在 2.5 下找到以下语句：

> //para 选择文档根的所有 para 后代，从而选择与上下文节点在同一文档中的所有 para 元素

即您观察到的行为是有效的。你应该做类似“/E//C”的事情

# css - 在整个 ASP.NET 应用程序中将 CSS 定义打乱到人类不可读状态的最佳方法

> ID：558877
> 
> 赞同：1
> 
> 时间：2009-02-17T21:51:44.530
> 
> 标签：css, security, scramble, security-by-obscurity

我不确定它是否会通过删除长词名称来节省流量，但我肯定想隐藏我的命名、声明及其组织系统。

问题是手动查找和替换将花费很长时间，并且每个细微的修改都可能需要部分或全部重做该过程。

有没有人想过这个问题？也许写一个宏？它是否足够智能，能够发现 CSS 文件中的名称？有没有更好更简单的存在？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T21:55:51.663

你不能让它“不可读”，但你可以通过使用[CSS 优化器之类的东西来节省一些空间](http://www.cssoptimiser.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T22:04:17.523

你可能想试试 YUI Compressor：

[http://developer.yahoo.com/yui/compressor/](http://developer.yahoo.com/yui/compressor/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T21:58:15.497

首先，我认为我根本不会这样做，通过降低可读性可以获得什么？

但是，如果必须这样做，为什么不制作一个自定义解析器，将您的“开发”名称转换为“生产”名称，反之亦然？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T22:05:39.300

使用[Perl](http://perl.org)。一个[简单的 perl 脚本](http://joseph.randomnetworks.com/archives/2005/08/18/perl-oneliner-recursive-search-and-replace/)可以递归地搜索所有文件，并将您指定的任何内容替换为其他内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T22:12:46.070

使用 CSS 压缩器。它会让它真的很难阅读，但不可能让它完全不可读。这是来自[CSS Drive](http://www.cssdrive.com/index.php/main/csscompressor/)的一个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T15:36:42.690

正如其他人所说，您可以使名称更短或更没有意义，但基本上不可能达到*人类无法阅读的状态。*

无论您如何重命名或扭曲 css，它仍然必须具有适当的属性，并且 html 必须引用命名的类和/或 id。此外，诸如 firebug 之类的工具将始终将用户指向正在使用的 css，我认为这会破坏您的意图。

它还破坏了在 html 中使用语义上有意义的标签的目的。

# apache - Apache 将空白子域重定向到另一个子域的最佳方法是什么？

> ID：558885
> 
> 赞同：1
> 
> 时间：2009-02-17T21:54:15.257
> 
> 标签：apache, url, redirect, dns, subdomain

我希望[将对 http://example.com/](http://example.com/) * 的任何请求重定向到[http://www.example.com/](http://www.example.com/) *。

其中 * 是任意路径。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T21:54:34.240

使用 Apache 的[mod_alias](http://httpd.apache.org/docs/1.3/mod/mod_alias.html)模块进行永久重定向，例如：

```
RedirectPermanent / "http://www.example.com/" 
```

将重定向放在空白子域的虚拟主机块或根级`.htaccess`文件中。

“ [http://www.example.com/](http://www.example.com/) ”后面的 / 是至关重要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T22:06:28.783

我将在此处添加另一个选项，该选项也用于允许其他特定主机。例如，如果除了 www.example.com 站点之外，您还想要一个 dev.example.com 和 blog.example.com 站点，请将其放在根级别的 .htaccess 文件中：

```
RewriteCond %{HTTP_HOST} .
RewriteCond %{HTTP_HOST} !^www\.example\.com
RewriteCond %{HTTP_HOST} !^dev\.example\.com
RewriteCond %{HTTP_HOST} !^blog\.example\.com
RewriteRule (.*) http://www.example.com/$1 [R=301,L,QSA] 
```

# javascript - 如何通过 Javascript 监控用户点击链接？

> ID：558912
> 
> 赞同：3
> 
> 时间：2009-02-17T22:01:22.447
> 
> 标签：javascript, html, ajax

我的任务是确定是否可以使用 javascript 检测链接点击。

我知道 onclick 属性，它让我成为了其中的一部分。除此之外，我不知道最好的方法是什么。我已经告诉我的老板，它可能会涉及某种形式的 ajax，这可能涉及一个大库，这是不可接受的。

有没有其他方法可以使用ajax，或者无论如何使用不会增加很多时间的ajax？

编辑：他希望能够知道用户使用网站主页上的链接的次数。不幸的是，我们不能做一个漂亮的服务器端解决方案，因为网站上几乎所有的页面都是纯 html 。我很想将所有页面转换为 php 或其他替代方法，并只记下 HTTP_REFERRER 数据，但目前还不可能。

我们已经在使用谷歌分析；它不记录推荐人数据。

再次编辑：事实证明，我的老板没有看到覆盖，我假设他点击了所有选项卡。经过我的调查，最初他们都报告零点击，但我发现我们有旧版本的谷歌分析信息。快速升级到新的热点，问题就解决了。

感谢所有的回复。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T22:35:53.080

实际上，谷歌分析确实跟踪这些数据。如果您转到报告的“*内容概览*”页面，则有一个**站点叠加**链接。这将显示您的网站与页面上每个链接的点击次数重叠。

[网站覆盖示例 http://okay-plus.com/dropbox/img/site_overlay.jpg](http://okay-plus.com/dropbox/img/site_overlay.jpg)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T22:03:50.880

如果这是为了收集有关网站使用情况的数据，您是否考虑过[Google Analytics](http://www.google.com/analytics/)？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T22:03:55.107

jQuery.min.js 大小为 30k 或以下。那不是很大。

为什么你的老板还是要监控链接点击？如果是您自己网站上的 URL，那么您应该能够从访问日志或 Google Analytics（或该信息的一些更有用的变体）中获取该信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T22:11:46.510

不会讨论这是否是一个好主意，但这里有一些代码可以满足您的标题要求。

正如您自己所说，onclick 事件是一种方法。您需要创建一个循环遍历 a 标签并向它们分配 onclick 事件的脚本。像这样的东西：

```
<script type="text/javascript">
window.onload = function() {
  var a = document.getElementsByTagName("a");
  for(var i=0; i < a.length; i++ ){
    a[i].onclick = function() { alert("link clicked"); };
  }
}
</script> 
```

如果您想告诉服务器有关点击的信息，您需要一个 AJAX 调用而不是警报 :) 该片段进入 head 部分才能工作。

另一种解决方法是监听一般的 window.onclick 事件并跟踪被点击的对象，如果它是一个标签，你可以执行你想要的任何代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T22:12:19.440

出于某种原因，如果您无法使用谷歌分析，请尝试处理 window.onclick 事件，然后您可以从事件对象中读取 src 元素。这将告诉您触发点击事件的对象。（我相信键盘和鼠标都会触发点击。

仅为 IE 编写的示例代码。如果需要其他浏览器，可能需要修改代码

```
document.onclick = function()
{
    alert(window.event.srcElement.id);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T22:12:22.000

如果您最终使用 jQuery（正如这里的一位海报所推荐的那样），您可以相当容易地拦截所有链接。例如，如果您想计算每个链接被点击的次数（按 id 索引），您可以编写如下代码：

```
var clickCount = [];
$('a').click(function() { clickCount[$(this).attr("id")]++; return true; }); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T23:03:52.920

除了 Google Analytics，您可能还希望查看[ClickTale](http://www.clicktale.com/)。它提供了站点覆盖以及谷歌没有的许多功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-25T18:06:37.063

顺便说一句，您还可以标记您的外部链接并让 GA 跟踪它们：

"[如何手动跟踪出站链接的点击次数？](http://www.google.com/support/googleanalytics/bin/answer.py?answer=55527&topic=11006) "

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-04-09T21:25:40.040

您可能想要查看的另一个很棒的工具是[http://mouseflow.com](http://mouseflow.com)。鼠标跟踪、视频播放和热图。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-02-19T11:17:21.770

在 RXJS 中：

```
 import { fromEvent } from 'rxjs';

        const source = fromEvent(document, 'click').pipe(
            filter(value => (value as any).toElement.localName === 'a'),
            map(value => (value as any).toElement)
        ).subscribe(value => {
            track('Clicked Outbound Link', {link: value.href})
        }) 
```

# javascript - Javascript：IF 块或 TRY/CATCH 哪个更有效？

> ID：558914
> 
> 赞同：19
> 
> 时间：2009-02-17T22:02:59.523
> 
> 标签：javascript, try-catch

我喜欢关于这段代码更有效的一些其他意见。基本上在下面的代码中，有一个 setInterval 循环，在代码在循环中运行之前，我需要满足 4 个要求。所以在 v.1 中我写了一个 if 语句检查所有 4。工作正常。

然后我切换到只使用 try/catch，而我想要执行的代码位于 try{} 中。逻辑是在每个循环期间，都会生成一个异常，但会为每个无效条件抑制。在所有条件都为真的最后一个循环中，代码执行并清除间隔。

要么工作。我喜欢 try/catch 方法，因为我需要编写的条件代码更少并且担心会破坏。但我担心 try/catch 效率很低，尤其是在 setInterval() 循环达到 100 毫秒时。其他聪明人对 SO 有什么看法？

**试着抓**

```
var intvar = setInterval(function(){
try{    
    clearInterval(intvar);

    jQuery('#'+nav[pageid].t1+'>a').replaceWith(jQuery('<span>'+jQuery('#'+nav[pageid].t1+'>a').text()+'</span>'));

    //set display classes for nav
    jQuery('#'+nav[pageid].t1).addClass('selected').find('#'+nav[pageid].t2).addClass('subselect'); //topnav
    jQuery('#'+nav[pageid].t3).addClass('selected').find('#'+nav[pageid].t4).addClass('subselect'); //leftnav
}catch(err){}
},100); 
```

**中频块**

```
var intvar = setInterval(function(){

if(typeof jQuery == 'function' && typeof nav == 'object' && typeof pageid != 'undefined' && typeof document.getElementById('leftnav') == 'object'){
    clearInterval(intvar);
    jQuery('#'+nav[pageid].t1+'>a').replaceWith(jQuery('<span>'+jQuery('#'+nav[pageid].t1+'>a').text()+'</span>'));

    //set display classes for nav
    jQuery('#'+nav[pageid].t1).addClass('selected').find('#'+nav[pageid].t2).addClass('subselect'); //topnav
    jQuery('#'+nav[pageid].t3).addClass('selected').find('#'+nav[pageid].t4).addClass('subselect'); //leftnav
}

},100); 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-17T22:07:18.423

异常应该用于特殊情况（即您不希望正常发生的事情）。通常，您不应该使用异常来捕获可以使用 if 语句测试的内容。

另外，据我了解，异常比 if 语句要昂贵得多。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-17T22:12:12.467

使用 if 语句。我不知道 TRY/CATCH 的开销是多少，但我怀疑它比评估布尔表达式要大得多。要点击 TRY/CATCH，您必须：执行一条语句，生成一个错误 [与相关的开销]，记录错误（大概），进行堆栈跟踪（大概），然后移回代码中。此外，如果您必须在这些行附近调试代码，则真正的错误可能会与您正在尝试/捕获的内容混淆。

此外，这是对 TRY/CATCH 的误用，会使您的代码更难阅读。假设您对更长或更模糊的情况执行此操作？你的收获会在哪里结束？

这称为[异常处理](http://en.wikipedia.org/wiki/Exception_handling)

编辑：如下所述，如果您确实导致异常，您只会受到运行时性能的影响。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-18T06:29:48.120

其他答案都是正确的，`try/catch`是针对特殊情况和错误处理的。 `if`条件用于程序逻辑。“哪个更快？” 是错误的问题。

一个好的经验法则，如果你对异常什么都不做，它可能不是异常！

要确定使用哪个，让我们分解您的 if 条件。

1.  `typeof jQuery == 'function'` jQuery() 函数是否已定义？
2.  `typeof nav == 'object'` nav 全局变量是否包含对象？
3.  `typeof pageid != 'undefined'`是否定义了 pageid 全局变量？
4.  `typeof document.getElementById('leftnav') == 'object'` 文档是否包含 leftnav 元素？

第一个显然是个例外。没有 jQuery() 函数，你不会走得太远。

第二个也是一个例外。没有导航对象，你哪儿也去不了。

三是例外。你需要一个 pageid 来做任何事情。

第四个可能是逻辑。“仅当存在 leftnav 元素时才运行此代码”。很难说，因为其余代码没有引用 leftnav 元素！只有评论才会这样做，这是一个危险信号。所以这可能是一个编程错误。

所以我可能会这样做（如果我正在屠杀 jQuery，我会道歉）：

```
var intvar = setInterval(function() {
    // If there's no leftnav element, don't do anything.
    if( typeof document.getElementById('leftnav') != 'object') {
        return;
    }

    try {
        clearInterval(intvar);
        jQuery('#'+nav[pageid].t1+'>a')
            .replaceWith(jQuery('<span>'+jQuery('#'+nav[pageid].t1+'>a').text()+'</span>'));

        //set display classes for nav
        jQuery('#'+nav[pageid].t1)
            .addClass('selected')
            .find('#'+nav[pageid].t2)
            .addClass('subselect');     //topnav
        jQuery('#'+nav[pageid].t3)
            .addClass('selected')
            .find('#'+nav[pageid].t4)
            .addClass('subselect');     //leftnav
    }
    catch(err) {
        ...do something with the error...
    }
},100); 
```

...但我真的会检查 leftnav 元素检查是否适用。

最后，我不禁评论说这个“函数”正在使用全局变量。相反，您应该传递`nav`并`pageid`进入函数，以保持封装和您的理智。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T22:07:39.450

我会写下面的代码：

```
var startTime = (new Date()).getTime();
for (var i=0; i < 1000; ++i) intvar();
var endTime = (new Date()).getTime();
alert("Took " + ((endTime - startTime) / 1000.0) " seconds"); 
```

然后我会尝试两个版本的 intvar，看看哪个运行得更快。我会自己做，但我没有你做的页面布局，所以我的代码不起作用。

一些文体评论 - 似乎没有必要测试这`jQuery`是一个功能。如果不是这样，您的网页可能会混乱，以至于不运行`intvar`代码对您没有帮助。如果你很少期望抛出异常，我会使用 try/catch。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T23:51:03.447

对于所提供的示例，您将 try/catch 包装在始终应该运行的代码块上（除非发生可怕的事情），使用 try/catch 是一种很好的形式。给你打个比方：你总是测试“天空是蓝色的吗？” 在您的 if 语句中，还是将其包装在仅在天空变为绿色时触发的 try/catch 中。

如果您正在处理用户提供的输入，或者由于代码中发生其他事情而导致函数不存在的可能性要高得多，请使用 If 语句方法。

请记住，如果您不触发异常，您就没有跨代码的任何展开或回溯。在示例中，catch 只会在出现错误（缺少 jQuery 或类似的事情）时执行，但是 if 语句方法在每次调用该函数时都会进行评估 - 你不应该做比你必须做的更多的工作.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-18T02:28:39.663

像其他人一样直接回答这个问题，如果确实有错误，try..catch 可能会更昂贵。

指出代码中的一些其他错误超出了其他人已经指出的：

这两个代码根本不等价。解释一下，即使代码看起来做同样的事情，但它们没有。

在 if() 检查的情况下，不执行任何代码。在异常处理程序的情况下，异常处理程序内的每一行代码都将被执行。那么，如果错误发生在第二行或第三行会发生什么？然后，您的代码中发生的事情与在执行任何代码之前检查条件时所得到的完全不同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-04-14T15:53:51.047

除了给出的答案，我想就这个主题添加一些想法。

不可预见的异常，即运行时抛出异常，不应使用 try ... catch 捕获，因为您想读取控制台中抛出的消息。

Try ... catch 当您的应用程序可以在应用程序逻辑中预见的异常发生并且您希望在它们发生时执行一些自定义操作时抛出 IMO。即你想描述它是一个例外，它不是应用程序逻辑的快乐流程的一部分。

例如，您可以有一个验证用户输入的方法，因此您可以有一个`isValid`返回布尔值的方法，在这种情况下您可以使用 if ... then。

另一方面，如果您执行某个流程，并且您知道可能会发生某个异常而中断快乐流程并且您想要处理这个，我觉得最好抛出异常。

作为抽象示例，您可以拥有实现某些业务规则的方法。
除了验证每个业务规则的有效性之外，您还可以拥有一个包含动态元数据的自定义异常，当有效性被破坏时，这些方法中的每一个都可以抛出这些元数据并适当地处理它们，否则继续愉快的流程。
这将转化为：

```
throw new BusinessValidationException(TAG, 'Reason for the validation'); 
```

哪个 IMO 比以下更具描述性：

```
if (!checkValidityBusinessRule()) 
    // doSomething 
```

对于一系列业务规则。

至于这个例子，我的拙见是首先不应该进行这种检查，并且默认情况下给定的检查对于实现该方法是正确的。

```
if(typeof jQuery == 'function' && typeof nav == 'object' && typeof pageid != 'undefined' && typeof document.getElementById('leftnav') == 'object') 
```

What it means is that you must declaratively ensure that given conditions are true before invoking the given method with side-effects, taking away the necessity to perform the checks at all.
If it so happens that one of the conditions is false, then it will throw an exception to the console, which is actually what you want because as a developer it means that something in your application logic or lifecycle is broken.

My 2 cents, I hope they make sense.

# .net - DB_LINQ + 非 SQL Server 数据库是否可以替代带有 SQL Server 的 LINQ to SQL？

> ID：558915
> 
> 赞同：2
> 
> 时间：2009-02-17T22:03:14.780
> 
> 标签：.net, visual-studio-2008, linq

我正在尝试为我的下一个项目使用哪个数据库系统，该项目将使用 VS.NET 2008，并且可能包含一些 LINQ 代码。没有 LINQ 支持可能会破坏任何数据库系统。DB_LINQ 是否成熟到足以让其他 DBMS 与 SQL Server 站在一起？或者如果 LINQ 是个破坏者，我什至不应该研究其他系统？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T22:15:52.647

好吧，我自己并没有使用过它——但我*帮助*过一些人使用它（各种`Expression`代码——我相信有些人将它纳入了 DbLinq 代码库），而且他们普遍对此感到满意。

最后，我建议您需要找到您需要的关键功能，并运行测试（单元、集成或临时）以查看它是否可以满足您的特定要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T22:45:03.683

最后，如果您在 Microsoft 商店，使用 Linq to SQL 来满足您的 OR/M 需求应该不会有任何问题。

如果我需要一个真正的 OR/M 解决方案，我会尝试使用 Linq to Entities 并在需要立即稳定的东西时使用[NHibernate 。](http://www.hibernate.org/343.html)它已经在街区附近出现了几次，并且非常稳定。据我所知，Oracle 还没有发布真正的 Linq to Entities 实施，在他们完成之前，您需要通过各种社区努力，如[DbLinq](http://code2code.net/DB_Linq/)。 [Catharsis](http://www.codeplex.com/Catharsis)是一个很好的参考实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T22:14:46.533

LINQ != LINQ 到 SQL。LINQ to Entities 与许多非 SQL-Server 数据库一起工作得很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-05T14:01:35.077

我会避免将 DBLinq 用于生产代码...许多 Linq-To-SQL 的功能没有实现，并且浏览源代码显示成熟度较低...许多方法没有实现或标记为“未终止”。

...您已被警告！

# c# - 我对 C# 对象初始化器做错了什么？

> ID：558916
> 
> 赞同：7
> 
> 时间：2009-02-17T22:03:23.097
> 
> 标签：c#, object-initializers

当我使用 C# 中的新对象初始化程序初始化对象时，我无法使用类中的某个属性来执行进一步的操作，我不知道为什么。

我的示例代码：

```
Person person = new Person { Name = "David", Age = "29" }; 
```

在 Person 类中，x 将等于 0（默认）：

```
public Person()
{
  int x = Age; // x remains 0 - edit age should be Age. This was a typo
} 
```

但是 person.Age 确实等于 29。我确信这是正常的，但我想了解原因。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-17T22:05:56.630

在构造函数“public Person()”完成运行后，将为 Name 和 Age 设置属性。

```
Person person = new Person { Name = "David", Age = "29" }; 
```

相当于

```
Person tempPerson = new Person()
tempPerson.Name = "David";
tempPerson.Age = "29";
Person person = tempPerson; 
```

所以，在构造函数中 Age 还没有变成 29。

（tempPerson 是您在代码中看不到的唯一变量名称，它不会与以这种方式构造的其他 Person 实例发生冲突。 tempPerson 是避免多线程问题所必需的；它的使用确保新对象不会成为可用于任何其他线程，直到构造函数被执行并且所有属性都被初始化之后。）

* * *

如果您希望能够在构造函数中操作 Age 属性，那么我建议您创建一个以年龄为参数的构造函数：

```
public Person(string name, int age)
{
   Name = name;
   Age = age;

   // Now do something with Age
   int x = Age;
   // ...
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-17T22:14:10.340

请注意，作为一个重要的技术细节，：

```
Person person = new Person { Name = "David", Age = "29" }; 
```

相当于：

```
Person <>0 = new Person(); // a local variable which is not visible within C#
<>0.Name = "David";
<>0.Age = "29";
Person person = <>0; 
```

但不等同于：

```
Person person = new Person();
person.Name = "David";
person.Age = "29"; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-17T22:06:42.667

您的代码行与以下内容相同：

```
Person person = new Person() { Name = "David", Age = "29" }; 
```

这等同于：

```
Person person = new Person();
person.Name = "David";
person.Age = "29"; 
```

如你看到的; 当构造函数执行时，`Age`尚未设置。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-17T22:16:23.067

从技术上讲，这段代码：

```
Person person = new Person { Name = "David", Age = 29 }; 
```

与此代码相同：

```
Person tmpPerson = new Person();
tmpPerson.Name = "David";
tmpPerson.Age = 29;
Person person = tmpPerson; 
```

这与其他人发布的内容略有不同：

```
Person person = new Person();
person.Name = "David";
person.Age = 29; 
```

如果您的应用程序使用多线程，这种差异至关重要。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-17T22:05:57.567

看起来您正试图`Age`在对象的构造函数中访问。对象初始值设定项值在构造函数执行之前不会被设置。

试试这个：

```
Person person = new Person { Name = "David", Age = 29 };
int x = person.Age; 
```

* * *

**编辑回应评论**

如果您需要`Age`在构造函数本身中访问，那么您需要创建一个带有所需参数的显式构造函数，并使用它而不是对象初始值设定项语法。例如：

```
public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }

    public Person(string name, int age)
    {
        Name = name;
        Age = age;

        int x = Age;  // will be 29 in this example
    }
}

Person person = new Person("David", 29); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T22:39:25.570

好吧，正如其他人所说，无参数构造函数首先被执行，因此你很困惑。

但是，我必须问一下，如果您为 Age 变量设置了字段而不是自动属性？

```
public class Person
{
    private int _age;

    public int Age
    {
        get { return _age; }
        set { _age = value; }
    }
 } 
```

如果足够了，或者如果你真的需要使用，你可以使用`_age`而不是：`x``x`

```
public class Person
{
    private int _age;
    private int x;

    public int Age
    {
        get { return _age; }
        set 
        { 
            _age = value;
            x = _age;
        }
    }
 } 
```

哪个更合适。

# c# - Windows 服务立即停止并启动，但它不应该

> ID：558920
> 
> 赞同：3
> 
> 时间：2009-02-17T22:03:53.110
> 
> 标签：c#, windows-services

我正在创建一个 Windows 服务，安装该服务后，它会立即停止并启动，但根本不应该。之前遇到服务没有及时响应启动命令的错误，所以我把初始化代码拿出来放到一个线程中，现在我在这里：

```
protected override void OnStart(string[] args)
{
    this.EventLog.WriteEntry("ATNotifier Started");

    ThreadPool.QueueUserWorkItem(WaitOnEmailsChanged);
    ThreadPool.QueueUserWorkItem(Init, "IP");
} 
```

waitonemailschanged 线程简单地创建一个文件系统观察器来观察设置文件（xml 文档）是否被更改，如果发生这种情况，则从该文件加载数据。目前，这只是无限期地等待（这是一般情况，因为每年只会更改几次），因为没有对 xml 文档进行任何更改。

Init 线程做各种事情，包括创建和启动 System.Timers.Timer 对象，其 Elapsed 方法是服务的核心。

我不明白为什么它会开始然后立即停止。我还应该注意，事件查看器没有显示此应用程序的日志。

编辑>我尝试创建“正确”线程，结果相同，并且我删除了除了创建和启动计时器之外的所有内容，如下所示：

```
protected override void OnStart(string[] args)
{
    this.EventLog.WriteEntry("ATNotifier Started");

    m_Timer = new System.Timers.Timer(90000.0); // 1.5 mins
    m_Timer.Elapsed += new ElapsedEventHandler(m_Timer_Elapsed);

    m_Timer.Start();
} 
```

我仍然收到同样的信息。就好像 OnStart 从未被调用过。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T22:07:18.080

如果您的主线程因异常终止，它可能会意外停止。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T22:28:13.210

您发布的代码对我来说没有意义。为什么要在创建 Timer 之前设置事件处理程序？

```
 m_Timer.Elapsed += new ElapsedEventHandler(m_Timer_Elapsed);
    m_Timer = new System.Timers.Timer(90000.0); // 1.5 mins 
```

这两行不应该互换吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T22:48:11.007

最重要的问题是 EventLog.WriteEntry 抛出错误，因为没有与之关联的 EventSource。请参阅[http://msdn.microsoft.com/en-us/library/xzwc042w.aspx](http://msdn.microsoft.com/en-us/library/xzwc042w.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T22:49:24.000

据我记得，你必须主动向服务管理器报告服务已成功启动——否则，OnStart 方法将返回，如果没有报告状态更改，服务管理器将假定服务终止而没有实际上成功地加载了自己。

报告您的服务已成功启动是由 Service 基类完成的 IIRC，因此将以下内容添加到`OnStart`方法的底部：

```
base.OnStart(args); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T22:08:16.937

ThreadPool 线程是后台线程；他们不会让进程保持活力。我怀疑你需要一个“正确”的线程......

尝试：`new Thread(SomeCode).Start();`或类似的。

# asp.net - 缓存策略，输出缓存与数据缓存还是两者兼而有之？

> ID：558925
> 
> 赞同：8
> 
> 时间：2009-02-17T22:04:19.537
> 
> 标签：asp.net, asp.net-mvc, architecture, caching, outputcache

我正在开发一个 ASP.NET MVC 项目，并且已经到了要开始考虑缓存策略的地步。我试图让我的框架尽可能开放，以便在缓存中使用。

根据我在 Scott Hanselman 的播客中听到的内容，StackOverflow.com 使用页面输出缓存并将该内容压缩并放入 RAM。听起来这对于用户范围的缓存非常有用，但对于个性化页面之类的内容，您必须为每个用户缓存一个版本，这可能很快就会失控。

因此，对于缓存策略。应该使用哪个，输出缓存、数据缓存还是结合使用？我的第一个想法是两者，但就缓存依赖项而言，它听起来可能会有点复杂。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T22:12:53.293

我们正在大规模（每天 300 万次访问）网站（新闻门户）进行 API 和输出缓存。该站点主要由匿名用户使用，但我们确实有经过身份验证的用户，并且由于站点的一些个性化部分，我们为他们缓存了一个完整的站点，我必须承认我们在内存压力方面绝对没有问题。

因此，我的建议是在 API 缓存中缓存所有可以缓存的内容，这样您的输出缓存重建速度会更快。

当然，请密切注意性能计数器中的缓存比率值。您应该会看到 >95% 的缓存命中数。

另一个需要注意的是缓存失效，如果你有很多相关的内容，这是一个大问题。例如，您缓存音乐内容，而有关一张专辑或歌曲的信息可能会显示并缓存在几百页上。如果那首歌有任何变化，您必须使所有这些页面无效，这可能会出现问题。

归根结底，缓存是 ASP.NET 的最佳特性之一，它做得非常好，您可以信赖它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T22:09:38.247

小心过度激进的缓存。尽管缓存是一种有助于提高性能的工具，但如果使用不当，它实际上会使性能变得更差。

如果不了解有关您的项目的更多详细信息，我无法回答输出缓存或数据缓存是否更适合您。我可以帮助提供几个示例，说明何时使用一个而不是另一个。

如果您有一个经常在许多不同视图中使用的特定数据集，那么最好使用数据缓存。如果您的数据获取操作相对于您的数据呈现非常常见且成本高昂，您将使用它。如果您有多个使用相同数据的视图，则可以节省数据获取时间。

如果您有一个使用非常特定的数据集的视图，并且该视图的呈现很复杂，并且该视图经常被请求（例如，堆栈溢出的主页），那么您将从输出缓存中受益匪浅。

所以最后，这真的取决于你的需要，小心使用缓存不正确。

# python - PyAMF、Django 和 Python 的“属性”功能存在问题

> ID：558926
> 
> 赞同：2
> 
> 时间：2009-02-17T22:05:10.270
> 
> 标签：python, django, apache-flex, flex3, pyamf

到目前为止，我使用 PyAMF 在我的 Flex 前端和我的 Django 后端之间进行通信取得了巨大的成功。但是，我相信我遇到了一个错误。以下示例（强调“示例”一词）演示了（潜在的）错误：

我的 Flex 应用程序包含以下 VO：

```
package myproject.model.vo
{
    [Bindable]
    [RemoteClass(alias="myproject.models.Book")]

    public class BookVO
    {
        public var id:int;
        public var title:String;
        public var numberOfOddPages:int;
    }
} 
```

我的 Django 应用程序包含以下模型：

```
class Book(models.Models):
    title = models.CharField(max_length=20)

    def _get_number_of_odd_pages(self):
        #some code that calculates odd pages
       return odd_page_total

    numberOfOddPages = property(_get_number_of_odd_pages) 
```

当我尝试检索要在 DataGrid 中显示的图书对象时，图书按预期显示在网格中。但是，“numberOfOddPages”始终设置为 0。我什至尝试使用默认值（即“numberOfOddPages=100”）显式设置此属性，以查看我的“_get_number_of_odd_pages()”方法是否有错误。不幸的是，它产生了相同的结果：VO 中的值仍然为 0。

有没有人知道我可能做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T13:35:27.460

我刚刚收到 PyAMF 的首席开发人员的以下回复。这绝对是一个错误：

> 这是 Django 适配器处理非 models.fields.* 属性的方式中的一个错误。
> 
> 如果我做：

```
import pyamf

class Book(object):    
def _get_number_of_odd_pages(self):
  return 52

numberOfOddPages = property(_get_number_of_odd_pages)

pyamf.register_class(Book, 'Book')

encoded = pyamf.encode(Book()).getvalue() 
print pyamf.decode(encoded).next().numberOfOddPages 
```

> 然后我得到正确的值 52。
> 
> 我为此创建[了一张票](http://pyamf.org/ticket/480)，稍后会考虑获取补丁。
> 
> 干杯，
> 
> 缺口

**更新**：Nick 已经修复了这个错误，它将在 PyAMF 0.4.1 中发布（应该在本周末发布）。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-18T12:47:55.997

一点也不。

你认为错误是来自 Django 还是来自 Flex？您可以首先在 Flex 中跟踪 AMF 对象。如果那里的值已经是 0，那么请仔细看看 PyAMF 做了什么。

# sql - SQL将浮点数转换为带小数的逗号varchar

> ID：558942
> 
> 赞同：3
> 
> 时间：2009-02-17T22:07:43.210
> 
> 标签：sql, sql-server, floating-point

我有几个有点大的花车。他们大约有1亿。

我希望这个数字显示如下 123,456,789.01234

我发现如果 CONVERT 是一种货币数据类型，我可以使用它，但这并不能完全发挥作用（它会留下一些小数位）。

我必须在左边有逗号，在右边有五个小数位。

是否有任何内置的 SQL 函数可以帮助解决这个问题？还是我必须编写自定义函数？

谢谢

*** 更新

*   我忘了提到我只是将这些显示为 varchars。所以在此之后没有任何计算。
*   这是在 SQL 数据库上运行的，因此 MySQL 和 Oracle 将无法工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T05:09:31.747

```
DECLARE @f FLOAT

SET @f = 123456789.01234

SELECT  LEFT('$' + CONVERT(VARCHAR(20), CAST(@f AS MONEY), 1), LEN(@f) - 2) 
```

这会将其减少到小数点后两位以进行格式化。您可以更改 LEN(@f) - 2 来修改此设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T22:39:00.890

如果您只是将其显示为文本，您可以执行以下操作：

甲骨文：

```
select to_char(123456789.01234,'999,999,999.99999') from dual; => 123,456,789.01234 
```

MySQL：

```
select format(123456789.01234,5) => 123,456,789.01234<br> 
```

MySQL函数轮次

# sql-server - 在不牺牲性能的情况下存储大型文本字段的可维护方式是什么？

> ID：558943
> 
> 赞同：5
> 
> 时间：2009-02-17T22:08:01.557
> 
> 标签：sql-server, database

我一直在围绕这个问题跳舞一段时间，但它一直在出现。我们有一个系统，我们的表格可能以最初存储为的描述开头，`NVARCHAR(150)`然后我们收到一张票，要求将字段大小扩展到 250，然后是 1000 等等……

这个循环在我们添加到大多数表格的任何“注释”字段和/或“描述”字段上重复。当然，我关心的是性能和打破页面的 8k 限制。但是，我的另一个担忧是通过将系统中每个表中的这些字段分解为延迟加载的引用，从而降低系统的可维护性。

所以在这里，我面临着同样的两个选项，这些选项一直盯着我看。（欢迎其他人）请给我您的意见。

1.  将所有可能的注释和/或描述更改为`NVARCHAR(MAX)`并确保我们在所有列表中排除这些字段。基本上从不做：`SELECT * FROM [TableName]`除非它只检索一条记录。

2.  删除所有注释和/或描述字段，并将它们替换为对`[Notes]`表的外键引用。

    > `CREATE TABLE [dbo].[Notes] (
    > [NoteId] [int] NOT NULL,
    > [NoteText] [NVARCHAR]`( `MAX`)`NOT NULL )`

显然我更喜欢使用选项 1，因为如果我们使用选项 2，它会在我们的系统中发生很大变化。但是，如果选项 2 确实是唯一的好方法，那么至少我可以说这些更改是必要的，并且我已经完成了在家工作。

* * *

更新：我对一个包含 100,000 条记录的示例数据库进行了几次测试。我发现，由于集群索引扫描，选项 1 所需的 IO “大约”是选项 2 的两倍。如果我选​​择大量记录（1000 条或更多），即使我这样做，选项 1 的速度也会慢一倍不包括选择中的大文本字段。当我要求更少的行时，线条会更加模糊。我是一个 Web 应用程序，其中页面大小通常为 50 左右，因此选项 1 将起作用，但我将在（非常）不久的将来将所有实例转换为选项 2 以实现可扩展性。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T23:01:02.333

选项 2 更好有几个原因：

1.  查询表时，大文本字段会快速填满页面，迫使数据库扫描更多页面以检索数据。当您实际上不需要返回文本数据时，这尤其繁重。
2.  正如您所提到的，它为您提供了一次彻底改变数据类型的机会。Microsoft 在 SQL Server 2008 中已弃用 TEXT，因此您应该坚持使用 VARCHAR/VARBINARY。
3.  分离文件组。将所有文本数据放在更慢、更便宜的存储位置可能是您未来决定追求的目标。如果没有，没有伤害，没有犯规。

虽然选项 1 现在更容易，但选项 2 会在长期内为您提供更大的灵活性。我的建议是使用与主表分离的“注释”信息来实现一个简单的概念验证，并对这两个示例执行一些查询。针对这些表比较您的某些查询的执行计划、客户端统计信息和逻辑 I/O 读取 (SET STATISTICS IO ON)。

对那些建议使用 MSDN 中的 TEXT/NTEXT 的人的快速说明：

> 此功能将在 Microsoft SQL Server 的未来版本中删除。避免在新的开发工作中使用此功能，并计划修改当前使用此功能的应用程序。请改用 varchar(max)、nvarchar(max) 和 varbinary(max) 数据类型。有关详细信息，请参阅使用大值数据类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T22:17:07.697

我会选择选项2。

您可以创建一个连接两个表的视图，以使每个人都更轻松地进行转换，然后进行清理过程，删除视图并尽可能使用单个表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T22:57:47.803

您想使用 TEXT 字段。TEXT 字段不直接存储在行中；相反，它存储一个指向文本数据的指针。但是，这对查询是透明的 - 如果您要求一个 TEXT 字段，它将返回实际文本，而不是指针。

本质上，使用 TEXT 字段有点介于两个解决方案之间。它使您的表行比使用 varchar 小得多，但如果可能的话，您仍然希望避免在查询中询问它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T22:18:21.047

TEXT/NTEXT 数据类型的长度实际上是无限的，而在您的记录中几乎不占用任何内容。

它附带了一些字符串，例如字符串函数的特殊行为，但对于辅助“注释/描述”类型的字段，这些可能不是问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T07:58:17.627

只是为了扩展选项 2

你可以：

将现有 MyTable 重命名为 MyTable_V2

将 Notes 列移动到连接的 Notes 表中（使用 1:1 连接 ID）

创建一个名为 MyTable 的 VIEW，用于连接 MyTable_V2 和 Notes 表

在 MyTable 视图上创建一个 INSTEAD OF 触发器，将 Notes 列保存到 Notes 表中（如果为 NULL，则删除任何现有的 Notes 行，如果不是 NULL，则如果未找到则插入，否则更新）。对 MyTable_V2 表执行适当的操作

注意：在 MyTable_V2 中有一个 Computed 列的情况下，我们在执行此操作时遇到了麻烦（我认为这是问题所在，无论哪种方式，我们在使用“不寻常”表时遇到了障碍）

应编写所有新的插入/更新/删除代码以直接对 MyTable_V2 和 Notes 表进行操作

可选：让 MyTable 上的 INSERT OF 触发器记录它被调用的事实（它可以最低限度地执行此操作，仅当现有行的日期大于 24 小时时才使用 GetDate() 更新预先存在的日志表行 - 所以只会这样做每天更新一次）。

当您不再获得任何日志记录时，您可以在 MyTable 视图上删除 INSTEAD OF 触发器，您现在完全符合 MyTable_V2！

正如您所猜测的那样，实施起来非常麻烦。

或者，搜索对 MyTable 的所有引用的代码并将它们更改为 MyTable_V2，仅在 SELECT 中放置一个 VIEW 代替 MyTable，而不创建 INSTEAD OF 触发器。

我的计划是修复所有引用现已弃用的 MyTable 的插入/更新/删除语句。对我来说，这会稍微容易一些，因为我们对数据库中的所有表和列使用唯一的名称，并且我们在所有应用程序代码中使用相同的名称，因此确保我通过简单的 FIND 找到了所有实例会很高。

如果您周围有任何 SELECT *，则 PS 选项 2 也更可取。我们有一些客户，当他们向现有表中添加大的 Text/Blob 列时，他们的应用程序性能迅速下降——因为“懒惰”的 SELECT * 语句。希望你的商店不是这样！

# asp.net - ASP.net 内联表达式问题

> ID：558954
> 
> 赞同：9
> 
> 时间：2009-02-17T22:11:20.660
> 
> 标签：asp.net, data-binding

我似乎无法弄清楚为什么这在下面不起作用。我需要将文本框绑定到内联表达式中的值。看起来很简单吧？但这些都不起作用。有任何想法吗？提前致谢。

```
<asp:textbox id="tbName" runat="server" Text='<%# Eval("test") %>' />
<asp:textbox id="tbName" runat="server" Text='<%= "test" %>' /> 
```

编辑：我应该提到这个页面没有代码，顶部只有以下指令。

```
<%@ Import Namespace="System" %>
<%@ Import Namespace="System.Web" %>
<%@ Page Language="C#" %> 
```

编辑：

我能想出的唯一可行的解​​决方案是添加一个内联服务器脚本，就像这个一样。我希望我知道为什么除非您处于数据绑定上下文中，否则内联表达式将不起作用。

```
<script language="C#" runat="server"> 
   private void Page_Load(object sender, System.EventArgs e)
    {
      tbName.Text = "test";
    }
</script> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-17T23:26:27.250

在您的 Page_Load 中，您必须调用 Page.DataBind()

```
<asp:textbox id="tbName" runat="server" Text='<%# Eval("test") %>' /> 
```

去工作。

<%= %> 是一个缩短的 response.Write() 并且对于任何服务器标记都不能作为属性有效。

<%# %> 可以使用，只有当容器是数据绑定的（你的情况下的页面）。

<%$ %> 可用于访问资源文件中的数据。

**编辑：**您还可以查看[如何在标记中“绑定”标签的文本属性，](https://stackoverflow.com/questions/73484/how-to-bind-text-property-of-a-label-in-markup) 这是一个类似的问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T23:23:48.193

如前所述，<%= %> 在服务器控制声明中的任何地方都是非法的，除非内部标记被解析为内容（例如，Repeater 中的 <ItemTemplate>）。

<%# %> 作为控件属性的表达式是有效的，因为在控件上调用 DataBind() 时将对这些表达式求值。

不过，您对 Eval() 的使用看起来有点可疑。根据示例，Eval() 将使用当前 Page 对象作为绑定上下文，这意味着在调用 DataBind() 时将绑定名为“test”的公共属性的值。除非您实际上在 Page 类上定义了此属性，否则表达式永远不会计算为任何值。

Eval() 主要用于Repeater、GridView、ListView等控件中的表达式，其中有一个使用模板绑定的数据项列表，并且您需要一个能够访问当前属性的方法数据项。

对于所有其他控件，只需在数据绑定表达式中使用普通代码表达式 - 它比依赖运行时反射的 Eval() 更快、更直观。

如果您想要一个更聪明的替代方案，使用完全避免数据绑定的 <%$ %> 语法，请转到此处：

[http://weblogs.asp.net/infinitiesloop/archive/2006/08/09/The-CodeExpressionBuilder.aspx](http://weblogs.asp.net/infinitiesloop/archive/2006/08/09/The-CodeExpressionBuilder.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-03-02T09:18:33.743

采用`<asp:textbox id="tbName" runat="server" Text='<%# Eval("test") %>' />`

并`tbName.DataBind();`在页面加载事件中设置。

对于那些正在搜索有关内联表达式的更多信息的人，请参阅以下链接。

ASP.net 有以下[内联表达式](http://support.microsoft.com/kb/976112)

*   [嵌入式代码块](http://msdn.microsoft.com/en-us/library/ms178135.aspx) `<% ... %>`

*   [显示表达式](http://msdn.microsoft.com/en-us/library/6dwsdcf5.aspx) `<%= ... %>`

*   [指令表达](http://msdn.microsoft.com/en-us/library/xz702w3e(v=vs.71).aspx) `<%@ ... %>`

*   [数据绑定表达式](http://msdn.microsoft.com/en-us/library/ms178366(v=vs.100).aspx) `<%# ... %>`

*   [表达式生成器](http://msdn.microsoft.com/en-us/library/d5bd1tad.aspx) `<%$ ... %>`

*   [服务器端评论块](http://msdn.microsoft.com/en-us/library/4acf8afk(v=vs.71).aspx) `<%-- ... --%>`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T22:16:01.990

尝试将 runat="server" 添加到服务器元素。否则，该元素将不会在服务器上处理。

编辑：实际上，“它是正确的”这不起作用；代码 <%=...%> 不能在服务器标签中进行评估，只能像 <%$ Resources: h1 %> 这样的表达式

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T22:29:58.057

您可能需要文本框控件的命名空间

```
<%@ Import "System.Web.UI.WebControls" %> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T22:14:02.243

```
<asp:textbox id="tbName" runat="server"><%="test"%></asp:textbox> 
```

# .net - 如何为 NHibernate 中的页面过滤器执行 SELECT DISTINCT 等效项？

> ID：558974
> 
> 赞同：2
> 
> 时间：2009-02-17T22:18:14.963
> 
> 标签：.net, asp.net, sql-server, nhibernate, distinct

假设您在安装了 Northwind 数据库副本的 SQL 2005 中工作。您在使用员工“浏览”页面的 ASP.NET 应用程序上工作。在页面顶部，您有一个“标题”过滤器，您希望在下拉列表中显示这 5 个选项：

> [全部]
> 销售副总裁、
> 销售代表
> 销售经理
> 内部销售协调员

在 T-SQL 中，您将使用类似于下面的语句来获取您的列表。

```
SELECT DISTINCT Title FROM Employees ORDER BY Title 
```

在 NHibernate 中执行此操作的最佳方法是什么？假设最初的数据库设计在某种程度上超出了您的控制（就像 Northwind 一样）......这意味着您不会为规范化创建 Titles 或 Positions 表。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T00:59:37.790

请参阅[nhibernate.info/doc/howto/various/get-unique-results-from-joined-queries.html](http://nhibernate.info/doc/howto/various/get-unique-results-from-joined-queries.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-14T18:24:26.623

回答：我在表中有 29 条记录，其中 4 条记录重复了两次。我只想要不同的结果。因此，记录总数应为 25。

下面是测试方法

```
[TestMethod]
public void UserApplicationsTest()
{
    int usercount = 25;
    string query = "select from User u left outer join fetch u.ApplicationRequests ar";

    ISession session = NHibernateSessionManager.GetSession();

    IList<User> users = session.CreateQuery
       (
       query
       )
       .List<User>()
       .Distinct<User>().ToList();

    Assert.AreEqual(usercount, users.Count);

} 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-17T22:31:17.600

```
criterion =  ... // SELECT Title FROM Employees ORDER BY Title
criterion.SetResultTransformer(new NHibernate.Transform.DistinctRootEntityResultTransformer()) 
```

# java - 在 Java 中查看 ArrayList 是否包含对象的最有效方法

> ID：558978
> 
> 赞同：71
> 
> 时间：2009-02-17T22:18:58.130
> 
> 标签：java, algorithm, optimization, search, arraylist

我在 Java 中有一个对象的 ArrayList。这些对象有四个字段，其中两个我会用来认为对象等于另一个。鉴于这两个字段，我正在寻找最有效的方法来查看数组是否包含该对象。

关键是这些类是基于 XSD 对象生成的，所以我不能修改这些类本身来覆盖`.equals`.

有没有比循环并手动比较每个对象的两个字段然后在找到时中断更好的方法？这看起来很混乱，正在寻找更好的方法。

**编辑：** ArrayList 来自未编组为对象的 SOAP 响应。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-02-17T22:39:59.747

这取决于你需要的东西有多高效。简单地遍历列表以查找满足特定条件的元素是 O(n)，但如果您可以实现 Equals 方法，则 ArrayList.Contains 也是如此。如果您不在循环或内部循环中执行此操作，则此方法可能很好。

如果您真的不惜一切代价需要非常高效的查找速度，您需要做两件事：

1.  解决生成类的事实：编写一个适配器类，它可以包装生成的类并基于这两个字段（假设它们是公共的）实现[equals( )。](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html#equals(java.lang.Object))不要忘记也实现[hashCode()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html#hashCode()) (*)
2.  用该适配器包装每个对象并将其放入 HashSet 中。 [HashSet.contains()](http://docs.oracle.com/javase/7/docs/api/java/util/AbstractCollection.html#contains(java.lang.Object))具有恒定的访问时间，即 O(1) 而不是 O(n)。

当然，构建这个 HashSet 仍然需要 O(n) 成本。如果与您需要执行的所有 contains() 检查的总成本相比，构建 HashSet 的成本可以忽略不计，您只会获得任何收益。试图建立一个没有重复的列表就是这种情况。

* * *

* ( *) 实现 hashCode() 最好通过异或（^ 运算符）你用于 equals 实现的相同字段的 hashCode 来完成（但[乘以 31](https://stackoverflow.com/questions/299304/why-does-javas-hashcode-in-string-use-31-as-a-multiplier/299748)以减少 XOR 产生 0 的机会）*

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-17T22:58:03.963

您可以使用带有 Java 内置方法的 Comparator 进行排序和二进制搜索。假设您有一个这样的类，其中 a 和 b 是您要用于排序的字段：

```
class Thing { String a, b, c, d; } 
```

您将定义您的比较器：

```
Comparator<Thing> comparator = new Comparator<Thing>() {
  public int compare(Thing o1, Thing o2) {
    if (o1.a.equals(o2.a)) {
      return o1.b.compareTo(o2.b);
    }
    return o1.a.compareTo(o2.a);
  }
}; 
```

然后对您的列表进行排序：

```
Collections.sort(list, comparator); 
```

最后进行二分查找：

```
int i = Collections.binarySearch(list, thingToFind, comparator); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-17T22:29:47.993

鉴于您的限制，您将陷入蛮力搜索（或者如果搜索将被重复，则创建索引）。您能否详细说明如何`ArrayList`生成 - 也许那里有一些回旋余地。

如果您正在寻找更漂亮的代码，请考虑使用 Apache Commons Collections 类，特别是[CollectionUtils.find()](http://commons.apache.org/collections/api-2.1.1/org/apache/commons/collections/CollectionUtils.html#find(java.util.Collection,%20org.apache.commons.collections.Predicate))来获取现成的语法糖：

```
ArrayList haystack = // ...
final Object needleField1 = // ...
final Object needleField2 = // ...

Object found = CollectionUtils.find(haystack, new Predicate() {
   public boolean evaluate(Object input) {
      return needleField1.equals(input.field1) && 
             needleField2.equals(input.field2);
   }
}); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-17T22:22:08.900

如果列表已[排序](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#sort(java.util.List))，则可以使用[二进制搜索](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#binarySearch(java.util.List,%20T))。如果没有，那就没有更好的办法了。

如果您经常这样做，那么第一次对列表进行排序几乎肯定是值得的。由于您无法修改类，因此您必须使用 a[`Comparator`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)来进行排序和搜索。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-17T22:22:23.783

即使 equals 方法*正在*比较这两个字段，那么从逻辑上讲，它与您手动执行的代码相同。好的，它可能是“混乱”，但它仍然是正确的答案

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-01T19:19:48.243

如果您是我的[ForEach DSL](http://www.iam.unibe.ch/~akuhn/blog/2008/pimp-my-foreach-loop)的用户，可以通过`Detect`查询来完成。

```
Foo foo = ...
Detect<Foo> query = Detect.from(list);
for (Detect<Foo> each: query) 
    each.yield = each.element.a == foo.a && each.element.b == foo.b;
return query.result(); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-18T00:12:18.980

> *有没有比循环并手动比较每个对象的两个字段然后在找到时中断更好的方法？这看起来很混乱，正在寻找更好的方法。*

如果您关心的是可维护性，您可以按照[Fabian Steeg](https://stackoverflow.com/questions/558978/most-efficient-way-to-see-if-an-arraylist-contains-an-object-in-java/559113#559113)的建议进行操作（这就是我会做的），尽管它可能不是“最有效的”（因为您必须先对数组进行排序，然后再执行二进制搜索），但肯定是最干净的和更好的选择。

如果您真的关心效率，您可以创建一个自定义 List 实现，将对象中的字段用作散列并使用 HashMap 作为存储。但这可能太多了。

然后，您必须将填充数据的位置从 ArrayList 更改为 YourCustomList。

像：

```
 List list = new ArrayList();

 fillFromSoap( list ); 
```

到：

```
 List list = new MyCustomSpecialList();

 fillFromSoap( list ); 
```

实现将类似于以下内容：

```
class MyCustomSpecialList extends AbstractList  { 
    private Map<Integer, YourObject> internalMap;

    public boolean add( YourObject o ) { 
         internalMap.put( o.getThatFieldYouKnow(), o );
    }

    public boolean contains( YourObject o ) { 
        return internalMap.containsKey( o.getThatFieldYouKnow() );
    } 
```

}

很像 HashSet，这里的问题是 HashSet 依赖于 hashCode 方法的良好实现，而你可能没有。相反，您将“您知道的那个字段”用作散列，它使一个对象等于另一个对象。

当然，从头开始实现 List 比我上面的代码段要复杂得多，这就是为什么我说[Fabian Steeg](https://stackoverflow.com/questions/558978/most-efficient-way-to-see-if-an-arraylist-contains-an-object-in-java/559113#559113)的建议会更好、更容易实现（尽管这样的事情会更有效）

告诉我们你最后做了什么。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-18T02:01:17.643

也许列表不是您需要的。

也许[TreeSet](http://java.sun.com/j2se/1.5.0/docs/api/java/util/TreeSet.html)会是一个更好的容器。你得到 O(log N) 的插入和检索，以及有序的迭代（但不允许重复）。

[LinkedHashMap](http://java.sun.com/j2se/1.5.0/docs/api/java/util/LinkedHashMap.html)可能更适合您的用例，也请检查一下。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-17T22:30:19.740

从性能的角度来看，基于字段值作为键构建这些对象的 HashMap 可能是值得的，例如填充 Maps 一次并非常有效地查找对象

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-17T22:35:44.440

如果您需要在同一个列表中搜索多次，建立索引可能会有所回报。

迭代一次，并构建一个 HashMap，其中您要查找的等值作为键，适当的节点作为值。如果您需要所有而不是任何一个给定的等值，则让地图具有列表的值类型并在初始迭代中构建整个列表。

请注意，您应该在执行此操作之前进行测量，因为构建索引的开销可能会掩盖仅遍历直到找到预期节点的过程。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-17T23:18:17.003

有三个基本选项：

1）如果检索性能是最重要的并且这样做是可行的，请使用一种形式的哈希表构建一次（并随着/如果列表发生变化而改变）。

2) 如果 List 排序方便或排序可行且 O(log n) 检索足够，则排序和搜索。

3) 如果 O(n) 检索足够快，或者如果操作/维护数据结构或替代方案不切实际，则迭代列表。

在编写比 List 上的简单迭代更复杂的代码之前，值得思考一些问题。

*   为什么需要不同的东西？（时间）表现？优雅？可维护性？重用？所有这些都是可以的理由，分开或一起，但它们会影响解决方案。

*   您对所讨论的数据结构有多少控制权？你能影响它的建造方式吗？后期管理？

*   数据结构（和底层对象）的生命周期是什么？它是一下子建立起来的，从未改变过，还是高度动态的？你的代码可以监控（甚至改变）它的生命周期吗？

*   是否还有其他重要的限制，例如内存占用？关于重复的信息重要吗？等等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-18T00:49:02.463

我想说最简单的解决方案是包装对象并将包含调用委托给包装类的集合。这类似于比较器，但不会强制您对结果集合进行排序，您可以简单地使用 ArrayList.contains()。

```
public class Widget {
        private String name;
        private String desc;

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }

        public String getDesc() {
            return desc;
        }

        public void setDesc(String desc) {
            this.desc = desc;
        }
    }

    public abstract class EqualsHashcodeEnforcer<T> {

        protected T wrapped;

        public T getWrappedObject() {
            return wrapped;
        }

        @Override
        public boolean equals(Object obj) {
            return equalsDelegate(obj);
        }

        @Override
        public int hashCode() {
            return hashCodeDelegate();
        }

        protected abstract boolean equalsDelegate(Object obj);

        protected abstract int hashCodeDelegate();
    }

    public class WrappedWidget extends EqualsHashcodeEnforcer<Widget> {

        @Override
        protected boolean equalsDelegate(Object obj) {
            if (obj == null) {
                return false;
            }
            if (obj == getWrappedObject()) {
                return true;
            }
            if (obj.getClass() != getWrappedObject().getClass()) {
                return false;
            }
            Widget rhs = (Widget) obj;

            return new EqualsBuilder().append(getWrappedObject().getName(),
                    rhs.getName()).append(getWrappedObject().getDesc(),
                    rhs.getDesc()).isEquals();
        }

        @Override
        protected int hashCodeDelegate() {

            return new HashCodeBuilder(121, 991).append(
                    getWrappedObject().getName()).append(
                    getWrappedObject().getDesc()).toHashCode();
        }

    } 
```

# javascript - 获取关联数组键的列表

> ID：558981
> 
> 赞同：268
> 
> 时间：2009-02-17T22:20:54.193
> 
> 标签：javascript, arrays

我在 JavaScript 中有一个关联数组：

```
var dictionary = {
    "cats": [1,2,3,4,5],
    "dogs": [6,7,8,9,10]
}; 
```

我如何获得这本词典的键？即，我想要

```
var keys = ["cats", "dogs"]; 
```

* * *

只是为了让术语正确——在 JavaScript 中没有“关联数组”之类的东西——这在技术上只是一个`object`并且它是我们想要的对象键。

* * *

## 回答 #1

> 赞同：382
> 
> 时间：2009-02-17T22:26:16.833

试试这个：

```
var keys = [];
for (var key in dictionary) {
  if (dictionary.hasOwnProperty(key)) {
    keys.push(key);
  }
} 
```

`hasOwnProperty`之所以需要，是因为可以将键插入`dictionary`. 但是您通常不希望这些键包含在您的列表中。

例如，如果您这样做：

```
Object.prototype.c = 3;
var dictionary = {a: 1, b: 2}; 
```

然后`for...in`循环`dictionary`，你会得到`a`and `b`，但你也会得到`c`.

* * *

## 回答 #2

> 赞同：184
> 
> 时间：2009-02-17T22:28:56.983

```
for (var key in dictionary) {
  // Do something with key
} 
```

这是[for..in 语句](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Statements/for...in)。

* * *

## 回答 #3

> 赞同：98
> 
> 时间：2012-03-02T19:26:19.340

您可以使用：`Object.keys(obj)`

例子：

```
var dictionary = {
  "cats": [1, 2, 37, 38, 40, 32, 33, 35, 39, 36],
  "dogs": [4, 5, 6, 3, 2]
};

// Get the keys
var keys = Object.keys(dictionary);

console.log(keys);
```

有关浏览器支持，请参阅下面的参考。它在 Firefox 4.20、Chrome 5 和 Internet Explorer 9 中受支持。*[Object.keys()](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/keys)*包含一个代码片段，如果`Object.keys()`您的浏览器不支持，您可以添加该代码片段。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-06-15T02:34:42.550

只是一个简短的说明。`for..in`如果您使用库（[jQuery](https://en.wikipedia.org/wiki/JQuery)、[Prototype](https://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)等），请谨慎使用，因为它们中的大多数都会向创建的对象（包括字典）添加方法。

这意味着当你遍历它们时，方法名称将显示为键。如果您正在使用库，请查看文档并查找可枚举部分，您将在其中找到用于迭代对象的正确方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-05T21:51:51.603

简单的jQuery方式：

这就是我使用的：

DictionaryObj 是您要通过的 JavaScript 字典对象。而价值，关键当然是他们在字典中的名字。

```
$.each(DictionaryObj, function (key, value) {
    $("#storeDuplicationList")
        .append($("<li></li>")
        .attr("value", key)
        .text(value));
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-16T13:16:19.230

我目前正在使用[Rob de la Cruz 的回复](https://stackoverflow.com/questions/558981/getting-a-list-of-associative-array-keys/9539168#9539168)：

```
Object.keys(obj) 
```

在一个早期加载的文件中，我有一些**从 Internet 上其他地方借来**的代码行，其中涵盖了没有内置 Object.keys 的旧版本脚本解释器的情况。

```
if (!Object.keys) {
    Object.keys = function(object) {
        var keys = [];
        for (var o in object) {
            if (object.hasOwnProperty(o)) {
                keys.push(o);
            }
        }
        return keys;
    };
} 
```

我认为这对于大型项目来说是两全其美的：简单的现代代码和对旧版本浏览器的向后兼容支持等。

当 Rob de la Cruz 的 Object.keys(obj) 本身不可用时，它实际上将 JW 的解决方案放入函数中。

# multithreading - pthreads - 如何并行化作业

> ID：558995
> 
> 赞同：3
> 
> 时间：2009-02-17T22:24:24.980
> 
> 标签：multithreading, pthreads, parallel-processing

我需要并行化一个简单的密码破解程序，以便在 n 处理器系统上使用它。我的想法是创建 n 个线程并在它们完成时为它们提供越来越多的工作。

知道线程何时完成的最佳方法是什么？互斥体？在其他线程运行时不断检查这个互斥锁不是很昂贵吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T22:28:17.110

你可以有一个简单的队列结构——使用你喜欢的任何数据结构——然后在添加/删除项目时只使用互斥锁。

如果您的线程以足够大的“块”获取他们需要完成的工作，那么互斥锁上的争用就会非常少，因此开销也非常小。

例如，如果每个线程一次抓取大约 1 秒的工作并独立工作 1 秒，那么互斥体上的操作将非常少。

线程在没有更多工作时可以退出；然后主线程可以使用 pthread_join 等待。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T02:42:55.680

通常，您对要等待异步作业完成的此类事情使用“条件变量”。

条件变量基本上是受互斥体保护的简单信号。Pthread 有条件变量（参见例如 pthread_cond_create(...) 函数）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T22:44:32.123

在线程之间使用消息队列：-

Master -> Process（说顺其自然）。过程 -> 大师（说我完成了 - 给我更多，或者，我找到了结果！）

使用它，线程仅在系统关闭时关闭 - 否则它正在处理数据或等待消息队列。

这样，MCP（我一直想这么说！）简单地处理消息并将作业交给正在等待更多工作的线程。

这可能比一直创建和销毁线程更有效。

# javascript - javascript中的“方法重载”

> ID：558996
> 
> 赞同：3
> 
> 时间：2009-02-17T22:24:55.713
> 
> 标签：javascript, overriding

所以我承认我是 javascript 新手，并且我来自 C.+ 背景（“嗨，我是 Bob，我是基于类的静态语言用户”，*合唱*“嗨 Bob！”）。

我发现我经常最终编写如下函数：

```
function someFunc()
{
    if (arguments.length === 0 ){
       ...
    } else {
       ...
    }
} 
```

（可能有三种这样的情况）。或者，或者，我将差异写入名称：

```
function someFuncDefault() { ... };
function someFuncRealArg(theArg) { ... }; 
```

（用“RealArg”代替一些语义上内容丰富的短语）。

这种事情有更好的模式吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T22:35:12.897

看看[这个帖子](http://ejohn.org/blog/javascript-method-overloading/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T22:30:55.637

我不知道我会这样做，但似乎它可能会使您的代码稍微不那么难以管理：

```
function someFunc() {
    switch (arguments.length) {
        case 0: noArgs();
        case 1: oneArg(arguments[0]);
        case 2: twoArgs(arguments[0], arguments[1]);
    }
    function noArgs() {
        // ...
    }
    function oneArg(a) {
        // ...
    }
    function twoArgs(a, b) {
        // ...
    }
} 
```

另一个例子可能是：

```
function someFunc(a, b) {
    if ('string' == typeof a) {
        // ...
    } else if ('number' == typeof a) {
        // ...
    }
} 
```

当然，您可能会通过结合这两个示例来创建一些非常难以管理的东西（使用条件来确定基于参数数量和参数类型的行为）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T22:35:46.233

在 Javascript 中，所有参数都是可选的。

您可以尝试以下方法：

编辑（不会破坏“真实性”为假的值的更好方法）：

```
function bar(arg1, arg2) {
  if(arg1 === undefined) { set default }
  if(arg2 === undefined) { set default }
  //do stuff here
} 
```

打破虚假值的旧方法：

```
function foo(arg1, arg2) {
  if(!arg1) { set default }
  if(!arg2) { set default }
  //do stuff here
} 
```

Douglas Crockford 的 javascript 讲座是开始使用 javascript 的好地方：http: [//video.yahoo.com/search/ ?p=javascript](http://video.yahoo.com/search/?p=javascript)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T22:43:49.113

这是重载，而不是压倒一切，不是吗？

Javascript 是弱类型的，所以方法签名和本机支持不可用。我的建议是传递一个可扩展的对象作为单独的参数。根据需要检查和处理 param 对象上属性的存在。

与争论相比，这有什么优势？好吧，它可以让您在调用的地方明确说明您的意图，并且在您收到的地方明确 arg1 和 arg2 的含义，并且它可以让您抽象为您可以扩展功能的自定义数据对象类。

```
function someFunc(params)
{
  var x = params.x || defaultX;
  var y = params.y || defaultY;

  //businesslogic
}

someFunc({x:'foo',y:'bar'});

someFunc({y:'baz'}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T22:36:52.453

Javascript 让你变得非常懒惰（不像 Python 那样懒惰，但相当懒惰）。

```
function someFunc(arg1, arg2)
{
  if(typeof(arg1) == "undefined") {
    arg1 = default;
  }
  ... 
} 
```

所以你真的不需要超载。Javascript 不会因为传递错误数量的参数而对您大喊大叫。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T23:00:56.563

每个人都接近了，我认为这里真正的问题是在 JavaScript 中你不应该根据传入的参数来改变行为。

由于 JavaScript 使所有参数都是可选的，因此您可以遵循使用此约定的简洁方法：

```
function foo(bar, baz) {
    bar = bar || defaultBar;
    baz = baz || defaultBaz;
    .
    .
    .
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T03:40:18.420

就个人而言，我更喜欢编写将要执行的最复杂的函数，然后将其记录在注释中，以便其他人知道他们不必**发送**所有参数。

```
//concat(str1, str2 [,str3 [,str4 [,str5]]])
function concat(str1, str2, str3, str4, str5) {
    var str = str1 + str2;
    if(str3 != undefined)
        str += str3;
    if(str4 != undefined)
        str += str4;
    if(str5 != undefined)
        str += str5;
    return str;
} 
```

我还发现了参数顺序在普通函数中很重要的情况，但有时我想单独发送参数（即我想发送 str3 和 str5 而不是 str4）。为此，我使用一个对象并测试已知属性

```
//concat({str1:string, str2:string, str3:string, str4:string, str5:string})
//str3, str4, and str5 are optional
function concat(strngs) {
    var str = strngs.str1 + strngs.str2;
    if(strngs.str3 != undefined)
        str += strngs.str3;
    if(strngs.str4 != undefined)
        str += strngs.str4;
    if(strngs.str5 != undefined)
        str += strngs.str5;
    return str;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-03T19:49:52.213

[bob.js](http://www.bobjs.com)提供了更全面的重载机制：

```
var notify = new bob.fn.overloadFunction([ 
    { 
        condition: function(msg) { return bob.utils.isString(msg); }, 
        overload: function(msg) { 
            console.log(msg); 
        } 
    }, 
    { 
        condition: function(bSayHello) { return bob.utils.isBoolean(bSayHello); }, 
        overload: function(bSayHello, msg) { 
            msg = bSayHello ? 'Hello: ' + msg : msg; 
            console.log(msg); 
        } 
    } 
]); 
```

调用重载函数：

```
notify('Simple sentence.'); 
// Output: 
// Simple sentence. 
notify(true, 'Greeting sentence.'); 
// Output: 
// Hello: Greeting sentence. 
notify(123); 
// JavaScript Error: 
// "No matching overload found." 
```

# php - 如何在我的网站上实施投票系统，将投票限制为一票？

> ID：558998
> 
> 赞同：1
> 
> 时间：2009-02-17T22:25:37.910
> 
> 标签：php

我正在尝试建立一个带有可以投票的新闻链接的网站，我有以下代码：

```
 case 'vote':
                require_once('auth/auth.php');
                if(Auth::isUserLoggedIn())
                {
                    require_once('data/article.php');
                    require_once('includes/helpers.php');

                    $id = isset($_GET['param'])? $_GET['param'] : 0;
                    if($id > 0)
                    {
                        $article = Article::getById($id);
                        $article->vote();
                        $article->calculateRanking();
                    }
                    if(!isset($_SESSION)) session_start();
                    redirectTo($_SESSION['action'], $_SESSION['param']);
                }
                else
                {
                    Auth::redirectToLogin(); 
                }
                break; 
```

现在的问题是如何检查同一用户不会投票两次，这里是文章文件：

```
<?php
require_once($_SERVER['DOCUMENT_ROOT'].'/config.php'); 
require_once(SITE_ROOT.'includes/exceptions.php'); 
require_once(SITE_ROOT.'data/model.php');
require_once(SITE_ROOT.'data/comment.php');

class Article extends Model 
{
    private $id;
    private $user_id;
    private $url;
    private $title;
    private $description;
    private $ranking;
    private $points;

    function __construct($title = ' ', $description = ' ', $url = ' ', $username = ' ', $created = ' ', $modified = '') {

        $this->setId(0);
        $this->setCreated($created);
        $this->setModified($modified);
        $this->setUsername($username);
        $this->setUrl($url);
        $this->setTitle($title);
        $this->setDescription($description);
        $this->setRanking(0.0);
        $this->setPoints(1); 
    }

    function getId(){
        return $this->id;
    }

    private function setId($value){
        $this->id = $value;
    }

    function getUsername(){
        return $this->username;
    }

    function setUsername($value){
        $this->username = $value;
    }

    function getUrl(){
        return $this->url;
    }

    function setUrl($value){
        $this->url = $value;
    }

    function getTitle()
    {
        return $this->title;
    }

    function setTitle($value) {

        $this->title = $value;
    }

    function getDescription() {

    return $this->description;
    }

    function setDescription($value)
    {
        $this->description = $value;
    }

    function getPoints()
    {
        return $this->points;
    }

    function setPoints($value) 
    {
        $this->points = $value;
    }

    function getRanking()
    {
        return $this->ranking;
    }

    function setRanking($value)
    {
        $this->ranking = $value;
    }

    function calculateRanking()
    {
        $created = $this->getCreated();

        $diff = $this->getTimeDifference($created, date('F d, Y h:i:s A'));

        $time = $diff['days'] * 24;
        $time += $diff['hours'];
        $time += ($diff['minutes'] / 60);
        $time += (($diff['seconds'] / 60)/60);

        $base = $time + 2;        

        $this->ranking = ($this->points - 1) / pow($base, 1.5);

        $this->save();
    }

    function vote()
    {
        $this->points++;
        $this->save();
    }

    function getUrlDomain()
    {
        /* We extract the domain from the URL
         * using the following regex pattern
         */

        $url = $this->getUrl();
        $matches = array(); 
        if(preg_match('/http:\/\/(.+?)\//', $url, $matches))
        {
            return $matches[1];
        }
        else
        {
            return $url;
        }
    }

    function getTimeDifference( $start, $end )
    {
        $uts['start']      =    strtotime( $start );
        $uts['end']        =    strtotime( $end );
        if( $uts['start']!==-1 && $uts['end']!==-1 )
        {
            if( $uts['end'] >= $uts['start'] )
            {
                $diff    =    $uts['end'] - $uts['start'];
                if( $days=intval((floor($diff/86400))) )
                    $diff = $diff % 86400;
                if( $hours=intval((floor($diff/3600))) )
                    $diff = $diff % 3600;
                if( $minutes=intval((floor($diff/60))) )
                    $diff = $diff % 60;
                $diff    =    intval( $diff );
                return( array('days'=>$days, 'hours'=>$hours, 'minutes'=>$minutes, 'seconds'=>$diff) );
            }
            else
            {
                echo( "Ending date/time is earlier than the start date/time");
            }
        }
        else
        {
            echo( "Invalid date/time data detected");
        }
        return( false );
    }

    function getElapsedDateTime()
    {
        $db = null;
        $record = null;

        $record = Article::getById($this->id);
        $created = $record->getCreated();         

        $diff = $this->getTimeDifference($created, date('F d, Y h:i:s A'));
        //echo 'new date is '.date('F d, Y h:i:s A');
        //print_r($diff);

        if($diff['days'] > 0 )
        {
            return sprintf("hace %d dias", $diff['days']);
        }
        else if($diff['hours'] > 0 )
        {
            return sprintf("hace %d horas", $diff['hours']);
        }
        else if($diff['minutes'] > 0 )
        {
            return sprintf("hace %d minutos", $diff['minutes']);
        }
        else
        {
            return sprintf("hace %d segundos", $diff['seconds']);
        }
    }

    function save() {

    /*
            Here we do either a create or
            update operation depending
            on the value of the id field.
            Zero means create, non-zero
            update
    */

        if(!get_magic_quotes_gpc())
        {
            $this->title = addslashes($this->title);
            $this->description = addslashes($this->description);
        }

        try
        {
            $db = parent::getConnection();
            if($this->id == 0 )
            {
                $query = 'insert into articles (modified, username, url, title, description, points )';
                $query .= " values ('$this->getModified()', '$this->username', '$this->url', '$this->title', '$this->description', $this->points)";
            }
            else if($this->id != 0)
            {
                $query = "update articles set modified = NOW()".", username = '$this->username', url = '$this->url', title = '".$this->title."', description = '".$this->description."', points = $this->points, ranking = $this->ranking where id = $this->id";
            }

            $lastid = parent::execSql2($query);

            if($this->id == 0 )
                $this->id = $lastid;

        }
        catch(Exception $e){
            throw $e;
        }
    }

    function delete()
    {
        try
        {
            $db = parent::getConnection();
            if($this->id != 0)
            {                ;
                /*$comments = $this->getAllComments();
                foreach($comments as $comment)
                {
                    $comment->delete();
                }*/
                $this->deleteAllComments();
                $query = "delete from articles where id = $this->id";
            }
            parent::execSql($query);

        }
        catch(Exception $e){
            throw $e;
        }
    }

    static function getAll($conditions = ' ')
    {
        /* Retrieve all the records from the
         * database according subject to
         * conditions
         */

        $db = null;
        $results = null;
        $records = array();
        $query = "select id, created, modified, username, url, title, description, points, ranking from articles $conditions";
        try
        {
            $db = parent::getConnection();

            $results = parent::execSql($query);

            while($row = $results->fetch_assoc())
            {
                $r_id = $row['id'];
                $r_created = $row['created'];
                $r_modified = $row['modified'];

                $r_title = $row['title'];
                $r_description = $row['description'];

                if(!get_magic_quotes_gpc())
                {
                    $r_title = stripslashes($r_title);
                    $r_description = stripslashes($r_description);
                }

                $r_url = $row['url'];
                $r_username = $row['username'];
                $r_points = $row['points'];
                $r_ranking = $row['ranking'];

                $article = new Article($r_title, $r_description , $r_url, $r_username, $r_created, $r_modified);
                $article->id = $r_id;
                $article->points = $r_points;
                $article->ranking = $r_ranking;
                $records[] = $article;
            }
            parent::closeConnection($db);
        }
        catch(Exception $e)
        {
            throw $e;
        }

        return $records;
    }

    static function getById($id)
    {/*
     *  Return one record from the database by its id */

        $db = null;
        $record = null;

        try
        {
            $db = parent::getConnection();
            $query = "select id, username, created, modified, title, url, description, points, ranking from articles where id = $id";
            $results = parent::execSQL($query);
            if(!$results) {
                throw new Exception ('Record not found', EX_RECORD_NOT_FOUND);
            }

            $row = $results->fetch_assoc();
            parent::closeConnection($db);

            if(!get_magic_quotes_gpc())
            {
                $row['title'] = stripslashes($row['title']);
                $row['description'] = stripslashes($row['description']);
            }

            $article = new Article($row['title'], $row['description'], $row['url'], $row['username'], $row['created'], $row['modified']);
            $article->id = $row['id'];
            $article->points = $row['points'];
            $article->ranking = $row['ranking']; 
            return $article;

        }
        catch (Exception $e){
            throw $e;
        }
    }

    static function getNumberOfComments($id)
    {/*
     *  Return one record from the database by its id */

        $db = null;
        $record = null;

        try
        {
            $db = parent::getConnection();
            $query = "select count(*) as 'total' from comments where article_id = $id";
            $results = parent::execSQL($query);
            if(!$results) {
                throw new Exception ('Comments Count Query Query Failed', EX_QUERY_FAILED);
            }

            $row = $results->fetch_assoc();
            $total = $row['total'];
            parent::closeConnection($db);    

            return $total;

        }
        catch (Exception $e){
            throw $e;
        }
    }

    function deleteAllComments()
    {/*
     *  Return one record from the database by its id */

        $db = null;
        try
        {
            $db = parent::getConnection();
            $query = "delete from comments where article_id = $this->id";
            $results = parent::execSQL($query);
            if(!$results) {
                throw new Exception ('Deletion Query Failed', EX_QUERY_FAILED);
            }
            parent::closeConnection($db);
        }
        catch (Exception $e){
            throw $e;
        }
    }

    function getAllComments($conditions = ' ')
    {
        /* Retrieve all the records from the
         * database according subject to
         * conditions
         */
        $conditions = "where article_id = $this->id";
        $comments = Comment::getAll($conditions);
        return $comments; 
    }

    static function getTestData($url)
    {
        $page = file_get_contents($url);

    }

}
?> 
```

任何建议或意见表示赞赏，谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T22:31:30.143

使用结构创建另一个表 user_votes 例如： user_id int not null article_id int not null 主键（user_id，article_id）

在投票功能中首先尝试插入，如果插入成功则增加 $this->points

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T22:30:32.033

有一个表格来跟踪用户对文章的投票（例如 UserID、ArticleID、VoteTimeStamp）。然后您可以检查您的`$article->vote();`方法以确保当前登录的用户对该文章没有任何投票。

如果您想保持快速（因此您不必总是使用连接来获取投票计数），您可以有一个触发器（或自定义 PHP 代码），在添加/删除投票时更新您当前保留的总投票数在文章表中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T22:33:38.920

您有以下选择：

跟踪投票者的 IP，并将其存储在数据库中。这很糟糕，因为许多人可能会共享 IP，并且可以使用代理等手段来规避它。

另一种解决方案是在浏览器中存储 cookie。这可能比第一个解决方案好一点，因为它可以让来自同一 IP 的许多人投票。但是，也很容易绕过，因为您可以删除 cookie。

最后也是唯一安全的方法是要求您的用户注册投票。这样，您可以将用户名和密码与投票配对，并且可以确保每个人只投票一次，除非他们被允许拥有多个用户。

最后一个解决方案可能是前两个解决方案的组合，但它仍然是可阻碍的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T22:35:26.343

您可以有一个包含用户 ID 和文章 ID 的表，称为 article_votes。因此，当用户 x 对文章 ya 投票时，将插入两个 ID 行。这使您可以检查用户是否为文章投票。

要计算文章的数量，您可以使用如下查询：`SELECT COUNT(*) AS votes FROM article_votes WHERE article=[article id]`

# python - Eclipse PyDev：在站点包源中设置断点

> ID：558999
> 
> 赞同：5
> 
> 时间：2009-02-17T22:25:46.817
> 
> 标签：python, django, eclipse, pydev

我正在使用**Pydev**在 Django 中调试一个问题。
我可以毫无问题地在我的 django**项目代码****中设置断点**。 但是我**无法**在**Django 库源代码**（在站点包中）中设置断点。

 ******在这种情况下，PyDev 调试器用户界面在**我单击**设置断点时什么也不做，并且在我运行调试器时不会在该位置中断。

我错过了一些 PyDev 配置吗？在我使用的其他调试器中，此行为表明调试信息与源代码相关联的问题。关于下一步的任何想法都会有所帮助。

我还在 PyDev 中配置了**站点包**，使其位于我的**PYTHONPATH中**

如果有帮助，我将在 Max OS X 上使用 Eclipse。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T17:03:21.267

您是否已将 Django 源代码作为项目导入？为此，您只需创建一个新的 PyDev 项目并将其位置设置为 Django 源文件夹。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T02:06:51.047

嘿，这真是及时！Eric Moritz 刚刚宣布发布一种有趣的新方法来使用 pdb 调试视图，称为[django-viewtools](http://eric.themoritzfamily.com/2009/02/17/announcing-django-viewtools/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T00:54:32.530

您可以尝试在此实例中使用 Python 调试器 pdb。

这是一个描述它的有用链接：[http ://www.ferg.org/papers/debugging_in_python.html](http://www.ferg.org/papers/debugging_in_python.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-25T15:17:27.650

PyDev 1.5.5 似乎与 Eclipse 有问题。卸载 1.5.5 并安装 1.5.4 版本**********************************