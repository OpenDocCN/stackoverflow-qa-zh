# StackOverflow 问答 000557000-000557999

# eclipse - 如何在 Eclipse 中以编程方式在代码中插入行注释

> ID：557007
> 
> 赞同：2
> 
> 时间：2009-02-17T14:18:29.657
> 
> 标签：eclipse

我想以编程方式在我的代码中插入行注释。我正在访问一个方法声明，我想在它上面插入一行注释（或更多），使用方法的 AST。谁能给我一个如何做到这一点的代码示例？我已经搜索了很长时间，但还没有成功。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-10-31T18:19:06.887

我相信您可以使用 Eclipse AST API 以编程方式插入注释。您似乎已经在使用该 API，所以如果您坚持使用相同的 API，那就更好了。[这里](http://www.ibm.com/developerworks/opensource/library/os-ast/)有很多代码示例，其中之一是用于插入 Javadoc 的代码。我还是把它贴在这里：

```
Javadoc jc = ast.newJavadoc();
TagElement tag = ast.newTagElement();
TextElement te = ast.newTextElement();
tag.fragments().add(te);
te.setText("Sample SWT Composite class created using the ASTParser");
jc.tags().add(tag);
tag = ast.newTagElement();
tag.setTagName(TagElement.TAG_AUTHOR);
tag.fragments().add(ast.newSimpleName("Manoel Marques"));
jc.tags().add(tag);
classType.setJavadoc(jc); 
```

我相信这是一个足够的指导方针。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T21:55:08.093

这是我的做法：

```
void insertComment(String comment, OutputStream fos) throws IOException {
    String commentKeyword = "//";
    fos.write(commentKeyword.getBytes());
    fos.write(comment.getBytes());
    fos.write("\r\n".getBytes());
} 
```

我认为没有本地方法可以做到这一点......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T14:25:46.987

我能想到的以编程方式插入代码的唯一方法是打开 Filestream 并在特定指针位置写入文本文件。

# arrays - D 编程语言 char 数组

> ID：557011
> 
> 赞同：7
> 
> 时间：2009-02-17T14:19:46.440
> 
> 标签：arrays, d, dmd

这听起来可能很愚蠢。但我对 D 编程语言有一个奇怪的问题。当我尝试像这样创建一个新数组时：

```
import std.stdio;

void main()
{
    char[] variable = "value";
    writefln(variable);
} 
```

DMD 编译器总是给我这个错误：

> test.d(5)：错误：无法将不变量（char[5u]）类型的表达式（“值”）隐式转换为 char[]

知道为什么吗？我正在为 Ubuntu 使用 2.014 alpha（可[在此处](http://digitalmars.com/d/2.0/changelog.html)获得）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T14:24:10.800

我正在搜索指南的数组部分，这可能会有所帮助：

*[字符串是一个字符数组。字符串文字只是编写字符数组的一种简单方法。字符串文字是不可变的（只读）。](http://digitalmars.com/d/2.0/arrays.html#strings)*

```
char[] str1 = "abc";                // error, "abc" is not mutable
char[] str2 = "abc".dup;            // ok, make mutable copy
invariant(char)[] str3 = "abc";     // ok
invariant(char)[] str4 = str1;      // error, str4 is not mutable
invariant(char)[] str5 = str1.idup; // ok, make invariant copy 
```

从[这里](http://www.digitalmars.com/d/2.0/arrays.html)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-17T14:43:01.050

基本上，归结为字符串文字存储在内存的只读部分中。`char[]`是*“可变字符的可变数组”*，如果将其写入，将产生运行时崩溃。

所以编译器真的想在这里保护你。

`invariant(char)[]`意思是*“一个可变的不变字符数组”*，这正是它的本质。

**PS**：当你*不需要*它是一个`char[]`，你可能想使用`auto`，如，`auto variable = "value"`。让您无需考虑它的类型 :)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-02T03:23:11.903

使用 auto 并且不要担心类型是什么：

```
auto s = "some text"; 
```

让编译器担心类型。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-18T21:44:10.370

D 语言有两个主要版本。通常，它们相互不兼容，尽管*可以*编写代码以在两者中编译。

D1 是您提供的代码似乎是用它编写的。它没有不可变数组的概念，因此这是可行的。

D2 是您尝试将其编译为的内容，因此 2 开始编译器版本号。D2 特有的主要特性之一是 const 和不可变/不变数据引用的概念。

```
char[] text;              // mutable data
const(char)[] ctext;      // data may be mutable or immutable - but either way,
                          // it will not be changed through this reference
invariant(char)[] itext;  // immutable data 
```

D2 中的字符串文字被归类为不可变数据，因此不能分配给 char[]，而只能分配给`const(char)[]`or `invariant(char)[]`（或 wchar 或 dchar 等价物）。

`string`是 的别名`invariant(char)[]`，您可能希望使用它来方便或与 D1 兼容。

# apache-flex - 如何在 Flex Canvas 上停止针对子元素触发的 Mouse Out 事件

> ID：557028
> 
> 赞同：4
> 
> 时间：2009-02-17T14:22:29.697
> 
> 标签：apache-flex, actionscript-3, canvas, mouseout

我正在使用 Canvas itemRenderer 作为用于显示图像的容器。请参阅下面的伪代码。

```
image = new Image();
image.source = data.@thumb;
this.addChild(image);
this.addEventListener(MouseEvent.MOUSE_OVER, enlarge(image));
this.addEventListener(MouseEvent.MOUSE_OUT, shrink(image)); 
```

当我将鼠标悬停在画布上时，会调用放大功能。但是，只要我将鼠标移到图像或另一个子元素上，就会触发 MOUSE_OUT 事件。

谁能指出我禁用这种行为的方法？

谢谢 ：）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-17T14:45:08.017

您应该改用[`MouseEvent.ROLL_OVER`](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/flash/display/InteractiveObject.html#event:rollOver)和[`MouseEvent.ROLL_OUT`](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/flash/display/InteractiveObject.html#event:rollOut)事件。

来自 Flash CS4 文档：

> 当鼠标从不是其子对象之一的对象进入显示对象的区域或其任何子对象的区域时，显示对象将调度 rollOver 事件。这与 mouseOver 事件的行为不同，鼠标每次进入显示对象容器的任何子对象的区域时都会调度该事件，即使鼠标已经在显示对象容器的另一个子对象上也是如此。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:32:41.550

我同意乔什的观点，这些`ROLL_OVER`事件似乎更适合你正在做的事情。但是，您应该了解( 的祖先) 的[`mouseChildren`](http://livedocs.adobe.com/flex/3/langref/flash/display/DisplayObjectContainer.html#mouseChildren)属性。`flash.display.DisplayObjectContainer``UIComponent`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-08T12:33:48.210

推出对我有用。关于comboBox问题：还可以检查事件的目标是否是容器中的子项。

# xslt - XSLT：树片段的总和将始终返回 0 ！

> ID：557030
> 
> 赞同：1
> 
> 时间：2009-02-17T14:22:58.977
> 
> 标签：xslt, sum, rtf, node-set

我遇到了一个看起来很愚蠢的问题，但我找不到解决方案……使用 XLST，我需要对由模板计算的值列表求和。所以我将这些值存储在树结构中（根元素“Numbers”中包含的“Number”元素列表）。但是无论我尝试对这个自制列表做什么，它都不会返回任何内容、0 或错误......

有人知道我在做什么错吗？

```
<!-- create the tree fragment -->
<xsl:variable name="_subTotals">
    <Numbers>
        <xsl:for-each select="List">
            <xsl:variable name="_Size">
                <xsl:call-template name="GetSize">
                    <xsl:with-param name="_value" select="@value"/>
                </xsl:call-template>
            </xsl:variable>
            <Number>
                <xsl:value-of select="$_Size"/>
            </Number>
        </xsl:for-each>
    </Numbers>
</xsl:variable>

<!-- this returns an error: expression must result into a node-set -->
<xsl:message terminate="no">
    <xsl:value-of select="sum($_subTotals/Numbers/Number)"/>
</xsl:message>

<!-- transform the tree fragment into a node-set
<xsl:variable name="_Total" select="msxsl:node-set($_subTotals)"/>

<!-- returns nothing -->
<xsl:for-each select="$_Total/Numbers/Number">
    <xsl:message terminate="no">
        <xsl:value-of select="@value"/>
    </xsl:message>
</xsl:for-each>

<!-- returns 0 -->
<xsl:value-of select="sum($_Total/Numbers/Number)"/> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T14:42:30.707

递归是函数式语言中的常见答案。就像是：

```
<xsl:template name='totalRest>
  <xsl:variable nane='sub'>
    <!-- Use for-each to set local new context node -->
    <xsl:for-each select='following::List[1]'>
      <xsl:call-template name='totalRest'/>
    </xsl:for-each>
  </xsl:variable>
  <xsl:variable name='this'>
    <xsl:call-template name="GetSize">
      <xsl:with-param name="_value" select="@value"/>
    </xsl:call-template>
  </xsl:variable>

  <xsl:value-of select='$sub+$this' />

</xsl:template> 
```

在不了解更多 GetSize 和输入文档的情况下，很难更具体地确定正确的 XPath 以设置递归调用的上下文节点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T19:39:48.980

**这是一种如何对动态生成的值求和的快速方法**（可能您正在调用的模板没有产生预期的结果？如果是这样，您必须提出另一个问题并提供代码和代码运行的 XML 文档。没有这些没有人可以帮助，猜测也没有用。）：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ext="http://exslt.org/common"
 >
 <xsl:output method="text"/>

    <xsl:template match="/">
      <xsl:variable name="vrtfNums">
         <nums>
           <num>1</num>
           <num>2</num>
         </nums>
      </xsl:variable>

      <xsl:variable name="vNums" select="ext:node-set($vrtfNums)"/>

      <xsl:value-of select="sum($vNums/*/*)"/>
    </xsl:template>
</xsl:stylesheet> 
```

**当上述转换应用于任何 XML 文档（忽略）时，会产生所需的结果**：

```
3 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-23T10:04:49.890

就我而言，我遇到了完全相同的问题，即**sum($something/element)**返回 0 并且**sum($something/*)**返回正确的值。

我的问题是由以下 UBL Invoice 样式表声明引起的：

xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"

删除此行后，**sum($something/element)**返回了正确的值。

# .net - .NET + COM 改变了键盘路由行为

> ID：557038
> 
> 赞同：1
> 
> 时间：2009-02-17T14:25:14.993
> 
> 标签：.net, com, mfc, keyboard, cdialog

我有一个很奇怪的问题，以至于我几乎无法给它一个适当的标题。

简而言之：我有一个用 MSVC++/MFC 编写的 COM 对象，其中有一个从 CDialog 派生的对话框。在那个对话框中，我有三个子“用户控件”——从普通 CWnd 派生的窗口。

当我从各个地方使用这个 COM 对象时，一切都按我的预期工作。但是当我从 C# 应用程序（.exe 文件）中使用它时，键盘行为是不同的，或者我应该说坏了。

我的意思是：

*   当我的任何“用户控件”具有焦点时按下的每个键都会从某处产生“错误哔声”，即使我试图吞下 WM_KEYDOWN 消息
*   “用户控件”没有收到 WM_CHAR / OnChar，尽管 Spy++ 说有一个已发布
*   如果我在 OnKeyDown 和 OnChar 中首先放置一个 MessageBox，那么突然 OnChar 被调用并且在显示位于 OnKeyDown 中的第一个 MessageBox 之前它被调用
*   我可以通过从 OnKeyDown 发布消息来克服缺少 OnChar 被调用的问题，但我无法找到停止哔哔声的方法

与非 .NET 应用程序中使用的 COM 对象对话框相比，这完全是 CHANGED 行为。

我找到了一个我不太满意的工作，所以如果有人能对这个问题有所了解，我会很高兴！:-)

周围的工作是这样的。而不是创建我的“用户控件”，如下所示：

```
m_mheSpell.CreateEx(
    WS_EX_CLIENTEDGE,
    NULL,
    "",
    WS_CHILD|WS_TABSTOP|WS_VISIBLE|WS_VSCROLL,
    4,18,340,100,
    GetSafeHwnd(), (HMENU)3000 ); 
```

我将其更改为：

```
m_mheSpell.CreateEx(
    WS_EX_CLIENTEDGE,
    "Edit",  // <-- changed here
    "",
    WS_CHILD|WS_TABSTOP|WS_VISIBLE|WS_VSCROLL,
    4,18,340,100,
    GetSafeHwnd(), (HMENU)3000 ); 
```

然后我必须确保屏蔽键盘、鼠标和焦点消息，这样底层的编辑控件就不会干扰我。我只是害怕我会错过阻止一些重要的消息，并且用户会在我自己发现之前发现一些意想不到的行为......

简而言之：“某事”（与周围的 .NET 环境有关）认为我的“CWnd 控件”无法进行键盘处理并与我混淆。从“编辑”派生使这个“东西”改变了它的想法。例如，当周围的进程是 VB6 应用程序时，所有这些都不会发生。

有人吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T19:00:19.323

啊，我现在可以回答我自己的问题了：WM_GETDLGCODE *叹息*

# php - PHP 中的异常 - Try/Catch 或 set_exception_handler？

> ID：557052
> 
> 赞同：18
> 
> 时间：2009-02-17T14:27:55.063
> 
> 标签：php, exception

我正在我的系统中开发一些使用 php 异常类的多个子类的低端代码。本质上，我将例外分为几类。我想做的是两件事。

1.  我需要在一个地方处理应用程序中触发的所有异常。
2.  我需要能够记录并处理/生成视图，以便用户接收有关应用程序的反馈。错误。

我想知道的是我应该有某种封装应用程序的 try/catch 吗？我根本不喜欢这个想法，这听起来像是一个非常糟糕的实现。我也不喜欢 set_exception_handler 的想法，除非我可以将函数设置为对象的方法。这样做的原因是，如果我指定一个函数来处理异常，这将是应用程序中的第一个函数。其他一切都是对象的方法。

希望我已经提供了有关该场景的足够详细信息。我正在努力保持清洁并遵循最佳实践。这段代码将使用 OSS，所以我不想写 10 次 :)

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-17T14:39:39.327

1.  通过[前端控制器脚本运行您的网络请求](https://stackoverflow.com/questions/20277102/proper-separation-difference-between-index-php-and-front-controller/20299496#20299496)
2.  在执行早期调用[`set_exception_handler`](http://www.php.net/set_error_handler)（不要忘记考虑`error_reporting()`）。`set_exception_handler`将 php 称为[“回调”](http://www.php.net/manual/en/language.pseudo-types.php#language.types.callback)的内容作为其参数。您可以像这样传递对象方法：

    ```
    // $object->methodName() will be called on errors
    set_exception_handler(array($object, 'methodName')); 
    ```

3.  包装您的调度代码`try/catch`以捕获任何确实引发异常的代码。由于您在上面的调用，您的代码的 catch 部分将捕获您自己的代码的所有异常，以及*一些*本机未生成异常的 php 错误（例如`fopen`或其他东西） 。`set_exception_handler`php手册指出：

    > 用户定义的函数无法处理以下错误类型：E_ERROR、E_PARSE、E_CORE_ERROR、E_CORE_WARNING、E_COMPILE_ERROR、E_COMPILE_WARNING，以及在调用 set_error_handler() 的文件中引发的大部分 E_STRICT。

4.  根据需要记录错误。

5.  创建一个在异常对象（“模型”）上运行的错误页面模板（“视图”），并在开发中为您漂亮地打印整个堆栈跟踪。创建一个用于生产的不同模板。在您的环境中分支，例如：

    ```
    catch(Exception $e) {
        // log error as necessary here.
        if("in developement") {
            // $e would be available to your template at this point
            include "errortemplates/dev.php";
        } else {
            include "errortemplates/prod.php";
        }
    } 
    ```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-17T15:10:17.537

[这里](http://us2.php.net/manual/en/language.pseudo-types.php#language.types.callback "这里")有更多关于 PHP 的“回调”的具体信息。要使用静态方法，回调类似于

```
<?php
set_exception_handler(array('MyClass','staticMethod'));
?> 
```

要使用实例化对象中的方法，它是：

```
<?php
set_exception_handler(array($myObject, 'objectMethod'));
?> 
```

要使用全局函数，只需：

```
<?php
set_exception_handler('my_global_function');
?> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T14:40:48.340

从听起来的方式来看，您将使用 set_exception_handler。这将保证以完全相同的方式处理所有异常。在你的应用程序中有一些地方可以使用 try/catch 块，例如，如果你想检查一个不一定需要以相同方式捕获的异常。

至于设置 set_exception_handler，我不确定是否可以将函数设置为对象的方法，除非它是静态方法。看来情况确实如此。[在http://us2.php.net/set_exception_handler](http://us2.php.net/set_exception_handler)有更多信息

# .net - 将大型 MFC 应用程序转换为 .net

> ID：557055
> 
> 赞同：3
> 
> 时间：2009-02-17T14:28:22.083
> 
> 标签：.net, mfc

我们有一个大小合适的 MFC MDI 桌面应用程序。有没有一种合理的方法可以将 MFC 应用程序转换为 .net 应用程序，还是只重写更好？如果答案是特定于应用程序的，那么您使用什么标准来做出决定？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:29:48.783

我会跳过 WinForms 并直接使用 WPF。

根据您的应用程序的设计方式，您不必重写所有内容。您可以使用托管 C++ 包装器从 C# 代码调用 C++ 代码，从而允许您重用现有的 C++ 代码。Microsoft 也有[大量](http://msdn.microsoft.com/en-us/library/ms742522.aspx)关于 WPF 和 Win32/MFC 之间互操作的文档。你可以用 WinForms 做类似的事情。

Microsoft 已经竭尽全力提供从 MFC 到 WinForms/WPF 的迁移路径，因为他们知道公司不能仅仅丢弃多年开发的代码。

此外，如果您搜索“WPF 和 MFC”，您会发现很多人在同一个项目中使用这两种技术的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T15:18:13.273

当从 MFC 移植到 WinForms 时，您将不得不重写 UI 代码，如果您在 UI 和业务逻辑之间有很好的分离，您最好通过使用托管 C++ 或将其转换为 C# 来移植业务逻辑（语法是只是足够相似以使其成为可能）。

我已经为一个小型 MFC 应用程序完成了此操作，我通过将 C++ 代码粘贴到 ac# 文件中并修复代码直到它开始工作，将业务逻辑移植到 c#，我从头开始重写了 GUI。

事实证明，这是一个非常聪明的举措，因为我们不断将其开发成一个大型应用程序，最终结果比我们在同一时间表中在 MFC 中所做的任何事情都要好得多。

我们还有一个巨大的 MFC 应用程序，在 UI 和业务逻辑之间没有明确的分离，我们想将它移植到 .net，但还没有弄清楚如何去做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T14:49:04.047

这肯定是重写，但 MFC 中的许多概念都有 .NET 对应物，因此您可以映射很多域模型。我会使用 Windows 窗体，因为它可以轻松映射到 MFC 提供的相同 Win32 样式 UI。

如果您的 MFC 应用程序很好地分离了域模型和业务规则，您甚至可以使用 C++.NET 来重用其中的一些代码，并且要么保持非托管，要么将其转换为托管类，然后可以选择将其转换为 C# .

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T15:25:24.723

请参阅我对这个问题的回答，它与[这个问题](https://stackoverflow.com/questions/10901/future-proofing-a-large-ui-application-mfc-with-2008-feature-pack-or-c-and-wi/11004#11004)基本相同。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2011-09-10T16:26:55.440

在考虑从 MFC 到 WPF 的转换时，我花了很多时间研究 C#、WPF、Expression Blend、MVVM。

如果您想失去 50% 的 MFC 功能，并在完成后拥有一个非常复杂、非常缓慢的应用程序，那么 WPF（VS 2010）是有意义的。没有 MDI。

MVVM 的开销太大而无法实用。

收益：垃圾收集、可调整大小的对话框、XAML 和更多数据绑定选项几乎不值得。

最近对 MFC 的升级，添加了一个功能区栏（优于 Expression Blend 中的功能区栏创建）给了我我想要的一切。

简而言之，从 MFC 转换到 WPF/.NET 是一个坏主意；忘掉它。

不要放弃 MFC Microsoft，否则你会让人跳槽。（WTF?????）

# c# - 在预印证书上打印数据

> ID：557058
> 
> 赞同：1
> 
> 时间：2009-02-17T14:28:41.443
> 
> 标签：c#, asp.net, reportviewer

我有空白的预印证书，我想在我的 asp.net 应用程序的受尊重位置上的证书顶部打印数据。我正在使用 asp.net 2.0 和报告查看器。你能指导我如何做到这一点。空白证书上数据的定位很重要。

问候

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T14:34:10.820

用尺子测量空白证书，并将您的`TextBox`es 和其他对象设置为这些精确的测量值。确保您也正确设置了页面尺寸并考虑了边距。另外，请记住，您可能希望将`TextBox.AutoSize`属性设置为，`false`以便您可以正确排列。

另一种选择是在设计时扫描整个页面并将其加载为报告模板的临时背景图像。这样你就可以更好地看到你在做什么。但我不会指望它是 100% 准确的，因此请相信您对扫描图像的测量。

测试时，请尝试将一张普通的白纸剪成相同尺寸。您应该能够将它放在强光下，看看是否排列整齐，而不会浪费您的证书纸。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T14:35:01.130

好吧，如果证书“便宜” - 只需打印和测试。

如果它们很贵.. - 扫描证书 - 在查看报告时将其用作背景（作为打印页面） - 对其进行测试并在需要时进行修复 - 在没有背景的白纸上打印 - 与证书一起查看并在需要时修复

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T15:15:05.577

几年前，我使用 Reporting Services 2005 为点阵打印机上的编号凭证进行了此操作。我不会假装它简单或容易，但绝对可以做到。

正如其他人所说，您可能最好找到一种方法来获取您自己的真实证书的“虚拟”副本，这样您就可以在获得 80% 或 95% 的方式到达您需要的地方时犯下小错误.

要意识到的最重要的事情是 Visual Studio 报表设计器和报表*查看器*不会呈现完全相同的布局。他们应该吗？是的。他们有吗？不。

因此，您在屏幕上看到的内容必须被视为输入到您和打印机之间的黑匣子中，并且需要进行调整以使其完全正确。

为此，我发现完全放弃 Visual Studio 设计器来编写报告实际上要容易得多，而是直接在文本/XML 编辑器中编辑 RDL（即使它实际上是 Visual Studio）。

阅读和使用它相对简单，并为您提供最清晰的可见性，以进行其他答案提到的那种特定于测量的调整。你基本上不希望*任何东西*被自动调整大小，否则你会得到奇怪的结果。

您还希望确保使用每个值的不同长度运行测试。在我的凭证上，当一个非常长的公司名称出现并包装时，初稿看起来很糟糕，导致一堆其他东西移动。

不过，最重要的是，这是可以做到的，而且以前已经做到了。这将是乏味的，但有可能。祝你好运。

# reporting-services - 使用 Kerberos 在 Reporting Services 中设置 Windows 身份验证

> ID：557061
> 
> 赞同：0
> 
> 时间：2009-02-17T14:29:17.447
> 
> 标签：reporting-services, reportingservices-2005

我对报告服务还有另一个问题。最后，我能够设置滚动，成功地使用域用户帐户配置报告服务。现在我在使用IIS 6.0 中的**集成 Windows 身份验证从另一台机器（在同一域中）访问服务器时遇到问题。**

在使用 NT 身份验证的网络上，我从来没有遇到过这个问题，但这是我们的网络第一次设置为使用 Kerberos。这是我的 IIS 设置 -

1.  默认网站下的 Reports (Manager) & ReportServer 虚拟目录，
2.  这两个都配置为使用集成 Windows 身份验证运行。匿名访问已关闭。
3.  Reporting Services Windows 服务在网络服务帐户下运行，Web 服务在域用户帐户下运行。

注意 - 如果我打开基本身份验证，它工作正常，超出了我的所有期望，但这不是我想要的。

任何帮助表示赞赏。

谢谢维内特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T17:26:44.053

找到了，它的工作原理就像 NT 身份验证一样，需要三个额外的步骤 -

要使用 Kerberos，您需要考虑以下具体细节：

您必须在 Windows 2000 或更高版本上运行客户端和服务器计算机，并且它们必须位于 Windows 2000 或更高版本的域中。1\. 您必须启用客户端的用户帐户才能进行委派。2\. 您必须启用服务的帐户才能进行委派。3\. 您必须启用参与计算机进行委派。

以上解决方案是微软网站的摘要，这里是链接 - [http://msdn.microsoft.com/en-us/library/aa292114(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa292114(VS.71).aspx)

我得到了这个设置，我的工作正常，尽管我已经要求网络人员将其更改为 NT，因为它很容易在较长时间内维护，并且可以避免为每个单独的用户设置委派（Kerberos 必须）的痛苦。

干杯！！

# ruby-on-rails - Ruby on Rails：具有多步形式的回形针

> ID：557063
> 
> 赞同：2
> 
> 时间：2009-02-17T14:29:43.953
> 
> 标签：ruby-on-rails, ruby, upload, paperclip

我正在使用用于导轨的精细回形针插件。到目前为止一切都很好，用户可以上传图片。

现在我想要在保存模型之前执行一个额外的步骤，要求上传者确认图像看起来正确。

这可能与回形针有关吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T14:43:16.853

如果您真的不希望图像在用户检查之前进入您的数据库，您可以使用 JavaScript 立即显示图像。否则，您需要将其保存在后端的某个位置，无论是通过 Paperclip 还是其他方式。

如果您只想使用 Rails 而没有 JavaScript，我只需保存图像，将其显示给他们，然后让他们选择删除它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T02:50:51.860

@Dave 听起来是个不错的计划。

@tliff 实施戴夫计划的另一种方法：

*   要查询的图像模型上的布尔字段
*   如果用户满意，则将布尔字段设置为 true
*   测试上述布尔值的命名范围为真
*   显示图像时使用所述命名范围。

我知道回形针有一个可以挂钩的后处理步骤，它也可能派上用场。

# python - python中快速而肮脏的条形图？

> ID：557069
> 
> 赞同：2
> 
> 时间：2009-02-17T14:30:39.723
> 
> 标签：python, graphing, stripchart

我有一些 python 代码经常接收包含时间戳和边缘转换的消息，无论是从低到高还是从高到低。我想在条形图上绘制每个转换，以便以最少的努力快速而肮脏地可视化数字波形。

您能推荐任何可以简化此操作的方法或软件包吗？

我也不反对以例如 csv 格式导出数据并将其加载到另一个程序中，如果这样更容易的话。

编辑：

尝试开罗情节：

```
>>> data = [(10, 0), (11, 1), (12.5, 0), (15, 1)]
>>> def fn(t):
...     for d in data:
...             if t > d[0]:
...                     return d[1]
...     return data[-1][1]
...
>>> CairoPlot.function_plot( 'tester.png', data, 500, 300, discrete = True, h_bounds=( data[0][0],data[-1][0]), step = 1 ) 
```

这将我的 CPU 固定在 100% 的时间超过 10 分钟，并且一直在消耗内存。我在它用完所有交换之前杀死了它。我做错了什么还是 CairoPlot 刚刚坏了？

进一步编辑：

我现在有了使用 CairoPlot 的更可行的东西，大致基于上面的代码。然而，由于分辨率的原因，它并不完美：我可能需要高达数十纳秒 (1e-8) 的分辨率才能捕捉到一些较短的脉冲。对于多秒图，此方法需要*很*长时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T19:04:22.747

[Matplotlib](http://matplotlib.sourceforge.net)可能会工作。看看这个[带状图表演示](http://matplotlib.sourceforge.net/examples/animation/strip_chart_demo.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T14:35:19.680

我自己没用过，但也许[Cairo Plot](http://linil.wordpress.com/2008/06/14/cairoplot-plotting-graphics-using-python-and-cairo/)值得一看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T14:52:53.023

您可以尝试使用 CairoPlot：

```
import CairoPlot

#the data list stands for your low-to-high (1) and high-to-low (0) data
data = lambda x : [0,0,1,1,0,0,1][x]
CairoPlot.function_plot( 'Up_and_Down', data, 500, 300, discrete = True, x_bounds=( 0,len(data) - 1 ), step = 1 ) 
```

有关更多信息，请查看[CairoPlot](http://linil.wordpress.com/2008/09/16/cairoplot-11/)

编辑：

我不明白你的函数 fn(t) 在这里。function_plot 的想法是绘制函数而不是向量。

要绘制这些点，您可以这样使用 function_plot：

```
#notice I have split your data into two different vectors,
#one for x axis and the other one for y axis
x_data = [10, 11, 12.5, 15]
y_data = [0, 1, 0, 1]

def get_data( i ):
    if i in x_data :
        return y_data[x_data.index(i)]
    else :
        return 0

CairoPlot.function_plot( 'Up_and_Down', get_data, 500, 300, discrete = True, x_bounds=( 0,20 ), step = 0.5 ) 
```

我想这会奏效

对于 100% 固定的 CPU，这不应该发生……我今天晚些时候再看看。谢谢指点\o_

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-01-10T05:49:55.547

```
#simple stripchart using pygame
import pygame, math, random                   
white=(255,255,255)                             #define colors                      
red=(255,0,0)
pygame.init()                                   #initialize pygame
width=1000
height=200
size=[width,height]                             #select window size
screen=pygame.display.set_mode(size)            #create screen
pygame.display.set_caption("Python Strip Chart")
clock=pygame.time.Clock()
data=[]
for x in range (0,width+1):
        data.append([x,100])

# -------- Event Loop -----------
while (not pygame.event.peek(pygame.QUIT)):     #user closed window
        for x in range (0,width):
                data[x][1]=data[x+1][1]       #move points to the left
        t=pygame.time.get_ticks()            #run time in milliseconds
        noise=random.randint(-10,10)         #create random noise
        data[width][1]=100.-50.*math.sin(t/200.) +noise #new value
        screen.fill(white)                         #erase the old line
        pygame.draw.lines(screen, red, 0,data,3)   #draw a new line
        clock.tick(150)                            #regulate speed
        pygame.display.flip()                  #display the new screen
pygame.quit ()                                #exit if event loop ends 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T16:07:12.890

[http://bitworking.org/projects/sparklines/](http://bitworking.org/projects/sparklines/)为您提供了一个小图表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T16:17:38.123

[GnuPlot](http://www.gnuplot.info/)是一个古老的可靠答案，带有很多选项的简单图形。我相信有 python 绑定，但导出数据并通过常规 gnuplot 运行它可能更容易。这是一个古老的[快速入门文档](http://parand.com/docs/gnuplot.html)。

我还在使用[matplotlib](http://matplotlib.sourceforge.net/)处理更大的数据量时取得了巨大的成功。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-30T02:44:04.523

对于仅使用 tkinter（不需要外部包）的实时条形图应用程序，请参阅[What is the best real time plotting widget for wxPython?](https://stackoverflow.com/questions/457246/what-is-the-best-real-time-plotting-widget-for-wxpython/7605072#7605072) .

如果我理解您的问题，您将实时接收具有纳秒分辨率时间戳的消息，但您不希望每秒看到 10^9 条消息。如果平均消息速率较低（每秒 100 条消息或更少），我将忽略时间戳并一次绘制一条消息的转换。如果图形时间尺度为每像素 10 毫秒，则将在 40 毫秒内绘制 4 次转换，但至少您不会错过看到发生的事情。

# asp.net - 从 ascx.cs 创建 Web 用户控件

> ID：557073
> 
> 赞同：1
> 
> 时间：2009-02-17T14:31:49.580
> 
> 标签：asp.net, user-controls

我正在尝试从另一个用户 Web 控件背后的代码创建用户 Web 控件的实例。

使用 ASP.NET；

```
 placeholder1.Controls.Clear();
            module_userWebControl_ascx slModule = (module_userWebControl_ascx)LoadControl("~/module/module_userWebControl.ascx");
            placeholder1.Controls.Add(slModule); 
```

2.0 框架有问题吗？

错误：找不到类型或命名空间名称'module_userWebControl_ascx（您是否缺少 using 指令或程序集引用？）

**请添加命名空间或对解决方案的引用。其他解决方案不包含命名空间，我还没有添加评论的声誉。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T14:37:17.210

我看起来您放置该代码的页面不属于用户控件的同一命名空间。

尝试：

```
(usercontrolNamespace.module_userWebControl_ascx)LoadControl("~/module/module_userWebControl.ascx"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T14:38:58.157

试试这个 ：

```
UserControl uc = new UserControl();
uc.LoadControl(Server.MapPath("module/userWebControl.ascx"));

placeholder1.Controls.Add(uc); 
```

希望能帮助到你 ！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T15:10:52.683

添加`<%@ Reference Control="~/module/module_userWebControl.ascx" %>`到父控件的 ascx

# php - 目录重组后 Javascript 未触发

> ID：557077
> 
> 赞同：0
> 
> 时间：2009-02-17T14:33:03.867
> 
> 标签：php, javascript, jquery, html

好的，情况就是这样。我正在开发一个网站，该网站允许人们将内容上传到数据库，然后将这些内容拉到首页，以便人们可以看到它们。这是一个非常简单的网站，我让它运行得非常好，但为了简单起见，我在 ../html/backend 上开发所有东西，并确保在它准备好上线之前没有任何东西被爬取。

所以一旦我完成了，我更改了 dir 结构以将所有内容都放在 /html 根目录中，除了允许人们输入信息的表单，我将它保存在 /backend。

这就是我遇到问题的地方，表单显然是在 html 中并且它收集信息，然后我有一个 jquery java 脚本在按钮按下时触发，它对执行实际 INSERT 的 php 文件执行 ajax PUT。（别担心，我也在 php 文件中进行验证）但自从移动脚本不会触发。

是的，我更改了脚本和 jquery 文件的路径，我可以确认脚本正在正确加载。

我已经为此苦苦挣扎了好几天，我确定这是我忽略的一些愚蠢的东西……有什么想法吗？多谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T14:35:02.270

使用 Firebug 或其他调试器来查找问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T16:00:51.237

所以我是一个彻头彻尾的白痴。我更改了加载我的 jquery 根目录的头文件，并将其移动到依赖 jquery 的其他脚本之下。将我的 jquery rel 移到顶部，嘿，我们又开始营业了。

FML

# c# - 在哪里可以找到 C# 的 ICQ 库？

> ID：557080
> 
> 赞同：5
> 
> 时间：2009-02-17T14:33:45.377
> 
> 标签：c#, .net, protocols, instant-messaging

是否有任何（最好是本机）C# 库允许我通过 ICQ 协议发送一些消息？有什么比包装 libgaim 更好的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T14:50:42.980

也许这可以帮助你：

[http://sourceforge.net/projects/oscarlib/](http://sourceforge.net/projects/oscarlib/)

下载源代码并检查 OscarLib。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T14:35:26.357

我知道没有任何库，因此如果您想在 C# 中执行此操作，您可能必须自己制作。[您可以在此处](http://iserverd.khstu.ru/oscar/)找到 ICQ 协议规范。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T14:51:48.580

您可以尝试使用 Across Communications 网络服务。

示例：[http ://www.acrosscommunications.com/DevSampleCS.aspx?Object=SOAP:ICQ&Detail=-sample-&Lang=CS](http://www.acrosscommunications.com/DevSampleCS.aspx?Object=SOAP:ICQ&Detail=-sample-&Lang=CS)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-28T21:36:33.837

尝试使用 Icq# - [http://icq-sharp.sourceforge.net/](http://icq-sharp.sourceforge.net/)

# c++ - 如何获取当前执行代码的 HMODULE？

> ID：557081
> 
> 赞同：38
> 
> 时间：2009-02-17T14:33:58.280
> 
> 标签：c++, c, winapi

我有一个静态库，可以链接到 a`.exe`或 a `.dll`。在运行时，我希望我的库函数之一能够获取`HMODULE`静态库代码已链接到的任何内容。

我目前使用以下技巧（受此[论坛](http://www.ureader.com/message/1095160.aspx)启发）：

```
const HMODULE GetCurrentModule()
{
    MEMORY_BASIC_INFORMATION mbi = {0};
    ::VirtualQuery( GetCurrentModule, &mbi, sizeof(mbi) );

    return reinterpret_cast<HMODULE>(mbi.AllocationBase);
} 
```

有没有更好的方法来做到这一点，看起来不那么hacky？

*（注意：这样做的目的是加载一些我知道我的用户将与我的静态库同时链接的 Win32 资源。）*

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-02-17T17:12:17.667

```
HMODULE GetCurrentModule()
{ // NB: XP+ solution!
  HMODULE hModule = NULL;
  GetModuleHandleEx(
    GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS,
    (LPCTSTR)GetCurrentModule,
    &hModule);

  return hModule;
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-17T17:28:00.607

`__ImageBase`是链接器生成的符号，它是模块的 DOS 标头（仅限 MSVC）。从那里您可以将其地址转换为`HINSTANCE`or `HMODULE`。所以它比通过 API 更方便。

所以你只需要这样做：

```
EXTERN_C IMAGE_DOS_HEADER __ImageBase;
#define HINST_THISCOMPONENT ((HINSTANCE)&__ImageBase) 
```

来自[https://devblogs.microsoft.com/oldnewthing/20041025-00/?p=37483](https://devblogs.microsoft.com/oldnewthing/20041025-00/?p=37483)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T16:03:26.753

我会考虑`GetModuleHandleEx()`使用 flag `GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS`。看起来您可以更改`GetCurrentModule()`为调用此例程而不是`VirtualQuery()`，并将地址`GetCurrentModule()`作为`lpModuleName`参数传递。

预计到达时间：

```
const HMODULE GetCurrentModule()
{
    DWORD flags = GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS;
    HMODULE hm = 0;
    ::GetModuleHandleEx( flags, reinterpret_cast<LPCTSTR>( GetCurrentModule ), &hm );   
    return hm;
} 
```

我没有尝试过，但我认为这会做你想要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-08-19T00:58:16.733

```
#if _MSC_VER >= 1300  // for VC 7.0 
#ifndef _delayimp_h 
extern "C" IMAGE_DOS_HEADER __ImageBase; 
#endif
#endif
... 
HMODULE module() 
{ 
#if _MSC_VER < 1300  // earlier than .NET compiler (VC 6.0) 
    MEMORY_BASIC_INFORMATION mbi; 
    static int address; 
    ;::VirtualQuery(&address, &mbi, sizeof(mbi)); 
    return reinterpret_cast(mbi.AllocationBase); 
#else  // VC 7.0 
    // from ATL 7.0 sources 
  return reinterpret_cast(&__ImageBase); 
#endif 
} 
```

更多在这里[https://www.apriorit.com/dev-blog/74-hmodule-hinstance-handle-from-static-library-in-c](https://www.apriorit.com/dev-blog/74-hmodule-hinstance-handle-from-static-library-in-c)

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-02-17T16:09:25.977

HMODULE 是 HINSTANCE 是模块的基地址。所以，我会看看它是如何工作的。但是，如果您想要的只是可执行文件的 HMODULE，为什么不枚举进程中的所有 HMODULE（EnumProcessModules）。其中之一将链接您的 .lib。

我看到的限制是您不知道您的 .lib 来自哪个 DLL 或 EXE。您可能希望将 HMODULE（基地址）与从 .lib 获得的 _ReturnAddress 进行比较。您的 .lib 将属于小于您的 _ReturnAddress 的最高 HMODLUE

# .net - 如何调试.net 垃圾收集？

> ID：557088
> 
> 赞同：10
> 
> 时间：2009-02-17T14:35:01.053
> 
> 标签：.net, debugging, garbage-collection

是否可以查看**调用 GC.Collect() 时收集的所有 .net 对象？**

我需要查看哪些对象仍在内存中且未回收，因此我可以找到应该手动回收对象但被程序员遗忘的位置。
我不想调用 GC.Collect，因为某个地方的某个人忘记了处理一个阻塞某些句柄的对象。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T14:42:06.607

我发现最好的方法是使用 windbg 和 SOS（罢工之子）扩展。它有一个相当神秘的命令行，但它非常强大。它具有转储堆并将其除以 GC 分代堆的能力。一旦你通过了最初的学习曲线，就很容易在堆的哪个部分跟踪哪些对象是活动的。以下是一些使用 SOS 示例的网站

*   [http://blogs.msdn.com/tess/archive/2005/11/25/dumpheap-stat-explained-debugging-net-leaks.aspx](http://blogs.msdn.com/tess/archive/2005/11/25/dumpheap-stat-explained-debugging-net-leaks.aspx)
*   [http://geekswithblogs.net/.NETonMyMind/archive/2006/03/14/72262.aspx](http://geekswithblogs.net/.NETonMyMind/archive/2006/03/14/72262.aspx)
*   [http://dotnetdebug.ne​​t/2005/07/04/dumpheap-parameters-and-some-general-information-on-sos-help-system/](http://dotnetdebug.net/2005/07/04/dumpheap-parameters-and-some-general-information-on-sos-help-system/)

**EDIT** OP 询问了 sos.dll 的位置。它包含在 .Net Framework 的安装中。它位于

> %WINDIR%\Microsoft.Net\Framework\V2.0.50727\sos.dll

但是一旦你加载了windbg，你就不需要完整的路径了。只有我们 .loadby 方法。

> .loadby sos mscorwks.dll

它将在与当前版本的 mscorwks（CLR）相同的目录中查找 sos 的版本

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T14:43:31.813

我使用[SciTech 的 Memory profiler](http://memprofiler.com/)。立即使用有点复杂，但是有一些很好的教学视频。它会让您查看哪些对象没有正确处理，它们是在哪一代收集的。没有它就无法调试内存泄漏...

# debugging - 在严格的时间限制下修复错误

> ID：557094
> 
> 赞同：12
> 
> 时间：2009-02-17T14:36:11.067
> 
> 标签：debugging

最近我不得不修复一个从现场报告的错误。当测试团队试图重现这个问题时，客户正在扼杀我们的脖子，我们必须在一周的时间内完成生产就绪的代码。当我们终于能够重现该问题时，只剩下 3 天了。我和我的同事不得不投入近 30 个小时的不间断努力来寻找原因并在不是我们编写的代码中进行修复。幸运的是我们做到了。但是，我担心的是测试团队没有足够的时间来运行他们通常的测试用例。我们不得不忽略代码中的其他小错误以限制代码更改。

我想从社区了解在这种时间紧迫的条件下应遵循的最佳实践。是否可以忽略其他问题（这不是您正在处理的错误的原因）？如何尽可能限制遗留代码中的代码更改，以便我不必担心只能进行最少的测试。连续工作而没有足够的休息时间也会增加它的问题。请分享您的想法和经验。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T14:53:33.333

这里已经有一些很好的建议，但我想补充一点：

如果您只是在极大的时间压力下完成了一个错误修复，请记住在压力关闭时返回并查看该修复，以确保它不仅仅是一个可怕的黑客，而是一个真正问题的创可贴。

早在 1980 年代后期，我修复了一个在一个非常古老的程序中很深的错误。但在一个曾经有效的情况下，它并不能正常工作。当我进一步调查时，我发现一个“临时”工作已经到位。评论说：

```
C TEMPORARY WORK-AROUND UNTIL I FIND THE REAL CAUSE.  I CHARNY, SUMMER STUDENT, AUG 1971 
```

当我发现这个 15 岁以上的“临时解决办法”时，Irv Charny 是我的老板。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-17T14:42:14.983

一个最佳实践很明显**，不要**“在没有足够休息的情况下继续工作”

另一个是让你商业化并使用一些常识，你引入另一个严重或更严重的错误的风险是什么？客户对此有何反应？如果您解释需要更多时间，客户会如何反应？权衡答案并做出商业/执行决定。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-17T14:39:25.973

无论您做什么，**[您的软件都会包含错误](http://c2.com/cgi/wiki?BugFreeSoftware)**。

你所能做的就是在你的老板/公司指定的时间限制内做到最好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-17T15:04:59.657

这个问题给我带来了许多担忧。

就通宵工作以尝试解决问题而言，我一直“在那里，做到了”。我可以免费告诉你你可能已经知道的事情——凌晨 3 点你的想法还不是很清楚，你的修复很可能会导致比他们解决的更多的问题。

不仅如此，在一种助长这种疯狂的工作文化中，您通常会在第二天早上 8 点出现，准备好继续 100% 付出。当你年轻的时候，你的身体会应付一定的量，但在你 20 多岁的时候，你会产生严重的副作用。哎呀，即使你还年轻，你也只能这么长时间不睡觉。如果您在睡眠不足的状态下驾驶，最终可能会导致您丧生。

我希望您能为贵公司的管理层提供一个好的商业案例，以便更明智的做法。几乎所有客户（无论多么咄咄逼人）都可以确信，与其在软件上冒着巨大的缺陷风险，不如等待一周。在极少数情况下，通宵编码马拉松可能没问题，但当它变得司空见惯时，每个人都会受苦。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-17T17:09:10.170

AnthonyWJones 上面评价很高的答案基本上是正确的

> 另一个是让你商业化并使用一些常识，你引入另一个严重或更严重的错误的风险是什么？客户对此有何反应？如果您解释需要更多时间，客户会如何反应？权衡答案并做出商业/执行决策

但是，“权衡”答案意味着什么？这意味着您开始按**字面意思为事物分配权重：**您停下来，休息一下，列一个清单并思考一下。你应该告诉客户这是不可能的吗？一个小错误会成为你在长达一周的疯狂奔波中引入的阻碍因素的风险是什么？

显然，没有固定的答案，但总的来说，我尽可能快地工作，但不会更快。一些客户只是为了好玩而垂头丧气，但其他错误非常重要，以至于修复它们的其他错误都**无关紧要。**没有客户的帮助，您无法确定这一点。请记住，**你们都在朝着同一个目标努力。**

如果客户太忙而无法与您交谈，您应该（通过电子邮件或血迹等）解释您将缩短 QA 并可能在此过程中引入其他错误。您需要简单地谈谈那些**比所讨论的错误更重要的可能性。**你有经验并且知道你在做什么（在某种程度上），所以你必须帮助客户了解他们要求的东西有多疯狂（或不疯狂）。

无论如何，在啰嗦了一下之后，我的观点是：**你的工作是保持冷静并做好你的工作。我怀疑通过连续工作很多天，您实际上会更快地发现错误**：您可能试图走得太快。您的工作也是告知您的客户什么是可能的，什么不是，以及每个决定会带来哪些风险。但是比你最快的速度更快——比如不休息——是没有意义的，对任何人都没有帮助。

### 但在所有情况下，都没有什么可以让你失去禅意的。曾经。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-17T15:03:36.477

如果您觉得客户压力迫使您在没有充分测试/审查的情况下修复错误并进行部署，我建议告诉客户该错误已修复但未经过全面测试。告诉他们全面测试需要多长时间并让他们选择。如果 bug 真的像他们所说的那样重要，他们几乎肯定会立即部署 - 但这将是他们的选择，如果以后出现问题，他们更有可能了解发生了什么。如果他们对不那么重要的事情施加压力，希望他们能让你先测试一下。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-17T14:43:22.453

当你面临极大的时间压力时，你必须让它发挥作用。即便如此，检查您的解决方案以确保它真正解决问题至关重要。您必须了解所涉及的代码，知道问题是如何发生的，并确保您的修复是正确的。补丁经常被匆忙发布，只是为了不正确并导致*另一个*快速补丁。

至于一路上遇到的问题……记下来，继续前进。一定要回到他们身边，但暂时离开他们，除非他们对当前问题有影响。

总而言之，这是一个丑陋的情况，没有优雅的解决方案。只要确保您朝着没有遇到此类问题的方向前进。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-17T14:44:43.790

在您开始使用之前，该应用程序已经使用您*常用的测试用例进行了测试。*因此，如果您只有一小段时间可以进行特定更改，那是您应该进行的唯一更改。虽然您应该彻底测试该案例，并尽可能多地进行回归测试，但您可能会没事的。

您可能想向您的老板推荐的一件事是看到遗留代码，提到您在代码中发现了其他小缺陷，也许您应该在应用程序上运行维护版本。这样，您可以返回并更加小心，清理您发现的其他问题，并有时间进行全面测试。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-17T14:45:16.363

如果您发现源代码中有问题，但从未产生过问题，请不要在未经广泛测试的情况下修复它！

您可能会发现从未调用过错误的代码，但也可能在其他地方出现问题，即“修复”此错误，并且更改源代码以执行正确的操作可能会破坏应用程序！

因此，如果您没有足够的时间进行测试，请不要修复与您当前问题无关的东西！注意这些东西，稍后通过广泛的测试修复它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-17T15:12:28.747

在最初的错误修复版本完成后，没有什么能阻止您继续努力使修复尽可能稳定。

最重要的是要停火，让客户开心。

完成后，您将需要安排额外的工作以使其全部正常工作；修复“环境”错误，让 QA 完成测试计划，然后您可以创建另一个“官方”版本，正式修复初始问题并具有更高级别的安全性。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-17T15:15:02.953

这真的取决于手头的问题。

我最近与一位在起搏器公司工作的开发人员进行了交谈。无论多么关键，他们就是不能急于求成。但如果需要，他们有一些硬件检查软件行为并将起搏器重置为“保存”状态。

再说一次，如果真钱丢失，快速修复它的需要可能更大，需要安全和完整地修复它。

无论您做什么和/或修复，请确保您***记录所有更改***并以慢动作检查它们以检查潜在的错误。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-17T15:56:17.130

如果你的工作时间紧迫，你需要集中精力。因此，如果您看到一些代码对您大喊*清理我*，但与手头的问题无关，请做一个简短的记录，以便稍后重新访问这个地方，但现在不要重构它。这样做不仅可以，而且是强制性的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-17T14:45:23.087

我认为当然可以忽略在尝试修复一个关键错误时可能会发现的其他（更不成问题的）错误。但当然不应该在某些票务系统中被遗忘和报告。

我认为在这种情况下（当然确实会发生）获得顺利结果的大部分工作都需要预先投入到拥有一个良好的自动测试套件中。这样，您至少可以确保在修复该错误时不会引入新错误。代码审查等增加了这一点。

因此，在编写软件时，当您需要快速做出反应并为此做好准备时，可能总是会考虑这种情况。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-18T21:00:07.123

首先，我认为您必须将“情感剧”分开，并冷静地决定修复错误是否实际上比完成发布更重要。希望这是别人的工作。他们应该让开发人员免于承受所有“客户正在扼杀我们的脖子”废话的压力。如果客户端也在等待发布，也许它可以被扔回给他们，修复这个错误将/可能会延迟发布

然后正如丹尼尔所说“尽可能快地工作，但不要更快”。如果客户抱怨，甚至失去收入，那真的不会影响您修复错误或快速修复错误的能力。

至于修复，我会做绝对的最低限度来修复那个特定的错误。如果可能的话，我会编写一个单独的代码块来处理（希望）导致故障的一个条件，而别管其他一切。这个想法是隔离一个问题并知道（某种程度上）不会因为这些变化而破坏其他任何东西。并且能够轻松地测试这一条件。

# python - 我应该为新项目使用哪个版本的 TurboGears？

> ID：557101
> 
> 赞同：0
> 
> 时间：2009-02-17T14:38:19.173
> 
> 标签：python, project, turbogears

我正在计划一个新项目，我想使用[TurboGears](http://www.turbogears.org)。问题是：我不确定选择哪个版本。共有三种选择： Turbogears 1.0.8（稳定版） Turbogears 1.1（beta 3） Turbogears 2.0（beta 4）

由于这是一个新项目，我不想选择错误的框架。那么差异在哪里，2.0 的“beta”程度如何？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T14:52:16.473

我个人会选择 TG2（但也会考虑其他框架，例如 Pylons 或 repoze.bfg），尤其是。如果是新项目。请记住，您可能需要在某些时候升级（或至少想要升级）。TG2 还提供完整的 WSGI 支持，获得越来越多的关注，恕我直言，这也是您真正想要的东西。

对我来说，这些天来最重要的事情总是该框架的代码看起来有多好，因为您永远不知道何时需要深入研究它以尝试了解某些​​不当行为甚至修复错误（无论是什么版本）。

另一个重要方面是社区，恕我直言，因此在 IRC 频道或邮件列表中闲逛可能会帮助您做出更好的决定。

也许[这 10 个使用 TG2 的理由](http://compoundthinking.com/blog/index.php/2008/07/31/10-reasons-why-the-new-turbogears-2-alpha-is-worth-a-look/)也有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T15:56:43.010

是的，TG2。TG1.0.x 是旧版，而 TG1.1 是旧版应用程序通往 TG2 的垫脚石。

我也会非常认真地看待 Pylons 和 Django。

# installation - 由同一个安装包安装的两个程序是否仍然是 GPL 下的聚合？

> ID：557102
> 
> 赞同：3
> 
> 时间：2009-02-17T14:38:31.590
> 
> 标签：installation, gpl, aggregate

假设我有两个应用程序：一个是“服务器”应用程序，在 GPLv3 下获得许可，另一个是“客户端”应用程序，在非 GPL 兼容许可下获得许可。服务器作为 Windows 服务运行，客户端是普通的 Windows 应用程序，它们仅通过 TCP/IP 和 XML 进行通信（根本没有链接）。

我知道我可以在同一个媒体上分发这两者，或者在一个 zip 文件中一起分发，就 GPL 而言，作为“聚合”。

但是，我可以编写一个在一个进程中安装服务器和客户端的安装程序，只是为了用户友好吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T14:49:37.617

我相信您可以编写一个安装程序，为每个软件启动两个单独的安装程序。确保您提醒用户他将要发生的事情，并且为了使其更加明显，您可以为他们提供一个自定义选项，允许他们只安装一个或另一个（即使没有另一个就无法工作） .

但是，如果您这样做主要是为了避免 GPL 许可封闭源代码软件，您仍然会受到抨击。他们可能无法合法地对此做任何事情，但如果你激怒了足够多的人，你可能会很快发现一些开源竞争。

-亚当

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T15:18:59.543

只要

“唯一的条件是，你不能在禁止用户行使每个程序的个人许可授予他们的权利的许可下发布聚合。”

[http://www.gnu.org/licenses/gpl-faq.html#MereAggregation](http://www.gnu.org/licenses/gpl-faq.html#MereAggregation)

那么您应该可以使用安装程序。没有必要像其他海报提到的那样提供点击等：

[http://www.gnu.org/licenses/gpl-faq.html#ClickThrough](http://www.gnu.org/licenses/gpl-faq.html#ClickThrough)

然而，主要问题不是安装，而是您所做的是否是派生作品（它不像链接或不链接那么简单）：

[..]管道、套接字和命令行参数是通常在两个独立程序之间使用的通信机制。[...] 但是，如果通信的语义足够紧密，可以交换复杂的内部数据结构，那么这也可以作为将这两个部分组合成一个更大程序的基础。

[http://www.gnu.org/licenses/gpl-faq.html#MereAggregation](http://www.gnu.org/licenses/gpl-faq.html#MereAggregation)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T14:45:46.300

# 要非常小心！

您必须确保有两个单独的许可证点击，一个用于 GPL v3 代码，一个用于非专有代码。您还需要非常认真地确保用户了解他们对 GPL v3 代码的权利，并证明您已经履行了提供该代码的义务。

伊纳尔。我没有仔细检查 GPL v3 的措辞以确保没有其他问题。

如有疑问，请考虑咨询[SFLC](http://www.softwarefreedom.org/)（软件自由法律中心）。

* * *

### 细微差别

下面有一组广泛的评论 - 阅读它。本说明部分是对评论的回应。

GPL 不是直接的 EULA（最终用户许可协议）。它更像是对软件开发人员的许可。但是，它确实授予软件接收者某些权利，并且 GPL 对作为软件开发人员的您施加了义务。特别是，它要求您作为开发人员明确授予您哪些权利，以及授予您向其提供 GPL 软件的人哪些权利。

您不必显示 GPL 的文本。您可能只是说“包 X 是根据 GNU 通用公共许可证版本 3 的条款分发的。您可以在[http://www.fsf.org/licensing/licenses/gpl.html](http://www.fsf.org/licensing/licenses/gpl.html)找到此许可证的条款。您有由于此许可而享有某些权利。您可以通过从 [ *...合适的 URL...* ]下载包 X 的源代码从我们这里获得。当包 X 与包 Y 一起使用时，我们对包 X 提供有限的支持*。 ..废话……废话……废话……* ”。

显示 GPL 本身的一个优点是您不必提供任何解释 - 解释法律文件很困难，尤其是对于非律师（比如我！）。您可能想明确说明用户拥有权利并且不必同意任何事情；这是明智的（我相信是准确的）。

请注意，对 Package X（假设的 GPL v3 软件）的支持收费是合法的 - 只要您实际提供支持。这是允许的。您也没有义务为从其他地方获得 Package X 的人提供支持；您可以将这种支持限制在您自己的客户身上。但是您不能阻止您的客户获取源代码，或者阻止您将 Package X 的源代码转发给他们自己的朋友、同事或客户。

我仍然不是律师 - 如果您需要法律建议，请准备好付费与在软件许可和 GPL 方面经验丰富的律师交谈。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T16:24:44.207

我认为安装程序没有链接到它正在安装的内容，所以在我看来它就像是三个独立的程序在一个集合中，其中一个是 GPLv3。无论如何，我认为启动不同的安装程序进程不会做任何事情：要么这是一个聚合，要么它是一个单一的派生工作。

当然，这取决于衍生作品的定义，据我所知，这是一个未定的法律问题。但是，我会继续使用单个安装程序，并确保一些重要的文档提到了不同的许可证。

# logging - 来自多个应用程序的日志的日志记录概览系统

> ID：557111
> 
> 赞同：3
> 
> 时间：2009-02-17T14:40:51.680
> 
> 标签：logging

作为我们企业的一部分，我有一些独立的 Web 服务以及一些客户端。每个 web 服务都记录到一个单独的日志文件，每个客户端在用户机器上都有一个本地日志文件。Web 服务也分散在几台机器上。例如，我正在使用 Log4Net 并查看用于通过 msmq 进行通信的附加程序。我想知道是否存在某种企业日志记录系统，我可以在其中重定向来自服务和客户端的所有日志记录，以便我可以为所有日志记录有一个共同的位置并通过一些 gui 查看它们？是否存在某种像这样的日志系统？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T18:18:19.817

要在中央位置收集和存储日志数据，您通常需要某种日志服务器或接收器应用程序。您可能想尝试一下我们的日志记录工具[SmartInspect](http://www.gurock.com/products/smartinspect/)，因为它带有一个日志服务器，可以通过网络上的 TCP 或本地命名管道接收日志数据。SmartInspect 还附带一个查看器应用程序，用于分析和过滤日志数据。

或者，您可以查看 UNIX Syslog damon/protocol 和客户端 API。Syslog 通过 UDP 传输/接收数据，并且可能有一些 Web 前端/GUI 工具用于分析生成的日志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-30T14:20:50.643

如果您要处理来自多个应用程序的大量日志，部分挑战是将日志全部集中到一个位置。另一部分是理解所有这些数据。

您可能想看看[GIBRALTAR](http://www.gibraltarsoftware.com/enter/gibraltar-for-logging.aspx)。它揭示了数千个日志中的模式，并深入研究了各个会话的细节。使用我们的[Gibraltar Hub 网络服务](http://rocksolid.gibraltarsoftware.com/development/logging/stay-connected-with-your-users-via-gibraltar-hub)，收集所有这些日志非常简单易行。

# c# - 从字节转换 Unicode 字符

> ID：557112
> 
> 赞同：5
> 
> 时间：2009-02-17T14:40:53.957
> 
> 标签：c#, unicode, types

在我们的 API 中，我们使用 byte[] 通过网络发送数据。一切正常，直到我们的“外国”客户决定传递/接收 Unicode 字符的那一天。

据我所知，Unicode 字符占用 2 个字节，但是，我们只在字节数组中为它们分配 1 个字节。

下面是我们如何从 byte[] 数组中读取字符：

```
 // buffer is a byte[6553] and index is a current location in the buffer
        char c = System.BitConverter.ToChar(buffer, m_index);
        index += SIZEOF_BYTE;

        return c; 
```

所以当前的问题是 API 正在接收一个奇怪的 Unicode 字符，当我查看 Unicode 十六进制时。我发现最后一个有效字节是正确的，但最高有效字节在它应该为 0 时有一个值。到目前为止，一个快速的解决方法是使用 0x00FF & c 来过滤 msb。

请提出正确的方法来处理来自套接字的 Unicode 字符？

谢谢。

**解决方案：**

*向乔恩致敬：*

char c = (char) 缓冲区[m_index];

正如他所提到的，它起作用的原因是因为客户端 api 接收到一个只占用一个字节的字符，而 BitConverter.ToChar 使用了两个，因此在转换它时存在问题。我仍然对为什么它适用于某些角色而不是其他角色感到惊讶，因为它应该在所有情况下都失败。

谢谢大佬，回复很好！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T14:44:26.147

您应该使用[`Encoding.GetString`](http://msdn.microsoft.com/en-us/library/system.text.encoding.getstring.aspx), 使用最合适的编码。

我不太了解您的情况，但是`Encoding`几乎可以肯定，上课是处理它的方法。

谁在控制这里的数据？您的代码，还是您客户的代码？您是否定义了正确的格式是什么？

编辑：好的，我再次查看了您的代码：BitConverter.ToChar 返回“由从 startIndex 开始的两个字节形成的字符。” 如果您只想使用*一个*字节，只需转换它：

```
char c = (char) buffer[m_index]; 
```

我很惊讶你的代码一直在工作，因为它会在下一个字节非零时中断。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T14:44:41.297

您应该查看 System.Text.ASCIIEncoder.ASCII.GetString 函数，该函数接受一个 byte[] 数组并将其转换为字符串（对于 ascii）。

System.Text.UTF8Encoder 或 System.Text.UTF16Encoder 用于 UTF8 或 UTF16 编码中的 Unicode 字符串。

在 ASCIIEncoding、UTF8Encoding 和 UTF16Encoding 类中还有用于将字符串转换为 Byte[] 的函数：请参阅 GetBytes(String) 函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T14:46:44.147

Unicode 字符最多可以占用 4 个字节，但很少在线路上对每个字符使用 4 个字节进行编码的消息。相反，使用像 UTF8 或 UTF16 这样的方案，它们只在需要时引入额外的字节。

查看[编码](http://msdn.microsoft.com/en-us/library/system.text.encoding.aspx)类指南。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T14:48:28.353

测试流应该包含一个[字节顺序标记](http://en.wikipedia.org/wiki/Byte-order_mark)，允许您确定如何处理二进制数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T14:48:52.767

目前尚不清楚您的目标到底是什么。据我所知，您可以选择 2 条路线

1.  忽略以 Unicode 发送的所有数据
2.  处理 unicode 和 ASCII 字符串

恕我直言，＃1是要走的路。但听起来您的协议不一定设置为处理 unicode 字符串。您必须执行一些检测逻辑来确定传入的字符串是否是 Unicode 版本。如果是，您可以使用 Enconding.Unicode.GetString 方法来转换该特定字节数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T14:56:53.903

您的客户使用什么编码？如果您的一些客户仍在使用 ASCII，那么您将需要您的国际客户使用将 ASCII 集 (1-127) 映射到自身的东西，例如 UTF8。之后，使用 UTF8 编码的 GetString 方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T15:27:18.557

我唯一的解决方案是修复 API。要么告诉用户在 Byte[] 中只使用 ASCII 字符串，要么修复它以支持 ASCII 和您需要使用的任何其他编码。

仅从 byte[] 确定外国客户端提供的编码可能有点棘手。

# ruby-on-rails - 如何使用多态关联创建评论

> ID：557117
> 
> 赞同：1
> 
> 时间：2009-02-17T14:42:07.853
> 
> 标签：ruby-on-rails, polymorphism

我有三个模型都可以有评论，每个评论必须属于一个用户。我正在使用多态关联 :as => :reviewable 但我不确定我应该把为每个模型创建评论的逻辑放在哪里。我会假设每个评论的 CRUD 应该由 reviews_controller 处理（或嵌套属性？在其他控制器中？），但是我如何将评论与每个模型相关联？

我在谷歌上找不到任何模型/视图/控制器的例子，也许这对清理事情有很大帮助。

谢谢， 塞萨尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T21:47:32.270

在可审查对象的控制器中处理对象的问题在于，您会发现您最终会在每个控制器中重复大量相同的代码。此外，您将代码放在哪里？要么你最终使用一些非常繁重的动作方法（通过捎带你现有的 7 个动作），要么你开始创建像这样的动作

```
new_review, delete_review, etc 
```

这不是 RESTful 并且是一种严重的代码气味，需要它自己的控制器。

因此，对于这样的事情，我会考虑有一个评论控制器，或者将参数添加到 url 或使用隐藏字段来指示评论属于哪个对象：

```
<%= f.hidden_field :reviewable_id, :value => @object.id %>
<%= f.hidden_field :reviewable_type, :value => @object.class %> 
```

如果需要对评论对象进行任何其他工作（例如将当前用户保存为作者等），这尤其有用，因为它保留了所有无法推送到模型的逻辑在一个地方。只需确保正确确定关联模型的范围并确保它属于用户，否则用户可以篡改 URL 并将评论添加到他们想要的任何内容（当然，这适用于从用户提交的数据中选择对象的任何地方）。

但是，如果评论对象非常轻量级并且不需要任何额外的处理（即只需将发布的数据简单地分配给对象），那么您可能想看看使用 Rails 2.3 和它的[嵌套对象支持](http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T00:31:10.487

由于它是对模型的更新，因此更容易通过模型的控制器。另外，没有错误评论属于哪个模型。

看看有什么`acts_as_commentable`作用。重新调整用途可能比推出自己的用途更容易。

`http://github.com/jackdempsey/acts_as_commentable/tree/master`

# c# - 我如何退出列表 .ForEach 使用匿名委托时的循环？

> ID：557159
> 
> 赞同：45
> 
> 时间：2009-02-17T14:47:57.527
> 
> 标签：c#, loops, delegates

在正常循环中，您可以使用 break 跳出循环。可以使用匿名代表来完成同样的事情吗？

示例 inputString 和 result 都在委托之外声明。

```
blackList.ForEach(new Action<string>(
    delegate(string item)
    {
        if(inputString.Contains(item)==true)
        {
            result = true;
            // I want to break here
        }
    }
)); 
```

编辑：感谢您的回复，我实际上正在阅读您的书 John :) 只是为了记录，我遇到了这个问题并切换回正常的 foreach 循环，但我发布了这个问题，看看我是否错过了什么。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-17T14:54:25.267

正如其他人发布的那样，您无法退出 ForEach 中的循环。

你能用LINQ吗？如果是这样，您可以轻松地将 TakeWhile 和自定义 ForEach 扩展方法（现在几乎每个项目似乎都有）结合起来。

但是，在您的示例中，[`List<T>.FindIndex`](http://msdn.microsoft.com/en-us/library/x1xzf2ca.aspx)这将是最好的选择 - 但如果您实际上并没有这样做，请发布您*真正*想做的示例。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-02-17T14:59:30.510

没有一个可以访问的循环，可以从中中断。并且对（匿名）委托的每次调用都是一个新的函数调用，因此局部变量将无济于事。但是由于 C# 给了你一个闭包，你可以设置一个标志，然后在进一步的调用中什么也不做：

```
bool stop = false;
myList.ForEach((a) => {
  if (stop) {
    return;
  } else if (a.SomeCondition()) {
    stop = true;
  }
}); 
```

（这需要测试以检查是否生成了正确的闭包引用语义。）

更高级的方法是创建自己的扩展方法，允许委托返回 false 以停止循环：

```
static class MyExtensions {
  static void ForEachStoppable<T>(this IEnumerable<T> input, Func<T, bool> action) {
    foreach (T t in input) {
      if (!action(t)) {
        break;
      }
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-17T15:03:46.367

你有 LINQ 吗？您的逻辑似乎类似于 Any：

```
bool any = blackList.Any(s=>inputString.Contains(s)); 
```

这与以下内容相同：

```
bool any = blackList.Any(inputString.Contains); 
```

如果您没有 LINQ，那么这仍然与以下内容相同：

```
bool any = blackList.Find(inputString.Contains) != null; 
```

如果你想运行额外的逻辑，你可以做一些事情（使用 LINQ）`TakeWhile`等

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-17T14:51:09.597

我认为使用 ForEach 方法时没有一种优雅的方法。一个 hacky 解决方案是抛出异常。

是什么阻止你做一个老式的 foreach？

```
foreach (string item in blackList)
{
    if (!inputString.Contains(item)) continue;

    result = true;
    break;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-17T14:53:19.840

如果要循环，请使用循环。

`Action`允许没有返回值，因此 ForEach 函数不可能知道您想要中断，除非抛出异常。在这里使用异常是矫枉过正的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-17T14:50:25.977

“退出”循环的唯一方法是抛出异常。没有像普通 foreach 循环那样退出 .ForEach 方法的“中断”方式。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-17T14:56:24.667

ForEach 方法并不意味着要这样做。如果你想知道一个集合是否包含一个项目，你应该使用 Contains 方法。如果您想对集合中的所有项目执行检查，您应该尝试使用 Any 扩展方法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-17T15:14:10.303

```
bool @break = false;

blackList.ForEach(item =>
 {  
    if(!@break && inputString.Contains(item))
     { @break = true;
       result = true;
     }

    if (@break) return;
    /* ... */
 }); 
```

请注意，上面仍然会遍历每个项目，但会立即返回。当然，这种方式可能不如普通的*`foreach`*.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-17T15:04:46.940

```
 class Program
{
    static void Main(string[] args)
    {
        List<string> blackList = new List<string>(new[] { "jaime", "jhon", "febres", "velez" });
        string inputString = "febres";
        bool result = false;
        blackList.ForEach((item) =>
                              {
                                  Console.WriteLine("Executing");
                                  if (inputString.Contains(item))
                                  {
                                      result = true;
                                      Console.WriteLine("Founded!");
                                  }
                              },
                          () => result);
        Console.WriteLine(result);
        Console.ReadLine();
    }

}
public static class MyExtensions
{
    public static void ForEach<T>(this IEnumerable<T> enumerable, Action<T> action, Func<bool> breakOn)
    {
        foreach (var item in enumerable)
        {
            action(item);
            if (breakOn())
            {
                break;
            }
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-04-04T18:40:24.547

这对你有用吗：

```
bool result = null != blackList.Find( item => inputString.Contains(item)) ); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-19T16:03:49.680

如果你真的想在列表中存在一个循环 foreach ，你可以使用如下代码的异常：

```
public class ExitMyForEachListException : Exception
{
    public ExitMyForEachListException(string message)
        : base(message)
    {
    }
}
class Program
{
    static void Main(string[] args)
    {
        List<string> str = new List<string>() { "Name1", "name2", "name3", "name4", "name5", "name6", "name7" };
        try
        {
            str.ForEach(z =>
            {
                if (z.EndsWith("6"))
                    throw new ExitMyForEachListException("I get Out because I found name number 6!");
                System.Console.WriteLine(z);
            });
        }
        catch (ExitMyForEachListException ex)
        {
            System.Console.WriteLine(ex.Message);
        }

        System.Console.Read();
    }
} 
```

希望这有助于获得其他观点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-09-15T15:39:35.293

```
blackList.ForEach(new Action<string>(
    delegate(string item)
    {
        if(inputString.Contains(item)==true)
        {
            result = true;
            // I want to break here
            return;
        }
    }
)); 
```

# windows - Windows XP 命令外壳的“置于最前面”

> ID：557166
> 
> 赞同：8
> 
> 时间：2009-02-17T14:49:36.447
> 
> 标签：windows, batch-file, windows-shell

是否可以将命令放入 Windows XP .bat 文件中以将命令 shell 置于最前面？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T15:18:46.830

[nircmd](http://www.nirsoft.net/utils/nircmd.html)将执行此操作，尽管它涉及一些脚本。

```
nircmd win activate "titleofwindow" 
```

你基本上需要知道你正在执行的 cmd 窗口的标题（你可以通过 windows 中的 TITLE 命令来设置）

因此：

```
TITLE %SOME_UNIQUE_VALE%
nircmd win activate %SOME_UNIQUE_VALE% 
```

应该做的伎俩。

请注意，一些恶意软件工具使用 NirCmd 可执行文件（它不需要部署，因为它非常强大），这可能会给您带来问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-11-18T03:04:27.613

让 cmd 提示窗口显示在前面的另一种方法是使用调用第二个 file2.bat 文件的命令结束 file1.bat，然后执行退出命令。

使用 file1.bat 的示例

```
....
[your code here]
start C:\file2.bat
exit 
```

这将关闭 file1.bat 并打开第二个 .bat 文件，您可以在其中继续编写代码。这第二个 .bat 命令提示符将在其他窗口前面打开

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T14:55:18.587

从批处理文件中，没有。如果你想激活一个窗口，你必须使用[SetActiveWindow()](http://msdn.microsoft.com/en-us/library/ms646311(VS.85).aspx)。如果您不想弄脏 Windows 编程，但仍想激活 Windows 和类似的简单东西，我强烈建议您查看[Autoit](http://www.autoitscript.com/autoit3/index.shtml)。你总是可以从你的批处理文件中调用这个程序来让它完成任务。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-07-13T13:19:46.443

我遇到了类似的问题，我必须开发一个简单的 C# 控制台应用程序，将窗口放在前面。使用窗口标题传递作为参数选择窗口。

```
using System;
 using System.Collections.Generic;
 using System.Linq;
 using System.Text;
 using  System.Runtime.InteropServices; 

 namespace ConsoleApplication1
 {
    class Program
    {

        [DllImport("USER32.DLL", CharSet = CharSet.Unicode)]
        public static extern IntPtr FindWindow(String lpClassName, String lpWindowName);

        [DllImport("USER32.DLL")]
        public static extern bool SetForegroundWindow(IntPtr hWnd);
        [DllImport("User32.dll")]
        private static extern bool IsIconic(IntPtr handle);
        [DllImport("User32.dll")]
        private static extern bool ShowWindow(IntPtr handle, int nCmdShow);
        const int SW_RESTORE = 9;
        public static void bringToFront(string title)
        {
            // Get a handle to the Calculator application.
            IntPtr handle = FindWindow(null, title);

            // Verify that Calculator is a running process.
            if (handle == IntPtr.Zero)
            {
                return;
            }
            if (IsIconic(handle))
            {
                ShowWindow(handle, SW_RESTORE);
            }

            Console.WriteLine("Founded ");
            SetForegroundWindow(handle);

        }

        static void Main(string[] args)
        {

            if (args.Length > 0)
                bringToFront(args[0]);
            else
                Console.WriteLine("specify program window title");

        }
    }
} 
```

我的批处理脚本的代码类似于

tasklist /FI "IMAGENAME eq program.exe" | 如果错误级别为 1（program.exe），则查找“program.exe”，否则（BringToFront.exe“程序窗口标题”）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-19T16:19:02.053

[CMDOW](http://www.commandline.co.uk/cmdow/)也适用于这个和其他需要一些附加功能的 DOS 编程任务。易于使用且有据可查。但是请注意您的防病毒程序 - CMDOW 能够隐藏您的防病毒程序将作为可能病毒拾取的窗口。只需将其添加到您的例外列表中即可。CMDOW 是完全可移植的，绝对不是病毒，如果您担心它被第三方用来隐藏某些东西，只需将它藏在某个不明显的文件夹中即可。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-11-11T15:50:49.560

尝试使用[focusOn.bat](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/jscript/focusOn.bat)

```
call focusOn.bat "My Title" 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-10-28T01:33:00.900

另一种按名称切换到窗口的快速方法是通过 Ctrl+Shift+Esc 打开任务管理器。然后只需键入窗口标题的前几个字母以选择进程，然后按 Enter。

# java - 找出运行 JVM Eclipse 的设备

> ID：557169
> 
> 赞同：43
> 
> 时间：2009-02-17T14:50:11.377
> 
> 标签：java, eclipse, jvm

我目前正在尝试调整我的 Eclipse 安装并遇到了“-vm”选项。SO 上的其他帖子提到始终使用最新的可用 JVM 是件好事，因为它们在性能方面不断提高，所以我可能会这样做。我想知道如果您没有指定“-vm”参数，您如何找出运行 JVM Eclipse 的内容。

我在文档中找到了以下内容，但这并没有说明它将如何查找 JVM：

> 当传递给 Eclipse 可执行文件时，此选项用于定位用于运行 Eclipse 的 Java VM。它必须是相应 Java 可执行文件的完整文件系统路径。**如果未指定，Eclipse 可执行文件将使用搜索算法来定位合适的 VM**。无论如何，可执行文件然后使用 -vm 参数将路径传递给用于 Java Main 的实际 VM。Java Main 然后将此值存储在 eclipse.vm 中。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-02-17T15:08:42.750

实际上，Windows->Preferences->Java->installed 并没有显示运行 Eclipse 的那个，而只显示它运行的默认 JRE。

要查看正在运行的 Eclipse，请转到 Help->About Eclipse Platform->Configuration Details，然后查找属性 eclipse.vm。

例如：

```
eclipse.vm=C:\Program Files\Java\jre6\bin\client\jvm.dll 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-17T15:10:03.420

根据[这个线程](http://dev.eclipse.org/newslists/news.eclipse.webtools/msg00089.html)和[这个](http://forums.sun.com/thread.jspa?threadID=645735)：

**eclipse 将尝试通过检查您的路径**来定位您用于**启动**自身的 JVM。

 **这样你就可以：

> *   创建一个 JAVA_HOME 环境变量，它指向您实际首选的 JDK。
>     这样，您可以轻松地在安装的 JDK 之间进行选择。
>     
>     
> *   将 %JAVA_HOME%\bin 放在路径中，前面的任何位置`<windowsroot>\system32`，其中还包含 java、javaw 和 co 二进制文件。
>     这样，每当从路径中调用 JDK bin 目录中的 java* 时，它就会被调用。

我相信其他帖子会告诉您如何找到 JVM eclipse 正在使用的内容。

但是，我将您的问题解释为：“eclipse在启动时*将使用*什么 JVM ？” **当没有`-vm`使用 args**时。

* * *

经过进一步研究，eclipse似乎会寻找一个JRE：

*   直接在其安装目录下 ( `<eclipse>\jre`)：如果您将任何已安装 JRE 的内容复制到该子目录中，它将被选中
*   在`C:\Program Files\Java\JRE...`.
*   在`%PATH%`（见上文）

另请阅读此[SO 答案](https://stackoverflow.com/questions/316265/tricks-to-speed-up-eclipse/316535#316535)以了解为什么 eclipse 默认选择 jvm.dll 而不是 javaw.exe

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-17T15:08:08.603

如果您转到“帮助”->“关于 Eclipse 平台”并单击“配置详细信息”按钮，它将需要一点时间才能显示出来，但是您会得到 Eclipse 配置的所有内容的转储...

我发现这 2 行是您正在寻找的内容：

> -vm
> 
> C:\Program Files\Java\jdk1.6.0_10\bin..\jre\bin\client\jvm.dll

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-17T15:05:25.800

我想如果你这样做：
Window->Preferences->Java->Installed JREs
你会在你的机器上看到一个 JREs 列表。选中的那个是 eclipse 正在使用的那个。

或者，如果您进入“运行配置”对话框，并查看 JRE 选项卡，您可以选择一个 JRE 在那里运行。

# c++ - 查找字符串差异的位操作

> ID：557170
> 
> 赞同：6
> 
> 时间：2009-02-17T14:50:19.940
> 
> 标签：c++, string

我的以下字符串试图找出两个字符串之间的区别。但是它迭代字符串的长度非常慢：

```
#include <string>
#include <vector>
#include <iostream>
using namespace std;

int hd(string s1, string s2) {
    // hd stands for "Hamming Distance"
    int dif = 0;

    for (unsigned i = 0; i < s1.size(); i++ ) {
        string b1 = s1.substr(i,1);
        string b2 = s2.substr(i,1);

        if (b1 != b2) {
            dif++;
        }
    }  

    return dif;
}

int main() {

    string string1 = "AAAAA";
    string string2 = "ATATT";
    string string3 = "AAAAA";

    int theHD12 = hd(string1,string2);
    cout << theHD12 << endl;

    int theHD13 = hd(string1,string3);
    cout << theHD13 << endl;
} 
```

有没有一种快速的替代方法来做到这一点？在 Perl 中，我们可以有以下方法：

```
sub hd {
    return ($_[0] ^ $_[1]) =~ tr/\001-\255//;
} 
```

这比迭代位置快得多。

我想知道它在 C++ 中的等价物是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T14:54:44.437

尝试通过以下方式替换 for 循环：

```
for (unsigned i = 0; i < s1.size(); i++ ) {
    if (b1[i] != b2[i]) {
            dif++;
    }
} 
```

这应该会快很多，因为不会创建新的字符串。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-17T15:41:06.277

STL 的乐趣：

```
#include <numeric>    //inner_product
#include <functional> //plus, equal_to, not2
#include <string>   
#include <stdexcept>

unsigned int 
hd(const std::string& s1, const std::string& s2)
{
    // TODO: What should we do if s1.size() != s2.size()?
    if (s1.size() != s2.size()){
      throw std::invalid_argument(
          "Strings passed to hd() must have the same lenght"
      );
    }

    return std::inner_product(
        s1.begin(), s1.end(), s2.begin(), 
        0, std::plus<unsigned int>(),
        std::not2(std::equal_to<std::string::value_type>())
    );
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T14:59:24.473

使用迭代器：

```
int GetHammingDistance(const std::string &a, const std::string &b)
{
    // Hamming distance is not defined for strings of different lengths.
    ASSERT(a.length() == b.length());

    std::string::const_iterator a_it = a.begin();
    std::string::const_iterator b_it = b.begin();

    std::string::const_iterator a_end = a.end();
    std::string::const_iterator b_end = b.end();

    int distance = 0;
    while (a_it != a_end && b_it != b_end)
    {
        if (*a_it != *b_it) ++distance;
        ++a_it; ++b_it;
    }

    return distance;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T15:43:43.243

选择 1：修改您的原始代码以尽可能高效。

```
int hd(string const& s1, string const& s2)
{
    // hd stands for "Hamming Distance"
    int dif = 0;

    for (std::string::size_type i = 0; i < s1.size(); i++ )
    {
        char b1 = s1[i];
        char b2 = s2[i];

        dif += (b1 != b2)?1:0;
    }  

    return dif;
} 
```

第二种选择使用一些 STL 算法来完成繁重的工作。

```
struct HammingFunc
{
    inline int operator()(char s1,char s2)
    {
        return s1 == s2?0:1;
    }
};

int hd(string const& s1, string const& s2)
{
    int diff = std::inner_product(s1.begin(),s1.end(),
                                  s2.begin(),
                                  0,
                                  std::plus<int>(),HammingFunc()
                                 );
    return diff;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T14:54:41.083

一些明显的点可能会使其更快：

1.  将字符串作为 const 引用传递，而不是按值传递
2.  使用索引运算符 [] 获取字符，而不是方法调用
3.  编译优化

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-04-21T21:16:35.167

你使用字符串。

正如这里所解释 的， 如果可以使用 char* [，寻找最快的汉明距离 C 实现我的实验得出结论，对于](https://stackoverflow.com/questions/15987611/the-fastest-hamming-distance-c-c-implementation)**英特尔至强 X5650**上的**Gcc 4.7.2 ，****小**字符串（字符数组）的最快通用汉明距离计算函数是：

 ****```
// na = length of both strings
unsigned int HammingDistance(const char* a, unsigned int na, const char* b) {

    unsigned int num_mismatches = 0;
    while (na) {
        if (*a != *b)
            ++num_mismatches;

        --na;
        ++a;
        ++b;
    }

    return num_mismatches;
} 
```

如果您的问题允许您设置距离上限，以便您不关心更大的距离并且此限制始终小于字符串的长度，则可以将上面的示例进一步优化为：

```
// na = length of both strings, dist must always be < na
unsigned int HammingDistance(const char* const a, const unsigned int na, const char* const b, const unsigned int dist) {

    unsigned int i = 0, num_mismatches = 0;

    while(i <= dist)
    {
        if (a[i] != b[i])
            ++num_mismatches;

        ++i;
    }

    while(num_mismatches <= dist && i < na)
    {
        if (a[i] != b[i])
            ++num_mismatches;

        ++i;
    }

    return num_mismatches;
} 
```

我不确定 const 是否对速度有任何作用，但无论如何我都会使用它......

# python - 如何在 Django 中重用可重用的应用程序

> ID：557171
> 
> 赞同：22
> 
> 时间：2009-02-17T14:50:22.530
> 
> 标签：python, django, code-reuse

* * *

我正在尝试在 Django 中创建我的第一个站点，并且在寻找示例应用程序以从中汲取灵感时，我经常偶然发现一个名为*“可重用应用程序”*的术语。

我理解可重用应用程序的*概念*很容易，但在 Django 中重用应用程序的方法对我来说非常迷茫。在整个业务中困扰我的几个问题是：

重用现有 Django 应用程序的首选方法是什么？我把它放在哪里以及如何引用它？

据我了解，建议将其放在您的“PYTHONPATH”上，但是一旦我需要将我的应用程序部署到我访问受限的远程位置（例如在托管服务上），它就会中断。

因此，如果我在本地计算机上开发我的站点并打算将其部署在我只有 ftp 访问权限的 ISP 上，我如何重用 3rd 方 Django 应用程序，以便如果我部署我的站点，该站点可以继续工作（例如我唯一能指望的是服务提供商安装了​​ Python 2.5 和 Django 1.x）？

如何组织我的 Django 项目，以便我可以轻松地将它与我想要使用的所有可重用应用程序一起部署？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-17T15:59:50.897

通常，使用可重用应用程序唯一需要做的就是确保它处于打开状态`sys.path`，以便您可以从 Python 代码中导入它。在大多数情况下（如果作者遵循最佳实践），可重用应用程序 tarball 或捆绑包将包含一个顶级目录，其中包含 docs、一个 README、a`setup.py`以及一个包含实际应用程序的子目录（参见[django-voting](http://code.google.com/p/django-voting/source/browse/#svn/trunk)示例；应用程序本身位于“投票”子目录中）。这个子目录需要放在你的 Python 路径中。这样做的可能方法包括：

*   running `pip install appname`，如果应用程序已上传到[PyPI](https://pypi.python.org/pypi)（现在大多数是）
*   安装应用程序`setup.py install`（这与 具有相同的结果`pip install appname`，但需要您首先自己下载并解压缩代码；pip 将为您完成）
*   手动将代码目录符号链接到您的 Python 站点包目录
*   使用[virtualenv](http://pypi.python.org/pypi/virtualenv)之类的软件来创建一个“虚拟 Python 环境”，它有自己的站点包目录，然后运行`setup.py install`或`pip install appname`激活该 virtualenv，或者将应用程序放置或符号链接到 virtualenv 的站点包中（强烈推荐在所有“全局安装”选项，如果您重视未来的理智）
*   将应用程序放置在您打算放置各种应用程序的某个目录中，然后将该目录添加到 PYTHONPATH 环境变量中

如果您可以启动 Python 解释器并“导入投票”（例如）而不会收到 ImportError，那么您将知道您已经在正确的位置。

在您只有 FTP 访问的服务器上，您唯一的选择实际上是最后一个，他们必须为您设置它。如果他们声称支持 Django，他们必须提供*一些*可以上传包的地方，并且可以在 Python 中导入它们。如果不知道您的虚拟主机的详细信息，就不可能说出他们如何为您构建它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-14T15:01:39.937

一个老问题，但这是我所做的：

如果您使用的是版本控制系统 (VCS)，我建议将您的软件需要的所有可重用应用程序和库（包括 django）放在 VCS 中。如果您不想将它们直接放在项目根目录下，可以修改 settings.py 以将它们的位置添加到 sys.path。

在部署之后，只需将 VCS 存储库克隆或检出到您想要使用它的任何位置即可。

这有两个额外的好处：

*   版本不匹配；您的软件始终使用您对其进行测试的版本，而不是部署时可用的版本。
*   如果多个人在项目上工作，则无需其他人处理安装依赖项。

当需要更新组件的版本时，请在您的 VCS 中更新它，然后通过它将更新传播到您的部署。

# php - 在转换失败的情况下更改 mysql 中的字符 - 仍然得到 NÃ£o

> ID：557180
> 
> 赞同：0
> 
> 时间：2009-02-17T14:52:42.743
> 
> 标签：php, mysql, encoding

我正在用来自 php 的数据填充这个 mysql 表（通过 post 并使用 filter_input）。数据库是 utf8，但是当我有一个用户用 ^,',',~ 像 Não 输入单词时，我得到了这个 -> Nã£o

我必须做些什么才能使其显示正确的值。或者我应该在检索数据时尝试进行一些更正？

更新：

我添加了一个 utf8_decode，现在它可以插入了。任何人都知道如何转换表中已经存在的字符串？我尝试使用转换功能，但我无法使它工作:(

更新：

我正在尝试这段代码：

> 从 id = 35 的表中选择转换（使用 latin1 的字段）；

而且我仍然得到这个： Não 我尝试了其他编码，但我从来没有得到 Não 这个词

有人对这个有什么想法吗？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T14:59:02.103

首先，确保您的页面是 utf-8

```
<meta http-equiv="Content-type" content="text/html; charset=UTF-8"/> 
```

接下来，如果您在 Apache 上，请在配置文件中使用 UTF-8：

```
AddDefaultCharset UTF-8 
```

或者您可以在这样的 .php 文件中执行此操作：

```
header('Content-type: text/html; charset=UTF-8'); 
```

如果仍然有问题，可以使用编码功能：

```
$value = utf8_encode($value); 
```

希望这一切都会有所帮助...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:00:11.353

看起来好像在某个地方无法处理 Unicode。结果，ã 被解释为两个单独的字符。确保处理字符串的所有内容都可以使用 Unicode。

# .net - 将发布者策略嵌入到程序集中

> ID：557196
> 
> 赞同：3
> 
> 时间：2009-02-17T14:55:36.293
> 
> 标签：.net, assemblies, shared, policy, publisher

我正在开发一个共享程序集，版本 2.0.0.0。为了将来的兼容性，我想将所有 2.0.xx 版本绑定到安装的最新版本。为此，我需要一个发布者策略文件。有没有办法将发布者策略直接嵌入“代码”程序集中，而不必安装两个不同的程序集？

即我的程序集将始终在 GAC 中，因为它不允许与它包装的应用程序分开运行。

谢谢你。QbProg

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-12-27T02:59:26.660

不，没有这样的解决方案。发布者策略程序集是独立的。（这让用户/管理员可以决定他们是否要安装它们。） kicker 是[文档](http://msdn.microsoft.com/en-us/library/dz32563a.aspx)的一部分，说明程序集名称必须遵循 format `policy.majorNumber.minorNumber.mainAssemblyName.dll`。

# python - 将数据库驱动（非 OO）的 Python 脚本转换为非数据库驱动的 OO 脚本

> ID：557199
> 
> 赞同：0
> 
> 时间：2009-02-17T14:56:13.547
> 
> 标签：python, object

我有一些严重依赖 MySQL 的软件，并且是用 python 编写的，没有任何类定义。出于性能原因，并且因为数据库实际上只是用于存储和检索大量数据，我想将其转换为根本不使用数据库的面向对象的 python 脚本。

所以我的计划是将数据库表导出到一组文件（不多——这是一个非常简单的数据库；它很大，因为它有很多行，但只有几个表，每个表只有两三个列）。

然后我打算读入数据，并有一组函数提供对数据的访问和操作。

我的问题是这样的：

是否有将一组数据库表转换为类和对象的首选方法？例如，如果我有一个包含水果的表，其中每个水果都有一个 id 和一个名称，我会拥有一个包含“Fruit”对象列表的“CollectionOfFruit”类，还是只有一个“CollectionOfFruit”类其中包含一个元组列表？还是我只有一个 Fruit 对象的列表？

我不想添加任何额外的框架，因为我希望此代码易于传输到不同的机器。所以我真的只是在寻找关于如何表示数据的一般建议，这些数据可能更自然地存储在数据库表中，在 Python 中的对象中。

或者，是否有一本我应该阅读的好书可以为我指明正确的方向？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T15:51:38.840

如果数据自然适合数据库表（“矩形数据”），为什么不将其转换为 sqlite？它是可移植的——只需一个文件即可移动 db，并且 sqlite 在任何你有 python 的地方都可用（无论如何都是 2.5 及更高版本）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T15:17:01.453

通常，您希望您的对象与您的“现实世界实体”完全匹配。

由于您是从数据库开始的，因此数据库并不总是具有任何真实世界的保真度。一些数据库设计简直太糟糕了。

如果您的数据库具有合理的 Fruit 模型，那么您就从这里开始。先把它弄好。

“集合”可能（也可能不是）是作为解决方案算法一部分的人工构造，而不是问题的真正适当部分。通常集合*是*问题的一部分，您也应该设计这些类。

然而，其他时候，集合是使用过数据库的产物，而您只需要一个简单的 Python 列表。

还有一些时候，集合实际上是从某个唯一键值到实体的正确映射，在这种情况下，它是一个 Python 字典。

有时，集合是从某些非唯一键值到某些实体集合的正确映射，在这种情况下，它是 Python `collections.defaultdict(list)`。

从基本的、类似现实世界的实体开始。那些得到类定义。

集合可能使用内置的 Python 集合，也可能需要它们自己的类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:06:14.083

对此没有“一刀切”的答案——这在很大程度上取决于数据及其在应用程序中的使用方式。如果数据和用法足够简单，您可能希望将水果存储在 dict 中，其中 id 作为键，其余数据作为元组。或不。这完全取决于。如果有一个指导原则，那就是提取应用程序的底层需求，然后针对这些需求编写代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T15:14:45.497

你可以有一个带有 id 和 name 实例变量的水果类。和一个从文件中读取/写入信息的函数，也许还有一个类变量来跟踪创建的水果（对象）的数量

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T15:36:39.487

在简单的情况下，[namedtuples](http://docs.python.org/dev/library/collections.html#collections.namedtuple)让您开始：

```
>>> from collections import namedtuple
>>> Fruit = namedtuple("Fruit", "name weight color")
>>> fruits = [Fruit(*row) for row in cursor.execute('select * from fruits')] 
```

`Fruit`等效于以下类：

```
>>> Fruit = namedtuple("Fruit", "name weight color", verbose=True)
class Fruit(tuple):
        'Fruit(name, weight, color)'

        __slots__ = ()

        _fields = ('name', 'weight', 'color')

        def __new__(cls, name, weight, color):
            return tuple.__new__(cls, (name, weight, color))

        @classmethod
        def _make(cls, iterable, new=tuple.__new__, len=len):
            'Make a new Fruit object from a sequence or iterable'
            result = new(cls, iterable)
            if len(result) != 3:
                raise TypeError('Expected 3 arguments, got %d' % len(result))
            return result

        def __repr__(self):
            return 'Fruit(name=%r, weight=%r, color=%r)' % self

        def _asdict(t):
            'Return a new dict which maps field names to their values'
            return {'name': t[0], 'weight': t[1], 'color': t[2]}

        def _replace(self, **kwds):
            'Return a new Fruit object replacing specified fields with new values'
            result = self._make(map(kwds.pop, ('name', 'weight', 'color'), self))
            if kwds:
                raise ValueError('Got unexpected field names: %r' % kwds.keys())

            return result

        def __getnewargs__(self):
            return tuple(self)

        name = property(itemgetter(0))
        weight = property(itemgetter(1))
        color = property(itemgetter(2)) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T20:38:29.120

另一种方法是使用 ZODB 直接持久地存储对象。您唯一需要做的就是从 Peristent 派生您的类，然后从根对象开始的所有内容都会作为对象自动存储在该数据库中。根对象来自 ZODB 连接。有许多可用的后端，默认是简单的文件。

一个类可能看起来像这样：

```
class Collection(persistent.Persistent):

  def __init__(self, fruit = []):
      self.fruit = fruit

class Fruit(peristent.Persistent):

  def __init__(self, name):
      self.name = name 
```

假设您有根对象，您可以执行以下操作：

```
fruit = Fruit("apple")
root.collection = Collection([fruit]) 
```

并自动存储在数据库中。您可以通过简单地查看从根对象访问“集合”来再次找到它：

```
print root.collection.fruit 
```

您还可以像往常一样从例如 Fruit 派生子类。

包含更多信息的有用链接：

*   [新的 ZODB 主页](http://new.zope.org/projects/zodb)
*   [ZODB 教程](http://new.zope.org/projects/zodb/tutorial)

这样，您仍然可以使用 Python 对象的全部功能，并且不需要序列化某些东西，例如通过 ORM，但您仍然可以轻松地存储数据。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T21:32:03.267

这里有几点供您考虑。如果您的数据很大，将其全部读入内存可能会很浪费。如果您需要随机访问而不仅仅是顺序访问数据，那么您要么每次最多扫描整个文件，要么将该表读入索引内存结构（如字典）中。列表仍然需要某种扫描（如果已排序，则直接迭代或二进制搜索）。话虽如此，如果您不需要数据库的某些功能，则不要使用数据库功能，但如果您只是认为 MySQL 太重，那么对之前的 Sqlite 建议 +1。它在没有并发开销的情况下为您提供了使用数据库时所需的大部分功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-17T21:35:15.113

对象类的抽象持久性。将所有持久性逻辑放在一个适配器类中，并将适配器分配给对象类。就像是：

```
class Fruit(Object):

   @classmethod
   def get(cls, id):
      return cls.adapter.get(id)

   def put(self):
      cls.adapter.put(self)

   def __init__(self, id, name, weight, color):
      self.id = id
      self.name = name
      self.weight = weight
      self.color = color

 class FruitAdapter(Object):

    def get(id):
       # retrieve attributes from persistent storage here
       return Fruit(id, name, weight, color)

    def put(fruit):
       # insert/update fruit in persistent storage here

 Fruit.adapter = FruitAdapter()
 f = Fruit.get(1)
 f.name = "lemon"
 f.put()
 # and so on... 
```

现在，您可以构建不同的 FruitAdapter 对象，它们可以与您选择的任何持久性格式（数据库、平面文件、内存中的集合等）进行互操作，并且基本的 Fruit 类将完全不受影响。

# php - 如何在 PHP 中加入字符串？

> ID：557200
> 
> 赞同：0
> 
> 时间：2009-02-17T14:56:16.963
> 
> 标签：php, string

我有三个字符串：

$str1 = "abc"; $str2 = "定义"; $str3 = "吉";

我可以像这样获得所有这些的价值：

回声“$str1$str2$str3”；

但我听说有一种方法可以将它们连接在一起，所以我可以不加引号地呼应所有这些。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T15:15:42.157

以及像这样连接

```
echo $str1 . $str2 . $str3; 
```

您也可以按顺序输出它们，从而避免评估中间字符串

```
echo $str1 , $str2 , $str3; 
```

最后，您可以在字符串中使用大括号来消除字符串替换的歧义：

```
echo "{$str1}{$str2}{$str3}"; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T14:57:13.730

您正在寻找字符串连接。

它是

```
echo $str1 . $str2 . $str3; 
```

有关详细信息，请参阅[http://nz2.php.net/language.operators.string](http://nz2.php.net/language.operators.string)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T14:57:19.237

怎么样：

```
echo $str1 . $str2 . $str3; 
```

# asp.net - 在 aspx 标记中将 Web 部件添加到共享点页面

> ID：557204
> 
> 赞同：1
> 
> 时间：2009-02-17T14:57:09.080
> 
> 标签：asp.net, sharepoint, web-parts, markup

我有一个在 Project Server 安装的布局目录中复制的 aspx 页面。aspx 是具有 Web 部件区域的 Web 部件页面。如何在 Web 部件区域内的页面标记中添加 Web 部件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T18:11:35.353

您可以使用 SPLimitedWebPart 管理器在运行时添加 Web 部件的实例。我在我们的 MySites 上执行此操作以控制组织需要的 Web 部件的添加、删除和移动。您可以将代码放在aspx页面中。

```
SPFile thePage = currentWeb.RootFolder.Files["default.aspx"]
using (Microsoft.SharePoint.WebPartPages.SPLimitedWebPartManager spLimitedWPManager = thePage.GetLimitedWebPartManager(System.Web.UI.WebControls.WebParts.PersonalizationScope.Shared))
{
       Assembly assembly = Assembly.Load("WebPartAssemblyName");
       WebPart webPart = (WebPart)assembly.CreateInstance("WebPartClassName");

       spLimitedWPManager.AddWebPart(webPart, ZoneId, ZoneIndex);
} 
```

您可能需要执行一些不同的操作才能访问您的布局页面的 Web 部件管理器。在此之后，您需要重定向回页面以显示更改。您还需要存储一个位值以确保您不会在每次后续访问时执行该操作。

如果您只需要这样做一次，那么我可能会推荐 PowerShell。

否则，您可以通过注册标记直接在 MarkUp 中添加 Web 部件：

```
<%@ Register TagPrefix="ABC" Namespace="Namespace" Assembly="Assembly" %> 
```

并直接添加 Web 部件，

```
<ABC:ClassName ID="ControlID" FrameType="None" runat="server" __WebPartId="YouWebPartGUID" WebPart="true" /> 
```

但是我们没有在网络区域内执行此操作，因为我们不想允许将其删除，所以我不知道它是否适用于这种情况。这是最简单的，但不允许进行任何自定义，而且 SharePoint 并不真正“了解”Web 部件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:04:03.830

布局目录中不能有可自定义的 Web 部件页面！这仅在存储在文档库或 SPWeb 中的其他文件夹中的 Web 部件页面上受支持，即您可以获得 SPFile 引用的 ASPX 文件。layouts 目录中 ASPX 页面上的 Web 部件必须作为 Web 控件添加到 ASPX 源中。

# .net - ListView 的 DragEnter、DragOver、DragDrop 事件未引发 (AllowDrop=True)

> ID：557208
> 
> 赞同：11
> 
> 时间：2009-02-17T14:57:26.973
> 
> 标签：.net, winforms, listview, drag-and-drop, events

这个很奇怪：

我的应用程序工作得很好，但是突然间该死的 ListView 控件的事件不再引发了。它只是来去匆匆，没有任何明确的理由。（显然）我已将 AllowDrop 属性设置为 True，并按如下方式处理 DragEnter、DragOver 和 DragDrop 事件：

```
Private Sub lstApplications_DragDrop(ByVal sender As Object, ByVal e As    System.Windows.Forms.DragEventArgs) Handles lstApplications.DragDrop, Me.DragDrop
    m_fileNames = CType(e.Data.GetData(DataFormats.FileDrop), String())
    mnuType.Show(Cursor.Position, ToolStripDropDownDirection.BelowLeft)
End Sub

Private Sub lstApplications_DragEnter(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstApplications.DragEnter, Me.DragEnter, lstApplications.DragOver, Me.DragOver
    If chkMode.Checked OrElse Not e.Data.GetDataPresent(DataFormats.FileDrop, True) Then
        e.Effect = DragDropEffects.None
    Else
        e.Effect = DragDropEffects.Copy
    End If
End Sub 
```

我在这两种方法中编写的代码无关紧要，因为没有引发任何事件。我在这里有什么遗漏吗？

* * *

我在另一台机器上运行相同的应用程序，它工作得很好。然后我重新启动了我自己的机器，一切又开始工作了。我不确定，但 Windows 似乎有问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2015-05-06T04:12:06.627

我刚刚经历了几个小时的痛苦，遇到了类似的问题。拖放工作的三个强制性要求：

1.  确保您的目标 UI 元素具有`AllowDrop="True"`，整个应用程序不需要它，只需要您想要启用的元素。
2.  如果未设置其背景，则某些元素不会接收某些鼠标事件（包括 d&d）。`Background="Transparent"`会做。
3.  以管理员权限运行任何程序都会弄乱拖放。确保在**没有管理员权限**的情况下启动 Visual Studio 。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-06T10:26:10.693

我在 Windows 7 上运行 Visual Studio 2008 时遇到了这个问题。VS2008 必须在 Windows 7 上以管理员权限运行，所以我以不同的用户身份运行它。我很确定这可以防止拖放工作，因为应用程序在作为应用程序运行时运行良好，但从 Visual Studio 运行时拖放将不起作用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T23:00:41.523

只是记得我们确实在很久以前见过这个。

我相信它是这样发生的：

拖放工作正常，直到某些用户代码在拖放操作期间引发异常。

异常会被吃掉；你不会得到任何错误对话框（你自己试试看）。在此之后，拖放将停止工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T15:00:55.470

表单本身的 AllowDrop 属性是否设置为 true？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T15:20:08.497

如果您遇到间歇性行为，则可能是异常正在从您的处理程序中逃逸并且无意中断开拖放。尝试在代码周围添加一个全面的 Try/Catch 块，并在 Catch 块中执行 Debug.Fail。这至少可以排除未处理的异常是您的问题的可能性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-24T19:15:40.847

不知何故，您的控件的创建可能被修改了。您确定句柄存在并且完整的初始化代码集已经运行吗？

我最近遇到了一个类似的问题，由于我犯了一个错误，Control.OnHandleCreated 没有运行，这导致了各种不良情况，包括您在此处描述的内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T15:12:18.047

您是否尝试过删除方法处理程序存根，重新编译，然后将它们放回去并再次编译？我知道这听起来很古怪，但有时我只需要重置我的工作副本。

# sql - 从查询结果表中读取列数及其类型（在 C 中）

> ID：557209
> 
> 赞同：0
> 
> 时间：2009-02-17T14:57:31.560
> 
> 标签：sql, c, postgresql

我使用 PostgreSQL 数据库和 C 来连接它。[在dyntest.pgc](https://www.codeblog.org/viewsrc/postgresql-8.2.0/src/interfaces/ecpg/test/sql/dyntest.pgc)的帮助下，我可以从查询的结果表中访问列数及其 (SQL3) 类型。

问题是当结果表为空时，我无法获取一行来获取此数据。有人对此有解决方案吗？

查询可以是 SELECT 1,2,3 - 所以，我认为我不能为此使用 INFORMATION SCHEMA，因为没有基表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T15:16:32.937

我不熟悉 ecpg，但使用 libpq，您应该能够调用 PQnfields 来获取字段数，然后调用各种 PQf* 例程（如 PQftype、PQfname）来获取详细信息。这些函数采用 PGResult，即使没有行也可以使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:06:19.747

> 问题是当结果表为空时，我无法获取一行来获取此数据。有人对此有解决方案吗？

我不确定是否真的能得到你想要的，但似乎答案就在问题中。如果表为空，则没有行...

这里唯一的解决方案似乎您必须等待一个非空的结果表，然后获取所需的信息。

# reporting-services - Microsoft Reporting Services - 如何计算组内值的总和

> ID：557212
> 
> 赞同：0
> 
> 时间：2009-02-17T14:57:57.427
> 
> 标签：reporting-services

我有一个报告，其中有一个列表，用于按特定字段（城市）对数据进行分组。

在列表控件中是一个具有页脚行的表格。在页脚行中，使用 SUM(Field!SalesAmnt.Value) 将表中的数据汇总在一起。

我遇到的问题是每个组/城市的计算总和值是所有组/城市的值 - 不仅仅是那个组/城市的值。

如何让报告仅对组内的值求和？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:01:16.777

使用*组*页脚，而不是*表格*页脚。（如果您从组的右键单击菜单中打开组​​属性窗口，您会看到包含页眉和页脚的复选框。如果您不知道在哪里查找，这不是最容易找到的。）

# python - 让 pyunit 显示每个断言的输出

> ID：557213
> 
> 赞同：1
> 
> 时间：2009-02-17T14:58:21.077
> 
> 标签：python, unit-testing, python-unittest

如何让 python 的 unittest 模块显示每个断言的输出，而不是在每个测试用例的第一个断言中失败？如果我能看到失败的完整模式而不仅仅是第一个，那么调试会容易得多。

在我的情况下，断言基于一个数组上的几个循环，该数组包含一个对象加上一些函数名称和预期的输出（见下文），所以没有一种明显的方法（至少对我来说）只是将每个断言分成一个单独的测试用例：

```
import unittest
import get_nodes

class mytest2(unittest.TestCase):
    def testfoo(self):
        root = get_nodes.mmnode_plus.factory('mytree.xml')

        tests = [
            (root, {'skip_traversal': False, 'skip_as_child': True, 'skip_as_parent': False, 'is_leaf': False}),
            (root[0], {'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': False, 'is_leaf': False}),
            (root[1], {'skip_traversal': True, 'skip_as_child': True, 'skip_as_parent': True}),
            (root[1][0], {'skip_traversal': True}),
            (root[0][0], {'is_leaf': False, 'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': False}),
            (root[0][0][0], {'is_leaf': True, 'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': True}),
            (root[0][4], {'skip_traversal': True, 'skip_as_child': True, 'skip_as_parent': True}),
            (root[0][7], {'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': True}),
        ]       

        for (node, states) in tests:
            for test_state, exp_result in states.iteritems():
                self.assertEqual(node.__getattribute__(test_state)(), exp_result, "unexpected %s for state %s of node %s %s" % (not exp_result, test_state, repr(node), repr(node.__dict__)))

unittest.main() 
```

`obj.__getattribute__('hello')`返回`obj.hello`so`node.__getattribute__(test_state)()`是我调用 node 的成员函数的方式，它的名称存储在 test_state 变量中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:32:58.027

```
import unittest
import get_nodes

class TestSuper(unittest.TestCase):
    def setUp( self ):
        self.root = get_nodes.mmnode_plus.factory('mytree.xml')
    def condition( self, aNode, skip_traversal, skip_as_child, skip_as_parent, is_leaf ):
        self.assertEquals( skip_traversal, aNode.skip_traversal )
        self.assertEquals( skip_as_child, aNode. skip_as_child)
        self.assertEquals( skip_as_parent, aNode. skip_as_parent)
        self.assertEquals( is_leaf , aNode. is_leaf )

class TestRoot( TestSuper ):
    def testRoot( self ):
        self.condition( self.root, **{'skip_traversal': False, 'skip_as_child': True, 'skip_as_parent': False, 'is_leaf': False} )

class TestRoot0( TestSuper ):
    def testRoot0( self ):
        self.condition( self.root[0], **{'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': False, 'is_leaf': False} )

class TestRoot1( TestSuper ):
    def testRoot1( self ):
        self.condition( self.root[1], **{'skip_traversal': True, 'skip_as_child': True, 'skip_as_parent': True})

class TestRoot10( TestSuper ):
    def testRoot10( self ):
        self.condition( self.root[1][0], **{'skip_traversal': True})

class TestRoot00( TestSuper ):
    def testRoot00( self ):
        self.condition( self.root[0][0], **{'is_leaf': False, 'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': False})

class TestRoot0( TestSuper ):
    def testRoot000( self ):
        self.condition( root[0][0][0], **{'is_leaf': True, 'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': True})

class TestRoot04( TestSuper ):
    def testRoot04( self ):
        self.condition( self.root[0][4], **{'skip_traversal': True, 'skip_as_child': True, 'skip_as_parent': True})

class TestRoot07( TestSuper ):
    def testRoot07( self ):
        self.condition( self.root[0][7], **{'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': True})

unittest.main() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T22:27:41.853

我可以通过使用内置 type() 工厂动态创建新的 TestCase 类来做到这一点：

```
root = get_nodes.mmnode_plus.factory('somenodes.xml')

tests = [
    (root, {'skip_traversal': False, 'skip_as_child': True, 'skip_as_parent': False, 'is_leaf': False}),
    (root[0], {'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': False, 'is_leaf': False}),
    (root[1], {'skip_traversal': True, 'skip_as_child': True, 'skip_as_parent': True}),
    (root[1][0], {'skip_traversal': True}),
    (root[0][0], {'is_leaf': False, 'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': False}),
    (root[0][0][0], {'is_leaf': True, 'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': True}),
    (root[0][4], {'skip_traversal': True, 'skip_as_child': True, 'skip_as_parent': True}),
    (root[0][7], {'skip_traversal': False, 'skip_as_child': False, 'skip_as_parent': True}),
]

i = 0
for (node, states) in tests:
    for test_state, exp_result in states.iteritems():

        input = node.__getattribute__(test_state)()
        errstr = "expected %s, not %s for state %s of node %s" % (input, exp_result, test_state, repr(node))

        locals()['foo' + str(i)] = type('foo' + str(i), (unittest.TestCase,),
            {'input': input, 'exp_result': exp_result, 'errstr': errstr, 'testme': lambda self: self.assertEqual(self.input, self.exp_result, self.errstr)})
        i += 1 
```

# sas - 打开 SAS 数据集以从 .sas 程序中查看

> ID：557214
> 
> 赞同：16
> 
> 时间：2009-02-17T14:58:30.933
> 
> 标签：sas

有没有办法从 .sas 文件中打开 SAS 数据集进行查看（即在“ViewTable”窗口中）？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-17T15:01:36.030

我认为这会做你想要的：

`dm log "vt sashelp.air";`

只需将`"sashelp.air"`零件更改为您的`lib.table`组合即可。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T16:15:47.473

dw.mackie 的答案是正确的。从 SAS 编辑器窗口提交时效果很好。

但我只是想提醒您在批处理模式下尝试时要小心（也就是说，让 SAS 使用 -sysin 选项直接从命令行运行 .sas 程序）。它确实会在执行时尝试弹出交互式 SAS 窗口环境。

但是，如果您的批处理代码还尝试构建一些图形/图表，您将需要使用 -noterminal 选项。并且 -noterminal 选项与 dm 命令不兼容。您会立即在日志中发现它，但我只是想提醒您一下。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T17:33:56.147

由于我的一些数据集的大小，我只做一个简单的 proc 打印并将输出限制为只有 50 个观察值。我经常这样做，以至于我创建了以下将输出转储到 html 文件的宏。

```
%Macro DPrt(Dset, obs=50, vars=, w=, Path="C:\output\");
    %LET BKPATH = &Path;
    %PUT BKPATH= &BKPATH;
    options obs = &obs.;
    title;
    ods listing close;
    ods html
        path  = &BKPATH.
        body  = "Debug-&Dset..htm"
        style = THEME;

        proc print data = &Dset n u split=' ';
        %if &vars NE %THEN %DO;
           var &vars.;
        %END;        
        %if &w NE %THEN %DO;
           &w;
        %END;        
        Run;

    ods html close;
    ods listing;
    options obs = MAX;
%Mend Dprt; 
```

数据集测试的示例调用看起来像

```
%dprt(test) 
```

# reporting-services - Reporting Services“无法连接到报表服务器数据库”

> ID：557223
> 
> 赞同：1
> 
> 时间：2009-02-17T15:01:46.403
> 
> 标签：reporting-services

我们正在运行 Reporting Services，在过去的 6 个月中两次出现故障，持续了 1-3 天，然后突然又开始工作了。错误范围从无法在浏览器中查看树根，到能够在报告中插入参数，但在报告生成之前崩溃。

查看日志，有 1 个错误和 1 个警告似乎有些对应。

```
ERROR:Event Type:   Error
Event Source:   Report Server (SQL2K5)
Event Category: Management 
Event ID:   107
Date:       2/13/2009
Time:       11:17:19 AM
User:       N/A
Computer:   ************
Description:
Report Server (SQL2K5) cannot connect to the report server database.

For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp.

WARNING: *always comes before the previous error*
Event code: 3005 
Event message: An unhandled exception has occurred. 
Event time: 2/13/2009 11:06:48 AM 
Event time (UTC): 2/13/2009 5:06:48 PM 
Event ID: 2efdff9e05b14f4fb8dda5ebf16d6772 
Event sequence: 550 
Event occurrence: 5 
Event detail code: 0 

Process information: 
    Process ID: 5368 
    Process name: w3wp.exe 
    Account name: NT AUTHORITY\NETWORK SERVICE 

Exception information: 
    Exception type: ReportServerException 
    Exception message: For more information about this error navigate to the report server on the local server machine, or enable remote errors. 
```

在停机期间，我们尝试重新启动从运行 RS 的服务器到它调用以填充报告的数据库的所有内容，但均未成功。当我星期一早上来的时候，它又开始工作了。

任何人对可能导致这些问题的原因有任何想法吗？

**编辑**

* * *

几个月前尝试了以下两个建议均无济于事。从那以后这个问题就没有出现过，也许我无法控制的事情发生了变化......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-18T18:55:53.150

我们有接近相同的项目。您需要进入并在 IIS 中启动应用程序池。当我们的 .dll 出现许多不良连接错误时，我们会在网站上显示“服务不可用”。您可以与 DBA 团队一起使用它来追踪它;;;;进程 ID：5368 进程名称：w3wp.exe

# c# - 在 .Net MVC 中，如何从动作之外的 URL 路由访问变量？

> ID：557224
> 
> 赞同：2
> 
> 时间：2009-02-17T15:02:19.567
> 
> 标签：c#, asp.net-mvc

我正在构建一个其他控制器可以继承的控制器（跨站点提供基本功能而无需重复代码）：

```
public abstract class ApplicationController : Controller
{
    protected ApplicationController()
    {
       //site logic goes here
       //what is the value of agentID from the Action below??
    }
}

public class AgentController : ApplicationController
{
    public ActionResult Index(string agentID)
    {
        return View();
    }
} 
```

适用于整个站点的逻辑将进入 ApplicationController 类的构造函数。

问题出在构造函数中，我需要从 Action 访问参数中的值，在本例中为 agentID（在整个站点中都是相同的）。有没有办法读取该值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T15:20:26.593

动作发生*在*构造函数之后。该值在构造函数中不存在（尚未绑定）。路由数据可能在构造函数中是已知的，但动作数据绑定肯定还没有发生。在调用该操作之前，您*无法*确定地获得此值。

可以通过以下方式在控制器内部访问路由数据：

```
ControllerContext.RouteData.Values 
```

但是，假设 agentID 只能绑定到路由数据是不正确的。事实上，它可能来自服务器变量、表单字段、查询字符串参数等。我的建议是在需要的地方显式传递它。如果不出意外，它会使您的单元测试更好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-02T21:49:02.153

我想出了如何做到这一点......与 Craig Stuntz 的回答非常相似，但不同之处在于你如何到达 RouteData。

使用 ControllerContext.RouteData.Values 在以这种方式使用的常规方法中不起作用（它来自原始控制器，但不是来自像我构建的基础控制器），但我确实通过覆盖 OnActionExecuting 方法到达了 RouteData：

```
 protected override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        string agentID = filterContext.RouteData.Values["agentID"].ToString();
        OtherMethodCall(agentID);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T15:15:50.113

有，尽管您需要覆盖`ControllerFactory`. 在`RegisterRoutes`global.asax.cs 的方法中，添加以下行：

```
public static void RegisterRoutes(RouteCollection routes) {
    // Route code goes here
    ControllerBuilder.Current.SetControllerFactory(typeof(MyControllerFactory));
} 
```

然后定义你的`MyControllerFactory`类

```
public class MyControllerFactory : DefaultControllerFactory {
    public override IController CreateController(RequestContext requestContext, string controllerName) {
        // poke around the requestContext object here
        return base.CreateController(requestContext, controllerName);
    }
} 
```

该`requestContext`对象包含所有路线数据和值。您可以使用它来将您想要的任何内容传递给控制器​​的构造函数。

编辑添加，这也是大多数流行的依赖注入器（例如，[StructureMap](http://haacked.com/archive/2007/12/07/tdd-and-dependency-injection-with-asp.net-mvc.aspx)）的工作方式。

# c# - MSTest - 多次执行测试

> ID：557228
> 
> 赞同：1
> 
> 时间：2009-02-17T15:03:10.220
> 
> 标签：c#, selenium, mstest

我正在使用 MSTest 来驱动 Selenium，并且我想在同一个测试运行中针对多个浏览器执行测试。有没有办法做到这一点？

谢谢，内森

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T15:21:30.007

看看[DataSourceAttribute](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.datasourceattribute.aspx)。它提供了基于数据源多次启动测试的能力。例如，我使用列出平台的 CSV 文件（在您的情况下为浏览器）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:52:17.640

Nathan，不幸的是，我对 MSTest 无能为力，但我确实对 Selenium 和并行执行了解很多（我是 RC 的创始人之一，几年前创办了一家 Selenium-in-the-cloud 公司）。

一个问题：如果你打算在 Firefox、Safari 和 IE 下同时执行相同的测试，你是否考虑过测试执行的工件可能会导致竞态条件？例如，如果测试要创建一个新用户“bob”，那么只有第一个测试会通过。

我是并行化的忠实拥护者，但它通常与状态管理和控制所述状态的固定装置齐头并进。很想听听它对您有何影响，或者这些类型的问题是否对您的测试来说是个问题（根据应用程序和测试，它们通常从“不是问题”到“严重问题”不等）。

# bash - 有条件的 bash 搜索？

> ID：557229
> 
> 赞同：0
> 
> 时间：2009-02-17T15:03:33.170
> 
> 标签：bash, search

如何在 Bash 中进行这样的条件搜索，就像在 Google 中一样

```
"python" imag 
```

单词**python**必须在搜索中，而单词**imag**旨在至少匹配 image 和imaging。

我想在 python 模块中搜索图像，可能在 apt-get 中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:19:46.327

用于搜索单词的 grep 选项是 -w：

```
grep -w python | grep imag 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T15:14:47.790

一个肮脏的方法应该是使用空格。当您查看确切的单词时，它们可能位于空格之间。例如对于 apt：

```
apt-cache search " python " imag* 
```

**编辑**

清洁剂如下：

```
apt-cache search '\<python\>' imag* 
```

# sql - 格式化 SQL 查询结果

> ID：557233
> 
> 赞同：0
> 
> 时间：2009-02-17T15:04:31.873
> 
> 标签：sql, sql-server

我正在寻找一种方法来设置 SQL 查询返回的列结果的宽度。

我运行一个查询，例如从 ConfigScheduling 中选择产品，其中产品是 Nvarchar(Max) 列。带有结果到网格的 SQL Server Management Studio 中的结果是一个 90 字符宽的可见列，其中包含完整的结果，但不可见。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:20:22.987

默认情况下找不到它，但是如果您双击列标题的右侧部分，它将像在 Excel 中一样伸展。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T23:10:00.237

Tools>Options>Query Results>SQL Server>Results to Grid>Non XML data Tools>Options>Query Results>SQL Server>Results to Text>每列显示的最大字符数。

如果这些仍然不能满足您的需求，您将需要使用其他工具，例如 bcp 或 sqlcmd/osql。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:06:58.370

如果我没记错的话，SQL Server Management Studio 无法将整个 nvarchar(max) 字段拉入显示，也不会尝试这样做。完全访问结果集的唯一方法是使用第三方工具或在网格视图或 web 应用程序中显示它。

# sql - 我应该始终完全限定 SQL 中的列名吗？

> ID：557240
> 
> 赞同：12
> 
> 时间：2009-02-17T15:05:55.520
> 
> 标签：sql, coding-style

出于对使用 SQL 语句的兴趣，我是否应该始终使用完全限定的列名 (tablename.columnname)，即使只使用一个表，例如

```
SELECT table.column1, table.column2 FROM table 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T15:07:53.470

如果你这样做会更好 - 它不会增加任何复杂性，并且可以防止将来出现错误。

但是在一个定义良好的系统中，你不应该这样*做*——它就像编程语言中的命名空间。理想的情况是不发生冲突，但由于过度使用显式名称会导致代码混乱。

-亚当

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T15:13:38.153

我通常遵循以下规则：

使用单个表时，不必使用表名前缀：

```
SELECT col1, col2 FROM table1 
```

对于多个表，请使用完整的表名。别名可能会令人困惑，尤其是在进行多个连接时：

```
SELECT table1.col1, table2.col2 FROM table1 INNER JOIN table2 on 
            table1.id = table2.id 
```

我看到许多开发人员使用表别名，但特别是在有多个开发人员的大型项目中，这些可能会变得晦涩难懂。一些额外的击键可以使代码更加清晰。

但是，如果列具有相同名称，则可能需要使用列别名。在这种情况下：

```
 SELECT table1.col1, table2.col1 as table2_col1 FROM table1 
            INNER JOIN table2 on 
            table1.id = table2.id 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T15:09:08.257

我会将此作为个人喜好。如果您开始加入包含重复列名的表，它只会有所作为。

此外，不要完整地写出表名，而是使用别名：

从表中选择 t.column1，t.column2 作为 t

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T15:08:53.547

如果您只从一张表中进行选择，我看不到整体的用处。如果您从多个表中进行选择，对列名进行限定肯定会使可能不熟悉您的数据库架构的任何其他开发人员更容易阅读。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T15:09:31.533

如果您只查询一张表 - 我会说不。这种方式更具可读性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T17:16:14.253

**不要解决尚未解决的问题。** （至少我的团队负责人总是这么告诉我。）我相信有一天必须在你的语句中添加一个 JOIN 的猴子可以弄清楚。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T15:08:08.027

当超过 1 个表在玩时，我更喜欢使用表别名。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T15:09:56.273

我认为始终使用完全限定的列名是个好主意。如果表名太长，请使用别名。它还为您的查询准备了例如连接的未来添加。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T16:19:11.507

我想说使用限定名很好，它增加了代码的可读性。将它用于单个表没有多大意义，但必须用于多个表。如果表名太大建议使用别名，别名最好从表名派生。

```
SELECT Dep.Name,Emp.Name
FROM Department DEP INNER JOIN Employee Emp
ON Dep.departmentid=Emp.DepartmentID 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-17T16:38:54.093

**不。**

您应该始终为表设置**别名**，并且您应该始终使用表**别名**来限定列名。

```
select
    p.FirstName,
    p.LastName,
    p.SSN
from Person p
where p.ID = 345 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-11-21T15:57:20.527

即使是定义最明确的系统也会发生变化。很容易将新字段引入表中，从而导致现有查询中的歧义。

完全限定它们可以保护您免受这种情况的影响。

# django - Django：如何在表单 clean() 方法的 django 验证错误中添加超链接？

> ID：557242
> 
> 赞同：32
> 
> 时间：2009-02-17T15:06:16.517
> 
> 标签：django, django-forms

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-02-17T15:17:58.860

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-07-09T20:26:50.817

您可以在表单字段定义上执行此操作，而无需像这样引发表单级别 ValidationError：

```
class RegistrationForm(ModelForm):
    ...

    ### Django established methods
    # form wide cleaning/validation
    def clean_email(self):
        """ prevent users from having same emails """
        email = self.cleaned_data["email"]
        try:
            User.objects.get(email__iexact=email)
            raise forms.ValidationError(
                    mark_safe(('A user with that email already exists, click this <a href="{0}">Password Reset</a> link'
                            ' to recover your account.').format(urlresolvers.reverse('PasswordResetView')))
                            )
        except User.DoesNotExist:
            return email

    ...

    ### Additional fields
    location = forms.RegexField(max_length=255,
        regex=r"^[\w' -]+, [\w'-]+, [\w'-]+, [\w'-]+$", #ex 1 Mclure St, Kingston, Ontario, Canada
        help_text="location, ex: Suite 212 - 1 Main St, Toronto, Ontario, Canada",
        error_messages={
            'invalid': mark_safe("Input format: <strong>suite - street</strong>, <strong>city</strong>, " 
                                "<strong>province/state</strong>, <strong><u>country</u></strong>. Only letters, "
                                "numbers, and '-' allowed.")}) 
```

# architecture - 在 Visual Studio 中设置“企业”项目的最佳实践？

> ID：557261
> 
> 赞同：4
> 
> 时间：2009-02-17T15:09:07.460
> 
> 标签：architecture

我正在为一家只有 6 名员工（包括我自己）的小型企业（包括我自己）开发企业风格的应用程序，在您质疑为什么 6 人公司需要企业应用程序之前，我们有很多事情要做简化它所需的流程和工具）。与往常一样，我在设置项目时尝试遵循最佳实践；我将使用 .NET 3.5，数据库位于 Windows Server 2003/SQL Server 2005 上。

在我开发和测试解决方案时，我是否应该在我的主项目中包含所有内容？我的意思是... Visual Studio 2008 Professional 让您拥有“数据库项目”以及所有其他类型的项目。对于这个应用程序，我将需要：

*   包含新数据模式的创建和测试脚本的数据库项目
*   包含实际代码/应用程序的 C# 项目：
    1.  使用 ASP.NET MVC 的面向客户的网站
    2.  后端订单处理系统，可能基于 Web，但可能是“智能客户端”
*   SSIS 项目包含用于对我们的供应商提供的“实时”应用程序数据进行 ETL 的包，并从遗留数据库中迁移现有的客户和订单数据。
*   SQL Server Reporting Services 的报告项目

基本上，我想知道将所有这些作为一个大型 Visual Studio 解决方案的一部分（我们称之为“EnterpriseSolution”）是否是一个好主意，或者我是否应该将它们分开并单独处理。我看过的大多数书籍和网站都将它们都包含在一起，但它们也假设有一个由开发人员、DBA、架构师等组成的团队——在这种情况下，我将他们全部整合在一起。在编写应用程序的其余部分之前，需要完成数据库项目和至少一些 ETL 流程并将其加载到生产环境中，因为我们需要在实时环境中加载新供应商的产品（以开始销售它们）。

对于应该如何开始构建它，我有点不知所措，但我想在开始布局和开始编码之前制定一个总体计划。

关于如何处理这样的项目有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:56:29.237

使用一个包含多个项目的解决方案绝对是个好主意。如果要使用 ASP.NET MVC，请为每一层定义一个 C# 项目：MVC Web、服务层、数据访问层和单独的测试项目。您可以从 Rob Conery 的[Storefront](http://blog.wekeroad.com/mvc-storefront/mvc-storefront-part-1/)示例应用程序或[Oxite](http://www.codeplex.com/oxite/Release/ProjectReleases.aspx?ReleaseId=23315)中学习。

您也可以尝试使用模式和实践组中的指导包：

[http://msdn.microsoft.com/en-us/practices/default.aspx](http://msdn.microsoft.com/en-us/practices/default.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T21:34:08.813

我发现在单独的解决方案中维护客户端和服务器端代码最方便。这假定服务器提供了一个稳定的接口，例如 Web 服务或 WCF 接口。

随着时间的推移，您可能会使用一种以上的客户端技术（Windows、Web...），并且将这些技术集群保持在各自的解决方案中可以让事情变得更简单。

如果您正在寻找一个好的架构示例，请参阅 CodePlex 的[Northwind Starter Kit](http://codeplex.com/nsk)。我在阅读Dino Esposito 和 Andrea Saltarello的“ [Microsoft .Net：为企业构建应用程序”时发现了这一点。](http://www.microsoft.com/learning/en/us/Books/12863.aspx)

> Northwind Starter Kit 是由 Managed Designs ( [http://www.manageddesigns.it](http://www.manageddesigns.it) ) 制作的示例应用程序，旨在用作设计和实现 .NET 分层应用程序架构时的蓝图。该应用程序使用 Microsoft SQL Server 和 Microsoft Access 中包含的标准 Northwind 数据库：无需修改数据库架构即可安装和运行入门工具包。

我同意@Chris Ballance 的观点，即包含一个数据库项目会非常有帮助。但请注意，数据库项目似乎有点复杂，因为它同步了项目和引用数据库结构。

+汤姆

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:21:28.023

我建议创建一个“空白解决方案”来启动它是一个 *.sln 文件（比如 EnterpriseSolution.sln），该文件将位于名为 EneterpriseSolution 的文件夹中。可以从“其他类型”创建空白解决方案。然后，我将添加您描述为单独项目的其他部分，每个部分都在“EnterpriseSolution”文件夹下的自己的文件夹中。

例如，每个面向客户的网站都有自己的项目文件夹。看起来您将拥有多个网站，因此如果您使用一个解决方案包装器，则需要确保为每个网站设置不同的“端口”以在其下运行。但是，您也可以创建不同的解决方案“包装器”（作为开始的空白解决方案，然后项目引用您想要的项目）以将每个网站单独包含在您的文件夹结构中，以便您可以专注于企业解决方案的一部分。但实际上，您会知道一切在哪里以及它是如何组织的。

这样，当您通过 Windows 资源管理器查看企业解决方案文件夹时，您将看到的唯一内容是您的解决方案文件和项目文件夹。

谢谢，祝你的项目好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T15:17:38.330

我所做的是为项目的每个独立部分创建单独的解决方案，然后开始将它们集成到更复杂的解决方案中。这样，您可以只加载应用程序的一部分以进行单元测试或调试。

例如，在一个多层应用程序中，我会为数据层和一个单元测试项目创建一个独立的解决方案。另一种解决方案将包括数据层和业务对象层与单元测试一起工作。完整的解决方案将包括上述项目以及 UI 项目

这样我就可以分别加载和测试我的应用程序的每个部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T15:21:07.853

我喜欢从一个单一的解决方案开始，直到它变得如此之大以至于构建时间明显变慢。

你如何做到这一点实际上取决于系统的不同部分将如何相互连接。最简单的方法是采用面向服务的架构。然后每个服务可以有不同的解决方案和前端自己的解决方案。

但是，我真的建议您使用一种解决方案，并且仅在必要时使事情变得更加复杂。很高兴能够一键构建所有内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T15:21:26.043

应用程序没有理由不能全部合二为一，如果您需要分解元素，您可以稍后再做，只要您保持对象松散耦合。

拥有单独项目的一个很好的方面是，您可以通过卸载它们来成功编译一个部分而使其他部分不完整。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T15:22:41.923

首先，**数据库项目**是很棒的东西，我强烈建议将它用于您的数据层。

我会按项目分开，因为它是有意义的，但将它们全部放在同一个解决方案中。

# java - 使用 Seam 和 JBoss AS 访问 OpenLDAP 的最佳框架？

> ID：557268
> 
> 赞同：0
> 
> 时间：2009-02-17T15:10:40.813
> 
> 标签：java, seam, openldap

我们目前正在为我们的基于 Web 的服务实施一个门户。门户和服务是用 Seam 编写的，我们使用 OpenLDAP 来存储用户、组和权限等安全数据。到目前为止，我们已经研究过编写自己的代码来访问 LDAP，但是我们可以使用任何现有的 API 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T15:20:48.777

如果您是 Spring 用户，我会查看[Spring LDAP modules](http://www.springsource.org/ldap)。他们做得很漂亮；他们遵循 JDBC 实现所规定的习语。很干净，很不错。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:14:10.007

不久前，我们为我们的 Web 应用程序执行此操作并调查了以下内容：http: [//developers.sun.com/sw/docs/examples/appserver/ldap.html](http://developers.sun.com/sw/docs/examples/appserver/ldap.html)

但是，我们最终只使用 Tomcat 内置的 LDAP 支持，因为基本身份验证对我们来说已经足够了。

这是我们如何在 tomcat 中设置身份验证的示例： [http ://blog.mc-thias.org/?c=1&more=1&pb=1&tb=1&title=tomcat_ldap_authentication](http://blog.mc-thias.org/?c=1&more=1&pb=1&tb=1&title=tomcat_ldap_authentication)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T15:14:39.740

[JLDAP](http://www.openldap.org/jldap/overview.html)

> Java 的 LDAP 类库 (JLDAP) 允许您编写应用程序来访问、管理、更新和搜索存储在使用 LDAPv3 可访问的目录中的信息。

# perl - 为什么我从 Perl 的 system() 开始的进程不是子进程？

> ID：557271
> 
> 赞同：4
> 
> 时间：2009-02-17T15:11:42.900
> 
> 标签：perl, unix, process, system, waitpid

Perl 的 system() 启动一个进程，但打破了父/子关系？

测试.pl：

```
use POSIX;

system("./test.sh &");

my $pid = `ps -C test.sh -o pid=`;

print "pid: -$pid-\n";

waitpid($pid, 0); 
```

测试.sh：

```
while true
do
    sleep 1
done 
```

当我运行 test.pl 时，它会找到并打印出 test.sh 的正确 pid。但是 waitpid() 返回 -1 并且 test.pl 退出。test.pl 存在后，test.sh 仍在运行。

看起来 test.sh 不是 test.pl 的子级，它会破坏 waitpid()。为什么会发生这种情况以及如何使 system() 行为？那是因为 Perl 会自动清除孩子吗？如果是，我该如何解决明确等待孩子的一般任务？

更新：

下面的答案建议使用 fork/exec。最初的问题是这样的：

1.  从 Perl 脚本，运行启动服务的命令行实用程序。实用程序退出，但服务保留。

2.  一段时间后，找到该服务的 pid 并等待它。

fork/exec 没有解决这个问题，尽管它解决了这个问题。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-17T15:17:35.583

test.sh 进程不是您的子进程。分叉了一个外壳（这`system()`是你的孩子），那个外壳分叉了一个运行 test.sh 程序的孩子。作为您孩子的 shell 退出了。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T15:23:26.117

您可能想要做的是这样的事情：

```
my $pid = fork || exec './test.sh';
print "pid: -$pid-\n";
waitpid($pid, 0); 
```

虽然由于 shell 脚本处于无限循环中，但它会永远等待。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-17T15:23:55.960

一般来说，如果您不想让 Perl 帮助您，您应该手动 fork 和 exec。很难确定你在做什么，但我认为你想要这个：

```
my $pid = fork;
unless($pid){
    # child;
    exec(qw/sh test.sh/);
}

# parent
...
waitpid $pid, 0; 
```

就个人而言，我更喜欢让 AnyEvent 照看：

```
my $done = AnyEvent->condvar;

my $pid = fork;

unless( $pid ) { ... }

my $w = AnyEvent->child (
   pid => $pid,
   cb  => sub {
      my ($pid, $status) = @_;
      warn "pid $pid exited with status $status";
      $done->send;
   },
);

$done->recv; # control resumes here when child exits 
```

或者，更一般地说：http: [//github.com/jrockway/anyevent-subprocess/tree/master](http://github.com/jrockway/anyevent-subprocess/tree/master)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-17T15:23:17.957

为了进一步解释 Liudvikas 的回答——

```
system("./test.sh &")
 |
 |--> (P) /bin/sh (to run test.sh)
       |
       |--> (P) test.sh & (still running)

(P) - process 
```

在 fork'ing 并运行 test.sh 脚本之后，/bin/sh shell（Perl 系统调用的子代）退出，因此您从 waitpid() 获得 -1 返回值。

# emacs - 在 Emacs 中，keyboard-escape-quit 不破坏其他窗口的最佳方法是什么？

> ID：557282
> 
> 赞同：15
> 
> 时间：2009-02-17T15:15:03.157
> 
> 标签：emacs, elisp, dot-emacs

**编辑：**我知道有键盘退出（通常绑定到 Cg）；但我更想知道如何处理 Emacs 附带的编辑功能（就像在这种情况下）。当我想更改一些内置函数时，我不时会遇到这种情况。

在emacs中，当您按M-ESC ESC（或ESC 3次）时，您可以摆脱很多情况，例如transient-mark等。但是我习惯性地按了escape键（实际上我将其重新映射为单次点击转义键）超出了我的预期，这最终会杀死我的 Windows 配置，这很烦人。函数keyboard-escape-quit在simple.el中定义：

```
(defun keyboard-escape-quit ()
  "Exit the current \"mode\" (in a generalized sense of the word).
This command can exit an interactive command such as `query-replace',
can clear out a prefix argument or a region,
can get out of the minibuffer or other recursive edit,
cancel the use of the current buffer (for special-purpose buffers),
or go back to just one window (by deleting all but the selected window)."
  (interactive)
  (cond ((eq last-command 'mode-exited) nil)
    ((> (minibuffer-depth) 0)
     (abort-recursive-edit))
    (current-prefix-arg
     nil)
    ((and transient-mark-mode mark-active)
     (deactivate-mark))
    ((> (recursion-depth) 0)
     (exit-recursive-edit))
    (buffer-quit-function
     (funcall buffer-quit-function))
    ((not (one-window-p t))
     (delete-other-windows))
    ((string-match "^ \\*" (buffer-name (current-buffer)))
     (bury-buffer)))) 
```

而且我可以看到我不想要这些线条：

```
 ((not (one-window-p t))
     (delete-other-windows)) 
```

但是修改此功能的最佳方法是什么？我只能看到两种方法：1）修改 simple.el 2）将此函数复制到我的 .emacs 文件并在那里进行修改。两种方式都不是*很好*；理想情况下，我希望在 defadvice 上看到一些东西，但在这种情况下我不知道该怎么做。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-17T19:56:34.993

您可以使用 around 建议并重新定义有问题的函数来做您想做的事情（即 one-window-p 应该始终返回 t）：

```
(defadvice keyboard-escape-quit (around my-keyboard-escape-quit activate)
  (let (orig-one-window-p)
    (fset 'orig-one-window-p (symbol-function 'one-window-p))
    (fset 'one-window-p (lambda (&optional nomini all-frames) t))
    (unwind-protect
        ad-do-it
      (fset 'one-window-p (symbol-function 'orig-one-window-p))))) 
```

这种行为类似于 (let ...) 但必须更复杂，因为您需要覆盖有限范围的函数而不是变量。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T15:22:30.907

我通常发现'keyboard-quit (Cg) 可以摆脱所有这些情况。

但是，如果您真的想要此功能的变体，我认为复制到您的 .emacs 文件（并重命名，我通常使用 bp 的前缀）并在那里进行编辑可能是最好的选择。

编辑，响应编辑：一般来说，每当我想要一个 emacs 函数的编辑版本时，我要么自己编写，要么将其复制到我的 .emacs 中，将其重命名为 bp-whotever，然后进行适当的编辑。

这样做的缺点是我的 .emacs 是巨大的，并且可能对不再使用的古老函数非常笨拙......优点是每当我需要编写新东西时，我都有大量示例代码可供查看...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-11-02T21:33:22.627

这是另一个更简单的建议，它利用了在关闭窗口之前`keyboard-escape-quit`调用的事实：`buffer-quit-function`

```
(defadvice keyboard-escape-quit
  (around keyboard-escape-quit-dont-close-windows activate)
  (let ((buffer-quit-function (lambda () ())))
    ad-do-it)) 
```

适用于 Emacs 25.1。（我最初使用了@scottfrazer 的建议，但在 25.1 中并不满意。还没有打扰调试。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-25T17:11:12.633

默认情况下，按 Escape 键作为 Meta 前缀键；即涉及 Meta 键的键绑定。

三按 Escape 键将运行 keyboard-escape-quit，这类似于键盘退出，但更多的是“按我的意思做”的行为。

此代码可能对您的用例有所帮助。你可以在你的 Emacs 初始化文件中使用它：

```
;;; esc always quits
(define-key minibuffer-local-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-ns-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-completion-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-must-match-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-isearch-map [escape] 'minibuffer-keyboard-quit)
(global-set-key [escape] 'keyboard-quit) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-03-08T16:57:56.843

> 我更想知道如何处理 Emacs 附带的编辑功能（就像在这种情况下）。当我想更改一些内置函数时，我不时会遇到这种情况。

这正是我创建库[el-patch](https://github.com/raxod502/el-patch)的目的。你可以把它放在你的初始化文件中：

```
(el-patch-defun keyboard-escape-quit ()
  "Exit the current \"mode\" (in a generalized sense of the word).
This command can exit an interactive command such as `query-replace',
can clear out a prefix argument or a region,
can get out of the minibuffer or other recursive edit,
cancel the use of the current buffer (for special-purpose buffers),
or go back to just one window (by deleting all but the selected window)."
  (interactive)
  (cond ((eq last-command 'mode-exited) nil)
    ((> (minibuffer-depth) 0)
     (abort-recursive-edit))
    (current-prefix-arg
     nil)
    ((and transient-mark-mode mark-active)
     (deactivate-mark))
    ((> (recursion-depth) 0)
     (exit-recursive-edit))
    (buffer-quit-function
     (funcall buffer-quit-function))
    (el-patch-remove
      ((not (one-window-p t))
       (delete-other-windows)))
    ((string-match "^ \\*" (buffer-name (current-buffer)))
     (bury-buffer)))) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-08-22T05:10:07.670

这是一种使用 cl-lib 而不是现在已弃用的 cl 的新方法：

```
;; Make it so keyboard-escape-quit doesn't delete-other-windows
  (defadvice keyboard-escape-quit
      (around keyboard-escape-quit-dont-delete-other-windows activate)
    (cl-letf (((symbol-function 'delete-other-windows)
               (lambda () nil)))
      ad-do-it)) 
```

您需要确保在此之前您已致电：

```
(require 'cl-lib) 
```

# java - 在线程终止时调用方法

> ID：557298
> 
> 赞同：4
> 
> 时间：2009-02-17T15:18:10.420
> 
> 标签：java, multithreading

我正在编写一个 java 程序，它跟踪程序中创建的线程，然后应该在每个线程终止时执行一些工作。

我在 javadoc 中没有看到任何“线程终止挂钩”。

目前我能想到的实现我的要求的唯一方法是保持线程对象并以重复的间隔查询它的“状态”。

有没有更好的方法来做到这一点？

编辑：我不能以任何方式包装可运行文件或修改可运行文件。我的代码使用运行时检测，只是检测到创建了一个线程并获取对 Thread 对象的引用。可运行对象此时已经在运行。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T15:32:58.183

您可以使用[*join()*方法](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Thread.html#join())。

**编辑**

如果在线程未终止之前不能阻塞主线程，则可以创建一个*子主线程*来调用线程，然后用方法等待它们`join()`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T15:36:45.727

我看到了四种可能的方法。

1.  使用您自己的 Thread 子类和重写的 run() 方法。为线程终止添加 finally 块。
2.  使用具有类似装饰的 Runnable，可能作为提供的 Runnable 的包装器。这种情况的一个变体是子类化 Thread 以便在构造时应用这个包装器。
3.  创建第二个线程以在真实线程上加入（），从而检测其终止。
4.  使用检测来重写上面的 Thread.run() 方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T13:54:59.243

只是在 (sun 1.5) 源代码中寻找`java.lang.Thread`and `sun.misc.VM`，线程中有一个名为`threadStatus`. 它是 a `private int`，它的值映射到 enum `java.lang.Thread.State`。我还没有验证这一点，也没有确定它发生的速度有多快，但是当一个线程最终终止时，这个值将被设置为`java.lang.Thread.State.TERMINATED`.

有了这个相对简单的检测条件，我认为`threadStatus`当字段设置为特定目标值时，注入一个字段拦截器来触发一个事件是相当简单的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T15:35:46.087

如果你在每个 run 方法中添加了 try/finally 块，那么里面的代码将在每个线程完成时执行。让线程负责自己的清理工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T15:24:03.697

您可以为 Runnable 编写一个装饰器，它调用一个终止钩子，并在您创建线程时将您的线程代码包装在其中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T16:44:37.700

如果您需要将代码注入到第三方编译的代码中，AspectJ 可以帮助您做到这一点，但显然它不适用于标准 Java 类库。

看起来这里有一份关于这样做的白皮书，但不知道它是否实用。我认为你必须为此付出代价。

[http://portal.acm.org/citation.cfm?doid=1411732.1411754](http://portal.acm.org/citation.cfm?doid=1411732.1411754)

您可以下载 OpenJDK，自己安装钩子，编译自定义 JRE 并将其与您的应用程序一起发布 :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T16:29:33.430

正如你所说，没有线程终止钩子。您必须自己编写代码；在 Runnables 的 run() 方法结束时调用控制器上的某个方法（AFAIK 子类化 Thread 被认为是不好的做法，您应该实现 Runnable 并创建一个以该 Runnable 作为目标的线程）。

您还可以实现 UncaughtExceptionHandler 以了解线程是否由于异常而异常终止，在这种情况下，您的控制器的方法将不会被调用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T16:55:16.693

如果您在 java 1.5 上运行，您可能可以使用 java.lang.instrument 和 jvm 的 -javaagent 选项来完成。

在应该调用您的代码的线程对象上重新定义 run 方法。您似乎已经使用了仪器，因此它应该可用。因为它修改了运行时字节码，你应该没问题

也就是说，很难提供更具体和详细的​​答案，您的问题至少缺少 jvm 版本和使用的主要框架（想想 spring-aop、jboss-aop、jvm 版本等）

# d - D 编程语言 IRC 库

> ID：557300
> 
> 赞同：1
> 
> 时间：2009-02-17T15:18:28.733
> 
> 标签：d, irc

嘿，我正在寻找一个 D IRC 库。是的，我知道有[dirclib](http://www.dprogramming.com/dirclib.php)，但不幸的是，这个似乎与该语言的版本 1 或 2 不兼容（不再）。当我尝试将它与 Ubuntu 的 2.014 alpha 一起使用时，它会引发几个错误。

你有什么想法/建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T15:48:25.510

作为一般性陈述，D2 是最前沿的，因此库对它的支持很差。大多数库都与 D1 一起工作，并且可能有用于测试 D2 的版本。如果您想将 D 用于需要复杂基础设施（如库和工具）的东西，我现在会坚持使用 D1，因为语言规范已经相当稳定一段时间了。dirclib 显然是一个 D1 库，因为它可以与 Tango 一起使用，而 Tango 尚未移植到 D2。如果您可以尝试最新的 D1 编译器 (1.040) 并更具体地了解哪些不起作用，我也许可以提供更多建议。

此外，如果您要使用 D2，下载页面已经过时了。最新版本是 2.025，而不是 2.014，可以在[ftp://ftp.digitalmars.com/](ftp://ftp.digitalmars.com/)找到。

# php - 在循环中获取 PHP assoc 数组键

> ID：557306
> 
> 赞同：0
> 
> 时间：2009-02-17T15:19:40.527
> 
> 标签：php

我有以下代码：

```
while ($row = mysql_fetch_array($result, MYSQL_NUM)) 
    {
        for ($i=0; $i<count($row); $i++)
        {
            (DO THING HERE)
            $row[$i] = str_replace("\n", " ", $row[$i]);
            $row[$i] = str_replace("\r", " ", $row[$i]);
        }

    } 
```

我基本上想做，如果关联数组键等于“email”（所以 $row['email']）然后附加“@gmail.com”到它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T15:22:33.187

使用 foreach 循环并获取 assoc 数组的键和值。

```
foreach($row as $key => &$value)
{
    if($key == 'email') $value .= "@gmail.com";
} 
```

`mysql_fetch_array($result, MYSQL_ASSOC)`如果你想返回一个关联数组，你也应该使用。

附加到电子邮件密钥的更有效方法是：

```
if(isset($row['email']))
    $row['email'] .= '@gmail.com'; 
```

而不是遍历所有列。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T15:34:30.397

看看`MYSQL_NUM`你有没有？[这将使用列索引作为键（即 0、1、2 等）返回您的数据](http://www.php.net/manual/en/function.mysql-fetch-array.php)。

你必须要么

a）找出该`email`字段是哪个列索引并执行：

```
while ($row = mysql_fetch_array($result, MYSQL_NUM)) 
{
    // 'email' is in column number 5
    $row[5] .='@gmail.com';

    for ($i=0; $i<count($row); $i++)
    {
        $row[$i] = str_replace("\n", " ", $row[$i]);
        $row[$i] = str_replace("\r", " ", $row[$i]);
    }
} 
```

b) 或者您可以更改`MYSQL_NUM`为`MYSQL_ASSOC`，然后执行以下操作：

```
while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) 
{
    $row['email'] .='@gmail.com';

    foreach($row as &$value)
    {
        $value = str_replace("\n", " ", $value);
        $value = str_replace("\r", " ", $value);
    }
} 
```

请注意`"&"`前面`$value`的内容以使其成为参考。

我会做后者（我更`foreach`喜欢`for`:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T16:26:23.937

保罗几乎完全正确：

```
while ($row = mysql_fetch_assoc($result)) {
    foreach($row as $key => &$value) {
        if($key == 'email') $value .= '@gmail.com';
        $value = str_replace("\n", " ", $value);
        $value = str_replace("\r", " ", $value);
    }
} 
```

注意行中的“&” `foreach`。这意味着您正在修改`$row`数组中的值，而不仅仅是它的副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T15:21:35.497

我不确定这是否正是您想要的，但是：

```
$row['email'].='@gmail.com'; 
```

这会将@gmail.com 附加到电子邮件行。

# c++ - cpp 文件中是否需要 __declspec(dllexport)

> ID：557317
> 
> 赞同：13
> 
> 时间：2009-02-17T15:21:19.320
> 
> 标签：c++, windows, dll

可能是一个简单的问题，但我只有 Linux 可以在不需要 __declspec(dllexport) 的地方测试此代码。在当前代码中，__declspec(dllexport) 位于 .h 文件中的所有文件之前，但位于 cpp 文件中 50% 的函数之前，所以我想知道 cpp 文件中是否真的需要它们？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T15:23:06.040

不，它只需要在标题中。

这是包含更多信息的[链接。](https://web.archive.org/web/20120628222847/http://msdn.microsoft.com/en-us/library/a90k134d(VS.80).aspx)

扩展维奈所说的，我经常看到一个宏定义

```
#if defined(MODULENAME_IMPORT)
#define EXPORTED __declspec(dllimport)
#elif defined(MODULENAME_EXPORT)
#define EXPORTED __declspec(dllexport)
#endif 
```

然后在你的标题中你做

```
void EXPORTED foo(); 
```

在项目设置中为进行导入/导出的项目相应地设置定义。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T15:25:06.283

不，cpp 文件中不需要它。仅在声明中是必需的。

例如，如果我有一个 CMyClass 类。如果我想导出这个，那么 .h 会有

.h 服务器代码

__declspec(dllexport) CMyClass { };

在使用此类的客户端代码中，您必须将类声明为

客户端代码

__declspec(dllimport) CMyClass;

// 使用类的代码

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T15:28:44.433

当您有模板化代码并且在 .cpp 文件中实例化时，您也可以在 .cpp 文件中使用，然后您需要在实例化时导出定义。但即使在这种情况下，我也看到在 .h 中进行操作也有效。在 Windows 上，您可以使用 dumpbin.exe /exports *.dll 查看导出了哪些签名，Linux 中也有类似的实用程序。这将使您了解如何导出签名。

# c# - 如何编写返回实例集合的类方法

> ID：557323
> 
> 赞同：4
> 
> 时间：2009-02-17T15:22:05.387
> 
> 标签：c#, class, static-methods

我正在努力定义一个填充并返回实例集合的类方法。我不知道如何解决的问题是我有私有属性要填充。

让我们使用 Book 类的示例。我不希望代码直接设置（比如说）一本书的可用性。我希望代码必须在 Book 实例上使用 CheckOut 方法。所以我们有类似的东西：

```
public class Book
{
  private int ID;
  private bool pAvailableForCheckout;

  public string Title { get; set; }
  public bool AvailableForCheckout { get { return pAvailableForCheckout } }

  // instance methods

  public Book(int BookID)
  {
     // Load book from DB by ID
  }
  public CheckOut()
  {
     // perform everything involved with checking a book out
  }
  // .. other methods like saving a book, checking out books etc.

  // class method

  public static List<Book> FindAll()
  {
     // load Dataset of books
     // foreach record in DB, use the Book(int BookID) constructor and add to List
     // return list of books
  }
} 
```

所以，我可以在我的代码中使用它：

```
foreach(Book curBook in Book.FindAll())
  { /* do something with book */ } 
```

上述实现的问题是我必须对数据库使用 N+1 次命中来加载所有书籍，而不仅仅是 1 个查询。我该如何解决这个问题？

我确定这是编程 101，但我需要问一下。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:28:57.803

您可以创建一个受保护的构造函数，它直接填充私有属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T15:32:29.510

foreach 应该遍历已经实例化的对象列表，它们不需要连接到数据库。

您需要创建一个接受书对象属性的构造函数，以便您可以从现有数据集实例化一本书，而不是对数据库的新命中。

所以：

构造函数：

```
public book (String title, String avail) {Title=title...} 
```

并且在方法中

```
public static void FindAll()
{
List<Books> books = new List<books>();
using (Sqlconnection conn = new sqlconnection(connstring))
using (sqlcommand cmd = new SqlCommand("select title, available from book ", conn)
{
  SqlDatareader dr = cmd.executereader()
  while (dr.read())
  {
    books.add(new Book(dr["title"], dr["avail"])
  }

}

foreach(Book curBook in Book.FindAll())
  { /* do something with book */ }

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T20:54:31.717

举个意识形态纯洁性有些极端的例子：

首先，类的接口可以从给定 ID 的数据库中检索类型为 T 的对象：

```
interface IAdapter<T>
{
   T Retrieve(int id);
} 
```

现在，`Book`该类不再公开公共构造函数，而是使用静态方法`IAdapter<Book>`从数据库中检索书籍：

```
public class Book
{
    public static IAdapter<Book> Adapter { get; set; }

    public static Book Create(int id)
    {
       return Adapter.Retrieve(id);
    }

    // constructor is internal so that the Adapter can create Book objects
    internal Book() { }

    public int ID { get; internal set; }
    public string Title { get; internal set; }
    public bool AvailableForCheckout { get; internal set; }

} 
```

您必须编写`IAdapter<Book>`自己实现的类，并分配`Book.Adapter`给它的一个实例，以便`Book.Create()`能够从数据库中提取内容。

我说“意识形态纯洁性”是因为这种设计强制执行非常严格的关注点分离：`Book`类中没有任何东西知道如何与数据库对话——甚至不知道有*一个*数据库。

例如，这是一种可能的实现`IAdapter<Book>`：

```
public class DataTableBookAdapter : IAdapter<Book>
{
   public DataTable Table { get; set; }
   private List<Book> Books = new List<Book>();

   Book Retrieve(int id)
   {
      Book b = Books.Where(x => x.ID = id).FirstOrDefault();
      if (b != null)
      {
         return b;
      }

      BookRow r = Table.Find(id);
      b = new Book();

      b.ID = r.Field<int>("ID");
      b.Title = r.Field<string>("Title");
      b.AvailableForCheckout = r.Field<bool>("AvailableForCheckout");

      return b;
   }
} 
```

其他一些类负责创建和填充`DataTable`该类使用的。您可以编写一个不同的实现，使用 a`SqlConnection`直接与数据库对话。

你甚至可以这样写：

```
public IAdapter<Book> TestBookAdapter : IAdapter<Book>
{
   private List<Book> Books = new List<Book>();

   public TestBookAdapter()
   {
      Books.Add(new Book { ID=1, Title="Test data", AvailableForCheckout=false };
      Books.Add(new Book { ID=2, Title="Test data", AvailableForCheckout=true };
   }

   Book Retrieve(int id)
   {
      return Books.Where(x => x.ID == id);
   }
} 
```

这个实现根本不使用数据库——你会在为`Book`类编写单元测试时使用它。

请注意，这两个类都维护一个私有`List<Book>`属性。这保证了每次`Book.Create()`使用给定 ID 调用时，都会返回相同的`Book`实例。有一个论点是为了`Book`让它成为类的一个特性——你会在其中创建一个静态私有`List<Book>`属性`Book`并编写逻辑来使`Create`方法维护它。

您使用相同的方法将数据推回数据库 - add `Update`、`Delete`和`Insert`方法到`IAdapter<T>`并在您的适配器类中实现它们，并`Book`在适当的时间调用这些方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T15:27:58.603

为什么不使用 SQL where 语句在数据库端检查该书的可用性？

# php - 使用从 Linux 客户端到 MSSQL 的 ODBTP - 响应错误

> ID：557328
> 
> 赞同：1
> 
> 时间：2009-02-17T15:22:33.200
> 
> 标签：php, sql-server, adodb

我在 Windows 服务器上运行 MSSQL。我可以使用 ODBTP、ADODB 和 PHP 从其他 Windows 服务器连接到它。当我在 Linux 服务器上尝试相同的操作时，我收到响应错误： `[ODBTPERR][0]Invalid Response in /var/www/html/Database/adodb5/drivers/adodb-mssql.inc.php on line 726:[ODBTPERR][0]Invalid Response`
ODBTP (v1.1.4) 作为 Linux 服务器上的扩展启用，如果我使用 odbtp.conf 文件设置，我会收到正确的连接错误，所以它正在正确地拾取东西。我可以从 Linux 服务器远程登录到端口 2799 上的数据库服务器并返回 OBDTP 提示。任何人都可以建议任何步骤吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-01T07:43:34.207

我有类似的问题：PHP 警告：第 16 行 /var/projects/myproject/tmptest.php 中的 [ODBTPERR][0]Invalid Response

我还通过重新编译odbtp解决了它。以下是 odbtp 源目录 (odbtp-1.1.4) 中的 README.64bitOS 文件的详细说明

## 在 64 位操作系统上构建 ODBTP 客户端库

在 64 位操作系统上，如 Tru64 UNIX，C 固有数据类型“long”是 64 位。但是，ODBTP 客户端库假定“long”数据类型是 32 位。如果客户端库是使用“开箱即用”配置在 64 位系统上构建的，则客户端应用程序运行时将出现“无效响应”错误。为防止发生这些错误，必须在编译库之前定义 _C_LONG_64_。这是通过简单地取消注释文件 odbtp.h 中定义此符号的行来完成的

指示：

1.  在纯文本编辑器（例如 vi）中打开文件 odbtp.h。

2.  找到包含已“注释掉”的 _C_LONG_64_ 定义的行。

    /* #define _C_LONG_64_ 1 */

3.  通过删除 /* 和 */ 取消注释该行。

    #define _C_LONG_64_ 1

4.  退出编辑器，然后根据安装说明构建客户端库。

* * *

我不确定这个解决方案是否适用于静态 ODBTP 扩展......我已经使用动态扩展（[http://odbtp.sourceforge.net/install.html#phpshared](http://odbtp.sourceforge.net/install.html#phpshared)）实现了它

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T16:34:34.683

该问题是由于尝试使用未针对 64 位机器编译的 odbtp 库和 php 扩展而引起的。这条线索来自 Robert Twitty 在论坛上的帖子（不确定在哪里）。我们重新编译了启用 64 位的 libodbtp.so 和 odbtp.so。Dave Keen (dev@ruffness.com) 找到了解决方案。

# javascript - 原型 javascript 日历，可自定义呈现单元格，如 YUI 日历

> ID：557334
> 
> 赞同：1
> 
> 时间：2009-02-17T15:23:22.077
> 
> 标签：javascript, calendar, prototypejs

我已经广泛使用原型，不想添加额外的框架，如 YUI。

我需要一个 javascript 日历，它使我能够逐个单元格地自定义日历单元格的呈现。（用于呈现特定日期的事件、价格等）。

YUI Calendar 使这成为可能，但我已经广泛使用原型并且不想添加像 YUI 这样的额外框架。

有谁知道一个好的选择？

谢谢，英国人

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T16:54:03.090

这是一个：[CalendarView](http://calendarview.org/)和另一个[CalendarDateSelect](http://code.google.com/p/calendardateselect/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:27:05.030

你有没有想过从*Prototype*升级到**YUI**或**jQuery**？两者都会为您提供比原型更多的功能，并且都具有出色的日历选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T03:50:09.720

如果你有时间，你可以[建立自己的](http://jszen.blogspot.com/2007/03/how-to-build-simple-calendar-with.html). 我个人使用这个博客条目来创建我自己的，它工作得很好。代码没有使用 Prototype，但是当我浏览它时，我将整个东西转换成一个 Prototype 类，并使用 Prototype 的所有不错的特性来使代码看起来更好。最重要的是，您确切地知道标签类是什么，因此**您可以完全自定义它**（我个人更容易编写 CSS 代码而不是尝试逆向工程一个预先构建的，此外，等效的 jQuery对于您想要的东西，一个可能太多或太少）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T04:25:20.307

我以前用过[jscalendar](http://www.dynarch.com/projects/calendar/)，效果很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T23:12:56.977

据我所知，Prototype 是帮助函数的集合，但它没有小部件。YUI 是一个完全不同的野兽（在 DOM 方法中有一点重叠）。我们对 Ajax 调用使用 Prototype，对小部件（日历、对话框、网格）使用 YUI。

# c# - 如何从泛型类或方法的成员中获取 T 的类型

> ID：557340
> 
> 赞同：772
> 
> 时间：2009-02-17T15:24:36.940
> 
> 标签：c#, .net, generics

假设我在类或方法中有一个泛型成员，如下所示：

```
public class Foo<T>
{
    public List<T> Bar { get; set; }

    public void Baz()
    {
        // get type of T
    }   
} 
```

当我实例化类时，`T`变成`MyTypeObject1`，所以类有一个通用列表属性：`List<MyTypeObject1>`。这同样适用于非泛型类中的泛型方法：

```
public class Foo
{
    public void Bar<T>()
    {
        var baz = new List<T>();

        // get type of T
    }
} 
```

我想知道我的班级列表包含什么类型的对象。那么`T`调用的列表属性`Bar`或局部变量`baz`包含什么类型的呢？

我不能这样做`Bar[0].GetType()`，因为列表可能包含零个元素。我该怎么做？

* * *

## 回答 #1

> 赞同：815
> 
> 时间：2009-02-17T15:27:08.433

如果我理解正确，您的列表具有与容器类本身相同的类型参数。如果是这种情况，那么：

```
Type typeParameterType = typeof(T); 
```

如果您有幸拥有`object`作为类型参数，请参阅[Marc 的回答](https://stackoverflow.com/a/557349/3649914)。

* * *

## 回答 #2

> 赞同：556
> 
> 时间：2009-02-17T15:26:23.940

（注意：我假设您所知道的全部是`object`或`IList`类似的，并且该列表在运行时可以是任何类型）

如果你知道它是一个`List<T>`，那么：

```
Type type = abc.GetType().GetGenericArguments()[0]; 
```

另一种选择是查看索引器：

```
Type type = abc.GetType().GetProperty("Item").PropertyType; 
```

使用新的 TypeInfo：

```
using System.Reflection;
// ...
var type = abc.GetType().GetTypeInfo().GenericTypeArguments[0]; 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2012-09-23T10:05:30.287

使用以下扩展方法，您无需反思即可逃脱：

```
public static Type GetListType<T>(this List<T> _)
{
    return typeof(T);
} 
```

或更笼统地说：

```
public static Type GetEnumeratedType<T>(this IEnumerable<T> _)
{
    return typeof(T);
} 
```

用法：

```
List<string>        list    = new List<string> { "a", "b", "c" };
IEnumerable<string> strings = list;
IEnumerable<object> objects = list;

Type listType    = list.GetListType();           // string
Type stringsType = strings.GetEnumeratedType();  // string
Type objectsType = objects.GetEnumeratedType();  // BEWARE: object 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-02-17T15:26:41.583

尝试

```
list.GetType().GetGenericArguments() 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-05-18T10:01:22.440

以下对我有用。其中 myList 是某种未知类型的列表。

```
IEnumerable myEnum = myList as IEnumerable;
Type entryType = myEnum.AsQueryable().ElementType; 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-05-08T10:21:15.100

如果您不需要整个 Type 变量而只想检查类型，您可以轻松创建一个临时变量并使用`is`运算符。

```
T checkType = default(T);

if (checkType is MyClass)
{} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2017-01-05T11:45:58.067

您可以将此用于通用列表的返回类型：

```
public string ListType<T>(T value)
{
    var valueType = value.GetType().GenericTypeArguments[0].FullName;
    return valueType;
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-03-29T19:36:39.520

考虑一下：

我用它以同样的方式导出 20 个类型的列表：

```
private void Generate<T>()
{
    T item = (T)Activator.CreateInstance(typeof(T));

    ((T)item as DemomigrItemList).Initialize();

    Type type = ((T)item as DemomigrItemList).AsEnumerable().FirstOrDefault().GetType();
    if (type == null) 
        return;
    if (type != typeof(account)) // Account is listitem in List<account>
    {
        ((T)item as DemomigrItemList).CreateCSV(type);
    }
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2014-08-28T00:07:52.043

我使用这个扩展方法来完成类似的事情：

```
public static string GetFriendlyTypeName(this Type t)
{
    var typeName = t.Name.StripStartingWith("`");
    var genericArgs = t.GetGenericArguments();
    if (genericArgs.Length > 0)
    {
        typeName += "<";
        foreach (var genericArg in genericArgs)
        {
            typeName += genericArg.GetFriendlyTypeName() + ", ";
        }
        typeName = typeName.TrimEnd(',', ' ') + ">";
    }
    return typeName;
}

public static string StripStartingWith(this string s, string stripAfter)
{
    if (s == null)
    {
        return null;
    }
    var indexOf = s.IndexOf(stripAfter, StringComparison.Ordinal);
    if (indexOf > -1)
    {
        return s.Substring(0, indexOf);
    }
    return s;
} 
```

你像这样使用它：

```
[TestMethod]
public void GetFriendlyTypeName_ShouldHandleReallyComplexTypes()
{
    typeof(Dictionary<string, Dictionary<string, object>>).GetFriendlyTypeName()
        .ShouldEqual("Dictionary<String, Dictionary<String, Object>>");
} 
```

这不是您想要的，但它有助于展示所涉及的技术。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2010-07-29T14:26:04.577

该`GetGenericArgument()`方法必须在您的实例的基本类型上设置（其类是泛型类`myClass<T>`）。否则，它返回一个类型[0]。

例子：

```
Myclass<T> instance = new Myclass<T>();
Type[] listTypes = typeof(instance).BaseType.GetGenericArguments(); 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2014-04-16T15:31:43.940

您可以从任何实现 IEnumerable<T> 的集合类型中获取“T”的类型，具体如下：

```
public static Type GetCollectionItemType(Type collectionType)
{
    var types = collectionType.GetInterfaces()
        .Where(x => x.IsGenericType 
            && x.GetGenericTypeDefinition() == typeof(IEnumerable<>))
        .ToArray();
    // Only support collections that implement IEnumerable<T> once.
    return types.Length == 1 ? types[0].GetGenericArguments()[0] : null;
} 
```

请注意，它不支持实现 IEnumerable<T> 两次的集合类型，例如

```
public class WierdCustomType : IEnumerable<int>, IEnumerable<string> { ... } 
```

我想如果你需要支持这个，你可以返回一个类型的数组......

此外，如果您经常这样做（例如在循环中），您可能还希望缓存每个集合类型的结果。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-06-03T14:41:40.660

使用[3dGrabber 的解决方案](https://stackoverflow.com/questions/557340/how-to-get-the-type-of-t-from-a-member-of-a-generic-class-or-method/12551385#12551385)：

```
public static T GetEnumeratedType<T>(this IEnumerable<T> _)
{
    return default(T);
}

//and now

var list = new Dictionary<string, int>();
var stronglyTypedVar = list.GetEnumeratedType(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-05-05T18:23:26.730

```
public bool IsCollection<T>(T value){
  var valueType = value.GetType();
  return valueType.IsArray() || typeof(IEnumerable<object>).IsAssignableFrom(valueType) || typeof(IEnumerable<T>).IsAssignableFrom(valuetype);
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-10-13T11:38:09.123

如果你想知道一个属性的底层类型，试试这个：

```
propInfo.PropertyType.UnderlyingSystemType.GenericTypeArguments[0] 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2017-06-27T21:40:10.023

我是这样做的：

```
internal static Type GetElementType(this Type type)
{
    // Use type.GenericTypeArguments if it exists
    if (type.GenericTypeArguments.Any())
        return type.GenericTypeArguments.First();

    return type.GetRuntimeProperty("Item").PropertyType);
} 
```

然后像这样调用它：

```
var item = Activator.CreateInstance(iListType.GetElementType()); 
```

*或者*

```
var item = Activator.CreateInstance(Bar.GetType().GetElementType()); 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2022-01-01T22:12:41.217

试试这个。

if (typeof(T) == typeof(Person))

* * *

## 回答 #17

> 赞同：-9
> 
> 时间：2010-03-07T12:12:56.147

类型：

```
type = list.AsEnumerable().SingleOrDefault().GetType(); 
```

# usb - USB即插即用模拟

> ID：557342
> 
> 赞同：0
> 
> 时间：2009-02-17T15:24:49.203
> 
> 标签：usb, simulation

我想知道是否有一种方法可以仅通过软件模拟即插即用事件。我们正在测试驱动程序，我们想从 pnp 事件开始测试驱动程序的安装，但我们不想连接真正的打印机。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T15:51:01.400

并不真地。驱动程序（几乎按照定义）运行与硬件非常接近，以至于操作系统在伪造事物方面面临一些重大挑战。在性能很重要的真实操作系统上尤其如此。性能是效率的最佳论据，而这反过来又是反对抽象的一个很好的论据。

对于像打印机这样的“智能”设备，驱动程序很可能会发送一系列查询。比如，“你安装了什么固件？” 因为如果固件是 1.0，驱动程序可能必须应用一些变通方法。这是即插即用驱动程序设计中的公平游戏。再一次，这对于伪造来说并非易事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:32:26.533

我只是要把它扔出去，因为这是我脑海中第一个蹦出来的东西。

您可以让某人创建一个注册为打印机的 USB 加密狗吗？这样拔出/插入就不会不方便。

# c# - 如何在 WinCE 中加载表单之前显示消息？

> ID：557344
> 
> 赞同：1
> 
> 时间：2009-02-17T15:25:04.710
> 
> 标签：c#, windows-ce

在 Windows CE 中加载主窗体之前如何显示任何消息？（我在 WinCE 工作）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T15:34:14.343

在 program.cs 的 main 函数中，在创建主窗体之前，您可以使用 MessageBox.show 调用消息框，具体来说：（此示例来自 winforms 应用程序，因此 Application.EnableVisualStyles() 可能不适用，但它应该工作相同）

```
 static void main()
 {
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    MessageBox.Show("Here is your message");
    Application.Run(new MainForm());
 } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:31:23.727

执行此操作的标准方法是为表单的 Load 事件添加一个委托，并在该委托中执行[MessageBox.Show](http://msdn.microsoft.com/en-us/library/system.windows.forms.messagebox.show.aspx)。不过，我没有使用过 WinCE，所以我不知道它是否可以在那里工作。

# .net - 嵌套 jQuery 循环？

> ID：557359
> 
> 赞同：1
> 
> 时间：2009-02-17T15:28:02.113
> 
> 标签：.net, asp.net, jquery, cycle

我正在尝试使用 jQuery 循环插件构建幻灯片。

在幻灯片放映中有内容，在内容里面有基本的图片库。

图片库使用的周期超时小于内容超时。所以内容等待 15 秒，图片库将有 5 张图片，超时 3 秒，这使得 15 秒然后内容发生变化。

一切听起来都不错，但是当我执行页面时，它会循环显示内容和第一个图片库。但是当它跳转到第二个内容时，它不会循环图像库。

我试图`$('#cycleImages').cycle({...`将此代码块放在图像库中继器上方，但没有成功。

我怎样才能让这些嵌套循环一起工作？谢谢

```
<head runat="server">
<script type="text/javascript" src="/Js/jquery-1.2.6.js"></script>
<script src="/Js/jquery.cycle.all.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $('#cycleContent').cycle({
                fx: 'scrollRight',
                delay: -1000,
                timeout: 15000
            });
        });
        $('#cycleImages').cycle({
            fx: 'fade',
            speed: 500,
            timeout: 3000,
            pause: 1
        });                  
    </script>
</head> 
```

这是我的 html 标记

```
<div id="cycleContent">
            <asp:Repeater ID="rptContent" runat="server">
                <ItemTemplate>
                    <div>
                        <h2 class="slideShow-type">("Type.Name") %></h2>
                        <h2 class="slideShow-title">("Title") %></h2>
                            <div id="cycleImages">
                                <asp:Repeater ID="rptBigPictures" DataSource='<%#Eval("Images") %>' EnableViewState="false"
                                    runat="server">
                                    <ItemTemplate>
                                        <asp:Image ID="imgProfile" runat="server" ImageUrl='<%#Eval("Path") + ".jpg" %>' />
                                    </ItemTemplate>
                                </asp:Repeater>
                            </div>
                    </div>
                </ItemTemplate>
            </asp:Repeater>
        </div> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T16:58:00.587

如果我得到你的概念，这应该可行。要使它看起来正确，您需要做的一件事是具有固定的宽度和高度`cycleContent`with `overflow:hidden`。

**编辑**我更改了第二个 jquery 选择器以使用该类。所以标记不再有 cycleImages 作为 id。由于您将重复它，因此您应该使用一个类来选择元素。

```
jQuery(function($) {
    $('#cycleContent').cycle({
        fx: 'scrollRight',
        timeout: 15000
    });
    $('.cycleImages').cycle({
        fx: 'fade',
        speed: 500,
        timeout: 3000,
        pause: 1
    });
}); 
```

我使用的 CSS 就是这个，注意宽度和高度是我的测试图像的大小。

```
#cycleContent
{        
    width: 77px;
    height: 94px;
    overflow: hidden;
} 
```

还有标记，为了清楚起见。

```
<div id="cycleContent">
    <div>
        <div class="cycleImages">
            <img src="images/1.jpg" /><img src="images/2.jpg" /><img src="images/3.jpg" /><img
                src="images/4.jpg" /><img src="images/5.jpg" />
        </div>
    </div>
    <div>
        <div class="cycleImages">
            <img src="images/1.jpg" /><img src="images/2.jpg" /><img src="images/3.jpg" /><img
                src="images/4.jpg" /><img src="images/5.jpg" />
        </div>
    </div>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-16T04:23:21.413

那这个呢 ？（我不是舒尔，但是......）结束：function（）{...}应该正常工作

```
$(document).ready(function() {
    $('.cycleImages').cycle(); // <- class in here
    var slideshow = $('#cycleContent').cycle({ // <- ID in here
        fx: 'scrollRight',
        speed: 'fast',
        timeout: 0,
        before: function() {
            $(this).cycle({ // <- new call of the inner
                fx: 'fade',
                speed: 'fast',
                timeout: 3000,
                autostop: true,
                end: function(){ slideshow.cycle('next'); } // <- new call of the outer
            });
        }
    });
}); 
```

因此，您无需担心内部循环中的元素数量，3 或 5 或什么，不在乎。

问候，迈克尔

# .net - 如何控制在 DataGrid 中使用哪些验证器

> ID：557364
> 
> 赞同：0
> 
> 时间：2009-02-17T15:28:42.157
> 
> 标签：.net, asp.net, datagrid, .net-1.1, requiredfieldvalidator

我正在用 Asp.Net 1.1 开发一个网页，并有一个允许用户添加、编辑和删除数据库记录的 DataGrid。页脚行包含允许添加新记录的文本框。

对于每一列，我定义了 <ItemTemplate>、<EditItemTemplate> 和 <FooterItemTemplate> 元素。我的 aspx 标记中的 FooterItemTemplate 和 EditItemTemplate 元素都包含 RequiredFieldValidator 控件以及文本框。（见下文）

```
<asp:TemplateColumn HeaderText="Offer Code">
  <ItemTemplate>
    <%# DataBinder.Eval(Container, "DataItem.OfferCode") %>
  </ItemTemplate>
  <FooterTemplate>
    <asp:TextBox ID="txtNewOfferCode" Runat="server" />
<asp:RequiredFieldValidator ID="reqNewOfferCode" ControlToValidate="txtNewOfferCode" Display="None" ErrorMessage="Please specify 'Offer Code'" Runat="server" />
  </FooterTemplate>
  <EditItemTemplate>
<asp:TextBox id=txtOfferCode Runat="server" Text='<%# DataBinder.Eval(Container, "DataItem.OfferCode") %>' />
<asp:RequiredFieldValidator ID="reqOfferCode" ControlToValidate="txtOfferCode" Display="None" ErrorMessage="Please specify 'Offer Code'" Runat="server" />
  </EditItemTemplate>
</asp:TemplateColumn> 
```

我遇到的问题是，当您尝试编辑现有记录时，页脚行中的空白字段会阻止验证，因此会阻止回发和更新所选行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:34:05.030

通常，GridView 无法插入新行。你做到了，使用页脚行。当然，当您提交 GridView 时，验证器会阻止该过程，因为该字段为空。当您的 GridView 进入编辑模式并禁用页脚的验证器时，您应该捕获该事件。离开 GridView 编辑模式时不要忘记启用它们。

# internet-explorer - 从浏览器缓存中检索文件

> ID：557369
> 
> 赞同：0
> 
> 时间：2009-02-17T15:29:20.907
> 
> 标签：internet-explorer, firefox, caching

我不小心从我的 Web 服务器和我的开发机器上删除了一个 PDF 文件。我想检查浏览器的缓存，看看里面是否有它的副本。我在哪里看？我同时使用 Firefox 和 Internet Explorer，所以我想同时搜索它们的缓存。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:33:27.543

Nirsoft 为[Firefox](http://www.nirsoft.net/utils/mozilla_cache_viewer.html)和[Internet Explorer](http://www.nirsoft.net/utils/ie_cache_viewer.html)提供免费的缓存查看器。

顺便说一句，这是考虑为您的工作使用版本控制的好时机；-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T15:39:05.143

PDF 似乎不在网络浏览器缓存中。我认为您正在查看缓存，因为您使用网络浏览器中包含的 PDF 阅读器阅读 PDF。在 Linux 中，存在一个用于 acroread (Adobe) 的目录缓存。这对于 Windows 应该是相同的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:32:24.830

在 Firefox 中：导航到`about:cache`

# php - 如何检查真实姓名和姓氏 - PHP

> ID：557377
> 
> 赞同：0
> 
> 时间：2009-02-17T15:31:18.517
> 
> 标签：php, regex, utf-8

这是我的问题：我想检查用户是否插入了真实姓名和姓氏，方法是检查他们是否只有字母（任何字母）和 ' 或 - 在 PHP 中。我在这里找到了一个关于如何检查字符串是否只有字母的解决方案（但我不记得链接）：

```
preg_match('/^[\p{L} ]+$/u',$name) 
```

但我也想承认 ' 和 - 。（字符集是 UTF8）有人可以帮我吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T16:40:48.567

有点跑题了，但是验证名称到底有什么意义呢？

这不是为了防止欺诈；如果人们想给你一个假名字，他们可以很容易地输入一串随机字母。

这不是为了防止错误；键入标点符号只是您可能犯的众多错误之一，而且不太可能出现。

不是为了防止代码注入；您应该通过正确编码输出来防止这种情况发生，无论它们包含什么字符。

那么为什么我们都这样做呢？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T15:32:59.883

看起来你只需要修改正则表达式： [\p{L}' -]+

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T15:35:50.690

（国际）名称可以包含**许多**字符：空格、's、破折号、普通字母、变音符号、重音符号、...

**编辑**：重点是：如何确保所有字母（所有语言）、破折号、' 和空格都足够？是否没有包含点的名称（“Dr. No”呢？）、冒号或其他字符？

**EDIT2**：感谢可能来自瑞典的用户“some”（留下评论），我们现在知道有一个瑞典名字“Andreas J:son Friberg”。记住冒号！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T16:32:33.393

根据您要允许的字符集，您只需确保要支持的字符位于正则表达式的“[]”部分内。由于“-”字符在此上下文中具有特殊含义（它创建一个范围），因此它必须是列表中的最后一项。

\p{L} 表示匹配任何具有字母属性的字符。\w 具有相似的含义，但还包括您可能不想要的“_”字符。

```
preg_match('/^[A-Za-z \'-]+$/i',$name); 
```

将匹配最常见的名称，但如果您想支持外来字符集，您将需要更多外来的正则表达式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T15:51:25.427

这也应该这样做

```
/[\w'-]+/gi 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T19:36:49.940

如果 charset 是 UTF-8，那么您有一个问题 - 您如何检查中欧和东欧拉丁字符（变音符号）或西里尔文、中文或日文名称的名称？那将是一个地狱般的正则表达式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T14:24:08.597

请注意，您提供的示例并未检查以确保用户同时拥有姓氏和名字，尽管我认为应该是这样。你不应该假设一个人有多个名字。我目前正在开发一个在上下文中处理人名的 PHP 应用程序，如果我发现了什么，那就是你不能做出这样的假设 :) 甚至许多非名人也只有一个名字。

使用 \p{L} 中的 Unicode 类别是一个好主意，因为是的，显然人们的名字中会包含来自其他语言的各种字符。但是，除了 \p{L} 之外，您还必须考虑组合标记 - 即人们添加为额外字符的重音、变音符号等。

所以，也许在 \p{L} 之后我会立即添加 \p{Mc}

我最终会得到

```
preg_match('/^[\pL\p{Mc} \'-]+$/u', $name) 
```

# c# - FxCop - 在适当的地方使用属性

> ID：557381
> 
> 赞同：9
> 
> 时间：2009-02-17T15:31:52.430
> 
> 标签：c#, code-analysis, fxcop

我在服务层有几个方法接口，从 Get 和 FxCop 的**Use 属性开始，适当**的规则抱怨我应该考虑使用属性。

我尝试使用 SuppressMessageAttribute 但是当它在接口上定义时，它对成员方法没有影响。我是否需要将 SuppressMessageAttribute 放到每个方法中，还是有办法抑制整个类型的**CA1024**？

```
[SuppressMessage("Microsoft.Design", "CA1024:UsePropertiesWhereAppropriate"]
public interface IProjectService
{
    // Information and statistics about projects
    IList<ProjectInfo> GetProjects();
    ProjectsDashboard GetProjectsDashboard();

    // Project's settings
    ProjectSettings GetProjectSettings(Guid id);

    void SaveProjectSettings(ProjectSettings settings);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T15:33:55.547

您必须为每个方法添加属性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T15:44:55.567

我理解这里需要使用方法。虽然这些方法确实可能不会改变状态，但使用方法暗示了一个冗长/向外的操作，这可能是通过服务类方法的情况。

您不能将您的方法重命名为 LoadProjectSettings 吗？

否则，您确实必须将属性添加到每个方法，或禁用规则。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:35:39.003

不幸的是，您必须将其应用于每种方法。

另外，我在这里没有看到任何理由使用您的 Get 方法。为什么不只拥有只读属性，至少对于 ProjectsDashboard 和`IList<ProjectInfo>`. 那些不会让我印象深刻的实现会修改实现的状态，并且无论如何都应该是属性。

ProjectSettings 还应该返回一个看起来也是索引的集合。

# perl - 如何为具有不同数量参数的 DBI 更新编写子例程？

> ID：557382
> 
> 赞同：3
> 
> 时间：2009-02-17T15:32:01.883
> 
> 标签：perl, dbi

我正在为 DBI 更新编写一个子例程，并且在弄清楚如何添加占位符和东西时遇到了一些麻烦......

我有这个：

```
sub row_update {
  my $table = shift;
  my %updates = @_;
  my $placeholders = ...

  $dbh->do("UPDATE $table SET (foo) WHERE (bar)") etc...
} 
```

有任何想法吗？

我只想要一个简单的更新函数，我可以在其中发送 x 个参数（作为哈希）。

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T17:20:11.517

这样的事情可能足够好：

```
sub update {
    my ($dbh, $args) = @_;

    my $table   = $args->{table}   || die 'need table';
    my $updates = $args->{updates} || die 'need updates';

    my @cols = keys %$updates;

    my $query = 'UPDATE $table SET '.
      (join ', ', map { '$_ = ?' } @cols)
      ($args->{where} ? ' WHERE '. $args->{where} : '');

    my $sth = $dbh->prepare($query);

    $sth->execute(map { $updates->{$_} } @cols);

    return $sth;
} 
```

像这样使用它：

```
my $sth = update $dbh, {
    table   => 'foo',
    updates => {
        col1 => 'new_value',
        col2 => 'another_value',
    },
    where => 'id=42',
}; 
```

但实际上，您想研究使用像 [DBIx::Class](http://search.cpan.org/perldoc?DBIx::Class)这样的 ORM 。与这样的字符串操作相比，它在构建查询方面做得更好。

（重写要参数化的 where 子句作为练习留给读者。您还需要引用更新键和表名。了解人们为什么使用 ORM 吗？）

编辑：再考虑一下，您可能会喜欢[DBIx::Simple](http://search.cpan.org/perldoc?DBIx::Simple)与[SQL::Abstract](http://search.cpan.org/perldoc?SQL::Abstract)的结合。与 ORM 相比，这将花费更少的配置工作，但仍会给您带来许多好处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T21:53:22.683

如果我正确理解了这个问题，那么听起来您在[SQL::Abstract](http://search.cpan.org/perldoc?SQL::Abstract)之后。首先，我们创建一个`SQL::Abstract`对象：

```
use SQL::Abstract;
my $sql = SQL::Abstract->new; 
```

现在，作为示例，我们将使用它将一些数据插入到表中：

```
my %record = (
    FirstName  => 'Buffy',
    LastName   => 'Summers',
    Address    => '1630 Revello Drive',
    City       => 'Sunnydale',
    State      => 'California',
    Occupation => 'Student',
    Health     => 'Alive',
);

my ($stmt, @bind) = $sql->insert(’staff’,\%record); 
```

这导致：

```
$stmt = "INSERT INTO staff
                (FirstName, LastName, Address, City,
                 State, Occupation, Health)
                 VALUES (?, ?, ?, ?, ?, ?, ?)";

@bind = ('Buffy','Summers','1630 Revello Drive',
         'Sunnydale',’California','Student','Alive'); 
```

这样做的好处是我们可以将它直接传递给 DBI：

```
 $dbh->do($stmt, undef, @bind); 
```

当然，您希望更新记录，而不仅仅是插入它们。幸运的是，这也很容易：

```
my $table = 'People';

my %new_fields = (
    Occupation => 'Slayer',
    Health     => 'Dead',
);

my %where = (
    FirstName => 'Buffy',
    LastName  => 'Summers',
);

my ($stmt, @bind) = $sql->update($table, \%new_fields, \%where);

$dbh->do($stmt, undef, @bind); 
```

这会产生：

```
$stmt = 'UPDATE People SET Health = ?, Occupation = ? 
         WHERE ( FirstName = ? AND LastName = ? )';

@bind = ('Dead', 'Slayer', 'Buffy', 'Summers'); 
```

如果您想了解更多信息`SQL::Abstract`，我建议您查看其[CPAN 页面](http://search.cpan.org/perldoc?SQL::Abstract)。[Perl Training Australia](http://perltraining.com.au/)的*Database Programming with Perl*手册中还有一章，可从我们的[课程笔记页面](http://perltraining.com.au/notes.html)免费获得。

祝一切顺利，

*保罗*

免责声明：我是 Perl Training Australia 的常务董事，因此认为我们的课程笔记非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T00:10:39.593

其他人建议通常的“使用正确数量的'？'s”方法构建查询。

对于大多数这样的查询，DBI->quote 方法被遗忘了，但它可以使代码更简单，并且在大多数情况下它并不比“正确”占位符方法慢。

1) 使用 DBI->quote 而不是占位符来构建查询。例如对于一个简单的选择：

```
my $sql = "select foo from bar where baz in ("
           . join(",", map { DBI->quote($_) } @bazs)
           . ")";
my $data = $dbh->selectall_arrayref($sql); 
```

2）正如 jrockway 建议的那样 - 使用 ORM 为你做这种低级的事情。例如 DBIx::Class 或 Rose::DB::Object。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T23:15:53.797

该`NUM_OF_PARAMS`属性可能会有所帮助：

```
"NUM_OF_PARAMS"  (integer, read-only)
     The number of parameters (placeholders) in the prepared
     statement. 
```

因此，例如，我有一个脚本可以从使用此代码的命令行运行任意 SQL：

```
my $s = $h->prepare($_);

for my $i (1..$s->{NUM_OF_PARAMS}){
  my $param = shift @ARGV;
  $s->bind_param($i, $param);
  print LOG "Bind param $i using $param.\n"
    or die "can't append to $opt{log}: $!";
}

$s->execute(); 
```

我不能说我已经使用了建议的其他模块，所以他们可能会做得更好。

# jquery - 在jquery中改变高度只工作一次

> ID：557389
> 
> 赞同：0
> 
> 时间：2009-02-17T15:33:08.120
> 
> 标签：jquery, jquery-1.3

我有一组产品列表，每个列表下面都有一个链接，上面有一个点击事件，当点击它时，它会转到父类，在下面找到类“surf_prod1”并滑动切换它。其中一个函数检查所有具有“surf_prod”类的div并获取最大的innerHeight，该函数被传回并用作所有具有“surf_prod”类的div的高度。

这对第一次点击有效，但随后的点击无效，并且似乎只有初始高度有效，不确定这是否是由于某种形式的缓存？

希望有人可以提供帮助。

这是我的html：

```
<div class="surf_prod">
<img height="300" border="0" alt="7'2" - Egg" src="product_images/takayama_egg_7_2_egg_l0242_front.jpg"/><br/>
<span style="height: 35px;"><b id="review1615">7'2" - Egg</b></span><br/>
<div valign="top" class="surf_prod1">
    <p style="margin-bottom: 2px;"><b>N : </b>16 1/4</p>
    <p style="margin-bottom: 2px;"><b>M : </b>21 1/4</p>
    <p style="margin-bottom: 2px;"><b>T : </b>14 3/4</p>
    <p style="margin-bottom: 2px;"><b>Th : </b>2 3/8</p>
</div>
<span style="margin: 0px;"><b>FINS</b></span><br/>
<div class="surf_prod1">
    <p><b>Centre : </b>US 8" TAK 4.5</p>
    <p><b>Side : </b>FCS M5</p>
</div>
    <div class="review_box">
    <a class="review_link" href="#review1615"><b style="cursor: pointer; text-decoration: underline; color: rgb(204, 0, 0);" title="Click For Review">Board Review</b></a>
    <div style="text-align: left; display: none;" class="surf_prod1 review_body">If you're not quite ready to "rip and shred" on a short board, nor are you apt to "cruise" on a long board, then the Hawaiian Pro Designs Egg is the perfect solution. This model is an "eggy" looking shape that allows the rider to trim high on the wave in the middle of the board or race down the line on the tail, whichever the rider prefers. This board is also a perfect beginners board because of the overall forgiving shape that allows for a variety of mistakes without loss of speed or manoeuvrability.<br/><a href="http://www.surfcom.co.uk/app/content_prod/5/1615"><b>More</b></a></div>
</div>
</div> 
```

和我的 JavaScript：

```
function equalHeight(group) {
var tallest = 0;
group.each(function() {
    thisHeight = $(this).innerHeight(true);
    if(thisHeight > tallest) {
        tallest = thisHeight;
    }
  });
  return tallest;
}

$(document).ready(function(){
$(".review_body").slideUp("fast");

$(".review_link").click(function(ev){
    ev.preventDefault();

    var link = $(this).attr('href');

    //Get the review container to be able to manipulate the children of it
    $(this).parent(".review_box").find(".surf_prod1").slideToggle("fast", function(){

         var surf_prod_height = equalHeight($("div.surf_prod"));
        $("div.surf_prod").height(surf_prod_height);

        document.location = link;
    });

});

}); 
```

[这里](http://www.surfcom.co.uk/app/content_cat/4/64 "这里")的例子。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T13:42:44.883

一旦你设置了高度，它就不再依赖于内容，所以第二次，你得到所有 div 的相同高度——你第一次设置的高度。

在找到所需高度之前尝试将高度设置为“自动”：

```
$("div.surf_prod").height("auto");
var surf_prod_height = equalHeight($("div.surf_prod"));
$("div.surf_prod").height(surf_prod_height); 
```

# selenium - 属性错误：在 selenium-python 脚本上

> ID：557402
> 
> 赞同：1
> 
> 时间：2009-02-17T15:36:20.267
> 
> 标签：selenium

我正在使用 Selenium-python 脚本进行 Web 测试自动化。每当我使用 selenium 内置命令时，我都会在运行时收到属性错误。

例如：selenium.WindowFocus("preview_email") 抛出“AttributeError: class selenium has no attribute 'WindowFocus'”

我是测试自动化的新手。帮我解决这个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-09T08:01:12.620

您正在寻找的命令是`selenium.window_focus()`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T16:41:02.563

I have never used the Python client personally, but a quick glance at the selenium.py file reveals that there is a **window_focus** command which gives the currently "selected" window focus ("selected" in Selenium terms is the window that Selenium is currently executing commands against and not necessarially the window that has user focus).

Executing the **select_window** command with a window ID will set tell Selenium which window you want to execute commands against.

I have had some trouble w/ popups in general and the way the Selenium IDE and RC clients attempt to locate new windows and/or there parents. ***Good luck.***

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-08T05:52:09.757

我认为您想强制网络驱动程序转到另一个名为“preview_email”的窗口。

为此，您需要使用`selenium.switch_to_window("preview_email")`; 因为`selenium.window_focus()`只是将焦点放在当前选定的窗口上并且不接受任何参数。此外，您在 JAVA 模式下使用它（我的意思是`selenium.windowFocus()`）。

# unit-testing - 如果一个项目有 100% 的单元测试覆盖率，还需要集成测试吗？

> ID：557409
> 
> 赞同：8
> 
> 时间：2009-02-17T15:37:40.763
> 
> 标签：unit-testing

如果一个项目有 100% 的单元测试覆盖率，还需要集成测试吗？

我从未参与过具有 100% 单元测试覆盖率的项目，但我想知道您的项目是否获得了这个（或 90%），您是否仍然需要集成测试？（你需要更少吗？）

我问是因为集成测试似乎很烂。它们通常很慢、很脆弱（很容易损坏）、不透明（当损坏时，有人必须深入了解所有层以找出问题所在）并且导致我们的项目放慢速度......我开始认为拥有只有单元测试（可能还有一小部分冒烟测试）才是可行的方法。

从长远来看，集成测试（以我的经验）的成本似乎比他们节省的要多。

感谢您的考虑。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-17T17:05:58.303

# 定义

我认为在进行讨论之前定义你的术语很重要。

**单元测试**孤立地测试单个单元。对我来说，这是一堂课。单元测试将创建一个对象、调用一个方法并检查结果。它回答了“我的代码是否符合我的预期？”这个问题。

**集成测试**测试系统中两个组件的组合。它关注的是组件之间的关系，而不是组件本身。它回答了“这些组件是否按预期协同工作”的问题。

**系统测试**测试整个软件系统。它回答了“该软件是否按预期工作？”的问题。

**验收测试**是客户回答问题“我认为我想要这个软件吗？”的一种自动化方式。它是一种系统测试。

请注意，这些测试都没有回答“这个软件有用吗？”之类的问题。或“这个软件好用吗？”。

所有自动化测试都受到公理“**端到端比你想象的更远**”的限制——最终人类必须坐在电脑前查看你的用户界面。

# 比较

单元测试更快更容易编写，运行更快，更容易诊断。它们不依赖于文件系统或数据库等“外部”元素，因此它们更简单/更快/可靠。大多数单元测试在您重构时会继续工作（良好的单元测试是安全重构的唯一方法）。他们绝对要求你的代码是**解耦**的，这很难，除非你先写测试。这种因素的组合使得 TDD 的红/绿/重构序列运行良好。

系统测试很难编写，因为它们必须经过大量设置才能达到您想要测试的特定情况。它们很脆弱，因为之前软件行为的任何变化都会影响导致您想要测试的情况的顺序，即使该行为与测试无关。由于类似的原因，它们比单元测试慢得多。故障可能很难诊断，因为到达故障点可能需要很长时间，而且故障涉及的软件太多。在某些软件中，系统测试很难自动化。

集成测试介于两者之间：它们比系统测试更容易编写、运行和诊断，但比单元测试覆盖范围更广。

# 推荐

使用测试策略的组合来平衡每种策略的成本和价值。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-17T15:40:47.510

是的。

即使所有“单元”都做了他们应该做的事情，也不能保证整个系统按设计工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T15:40:32.567

是的，此外还有几种不同类型的代码覆盖率

[来自维基：](http://en.wikipedia.org/wiki/Code_coverage)

*   **功能覆盖**- 程序中的每个功能都执行了吗？
*   **语句覆盖率**——源代码的每一行都执行了吗？
*   **决策覆盖**（也称为分支覆盖） - 每个控制结构（如 if 语句）是否都评估为真假？
*   **条件覆盖**- 每个布尔子表达式是否都评估为真和假（这不一定意味着决策覆盖）？
*   **修正条件/决策覆盖 (MC/DC)** - 决策中的每个条件是否至少对所有可能的结果采取了一次？是否已证明每种情况都会独立影响该决策结果？
*   **路径覆盖**- 是否已执行通过代码给定部分的所有可能路径？
*   **进入/退出覆盖**- 是否执行了函数的所有可能调用和返回？

例如，路径覆盖，仅仅因为每个方法都被调用，并不意味着如果您按给定顺序调用各种方法就不会发生错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T15:48:02.813

首先，即使在单元测试级别，100% 的单元测试覆盖率也是不够的：你只覆盖了 100% 的代码指令。你的代码中的路径呢？那么输入或输出域呢？

其次，您不知道发送器单元的输出是否与其接收器单元的输入兼容。这就是集成测试的目的。

最后，单元测试可以在与生产环境不同的环境中执行。集成测试可能会发现差异。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T17:10:15.003

您只能使用测试/覆盖来证明错误的存在，但您永远无法使用测试/覆盖来证明代码没有错误。这一事实表明了测试/覆盖的边界。在数学中也是如此，你可以通过找到一个反例来反驳一个定理，但你永远不能通过没有找到一个反例来证明一个定理。因此，测试和覆盖只是正确性证明的替代品，这很难做到，几乎从未使用过。测试和覆盖可以提高代码的质量，但不能保证。它仍然是一门手艺，而不是一门科学。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-03-29T01:26:06.517

我还没有真正看到涵盖这些考虑因素的答案。现在，我是从整体系统的角度讲，不是形成软件开发的角度，而是... 集成基本上是将较低级别的产品组合成较高级别产品的过程。每个级别都有自己的一套要求来遵守。尽管某些要求可能相同，但不同级别的总体要求集会有所不同。这意味着不同级别的测试目标是不同的。此外，较高级别产品的环境往往与较低级别产品的环境不同（例如，软件模块测试可能发生在桌面环境中，而一个完整的可加载软件项目可能会在其硬件组件中加载时进行测试）。此外，

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T15:41:18.977

单元测试不同于集成测试。

只是为了说明一点：如果我必须选择，我会转储单元测试并进行集成测试。经验告诉我们，单元测试有助于确保功能并在开发周期的早期发现错误。

集成测试是在产品看起来接近最终用户的外观时完成的。这也很重要。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-17T15:42:25.603

单元测试通常都是关于孤立地测试你的类。它们的设计应确保在给定特定输入的情况下，您的班级表现出可预测和预期的行为。

集成测试通常都是关于将您的类相互组合并与使用这些类的“外部”程序一起测试。他们应该专注于确保当整个产品以正确的方式使用您的类时。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-17T15:54:11.377

“不透明（当被破坏时，有人必须深入所有层以找出问题所在）”——这正是进行集成测试的原因——否则这些不透明的问题会出现在生产环境中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-17T15:46:22.270

是的，因为您的软件的功能取决于它的不同部分如何交互。单元测试取决于您提供输入并定义预期输出。这样做并不能保证它可以与系统的其余部分一起使用。

是的，当您引入故意更改输出的代码更改时，集成测试是一件很痛苦的事情。使用我们的软件，我们通过将集成测试的保存结果与保存的正确结果进行比较来最小化这一点。

当我们确定我们正在产生正确的结果时，我们有一个可以使用的工具。它会加载旧保存的正确结果并修改它们以使用新设置。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-17T16:08:54.370

我经常看到良好的集成测试发现的各种问题 - 特别是如果您可以自动化一些集成测试。

单元测试很棒，但是您可以在单元测试中实现 100% 的代码覆盖率而不需要 100% 的相关性。你真的在尝试测试不同的东西，对吧？在单元测试中，您通常会寻找特定功能的边缘案例，而集成测试将在所有这些功能交互时向您展示更高级别的问题。

如果你在你的软件中构建一个 API，你可以将它用于自动化集成测试——过去我已经从中获得了很多经验。我不知道我会说我会转储单元测试以支持集成测试，但是当它们做得正确时，它们是一个非常强大的补充。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-17T17:09:03.040

[这个确切的问题](https://stackoverflow.com/questions/555807/what-type-of-errors-could-my-code-still-contain-even-if-i-have-100-code-coverage)基本上是一天前才问的。即使在 100% 的代码覆盖率下，您也可能会遇到许多错误，请参阅[此问题](https://stackoverflow.com/questions/555807/what-type-of-errors-could-my-code-still-contain-even-if-i-have-100-code-coverage)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-06-13T21:36:46.380

看起来这里没有提到它，但你永远不可能真正拥有 100% 的单元测试覆盖率（如果你有一个数据库）。当您为数据库连接和 CRUD 操作编写单元测试时，您刚刚创建了一个集成测试。原因是您的测试现在具有独立工作单元之外的依赖性。我从事过的项目，以及与我交谈过的开发人员，一直表示剩下的 10% 是 DAO 或服务层。最好的测试方法是使用集成测试和模拟（内存）数据库。我已经看到尝试模拟连接以对 DAO 进行单元测试，但我并没有真正理解这一点——您的 DAO 只是一种将原始数据从一种格式序列化为另一种格式的方法，您的经理或代表将决定如何操纵它。

# c - 如何用（可读的）UTF8 字符编写文件？

> ID：557414
> 
> 赞同：3
> 
> 时间：2009-02-17T15:39:00.417
> 
> 标签：c, utf-8, c++builder

我读了一个包含 utf8 字符的文件，如下所示：

```
FILE *FileIN,*FileOUT;
FileIN=fopen("filename","r");
char string[600];
WideChar C[600],S[100];
fgets(string,600,FileIN);
wcscpy(C,UTF8Decode(string).c_bstr()); // widechar copy 
```

它读起来很完美（运行程序时在编辑框中显示）：

```
Edit1->Text=C;

Result ===> "3021";"亜";"7";"ア アシア つ.ぐ T1 や つぎ つぐ" 
```

问题是当我想在文件上写这个时：

```
FileOUT=fopen("txt.txt","w");    
fwrite(Edit8->Text.c_str(),strlen(Edit8->Text.c_str()),1,FileOUT);

Result ===> "3021";"?";"7";"? ??? ?.? T1 ? ?? ??" 
```

问题是，我如何将结果（我可以在运行的程序中看到的那个）写入文件？

我在 CodeGear C++Builder 上使用 C 语言

**感谢 Christoph 和 nobugz 的帮助**解决了****

 **我改变了这条线

```
fwrite(Edit8->Text.c_str(),strlen(Edit8->Text.c_str()),1,FileOUT); 
```

到这个，它起作用了。谢谢

```
fwrite(UTF8Encode(Edit8->Text).c_str(),UTF8Encode(Edit8->Text).Length(),1,FileOUT); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T15:48:28.177

我不知道框架，但是如果你`UTF8Decode()`在阅读文件后使用，你不应该`UTF8Encode()`在写之前使用吗？

# sql - 优化使用 between 子句的 SQL

> ID：557425
> 
> 赞同：10
> 
> 时间：2009-02-17T15:41:25.090
> 
> 标签：sql, mysql, query-optimization

考虑以下 2 个表：

```
Table A:
id
event_time

Table B
id
start_time
end_time 
```

表 A 中的每条记录都映射到表 B 中的 1 条记录。这意味着表 B 没有重叠期间。表 A 中的许多记录可以映射到表 B 中的同一记录。

我需要一个返回所有 A.id、B.id 对的查询。就像是：

```
SELECT A.id, B.id 
FROM A, B 
WHERE A.event_time BETWEEN B.start_time AND B.end_time 
```

我正在使用 MySQL，但无法优化此查询。表 A 中有约 980 条记录，表 B 中有 130.000 条记录，这需要很长时间。我知道这必须执行 980 次查询，但是在一台强大的机器上花费超过 15 分钟是很奇怪的。有什么建议么？

PS 我无法更改数据库架构，但我可以添加索引。但是，时间字段上的索引（具有 1 个或 2 个字段）没有帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T16:14:13.250

您可能想尝试这样的事情

```
Select A.ID,
(SELECT B.ID FROM B
WHERE A.EventTime BETWEEN B.start_time AND B.end_time LIMIT 1) AS B_ID
FROM A 
```

如果您在 B 的 Start_Time、End_Time 字段上有一个索引，那么这应该工作得很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T16:49:52.460

我不确定这可以完全优化。我在 MySQL 5.1.30 上试过。`{B.start_time, B.end_time}`我还按照其他人的建议添加了一个索引。然后我得到了一份报告`EXPLAIN`，但我能得到的最好的是[范围访问方法](http://dev.mysql.com/doc/refman/5.1/en/range-access-multi-part.html)：

```
EXPLAIN SELECT A.id, B.id FROM A JOIN B 
ON A.event_time BETWEEN B.start_time AND B.end_time;

+----+-------------+-------+------+---------------+------+---------+------+------+------------------------------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                                          |
+----+-------------+-------+------+---------------+------+---------+------+------+------------------------------------------------+
|  1 | SIMPLE      | A     | ALL  | event_time    | NULL | NULL    | NULL |    8 |                                                | 
|  1 | SIMPLE      | B     | ALL  | start_time    | NULL | NULL    | NULL |   96 | Range checked for each record (index map: 0x4) | 
+----+-------------+-------+------+---------------+------+---------+------+------+------------------------------------------------+ 
```

请参阅最右侧的注释。优化器认为它*可能*能够使用索引，`{B.start_time, B.end_time}`但最终决定不使用该索引。您的结果可能会有所不同，因为您的数据分布更具代表性。

`A.event_time`如果与恒定范围进行比较，请与索引使用情况进行比较：

```
EXPLAIN SELECT A.id FROM A
WHERE A.event_time BETWEEN '2009-02-17 09:00' and '2009-02-17 10:00';

+----+-------------+-------+-------+---------------+------------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key        | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+------------+---------+------+------+-------------+
|  1 | SIMPLE      | A     | range | event_time    | event_time | 8       | NULL |    1 | Using where | 
+----+-------------+-------+-------+---------------+------------+---------+------+------+-------------+ 
```

并与@Luke 和@Kibbee 给出的依赖子查询形式进行比较，这似乎更有效地利用了索引：

```
EXPLAIN SELECT A.id AS id_from_a,
    (
        SELECT B.id
        FROM B
        WHERE A.id BETWEEN B.start_time AND B.end_time
        LIMIT 0, 1
    ) AS id_from_b
FROM A;

+----+--------------------+-------+-------+---------------+---------+---------+------+------+-------------+
| id | select_type        | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |
+----+--------------------+-------+-------+---------------+---------+---------+------+------+-------------+
|  1 | PRIMARY            | A     | index | NULL          | PRIMARY | 8       | NULL |    8 | Using index | 
|  2 | DEPENDENT SUBQUERY | B     | ALL   | start_time    | NULL    | NULL    | NULL |  384 | Using where | 
+----+--------------------+-------+-------+---------------+---------+---------+------+------+-------------+ 
```

奇怪的是，EXPLAIN 列出`possible_keys`为 NULL（即不能使用索引），但最终还是决定使用主键。可能是 MySQL 的 EXPLAIN 报告的一个特质吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T16:32:41.053

我通常不会推荐这样的查询，但是......

由于您已指定表 A 只有大约 980 行，并且每一行都映射到表 B 中的一行，所以您可以执行以下操作，它很可能比笛卡尔连接快很多：

```
SELECT A.id AS id_from_a,
    (
        SELECT B.id
        FROM B
        WHERE A.event_time BETWEEN B.start_time AND B.end_time
        LIMIT 0, 1
    ) AS id_from_b
FROM A 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-27T12:07:02.817

我对类似的问题进行了一些测试 - 根据 IP 地址（以数字形式给出）计算国家。这是我的数据和结果：

*   表 A（包含用户和 IP 地址）包含大约 20 条记录。
*   表 B（包含每个国家/地区的 IP 范围）包含大约 100000 条记录。

使用“between”的 JOIN 查询大约需要 10 秒；SELECT 查询中的 SELECT 使用“between”，大约需要 5.5 秒；使用空间索引的 SELECT 查询中的 SELECT 大约需要 6.3 秒。使用空间索引的 JOIN 查询耗时 0 秒！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T15:46:27.620

请注意，在运行此查询时，您实际上在应用条件之前在内存中创建了 980x130000 条记录。这样的 JOIN 不是很推荐，我可以理解为什么它会给你带来性能问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T15:55:21.453

如果您无法更改架构——特别是，如果您无法在 a.event_time 上添加索引，我认为在 SQL 级别上没有太大的改进空间。

我更倾向于用代码来做。

*   将所有 B 开始/结束/id 元组读入列表，按开始时间排序
*   读取所有 A 事件
*   对于每个 A 事件
*   *   找到最大的开始时间 <= 事件时间（二分查找就可以了）
*   *   如果事件时间 <= 结束时间，则将 A 添加到此 B 的事件列表中
*   *   否则这个B没有家

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T15:55:27.273

不更改架构是否意味着您不能添加索引？在 start_time 和 end_time 上尝试多列索引。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T15:45:00.230

尝试使用标准比较运算符（< 和 >）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T15:47:26.793

我看到您正在对两个表进行交叉连接。这不是很好，DBMS 将花费大量时间来执行该操作。交叉连接是 SQL 中最昂贵的操作。执行时间这么长的原因可能是这个。

照着做，就可以解决...

SELECT A.id, B.id FROM A, B WHERE A.id = B.id AND A.event_time BETWEEN B.start_time AND B.end_time

我希望这对你有帮助:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-17T15:56:29.343

B (start_time, end_time) 上是否有索引？如果不是，也许添加一个可能会加快 B 行与 A 行的匹配？

请注意，如果您无法更改架构，也许您也无法创建新索引？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-17T16:11:57.297

您必须加快执行此查询的唯一方法是使用索引。

注意放入一个索引 your`A.event_time`然后放入另一个索引`B.start_time`and `B.end_time`。

如果如您所说，这是将两个实体绑定在一起的唯一条件，我认为这是您可以采取的唯一解决方案。

费德

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-17T16:13:11.690

Daremon，这个答案是基于您的评论之一，您说表 A 中的每条记录都映射到表 B 中的一条记录，

你可以在你的模式中添加一个额外的表吗？如果是，您可以预先计算此查询的结果并将其存储在另一个表中。您还必须使这个预先计算的表与表 A 和 B 的更改保持同步

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-17T16:15:20.220

根据您的评论，A 中的每个条目都对应于 B 中的一个条目，最简单的解决方案是`AUTOINCREMENT`从 B 的 id 列中删除，然后将 B 的所有 id 替换为 A 中的 id。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-17T16:52:55.573

`MySQL`不允许您`INDEX ORDER BY WITH RANGE`在派生查询中使用。

这就是为什么您需要创建一个用户定义的函数。

请注意，如果您的范围确实重叠，则查询将只选择一个（最后开始）。

```
CREATE UNIQUE INDEX ux_b_start ON b (start_date);

CREATE FUNCTION `fn_get_last_b`(event_date TIMESTAMP) RETURNS int(11)
BEGIN
  DECLARE id INT;
  SELECT b.id
  INTO id
  FROM b
  FORCE INDEX (ux_b_start)
  WHERE b.start_time <= event_date
  ORDER BY
    b.start_time DESC
  LIMIT 1;
  RETURN id;
END;

SELECT COUNT(*) FROM a;

1000

SELECT COUNT(*) FROM b;

200000

SELECT *
FROM (
  SELECT fn_get_last_b(a.event_time) AS bid,
         a.*
  FROM a
) ao, b FORCE INDEX (PRIMARY)
WHERE b.id = ao.bid
  AND b.end_time >= ao.event_time

1000 rows fetched in 0,0143s (0,1279s) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-17T17:01:34.383

在 B.start_time 降序放置索引，然后使用此查询：

```
 SELECT A.id AS idA,
 (SELECT B.id FROM B WHERE A.event_time > B.start_time LIMIT 0, 1
 ORDER BY B.start_time DESC) AS idB
 FROM A 
```

由于 B 中的时间桶是不相交的，这将为您提供第一个匹配的时间桶，并且您摆脱了两者之间的时间，但仍然有子查询。也许在索引中包含 B.id 会给你一些额外的小的性能提升。（免责声明：不确定 MySQL 语法）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-17T17:05:23.283

我想不出你有一个包含 130.000 行时间间隔的表的原因。无论如何，这样的设计必须有充分的理由，如果是这样，你必须避免每次都尝试计算这样的连接。所以这是我的建议。我会在表 A (A.B_ID) 中添加对 B.id 的引用，并使用触发器来保持一致性。每当您添加新记录（插入触发器）或 even_time 列更改（更新触发器）时，您都将重新计算该时间对应的对 B 的引用。您的 select 语句将简化为一个 select * from A。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-17T21:48:01.060

就个人而言，如果您有一对多关系并且表 a 中的每条记录仅与表 b 中的一条记录相关，我会将表 b id 存储在表 a 中，然后进行常规连接以获取数据。你目前拥有的是一个糟糕的设计，永远不会真正有效。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-19T20:01:46.190

我的解决方案有两个警告：

1）您说您可以添加索引但不能更改架构，所以我不确定这是否适合您，因为您不能在 MySQL 中拥有基于函数的索引，您需要在 Table 上创建一个额外的列B. 2) 此解决方案的另一个警告是您必须为表 B 使用 MyISAM 引擎。如果您不能使用 MyISAM，那么此解决方案将不起作用，因为空间索引仅支持 MyISAM。

因此，假设上述两个对您来说不是问题，以下应该可以工作并为您提供良好的性能：

此解决方案利用 MySQL 对空间数据的支持（请参阅[此处的文档](http://dev.mysql.com/doc/refman/5.0/en/spatial-extensions.html)）。虽然可以将空间数据类型添加到各种存储引擎中，但为了获得所需的性能，空间 R-Tree 索引（请参阅[此处的文档）仅支持 MyISAM。](http://dev.mysql.com/doc/refman/5.0/en/creating-spatial-indexes.html)另一个限制是空间数据类型仅适用于数字数据，因此您不能将此技术用于基于字符串的范围查询。

我不会详细介绍空间类型如何工作以及空间索引如何有用的理论细节，但您应该查看[Jeremy Cole 的解释](http://jcole.us/blog/archives/2007/11/24/on-efficiently-geo-referencing-ips-with-maxmind-geoip-and-mysql-gis/)，了解如何使用空间数据类型和索引进行 GeoIP 查找。如果您需要原始性能并且可以放弃一些准确性，还请查看评论，因为它们提出了一些有用的观点和替代方案。

基本前提是我们可以使用 start/end 并使用它们中的两个创建四个不同的点，一个用于在 xy 网格上以 0,0 为中心的矩形的每个角，然后快速查找空间index 来确定我们关心的特定时间点是否在矩形内。如前所述，请参阅 Jeremy Cole 的解释，以更全面地了解其工作原理。

在您的特定情况下，我们将需要执行以下操作：

1) 将表更改为 MyISAM 表（请注意，除非您完全了解此类更改的后果，例如缺少与 MyISAM 关联的事务和表锁定行为，否则不应这样做）。

```
alter table B engine = MyISAM; 
```

2）接下来我们添加将保存空间数据的新列。我们将使用多边形数据类型，因为我们需要能够容纳一个完整的矩形。

```
alter table B add column time_poly polygon NOT NULL; 
```

3) 接下来，我们用数据填充新列（请记住，任何更新或插入表 B 的进程都需要进行修改，以确保它们也填充新列）。由于开始和结束范围是时间，我们需要使用 unix_timestamp 函数将它们转换为数字（有关其工作原理，请参阅[此处](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_unix-timestamp)的文档）。

```
update B set time_poly := LINESTRINGFROMWKB(LINESTRING(
    POINT(unix_timestamp(start_time), -1),
    POINT(unix_timestamp(end_time), -1),
    POINT(unix_timestamp(end_time), 1),
    POINT(unix_timestamp(start_time), 1),
    POINT(unix_timestamp(start_time), -1)
  )); 
```

4) 接下来我们将空间索引添加到表中（如前所述，这仅适用于 MyISAM 表，并且会产生错误“ERROR 1464 (HY000): The used table type doesn't support SPATIAL index”）。

```
alter table B add SPATIAL KEY `IXs_time_poly` (`time_poly`); 
```

5）接下来，您将需要使用以下选择，以便在查询数据时使用空间索引。

```
SELECT A.id, B.id 
FROM A inner join B force index (IXs_time_poly)
ON MBRCONTAINS(B.time_poly, POINTFROMWKB(POINT(unix_timestamp(A.event_time), 0))); 
```

强制索引可以 100% 确保 MySQL 将使用索引进行查找。如果一切顺利，在上述选择上运行解释应该显示类似于以下内容：

```
mysql> explain SELECT A.id, B.id
    -> FROM A inner join B force index (IXs_time_poly)
    -> on MBRCONTAINS(B.time_poly, POINTFROMWKB(POINT(unix_timestamp(A.event_time), 0)));
+----+-------------+-------+------+---------------+------+---------+------+---------+-------------------------------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows    | Extra                                           |
+----+-------------+-------+------+---------------+------+---------+------+---------+-------------------------------------------------+
|  1 | SIMPLE      | A     | ALL  | NULL          | NULL | NULL    | NULL |    1065 |                                                 | 
|  1 | SIMPLE      | B     | ALL  | IXs_time_poly | NULL | NULL    | NULL | 7969897 | Range checked for each record (index map: 0x10) | 
+----+-------------+-------+------+---------------+------+---------+------+---------+-------------------------------------------------+
2 rows in set (0.00 sec) 
```

请参阅 Jeremy Cole 的分析，了解与 between 子句相比此方法的性能优势的详细信息。

如果您有任何问题，请告诉我。

谢谢，

-蘸

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2009-02-17T15:45:25.127

像这样的东西？

```
SELECT A.id, B.id 
FROM A
JOIN B ON A.id =  B.id 
WHERE A.event_time BETWEEN B.start_time AND B.end_time 
```

# excel - 是否可以在 Excel 内显示 Google 地球地图？

> ID：557432
> 
> 赞同：6
> 
> 时间：2009-02-17T15:42:47.803
> 
> 标签：excel, google-maps

有什么方法可以使用 Excel 2007 可用的脚本在工作表中显示 Google 地球地图？

我已经使用 Excel 来存储数据，然后生成一个 KML 文件以加载到 Google 地球中，但现在他们希望看到一个漂亮的小单元格，其客户端地址直接映射到 Excel 中以美化演示文稿.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T16:10:54.443

微软确实有一个我过去使用过的 ActiveX 网络浏览器控件，正如 Panji 解释了[如何在 excel 中创建一个网络浏览器控件](http://www.eggheadcafe.com/community/aspnet/66/10077917/webbrowser-control.aspx)

Panji Tengkorak 如果您正在寻找的是按原样显示 html 表格而不需要稍后计算值，您可以使用 WebBrowser 控件，执行此操作以在工作表上添加 WebBrowser 控件：

1.  在 Excel 中，在设计视图中打开表单。
2.  右键单击菜单栏，然后​​单击控制工具箱。
3.  在工具箱中，单击更多控件工具。将出现一个菜单，列出系统中所有已注册的 ActiveX 控件。
4.  在 ActiveX 控件的菜单上，单击 Microsoft WebBrowser 控件。
5.  在工作表上，单击要放置控件的位置。
6.  将控件移动并调整到要显示的区域

然后将这行代码放在任何你想要的地方，它可以放在按钮上或你的工作簿事件上。在以下示例中，我使用按钮单击：

```
Sub Button3_Click()
    ThisWorkbook.ActiveSheet.WebBrowser1.Navigate2 "http://maps.google.com/maps?f=q&source=s_q&hl=en&geocode=&q=area+51&sll=37.0625,-95.677068&sspn=31.839416,60.732422&ie=UTF8&ll=37.237811,-115.807614&spn=0.015614,0.029655&t=h&z=15"
End Sub 
```

从电子表格中获取坐标到 url 中应该相对简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T15:52:01.867

谷歌地图将需要某种浏览器控件来呈现来自地图查询的标记。Excel中没有这样的控件。

但是，仍然应该可以处理来自 G 地图的结果并获取任何信息，例如纬度/经度等。

* * *

我错了，谷歌上的快速搜索带来了几个链接。这是一个： [http ://www.automateexcel.com/2005/07/28/google_maps_in_excel/](http://www.automateexcel.com/2005/07/28/google_maps_in_excel/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T17:43:07.717

Google 地球还有一个 ActiveX 控件（称为 GEPluginX 控件），您可以将其嵌入 Excel 工作表中，只要您安装了 Google 地球浏览器插件（这是独立于 Google 地球应用程序的单独安装）。

ActiveX 控件有一个 API，可用于将 3D 视图导航到不同的位置（我相信您可以加载 KML 文件并查看该文件中的地标）...

[谷歌地球插件](http://code.google.com/apis/earth/)

# asp.net - app_offline.htm 如何处理 IIS/asp.net 中的当前活动会话？

> ID：557451
> 
> 赞同：3
> 
> 时间：2009-02-17T15:45:42.180
> 
> 标签：asp.net, iis

我知道，如果我将页面**app___offline.htm**添加到网站根目录，它将作为站点关闭，并将 app___offline.htm 的内容显示给访问该站点的新用户。

但是站点上现有的活动会话会发生什么情况，这些会话是否也被重定向到 app___offline.htm 或者他们能否完成工作并顺利退出？

我计划更新正在运行 webbooking 应用程序的服务器，并希望在我开始更新前 40 分钟，它将为新用户关闭，但让已经开始预订的用户有机会完成它。

所以我想知道使用 app___offline.htm 是否可以是一个简单/快速的解决方案，如果不是，我将自己编写该行为。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T15:52:55.547

它关闭了应用程序域。因此现有会话丢失。

# html - 简单文本的 CSS 工具提示

> ID：557452
> 
> 赞同：1
> 
> 时间：2009-02-17T15:45:51.663
> 
> 标签：html, css, tooltip

我想在具有以下约束的网页中使用工具提示：

*   工具提示应该适用于简单的文本，而不仅仅是锚点。
*   我不想使用 javascript，只有 css。
*   我想让它至少在 Firefox 和 Internet Explorer 中工作。

一个有希望的候选者是 Eric Meyer 的[解决方案](http://meyerweb.com/eric/css/edge/popups/demo.html)，但它使用了锚点。Loadaveragezero 的[解决方案](http://loadaveragezero.com/vnav/labs/CSS/tooltips.php)对简单文本使用 span，但它在 Internet Explorer 中不起作用。

我正在寻找一个工作代码示例或具有上述参数的解决方案的链接。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T15:58:54.847

满足您所有要求的解决方案是不可能的。IE 的尊重`:hover`是有限的——Eric Meyer 的解决方案在 IE 中有效，因为它使用了锚点。如果你想让它在任何元素上工作并在 IE 中工作，你必须使用 JS。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T16:37:16.517

正如其他人所说，您的要求是不切实际的。在可能禁用 Javascript 的环境中，我通常会使用该`title`属性来获取简单的浏览器工具提示作为后备，然后通过 Javascript 读取标题属性启用更好看的工具提示（使用诸如 jQuery 之类的框架，或者根据我的个人喜好 Mootools） .

代码示例可能类似于（使用[Mootools](http://mootools.net/)和[Tips](http://mootools.net/more)插件）：

```
<script type="text/javascript">
window.addEvent('domready', function() {
    // Enable the most basic default tooltips
    var tooltips = new Tips('.tips');
}
</script>

<p>This is some example text in <abbr class="tips" title="Hypertext Markup Language">HTML</abbr> with some <a href="#" class="tips" title="Tooltips are useful tools">tooltips</a> applied to some of it.</p> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:59:35.047

恐怕它不能在你的限制范围内工作。Internet Explorer 6 和更早版本仅检测悬停在锚点上，因此您需要放弃使其工作的要求，或者：

*   只需要在 IE7 和更新版本中工作（在这种情况下 Loadaveragezero 的解决方案可以工作）
*   可以使用锚点（在这种情况下，Eric 的解决方案会起作用）
*   可以使用 Javascript（在这种情况下，有[很多](http://dean.edwards.name/IE7/) [方法](http://jquery.com)可以让鼠标悬停在 IE7 之前）

# design-patterns - 命名此模式

> ID：557459
> 
> 赞同：2
> 
> 时间：2009-02-17T15:47:32.487
> 
> 标签：design-patterns

经常看到也经常用，不知道有没有名字？

C#版本：

```
public class Register
{
    protected Register()
    {
        Register.registry.Add(this);
    }

    public static ReadOnlyCollection<Register> Instances
    {
      get { return new ReadOnlyCollection<Register>(registry); }
    }

    private static List<Register> registry = new List<Register>();
} 
```

*如果您无法解决，它会跟踪创建的实例:)*

编辑：这只是一个片段，人们不要对 GC 问题感到兴奋

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T15:50:58.703

内存泄漏？除非您提供一种从静态列表“注册表”中显式删除它们的方法，否则不会收集任何 Register 实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:00:38.383

它不是工厂模式，因为它不涉及使用单独的对象来创建实例。它更像是一个[惰性初始化模式](http://en.wikipedia.org/wiki/Lazy_initialization_pattern)。

当您需要控制类的所有实例时使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T16:30:58.950

它让我想起了[string interning](http://en.wikipedia.org/wiki/String_intern_pool)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T15:59:51.600

看起来您正在尝试跟踪对象的所有实例......为什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-17T22:29:39.643

[单例](http://en.wikipedia.org/wiki/Singleton_pattern)（集合的）。

不管它在这里使用的方式是一种模式还是一种反模式，但是：你是法官。你曾经以这种方式使用可继承对象吗？

# python - Django - 让中间件与视图/模板通信

> ID：557460
> 
> 赞同：7
> 
> 时间：2009-02-17T15:47:49.757
> 
> 标签：python, django

好吧，这可能是一个非常愚蠢的问题，但我是 Python/Django 的新手，所以我还不能真正理解它的范围概念。现在我正在编写一个[中间件](http://docs.djangoproject.com/en/dev/topics/http/middleware/#topics-http-middleware)类来处理一些东西，我想设置我的视图和模板可以访问的“全局”变量。这样做的“正确”方式是什么？我考虑过这样做：

## 中间件.py

```
from django.conf import settings

class BeforeFilter(object):
    def process_request(self, request):
        settings.my_var = 'Hello World'
        return None 
```

## 视图.py

```
from django.conf import settings
from django.http import HttpResponse

def myview(request):
    return HttpResponse(settings.my_var) 
```

虽然这可行，但我不确定它是“Django 方式”还是“Python 方式”。

所以，我的问题是：
1\. 这是正确的方法吗？
2.如果是正确的方式，从中间件添加可在实际模板中使用的变量的正确方式是什么？假设我想评估一些东西，我想`headername`在中间件中将一个变量设置为“我的站点名称”，并且我希望能够`{{ headername }}`在所有模板中执行此操作。按照我现在的方式进行操作，我必须`headername`在每个视图中添加上下文。反正有没有绕过这个？我正在考虑沿用 CakePHP `$this->set('headername','My Site Name');`
3 的思路。我使用中间件类作为 CakePHP 的等价物`beforeFilter`，它在调用每个视图（或 CakePHP 中的控制器）之前运行。这是这样做的正确方法吗？
4\. 完全不相关，但这是一个小问题，将变量的内容打印到浏览器 ala 的好方法是什么`print_r`？假设我想查看`request`传递到视图中的所有内容？是`pprint`答案吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-17T16:06:49.820

1.  这不是最好的方法。您可以在请求而不是设置上设置 my_var。设置是全局的，适用于整个站点。您不想为每个请求修改它。多个请求同时更新/读取变量可能存在并发问题。

2.  要访问模板中的 request.my_var，您可以执行**{{ request.my_var }}**。要访问模板中的请求变量，您必须将**django.core.context_processors.request**添加到您的**TEMPLATE_CONTEXT_PROCESSORS**设置中。

3.  是的。描述请求中间件的其他术语是请求预处理器/过滤器/拦截器。

此外，如果您想在模板中使用通用站点名称作为标头，您可能需要查看 Django Sites 应用程序，它提供了一个站点名称变量供您使用。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-17T16:06:36.590

这就是我们所做的。我们使用这样的上下文处理器......

```
def context_myApp_settings(request):
    """Insert some additional information into the template context
    from the settings.
    Specifically, the LOGOUT_URL, MEDIA_URL and BADGES settings.
    """
    from django.conf import settings
    additions = {
        'MEDIA_URL': settings.MEDIA_URL,
        'LOGOUT_URL': settings.LOGOUT_URL,
        'BADGES': settings.BADGES,
        'DJANGO_ROOT': request.META['SCRIPT_NAME'],
    }
    return additions 
```

这里是激活它的设置。

```
TEMPLATE_CONTEXT_PROCESSORS = (
    "django.core.context_processors.auth",
    "django.core.context_processors.debug",
    "django.core.context_processors.i18n",
    "django.core.context_processors.media",
    "django.core.context_processors.request",
    "myapp. context_myApp_settings",
    ) 
```

这在每个被渲染的模板的上下文中提供了“全局”信息。这是标准的 Django 解决方案。有关上下文处理器的更多信息，请参阅[http://docs.djangoproject.com/en/dev/ref/templates/api/#ref-templates-api](http://docs.djangoproject.com/en/dev/ref/templates/api/#ref-templates-api)。

* * *

“将变量的内容打印到浏览器 ala print_r 的好方法是什么？”

在视图中？您可以为`pprint.pformat`要呈现的模板提供字符串以进行调试。

在日志中？您必须使用 Python 的`logging`模块并将内容发送到单独的日志文件。对于所有 Django 实现，使用简单的 print 语句将内容写入日志并不能始终如一地工作（例如，mod_python 会丢失所有 stdout 和 stderr 内容。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T16:02:01.470

1）如果您修改“设置”，即使跨请求，这也确实是全局的。换句话说，如果您需要每个请求都有自己的值，那么并发请求就会相互影响。修改请求对象本身更安全，这是一些常见的 Django 中间件所做的（例如 django.contrib.auth.middleware.AuthenticationMiddleware 在请求对象上添加对“用户”的引用）

2）（编辑 2）见 #4，在每个模板中获取一组通用变量可能更适合自定义上下文处理器

3）我对 CakePHP 不熟悉，但是添加一个 process_request 中间件绝对是 Django 预处理每个请求的好方法。

4）查看[模板上下文处理器](http://docs.djangoproject.com/en/dev/ref/templates/api/?from=olddocs#id1)的文档。如果您使用 RequestContext，每个模板都会有一个名为“request”的上下文变量，您可以将其转储到您的模板中。您还可以使用调试上下文处理器并执行类似的操作，以便仅在 settings.DEBUG=True 时转储：

```
{% if debug %}
  <!-- {{ request.REQUEST }} -->
{% endif %} 
```

这适用于 GET 和 POST，但如果您只需要其中一个，您可以相应地进行修改。

**编辑**

另外，我只是仔细查看了您的views.py。不确定我是否完全理解您在响应中返回的变量。如果你真的有那个用例，你可能还想像这样设置 mimetype：

```
return HttpResponse (..., mimetype='text/plain') 
```

这只是为了明确说明您没有返回 HTML、XML 或其他结构化内容类型。

**编辑 2**

刚刚看到问题更新了一个新的子问题，重新编号的答案

# python - 当 pypi 关闭时，如何使用 easy_install 和 buildout？

> ID：557462
> 
> 赞同：14
> 
> 时间：2009-02-17T15:48:23.840
> 
> 标签：python, plone, easy-install, buildout

我正在使用[buildout](http://pypi.python.org/pypi/zc.buildout)自动下载和设置我的 Plone 安装的许多依赖项。buildout 或多或少使用 easy_install 来下载和安装一堆 Python 鸡蛋。这通常有效，但如果无法下载任何依赖项，或者我希望构建找到不适合 pypi 的内部包，则它不起作用。如何设置我自己的本地版本的 pypi 来自动镜像我需要的包？对于使用 pypi 作为元数据但不使用代码的软件包，它是否仍会依赖第三方服务器？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-17T17:22:44.910

以下是[有关如何设置自己的 PyPi 镜像的说明](http://www.zopyx.de/blog/creating-a-local-pypi-mirror)。这个项目的主页在[这里](http://www.openplans.org/projects/pypi-mirroring/project-home)。那里似乎也有越来越多的镜子。

有关如何设置自己的包索引的说明，请查看[此博客文章](http://plope.com/Members/chrism/distribution_links_considered_harmful)，其中最后解释了一种解决方案。然后你也可以在那里托管你自己的内部包。优点还在于版本是这样固定的。（有关在构建中直接固定版本的方法，请查看[这篇文章](http://maurits.vanrees.org/weblog/archive/2008/01/easily-creating-repeatable-buildouts)）。

如果 PyPI 上只有元数据并且存档存储在其他地方，您当然也可以将其复制到您的索引中。如果您只使用 PyPI 镜像，我假设您仍然需要访问这些服务器。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-07-20T16:36:12.737

您也可以使用镜子。把它放在“~/.pip/pip.conf”的“[global]”部分：

```
index-url = http://d.pypi.python.org/simple/ 
```

这是[此处](http://mail.python.org/pipermail/catalog-sig/2010-July/003132.html)宣布的最新功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-03T04:44:42.970

这个页面展示了如何使用@moraes 帖子中提到的备用镜像，但对于 easy_install、buildout 和 virtualenv 以及 pip：

[http://jacobian.org/writing/when-pypi-goes-down/](http://jacobian.org/writing/when-pypi-goes-down/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-11-30T21:36:37.467

在 zc.buildout 的情况下：使用其本地下载缓存功能。缓存主要有三样东西：

*   外部扩展，即[http://dist.plone.org/release/4.1.2/versions.cfg](http://dist.plone.org/release/4.1.2/versions.cfg)
*   来自一些 distserver 的鸡蛋，即 pypi
*   使用 zc.buildout 提供的下载基础设施从 zc.recipe.cmmi 或类似配方下载

对于所有这三个，我们需要调整全局配置并为扩展设置一个缓存文件夹，并为鸡蛋和其他下载设置一个缓存文件夹。

在您的主文件夹中创建一个`.buildout`文件夹。

在此文件夹中创建文件夹`extends-cache`和`downloads`

在`.buildout`创建文件 default.cfg 时：

```
[buildout]  
extends-cache = /home/USERNAME/.buildout/extends-cache 
download-cache = /home/USERNAME/.buildout/downloads 
```

所以你有了：

```
.buildout/
├── default.cfg
├── downloads
└── extends-cache 
```

就是这样。确保不要在您的特定构建中覆盖 default.cfg 中的这两个变量。在第一次成功运行 buildout 后，后续运行将在离线模式下运行`./bin/buildout -o`。

作为副作用，如果在离线模式下使用构建会更快，即当没有新下载但某些配置发生更改时

除此之外，运行自己的 pypi-mirror 是有意义的。作为另一个信息来源，您可能会对我前段时间写的关于这个主题的文章感兴趣：http: [//bluedynamics.com/articles/jens/setup-z3c.pypimirror](http://bluedynamics.com/articles/jens/setup-z3c.pypimirror)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-27T04:51:34.213

配置`index`，`buildout.cfg`例如

```
[buildout]
index = http://a.pypi.python.org/
find-links = 
```

更多镜像： http: [//www.pypi-mirrors.org/](http://www.pypi-mirrors.org/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-08T02:37:06.417

PyPI 自 2010 年年中以来就有镜像[http://pypi.python.org/mirrors](http://pypi.python.org/mirrors)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-08-03T19:36:04.983

对于您`virtualenv`通常需要通过一个`requirements.txt`（或可能单独）安装的软件包，您必须覆盖您的`pip.conf`文件，通常位于`~/.pip/pip.conf`

在您的`pip.conf`文件中：

```
[global]
index-url=https://pypi.python.org/simple/

[install]
trusted-host=pypi.python.org 
```

如果需要，您可以在此处提供您自己的自定义 pypi 版本的 url。

`virtualenv`如果您希望在通过创建时还使用另一个 pypi 服务器，则`easy_install`需要覆盖`pydistutils.cfg`通常位于的文件`~/pydistutils.cfg`

在`pydistutils.cfg`文件中：

```
[easy_install]
index-url=https://pypi.python.org/simple/ 
```

这将确保`venv`使用`pydistutils.cfg`. 在这里，我们告诉`easy_install`使用[https://pypi.python.org/simple/](https://pypi.python.org/simple/)来创建`venvs`.

# c++ - 如何创建一个自动启动的 C++ 程序

> ID：557466
> 
> 赞同：13
> 
> 时间：2009-02-17T15:50:12.557
> 
> 标签：c++, windows, autostart

我正在用 C++ 创建一个程序，我希望能够选择让用户让它在 Windows 中自动启动。所以当用户启动他的电脑时，windows 会自动启动这个程序。我已经阅读了有关修改注册表或将其放入启动文件夹的内容，但是最好的“干净”方法是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-17T15:51:54.050

启动文件夹足够干净。

使用户可以在需要时将其删除。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-17T16:04:30.137

有很多方法可以自动启动应用程序，但最简单、最常见和 IMO 最好的方法是：

1.  在自动启动文件夹中放置一个快捷方式
2.  将自动启动条目添加到注册表 (Software\Microsoft\Windows\CurrentVersion\Run)

两者的最终结果是相同的。我相信注册方式在登录过程中比启动方式更早执行，但我不确定。无论如何，它对大多数情况没有任何影响。我更喜欢注册表，但这是个人喜好。您可以在应用程序中以编程方式创建和删除注册表项或快捷方式。

使用这两个选项，您可以为所有用户（所有用户启动文件夹，或在注册表中的 HKLM 键下）或特定用户（用户启动文件夹或在 HKCR 键下）使用一种设置。

一般来说，最好使用 per user 选项，因为您可以确定在这些区域中具有写入权限；并且计算机上的每个用户都可以有自己的设置。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T15:57:18.000

根据您是执行全用户还是每用户安装，请将其放在所有用户的启动文件夹或每用户启动文件夹中。您在菜单中看到的 Startup 文件夹是两者的合并，但非管理员用户无法删除来自 All-user 部分的条目。

不过，您实际上不必为此做任何事情。用户可以自己将您的正常快捷方式复制到“启动”菜单。因此，*任何*程序都可以是自动启动程序。根本不需要是C++。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T20:06:18.557

您可以将其注册为 Windows 服务。您可以使用“Qt Solutions”轻松地将应用程序制作为 Windows 服务。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-11-20T06:25:21.840

使用此代码，您可以做到

```
procedure TForm1.Button1Click(Sender: TObject);
var
   Reg:TRegistry;
begin
   Reg := TRegistry.Create;
   try
      Reg.OpenKey('Software\Microsoft\Windows\CurrentVersion\Run',True);
      Reg.WriteString('Program name',ParamStr(0));
   finally
     Reg.Free;
   end;

end; 
```

或这个：

```
using Microsoft.Win32;
private void AddStartUpKey(string _name, string  _path) {
     RegistryKey key = Registry.LocalMachine.OpenSubKey(@"Software\Micros  oft\Windows\CurrentVersion\Run", true);
     key.SetValue(_name, _path);
}
private void RemoveStartUpKey(string _name) {
     RegistryKey key = Registry.LocalMachine.OpenSubKey(@"Software\Micros  oft\Windows\CurrentVersion\Run", true);
     key.DeleteValue(_name, false);
} 
```

# .net - 模型创建时的实体框架错误

> ID：557467
> 
> 赞同：2
> 
> 时间：2009-02-17T15:50:52.260
> 
> 标签：.net, asp.net, entity-framework

我是实体框架的新手。我正在尝试从我的数据库生成模型，但出现以下错误：

“_Content”已在此类中声明为“Private _Content As Integer”。不能将“OnContentChanging”声明为“Partial”，因为只有一种方法“OnContentChanging”可以标记为“Partial”。不能将“OnContentChanged”声明为“Partial”，因为只有一种方法“OnContentChanged”可以标记为“Partial”。

有谁知道这可能是什么原因？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T16:28:50.127

听起来好像是在复制属性……您是否可能在项目中的某个地方留下了一个废弃的模型？或者，您是否有两个非常相似的表，以至于转义规则可能使它们相同？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T23:25:30.717

问题是我的项目中有 2 个模型。我需要将其中一个模型的命名空间设置为其他东西，它工作正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T01:54:39.277

我有这个问题，但情况不同。我一直在试验 Linq to SQL 并生成了 Linq to SQL 类。然后我创建了 ADO .Net 数据模型。发现这两个模型虽然不同，但相似到足以与此错误发生冲突。

# c# - 填写表格并打印出文档

> ID：557480
> 
> 赞同：2
> 
> 时间：2009-02-17T15:52:32.083
> 
> 标签：c#, .net, pdf, ms-word

我有一个空白表格的word文档。我需要能够使用 .NET 以编程方式填写它，并打印出结果。

我拥有的表格是 Word 文档，但如果需要，我显然可以将其转换为 PDF。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T16:15:20.627

您有 Open XML 格式的 Word 文档还是旧的二进制格式？

在 Open XML 中，此任务可以像在包（ZIP 文件）内操作 XML 一样简单。

如果您有二进制 Word 文件，这可能会很棘手。您将需要使用 .NET Programmability Support for Office 和[Microsoft.Office.Interop.Word 命名空间](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.word(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T16:15:40.937

您是在客户端还是服务器端工作？

客户端：开始查看[Visual Studio Tools for Office](http://msdn.microsoft.com/en-us/library/d2tx7z6d.aspx)。

服务器端：这个很难。我的建议是*不要*在服务器环境中运行客户端办公库。我现在正在做这件事，如果你在这条船上，不要这样做。寻找客户端库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T16:20:18.960

正如 Josef 所说，如果是 OpenXML (Office 2007) 文档，您可以使用托管的 .net 类轻松更新文档，这基本上是修改一堆 xml 文件，压缩并重命名为 .docx 。如果 Office 2000 和 2003 需要，Visual Studio 工具 (VSTO) 应该可以帮助您。对于以前版本的 Office，您需要使用 Office 自动化 COM 类。

现在要更新 word 文档中的字段，您需要确定在哪里插入文本。因此，如果您有一些书签或标记来标识您想要插入文本的位置......您可以寻找该位置并插入文本。打印 word doc 应该很简单，因为 Word 内置了打印支持。应该像调用正确的方法一样简单。

# windbg - 将 WinDbg 添加到 .DMP 文件的“打开方式”菜单？

> ID：557484
> 
> 赞同：1
> 
> 时间：2009-02-17T15:53:00.570
> 
> 标签：windbg

目前，当我右键单击 .DMP（或 .MDMP）文件时，“打开方式”弹出窗口上有 Visual Studio 2005 和 2008。如何在不删除任何 Visual Studio 选项的情况下将 WinDbg 添加到此列表？

我使用了“选择程序”选项，这会将 WinDbg 添加到列表中。不幸的是，WinDbg 需要一些命令行选项来打开 .DMP 文件，而我在注册表中找不到这个条目，所以我没有什么可编辑的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T15:54:17.477

在 Windows XP 上，选择“选择程序...”并导航到`.exe`. 完成此操作后，它将在将来出现在列表中。

Vista 可能也是如此（我面前没有它）。

在我的系统上，`WinDbg.exe`位于`C:\Program Files\Debugging Tools for Windows`

* * *

**编辑**从[MSDN 上的这个页面](http://msdn.microsoft.com/en-us/library/cc266527.aspx)：

> **-IA[S]**
> 
> 将 WinDbg 与注册表中的文件扩展名 .dmp、.mdmp 和 .wew 相关联。尝试此操作后，将显示成功或失败消息。如果包含 S，则如果成功，则此过程静默执行；仅显示失败消息。建立此关联后，双击具有这些扩展名之一的文件将启动 WinDbg。
> 
> -IA 参数不得与任何其他参数一起使用。此命令实际上不会启动 WinDbg，尽管可能会出现一会儿 WinDbg 窗口。

因此，从命令行运行以将文件与 WinDbg`WinDbg -IA`关联。`.dmp`

* * *

**编辑 2**

[该站点](http://blogs.msdn.com/tess/archive/2005/12/05/associate-windbg-with-dmp-files.aspx)向您展示了一个不错的 .reg 文件，用于将新的“调试此转储”条目添加到您的上下文菜单中。这样，您肯定还会拥有原始的“使用 Visual Studio 打开”选项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T17:09:38.763

尝试添加（或修改）注册表项：

```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.dmp\OpenWithList 
```

它需要有'windbg.exe。程序在具有单个字母名称的值中指定，并且该字母`MRUList`也在该键下的值中列出（查看 regedit 中的其他类似键以获得想法）。

我没有尝试在程序中添加命令行选项（所以我不确定它的效果如何，或者它是否可以使用某种可替换的参数）。如果你不能让它接受你需要的命令行选项，那么编写一个调用`CreateProcess()`（或类似的）的简单包装程序应该可以解决问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-17T17:40:16.460

我有一个与 .dmp 扩展名关联的简单批处理文件。大致定义如下：

```
@echo 关闭
标题windbg -z %1
启动 d:\programs\windbg\windbg.exe -W my_fav_workspace -z %1

```

奇迹般有效。

当然，您不会在资源管理器中获得花哨的“打开方式...”菜单项，但双击它并不是一个缺点。

# c# - 如何调整网络搜索以过滤掉旧信息？

> ID：557485
> 
> 赞同：0
> 
> 时间：2009-02-17T15:53:08.167
> 
> 标签：c#, xna

我目前正在研究 XNA 和 C# 3.0 以及其他相关技术（Maya 2009），并且遇到了我在快速发展的技术方面一直存在的问题：我的网络搜索提供了很多过时的信息，而且浪费了很多我的时间。关于测试版、旧学校作业或废弃项目的文章。

在寻找教程、引擎或工具包时，我必须从谷歌打开大量标签，然后逐个查看它是否仍然处于活动状态，或者论坛帖子何时存在，或者其他什么。我目前生活在一个互联网非常慢的地区，一页又一页地打开却发现日期是 3-4 岁，这非常令人沮丧（也许我应该禁用图像，嗯）。

谷歌搜索新闻时，按日期过滤很简单。但是对于普通的网页，你能做什么呢？

我意识到 Stack Overflow 存在的一个重要原因是解决这个确切的问题，但这个网站似乎更倾向于回答现在需要解决的问题，而不是非常探索性的一般研究。

除了相关性之外，是否有网络搜索服务试图解决及时性问题？是否有一些我不知道的魔法条款可以输入谷歌？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T16:00:36.107

[谷歌高级搜索](http://www.google.com/advanced_search?as_qdr=d)有一个“日期：（页面最近的时间）”选项。

# web-services - 如何跟踪我的 Web 服务引发的 IIS 500 错误

> ID：557490
> 
> 赞同：6
> 
> 时间：2009-02-17T15:54:28.617
> 
> 标签：web-services, iis, error-code

我已经部署了一个新版本的 ASP.NET web 服务。当客户端调用此服务时，IIS 日志文件报告错误代码 500。我自己的（测试）可以使用该服务而不会出现任何错误。我在我的 ASP.NET Web 服务中启用了错误记录，但没有记录错误，这让我相信错误不是由我的代码引发的，而是堆栈中“较早”的某个地方。我还检查了 httperr1.log 文件，但那里没有任何相关内容。

问题，如何向 IIS 添加更多错误日志来调查错误？我无法访问客户端。

[更新] 我正在使用 IIS6。我检查了事件日志，没有发现任何东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T15:56:41.480

您使用的是哪个版本的 IIS？

在 IIS7 中，您拥有广泛的跟踪功能。

看看：[在 IIS 7.0 中使用跟踪对失败的请求进行故障排除](http://www.iis.net/learn/troubleshoot/using-failed-request-tracing/troubleshooting-failed-requests-using-tracing-in-iis)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T16:14:20.130

[如果您在 IIS6 上，Microsoft 的DebugDiag 2.0](http://www.microsoft.com/en-us/download/details.aspx?id=40336)绝对是您想要使用的工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T16:20:16.387

你的日志文件是什么格式的？IIS 格式通常包含来自特定请求的错误消息，而默认格式不包含。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-15T21:58:27.580

如果您从本地主机上的自动生成代理运行 webMethod，您可以在崩溃时看到堆栈跟踪转储。

# algorithm - 高度图生成算法？

> ID：557496
> 
> 赞同：17
> 
> 时间：2009-02-17T15:56:37.923
> 
> 标签：algorithm, gis, geospatial, arcgis, heatmap

我在互联网上四处寻找，找不到解决这个特定问题的完美算法：

我们的客户有一组点和重量数据以及每个点，如下图所示：

[加权点 http://chakrit.net/files/stackoverflow/so_heightmap_points.png](http://chakrit.net/files/stackoverflow/so_heightmap_points.png)

其中，我们有一个 GIS 程序，可以从这些点及其权重值生成“高度图”或一种地形数据，但由于我们有近一千个数据点并且这些数据会随着时间而变化，我们希望创建我们自己的工具来自动生成这些高度图。

到目前为止，我已经尝试计算每个像素从其到最近数据点的距离的`Sqrt((x1 - x2) ^ 2 + (y1 - y2) ^ 2)`权重，并将权重和距离因子应用于数据点的颜色以生成该特定像素的结果渐变颜色：

[高度图结果 http://chakrit.net/files/stackoverflow/so_heightmap_result.png](http://chakrit.net/files/stackoverflow/so_heightmap_result.png)

您可以看到某些数据点的配置仍然存在问题，并且当有很多数据点时，该算法有时会产生一个相当多边形的图像。理想的结果应该看起来更像一个省略号，而不是一个多边形。

这是来自维基百科关于梯度上升的文章的一个示例图像，它展示了我想要的结果：

[山 http://chakrit.net/files/stackoverflow/so_gradient_descent.png](http://chakrit.net/files/stackoverflow/so_gradient_descent.png)

梯度上升算法不是我感兴趣的。我感兴趣的东西；是首先计算该图片中的原始函数的算法，提供具有权重的数据点。

我没有上过任何拓扑数学课，但我可以做一些微积分。我想我可能遗漏了一些东西，并且对我应该在那个谷歌搜索框中输入什么感到迷茫。

我需要一些指示。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T16:14:52.950

您正在寻找的是表面插值。

有些产品可以做到这一点（这里有[一个](http://www.rockware.com/product/featuresLobby.php?id=193&category=431)）

然后可以以所需的分辨率询问生成的函数/样条/其他数学结构以提供高度图。

你的插值函数

```
Sqrt((x1 - x2) ^ 2 + (y1 - y2) ^ 2) 
```

类似于[反距离加权](http://www.ems-i.com/smshelp/Data_Module/Interpolation/Inverse_Distance_Weighted.htm) 方法，只是您应用了任意过滤器并丢弃了许多其他数据点。

这些技术中的大多数都依赖于合理数量的样本和支撑这些值的“类似地形”的行为。

我建议使用权重作为高度样本，并在第二个链接中尝试简单的 Shepard 方法（不要过滤任何像素开始），方法是在可以混合的插值点处获取样本点对整体高度值的贡献比例这些比率中的样本颜色也可以为点着色。使用强度（粗略地说是简单 RGB 空间中的灰度）来显示高度或像示例图像一样添加黑色轮廓线。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T16:17:20.293

这个问题并不像表面上看起来那么容易。您的问题是两个区域的边界两侧需要具有相同的高度，也就是说，给定像素的高度由多个最近邻确定。

如果我理解正确，您至少需要两种算法（和第三条行话）。

要正确执行此操作，您需要将平面分解为[Voronoi 镶嵌](http://en.wikipedia.org/wiki/Voronoi_diagram)。

您可能会想要使用[kd-tree](http://en.wikipedia.org/wiki/Kd-tree)来帮助您找到最近的邻居。而不是采用 O(n^2)，而是将其降低到 O(n log(n))（额外的好处是您的 Voronoi 区域生成阶段在开发中将足够快，可以在高度计算阶段工作）。

既然您有一个将每个点索引到其最近邻居 i 的二维地图，您需要遍历地图上的每个 x,y 点并计算其高度。

要对给定的点 x,y 执行此操作，首先获取其最近的邻居 i 并将其粘贴到列表中，然后收集 Voronoi 图上的所有连续区域。一个简单的方法是使用[洪水填充](http://en.wikipedia.org/wiki/Flood_fill)找到该区域中的所有点，然后查看边界并收集其他身份。

使用所有最近邻居的列表，您现在可以正确插值！（有关插值方案，请参见其他答案）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-21T20:42:36.053

您已询问有关不规则数据的二维插值算法的信息，这是一个相当复杂的领域。既然你说你有 ArcGIS，我**强烈建议**你在 ArcGIS 中使用其内置[功能进行](http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=What_is_geoprocessing%3F)[自动](http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?id=5292&pid=5287&topicname=Working_with_the_Spatial_Analyst_toolbox)插值以进行自动计算。我相信这比编写自己的插值算法**要容易得多。**我已经完成了 ArcGIS 的一些自动化操作，它相当简单。

 **如果你确实编写了自己的插值代码——我建议你不要——首先要选择合适的算法，因为有几个算法都有自己的优缺点。这是从优秀的插值工具[Surfer](http://www.goldensoftware.com/products/surfer/surfer.shtml)的帮助中摘录的一些建议（顺便说一句，它也可以很容易地自动化）。还有更多算法，这些只是我尝试过的。

*   **克里金法**是更灵活的方法之一，可用于对几乎任何类型的数据集进行网格化。对于大多数数据集，使用默认线性变差函数的克里金法非常有效。一般来说，我们最常推荐这种方法。克里金法是默认的网格化方法，因为它可以为大多数数据集生成良好的地图。对于较大的数据集，克里金法可能会相当慢。克里金法可以推断超出数据 Z 范围的网格值。
*   **逆距离加权**速度很快，但倾向于在数据点周围生成同心轮廓的“靶心”模式。幂的反距离不会外推超出数据范围的 Z 值。一个简单的逆距离加权算法很容易实现，但速度较慢。
*   **使用线性插值**进行三角剖分很快。当您使用小型数据集时，带有线性插值的三角剖分会在数据点之间生成不同的三角形面。使用线性插值进行三角剖分不会将 Z 值外推到数据范围之外。
*   **Shephard 方法**类似于 Inverse Distance to a Power，但不会产生“靶心”模式，尤其是在使用平滑因子时。**Shepard 方法**可以推断超出数据 Z 范围的值。

要实现算法：您可以尝试谷歌搜索，或点击其他一些答案中的链接。有一些包含插值的开源 GIS 包，所以如果你喜欢通过 C++ 挖坑，也许你可以从中提取算法。或者大卫沃森的[这本书](http://www.amazon.co.uk/Contouring-Analysis-Display-Computer-Geosciences/dp/0080402860/ref=sr_1_2?ie=UTF8&s=books&qid=1235248401&sr=1-2)显然被认为是经典之作，虽然它是一个棘手的阅读和示例代码是意大利面条基本！但是，据我所知，这是最好的。如果 Stack Overflow 上的其他人知道得更好，请纠正我，因为我也不敢相信。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T17:02:36.067

[克里金法](http://en.wikipedia.org/wiki/Kriging)是执行此操作的重量级方法之一，尤其是在 GIS 领域。它有几个很好的数学特性 - 缺点是它可能会很慢，具体取决于您的[变异函数](http://en.wikipedia.org/wiki/Variogram)。

如果你想要更简单的东西，有很多插值程序可以很好地处理这个问题。如果你能找到一份《[数值配方](http://www.nrbook.com/a/bookcpdf.php)》，第 3 章将专门解释许多插值的变体，并包含代码示例及其功能属性的描述。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T16:13:24.920

> 是首先计算该图片中的原始函数的算法，提供具有权重的数据点。

这是可能的。如果您从单点开始，您将始终以圆形结束，但如果您对数据点进行加权并考虑到这一点，您可以将圆形挤压成椭圆形，如图所示。

您最终使用多边形的原因是您在计算中使用了离散函数 - 首先找到最接近的颜色，然后确定颜色。

相反，您应该研究梯度算法，该算法根据将点包围在三角形中的三个数据点的距离和权重为点分配颜色。

### 梯度算法

这取决于您要显示的内容。一个简单的算法是：

对于每个像素：

*   找到形成围绕该像素的最小三角形的三个点
*   将此点设置为受权重和到每个数据点的距离影响的颜色（HSV 颜色系统）：

    `pixel.color = datapoint[1].weight * distance(pixel, datapoint[1]) * datapoint[1].color + datapoint[2].weight * distance(pixel, datapoint[2]) * datapoint[2].color + datapoint[3].weight * distance(pixel, datapoint[3]) * datapoint[3].color`

我在这里使用 +，但您需要确定适合您的应用程序的“平均”算法。

-亚当

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T16:46:57.680

表面插值似乎是一个困难的数学问题。另一种更便宜的方法是：

`For each pixel:`
`For each point:`
`pixel.addWeight(weight(point, pixel))`

`def addWeight(w):`
`totalweight += w`
`numberofweights += 1`
`weight = totalweight / numberofweights`

示例权重函数：

`def weight(point, pixel):`
`return point.weight * 1/(1 + sqrt((point.x - pixel.x)^2 + (point.y - pixel.y)^2))`

这是一种蛮力的方法，但它很简单。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-25T10:05:49.793

不久前，我在 Winamp AVS 中实现了类似的东西。它使用“metaballs”类型的方法计算每个数据点的平方反比距离（以避免速度的 sqrt），将其限制（例如到 1.0），并为 2D 网格上的每个点计算这些距离的总和。这将给出一个平滑变化的颜色/高度图。

如果您想查看代码，它位于我的[J10 AVS 包](http://aaq.cc/0)中的“Glowy”预设中。

编辑：只是看着它，我添加了一些其他爵士乐以使其看起来更漂亮，最重要的部分是：

```
d1=s/(sqr(px1-rx)+sqr(py1-ry));
d2=s/(sqr(px2-rx)+sqr(py2-ry));
d3=s/(sqr(px3-rx)+sqr(py3-ry));
d4=s/(sqr(px4-rx)+sqr(py4-ry));
d5=s/(sqr(px5-rx)+sqr(py5-ry));
d6=s/(sqr(px6-rx)+sqr(py6-ry));
d=d1+d2+d3+d4+d5+d6; 
```

这需要 6 点的总和。对红色、绿色和蓝色输出值所做的一切都是为了让它看起来更漂亮。6 分不算多，但请记住，当它是新机器时（它以 ~20fps 的速度运行），我试图在 400MHz 机器上的 320x200 网格上实时运行它。:)

用 red = d 替换 red =、green = 和 blue = ... 行；等等……看看我的意思。所有的美丽都消失了，你只剩下一个灰度图像，数据点周围有平滑变化的斑点。

另一个编辑：我忘了说“s”是所有点的共享权重，为每个点更改它会赋予每个点单独的权重，例如 d1 = 2/(...) 和 d2 = 1/(.. .) d1 的中心高度是 d2 的两倍。您可能还想用 d1 = 2/max(..., 1.0) 之类的东西来限制底部的表达式，以平滑点的顶部，这样它们就不会在中间的无穷大处达到峰值。:)

对不起答案的混乱......我认为发布代码示例就足够了，但在检查时我的代码令人困惑且难以阅读。:(

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-19T05:17:18.133

我知道这是一个相当古老的问题，但我在尝试解决类似问题时偶然发现了它。

[有一个名为Surfit](http://surfit.sourceforge.net/)的开源项目正是实现了这种类型的功能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T16:34:22.310

您正在寻找[Blender](http://www.blender.org/)称为“[元球](http://en.wikipedia.org/wiki/Metaballs)”的东西（[带有链接的维基百科文章](http://en.wikipedia.org/wiki/Metaballs)，[示例](http://sketchup.google.com/3dwarehouse/details?mid=5797b80f3712a569bfe3b054485e609b)）。这样想：

你的物体是从地面伸出的圆锥体。它们都是抛物线，重量表明它们从地面伸出多远。或者，使它们都具有相同的高度并相应地调整抛物线的“平面度”，因此较大的重量会使圆锥体非常宽，而较低的重量会使圆锥体锋利。甚至在一定程度上两者兼而有之。

我建议您实现它并查看它的外观。

接下来，您需要在结果上挂一块布或橡胶布。布料会拉伸一定量，通常会由于重力而下垂。锥体保持它。

只要你靠近一个圆锥的中心，Z坐标就是圆锥表面上的位置。当你离开锥体中心时，重力开始下降，其他锥体的影响增加。

# windows - 适用于 Mac 和 Windows 的原生 GUI 框架

> ID：557500
> 
> 赞同：4
> 
> 时间：2009-02-17T15:56:53.430
> 
> 标签：windows, user-interface, macos

我目前正在寻找一个在 Mac 和 Windows 下看起来和工作的 GUI 框架。此外，我不想使用 C++，而是使用 C#、Java、Ruby 或 Python。

多谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T17:48:10.543

查看[wxWidgets](http://www.wxwidgets.org/)或[QT](http://www.qtsoftware.com/products/)。

但是，请考虑到这些工具包只会为您提供大致的平台外观。通常，它在 Windows 上感觉“不错”，但在 Mac 上，它通常看起来和感觉更像是“移植”的 Windows 应用程序，而不是原生应用程序。作为 Mac 用户的要求很高，他们不太喜欢这样......而且，您通常仅限于系统的公共子集。

如果您想制作一个出色的应用程序，请考虑将您的代码分离为平台中立的业务层和特定于平台的 GUI 层，并使用该平台的本机工具在每个平台上实现 GUI。是的，这将是更多的工作，但取决于你的目标可能是值得的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T15:59:07.513

[wxPython](http://www.wxpython.org/)应该可以满足您的需求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T16:00:16.230

在 Java 中，您可以使用[SWT](http://en.wikipedia.org/wiki/Standard_Widget_Toolkit)，它是在不同操作系统上可用的原生小部件的包装器。

如果您在 Eclipse 中进行开发，那么还可以查看图形 GUI 构建器[Jigloo](http://www.cloudgarden.com/jigloo/index.html)，它可以生成 SWT 代码（并且能够处理对生成代码的手动更改）。它有一个非常好的分步[教程](http://www.cloudgarden1.com/swt_tutorial/index.html)，指导您完成创建第一个 SWT 窗口的简单过程。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T15:59:25.080

你看过使用[QT 框架](http://www.qtsoftware.com/products/)吗？它是一个跨平台工具包，适用于所有主要操作系统。主要代码是 C++，但它们具有可用于大多数流行语言的绑定，包括 C# 和 Ruby。我也很确定 Python

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T16:00:48.663

Java 和 Swing 怎么样？效果很好，并且有来自 Apple 的扩展来处理一些细节（Apple Menu 等）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-24T05:52:26.133

尝试使用 tkinter.ttk。一个很好的教程可以在
“ [**http://www.tkdocs.com/tutorial/firstexample.html**](http://www.tkdocs.com/tutorial/firstexample.html) ”找到

确保在教程右侧的下拉菜单中选择 python。 ![替代文字](https://i.stack.imgur.com/s1jjx.png)
如果您将教程设为单页（第二个菜单栏上的链接），您可以下载教程以供离线查看。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T16:03:57.313

看看[wxWidgets](http://www.wxwidgets.org/)或[Qt 框架](http://qt.nokia.com/)

# objective-c - Cocoa-touch 和 UIButtonContent

> ID：557519
> 
> 赞同：0
> 
> 时间：2009-02-17T16:00:42.597
> 
> 标签：objective-c, iphone, cocoa, cocoa-touch

好奇，一个 NSMutableArray 是如何变异成一种 UIButtonContent 的？我目前正在使用 NSMutableArray 类型的实例变量，该变量在收到以下错误时崩溃：

*** -[UIButtonContent count]：无法识别的选择器发送到实例 0x393ed0

甚至不知道 UIButtonContent，因此没有在任何地方明确使用该类型。不知道我的阵列如何成为一个。寻找关于我可能出错的地方的洞察力。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T16:07:59.083

不要将其视为“变异”，将其视为您的指针混淆并指向错误的对象。发生这种情况的一种方法是，如果您的可变数组被意外释放，并且 UIButtonContent 对象被放入内存中的旧位置。除非您手动更改指针，否则指针不会知道差异。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-13T18:21:42.457

当您发布用于填充表的 NSMutableArray 实例时，您可能会看到此异常。

如果你使用一个数组并在里面释放它，didSelectRowAtIndexPath，你会看到这个

> -[UIButtonContent count]：发送到实例的无法识别的选择器...

所以，就像 Marc 说的，检查你在哪里释放数组，尤其是表使用的数组。

# c++ - SWIG Lua 和传递数组

> ID：557523
> 
> 赞同：4
> 
> 时间：2009-02-17T16:01:54.307
> 
> 标签：c++, arrays, lua, swig

我目前有以下lua代码：

```
 g = engine.CGeometry()

    vertexes = {}

    vertexes[1] = 0
    vertexes[2] = 0
    vertexes[3] = 0

    vertexes[4] = 0
    vertexes[5] = -1
    vertexes[6] = 0

    vertexes[7] = -1
    vertexes[8] = 0
    vertexes[9] = 0

    print "adding vertexes"
    g:SetVertexes(vertexes) 
```

其中 g:SetVertexes() 在 C++ 中实现为：

```
void CGeometry::SetVertexes(double* vertexes){
    this->vertexes = vertexes;
} 
```

导致此错误：

```
adding vertexes
PANIC: unprotected error in call to Lua API (Error in SetVertexes (arg 2), expected 'double *' got 'table')
Press any key to continue . . . 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T16:26:05.717

试着写：

```
void CGeometry::SetVertexes(double vertexes[]); 
```

在接口定义中。从文档来看，SWIG 区分了指针和数组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-12-15T12:53:04.113

你可以像这里描述的那样使用 carrays.i 模块：[http ://www.swig.org/Doc1.3/Library.html](http://www.swig.org/Doc1.3/Library.html)

例如，您在 C++ 中有这样的功能：

```
void fun(double arr[]) { } 
```

然后在 .i 文件中加载模块：

```
%include "carrays.i"
%array_functions(double, doubleArray);
void fun(double arr[]); 
```

在 Lua 脚本中：

```
a = new_doubleArray(10)           # Create an array
doubleArray_setitem(a,0,5.0)      # Set value 5.0 on index 0
fun(a)                            # Pass to C
delete_doubleArray(a)             # Destroy array 
```

# c# - 大型 XML 文件，XmlDocument 不可行但需要能够搜索

> ID：557527
> 
> 赞同：3
> 
> 时间：2009-02-17T16:02:27.380
> 
> 标签：c#, xml, mobile, compact-framework, xmltextreader

我正在努力使用合理的逻辑循环来从 XML 文件中删除节点，该文件太大而无法与支持 .NET 类的 XPath 一起使用。

我试图用执行相同但使用 XmTextReader 的代码替换我拥有的单行代码（使用 XPath 查询字符串调用 SelectNodes）。

如先前使用的 XPath 查询所示（仅供参考），我必须往下走几个级别：

```
ConfigurationRelease/Profiles/Profile[Name='MyProfileName']/Screens/Screen[Id='MyScreenId']/Settings/Setting[Name='MySettingName'] 
```

我认为这会很烦人但很简单。但是，我似乎无法正确循环。

我需要获取一个节点，检查该节点下的一个节点以查看该值是否与目标字符串匹配，然后如果匹配则继续往下走，如果不匹配则跳过该分支。

事实上，我认为我的问题是，如果我对分支不感兴趣，我不知道如何忽略它。我不能让它走不相关的分支，因为元素名称不是唯一的（如 XPath 查询所示）。

我想我可以维护一些布尔值，例如当我点击 Profile 节点时设置为 true 的 bool expectingProfileName。但是，如果它不是我想要的特定配置文件节点，我就无法离开那个分支。

所以......希望这对某人有意义......我已经盯着这个问题看了几个小时，可能只是错过了一些明显的东西......

我想发布文件的一部分，但无法弄清楚结构大致如何：

```
ConfigRelease > Profiles > Profile > Name > Screens > Screen > Settings > Setting > Name 
```

我会知道 ProfileName、ScreenName 和 SettingName，并且我需要 Setting 节点。

我试图避免一次性读取整个文件，例如在应用程序启动时，因为其中一半的东西永远不会被使用。我也无法控制生成 xml 文件的内容，因此无法将其更改为生成多个较小的文件。

任何提示将不胜感激。

更新

我已经重新打开了这个。一张海报建议 XPathDocument 应该是完美的。不幸的是，我没有提到这是一个移动应用程序并且不支持 XPathDocument。

按照大多数标准，该文件并不大，这就是系统最初被编码为使用 XmlDocument 的原因。它目前是 4MB，显然大到足以让移动应用程序在加载到 XmlDocument 时崩溃。它可能现在就出现了，因为文件预计会变得更大。无论如何，我现在正在尝试 DataSet 建议，但仍然对其他想法持开放态度。

更新 2

我很怀疑，因为很多人都说他们不会期望这么大的文件会导致系统崩溃。进一步的实验表明，这是一次间歇性崩溃。昨天它每次都崩溃，但今天早上我重置设备后，我无法重现它。我现在正试图找出一套可靠的繁殖步骤。并决定处理我确信仍然存在的问题的最佳方法。我不能就这样离开它，因为如果应用程序无法访问该文件，它就没用了，而且我认为无法告诉我的用户，当我的应用程序运行时，他们无法在他们的设备上运行其他任何东西...... ……

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T16:12:39.603

看看`[XPathDocument](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathdocument.aspx)`。

XPathDocument 比 XmlDocument 更轻量，并且针对只读 XPath 查询进行了优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T22:44:27.083

好的，我对此很感兴趣，所以我一起破解了一些代码。它并不漂亮，仅真正支持这个用例，但我认为它可以完成您正在寻找的工作，并且可以作为一个不错的平台开始。我也没有对它进行过彻底的测试。最后，您需要修改代码以使其返回内容（请参阅名为 Output() 的方法）。

这是代码：

```
using System;

using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Xml;

namespace XPathInCE
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                if (args.Length != 2)
                {
                    ShowUsage();
                }
                else
                {
                    Extract(args[0], args[1]);
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine("{0} was thrown", ex.GetType());
                Console.WriteLine(ex.Message);
                Console.WriteLine(ex.StackTrace);
            }

            Console.WriteLine("Press ENTER to exit");
            Console.ReadLine();
        }

        private static void Extract(string filePath, string queryString)
        {
            if (!File.Exists(filePath))
            {
                Console.WriteLine("File not found! Path: {0}", filePath);
                return;
            }

            XmlReaderSettings settings = new XmlReaderSettings { IgnoreComments = true, IgnoreWhitespace = true };
            using (XmlReader reader = XmlReader.Create(filePath, settings))
            {
                XPathQuery query = new XPathQuery(queryString);
                query.Find(reader);
            }
        }

        static void ShowUsage()
        {
            Console.WriteLine("No file specified or incorrect number of parameters");
            Console.WriteLine("Args must be: Filename XPath");
            Console.WriteLine();
            Console.WriteLine("Sample usage:");
            Console.WriteLine("XPathInCE someXmlFile.xml ConfigurationRelease/Profiles/Profile[Name='MyProfileName']/Screens/Screen[Id='MyScreenId']/Settings/Setting[Name='MySettingName']");
        }

        class XPathQuery
        {
            private readonly LinkedList<ElementOfInterest> list = new LinkedList<ElementOfInterest>();
            private LinkedListNode<ElementOfInterest> currentNode;

            internal XPathQuery(string query)
            {
                Parse(query);
                currentNode = list.First;
            }

            internal void Find(XmlReader reader)
            {
                bool skip = false;
                while (true)
                {
                    if (skip)
                    {
                        reader.Skip();
                        skip = false;
                    }
                    else
                    {
                        if (!reader.Read())
                        {
                            break;
                        }
                    }
                    if (reader.NodeType == XmlNodeType.EndElement
                            && String.Compare(reader.Name, currentNode.Previous.Value.ElementName, StringComparison.CurrentCultureIgnoreCase) == 0)
                    {
                        currentNode = currentNode.Previous ?? currentNode;
                        continue;
                    }
                    if (reader.NodeType == XmlNodeType.Element)
                    {
                        string currentElementName = reader.Name;
                        Console.WriteLine("Considering element: {0}", reader.Name);

                        if (String.Compare(reader.Name, currentNode.Value.ElementName, StringComparison.CurrentCultureIgnoreCase) != 0)
                        {
                            // don't want
                            Console.WriteLine("Skipping");
                            skip = true;
                            continue;
                        }
                        if (!FindAttributes(reader))
                        {
                            // don't want
                            Console.WriteLine("Skipping");
                            skip = true;
                            continue;
                        }

                        // is there more?
                        if (currentNode.Next != null)
                        {
                            currentNode = currentNode.Next;
                            continue;
                        }

                        // we're at the end, this is a match! :D
                        Console.WriteLine("XPath match found!");
                        Output(reader, currentElementName);
                    }
                }
            }

            private bool FindAttributes(XmlReader reader)
            {
                foreach (AttributeOfInterest attributeOfInterest in currentNode.Value.Attributes)
                {
                    if (String.Compare(reader.GetAttribute(attributeOfInterest.Name), attributeOfInterest.Value,
                                       StringComparison.CurrentCultureIgnoreCase) != 0)
                    {
                        return false;
                    }
                }
                return true;
            }

            private static void Output(XmlReader reader, string name)
            {
                while (reader.Read())
                {
                    // break condition
                    if (reader.NodeType == XmlNodeType.EndElement
                        && String.Compare(reader.Name, name, StringComparison.CurrentCultureIgnoreCase) == 0)
                    {
                        return;
                    }

                    if (reader.NodeType == XmlNodeType.Element)
                    {
                        Console.WriteLine("Element {0}", reader.Name);
                        Console.WriteLine("Attributes");
                        for (int i = 0; i < reader.AttributeCount; i++)
                        {
                            reader.MoveToAttribute(i);
                            Console.WriteLine("Attribute: {0} Value: {1}", reader.Name, reader.Value);
                        }
                    }

                    if (reader.NodeType == XmlNodeType.Text)
                    {
                        Console.WriteLine("Element value: {0}", reader.Value);
                    }
                }
            }

            private void Parse(string query)
            {
                IList<string> elements = query.Split('/');
                foreach (string element in elements)
                {
                    ElementOfInterest interestingElement = null;
                    string elementName = element;
                    int attributeQueryStartIndex = element.IndexOf('[');
                    if (attributeQueryStartIndex != -1)
                    {
                        int attributeQueryEndIndex = element.IndexOf(']');
                        if (attributeQueryEndIndex == -1)
                        {
                            throw new ArgumentException(String.Format("Argument: {0} has a [ without a corresponding ]", query));
                        }
                        elementName = elementName.Substring(0, attributeQueryStartIndex);
                        string attributeQuery = element.Substring(attributeQueryStartIndex + 1,
                                    (attributeQueryEndIndex - attributeQueryStartIndex) - 2);
                        string[] keyValPair = attributeQuery.Split('=');
                        if (keyValPair.Length != 2)
                        {
                            throw new ArgumentException(String.Format("Argument: {0} has an attribute query that either has too many or insufficient = marks. We currently only support one", query));
                        }
                        interestingElement = new ElementOfInterest(elementName);
                        interestingElement.Add(new AttributeOfInterest(keyValPair[0].Trim().Replace("'", ""),
                            keyValPair[1].Trim().Replace("'", "")));
                    }
                    else
                    {
                        interestingElement = new ElementOfInterest(elementName);
                    }

                    list.AddLast(interestingElement);
                }
            }

            class ElementOfInterest
            {
                private readonly string elementName;
                private readonly List<AttributeOfInterest> attributes = new List<AttributeOfInterest>();

                public ElementOfInterest(string elementName)
                {
                    this.elementName = elementName;
                }

                public string ElementName
                {
                    get { return elementName; }
                }

                public List<AttributeOfInterest> Attributes
                {
                    get { return attributes; }
                }

                public void Add(AttributeOfInterest attribute)
                {
                    Attributes.Add(attribute);
                }
            }

            class AttributeOfInterest
            {
                private readonly string name;
                private readonly string value;

                public AttributeOfInterest(string name, string value)
                {
                    this.name = name;
                    this.value = value;
                }

                public string Value
                {
                    get { return value; }
                }

                public string Name
                {
                    get { return name; }
                }
            }
        }
    }
} 
```

这是我使用的测试输入：

```
<?xml version="1.0" encoding="utf-8" ?>
<ConfigurationRelease>
  <Profiles>
    <Profile Name ="MyProfileName">
      <Screens>
        <Screen Id="MyScreenId">
          <Settings>
            <Setting Name="MySettingName">
              <Paydirt>Good stuff</Paydirt>
            </Setting>
          </Settings>
        </Screen>
      </Screens>
    </Profile>
    <Profile Name ="SomeProfile">
      <Screens>
        <Screen Id="MyScreenId">
          <Settings>
            <Setting Name="Boring">
              <Paydirt>NOES you should not find this!!!</Paydirt>
            </Setting>
          </Settings>
        </Screen>
      </Screens>
    </Profile>
    <Profile Name ="SomeProfile">
      <Screens>
        <Screen Id="Boring">
          <Settings>
            <Setting Name="MySettingName">
              <Paydirt>NOES you should not find this!!!</Paydirt>
            </Setting>
          </Settings>
        </Screen>
      </Screens>
    </Profile>
    <Profile Name ="Boring">
      <Screens>
        <Screen Id="MyScreenId">
          <Settings>
            <Setting Name="MySettingName">
              <Paydirt>NOES you should not find this!!!</Paydirt>
            </Setting>
          </Settings>
        </Screen>
      </Screens>
    </Profile>
  </Profiles>
</ConfigurationRelease> 
```

这是我得到的输出。

```
C:\Sandbox\XPathInCE\XPathInCE\bin\Debug>XPathInCE MyXmlFile.xml ConfigurationRe
lease/Profiles/Profile[Name='MyProfileName']/Screens/Screen[Id='MyScreenId']/Set
tings/Setting[Name='MySettingName']
Considering element: ConfigurationRelease
Considering element: Profiles
Considering element: Profile
Considering element: Screens
Considering element: Screen
Considering element: Settings
Considering element: Setting
XPath match found!
Element Paydirt
Attributes
Element value: Good stuff
Considering element: Profile
Skipping
Considering element: Profile
Skipping
Considering element: Profile
Skipping
Press ENTER to exit 
```

我在桌面上运行它，但它是我生成的 CF 2.00 .exe，因此它应该可以在 CE 上正常工作。如您所见，当它不匹配时它会跳过，因此它不会遍历整个文件。

感谢任何人的反馈，特别是如果人们有使代码更简洁的指针。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T16:09:12.043

尝试将文件加载到数据集中：

```
DataSet ds = new Dataset();
ds.ReadXml("C:\MyXmlFile.xml") 
```

然后你可以使用 linq 来搜索它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-25T19:29:22.623

我添加了这个，因为问题现在已经死了，但所选的解决方案与迄今为止列出的任何内容都不匹配。

我们的技术架构师接管了这个问题，并决定我们一开始就不应该实现 Xml。这一决定部分是由于这个问题，但也由于一些对数据传输费用水平的抱怨。

他的结论是我们应该实现一种自定义文件格式（带有索引），优化了查询的大小和速度。

因此，在该工作获得批准并适当指定之前，该问题被搁置。

暂时结束。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T06:43:27.073

将其加载到数据集中是行不通的——这会占用更多的内存。

当遇到类似情况时，我使用了 XmlReader 并在加载时建立了一个内存索引。我提供了索引，然后当用户单击链接或激活搜索时，我再次使用 XmlReader 重新读取 XML 文档，并加载适当的子集。

这听起来很费力，我想在某些方面确实如此。它用 CPU 周期换取内存。但它有效，并且该应用程序响应速度足够快。数据大小只有2mb，不算大。但我得到了带有数据集的OOM。然后我去了 XmlSerializer 并且工作了一段时间，但我再次遇到了 OOM。所以我终于回到了这个自定义索引的事情上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T07:35:41.550

您可以实现一个基于 sax 的解析器 - 这样您在解析 XML 时只获取您感兴趣的分支。这将是最好的方法，因为它不会将整个 xml 作为文档加载。

理想情况下，您可以根据需要围绕您的需求设计自定义解析器 - 并一次完成所有内容的解析 - 例如，如果您可能对特定节点感兴趣，请稍后保存对它们的引用，以便稍后从那里开始而不是重新解析或遍历。

这里的缺点是它有点自定义编程。

好处是您只会阅读您感兴趣的内容并根据您的要求处理 xml 文档。您还可以在完成文档传递之前开始处理结果。这对于根据文档内容启动工作线程非常有用。示例：您可以将一个元素的全部内容作为另一个 XML 文档的根，然后单独加载它（使用 xpath 等）。您可以将内容复制到缓冲区中，然后将其交给工作人员进行处理等。

很久以前，我使用 libxml2 for C 来使用它，但也有 C# 绑定（以及许多其他语言）。

# monitoring - 是否有任何工具可以在一个地方监控 SNMP、JMX 和 TIBCO Hawk？

> ID：557531
> 
> 赞同：0
> 
> 时间：2009-02-17T16:03:41.777
> 
> 标签：monitoring, jmx, tibco

我们的运营部门对过多的监控工具感到不安，那么是否有任何工具可以在一个应用程序中同时处理 SNMP、JMX 和 TIBCO Hawk？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-01T08:42:56.597

如果我正确理解您的问题，您的系统管理员需要一个可以处理 Hawk、JMX 和 SNMP 的控制台。

Hawk 控制台可以做到这一点，因为 Hawk 代理可以桥接 JMX 和 SNMP（如果您使用额外的 Hawk SNMP 适配器）。

或者，如果您更喜欢不同的控制台，则有两种常用方法可以将 Hawk 警报发送到该控制台：

1.  使用 Hawk SNMP 适配器将 Hawk 警报转换为 SNMP 陷阱。该适配器是单独许可的。

2.  运行 Hawk 警报服务器（与 Hawk 捆绑），它将 Hawk 警报保存到日志文件，然后让您的控制台搜索日志文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-25T20:48:00.657

试着看看那些瑞士人的 Mirador 软件：

[http://www.centeractive.com/index.php?option=com_content&view=article&id=12&Itemid=7&lang=en](http://www.centeractive.com/index.php?option=com_content&view=article&id=12&Itemid=7&lang=en)

广泛的鹰派支持

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T09:56:22.883

SNMP 和 JMX 由产品管理引擎应用程序管理器监控。你可以试一试。关于 Tibco Hawk 我也在寻找一种工具。如果你找到了，请告诉我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-07T19:52:45.863

SL Corporation 的 RTView 产品怎么样？它处理 SNMP、JMX 和所有 TIBCO 产品

# javascript - JQuery 方法和 DOM 属性

> ID：557533
> 
> 赞同：12
> 
> 时间：2009-02-17T16:04:03.600
> 
> 标签：javascript, jquery, dom

我对何时可以使用 DOM 属性以及何时可以在 Jquery 对象上使用 Jquery 方法感到困惑。说，我使用选择器

```
var $elemSel = $('#myDiv').find('[id *= \'select\']') 
```

此时，$elemSel 是一个 jquery 对象，我理解它是 DOM 元素数组的包装器。我可以通过遍历 $elemSel 对象/数组来获得对 DOM 元素的引用（正确吗？）

我的问题： 1\. 有没有办法将此 $elemSel 转换为非 JQuery 常规 DOM 元素数组？2.我可以同时结合DOM属性和JQuery方法（像这样）

```
$elemSel.children('td').nodeName 
```

（nodeName 是 DOM 相关的，children 是 JQuery 相关的）

编辑：这有什么问题？

```
$elemSel.get(0).is(':checked') 
```

**编辑2：**

感谢您的回复。我现在明白我可以使用 get(0) 来获取 DOM 元素。附加问题：

1.  如何将 DOM 元素转换为 JQuery 对象？

2.  如果我将“this”分配给一个变量，那是新的 var DOM 还是 JQuery？如果是 JQuery，如何将其转换为 DOM 元素？（因为我不能使用 get(0)）

    var $elemTd = $(this);

3.  当我执行上述分配时，我看到一些代码示例不包含变量名称的 $ 符号。为什么？

4.  至于我最初的问题，我可以在一个 JQuery 对象上同时结合 DOM 属性和 JQuery 函数吗？

    $elemSel.children('td').nodeName

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-17T16:06:41.597

您需要 .get(0) 结果来获取 DOM-ready 对象。

```
var myBox = $("div#myBox");
alert(myBox.get(0).id); // "myBox" 
```

阅读Cody Lindley的“[剥离 jQuery Wrapper 并找到一个数组”](http://www.learningjquery.com/2008/12/peeling-away-the-jquery-wrapper)

* * *

**回复：编辑：** `.is()`不是原生 javascript 方法。当您运行时`.get(0)`，您不再使用 jQuery 对象，因此您不能期望从中运行 jQuery 方法。

如果要`.is()`在特定结果上运行，请使用[`:eq(index) selector`](http://docs.jquery.com/Selectors/eq#index)或[`.eq(index) method`](http://docs.jquery.com/Traversing/eq#index)：

```
$("div:eq(1)").is(":checked"); // gets second div
$("div").eq(1).is(":checked"); // gets second div 
```

* * *

**回复：编辑＃2**

> Bob，你真的应该创造新的问题，而不是在这里问得越来越多。

将 dom 元素转换为 jquery 对象是通过将其传递给选择器来完成的：

```
var myBox = document.createElement("div");
var myBoxJQ = $(myBox); 
```

赋值`This`给一个变量。取决于你什么时候做。如果通过“this”你指的是一个 jQuery 对象，那么`this`将是一个 jQuery 对象。`this`您可以通过跟随来转换它`.get(0)`。

当`this`引用 jQuery 对象时，您不需要将其包装在 $() 中。这是多余的。

最后，`$elemSel.children('td').nodeName`可以这样做：`$elemSel.children('td')[0].nodeName`或 `$elemSel.children('td').get(0).nodeName`，其中 0 是要访问的项目的索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:13:05.140

get(index) 函数还有一个快捷方式：

```
$(selector)[0].nodeName 
```

来源：http : [//docs.jquery.com/Core/get#index](http://docs.jquery.com/Core/get#index)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T16:09:55.053

因为在 jQuery 选择器中可能有多个匹配项，所以您需要将元素从“数组”中取出。

您可以使用[get](http://docs.jquery.com/Core/get)方法返回单个 DOM 元素或数组或 DOM 元素。

例如：

```
var elims = $("div").get();
for(var i in elims)
    alert(elims[i].nodeName); 
```

**编辑：**

`$elemSel.get(0).is(':checked')`将不起作用，因为您正在获取 Dom 对象，然后尝试在其上使用 jQuery 函数。如果您想获得单个 jQuery 元素，请使用[eq](http://docs.jquery.com/Core/eq#position)。

```
$elemSel.eq(0).is(':checked'); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-14T14:38:15.497

为了调用本机 DOM 方法，您可以使用 get(index)。或者如果你想使用 jQuery Object 方法，你应该用 jQuery 包装一个原生 DOM 元素，它会将 DOM 元素转换为 jQuery Object，所以所有方法都可用。 [http://www.linxinshan.com/?p=339](http://www.linxinshan.com/?p=339)

# postgresql - 你如何在postgresql中做mysqldump？

> ID：557548
> 
> 赞同：26
> 
> 时间：2009-02-17T16:08:53.153
> 
> 标签：postgresql

以及如何从我的转储恢复到数据库？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-17T16:11:00.573

你应该看看 pg_restore 和 pg_dump 命令。

```
pg_dump - extract a PostgreSQL database into a script file or other archive file.

pg_restore - restore a PostgreSQL database from an archive file created by pg_dump. 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T16:12:24.547

请看[`pg_dump(1)`](http://linux.die.net/man/1/pg_dump)和[`pg_restore(1)`](http://linux.die.net/man/1/pg_restore)。

# c++ - C++ 绑定方法队列（任务管理器/调度器？）

> ID：557553
> 
> 赞同：2
> 
> 时间：2009-02-17T16:10:25.457
> 
> 标签：c++, queue, task

是否有方法/模式/库可以做类似的事情（在伪代码中）：

```
task_queue.push_back(ObjectType object1, method1);
task_queue.push_back(OtherObjectType object2, method2); 
```

这样我就可以做类似的*事情*：

```
for(int i=0; i<task_queue.size(); i++) {
    task_queue[i].object -> method();
} 
```

这样它就会调用：

```
obj1.method1();
obj2.method2(); 
```

或者这是一个不可能的梦想？

如果有一种方法可以添加许多参数来调用 - 那将是最好的。

**Doug T. 请看这个**优秀的答案！

**Dave Van den Eynde**的版本也很好用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T16:12:51.647

是的，你会想要结合[boost::bind](http://www.boost.org/doc/libs/1_38_0/libs/bind/bind.html)和[boost::functions](http://www.boost.org/doc/libs/1_38_0/doc/html/function.html)它非常强大的东西。

**这个版本现在可以编译了，感谢 Slava！**

```
#include <boost/function.hpp>
#include <boost/bind.hpp>
#include <iostream>
#include <vector>

class CClass1
{
public:
    void AMethod(int i, float f) { std::cout << "CClass1::AMethod(" << i <<");\n"; }
};

class CClass2
{
public:
    void AnotherMethod(int i) { std::cout << "CClass2::AnotherMethod(" << i <<");\n"; }
};

int main() {
    boost::function< void (int) > method1, method2;
    CClass1 class1instance;
    CClass2 class2instance;
    method1 = boost::bind(&CClass1::AMethod, class1instance, _1, 6.0) ;
    method2 = boost::bind(&CClass2::AnotherMethod, class2instance, _1) ;

    // does class1instance.AMethod(5, 6.0)
    method1(5);

    // does class2instance.AMethod(5)
    method2(5);

    // stored in a vector of functions...
    std::vector< boost::function<void(int)> > functionVec;
    functionVec.push_back(method1);
    functionVec.push_back(method2);

    for ( int i = 0; i < functionVec.size(); ++i)
    {         
         functionVec[i]( 5);
    };
    return 0;
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:24:35.237

由于 C++ 不支持异构容器，因此您的对象必须有一个共享的基类（这样您就可以摆脱拥有一个指向该基类的指针的容器）。

```
class shared_base {
     public:
     virtual void method() = 0; // force subclasses to do something about it
};

typedef std::list<shared_base*> obj_list;

class object : public shared_base {
     public:
     virtual void method() { methodx(); }
     private:
     int methodx(); 
};

// ...
list.insert(new object);

// ...
std::for_each(list.begin(), list.end(), std::mem_fun(&shared_base::method)); 
```

您是否尝试实施[好莱坞原则](http://en.wikipedia.org/wiki/Hollywood_Principle)，也称为控制反转（以及穷人的错误处理）？

查看[Observer](http://en.wikipedia.org/wiki/Observer_pattern)和[Visitor](http://en.wikipedia.org/wiki/Visitor_pattern)模式——它们可能很有趣。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T16:50:34.113

我掀起了一些东西。

```
#include <vector>
#include <algorithm>
#include <iostream>

template <typename ARG>
class TaskSystem
{
private:
    class DelegateBase
    {
    public:
        virtual ~DelegateBase() { }
        virtual void Invoke(ARG arg) = 0;
    };

    template <typename T>
    class Delegate : public DelegateBase
    {
    public:
        typedef void (T::*Func)(ARG arg);

    private:
        Func m_func;
        T* m_object;

    public:
        Delegate(T* object, Func func)
            : m_object(object), m_func(func)
        { }

        virtual void Invoke(ARG arg) 
        { 
            ((*m_object).*(m_func))(arg);
        }
    };

    typedef std::vector<DelegateBase*> Delegates;
    Delegates m_delegates;

public:
    ~TaskSystem()
    {
        Clear();
    }

    void Clear()
    {
        Delegates::iterator item = m_delegates.begin();

        for (; item != m_delegates.end(); ++item)
        {
            delete *item;
        }

        m_delegates.clear();
    }

    template <typename T>
    void AddDelegate(T& object, typename Delegate<T>::Func func)
    {
        DelegateBase* delegate = new Delegate<T>(&object, func);
        m_delegates.push_back(delegate);
    }

    void Invoke(ARG arg)
    {
        Delegates::iterator item = m_delegates.begin();

        for (; item != m_delegates.end(); ++item)
        {
            (*item)->Invoke(arg);
        }
    }

};

class TaskObject1
{
public:
    void CallOne(const wchar_t* value)
    {
        std::wcout << L"CallOne(): " << value << std::endl;
    }

    void CallTwo(const wchar_t* value)
    {
        std::wcout << L"CallTwo(): " << value << std::endl;
    }
};

class TaskObject2
{
public:
    void CallThree(const wchar_t* value)
    {
        std::wcout << L"CallThree(): " << value << std::endl;
    }
};

int _tmain(int argc, _TCHAR* argv[])
{
    TaskSystem<const wchar_t*> tasks;

    TaskObject1 obj1;
    TaskObject2 obj2;

    tasks.AddDelegate(obj1, &TaskObject1::CallOne);
    tasks.AddDelegate(obj1, &TaskObject1::CallTwo);
    tasks.AddDelegate(obj2, &TaskObject2::CallThree);

    tasks.Invoke(L"Hello, World!\n");

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T16:14:07.570

也许你可以换一种方式思考：

```
for(int i=0; i<task_queue.size(); i++) {
    task_queue[i].method(task_queue[i].object);
} 
```

# python - 如何抑制 python 模式的输出缓冲区？

> ID：557555
> 
> 赞同：6
> 
> 时间：2009-02-17T16:10:51.090
> 
> 标签：python, emacs

在 python 模式下（对于 emacs），点击 Control-C\Control-C 将执行当前缓冲区。但是，当执行完成时，输出缓冲区会弹出并将我的编辑窗口分成两半。这是一个*完全*的痛苦，特别是考虑到缓冲区中通常没有输出！

有没有办法阻止缓冲区出现？另外，如果程序员认为用空的缓冲区意外打断我的思路是个好主意，我该如何给他们带来痛苦的电击呢？

**编辑：** 显然，这种行为是有用途的，尤其是在查看程序的输出时。这很好，但是如果没有输出（就像我正在修改的程序中一样），用空白窗口将我的缓冲区切成两半*真的很愚蠢。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T23:42:02.080

你用的是什么python模式？不幸的是，有*几个*.

键入 Ch k 然后 Cc Cc .. 它在模式行中说什么？它是说“py-execute-buffer”还是说“python-send-buffer”，第一种表示您使用的是 Tim Peters 的 python-mode，而第二种表示您使用的是 Dave Love 的 python-mode .

我自己更喜欢 Dave Love 的 python 模式，它是 Emacs 23 附带的版本（也许更早一些？）。Dave Love's 不会在您运行 Cc Cc 时弹出缓冲区，如果您想查看它，您必须显式切换到 *Python* 缓冲区。

如果您真的打算坚持使用 Tim Peters 的版本，您总是可以在您的 .emacs 中添加类似以下内容的内容，除非明确移动，否则您将永远不会再看到输出缓冲区。

```
(defadvice py-execute-buffer (after advice-delete-output-window activate)                                      
  (delete-windows-on "*Python Output*")) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:20:54.997

抱歉，我无法帮助您使用 emacs，但至于您的第二个问题，Apple 的改进型铝制键盘可能是一个解决方案：

[http://www.apple.com/keyboard/](http://www.apple.com/keyboard/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-20T11:08:59.117

最近`python-mode.el`，该行为由可自定义的变量控制：

```
py-shell-switch-buffers-on-execute 
```

请参阅以下链接：

*   [用于编辑 Python 代码的 Emacs 模式](http://launchpad.net/python-mode)

*   [链接直接下载](http://launchpad.net/python-mode/trunk/6.0.4/+download/python-mode.el-6.0.4.tar.gz)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T17:12:38.820

您可能想要自定义`pop-up-windows`变量；控制拆分功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T17:20:00.750

不知道如何阻止它弹出，但是*Cx, 1*会关闭窗口。

# c# - 在子控件之上绘制图像

> ID：557559
> 
> 赞同：1
> 
> 时间：2009-02-17T16:11:39.167
> 
> 标签：c#, winforms

我需要在面板上绘制一个包含一些子控件的图像。我不想让它隐藏在那些控件后面，当我在`Paint`事件中绘制图像时就是这种情况。

这是我用来覆盖`OnPaint`面板方法的代码：

```
protected override void OnPaint(PaintEventArgs e)
{
    try
    {
        base.OnPaint(e);
        //Draw icon for views at top right corner of the panel.
        e.Graphics.SmoothingMode = 
                System.Drawing.Drawing2D.SmoothingMode.HighQuality;
        if (_viewButton != ViewButton.None)
        {
            Brush menuBrush = 
                new SolidBrush(_viewButton == ViewButton.Highlighted ? 
                    Color.Black : Color.Gray);
            e.Graphics.FillPolygon(menuBrush, new Point[] { 
                new Point(this.Width - 29, 03), 
                new Point(this.Width - 19, 03), 
                new Point(this.Width - 24, 09) });
            menuBrush.Dispose();

            //Draw border of the panel.
            Rectangle borderRect = 
                    new Rectangle(0, 0, this.Width - 1, this.Height - 1);
            GraphicsPath borderPath = GetRoundPath(borderRect, 8);
            e.Graphics.DrawPath(new Pen(Color.LightGray), borderPath);
        }
    }
    catch (Exception ex)
    {
        throw new IDSException(ex);
    }
} 
```

* * *

```
protected override void OnPaint(PaintEventArgs e)
{
    try
    {
        base.OnPaint(e);
        //Draw icon for views at top right corner of the panel.
        e.Graphics.SmoothingMode = 
                System.Drawing.Drawing2D.SmoothingMode.HighQuality;
        if (_viewButton != ViewButton.None)
        {
            Brush menuBrush = 
                new SolidBrush(_viewButton == ViewButton.Highlighted ? 
                    Color.Black : Color.Gray);
            e.Graphics.FillPolygon(menuBrush, new Point[] { 
                new Point(this.Width - 29, 03), 
                new Point(this.Width - 19, 03), 
                new Point(this.Width - 24, 09) });
            menuBrush.Dispose();

            //Draw border of the panel.
            Rectangle borderRect = 
                    new Rectangle(0, 0, this.Width - 1, this.Height - 1);
            GraphicsPath borderPath = GetRoundPath(borderRect, 8);
            e.Graphics.DrawPath(new Pen(Color.LightGray), borderPath);
        }
    }
    catch (Exception ex)
    {
        throw new IDSException(ex);
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T16:16:58.873

[`Paint`事件（或](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.paint.aspx)[`OnPaint`方法](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.onpaint.aspx)的覆盖）是做这种事情的错误地方，因为您需要确保最后调用您的绘画例程。

相反，如果您有权访问父控件，请覆盖该`OnPaint`方法，然后调用基本实现。 **然后**绘制您的图像，它将绘制在其他所有内容之上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T16:20:03.017

最好的方法是使用`BringToFront()`图像上的方法。

It will draw the image on top of all the controls. However, this will not work unless the controls are all located on the same parent control.

# php - Mac 上的 PHP 扩展

> ID：557562
> 
> 赞同：2
> 
> 时间：2009-02-17T16:12:01.833
> 
> 标签：php, apache, macos, php-extension

我写了一个 PHP 扩展，我试图让它在 Mac 的 Apache 服务器上运行。

它通过命令行运行良好，例如：

```
$ php -r 'dl("mylib.dylib"); 
```

我还尝试从源代码构建 Apache，当我运行它时它运行良好（我也将它设置为使用与 Mac 的内置 Apache 相同的 PHP，所以没有区别）。

但是，当我使用默认的 Apache 加载我的扩展时，您可以使用 System Preferences->Web Sharing 或等效地使用 sbin 中的 apachectl，它说：

```
Warning: dl() [function.dl]: Unable to load dynamic library '/usr/lib/php/extensions/mylib.dylib' - (null) in /Users/myuname/Sites/test.php on line 6 
```

Mac 的 Apache 有什么奇怪的地方，或者我必须设置一些权限吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T16:36:44.693

这听起来像是由架构差异引起的那种错误。尝试执行`file /usr/lib/php/extensions/mylib.dylib`并查看二进制文件中包含哪些架构。IIRC，Apache 在 Leopard 上以 64 位运行，因此您需要确保您的库包含您正在运行的任何处理器（ppc64 或 x86-64）的 64 位版本的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T06:00:40.920

的确，它可能是 64 位的东西在咬你的屁股。编译扩展时尝试将“-arch x86_64”传递给 gcc。

# mysql - 你会推荐什么版本控制设计模式

> ID：557570
> 
> 赞同：22
> 
> 时间：2009-02-17T16:12:58.493
> 
> 标签：mysql, ruby-on-rails, design-patterns

我需要将“版本控制”构建到应用程序中，并且想知道如何最好地处理它。

我有这个一般模式：

模型 A 有许多 B

更新时 A 的属性需要版本化，其关联对象 (B) 也需要版本化。因此应用程序将显示 A 的当前版本，但还必须能够查看 A 的以前版本及其关联对象。

我想使用文档存储，但这只是应用程序的一部分，拥有文档存储和关系数据库会引入更多复杂性。

我考虑过使用星型模式，但在我取得进展之前，我想知道是否有一种设计模式可以解决这个问题？

这个问题倾向于解决将关联对象的版本存储在关系数据库中的问题。在需要能够有效地查询数据的地方（即序列化对象是不够的）。

更新：我在想/已经实施但想看看这是否是“更好的方法”

```
,---------. 1      * ,--------.
| Model A |----------| Model B|
`---------'          `--------'
|PK       |          | a_id   |
|b_version|          |version |
|version  |          `--------'
`---------' 
```

我将复制模型 A 和所有关联的 B 并增加版本属性。然后通过 b_version 和 b.version 选择加入 B。只是想知道这是否可以做得更好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T00:13:39.570

Martin Fowler 有一些关于基于时间/版本控制的设计模式的好文章——绝对值得一看：

[http://martinfowler.com/eaaDev/timeNarrative.html](http://martinfowler.com/eaaDev/timeNarrative.html)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-17T16:24:39.013

我不认为版本控制本身没有特定的 GoF 设计模式，因为它存在许多实现。

版本控制最简单的实现是对象的链表。列表中的每个节点都是可版本化对象的新版本。为了节省空间，您还实现了某种[差异](http://en.wikipedia.org/wiki/Diff)，以显示修订之间的差异。这样，您可以将差异存储在数据库中，还可以存储可版本化对象的最终版本，因为版本控制系统应该能够派生介于两者之间的版本。

数据库模式主要看起来像这样（你可以在大多数 wiki 系统中看到这种模式）：

```
+--------------------+ 1     * +-----------------------------+
| VersionableObject  |---------| Diff                        |
+--------------------+         +-----------------------------+
| lastStateContent   |         | difference                  |
| originalAuthor     |         | revision                    |
| #dates and whatnot |         | # userId, dates and whatnot |      
+--------------------+         +-----------------------------+ 
```

如果您想通过分支和其他东西来硬核，您可能需要考虑看看[DAG](http://en.wikipedia.org/wiki/Directed_acyclic_graph)，它是现代分布式版本控制系统使用的。

现在，如果我们谈论您的示例，则需要将大量对象保存在配置中。即我们必须为模型挑选出我们想要的对象的修订版本。这意味着我们有一个多对多的关系（通过中间表解决），有点像这样：

```
+---+ 1   * +---------------+ 1   * +-----------------+ *   1 +-------+
| B |-------| Diff          |-------| ModelSelection  |-------| Model |
+---+       +---------------+       +-----------------+       +-------+
            | revisionNo    |       | {PK} configId   |
            | {FK} configId |       | {FK} modelId    |
            +---------------+       +-----------------+ 
```

我希望这有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T23:52:11.743

我已经通过使用`acts_as_versioned`插件在 Rails 中解决了这个问题。当您将其应用于模型时，它假定表`model_name_version`中有一个附加`model_name`项。每次保存模型时，都会将旧版本和时间戳一起复制到`model_name_version`表中。

这种方法使模型表的大小保持可管理，同时仍然允许搜索以前的版本。我不确定该插件是否能处理您想要的开箱即用的链接，但添加起来并不难。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T16:17:47.937

[Memento 模式](http://en.wikipedia.org/wiki/Memento_pattern)与[Observer 模式](http://en.wikipedia.org/wiki/Observer_pattern)的组合应该满足您的需求。还请查看[访客模式](http://en.wikipedia.org/wiki/Visitor_pattern)以了解您的案例中可能的应用......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-27T06:02:49.230

保存要版本化的数据库 shema 的 XML 快照怎么样？然后能不能改变数据库的状态？

# java - 什么是 Java 中的本机实现？

> ID：557574
> 
> 赞同：35
> 
> 时间：2009-02-17T16:13:40.223
> 
> 标签：java, java-native-interface

如果我们查看 Java Object 类，那么我们可以找到一些方法，例如：

```
public native int hashCode()
protected native Object clone() 
```

这些本地人是什么？这些方法是如何工作的？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-17T16:21:56.710

这些方法要么是*内在*的，要么是在 Java 之外以“本机”代码编写的，即特定于给定机器。

您提到的是*Intrinsic*和 JDK 的一部分，但您也可以使用[Java 本机接口](http://java.sun.com/docs/books/jni/)(JNI) 自己编写本机方法。这通常会使用 C 来编写方法，但许多其他语言，例如 python，允许您相当容易地以这种方式编写方法。以这种方式编写代码要么是为了提高性能，要么是因为它需要访问平台特定的基础设施，而这在纯 java 中是无法完成的。

在 的情况下`hashcode()`，这是由 JVM 实现的。这是因为哈希码通常与只有 JVM 知道的东西相关。在早期的 JVM 上，这与对象在内存中的位置有关——在其他 JVM 上，对象可能会在内存中移动，因此可以使用更复杂（但仍然非常快）的方案。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-19T13:57:59.657

如其他答案中所述，大多数本机方法都是使用 JNI 实现的。

但是，性能关键方法（例如，`Object.hashCode`通常作为内在函数实现）。当字节码被编译成机器码时，Java 编译器会识别方法调用并直接内联适当的代码。这显然比通过 JNI 获得一个简单的方法要快得多。

许多人会声称`Object.hashCode`将返回内存中对象表示的地址。在现代实现中，对象实际上在内存中移动。取而代之的是，对象头的一个区域用于存储该值，该值可能是在首次请求该值时从内存地址中延迟派生的。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-17T16:21:00.347

本机方法主要在 C 中实现，并编译为直接在机器上运行的本机代码。这与在 Java 中实现并编译为由 Java 虚拟机 (JVM) 执行的 Java 字节码的普通方法形成对比。

要从 Java 与这些方法交互，您需要使用[Java Native Interface (JNI)](http://en.wikipedia.org/wiki/Java_Native_Interface)。

本机代码主要用于访问低级内容。在**hashCode**的情况下，这是内存中对象的地址。我对**克隆**的猜测是它将原始内存从给定对象复制到克隆对象。本机代码的其他用途是访问操作系统功能或硬件。

使用本机代码的缺点是您失去了 JVM 的安全性，即您的程序可能由于本机代码中的错误而崩溃或存在安全漏洞。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-06-04T06:02:58.573

> 这些本地人是什么？这些方法是如何工作的？

**使事情更清楚的**最小示例：****

 ****主.java**：

```
public class Main {
    public native int square(int i);
    public static void main(String[] args) {
        System.loadLibrary("Main");
        System.out.println(new Main().square(2));
    }
} 
```

**主.c**：

```
#include <jni.h>
#include "Main.h"

JNIEXPORT jint JNICALL Java_Main_square(
    JNIEnv *env, jobject obj, jint i) {
  return i * i;
} 
```

**编译并运行**：

```
sudo apt-get install build-essential openjdk-7-jdk
export JAVA_HOME='/usr/lib/jvm/java-7-openjdk-amd64'
javac Main.java
javah -jni Main
gcc -shared -fpic -o libMain.so -I${JAVA_HOME}/include \
  -I${JAVA_HOME}/include/linux Main.c
java -Djava.library.path=. Main 
```

**输出**：

```
4 
```

在 Ubuntu 14.04 上测试。还与 Oracle JDK 1.8.0_45 一起使用。

[GitHub 上的示例](https://github.com/cirosantilli/java-cheat/tree/77437774e632ba6ecb483f6e69726431a23b5808/jni)供您使用。

**解释**：

它允许您：

*   使用来自 Java 的任意汇编代码调用已编译的动态加载库（此处用 C 编写）
*   并将结果返回到 Java

这可用于：

*   使用更好的 CPU 汇编指令在关键部分编写更快的代码（不是 CPU 可移植的）
*   进行直接系统调用（不是操作系统可移植的）

以较低的便携性为代价。

您也可以从 C 调用 Java，但您必须先在 C 中创建一个 JVM：[如何从 C++ 调用 Java 函数？](https://stackoverflow.com/questions/819536/how-to-call-java-function-from-c)

**OpenJDK 8 中的示例**

让我们找到`Object#clone`在jdk8u60-b27中定义的位置。

首先我们发现：

```
find . -name Object.java 
```

这导致我们到[jdk/src/share/classes/java/lang/Object.java#l212](http://hg.openjdk.java.net/jdk8u/jdk8u60/jdk/file/afbc08ea922b/src/share/classes/java/lang/Object.java#l212)：

```
protected native Object clone() throws CloneNotSupportedException; 
```

现在是困难的部分，找到克隆在所有间接中的位置。帮助我的查询是：

```
find . -iname object.c 
```

它将找到可能实现 Object 的本机方法的 C 或 C++ 文件。它引导我们到[jdk/share/native/java/lang/Object.c#l47](http://hg.openjdk.java.net/jdk8u/jdk8u60/jdk/file/afbc08ea922b/src/share/native/java/lang/Object.c#l47)：

```
static JNINativeMethod methods[] = {
    ...
    {"clone",       "()Ljava/lang/Object;",   (void *)&JVM_Clone},
};

JNIEXPORT void JNICALL
Java_java_lang_Object_registerNatives(JNIEnv *env, jclass cls)
{
    (*env)->RegisterNatives(env, cls,
                            methods, sizeof(methods)/sizeof(methods[0]));
} 
```

这将我们引向`JVM_Clone`符号：

```
grep -R JVM_Clone 
```

这将我们带到了[热点/src/share/vm/prims/jvm.cpp#l580](http://hg.openjdk.java.net/jdk8u/jdk8u60/hotspot/file/10ad4b9d79f9/src/share/vm/prims/jvm.cpp#l580)：

```
JVM_ENTRY(jobject, JVM_Clone(JNIEnv* env, jobject handle))
    JVMWrapper("JVM_Clone"); 
```

展开一堆宏后，我们得出结论，这就是定义点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T16:17:11.713

Java 中的本机方法是使用称为 JNI的“ [Java 本机接口”实现的。](http://java.sun.com/docs/books/jni/)

# objective-c - Objective-C 中的 NULL 与 nil

> ID：557582
> 
> 赞同：187
> 
> 时间：2009-02-17T16:14:44.073
> 
> 标签：objective-c, cocoa, null

在`observeValueForKeyPath:ofObject:change:context:`- 为什么文档使用`NULL`而不是`nil`在不指定上下文指针时使用？

* * *

## 回答 #1

> 赞同：230
> 
> 时间：2009-02-17T16:23:49.293

`nil`应该只用来代替`id`，我们 Java 和 C++ 程序员会认为它是指向对象的指针。用于`NULL`非对象指针。

查看该方法的声明：

```
- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object
    change:(NSDictionary *)change context:(void *)context 
```

Context 是一个`void *`（即 C 风格的指针），因此您肯定会使用`NULL`（有时声明为`(void *)0`）而不是`nil`（类型为`id`）。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2009-02-17T16:21:19.457

它们在技术上是相同的东西 (0)，但 nil 通常用于 Objective-C 对象类型，而 NULL 用于 c 样式指针 (void *)。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2009-11-05T13:53:52.073

它们在技术上是相同的，只是风格不同：

*   Objective-C 风格说`nil`的是使用什么`id`类型（和指向对象的指针）。
*   C 风格说这`NULL`就是你所使用的`void *`。
*   C++ 风格通常说你应该只使用`0`.

我通常使用与*声明*类型的语言相匹配的变体。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-07-26T06:18:15.233

`NULL`是**`C equivalent`**of `nil`，一个空指针；

其中**`nil is zero typed as id`**,

**`NULL is zero typed as void*`**.

**重要的一点**是您不能向 NULL 发送消息。所以在objective-C中很多地方都优先使用nil。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-02-01T09:12:08.707

它们几乎是一样的，除了，

`nil`用于 Objective-C 风格。where`NULL`是 C 类型指针，并且是 typdef'ed 到`(void *)`.

# php - 如何在 MySQL 中动态设置每行递增的值

> ID：557596
> 
> 赞同：0
> 
> 时间：2009-02-17T16:18:12.803
> 
> 标签：php, mysql, list, loops

我正在创建一个充当优先级列表的 Web 应用程序，允许用户重新排列列表中的一组项目，并通过 PHP 后端将该排列存储在 MySQL 数据库中。

目前，当用户完成他们的项目并保存配置时，我正在为每一行调用一个单独的 UPDATE 语句，并为每行插入 priorityLevel（列表中的位置）。

例如：（不是我的生产代码，但这说明了这一点）

```
<?php
  $items = array(12, 17, 27, 26, 5); // an array of IDs, in proper order
  // due to nature of foreach loop in PHP, this makes $order be the key value,
  // in this case, 0, 1, 2, 3, 4 respectively
  foreach ($items as $order => $item)
  {
    $database->query("UPDATE `table` SET `priorityLevel` = {$order} " .
                     "WHERE `ID` = {$item}");
  }
?> 
```

这工作得很好，但运行这么多 UPDATE 查询似乎效率低下，尤其是当列表变长并且我们正在重新排序许多项目时。我希望有某种方法可以在 UPDATE 命令中动态创建订单，如下所示：

```
<?php
  $database->query("UPDATE `table` SET `priorityLevel` = ORDER_NUMBER " .
                   "WHERE `ID` IN (12, 17, 27, 26, 5)");
?> 
```

... 其中 ORDER_NUMBER 是一个动态数字，可能由 WHERE 子句中 ID 值的位置决定。它还需要尊重 WHERE 子句中项目的顺序，以确保根据用户的意愿设置 priorityLevel。

有谁知道这在 MySQL 5 / PHP 5 环境中是否可行？该表使用 MyISAM 引擎，因此它不支持事务。

（PS - 我对 MySQL 的一些基础知识足够了解，但我远非专家，所以如果这里涉及到除了简单的 CREATE、INSERT、UPDATE、DELETE 命令之外的任何内容，请进行描述）

（PPS - 这个主题对谷歌来说很难，因为这些术语太笼统了。如果我搜索“mysql order”，我会得到一堆关于为 MySQL 创建购物车应用程序的教程！）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T16:33:21.317

您必须像这样在 PHP 中构建一个查询并将该查询发送到 mysql：

```
UPDATE `table`
SET priorityLevel = 
CASE 
WHEN `ID` = 12 THEN 1
WHEN `ID` = 17 THEN 2 
WHEN `ID` = 27 THEN 3
WHEN `ID` = 26 THEN 4
WHEN `ID` = 5 THEN 5
END 
WHERE `ID` IN (12, 17, 27, 26, 5);
```

（用 MySql 5.0 测试）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T16:36:15.630

如果您使用准备好的语句，您还可以使循环更快，这使您可以在 MySQL 服务器将查询保存在内存中时更改特定值。这需要使用 MySQLi 扩展，而不是常规的 MySQL。

这些方面的东西：

```
$mysql = new mysqli(HOST, USER, PASS, DB);

$stmt = $mysql->prepare("UPDATE items SET sortorder = ? WHERE id = ?");

$stmt->bind_params('ii', $sort, $id);

foreach ( $items as $sort => $id ) {
    $stmt->execute();
} 
```

# php - 抓取并生成 RSS 提要

> ID：557598
> 
> 赞同：2
> 
> 时间：2009-02-17T16:19:08.043
> 
> 标签：php, foreach, rss, screen-scraping

我使用[Simple HTML DOM](http://simplehtmldom.sourceforge.net/)来抓取一个页面以获取最新消息，然后使用这个[PHP 类](http://www.phpclasses.org/browse/package/4427.html)生成一个 RSS 提要。

这就是我现在所拥有的：

```
<?php

 // This is a minimum example of using the class
 include("FeedWriter.php");
 include('simple_html_dom.php');

 $html = file_get_html('http://www.website.com');

foreach($html->find('td[width="380"] p table') as $article) {
$item['title'] = $article->find('span.title', 0)->innertext;
$item['description'] = $article->find('.ingress', 0)->innertext;
$item['link'] = $article->find('.lesMer', 0)->href;     
$item['pubDate'] = $article->find('span.presseDato', 0)->plaintext;     
$articles[] = $item;
}

//Creating an instance of FeedWriter class. 
$TestFeed = new FeedWriter(RSS2);

 //Use wrapper functions for common channel elements

 $TestFeed->setTitle('Testing & Checking the RSS writer class');
 $TestFeed->setLink('http://www.ajaxray.com/projects/rss');
 $TestFeed->setDescription('This is test of creating a RSS 2.0 feed Universal Feed Writer');

  //Image title and link must match with the 'title' and 'link' channel elements for valid RSS 2.0

  $TestFeed->setImage('Testing the RSS writer class','http://www.ajaxray.com/projects/rss','http://www.rightbrainsolution.com/images/logo.gif');

foreach($articles as $row) {

    //Create an empty FeedItem
    $newItem = $TestFeed->createNewItem();

    //Add elements to the feed item    
    $newItem->setTitle($row['title']);
    $newItem->setLink($row['link']);
    $newItem->setDate($row['pubDate']);
    $newItem->setDescription($row['description']);

    //Now add the feed item
    $TestFeed->addItem($newItem);
}

  //OK. Everything is done. Now genarate the feed.
  $TestFeed->genarateFeed();

?> 
```

我怎样才能使这段代码更简单？知道有两个 foreach 语句，我该如何组合它们？

因为抓取的新闻是挪威语，所以我需要在标题上应用 html_entity_decode()。我在这里尝试过，但我无法让它工作：

```
foreach($html->find('td[width="380"] p table') as $article) {
$item['title'] = html_entity_decode($article->find('span.title', 0)->innertext, ENT_NOQUOTES, 'UTF-8');
$item['description'] = "<img src='" . $article->find('img[width="100"]', 0)->src . "'><p>" . $article->find('.ingress', 0)->innertext . "</p>";    
$item['link'] = $article->find('.lesMer', 0)->href;     
$item['pubDate'] = unix2rssdate(strtotime($article->find('span.presseDato', 0)->plaintext));
$articles[] = $item;
} 
```

谢谢 ：）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T16:43:00.077

似乎您循环遍历`$html`以构建文章数组，然后循环遍历这些添加到提要 - 您可以通过在找到时将项目添加到提要来跳过整个循环。为此，您需要`FeedWriter`在执行流程中将构造函数向上移动一点。

我还会添加一些方法来帮助提高可读性，从长远来看，这可能有助于可维护性。如果您需要为提要插入不同的提供程序类、更改解析规则等，封装提要创建、项目修改等应该会更容易。可以对以下代码进行进一步改进（`html_entity_decode`在单独的作业等） ，`$item['title']`但你得到了一般的想法。

你有什么问题`html_entity_decode`？你有样本输入/输出吗？

```
<?php

 // This is a minimum example of using the class
 include("FeedWriter.php");
 include('simple_html_dom.php');

 // Create new instance of a feed
 $TestFeed = create_new_feed();

 $html = file_get_html('http://www.website.com');

 // Loop through html pulling feed items out
 foreach($html->find('td[width="380"] p table') as $article) 
 {
    // Get a parsed item
    $item = get_item_from_article($article);

    // Get the item formatted for feed
    $formatted_item = create_feed_item($TestFeed, $item);

    //Now add the feed item
    $TestFeed->addItem($formatted_item);
 }

 //OK. Everything is done. Now generate the feed.
 $TestFeed->generateFeed();

// HELPER FUNCTIONS

/**
 * Create new feed - encapsulated in method here to allow
 * for change in feed class etc
 */
function create_new_feed()
{
     //Creating an instance of FeedWriter class. 
     $TestFeed = new FeedWriter(RSS2);

     //Use wrapper functions for common channel elements
     $TestFeed->setTitle('Testing & Checking the RSS writer class');
     $TestFeed->setLink('http://www.ajaxray.com/projects/rss');
     $TestFeed->setDescription('This is test of creating a RSS 2.0 feed Universal Feed Writer');

     //Image title and link must match with the 'title' and 'link' channel elements for valid RSS 2.0
     $TestFeed->setImage('Testing the RSS writer class','http://www.ajaxray.com/projects/rss','http://www.rightbrainsolution.com/images/logo.gif');

     return $TestFeed;
}

/**
 * Take in html article segment, and convert to usable $item
 */
function get_item_from_article($article)
{
    $item['title'] = $article->find('span.title', 0)->innertext;
    $item['title'] = html_entity_decode($item['title'], ENT_NOQUOTES, 'UTF-8');

    $item['description'] = $article->find('.ingress', 0)->innertext;
    $item['link'] = $article->find('.lesMer', 0)->href;     
    $item['pubDate'] = $article->find('span.presseDato', 0)->plaintext;     

    return $item;
}

/**
 * Given an $item with feed data, create a
 * feed item
 */
function create_feed_item($TestFeed, $item)
{
    //Create an empty FeedItem
    $newItem = $TestFeed->createNewItem();

    //Add elements to the feed item    
    $newItem->setTitle($item['title']);
    $newItem->setLink($item['link']);
    $newItem->setDate($item['pubDate']);
    $newItem->setDescription($item['description']);

    return $newItem;
}
?> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T16:31:21.540

那么对于这两个循环的简单组合，您可以通过 HTML 创建提要作为解析：

```
<?php
include("FeedWriter.php");
include('simple_html_dom.php');

$html = file_get_html('http://www.website.com');

//Creating an instance of FeedWriter class. 
$TestFeed = new FeedWriter(RSS2);
$TestFeed->setTitle('Testing & Checking the RSS writer class');
$TestFeed->setLink('http://www.ajaxray.com/projects/rss');
$TestFeed->setDescription(
  'This is test of creating a RSS 2.0 feed Universal Feed Writer');

$TestFeed->setImage('Testing the RSS writer class',
                    'http://www.ajaxray.com/projects/rss',
                    'http://www.rightbrainsolution.com/images/logo.gif');

//parse through the HTML and build up the RSS feed as we go along
foreach($html->find('td[width="380"] p table') as $article) {
  //Create an empty FeedItem
  $newItem = $TestFeed->createNewItem();

  //Look up and add elements to the feed item   
  $newItem->setTitle($article->find('span.title', 0)->innertext);
  $newItem->setDescription($article->find('.ingress', 0)->innertext);
  $newItem->setLink($article->find('.lesMer', 0)->href);     
  $newItem->setDate($article->find('span.presseDato', 0)->plaintext);     

  //Now add the feed item
  $TestFeed->addItem($newItem);
}

$TestFeed->genarateFeed();
?> 
```

您看到的问题是什么`html_entity_decode`，如果您给我们一个链接到它不起作用的页面可能会有所帮助？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T17:10:38.997

> 我怎样才能使这段代码更简单？

我知道这不是你要问的，但你知道[ [http://pipes.yahoo.com/pipes/](http://pipes.yahoo.com/pipes/](Yahoo) ]（雅虎！管道）吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-10T01:15:32.837

也许您可以使用 Feedity - [http://feedity.com](http://feedity.com)之类的东西，它已经解决了从任何网页生成 RSS 提要的问题。

# javascript - Google Maps 地标在包含嵌入式地图的页面中触发脚本的任何方式

> ID：557621
> 
> 赞同：2
> 
> 时间：2009-02-17T16:26:21.877
> 
> 标签：javascript, google-maps, kml

有没有办法让地图的地标在包含地图的页面上调用 javascript 方法。

例如：假设我们有一个谷歌地图，上面有我们客户的别针。如果销售人员点击 CompanyA 的 pin，包含页面是否可以使用 javascript 来识别 ConpanyA 的 pin 已被点击。并显示该公司活动的快速报告？

编辑：对不起伙计们，应该提到我们想通过 KML 构建和加载地标

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T16:31:20.197

是的，您可以将事件连接到标记（我使用标记管理器）。

```
GEvent.addListener(marker,'click',function(){..your code..}) 
```

请参阅此处的 api 文档：[http](http://code.google.com/apis/maps/documentation/reference.html#GMarker) ://code.google.com/apis/maps/documentation/reference.html#GMarker （向下滚动到“事件”部分）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T16:29:30.840

[我在这里](http://www.primrose-house.co.uk/localattractions.php)做了类似的事情。随意查看源代码:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T16:28:28.893

我相信您使用 Google Maps AJAX API 将任意 HTML 放入 pin 的弹出窗口中。我知道我可以在其中放置一个锚标记（a href=blah），所以您不能创建一个具有 javascript:blah() url 而不是网络上的某些 url 的可点击链接吗？

# spring - Spring：设置一个简单的 PropertyPlaceholderConfigurer 示例

> ID：557626
> 
> 赞同：5
> 
> 时间：2009-02-17T16:28:45.383
> 
> 标签：spring

解决这个问题可能很简单，但我不确定我错过了什么。这是我所拥有的，`PropertyPlaceholderConfigurer`不会取代`${...}`.

```
/* ---- org/company/springtest/Test.java: ---- */
package org.company.springtest;

import org.springframework.beans.factory.xml.XmlBeanFactory;
import org.springframework.core.io.FileSystemResource;
import org.springframework.core.io.Resource;

public class Test {
    public static void main( String... args ) {
         Resource res = new FileSystemResource("conf/xml/context2.xml");
             XmlBeanFactory beanFactory = new XmlBeanFactory(res);
             TestApp app = (TestApp) beanFactory.getBean("testApp");
             app.print();
    }   
}

/* ---- org/company/springtest/TestApp.java: ---- */
package org.company.springtest;
import org.springframework.beans.factory.annotation.Required;

public class TestApp {
    private String m_message;

    public void setMessage( String message ) {
         m_message = message;
    }

    public void print() {
        System.out.println(m_message);
    }
}

/* ---- conf/xml/context2.xml: ---- */
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:lang="http://www.springframework.org/schema/lang" xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations" value="file:conf/xml/test.properties" />
    </bean>
    <bean id="testApp" class="org.company.springtest.TestApp">
         <property name="message" value="${test.message}"/>
    </bean>
</beans>

/* ---- conf/xml/test.properties: ---- */
test.message=Hello world! 
```

以下是运行测试时的输出：

```
Feb 17, 2009 11:23:06 AM org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions
INFO: Loading XML bean definitions from file [C:\eclipse\workspace\SpringTest\conf\xml\context2.xml]
${test.message} 
```

看起来配置器没有替换属性值......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T16:30:20.480

也许尝试使用 a`ApplicationContext`而不是 a `BeanFactory`？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:33:09.180

正如[cliff.meyers](https://stackoverflow.com/questions/557626/spring-setting-up-a-simple-propertyplaceholderconfigurer-example/557633#557633) 所说。

查看[ApplicationContext 与 BeanFactory 的比较](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#context-introduction-ctx-vs-beanfactory)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-28T12:25:13.607

而不是`Resource res = File.....` 使用下面的

```
ApplicationContext ctx = new FileSystemXmlApplicationContext("conf/xml/context2.xml");
TestApp test = (TestApp) ctx.getBean("testApp");
test.print(); 
```

你会得到结果。

因为`Resource`它不会读取我们在路径中指定的属性。

# c# - 如何在.net2.0 winforms中使搜索用户控件通用

> ID：557628
> 
> 赞同：2
> 
> 时间：2009-02-17T16:29:06.147
> 
> 标签：c#, winforms, .net-2.0

我有一个想要通用的搜索用户控件。

控件本身将包含不同的控件集合，具体取决于其上下文。例如，它可以是库存商品、人员、地址作为搜索的上下文。

我怎样才能使它足够通用，以便根据搜索上下文确切地知道用户在表单上需要什么控件？

然后，任何程序员都可以将用户控件拖到他们的表单上，设置它的上下文，我们就可以开始了。

我的第一个想法是为所有单独的用户控件创建一个基本控件，搜索对话框在构造函数中接受这些控件，因此它知道在运行时要显示哪些控件。您可以创建基本控件的继承版本并将它们传入。或者可能只是设置搜索上下文（枚举），它会显示如何在运行时确定用户控件的内容。

都是.net 2.0 Winform

为便于阅读而编辑。Q 之前过于冗长和详细。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T16:40:18.523

在我们的项目中，我们通过添加带有和属性的`ISearchable`接口来做到这一点。这些接受一个方向参数指定向前或向后，并且 Search 方法还接受一个用于执行搜索的字符串和一个指定匹配类型的枚举（短语的开头、短语的结尾、包含在短语中等）。`CanSearch``Search`

然后，我们在层次结构中的所有控件上实现了这个接口。然后，每个控件都委派给子控件，因为它认为合适。我们的容器应用程序将包含一个文本框并找到下一个/上一个按钮。容器将查询层次结构中的第一个视图以获取接口，然后该视图将向下链接到目标控件，因为层次结构中的每个控件都认为合适。

我们为剪贴板操作实现了另一种方法，我们首先直接检查主动聚焦的控件，看看它是否支持我们的`ISupportEdit`界面。如果没有，我们然后使用层次结构方法。

# .net - .Net 部署项目的 Detected Dependencies 神奇地未被排除

> ID：557631
> 
> 赞同：5
> 
> 时间：2009-02-17T16:29:57.657
> 
> 标签：.net, msbuild, dependencies, deployment-project

我有一个 Visual Studio 2005 .NET 解决方案，它有 20 多个子项目，包括一个部署项目。VS2005 .NET 部署项目有许多检测到的依赖项，这些依赖项已被手动排除并更正了手动添加的值。

但是，有时，这些检测到的依赖项会神奇地取消排除，这会在构建时触发警告：警告：两个或多个对象具有相同的目标位置 ('[targetdir]\')

导致检测到的依赖项未被排除的触发器是什么？部署解决方案能否将其警告视为错误，以使夜间构建无法继续？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T18:37:30.850

在放弃并转向[WiX](http://wix.sourceforge.net/)之前，我遇到了同样的问题并处理了大约一年。我不得不“双重构建”我的构建也没有帮助，因为 VS2005 的 MSBuild 不适用于部署项目。

无论如何，您可能需要考虑安装 WiX 之类的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-02T01:05:22.703

当依赖项目在依赖 DLL 上设置了“复制本地”时，就会发生这种情况。部署/设置项目将 DLL 的源代码和副本列为依赖项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T19:08:26.873

The discussion of detected dependency refreshes here may explain the behavior if you're using multiple development environments with the same project:

[http://www.xmission.com/~legalize/msi/known-bugs-2003.html](http://www.xmission.com/~legalize/msi/known-bugs-2003.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T12:22:14.797

好的，这比其他任何东西都更像是一个[黑客:)](http://msdn.microsoft.com/en-us/library/zhx4ah11(VS.80).aspx)

您通常在 Visual Studio 下有 2 个选项：

a) 排除重复的 DLL
或
b) 将重复的 DLL 的**Condition**属性设置为不同的值。

问题是，使用这两种方法，你仍然会让它们**神奇地**重置并像以前一样收到警告..

对我们有用的是以下解决方案：

a) 转到您的设置项目并创建一个**自定义文件夹**

b) 将自定义文件夹的**DefaultLocation**属性设置为与您需要放置这些 DLL 的属性相同。即对于 ASP.NET 应用程序，该值为 [TARGETDIR]\bin

c）然后将所有重复的 dll 拖放到此文件夹中，您现在应该不会收到任何警告。

而已。您应该不会收到这些 dll 的警告，如果您有任何额外的内容，只需将它们拖到此文件夹中即可。

希望这可以帮助。

-康斯坦丁诺斯

# database - 免费的便携式数据库

> ID：557632
> 
> 赞同：24
> 
> 时间：2009-02-17T16:30:09.403
> 
> 标签：database, portability, portable-applications

您好我正在开发桌面便携式免费应用程序，我正在寻找便携式数据库：

*   自由
*   无需安装
*   多达 20K 条记录
*   独立应用程序
*   支持加密（可选）
*   SQL92 规范

谢谢你的建议

你能写一些优点和缺点吗？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-02-17T16:31:51.117

[SQLite：](http://www.sqlite.org/)

> 自包含、无服务器、零配置、事务性 SQL 数据库引擎。SQLite 是世界上部署最广泛的 SQL 数据库引擎。SQLite 的源代码在公共领域。

-亚当

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-17T16:41:38.847

[火鸟嵌入式](http://www.firebirdsql.org/)

关于：

> Firebird 是一个开源关系数据库，提供了许多在 Linux、Windows 和各种 Unix 平台上运行的 ANSI SQL-99 特性。Firebird 为存储过程和触发器提供了出色的并发性、高性能、强大的语言支持。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T16:55:37.207

如果您使用 Java，[HSQLDB](http://hsqldb.org/)可能是一个不错的选择。否则，SQLite。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T16:36:53.240

[SQL Server 紧凑型](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T16:40:13.483

不确定它是否满足无安装要求，但如果您需要的不仅仅是 SQLite，请检查[Apache Derby](http://db.apache.org/derby/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-17T18:47:33.177

根据您的问题，您可以考虑 Ms Access。

您可以通过安装在 Windows XP 和更新版本上的 Jet 引擎连接到 Access 数据库。

从 v2002 开始，它符合 SQL 92（正如 Microsoft[声称](http://office.microsoft.com/en-us/access/HA010345621033.aspx)的那样）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-17T18:49:52.393

[东京内阁](http://fallabs.com/tokyocabinet/ "东京内阁")将是一个很好的候选人，除了它不是关系型的（所以没有 SQL）。
鉴于您没有这么多的记录，也许一个完整的关系数据库对于您的需求来说太过分了。当然，这取决于您的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T16:32:37.387

编辑：哎呀，显然我的意思是[SQL Compact](https://stackoverflow.com/questions/517901/can-i-install-sql-server-on-a-usb-drive)，而不是[表达](http://www.microsoft.com/express/sql/default.aspx)

# c# - Windows Workflow Foundation 示例 - 审核

> ID：557634
> 
> 赞同：2
> 
> 时间：2009-02-17T16:30:53.707
> 
> 标签：c#, workflow, workflow-foundation

作为我的个人改进计划 (PIP™) 的一部分，我正在尝试学习 Windows Workflow Foundation 的基础知识。

我决定写一个相当简单的博客引擎。我知道那里有很多东西，但这只是一个游乐场项目，我可以用来学习一些很酷的东西。我想要实现的主要功能之一是使用 WF 对博客条目进行审核。该项目的其余部分将是一个 ASP.NET MVC 应用程序，可能会洒上一点 WCF。

根据我对 WF 的了解，我应该使用如下所示的顺序工作流程：

1.  作者添加/编辑博客条目。
2.  条目被发送给版主批准。
3.  版主批准发布 - 或 - 返回第 1 项。供作者更正，以及版主注释。
4.  结束

每个步骤还应通过电子邮件向操作的接收者发送电子邮件。

由于人为交互因素，我猜测 WF 运行时需要在某个地方自行序列化，这样它就不会丢失状态（因为每个活动都可能被 AppPool 重置、服务器崩溃等中断）。

有谁知道实施类似工作流程的任何好例子或地方？

谢谢大家。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T16:55:17.567

我暂时不会深入研究 WW。.NET 4.0 将对 WW 模型进行更改以解决当前的痛点。这些变化将引入一个与今天的 WW 根本不同的模型，如果您还没有 WW 解决方案，那么学习当前的 WW 方法将没有多大帮助。

更多信息可以在这里找到：

[http://blogs.msdn.com/endpoint/archive/2009/01/20/the-road-to-wf-4-0-part-1.aspx](http://blogs.msdn.com/endpoint/archive/2009/01/20/the-road-to-wf-4-0-part-1.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T16:56:42.337

你在正确的轨道上。Windows 工作流提供了一个持久性模型，允许您将正在运行的工作流实例的状态保存到 SQL Server。当正在运行的实例暂停时（通常是在等待来自工作流外部的输入时），状态会自动序列化到数据库中。

[这](http://www.microsoft.com/downloads/details.aspx?FamilyID=a438a9b9-9f15-42ec-866f-2ea58e10db36&DisplayLang=en)是来自 Microsoft 的入门工具包，用于基于 Web 的审批工作流。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T17:46:43.167

我不确定您是否要使用顺序工作流程。状态机工作流程可能更适合您的需求。在顺序工作流程中冲洗和重复似乎总是有点麻烦恕我直言。

我喜欢[Ode to Code](http://www.google.com/searchhl=en&rlz=1C1GGLS_enUS311US316&q=)上的工作流教程，并认为[状态机工作流教程](http://www.odetocode.com/Articles/460.aspx)会回答你的很多问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T16:57:30.633

> 将自己序列化到某个地方，这样它就不会丢失状态

WF 对此具有内置支持（使用 SQL Server，但您可以插入不同的后端）。

任何体面的资源都应该涵盖工作流持久性（例如“Pro WF”（APress））。

其他书籍（例如“Essential Windows Workflow Foundation”（AW））涵盖了更多“为什么它会以这种方式工作”。所以“Pro WF”会让你更快地使用内置（或其他现成的）活动等，但 Essential... 可能会让你更好地理解创建自己的活动（尤其是在与持久性和故障）。

# asp.net - asp.net inline 与 codebehind 你使用哪个，为什么？

> ID：557641
> 
> 赞同：3
> 
> 时间：2009-02-17T16:32:33.720
> 
> 标签：asp.net

我已经做到了两种方式，老实说，除了能够将代码和网络表单提供给两个不同的人（这在我工作的地方不会发生）之外，我认为一种方法相对于另一种方法几乎没有优势。我可以理解将代码放在一个文件中并将标记放在另一个文件中的好处，但我也可以理解将两者放在一个文件中的便利性。

我看不出使用代码隐藏如何*强制执行*任何类型的“好”编程，因为您仍然可以在代码隐藏中编写蹩脚的代码，而且我已经看到了一些非常干净的内联代码。

所以我真正的问题是，您使用的是什么方法？有没有*什么*你可以用代码隐藏的方式以编程方式做的，而内联代码根本无法做到？或者这一切真的归结为“个人偏好”这个简单的问题。微软似乎并没有在某种方式和性能方面采取真正的立场，这似乎是一种洗礼。

意见？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T16:46:51.050

根据我的经验，我更喜欢解决方案背后的代码，因为我喜欢它的分离方面。

我主要使用服务器控件，并且我注意到如果我不将这两者混合太多，我可以更轻松地专注于设计任务或编程任务。

但是，有时，我确实很欣赏使用 <% %> 标签的便捷性。

最后，您是对的，两者都不能确保代码良好且可读，我在项目背后看到了一些糟糕的代码，以及优秀且可读的“内联”代码。

归根结底，这完全取决于您的喜好。

我的2c。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:47:28.067

作为一般规则，我尝试将我的 HTML 与我的代码分开。我将 HTML 视为带有孔的模板（使用标签、文字等），然后我的代码可以用数据填充这些模板。对我来说，拥有这种干净的分离感觉更容易管理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T16:52:44.687

> 个人喜好

确实。带有很大的“噪音容忍度”。

杰夫最近[发布了这个](http://www.codinghorror.com/blog/archives/001223.html)，我倾向于同意。如果源代码主要是标记，则内联代码运行良好，但是如果源代码主要是代码，则代码在后面（正如 Jeff 指出的那样，VB 的 XML 支持在这里真的很有帮助）。

当您设置一些值时，您可能会发现对于 HTML 的结构在代码中丢失的情况（例如，当创建的 HTML 非常动态地确定时）做出了不同的选择。

正确的平衡在哪里？...这是偏好位。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T16:52:54.060

我的午餐更喜欢意大利面，而不是在我的代码编辑器中。:) 我认为最重要的方面是关注点分离。如果我在 .aspx 文件中使用内联 C# 代码，它只是用于数据绑定（例如，从某些值构建字符串）、将 ClientID 提供给 JavaScript 等。

我猜这一切都归结为维护。我知道我宁愿用不同文件中的代码修复你的项目；）而不是巨大的脚本。通过使用这样的脚本，您会引入冗余代码并使您的开发人员同伴的生活变得悲惨。也许您不与其他任何人一起工作 - 但有一天有人可能会加入团队。我喜欢能够在不接触布局文件的情况下修改 UI 逻辑。只想着别人！:)

如果您使用一些与布局严格相关的小脚本，那就去吧。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T16:00:15.560

请 - 无论你做什么，把你的代码放在一个单独的文件中！否则我不想调试你的代码。

遗留 asp 的问题之一是所有内容都在同一页面上，在对代码进行多次编辑后，这将变得难以管理。

请帮我们大家一个忙，使用 .NET 的一项强大功能并将 html 与服务器端代码分开。

谢谢...

:)

# c# - 有什么方法可以避免 C# 中的属性内联优化？

> ID：557643
> 
> 赞同：7
> 
> 时间：2009-02-17T16:32:38.947
> 
> 标签：c#, stack-trace

所以我有一个旨在实现 INotifyPropertyChanged 的​​ PropertyBag 类。为了使此代码尽可能干净地工作并避免用户错误，我使用堆栈来获取属性名称。看，如果属性名称与实际属性不完全匹配，那么您将失败，我正在努力避免这种情况。

因此，这是该类的示例用法：

```
public class MyData : PropertyBag
{
    public MyData()
    {
        Foo = -1;
    }

    public int Foo
    {
        get { return GetProperty<int>(); }
        set { SetProperty(value); }
    }
} 
```

基本 PropertyBag 的重要代码在这里：

```
public abstract class PropertyBag : INotifyPropertyChanged
{
    protected T GetProperty<T>()
    {
        string propertyName = PropertyName((new StackTrace()).GetFrame(1));
        if (propertyName == null)
            throw new ArgumentException("GetProperty must be called from a property");

        return GetValue<T>(propertyName);
    }

    protected void SetProperty<T>(T value)
    {
        string propertyName = PropertyName((new StackTrace()).GetFrame(1));
        if (propertyName == null)
            throw new ArgumentException("SetProperty must be called from a property");

        SetValue(propertyName, value);
    }

    private static string PropertyName(StackFrame frame)
    {
        if (frame == null) return null;
        if (!frame.GetMethod().Name.StartsWith("get_") &&
           !frame.GetMethod().Name.StartsWith("set_"))
            return null;

        return frame.GetMethod().Name.Substring(4);
    }
} 
```

所以现在你已经看到了我的代码，我可以告诉你问题......在某些情况下，在发布版本下，“MyData”构造函数中的“Foo”设置器似乎被优化为内联为 SetProperty(-1)。不幸的是，这种内联优化使我的 SetProperty 方法失败，因为我不再从属性中调用它！失败。看来我不能以这种方式依赖 StackTrace。

任何人都可以 A：找出更好的方法来做到这一点，但仍然避免将“Foo”传递给 GetProperty 和 SetProperty？
B：想办法告诉编译器在这种情况下不要优化？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T16:38:50.490

在这里使用堆栈是缓慢且不必要的；我会简单地使用：

```
get { return GetProperty<int>("Foo"); }
set { SetProperty("Foo", value); } 
```

（提示：我在自定义属性模型方面做了很多工作；我知道这很好用……）

另一种选择是对象键（使用引用相等来比较） - 很多`ComponentModel`工作都是这样的，WF/WPF 中的一些属性也是如此：

```
static readonly object FooKey = new object();
...
get { return GetProperty<int>(FooKey); }
set { SetProperty(FooKey, value); } 
```

当然，您可以为键声明一个类型（带有`Name`属性），并使用它：

```
static readonly PropertyKey FooKey = new PropertyKey("Foo"); 
```

ETC; 但是，要回答这个问题：标记它（但**不**要这样做）：

```
[MethodImpl(MethodImplOptions.NoInlining)] 
```

或者

```
[MethodImpl(MethodImplOptions.NoOptimization)] 
```

~~或者~~

 ~~```
[MethodImpl(MethodImplAttributes.NoOptimization
    | MethodImplAttributes.NoInlining)] 
```~~  ~~* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T16:57:56.967

使用堆栈不是一个好主意。您依靠编译器的内部实现来人为地将您的属性包与语言属性联系起来。

1.  要求添加`MethodImpl`属性会使您的属性包对其他开发人员不透明。
2.  即使属性包具有该`MethodImpl`属性，也无法保证它将成为调用堆栈上的第一帧。程序集可能被检测或修改以在实际属性和对您的属性包的调用之间注入调用。（思考方面编程）
3.  新语言甚至 C# 编译器的未来版本可能会以不同的方式装饰属性访问器，`'_get'`然后`'_set'`
4.  构造调用栈是一个比较慢的操作，因为它需要对内部压缩栈进行解压，并通过反射获取每个类型和方法的名称。

你真的应该只实现你的属性包访问器来获取一个参数来识别属性 - 一个字符串名称（如 Hastable）或一个对象（如 WPF 依赖属性包）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-07-28T23:20:09.470

尝试新的 [CallerMemberName] 属性。

将它放在您的方法的参数上（[CallerMemberName] callerName = null），编译器将重写对您的方法的所有调用以自动传递调用者名称（您的调用根本不传递参数）。

它不会消除任何优化，并且比 lambdas 或反射或堆栈快得多，并且可以在 Release 模式下工作。

PS 如果 CallerMemberNameAttribute 在您的框架版本中不存在，只需定义它（空）。这是一个语言特性，而不是一个框架特性。当编译器在参数上看到 [CallerMemberNameAttribute] 时，它就可以工作了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T16:56:15.473

如果您希望避免使用硬编码字符串，可以使用：

```
protected T GetProperty<T>(MethodBase getMethod)
{
    if (!getMethod.Name.StartsWith("get_")
    {
        throw new ArgumentException(
            "GetProperty must be called from a property");
    }
    return GetValue<T>(getMethod.Name.Substring(4));
} 
```

添加更多您认为合适的健全性检查

然后财产变得

```
public int Foo
{
    get { return GetProperty<int>(MethodInfo.GetCurrentMethod()); }     
} 
```

设置以同样的方式变化。

GetCurrentMethod() 也遍历堆栈，但通过依赖堆栈标记的（内部）非托管调用来执行此操作，因此也可以在发布模式下工作。

或者，对于使用 MethodImplAttributes.NoOptimization) 或 MethodImplAttributes.NoInlining 的快速修复 [MethodImpl] 也可以工作，尽管性能会受到影响（尽管每次该命中可以忽略不计时，您都在遍历堆栈帧）。

另一种获得某种程度的编译时检查的技术是：

```
public class PropertyHelper<T>
{
    public PropertyInfo GetPropertyValue<TValue>(
        Expression<Func<T, TValue>> selector)
    {
        Expression body = selector;
        if (body is LambdaExpression)
        {
            body = ((LambdaExpression)body).Body;
        }
        switch (body.NodeType)
        {
            case ExpressionType.MemberAccess:
                return GetValue<TValue>(
                    ((PropertyInfo)((MemberExpression)body).Member).Name);
            default:
                throw new InvalidOperationException();
        }
    }
}

private static readonly PropertyHelper<Xxxx> propertyHelper 
    = new PropertyHelper<Xxxx>();

public int Foo
{
    get { return propertyHelper.GetPropertyValue(x => x.Foo); }     
} 
```

其中 Xxxxx 是定义属性的类。如果静态性质导致问题（线程或以其他方式使其成为实例值也是可能的）。

我应该指出，这些技术真的是为了利益，我并不是说它们是很好的通用技术。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T17:44:37.010

您可以尝试创建一个 T4 模板文件，以便可以使用正确的属性名称为 GetProperty() 和 SetProperty() 方法自动生成您的属性。

[T4：文本模板转换工具包](http://www.olegsych.com/2007/12/text-template-transformation-toolkit/) [T4（文本模板转换工具包）代码生成 - 最佳保留 Visual Studio 秘密](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx)

# workflow - 开发自己的工作流程

> ID：557650
> 
> 赞同：0
> 
> 时间：2009-02-17T16:34:14.747
> 
> 标签：workflow, jbpm

我在一家想要开发自己的工作流程的企业实习，但他们只对“时间管理”感兴趣..我现在正在了解 jBoss jbpm 那么您对此有何看法？我可以从哪里开始这个项目？谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-11-16T11:04:18.003

这个问题是在征求意见吗？

当然，用于开发和托管工作流的最佳平台和工具相对依赖于相关企业、它们维护和支持此类系统的能力等，不是吗？

例如，许多大型企业在微软平台上投入巨资，这也意味着他们拥有更多支持这些平台和服务的经验。因此，考虑到这一点，并且出于可维护性、可支持性的考虑，我会选择 Windows Workflow Foundation，它非常全面并且非常容易集成到 Microsoft 平台中。

如果您打算开始研究 WWF，那么我绝对可以推荐 Pro WF，由 Bruce Bukovics 编写并由 Apress 出版 (http://www.amazon.co.uk/Pro-WF-Windows-Workflow-NET/dp/ 1430227214/ref=sr_1_1?ie=UTF8&qid=1289905106&sr=8-1)

如果您要走 JBoss jBPM 路线，那么会有一个专门的站点专门介绍它 - 包括文档、用户和开发人员论坛，以及一个充满有用信息的 wiki。(http://jboss.org/jbpm)

首先要了解环境、业务流程以及用户与这些流程交互的方式。只有这样，您才能真正开始设计有用的工作流程。

# php - 如何检查服务器是否正在执行 PHP 脚本？

> ID：557653
> 
> 赞同：2
> 
> 时间：2009-02-17T16:35:29.063
> 
> 标签：php

我正在运行一个需要将数据写入缓存的 cronjob。我想把这个 cronjob 放在我的私人文件夹中，但是，即使在私人文件夹中对缓存文件夹进行 CHMOD 后，它也没有获得写入权限。这似乎是某种 plesk 功能。

所以，现在我已将 cronjob 放在公用文件夹中。但是，我需要确保只有服务器可以执行脚本。cronjob 顶部的以下内容呢？

```
if ($_SERVER['SERVER_ADDR'] != $_SERVER['REMOTE_ADDR']) die(); 
```

这似乎有效。但是，它是否不可利用，例如。用户可以将他的 remote_addr 操作到我的服务器吗？或者有没有更好的方法来检查这个？

我遇到的另一个问题是上面的代码返回了 2 个警告，即使它似乎确实有效：

```
PHP Notice:  Undefined index:  SERVER_ADDR in ... on line 2
PHP Notice:  Undefined index:  REMOTE_ADDR in ... on line 2 
```

知道这是什么原因吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T16:57:41.040

通过控制台而不是 Web 服务器执行脚本。

cron 可能如下所示：

```
*/5 * * * * php -f /path/to/cron.php 
```

然后文件可以这样做：

```
cron.php:
<?php

if ( array_key_exists('REMOTE_ADDR', $_SERVER) )
    die("Can only be run from the command line!"); 
```

这将保证它只由服务器运行。

**根据评论进行编辑**

通常，您无法访问私有文件夹内的公用文件夹，并且如果您无法在 Web 根目录之外添加新目录，则必须以另一种方式保护您的缓存目录。

我将假设您的所有文件都在网络根目录中，即：`/home/site/publichtml`. 将其替换为您的目录。

创建一个新目录`/home/site/publichtml/.cache`。将以下内容添加为 .htaccess 文件：

```
Deny from all 
```

现在您的脚本应该能够从文件系统访问该文件夹，但无法通过 Web 服务器访问该文件夹。

如果您可以在服务器上设置一个 cron 作业（通过网络管理员或其他方式，听起来您可以）按照上面的方式进行操作，即：`php -f /home/site/publichtml/cron.php`用作命令，并包括对数组键的检查。

或者，您可以像这样检查：

```
if ( !isset($_SERVER['argc']) )
    die("Must be run from the command line!\n"); 
```

`$_SERVER['argc']`仅在从命令行执行脚本时设置。

如果您可以将 cron 脚本保留在 Web 根目录之外，那就太好了。如果没有，那应该是安全的。

最后，要摆脱 E_NOTICES，将其添加到 cron.php 的顶部：

```
error_reporting(E_ALL ^ E_NOTICE); // Turn off notices 
```

或者

```
error_reporting(0); // Hide all error reporting 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T16:43:23.367

首先，我会将可执行的 PHP 脚本保存在只能由特权用户执行的私有目录中 - 并将其安排在该用户的 cron 中。执行脚本应该没有问题。

其次，您可以更改将缓存数据写入公共目录的位置。最好将其保存在非公共目录中，但如果您无法弄清楚如何做到这一点，并且数据可以公开，那么可能还可以。

最后，使用 $_SERVER['SERVER_ADDR'] 和 $_SERVER['REMOTE_ADDR'] 可能不是检查服务器是否正在运行脚本的最佳方法。一方面，我相信在运行命令行 PHP 脚本时不会设置 $_SERVER['REMOTE_ADDR']。这是从 HTTP 头中获取的，因为没有，所以它是空的。事实上，这就是您收到警告的原因 - 这些没有设置。（编辑：查看 PHP 文档，很可能不会为非浏览器脚本设置“SERVER_ADDR”变量）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T17:32:29.473

我认为答案隐藏在乔恩的第一个回复中。

因此，如果您只想通过 cron 访问此脚本，请检查会话超全局变量是否存在：

```
if (is_array($_SESSION)) die(); 
```

而且，仅仅因为它很容易，创建一个`.htaccess`文件并拒绝所有。

我将 $_SESSION 拼写为 $_SERVER，我的错。这可以满足您的需求。

# inversion-of-control - 我应该让 IUnityContainer 对象使用单例模式吗？

> ID：557657
> 
> 赞同：1
> 
> 时间：2009-02-17T16:36:17.237
> 
> 标签：inversion-of-control, singleton, unity-container

我是使用 Unity 和 IoC/DI 概念的新手。[我通过dnrTV](http://www.dnrtv.com/default.aspx?showNum=126)上的James Kovacs 的节目在测试中推出了我自己的概念，从而开始了这个概念。

他的示例将容器作为单例运行，通过 IoC 类中的静态方法访问，因此您可以在启动时注册类型并在整个应用程序中解析类型。

我知道这不是全功能，主要是展示 IoC 的概念。

我现在正在尝试在项目中使用 Unity。

在我的 Main() 中，我创建了一个新容器，但是一旦我的 WinForms 打开，该容器就会超出范围并被处置。稍后在程序中，当我尝试解析类型时，我不再拥有原始容器及其注册类型。

是否有我缺少的概念或实现结构？

我目前的想法是创建这样的东西：

```
public static class Container
{
    private static readonly object syncRoot = new object();
    private static volatile IUnityContainer instance;

    public static IUnityContainer Instance
    {
        get
        {
            if (instance == null)
            {
                lock (syncRoot)
                {
                    if (instance == null)
                    {
                        instance = new UnityContainer();
                    }
                }
            }
            return instance;
        }
    }
} 
```

我很确定这会奏效，只是看起来不对。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T07:44:50.680

出于同样的原因，我使用静态类 - 以避免它超出范围。

我对您所做的一个区别是我包装了所有统一调用并添加检查以查看是否已配置统一，您将在此处看到：

```
using System.Configuration;
using Microsoft.Practices.Unity;
using Microsoft.Practices.Unity.Configuration;

namespace Utilities
{
    public static class ServiceLocator
    {
        private static IUnityContainer container = new UnityContainer();
        private static bool isConfigured;

        public static void Clear()
        {
            container = new UnityContainer();
        }

        private static IUnityContainer Container
        {
            get
            {
                if (!isConfigured)
                {
                    ConfigureContainer();
                }
                return container;
            }
        }

        public static T Resolve<T>()
        {
            return Container.Resolve<T>();
        }

        public static T Resolve<T>(string name)
        {
            return Container.Resolve<T>(name);
        }

        public static void AddInstance<T>(object instance)
        {
            Container.RegisterInstance(typeof (T), instance);
        }

        private static void ConfigureContainer()
        {
                UnityConfigurationSection section = (UnityConfigurationSection) ConfigurationManager.GetSection("unity");
                section.Containers.Default.Configure(container);
                isConfigured = true;        
        }
    }
} 
```

# .net - 如何将 .NET Compact Framework 作为智能设备 CAB 项目的一部分？

> ID：557661
> 
> 赞同：2
> 
> 时间：2009-02-17T16:37:32.193
> 
> 标签：.net, deployment, compact-framework

我正在开发一个 VS2008 智能设备应用程序，其中包括一个用于部署的智能设备 CAB 项目。我惊讶地发现这个安装程序项目在必要时没有安装 .NET Compact Framework。可以这样做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T04:03:49.783

没有办法让 CAB 项目安装和运行另一个 CAB 文件 - 这是 CAB 安装程序系统的限制（确切地说是 wceload）。实现它的一种方法是包含 CF CAB，然后创建一个[自定义安装 DLL](http://msdn.microsoft.com/en-us/library/aa924308.aspx)，在内部 CAB 解包后扩展它。当然，CAB 项目无法正确更新 INF 文件以运行自定义安装 DLL，因此您必须使用[CABWIZ](http://msdn.microsoft.com/en-us/library/aa448616.aspx)手动构建 CAB 。

不用说，整个 CAB 安装程序架构还有一些不足之处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-11T11:57:10.510

可以通过一些工作来完成。请参阅codeproject.com[中的自动将多个 CAB 文件安装到 Windows Mobile/Pocket PC 设备](http://www.codeproject.com/Articles/65319/Automatically-Install-Multiple-CAB-Files-to-a-Wind)

# jsf - JSF：在启动 2 个应用程序实例时避免会话范围的变量冲突

> ID：557662
> 
> 赞同：1
> 
> 时间：2009-02-17T16:37:36.140
> 
> 标签：jsf

我有一个 JSF 应用程序，它大量使用了会话范围的变量。一个新的要求是用户应该能够打开N个应用程序。但是，由于大部分状态是会话范围的，因此当客户端打开应用程序的第二个实例时，来自第一个应用程序的视图数据会流入新打开的应用程序。

此时，将所有会话范围的 bean 更改为请求范围的 bean 将非常困难。有没有办法在更高级别上解决这个问题，可能通过将外部（客户端）会话与一个或多个内部（由 JSF 人工创建和使用）会话对象映射？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T19:34:33.977

你真的需要直接使用会话对象吗？为什么没有会话范围的 Map，将唯一的“子会话”ID 映射到子会话属性的 Maps？不利的一面是，您需要在每个页面上包含子会话 ID 作为隐藏参数，该参数包含在每个客户端请求中，并且会话属性的所有 EL 都需要类似于“#{subSession.mySubSessionId .myAttribute}”。您可能会遇到其他问题，因为重定向或浏览器刷新可能会破坏您的子会话 ID。

总的来说，我会寻找一个框架解决方案。框架解决方案的错误更少的可能性更大，这也意味着您需要创建和维护的代码更少。当这种性质的细节为您处理好后，专注于实际的应用程序开发会容易得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:26:55.533

有一些框架可以为您解决此问题，但我不确定采用新框架是否是可接受的解决方案。

Seam 提供了基于对话的范围的概念，它可能会做你需要它做的事情。我也知道 Spring 具有等效的范围。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T18:04:13.593

您可以控制如何通过[FacesContextFactory](http://java.sun.com/javaee/5/docs/api/javax/faces/context/FacesContextFactory.html)（它提供包含*ExternalContext的**FacesContext*）将会话提供给 JSF 应用程序。这需要在*faces-config.xml*中进行配置，以便 JSF 可以在初始化期间获取它。如果您使用*MyFacesConfigFactory(FacesConfigFactory)*形式的构造函数， JSF 将传递先前配置的工厂，允许您装饰底层实现。

 ***您可能会遇到的一些问题：

*   您需要控制“打开应用程序”的含义才能创建子会话。例如，创建子会话的表单。
*   您需要一些机制来匹配请求与您的会话 - 可能是通过[ExternalContext](http://java.sun.com/javaee/5/docs/api/javax/faces/context/ExternalContext.html) URL 编码方法（需要认真使用；表现良好的组件已经使用这些方法）。
*   你需要一整层会话管理代码——我正在考虑人们通过打开应用程序的多个“实例”来创建巨大的 HTTP 会话。
*   可能有很多边缘条件和其他我没有想到的东西。

这是解决问题的一种有趣方法，但我不希望它是一个快速解决方案。

# java - 从泛型基接口的实例中检索类型参数

> ID：557663
> 
> 赞同：20
> 
> 时间：2009-02-17T16:37:47.983
> 
> 标签：java, generics, reflection

给定2个接口：

```
public interface BaseInterface<T> { }
public interface ExtendedInterface<T0, T1> extends BaseInterface<T0> {} 
```

和一个具体的类：

```
public class MyClass implements ExtendedInterface<String, Object> { } 
```

如何找出传递给 BaseInterface 接口的类型参数？

（我可以通过调用类似的东西来检索 ExtendedInterface 类型参数

```
MyClass.class.getGenericInterfaces()[0].getActualTypeArguments() 
```

但我找不到一种简单的方法来递归到任何基本的通用接口并得到任何有意义的东西）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-21T15:07:41.520

这个问题一般不容易完全解决。例如，如果它是一个内部类，你还必须考虑包含类的类型参数，......

因为仅使用 Java 本身提供的反射泛型类型非常困难，所以我编写了一个库来完成这项艰巨的工作：gentyref。请参阅[http://code.google.com/p/gentyref/](http://code.google.com/p/gentyref/) 对于您的示例，使用 gentyref，您可以执行以下操作：

```
Type myType = MyClass.class;

// get the parameterized type, recursively resolving type parameters
Type baseType = GenericTypeReflector.getExactSuperType(myType, BaseInterface.class);

if (baseType instanceof Class<?>) {
    // raw class, type parameters not known
    // ...
} else {
    ParameterizedType pBaseType = (ParameterizedType)baseType;
    assert pBaseType.getRawType() == BaseInterface.class; // always true
    Type typeParameterForBaseInterface = pBaseType.getActualTypeArguments()[0];
    System.out.println(typeParameterForBaseInterface);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T17:45:24.030

我不知道你到底想要实现什么，什么是已知的，什么是未知的，但你可以像这样递归到超级接口：

```
Type[] interfaces = MyClass.class.getGenericInterfaces();

ParameterizedType extInterfaceType = (ParameterizedType)interfaces[0];
Class<?> extInterfaceClass = (Class<?>)extInterfaceType.getRawType();

Type[] baseInterfaces = extInterfaceClass.getGenericInterfaces();
ParameterizedType baseInterfaceType = (ParameterizedType)baseInterfaces[0];
Class<?> baseInterfaceClass = (Class<?>)baseInterfaceType.getRawType(); 
```

当然，如果您以这种方式达到第二级，则只能将您的名称 T0 和 T1 作为通用参数。如果您知道两者之间的关系`ExtendedInterface`，`BaseInterface`那么您实际上不必走那么远，因为您知道前者的哪个通用参数被传递给后者。如果没有，您可能必须遍历它们的参数并找到匹配项。基于此的东西可能：

```
Type[] params = extInterfaceClass.getTypeParameters();
for (Type param : params) {
    if (param == baseInterfaceType.getActualTypeArguments()[0]) {
        // ...
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-10-11T17:55:14.520

使用 Java 反射 API 很难解决这一问题，因为需要解析所有遇到的类型变量。Guava 自 12 版以来具有包含完全解析的类型信息的[TypeToken类。](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/reflect/TypeToken.html)

对于您的示例，您可以执行以下操作：

```
TypeToken<? extends T> token = TypeToken.of(MyClass.class);
ParameterizedType type =
    (ParameterizedType) token.getSupertype(BaseInterface.class).getType();
Type[] parameters = type.getActualTypeArguments(); 
```

您仍然需要记住，这仅适用于 MyClass 本身不是通用的情况。否则，由于类型擦除，类型参数的值在运行时不可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T17:57:17.183

我认为没有*直接*的方法可以获取基本接口的泛型类型。

一种方法是在接口中声明一个方法，如下所示：

```
public interface BaseInterface<T> {
    Class<T> getGenericClass();
} 
```

另外，我不知道您对这些课程有什么样的控制权。您始终可以断言所有实现者都具有显式声明的基本接口，如下所示：

```
public class MyClass implements ExtendedInterface<String, Object>, BaseInterface<String>{ } 
```

和

```
MyClass.class.getGenericInterfaces()[1].getActualTypeArguments()[0] 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T12:45:00.683

这*有点*像你所追求的，但它仍然不对。例如，它不处理`Foo<T> implements Bar<Map<T>>`. 你真正需要的是某种方式来询问 jvm “好的，这是一个类型列表。如果我将这些应用于这个泛型类型，我会得到什么实际类型？”

但是，这段代码有点像你所追求的。

```
import java.lang.reflect.GenericDeclaration;
import java.lang.reflect.ParameterizedType;
import java.util.*;

interface BaseInterface<T> {}
interface FirstArg<T1,T2> extends BaseInterface<T1>{}
interface SecondArg<T1,T2> extends BaseInterface<T2>{}

class First implements FirstArg<Number, String> {}
class Second implements SecondArg<Number, String> {}

public class Example {
    public static void main(String[] av) {
        new Example().go();
    }

    void go() {
        test(First.class);
        test(Second.class);
    }

    void test(Class<?> c1) {        
        ParameterizedType t2 = (ParameterizedType) c1.getGenericInterfaces()[0];
        System.out.println(c1 + " implements " + t2 );

        Class<?> c2 = (Class<?>)t2.getRawType();
        GenericDeclaration g2 = (GenericDeclaration) c2;

        System.out.println(t2 + "  params are " + Arrays.asList(g2.getTypeParameters()));

        System.out.println("So that means");
        for(int i = 0; i<t2.getActualTypeArguments().length; i++) {
            System.out.println("Parameter " + c2.getTypeParameters()[i] + " is " + t2.getActualTypeArguments()[i]);
        }

        ParameterizedType t3 =  (ParameterizedType) c2.getGenericInterfaces()[0];
        System.out.println(t2 + "  implements " + t3);

        System.out.println("and so that means we are talking about\n" + t3.getRawType().toString() + " <");
        for(int i = 0 ; i< t3.getActualTypeArguments().length; i++) {
            System.out.println("\t" + t3.getActualTypeArguments()[i] + " -> " 
            + Arrays.asList(g2.getTypeParameters()).indexOf(t3.getActualTypeArguments()[i])
            + " -> " + 
            t2.getActualTypeArguments()[Arrays.asList(g2.getTypeParameters()).indexOf(t3.getActualTypeArguments()[i])]
            );
        }

        System.out.println(">");
        System.out.println();
    }

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T17:15:17.470

我不认为你可以，因为这些是特定于实例而不是特定于类的。考虑以下：

```
List<String>  a = new ArrayList<String>(); 
```

a 是字符串的通用列表这一事实特定于实例 a 而不是类 List。因此，List.class 对象的任何方法都不能告诉您泛型类型将是 a 的 String 类型。尽管您的示例中的 MyClass 恰好为接口的通用类型设置了值，但我认为这在接口 Class 对象实例中不可用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T17:28:56.160

我想到我能想到的唯一选择是检查一个由 声明的泛型方法`BaseInterface`，而不是被覆盖。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T23:00:59.697

我再次回答我自己的问题时不礼貌。

正如 gix 指出的那样，当您开始遍历泛型类型的层次结构时，除了第一个之外，您会丢失有关类型参数的信息。

但重要的一点是：您获得了第一个要实例化的通用接口的类型参数（在我的示例中，ExtendedInterface），您还获得了用于创建子接口的类型参数的名称。

因此，可以通过将 TypeVariable 名称映射到实际类型参数来确定基本接口的类型参数。

稍后我将更新一些代码，但它确实有效（您可以从 MyClass.class 中确定用于实例 BaseInterface 的类型参数）。

**更新** 这是第一次通过，为一些简单的单元测试开了绿灯。它需要工作......真正的问题是，这个问题值得这样荒谬的解决方案吗？

```
public class GenericReflectionUtils
{
@SuppressWarnings("unchecked")
public static List<Class> getGenericInterfaceTypeArguments(Class baseInterface, Class concreteClass)
{
    if (!baseInterface.isAssignableFrom(concreteClass))
    {
        throw new IllegalArgumentException("Illegal base interface argument");
    }
    if (concreteClass.getTypeParameters().length > 0)
    {
        throw new IllegalArgumentException("Can't determine the type arguments of a generic interface of a generic class");
    }
    for (Type genericInterface : concreteClass.getGenericInterfaces())
    {
        List<Class> result = null;
        if (genericInterface instanceof Class)
        {
            result = getGenericInterfaceTypeArguments(baseInterface,(Class)genericInterface);
        }
        else
        {
            result = getGenericInterfaceTypeArguments(baseInterface, (ParameterizedType)genericInterface);
        }
        if (result != null)
        {
            return result;
        }
    }
    return null;
}

public static Class getClass(Type type)
{
    if (type instanceof Class)
    {
        return (Class) type;
    }
    if (type instanceof ParameterizedType)
    {
        return getClass(((ParameterizedType) type).getRawType());
    }
    if (type instanceof GenericArrayType)
    {
        Type componentType = ((GenericArrayType) type).getGenericComponentType();
        Class<?> componentClass = getClass(componentType);
        if (componentClass != null)
        {
            return Array.newInstance(componentClass, 0).getClass();
        }
        return null;
    }
    return null;
}

@SuppressWarnings("unchecked")
private static List<Class> getGenericInterfaceTypeArguments(Class baseInterface, ParameterizedType currentType)
{
    Class currentClass = getClass(currentType);
    if (!baseInterface.isAssignableFrom(currentClass))
    {
        //  Early out - current type is not an interface that extends baseInterface
        return null;
    }

    Type[] actualTypeArguments = currentType.getActualTypeArguments();

    if (currentClass == baseInterface)
    {
        //  currentType is a type instance of the base generic interface. Read out the type arguments and return 
        ArrayList<Class> typeArgs = new ArrayList<Class>(actualTypeArguments.length);
        for (Type typeArg : actualTypeArguments)
        {
            typeArgs.add(getClass(typeArg));
        }

        return typeArgs;
    }

    //  currentType is derived
    Map<String, Class> typeVarMap = createTypeParameterMap(currentType, null);

    for (Type genericInterfaceType : currentClass.getGenericInterfaces())
    {
        List<Class> result = getGenericInterfaceTypeArguments(baseInterface, (ParameterizedType)genericInterfaceType, typeVarMap);
        if (result != null)
        {
            return result;
        }
    }
    return null;
}

private static Map<String, Class> createTypeParameterMap(ParameterizedType type, Map<String, Class> extendedTypeMap)
{
    Map<String, Class> typeVarMap = new HashMap<String, Class>();
    Type[] typeArgs = type.getActualTypeArguments();
    TypeVariable[] typeVars = getClass(type).getTypeParameters();
    for (int typeArgIndex = 0; typeArgIndex < typeArgs.length; ++typeArgIndex)
    {
        //  Does not deal with nested generic arguments...
        Type typeArg = typeArgs[typeArgIndex];
        if (typeArg instanceof TypeVariable)
        {
            assert extendedTypeMap != null;
            TypeVariable typeVar = (TypeVariable)typeArg;
            typeVarMap.put(typeVars[typeArgIndex].getName(), extendedTypeMap.get(typeVar.getName()));
            continue;
        }
        typeVarMap.put(typeVars[typeArgIndex].getName(), getClass(typeArgs[typeArgIndex]));
    }

    return typeVarMap;
}

private static List<Class> createTypeParameterList(Map<String, Class> typeParameterMap, ParameterizedType type)
{
    ArrayList<Class> typeParameters = new ArrayList<Class>(typeParameterMap.size());
    for (Type actualType : type.getActualTypeArguments())
    {
        if (actualType instanceof TypeVariable)
        {
            //  Handles the case when an interface is created with a specific type, rather than a parameter
            typeParameters.add(typeParameterMap.get(((TypeVariable)actualType).getName()));
            continue;
        }
        typeParameters.add(getClass(actualType));
    }
    return typeParameters;
}

@SuppressWarnings("unchecked")
private static List<Class> getGenericInterfaceTypeArguments(Class baseInterface, ParameterizedType currentType, Map<String, Class> currentTypeParameters)
{
    Class currentClass = getClass(currentType);
    if (!baseInterface.isAssignableFrom(currentClass))
    {
        //  Early out - current type is not an interface that extends baseInterface
        return null;
    }

    if (currentClass == baseInterface)
    {
        return createTypeParameterList(currentTypeParameters, currentType);
    }

    currentTypeParameters = createTypeParameterMap(currentType, currentTypeParameters);
    for (Type genericInterface : currentClass.getGenericInterfaces())
    {
        List<Class> result = getGenericInterfaceTypeArguments(baseInterface, (ParameterizedType)genericInterface, currentTypeParameters);
        if (result != null)
        {
            return result;
        }
    }

    return null;
} 
```

}

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-15T18:45:03.207

Apache Commons 有一个实用程序可以做到这一点...... [https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/reflect/TypeUtils.html](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/reflect/TypeUtils.html)

在他们的 github 页面上查看它是如何使用的：[https ://github.com/apache/commons-lang/blob/72be39f4facb4a5758b9f646309328b764216da3/src/test/java/org/apache/commons/lang3/reflect/TypeUtilsTest.java](https://github.com/apache/commons-lang/blob/72be39f4facb4a5758b9f646309328b764216da3/src/test/java/org/apache/commons/lang3/reflect/TypeUtilsTest.java)

# silverlight - 如何在 Silverlight 的 ComboBox 中模拟“AppendDataBoundItems”？

> ID：557664
> 
> 赞同：1
> 
> 时间：2009-02-17T16:38:29.087
> 
> 标签：silverlight, data-binding, combobox

在 Asp.Net Combobox 中，有一个有用的属性 ，`AppendDataBoundItems`它会导致绑定到控件的任何项目实际附加到任何“静态”添加的广告设计时间。这对于用户可以在可用项目中没有项目满足条件时指定的“默认”值或指定特殊的“空值”项目很有用。

不幸的是，Silverlight ComboBox 中没有这样的属性，也无法在控件被数据绑定时得到通知。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T16:43:37.953

您可以通过覆盖 ComboBox 模板来做一些事情。但是，Silverlight 组合框存在许多问题，因为它是一个不成熟的组件。您最好实现自己的组合框（或使用在 Internet 上找到的实现之一）并自己编写此行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-11T23:18:16.733

就在最近几天，对于非强制性的组合框，我遇到了同样的问题。我处理它的方法是在说“Salutations”的集合中添加一个空值，例如“先生”、“小姐”等等。

好的，我的解决方案很丑，但它可以工作。理想情况下，我希望有一个 T 类型的可绑定对象来包装 ObservableCollection。但与往常一样，我们在这里有巨大的时间压力，这暂时可以。

向 ObservableCollection 添加了 SalutationDTO，如下所示。

```
 public static void EnableNullableSalutationChoice(this ObservableCollection<SalutationDTO> salutations)
{
  salutations.Insert(0, NullSalutationChoice);
}

    public static SalutationDTO NullSalutationChoice
{
  get
  {
    return new SalutationDTO {Salutation = " ", SalutationID = null};
  }
} 
```

# java - 如何在 IoC 容器外进行简单的 Spring JDBC 事务？

> ID：557667
> 
> 赞同：5
> 
> 时间：2009-02-17T16:38:57.900
> 
> 标签：java, jdbc, transactions, data-access, spring-jdbc

我正在处理的项目在其所有样板荣耀中使用直接 JDBC 数据访问，并且不使用任何事务。我觉得使用事务和简化数据访问方法的编写方式很重要，尤其是当前正在进行一些更改。该项目已经存在了很长一段时间，不适合 ORM 框架。它还使用了很多单例（呃），并且解开它以使其能够使用依赖注入将是相当多的工作，我认为我无法说服任何人我们现在应该这样做。

我喜欢 Spring JDBC 的接口，特别是通过它的`SimpleJdbcTemplate`. 我的问题是如何为此启用一些简单的（每个 servlet 请求）事务，而无需在每个数据访问方法中以编程方式设置任何内容或使用 Spring IoC 容器或 AOP。我玩弄了自己的架构，最终得到一个类似于 's 的接口，并且当在请求的上下文中调用它时（通过 a和 a ）`SimpleJdbcTemplate`，可以使用单个请求本地连接和事务。它似乎工作得很好，但我认为使用像 Spring JDBC 这样的好的外部库会更好。`ServletRequestListener``ThreadLocal`

有人对此有经验吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T17:01:32.963

也许您可以使用[TransactionTemplate](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/transaction/support/TransactionTemplate.html)和[TransactionCallback](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/transaction/support/TransactionCallback.html)，如[Programmatic Transaction Management](http://static.springframework.org/spring/docs/2.5.x/reference/transaction.html#transaction-programmatic)中所述？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T20:56:47.297

Spring 以声明方式为您处理事务，而您不必担心编写 AOP 类。[如果您使用的是 JDK 5 或更高版本以及 Spring 2.5，则使用annotations](http://static.springframework.org/spring/docs/2.5.x/reference/new-in-2.html#new-in-2-middle-tier-transaction-configuration)会更好。

我不同意每个 servlet 事务。您应该有一个服务层，它是应用程序中了解工作单元的部分。控制器调用处理事务的服务。

# multithreading - 如何在模型和视图之间共享数据？

> ID：557675
> 
> 赞同：0
> 
> 时间：2009-02-17T16:42:32.993
> 
> 标签：multithreading, mvvm, data-modeling

我目前正在重新设计一个应用程序，该应用程序正在从输入数据构建模型，并将该数据显示给用户。当前系统具有用于构建模型的线程、用于构建模型的可视化的线程和显示可视化的线程。我遇到的问题是指针在建模和可视化线程之间传递——为了使线程安全，模型中的所有对象都必须有一个互斥体。这意味着系统中有数千个互斥锁处于活动状态，由于两个线程都在争夺资源，因此会出现很多停顿。

那么，鉴于这三个线程将存在，以高效和线程安全的方式在建模和可视化线程之间共享数据的最佳方式是什么？一些数据结构很大并且会改变建模线程的每个周期，所以我有点不愿意每次都复制数据。

编辑：

我们希望通过系统的总延迟是从接收消息到显示显示变化的显示大约 100 毫秒。如果可能的话，我们希望它更快，但更重要的是我们需要它保持一致 - 现在我们看到由于互斥体争用导致循环时间的巨大变化。从建模到可视化的数据以 2D 高度图为主——大约 18000 个单元格的数据。不过，模型更新中实际更新的单元数量要少得多——可能只有几百个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T16:57:36.733

我是消息发布/消息泵架构的忠实粉丝。这是 MFC/Win32 提供的用于在线程之间传递数据的主要方法。这种架构是由线程消息驱动的事件，因此当接收线程正在处理线程消息时，它正在处理为线程之间的通信显式更新的数据（参见下面的示例）。

您可以自己实现这一点，并将锁定本地化到每个线程的单独线程消息列表。因此，当一个线程想要向另一个线程发送消息时，您大致执行以下操作

```
PostThreadMessage(msg, void* param, int paramSize)
{
    lock(msgQueueLock);

    // may wish to copy param
    char paramCpy = malloc
    msgQueue.Queue(msg, pparam, paramSize); 

    unlock(msgQueueLock);
} 
```

那么任何线程的主循环就是

```
// thread's msg pump
while (1)
{
    // can also use condition var to wait for queue to change...
    lock(msgQueueLock);
    HandleMsgLocally(msgQueue.Deque())
    unlock(msgQueueLock);
} 
```

无论如何，回到 MVC，如果您的模型发生变化，它可以发布到您的视图以更新特定字段，如下所示：

```
// Well known msg name
int msgName = MODEL_FIELD_A_UPDATED

...

void Model::UpdateFieldA(int newVal)
{
    int* valToCommunicate = new int(newVal)
    PostThreadMessage(MODEL_FIELD_A_UPDATED, valToCommunicate, sizeof(int))
}

...
void HandleMsgLocally(...void * param,)
{
    if (msg == MODEL_FIELD_A_UPDATED)
    {
       int* val = reinterpret_cast<int*>(param);
       //... process param
       delete val;
    }
} 
```

优点是您可以本地化您的锁定。这是巨大的。此外，只要参数被发送者明确理解为新的并被接收者删除，您就不必担心访问共享内存。

这有很多缺点，延迟就是其中之一。如果您需要立即知道发生了什么变化，那么您需要实际制作共享数据并考虑最佳锁定方案。如果您确实需要一个可以随时从多个方向更新的全局状态，那么在我的书中这种情况下单例就可以了。这种设计真的最适合单向的数据，你可以进入竞争条件。但是，您也可以实现锁定 getter 以供一个线程从另一个线程进行检查，但要设置您必须发布的值。有很多变量需要考虑，但希望这可能对您有所帮助。此外，您可能会忘记删除消息中的参数。

**更新基于编辑** 根据您的信息，根据数据量，发布可以很好地工作。分析您的代码很重要。如果我是你，我会玩一些概念证明并切换到使用条件变量来管理同步性。如果您在 Windows 平台上，请务必使用他们的消息泵。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T17:07:45.383

我已经评论了在没有您提供更详细数据的情况下以任何有意义的方式回答这个问题的困难，但无论如何这里有两个提示：

*   不要过于频繁地更新可视化。根据可视化的复杂性，您应该将显示限制为每秒 3 或 5 次更新，因此如果您的建模线程进展得更快，则不要显示每次迭代。您可以让可视化线程每 x 毫秒请求一次新数据，或者您可以让建模线程在完成后请求新的可视化，并且自上次可视化以来已经过去了足够的时间。

*   如果可以避免，请不要使用锁定。使用指向不可变数据的共享指针消除了很多线程争用，因为您不需要锁定对象（所有访问都是只读的）。通过细粒度的类设计，您还将限制将数据复制到那些真正从一个建模循环到下一个建模循环变化的部分。然而，这可能需要对您当前的设计进行大量更改。不过，我发现这真的很值得。

**编辑：**编辑后，我更建议尽可能消除锁定，因为您希望尽可能快地显示大量数据，但可能只更改总数据的 5%。

如果您将算法从更改单元格修改为基于修改后的数据创建新单元格，并且您根本不修改模型，而是通过仅将智能指针复制到未修改的单元格并创建新的单元格对象来创建新模型其余的，那么您将不需要对数千个对象中的任何一个进行任何锁定。完成的模型可以传递给可视化线程，并且可以立即创建一个新模型。类似地，对于可视化线程和它从模型创建的对象 - 它可以传递给 GUI 线程，并从当前模型创建一个新对象。一些细胞将是几个模型的一部分，一些细胞将是一个模型的一部分。用于创建可视化和呈现到输出显示的对象也可以共享单元格。

程序中唯一保留的锁定是每个线程一个顶级锁定，以同步对当前模型（或其他类似的顶级对象）的访问。由于执行的操作将非常短，因此延迟应该不再是问题。除此之外，这种设计将最大限度地利用多个处理器或内核，但会消耗更多的内存和更多的 CPU 周期。然而，这是使软件在当前和未来硬件上更好地运行的最佳方法，这些硬件正变得越来越并行。

# objective-c - 更改 Objective-C 对象的 isa 是否已定义行为？

> ID：557676
> 
> 赞同：5
> 
> 时间：2009-02-17T16:42:55.037
> 
> 标签：objective-c, dynamic-typing

在 Objective-C 中，您可以在运行时通过分配对象的`isa`成员变量来更改对象的动态类型：

```
id object = ...;
object->isa = [SomeClass class]; 
```

这是未定义的行为吗？我目前正在这样做，因为它是为了做其他事情，它似乎正在工作，但我觉得这样做很肮脏。我设置的新类没有添加任何成员变量，它只是覆盖了一个方法并添加了一个新方法，因此类大小是相同的。我觉得如果我改变对象的大小，会导致很多问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-08-28T15:30:53.787

The Objective-C runtime now provides a function to do this: `object_setClass`. The documentation doesn't say what restrictions there are, but (as others have stated) I imagine you would want to restrict the new class to a class with exactly the instance variable layout as the original class.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T16:59:03.907

正如你所说，我认为这很脏。

我怀疑它会在以下情况下起作用：

*   新分配的类是真实类的子类。
*   新类不添加任何成员变量。

但我承认我不知道您的 Objective-C 运行时系统的具体实现。我只知道实施对我有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T05:05:30.303

改变这些真的很糟糕，而且它对运行时行为做出了各种各样的假设——尽管它们没有为您提供直接更改类的机制，但使用[运行时函数](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/ObjCRuntimeRef/Reference/reference.html)会更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-08T20:34:09.833

[Joshua Weinberg 的这个答案](https://stackoverflow.com/a/8512834/330914)提供了正确的方法。它对我有用。:)

Darron 的猜测是正确的 :) 只有当它是当前对象的超类并且不添加任何成员时，它才会起作用。

# regex - 正则表达式在行的特定列中查找数据

> ID：557682
> 
> 赞同：6
> 
> 时间：2009-02-17T16:45:21.007
> 
> 标签：regex, notepad++

我正在尝试在文档中搜索特定列的数据。我正在尝试使用：

```
^.{x}[data to find] 
```

其中 x 是我想要的列数 - 1。

我不确定我是否做错了什么，或者我的正则表达式引擎是否不支持该语法。如果有帮助，我正在尝试使用 Notepad++。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T17:56:17.607

2013-2014 年更新（4-5 年后）

正如[Alan Moore](https://stackoverflow.com/users/20938/alan-moore)在[评论中提到的](https://stackoverflow.com/questions/557682/regex-to-find-data-in-specific-column-of-a-line/557975?noredirect=1#comment35837800_557975)

> [Notepad++ v6.x](http://notepad-plus-plus.org/news/notepad-6.0-release.html)通过 PCRE 库提供真正的正则表达式支持

请参阅“[如何在 Notepad++ 中使用正则表达式（教程）](http://sourceforge.net/apps/mediawiki/notepad-plus/?title=Regular_Expressions#Multiplying_operators) ”（乘法运算符）

* * *

原始答案（2009 年 2 月）

我刚刚检查了最新的 Notepad++5.2 及其正则[表达式功能](http://sourceforge.net/apps/mediawiki/notepad-plus/index.php?title=Regular_Expressions)。

我确认它没有任何[重复运算符](http://www.regular-expressions.info/repeat.html) `{min,max}`可以让您指定令牌可以重复多少次。

![http://1.bp.blogspot.com/_RrGIVCQs3RU/SHbq1B0wYlI/AAAAAAAAALI/h21UEYMEivc/s400/np%2B%2Breplace.png](https://i.stack.imgur.com/cV4gh.png)

另一种选择是：

```
.... [repeat '.' as many time as the number of column you want] ...[data to find] 
```

您不需要`^`：默认情况下，Notepad++ 正则表达式逐行应用，并且`.`不匹配 eol 字符（`\r`或`\n`）

* * *

正如[Asmor](https://stackoverflow.com/users/18210/asmor)在评论中提到的：

> Notepad++ 的所有强大功能都使用了 Scintilla 并继承了 Scintilla 的正则表达式处理，但具有有限的[正则表达式功能](http://scintilla.org/SciTERegEx.html)。
> 
> 您说“默认”正则表达式是逐行应用的。这意味着您可以以其他方式设置它，但据我所知（我求求您，请证明我错了！），没有办法制作多行正则表达式。

（我同意，这是一个*主要*限制）

> Scintilla 的另一个限制是，`^`运算符实际上很重要，因为它将正则表达式锚定到行首。假设您想匹配第三列中的 3。您会想要`^..3`, 并且`..3`会`3`在第二个之后的任何列中匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T16:55:10.890

如果您可以访问它，Awk 更适合这种任务。

从我能找到的文档中看，notepad++ 似乎没有 {x} 功能。

# c - ELF 文件版本

> ID：557688
> 
> 赞同：1
> 
> 时间：2009-02-17T16:47:00.410
> 
> 标签：c, static-libraries, elf

我正在处理`elfdump`命令的克隆。

`elfdump -ecps *file*`在所有可执行文件上运行时，我的程序运行良好。但是，当我在库文件（例如 libc.so）上运行程序时，它会为 .symtab 部分中的所有符号打印出不正确的版本号（特别是它们都为零）。我已经查看了很多次文档，但我无法弄清楚为什么会发生这种情况。

有人可以提供一些提示吗？或者可能如何检测它是否是一个库，所以我可以硬编码一个 0？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:51:49.597

我相信，您可以通过检查 e_type 字段是否为 ET_DYN 来确定您是否正在针对共享库运行。（人精灵（5））

Ulrich Drepper有[一篇文章](http://lists.debian.org/lsb-spec/1999/12/msg00017.html)介绍了 ELF 中的 glibc 每符号版本控制技巧。也许那里有您以前没有遇到过的其他信息。linux 上的手册页似乎没有涵盖 ELF 文档中的每个符号版本信息。

# regex - 使用正则表达式限制响应中的单词数

> ID：557695
> 
> 赞同：14
> 
> 时间：2009-02-17T16:52:09.913
> 
> 标签：regex

有没有人有一个正则表达式可以限制响应中的单词数量？例如，我想将它与 jQuery validate 一起使用，这样我就可以限制文本框/文本区域说 250 个单词。这些框将是纯文本的。

我做了一些谷歌搜索，但我发现没有一个很好。他们主要集中在做 \b\w+\b 但我很难让它工作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-17T18:44:20.907

你能试试：

```
^(?:\b\w+\b[\s\r\n]*){1,250}$ 
```

这将限制为多行 250 个单词。

恐怕艾伦最初的主张：

```
/^\w+(?:\s+\w+){0,249}$/ 
```

可能是[**灾难性回溯的情况**](http://www.regular-expressions.info/catastrophic.html)

> 嵌套重复运算符时，请绝对确保只有一种方法可以匹配相同的匹配项

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T16:56:24.240

如何用正则表达式（比如“\s+”）分割文本，然后计算结果列表的长度？那会更容易阅读。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-09-15T21:20:12.250

这对我来说效果很好，例如，如果您想要 6 个字的限制：

```
^(?:\w+\W+){0,5}(?:\w+)$ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-21T14:26:22.513

这是我用于字数验证的正则表达式。

```
(\w*\W*){0,250} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-08-19T11:57:21.530

这对我有用：

```
^\W*(\w+(\W+|$)){1,250}$ 
```

# c# - 在 C# 中使用 OwnerDraw ListView 进行字符对齐

> ID：557699
> 
> 赞同：0
> 
> 时间：2009-02-17T16:53:08.833
> 
> 标签：c#, .net, controls, alignment, ownerdrawn

我正在尝试实现一个功能类似于 Firefox Awesome Bar 的 .NET 控件。为此，我试图在 ListView 中显示的搜索结果中加粗并加下划线搜索字符。我已经设置了 OwnerDraw，并且正在使用 Graphics.MeasureCharacterRanges 来确定字符的大小。我遇到的问题是从该方法传回的值并不总是完美的。我最终会在这里和那里有一些额外的像素或两个彼此太接近的字符。有简单的解决方法吗？另一种使用不同字体设置绘制同一个单词不同部分的方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T01:10:49.167

我想通了。我不得不改用 TextRenderer.DrawText 和 TextRenderer.MeasureText。我确保将 TextFormatFlags.NoPadding 传递给这两种方法。

# svn - 奇怪的 Apache2.2 SVN 错误，“预期的存储库格式 '3' 或 '5'；找到格式 '9'”

> ID：557701
> 
> 赞同：3
> 
> 时间：2009-02-17T16:53:19.910
> 
> 标签：svn, tortoisesvn, apache2, mod-dav-svn

我有一个我可以使用 TortoiseSVN 从运行 Subversion win32 服务的同一台计算机上访问的存储库，并且它已经工作了一段时间。我决定尝试设置 mod_dav_svn 以便能够从其他地方获取它。当我尝试访问它时，我在浏览器中收到此错误：

```
<D:error>
<C:error/>
<m:human-readable errcode="165005">
Could not open the requested SVN filesystem
</m:human-readable>
</D:error> 
```

...以及日志中的这些错误：

```
 (20014)Internal error: Expected repository format '3' or '5'; found format '9'
 Could not fetch resource information.  [500, #0]
 Could not open the requested SVN filesystem  [500, #165005]
 Could not open the requested SVN filesystem  [500, #165005] 
```

这是我的 .conf 中的内容：

```
LoadModule dav_module modules/mod_dav.so
LoadModule dav_svn_module modules/mod_dav_svn.so
LoadModule authz_svn_module modules/mod_authz_svn.so 
```

和

```
DAV svn
SVNPath e:/dev/.svn 
```

我放 /.svn 是因为在我这样做之前，我在客户端上收到了相同的错误文本（但代码为 720002），并且日志显示 Apache 正在寻找不存在的 e:/dev/format，但是e:/dev/.svn/format 可以。

看了[这篇](https://stackoverflow.com/questions/344691/subversion-expected-format-3-of-repository-found-format-5)，发现我的 subversion 是 1.5.1 和 1.5.5 已经出来了，而且我最近升级了 TortoiseSVN，我想可能有一些不兼容（这可能没有意义，我不知道它是怎么回事工作正常。）所以我下载了 1.5.5，停止服务，复制 DLL 和 EXE，重新启动服务，将新的 .so 文件复制到 Apache 的模块目录，然后重新启动 httpd。没运气。

有什么建议么？这种特殊的“格式 9”的东西似乎很少见……

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T17:07:15.167

请通过以下解释忍受我，它证明了我对您的问题的假设，并将为您提供一些关于 SVN 工作原理的见解：

在 subversion 中，您有 2 个包含文件的位置：存储库和工作副本。

存储库存储历史记录，您从存储库中签出工作副本中的工作并提交回存储库。

Svnervice 和 apache svn 都允许您公开存储库 Tortoise 允许您从公开的存储库创建工作副本。

根据您发布的内容，我认为您正在尝试公开工作副本而不是存储库（“.svn”文件夹是工作副本的典型，我敢打赌 e:\dev.svn 是一个结帐目录）。

进入服务管理并找出运行 svn 服务的命令行，它应该包含如下字符串：svnserve -d -r {somepath}

{somepath} 是存储库的路径。这是您应该在 apache 的 SVNPath 配置指令中提供的路径。

最后一件事：*不允许*同时使用 svnserve 和 apache svn 对同一个存储库进行 R/W 访问，它可能会通过将存储库暴露于事务锁的竞争条件来破坏你的存储库

# .net - 为什么我的 .net 应用程序需要完全信任？

> ID：557713
> 
> 赞同：13
> 
> 时间：2009-02-17T16:56:26.360
> 
> 标签：.net, permissions, .net-3.5, clickonce

我开发了一个 .net 3.0 应用程序，它是使用 clickonce 部署的。

我想从完全信任转变为部分信任以简化部署。

我在visual studio下我的项目的“安全”选项卡中尝试了“计算权限”工具，答案很清楚：

```
---------------------------
Microsoft Visual Studio
---------------------------
This application requires full trust to run correctly. 
```

但是，我无法弄清楚为什么需要完全信任。我尝试将安全设置更改为“部分信任”，但应用程序在启动时立即引发 SecurityException ：

```
System.Security.SecurityException   {"Request failed.", Action= "System.Security.Permissions.SecurityAction.LinkDemand"
   at MyNameSpace.Program.Main(String[] args)
   at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)
   at System.AppDomain.nExecuteAssembly(Assembly assembly, String[] args)
   at System.Runtime.Hosting.ManifestRunner.Run(Boolean checkAptModel)
   at System.Runtime.Hosting.ManifestRunner.ExecuteAsAssembly()
   at System.Runtime.Hosting.ApplicationActivator.CreateInstance(ActivationContext activationContext, String[] activationCustomData)
   at System.Runtime.Hosting.ApplicationActivator.CreateInstance(ActivationContext activationContext)
   at System.Activator.CreateInstance(ActivationContext activationContext)
   at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssemblyDebugInZone()
   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
   at System.Threading.ExecutionContext.runTryCode(Object userData)
   at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.ThreadHelper.ThreadStart() 
```

我的软件可能不需要完全信任（我只使用 https 连接到网络服务器，并且仅在用户请求时访问文件系统，用于导入/导出目的）

我怎样才能弄清楚为什么我的应用程序需要完全信任？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T17:14:08.487

看来我的问题是由于我的程序集是强签名的。

引用自[msdn](http://msdn.microsoft.com/en-us/library/hx8bhbc1.aspx)

> 在强名称程序集中，LinkDemand 应用于其中的所有可公开访问的方法、属性和事件，以将它们的使用限制为完全受信任的调用者。要禁用此功能，您必须应用 AllowPartiallyTrustedCallersAttribute 属性。

我正在向我的程序集添加所需的属性，我会让你知道结果如何：

```
[assembly:AllowPartiallyTrustedCallers] 
```

更新：我已将属性添加到我的程序集中，但我也在使用一些 .net 程序集。

并非所有.net 程序集都可以被部分信任的程序集使用（[这里有一个列表](http://msdn.microsoft.com/en-us/library/ys8yafkf.aspx)），即 WCF 程序集（即 System.ServiceModel）不在列表中

但是，Microsoft 声明可以在部分信任环境中使用 WCF（[请参阅此处](http://msdn.microsoft.com/en-us/library/bb943482.aspx)）

我试图从我的引用中删除所有不需要的程序集，我在所有程序集中都使用了 AllowPartiallyTrustedCallers，但我仍然被卡住了......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T19:32:16.720

Microsoft 有一个名为[permcalc](http://msdn.microsoft.com/en-us/library/ms165077(VS.80).aspx)的工具，它分析程序集并生成详细的 xml 输出文件，如下所示：

```
<Type Name="MyClass">
<Method Sig="instance void .ctor()">
<Demand>
<PermissionSet version="1" class="System.Security.PermissionSet">
  <IPermission version="1" class="System.Security.Permissions.FileIOPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" Unrestricted="true" /> 
  <IPermission version="1" class="System.Security.Permissions.ReflectionPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" Unrestricted="true" /> 
... 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T17:09:27.283

异常消息告诉您为什么不能以部分信任运行：

```
System.Security.Permissions.SecurityAction.LinkDemand 
```

如果您将其复制并粘贴到 Google 中，您会在 MSDN 上找到几篇相关文章，这些文章可能会帮助您发现为什么您的应用程序需要完全信任。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T09:37:24.957

在 app.config 的 configsections 中添加 requirePermission='false' 属性有很大帮助：

```
 <sectionGroup name="system.net" type="System.Net.Configuration.NetSectionGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
      <section requirePermission="false" name="defaultProxy" type="System.Net.Configuration.DefaultProxySection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
    </sectionGroup> 
```

这对我来说是个窍门！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T16:58:47.323

Hrm，只是一个猜测，但它是否正在运行网络共享？.NET 似乎根据运行代码的位置来分配信任。如果它来自除本地硬盘之外的任何地方，那么您将遇到安全问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T16:58:51.690

如果没有看到您的应用程序的代码，就无法判断。您可能忽略了*一些*需要对您的应用程序完全信任的东西（可能是依赖关系？）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T20:14:03.733

您的堆栈跟踪未显示所要求的权限类型。

在这种情况下，AllowPartiallyTrustedCallers 不会帮助您。它应该在调用目标上指定，例如当一些部分受信任的代码调用到您的受信任程序集时。在您的情况下，您应该检查您的应用程序是否调用了未定义此属性的程序集。如果是，那么您的应用程序将需要在完全信任的情况下运行，并且根本无法在部分信任的情况下运行（这就是 CAS 的强制执行方式并且是设计使然。）

否则使用 permcalc。它将向您显示应在项目的安全设置中启用的权限。但是，我不确定在包含所有这些权限之后，您是否仍将拥有“部分信任”，或者更确切地说是完全信任并具有一些精简的权限。这是因为部分信任非常严格（打开 security.config 并查看启用的权限！），据我所知 WebPermission 不存在（发送 http 请求需要它），与 FileIOPermission 相同。

# ajax - 使用 AJAX 和标准 HTML POST 请求时的多个经典 ASP SessionID

> ID：557728
> 
> 赞同：2
> 
> 时间：2009-02-17T17:00:06.773
> 
> 标签：ajax, session, asp-classic, vbscript

我正在使用 Classic ASP 和一点 AJAX 将表单的内容发布回 AJAX 表单所在的页面。在 AJAX POST 页面将这些字段之一（具体来说是电子邮件）保存到 Session 变量中。然后用户开始他们的业务——也许通过普通的 HTTP 再次请求页面。

但是，这使我的浏览器（Firefox 3.0.6）带有两个 ASPSESSIONxxxx cookie - 我假设一个用于 AJAX 请求，一个用于标准 HTTP 调用。

这会导致页面（依赖于 Session var）从已创建的两个中随机选择一个 ASP Session ID - 一个设置了 Session var，一个没有设置。

我之前在 PHP 和 Flash 中处理过这个问题，您可以在 PHP 中设置会话 ID，但不能在 ASP 中。

是否有任何特定于 ASP 的方法来抵消这种行为 - 或者我应该放弃并使用 cookie？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T18:35:36.483

我想这里可能还有别的东西。

我整理了一个简单的示例，我认为该示例正在执行您所描述的操作，并且会话似乎正在运行。

```
<%@ LANGUAGE=VBSCRIPT %>
<% if Request.Form("curid") = "" then %>
<html>
    <head>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.3/prototype.js"></script>

        <script type="text/javascript">
            Event.observe(window, 'load', function() {
                Event.observe($('sessiontest'), 'click', function(event) {
                    Event.stop(event);

                    new Ajax.Request( 'test.asp', {
                        method:  'POST',
                        parameters:  {'curid':  $('curid').value},
                        onSuccess:  function(response) {
                            window.location = 'test.asp';
                        },
                        onFailure:  function() {
                            alert('FAIL!');
                        }
                    });
                });
            });
        </script>
    </head>
    <body>
            <p><input type="text" id="curid" value="<%=Session("curid")%>" /></p>
            <p><a href="#" id="sessiontest">Save ID to Session</a></p>
    </body>
</html>
<% 
else
    Session("curid") = Request.Form("curid")
    Response.write "I was called via POST"
end if 
%> 
```

我也是带 FF 3.0.6 的 Windows。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T08:07:57.290

本，

我很确定（虽然我还没有确定）双 asp 会话是分配给同一服务器上多个虚拟主机的工作进程（应用程序池）的结果。在您的环境中是否有机会出现这种情况？

我偶然发现了这个页面，因为我正准备调试和部署一个经典的 asp ajax 实现，而这是我想在这样做之前调查的一个问题。

此外，默认的 ASP 会话行为在几代 Windows 服务器中都发生了变化（但不确定它在 IIS 的 XP/Vista 实现中如何工作）。

我的帖子有点过时了两个月，你解决了这个问题吗？并好奇您正在根据您的情况测试/使用什么服务器环境/IIS。

# asp.net - 在 IIS 上部署 MVC 应用程序时出现空白页

> ID：557730
> 
> 赞同：19
> 
> 时间：2009-02-17T17:01:24.243
> 
> 标签：asp.net, asp.net-mvc

我目前正在生产服务器上部署使用 MVC ASP.NET 的 RC 构建的应用程序，现在没有显示任何内容。我的 global.ascx 中的路线是典型的，即

```
routes.MapRoute(
            "Default",                                              // Route name
            "{controller}.aspx/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        );
        routes.MapRoute(
          "Root",
          "",
          new { controller = "Home", action = "Index", id = "" }
        ); 
```

谁能弄清楚为什么它只显示空白页

对不起，我忘了提到它是 IIS 6

**有趣的是，它也适用于我的本地 IIS（即本地内置的 VS 和标准的 XP）**

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-11T09:11:57.810

当您在 global.asax 中设置了错误处理并且某些通用错误（例如无法找到的程序集）时，您还将获得一个空白页面。

当您在 global.asax 中禁用它时，您会看到服务器错误。不要忘记在修复这些初始错误后再次启用它。

```
protected void Application_Error(object sender, EventArgs e)
{
    Exception exception = Server.GetLastError();
    RouteData routeData = new RouteData();
    routeData.Values.Add("controller", "ErrorController");
    routeData.Values.Add("action", "HandleTheError");
    routeData.Values.Add("error", exception);

    Response.Clear();
    Server.ClearError();

    IController errorController = new ErrorController();
    errorController.Execute(new RequestContext(
        new HttpContextWrapper(Context), routeData));
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-02-13T12:11:13.060

通常当我得到这个时，这是因为我在 IIS7（或 Visual Studio 附带的 IIS Express 7）上开发后部署到 IIS6 时忘记将以下内容添加到 Web.config 中：

```
<system.webServer>
  <modules runAllManagedModulesForAllRequests="true" />
</system.webServer> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-24T08:02:05.953

当特定位置发生错误时会显示空白页 - 在我的情况下，它是 MethodNotFoundException ...

要查看错误，请确保在“Web 服务器 (IIS) 角色”中启用“HTTP 错误”和“HTTP 重定向”服务。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T00:26:02.317

我解决了这个问题，主要问题是 MVC 框架的不同版本。当我安装 MVC RC1 时，生产服务器正在使用 MVC Beta。因此，一旦我在服务器上安装了 RC1 并运行了 mvc 扩展注册脚本，一切正常 感谢你们的帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T17:11:50.177

服务器环境如何？如果不是 IIS7/Server 2008，则您必须进行其他调整才能使路由正常工作，但如果是这种情况，您可能会收到错误页面，而不是空白页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T17:47:20.420

如果是生产服务器出现问题，则可能是角色权限。您需要确保您的应用程序正在使用的所有文件夹和文件都允许读取（如果您使用日志，在某些情况下还可以写入）到 IIS 正在使用的角色标识。

通常 IIS 使用的身份位于网站属性 -> 目录安全 -> 编辑（身份验证和访问控制）中。如果您不想让网络上的任何计算机访问该网站，那么您可能应该关闭“启用匿名访问”。如果您确实想允许这样做，这将是您需要在 webapp 文件夹和文件中授予访问权限的身份。否则，您可能需要授予对包含您想要访问的用户身份的角色的访问权限。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T18:30:52.390

从它的外观来看，如果您要访问 /Home.aspx 之类的 url，我希望第一条路线可以工作，但如果您只是访问 / url，那么 ASP.net 不知道如何处理该 URL。它将尝试匹配 IIS 默认页面，如 index.html、default.aspx、index.aspx 等。如果没有找到任何内容，则请求无法到达任何地方。尝试创建 default.aspx（或路由中的任何其他索引文件），然后在 page_load 中执行`response.redirect("~/Home.aspx")`.

如果这不起作用，我会查看这个[来源](http://blog.codeville.net/2008/07/04/options-for-deploying-aspnet-mvc-to-iis-6/)。IIS 6 和 MVC 表现不佳的主要原因之一是 IIS 6 默认情况下没有通配符 * 映射到 ASP.net dll。

我确定这是配置产品服务器的一种方式，您可以在您的XP实例和生产之间进行任何比较吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T18:40:43.833

您是否在生产服务器上的 web.config 中定义了 HTTP 处理程序和模块？

```
 <httpHandlers>
        <remove verb="*" path="*.asmx"/>
        <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
        <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
        <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" validate="false"/>
        <add verb="*" path="*.mvc" validate="false" type="System.Web.Mvc.MvcHttpHandler, System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    </httpHandlers>
    <httpModules>
        <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
        <add name="UrlRoutingModule" type="System.Web.Routing.UrlRoutingModule, System.Web.Routing, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    </httpModules> 
```

在 IIS6 上，URL 必须包含 .mvc（例如 /Products.mvc/ListAll）。检查这些指南以了解正确的 IIS 6 配置和 .mvc 扩展解决方法：

[将 ASP.NET MVC 部署到 IIS 6](http://blog.codeville.net/2008/07/04/options-for-deploying-aspnet-mvc-to-iis-6/)

[在没有 .MVC 扩展的 IIS 6 上使用 ASP.NET MVC](http://flux88.com/blog/using-asp-net-mvc-on-iis-6-without-the-mvc-extension/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-12T00:49:25.433

这意味着您的 MVC 应用程序中抛出了一个异常，但您的 MVC 中可能有一个类来捕获、过滤和隐藏这些异常。这些异常仍然被抛出，但你看不到是什么导致了它们。MVC 仍然重新路由页面请求，但由于隐藏的异常而没有返回任何内容。在看到抛出异常之前，您无法停止问题。在关闭 MVC 的异常处理过滤器之前，您无法在网页中看到异常。

可能会阻止您看到异常的一件事是在网站首次加载时通过 global.asax 中的 MVC 过滤器调用 GlobalFilterCollection。您通常可以在 Global.asax 文件中找到这些调用。该文件通常在网站首次加载及其事件时调用 HttpApplication 对象。然后在其事件中加载开发人员添加的默认 MVC 路由，但也可以加载处理站点范围异常处理的过滤器。开发人员经常通过 global.asax 中的过滤器填充异常处理，认为他们正在智能地处理来自用户的异常和问题，但这是一个错误。如果您在其中找到过滤器，只需将其注释掉。一旦你这样做了，突然间你所有的错误都会再次出现在你的 HTML 页面中。

然后就可以解决问题了！祝你好运！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-02-23T17:56:41.953

这也发生在我身上：

1）当浏览器接受它时，我添加了一个 CompressAttribute 来添加 Gzip。

```
response.AppendHeader("Content-Encoding", "gzip");
                    response.Filter = new GZipStream(response.Filter, CompressionMode.Compress); 
```

2) 我正在修改输出 HTML 以更改显示的电话号码：

```
response.Filter = new OutputHtmlReplacer(response.Filter, phoneNumber); 
```

其中 OutputHtmlReplacer 是一个继承自 MemoryStream 的类

所以，解决方案是：

1）验证标头并检查我们是否正在应用压缩。

2) 如果是这样，那么新的 OutputHtmlReplacer 响应过滤器必须由 GzipStream 包装。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-07-22T00:45:51.223

贾斯汀万一有人遇到与我相同的问题，请尝试监控：

```
protected void Application_Error(object sender, EventArgs e) { 
```

对我来说，应用程序默默地失败了，我不知道，所以很明显它返回一个空白，但令人困惑的部分是返回一个 200 作为 http 响应状态代码。

无论如何，我希望这对将来的某人有所帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-09T07:36:54.147

`app_offline.htm`如果它是在您的应用程序中创建的，请尝试删除该文件。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-11-27T12:48:25.557

作为另一种可能的解决方案：

我已经有一个月左右没有部署了，但是已经通过几个小版本更新了我的 Visual Studio。VS Base 和我的一些 Nuget 包之间出现了不兼容问题。更新了我的包，确保清理（并删除 bin/obj - 即使它最初没有解决问题），然后重新部署。之后工作。

# asp.net - 如何防止用户拥有同一个 Web 应用程序的多个实例

> ID：557733
> 
> 赞同：13
> 
> 时间：2009-02-17T17:01:51.810
> 
> 标签：asp.net, javascript, visual-studio-2005

我想知道是否可以确定用户是否已经有一个对我正在处理的 Web 应用程序打开的 Web 浏览器。他们似乎可以打开同一个 Web 应用程序的多个实例，然后单击按钮来阅读他们之前使用的信息，从而进入他们当前正在处理的输入屏幕。

但是发生的事情是它似乎搞砸了 Session 变量，然后用户将使用他们的新工作更新他们以前的工作。或者他们会一起删除他们以前的工作，或者谁知道......

***编辑*** *我以前在网上银行网络应用程序中看到过这种情况。如果您已经登录，新窗口会告诉您您已经打开了该应用程序。在我的情况下，用户不需要登录。*

有没有一种简单的方法来确定他们是否已经有一个浏览器窗口打开到 Web 应用程序，如果是这样，只需关闭浏览器或显示一个不同的页面，让他们知道他们一次只能打开一个？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T17:53:55.397

首先，不，没有，其次，你不应该尝试。

弹出窗口策略不起作用（并且会惹恼用户）。我将浏览器设置为“以选项卡形式打开窗口”，然后*我*选择是否将一个窗口拆分为另一个窗口。或者在某些情况下，是否运行不同的浏览器——不仅仅是同一浏览器的另一个实例——以在同一站点上显示另一个页面。

相反，迷你会话 ID 将失败，因为服务器无法跟踪请求是否来自与现有会话相同的*用户。*几个人可能使用同一台机器，即使使用相同的用户名；或者一个人可能在一台或多台机器上拥有多个单独的登录会话。

只需理清您的协议与“会话”变量，并确保最后提交的更改是持久的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T17:32:53.917

您可以为输入表单的每个实例分配一个“迷你会话”ID，然后使用 AJAX 使用该 ID ping 服务器。如果用户在有活动 ID 时尝试请求相同的表单，它应该显示错误消息。如果服务器在一定时间内没有听到 ping，则使迷你会话过期。（这基本上是一个非常简单的锁定策略）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-21T16:57:48.303

您所要做的就是为隐藏输入控件的值和页面加载事件中的会话变量分配一个值，并在回发时检查局部变量的值与会话变量中的值。如果值不匹配，您可以将用户重定向到登录页面或告诉他们该页面的会话不再有效的页面等。

例子：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    Try
        If Not IsPostBack Then
            'SET LOCAL VARIABLE AND SESSION VARIABLE TO A UNIQUE VALUE
            'IF THE USER HAS CHANGED TABS THIS WILL CHANGE THE VALUE OF THE SESSION VARIABLE
            Me.HiddenInput.value = New Guid().ToString
            Me.Session.Add("PageGuid", Me.HiddenInput.value)

        Else 
            'ON POSTBACK, CHECK TO SEE IF THE USER HAS OPENED A NEW TAB
            'BY COMPARING THE VALUE OF THE LOCAL VALUE TO THE VALUE OF THE SESSION VARIABLE

            If me.HiddenInput.value <> CType(Session("PageGuid"), String) Then

                'THE VALUES DO NOT MATCH, MEANING THE USER OPENED A NEW TAB.
                'REDIRECT THE USER SOMEWHERE HARMLESS

                Response.Redirect("~/Home.aspx")

            Else

                'THE VALUES MATCH, MEANING THE USER HAS NOT OPENED A NEW TAB
                'PERFORM NORMAL POSTBACK ACTIONS

                ...

            End If
        End If
    Catch ex As Exception
        Me.Session.Add("ErrorMessage", BusinessLogic.GetErrorMessage(ex))
        Me.Response.Redirect("~/ErrorPage.aspx", False)
    End Try
End Sub 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T17:26:21.033

我使用打开具有特定 ID 的新窗口的技巧，并始终确保打开的任何页面始终使用该窗口。

不利的一面是，他们必须为您的站点关闭弹出窗口阻止程序。它适用于公司网站。

```
if (useOwnWindow && window.name != 'YourAPP'){
    var w = window.open(document.location, 'YourAPP', 'toolbar=no,status=yes,resizable=yes,scrollbars=yes');
    if (w==null){
        alert("Please turn off your pop-up blocker");
    }else{
        window.open('','_parent','');
        self.opener="";
        self.close();
    }
 } 
```

如果开发人员使用，请注意 useOwnWindow 标志，以便*我们*可以多次打开它

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T17:32:14.513

> 有没有一种简单的方法来确定他们是否已经有一个浏览器窗口打开到 Web 应用程序，如果是这样，只需关闭浏览器或显示一个不同的页面，让他们知道他们一次只能打开一个？

简而言之，不会。
如果不编写某种 activeX 控件，就没有代码可以阻止用户打开 IE/FF 等的（单独实例）并让一个实例检测另一个实例。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T15:02:58.940

我们已经在 slicethepie.com 上实施了针对此问题的解决方案。用户（或“童子军”）一次只允许打开一个浏览器窗口，以确保他们收听付费评论的音乐。

当侦察员要求在他们的侦察会话中审查第一条轨道时，我们会在他们的帐户上设置一个新的 Guid 并返回这个“密钥”以及他们要审查的轨道的详细信息。碰巧这个密钥的接收者是一个 Flash 电影，但它不是必须的。密钥与侦察员的审查一起重新提交，我们检查它是否与保存的密钥匹配。如果不是，他们已经在新窗口中开始了新的球探会话。

我并不是说这种方法是万无一失的，但它可以很容易地适应您的需求。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-17T17:51:16.683

我建议您散列页面的 ViewState 并将其存储在会话变量中，然后再将其作为响应返回。

然后对于请求，首先检查返回的 ViewState 的哈希值与会话变量中的哈希值，如果它们不匹配，则不要处理页面上的任何更改并向用户显示通知或将它们重定向到错误页。

您要覆盖的 Page 类的两个方法是：

```
protected override object LoadPageStateFromPersistenceMedium()

protected override void SavePageStateToPersistenceMedium(object viewState) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-22T13:02:11.463

当用户打开另一个选项卡或另一个窗口甚至另一个浏览器时，您可以停止页面功能

```
 $(window).blur(function(){

// code to stop functioning or close the page  

}); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-04-13T09:13:56.167

我以这种方式部分解决了这个问题。我的应用程序要求用户进行身份验证......所以他们输入用户名和密码。当他们单击提交按钮时，我将两个数据都存储到会话变量中，即我将用户名存储到 Session("LoginName") 中。

所以这里是诀窍：只需在登录页面的页面加载事件中测试 Session("LoginName") 是否在用户输入之前有一个值。如果是这样，这是一个多会话，您可以停止用户或其他任何内容。

类似的东西（我使用VB）：

```
 If Not Page.IsPostBack Then
       Try
          If Session("LoginName") <> "" Then
             Response.Redirect("www.mysite.com")
             Exit Sub
          End If
       Catch ex As Exception
          ' Do something
       End Try 
```

PRO：非常简单

缺点：用户可以复制内部页面的地址并将其粘贴到同一浏览器的另一个选项卡中......这就是我说“部分”的原因

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-07-09T21:57:21.350

我有一个 js 代码，这个代码只让你有一个页面实例，但只能在运行这个 js 代码的页面中。示例：如果将 js 代码放在 page1.html 和 page2.html 中，则代码将允许 page1 或 page2 的一个实例。如果只把js放在page1中，page1只有一个实例，而page2有多个实例。

只需复制并粘贴到您的站点并更改逻辑的最后几行。

代码：

```
var statusWindow = document.getElementById('status');

(function (win) {
    //Private variables
    var _LOCALSTORAGE_KEY = 'WINDOW_VALIDATION';
    var RECHECK_WINDOW_DELAY_MS = 100;
    var _initialized = false;
    var _isMainWindow = false;
    var _unloaded = false;
    var _windowArray;
    var _windowId;
    var _isNewWindowPromotedToMain = false;
    var _onWindowUpdated;

    function WindowStateManager(isNewWindowPromotedToMain, onWindowUpdated) {
        //this.resetWindows();
        _onWindowUpdated = onWindowUpdated;
        _isNewWindowPromotedToMain = isNewWindowPromotedToMain;
        _windowId = Date.now().toString();

        bindUnload();

        determineWindowState.call(this);

        _initialized = true;

        _onWindowUpdated.call(this);
    }

    //Determine the state of the window 
    //If its a main or child window
    function determineWindowState() {
        var self = this;
        var _previousState = _isMainWindow;

        _windowArray = localStorage.getItem(_LOCALSTORAGE_KEY);

        if (_windowArray === null || _windowArray === "NaN") {
            _windowArray = [];
        }
        else {
            _windowArray = JSON.parse(_windowArray);
        }

        if (_initialized) {
            //Determine if this window should be promoted
            if (_windowArray.length <= 1 ||
               (_isNewWindowPromotedToMain ? _windowArray[_windowArray.length - 1] : _windowArray[0]) === _windowId) {
                _isMainWindow = true;
            }
            else {
                _isMainWindow = false;
            }
        }
        else {
            if (_windowArray.length === 0) {
                _isMainWindow = true;
                _windowArray[0] = _windowId;
                localStorage.setItem(_LOCALSTORAGE_KEY, JSON.stringify(_windowArray));
            }
            else {
                _isMainWindow = false;
                _windowArray.push(_windowId);
                localStorage.setItem(_LOCALSTORAGE_KEY, JSON.stringify(_windowArray));
            }
        }

        //If the window state has been updated invoke callback
        if (_previousState !== _isMainWindow) {
            _onWindowUpdated.call(this);
        }

        //Perform a recheck of the window on a delay
        setTimeout(function () {
            determineWindowState.call(self);
        }, RECHECK_WINDOW_DELAY_MS);
    }

    //Remove the window from the global count
    function removeWindow() {
        var __windowArray = JSON.parse(localStorage.getItem(_LOCALSTORAGE_KEY));
        for (var i = 0, length = __windowArray.length; i < length; i++) {
            if (__windowArray[i] === _windowId) {
                __windowArray.splice(i, 1);
                break;
            }
        }
        //Update the local storage with the new array
        localStorage.setItem(_LOCALSTORAGE_KEY, JSON.stringify(__windowArray));
    }

    //Bind unloading events  
    function bindUnload() {
        win.addEventListener('beforeunload', function () {
            if (!_unloaded) {
                removeWindow();
            }
        });
        win.addEventListener('unload', function () {
            if (!_unloaded) {
                removeWindow();
            }
        });
    }

    WindowStateManager.prototype.isMainWindow = function () {
        return _isMainWindow;
    };

    WindowStateManager.prototype.resetWindows = function () {
        localStorage.removeItem(_LOCALSTORAGE_KEY);
    };

    win.WindowStateManager = WindowStateManager;
})(window);

var WindowStateManager = new WindowStateManager(true, windowUpdated);

function windowUpdated() {
    //"this" is a reference to the WindowStateManager
    //statusWindow.className = (this.isMainWindow() ? 'main' : 'child');
    if (this.isMainWindow() === false) {
        //alert("This is not the main window")
        location.href = "yourpage.html";

    }
    else {
        //alert("This is the main window")
    }

}
//Resets the count in case something goes wrong in code
//WindowStateManager.resetWindows() 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-11-29T05:01:57.410

```
 <script type="text/javascript">
        window.onload = function(){
        if (document.cookie.indexOf("_instance=true") === -1) {
        document.cookie = "_instance=true";
        // Set the onunload function
        window.onunload = function(){
            document.cookie ="_instance=true;expires=Thu, 01-Jan-1970 00:00:01 GMT";
        };
        // Load the application
        }
        else {
             alert(" Security Alerts.You Are Opening Multiple Window. This window will now close.");
             var win = window.open("about:blank", "_self"); win.close();
        // Notify the user
        }
        };
    </script> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-31T17:49:38.803

正如其他人所提到的，如果不求助于 ActiveX 或其他讨厌的东西，您就无法阻止用户开始新会话。基本问题是您无法知道用户是关闭旧浏览器窗口还是保持打开状态。

但是，您可以做的是在用户登录到新会话后立即使之前的会话无效（有点类似于即时消息客户端的行为方式）。

每次登录时，为数据库中的用户分配一个新的 GUID。还将此 GUID 存储在会话缓存中（无需将它来回传送到页面，这对 GET 请求无论如何都不起作用）。在每个页面请求上，将数据库中分配给用户的 GUID 与会话缓存中的 GUID 进行比较。如果它们不匹配，则返回“您已从其他地方登录”响应。

*更新*我的触发器有点太快了。这不会阻止用户在同一浏览器进程中打开多个选项卡/窗口的情况。因此，您必须将此解决方案与 Dave Anderson 的建议相结合，以存储 ViewState 哈希（或简称为 GUID），以便只允许回发会话中最后提供的页面。

*安全更新*此外，您只能依靠此框架为用户提供便利，因为它不安全。任何半体面的黑客都将能够规避这些措施。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-17T17:09:58.623

您可以检查用户是否有多个活动会话。这可能有效，但可能会出现问题，因为没有确定会话是否真正处于活动状态的好方法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-05-10T16:03:39.827

如果有人复制网站 url 并将其粘贴到新窗口或选项卡中，则该窗口/选项卡的浏览器历史记录将为空......因此您可以使用 javascript 并检查历史记录..

```
if (history.length == 1) {  //0 for IE, 1 for Firefox
    // This is a new window or a new tab.
} 
```

现在您可以提示用户关闭选项卡，或禁用该页面（`disabled`例如，通过制作所有元素）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-09-20T13:53:39.213

我遇到了同样的问题并使用网络套接字解决了它（我将 pusher 与 php 一起使用）。当用户登陆页面时，我设置了一个变量：

```
var firstTimeHere = true; 
```

然后我在 javascript 中创建了一个 websocket 函数，该函数将用户 ID 作为函数名称的一部分，例如：

```
var pingUser123 = function(){...}; 
```

然后我使用ajax查询触发websocket的php端的服务器：

```
$this->trigger("pingUser123"); 
```

websocket 在任意数量的浏览器和机器上的任意数量的窗口中触发该函数的所有 javascript 实例。从那里我可以看到这是否是第一次 ping 这个浏览器。如果是这样，这是唯一的实例，如果不是，则有第二个实例。

```
var pingUser123 = function(){
    if(firstTimeHere){
       firstTimeHere = false;
    }else{
        app.stop();
        alert("Only one window at a time please.");
    }
}; 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2017-05-08T11:55:40.100

您可以通过 window.name 执行此操作。在 java 脚本中，window.name 在每个新选项卡上都有空白值。在登录页面设置 window.name 值并保存在会话中。

```
window.name = Math.random() + "_YourApplication" 
```

现在在母版页/布局页上检查这个 window.name。如果它包含多个选项卡，则注销用户。

```
 if (!window.name || window.name != '@Session["WindowName"]') {
    //Log Off code
 } 
```

# sql - SQL 循环

> ID：557734
> 
> 赞同：0
> 
> 时间：2009-02-17T17:02:34.757
> 
> 标签：sql, sql-server, loops

我正在为 Billboard 公司的系统中构建此报告。他们有一个存储所有广告牌的表，除其他数据外，广告牌有一个开始日期和一个结束日期（两者都可以为空）。
如果由于某种原因必须停止使用广告牌，他们会设定一个完成日期，并且在该日期之后将无法使用。与开始日期相同（如果他们刚刚设置了一个新板，并且在设定的开始日期之后可以使用）。

在这份报告中，我必须获得给定时间段内所有可能的广告位的总和。

因此，假设在我选择的期间（例如 4 周）
* 第 1 周有 500 个可用板
* 在第 2 周，一个板变得不可用（使 498 个板可用）
* 在第 3 周，两个板变得可用（使501 个板可用）
* 在第 4 周，一个板可用，另一个板不可用（使 501 个板可用）

那么我应该在这段时间内总共有 1990 个可用的板，这就是我想要的结果。

我怎样才能在一个查询中得到这个？
星期将来自 HTML 表单，我必须在查询之前将它们转换为日期，所以我只会有我想知道有多少板可用的日期。
获取 ONE 特定日期的板数量的查询如下：

```
SELECT  
  COUNT(IdBillboard)  
FROM  
  tBillboards  
WHERE  
  (StartDate IS NULL OR StartDate <= '2009-01-05 00:00:00')  
  AND (FinishDate IS NULL OR FinishDate >= '2009-01-05 00:00:00') 
```

我不能只为每个日期添加`AND`和`OR`条件，因为我需要为单独的日期重新计算。我考虑过使用 a`WHILE`但无法弄清楚如何在这种情况下做到这一点。所以这就是我被困的地方......如果有人需要，我会发布更多细节。

谢谢， 加布

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:17:13.237

不知道这是否是您正在寻找的，但可能是朝着正确方向迈出的一步。

```
SELECT  
  SUM(CASE WHEN 
   (StartDate IS NULL OR StartDate <= '2009-01-05 00:00:00')  
      AND (FinishDate IS NULL OR FinishDate >= '2009-01-05 00:00:00')
    THEN 1
    ELSE 0 END)) Week1Count,
  SUM(CASE WHEN 
   (StartDate IS NULL OR StartDate <= '2009-01-12 00:00:00')  
      AND (FinishDate IS NULL OR FinishDate >= '2009-01-12 00:00:00')
    THEN 1
    ELSE 0 END)) Week2Count
FROM  
  tBillboards 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T17:25:55.447

这不是您问题的答案，但您应该考虑使用`BETWEEN`而不是`AND`s。

```
WHERE  
  (StartDate IS NULL) OR 
  StartDate BETWEEN '2009-01-05' AND '2009-01-05' 
```

IMO 这更具可读性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T17:25:20.490

如果您可以将表单中的日期放入（可能是临时的）表中，那么您的查询可以是：

```
SELECT  
  COUNT(t.IdBillboard)  
FROM  
  tBillboards r, tDates d
WHERE  
  (t.StartDate IS NULL OR StartDate <= d.date)  
  AND (t.FinishDate IS NULL OR FinishDate >= d.date) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T17:25:51.610

```
SELECT  COUNT(*)
FROM
    (
    SELECT DATEADD(ww, num, @initdate) AS wd
    FROM (
        SELECT 0 AS num
        UNION ALL
        SELECT 1
        UNION ALL
        SELECT 2
        UNION ALL
        SELECT 3
        ) w
    ) weeks, Billboards bb
WHERE wd BETWEEN NULLIF(bb.StartDate, wd) AND NULLIF(bb.EndDate, wd) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T17:30:44.580

SQL 中没有 WHILE。要循环，您连接到另一个表。

您没有指定它，但我认为广告牌会在一周中的某一天（例如星期日）更改可用性，并且它们每周不能更改多次。

您需要做的是创建一个包含所有可能发生此更改的周的表，我们将其称为日期的 DT，其中单个日期列 x 每周有一个日期（星期日？）。

然后做这样的事情：

```
select count(*) from tBillboards b
inner join DT d
    on (b.startdate is null or b.startdate <= d.x)
       and (b.finishdate is null or b.finishdate < d.x)
where d.x between period_start and period_end 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T17:50:10.100

假设您使用的是 SQL Server 2005 或更高版本，您可以使用 CTE 执行此操作，如下例所示。在我的示例中，您需要设置一个日期以及您希望从该日期回顾的周数：

```
DECLARE @dtNow DATETIME
DECLARE @iNumberOfWeeks INT
SET @dtNow = '2009-01-21'
SET @iNumberOfWeeks = 2;

WITH CountForPeriod (IdBillBoard, StartDate, FinishDate, NumberOfWeeksBack) AS
(
    SELECT IdBillBoard, StartDate, FinishDate, 1 AS NumberOfWeeksBack
    FROM tBillBoards
    WHERE (StartDate <= @dtNow)
    AND (FinishDate >= @dtNow)

    UNION ALL

    SELECT b.IdBillBoard, b.StartDate, b.FinishDate, 1 + NumberOfWeeksBack
    FROM tBillBoards b
    JOIN CountForPeriod c
    ON (b.StartDate <= DATEADD(dd, -7 * c.NumberOfWeeksBack, @dtNow))
    AND (b.FinishDate >= DATEADD(dd, -7 * c.NumberOfWeeksBack, @dtNow))
)
SELECT NumberOfWeeksBack, COUNT(*)
FROM CountForPeriod
WHERE NumberOfWeeksBack <= @iNumberOfWeeks
GROUP BY NumberOfWeeksBack 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T17:58:15.260

这将为您提供 2009 年前 4 周的总数。要检查另一年，请将以下查询中出现的两次 2009 更改为您感兴趣的年份。

```
select sum(Count) as Total
from (
    SELECT w.Week, Count(*) as Count
    FROM tBillboards b
    inner join (
        select 1 as Week
        union all
        select 2
        union all
        select 3
        union all
        select 4
    ) w on StartDate is null or datepart(ww, StartDate) <= w.Week
        and FinishDate is null or datepart(ww, FinishDate) >= w.Week
    where isnull(year(StartDate), 2009) <= 2009
        and isnull(year(FinishDate), 2009) >= 2009
    group by w.Week
) a 
```

如果您需要的时间超过前 4 周，请继续将数字添加到包含 UNION 的内部查询中。

# javascript - 如何防止 iframe 调整父窗口的大小？

> ID：557739
> 
> 赞同：1
> 
> 时间：2009-02-17T17:03:13.473
> 
> 标签：javascript, iframe, resize, dom-events

我有一个带有 iframe 的页面。iframe 中的内容会`window.parent.resizeTo`调用（或类似的结果会调整整个浏览器窗口的大小）。它这样做是为了适应它的内容。我想防止调整整个浏览器窗口的大小，而只是更改 iframe 元素的大小。

有没有办法在 Javascript 中拦截这些调整大小命令？我尝试听父母的“调整大小”事件，但它们似乎发生在事后，当窗口已经调整大小时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T17:12:52.767

你可以让函数什么都不做：

```
var windowResizeTo = window.resizeTo; // In case we want to put it back later
window.resizeTo = function() {}; 
```

# vb.net - 从界面引发事件（获胜形式）

> ID：557740
> 
> 赞同：1
> 
> 时间：2009-02-17T17:03:41.070
> 
> 标签：vb.net, winforms, events, interface, event-handling

我的场景：

具有基本主 (mdi) 窗体的 Windows 窗体应用程序。

具有事件的接口：

```
Public Interface IDoSomething

Event AddFilter() 
```

模态弹窗实现接口和贴花事件：

```
Public Class frmPopup Implements IDoSomething

Public Event AddFilter() Implements IDoSomething.AddFilter 
```

弹出窗口还包含触发事件的代码：

```
RaiseEvent AddFilter() 
```

基本主表单包含发现和启动实现指定接口的弹出表单的代码。

应用程序中的表单启动弹出窗口（实现接口）并处理它触发的任何事件。所以我在表单中有以下代码：

```
Public Class frmMyForm

Public WithEvents m_Popup As IDoSomething

Public Sub m_Popup_AddFilter() Handles m_Popup.AddFilter

    MsgBox("I'm in")

End Sub 
```

代码一切正常，直到触发事件的阶段。弹出窗口加载没有任何问题，但是当事件触发时，它似乎从地球表面掉了下来，并且没有被主窗体-frmMyForm 拾取。我怀疑这可能与通过发现接口从基本主表单启动弹出表单的方式有关。

附加代码 - 扩展“基本主表单包含发现和启动实现指定接口的弹出表单的代码”：

正在使用的弹出表单的想法是将业务对象返回到使用事件打开它的表单。弹出表单接口 (IDoSomething) 继承了另一个接口 - IBusinessObjectSelector，它指定表单将返回一个业务对象。

所以基本主表单中的功能是：

```
Public Function GetBusinessObjectUsingPopup(Of O, F As IBusinessObjectSelector)
               (ByRef dicPropertyValues As Dictionary(Of String, Object), 
                Optional ByVal titleText As String = "") 
                As O Implements IBaseMasterForm.GetBusinessObjectUsingPopup

Dim objBusinessObjectSelector As IBusinessObjectSelector = GetPopup(Of F)(False)       
    objBusinessObjectSelector.InitialiseForm()

    ' Activate and show the dialog
    If objBusinessObjectSelector.ShowPopup() <> Windows.Forms.DialogResult.OK Then
        ' The user cancelled the load, so just exit
        Return Nothing
    End If

    GetBusinessObjectUsingPopup = CType(objBusinessObjectSelector.SelectedBusinessObject, O)

End Function 
```

和弹出代码：

```
Public Function GetPopup(Of F As IBasePopupChildForm)
            (Optional ByVal initialisePopupPriorToReturn As Boolean = True) As F 
             Implements IBaseMasterForm.GetPopup

    Dim lstIBasePopupChildForm As List(Of F) = GetInterfaces(Of F)()
            lstIBasePopupChildForm(0).MyIBaseMasterForm = Me
    If initialisePopupPriorToReturn Then
        lstIBasePopupChildForm(0).InitialiseForm()
    End If
    Return lstIBasePopupChildForm(0)
End Function 
```

注 - GetInterfaces(Of F)() 只是扫描程序集并返回实现所需接口的表单列表。如果找到实现该接口的多个表单，则某些验证已被删除，这些验证将返回消息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:17:47.120

关键部分是正确初始化 m_Popup。你什么都没说。一些示例代码：

表格2：

```
Public Class Form2
    Implements IDoSomething
    Public Event AddFilter() Implements IDoSomething.AddFilter

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        RaiseEvent AddFilter()
    End Sub
End Class

Public Interface IDoSomething
    Event AddFilter()
End Interface 
```

表格1：

```
Public Class Form1
    Private WithEvents mPopup As IDoSomething

    Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Dim f2 As New Form2
        f2.Show(Me)
        mPopup = f2
    End Sub

    Private Sub mPopup_AddFilter() Handles mPopup.AddFilter
        MsgBox("yada")
    End Sub
End Class 
```

这段代码中的 mPopup = f2 语句是关键。

# dependency-injection - 依赖注入与工厂模式

> ID：557742
> 
> 赞同：540
> 
> 时间：2009-02-17T17:03:45.003
> 
> 标签：dependency-injection, factory-pattern, design-patterns

引用的大多数使用依赖注入的示例，我们也可以使用工厂模式来解决。看起来在使用/设计方面，依赖注入和工厂之间的区别是模糊的或薄的。

曾经有人告诉我，你如何使用它会有所作为！

我曾经使用[StructureMap](http://structuremap.sourceforge.net/Default.htm)一个 DI 容器来解决一个问题，后来我重新设计了它以使用一个简单的工厂并删除了对 StructureMap 的引用。

谁能告诉我它们之间有什么区别以及在哪里使用什么，这里的最佳做法是什么？

* * *

## 回答 #1

> 赞同：307
> 
> 时间：2009-02-17T17:14:02.433

使用工厂时，您的代码实际上仍然负责创建对象。通过 DI，您将该责任外包给与您的代码分开的另一个类或框架。

* * *

## 回答 #2

> 赞同：235
> 
> 时间：2009-02-17T17:10:28.777

我建议保持概念简单明了。依赖注入更像是一种用于松散耦合软件组件的架构模式。工厂模式只是将创建其他类的对象的责任分离给另一个实体的一种方式。工厂模式可以称为实现 DI 的工具。依赖注入可以通过多种方式实现，例如使用构造函数的 DI、使用映射 xml 文件等。

* * *

## 回答 #3

> 赞同：218
> 
> 时间：2013-06-04T06:06:39.140

**依赖注入**

汽车不需要实例化零件本身，而是**要求**其运行所需的零件。

```
class Car
{
    private Engine engine;
    private SteeringWheel wheel;
    private Tires tires;

    public Car(Engine engine, SteeringWheel wheel, Tires tires)
    {
        this.engine = engine;
        this.wheel = wheel;
        this.tires = tires;
    }
} 
```

**工厂**

将各个部分组合在一起形成一个完整的对象，并对调用者隐藏具体类型。

```
static class CarFactory
{
    public ICar BuildCar()
    {
        Engine engine = new Engine();
        SteeringWheel steeringWheel = new SteeringWheel();
        Tires tires = new Tires();
        ICar car = new RaceCar(engine, steeringWheel, tires);
        return car;
    }   
} 
```

**结果**

如您所见，工厂和 DI 相辅相成。

```
static void Main()
{
     ICar car = CarFactory.BuildCar();
     // use car
} 
```

* * *

你还记得金发姑娘和三只熊吗？嗯，依赖注入有点像这样。这里有三种方法可以做同样的事情。

```
void RaceCar() // example #1
{
    ICar car = CarFactory.BuildCar();
    car.Race();
}

void RaceCar(ICarFactory carFactory) // example #2
{
    ICar car = carFactory.BuildCar();
    car.Race();
}

void RaceCar(ICar car) // example #3
{
    car.Race();
} 
```

**示例 #1** - 这是最糟糕的，因为它完全隐藏了依赖关系。如果您将该方法视为一个黑匣子，您将不知道它需要一辆车。

**示例 #2** - 这稍微好一点，因为现在我们知道我们需要一辆汽车，因为我们经过了一家汽车工厂。但这一次我们传递的太多了，因为方法实际上需要的只是一辆汽车。当汽车可以在方法之外制造并通过时，我们正在通过工厂来制造汽车。

**示例#3** - 这是理想的，因为该方法准确地要求**它**需要什么。不要太多或太少。我不必为了创建MockCars而编写MockCarFactory，我可以直接将mock传入。它是直接的，界面不会说谎。

Misko Hevery 的 Google 技术讲座非常棒，是我从中得出示例的基础。[http://www.youtube.com/watch?v=XcT4yYu_TTs](http://www.youtube.com/watch?v=XcT4yYu_TTs)

* * *

## 回答 #4

> 赞同：66
> 
> 时间：2014-03-13T16:04:40.410

依赖注入 (DI) 和工厂模式相似的原因是因为它们是控制反转 (IoC) 的两种实现，它是一种软件架构。简单地说，它们是同一问题的两种解决方案。

所以要回答这个问题，工厂模式和 DI 之间的主要区别在于如何获得对象引用。顾名思义，依赖注入意味着引用被注入或提供给您的代码。使用工厂模式，您的代码必须请求引用，以便您的代码获取对象。两种实现都删除或解耦代码与代码使用的对象引用的底层类或类型之间的链接。

值得注意的是，工厂模式（或者实际上是返回对象引用的新工厂的工厂的抽象工厂模式）可以编写为动态选择或链接到运行时请求的对象的类型或类。这使得它们与服务定位器模式非常相似（甚至比 DI 更相似），服务定位器模式是 IoC 的另一种实现。

工厂设计模式相当古老（就软件而言）并且已经存在了一段时间。自从最近流行的架构模式 IoC 以来，它正在复苏。

我想当谈到 IoC 设计模式时：注入器正在注入，定位器正在定位，工厂已经被重构。

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2009-02-17T17:16:50.463

有些问题很容易通过依赖注入解决，而用一套工厂则不容易解决。

一方面，控制反转和依赖注入 (IOC/DI) 与服务定位器或工厂套件（工厂）之间的一些区别是：

IOC/DI 本身就是一个完整的领域对象和服务生态系统。它以您指定的方式为您设置一切。您的域对象和服务是由容器构造的，而不是自己构造的：因此它们对容器或任何工厂没有*任何*依赖关系。IOC/DI 允许极高程度的可配置性，所有配置都在应用程序的最顶层（GUI、Web 前端）的一个地方（容器的构造）。

工厂抽象出您的域对象和服务的一些构造。但是域对象和服务仍然负责弄清楚如何构建自己以及如何获取它们所依赖的所有东西。所有这些“活动”依赖项一直过滤到应用程序中的所有层。没有一个地方可以配置所有东西。

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2012-05-01T09:24:19.357

DI 的一个缺点是它不能用逻辑初始化对象。例如，当我需要创建一个具有随机名称和年龄的角色时，DI 不是工厂模式的选择。使用工厂，我们可以轻松地封装对象创建中的随机算法，它支持一种称为“封装变化的设计模式”的设计模式。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2010-12-20T20:09:28.193

> 除了实例化和注入之外，生命周期管理是依赖容器承担的职责之一。容器在实例化后有时会保留对组件的引用这一事实是它被称为“容器”而不是工厂的原因。依赖注入容器通常只保留对它需要管理生命周期的对象的引用，或者为将来的注入重用的对象，例如单例或享元。当配置为每次调用容器创建某些组件的新实例时，容器通常只是忘记创建的对象。

*来自：[http ://tutorials.jenkov.com/dependency-injection/dependency-injection-containers.html](http://tutorials.jenkov.com/dependency-injection/dependency-injection-containers.html)*

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2017-05-29T12:59:27.787

## 理论

有两点需要考虑：

1.  谁创建对象

    *   [工厂]：您必须编写如何创建对象。您有单独的 Factory 类，其中包含创建逻辑。
    *   [依赖注入]：在实际情况下是由外部框架完成的（例如在 Java 中是 spring/ejb/guice）。注入“神奇地”发生，无需明确创建新对象
2.  它管理什么样的对象：

    *   【工厂】：通常负责有状态对象的创建
    *   [依赖注入] 更有可能创建无状态对象

* * *

## 实际示例如何在单个项目中同时使用工厂和依赖注入

1.  我们想要建造的

用于创建包含多个条目的订单的应用程序模块，称为 orderline。

2.  建筑学

假设我们要创建以下层架构：

[![在此处输入图像描述](https://i.stack.imgur.com/nwyri.png)](https://i.stack.imgur.com/nwyri.png)

域对象可能是存储在数据库中的对象。存储库 (DAO) 有助于从数据库中检索对象。Service 为其他模块提供 API。允许对`order`模块进行操作

3.  领域层和工厂的使用

将在数据库中的实体是 Order 和 OrderLine。订单可以有多个订单行。 [![Order 和 OrderLine 的关系](https://i.stack.imgur.com/7ZGae.png)](https://i.stack.imgur.com/7ZGae.png)

现在是重要的设计部分。这个模块之外的模块是否应该自行创建和管理 OrderLines？不，只有当您有与之关联的订单时，订单行才应该存在。如果您可以将内部实现隐藏到外部类，那将是最好的。

但是如何在不了解 OrderLines 的情况下创建 Order？

工厂

想要创建新订单的人使用了 OrderFactory（它将隐藏有关我们如何创建订单的细节）。

[![在此处输入图像描述](https://i.stack.imgur.com/51LBU.png)](https://i.stack.imgur.com/51LBU.png)

这就是它在 IDE 中的外观。包外的类`domain`将使用`OrderFactory`而不是内部的构造函数`Order`

4.  依赖注入依赖注入更常用于无状态层，例如存储库和服务。

OrderRepository 和 OrderService 由依赖注入框架管理。Repository 负责管理数据库上的 CRUD 操作。服务注入存储库并使用它来保存/查找正确的域类。

[![在此处输入图像描述](https://i.stack.imgur.com/wly0X.png)](https://i.stack.imgur.com/wly0X.png)

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2009-02-17T17:13:04.323

我相信 DI 是工厂的一种抽象层，但它们也提供了抽象之外的好处。真正的工厂知道如何实例化单一类型并对其进行配置。一个好的 DI 层提供了通过配置实例化和配置多种类型的能力。

显然，对于一个类型比较简单的项目，在构建时需要相对稳定的业务逻辑，工厂模式理解简单，实现简单，运行良好。

OTOH，如果您的项目包含许多类型的实现，您希望经常更改其实现，那么 DI 通过其配置为您提供了在运行时执行此操作的灵活性，而无需重新编译您的工厂。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2012-09-13T05:02:57.967

我知道这个问题很老，但我想加我的五分钱，

我认为依赖注入（DI）在很多方面就像可配置的工厂模式（FP），从这个意义上说，你可以用 DI 做的任何事情，你都可以用这样的工厂来做。

实际上，如果您使用 spring，例如，您可以选择自动装配资源 (DI) 或执行以下操作：

```
MyBean mb = ctx.getBean("myBean"); 
```

然后使用那个 'mb' 实例做任何事情。这不是对工厂的调用，它会返回一个实例吗？

我注意到大多数 FP 示例之间的唯一真正区别是您可以在 xml 或另一个类中配置“myBean”是什么，并且框架将作为工厂工作，但除此之外是相同的，您当然可以有一个工厂来读取配置文件或根据需要获取实现。

如果你问我的意见（我知道你没有），我相信 DI 做同样的事情，但只是增加了开发的复杂性，为什么？

好吧，一方面，为了让您知道使用 DI 自动装配的任何 bean 所使用的实现是什么，您必须转到配置本身。

但是......关于你不必知道你正在使用的对象的实现的承诺呢？噗！严重地？当您使用这样的方法时……您与编写实现的人不一样吗？即使您不这样做，您是否几乎一直在查看实现如何完成它应该做的事情？

最后一件事，**无论 DI 框架向您承诺多少**，您将构建与它**分离**的东西，而不依赖于它们的类，如果您使用的是框架，那么您将围绕它构建所有东西，**如果您必须改变方法或框架这不是一件容易的事......永远！**...但是，由于您围绕该特定框架构建所有内容，而不是担心什么是您业务的最佳解决方案，那么在这样做时您将面临一个问题。

事实上，我能看到的唯一真正的 FP 或 DI 方法的业务应用程序是，如果您需要更改**运行时**使用的实现，但至少我知道的框架不允许您这样做，您必须离开在开发时配置中的一切都很完美，如果您需要使用另一种方法。

所以，如果我有一个类在同一个应用程序的两个范围内执行不同的操作（比如说，两个控股公司），我必须配置框架来创建两个不同的 bean，并调整我的代码以使用每个。这和我写这样的东西不一样吗：

```
MyBean mb = MyBeanForEntreprise1(); //In the classes of the first enterprise
MyBean mb = MyBeanForEntreprise2(); //In the classes of the second enterprise 
```

与此相同：

```
@Autowired MyBean mbForEnterprise1; //In the classes of the first enterprise
@Autowired MyBean mbForEnterprise2; //In the classes of the second enterprise 
```

和这个：

```
MyBean mb = (MyBean)MyFactory.get("myBeanForEntreprise1"); //In the classes of the first enterprise
MyBean mb = (MyBean)MyFactory.get("myBeanForEntreprise2"); //In the classes of the second enterprise 
```

在任何情况下，您都必须更改应用程序中的某些内容，无论是类还是配置文件，但您必须重新部署它。

做这样的事情不是很好吗：

```
MyBean mb = (MyBean)MyFactory.get("mb"); 
```

这样，您将工厂的代码设置为在运行时根据登录的用户企业获得正确的实现？现在这会很有帮助。您可以只添加一个带有新类的新 jar，甚至在运行时也可以设置规则（或者如果您打开此选项，则添加一个新的配置文件），而不更改现有类。这将是一个动态工厂！

这不会比必须为每个企业编写两个配置，甚至可能为每个企业编写两个不同的应用程序更有帮助吗？

你可以告诉我，我不需要在运行时进行切换，所以我配置应用程序，如果我继承类或使用其他实现，我只需更改配置并重新部署。好的，这也可以通过工厂完成。老实说，你这样做了多少次？也许只有当你有一个应用程序将在公司的其他地方使用，并且你要将代码传递给另一个团队时，他们才会做这样的事情。但是，嘿，这也可以用工厂来完成，如果有动态工厂就更好了！！

无论如何，评论区如果开放让你杀了我。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-08-28T08:22:42.247

IOC 是一个通过两种方式实现的概念。依赖创建和依赖注入，工厂/抽象工厂是依赖创建的例子。依赖注入是构造器、设置器和接口。IOC 的核心是不依赖于具体类，而是定义方法的抽象（比如接口/抽象类），并使用该抽象来调用具体类的方法。像工厂模式一样返回基类或接口。类似地，依赖注入使用基类/接口来设置对象的值。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-02-17T17:12:34.200

使用依赖注入，客户端不需要自己获取依赖，所有这些都是事先准备好的。

对于工厂，必须有人调用它们才能将生成的对象送到需要它们的地方。

不同之处主要在于调用工厂和获取构造对象的这一行。

但是对于工厂，您必须在需要这样一个对象的任何地方编写这一行。使用 DI，您只需创建一次连接（使用和创建的对象之间的关系），然后在任何地方都依赖对象的存在。另一方面，DI 通常需要在准备方面做更多的工作（多少取决于框架）。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2015-01-14T15:54:07.353

您可以查看[**此链接**](http://www.slideshare.net/daniele77/going-native-with-less-coupling)，以在真实示例中比较两种（和其他）方法。

基本上，当需求发生变化时，如果您使用工厂而不是 DI，您最终会修改更多代码。

这对于手动 DI 也是有效的（即，当没有为您的对象提供依赖关系的外部框架，但您在每个构造函数中传递它们时）。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-12-20T22:23:43.110

当我读到关于 DI 并最终看到这篇文章时，我就有了同样的问题。所以最后这就是我所理解的，但如果错了请纠正我。

“很久以前，有自己的管理机构根据自己的书面规则控制和做出决定的小王国。后来成立了一个大政府，取消了所有这些拥有一套规则（宪法）并通过法院实施的小管理机构”

小王国的管理机构是“工厂”

大政府是“依赖注入器”。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2017-11-21T10:35:51.103

这里的大多数答案都解释了两者的概念差异和实现细节。但是，我无法找到有关 IMO 最重要且 OP 询问的应用程序差异的解释。所以让我重新开始这个话题......

> 曾经有人告诉我，你如何使用它会有所作为！

确切地。在 90% 的情况下，您可以使用 Factory 或 DI 获取对象引用，通常您最终会使用后者。在另外 10% 的情况下，使用 Factory 是**唯一正确的方法**。这些情况包括在运行时参数通过变量获取对象。像这样：

```
IWebClient client = factoryWithCache.GetWebClient(url: "stackoverflow.com",
        useCookies: false, connectionTimeout: 120); 
```

在这种情况下，`client`从 DI 获取是不可能的（或者至少需要一些丑陋的解决方法）。因此，作为决策的一般规则：如果可以在没有任何运行时计算参数的情况下获得依赖关系，则首选 DI，否则使用 Factory。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2017-11-28T14:51:04.173

使用工厂，您可以对相关接口进行分组，因此如果传递的参数可以在工厂中分组，那么`constructor overinjection`查看此代码也是一个很好的解决方案*）：

```
public AddressModelFactory(IAddressAttributeService addressAttributeService,
        IAddressAttributeParser addressAttributeParser,
        ILocalizationService localizationService,
        IStateProvinceService stateProvinceService,
        IAddressAttributeFormatter addressAttributeFormatter)
    {
        this._addressAttributeService = addressAttributeService;
        this._addressAttributeParser = addressAttributeParser;
        this._localizationService = localizationService;
        this._stateProvinceService = stateProvinceService;
        this._addressAttributeFormatter = addressAttributeFormatter;
    } 
```

看看构造函数，你只需要传递`IAddressModelFactory`那里，所以更少的参数*）：

```
 public CustomerController(IAddressModelFactory addressModelFactory,
        ICustomerModelFactory customerModelFactory,
        IAuthenticationService authenticationService,
        DateTimeSettings dateTimeSettings,
        TaxSettings taxSettings,
        ILocalizationService localizationService,
        IWorkContext workContext,
        IStoreContext storeContext,
        ICustomerService customerService,
        ICustomerAttributeParser customerAttributeParser,
        ICustomerAttributeService customerAttributeService,
        IGenericAttributeService genericAttributeService,
        ICustomerRegistrationService customerRegistrationService,
        ITaxService taxService,
        CustomerSettings customerSettings,
        AddressSettings addressSettings,... 
```

您在`CustomerController`传递的许多参数中看到，是的，您可以看到这一点，`constructor overinjection`但这就是 DI 的工作方式。并且没有任何问题`CustomerController`。

*) 代码来自 nopCommerce。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2018-02-13T07:41:52.527

**简单来说，依赖注入与工厂方法分别意味着推与拉机制。**

**拉机制**：类间接依赖于工厂方法，而工厂方法又依赖于具体类。

**推送机制**：根组件可以在一个位置配置所有依赖组件，从而促进高维护和松耦合。

使用工厂方法的责任仍然在于类（尽管是间接的）来创建新对象，而依赖注入则将责任外包（但以泄漏抽象为代价）

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-02-17T19:02:07.887

比诺伊，

我认为您不必选择其中之一。

将依赖类或接口移动到类构造函数或设置器的行为遵循 DI 模式。传递给构造函数或集合的对象可以用 Factory 来实现。

什么时候使用？使用开发人员驾驶室中的一种或多种模式。他们觉得什么最舒服，最容易理解。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-02-17T18:01:17.190

我相信 DI 是一种配置或实例化 bean 的方式。DI 可以通过多种方式完成，例如构造函数、setter-getter 等。

工厂模式只是实例化 bean 的另一种方式。这种模式主要在你必须使用工厂设计模式创建对象时使用，因为在使用这种模式时你不配置 bean 的属性，只实例化对象。

检查此链接：[依赖注入](http://technologiquepanorama.wordpress.com/2009/02/13/dependecy-injection/)

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2020-05-04T20:28:50.807

You use dependency injection when you exactly know what type of objects you require at this point of time. While in case of factory pattern, you just delegate the process of creating objects to factory as you are unclear of what exact type of objects you require.

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-04-28T05:24:19.707

我相信，有 3 个重要方面支配着对象及其用法：
1.**实例化**（一个类的实例化，如果有的话还有初始化）。
2.在需要的地方**注入**（如此创建的实例）。
3.**生命周期管理**（如此创建的实例）。

使用工厂模式，实现了第一个方面（实例化），但其余两个方面值得商榷。使用其他实例的类必须**对工厂进行硬编码**（而不是创建实例），这会阻碍松散耦合能力。此外，**生命周期管理**在一个工厂在多个地方使用的大型应用程序中，实例的数量成为一个挑战（特别是，如果工厂不管理它返回的实例的生命周期，它就会变得丑陋）。

另一方面，使用 DI（IoC 模式），所有 3 个都在代码之外（到 DI 容器）抽象出来，托管 bean 不需要这种复杂性。**松耦合**，一个非常重要的架构目标可以安静舒适地实现。另一个重要的架构目标，可以比工厂更好地实现 **关注点分离。**

虽然工厂可能适合小型应用程序，但大型应用程序最好选择 DI 而不是工厂。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-10-28T01:22:39.863

My thoughts:

Dependecy Injection: pass collaborators as parameters to the constructors. Dependency Injection Framework: a generic and configurable factory to create the objects to pass as parameters to the constructors.

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-06-17T02:23:11.207

注入框架是工厂模式的一种实现。

这一切都取决于您的要求。如果您需要在应用程序中实现工厂模式，那么您的需求很可能会被无数注入框架实现之一满足。

如果任何第 3 方框架都无法满足您的要求，您应该只推出自己的解决方案。您编写的代码越多，您需要维护的代码就越多。代码是负债而不是资产。

关于您应该使用哪种实现的争论并不像理解应用程序的架构需求那么重要。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-09-24T08:20:35.970

**工厂设计模式**

工厂设计模式的特点是

*   一个接口
*   实现类
*   一个工厂

当您如下提问时，您可以观察到几件事

*   工厂何时会为实现类创建对象——运行时还是**编译时？**
*   如果你想在运行时切换实现怎么办？-**不可能**

这些由依赖注入处理。

**依赖注入**

你可以有不同的方式来注入依赖。为简单起见，让我们使用接口注入

在 DI 中，容器创建所需的实例，并将它们“注入”到对象中。

从而消除了静态实例化。

例子：

```
public class MyClass{

  MyInterface find= null;

  //Constructor- During the object instantiation

  public MyClass(MyInterface myInterface ) {

       find = myInterface ;
  }

  public void myMethod(){

       find.doSomething();

  }
} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-03-31T01:07:59.457

**从表面上看，它们看起来一样**

用非常简单的术语来说，工厂模式，一种创建模式帮助我们创建一个对象——“定义一个用于创建对象的接口”。如果我们有一个对象池的键值类型（例如字典），将键传递给工厂（我指的是简单工厂模式），您可以解析类型。任务完成！另一方面，依赖注入框架（例如 Structure Map、Ninject、Unity 等）似乎也在做同样的事情。

**但是......“不要重新发明轮子”**

从架构的角度来看，它是一个绑定层，并且“不要重新发明轮子”。

对于企业级应用程序，DI 的概念更多的是定义依赖关系的架构层。为了进一步简化这一点，您可以将其视为一个单独的类库项目，它可以解决依赖关系。主要应用程序依赖于这个项目，其中依赖解析器指的是其他具体实现和依赖解析。

除了来自工厂的“GetType/Create”之外，我们通常还需要更多功能（使用 XML 定义依赖关系、模拟和单元测试等的能力）。由于您提到了结构图，请查看[结构图功能列表](http://%22http://docs.structuremap.net/FeatureList.htm%22)。它显然不仅仅是简单地解决简单的对象映射。不要重新发明轮子！

**如果你只有一把锤子，一切看起来都像钉子**

根据您的要求和您构建的应用程序类型，您需要做出选择。如果它只有几个项目（可能是一个或两个..）并且涉及的依赖项很少，您可以选择一种更简单的方法。这就像使用 ADO .Net 数据访问而不是使用 Entity Framework 进行简单的 1 或 2 个数据库调用，在这种情况下引入 EF 是一种过度杀伤力。

但是对于一个更大的项目或者如果你的项目变得更大，我强烈建议有一个带有框架的 DI 层并腾出空间来更改你使用的 DI 框架（在主应用程序中使用外观（Web 应用程序、Web Api、桌面..ETC。）。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-04-16T20:47:19.467

我认为这些是正交的，可以一起使用。让我给你看一个我最近在工作中遇到的例子：

我们在 Java 中使用 Spring 框架进行 DI。单例类 ( `Parent`) 必须实例化另一个类 ( `Child`) 的新对象，而这些对象具有复杂的协作者：

```
@Component
class Parent {
    // ...
    @Autowired
    Parent(Dep1 dep1, Dep2 dep2, ..., DepN depN) {
        this.dep1 = dep1;
        this.dep2 = dep2;
    }

    void method(int p) {
        Child c = new Child(dep1, dep2, ..., depN, p);
        // ...
    }
} 
```

在此示例中，`Parent`必须接收`DepX`实例才能将它们传递给`Child`构造函数。这方面的问题：

1.  `Parent`拥有`Child`比应有的更多的知识
2.  `Parent`拥有比应有的更多的合作者
3.  添加依赖`Child`项涉及更改`Parent`

这是我意识到 a`Factory`非常适合这里的时候：

1.  它隐藏了除`Child`类的真实参数之外的所有参数，如`Parent`
2.  它封装了创建 的知识`Child`，可以集中在 DI 配置中。

这是简化`Parent`的类和`ChildFactory`类：

```
@Component
class Parent {
    // ...
    @Autowired
    Parent(ChildFactory childFactory) {
        this.childFactory = childFactory;
    }

    void method(int p) {
        Child c = childFactory.newChild(p);
        // ...
    }
}

@Component
class ChildFactory {
    // ...
    @Autowired
    Parent(Dep1 dep1, Dep2 dep2, ..., DepN depN) {
        this.dep1 = dep1;
        this.dep2 = dep2;
        // ...
        this.depN = depN;
    }

    Child newChild(int p) {
        return new Child(dep1, dep2, ..., depN, p);
    }
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-11-09T14:35:24.877

[Factory] ​​-> 有一个类根据请求参数创建类。毕竟，“工厂”也在现实世界中为您制造“对象”。您可以要求您的汽车供应商工厂制造（免费:)）特斯拉版本。1给你。

[DI] -> 有一个（服务）容器存储接口（契约类）。你不关心创建对象。您只需询问某人/某处来实现它，细节和其他东西对您、呼叫者或消费者都无关紧要。

DI 是 SOLID 原则中“D”的基础。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-09-30T19:04:04.733

DI 为您提供[组合根](https://stackoverflow.com/questions/6277771/what-is-a-composition-root-in-the-context-of-dependency-injection)，它是用于连接对象图的单个集中位置。这往往会使对象依赖关系非常明确，因为对象准确地要求它们需要什么，并且只有一个地方可以得到它。

组合根是关注点的干净和直接的分离。被注入的对象应该不依赖于 DI 机制，无论是第三方容器还是 DIY DI。DI 应该是不可见的。

工厂往往更加分散。不同的对象使用不同的工厂，工厂代表了对象与其实际依赖关系之间的额外间接层。这个附加层将自己的依赖项添加到对象图中。工厂不是隐形的。工厂是中间人。

出于这个原因，更新工厂更成问题：由于工厂是业务逻辑的依赖项，因此修改它们可能会产生连锁反应。组合根不是业务逻辑的依赖项，因此可以单独修改。

GoF 提到了更新抽象工厂的困难。他们的部分解释在[此处](https://stackoverflow.com/a/60795309/1371329)的答案中被引用。将 DI 与工厂进行对比也与问题有很多共同点，[ServiceLocator 是反模式吗？](https://stackoverflow.com/questions/22795459/is-servicelocator-an-anti-pattern)

最终，选择哪个答案可能是固执己见；但我认为归结为工厂是中间人。问题是该中间人是否通过增加额外价值来发挥作用，而不仅仅是提供产品。因为如果你可以在没有中间商的情况下得到同样的产品，那为什么不去掉中间商呢？

图表有助于说明差异。 [![DI 与工厂](https://i.stack.imgur.com/qXnU0.png)](https://i.stack.imgur.com/qXnU0.png)

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2018-06-25T20:49:38.707

我使用**两者**来创建一个控制反转策略，对于需要在我之后维护它的开发人员来说具有更高的可读性。

我使用工厂来创建不同的图层对象（业务、数据访问）。

```
ICarBusiness carBusiness = BusinessFactory.CreateCarBusiness(); 
```

另一位开发人员将看到这一点，并在创建业务层对象时查看 BusinessFactory 和 Intellisense 为开发人员提供了所有可能的业务层来创建。不用玩游戏，找到我要创建的界面。

这种结构已经是控制反转。我不再负责创建特定对象。但是您仍然需要确保依赖注入能够轻松更改事物。创建自己的自定义依赖注入是荒谬的，所以我使用 Unity。在 CreateCarBusiness() 中，我要求 Unity 解析哪个类属于这个以及它的生命周期。

所以我的代码工厂依赖注入结构是：

```
public static class BusinessFactory
{
    public static ICarBusiness CreateCarBusiness()
    {
       return Container.Resolve<ICarBusiness>();
    }
} 
```

现在我得到了两者的好处。对于其他开发人员来说，我的代码对于我使用的对象的范围也更具可读性，而不是构造函数依赖注入，它只是说每个对象在创建类时都是可用的。

当我创建单元测试时，我使用它来将我的数据库数据访问更改为自定义编码的数据访问层。我不希望我的单元测试与数据库、网络服务器、电子邮件服务器等进行通信。他们需要测试我的业务层，因为那是智能所在。

* * *

## 回答 #30

> 赞同：-4
> 
> 时间：2014-12-22T19:21:33.563

在我看来，如果您是以下情况，使用依赖注入会更好： 1\. 将代码部署在小分区中，因为它可以很好地处理大代码的解耦。2\. 可测试性是可以使用 DI 的情况之一，因为您可以轻松地模拟非解耦对象。通过使用接口，您可以轻松地模拟和测试每个对象。3\. 您可以同时修改程序的每个部分，而无需编写程序的另一部分，因为它是松散解耦的。

# java - 如何防止 java webstart 应用程序的盗版

> ID：557746
> 
> 赞同：5
> 
> 时间：2009-02-17T17:05:10.617
> 
> 标签：java, security, deployment, java-web-start

我有这个打算通过互联网销售的 java swing 应用程序。目前我倾向于使用 java webstart 部署应用程序。该产品将被授权用户一次只能在一台计算机上使用该程序。我担心这个模型的盗版。我想安装一些安全功能来强制执行许可模式。目标是至少使许可用户难以将已安装的产品（包括许可密钥）复制给未许可用户。以下是我现在正在查看的选项：

1.  每次启动程序时，强制用户使用用户名/密码向母船进行身份验证。

2.  在用户注册并付款后，只需在用户 PC 的某处（隐藏？）安装许可证密钥。在运行时，验证是否安装了有效的许可证密钥。

3.  使用/构建基于用户计算机硬件指纹的安全包。每次启动应用程序时都会计算此指纹，并使用某种散列与本地安装的许可证密钥进行比较。此许可证密钥将仅对此硬件指纹有效。

这里的问题之一是，一旦安装了这个应用程序，除了使用 java webstart 检查应用程序更新之外，应用程序不需要任何运行时联系母船。应用程序在本地执行的所有操作并使用 swing 向用户显示结果。因此，任何涉及母船的解决方案基本上都意味着构建一个服务器基础设施，其唯一目的是进行许可证验证。

我想我正在寻找的是基于 java 的东西，它至少有点安全、易于部署并且对用户来说并不痛苦。您使用了什么安全/许可方法？

编辑：我应该补充一点，我不一定要寻找灵丹妙药来防止绝对每个人都击败安全性。总会有人有足够的时间来找到完成它的方法。我不是很关心这些人。我基本上是想让临时用户难以简单地复制许可证密钥并将其发送给他的好友。如果实施得当，该解决方案应该让普通用户相信购买它更简单。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-17T17:15:27.440

IMO，试图在客户端强制执行复制保护可能比它的价值更麻烦。您将花费无数小时试图超越您的客户（您可以花费数小时来改进您的产品），但最终海盗总是会获胜。

不过，您还有其他选择：

1.  有一个有吸引力的定价模式，让人们购买你的产品变得*非常简单。*如果您的进入门槛足够低，并且尊重和信任而不是怀疑地对待您的客户，那么您就可以最大限度地降低盗版风险。
2.  将您的产品与某种在线服务联系起来。赠送客户，但收取服务费。这就是暴雪对《魔兽世界》所做的事情，也是少数没有盗版问题的游戏之一（他们还有很多其他问题，但那是另一回事了）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-17T17:41:13.523

我会说（2）是你最好的选择。您已经说服自己放弃（1），并且（3）如果用户购买新主板会导致问题。(2) 不会对相当精通计算机的用户提供太多保护，但它也不应该引起太多问题。

但最终，您无法阻止坚定的用户盗版您的软件。

> 事实上，最有效的反盗版软件开发策略是最简单的一种：
> 
> 1.  **有一个很棒的产品。**
> 2.  **收取合理的价格。**

——[杰夫·阿特伍德](https://blog.codinghorror.com/my-software-is-being-pirated/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T17:22:53.677

老实说，除非程序确实需要来自服务器的数据才能运行（正如 fred-o 所说的，魔兽世界需要；而且是真的），否则您无法在客户端做*任何*事情来完全证明自己是万无一失的。您拥有的所有 3 个想法都可以轻松绕过。服务器/登录可能有点困难，但我什至看到裂缝甚至在本地创建一个虚拟登录服务器，因此程序认为它正在被验证。

防止盗版的唯一真正方法是拥有一些程序需要运行的服务器端逻辑。例如 - 您正在制作调整图像大小的软件（我知道，我知道）。如果原始图像被运送到您的服务器并在那里调整大小然后发送回客户端（而不是客户端进行大小调整），那么您将是安全的，因为您的服务器可以很容易地通过某种登录系统得到保护. 如果没有有效的用户名或密码（或者如果他们试图生成一个假的），该程序将毫无用处。

如果您实现客户端功能，无论您做什么，都可以访问它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T17:41:27.970

我最好的选择是实施一个简单的解决方案，既不会对您征税过多，也不会让客户生气，以阻止偶尔的盗版。任何更复杂的事情都将是一场军备竞赛。一个太难赢的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T17:34:16.223

在您的三个解决方案中：

第一个需要网络连接才能做任何事情。如果他们不能离线使用它，用户将不会高兴。谷歌不得不为其办公软件处理这个问题。

第二个是没有太多的复制保护，除非该位置是隐藏的，并且隐藏的位置有其自身的困难（例如，有些人不喜欢安装喜欢在不同位置隐藏东西的应用程序），并且无论如何也不安全。

第三种可能会起作用，直到用户对计算机进行更改指纹的操作（我不知道您要检查什么），或者想要将应用程序从一台计算机移动到替代计算机。然后你会有一个潜在的愤怒用户。（“我更换了硬盘驱动器/移动到了不同的 LAN 连接/出现了系统故障/无论如何，[脏话删除]的东西刚刚停止工作！”）

因此，虽然第 2 项不太可能导致用户出现问题，但它不适用于大部分复制保护方案。数字 1 和 3 会让你的用户不满意，会给你带来一定的麻烦，而且无论如何都不会阻止有决心的人复制它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T18:06:45.803

我会认真重新考虑许可要求，因为执行它们会失去合法客户。如果你是一家大公司，你可以负担得起，但如果你是初创公司或个人，你就不能。

一种出路是提供个人许可证——适用于个人使用的所有机器。无论好坏，这都是人们认为软件“应该”销售的方式。如果你让他们为他们使用的每台机器付费，他们会觉得你在利用，那就是他们开始在网络上寻找其他人的许可证密钥的时候。

如果合适，您还可以提供公司许可证或 10 包许可证或其他任何东西，以比单独购买它们提供折扣。这为个人和组织提供了合法使用您的软件的方法，不会让他们觉得您在不合理地挤压他们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-12T10:41:23.617

考虑使用 JNLP 在您的应用程序中设置时间限制组件 - 许可证模块？- 必须通过互联网定期更新。更新版本的可访问性需要注册。让

有一个较长的宽限期，允许用户在禁用功能之前离线（或不想升级）一段时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-12T11:12:05.130

除非应用程序已经需要连接到网络来完成它的实际工作，否则打电话回家很容易被归类为间谍软件。

而且我不确定这是否适用于 Java Web Start，但由于防火墙可能会阻止您的应用程序打电话回家，您的付费客户可能仍然会看到他们的应用程序被阻止。

所以：我不会使用时不时打电话回家的东西。

（至于许可证密钥：如果密钥仅适用于特定的注册名称，并且如果该名称显示在某些“关于”对话框中，那么我不会担心使其依赖于硬件。当然，一些注册名称及其密钥将是共享，但任何花哨的东西都不值得付出努力。如果我的 Mac 失败了，那么我不会很高兴看到我在新硬件上的一键 Time Machine 恢复使您的应用程序无法启动。）

# asp.net - 如何在 Firefox 中使用 Javascript 设置 DIV 宽度/高度

> ID：557747
> 
> 赞同：4
> 
> 时间：2009-02-17T17:05:21.363
> 
> 标签：asp.net, javascript, firefox

以下适用于 IE，但不适用于 Firefox：

```
var el = $get('divToMask');
var box = Sys.UI.DomElement.getBounds(el);

var maskEl = $get('maskDiv');

// Only seems to work in IE
maskEl.style.width = box.width;
maskEl.style.height = box.height;

Sys.UI.DomElement.setLocation(maskEl, box.x, box.y); 
```

box.width 和 box.height 包含正确的值，但 Firefox 忽略 maskEl.style .width/.height 方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-17T17:12:31.673

注意：我不熟悉您使用的 Javascript 帮助程序库。

我猜您需要将评论后的两行更改为以下内容：

```
maskEl.style.width = box.width + "px";
maskEl.style.height = box.height + "px"; 
```

# asp.net - ASP.NET 服务器控件属性问题（？）

> ID：557749
> 
> 赞同：0
> 
> 时间：2009-02-17T17:05:39.007
> 
> 标签：asp.net, controls, properties

我正在开发一些 ASP.NET 服务器控件，但我遇到了一个问题。也许我监督一些事情，我不知道。

反正：

```
public string Name
{
    get
    {
        String s = (String)ViewState["name"];
        return ((s == null) ? String.Empty : s);
    }

    set
    {
        ViewState["name"] = value;
    }
}

protected override void RenderContents(HtmlTextWriter output)
{
    txt.ID = Name; // Name here exists
    txt.Text = DateTime.Now.ToShortDateString();

    txt.RenderControl(output);

    output.Write(someName(someValue));

}

public string GetCalendarString(string date)
{
    some code...
    // Name property is null
} 
```

'RenderContents' 使用属性 'Name' 设置控件名称，然后调用 'someName' 函数和 'someName' 函数也使用属性 'Name'，但是当我运行它时，函数 'someName' 中的属性 'Name' 为空，尽管在“RenderContents”中并非如此。

Gremlins，还是我错过了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T18:06:01.500

这将很难回答，因为如果不进行调试，就无法判断是什么外部力量操纵了数据。

由于`Name`是公共属性，因此任何有权访问它的控件都可以`null`在调用`GetCalendarString`. 此外，如果您在加载`GetCalendarString`之前调用`ViewState`此值将不可用。我*怀疑*您正在尝试`Name`从`ViewState`它加载之前获取，但这是一个最好通过调试解决的问题。

顺便说一句 -[这是一个很好的图像](http://codebetter.com/blogs//images/codebetter_com/raymond.lewallen/89/o_aspNet_Page_LifeCycle.jpg)，它显示了 ASP.NET 生命周期，它将帮助您确定是否`ViewState`在从`Request`.

# c# - Why can't I define a ResourceDictionary in XAML and instantiate it by itself?

> ID：557761
> 
> 赞同：2
> 
> 时间：2009-02-17T17:09:30.963
> 
> 标签：c#, .net, wpf, silverlight, xaml

Ok, that question was really hard to ask in one line. Here's the deal. If I have this XAML:

```
<ResourceDictionary
  x:Class="MyAssembly.MiscResources"    
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <SolidColorBrush x:Key="MyBrush" Color="Purple" />    

</ResourceDictionary> 
```

Then I have this in some C#:

```
var dict = new MiscResources(); 
```

`dict` gets created and seems to function normally, but it has 0 elements. Not that this is some kind of neccessary behavior, but I totally don't understand why it doesn't work. What piece of this am I missing?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T22:12:53.073

you are missing the call to Initializecomponent() in your partial Class for ResourceDictionary

```
namespace YourNameSpace
{
    public partial class someClassName: ResourceDictionary
    {
        public someClassName()
        {
            InitializeComponent(); // you need this for the LoadComponent call on the Baml..
        }
    }
} 
```

# unit-testing - 如果单元测试如此出色，为什么没有更多的公司这样做呢？

> ID：557764
> 
> 赞同：105
> 
> 时间：2009-02-17T17:09:47.000
> 
> 标签：unit-testing

我工作的第一家真正的软件公司都是关于单元测试（NUnit）的。我不知道那时我们真的是它的忠实拥护者——我不知道我们的代码覆盖率是什么样的，而且我正在编写大部分的单元测试。从那以后，我遇到了一些进行大量测试的公司，但它是椅子测试：依赖于一个人在场，重复性低，发现错误的机会低。另一种态度是：这是他们想要“在未来”进行的事情；基本上是当钱从天上掉下来的时候。

我想念单元测试——它只是让生活更轻松。但是我发现当我找一份新工作时，单元测试要么是公司希望在未来“开始”的事情，要么是他们根本不做的事情（呃，它已经存在了一段时间现在！）。我想说，在过去 2 年中，我查看的工作要求中有 60-75% 根本没有列出单元测试。我只能想到一两个具有单元测试经验的要求（对于中级开发人员职位）。

所以问题是，**缺少**什么？我认为它使人们更有效率，但这只是在花费大量时间实际去做之后。没有关于单元测试成本节约的好的研究吗？它是我正在寻找的公司类型吗？

编辑：尽管标题有点恶魔般的拥护者，但我认为自己是单元测试的支持者。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-02-17T17:17:05.780

根据我的经验，这涉及到几个因素：

1.  管理层并不真正了解单元测试到底是什么，或者为什么它对他们具有真正的内在价值。
2.  管理层往往更关心产品的快速交付，并且（错误地）认为单元测试会适得其反。
3.  有一种误解认为测试只属于 QA 的范畴。开发人员是编码员，不能编写测试。
4.  尽管这些工具是免费提供的，但管理人员必须花钱才能正确地进行单元测试，这是一种普遍的误解。（当然，开发人员需要考虑更多时间，但这并不是真正令人望而却步。）
5.  威尔的回答将完善这个答案：很难确定测试代码的价值（编辑 jcollum）

当然，还有其他因素，但这些正是我到目前为止所遇到的。

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2009-02-17T17:15:54.210

1）很难
2）需要时间
3）很难确定测试代码的价值

第 3 点是一个棘手的问题。好的单元测试可以减少错误。但是好的生产代码也是如此。由于单元测试，您如何确定不存在多少错误？你无法衡量不存在的东西。您可以指出研究，但它们不适合您的业务经理的电子表格。

* * *

## 回答 #3

> 赞同：74
> 
> 时间：2009-02-17T19:46:27.263

很容易把所有的责任都归咎于“管理”。但是管理层*真的*告诉你*不要*做任何单元测试吗？

一般来说，管理不会（也可能不应该）告诉您如何完成工作，无论是模块化、抽象数据类型、设计模式还是单元测试。这些是成功的、称职的软件工程师可以使用的交易工具，而差的工程师则不会。

我认为你的问题的真正答案是：单元测试真的很难，计算机科学的学生没有接受过培训。

当您编写自己的字符串类时，这很容易。当你测试一个真实的产品时，你会遇到没有人在幻灯片中告诉你的挑战：

*   用户交互。您的应用程序的一半是用户界面逻辑。你如何以自动化的方式测试它，如果你移动一个按钮就不会崩溃？
*   与外部 API 和框架的交互。如果您正在编写 Windows 内核驱动程序，您如何对其进行单元测试？您是否为您使用的每个 IRP 和内核函数编写存根，有效地创建操作系统内核的模拟？
*   网络通信是 21 世纪的东西。您如何协调由多个分布式组件组成的单元测试？
*   如何选择好的测试用例？我经常看到人们尝试“在 1000 次迭代的循环中做随机的事情，看看它是否会崩溃”的方法。当你这样做时，付出的努力大于回报，重要的错误被遗漏，单元测试被放弃。
*   您如何测试是否满足性能要求？
*   测试中的模式知识很少：存根、预设响应、回归测试是大多数人不知道的概念。你工作的地方有多少人真正读过一本关于单元测试的书？

我们可以责怪管理层的一件事是，需求规范很少包含对可交付成果质量水平的任何要求。

下次你的老板要求你做一个时间估算时，包括编写单元测试的时间，看看会发生什么。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-02-17T18:47:16.347

大多数测试不测试任何东西。
您编写一个 fileopen() 函数和一个单元测试，如果文件不存在则失败，如果文件存在则成功。伟大的！现在你检查它是否适用于 BIG5 中文的文件名？在 NFS 共享上？在 USB 密钥上的文件和 UAC 打开的 vista 上？

问题是单元测试是由编写函数的同一个程序员编写的，使用相同的假设集并具有相同的技能水平。要真正工作，测试必须由其他人编写，仅针对已发布的规范，而他们没有看到代码。- 在大多数公司中，仅仅获得书面规格将是一个突破！

单元测试检查单个函数代码中的错误。它们可以用于数据访问层、数学库等，其中输入/输出是众所周知的并且内部结构很复杂，但在很多情况下它们只是浪费时间。
当错误是由于代码的不同部分之间或与操作系统和用户的交互引起的时，它们会失败。诸如高/低 DPI 设置弄乱对话框或交换“。”的外语设置等问题 和 ',' 通常找不到。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-02-17T17:17:27.247

已经对单元测试的 ROI 进行了研究 - 请参阅[这个问题](https://stackoverflow.com/questions/237000/is-there-hard-evidence-of-the-roi-of-unit-testing)。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-02-17T17:24:55.247

我发现很多对单元测试不感兴趣的开发人员。当你开始时，似乎总是有很多工作却没有什么回报。没有人愿意报名额外的工作，所以他们抵制。一旦人们开始，他们通常会热情地坚持下去，但让他们开始可能很难。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-02-17T19:08:23.457

除了采用单元测试的问题之外，单元测试并不总是值得的，尽管总的来说我认为如果应用得当的话。单元测试没有什么特别之处可以避免它们容易受到不良构造的影响。

单元测试有成本（创建、维护和运行），并且只有在它们提供比这些成本更大的好处时才值得。测试创建与其他任何技能一样，需要特定的经验和知识才能成功。如果没有足够的经验，即使是经验丰富的开发人员也很容易创建不值得的低质量、低价值和/或高成本的单元测试。考虑到判断单元测试的价值是多么困难，尤其如此。

此外，单元测试只是提高代码质量的一种方法，但不是唯一的方法。在某些情况下，对于某些团队来说，这可能不是提高软件质量的最有效方法。

请记住，在单元测试中投入大量精力并不能保证软件质量。而且，也可以在没有任何单元测试的情况下生产出最高质量的软件。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-02-17T17:12:51.063

有很多公司实际上没有按照最佳实践做任何事情。没有代码审查，没有单元测试，没有测试计划，什么都没有，只是靠他们的裤子。

以此为契机，让他们使用持续集成平台并开发单元测试！简单的方法来打动你的力量并同时提高代码的质量和稳定性

编辑：至于原因，我认为他们根本不知道当前的工具使 CI 和单元测试异常容易。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-02-17T21:38:40.020

好吧，我的公司还没有使用 TDD 或单元测试。老实说，我们不知道该怎么做。显然，我们可以为 CapitalizeString() 等愚蠢的函数做到这一点，但我们不知道如何为具有复杂对象的高度复杂系统做到这一点。此外，大多数受访者的经验要么为零，要么经验有限。似乎单元测试在 SO 人群中很重要，但在可用的工作池中并不是特别大。

TDD 是一个单独的主题。我们在道德上反对 TDD。我们不是牛仔程序员，但我们确实相信它会阻碍项目的创造力和灵活性。此外，让编写单元测试功能的编码员毫无意义。当我做某事时，我会针对我能想到的所有边缘情况进行编码。我需要的是另一个大脑来寻找我可能错过的东西。我们没有那个。团队规模小且独立。

简而言之，我们不相信 TDD，但我们想进行单元测试。我们只是没有这样做的经验，也不容易找到。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-02-17T17:25:31.470

单元测试应该只是代码开发工作流程的一个自然部分，就像编译器一样。

但是，这需要对管理层进行单元测试的好处的教育。不过，初级开发人员产生这种影响的机会相对较低。因此，一家公司是否支持单元测试取决于他们是否有一位高级开发人员或架构师是单元测试的倡导者。

我相信这就是您的问题**“缺少什么以及为什么没有更多公司进行单元测试”**的答案。:-)

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2009-02-17T21:30:29.027

据我所见，很多公司都有庞大的、高度耦合的代码库，实际上无法进行单元测试。它们也没有像样的可测试要求，因此单元测试将针对“已构建”的实际要求进行测试。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-02-18T03:37:15.120

我不认为懒惰是糟糕的单元测试的根本原因。对于我的公司来说，时间限制和“完成它”的态度是进行单元测试的最大障碍。此外，我们的系统失败的地方往往更多是在集成级别（服务、数据库访问、需要特定数据进行测试的复杂查询），而不是“单元级别”。这些东西只是更难测试，如果你几乎没有足够的时间来完成这个功能，你可能没有时间同时完成任何有用的测试。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-02-17T17:13:37.817

它可能是您已经提到的几件事的组合。很难衡量 TDD 节省的成本。如果您想外包您的 IT，您可以显示您每年为员工支付的费用与外包成本；它非常具体。你怎么说，“哦，这个测试发现了一个错误，我需要 4 个小时来调试和修复......”？

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-02-17T17:19:19.270

有些地方不使用它的原因仅仅是因为开始和继续都需要大量的工作。在某些经理看来，编写单元测试所花费的时间与编写实际功能所花费的时间差不多，就像您将开发人员的工作效率降低了一半一样。

最重要的是，您建立团队（或某人）需要将基础设施放置到位并进行维护。

正如[艾伦](https://stackoverflow.com/questions/557764/if-unit-testing-is-so-great-why-arent-more-companies-doing-it/557781#557781)所说，很多地方根本不使用最佳实践——他们只是想看到一些有形的东西。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-04-03T00:06:18.593

我认为程序员必须开始这样做。作为开发的一部分，一些简单的测试很容易证明是合理的。

几乎总是需要像单元测试这样的东西来快速调试。只需解释启动测试比安排正确输入、设置调试器断点、启动应用程序等要快多少。

在您的代码中记录测试。只需发表评论，解释测试在哪里以及如何运行它。未来的程序员会看到它，并希望测试能够传播开来！

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-02-18T06:41:49.607

单元测试是大多数人听说过的那些黑盒术语之一，但不知道单元测试的确切构成，从哪里开始，如何编写它们，如何实际运行测试，它们究竟应该测试什么等等等等等

在很多情况下，不确定的开发人员更容易将它们视为不必要的或仅“企业级开发人员”需要的一些糖衣。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-02-17T22:46:49.483

当然，在理想的世界里，你不能反对进行单元测试。

但是，是否编写单元测试取决于许多事情：

*   该软件将如何使用。如果您只是为自己编写软件，您会编写单元测试吗？可能不是。如果您正在编写用于商业销售的预打包软件，那么可能是的。

*   有多少人维护代码....如果只有您，那么您可能非常了解它，在做出更改后有足够的信心快速运行代码足以确保没有任何问题。如果最初没有编写代码的其他人现在必须维护它，那么单元测试将帮助他们相信，当他们更新代码以修复一个大问题时（这显然没有在单元测试中捕获！）他们没有破坏任何东西.

*   代码复杂度：只测试需要测试的代码。单行变量分配方法不需要测试。具有多个执行路径的 50 行方法可能会。

*   实际的商业考虑：事实上，编写单元测试确实比不这样做需要更长的时间。如果您正在编写具有不确定商业前景的原型软件，那么在快速编写代码（现在足够好）与在 2 周内完成单元测试代码（效果更好）之间是有回报的。有时，快速找出（消费者的胃口）软件是否会有类似的短架并继续进行下一个项目是值得的。

正如其他人指出的那样，测试与编写它的人一样好。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-06-18T11:04:36.130

主要原因是许多开发人员和开发经理不知道存在单元测试，也不知道如何使用它们。

第二个原因是单元测试只能（以合理的方式）与已经满足某些质量标准的代码一起使用。一些现有的代码库可能不属于该类别。

第三个原因是懒惰和/或廉价。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-11-19T17:09:19.413

因为单元测试只有在你编写可测试的代码时才有用。编写可测试的代码很困难。人们很懒惰和/或便宜。

编辑：细致入微的“懒惰”为“懒惰和/或便宜”；在极少数情况下，人们实际上有能力和意愿来编写测试，但他们还有其他更直接影响底线的事情要做。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2012-03-05T05:22:42.157

我是单元测试的忠实拥护者，我也是一家为各种客户类型进行合同开发项目的公司的合伙人。在一个月内，我们将接触 3-4 个不同规模的不同项目。

If a project seems like it's going to be a one off, I'm not going to invest heavily in unit testing because that unit testing doesn't pay off for my business. On those types of projects I'm going to unit test things that I'm uncertain/unfamiliar with or that could change frequently (such as a parser for a data source I don't control.)

Whereas if I'm building something that I know is going to have a long life time, is a larger piece of work, that I'll be working with through multiple iterations, or will have a large impact on my clients if an error occurs, I'm going to invest in more unit testing. Again priority of tests revolves around uncertain/unfamiliar/changing code.

I think unit tests ought to revolve around the complexity of a task, as well as whether they're going to pay off. There's no sense in writing extra code that isn't going to get used.

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-02-17T17:19:04.873

根据我的经验，这实际上取决于您正在编写的软件。我发现为 UI 编写单元测试非常困难。我只对系统中具有明确输入/输出的部分使用单元测试。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-02-17T17:57:52.580

> 我想念单元测试——它只是让生活更轻松。

实际上，这*并不是*公司采用单元测试的充分理由。

一个充分的理由可能是“更便宜”（和/或“更好”）：这对于单元测试来说并不容易证明。

唯一好的理由可能是“编写单元测试是对开发人员时间的最佳利用”，这确实很难证明 IMO：在某些地方，对于某些软件，对于某些开发人员来说，这可能是正确的，而在其他地方则不是。

有很多开发人员不考虑单元测试的世界：包括一些认为其他形式的测试（例如自动化集成/功能测试）可能更便宜且更有价值的开发人员，例如[我是唯一不考虑的开发人员吗？不喜欢单元测试？](http://discuss.joelonsoftware.com/default.asp?joel.3.725817.37)

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2009-02-17T18:02:56.873

人们很懒惰，只有在被迫时才会采取改变。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-02-17T19:25:18.610

像大多数好的想法一样，采用更多的是与组织路径依赖有关，而不是想法的质量。

在大多数已经交付产品的公司中，已经建立了一个实质性的 QA 部门，并配备了一名高级 QA 负责人。测试是 QA 团队的领地。

QA 团队不太可能编写单元测试代码，因为公司通常不会为 QA 团队配备重型编码员。

编程团队不愿意编写测试代码，因为它会与 QA 团队产生冲突。

我已经看到在 QA 没有被拆分为单独的工作职能的小组中，对单元测试的兴趣和采用率越来越高

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2009-02-17T19:59:53.783

我认为部分问题在于开发人员期望业务人员拥有相同的价值观，并且真正关心“我们是否应该进行单元测试？”的答案。我们没有事先得到业务部门的批准来使用高级语言而不是汇编语言——这通常是完成工作的明智方式。

关键是，*我们*是唯一有资格打电话的人（这并不是说我们所有人都对该主题有相同的了解）。此外，即使您的团队根据政策不进行单元测试（或命名您的当前方法），通常也不意味着*您*不能这样做。

事实是，我们无法真正证明我们所做的大多数事情的投资回报率太细了。为什么单元测试要坚持这种不合理/非典型的证明标准，这超出了我的理解……

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-02-18T01:38:42.987

如果您想在测试中向所有人推销，请执行以下操作：

1.  写一堆测试。
2.  通知更改代码并未能通过您的测试的其他开发人员。
3.  他们会修复他们的代码。
4.  现在您可以在没有那些特定错误的情况下发布。

即使是经理也能理解这一点。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-02-18T06:34:13.197

我的 2 美分：

*   它需要一些教育和纪律，但新毕业生已经具备了适当的知识。
*   使用更好的工具可以减少测试开销，这也在发生（重构等）

**所以，这只是时间问题。**

在 Martin-Coplien 辩论中，Bob Martin 断言：

> “如今，开发人员发布他没有在单元测试中执行的代码行是不负责任的。”

[ [http://www.infoq.com/interviews/coplien-martin-tdd]](http://www.infoq.com/interviews/coplien-martin-tdd])

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-06-18T10:46:31.567

公司没有执行单元测试，原因与许多网站写得不好的原因相同——无知，人们坚持旧习惯。在我的公司，自从我们开始单元测试（使用 Nunit 和[Typemock](http://www.typemock.com)）以来，我们达到了更高的代码覆盖率并在更短的上市时间内发布了软件。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2009-02-17T18:38:43.090

大多数公司都是无用的。显然，不是你（或我）为之工作的那个。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2009-02-17T21:06:55.480

有两件事是单元测试的障碍

1.  一切新事物都很难做到
2.  没有可衡量的利润的一切都是坏的。
3.  人类是懒惰的。确实是开发商。

在我的公司（> 5.000 emp）单元测试“存在”，但没有机会进行 TDD 或获得大的代码覆盖率。要实现它太难了。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-02-17T23:24:14.977

到目前为止，我已经为 3 家公司工作过，最近才开始编写“官方”NUnit 测试，我不得不说我是一个忠实的粉丝。然而，在过去的几周里，我注意到了两点：

1.  这取决于应用程序 - 应用程序的某些应用程序/部分可以非常容易地进行单元测试。每次执行基本相同的操作并产生易于识别的结果的函数。有些部分不这样做：打印水晶报告或修改图像的代码块 - 这里实际上需要眼球并且可能更好/更快。这些区域可能会阻止人们尝试编写测试。然后他们开始思考，如果某些领域不能进行单元测试，那何必呢？

2.  测试的粒度——许多 DEV/QAs 已经有某种自动化来“测试”一个功能，并且对这与单元测试有何不同感到困惑。根据他们的测试，可能不是。这里需要一些时间来理解的重要一点是，一个好的单元测试是完全细化的。它测试有意义的最小逻辑，使其可重复、自动并希望始终有效。我花了一点时间才真正体会到它的用处，尤其是当您拥有庞大的代码库并且喜欢在进行更改后运行回归测试以查看您是否只是对整个应用程序进行了测试。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-02-18T00:47:29.987

我认为为将来要使用的代码编写一个好的单元测试覆盖率是值得的。例如，当您在一家产品公司工作时，通过编写高质量的单元测试用例，您只是在进行时间投资，因为您知道编写测试用例的所有辛勤工作都会得到回报，并使您的生活更轻松。

可悲的事实是，许多软件程序员从事内部应用程序开发或承包工作，只是试图将一些软件推出市场。在这些情况下，时间投入没有多大意义，因为你很可能再也看不到这堆代码了。

我们都可以争辩说，坚持可靠的软件开发实践是每个开发人员的责任。然而，投资回报率对个人开发人员和管理人员一样意义重大。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-02-18T01:38:18.807

这听起来有点像 AA 会议。

我是一名软件工程师。

我在 XMAS 和我的兄弟（他是一名业务分析师）谈论软件工程。

*   他已经作为 BA 工作了 10 年。
*   谈话开始进行测试。
*   他从未见过（或听说过）自动单元测试。
*   甚至听说过开发人员这样做。
*   在那段时间里，他为一些大型“字母”公司工作，签订大型政府合同。

据我所知，在涉及的 100 名开发人员中，没有一个人听说过单元测试。

我目前工作的前辈使用自动验证测试，并且很少进行单元测试。不用说代码需要大量重构。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2009-08-15T20:07:10.223

我认为主要原因很简单，大多数经理和开发人员对质量不够关心。所以他们倾向于认为编写和自动化单元测试是太多的努力（实际上是这样）而没有什么好处。

也许我们对这些好处无能为力，但我们应该能够通过改进相关工具来降低创建和运行测试的成本。

我发现大多数当前用于开发人员测试的开源工具都非常原始。不幸的是，业界似乎没有太大的兴趣来改善这种情况。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2009-02-17T18:29:07.807

很简单，编写和更新单元测试需要花钱。大多数公司以前的软件都没有单元测试，编写成本太高。所以他们不这样做，这会增加开发过程的时间，所以他们也不会将其添加到新功能中。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2009-02-17T22:03:32.753

我认识一个人，他会用一个按钮查看一个表单并说“这太过分了，这应该有一个命令行界面，所以它可以在脚本中自动化”，但他从来没有真正落后于单元测试。我只是不明白。对变化的恐惧可能是其中的一部分，但我提出要带他完成整个过程，但他拒绝了。

显然，我现在的公司并没有强制执行它们，我只是在可能的情况下自己编写它们。我发现预先设置测试会导致更好/更干净的代码，因为在考虑如何测试某些东西时，您通常必须考虑它的以后使用。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-03-21T19:26:02.180

当您有一些作为服务器运行的代码时，单元测试很棒（易于实现，易于确定您已经编写了足够的测试示例）。

示例 1：您应该在具有 3 个或更多站点版主评论的数据库帖子中标记什么是测试变体

*   检查没有评论的帖子 -> 期望没有标记
*   检查带有一条评论的帖子 -> 期望没有标记
*   检查普通用户发表的带有 3 条评论的帖子 -> 不希望有任何标记
*   检查普通用户有 3 条评论和版主至少 1 条评论的帖子 -> 不希望有任何标记
*   检查普通用户的 3 条评论和版主至少 3 条评论的帖子 -> 期待该帖子的标记

明确的？

示例 2：您有一个输出帖子列表的网站页面

我们应该如何检查此列表在某些浏览器中是否未对齐？我们应该如何检查这个列表的颜色是否正确并且我们没有破坏样式？

没有简单的解决方案可以自动执行此操作

所以单元测试创​​建期间的任务是了解 - 你可以将代码置于服务器操作模式 - 如果你可以创建测试，如果不能，则分解为碎片并为碎片创建测试或手动测试。

还有一件事——如果你有超过 10 到 12 个测试阶段而无需大量代码修改，你将获得单元测试的经济性。

问候， 帕维尔

# sql - Transact-SQL 速记连接语法？

> ID：557767
> 
> 赞同：15
> 
> 时间：2009-02-17T17:10:00.243
> 
> 标签：sql, join

在处理遗留代码时，我已经注意到几次，您可以使用 sql 进行左右外连接

```
=* 
```

作为“右外连接”的一种简写和

```
*= 
```

在这样的语句中作为“左外连接”的一种简写：

```
select table1.firstname, table2.lastname
from table1, table2
where table1.id *= table2.id 
```

我猜想对于不同类型的连接，还有像这两个这样的其他运算符，但我还没有找到任何关于它的完整文档。那么你知道任何好的文档链接吗？

我个人认为使用这些运算符看到的 SQL 语句比使用拼写语法时更难理解，那么使用速记版本有什么好处吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-17T17:13:43.980

=* 和 *= 不符合当前的 SQL 标准，我相信这些运算符很快就会被弃用，你应该始终使用标准的连接语法。您提到的其他运算符令人困惑，需要离开，当我在数据库对象中看到这些运算符时，我感到畏缩。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-02T16:50:26.417

它具有意外后果的原因是因为它将把 ENTIRE where 子句解释为 JOIN 子句。例子：

选择1：

```
select * from table a left join table b on a.id=b.id
     where b.name = "hello world" 
```

VS

选择2：

```
select * from table a left join table b on a.id=b.id and b.name = "hello world" 
```

这 2 个选择返回不同的结果。当您编写这样的语句时：

```
select * from tablea,tableb where tablea.id *= tableb.id and b.name="hello world" 
```

我希望大多数人会想要 Select1 的结果......但实际上您会从 Select2 获得结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:10:45.777

如果您使用的是 SQL Server，则在任何情况下都不要使用该语法。有时会返回不正确的结果，因为有时 SQL Server 将其正确解释为外连接，有时它将该语法解释为交叉连接。由于两者的结果集截然不同，因此您永远不能依赖使用此语法的结果。此外，SQL Server 2008 是 SQL Server 的最后一个版本，它甚至允许使用 sysntax。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T18:47:59.263

我不会使用 *= 或 =(+) 语法，因为它们与其他 RDBMS 不兼容，甚至在 MSSQL Server 与更高版本兼容的情况下，除非您启用低兼容性级别。那么，在某些时候 MS 会完全放弃对它的支持，这是一个有效的担忧。

我花了一些时间来习惯改变我的“旧”习惯。我更喜欢 *= 语法，因为它的输入更少，并且使用更简单的相等连接流程（这仍然完全有效且可以接受）

我对转向使用 JOINS 的反对意见之一是我在使用它们的查询示例中发现的所有输入和混乱。

我发现的一些技巧只是格式化问题并知道真正需要什么。'INNER' 和 'OUTER' 的使用是完全多余和不必要的。我还使用方括号来分隔连接子句的结尾，并将每个条件放在自己的行中：

```
FROM blah b LEFT JOIN blah2 b2 ON (b.ID = b2.ID)
LEFT JOIN blah3 b3 ON (b.ID = b3.ID)
... 
```

有人说 ANSI JOIN 语法更难搞砸，因为使用相等连接很容易错过连接参数......实际上，我在忘记说“WHERE”时遇到了更多困难，而解释器仍然认为我在定义连接条件而不是搜索条件，这会导致各种难以找到/奇怪的结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T17:16:01.883

我个人的看法（在 SQL 和 TSQL 工作 6 年以上）是，这种遗留风格只会让其他不熟悉遗留语法的开发人员更难轻松理解你的代码。如果性能不受影响，我总是更喜欢更冗长和描述性的语法 - 你永远不知道什么时候必须通过该代码的支持:)

# tfs - Best way to integrate StyleCop with TFS CI

> ID：557773
> 
> 赞同：16
> 
> 时间：2009-02-17T17:11:52.317
> 
> 标签：tfs, msbuild, coding-style, continuous-integration, stylecop

I've been doing research on how to enable source analysis for the project I'm working on and plan to use StyleCop. The setup I have is a TFS Server for source control, using TFS Continuous Integration. I want to enable source analysis for CI builds and daily builds run on the build machine, and not only for those run on developers' machines.

Here's an article from the documentation of StyleCop that I read on the subject: [http://blog.newagesolution.net/2008/07/how-to-use-stylecop-and-msbuild-and.html](http://blog.newagesolution.net/2008/07/how-to-use-stylecop-and-msbuild-and.html). It basically modifies the csproj file for the purpose.

I've also read other opinions about how StyleCop should be integrated with build automation, which advise doing the same thing using build tasks:

[http://blog.newagesolution.net/2008/07/how-to-use-stylecop-and-msbuild-and.html](http://blog.newagesolution.net/2008/07/how-to-use-stylecop-and-msbuild-and.html) [http://freetodev.spaces.live.com/blog/cns!EC3C8F2028D842D5!400.entry](http://freetodev.spaces.live.com/blog/cns!EC3C8F2028D842D5!400.entry).

What are you opinions? Have you had similar projects and done something like this?

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-25T20:10:45.230

Some points for using StyleCop in general:

*   You don't need to have StyleCop installed on your (or the build) machine - simply add StyleCop's binaries to your source control (about 1.5 MB of stuff)
*   Then simply add the relative reference to your project files, like this (I left out < and >):

    Import Project="..\..\lib\Microsoft StyleCop\Microsoft.StyleCop.Targets"

*   We treat all StyleCop warnings as errors using the `StyleCopTreatErrorsAsWarnings` setting in the project file.

*   For legacy projects, you can use the tool provided by Microsoft to automatically set all existing source files to ignore.
*   You can put the StyleCop settings file (`Settings.StyleCop`) in the root directory where your VS solution is (and of course place it under the source control). StyleCop knows how to find this file automatically (by loooking up the directory tree). This way you can have custom settings for each solution.
*   We turned off certain StyleCop rules which we think aren't very practical to follow.

This way StyleCop will be integrated in your compile step and as such it will become a part of the CI build.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-25T12:00:05.897

We use the approach in the following articles successfully on a couple of projects...

[http://blogs.msdn.com/sourceanalysis/pages/source-analysis-msbuild-integration.aspx](http://blogs.msdn.com/sourceanalysis/pages/source-analysis-msbuild-integration.aspx) [http://blogs.msdn.com/sourceanalysis/archive/2008/11/11/introducing-stylecop-on-legacy-projects.aspx](http://blogs.msdn.com/sourceanalysis/archive/2008/11/11/introducing-stylecop-on-legacy-projects.aspx)

basically you set a couple of environment variables up, reference them in all the .csproj files so that you can cater for different working directories for each individual developer, install the StyleCop MSBuild components on the build machine and you're off. No changes to the team build required.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-04-01T20:18:31.927

Go to Visual Studio, right click Solution > Manage Nuget Packages > Install **StyleCop.MSBuild**.

That's it =)

# php - 如何在javascript中动态调用php函数

> ID：557778
> 
> 赞同：4
> 
> 时间：2009-02-17T17:12:35.510
> 
> 标签：php, javascript, function

我有一个带有以下 js 函数的 index.php：

```
function returnImageString() {
    return "<?php include 'inc/image.functions.php'; echo getRandomImages(7); ?>";        //This isn't dynamic; this will always return the same images.  How do I fix this?
} 
```

但是，当页面加载时，会调用 php 脚本并将结果添加到源代码中，如下所示：

```
function returnImageString() {
    return "images/20.11.A1B9.jpg|images/8.14.47683.jpg|images/19.10.FBB9.jpg|images/21.12.9A.jpg|images/8.11.1474937909.jpg|images/8.15.99404.jpg|images/8.10.jpg|"; //This isn't dynamic; this will always return the same images. How do I fix this?
 } 
```

我想要发生的是每当我调用 js 函数（returnImageString）时，我希望它每次都调用 php 函数（因为 php 函数返回一串随机图像位置），而不是在 js 函数中硬编码字符串。

有人可以指出我正确的方向吗？谢谢！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-17T17:21:44.600

这是不可能的，因为您将客户端行为与服务器端行为混​​合在一起。您需要做的是向服务器创建一个 AJAX 请求。

如果您使用的是[jQuery](http://www.jquery.com)之类的库（您真的很想这样做，因为它使 AJAX 变得轻而易举），您可以这样做：

## PHP 代码（可能是 randomImages.php？）

```
// query for all images
// $_GET['limit'] will have the limit of images
// since we passed it from the Javascript
// put them all in an array like this:
$images = array('images/20.11.A1B9.jpg','images/20.11.A1B9.jpg',...);
print json_encode($images); // return them to the client in JSON format.
exit; 
```

## 客户端Javascript

```
function getRandomImages(limit) {
    // make request to the server
    $.getJSON('/path/to/randomImages.php', {limit: limit}, function(data) {
        // data is now an array with all the images
        $.each(data, function(i) {
            // do something with each image
            // data[i] will have the image path
        });
    });
} 
```

或者，如果图像的数量是有限的，你可以跳过所有这些疯狂的事情，简单地用一个包含所有图像的数组并从 Javascript 本身生成 8 个随机图像。这对于较小的数据集甚至更大的数据集可能会更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T17:14:56.473

您无法直接执行此操作，因为 PHP 在服务器上进行解释，而您在客户端使用 JavaScript。但是，如果您在服务器上创建一个页面 random-image.php，您可以使用 AJAX 获取数据并在返回时在服务器端对其进行操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T17:17:06.327

你有两个选择：

1.  使用 AJAX
2.  使用 PHP 在脚本标签内回显一个 JavaScript 数组（可能的图像值），然后构建一个 JavaScript 函数以在调用时随机选择其中一个。

在我看来，第二种选择似乎是最好的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-22T18:32:51.227

我前一段时间做了这个......也许它可以帮助你。这是使用 ajax 在 javascript 中调用 php 函数的示例。（我使用 gzcompress） php 文件必须命名为 foo.php 才能与此演示一起使用。

javascript:

```
//lib
(function(a){for(var b in a)(function(c){a[b]=function(){c.apply(this,arguments);return this}})(a[b])})(XMLHttpRequest.prototype);

XMLHttpRequest.prototype.$p=function(a,b){for(b in a)this[b]=a[b];return this};

(function(a,d,i){for(i in d=document.getElementsByTagName('*'))a[d[i].id]=d[i]})(document);
//lib

function gzcompress(s,c){

    var buffer;

    (new XMLHttpRequest)

    .$p({onreadystatechange:function(){if(this.readyState>3){

        buffer = this.responseText;

    }}})

    .open("POST","foo.php",!1)
    .setRequestHeader("Content-type","application/x-www-form-urlencoded")
    .send(
        "s="+s
        +"&"+
        "c="+c
    );
    return buffer;
}

//look! it's gzcompress inside javascript! it's magical!
document.myDiv.innerHTML = gzcompress("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",2) 
```

php:

```
<?php 

echo gzcompress($_POST['s'], $_POST['c']);

?> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-29T20:37:10.380

您可以使用我的 mwsX 库在 Javascript 中使用您的 PHP 函数。

mwsX 库： [https ://github.com/loureirorg/mwsx](https://github.com/loureirorg/mwsx)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-17T17:13:26.757

这就是通常所说的 Ajax。谷歌为它。

# clickonce - Clickonce 升级和应用程序设置

> ID：557780
> 
> 赞同：0
> 
> 时间：2009-02-17T17:12:41.673
> 
> 标签：clickonce, settings

我们有一个使用 Clickonce 部署的 winform 应用程序，它有一个配置文件。

我们需要的是当有可用的升级时，将本地机器中的配置与来自部署的配置合并。

有什么想法或经验吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T17:25:40.893

如果您在访问任何设置之前调用它，Properties.Settings.Default 上有一个 Upgrade 方法应该可以做到这一点。

# sql - 如何在 SQL 中编写“标记”查询？

> ID：557785
> 
> 赞同：3
> 
> 时间：2009-02-17T17:13:12.313
> 
> 标签：sql, sql-server-2005, tsql, stored-procedures

我在我的网络应用程序中添加“标记”功能。我的应用程序表结构如下；

`Tag:`

```
(TagId INT IDENTITY, TagName VARCHAR(60)) 
```

`TaggedRecords:`

```
(TaggedId INT IDENTITY, TagId, TaggedRecordId) 
```

现在，我希望当任何人向任何记录添加标签时，应该使用单个 sql 查询或使用存储过程执行以下操作；

*   标签是否已经存在于“标签”表中？
*   如果标签存在，那么它会在“TaggedRecords”表中插入一行
*   否则，如果标签不存在，则首先在“Tag”表中插入标签，然后获取新添加标签的 Id 并在“TaggedRecord”表中插入一条记录

基本上，我对使用单个查询或最多两个 sql 查询来执行这些操作更感兴趣。我不想在 sql 存储过程中创建多个 If-Else 条件。

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T17:20:55.397

您基本上已经掌握了它，但是您可以通过更改顺序来提高效率。这是您的过程的一些伪 SQL 代码：

```
SELECT TagId FROM Tag WHERE TagName = @NewTag into @TagId

IF @TagId IS NULL THEN
    INSERT new tag, returning the new TagId into @TagId

INSERT new record into TaggedRecords 
```

不知道为什么你如此反对使用 if 子句......

* * *

要将新生成的 TagId 放入变量中，我们有两个选项，因为您使用的是 MSSQL：

*   使用[输出命令](http://www.select-sql.com/mssql/output-command-in-mssql-2005.html)：

```
    插入标签（标签名称）
    输出已插入.TagId INTO @TagId
    价值观（@NewTag）；
```

*   标签是唯一的，因此您应该能够将其 SELECT 退出：

```
    插入标签（TagName）值（@NewTag）；
    从标签中选择 TagId，其中 TagName = @NewTag INTO @TagId;
```

如果您想将其 SELECT 退出，如果您使用 IF EXISTS 子句，该过程可能会更好地阅读，但本质上您正在做同样的工作：

```
IF NOT EXISTS(SELECT TagId FROM Tag WHERE TagName = @NewTag)
BEGIN
    INSERT INTO Tag (TagName) VALUES (@NewTag);
    SET @TagId = (SELECT TagId FROM Tag WHERE TagName = @NewTag);
END
ELSE
BEGIN
    SET @TagId = (SELECT TagId FROM Tag WHERE TagName = @NewTag);
END

INSERT new record into TaggedRecords 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T17:27:52.387

这个怎么样...

```
CREATE PROC TagMe(@TagName VARCHAR(100),@TaggedRecordId INT)
AS

DECLARE @TagId INT

SET @TagId = SELECT TagId FROM Tag WHERE TagName = @TagName

IF @TagId IS NOT NULL
    BEGIN
    --Tag exists
        INSERT INTO TaggedRecords (TagId, TaggedRecordId) VALUES(@TagId,@TaggedRecordId)
    RETURN
    END
ELSE
    -- New tag
    BEGIN
        INSERT INTO Tag (TagName) OUTPUT inserted.id INTO @TagId VALUES(@TagName)
        INSERT INTO TaggedRecords (TagId, TaggedRecordId) VALUES(@TagId,@TaggedRecordId)
    RETURN
END 
```

没有对此进行测试，但理论应该是合理的:)

有关 OUTPUT 用法的另一个示例，请参阅我在[此链接上的帖子](https://stackoverflow.com/questions/352673/whats-the-best-way-to-update-a-single-record-via-sql-and-obtain-the-id-of-the-rec/352737#352737)

**编辑**

根据下面的评论，此版本使用 EXISTS ...

```
CREATE PROC TagMe(@TagName VARCHAR(100),@TaggedRecordId INT)
AS

DECLARE @TagId INT

IF EXISTS(SELECT TagId FROM Tag WHERE TagName = @TagName)
    BEGIN
    --Tag exists
        SET @TagId = SELECT TagId FROM Tag WHERE TagName = @TagName  
        INSERT INTO TaggedRecords (TagId, TaggedRecordId) VALUES(@TagId,@TaggedRecordId)
    RETURN
    END
ELSE
    -- New tag
    BEGIN
        INSERT INTO Tag (TagName) OUTPUT inserted.id INTO @TagId VALUES(@TagName)
        INSERT INTO TaggedRecords (TagId, TaggedRecordId) VALUES(@TagId,@TaggedRecordId)
    RETURN
END 
```

虽然我不确定（我相信我在这里与自己争论，但很多这些东西都是“取决于”的答案！）。这个示例实际上最适合更多地使用新标签，因为它只会执行一次 EXISTS 然后继续，而对于现有标签，它将执行 EXISTS 然后执行 SELECT。

嗯，选择你的 - 或者在音量下测试这两种方法:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T17:18:42.283

我可以问为什么吗？if/else 有限制吗？:)

看看你的情况，它看起来不需要超过 1 个 IF 子句。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T18:03:45.967

您在标记表中使用合并，然后在标记记录表中插入。这是 Oracle 语法，因此您必须对其进行调整，但想法是相同的：

```
MERGE INTO TAG
USING (SELECT @tagname as TAGNAME FROM DUAL) RECORD
ON (TAG.TAGNAME = RECORD.TAGNAME)
WHEN NOT MATCHED THEN INSERT (TAG.TAGNAME) VALUES (@tagname);

INSERT INTO TAGGEDRECORDS(TAGID) VALUES (SELECT TAGID FROM TAG WHERE TAGNAME=@tagname); 
```

我认为 SQL Server 在 MERGE 语句中还支持更多功能，因此您可以使用 WHEN MATCHED（插入 taggedrecords 表）子句来做一些事情。

查看 [MSDN 链接](http://technet.microsoft.com/en-us/library/bb510625.aspx)

# c# - 如何创建角色以放入数据库？

> ID：557791
> 
> 赞同：1
> 
> 时间：2009-02-17T17:14:04.167
> 
> 标签：c#, .net, database, linq-to-sql, roles

我希望在用户进行身份验证（登录）以访问应用程序之后为每个用户创建一个角色，我将赋予一些角色并将该角色保存在数据库中。我将使用数据库“aspnet.mdf”和 Linq toSql 来存储数据，但在我需要知道如何在 c#(WPF) 中创建角色之前，我希望在数据库上添加角色，这样我就可以为每个用户分配角色我希望的正确角色。你知道怎么做吗？？？我将使用数据库“aspnet.mdf”作为示例，因为我认为仅测试我的应用程序就很好（我需要此功能来开发项目）。

非常感谢。

很好的问候，

再见

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T18:47:43.053

这就是你如何完成类似的事情。我不确定你为什么要为每个用户创建一个角色，这有点违背角色的目的。无论如何，这样的事情会起作用：

```
// Check User exists
if (Membership.GetUser("admin") == null)
    Membership.CreateUser("admin", "pass", "admin@domain.com");            

// Check Role exists or create
if (!Roles.RoleExists("AdminRole"))
    Roles.CreateRole("AdminRole");

// Check Users in Roles
if (!Roles.IsUserInRole("admin", "AdminRole"))
    Roles.AddUserToRole("admin", "AdminRole"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T17:18:26.370

你没有。

如果您使用的是 ASP.NET 的成员资格框架，则不要使用 LinqToSql 来接触它。您使用 ASP.NET 的[成员资格框架](http://msdn.microsoft.com/en-us/library/ms998347.aspx)。

# c++ - 查找 unix 平台名称

> ID：557800
> 
> 赞同：2
> 
> 时间：2009-02-17T17:16:36.093
> 
> 标签：c++, linux, bash

我希望能够根据平台名称确定输出文件夹：AS3、AS4、AS5、SUN。

我不知道如何从系统中提取平台名称。我尝试过：

```
uname -a

file /bin/bash 
```

谢谢

**解决方案**

./lsb_release -a

向保罗·迪克森致敬

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T17:24:37.247

我认为您必须查看每个操作系统的特定文件。例如，在 SunOS 上，您可以键入：

```
uname -s -r -v 
```

对于 RHEL，请检查`/etc/issue`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T17:30:15.047

一些 linux 系统将支持[lsb_release](http://refspecs.freestandards.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/lsbrelease.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T17:31:31.503

您可以包含[sys/utsname.h](http://www.opengroup.org/onlinepubs/007908775/xsh/sysutsname.h.html)以获取 Unix 平台上的操作系统信息。

```
struct utsname buf;
uname(&buf);
cout << buf.sysname << endl; 
```

这至少会给你平台的名称。我不确定“输出文件夹”是什么意思，所以我不确定在那之后你需要做什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T17:47:41.840

看起来您想要（至少部分）发布号。在 Red Hat 上，您可以获得这样的版本：

```
> cat /etc/redhat-release 
CentOS release 4.3 (Final)
Red Hat Enterprise Linux WS release 4 (Nahant Update 4) 
```

许多其他 Linux 发行版在 /etc 中也有自己的文件，这些文件也给出了版本号：

*   `/etc/redhat-release`
*   `/etc/SuSE-release`
*   `/etc/ubuntu-release`
*   `/etc/fedora-release`

等等

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T13:37:26.673

在过去（甚至在 Linux 之前），我发现`/bin/arch`它在 Unix 系统中相当普遍，并且对于获取有关您的硬件平台的一些信息很有用。（在 Linux 上，它返回与 相同`uname -m`）。

# sql-server - SQL Server 事务复制和添加新表

> ID：557803
> 
> 赞同：0
> 
> 时间：2009-02-17T17:16:51.617
> 
> 标签：sql-server, replication

我有一组非常大的现有表通过专用 VPN 连接在两台服务器之间复制（事务性）。我需要添加一个新表。重新加载所有表不是一种选择。

我认为只需将新文章添加到出版物中，它就会复制它们，但这不起作用。当然，需要告诉订阅者有关新文章的信息。然后我在发布器上选择了 Generate Snapshot，但我不知道它在做什么（可能是编写了*所有*数据的脚本？）所以我关闭了它。也许我应该让它运行？我不知道。

那么如何安全地将新文章添加到现有订阅中呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:44:41.673

我找到了答案。问题是我一开始没有使用初始快照来初始化订阅者。我使用了不同的方法（备份和恢复方法），这意味着我必须在启动事务复制过程之前手动传输架构和数据。

# c# - 是否可以在 .Net 应用程序中读取 Paradox 7.x .db 文件？

> ID：557811
> 
> 赞同：2
> 
> 时间：2009-02-17T17:17:53.503
> 
> 标签：c#, odbc, paradox

我正在尝试在 .Net 3.5 应用程序中读取 Paradox 7.x .db 文件，但我没有成功。

首先，当我以用户或系统dsn身份注册odbc时，Microsoft Paradox ODBC Driver仅显示最高5.x的版本，因此看起来它不支持Paradox 7.x版本。

在[connectionsstrings.com](http://www.connectionstrings.com/paradox)，我找到了应该适用于Paradox 7.x 的连接字符串：

```
Provider=MSDASQL;Persist Security Info=False;Mode=Read;
Extended Properties='DSN=Paradox;DBQ=C:\mydbfolder;
DefaultDir=C:\mydbfolder;DriverId=538;FIL=Paradox 7.X;MaxBufferSize=2048;
PageTimeout=600;';Initial Catalog=C:\mydbfolder 
```

但是当我尝试使用数据适配器测试连接时，出现以下异常：

“错误 [IM002] [Microsoft][ODBC 驱动程序管理器] 未找到数据源名称且未指定默认驱动程序”

我已将 ODBC 指定为用户 DSN 和系统 DSN，但一直收到相同的错误。

关于我应该做什么的任何线索？

谢谢，

佩德罗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-01-09T21:21:07.947

[http://www.progware.org/Blog/post/Connecting-to-a-PARADOX-DB-with-C-%28Vista-XP%29.aspx](http://www.progware.org/Blog/post/Connecting-to-a-PARADOX-DB-with-C-%28Vista-XP%29.aspx)

和

```
ConnectionString.Append(@"Provider=Microsoft.Jet.OLEDB.4.0;");
ConnectionString.Append(@"Extended Properties=Paradox 7.x;");
ConnectionString.Append(@"Data Source=Z:\Dane;");
//ConnectionString.Append(@"Mode=ReadWrite;");
ConnectionString.Append(@"Mode=1;"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T17:22:43.693

好奇，为什么不使用 OLEDB 提供程序，然后使用 System.Data.OleDb 名称空间中的类？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-08-08T16:46:25.330

这是我过去编写的一段代码，它可以工作。它基于 Przemysław Staniszewski 在此线程其他地方的帖子中的死链接中的代码。

它使用 OleDbConnection 和 OleDbDataAdapter 打开一个悖论数据库文件，并将该文件的内容加载到 DataTable 变量中。

这段代码对我有用，用于匆忙的一次性工作，缺乏错误处理。它可能对你有用。

```
 /// <summary>
        /// ConnectToTable
        /// </summary>
        /// <param name="pFullPath">Full path to .DB file</param>
        /// <param name="pTableName">Name of table to load</param>
        public static void ConnectToTable(string pFullPath, string pTableName)
        {

            OleDbConnection _ParadoxConnection = new OleDbConnection();

            StringBuilder ConnectionString = new StringBuilder("");
            ConnectionString.Append(@"Provider=Microsoft.Jet.OLEDB.4.0;");
            ConnectionString.Append(@"Extended Properties=Paradox 7.x;");
            ConnectionString.Append(string.Format(@"Data Source={0}", pFullPath));

            _ParadoxConnection.ConnectionString = ConnectionString.ToString();

            _ParadoxConnection.Open();

            using (OleDbDataAdapter da = new OleDbDataAdapter(
                string.Format("SELECT * FROM {0};", pTableName)
                , _ParadoxConnection))
            {
                DataTable tab = new DataTable
                {
                    TableName = pTableName
                };
                da.Fill(tab);

                //tab now contains a data

                //Get the column name
                foreach(DataColumn col in tab.Columns)
                {
                    Console.WriteLine(col.ColumnName);
                }

                //do the rows
                foreach (DataRow row in tab.Rows)
                {
                    foreach(var item in row.ItemArray)
                    {
                        //write each row value
                    }
                }
            }
        } 
```

# c# - 强类型动态 Linq 排序

> ID：557819
> 
> 赞同：26
> 
> 时间：2009-02-17T17:19:45.917
> 
> 标签：c#, .net, linq

我正在尝试构建一些用于动态排序 Linq IQueryable<> 的代码。

显而易见的方法是这里，它使用字段名称的字符串对列表进行排序
[http://dvanderboom.wordpress.com/2008/12/19/dynamically-composing-linq-orderby-clauses/](http://dvanderboom.wordpress.com/2008/12/19/dynamically-composing-linq-orderby-clauses/)

但是我想要一个更改 - 编译时检查字段名称，以及使用重构/查找所有引用来支持以后维护的能力。这意味着我想将字段定义为 f=>f.Name，而不是字符串。

对于我的特定用途，我想封装一些代码，这些代码将根据用户输入决定应该使用命名“OrderBy”表达式列表中的哪一个，而不是每次都编写不同的代码。

以下是我所写内容的要点：

```
var list = from m Movies select m; // Get our list

var sorter = list.GetSorter(...); // Pass in some global user settings object

sorter.AddSort("NAME", m=>m.Name);
sorter.AddSort("YEAR", m=>m.Year).ThenBy(m=>m.Year);

list = sorter.GetSortedList();

...
public class Sorter<TSource>
...
public static Sorter<TSource> GetSorter(this IQueryable<TSource> source, ...) 
```

GetSortedList 函数确定要使用哪个命名排序，这会产生一个 List 对象，其中每个 FieldData 包含在 AddSort 中传递的字段的 MethodInfo 和 Type 值：

```
public SorterItem<TSource> AddSort(Func<T, TKey> field)
{
   MethodInfo ... = field.Method;
   Type ... = TypeOf(TKey);
   // Create item, add item to diction, add fields to item's List<>
   // The item has the ThenBy method, which just adds another field to the List<>
} 
```

我不确定是否有办法以允许稍后返回的方式存储整个字段对象（不可能转换，因为它是通用类型）

有没有一种方法可以调整示例代码，或者提出全新的代码，以便在将强类型字段名称存储在某个容器中并检索*之后*使用它们进行排序（丢失任何通用类型转换）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-18T07:30:51.297

最简单的方法是让您的 AddSort() 函数采用 Expression<Func<Movie>> 而不仅仅是一个 Func。这允许您的排序方法检查表达式以提取要排序的属性的名称。然后，您可以在内部将此名称存储为字符串，因此存储非常容易，并且您可以使用链接到的排序算法，但您还可以获得类型安全和编译时检查有效属性名称。

```
static void Main(string[] args)
{
    var query = from m in Movies select m;

    var sorter = new Sorter<Movie>();
    sorter.AddSort("NAME", m => m.Name);
}

class Sorter<T>
{
    public void AddSort(string name, Expression<Func<T, object>> func)
    {
        string fieldName = (func.Body as MemberExpression).Member.Name;
    }
} 
```

在这种情况下，我使用 object 作为 func 的返回类型，因为它很容易自动转换，但如果您需要更多功能，您可以酌情使用不同的类型或泛型来实现它。在这种情况下，由于 Expression 只是用来检查的，所以这并不重要。

另一种可能的方法是仍然采用 Func，并将其存储在字典本身中。然后，当涉及到排序时，您需要获取要排序的值，您可以调用如下内容：

```
// assuming a dictionary of fields to sort for, called m_fields
m_fields[fieldName](currentItem) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T15:58:56.210

无赖！我必须学习如何从头到尾阅读规范:-(

然而，既然我花了太多时间在闲逛而不是工作，无论如何我都会发布我的结果，希望这能激发人们阅读、思考、理解（重要）然后采取行动。或者如何对泛型、lambdas 和有趣的 Linq 东西变得太聪明。

> 我在这个练习中发现了一个巧妙的技巧，就是那些派生自`Dictionary`. 它们的全部目的是删除所有这些尖括号以提高可读性。

哦，差点忘了代码：

**更新：使代码通用并使用`IQueryable`而不是`IEnumerable`**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using NUnit.Framework;
using NUnit.Framework.SyntaxHelpers;

namespace StackOverflow.StrongTypedLinqSort
{
    [TestFixture]
    public class SpecifyUserDefinedSorting
    {
        private Sorter<Movie> sorter;

        [SetUp]
        public void Setup()
        {
            var unsorted = from m in Movies select m;
            sorter = new Sorter<Movie>(unsorted);

            sorter.Define("NAME", m1 => m1.Name);
            sorter.Define("YEAR", m2 => m2.Year);
        }

        [Test]
        public void SortByNameThenYear()
        {
            var sorted = sorter.SortBy("NAME", "YEAR");
            var movies = sorted.ToArray();

            Assert.That(movies[0].Name, Is.EqualTo("A"));
            Assert.That(movies[0].Year, Is.EqualTo(2000));
            Assert.That(movies[1].Year, Is.EqualTo(2001));
            Assert.That(movies[2].Name, Is.EqualTo("B"));
        }

        [Test]
        public void SortByYearThenName()
        {
            var sorted = sorter.SortBy("YEAR", "NAME");
            var movies = sorted.ToArray();

            Assert.That(movies[0].Name, Is.EqualTo("B"));
            Assert.That(movies[1].Year, Is.EqualTo(2000));
        }

        [Test]
        public void SortByYearOnly()
        {
            var sorted = sorter.SortBy("YEAR");
            var movies = sorted.ToArray();

            Assert.That(movies[0].Name, Is.EqualTo("B"));
        }

        private static IQueryable<Movie> Movies
        {
            get { return CreateMovies().AsQueryable(); }
        }

        private static IEnumerable<Movie> CreateMovies()
        {
            yield return new Movie {Name = "B", Year = 1990};
            yield return new Movie {Name = "A", Year = 2001};
            yield return new Movie {Name = "A", Year = 2000};
        }
    }

    internal class Sorter<E>
    {
        public Sorter(IQueryable<E> unsorted)
        {
            this.unsorted = unsorted;
        }

        public void Define<P>(string name, Expression<Func<E, P>> selector)
        {
            firstPasses.Add(name, s => s.OrderBy(selector));
            nextPasses.Add(name, s => s.ThenBy(selector));
        }

        public IOrderedQueryable<E> SortBy(params string[] names)
        {
            IOrderedQueryable<E> result = null;

            foreach (var name in names)
            {
                result = result == null
                             ? SortFirst(name, unsorted)
                             : SortNext(name, result);
            }

            return result;
        }

        private IOrderedQueryable<E> SortFirst(string name, IQueryable<E> source)
        {
            return firstPasses[name].Invoke(source);
        }

        private IOrderedQueryable<E> SortNext(string name, IOrderedQueryable<E> source)
        {
            return nextPasses[name].Invoke(source);
        }

        private readonly IQueryable<E> unsorted;
        private readonly FirstPasses firstPasses = new FirstPasses();
        private readonly NextPasses nextPasses = new NextPasses();

        private class FirstPasses : Dictionary<string, Func<IQueryable<E>, IOrderedQueryable<E>>> {}

        private class NextPasses : Dictionary<string, Func<IOrderedQueryable<E>, IOrderedQueryable<E>>> {}
    }

    internal class Movie
    {
        public string Name { get; set; }
        public int Year { get; set; }
    }
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-05-08T12:28:23.350

根据每个人的贡献，我想出了以下内容。

它提供双向排序以及从内到外解决问题。这意味着需要为给定类型的每个未排序列表创建一个新的排序器对我来说没有多大意义。为什么这个未排序的列表不能传递给排序器。这意味着我们可以为我们的不同类型创建 Sorter 的 signelton 实例......

只是一个想法：

```
[TestClass]
public class SpecifyUserDefinedSorting
{
    private Sorter<Movie> sorter;
    private IQueryable<Movie> unsorted;

    [TestInitialize]
    public void Setup()
    {
        unsorted = from m in Movies select m;
        sorter = new Sorter<Movie>();
        sorter.Register("Name", m1 => m1.Name);
        sorter.Register("Year", m2 => m2.Year);
    }

    [TestMethod]
    public void SortByNameThenYear()
    {
        var instructions = new List<SortInstrcution>()
                               {
                                   new SortInstrcution() {Name = "Name"},
                                   new SortInstrcution() {Name = "Year"}
                               };
        var sorted = sorter.SortBy(unsorted, instructions);
        var movies = sorted.ToArray();

        Assert.AreEqual(movies[0].Name, "A");
        Assert.AreEqual(movies[0].Year, 2000);
        Assert.AreEqual(movies[1].Year, 2001);
        Assert.AreEqual(movies[2].Name, "B");
    }

    [TestMethod]
    public void SortByNameThenYearDesc()
    {
        var instructions = new List<SortInstrcution>()
                               {
                                   new SortInstrcution() {Name = "Name", Direction = SortDirection.Descending},
                                   new SortInstrcution() {Name = "Year", Direction = SortDirection.Descending}
                               };
        var sorted = sorter.SortBy(unsorted, instructions);
        var movies = sorted.ToArray();

        Assert.AreEqual(movies[0].Name, "B");
        Assert.AreEqual(movies[0].Year, 1990);
        Assert.AreEqual(movies[1].Name, "A");
        Assert.AreEqual(movies[1].Year, 2001);
        Assert.AreEqual(movies[2].Name, "A");
        Assert.AreEqual(movies[2].Year, 2000);
    }

    [TestMethod]
    public void SortByNameThenYearDescAlt()
    {
        var instructions = new List<SortInstrcution>()
                               {
                                   new SortInstrcution() {Name = "Name", Direction = SortDirection.Descending},
                                   new SortInstrcution() {Name = "Year"}
                               };
        var sorted = sorter.SortBy(unsorted, instructions);
        var movies = sorted.ToArray();

        Assert.AreEqual(movies[0].Name, "B");
        Assert.AreEqual(movies[0].Year, 1990);
        Assert.AreEqual(movies[1].Name, "A");
        Assert.AreEqual(movies[1].Year, 2000);
        Assert.AreEqual(movies[2].Name, "A");
        Assert.AreEqual(movies[2].Year, 2001);
    }

    [TestMethod]
    public void SortByYearThenName()
    {
        var instructions = new List<SortInstrcution>()
                               {
                                   new SortInstrcution() {Name = "Year"},
                                   new SortInstrcution() {Name = "Name"}
                               };
        var sorted = sorter.SortBy(unsorted, instructions); 
        var movies = sorted.ToArray();

        Assert.AreEqual(movies[0].Name, "B");
        Assert.AreEqual(movies[1].Year, 2000);
    }

    [TestMethod]
    public void SortByYearOnly()
    {
        var instructions = new List<SortInstrcution>()
                               {
                                   new SortInstrcution() {Name = "Year"} 
                               };
        var sorted = sorter.SortBy(unsorted, instructions); 
        var movies = sorted.ToArray();

        Assert.AreEqual(movies[0].Name, "B");
    }

    private static IQueryable<Movie> Movies
    {
        get { return CreateMovies().AsQueryable(); }
    }

    private static IEnumerable<Movie> CreateMovies()
    {
        yield return new Movie { Name = "B", Year = 1990 };
        yield return new Movie { Name = "A", Year = 2001 };
        yield return new Movie { Name = "A", Year = 2000 };
    }
}

public static class SorterExtension
{
    public static IOrderedQueryable<T> SortBy<T>(this IQueryable<T> source, Sorter<T> sorter, IEnumerable<SortInstrcution> instrcutions)
    {
        return sorter.SortBy(source, instrcutions);
    }
}

public class Sorter<TSource>
{
    private readonly FirstPasses _FirstPasses;
    private readonly FirstPasses _FirstDescendingPasses;
    private readonly NextPasses _NextPasses;
    private readonly NextPasses _NextDescendingPasses; 

    public Sorter()
    {
        this._FirstPasses = new FirstPasses();
        this._FirstDescendingPasses = new FirstPasses();
        this._NextPasses = new NextPasses();
        this._NextDescendingPasses = new NextPasses();
    }

    public void Register<TKey>(string name, Expression<Func<TSource, TKey>> selector)
    {
        this._FirstPasses.Add(name, s => s.OrderBy(selector));
        this._FirstDescendingPasses.Add(name, s => s.OrderByDescending(selector));
        this._NextPasses.Add(name, s => s.ThenBy(selector));
        this._NextDescendingPasses.Add(name, s => s.ThenByDescending(selector));
    }

    public IOrderedQueryable<TSource> SortBy(IQueryable<TSource> source, IEnumerable<SortInstrcution> instrcutions)
    {
        IOrderedQueryable<TSource> result = null;

        foreach (var instrcution in instrcutions) 
            result = result == null ? this.SortFirst(instrcution, source) : this.SortNext(instrcution, result); 

        return result;
    }

    private IOrderedQueryable<TSource> SortFirst(SortInstrcution instrcution, IQueryable<TSource> source)
    {
        if (instrcution.Direction == SortDirection.Ascending)
            return this._FirstPasses[instrcution.Name].Invoke(source);
        return this._FirstDescendingPasses[instrcution.Name].Invoke(source);
    }

    private IOrderedQueryable<TSource> SortNext(SortInstrcution instrcution, IOrderedQueryable<TSource> source)
    {
        if (instrcution.Direction == SortDirection.Ascending)
            return this._NextPasses[instrcution.Name].Invoke(source);
        return this._NextDescendingPasses[instrcution.Name].Invoke(source);
    }

    private class FirstPasses : Dictionary<string, Func<IQueryable<TSource>, IOrderedQueryable<TSource>>> { }

    private class NextPasses : Dictionary<string, Func<IOrderedQueryable<TSource>, IOrderedQueryable<TSource>>> { } 
}

internal class Movie
{
    public string Name { get; set; }
    public int Year { get; set; }
}

public class SortInstrcution
{
    public string Name { get; set; }

    public SortDirection Direction { get; set; }
}

public enum SortDirection   
{
    //Note I have created this enum because the one that exists in the .net 
    // framework is in the web namespace...
    Ascending,
    Descending
} 
```

请注意，如果您不想依赖 SortInstrcution，那么更改它就不会那么难。

希望这可以帮助某人。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-09T23:04:49.197

我喜欢上面的工作 - 非常感谢！我冒昧地添加了几件事：

1.  添加了排序方向。

2.  使注册和呼叫两个不同的问题。

用法：

```
var censusSorter = new Sorter<CensusEntryVM>();
censusSorter.AddSortExpression("SubscriberId", e=>e.SubscriberId);
censusSorter.AddSortExpression("LastName", e => e.SubscriberId);

View.CensusEntryDataSource = censusSorter.Sort(q.AsQueryable(), 
    new Tuple<string, SorterSortDirection>("SubscriberId", SorterSortDirection.Descending),
    new Tuple<string, SorterSortDirection>("LastName", SorterSortDirection.Ascending))
    .ToList();

internal class Sorter<E>
{
    public Sorter()
    {
    }
    public void AddSortExpression<P>(string name, Expression<Func<E, P>> selector)
    {
        // Register all possible types of sorting for each parameter
        firstPasses.Add(name, s => s.OrderBy(selector));
        nextPasses.Add(name, s => s.ThenBy(selector));
        firstPassesDesc.Add(name, s => s.OrderByDescending(selector));
        nextPassesDesc.Add(name, s => s.OrderByDescending(selector));
    } 

    public IOrderedQueryable<E> Sort(IQueryable<E> list, 
                                     params Tuple<string, SorterSortDirection>[] names) 
    { 
        IOrderedQueryable<E> result = null; 
        foreach (var entry in names)
        {
            result = result == null 
                   ? SortFirst(entry.Item1, entry.Item2, list) 
                   : SortNext(entry.Item1, entry.Item2, result); 
        } 
        return result; 
    } 
    private IOrderedQueryable<E> SortFirst(string name, SorterSortDirection direction, 
                                           IQueryable<E> source) 
    { 
        return direction == SorterSortDirection.Descending
             ? firstPassesDesc[name].Invoke(source) 
             : firstPasses[name].Invoke(source);
    } 

    private IOrderedQueryable<E> SortNext(string name, SorterSortDirection direction, 
                                          IOrderedQueryable<E> source) 
    {
        return direction == SorterSortDirection.Descending
             ? nextPassesDesc[name].Invoke(source) 
             : nextPasses[name].Invoke(source); 
    }

    private readonly FirstPasses firstPasses = new FirstPasses(); 
    private readonly NextPasses nextPasses = new NextPasses();
    private readonly FirstPasses firstPassesDesc = new FirstPasses();
    private readonly NextPasses nextPassesDesc = new NextPasses();

    private class FirstPasses : Dictionary<string, Func<IQueryable<E>, IOrderedQueryable<E>>> { }
    private class NextPasses : Dictionary<string, Func<IOrderedQueryable<E>, IOrderedQueryable<E>>> { }
} 
```

# c# - 调用 File.Exist 会锁定文件吗？

> ID：557826
> 
> 赞同：6
> 
> 时间：2009-02-17T17:21:57.720
> 
> 标签：c#, .net, file-io, locking

如果我试图删除一个文件，但同时另一个进程正在对同一个文件执行 File.Exists(...)，这是否会锁定文件并导致我的进程失败？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T17:27:26.367

不， File.Exist() 仅检查有问题的文件是否在指定路径的文件系统上。它无论如何都不会访问文件数据或标题，因此它不会锁定文件。

附带说明一下，即使打开文件也不一定会锁定它。这取决于您在打开时选择的访问参数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T18:11:15.807

不， File.Exist 不会锁定文件。不过，了解幕后发生的事情的一个好方法是查看[源代码](http://www.microsoft.com/downloads/details.aspx?FamilyId=8C09FD61-3F26-4555-AE17-3121B4F51D4D&displaylang=en)。

拉下 .Net Framework 基类库的源代码，看看幕后发生了什么。特别是 System.IO.File 类，有一些非常有趣的默认选择，用于文件处理、锁定、释放等。在像您这样的实例中，查看幕后发生的事情的来源可以在如何处理方面产生重大影响你设计你的应用程序。

根据链接：

我可以使用共享源 CLI 做什么？Shared Source CLI 中有丰富的编程语言技术。它可能会引起广大观众的兴趣，包括：

*   对 .NET Framework 的内部工作感兴趣的开发人员可以探索 CLI 的这种实现，以了解垃圾收集的工作原理、JIT 编译和验证的处理方式、安全协议的实现以及框架和虚拟对象系统的组织。
*   从事高级编译器技术工作的教师和研究人员。语言扩展、JIT 优化和现代垃圾收集的研究项目都以共享源 CLI 为基础。现代编译器课程可以基于 CLI 上实现的 C# 或 JScript 语言。
*   开发自己的 CLI 实现的人会发现 Shared Source CLI 是 ECMA 标准不可或缺的指南和辅助工具。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-01T13:31:52.027

这是对 anu 的回答 - 以及任何对文件做类似事情的人。

使用 using 语句访问文件非常重要。这可确保您适当地处理对文件的引用。

```
using (var fs = File.OpenRead(path)) {
    // Do something
} 
```

# html - XHTML 需要什么？

> ID：557827
> 
> 赞同：34
> 
> 时间：2009-02-17T17:22:11.463
> 
> 标签：html, css, xhtml

在一次采访中，我被问到一个我从未想过的问题，那就是“我们已经有了 HTML 可以满足编写网页的所有要求，那么还需要 XHTML 吗？”

我在 Google 上搜索了很多，也阅读了很多文章，但我无法正确理解为什么要引入 XHTML。请给我解释一下。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-17T17:24:40.227

因为它是有效的 XML。这很有帮助，因为您可以使用许多最初为 XML 设计的工具，例如 XML 解析器、XSLT、XPath、XQuery...

普通 HTML 是一种 SGML 方言，如果不了解模式，则无法解析。

```
<ul>
    <li>one
    <li>two
    <li>three
</ul> 
```

是[正确的 HTML](http://www.w3.org/TR/html4/struct/lists.html)但不是正确的 XML。如果你想解析它，你必须知道`ul`-elements 必须关闭但`li`s 没有。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-17T17:30:17.233

XHTML 还允许您嵌入其他 XML 方言，如 MathML、Ruby、SVG 等。（如果需要，您也可以将 XHTML 嵌入到其他 XML 方言中。）

如果您只是“制作网页”，则不一定需要 XHTML。但是，如果您以编程方式生成页面，您可能会发现生成 XML 的工具比生成 HTML 的工具要好。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-02-17T17:44:54.000

我实际上是在写这篇文章，问为什么上面三个关于**浏览器一致性**和**格式良好**的html 的帖子被否决了？

众所周知，HTML 是一种行业标准。实现了浏览器，以便它们呈现 HTML 标准中描述的标记内容。不幸的是，有些区域在 HTML 中没有得到很好的定义：如果用户忘记了结束标记会发生什么，或者如果没有找到引用的图像该怎么办？一些浏览器使用“alt”标签来显示占位符文本项，而一些浏览器将“alt”标签显示为工具提示。著名的浏览器“怪癖”模式就是缺乏清晰度的结果。正因为如此，同一个网页很可能在不同的浏览器上显示不同。

此外，随着 HTML 使用量的增长，还有一个问题：它不可扩展——无法添加用户定义的标签。

**XHTML 解决了上述问题**：

*   采用 XML 提供可扩展的标签。
*   为网络浏览器提供“严格”标准

XHTML 有关于结构的明确定义的规则，这些规则可以通过编程方式强制执行。检查各种在线“XHTML 验证器”。他们会判断您的 XHTML 是否格式正确（并突出显示问题区域）。由于这些严格的规则，您的页面或多或少可以保证在所有实现 XHTML 的浏览器上看起来都一样。

[**注意**]如果要验证以上内容，请参考正文“Head First XHTML and CSS”

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-02-17T17:29:31.070

除了 Johannes 的回答之外，HTML 的解释和容忍度都太松散了，而 XHTML 的严格形式化否定了这一点。

宽容会导致差异，从而导致浏览器不兼容，从而导致阴暗面。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-02-17T17:30:19.620

来自[维基](http://en.wikipedia.org/wiki/Xhtml)：

> 因为它们需要格式正确，所以真正的 XHTML 文档允许使用标准 XML 工具执行自动处理，这与 HTML 不同，后者需要相对复杂、宽松且通常自定义的解析器。XHTML 在很多方面可以被认为是 HTML 和 XML 的交集，因为它是对 XML 的重新表述。

使 HTML 符合 XML 标准允许对页面进行更加一致的解析。而在 HTML 中，例如，您可以让标签乱序`<b><u>test</b></u>`，但现在不能，它们必须按照打开的顺序关闭。这样的事情使 DOM 解析（现在在 AJAX 中大量使用）**变得**更加容易。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-17T17:28:20.077

我相信你一定在 W3 中遇到过[这篇](http://www.w3.org/TR/xhtml1/)文章。从那篇文章中可以学到很多东西。简而言之，XHTML 除了具有 HTML 标记集外，还遵守 xml 规则。最重要的区别：

```
* XHTML elements must be properly nested
* XHTML elements must always be closed
* XHTML elements must be in lowercase
* XHTML documents must have one root element 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-07-07T21:36:00.687

我在这里看到一堆投票赞成的答案，它们对浏览器的工作方式做出了错误的假设。所以让我在这件事上给我 2 美分。

**首先，为什么会存在 XHTML？**

[从马口中：](http://www.w3.org/MarkUp/2004/xhtml-faq#need)

> 组织了一个为期两天的研讨会，讨论是否需要新版本的 XML 格式的 HTML。研讨会上的意见是明确的“是”：对于基于 XML 的 HTML，其他 XML 语言可以包含一些 XHTML，而 XHTML 文档可以包含一些其他标记语言。我们还可以利用重新设计的优势来清理 HTML 中一些较不整洁的部分，并添加一些新的所需功能，例如更好的表单。

简而言之，创建 XHTML 有两个原因：

*   允许在具有明确格式规则的同一文档中混合其他内容（如 mathml 和 svg）。
*   扩展和清理 HTML。

让事情更容易验证不是设计目标，也不是必需的，因为 HTML4 验证器存在并且很全面。

**XHTML 更容易被浏览器解析吗？**

是和不是。XML 比 HTML 标记汤更容易解析，但是，除非您对 XHTML 页面使用 xhtml+xml 或 application/xml mime 类型，否则浏览器会使用 HTML 解析引擎对其进行解析。但是，如果您确实使用 xml mime 类型，IE 会阻塞您的内容。此[行为](http://blogs.msdn.com/b/ie/archive/2005/09/15/467901.aspx)在 IE 博客上进行了解释。*如果您使用 mime 类型的 text/html 来处理 XHTML 和 HTML，那么浏览器处理 XHTML 和 HTML 的方式没有区别！*

**是的，他们做到了！你撒谎！**

他们确实这样做了，但这只是因为文档类型。浏览器使用 HTML 文档顶部的 doctypes 来确定它们应该使用标准模式还是怪癖模式（= 错误模式）。所有有效的 XHTML 文档都包含触发标准模式的 doctype。但是，在 HTML 中，您可以通过在页面顶部包含“<!doctype html>”来获得相同的结果。

**那么你是说 XHTML 没有目的吗？**

一点也不。XHTML 有很多优点：

*   它可以使用 XML 工具进行转换，例如 XSLT
*   它可以在服务器端代码中更容易地解析
*   它可以在通过验证测试的同时集成自定义标记

**那么，我应该使用它吗？**

与往常一样，答案是“视情况而定”。

*   服务器端，可能有用。如果您想拥有 XML 的服务器端优势，您需要使用 XHTML 变体，无论是 XHTML1（HTML4 序列化为 XML）还是 XHTML5（HTML5 序列化为 XML）。
*   客户端，没用。我强烈建议避免为您的用户提供 XML mime 类型。XML 解析不会与优雅的错误处理相结合，如果您的页面中有任何标记问题，则只会产生“XML 解析错误”而不是文档。除非您从不编写错误，否则您将需要优雅的错误处理。

**HTML5 怎么样？它与 XHTML 竞争吗？**

不，它没有。HTML5 有[两种序列化](http://www.w3.org/QA/2008/01/html5-is-html-and-xml.html)，一种是 HTML，一种是 XML。好处是两者现在都有严格的解析规则。无论您使用哪种方法，您都将在所有浏览器中获得可预测的行为。但是，将 HTML5 解析为 HTML 具有优雅的错误处理优势。这就是为什么我更喜欢这种方法。一如既往，YMMV。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-17T17:30:00.417

XHTML 是一种鼓励“格式良好的”HTML 开发的尝试。

HTML 已经发展了 10 多年。它的实现以及解析和呈现它的浏览器的实现并不完全一致。这就是为什么跨浏览器兼容性是一个令人头疼的问题。

HTML 基于 SGML（标准通用标记语言）。XML 也是从 SGML 派生的，因此它们是某种表亲。XHTML 将两者结合起来，提供（理论上）XML 到 HTML 的好处。这包括一个定义明确的模式，可以可靠地验证、查询和转换。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-07-07T11:46:14.203

**为什么要创建 XHTML？**

*   HTML 不是很可扩展。XHTML 旨在通过引入名称空间来解决此问题，以便可以内联包含诸如 MathML 或 SVG 之类的语言。
*   XMl 比 SGML 更容易解析（HTML 5 之前使用的格式）
*   由于存在大量错误的网站，浏览器试图纠正不正确的标记。新的浏览器不得不尝试以同样的方式纠正它。XHTML 试图通过指定只显示结构正确的代码来提高标准。

**它的成功程度如何？**

*   XHTML 被广泛传播，但由于与 Internet Explorer（直到版本 8）不兼容，几乎总是以 text/html MIME 类型提供服务。如果作为 XML 提供，其中许多页面实际上会中断。因此，上述三个优势都没有真正实现。
*   许多人选择使用 XHTML，因为他们认为它可以提供更好的未来兼容性。XHTML2.0 的工作已经停止，虽然 HTML5 将进行 XHTML 序列化，但这似乎很少受到关注。XHTML 在可预见的未来不会提供未来的兼容性优势。[Mozilla](https://developer.mozilla.org/en/Mozilla_Web_Developer_FAQ#section_10)和[Safari](http://webkit.org/blog/68/understanding-html-xml-and-xhtml/)建议只使用 HTML。
*   具有严格 DTD 的 HTML 已经有了更清晰的格式。HTML5 将通过移除过渡性 DTD、移除不必要的元素和定义具有一定程度向后兼容性的标准文档解析方式来进一步实现这一点。浏览器仍然会纠正 HTML 序列化的错误，而不是强制修复标记，但至少它们会以相同的方式进行。那些关心正确代码的人无论如何都会使用验证器。

**XHTML 需要什么？**

XHTML 有值得称道的目标，也许它会在未来实现。我不能推荐 XHTML 因为它可能提供的*未来*优势，因为现在 HTML 更容易。只有在以前的代码或您的工具强迫您使用时，您才应该真正使用 XHTML。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-17T17:29:25.173

我认为它可以帮助浏览器正确显示 html，而无需假设应该在哪里关闭标签。任何时候浏览器假设你知道会发生什么。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-17T17:51:58.443

XHTML 迫使您编写更简洁的代码，这些代码更易于维护、呈现更一致且更易于挂接到 DOM。将 XHTML 与 HTML 进行比较就像将强类型的编程语言与松散类型的编程语言进行比较。

如上所述，XHTML 允许您使用 SVG 和 MathML。我想将 RDFa 添加到该列表中。RDFa 允许您将语义添加到微格式未涵盖的内容中。我个人在 Dublin Core 和 Friend-of-a-Friend 方面做了很多工作。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-17T18:14:15.317

XHTML 只是关于系统之间的通信。HTML 非常难以解析，因为对于格式良好的内容可能会发生多种变化。由于 XML 的解释很严格，因此这个问题已被消除。

考虑一个 RESTful 架构。如果 URL 是某个项目的永久位置，那么想要访问该项目的系统应该能够使用从访问该 URL 返回的信息。XHTML 本身并不能实现这一点，因为系统已经可以解析 HTML 并检索必要的信息。XML 只是使这更容易。没有限制性的预定义标签集，这使得难以对文档中的数据进行分类（尽管从技术上讲，您可以在 HTML 中做到这一点，因为浏览器会忽略它）。您可以使用任何您想对检索到的数据进行分类的方式。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-07-07T12:22:48.830

简而言之：当您想使用基于**XML 的工具**在服务器端操作/转换/生成 HTML 页面时，XHTML 通常比 HTML 更有益和更受青睐。

在基于组件的 MVC 框架中可以找到很多示例，例如~~Sun~~ Oracle JSF，它使用[*Facelets*](http://docs.oracle.com/javaee/6/tutorial/doc/gjaam.html#gjuwp)作为基于 XHTML 的视图技术。服务器端组件在 XSD 中定义，页面使用[SAX 解析器](http://en.wikipedia.org/wiki/Simple_API_for_XML)进行解析。您甚至可以`<!DOCTYPE html>`在页面顶部添加一个让 Facelets 生成“纯”有效且严格的 HTML5。Microsoft ASP.NET MVC 也有类似的视图技术。

当您在手写 HTML 时，XHTML 并没有带来太多好处，或者它必须推动使用（过度）炒作的技术的“酷”。

### 也可以看看：

*   [我应该从 HTML 还是 XHTML 开始](https://stackoverflow.com/questions/1989500/should-i-start-with-html-or-xhtml)
*   [是否可以在 HTML 4/5 中使用 JSF+Facelets？](https://stackoverflow.com/questions/2935759/is-it-possible-to-use-jsffacelets-with-html-4-5)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-29T05:29:04.987

如果我想爬取你的网站并解析它的内容，我只能在它是 XML 的情况下这样做。

解析 HTML 是一场噩梦。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-29T05:43:46.220

XML 是一种数据交换格式——这对于构建网站来说是完美的，因为毕竟我们是在处理信息，而这些信息需要被计算机（例如搜索引擎）抓取和理解。

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2009-10-13T13:04:26.207

**因为 XHTML 更有意义！**

关键是，即使某些东西可能无法提供更多的技术可能性，但如果重新制作它只是为了更清晰和合乎逻辑，它仍然是一种改进。这就是为什么代码重构是一个好主意，即使它不会改变任何功能。这就是为什么[Brainfuck](http://en.wikipedia.org/wiki/Brainfuck)不是一门好的编程语言，即使它具有 Java 的所有功能。

XHTML 更有意义，因为标签的底层结构及其属性始终是一致的——不依赖于标签语义。它更有意义的方式非常明显，一旦您熟悉了它与 HTML 的区别，但例如标签总是有序嵌套，所有标签必须关闭，名称必须小写，属性值必须在它们周围有限制字符。

# windows-vista - Google 桌面小工具到 Vista 边栏小工具转换器

> ID：557828
> 
> 赞同：-1
> 
> 时间：2009-02-17T17:22:30.433
> 
> 标签：windows-vista, windows-desktop-gadgets, google-gadget

我有一些问题。我需要将 Google 桌面小工具（**不是**iGoogle 小工具）转换为 Vista 侧边栏小工具你知道有什么方法吗？感谢您的任何回答

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-07T12:20:29.420

Google 桌面主要使用 GD API。因此，您需要使用 Vista Sidebar Gadget 的 API（使用 HTML 和 JS）手动转换它们

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-26T05:18:43.440

我不知道确切，但您可以使用[http://www.3dfreeair.com](http://www.3dfreeair.com)自由下载 vista 侧边栏小工具动画。我下载并使用它。这是一个非常有趣的。我希望你也喜欢它。这是 AIR 的最新技术。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-26T05:24:42.293

我相信，这些小部件系统中的大多数都使用 XML 和 JavaScript，所以应该不会那么难。

您是否有要转换的小工具的来源？如果不这样做，您可以将包的扩展名从 .gg 更改为 .zip 并对其进行压缩。

# linq-to-sql - linq to sql 会自动延迟加载关联实体吗？

> ID：557830
> 
> 赞同：6
> 
> 时间：2009-02-17T17:22:40.557
> 
> 标签：linq-to-sql, lazy-loading

linq to sql 会自动延迟加载关联实体吗？

我认为会，但我找不到这样的文章。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T17:41:56.517

这取决于您如何定义“延迟加载”。

如果你说

```
var person = (from p in db.People 
              where p.PersonId = pid 
              select p).First();
var spouse = person.Spouse;   // based on the SpouseId FK 
                              // back into the People table. 
```

那么这将是精确的“延迟加载”，因为在引用第二个对象之前不会从数据库中提取它。然而，这将需要两个数据库查询。

但是，如果要说，

```
var family = (from p in db.People
              where p.PersonId = pid 
             select new 
              { 
                 Name = p.Name, 
                 SpouseName = p.Spouse.Name
              }).First(); 
```

然后 Linq 将自动执行连接并在单个数据库查询中从两条记录中加载信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T17:25:51.610

是的，我相信确实如此。它还具有“加载”功能/语义，允许您以霰弹枪方法批量加载多个内容。当您知道需要相关数据以及主要实体时，这很有用，例如预缓存渲染单个网页所需的所有数据等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T17:32:49.363

是的，默认情况下启用延迟加载。看看[这篇文章](http://dotnetslackers.com/articles/csharp/Load-Lazy-in-LINQ-to-SQL.aspx)。

# c# - 如何创建尚未显示的对象的图像

> ID：557836
> 
> 赞同：2
> 
> 时间：2009-02-17T17:24:21.553
> 
> 标签：c#

在我的项目中，我有很多页面。每个页面都是一个面板，其中包含许多用户控件。我想要一个尚未显示的面板及其内容的缩略图。我该怎么做。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T17:35:01.963

也许面板的 DrawToBitmap 函数可以用于此目的。

大意是：

```
 Bitmap bmp = new Bitmap(panel.Bounds.Width, panel.Bounds.Height);
panel.DrawToBitmap(bmp, panel.ClientRectangle);
bmp.Save("c:\\test.bmp");
bmp.Dispose(); 
```

**编辑**- 更新为更合适的示例代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T17:29:53.613

不确定如何获取图像，但您仍然可以在不可见的情况下更新控件（或表单）。但是我不相信 .NET 中内置了任何东西可以让您在不实际将其呈现到屏幕的情况下拍摄表单的图像。也许通过GDI？

# java - unix/linux“tail -f”的Java IO实现

> ID：557844
> 
> 赞同：74
> 
> 时间：2009-02-17T17:25:37.897
> 
> 标签：java, file, file-io, iostream, tail

我想知道使用什么技术和/或库来实现 linux 命令“tail -f”的功能。我本质上是在寻找`java.io.FileReader`. 客户端代码可能如下所示：

```
TailFileReader lft = new TailFileReader("application.log");
BufferedReader br = new BufferedReader(lft);
String line;
try {
  while (true) {
    line= br.readLine();
    // do something interesting with line
  }
} catch (IOException e) {
  // barf
} 
```

缺少的部分是`TailFileReader`. 它应该能够读取文件打开之前存在的部分文件以及添加的行。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2011-02-08T19:48:37.363

看一下[Tailer](https://commons.apache.org/proper/commons-io/javadocs/api-2.4/org/apache/commons/io/input/Tailer.html)类的 Apache Commons 实现。它似乎也可以处理日志轮换。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-02-17T19:01:00.790

继续读取文件并等待文件为您提供更多更新的能力应该不难在自己的代码中完成。这是一些伪代码：

```
BufferedReader br = new BufferedReader(...);
String line;
while (keepReading) {
    line = reader.readLine();
    if (line == null) {
        //wait until there is more of the file for us to read
        Thread.sleep(1000);
    }
    else {
        //do something interesting with the line
    }
} 
```

我假设您希望将这种类型的功能放在它自己的线程中，以便您可以休眠它并且不会影响应用程序的任何其他区域。您可能希望`keepReading`在 setter 中公开，以便您的主类/应用程序的其他部分可以安全地关闭线程，而无需任何其他麻烦，只需调用`stopReading()`或类似的东西。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-17T23:11:52.073

检查[JLogTailer](http://www.jibble.org/jlogtailer.php)，它执行此逻辑。

代码中的要点是：

```
public void run() {
    try {
        while (_running) {
            Thread.sleep(_updateInterval);
            long len = _file.length();
            if (len < _filePointer) {
                // Log must have been jibbled or deleted.
                this.appendMessage("Log file was reset. Restarting logging from start of file.");
                _filePointer = len;
            }
            else if (len > _filePointer) {
                // File must have had something added to it!
                RandomAccessFile raf = new RandomAccessFile(_file, "r");
                raf.seek(_filePointer);
                String line = null;
                while ((line = raf.readLine()) != null) {
                    this.appendLine(line);
                }
                _filePointer = raf.getFilePointer();
                raf.close();
            }
        }
    }
    catch (Exception e) {
        this.appendMessage("Fatal error reading log file, log tailing has stopped.");
    }
    // dispose();
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-12-04T23:06:46.413

不久前，我在 Scala 中构建了一个简短的“tail -f”实现：[tailf](https://github.com/alaz/tailf)。它还负责文件轮换，您可以定义自己的逻辑，当它到达 EOF 或发现文件已被重命名时要做什么。

您可以看一下并将其移植到 Java，因为实际上其中没有什么复杂的。几点注意事项：主文件是[Tail.scala](https://github.com/alaz/tailf/blob/master/src/main/scala/com/osinka/tailf/Tail.scala)，基本上它定义了[`FollowingInputStream`](https://github.com/alaz/tailf/blob/master/src/main/scala/com/osinka/tailf/Tail.scala)哪个负责 EOF/rename 和[`follow`](https://github.com/alaz/tailf/blob/master/src/main/scala/com/osinka/tailf/Tail.scala#L51)方法，它包含`FollowingInputStream`在`SequenceInputStream`. 因此，一旦`FollowingInputStream`结束，就会`SequenceInputStream`从 an 请求下一个元素，`Enumeration`然后创建另一个`FollowingInputStream`。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-07-03T09:07:25.810

我最近偶然发现了**[rxjava-file](https://github.com/davidmoten/rxjava-file)**，它是[RxJava](https://github.com/ReactiveX/RxJava)的扩展。与其他解决方案相比，它使用了 Java 的 NIO。

```
import rx.Observable;
import rx.functions.Action1;
import com.github.davidmoten.rx.FileObservable;

// ... class definition omitted

public void tailLogFile() throws InterruptedException {
    Observable<String> tailer = FileObservable.tailer()
                                .file("application.log") // absolute path
                                .tailText();

    tailer.subscribe(
        new Action1<String>() {
            @Override
            public void call(String line) {
                System.out.println("you got line: " + line);
            }
        },
        new Action1<Throwable>() {
            @Override
            public void call(Throwable e) {
                System.out.println("you got error: " + e);
                e.printStackTrace();
            }
        }
    );

// this solution operates threaded, so something  
// is required that prevents premature termination

    Thread.sleep(120000);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-02T20:54:07.017

如果您的代码只需要在 Unix 系统上运行，那么您也许可以直接脱壳并`tail -f`直接调用。

作为一个更复杂的替代方案，您可以查看 GNU tail 的实现并将其移植到 Java。（不过，我不确定这是否会使您的代码成为衍生作品。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-10-25T17:23:03.880

我发现了这个不错的尾部实现。

添加一名作者

[来源： https](https://gist.github.com/amelandri/1376896) ://gist.github.com/amelandri/1376896

```
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

/**
 * Java implementation of the Unix tail command
 * 
 * @param args[0] File name
 * @param args[1] Update time (seconds). Optional. Default value is 1 second
 * 
 * @author Luigi Viggiano (original author) http://it.newinstance.it/2005/11/19/listening-changes-on-a-text-file-unix-tail-implementation-with-java/
 * @author Alessandro Melandri (modified by)
 * */
public class Tail {

  static long sleepTime = 1000;

  public static void main(String[] args) throws IOException {

    if (args.length > 0){

      if (args.length > 1)
        sleepTime = Long.parseLong(args[1]) * 1000;

      BufferedReader input = new BufferedReader(new FileReader(args[0]));
      String currentLine = null;

      while (true) {

        if ((currentLine = input.readLine()) != null) {
          System.out.println(currentLine);
          continue;
        }

        try {
          Thread.sleep(sleepTime);
        } catch (InterruptedException e) {
          Thread.currentThread().interrupt();
          break;
        }

      }
      input.close();

    } else {
      System.out.println("Missing parameter!\nUsage: java JavaTail fileName [updateTime (Seconds. default to 1 second)]");
        }
      }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-14T08:11:16.690

刚刚遇到了同样的问题——在这里找到了“最简单”的实现：[Java Tail](http://melandri.net/2009/05/29/java-tail/)。

**好东西 ** - 准备生产 ;)

*我希望代码引用不会放弃一些许可证。*

```
 import java.io.BufferedReader;
    import java.io.FileReader;
    import java.io.IOException;

    /**
     * Java implementation of the Unix tail command
     * 
     * @param args[0] File name
     * @param args[1] Update time (seconds). Optional. Default value is 1 second
     * 
     * @author Luigi Viggiano (original author) http://it.newinstance.it/2005/11/19/listening-changes-on-a-text-file-unix-tail-implementation-with-java/
     * @author Alessandro Melandri (modified by)
     * */
    public class Tail {

      static long sleepTime = 1000;

      public static void main(String[] args) throws IOException {

        if (args.length > 0){

          if (args.length > 1)
        sleepTime = Long.parseLong(args[1]) * 1000;

          BufferedReader input = new BufferedReader(new FileReader(args[0]));
          String currentLine = null;

          while (true) {

        if ((currentLine = input.readLine()) != null) {
          System.out.println(currentLine);
          continue;
        }

        try {
          Thread.sleep(sleepTime);
        } catch (InterruptedException e) {
          Thread.currentThread().interrupt();
          break;
        }

          }
          input.close();

        } else {
          System.out.println("Missing parameter!\nUsage: java JavaTail fileName [updateTime (Seconds. default to 1 second)]");
        }
      }
    } 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-17T19:35:11.987

这是一个可以用作指针的短篇小说：

出于同样的原因，我在工作中编写了 TailingInputStream。它基本上使用 File 并按需刷新其内容，并检查内部缓冲区是否发生了显着变化（4kB 内存标记 IIRC），然后执行 tail -f 的操作。有点hacky，是的，但它完美地工作并且不会与Threads或任何类似的东西混淆 - 它至少一直兼容到1.4.2。

也就是说，它比 ReverseInputStream 容易得多，它从文件的结尾到开始，并且如果文件被即时更新并没有死......

# c# - 为什么企业库会引发间歇性的“数据连接无法打开”错误？

> ID：557854
> 
> 赞同：0
> 
> 时间：2009-02-17T17:26:50.377
> 
> 标签：c#, .net, sql-server, enterprise-library

我支持一个 3 年的 Windows 服务（C# .Net 1.1），它使用企业库来管理它与 SQL 服务器的连接。该服务监视传入的消息，并根据消息执行各种任务，其中大部分涉及更新数据库。据我所知，该服务是单线程的，并且一次从队列中读取一个消息。

在过去的几天里，有几次我们看到它随机“中断”（最后一次是在昨晚午夜左右）。在这些时间里，对数据库的一些（但不是全部）更新失败（大约 20% 可能），我们在事件日志中看到很多警告，在我们的文件日志中看到错误（在下面重现）。重新启动服务使一切再次完美运行。

我在想这可能与企业库中的连接池有关？企业库是否有可能试图维护一个比数据库服务器允许的连接池更多的连接？但我不明白为什么会这样，为什么它不会更优雅地失败。

有没有办法从我的企业库日志中获取更多关于这些失败的真正原因的信息？

事件日志中的警告类似于：（稍作编辑）

```
    来源：企业图书馆数据服务
    说明：数据连接打开失败：server=ServerName;database=DatabaseNameintegrated security=true;

```

同时，在错误日志文件中，我们看到来自企业库的空引用异常，当从我们的服务调用时，如下所示：（再次，稍作编辑）

```
    发生并捕获了“System.NullReferenceException”类型的异常。
    -------------------------------------------------- --------------------------
    2009 年 2 月 17 日 15:00:52
    类型：System.NullReferenceException，mscorlib，版本=1.0.5000.0，文化=中性，PublicKeyToken=b77a5c561934e089
    消息：对象引用未设置为对象的实例。
    来源：System.Data
    帮助链接：
    目标站点：System.Data.SqlClient.SqlInternalConnection CreateConnection()
    堆栈跟踪：在 System.Data.SqlClient.ConnectionPool.GetConnection(Boolean& isInTransaction)
       在 System.Data.SqlClient.SqlConnectionPoolManager.GetPooledConnection（SqlConnectionString 选项，布尔值& isInTransaction）
       在 System.Data.SqlClient.SqlConnection.Open()
       在 Microsoft.Practices.EnterpriseLibrary.Data.Database.OpenConnection()
       在 Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteNonQuery（DBCommandWrapper 命令）
       在 C:\someClass.cs:line 45 中的 OurCode.SomeFunction(MessageType message)
       在 OurCode.SomeOtherFunction（XmlReader 消息）

    附加信息：

    机器名称：机器名称时间戳：17/02/2009 15:00:52
    全名：Microsoft.Practices.EnterpriseLibrary.ExceptionHandling，版本=1.1.0.0，文化=中性，PublicKeyToken=a8dcbcfec587cc95
    应用域名：OurCode.service.exe
    线程身份：
    WindowsIdentity：OurDomain\SomeAccount

```

早些时候（在之前的“破碎”阶段），我们看到了像这样的例外：（再一次，稍微编辑成腼腆！）。这就是让我怀疑连接池有问题的原因。我认为这是我们的代码将其（非错误）活动记录到数据库的地方，但企业库代码无法再次连接到数据库（总是加上前面提到的“数据连接无法打开”错误。

```
    接收器失败，因为：System.NullReferenceException：对象引用未设置为对象的实例。
       在 System.Data.SqlClient.ConnectionPool.GetConnection(Boolean& isInTransaction)
       在 System.Data.SqlClient.SqlConnectionPoolManager.GetPooledConnection（SqlConnectionString 选项，布尔值& isInTransaction）
       在 System.Data.SqlClient.SqlConnection.Open()
       在 Microsoft.Practices.EnterpriseLibrary.Data.Database.OpenConnection()
       在 Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteNonQuery（DBCommandWrapper 命令）
       在 OurCode.Diagnostics.CustomDatabaseSink.ExecuteStoredProcedure（LogEntry logEntry）
       在 OurCode.Diagnostics.CustomDatabaseSink.SendMessageCore(LogEntry logEntry)。

```

非常感谢任何帮助，尤其是从我们的日志中获取更多信息的指针。

其他背景信息：windows 服务是用 C# .Net 1.1 编写的，在 Windows Server 2003 机器上运行，在域帐户下（对所需的 DB 具有所有正确权限）。数据库服务器是 SQL 2005，在 Windows Server 2008 上以 2000 兼容模式（Yay legacy！）运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T17:30:18.417

据我所知，当在 SqlConnection 中创建内部连接对象时会发生这种情况（我相信你是否会使用企业库来获得它）。

我要检查两件事。首先很明显，您是否正确处理了所有连接？即使您正在使用连接池，您仍然必须在使用完所有连接后调用 Dispose，以便将它们返回到池中。如果没有，您可能正在查看饥饿问题。

如果你正确地处理你的连接，那么我会查看那台机器和 SQL Server 之间的连接，看起来你可能有连接问题。

# c# - 为什么我的 C# 服务中出现此 SocketException？

> ID：557879
> 
> 赞同：4
> 
> 时间：2009-02-17T17:31:07.933
> 
> 标签：c#, sockets

我有一个负责从服务器读取和写入的服务。读取和写入在不同的线程中完成。

读取线程始终处于活动状态，而写入线程仅激活以发送消息，并且在将消息写入服务器并收到响应后终止。

该服务运行了 4 天，之后每当服务尝试从端口读取时，我都会不断收到此错误：

> System.Net.Sockets.SocketException：无法对套接字执行操作，因为系统缺少足够的缓冲区空间或队列已满

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T17:35:50.340

当您非常快速地建立大量传出连接并用完本地端口时，可能会发生这种情况。[您可以在此处](http://www.ncftp.com/ncftpd/doc/misc/ephemeral_ports.html)阅读有关“临时端口范围”的信息。

或者，您可能只是用完了套接字。确保在使用完它们后[关闭](http://msdn.microsoft.com/en-us/library/wahsac9k.aspx)它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T18:00:34.990

我还强烈建议您查看您的写入线程，以及您如何引用与 Socket 相关的资源。即，您是否为任何 NetworkStream 或您与 Socket 一起使用的其他对象调用 Close/Dispose？如果您仍在为问题苦苦挣扎，来自写入线程的代码示例会很有帮助。

您可能还想通过任务管理器监控进程内存并处理使用情况。

# ruby-on-rails - Rails 2.2 中可重用辅助方法的最佳位置

> ID：557898
> 
> 赞同：3
> 
> 时间：2009-02-17T17:34:56.863
> 
> 标签：ruby-on-rails, ruby

我计划创建一种以特定方式格式化 Time 的方法（俄语专业格式化）。

我想在多个模型、控制器和可能的视图中重用这个辅助方法。我也想在 Time 类的实例上调用这个辅助方法，如下所示：

```
t=Time.now
t.my_super_shiny_helper 
```

问题：我应该在哪里实现这个助手？（模块或类，在应用程序目录结构中的什么位置？）。创建后，我应该如何调用它？

我是 ruby​​/rails 的新手，很难让它以正确的方式工作。

谢谢你。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-17T17:38:20.443

我会添加一个文件`lib/time_extensions.rb`

```
class Time
  def my_shiny_helper
    ...
  end
end 
```

在初始化文件中`config/intitializers`

```
require 'time_extensions' 
```

如果扩展有点增长并且是您想要重用的东西，请考虑将其放入插件中以便于包含。甚至是宝石。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T03:02:48.617

如果您只想格式化时间，Rails 中的一种简洁方法（如敏捷 Web 开发中给出）是扩展该`to_s`方法中使用的格式：

```
ActiveSupport::CoreExtensions::Time::Conversions::DATE_FORMATS.merge!( 
  :russian => "%A %d %B %Y" 
) 

Time.now.to_s(:russian) #=> "Tuesday 17 February 2009" 
```

将第一位包含`config/environment.rb`在`config/initializers`.

# java - 如何等待 java 声音剪辑完成播放？

> ID：557903
> 
> 赞同：9
> 
> 时间：2009-02-17T17:36:07.157
> 
> 标签：java, javasound

我正在使用以下代码使用 java 声音 API 播放声音文件。

```
 Clip clip = AudioSystem.getClip();
    AudioInputStream inputStream = AudioSystem.getAudioInputStream(stream);
    clip.open(inputStream);
    clip.start(); 
```

Clip.start() 方法的方法调用立即返回，系统在后台线程中播放声音文件。我希望我的方法暂停，直到播放完成。

有什么好的方法吗？

编辑：对于所有对我的最终解决方案感兴趣的人，根据 Uri 的回答，我使用了以下代码：

```
private final BlockingQueue<URL> queue = new ArrayBlockingQueue<URL>(1);

public void playSoundStream(InputStream stream) {
    Clip clip = AudioSystem.getClip();
    AudioInputStream inputStream = AudioSystem.getAudioInputStream(stream);
    clip.open(inputStream);
    clip.start();
    LineListener listener = new LineListener() {
        public void update(LineEvent event) {
                if (event.getType() != Type.STOP) {
                    return;
                }

                try {
                    queue.take();
                } catch (InterruptedException e) {
                    //ignore this
                }
        }
    };
clip.addLineListener(listener );
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2017-10-13T07:38:19.873

我在 Java 8 中更喜欢这种方式：

```
CountDownLatch syncLatch = new CountDownLatch(1);

try (AudioInputStream stream = AudioSystem.getAudioInputStream(inStream)) {
  Clip clip = AudioSystem.getClip();

  // Listener which allow method return once sound is completed
  clip.addLineListener(e -> {
    if (e.getType() == LineEvent.Type.STOP) {
      syncLatch.countDown();
    }
  });

  clip.open(stream);
  clip.start();
}

syncLatch.await(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-06-25T15:12:00.163

你可以把这段代码改为：

假设您的剪辑 1 正在播放并且您希望在此之后立即播放剪辑 2，您可以：

```
clip1.start();
while(clip1.getMicrosecondLength() != clip1.getMicrosecondPosition())
{
}
clip2.loop(some int here); 
```

并且，为了在不延迟主要任务的情况下完成这项工作（我这么说是因为 while 循环使工作等待 clip1 完成，无论下一个工作是什么......）你可以在你的位置创建一个新线程希望它发生，只需将代码放在它的 run() 方法中......祝你好运！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-17T17:51:20.770

声音剪辑是一种类型或 Line，因此支持 Line 侦听器。

如果您使用 addLineListener，您应该在播放开始和停止时获取事件；如果你不在循环中，你应该在剪辑结束时停下来。但是，与任何事件一样，在实际播放结束和停止之前可能会有延迟。

让方法等待有点棘手。您可以忙于等待（不是一个好主意）或使用其他同步机制。我认为有一种模式（不确定）等待长时间操作以引发完成事件，但这是您可能希望单独发布给 SO 的一般问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-06T17:28:34.607

从 JDK8 开始，`Clip`的侦听器有点问题（即，它可能会触发 Type.STOP 两次以复制音频（`.start()`）。

因此，我会使用类似的东西：

```
Clip[] myBunchOfClipsToPlaySequentially=new Clip[A_BUNCH];
//
// [load actual clips...]
// [...]
//
for(Clip c: myBunchOfClipsToPlaySequentially)
    while(c.getFramePosition()<c.getFrameLength())
        Thread.yield(); // Note that if we simply put a NO-OP instead (like a
                        // semicolon or a {}), we make our CPU
                        // cry). Thread.yield() allows for almost 0% CPU consumption. 
```

此外，您可以查看 JFX8 提供的新[AudioClip](http://download.java.net/jdk8/jfxdocs/javafx/scene/media/AudioClip.html "Javadocs")类（有一些漂亮的方法可以摆弄）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-11T16:39:33.917

我已经使用等待/通知来实现这一点。仅供参考。

```
 final Clip clip = AudioSystem.getClip(mixerInfo);
        clip.addLineListener(new LineListener(){

            @Override
            public void update(LineEvent e) {
                if (e.getType()==LineEvent.Type.STOP){
                    synchronized(clip){
                        clip.notifyAll();
                    }
                    System.err.println("STOP!");
                }

            }

        });
        clip.open(as);
        clip.start();
        while (true){
            synchronized(clip){
                clip.wait();
            }
            if (!clip.isRunning()){
                break;
            }
        }
        clip.drain();
        clip.stop();
        clip.close(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-02-24T13:17:56.890

不确定我是否可以代表其他人发言，而且这个帖子很老了。但我使用剪辑库播放我的 .wav 文件，然后在声音文件运行的时间内让线程休眠：

```
Clip clip = AudioSystem.getClip();
clip.open(audioInputStream);
clip.start();
System.out.println("Clip Started");
Thread.sleep(162000); //Length of time in milliseconds
System.out.println("Clip finished"); 
```

对我来说就像一个魅力，我正在监视我的处理器，整个程序最多使用 4%！

# compiler-construction - 为什么构建交叉编译器比构建常规编译器更难？

> ID：557905
> 
> 赞同：9
> 
> 时间：2009-02-17T17:37:06.420
> 
> 标签：compiler-construction, cross-platform, cross-compiling

我读过的所有内容似乎都暗示构建交叉编译器比构建针对其运行平台的编译器要困难得多。这是真的？如果是这样，为什么？似乎为任意平台生成汇编代码和系统调用不应该比为编译器运行的平台生成这样的代码和系统调用更难，但也许我只是天真。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:52:11.237

这不一定更难，但它可能取决于编译器架构。

编译器不仅将源代码翻译成 asm 和系统调用。它还将预先存在的*帮助代码*集成到生成的文件中。这是代码包括启动代码、函数前导码、可以内联的部分 C api 等。

在平台 A 上构建的平台 A 的普通编译器 C1 中，原始编译器 C0 可以直接构建 C1 及其*帮助代码*（对于 A，因为 C0 以 A 为目标）。

在平台 A 上构建的平台 B 的交叉编译器 C2 中，原始编译器 C0 必须首先构建一个不需要*帮助代码*的特殊版本的 C2 （因为*帮助代码*是针对 B，而 C0 针对 A），然后它必须运行 C2 来生成*帮助代码*。根据编译器的不同，它可能必须生成包含*帮助程序代码*的第二个 C2 版本。

*在没有帮助代码*的情况下构建 C2 的受限版本的行为是引导。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-05T19:26:26.573

以下是我在使用 GCC 交叉编译时遇到的一些问题：

*   您必须在主机系统（即 sysroot）上存在来自目标系统的一些系统文件才能链接。

*   有些语言要求在编译时而不是在运行时评估事物；此外，一些优化导致在编译时评估将（在未优化的情况下）在运行时评估的东西。当目标具有主机系统上不存在的数字类型时，在编译时和运行时情况下获得相同的答案可能会很棘手。

*   测试可能会更烦人。您必须拥有两个系统，以及一种将程序从一个转移到另一个的方法。

不过，实际上，这就是我遇到的一般问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T17:55:53.457

“构建交叉编译器比构建针对其运行平台的编译器要困难得多。”

由于库的构建和访问方式而存在问题。

在正常情况下，所有库都位于特定位置，并由该系统上的所有应用程序使用。所有构建机制和软件都假定库的位置。make 文件、编译器等取决于他们可以去特定地点并找到所需内容的想法。

但是，在交叉编译的情况下，交叉编译器、make 文件等无法做出这些假设——如果他们这样做，它们将链接错误的库。

所以这真的归结为开发人员在早期做出了某些假设的事实，而我们坚持这一点。

构建根文件系统时会变得更难，因为 unix 只知道一个根文件系统。当您构建另一个根文件系统时，您必须创建一个特殊的环境，允许您在不影响真正的根文件系统的情况下对其进行操作。

-亚当

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T17:50:00.540

您是否有可能正在查看诸如“将 GCC 构建为交叉编译器”之类的特定案例，其中“构建”的意思是“编译”而不是“编写”？

由于库周围的问题，这可能会更难 - 对于交叉编译器，您需要目标平台的库。对于“本机”（即非交叉）编译器，您显然已经有了目标库。

我与您在“创建代码生成器”方面相同 - 或者至少受目标处理器体系结构的影响比受编译器执行位置的影响更大。

在某些情况下，交叉编译器比非交叉编译器*容易得多。*我认为一个 8051 托管的 C++ 编译器将是艰苦的工作，无论它针对什么平台。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T17:55:05.003

许多交叉编译器有多个目标。我认为总的来说，多目标编译器比单目标编译器要困难得多，并且所有多目标编译器都是定义交叉编译器。因此，许多交叉编译器比非交叉编译器复杂得多。

在平台 A 上编写一个只为平台 B 编译代码的编译器，原则上不应该比在平台 A 上编写一个只为平台 A 编译的编译器难。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T05:01:00.003

只有当您从未想到您可能想要交叉编译时，构建交叉编译器才是困难的。有趣的是，汇编器、链接器和调试器也是如此。您需要做的就是记住创建一个明确的抽象来表示您对目标机器的了解。

有关设计良好、文档完善的交叉编译器的示例，请查看[lcc](http://www.cs.princeton.edu/software/lcc/)。要了解交叉调试器的设计，请参阅[会议论文](http://www.cs.tufts.edu/~nr/pubs/retargetable-abstract.html)和[博士论文](http://www.cs.tufts.edu/~nr/pubs/thesis-abstract.html)。该代码可能是可下载的；我不知道。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T17:54:35.490

以下问题的答案可能会帮助您理解为什么这会很困难。

[为什么我们现在不能创建跨平台的程序？](https://stackoverflow.com/questions/545455/why-cant-we-create-programs-cross-platforms-these-days/545528)

我觉得这一切都归结为不同的操作系统以不同的方式调用本机 IO。要构建一个独立于平台的编译器，您将必须准确了解所有细节是如何工作的，并且基本上构建一个操作系统。

[我回家后会更新，因为我现在要下班了]

# python - 希望 procmail 运行自定义 python 脚本，每次出现新邮件时

> ID：557906
> 
> 赞同：10
> 
> 时间：2009-02-17T17:37:23.487
> 
> 标签：python, email, procmail

我对 procmail 有一个非常常见的要求，但我无法以某种方式获得结果。我有包含以下内容的 procmailrc 文件：

```
:0
* ^To.*@myhost
| /usr/bin/python /work/scripts/privilege_emails_forward.py 
```

其中我的自定义python脚本（privilege_emails_forward.py）将扫描当前收到的电子邮件并对邮件内容进行一些操作。但是我无法让脚本在第一时间执行（更不用说扫描邮件内容了）。

*   这是在新邮件到达后立即调用外部程序（python）的正确方法吗？
*   我的 python 程序（privilege_emails_forward.py）如何接收邮件作为输入？我的意思是 sys.argv 或 stdin????

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-17T17:45:04.123

这很好，只需放在( )`fw`之后。您的 python 程序将在. 您必须在 上“回显”可能已转换的邮件。`:0``:0 fw``stdin``stdout`

`fw`方法：

*   `f`将管道视为过滤器。
*   `w`等待过滤器或程序完成并检查其退出代码（通常被忽略）；如果过滤器不成功，则文本不会被过滤。

我的垃圾邮件检查器（bogofilter）就是这样工作的。它添加了标头，后来的 procmail-rules 会根据这些标头做一些事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T14:01:22.093

[日志摘录](https://stackoverflow.com/questions/557906/want-procmail-to-run-a-custom-python-script-everytime-a-new-mail-shows-up/561028#561028)清楚地表明您的脚本已执行，即使它没有显示出预期的效果。如果执行失败，我希望 procmail 记录错误。

无论如何，请确保执行 procmail 的用户 (uid) 具有执行脚本的正确权限。仅当您使用类似这样的方法成功测试时才将脚本连接到 procmail（将“procmail”替换为正确的 uid）：

```
# sudo -u procmail /bin/sh -c '/bin/cat /work/scripts/mail.txt | /usr/bin/python /work/scripts/privilege_emails_forward.py'

```

根据您的 sudo 配置，您必须以 root 身份运行它。哦，确保你使用绝对文件路径。

# ruby-on-rails - phusion 乘客字符集

> ID：557907
> 
> 赞同：0
> 
> 时间：2009-02-17T17:37:40.333
> 
> 标签：ruby-on-rails, encoding, passenger, character-encoding, phusion

我刚刚在 Centos 5.2 64 位服务器上安装了 Apache 2、Phusion Passenger 和 Rails 2.2.2。我的 mysql 数据库是 latin1，我的设置在 php 服务器上运行，除了使用数据库中的数据进行字符编码之外，我的 rails 设置也可以运行。

我已经设定

meta http-equiv="Content-Type" content="text/html;charset=iso8859-1" （省略括号）

在标题内部，但是当我查看页面的源代码时，我看到标题是正确的，但是当我运行时

HEAD [http://servername/posts/show/2](http://servername/posts/show/2)

我在字符集中得到 utf-8。

简而言之，我没有从数据库中获取数据中的 unicode 字符，但 posts.html.erb 中的 unicode 字符确实显示正确。

那么这个标题集在哪里，我做错了什么？

编辑，只需添加我通过运行 HEAD 获得的标题

Cache-Control: private, max-age=0, must-revalidate Connection: close Date: Tue, 17 Feb 2009 16:59:32 GMT ETag: "f242d9af7c676eb3f7b92f4c4f4b16d3" 服务器: Apache/2.2.3 (CentOS) 内容长度: 296 内容类型：文本/html；字符集= utf-8的客户端 - 日期：星期二，2009年2月17日16点59分32秒GMT客户对等：客户端 - 响应 - 编号：1的Set-Cookie：_html_session = BAh7BiIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNoSGFzaHsABjoKQHVzZWR7AA％3D％3D - 455dc90f774060b52ea418446bdf2774beea16d5; 路径=/; HttpOnly X-Powered-By: Phusion Passenger (mod_rails/mod_rack) 2.0.6 X-Runtime: 21ms

问候，

特劳斯蒂

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T17:57:43.703

回答我自己的问题。有人告诉我，通过添加此文本

ActionController::Base.default_charset=("ISO-8859-1")

进入 envrionment.rb 可以解决这个问题，而且确实如此。它解决了我的问题

# php - 数学问题：循环或递归

> ID：557909
> 
> 赞同：1
> 
> 时间：2009-02-17T17:37:49.350
> 
> 标签：php, math, recursion, loops

我试图将一个数字分解为一个数字数组（在 php 中），例如：

*   25 变为 (16, 8, 1)
*   8 变成 (8)
*   11 变为 (8, 2, 1)

我不知道正确的术语是什么，但我认为这个想法很清楚。

我的循环解决方案非常简单：

```
 $number = rand(0, 128);    
   $number_array_loop = array();

   $temp_number = $number;
   while ($temp_number > 0) {
       $found_number = pow(2, floor(log($temp_number, 2)));
       $temp_number -= $found_number;

       $number_array_loop[] = $found_number;
   } 
```

我也有一个递归解决方案，但如果不使用全局变量（不希望这样），我无法让它工作，以下接近但导致数组中的数组：

```
 function get_numbers($rest_number) {

       $found_number = pow(2, floor(log($rest_number, 2)));

       if ($found_number > 0) {
           $temp_array[] = get_numbers($rest_number - $found_number);
           $temp_array[] = $found_number;
       }

       return $temp_array;
   }

   $number_array_recursive = array();
   $number_array_recursive = get_numbers($number); 
```

但是，对于像这样的简单问题，使用类似**pow(floor(log()))**的东西似乎有点多。

在我看来，这个问题需要一个非常简单的数学递归解决方案，但我只是看不到它。

任何帮助将不胜感激。

**编辑：**二进制是关键，非常感谢大家！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T17:41:39.467

你可以得到数字的二进制表示 - 1 表示包含 2 的幂，零表示不包含

IE

```
 $binary_number = decbin($test_number);
$binary_string = "${binary_number}";
for ($i = 0; $i < strlen($binary_string); $i++) {
  if ($binary_string[strlen($binary_string) - $i - 1] == "1") {
    $num_out = pow(2, $i);
    print "${num_out} ";
  }
} 
```

这已经过测试并且工作正常，但在 PHP 中可能有更好的语法方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T17:43:16.670

根据我的经验，递归比循环的开销更大，所以我建议坚持使用你的循环解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T17:52:38.583

您可以使用以下（未经测试的）功能检查输入数字的每一位。

```
function checkBit($var, $pos)
{
    return ($var & (1 << $pos));
} 
```

它使用按位与函数检查变量 $var 中位置 $pos 的位。为简洁起见，我将向您展示 4 位数字。

*   1 = 0001
*   2 = 0010
*   4 = 0100
*   8 = 1000

如果我想检查数字 3 的位置 0（最右边的位），我会这样调用函数：

```
$number = 3;
checkBit($number, 0); 
```

在内部，checkBit 会将常量 1 向左移动 0 次，因为我传入了一个 0。然后它将与我传入的数字 3 进行按位与 (&) 结果。因为 3 = 0011 和 1 = 0001结果为真，因为在位与运算符的两个参数中都设置了第 0 位。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T17:55:23.460

如果您只是按位进行操作（例如“num＆0x0001”），并检查该操作的值是否为零，那么通过这些位应该是微不足道的，如下所示：（我知道这是在java中, 但我不懂 php, 反正也不是 php 特有的问题)

```
 int number=25;
for (int i = 0; i < 16; i++)
{
    if ((number & 0x0001) != 0)
    {
    System.out.println("" + Math.pow(2, i));
    }
    number = number >> 1;
} 
```

这样的事情在任何语言中都应该是微不足道的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T06:22:47.607

将整数分解为 2 的幂的另一种方法是继续除以 2 并找到余数。

例如：25/2 = 12 R 1，幂 = 2^0 = 1

12/2 = 6 R 0，功率 = 2^1 = 2

6/2 = 3 R 0，功率 = 2^2 = 4

3/2 = 1 R 1，功率 = 2^3 = 8

1/2 = 0 R 1，功率 = 2^4 = 16

所以，这里 25 = 1 + 8 + 16 因为这些是唯一余数为 1 的地方。

```
function powers_of_2($n)
{
    $powers = array();
    $base = 1;
    while ($n > 0)
    {
        if ($n % 2 == 1)
        {
            $powers[] = $base;
        }
        $n = (int)$n/2;
        $base *= 2;
    }
    return $powers;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T18:11:46.197

除非您的数字非常稀疏（即 number_array 将很小），否则通过所有权力工作可能会更快。留在基地2：

```
function get_powers_of_2($n) {

  // $max_pow = 31;       // faster if you know the range of $n
  $max_pow = log($n, 2);  // safe
  $powers = array();

  for($i = 0; i <= $max_pow; $i++) {
    $pow = 1 << $i;
    if($n & $pow) $powers[] = $pow;
  }
  return $powers;
} 
```

# c# - 使用 IComparer 随机播放

> ID：557911
> 
> 赞同：11
> 
> 时间：2009-02-17T17:38:48.477
> 
> 标签：c#, .net, shuffle, icomparer

首先，我知道Fisher-Yates shuffle。但是，为了争论，我想允许用户从下拉列表中选择一个排序选项。该列表将包括一个“随机”选项。根据他们的选择结果，我只想用 IComparer 实例替换我的排序。IComparer 会是什么样子？

谷歌提出了大量有缺陷的结果，它们都采用这种形式：

```
public class NaiveRandomizer<T> : IComparer<T>
{
    private static Random rand = new Random();

    public int Compare(T x, T y)
    {
        return (x.Equals(y))?0:rand.Next(-1, 2);
    }
} 
```

但是，这种实现是有偏见的，在某些情况下甚至会抛出异常。偏差可以用下面的代码来证明：

```
void Test()
{
    Console.WriteLine("NaiveRandomizer Test:");
    var data = new List<int>() {1,2,3};
    var sortCounts = new Dictionary<string, int>(6);
    var randomly = new NaiveRandomizer<int>();

    for (int i=0;i<10000;i++)
    {   //always start with same list, in _the same order_.
        var dataCopy = new List<int>(data); 
        dataCopy.Sort(randomly);

        var key = WriteList(dataCopy);
        if (sortCounts.ContainsKey(key))
            sortCounts[key]++;
        else
            sortCounts.Add(key, 1);
    }

    foreach (KeyValuePair<string, int> item in sortCounts)
        Console.WriteLine(item.Key + "\t" + item.Value);
}

string WriteList<T>(List<T> list)
{
   string delim = "";
   string result = "";
   foreach(T item in list)
   {
       result += delim + item.ToString();
       delim = ", ";
   }
   return result;
} 
```

那么如何实现一个随机`IComparer<T>`的来解决这些问题呢？允许要求每次调用都`.Sort()`使用单独的 IComparer 实例，因为我看不到任何其他方法可以做到这一点：必须使用其他一些真正随机的值来比较项目*，*但该值也*必须*与项目一致在给定的排序操作中。

我在[这里](https://stackoverflow.com/questions/554587/is-there-an-easy-way-to-randomize-a-list-in-vb-net/554652#554652)有一个开始，但它是匆忙发布的，*非常*慢，甚至没有返回所有可能的类型（测试表明它至少消除了偏见，如果你不计算缺失的选项）。我不希望像 Fisher-Yates 那样的 O(n) 性能，但我确实想要一些合理的东西（n log n 表示小的 n），我确实希望它能够显示所有可能的类型。不幸的是，该链接是该问题的当前公认答案，因此我希望能够用更好的东西替换它。

如果不出意外，我希望这能吸引所有那些寻找 IComparable 解决方案的谷歌查询——他们最终会在这里而不是在其他地方告诉他们使用不正确的版本。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-17T18:38:35.710

[在这个帖子](https://stackoverflow.com/questions/554587/is-there-an-easy-way-to-randomize-a-list-in-vb-net/)中，我有些惊讶地发布了多少错误答案。只是为了其他想出类似于 OP 发布的解决方案的人，以下代码*看起来*是正确的：

```
int[] nums = new int[1000];
for (int i = 0; i < nums.Length; i++)
{
    nums[i] = i;
}

Random r = new Random();
Array.Sort<int>(nums, (x, y) => r.Next(-1, 2));

foreach(var num in nums)
{
    Console.Write("{0} ", num);
} 
```

但是，代码偶尔会抛出异常，但并非总是如此。这就是调试变得有趣的原因:) 如果您运行它足够多次，或者在循环中执行排序过程 50 次左右，您将收到一条错误消息：

`IComparer (or the IComparable methods it relies upon) did not return zero when Array.Sort called x. CompareTo(x). x: '0' x's type: 'Int32' The IComparer: ''.`

换句话说，快速排序将某个数字`x`与自身进行比较并得到非零结果。代码的明显解决方案是：

```
Array.Sort<int>(nums, (x, y) =>
    {
        if (x == y) return 0;
        else return r.NextDouble() < 0.5 ? 1 : -1;
    }); 
```

但即使这样也行不通，因为有时 .NET 将 3 个数字相互比较会返回不一致的结果，例如 A > B、B > C 和 C > A（哎呀！）。无论您使用 Guid、GetHashCode 还是任何其他随机生成的输入，如上所示的解决方案仍然是错误的。

* * *

话虽如此，Fisher-Yates 是洗牌数组的标准方法，因此首先没有真正的理由使用 IComparer。Fisher-Yates 是 O(n)，而使用 IComparer 的任何实现都在后台使用快速排序，其时间复杂度为 O(n log n)。没有充分的理由不使用众所周知的、高效的标准算法来解决这类问题。

但是，如果您真的坚持使用 IComparer 和 rand，那么在排序*之前应用您的随机数据。*这需要将数据投影到另一个对象上，这样您就不会丢失随机数据：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    class Pair<T, U>
    {
        public T Item1 { get; private set; }
        public U Item2 { get; private set; }
        public Pair(T item1, U item2)
        {
            this.Item1 = item1;
            this.Item2 = item2;
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            Pair<int, double>[] nums = new Pair<int, double>[1000];
            Random r = new Random();
            for (int i = 0; i < nums.Length; i++)
            {
                nums[i] = new Pair<int, double>(i, r.NextDouble());
            }

            Array.Sort<Pair<int, double>>(nums, (x, y) => x.Item2.CompareTo(y.Item2));

            foreach (var item in nums)
            {
                Console.Write("{0} ", item.Item1);
            }

            Console.ReadKey(true);
        }
    }
} 
```

或者用你的坏自我获得 LINQy：

```
Random r = new Random();
var nums = from x in Enumerable.Range(0, 1000)
           orderby r.NextDouble()
           select x; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T14:31:07.340

我在别处得到的一个建议是创建一个单独的 IAranger 接口，该接口描述了一个**排列**集合的单个操作。这可以在 IComparer/IComparable 不能工作的地方工作，因为它对整个集合而不是单个项目进行操作。它可能看起来像这样：

```
public interface IArranger<T>
{
    IEnumerable<T> Arrange(IEnumerable<T> items);
} 
```

然后我可以`Shuffle`使用适当的 Fisher-Yates 算法从 IArranger 接口实现 a ，并且还可以实现包装`IEnumerable.Sort()/IComparable/IComparer`我关心的每个其他品种。这可能看起来像这样：

```
public class ComparerArranger<T> : IArranger<T>
{
    private IComparer<T> comparer;

    public ComparableArranger(IComparer<T> comparer)
    {
        this.comparer = comparer;
    }

    public IEnumerable<T> Arrange(IEnumerable<T> items)
    {
       return items.OrderBy(i => i, comparer);
    }
} 
```

或者

```
//uses the default Comparer for the type (Comparer<T>.Default)
public class TypeArranger<T> : IArranger<T> 
{
    public IEnumerable<T> Arrange(IEnumerable<T> items)
    {
       return items.OrderBy(i => i);
    }
} 
```

或者

```
public class ShuffleArranger<T> : IArranger<T>
{
    //naive implementation for demonstration
    // if I ever develop this more completely I would try to
    // avoid needing to call .ToArray() in here
    // and use a better prng
    private Random r = new Random();

    public IEnumerable<T> Arrange(IEnumerable<T> items)
    {
        var values = items.ToArray();

        //valid Fisher-Yates shuffle on the values array
        for (int i = values.Length; i > 1; i--)
        {
            int j = r.Next(i);
            T tmp = values[j];
            values[j] = values[i - 1];
            values[i - 1] = tmp;
        }
        foreach (var item in values) yield return item;
    }
} 
```

最后一步，我通过扩展方法将对此的支持添加到任何 IEnumerable 中。然后你仍然得到简单的运行时算法交换，你有一个更好的 shuffle 算法实现，使用它的代码感觉很自然：

```
public static IEnumerable<T> Arrange(this IEnumerable<T> items, IArranger<T> arranger)
{
    return arranger.Arrange(items);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T18:44:08.833

IComparer在某个点*需要*零回报（对于 T 的相等实例），使得从*数学*上创建一个通用的 IComparer 来模拟 Fisher-Yates Shuffle 是不可能的。总会有偏见。对于真正的洗牌，你永远不想强迫它返回任何特定的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T18:00:12.620

如何基于预先分配随机值的隐藏字段进行排序？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T00:51:13.863

跟进 James Curran 的想法：让 IComparer 将“排序”的值保持为一个列表；如果出现新值，则将其插入到列表中的随机位置；按列表索引进行比较。通过将列表维护为平衡树或其他东西进行优化。这种 IComparer 的每个实例都将保持一致且随机的排序顺序，因此您可以选择让您的 Random 排序始终保持相同的随机顺序或每次都不同。如果您更喜欢以这种方式阅读“随机”，那么微小的修改甚至允许将相同的元素“排序”到不同的排序位置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T14:20:25.230

一个有趣的尝试。很可能是对 IComparer 的误用/滥用。

您正在尝试通过使用不是为此目的而构建的机制来进行随机加权排序。

为什么不实现自己的排序例程和自己的比较器？我有一种感觉，即使那样也不够。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T15:46:43.587

不要这样做。

迄今为止提出的所有算法都在输出中引入了某种偏差（一些比其他更大）。

@Princess 和@Luke 建议在数据旁边存储一个随机数。但是，由于这些随机数中的任何两个可能具有与另一个相同的值，因此这两个项目之间的排序顺序将具有确定性偏差

最坏的情况是如果排序例程是“稳定的”（即被认为相等的对象总是按照它们输入的顺序输出）。Array.Sort 并不稳定（它在内部使用 QuickSort），但是当两个项目具有相同的值时仍然会出现偏差，这取决于它们在输入中的位置（特别是它们相对于 QuickSort 的位置）枢）。

随着这个随机数的键空间增加，发生冲突的概率会下降（随机性的来源很好），但请记住，随着您要排序的值数量的增加，生日悖论表明其中至少一对碰撞的速度很快。

对于整数键，该键有 2^32 个唯一值，即使假设随机值完全均匀分布，有 75,000 行，也有 50% 的概率会发生冲突。 [维基百科](http://en.wikipedia.org/wiki/Birthday_attack)。

您提出的加密哈希方法可能具有足够大的密钥空间 (160) 位，以使发生冲突的机会可以忽略不计，但是您的算法在实际进行比较之前将所有随机性分解回单个 int，这否定了那个更大的键空间。

您最好的方法是将不同的“sortOrder”值与每个数据项相关联，使用经过验证的算法对这些值进行洗牌，然后按该值对结果进行排序。

如果您使用的是 Array.Sort，则会出现一个重载，它需要一个“键”数组和一个“值”数组。键数组正常排序，但是每当键数组中的值被移动时，值数组中的相应条目也被移动。

就像是：

```
 Something[] data;//populated somewhere
int[] keys = new int[data.Length];//or long if you might have lots of data
for(int i=0;i<keys.Length;++i) {
 keys[i] = i;
}

Shuffle(keys);

Array.Sort(keys, data); 
```

# javascript - 如何突出显示输入框中的文本子集？

> ID：557914
> 
> 赞同：1
> 
> 时间：2009-02-17T17:40:31.483
> 
> 标签：javascript, html, ajax

我试图弄清楚是否可以使用 Javascript 在文本字段中突出显示特定范围的数据。

```
textfield.select(); 
```

^^ 可以选择整个文本，但是对于我所有的谷歌搜索，我还没有偶然发现一种方法来选择，例如，输入文本的字符 2 到 10。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T17:52:33.420

IE 与其他所有人的处理方式不同。

这是带有示例的参考指南：

[http://www.sxlist.com/techref/language/html/ib/Scripting_Reference/trange.htm](http://www.sxlist.com/techref/language/html/ib/Scripting_Reference/trange.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T17:51:55.073

我认为有一种非常特定于 IE 的方式来做到这一点，它涉及 TextRange 对象。

[这是有关 TextRange 对象的一些文档。](http://msdn.microsoft.com/en-us/library/ms535872(VS.85).aspx#)

发布后我意识到这可能只适用于文本区域。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T17:46:57.443

此对象将让您获取、设置和修改文本框的选定区域。

```
function SelectedText(input) {
  // Replace the currently selected text with the given value.
  this.replace = function(text) {
    var selection = this.get();

    var pre = input.value.substring(0, selection.start);
    var post = input.value.substring(selection.end, input.value.length);

    input.value = pre + text + post;

    this.set(selection.start, selection.start + text.length);

    return this;
  }

  // Set the current selection to the given start and end points.
  this.set = function(start, end) {
    if (input.setSelectionRange) {
      // Mozilla
      input.focus();
      input.setSelectionRange(start, end);
    } else if (input.createTextRange) {
      // IE
      var range = input.createTextRange();
      range.collapse(true);
      range.moveEnd('character', end);
      range.moveStart('character', start);
      range.select();
    }

    return this;
  }

  // Get the currently selected region.
  this.get = function() {
    var result = new Object();

    result.start = 0;
    result.end = 0;
    result.text = '';

    if (input.selectionStart != undefined) {
      // Mozilla
      result.start = input.selectionStart;
      result.end = input.selectionEnd;
    } else {
      // IE
      var bookmark = document.selection.createRange().getBookmark()
      var selection = inputBox.createTextRange()
      selection.moveToBookmark(bookmark)

      var before = inputBox.createTextRange()
      before.collapse(true)
      before.setEndPoint("EndToStart", selection)

      result.start = before.text.length;
      result.end = before.text.length + selection.text.length;
    }

    result.text = input.value.substring(result.start, result.end);

    return result;
  }
} 
```

# timeout - 超时后是否需要调用 EndInvoke？

> ID：557918
> 
> 赞同：9
> 
> 时间：2009-02-17T17:41:30.840
> 
> 标签：timeout, begininvoke

在网页上，我打电话给不允许我以编程方式设置超时的第三方。我调用 BeginInvoke 并使用 AsyncWaitHandle.WaitOne 等待指定的时间量。

如果调用超时，我会继续并忘记我开始的线程调用。我的问题是，在超时情况下我还需要以某种方式调用 EndInvoke 吗？这个 MSDN 页面上的“CAUTION”评论让我想知道我是否应该：http: [//msdn.microsoft.com/en-us/library/2e08f6yc (VS.71).aspx](http://msdn.microsoft.com/en-us/library/2e08f6yc(VS.71).aspx)

如果您认为我应该这样做，那么下一个问题是如果我的网页在第三方返回之前完成处理并返回到客户端，回调方法是否会在那里监听运行代码？一旦我的请求/响应完成，服务器是否不会停止寻找活动？

这是我正在使用的代码：

```
public class RemotePaymentProcessor
{
    private delegate string SendProcessPaymentDelegate(string creditCardNumber);

    private string SendProcessPayment(string creditCardNumber)
    {
        string response = string.Empty;
        // call web service
        SlowResponseService.SlowResponseService srs = new WebServiceTimeout.SlowResponseService.SlowResponseService();
        response = srs.GetSlowResponse(creditCardNumber);
        return response;
    }

    public string ProcessPayment(string creditCardNumber, int timeoutMilliseconds)
    {
        string response = string.Empty;

        SendProcessPaymentDelegate sppd = new SendProcessPaymentDelegate(SendProcessPayment);
        IAsyncResult ar = sppd.BeginInvoke(creditCardNumber, null, new object());
        if (!ar.AsyncWaitHandle.WaitOne(timeoutMilliseconds, false))
        {
            // Async call did not return before timeout
            response = "TIMEOUT";
        }
        else
        {
            // Async call has returned - get response
            response = sppd.EndInvoke(ar);
        }
        return response;
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T18:11:12.220

如果不调用 EndInvoke，可能会泄漏一些资源（由 BeginInvoke 分配）。

所以为了完全安全，总是调用 EndInvoke() （这会阻塞，所以在你不需要的一些后台线程上这样做，或者切换到传递回调以免在等待时烧毁线程）。

在实践中，我不知道它的重要性（我认为许多 AsyncResults 不会泄漏，所以在这种情况下你可能会很幸运并且很安全）。

所有这些几乎与请求-响应和 Web 服务器无关，这就是 Begin/End 编程模型的工作原理，无论您在什么应用程序中使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T18:03:47.010

**更新：**
似乎您需要始终为异步调用[调用 EndInvoke （除非它的 Control.BeginInvoke）或有泄漏资源的风险。](http://blogs.msdn.com/cbrumme/archive/2003/05/06/51385.aspx)

这是[一个相同的讨论](http://www.opensubscriber.com/message/dotnet-winforms@discuss.develop.com/8386044.html)。建议的解决方案是生成一个线程，等待委托实际完成并调用 EndInvoke。但是，如果发生真正的 Looong 超时，我认为该线程会挂起。

这是一个似乎没有很好记录的边缘案例......也许因为不应该发生超时......例外情况

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T18:44:38.397

对于 .NET 异步模式的一般情况，当您不想完成从 BeingXXX 开始的操作时调用 EndXXX 将是错误的，因为如果在操作完成之前调用 EndXXX，它应该阻塞直到完成。这对超时没有太大帮助。

特定的 API 可能不同（例如 WinForms 明确不需要 EndInvoke）。

参见“框架设计指南”（第 2 版）第 9.2 节。或[msdn](http://msdn.microsoft.com/en-gb/library/ms228963.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T19:51:16.150

好吧，我不能忽视我在各处看到的建议，如果我不能确保调用 EndInvoke，我可能会泄漏一些资源，所以我不得不尝试让它在晚上睡觉，而不用担心我正在接近悬崖.

我找到的解决方案使用了异步回调函数。如果电话及时返回，我会在那里调用 EndInvoke。如果没有，我继续单击按钮，并让异步回调函数使用 EndInvoke 清理混乱。

为了回答我自己关于 Web 应用程序的问题以及“在我超时并继续前进后有人会在那里听吗”，我发现他们会——即使我超时并继续前进，如果我观看了稍后的输出，那异步call 将返回并运行回调函数，即使我已经将输出返回给客户端。

我使用了我在以下网址找到的一些内容：[http ://www.eggheadcafe.com/tutorials/aspnet/847c94bf-4b8d-4a66-9ae5-5b61f049019f/basics-make-any-method-c.aspx](http://www.eggheadcafe.com/tutorials/aspnet/847c94bf-4b8d-4a66-9ae5-5b61f049019f/basics-make-any-method-c.aspx)

...以及结合我在其他地方找到的回调内容。这是我在下面所做的一个小示例功能。它结合了我在感谢大家的意见！：

```
public class RemotePaymentProcessor
{    
    string currentResponse = string.Empty;

    private delegate string SendProcessPaymentDelegate(string creditCardNumber);    
    private string SendProcessPayment(string creditCardNumber)    
    {        
        SlowResponseService.SlowResponseService srs = new WebServiceTimeout.SlowResponseService.SlowResponseService();        
        string response = srs.GetSlowResponse(creditCardNumber);        
        return response;    
    }    

    public string ProcessPayment(string creditCardNumber, int timeoutMilliseconds)    
    {        
        string response = string.Empty;        
        SendProcessPaymentDelegate sppd = new SendProcessPaymentDelegate(SendProcessPayment);        
        IAsyncResult ar = sppd.BeginInvoke(creditCardNumber,  new AsyncCallback(TransactionReturned), sppd);        
        if (!ar.AsyncWaitHandle.WaitOne(timeoutMilliseconds, false))        
        {            
            // Async call did not return before timeout            
            response = "TIMEOUT";        
        }        
        else            
        {            
            // Async call has returned - get response            
            response = sppd.EndInvoke(ar);        
        }        

        currentResponse = response; // Set class variable
        return response;    
    }

    private void TransactionReturned(IAsyncResult ar)
    {
        string response = string.Empty;

        // Get delegate back out of Async object
        SendProcessPaymentDelegate sppd = (SendProcessPaymentDelegate)ar.AsyncState;

        // Check outer class response status to see if call has already timed out
        if(currentResponse.ToUpper().Equals("TIMEOUT"))
        {
            // EndInvoke has not yet been called so call it here, but do nothing with result
            response = sppd.EndInvoke(ar);
        }
        else
        {
            // Transaction must have returned on time and EndInvoke has already been called.  Do nothing.
        }       

    }
} 
```

# sql - 您应该如何处理单个产品的多个价格数据？

> ID：557922
> 
> 赞同：1
> 
> 时间：2009-02-17T17:42:12.757
> 
> 标签：sql, database-design

我数据库中的每个产品至少可以有三个，有时是四个或五个不同的价格，显示哪一个取决于几个因素。我应该如何尝试解决这种情况？

每个产品可以有以下价格：

*   标价 (MSRP)
*   成本（我们为此付出的代价）
*   零售价 - 显示在“主”网站上
*   政府价格（我们的主要客户是美国政府） - 仅显示在我们的政府子域
*   销售价格（有效期为 1 个月，但每月延长）- 仅显示在我们的政府子域上
*   BPA 价格（BPA 的特价）- 未显示，但已加载到政府网站

标价在供应商的季度数据文件中提供并保存在`Products`表格中，因为它是产品实体的有限部分。我应该如何处理其他价格？

我认为最好的（唯一？）行动方案是有一个单独的表格，其中包含不同的价格结构以及`SaleStartDate`我`SaleEndDate`可以检查以查看是否显示销售价格的列。事实上，我不确定有什么其他方法可以处理这个问题。

另外，我需要一份副本（不同的价格，但相同的成本），因为我们公司为与我们业务相同的不同公司进行处理（所有工作，真的）；产品相同，但客户/订单/具体价格不同。当前的实现有一个重复的数据库，所有内容都重复（与代码相同），我想像瘟疫一样避免这种情况，所以我试图想出一种方法来抽象出常见的东西。

**编辑（2/17/2009 @ 12:57PM）：**除了标价外，价格都是根据成本计算的，但这并不总是那么容易；有时项目需要手动更改其价格而不受利润影响，但是这是通过 Excel 手动处理的，并且每季度（3 个月）只有一次；当数据加载到数据库中时，价格是有限的，直到下一个季度才会改变；“销售”价格是永久有效的，但它会过期（不是在我们的网站上，而是在 GSA Advantage 等几个政府网站上）并且需要延长；扩展时它不会改变。销售价格只是让我们自己的网站与 GSA Advantage 同步，因此如果政府客户访问我们的网站，他们会看到与 Advantage 相同的价格。

RE：另一家公司，这可能是一条路，尽管必须多次做所有事情会非常烦人；产品完全相同，成本完全相同（我们基本上为他们做所有事情，这只是名义上的另一家公司，事实上他们的客户与我们不同），但他们的价格使用与我们不同的标记。其他一切都是相同的，这就是为什么我希望将产品信息等内容保存在一个表中，然后将差异保存在不同的表中。当前的系统很混乱，主要是因为**所有内容**（数据库、代码文件、图像、所有内容）都是重复的，因此重构我们网站中的代码需要对其他网站进行相同的更改。

**编辑（2009 年 2 月 17 日@下午 4:52）：**到目前为止，有一些非常好的想法。其中一个问题是，除了报告目的和参考之外，只有一个价格栏是“真实的”栏。例如，*总是*向政府客户显示政府价格，但如果当前日期在销售日期期间，则会显示销售价格（“销售”定价特定于政府客户）。如果客户订购 BPA（这将由我们的订单处理系统和/或用户手动覆盖确定），则价格自动为 BPA 价格。可能会显示标价以显示您获得的折扣，并且它是报告所必需的，但仅此而已。

另外，我不确定标准化事情会带来多么糟糕的更新。现在，我刚刚收到一个包含新定价的电子表格，并被告知要更新数据库（因为它们都在产品表中）；我根据产品的 SKU 执行此操作，因为 ID 仅供内部使用，并且所有相关表都通过 SKU 链接。使用单独的价格表变得更加笨拙，尽管我仍然可以使用 SKU 作为参考（它将成为产品的唯一索引），但必须手动完成更多工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:52:59.143

*   我的第一个问题是，是否可以根据其中一个价格计算所有价格？如果是，并且所有产品的规则都相同，那么我们将处于一个更容易的位置。

*   是否有任何价格独立于其他价格而变化？您暗示销售价格有效期为 1 个月，然后延长 - 价格保持不变还是发生变化？如果它保持不变，这比改变它更容易。

为产品价格设置开始和结束日期是正确的，因为这将是历史价格报告的基础。

**编辑：**

我在想您可以根据成本价格为其他价格使用[持久计算列](http://msdn.microsoft.com/en-us/library/ms191250.aspx)，但由于可以手动调整价格，这不是一个选项（我不相信您可以覆盖 pcc 值）。`PRICE`您可以编写一个存储过程来根据成本价将初始价格插入到表中。

根据到目前为止的信息，我认为你最好的选择是在你的表中有一个单独`PRICE`的表，并且你的`PRODUCT`表中有一个 product_id 外键`PRICE`引用表的主键 id `PRODUCT`-

**产品表**

```
id | name | image | description | etc... 
```

**价格表**

```
id | product_id | list_price | cost_price | retail_price | gov_price | sale_price | bpa_price | start_date | end_date 
```

谨慎的做法是在定价中包含开始日期和结束日期字段，因为您不仅可以报告历史价格，还可以使用未来价格填充表格。

使用上述结构，现在当您有价格变化时，您需要在产品的 PRICE 表中插入一条新记录。设置开始和结束日期的索引，然后您将查询产品和价格如下

```
SELECT 
product.name,
price.list_price,
price.cost_price,
price.retail_price /*, ETC... */
FROM
product
INNER JOIN
price
ON product.id = price.product_id
WHERE
price.start_date <= @date
AND price.end_date >= @date 
```

你可以进一步规范这个设计，也可以有一张`PRICE_TYPE`桌子。然而，采用这种方法要记住的是，如果您想获得产品的完整价格集，则 WHERE 子句适用于每个产品的 6 条记录。

为了处理其他公司的情况，只要设置了适当的权限和限制，我发现将它们的价格存储在同一个数据库中*几乎没有问题。*你说他们使用不同的标记 - 你指的是他们的价格吗？如果是这样，您可以使用价格表中的 company_id 处理此问题。可以通过存储过程控制对数据的访问，并通过交易更新价格。

*这取决于公司之间工作的紧密耦合程度。是否允许共享资源？

（注意，我假设您的目标数据库是 SQL Server，但我认为其他平台的逻辑类似）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T17:48:40.980

在`MS SQL`或`Oracle`：

创建一个表`prices`：

```
CREATE TABLE prices (product, pricetype, price, startdate, enddate) 
```

询问：

```
SELECT product, price, pricetype
FROM (
  SELECT products.* ,
         prices.*
         ROW_NUMBER() OVER (PARTITION BY product, pricetype ORDER BY startdate) rn
  FROM products, prices
  WHERE prices.product = product.id
     AND startdate <= @date
 )
WHERE rn = 1
AND enddate >= @date 
```

这将为您提供所有类型的实际价格`@date`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T17:53:42.260

从我的角度来看，我将有一个项目表：带有标价 (MSRP)、成本、零售价、政府价格和 BPA 价格

和

销售表：带有销售价格、开始日期、结束日期，显然还有一个指向项目表的链接。

至于其他公司的东西，我想你会希望它成为一个单独的数据库。我不想将我的站点的数据与其他站点混合。即使它们是重复的。我知道总是不得不两次做同样的事情是很痛苦的，但它们似乎是独立的系统，应该这样对待。

只是我的两分钱。

# python - 调试网络应用

> ID：557927
> 
> 赞同：8
> 
> 时间：2009-02-17T17:43:59.307
> 
> 标签：python, eclipse, debugging, google-app-engine

多年来，我已经非常习惯于逐步调试调试器，无论是在构建器中，还是在 Eclipse 中使用 pydev 调试器。

目前，我正在用 Python 做一些东西并在 Google App Engine 上运行它，我应该补充一点，我对开发任何真正的网络应用程序都很陌生；除了编辑 HTML 代码之外，我从来没有真正做过太多事情。

因此，我正在运行 Google 的 dev_appserver 并在[http://localhost](http://localhost)查看我的工作，挖掘，而现在，我用来识别问题的唯一工具是 PMD（穷人的调试器）。. .基本上写东西到html页面来查看局部变量的值。

有没有更好的技术来处理这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T17:47:05.163

dev_appserver 只是一个 python 脚本，据我所知，您可以简单地在该脚本上使用带有正确参数的 pydev 调试器。

这是有关如何执行此操作的非常详细的指南：

[http://www.ibm.com/developerworks/opensource/library/os-eclipse-mashup-google-pt1/index.html](http://www.ibm.com/developerworks/opensource/library/os-eclipse-mashup-google-pt1/index.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T18:33:49.560

我建议使用日志语句而不是打印，因为您可以更好地控制它们。Python 包含一个相当不错的日志库。

对于从 Google App Engine 登录到例如 Firebug，还有一些名为[FirePython](http://appengine-cookbook.appspot.com/recipe/firepython-logger-console-inside-firebug/)的方便工具。这允许从您的 Django 或 WSGI 应用程序（它是中间件）中登录到 firebug 控制台。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T18:13:26.987

“有没有更好的技术来处理这个问题？” 并不真地。

“逐步调试器”是他们自己的问题。它们是一种精神拐杖，可以很容易地得到看起来有效的东西。

首先，查看[http://code.google.com/appengine/docs/python/tools/devserver.html#The_Development_Console](http://code.google.com/appengine/docs/python/tools/devserver.html#The_Development_Console)是否有帮助。

其次，请注意`--debug`在运行时将详细的调试消息打印到控制台。

最后，请注意，您需要大量的 Python 经验和 Google AppEngine 经验来编写 Web 应用程序之类的东西。要获得这种体验，该`print`声明确实非常好。它向您展示正在发生的事情，并鼓励您真正了解您*期望*或*打算*发生的事情。

调试器是被动的。它演变为编写随机代码，查看会发生什么，进行更改直到它起作用。我看过人们这样做。

打印语句处于活动状态。您必须计划应该发生的事情，编写代码并仔细考虑结果以查看计划是否成功。如果它没有达到您的预期，您必须假设并检验您的假设。如果它有效，那么您“了解”发生了什么。一旦你掌握了 Python 和 Google AppEngine 的语义，你的理解就会增长，这变得非常容易。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T12:01:10.290

我的 GAE 调试工具箱：

*   标准 Python 日志记录作为`print`语句的替代品
*   [Werkzeug 调试器](http://dev.pocoo.org/projects/werkzeug/wiki/UsingDebuggerWithAppEngine)，如果我不想去控制台记录每个错误（并非一切正常，最值得注意的是交互式解释器会话）
*   [http://localhost:8080/_ah/admin/interactive](http://localhost:8080/_ah/admin/interactive)的交互式控制台（不如 Django 的好，`python manage.py shell`但仍然......）

符号调试器不像其他地方那么受重视，可能是因为 Python 优越的自省和反射机制。

# c# - 我可以在 ZedGraph 中创建这种类型的图表吗？

> ID：557935
> 
> 赞同：0
> 
> 时间：2009-02-17T17:46:12.513
> 
> 标签：c#, .net, wpf, graphing, zedgraph

假设我在 ZedGraph 中有一条 y 轴上从 -10 到 +10 的正弦曲线。我希望能够对曲线设置限制（假设最小值为 -5，最大值为 +7），这样任何低于 -5 和高于 +7 的东西都会被遮蔽，中间的所有东西都是不是。这在[ZedGraph](http://www.codeproject.com/KB/graphics/zedgraph.aspx)中可行吗？

这在任何开源 .NET 图表库（免费商业用途）中是否可行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T19:03:07.883

我可以看到三个路线（不能说我已经尝试过），如果你想遮蔽整个图形区域，那么这两个中的任何一个：

(1) 使用 BoxObj，使用 alpha 值定义填充 - 这应该是完全灵活的。BoxObj 用于[**此**](http://zedgraph.org/wiki/index.php?title=Combo_Chart_Demo)演示的底部。

(2) 使用如图所示的填充绘图样式[**，**](http://zedgraph.org/wiki/index.php?title=Combo_Chart_Demo)您也可以看到半透明填充是如何定义的。不知道如何控制填充的位置（即图形最小值或最大值）而不是 x 轴。

或者，如果您只想对点进行着色，则可以有条件地构建曲线对象。

# .net - 最容易学习和使用的 .NET ORM 框架？

> ID：557948
> 
> 赞同：11
> 
> 时间：2009-02-17T17:50:52.503
> 
> 标签：.net, orm

**注意：**任何人现在提出这个问题，请注意日期。这个问题已经有将近4年的历史了，信息也比较过时。根据我的经验，NHibernate 现在相对容易使用（具有流畅的界面），Entity Framework 是一个合法的竞争者，而诸如 Dapper 和 Massive 之类的 MicroORMS 正变得非常流行。

* * *

我们正在重新编写我们的核心 Web 应用程序之一，我终于从管理层那里得到了所有明确的信息，用 ORM 框架替换了可怕的存储过程，以实现我们的数据访问层。

我万岁。现在我必须选择一个。

我已经玩了一点以下

*   [休眠](http://www.hibernate.org/343.html)
*   [Castle ActiveRecord](http://www.castleproject.org/ActiveRecord/)（我们会用它来驱动我们的 DTO 对象）
*   [亚音速](http://subsonicproject.com/)

现在我知道 NHibernate 是真正的 Alt.Netty 选择，但问题是我正在与据我所知从未听说过它的承包商合作，而且 NHibernate 以相当长的学习曲线而闻名。与此同时，亚音速似乎是一种更直接的方法。我也知道[实体框架](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)，但对它的“meh”接收和[Linq to Oracle](http://www.codeplex.com/LinqToOracle)持谨慎态度，但对我几乎没有听说过它的事实持谨慎态度。

所以问题是：

1.  还有其他我应该考虑的框架吗？
2.  你推荐哪个适合我的情况？

还有一些注意事项：

*   当我说我玩过这些框架时，我是认真的。我已经对它们进行了配置并使用它们来提取一些数据以确保一切正常。这就是它的程度。
*   这是一个 Oracle 数据库（您可能已经从包含 Linq2Oracle 中猜到了）
*   由于这是重写，因此数据库已经存在并且具有稳定的模式
*   我不太担心性能。我们的应用程序通常一次最多为几个人服务。
*   你们是必须回答我将要提出的大量问题的人

我倾向于亚音速，但我很好奇人们可能会说什么。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T17:58:22.233

你检查过[Telerik 的 OpenAccess ORM](http://www.telerik.com/products/orm.aspx)吗？他们最近收购了 Vanatec 及其 ORM 产品。它支持多个数据库平台（包括 Oracle）、LINQ 支持、正向和反向映射，与 Visual Studio 集成，并且在我看来（当然我有些偏见）是 LINQ to SQL 的合适替代品，如果那是“易于使用”，您正在寻找。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-17T18:32:12.700

NHibernate 将让您将域实体与数据层分离。它使用 XML 映射文件来描述关系，并使用 Castle DynamicProxy 来魔术延迟加载的属性。

NHibernate 在性能、灵活性和可配置性方面领先其他所有人几代。但是，正如您所说，这很复杂。SubSonic 非常简单，但它基本上是根据您的数据库生成静态代理类，因此您不会真正让 RM 脱离 ORM。IMO SubSonic、L2S 和 Castle ActiveRecord 都是 DAL 生成器，而不是 ORM。

IMO 这一切都取决于您的需求。如果您说的是 2 层，则选择其中一个 DAL 生成器。它会让你移动得更快，而且你的模型可能不会那么复杂，以至于你不能只从你的数据库模式中生成它。如果你有 n 层，我强烈推荐 NHibernate。当然，学习曲线更高（它不是火箭科学，但也不是按钮），但它实际上可以处理你需要的工作，如果你使用其他的一个，你最终会做很多反正都是手动的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-17T17:58:40.173

[CoolStorage.NET](http://www.codeplex.com/CoolStorage)是我的推荐。如果您坚持使用 .NET，它是最简单的功能完整解决方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-06T12:53:10.603

签[出 XmlDataMapper](http://xmldatamapper.codeplex.com/)一个简单的免费 ORM（LGPL 许可证），与其他巨头相比，它的内存占用较低。提供的示例项目应该足以开始使用。

要集成 XmlDataMapper，您只需 4 个小步骤

1.  为表创建业务实体/DTO
2.  使用表和 DTO 之间的映射信息创建一个 XML 文件。
3.  在配置中指定 DTO 和 xml 文件。
4.  只需调用 DTOConverter.Convert(dataReader) 和其他此类方法即可将您的数据库记录转换为 DTO / 业务实体

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T19:15:34.467

我会重新考虑您对 Microsoft 实体框架的评估。您可以使用 DevArt 的 DotConnect 提供程序作为解决方案，直到 Oracle 将来发布自己的提供程序。使用实体框架，您将不会使用“Linq to Oracle”，而是使用“Linq to Entities”，这是一个更好的解决方案。

我使用实体框架测试读取操作的结果非常好，其中读取操作比它的 SqlCommand\SqlDataReader 等价物快约 700%。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T18:57:47.957

那么在考虑 ORM 时的问题是

*   找到关于它的好信息。示例，学习资料。
*   是否有足够的人使用它（产品是否成熟）？使用它的公司越多，发现错误的可能性就越大。

当我查看 .Net 的 ORM 市场时，我发现越来越多关于 NHibernate 的材料

[指向有关 Nhibernate 的有用材料的链接](http://www.dbones.co.uk/blog/post/2008/10/Reference-Materal-for-Nhibernate.aspx)<- 视频、工具和最佳实践

Castle 建立在 NHibernate 之上（它使用 Active Record 模式）

谷歌看看 ORM 是否有任何工具可以帮助您更快地开发。

*   Telerick 说它带有 VS 集成
*   Nhibernate 有几个工具可以将数据库逆向工程到类中，还有 NHProf（不是免费的），它监视 NH 和 SQL 之间的 SQL

如果您没有进入 XML 映射文件，请查看是否可以找到 Fleunt 映射。这应该意味着编译时检查（有些人发现这更容易调试/重构代码）

[流畅的休眠](http://fluentnhibernate.org/)

高温高压

骨头

# java - 将 JSP 输出流传递给方法

> ID：557956
> 
> 赞同：3
> 
> 时间：2009-02-17T17:52:28.333
> 
> 标签：java, jsp

我创建了一个 MyClass 类，它打算将大量文本输出到 JSP。与其让 MyClass 对象返回要在页面上显示的字符串，我认为 MyClass 对象使用页面的输出流会更好。这是一个好/可能的主意吗？

在测试可能的方法来做到这一点......

这些输出文本，但它显示在页面正文之前：

```
response.getWriter().append("test1");
response.getWriter().println("test2");
response.getWriter().write("test3"); 
```

这个错误并告诉我输出流已经*得到*：

```
response.getOutputStream().println("test4"); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T18:10:30.847

`response.getWriter()`将为您提供与 JSP 中使用的不同的编写器。如果要写入与 JSP 页面相同的写入器，则需要使用`out`JSP 页面中的变量。不同之处在于 JSP 在标准之上使用缓冲`response.getWriter()`。`response.getWriter()`这就是为什么您会在 JSP 正文之前看到写入数据的原因。

你不能混合`response.getWriter()`和`response.getOutputStream()`。`out`JSP 中的变量是获得的 JspWriter 实例包装 writer，`response.getWriter()`因此调用`response.getOutputStream()`将失败。

你应该在你的 JSP 中做什么：

```
<%
  new MyClass().writeToWriter(out);
%> 
```

在 MyClass 中：

```
public void writeToWriter(Writer w) {
    w.println("My data appended to correct writer");
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T17:59:12.280

让类返回一个迭代器，该迭代器一次生成一小块文本。然后，您可以遍历 JSP 中的迭代器并在适当的位置打印数据块。

# php - php：将毫秒转换为日期

> ID：557959
> 
> 赞同：58
> 
> 时间：2009-02-17T17:52:53.607
> 
> 标签：php, datetime, time

我有一个等于日期的字符串，表示为自 Unix 纪元以来的毫秒数。

我正在尝试将其输出到 dmY。

我得到的字符串是“1227643821310”，我被告知结果应该等于*2-12-2008*，但我一直得到 25-11-2008 的*结果*

我的代码如下：

```
$mil = 1227643821310;
$seconds = $mil / 1000;
echo date("d-m-Y", $seconds); 
```

关于为什么会这样的任何想法？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-17T17:57:48.913

你已经做对了，1227643821 根本不是 02-12-2008，它确实是 25-11-2008。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2015-07-08T17:32:50.323

我刚刚添加了 H:i:s，如下例所示：

```
$mil = 1227643821310;
$seconds = $mil / 1000;
echo date("d/m/Y H:i:s", $seconds); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2020-04-27T18:09:04.797

```
$mil = 1227643821310;
$seconds = ceil($mil / 1000);
echo date("d-m-Y", $seconds); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T17:59:33.450

我唯一能想到的就是在将小数部分转换为日期之前尝试四舍五入。如果这不改变结果，那么结果是正确的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T18:24:03.593

杰夫，在处理时间戳时要了解的重要一点：它们代表从 0:00:00 01.01.1970*在 GMT*中过去的时间，而不是在您的时区中（当然，除非您自己在 GMT 中）。

1227643821 确实代表 GMT 时间 2008 年 11 月 25 日 20:10:21。

在世界大部分地区，这是 2008 年 11 月 25 日，但是在莫斯科以东的时区（由于夏令时，莫斯科时区本身在夏季）已经是 11 月 26 日。由于最“极端”的东部时区是 GMT+14，因此世界上没有任何地方可以用 1227643821 的时间戳来表示晚于 26 日的日期。

原始值的作者在处理时区时可能会出现某种错误。或者只是完全错误。例如，在计算值时，在某个步骤添加秒而不是毫秒。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-22T11:42:57.913

对于转换本身，我使用这一行：`$date = date('d-m-Y H:i:s', $millis / 1000);`

虽然答案很简单，但我也喜欢发布一个示例片段以供使用，所以它就是这样。

从中提取**日**、**月**和**年**。

```
// explode values first in spaces and then in dashes
$date = explode('-', explode(' ', $date)[0]); 
$day = $date[0];
$month = $date[1];
$year = $date[2]; 
```

随意使用它们：`echo $day . '-' . $month . '-' . $year;`

输出：`dd-mm-yyyy`

# xpath - 选择一个内部任何地方都有另一个元素的元素

> ID：557971
> 
> 赞同：4
> 
> 时间：2009-02-17T17:55:26.437
> 
> 标签：xpath

如何选择其中任何位置具有节点**b的任何节点****a**？

 **给定以下三个 XML 文档：

```
<a>
    <b></b>
</a> 
```

或者

```
 <a>
    <c>
        <b></b>
    </c>
</a> 
```

或者

```
 <a/> 
```

我希望选择前两个文档中的**a**元素。

显然，**a[//b]**不是解决方案。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-18T08:16:17.087

```
a[descendant::b] 
```

比

```
a[.//b] 
```

这等于

```
a[self::node()/descendant-or-self::node()/child::b] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T17:59:07.413

你应该试试：

`//a[.//b]`

# browser - HTTP 大文件传输

> ID：557973
> 
> 赞同：4
> 
> 时间：2009-02-17T17:56:15.860
> 
> 标签：browser, file-upload

有必要使用网络浏览器界面传输大文件。标准`<input type=”file”&gt;`或`<asp:FileUpload>`不为应用程序的用户提供足够的反馈。改善进度条、动画等反馈的现实方法是什么？目标用户是使用 IE、Firefox 和 Safari 浏览器的用户。我只知道动画 GIF 在文件发布期间不起作用，用户没有查看状态栏中的进度线或其他小图标，而且 AJAX 一词对解决此问题没有太大帮助 :-)

已编辑：用户不想安装任何 ActiveX 或小程序。用户很好，`<input type=”file”&gt;`但他们想要反馈 - 用户不断引用 youtube。优酷是怎么做到的？是秘密吗？服务器部分可以修改为具有自定义处理程序。HTML 作者和 Web 浏览器实现者是否使文件上传控制完全无用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:59:26.070

我们为我们的 .NET 应用程序使用了一个产品，称为 SlickUpload：[http ://krystalware.com/Products/SlickUpload/](http://krystalware.com/Products/SlickUpload/)

它提供上传进度指示器和信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T18:04:24.170

如果您希望返回有关文件上传的状态信息，您需要以某种方式将您的应用程序连接到接收上传的网络服务器。有些服务器会让你定义一个上传处理程序。这是[我发现的](http://www.devstack.com/articles/apache2-asp-file-uploads/)一个使用 Apache + ASP 的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T18:03:32.207

如果您不介意使用 silverlight 并且可以构建/托管 WCF 服务或 HttpHandler，您可以查看这个。[Silverlight Multi File Uploader](http://www.codeplex.com/SLFileUpload)将提供进度条信息和多文件上传。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T13:46:22.597

如果您可以为此使用闪存，您可以查看[http://www.codeproject.com/KB/aspnet/FlashUpload.aspx](http://www.codeproject.com/KB/aspnet/FlashUpload.aspx)

该项目有资源和解释，因此它可能是一个很好的起点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T14:00:56.040

如果您熟悉 Java，我推荐[jUpload](http://jupload.sourceforge.net/)，它可以很好地自定义，并且会拆分大文件以防止您的服务器阻塞。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-17T23:13:31.820

Chilkat 控件有一个可以执行此操作的[http://www.chilkatsoft.com/HttpActiveX.asp](http://www.chilkatsoft.com/HttpActiveX.asp)

他们有用于 ASP、Ruby、Python 等的。

# firefox - Mozilla 使用哪个框架或工具来开发他们的产品？

> ID：557976
> 
> 赞同：0
> 
> 时间：2009-02-17T17:56:38.637
> 
> 标签：firefox, frameworks, desktop-application

我知道这与编程无关，但我很想知道 mozilla 使用哪个框架或工具（比如我们使用 .NET Framework 开发桌面应用程序界面）来开发他们的产品，如“Firefox”、“Thunderbird”等。

我喜欢他们应用程序的界面，尤其是按钮看起来很酷而且重量很轻。乍一看，他们的应用程序和界面看起来很轻。而在 .NET 框架桌面应用程序中，按钮看起来很重，但它们在界面上没有 moziila 那样的效果。

谁能告诉我他们使用什么，我可以用它来开发我的应用程序吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T17:58:45.323

他们的 UI 基于 XUL ( [http://en.wikipedia.org/wiki/XUL](http://en.wikipedia.org/wiki/XUL) )。您可以使用名为 XULRunner 的程序来创建类似的应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T17:59:28.393

他们使用的 UI 都是基于 XUL 的，编程只用 c++ 完成。

[许尔](https://developer.mozilla.org/en-US/docs/The_Joy_of_XUL)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T18:00:41.370

Mozilla 使用[XUL](http://www.mozilla.org/projects/xul/)为 Firefox 和 Thunderbird 创建 UI。您可以将 XUL 视为一种 HTML 和 CSS。

# c# - 我们应该实施什么来授权客户使用我们的 Web 服务？

> ID：557979
> 
> 赞同：2
> 
> 时间：2009-02-17T17:57:25.967
> 
> 标签：c#, web-services, security, http-authentication

我们有一个 Web 服务，我们将托管在公共 Web 服务器上，并且将通过托管在医院墙壁内的 Web 服务器上的 Web 服务与其联系。我们已经编写了这两个软件，因此我们可以完全控制实现的内容。

我们希望保护两个 Web 服务器之间的通信。目前，我们唯一拥有的是公共 Web 服务器上的 https 和用于识别客户端的 guid。

我们可以支持网络级别的授权类型，但我不喜欢依赖这些类型，因为并非我们所有的客户（医院）都能做同样的事情。有些不能给我们静态IP，有些不能做VPN，所以我们不能仅仅依靠这些方法。

*您正在使用或建议使用哪些技术来授权与您的 Web 服务的通信？* 我们主要关心的是阻止人们获得医院 ID（目前只是一个 GUID）并从我们的 Web 服务中获取数据，这些数据是为医院准备的。

我们将采用其他网络级别的安全措施来限制公众对我们系统的访问，但我认为软件解决方案也是必要的。

该系统尚未投入生产，但已接近开发完成。它在 .net 3.5 上用 C# 开发

FWIW 我正在考虑某种基于令牌的授权，因为我知道以前的雇主使用过类似的东西。但是，我不知道具体要查找什么或有关该主题的任何其他信息。

**编辑：**虽然我想使用 WCF，但目前团队中没有人（包括我自己）有任何使用它的经验，我们已经开发了 Web 服务以及与之交互的代码。所有使用 .net 2.0 方法添加的 Web 引用（来自 vs.net08，针对 .net 3.5），我们不希望完全重做。我不会说 WCF 不是一个选项，但我认为我们不会心甘情愿地选择该选项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T18:01:15.050

客户端证书可用于从调用者向您的 Web 服务提供凭据；获取通过的证书并进行任何额外的评估以确定该证书的可见性并不难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T18:06:25.710

您可能想要使用 OAuth 之类的东西：

[http://oauth.net/](http://oauth.net/)

然后，您可以将它与 WCF 一起使用以提供端点。

从那里，您希望将声明映射到客户的内部 id（您必须确定此映射是什么）。

这样，您不必依赖向任何人发布任何内容，您所要做的就是根据发送给您的声明创建映射。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T18:23:30.520

您可以使用类似 https 的基本身份验证来提供用户名密码挑战吗？我相信 Microsoft SOAP 对它的支持相当好。您几乎只需使用 IIS 来配置基本身份验证（必须使用 SSL），并在您的 C# 中将 ICredentials 传递给您的代理。

从谷歌搜索来看，其他语言似乎也支持基于 SOAP 的基本身份验证。

# c++ - 空向量的开销成本是多少？

> ID：557997
> 
> 赞同：33
> 
> 时间：2009-02-17T17:59:44.633
> 
> 标签：c++, memory, stl, vector, overhead

拥有一个空向量与拥有一个指向向量的指针的内存开销是多少？

选项 A：

```
std::vector<int> v; 
```

选项 B：

```
std::vector<int> *v = NULL; 
```

我相信选项 B 需要 1 个 32 位指针（假设这里是 32 位）空的“v”占用多少内存？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-17T18:09:55.653

至于所问的问题：这取决于实施。使用 MSVC 7.1：

```
std:: cout << sizeof(std::vector<int>) << std::endl; 
```

给我 16（字节）。（3个指针：容量的开始、结束和结束，加上一个分配器）

**但是**应该注意的是，指向向量的指针给它带来了更大的开销：

*   在非空情况下的时间和空间
*   在所有情况下的复杂性。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-17T18:07:23.850

它完全依赖于实现，您既不应该假设也不依赖于细节。值得的是使用 VC 的 20 字节。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T18:03:49.147

`std::vector v;`占用`sizeof(v)`空间。它可能因实现而异，所以运行它并找出它需要多少。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T18:25:57.270

VS2005：

```
std::vector<int> *ptrToVec = new std::vector<int>();
std::vector<int> vecOfInt;

sizeof(ptrToVec) = 4
sizeof(vecOfInt) = 20 
```

谢谢！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-07-08T00:06:13.440

在 Visual Studio Community 2017（版本 15.2）中，运行以下代码：

```
#include <iostream>
#include <vector>

using namespace std;

void main()
{
    vector<float> test;
    vector<float>* test2 = &test;
    cout << sizeof(test) << "\n";
    cout << sizeof(test2) << "\n";

    cout << "\n";
    system("pause");
} 
```

以 32 位 (x86) 运行，我得到 16 个字节的向量和 4 个字节的向量指针。

以 64 位 (x64) 运行，我得到 32 个字节的向量和 8 个字节的向量指针。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-17T18:03:27.497

依赖于实现，可能是一个指针和两个整数，用于当前大小和容量。*****~~************