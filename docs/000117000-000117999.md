# StackOverflow 问答 000117000-000117999

# git - 防止人们使用不同的作者姓名推送 git 提交？

> ID：117006
> 
> 赞同：26
> 
> 时间：2008-09-22T19:35:43.770
> 
> 标签：git

在 git 中，每个用户都可以在其本地 git 配置文件中指定正确的作者。当他们推送到一个集中的裸存储库时，存储库上的提交消息将具有他们在提交到自己的存储库时使用的作者姓名。

有没有办法强制使用一组已知的提交作者？“中央”存储库将可通过 ssh 访问。

我知道这很复杂，因为有些人可能会推送其他人所做的提交。当然，您也应该只允许您信任的人推送到您的存储库，但如果有一种方法可以防止用户出错，那就太好了。

git中有这个问题的简单解决方案吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-13T09:43:16.677

使用 PRE-RECEIVE 钩子（详见[githooks(5)](http://git-scm.com/docs/githooks "githooks(5)")）。在那里，您会为每个更新的 ref 获得旧 sha 和新 sha。并且可以轻松列出更改并检查它们是否具有正确的作者（git rev-list --pretty=format:"%an %ae%n" oldsha..newsha）。

这是一个示例脚本：

```
#!/bin/bash
#
# This pre-receive hooks checks that all new commit objects
# have authors and emails with matching entries in the files
# valid-emails.txt and valid-names.txt respectively.
#
# The valid-{emails,names}.txt files should contain one pattern per
# line, e.g:
#
# ^.*@0x63.nu$
# ^allowed@example.com$
#
# To just ensure names are just letters the following pattern
# could be used in valid-names.txt:
# ^[a-zA-Z ]*$
#

NOREV=0000000000000000000000000000000000000000

while read oldsha newsha refname ; do
    # deleting is always safe
    if [[ $newsha == $NOREV ]]; then
    continue
    fi

    # make log argument be "..$newsha" when creating new branch
    if [[ $oldsha == $NOREV ]]; then
    revs=$newsha
    else
    revs=$oldsha..$newsha
    fi
    echo $revs
    git log --pretty=format:"%h %ae %an%n" $revs | while read sha email name; do
    if [[ ! $sha ]]; then
        continue
    fi
        grep -q -f valid-emails.txt <<<"$email" || {
            echo "Email address '$email' in commit $sha not registred when updating $refname"
            exit 1
        }
        grep -q -f valid-names.txt <<<"$name" || {
            echo "Name '$name' in commit $sha not registred when updating $refname"
            exit 1
        }
    done
done 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-13T11:03:45.127

我们使用以下内容来防止意外的未知作者提交（例如，在从客户的服务器或其他地方进行快速提交时）。它应该放在 .git/hooks/pre-receive 并使其可执行。

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-
import subprocess
from itertools import islice, izip
import sys

old, new, branch = sys.stdin.read().split()

authors = {
    "John Doe": "john.doe@example.com"
}

proc = subprocess.Popen(["git", "rev-list", "--pretty=format:%an%n%ae%n", "%s..%s" % (old, new)], stdout=subprocess.PIPE)
data = [line.strip() for line in proc.stdout.readlines() if line.strip()]

def print_error(commit, author, email, message):
    print "*" * 80
    print "ERROR: Unknown Author!"
    print "-" * 80
    proc = subprocess.Popen(["git", "rev-list", "--max-count=1", "--pretty=short", commit], stdout=subprocess.PIPE)
    print proc.stdout.read().strip()
    print "*" * 80
    raise SystemExit(1)

for commit, author, email in izip(islice(data, 0, None, 3), islice(data, 1, None, 3), islice(data, 2, None, 3)):
    _, commit_hash = commit.split()
    if not author in authors:
        print_error(commit_hash, author, email, "Unknown Author")
    elif authors[author] != email:
        print_error(commit_hash, author, email, "Unknown Email") 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-04-22T19:31:08.597

我们使用 Gitlab，因此我们可以根据 Gitlab 组成员验证作者。

应该作为预接收挂钩安装的以下脚本（基于@dsvensson 的回答）正是这样做的：

```
from __future__ import print_function
from __future__ import unicode_literals

import sys
import os
import subprocess
import urllib2
import json
import contextlib
import codecs
from itertools import islice, izip

GITLAB_SERVER = 'https://localhost'
GITLAB_TOKEN = 'SECRET'
GITLAB_GROUP = 4
EMAIL_DOMAIN = 'example.com'

def main():
    commits = get_commits_from_push()
    authors = get_gitlab_group_members()
    for commit, author, email in commits:
        if author not in authors:
            die('Unknown author', author, commit, authors)
        if email != authors[author]:
            die('Unknown email', email, commit, authors)

def get_commits_from_push():
    old, new, branch = sys.stdin.read().split()
    rev_format = '--pretty=format:%an%n%ae'
    command = ['git', 'rev-list', rev_format, '{0}..{1}'.format(old, new)]
    # branch delete, let it through
    if new == '0000000000000000000000000000000000000000':
        sys.exit(0)
    # new branch
    if old == '0000000000000000000000000000000000000000':
        command = ['git', 'rev-list', rev_format, new, '--not', '--branches=*']
    output = subprocess.check_output(command)
    commits = [line.strip() for line in unicode(output, 'utf-8').split('\n') if line.strip()]
    return izip(islice(commits, 0, None, 3),
            islice(commits, 1, None, 3),
            islice(commits, 2, None, 3))

def get_gitlab_group_members():
    url = '{0}/api/v3/groups/{1}/members'.format(GITLAB_SERVER, GITLAB_GROUP)
    headers = {'PRIVATE-TOKEN': GITLAB_TOKEN}
    request = urllib2.Request(url, None, headers)
    with contextlib.closing(urllib2.urlopen(request)) as response:
        members = json.load(response)
    return dict((member['name'], '{}@{}'.format(member['username'], EMAIL_DOMAIN))
        for member in members)

def die(reason, invalid_value, commit, authors):
    message = []
    message.append('*' * 80)
    message.append("ERROR: {0} '{1}' in {2}"
            .format(reason, invalid_value, commit))
    message.append('-' * 80)
    message.append('Allowed authors and emails:')
    print('\n'.join(message), file=sys.stderr)
    for name, email in authors.items():
        print(u"  '{0} <{1}>'".format(name, email), file=sys.stderr)
    sys.exit(1)

def set_locale(stream):
    return codecs.getwriter('utf-8')(stream)

if __name__ == '__main__':
    # avoid Unicode errors in output
    sys.stdout = set_locale(sys.stdout)
    sys.stderr = set_locale(sys.stderr)

    # you may want to skip HTTPS certificate validation:
    #  import ssl
    #  if hasattr(ssl, '_create_unverified_context'):
    #    ssl._create_default_https_context = ssl._create_unverified_context

    main() 
```

有关安装说明，请参阅[GitLab 自定义 Git 挂钩文档](http://doc.gitlab.com/ce/hooks/custom_hooks.html)。

只有`get_gitlab_group_members()`Gitlab 特定，其他逻辑适用于任何预接收挂钩（包括处理分支删除和创建）。

该脚本现已[在 GitHub 中可用](https://github.com/mrts/validate-git-commit-authors-against-gitlab)，如有任何错误/改进，请随时发送拉取请求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T19:38:23.187

您可以做的是创建一堆不同的用户帐户，将它们全部放在同一个组中，并授予该组对存储库的写入权限。然后，您应该能够编写一个简单的传入挂钩来检查执行脚本的用户是否与变更集中的用户相同。

我从来没有这样做过，因为我相信那些将代码检查到我的存储库中的人，但如果有办法，那可能就是上面解释的那个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T19:39:46.520

git 最初的设计不是像 svn 那样使用大型中央存储库。也许您可以根据需要从人们那里拉取，如果他们的作者设置不准确，则拒绝拉取？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T20:10:42.907

如果你想管理面向互联网的 git repo 的权利，我建议你看看[Gitosis](http://scie.nti.st/2007/11/14/hosting-git-repositories-the-easy-and-secure-way)而不是自己动手。身份由私钥/公钥对提供。

读我[在这里拉皮条](https://stackoverflow.com/questions/109440/best-git-repository-hosting-for-commercial-project#110007)。

# c# - 如何最好地从方法中测试 XML 的有效性？

> ID：117007
> 
> 赞同：5
> 
> 时间：2008-09-22T19:35:44.410
> 
> 标签：c#, .net, xml, unit-testing, xsd

我有一些 WCF 方法用于将信息从服务器应用程序传输到网站前端以用于绑定。我将结果作为 XElement 发送，它是包含我要绑定的数据的 XML 树的根。

我想创建一些测试来检查数据并确保它按预期进行。

我目前的想法是：每个返回 XElement 树的方法都有一个对应的模式 (.XSD) 文件。此文件包含在包含我的 WCF 类作为嵌入资源的程序集中。

测试在这些方法上调用方法，并将结果与​​这些嵌入式模式进行比较。

这是一个好主意吗？如果不是，我可以使用哪些其他方式来提供方法将返回哪种 XML 的“保证”？

如果是，您如何根据模式验证 XElement？以及如何从它嵌入的程序集中获取该架构？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-22T20:02:58.807

我说用 xsd 模式验证 xml 是个好主意。

如何使用加载的模式验证 XElement：正如您在此示例中看到的，您需要首先验证 XDocument 以填充“后模式验证信息集”（可能有一个解决方案可以在不使用 Validate 方法的情况下执行此操作XDOcument，但我还没有找到）：

```
String xsd =
@"<xsd:schema xmlns:xsd='http://www.w3.org/2001/XMLSchema'>
   <xsd:element name='root'>
    <xsd:complexType>
     <xsd:sequence>
      <xsd:element name='child1' minOccurs='1' maxOccurs='1'>
       <xsd:complexType>
        <xsd:sequence>
         <xsd:element name='grandchild1' minOccurs='1' maxOccurs='1'/>
         <xsd:element name='grandchild2' minOccurs='1' maxOccurs='2'/>
        </xsd:sequence>
       </xsd:complexType>
      </xsd:element>
     </xsd:sequence>
    </xsd:complexType>
   </xsd:element>
  </xsd:schema>";
String xml = @"<?xml version='1.0'?>
<root>
    <child1>
        <grandchild1>alpha</grandchild1>
        <grandchild2>beta</grandchild2>
    </child1>
</root>";
XmlSchemaSet schemas = new XmlSchemaSet();
schemas.Add("", XmlReader.Create(new StringReader(xsd)));
XDocument doc = XDocument.Load(XmlReader.Create(new StringReader(xml)));
Boolean errors = false;
doc.Validate(schemas, (sender, e) =>
{
    Console.WriteLine(e.Message);
    errors = true;
}, true);
errors = false;
XElement child = doc.Element("root").Element("child1");
child.Validate(child.GetSchemaInfo().SchemaElement, schemas, (sender, e) =>
{
    Console.WriteLine(e.Message);
    errors = true;
}); 
```

如何从程序集中读取嵌入架构并将其添加到 XmlSchemaSet：

```
Assembly assembly = Assembly.GetExecutingAssembly();
// you can use reflector to get the full namespace of your embedded resource here
Stream stream = assembly.GetManifestResourceStream("AssemblyRootNamespace.Resources.XMLSchema.xsd");
XmlSchemaSet schemas = new XmlSchemaSet();
schemas.Add(null, XmlReader.Create(stream)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T11:50:46.577

如果您正在做一些轻量级的工作并且 XSD 是多余的，那么还可以考虑对 XML 数据进行强类型化。例如，我在一个项目中有许多从 XElement 派生的类。一个是 ExceptionXElement，另一个是 HttpHeaderXElement 等。在它们中，我从 XElement 继承并添加 Parse 和 TryParse 方法，这些方法采用包含 XML 数据的字符串来创建实例。如果 TryParse() 返回 false，则字符串不符合我期望的 XML 数据（根元素的名称错误、缺少子元素等）。

例如：

```
public class MyXElement : XElement 
{

    public MyXElement(XElement element)
        : base(element)
    { }

    public static bool TryParse(string xml, out MyXElement myElement)
    {
        XElement xmlAsXElement;

        try
        {
            xmlAsXElement = XElement.Parse(xml);
        }
        catch (XmlException)
        {
            myElement = null;
            return false;
        }

        // Use LINQ to check if xmlAsElement has correct nodes...
    } 
```

# python - How to Retrieve name of current Windows User (AD or local) using Python?

> ID：117014
> 
> 赞同：17
> 
> 时间：2008-09-22T19:36:32.847
> 
> 标签：python, active-directory

How can I retrieve the name of the currently logged in user, using a python script? The function should work regardless of whether it is a domain/ad user or a local user.

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-22T19:42:41.070

尝试这个：

```
import os;
print os.environ.get( "USERNAME" ) 
```

那应该做的工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-07-09T09:25:26.687

as in [https://stackoverflow.com/a/842096/611007](https://stackoverflow.com/a/842096/611007) by [Konstantin Tenzin](https://stackoverflow.com/users/102243/konstantin-tenzin)

> Look at [getpass](http://docs.python.org/library/getpass.html) module
> 
> ```
> import getpass
> getpass.getuser() 
> ```
> 
> Availability: Unix, Windows
> 
> Note "*this function looks at the values of various environment variables to determine the user name. Therefore, this function should not be relied on for access control purposes (or possibly any other purpose, since it allows any user to impersonate any other).*"

at least, definitely preferable over `getenv`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-02T21:31:16.900

```
win32api.GetUserName()

win32api.GetUserNameEx(...) 
```

见： [http ://timgolden.me.uk/python/win32_how_do_i/get-the-owner-of-a-file.html](http://timgolden.me.uk/python/win32_how_do_i/get-the-owner-of-a-file.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T19:48:00.590

我不知道 Python，但对于 Windows，底层 api 是[GetUserNameEx](http://msdn.microsoft.com/en-us/library/ms724435(VS.85).aspx)，如果 os.environ.get( "USERNAME" ) 没有告诉你你需要知道的一切，我假设你可以在 Python 中调用它。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-05-30T21:29:28.983

很老的问题，但要刷新原始问题的答案“如何使用 python 脚本检索当前登录用户的名称？” 利用：

```
import os
print (os.getlogin()) 
```

根据 Python 文档： getlogin - 返回在进程的控制终端上登录的用户的名称。

# firefox - 当我单击链接的 .vsd 文件时，如何让 Firefox 启动 Visio？

> ID：117041
> 
> 赞同：1
> 
> 时间：2008-09-22T19:40:55.893
> 
> 标签：firefox, visio

在我们的 Intranet 站点上，我们链接了各种 MS Office 文档。当我单击 Word、Excel 或 PowerPoint 文件时，Firefox 会为我提供打开、保存或取消的选项。当我单击打开时，会启动相应的应用程序并加载文件。太棒了。但由于某种原因，当我单击链接的 Visio 文件时，我只能选择保存，这很不方便。

我知道 Firefox 知道链接文件是 Visio 文件，因为它在对话框中告诉我：“您已选择打开 example.vsd，它是：Microsoft Visio 绘图”。

当我单击链接的 Visio 文件时，如何让 Firefox 启动 Visio？

更新：当我单击链接的 Visio 文件时，Firefox 没有启动 Visio，因为 Web 服务器没有正确识别内容类型。它将 Visio 文件标识为 application/octet-stream 而不是 application/x-visio。（感谢格兰特瓦格纳。）这解释了为什么它不起作用。就我而言，我也许可以更改 Apache 配置文件，但这并不确定。

但是，我很想知道是否有一种方法可以配置 Firefox 本身以根据其他一些标准（如文件扩展名）启动 Visio。这样，即使我无权访问 Apache 配置，我也可以打开 Visio 文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T20:44:40.483

@院长

> 对话框中只有两个按钮：“保存文件”和“取消”。“打开方式”选项根本不存在。
> 
> 但我想我知道你的意思。有时，“打开方式”选项显示为灰色，稍后才可用。不幸的是，这里不是这样。

如果*Open With*不可用，最可能的原因是 Firefox 不知道文档的 MIME 类型并假设它`application/octet-stream`是`application/octet-stream`MIME 类型）。

要确认这一点，请下载[LiveHTTPHeaders](http://livehttpheaders.mozdev.org/)并使用它来确认文件的 MIME 类型是`application/x-visio`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-05T18:49:20.773

添加了解决问题的扩展“OpenDownload”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-18T23:44:58.800

编辑文件 %appdata%\Mozilla\Firefox\Profiles\your profile\mimeTypes.rdf

添加以下内容

```
<RDF:li RDF:resource="urn:mimetype:application/vnd.visio"/>

<RDF:Description RDF:about="urn:mimetype:externalApplication:application/vnd.visio"
    NC:prettyName="VISIO.EXE"
    NC:path="FULL PATH TO YOUR VISIO\VISIO.EXE" />

<RDF:Description RDF:about="urn:mimetype:application/vnd.visio"
    NC:value="application/vnd.visio"
    NC:editable="true"
    NC:fileExtensions="vsd"
    NC:description="Microsoft Visio Drawing">
<NC:handlerProp RDF:resource="urn:mimetype:handler:application/vnd.visio"/>
</RDF:Description>
<RDF:Description RDF:about="urn:mimetype:handler:application/vnd.visio"
               NC:alwaysAsk="false">
<NC:externalApplication RDF:resource="urn:mimetype:externalApplication:application/vnd.visio"/>
<NC:possibleApplication RDF:resource="urn:handler:local:FULL PATH TO YOUR VISIO\VISIO.EXE"/>
</RDF:Description> 
```

这适用于我在 Windows XP SP2 下的 Firefox 3.6.3 下

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T19:44:00.600

在工具，选项中进行。实际上它在那里被称为“内容类型”和“动作”......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T19:45:13.047

如果行为类似于打开应用程序，您只需单击打开/保存对话框，打开按钮将在大约一秒钟后变为可用。这有帮助吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T19:56:48.853

进入工具 | 选项... 似乎不起作用，因为这样做之后，您会收到一个错误，即打开文件时发生未知错误。

但是，如果您安装[OpenDownload](https://addons.mozilla.org/en-US/firefox/addon/207)扩展，那么您将获得一个成功运行 Visio 的运行按钮。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T14:42:50.303

问题在于 VSD 文件类型。

打开 Windows 资源管理器

菜单/工具/文件夹选项

单击文件类型选项卡

找到 VSD 文件类型（只需输入 vsd > 它会带你到那里）

有两个按钮：[Modify] 和 [Special] -- 点击 [Special] 按钮 --- 与文件关联的 Actions 被列出

您必须添加打开选项：
将路径添加到 Visio，如下所示：“C:\Program Files[## correct PATH##]\VISIO.EXE”/e
（只需检查其他文件类型的设置方式，例如：DOC或 XLS）

还有一个选项：**在同一窗口中浏览。**

取消选中**在同一窗口中浏览。**复选框，单击[确定]

你去吧！浏览器应询问您是否要打开或下载文件。和一个您标记您的选项并从“始终要求此文件类型...”中删除复选框您的 VSD 文档应直接在 Visio 中打开。

希望这会有所帮助，BR，Zoltan Gajdatsy

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-12-10T18:17:40.340

一步步：

1.  在 Firefox 上，转到包含该文件的站点，右键单击 vsd 或 vsdx 文件并选择下载。
2.  在下载窗口中，标记记住我的选择选项。
3.  在*tools* > *options* > *application*下，搜索 visio type 并将 dropbox 更改为“open with”，然后本地化您希望使用的应用程序。

我在 Firefox 33.0.2 访问 Sharepoint 中的文件时对此进行了测试。

# java - Java 程序监控系统运行状况的最佳方式是什么？

> ID：117043
> 
> 赞同：9
> 
> 时间：2008-09-22T19:40:58.827
> 
> 标签：java, system-monitoring

我希望能够从基于 Java 的系统内部监控我的主要系统健康指标。主要关注点包括CPU温度、主板温度、风扇转速等。

是否有可用的软件包：

1.  使这种数据对 Java 可用？
2.  适用于 Windows 或 Linux 或两者兼而有之？
3.  开放/免费/便宜？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T20:05:28.457

您会发现最接近的是 Hyperic Sigar 库：

[http://www.hyperic.com/products/sigar.html](http://www.hyperic.com/products/sigar.html)

AFAIK 并没有降低温度，但确实向您展示了许多本机统计数据，例如 CPU、内存、磁盘 I/O、网络 I/O 等。它已移植到人们今天部署 Java 的大多数架构中。许可证是 GPL，尽管我认为您也可以购买商业许可证。

我们使用 Sigar 和 Terracotta 进行集群监控，并且对它非常满意。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T20:30:12.920

我相信大多数此类事情通常通过 SNMP（用于专业系统）完成，这是以基于标准的方式提供此类信息的常用方法。JMX 也可通过 SNMP 获得。那么问题就变成了，哪些是更好的 Java SNMP 库（您的系统是否支持它）？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T20:51:27.223

Windows 和 Linux 都支持 MIB，它们通过 SNMP 公开您正在寻找的参数。此外，大多数主要供应商都为其服务器硬件发布了特殊的 MIB。

我已经使用商业[iReasoning SNMP API](http://www.ireasoning.com/snmpapi.shtml)实现了 SNMP MIB 和对 Java 应用程序的监控，它们运行良好。还有开源的[SNMP4J](http://www.snmp4j.org/)，我个人没有经验，但看起来不错。

因此，根据您的需要，您可以为要监控的主机打开 SNMP 信息的发布。无需编码。这只是一个配置问题。

例如，对于 CPU 温度，您必须启用 MIB LM-SENSORS-MIB。在 Linux 下，您可以使用 snmpwalk 客户端查看 OID .1.3.6.1.4.1.2021.13.16.2.1.3 以查看 CPU 温度。一旦你完成了它并且你知道它正在正确地发布数据，你就可以开始实施你真正的监控解决方案。

您可以使用 Java SNMP 库来轮询和订阅您要监控的主机的 SNMP 陷阱。您还可以使用任何商业或开源监控工具（Google for *SNMP 控制台*）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T19:55:58.417

几个月前，我寻找这样的图书馆，但没有发现任何有趣的东西。创建一个并非不可能，因此我建议您这样做。您可能需要访问本机库，使用[JNA](https://github.com/twall/jna)（它比 JNI 更容易）来做到这一点。首先在一个平台上添加对一些东西的支持，然后开始添加对其他功能和平台的支持。

与我们分享吧！人们会开始使用它，甚至可能会帮助开发，很快你就会拥有一个功能齐全的 Java 系统监控库。

# linux - 许可和使用 Linux 内核

> ID：117055
> 
> 赞同：4
> 
> 时间：2008-09-22T19:43:25.250
> 
> 标签：linux, licensing, operating-system, kernel

我想编写自己的操作系统，暂时跳过编写内核的复杂任务，稍后再使用Linux内核回来。但是，我现在想将操作系统作为封闭源提供。Linux 内核在什么许可证下，是否可以将其用于闭源操作系统的发布？

编辑：我对关闭 Linux 内核的源代码不感兴趣，我仍然会将其作为开源提供。我想知道我是否可以使用带有开源内核的闭源操作系统。

进一步编辑：操作系统是指在内核之上运行并用于启动其他程序的系统。我当然不是有意将内核包含在封闭源代码声明中。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-22T21:27:33.440

你当然可以在你喜欢的 Linux 内核上编写任何闭源操作系统，只要你与你链接的组件的许可兼容。

当然，这可能包括 gnu C 库（或其他一些 C 库）。您可能还需要一些命令行实用程序，这些实用程序可能是 GPL 来执行文件系统维护、网络设置等操作。但如果您将它们保留为自己的独立程序，这应该不是问题。

您链接到内核本身的任何东西（例如自定义模块、补丁）都应该作为开源 GPL 发布以符合内核的许可。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T19:44:35.543

Linux 内核是在 GPLv2 下发布的，您可以将其用作闭源操作系统的一部分，但您必须保持内核和所有修改都发布 GPLv2。

编辑：顺便说一句，您可能想改用 OpenSolaris 之类的东西。在我看来，它更容易使用（显然非常主观），如果你愿意，你可以保持修改的封闭源，只要你遵守 CDDL 的条款。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T19:50:51.207

我认为您将不得不更具体地说明“操作系统”的含义。这绝不是一个明确的概念。有人会说内核就是整个操作系统。其他人会说外壳和核心实用程序（例如“ls”）是操作系统的一部分。其他人甚至会说记事本等标准应用程序是操作系统的一部分。

IANAL，但我认为没有什么可以阻止您将 Linux 内核与您自己的大量闭源程序捆绑在一起。但是请注意不要使用任何 GPL 库代码（LGPL 是可以的）。

我确实质疑你的动机。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T19:44:41.017

它是 GPL 版本 2，您肯定**不会**关闭它的源代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T19:55:32.757

您必须保持源代码开放，以及从代码派生的任何作品，但是，如果您使用内核，则在其之上编写自己的应用程序堆栈（几乎所有 GNU 的东西），那么您不必打开它.

GPL 说“派生”是有效的……所以如果你正在编写新代码，而不是展开，那很好。事实上，例如，您甚至可以使用 GNU 工具链、Linux 内核，然后在其之上拥有自己的系统（或只是一个封闭源代码的 DE）。

当您修改/派生某些东西时，您必须保持打开状态！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T19:46:44.600

Linux 使用 GPL (v2) 作为其许可证，这意味着您必须开源任何衍生作品。

您可能想使用 BSD，它的许可证对您可以对衍生作品进行的操作限制较少

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T00:05:36.570

如果您使用的文件系统要链接到内核本身，**并且**您打算将其分发给其他人，那么 GPL 非常明确地要求文件系统也必须是 GPL 的。

话虽这么说：合法地将 Linux 与 GPL 不兼容的文件系统接口的一种方法是通过[FUSE](http://en.wikipedia.org/wiki/FUSE_(Linux))（用户空间中的文件系统）。例如，这已用于在 Linux 上运行与 GPL 不兼容的[ZFS文件系统。](http://en.wikipedia.org/wiki/Zfs)但是，在用户空间中运行文件系统确实会带来很大的性能损失。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T19:44:55.417

它是 GPL。简短的回答——不。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T19:51:43.093

您始终可以保留您编写的任何扩展（模块）和/或应用程序的封闭源代码，但内核本身需要保持开源。

您可以在测试系统时利用 GPLv2 的一个不太明显的方面：您只需将源代码发布给有权访问系统的人。GPLv2 声明您需要向任何有权访问程序的二进制/编译分发的人授予对源代码的完全访问权限。因此，如果您只打算在支付开发费用的公司内部使用该软件，则无需将源代码分发给世界其他地方，而只需分发给他们即可。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T19:57:23.577

一般来说，我会说你可以做这样的事情，只要你提供内核的源代码，但有一点我不确定：

在（GPL）内核和非 GPL 兼容应用程序之间的普通 Linux 系统上，始终存在 GNU libc，它是 LGPL，因此允许派生的作品是非自由的。现在，如果你有一个非自由的 libc，那可能被认为是一个派生的工作，因为你直接调用内核，并且还使用内核头文件。

正如许多其他人之前所说，使用 *BSD 可能会更好。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T09:10:46.493

如果您认真开发一个新的操作系统并希望从一个工作内核开始，我建议您研究一下 FreeBSD 内核。它的许可证比 Linux 宽松得多，我认为您可能会觉得它值得。

只是我的2美分...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-04T20:20:31.163

我同意 MarkR，但没有人向你说明这一点。如果你是认真的，你需要咨询在这方面有专业知识的律师。

# asp.net - 单独程序集中的 ASP.NET 母版页

> ID：117059
> 
> 赞同：2
> 
> 时间：2008-09-22T19:44:04.733
> 
> 标签：asp.net, master-pages

我在一个程序集中有一些 ASP.NET 母版页。我需要将这些母版页与我的 WebForm 页面一起使用，这些页面位于引用第一个程序集的其他程序集中。我似乎无法找到一种方法来做到这一点。

有什么好方法可以做到这一点吗？

如果不存在漂亮的解决方案，我还想听听可能的黑客攻击？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T19:48:14.317

母版页基于用户控件，因此不能跨应用程序共享。

也就是说，Dan Wahlin 有办法绕过[他博客上列出的](http://weblogs.asp.net/dwahlin/archive/2005/11/16/430779.aspx)特定限制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T19:48:50.650

[Dan Wahlin跨 IIS 应用程序共享母版页](http://weblogs.asp.net/dwahlin/archive/2005/11/16/430779.aspx)会给您一些想法。

另外，请查看 Scott Allen 的这篇[优秀文章](http://odetocode.com/Articles/450.aspx)。您可以在共享母版页的末尾查看最后一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T19:49:32.987

这个问题没有很好的解决方案。

你可以做的是把它放到一个单独的 web 应用程序项目中并预编译它。然后将预编译的 dll 和 ILMerge 合并到一个可以在应用程序中引用的 dll 中。

您引用的实际母版页将具有如下类名：MyMasterPage_aweknk，因此请在反射器中查找。看起来像“MyMasterPage”的类实际上只是代码隐藏。

这真的很恶心，但这是我们在多个应用程序中重用用户控件的做法。

# user-interface - 错误消息文本 - 最佳实践

> ID：117083
> 
> 赞同：12
> 
> 时间：2008-09-22T19:46:40.110
> 
> 标签：user-interface, error-handling, usability

我们正在更改一些旧的、写得不好的错误消息的文本。有哪些资源可用于编写好的错误消息（特别是 Windows XP/Vista）的最佳实践。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T20:17:00.317

关于错误消息的措辞，我建议参考以下 Windows 应用程序的样式指南：

*   [Windows 用户体验指南](http://msdn.microsoft.com/en-us/library/aa511258.aspx)，特别是[此处](http://msdn.microsoft.com/en-us/library/windows/desktop/dn742469.aspx)的错误消息部分。
*   [微软风格手册](https://rads.stackoverflow.com/amzn/click/com/0735648719)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T19:50:54.717

最终的最佳实践是首先防止用户造成错误。

不要告诉用户他们不关心的任何事情；错误代码 5064 对任何人都没有任何意义。不要告诉他们他们做错了什么；首先不允许它。不要责怪他们，尤其是你的软件所犯的错误。最重要的是，当出现问题时，*告诉他们如何解决它，*以便他们继续前进并完成一些工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T19:58:47.803

一个好的错误信息应该：

*   不引人注目（没有蓝屏或黄屏死机）
*   为用户提供纠正问题的指导（如果可能，请自行解决，或联系谁寻求帮助）
*   隐藏无用的、深奥的程序员废话（不要说“第 45 行发生空引用异常”）
*   描述性强而不冗长。只是足够的信息告诉用户他们需要知道什么，仅此而已。

我开始做的一件事是生成一个唯一编号，我会在错误消息中显示该编号并将其写入日志文件，这样当用户向我发送屏幕截图或致电并说“我出错了。它说我的参考号是 0988-7634"

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T20:03:38.150

出于安全原因，请勿提供用户不需要的内部系统信息。
小例子：登录失败时，不要告诉用户用户名错误或密码错误；这只会帮助攻击者暴力破解系统。相反，只需说“用户名/密码组合无效”或类似的话。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T19:49:40.147

始终包括纠正错误的建议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T19:53:02.840

尝试找出一种方法来编写您的软件，以便为他们解决问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T19:54:37.360

对于任何用户输入（字符串、文件名、值等），始终显示错误值并在其周围加上分隔符（引号、括号等）。例如

找不到您输入的文件名：“somefile.txt”

这有助于显示可能潜入的任何空格/回车符，并大大减少故障排除和挫败感。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T19:59:53.790

1.  避免来自不同地方的相同错误消息；如果可能，使用 file:line 进行参数化，或者使用其他上下文，让您（开发人员）唯一地识别错误发生的位置。
2.  设计允许轻松本地化的机制，尤其是在它是商业产品的情况下。
3.  如果错误消息是用户可见的，则使它们完整、有意义的句子不假定对代码有深入的了解；记住，你总是离问题太近了——用户不是。如果可能，请为用户提供有关如何进行、与谁联系等方面的指导。
4.  如果可能，每个错误都应该有消息；如果没有，那么请尝试确保所有错误展开路径最终都会到达一条错误消息，以阐明所发生的事情。

    我相信这里会有其他好的答案......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-22T20:00:18.237

实际上可以阅读较短的消息。

您的错误消息越长，用户阅读的内容就越少。话虽如此，请尝试重构代码，以便在有明显响应时消除异常。尽量只让基于超出您的用户或您的代码控制的事情发生的异常。

最好的异常消息是您永远不必显示的消息。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-22T20:00:36.020

错误*处理*总是比错误*报告*好，但是由于您正在修改错误消息而不一定是代码，这里有几个建议：

用户想要解决方案，而不是问题。帮助他们知道发生错误后该怎么做，即使消息很简单，例如“请关闭当前窗口并重试您的操作”。

我也是集中记录错误的忠实粉丝。确保日志是人和计算机都可以扫描的。用户并不总是让您知道他们遇到了什么问题，特别是如果他们可以“解决”，因此日志可以帮助您了解需要解决的问题。

如果您可以轻松控制错误对话框，那么拥有一个显示漂亮、可读消息的对话框，其中带有“详细信息”按钮以显示错误号、跟踪等，这对于实时解决问题也有很大帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T19:53:10.607

对多语言的支持适用于所有类型的消息，但在出现错误消息的情况下往往会被遗忘。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T19:53:22.260

我第二次不会告诉用户无用的深奥信息，例如数字错误代码。然而，我会跟进这一点，说一定要记录这些信息，以供更精通技术的人进行故障排除。

# msmq - 动态创建 MSMQ 侦听器的最佳方法是什么？

> ID：117094
> 
> 赞同：0
> 
> 时间：2008-09-22T19:48:21.463
> 
> 标签：msmq

我在应用程序启动时使用 Spring.NET 创建消息侦听器。我现在需要能够创建 0-n 个侦听器，其中一些侦听器可能正在侦听不同的队列。我需要能够在运行时创建/销毁它们。这样做的最佳方法是什么？我以前的弹簧配置是这样的：

```
<objects xmlns="http://www.springframework.net">

  <object id='inputQueue' type='Spring.Messaging.Support.MessageQueueFactoryObject, Spring.Messaging'>
    <property name='Path' value='.\Private$\inputQueue'/>
  </object>

  <!-- MSMQ Transaction Manager -->
  <object id="messageQueueTransactionManager" type="Spring.Messaging.Core.MessageQueueTransactionManager, Spring.Messaging"/>

  <!-- Message Listener Container that uses MSMQ transactional for receives -->
  <object id="transactionalMessageListenerContainer" type="Spring.Messaging.Listener.TransactionalMessageListenerContainer, Spring.Messaging">
    <property name="MessageQueueObjectName" value="inputQueue"/>
    <property name="PlatformTransactionManager" ref="messageQueueTransactionManager"/>
    <property name="MaxConcurrentListeners" value="10"/>
    <property name="MessageListener" ref="messageListenerAdapter"/>
  </object>

  <!-- Adapter to call a PONO as a messaging callback -->
  <object id="messageListenerAdapter" type="Spring.Messaging.Listener.MessageListenerAdapter, Spring.Messaging">
    <property name="HandlerObject" ref="messageListener"/>
  </object>

  <!-- The PONO class that you write -->
  <object id="messageListener" type="Com.MyCompany.Listener, Com.MyCompany">
    <property name="Container" ref="transactionalMessageListenerContainer"/>
  </object>   

</objects> 
```

每次我需要一个新的侦听器时，我是否应该以编程方式执行此文件正在执行的操作？我不应该为此使用 Spring.NET 的消息传递框架吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T20:20:56.953

如果我如您所说的那样明智地使用 Spring.NET（即消息传递、ADO.NET 助手等），我会以编程方式进行。然后将新图表添加到我现有的容器中。这样，Spring.NET 仍然为我管理生命周期。

# .net - 在 .NET 应用程序中生成和打印发票的最佳方式是什么？

> ID：117101
> 
> 赞同：5
> 
> 时间：2008-09-22T19:49:36.497
> 
> 标签：.net, wpf, printing

我正在为一家公用事业公司开发计费系统，我们有以下要求：

*   每天批量生成和打印大约 1,500 张账单，然后我们邮寄给客户
*   以可以通过电子邮件发送给客户并存档的格式保存账单（可能是 PDF）
*   使用 .NET 和 MS SQL Server 数据库后端构建

我想要一些关于实现这一目标的最佳方法的建议。我正在考虑构建一个 WPF 应用程序，该应用程序将具有我们将帐单数据绑定到并从中打印的帐单模板。但是我以前没有使用过 WPF，所以我不确定这是否是最好的技术，而且我无法理解批处理和 PDF 转换是如何工作的。

有什么想法吗？WPF 会起作用，还是有更好的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T19:55:59.307

如果您使用的是 SQL Server 后端，那么 Reporting Services 应该适合您。

否则，我会推荐适合您报告需求的第三方报告生成器，并创建一个使用它来创建和导出报告的应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T20:46:56.453

即使使用 SQL Server，您也可能希望查看客户端报告功能。它确实更适合您想要的 IMO。您仍然可以从服务器查询和获取您需要的所有数据，但它允许您完全控制自动化过程。也许您想将它作为一项服务运行，每天报告由该服务生成，转换为 PDF 并复制到磁盘并自动通过电子邮件发送。客户端可以轻松地完成所有这些工作。并且无需依赖报告服务或 IIS，也无需配置任何内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T20:47:20.277

我强烈建议使用为导出为 PDF 提供本机支持的报告工具，如果您可以从单一格式和报告开始处理信息的打印和存档，则管理目的要容易得多。

如果您真的在进行批处理，我不会将 WPF 视为批处理作业所需的组件，您实际上并没有太多的 UI（如果有的话），这取决于您如何真正实现它。

如果我是你，我会专注于创建一个批处理器，它既可以作为 Windows 服务运行，也可以按特定时间间隔运行以完成其工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T20:50:01.720

您可以从 WPF 中获得良好的打印功能，因为新技术 Paper 格式**XPS**文档是 PDF 的替代品。它也有很好的编程支持。来自 pettzold [http://www.charlespetzold.com/blog/2006/02/201111.html](http://www.charlespetzold.com/blog/2006/02/201111.html)的关于 WPF 打印的博客。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T19:54:01.667

也许您应该尝试使用 ActiveReports.NET 或 DevExpress XtraReports 首先通过代码生成报告。两者都支持 PDF 导出，因此您可以生成 PDF 文件并通过邮件发送。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T19:58:54.043

看看这本书，（[http://www.apress.com/book/view/9781590598542](http://www.apress.com/book/view/9781590598542)）它提供了许多不同的场景，包括电子邮件报告、报告生成服务等。它关于客户端报告，但它同样适用于服务器端（无论如何设计端）。这在客户端（或专用服务器）可能有其优势，因为您可以完全控制自动化过程。但那是如果您想使用 .NET 报告。

是的，您可以使用 WPF。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:49:02.457

您还可以查看 itextSharp。它是一个.net pdf 编写工具，是Java itext 的一个端口。我用它做的有限的游戏使 pdf 写作变得简单而有趣。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:50:51.327

在我从事的一个项目中，我们使用[list & label](http://www.combit.net/reporting/report-generator-List-Label)。

基本上你有一个.NET API，你传递一个DataSet，然后你制作引用数据集中列的模板，至少可以打印（我想也导出到PDF，但没有检查......）

我自己没有使用它，所以不能对质量说太多。

# .net - 如何提高写入数据库的性能？

> ID：117108
> 
> 赞同：1
> 
> 时间：2008-09-22T19:50:18.977
> 
> 标签：.net, sql-server, database, performance

我们记录值并且我们只在表中记录一次。当我们向表中添加值时，我们必须每次都进行查找以查看它是否需要插入值或只获取 id。我们在表上有一个索引（不是在主键上），但大约有 350,000 行（因此执行 10 个这些值需要 10 秒）。

所以要么

*   我们想出了一种优化它的方法
*   去掉这个功能或者
*   在记录这些值时做一些完全不同的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T19:57:49.380

为了清楚起见，索引位于表中的（可能是 varchar 或 nvarchar）字段上，对吗？不是PK？

好的，在您编辑之后：您正在对大型 (n)varchar 文本字段进行索引查找。即使索引可能很慢——您仍在进行 2 个大字符串比较。我真的不是一个很好的方法来做到这一点，但是一些初始的 SWAGS：

*   计算要记录的文本的哈希值，并将其存储在数据库中以供后续查找
*   正如另一位海报所建议的那样，存储所有行，并在查询中过滤掉重复项（或每晚批处理，无论如何
*   不要检查重复项。捕获异常可能仍然比查找便宜*
*   雇用一个记忆力非常好的人，他的鼠标速度很快。当要记录一条消息时，将其闪烁到他们的屏幕上，并带有接受/拒绝提示。如果条目是骗子，请他们点击“拒绝”

* 是的，我知道我会因此而被贬低，但有时实用主义会奏效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T19:58:25.243

你写表的频率和读表的频率。如果您有频繁的写入和偶尔的读取，请考虑始终进行插入，然后在进行选择时处理折叠值。

如果您尝试将所有内容放在一个表中，请考虑将它们分成单独的表以减小大小，或禁止在表上使用分区。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T19:58:51.827

对 350k 行的表进行索引查找需要 1 秒？这对我来说听起来真的很慢。你确定没有其他问题吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T20:01:11.790

在没有看到您的实际查询的情况下，我只能概括。但是，我会提供以下想法/建议：

1) 您是否确认您的索引确实被用于查找查询？如果它是一个具有高基数的索引，它应该会快得多。

2）您可以将这两个操作组合成一个存储过程，该过程首先查找该行，然后在必要时进行插入......类似于：

```
如果存在（从 YourTable 中选择 ID，其中 ID = @ID_to_look_for）
      @ID_exists = 1
别的
      @ID_exists = 0

```

如果您发布确切的查询是什么样的，也许我可以提供更详细的答案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T20:12:00.483

与其进行查找，不如尝试插入该值。如果表被设计为拒绝重复记录，即它有一个主键或唯一索引，那么插入就会出错。只需捕获插入错误，如果收到，然后像往常一样获取 id。

我同意查找不应该花费那么长时间，但是为什么要让引擎解析查询，绘制路径，进行查找，然后在插入之前将结果发送给您，因为它可以同时执行这两项操作。

您还可以查看：

1.  索引更好，假设有改进的余地
2.  更改数据库的物理布局以改进 IO
3.  增加 SQL Server 的可用内存

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T21:11:10.407

首先，查看查询计划，看看它在做什么。这将告诉您它是否正在使用索引。单行测试/插入的一秒钟太慢了。对于 350k 行，这足以让它对缓存表进行表扫描。

第二。查看服务器的物理布局。你有类似日志和数据共享同一个磁盘的东西吗？

第三，检查唯一键上的索引列与选择查询上的谓词的顺序是否相同。顺序上的差异可能会使查询优化器感到困惑。

第四，考虑唯一键上的聚集索引。如果这是您查找行的主要模式，它将减少磁盘访问，因为表数据与聚集索引一起物理存储。有关聚集索引的简介，请参阅[此。](http://www.sql-server-performance.com/articles/per/index_data_structures_p1.aspx)用一个大的填充因子设置桌子。

除非您有 blob 列，否则 350k 行远低于分区应该有所作为的阈值。这个大小表应该完全适合缓存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:01:48.123

我不确定我是否有足够的信息来回答这个问题，但这里有一些想法：

1.  如果您还没有这样做，您可以在一个 SQL 中完成插入和验证（插入表（值）（选择左外连接到 id 为空的表）
2.  您是否使用 DAL 层或存储过程来执行此操作？您是否控制用于选择/插入的 SQL？如果您不这样做，您可能希望使用 SQL Profiler 检查发送到数据库的内容，以防它的格式使索引无效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:30:36.010

“当我们向表中添加值时，我们必须每次都进行查找以查看它是否需要插入值或只获取 id。”

我们过去将其称为“upsert”操作。

```
try:
    UPDATE log SET blah blah blah WHERE key = key;
except Missing Key:
    INSERT INTO log(...) VALUES(...); 
```

我们从来没有进行自己的查询来查看密钥是否存在，因为那是 UPDATE 语句的工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T21:12:07.610

您是否偶然使用光标？在这么小的桌子上做你说你正在做的事情不应该花十秒钟。

您需要基于集合的更新和插入语句。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T05:33:00.627

1.  排除连接和驱动程序问题 - 确保以相同方式对同一数据库执行的其他操作足够快

2.  确保您独立于可能在同一事务中运行的其他操作来衡量此操作

3.  确保您没有锁定场景 - 停止其他所有操作，只需从您的管理工具执行查找和更新序列。

4.  检查查找是否成本更高（99％）或磁盘写入成本高 - 尽管即使对于慢速磁盘来说 10 秒也太高了。为了完整起见，请执行此操作。

5.  检查查询是否正在使用您的索引 - 可能正在发生表扫描。

6.  如果用于索引的列是文本字段，则通过在具有索引的非文本列上发出查找来检查文本索引是否是问题的根源。如果是这样，请尝试更改逻辑以使用 PK 或使用哈希而不是文本。

# c++ - 我们什么时候对 C++ 中的分层命名空间有任何实际用途？

> ID：117110
> 
> 赞同：4
> 
> 时间：2008-09-22T19:50:34.263
> 
> 标签：c++, namespaces

我可以理解一级命名空间的用途。但是 3 级命名空间。看起来很疯狂。这有什么实际用途吗？或者这只是一个误解？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T19:55:17.107

分层命名空间确实有一个用途，因为它们允许逐步更精细的定义。当然，单个提供者可能会产生两个具有相同名称的类。通常第一级由公司名称占据，第二级指定产品，第三级（可能更多）我提供域。

命名空间隔离还有其他用途。一种流行的情况是将工厂模式的基类放在它自己的命名空间中，然后由提供者将派生工厂放在它们自己的命名空间中。例如`System.Data`，`System.Data.SqlClient`和`System.Data.OleDbClient`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T19:54:40.900

显然这是一个见仁见智的问题。但这真的归结为组织。例如，我有一个项目，它有一个插件 api，它的函数/对象看起来像这样：

```
plugins::v1::function 
```

当 2.0 推出时，它们将被放入 v2 子命名空间。我打算只弃用但永远不会删除将来应该很好地支持向后兼容性的 v1 成员。这只是“理智”用法的一个例子。我想有些人会有所不同，但就像我说的，这是见仁见智的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T19:54:40.433

大型代码库将需要它。以 boost 为例。我认为没有人会称提升代码为“疯狂”。

如果您考虑这样一个事实，即在层次结构的任何一个级别上，人们只能非常粗略地理解大约 10 个项目，那么两个级别最多只能给您 100 个。一个足够大的项目将需要更多，因此很容易最终达到 3 个级别。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T19:55:08.793

我在我的公司 yyy 从事 XXX 应用程序，我正在编写一个 GUI 子系统。所以我使用 yyy::xxx::gui 作为我的命名空间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T19:59:50.233

当您需要多个级别时，您可以轻松地发现自己处于一种情况。例如，您的公司为其所有代码都有一个巨大的命名空间，以将其与第三方代码分开，而您正在编写一个库，您希望将其放入自己的命名空间中。通常，只要您有一个非常庞大且复杂的系统，按层次划分，使用多个命名空间级别是合理的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T19:59:05.507

这取决于您的需求和编程风格。但好处之一`namespace`是有助于划分名称空间（因此得名）。使用单个命名空间时，随着项目规模和复杂性的增加，名称冲突的可能性也会增加。

如果您正在编写旨在共享或重用的代码，这将变得更加重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:02:01.460

我同意申请。大多数使用多级命名空间的人（根据我的经验）来自 Java 或 .NET 背景，其中噪音明显减少。我发现好的类前缀可以代替多层命名空间。

但是我已经看到在 boost（和其他库）中很好地使用了多个命名空间级别。一切都在 boost 命名空间中，但允许（鼓励？）库在它们自己的命名空间中。例如 - boost::this_thread 命名空间。它允许诸如...

```
boost::this_thread::get_id()
boost::this_thread::interruption_requested() 
```

“this_thread”只是一个自由函数集合的命名空间。您可以对类和静态函数（即定义自由函数的 Java 方式）做同样的事情，但是当语言有自然的方式时，为什么要做一些不自然的事情呢？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:02:40.990

只需查看 .Net 基类库，就可以看到名称空间层次结构得到了很好的利用。它在一些地方深入四到五层，但大多数只有两三层，而且组织非常适合寻找东西。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:03:30.770

代码库越大，对分层命名空间的需求就越大。随着您的项目变得越来越大，您发现您需要以更容易找到东西的方式对其进行分解。

例如，我们目前使用 2 级层次结构。然而，我们现在谈论的一些较大的部分将它们分成 3 个级别。

# python - python中导入类的范围是什么？

> ID：117127
> 
> 赞同：2
> 
> 时间：2008-09-22T19:52:44.960
> 
> 标签：python, import, scope, eval

请原谅模糊的标题。如果有人有建议，请告诉我！也请用更合适的标签重新标记！

**问题**

我想让一个导入类的实例能够查看导入器范围（全局、本地）内的东西。由于我不确定这里工作的确切机制，我可以用片段而不是文字来更好地描述它。

```
## File 1
def f1():  print "go f1!"

class C1(object):
    def do_eval(self,x):  # maybe this should be do_evil, given what happens
        print "evaling"
        eval(x)
        eval(x,globals(),locals()) 
```

然后从一个迭代会话中运行这段代码，会有很多`NameErrors`

```
## interactive
class C2(object):
    def do_eval(self,x):  # maybe this should be do_evil, given what happens
        print "evaling"
        eval(x)
        eval(x,globals(),locals())

def f2():
    print "go f2!"

from file1 import C1
import file1

C1().do_eval('file1.f1()')
C1().do_eval('f1()')
C1().do_eval('f2()')

file1.C1().do_eval('file1.f1()')
file1.C1().do_eval('f1()')
file1.C1().do_eval('f2()')

C2().do_eval('f2()')
C2().do_eval('file1.f1()')
C2().do_eval('f1()') 
```

这类任务是否有共同的习语/模式？我是不是完全找错树了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T20:32:17.863

在此示例中，您可以简单地将函数作为对象传递给以下方法`C1`：

```
>>> class C1(object):
>>>    def eval(self, x):
>>>        x()
>>>
>>> def f2(): print "go f2"
>>> c = C1()
>>> c.eval(f2)
go f2 
```

在 Python 中，您可以将函数和类传递给其他方法并在那里调用/创建它们。

如果你想实际评估一个代码字符串，你必须指定环境，正如 Thomas 已经提到的那样。

您的模块从上面略有改变：

```
## File 1
def f1():  print "go f1!"

class C1(object):
    def do_eval(self, x, e_globals = globals(), e_locals = locals()):
        eval(x, e_globals, e_locals) 
```

现在，在交互式解释器中：

```
>>> def f2():
>>>    print "go f2!"
>>> from file1 import *    # 1
>>> C1().do_eval("f2()")   # 2
NameError: name 'f2' is not defined

>>> C1().do_eval("f2()", globals(), locals()) #3
go f2!
>>> C1().do_eval("f1()", globals(), locals()) #4
go f1! 
```

## 一些注释

1.  在这里，我们将所有对象插入`file1`到该模块的命名空间中
2.  `f2`不在 的命名空间中`file1`，因此我们得到一个`NameError`
3.  现在我们显式传递环境，代码可以被评估
4.  `f1`在这个模块的命名空间中，因为我们导入了它

**编辑**：添加了关于如何显式传递环境的代码示例`eval`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T19:58:10.813

函数总是在它们定义的范围内执行，方法和类体也是如此。它们永远不会在另一个范围内执行。因为导入只是另一个赋值语句，而 Python 中的所有内容都是引用，所以函数、类和模块甚至不知道它们被导入到哪里。

您可以做两件事：明确传递您希望他们使用的“环境”，或者使用堆栈黑客来访问其调用者的命名空间。前者比后者更受欢迎，因为它不像后者那样依赖于实现和脆弱。

您可能希望查看 string.Template 类，它试图做类似的事情。

# .net - MS SSRS 报表生成器：语义查询执行失败。？

> ID：117128
> 
> 赞同：2
> 
> 时间：2008-09-22T19:52:51.000
> 
> 标签：.net, reporting-services, model

我创建了一个最终用户模型并进行了部署。我创建和运行的任何报告都会给我一个错误：

报告执行错误 报告可能无效或服务器无法处理数据。

## 语义查询执行失败。列名“rowguid”无效。

## 数据集“dataSet”的查询执行失败。

报告处理过程中发生错误。

大多数表都包含一个名为 rowguid 的主键。我无法从数据源视图中删除这些，但我确实进入并从模型中删除了它们。这没什么区别。

TIA丹尼尔

**更新**

数据源位于所有报告数据源的文件夹中。作为我的测试/调试的一部分，我在包含模型的文件夹中创建了一个数据源，并且错误消失了。我打算就此发起 MS 支持事件，并将在此处发布更新。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T21:39:40.413

尝试创建一个不包含该列的视图。完成后，重新创建基于此视图而不是原始表的数据源视图和模型，然后重试在报表生成器中创建报表

# security - 使用 NHibernate 时实现安全性的最佳实践是什么？

> ID：117129
> 
> 赞同：9
> 
> 时间：2008-09-22T19:52:52.467
> 
> 标签：security, nhibernate, orm, data-access

传统主义者认为，与使用 NHibernate 等对象关系映射 (ORM) 框架相比，存储过程提供了更好的安全性。

为了反驳这个论点，NHibernate 可以使用哪些方法来确保适当的安全性（例如，防止 sql 注入等）？

（*每个答案请只提供一种方法*）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T04:28:50.073

**保护您的连接字符串。**

从 .NET 2.0 和 NHibernate 1.2 开始，很容易在配置文件中使用加密的连接字符串（和其他应用程序设置）。将连接字符串存储在`<connectionStrings>`块中，然后使用 NHibernate`connection.connection_string_name`属性而不是`connection.connection_string`. 如果您运行的是网站而不是 Windows 应用程序，则可以使用`aspnet_regiis`命令行工具来加密`<connectionStrings>`块，同时将其余的 NHibernate 设置保留为纯文本以便于编辑。

如果您的数据库平台支持，另一种策略是为您的数据库连接使用集成身份验证。这样，您（希望）不会在配置文件中以明文形式存储凭据。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T00:38:39.877

实际上，如果您使用 SQL 或 HQL 构建查询，NHibernate 可能容易受到 SQL 注入的攻击。如果您需要这样做，请确保使用参数化查询，否则您将面临一个痛苦的世界。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T19:54:21.917

使用专用的锁定 SQL 帐户

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T13:17:52.977

我听到的支持 sprocs 而不是 ORM 的论点之一是，他们不希望人们在数据库中做*任何他们想做*的事情。他们不允许对表本身进行选择/插入/更新/删除。每个操作都通过一个由 DBA 审查的程序进行控制。我可以理解这种想法的来源......尤其是当你有一群业余爱好者都把手放在*你的*数据库中时。

但是时代变了，NHibernate 不一样了。这是令人难以置信的成熟。在大多数情况下，它会比您的 DBA 编写更好的 SQL :)。

你仍然必须保护自己不做愚蠢的事情。正如蜘蛛侠所说：“能力越大，责任越大”

我认为让 NHibernate 能够正确访问数据库并通过其他方式（例如审计日志记录和定期备份）控制操作更为合适。如果有人做了一些愚蠢的事情，你总是可以恢复的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T01:19:32.047

[http://weblogs.asp.net/fbouma/archive/2003/11/18/38178.aspx](http://weblogs.asp.net/fbouma/archive/2003/11/18/38178.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-15T09:39:08.343

大多数 ORM 通过创建参数化查询来处理 SQL 注入。在 NHibernate 中，如果您使用 LINQ to NHibernate 或 Criteria/Query over 编写查询的方法，则查询会自动参数化，如果您自己动态创建 HQL/SQL 查询，您会更容易使用，并且必须记住您的查询必须参数化。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-08T07:54:42.797

OWASP 在 ORM 工具的上下文中提到了一种形式的 SQL 注入漏洞（并以 HQL 注入为例）：[http ://www.owasp.org/index.php/Interpreter_Injection#ORM_Injection](http://www.owasp.org/index.php/Interpreter_Injection#ORM_Injection)

# svn - 避免使用 TortoiseSVN 删除文件

> ID：117131
> 
> 赞同：2
> 
> 时间：2008-09-22T19:53:06.317
> 
> 标签：svn, tortoisesvn

我正在使用 TortoiseSVN 为本地源代码存储库设置 Apache 服务器。我观察到，如果有人使用 TortoiseSVN 删除了一个文件，它将从每个人的视图中删除，并且唯一的日志将是他们的日志历史记录。我觉得任何用户都可以删除具有读/写权限的文件是很危险的（意外或故意，尽管文件保留在服务器上，但它是有风险的，并且可能会引起其他人的恐慌）。

有没有办法只有管理员才能添加或删除文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T19:58:18.973

添加和删​​除文件是源代码管理中的常见操作。你不应该保护你免受这种情况的影响。

无论如何，subversion（以及实际上的任何 VCS）允许您通过复制或合并来检索意外删除的文件。Subversion 文档中的这一页解释了[如何恢复已删除的文件](http://svnbook.red-bean.com/nightly/en/svn.branchmerge.basicmerging.html#svn.branchmerge.basicmerging.undo)。您应该查看“*撤消更改*”和“*恢复已删除项目*”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T20:04:03.030

您可以在存储库上设置[预提交挂钩](http://svnbook.red-bean.com/en/1.8/svn.ref.reposhooks.pre-commit.html)以控制哪些用户可以添加或删除文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T19:55:54.377

源代码控制的优点之一是，如果有人删除文件并不重要。如果他们删除了一个文件并将其签入并且它不应该被删除，那么只需恢复他们的修订。就那么简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T19:56:29.977

我建议您阅读有关版本控制的书，最好是[使用 Subversion 的版本控制](http://svnbook.red-bean.com/ "使用 Subversion 进行版本控制")。您描述的不是问题，这就是版本控制的工作方式。

# c# - 必须在 C# 中手动清理的资源？

> ID：117135
> 
> 赞同：11
> 
> 时间：2008-09-22T19:54:04.473
> 
> 标签：c#, memory-management, resources, garbage-collection

*在C#*中必须手动清理哪些资源，不这样做的后果是什么？

例如，假设我有以下代码：

```
myBrush = new System.Drawing.SolidBrush(System.Drawing.Color.Black);
// Use Brush 
```

如果我不使用 dispose 方法清理画笔，我假设垃圾收集器会释放程序终止时使用的内存？它是否正确？

我还需要手动清理哪些其他资源？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T19:57:24.763

*   对内部 windows 数据结构的句柄。
*   数据库连接。
*   文件句柄。
*   网络连接。
*   COM/OLE 引用。

名单还在继续。

打电话很重要，`Dispose`甚至更好的是，使用该`using`模式。

```
using (SolidBrush myBrush = new System.Drawing.SolidBrush(System.Drawing.Color.Black))
{
    // use myBrush
} 
```

* * *

如果你不处理某些东西，当垃圾收集器注意到没有更多对它的引用时，它会被清理掉，这可能是在一段时间之后。

在 的情况下`System.Drawing.Brush`，Windows 将保持在内存中加载的画笔的内部窗口结构，直到所有程序释放它们的句柄。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-22T19:59:11.700

如果您不处置某些东西，那么当垃圾收集器注意到您的代码中不再有对它的引用时，它就会被清理掉，这可能是在一段时间之后。对于这样的事情，这并不重要，但对于打开的文件，它可能确实如此。

一般来说，如果某个东西有一个 Dispose 方法，你应该在完成它后调用它，或者，如果可以的话，将它包装在一个`using`语句中：

```
using (SolidBrush myBrush = new System.Drawing.SolidBrush(System.Drawing.Color.Black))
{
    // use myBrush
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T20:04:57.677

不处置 IDisposables 的后果可能会从可忽略不计的性能损失到使您的应用程序崩溃。

您的示例中的 Brush 对象将在需要时由 GC 清理。但是，您的程序将无法从早先清理它所获得的那一点额外内存中受益。如果您使用大量 Brush 对象，这可能会变得很重要。如果对象存在时间不长，GC 也更有效地清理对象，因为它是一个分代垃圾收集器。

另一方面，不释放数据库连接对象的后果可能意味着您很快就会耗尽池中的数据库连接并导致您的应用程序崩溃。

要么使用

```
using (new DisposableThing...
{
    ...
} 
```

或者，如果您需要在对象的生命周期中保留对 IDisposable 的引用，请在您的对象上实现 IDisposable 并调用 IDisposable 的 Dispose 方法。

```
class MyClass : IDisposable
{
    private IDisposable disposableThing;

    public void DoStuffThatRequiresHavingAReferenceToDisposableThing() { ... }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    protected virtual void Dispose(bool disposing)
    //etc... (see IDisposable on msdn) 
```

}

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T19:57:27.260

通常，任何实现 IDisposable 的东西都会让您暂停并研究您正在使用的资源。

GC 仅在内存压力时发生，因此您无法预测何时。虽然卸载 AppDomain 肯定会触发它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T20:01:48.387

从技术上讲，任何从 IDisposable 继承的东西都应该被主动处置。您可以使用“使用”语句使事情变得更容易。

[http://msdn.microsoft.com/en-us/library/yh598w02.aspx](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)

有时您会在文档示例代码以及由工具（即 Visual Studio）生成的代码中看到 IDisposable 派生对象的使用不一致。

IDisposable 的优点在于它使您能够*主动*释放底层非托管资源。有时您真的很想这样做——例如考虑网络连接和文件资源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T20:09:07.060

正如其他人所说，使用是你的朋友。我写了[这篇博客文章](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2006/09/21/10887.aspx)，介绍如何以一种相当简单的方式实现 IDisposable，通过分解最重要的部分来减少出错的可能性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T21:05:52.947

当我不记得给定对象是否是一次性资源时，我使用的一个技巧是在声明后键入“.Dispose”（最多！）让 Intellisense 为我检查：

```
MemoryStream ms = new MemoryStream().Dispose 
```

然后删除 .Dispose 并使用 using() 指令：

```
using(MemoryStream ms = new MemoryStream())
{
  ...
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T19:59:10.890

好吧，只要你使用资源的托管版本，并且不要自己调用windows API，你应该可以的。当您得到的是 IntPtr 时，只需担心必须删除/销毁资源，因为“Windows 句柄”（以及许多其他东西）在 .NET 中是已知的，而不是对象。

顺便说一句，一旦您离开当前上下文，资源（与任何其他 .NET 对象一样）将被标记为收集，因此如果您在方法中创建 Brush，它会在您退出时被标记。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:00:18.920

如果它是托管的（即框架的一部分），您无需担心它。如果它实现 IDisposable 只需将其包装在一个`using`块中。

如果您想使用非托管资源，那么您需要阅读终结器并自己实现 IDisposable。

[这个问题](https://stackoverflow.com/questions/12368/how-to-dispose-a-class-in-net#36737)下有更多细节

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T20:03:44.077

首先在程序终止时，您可以假设进程使用的内存将随进程本身一起被消除。

在.net中使用dispose或析构函数时，必须明白GC调用dispose函数的时间是不确定的。这就是为什么建议显式使用 using 或调用 dispose 的原因。

使用文件等资源时，必须释放内存对象（如信号量）和 .net 托管世界之外的资源。

例如，您需要处理 SolidBrush，因为它是一个 GDI 对象并且存在于 .net 世界之外。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T20:04:05.073

垃圾收集器不仅在程序终止时释放，否则它不会真正有用（在任何体面/最近的操作系统上，当进程退出时，它的所有内存都会被操作系统自动清理）。

与 C/C++ 相比，C# 的一大优势是您不必关心释放分配的对象（至少在大多数情况下）；gc 在运行时决定时执行它（各种策略何时/如何执行）。

gc 不处理许多资源：文件、与线程相关的资源（锁）、网络连接等......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T20:08:40.727

需要注意的一个地方是对 GC 来说*看起来*很小但实际上并不大的对象......例如，在 SharePoint API 中，就 GC 而言，SPWeb 对象占用的空间很小，因此收集的优先级较低，但它确实抓住了GC不知道的一堆内存（我相信在堆中）。例如，如果您正在学习一大堆这些，您会遇到一些有趣的记忆问题，请始终记住使用 using 或 dispose！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-12-01T23:10:38.590

与其将对象视为“持有”需要释放的资源，不如将对象视为更改了某些内容（可能在计算机之外！），这将比它更长寿，如果它在某种程度上可能是有害的没有撤消或“清理”，但只有对象才能清理。虽然这种更改通常采用标记为“忙碌”的池中的某个具体对象的形式，但其精确形式并不重要。重要的是需要撤消更改，并且对象包含执行此操作所需的信息。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2008-09-22T19:58:40.033

垃圾收集器将处理任何托管资源。在您的示例中，当垃圾收集器决定清理画笔时，这将在最后一次对画笔的引用不再有效后的一段时间内发生。

有些事情需要手动清理，但那些是从非托管源检索的指针，例如 DLL 调用，但是 .NET Framework 中的任何内容都不需要这种处理。

# ruby - Ruby 和 WS 安全性

> ID：117141
> 
> 赞同：5
> 
> 时间：2008-09-22T19:54:55.237
> 
> 标签：ruby, soap, ws-security

我很难找到实现 WS-Security 的优秀 Ruby 库。我见过[wss4r](http://rubyforge.org/projects/wss4r/)但还没有使用它（并且文档对它有点轻）。您使用哪些库来完成这项任务，或者有更好的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T14:13:47.577

我自己不太使用肥皂，但是这个 ruby​​ 扩展在我的尝试清单上：[这里](http://wso2.org/projects/wsf/ruby)。可能想检查一下。

# vim - 我可以在 vim 中（重新）映射 Ex 命令吗？

> ID：117150
> 
> 赞同：74
> 
> 时间：2008-09-22T19:55:40.663
> 
> 标签：vim

我喜欢 vim 和它给我的速度。但有时，我的手指太快了，我发现自己在打字`:WQ`而不是`:wq`. （在德语键盘上，你必须按`Shift`才能得到冒号`:`。）然后 Vim 会抱怨`WQ`是`Not an editor command`.

有什么方法可以制作`W`和`Q`编辑命令吗？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-09-22T20:03:38.040

尝试

```
 :command WQ wq
 :command Wq wq
 :command W w
 :command Q q 
```

这样您就可以定义自己的命令。有关`:help command`更多信息，请参阅。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2010-11-08T16:07:10.877

替代方法：

使用'[命令缩写](http://vimdoc.sourceforge.net/htmldoc/map.html#Abbreviations)'

```
:ca WQ wq 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-23T08:24:51.627

你可以使用

```
:cmap WQ wq 
```

也是。例如我有

```
cmap h tab help 
```

在我`.vimrc`这意味着在新选项卡中打开帮助页面。

[感谢吉姆·斯图尔特的提示](https://stackoverflow.com/questions/117150/can-i-re-map-commands-in-vim/119821#comment18676583_119821)：

> 但这里有一个比上面更好的解决方案（用于帮助映射，所以它只适用于你这样做：h）：
> 
> ```
> cnoreabbrev <expr> h getcmdtype() == ":" && getcmdline() == "h" ? "tab h" : "h" 
> ```

# python - Python 和 POST 数据

> ID：117167
> 
> 赞同：5
> 
> 时间：2008-09-22T19:57:37.413
> 
> 标签：python, http, post

在 PHP 中，我只写：

```
$bob = $_POST['bob']; 
```

我如何在 Python 中做同样的事情？

是的，我通常会检查它是否存在等，我只是将它专门剥离为我所追求的功能。

* * *

编辑：我没有使用框架

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-22T20:01:12.727

最简单的方法是“cgi”模块：

```
import cgi
data = cgi.FieldStorage()
data['bob'] 
```

但是您正在执行的上下文（您正在使用的框架、WSGI 甚至（天堂禁止）mod_python）可能具有不同的、更有效或更直接的访问方法。

# exception - 使用断言或异常按合同设计？

> ID：117171
> 
> 赞同：128
> 
> 时间：2008-09-22T19:57:57.930
> 
> 标签：exception, assert, design-by-contract

当通过契约编程时，函数或方法首先检查其先决条件是否得到满足，然后再开始履行其职责，对吧？进行这些检查的两种最突出的方法是 by`assert`和 by `exception`。

1.  断言仅在调试模式下失败。为了确保（单元）测试所有单独的合同先决条件以查看它们是否真的失败是至关重要的。
2.  异常在调试和发布模式下失败。这样做的好处是测试的调试行为与发布行为相同，但会导致运行时性能损失。

你觉得哪一个更可取？

[在此处](https://stackoverflow.com/questions/419406/are-assertions-good)查看相关问题

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2008-09-22T20:06:07.050

经验法则是，当你试图捕捉自己的错误时，你应该使用断言，而当你试图捕捉别人的错误时，你应该使用异常。换句话说，您应该使用异常来检查公共 API 函数的先决条件，以及每当您获得系统外部的任何数据时。您应该对系统内部的功能或数据使用断言。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-22T20:03:41.533

在发布版本中禁用断言就像在说“我在发布版本中永远不会有任何问题”，但通常情况并非如此。所以断言不应该在发布版本中被禁用。但是您也不希望发布版本在发生错误时崩溃，对吗？

所以使用异常并很好地使用它们。使用良好、可靠的异常层次结构并确保您捕获并可以在调试器中对异常抛出进行挂钩以捕获它，并且在发布模式下您可以补偿错误而不是直接崩溃。这是更安全的方式。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-22T20:13:47.330

我遵循的原则是：如果可以通过编码实际避免某种情况，则使用断言。否则使用异常。

断言是为了确保合同得到遵守。合同必须是公平的，因此客户必须能够确保其遵守。例如，您可以在合同中声明 URL 必须有效，因为关于什么是有效 URL 和什么不是有效 URL 的规则是已知且一致的。

例外情况是客户端和服务器都无法控制的情况。异常意味着出现了问题，并且没有任何办法可以避免它。例如，网络连接不在应用程序控制范围内，因此无法采取任何措施来避免网络错误。

我想补充一点，断言/异常的区别并不是考虑它的最佳方式。您真正想要考虑的是合同以及如何执行合同。在我上面的 URL 示例中，最好的办法是有一个封装 URL 的类，并且是 Null 或有效 URL。它是将字符串转换为 URL 来执行合同，如果无效则抛出异常。带有 URL 参数的方法比带有 String 参数和指定 URL 的断言的方法更清晰。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-22T21:39:29.683

断言用于发现开发人员做错的事情（不仅是您自己 - 您团队中的另一位开发人员也是如此）。如果用户错误可能造成这种情况是合理的，那么它应该是一个例外。

同样考虑后果。断言通常会关闭应用程序。如果有任何现实的期望可以恢复条件，您可能应该使用异常。

另一方面，如果问题**只能**由程序员错误引起，那么请使用断言，因为您想尽快了解它。异常可能会被捕获和处理，而您永远不会发现它。是的，您应该在发布代码中禁用断言，因为您希望应用程序在有最小机会时恢复。即使您的程序状态被严重破坏，用户也可能能够保存他们的工作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-29T15:10:41.350

“断言仅在调试模式下失败”并不完全正确。

在Bertrand Meyer 的*Object Oriented Software Construction, 2nd Edition*中，作者为在发布模式下检查先决条件敞开了大门。在这种情况下，当断言失败时会发生什么……引发断言冲突异常！在这种情况下，无法从这种情况中恢复：尽管可以做一些有用的事情，即自动生成错误报告，并且在某些情况下，重新启动应用程序。

这背后的动机是前置条件通常比不变量和后置条件更便宜，并且在某些情况下，发布版本中的正确性和“安全性”比速度更重要。即对于许多应用程序来说，速度不是问题，但**健壮性**（当程序的行为不正确时，即当合同被破坏时，程序以安全方式运行的能力）才是问题。

您是否应该始终启用前提条件检查？这取决于。由你决定。没有普遍的答案。如果您正在为银行开发软件，最好用一条警告消息中断执行，而不是转移 1,000,000 美元而不是 1,000 美元。但是，如果您正在编写游戏怎么办？也许你需要你能得到的所有速度，如果有人因为先决条件没有捕捉到的错误（因为它们没有被启用）而获得 1000 分而不是 10 分，那么运气不好。

在这两种情况下，理想情况下，您都应该在测试期间发现该错误，并且您应该在启用断言的情况下进行大部分测试。这里讨论的是，对于那些由于测试不完整而未在早期检测到的场景中的先决条件在生产代码中失败的罕见情况，最佳策略是什么。

总而言之，如果您启用它们，**您可以拥有断言并仍然自动获取异常**- 至少在 Eiffel 中是这样。我认为在 C++ 中做同样的事情你需要自己输入。

另请参阅：[断言何时应保留在生产代码中？](https://stackoverflow.com/questions/17732/when-should-assertions-stay-in-production-code)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T08:17:14.360

关于在 comp.lang.c++.moderated 上的发布版本中启用/禁用断言有一个巨大的[线索](http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/8e0235d58c8635c2/cc1743e28e71166f?#cc1743e28e71166f)，如果你有几个星期的时间，你可以看到对此的看法是多么的多样化。:)

与[coppro](https://stackoverflow.com/questions/117171/design-by-contract-tests-by-assert-or-by-exception#117224)相反，我相信如果您不确定可以在发布版本中禁用断言，那么它不应该是断言。断言是为了防止程序不变量被破坏。在这种情况下，就您的代码的客户端而言，将有两种可能的结果之一：

1.  死于某种操作系统类型故障，导致调用中止。（无断言）
2.  通过直接调用 abort 而死。（带断言）

对用户来说没有区别，但是，断言可能会在代码中增加不必要的性能成本，这些成本存在于代码不会失败的绝大多数运行中。

这个问题的答案实际上更多地取决于 API 的客户是谁。如果您正在编写一个提供 API 的库，那么您需要某种形式的机制来通知您的客户他们错误地使用了 API。除非您提供两个版本的库（一个带有断言，一个没有），否则断言不太可能是合适的选择。

然而，就我个人而言，我也不确定我是否会在这种情况下遇到例外情况。例外情况更适合可以进行适当恢复形式的地方。例如，您可能正在尝试分配内存。当您捕获“std::bad_alloc”异常时，可能会释放内存并重试。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-29T15:25:58.637

我在这里概述了我对此事状态的看法：[如何验证对象的内部状态？](https://stackoverflow.com/questions/343605/how-do-you-validate-an-objects-internal-state#343628). 通常，主张您的主张并因他人违反而提出。要在发布版本中禁用断言，您可以执行以下操作：

*   禁用断言以进行昂贵的检查（例如检查范围是否已排序）
*   保持启用琐碎检查（例如检查空指针或布尔值）

当然，在发布版本中，失败的断言和未捕获的异常应该以另一种方式处理，而不是在调试版本中（它可以只调用 std::abort）。将错误日志写入某处（可能写入文件），告诉客户发生了内部错误。客户将能够向您发送日志文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T20:05:37.270

您在询问设计时错误和运行时错误之间的区别。

断言是“嘿，程序员，这是坏的”通知，它们在那里提醒你当它们发生时你不会注意到的错误。

例外是“嘿，用户，出了点问题”通知（显然，您可以编写代码来捕获它们，这样用户就不会被告知），但这些被设计为在 Joe 用户使用应用程序时在运行时发生。

因此，如果您认为可以解决所有错误，请仅使用异常。如果你认为你不能......使用例外。当然，您仍然可以使用调试断言来减少异常数量。

不要忘记，许多前提条件都是用户提供的数据，因此您需要一种很好的方法来告知用户他的数据不好。为此，您通常需要将错误数据沿调用堆栈返回到他正在与之交互的位。断言将没有用 - 如果您的应用程序是 n 层，则更是如此。

最后，我都不会使用 - 错误代码对于您认为会经常发生的错误要好得多。:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:08:12.180

我更喜欢第二个。虽然你的测试可能运行良好，但[墨菲](http://en.wikipedia.org/wiki/Murphy%27s_law)说，一些意想不到的事情会出错。因此，您最终不会在实际的错误方法调用中获得异常，而是在更深的 10 个堆栈帧中追踪 NullPointerException（或等效的）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T20:51:18.957

前面的答案是正确的：对公共 API 函数使用异常。您可能希望改变此规则的唯一时间是检查的计算量很大。在这种情况下，您**可以**将其放入断言中。

如果您认为可能违反该前提条件，请将其保留为异常，或重构前提条件。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T21:23:13.323

你应该同时使用两者。断言是为了方便您作为开发人员。异常会捕获您在运行时错过或未预料到的事情。

我越来越喜欢[glib 的错误报告功能](http://library.gnome.org/devel/glib/unstable/glib-Warnings-and-Assertions.html "错误报告功能的 glib 文档")，而不是简单的旧断言。它们的行为类似于断言语句，但它们不会停止程序，而是返回一个值并让程序继续运行。它工作得非常好，作为奖励，当一个函数没有返回“它应该返回什么”时，你可以看到程序的其余部分会发生什么。如果它崩溃了，你就知道你的错误检查在其他地方是松懈的。

在我的上一个项目中，我使用这些风格的函数来实现前置条件检查，如果其中一个失败，我会将堆栈跟踪打印到日志文件但继续运行。当其他人在运行我的调试版本时遇到问题时，为我节省了大量的调试时间。

```
#ifdef DEBUG
#define RETURN_IF_FAIL(expr)      do {                      \
 if (!(expr))                                           \
 {                                                      \
     fprintf(stderr,                                        \
        "file %s: line %d (%s): precondition `%s' failed.", \
        __FILE__,                                           \
        __LINE__,                                           \
        __PRETTY_FUNCTION__,                                \
        #expr);                                             \
     ::print_stack_trace(2);                                \
     return;                                                \
 };               } while(0)
#define RETURN_VAL_IF_FAIL(expr, val)  do {                         \
 if (!(expr))                                                   \
 {                                                              \
    fprintf(stderr,                                             \
        "file %s: line %d (%s): precondition `%s' failed.",     \
        __FILE__,                                               \
        __LINE__,                                               \
        __PRETTY_FUNCTION__,                                    \
        #expr);                                                 \
     ::print_stack_trace(2);                                    \
     return val;                                                \
 };               } while(0)
#else
#define RETURN_IF_FAIL(expr)
#define RETURN_VAL_IF_FAIL(expr, val)
#endif 
```

如果我需要运行时检查参数，我会这样做：

```
char *doSomething(char *ptr)
{
    RETURN_VAL_IF_FAIL(ptr != NULL, NULL);  // same as assert(ptr != NULL), but returns NULL if it fails.
                                            // Goes away when debug off.

    if( ptr != NULL )
    {
       ...
    }

    return ptr;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-10-25T07:12:16.583

我尝试在这里用我自己的观点综合其他几个答案。

在您想在生产中禁用它的情况下使用断言，而不是将它们留在其中。在生产中而不是在开发中禁用的唯一真正原因是加速程序。在大多数情况下，这种加速并不显着，但有时代码对时间要求很高，或者测试的计算量很大。如果代码是关键任务，那么尽管速度慢，异常可能是最好的。

如果有任何真正的恢复机会，请使用异常，因为断言并非旨在从中恢复。例如，代码很少设计用于从编程错误中恢复，但它旨在从网络故障或锁定文件等因素中恢复。错误不应仅仅因为超出程序员的控制而作为异常处理。相反，与编码错误相比，这些错误的可预测性使它们更易于恢复。

重新论证调试断言更容易：来自正确命名异常的堆栈跟踪与断言一样容易阅读。好的代码应该只捕获特定类型的异常，所以异常不应该因为被捕获而被忽视。但是，我认为 Java 有时会强制您捕获所有异常。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-01-05T11:25:28.123

对我来说，经验法则是使用断言表达式来查找内部错误和外部错误的异常。您可以从 Greg 的以下讨论中[受益匪浅](http://bytes.com/topic/c/answers/141336-assert-vs-error-handling)。

> 断言表达式用于查找编程错误：程序逻辑本身的错误或相应实现中的错误。断言条件验证程序是否保持在定义的状态。“定义的状态”基本上是与程序假设一致的状态。请注意，程序的“已定义状态”不必是“理想状态”甚至“通常状态”，甚至“有用状态”，但稍后会详细介绍这一点。
> 
> 要了解断言如何适合程序，请考虑 C++ 程序中即将取消引用指针的例程。现在例程应该在取消引用之前测试指针是否为 NULL，还是应该断言指针不为 NULL，然后继续取消引用它？
> 
> 我想大多数开发人员都希望同时添加断言，但还要检查指针是否为 NULL 值，以免在断言条件失败时崩溃。从表面上看，同时进行测试和检查似乎是最明智的决定
> 
> 与其断言的条件不同，程序的错误处理（异常）不是指程序中的错误，而是指程序从其环境中获得的输入。这些通常是某人的“错误”，例如用户尝试登录帐户而不输入密码。即使错误可能会阻止程序任务的成功完成，也不会有程序失败。由于外部错误，该程序无法在没有密码的情况下登录用户 - 用户方面的错误。如果情况不同，用户输入了正确的密码，程序无法识别；那么虽然结果还是一样，但失败现在属于程序。
> 
> 错误处理（异常）的目的有两个。第一个是与用户（或其他一些客户端）沟通已检测到程序输入中的错误及其含义。第二个目标是在检测到错误后将应用程序恢复到明确定义的状态。请注意，在这种情况下，程序本身并没有错误。诚然，程序可能处于非理想状态，甚至是无用的状态，但不存在编程错误。相反，由于错误恢复状态是程序设计的一种预期状态，它是程序可以处理的状态。

PS：您可能想查看类似的问题：[Exception Vs Assertion](https://stackoverflow.com/questions/1276308/exception-vs-assertion)。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-22T20:18:22.967

另请参阅[此问题](https://stackoverflow.com/questions/56168/test-cases-and-assertion-statements#56174)：

> 在某些情况下，断言在构建发布时被禁用。您可能无法控制这一点（否则，您可以使用断言进行构建），因此这样做可能是个好主意。
> 
> “更正”输入值的问题是调用者不会得到他们期望的结果，这可能导致程序的完全不同部分出现问题甚至崩溃，使调试成为一场噩梦。
> 
> 我通常在 if 语句中抛出一个异常来接管断言的角色，以防它们被禁用
> 
> ```
> assert(value>0);
> if(value<=0) throw new ArgumentOutOfRangeException("value");
> //do stuff 
> ```

# c# - Try-catch 每一行代码，无需单独的 try-catch 块

> ID：117173
> 
> 赞同：14
> 
> 时间：2008-09-22T19:58:00.567
> 
> 标签：c#, try-catch, expression-trees

**我目前没有这个问题**，但你永远不知道，思想实验总是很有趣。

**忽略你的架构甚至尝试这样做的明显问题**，让我们假设你有一些别人设计的可怕编写的代码，并且你需要在相同的代码中执行大量广泛而多样的操作块，例如：

```
WidgetMaker.SetAlignment(57);
contactForm["Title"] = txtTitle.Text;
Casserole.Season(true, false);
((RecordKeeper)Session["CasseroleTracker"]).Seasoned = true; 
```

乘以一百。其中一些可能有效，另一些可能会出错。您需要的是与“on error resume next”等效的 C#，否则您最终将在多行代码周围复制和粘贴 try-catch。

你会如何尝试解决这个问题？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-22T21:24:51.823

```
public delegate void VoidDelegate();

public static class Utils
{
  public static void Try(VoidDelegate v) {
    try {
      v();
    }
    catch {}
  }
}

Utils.Try( () => WidgetMaker.SetAlignment(57) );
Utils.Try( () => contactForm["Title"] = txtTitle.Text );
Utils.Try( () => Casserole.Season(true, false) );
Utils.Try( () => ((RecordKeeper)Session["CasseroleTracker"]).Seasoned = true ); 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-22T20:04:27.257

重构为单独的、命名良好的方法：

```
AdjustFormWidgets();
SetContactTitle(txtTitle.Text);
SeasonCasserole(); 
```

每一个都受到适当的保护。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-22T21:24:02.073

我会说**什么都不做**。

是的，没错，什么都不做。

你已经清楚地向我指出了两件事：

1.  你知道架构很无聊。
2.  有很多这种废话。

我说：

*   没做什么。
*   添加一个全局错误处理程序，以在每次发送时向您发送一封电子邮件。
*   等到有东西翻倒（或测试失败）
*   更正那个（**在页面范围内**根据需要进行重构）。
*   每次出现问题时重复。

如果情况如此糟糕，您将立即解决此问题。是的，我知道这听起来很糟糕，而且您可能一开始就用错误修复来拉扯头发，但它可以让您在（大量）**代码之前修复有需要/错误**的代码，无论它多么糟糕，它**实际上都可以正常工作**看起来。

一旦您开始赢得战争，您将对代码有更好的处理（由于您的所有重构），您将对获胜的设计有更好的想法。

尝试将所有这些都包裹在气泡纸中可能需要很长时间才能完成，而且您仍然不会更接近解决问题。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-22T21:54:04.453

很明显，您将在 VB.NET 中编写代码，该代码实际上确实具有[On Error Resume Next](http://msdn.microsoft.com/en-us/library/5hsw66as.aspx)，并将其以 DLL 的形式导出到 C#。其他任何事情都只是贪吃惩罚。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-22T20:20:45.113

## [快速失败](http://en.wikipedia.org/wiki/Fail-fast)

详细地说，我想我是在质疑这个问题。如果抛出异常，为什么您希望您的代码像什么都没发生一样继续执行？在某些情况下您可能会遇到异常，在这种情况下，您围绕该代码编写一个 try-catch 块并处理它们，或者出现意外错误，在这种情况下，您应该更喜欢您的应用程序中止、重试或失败。不要像受伤的僵尸一样呻吟着“大脑”。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-22T20:08:34.610

这是拥有预处理器有用的事情之一。您可以定义一个吞噬异常的宏，然后使用快速脚本将该宏添加到所有行。

所以，如果这是 C++，你可以这样做：

```
#define ATTEMPT(x) try { x; } catch (...) { }
// ...
ATTEMPT(WidgetMaker.SetAlignment(57));
ATTEMPT(contactForm["Title"] = txtTitle.Text);
ATTEMPT(Casserole.Season(true, false));
ATTEMPT(((RecordKeeper)Session["CasseroleTracker"]).Seasoned = true); 
```

不幸的是，似乎没有多少语言像 C/C++ 那样包含预处理器。

您可以创建自己的预处理器并将其添加为预构建步骤。如果您想完全自动化它，您可能会编写一个预处理器来获取实际的代码文件并自行添加 try/catch 内容（因此您不必手动将那些 ATTEMPT() 块添加到代码中） . 确保它只修改了它应该修改的行可能很困难（必须跳过变量声明、循环构造等，以免破坏构建）。

然而，我认为这些都是可怕的想法，永远不应该这样做，但有人问了这个问题。:)

真的，你永远不应该这样做。您需要找到导致错误的原因并修复它。吞下/忽略错误是一件坏事，所以我认为这里的*正确*答案是“修复错误，不要忽略它！”。:)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-22T20:01:14.007

`On Error Resume Next`在 C# 世界中是一个非常糟糕的主意。添加等效项也不会`On Error Resume Next`真正帮助您。它所做的只是让您处于糟糕的状态，这可能会导致更微妙的错误、数据丢失以及可能的数据损坏。

但是为了让提问者得到应有的回报，您可以添加一个全局处理程序并检查 TargetSite 以查看哪个方法无效。然后你至少可以知道它在哪条线上。下一部分将尝试找出如何以与调试器相同的方式设置“下一条语句”。希望此时您的堆栈不会解开，或者您可以重新创建它，但这当然值得一试。但是，鉴于这种方法，代码每次都必须在调试模式下运行，以便您可以包含调试符号。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-23T02:03:23.400

正如有人提到的，VB 允许这样做。在 C# 中以同样的方式做怎么样？输入可信赖的反射器：

这：

```
Sub Main()
    On Error Resume Next

    Dim i As Integer = 0

    Dim y As Integer = CInt(5 / i)

End Sub 
```

翻译成这样：

```
public static void Main()
{
    // This item is obfuscated and can not be translated.
    int VB$ResumeTarget;
    try
    {
        int VB$CurrentStatement;
    Label_0001:
        ProjectData.ClearProjectError();
        int VB$ActiveHandler = -2;
    Label_0009:
        VB$CurrentStatement = 2;
        int i = 0;
    Label_000E:
        VB$CurrentStatement = 3;
        int y = (int) Math.Round((double) (5.0 / ((double) i)));
        goto Label_008F;
    Label_0029:
        VB$ResumeTarget = 0;
        switch ((VB$ResumeTarget + 1))
        {
            case 1:
                goto Label_0001;

            case 2:
                goto Label_0009;

            case 3:
                goto Label_000E;

            case 4:
                goto Label_008F;

            default:
                goto Label_0084;
        }
    Label_0049:
        VB$ResumeTarget = VB$CurrentStatement;
        switch (((VB$ActiveHandler > -2) ? VB$ActiveHandler : 1))
        {
            case 0:
                goto Label_0084;

            case 1:
                goto Label_0029;
        }
    }
    catch (object obj1) when (?)
    {
        ProjectData.SetProjectError((Exception) obj1);
        goto Label_0049;
    }
Label_0084:
    throw ProjectData.CreateProjectError(-2146828237);
Label_008F:
    if (VB$ResumeTarget != 0)
    {
        ProjectData.ClearProjectError();
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-22T20:03:52.283

重写代码。尝试找到逻辑上相互依赖的语句集，这样如果一个失败，那么下一个语句就没有意义了，如果你想忽略并继续。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-22T20:23:00.660

这可以帮助您确定问题最多的部分。

@JB King 谢谢提醒。Logging 应用程序块有一个可用于跟踪事件的 Instrumentation Event，您可以在 MS Enterprise 库文档中找到更多信息。

```
Using (New InstEvent)
<series of statements> 
End Using 
```

此使用中的所有步骤都将被跟踪到一个日志文件，您可以将其解析出来以查看日志中断的位置（例如抛出）并识别高违规者。

重构确实是你最好的选择，但如果你有很多，这可能会帮助你找出最严重的违规者。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T20:06:39.670

如果您可以让编译器为您提供此代码的表达式树，那么您可以通过将每个语句替换为包含原始语句的新 try-catch 块来修改该表达式树。这并不像听起来那么牵强。对于 LINQ，C# 获得了将 lambda 表达式捕获为表达式树的能力，这些表达式树可以在运行时在用户代码中进行操作。

这种方法在今天的 .NET 3.5 中是不可能的——如果没有其他原因，只是 System.Linq.Expressions 中缺少“try”语句。但是，一旦 DLR 和 LINQ 表达式树的合并完成，它在 C# 的未来版本中很可能是可行的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-22T20:18:54.710

您*可以*使用 goto，但它仍然很乱。

我实际上想要一种单语句 try-catch 有一段时间了。这在某些情况下会很有帮助，例如添加日志代码或您不想在主程序流失败时中断的东西。

我怀疑一些与 linq 相关的功能可以做一些事情，但目前还没有时间研究它。如果您能找到一种方法将语句包装为匿名函数，然后使用另一个方法在 try-catch 块中调用它，它会起作用......但不确定这是否可能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-23T02:16:56.193

为什么不在 c# 中使用反射？您可以创建一个反映代码的类，并使用 #s 行作为在每个单独的 try/catch 块中放置内容的提示。这有几个优点：

1.  它稍微不那么难看，因为它实际上并不需要修改源代码，并且您只能在调试模式下使用它。
2.  在实现 C# 时，您会学到一些有趣的东西。

但是，我建议您不要这样做，除非您当然要接管某些工作的维护，并且您需要处理异常情况以便修复它们。不过写起来可能会很有趣。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-23T16:29:49.607

有趣的问题；非常可怕。

如果能用宏就好了。但这是 C#，所以你可以用一些预处理器工作或一些外部工具来解决它，将你的行包装在单独的 try-catch 块中。不确定您的意思是您不想*手动*包装它们，还是您想*完全*避免 try-catch 。

解决这个问题，我尝试标记每一行并从一次捕获中跳回来，但没有太多运气。然而，[克里斯托弗发现了这样做的正确方法](https://stackoverflow.com/questions/117173/c-try-catch-every-line-of-code-without-individual-try-catch-blocks#118742)。在 Dot Net Thoughts和[Mike Stall 的 .NET 博客](http://blogs.msdn.com/jmstall/archive/2008/04/12/codegen-for-on-error-resume-next.aspx)上对此有一些[有趣的额外讨论](http://dotnetthoughts.wordpress.com/2007/10/12/why-language-is-important-why-i-prefer-c/)。

*编辑：当然。列出的`try-catch`/`switch-goto`解决方案实际上不会编译，因为`try`标签超出了`catch`. 任何人都知道进行这样的编译缺少什么？*

您可以使用编译器预处理步骤自动执行此操作，或者可以破解[Mike Stall 的内联 IL 工具](http://blogs.msdn.com/jmstall/archive/2005/02/21/377806.aspx)以注入一些错误无知。

（ Orion Adrian 关于检查异常并尝试设置下一条指令[的回答也很有趣。）](https://stackoverflow.com/questions/117173/c-try-catch-every-line-of-code-without-individual-try-catch-blocks#117202)

总而言之，这似乎是一个有趣且有启发性的练习。当然，您必须决定在什么时候模拟 ON ERROR RESUME NEXT 的努力超过修复代码的努力。:-)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-08-03T15:14:09.030

[在应用程序的UnhandledException 事件](http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception%28v=VS.90%29.aspx)中捕获错误。这样，甚至可以将未处理的异常记录到发件人以及开发人员认为合理的任何其他信息。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-22T20:03:00.367

不幸的是，你可能不走运。On Error Resume Next 是一个传统选项，通常不鼓励使用，并且没有与我在 C# 中的知识等效的选项。

我建议将代码保留在 VB 中（这听起来像是源代码，考虑到您对 OnError ResumeNext 的特定请求），并与 C# dll 或 exe 进行交互，以实现您需要的任何新代码。然后进行预制重构以使代码安全，并在执行此操作时将此安全代码转换为 C#。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-22T20:11:18.303

您可以查看集成企业库的异常处理组件，以了解如何处理未处理的异常。

如果这是针对 ASP.Net 应用程序的，那么 Global.asax 中有一个名为“Application_Error”的函数，在大多数情况下都会调用该函数，而灾难性故障通常是另一种情况。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-09-22T20:07:56.047

忽略所有你想避免这样做的原因......

如果只是需要保持 # 行数，您可以尝试以下操作：

```
int totalMethodCount = xxx;
for(int counter = 0; counter < totalMethodCount; counter++) {
    尝试 {
        if (counter == 0) WidgetMaker.SetAlignment(57);
        if (counter == 1) contactForm["Title"] = txtTitle.Text;
        if (counter == 2) Casserole.Season(true, false);
        if (counter == 3) ((RecordKeeper)Session["CasseroleTracker"]).Seasoned = true;
    } 捕捉（异常前）{
        // 在这里登录
    }
}

```

但是，如果您尝试重用任何调用结果，则必须注意变量范围。

* * *

## 回答 #19

> 赞同：-7
> 
> 时间：2008-09-22T20:04:12.813

Hilite 每一行，一次一行，'Surround with' try/catch。这样可以避免您提到的复制粘贴

# java - Seam/JSF 表单提交触发按钮 onclick 事件

> ID：117189
> 
> 赞同：3
> 
> 时间：2008-09-22T19:59:50.593
> 
> 标签：java, html, firefox, jsf, seam

我有一个带有查询生成器的搜索表单。构建器由一个按钮激活。像这样的东西

```
<h:form id="search_form">
  <h:outputLabel for="expression" value="Expression"/>
  <h:inputText id="expression" required="true" value="#{searcher.expression}"/>
  <button onclick="openBuilder(); return false;">Open Builder</button>
  <h:commandButton value="Search" action="#{searcher.search}"/>
</h:form> 
```

结果是表单中同时包含 a`<button/>`和 an`<input type="submit"/>`的 HTML。如果用户在表达式字段中输入字符串并按下回车键而不是单击提交按钮，则在预期行为是提交搜索时显示查询构建器。是什么赋予了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T20:06:00.407

假定 HTML 表单中的按钮用于提交表单。将按钮更改为输入 type="button" 并且应该修复它。

或者，将 type="button" 添加到按钮元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T20:19:30.483

首先，为“搜索”按钮提供一个 ID。然后，在文本框上，您可以使用如下（javascript）函数拦截客户端事件**onkeydown**：

```
 function KeyDownHandler(event)
    {
        // process only the Enter key
        if (event.keyCode == 13)
        {
            // cancel the default submit
            event.returnValue=false;
            event.cancel = true;
            // submit the form by programmatically clicking the specified button
            document.getElementById('searchButtonId').click();
        }
    } 
```

我希望我能帮助你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T01:09:35.167

**如果表单中有一个输入字段**，许多浏览器会在按下回车键时自动提交表单。

尝试

1.  添加另一个输入字段。通过设置样式将其隐藏，使其不可见。（例如，`<input type="text" name="bogusField" style="display: none;" />`
2.  [在 JavaScript 事件处理程序（例如，此处](http://jennifermadden.com/javascript/stringEnterKeyDetector.html)或[此处](http://www.dynamicdrive.com/dynamicindex16/disableenter.htm)）中阻止输入键表单提交行为。更好的是，使用可能对此有所帮助的 GUI 工具包（例如，GWT）

# python - 如何更新 Tix.ComboBox 的文本？

> ID：117211
> 
> 赞同：2
> 
> 时间：2008-09-22T20:02:38.493
> 
> 标签：python, combobox, tkinter, tix

我有一个带有可编辑文本字段的 Tix.ComboBox。如何强制保存文本值的变量更新？

让我做一个更具体的解释。我有一个组合框和一个按钮。当我单击该按钮时，它会弹出一个带有组合框值的消息框。假设组合框文本字段当前的值为“thing1”。如果我在框中输入“new”，然后用鼠标单击按钮，它将弹出消息“thing1”。如果我在框中键入“新”，然后将焦点从组合框移开，然后单击按钮，弹出消息会显示“新”。

我如何强制组合框将其值更新为新的而不需要我从组合框上移开标签？

我已经包含了示例代码。

```
import Tix
import tkMessageBox

class App(object):
    def __init__(self, window):
        window.winfo_toplevel().wm_title("test")
        self.window = window

        self.combo = Tix.ComboBox(window)
        self.combo.insert(Tix.END, 'thing1')
        self.combo.insert(Tix.END, 'thing2')
        self.combo.entry['state'] = "normal"
        self.combo['editable'] = True
        self.combo.pack()

        button = Tix.Button(window)
        button['text'] = "Go"
        button['command'] = self.go
        button.pack()

    def go(self):
        tkMessageBox.showinfo('info', self.combo['value'])

if __name__ == '__main__':
    root = Tix.Tk()
    App(root)
    root.mainloop() 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T20:24:50.063

呜！我自己解决了。

采用

```
self.combo['selection'] 
```

代替

```
self.combo['value'] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-16T01:22:20.983

*注意：可以选择作为选择答案的 Moe 答案的副本*

呜！我自己解决了。

采用

```
self.combo['selection'] 
```

代替

```
self.combo['value'] 
```

# php - 如何检查 php 脚本是否仍在运行

> ID：117226
> 
> 赞同：7
> 
> 时间：2008-09-22T20:03:49.770
> 
> 标签：php, process, queue, monitoring

我有一个`PHP`在队列上侦听的脚本。从理论上讲，它永远不会死。有什么东西可以检查它是否还在运行？`Ruby's God ( http://god.rubyforge.org/ )`类似的东西`PHP`？

上帝是语言不可知论者，但如果有一个适用于 Windows 的解决方案，那就太好了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-12-11T17:07:49.720

我有同样的问题 - 想检查脚本是否正在运行。所以我想出了这个，并将它作为一个 cron 作业运行。它将正在运行的进程作为一个数组抓取并循环遍历每一行并检查文件名。似乎工作正常。将 #user# 替换为您的脚本用户。

```
exec("ps -U #user# -u #user# u", $output, $result);
foreach ($output AS $line) if(strpos($line, "test.php")) echo "found"; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-09-09T11:25:59.523

在linux中运行ps如下：

```
ps -C php -f 
```

然后，您可以在 php 脚本中执行以下操作：

```
$output = shell_exec('ps -C php -f');
if (strpos($output, "php my_script.php")===false) { 
  shell_exec('php my_script.php  > /dev/null 2>&1 &');
} 
```

上面的代码列出了所有完整运行的php进程，然后检查“my_script.php”是否在正在运行的进程列表中，如果没有，则运行该进程并且不等待进程终止继续执行它正在做。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T15:25:57.777

Just append a second command after the script. When/if it stops, the second command is invoked. Eg.:

```
php daemon.php 2>&1 | mail -s "Daemon stopped" you@example.org 
```

### Edit:

Technically, this invokes the mailer right away, but only completes the command when the php script ends. Doing this captures the output of the php-script and includes in the mail body, which can be useful for debugging what caused the script to halt.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-22T20:11:07.397

简单的 bash 脚本

```
#!/bin/bash
while [true]; do
    if ! pidof -x script.php;
    then
        php script.php &
    fi
done 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T12:13:39.923

不适用于窗户，但...

我有几个长时间运行的 PHP 脚本，它们有一个包装它的 shell 脚本。您可以选择从脚本中返回一个值，该值将在 shell 脚本中检查以退出、立即重新启动或休眠几秒钟 - 然后重新启动。

这是一个简单的脚本，它一直运行 PHP 脚本，直到它被手动停止。

```
#!/bin/bash
清除
日期
php -f cli-SCRIPT.php
echo "请稍等..."; 睡觉 10
执行 $0
```

“exec $0”重新启动脚本，而不创建稍后必须解开的子进程（同时占用资源）。这个 bash 脚本包装了一个邮件发件人，所以如果它退出并暂停片刻也不是问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-12-30T04:29:25.320

这是我为解决类似问题所做的工作。如果其他人有一个参数化的 php 脚本，您希望 cron 经常执行，但只希望在任何时候运行一个执行，这会有所帮助。将此添加到您的 php 脚本的顶部，或创建一个通用方法。

```
$runningScripts = shell_exec('ps -ef |grep '.strtolower($parameter).' |grep '.dirname(__FILE__).' |grep '.basename(__FILE__).' |grep -v grep |wc -l');
if($runningScripts > 1){
    die();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-11-17T15:51:22.030

你可以在你的 crontab 中这样写：

```
0 3 * * * /usr/bin/php -f /home/test/test.php my_special_cron 
```

您的 test.php 文件应如下所示：

```
<?php

php_sapi_name() == 'cli' || exit;

if($argv[1]) {
   substr_count(shell_exec('ps -ax'), $argv[1]) < 3 || exit;
}

// your code here 
```

这样一来，您将只有一个带有`my-special-cron`进程密钥的 cron 作业的活动实例。因此，您可以在同一个 php 文件中添加更多作业。

`test.php system_send_emails sendEmails`

`test.php system_create_orders orderExport`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-04-01T05:00:28.707

受到 Justin Levene 的回答的启发，并对其进行了改进，因为`ps -C`它在 Mac 中不起作用，这在我的情况下是我需要的。所以你可以在 php 脚本中使用它（也许就在你需要守护进程之前），在 Mac OS X 10.11.4 和 Ubuntu 14.04 中测试：

```
$daemonPath = "FULL_PATH_TO_DAEMON";
$runningPhpProcessesOfDaemon = (int) shell_exec("ps aux | grep -c '[p]hp ".$daemonPath."'");
if ($runningPhpProcessesOfDaemon === 0) {
    shell_exec('php ' . $daemonPath . ' > /dev/null 2>&1 &');
} 
```

小而有用的细节：为什么`grep -c '[p]hp ...'`而不是`grep -c 'php ...'`？

因为在计算过程`grep -c 'php ...'`时，将被视为符合我们模式的过程。因此，对 php 的第一个字母使用正则表达式会使我们的命令与我们搜索的模式不同。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T15:49:57.330

如果您掌握了脚本，您可以要求他在 db 中每 X 次设置一个时间值，然后让 cron 作业检查该值是否是最新的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T17:46:04.587

troelskn 写道:

> 只需在脚本后附加第二个命令。当/如果它停止，则调用第二个命令。例如。：
> 
> ```
> php daemon.php | mail -s "Daemon stopped" you@example.org 
> ```

`mail`每次在 daemon.php 中打印一行时都会调用它（应该永远不会，但仍然如此。）

相反，使用双 & 运算符来分隔命令，即

```
php daemon.php & mail -s "Daemon stopped" you@example.org 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T20:43:34.417

一种可能的解决方案是让它使用套接字函数在端口上侦听。您可以使用简单的脚本检查套接字是否仍在侦听。甚至像 pingdom 这样的监控服务也可以监控它的状态。如果它死了，则套接字不再侦听。

很多解决方案..祝你好运。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-09-22T15:00:19.647

如果您无法直接检查 PHP 脚本，您可以制作一个简单的包装器并检查它。我对 Windows 脚本编写不够熟悉，无法在这里说明它是如何完成的，但是在 Bash 中，它看起来像......

wrapper_for_test_php.sh

```
#!/bin/bash
php test.php 
```

然后，您只需像检查任何其他 bash 脚本一样检查包装器： pidof -x wrapper_for_test_php.sh

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-11-07T11:01:56.543

我已经在 windows 上使用了 cmder，并且基于这个脚本，我想出了这个我后来设法在 linux 上部署的脚本。

```
#!/bin/bash
 clear
 date
 while true
 do
    php -f processEmails.php
    echo "wait a little while for 5 secobds..."; 
    sleep 5
 done 
```

# http - 是否可以删除子域 cookie？

> ID：117240
> 
> 赞同：16
> 
> 时间：2008-09-22T20:05:08.537
> 
> 标签：http, browser, cookies

如果为子域 metric.foo.com 设置了 cookie，我有没有办法在请求 www.foo.com 时删除 metric.foo.com cookie？浏览器（至少是 Firefox）似乎忽略了域为 metric.foo.com 的 Set-Cookie。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-22T20:21:14.737

Cookie 只能由创建它们的域读取，因此如果 cookie 是在 metric.foo.com 创建的，则必须在创建它的同一域下将其删除。这包括子域。

如果您需要从 metric.foo.com 删除 cookie，但当前正在 www.foo.com 上运行页面，则您将无法删除。

为此，您需要从 metric.foo.com 加载页面，或者在 foo.com 下创建 cookie，以便可以在任何子域下访问它。或者使用这个：

Response.cookies("mycookie").domain = ".foo.com"

...在创建它的同时，在你删除它之前。

..未经测试 - 应该工作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-27T18:18:44.663

我对子域有同样的问题。由于某种原因，首先从请求中获取 cookie 不起作用。相反，我最终只是创建了一个具有相同 cookie 名称和过期日期的新 cookie。效果很好：

```
void DeleteSubdomainCookie（HttpResponse 响应，字符串名称）
{
    HttpCookie cookie = 新的 HttpCookie(名称);
    cookie.Expires = DateTime.Now.AddMonths(-1);
    cookie.Domain = ".yourdomain.com";
    response.Cookies.Add(cookie);
}

```

# php - 使用 SVN 对 PHP 站点进行版本控制的最佳方法是什么？

> ID：117245
> 
> 赞同：11
> 
> 时间：2008-09-22T20:05:55.507
> 
> 标签：php, svn

我一直只是从站点下载文件，编辑它们并在创建站点时将它们备份，但我觉得学习正确地做事是值得的。

我刚刚将所有内容提交到 SVN 存储库，并尝试 ssh 进入服务器并检查标记的构建，以及使用 switch 更新该构建。

一切都很好，但它比我目前的过程慢了很多。

设置这样的东西的最佳方法是什么？我的大部分时间只是错误修复或小改动，而不是大改写，所以我经常更新东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T20:08:27.000

您不一定需要使用 SVN 将文件部署到服务器。继续使用 FTP，只使用 SVN 来获取修订历史。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T21:29:51.997

您应该考虑安装[rsync](http://samba.anu.edu.au/rsync/)以将更改上传到您的服务器。

Rsync 很棒，因为它将您的本地副本与服务器上当前的副本进行比较，然后只发送已更改的文件。

这使您不必记住您更改的每个文件并手动选择它们到 FTP，或者不必再次将整个本地副本上传到服务器（并让 FTP 进行比较）。

Rsync 还允许您在服务器之间同步时排除文件/文件夹（即 .svn/ 文件夹）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T17:38:51.560

我建议您继续使用 Subversion 来跟踪所有更改，甚至是错误修复。当您希望部署到您的生产服务器时，您应该使用 SSH 并调用`svn update`. 这个过程可以使用[Capistrano](http://www.capify.org/)自动执行，这意味着您可以坐在本地机器上调用`cap deploy`-- Capistrano 将通过 SSH 连接到您的服务器并执行 Subversion 更新。省去了很多繁琐的体力劳动。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T20:08:52.443

为了快速更新，我只是`svn update`从服务器运行。

有时为了真正快速的更新，我使用 vim 编辑文件并从服务器提交它们。

这不是很合适，但快速且非常可靠。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T20:18:37.207

如果您想正确执行此操作，则绝对应该考虑设置本地 SVN 存储库。我还强烈建议您设置一个持续集成 (CI) 服务器，例如巡航控制，当您签入 svn 时，它会自动针对您的 PHP 代码运行任何测试。一旦通过测试，您的 CI 服务器也可用于通过 FTP 将您的文件发布到您的主机，只需单击一个按钮即可。

尽管这听起来像是很多工作，但实际上并非如此，而且从长远来看，顺利部署过程的好处将超过其自身的回报。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T20:19:54.913

对于我的项目，我通常有一个回购。在我的笔记本电脑上是工作副本，实时网站是工作副本。我使用本地网络服务器对本地副本进行更改。当一切都经过测试并准备就绪时，我提交更改，然后我 ssh 进入远程服务器并 svn 更新。

我还在这个存储库中保留了一个文件夹，其中包含我对数据库结构所做的任何更改的 sql 文件，并根据它们的修订号进行标记。例如，当我提交修订版 74 并且其中一个表中有几个额外的列时，提交中包含的将是 dbupdates/rev74.sql。这样，在我进行 svn 更新后，我只需要运行我的 sql 文件（mysql db_name -p -u username < dbupdates/rev74.sql）就可以了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T20:22:22.910

如果您想真正使用它，您可以使用构建脚本从 SVN 获取当前版本，然后[编译](http://www.phpcompiler.org/)您的 PHP 代码，然后在成功构建时，自动将更改推送到您的服务器。

这将有助于调试，并可能使您的代码运行得更快。此外，与直接将 PHP 推送到服务器并通过 Firefox 调试相比，养成构建习惯确实改善了我的编码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T20:22:44.157

随着项目的复杂性和开发人员数量的增加，源代码控制的好处显现出来。如果您直接在远程服务器上工作，并且大部分时间只制作快速补丁，那么源代码控制可能不值得您付出努力。

最好，您应该从存储库的本地工作副本工作（这意味着您还应该设置本地服务器）。使用 SVN 作为更新它的唯一方法来处理远程服务器会大大减慢您的速度。话虽如此，从长远来看，使用 SVN（或任何其他源代码控制）将产生许多好处 - 您拥有完整的更改历史，您始终可以确保服务器是最新的（如果您运行更新）如果您将更多开发人员添加到项目中，您可以避免彼此之间代价高昂的源代码覆盖。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:20:02.150

我在工作中所做的是使用 FTP 将更改上传到测试服务器。然后，当我完成我正在处理的网站部分时，我提交更改并更新两者。有时，如果我正在做某事并且我更改了不同目录中的大量文件，我会提交它并更新测试服务器。但我不更新生产服务器。但我是这里唯一的程序员，如果有不止一个程序员，我不建议提交可能有错误的代码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T21:11:59.467

我使用 ZendStudio for Eclipse（当前版本 6.1）。我使用 SVN 来保持我的源代码可用。最初我认为由于提交过程（并输入提交评论），该过程有点慢，并等到它停止。

然而，在得知 Ctrl+Alt+C 提交并选中“始终在后台运行”后，该过程一点也不慢。

另外，我确实在本地运行所有东西，然后只在一段时间后运行 SSH。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T11:57:14.613

我做了一个提交后挂钩来自动更新我的网站。它很快，但你可能会犯错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-15T22:24:17.817

**如果**在 *nix 服务器上**并且**您具有适当的 SSH 访问权限**并且**您有空间保存网站的多个副本，**那么**我发现的最有用的版本控制技术是使用符号链接指向“当前”版本网站。（您仍然可以使用 SVN 对源代码进行版本化——这是一种在服务器上轻松/即时切换网站版本的方法。）

1.  将网络服务器设置为指向 /whatever.com 作为网站的根目录。

2.  有一个像 /website/r1v00 这样的文件夹，您可以将网站文件 FTP 到该文件夹​​，然后创建一个名为“whatever.com”的符号链接，指向 /website/r1v00

3.  当您有更新版本的网站时，创建另一个名为 /website/r1v001 的文件夹，FTP 更新网站的所有文件，然后将“whatever.com”的符号链接更改为现在指向 /website/r1v01。如果新站点有任何问题，您只需将“whatever.com”符号链接指向 /website/r1v00 即可立即退出

当然，您可以/应该设置脚本来自动创建和切换符号链接。就我而言，我有一个用 PHP 编写的“管理”页面，其中列出了所有可用的版本，并允许我切换到其中的任何一个。这种技术救了我好几次培根……！

显然，这并没有解决版本控制数据库模式或数据库内容的任何问题。

# oracle - 在主键填充序列的表中手动插入数据

> ID：117248
> 
> 赞同：1
> 
> 时间：2008-09-22T20:06:08.580
> 
> 标签：oracle, sequences

我有许多表使用触发器/序列列来模拟其主键上的 auto_increment，这已经有一段时间了。

为了加快对使用数据库的软件执行回归测试所需的时间，我使用一些示例数据创建控制文件，并将这些文件的运行添加到构建过程中。

尽管由于测试过程从头开始安装模式，但此更改导致大多数测试崩溃，并且序列正在返回表中已经存在的值。有没有办法以编程方式说“将序列更新为列中的最大值”或者我是否需要手动写出一个完整的脚本来更新所有这些序列，或者我可以/我应该更改用空值替换的触发器吗顺序到一些如何检查这个（虽然我认为这可能会导致变异表问题）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T20:21:59.807

您可以生成一个脚本来创建具有您需要的起始值的序列（基于它们的现有值）......

```
SELECT 'CREATE SEQUENCE '||sequence_name||' START WITH '||last_number||';'
FROM   ALL_SEQUENCES
WHERE  OWNER = your_schema 
```

（如果我正确理解了这个问题）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-27T02:16:54.183

这是更新序列值的简单方法 - 在这种情况下，如果序列当前为 50，则将序列设置为 1000：

```
alter sequence MYSEQUENCE increment by 950 nocache;
select MYSEQUENCE_S.nextval from dual;
alter sequence MYSEQUENCE increment by 1; 
```

感谢 PL/SQL Developer 的创建者将这项技术包含在他们的工具中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T20:11:56.397

作为架构重建的一部分，为什么不删除并重新创建序列？

# python - 在 Python 中使用除法运算符时如何获得十进制值？

> ID：117250
> 
> 赞同：69
> 
> 时间：2008-09-22T20:06:16.723
> 
> 标签：python, python-2.7, math, syntax, operators

例如，标准除法符号“/”四舍五入为零：

```
>>> 4 / 100
0 
```

但是，我希望它返回 0.04。我用什么？

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2008-09-22T20:08:15.377

有三个选项：

```
>>> 4 / float(100)
0.04
>>> 4 / 100.0
0.04 
```

这与 C、C++、Java 等的行为相同，或者

```
>>> from __future__ import division
>>> 4 / 100
0.04 
```

您还可以通过将参数传递`-Qnew`给 Python 解释器来激活此行为：

```
$ python -Qnew
>>> 4 / 100
0.04 
```

第二个选项将是 Python 3.0 中的默认选项。如果要进行旧的整数除法，则必须使用`//`运算符。

**编辑**：添加了关于`-Qnew`ΤZΩΤZΙΟΥ 的[部分](https://stackoverflow.com/users/6899/)！

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-22T21:12:07.003

其他答案建议如何获取浮点值。虽然这将接近您想要的，但它并不准确：

```
>>> 0.4/100.
0.0040000000000000001 
```

如果您实际上想要一个*十进制*值，请执行以下操作：

```
>>> import decimal
>>> decimal.Decimal('4') / decimal.Decimal('100')
Decimal("0.04") 
```

这将为您提供一个正确知道以*10 为底*的 4 / 100是“0.04”的对象。浮点数实际上是以 2 为底的，即二进制，而不是十进制。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-22T20:08:45.907

将其中一项或两项设为浮点数，如下所示：

```
4.0/100.0 
```

或者，打开 Python 3.0 中默认的功能“真正的除法”，它可以满足您的需求。在模块或脚本的顶部，执行以下操作：

```
from __future__ import division 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T21:38:16.113

您可能还想查看 Python 的[十进制](http://docs.python.org/lib/module-decimal.html)包。这将提供很好的十进制结果。

```
>>> decimal.Decimal('4')/100
Decimal("0.04") 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-22T20:07:38.233

您需要告诉 Python 使用浮点值，而不是整数。您可以通过在输入中自己使用小数点来做到这一点：

```
>>> 4/100.0
0.040000000000000001 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T20:07:27.860

一条简单的路线 4 / 100.0

或者

4.0 / 100

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-01-08T06:51:23.963

在这里，我们有以下两种可能的情况

```
from __future__ import division

print(4/100)
print(4//100) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:07:20.090

尝试 4.0/100

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:11:02.360

您不能通过将一个整数除以另一个整数来获得十进制值，您总是会以这种方式获得一个整数（结果被截断为整数）。您至少需要一个值才能成为十进制数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-07-04T08:28:42.617

在代码中添加以下函数及其回调。

```
# Starting of the function
def divide(number_one, number_two, decimal_place = 4):
    quotient = number_one/number_two
    remainder = number_one % number_two
    if remainder != 0:
        quotient_str = str(quotient)
        for loop in range(0, decimal_place):
            if loop == 0:
                quotient_str += "."
            surplus_quotient = (remainder * 10) / number_two
            quotient_str += str(surplus_quotient)
            remainder = (remainder * 10) % number_two
            if remainder == 0:
                break
        return float(quotient_str)
    else:
        return quotient
#Ending of the function

# Calling back the above function
# Structure : divide(<divident>, <divisor>, <decimal place(optional)>)
divide(1, 7, 10) # Output : 0.1428571428
# OR
divide(1, 7) # Output : 0.1428 
```

该功能基于“欧几里得除法算法”工作。如果您不想在项目中导入任何外部头文件，此功能非常有用。

语法：divide([divident], [divisor], [decimal place(optional))

代码：`divide(1, 7, 10)`或`divide(1, 7)`

如有任何疑问，请在下方评论。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-02-08T23:35:28.573

您也可以尝试在数字末尾添加“.0”。

4.0/100.0

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-12-02T21:07:29.007

它只是去掉小数点后的小数部分。你试过吗：4.0 / 100

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2018-02-22T10:15:37.623

从未来的库中导入部门，如下所示：

```
from__future__ import division 
```

# postgresql - PostgreSQL 解释到底告诉我什么？

> ID：117262
> 
> 赞同：131
> 
> 时间：2008-09-22T20:08:10.713
> 
> 标签：postgresql

MySQL 的解释输出非常简单。PostgreSQL 有点复杂。我也找不到解释它的好资源。

你能描述一下确切的解释是什么，或者至少给我指出一个好的资源的方向吗？

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2016-02-19T17:10:57.830

我总是感到困惑的部分是启动成本与总成本。每次我忘记它时，我都会谷歌一下，这让我回到了这里，这并不能解释其中的区别，这就是我写这个答案的原因。这是我从[Postgres`EXPLAIN`文档](http://www.postgresql.org/docs/current/interactive/using-explain.html)中收集到的内容，**根据我的理解进行了解释。**

以下是管理论坛的应用程序的示例：

```
EXPLAIN SELECT * FROM post LIMIT 50;

Limit  (cost=0.00..3.39 rows=50 width=422)
  ->  Seq Scan on post  (cost=0.00..15629.12 rows=230412 width=422) 
```

以下是 PgAdmin 的图形解释：

[![第一个查询的图形解释](https://i.stack.imgur.com/bZX5x.png)](https://i.stack.imgur.com/bZX5x.png)

*（当您使用 PgAdmin 时，您可以将鼠标指向某个组件以阅读成本详细信息。）*

成本表示为一个元组，例如`LIMIT`is`cost=0.00..3.39`的成本和顺序扫描的成本`post`是`cost=0.00..15629.12`。元组中的第一个数字是*启动成本*，第二个数字是*总成本*。因为我使用`EXPLAIN`而不是`EXPLAIN ANALYZE`，这些成本是估计值，而不是实际测量值。

*   *启动成本*是一个棘手的概念。它不仅仅代表该组件*开始*之前的时间量。它表示从组件开始执行（读取数据）**到组件输出其第一行**之间的时间量。
*   *总成本*是组件的整个执行时间，从开始读取数据到完成写入输出。

复杂的是，每个“父”节点的成本包括其子节点的成本。在文本表示中，树由缩进表示，例如`LIMIT`是父节点并且`Seq Scan`是其子节点。在 PgAdmin 表示中，箭头从子节点指向父节点——数据流的方向——如果你熟悉图论，这可能是违反直觉的。

文档说成本包括所有子节点，但请注意，父节点的总成本`3.39`远小于其子节点的总成本`15629.12`。总成本不包括在内，因为像这样的组件`LIMIT`不需要处理其全部输入。请参阅[Postgres](http://www.postgresql.org/docs/current/interactive/using-explain.html)[文档](http://www.postgresql.org/docs/current/interactive/using-explain.html)`EXPLAIN SELECT * FROM tenk1 WHERE unique1 < 100 AND unique2 > 9000 LIMIT 2;`中的示例。[`EXPLAIN`](http://www.postgresql.org/docs/current/interactive/using-explain.html)

在上面的示例中，两个组件的启动时间都为零，因为两个组件都不需要在开始写入行之前进行任何处理：顺序扫描读取表的第一行并将其发出。读取它的`LIMIT`第一行，然后发出它。

组件何时需要进行大量处理才能开始输出任何行？有很多可能的原因，但让我们看一个明显的例子。这是之前的相同查询，但现在包含一个`ORDER BY`子句：

```
EXPLAIN SELECT * FROM post ORDER BY body LIMIT 50;

Limit  (cost=23283.24..23283.37 rows=50 width=422)
  ->  Sort  (cost=23283.24..23859.27 rows=230412 width=422)
        Sort Key: body
        ->  Seq Scan on post  (cost=0.00..15629.12 rows=230412 width=422) 
```

并以图形方式：

[![第二个查询的图形解释](https://i.stack.imgur.com/rJZ34.png)](https://i.stack.imgur.com/rJZ34.png)

再一次，顺序扫描`post`没有启动成本：它立即开始输出行。但是排序的启动成本很高`23283.24`，因为它必须先*对整个表进行排序，然后才能输出单行*。排序的总成本`23859.27`仅略高于启动成本，这反映了一个事实，即一旦对整个数据集进行了排序，排序后的数据就可以非常快速地发出。

请注意， 的启动时间`LIMIT` `23283.24`恰好等于排序的启动时间。这并不是因为`LIMIT`它本身具有很高的启动时间。它本身实际上具有零启动时间，但`EXPLAIN`汇总了每个父项的所有子项成本，因此`LIMIT`启动时间包括其子项的总启动时间。

这种成本汇总可能会导致难以理解每个单独组件的执行成本。例如，我们的`LIMIT`启动时间为零，但乍一看并不明显。出于这个原因，其他几个人链接到了[explain.depesz.com](http://explain.depesz.com/)，这是一个由 Hubert Lubaczewski（又名 depesz）创建的工具，它`EXPLAIN`通过从父母成本中减去孩子成本来帮助理解。他在一篇关于他的工具[的简短博客文章](http://www.depesz.com/2008/12/04/explaindepeszcom/)中提到了其他一些复杂性。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-23T15:48:04.463

[Explaining_EXPLAIN.pdf](http://wiki.postgresql.org/wiki/Image:Explaining_EXPLAIN.pdf)也可以提供帮助。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-09-22T22:59:21.567

它从最缩进到最不缩进执行，我相信从计划的底部到顶部。（因此，如果有两个缩进部分，页面下方的一个首先执行，然后当它们遇到另一个时执行，然后执行连接它们的规则。）

这个想法是，在每一步都有 1 或 2 个数据集到达并通过某种规则进行处理。如果只有一个数据集，则对该数据集执行该操作。（例如，扫描索引以找出您想要的行、过滤数据集或对其进行排序。）如果有两个，则这两个数据集是进一步缩进的两个东西，它们由您看到的规则连接。大多数规则的含义可以相当容易地猜到（特别是如果您以前阅读过一堆解释计划），但是您可以尝试通过查看文档或（更容易）将短语放入来验证单个项目谷歌连同一些关键字，如`EXPLAIN`.

这显然不是一个完整的解释，但它提供了足够的上下文，您通常可以找出您想要的任何内容。例如，考虑来自实际数据库的这个计划：

```
explain analyze
select a.attributeid, a.attributevalue, b.productid
from orderitemattribute a, orderitem b
where a.orderid = b.orderid
and a.attributeid = 'display-album'
and b.productid = 'ModernBook';

------------------------------------------------------------------------------------------------------------------------------------------------------------

 Merge Join  (cost=125379.14..125775.12 rows=3311 width=29) (actual time=841.478..841.478 rows=0 loops=1)
   Merge Cond: (a.orderid = b.orderid)
   ->  Sort  (cost=109737.32..109881.89 rows=57828 width=23) (actual time=736.163..774.475 rows=16815 loops=1)
         Sort Key: a.orderid
         Sort Method:  quicksort  Memory: 1695kB
         ->  Bitmap Heap Scan on orderitemattribute a  (cost=1286.88..105163.27 rows=57828 width=23) (actual time=41.536..612.731 rows=16815 loops=1)
               Recheck Cond: ((attributeid)::text = 'display-album'::text)
               ->  Bitmap Index Scan on (cost=0.00..1272.43 rows=57828 width=0) (actual time=25.033..25.033 rows=16815 loops=1)
                     Index Cond: ((attributeid)::text = 'display-album'::text)
   ->  Sort  (cost=15641.81..15678.73 rows=14769 width=14) (actual time=14.471..16.898 rows=1109 loops=1)
         Sort Key: b.orderid
         Sort Method:  quicksort  Memory: 76kB
         ->  Bitmap Heap Scan on orderitem b  (cost=310.96..14619.03 rows=14769 width=14) (actual time=1.865..8.480 rows=1114 loops=1)
               Recheck Cond: ((productid)::text = 'ModernBook'::text)
               ->  Bitmap Index Scan on id_orderitem_productid  (cost=0.00..307.27 rows=14769 width=0) (actual time=1.431..1.431 rows=1114 loops=1)
                     Index Cond: ((productid)::text = 'ModernBook'::text)
 Total runtime: 842.134 ms
(17 rows) 
```

尝试自己阅读它，看看它是否有意义。

我读到的是数据库首先扫描`id_orderitem_productid`索引，使用它来查找它想要的行`orderitem`，然后使用快速排序对该数据集进行排序（如果数据不适合 RAM，则使用的排序将改变），然后将其放在一边。

接下来，它扫描`orditematt_attributeid_idx`以找到它想要的行`orderitemattribute`，然后使用快速排序对该数据集进行排序。

然后它获取两个数据集并将它们合并。（合并连接是一种“压缩”操作，它并行遍历两个排序的数据集，当它们匹配时发出连接的行。）

正如我所说，您从内部到外部，从下到上进行计划。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-24T10:47:15.443

还有一个可用的在线帮助工具[Depesz](http://www.depesz.com/)，它将突出显示分析结果中昂贵部分的位置。

也有一个，这是[相同的结果](http://explain.depesz.com/s/DN)，这对我来说更清楚问题出在哪里。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-23T17:39:43.837

[PgAdmin](http://www.pgadmin.org/)将向您显示解释计划的图形表示。在两者之间来回切换确实可以帮助您理解文本表示的含义。但是，如果您只是想知道它要做什么，您也许可以一直使用 GUI。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-03-18T00:09:42.547

[PostgreSQL 的官方文档](http://www.postgresql.org/docs/current/interactive/using-explain.html)对如何理解 explain 的输出提供了一个有趣的、详尽的解释。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T13:15:58.837

如果你安装了 pgadmin，会有一个解释按钮，除了给出文本输出之外，还可以绘制正在发生的事情的图表，显示过滤器、排序和子集合并，我发现这些对于查看正在发生的事情非常有用。

# c++ - 对函数参数使用“const”

> ID：117293
> 
> 赞同：474
> 
> 时间：2008-09-22T20:11:47.177
> 
> 标签：c++, constants

你走多远`const`？您只是`const`在必要时制作函数，还是全力以赴并在任何地方使用它？例如，想象一个简单的 mutator，它接受一个布尔参数：

```
void SetValue(const bool b) { my_val_ = b; } 
```

这`const`真的有用吗？我个人选择广泛使用它，包括参数，但在这种情况下，我想知道它是否值得？

我还惊讶地发现，您可以`const`在函数声明中省略参数，但可以将其包含在函数定义中，例如：

**.h 文件**

```
void func(int n, long l); 
```

**.cpp 文件**

```
void func(const int n, const long l) 
```

是否有一个原因？这对我来说似乎有点不寻常。

* * *

## 回答 #1

> 赞同：478
> 
> 时间：2008-09-22T20:51:03.760

> *`const`当参数按值传递时是没有意义的，因为您不会修改调用者的对象。*

错误的。

这是关于自我记录你的代码和你的假设。

如果您的代码有很多人在处理它并且您的功能不平凡，那么您应该标记`const`所有可以标记的内容。在编写工业级代码时，您应该始终假设您的同事是精神病患者，他们试图以任何方式得到您（尤其是因为将来通常是您自己）。

此外，正如前面有人提到的，它*可能会*帮助编译器优化一些东西（尽管它是一个很长的镜头）。

* * *

## 回答 #2

> 赞同：223
> 
> 时间：2008-09-22T20:15:12.630

原因是`const`该参数仅在函数内本地应用，因为它正在处理数据的副本。这意味着函数签名无论如何都是一样的。不过，经常这样做可能是不好的风格。

我个人倾向于不使用`const`除了引用和指针参数。对于复制的对象，这并不重要，尽管它可以更安全，因为它在函数内发出意图信号。这真的是一个判断电话。尽管在循环某些东西时我确实倾向于使用，`const_iterator`但我不打算修改它，所以我猜每个人都是他自己的，只要`const`严格维护引用类型的正确性。

* * *

## 回答 #3

> 赞同：171
> 
> 时间：2008-09-22T22:00:23.173

有时（太频繁了！）我必须解开别人的 C++ 代码。而且我们都知道，根据定义，*其他人的*C++ 代码几乎是一团糟 :) 所以我破译本地数据流的第一件事就是将**const**放入每个变量定义中，直到编译器开始咆哮。这也意味着 const 限定值参数，因为它们只是由调用者初始化的花哨的局部变量。

啊，我希望变量默认为**const而非 const 变量需要****可变**:)

* * *

## 回答 #4

> 赞同：91
> 
> 时间：2008-09-22T20:36:58.863

以下两行在功能上是等效的：

```
int foo (int a);
int foo (const int a); 
```

显然，如果它是第二种方式定义的，您将无法`a`在主体中进行修改`foo`，但与外部没有区别。

真正派上`const`用场的是引用或指针参数：

```
int foo (const BigStruct &a);
int foo (const BigStruct *a); 
```

这说明 foo 可以采用一个大参数，也许是一个千兆字节大小的数据结构，而无需复制它。此外，它对调用者说：“Foo 不会* 更改该参数的内容。” 传递 const 引用还允许编译器做出某些性能决策。

*：除非它抛弃了 const-ness，但那是另一篇文章。

* * *

## 回答 #5

> 赞同：84
> 
> 时间：2012-06-14T15:26:34.767

从 API 的角度来看，多余的 const 是不好的：

在代码中为按值传递的内在类型参数添加多余的 const会使**您的 API 混乱**，同时对调用者或 API 用户没有任何有意义的承诺（它只会妨碍实现）。

API 中不需要的太多“const”就像“**狼**来了”，最终人们会开始忽略“const”，因为它无处不在，而且大多数时候没有任何意义。

API 中额外 const 的“reductio ad absurdum”参数对于前两点是好的，如果更多的 const 参数是好的，那么每个可以有 const 的参数都应该有 const。事实上，如果它真的那么好，你会希望 const 成为参数的默认值，并且只有在你想更改参数时才有像“mutable”这样的关键字。

因此，让我们尽可能地尝试放入 const ：

```
void mungerum(char * buffer, const char * mask, int count);

void mungerum(char * const buffer, const char * const mask, const int count); 
```

考虑上面的代码行。不仅声明更混乱、更长、更难阅读，而且 API 用户可以安全地忽略四个“const”关键字中的三个。然而，'const' 的额外使用使得第二行可能很**危险！**

为什么？

对第一个参数的快速误读`char * const buffer`可能会让您认为它不会修改传入的数据缓冲区中的内存——然而，事实并非如此！当快速扫描或误读时**，多余的 'const' 可能会导致对 API 的危险和错误假设。**

* * *

从代码实现的角度来看，多余的 const 也是不好的：

```
#if FLEXIBLE_IMPLEMENTATION
       #define SUPERFLUOUS_CONST
#else
       #define SUPERFLUOUS_CONST             const
#endif

void bytecopy(char * SUPERFLUOUS_CONST dest,
   const char *source, SUPERFLUOUS_CONST int count); 
```

如果 FLEXIBLE_IMPLEMENTATION 不为真，那么 API “承诺”不会以下面的第一种方式实现该功能。

```
void bytecopy(char * SUPERFLUOUS_CONST dest,
   const char *source, SUPERFLUOUS_CONST int count)
{
       // Will break if !FLEXIBLE_IMPLEMENTATION
       while(count--)
       {
              *dest++=*source++;
       }
}

void bytecopy(char * SUPERFLUOUS_CONST dest,
   const char *source, SUPERFLUOUS_CONST int count)
{
       for(int i=0;i<count;i++)
       {
              dest[i]=source[i];
       }
} 
```

这是一个非常愚蠢的承诺。为什么你要做出一个对你的调用者没有任何好处并且只会限制你的实现的承诺？

尽管这两者都是相同功能的完全有效的实现，但您所做的只是将一只手不必要地绑在背后。

此外，这是一个很容易（并且在法律上被规避）的非常肤浅的承诺。

```
inline void bytecopyWrapped(char * dest,
   const char *source, int count)
{
       while(count--)
       {
              *dest++=*source++;
       }
}
void bytecopy(char * SUPERFLUOUS_CONST dest,
   const char *source,SUPERFLUOUS_CONST int count)
{
    bytecopyWrapped(dest, source, count);
} 
```

看，尽管我承诺不这样做，但我还是以这种方式实现了它——只是使用了一个包装函数。这就像当坏人在电影中承诺不杀人并命令他的心腹杀死他们时一样。

那些多余的 const 只值一个电影坏蛋的承诺。

* * *

但是说谎的能力变得更糟了：

我已经了解到，您可以通过使用虚假 const 使标头（声明）和代码（定义）中的 const 不匹配。const-happy 的拥护者声称这是一件好事，因为它允许您仅将 const 放在定义中。

```
// Example of const only in definition, not declaration
struct foo { void test(int *pi); };
void foo::test(int * const pi) { } 
```

但是，反之亦然……您只能在声明中放置虚假的 const 并在定义中忽略它。这只会使 API 中多余的 const 变得更加可怕，而且是可怕的谎言——请看这个例子：

```
struct foo
{
    void test(int * const pi);
};

void foo::test(int *pi) // Look, the const in the definition is so superfluous I can ignore it here
{
    pi++;  // I promised in my definition I wouldn't modify this
} 
```

* * *

所有多余的 const 实际上所做的只是通过强制实现者在想要更改变量或通过非 const 引用传递变量时使用另一个本地副本或包装函数来降低实现者的代码的可读性。

看看这个例子。哪个更具可读性？很明显，第二个函数中额外变量的唯一原因是因为某些 API 设计人员投入了多余的 const 吗？

```
struct llist
{
    llist * next;
};

void walkllist(llist *plist)
{
    llist *pnext;
    while(plist)
    {
        pnext=plist->next;
        walk(plist);
        plist=pnext;    // This line wouldn't compile if plist was const
    }
}

void walkllist(llist * SUPERFLUOUS_CONST plist)
{
    llist * pnotconst=plist;
    llist *pnext;
    while(pnotconst)
    {
        pnext=pnotconst->next;
        walk(pnotconst);
        pnotconst=pnext;
    }
} 
```

* * *

希望我们在这里学到了一些东西。多余的 const 是一个 API 杂乱无章的讨厌东西，一个烦人的唠叨，一个肤浅而毫无意义的承诺，一个不必要的障碍，并且偶尔会导致非常危险的错误。

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2008-09-23T11:43:18.390

const 应该是 C++ 中的默认值。像这样 ：

```
int i = 5 ; // i is a constant

var int i = 5 ; // i is a real variable 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2008-09-22T22:07:09.443

当我以编写 C++ 为生时，我尽我所能。使用 const 是帮助编译器帮助您的好方法。例如，对您的方法返回值进行 const-ing 可以使您免于打字错误，例如：

```
foo() = 42 
```

当你的意思是：

```
foo() == 42 
```

如果 foo() 被定义为返回一个非常量引用：

```
int& foo() { /* ... */ } 
```

编译器很乐意让你为函数调用返回的匿名临时赋值。使其成为常量：

```
const int& foo() { /* ... */ } 
```

消除了这种可能性。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2009-05-04T22:21:53.857

[在 comp.lang.c++.moderated here](http://tinyurl.com/d7a8ds)上的旧“本周大师”文章中对此主题进行了很好的讨论。

相应的 GOTW 文章可在 Herb Sutter 的网站上[找到](http://www.gotw.ca/gotw/006.htm)。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2020-03-23T23:33:47.380

## 1\. 基于我的评估的最佳答案：

根据我的评估[，@Adisak的答案是这里的最佳答案。](https://stackoverflow.com/questions/117293/use-of-const-for-function-parameters/11036371#11036371)请注意，这个答案部分是最好的，因为*除了使用合理且经过深思熟虑的逻辑之外，*它也是**最可靠*的真实代码示例支持。***

 *## 2.我自己的话（同意最佳答案）：

1.  对于按值传递，添加`const`. 它所做的只是：
    1.  限制实现者每次想要更改源代码中的输入参数时都必须制作副本（这种更改无论如何都不会产生副作用，因为传入的内容已经是副本，因为它是按值传递的）。并且经常使用更改按值传递的输入参数来实现该功能，因此`const`到处添加可能会阻碍这一点。
    2.  添加`const`不必要的`const`s 会使代码到处乱七八糟，将注意力从`const`真正需要安全代码的 s 上转移开。
2.  但是，在处理*指针*或*引用*`const`时，在需要时非常重要，并且*必须使用，因为它可以防止函数**外部*持续更改带来的不良副作用，因此当参数仅作为输入时，每个指针或引用都*必须*使用，`const`不是输出。`const` *仅对*通过引用或指针传递的参数使用还有一个额外的好处，那就是让哪些参数是指针或引用*非常明显。*伸出手说“小心！`const`旁边的任何参数都是引用或指针！”是另一回事。
3.  我上面所描述的经常是在我工作过的专业软件组织中达成的共识，并且被认为是最佳实践。有时，规则甚至是严格的：**“永远不要对按值传递的参数使用 const，但如果它们只是输入，则始终对通过引用或指针传递的参数使用它。”**

## 3.[谷歌的话](https://google.github.io/styleguide/cppguide.html)（同意我的最佳答案）：

（来自“[谷歌 C++ 风格指南](https://google.github.io/styleguide/cppguide.html#Use_of_const)”）

> 对于按值传递的函数参数，const 对调用者没有影响，因此不建议在函数声明中使用。参见[TotW #109](https://abseil.io/tips/109)。

> 既不鼓励也不鼓励对局部变量使用 const。

来源：Google C++ 样式指南的“使用 const”部分：[https](https://google.github.io/styleguide/cppguide.html#Use_of_const) ://google.github.io/styleguide/cppguide.html#Use_of_const 。这实际上是一个非常有价值的部分，因此请阅读整个部分。

请注意，“TotW #109”代表[“Tip of the Week #109: Meaningful `const`in Function Declarations”](https://abseil.io/tips/109)，也是一本有用的读物​​。它提供的信息更多，规定性更少，并且基于上下文出现*在*`const`上面引用的 Google C++ 样式指南规则之前，但由于它提供的清晰性，`const`上面引用的规则被添加到 Google C++时尚指南。

另请注意，即使我在此处引用 Google C++ 样式指南来捍卫我的立场，但这并不意味着我始终遵循指南或始终建议遵循指南。他们推荐的一些东西很奇怪，例如[他们的`kDaysInAWeek`风格命名约定 "Constant Names"](https://google.github.io/styleguide/cppguide.html#Constant_Names)。*然而，当世界上最成功和最有影响力的技术和软件公司之一使用与我和@Adisak 等其他人一样的理由来支持我们在这个问题上的观点时，指出它仍然是有用和相关的。*

## 4\. Clang 的 linter`clang-tidy`有一些选项：

A. 还值得注意的是，Clang 的 linter`clang-tidy`有一个选项，`readability-avoid-const-params-in-decls`在[此处描述](https://clang.llvm.org/extra/clang-tidy/checks/readability-avoid-const-params-in-decls.html)，以支持**在代码库中强制执行*不*使用`const`传递值函数参数**：

> 检查函数声明是否具有顶级 const 参数。

> 声明中的 const 值不会影响函数的签名，因此不应将它们放在那里。

> 例子：

> ```
> void f(const string);   // Bad: const is top level.
> void f(const string&);  // Good: const is not top level. 
> ```

为了完整和清晰，我添加了另外两个示例：

```
void f(char * const c_string);   // Bad: const is top level. [This makes the _pointer itself_, NOT what it points to, const]
void f(const char * c_string);   // Good: const is not top level. [This makes what is being _pointed to_ const] 
```

B. 它也有这个选项：`readability-const-return-type`- [https://clang.llvm.org/extra/clang-tidy/checks/readability-const-return-type.html](https://clang.llvm.org/extra/clang-tidy/checks/readability-const-return-type.html)

## 5\. 我对此事的风格指南措辞的务实方法：

我只需将其复制并粘贴到我的样式指南中：

[复制/粘贴开始]

1.  **`const`当它们的内容（它们指向的内容）不打算更改时，**始终使用通过引用或指针传递的函数参数。**这样，当一个通过引用或指针传递的变量被期望被改变时，它就变得很明显了，因为它会缺少`const`. 在这个用例`const`中，可以防止函数之外的意外副作用。**
***   不**建议**在函数参数上使用`const`值传递，因为`const`对调用者没有影响：即使在函数中改变了变量也不会在函数外产生副作用。有关其他理由和见解，请参阅以下资源：
    1.  [“Google C++ 风格指南”“const 的使用”部分](https://google.github.io/styleguide/cppguide.html#Use_of_const)
    2.  [“本周提示 #109：`const`函数声明中的意义”](https://abseil.io/tips/109)
    3.  [Adisak 的 Stack Overflow 上关于“函数参数使用 'const' 的答案”](https://stackoverflow.com/questions/117293/use-of-const-for-function-parameters/11036371#11036371)*   "永远不要在*不是定义的声明中*对函数参数**使用**顶级`const`[即：`const`按*值传递的参数*] （并注意不要复制/粘贴无意义的）。它是无意义的，编译器会忽略它，这是视觉噪音，它可能会误导读者”（[https://abseil.io/tips/109](https://abseil.io/tips/109)，强调补充）。*`const`***   唯一`const`对编译有影响的限定符是那些放在函数定义中的限定符，而不是那些在函数的前向声明中的限定符，例如在头文件中的函数（方法）声明中。*   ***永远不要在函数返回的值上***使用**顶级`const`[ie: `const`on variables *passed by value* ] 。******   使用`const`函数返回的指针或引用**取决于实现者**，因为它有时很有用。*   TODO：使用以下`clang-tidy`选项强制执行上述某些操作：*   [https://clang.llvm.org/extra/clang-tidy/checks/readability-avoid-const-params-in-decls.html](https://clang.llvm.org/extra/clang-tidy/checks/readability-avoid-const-params-in-decls.html)*   [https://clang.llvm.org/extra/clang-tidy/checks/readability-const-return-type.html](https://clang.llvm.org/extra/clang-tidy/checks/readability-const-return-type.html)******

 ******下面是一些代码示例来演示上述`const`规则：

**`const`参数示例：（**
有些是从[这里](https://clang.llvm.org/extra/clang-tidy/checks/readability-avoid-const-params-in-decls.html)借来的）

```
void f(const std::string);   // Bad: const is top level.
void f(const std::string&);  // Good: const is not top level.

void f(char * const c_string);   // Bad: const is top level. [This makes the _pointer itself_, NOT what it points to, const]
void f(const char * c_string);   // Good: const is not top level. [This makes what is being _pointed to_ const] 
```

**`const`返回类型示例：（**
有些是从[这里](https://clang.llvm.org/extra/clang-tidy/checks/readability-const-return-type.html)借来的）

```
// BAD--do not do this:
const int foo();
const Clazz foo();
Clazz *const foo();

// OK--up to the implementer:
const int* foo();
const int& foo();
const Clazz* foo(); 
```

[复制/粘贴结束]

[关键词：`const`函数参数的使用；编码标准；C 和 C++ 编码标准；编码指南；最佳实践；代码标准；常量返回值]

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-09-22T20:15:24.767

我在作为引用（或指针）的函数参数上使用 const，这些引用（或指针）只是 [in] 数据并且不会被函数修改。意思是，当使用引用的目的是避免复制数据并且不允许更改传递的参数时。

在您的示例中将 const 放在布尔 b 参数上只会对实现施加约束，并且不会为类的接口做出贡献（尽管通常建议不要更改参数）。

函数签名为

```
void foo(int a); 
```

和

```
void foo(const int a); 
```

是一样的，这解释了你的 .c 和 .h

阿萨夫

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2008-11-14T13:38:17.597

我说 const 你的值参数。

考虑这个错误的功能：

```
bool isZero(int number)
{
  if (number = 0)  // whoops, should be number == 0
    return true;
  else
    return false;
} 
```

如果 number 参数是 const，编译器将停止并警告我们该错误。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2012-07-24T00:45:03.683

### 如果您使用`->*`or`.*`运算符，这是必须的。

它会阻止你写类似的东西

```
void foo(Bar *p) { if (++p->*member > 0) { ... } } 
```

我几乎现在就这样做了，这可能不会像你想要的那样。

我想说的是

```
void foo(Bar *p) { if (++(p->*member) > 0) { ... } } 
```

如果我在and`const`之间放了一个，编译器会告诉我的。`Bar *``p`

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-22T20:18:31.420

啊，一个艰难的。一方面，声明是一种契约，按值传递 const 参数确实没有意义。另一方面，如果您查看函数实现，如果您声明一个参数常量，就会给编译器更多优化的机会。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-09-22T20:40:11.167

当参数按值传递时， const 毫无意义，因为您不会修改调用者的对象。

通过引用传递时应该首选 const，除非函数的目的是修改传递的值。

最后，不修改当前对象 (this) 的函数可以并且可能应该声明为 const。下面是一个例子：

```
int SomeClass::GetValue() const {return m_internalValue;} 
```

这是一个不修改应用此调用的对象的承诺。换句话说，您可以调用：

```
const SomeClass* pSomeClass;
pSomeClass->GetValue(); 
```

如果函数不是 const，这将导致编译器警告。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-09-22T22:58:07.060

标记值参数'const'绝对是一个主观的事情。

但是，我实际上更喜欢将值参数标记为 const，就像在您的示例中一样。

```
void func(const int n, const long l) { /* ... */ } 
```

对我来说，价值清楚地表明函数参数值永远不会被函数改变。它们在开始时和结束时将具有相同的值。对我来说，这是保持非常函数式编程风格的一部分。

对于一个简短的函数，可以说在那里有“const”是浪费时间/空间，因为通常很明显，函数没有修改参数。

但是，对于较大的函数，它是一种实现文档的形式，并且由编译器强制执行。

我可以肯定，如果我用“n”和“l”进行一些计算，我可以重构/移动该计算，而不必担心得到不同的结果，因为我错过了一个或两个都被改变的地方。

由于它是一个实现细节，因此您不需要在标头中声明值参数 const，就像您不需要声明与实现使用的名称相同的函数参数一样。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2015-04-03T21:21:34.743

可能这不是一个有效的论点。但是如果我们在函数编译器中增加一个 const 变量的值，将会给我们一个错误：“ **error: increment of read-only parameter** ”。所以这意味着我们可以使用 const 关键字来防止意外修改函数内部的变量（我们不应该/只读）。所以如果我们在编译时不小心做了，编译器会让我们知道。如果您不是唯一从事此项目的人，这一点尤其重要。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-22T20:36:13.377

我倾向于尽可能使用 const 。（或目标语言的其他适当关键字。）我这样做纯粹是因为它允许编译器进行额外的优化，否则它无法进行。因为我不知道这些优化可能是什么，所以我总是这样做，即使它看起来很傻。

据我所知，编译器很可能会看到一个 const value 参数，然后说：“嘿，这个函数无论如何都不会修改它，所以我可以通过引用传递并节省一些时钟周期。” 我不认为它会做这样的事情，因为它改变了函数签名，但它说明了这一点。也许它做了一些不同的堆栈操作或其他什么......关键是，我不知道，但我知道试图比编译器更聪明只会让我感到羞耻。

C++ 有一些额外的包袱，带有 const-correctness 的想法，所以它变得更加重要。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-09-22T20:17:14.527

在您提到的情况下，它不会影响您的 API 的调用者，这就是为什么通常不这样做（并且在标题中没有必要）。它只会影响你的函数的实现。

这并不是一件特别糟糕的事情，但是考虑到它不会影响您的 API，并且它增加了类型，因此它的好处并不是那么好，因此通常不会这样做。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-09-22T20:22:42.097

我可以使用 const 。参数的 const 意味着它们不应该改变它们的值。这在通过引用传递时特别有价值。const for function 声明该函数不应更改类成员。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-09-22T20:24:43.013

我不将 const 用于传递值的参数。调用者不在乎你是否修改参数，这是一个实现细节。

真正重要的是如果方法不修改其实例，则将它们标记为 const。边做边做，否则你可能会得到很多 const_cast<> 或者你可能会发现标记一个方法 const 需要更改很多代码，因为它调用了其他应该标记为 const 的方法。

如果我不需要修改本地变量，我也倾向于标记它们。我相信它通过更容易识别“移动部件”使代码更容易理解。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-05-05T21:53:39.297

关于编译器优化：[http ://www.gotw.ca/gotw/081.htm](http://www.gotw.ca/gotw/081.htm)

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2017-07-26T09:36:52.503

总结一下：

*   “通常 const 传递值是无用的，充其量是误导性的。” 从[GOTW006](http://www.gotw.ca/gotw/006.htm)
*   但是您可以像处理变量一样将它们添加到 .cpp 中。
*   请注意，标准库不使用 const。例如`std::vector::at(size_type pos)`。对标准库足够好的东西对我也有好处。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-22T20:27:59.043

如果参数是按值传递的（并且不是引用），通常参数是否声明为 const 并没有太大区别（除非它包含引用成员——对于内置类型来说不是问题）。如果参数是引用或指针，通常最好保护引用/指向的内存，而不是指针本身（我认为您不能将引用本身设为 const，这并不重要，因为您不能更改裁判） . 保护一切你可以作为 const 的东西似乎是个好主意。如果参数只是 POD（包括内置类型）并且它们没有机会沿着道路进一步更改（例如，在您的示例中为 bool 参数），您可以省略它而不必担心出错。

我不知道 .h/.cpp 文件声明的区别，但它确实有些道理。在机器代码级别，没有什么是“const”，因此如果将函数（在 .h 中）声明为非 const，则代码与将其声明为 const 相同（抛开优化）。但是，它可以帮助您让编译器知道您不会在函数 (.ccp) 的实现中更改变量的值。当您从允许更改的接口继承时，它可能会派上用场，但您不需要更改参数来实现所需的功能。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-22T20:17:44.027

我不会把 const 放在这样的参数上——每个人都已经知道布尔值（而不是布尔值&）是常数，所以添加它会让人们认为“等等，什么？” 甚至是您通过引用传递参数。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-22T20:18:00.347

使用 const 要记住的一点是，从一开始就将其设为 const 比稍后尝试将它们放入要容易得多。

当您希望某些内容保持不变时，请使用 const - 它是一个附加提示，描述了您的函数的作用和期望。我见过很多可以处理其中一些的 C API，尤其是那些接受 c-strings 的 API！

我更倾向于在 cpp 文件中省略 const 关键字而不是标题，但由于我倾向于剪切+粘贴它们，它们将被保留在两个地方。我不知道为什么编译器允许这样做，我猜它是编译器的事情。最佳实践绝对是将您的 const 关键字放在两个文件中。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-22T20:18:54.383

您示例中的所有 const 都没有任何用途。默认情况下，C++ 是按值传递的，因此该函数获取这些整数和布尔值的副本。即使函数确实修改了它们，调用者的副本也不受影响。

所以我会避免额外的常量，因为

*   他们是多余的
*   他们把文本弄得乱七八糟
*   它们阻止我在可能有用或有效的情况下更改传入的值。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-23T11:37:48.497

由于参数是按值传递的，从调用函数的角度来看，是否指定 const 没有任何区别。将按值传递参数声明为 const 基本上没有任何意义。

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2008-09-22T20:19:35.553

确实没有理由将值参数设为“const”，因为该函数无论如何只能修改变量的副本。

使用“const”的原因是如果你通过引用传递更大的东西（例如一个有很多成员的结构），在这种情况下它确保函数不能修改它；或者更确切地说，如果您尝试以传统方式修改它，编译器会抱怨。它可以防止它被意外修改。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2008-09-22T20:27:49.400

const 参数仅在参数通过引用（即引用或指针）传递时才有用。当编译器看到一个 const 参数时，它会确保参数中使用的变量在函数体中没有被修改。为什么有人想将按值参数设为常量？:-)

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2015-04-08T09:14:41.037

我知道这个问题“有点”过时了，但是当我遇到它时，其他人将来也可能会这样做......我仍然怀疑这个可怜的家伙会在这里列出来阅读我的评论:)

在我看来，我们仍然过于局限于 C 风格的思维方式。在 OOP 范式中，我们玩弄的是对象，而不是类型。const 对象在概念上可能与非常量对象不同，特别是在逻辑常量的意义上（与按位常量相反）。因此，即使函数参数的 const 正确性（可能）在 POD 的情况下过于谨慎，但在对象的情况下并非如此。如果一个函数与一个 const 对象一起工作，它应该这样说。考虑以下代码片段

```
#include <iostream>

//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
class SharedBuffer {
private:

  int fakeData;

  int const & Get_(int i) const
  {

    std::cout << "Accessing buffer element" << std::endl;
    return fakeData;

  }

public:

  int & operator[](int i)
  {

    Unique();
    return const_cast<int &>(Get_(i));

  }

  int const & operator[](int i) const
  {

    return Get_(i);

  }

  void Unique()
  {

    std::cout << "Making buffer unique (expensive operation)" << std::endl;

  }

};

//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
void NonConstF(SharedBuffer x)
{

  x[0] = 1;

}

//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
void ConstF(const SharedBuffer x)
{

  int q = x[0];

}

//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
int main()
{

  SharedBuffer x;

  NonConstF(x);

  std::cout << std::endl;

  ConstF(x);

  return 0;

} 
```

ps.：您可能会争辩说 (const) 引用在这里更合适，并给您相同的行为。嗯，对。只是给出与我在其他地方看到的不同的图片......

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2017-05-28T14:13:36.293

作为需要使用具有 50 多个公开函数的 C++ 程序以及偶尔使用 const 限定符的 .h 文件的 VB.NET 程序员，很难知道何时使用 ByRef 或 ByVal 访问变量。

当然，程序会通过在您出错的那一行生成异常错误来告诉您，但接下来您需要猜测 2-10 个参数中的哪一个是错误的。

所以现在我有一个令人反感的任务，试图说服开发人员他们应该真正定义他们的变量（在 .h 文件中），以一种允许轻松创建所有 VB.NET 函数定义的自动化方法的方式。然后他们会沾沾自喜地说：“阅读……文档。”

我编写了一个解析 .h 文件并创建所有 Declare Function 命令的 awk 脚本，但没有指示哪些变量是 R/O 还是 R/W，它只完成了一半的工作。

**编辑：**

在另一位用户的鼓励下，我添加了以下内容；

这是（IMO）格式不正确的 .h 条目的示例；

```
typedef int (EE_STDCALL *Do_SomethingPtr)( int smfID, const char* cursor_name, const char* sql ); 
```

我的脚本生成的 VB；

```
 Declare Function Do_Something Lib "SomeOther.DLL" (ByRef smfID As Integer, ByVal cursor_name As String, ByVal sql As String) As Integer 
```

请注意第一个参数上缺少的“const”。没有它，程序（或其他开发人员）就不知道第一个参数应该传递“ByVal”。通过添加“const”，它可以使 .h 文件自我记录，以便使用其他语言的开发人员可以轻松编写工作代码。

# sql - 包含 SQL 索引提示如何影响查询性能？

> ID：117301
> 
> 赞同：5
> 
> 时间：2008-09-22T20:13:39.047
> 
> 标签：sql, sql-server, indexing, hint

假设我在 SQL 2005 数据库中有一个表，其中包含 2,000,000 多条记录和一些索引。在我的查询中使用索引提示有什么好处？在查询中使用索引提示是否有缺点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T20:17:28.897

首先，尝试使用 SQL Profiler 在您的数据库中生成一个活动的 .trc 文件，以便在几个小时内完成正常工作负载。然后使用 SQL Server Management Studio Tools 菜单上的“Database Engine Tuning Advisor”来查看它是否建议了任何可能有益的附加索引、复合索引或覆盖索引。

我从不使用查询提示，主要使用数百万行数据库。它们有时会对性能产生负面影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T20:39:54.707

我相信这里的每个人都指出的关键点是，经过非常仔细的考虑，索引提示的使用可以提高查询的性能，如果且仅当存在多个可用于检索数据的索引时，如果 SQL服务器没有使用正确的。

根据我的经验，我发现需要索引提示并不是很常见，我相信我今天可能有 2-3 个查询正在使用它们……正确的索引创建和数据库优化应该能让你大部分到执行数据库的方式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T20:27:24.753

索引提示只会在您的查询涉及连接表的情况下发挥作用，并且用于连接到另一个表的列与多个索引匹配。在这种情况下，数据库引擎可能会选择使用一个索引来进行连接，并且从调查中您可能会知道，如果它使用另一个索引，则查询将执行得更好。在这种情况下，您提供索引提示，告诉数据库引擎使用哪个索引。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T20:30:38.630

我的经验是，有时您比 SQL Server 更了解您的数据集。在这种情况下，您应该使用查询提示。换句话说：您帮助优化器做出决定。

我曾经构建了一个数据仓库，其中 SQL Server 没有在复杂查询中使用最佳索引。通过在我的查询中给出索引提示，我设法使查询速度提高了大约 100 倍。

仅在分析查询计划后使用它们。如果您认为在使用另一个索引或以不同的顺序使用它们时您的查询可以运行得更快，请给服务器一个提示。

# sharepoint - sharepoint 2007 - 自定义内容类型 - 过滤查找列

> ID：117303
> 
> 赞同：5
> 
> 时间：2008-09-22T20:13:53.867
> 
> 标签：sharepoint, moss, content-type, filtered-lookup

我已经定义了一个自定义内容类型，并且我正在尝试定义一个过滤的查找列。我可以从列表中选择我需要的列，但我找不到任何查询字符串所需格式的示例。我可以通过将“?FilterField1=columnName&FilterValue1=myValue”附加到列表 URL 来手动过滤列表。

在哪里可以找到一些用于过滤查找列的查询字符串示例？

[FilteredLookUp.jpg http://asimilatorul.com/media/so/FilteredLookUp.jpg](http://asimilatorul.com/media/so/FilteredLookUp.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:19:17.767

看看，我不知道这是否对您有帮助： [SharePoint 中的筛选查找列表](http://blog.u2u.info/DottextWeb/patrick/articles/466.aspx)

# specman - Specman 宏与 int_range_list 对象进行集减法

> ID：117312
> 
> 赞同：4
> 
> 时间：2008-09-22T20:15:28.823
> 
> 标签：specman

我使用一堆集合来生成受约束的随机流量，但我希望能够调用一个 Specman 宏来计算集合的补码，其语法如下：

```
COMPLEMENT begin 
   domain=[0..10,24..30],
   complementing_set=[2..3,27..30] 
end 
```

并让它生成：

```
[0..1,4..10,24..26] 
```

每次我需要一个集合的补集时，我都会使用完全填充的列表（例如 {0;1;2;3....} ），然后删除元素，而不是使用 Specman 的内置 int_range_list 对象。而且我还在运行时而不是编译时进行了很多这样的集合计算。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T19:48:45.130

你可以试试这个：

```
var domain: list of int = {0..10, 24..30}; 
var complementing_set: list of int = {2..3, 27..30};
var complement: list of int = domain.all(it in complementing set); 
```

`all`伪方法生成父列表中括号中条件成立的所有元素的子列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-04-10T16:27:09.797

在最近的 Specman 版本中，您可以使用预定义的`set`类型，它正是用于此目的。例如，您可以执行以下操作：

```
var s1: set = [1..5, 10..15];
var s2: set = [4..13];
var s3: set = s1.intersect(s2); 
```

甚至像这样：

```
x: int;
y: int;
........
var s1: set = [x..y];
var s2: set = [1..10];
var s3: set = s1.union(s2); 
```

等等

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-07T08:10:24.210

另一种方法可能是使用 uint，假设您有 500 个可能的值：

```
domain : uint(bits:500);
complement : uint(bits:500);
set : uint(bits:500) = domain & ~complement; 
```

您可以稍后提取索引

```
set_l : list of uint = set[.]].all_indices(it==1); 
```

根据您的域与可能值的比率，此方法可能计算得更快

# algorithm - 寻找共同区块

> ID：117317
> 
> 赞同：4
> 
> 时间：2008-09-22T20:16:38.600
> 
> 标签：algorithm

我有两个包含一些文本（或二进制数据）的文件（f1 和 f2）。
如何快速找到常用块？

例如
f1: ABC DEF
f2: XXABC XEF

输出：

公共块：
长度 4：f1@0 和 f2@2 中的“ABC” 长度 2：f1@5 和 f2@8 中的“EF”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T20:19:36.987

这是一个很好的工具。：http: [//sourceforge.net/projects/duplo/](http://sourceforge.net/projects/duplo/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T20:25:13.247

维基百科有一些[伪代码](http://en.wikipedia.org/wiki/Longest_common_substring_problem)用于查找两个数据序列之间的最长公共子字符串。在您的情况下，您只需从表中提取所有不是其他公共子字符串前缀的公共子字符串（即最大公共子字符串）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T00:29:59.320

开源 PMD 项目有一个剪切和粘贴检测器模块，在此页面上提到：http: [//pmd.sourceforge.net/integrations.html](http://pmd.sourceforge.net/integrations.html)。

# asp.net - ASP.NET 和计时器

> ID：117318
> 
> 赞同：1
> 
> 时间：2008-09-22T20:16:53.717
> 
> 标签：asp.net, multithreading, timer

考虑这段代码...

```
using System.Threading;
//...
Timer someWork = new Timer(
    delegate(object state) {
        //Do some work here...
    },
    null, 0, 60000);

HttpContext.Current.Application["SomeWorkItem"] = someWork; 
```

这会很危险吗？在应用程序中缓存一个计时器以在您的网站运行时在后台执行一些工作似乎是安全的，但我想知道是否有人对此有一些经验。

我确信编写一个在后台运行的服务肯定会好得多，但有时这并不总是一种选择。这是替代方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T20:19:54.460

这样做的问题是您不能保证该过程仍然存在。IIS 基本上会在需要时回收该过程，因此您冒着不执行该过程的风险。

如果您需要完成这项工作，那么您需要将其编码到网络调用中，或者让服务在服务器后台运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T20:26:49.950

这通常是个坏主意，因为 System.Threading.Timer 使用来自 ThreadPool 的线程，与 ASP.Net 相同。

如果由于任何原因您的计时器委托阻塞或停止，计时器将在超时期限后开始一个新线程，这会占用 ASP.net 可用的线程。

如果它们都开始阻塞，实际上您将无法再提供任何 Web 请求（可能是一件坏事）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T20:20:58.077

这将是危险的，因为有时工作进程被回收或 AppDomain 崩溃并且工作项被杀死，您可能希望它恢复它正在做的事情，这可能是不可能的。

如果您可以将该工作项放入服务中，则 Windows 服务可能是可以的。如果工作需要 HttpContext，但您可能希望让 Windows 服务调用 Web 服务来定期执行调用，这可能会起作用，但可能并不理想。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T20:24:11.173

这是有道理的，但只是为了好玩，如果网站关闭时不需要运行工作怎么办？如果它与 Application_Start 事件相关，并且只需要在人们浏览站点时运行，那么此时的风险是什么？

好的答案，我只是对它内部的工作原理有点好奇。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T20:24:59.847

我建议您设置一个计划任务来在您的网站上运行一个页面。我通常将计划任务指向一个 .vbs 文件，其中包含以下内容：

```
出错时继续下一步
暗淡 objRequest
昏暗的网址

设置 objRequest = CreateObject("Microsoft.XMLHTTP")
URL = "http://www.mywebsite.com/cron/pagetorun.ashx"

objRequest.open "POST", URL , false

objRequest.Send

设置 objRequest = 无

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T19:50:44.813

Omar Al Zabir 有一篇关于为此目的使用缓存项回调的优秀帖子。

[http://www.codeproject.com/KB/aspnet/ASPNETService.aspx?fid=229682&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=76&select=1334820](http://www.codeproject.com/KB/aspnet/ASPNETService.aspx?fid=229682&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=76&select=1334820)

# tfs - 我可以在 tfs 2008 中取消搁置到不同的分支吗？

> ID：117337
> 
> 赞同：105
> 
> 时间：2008-09-22T20:19:25.943
> 
> 标签：tfs, branch, shelve, unshelve

假设我团队中的某个开发人员搁置了他在分支 A 中所做的更改。而我正在处理分支 B。我可以将他的更改搁置到分支 B 中吗？（通过 GUI 或命令提示符）

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-09-22T20:24:11.157

[Visual Studio Power Tools](http://msdn.microsoft.com/en-us/vstudio/bb980963.aspx)应该允许您执行此操作。

```
C:\src\2\Merlin\Main>tfpt unshelve /?
tfpt unshelve - Unshelve into workspace with pending changes

Allows a shelveset to be unshelved into a workspace with pending changes.
Merges content between local and shelved changes. Allows migration of shelved
changes from one branch into another by rewriting server paths.

Usage: tfpt unshelve [shelvesetname[;username]] [/nobackup]
                     [/migrate /source:serverpath /target:serverpath]

 shelvesetname          The name of the shelveset to unshelve
 /nobackup              Skip the creation of a backup shelveset
 /migrate               Rewrite the server paths of the shelved items
                        (for example to unshelve into another branch)
 /source:serverpath     Source location for path rewrite (supply with /migrate)
 /target:serverpath     Target location for path rewrite (supply with /migrate)
 /nobackup              Skip the creation of a backup shelveset 
```

例如，要将在 Branch1 上创建的名为“Shelve Set Name”的搁置集合并到 Branch2，请使用以下命令：

```
>tfpt unshelve "Shelve Set Name";domain\userName /migrate /source:"$/Project/Branch1/" /target:"$/Project/Branch2/" 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2011-03-25T05:22:05.497

**tfpt 的替代解决方案，避免手动合并每个文件**

tfs 电动工具的问题在于[您正在进行“毫无根据的合并”，因此必须确认每个文件](http://blogs.msdn.com/b/mohamedg/archive/2009/04/30/how-to-move-a-shelveset-to-another-branch.aspx)。我有超过 800 个文件的搁置集，我从不相信“自动合并”按钮，也不想依次浏览每个文件 - 所以我必须找到另一种方法！

*   下载并安装[TFS Shelveset Sidekick](http://www.attrice.info/cm/tfs/)。
*   该工具出现在 VS2010 中的“工具”下
*   运行“Shelveset Sidekick”工具，单击搜索以显示搁置集
*   右键单击您的搁置集并选择“导出搁置集”
*   保存到空位置，例如`C:\temp\shelveset-name`
*   现在有一个包含新文件的完整目录结构

（注意：导出时没有进度条 - 因此，如果您有一个需要很长时间才能导出的大型搁置集，您只需在 Windows 资源管理器（文件>属性>大小）中检查文件是否仍在下降，如果您认为它被冻结了）。

您现在只需使用 Windows 资源管理器将它们复制到新分支。

这对我有用：

*   首先检查整个解决方案（在新分支中）
*   关闭该解决方案
*   从 VS（[执行此操作的工具](http://visualstudiogallery.msdn.microsoft.com/425f09d8-d070-4ab1-84c1-68fa326190f4?SRC=Home)）中脱机 TFS -*请参阅下文了解为什么这很重要...*
*   在 Windows 资源管理器中复制文件。`c:\temp\shelveset-name`必须重命名其中的目录结构以对应于新分支。**提示：确保复制到正确的位置！！！**
*   让 VS 上线
*   它应该找到所有更改并添加新文件
*   如果它要求您绑定源控制，请务必验证新分支的路径是否正确。
*   测试 - 然后签入新文件

重要提示：我发现，如果您不首先使 TFS 脱机，那么您最终会看到任何新文件（来自您的 unshelves 变更集）显示没有一点红色复选标记，您必须排除并再次包含它们让他们添加。如果有人有这个问题的替代解决方案，我很想知道 - 刷新似乎不起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T20:23:00.957

货架信息包括它去往的具体路径。不幸的是，除了搁置到的位置之外，我不知道有任何自动方式可以将其搁置到任何位置。我想这样做的时候，我不得不检查新分支中的等效文件，从旧分支中取消搁置，然后手动复制文件。

编辑：嗯，我想我做得很艰难。我将不得不尝试 Curt 的解决方案。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-05-09T19:07:36.097

我花了很多时间来完成这件事，我几乎没有什么问题需要克服。这是可能的，但这里很少有问题和很少遵循的规则来避免这些问题

错误：

> 无法确定工作区

**通过从源**分支根文件夹运行命令解决了这个特定问题。这与他们说使用“目标”分支的一些答案相反 - 不，使用“源”：

```
cd [your !!source!! branch root]
tfpt unshelve /migrate /source:"$/MyCollection/Development/Maint1.1" /target:"$/MyCollection/Development/Maint1.2" "myShelveset;UserName" 
```

在此之后出现了第二个问题。似乎它无法连接到 TFS 服务器。我意识到，我安装了多个 VS 并连接到不同的 TFS 服务器。我使用的是 VS12，我有工作区和服务器连接。但是我没有意识到需要在 VS13 中复制相同的连接才能使 TFPT2013 正常工作。它连接到相同的服务器和工作区。

我也尝试过使用 TFPT2015，但我安装了它，但它没有安装 TFPT.exe，因此它没用。所以我尝试了从 TFPT2013 到 TFS2015，它适用于这个特定的命令。我想知道，如果 VS12/13 对 TFS2015 工作正常，为什么不呢？

**总结**

*   使用 CMD 或 DevCMD - 没关系
*   **从源**分支根文件夹运行命令
*   验证特定 VS 的 Team Explorer Server 连接
*   TF Power Tools 2013 适用于 TFS v15，至少*迁移*选项有效

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-09-09T14:12:07.753

以下步骤可用于小尺寸搁置集（约 20 个文件或更少）。

1.  在搁置集和目标分支上，首先签入或回滚所有待处理的更新。
2.  在搁置集分支上，从适用的搁置集中取消搁置文件。
3.  在目标分支上，签出未搁置的搁置集中的任何现有文件。
4.  将搁置分支上的未搁置文件与目标分支上的文件进行比较，以识别那些需要合并更新（如果有）的文件。
5.  如果需要，手动对上一步的适用文件进行合并更新，并将这些文件保存在目标分支工作区中。
6.  将其他搁置集文件从搁置分支工作区复制到目标分支工作区。
7.  将目标分支工作区中新更新的文件与签入的文件进行比较。根据需要进行任何更正。
8.  签入目标分支上的新更新文件。
9.  回滚搁置分支上未搁置的文件。

# c++ - C++ 计时，自上一整秒以来的毫秒数

> ID：117346
> 
> 赞同：5
> 
> 时间：2008-09-22T20:20:15.113
> 
> 标签：c++, performance, datetime

我正在开发一个需要详细时序信息的 C++ 应用程序，精确到毫秒级。

`time()`我们打算使用 中的标准函数来收集秒精度的时间`<ctime>`。我们还想收集自上一秒给定的毫秒数`time()`。

有谁知道获取此信息的便捷方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-22T20:31:59.283

**如果**底层平台支持，Boost.DateTime 具有毫秒和纳秒表示。当它使用平台特定的代码时，它会将这些细节排除在您的代码之外。

如果这很重要，他们确实有另一种方法来进行平台无关的亚秒级分辨率。 [这个页面](http://www.boost.org/doc/libs/1_36_0/doc/html/date_time/posix_time.html#time_duration_intro)有几段讲述了如何做到这一点。

（来自页面）

例如，假设我们要使用表示十分之一秒的计数来构建。也就是说，每个刻度是 0.1 秒。

```
int number_of_tenths = 5;
//create a resolution independent count -- divide by 10 since there are 
//10 tenths in a second.  
int count = number_of_tenths*(time_duration::ticks_per_second()/10);
time_duration td(1,2,3,count); //01:02:03.5 //no matter the resolution settings 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-22T20:22:51.003

这个问题没有可移植的解决方案，因为 ANSI C 没有定义标准的毫秒精度时间函数。如果您使用的是 Windows，则可以使用 GetTickCount()、timeGetTime() 或 QueryPerformanceCounter()/QueryPerformanceFrequency()。请记住，这些具有不同的准确性和不同的运行时成本。

其他操作系统中还有其他类似的功能；我不确定他们在我的脑海中是什么。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T21:17:29.517

[Windows 中的GetTickCount](http://msdn.microsoft.com/en-us/library/ms724408(VS.85).aspx) [gettimeofday](http://linux.die.net/man/2/gettimeofday)在Windows 中的 *nix [QueryPerformanceCounter](http://msdn.microsoft.com/en-us/library/ms644904(VS.85).aspx)以获得更好的分辨率（尽管 GetTickCount 应该这样做）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T21:22:42.063

如果你在 Unix 上，**gettimeofday()**将返回秒和微秒，直到系统时钟的分辨率。

```
int gettimeofday(struct timeval *tv, struct timezone *tz);

struct timeval {
    time_t      tv_sec;     /* seconds */
    suseconds_t tv_usec;    /* microseconds */
}; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T20:52:18.080

**适用于英特尔处理器的高分辨率、低开销时序**

如果您使用的是 Intel 硬件，以下是读取 CPU 实时指令计数器的方法。它会告诉您自处理器启动以来执行的 CPU 周期数。这可能是您可以获得的用于性能测量的最细粒度的计数器。

请注意，这是 CPU 周期数。在 linux 上，您可以从 /proc/cpuinfo 获取 CPU 速度，然后除以获取秒数。将其转换为双精度非常方便。

当我在我的盒子上运行它时，我得到

```
11867927879484732
11867927879692217
调用 printf 花了这么长时间：207485

```

这是提供大量详细信息的[英特尔开发人员指南。](http://cs.smu.ca/~jamuir/rdtscpm1.pdf)

```
#include < stdio.h >  // stackoverflow bug: pre tag eats the filenames,
#include < stdint.h > // so i had to put spaces in the angle brackets

inline uint64_t rdtsc() {
    uint32_t lo, hi;
    __asm__ __volatile__ (
      "xorl %%eax, %%eax\n"
      "cpuid\n"
      "rdtsc\n"
      : "=a" (lo), "=d" (hi)
      :
      : "%ebx", "%ecx");
    return (uint64_t)hi << 32 | lo;
}

main()
{
    unsigned long long x;
    unsigned long long y;
    x = rdtsc();
    printf("%lld\n",x);
    y = rdtsc();
    printf("%lld\n",y);
    printf("it took this long to call printf: %lld\n",y-x);
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T16:40:24.930

正如其他人所说，没有一种便携的方法可以做到这一点。

我所做的（在 msvc++ 和 linux/g++ 上）是使用以下类，在 Windows 上使用 QueryPerformanceCounter，在 Linux 上使用 gettimeofday。这是一个计时器类，可以让您了解两次通话之间经过的时间。您可能需要对其进行修改以满足您的需要。

```
#if defined(_MSC_VER)
#  define NOMINMAX // workaround un bug dans windows.h qui define des macros
                   // "min" et "max" qui entrent en conflit avec la STL.
#  include <windows.h>
#else
#  include <sys/time.h>
#endif

namespace Utils
{

   /**
    * Implémente un chronométre qui mesure le temps etre deux appels.
    */
   class CTimer
   {
   private:
#     if defined(_MSC_VER)
         LARGE_INTEGER m_depart;
#     else
         timeval m_depart;
#     endif

   public:
      /**
       * Démarre le timer.
       * 
       * Cette fonction sert à démarrer le timer. Si le timer est  déja
       * démarrer, elle le redémarre simplement.
       */
      inline void start()
      {
#        if defined(_MSC_VER)
            QueryPerformanceCounter(&m_depart);
#        else
            gettimeofday(&m_depart, 0);
#        endif

      };

      /**
       * Retourne le nombre de secondes depuis le départ du timer.
       * 
       * @return Nombre de secondes écoulés depuis le départ du timer
       */
      inline float GetSecondes() const
      {
#        if defined(_MSC_VER)
            LARGE_INTEGER now;
            LARGE_INTEGER freq;

            QueryPerformanceCounter(&now);
            QueryPerformanceFrequency(&freq);

            return (now.QuadPart - m_depart.QuadPart) / static_cast<float>(freq.QuadPart);
#        else
            timeval now;
            gettimeofday(&now, 0);

            return now.tv_sec - m_depart.tv_sec + (now.tv_usec - m_depart.tv_usec) / 1000000.0f;
#        endif
      };
   };
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T21:56:47.613

```
#include <ctime>

clock_t elapsed = static_cast<double>(clock() / CLOCKS_PER_SEC); 
```

elapsed 将是经过的处理器时间，以秒为单位。

分辨率取决于操作系统，但在大多数系统上通常优于毫秒分辨率。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:24:37.757

标头中没有的任何内容都`(c)time.h`需要特定于操作系统的方法。我相信所有这些方法都是第二个解决方案。

你在什么操作系统上工作？

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-22T20:21:57.963

如果适用于 Windows，请查看 QueryPerformanceCounter 方法。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-22T23:06:22.327

Intel 的[Threading Building Blocks 库](http://www.threadingbuildingblocks.org/)对此有一个功能，但 TBB 目前仅在 Intel 和克隆上可用（也就是说，它在 SPARC、PowerPC、ARM 等上不可用）

# sql-server - SQL Server Management Studio 和 Express 版有什么区别？

> ID：117347
> 
> 赞同：41
> 
> 时间：2008-09-22T20:20:33.770
> 
> 标签：sql-server, ssms

我目前正在使用 Express。完整版有哪些额外功能？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-23T03:45:46.820

Management Studio 中没有差异。区别在于数据库引擎 LIMITATIONS！引擎是相同的，但它会拒绝您的某些功能。

快捷版中的导入/导出向导位于：C:\Program Files\Microsoft SQL Server\90\DTS\Binn\DTSWizard.exe

如果没有，请从 Microsoft 下载：http: [//go.microsoft.com/fwlink/ ?LinkId=65111](http://go.microsoft.com/fwlink/?LinkId=65111)

您可以安装[Microsoft SQL Server 2005 Express Edition Toolkit](http://www.microsoft.com/downloads/details.aspx?familyid=3C856B93-369F-4C6F-9357-C35384179543&displaylang=en)来获得很酷的玩具，例如导入/导出向导和报告。

探查器不是 Management Studio 的一部分。它是 SQL Server 完整版附带的又一个应用程序。即使您安装了它，您的 Express Edition 服务器引擎也会拒绝使用它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-22T21:10:52.917

假设您谈论的是客户端工具而不是数据库引擎的差异，那么到目前为止我发现的唯一差异是缺少报告和分析器。在完整版中，您可以在对象树上右键单击并从一组标准报告中进行选择。在 Express 版本中，缺少该菜单选项。快速版本不安装分析器。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-22T20:26:36.550

Express Edition 中缺少大多数高可用性选项。Express*版本*非常适合开发目的。以下是比较事实：

[http://www.microsoft.com/sql/prodinfo/features/compare-features.mspx](http://www.microsoft.com/sql/prodinfo/features/compare-features.mspx)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-22T20:57:33.090

对我来说最烦人的是导入/导出选项。即使是开发人员也需要。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T20:39:13.727

阻止我使用 Studio Express 的功能之一是能够通过 SSIS（SQL Server 集成服务）导入和导出数据。仅使用 Studio Express 很难成为真正的 DBA。从开发人员的角度来看，Studio Express 通常就足够了。

# c# - 您可以强制将枚举值序列化为整数吗？

> ID：117348
> 
> 赞同：2
> 
> 时间：2008-09-22T20:20:39.560
> 
> 标签：c#, .net, xml-serialization, attributes

> **可能重复：**
> [如何将枚举值序列化为 int？](https://stackoverflow.com/questions/506368/how-do-i-serialize-an-enum-value-as-an-int)

大家好！

我想知道是否有一种方法可以强制将枚举值序列化为其整数值，而不是其字符串表示形式。

将您置于上下文中：在一个严重依赖 Web 服务的 Web 应用程序中，我们为所有请求标头使用单个基类，与请求类型无关。

我想在标题中添加一个 Result 字段，因此我们将有一个地方可以将有关操作如何在 Web 服务端进行的提示传递回调用应用程序。我们已经为此声明了一个枚举，但由于我们有旧应用程序调用那些可能不知道这些枚举的 Web 服务，我想将这些值作为整数发送序列化。

我们已经不得不通过使用 [XmlElement(ElementName = "string representationOfAttributeName")] 来减少这些标头的长度，因为我们偶尔会超过 IE 的最大 url 长度，我想知道是否有类似的属性来强制序列化枚举值转换为整数。

有人听说过这样的属性吗？

一如既往，感谢您的帮助，帕斯卡

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T20:23:43.407

枚举确实序列化为整数。但一般来说，如果您不喜欢其中一个属性被序列化为 XML 的方式，您可以这样做：

```
[XmlIgnore]
public MyThing MyThing { get; set; }

[XmlElement("MyThing")]
[EditorBrowsable(EditorBrowsableState.Never), Browsable(false)]
public string MyThingForSerialization
{
    get { return //convert MyThing to string; }
    set { MyThing = //convert string to MyThing; }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T11:00:02.140

默认情况下，枚举不会序列化为 int。我正在使用 XMLSerializer 序列化一个类，我遇到了与描述相同的问题。

（如果您将 MyThingForSerialization 的范围更改为 public，Matt Howells 的示例似乎有效，但我希望看到更好的实现，因为这会创建 1 个额外的公共属性）

# c - 优化伽罗瓦域算术中的 y = x*x

> ID：117352
> 
> 赞同：4
> 
> 时间：2008-09-22T20:21:03.193
> 
> 标签：c, cryptography, bit-manipulation, low-level

我有这个 C 代码可以对 GF(8) 进行乘法运算：

```
int32_t GaloisMultiply (int32_t a, int32_t b) 
{
    int32_t i;
    int32_t mask = 0x100;
    int32_t y = 0;

    for(i=0;i<8;i++) 
    {
        if(b & mask) 
        {
            y ^= a;
        }
        mask >>= 1;
        y <<= 1;
    }

    if(b & 0x1) 
    {
        y ^= a;
    }

    return(y);
} 
```

这或多或少是教科书的实施。

我想知道如果我可以断言a 总是b，我是否对上述算法有一个聪明的优化，例如我做平方而不是乘法。顺便说一句，我不是在加密使用之后。我只想利用 GF(8) 中的 x*x 将 x 的位与零位一一交错的事实。

已经有非常聪明的方法来进行位交织，但是因为我发现 GF(8) 中的 x*x 做了位交织的事情（偶然）我不能停止尝试将它用于位交织优化。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T20:32:36.317

基于表？[关联](http://www.samiam.org/galois.html)

当你被限制为 x*x 时，它是一个稀疏矩阵。

这是另一篇[好论文（和一个图书馆）](http://www.cs.utk.edu/~plank/plank/papers/CS-07-593/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T20:38:56.347

```
int32_t GaloisMultiply( int32_t a ) 
{
  int32_t y = 0;
  int32_t b = a & 0x01ff;

  while ( b ) 
  {
    if ( b & 1 ) 
      y ^= a;

    a <<= 1;
    b >>= 1;
  }
  return y;
} 
```

或者，如果您喜欢：

```
int32_t GaloisMultiply( int32_t a ) 
{
  int32_t y = 0;
  for ( int32_t b = a & 0x01ff; b; b >>= 1 )
  {
    if ( b & 1 ) 
      y ^= a;

    a <<= 1;
  }
  return y;
} 
```

这种方法比上面的原始代码更有效的原因主要是因为循环仅在参数中的所有“有趣”位被消耗之前执行，而不是盲目地检查所有 (9) 位。

不过，基于表格的方法会更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T14:17:54.177

查找表绝对是多项式基伽罗瓦平方最快的。使用 GF(8) 时，它也是最快的乘法运算，但是对于 ECC 中使用的较大字段，表变得太大。对于更大领域的乘法，最好的算法是“从左到右结合”方法......（参见[http://www.amazon.com/Elliptic-Cryptography-Springer-Professional-Computing/dp/038795273X](https://rads.stackoverflow.com/amzn/click/com/038795273X)算法 2.36，页50)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T20:25:15.227

您可能可以编写一些程序集来做得更好。但是，如果这是您的应用程序的瓶颈，我会感到非常惊讶。你做过分析吗？这个功能似乎不值得优化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T20:25:23.807

这可能不是您想要的，但这里有一个小的加速：

如果保证它们相同，则只传递一个参数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T20:37:10.813

将“a”和“b”标记为 const 可能会对编译器有所帮助。或者手动展开循环。要是能帮上忙就可惜了……

顺便说一句，这不是专利雷区吗？

# .net - 在 .NET 中，确定 IEnumerable 是否为空的可靠、优雅、可重用的代码是什么？

> ID：117355
> 
> 赞同：9
> 
> 时间：2008-09-22T20:21:28.200
> 
> 标签：.net, collections

我正在尝试找到最可重用但最优雅的代码段，用于确定是否为 IEnumerable。理想情况下，这应该是一个我可以在需要判断 IEnumerable 是否为空时绝对调用的函数。

虽然我已经为 .NET 3.5 开发了一个到目前为止对我来说效果很好的答案，但我目前的想法是没有完美的答案，因为 IEnumerable 可以在技术上封装一个集合（或迭代器队列），将底层结果修改为它会迭代，这会导致问题。但是，这也会成为实现 IEnumerable.Count() 的障碍，但这并没有阻止 MS 提供它。

所以我想我会把它交给 SO 看看是否有人有更好的，以防其他人发现它有用。

**编辑：** 哇，我不敢相信我不知道 IEnumerable.Any。我知道它存在，但从来没有费心去检查它做了什么。让这成为一个教训。阅读文档。仅仅因为方法名称并不意味着它会做你想做的事，并不意味着它不会做你想做的事。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-22T20:22:44.797

```
!enumerable.Any() 
```

将尝试仅抓取第一个元素。

为了扩展其工作方式/原因，any 确定是否有任何组件`IEnumerable`与给定函数匹配，如果没有给出，则任何组件都将成功，这意味着如果元素存在于可枚举中，该函数将返回 true。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T20:39:16.177

对于.net 1/2：

```
IEnumerator e;
try
{
   e = enumerable.GetEnumerator();
   return e.MoveNext();
}
finally
{ 
    if (e is IDisposable)
        e.Dispose();
} 
```

或者，使用泛型：

```
using (IEnumerator<T> e = enumerable.GetEnumerator())
{
    return e.MoveNext();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T20:51:21.887

你是对的，没有完美的答案。IEnumerable 只支持迭代，不保证枚举是可重复的。如果不调用 MoveNext 至少一次，您将无法确定枚举是否包含元素，并且一旦您这样做了，您就不能保证能够重用该枚举：IEnumerable.Reset 允许抛出 NotSupportedException。从[http://msdn.microsoft.com/en-us/library/system.collections.ienumerator.reset.aspx](http://msdn.microsoft.com/en-us/library/system.collections.ienumerator.reset.aspx)：

“为 COM 互操作性提供了 Reset 方法。它不一定需要实现；相反，实现者可以简单地抛出 NotSupportedException。”

IEnumerable<T>.Count 和 IEnumerable<T>.Any 等扩展方法需要在幕后调用 MoveNext。有用的包装器，但不要回避这样一个事实，即在枚举不支持重置的（极少数）情况下，您可能会遇到问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T20:43:48.723

使用这两种方法要注意的一点是，并非所有枚举都可以回滚，例如 System.Data.IDataReader 的所有实现只能运行一次。

`foreach`在这些情况下，只要您考虑到它甚至可能不会循环一次的事实，您就不会真正在循环中产生成本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T02:16:28.340

第一种方法有一个 Empty 扩展方法的简单实现：http: [//signum.codeplex.com/SourceControl/changeset/view/25903#510468](http://signum.codeplex.com/SourceControl/changeset/view/25903#510468)

# jquery - 如何正确添加到带有 jquery 的页面并让更改事件起作用？我目前在一个页面上有多个选择，这些选择是通过使用 jquery 的 ajax 调用动态添加的。我遇到的问题是我无法让更改事件在添加的选择上工作，除非我在标签内使用 onchange，例如 <select id="Size" size="1" onchange="onChange(this);" > 这行得通，但我想知道是否有办法让它由 jquery 分配。我尝试在 $(document).ready 的通常位置使用 $

> ID：117356
> 
> 赞同：4
> 
> 时间：2008-09-22T20:21:29.870
> 
> 标签：jquery, html-select

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T20:25:53.697

> $('select').change(onChange($(this));

您需要了解调用函数和将其作为对象传递之间的区别。函数是 JavaScript 中的一等对象，它们和其他任何东西一样都是对象，因此它们可以存储在变量中，作为参数传递给其他函数，等等。

您拥有的代码调用 onChange 函数，并将结果提供给 jQuery 的 change 函数。你不想要那个。这个想法是将*函数本身*传递给 jQuery 的 change 函数，然后 jQuery 在适当的时候调用它。

当您在函数名称之后有括号 - () - 时，您正在调用它。否则，您将其视为对象。所以你*打算*做的事情可以这样完成：

```
$('select').change(onChange); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T20:27:26.110

我有一个类似的问题，在[这里](http://groups.google.com/group/jquery-en/browse_thread/thread/9b79d65b47952583?pli=1)找到了这个解决方案：

> 当你做这样的事情时：
> 
> ```
> $('p').click( function() { alert('blah'); } ) 
> ```
> 
> 所有*当前存在*的“p”元素都将附加一个点击处理程序。现在，如果您继续向页面添加其他“p”元素，它们 *将不会* 附加您的点击处理程序。您需要“重新运行”
> 
> ```
> $('p').click( function() { alert('blah'); } ) 
> ```
> 
> 在新元素上附加处理程序。
> 
> 您可能希望查看 [“LiveQuery”插件](http://plugins.jquery.com/project/livequery)，因为它管理所有新添加的元素，因此当它们被添加到页面时，它们会获得以前附加的处理程序。
> 
> 卡尔·路德

因此，在添加选择后，您必须重复 change() 调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T22:03:49.263

将选择添加到您的页面后，您需要向其中添加更改事件：

```
$('#newSelect').change(
    function() 
    { 
        onChange(this)
    }
); 
```

如果您的选择都具有相同的类，最好先取消绑定，然后重新绑定：

```
$('.classname').unbind("change");
$('.classname').change(
    function() 
    { 
        onChange(this)
    }
); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T08:13:10.050

感谢大家的帮助，答案有效，但不适用于我正在做的事情。我终于用萤火虫弄明白了。我试图在 ajax 完成它之前分配更改事件（我对这个 ajax 东西很陌生，你可能已经注意到了）。

我在 load() 上添加了分配给回调的事件，现在一切正常。

```
 $(this).load('ploc002.php', {JobNumber: JobNumber, Edit: this.id}, function()
        {
            // The DOM has been changed by the AJAX call
            // Now we need to reassign the onchange events
            $('select,input').change( function()
            {
                onChange(this)
            });
        }); 
```

# javascript - 如何将事件处理程序绑定到 jQuery 中的实例？

> ID：117361
> 
> 赞同：0
> 
> 时间：2008-09-22T20:22:10.570
> 
> 标签：javascript, jquery, events, dom

我正在尝试使用 jQuery 将事件绑定到 Javascript“类”的特定实例的“方法”。要求是我在事件处理程序中应该能够使用“this”关键字来引用我最初将事件绑定到的实例。

更详细地说，假设我有一个“类”，如下所示：

```
function Car(owner) {
  this.owner = owner;
}
Car.prototype = {
  drive: function() {
    alert("Driving "+this.owner+"s car!");
  }
} 
```

还有一个例子：

```
var myCar = new Car("Bob"); 
```

我现在想将一个事件绑定到我的汽车的驱动器“方法”，以便每当我单击一个按钮时，例如在汽车“类”的 myCar 实例上调用驱动器“方法”。

到目前为止，我一直在使用以下函数来创建一个闭包，它允许我在“方法”中使用“this”关键字轻松访问实例成员。

```
function createHandler( obj, method ) {
  return function( event ) {
    return obj[method](event||window.event);
  }
} 
```

我使用它如下：

```
document.getElementById("myButton")
  .addEventListener("click", createHandler(myCar,"drive")); 
```

我如何用 JQuery 完成这样的事情？

我特别询问将“this”与指定的实例相关联，我可以自己处理周围的其他杂物。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T20:36:45.340

只需使用匿名函数：

```
$("#myButton").click(function() { myCar.drive(); }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-10-08T06:03:07.757

试试这个 ：

```
$("#myButton").each(function() {

var $btn = $(this);

    $btn.on('click',function(){

     // Do whatever you want.

    });
}); 
```

在这里，您首先创建一个循环来定位所有 #myButton 元素（在您的示例中这是错误的，您应该使用 Class 代替），例如：

```
$(".myButton").each(... 
```

然后我们将点击事件处理程序附加到所有这些。

# php - 无法在 IE7 中下载文件，但在 Firefox、Chrome 等中没有任何问题。？

> ID：117372
> 
> 赞同：5
> 
> 时间：2008-09-22T20:23:07.603
> 
> 标签：php, internet-explorer-7, download

我有一个脚本，它接收一个加密的 url 并从中生成一个下载，脚本中最关键的部分是这样的：

```
$MimeType = new MimeType();
$mimetype = $MimeType->getType($filename);
$basename = basename($filename);
header("Content-type: $mimetype");
header("Content-Disposition: attachment; filename=\"$basename\"");
header('Content-Length: '. filesize($filename));
if ( @readfile($filename)===false ) {
  header("HTTP/1.0 500 Internal Server Error");
  loadErrorPage('500');
} 
```

下载在除 IE 之外的任何浏览器中都具有魅力，我已经看到与“无缓存”标头相关的问题，但我没有发送类似的内容，他们谈论的是 utf-8 字符，但没有任何`utf-8 characters`（和 $filename也没有任何 utf-8 字符）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T20:59:05.520

我通过发送标题解决了它

```
header('Pragma: public');
header('Cache-Control: max-age=0'); 
```

我不知道 session_start() 自己发送标头。

我在以下评论部分找到了答案：[错误：Internet Explorer 无法从 WebServer 下载文件名](http://www.alagad.com/go/blog-entry/error-internet-explorer-cannot-download-filename-from-webserver)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T20:30:47.133

[该站点](http://bytes.com/forum/thread554529.html)在 IE6 中存在与您类似的问题。总结一下：

> session_start() 默认发送一个包含“no-store”的缓存控制头。Internet Explorer 有点过于字面意思了，但没有针对这种情况进行适当的错误处理，因此当您尝试将输出页面保存到磁盘时会神秘地爆炸。
> 
> 在 session_start() 之前，添加“session_cache_limiter('none');”，或者查找该函数并根据需要调整限制器（可能“私有”更接近标记）。

我意识到您发布的代码片段不包括对 的调用`session_start();`，但我想我会分享这个可能的解决方案，以防您确实调用它但没有向我们展示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T10:29:12.783

用这个

在 IE7 浏览器中转到 Internet 选项--> 安全性---> 自定义级别 ---> 下载，然后启用自动提示文件下载。

这将解决问题。

希望这会有所帮助

# svn - 将 Git 历史移植到 SVN 分支上

> ID：117378
> 
> 赞同：6
> 
> 时间：2008-09-22T20:24:16.337
> 
> 标签：svn, git, git-svn

**我**
有一个 Git 存储库和一个 SVN 存储库，它们都拥有相同的源代码但不同的提交历史。Git repo 有很多小的评论很好的提交......而 SVN repo 有一些巨大的提交，带有“很多东西”之类的评论。这两个系列的提交都遵循在代码中所做的相同更改，并且大致相同。

**想要的结果**
我想切换到使用 Git-SVN *，而不会*丢失当前 Git 存储库的详细历史记录。这应该通过将 Git 存储库中的历史“嫁接”到项目的 SVN 分支上来完成（从我真正开始使用 Git 的那一点开始分支）。

**为什么要这么做？(历史)**
前段时间我开始玩 Git。我首先在一个受 SVN 控制的项目中设置了一个 Git 存储库。通过一些配置，我让 Git 和 SVN 在同一个源代码上并行工作。

这对我来说是学习和使用 Git 的好方法，同时仍然拥有 SVN 的安全网。它基本上是一个带有真实数据的沙箱。我没有时间真正*学习*Git，但我真的很想修补它。这对我来说实际上是一个学习 Git 的好方法。

起初，在进行了一些编辑之后，我会提交给 SVN，然后提交给 Git……然后在知道我的更改在 SVN 中安全的情况下使用 Git。很快我就比 SVN 更频繁地提交到 Git ......

当了解 和 之间的区别时`git revert`，`svn revert`我*很*高兴我一直在检查 SVN 存储库。假设两者工作相同，我几乎失去了几个星期的工作。

我现在知道 Git-SVN 的荣耀，并且在其他几个项目中愉快地使用它。当我开始时，我完全意识到我可能会丢失我的 Git 存储库，并且必须使用“正确”设置一个新的存储库`git-svn init`……但是现在使用 Git 已经有一段时间了，我确信有一些方法可以破解 Git 历史进入SVN。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T20:56:07.460

这可能很难做你想做的事。您可以通过以下方式将 git repo 导入 svn：[http](http://code.google.com/p/support/wiki/ImportingFromGit) ://code.google.com/p/support/wiki/ImportingFromGit ，但我认为您会遇到冲突。您可以根据您的 git 存储库从头开始重新创建您的 SVN 存储库。

为了将来参考，将 Git 用作 SVN 客户端可能会更容易：

```
git-svn clone path/to/your/svn/repo
git-commit -a -m 'my small change'
vi some files to change.txt
git-commit -a -m 'another small change' 
git-svn dcommit # sends your little changes as individual svn commits 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-27T18:08:51.850

看来这是*不可能*的。虽然可以将当前的 git 存储库加入到当前的 svn 存储库中，但似乎无法将 git 存储库的历史重播到 svn 存储库中。

我遇到的主要问题是让 git-svn “锁定”到单个 svn 提交。这个问题的答案似乎是`git-svn set-tree`。这篇博文很有帮助：
[http ://www.reonsoft.com/~john/blog/2008/06/05/git-first-git-svn-later/](http://www.reonsoft.com/~john/blog/2008/06/05/git-first-git-svn-later/)

这是我可以尝试将历史保存在 svn 中的：

```
git branch svn-reconsile HASH_OF_SECOND_COMMIT
git checkout -f svn-reconsile

git svn init file://path/to/repos/myproject/branches/git-import
git svn fetch

git svn set-tree HASH_OF_SECOND_COMMIT

git rebase git-svn

git merge master

git svn dcommit 
```

问题是`git svn dcommit`只会在 svn 中进行一次修订......而不是`master`分支中的每个提交......因此历史在 svn 中被压缩。

所以更简单的解决方案是简单地使用 set-tree 启动 git-svn 并满意历史仍然在 git 中，即使它不在 svn 中。这可以通过以下方式完成：

```
git svn init file://path/to/repos/myproject/branches/git-import
git svn fetch

git svn set-tree HASH_OF_MOST_RECENT_COMMIT

git rebase git-svn 
```

如果有人知道如何解决挤压问题（我*已经*尝试过`--no-squash`），请发表评论！在聪明的评论中，我将接受保留 git 历史记录并使用上面的第二个代码块移植到最新的 svn 修订版。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T21:00:14.303

You may want to checkout [Tailor](http://wiki.darcs.net/DarcsWiki/Tailor). I used it to convert a git repository into an svn one so that my work could be hosted in our company svn server. It's quite flexible, so it may be able to do what you want.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T00:49:15.300

我认为这应该可以通过以下两种方式之一实现……我现在将概述它们，如果我能弄清楚它们，稍后再尝试充实它们。如果有人可以看到如何充实零件或知道零件为什么不起作用...请发表评论！

**1 - 使用 git-svn 就地**
*（以下是伪命令，它们不是真实的 - 不要使用它们）*

```
rm .svn
(configure git-svn '/myproject/branch/git-remerge')
git svn sync_versions --svn_revision=123 --hash=ad346f221455
git svn dcommit 
```

**2 - 使用单独的 git-svn repo 作为代理**
*（以下是伪命令，它们不是真实的 - 不要使用它们）*

```
mkdir ../svn_proxy
cd ../svn_proxy
git svn init
git checkout hash_of_svn_branch_point
git pull ../messy_repo 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-24T00:33:28.220

从您尝试迁移到的 git svn 存储库中，执行以下操作：

```
git remote add old-repo <path-to-old-repo>
git fetch old-repo
# to browse and figure out the hashes, if that helps
gitk --all &

# for each branch you want to graft
git rebase --onto <new git svn branch base> <old-repo branch base> <old-repo branch tip>

# when done
git remote rm old-repo 
```

供您参考，您也应该能够使用 git format-patch 和 git am 做同样的事情，但 git rebase 应该更友好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-15T23:05:09.507

在处理 memcached 的 git 历史时，我做了很多工作。我正在做的很多工作是验证每个人的工作都得到了适当的认可。

我构建了一个[工具](https://github.com/dustin/bindir/blob/master/git-tree-converge.py)来生成一个报告，该报告准确地显示了树在何处收敛，而不管提交哈希、git 历史、作者、提交者等如何......看看这个[示例报告](http://public.west.spy.net/memcached/compare.html)，我们用来查看两个包含相同信息的不相关存储库在哪里收敛.

从那里开始，我在谷歌和邮件列表搜索之后做了很多手动移植和`filter-branch`ing，以找出这些贡献更改的人实际上是谁。

# iis - ADSI 不会从 XP Workstation 连接到 IIS

> ID：117379
> 
> 赞同：0
> 
> 时间：2008-09-22T20:24:21.093
> 
> 标签：iis, adsi

我成功地在 WScript 中使用 VBScript 从服务器远程读取和写入 IIS 配置。但是，当我尝试从我的办公桌上运行这些相同的脚本时，它们会失败。例子：

```
Dim vdir
Set vdir = GetObject("IIS://servername/w3svc/226/root") 
```

错误 =“无效语法”

该代码在从一台 IIS 服务器运行到另一台服务器时运行良好，但我想从我的 XP 工作站运行它。有一个可用的 ADSI 下载可以使我的桌面上的工作正常运行似乎是合理的，但我找不到。我下载了[ADAM](http://www.microsoft.com/downloads/details.aspx?familyid=9688F8B9-1034-4EF6-A3E5-2A2A57B5C8E4&displaylang=en)，但只获得了我需要的一小部分功能。

有什么提示吗？谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T21:27:01.957

听起来 IIS ADSI Provider 没有安装/注册（可能是 IIS 协议语法错误的原因：在字符串中）

只需追踪提供程序 DLL 的来源 - 怀疑它是通过以下方式安装的：

[IIS 6.0 管理包](http://www.microsoft.com/downloads/details.aspx?familyid=F9C1FB79-C903-4842-9F6C-9DB93643FDB7&displaylang=en)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T18:19:02.027

Stephbu 是正确的，这个答案很有帮助，但这还不够。为了从我的 XP 工作站远程使用 ADSI，我需要安装 IIS 5.1。安装后，我所有的脚本都开始工作了。如果有一个安装可以使脚本工作而不使我的计算机成为 IIS 服务器，我不知道。

# version-control - 如何从 Emacs 中签出 Perforce 下的文件？

> ID：117394
> 
> 赞同：4
> 
> 时间：2008-09-22T20:26:28.873
> 
> 标签：version-control, emacs, file, perforce

我在工作中使用 Perforce 进行源代码控制，我想从 Emacs 中“打开以进行编辑”受源代码控制的文件。

怎么可能呢？我需要在 Emacs 中设置什么？有插件吗？我还想执行其他 p4 操作，例如提交我的更改等。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-22T20:28:16.110

Perforce/Emacs 集成 [http://p4el.sourceforge.net/p4.el.html](http://p4el.sourceforge.net/p4.el.html)

> 一旦你安装了 p4.el 并准备好了，你可以使用 emacs 的内置帮助来查看 p4.el 的功能： Cx p ? 将显示列表。Ch f p4-xyz 提供 p4-xyz 的定义信息。每个 Perforce 命令都有一个对应的 p4.el 命令。该`vc`模型不被遵循。使用“Cx p 帮助命令”获取 Perforce 帮助...

# coding-style - 是否可以在代码库中嵌入 Cockburn 风格的文本 UML 用例内容以提高代码可读性？

> ID：117401
> 
> 赞同：6
> 
> 时间：2008-09-22T20:27:14.067
> 
> 标签：coding-style, uml, readability, use-case

## 在代码中试验 Cockburn 用例

我正在编写一些复杂的 UI 代码。我决定将 Cockburn 用例用于鱼、风筝和海平面（由 Martin Fowler 在他的《UML Distilled》一书中讨论）。我将 Cockburn 用例封装在静态 C# 对象中，以便我可以针对代表 UI 工作流程中步骤的静态常量测试逻辑条件。这个想法是您可以阅读代码并知道它在做什么，因为包装的对象及其公共内容通过名称空间为您提供了英语用例。

此外，我打算使用反射来抽出包含所描述用例的错误消息。这个想法是堆栈跟踪可以包含一些英语用例的 UI 用例步骤。结果证明这是一种有趣的方式来实现一个迷你的、伪轻量级的域语言，但无需编写 DSL 编译器。所以我的问题是这是否是一个好方法？有没有人做过类似的事情？

* * *

*c# 示例片段如下*

假设我们有一些 aspx 页面，它有 3 个用户控件（有很多可点击的东西）。用户必须单击一个特定用户控件中的内容（可能进行某种选择），然后 UI 必须在视觉上提示用户选择成功。现在，当该项目被选中时，用户必须浏览网格视图以在其他用户控件之一中找到项目，然后选择某些内容。这听起来很容易管理，但代码可能会变得丑陋。

在我的例子中，用户控制主页捕获的所有发送的事件消息。这样，页面就像 UI 事件的中央处理器一样，可以跟踪用户点击时发生的情况。

因此，在主 aspx 页面中，我们捕获了第一个用户控件的事件。

```
using MyCompany.MyApp.Web.UseCases;   

protected void MyFirstUserControl_SomeUIWorkflowRequestCommingIn(object sender, EventArgs e)
{
  // some code here to respond and make "state" changes or whatever
  //
  // blah blah blah

  // finally we have this (how did we know to call fish level method?? because we knew when we wrote the code to send the event in the user control)
  UpdateUserInterfaceOnFishLevelUseCaseGoalSuccess(FishLevel.SomeNamedUIWorkflow.SelectedItemForPurchase)

}

protected void UpdateUserInterfaceOnFishLevelGoalSuccess(FishLevel.SomeNamedUIWorkflow  goal)
{
  switch (goal)
  {
     case FishLevel.SomeNamedUIWorkflow.NewMasterItemSelected:
           //call some UI related methods here including methods for the other user controls if necessary....
           break;
     case FishLevel.SomeNamedUIWorkFlow.DrillDownOnDetails:
           //call some UI related methods here including methods for the other user controls if necessary....
           break;
     case FishLevel.SomeNamedUIWorkFlow.CancelMultiSelect:
           //call some UI related methods here including methods for the other user controls if necessary....
           break;

     // more cases...

     }
  }

}

//also we have
protected void UpdateUserInterfaceOnSeaLevelGoalSuccess(SeaLevel.SomeNamedUIWorkflow  goal)
{
  switch (goal)
  {
     case SeaLevel.CheckOutWorkflow.ChangedCreditCard:
        // do stuff

     // more cases...

     }
  }

} 
```

因此，在 MyCompany.MyApp.Web.UseCases 命名空间中，我们可能有这样的代码：

```
class SeaLevel...
class FishLevel...
class KiteLevel... 
```

嵌入在类中的工作流用例可以是内部类或静态方法或枚举或任何为您提供最干净命名空间的东西。我不记得我最初做了什么，但你明白了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-07T00:07:26.827

我从来没有这样做过，但我经常考虑以 UC 风格编写代码，首先是主要成功路径，并且在下面遇到异常时放入扩展。还没有找到这样做的借口 - 很想看到有人尝试它并编写代码，即使在实验之后我们认为它很糟糕，尝试和参考仍然很有趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:03:28.577

我认为这是*设计模式*（四人组）中中介者模式的一种变体——所以我会说这是一种有效的方法。在 Pattern 中，他们讨论了控件之间复杂的交互是使用它的原因。

编辑：[维基百科上的调解员链接](http://en.wikipedia.org/wiki/Mediator_pattern)

# .net - 您更喜欢 .net 中的哪种配置方法？为什么？

> ID：117407
> 
> 赞同：18
> 
> 时间：2008-09-22T20:27:48.573
> 
> 标签：.net, configuration

*   您可以使用 App.config；但它只支持键/值对。
*   您可以使用.Net配置，配置部分；但它可能非常复杂。
*   您可以自己使用Xml序列化/反序列化；你的课——你的方式。
*   您可以使用其他方法；他们会是什么？...

您更喜欢这些或其他方法中的哪一种（如果有）？为什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-22T20:56:53.403

当键值对不够时，我使用配置部分，因为它们使用起来并不复杂（除非您需要一个复杂的部分）：

定义您的自定义部分：

```
 public class CustomSection : ConfigurationSection
        {
            [ConfigurationProperty("LastName", IsRequired = true,
            DefaultValue = "TEST")]
            public String LastName
            {
                get { return (String)base["LastName"]; }
                set { base["LastName"] = value; }
            }

            [ConfigurationProperty("FirstName", IsRequired = true, DefaultValue =
            "TEST")]
            public String FirstName
            {
                get { return (String)base["FirstName"]; }
                set { base["FirstName"] = value; }
            }

            public CustomSection()
            {

            }
        } 
```

以编程方式创建您的部分（如果它尚不存在）：

```
 // Create a custom section.
            static void CreateSection()
            {
                try
                {

                    CustomSection customSection;

                    // Get the current configuration file.
                    System.Configuration.Configuration config = ConfigurationManager.OpenExeConfiguration(@"ConfigurationTest.exe");

                    // Create the section entry  
                    // in the <configSections> and the 
                    // related target section in <configuration>.
                    if (config.Sections["CustomSection"] == null)
                    {
                        customSection = new CustomSection();
                        config.Sections.Add("CustomSection", customSection);
                        customSection.SectionInformation.ForceSave = true;
                        config.Save(ConfigurationSaveMode.Full);
                    }
                }
                catch (ConfigurationErrorsException err)
                {
                    //manage exception - give feedback or whatever
                }

            } 
```

以下 CustomSection 定义和实际的 CustomSection 将为您创建：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <configSections>
    <section name="CustomSection" type="ConfigurationTest.CustomSection, ConfigurationTest, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" allowLocation="true" allowDefinition="Everywhere" allowExeDefinition="MachineToApplication" overrideModeDefault="Allow" restartOnExternalChanges="true" requirePermission="true" />
  </configSections>
  <CustomSection LastName="TEST" FirstName="TEST" />
</configuration> 
```

现在检索您的部分属性：

```
 CustomSection section = (CustomSection)ConfigurationManager.GetSection("CustomSection");
    string lastName = section.LastName;
    string firstName = section.FirstName; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-22T20:29:22.173

如果我可以摆脱它，我将只使用 App.Config，但是，如果我需要更复杂的东西，我将使用自定义配置部分。是的，刚开始了解是很痛苦的，但是在我看来，统一的配置源和熟悉的所有设置配置值得花时间投资。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-22T21:06:37.233

将您的配置放入数据库。如果您在多台机器上运行您的应用程序（例如客户端-服务器应用程序），那么所有每台机器的配置系统都是 PITA。单个配置区域是放置配置的最佳方式。写一个 gui 来管理它，你会很高兴的。

将 app.config 文件推广到 200 个客户端盒子……这并不好玩，尤其是当有人错过时（他们确实如此，相信我）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T20:38:30.717

我过去是一名网络/系统管理员，现在我为数据库应用程序开发内部实用程序。我发现的是这样的：

简单的非嵌套配置文件最适合那些不会改变他们访问资源的位置的应用程序。

任何更复杂的东西都需要通过管理 UI 进入数据库。这仅适用于普通业务用户。如果您担心数据库损坏，请使用复杂的配置文件方法。文件比数据库更容易损坏。

现在，如果您的用户是其他开发人员，那么您将在使用什么来存储配置方面拥有更大的灵活性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T20:33:19.030

我使用自定义 xml 配置文件，其中每个环境（dev/qa/prod）使用不同的配置文件。配置文件是动态实例化的模板，例如服务的主机/端口配置 - 这使得多环境和故障转移非常容易，因为它可以由模板实例化代码处理。

当然，如果您的配置很少并且不关心多个环境，那么 app.config 更标准并且可能是最好的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T20:34:54.470

我发现[NameValueCollectionHandler](http://msdn.microsoft.com/en-us/library/aa903356(VS.71).aspx)是最简单和最好的，我通常会通过 configSource 属性链接到外部配置文件。

我尝试将 ABSOLUTE MINIMUM 配置放在配置文件中，其中大部分配置在代码中，应用程序可以自行感知其部署环境（例如机器名称或 IP 地址，如果知道的话）。当然，这需要更多的预先规划和对环境的了解，但在部署时要少得多。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T10:53:36.980

我认为键/值配置对于简单的配置文件非常有效。当文件开始增长并且难以维护时，它就会成为一个问题。我们开始将配置文件拆分为“通用”和“特定”应用程序配置。文件访问对应用程序是透明的，“通用”值在大多数情况下是相同的，但每个部署的应用程序的“特定”值不同。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-02T23:51:08.197

我使用自定义 xml 配置文件。每个设置都有一个键、值和类型。

它有一个包含所有设置的主要部分和包含特定环境（开发、登台、实时）的设置覆盖的附加部分。这我不需要在部署时替换文件的某些部分。我有一个小包装器，您可以调用它来获取特定设置或包含所有这些设置的字典。

我最近创建了一个[T4 模板](http://www.olegsych.com/2007/12/text-template-transformation-toolkit/)，它将读取配置文件并创建一个静态强类型设置类。这是一个巨大的节省时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:30:16.260

我将大部分配置保存在 IoC 容器中，例如 Spring.Net。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T20:39:05.007

如果您有可用的 .NET 3.0，我发现 XamlReader/XamlWriter 对于存储设置非常方便。在以下情况下，他们可以将任何 .NET 对象写入/读取到 XAML：

*   该对象有一个无参数的构造函数
*   要读/写的属性具有公共 getter 和 setter

不必用任何属性来装饰设置对象，这一点特别好。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T21:02:34.967

当 app.config 不再适用时，dataset.WriteXML()/dataset.ReadXML() 对我来说效果很好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T08:36:18.230

大多数情况下，我更喜欢使用自定义 xml 文件和 Xml 序列化方法来读取和写入此配置文件...不限于键/值对并且实现起来并不复杂...

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T10:41:36.243

我很幸运地推出了自己的特殊类，该类从与调用程序集关联的“.settings”文件中返回配置数据。该文件是 XML，设置类将其公开为 XDocument。此外，此设置类的索引器从 /settings/setting 节点返回元素值。

适用于只需要键/值对访问设置的简单应用程序，适用于需要定义自己的结构并使用 System.Xml.Linq 查询 XML 文档的复杂设置。

滚动自己的另一个好处是，您可以使用 FileSystemWatcher 和回调 Action 类型在文件在运行时更改时自动触发方法。

# svn - 如何在 SVN 中分支单个文件？

> ID：117415
> 
> 赞同：9
> 
> 时间：2008-09-22T20:29:13.907
> 
> 标签：svn, version-control, branch

分支的颠覆概念似乎集中在为整个存储库创建一个 [un] 稳定的分支以进行开发。是否有创建单个文件分支的机制？

对于用例，请考虑一个具有多个特定于平台的源 (*.c) 实现的通用头 (*.h) 文件。这种类型的分支是永久性的。所有这些分支都会看到持续的发展，偶尔会出现跨分支合并。这与通常具有有限生命周期的不稳定开发/稳定发布分支形成鲜明对比。

我**不想**分支整个存储库（便宜与否），因为它会产生不合理的维护量以在主干和所有分支之间不断合并。目前我正在使用 ClearCase，它有一个不同的分支概念，这使得这很容易。我被要求考虑过渡到 SVN，但这种范式差异很重要。我更关心的是能够轻松地为单个文件创建替代版本，而不是像切割稳定的发布分支这样的事情。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T20:42:06.137

您不必分支整个存储库。您可以在项目中创建文件夹分支（例如包含文件夹）。正如其他人所指出的，您也可以只对单个文件进行“复制”。获得文件或文件夹的副本后，您“切换”到分支文件或文件夹以处理分支版本。

如果您在存储库中创建一个单独的分支文件夹，您可以通过服务器端命令将您的分支文件复制到那里：

```
svn 复制 svn://server/project/header.h svn://server/branched_files/header.h

```

然后您可以切换该文件以使用`branches_files`存储库路径

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T20:54:50.193

可悲的是，我认为这里真正的答案是 ClearCase 比 Subversion 更好地处理这种情况。使用颠覆，你必须分支*一切*，但 ClearCase 允许一种“懒惰分支”的想法，这意味着只有特定的一组文件被分支，其余的仍然遵循主干（或你指定的任何分支）。

此处提供的其他解决方案并不能真正按您的意愿工作，它们只是将文件复制到不同的路径。现在您必须做一些奇怪的事情才能实际使用该文件。

嗯，对不起。这真的不是一个很好的答案。但是 Subversion 并没有很好的解决方案。它的模型是分支合并。

编辑：好的，所以扩展 crashmstr 所说的内容。你可以这样做：

```
svn cp $REP/trunk/file.h $REP/branched_files/file.h
svn co $REP/trunk
svn switch $REP/branched_files/file.h file.h 
```

但是哇！，是不是很容易出错。每当您执行 svn st 时，您都会看到：

```
svn st
    S  file.h 
```

有点吵。而且，当您想在大型源存储库中分支一些文件或模块时，它会开始变得非常混乱。

实际上，这里可能有一个不错的项目，用于模拟 ClearCase 的带有 svn 属性的分支文件和切换，围绕 bog 标准 svn 客户端编写一个包装器来处理所有的混乱。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T21:45:23.100

这是我如何理解你的问题。您有以下树：

```
时间.h
时间.c

```

对于多种架构，您需要拒绝它：

```
time.h 很常见
time.c (for x386), time.c (for ia64), time.c (for alpha),...

```

同样在您当前的 VCS 中，您可以根据需要从 time.c 创建尽可能多的分支，当您从 VCS 签出文件时，您会自动检查公共主干中的最新 time.h 和分支中的最新 time.c你正在努力。

您担心的问题是，如果您在签出分支时使用 SVN，您将不得不经常从主干合并 time.h，或者冒着处理旧文件（与主干相比）的风险，这样的开销是不可接受的给你。

根据您的源代码的结构，可能会有一个解决方案。想象你有

```

/
/标题/
/headers/test.h
/来源/
/source/test.c

```

然后你可以分支 /，并使用[svn:externals](http://svnbook.red-bean.com/en/1.0/ch07s03.html)功能将你的标题链接到主干的头部。它仅适用于目录，并且在提交回 test.h 方面存在一些限制（您必须进入头目录才能使其工作）但它可以工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T20:33:43.990

Subversion“分支”只是存储库中某些内容的副本。因此，如果您想分支文件，您只需执行以下操作：

```
svn copy myfile.c myfile_branch.c 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T20:57:14.057

我认为分支单个文件没有多大意义？有没有办法用trunk代码测试它？

如果您想撤销更改并稍后应用它们，您可以使用补丁。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T21:03:46.820

您确定您*的 VCS 中*确实需要此功能吗？

为什么不使用 C 预处理器并 #ifdef 去掉不需要的代码？或任何类似的工具。

就像是：

```
// foo.h:
void Foo();

// foo_win32.c
#ifdef _WIN32
void Foo()
{
   ...
}
#endif

// foo_linux.c
#ifdef _GNUC
void Foo()
{
   ...
}
#endif 
```

有时，如果它不合适，那么它不是正确的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:35:54.077

SVN 中的一个分支只是一个副本。我相信要按照您希望的方式进行操作，您必须将文件的每个版本都放在存储库的单独目录中，并将其检出到您的源文件夹中。IE 将该文件视为一个单独的项目。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T21:52:54.017

Subversion 中的一个分支正是您所说的。所有文件都是主干的精确副本，您更改的文件除外。这就是 SVN Book 中谈到的“廉价复制”方法论。唯一需要注意的是需要不时将主干合并到分支中，以确保在那里所做的更改反映在分支中。当然，如果不需要这些更改，则不需要进行主干-> 分支合并。

允许自动合并主干更改（模拟 Clear Case 范例）的一种简单方法是使用预提交挂钩脚本在提交之前合并主干更改。（实际上，这始终是防止代码漂移的好策略）。

# vmware - 如何解决虚拟机的时钟漂移问题？

> ID：117422
> 
> 赞同：21
> 
> 时间：2008-09-22T20:30:22.670
> 
> 标签：vmware, clock, drift

我的虚拟机的时钟漂移非常明显。那里有关于处理这个问题的文档，但似乎没有什么工作得很好。

任何人都有任何建议，对他们有用的东西，...

据说通过 ntp 定期更新不是一个好的解决方案。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-03-07T06:34:37.653

1.  在听取任何人的意见之前，请仔细阅读 vmware 文档。我们正在运行 ESX5。

Linux 客人的计时最佳实践除其他外说：参考： http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId= [1006427](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1006427)

NTP 建议 注意：VMware 建议您使用 NTP 而不是 VMware Tools 定期时间同步。NTP 是行业标准，可确保您的客人保持准确的时间。您可能必须打开防火墙 (UDP 123) 以允许 NTP 流量。

这是一个示例 /etc/ntp.conf：

```
tinker panic 0
restrict 127.0.0.1
restrict default kod nomodify notrap
server 0.vmware.pool.ntp.org
server 1.vmware.pool.ntp.org
server 2.vmware.pool.ntp.org
driftfile /var/lib/ntp/drift 
```

这是一个示例（特定于 RedHat）/etc/ntp/step-tickers：

```
0.vmware.pool.ntp.org
1.vmware.pool.ntp.org 
```

配置指令 tinker panic 0 指示 NTP 在看到时间大幅跳跃时不要放弃。这对于应对较大的时间漂移​​以及从暂停状态恢复虚拟机非常重要。

注意：指令 tinker panic 0 必须位于 ntp.conf 文件的顶部。

不使用本地时钟作为时间源也很重要，通常称为无纪律本地时钟。当存在大量时间漂移时，NTP 倾向于回退到远程服务器而不是远程服务器。

这种配置的一个例子是：

```
server 127.127.1.0
fudge 127.127.1.0 stratum 10 
```

注释掉这两行。

更改 NTP 配置后，必须重新启动 NTP 守护程序。请参阅您的操作系统供应商的文档。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T22:33:03.860

vmware在这个问题上有[一个非常好的 PDF 文档。](http://www.vmware.com/files/pdf/Timekeeping-In-VirtualMachines.pdf)

基本上，主人会尽其所能地处理交付给客人的蜱虫。 **不要**像那样运行 NTP 或定时或垃圾。只需安装 vmware-guestd 并让主机完成您的任务。如果您仍然丢失滴答声，那么任何其他解决方案也会有很大的漂移。

如果可以，请使用具有低频率滴答率的客户操作系统。较新版本的 Linux 带有 1000Hz 的滴答声，但它曾经只有 100Hz。这对主机来说似乎更容易交付。通常需要重新构建内核来更改 HZ 值。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-17T14:51:08.530

只是添加一些关于为什么 NTPD 不是一个好的解决方案的数据。NTPD 是一个试图补偿本地时钟漂移的守护进程；如果“内部时钟”在一天内漂移了 X 秒，那么与其像“ntpdate”中的强制命令一样向前/向后跳跃，NTPD 会尝试向时钟添加/删除一些周期，以便及时，通常在 15 分钟内，时钟运行得足够准确，并且补偿克服了服务器在一天内获得/损失的 X 秒数。这样做的好处是您不会看到一天中的任何时间重复，这对于事务系统来说是必须的。

但为了能够做到这一点，NTPD 要求本地时钟做得相当好，这通常意味着本地时钟每天漂移不会超过 42 秒（或多或少；我不确定确切的数字）。这通常是虚拟机中的问题，因为时钟是软件控制的，所以如果主机过载过多，您会看到客户端的时钟会运行得更慢，如果没有，那么时钟也会运行快速地。NTPD 的问题是本地时钟不可靠，并且没有恒定的时间漂移​​；它可能或多或少取决于主机系统的过载。

所以在这种情况下，最好按照建议安装客户端工具，并将 CLIENT 时钟与 HOST 的时钟（通常称为“挂钟”）同步

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T12:52:55.033

没有明确的答案，因为存在多种方法，每种方法都有其优点和缺点。选择哪一个取决于您的任务、服务器负载、操作系统等。

阅读[vmware_timekeeping.pdf](http://www.vmware.com/pdf/vmware_timekeeping.pdf)以彻底了解该问题。

Linux 的快速食谱可以在单独的[知识库文章中找到](http://kb.vmware.com/kb/1006427)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-02-11T13:39:14.297

此问题的最佳解决方案是（如果本地连接）安装本地 NTP 服务器并将“服务 ntp 重新启动”置于无限循环中，睡眠时间约为 30 秒。通过在“/etc/init.d/rc.local”文件中编写代码。重新启动系统和时间将与服务器计算机同步。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T20:35:33.890

安装虚拟机添加（工具）不会同步来宾和主机操作系统之间的时钟吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:39:44.443

> 据说通过 ntp 定期更新不是一个好的解决方案

不过，这是我推荐的解决方案。为什么它在您的位置不被认为是好的？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:48:08.947

如果您还没有 NTP，请安装它。

ntpdate 将正确设置时钟，然后 ntpd 可以保持时钟准确。

[NTP 池项目](http://www.pool.ntp.org/)提供了大量可供选择的 NTP 服务器。

**编辑**刚刚注意到您说您认为 NTP 不是一个好的解决方案 - 为什么？如果您担心时钟变化的影响，NTP 是理想的选择，因为 ntpd 不会向前或向后跳时钟，而是通过稍微加快/减慢时钟的速度来“旋转”时钟，直到它重新与正确的时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-25T03:38:10.690

我有同样的问题并通过

1.  安装 vmware-guestd
2.  向内核发送一个选项clocksource=acpi_pm
3.  以 root 身份运行 hwclock -s 每小时。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-14T10:32:13.777

这是一个老问题，但最近影响了我们。我发现我们的任何运行 vmware 工具的虚拟机都受到了这个问题的影响。

最近我们开始使用 open-vm-tools 并且在那些 vm 上没有设置选项。由于 Vmware 完全支持和推荐 open-vm-tools，我建议在 vmware 工具上使用它：http: //kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId= [2073803](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2073803)

如果 open-vm-tools 在您使用的存储库中，则通过`yum install`or`apt-get install`等​​方式安装也很简单。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-09-22T20:38:04.743

您可以使用 cmd 和

```
net time \\computer_name /set 
```

远程设置时钟（或例如在脚本中）

# svn - 向现有项目添加版本控制

> ID：117426
> 
> 赞同：17
> 
> 时间：2008-09-22T20:30:37.710
> 
> 标签：svn, version-control

我正在从事一个已经发展到相当规模的项目，而且我是唯一的开发人员。我们目前不使用任何版本控制，但我肯定需要开始。

我想使用颠覆。将现有项目转移到它的最佳方式是什么？

我有一个用于开发新功能的测试服务器，然后将这些文件传输到 2 个生产服务器。是否有一个工具可以自动上传到测试，然后部署到实时服务器？

所有这些都是使用 Visual Studio 在 ASP.NET 中开发的（如果重要的话）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T20:35:07.637

要扩展上一个答案...

1) 创建一个新的 SVN 存储库
2) 提交你迄今为止工作的
所有代码 3) 再次检查所有代码，在你的开发机器上创建一个工作副本
4) 工作！

这绝对不是障碍，真的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-22T20:51:01.187

我没有看到任何人解决您的问题/帖子的这一部分：

> 是否有一个工具可以自动上传到测试，然后部署到实时服务器？

一个问题是 Subversion 在您的工作副本中创建隐藏的 .svn 文件夹。解决方案之一是使用 svn export 命令。这将在另一个没有 .svn 文件夹的目录上复制您的存储库。

据我所知，没有自动化工具可以做到这一点。您可以创建一个批处理文件，该文件将发出 svn export 命令，如下所示：

```
svn export C:\MyReporitosy\Path C:\DestinationPath 
```

只需将此作为部署过程的一部分。确保从这个导出的目录而不是您的工作副本部署您的代码。那你应该没事。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-02T22:13:27.737

+1 马特豪威尔的回答。

我不知道有多少次通过在 repo 中创建目录，将新项目导入其中，然后再次检查它来添加新项目。这就是为什么马特的回答是最好的：

1.  我创建了一个名为 FRED 的项目并做一些工作

2.  我在 SVN repo 中创建了一个目录，并将 FRED 导入其中。

3.  但是 FRED 目录仍然不受源代码控制 - 它缺少 .svn 文件，所以我需要检查它，进入一个新目录，我们称之为 FRED-NEW，重新创建所有文件

4.  然后我需要删除 FRED，这让我很紧张，有些东西在此过程中丢失或损坏。

正如马特所说，在 SVN 存储库中的文件夹仍然为空的情况下，请先检查一步：

1.  在 SVN 中创建一个目录并将其检出到 FRED-NEW。

2.  将 FRED-NEW/.svn 复制到 FRED/

3.  右键单击添加所有文件。FRED 现在处于源代码控制之下，无需重新创建和删除。

还是更好：

1.  在 SVN 中创建一个目录，然后在向其中添加文件之前，检查空目录直接进入 FRED。

2.  右键单击添加所有文件。

此外，如果您使用的是 CLI，并且在提交新文件后才想到这一点，请参阅下面的 alroc 回答：--force when check out into FRED。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-22T20:31:39.813

将您现有的基础导入 SVN 存储库，将其签出并重新开始工作。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T20:35:09.540

您应该查看与Visual Studio 无缝集成的[Visual SVN 。](http://www.visualsvn.com/VisualSVN)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T20:41:36.637

抛开技术问题不谈，只需获取 SVN 并开始使用它。您将看到直接的好处（查看代码历史记录、差异调试以了解哪些更改引入了上周未出现的错误），并且您将永远不想回头。

我个人不喜欢集成在 IDE 中的源代码控制。我使用与 Windows 资源管理器集成的[Tortoise SVN](http://tortoisesvn.tigris.org/)，让您可以直接从操作系统签入、比较、合并等文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-22T21:44:05.787

不需要 SVN 服务器。
使用 Tortoise Mercurial [http://sourceforge.net/project/showfiles.php?group_id=199155](http://sourceforge.net/project/showfiles.php?group_id=199155)

设置本地 repo
1) 下载并安装
2) 打开一个资源管理器窗口到你项目的基本目录
3) 右键单击​​ -> TortoiseHG -> 在此处创建存储库 -> 确定
4) 右键单击​​ -> HG 提交...
5 ) 输入您的提交评论，选择要跟踪的文件，然后单击提交

通过文件共享设置远程存储库（其他传输方法可用）
1）打开资源管理器窗口到远程文件夹
2a）右键单击 -> TortoiseHG -> 克隆存储库
2b）或者，只需将本地存储库复制到

提交本地后更新远程仓库
1) 打开资源管理器窗口到远程文件夹
2) 右键单击​​ -> TortoiseHG -> 同步
3) 在拉菜单中选择“更新到新提示”
4) 在“远程”中输入本地仓库的路径路径：”输入框 5) 点击拉取

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T20:35:50.897

Subversion 服务器安装... Subverison 客户端库安装...

安装 Ankh 以与 VS Install Tortoise 集成以进行文件管理器集成

在文件管理器中，右键单击具有解决方案的顶级方向...导入...

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T07:21:48.940

我想知道你为什么选择 Subversion？如果您的项目没有使用任何 vc，您可能应该考虑使用 Mercurial 或 Git。

他们的强项是他们不需要中央存储库，这意味着您的程序员可以签出您的项目，回家，工作（无需连接到您的服务器），然后第二天回到办公室并同步他们的存储库。

如果 SVN 不是市长要求，我建议考虑两个 dvc 系统中的任何一个。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T20:36:27.617

对于您需要的东西来说，这可能是多余的，但在一台机器上创建一个 SVN 存储库，然后在另一台机器上设置一个连续的集成服务器。TeamCity 是我推荐的一个。（如果硬件非常宝贵，您也可以使用虚拟 PC）

一旦构建完成并经过测试，这将允许您添加自定义构建步骤以部署到生产服务器上。

[TeamCity](http://www.jetbrains.com/teamcity/)了解更多信息。Thi 还为 Visual Studio 提供了一个插件

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T20:37:22.063

开始使用 Subversion 很容易。下载 TortoiseSVN，它将 SVN 集成到 Windows 资源管理器中。下载 AnkhSVN 进行 VS 集成。将 svnserve 设置为 Windows 服务（在文档中）。

然后你所做的就是从 svn 中检出一个空目录并将所有代码文件复制到其中。然后用 Tortoise 添加它们，然后提交。当您在 Visual Studio 中更改文件时，Ankh 会显示您更改了哪些文件，您可以在那里提交它们。

我们使用 NAnt 脚本进行所有部署，尽管您可能会发现批处理脚本和 xcopy 就足够了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T20:37:31.470

我对 Perforce 比 subversion 更熟悉，但是将项目置于版本控制之下并不难。

安装并运行版本控制软件后，清除代码目录中所有非源代码（例如，运行“make clean”）。然后使用该命令以递归方式将新文件添加到您的存储库。然后提交，你就完成了。我建议检查到另一台机器并至少构建一次，以确保您拥有构建所需的一切。

至于部署到服务器上，这并不是真正的版本控制问题。您通常会将其放入您的构建系统（即“make testinstall”、“make install”）或只编写 shell 脚本。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T20:44:19.127

+1 对乔和史蒂夫提供的答案。我还要提到设置您的忽略列表或 SVN 道具很重要，这样您就不会签入用户文件，重新设置。

还要确保包含构建可能需要的所有内容，例如构建脚本、第 3 方程序集、外部工具（例如 nunit、nant 等）

当您使用它时，我强烈建议您查看[CC.net](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)并安装持续集成服务器以自动化您的构建。

拥有源代码控制是一回事，正确使用它完全是另一回事。记得要经常和提早入住。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-22T20:46:24.303

简单的答案是 Subversion 和 Tortoise SVN。

我在 Visual Studio 中使用过 Subversion，并在现有项目中实现了它。有一个名为 Ankh 的免费 Visual Studio 插件，我使用它取得了一些成功。但是，我遇到了一些问题，即 Ankh 拒绝与 .svn 元数据中反映的文件的真实状态保持同步（当乌龟告诉我它是最新的时，它会坚持需要更新文件） ）。在这些情况下，重新启动视觉工作室解决了问题，但这对我来说是痛苦和乏味的。

目前，我停止使用 Ankh，只是在 VS 中正常工作，然后使用 Tortoise 和 Windows 资源管理器将它们签入/签出。这完美无缺。无需 VS 刷新或重新启动。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-22T20:48:54.950

1) 创建一个新的存储库 - 您可以在测试服务器上创建它，然后将其传输到专用服务器/NAS，如果它对您来说很简单的话。2) 将所有现有源代码导入存储库。3）您可以使用“svn”命令行工具（及其相关工具，如 svnadmin）创建一个批处理文件，该文件将自动上传和部署过程（后者当然与编译器相结合）。

您可以在此处找到更多信息： [SVN book](http://svnbook.red-bean.com/) - 只需开始阅读即可 - 您无需阅读全部内容即可开始运行 svn。 [MSBuild](http://en.wikipedia.org/wiki/MSBuild) - 微软的一个构建自动化平台，虽然它可能是一个矫枉过正，取决于你的项目的大小。

如果您将 Visual Studio 与批处理文件放在同一台计算机上，则[可以使用它来编译您的解决方案](http://devio.wordpress.com/2008/08/18/building-visual-studio-solutions-from-batch-file/)，尽管我怀疑您将来会遇到缩放问题。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-22T20:50:44.120

版本控制和部署是两个独立的问题（尽管一个好的版本控制系统可以使部署成为一个更加一致、可重现的过程）。设置好版本控制服务器后，您可以使用一组简单的脚本/批处理文件来自动检出代码并将其部署到服务器。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-23T07:09:28.237

要添加到以前的答案，我还建议明显（但应该明确）建议：

*   选择项目的稳定状态以导入存储库（无论您选择什么工具）
*   立即创建一个标签（或 SVN 中的标签），一旦导入完成并“检查”（如“它编译了吗？”，“我们是否获得了所有需要的设置文件？”，...）
*   想想在这个项目的生命周期中你需要做的不同的“开发工作”，这会让你对你的分支应该是什么样子有一个很好的了解。
    （当您正在开发下一个版本时，已经在生产中的旧版本的维护分支，合并分支以隔离复杂的合并，补丁分支，...）

现在，请注意：

> 是否有一个工具可以自动上传到测试，然后部署到实时服务器？

您问题的那一部分是指“**发布管理**”过程，这与“版本管理”*非常*不同。
我不确定您将选择的版本工具是否可以积极提供帮助。尤其是当您认为生产服务器上不应该有版本控制工具时（为了将生产服务器与任何工具的依赖性保持在最低限度：除了您的程序之外，应该只允许监控和报告工具 -例如，这里有一个 Web 服务器 -)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-23T07:39:19.630

除了关于将项目置于源代码控制下的实用性的所有其他评论之外，我鼓励您查看[Streamed Lines: Branching Patterns for Parallel Software Development](http://www.cmcrossroads.com/bradapp/acme/branching/)作为代码行和分支策略的指南 - 可能会为您节省一些重新- 以后工作。

此外， [Eric Sink](http://www.ericsink.com/index.html)收集了大量介绍各种源代码控制概念的帖子 - [Source Control HOWTO](http://www.ericsink.com/scm/source_control.html)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-23T07:47:17.910

我最近开始喜欢 Bazaar 的简单性，以解决在已经入侵应用程序一段时间后启动版本控制的问题。

对于 bazaar，实际上只有几个简单的命令：1) bzr init 2) bzr add [你感兴趣的文件] 3) bzr commit

请注意，这不会**设置**任何中央存储库。但你也可以这样做。

关于将它用作部署工具，我很确定我不久前读过一些关于它的东西。无论如何，文档真的很好。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-02-05T04:57:12.203

问题显然在 Subversion 上（SVN 是别名）。

这些是步骤：

```
1) Create a New Repository (if needed,  if using VisualSVN Server then very easy)
2) Right click on the Folder of which you want to put the folders and files into your repository 
3) With having the right click menu  go to TortoiseSVN
4) Choose IMPORT 
5) Place in trunk (best practice)

e.g.   https://computername:8443/svn/MyCoolCode/trunk 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2008-09-30T20:54:10.087

我在我的桌面上使用 mercurial，我喜欢它。创建存储库非常简单...

```
hg init /path/to/repository 
```

添加文件...

```
hg add /folder/pattern  

OR

hg add FILE 
```

那你就答应...

```
hg commit 
```

你已经启动并运行了。

另一个很棒的事情是当我想同步到我的笔记本电脑时，它只是......

```
hg pull //desktop_name/path/to/repo/  
hg update 
```

我喜欢 subversion 的地方是 Visual Studio 的插件，当状态图标一直盯着我看时，我会更多地关注我的更新。如果您要经常使用一个项目，该插件肯定可以弥补设置 svn 存储库的麻烦。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2013-09-23T12:50:05.223

问题显然集中在**现有**项目上。我还没有在这个线程中找到合适的答案，并且一直在玩，直到我找到解决方案。正如许多答案中所述，当您结帐时会遇到麻烦，并且您最终会得到第二个版本化文件夹，您现有的项目仍然没有版本化，并且您不愿意复制/粘贴和/或重命名您的文件夹。

这个问题的解决方法如下：

假设您在 PC1 中有一堆项目，所有项目都作为子文件夹收集在名为“Projects”的文件夹下，并且您希望在一个存储库中对所有项目进行版本控制。然后您想在具有相同文件夹结构的 PC2 上查看它。然后执行以下操作：

1.  在网络驱动器上为您的存储库创建一个文件夹，并确保将其命名为“Projects”，即**与您的开发项目的父文件夹同名**。例如，在网络驱动器上创建一个文件夹，如 X:\Repository\Projects。
2.  右键单击此文件夹并选择 TurtoiseSVN -> 在此处创建存储库
3.  右键单击 PC1（您现有的项目）上的开发“项目”文件夹，然后按 TurtoiseSVN -> 导入。选择名称为“Projects”的正确存储库（如果您在网络驱动器上已有其他存储库）。现在您的项目可供其他 PC 使用。
4.  在 PC2 上创建一个父文件夹，您希望在其中拥有“项目”文件夹。
5.  右键单击 PC2 上的此**父文件夹**并选择 SVN Checkout。这些项目现在可在 PC2 上使用。
6.  从现在开始，您使用“提交”将更改存储在存储库中，并使用“更新”从存储库中获取最新版本。

# c++ - 在 C++ 中处理大数？

> ID：117429
> 
> 赞同：22
> 
> 时间：2008-09-22T20:31:29.393
> 
> 标签：c++, biginteger, largenumber

在 C++ 中处理大型数字输入的最佳方法是什么（例如`10^100`）？

对于算法，我通常会切换到 ruby​​，有时我会使用字符串。

还有什么好的方法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T20:41:31.723

听起来您正在寻找一种输入任意精度数字的方法。这里有两个你可以使用的库：[GMP](http://gmplib.org/)和[MAPM](https://github.com/LuaDist/mapm)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-12-24T04:32:42.030

查看[](http://apcentral.collegeboard.com/apc/public/repository/ap01.pdf.lr_7928.pdf)**Owen Astrachan[**的 C++.pdf 中的大型整数案例研究。**](http://apcentral.collegeboard.com/apc/public/repository/ap01.pdf.lr_7928.pdf)我发现这个文件对详细介绍和代码实现非常有用。它不使用任何第 3 方库。我用它来处理大量数字（只要你有足够的内存来存储`vector<char>`）没有问题。**

 *** * *

**想法**：它通过将 big int 存储在 a 中来实现任意精度的整数类`vector<char>`。

```
vector<char> myDigits; // stores all digits of number 
```

然后是所有与大int相关的操作，包括`<<, >>, +, -, *, ==, <, !=, >, etc.`，都可以基于对 this 的操作来完成`char array`。

* * *

**代码味道**：这里是头文件，你可以在pdf文件中找到它的cpp和代码。

```
#include <iostream>
#include <string> // for strings
#include <vector> // for sequence of digits
using namespace std;

class BigInt
{
public:
    BigInt(); // default constructor, value = 0
    BigInt(int); // assign an integer value
    BigInt(const string &); // assign a string
    // may need these in alternative implementation
    // BigInt(const BigInt &); // copy constructor
    // ~BigInt(); // destructor
    // const BigInt & operator = (const BigInt &);
    // assignment operator
    // operators: arithmetic, relational
    const BigInt & operator += (const BigInt &);
    const BigInt & operator -= (const BigInt &);
    const BigInt & operator *= (const BigInt &);
    const BigInt & operator *= (int num);
    string ToString() const; // convert to string
    int ToInt() const; // convert to int
    double ToDouble() const; // convert to double
    // facilitate operators ==, <, << without friends
    bool Equal(const BigInt & rhs) const;
    bool LessThan(const BigInt & rhs) const;
    void Print(ostream & os) const;
private:
    // other helper functions
    bool IsNegative() const; // return true iff number is negative
    bool IsPositive() const; // return true iff number is positive
    int NumDigits() const; // return # digits in number
    int GetDigit(int k) const;
    void AddSigDigit(int value);
    void ChangeDigit(int k, int value);
    void Normalize();
    // private state/instance variables
    enum Sign{positive,negative};
    Sign mySign; // is number positive or negative
    vector<char> myDigits; // stores all digits of number
    int myNumDigits; // stores # of digits of number
};

// free functions
ostream & operator <<(ostream &, const BigInt &);
istream & operator >>(istream &, BigInt &);
BigInt operator +(const BigInt & lhs, const BigInt & rhs);
BigInt operator -(const BigInt & lhs, const BigInt & rhs);
BigInt operator *(const BigInt & lhs, const BigInt & rhs);
BigInt operator *(const BigInt & lhs, int num);
BigInt operator *(int num, const BigInt & rhs);
bool operator == (const BigInt & lhs, const BigInt & rhs);
bool operator < (const BigInt & lhs, const BigInt & rhs);
bool operator != (const BigInt & lhs, const BigInt & rhs);
bool operator > (const BigInt & lhs, const BigInt & rhs);
bool operator >= (const BigInt & lhs, const BigInt & rhs);
bool operator <= (const BigInt & lhs, const BigInt & rhs); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-22T20:38:54.787

您是否正在寻找如何对收到的大量输入执行操作？有一个[大整数 C++](http://mattmccutchen.net/bigint/ "大整数 C++")库（类似于 Java），允许您执行算术运算......

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-30T15:59:10.450

如果您希望为此目的编写自己的代码，请尝试使用字符串来存储大数字...然后您可以在它们上创建基本的操作，例如 + - / * ... 例如 -

```
#include <iostream>

using namespace std;

string add (string &s1, string &s2){
    int carry=0,sum,i;

    string  min=s1,
    max=s2,
    result = "";

    if (s1.length()>s2.length()){
        max = s1;
        min = s2;
    } else {
        max = s2;
        min = s1;
    }

    for (i = min.length()-1; i>=0; i--){
        sum = min[i] + max[i + max.length() - min.length()] + carry - 2*'0';

        carry = sum/10;
        sum %=10;

        result = (char)(sum + '0') + result;
    }

    i = max.length() - min.length()-1;

    while (i>=0){
        sum = max[i] + carry - '0';
        carry = sum/10;
        sum%=10;

        result = (char)(sum + '0') + result;
        i--;
    }

    if (carry!=0){
        result = (char)(carry + '0') + result;
    }       

    return result;
}

int main (){
    string a,b;

    cin >> a >> b;

    cout << add (a,b)<<endl;

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T20:32:57.097

假设您正在谈论输入数字，双精度将使您达到 1.7976931348623157 x 10^308

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-22T20:39:11.510

您可能想看看[gmplib](http://gmplib.org/)，一个用于 C 和 C++ 的任意精度数字处理库

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-22T20:44:15.133

如果您希望它准确，您需要一个用于处理大数字的库。Java 有 BigInt，无论你想取多少位数，它总是准确的，并提供对它们的数学运算。所有的源代码都包括在内，你可以转移它，但这真的不是 C++ 最擅长的——我会使用基于 JVM 的语言并使用其中一个大库。

除非您希望它变慢，否则我认为我不会为此使用 ruby​​，并且我假设由于您在谈论 C++，因此速度在某种程度上是设计考虑因素。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-22T20:48:14.360

正如其他人已经指出的那样，C++ 中有各种 bignum/任意精度库，您可能会发现它们很有用。如果不需要速度，我的印象是 Python 和 Lisp 默认都使用 bignums。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-05T18:28:57.887

考虑[boost::cpp_int](https://beta.boost.org/doc/libs/develop/libs/multiprecision/doc/html/boost_multiprecision/tut/ints/cpp_int.html)

```
#include <boost/multiprecision/cpp_int.hpp>
#include <iostream>

int main()
{
   using namespace boost::multiprecision;

   cpp_int u = 1;
   for(unsigned i = 1; i <= 100; ++i)
      u *= i;

   // prints 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000 (i.e. 100!)
   std::cout << u << std::endl;

   return 0;
} 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2010-10-09T17:06:46.673

好吧，我认为进行这种算术计算的最佳方法是使用字符串。将输入作为命令行参数提供，然后使用字符串函数（如`atoi()`和`itoa()`! 但是，嘿，这可以用于乘法和除法吗？我认为在`strlen`逻辑正常之前，以这种方式输入的字符串对于编译器的编程并不重要。

# c# - 开始使用 Linq，我需要什么？

> ID：117438
> 
> 赞同：10
> 
> 时间：2008-09-22T20:33:03.803
> 
> 标签：c#, .net, linq

基本上就是标题所说的。（请原谅我，因为我是 .NET 新手）

在我的部门，我们有一台运行 .net 3.5 的服务器，自从我进入本节以来，我一直在使用 LINQ。但是，我正在另一台服务器上开始一个个人项目（显然），所以有两个问题：

我需要什么来启动和运行 LINQ？

服务器运行 LINQ 需要什么？

.net 2.0 可以在服务器上运行吗？

如果重要的话，后面的代码将是 C#。

**编辑：** 我必须在 3.5 中编译它还是 2.0 可以工作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T21:00:19.247

要启动并运行，我绝对建议您查看[LINQ in Action](https://rads.stackoverflow.com/amzn/click/com/1933988169 "LINQ 在行动")。

![替代文字](https://i.stack.imgur.com/MextA.jpg)

您的编译器需要是[.NET 3.5 框架](http://www.microsoft.com/downloads/details.aspx?FamilyId=333325FD-AE52-4E35-B531-508D977D32A6&displaylang=en)。如果您只复制已编译的代码，那么您的服务器上**不需要 3.5**，您只需要在您的开发机器上使用它。如果您的服务器管理员不愿意在您的服务器上安装 3.5 框架，这会有所帮助。但是，如果您要发布源代码，例如对开发服务器进行编译，那么是的，该服务器将需要 3.5。

安装 3.5 框架后，您可以将 Web 应用程序作为 2.0 或 3.5 运行。您所要做的就是在您的[Web.Config](http://www.4guysfromrolla.com/articles/121207-1.aspx)文件中指定它。

如果您对使用 LINQ to SQL 和管理 dbml 文件感兴趣，您将需要[Visual Studio 2008](http://msdn.microsoft.com/en-us/vstudio/products/cc533447.aspx "Visual Studio 2008 速成版")。但是，Visual Studio 2005 仍然可以正确编译 dbml 文件，前提是您安装了 3.5 框架。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T20:44:33.120

我鼓励您查看[LinqPad](http://www.linqpad.net/)作为学习工具。它是一个独立的应用程序，可让您使用 Linq 查询，而不必担心让它在服务器上运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T20:45:15.193

可能应该阅读关于 LINQ 的 Scott Guthries 系列文章：

以下是各个 8 个部分的链接。如果我没有弄错的话，你将需要框架 3.5。

包含详细分步说明的系列从这里开始：[第 1 部分](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-22T20:45:53.337

您实际上只需要在开发机器上安装 .net 3.5。如果服务器上有 2.0 SP1，并且将 3.5.0.0 版本项目中的所有 .net 引用设置为“复制本地”，则可以在 2.0 机器上运行 3.5 可执行文件。
[让它看起来像这样 http://img90.imageshack.us/img90/4217/35haxxx2.png](http://img90.imageshack.us/img90/4217/35haxxx2.png)

附带说明一下，您可能必须删除 yourexecutable.exe.config 才能运行它。由于某种原因，2.0 sp1 与 3.5 创建的 .configs 存在问题

我目前有两个使用此设置运行的实时应用程序，它运行良好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T20:37:20.907

我假设您正在专门讨论[LINQ to SQL](http://msdn.microsoft.com/en-us/library/bb425822.aspx)。

您只需要在开发机器和服务器上安装框架的 v3.5。

服务器不运行 linq；linq 最终会将 SQL 语句发送到您的服务器。

语言无所谓。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-07T13:22:54.010

您的服务器上至少必须有 .Net 2.0 sp1，并且您必须在本地复制少量程序集，例如 System.core 等...

但如果没有 SP1，由于 System.dll 中的问题，您将无法执行 LINQ 代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T20:41:55.233

LINQ 需要框架 3/3.5，因为它使用了很多 3/3.5 的扩展（扩展方法、lambda 表达式 Func<> 委托等）。然后它不适用于 2.0 版本。

如果您在本地 PC 上使用 linq 开发项目，只需将标准部署（例如复制 dll、aspx 等）部署到服务器生产环境，它就可以工作。无需特殊操作。

我希望我能帮助你

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T20:43:26.307

LINQ 在 .NET CLR 2.0 运行时上运行，但为了能够编译和使用您的 LINQ 代码，您需要 .NET 3.5（C# 3.0 编译器），因为 .NET 3.5 向框架中添加了一些与 LINQ 相关的程序集。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T20:47:21.740

LINQ 需要 .NET v3.5

[Joseph Albahari 的 LINQPad](http://www.linqpad.net/)是了解和实践 LINQ 的绝佳工具

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T20:56:19.833

好的，首先是关于 .NET 3.5 的事情。3.5 的运行时 (CLR) 仍然与 .NET 2.0 中的相同。有一堆新的库加上（除其他外）一个新的 C#-Compiler。

因此，理论上要**运行**LINQ，您只需安装 .NET 2.0 并将一些额外的程序集放入 GAC。如果您想知道哪些，请将此添加到您的问题中，我现在懒得查了。

如果可以，只需在您的服务器上安装[.NET 3.5 Framework](http://download.microsoft.com/download/6/0/f/60fc5854-3cb8-4892-b6db-bd4f42510f28/dotnetfx35.exe)，是的，所有 .NET 2.0 程序都将像以前一样在那里工作。不过不要忘记扫描[自述](http://download.microsoft.com/download/9/a/e/9ae0f6cc-7032-408e-9ca7-989f9e4af4ec/dotNetReadMe.htm)文件 :-)

不过，我不太明白您的“我需要什么才能启动和运行”的问题。您想了解 LINQ 吗？试试[LinqPad](http://www.linqpad.net/)。您想使用 LINQ 开发解决方案吗？然后至少我会推荐[VS2008 Express](http://www.microsoft.com/express/vcsharp/)。

要编译 LINQ 表达式，您必须使用不在 .NET 2.0 框架中的 C# 3.0 编译器。如上所述，该编译器的**输出**与 .NET 2.0 兼容。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T00:19:42.603

ZAIN Naboulsi 有一些 LINQ 好东西。看看他们！

[http://blogs.msdn.com/zainnab/archive/2008/03/29/collection-of-linq-resources.aspx](http://blogs.msdn.com/zainnab/archive/2008/03/29/collection-of-linq-resources.aspx)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T01:17:43.963

按照[Hooked on LINQ 继续学习 LINQ](http://www.hookedonlinq.com/MainPage.ashx)

# java - 我可以使用 Terracotta 来扩展 RAM 密集型应用程序吗？

> ID：117455
> 
> 赞同：7
> 
> 时间：2008-09-22T20:36:31.143
> 
> 标签：java, scalability, amazon-ec2, terracotta

我正在评估 Terracotta 以帮助我扩展当前受 RAM 限制的应用程序。它是一个协同过滤器，每个用户存储大约 2 KB 的数据。我想使用 Amazon 的 EC2，这意味着我被限制为 14GB 的 RAM，这为我提供了大约 700 万用户的有效每服务器上限。我需要能够超越这个规模。

根据我目前的阅读情况，我认为 Terracotta 的集群堆可以大于每台服务器上的可用 RAM。拥有一个 30GB 或更多的有效集群堆，其中每台服务器仅支持 14GB 是否可行？

每个用户的数据（其中大部分是浮点数组）变化非常频繁，可能每分钟数十万次。没有必要将这些更改中的每一项都在发生时同步到集群中的其他节点。是否可以只定期同步一些对象字段？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T21:25:37.423

我会说答案是肯定的。Terracotta 确实允许您使用大于单个 JVM 大小的集群堆，尽管这不是最常见的用例。

您仍然需要记住 a) 工作集大小和 b) 数据流量。对于 a)，有一些数据必须在内存中才能在任何给定时间执行工作，如果工作集大小 > 堆大小，性能显然会受到影响。对于 b)，在集群堆中添加/更新的每条数据都必须发送到服务器。当您更改 pojo 图中的细粒度字段时，Terracotta 是最好的。使用大阵列并没有充分利用 Terracotta 的功能（这并不是说人们有时不会那样使用它）。

如果您正在创建大量垃圾，那么 Terracotta 内存管理器和分布式垃圾收集器必须能够跟上它。如果不尝试，很难说您的数据量是否超过了那里的可用带宽。

如果您运行多个服务器并且数据按服务器分区或具有一定数量的参考位置，您的应用程序将受益匪浅。在这种情况下，您只需要堆中一台服务器分区的数据，其余的不需要故障存储到内存中。如果其他服务器出现故障，如果需要故障转移/可用性，它当然会出现故障。这意味着在分区数据的情况下，您不会向所有节点广播，而只会将事务发送到服务器。

从数字的角度来看，可以索引 30GB 的数据，因此这并不接近任何硬限制。

# c# - 我可以使用无符号右移防止 C# 中的整数溢出吗？

> ID：117461
> 
> 赞同：6
> 
> 时间：2008-09-22T20:37:14.853
> 
> 标签：c#, bit-shift, integer-overflow

我希望 alwaysPositive 被分配一个正数，其中 lareValue1 和 largeValue2 的所有可能值（这些至少为 1）。

以下语句导致缓冲区溢出：

```
int alwaysPositive = (largeValue1 + largeValue2) / 2; 
```

我知道我可以通过减去和添加来防止它：

```
int alwaysPositive = largeValue1 + ((largeValue2 - largeValue1) / 2); 
```

但在其他编程语言中，我可以使用无符号位移位来解决问题：

```
int alwaysPositive3 = (largeValue1 + largeValue2) >>> 1; 
```

我怎样才能在 C# 中做到这一点？

* * *

下面的答案都解决了这个问题。可能有很多方法可以做到这一点，但它们（包括我的解决方案）都有一个共同点：它们看起来都被混淆了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T21:10:32.823

```
int alwaysPositive = (largeValue1 >> 1) + (largeValue2 >> 1) + (largeValue1 & largeValue2 & 0x01); 
```

上面的想法是，如果您在添加结果之前预先划分结果，那么您将避免溢出，因为两个高位都将被取消设置。然后，如果两者都是正数（向下舍入），则添加一些轻微的校正逻辑以将值增加一。如果您只关心其中一个是否为正（四舍五入），那么您可以将其更改为

```
int alwaysPositive = (largeValue1 >> 1) + (largeValue2 >> 1) + ((largeValue1 | largeValue2) & 0x01); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T21:48:43.840

`unchecked((largeValue1 + largeValue2) >> 1)`是另一种选择。

请参阅[未选中关键字](http://msdn.microsoft.com/en-us/library/a569z7k8.aspx)的文档。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T20:48:36.090

你可以这样做：

```
 x = largeValue1;
  y = largeValue2; 
  return (x&y)+((x^y)/2); 
```

这是一种获得两个整数的平均值而不会溢出的方法。

如果你愿意，你可以用位移替换除以二，但编译器无论如何都会为你做这件事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T21:38:27.920

```
try
{
    checked { alwaysPositive3 = (largeValue1 + largeValue2); }
}
catch (OverflowException ex)
{
   // Corrective logic
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T20:45:25.023

你可以使用单位：

```
uint alwaysPositive = (uint)(largeValue1 + largeValue2) / 2; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T20:46:13.397

不是吹毛求疵，而是您的意思是“整数溢出”而不是“缓冲区溢出”。

我不知道 C#，所以可能有另一种方法，但你可以通过屏蔽最高位来模拟无符号移位： (x >> 1) & 0x80000000

# html - 如何将动态站点变成可以从 CD 演示的静态站点？

> ID：117467
> 
> 赞同：9
> 
> 时间：2008-09-22T20:38:09.237
> 
> 标签：html, web-crawler, static-site

我需要找到一种方法来抓取我们公司的一个 Web 应用程序，并从中创建一个静态站点，该站点可以刻录到 cd 上，供旅行销售人员用来演示该网站。后端数据存储分布在很多很多系统上，因此简单地在销售人员笔记本电脑上的虚拟机上运行站点是行不通的。他们在某些客户端（没有互联网，手机......原始，我知道）时将无法访问互联网。

有没有人对可以处理链接清理、flash、一点 ajax、css 等事情的爬虫有什么好的建议？我知道可能性很小，但我想在我开始编写自己的工具之前我会在这里提出这个问题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-22T20:40:18.153

通过使用[WebCrawler](http://en.wikipedia.org/wiki/Web_crawler)，例如其中之一：

*   DataparkSearch 是根据 GNU 通用公共许可证发布的爬虫和搜索引擎。
*   GNU Wget 是一个命令行操作的爬虫，用 C 语言编写并在 GPL 下发布。它通常用于镜像 Web 和 FTP 站点。
*   HTTrack 使用网络爬虫创建网站的镜像以供离线查看。它是用 C 语言编写的，并在 GPL 下发布。
*   ICDL Crawler 是一个用 C++ 编写的跨平台网络爬虫，旨在仅使用计算机的免费 CPU 资源来爬取基于网站解析模板的网站。
*   JSpider 是一个在 GPL 下发布的高度可配置和可定制的网络蜘蛛引擎。
*   塞巴斯蒂安·艾莱雷 (Sebastien Ailleret) 的拉宾
*   Andreas Beder 的 Webtools4larbin
*   Methabot 是一个速度优化的网络爬虫和命令行实用程序，用 C 语言编写，并在 2 条款 BSD 许可证下发布。它具有广泛的配置系统、模块系统，并支持通过本地文件系统、HTTP 或 FTP 进行定向爬取。
*   Jaeksoft WebSearch 是基于 Apache Lucene 构建的网络爬虫和索引器。它是在 GPL v3 许可下发布的。
*   Nutch 是一个用 Java 编写并在 Apache 许可下发布的爬虫。它可以与 Lucene 文本索引包结合使用。
*   Pavuk 是一个命令行网络镜像工具，带有可选的 X11 GUI 爬虫，并在 GPL 下发布。与 wget 和 httrack 相比，它具有许多高级功能，例如。基于正则表达式的过滤和文件创建规则。
*   WebVac 是斯坦福 WebBase 项目使用的爬虫。
*   WebSPHINX (Miller and Bharat, 1998) 由实现多线程网页检索和 HTML 解析的 Java 类库和用于设置起始 URL、提取下载数据和实现基本文本的图形用户界面组成 -基于搜索引擎。
*   WIRE - Web Information Retrieval Environment [15] 是一个用 C++ 编写并在 GPL 下发布的网络爬虫，包括一些用于调度页面下载的策略和一个用于生成下载页面的报告和统计信息的模块，因此它已用于网络表征.
*   LWP::RobotUA (Langheinrich, 2004) 是一个 Perl 类，用于实现在 Perl 5 许可下分发的行为良好的并行网络机器人。
*   Web Crawler .NET 的开源 Web 爬虫类（用 C# 编写）。
*   Sherlock Holmes Sherlock Holmes 在本地和网络上收集和索引文本数据（文本文件、网页等）。Holmes 由捷克门户网站 Centrum 赞助和商业使用。Onet.pl 也使用它。
*   YaCy，一个免费的分布式搜索引擎，建立在对等网络的原则之上（根据 GPL 许可）。
*   Ruya Ruya 是一个开源、高性能、广度优先、基于级别的网络爬虫。它用于以良好的方式爬取英文和日文网站。它是在 GPL 下发布的，完全用 Python 语言编写。SingleDomainDelayCrawler 实现遵循 robots.txt 并具有抓取延迟。
*   Universal Information Crawler 快速开发的网络爬虫。Crawls 保存和分析数据。
*   代理内核 爬取时用于调度、线程和存储管理的 Java 框架。
*   蜘蛛新闻，关于在 perl 中构建蜘蛛的信息。
*   Arachnode.NET 是一个开源混杂网络爬虫，用于下载、索引和存储 Internet 内容，包括电子邮件地址、文件、超链接、图像和网页。Arachnode.net 使用 SQL Server 2005 用 C# 编写，并在 GPL 下发布。
*   dine 是一个多线程的 Java HTTP 客户端/爬虫，可以用在 LGPL 下发布的 JavaScript 进行编程。
*   Crawljax 是一个基于动态构建“状态流图”的方法的 Ajax 爬虫，该方法对 Ajax 应用程序中的各种导航路径和状态进行建模。Crawljax 是用 Java 编写的，并在 BSD 许可下发布。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2018-01-25T21:30:37.420

只是因为没有人复制粘贴一个工作命令......我正在尝试......十年后。:D

```
wget --mirror --convert-links --adjust-extension --page-requisites \
--no-parent http://example.org 
```

它对我来说就像一个魅力。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T20:41:45.890

wget 或 curl 可以递归地跟踪链接并镜像整个站点，因此这可能是一个不错的选择。您将无法使用网站的真正交互式部分，例如搜索引擎或任何修改数据的东西，尽管如此。

是否有可能创建可以在销售人员的笔记本电脑上运行的虚拟后端服务，应用程序可以与之交互？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T20:42:35.107

如果不将网络服务器刻录到 CD，您将无法处理诸如 AJAX 请求之类的事情，我知道您已经说过这是不可能的。

[wget](http://www.gnu.org/software/wget/)将为您下载站点（使用 -r 参数表示“递归”），但任何动态内容（如报告等）当然都无法正常工作，您只会得到一个快照。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T16:38:39.913

如果你最终不得不从网络服务器上运行它，你可能想看看：

[ServerToGo](http://www.server2go-web.de/index.html)

它允许您从 CD 上运行 WAMPP 堆栈，并提供 mysql/php/apache 支持。db 在启动时被复制到当前用户的临时目录，并且可以完全运行而无需用户安装任何东西！

# wpf - BAML 反编译器/查看器

> ID：117469
> 
> 赞同：13
> 
> 时间：2008-09-22T20:38:26.850
> 
> 标签：wpf, decompiling, baml

除了不处理路径几何/数据的反射器的 BAML 查看器插件之外，任何人都可以推荐一个好的 BAML 反编译器/查看器吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T12:02:09.920

您可能想再看一下反射器的 BAML 插件，因为它最近由 Andrew Smith 更新。看看他的[博](http://agsmith.wordpress.com/2008/09/24/path-data-prefixes-and-known-colors/)文，你会注意到他已经解决了路径数据的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-28T13:34:18.367

你可以试试[Cristian Ricciolo Civera](http://blogs.windowsclient.net/ricciolocristian/archive/2008/04/05/styles-explorer-baml-decompiler.aspx)的[这个](http://www.codeplex.com/stylesexplorer)。

我不想使用它的 ClickOnce 安装程序，但 CodePlex 站点提供了一个 zip 文件供下载。

我必须加入 GAC`Ricciolo.StylesExplorer.exe`才能`Ricciolo.StylesExplorer.MarkupReflection.dll`使其发挥作用。我想这就是安装首先要做的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-03-27T16:56:56.900

BAML 源可以在 **[ILSpy](http://ilspy.net/)**中查看。
只需加载已编译的托管代码，找到并单击 *.baml 文件即可看到源代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T07:31:07.153

[样式浏览器](http://blogs.windowsclient.net/ricciolocristian/archive/2008/04/05/styles-explorer-baml-decompiler.aspx)

自己还没有尝试过，但值得一试

# sql - 在运行时过滤掉 SQL 数据库中的重复值 - 基于集合

> ID：117471
> 
> 赞同：0
> 
> 时间：2008-09-22T20:38:33.417
> 
> 标签：sql, filtered-lookup

我有一个数据库问题，我目前无法用简单的解决方案解决这个问题。在我的数据库中，我有一个存储事件值的表。0 和 1 带有时间戳。问题是同一事件可能作为业务规则发生两次。像下面

*   '2008-09-22 16:28:14.133', 0
*   '2008-09-22 16:28:35.233', 1
*   '2008-09-22 16:29:16.353', 1
*   '2008-09-22 16:31:37.273', 0
*   '2008-09-22 16:35:43.134', 0
*   '2008-09-22 16:36:39.633', 1
*   '2008-09-22 16:41:40.733', 0

在现实生活中，这些事件是循环的，我试图查询以获取这些事件的循环，但我需要忽略重复值（ 1,1 ）当前的解决方案是使用 SQL 游标循环每个并抛出值如果以前是一样的。我考虑过在插入时使用触发器来清理后处理表，但我想不出一个简单的解决方案来基于这个集合。

有什么想法或建议吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T20:53:20.807

（前言.......我只在oracle中做过这个，但我很确定数据库是否支持触发器这一切都是可能的）

有一个插入前触发器，它选择具有最大时间戳值的行。如果该行的值与您要插入的值相同，请忽略它。

这应该使它们都处于正确的状态。

现在，如果您需要存储两组状态，则触发器始终可以在全包表上插入，但仅在值更改时才在“过滤”表上进行查找和插入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T20:55:12.253

只是为了让我理解这个问题。

如果您根据时间戳对行集进行排序，有时会出现相邻的*重复值，例如上述第 2 项和第 3 项中的一对 1？*然后你在第 4 和第 5 有双 0，是这样吗？

并且您想要对应对中的最后一个（或序列，如果有超过 2 个）？

为什么需要删除它们？我之所以问是因为除非它们在此表的大小中占据很大份额，否则当您需要处理或显示它们时，可能更容易像按顺序一样将它们过滤掉。

一种解决方案，虽然不是一个很好的解决方案，但将检索高于您正在检查的当前行的时间戳的最小时间戳*，*然后从中检索值，如果相同，则不要返回当前行.

这是获取所有内容的 SQL：

```
SELECT timestamp, value
FROM yourtable 
```

以下是如何加入以获得高于当前时间戳的最小时间戳：

```
SELECT T1.timestamp, MIN(T2.timestamp) AS next_timestamp, T1.value
FROM yourtable T1, yourtable T2
WHERE T2.timestamp > T1.timestamp
GROUP BY T1.timestamp, T1.value 
```

（我担心上面的查询会非常慢）

然后检索与该最小时间戳对应的值

```
SELECT T3.timestamp, T3.value
FROM (
    SELECT T1.timestamp, MIN(T2.timestamp) AS next_timestamp, T1.value
    FROM yourtable T1, yourtable T2
    WHERE T2.timestamp > T1.timestamp
    GROUP BY T1.timestamp, T1.value
) T3, yourtable AS T4
WHERE T3.next_timestamp = T4.timestamp
  AND T3.value <> T4.value 
```

不幸的是，这不会产生最后一个值，因为它需要一个后续值来比较。一个简单的虚拟哨兵值（如果需要，您可以将其合并）将处理该问题。

这是我测试上述查询的 sqlite 数据库转储：

```
BEGIN TRANSACTION;
CREATE TABLE yourtable (timestamp datetime, value int);
INSERT INTO "yourtable" VALUES('2008-09-22 16:28:14.133',0);
INSERT INTO "yourtable" VALUES('2008-09-22 16:28:35.233',1);
INSERT INTO "yourtable" VALUES('2008-09-22 16:29:16.353',1);
INSERT INTO "yourtable" VALUES('2008-09-22 16:31:37.273',0);
INSERT INTO "yourtable" VALUES('2008-09-22 16:35:43.134',0);
INSERT INTO "yourtable" VALUES('2008-09-22 16:36:39.633',1);
INSERT INTO "yourtable" VALUES('2008-09-22 16:41:40.733',0);
INSERT INTO "yourtable" VALUES('2099-12-31 23:59:59.999',2);
COMMIT; 
```

这是（格式化的）输出：

```
timestamp                 value
2008-09-22 16:28:14.133   0
2008-09-22 16:29:16.353   1
2008-09-22 16:35:43.134   0
2008-09-22 16:36:39.633   1
2008-09-22 16:41:40.733   0 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T21:08:41.597

这个问题实际上是一个数据捕获问题。典型的数据库引擎不是解决它的好选择。一个简单的预处理器应该检测输入数据集的变化并只存储相关数据（时间戳等）。

一个简单的解决方案是在数据库环境中（例如在 Oracle 中）创建一个包，该包可以具有本地内存变量，用于存储最后输入的数据集并消除不需要的数据库访问。

当然，您可以使用数据库环境的所有功能来定义“输入数据集的变化”并存储过滤后的数据。因此，它可能很简单，也可能很复杂，如您所愿。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T21:12:05.677

这使用 SQL Server 公用表表达式，但它可以内联，表 t 具有列 dt 和循环状态：

```
;WITH Firsts AS (
    SELECT t1.dt
        ,MIN(t2.dt) AS Prevdt
    FROM t AS t1
    INNER JOIN t AS t2
        ON t1.dt < t2.dt
        AND t2.cyclestate <> t1.cyclestate
    GROUP BY t1.dt
)
SELECT MIN(t1.dt) AS dt_start
    ,t2.dt AS dt_end
FROM t AS t1
INNER JOIN Firsts
    ON t1.dt = Firsts.dt
INNER JOIN t AS t2
    ON t2.dt = Firsts.Prevdt
    AND t1.cyclestate <> t2.cyclestate
GROUP BY t2.dt
    ,t2.cyclestate
HAVING MIN(t1.cyclestate) = 0 
```

# windows - 如何在 Windows 下嗅探 USB 端口？

> ID：117474
> 
> 赞同：46
> 
> 时间：2008-09-22T20:39:03.867
> 
> 标签：windows, usb, sniffing, usbserial

有时，我需要在 Windows 下转储 USB 流量，主要是为了支持 Linux 下的硬件，所以我的主要目标是生成转储文件用于协议分析。

对于 USB 流量，[SniffUsb](https://web.archive.org/web/20151218000528/http://www.pcausa.com/Utilities/UsbSnoop/default.htm)似乎是明显的赢家……它在 Windows XP 下工作（但*不是*更高版本），并且具有比早期版本更好的 GUI。它会产生*巨大的*转储文件，但一切都在那里。

然而，我的设备实际上是一个 USB 串行设备，所以我求助于[Portmon](http://technet.microsoft.com/en-us/sysinternals/bb896644.aspx)，它可以在没有 USB 开销的情况下嗅探串行端口流量。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2014-09-12T05:02:09.320

经过五年的等待，现在可以在 Windows 上嗅探 USB 数据包

有关快速浏览，请参见[http://desowin.org/usbpcap/tour.html](http://desowin.org/usbpcap/tour.html)。它工作得很好

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-02-19T23:31:01.893

1.  由于人们似乎没有意识到这一点，[Wireshark](https://wiki.wireshark.org/CaptureSetup/USB#Windows)确实监控 USB 流量并有一个解析器。但问题是它只适用于 Linux。Windows 上的 Wireshark 不会这样做。

2.  可以插入您要监控的 USB 设备、Linux 机器（运行 Wireshark）和您的 Windows 机器，然后在 Windows 下使用 USB 设备。

3.  以上有问题吗？我不知道Linux机器或Windows机器如何相互检测。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-08-31T21:59:23.637

[Busdog 是一个托管在 github 上](https://github.com/djpnewton/busdog)的开源项目，对我来说效果很好。它安装了一个驱动程序以允许它监视 USB 通信。配置窗口允许您随时重新安装或删除设备。

您可以从枚举列表中选择所需的 USB 设备。一个不错的功能是让它自动跟踪插入的新设备：

[![枚举的 USB 设备](https://i.stack.imgur.com/0KMt8.png)](https://i.stack.imgur.com/0KMt8.png)

与我进行逆向工程的 SWR 分析仪之间的数据通信被完美地捕获：

[![捕获的 USB 到串行端口通信](https://i.stack.imgur.com/Beov7.png)](https://i.stack.imgur.com/Beov7.png)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-22T21:48:14.950

[USBSnoop](http://sourceforge.net/projects/usbsnoop/)也可以工作——而且是免费的。

或者，您可以购买**USB 转以太网**转换器并使用您喜欢的任何网络嗅探器来查看数据。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-22T21:46:12.020

就个人而言，我会使用[QEMU](http://en.wikipedia.org/wiki/QEMU)或[KVM](http://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine)并检测他们的 USB 直通代码，然后使用[libusb](http://en.wikipedia.org/wiki/Libusb)在用户空间中对替换驱动程序进行原型设计（我以前做过后一点；[用 Python 编写 USB 设备驱动程序](http://pyusb.berlios.de/)很有趣！）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-07-19T09:30:22.780

Microsoft Message Analyzer 能够使用`Device and Log File`MS 的解析器捕获 USB 流量：[链接](https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/capture-and-view-ing-usb-traces-with-microsoft-message-analyzer-)

更新：正如@facetus 所述，MS Message Analyzer[已于 2019 年 11 月 25 日](https://docs.microsoft.com/en-us/openspecs/blog/ms-winintbloglp/dd98b93c-0a75-4eb0-b92e-e760c502394f)停用。

# python - 将任意文本格式化为漂亮的 HTML 的 Python 模块的名称是什么？

> ID：117477
> 
> 赞同：10
> 
> 时间：2008-09-22T20:39:11.933
> 
> 标签：python, formatting, markup

不久前，我遇到了一个 Python 库，它可以将常规文本格式化为 HTML，类似于 Markdown、reStructuredText 和 Textile，只是它根本没有语法。它仅检测到缩进、引号、链接和换行符/段落。

不幸的是，我丢失了图书馆的名称，无法谷歌它。有人有什么想法吗？

**编辑：** reStructuredText aka rst == docutils。那不是我要找的:)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T21:41:26.777

好的。我现在找到了。它被称为[PottyMouth](http://glyphobet.net/pottymouth/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T21:40:15.640

[python 中的Markdown是](http://www.freewisdom.org/projects/python-markdown/)[基于 perl 的 markdown](http://daringfireball.net/projects/markdown/)实用程序的 python 实现。

Markown 将各种形式的结构化文本转换为有效的 html，其中一种支持的形式就是纯 ascii。使用非常[简单](http://www.freewisdom.org/projects/python-markdown/Command_Line)。

```
python markdown.py input_file.txt > output_file.html 
```

Markdown 也可以很容易地[称为模块](http://www.freewisdom.org/projects/python-markdown/Using_as_a_Module)：

```
import markdown
html = markdown.markdown(your_text_string) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T20:48:51.643

[Sphinx](http://sphinx.pocoo.org/)是一个使用 reStructuredText 的文档生成器。挺不错的，虽然我个人没用过。

[编译 python 文本的Hazel Tree](http://sphinx.pocoo.org/)网站使用 Sphinx，新的 Python 文档也是如此。

# windows - 如何在 Windows 上更新 Perl 而不会丢失模块？

> ID：117481
> 
> 赞同：11
> 
> 时间：2008-09-22T20:39:22.930
> 
> 标签：windows, perl, upgrade, perl-module

在工作中，我在 Windows 上使用 Perl 5.8.0。

当我第一次安装 Perl 时，我去了 CPAN，下载了所有源代码，做了一些更改（在 .MAK 文件（？）中以支持线程，或类似的东西），然后`nmake`/ `nmake test`/ `nmake install`。然后，一点一点地，我从 CPAN 下载了各个模块并完成了 nmake 舞蹈。

所以，我想升级到更新的版本，但新版本不能破坏任何现有的脚本。值得注意的是，我安装的一堆“使用”模块必须安装在新版本中。

更新我当前版本的最可靠（也是最简单）的方法是什么，以确保我对 nmake 舞蹈所做的一切在更新后仍然存在？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T22:11:15.363

正如其他人所指出的，首先在一个单独的地方安装新的 perl。我安装了几个 perls，每个都与其他的完全分开。

为此，您必须自己配置和编译源代码。运行时`configure`，您将有机会指定安装程序。[我在The Perl Review 2008 年春季刊的](http://theperlreview.com/Issues/subscribers.html)“编译我自己的 Perl”中对此给出了详细说明。*Effective Perl Programming*中还有一个 Item向您展示了如何做到这一点。

现在，回到您的原始发行版并运行`cpan -a`以创建一个自动捆绑文件。这是一个 Pod 文档，列出了您已安装的所有额外内容，CPAN.pm 了解如何使用它重新安装所有内容。

要在新的 perl 中安装东西，请使用该 perl 的路径来启动 CPAN.pm 并安装您创建的 autobundle 文件。CPAN.pm 将从 perl 的配置中获得正确的安装路径。

观察输出以确保一切顺利。此过程不会安装相同版本的模块，而是安装最新版本。

至于[Strawberry Perl](http://www.strawberryperl.com)，除了默认位置之外，您还可以安装一个“便携式”版本。这样你就可以在可移动媒体上使用新的 perl。您可以在任何您喜欢的地方对其进行测试，而不会影响本地安装。不过，我认为这还没有为一般用途做好准备。Berrybrew工具可能[会](http://perltricks.com/article/119/2014/10/10/Hello-berrybrew--the-Strawberry-Perl-version-manager)帮助您管理它。

祝你好运， ：）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-22T20:49:07.307

我会认真考虑使用[Strawberry Perl](http://strawberryperl.com)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-22T20:49:53.733

您可以在不同的位置安装 Perl 的第二个版本。您必须将所有非核心模块重新安装到新版本中。通常，不同版本的 Perl 不兼容二进制，如果您有任何使用 XS 组件的特定于程序的库，这可能是一个问题。纯 Perl 模块不应受到影响。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-22T20:53:34.300

如果您停留在 5.8 轨道内，所有已安装的包含 XS（二进制）扩展的模块将继续工作，因为在同一个 5.8 系列中保证了二进制兼容性。如果您迁移到 5.10，那么您将不得不重新编译任何包含 XS 组件的模块。

您需要做的就是确保新构建在其@INC 数组（用于查找模块）中列出了以前的包含目录。

从它的声音来看，我认为您在 Windows 上，在这种情况下，可以查看当前的 @INC 路径

```
perl -le "print for @INC" 
```

确保将新的 Perl 版本定位在另一个目录中。它将与以前的版本愉快地共存，这将允许您选择使用哪个 Perl 安装；这只是整理您的 PATH 顺序的问题。一旦 Perl 解释器启动，它就知道去哪里寻找它的其余模块。

Strawberry Perl 可能是目前 Windows 上最好的发行版，可以让你自己滚动。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T20:46:46.313

当我这样做时，我将较新的安装到一个单独的目录中。运行两个版本会带来一些额外的混乱，但它肯定有助于确保一切正常，并提供一种在紧要关头切换回旧版本的快速方法。我还将 Apache 设置为运行两个独立的服务，这样我就可以在一个服务中使用新的 Perl，而无需触及旧 Perl 上的生产服务。

事后看来，安装在单独的计算机上并在那里进行测试可能更明智。记录您需要进行的每个配置更改。

我不确定自己构建它——我总是只使用预打包的 Windows 二进制文件。

我不确定我是否完全理解您的要求。你有你对 5.8 makefile 所做的更改的列表吗？或者问题是如何获得这样的列表？您是否还在询问如何找出您从 CPAN 获得的基本安装之上的哪些软件包？如果您再次从 CPAN 获取自定义更改，您是否还询问如何测试您的自定义更改不会破坏这些包？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T00:33:36.707

我认为这个问题的答案涉及某种[虚拟化：](http://en.wikipedia.org/wiki/Virtualization)

1.  设置当前实时机器的精确副本。升级 Perl，使用与您目前使用的相同的目录位置和结构。
2.  通过您的脚本在新图像上测试它们。
3.  开心后，拨动开关。

这背后的想法是，可能存在你没有想到的各种微妙的依赖关系和假设。虽然不太可能，但与您使用的模块相比，特定模块的最新版本（甚至可能是核心模块，尽管这更不可能）可能会有细微的差别。除非您已经详尽地浏览了整个代码库，否则很可能只有在某些情况下才需要一个特定的模块。

您可以尝试通过构建所有脚本的列表来发现这一点 - 一个无论如何都应该拥有的列表，通过所有代码都处于版本控制之下（您*正在*使用版本控制，例如[Subversion](http://subversion.tigris.org/)，是吗？） - 并迭代它，`perl -c`在每个脚本上运行。例如[这个脚本](http://pastebin.com/m2da75bf9)。这种自动化测试是无价的：你可以让它运行，出去喝杯咖啡或其他什么，然后回来检查一切是否正常。最初的几次你可能会发现一个你忘记的晦涩的模块，这很好：自动化它的全部目的是让*你*不必做检查每个脚本的苦差事。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-04T14:32:25.323

为什么不使用 ActivePerl 及其“ppm”工具来（重新）安装模块？

![替代文字](https://i.stack.imgur.com/5OzUa.png)

# svn - SVN 版本控制：如何为每个项目拥有自己的修订方案？

> ID：117484
> 
> 赞同：4
> 
> 时间：2008-09-22T20:39:37.500
> 
> 标签：svn, version-control

这里只是一个小的 SVN“问题”。

我设置了自己的 SVN 服务器[在 Windows 上设置 Subversion](https://blog.codinghorror.com/setting-up-subversion-on-windows/)

现在我做了一个代表，我的所有项目都将在其中进行。

现在，我在一个名为“Projects”的文件夹中检查了代表。

现在，如果我创建一个项目并签入，该项目是修订版 1。如果我创建第二个项目并签入，该项目处于修订版 2。因此，如果我对项目 1 进行更改，该项目将然后在修订版 3。

我真正想要的是每个项目都有自己的修订方案。我该怎么做呢？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-22T20:40:25.050

唯一的方法是将每个项目放在一个完全独立的存储库中。同一存储库中的项目将始终表现出您在问题中提到的行为。

[从这里](http://svnbook.red-bean.com/en/1.0/ch02s03.html)

> > > > 与许多其他版本控制系统不同，Subversion 的修订号适用于整个树，而不是单个文件。每个修订号选择一整棵树，在一些提交的更改之后存储库的特定状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T20:41:18.713

您必须为每个项目创建一个单独的存储库。无论如何，这通常是一个好主意，所以没有缺点:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T02:31:30.900

你能描述一下为什么在多个项目中拥有一个单一的颠覆修订号对你来说是个问题吗？

为所有项目使用单个存储库有一些合法优势。最大的问题是您可能能够更好地控制多个项目中公共代码之间的更改。

如果您现在对跨多个项目的单个递增 subversion 修订号的概念有疑问，您是否考虑过分支项目之一的情况？（记住一个普通的分支也会有一个全局递增的颠覆修订号）

听起来您正在尝试将存储库修订号用作构建或发布号的一部分？如果是这种情况，也许您可​​以考虑为您的项目实施不同的构建编号方案，然后可以将其与颠覆修订号相关联。

这种关联可以通过使用创建带有版本号的分支并将颠覆修订版放在分支的注释中的约定来实现。

[在这个](https://stackoverflow.com/questions/110175/how-to-access-the-current-subversion-build-number)问题中讨论了一些方案

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T20:41:42.207

您需要在“项目”文件夹中创建存储库，当您进行初始签出时，签出“???/projects/repo1”...这将使工作副本在您的机器上保持独立，您将签入/彼此完全分开。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T21:00:05.907

他们在这里讨论得更好一点：http: [//www.nabble.com/Multiple-Repositories-in-a-Windows-Server-td15014106.html](http://www.nabble.com/Multiple-Repositories-in-a-Windows-Server-td15014106.html)

基本上你可以这样做：

```
svnserve -r /path/to/repository  

svn://hostname/ 
```

或者

```
svnserve -r /path/to/directory/containing/many/repositories  

svn://hostname/repositoryname/ 
```

或者，您可以不使用服务器，只需将各个存储库托管在本地或网络驱动器上。

# sharepoint - 如何最好地创建仅显示根文件夹内容的 SharePoint 列表视图？

> ID：117487
> 
> 赞同：1
> 
> 时间：2008-09-22T20:40:06.610
> 
> 标签：sharepoint, list-definition

我有一个基于文档内容类型的自定义 SharePoint 列表定义。我由此创建的库实例包含许多 HTML 文档，每个文档都有一些图像保存到该库内的子文件夹中。创建一个显示所有顶级 HTML 文档而不显示所有图像附件文件的视图的最佳方法是什么？我更愿意在 schema.xml 文件中为我的列表定义定义它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T21:41:49.677

我相信将 Scope="FilesOnly" 添加到列表定义中的 View 标记应该可以解决问题。

# oop - 有没有人有关于 n 层 Web 应用程序的类命名的好文章或好的建议？

> ID：117492
> 
> 赞同：1
> 
> 时间：2008-09-22T20:41:16.827
> 
> 标签：oop, naming-conventions

我习惯了 LLBLGen 在基于数据库结构生成对象时给出的布局，这可能会为数据库中的给定“用户”表生成以下类文件：

```
/EntityClasses/UserEntity.vb
/CollectionClasses/UserCollection.vb 
```

这为数据访问提供了一些基本功能。但是，当您想在此之上实现业务逻辑时，您将如何布局？例如，给定一个可能如下所示的表结构：

```
 USER
 userId
 firstName
 lastName
 username
 password
 lockedOut 
```

如果您想锁定用户怎么办？你会从表示层调用什么代码？您会实例化 UserEntity 类，然后执行以下操作：

```
 User = new UserEntity(userId)
 User.lockedOut = true
 User.Save() 
```

或者您会创建一个新类，例如 UserHelper (/BusinessLogic/UserHelper.cs)，它可能具有 LockOutUser 函数。这会将代码更改为：

```
 UH = new UserHelper()
 UH.LockOutUser(userId) 
```

或者您会扩展基本的 UserEntity 类，并创建添加新功能的 UserEntityExt？因此，表示层的代码可能如下所示：

```
 User = new UserEntityExt(userId)
 User.LockOutUser() 
```

或者......你会完全做其他事情吗？

您的目录/命名空间结构和文件/类命名约定是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T21:39:29.823

我认为您正在寻找的是位于域对象之上的服务层。尽管我可能将其称为 UserService 或 UserTasks，但您基本上可以使用第二个选项。通过将此 LockUser 进程封装在一个地方，以后可能会在涉及更多步骤或其他域对象时轻松更改。此外，这将是处理多个数据库调用时实现事务的地方。

# vxworks - 为什么在使用 vxWorks 管道时会丢失数据？

> ID：117502
> 
> 赞同：0
> 
> 时间：2008-09-22T20:42:36.590
> 
> 标签：vxworks

我正在使用管道在两个 vxWorks 任务之间传输信息。

这是一个代码示例：

```
 Init()
{
   fd = open("/pipe/mydev", O_RDWR, 0777);
...
}

taskRx()
{
   ...
   len = read(fd, rxbuf, MAX_RX_LEN);
   ...
}
taskTx()
{
   ...
   len = write(fd, txbuf, txLen);
   ...
} 
```

如果我们发送的消息比 MAX_RX_LEN 长（即 txLen > MAX_RX_LEN），我们会进行 2 次读取以获取消息的其余部分。

我们注意到的是第二次读取没有收到任何数据！

这是为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T20:46:11.400

VxWorks 的管道机制**不是**基于流的（与 unix 命名管道不同）。

它是 vxWorks 消息队列设施之上的一层。因此，它具有与消息队列相同的限制：从管道读取时，您实际上是在读取整个消息。如果你的接收缓冲区没有足够的空间来存储接收到的数据，溢出就会被简单地丢弃。

在消息队列或管道上进行接收时，始终确保将缓冲区设置为队列元素的最大大小。

# .net - 用于 .net 远程处理的 GenuineChannels 的良好替代品

> ID：117505
> 
> 赞同：2
> 
> 时间：2008-09-22T20:43:26.853
> 
> 标签：.net, remoting, genuinechannels

在过去的 4 年里，我们一直在我们的产品中使用 GenuineChannels。GenuineChannels 现在似乎已不受支持，我认为主要开发人员 Dmitri 已加入 Microsoft。我有源作为产品的一部分，但没有网络/.net 知识来支持它。

有没有人找到一个很好的替代 GenuineChannels 来实现良好的 .net 远程处理？我需要我们的软件产品在一些受支持的软件之上运行！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T21:00:36.740

WCF，Windows Communication Foundation 是您应该研究的方法。WCF 将 Web 服务、.net 远程处理、分布式事务和消息队列集成到一个通用通信模型中。

WCF 入门位于[http://msdn.microsoft.com/en-us/library/ms734712.aspx](http://msdn.microsoft.com/en-us/library/ms734712.aspx)

该教程位于[http://msdn.microsoft.com/en-us/library/ms734712.aspx](http://msdn.microsoft.com/en-us/library/ms734712.aspx)

Oreilly 有一本关于 WCF 的书：http: [//oreilly.com/catalog/9780596526993/](http://oreilly.com/catalog/9780596526993/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-01T15:33:50.030

有一种名为[DotNetRemoting](http://www.dotnetremoting.com/)的产品声称可以轻松替代 GenuineChannels。他们甚至在[他们的论坛中有一个部分](http://www.dotnetremoting.com/ForumView.aspx?ItemID=6&mid=2&pageid=7)专门用于从 GenuineChannles 转换为 DNR。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T21:02:14.357

WCF（Windows Communication Foundation）是要走的路 - 更具可扩展性，可轻松交换到其他技术（如果您将来需要），并且内置于 .NET 3.0。
那里还有很多其他好东西...... [http://msdn.microsoft.com/en-us/netframework/aa663324.aspx](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)

# visual-studio-2008 - 在 Visual Studio 2008 中创建自定义代码片段

> ID：117508
> 
> 赞同：13
> 
> 时间：2008-09-22T20:43:55.650
> 
> 标签：visual-studio-2008, code-snippets

如标题所述，如何在 Visual Studio 2008 中创建自定义代码片段？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T20:48:11.083

这也刚刚发布：[http ://codeplex.com/SnippetDesigner](http://codeplex.com/SnippetDesigner)

> Snippet Designer 是一个插件，它增强了 Visual Studio IDE 以提供更丰富、更高效的代码片段体验......
> 
> ### 特征
> 
> 集成在 IDE 中的片段编辑器，支持**C#、Visual Basic、JavaScript、HTML、XML**和**SQL**
> 
> *   通过打开任何 .snippet 文件或转到 File -> New -> File -> Code Snippet File 来访问它
> *   它使用本机 Visual Studio 代码编辑器，因此您可以在编写代码的相同环境中编写代码片段。
> *   它使您可以通过方便的右键菜单轻松标记替换。
> *   它在 Visual Studio 属性窗口中显示片段的属性...
> 
> 一个片段资源管理器工具窗口，用于在您的计算机上搜索片段。
> 
> *   它位于 View -> Other Windows -> Snippet Explorer 下
> *   此工具窗口包含一个代码预览窗口，可让您在不打开文件的情况下查看代码片段内部的内容。
> *   在您的计算机上维护片段索引，以便快速搜索。
> *   提供一种快速查找要使用、编辑或删除的代码片段的方法...

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T20:45:51.167

这是用于创建/编辑片段的实用程序的链接。尽管链接中有分类，但它适用于比 VB 更多的语言。

[http://msdn.microsoft.com/en-us/vbasic/bb973770.aspx](http://msdn.microsoft.com/en-us/vbasic/bb973770.aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-22T20:52:23.243

MSDN 链接很好，但有时我更喜欢简单的[教程](http://www.15seconds.com/issue/080724.htm)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-22T20:52:42.727

工具->代码片段管理器

获取您的目录列表。选择（或添加）我的代码片段。

片段本身必须创建为带有 .snippet 扩展名的单独文件。

以下是有关使用和创建它们的教程：[Visual Studio 中的代码片段](http://www.dotnetjunkies.ddj.com/Article/C95AC204-DE44-4D4A-A2B7-1EB1BE14A8A1.dcik)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T20:46:12.727

在此处查看官方说明：

[http://msdn.microsoft.com/en-us/library/ms165392.aspx](http://msdn.microsoft.com/en-us/library/ms165392.aspx)

# sql - 在 oracle 树查询中连接其他表

> ID：117512
> 
> 赞同：8
> 
> 时间：2008-09-22T20:44:29.953
> 
> 标签：sql, oracle, tree, connect-by

给定一个简单的 (id, description) 表 t1，例如

```
id  description
--  -----------
1   Alice
2   Bob
3   Carol
4   David
5   Erica
6   Fred 
```

还有一个父子关系表t2，比如

```
parent  child
------  -----
1       2
1       3
4       5
5       6 
```

Oracle 提供了一种将其作为具有一些自定义语法扩展的树来遍历的方法：

```
select parent, child, sys_connect_by_path(child, '/') as "path"
from t2
connect by prior parent = child 
```

确切的语法并不重要，我可能在上面犯了一个错误。重要的是上面会产生一些看起来像

```
parent  child  path
------  -----  ----
1       2      /1/2
1       3      /1/3
4       5      /4/5
4       6      /4/5/6
5       6      /5/6 
```

我的问题是：是否可以在 sys_connect_by_path() 中加入另一个表，例如上面的 t1 表，以生成类似：

```
parent  child  path
------  -----  ----
1       2      /Alice/Bob
1       3      /Alice/Carol
... and so on... 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T20:53:44.987

在您的查询中，将 T2 替换为连接 T1 和 T2 并返回父、子和子描述的子查询。然后在 sys_connect_by_path 函数中，引用子查询中的子描述。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T08:01:14.460

基于 Mike McAllister 的想法，下面使用派生表来达到预期的结果：

```
select
     T.PARENT
    ,T.CHILD
    ,sys_connect_by_path(T.CDESC, '/')
from
    (
        select
             t2.parent      as PARENT
            ,t2.child       as CHILD
            ,t1.description as CDESC
        from
             t1, t2
        where
            t2.child = t1.id
    ) T
where
    level > 1 and connect_by_isleaf = 1
connect by prior
    T.CHILD = T.PARENT 
```

在我的问题中，所有父母都锚定在“超级父母”根下，这意味着可以使用 SYS_CONNECT_BY_PATH 完全描述路径，从而无需使用 cagcowboy 将父母与路径连接起来的技术。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T20:56:21.970

```
SELECT parent, child, parents.description||sys_connect_by_path(childs.description, '/') AS "path"
FROM   T1 parents, T1 childs, T2
WHERE  T2.parent = parents.id
AND    T2.child = childs.id
CONNECT BY PRIOR parent = child 
```

# python - 如何在 python 中使用带有 datetime 对象的时区？

> ID：117514
> 
> 赞同：44
> 
> 时间：2008-09-22T20:44:39.407
> 
> 标签：python, datetime, timezone

如何在我的时区中正确表示不同的时区？下面的示例仅适用，因为我知道 EDT 比我早一小时，所以我可以取消注释 myTimeZone() 的减法

```
import datetime, re
from datetime import tzinfo

class myTimeZone(tzinfo):
    """docstring for myTimeZone"""
    def utfoffset(self, dt):
        return timedelta(hours=1)

def myDateHandler(aDateString):
    """u'Sat,  6 Sep 2008 21:16:33 EDT'"""
    _my_date_pattern = re.compile(r'\w+\,\s+(\d+)\s+(\w+)\s+(\d+)\s+(\d+)\:(\d+)\:(\d+)')
    day, month, year, hour, minute, second = _my_date_pattern.search(aDateString).groups()
    month = [
            'JAN', 'FEB', 'MAR', 
            'APR', 'MAY', 'JUN', 
            'JUL', 'AUG', 'SEP', 
            'OCT', 'NOV', 'DEC'
    ].index(month.upper()) + 1
    dt = datetime.datetime(
        int(year), int(month), int(day), 
        int(hour), int(minute), int(second)
    )                   
    # dt = dt - datetime.timedelta(hours=1)
    # dt = dt - dt.tzinfo.utfoffset(myTimeZone())
    return (dt.year, dt.month, dt.day, dt.hour, dt.minute, dt.second, 0, 0, 0)

def main():
    print myDateHandler("Sat,  6 Sep 2008 21:16:33 EDT")

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-22T20:59:40.807

我建议在使用`babel`时`pytz`区时。保持您的内部日期时间对象天真并使用 UTC 并转换为您的时区以进行格式化。您可能想要简单对象（没有时区信息的对象）的原因是许多库和数据库适配器不知道时区。

*   [通天塔](http://babel.pocoo.org/)
*   [皮茨](http://pytz.sourceforge.net/)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T20:46:08.593

Python 标准库不包含时区信息，因为不幸的是时区数据的变化比 Python 快得多。为此，您需要一个第三方模块；通常的选择是[pytz](http://pytz.sourceforge.net)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-12-12T13:35:12.613

对于当前本地时区，您可以使用：

```
>>> import time
>>> offset = time.timezone if (time.localtime().tm_isdst == 0) else time.altzone
>>> offset / 60 / 60 * -1
-9 
```

返回的值以 UTC 以西的秒数为单位（UTC 以东的区域为负值）。这与我们实际想要的相反，因此`* -1`.

`localtime().tm_isdst`如果夏令时当前无效，则为零（尽管如果一个地区最近更改了夏令时法，这可能不正确）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-12-01T08:41:15.197

## 蟒蛇> = 3.9

Python 带有[zoneinfo](https://docs.python.org/3/library/zoneinfo.html)作为标准库的一部分。示例用法：

```
from datetime import datetime, timezone
from zoneinfo import ZoneInfo
UTC = datetime(2012,11,10,9,0,0, tzinfo=timezone.utc)

# convert to another tz with "astimezone":
eastern = UTC.astimezone(ZoneInfo("US/Eastern"))

# note that it is safe to use "replace",
# to get the same wall time in a different tz:
pacific = eastern.replace(tzinfo=ZoneInfo("US/Pacific"))

print(UTC.isoformat())
print(eastern.isoformat())
print(pacific.isoformat())

# 2012-11-10T09:00:00+00:00
# 2012-11-10T04:00:00-05:00
# 2012-11-10T04:00:00-08:00 
```

另请注意[文档中的此部分](https://docs.python.org/3/library/zoneinfo.html#data-sources)：

> zoneinfo 模块不直接提供时区数据，而是从系统时区数据库或第一方 PyPI 包[tzdata](https://pypi.org/project/tzdata/)（如果可用）中提取时区信息。

所以不要忘记调用`pip install tzdata`, 至少在 Windows 上。

# ruby - 如何在 Ubuntu 中清除 Ruby Phusion Passenger 的缓存？

> ID：117536
> 
> 赞同：4
> 
> 时间：2008-09-22T20:47:49.837
> 
> 标签：ruby, caching, passenger, phusion

我已经尝试重新启动 apache 并且缓存页面仍然出现，所以某个地方必须有一个文件夹。我没有“公共/缓存”，那么我应该看哪些其他地方？是否有一个 URL 标志也可以触发这种效果？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T03:28:51.153

您需要触摸文件以清除 phusion，例如：

```
touch /webapps/mycook/tmp/restart.txt 
```

查看[文档](http://www.modrails.com/documentation/Users%20guide.html#_redeploying_restarting_the_ruby_on_rails_application)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T22:02:15.913

我处于开发模式。

我发现我必须重新启动 apache 服务并清除浏览器缓存才能让我的更改 100% 出现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T21:32:04.707

首先，您是否清除了浏览器缓存？您可以通过浏览器菜单，在某处的选项中执行此操作。

我要问的下一个问题是您是在生产模式还是开发模式下运行应用程序？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-01-19T07:53:26.470

对于现在来这里的人

现在有更多的能力从 ssh 重新启动 passanger 这是更新的[文档](https://www.phusionpassenger.com/library/admin/nginx/restart_app.html)

```
passenger-config restart-app 
```

或者

```
passenger-config restart-app /Users/phusion/testapp 
```

如果您只有 FTP 访问权限，则可以使用旧方法

```
touch tmp/restart.txt 
```

这不会立即完成，passanger 将寻找其修改的时间戳以更改以执行重新启动。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-23T03:09:56.253

Ctrl+F5 将强制重新加载页面及其所有链接资产。

这有点像只为那一页清除缓存。

# javascript - Scriptaculous Droppables onDrop 回调，如何引用每个元素？

> ID：117547
> 
> 赞同：3
> 
> 时间：2008-09-22T20:49:31.003
> 
> 标签：javascript, scriptaculous, droppable

文档可以在[这里找到](http://github.com/madrobby/scriptaculous/wikis/droppables)

它在示例中说：

**onDrop：每当一个 Draggable 在 Droppable 上释放并且 Droppable 接受它时调用。回调获取三个参数：Draggable 元素、Droppable 元素和 Event。您可以从 Event 对象中提取有关放置的其他信息（例如是否按下了 Ctrl 或 Shift 键）。**

然后它给出了一些代码

Droppables.add('shopping_cart', { accept: 'products', onDrop: function(element) { $('shopping_cart_text').update('把' + element.alt + '放在我身上。'); } }) ;

它在代码中使用了模棱两可的词“元素”。 **我的问题是，有没有人有一个很好的例子来说明如何在这个回调 javascript 函数中引用可拖动元素和可放置元素？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T20:54:32.083

通过页面下方的示例，回调函数可以根据需要获取尽可能多的参数：

```
onDrop: function() { $('droppable_demo').highlight(); } 
```

在这种情况下，他们没有使用任何回调参数。为此，大概要访问您引用的段落中提到的所有三个，您可以定义：

```
onDrop: function(dragged, dropped, event) {  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-15T19:55:09.360

我将此示例添加到文档中...

```
 Droppables.add('shopping_cart', {
  accept: 'products',
  onDrop: function(dragged, dropped, event) {
    alert('Dragged: ' + dragged.id);
    alert('Dropped onto: ' + dropped.id);
    alert('Held ctrl key: ' + event.ctrlKey);
  }
}); 
```

# javascript - javascript：取消各种请求

> ID：117551
> 
> 赞同：19
> 
> 时间：2008-09-22T20:50:24.557
> 
> 标签：javascript, ajax, dom, httprequest

我的网站提出了很多请求。我经常需要取消所有当前的请求，这样浏览器才不会阻塞相关的新请求。

我有 3 种请求：

*   阿贾克斯
*   插入的脚本标签（执行 JSONP 通信）
*   插入的图像标签（导致浏览器从各种服务器请求数据）

对于 Ajax，它没有问题，因为 XMLHttpRequest 对象支持取消。我需要的是一种让任何浏览器停止从 DOM-Objects 加载资源的方法。

看起来像简单地从 DOM 中删除一个对象（例如图像标签）只会有助于避免请求，如果请求尚未运行。

**更新：**一种取消所有无关请求的方法，而不是真正的任何请求都是完美的。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-22T21:02:46.743

`window.stop()`应该取消任何待处理的图像或脚本请求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T20:52:22.947

我认为`document.close()`停止所有请求，但我不太确定。

# asp.net - 跨多个访问数据库的内部连接

> ID：117558
> 
> 赞同：3
> 
> 时间：2008-09-22T20:51:09.597
> 
> 标签：asp.net, ms-access, inner-join

我正在为我真的不喜欢的 ASP.NET CMS 重新设计一个应用程序。我在性能上做了一些改进，却发现这个 CMS 不仅使用 MS SQL，而且一些用户“简单地”使用 MS Access 数据库。

问题是我有一些内部连接的表，MS Access 版本位于两个不同的文件中。我不能简单地将表移动到另一个 mdb 文件。

我现在正试图找出一种跨多个访问数据库文件“内部连接”的好方法？

如果我已经获取了所有数据并以编程方式进行操作，那将是非常遗憾的！

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-22T23:33:18.940

您根本不需要链接表。有两种方法可以使用来自不同 MDB 的数据，无需链接表即可使用。第一种是在 SQL 的 FROM 子句中使用“IN 'c:\MyDBs\Access.mdb'”。您保存的查询之一是：

```
SELECT MyTable.*
FROM MyTable IN 'c:\MyDBs\Access.mdb' 
```

另一个保存的查询是：

```
SELECT OtherTable.*
FROM OtherTable IN 'c:\MyDBs\Other.mdb' 
```

然后，您可以保存这些查询，然后使用保存的查询连接这两个表。

或者，您可以通过在 FROM 子句中为每个表指定源 MDB 的路径来在单个 SQL 语句中管理它，如下所示：

```
SELECT MyTable.ID, OtherTable.OtherField
FROM [c:\MyDBs\Access.mdb].MyTable 
  INNER JOIN [c:\MyDBs\Other.mdb].OtherTable ON MyTable.ID = OtherTable.ID 
```

但请记住一件事：

Jet 查询优化器不一定能够将这些表中的索引用于连接（是否将它们用于单个字段的标准是另一个问题），所以这可能非常慢（在我的测试中，它不是，但我没有使用大数据集进行测试）。但是这个性能问题也适用于链接表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T21:04:10.623

如果您有权访问 MDB，并且能够更改它们，您可能会考虑使用链接表。Access 提供了链接到外部数据（在其他 MDB、Excel 文件中，甚至在 SQL Server 或 Oracle 中）的能力，然后您可以针对这些链接执行联接。

我强烈鼓励对这种选项进行性能测试。如果将 Access 数据库的用户迁移到另一个系统（甚至是 SQL Express）是可行的，那也是可取的——上次我检查过，不再有 64 位的 ODBC JET 驱动程序，所以如果应用程序曾经托管在在 64 位环境下，这些用户将被淹没。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T21:05:23.587

在一个访问数据库中，您可以创建指向另一个数据库的“链接表”。您应该（我认为）能够查询这些表，就好像它们都存在于同一个数据库中一样。

这确实意味着您必须更改其中一个数据库来创建虚拟表，但至少您实际上并没有移动数据，只是创建了一个指向它的指针

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T21:07:03.660

在 Access 中，您可以通过“链接表管理器”添加远程表。您可以将链接添加到一个 Access 文件或另一个，或者您可以创建一个引用两个文件中的表的新 Access 文件。完成此操作后，内部连接查询与在单个数据库中执行它们没有什么不同。

# javascript - 具有大量数据的可排序表的最佳方法

> ID：117570
> 
> 赞同：4
> 
> 时间：2008-09-22T20:52:53.367
> 
> 标签：javascript, database, jquery-ui-sortable

在我们的 Web 应用程序中，搜索结果显示在可排序的表格中。用户可以单击任何列并对结果进行排序。问题是有时，用户进行了广泛的搜索并返回了大量数据。要使可排序部分工作，您可能需要所有结果，这需要很长时间。或者我可以一次检索几个结果，但是排序不会很好地工作。显示可能包含大量数据的可排序表的最佳做法是什么？

* * *

感谢所有的建议。我一定会复习这些的。

我们正在使用具有可排序表的现有 Javascript 框架；“很多”结果意味着数百个。问题是我们的用户在某个远程站点，并且很多延迟是网络时间从数据中心发送/接收数据。在数据库端对数据进行排序，一次只发送一页的结果是很好的；但是当用户单击某个列标题时，会完成另一次往返，这总是会增加 3-4 秒。

好吧，我想这可能是网络团队的问题:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T20:54:54.343

您应该在数据库服务器上进行分页。例如，在 SQL 2005 和 SQL 2008 上有分页技术。我建议查看您正在查看的任何系统的分页选项。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T21:04:26.677

在数据库级别使用排序分页是正确的答案。如果您的查询返回 1000 行，但您只向用户显示其中的 10 行，则无需通过网络发送其他 990 行。

这是一个mysql示例。假设您需要 'people' 表中的 10 行，21-30：

```
SELECT * FROM people LIMIT 21, 10 

```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T01:44:40.013

您正在使用什么数据库，因为在 SQL 2005 及更高版本中有一些很好的分页选项，使用 ROW_NUMBER 允许您在服务器上进行分页。[我在Christian Darie 的博客](http://www.cristiandarie.ro/asp20-sql-server-ecommerce/)上找到了这个不错 的

例如，此过程用于对类别中的产品进行分页。您只需传入您想要的页码和页面上的产品数量等

```
CREATE PROCEDURE GetProductsInCategory
(@CategoryID INT,
@DescriptionLength INT,
@PageNumber INT,
@ProductsPerPage INT,
@HowManyProducts INT OUTPUT)
AS

-- declare a new TABLE variable
DECLARE @Products TABLE
(RowNumber INT,
 ProductID INT,
 Name VARCHAR(50),
 Description VARCHAR(5000),
 Price MONEY,
 Image1FileName VARCHAR(50),
 Image2FileName VARCHAR(50),
 OnDepartmentPromotion BIT,
 OnCatalogPromotion BIT)

-- populate the table variable with the complete list of products
INSERT INTO @Products
SELECT ROW_NUMBER() OVER (ORDER BY Product.ProductID),
       Product.ProductID, Name, 
       SUBSTRING(Description, 1, @DescriptionLength) + '...' AS Description,
       Price, Image1FileName, Image2FileName, OnDepartmentPromotion, OnCatalogPromotion
FROM Product INNER JOIN ProductCategory
  ON Product.ProductID = ProductCategory.ProductID
WHERE ProductCategory.CategoryID = @CategoryID

-- return the total number of products using an OUTPUT variable
SELECT @HowManyProducts = COUNT(ProductID) FROM @Products

-- extract the requested page of products
SELECT ProductID, Name, Description, Price, Image1FileName,
       Image2FileName, OnDepartmentPromotion, OnCatalogPromotion
FROM @Products
WHERE RowNumber > (@PageNumber - 1) * @ProductsPerPage
  AND RowNumber <= @PageNumber * @ProductsPerPage 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T20:56:06.930

您可以在服务器上进行排序。AJAX 将消除完全刷新的必要性，但仍然会有延迟。侧面，数据库的排序通常非常快。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T20:58:00.997

对于这些情况，我在 SQL Server 端采用了不仅利用数据库进行排序的技术，而且还使用自定义分页来仅返回所需的特定记录。

刚开始实施有点痛苦，但后来的表现令人惊叹！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T21:01:52.597

“很多”数据有多大？几百行？数千？

排序可以通过 JavaScript 使用[Mochikit Sortable Tables 轻松](http://mochikit.com/examples/sortable_tables/index.html)完成。但是，如果数据需要很长时间来排序（很可能是一两秒 [或三！]），那么您可能希望给用户一些视觉提示，表明正在发生某些事情并且页面并没有只是冻结。例如，给屏幕上色（例如 Lightbox）并显示“排序”动画或文本。

# authentication - 如何在 Facebook Flash 应用程序中进行身份验证？

> ID：117579
> 
> 赞同：0
> 
> 时间：2008-09-22T20:53:46.390
> 
> 标签：authentication, facebook

我不明白如何在 Facebook Flash 应用程序中对用户进行身份验证。我从文档中读到 Facebook 平台向 Flash 应用程序提供了参数，例如用户 ID 和会话密码，但是我如何在 Flash 应用程序中确保这些参数是正确的而不是假的？我是否应该调用一些 Facebook 平台方法并确保没有错误发生？

另一个与 Facebook 相关的问题：我可以只将 Facebook 用户的用户 ID 存储在我自己的数据库中，而不是例如用户名吗？我想当用户直接访问我的网站而不是通过 Facebook 时，我不能显示他们的真实姓名？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T22:02:34.137

使用此 API 与 Facebook 服务进行 flash/flex 通信：
[http ://code.google.com/p/facebook-actionscript-api/](http://code.google.com/p/facebook-actionscript-api/)

# css - IIS CSS 缓存

> ID：117589
> 
> 赞同：13
> 
> 时间：2008-09-22T20:55:45.717
> 
> 标签：css, iis, iis-6

当我们在新代码提交后开发新站点或测试涉及 css 的新站点的更改时，有人去检查更改时，他们总是会看到旧 css 的缓存版本。这在测试中引起了很多问题，因为人们永远不确定屏幕上是否有最新的 css（我知道 shift 和单击刷新会清除此缓存，但我不能指望最终用户知道这样做）。我可能的解决方案是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T20:58:19.250

如果您从静态文件（或与查询字符串无关的任何内容）提供 CSS，请尝试改变它以确保浏览器发出新请求，因为它会认为它正在拉取一个完全不同的资源，所以例如：

"styles.css?token=1234" 在您的标记中的 CSS 参考中，并在每次 CSS 签入时更改 "token" 的值

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T20:57:11.733

在您的开发环境中，将 Expires 标头设置得更低。在您的生产环境中，将其设置得较高，然后在发布前一周左右将其设置为较低。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T21:01:06.000

这不是一个很好的解决方案，但我之前在页面级别通过在对 CSS 文件的调用末尾添加一个查询字符串来解决这个问题：

```
 <link href="/css/global.css?id=3939" type="text/css" rel="stylesheet" /> 
```

然后我会随机化 id 值，以便它在页面加载时始终加载不同的值。然后我会在投入生产之前取出这段代码。我想您也可以从配置文件中提取值，这样每次提交只需加载一次。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T22:05:15.433

为这个问题的 JavaScript 版本给出了类似（更详细）的答案，它具有相同的问题/解决方案

[帮助积极的 JavaScript 缓存](https://stackoverflow.com/questions/54475/help-with-aggressive-javascript-caching)

# windows - Windows下Services可以做什么？

> ID：117590
> 
> 赞同：2
> 
> 时间：2008-09-22T20:56:00.910
> 
> 标签：windows, windows-services

有人对 XP 下的 Windows 服务功能有很好的指南吗？特别是，我试图找出当作为服务运行的程序试图打开窗口但没有被授予与桌面交互的权限时会发生什么。

基本上，我有一个程序是/曾经是一个 GUI 应用程序，它应该能够作为长期后台处理的服务运行。重写程序以在进行后台处理时不显示 GUI 元素是一项重大工作，所以我想看看是否有一种方法可以忽略 UI 元素。只要没有打开太多窗口，它现在就可以工作了。我试图弄清楚我可能会遇到什么限制。理想情况下，会有一个 MSDN 页面讨论这个问题，但我还没有找到一个。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T21:00:31.507

通常，服务应设计为没有任何可见的 UI。服务的全部意义在于在后台运行，无需 UI，无人值守。（想想 SQL Server、IIS 等）

在大多数情况下，如果需要 GUI，则由单独的应用程序控制服务的操作。（继续我刚才提到的示例，SQL Server Management Studio、IIS 管理器等。）这些单独的应用程序配置和操作服务（有时，如果需要，反弹所述服务）。

如果您的服务需要偶尔的 UI，并且说 UI 不能被隔离到控制应用程序，那么您可能应该重新考虑您开始使用服务的事实。也许驻留在系统通知区域中的 UI 应用程序是正确的使用模式？（例如，Windows Live Communicator。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T20:57:35.070

Microsoft Windows 中的**服务**是在计算机运行操作系统时运行的程序。它不需要用户登录。需要服务来执行与用户无关的任务，例如目录复制、进程监控或对网络上其他机器的服务，例如支持 Internet HTTP 协议

通常它被实现为在后台运行并执行不需要用户交互的任务的控制台应用程序。

安装的服务可以通过 `Control Panel --> Administrative Tools`Windows 2000/XP 中的服务小程序进行配置。

可以将服务配置为在操作系统启动时自动启动，因此您不必在系统重新启动后手动启动每个服务。

1.  [创建一个简单的服务 - MSDN 文章](http://msdn.microsoft.com/en-us/library/ms810429.aspx)
2.  [轻松编写 Windows 服务 - 代码项目文章](http://www.codeproject.com/KB/system/xservice.aspx)
3.  [用 C 语言编写 Windows 服务的五个步骤 - DevX 文章](http://www.devx.com/cplus/Article/9857)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T21:13:53.020

如果选中“允许服务与桌面交互”属性（MMC -> 服务属性 -> 登录选项卡），Windows XP 中的服务可以与桌面交互。也可以通过执行以下操作来做到这一点：

```
hWinstation = OpenWindowStation("winsta0", FALSE, MAXIMUM_ALLOWED);
SetProcessWindowStation(hWinstation);
hDesktop = OpenDesktop("default", 0, FALSE, MAXIMUM_ALLOWED);
SetThreadDesktop(hDesk); 
```

但请注意，在 Windows XP 中从服务进程呈现 UI 几乎总是会导致安全问题（请参阅[Shatter 攻击](http://en.wikipedia.org/wiki/Shatter_attack)）。您应该尝试将应用程序的 UI 部分从服务中分离出来。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T21:04:35.973

如果您考虑最终迁移到较新的操作系统，例如 Vista 或 Server 2008，您会发现根本无法授予服务与桌面交互的权限。因此，从前向兼容性的角度来看，您应该将服务设计为不需要它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T21:08:51.020

通常服务没有权限写入窗口站和桌面，所以会失败；即使运行加载 user32.dll 的应用程序也可能会失败，因为 user32 具有想要与窗口站对话的初始化代码，并且除非该服务以管理员身份运行，否则无法访问它。

# visual-studio-2008 - Mercurial 可以集成到 Visual Studio 2008 中吗？

> ID：117598
> 
> 赞同：11
> 
> 时间：2008-09-22T20:56:54.433
> 
> 标签：visual-studio-2008, version-control, mercurial, tortoisehg

是否有将[Mercurial](http://en.wikipedia.org/wiki/Mercurial)集成到 Visual Studio 的工具？

我只是好奇。Mercurial 非常好，即使使用 'just' [TortoiseHG](http://tortoisehg.sourceforge.net)，但与 Visual Studio 的集成会更好。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-22T21:04:13.823

[视觉HG](http://sharesource.org/project/visualhg/)

好样的，我。（后来自己找到了答案。哦，好吧，有人可能会觉得这很有用。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-29T14:34:26.543

还有[HgSccPackage](http://bitbucket.org/zzsergant/hgsccpackage/wiki/Home)，它不需要 TortoiseHG 工作。

# vb.net - VB.NET 中作为参数的委托

> ID：117623
> 
> 赞同：9
> 
> 时间：2008-09-22T21:01:11.957
> 
> 标签：vb.net, delegates, lambda, log4net

背景故事：我正在使用[log4net](http://logging.apache.org/log4net/index.html)来处理我正在从事的项目的所有日志记录。可以在几种不同的情况下调用一种特定的方法——一些保证日志消息是错误的，而另一些保证日志消息是警告的。

所以，作为一个例子，我怎么能转

```
Public Sub CheckDifference(ByVal A As Integer, ByVal B As Integer)
  If (B - A) > 5 Then
    log.ErrorFormat("Difference ({0}) is outside of acceptable range.", (B - A))
  End If
End Sub 
```

进入更多类似的内容：

```
Public Sub CheckDifference(ByVal A As Integer, ByVal B As Integer, "Some delegate info here")
  If (B - A) > 5 Then
    **delegateinfo**.Invoke("Difference ({0}) is outside of acceptable range.", (B - A))
  End If
End Sub 
```

这样我就可以调用它并将 log.ErrorFormat 或 log.WarnFormat 作为委托传递？

我将 VB.NET 与 VS 2008 和 .NET 3.5 SP1 一起使用。此外，我对代表们一般来说还很陌生，所以如果这个问题应该用不同的措辞来消除任何歧义，请告诉我。

编辑：另外，我如何在类构造函数中将委托初始化为 ErrorFormat 或 WarnFormat？会那么容易`myDelegate = log.ErrorFormat`吗？我想还有更多的东西（请原谅我对这个主题的无知——代表确实是我想了解更多的东西，但到目前为止他们还没有理解我的理解）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-22T21:11:09.920

声明您的代表签名：

```
Public Delegate Sub Format(ByVal value As String) 
```

定义您的测试功能：

```
Public Sub CheckDifference(ByVal A As Integer, _
                           ByVal B As Integer, _
                           ByVal format As Format)
    If (B - A) > 5 Then
        format.Invoke(String.Format( _
        "Difference ({0}) is outside of acceptable range.", (B - A)))
    End If
End Sub 
```

在您的代码中的某处调用您的 Test 函数：

```
CheckDifference(Foo, Bar, AddressOf log.WriteWarn) 
```

或者

```
CheckDifference(Foo, Bar, AddressOf log.WriteError) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T21:05:58.873

您首先要在类/模块级别声明一个委托（所有这些代码都来自内存/未经测试）：

```
Private Delegate Sub LogErrorDelegate(txt as string, byval paramarray fields() as string) 
```

然后..你会想要将它声明为你的类的属性，例如

```
Private _LogError
Public Property LogError as LogErrorDelegate
  Get 
    Return _LogError
  End Get
  Set(value as LogErrorDelegate)
    _LogError = value
  End Set
End Property 
```

实例化委托的方法是：

```
Dim led as New LogErrorDelegate(AddressOf log.ErrorFormat) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T21:04:47.893

```
Public Delegate errorCall(ByVal error As String, Params objs As Objects())
CheckDifference(10, 0, AddressOf log.ErrorFormat) 
```

请原谅格式：P

不过，基本上，使用正确的签名创建您想要的委托，并将其地址传递给方法。

# iis - 安装工具以在 IIS 上创建虚拟目录

> ID：117632
> 
> 赞同：2
> 
> 时间：2008-09-22T21:03:34.543
> 
> 标签：iis, installation, virtual-directory

我可以使用什么安装工具在 IIS 上创建虚拟目录？开源，免费或在 C# 中做。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T21:04:45.257

[WiX](http://wix.sourceforge.net/)可以创建 IIS 虚拟目录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T21:07:55.700

您可以使用 NAnt 和 NAntContrib 项目中的 MKIISdir 任务创建 IIS 虚拟目录

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T21:45:06.563

您可以使用 Visual Studio 中包含的 VS.NET Web 设置项目。

查看[本文](http://www.15seconds.com/issue/030806.htm)以获取您的 Web 应用程序的部署可能性列表：

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T21:07:03.160

您可以使用[Microsoft Web 部署工具](http://blogs.iis.net/msdeploy/archive/2008/01/22/welcome-to-the-web-deployment-team-blog.aspx)来重新创建网站结构。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T12:22:37.263

您可以通过命令行从任何安装程序调用一个小的 VBScript，并访问 IIS 对象。

```
Set objMimeMap = GetObject("IIS://localhost/w3svc") 
```

# xml - 如何从 xml 文件中删除重复元素？

> ID：117641
> 
> 赞同：0
> 
> 时间：2008-09-22T21:04:15.867
> 
> 标签：xml, xslt, xpath

我有一个像

```
<ns0:Employees xmlns:ns0="http://TestIndexMap.Employees">
  <Employee FirstName="FirstName_0" LastName="LastName_1" dept="dept_2" empNumber="1">
    <Schedules>
      <Schedule Date_join="2008-01-20" Date_end="2008-01-30" />
    </Schedules>
  </Employee>
  <Employee FirstName="FirstName_0" LastName="LastName_1" dept="dept_2" empNumber="2">
    <Schedules>
      <Schedule Date_join="2008-01-20" Date_end="2008-01-30" />
    </Schedules>
  </Employee>
  <Employee FirstName="FirstName_2" LastName="LastName_1" dept="dept_2" empNumber="2">
    <Schedules>
      <Schedule Date_join="2007-01-21" Date_end="2007-12-30" />

    </Schedules>
  </Employee>
  <Employee FirstName="FirstName_2" LastName="LastName_1" dept="dept_2" empNumber="2">
    <Schedules>
      <Schedule Date_join="2007-01-21" Date_end="2007-12-30" />
      <Schedule Date_join="2008-06-20" Date_end="2008-01-30" />

    </Schedules>
  </Employee>
</ns0:Employees> 
```

我想根据 firstname、last name 和 date_join 和 data_end 删除重复项。

请问，有人可以解释如何使用 XSLT 实现这一目标吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T00:48:37.293

下面是一些关于[如何根据元素名称和 id 字段删除重复项的](http://www.dpawson.co.uk/xsl/sect2/N2696.html)示例。将其扩展到任意字段应该不会太难。

> 问：扩展。我的 xml 的一部分如下所示：

```
 <location>
   <state>xxxx</state>
 </location>

 <location>
    <state>yyyy</state>
 </location>

  <location>
    <state>xxxx</state>
 </location> 
```

> 所需的输出是：

```
xxxx
yyyy 
```

> 也就是说，不应打印重复的状态值。这可以做到吗？

```
 <xsl:variable name="unique-list"
     select="//state[not(.=following::state)]" />   

   <xsl:for-each select="$unique-list">
 <xsl:value-of select="." />
   </xsl:for-each> 
```

# c# - 如何为 Windows 创建自定义 Shell 上下文处理程序？

> ID：117651
> 
> 赞同：4
> 
> 时间：2008-09-22T21:05:46.987
> 
> 标签：c#, .net, windows-shell

## 问题

语言：C# 2.0 或更高版本

* * *

当用户右键单击某些文件（在我的情况下为 *.eic）时，我想注册上下文处理程序以创建菜单。从这些菜单中注册、注销（清理）和处理事件（点击）的过程是什么？

我知道这与 Windows 注册表有关，但考虑到 .net 中有多少东西，如果有方便的方法可以做到这一点，我不会感到惊讶。

代码片段、网站参考、评论都很好。请把它们扔给我。

## 更新

* * *

显然，正如一些用户所评论的那样，在托管语言中创建上下文菜单存在一个小问题。是否有任何其他首选方法可以实现相同的行为，或者我应该花时间研究这些解决方法？我根本不介意这样做，我很高兴人们努力使这成为可能 - 但我仍然想知道是否有一种“正确/干净”的方式来实现这一目标。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T21:09:33.060

拒绝用托管语言编写 Shell 扩展——如果你追求这条路线，会有很多事情发生。

浏览此线程以获取更多详细信息。如果真的需要，它包含可以执行此操作的链接，以及为什么可以执行但不应该执行此操作的明智建议。

[http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/1428326d-7950-42b4-ad94-8e962124043e/](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/1428326d-7950-42b4-ad94-8e962124043e/)

你又回到了非托管 C/C++ 作为你这里唯一真正的工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T21:12:44.987

这不是一个好主意，因为不同版本的 .NET Framework 之间存在潜在的依赖性问题。您的 shell 扩展可能需要一个版本，而当前正在运行的应用程序可能已经加载了另一个版本。

[这个线程](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/1428326d-7950-42b4-ad94-8e962124043e/)包含一个很好的情况总结。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T21:16:40.220

我以前在 C# 中做过。它最终变得比它应该的要困难得多。但是，一旦您获得了样板代码，就很容易推出新项目。我点击了这个链接：

[链接到信息](http://www.codeproject.com/KB/shell/ratingcolumn.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T21:20:41.897

虽然其他人已经提到，由于框架冲突，在纯 .NET 中编写 shell 扩展是一个坏主意，但您仍然应该注意：

1.  那里有 3rd 方驱动程序（请参阅 Eldos 或 LogicNP）为您执行非托管方面，允许您编写与本机驱动程序对话的托管代码，从而防止与 shell 相关的 CLR 版本冲突。

2.  最近的 MSDN 文章提到，Microsoft 已经为 Silverlight 使用的 CoreCLR 解决了这个问题。他们通过允许多个版本的 CLR 在同一个进程中运行来实现这一点，从而解决了问题。作者进一步表示，Silverlight 中的此修复将被纳入完整 CLR 的未来版本中。（这意味着，在未来，在托管代码中编写 shell 扩展将是非常可行的。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T21:16:42.200

正如前面的评论所提到的，用托管语言编写 shell 扩展并不是最好的主意，但我想我会分享一个这样做的开源项目:)

[ShellGlue](http://code.google.com/p/shellglue/)是一个托管的 shell 扩展，实际上非常有用。如果您有兴趣在 C/C++ 中编写 shell 扩展，该源代码也可能对您有所帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T15:42:55.040

除了提到的关于在托管代码中实现 shell 扩展的注意事项之外，您基本上需要做的是以下几点：

首先，在 C# 中创建一个实现 IShellExtInit IContextMenu 接口的 COM 组件。[此处](http://blog.stevedoria.net/20051008/creating-com-components-using-visual-csharp-dot-net)描述了如何在 C# 中创建 COM 组件。[本文](http://edn.embarcadero.com/article/26650)介绍了如何实现必要的接口。虽然描述是针对 C++ 实现的，但您可以将这些知识应用于您的 C# 版本。

您的 COM 组件将具有称为 Class-ID 或 CLSID 的 GUID。您需要将该 ID 与您的文件类型一起注册为上下文菜单 shell 扩展名：

```
HKEY_CLASSES_ROOT\.eic\ShellEx\ContextMenuHandlers\MyShellExt
    (Default) -> {YOUR-COMPONENTS-CLSID} 
```

还要确保按照 C# COM 教程中的说明正确注册了组件。您应该在注册表中找到它

```
HKEY_CLASSES_ROOT\CLSID\{YOUR-COMPONENTS-CLSID}
    InprocServer32
        (Default) -> C:\WINDOWS\system32\mscoree.dll
        Class -> YourImplClass
        assembly -> YourAssembly, version=..., Culture=neutral, PublicKey=...
        ... 
```

祝你好运...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T03:13:05.373

正如其他人所指出的，shell 扩展目前在 Windows 开发中并不实用。

[我最近问了一个类似的问题](https://stackoverflow.com/questions/437972/windows-shell-integration-using-net)，得到了一个指南的链接来回答我想做的事情

# javascript - jquery：最快的 DOM 插入？

> ID：117665
> 
> 赞同：21
> 
> 时间：2008-09-22T21:09:42.623
> 
> 标签：javascript, jquery, dom

我对如何插入大量 HTML 有一种不好的感觉。假设我们得到：

`var html="<table>..<a-lot-of-other-tags />..</table>"`

我想把它放进去

`$("#mydiv")`

以前我做过类似的事情

`var html_obj = $(html);` `$("#mydiv").append(html_obj);`

jQuery 正在解析`html`以创建 DOM-Objects 是否正确？好吧，这就是我在某处读到的**（更新：**我的意思是我已经读过，jQuery 解析 html 以手动创建整个 DOM 树 - 胡说八道吧？！**）**，所以我更改了我的代码：

`$("#mydiv").attr("innerHTML", $("#mydiv").attr("innerHTML") + html);`

感觉更快，是吗？这是否等同于：

`document.getElementById("mydiv").innerHTML += html`? 还是 jquery 在后台做一些额外的昂贵的东西？

也很想学习替代品。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2010-12-12T09:57:58.297

尝试以下操作：

```
$("#mydiv").append(html); 
```

其他答案，包括接受的答案，[要](http://jsperf.com/jquery-append-html/1)**慢**2-10x ：**jsperf**。

接受的答案在**IE 6、7 和 8**中不起作用，因为由于 IE: [jsbin](http://jsbin.com/akoje4/5/)`innerHTML`中的错误，您无法设置元素。`<table>`

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-22T22:22:32.137

innerHTML 非常快，在许多情况下，您只需设置它就会得到最好的结果（我只会使用 append）。

**但是，如果“mydiv”中已经有很多内容，那么您将强制浏览器再次解析和呈现所有这些内容（之前存在的所有内容，以及所有新内容）。** 您可以通过将文档片段附加到“mydiv”来避免这种情况：

```
var frag = document.createDocumentFragment();
frag.innerHTML = html;
$("#mydiv").append(frag); 
```

这样，只有您的新内容会被解析（不可避免），而现有内容不会。

编辑：我的错......我发现文档片段上的 innerHTML 没有得到很好的支持。您可以对任何节点类型使用相同的技术。对于您的示例，您可以创建根表节点并将 innerHTML 插入其中：

```
var frag = document.createElement('table');
frag.innerHTML = tableInnerHtml;
$("#mydiv").append(frag); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-22T21:17:01.687

你试图避免什么？“不好的感觉”非常模糊。如果您听说过“DOM 很慢”并决定“避免使用 DOM”，那么这是不可能的。将代码插入页面的每种方法，包括 innerHTML，都会导致创建 DOM 对象。DOM 是文档在浏览器内存中的表示。您*希望*创建 DOM 对象。

人们之所以说“DOM 很慢”，是因为使用`document.createElement()`DOM 创建元素的官方接口比在某些浏览器中使用非标准的 innerHTML 属性要慢。这并不意味着创建 DOM 对象不好，创建 DOM 对象是*必要*的，否则你的代码根本不会做任何事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-27T03:04:06.643

使用 DOM 片段的答案是正确的。如果您有一堆 html 对象不断插入到 DOM 中，那么您将看到使用该片段的一些速度改进。John Resig 的这篇文章很好地解释了这一点：http: [//ejohn.org/blog/dom-documentfragments/](http://ejohn.org/blog/dom-documentfragments/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-10T03:44:44.373

**追加项目的最快方法**

追加到 DOM 树的最快方法是将所有追加内容缓冲到单个 DOM 片段中，然后将 dom 片段追加到 dom。

这是我在游戏引擎中使用的方法。

```
//Returns a new Buffer object
function Buffer() {

    //the framgment
    var domFragment = document.createDocumentFragment();

    //Adds a node to the dom fragment
    function add(node) {
        domFragment.appendChild(node);
    }

    //Flushes the buffer to a node
    function flush(targetNode) {

        //if the target node is not given then use the body
        var targetNode = targetNode || document.body;

        //append the domFragment to the target
        targetNode.appendChild(domFragment);

    }

    //return the buffer
    return {
        "add": add,
        "flush": flush
    }
}

//to make a buffer do this
var buffer = Buffer();

//to add elements to the buffer do the following
buffer.add(someNode1);

//continue to add elements to the buffer
buffer.add(someNode2);
buffer.add(someNode3);
buffer.add(someNode4);
buffer.add(someN...);

//when you are done adding nodes flush the nodes to the containing div in the dom
buffer.flush(myContainerNode); 
```

使用这个对象，我可以在 Firefox 4 中每秒向屏幕渲染约 1000 个项目约 40 次。

这是一个用例。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T21:16:27.413

对于初学者，编写一个脚本，计算每种方法执行 100 或 1,000 次所需的时间。

为了确保重复不会以某种方式被优化掉——我不是 JavaScript 引擎方面的专家——改变你每次插入的 html，比如把 '0001' 然后 '0002' 然后 '0003' 在某个表格的单元格。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-28T14:32:54.123

我创建了一个巨大的字符串，然后用 jquery 附加这个字符串。对我来说效果很好，速度很快。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-22T21:59:04.893

你提到对替代品感兴趣。如果您查看与[DOM 相关的 jQuery 插件](http://plugins.jquery.com/project/Plugins/category/55)列表，您会发现一些专用于以编程方式生成 DOM 树的插件。参见例如[SuperFlyDom](http://plugins.jquery.com/project/SuperFlyDOM)或[DOM Elements Creator](http://plugins.jquery.com/project/DOMEC)；但还有其他人。

# html - 使用 CSS 超链接图像

> ID：117667
> 
> 赞同：8
> 
> 时间：2008-09-22T21:09:58.317
> 
> 标签：html, css

我知道这可能是有史以来最愚蠢的问题，但是当谈到 CSS 时，我是一个完全的初学者；如何使用来自 CSS 的图像超链接网页上的图像？我正在尝试在我的网站上设置可链接到首页的标题图片。谢谢！

**编辑：**为了清楚起见，我*从 CSS*采购我的图像，标题 div 的 CSS 代码如下：-

```
#header
{
    width: 1000px;
    margin: 0px auto;
    padding: 0px 15px 0px 15px;
    border: none;
    background: url(images/title.png) no-repeat bottom;
    width: 1000px;
    height: 100px;
} 
```

我想知道如何在我的网页上制作这个*div*的超链接，而不必使其成为锚点而不是 div。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-22T21:14:53.377

您使用 CSS 控制设计和样式，而不是内容的行为。

您将不得不使用类似的东西`<a id="header" href="[your link]">Logo</a>`，然后有一个 CSS 块，例如：

```
a#header {
  background-image: url(...);
  display: block;
  width: ..;
  height: ...;
} 
```

您不能嵌套一个`div`内部`<a>`并且仍然有“有效”代码。`<a>`是不能合法包含块元素的内联元素。创建链接的唯一非 Javascript 方法是使用`<a>`元素。

您可以将`<a>`标签嵌套在`<div>`其中，然后将图像放入其中:)

如果你不想这样，你将不得不使用 JavaScript 来使你的`<div>`可点击：

```
Document.getElementById("header").onclick = function() {
    window.location='...'; 
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-22T21:17:24.133

要链接 CSS 来源的背景图像：

```
#header { 
display:block;

margin: 0px auto;
padding: 0px 15px 0px 15px;
border: none;
background: url(images/title.png) no-repeat bottom;
width: 1000px;
height: 100px;    
}    

<a id="header" href="blah.html" class="linkedImage"> 
```

这里的关键是将锚标签变成块元素，这样高度和宽度就起作用了。否则它是一个内联元素并且会忽略高度。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-22T21:11:21.980

这真的不是 CSS 的东西。你仍然需要你的 A 标签来完成这项工作。（但是使用 CSS 来确保图像边框被移除，或者根据您的要求设计。）

```
<a href="index.html"><img src="foo" class="whatever" alt="foo alt" /></a> 
```

编辑：考虑到原始意图（更新的问题），一个新的代码示例如下：

```
<a href="index.html"><img id="header" alt="foo alt" /></a> 
```

正如此问题的其他答案所述，您仍然处于链接的 HTML 世界中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-08-15T05:32:18.307

sorry to spoil your fun ladies and gentlemen, it is possible.

```
Write in your header: [link](http://"link here")

then in your css:

#header a[href="https://link here"] {
          display: inline-block;
          width: 75px;
          height: 75px;
          font-size: 0;
        }
        .side .md a[href="link here"] {
          background: url(%%picture here%%) no-repeat;
        } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T21:15:55.947

```
<a href="linkto_title_page.html" class="titleLink"></a> 
```

然后在你的 CSS

```
.titleLink {
  background-image: url(imageUrl);
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T21:11:59.983

您仍然可以像平常一样使用“a”（锚）标签在 HTML 中创建链接。CSS 没有任何东西可以指定某个东西是否是指向某个地方的链接。

**编辑** 我和其他人的评论仍然适用。为了澄清，您可以使用 JavaScript 使 div 充当链接：

```
<div id="header" onclick="window.location='http://google.com';">My Header</div> 
```

这对于可用性来说并不是很好，但是因为没有启用 JavaScript 的人将无法单击它并将其用作链接。

此外，您可能希望在`cursor: pointer;`CSS 中添加一行，以便为标题 div 提供链接的正确鼠标光标。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T21:15:17.650

CSS 仅用于演示，不用于内容。`<a href="">`链接是内容，应该使用标准标签放入网站的 HTML 中。然后，您可以使用 CSS 设置此链接的样式（或向链接添加图像）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T21:28:19.193

HTML 是创建链接的唯一方法——它定义了网站的结构和内容。

CSS 代表层叠**样式**表——它只影响事物的外观。

虽然通常是`<a/>`; 标签是创建链接的唯一方法，您可以`<div/>`使用 JavaScript 制作可点击的链接。我会使用 jQuery：

```
$("div#header").click(function() {window.location=XXXXXX;}); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-17T19:40:23.417

试试这个 - 改用 H1 作为图形的位置。一次又一次地救了我的屁股：

```
<h1 class="technique-six">
    CSS-Tricks
</h1>

h1.technique-six {
    width: 350px;
    padding: 75px 0 0 0;
    height: 0;
    background: url("images/header-image.jpg") no-repeat;
    overflow: hidden;
} 
```

可访问，并且跨浏览器 IE6 和 > 也很可靠。您也可以链接H1。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T20:09:50.577

您必须使用包装在容器中的锚元素。在您的主页上，您的标题通常是 h1，但在内容页面上，它可能会更改为 div。对于没有 CSS 支持和/或屏幕阅读器的人，您还应该始终在锚元素中包含文本。隐藏它的最简单方法是通过 CSS。以下是两个示例：

```
<h1 id="title"><a title="Home" href="index.html>My Title</a></h1>
<div id="title"><a title="Home" href="index.html>My Title</a></div> 
```

和CSS：

```
#title {
position:relative; /*Makes this a containing element*/
}
#title a {
background: transparent url(../images/logo.png) no-repeat scroll 0 0;
display:block;
text-indent:-9999px; /*Hides the anchor text*/
height:50px; /*Set height and width to the exact size of your image*/
width:200px;
} 
```

根据样式表的其余部分，您可能需要针对 h1 对其进行调整以使其看起来与 div 相同，请查看 CSS Resets 以获得可能的解决方案。

# java - 等到任何未来 已经完成了

> ID：117690
> 
> 赞同：55
> 
> 时间：2008-09-22T21:13:14.597
> 
> 标签：java, multithreading, concurrency

我运行的异步任务很少，我需要等到其中至少一个完成（将来我可能需要等待 util M out of N 个任务完成）。目前它们被呈现为未来，所以我需要类似的东西

```
/**
 * Blocks current thread until one of specified futures is done and returns it. 
 */
public static <T> Future<T> waitForAny(Collection<Future<T>> futures) 
        throws AllFuturesFailedException 
```

有这样的吗？或任何类似的东西，对 Future 来说不是必需的。目前我循环收集期货，检查一个是否完成，然后休眠一段时间并再次检查。这看起来不是最好的解决方案，因为如果我长时间睡眠，则会增加不必要的延迟，如果我睡眠时间很短，则会影响性能。

我可以尝试使用

```
new CountDownLatch(1) 
```

并在任务完成时减少倒计时并执行

```
countdown.await() 
```

，但我发现只有在我控制未来创建时才有可能。这是可能的，但需要重新设计系统，因为当前创建任务的逻辑（向 ExecutorService 发送 Callable）与等待哪个 Future 的决策是分开的。我也可以覆盖

```
<T> RunnableFuture<T> AbstractExecutorService.newTaskFor(Callable<T> callable) 
```

并创建 RunnableFuture 的自定义实现，能够附加侦听器以在任务完成时收到通知，然后将此类侦听器附加到所需的任务并使用 CountDownLatch，但这意味着我必须为我使用的每个 ExecutorService 覆盖 newTaskFor - 并且可能会有实现它不扩展 AbstractExecutorService。我也可以尝试包装给定的 ExecutorService 用于相同的目的，但是我必须装饰所有产生 Futures 的方法。

所有这些解决方案都可能有效，但看起来非常不自然。看起来我错过了一些简单的东西，比如

```
WaitHandle.WaitAny(WaitHandle[] waitHandles) 
```

在 C# 中。这类问题有没有众所周知的解决方案？

更新：

最初我根本无法访问 Future 创建，因此没有优雅的解决方案。重新设计系统后，我可以访问 Future 创建并能够将 countDownLatch.countdown() 添加到执行过程中，然后我可以 countDownLatch.await() 并且一切正常。感谢其他答案，我不知道 ExecutorCompletionService ，它确实可以在类似的任务中有所帮助，但在这种特殊情况下，它无法使用，因为某些 Futures 是在没有任何执行程序的情况下创建的 - 实际任务通过网络发送到另一台服务器，远程完成并收到完成通知。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-22T23:42:28.200

很简单，看看[ExecutorCompletionService](http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ExecutorCompletionService.html)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T03:45:41.597

[ExecutorService.invokeAny](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorService.html#invokeAny(java.util.Collection))

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T01:42:18.070

为什么不直接创建一个结果队列并在队列中等待呢？或者更简单地说，使用 CompletionService，因为它就是：ExecutorService + 结果队列。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-22T23:08:26.583

使用 wait() 和 notifyAll() 这实际上很容易。

首先，定义一个锁对象。（您可以为此使用任何类，但我喜欢明确）：

```
package com.javadude.sample;

public class Lock {} 
```

接下来，定义您的工作线程。当他完成他的处理时，他必须通知那个锁对象。请注意，通知必须在锁对象上的同步块中锁定。

```
package com.javadude.sample;

public class Worker extends Thread {
    private Lock lock_;
    private long timeToSleep_;
    private String name_;
    public Worker(Lock lock, String name, long timeToSleep) {
        lock_ = lock;
        timeToSleep_ = timeToSleep;
        name_ = name;
    }
    @Override
    public void run() {
        // do real work -- using a sleep here to simulate work
        try {
            sleep(timeToSleep_);
        } catch (InterruptedException e) {
            interrupt();
        }
        System.out.println(name_ + " is done... notifying");
        // notify whoever is waiting, in this case, the client
        synchronized (lock_) {
            lock_.notify();
        }
    }
} 
```

最后，您可以编写您的客户端：

```
package com.javadude.sample;

public class Client {
    public static void main(String[] args) {
        Lock lock = new Lock();
        Worker worker1 = new Worker(lock, "worker1", 15000);
        Worker worker2 = new Worker(lock, "worker2", 10000);
        Worker worker3 = new Worker(lock, "worker3", 5000);
        Worker worker4 = new Worker(lock, "worker4", 20000);

        boolean started = false;
        int numNotifies = 0;
        while (true) {
            synchronized (lock) {
                try {
                    if (!started) {
                        // need to do the start here so we grab the lock, just
                        //   in case one of the threads is fast -- if we had done the
                        //   starts outside the synchronized block, a fast thread could
                        //   get to its notification *before* the client is waiting for it
                        worker1.start();
                        worker2.start();
                        worker3.start();
                        worker4.start();
                        started = true;
                    }
                    lock.wait();
                } catch (InterruptedException e) {
                    break;
                }
                numNotifies++;
                if (numNotifies == 4) {
                    break;
                }
                System.out.println("Notified!");
            }
        }
        System.out.println("Everyone has notified me... I'm done");
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-22T21:18:03.853

据我所知，Java 没有与该`WaitHandle.WaitAny`方法类似的结构。

在我看来，这可以通过“WaitableFuture”装饰器来实现：

```
public WaitableFuture<T>
    extends Future<T>
{
    private CountDownLatch countDownLatch;

    WaitableFuture(CountDownLatch countDownLatch)
    {
        super();

        this.countDownLatch = countDownLatch;
    }

    void doTask()
    {
        super.doTask();

        this.countDownLatch.countDown();
    }
} 
```

虽然这只有在它可以插入到执行代码之前才有效，否则执行代码将没有新`doTask()`方法。但是，如果您在执行之前无法以某种方式获得对 Future 对象的控制权，那么我真的认为没有轮询就没有办法做到这一点。

或者如果未来总是在它自己的线程中运行，你可以通过某种方式得到那个线程。然后你可以生成一个新线程来连接其他线程，然后在连接返回后处理等待机制......这真的很难看，而且会产生很多开销。如果某些 Future 对象没有完成，您可能会有很多阻塞线程，具体取决于死线程。如果您不小心，这可能会泄漏内存和系统资源。

```
/**
 * Extremely ugly way of implementing WaitHandle.WaitAny for Thread.Join().
 */
public static joinAny(Collection<Thread> threads, int numberToWaitFor)
{
    CountDownLatch countDownLatch = new CountDownLatch(numberToWaitFor);

    foreach(Thread thread in threads)
    {
        (new Thread(new JoinThreadHelper(thread, countDownLatch))).start();
    }

    countDownLatch.await();
}

class JoinThreadHelper
    implements Runnable
{
    Thread thread;
    CountDownLatch countDownLatch;

    JoinThreadHelper(Thread thread, CountDownLatch countDownLatch)
    {
        this.thread = thread;
        this.countDownLatch = countDownLatch;
    }

    void run()
    {
        this.thread.join();
        this.countDownLatch.countDown();
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-10-28T08:03:18.880

如果您可以使用[`CompletableFuture`](https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/concurrent/CompletableFuture.html)s 代替，那么您可以使用[`CompletableFuture.anyOf`](https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/concurrent/CompletableFuture.html#anyOf(java.util.concurrent.CompletableFuture...))它，只需在结果上调用 join ：

```
CompletableFuture.anyOf(futures).join() 
```

您可以`CompletableFuture`通过调用[`CompletableFuture.supplyAsync`](https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/concurrent/CompletableFuture.html#supplyAsync(java.util.function.Supplier,java.util.concurrent.Executor))or`runAsync`方法将 s 与执行程序一起使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T21:18:44.957

既然您不在乎哪个完成，为什么不为所有线程设置一个 WaitHandle 并等待呢？谁先完成就可以设置手柄。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-08T10:02:17.807

看到这个选项：

```
public class WaitForAnyRedux {

private static final int POOL_SIZE = 10;

public static <T> T waitForAny(Collection<T> collection) throws InterruptedException, ExecutionException {

    List<Callable<T>> callables = new ArrayList<Callable<T>>();
    for (final T t : collection) {
        Callable<T> callable = Executors.callable(new Thread() {

            @Override
            public void run() {
                synchronized (t) {
                    try {
                        t.wait();
                    } catch (InterruptedException e) {
                    }
                }
            }
        }, t);
        callables.add(callable);
    }

    BlockingQueue<Runnable> queue = new ArrayBlockingQueue<Runnable>(POOL_SIZE);
    ExecutorService executorService = new ThreadPoolExecutor(POOL_SIZE, POOL_SIZE, 0, TimeUnit.SECONDS, queue);
    return executorService.invokeAny(callables);
}

static public void main(String[] args) throws InterruptedException, ExecutionException {

    final List<Integer> integers = new ArrayList<Integer>();
    for (int i = 0; i < POOL_SIZE; i++) {
        integers.add(i);
    }

    (new Thread() {
        public void run() {
            Integer notified = null;
            try {
                notified = waitForAny(integers);
            } catch (InterruptedException e) {
                e.printStackTrace();
            } catch (ExecutionException e) {
                e.printStackTrace();
            }
            System.out.println("notified=" + notified);
        }

    }).start();

    synchronized (integers) {
        integers.wait(3000);
    }

    Integer randomInt = integers.get((new Random()).nextInt(POOL_SIZE));
    System.out.println("Waking up " + randomInt);
    synchronized (randomInt) {
        randomInt.notify();
    }
  }
} 
```

# algorithm - 您如何将整数数组显示为一组范围？（算法）

> ID：117691
> 
> 赞同：8
> 
> 时间：2008-09-22T21:13:15.127
> 
> 标签：algorithm, arrays, language-agnostic, range

给定一个整数数组，迭代它并找出它所涵盖的所有范围的最简单方法是什么？例如，对于一个数组，例如：

```
$numbers = array(1,3,4,5,6,8,11,12,14,15,16); 
```

范围将是：

```
 1,3-6,8,11-12,14-16 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T21:21:38.430

如果数组按升序排序，那么问题就简单了。定义一个`Range`结构或类，它有一个开始和一个结束。然后遍历数组。如果当前元素比前一个元素多一个，则更新`Range.end`，否则创建一个新范围，该元素为`Range.begin`。将范围存储到动态数组或链表中。或者只是在你去的时候把它们打印出来。

如果数组可能没有排序，那么先排序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T11:05:54.470

这是 C# 3.0'y 的做法：

兴趣点：

*   自动属性 ​​(public int Property { get; set; })
*   使用新的对象初始化器（新 Range { Begin = xxx; ... }
*   使用 yield 进行惰性求值
*   使用 linq 扩展方法（First() 和 Skip()）

-

```
class Demo
{
    private class Range
    {
        public int Begin { get; set; }
        public int End { get; set; }

        public override string ToString()
        {
            if (Begin == End)
                return string.Format("{0}", Begin);
            else
                return string.Format("{0}-{1}", Begin, End);
        }
    }

    static void Main(string[] args)
    {
        var list = new List<int> { 1, 3, 4, 5, 6, 8, 11, 12, 14, 15, 16 };
        // list.Sort();
        var ranges = GetRangesForSortedList(list);

        PrintRange(ranges);

        Console.Read();
    }

    private static void PrintRange(IEnumerable<Range> ranges)
    {
        if (ranges.Count() == 0)
            return;

        Console.Write("[{0}", ranges.First());

        foreach (Range range in ranges.Skip(1))
        {
            Console.Write(", {0}", range);
        }

        Console.WriteLine("]");
    }

    private static IEnumerable<Range> GetRangesForSortedList(IList<int> sortedList)
    {
        if (sortedList.Count < 1) 
            yield break;

        int firstItem = sortedList.First();
        Range currentRange = new Range { Begin = firstItem, End = firstItem };

        foreach (int item in sortedList.Skip(1))
        {
            if (item == currentRange.End + 1)
            {
                currentRange.End = item;
            }
            else
            {
                yield return currentRange;
                currentRange = new Range { Begin = item, End = item };
            }
        }

        yield return currentRange;
    }
} 
```

干杯，大卫

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T21:21:23.143

这是一个python实现，应该很容易理解

```
numbers = [1,3,4,5,6,8,11,12,14,15,16];

def is_predecessor(i1, i2):
    if i1 == i2 - 1:
        return True;
    else:
        return False;

def make_range(i1, i2):
    if i1 == i2:
        return str(i1);
    else:
        return str(i1) + "-" + str(i2);

previous_element = None;
current_start_element = None;

for number in numbers:
    if not is_predecessor(previous_element, number):
        if current_start_element is not None:
            print make_range(current_start_element, previous_element);
        current_start_element = number;
    previous_element = number;

# handle last pair
if current_start_element is not None:
    print make_range(current_start_element, previous_element); 
```

这输出：

```
1
3-6
8
11-12
14-16 
```

我知道，我知道，它不是一种*算法*，但我发现在没有缩进问题的情况下实际解释它比仅仅为它实现一个解决方案更难。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T21:21:50.270

第一个：排序第二个：标记化然后：打印第一个值并循环后续的值。如果“当前”值等于最后一个值 +1，则跳过它。否则，如果您跳过了值打印破折号和值，否则打印逗号并重复。

应该这样做。除非你想让我帮你写作业？:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T21:39:19.260

如果数组已排序，如您的示例所示，我将定义包含最小值和最大值的存储桶。

初始化：创建一个最小值和最大值等于第一个值的存储桶。

循环：将每个值与当前桶的最大值进行比较。如果它等于或大于当前最大值 1，则更新最大值。如果它比最大值大 1 多，则将存储桶保存到存储桶列表并启动一个新存储桶。

最后，您将有一组桶，每个桶都有一个最小值和一个最大值。如果最小值与最大值相同，则打印一个数字（即：在您的示例中，第一个存储桶的最小值和最大值为 1）。如果它们不同，则打印为范围。

lisp 中的示例实现：

```
CL-USER> (defun print-ranges (integer-list)
           (let ((sorted-list (sort integer-list #'<)))
             (loop with buckets = ()
                   with current-bucket
                   for int in sorted-list
                     initially (setf current-bucket (cons (first sorted-list) (first sorted-list)))
                   do (cond ((= int (cdr current-bucket))) ; do nothing, this number is already in range
                            ((= (1- int) (cdr current-bucket)) ; number is 1 higher--update bucket's max
                             (setf (cdr current-bucket) int))
                            (t
                             (push current-bucket buckets)
                             (setf current-bucket (cons int int)))) ; set up a new bucket
                   finally (push current-bucket buckets)
                           (loop for firstp = t then nil
                                 for bucket in (nreverse buckets) do
                                   (cond ((= (car bucket) (cdr bucket))
                                          (format t "~:[,~;~]~D" firstp (car bucket)))
                                         (t
                                          (format t "~:[,~;~]~D-~D" firstp (car bucket) (cdr bucket))))))))
PRINT-RANGES
CL-USER> (print-ranges (list 1 3 4 5 6 8 11 12 14 15 16))
1,3-6,8,11-12,14-16
NIL
CL-USER> 
```

基本上，您最终会得到一个事物列表，其中每个事物都有（最低桶，最高桶）。这些是你的范围。

如果列表尚未排序，请先排序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-24T14:38:17.503

# C (海合会)

它类似于[Python 的版本](https://stackoverflow.com/questions/117691/how-would-you-display-an-array-of-integers-as-a-set-of-ranges-algorithm#233529)。

```
void ranges(int n; int a[n], int n)
{
  qsort(a, n, sizeof(*a), intcmp);
  for (int i = 0; i < n; ++i) {
    const int start = i;
    while(i < n-1 and a[i] >= a[i+1]-1)
      ++i;
    printf("%d", a[start]);
    if (a[start] != a[i])
      printf("-%d", a[i]);
    if (i < n-1)
      printf(",");
  }
  printf("\n");
} 
```

例子：

```
/**
 * $ gcc -std=c99 -Wall ranges.c -o ranges && ./ranges
 */
#include <iso646.h> // and
#include <stdio.h>
#include <stdlib.h>

#define T(args...)                                              \
  {                                                             \
    int array[] = {args};                                       \
    ranges(array, sizeof(array) / sizeof(*array));              \
  }

int intcmp(const void* a, const void* b)
{
  const int *ai = a;
  const int *bi = b;

  if (*ai < *bi)
    return -1;
  else if (*ai > *bi)
    return 1;
  else
    return 0;
}

int main(void)
{
  T(1,3,4,5,6,8,11,12,14,15,16);
  T();
  T(1);
  T(1, 2);
  T(3, 1);
  T(1, 3, 4);
  T(1, 2, 4);
  T(1, 1, 2, 4);
  T(1, 2, 2, 4);
  T(1, 2, 2, 3, 5, 5);
} 
```

输出：

```
1,3-6,8,11-12,14-16

1
1-2
1,3
1,3-4
1-2,4
1-2,4
1-2,4
1-3,5 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T21:23:32.373

假设列表是有序的，您可以从最后开始并继续减去下一个。虽然差值为 1，但您在一个范围内。如果不是，您将开始一个新的范围。

IE

16-15 = 1

15-14 = 1

14-12 = 2，范围是 16-14 - 开始一个新的范围。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T21:26:49.527

```
startRange = array[0];    
for(i=0;i<array.length;i++)
{
   if (array[i + 1] - array[i] > 1)
   {
     endRange = array[i];
     pushRangeOntoArray(startRange,endRange);
     i++;
     startRange = array[i]
     // need to check for end of array here
   }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T21:32:35.067

这是我的 Perl 解决方案。可能更干净，更快，但它显示了它是如何工作的：

```
# Just in case it's not sorted...
my @list = sort { $a <=> $b } ( 1, 3, 4, 5, 6, 8, 11, 12, 14, 15, 16 );

my $range = [ $list[0] ];

for(@list[1 .. $#list]) {
    if($_ == $range->[-1] + 1) {
        push @$range, $_;
    }
    else {
        print $#$range ? $range->[0] . '-' . $range->[-1] : $range->[0], "\n";
        $range = [ $_ ];
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T21:35:14.670

我在 Java 1.5 中的解决方案是：

```
public static List<String> getRanges(int... in) {
    List<String> result = new ArrayList<String>();
    int last = -1;
    for (int i : in) {
        if (i != (last + 1)) {
            if (!result.isEmpty()) {
                addRange(result, last);
            }
            result.add(String.valueOf(i));
        } 
        last = i;
    }
    addRange(result, last);
    return result;
}

private static void addRange(List<String> result, int last) {
    int lastPosition = result.size() - 1;
    String lastResult = result.get(lastPosition);
    if (!lastResult.equals(String.valueOf(last))) {
        result.set(lastPosition, lastResult + "-" + last);
    }
}

public static void main(String[] args) {
    List<String> ranges = getRanges(1, 3, 4, 5, 6, 8, 11, 12, 14, 15, 16);
    System.out.println(ranges);
} 
```

输出：

```
[1, 3-6, 8, 11-12, 14-16] 
```

格瑞兹，GHad

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T21:39:11.197

我相信在 1.5 版本中引入 Subversion 的 mergeinfo 属性的格式与您要求的格式相同，因此您可以查看 Subversion 的源代码以了解它们是如何做到的。如果它与已在此处发布的其他建议有任何不同，我会感到惊讶。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-22T21:43:05.680

我将假设数组 X() 是预先排序的（如果不是，则预先对数组进行排序）。

```
对于 X() 的每个元素作为 $element （以 $i 作为当前数组位置）
    将 $element 添加到数组 Y() 的末尾
    如果 (X($i) + 1 小于 X($i + 1)) AND ($i + 1 不大于 sizeof(X())) 则
        将 Y(1)."-".Y(sizeof(Y())) 附加到 Z() 的末尾
        未设置 Y()
    万一    
下一个
如果 Y() 中有任何内容，则附加到 Z() 的末尾

```

好吧，我就是这样做的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T21:55:11.953

创建一个简单的范围类型，其中包含范围值的开始/结束。添加一个只接受一个值并设置 start = end = value 的构造函数。维护一堆范围对象，按照自己的方式处理数组的排序副本，扩展顶部范围或根据需要添加新范围。更具体地说，当数组中的值为 1 + 堆栈中范围对象的结束值时，增加该范围的结束值，如果不是，则推入一个新范围（其中 start = end = value at数组中的索引）到堆栈上。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-22T22:57:20.773

```
module Main where

ranges :: [Int] -> [[Int]]
ranges [] = []
ranges list@(x:xs) = let adj = adjacent list in
             let len = length adj in
                 if length adj == 1
                then [[x]] ++ ranges xs
                else [[x,(last adj)]] ++ ranges (drop ((length adj) - 1) xs)
    where adjacent [] = []
          adjacent (x:xs) = if (xs /= []) && (x + 1) == head xs
             then [x] ++ adjacent (xs)
             else [x]

main = do putStrLn $ show $ ranges [1,2,3,4,5,6,8,11,12,14,15,16]

-- Output: [[1,6],[8],[11,12],[14,16]] 
```

这是我在 Haskell 中最好的镜头。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-24T23:37:29.007

## Perl 6

```
sub to_ranges( Int *@data ){
  my @ranges;

  OUTER: for @data -> $item {
    for @ranges -> $range {
      # short circuit if the $item is in a range
      next OUTER if $range[0] <= $item <= $range[1];

      given( $item ){
        when( $range[0]-1 ){ $range[0] = $item }
        when( $range[1]+1 ){ $range[1] = $item }
      }
    }

    push @ranges, [$item,$item];
  }

  return @ranges;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-24T13:30:17.017

# Python (>= 2.6)

此版本还处理重复和未排序的序列。

```
from __future__ import print_function

def ranges(a):
    a.sort()
    i = 0
    while i < len(a):
        start = i
        while i < len(a)-1 and a[i] >= a[i+1]-1:
            i += 1
        print(a[start] if a[start] == a[i] else "%d-%d" % (a[start], a[i]),
              end="," if i < len(a)-1 else "\n")
        i += 1 
```

例子：

```
import random
r = range(10)
random.shuffle(r)
ranges(r)
ranges([1,3,4,5,6,8,11,12,14,15,16]);
ranges([])
ranges([1])
ranges([1, 2])
ranges([1, 3])
ranges([1, 3, 4])
ranges([1, 2, 4])
ranges([1, 1, 2, 4])
ranges([1, 2, 2, 4])
ranges([1, 2, 2, 3, 5, 5]) 
```

输出：

```
0-9
1,3-6,8,11-12,14-16
1
1-2
1,3
1,3-4
1-2,4
1-2,4
1-2,4
1-3,5 
```

# c++ - Win32下如何初始化Pango？

> ID：117693
> 
> 赞同：1
> 
> 时间：2008-09-22T21:13:56.093
> 
> 标签：c++, winapi, graphics, fonts, pango

从 GTK+ 项目的 Win32 下载[页面](https://www.gtk.org/download/windows.php)下载 Pango 和 GLib并在 Visual Studio 2005 下创建和配置了一个 Win32 项目，使其指向正确的*库*和*包含*目录，如何初始化 Pango 以渲染到 Win32 窗口？

第一个电话应该是**pango_win32_get_context()**吗？调用该函数会导致应用程序挂起该调用，因为该函数永远不会返回。

第一个电话应该是什么？还需要哪些其他调用来为 Win32 初始化 Pango 并呈现简单的文本字符串？是否有在线可用的示例在 Win32 下使用 Pango 进行渲染？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T22:53:35.777

Pango 是一个基于 GObject 的库。因此，您需要确保 glib 动态类型系统在使用其任何功能之前已初始化。这可以通过调用[`g_type_init()`](http://library.gnome.org/devel/gobject/stable/gobject-Type-Information.html#g-type-init)（直接或间接通过类似的方法`gtk_init()`）来完成。这可能是你的问题吗？

# compact-framework - 有什么方法可以在 Windows CE Core 许可证版本中使用 Help.ShowHelp？

> ID：117698
> 
> 赞同：1
> 
> 时间：2008-09-22T21:15:23.483
> 
> 标签：compact-framework, windows-ce

我正在为 Windows CE 6.0 开发一个 Compact Framework 3.5 应用程序。Help.ShowHelp() 引发 NotSupportedException。在 windowsembedded.com，我发现了这个声明：

“帮助不包含在核心运行时中，因为它需要浏览器。”

这是异常的原因吗？如果是这样，是否有任何推荐的方法来解决这个问题，或者我是否需要建立自己的帮助系统？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T21:51:25.347

ShowHelp 使用 CE 下的浏览器控件（通过 webview.dll IIRC）。浏览器控件绝对是专业 CE 许可证 SKU 的一部分（[此处](http://www.microsoft.com/downloads/details.aspx?familyid=4fb630a8-b710-4b50-bbd0-52a51fdae6e8&displaylang=en)的评估工具。曾经有一个 Word 文档列出了每个组件，但我似乎找不到它的下载地址），所以你必须滚动你的如果您打算继续使用核心许可证，请拥有自己的帮助框架。选项可能是使用[Opera](http://www.opera.com/pressreleases/en/2006/10/03/)或[MiniMo](https://wiki.mozilla.org/Minimo:WinCe/Device_Matrix)作为浏览器，但您仍然必须滚动所有搜索/帮助内容。

使用 RTF 可能更简单。

# c++ - 用于两个以上继承级别的非虚拟接口习惯用法？

> ID：117708
> 
> 赞同：5
> 
> 时间：2008-09-22T21:17:24.883
> 
> 标签：c++, inheritance, class-design, non-virtual-interface

非虚拟接口习惯用法描述了虚拟方法如何成为非公共定制点，而公共方法是非虚拟的，以允许基类始终控制定制点的调用方式。

这是一个优雅的习惯用法，我喜欢使用它，但是如果派生类本身就是一个基类，它是如何工作的

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T21:28:53.107

它可以工作，因为派生类可以覆盖基类的私有虚函数，即使基类函数覆盖了它的基类函数。

这是完全合法的：

```
 class Parent
{
public:
  int foo() {return bar();} // the non-virtual public interface
private
  virtual int bar();
};

class Child : public Parent
{
private:
  virtual int bar();  // overrides Parent::bar()
};

class Grandchild : public Child
{
private:
  virtual int bar(); // overrides Child::bar();
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T21:26:21.523

派生类可以自己决定：

您可以通过实现虚函数来完全覆盖该方法。您可以通过在派生类方法中的某个位置调用“中间”类函数来扩充该方法。

如果这不是您想要的，您需要在“中间”类中明确设置它。不过我不会。如果你发现自己想要这个，这可能意味着你没有给基类足够的定制点。

# python - 你能用 Python 或 Boo 之类的语言进行类似 LINQ 的查询吗？

> ID：117732
> 
> 赞同：4
> 
> 时间：2008-09-22T21:24:00.547
> 
> 标签：python, linq, linq-to-sql, ironpython, boo

以这个简单的*C# LINQ*查询为例，想象这`db.Numbers`是一个包含一列的*SQL*`Number`表：

```
var result = 
    from n in db.Numbers
        where n.Number < 5
        select n.Number; 
```

这将在*C#*中非常有效地运行，因为它会生成类似的*SQL*查询

```
select Number from Numbers where Number < 5 
```

它**没有**做的是从数据库中选择*所有*数字，然后在*C#*中过滤它们，就像它最初看起来那样。

*Python*支持类似的语法：

```
result = [n.Number for n in Numbers if n.Number < 5] 
```

但是这里的`if`子句在客户端而不是服务器端进行过滤，效率要低得多。

*Python*中是否有与*LINQ*一样高效的东西？（我目前正在评估*Python* vs. *IronPython* vs. *Boo*，因此适用于任何这些语言的答案都很好。）

 **** * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T00:52:48.563

[sqlalchemy](http://www.sqlalchemy.org/trac/wiki/SqlSoup)中的 sqlsoup 为您提供了 python 中最快的解决方案，我认为如果您想要一个清晰的（ish）单线。看看页面就知道了。

它应该是这样的......

```
result = [n.Number for n in db.Numbers.filter(db.Numbers.Number < 5).all()] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T21:35:01.127

仔细查看[SQLAlchemy](http://www.sqlalchemy.org/)。这可能可以做很多你想要的。它为您提供了在服务器上运行的普通 SQL 的 Python 语法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-22T21:40:10.977

LINQ 是 C# 和 VB.NET 的语言特性。它是编译器识别并特殊处理的特殊语法。它还依赖于另一种称为表达式树的语言特性。

表达式树**有点**不同，它们不是特殊的语法。它们的编写方式与任何其他类实例化一样，但编译器确实通过将 lambda 转换为运行时[抽象语法树](http://en.wikipedia.org/wiki/Abstract_syntax_tree)的实例化来特别处理它们。这些可以在运行时进行操作以生成另一种语言（即 SQL）的命令。

C# 和 VB.NET 编译器采用 LINQ 语法，并将其转换为 lambda，然后将其传递给表达式树实例。然后有一堆框架类可以操纵这些树来生成 SQL。您还可以找到其他提供“LINQ 提供程序”的库，包括 MS 生产的和第三方的，它们基本上弹出一个不同的 AST 处理器来从 LINQ 生成除 SQL 之外的东西。

因此，用另一种语言做这些事情的一个障碍是它们是否支持运行时 AST 构建/操作。我不知道 Python 或 Boo 是否有任何实现，但我还没有听说过任何此类功能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T00:11:39.660

我相信当 IronPython 2.0 完成时，它将支持 LINQ（有关示例讨论，请参阅[此线程）。](http://groups.google.com/group/ironpy/browse_thread/thread/eb6b9eb2241cc68e)现在你应该可以写出类似的东西：

```
Queryable.Select(Queryable.Where(someInputSequence, somePredicate), someFuncThatReturnsTheSequenceElement) 
```

IronPython 2.0b4 中可能会有更好的东西——目前有很多关于如何处理命名冲突的[讨论。](http://ironpython-urls.blogspot.com/2008/09/dlr-namespace-change-fire-drill.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T01:12:45.710

LINQ 的一个关键因素是编译器生成表达式树的能力。我在 Nemerle 中使用了一个宏，它将给定的 Nemerle 表达式转换为表达式树对象。然后我可以将它传递给 IQueryables 上的 Where/Select/etc 扩展方法。它不是 C# 和 VB 的语法，但对我来说已经足够接近了。

我通过这篇文章的链接获得了 Nemerle 宏： [http ://groups.google.com/group/nemerle-dev/browse_thread/thread/99b9dcfe204a578e](http://groups.google.com/group/nemerle-dev/browse_thread/thread/99b9dcfe204a578e)

应该可以为 Boo 创建一个类似的宏。然而，鉴于您需要支持大量可能的表达式，这是一项相当多的工作。Ayende 在这里给出了概念证明：http: [//ayende.com/Blog/archive/2008/08/05/Ugly-Linq.aspx](http://ayende.com/Blog/archive/2008/08/05/Ugly-Linq.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T18:55:58.060

Boo 支持使用与 python 相同的语法的列表生成器表达式。有关这方面的更多信息，请查看有关[生成器表达式](http://boo.codehaus.org/Generator+Expressions)和[列表](http://boo.codehaus.org/List+Generators)推导的 Boo 文档。

# java - Spring JTA TransactionManager 配置：同时支持 Tomcat 和 JBoss

> ID：117751
> 
> 赞同：10
> 
> 时间：2008-09-22T21:27:26.263
> 
> 标签：java, spring, jboss, jta, jotm

我有一个使用 JPA 和 JTA 和 Spring 的 Web 应用程序。我想同时支持 JBoss 和 Tomcat。在 JBoss 上运行时，我想使用 JBoss 自己的 TransactionManager，在 Tomcat 上运行时，我想使用 JOTM。

我有两种情况，但我现在发现我似乎需要两个单独的 Spring 配置来处理这两种情况。使用 JOTM，我需要使用 Spring 的`JotmFactoryBean`：

```
<bean id="transactionManager" 
 class="org.springframework.transaction.jta.JtaTransactionManager">
    <property name="userTransaction">
        <bean class="org.springframework.transaction.jta.JotmFactoryBean"/>
    </property>
</bean> 
```

不过，在 JBoss 中，我只需要从 JNDI 获取“TransactionManager”：

```
<bean id="transactionManager" 
 class="org.springframework.transaction.jta.JtaTransactionManager">
    <property name="transactionManager">
        <bean class="org.springframework.jndi.JndiObjectFactoryBean">
             <property name="resourceRef" value="true" />
             <property name="jndiName" value="TransactionManager" />
             <property name="expectedType" 
               value="javax.transaction.TransactionManager" />
        </bean>
    </property>
</bean> 
```

有没有办法配置它，以便使用适当的 TransactionManager - JBoss 或 JOTM - 而无需两个不同的配置文件？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-06T15:33:51.070

我认为您错过了 JNDI 的重点。JNDI 几乎是为解决您遇到的问题而编写的！

我认为您可以将其提升一个级别，因此根据您的情况，而不是使用“userTransaction”或“来自 JNDI 的 transactionManager”。为什么不将“JtaTransactionManager”添加到 JNDI。这样你就可以将配置推送到它应该在的 JNDI 中，而不是创建更多的配置文件 [ 好像还不够 ;) ]。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T21:51:16.610

您可以使用 PropertyConfigurerPlaceholder 注入 bean 引用以及简单值。

例如，如果您将 bean 称为“jotm”和“jboss”，那么您可以像这样注入 TM：

```
<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE">
    <property name="location" value="classpath:/path/to/application.properties"/>
</bean>
<bean id="jotm">...</bean>
<bean id="jboss">...</bean>
<bean id="bean-requiring-transaction-manager">
    <property name="transactionManager" ref="${transaction.strategy}"/>
</bean> 
```

然后你可以使用交换事务管理器

*   *属性文件中的*transaction.strategy=jotm**
**   *-Dtransaction.strategy=jotm*作为系统属性*

 *这是一种可能的方法。有关更完整的示例，请参阅我的[博客。](http://toolkits.blogspot.com/2008/04/changing-spring-beans-using-properties.html)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T22:08:31.127

如果您使用的是 Spring 2.5，则可以使用 <tx:jta-transaction-manager/>。我没有将它与 JBoss 一起使用，但根据Spring 参考手册中的第[9.8 节应用程序服务器特定的集成，它应该适合你。](http://static.springframework.org/spring/docs/2.5.x/reference/transaction.html#transaction-application-server-integration)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-04T19:40:26.940

该方法将在[此处列出](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/transaction/jta/JtaTransactionManager.html)`<tx:jta-transaction-manager/>`的几个默认位置查找事务管理器。如果您的 JBoss 事务管理器不在这些位置之一，我建议您尽可能移动它，或者将它移动到 Tomcat 中，以便两个容器的 TM 位于相同的 JNDI 位置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-22T16:16:50.133

只需在这里添加我的经验，这样我就不必再次遭受这种体验了。

正如 bmatthews68、Chochos 和[这些海报](https://stackoverflow.com/questions/1783540/spring-jta-configuration-how-to-set-transactionmanager)所说，`<tx:jta-transaction-manager/>`在你的 Spring bean 文件中使用；它确实提供了适当的抽象级别，并且不需要在 Spring 方面做任何额外的事情。

至于 Tomcat，我`<Transaction factory="org.objectweb.jotm.UserTransactionFactory" jotm.timeout="60" />`在默认/共享`conf/context.xml`文件中声明，该文件绑定到`java:comp/UserTransaction`. 由于这是 Spring 搜索的地方之一，因此您无需执行任何其他操作。

不过有个问题：如果像我一样使用 Maven，请确保排除对`javax.transaction:jta`jar 的任何依赖项或将范围设置为`provided`. 否则，您将遇到类加载器问题。

# networking - 你能推荐一个基于 Windows 的网络模拟器吗？

> ID：117754
> 
> 赞同：3
> 
> 时间：2008-09-22T21:27:57.620
> 
> 标签：networking, wireless

我正在寻找可以模拟 3G 无线网络的丢包和延迟特性的 Windows 网络模拟器。

我曾经使用 GIPs 中的一个已经报废的工具。我也尝试过 Shunra Virtual Enterprise，但发现它有点太基础了

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-04-17T19:11:56.057

dummynet 现在也可用于 Windows 和 linux。见 [http://info.iet.unipi.it/~luigi/dummynet/](http://info.iet.unipi.it/~luigi/dummynet/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T21:34:45.573

有一个名为 dummynet 的 FreeBSD 工具可以做到这一点。因为你有一个 Windows 设置，你可以把它放在一个单独的盒子上并通过它进行测试，或者甚至可以在你的 Windows 机器上的 VM 上运行它。我知道这个问题没有 Windows 解决方案，但也许其他人会。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-01T23:49:08.657

您是否尝试过适用于 Windows 的 LANforge ICE？[http://www.candelatech.com/lanforge_v3/datasheet.html#ice](http://www.candelatech.com/lanforge_v3/datasheet.html#ice)

# c++ - 在最佳时间从 _variant_t 获取 char*

> ID：117755
> 
> 赞同：4
> 
> 时间：2008-09-22T21:28:08.990
> 
> 标签：c++, visual-c++, com, ole, bstr

这是我想加快速度的代码。它从 ADO 记录集中获取一个值并将其转换为 char*。但这很慢。我可以跳过 _bstr_t 的创建吗？

```
 _variant_t var = pRs->Fields->GetItem(i)->GetValue();

                if (V_VT(&var) == VT_BSTR)
                {
                    char* p = (const char*) (_bstr_t) var; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-22T21:33:05.080

您的问题（除了 _bstr_t 内存副本的可能性）是您将 UNICODE BSTR 转换为 ANSI char*。

您可以使用在堆栈上执行转换的 USES_CONVERSION 宏，因此它们可能会更快。或者，如果可能，将 BSTR 值保留为 unicode。

转换：

```
USES_CONVERSION;
char* p = strdup(OLE2A(var.bstrVal));

// ...

free(p); 
```

记住 - 从 OLE2A（及其姊妹宏）返回的字符串返回一个分配在堆栈上的字符串 - 从封闭范围返回并且你有垃圾字符串，除非你复制它（并最终释放它，显然）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T00:36:15.887

BSTR 的前 4 个字节包含长度。如果是 unicode，则可以循环并获取每个其他字符，如果是多字节，则可以获取每个字符。某种 memcpy 或其他方法也可以。IIRC，这可能比`W2A`或铸造更快`(LPCSTR)(_bstr_t)`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T21:32:47.217

这会在堆栈上创建一个临时的：

```
USES_CONVERSION;
char *p=W2A(var.bstrVal); 
```

这使用了稍微更新的语法，并且可能更健壮。它具有可配置的大小，超过该大小它将使用堆，因此它避免将大量字符串放入堆栈：

```
char *p=CW2AEX<>(var.bstrVal); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-04T12:15:23.653

```
_variant_t var = pRs->Fields->GetItem(i)->GetValue(); 
```

您还可以通过避免将字段集合放在一起来更快地完成此分配。当您需要按名称检索项目时，您应该只使用 Fields 集合。如果您通过索引知道字段，则可以改用它。

```
_variant_t vara = pRs->Collect[i]->Value; 
```

注意 i 不能是整数，因为 ADO 不支持 VT_INTEGER，因此您不妨使用 long 变量。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-22T21:34:17.730

好的，我的 C++ 有点生锈了……但我不认为转换是你的问题。除了告诉编译器将 _bstr_t 视为 char* 之外，这种转换实际上并没有做任何事情。然后，您只需将该指针的地址分配给 p。实际上什么都没有“完成”。

你确定这不仅仅是从 GetValue 获取东西的速度慢吗？

还是我的 C++ 比我想象的更生疏……

# css - 哪些浏览器支持使用 CSS 和 page-break-inside 元素进行分页操作？

> ID：117772
> 
> 赞同：15
> 
> 时间：2008-09-22T21:31:13.117
> 
> 标签：css, page-break-inside

我正在尝试使用 page-break-inside CSS 指令，其类将附加到 div 标签或 table 标签（我认为这可能只适用于块元素，在这种情况下它必须是桌子）。

我已经尝试了所有应该准确描述如何做到这一点的教程，但没有任何效果。这是浏览器支持的问题还是有人真正得到了这个工作，CSS的确切位看起来像这样：

```
@media print {

  .noPageBreak {
     page-break-inside : avoid;
  }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-31T16:13:50.523

Safari 1.3 及更高版本（不知道 4）**不**支持 page-break-inside （试试看，或在这里查看：[http](http://reference.sitepoint.com/css/page-break-inside) ://reference.sitepoint.com/css/page-break-inside ）。Firefox 3 或 IE7 也没有（不知道 8）。

实际上，对这个属性的支持是参差不齐的，在这一点上使用它根本没有意义。如果您的访问者中有 10% 的浏览器可以支持这一点，那您就很幸运了。

我使用的解决方案是添加

`page-break-after:always`

到某些 div，或在需要中断的位置添加“分页符”div。我知道，这很笨拙，因为它不能完全满足您的要求，并且会导致内容无法到达打印页面的底部，但不幸的是没有更好的解决方案（证明我错了！）。

另一种方法是创建一个样式表，删除所有无关元素 ( `display:none`) 并使主要内容在一个主列中流动。基本上，将其转换为单列、纯文本文档。

最后，在为打印机设计样式时避免使用浮点数和列，这会使 IE（和 FF）表现得古怪。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T21:43:07.410

[**Safari**](http://developer.apple.com/documentation/AppleApplications/Reference/SafariCSSRef/Articles/StandardCSSProperties.html#//apple_ref/doc/uid/TP30001266-PagedMedia) 1.3+ 、 [**Opera** 9.2+](http://reference.sitepoint.com/css/page-break-inside) [、Konquerer](http://en.wikipedia.org/wiki/Comparison_of_layout_engines_(CSS)#Properties)和[IE8](http://developer.apple.com/documentation/AppleApplications/Reference/SafariCSSRef/Articles/StandardCSSProperties.html#//apple_ref/doc/uid/TP30001266-PagedMedia)都[**支持**](http://msdn.microsoft.com/en-us/library/cc304067(VS.85).aspx) 它，至少在某种程度上是这样。

[Firefox](http://en.wikipedia.org/wiki/Comparison_of_layout_engines_(CSS)#Properties)显然仍然没有。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-30T09:28:28.263

*   自 2010 年 11 月 30 日起， Firefox[不支持此功能](https://developer.mozilla.org/en/CSS/page-break-inside)，因此在 Firefox 4 中也不支持。
*   IE8[确实支持 page-break-inside: Avoid](http://msdn.microsoft.com/en-us/library/cc304067.aspx) - 但是当我在 IE9 上尝试此操作时，它在避免分页符方面并不是很成功（这可能是一种回归，或者 IE8 也只能在非常简单的情况下避免分页符）。
*   AFAIK 它不适用于任何 webkit 浏览器；当然不是铬。
*   它实际上可以在 Opera 中运行，甚至在真实站点上也是如此。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-28T13:45:36.270

[作为Eamon Nerbonne 关于 IE 渲染 (IE8+) 的回答](https://stackoverflow.com/questions/117772/which-browsers-support-page-break-manipulation-using-css-and-the-page-break-insid/4312187#4312187)的更多信息，您需要确保浏览器处于标准模式。[MSDN 上的这篇文章](http://msdn.microsoft.com/en-us/library/dd433064.aspx)显示了必要的内容 - 在您的 html 中包含一个元标记来强制解决问题：

```
<meta http-equiv="X-UA-Compatible" content="IE=8" /> 
```

感觉很笨拙，但你有它......似乎更一致地工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T22:00:22.503

[Safari 1.3 及更高版本](http://developer.apple.com/documentation/AppleApplications/Reference/SafariCSSRef/Articles/StandardCSSProperties.html#//apple_ref/doc/uid/TP30001266-PagedMedia)支持`page-break-inside`。

[Konqueror 也是如此](http://bugs.kde.org/68930)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T21:52:41.490

> 我正在尝试使用 page-break-inside CSS 指令，其类将附加到 div 标签或 table 标签（我认为这可能只适用于块元素，在这种情况下它必须是桌子）。

首先，无需猜测。只要看一下[规范](http://www.w3.org/TR/CSS21/page.html#propdef-page-break-inside)，你就会发现它确实只适用于块级元素。

其次，`<div>`元素通常是块级元素，因此应用于元素是没有问题`page-break-inside`的`<div>`。

最后，您不需要将其包装在`@media`. 仅`@media`当您只想将独立于媒体的规则应用于一种媒体时才需要，例如，如果您只想`display: block`对一种媒体使用。在这种情况下，您不需要对其他媒体隐藏这些规则，因为它们无论如何都只适用于分页媒体。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-27T03:55:25.463

从初步搜索中，很难找到浏览器对此支持的最新统计数据，但似乎 Firefox 4beta6 支持它而 Chrome 7 不支持。Chrome 还会在一行文本的中途分页，使部分文本出现在一个页面上，而部分文本出现在下一个页面上。一反常态地缺乏对细节的关注，但我猜谷歌和苹果都不关心打印的东西。

Firefox 4 还为您的打印添加了一些漂亮的页眉和页脚，包括 url、页面标题、站点标题、页数和时间。好的。

# database - 解密数据库模式

> ID：117774
> 
> 赞同：9
> 
> 时间：2008-09-22T21:32:03.710
> 
> 标签：database, database-design, diagram

我最近继承了维护数据库的工作，该数据库设计得不是很好，而且设计人员无法提出任何问题。在不久的将来，我还有更多的机会。

在没有任何视觉帮助或数据库图表的情况下试图找出表之间的关系是很困难的。

我想知道为此推荐什么工具。我知道 Visio，但我希望那里有一些好的开源/免费软件应用程序。我根本不需要它来更改数据库。只需阅读它并创建某种视觉辅助工具来帮助我了解事物的布局方式，并尝试弄清楚设计师在考虑数据应该如何关联。

* * *

附加答案数据： SchemaSpy 是我一直在寻找的那种东西，但多年来没有对命令行做过很多事情，我选择使用[SchemaSpyGUI](http://www.joachim-uhl.de/projekte/schemaspygui)。还有一些配置需要习惯，因为我不经常使用 Java，但最终结果是我正在寻找的（关于 Visio 的 ER 图的开源替换）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-22T22:03:00.843

试试[SchemaSpy](http://schemaspy.sourceforge.net/ "模式间谍")。我在一个相当复杂的数据库上运行它，我对结果非常满意，并提供了优化建议。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T21:48:21.173

试试 DBVis - 在[http://www.minq.se/products/dbvis/](http://www.minq.se/products/dbvis/)下载- 有一个专业版（不需要）和一个应该足够的开放版。

您所要做的就是获得正确的 JDBC - 数据库驱动程序，该工具只需按一个按钮即可显示表和引用正交、分层、循环；-) 等。享受！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T21:33:36.200

您使用的是什么 DBMS（数据库管理系统）？许多现代 DBMS，如 SQL server 和 Access 都可以为您创建 ER 图。

Microsoft Visio 是一款出色的工具，可以从任何数据源对 SQL 进行逆向工程。

[DDT（数据库设计工具）](http://www.myopensource.org/development/database+design+tool/download-review)可以在 windows 上从原始 SQL 进行逆向工程，并且非常轻量级（非常小的免费下载）。

MySQL Workbench 是比较流行的 MySQL 工具之一，并且有一个可免费下载的版本。

SQLFairy 可以为 Linux 上的 MySQL 做同样的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T21:39:26.250

那里有一些开源软件，但 Visio Professional 用于逆向工程数据库架构的工具非常好，因为它将逆向工程和图表的过程分离。我经常使用它，因为它在大多数网站上都很容易获得。

visio 的一个不错的功能是您可以进行逆向工程，然后从逆向工程架构构建您自己的图表。这样做是探索模式和理解模式的一种非常好的方式，因为您将这项工作作为交互式构建模式参考文档的一部分。我已经使用这种技术对从[基于活动的成本计算系统](http://www.powerhealthsolutions.com/products/PPM/CostManager/)到[保险承保系统](http://www.roomsolutions.net/insurance-software/policy-administrator-system/subscribe.aspx)的所有内容进行了逆向工程，通常无需供应商提供太多帮助。修补 Visio 图表非常轻松。

在此和关于 FK 关系的小假设测试之间（如果 FK 实际不在表上），您可以理解相当复杂的模式。我发现这种图表方法使 Visio 成为头肩型领导者，因为您可以以一种相当方便的方式轻松地与逆向工程模型进行交互。您可以填写缺少的外键，构建主题区域图并在图上添加注释。这个过程的交互性使它成为一个很好的学习工具。

这是一个有点主观的观点，但交互性对我来说作为一种学习过程非常有效，这是迄今为止我更喜欢的方法。大多数网站不会吝啬你 300 英镑左右的许可证——如果他们还没有许可证的话。我曾经工作过的唯一一个他们必须进入的网站是因为他们使用的是 Visio Standard 而不是 Pro。我问得很好，PHB 签字了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T22:09:00.033

[dbdesc](http://www.dbdesc.com/)不是免费的，但我听说过关于它的好消息。它适用于那里的几个主要数据库。

我很幸运，因为我还没有破译其他人的数据库模式。我使用了[CodeSmith](http://www.codesmithtools.com/)附带的一组模板。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T08:41:59.230

首先，我可以说我感受到了你的痛苦！
以下是我的一些建议：

1.  一般来说，只有当设计者正确定义了所有的主键和外键时，一个工具才会有帮助，所以请注意，一个工具可能无法获取所有重要的关系。
2.  最有用的是查看客户端代码正在执行哪些查询。这不仅会告诉您存在哪些关系，而且会告诉您哪些表和关系是最常用的——这就是您要集中精力的地方。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T21:37:17.003

我为 mysql 数据库使用 mysql 工作台（[http://www.mysql.com/products/workbench/ ）。](http://www.mysql.com/products/workbench/)您可以将工作台附加到您的数据库，它会为您绘制 ER 图。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T21:37:47.407

使用 pgsql/win32 我发现最简单的解决方案是编写一个使用 CPAN 中的 Graph::Easy 的 perl 脚本。查询数据库的外键关系，以表为节点，外键关系为链接的有向图。如果这是您的设置，我可以发布代码。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-22T21:39:33.940

我喜欢尝试看看使用数据库的应用程序是否有方法记录他们使用的 SQL（或数据库后端本身，但这往往不太容易处理）。了解对数据库执行的请求有助于您专注于重要的表。

与大多数事情一样，80/20 规则在这里适用：20% 的表格将完成 80% 的有趣事情。一旦你弄清楚了它们，图表就很少需要了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T22:57:36.047

查看已经设置好的主键外键关系hsips作为起点。

由于没有现有图表的数据库，可能没有正式建立关系，我查看表结构和名称，并最好猜测什么可能与什么相关，然后深入研究结构，看看是否有明显的（但未定义）外键。我查看存储的过程以了解表是如何连接的以及正在查询哪些字段。

虽然找出数据库的自动化工具可能很漂亮，但我发现当我自己真正深入研究数据库的细节时，我最终会得到比从任何自动创建的图片中获得的更好的理解。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T18:31:49.757

[我在使用Aqua Data Studio](http://www.aquafold.com/)对数据库模式进行逆向工程方面有一些非常好的经验。它的功能非常丰富，并且支持更多奇特的数据库，例如 Informix 或 Sybase。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-12-06T19:51:05.280

这有助于我在 MS SQL Server 2012 上生成 ER 图：

MS SQL Server management Studio > File menu > "Connect Object Explorer" 选择您的数据库节点并展开它。在此节点下，您将找到一个名为“Database Diagrams”的子节点，右键单击“Database Diagrams”>“New Database Diagram”> 添加您希望查看其列、关系、...

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-13T19:47:31.887

使用 Visio。如果使用 Vision 2010，您将需要使用用于 SQL Server 的通用 OLEDB 提供程序，以确保连接到 Visio 驱动程序时不会出现问题。

# sql - 将现有数据库加载到 WWW SQL Designer 中？

> ID：117776
> 
> 赞同：3
> 
> 时间：2008-09-22T21:32:25.347
> 
> 标签：sql, mysql, diagram

我曾多次使用[WWW SQL Designer为应用程序设计数据库。](http://ondras.zarovi.cz/sql/)我现在负责处理具有大量表（100 多个 mysql 表）的应用程序，我希望能够以类似于 WWW SQL Designer 提供的方式查看表之间的关系。似乎它附带了连接到数据库并提供其结构图的规定，但我还不能确切地弄清楚如何做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-08-03T17:35:14.877

我知道这确实是老东西，但我找到了解决方案（如果人们正在寻找它）：您必须编辑文件*backend/php-mysql/index.php*并填写连接设置。然后，您只需单击**Import From DB**，然后使用您的数据库名称**加载**。

```
function setup_import() {
    define("SERVER","localhost");
    define("USER","");
    define("PASSWORD","");
    define("DB","information_schema");
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T09:51:35.617

您可以只导出构建现有表的 sql 查询，然后在 WWW SQL Designer 中运行吗？大多数数据库管理软件都有这个选项......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T03:41:57.590

看看设计器的界面，我想当你在自己的 PHP/MySQL 服务器上运行它时，你应该能够在保存/加载对话框中使用“从数据库导入”按钮导入现有数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-24T13:48:34.037

[http://code.google.com/p/database-diagram/](http://code.google.com/p/database-diagram/)

这需要一个 SQL 结构（SQL 转储）并显示一个图表 :)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T09:40:37.677

您可以使用 VISIO 导入数据库，它会为您绘制图表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T11:00:31.663

顺便说一句，你试过[SchemaBank](http://schemabank.com)吗？它们是基于 Web 的，并且很好地支持 MySQL。它吃掉你的 sql 转储并为你生成表和关系。

# c++ - 存储此指针以在 WndProc 中使用的最佳方法

> ID：117792
> 
> 赞同：33
> 
> 时间：2008-09-22T21:34:50.020
> 
> 标签：c++, windows, winapi, oop, wndproc

我很想知道存储`this`指针以供在`WndProc`. 我知道几种方法，但据我所知，每种方法都有自己的缺点。我的问题是：

产生这种代码有哪些不同的方法：

```
CWindow::WndProc(UINT msg, WPARAM wParam, LPARAM)
{
  this->DoSomething();
} 
```

我可以想到 Thunks、HashMaps、Thread Local Storage 和 Window User Data 结构。

这些方法的优缺点是什么？

代码示例和建议获得的积分。

这纯粹是出于好奇。使用 MFC 后，我一直想知道它是如何工作的，然后开始考虑 ATL 等。

**编辑：**我可以`HWND`在窗口过程中有效使用的最早位置是什么？它被记录为`WM_NCCREATE`- 但如果您实际进行实验，那*不是*发送到窗口的第一条消息。

**编辑：** ATL 使用 thunk 来访问 this 指针。MFC 使用`HWND`s 的哈希表查找。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T21:52:02.087

在您的构造函数中，使用“this”作为 lpParam 参数调用**CreateWindowEx 。**

然后，在 WM_NCCREATE 上，调用以下代码：

```
SetWindowLongPtr(hwnd, GWLP_USERDATA, (LONG_PTR) ((CREATESTRUCT*)lParam)->lpCreateParams);
SetWindowPos(hwnd, 0, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOZORDER); 
```

然后，在窗口过程的顶部，您可以执行以下操作：

```
MyWindowClass *wndptr = (MyWindowClass*) GetWindowLongPtr(hwnd, GWL_USERDATA); 
```

它允许您这样做：

```
wndptr->DoSomething(); 
```

当然，您可以使用相同的技术来调用类似上面的函数：

```
wndptr->WndProc(msg, wparam, lparam); 
```

...然后可以按预期使用其“this”指针。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-23T00:29:07.277

虽然使用**SetWindowLongPtr**和**GetWindowLongPtr**访问**GWL_USERDATA**听起来不错，但我强烈建议**不要**使用这种方法。

这正是[Zeus](http://www.zeusedit.com/ccpp.html)编辑器使用的方法，近年来它只引起了痛苦。

我认为发生的情况是第三方 Windows 消息被发送到[Zeus](http://www.zeusedit.com/ccpp.html)也设置了**GWL_USERDATA**值。特别是一个应用程序是 Microsoft 工具，它提供了一种在任何 Windows 应用程序中输入亚洲字符的替代方法（即某种软件键盘实用程序）。

问题是[Zeus](http://www.zeusedit.com/ccpp.html)总是假设**GWL_USERDATA**数据是由它设置的，并试图将数据用作*this 指针*，这会导致崩溃。

如果我要再次使用我现在所知道的一切来做这一切，我会采用缓存哈希查找方法，其中窗口句柄用作键。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2021-01-24T22:19:26.453

这个问题在 SO 上有很多重复和几乎重复，但我所看到的几乎没有一个答案探索了他们选择的解决方案的缺陷。

将任意数据指针与窗口关联的方法有多种，有两种不同的情况需要考虑。根据情况，可能性是不同的。

情况 1 是在您创作窗口类时。这意味着您正在实现`WNDPROC`，并且您的意图是其他人在他们的应用程序中使用您的窗口类。您通常不知道谁将使用您的窗口类，以及用于什么。

情况 2 是当您使用自己的应用程序中已经存在的窗口类时。通常，您无权访问窗口类源代码，也无法对其进行修改。

我假设问题*不是*将数据指针放入`WNDPROC`最初的位置，而是如何存储它以供后续调用。

## 方法一：cbWndExtra

当 Windows 创建一个窗口的实例时，它会在内部分配一个`WND`结构。这个结构有一定的大小，包含各种与窗口相关的东西，比如它的位置、它的窗口类和它当前的 WNDPROC。在该结构的末尾，Windows 可选择分配一些属于该结构的附加字节。数字在 中指定，在`WNDCLASSEX.cbWndExtra`中使用`RegisterWindowClassEx`。

这意味着只有当您是注册窗口类的人时才能使用此方法，即您正在*编写窗口类*。

应用程序不能直接访问该`WND`结构。相反，使用`GetWindowLong[Ptr]`. 非负索引访问结构末尾额外字节内的内存。“0”将访问第一个额外的字节。

如果您正在创作窗口类，这是一种干净、快速的方法。大多数 Windows 内部控件似乎都使用这种方法。

不幸的是，这种方法在对话（`DialogBox`家庭）中表现不佳。除了提供对话框模板之外，您还有一个对话框窗口类，维护起来会变得很麻烦（除非您出于其他原因需要这样做）。如果您确实想将它与对话框一起使用，则必须在对话框模板中指定窗口类名称，确保在显示对话框之前已注册此窗口类，并且您需要为`WNDPROC`对话框实现一个（或使用`DefDlgProc`）。偏移对额外内存的所有访问`DLGWINDOWEXTRA`（包括`cbWndExtra`-- 这是因为在内部，对话框已经需要一些额外的内存才能正常运行）。另请参阅下面的对话框独有的额外方法。

## 方法二：GWLP_USERDATA

上述`WND`结构恰好包含一个指针大小的字段，系统不使用该字段。使用`GetWindowLongPtr`负索引（即`GWLP_USERDATA`）访问它。负索引将访问`WND`结构内的字段。请注意，根据[this](https://winterdom.com/dev/ui/wnd/)，负索引似乎并不代表内存偏移，而是任意的。

问题`GWLP_USERDATA`是不清楚，过去也不清楚这个字段的*确切*目的是什么，因此这个字段的所有者是谁。另请参阅[此问题](https://stackoverflow.com/questions/41521809/who-is-owner-of-gwlp-userdata-cell)。*普遍的共识是没有共识。*这很可能`GWLP_USERDATA`是由窗口的*用户使用的*，而不是*窗口类的作者*。这意味着在 WNDPROC 内部使用它是完全错误的，因为 WNDPROC 总是由窗口类作者提供。

我知道的所有标准窗口控件（例如`BUTTON`，`EDIT`等）都遵守这一点并且不在`GWLP_USERDATA`内部使用，将其留给*使用*这些控件的窗口。问题是有太多的例子，包括在 MSDN 和 SO 上，它们打破了这个规则并`GWLP_USERDATA`用于窗口类的实现。这有效地消除了控制*用户*将上下文指针与其关联的最干净和最简单的方法，仅仅是因为太多人在做“错误”。在最坏的情况下，用户代码不知道它`GWLP_USERDATA`已被占用，并且可能会覆盖它，这可能会使应用程序崩溃。

由于长期存在关于 所有权的争议`GWLP_USERDATA`，使用它通常并不安全。如果您正在*创作*一个窗口类，那么您可能永远都不应该使用它。如果你正在*使用*一个窗口，你应该只在你确定它没有被窗口类使用时才这样做。

## 方法三：SetProp

`SetProp`函数族实现对属性表的访问。每个窗口都有自己独立的属性。该表的键是 API 表面级别的字符串，但在内部它实际上是一个 ATOM。

`SetProp`可以由窗口类*作者*和窗口*用户使用*，它也有问题，但它们与`GWLP_USERDATA`. 您必须确保用作属性键的字符串不会发生冲突。winodw 用户可能不一定知道窗口类作者在内部使用的字符串。即使不太可能发生冲突，您也可以通过使用 GUID 作为字符串来完全避免它们，例如。从全局 ATOM 表的内容可以看出，许多程序都以这种方式使用 GUID。

`SetProp`必须小心使用。大多数资源都没有解释这个函数的缺陷。在内部，它使用`GlobalAddAtom`. 这有几个含义，在使用此功能时需要考虑：

*   `ATOM`您可以使用注册新字符串时获得的 来代替字符串`GlobalAddAtom`。ATOM 只是一个整数。这将提高性能；`SetProp`内部总是使用`ATOM`s 作为属性键，而不是字符串。传递一个`ATOM`跳过搜索全局原子表中的字符串。

*   全局原子表中可能的字符串原子数在系统范围内限制为 16384。使用许多不同的属性名称是一个坏主意，更不用说这些名称是在运行时动态生成的。相反，您可以使用单个属性来存储指向包含您需要的所有数据的结构的指针。

*   如果您使用的是 GUID，则可以安全地对正在使用的*每个*窗口使用相同的 GUID，即使跨不同的软件项目也是如此，因为每个窗口都有自己的属性。这样，您的所有软件最多只会用完全局原子表中的*两个*条目（您最多需要一个 GUID 作为窗口类作者，最多需要一个 GUID 作为窗口类用户）。事实上，定义两个事实上的标准 GUID 可能是有意义的，每个人都可以将其用于他们的上下文指针。

*   因为属性使用`GlobalAddAtom`，所以您必须确保原子未注册。进程存在时全局原子不会被清理，并且会阻塞全局原子表，直到操作系统重新启动。为此，您必须确保`RemoveProp`已调用它。这通常是一个好地方`WM_NCDESTROY`。

*   全局原子是引用计数的。这意味着计数器可能会在某些时候溢出。为了防止溢出，一旦原子的引用计数达到 65536，原子将永远留在原子表中，任何数量`GlobalDeleteAtom`都无法摆脱它。在这种情况下，必须重新启动操作系统以释放原子表。

如果你想使用 . 避免使用许多不同的原子名称`SetProp`。除此之外，`SetProp`/`GetProp`是一种非常干净和防御性的方法。如果开发人员同意对所有窗口使用相同的 2 个 atom 名称，则可以大大减轻 atom 泄漏的危险，但这不会发生。

## 方法四：SetWindowSubclass

`SetWindowSubclass`旨在允许覆盖`WNDPROC`特定窗口的 ，以便您可以在自己的回调中处理一些消息，并将其余消息委托给原始`WNDPROC`. 例如，这可用于侦听`EDIT`控件中的特定键组合，而将其余消息留给其原始实现。

一个方便的副作用`SetWindowSubclass`是*新*的，替换`WNDPROC`实际上不是一个`WNDPROC`，而是一个`SUBCLASSPROC`。

`SUBCLASSPROC`有 2 个附加参数，其中之一是`DWORD_PTR dwRefData`. 这是任意指针大小的数据。数据来自您，通过最后一个参数调用`SetWindowSubclass`. 然后将数据传递给替换的*每次调用*`SUBCLASSPROC`。如果*每个* `WNDPROC`人都有这个参数！

此方法仅对窗口类作者有所帮助。^((1))在窗口的初始创建期间（例如`WM_CREATE`），窗口子类化自身（例如，它可以使用`dwRefData`from `lParam`，或者如果合适的话，就在那儿分配它）。通常会进入的其余代码`WNDPROC`被移到替换处`SUBCLASSPROC`。

它甚至可以用在对话框自己的`WM_INITDIALOG`消息中。如果对话框显示为`DialogParamW`，则最后一个参数可以用作消息`dwRefData`中的`SetWindowSubclass`调用`WM_INITDIALOG`。然后，所有其余的对话逻辑都进入 new `SUBCLASSPROC`，它将`dwRefData`为每条消息接收这个。请注意，这会稍微改变语义。您现在正在编写对话框的窗口过程级别，而不是对话框过程。

在内部，使用原子名称为`SetWindowSubclass`的属性（使用） 。每个实例都使用这个名称，因此它几乎已经在任何系统的全局原子表中。它将窗口的原始文件替换为被调用的. 该函数使用属性中的数据来获取并调用所有已注册的函数。这也意味着您可能不应该将任何东西用作您自己的属性名称。`SetProp``UxSubclassInfo``SetWindowSubclass``WNDPROC``WNDPROC``MasterSubclassProc``UxSubclassInfo``dwRefData``SUBCLASSPROC``UxSubclassInfo`

## 方法 5：重击

thunk 是可以执行的动态生成的函数。它的目的是调用另一个函数，但附加的参数似乎不知从何而来。

这将让您定义一个类似于 的函数`WNDPROC`，但它有一个附加参数。此参数可以等效于“this”指针。然后，在创建窗口时，您将原始存根替换为`WNDPROC`一个 thunk，该 thunk 调用了`WNDPROC`带有附加参数的 real, pseudo-。

其工作方式是，当创建 thunk 时，它会在内存中为加载指令生成机器代码，将额外参数的值加载为*常量*，然后跳转指令到函数的地址，这通常需要附加参数。然后可以调用 thunk 本身，就好像它是常规的一样`WNDPROC`。

此方法可供窗口类作者使用，而且速度极快。但是，实施并非易事。[`AtlThunk`](https://docs.microsoft.com/en-us/windows/win32/api/atlthunk/nf-atlthunk-atlthunk_initdata)函数族实现了这一点，但有一个怪癖。它不添加*额外的*参数。相反，它用您的任意数据*替换*`HWND`参数。`WNDPROC`但是，这不是一个大问题，因为您的任意数据可能包含`HWND`窗口的。

与该方法类似`SetWindowSubclass`，您将在窗口创建期间使用任意数据指针创建 thunk。`WNDPROC`然后，用thunk替换窗口。所有真正的工作都在新的、伪的`WNDPROC`中，这是 thunk 的目标。

Thunks 根本不会弄乱全局原子表，也没有字符串唯一性考虑。但是，就像在堆内存中分配的所有其他内容一样，它们必须被释放，之后可能不再调用 thunk。因为`WM_NCDESTROY`是窗口收到的最后一条消息，所以这里就是这样做的地方。否则，您必须确保`WNDPROC`在释放 thunk 时重新安装原件。

请注意，这种将“this”指针偷运到回调函数中的方法实际上在许多生态系统中无处不在，包括 C# 与本机 C 函数的互操作。

## 方法六：全局查找表

无需长篇大论。在您的应用程序中，实现一个全局表，在其中将`HWND`s 存储为键，将上下文数据存储为值。你有责任清理桌子，如果需要，让它足够快。

窗口类作者可以使用私有表来实现他们的实现，窗口用户可以使用他们自己的表来存储特定于应用程序的信息。无需担心原子或字符串的唯一性。

## 底线

*如果您是Window 类作者*，则这些方法有效：

cbWndExtra, (GWLP_USERDATA), SetProp, SetWindowSubclass, Thunk, 全局查找表。

Window Class Author 表示您正在编写`WNDPROC`函数。例如，您可能正在实现一个自定义图片框控件，它允许用户平移和缩放。您可能需要额外的数据来存储平移/缩放数据（例如，作为 2D 转换矩阵），以便您可以`WM_PAINT`正确实现代码。

建议：避免使用 GWLP_USERDATA，因为用户代码可能依赖它；如果可能，请使用 cbWndExtra。

*如果您是Window User*，则这些方法有效：

GWLP_USERDATA，SetProp，全局查找表。

窗口用户意味着您正在创建一个或多个窗口并在您自己的应用程序中使用它们。例如，您可能正在动态创建可变数量的按钮，并且每个按钮都与被单击时相关的不同数据相关联。

建议：如果它是标准的 Windows 控件，则使用 GWLP_USERDATA，或者您确定该控件不会在内部使用它。

## 使用对话框时额外提及

默认情况下，对话框使用`cbWndExtra`设置为`DLGWINDOWEXTRA`. 可以为对话框定义自己的窗口类，在其中分配，例如，`DLGWINDOWEXTRA + sizeof(void*)`然后访问`GetWindowLongPtrW(hDlg, DLGWINDOWEXTRA)`。但在这样做的同时，你会发现自己不得不回答你不喜欢的问题。例如，`WNDPROC`您使用哪种（您可以使用`DefDlgProc`），或者您使用哪种类样式（默认对话框恰好使用`CS_SAVEBITS | CS_DBLCLKS`，但祝您找到权威参考）。

在`DLGWINDOEXTRA`字节中，对话框碰巧保留了一个指针大小的字段，可以使用`GetWindowLongPtr`index访问`DWLP_USER`。这是一种额外的`GWLP_USERDATA`，并且在理论上也有同样的问题。在实践中，我只见过 this 在`DLGPROC`最终被传递给`DialogBox[Param]`. 毕竟*窗口用户*还是有`GWLP_USERDATA`. 因此，几乎在所有情况下都可以安全地使用*窗口类实现*。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-22T21:42:59.737

您应该使用`GetWindowLongPtr()`/ `SetWindowLongPtr()`（或已弃用的`GetWindowLong()`/`SetWindowLong()`）。他们速度很快，并且完全按照您的意愿行事。唯一棘手的部分是确定何时调用`SetWindowLongPtr()`- 您需要在发送第一个窗口消息时执行此操作，即`WM_NCCREATE`. 有关示例代码和更深入的讨论，
请参阅[本文。](http://www.gamedev.net/reference/articles/article1810.asp)

线程本地存储是一个坏主意，因为您可能在一个线程中运行多个窗口。

散列映射也可以，但是为每个窗口消息（并且有*很多*）计算散列函数可能会变得很昂贵。

我不确定您是如何使用 thunk 的；你是如何绕过重击的？

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-22T21:41:53.967

我已经使用 SetProp/GetProp 来存储指向带有窗口本身的数据的指针。我不确定它如何与您提到的其他项目叠加。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-09-12T10:13:21.267

您可以使用`GetWindowLongPtr`和`SetWindowLongPtr`; 用于`GWLP_USERDATA`将指针附加到窗口。但是，如果您正在编写自定义控件，我建议您使用额外的窗口字节来完成工作。在注册窗口类`WNDCLASS::cbWndExtra`时，像这样设置数据的大小，`wc.cbWndExtra = sizeof(Ctrl*);`.

您可以使用 和 参数设置为 来获取和`GetWindowLongPtr`设置值。这种方法可以保存用于其他目的。`SetWindowLongPtr``nIndex``0``GWLP_USERDATA`

和的缺点是`GetProp`，`SetProp`会有一个字符串比较来获取/设置一个属性。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T06:22:37.437

根据微软的说法，关于 SetWindowLong() / GetWindowLong() 安全性：

> 如果 hWnd 参数指定的窗口与调用线程不属于同一进程，则 SetWindowLong 函数将失败。

不幸的是，在 2004 年 10 月 12 日发布[安全更新](http://www.microsoft.com/technet/security/bulletin/ms04-032.mspx)之前，Windows[不会强制执行此规则](http://osdir.com/ml/security.vulnerabilities/2004-10/msg00009.html)，允许应用程序设置任何其他应用程序的 GWL_USERDATA。因此，在未打补丁的系统上运行的应用程序很容易受到通过调用 SetWindowLong() 的攻击。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-10-02T21:51:46.763

我建议`thread_local`在调用之前设置一个变量`CreateWindow`，然后在你的文件中读取它`WindowProc`以找出`this`变量（我假设你可以控制`WindowProc`）。

这样，您将在发送到您窗口的第一条消息上获得`this`/关联。`HWND`

使用此处建议的其他方法，您可能会错过一些消息：在`WM_CREATE`//之前`WM_NCCREATE`发送的那些`WM_GETMINMAXINFO`。

```
class Window
{
    // ...
    static thread_local Window* _windowBeingCreated;
    static thread_local std::unordered_map<HWND, Window*> _hwndMap;
    // ...
    HWND _hwnd;
    // ...
    // all error checking omitted
    // ...
    void Create (HWND parentHWnd, UINT nID, HINSTANCE hinstance)
    {
        // ...
        _windowBeingCreated = this;
        ::CreateWindow (YourWndClassName, L"", WS_CHILD | WS_VISIBLE, x, y, w, h, parentHWnd, (HMENU) nID, hinstance, NULL);
    }

    static LRESULT CALLBACK Window::WindowProcStatic (HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam)
    {
        Window* _this;
        if (_windowBeingCreated != nullptr)
        {
            _hwndMap[hwnd] = _windowBeingCreated;
            _windowBeingCreated->_hwnd = hwnd;
            _this = _windowBeingCreated;
            windowBeingCreated = NULL;
        }
        else
        {
            auto existing = _hwndMap.find (hwnd);
            _this = existing->second;
        }

        return _this->WindowProc (msg, wparam, lparam);
    }

    LRESULT Window::WindowProc (UINT msg, WPARAM wparam, LPARAM lparam)
    {
        switch (msg)
        {
            // .... 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-29T22:54:41.457

在过去，我使用了 lpParam 参数`CreateWindowEx`：

> lpParam [in，可选] 类型：LPVOID
> 
> 指向要通过 WM_CREATE 消息的 lParam 参数指向的 CREATESTRUCT 结构（lpCreateParams 成员）传递给窗口的值的指针。此消息在返回之前由该函数发送到创建的窗口。如果应用程序调用 CreateWindow 来创建 MDI 客户端窗口，lpParam 应该指向 CLIENTCREATESTRUCT 结构。如果一个 MDI 客户窗口调用 CreateWindow 来创建一个 MDI 子窗口，lpParam 应该指向一个 MDICREATESTRUCT 结构。如果不需要其他数据，lpParam 可能为 NULL。

这里的技巧是对`static` `std::map`类实例指针有一个 HWND。它可能`std::map::find`比`SetWindowLongPtr`方法更有效。不过，使用这种方法编写测试代码当然更容易。

顺便说一句，如果您使用的是 win32 对话框，那么您将需要使用该`DialogBoxParam`功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-16T07:53:47.307

为了防止 Zeus 编辑器出现问题，只需在 GetMessage 函数中指定窗口即可：

```
BOOL GetMessage(
LPMSG lpMsg,
HWND  hWnd, /*A handle to the window whose messages are to be retrieved.*/
UINT  wMsgFilterMin,
UINT  wMsgFilterMax
); 
```

**注意** 窗口必须属于当前线程。

[易于阅读的功能文档](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getmessage)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-11-18T07:03:26.947

ATL 的 thunk 是最有效的。thunk 执行一次并将 WINPROC 的回调函数替换为类自己的消息处理成员函数。后续消息通过 windows 直接调用类成员函数来传递。没有比这更快的了。

# python - 如何让 Django AutoFields 以更高的数字开始

> ID：117800
> 
> 赞同：25
> 
> 时间：2008-09-22T21:37:00.937
> 
> 标签：python, django, autofield

对于我们的 Django 应用程序，我们希望`AutoField`从 1 以外的数字开始。似乎没有明显的方法可以做到这一点。有任何想法吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-23T00:25:54.977

就像其他人所说的那样，这在数据库端比在 Django 端容易得多。

对于 Postgres，它会是[这样](http://www.postgresql.org/docs/9.1/static/sql-altersequence.html)：`ALTER SEQUENCE sequence_name RESTART WITH 12345;`查看您自己的数据库引擎的文档，了解您将如何在那里进行操作。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-06-17T15:48:47.737

对于 MySQL，我创建了一个在 syncdb 之后执行此操作的信号：

```
from django.db.models.signals import post_syncdb
from project.app import models as app_models

def auto_increment_start(sender, **kwargs):
    from django.db import connection, transaction
    cursor = connection.cursor()
    cursor = cursor.execute("""
                                ALTER table app_table AUTO_INCREMENT=2000
                            """)
    transaction.commit_unless_managed()

post_syncdb.connect(auto_increment_start, sender=app_models) 
```

在 syncdb 之后执行 alter table 语句。这将使您不必登录 mysql 并手动发布它。

编辑：我知道这是一个旧线程，但我认为它可能会对某人有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T21:44:11.793

[对源代码](http://code.djangoproject.com/browser/django/trunk/django/db/models/fields/__init__.py#L334)的快速浏览表明，似乎没有任何选择，可能是因为它并不总是加一；它选择下一个可用键：“根据可用 ID 自动递增的 IntegerField”—— [djangoproject.com](https://docs.djangoproject.com/en/dev/topics/db/models/#automatic-primary-key-fields)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-03-09T23:58:13.813

这是我所做的..

```
def update_auto_increment(value=5000, app_label="xxx_data"):
    """Update our increments"""
    from django.db import connection, transaction, router
    models = [m for m in get_models() if m._meta.app_label == app_label]
    cursor = connection.cursor()
    for model in models:
        _router = settings.DATABASES[router.db_for_write(model)]['NAME']
        alter_str = "ALTER table {}.{} AUTO_INCREMENT={}".format(
            _router, model._meta.db_table, value)
        cursor.execute(alter_str)
        transaction.commit_unless_managed() 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-04-16T03:45:40.250

我找到了一个非常简单的解决方案！AutoField 使用先前的值来确定分配的下一个值是什么。所以我发现如果我插入了一个带有我想要的起始 AutoField 值的虚拟值，那么接下来的插入将从该值开始递增。

几个步骤的简单示例：

1.) 模型.py

```
class Product(models.Model):
    id = model.AutoField(primaryKey=True) # this is a dummy PK for now
    productID = models.IntegerField(default=0)
    productName = models.TextField()
    price = models.DecimalField(max_digits=6, decimal_places=2) 
```

*   移民
*   迁移

完成后，您将需要插入初始行，其中“productID”包含您所需的 AutoField 起始值。您可以编写一个方法或从 django shell 执行此操作。

从视图来看，插入可能如下所示：views.py

```
from app.models import Product

dummy = {
   'productID': 100000,
   'productName': 'Item name',
   'price': 5.98,
}

Products.objects.create(**product) 
```

插入后，您可以对模型进行以下更改：

模型.py

```
class Product(models.Model):
    productID = models.AutoField(primary_key=True)
    productName = models.TextField()
    price = models.DecimalField(max_digits=6, decimal_places=2) 
```

所有以下插入都将获得一个“productID”，从 100000...100001...100002...开始递增

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T00:03:35.873

自动字段在一定程度上取决于所使用的数据库驱动程序。

您必须查看为特定数据库实际创建的对象以了解发生了什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-01-28T20:58:31.407

我需要做类似的事情。我避免了复杂的东西，只是创建了两个字段：

```
id_no = models.AutoField(unique=True)
my_highvalue_id = models.IntegerField(null=True) 
```

在views.py 中，我简单地在id_no 中添加了一个固定数字：

my_highvalue_id = id_no + 1200

我不确定它是否有助于解决您的问题，但我认为您可能会发现它很容易解决。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-08-02T19:22:26.513

**在模型中，您可以添加：**

```
def save(self, *args, **kwargs):
       if not User.objects.count():
          self.id = 100
       else:
          self.id = User.objects.last().id + 1
       super(User, self).save(*args, **kwargs) 
```

**This works only if the DataBase is currently empty (no objects)**, so the first item will be assigned id 100 (if no previous objects exist) and next inserts will follow the last id + 1

# asp.net - 从 ASP.NET 应用程序将文件直接上传到 Amazon S3

> ID：117810
> 
> 赞同：28
> 
> 时间：2008-09-22T21:39:17.233
> 
> 标签：asp.net

我的 ASP.NET MVC 应用程序将占用大量带宽和存储空间。如何设置 ASP.NET 上传页面，以便用户上传的文件将直接转到 Amazon S3，而不使用我的 Web 服务器的存储和带宽？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-22T21:50:18.703

2016 年 2 月更新：

AWS 开发工具包现在可以处理更多此类问题。查看[如何构建表单](http://docs.aws.amazon.com/AmazonS3/latest/dev/HTTPPOSTForms.html)，以及[如何构建签名](http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-authentication-HTTPPOST.html)。假设您在将内容发送到 S3 之前不需要自己处理内容，那么这应该可以防止您最终需要带宽。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T17:00:46.183

如果您需要上传大文件并显示进度条，您应该考虑使用[flajaxian 组件](http://www.flajaxian.com/)。

它使用 Flash 将文件直接上传到 amazon s3，从而节省您的带宽。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-02-18T10:16:08.623

通过 asp.net 将文件上传到亚马逊 S3 的最佳和最简单的方法。看看我的以下博客文章。我认为这个会有所帮助。在这里，我解释了从添加 S3 存储桶到创建 API 密钥、安装 Amazon SDK 和编写代码以上传文件。以下是使用 asp.net C# 将文件上传到 amazon S3 的示例代码。

```
using System
using System.Collections.Generic
using System.Linq
using System.Web
using Amazon
using Amazon.S3
using Amazon.S3.Transfer
/// 
/// Summary description for AmazonUploader
/// 
public class AmazonUploader
{
        public bool sendMyFileToS3(System.IO.Stream localFilePath, string bucketName, string subDirectoryInBucket, string fileNameInS3)
        {
        // input explained :
        // localFilePath = we will use a file stream , instead of path
        // bucketName : the name of the bucket in S3 ,the bucket should be already created
        // subDirectoryInBucket : if this string is not empty the file will be uploaded to
            // a subdirectory with this name
        // fileNameInS3 = the file name in the S3
    // create an instance of IAmazonS3 class ,in my case i choose RegionEndpoint.EUWest1
    // you can change that to APNortheast1 , APSoutheast1 , APSoutheast2 , CNNorth1
    // SAEast1 , USEast1 , USGovCloudWest1 , USWest1 , USWest2 . this choice will not
    // store your file in a different cloud storage but (i think) it differ in performance
    // depending on your location

        IAmazonS3 client = new AmazonS3Client("Your Access Key", "Your Secrete Key", Amazon.RegionEndpoint.USWest2);

    // create a TransferUtility instance passing it the IAmazonS3 created in the first step
    TransferUtility utility = new TransferUtility(client);
    // making a TransferUtilityUploadRequest instance
    TransferUtilityUploadRequest request = new TransferUtilityUploadRequest();

    if (subDirectoryInBucket == "" || subDirectoryInBucket == null)
    {
        request.BucketName = bucketName; //no subdirectory just bucket name
    }
    else
    {   // subdirectory and bucket name
        request.BucketName = bucketName + @"/" + subDirectoryInBucket;
    }
    request.Key = fileNameInS3 ; //file name up in S3
    //request.FilePath = localFilePath; //local file name
    request.InputStream = localFilePath;
    request.CannedACL = S3CannedACL.PublicReadWrite;
    utility.Upload(request); //commensing the transfer

    return true; //indicate that the file was sent
}
} 
```

在这里，您可以使用函数 sendMyFileToS3 将文件流上传到亚马逊 S3。有关更多详细信息，请查看以下链接中的我的博客。

[通过 asp.net 将文件上传到 Amazon S3](http://goo.gl/ySS5lQ "通过 asp.net 将文件上传到 Amazon S3")

我希望上面提到的链接会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T22:13:31.020

寻找一个 javascript 库来处理这些文件的客户端上传。我偶然发现了一个 javascript 和 php[示例](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1618) Dojo 似乎也提供客户端 s3 文件上传。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T21:59:41.567

[ThreeSharp](http://www.codeplex.com/ThreeSharp)是一个用于在 .NET 环境中促进与 Amazon S3 交互的库。

您仍然需要在您的 mvc 应用程序中托管将文件上传和发送到 s3 的逻辑，但您不需要将它们持久保存在您的服务器上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-03-31T19:34:31.167

**在 asp.net mvc 的 aws s3 存储桶中保存和获取数据：-**

**在 amazon s3 存储桶中保存纯文本数据。**

1.首先你需要在aws上创建一个桶而不是

2.您需要您的 aws 凭证，例如 a)aws 密钥 b)aws 密钥 c) 区域

// 将数据保存在 aws 的代码 // 请注意，您可能会遇到拒绝访问错误。要删除此内容，请检查 AWS 帐户并授予 //read 和 write 权限

命名空间需要从 NuGet 包中添加

```
using Amazon;
using Amazon.S3;
using Amazon.S3.Model;

 var credentials = new Amazon.Runtime.BasicAWSCredentials(awsKey, awsSecretKey);          
                try`
                {
                    AmazonS3Client client = new AmazonS3Client(credentials, RegionEndpoint.APSouth1);
                    // simple object put
                    PutObjectRequest request = new PutObjectRequest()
                    {
                        ContentBody = "put your plain text here",
                        ContentType = "text/plain",
                        BucketName = "put your bucket name here",
                        Key = "1"
                        //put unique key to uniquly idenitify your data
                        // you can pass here any data with unique id like primary key 
                        //in db
                    };              
                    PutObjectResponse response = client.PutObject(request);

                }
                catch(exception ex)
                {
                     //
                } 
```

现在转到您的 AWS 帐户并检查您可以在 AWS s3 存储桶中获取名称为“1”的数据的存储桶。注意：-如果您遇到任何其他问题，请在这里问我一个问题，我们将尝试解决它。

**从 AWS s3 存储桶获取数据：-**

```
 try
            {              
                var credentials = new Amazon.Runtime.BasicAWSCredentials(awsKey, awsSecretKey);
                AmazonS3Client client = new AmazonS3Client(credentials, RegionEndpoint.APSouth1);
                GetObjectRequest request = new GetObjectRequest()
                {
                    BucketName = bucketName,
                    Key = "1"// because we pass 1 as unique key while save 
                            //data at the s3 bucket
                };

                using (GetObjectResponse response = client.GetObject(request))
                {
                    StreamReader reader = new 
                 StreamReader(response.ResponseStream);
                    vccEncryptedData = reader.ReadToEnd();
                }
            }
            catch (AmazonS3Exception)
            {
                throw;
            } 
```

# fizzbuzz - 备用 FizzBu zz 问题

> ID：117812
> 
> 赞同：94
> 
> 时间：2008-09-22T21:39:23.957
> 
> 标签：fizzbuzz

有人有任何不是FizzBu​​zz 问题*的*FizzBu​​zz 类型的好问题吗？

我正在采访某人，而 FB 相对知名并且不那么难记住，所以我寻找想法的第一站就是我的新瘾 SO。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-09-22T21:54:42.703

我见过一小部分用于淘汰候选人的相对简单的编程问题，就像 FizzBu​​zz 一样。以下是我看到的一些问题，按难度递增的顺序排列：

1.  反转字符串
2.  反转句子（“鲍勃喜欢狗”->“狗喜欢鲍勃”）
3.  查找列表中的最小值
4.  查找列表中的最大值
5.  计算余数（给定分子和分母）
6.  从包含重复项的列表中返回不同的值（即“1 3 5 3 7 3 1 1 5”->“1 3 5 7”）
7.  返回不同的值及其计数（即上面的列表变为“1(3) 3(3) 5(2) 7(1)”）
8.  给定一串表达式（只有变量、+ 和 -）和一组变量/值对（即 a=1、b=7、c=3、d=14）返回表达式的结果（“a + b+c -d" 将是 -3)。

这些是用于 Java 的，您可以使用标准库，因此其中一些可以非常简单（如 6）。但它们像 FizzBu​​zz 一样工作。如果您对编程有所了解，您应该能够很快完成。即使您不太了解该语言，您至少应该能够给出如何做某事的想法。

使用这个测试，我以前的一位老板看到了所有事情，从快速完成所有任务的人，到可以做得最快的人，再到半小时后无法回答一个问题的人。

我还应该注意：他让人们在完成这些任务时使用他的电脑。他们被特别指示他们*可以*使用谷歌等。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-23T02:39:47.307

也许这不能直接回答您的问题，但我不确定您是否需要提出另一个问题。除了“容易记忆”之外，FizzBu​​zz 的问题也很简单“容易”，这就是重点。如果您正在采访的人属于 FizzBu​​zz “众所周知”的人群，那么他们属于 FizzBu​​zz 类型的问题不会过滤掉的人群。这并不意味着你当场雇用他们，但它确实意味着他们应该能够轻而易举地通过它并进入面试的实质。

换句话说，任何花时间阅读[Coding Horror](http://www.codinghorror.com/blog/archives/000781.html)的人都值得进一步采访。让他们很快写出解决方案，简短讨论（例如，你如何测试这个？），然后继续下一个问题。正如文章所说，“令人惊讶的是，有多少候选人无法完成最简单的编程任务。”

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-22T22:12:55.593

[来自Project Euler](http://projecteuler.net/)的任何早期的都可能是好的。

例如：

> ## [问题 25](https://projecteuler.net/problem=25)
> 
> 斐波那契数列由递归关系定义：
> 
> ```
> Fn = Fn−1 + Fn−2, where F1 = 1 and F2 = 1. 
> ```
> 
> 因此，前 12 个术语将是：
> 
> ```
> F1 = 1
> F2 = 1
> F3 = 2
> F4 = 3
> F5 = 5
> F6 = 8
> F7 = 13
> F8 = 21
> F9 = 34
> F10 = 55
> F11 = 89
> F12 = 144 
> ```
> 
> 第 12 项 F12 是第一个包含三位数字的项。
> 
> 斐波那契数列中包含 1000 位数字的第一项的索引是什么？

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-22T21:47:54.607

我发现检查一个字符串是否是回文是一个非常简单的字符串，它可以是一个不错的除草机。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2010-10-25T05:56:05.597

我想要一个不涉及模运算符的 FizzBu​​zz 问题。特别是因为我通常会采访模运算符不经常出现的 Web 开发人员。如果它不是你经常遇到的东西，它就是你需要它几次时查找的东西之一。

（当然，这是一个概念，理想情况下，你应该在某个地方的数学课程中遇到过，但这是一个不同的话题。）

所以，我想出的就是我所谓的，难以想象**的，反向三分法**。指令是：

> 编写一个程序，以*相反的顺序*打印出1 到 200 之间的每个 3 的倍数。

以正常顺序执行它很容易：将循环索引乘以 3，直到达到超过 200 的数字，然后退出。您不必担心要终止多少次迭代，您只需继续前进，直到达到第一个过高的值。

但往回走，你必须知道从哪里开始。有些人可能会直观地意识到 198 (3 * 66) 是 3 的最大倍数，因此将 66 硬编码到循环中。其他人可能会使用数学运算（整数除法或浮点除法 200 和 3 上的 floor()）来计算该数字，并在这样做时提供更通用的东西。

从本质上讲，它与 FizzBu​​zz 是同一种问题（循环遍历值并将它们打印出来，但有一点不同）。这是一个需要解决的问题，它不使用像模运算那样（相对）深奥的东西。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2010-10-30T09:41:04.457

*对于可以在 10 秒内完成的超级简单的事情*，但会删除那些实际上无法编程的人，试试这个：

> 问：告诉我（在纸上，但在白板上更好）你将如何交换两个变量的值。

这不是我的主意，而是由一个名叫 Jacob 的人在一篇关于原始 FizzBu​​zz 问题的[博客文章](http://imranontech.com/2007/01/24/using-fizzbuzz-to-find-developers-who-grok-coding/)[中发表的。](http://imranontech.com/2007/01/24/using-fizzbuzz-to-find-developers-who-grok-coding/#comment-2828)

雅各布接着说：

> 如果他们不*从*创建第三个变量开始，你几乎可以把那个人写下来。我发现仅凭这个问题我就可以将我的（诚然当时未经筛选的）申请人削减三分之一到一半。

在对原始博客文章的评论之后，还有一个更有趣的讨论，关于在不需要第三个变量（加/减、异或等）的情况下执行此变量交换的方法，当然，如果您使用的语言支持此在单个语句/操作中，它可能不是一个很好的测试。

虽然不是我的想法，但我想在这里发布这个问题，因为这是一个非常简单、简单的问题，即使是最简单的程序也可以（并且应该）在大约 10 秒内回答。它也不需要使用像模运算符这样看起来有些晦涩的运算符，很多人，本来是相当不错的程序员，根本不熟悉（我从自己的经验中知道）。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-22T21:42:04.467

斐波那契，反转字符串，计算一个字节中设置的位数是其他常见的。 [欧拉计划](http://projecteuler.net/)也有大量的增加难度的集合。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-22T21:42:26.210

要求他们编写一个应用程序来返回给定数字的因数。短时间内做起来容易，做起来难。您可以在很短的时间内了解他们的风格和思考问题的方式。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-22T21:55:27.710

> 返回字符串 Y 中第一次出现的字符串 X 的索引

实现 strstr() 需要对语言有基本的了解，同时提供巧妙优化的机会。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-22T22:02:41.983

如果是 C/C++ 面试，请确保该人知道指针。

一般 - 简单算法（[单/双]链表）。询问每种情况下添加的复杂性（开始，结束，优化......）？

（一般）如何通过 3*N/2 次比较从数组（N 大小）中找到最小值和最大值？

C/C++：如何将多个“strcat”优化为一个缓冲区？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-22T21:47:25.810

查找素数列表是一个相当常见的问题，但它仍然需要一些思考，并且人们可能会给出不同程度的答案。

您还会惊讶于有多少人难以实现 Map/Dictionary 类型的数据结构。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-22T21:48:50.563

从 C++ FAQ Lite 中查看 6.14：

[http://www.parashift.com/c++-faq-lite/big-picture.html](http://www.parashift.com/c++-faq-lite/big-picture.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T21:45:36.140

怎么样：我想使用一个整数来存储多个值。描述它是如何工作的。

如果他们对位掩码和操作一无所知，他们可能无法解决其他问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-06-09T11:42:39.240

我已经要求我的候选人创建一个程序，以他们选择的任何伪语言计算给定数字的[阶乘](http://en.wikipedia.org/wiki/Factorial)。这是一个相当容易解决的问题，它很适合自然的后续问题（经常会被问到）关于递归。

# c++ - 将 1 和 0 的字符串转换为二进制值

> ID：117844
> 
> 赞同：23
> 
> 时间：2008-09-22T21:46:19.883
> 
> 标签：c++, c, binary

我正在尝试将来自标准输入的 1 和 0 的传入字符串转换为它们各自的二进制值（其中诸如“11110111”之类的字符串将转换为 0xF7）。这似乎很简单，但我不想重新发明轮子，所以我想知道 C/C++ 标准库中是否有任何东西可以执行这样的操作？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-22T21:50:56.410

```
#include <stdio.h>
#include <stdlib.h>

int main(void) {
    char * ptr;
    long parsed = strtol("11110111", & ptr, 2);
    printf("%lX\n", parsed);
    return EXIT_SUCCESS;
} 
```

对于更大的数字，有一个`long long`版本，`strtoll`.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-22T22:28:12.920

您可以使用 std::bitset （如果在编译时知道您的位长度）
尽管使用某些程序您可以将其分解成块并组合。

```
#include <bitset>
#include <iostream>

int main()
{
    std::bitset<5>  x(std::string("01011"));

    std::cout << x << ":" << x.to_ulong() << std::endl;
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-22T21:49:49.517

您可以使用 strtol

```
char string[] = "1101110100110100100000";
char * end;
long int value = strtol (string,&end,2); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-23T06:47:43.233

您可以使用 Boost 动态位集：

```
boost::dynamic_bitset<>  x(std::string("01011"));
std::cout << x << ":" << x.to_ulong() << std::endl; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-24T06:29:34.863

```
#include <iostream>
#include <stdio.h>
#include <string>

using namespace std;

string getBinaryString(int value, unsigned int length, bool reverse) {
    string output = string(length, '0');
    if (!reverse) {
        for (unsigned int i = 0; i < length; i++) {
            if ((value & (1 << i)) != 0) {
                output[i] = '1';
            }
        }
    }
    else {
        for (unsigned int i = 0; i < length; i++) {
            if ((value & (1 << (length - i - 1))) != 0) {
                output[i] = '1';
            }
        }
    }
    return output;
}

unsigned long getInteger(const string& input, size_t lsbindex, size_t msbindex) {
    unsigned long val = 0;
    unsigned int offset = 0;
    if (lsbindex > msbindex) {
        size_t length = lsbindex - msbindex;
        for (size_t i = msbindex; i <= lsbindex; i++, offset++) {
            if (input[i] == '1') {
                val |= (1 << (length - offset));
            }
        }
    }
    else { //lsbindex < msbindex
        for (size_t i = lsbindex; i <= msbindex; i++, offset++) {
            if (input[i] == '1') {
                val |= (1 << offset);
            }
        }
    }
    return val;
}

int main() {
    int value = 23;
    cout << value << ": " << getBinaryString(value, 5, false) << endl;
    string str = "01011";
    cout << str << ": " << getInteger(str, 1, 3) << endl;
} 
```

# c# - 如何在 C# 中确定当前关注的进程名称和版本

> ID：117851
> 
> 赞同：1
> 
> 时间：2008-09-22T21:48:12.780
> 
> 标签：c#, process, pinvoke, user32

例如，如果我正在使用 Visual Studio 2008，我想要值 devenv 和 2008 或 9。

版本号很重要...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T22:20:32.063

这将是 PInvoke 城市......

您需要在 User32.dll 中调用以下 API

Win32::GetForegroundWindow() in 返回当前活动窗口的 HWND。

```
/// <summary>
/// The GetForegroundWindow function returns a handle to the foreground window.
/// </summary>
[DllImport("user32.dll")]
static extern IntPtr GetForegroundWindow(); 
```

Win32::GetWindowThreadProcessId(HWND,LPDWORD) 返回给定 HWND 的 PID

```
[DllImport("user32.dll", SetLastError=true)]
static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId); 
```

在 C# 中

Process.GetProcessByID() 获取 PID 创建 C# 进程对象

processInstance.MainModule 返回一个附加了 FileVersionInfo 的 ProcessModule。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T22:18:24.753

这个[项目](http://www.codeproject.com/KB/cs/windowhider.aspx)演示了你需要的两个函数：[EnumWindows](http://msdn.microsoft.com/en-us/library/ms633497(VS.85).aspx)和 [GetWindowtext](http://msdn.microsoft.com/en-us/library/ms633520(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T22:19:59.803

你能澄清你的问题吗？你的意思是你想要一个程序运行，它会告诉你关于活动窗口中程序的数据？或者您希望您的程序报告自己的版本？

您正在寻找以任何方式获取信息的是[System.Reflection.Assembly](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.aspx)。（请参阅链接中的代码示例。）

如何从外部程序获取程序集？那个我不确定...

# asp.net - 从 ASP.NET 应用程序将文件直接上传到 Amazon S3

> ID：117857
> 
> 赞同：0
> 
> 时间：2008-09-22T21:48:39.097
> 
> 标签：asp.net

> **可能重复：**
> [将文件从 ASP.NET 应用程序直接上传到 Amazon S3](https://stackoverflow.com/questions/117810/upload-files-directly-to-amazon-s3-from-asp-net-application)

我的 ASP.NET MVC 应用程序将占用大量带宽和存储空间。如何设置 ASP.NET 上传页面，以便用户上传的文件将直接转到 Amazon S3，而不使用我的 Web 服务器的存储和带宽？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T22:04:42.960

[您可以编写一个表单，通过 HTML POST 直接发布到 Amazon 的 S3 服务。](http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?UsingHTTPPOST.html) 假设您在将内容发送到 S3 之前不需要自己处理内容，那么这应该可以防止您最终需要带宽。

# c# - 测试你的代码的速度？

> ID：117864
> 
> 赞同：11
> 
> 时间：2008-09-22T21:50:04.897
> 
> 标签：c#, performance, profiling, timing

我是一个完全的新手，但是我正在编写一个在 C# 中处理字符串的小程序，我注意到如果我做一些不同的事情，代码执行得更快。

所以我想知道，你如何为你的代码的执行速度计时？是否有任何（免费）实用程序？您是否使用 System.Timer 以老式方式进行操作并自己进行操作？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-22T21:56:07.503

您所描述的称为性能分析。您可以使用许多程序来执行此操作，例如[Jetbrains profiler](http://www.jetbrains.com/profiler/)或[Ants profiler](http://www.red-gate.com/products/ants_profiler/index.htm)，尽管大多数程序会在测量其性能的过程中减慢您的应用程序的速度。

要手动滚动您自己的性能分析，您可以使用[System.Diagnostics.Stopwatch](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)和一个简单的 Console.WriteLine，就像您描述的那样。

还要记住，C# JIT 编译器会根据调用的类型和频率来优化代码，因此请尝试使用不同大小的循环和方法（例如递归调用）来了解最有效的方法。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T21:53:17.807

[RedGate 的 ANTS Profiler](http://www.red-gate.com/products/ants_profiler/index.htm)是一个非常好的性能分析器。[JetBrains 的 dotTrace Profiler](http://www.jetbrains.com/profiler/)也很棒。这些工具将允许您查看可以深入到每条线的性能指标。

ANTS Profiler 的屏幕截图： [ANTS http://www.red-gate.com/products/ants_profiler/images/app/timeline_calltree3.gif](http://www.red-gate.com/products/ants_profiler/images/app/timeline_calltree3.gif)

如果您想确保特定方法在单元测试期间保持在特定性能阈值内，我会使用[`Stopwatch`该类](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)在循环中多次监视方法的执行时间并计算平均值，然后[`Assert`](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.assert(VS.80).aspx)针对结果。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-22T22:01:53.823

只是提醒一下 - 确保在 Relase 中编译，而不是在 Debug 中编译！（我见过经验丰富的开发人员犯的这个错误——很容易忘记）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T16:45:22.423

您所描述的是“性能调整”。当我们谈论性能调整时，有两个角度。(a) 响应时间——执行特定请求/程序需要多长时间。(b) 吞吐量——它可以在一秒钟内执行多少个请求。当我们通常“优化”时 - 当我们消除不必要的处理时，响应时间和吞吐量都会提高。但是，如果您的代码中有等待事件（如 Thread.sleep()、I/O 等待等），您的响应时间会受到影响，但吞吐量不会受到影响。通过采用并行处理（产生多个线程），我们可以提高响应时间，但不会提高吞吐量。通常对于服务器端应用程序，响应时间和吞吐量都很重要。对于桌面应用程序（如 IDE），吞吐量并不重要，只有响应时间很重要。

您可以通过“性能测试”来衡量响应时间——您只需记下所有关键事务的响应时间。您可以通过“负载测试”来测量吞吐量 - 您需要从足够多的线程/客户端连续抽取请求，以使服务器计算机的 CPU 使用率为 80-90%。当我们提出请求时，我们需要保持不同交易之间的比率（称为交易组合） - 例如：在预订系统中，每 100 次搜索将有 10 次预订。每 10 次预订将取消一次，等等。

在确定事务需要调整响应时间（性能测试）后，您可以使用分析器来确定热点。您可以通过比较该事务的响应时间 * 分数来识别吞吐量的热点。假设在搜索、预订、取消场景中，比例为 89:10:1。响应时间为 0.1 秒、10 秒和 15 秒。搜索负载- 0.1 * .89 = 0.089 预订负载- 10 * .1 = 1 取消负载= 15 * .01= 0.15 这里调整预订将对吞吐量产生最大影响。您还可以通过重复进行线程转储（在基于 Java 的应用程序的情况下）来识别吞吐量的热点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T21:52:30.773

使用分析器。

*   蚂蚁（[http://www.red-gate.com/Products/ants_profiler/index.htm](http://www.red-gate.com/Products/ants_profiler/index.htm)）
*   dotTrace ( [http://www.jetbrains.com/profiler/](http://www.jetbrains.com/profiler/) )

如果您只需要对一种特定方法计时，则 Stopwatch 类可能是一个不错的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T21:52:48.510

我做了以下事情： 1）我使用刻度（例如在 VB.Net Now.ticks 中）来测量当前时间。我从完成的刻度值中减去起始刻度，然后除以 TimeSpan.TicksPerSecond 以获得它花费了多少秒。2) 我避免 UI 操作（如 console.writeline）。3）我在一个实质性的循环（如 100,000 次迭代）上运行代码，以尽可能地排除使用/操作系统变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T21:53:48.867

您可以使用 StopWatch 类对方法进行计时。请记住，由于必须对代码进行 jit，第一次通常很慢。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-19T22:21:34.853

有一个本机 .NET 选项（软件开发人员的团队版）可以解决一些性能分析需求。从 2005 .NET IDE 菜单中，选择工具->性能工具->性能向导...

[GSS可能是正确的，你必须有团队版]

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-02-22T16:14:17.437

这是测试代码速度的简单示例。我希望我帮助了你

```
class Program {
    static void Main(string[] args) {
        const int steps = 10000;
        Stopwatch sw = new Stopwatch();

        ArrayList list1 = new ArrayList();
        sw.Start();
        for(int i = 0; i < steps; i++) {
            list1.Add(i);
        }
        sw.Stop();
        Console.WriteLine("ArrayList:\tMilliseconds = {0},\tTicks = {1}", sw.ElapsedMilliseconds, sw.ElapsedTicks);

        MyList list2 = new MyList();
        sw.Start();
        for(int i = 0; i < steps; i++) {
            list2.Add(i);
        }
        sw.Stop();
        Console.WriteLine("MyList:  \tMilliseconds = {0},\tTicks = {1}", sw.ElapsedMilliseconds, sw.ElapsedTicks); 
```

# language-agnostic - 您将其他职业的哪些想法应用于软件开发？

> ID：117875
> 
> 赞同：4
> 
> 时间：2008-09-22T21:51:57.997
> 
> 标签：language-agnostic

软件开发社区总是对改进我们开发软件的方式的新想法持开放态度，在我看来，我们比其他工程学科或专业的创新更多。

但是，如果我们相对年轻的行业未能从成熟的专业中学习，似乎将是不幸的。软件开发之外的人们一定发现了一些我们可以从中受益的伟大想法。

您能否描述您已成功（或未成功）应用于您的软件开发的其他职业使用的任何想法、技术或流程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T22:03:39.857

精益发展是一个明显的选择，它取自[丰田](http://www.amazon.co.uk/Toyota-Way-Management-Principles-Manufacturer/dp/0071392319)的制造原则，以对抗强大的美国工业的规模经济。它非常适合敏捷软件工程框架

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T22:03:49.903

这可能有点牵强，但在打乒乓球时，我了解到，在你获得一些基本技能之后，你的大部分错误都来自于试图打得比实际更好——去打你真的没有能力做的大满贯。玩保守的游戏并让其他玩家过度发挥自己会更安全。

在编码时，我尽量不要比我聪明。（由人们运行架构设计有助于实现这一点）。实现复杂的数据结构来管理脏读和缓存过期很快就被击落了，因为该功能是针对一部分用户的，不值得内存或开发人员资源。

我相信 Fred Brooks 会称之为第二系统综合症。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-22T21:54:44.217

Eliyahu Goldratt 有一本书叫《目标》，这是一本关于优化工厂的新颖商业书籍。它对如何确定现实（或至少质疑您自己的概念）以及瓶颈问题进行了很多很好的讨论，这在整体可伸缩性问题时非常有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T22:30:13.693

我差点在中学教 ICT。我学到了很多：

*   就连老师也是学生——一直在学习。
*   最好的老师也是最好的学习者
*   无论他们的技能水平如何，您都可以从周围的人那里学到很多东西
*   准备往往是成功的关键
*   假设是所有f ** k-ups的母亲
*   技术变化太快，跟不上所有最新的发展——承认你并不知道一切。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-22T22:00:46.667

心理学就是其中之一。它不仅仅是激励你自己和你的队友，而是使用技术来了解客户真正想要什么，而不是他要求什么。可用性是软件开发的另一个重要因素，它是一个以人为本的因素。

软件可能是一种技术职业，但开发应用程序是一种人类职业。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-22T22:04:22.850

就我个人而言，我发现数学和科学背景在故障排除和调试时非常方便。使用科学的方法，对自己进行严格的学术研究，保持健康的怀疑态度，并始终回到“这个理论是否真的最好地解释了观察到的证据？”这个问题。极大地帮助追踪根本原因，而不是被错误的线索跟踪。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T22:26:42.690

老木工说“测量两次，切割一次”一直适用于我从事的开发项目。努力在第一时间把事情做好是有回报的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T22:32:51.287

作为一名顾问，我学会了微笑并向用户提供他们所要求的任何东西......

我无法在好公司中提及我模仿过这种行为的职业。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T05:05:56.910

清单！它们不仅适用于飞行员：

[清单的力量](http://www.newyorker.com/reporting/2007/12/10/071210fa_fact_gawande)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-23T13:59:07.907

虽然不完全是一个职业，但我认为我们也需要从创意类型中汲取灵感。例如，作家通常会将自己锁定一段时间以不间断地进行写作。[保罗格雷厄姆在黑客和画家](http://www.paulgraham.com/hp.html)之间建立了强烈的相似之处

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-23T04:52:32.900

KISS（**保持****简单**，**愚蠢**）原则在这里适用，就像我在机械工程研究中所做的一样**。****就编码而言，开发人员和其他人阅读**代码所花费的时间很可能比**编写**代码要多。因此，对给定问题进行尽可能简单的设计会很有帮助。这个领域的过度工程甚至会让最初的开发人员在 36 个月后摸不着头脑，说：“我到底为什么要这么做？”

 ******只是我的 0.02 美元。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-22T22:21:22.310

设计模式最初是由建筑师（即设计实际建筑物的人，而不是软件架构师）使用的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-22T22:29:01.560

有太多数不胜数，它们以各种方式相关，使问题有点修辞，因为编程本质上是逻辑和数学的混合物，旨在与任何其他领域进行交互，为现实生活中的情况提供解决方案/自动化任务。但要提供这一点，您必须实现该域逻辑的大部分，以便使某些东西有用。

所以软件开发不是目的，它可能是一个解决方案，或者每个问题的解决方案都包含来自领域本身的概念。

我不知道我的回答是否涵盖了这个问题，因为在我看来它有点太笼统了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-23T05:19:24.007

戴尔制造厂的一段视频启发了基于队列的分布式内容聚合系统的架构。队列上的消息代表工作项，工作表、任务、零件等从一个站点传递到另一个站点。

每个站点代表一个特定的工作模式，每个站点在将消息转发回路由以进行后续调度之前更新工作表。

系统在第一次发布后 7 年仍在生产中，每小时处理大约 3 万个作业。

第一次看到系统“呼吸”，真是激动人心的时刻。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-23T05:26:36.547

好奇心和毅力。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-22T22:01:32.140

任何形式的建筑活动——我总是对巨大的建筑（桥梁和建筑物）感到惊讶，而不是对伟大的软件感到惊讶。因为你总是有更多的软件测试机会（单元、压力、用户接受度和大量的质量检查），但想象一下你可以为一个伟大的结构做多少物理和数学的良好背景肯定会促进你的编程技能

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-22T22:10:17.173

在某种模糊的意义上，建筑教会我从效率的角度思考。当您在工地上收拾工作包、拖运木材、拖着电源线穿过杂乱、未完工的房间和走廊时，通常会摔断背部，将一大堆木材和胶合板变成房子时，您很快就会了解到，您的一举一动make 必须做一些有用的事情。当您身后有一个小企业主老板时尤其如此，每次您从a点走到b点而没有随身携带任何东西时，他都会大喊他是如何赔钱的。

在编程中，它通常可以相同。但是，您不是在节省背部，而是在尝试节省时间。这采用易于维护和可重用代码的形式。每次你创建一个新函数来做一些与另一个函数非常相似的事情，或者你创建一个可以很容易地从更通用的东西继承的新类时，但几乎相同，你在剥夺自己的时间和金钱，同样多就好像一个成帧者需要来回走 6 次才能完成他或（很少）她可以一次完成的事情。在这两种情况下，回报都是减少从事一项愚蠢的工作的时间，以及一个更快乐、更富有的老板。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-22T22:19:47.167

我花了 14 年时间做工业工程类型的效率研究。这教会了我如何采访人们以获取信息，尤其是在他们不合作的情况下，以及如何从采访以外的来源获取信息（在收集需求时非常有用）以及如何进行分析思考，尤其是如何真正理解来自企业的数据视角和用户视角。这在设计数据库时特别有用。当您不得不从设计不佳的数据库中提取数据时，就像我在做分析员时必须使用的一样，您会了解哪些有效，哪些无效。与普通程序员不同，我使用了数以千计不同数据库的数据。

# apache-flex - 如何从 Adob e Flex 中的 SWFLoader 组件卸载外部加载的 SWF 文件？

> ID：117900
> 
> 赞同：3
> 
> 时间：2008-09-22T21:57:27.330
> 
> 标签：apache-flex, air, adobe, swfloader

我有一个加载外部 SWF 文件并通过[SWFLoader Flex 组件](http://livedocs.adobe.com/flex/3/html/controls_15.html)在 Adob​​e Flex/Air 应用程序中播放它们的应用程序。我一直在尝试找到一种从按钮单击事件中卸载它们的方法。我在 Google 上搜索的范围很广，似乎没有人能够在没有 hack 的情况下做到这一点。我看到人们使用的代码组合是：

```
swfLoader.source = ""; // Removes the external link to the SWF.
swfLoader.load(null); // Forces the loader to try to load nothing.
// Note: At this point sound from the SWF is still playing, and
// seems to still be playing in memory.
flash.media.SoundMixer.stopAll();
// Stops the sound. This works on my development machine, but not 
// on the client's. 
```

如果 SWF 以这种方式关闭（隐藏），最终程序会崩溃。

有任何想法吗？我在各种论坛上发现了大量的帖子，人们有同样的问题。我想我会在这里得到一个错误/不完整的答案，而且我的帖子会像往常一样陷入虚无，但无论哪种方式，提前致谢！

*编辑 1*：我无法编辑实际的 SWF 电影，它们是由客户端创建的。如果我无法关闭通过 Flex 打开的任何 SWF，这不是 Flex 架构的问题吗？我唯一的选择是将 SWF 发送到 Web 浏览器吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T04:00:36.930

> ... 这不是 Flex 架构的问题吗？

是的，而且它通常也会影响 Flash。在您可以利用 FP10 (AIR 1.5) 中的[Loader.unloadAndStop()](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/flash/display/Loader.html)方法之前，您无法保证外部加载的内容不会继续消耗内存和 cpu 资源，即使您使用该`Loader.unload()`方法也是如此。（老实说，我不能 100% 确定即使这样也能保证资源的释放，但也许我是个悲观主义者。）

下一个最好的事情是让您坚持让您加载的内容的创建者遵守一组准则，包括公开诸如`dispose()`您的应用可以调用的方法之类的东西，以要求它在您之前释放尽可能多的资源`unload()`。如果这是不可能的，那么每次加载外部 swf 时，您的应用程序几乎肯定会在内存和 CPU 使用率方面膨胀。对不起。

如果它让你感觉更好，你并不孤单。;)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T07:02:36.333

这是一个问题，即创建不当的 SWF 会使您的应用程序陷入困境，正如其他人所提到的，许多与此相关的问题将在 Flash Player 10 中得到解决。但是，无论在哪个平台上，如果您加载第三方代码，您总是会遇到问题，它总是有可能包含错误、内存泄漏或彻头彻尾的恶意代码。除非您可以将内容加载到沙箱中（并且您不能在 Flash 中，至少现在还不能），否则加载不好的东西会使您的应用程序陷入困境，就这么简单。

很抱歉，除非您能保证加载内容的质量，否则您无法保证自己的应用程序的质量。Flash 开发人员因编写泄漏或无法卸载的内容而臭名昭著，因为 Flash 很容易做错事，尤其是对于时间线上的内容。加载任何您无法直接控制的 Flash 内容是非常危险的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-02-26T18:30:48.930

最好的解决方案是

```
swfLoader.autoLoad = false;
swfLoader.unloadAndStop();
swfLoader.autoLoad = true; 
```

通过这种方式，您可以停止播放器，从内存中卸载内容并避免声音继续播放.. 干杯

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T22:32:30.817

问题在于加载的 swf，它本身并没有清理音频。尝试像这样将卸载事件附加到影片剪辑上：

```
MovieClip(event.target.content).loaderInfo.addEventListener(Event.UNLOAD, unloadMovieClipHandler);
private function unloadMovieClipHandler(event:Event) : void
{
  SoundMixer.stopAll();                           
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T23:39:53.447

我通常会远离 SWFLoader 并使用 mx.modules 包中的类。

Flex 有一个支持这种行为的模块系统。您可以在这里查看： http://livedocs.adobe.com/flex/3/html/help.html?content= [modular_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=modular_3.html)。通常，动态加载和卸载 swf 组件很棘手，尤其是当这些模块修改应用程序中的任何全局状态（样式等）时。但是如果你为你的模块创建了一个接口，然后你加载/卸载的每个类都实现了这个接口并扩展了弹性模块类，你可以干净地加载和卸载它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T00:43:29.100

尝试以下操作：

```
try {
   new LocalConnection().connect('foo');
   new LocalConnection().connect('foo');
} catch (e:*) {} 
```

这将强制垃圾收集例程。如果您的 SWF 仍然连接，那么您错过了某种连接，例如音频。

有几种强制 GC 的方法，这很糟糕，因为它们会占用 CPU，但好消息是 Flash Player 10 中即将推出官方方法：

```
unloadAndStop 
```

链接：[http ://www.gskinner.com/blog/archives/2008/07/unloadandstop_i.html](http://www.gskinner.com/blog/archives/2008/07/unloadandstop_i.html)

在那之前，恐怕你将不得不像我上面展示的那样用黑客来强迫它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T01:32:28.000

您还没有显示所有代码，所以我假设您没有使用 Loader 类的 unload 方法。另外 swfLoader.load(null) 对我来说似乎是错误的，因为 load 方法需要一个 URLRequest 对象。当你想在最后清理东西时，将对象的值设置为 null 而不是调用 null 加载。您仍然听到音频的事实表明您的数据没有被卸载，或者音频文件没有驻留在被卸载的内容中。让我们来看看。

下面的例子

```
 var loader:Loader = new Loader();
var request:URLRequest = new URLRequest('test.swf');
loader.contentLoaderInfo.addEventListener(Event.COMPLETE, onSwfLoad, false, 0, true);

function onSwfLoad(e:Event):void
{
   addChild(loader);
   loader.contentLoaderInfo.addEventListener(Event.UNLOAD, onLoaderUnload, false, 0, true);

loader.contentLoaderInfo.removeEventListener(Event.COMPLETE, onSwfLoad, false);
}
function onLoaderUnload(e:Event):void
{
   trace('LOADER WAS SUCCESSFULLY UNLOADED.');
}
//Now to remove this with the click of a button, assuming the buttons name is button_mc
button_mc.addEventListener(MouseEvent.MOUSE_DOWN, onButtonDown, false, 0, true); `function onButtonDown(e:MouseEvent):void
{
   loader.unload();
   loader.contentLoaderInfo.removeEventListener(Event.UNLOAD, onLoaderUnload);
   //When you want to remove things completely from memory you simply set their value to null.
   loader = null;
   `button_mc.removeEventListener(MouseEvent.MOUSE_DOWN, onButtonDown);`
}` 

```

我确实希望这会有所帮助，如果它是多余的，我很抱歉，但是如果没有看到您的代码，我无法确切知道您是如何处理这个问题的。

# promotions - 贵公司应该如何赞助编程认证

> ID：117907
> 
> 赞同：3
> 
> 时间：2008-09-22T22:00:14.623
> 
> 标签：promotions, reward

假设贵公司愿意赞助参加编程认证考试的费用。实现这一点的最佳方法是什么？

我会说如果程序员第一次通过考试，它应该得到全额赞助。

如果程序员没有通过第一次尝试，第二次考试应该得到 50% 的赞助。如果第三次失败，程序员应全额支付（包括前 2 次考试）。

我发现很难在自愿参加考试（对于自信的程序员）和管理层制定的强制性/政策之间取得平衡。

有人愿意分享您对此的经验/建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T22:03:26.643

对于可选认证：在我们公司，您必须获得通行证才能获得任何形式的补偿。下面的任何东西，你都会得到nada。如果你前两次失败，第三次通过，你仍然支付前两次的费用……但公司会支付第三次的费用。

对于所需的认证：公司无论如何都要付费。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T22:03:11.527

无论如何赞助第一次，这包括必要的培训。

考试的成败与培训相比，是次要的，很多公司也经常要求员工定期接受培训，所以一开始的成本并不高。

参加考试也是工作人员自己的事，想考就考，考不考也别着急。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T22:26:44.607

全额赞助第一次考试的培训和考试费用，并在成功通过考试或获得认证后给予小额奖金（〜考试费用）。

这样，如果这个人第一次尝试没有通过，即使他们自己掏钱，仍然有通过的动力。

# asp.net - 如何打开存储在网站上的 Office 2007 文件？

> ID：117920
> 
> 赞同：0
> 
> 时间：2008-09-22T22:03:05.630
> 
> 标签：asp.net, security, office-2007

我有一个网站，人们可以在其中上传文档，然后在方便时查看它们。我将二进制信息与 mime 类型一起存储在我的数据库中，然后将二进制内容直接流式传输到浏览器。

这适用于除 Office 2007 文件之外的所有文件类型。当我尝试查看 Office 2007 文件时，我收到一个请求凭据的弹出窗口。在我关闭对话框（通过取消）后，我得到另一个弹出窗口，如下所示：

![](https://4.bp.blogspot.com/_U0AuZcqOces/SNgVYTB4rCI/AAAAAAAAAD8/_WT8BwTZwBQ/s400/office07popup.jpg)

在关闭此对话框后（通过单击“是”），文档最终打开。是什么赋予了？浏览器真的不知道如何处理 Office 2007 文件吗？我检查了我保存的 mime 类型，一切看起来都是正确的。关于在尝试打开文件时我可以做些什么来摆脱这些对话框的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T12:18:19.190

在 VS Office Developer 上查看[此说明。](http://blogs.msdn.com/vsofficedeveloper/pages/Excel-2007-Extension-Warning.aspx)

It gives a registry hack which your users could choose to apply to rid suppress this warning.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T15:06:28.137

您的浏览器可能没有正确处理 Content-type 和/或 Content-Disposition 标头。对于以各种方式呈现的各种文件，我已经在 ff、safari 和 IE 中看到过这种情况。

尝试通过拦截代理（如 webscarab 或 burpsuite）下载文件以查看响应标头的外观。它至少应该让您知道问题是基于浏览器还是基于服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T22:14:49.083

您是否也使用 content-disposition 来设置文件名？尝试一下可能是个好主意

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T16:35:53.290

您是否在流式文件中返回“Content-Disposition”标头？另外，请记住，Firefox 和旧版本的 IE 处理文件名标头的方式不同。

“内容处置：附件；文件名=movie.mpg”

# version-control - 如何对构建工具和库进行版本控制？

> ID：117930
> 
> 赞同：6
> 
> 时间：2008-09-22T22:05:48.963
> 
> 标签：version-control, build-process, build-automation, clearcase

在源代码控制系统本身中包含编译器、库和其他工具有哪些建议？

过去，我遇到过这样的问题：尽管我们拥有所有源代码，但构建产品的旧版本是一种急于尝试获得 Visual Studio、InstallShield 和其他工具（包括正确的补丁版本）用于构建产品。在我的下一个项目中，我想通过将这些构建工具检查到源代码控制中来避免这种情况，然后使用它们进行构建。这也将在设置新的构建机器方面简化事情——1）安装我们的源代码控制工具，2）指向正确的分支，3）构建——就是这样。

我考虑过的选项包括：

*   将安装 CD ISO 复制到源代码控制 - 虽然这提供了我们需要返回到旧版本时所需的备份，但这不是“实时”使用的好选择（每个构建都需要从安装步骤开始，这很容易将 1 小时的构建时间变成 3 小时）。
*   将软件安装到源代码控制。ClearCase 将您的分支映射到驱动器号；我们可以在这个驱动器下安装软件。这不考虑安装工具的非文件部分，如注册表设置。
*   在虚拟机中安装所有软件并设置构建过程，将虚拟机存储在源代码管理中，并弄清楚如何让虚拟机在启动时进行构建。虽然我们轻松地捕获了“构建机器”的状态，但我们得到了 VM 的开销，并且它无助于“为开发人员提供相同的工具问题”。

这似乎是配置管理的一个基本概念，但我一直无法找到任何资源来了解如何做到这一点。有什么建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T22:11:50.430

我认为VM是您最好的解决方案。我们总是使用专用的构建机器来获得一致性。在旧的 COM DLL 地狱时代，安装的非开发软件 (Office) 依赖于（COMCAT.DLL，任何人）。您的前两个选项不能解决任何共享 COM 组件的问题。如果您没有任何共享组件问题，也许它们会起作用。

开发人员没有理由不能复制同一个 VM 以便能够在干净的环境中进行调试。如果你的架构中有很多物理层，比如邮件服务器、数据库服务器等，你的问题会更复杂。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T22:16:41.433

这是非常特定于您的环境的东西。这就是为什么您不会看到处理所有情况的指南。我工作过的所有不同的商店都有不同的处理方式。我只能就我认为对我最有效的方法发表意见。

*   将在源代码控制下的新工作站上构建应用程序所需的一切。
*   让大型应用程序不受源代码控制，例如 IDE、SDK 和数据库引擎。将它们作为 ISO 文件保存在一个目录中。
*   维护一个包含源代码的文本文档，其中包含构建应用程序所需的 ISO 文件列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T22:15:06.150

我肯定会考虑围绕这个想法的法律/许可问题。根据您的工具链的各种许可证是否允许？

如果您不喜欢 VM 映像的想法，您是否考虑过重影能够构建版本的新开发机器？当然，在硬件更改时保持该重影图像运行可能比它的价值更麻烦......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T07:43:39.853

只需注意版本控制系统中库的版本控制：

*   这是一个很好的解决方案*，但*它**意味着打包**（即将该库的文件数量减少到最低限度）
*   它没有解决“配置方面”（即“我的 '3.2' 项目需要哪些特定的库集？”）。
    不要忘记集合会随着项目的每个新版本而发展。UCM 及其“复合基线”可能会给出答案的开始。

**打包**方面（最少文件数）很重要，因为：

*   您不想通过网络访问您的库（例如通过动态视图），因为编译时间比使用本地访问的库文件时要长得多。
*   您确实想在磁盘上获取这些库，这意味着快照视图，意味着下载这些文件......这就是您可能会欣赏库打包的地方：您必须下载的文件越少，您就越好;)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T22:47:26.493

跟进我自己的问题，我遇到了另一个问题的答案中引用的[这篇文章。](http://www.conifersystems.com/2008/09/15/machine-independent-builds/)虽然更多的是对这个问题的讨论而不是回答，但它确实提到了 VM 的想法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T22:09:28.907

我的组织有一个“只读”文件系统，其中所有内容都放入发行版和版本中。发布链接（本质上是符号链接）指向您的项目正在使用的版本。当一个新版本出现时，它只是添加到文件系统中，您可以将符号链接转到它。符号链接有完整的审计历史，您可以为不同的版本创建新的符号链接。

这种方法在 Linux 上效果很好，但对于倾向于使用机器本地的东西（例如注册表）来存储配置等内容的 Windows 应用程序来说效果不佳。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T22:12:46.467

您是否使用像 NAnt 这样的持续集成 (CI) 工具来进行构建？

作为 .Net 示例，您可以为每个构建指定特定的框架。

也许流行的 CI 工具可以让您避免在版本控制系统中存储多个 IDE。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-22T22:25:39.417

在许多情况下，您可以强制构建使用签入源代码控制的编译器和库，而不是依赖未来无法重复的全局机器设置。例如，使用 C# 编译器，您可以使用 /nostdlib 开关并手动 /reference 所有库以指向签入源代码控制的版本。当然，也将编译器本身检查到源代码控制中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T00:11:48.787

至于“弄清楚如何在启动时构建”：我使用由一位系统管理员和一位开发人员快速定制的构建农场系统进行了开发。构建从属向任务主管查询合适的排队构建请求。这很不错。

如果请求的工具链要求与从站上的工具链版本匹配 - 包括什么操作系统，则该请求“适合”从站，因为该产品是多平台的，并且构建可以包括自动化测试。通常这是“当前最先进的技术”，但并非必须如此。

当一个 slave 准备好构建时，它会开始轮询 taskmaster，告诉它安装了什么。它不必提前知道它预计要构建什么。它获取一个构建请求，告诉它从 SVN 中检查某些标签，然后从这些标签之一运行脚本以从那里获取它。开发人员不必知道有多少构建从属可用，它们被称为什么，或者它们是否忙，只需知道如何将请求添加到构建队列。构建队列本身是一个相当简单的 Web 应用程序。都非常模块化。

从站不必是虚拟机，但通常是。从站的数量（以及它们运行的​​物理机器）可以扩展以满足需求。奴隶显然可以随时添加到系统中，或者如果工具链崩溃，则可以使用核武器。这实际上是这个方案的重点，而不是你归档工具链状态的问题，但我认为它是适用的。

根据您需要旧工具链的频率，您可能希望构建队列能够根据需要启动 VM，否则想要重新创建旧构建的人还必须安排合适的从属设备出现。并不是说这一定很困难 - 这可能只是在他们选择的机器上启动正确的 VM 的问题。

# regex - apache mod_rewrite 一条规则，适用于任意数量的可能性

> ID：117931
> 
> 赞同：12
> 
> 时间：2008-09-22T22:06:02.253
> 
> 标签：regex, apache, mod-rewrite

我正在建立一个相当大的网站，我的 .htaccess 开始感觉有点臃肿，有没有办法替换我当前的系统 - 每个可能传递的变量数量的一个规则，一个捕获所有可以解释不同数量输入的表达式？

例如我目前有：

```
RewriteRule ^([a-z]+)/([^/]*)/([^/]*)/([^/]*)/([^/]*)/([^/]*)$ /index.php?mode=$1&id=$2&$3=$4&$5=$6
RewriteRule ^([a-z]+)/([^/]*)/([^/]*)/([^/]*)$ /index.php?mode=$1&id=$2&$3=$4
RewriteRule ^([a-z]+)/([^/]*)$ /index.php?mode=$1&id=$2
RewriteRule ^([a-z]+)$ /index.php?mode=$1 
```

第一个反向引用始终是*模式*，并且（如果有的话）第二个总是*id*，此后任何进一步的反向引用在输入名称和它的值之间交替

```
http://www.example.com/search
http://www.example.com/search/3039/sort_by/name_asc/page/23 
```

我希望能够有一个表达式来优雅地处理所有输入。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-22T22:17:16.097

喜欢 Drupal：

```
 RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ index.php?q=$1 [L,QSA] 
```

然后使用类似这样的 php 代码处理脚本中的所有内容

```
$pathmap = ();
if ($_GET["q"]){
    $path = split("/", $_GET["q"]);
    for ($i=0; $i+1<count($path); $i++){
        $pathmap[$path[$i]] = $path[$i+1];
        $i++;
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T05:48:14.517

我不知道它是否可以用单个表达式来完成，但它可以用固定数量的表达式来完成，不管查询字符串有多长。

您的 mod_rewrite 规则将被重复调用，从而为您提供有时称为 mod_rewrite 的递归。有一些技术可以避免它，但我认为你想使用它。

设置一条规则，将最后一对替换为 name=value&

继续将输入查询字符串附加到输出。每次通过时，您的查询字符串都会变长，而您的 URL 会变短。

最终，您只有一个与您的最后一条规则匹配的值。

您必须使用以下方式捕获查询字符串

```
RewriteCond %{QUERY_STRING} ^(.*)$ 
```

然后使用 %1 将其添加回输出

你最终会得到四行。

我知道您从四行开始，但是您可以根据需要匹配任意数量的参数，而无需添加第五行。

```
RewriteCond %{QUERY_STRING} ^(.*)$
RewriteRule ^(.*/)([^/]+)/([^/]+) $1?$2=$3&%1 [L]
RewriteCond %{QUERY_STRING} ^(.*)$
RewriteRule ^([^/]+)/ $1.php?%1 [L] 
```

这将重写以下内容

```
/mypage/param1/val1/param2/val2/param3/val3/...     --->
/mypage.php?param1=val1&param2=val2&param3=val3&... 
```

It stops when there is only one parameter remaining. It will take the first "parameter" and call the .php file with that name. There is no limit to the number of param/val pairs.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T22:20:15.137

我不相信他们是一种方式 - 但我会说你最好的选择是让脚本“index.php”处理一个路径，而不是做这么多的反向引用。

因此，例如，您的重写将是

```
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L] 
```

或类似的...然后这将使 $_SERVER['REQUEST_URI'] 变量包含路径信息，您可以对其进行拆分和解析。

```
$path = split('/', $_SERVER['REQUEST_URI']);
array_shift($path); // We always have a first null value
$mode = array_shift($path); 
```

这最终以包含模式的 $mode 和包含作为路径其余部分的元素数组的 $path 结束，所以

```
http://example.com/foo/bar/baz 
```

会让你留下 $mode 是 'foo' 而 $path 是一个包含 'bar' 和 'baz' 的数组

# .net - 在 C++/CLI 包装类中翻译异常的最佳实践

> ID：117940
> 
> 赞同：4
> 
> 时间：2008-09-22T22:11:29.917
> 
> 标签：.net, exception, error-handling, c++-cli

我正在为抛出异常的现有本机类编写一个 .NET 包装类。在原生 C++ 异常和托管异常之间进行转换的最佳实践是什么？在一对一的基础上捕获并重新抛出（例如 std::invalid_argument -> System.System.ArgumentException）？是否已经在某处绘制了地图？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T22:32:34.703

我所知道的没有标准映射。我过去所做的是翻译我所知道的，以及 System.Runtime.InteropServices.SEHException 的 catch 块。所有未翻译的异常都将转换为该异常。只要你有一个抛出异常的代码的调试版本，你就应该得到一个很好的堆栈跟踪。然后你可以去查看异常并编写包装器。

但是在最后一个项目中我必须这样做，我使用了一些更简单的东西，我最终为 logic_error 和 runtime_error 编写了几个 System.Exception 派生类。然后我会捕获这两个基类并使用 typeid(err) 来编写抛出的 .NET 消息。这样我就不会“丢失”从 C++ 抛出的内容，但不必映射除最重要的部分之外的所有内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T22:34:22.483

一对一的映射对我来说似乎是最明智的方法。由于特定于应用程序的异常，“通用”映射几乎是不可能的，尽管 STL 异常类有一些明显的映射。

还有一个来自非托管代码的 SEH 异常问题。根据您的情况，可能还需要捕获和包装它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T22:43:10.870

我认为这取决于包装器的设计。如果管理器包装器的接口与非托管库的接口几乎相同，则以 1:1 重新抛出异常。如果您要显着更改接口，则抛出最适合新接口的异常。无论哪种方式，请确保包装器在任何操作无法完成时抛出异常以符合 .NET 设计准则。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T22:30:15.223

你真正想做什么？

Interop 已经将本机异常转换为托管异常，包括 SEH 异常。然而，好的设计要求*所有*的异常都应该在原生 API 级别被捕获。除非有充分的理由，否则您不应该偏离这一点。我们对您的设计知之甚少。

# crc - TinyOS CC2420ReceiveP

> ID：117942
> 
> 赞同：1
> 
> 时间：2008-09-22T22:12:00.307
> 
> 标签：crc, tinyos

我想保留未通过 crc 检查的数据包。为此，我注释掉了 CC2420RecieveP readDone 函数的一部分，该函数检查接收缓冲区中 LQI 字节的 msb 位。

我认为这是有效的，

但是，一旦我在自己的接收函数中接收到数据包，我就会通过串行组件发送它（不仅仅是有效负载，我将整个接收到的无线电数据包复制到串行数据包的有效负载区域）。当我使用程序 Listen 时，似乎不存在 crc bool 值（只有 LQI 和 RSSI），即使在函数 receiveDone_task 中明确将 crc 复制到 bufPTR 中。

:(

帮助！

麦克风。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T04:30:14.640

我只复制了前 28 个字节（不是标题加上 28 字节的有效负载加上元数据）

:P

# .net - 什么会影响 Serialport.Read() 返回的值

> ID：117945
> 
> 赞同：4
> 
> 时间：2008-09-22T22:12:25.530
> 
> 标签：.net, serial-port

我使用 .Net Framework 2.0 Serialport 类在 C# 2.0 中编写了一个简单的应用程序，以通过 COM1 与控制器卡进行通信。

最近发生了一个问题，Read 方法返回的字节不正确。它返回了正确数量的字节，只有值不正确。不过，用 Delphi 编写的类似应用程序仍然返回正确的值。

我使用[Portmon](http://technet.microsoft.com/en-us/sysinternals/bb896644.aspx)记录两个应用程序的串行端口上的活动，比较了两个日志，并在其中一些（显然）较小的不同设置，我试图尽可能地模仿 Delphi 应用程序，但无济于事。

那么，什么会影响 Read 方法返回的字节值呢？

两个应用程序之间的大多数设置是相同的。

以下是 Portmon 日志中不同的行的列表：

**德尔福应用程序：**

> IOCTL_SERIAL_SET_CHAR Serial0 SUCCESS **EOF:dc** ERR:0 BRK:0 **EVT:0** XON:11 XOFF:13
> IOCTL_SERIAL_SET_HANDFLOW Serial0 SUCCESS Shake:0 Replace:0 **XonLimit:256** **XoffLimit:256** IOCTL_SERIAL_SET_TIMEOUTS Serial0 SUCCESS RI:-1 **RM:100** RC:1000 **WM :100** WC:1000 IOCTL_SERIAL_SET_WAIT_MASK Serial0 成功掩码：RXCHAR RXFLAG **TXEMPTY** CTS DSR RLSD BRK ERR RING **RX80FULL**

**C# 应用程序：**

> IOCTL_SERIAL_SET_CHAR Serial0 SUCCESS **EOF:1a** ERR:0 BRK:0 **EVT:1a** XON:11 XOFF:13 IOCTL_SERIAL_SET_HANDFLOW Serial0 SUCCESS Shake:0 Replace:0 **XonLimit:1024** **XoffLimit:1024** IOCTL_SERIAL_SET_TIMEOUTS Serial0 SUCCESS RI:-1 **RM:-1** RC:1000 **WM:0** WC:1000 IOCTL_SERIAL_SET_WAIT_MASK Serial0 SUCCESS 掩码：RXCHAR RXFLAG CTS DSR RLSD BRK ERR RING

更新：

正确返回的字节为：91、1、1、3、48、48、50、69、66、51、70、55、52、93（14 个字节）。最后一个值是一个简单的校验和。

返回的错误值为：91、241、254、252、242、146、42、201、51、70、55、52、93（13 个字节）。

如您所见，返回的第一个和最后五个字节是对应的。

ErrorReceived 事件表明发生了帧错误，这可以解释不正确的值。但问题是为什么 SerialPort 会遇到框架错误，而 Delphi 应用程序显然没有？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:44:56.407

好吧，似乎问题已经解决了（至少目前是这样）。

显然，框架错误导致返回不正确的值。我编写了一个 VB6 应用程序，使用 MSComm 控件，效果很好，并比较了 Portmon 生成的日志文件。

我发现了以下差异

VB6 应用程序：

> IOCTL_SERIAL_SET_HANDFLOW Serial0 SUCCESS **Shake:1** Replace:0 XonLimit:256 XoffLimit:256

C# 应用程序：

> IOCTL_SERIAL_SET_HANDFLOW Serial0 SUCCESS **Shake:0** Replace:0 XonLimit:1024 XoffLimit:1024

玩弄这些设置，我发现如果我设置 `_serialPort.DtrEnable = true` C# App 会生成以下日志条目：

> IOCTL_SERIAL_SET_HANDFLOW Serial0 SUCCESS **Shake:1** Replace:0 XonLimit:1024 XoffLimit:1024

这似乎可以防止框架错误，并且应用程序似乎工作正常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T22:16:33.213

您是否检查过数据位数、停止位和奇偶校验的设置？

奇偶校验位是一种错误检测机制。例如：如果您使用 7 个数据位和 1 个奇偶校验位发送，则第 8 位将用于检测位反转错误。如果接收器期望 8 个数据位且没有奇偶校验位，则结果将是乱码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T08:16:31.977

不幸的是，您没有确切提到您得到的差异类型。是偶尔出现的不同字符还是所有传入的数据都是乱码？[请注意，由于SerialPort.Encoding](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.encoding.aspx)属性的设置，系统可能会更改通过 SerialPort.Read 函数读取的字符。此设置会影响传入文本的解释，因为它是 ASCII、Unicode、UTF8 或 Windows 用于“原始字节”到“可读文本”转换的任何其他编码方案的文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T11:57:55.750

如果您正在读入一个字节数组（例如：SerialPort.Read），您应该准确地获得您在 PortMon 上看到的字节。

如果您要转换为字符（SerialPort.ReadLine 或 SerialPort.ReadChar），则数据将使用当前编码（SerialPort.Encoding 属性）进行编码，这解释了您所看到的差异。

如果您想查看与线路上的字节具有相同二进制值的字符，则可以使用 Latin-1 编码，如[本文](https://stackoverflow.com/questions/111460/net-8-bit-encoding#111549)所述。

例子：

```
SerialPort.Encoding = Encoding.GetEncoding("Latin1") 
```

# sql - Transact-SQL - 子查询还是左连接？

> ID：117952
> 
> 赞同：11
> 
> 时间：2008-09-22T22:13:27.150
> 
> 标签：sql, tsql

我有两个包含任务和注释的表，并且想要检索任务列表以及每个任务的关联注释数。这两个查询完成了这项工作：

```
选择 t.TaskId，
       (select count(n.TaskNoteId) from TaskNote n where n.TaskId = t.TaskId) 'Notes'
从任务 t

-  或者
选择 t.TaskId，
       count(n.TaskNoteId) '笔记'
从任务 t
左连接
       任务说明 n
在 t.TaskId = n.TaskId
按 t.TaskId 分组
```

它们之间有区别吗？我应该使用另一种，还是它们只是做同一工作的两种方式？谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-22T22:29:13.557

在小型数据集上，它们在性能方面被淘汰了。编入索引后，LOJ 会好一些。

我在大型数据集上发现内部联接（内部联接也可以工作。）将在一个非常大的因素上胜过子查询（对不起，没有数字）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-22T22:29:47.657

在大多数情况下，优化器会对它们一视同仁。

我更喜欢第二种，因为它的嵌套更少，这使得它更容易阅读和维护。出于同样的原因，我也开始使用 SQL Server 的公用表表达式来减少嵌套。

此外，如果将来除了 COUNT 之外还可能添加更多聚合，例如 MIN(some_scalar)、MAX()、AVG() 等，则第二种语法更加灵活。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T15:54:00.853

子查询会更慢，因为它正在为外部查询中的每一行执行。加入会更快，因为它只完成一次。我相信查询优化器不会重写这个查询计划，因为它无法识别等价。

通常，您会为这种计数进行加入和分组。如果它们必须对未参与另一个连接的表进行一些分组或更复杂的谓词，则您显示的那种相关子查询主要是令人感兴趣的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T22:46:23.063

如果您使用的是 SQL Server Management Studio，则可以将这两个版本都输入到查询编辑器中，然后右键单击并选择显示估计的执行计划。它会给你相对于批次的两个百分比的成本。如果预计它们花费相同的时间，它们都将显示为 50% - 在这种情况下，出于其他原因（更易于阅读、更易于维护、更符合您的编码标准等）选择您喜欢的任何一个。否则，您可以选择相对于批次成本百分比较低的那个。

您可以使用相同的技术来查看更改任何查询以通过比较执行相同操作的两个版本来提高性能。

当然，因为它是相对于批次的成本，这并不意味着任何一个查询都尽可能快 - 它只是告诉您它们如何相互比较，而不是一些名义上的最佳查询以获得相同的结果.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T22:23:21.247

对此没有明确的答案。您应该查看 SQL 计划。在关系代数方面，它们本质上是等价的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T18:26:06.377

我强调尽可能避免子查询。连接通常会更有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-22T22:20:33.703

您可以使用其中任何一个，它们在语义上是相同的。一般来说，经验法则是使用更容易阅读的形式，除非性能是一个问题。

如果性能是一个问题，那么尝试使用其他形式重写查询。有时优化器会为一种形式使用索引，而不是另一种。

# web-services - 基于 SOAP 或 REST 的地理定位服务？

> ID：117954
> 
> 赞同：1
> 
> 时间：2008-09-22T22:13:57.447
> 
> 标签：web-services, rest, soap, geotargetting

是否有人知道可以接受 SOAP 或 REST 请求的（最好是免费的）网络服务。

该请求将包含一个 IP 地址，并且该服务将返回该 IP 位置的近似值。

编辑：我需要解决可能的城市。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T22:17:41.213

[MaxMind](http://www.maxmind.com)做了一个相当便宜的。您将 IP 作为查询字符串参数发送，然后它会向您发送 2 个字母代码或错误代码。在转向我们自己的查找表之前，我们使用了很长一段时间，它既快速又可靠。

找到链接： http: [//www.maxmind.com/app/web_services#country](http://www.maxmind.com/app/web_services#country) - 200,000 次查找需要 20 美元，这根本不是坏的价值。

编辑：MaxMind 还提供一项针对城市的服务：http: [//www.maxmind.com/app/web_services#city](http://www.maxmind.com/app/web_services#city)。50,000 次查询的价格为 20 美元，这有点贵，但这仍然不算太糟糕。我不能保证这项服务的准确性，因为我只使用了国家解决方案，因为这就是我们所需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T01:18:53.930

它不是网络服务，但 MaxMind 还提供[了一个免费数据库](http://www.maxmind.com/app/geolitecity)供您下载。如果您需要 Web 服务，那么使用此数据库在您自己的服务器上设置一项服务将是微不足道的。如果免费的不合适，您还可以获得更准确数据库的站点许可证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T22:17:49.077

有[http://countries.nerd.dk](http://countries.nerd.dk)，它通过 IP 提供国家信息。你需要多少分辨率？

# refactoring - 如何在不失去理智的情况下在分支中重构？

> ID：117960
> 
> 赞同：5
> 
> 时间：2008-09-22T22:15:16.727
> 
> 标签：refactoring, branch

**我一直在**重构我和其他人的代码。当我在一个分支而不是 Trunk 工作时，这有时会导致一些极其痛苦的合并，尤其是如果我不定期合并回 Trunk（分支的代码会慢慢从 Trunc 移开，当人们修改 Trunk 我必须手动弄清楚如何将其应用于分支）。

我知道的解决方案是

1.  不断地合并到 Trunk 和从 Trunk 合并 - 减少痛苦的合并，但是为什么要在分支中工作呢？
2.  每当您需要重构某些东西时，切换到 Trunk，在那里进行重构并合并到您的分支 - 我觉得这不是很实用，因为每次重构切换环境的实际成本是巨大的。

你做什么工作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T22:21:17.320

大规模的重构需要在开发时间线的正确时间进行。如果您在发布时进行大量重构，您最终会伤害自己，因为您会在应该最小化更改的时候引入痛苦的合并。您的重构越具有破坏性，它就应该在开发周期的早期发生（并且应该有更特殊的过程，例如在一段时间内尽可能停止对受影响文件的编辑）。

不断合并到主干和从主干合并通常是一种很好的做法。

在那种情况下，为什么要在分支机构工作？因为您有更多的控制权（例如，您可以停止合并到主干以稳定它以供发布，而无需停止签入您的开发分支）。因为您可以围绕合并到主干或从主干合并进行高级验证，而不会对开发分支的签入速度产生太大影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T22:19:08.853

我选择 1，尽可能进行小改动并经常检查，否则合并会变得很痛苦。如果您需要同时处理其他事情，或者重构花费的时间比您最初想象的要多，拥有一个单独的分支可以使事情变得更容易。另一个好处是它使几个人更容易参与重构，并且您可以根据需要随时将内容签入分支。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T22:28:38.377

对于发布之间的时间窗口至少为 2 个月的情况，我建议采用以下策略。

当你开始接近发布时，创建一个发布分支。发布分支应该被视为*没有重构*，*我（几乎）是功能完整的*分支。正是在这一点上，您应该开始集中精力稳定*发布分支上的发布*。根据需要将发布分支中的任何缺陷修复合并回主干。同时，主干被视为*永久开放以进行重构*。此外，如果可行，请尝试在接近主要版本时减少重构，并在紧随其后的几天内加速它。

如果您遵循持续发布策略（即每 1 到 2 周发布一次），则不应在单独的分支上分离重构和编码，除非您正在进行重大的手术增强。在这种手术增强情况下（每次间隔不少于 3 个月），每当您打算执行合并时，请提前从您的日程表中删除一个版本，使用其中一个周期进行版本合并和增加测试，保持您的手指交叉然后松开。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-22T23:10:40.227

更改需要*快速*（因此您的更改不要太多）或*本地*更改（因此您只关心少数地方的更改）。

否则，合并可能与重构一样多。作为一种算法，当太多事务失败并且必须重新启动时，乐观锁定根本不起作用。

从根本上说，你不能允许一家公司的 20 名程序员每天都更改代码库中 50% 的方法的名称。就此而言，如果多人总是同时在同一个地方进行重构，那么无论如何他们只是在撤消彼此的工作。

If programmers are spending a lot of time manually supervising merges, then present to your managers an opportunity to increase productivity by changing the way tasks are defined and assigned.

Also, "refactor the whole system to use factories everywhere" is not a task. "Refactor this one interface and its implementations to use factories" is a task.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T22:23:32.353

这是一个好的分布式 VCS 擅长的地方。但我猜你已经致力于 SVN。

就个人而言，我只是做重构然后尽快合并以避免冲突地狱。这不是最有效的方法，但最不容易出错。

我曾经有一个分支休眠了大约 3 周，因为该功能被“搁置”并且无法合并。我刚刚在一个新分支中重新启动了该功能，使用旧的作为某些部分的参考。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T22:34:12.920

冒着明显的风险，我想说尽量避免完全分支。绝不能低估这导致的开销。即使你认为你不能再拖延了（在生产中发布一个系统，正在构建发布第二个，但也请求发布一个）仍然尝试找到另一种方法：你真的没有办法在没有分支的情况下隔离功能吗（例如，拆分一个“通用”项目和一些子项目）？真的没有办法整合所有代码（例如创建包含差异的策略类或创建开关以打开或关闭新功能）？

如果您绝对必须分支，我会选择选项 1。尝试合并尽可能小的更改并经常这样做。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-22T23:02:17.407

尽早提交，经常提交。

或者在这种情况下......尽早合并，经常合并。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T23:51:12.547

Continuous integration is the key... 1 small batch of changes at a time...

# sql - 什么是在 SQL 中查找具有时间间隔重叠的行的简单有效的方法？

> ID：117962
> 
> 赞同：35
> 
> 时间：2008-09-22T22:16:05.693
> 
> 标签：sql

我有两个表，都有开始时间和结束时间字段。对于第一个表中的每一行，我需要找到第二个表中时间间隔相交的所有行。

例如：

```
 <-----row 1 interval------->
<---find this--> <--and this--> <--and this--> 
```

请以 SQL`WHERE`子句的形式表达您的答案，并考虑第二个表中的结束时间可能是 的情况`NULL`。

目标平台是 SQL Server 2005，但其他平台的解决方案也可能感兴趣。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-09-22T22:20:06.357

```
SELECT * 
FROM table1,table2 
WHERE table2.start <= table1.end 
AND (table2.end IS NULL OR table2.end >= table1.start) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-05-16T09:40:52.003

> “来自其他平台的解决方案也可能令人感兴趣。”

SQL 标准定义了**[OVERLAPS](https://jakewheat.github.io/sql-overview/sql-92-grammar.html#_8_11_overlaps_predicate)**谓词：

> 指定两个事件之间重叠的测试。
> 
> ```
> <overlaps predicate> ::=
>    <row value constructor 1>  OVERLAPS <row value constructor 2> 
> ```

例子：

```
SELECT 1
WHERE ('2020-03-01'::DATE, '2020-04-15'::DATE) OVERLAPS 
      ('2020-02-01'::DATE, '2020-03-15'::DATE) 
-- 1 
```

**[db<>小提琴演示](https://dbfiddle.uk/?rdbms=postgres_12&fiddle=ef2dde20e25c2ff0c15b4df23509a650)**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T22:25:53.907

```
select * from table_1 
right join 
table_2 on 
(
table_1.start between table_2.start and table_2.[end]
or
table_1.[end] between table_2.start and table_2.[end]
or
(table_1.[end] > table_2.start and table_2.[end] is null)
) 
```

**编辑：**好的，不要寻求我的解决方案，它的表现就像狗屎。“where”解决方案的速度提高了 14 倍。哎呀...

一些统计数据：在一个数据库上运行，表 1 和 2 都有约 65000 条记录（无索引），每行的开始和结束之间的间隔为 2 天，在 SQLSMSE 中运行 2 分钟（没有耐心等待)

使用连接：2 分钟 8356 行

使用 where：2 分钟内 115436 行

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-06-26T19:49:08.520

在您从反向开始工作之前，这听起来很复杂。下面我只说明了好的案例（没有重叠）！由这两个简单条件定义，如果 condA OR condB 为 TRUE，我们没有重叠范围，因此我们将反转这些：NOT condA AND NOT CondB，在我们的例子中，我只是反转符号（> 变为 <=）

```
/*
|--------| A                             \___  CondA: b.ddStart >  a.ddEnd
            |=========| B                /      \____ CondB:  a.ddS >  b.ddE
                          |+++++++++| A         /
*/
--DROP TABLE ran
create table ran ( mem_nbr int, ID int, ddS date, ddE date)
insert ran values  
(100, 1,  '2012-1-1','2012-12-30'),    ----\ ovl
(100, 11, '2012-12-12','2012-12-24'),  ----/
(100, 2, '2012-12-31','2014-1-1'),
(100, 3, '2014-5-1','2014-12-14') ,

(220, 1, '2015-5-5','2015-12-14') ,    ---\ovl
(220, 22, '2014-4-1','2015-5-25') ,    ---/
(220, 3, '2016-6-1','2016-12-16')  

select  DISTINCT a.mem_nbr ,  a.* , '-' [ ], b.dds, b.dde, b.id 
FROM ran a
join ran b  on  a.mem_nbr = b.mem_nbr          -- match by mem#
               AND     a.ID <> b.ID            -- itself
                  AND     b.ddS <= a.ddE        -- NOT    b.ddS >  a.ddE       
                  AND     a.ddS <= b.ddE        -- NOT    a.ddS >  b.ddE 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-02-20T10:30:29.663

如果你想用 70m+ 行来分析这样一个分钟精度的重叠呢？我可以自己编写的唯一解决方案是加入的时间维度表

否则，重复处理变得令人头疼..而且处理成本是天文数字

# php - 抵御发布日流量突发的最佳实践

> ID：117966
> 
> 赞同：17
> 
> 时间：2008-09-22T22:17:01.340
> 
> 标签：php, mysql, linux, apache, lamp

我们正在为一个客户开发一个网站，该客户（一次）预计会在第一天获得相当多的流量。有新闻稿，人们在写博客等等。我有点担心我们会在第一天就摔倒在地。你会看哪些主要的事情来确保（在没有真实流量数据的情况下提前）你可以在大型发布后保持站立？

详细信息：这是一个[L/A/M/PHP](https://en.wikipedia.org/wiki/LAMP_%28software_bundle%29)堆栈，使用内部开发的 MVC 框架。这目前正在一台服务器上启动，上面有 Apache 和 MySQL，但如果需要，我们可以将其拆分。

我们已经在安装[Memcached](https://en.wikipedia.org/wiki/Memcached)并尽可能多地进行 PHP 级缓存。有些页面是查询密集型的，我们使用[Smarty](https://en.wikipedia.org/wiki/Smarty_(template_engine))作为我们的模板引擎。请记住，没有时间更改这些主要方面中的任何一个——这只是设置。我们应该注意哪些方面？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-22T22:26:30.800

先测量，再优化。你做过负载测试吗？瓶颈在哪里？

一旦你知道你的瓶颈，你就可以智能地决定你是否需要额外的数据库盒或网络盒。现在你只是在猜测。

此外，您的负载测试结果与您的预期流量相比如何？你能处理两倍于预期的流量吗？五次？您获得和发布额外硬件的难易程度/速度如何？我确信业务要求是在启动期间不会失败，因此请确保您有*大量*可用容量。当负载稳定并且你知道你需要什么时，你总是可以在之后释放它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T22:30:20.607

我至少会排除所有静态内容。在其他地方设置另一个虚拟主机并将所有图形、CSS 和 JavaScript 加载到它上面。您可以购买一些额外的周期，卸载该类型内容的服务。如果您真的很担心，您可以注册并使用内容分发服务。现在有很多类似于[Akamai](https://en.wikipedia.org/wiki/Akamai_Technologies#Content_delivery_process)并且相当便宜。

另一个想法可能是利用 Apache [mod_proxy](https://en.wikipedia.org/wiki/Mod_proxy)将生成的页面输出保持特定的时间。APC 也非常有用...您可以使用输出缓冲捕获 + 页面上相关数据的最后修改时间，并使用 APC 缓存版本。如果页面不再有效，则重新生成并再次存储在 APC 中。

祝你好运。这将是一次学习经历！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T23:54:50.963

有一个测试期，您可以在其中允许尽可能多的用户，衡量您网站的性能，并在上线之前解决错误。

您可以在私人测试版中明确控制用户数量，也可以在谷歌风格的半公开测试版中控制每个用户可以提供给朋友的推荐数量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T22:25:34.267

为了准备或处理峰值（或峰值）性能，我将首先确定您是否已准备好通过一些简单的性能测试，例如[jmeter](http://jakarta.apache.org/jmeter/)。

它很容易设置和开始，并且会为您提供早期指标，以确定您是否会处理预期的峰值负载。

但是，考虑到您的时间限制，需要采取的其他步骤是准备将吸引最高关注的静态内容版本（例如新闻稿，如果您的发布日）。还要确保您充分利用了客户端缓存（对您的服务器的请求少一个就可以使一切变得不同）。Web 已经为极高的可扩展性和有效使用而设计，在这些情况下，内容缓存是您最好的朋友。

当事情平静下来时[，在新的 Guardian 网站的设计中，](http://www.se-radio.net/podcast/2008-05/episode-95-new-guardiancouk-website-matt-wall-and-erik-doernenburg)有一个关于软件工程广播的高可扩展性的优秀播客。

祝发射顺利。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-22T22:28:08.957

我个人会做一些事情

1）放入某种负载均衡器/数据库复制系统

这意味着您可以将服务分布在多个服务器上。不能永久拥有一台以上的服务器？使用 Amazon E3 - 适合这样的事情（打开更多的服务器来处理负载）

2) 某些“高负载”限制中的代码

例如，如果您的搜索效率低下 - 当负载达到一定水平时将其关闭。“抱歉，我们正忙，请稍后再试搜索”

3) 负载测试... 使用[ApacheBench 之](http://en.wikipedia.org/wiki/ApacheBench)类的工具对您的服务器进行压力测试。

4) 就个人而言，我认为关闭“Keep-Alive”连接会更好。它可能会略微降低整体性能，但是 - 这意味着如果网站达到那个水平，而不是让网站对少数人运行良好，而其他人会超时，每个人都会得到不一致的服务

Linux Format 写了一篇关于“如何在斜线点中生存”的好文章……我过去发现它很有用。它[以 PDF 格式在线提供](http://www.linuxformat.co.uk/pdfs/download.php?PDF=LXF97.slashdot.pdf)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-02T19:52:16.080

加强您的网站以实现高流量的基本第一步。

1.  [使用https://browsermob.com/](https://browsermob.com/)之类的低成本工具对您的网站进行负载测试。至少，您应该每小时查看 100K 的独立访问者。如果您从 MSN 主页获得广告，则希望每小时能够处理 500K 的独立访问者。

2.  将所有静态图形/视频内容移动到[CDN](https://en.wikipedia.org/wiki/Content_delivery_network)。Edgecast 和亚马逊是两个很好的选择。

3.  使用[Jet Profiler](https://www.jetprofiler.com/)分析您的 MySQL 服务器以分析任何执行缓慢的查询。微小的改变可以带来巨大的好处。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T00:31:17.833

考虑使用[Varnish](http://varnish.projects.linpro.no/) - 它是一个缓存反向代理服务器（如[Squid](https://en.wikipedia.org/wiki/Squid_%28software%29)，但用途更单一）。

我已经在它背后运行了一些相当大的网站，而且它似乎工作得很好。

# .net - INFORMATION_SCHEMA 的 OleDb 等效项是什么

> ID：117974
> 
> 赞同：5
> 
> 时间：2008-09-22T22:19:19.103
> 
> 标签：.net, sql, oledb

在 SQL 中，您可以使用

从 INFORMATION_SCHEMA.TABLES 中选择 *

等以获取有关数据库结构的信息。我需要知道如何为 Access 数据库实现相同的功能。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T22:20:26.417

等效操作可以使用完成

OleDbConnection.GetOleDbSchemaTable() 方法。

有关详细信息，请参阅[http://support.microsoft.com/kb/309488](http://support.microsoft.com/kb/309488)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-12-12T04:41:00.207

在 OLEDB 中，它可以作为 DBSCHEMA_TABLES 访问。以下 C++ 代码演示了从 OLEDB 提供程序检索表信息：

```
#include <atldb.h>
...
        // Standard way of obtaining table node info.
        CAccessorRowset<CDynamicAccessor, CBulkRowset> pRS;
        pRS.SetRows(100);

        CSchemaTables<CSession>* pBogus;
        hr = session.CreateSchemaRowset(NULL, 0, NULL, IID_IRowset, 0, NULL, (IUnknown**)&pRS.m_spRowset, pBogus);
        if (FAILED(hr))
            goto lblError;

        hr = pRS.Bind();
        if (FAILED(hr))
            goto lblError;

        hr = pRS.MoveFirst();
        if (FAILED(hr))
            goto lblError;

        while (S_OK == hr)
        {
            wstring sTableSchema(pRS.GetWCharValue(L"TABLE_SCHEMA"));
            wstring sTableName(pRS.GetWCharValue(L"TABLE_NAME"));
            wstring sTableType(pRS.GetWCharValue(L"TABLE_TYPE"));
            ...

            hr = pRS.MoveNext(); 
        }
        pRS.Close(); 
```

# python - python wsgi应用程序的调试/监控中间件

> ID：117986
> 
> 赞同：0
> 
> 时间：2008-09-22T22:22:18.957
> 
> 标签：python, debugging, wsgi, middleware

我正在搜索一个 wsgi 中间件，我可以围绕一个 wsgi 应用程序进行扭曲，它可以让我监控传入和传出的 http 请求和标头字段。

类似于 Firefox 实时标头之类的东西，但用于服务器端。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T22:35:22.123

只要您只需要标题，就应该不难写自己。试试看：

```
import sys

def log_headers(app, stream=None):
    if stream is None:
        stream = sys.stdout
    def proxy(environ, start_response):
        for key, value in environ.iteritems():
            if key.startswith('HTTP_'):
                stream.write('%s: %s\n' % (key[5:].title().replace('_', '-'), value))
        return app(environ, start_response)
    return proxy 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-22T23:05:34.310

中间件

```
from wsgiref.util import request_uri
import sys

def logging_middleware(application, stream=sys.stdout):
    def _logger(environ, start_response):
        stream.write('REQUEST\n')
        stream.write('%s %s\n' %(
            environ['REQUEST_METHOD'],
            request_uri(environ),
        ))

        for name, value in environ.items():
            if name.startswith('HTTP_'):
                stream.write('    %s: %s\n' %(
                    name[5:].title().replace('_', '-'),
                    value,
                ))
        stream.flush()
        def _start_response(code, headers):
            stream.write('RESPONSE\n')
            stream.write('%s\n' % code)
            for data in headers:
                stream.write('    %s: %s\n' % data)
            stream.flush()
            start_response(code, headers)
        return application(environ, _start_response)
    return _logger 
```

考试

```
def application(environ, start_response):
    start_response('200 OK', [
        ('Content-Type', 'text/html')
    ])
    return ['Hello World']

if __name__ == '__main__':
    logger = logging_middleware(application)
    from wsgiref.simple_server import make_server
    httpd = make_server('', 1234, logger)
    httpd.serve_forever() 
```

另请参阅 Armin 编写的[werkzeug 调试器](http://werkzeug.pocoo.org/documentation/debug)，它对交互式调试很有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T01:35:12.437

如果你想要 Apache 风格的日志，试试[paste.translogger](http://svn.pythonpaste.org/Paste/trunk/paste/translogger.py)

但是对于更完整的东西，虽然不是在一个非常方便或稳定的位置（也许将它复制到你的源代码中）是[wsgifilter.proxyapp.DebugHeaders](http://svn.pythonpaste.org/Paste/WSGIFilter/trunk/wsgifilter/proxyapp.py)

并使用[WebOb](http://pythonpaste.org/webob)编写一个：

```
import webob, sys
class LogHeaders(object):
    def __init__(self, app, stream=sys.stderr):
        self.app = app
        self.stream = stream
    def __call__(self, environ, start_response):
        req = webob.Request(environ)
        resp = req.get_response(self.app)
        print >> self.stream, 'Request:\n%s\n\nResponse:\n%s\n\n\n' % (req, resp)
        return resp(environ, start_response) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-25T01:53:10.850

mod_wsgi 文档提供了各种调试技巧，它们适用于任何 WSGI 托管机制，而不仅仅是 mod_wsgi。看：

[http://code.google.com/p/modwsgi/wiki/DebuggingTechniques](http://code.google.com/p/modwsgi/wiki/DebuggingTechniques)

这包括一个捕获请求和响应的示例 WSGI 中间件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-05T06:23:26.807

我的 WebCore 项目有一些中间件，用于记录传入请求的整个 WSGI 环境（例如 Beaker 会话、标头等）、出站响应的标头以及 MongoDB 数据库的性能信息。平均开销约为 4 毫秒。

该模块已从核心包中删除，但尚未集成到它自己的包中。该答案的当前版本可在 Git 历史记录中找到：

[http://github.com/GothAlice/WebCore/blob/cd1d6dcbd081323869968c51a78eceb1a32007d8/web/extras/cprofile.py](http://github.com/GothAlice/WebCore/blob/cd1d6dcbd081323869968c51a78eceb1a32007d8/web/extras/cprofile.py)

# linux - 与自定义 Web 应用程序集成的最佳文本搜索引擎？

> ID：117987
> 
> 赞同：4
> 
> 时间：2008-09-22T22:22:24.103
> 
> 标签：linux, search, web-applications, full-text-search

我们有一个网络应用程序，允许用户上传文档、创建自己的文档等等。上传的文件存储在 Amazon S3 上，创建的信息存储在 MySQL 数据库中。我正在寻找的是某种搜索引擎，我将所有的文本文档都提供给它，每个文档都有一个唯一的 ID，它会建立一个索引或其他什么。稍后，我可以给它搜索查询，它会提取出最匹配的文档（通过他们的 ID），以及匹配的文本片段。

基本上，我们希望允许我们的用户搜索他们上传的内容的存储库，以及其他用户标记为公开的任何内容。该解决方案应该在标准 Linux 服务器上运行，理想情况下它应该是开源的，但如果价格不高，我也会考虑付费解决方案。

到目前为止，我已经找到了三个潜在的候选人：

1.  [MySQL全文搜索](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)-我读过的一些报告是它非常慢
2.  [Apache Lucene](http://lucene.apache.org/java/docs/index.html) - 不幸的是用 Java 编写的，但如果必须，我会使用它。据说很快
3.  [Sphinx](http://www.sphinxsearch.com/) - 似乎没有那么受欢迎，理想情况下，我找到的任何解决方案都会有很多社区支持。

请让我知道是否还有其他我忽略的好选择，或者您是否有上述任何方面的经验。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T16:12:50.320

看看[Solr](http://lucene.apache.org/solr/)。它基于 Lucene，因此速度非常快，而且在任何平台上都非常容易使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T16:15:17.147

[Sphinx](http://www.sphinxsearch.com/)可能值得您考虑，因为它适用于几种常见的 RDMS（尤其是 MySQL）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T15:34:12.487

还有[Xapian](http://xapian.org/)，它速度很快，而且非常可定制。

它支持自定义索引器，允许索引未存储在数据库中的数据，这可能对存储在 S3 上的文档有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T22:26:56.247

我想[谷歌](http://google.com)会有一个满足你需求的解决方案。从这里开始：[谷歌企业](http://www.google.com/enterprise/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-22T22:42:41.997

Lucene 有一个 Ruby 端口，叫做“ [Ferret](http://ferret.davebalmain.com/trac) ”。除了 Ruby API，您还可以获得名为“cFerret”的底层 c 实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T22:46:03.390

Lucene 非常好。虽然它最初是用 java 编写的，但有一个 php 实现[http://framework.zend.com/manual/en/zend.search.lucene.html](http://framework.zend.com/manual/en/zend.search.lucene.html)*******************