# StackOverflow 问答 000263000-000263999

# python - 是否可以在 Python 中更改父进程的环境？

> ID：263005
> 
> 赞同：24
> 
> 时间：2008-11-04T19:08:16.380
> 
> 标签：python, linux, environment

在 Linux 中，当我从 shell 调用 python 时，它会复制其环境，并启动 python 进程。因此，如果我执行以下操作：

```
import os
os.environ["FOO"] = "A_Value" 
```

当python进程返回时，FOO，假设它最初是未定义的，仍然是未定义的。python进程（或任何子进程）有没有办法修改其父进程的环境？

我知道你通常使用类似的东西来解决这个问题

```
source script_name.sh 
```

但这与我的其他要求相冲突。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-04T19:27:27.463

没有进程可以更改其父进程（或任何其他现有进程的环境）。

但是，您可以通过使用修改后的环境创建新的交互式 shell 来创建新环境。

您必须生成一个新的 shell 副本，该副本使用升级后的环境并可以访问现有的标准输入、标准输出和标准错误，并进行重新初始化。

你需要做一些事情，比如使用 subprocess.Popen 来运行`/bin/bash -i`。

所以原来的 shell 运行 Python，它运行一个新的 shell。是的，您有很多进程正在运行。不，这并不算太糟糕，因为原始的 shell 和 Python 并没有真正做任何事情，只是等待子 shell 完成，这样它们也可以干净地退出。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-04T19:12:44.203

任何子进程都不可能改变父进程的环境。您可以做的最好的事情是将 shell 语句输出到标准输出，然后将其写入源文件，或者将其写入您在父文件中获取的文件。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-04T19:41:03.427

我会使用 bash eval 语句，并让 python 脚本输出 shell 代码

孩子.py：

```
#!/usr/bin/env python
print 'FOO="A_Value"' 
```

父.sh

```
#!/bin/bash
eval `./child.py` 
```

# session - 您最喜欢的跨域 cookie 共享方法是什么？

> ID：263010
> 
> 赞同：44
> 
> 时间：2008-11-04T19:09:41.120
> 
> 标签：session, cookies, cross-domain, sharing

我看到 iframe/p3p 技巧是最流行的技巧，但我个人不喜欢它，因为 javascript + 隐藏字段 + 框架真的让它看起来像一个 hack 工作。我还遇到了使用 Web 服务进行通信的主从方法（[http://www.15seconds.com/issue/971108.htm](http://www.15seconds.com/issue/971108.htm)），它似乎更好，因为它对用户透明并且对不同的浏览器很健壮。

有没有更好的方法，每种方法的优缺点是什么？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-26T12:47:38.430

我的方法将一个域指定为“中心”域，将任何其他域指定为“卫星”域。

当有人单击“登录”链接（或显示持久登录 cookie）时，登录表单最终会将其数据发送到中心域上的 URL，以及一个隐藏的表单元素，说明它来自哪个域（只是为方便起见，用户随后会被重定向回来）。

然后，中心域的该页面继续设置会话 cookie（如果登录顺利）并重定向回用户登录的任何域，并在 URL 中使用专门生成的令牌，该令牌对于该会话是唯一的。

然后，卫星 URL 上的页面检查该令牌以查看它是否确实对应于为会话生成的令牌，如果是，它会在没有令牌的情况下重定向到自身，并设置本地 cookie。现在，卫星域也有一个会话 cookie。此重定向会清除 URL 中的令牌，因此用户或任何爬虫都不太可能记录包含该令牌的 URL（尽管如果他们这样做了，那也没关系，令牌可以是一次性令牌）。

现在，用户在中心域和卫星域都有一个会话 cookie。但是如果他们访问另一颗卫星呢？好吧，通常情况下，它们在卫星看来是未经身份验证的。

但是，在我的整个应用程序中，每当用户处于有效会话中时，所有指向其他卫星域上的页面的链接都会附加一个 ?s 或 &s 。我保留这个's'查询字符串的意思是“与中央服务器核对，因为我们认为这个用户有一个会话”。也就是说，在任何 HTML 页面上都不会显示令牌或会话 ID，只有无法识别某人的字母“s”。

如果还没有有效的会话，接收到这样一个 's' 查询标签的 URL 将重定向到中央域，说“你能告诉我这是谁吗？” 通过在查询字符串中放入一些东西。

当用户到达中央服务器时，如果他们在那里通过身份验证，中央服务器将简单地接收他们的会话 cookie。然后它将使用另一个一次性令牌将用户发送回卫星，卫星将像登录后的卫星一样对待它（见上文）。即，卫星现在将在该域上设置会话 cookie，并重定向到自身以从查询字符串中删除令牌。

我的解决方案无需脚本或 iframe 支持即可工作。它确实需要将“？s”添加到用户可能在该 URL 上还没有 cookie 的任何跨域 URL。我确实想到了一种解决方法：当用户第一次登录时，围绕每个域设置一个重定向链，为每个域设置一个会话 cookie。我没有实现这一点的唯一原因是它会很复杂，因为您需要能够设置这些重定向发生的顺序以及何时停止，并且会阻止您扩展到超过 15 个域左右（太多了，您将危险地接近许多浏览器和代理的“重定向限制”）。

*后续说明：这是 11 年前写的，当时网络非常不同 - 例如，XMLhttprequest 不被视为您可以依赖的东西，更不用说跨域了。*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T05:36:00.227

如果您可以完全控制所有域后端，那么这是一个很好的解决方案。在我的情况下，我只有一个客户端（javascript/html）控制，另一个完全控制，因此我需要使用 iframe/p3p 方法，这很糟糕:(。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T16:12:33.600

好的，我似乎找到了解决方案，您可以创建一个脚本标签来加载您想要设置/获取 cookie 的域的 src ... 到目前为止，只有 safari 似乎无法设置 cookie，但是 Ie6 和 FF工作正常...如果您只想获取 cookie，这是一个非常好的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-22T22:37:14.853

那篇文章中的示例对我来说似乎很可疑，因为您基本上重定向到一个 url，而该 url 又将变量在查询字符串中传递回您的域。

在示例中，这意味着恶意用户可以简单地导航到[http://slave.com/return.asp?Return=blah&UID=123](http://slave.com/return.asp?Return=blah&UID=123) " 并以用户 123 的身份登录 slave.com。

我是否遗漏了某些东西，或者众所周知，这种技术是不安全的，不应该用于该示例所暗示的事情（传递用户 ID，大概是为了使一个人的身份可移植）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-05T03:49:49.493

@thomasrutter

您可以通过调用 ajax 来检查页面加载时的“中央”域的身份验证状态，从而避免必须管理卫星上的所有出站链接（通过将“s”附加到查询字符串）。您可以通过每个会话只进行一次调用来避免冗余调用（在后续页面加载时）。

在页面加载之前进行身份验证检查请求服务器端可能会更好，这样（a）您可以更有效地访问会话，并且（b）您将在页面呈现时知道用户是否登录（并相应地显示内容）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-02T05:52:53.783

我们使用 cookie 链接，但这不是一个好的解决方案，因为当其中一个域对用户不起作用时（由于过滤/防火墙等），它会中断。较新的技术（包括您的技术）仅在分发 cookie/管理登录的“主”服务器中断时才会中断。

请注意，您的 return.asp 可能会被滥用以重定向到任何站点（例如，请参阅[this ）。](http://www.casabasecurity.com/content/open-redirects-whats-problem)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-23T15:21:17.180

您还应该针对域 b、c、d、... 验证活动会话信息，这样您只有在用户已经登录域 a 时才能登录。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2010-10-19T22:17:17.890

您所做的是在接收您检查引荐来源地址的变量的域上，以便您可以确认链接来自您自己的域，而不是简单地将链接输入地址栏中的人。这种方法效果很好。

# java - Java URLConnection ：我怎样才能找出网络文件的大小？

> ID：263013
> 
> 赞同：31
> 
> 时间：2008-11-04T19:10:18.357
> 
> 标签：java, http, http-headers

我正在为学校做一个项目，我正在实现一个可用于从网络下载文件的工具（带有节流选项）。问题是，我将有一个 GUI，我将使用一个`JProgressBar`小部件，我想显示下载的当前进度。为此，我需要知道文件的大小。在下载文件之前如何获取文件的大小。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-04T19:16:49.077

任何 HTTP 响应都*应该*包含 Content-Length 标头，因此您可以在 URLConnection 对象中查询该值。

```
//once the connection has been opened
List values = urlConnection.getHeaderFields().get("content-Length")
if (values != null && !values.isEmpty()) {

    // getHeaderFields() returns a Map with key=(String) header 
    // name, value = List of String values for that header field. 
    // just use the first value here.
    String sLength = (String) values.get(0);

    if (sLength != null) {
       //parse the length into an integer...
       ...
    } 
```

服务器可能并不总是可以返回准确的 Content-Length，因此该值可能不准确，但至少在大多数情况下您会得到*一些*可用的值。

**更新：**或者，现在我更完整地查看了 URLConnection javadoc，您可以只使用[getContentLength()](http://docs.oracle.com/javase/7/docs/api/java/net/URLConnection.html#getContentLength%28%29)方法。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-11-04T19:36:42.767

如前所述，URLConnection[`getContentLengthLong()`](https://docs.oracle.com/javase/8/docs/api/java/net/URLConnection.html#getContentLengthLong--)是您最好的选择，但它并不总是给出明确的长度。那是因为 HTTP 协议（​​以及可以用 a 表示的其他协议`URLConnection`）并不总是传达长度。

在 HTTP 的情况下，动态内容的长度通常是事先不知道的——`content-length`通常何时发送标头。相反，另一个标头`transfer-encoding`指定使用“分块”编码。使用分块编码，整个响应的长度是未指定的，并且响应被分块发送回，其中指定了每个块的大小。实际上，服务器缓冲来自 servlet 的输出。每当缓冲区填满时，就会发送另一个块。使用这种机制，HTTP 实际上可以开始流式传输无限长度的响应。

如果文件大于 2 Gb，则其大小不能表示为`int`，因此在这种情况下，较旧的方法[`getContentLength()`](https://docs.oracle.com/javase/8/docs/api/java/net/URLConnection.html#getContentLength--)将返回 -1。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2011-10-06T10:31:12.867

使用 HEAD 请求，我让我的网络服务器回复正确的内容长度字段，否则该字段为空。我不知道这是否普遍有效，但就我而言，它确实有效：

```
 private int tryGetFileSize(URL url) {
        HttpURLConnection conn = null;
        try {
            conn = (HttpURLConnection) url.openConnection();
            conn.setRequestMethod("HEAD");
            conn.getInputStream();
            return conn.getContentLength();
        } catch (IOException e) {
            return -1;
        } finally {
            conn.disconnect();
        }
    } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-04T19:26:31.243

您需要使用内容长度 (URLConnection.getContentLength())。不幸的是，这并不总是准确的，或者可能并不总是提供，因此依赖它并不总是安全的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-06-23T01:37:58.407

```
 //URLConnection connection

private int FileSize(String url) {

 // this is the method and it get the url as a parameter.

       // this java class will allow us to get the size of the file.

        URLConnection con; 

         // its in a try and catch incase the url given is wrong or invalid

        try{ 

            // we open the stream

            con = new URL(url).openConnection()

            return con.getContentLength(); 
        }catch (Exception e){

            e.printStackTrace();

            // this is returned if the connection went invalid or failed.

            return 0; 
        }
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-02T08:37:42.927

正如@erickson 所说，有时会有标题“Transfer-Encoding：chunked”，而不是“Content-Length：”，当然长度为空值。

关于 available() 方法——没有人能保证它会返回正确的值，所以我建议你不要使用它。

# linq-to-sql - 存储过程比 LINQ 查询慢？

> ID：263023
> 
> 赞同：3
> 
> 时间：2008-11-04T19:12:50.163
> 
> 标签：linq-to-sql, stored-procedures

我正在做一些测试，直接 LINQ-to-SQL 查询的运行速度至少比通过 LINQ 查询调用存储过程快 80%

在 SQL Server 探查器中，通用 LINQ 查询

```
 var results = from m in _dataContext.Members
 select m; 
```

与存储过程相比，只用了 19 毫秒

```
 var results = from m in _dataContext.GetMember(userName)
 select m; 
```

（`GetMember`作为存储过程）执行相同的查询，耗时 100 毫秒

为什么是这样？

**编辑：**

直接的 LINQ 在 Profiler 中看起来像这样

```
SELECT 
    [t1].[MemberID], [t1].[Aspnetusername], [t1].[Aspnetpassword], 
    [t1].[EmailAddr], [t1].[DateCreated], 
    [t1].[Location], [t1].[DaimokuGoal], [t1].[PreviewImageID],   
    [t1].[value] AS [LastDaimoku], 
    [t1].[value2] AS [LastNotefied], 
    [t1].[value3] AS [LastActivityDate], [t1].[IsActivated]
FROM 
    (SELECT 
         [t0].[MemberID], [t0].[Aspnetusername], [t0].[Aspnetpassword], 
         [t0].[EmailAddr], [t0].[DateCreated], [t0].[Location], 
         [t0].[DaimokuGoal], [t0].[PreviewImageID], 
         [t0].[LastDaimoku] AS [value], [t0].[LastNotefied] AS [value2], 
         [t0].[LastActivityDate] AS [value3], [t0].[IsActivated]
     FROM 
         [dbo].[Members] AS [t0]) AS [t1]
WHERE 
    [t1].[EmailAddr] = @p0 
```

存储过程是这样的

```
SELECT Members.*
FROM Members 
WHERE dbo.Members.EmailAddr = @Username 
```

因此，您会看到存储过程查询要简单得多.. 但速度较慢.. 对我来说毫无意义。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-04T19:30:20.533

1) 比较同类。在两种情况下执行完全相同的操作，而不是在一种情况下获取所有值并在另一种情况下进行查询。

2）不要只执行一次代码——多次执行，这样优化器就有机会工作并避免一次性的性能损失。

3) 使用分析器（嗯，一个在 .NET 端，一个在 SQL 端）找出性能*实际*不同的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T21:42:21.733

可能使它变慢的一件事是选择 *. 通常，如果指定了列，查询会更快，特别是如果 LINQ 查询没有使用查询中的所有可能列，它会比 select * 更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T21:43:50.200

我忘了，proc 也可能有参数嗅探问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T19:27:02.833

A 在评论中指出，其中一些是您没有将苹果与苹果进行比较。您正在尝试比较两个不同的查询，从而得到不同的结果。

如果您想尝试确定性能，您需要比较相同的查询、相同的值等。

此外，您可以尝试使用 LinqPad 来查看生成的 SQL 以潜在地识别导致响应缓慢的区域。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-14T03:29:29.003

* 将延长运行查询所需的时间。此外，您在分析器中看到的来自 LINQ 的直接 SQL 将所有对象名称括起来 ([]) - 这将减少 LINQ 查询的查询执行时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-29T21:01:35.800

我可以补充一下 John Skeet 的回答，当多次运行代码时，请记住清理任何查询缓存。

我可以建议对两个查询都使用“EXPLAIN”：似乎 MySQL 为查询和 SP 创建查询执行计划的方式不同。对于 SP，它在用它们的值替换参数之前符合要求，因此它不使用在硬编码或替换参数的情况下使用的索引。这是[关于 SP 的不同运行时间和](https://stackoverflow.com/questions/16752922/mysql-stored-procedure-is-slower-20-times-than-standart-query)来自 SO 的直接查询的另一个问题，其中为这两种情况提供了查询计划数据。

# ruby-on-rails - 使用 Capistrano 部署时将静态文件保存在服务器中

> ID：263026
> 
> 赞同：6
> 
> 时间：2008-11-04T19:13:46.120
> 
> 标签：ruby-on-rails, capistrano, release-management

我`public/files`通过 Web 界面不断地将文件上传到 Rails 应用程序的文件夹。

我不想将这些文件保存在源代码管理中，因为它们占用了将近 2 GB，所以每次我这样做时，`cap deploy`它都会将这些文件保存在其中，`releases/`并用存储在存储库中的原始副本替换目录。

我想知道将这些文件保存在服务器`current`目录中的最佳方法是什么。我的一些想法是：

*   从源代码管理中删除目录并将其替换为指向不受 Capistrano 管理的外部目录的链接。
*   创建 Capistrano 任务以在部署前将目录复制到 /tmp，然后在部署完成后将其复制回 /public。

有标准的方法来做到这一点吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T20:33:04.883

为了将来的记录，这是我过去使用共享目录执行的任务：

```
task :link_shared_directories do     
  run "ln -s #{shared_path}/files #{release_path}/public/files"   
end    

after "deploy:update_code", :link_shared_directories 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-04T19:22:07.583

您可以使文件成为您机器上另一个目录的符号链接，例如与 /current 和 /releases 处于同一级别的 /shared 目录。

查看 capistrano 管理 /log 和 /tmp 目录。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-10-20T03:12:01.413

现在我们可以简单地在 deploy.rb 中使用 :linked_files ：

```
set :linked_files, %w{config/database.yml} 
```

在这种情况下，文件 [target_dir]/shared/config/database.yml 必须存在于服务器上。

# java - JBoss/Java 的状态机框架？

> ID：263042
> 
> 赞同：0
> 
> 时间：2008-11-04T19:17:32.010
> 
> 标签：java, frameworks, fsm

我们正在开发一个涉及许多不同测试的应用程序，其中每个测试都会引导用户执行多个步骤。我们正在考虑使用状态机框架从代码中捕获状态/转换。我们也在考虑使用规则引擎来补充规则。任何人都有任何可以与 JBoss 和/或 Java 一起使用的状态机框架的经验吗？提前致谢。

-阮

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-04T19:19:54.390

[jbpm](http://jboss.org/jbpm)做到了这一点，并与 jboss 很好地集成。根据我的经验，它非常易于使用且功能强大。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-04-05T03:57:11.147

你可能想看看[StatefulJ](http://www.statefulj.org)。它建立在 Spring Data for Persistence 支持之上，状态模型本身是使用 Annotations 定义的。与 XML 相比，这种方法更容易设置和维护。关于规则 - 我过去使用过 Drools，似乎得到了很好的支持。

免责声明：我是 StatefulJ 的作者

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T19:25:13.617

如果您正在构建一些基于屏幕到屏幕转换的系统，那么您肯定应该查看 Spring WebFlow [http://springframework.org/webflow](http://springframework.org/webflow)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-06T17:56:15.493

[我在使用ragel](http://www.complang.org/ragel/)构建易于维护的状态机方面有很好的经验。生成的 java 代码质量非常高。但是，它纯粹是一个状态机生成器，没有特定用途，因此您可能会找到其他解决方案，这些解决方案可以在与 Web 相关的问题域中更无缝地工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-08T09:55:51.827

也许你可以看看 JBoss PVM。它仍处于 alpha 阶段，但可用于对任何类型的状态机进行建模。我们也在研究它的 gui 转换。

[http://www.jboss.org/jbossjbpm/pvm](http://www.jboss.org/jbossjbpm/pvm)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-09T09:39:44.847

试试 Activiti，好像很多人都在用。 [http://activiti.org](http://activiti.org)

当然，对于规则引擎部分，您可以使用 Drools。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-24T14:49:07.657

看看[StateBuilderJava](http://www.stateforge.com)，它是一个状态机代码生成器，它将状态机的 XML 描述转换为 Java 状态模式的扩展版本。它支持所有 UML 语义：状态机可以是分层的、并发的和异步的。

每个测试场景都可以使用状态机 Xml 描述建模，代码生成器代表您编写状态模式，如果手动完成，这将是乏味且容易出错的。

另一个优点是使用图形工具可视化和编辑测试场景。这允许快速实施和记录一组测试场景。在示例中，编写了 XMPP 客户端的测试套件来说明如何使用状态机代码生成器轻松快速地编写复杂的测试场景。

免责声明：我是这些软件的作者。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-09-18T16:40:18.770

我用过activiti。它是最好的框架。它是一个轻量级的工作流和业务流程管理 (BPM) 平台。开源并适用于任何 Java 平台或云。所需要的只是 BPMN 、 Maven 、 Spring 和 Activiti 的知识。

# ms-access - 确定指定数字的范围类别

> ID：263053
> 
> 赞同：1
> 
> 时间：2008-11-04T19:21:27.307
> 
> 标签：ms-access

所以我有一个不同数字的列，并希望在 30 分钟内按范围对它们进行分类。所以 5 是 0-30，697 是 690-720，169 是 150-180。我首先想到的是做一个案例陈述，但看起来 Access 2003 不支持它。是否有某种算法可以确定范围？优选地，这将在查询中完成。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T19:33:18.437

使用 Int 函数将 (number / 30) 的整数部分乘以 30 得到下限，然后将 30 加到该数字上得到上限。

例子

```
Int(5 / 30) = 0 * 30 = 0
Int(697 / 30) = 23 * 30 = 690 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T19:30:07.583

使用 /（整数除法）和 *（乘法）。5/30*30 = 0 697/30*30 = 690 169/30*30 = 150 ...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T19:33:25.330

让 x 成为您想要分类的值的列，您拥有的伪 SQL：

```
select ((x/30)*30) as minrange,
(((x/30)+1)*30) as maxrange
from yourtable 
```

（你应该取除法的整数部分）。
希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T19:36:37.493

这是相当直截了当的。您可以使用以下内容。

```
(number \ 30) * 30 
```

这将为您提供范围的较低索引。它确实有一个问题，即 30、720、180 等将作为自身返回。这意味着您的范围要么需要为 0-29、690-719 等，要么让您的呼叫者考虑到这一点。

这假设您使用的是 VBA，其中 '\' 运算符仅返回商。[在此处](http://msdn.microsoft.com/en-us/library/b6ex274z(VS.80).aspx)查看有关 VB 运算符的更多信息

# php - 如何在 PHP 中更改 PDO/SQLite 连接的字符编码？

> ID：263056
> 
> 赞同：9
> 
> 时间：2008-11-04T19:23:02.230
> 
> 标签：php, sqlite, pdo

我有一个 php-gtk 应用程序一直运行到非 utf8 字符串的小问题，我发现问题出在数据库连接中，即使数据库应该是 UTF-8 也是如此。

[我曾尝试使用“SET CHARACTER SET utf8”（MySQL 方式）和“SET NAMES UTF8”，但没有任何反应（在“ SQLite 理解的查询语言](http://www.sqlite.org/lang.html) ”页面中也没有关于这些命令的任何信息，所以我对此并不感到惊讶）。

PD：也许连接已经是 UTF-8 而数据不是，但如果有办法改变连接编码，这个问题仍然有用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-04T20:07:26.293

据我所知，[SQLite 只有一个 charset 设置](http://www.sqlite.org/pragma.html#pragma_encoding)，它位于每个数据库级别。您无法更改连接上的编码。

C API 有[两种不同](http://www.sqlite.org/c3ref/open.html)的打开连接的方式，UTF-8 或 UTF-16。我希望 PHP 的 SQLite 模块（以及 PDO）简单地使用 UTF-8 版本。如果这是正确的，我希望 SQLite 连接始终是 UTF-8。这意味着您应该使用[utf8_encode](http://docs.php.net/manual/fr/function.utf8-encode.php) / [utf8_decode](http://docs.php.net/manual/fr/function.utf8-decode.php)手动编码/解码字符串。

另见：[`http://www.alberton.info/dbms_charset_settings_explained.html`](http://www.alberton.info/dbms_charset_settings_explained.html)

# visual-studio - VS2005中是否有禁用评论“折叠到定义”的设置？

> ID：263061
> 
> 赞同：0
> 
> 时间：2008-11-04T19:24:50.200
> 
> 标签：visual-studio, comments, settings

是否有一个大纲设置来禁用 Visual Studio 2005 中注释的“折叠到定义”？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-04T19:31:16.677

只是评论 - 不。

但是你可以关闭大纲编辑——>大纲——>停止大纲（或CTRL+M，CTRL+P）

# video - 同步播放两个或多个视频

> ID：263069
> 
> 赞同：2
> 
> 时间：2008-11-04T19:27:43.003
> 
> 标签：video, multimedia

如何以帧级同步在不同窗口中播放两个或多个视频文件/流？

我可以使用哪些工具、库或 API 来做到这一点？

帧级同步是指我的解决方案必须保证每个视频文件的每一帧都必须同时显示，同时显示其对应的帧（来自其他文件）。

例如：

```
 in sync         out of sync
Time     -+-+-+-+-+-+ ... +-+-+-+-+-+-+         
video 1   fr1 fr2 fr3     fr1  fr2  fr3
video 2   fr1 fr2 fr3 ...   fr2 fr3 fr4
video N   fr1 fr2 fr3      fr1   fr2  fr3 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-08T18:46:20.470

On windows it should be possible to create custom directshow filters/components to do this. We use c# and directshow.net to achieve something similar, however we do not yet have "true" frame synchronization and I am in fact searching for a solution as well. The caveat here is that you can not just use the default/provided directshow filters, I fear one would have to write some new filters or perhaps modify the base classes a bit.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T19:33:18.653

在 OS X 上，[Core Video](http://developer.apple.com/documentation/GraphicsImaging/Conceptual/CoreVideo/CVProg_Intro/chapter_1_section_1.html)框架将完成这项工作。Core Video 的明确目的是在 QuickTime 媒体（例如音频和视频）和 Quartz 合成系统之间提供帧级同步的链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T19:34:48.353

您能否稍微扩展一下“帧级同步”的含义？

当播放多个视频并且您旋转桌面时，compiz 会执行此操作

opengl 可以在立方体的侧面同时渲染多个视频等

# sql-server-2005 - 在 SQL Server 2005 中的视图上创建全文索引

> ID：263071
> 
> 赞同：7
> 
> 时间：2008-11-04T19:27:54.797
> 
> 标签：sql-server-2005, full-text-search

我在 SQL Server 2005 中的视图上创建全文索引时遇到问题。查看文档我没有发现问题。我收到的错误消息是：“'Id' 不是强制执行全文搜索键的有效索引。全文搜索键必须是唯一的、不可为空的、非脱机的单列索引，是未在非确定性或不精确的非持久计算列上定义，最大大小为 900 字节。为全文键选择另一个索引。我已经能够验证错误字符串中的每个要求，除了“离线”要求，我真的不知道这意味着什么。我很确定它没有离线。

我有在下面创建目标表、视图和索引的脚本。我真的不需要下面示例中的视图，因为我试图隔离问题，所以它被简化了。

```
删除视图 [dbo].[ProductSearchView]
删除表 [dbo].[Product2]
去

设置 NUMERIC_ROUNDABORT 关闭；
设置 ANSI_PADDING、ANSI_WARNINGS、CONCAT_NULL_YIELDS_NULL、ARITHABORT、
    QUOTED_IDENTIFIER，ANSI_NULLS ON；
去

创建表 [dbo].[Product2](
    [Id] [bigint] 非空，
    [描述] [nvarchar](max) NULL,
    约束 [PK_Product2] 主键集群
    (
        [编号] ASC
    )WITH (PAD_INDEX = OFF, IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) 开 [主要]
去

使用 SCHEMABINDING 创建视图 [dbo].[ProductSearchView]
作为
选择 P.Id 作为 ID，  
         P.Description AS 字段
FROM [dbo].Product2 AS P
去

- 鉴于设置了 PK，此索引可能会过大...
在 [dbo].[ProductSearchView](Id) 上创建唯一的聚集索引 PK_ProductSearchView
去

-- 这是失败的命令
在 [dbo].[ProductSearchView](Id, Field) 上创建全文索引
关键索引 ID
使用 CHANGE_TRACKING AUTO 的全文；
去

```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-05T20:06:28.557

创建全文索引时需要指定索引的名称而不是列名：

```
CREATE FULLTEXT INDEX ON [dbo].[ProductSearchView](Id, Field)
KEY INDEX PK_ProductSearchView
ON FullText WITH CHANGE_TRACKING AUTO;
GO 
```

这将纠正您遇到的错误，但它会给您另一个错误，因为您试图在文本搜索中包含基于非字符的列。您可能希望选择另一个索引字符列在您的全文目录中使用。

# unit-testing - 学习 MSBuild 的最佳资源有哪些？

> ID：263075
> 
> 赞同：8
> 
> 时间：2008-11-04T19:28:52.190
> 
> 标签：unit-testing, msbuild, tfsbuild

我正在寻找关于StackOverflow 社区用来更好地学习MSBuild 的**最佳和有效资源的任何和所有建议，****重点是将单元测试**和后来的静态代码分析工具（如 FxCop 和 StyleCop）集成到构建过程中。

我试图找到关于将单元测试添加到我的构建中的良好清晰文档，但我仍在搜索 - 甚至 Google 搜索都出现空洞或只有零碎。理想情况下，我想添加单元测试、报告结果，并最终将代码覆盖率统计等添加到构建结果中。

我知道它必须在 MSDN 的某个地方，但我似乎找不到任何可以很好地解释和教授的东西。我正在使用 Visual Studio Team System 2008。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T20:18:34.617

Carel Lotz[从理论到实践的持续集成。](http://dotnet.org.za/cjlotz/archive/2008/01/15/continuous-integration-from-theory-to-practice-2nd-edition.aspx)它涵盖了您的问题的整个范围，然后是一些。写得好，完整，完整的样本都在那里。

放下最好的资源。先用它作为教程，然后用它作为指南，然后用它作为参考。

MSDN 和其他人有助于澄清（或混淆）细节。

**编辑：** Carel Lotz 的指南使用 MBUnit 进行单元测试（请参阅他早期的 NUnit 文档版本，尽管如果您遵循 NUnit 帮助文件，您可以很容易地将 MBUnit 替换为 NUnit）。

此外，它被编写为使用 Cruise Control.NET 在各种配置中运行 MSBuild 脚本。

就个人而言，我在辅助 MSBuild 脚本中运行单元测试，但发现在 MSBuild 中包装 NUnit 调用比直接从 CCNet 运行提供了更大的灵活性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T20:55:42.920

我想我需要问您是否*确定*要直接使用 MSBuild？可能想查看[WIX](http://wix.sourceforge.net/)作为 MSI 生产工具 - 有一本详尽的手册，它建立在 MSBuild 之上。

至于通过报告和与 NUnit、FxCop、NCover、FitNesse 等集成来自动化测试 - 我认为最好的（免费）工具是[CruiseControl .Net](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)。它适用于所有这些工具等等。可以进行版本控制，通过自动化测试进行自动化构建，为每个...创建报告

这是我的一个构建示例...

[http://img84.imageshack.us/img84/3664/cruisecontrolnetsamplezn0.jpg http://img84.imageshack.us/img84/3664/cruisecontrolnetsamplezn0.jpg](http://img84.imageshack.us/img84/3664/cruisecontrolnetsamplezn0.jpg)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T06:50:54.120

这本书可能会有所帮助：http: [//blogs.msdn.com/microsoft_press/archive/2009/01/31/sayed.aspx](http://blogs.msdn.com/microsoft_press/archive/2009/01/31/sayed.aspx)

# macos - 使用新卷上的相对路径解析 AliasRecord

> ID：263076
> 
> 赞同：0
> 
> 时间：2008-11-04T19:29:01.067
> 
> 标签：macos, macos-carbon

我有一个`AliasRecord`使用别名管理器功能的创建`FSNewAlias(fromFSRef, targetFSRef, &aliasRecordHandle)`。我的理解是，生成的别名记录将包含相对路径搜索的信息（相对于`fromFSRef`）。因为我的用户在联网的主目录*和*移动帐户上，所以这些别名似乎不会在联网和移动主目录之间保留用户主目录中文件的位置，因为它们位于不同的卷上。如果原始`fromFSRef`对应于网络帐户中的/Network/.../Users/user/Desktop，我希望能够使用`FSResolveAlias(newFromFSRef, aliasRecordHandle, &targetFSRef, &changed)`与`newFSRef`/Users/user/Desktop（即移动帐户）对应的别名来解析别名。这可能吗？

我采用的解决方案是保留别名记录和相对路径。如果别名解析失败，我使用相对路径来创建新别名。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T17:57:44.950

看来问题中提出的解决方案——同时保留别名记录和相对路径是唯一的选择。如果别名解析失败，我们尝试使用相对路径（连同应用程序或用户定义的根目录）来查找文件。如果成功，我们将使用新路径更新别名记录。否则，我们回退到要求用户找到“丢失”的文件。

# lucene - 如何让 Lucene QueryParser 更宽容？

> ID：263081
> 
> 赞同：31
> 
> 时间：2008-11-04T19:30:22.077
> 
> 标签：lucene, lucene.net

我正在使用 Lucene.net，但我为 .NET 和 Java 版本都标记了这个问题，因为 API 是相同的，我希望这两个平台上都有解决方案。

我确信其他人已经解决了这个问题，但我还没有找到任何好的讨论或例子。

默认情况下，Lucene 对查询语法非常挑剔。例如，我刚刚收到以下错误：

```
[ParseException: Cannot parse 'hi there!': Encountered "<EOF>" at line 1, column 9.
Was expecting one of:
    "(" ...
    "*" ...
    <QUOTED> ...
    <TERM> ...
    <PREFIXTERM> ...
    <WILDTERM> ...
    "[" ...
    "{" ...
    <NUMBER> ...
    ]
   Lucene.Net.QueryParsers.QueryParser.Parse(String query) +239 
```

在处理来自用户的查询时，防止 ParseExceptions 的最佳方法是什么？在我看来，最*有用*的搜索界面是始终执行查询的界面，即使它可能是错误的查询。

似乎有一些可能的互补策略：

*   在将查询发送到 QueryProcessor 之前“清理”查询
*   优雅地处理异常
    *   向用户显示智能错误消息
    *   也许执行一个更简单的查询，留下错误的位

对于如何执行这些策略，我真的没有什么好主意。有没有其他人解决过这个问题？有没有我不知道的“简单”或“优雅”解析器？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-11-05T12:57:27.330

你可以通过使用类似的东西清理查询来让 Lucene 忽略特殊字符

```
query = QueryParser.Escape(query) 
```

如果您不希望您的用户在他们的查询中使用高级语法，您可以始终这样做。

如果您希望您的用户使用高级语法，但您也希望对错误更加宽容，您应该只在 ParseException 发生后进行清理。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-04T21:35:07.487

Well, the easiest thing to do would be to give the raw form of the query a shot, and if that fails, fall back to cleaning it up.

```
Query safe_query_parser(QueryParser qp, String raw_query)
  throws ParseException
{
  Query q;
  try {
    q = qp.parse(raw_query);
  } catch(ParseException e) {
    q = null;
  }
  if(q==null)
    {
      String cooked;
      // consider changing this "" to " "
      cooked = raw_query.replaceAll("[^\w\s]","");
      q = qp.parse(cooked);
    }
  return q;
} 
```

This gives the raw form of the user's query a chance to run, but if parsing fails, we strip everything except letters, numbers, spaces and underscores; then we try again. We still risk throwing ParseException, but we've drastically reduced the odds.

You could also consider tokenizing the user's query yourself, turning each token into a term query, and glomming them together with a BooleanQuery. If you're not really expecting your users to take advantage of the features of the QueryParser, that would be the best bet. You'd be completely(?) robust, and users could search for whatever funny characters will make it through your analyzer

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-12T22:27:10.970

仅供参考...这是我用于 .NET 的代码

```
private Query GetSafeQuery(QueryParser qp, String query)
{
    Query q;
    try 
    {
        q = qp.Parse(query);
    } 

    catch(Lucene.Net.QueryParsers.ParseException e) 
    {
        q = null;
    }

    if(q==null)
    {
        string cooked;

        cooked = Regex.Replace(query, @"[^\w\.@-]", " ");
        q = qp.Parse(cooked);
    }

    return q;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T12:37:32.813

我对 Lucene.net 了解不多。对于一般的 Lucene，我强烈推荐这本书[Lucene in Action](http://www.manning.com/hatcher2/)。对于手头的问题，这取决于您的用户。有充分的理由（例如易用性、安全性和性能）来限制用户的查询。这本书展示了使用自定义解析器而不是 QueryParser 来解析查询的方法。我赞同 Jay 关于 BooleanQuery 的想法，尽管您可以使用自定义解析器构建更强大的查询。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T12:59:58.557

如果您不需要所有 Lucene 功能，则编写自己的查询解析器可能会更好。它并不像一开始看起来那么复杂。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-04T20:03:33.990

我和你的情况一样。

这就是我所做的。我确实捕获了异常，但只是为了让错误看起来更漂亮。我不改变文字。

我还提供了一个对 Lucene 语法的解释的链接，我已经简化了一点：http:
[//ifdefined.com/btnet/lucene_syntax.html](http://ifdefined.com/btnet/lucene_syntax.html)

# sql-server-2005 - 如何修复在服务器上部署的包执行过程中发生的错误？

> ID：263086
> 
> 赞同：1
> 
> 时间：2008-11-04T19:31:39.423
> 
> 标签：sql-server-2005, ssis

我已经使用 Sql Server 商业智能开发工作室创建了一个 dtsx 包，我正在使用 dtexec 实用程序执行它。使用 dtexec 我在运行时使用 /set 开关设置某些属性。所以我的命令看起来像：

```
dtexec /f "mypackage.dtsx" /set 
\Package.Connections[Destination].Properties[UserName];myUserName 
```

当我在我的本地系统（开发它的那个）上运行它时，这非常有效。不幸的是，当我将此包复制到不同的系统并尝试运行此完全相同的命令时，我收到以下错误：

```
Warning: The package path referenced an object that could not be found: 
\Package.Connections[Destination].Properties[UserName]. This occurs when an 
attempt is made to resolve a package path to an object that cannot not be found. 
```

将包移动到的新系统已安装 SSIS，并且运行与我的本地系统 (SP2) 相同版本的 Sql Server。也许我误解了 dtsx 包的预期用途，但我真的不明白这是如何/为什么会发生的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T08:51:55.877

此步骤用于创建 XML 配置文件 (.dtsConfig)，该文件可以保留您的敏感数据，例如连接字符串的密码，而没有可能使您难以将包从一台机器移动到另一台机器的保护级别。

在此示例中，假设您有一个到名为 MyDb 的 SQL 数据库的 OLE DB 连接。

1.  控制流，属性：将“ProtectionLevel”设置为“DontSaveSensitive”

2.  控制流，在空白处右键获取菜单：点击“包配置”

3.  包配置管理器：勾选“启用包配置”；点击“添加”

4.  包配置向导，选择配置类型：将“配置类型”设置为“XML配置文件”；选择“直接指定配置”单选按钮；点击“浏览...”

5.  选择配置文件位置，填写“文件名”：[PackageName].dtsConfig（如果与包本身相同的文件夹和相同的文件名，则很容易，只是扩展名不同）；点击“保存”

6.  包配置向导，选择配置类型：点击“下一步>”

7.  包配置向导，选择要导出的属性：遍历以下树节点并勾选其复选框；点击“下一步>”

    \[PackageName]\Connection Managers\MyDb\Properties\Connection 字符串

    \[包名]\Connection Managers\MyDb\Properties\Password

8.  包配置向导，完成向导，点击“完成”

9.  包配置管理器：单击“关闭”

10.  解决方案资源管理器：右键单击菜单的根树，单击“添加”，“现有项...”，单击 [PackageName].dtsConfig，单击“添加”

11.  解决方案资源管理器：双击 \Miscellaneous\[PackageName].dtsConfig 加载到编辑器；

12.  主菜单：点击“编辑”，点击“高级”，点击“格式化文档”

13.  遍历 XML 树节点：\DTSConfiguration\Configuration[Path="\Package.Connections[MyDb].Properties[Password]"]\ConfiguredValue; 输入数据库密码；保存文件

14.  Windows 资源管理器：导航并双击 [PackageName].dtsx

15.  执行Package Utility，Configuration，点击“Add”，双击[PackageName].dtsConfig，点击“Execute”

当需要将 .dtsx 移动到另一台机器时，只需将其与 .dtsConfig 一起使用即可。希望这可以帮助。

干杯，阿里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T22:03:07.290

在您的控制流属性上，有一个名为“ProtectionLevel”的属性。如果您将其设置为“DontSaveSensitive”，那么在进行开发和测试时可能会减少您的头痛。对于需要安全性的生产场景，您可能需要找到另一个解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T13:08:56.323

如果您在机器之间移动包，则需要创建一个部署实用程序。您的连接信息使用特定于您机器的密钥进行加密。

如果您转到 VS 中的项目属性，请选择部署实用程序部分并将 CreateDeploymentUtility 选项设置为 true。这将在 bin 文件夹中创建部署实用程序，然后您可以将所有内容复制到新机器，运行安装程序，一切正常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T07:28:24.593

在机器之间移动包并避免对包进行所有签名的最快方法如下。

在打开包的 Visual Studio 中，选择“保存 PackageName 的副本”为

然后你得到一个向导。最简单的一种可能是只选择文件存储。然后在向导的底部，您将看到保护级别。选择使用密码加密敏感数据。输入密码。

在您希望移动它的服务器上选择导入包，它会提示您输入密码。输入它，您的连接信息将正确移动到新服务器。

绝对不是最佳实践，但它是在测试服务器中快速移动事物的好方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-21T14:33:38.990

以下是 MSDN 关于包安全的指南。[设置包的保护级别](http://msdn.microsoft.com/en-us/library/ms141747.aspx)

# visual-studio-2008 - 在 Visual Studio 2008 中为 SharePoint 添加 Web 引用

> ID：263093
> 
> 赞同：0
> 
> 时间：2008-11-04T19:32:57.750
> 
> 标签：visual-studio-2008, sharepoint, asmx

每当我在 VS 2008 中为任何 Sharepoint Web 服务添加 Web 引用时，添加 Web 引用时的预览窗口都会显示正确的方法名称：
注意 CreateFolder：

之前：[替代文字 http://img134.imageshack.us/img134/5286/vs20081bq7.png](http://img134.imageshack.us/img134/5286/vs20081bq7.png)

之后，不存在 CreateFolder 方法

[http://img134.imageshack.us/img134/3530/vs20082be5.png 之后](http://img134.imageshack.us/img134/3530/vs20082be5.png)

我查看了 [MSDN](http://msdn.microsoft.com/en-us/library/ms774480.aspx)上的文档，但似乎我正在正确使用它。
谁能指出我的错误？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T20:22:38.337

您需要在代码中创建对 Dws 对象的引用。否则你只能看到静态方法/类型。

尝试

```
DocumentWorkspace dw = new DocumentWorkspace();
dw.CreateFolder(); 
```

并不是说通常我需要获取对特定站点 dws 服务的引用，因此添加以下代码会有所帮助

```
dw.Credentials = [get the appropriate credentials, most often System.Net.CredentialCache.DefaultCredentials];
dw.Url = [basesiteurl] + "/_vti_bin/dw.asmx"; 
```

# openid - OpenID 是一个有缺陷的概念吗？

> ID：263094
> 
> 赞同：13
> 
> 时间：2008-11-04T19:33:08.640
> 
> 标签：openid, single-sign-on

我不是问具体的实现，也不是问跨站单点登录机制的全球世界观，我只是想知道社区对 OpenID 底层可用性的看法。您是否认为使用由（非技术观察者）随机提供的各种提供者发布的 URL 来代替实际的用户名是人们会喜欢的东西？如果没有，有没有人有更好的机制？如果有足够的兴趣，我将跟进一个更一般的 SSO 问题。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-05T22:10:14.670

不。

我不认为这是一个有根本缺陷的系统。在可用性方面，我会说它是有缺陷的，因为它背离了规范，而且更难习惯，即 URL 而不是用户名，必须选择提供商。但我认为它们是唯一的问题，并且可以并且正在做一些改进它们的事情（登录页面的可用性调整，雅虎和谷歌提高对这个想法的认识）。

除此之外，我认为这是一个很棒的系统：

*   我记得一个账号ID密码组合（我不需要依赖软件解决很多ID->密码问题）
*   我去新网站时不需要填写表格，等待注册电子邮件确认。
*   如果我不信任 OpenID 提供者，我可以相对容易地成为我自己的提供者，我个人认为这是一个标准的伟大成就。制作如此多才多艺的东西，（AFAIK）对我来说很容易，真的很重要。
*   当这两项工作变得越来越困难时，它将建立网站的责任与密码存储和安全性分离。
*   我实际上对下一点了解不多，但我认为使用一个 OpenID 帐户来托管多个角色非常容易，这些角色可用于不同的网站，例如“这是我的工作角色，这就是我在注册时展示的内容为 ilovemyjob.com。这是我的朋友角色，我将其用于 facebook”，并且不同的角色具有与之相关的不同信息。就像我说的那样，我不太了解这是如何完成的，或者确切地说它为什么有用......但我会找出它可能有什么好处。

这就是我看到的 OpenID 的主要好处。就缺点而言，还有可用性方面，我承认这是一个问题。人们用来批评 OpenID 的另一个主要观点是，如果帐户被盗用，那么许多登录名都会被盗用。在我看来，这并不比当前将电子邮件绑定到帐户的系统更糟糕，这种系统可能会受到类似的损害，并用于“忘记您的用户名？” 在许多网站上运行。我还想指出，OpenID 并不是要解决这个问题——它是解决多个 ID/密码问题的方法。但是，拥有一个密码可以提供更大的许可来不断更新它以增加安全性 - 无需依赖软件为您记住它，或者一直忘记它。

所以，OpenID 有它的问题，但我会说它是解决多个 ID/密码问题的好方法。

参考资料：
[关于这个主题的有趣的 Google Talk](http://video.google.com/videoplay?docid=2288395847791059857)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-04T19:41:56.780

是的。

首先，选择供应商很困难。如果我是一个经验不足的用户，我会问“为什么我需要与 X 共享我的信息才能使用 Y 运营的网站？” 然后，一旦你克服了这一点，你就必须选择信任谁来处理你的信息。我个人选择威瑞信，因为我信任威瑞信。但有些人可能从未听说过其中一些提供者，因此无法做出明智的决定。

其次，登录困难。我必须输入 URL，而不是输入用户名（尽管 StackOverflow 使您更容易选择提供者和提供者用户名，并为您创建 URL）。

第三，如果我的 OpenID 被盗用，那么我使用 OpenID 的网站上的所有帐户也会被盗用。有些人建议使用多个 OpenID 来克服这个问题，但我认为这违背了 OpenID 的全部目的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-05T22:31:15.300

我无法理解对 OpenID 的焦虑。

我登录这个网站的经历（诚然，我不得不处理的唯一开放 ID）很简单。我看到了 OpenID 所需的东西，我模糊地理解我登录该站点将被委托给我信任并且已经拥有 ID 的其他人。瞧，有一个链接指向我当前的在线电子邮件提供商的提供商。点击，遵循一个简单到我什至不记得做过的过程。

现在打开 id 连接已经建立，它并不比我处理的任何其他站点更困难，而且神奇的是我不必再向一个我不知道我会使用的站点添加*另一个帐户*再次，可能会忘记用户名或密码。

我喜欢它，概念和执行。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-04T19:40:15.490

我之前已经说过了，我可能会再说一遍，但是 URL 的想法是一个根本有缺陷的想法。他们应该使用电子邮件地址格式或 username@service.com 的 Jabber 格式。这将允许现有的电子邮件提供商提供一个 ID，而无需用户记住一些神秘的 URL。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-04T06:45:12.963

不，我不认为 OpenID 是一个有缺陷的概念。

如果您查看 OpenID 的[历史](http://en.wikipedia.org/wiki/OpenID#History)，它最初的目的是允许人们通过他们在博客中拥有的 URL 来关联自己。这个想法被扩展并成为今天的单点登录系统。

我会说 OpenID 非常适合没有用户帐户来保存基本信息的网站，这对最终用户来说并不**重要。**因此，帮助评估您的漫画书收藏的漫画书网站可能是一个很好的例子。因为作为 OpenID 最终用户，您可以登录到该站点（无需创建**另一个**用户名/密码——可能与您创建的任何其他用户名/密码不同，因为系统上存在现有用户）并查看它们的工作方式。如果您喜欢它，那么您可以继续正常使用该系统。或者，如果您并不完全迷恋该网站，但决定稍后查看它们，那么与其尝试记住您在您认为可能不会返回的网站上使用的用户名和密码组合，这可能会令人沮丧。OpenID 完美地解决了这种情况。

话虽如此，我个人不会使用 OpenID 登录我的银行帐户，因为已经说明了许多关于重定向安全性的内容。然而，大部分情况正在发生变化，并且在通过属性交换（[尤其是在日本](http://www.sakimura.org/en/modules/wordpress/index.php?p=55)）推进 OpenID 的安全性方面取得了很大进展。

许多人不知道的另一个注意事项是，您不需要使用 URL 来拥有 OpenID，有一种称为[i-names](http://www.inames.net/)的技术看起来更像是用户名，即我的 i-name 是“=true” ，这可能比输入“ [http://true.myopenid.com](http://true.myopenid.com) ”之类的内容要容易得多。个人 i-name 每年的费用为 12 美元，因此这可能最初对某些人来说是一个障碍，但如果您想与他们一起玩，可以[选择免费的替代品。](http://www.freexri.com/)

最后一点，OpenID 正在推广可发现性的概念（如果这是一个词的话）。这是一个似乎就在表面之下的概念。如果可以的话，可发现性就像协议级别的社交网络:)。该[领域正在进行大量工作](http://www.hueniverse.com/hueniverse/2008/09/discovery-and-h.html)，我认为这将导致更好地实现 OpenID 或至少是 OpenID 的想法。希望这将为我们所有人带来更好的互联网。

*免责声明我是 XRI TC 委员会的成员，经营一家专注于围绕 XRI 销售和提供服务的初创公司。*

*FreeXRI 不是我参与的创业公司。*

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-04T19:38:00.737

谷歌似乎是这么认为的。他们最近进入 OpenID 空间，以及协议的后续分支，对这个问题有两点要说：

1.  OpenID 很有用，特别是当它与拥有大量用户的网站相关联时，这些网站可以支持大量用户并且可能不会吸引他们。当像谷歌这样的人或从事 OID 工作的人已经涵盖了身份验证系统时，为什么要重新发明轮子呢？
2.  目前的 OpenID 很混乱，因为人们已经在许多参与的提供商那里拥有大量不同的用户名。然而，当 GMail 出现时，许多用户有一个很好的机会来获取他们自己的名字作为他们的电子邮件地址，并且他们可以创建无限数量的帐户。Google 似乎认为他们的帐户系统本身就足以满足所有 Open ID 用户的需求。我可能会同意这一点。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-05T22:26:21.643

我不认为这是一个有缺陷的概念。我只是认为它是新的，人们不习惯它。

**但是 OpenID 应该与本地注册系统*一起***使用，以便用户可以选择。告诉用户去 X.com 注册，然后再回到你的网站——这只是愚蠢和混乱。但是如果用户已经有一个 GMail/AOL/YMail/etc 帐户，那么让他们使用它是非常方便的。

我认为我们作为开发人员应该使用专门的登录表单。也就是说，而不是“输入您的 OpenID URL”，它应该是一个标准的“输入您的用户名”，他们可以选择 Gmail/AOL/YMail/etc，在幕后我们构建 URL。URL 作为登录名的想法有点倒退，因此欢迎帮助人们进行过渡。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-04T20:01:17.927

将这种东西内置到浏览器中不是更好吗？

例如，您在浏览器的首选项中输入您的个人数据。然后网站可以通过 JavaScript 调用请求个人数据，浏览器会显示一个对话框，要求您确认。当然，JavaScript API 必须是标准化的。

这样用户就不必在任何地方注册，他的所有个人信息都存储在他自己的机器上。此外，确认消息看起来就像您的操作系统的其余部分，而不仅仅是您可能不信任的某个网站。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-04T19:36:55.247

认为这些问题最好更具体而不是笼统。

对于您的问题，我认为它没有缺陷，但您是对的，它可能不会吸引某些人。但是，一旦人们得到它，就像理解它一样，那么他们可能会更多地使用它。记住更少的密码肯定是一件更好的事情，因为最终会使密码变得比应有的更弱。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-04T19:37:59.957

在这样的场景中，您需要有一个唯一的 UserID。另一个选项可能是有效的电子邮件地址，但垃圾邮件是什么。

因此我更喜欢基于 URL 的 UserID。对我来说，OpenID（在我的例子中是 myOpenId）的可用性非常好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-04T19:40:45.253

是的。

仍然有多个登录。我必须去登录我的 OpenID 提供商，然后我必须去该站点并使用 OpenID URL 再次登录。No 想做更多的工作，而 OpenID 要做的工作更多。

我知道没有人不在使用 OpenID 的计算机领域。OpenID 仍然太复杂了。普通用户不需要被另一层抽象所迷惑。

还有跟踪 OpenID 用户去向的问题。我使用威瑞信，一个受信任的名称，但那些使用不太值得信赖的提供商的人呢？不，我不会点名并开始一场火焰战争。

有一个更好的答案，它被称为[RoboForm](http://www.download.com/RoboForm/3000-2092_4-10037672.html)（或众多仿冒品之一）。所有用户的密码和名称都保存在他们的机器上并被加密。它易于使用、更安全、更快速。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-04T19:45:58.287

我认为一些 OpenID 实现还有很多不足之处。

我原以为雅虎会做对，但我认为他们的 OpenID 微型站点（信息和实施）是垃圾。布局令人困惑，他们没有明确说明 open-id 与用户标准 yahoo-account 的关系。

一旦我弄清楚需要哪个屏幕来启动我的登录请求，雅虎就会发布一个包含随机字符串的 OpenID 签名。stackoverflow 不接受这一点。我必须创建一个新别名，也必须将其设为默认选项。如果没有同样顽固的愿望去解决它，我认为很多用户会放弃。

在我看来，需要制定更严格的实施指南，并且需要大力宣传该活动以教育潜在用户。

也许该技术可以包含在浏览器实现中？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-05T21:29:03.910

我不希望其他系统拥有我的应用程序 ID。

我得到了对用户更简单和更统一的概念。

但是，UserID 对网站访问者的体验至关重要，您不想将所有鸡蛋都放在一个篮子里（Microsoft Passport、OpenID 等）。如果情况发生变化，您就搞砸了所有用户帐户。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-05T14:11:56.960

如果个人被盗或丢失，这最终不会危及个人的身份吗？这是我主要关心的问题。匿名有好处也有坏处。我相信两者兼而有之。我有一些亲密的朋友害怕加入 Facebook 社区，因为它是如此开放，如果数据库受到攻击，它就很容易成为目标。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-04T19:39:46.317

我认为 OpenID 的某些方面会给许多用户带来可用性问题，但可能可以通过 UI 改进来解决。例如，对于大多数用户来说，一个**URL**几乎天生就无法使用。但是没有理由不能抽象，因此用户只需选择他们的提供者并输入他们在该提供者处使用的用户名。此外，必须去一个单独的位置登录是一个巨大的可用性问题，并且正确地向用户发出了关于他们向谁提供哪些数据的危险信号。这将更难解决。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-23T11:36:09.643

这个概念很好，但是设计允许漏洞利用......

# jquery - Air 1.5 是否会包含带有 CSS 动画的 WebKit 更新？

> ID：263095
> 
> 赞同：0
> 
> 时间：2008-11-04T19:33:13.787
> 
> 标签：jquery, air, webkit

我目前正在开发一个 html/ajax air 应用程序，并且将投入一些精力来使用 jQuery 制作动画。如果 air 有最新版本的 WebKit，我可以使用 css 动画更容易地做到这一点。

我知道有些人拥有 air 1.5 的 alpha/beta 版本。如果你知道，你能告诉我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T20:26:13.820

squirrelfish 尚未在 safari 版本中可用，所以我认为可以肯定地说，如果 AIR 1.5 使用带有 squirrelfish 的 webkit 构建，它将至少支持（如果不是更多）最新 safari 浏览器的 CSS 功能。

有点跑题了，知道AIR 1.5是否有squirrelfishextreme吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T19:34:49.180

我不知道 AIR 1.5 的 CSS 功能是什么，但它是使用 SquirrelFish 构建的，如果这有助于您跟踪它的话。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-21T14:41:42.170

Adobe AIR 2.0 Beta 有 CSS 动画[看这里](http://labs.adobe.com/wiki/index.php/AIR_2:Release_Notes#New_Features_in_AIR_2)

# sql - 插入临时值（选择....按id排序）

> ID：263101
> 
> 赞同：3
> 
> 时间：2008-11-04T19:33:32.117
> 
> 标签：sql, insert, informix

我正在使用 Informix（版本 7.32）数据库。在一次操作中，我创建了一个临时表，其中包含常规表的 ID 和序列列（因此我将常规表中的所有 ID 连续编号）。但我想插入按 ID 排序的常规表中的信息，例如：

```
CREATE TEMP TABLE tempTable (id serial, folio int );

INSERT INTO tempTable(id,folio)
SELECT 0,folio FROM regularTable ORDER BY folio; 
```

但这会产生语法错误（因为 ORDER BY）

有什么方法可以订购信息然后将其插入到 tempTable 中？

更新：我想这样做的原因是因为常规表有大约 10,000 个项目，并且在 jsp 文件中，它必须显示每条记录，但这需要很长时间，所以我想这样做的真正原因是*分页*输出。这个版本的 Informix 没有也`Limit`没有`Skip`. 我无法对序列号重新编号，因为处于关系中，这是我们可以在一页上获得固定数量的结果（例如每页 500 个结果）的唯一解决方案。在常规表中已跳过 id（称为 folio），因为它们已被删除。如果我说

```
SELECT * FROM regularTable WHERE folio BETWEEN X AND Y 
```

我可能会在一页中得到 300，然后在下一页中得到 500

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-02T18:58:06.930

您可以通过将 SQL 分解为两个临时表来做到这一点：

```
CREATE TEMP TABLE tempTable1 (
id serial,
folio int);

SELECT folio FROM regularTable ORDER BY folio
INTO TEMP tempTable2;

INSERT INTO tempTable1(id,folio) SELECT 0,folio FROM tempTable2; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T20:23:36.260

在 Informix 中，当在 INSERT 语句中使用 SELECT 作为子句时，您只能**使用 SELECT 语法的一个子集**。

在这种情况下，不支持以下 SELECT 子句：

*   进入温度
*   订购方式
*   联盟。

此外， SELECT 的 FROM 子句不能引用与 INSERT 引用的同一表（这在您的情况下并不重要）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T19:48:02.743

自从我从事 Informix 工作以来已经有好几年了，但也许这样的事情会起作用：

```
INSERT INTO tempTable(id,folio)
SELECT 0, folio 
FROM (
    SELECT folio FROM regularTable ORDER BY folio
); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T19:44:24.373

您可以尝试在 SELECT ... ORDER BY 上迭代光标并在循环中执行 INSERT。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T21:27:13.510

在插入表时对行进行排序是没有意义的。关系数据库不允许您指定表中行的顺序。

即使可以，SQL 也不保证查询会以任何顺序返回行，例如您插入它们的顺序。您必须指定一个`ORDER BY`子句来保证查询结果的顺序。

因此，更改插入行的顺序对您没有好处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T02:51:12.390

正如比尔所说，对输入进行排序并不重要，您确实需要对输出进行排序。在您提供的简单示例中，这没有任何意义，所以我只能假设您要解决的真正问题更复杂——也许是重复数据删除？

您所追求的功能是`CREATE SEQUENCE`，但我很确定它在这么旧的 Informix 版本中不可用。

如果您真的需要按照您的要求进行操作，您可以`UNLOAD`按照所需的顺序查看数据，然后`LOAD`再次对其进行操作。这将确保 SERIAL 值按顺序分配。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T20:56:51.387

像这样的东西会起作用吗？

```
SELECT
    folio
FROM
    (
        SELECT
            ROWNUM n,
            folio
        FROM
            regularTable
        ORDER BY 
            folio
    )
WHERE
    n BETWEEN 501 AND 1000 
```

如果表变大或者您要获取以后的“页面”，它可能不是非常有效，但是 10K 行非常小。

我不记得 Informix 是否有 ROWNUM 概念，我使用 Oracle。

# c# - C#：等待所有线程完成

> ID：263116
> 
> 赞同：67
> 
> 时间：2008-11-04T19:35:36.870
> 
> 标签：c#, multithreading

我在编写的代码中遇到了一个常见模式，我需要等待组中的所有线程完成，并超时。超时应该是*所有*线程完成所需的时间，所以简单地为每个线程执行 thread.Join(timeout) 是行不通的，因为可能的超时是 timeout * numThreads。

现在我做如下的事情：

```
var threadFinishEvents = new List<EventWaitHandle>();

foreach (DataObject data in dataList)
{
    // Create local variables for the thread delegate
    var threadFinish = new EventWaitHandle(false, EventResetMode.ManualReset);
    threadFinishEvents.Add(threadFinish);

    var localData = (DataObject) data.Clone();
    var thread = new Thread(
        delegate()
        {
            DoThreadStuff(localData);
            threadFinish.Set();
        }
    );
    thread.Start();
}

Mutex.WaitAll(threadFinishEvents.ToArray(), timeout); 
```

但是，对于这类事情，似乎应该有一个更简单的成语。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-04T19:47:58.763

我仍然认为使用 Join 更简单。记录预期的完成时间（如 Now+timeout），然后循环执行

```
if(!thread.Join(End-now))
    throw new NotFinishedInTime(); 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2011-06-17T00:15:03.893

使用 .NET 4.0，我发现[System.Threading.Tasks](http://msdn.microsoft.com/en-us/library/dd235608.aspx)更容易使用。这是对我来说可靠的旋转等待循环。它阻塞主线程，直到所有任务完成。还有[Task.WaitAll](http://msdn.microsoft.com/en-us/library/dd270695.aspx)，但这并不总是对我有用。

```
 for (int i = 0; i < N; i++)
        {
            tasks[i] = Task.Factory.StartNew(() =>
            {               
                 DoThreadStuff(localData);
            });
        }
        while (tasks.Any(t => !t.IsCompleted)) { } //spin wait 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-04T19:42:35.500

在我的脑海中，你为什么不只是 Thread.Join(timeout) 并从总超时中删除加入的时间？

```
// pseudo-c#:

TimeSpan timeout = timeoutPerThread * threads.Count();

foreach (Thread thread in threads)
{
    DateTime start = DateTime.Now;

    if (!thread.Join(timeout))
        throw new TimeoutException();

    timeout -= (DateTime.Now - start);
} 
```

**编辑：**代码现在不那么伪了。不明白当您修改 +4 的答案完全相同时，为什么要修改答案 -2，只是不太详细。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-10-11T01:01:09.163

由于问题遇到了，我将继续发布我的解决方案。

```
using (var finished = new CountdownEvent(1)) 
{ 
  for (DataObject data in dataList) 
  {   
    finished.AddCount();
    var localData = (DataObject)data.Clone(); 
    var thread = new Thread( 
        delegate() 
        {
          try
          {
            DoThreadStuff(localData); 
            threadFinish.Set();
          }
          finally
          {
            finished.Signal();
          }
        } 
    ); 
    thread.Start(); 
  }  
  finished.Signal(); 
  finished.Wait(YOUR_TIMEOUT); 
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-01-03T06:34:32.003

这没有回答问题（没有超时），但我做了一个非常简单的扩展方法来等待集合的所有线程：

```
using System.Collections.Generic;
using System.Threading;
namespace Extensions
{
    public static class ThreadExtension
    {
        public static void WaitAll(this IEnumerable<Thread> threads)
        {
            if(threads!=null)
            {
                foreach(Thread thread in threads)
                { thread.Join(); }
            }
        }
    }
} 
```

然后你只需调用：

```
List<Thread> threads=new List<Thread>();
//Add your threads to this collection
threads.WaitAll(); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-04T19:57:04.177

这对您来说可能不是一个选项，但如果您可以使用 .NET 的并行扩展，那么您可以使用`Task`s 代替原始线程，然后使用它`Task.WaitAll()`来等待它们完成。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-01T14:51:45.210

我想弄清楚如何做到这一点，但我无法从谷歌得到任何答案。我知道这是一个旧线程，但这是我的解决方案：

使用以下类：

```
class ThreadWaiter
    {
        private int _numThreads = 0;
        private int _spinTime;

        public ThreadWaiter(int SpinTime)
        {
            this._spinTime = SpinTime;
        }

        public void AddThreads(int numThreads)
        {
            _numThreads += numThreads;
        }

        public void RemoveThread()
        {
            if (_numThreads > 0)
            {
                _numThreads--;
            }
        }

        public void Wait()
        {
            while (_numThreads != 0)
            {
                System.Threading.Thread.Sleep(_spinTime);
            }
        }
    } 
```

1.  在执行线程之前调用 Addthreads(int numThreads)。
2.  在每个完成后调用 RemoveThread()。
3.  在您想要等待所有线程完成后再继续之前使用 Wait()

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-09-11T15:54:50.283

我阅读了《C# 4.0：Herbert Schildt 的完整参考》一书。作者使用join给出了一个解决方案：

```
class MyThread
    {
        public int Count;
        public Thread Thrd;
        public MyThread(string name)
        {
            Count = 0;
            Thrd = new Thread(this.Run);
            Thrd.Name = name;
            Thrd.Start();
        }
        // Entry point of thread.
        void Run()
        {
            Console.WriteLine(Thrd.Name + " starting.");
            do
            {
                Thread.Sleep(500);
                Console.WriteLine("In " + Thrd.Name +
                ", Count is " + Count);
                Count++;
            } while (Count < 10);
            Console.WriteLine(Thrd.Name + " terminating.");
        }
    }
    // Use Join() to wait for threads to end.
    class JoinThreads
    {
        static void Main()
        {
            Console.WriteLine("Main thread starting.");
            // Construct three threads.
            MyThread mt1 = new MyThread("Child #1");
            MyThread mt2 = new MyThread("Child #2");
            MyThread mt3 = new MyThread("Child #3");
            mt1.Thrd.Join();
            Console.WriteLine("Child #1 joined.");
            mt2.Thrd.Join();
            Console.WriteLine("Child #2 joined.");
            mt3.Thrd.Join();
            Console.WriteLine("Child #3 joined.");
            Console.WriteLine("Main thread ending.");
            Console.ReadKey();
        }
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-15T20:59:57.347

可能的解决方案：

```
var tasks = dataList
    .Select(data => Task.Factory.StartNew(arg => DoThreadStuff(data), TaskContinuationOptions.LongRunning | TaskContinuationOptions.PreferFairness))
    .ToArray();

var timeout = TimeSpan.FromMinutes(1);
Task.WaitAll(tasks, timeout); 
```

假设 dataList 是项目列表，并且每个项目都需要在单独的线程中处理。

# ios - iPhone OS Utility App - Flipside View 和 Main View 通信

> ID：263118
> 
> 赞同：3
> 
> 时间：2008-11-04T19:35:48.180
> 
> 标签：ios, objective-c, iphone, cocoa-touch, uiview

我目前正在开发一个 iPhone 2.1 应用程序。我是 Objective C 的新手，来自 Java 背景。

我的应用程序以带有 iPhone SDK 的 Xcode 中可用的 Utility Application 模板为基础。目前我`UISlider`在`FlipsideView`. `UISlider`已经有一个方法，当值更改时，使用目标和选择器调用该方法。但是，我也希望能够从 中读取and`MainView`的当前（或最后一个）值。`UISlider``textbox`

请记住，我是在 Mac 上进行开发的新手，并且希望获得有关我应该在哪里查找此类信息的任何指导，无论是通过使用代表还是我在模板结构中遗漏了一些明显的东西。

更新：我正在查看结构并了解更多详细信息：`UISlider`正在创建`FlipsideView.m`. 我注意到完成按钮是从那里创建的`RootViewController.m`，可能我应该将`UISlider`代码移到那里。我可能错误地使用`View`来保留在控制器中更合适的代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T20:52:06.733

最终，您应该使用控制器中的值更新一些底层对象。一般来说，滑块属于视图层——它是一个显示元素。然而，调整滑块产生的动作是控制器的一个组件，它应该返回到您的模型中以更新一个值。我强烈建议在一张纸上绘制框并尝试为应用程序的层生成尽可能清晰的分隔 - 在这种情况下，这样做会为实用程序的每个“侧”生成两个视图，这将通过控制器关联到一个模型。然后，移动滑块的动作将“立即”更新背面的模型。iPhone 开发者网站上的 Cocoa Fundamental 视频非常有效地展示了这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T19:28:25.017

我处于完全相同的情况：第一个 iphone 应用程序，新的 mac 编程，创建一个实用程序，在另一面的滑块。

按照此处的示例和免费教程（[http://www.bestechvideos.com/2008/11/13/writing-iphone-app-free-episode](http://www.bestechvideos.com/2008/11/13/writing-iphone-app-free-episode)），我确定滑块和其他控件应在 Flipsideviewcontroller 上声明. （这让视图很空——我猜对 UI 使用 Nib 资源文件会使 ...View.m 类变得非常多余？）

Wisequark 的回答对我来说有点笼统。具体而言： - 我找不到那个视频有链接吗？- 我们可以看到一些显示控制器模型代码的代码吗？- 如何保持滑块上设置的值而无需构建 UI 以进入系统设置？

(BTW is an Answer the right place to add to the question?)

# java - java trait 还是 mixins 模式？

> ID：263121
> 
> 赞同：17
> 
> 时间：2008-11-04T19:36:04.747
> 
> 标签：java, mixins, traits

有没有办法在java中模拟mixins或trait？基本上，我需要一种方法来进行多重继承，这样我就可以将通用业务逻辑添加到几个类中

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-04T19:45:31.920

不是你想要的方式。[Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)建议您“优先组合而不是继承”。这意味着您将通用逻辑移至其他类并委托。这就是你如何解决java中缺乏多重继承的问题。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-04T19:47:26.940

我会将所有业务逻辑封装到一个新类`BusinessLogic`中，并让每个需要`BusinessLogic`调用该类的类。如果您需要为调用 的类提供单一根层次结构`BusinessLogic`，则还必须创建一个接口（`BusinessLogicInterface`？）

在伪代码中：

```
interface BusinessLogicInterace
{
    void method1();
    void method2();
}

class BusinessLogic implements BusinessLogicInterface
{
    void method1() { ... }
    void method2() { ... }
}

class User 
    extends OtherClass 
    implements BusinessLogicInterface
{
    BusinessLogic logic = new BusinessLogic();

    @Override
    void method1() { logic.method1(); }

    @Override
    void method2() { logic.method2(); }
} 
```

这不是解决缺乏多重继承的最漂亮的实现，当接口有很多方法时它变得非常麻烦。最有可能的是，您需要尝试重新设计代码以避免需要 mixin。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-04T20:26:35.287

今天你的对象纯粹主义者在动吗？

你认为你可以用一点*面向复合的编程来做吗？*

那么，先生，您正在寻找[Apache](http://polygene.apache.org/) Polygene（以前的 Qi4J 或 Zest）；）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-04T19:44:14.263

Java 对多重继承的回答是能够实现多个接口。当然，这意味着您将获得方法声明，但不会获得逻辑。

您可以尝试通过组合来模拟 mixin：您的 Java 类可以定义代表其他执行某些常见业务逻辑的类的成员变量。

在设计 Java 类时，我没有发现缺乏 C++ 风格的多重继承来抑制我的架构设计。你会找到一种方法来实现你想做的事情。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-10-14T17:48:15.070

QI4J 允许你使用 mixins

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-05-02T11:49:59.517

您可以利用接口允许嵌套类（自动为公共静态）的事实来保持接口方法的默认实现封装在接口本身中。即把Alex B 的例子的BusinessLogic 类移到接口里面。

这类似于 Scala 为特征生成 JVM 代码的方式，如此处所述[如何将 Scala 特征编译为 Java 字节码？](https://stackoverflow.com/questions/2557303/how-are-scala-traits-compiled-into-java-bytecode)

这样做时，示例变为：

```
interface BusinessLogicInterface {
    void method0();

    class DefaultImpl {
        private DefaultImpl() {
        }

        public static void method1(BusinessLogicInterface self) { ... }
        public static void method2(BusinessLogicInterface self) { ... }
    }

    void method1();
    void method2();
}

class User extends OtherClass implements BusinessLogicInterface {
    @Override
    void method0() { ... }

    @Override
    void method1() { BusinessLogic.defaultImpl.method1(this); }

    @Override
    void method2() { BusinessLogic.defaultImpl.method2(this); }
} 
```

请注意，我们将接口类型的对象作为“self”参数传递。这意味着业务逻辑可以使用其他抽象方法（method0）。这对于使用彼此正交的抽象方法和可以根据这些正交方法实现的实用程序“扩展”方法来创建特征非常有用。

缺点是每个接口都必须复制/粘贴样板委托代码。另一个在 Java 中经常使用的没有这个缺点的模式（但具有较少的内聚性和较少的 OO 方式来调用方法）是创建一个具有复数名称的类作为包含静态方法的接口，这在 Collections 实用程序类中使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-18T09:37:06.953

从 Java-8 开始，添加了默认接口方法。这与 Java 中接口的多重继承一起应该允许某种混合。显然，接口必须独立运行。所以，会有很大的限制。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-21T11:18:23.610

使用 CGLib/javassit 在 java 中实现简单的 mixin/traits 支持非常容易。你可以看一下[这里](http://justonjava.blogspot.com/2011/10/mixins-aka-traits-implementation-in.html)的小例子。可能会找到更完整、可立即使用的解决方案：[here](http://insightfullogic.com/blog/2011/sep/16/multiple-inheritance/)

# django - 使用 Django 为静态文件自定义 HTTP 标头

> ID：263122
> 
> 赞同：10
> 
> 时间：2008-11-04T19:36:13.920
> 
> 标签：django, http, nginx

我正在用 Django 编写一个图像库，我想添加一个按钮来获取图像的高分辨率版本（低分辨率显示在详细信息页面中）。如果我只放一个`<a>`链接，浏览器将打开图像而不是下载它。添加 HTTP 标头，例如：

```
Content-Disposition: attachment; filename="beach008.jpg" 
```

有效，但由于它是一个静态文件，我不想用 Django 处理请求。目前，我使用 NGINX 提供静态文件，动态页面通过 FastCGI 重定向到 Django 进程。我正在考虑使用 NGINX`add-header`命令，但它可以设置`filename="xx"`部分吗？或者也许有一些方法可以在 Django 中处理请求，但让 NGINX 为内容提供服务？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-22T15:06:40.363

如果您的 django 应用程序由 nginx 代理，您可以使用[x-accell-redirect](http://blog.kovyrin.net/2006/11/01/nginx-x-accel-redirect-php-rails/)。您需要在响应中传递一个特殊的标头，nginx 会拦截它并开始提供文件，您也可以在同一响应中传递 Content-Disposition 以强制下载。

如果您想控制哪些用户可以访问这些文件，那么该解决方案很好。

您还可以使用如下配置：

```
 #files which need to be forced downloads
    location /static/high_res/ {
        root /project_root;

        #don't ever send $request_filename in your response, it will expose your dir struct, use a quick regex hack to find just the filename
        if ($request_filename ~* ^.*?/([^/]*?)$) {
            set $filename $1;
        }

        #match images
        if ($filename ~* ^.*?\.((jpg)|(png)|(gif))$) {
            add_header Content-Disposition "attachment; filename=$filename";
        }
    }

    location /static {
        root /project_root;
    } 
```

这将强制下载某个 high_res 文件夹（MEDIAROOT/high_rest）中的所有图像。而对于其他静态文件，它将表现得像往常一样。请注意，这是一个修改后的快速破解，适用于我。它可能具有安全隐患，因此请谨慎使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-04T21:40:16.760

我为 django.views.static.serve 视图写了一个简单的装饰器

这对我来说非常有用。

```
def serve_download(view_func):
    def _wrapped_view_func(request, *args, **kwargs):
        response = view_func(request, *args, **kwargs)
        response['Content-Type'] = 'application/octet-stream';
        import os.path
        response['Content-Disposition'] = 'attachment; filename="%s"' % os.path.basename(kwargs['path'])
        return response
    return _wrapped_view_func 
```

你也可以玩 nginx mime-types

[http://wiki.codemongers.com/NginxHttpCoreModule#types](http://wiki.codemongers.com/NginxHttpCoreModule#types)

这个解决方案对我不起作用，因为我想要文件的直接链接（例如，用户可以查看图像）和下载链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T22:09:11.117

我现在正在做的是使用与“视图”不同的 URL 进行下载，并将文件名添加为 URL arg：

常用媒体链接：`http://xx.com/media/images/lores/f_123123.jpg` 下载链接：`http://xx.com/downs/hires/f_12323?beach008.jpg`

和 nginx 有这样的配置：

```
 location /downs/ {
        root   /var/www/nginx-attachment;
        add_header Content-Disposition 'attachment; filename="$args"';
    } 
```

但我真的不喜欢它的味道。

# php - javascript 空文本 ajax

> ID：263129
> 
> 赞同：0
> 
> 时间：2008-11-04T19:37:03.140
> 
> 标签：php, javascript, ajax, class, function

我有一个 php 脚本，我正在使用 ajax。我有一个与 ajax 类连接的 textarea 表单

当我传递像 ( `&some text`) 这样的文本时，函数返回一个空文本时的问题，我猜我对 ( `&`) 有问题。

javascript函数：

```
function sendFormData(idForm, dataSource, divID, ifLoading)
{
  var postData='';
  var strReplaceTemp;

  if(XMLHttpRequestObject)
  {
    XMLHttpRequestObject.open("POST", dataSource);
    XMLHttpRequestObject.setRequestHeader("Method", "POST " + dataSource + " HTTP/1.1");
      XMLHttpRequestObject.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

    XMLHttpRequestObject.onreadystatechange = function()
    {
      if (XMLHttpRequestObject.readyState == 4 &&
          XMLHttpRequestObject.status == 200)
      {
        try
        {
          var objDiv = document.getElementById(divID);
          objDiv.innerHTML = XMLHttpRequestObject.responseText;
        }
        catch(e){document.write("sendFormData: getElementById(divID) Error");}
      }
      else
      {
        if(ifLoading)
        {
          try
          {
            var objDiv = document.getElementById(divID);
            objDiv.innerHTML = "<img src=loading.gif>";
          }
          catch(e){document.write("sendFormData->ifLoading: getElementById(divID) Error");}
        }
      }
    }

    for(i=0; i<document.getElementById(idForm).elements.length - 1; i++)
    {
      strReplaceTemp = document.getElementById(idForm).elements[i].name;
      postData += "&aryFormData["+strReplaceTemp+"][]="+document.getElementById(idForm).elements[i].value;
    }

    postData += "&parm="+new Date().getTime();
    try
    {
      XMLHttpRequestObject.send(postData);
    }
    catch(e){document.write("sendFormData: XMLHttpRequestObject.send Error");}
  }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T19:45:50.517

确保您的 & 用 & 编码 如果您使用 Javascript 传递它。所有 & 都需要编码，否则某些浏览器可能会有点崩溃，任何验证器都会抱怨你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T19:41:03.427

当我看到 HTML 和 & 和问题时，我希望确保我的字符编码都已正确指定。

此外，您的 PHP 脚本中的代码可能会因未转义的“&”字符而窒息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T19:57:27.967

在您的函数中，如果您使用“encodeURI()”包装 document.getElementById(idForm).elements[i].value 甚至 strReplaceTemp（在您的 postData +=）行中，则数据正确不会有任何问题已收到。

# delphi - 你如何找到一个 Delphi 组件来自的包？

> ID：263138
> 
> 赞同：2
> 
> 时间：2008-11-04T19:37:59.270
> 
> 标签：delphi, components, package, vcl

您曾经能够从调色板中获取安装了 Delphi 组件的包。不过，该功能似乎不在最新版本中。如何在 D2007 或 D2009 下找到组件属于哪个包？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:35:32.183

I don't know of any way to do this through the Delphi IDE. However, you can do a search in your registry for the component name. For instance, to find the package that TBitBtn belongs to, open RegEdit and do a search (on Keys only) for TBitBtn. The entry for TBitBtn has a value called "Package Name". This is the internal name of the package, which is probably still not quite what you are looking for. Copy the "Package Name" value (dclstd100.bpl in my case), and do a search from the top (on Values this time) for that value. Once this entry is found you will see the "friendly" package name in the "Data" column.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T21:47:58.507

在组件|安装包下，当您选择一个包时，组件按钮会显示该包中安装了哪些组件。

# c# - 哪个是更好的 .NET ORM 工具：SubSonic 还是 WebWidgetry？

> ID：263145
> 
> 赞同：0
> 
> 时间：2008-11-04T19:39:02.387
> 
> 标签：c#, visual-studio-2008, orm

我被指向 SubSonic (www.subsonicproject.com)，但后来我发现了 WebWidgetry (www.nthpenguin.com) 在我深入研究它们之前，我很想知道谁使用过它们，以及专业和劣势可能是什么？

谢谢你的帮助，吉姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T19:41:35.253

我以前使用过一次 SubSonic，它的设置和使用非常容易。实际上，我印象非常深刻，而对于 ORM 工具，我需要付出很多努力才能给我留下深刻印象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T20:18:45.583

WebWidgetry，似乎是一个候选版本，而 subsonic 是一个相当知名的 ORM 映射器。

WW 似乎也在寻找一个完全不同的市场。Subsonic 是一种通用的 ORM，它被建模为快速且易于使用。

如果你想在生产中使用任何东西，我的基本建议是等到它有足够的测试/社区支持。

RC 版本在质量方面通常不是最好的，而且可能缺乏支持。

# c# - 如何使用条件三元运算符在 lambda 之间有条件地分配 Func<>？

> ID：263151
> 
> 赞同：52
> 
> 时间：2008-11-04T19:39:52.183
> 
> 标签：c#, lambda, conditional-operator

通常，使用条件运算符时，语法如下：

```
int x = 6;
int y = x == 6 ? 5 : 9; 
```

没有什么花哨的，很直截了当。

现在，让我们尝试在将 Lambda 分配给 Func 类型时使用它。让我解释：

```
Func<Order, bool> predicate = id == null
    ? p => p.EmployeeID == null
    : p => p.EmployeeID == id; 
```

那是相同的语法，*应该*可以吗？对？出于某种原因，没有。编译器给出了这个很好的神秘信息：

> 错误 1 ​​无法确定条件表达式的类型，因为 'lambda 表达式' 和 'lambda 表达式' 之间没有隐式转换

然后我继续并更改了语法，这样它*确实*起作用了：

```
Func<Order, bool> predicate = id == null
    ? predicate = p => p.EmployeeID == null
    : predicate = p => p.EmployeeID == id; 
```

我只是好奇为什么它不能以第一种方式工作？

（旁注：我最终不需要此代码，因为我发现在将 int 值与 null 进行比较时，您只需使用 object.Equals）

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-04T19:45:18.927

您可以将 lambda 表达式转换为特定的目标委托类型，但为了确定条件表达式的类型，编译器需要知道第二个和第三个操作数中的每一个的类型。虽然它们都只是“lambda 表达式”，但没有从一个到另一个的转换，所以编译器不能做任何有用的事情。

但是，我不建议使用分配 - 演员表更明显：

```
Func<Order, bool> predicate = id == null 
    ? (Func<Order, bool>) (p => p.EmployeeID == null)
    : p => p.EmployeeID == id; 
```

请注意，您只需为一个操作数提供它，因此编译器可以从另一个 lambda 表达式执行转换。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-04T19:46:58.877

C# 编译器无法推断创建的 lambda 表达式的类型，因为它首先处理三元然后赋值。你也可以这样做：

```
Func<Order, bool> predicate = 
    id == null ? 
        new Func<Order,bool>(p => p.EmployeeID == null) :
        new Func<Order,bool>(p => p.EmployeeID == id); 
```

但这很糟糕，你也可以试试

```
Func<Order, bool> predicate = 
    id == null ? 
        (Order p) => p.EmployeeID == null :
        (Order p) => p.EmployeeID == id; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-01-16T06:10:08.850

让我有我自己的例子，因为我也有同样的问题（希望这个例子对其他人有帮助）：

我的`Find`方法是`Expression<Func<T, bool>>` 作为谓词并`List<T>`作为输出给出的通用方法。
我想找到国家，但如果语言列表为空，我需要所有国家，如果语言列表已填满，我需要过滤列表。首先我使用的代码如下：

```
var countries= 
Find(languages.Any() 
  ? (country => languages.Contains(country.Language))
  : (country => true)); 
```

但正是我得到了错误：`there is no implicit conversion between lambda expression and lambda expression.`

问题是，我们这里只有两个 lambda 表达式，没有别的，例如，究竟是`country => true`什么？我们必须确定**至少一个 lambda 表达式**的类型。如果仅确定其中一个表达式，则将省略错误。但是为了使代码更具可读性，我提取了两个 lambda 表达式，并改用了变量，如下所示：

```
 Expression<Func<Country, bool>> getAllPredicate = country => true;
   Expression<Func<Country, bool>> getCountriesByLanguagePredicate = country => languages.Contains(country.Language);

   var countries= Find(languages.Any()
                       ? getCountriesByLanguagePredicate
                       : getAllPredicate); 
```

我强调的是，如果我只是确定了表达式的一种类型，那么错误将得到修复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-12-02T12:29:09.157

只是一个更新 - 在 C# 10 中，编译器现在可以推断[lambda 的“自然类型”](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-expressions#natural-type-of-a-lambda-expression)，前提是提供了输入类型，例如

```
var evenFilter = (int i) => i % 2 == 0; // evenFilter inferred as `Func<int, bool>` 
```

这也意味着可以推断出 0 个输入 Funcs 和 Actions：

```
var zeroInputFunc = () => 44 % 2 == 0;
var myAction = () => {Console.WriteLine("Foo");}; 
```

但是，这不起作用：

```
var filter = i => i % 2 == 0; << Error: The delegate type could not be inferred 
```

因此，现在可以做 OP 最初想做的事情，前提是至少提供了输入类型，例如

```
Func<int, bool> myPredicate = selectorFlag
    ? i => i % 2 == 0
    : i => i % 2 == 1; 
```

但是，这仍然是不允许的：

```
var myPredicate = selectorFlag
    ? (int i) => i % 2 == 0
    : (int i) => i % 2 == 1; 
```

> 错误：“lambda 表达式”和“lambda 表达式”之间没有隐式转换

# ruby-on-rails - Ruby On Rails/Merb 作为数十亿记录应用程序的前端

> ID：263175
> 
> 赞同：4
> 
> 时间：2008-11-04T19:44:16.527
> 
> 标签：ruby-on-rails, couchdb, hadoop, merb, hbase

我正在为用 Ruby on Rails 或 Merb 编写的应用程序寻找后端解决方案，以处理具有数十亿条记录的数据。我有一种感觉，我应该使用分布式模型，而此刻我看着

[HBase](http://hadoop.apache.org/hbase/)与[Hadoop](http://hadoop.apache.org/core/)

[沙发数据库](http://incubator.apache.org/couchdb/)

在我看来，HBase 解决方案存在问题——对 ruby​​ 的支持不是很强，而且 Couchdb 还没有达到 1.0 版本。

对于如此大量的数据，您有什么建议吗？

数据有时需要一次相当快的导入 30-40Mb，但导入将分批进行。因此，大约 95% 的时间数据将是只读的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T20:13:09.697

人们使用了许多不同的解决方案。根据我的经验，它实际上更多地取决于您与该数据相关的使用模式，而不是每个表的绝对行数。

例如，“每秒发生了多少次插入/更新”。诸如此类的问题将影响您决定选择哪种后端数据库解决方案。

以 Google 为例：实际上并不存在满足他们需求的存储/搜索解决方案，因此他们基于 Map/Reduce 模型创建了自己的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T22:16:19.820

根据您的实际数据使用情况，MySQL 或 Postgres 应该能够在正确的硬件上处理数十亿条记录。如果您有特别大量的请求，这两个数据库都可以跨多个服务器复制（并且读取复制非常容易设置（与多个主/写复制相比）。

将 RDBMS 与 Rails 或 Merb 一起使用的最大优势是您可以访问所有出色的工具支持来访问这些类型的数据库。

我的建议是在其中几个系统中实际分析您的数据并从那里获取。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-01T22:34:51.780

关于 HBase 和其他类似项目的警告（对 CouchDB 一无所知——我*认为*它根本不是一个数据库，只是一个键值存储）：

1.  Hbase 没有针对速度进行调整；它针对可扩展性进行了调整。如果响应速度完全是个问题，请在采用此路径之前运行一些概念验证。
2.  Hbase 不支持连接。如果您正在使用 ActiveRecord 并且有多个关系.. 那么您可以看到这是怎么回事。

Hive 项目也建立在 Hadoop 之上，确实支持连接；Pig也是如此（但它不是真正的sql）。第 1 点适用于两者。它们适用于繁重的数据处理任务，而不是您可能使用 Rails 进行的处理类型。

如果您想要 Web 应用程序的可扩展性，基本上唯一可行的策略是对数据进行分区并尽可能确保分区是隔离的（不需要相互通信）。这对 Rails 来说有点棘手，因为它默认假设有一个中央数据库。自从我大约一年半前研究这个问题以来，这方面可能已经有所改进。如果您可以对数据进行分区，则可以水平扩展相当宽的范围。一台 MySQL 机器可以处理几百万行（PostgreSQL 可能可以扩展到更多的行，但可能会慢一些）。

另一种可行的策略是设置主从设置，其中所有写入都由主控完成，读取在从属（可能还有主控）之间共享。显然，这必须相当小心地完成！假设读/写比率很高，这可以很好地扩展。

如果您的组织财力雄厚，请查看 Vertica、AsterData 和 Greenplum 提供的服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T20:20:03.940

后端将取决于数据以及如何访问数据。

但是对于 ORM，我很可能会使用 DataMapper 并编写一个自定义 DataObjects 适配器来访问您选择的任何后端。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T19:35:10.890

我不确定 CouchDB 不在 1.0 与它有什么关系。我建议用它做一些测试（只生成十亿个随机文档），看看它是否能坚持下去。我会说它会，尽管没有特定的版本号。

在分区/分片数据方面，CouchDB 将为您提供很多帮助，似乎它可能适合您的项目 - 特别是如果您的数据格式将来可能会更改（添加或删除字段），因为 CouchDB 数据库没有架构.

CouchDB 中也有很多针对读取量大的应用程序的优化，根据我的使用经验，这就是它真正闪耀的地方。

# asp.net - .net http 处理程序重定向到 rtmp 和 flex

> ID：263181
> 
> 赞同：5
> 
> 时间：2008-11-04T19:46:00.517
> 
> 标签：asp.net, .net, apache-flex, httphandler, rtmp

我有一个`http handler`( `.ashx`)，用于根据 id 显示图像或 swf 或 flv。因此，例如[http://www.example.com/myHandler.ashx?id=1234](http://www.example.com/myHandler.ashx?id=1234)它显示 id 1234 的图像。我将其用作图像标签或 swf 加载器或 flex 中的视频显示的来源。在我的处理程序中，如果项目是视频，我只需将请求重定向到渐进式下载视频的 http 地址（`flv`）。这很好用。但是，如果**我想使用 rtmp 协议将请求重定向到流媒体服务器**，它不会做任何事情。有什么想法吗？是否甚至可以重定向到 http 地址以外的任何地方？

我也有`weborb`dot net 可用，它显然有 rtmp 隧道可用。是否可以以这种方式设置请求？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2015-08-10T05:07:41.707

[http://www.example.com/myHandler.ashx?id=1234](http://www.example.com/myHandler.ashx?id=1234)

使用 Querysting 获取 id 并使用 get 存储过程来检索图像并返回..稍后在图像 src 中分配该返回路径

# c# - 在 C# 中，我应该使用 string.Empty 或 String.Empty 还是 "" 来初始化字符串？

> ID：263191
> 
> 赞同：756
> 
> 时间：2008-11-04T19:49:02.973
> 
> 标签：c#, .net, string, initialization

在 C# 中，我想用一个空字符串初始化一个字符串值。

我该怎么做？什么是正确的方法，为什么？

```
string willi = string.Empty; 
```

或者

```
string willi = String.Empty; 
```

或者

```
string willi = ""; 
```

要不然是啥？

* * *

## 回答 #1

> 赞同：856
> 
> 时间：2008-11-04T20:07:39.567

**使用您和您的团队认为最易读的任何内容。**

其他答案建议每次使用时都会创建一个新字符串`""`。这不是真的 - 由于字符串实习，它将在每个程序集或每个 AppDomain 中创建一次（或者可能在整个过程中创建一次 - 在这方面不确定）。这种差异可以忽略不计 - 非常大，非常*微不足道*。

但是，您发现哪个更具可读性是另一回事。这是主观的，并且会因人而异——所以我建议你找出团队中大多数人喜欢的东西，然后为了保持一致。我个人觉得`""`更容易阅读。

很容易被误认为彼此的论点`""`并没有真正与我相提并论。`" "`除非您使用的是比例字体（而且我没有与*任何*这样做的开发人员合作过），否则很容易区分。

* * *

## 回答 #2

> 赞同：386
> 
> 时间：2009-10-19T13:31:16.547

从性能和代码生成的角度来看，确实没有区别。在性能测试中，他们在哪一个比另一个更快之间来回切换，而且只有几毫秒。

在查看幕后代码时，您也真的看不出任何区别。唯一的区别在于 IL，它`string.Empty`使用 opcode`ldsfld` 和`""`使用 opcode `ldstr`，但这只是因为`string.Empty`它是静态的，并且两条指令都做同样的事情。如果您查看生产的组件，它是完全相同的。

## C# 代码

```
private void Test1()
{
    string test1 = string.Empty;    
    string test11 = test1;
}

private void Test2()
{
    string test2 = "";    
    string test22 = test2;
} 
```

## IL代码

```
.method private hidebysig instance void 
          Test1() cil managed
{
  // Code size       10 (0xa)
  .maxstack  1
  .locals init ([0] string test1,
                [1] string test11)
  IL_0000:  nop
  IL_0001:  ldsfld     string [mscorlib]System.String::Empty
  IL_0006:  stloc.0
  IL_0007:  ldloc.0
  IL_0008:  stloc.1
  IL_0009:  ret
} // end of method Form1::Test1 
```

```
.method private hidebysig instance void 
        Test2() cil managed
{
  // Code size       10 (0xa)
  .maxstack  1
  .locals init ([0] string test2,
                [1] string test22)
  IL_0000:  nop
  IL_0001:  ldstr      ""
  IL_0006:  stloc.0
  IL_0007:  ldloc.0
  IL_0008:  stloc.1
  IL_0009:  ret
} // end of method Form1::Test2 
```

## 汇编代码

```
 string test1 = string.Empty;
0000003a  mov         eax,dword ptr ds:[022A102Ch] 
0000003f  mov         dword ptr [ebp-40h],eax 

        string test11 = test1;
00000042  mov         eax,dword ptr [ebp-40h] 
00000045  mov         dword ptr [ebp-44h],eax 
```

```
 string test2 = "";
0000003a  mov         eax,dword ptr ds:[022A202Ch] 
00000040  mov         dword ptr [ebp-40h],eax 

        string test22 = test2;
00000043  mov         eax,dword ptr [ebp-40h] 
00000046  mov         dword ptr [ebp-44h],eax 
```

* * *

## 回答 #3

> 赞同：88
> 
> 时间：2008-11-04T20:04:34.440

[最好的代码是完全没有代码](http://www.codinghorror.com/blog/archives/000878.html)：

> 编码的基本性质是，作为程序员，我们的任务是认识到我们做出的每一个决定都是一种权衡。[…]**从简洁开始。根据测试要求增加其他尺寸。**

因此，更少的代码就是更好的代码：`""`首选`string.Empty`or `String.Empty`。这两个**时间长了六倍**，没有额外的好处——当然也没有增加清晰度，因为它们表达了完全相同的信息。

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2011-08-26T08:58:10.727

一个区别是，如果你使用一种`switch-case`语法，你就不能写`case string.Empty:`，因为它不是一个常数。你得到一个`Compilation error : A constant value is expected`

查看此链接以获取更多信息： [string-empty-versus-empty-quotes](http://web.archive.org/web/20131230161806/http://kossovsky.net/index.php/2009/06/string-empty-versus-empty-quotes/)

* * *

## 回答 #5

> 赞同：46
> 
> 时间：2008-11-04T19:52:38.380

我宁愿`string`. `String`选择是选择一个并坚持下去的问题`string.Empty`。`""`使用的好处`string.Empty`是你的意思很明显，而且你不会意外复制不可打印的字符，比如`"\x003"`.`""`

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-11-04T20:07:08.307

我不打算插话，但我看到一些错误的信息被扔在这里。

我个人更喜欢`string.Empty`. 这是个人喜好，我会根据具体情况服从与我合作的任何团队的意愿。

`string.Empty`正如其他一些人所提到的，和之间根本没有区别`String.Empty`。

此外，这是一个鲜为人知的事实，使用 "" 是完全可以接受的。在其他环境中，每个 "" 实例都会创建一个对象。但是，.NET 实习其字符串，因此未来的实例将从实习池中提取相同的不可变字符串，任何性能影响都可以忽略不计。资料来源：[布拉德艾布拉姆斯](http://blogs.msdn.com/brada/archive/2003/04/22/49997.aspx)。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2008-11-04T19:50:51.787

我个人更喜欢“”，除非有充分的理由来处理更复杂的事情。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2008-11-04T19:53:07.430

`String.Empty`并且`string.Empty`是等价的。`String`是 BCL 类名；`string`是它的 C# 别名（或快捷方式，如果你愿意的话）。与`Int32`和相同`int`。有关更多示例，请参阅[文档](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/built-in-types-table)。

就`""`目前而言，我不太确定。

就个人而言，我总是使用`string.Empty`.

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2016-10-12T12:37:37.747

我在 .NET v4.5 控制台应用程序中使用以下方法执行了一个简单的测试：

```
private static void CompareStringConstants()
{
    string str1 = "";
    string str2 = string.Empty;
    string str3 = String.Empty;
    Console.WriteLine(object.ReferenceEquals(str1, str2)); //prints True
    Console.WriteLine(object.ReferenceEquals(str2, str3)); //prints True
} 
```

这表明所有三个变量`str1`，尽管使用不同的语法进行初始化`str2`，`str3`但都指向内存中的相同字符串（零长度）对象。

所以在内部他们没有区别。这一切都归结为您或您的团队想要使用哪一个的便利性。字符串类的这种行为在 .NET Framework 中称为**字符串实习。**Eric Lippert 有一个非常好的博客[在这里](https://blogs.msdn.microsoft.com/ericlippert/2009/09/28/string-interning-and-string-empty/)描述了这个概念。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2009-05-31T19:34:43.447

几乎每个开发人员都会知道“”是什么意思。我个人第一次遇到 String.Empty 并且不得不花一些时间搜索谷歌以确定它们是否真的*是*完全相同的东西。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2016-04-29T21:09:27.863

这个话题很老很长，所以如果在其他地方提到过这种行为，请原谅。（并指出涵盖此的答案）

`string.Empty`如果您使用双引号，我发现编译器的行为有所不同。如果您不使用使用 string.Empty 或双引号初始化的字符串变量，差异就会显现出来。

`string.Empty`如果使用编译器警告进行初始化

```
CS0219 - The variable 'x' is assigned but its value is never used 
```

永远不会发出，而在使用双引号进行初始化的情况下，您会收到预期的消息。

此行为在此链接的 Connect 文章中进行了解释：[https ://connect.microsoft.com/VisualStudio/feedback/details/799810/c-warning-cs0219-not-reported-when-assign-non-constant-value](https://connect.microsoft.com/VisualStudio/feedback/details/799810/c-warning-cs0219-not-reported-when-assign-non-constant-value)

基本上，如果我做对了，他们希望允许程序员使用函数的返回值设置一个变量以用于调试目的，而不会用警告消息打扰他，因此他们仅在成本分配和字符串的情况下限制警告。空不是一个常数，而是一个字段。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2008-11-04T19:50:53.453

以上任何一种。

有很多很多更好的事情要赞美。比如什么颜色的树皮最适合一棵树，我认为是模糊的棕色，带有淡淡的苔藓色。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2009-01-22T17:03:09.630

我非常喜欢 String.Empty，除了其他原因以确保您知道它是什么并且您没有意外删除内容，但主要是为了国际化。如果我看到引号中的字符串，那么我总是想知道这是否是新代码，是否应该将其放入字符串表中。因此，每次更改/审查代码时，您都需要查找“引号中的内容”，是的，您可以过滤掉空字符串，但我告诉人们最好不要将字符串放在引号中，除非您知道它不会被本地化.

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2012-05-24T16:16:36.840

没有人提到在 VisualStudio 中字符串的颜色编码与字符串不同。这对于可读性很重要。此外，小写通常用于 vars 和 type，没什么大不了的，但 String.Empty 是一个常量，而不是 var 或类型。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-11-04T20:00:50.487

`string`是`System.String`类型的同义词，它们是相同的。

值也相同：`string.Empty == String.Empty == ""`

我不会在代码中使用字符常量“”，而是`string.Empty`更`String.Empty`容易理解程序员的意思。

之间`string`，`String`我更喜欢小写`string`，因为我曾经使用 Delphi 多年，而 Delphi 风格是小写的`string`。

所以，如果我是你的老板，你会写`string.Empty`

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2015-06-10T14:13:14.083

我会赞成`string.Empty`，`String.Empty`因为您可以使用它而无需`using System;`在文件中包含 a 。

至于挑选`""`，`string.Empty`这是个人喜好，应该由你的团队决定。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2008-11-04T19:52:56.523

我没有区别。最后一个是最快的输入虽然:)

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2010-08-31T21:52:36.813

它完全是一种代码风格的偏好，对 .NET 如何处理字符串。但是，这是我的意见:)

在访问静态方法、属性和字段时，我总是使用 BCL 类型名称：`String.Empty`或`Int32.TryParse(...)`或`Double.Epsilon`

在声明新实例时，我总是使用 C# 关键字：`int i = 0;`或`string foo = "bar";`

我很少使用未声明的字符串文字，因为我希望能够扫描代码以将它们组合成可重用的命名常量。无论如何，编译器都会用文字替换常量，因此这更像是一种避免魔术字符串/数字并用名称赋予它们更多意义的方法。此外，更改值更容易。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2008-11-04T20:01:25.087

没关系——它们是完全一样的。但是，最重要的是你**必须保持一致**

ps 我一直在为这种“什么是正确的事情”而苦苦挣扎。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2017-05-18T15:44:15.853

我亲眼目睹了两次“”导致（小）问题。一次是由于刚接触基于团队的编程的初级开发人员的错误，另一个是一个简单的错字，但事实是使用 string.Empty 可以避免这两个问题。

是的，这在很大程度上是一种判断调用，但是当一种语言为您提供多种做事方式时，我倾向于倾向于编译器监督最多且编译时执行力最强的语言。那*不是*“”。这一切都是为了表达特定的意图。

如果您键入 string.EMpty 或 Strng.Empty，编译器会让您知道您做错了。立即地。它根本不会编译。作为开发人员，您引用了编译器（或其他开发人员）不能以任何方式误解的*特定意图，并且当您做错时，您无法创建错误。*

如果您输入“”，而您的意思是“”，反之亦然，编译器会愉快地执行您告诉它的操作。其他开发人员可能也可能无法收集您的特定意图。已创建错误。

早在 string.Empty 出现之前，我就使用了定义 EMPTY_STRING 常量的标准库。在不允许 string.Empty 的 case 语句中，我们仍然使用该常量。

只要有可能，让编译器为您工作，并消除人为错误的可能性，无论多么小。IMO，正如其他人所引用的那样，这胜过“可读性”。

特异性和编译时执行。这是晚饭吃的。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-11-04T19:51:36.293

我使用第三个，但在其他两个中，第一个似乎不那么奇怪。string 是 String 的别名，但在作业中看到它们会让人感觉不舒服。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2008-11-04T19:55:19.873

前两个中的任何一个对我来说都是可以接受的。我会避免使用最后一个，因为通过在引号之间放置一个空格相对容易引入错误。通过观察很难找到这个特殊的错误。假设没有错别字，所有在语义上都是等价的。

[编辑]

此外，您可能希望始终使用其中一个`string`或`String`以保持一致性，但这只是我。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2017-05-24T17:14:22.373

我使用 "" 是因为它在我的代码中会被显着地染成黄色......由于某种原因，String.Empty 在我的 Visual Studio Code 主题中全是白色的。我相信这对我来说最重要。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-11-04T19:52:02.143

从长远来看，编译器应该使它们都相同。选择一个标准，以便您的代码易于阅读，并坚持下去。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2017-01-10T16:11:03.353

我只是在看一些代码，这个问题突然出现在我的脑海中，我之前读过一段时间。这当然是可读性的问题。

考虑以下 C# 代码...

```
(customer == null) ? "" : customer.Name 
```

对比

```
(customer == null) ? string.empty : customer.Name 
```

我个人觉得后者不那么模棱两可，更容易阅读。

正如其他人指出的那样，实际差异可以忽略不计。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-11-04T19:52:04.340

我认为第二个是“适当的”，但老实说，我认为这并不重要。编译器应该足够聪明，可以将其中的任何一个编译成完全相同的字节码。我自己使用“”。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-11-05T07:12:38.837

虽然差异非常非常小，但差异仍然存在。

1) "" 创建对象，而 String.Empty 没有。但是这个对象将被创建一次，如果你在代码中有另一个“”，稍后将从字符串池中引用。

2）字符串和字符串是相同的，但我建议使用 String.Empty（以及 String.Format、String.Copy 等），因为点表示法表示类，而不是运算符，并且类以大写字母开头符合C# 编码标准。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2011-11-16T02:28:27.170

在[http://blogs.msdn.com/b/brada/archive/2003/04/22/49997.aspx](http://blogs.msdn.com/b/brada/archive/2003/04/22/49997.aspx)上：

> 正如大卫暗示的那样， 和 之间的差异`String.Empty`非常`""`小，但还是有区别的。`""`实际上创建了一个对象，它很可能会被从字符串实习生池中拉出来，但仍然......虽然`String.Empty`没有创建任何对象......所以如果你真的在寻找最终的内存效率，我建议`String.Empty`。但是，您应该记住，差异是如此微不足道，您将永远不会在您的代码中看到它......
> 至于`System.String.Empty`或`string.Empty`或`String.Empty`......我的关心水平很低;-)

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-12-10T19:44:57.500

空字符串就像空集只是每个人都用来调用的名称`""`。同样在正式语言中，从长度为零的字母表创建的字符串称为空字符串。set 和 string 都有一个特殊的符号。空字符串：ε 和空集：∅。如果你想谈论这个零长度的字符串，你会称它为空字符串，这样每个人都知道你指的是什么。现在，如果您将其命名为为什么不在`string.Empty`代码中使用的空字符串，则表明意图是明确的。缺点是它不是一个常数，因此并非在任何地方都可用，比如在属性中。（由于某些技术原因，它不是一个常数，请参阅参考资料。）

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-04-05T14:54:33.640

可能是一个有争议的评论，但总的来说，我发现当我与 Microsoft 保持一致时，我的生活会更轻松。我们不可能知道他们为什么做事的全部深层原因（有时非常严格，有时很笨拙，我想）。

他们在自动生成的文件（如程序集文件）中使用“”，这就是我所做的。事实上，当我尝试用 String.Empty 替换 "" 以下的任何内容时，Visual Studio 崩溃了。对此可能有一个合乎逻辑的解释，但以我有限的知识，如果我只是按照他们所做的那样做，大多数情况下，事情都会解决。（相反：我知道他们一些自动生成的文件也使用 String.Empty，这打破了我的观点。:)）

```
<Assembly: System.Reflection.AssemblyCulture("")>
<Assembly: System.Reflection.AssemblyDescription("")>
<Assembly: System.Reflection.AssemblyFileVersion("1.0.0.0")>
<Assembly: System.Reflection.AssemblyKeyFile("")>
<Assembly: System.Reflection.AssemblyProduct("")>
<Assembly: System.Reflection.AssemblyTitle("")> 
```

# linux - 在 Ubuntu 中使用 ./ 运行二进制文件

> ID：263202
> 
> 赞同：4
> 
> 时间：2008-11-04T19:51:54.933
> 
> 标签：linux

我决定学习[C++](http://en.wikipedia.org/wiki/C++)（我在工作中使用[C](http://en.wikipedia.org/wiki/C_%28programming_language%29)编程），并且我一直在阅读一些教程（以及 Stack Overflow 上的很多帖子）。好的，所以我输入了标准 C++“hello word”，在我的[Ubuntu机器上用](http://en.wikipedia.org/wiki/Ubuntu_%28operating_system%29)[GCC](http://en.wikipedia.org/wiki/GNU_Compiler_Collection)编译为“test”。

然后我尝试通过键入“test”并按回车键来运行它。没有。事实证明我必须用“./test”运行它。好的，好的，从现在开始我会这样做。但为什么？“./”只是说我应该在当前目录中运行......当[操作系统](http://en.wikipedia.org/wiki/Operating_system)正在搜索要运行的东西时，当前目录是否不总是 PATH 的一部分？我能做到吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-04T19:56:44.770

是的，当前目录不是您的 PATH 的一部分。您不希望这样，因为您可能在一个目录中，其中包含您不知道您运行的恶意程序。

如果你习惯于运行 /usr/bin/grep，但你碰巧在一个坏人将 grep 的恶意副本放入的目录中，这次你运行 grep，而你正在运行 grep当前目录，而不是 /usr/bin/grep。

您当然可以在 ~/.profile 或 ~/.bash_profile 中将 ./ 添加到 PATH 中，但我不推荐这样做。

如果它让你感觉好些，我在 15 年前开始使用类 Unix 系统时也有同样的挫败感。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-04T19:55:25.630

你可以加 ”。” 到你的 PATH，但在这种情况下这对你没有帮助 - “测试”是一个内置的 shell。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-04T19:56:39.323

不幸的是，有一个名为“test”的Unix命令......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-04T20:08:26.790

如果有一个您经常运行的命令行脚本，您可以设置一个[命令行别名](http://blog.geekblake.22web.net/2008/07/how-to-make-time-saving-command-line-aliases/)来摆脱每次输入 ./ 的需要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-04T20:55:50.453

即使当前目录位于 $PATH 的最开始，'test' 仍然不会在（大多数？）shell 上运行它，因为 'test' 是 shell 内置命令。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T19:55:19.780

没有 '。' PATH 中的（当前目录）是一个次要的安全措施。如果您愿意，您可以随时添加它，尽管这不是最佳实践。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-04T20:06:37.697

如果不清楚，这是 Windows 与 Unix/Linux 不同的一个方面。在 Windows 上，当前目录隐含在路径中。

# excel - 使用 Excel 进行字符串操作 - 如果存在另一部分，如何删除字符串的一部分？

> ID：263225
> 
> 赞同：7
> 
> 时间：2008-11-04T19:57:58.120
> 
> 标签：excel, vba, string, worksheet-function

我做了一些谷歌搜索，但找不到任何东西，但也许我只是在寻找错误的地方。我也不太擅长 VBA，但我相信我可以用正确的指针来解决它:)

我有一个我正在构建的字符串，它是基于各种条件的各种单元格的串联。我按顺序打了这些。

```
=IF(A405<>A404,G405,G405&H404) 
```

我想要做的是返回我的串联列表，如果取代者在列表中，则删除被取代的值。

例如，请参阅以下列表：

```
A, D, G, Y, Z 
```

`D` *当*且**仅** *当* `Y`存在时，我想删除。

我该怎么办？（VBA 或 in-cell，虽然我更喜欢 in-cell）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T20:36:58.807

尝试：

```
=IF(ISERROR(FIND("Y",A1)),A1,SUBSTITUTE(A1,"D, ","")) 
```

但这假设你总是在 D 后面有逗号和空格。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T20:06:28.027

首先，为什么不在遍历所有单元格时保留一个字符串数组，然后在最后将它们全部连接起来？

否则，您将使用 INSTR 和 MID 等字符串函数来执行以下操作：

```
start1 = instr(myLongString,"Y, ")
if start1 > 0 Then
    start2 = instr(myLongString,"D, ")
    if start2 > 0 then
        newLongString = left(myLongString, start2 - 1) & _
                        mid(myLongString, start2 + 3)
    end if
end if 
```

但是，正如我所说，我会保留一个易于循环的数组，然后一旦您拥有所有您知道将使用的值，只需在最后将它们连接起来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T07:00:08.783

**VBA**：您始终可以使用 regexp 对象。我认为只要您正确构建正则表达式，您就可以在脚本上测试任何内容。

查看： http: [//msdn.microsoft.com/en-us/library/yab2dx62](http://msdn.microsoft.com/en-us/library/yab2dx62(VS.85).aspx "用于正则表达式参考") (VS.85).aspx（用于正则表达式参考）
和一个简单的工具来测试您的正则表达式：http: [//www.codehouse.com /webmaster_tools/正则表达式/](http://www.codehouse.com/webmaster_tools/regex/)

**单元格内**：您可以以更友好的方式进行操作：
假设在 A:A 列上您有值。
您可以添加一个新列来执行检查
`if(indirect("A"&row()) <> indirect("A"&row()-1), indirect("G"&row()), indirect("G"&row())& indirect("H"&row()))`
或任何值。然而，我猜想在 if 语句的一个分支上，值应该是空白的。之后，您只连接 B:B 列值（如果需要，可以跳过空格）。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T20:04:24.333

从末尾开始可能更容易，在字符串的开头添加，并且仅在 Y 不存在时才添加 D。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T20:15:30.987

我猜 D 可能出现在任何地方，那么如何：

```
If InStr(strString, "Y") > 0 Then
   strString = Replace(strString, "d", "")
   strString = Replace(strString, "  ", "")
   strString = Replace(strString, " ,", "")
   strString = Replace(strString, ",,", ",")
End If 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T20:48:12.573

我也刚刚通过电子邮件将此作为可能的解决方案：

```
=IF(A15<>A14,G15,IF(OR(AND(G15="CR247, ",ISNUMBER(FIND("CR247, ",H14))),AND(G15="CR149, ",ISNUMBER(FIND("CR215, ",H14))),AND(G15="CR149, ",ISNUMBER(FIND("CR180, ",H14))),AND(G15="CR180, ",ISNUMBER(FIND("CR215, ",H14))),G15="CR113, "),H14,G15&H14)) 
```

（这具有优先规则的“真实”值）

[它看起来与@Joseph](https://stackoverflow.com/questions/263225/string-manipulation-with-excel-how-to-remove-part-of-a-string-if-another-part-i#263335)的答案比较相似。

有更好的解决方案吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-04T21:37:20.573

如果要删除的这些组合不多，可以使用 =IF(FIND("D"; A2)> 0; REPLACE(A2;1;3;"");A2)。

# c++ - 为什么 Boost 库返回“可转换为 `bool`”的东西，而不仅仅是返回 `bool`s？

> ID：263227
> 
> 赞同：6
> 
> 时间：2008-11-04T19:59:39.380
> 
> 标签：c++, boost

有几次，在阅读 Boost 库的文档时，我遇到了标记为“[可转换为`bool`](http://www.boost.org/doc/libs/1_36_0/libs/utility/Collection.html)”的返回值（在该页面中搜索短语“可转换为布尔”，它大约下降了三分之一）。我曾经偶然发现对一篇解释其原因的论文的倾斜引用，但从未能够找到该论文（而且我再也找不到我在其中看到引用的页面）。

谁能解释为什么（以及何时）您应该返回“可转换为`bool`”的东西，而不是简单地返回 a `bool`？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-04T20:26:52.400

“可转换为布尔值”仅表示可以在布尔上下文中有意义地使用的任何内容（例如，在`if`条件中）。这在隐式转换中是有意义的。想象一个您想在布尔上下文中使用的对象，例如`std::fstream`：

```
ifstream ifs("filename");
while (ifs >> token)
    cout "token " << token << " read." << endl; 
```

在这里，`ifs`可转换为布尔值。嗯，实际上，它不是。相反，它可以转换为可以转换为 的东西`bool`。这是为了防止这样的陈述：

```
int b = ifs; 
```

原因是这样的声明很可能不是有意的，因此编译器应该阻止它。通过返回“convertible to bool”而不是 a `bool`，这是因为两个用户定义的隐式转换不能链接在一个表达式中。

在这种情况下，您可能需要查找[安全 bool idiom](http://www.artima.com/cppsource/safebool.html)。Chris 已经提到了一种可能的实现，将`void*`其用作返回类型。通常，`this`然后使用指针来表示`true`。这就是 STL 使用的内容。然而，不幸的是，这仍然存在缺陷。已经提出了几种替代方案（在我上面链接的文章中整齐地包装），据我所知，它们也已包含在 C++0x 中以供考虑。不过，我不知道这些提案的当前状态。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-04T20:25:27.783

`bool`s 可升级为`int`s 并且可以参与算术运算。这通常不是期望的结果，当一个值应该只用于真值测试时。

convertible-to-`bool`通常类似于 a `void*`，其中空指针为假，其他任何东西都为真，但不能用于算术运算。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T20:17:13.213

也许是为了表演？在 C/C++ 中，您可以对数字执行 if 语句（0 为假，其他为真）。转换为严格的布尔值是一个额外的操作，在许多情况下不需要。

我实际上并没有使用过boost，所以这只是一个猜测，但对我来说似乎是一个合理的选择。

# apache-flex - .war 文件中需要包含哪些内容才能部署 Flex 应用程序？

> ID：263228
> 
> 赞同：1
> 
> 时间：2008-11-04T19:59:52.297
> 
> 标签：apache-flex, ant, flexbuilder

我一直在使用 Flex Builder 3 创建 Flex 应用程序，这些应用程序是使用 LiveCycle Data Services 的大型 Flex / Java 项目的一部分。Flex Builder 创建和部署 .war 文件，这对开发周期很方便，但我不明白 .war 文件必须包含什么才能部署和运行。

我通过反复试验发现，更改 Flex 项目的某些属性（即上下文根）可能会破坏或修复应用程序，并且这些设置会以某种方式进入 .war 文件。

我需要在 Ant 下实现整个构建过程，更重要的是，我需要了解项目的 Flex 部分依赖于什么。但是，我还没有找到任何描述 .war 文件必须包含哪些内容才能部署 Flex / Java 应用程序的文档。

例如，Flex Builder 创建一个 web.xml 文件并用正确的标签填充它。但是如果我添加其他功能，是否需要在 web.xml 中添加额外的标签？

有谁知道我在哪里可以找到有关 Flex/Java 项目的 .war 文件内容的文档？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T06:53:15.773

在此处查看示例应用程序：

[http://livedocs.adobe.com/livecycle/8.2/programLC/programmer/lcds/help.html?content=build_apps_3.html](http://livedocs.adobe.com/livecycle/8.2/programLC/programmer/lcds/help.html?content=build_apps_3.html)

这些应用程序将使您对 WAR 中需要进行的操作有所了解。简而言之，标准 WAR 中有四个重要位置，而使用 LCDS 或 Blaze DS 的 WAR 中还有一个重要位置：

```
myapp.war/
  WEB-INF/    <-- not accessible via the browser over HTTP
    classes/  <-- compiled classes and configuration files (this is where your .class files and jdbc.properties would go)
    flex/     <-- LCDS XML config files (services-config.xml)
    lib/      <-- web application libraries (.jar files, for LCDS and other tools you might be using)
    web.xml   <-- web application configuration 
```

Flex 应用程序本身可能位于 myapp.war 的根目录或您选择的任何子目录中，除了 WEB-INF。

但是，如果您研究示例应用程序并让您的 Ant 脚本构建与您在其中看到的相同的结构，那么您应该不会遇到太多问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-06T18:39:04.770

我对 LiveCycle Data Services 一无所知，所以这可能是个问题。但是，我有一个与 java 服务器交互的 flex 应用程序，除了您对其他静态内容所做的事情之外，我真的不需要为 flex 做任何特别的事情。

具体来说，我将我的 flex 项目属性 ~ Flex Build Path ~ Output 文件夹设置为 java webapp 中的 /flash 文件夹，而 ant 处理其他所有事情（编译 java 文件、组装类文件、添加 web.xml 和打开文件进入战争）。

另一种方法，取决于 adobe 如何处理生命周期，是让 ant 只调用 flex builder 通过的任何命令来输出战争。

# .net - DateTime.UtcNow.Ticks 有时会跳跃很多

> ID：263229
> 
> 赞同：2
> 
> 时间：2008-11-04T20:00:44.340
> 
> 标签：.net, windows, datetime, time

在打印出 的值的紧密循环的测试应用程序中`DateTime.UtcNow.Ticks`，我注意到该值将每隔一小时左右跳跃一次。仔细查看以下示例数据：

```
1:52:14.312 PM - 633614215343125000
1:52:14.359 PM - 633614215343593750
1:52:14.421 PM - 633614215344218750
1:52:14.468 PM - 633614215344687500
1:52:14.515 PM - 633614215998593750 <-- WAY different 
```

增量为 653906250 个刻度（65.390 秒）。我能想到的唯一原因是 Windows 时间服务正在我脚下进行一些同步。

*   有没有专家可以证实这一点？
*   在大约一个小时内漂移一分钟左右对我来说似乎很糟糕，但这里是这样吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T20:42:07.877

实际上，只是用这个循环运行一些测试：

```
static DateTime past = DateTime.UtcNow;
    static void PrintTime()
    {
        while (stopLoop == 0)
        {
            DateTime now = DateTime.UtcNow;
            Console.WriteLine("{0} - {1} d: {2}", now, now.Ticks, now - past);
            Program.past = now;
            Thread.Sleep(2000);
        }
    } 
```

如果我在两次调用之间更改系统的时钟时间，增量会相应地跳跃。因此，如果您正在运行时间同步或其他影响系统时间的进程，那么这将反映在输出中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T12:46:40.160

嗯……

当您无法确定在此期间没有调用某些阻塞系统调用（例如，可能是 Console.WriteLine）时，如何以这种方式测量时间？

为了进行“工作测试”，您至少必须确保：

*   你的机器上没有其他东西在运行
*   进程/线程优先级设置为高或类似的东西
*   调用 NO 系统调用...只执行计算任务
*   将线程关联设置到特定 CPU，这样您就不会在 CPU 之间切换

即使您这样做，操作系统也会不时地（例如，在 Windows 双核桌面操作系统上为 15 毫秒）抢占您的线程……而且您仍然可以肯定地在 UTC 时间中看到那种“跳跃”-邮票。

只是从用户空间到内核空间（在抢占/系统调用期间）然后返回，而不做任何实质性的内核工作，将需要大约 1000 个 CPU 周期......

如果您的进程进入等待状态（通过调用一些阻塞 IO），它甚至可能会更糟......

所以我真的没有得到你的“测试”。IMO 这是完全正常的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T20:16:48.910

你能发布代码来展示你是如何生成这些数据的吗？并提供有关您正在运行它的机器的详细信息？

使用以下内容，我没有得到你所得到的。

```
 for (int i = 0; i < 10; i++)
        {

            Console.WriteLine(DateTime.Now.ToLongTimeString().ToString() + " - " + DateTime.UtcNow.Ticks.ToString());

            Thread.Sleep(10);
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T20:55:28.863

Esteban 是正确的，系统时钟更改会导致连续轮询之间的增量时间发生变化。Windows 时间服务是否每小时进行一次这些更改？有可能在一小时内漂移一分钟吗？

为了在你的机器上捕捉到这种情况，如果你在检查之间跟踪变化的变化，你可以在变化异常高的变化上设置一个条件断点。

```
long delta = 0;
long ticks = 0;
long lastTicks = DateTime.UtcNow.Ticks;
while (true)
{
    ticks = DateTime.UtcNow.Ticks;
    delta = ticks - lastTicks;
    lastTicks = ticks;
    // Conditional breakpoint: delta > 100000000 Is True
    Console.WriteLine("{0} - {1}", ticks, delta);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T21:03:08.503

原始输出被 DebugView 捕获。我的托管应用程序正在进行 ap/invoke OutputDebugString 调用，只是从一个也称为 Thread.Sleep(1) 的线程中的紧密循环中输出 DateTime.UtcNow.Ticks。

```
\\JLECOURSXP 的系统信息：
正常运行时间：6 天 6 小时 22 分 53 秒
内核版本：Microsoft Windows XP，Multiprocessor Free
产品类型：专业
产品版本：5.1
服务包：3
内核版本号：2600
注册机构：
注册拥有者：setup
安装日期：2007 年 6 月 15 日下午 3:35:29
IE版本：7.0000
系统根目录：C:\WINDOWS
处理器：2
处理器速度：2.9 GHz
处理器类型：Intel(R) Pentium(R) D CPU
物理内存：3070 MB
视频驱动程序：RADEON 9250 - 次要

```

# javascript - 判断一个元素是否有一个带有 jQ uery 的 CSS 类

> ID：263232
> 
> 赞同：175
> 
> 时间：2008-11-04T20:00:58.160
> 
> 标签：javascript, jquery, css

我正在使用 jQuery 并查看是否有一种简单的方法来确定元素是否具有与之关联的特定 CSS 类。

我有元素的 id，以及我正在寻找的 CSS 类。我只需要能够在 if 语句中根据元素上该类的存在进行比较。

* * *

## 回答 #1

> 赞同：238
> 
> 时间：2008-11-04T20:03:18.843

使用`hasClass`方法：

```
jQueryCollection.hasClass(className); 
```

或者

```
$(selector).hasClass(className); 
```

该参数（显然）是一个表示您正在检查的类的字符串，它返回一个布尔值（因此它不像大多数 jQuery 方法那样支持链接）。

**注意：**如果您传递`className`包含空格的参数，它将与集合元素的`className`字符串逐字匹配。因此，例如，如果您有一个元素，

```
<span class="foo bar" /> 
```

那么这将返回`true`：

```
$('span').hasClass('foo bar') 
```

这些将返回`false`：

```
$('span').hasClass('bar foo')
$('span').hasClass('foo  bar') 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-04T20:04:24.550

来自[常见问题](http://docs.jquery.com/Frequently_Asked_Questions#How_do_I_test_whether_an_element_has_a_particular_class.3F)

```
elem = $("#elemid");
if (elem.is (".class")) {
   // whatever
} 
```

或者：

```
elem = $("#elemid");
if (elem.hasClass ("class")) {
   // whatever
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-02-18T02:06:54.200

至于否定，如果你想知道一个元素是否没有类，你可以简单地按照马克所说的做。

```
if (!currentPage.parent().hasClass('home')) { do what you want } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-01-10T12:04:10.650

没有 jQuery：

```
var hasclass=!!(' '+elem.className+' ').indexOf(' check_class ')+1; 
```

或者：

```
function hasClass(e,c){
    return e&&(e instanceof HTMLElement)&&!!((' '+e.className+' ').indexOf(' '+c+' ')+1);
}
/*example of usage*/
var has_class_medium=hasClass(document.getElementsByTagName('input')[0],'medium'); 
```

这比 jQuery 快得多！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-02-14T13:19:34.737

为了帮助任何登陆这里但实际上正在寻找一种 jQuery 免费方式的人：

```
element.classList.contains('your-class-name') 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-21T10:15:36.450

查看官方 jQuery FAQ 页面：

[如何测试元素是否具有特定的类](http://learn.jquery.com/using-jquery-core/faq/how-do-i-test-whether-an-element-has-a-particular-class/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-11T13:50:01.657

```
 $('.segment-name').click(function () {
    if($(this).hasClass('segment-a')){
        //class exist
    }
}); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-07-27T23:41:12.130

在我的例子中，我使用了 'is' 一个 jQuery 函数，我添加了一个带有不同 css 类的 HTML 元素，我在其中寻找一个特定的类，所以我使用了 "is" 一个很好的替代方法来检查动态添加到 html 元素的类，该元素已经有其他 css 类，这是另一个不错的选择。

**简单的例子：**

```
 <!--element html-->
 <nav class="cbp-spmenu cbp-spmenu-horizontal cbp-spmenu-bottom cbp-spmenu-open" id="menu">somethings here... </nav>

 <!--jQuery "is"-->
 $('#menu').is('.cbp-spmenu-open'); 
```

**高级示例：**

```
 <!--element html-->
    <nav class="cbp-spmenu cbp-spmenu-horizontal cbp-spmenu-bottom cbp-spmenu-open" id="menu">somethings here... </nav>

   <!--jQuery "is"-->
    if($('#menu').is('.cbp-spmenu-bottom.cbp-spmenu-open')){
       $("#menu").show();
    } 
```

# c# - .NET 最小化到托盘和最小化所需资源

> ID：263234
> 
> 赞同：8
> 
> 时间：2008-11-04T20:01:17.850
> 
> 标签：c#, .net, vb.net, visual-studio, winforms

我有一个可以最小化到系统托盘的 WinForms 应用程序（我使用的是 VB）。我使用了多篇文章中描述的“hackish”方法，利用 NotifyIcon 并使用 Form_Resize 事件。

这一切在美学上都很好，但使用的资源和内存不受影响。我希望在最小化到系统托盘时能够最小化资源，就像 Visual Studio 一样。如果您在 Visual Studio 中进行编码，内存使用量可能会上升（取决于项目大小）到 500 MB 以上，但是当将 Visual Studio 最小化到任务栏时，内存会急剧减少（我假设）是最小量.

有没有人知道如何做到这一点？

如果有人发现它相关，这里是应用程序的简短描述： 我有一个带有 ListView 的 Windows 窗体，其中包含我的 IT 部门的工作订单。该应用程序有一个“监听器”，它会在提交新的工作订单时发出通知。因此，当应用程序在系统托盘中运行时，我真正要做的就是每隔几分钟将 ListView 中的项目数与 SQL 表中的行数进行比较。

编辑：更具体地说，Windows 窗体本质上具有通过控件使用的线程和资源，当窗体不可见时（在系统托盘中），这些资源仍在使用中。我能做些什么来最小化这些资源，而不是在表单恢复时杀死所有控件并重新绘制它们。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-04T21:14:56.280

调用 MiniMizeMemory() 将进行垃圾收集，修剪进程的工作大小，然后压缩进程的堆。

```
public static void MinimizeMemory()
{
    GC.Collect(GC.MaxGeneration);
    GC.WaitForPendingFinalizers();
    SetProcessWorkingSetSize(
        Process.GetCurrentProcess().Handle,
        (UIntPtr)0xFFFFFFFF,
        (UIntPtr)0xFFFFFFFF);

    IntPtr heap = GetProcessHeap();

    if (HeapLock(heap))
    {
        try
        {
            if (HeapCompact(heap, 0) == 0)
            {
                // error condition ignored
            }
        }
        finally
        {
            HeapUnlock(heap);
        }
    }
}

[DllImport("kernel32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
internal static extern bool SetProcessWorkingSetSize(
    IntPtr process,
    UIntPtr minimumWorkingSetSize,
    UIntPtr maximumWorkingSetSize);

[DllImport("kernel32.dll", SetLastError = true)]
internal static extern IntPtr GetProcessHeap();

[DllImport("kernel32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
internal static extern bool HeapLock(IntPtr heap);

[DllImport("kernel32.dll")]
internal static extern uint HeapCompact(IntPtr heap, uint flags);

[DllImport("kernel32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
internal static extern bool HeapUnlock(IntPtr heap); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T20:23:24.887

您可能正在寻找这个函数调用：[SetProcessWorkingSetSize](http://msdn.microsoft.com/en-us/library/ms686234(VS.85).aspx)

如果您使用 -1 作为参数执行 API 调用 SetProcessWorkingSetSize，则 Windows 将立即修剪工作集。

但是，如果大部分内存仍由您尚未释放的资源占用，则最小化工作集将无济于事。这与强制垃圾收集的建议相结合可能是你最好的选择。

根据您的应用程序描述，您可能还想验证 ListView 消耗了多少内存以及数据库访问对象。我也不清楚你是如何进行这些监控数据库调用的。您可能希望将其隔离到一个单独的对象中，并避免在最小化时接触任何表单，否则程序将被迫保持控件的加载和可访问性。您可以启动一个单独的线程进行监控，并将 ListView.Count 作为参数传递。

一些资料来源：

[.NET 应用程序和工作集](http://www.ddj.com/windows/184416804)

[我的 .Net 应用程序使用多少内存？](http://www.itwriting.com/dotnetmem.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T20:09:32.793

要清理未使用的内存，请使用 GC.Collect()... 尽管您应该阅读为什么要这样做以及为什么经常使用它通常是个坏主意。

如果您指的是其他资源，则需要更具体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T22:39:44.787

虽然这是在 C# 中，但请查看源代码，它将解决您遇到的任何问题：

[http://www.codeproject.com/KB/cs/NotifyIconExample.aspx](http://www.codeproject.com/KB/cs/NotifyIconExample.aspx)

# java - 有没有好的 J2EE 值列表处理程序模式实现？

> ID：263249
> 
> 赞同：5
> 
> 时间：2008-11-04T20:05:55.313
> 
> 标签：java, design-patterns, jakarta-ee

是否有任何好的[值列表处理程序](http://java.sun.com/blueprints/corej2eepatterns/Patterns/ValueListHandler.html)实现可用？

我找到[了 valuelist](http://valuelist.sourceforge.net/)，但它似乎停滞不前......此外，我真的需要很好地控制 taglib 生成的链接，因为我需要从中调用一些 JavaScript。

目前我通过重写freemarker中的taglib并使用valuelist的后端来解决它。

有谁知道更好的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T21:14:11.320

[Core J2EE Patterns 2nd Edition](https://rads.stackoverflow.com/amzn/click/com/0131422464) recommends implementing this pattern using a wrapper for [javax.sql.RowSet](http://java.sun.com/j2se/1.5.0/docs/api/javax/sql/RowSet.html). The RowSet allows for a disconnected, scrollable ResultSet. Sun provides a tutorial for the RowSet in [chapter 5](http://java.sun.com/developer/Books/JDBCTutorial/chapter5.html) of the JDBC Tutorial.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T02:31:33.553

我们在[Display Tag上运气不错](http://displaytag.sourceforge.net/11/)

# svn - 传输@1 MB 数据后 TortoiseSVN 冻结

> ID：263263
> 
> 赞同：1
> 
> 时间：2008-11-04T20:11:13.633
> 
> 标签：svn, tortoisesvn, connectivity

我正在使用 Apache Subversion 来管理和存储大量代码。尝试在 Windows Vista 上使用 svn+ssh 和 TortoiseSVN 的标准工作机器上获取它，我发现我实际上无法一次将所有内容都下载到我的本地机器上 - 传输在大约 1 MB 后停止。我可以通过取消流程并更新不完整的工作副本来断断续续地抓住它，但这不是真正的问题。

真正的问题是，尝试合并多个代码分支需要足够的数据传输来阻塞连接，据我所知，没有恢复不完整合并这样的事情。

我不知道为什么会发生这种情况 - 为我的 Google 抓取中的其他任何人解决问题的唯一解决步骤似乎表明攻击性防病毒可能与它有关，但禁用安装在工作机器上的那个（Symantec Endpoint Protection）或命令它忽略目标目录和传输过程似乎没有任何帮助。

**有人在传输少量信息时看到 TortoiseSVN 完全停止，我可以调整什么来解决这个问题？**

我很确定它不是特定于 Vista 的，因为我的朋友在上次推出时使用他的 Windows XP 机器时遇到了完全相同的问题。

一点额外的信息：

*   TortoiseSVN 版本 1.5.5，在 32 位版本的 Vista 上的 32 位。

*   通过 SSH 1 连接到 Solaris 9 机器，运行 Subversion 1.5.3。Solaris 和 SSH 的版本不可协商，因为这是一个经过改造的旧服务器，我们非常严格地管理配置。

*   我在 Solaris 机器上四处寻找，除了系统试图对我进行 Kerberos 身份验证并失败之外，它看起来根本没有问题。该过程显然只是在等待客户端输入（在结帐过程中？），而 Tortoise 似乎没有提供正确的类型。

*   例如，从 TortoisePLink 切换到 PLink 似乎没有任何区别 - 该过程开始了，但是当它停止时，我在终端窗口中看不到任何东西。

甚至对找出这里出了什么问题的一些帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T20:43:04.537

你连接到什么服务器？在 64 位机器上为服务器运行 32 位 Windows 二进制文件时，我遇到了类似的问题。它曾经只是在重负载下停止，尤其是在进行合并时。

客户端上的 32/64 位不匹配也可能导致问题，但我没有遇到过这个特定问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-21T16:39:27.310

尝试禁用 TCP 自动调整！已知会导致 TSVN 出现问题。 [如何禁用](http://www.mydigitallife.info/2007/03/22/disable-tcp-auto-tuning-to-solve-slow-network-cannot-load-web-page-or-download-email-problems-in-vista/)

# .net - 检查 .net 中的等效共享文件夹

> ID：263267
> 
> 赞同：1
> 
> 时间：2008-11-04T20:13:43.707
> 
> 标签：.net, windows, wmi, wmi-query, shared-directory

有没有办法在.net 框架内检查两个不同的共享文件夹是否实际上指向同一个物理目录？Windows 中的目录是否具有某种唯一标识符？Google-fu 让我失望了。

（我的意思是，除了将临时文件写入一个文件并查看它是否出现在另一个文件中）

编辑：我想我已经发现了我需要的东西，感谢 Brody 让我在 System.Management 命名空间中指出了正确的方向。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T17:56:33.387

如果您不使用 WMI，则非托管调用是[NetShareEnum](http://msdn.microsoft.com/en-us/library/bb525387(VS.85).aspx)，其服务器名称为 NULL（本地计算机），级别为 502，以获取[SHARE_INFO_502](http://msdn.microsoft.com/en-us/library/bb525410(VS.85).aspx)结构。本地路径在 shi502_path 中。

[P/Invoke info](http://www.pinvoke.net/default.aspx/netapi32/NetShareEnum.html)一如既往地在 pinvoke.net 结束。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T03:33:22.273

您可以使用 System.Management 命名空间检查共享定义本身，但使用起来并不容易。

它开始像

```
ManagementClass management = new ManagementClass("\\\\.\\root\\cimv2", "Win32_Share", null) 
```

在那之后情况变得更糟。我用它来创建共享。希望您可以将其用于每个共享的路径并进行比较。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T09:06:37.840

我认为 .NET 框架没有提供比较 2 个目录所需的信息……您必须采用非托管方法。我是这样做的：

```
class Program
{
    struct BY_HANDLE_FILE_INFORMATION
    {
        public uint FileAttributes;
        public System.Runtime.InteropServices.ComTypes.FILETIME CreationTime;
        public System.Runtime.InteropServices.ComTypes.FILETIME LastAccessTime;
        public System.Runtime.InteropServices.ComTypes.FILETIME LastWriteTime;
        public uint VolumeSerialNumber;
        public uint FileSizeHigh;
        public uint FileSizeLow;
        public uint NumberOfLinks;
        public uint FileIndexHigh;
        public uint FileIndexLow;
    }

    //
    // CreateFile constants
    //
    const uint FILE_SHARE_READ = 0x00000001;
    const uint FILE_SHARE_WRITE = 0x00000002;
    const uint FILE_SHARE_DELETE = 0x00000004;
    const uint OPEN_EXISTING = 3;

    const uint GENERIC_READ = (0x80000000);
    const uint GENERIC_WRITE = (0x40000000);

    const uint FILE_FLAG_NO_BUFFERING = 0x20000000;
    const uint FILE_READ_ATTRIBUTES = (0x0080);
    const uint FILE_WRITE_ATTRIBUTES = 0x0100;
    const uint ERROR_INSUFFICIENT_BUFFER = 122;
    const uint FILE_FLAG_BACKUP_SEMANTICS = 0x02000000;

    [DllImport("kernel32.dll", SetLastError = true)]
    static extern IntPtr CreateFile(
        string lpFileName,
        uint dwDesiredAccess,
        uint dwShareMode,
        IntPtr lpSecurityAttributes,
        uint dwCreationDisposition,
        uint dwFlagsAndAttributes,
        IntPtr hTemplateFile);

    [DllImport("kernel32.dll", SetLastError = true)]
    static extern bool GetFileInformationByHandle(IntPtr hFile, out BY_HANDLE_FILE_INFORMATION lpFileInformation);

    static void Main(string[] args)
    {
        string dir1 = @"C:\MyTestDir";
        string dir2 = @"\\myMachine\MyTestDir";
        Console.WriteLine(CompareDirectories(dir1, dir2));
    }

    static bool CompareDirectories(string dir1, string dir2)
    {
        BY_HANDLE_FILE_INFORMATION fileInfo1, fileInfo2;
        IntPtr ptr1 = CreateFile(dir1, GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, IntPtr.Zero, OPEN_EXISTING,  FILE_FLAG_BACKUP_SEMANTICS, IntPtr.Zero);
        if ((int)ptr1 == -1)
        {
            System.ComponentModel.Win32Exception t = new System.ComponentModel.Win32Exception(Marshal.GetLastWin32Error());
            Console.WriteLine(dir1 + ": " + t.Message);
            return false;
        }
        IntPtr ptr2 = CreateFile(dir2, GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, IntPtr.Zero, OPEN_EXISTING,  FILE_FLAG_BACKUP_SEMANTICS, IntPtr.Zero);
        if ((int)ptr2 == -1)
        {
            System.ComponentModel.Win32Exception t = new System.ComponentModel.Win32Exception(Marshal.GetLastWin32Error());
            Console.WriteLine(dir2 + ": " + t.Message);
            return false;
        }
        GetFileInformationByHandle(ptr1, out fileInfo1);
        GetFileInformationByHandle(ptr2, out fileInfo2);

        return ((fileInfo1.FileIndexHigh == fileInfo2.FileIndexHigh) &&
            (fileInfo1.FileIndexLow == fileInfo2.FileIndexLow));
    }
} 
```

有用！希望这可以帮助。

干杯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T17:40:14.497

我相信使用 WMI 查询将处理我需要做的事情：

```
Connection options = new ConnectionOptions();
ManagementScope scpoe = new ManagementScope("\\\\Server\\root\\cimv2", options);
ObjectQuery query = new ObjectQuery("SELECT * FROM Win32_Share WHERE Name = '" + name +"'")

ManagementObjectSearcher searcher = new ManagementObjectSearch(scope, query);
ManagementObjectCollection qc = searcher.Get();

foreach (ManagementObject m in qc) {
    Console.WriteLine(m["Path"]);
} 
```

Path 属性会给我共享的物理路径，我可以用它来比较两个共享。

# ruby - 使用 Ruby 将 UTF8 转换为 ANSI

> ID：263271
> 
> 赞同：14
> 
> 时间：2008-11-04T20:15:08.117
> 
> 标签：ruby, utf-8, ansi, iconv

我有一个 Ruby 脚本，它在 Linux 机器中远程生成一个 UTF8 CSV 文件，然后通过 SFTP 将文件传输到 Windows 机器。

然后我需要用 Excel 打开这个文件，但是 Excel 没有 UTF8，所以我总是需要在能够将 UTF8 转换为 ANSI 的文本编辑器中打开文件。

我很想使用 Ruby 以编程方式执行此操作，并避免手动转换步骤。最简单的方法是什么？

PS：我尝试使用 iconv 但没有成功。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-04T20:31:47.350

```
ascii_str = yourUTF8text.unpack("U*").map{|c|c.chr}.join 
```

假设您的文本确实适合 ascii 字符集。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-04T20:33:04.743

我终于设法使用 iconv 做到了，我只是弄乱了参数。所以，这就是你的做法：

```
 require 'iconv'

utf8_csv = File.open("utf8file.csv").read

# gotta be careful with the weird parameters order: TO, FROM !
ansi_csv = Iconv.iconv("LATIN1", "UTF-8", utf8_csv).join

File.open("ansifile.csv", "w") { |f| f.puts ansi_csv } 
```

就是这样！

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-08-25T00:32:18.513

我在尝试从服务器上的用户生成内容生成 CSV 文件时遇到了类似的问题。我发现了[unicodecoder](https://github.com/norman/unidecoder) gem，它可以很好地将 unicode 字符转译为 ascii。

例子：

```
"olá, mundo!".to_ascii                 #=> "ola, mundo!"
"你好".to_ascii                        #=> "Ni Hao "
"Jürgen Müller".to_ascii               #=> "Jurgen Muller"
"Jürgen Müller".to_ascii("ü" => "ue")  #=> "Juergen Mueller" 
```

对于我们的简单用例，这很有效。

Pivotal Labs 有一篇很棒的关于将[unicode 音译为 ascii](http://blog.pivotal.io/labs/labs/unicode-transliteration-to-ascii)的博文，对此进行了更详细的讨论。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2017-08-18T21:30:24.120

由于 ruby​​ 1.9 有一个更简单的方法：

```
yourstring.encode('ASCII') 
```

为避免无效（非 ASCII）字符出现问题，您可以忽略这些问题：

```
yourstring.encode('ASCII', invalid: :replace, undef: :replace, replace: "_") 
```

# installation - MSI 安装问题

> ID：263274
> 
> 赞同：2
> 
> 时间：2008-11-04T20:15:26.667
> 
> 标签：installation, windows-installer, wise, altiris

我有一个基于 MSI 的安装，我根据我的安装打包软件（即 Wise Package Studio 7.0 SP2）将其打包在一个 EXE 文件中。

我对安装进行了许多更改，每次我测试它们时，它们都运行良好......直到现在。

我在安装完成时更改了对话框上的一些文本，现在看来，无论我如何/在何处运行安装，它都不会采用我的“新”版本。它继续“认为”它已经安装，甚至在删除/修复/修改结束时显示我的对话文本的旧版本。

几乎就像它在某处缓存了 MSI/EXE，而不是运行我重新编译的那个（并修复了消息/进行了更改），它继续从某个地方运行“旧”的那个。

知道要检查什么/这里可能发生什么吗？是否有我需要检查的 windows 文件夹？我在 XP SP2 上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T20:24:23.560

尝试在另一台机器上运行，这肯定会排除任何本地缓存。

检查您所做的更改是否确实在 MSI 中。（使用[Orca](http://msdn.microsoft.com/en-us/library/aa370557.aspx?ppud=4)来执行此操作。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T20:58:20.200

好的，所以我尝试使用 XP VM 并在安装前拍摄快照。看起来以前的安装不知何故已损坏，并且不知何故将自己缓存在我正在使用的原始测试计算机上。

通过使用干净且新鲜的 PC，我的更改就在那里，并且脚本按预期工作。现在，我不知道发生了什么导致安装在 PC 上的某个地方像这样缓存，但至少我找到了解决方案。

如果我能追踪到缓存文件的位置，我会用缓存文件的位置更新这个问题......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T22:20:37.070

要删除任何缓存的 Windows 安装程序信息，您可以使用[MSIZAP](http://msdn.microsoft.com/en-us/library/aa370523.aspx "MSIZAP")。我的猜测是您没有更改包代码，因此 Windows 将其视为相同版本的安装程序（我不确定 WISE，但 InstallShield 通常配置为在每次重建时自动更改包代码。）

至于缓存文件的位置，这是可配置的，所以在 WISE 中搜索一下，您应该会找到它。

# c# - 更改其他进程的键盘布局

> ID：263276
> 
> 赞同：16
> 
> 时间：2008-11-04T20:16:45.463
> 
> 标签：c#, .net, winapi, keyboard-layout, registerhotkey

我正在用 C# 编写一个在后台运行的程序，它允许用户使用热键在活动窗口中切换键盘布局。（Windows 仅支持`CTRL`+`SHIFT`和`ALT`+ `SHIFT`）

我正在使用 RegisterHotKey 来捕捉热键，它工作正常。

问题是我找不到任何 API 来更改焦点窗口的键盘布局。

ActivateKeyboardLayout 和 LoadKeyboardLayout 只能更改调用线程的键盘布局。

有谁知道如何更改不同线程的键盘布局（语言栏的方式）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-04-22T13:12:39.543

```
PostMessage(handle, 
    WM_INPUTLANGCHANGEREQUEST, 
    0, 
    LoadKeyboardLayout( StrCopy(Layout,'00000419'), KLF_ACTIVATE)
); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T19:33:39.603

我认为诀窍是让您的代码在您希望更改其键盘布局的线程的上下文中执行。您需要在此处进行一些 win32 互操作并了解 DLL 注入以使您的代码在远程线程中执行。

在这里，[键盘挂钩处理程序](http://msdn.microsoft.com/en-us/library/ms644960(VS.85).aspx)对您来说是个不错的选择。

看看 [http://www.codeproject.com/KB/threads/winspy.aspx](http://www.codeproject.com/KB/threads/winspy.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T16:35:51.897

如果您只是为自己编写一些东西，另一种可能是可以接受的方式：为每个布局定义一个单独的组合键（例如 Alt+Shift+1 等），并使用[SendInput](http://msdn.microsoft.com/en-us/library/ms646310.aspx "发送输入")在它们之间切换。

当然，它可用的情况是有限的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-22T13:16:24.187

```
 function ChangeRemoteWndKeyboardLayoutToRussian(
    const RemoteHandle: THandle): Boolean;
  var
    Dumme: DWORD;
    Layout: HKL;
  begin
    Layout := LoadKeyboardLayout('00000419', KLF_ACTIVATE);
    Result := SendMessageTimeOut(RemoteHandle, WM_INPUTLANGCHANGEREQUEST,
      0, Layout, SMTO_ABORTIFHUNG, 200, Dumme) <> 0;
    if Result then    
      Result := SendMessageTimeOut(RemoteHandle, WM_INPUTLANGCHANGEREQUEST,
        RUSSIAN_CHARSET, Layout, SMTO_ABORTIFHUNG, 200, Dumme) <> 0;
  end; 
```

# python - 创建 python win32 服务

> ID：263296
> 
> 赞同：11
> 
> 时间：2008-11-04T20:23:17.070
> 
> 标签：python, winapi, pywin32

我目前正在尝试使用 pywin32 创建一个 win32 服务。我的主要参考点是本教程：

[http://code.activestate.com/recipes/551780/](http://code.activestate.com/recipes/551780/)

我不明白的是初始化过程，因为守护进程从不直接由 Daemon() 初始化，而是根据我的理解，它由以下初始化：

```
mydaemon = Daemon
__svc_regClass__(mydaemon, "foo", "foo display", "foo description")
__svc_install__(mydaemon) 
```

其中**svc_install**通过调用 Daemon 来处理初始化。**init** () 并传递一些参数给它。

但是如何在不初始化服务的情况下初始化守护程序对象？在我启动服务之前，我想做一些事情。有没有人有任何想法？

```
class Daemon(win32serviceutil.ServiceFramework):
    def __init__(self, args):
        win32serviceutil.ServiceFramework.__init__(self, args)
        self.hWaitStop = win32event.CreateEvent(None, 0, 0, None)

    def SvcDoRun(self):
        self.run()

    def SvcStop(self):
        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
        win32event.SetEvent(self.hWaitStop)

    def start(self):
        pass

    def stop(self):
        self.SvcStop()

    def run(self):
        pass

def __svc_install__(cls):
    win32api.SetConsoleCtrlHandler(lambda x: True, True)
    try:
        win32serviceutil.InstallService(
            cls._svc_reg_class_,
            cls._svc_name_,
            cls._svc_display_name_,
            startType = win32service.SERVICE_AUTO_START
            )
        print "Installed"
    except Exception, err:
        print str(err)

def __svc_regClass__(cls, name, display_name, description):

    #Bind the values to the service name
    cls._svc_name_ = name
    cls._svc_display_name_ =  display_name
    cls._svc_description_ = description
    try:
        module_path = sys.modules[cls.__module__].__file__
    except AttributeError:
        from sys import executable
        module_path = executable
    module_file = os.path.splitext(os.path.abspath(module_path))[0]
    cls._svc_reg_class_ = '%s.%s' % (module_file, cls.__name__) 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-23T03:20:19.640

我只是创建了一个简单的“操作方法”，其中程序在一个模块中，服务在另一个地方，它使用 py2exe 创建 win32 服务，我相信这是你可以为不想要的用户做的最好的弄乱python解释器或其他依赖项。

你可以在这里查看我的教程：[使用 Python 和 py2exe 创建 win32 服务](http://islascruz.org/html/index.php?gadget=StaticPage&action=Page&id=6)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-05T11:18:14.627

这些API我没用过，但是翻开代码，貌似传入的类是用来在注册表中注册类名的，所以不能自己做任何初始化。但是有一个名为 GetServiceCustomOption 的方法可能会有所帮助：

[http://mail.python.org/pipermail/python-win32/2006-April/004518.html](http://mail.python.org/pipermail/python-win32/2006-April/004518.html)

# algorithm - 绘制地形图

> ID：263305
> 
> 赞同：36
> 
> 时间：2008-11-04T20:25:30.373
> 
> 标签：algorithm, language-agnostic, visualization, bezier, topographical-lines

我一直致力于二维连续数据的可视化项目。这是您可以用来研究 2D 地图上的高程数据或温度模式的东西。从本质上讲，它实际上是一种将 3 维扁平化为 2 维加颜色的方法。在我的特定研究领域中，我实际上并没有使用地理高程数据，但这是一个很好的比喻，所以我将在这篇文章中坚持使用它。

无论如何，在这一点上，我有一个我非常满意的“连续颜色”渲染器：

![连续彩色渲染器](https://i.stack.imgur.com/ycIzY.png)

渐变是标准色轮，其中红色像素表示坐标值较高，紫色像素表示坐标值较低。

底层数据结构使用一些非常聪明的（如果我自己这么说的话）插值算法来实现对地图细节的任意深度放大。

在这一点上，我想绘制一些地形轮廓线（使用二次贝塞尔曲线），但我还没有找到任何好的文献来描述找到这些曲线的有效算法。

为了让您了解我的想法，这是一个穷人的实现（渲染器在遇到与轮廓线相交的像素时只使用黑色 RGB 值）：

![带有贫民区地形线的连续颜色](https://i.stack.imgur.com/eOiGk.png)

但是，这种方法存在几个问题：

*   具有较陡坡度的图形区域会导致地形线较细（并且通常是断线）。理想情况下，所有地形线都应该是连续的。

*   具有更平坦斜率的图形区域会导致更宽的地形线（通常是整个黑色区域，尤其是在渲染区域的外围）。

所以我正在寻找一种矢量绘图方法来获得那些漂亮的、完美的 1 像素厚的曲线。算法的基本结构必须包括以下步骤：

1.  在我要绘制地形线的每个离散高程处，找到一组坐标，其中该坐标处的高程与所需的高程非常接近（给定任意 epsilon 值）。

2.  消除多余的点。例如，如果三个点在一条完全直线上，则中心点是多余的，因为可以在不改变曲线形状的情况下消除它。同样，对于贝塞尔曲线，通常可以通过调整相邻控制点的位置来消除某些锚点。

3.  将剩余的点组装成一个序列，使得两点之间的每个线段都近似于高度中性轨迹，并且没有两条线段会交叉路径。每个点序列必须要么创建一个封闭的多边形，要么必须与渲染区域的边界框相交。

4.  对于每个顶点，找到一对控制点，使得结果曲线相对于步骤 #2 中消除的冗余点显示出最小误差。

5.  确保在当前渲染比例下可见的所有地形特征都由适当的地形线表示。例如，如果数据包含高海拔但直径极小的尖峰，则仍应绘制地形线。仅当特征直径小于图像的整体渲染粒度时，才应忽略垂直特征。

但即使在这些限制下，我仍然可以想到几种不同的启发式方法来寻找线条：

*   找到渲染边界框内的高点。从那个高点开始，沿着几条不同的轨迹下坡。每当遍历线越过高程阈值时，将该点添加到特定于高程的存储桶中。当遍历路径达到局部最小值时，改变路线并上坡。

*   沿渲染区域的矩形边界框执行高分辨率遍历。在每个高程阈值处（以及在拐点处，无论坡度反转方向），将这些点添加到特定于高程的存储桶中。完成边界遍历后，从这些桶中的边界点开始向内追踪。

*   扫描整个渲染区域，以稀疏的规则间隔进行高程测量。对于每个测量，使用它与高程阈值的接近度作为决定是否对其邻居进行插值测量的机制。使用这种技术可以更好地保证整个渲染区域的覆盖，但是很难将结果点组装成合理的顺序来构建路径。

所以，这些是我的一些想法......

在深入研究实现之前，我想看看 StackOverflow 上的其他人是否有解决此类问题的经验，并且可以为准确有效的实现提供指导。

**编辑：**

我对 ellisbben 提出的“渐变”建议特别感兴趣。而我的核心数据结构（忽略一些优化插值快捷方式）可以表示为一组二维高斯函数的总和，这是完全可微的。

我想我需要一个数据结构来表示一个三维斜率，以及一个用于计算任意点的斜率向量的函数。在我的脑海中，我不知道该怎么做（虽然看起来应该很容易），但如果你有一个解释数学的链接，我会非常感激！

**更新：**

感谢 ellisbben 和 Azim 的出色贡献，我现在可以计算该领域中任意点的轮廓角。绘制真正的地形线将很快出现！

这是更新的渲染，有和没有我一直在使用的基于 ghetto raster 的拓扑渲染器。每个图像包含一千个随机样本点，用红点表示。该点的轮廓角由一条白线表示。在某些情况下，在给定点无法测量斜率（基于插值的粒度），因此红点出现时没有相应的等高线角度线。

享受！

*（注意：这些渲染使用与以前的渲染不同的表面形貌——因为我在每次迭代时随机生成数据结构，而我正在制作原型——但核心渲染方法是相同的，所以我相信你得到这个想法。）*

![替代文字](https://i.stack.imgur.com/PovID.png)

![替代文字](https://i.stack.imgur.com/x7jpg.png)

这是一个有趣的事实：在这些渲染图的右侧，您会看到一堆奇怪的轮廓线，它们处于完美的水平和垂直角度。这些是插值过程的产物，它使用插值器网格来减少执行核心渲染操作所需的计算数量（约 500%）。所有这些奇怪的轮廓线都出现在两个插值器网格单元之间的边界上。

幸运的是，这些文物实际上并不重要。尽管在斜率计算期间可以检测到伪影，但最终渲染器不会注意到它们，因为它以不同的位深度运行。

* * *

再次更新：

啊啊啊，作为我睡觉前的最后一次放纵，这是另一对效果图，一个是老式的“连续颜色”风格，一个有 20,000 个渐变样本。在这组渲染中，我已经消除了点样本的红点，因为它不必要地使图像混乱。

在这里，您可以真正看到我之前提到的那些插值工件，这要归功于插值器集合的网格结构。我应该强调的是，这些伪影在最终的轮廓渲染中将完全不可见（因为任何两个相邻插值器单元之间的幅度差异小于渲染图像的位深度）。

开胃！！

![替代文字](https://i.stack.imgur.com/RU3Yl.png)

![替代文字](https://i.stack.imgur.com/6RWTM.png)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-04T21:45:52.053

[梯度](http://en.wikipedia.org/wiki/Gradient)是一个可以帮助你的数学运算符。

如果您可以将插值转换为可微函数，则高度的梯度将始终指向最陡峭的上升方向。所有相等高度的曲线都垂直于在该点评估的高度梯度。

您从最高点开始的想法是明智的，但如果有多个局部最大值，则可能会错过特征。

我建议

1.  选择您将绘制线条的高度值
2.  在精细、规则间隔的网格上创建一堆点，然后沿着渐变方向以小步长将每个点移向要绘制线条的最近高度
3.  通过将每个点垂直于渐变来创建曲线；当另一条曲线太靠近它时，通过杀死一个点来消除多余的点 - 但为了避免破坏像图形一样的沙漏中心，您可能需要检查两个点的垂直于梯度的定向向量之间的角度。（当我说定向时，我的意思是确保梯度和您计算的垂直值之间的角度始终在同一方向上为 90 度。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T21:58:56.503

或者，有一个似乎适合您的问题的[行进正方形](http://en.wikipedia.org/wiki/Marching_squares)算法，尽管如果您使用粗网格，您可能希望平滑结果。

您要绘制的地形曲线是二维标量场的[等值面。](http://en.wikipedia.org/wiki/Isosurface)对于 3 维的等值面，有[行进立方体](http://en.wikipedia.org/wiki/Marching_cubes)算法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-04T23:35:36.963

回应您对@erickson 的评论并回答有关计算函数梯度的问题。您可以按如下方式进行数值微分，而不是计算 300 项函数的导数。

给定图像中的一个点 [x,y]，您可以计算梯度（最陡的方向）

```
g={  ( f(x+dx,y)-f(x-dx,y) )/(2*dx), 
  {  ( f(x,y+dy)-f(x,y-dy) )/(2*dy) 
```

其中 dx 和 dy 可能是网格中的间距。等高线将垂直于渐变。因此，要获得轮廓方向 c，我们可以将 g=[v,w] 乘以矩阵 A=[0 -1, 1 0] 给出

```
c = [-w,v] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-04T22:00:56.343

我自己也想要这样的东西，但还没有找到基于矢量的解决方案。

不过，基于栅格的解决方案并不是那么糟糕，尤其是在您的数据是基于栅格的情况下。如果你的数据也是基于矢量的（换句话说，你有一个表面的 3D 模型），你应该能够做一些真正的数学运算来找到不同高度的水平面的相交曲线。

对于基于光栅的方法，我查看每一对相邻像素。如果一个在等高线之上，一个在等高线之下，显然它们之间有一条等高线。我用来消除轮廓线锯齿的技巧是将轮廓线颜色混合到*两个*像素中，与它们与理想轮廓线的接近程度成正比。

也许一些例子会有所帮助。假设当前像素处于 12 英尺的“高程”，邻居处于 8 英尺的高程，等高线是每 10 英尺。那么，中间有一条等高线；用 50% 不透明度的轮廓线颜色绘制当前像素。另一个像素在 11 英尺处，并且在 6 英尺处有一个相邻像素。以 80% 的不透明度为当前像素着色。

```
alpha = (contour - neighbor) / (current - neighbor) 
```

不幸的是，我手边没有代码，而且可能还有更多代码（我隐约记得也看过对角线邻居，并通过 调整`sqrt(2) / 2`）。我希望这足以为您提供要点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T05:05:23.167

我突然想到，你想要做的事情在 MATLAB 中很容易做到，使用轮廓函数。对轮廓进行低密度近似等操作可能可以通过对轮廓进行一些相当简单的后处理来完成。

幸运的是，MATLAB 克隆版 GNU Octave 实现了各种等高线绘图功能。您可以查看该代码以获得几乎可以肯定在数学上合理的算法和实现。或者，您可能只是能够将处理卸载到 Octave。查看[与其他语言交互](http://wiki.octave.org/wiki.pl?CategoryExternal)的页面，看看是否会更容易。

披露：我没有经常使用 Octave，也没有实际测试过它的等高线绘图。但是，根据我使用 MATLAB 的经验，我可以说，只要您将数据输入 MATLAB，它只需几行代码即可为您提供几乎所有您需要的东西。

此外，祝贺你制作了一个非常 VanGough 式的坡地图。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T20:39:56.647

在自己深入之前，我总是会检查[http://mathworld.wolfram.com之类的地方 :)](http://mathworld.wolfram.com)

也许他们的[曲线](http://mathworld.wolfram.com/topics/Curves.html)部分会有所帮助？或者也许是[地图上](http://mathworld.wolfram.com/MapProjection.html)的条目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-04T21:03:22.340

将您渲染的内容与真实世界的地形图进行比较——它们看起来和我一模一样！我不会改变任何事情...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-01T21:09:36.477

将数据写成[HGT 文件](https://stackoverflow.com/questions/357415/how-to-read-nasa-hgt-binary-files)（USGS 使用的非常简单的数字高程数据格式），并使用免费和开源的[gdal_contour](http://www.gdal.org/gdal_contour.html)工具创建等高线。这对地面地图非常有效，限制是数据点是有符号的 16 位数字，非常适合地球上以米为单位的高度范围，但对于您的数据可能还不够，我认为这不是实际地形图 - 尽管您确实提到了地形图。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-12-18T16:42:41.173

我推荐[CONREC](http://paulbourke.net/papers/conrec/)方法：

*   创建一个空的线段列表
*   将您的数据拆分为规则的网格方块
*   对于每个网格正方形，将正方形分成 4 个组成三角形：
    *   对于每个三角形，处理情况（a 到 j）：
        *   如果线段穿过其中一种情况：
            *   计算其端点
            *   将线段存储在列表中
*   绘制线段列表中的每条线段

如果线条过于锯齿，请使用较小的网格。如果线条足够平滑且算法耗时过长，请使用更大的网格。

# wpf - 复制 ListView 控件的上下文菜单

> ID：263322
> 
> 赞同：5
> 
> 时间：2008-11-04T20:31:02.033
> 
> 标签：wpf

将“复制到剪贴板”功能添加到 WPF 中的 ListView 控件的最佳方法是什么？

我尝试将 ApplicationCommands.Copy 添加到 ListView ContextMenu 或 ListViewItem ContextMenu，但该命令仍处于禁用状态。

谢谢，彼得

这是我的一次尝试的 xaml 示例...

```
 <Window.Resources>
    <ContextMenu x:Key="SharedInstanceContextMenu" x:Shared="True">
        <MenuItem Header="Copy" Command="ApplicationCommands.Copy"/>            
    </ContextMenu>
 </Window.Resources>

 <ListBox Margin="12,233,225,68" Name="listBox1" >
        <ListBox.ItemTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding Path=UpToSourceCategoryByCategoryId.Category}" ContextMenu="{DynamicResource ResourceKey=SharedInstanceContextMenu}"/>
            </DataTemplate>
        </ListBox.ItemTemplate>
 </ListBox> 
```

在这种情况下，我应该如何设置 CommandTarget？

谢谢，彼得

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:37:07.220

看起来您需要一个 CommandBinding。

这就是我可能会如何去做你想做的事情。

```
<Window.CommandBindings>
    <CommandBinding
        Command="ApplicationCommands.Copy"
        Executed="CopyCommandHandler"
        CanExecute="CanCopyExecuteHandler" />
</Window.CommandBindings>

<Window.Resources>
    <ContextMenu x:Key="SharedInstanceContextMenu">
        <MenuItem Header="Copy" Command="ApplicationCommands.Copy"/>
    </ContextMenu>

    <Style x:Key="MyItemContainerStyle" TargetType="{x:Type ListBoxItem}">
        <Setter Property="ContextMenu" Value="{StaticResource SharedInstanceContextMenu}" />
    </Style>
</Window.Resources>

<ListBox ItemContainerStyle="{StaticResource MyItemContainerStyle}">
    <ListBoxItem>One</ListBoxItem>
    <ListBoxItem>Two</ListBoxItem>
    <ListBoxItem>Three</ListBoxItem>
    <ListBoxItem>Four</ListBoxItem>
</ListBox> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T20:34:42.700

正如我在[博客](http://jannsblog.wordpress.com/2009/03/10/copy-a-listview%E2%80%99s-items-to-the-clipboard/)中描述的那样，也可以通过附加属性来实现此功能。这个想法是向 ListView 注册 ApplicationCommands.Copy 命令，并在执行命令时从数据绑定中读取值。

您也可以在博客条目中找到可下载的示例。

# gridview - 在固定宽度的 div 中冻结 gridview 标题

> ID：263333
> 
> 赞同：1
> 
> 时间：2008-11-04T20:36:37.373
> 
> 标签：gridview

我在网上看到了一些 gridview 标题冻结示例，但我有一个特殊情况，即 gridview 位于固定宽度的 div 中。我尝试的示例使标题固定，但显示了标题的整个宽度，并且它溢出了 div，而网格体有一个水平滚动条。

我需要它：
1- Header 和 tbody 一起水平滚动，并且都限制在固定宽度的 div 中。
2-当 gridview body 垂直滚动时，标题是固定的。
3-不想使用商业电网。
4- 我只使用 IE。不在乎它是否适用于 FF、Opera 等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-07T21:23:41.203

我刚刚编写了一个 jQuery 插件，它完全可以满足您的需求。您只需使用 thead 和 tbody 构建 1 个表，其余的工作都会为您完成。使用起来非常简单......我在下面链接的另一个问题下发布了解决方案。IE6/7/8 也支持。

[可滚动div内的冻结表头](https://stackoverflow.com/questions/486576/frozen-table-header-inside-scrollable-div/1533619#1533619)

或直接指向我的插件站点的链接：

[http://fixedheadertable.mmalek.com](http://fixedheadertable.mmalek.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T23:19:24.910

你看到这个例子了吗？ [http://web.tampabay.rr.com/bmerkey/examples/locked-column-csv.html](http://web.tampabay.rr.com/bmerkey/examples/locked-column-csv.html)

# .htpasswd - 我可以将 htpasswd 文件复制/粘贴到我的新服务器吗？

> ID：263334
> 
> 赞同：8
> 
> 时间：2008-11-04T20:36:55.983
> 
> 标签：.htpasswd

我正在记录在我的开发服务器上完全重新部署的过程。小员工，使用带有 htpasswd 文件后端的基本身份验证（当然是通过 SSL）。

按原样传输 .htpasswd 文件是否安全？

操作系统可能会有所不同，但顶部的软件（即 Apache）将是相同的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T20:40:52.807

无论您使用什么架构，传输 htpasswd 文件都是安全的。它是一个文本文件。如果您在 Unix 和 Windows 之间移动，但在 Linux/Unix 机器之间移动，则可能需要进行一些转换的唯一情况是处理行尾，没有问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-23T18:25:25.623

简短的回答：是的，你可以。

这就是你需要知道的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T20:41:09.080

如果您使用的是 apache，那么 .htpasswd 文件应该是相同的。只要确保您没有覆盖要在新服务器配置中使用的密码文件。并确保您对文件设置了适当的权限，这样您就不会获得任何其他未经授权的条目。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-04T20:40:06.960

如果您使用相同的 apache 版本，则只需复制 .htpasswd 文件就不会出现任何问题：它们只包含人们的密码正在比较的哈希值，并且哈希值始终相同（或者它在任何机器上都不起作用;))

# asp.net-mvc - asp.net mvc 单选按钮状态

> ID：263336
> 
> 赞同：13
> 
> 时间：2008-11-04T20:38:11.270
> 
> 标签：asp.net-mvc, ui-helper

我正在为一个新项目尝试 asp.net mvc，但遇到了一些奇怪的事情。当我将 MVC UI 助手用于文本框时，值会在调用之间保持不变。但是，当我使用一系列单选按钮时，选中状态不会持续存在。

这是我认为的一个例子。

```
<li>
        <%=Html.RadioButton("providerType","1")%><label>Hospital</label>
        <%=Html.RadioButton("providerType","2")%><label>Facility</label>
        <%=Html.RadioButton("providerType","3")%><label>Physician</label>
</li> 
```

当表单被发回时，我构建了一个带有“ProviderType”的对象作为它的属性之一。对象上的值被设置，然后我 RedirectToAction 以提供者作为参数。一切都很好，我最终得到了一个像“ [http://localhost/Provider/List?ProviderType=1](http://localhost/Provider/List?ProviderType=1) ”这样的 URL，其中显示了 ProviderType。该值被持久化到 URL，但 UI 帮助程序没有选择检查状态。

我在列表框、~~下拉列表~~和单选按钮方面遇到了这个问题。文本框可以很好地获取值。你看到我做错了什么吗？我假设助手会为我做这件事，但也许我只需要自己处理这件事。我只是在摸索自己的方式，因此感谢您的意见。

**编辑：**我刚刚找到了 SelectList 构造函数的覆盖，它采用了一个选定的值。这解决了我上面提到的下拉问题。

**编辑＃2：**我发现了一些可行的方法，但是这样做让我很痛苦。我觉得应该这样推断。

```
<li>
  <%=Html.RadioButton("ProviderType","1",Request["ProviderType"]=="1")%><label>Hospital</label>
  <%=Html.RadioButton("ProviderType", "2", Request["ProviderType"] == "2")%><label>Facility</label>
  <%=Html.RadioButton("ProviderType", "3", Request["ProviderType"] == "3")%><label>Physician</label>
</li> 
```

希望有人会想出另一种方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-08-04T05:47:10.940

如果您为单选按钮指定与模型上的属性相同的名称，则 MVC 将自动在相应按钮上设置选中的属性。

我认为这依赖于强类型模型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T03:40:21.360

在您看来，您需要的是这样的东西：

```
<% foreach(var provider in (IEnumerable<Provider>)ViewData["Providers"]) { %>
    <%=Html.RadioButton("ProviderType", provider.ID.ToString(), provider.IsSelected)%><label><%=provider.Name%></label>
<% } %> 
```

然后在你的控制器中有这个：

```
var providers = GetProviders();
int selectedId = (int) Request["ProviderType"]; // TODO: Use Int32.TryParse() instead
foreach(var p in providers)
{
    if (p.ID == selectedId)
    {
        p.IsSelected = true;
        break;
    }
}
ViewData["Providers"] = providers;
return View(); 
```

Provider 类将是这样的：

```
public class Provider
{
    public int ID { get; set; }
    public string Name { get; set; }
    public bool IsSelected { get; set; }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T23:22:41.000

表单不应发布到查询字符串，除非您忘记将表单指定为 method="POST"。你是如何指定表格的？您使用的是 ASP.NET MVC 测试版吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-07T12:31:54.770

我现在正在使用 vs2010，它的工作原理如下：

```
<%=Html.RadioButton("ProviderType","1",Model.ProviderType==1)%><label>Hospital</label> 
```

看起来更好？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-12T17:57:16.310

我制作了这个 HTML Helper 扩展：

```
 <Extension()> _
    Public Function RadioButtonList(ByVal helper As HtmlHelper, ByVal name As String, ByVal Items As IEnumerable(Of String)) As String
        Dim selectList = New SelectList(Items)
        Return helper.RadioButtonList(name, selectList)
    End Function

    <Extension()> _
    Public Function RadioButtonList(ByVal helper As HtmlHelper, ByVal Name As String, ByVal Items As IEnumerable(Of SelectListItem)) As String
        Dim sb As New StringBuilder
        sb.Append("<table class=""radiobuttonlist"">")
        For Each item In Items
            sb.AppendFormat("<tr><td><input id=""{0}_{1}"" name=""{0}"" type=""radio"" value=""{1}"" {2} /><label for=""{0}_{1}"" id=""{0}_{1}_Label"">{3}</label></td><tr>", Name, item.Value, If(item.Selected, "selected", ""), item.Text)
        Next
        sb.Append("</table>")
        Return sb.ToString()
    End Function 
```

然后在视图中：

```
<%= Html.RadioButtonList("ProviderType", Model.ProviderTypeSelectList) %> 
```

在控制器中，选项使用标准自动映射：

```
UpdateModel(Provider) 
```

奇迹般有效。如果您有桌面恐惧症，请更改生成的标记。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T20:05:24.370

从逻辑上讲，它不会持续存在，没有会话状态。把它想象成一个全新的页面。为了让您的单选按钮进行填充，您需要保留 ViewData["ProviderType"] = 3 之类的内容，以使单选按钮重新填充其数据。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2010-12-11T09:54:19.203

看法：

```
<%=Html.RadioButton("providerType","1")%><label>Hospital</label>
<%=Html.RadioButton("providerType","2")%><label>Facility</label>
<%=Html.RadioButton("providerType","3")%><label>Physician</label> 
```

控制器：

```
public ActionResult GetType(FormCollection collection)
{
 string type=collection.Get("providerType");

  if(type=="1")
   //code
  else if(type=="2")
   //code
  else
   //code

 return View();
} 
```

# c++ - 评估 C++ 字符串中的表达式：“Hi ${user} from ${host}”

> ID：263339
> 
> 赞同：4
> 
> 时间：2008-11-04T20:39:35.243
> 
> 标签：c++, parsing, boost, string, expression

我正在寻找一种干净的 C++ 方法来解析包含包装在 ${} 中的表达式的字符串，并从以编程方式评估的表达式构建结果字符串。

示例：如果我实现程序让“user”评估为“foo”等，“来自 ${host} 的 Hi ${user}”将被评估为“来自 bar 的 Hi foo”等。

我正在考虑的当前方法包括一个状态机，它一次从字符串中读取一个字符，并在达到“}”后评估表达式。任何提示或其他建议？

注意： boost:: 是最受欢迎的！:-)

**更新**感谢前三个建议！不幸的是，我的例子太简单了！我需要能够检查 ${} 中的内容，所以这不是简单的搜索和替换。也许它会说 ${uppercase:foo} 然后我必须使用“foo”作为哈希映射中的键，然后将其转换为大写，但是在编写上面的原始问题时，我试图避免 ${} 的内部细节... :-)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T21:01:08.507

```
#include <iostream>
#include <conio.h>
#include <string>
#include <map>

using namespace std;

struct Token
{
    enum E
    {
        Replace,
        Literal,
        Eos
    };
};

class ParseExp
{
private:
    enum State
    {
        State_Begin,
        State_Literal,
        State_StartRep,
        State_RepWord,
        State_EndRep
    };

    string          m_str;
    int             m_char;
    unsigned int    m_length;
    string          m_lexme;
    Token::E        m_token;
    State           m_state;

public:
    void Parse(const string& str)
    {
        m_char = 0;
        m_str = str;
        m_length = str.size();
    }

    Token::E NextToken()
    {
        if (m_char >= m_length)
            m_token = Token::Eos;

        m_lexme = "";
        m_state = State_Begin;
        bool stop = false;
        while (m_char <= m_length && !stop)
        {
            char ch = m_str[m_char++];
            switch (m_state)
            {
            case State_Begin:
                if (ch == '$')
                {
                    m_state = State_StartRep;
                    m_token = Token::Replace;
                    continue;
                }
                else
                {
                    m_state = State_Literal;
                    m_token = Token::Literal;
                }
                break;

            case State_StartRep:
                if (ch == '{')
                {
                    m_state = State_RepWord;
                    continue;
                }
                else
                    continue;
                break;

            case State_RepWord:
                if (ch == '}')
                {
                    stop = true;
                    continue;
                }
                break;

            case State_Literal:
                if (ch == '$')
                {
                    stop = true;
                    m_char--;
                    continue;
                }
            }

            m_lexme += ch;
        }

        return  m_token;
    }

    const string& Lexme() const
    {
        return m_lexme;
    }

    Token::E Token() const
    {
        return m_token;
    }
};

string DoReplace(const string& str, const map<string, string>& dict)
{
    ParseExp exp;
    exp.Parse(str);
    string ret = "";
    while (exp.NextToken() != Token::Eos)
    {
        if (exp.Token() == Token::Literal)
            ret += exp.Lexme();
        else
        {
            map<string, string>::const_iterator iter = dict.find(exp.Lexme());
            if (iter != dict.end())
                ret += (*iter).second;
            else
                ret += "undefined(" + exp.Lexme() + ")";
        }
    }
    return ret;
}

int main()
{
    map<string, string> words;
    words["hello"] = "hey";
    words["test"] = "bla";
    cout << DoReplace("${hello} world ${test} ${undef}", words);
    _getch();
} 
```

我很乐意解释有关此代码的任何内容:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T20:50:28.030

打算有多少个评估表达式？如果它足够小，您可能只想使用蛮力。

例如，如果您有一个`std::map<string, string>`从 your`key`到 its 的a `value`，例如`user`to `Matt Cruikshank`，您可能只想遍历整个地图并简单地替换您的字符串 every`"${" + key + "}"`到 its `value`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T20:50:35.050

[Boost::Regex](http://www.boost.org/doc/libs/1_37_0/libs/regex/doc/html/index.html)将是我建议的路线。[regex_replace](http://www.boost.org/doc/libs/1_37_0/libs/regex/doc/html/boost_regex/ref/regex_replace.html)算法应该可以完成大部分繁重的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T20:52:27.027

如果您不喜欢我的第一个答案，请深入研究 Boost Regex - 可能是[boost::regex_replace](http://www.boost.org/doc/libs/1_37_0/libs/regex/doc/html/index.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T20:56:34.010

表达式可以变得多复杂？它们只是标识符，还是像“${numBad/(double)total*100.0}%”这样的实际表达式？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T20:56:45.990

您必须使用 ${ 和 } 分隔符还是可以使用其他分隔符？

你并不真正关心解析。您只想生成并格式化其中包含占位符数据的字符串。对？

对于平台中立的方法，请考虑不起眼的**sprintf**函数。它是最普遍的，并且可以满足我假设您的需要。它适用于“char stars”，因此您将不得不进行一些内存管理。

你在使用 STL 吗？然后考虑**basic_string& 替换**函数。它并不能完全满足您的要求，但您可以使其发挥作用。

如果您使用 ATL/MFC，请考虑**CStringT::Format**方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-04T21:18:53.713

如果您要单独管理变量，为什么不采用嵌入式解释器。我过去使用过[tcl](http://www.tcl.tk)，但您可以尝试为嵌入而设计的 [lua 。](http://www.lua.org/)[Ruby](http://www.ruby-lang.org)和[Python](http://www.python.org/doc/2.5.2/ext/embedding.html)是另外两个易于嵌入的可嵌入解释器，但不是那么轻量级。策略是实例化一个解释器（上下文），向其中添加变量，然后在该上下文中评估字符串。解释器将正确处理可能导致应用程序安全或稳定性问题的格式错误的输入。

# refactoring - 什么时候召集四人组？[什么时候使用设计模式？]

> ID：263342
> 
> 赞同：14
> 
> 时间：2008-11-04T20:40:11.530
> 
> 标签：refactoring, software-design, design-patterns

在[采访 Joel 的游击队指南中](http://www.joelonsoftware.com/articles/GuerrillaInterviewing3.html)说，想要完成任务但不聪明的人会做一些愚蠢的事情，比如使用访问者设计模式，其中一个简单的数组就足够了。

如果应该应用[四人组](http://en.wikipedia.org/wiki/Gang_of_Four_(software))建议的设计模式，我发现很难检测到。

因此，我想从你的工作经历中举一些例子

*   什么时候一个简单的方法（固定大小的数组）就足够了？
*   证明使用 GoF 模式的软件的最小大小是多少？
*   何时从头脑简单重构为 GoF？这可以以明智的方式完成吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-06T19:44:57.927

我经常发现，在面对这些问题时，使用测试驱动开发有助于指导我。

*   *什么时候简单的方法就足够了？* 使用最简单的方法来通过下一个测试总是足够的。但是知道何时/如何重构才是真正的艺术形式。
*   *证明使用 GoF 模式的软件的最小大小是多少？* 我曾经读过的一条经验法则是，当您编写一次代码时，很好，当您第二次将该代码复制到某个地方时，记下并继续前进。当您第三次发现需要相同的代码时，是时候进行重构以消除重复和简化，这通常涉及到转向设计模式。
*   *何时从头脑简单重构为 GoF？* 我喜欢@anopres 所说的——是时候让你感到没有设计模式的痛苦了。痛苦（或代码“气味”）可能以多种方式表现出来。代码重复是最明显的。像 Fowler's [Refactoring](https://rads.stackoverflow.com/amzn/click/com/0201485672)或 Kerievsky's [Refactoring to Patterns](https://rads.stackoverflow.com/amzn/click/com/0321213351)这样的重构书籍列出了许多这样的痛点/代码恶臭。
*   *这种 [重构] 可以以一种明智的方式完成吗？* 重构的诀窍是有一套你有信心的单元测试，然后在不导致任何测试失败的情况下进行重构。根据定义，重构不会改变代码的功能。因此，如果您的测试继续通过，您可以有一种很好的感觉，即您没有破坏任何东西。尽管这可能很困难，但我实际上很喜欢 TDD 的这一部分，它几乎就像一个在不破坏任何测试的情况下进行更改的游戏。

总而言之，我想说 TDD 帮助指导我编写当时足够的代码，也许更重要的是帮助我在以后不可避免地发生需求变化、需要更多功能等时进行更改。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-06T20:34:27.140

设计模式是结果，而不是目标。你不认为*今天我会使用策略模式*，你就去做吧。在完成第三个几乎相同的课程的中途，您停下来并使用纸质笔记本找出一般情况并敲出一个描述共享上下文的基类。您将前两个类重构为后代，这使您可以进行现实检查，并对基类进行相当多的更改。然后接下来的三十个是在公园里散步。

只是在第二天的团队会议上，您说“我使用了策略模式。它们都工作相同，所以只有一个测试程序，它需要参数来更改测试用例”，从而为每个人节省了 30 分钟的无聊时间。

对模式的亲密熟悉使您能够在情况需要时反射性地使用它们。当人们将模式的使用本身视为一个目标时，你会得到生硬、丑陋的代码，它谈论的是机制而不是目的；如何而不是为什么。

* * *

大多数模式都解决了重复出现的基本问题，例如降低复杂性和需要提供可扩展点。在明确不需要它们的情况下提供可扩展点会使您的代码无意义地复杂化并创建更多故障点和测试用例。除非你正在构建一个发布到野外的框架，否则只解决你实际面临的问题。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-06T21:15:02.333

模式只是工具和词汇。您编写的代码尽可能简单、易于理解和可维护。通过了解模式，您可以使用更多替代方案，并且您有一种语言可以在实施方法之前讨论该方法的优缺点。

在任何一种情况下，您都不只是“切换”到“使用模式”。你只是继续做你一直在做的事情，用你知道的最好的方式编写代码。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-04T20:55:44.947

这类似于任何其他设计决策。最终，这取决于。您应该学习那些对您的语言有用的模式（例如，Lisp 或 Smalltalk 中不需要许多 GoF 模式），了解它们的优缺点，了解系统的限制，并做出最适合您需求的选择.

我能给的最好的建议是学习、学习、学习。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-06T20:18:44.677

随着问题的复杂性增加，从简单的方法切换到正式的设计模式对我来说通常是相当自然的事情。关键是要足够熟悉模式，以便您能够识别临界点并从简单的方法切换到设计模式，因为它会为当前和未来的开发带来最大的好处。

对于一个更大、更复杂的项目，临界点应该是相当早的；在许多情况下，甚至在您开始编码之前。对于较小的项目，您可以在决定实施模式之前等待。

为了提高您识别何时应该使用模式的能力，您可以做的最好的事情之一就是在完成一个项目后花一些时间来检查您的“简单”方法变得多么复杂。如果实现一个模式会花费您更少的时间和精力，或者如果该模式会阐明您正在尝试做什么，那么您可以将这些知识归档，以备下次遇到类似问题时使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-06T20:39:51.997

当您遇到其中一种模式解决的问题时。GoF 书的每一章都有一节解释每种模式适用于哪些类型的场景。你不应该*分析*你遇到的每个问题，然后去查找要使用的模式。您应该熟悉这些模式，以便学会识别哪些情况需要它们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-10T02:53:57.703

原始 GoF 书籍的优点之一是讨论了该模式最能解决问题的场景。查看这些讨论可以帮助您确定是否“是时候”了。

另一个好的起点是 Head First Design Patterns。说明使用不同设计模式的练习非常详尽，足以提供良好的学习体验。此外，这些练习也以现实世界的场景为基础，因此可以毫不费力地确定何时应用设计模式的适当时机。

# nntp - NNTP死了吗？

> ID：263347
> 
> 赞同：15
> 
> 时间：2008-11-04T20:41:44.147
> 
> 标签：nntp, usenet

如果它死了，还有继承人吗？

### 对于那些不知道的人：

网络新闻传输协议或 NNTP 是一种 Internet 应用程序协议，主要用于阅读和发布 Usenet 文章（又名 netnews），以及在新闻服务器之间传输新闻。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-04T20:44:15.220

NNTP 没有死。它只是闻起来很有趣。

可悲的是，如今如果您想关注 10 个不同的论坛，那么您需要拥有 10 个不同的帐户并学习 10 个不同的 UI。我喜欢能够选择我喜欢的新闻阅读器，并且我的所有新闻组都有相同的界面。OpenID 可能会带回其中的一部分，但恐怕“新互联网”并不像“旧互联网”那样关心互操作性。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-04T20:44:52.177

它并没有死，但仍然被那些喜欢纯文本而不是动画表情和华丽的广告横幅的人使用。

说真的，我使用它已经十年了，我没有发现文章或用户数量有任何下降。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-04T20:49:16.753

它还没有死——例如，公共 C# 组中仍有大量流量。

StackOverflow 正在成为一个伪继承者——但仅适用于某些类型的线程。问答线程非常适合 SO；讨论线程在此处的效果不如在新闻组中的效果。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-12-23T05:15:22.390

我从来没有上过Usenet。但我使用了几个“私人”NNTP 服务器（与 Usenet 断开连接），包括到邮件列表的很棒的 NNTP 接口：http: [//gmane.org/](http://gmane.org/)

编辑：哦，我使用的那些服务器都不需要“帐户”。然而，它们完全没有垃圾邮件。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-04T23:07:29.860

我认识很多像我一样每天仍然使用 nntp / usenet 的人。这是一个绝对无价的工具。我怀疑它会很快消失。

这就像在线社区的弹球机。所有的新孩子可能都不知道它是怎么回事，可能认为它已经死了，但它仍然活着，还在踢，仍然没有什么可以比拟的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-04T20:50:28.903

它还没有死（还没有？），但它正在被提要和提要阅读器（RSS 和 Atom）所取代

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-04T21:00:47.447

它远没有以前那么重要。如今，任何流行的论坛都将是基于网络的。例如，如果基于 NNTP，stackoverflow 将非常糟糕。当您与论坛软件的交互如此有限时，您将无法提供相同的体验。

另一个大问题是您无法在 NNTP 上显示验证码，或者确实提供任何其他现代交互式反垃圾邮件措施。

我会说是的，它实际上已经死了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-04T22:47:06.483

同意，NNTP 的时间已经过去。我们有良好的连通性；不再需要跨多个服务器复制数据。我使用 Google Groups 而不是 NNTP。

然而，NNTP 确实提供了一些社区保证以防止灾难性故障。那里可能有一个开源项目，用于基于 Web 的论坛提供这种分布式、容错、负载平衡的服务。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-07T07:48:12.057

唯一真正的 NNTP 替换可能是邮件列表。不是任何基于网络的论坛。

# java - 最佳实践 - Swing，数据库访问

> ID：263348
> 
> 赞同：0
> 
> 时间：2008-11-04T20:41:52.650
> 
> 标签：java, swing

我是摇摆开发的新手。

我有一个需要从远程 sql 数据库访问数据的 Swing 应用程序。该应用程序的用户都位于我们的办公室。

直接从 Swing 应用程序访问数据库是不好的做法吗？

我应该将面向数据库的代码放入 rmi 服务器吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T20:48:31.763

不一定，但您会希望将应用程序中的数据访问代码“分层”，以便以后更容易执行。它还将倾向于使应用程序的其余部分更易于维护。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T20:44:38.883

您是否有计划处理对数据库中相同记录的并发访问？这是您必须处理的事情，因此，如果不在代码中，让 Swing 应用程序的所有实例都通过中央（即您的 RMI 服务器）位置访问数据会使这更容易。

# oop - “是”与“有”：哪个更好？

> ID：263355
> 
> 赞同：8
> 
> 时间：2008-11-04T20:43:47.840
> 
> 标签：oop, inheritance, composition

投资组合 A → 基金 1

投资组合 A → 基金 2

投资组合 A → 基金 3

如果不使用 is/has，我无法构筑我的句子。但在 1 和 2 之间，

1）有一个：

```
class PortfolioA
{
    List<Fund> obj;
} 
```

2）是一个：

```
class PortfolioA : List<Fund>
{

} 
```

从可扩展性和可用性的角度来看，您认为哪一个更好？我仍然可以通过任何一种方式访问​​我的资金，尽管有一点语法上的改变。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-04T21:03:21.843

我与其他认为 HAS-A 在这种情况下更好的人一起投票。你在评论中问：

> 当我说投资组合只是资金的集合，具有自己的一些属性，如 TotalPortfolio 等，这从根本上不会成为“is-a”吗？

我不这么认为。如果您说`Portfolio`IS-A `List<Fund>`，那么 Portfolio 的其他属性呢？当然，您可以向此类添加属性，但是将这些属性建模为 List 的属性是否准确？因为这基本上就是你正在做的事情。

此外，如果一个产品组合需要支持多个产品`List<Fund>`怎么办？例如，您可能有一个显示当前投资余额的列表，但另一个显示如何投资新贡献的列表。而当资金停产，用一套新的资金来接替它们时呢？历史信息有助于跟踪，以及当前的资金分配。

关键是所有这些属性都不是列表的正确属性，尽管它们可能是投资组合的属性。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-04T20:49:07.597

不要“总是”支持组合或继承，反之亦然；它们具有不同的语义（含义）；仔细查看含义，然后决定 - 一个是否比另一个“更容易”并不重要，对于长寿而言，正确的语义很重要

记住：is-a = 类型，has-a = 包含

所以在这种情况下，投资组合逻辑上是资金的集合；投资组合本身*不是一种**基金**，*所以组合是正确的关系

编辑：我最初误读了这个问题，但答案仍然是一样的。投资组合不是一种列表，它是具有自己属性的不同实体。例如，投资组合是具有初始投资成本、总现值、随时间变化的价值历史等的金融工具的集合，而列表是对象的简单集合。投资组合只是最抽象意义上的“列表类型”。

编辑 2：考虑投资组合的定义 - 它无一例外地被描述为事物的集合。艺术家的作品集是他们作品的集合，网页设计师的作品集是他们网站的集合，投资者的作品集包括他们拥有的所有金融工具，等等。很明显，我们需要一个列表（或某种列表）来表示投资组合，但这绝不意味着投资组合是一种列表！

假设我们决定让 Portfolio 从 List 继承。这一直有效，直到我们将股票、债券或贵金属添加到投资组合中，然后突然不正确的继承不再有效。或者假设我们被要求为比尔盖茨的投资组合建模，并发现 List 将耗尽内存 ;-) 更现实的是，在未来的重构之后，我们可能会发现我们应该从像 Asset 这样的基类继承，但是如果我们已经从 List 继承了，那么我们不能。

总结：区分我们选择表示一个概念的数据结构，以及概念本身的语义（类型层次结构）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-04T20:46:14.717

第一个，因为你应该尽可能地支持组合而不是继承。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-04T20:53:44.903

这取决于企业是否将投资组合定义为一组（并且只是一组）基金。如果它甚至极有可能包含其他对象，比如“财产”，那么选择选项 1。如果一组基金与投资组合的概念之间存在很强的联系，则选择选项 2。

就可扩展性和实用性而言，1 比 2 稍有优势。我真的不同意您应该始终偏爱一个而不是另一个的概念。这实际上取决于实际的现实生活概念是什么。请记住，您总是可以^重构。

^ 对于总是的大多数情况。如果是公开的，那显然不是。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-04T20:46:50.517

我会选择选项（1） - 组合，因为您最终可能具有特定于投资组合而不是基金的属性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-04T20:48:29.033

第一个，因为它是*“由”组成的*。=> 作文

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-04T21:58:59.513

我会与似乎普遍的观点不同。在这种情况下，我认为投资组合只不过是资金的集合......通过使用继承，您可以使用多个构造函数，如

```
public Portfolio(CLient client) {};
public Portfolio(Branch branch, bool Active, decimal valueThreshold)
{
    // code to populate collection with all active portfolios at the specified branch whose total vlaue exceeds specified threshold 
} 
```

和索引器，如：

```
public Fund this[int fundId] { get { return this.fundList[fundId]; } } 
```

等等等等

如果您希望能够使用相关语法将 Portfolio 类型的变量视为资金集合，那么这是更好的方法。

```
Portfolio BobsPortfolio = new Portfolio(Bob); 

foreach (Fund fund in BobsPortfolio)
{
    fund.SendStatement();
} 
```

或类似的东西

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-08-08T08:48:20.300

**IS-A 关系船**代表继承，**HAS-A 关系船**代表组合。对于上述场景，我们更喜欢组合，因为 PortfolioA 有一个列表，它不是列表类型。当 Portfolio A 是 List 类型时使用继承，但此处不是。因此，对于这种情况，我们应该更喜欢组合。

# xslt - XSLT 中的 SSN 格式？

> ID：263356
> 
> 赞同：1
> 
> 时间：2008-11-04T20:43:48.637
> 
> 标签：xslt

我可以使用一些帮助来创建一个 XSL 模板，该模板将采用一串数字（即 123456789）并将该字符串格式化为社会安全号码格式（即 123-45-6789）。我在 Internet 上找到[了一个示例](http://www.stylusstudio.com/xsllist/199905/post00480.html)，但它似乎过于复杂。

我是 XSLT 的新手，所以在回复时请记住这一点。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:20:37.970

XSLT 1.0 的字符串函数有点受限，但幸运的是这并不难：

假设<ssn>123456789</ssn>：

```
<xsl:template match="ssn">    
    <xsl:value-of select="substring(., 0, 4)"/>
    <xsl:text>-</xsl:text>
    <xsl:value-of select="substring(., 4, 2)"/>
    <xsl:text>-</xsl:text>
    <xsl:value-of select="substring(., 6, 4)"/>    
</xsl:template> 
```

在 XSLT 2.0 中， concat() 可以接受两个以上的参数，所以它是一行：

```
 <xsl:template match="ssn">
        <xsl:value-of select="concat(substring(., 0, 4), '-', substring(., 4, 2), '-', substring(., 6, 4))" />    
   </xsl:template> 
```

# javascript - 如何使用 Javascript/jQuery 确定图像是否已加载？

> ID：263359
> 
> 赞同：87
> 
> 时间：2008-11-04T20:44:37.840
> 
> 标签：javascript, jquery, image

我正在编写一些 Javascript 来调整大图像的大小以适应用户的浏览器窗口。（不幸的是，我不控制源图像的大小。）

所以像这样的东西会在 HTML 中：

```
<img id="photo"
     src="a_really_big_file.jpg"
     alt="this is some alt text"
     title="this is some title text" /> 
```

**有没有办法让我确定标签中的`src`图像`img`是否已下载？**

我需要这个，因为如果`$(document).ready()`在浏览器加载图像之前执行，我会遇到问题。 `$("#photo").width()`并将`$("#photo").height()`返回占位符的大小（替代文本）。就我而言，这类似于 134 x 20。

现在我只是检查照片的高度是否小于 150，并假设如果是这样，它只是 alt 文本。但这是一个相当大的技巧，如果照片的高度小于 150 像素（在我的特定情况下不太可能），或者 alt 文本的高度超过 150 像素（可能发生在小的浏览器窗口上），它就会中断.

* * *

**编辑：**对于任何想要查看代码的人：

```
$(function()
{
  var REAL_WIDTH = $("#photo").width();
  var REAL_HEIGHT = $("#photo").height();

  $(window).resize(adjust_photo_size);
  adjust_photo_size();

  function adjust_photo_size()
  {
    if(REAL_HEIGHT < 150)
    {
      REAL_WIDTH = $("#photo").width();
      REAL_HEIGHT = $("#photo").height();
      if(REAL_HEIGHT < 150)
      {
        //image not loaded.. try again in a quarter-second
        setTimeout(adjust_photo_size, 250);
        return;
      }
    }

    var new_width = . . . ;
    var new_height = . . . ;

    $("#photo").width(Math.round(new_width));
    $("#photo").height(Math.round(new_height));
  }

}); 
```

* * *

**更新**：感谢您的建议。如果我为`$("#photo").load`事件设置回调，则存在不会触发事件的风险，因此我直接在图像标签上定义了 onLoad 事件。作为记录，这是我最终使用的代码：

```
<img id="photo"
     onload="photoLoaded();"
     src="a_really_big_file.jpg"
     alt="this is some alt text"
     title="this is some title text" /> 
```

然后在Javascript中：

```
//This must be outside $() because it may get called first
var isPhotoLoaded = false;
function photoLoaded()
{
  isPhotoLoaded = true;
}

$(function()
{
  //Hides scrollbars, so we can resize properly.  Set with JS instead of
  //  CSS so that page doesn't break with JS disabled.
  $("body").css("overflow", "hidden");

  var REAL_WIDTH = -1;
  var REAL_HEIGHT = -1;

  $(window).resize(adjust_photo_size);
  adjust_photo_size();

  function adjust_photo_size()
  {
    if(!isPhotoLoaded)
    {
      //image not loaded.. try again in a quarter-second
      setTimeout(adjust_photo_size, 250);
      return;
    }
    else if(REAL_WIDTH < 0)
    {
      //first time in this function since photo loaded
      REAL_WIDTH = $("#photo").width();
      REAL_HEIGHT = $("#photo").height();
    }

    var new_width = . . . ;
    var new_height = . . . ;

    $("#photo").width(Math.round(new_width));
    $("#photo").height(Math.round(new_height));
  }

}); 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-04T21:04:44.740

要么添加一个事件监听器，要么让图像通过 onload 宣布自己。然后从那里找出尺寸。

```
<img id="photo"
     onload='loaded(this.id)'
     src="a_really_big_file.jpg"
     alt="this is some alt text"
     title="this is some title text" /> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-10-21T17:06:16.493

使用[jquery 数据存储](http://api.jquery.com/data/)，您可以定义“加载”状态。

```
<img id="myimage" onload="$(this).data('loaded', 'loaded');" src="lolcats.jpg" /> 
```

然后你可以在其他地方做：

```
if ($('#myimage').data('loaded')) {
    // loaded, so do stuff
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-09-28T21:49:36.083

正确的答案是使用[event.special.load](http://github.com/peol/jquery.imgloaded/raw/master/ahpi.imgload.js)

> 如果图像是从浏览器缓存中加载的，则可能不会触发 load 事件。为了解决这种可能性，我们可以使用一个特殊的加载事件，如果图像准备好，它会立即触发。event.special.load 目前可作为插件使用。

根据[.load()上的文档](http://api.jquery.com/load-event/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-04T21:30:35.843

你想做阿兰说的，但是要注意有时图像在 dom 准备好之前加载，这意味着你的负载处理程序不会触发。最好的方法是按照艾伦所说的那样做，但在附加负载处理程序后使用 javascript 设置图像的 src。这样你就可以保证它会触发。

在可访问性方面，您的网站仍然适用于没有 javascript 的人吗？您可能希望为 img 标签提供正确的 src，附加您的 dom 就绪处理程序以运行您的 js：清除图像 src（使用 css 给它一个固定的高度以防止页面闪烁），然后设置您的 img 加载处理程序，然后将 src 重置为正确的文件。这样你就涵盖了所有的基础:)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-04-01T22:14:57.520

根据最近对您原始问题的评论之一

```
$(function() {

  $(window).resize(adjust_photo_size);
  adjust_photo_size();

  function adjust_photo_size()  {
    if (!$("#photo").get(0).complete) {
       $("#photo").load(function() {
          adjust_photo_size();
       });
    } else {
      ... 
    }
}); 
```

**警告**这个答案可能会导致 ie8 及更低版本出现严重循环，因为浏览器并不总是正确设置 img.complete。如果您必须支持 ie8，请使用一个标志来记住图像已加载。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-04T21:21:59.293

尝试类似：

```
$("#photo").load(function() {
    alert("Hello from Image");
}); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-05-21T10:08:08.403

有一个名为“imagesLoaded”的 jQuery 插件，它提供了一种跨浏览器兼容的方法来检查元素的图像是否已加载。

网站：[https ://github.com/desandro/imagesloaded/](https://github.com/desandro/imagesloaded/)

用于内部包含许多图像的容器：

```
$('container').imagesLoaded(function(){
 console.log("I loaded!");
}) 
```

插件很棒：

1.  适用于检查内部有许多图像的容器
2.  用于检查 img 以查看它是否已加载

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-07-16T16:01:16.483

我发现这对我有用

```
document.querySelector("img").addEventListener("load", function() { alert('onload!'); }); 
```

完全归功于 Frank Schwieterman，他对接受的答案发表了评论。我不得不把这个放在这里，它太有价值了......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-28T21:45:14.087

对此有何评论？

...

```
doShow = function(){
  if($('#img_id').attr('complete')){
    alert('Image is loaded!');
  } else {
    window.setTimeout('doShow()',100);
  }
};

$('#img_id').attr('src','image.jpg');

doShow(); 
```

...

似乎到处都可以工作...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-17T17:56:06.227

我刚刚创建了一个 jQuery 函数来使用[jQuerys Deferred Object](http://api.jquery.com/category/deferred-object/)加载图像，这使得对加载/错误事件做出反应非常容易：

```
$.fn.extend({
    loadImg: function(url, timeout) {
        // init deferred object
        var defer = $.Deferred(),
            $img = this,
            img = $img.get(0),
            timer = null;

        // define load and error events BEFORE setting the src
        // otherwise IE might fire the event before listening to it
        $img.load(function(e) {
            var that = this;
            // defer this check in order to let IE catch the right image size
            window.setTimeout(function() {
                // make sure the width and height are > 0
                ((that.width > 0 && that.height > 0) ? 
                    defer.resolveWith : 
                    defer.rejectWith)($img);
            }, 1);
        }).error(function(e) {
            defer.rejectWith($img);
        });

        // start loading the image
        img.src = url;

        // check if it's already in the cache
        if (img.complete) {
            defer.resolveWith($img);
        } else if (0 !== timeout) {
            // add a timeout, by default 15 seconds
            timer = window.setTimeout(function() {
                defer.rejectWith($img);
            }, timeout || 15000);
        }

        // return the promise of the deferred object
        return defer.promise().always(function() {
            // stop the timeout timer
            window.clearTimeout(timer);
            timer = null;
            // unbind the load and error event
            this.off("load error");
        });
    }
}); 
```

**用法：**

```
var image = $('<img />').loadImg('http://www.google.com/intl/en_com/images/srpr/logo3w.png')
.done(function() {
    alert('image loaded');
    $('body').append(this);
}).fail(function(){
    alert('image failed');
}); 
```

看到它在工作：http: [//jsfiddle.net/roberkules/AdWZj/](http://jsfiddle.net/roberkules/AdWZj/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-05-20T05:34:00.827

此函数检查是否根据可测量的尺寸加载图像。如果您的脚本在某些图像已经加载后执行，则此技术很有用。

```
imageLoaded = function(node) {
    var w = 'undefined' != typeof node.clientWidth ? node.clientWidth : node.offsetWidth;
    var h = 'undefined' != typeof node.clientHeight ? node.clientHeight : node.offsetHeight;
    return w+h > 0 ? true : false;
}; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-12-03T19:34:05.137

我们开发了一个页面，它在其中加载了许多图像，然后仅在加载图像后才执行其他功能。这是一个繁忙的网站，产生了大量的流量。似乎以下简单脚本几乎适用于所有浏览器：

```
$(elem).onload = function() {
    doSomething();
} 
```

**但这是 IE9 的潜在问题！**

我们报告问题的唯一浏览器是 IE9。我们不感到惊讶吗？似乎解决该问题的最佳方法是在定义 onload 函数之前不为图像分配 src，如下所示：

```
$(elem).onload = function() {
    doSomething();
}
$(elem).attr('src','theimage.png'); 
```

似乎 IE 9 有时`onload`无论出于何种原因都不会抛出该事件。此页面上的其他解决方案（例如来自 Evan Carroll 的解决方案）仍然无效。从逻辑上讲，它检查了加载状态是否已经成功并触发了函数，如果没有，则设置 onload 处理程序，但即使你这样做了，我们在测试中也证明了图像可以在这两行 js 之间加载出现未加载到第一行，然后在设置 onload 处理程序之前加载。

`onload`我们发现获得所需内容的最佳方法是在设置事件触发器之前不定义图像的 src 。

我们最近才停止支持 IE8，所以我不能说 IE9 之前的版本，否则，在网站上使用的所有其他浏览器中——IE10 和 11 以及 Firefox、Chrome、Opera、Safari 等等人们使用的移动浏览器——`src`在分配`onload`处理程序之前设置甚至不是问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-05-29T17:51:37.343

我可以完全建议一个纯 CSS 解决方案吗？

只需有一个要在其中显示图像的 Div。将图像设置为背景。然后拥有财产`background-size: cover`或`background-size: contain`取决于您想要的方式。

`cover`将裁剪图像，直到较小的边覆盖框。 `contain`会将整个图像保留在 div 内，并在两侧留出空格。

检查下面的片段。

```
div {
  height: 300px;
  width: 300px;
  border: 3px dashed grey;
  background-position: center;
  background-repeat: no-repeat;
}

.cover-image {
  background-size: cover;
}

.contain-image {
  background-size: contain;
}
```

```
<div class="cover-image" style="background-image:url(https://assets1.ignimgs.com/2019/04/25/avengers-endgame-1280y-1556226255823_1280w.jpg)">
</div>
<br/>
<div class="contain-image" style="background-image:url(https://assets1.ignimgs.com/2019/04/25/avengers-endgame-1280y-1556226255823_1280w.jpg)">
</div>
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-02-02T20:29:19.547

我发现这个简单的解决方案最适合我：

```
 function setEqualHeight(a, b) {
            if (!$(a).height()) {
                return window.setTimeout(function(){ setEqualHeight(a, b); }, 1000);
            }
            $(b).height($(a).height());
        }

        $(document).ready(function() {
            setEqualHeight('#image', '#description');
            $(window).resize(function(){setEqualHeight('#image', '#description')});
        });
    </script> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-11T05:21:54.707

**image.complete** 可能是另一种选择[https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/complete](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/complete)

# security - 您如何支持带有散列或加密密码的 Web 应用程序？

> ID：263367
> 
> 赞同：8
> 
> 时间：2008-11-04T20:46:22.517
> 
> 标签：security, web-applications, passwords, credentials

在企业环境中支持新的 Web 应用程序时，通常需要以特定用户身份登录，以诊断他们遇到的实际或感知问题。这里有两个相反的问题：

1.  最佳做法是使用**散列或加密密码**，而不是明文。有时，中间有第三方 SSO（单点登录）。无法检索用户的密码。除非用户提供（不鼓励），否则无法以该用户身份登录。

2.  许多网络应用程序具有**个性化和复杂的授权**。不同的用户具有不同的角色（管理员、经理、用户），具有不同的权限。有时用户只能看到他们的数据——他们的客户或任务。一些用户具有只读访问权限，而其他用户可以编辑。因此，每个用户对 Web 应用程序的看法都是独一无二的。

假设在企业环境中，去用户的办公桌或直接连接到他们的机器是不可行的。

你如何处理这种情况？

编辑：我想重申，在全国乃至全球拥有数十万员工的大型金融机构或典型的财富 500 强公司中，某些 IT 部门的开发人员不可能直接访问用户的机器。其中一些是客户使用的面向公众的网络应用程序（例如网上银行和股票交易）。而且，其中许多是依赖 Active Directory 或 SSO 的 Intranet 应用程序，这意味着许多应用程序的用户凭据是相同的。我非常感谢大家的建议；有些可能在其他类型的环境中非常有用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-04T21:28:42.353

其中一些想法给用户带来了不便，要么强迫他们更改密码，要么占用他们的桌面进行调试会话。

Markc 的想法是最好的：增强您的身份验证逻辑以允许超级用户以特定用户身份登录，方法不是提供用户的凭据，而是提供用户名加上他们的超级用户凭据。

我过去做过这样的事情（伪python）：

```
if is_user_authenticated(username, userpassword):
    login the user
else if ':' in userpassword:
    supername, superpassword = userpassword.split(':')
    if is_superuser_authenticated(supername, superpassword):
        login the user 
```

换句话说，如果用户名和密码没有通过验证，如果密码有冒号，那么实际上是由冒号连接的管理员用户名和管理员密码，所以如果他们是正确的管理员用户名和密码，则以用户名登录。

这意味着您可以在不知道他们的秘密且不会给他们带来不便的情况下以用户身份登录。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-04T21:03:49.003

对于我们的 Web 应用程序，我们使用的过程由于缺乏更好的术语而被定义为“劫持”用户帐户。

基本上，管理员可以通过一个简单的按钮点击来“劫持”用户的帐户。在代码中，您只需使用唯一标识符（用户 ID 在不太安全的环境中工作），然后在会话中建立必要的凭据，以便它们可以在该用户的配置文件中工作。对于更安全的环境，您可以为每个用户使用唯一的哈希。

为了确保这种劫持方法是安全的，它总是首先验证请求是由具有适当权限的经过身份验证的管理员发出的。因此，有必要劫持管理员的会话或捕获他们的身份验证凭据，以便有人利用应用程序中的劫持功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T21:05:18.297

我有4个想法。当我打字时，其中 3 个已经被建议（所以我赞成）

想法 3 的变体 - 模仿：

为了使这与正常登录“尽可能相同”且代码更改最少，您可以添加在登录时直接模拟的能力，方法是提供管理员凭据和备用用户名，例如登录为 Admin:user、adminpassword。系统会将其视为使用 userpassword 以用户身份登录。

想法 4：您可以访问密码存储区吗？如果是这样，暂时用已知密码的哈希替换用户的哈希。（密码通常在线存储在数据库中。SQL 查询工具可以进行交换）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-04T20:50:21.573

管理员应该能够更改用户的密码。将用户的密码更改为您知道的密码。然后，您可以以该用户身份登录。

完成调试后告诉用户重置他/她的密码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-04T20:51:54.673

通常通过某种远程控制软件，可以用来查看他们的桌面。如果它们位于 Windows 终端服务器上，则可以使用内置的管理工具。否则我会在内部网络上使用 VNC 之类的东西，或者像 LogMeIn ( [http://www.logmein.com/](http://www.logmein.com/) ) 这样的外部服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T21:02:52.450

1.  您能否拥有一个测试环境，在该环境中定期剪切复制到的实时数据（显然已经过清理以解决任何安全或数据保护问题）。如果允许，可以使用与设置类似的用户进行故障排除，或者实际上是该用户。

2.  使用其他答案中提到的远程桌面客户端，但这对您来说可能并不实用。如果您在域内拥有这些权限，我听说过错误处理，甚至会进行屏幕截图并将其包含在日志中！但这对我来说听起来有点奇怪。

3.  您可以使用管理工具将用户克隆到演示帐户吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T17:26:12.107

我们在 Web 应用程序中使用的解决方案是让 authN/authZ 返回所需用户作为有效用户。我们通过一个管理功能来设置伪装，然后当我们询问当前登录的用户（current_user）时，我们处理伪装：

```
 def current_user_with_effective_user
    if masked?
      current_user_without_effective_user.masquerade_as
    else
      current_user_without_effective_user
    end
  end
  alias_method_chain, :current_user, :effective_user 
```

# c++ - c++中字符整数值的范围

> ID：263370
> 
> 赞同：15
> 
> 时间：2008-11-04T20:47:16.867
> 
> 标签：c++, language-implementation, language-details

我正在阅读*The C++ Programming Language*并在其中 Stroustrup 指出 char 的 int 值的范围可以从 0 到 255 或 -127 到 127，具体取决于实现。它是否正确？看起来应该是从-128到127。如果不是，为什么在第二种实现可能性中它们只有255个可能的值，而不是256。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-04T20:52:49.180

您陷入了[二进制补码的](http://en.wikipedia.org/wiki/Two%27s_complement)想法 - C++ 标准没有定义用于负数的表示！

如果您的计算机（上帝保佑）使用[反码](http://en.wikipedia.org/wiki/Ones_complement#Ones.27_complement)表示负数，则 8 位字节中的范围为 -127 到 + 127。从好的方面来说，零有两种不同的可能表示形式......

但是，在现实世界中，[您不太可能遇到补码计算机](https://stackoverflow.com/questions/161797/is-ones-complement-a-real-world-issue-or-just-a-historical-one)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-05T00:38:23.937

认为 unsigned char 的范围从 0 到 255 是错误的。这只是它的最小范围。一个 char 必须至少有 8 位，而有符号字符、无符号字符和 char 本身确实可以有更多的 8 位。所以这意味着 unsigned char 可以超过 255。虽然我承认，我没有一个超过 8 位的实现，但理论上是可能的。这是在 c89 标准（c++03 的基础）中指定的，记录了文件 limits.h（CHAR_BIT、UCHAR_MAX、CHAR_MAX）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T19:57:21.820

因为标准没有说明 char 类型，“char”可以是：

1.  某些编译器上的“unsigned char”（0-255）（例如：TexasInstruments 的 ARM 处理器编译器 - OMAP 系列）

2.  大多数编译器（gcc，MSVC ...）上的“signed char”（-128-127）

为了确保您始终有一个明确定义的范围，您应该使用“signed char”或“unsigned char”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-04T21:06:01.633

[C 和 C++ 中的字符类型](http://www.trilithium.com/johan/2005/01/char-types/)

从阅读来看，它似乎可以是其中任何一个，具体取决于实施。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T22:49:42.907

感谢 Roddy 和 Esteban Brenes 的有用回复。

这是我目前的理解：

有三种可能性。如果值表示为无符号，则 char 的范围为 0 到 255。如果值表示为带符号的二进制补码，则 char 的范围为 -128 到 127。最后，如果值表示为带符号的补码, char 的范围从 -127 到 127。最后的可能性表明，与前两个实现的 256 个可能值相比，只有 255 个可能值，但这没有考虑到补码表示中的负零.

# java - Java.util.Calendar - 自 1970 年 1 月 1 日以来的毫秒数

> ID：263376
> 
> 赞同：8
> 
> 时间：2008-11-04T20:48:24.227
> 
> 标签：java, calendar

程序后跟输出。有人请向我解释为什么 1970 年 1 月 1 日的 10,000,000 毫秒是 1969 年 11 月 31 日。好吧，请有人解释我的假设有什么问题，即第一次测试应该从 1970 年 1 月 1 日产生 10,000,000 毫秒的时间。小于 10,000,000 的数字产生同样的结果。

```
public static void main(String[] args) {

    String x = "10000000";
    long l = new Long(x).longValue();
    System.out.println("Long value: " + l);

    Calendar c = new GregorianCalendar();
    c.setTimeInMillis(l);
    System.out.println("Calendar time in Millis: " + c.getTimeInMillis());

    String origDate = c.get(Calendar.YEAR) + "-" + c.get(Calendar.MONTH) + "-" + c.get(Calendar.DAY_OF_MONTH);  
    System.out.println("Date in YYYY-MM-DD format: " + origDate);

    x = "1000000000000";
    l = new Long(x).longValue();
    System.out.println("\nLong value: " + l);

    c.setTimeInMillis(l);
    System.out.println("Calendar time in Millis: " + c.getTimeInMillis());

    origDate = c.get(Calendar.YEAR) + "-" + c.get(Calendar.MONTH) + "-" + c.get(Calendar.DAY_OF_MONTH);  
    System.out.println("Date in YYYY-MM-DD format: " + origDate);
} 
```

> 长值：10000000
> 
> 米利斯日历时间：10000000
> 
> YYYY-MM-DD 格式的日期：1969-11-31
> 
> 长值：1000000000000
> 
> 米利斯的日历时间：1000000000000
> 
> YYYY-MM-DD 格式的日期：2001-8-8

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-04T21:03:29.877

您打印的日期`Calendar`是您所在时区的本地日期，而纪元被定义为 UTC 1970-01-01 的午夜。因此，如果您居住在 UTC 以西的时区，那么您的日期将显示为 1969-12-31，即使（在 UTC 中）它仍然是 1970-01-01。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-04T21:05:55.720

首先，`c.get(Calendar.MONTH)`一月返回 0，二月返回 1，以此类推。

二、用于`DateFormat`输出日期。

第三，您的问题很好地说明了 Java 的 Date API 是多么尴尬。如果可以，请使用 Joda Time API。它会让你的生活更轻松一些。

这是您的代码的一个更好的示例，它指示时区：

```
public static void main(String[] args) {

    final DateFormat dateFormat = SimpleDateFormat.getDateTimeInstance(DateFormat.FULL, DateFormat.FULL);

    long l = 10000000L;
    System.out.println("Long value: " + l);
    Calendar c = new GregorianCalendar();
    c.setTimeInMillis(l);
    System.out.println("Date: " + dateFormat.format(c.getTime()));

    l = 1000000000000L;
    System.out.println("\nLong value: " + l);
    c.setTimeInMillis(l);
    System.out.println("Date: " + dateFormat.format(c.getTime()));
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-04T21:18:48.427

[Calendar#setTimeInMillis()](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Calendar.html#setTimeInMillis(long))将日历的时间设置为 1970 年 1 月 1 日**GMT**之后的毫秒数。

[Calendar#get()](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Calendar.html#get(int))返回为日历的时区调整的请求字段，默认情况下，它是**您机器的本地时区**。

如果您在构建日历时指定“GMT”时区，这应该可以正常工作：

```
Calendar c = new GregorianCalendar(TimeZone.getTimeZone("GMT")); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-05T00:25:11.217

可悲的是，`java.util.Date`设计`java.util.Calendar`不当导致了这种混乱。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T00:16:56.677

您的时区很可能落后于 GMT（例如 GMT-5），因此从 1969 年 12 月 31 日开始的 10,000,000 毫秒在您的时区，但是由于月份是从零开始的，因此`java.util.Calendar`您的`Calendar`-to-text 转换存在缺陷并且您得到 1969- 11-31 而不是预期的 1969-12-31。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T21:02:07.257

`c.setTimeInMillis(l);`如果你改变你的第一个，你可以弄清楚自己`c.clear();`

# asp.net - 在软件中显示过多的“皮肤”检测

> ID：263380
> 
> 赞同：31
> 
> 时间：2008-11-04T20:48:33.883
> 
> 标签：asp.net, image-processing

我正在构建一个 ASP.NET 网站，用户可以在其中上传自己的照片。每天可能会上传数千张照片。我的老板问过几次的一件事是，我们是否有任何方法可以检测是否有任何照片显示过多的“皮肤”，并在编辑做出最终决定之前自动将这些标记为“仅限成人”。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-11-04T21:22:42.520

Your best bet is to deal with the image in the HSV colour space (see [here](http://www.cs.rit.edu/~ncs/color/t_convert.html) for rgb - hsv conversion). The colour of skin is pretty much the same between all races, its just the saturation that changes. By dealing with the image in HSV you can simply search for the colour of skin.

You might do this by simply counting the number of pixel within a colour range, or you could [perform region](http://www.cse.unr.edu/~bebis/CS791E/Notes/RegionGrowing.pdf) growing around pixel to calculate the size of the areas the colour.

Edit: for dealing with grainy images, you might want to perform a [median filter](http://en.wikipedia.org/wiki/Median_filter) on the image first, and then reduce the number of colours to segment the image first, you will have to play around with the settings on a large set of pre-classifed (adult or not) images and see how the values behave to get a satisfactory level of detection.

EDIT: Heres some code that should do a simple count (not tested it, its a quick mashup of some code from [here](http://www.obnoxiouslyverbose.com/8/c-image-processing-performance-unsafe-vs-safe-code-part-i) and rgb to hsl [here](http://en.wikipedia.org/wiki/HSL_color_space))

```
Bitmap b = new Bitmap(_image);
BitmapData bData = b.LockBits(new Rectangle(0, 0, _image.Width, _image.Height), ImageLockMode.ReadWrite, b.PixelFormat);
byte bitsPerPixel = GetBitsPerPixel(bData.PixelFormat);
byte* scan0 = (byte*)bData.Scan0.ToPointer();

int count;

for (int i = 0; i < bData.Height; ++i)
{
    for (int j = 0; j < bData.Width; ++j)
    {
        byte* data = scan0 + i * bData.Stride + j * bitsPerPixel / 8;

        byte r = data[2];
        byte g = data[1];
        byte b = data[0];

        byte max = (byte)Math.Max(r, Math.Max(g, b));
        byte min = (byte)Math.Min(r, Math.Min(g, b));

        int h;

        if(max == min)
            h = 0;
        else if(r > g && r > b)
            h = (60 * ((g - b) / (max - min))) % 360;
        else if (g > r && g > b)
            h = 60 * ((b - r)/max - min) + 120;
        else if (b > r && b > g)
            h = 60 * ((r - g) / max - min) + 240;

        if(h > _lowerThresh && h < _upperThresh)
            count++;
    }
}
b.UnlockBits(bData); 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-11-04T21:46:56.327

当然，对于第一个发布某人脸部（或手、脚或诸如此类）特写的用户来说，这将失败。最终，所有这些形式的自动审查都将失败，直到计算机进行对象识别的方式发生真正的范式转变。

我并不是说你不应该尝试它。但我想指出这些问题。不要指望完美（甚至是好的）解决方案。它不存在。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-11-04T20:53:54.967

我怀疑是否存在任何现成的软件可以确定用户是否上传了顽皮的图片。最好的办法是让用户使用图片旁边的按钮将图片标记为“仅限成人”。（澄清：我指的是上传图片的用户以外的用户——类似于在 StackOverflow 上如何将帖子标记为攻击性。）

另外，请考虑对在专用产品中尝试做同样事情的评论：[http](http://www.dansdata.com/pornsweeper.htm) ://www.dansdata.com/pornsweeper.htm 。

链接从今天的 StackOverflow 播客中被盗，当然 :)。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-04T20:54:53.590

我们甚至无法编写过滤器来准确检测博客文章中的脏字，而您的老板却要一个色情检测器？[笨蛋！](http://thedailywtf.com/Articles/The-Clbuttic-Mistake-.aspx)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-04T21:32:26.993

I would say your answer lies in **crowdsourcing** the task. This almost always works and tends to scale *very* well.

It doesn't have to involve making some users into "admins" and coming up with different permissions - it can be as simple as to enable an "inappropriate" link near each image and keeping a count.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-17T18:34:24.770

请参阅Fleck/Forsyth 在 ECCV 上发表的开创性论文“ **Finding Naked People ”。**（先进的）。

[http://www.cs.hmc.edu/~fleck/naked.html](http://www.cs.hmc.edu/~fleck/naked.html)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-04T21:36:55.550

从理论/算法的角度来看，有趣的问题。解决该问题的一种方法是标记包含大肤色区域的图像（如 Trull 所解释的）。

然而，显示的皮肤数量并不是一个令人反感的图像的决定因素，而是显示皮肤的*位置*。也许您可以使用面部检测（搜索算法）来优化结果——确定皮肤区域相对于面部有多大，以及它们是否属于面部（可能低于面部多远）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-04T21:46:45.297

我会从统计的角度来解决这个问题。获取一堆你认为安全的图片和一堆你不认为安全的图片（这将使研究变得有趣），看看它们有什么共同点。分析它们的颜色范围和饱和度，看看你是否能找出所有顽皮照片的特征，而安全照片中很少有。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-04T21:42:07.850

我知道 Flickr 或 Picasa 已经实现了这一点。我相信这个例程被称为 FleshFinder。

关于这样做的架构的提示：

将此作为独立于 ASP.NET 管道的 Windows 服务运行，而不是实时分析图像，而是创建一个新图像队列，这些图像被上传以供服务处理。

如果需要，您可以使用普通的 System.Drawing 东西，但如果您确实需要处理大量图像，最好使用本机代码和高性能图形库并从您的服务中 P/invoke 例程。

由于资源可用，在后台处理图像并标记可疑以供编辑审查的图像，这应该会显着减少要审查的图像数量，同时不会惹恼上传肤色房屋图片的人。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-04T21:28:16.473

Perhaps the [Porn Breath Test](http://yro.slashdot.org/yro/08/11/04/1746220.shtml) would be helpful - as reported on Slashdot.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-05T13:56:09.317

[Rigan Ap-apid](http://www.dlsu.edu.ph/faculty/fis/faculty_info.asp?fac_id=103945856)在 WorldComp '08 上就这个问题空间发表了一篇论文。据称该文件[在这里](http://serv1.ist.psu.edu:8080/viewdoc/download;jsessionid=92D8115F9C98B5DC6C8459E1A038AE46?doi=10.1.1.96.9872&rep=rep1&type=pdf)，但服务器对我来说超时了。我参加了论文的介绍，他介绍了类似的系统及其有效性以及他自己的方法。你可以直接联系他。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-04T21:15:54.627

I'm afraid I can't help point you in the right direction, but I do remember reading about this being done before. It was in the context of people complaining about baby pictures being caught and flagged mistakenly. If nothing else, I can give you the hope that you don't have to invent the wheel all by yourself... Someone else has been down this road!

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-06T21:21:34.473

[Dolores Labs](http://doloreslabs.com)的[CrowdSifter](http://crowdsifter.com)可能会为您解决问题。我一直在阅读他们的博客，因为他们似乎喜欢统计数据和众包并且喜欢谈论它。他们使用亚马逊的机械土耳其人进行大量处理，并且知道如何处理结果以从事物中获得正确的答案。至少看看他们的博客，看看一些很酷的统计实验。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-07-07T16:40:48.947

正如上面提到的比尔（和克雷格的谷歌报价）统计方法可以非常有效。

您可能想要研究的两种方法是：

*   神经网络
*   多变量分析 (MVA)

MVA 方法是获取可接受图片和不可接受图片的“代表性样本”。X 数据将是每张图片的字节数组，Y 将由您指定为 1 表示不可接受，0 表示可接受。使用此数据创建 PLS 模型。针对模型运行新数据，看看它对 Y 的预测效果如何。

而不是这种二元方法，您可以有多个 Y（例如 0=可接受，1=泳装/内衣，2=色情）

要构建模型，您可以查看开源软件或有许多可用的商业软件包（尽管它们通常不便宜）

因为即使是最好的统计方法也不是完美的，包括用户反馈的想法可能是一个好主意。

祝你好运（在最坏的情况下，你会花时间收集顽皮的图片作为一项经批准和付费的活动！）

# model-view-controller - MonoRail 是否已准备好进行生产使用？

> ID：263385
> 
> 赞同：4
> 
> 时间：2008-11-04T20:49:21.963
> 
> 标签：model-view-controller, castle-monorail

现在我不确定...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T23:36:05.607

我会说是的。我正在使用它。我知道 Universal 在他们的一些（数千个）网站上使用它。但是，我将添加一些警告：

1.  设置它存在严重问题，特别是如果您想调试到库中。
2.  辅助函数支持原型，而不是更现代的 jQuery。然而，这种情况正在迅速改变。
3.  文档有点混乱，Castle 团队也在努力解决这个问题。

我不保证每一个“外在”功能都能正常工作，但系统的重点实际上是保持简单。

与普通的 ASP.NET 相比，这绝对是一种享受。我向你保证，你不会错过 viewstate。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T17:03:21.887

在过去的一年半里，我们一直在用它构建一个相当大的应用程序。不必处理旧的基于 ASP/Page 的模型并使用更好的模型/视图/控制器设计模式真是太好了。

要获得新的东西，你真的需要从开发的主干上工作，因为他们不经常发布。我们有很多涉及框架的测试，所以当框架中的更新破坏了我们所依赖的东西时，我们会立即知道它。

如果您必须在 .NET 中工作，这将比其他选择更胜一筹。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:23:17.737

单轨论坛上有一个概述：http: [//forum.castleproject.org/viewforum.php?f= 6](http://forum.castleproject.org/viewforum.php?f=6)

我将它用于应用程序并且没有任何大问题。最大的问题确实是找到好的文档和示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T03:42:50.343

我设置它没有问题。朱利安，我认为在没有任何进一步澄清或示例的情况下说“严重问题”之类的话是没有建设性的。

调试到库是微不足道的。因为它是开源的，所以你可以调试整个事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-17T08:21:26.083

作为员工、独立承包商以及与工作无关的站点，我多年来一直在使用 MonoRail 进行许多项目的生产。

我知道我对此有偏见，但我可以全心全意地保证，我积极的**使用**体验是诱使我为项目做出贡献的原因，而不是相反。

# php - 处理 PHP JSON 对象中的数据

> ID：263392
> 
> 赞同：85
> 
> 时间：2008-11-04T20:50:56.657
> 
> 标签：php, json

来自 Twitter 搜索 API 的 JSON 格式的趋势数据。

使用以下方法获取文件：

```
$jsonurl = "http://search.twitter.com/trends.json";
$json = file_get_contents($jsonurl,0,null,null);
$json_output = json_decode($json); 
```

如何处理来自该对象的数据。作为一个数组？只需要从 [name] 值中提取数据。

JSON 对象包含：

```
stdClass Object
(
    [trends] => Array
        (
            [0] => stdClass Object
                (
                    [name] => Vote
                    [url] => http://search.twitter.com/search?q=Vote
                )

            [1] => stdClass Object
                (
                    [name] => Halloween
                    [url] => http://search.twitter.com/search?q=Halloween
                )

            [2] => stdClass Object
                (
                    [name] => Starbucks
                    [url] => http://search.twitter.com/search?q=Starbucks
                )

            [3] => stdClass Object
                (
                    [name] => #flylady
                    [url] => http://search.twitter.com/search?q=%23flylady
                )

            [4] => stdClass Object
                (
                    [name] => #votereport
                    [url] => http://search.twitter.com/search?q=%23votereport
                )

            [5] => stdClass Object
                (
                    [name] => Election Day
                    [url] => http://search.twitter.com/search?q=%22Election+Day%22
                )

            [6] => stdClass Object
                (
                    [name] => #PubCon
                    [url] => http://search.twitter.com/search?q=%23PubCon
                )

            [7] => stdClass Object
                (
                    [name] => #defrag08
                    [url] => http://search.twitter.com/search?q=%23defrag08
                )

            [8] => stdClass Object
                (
                    [name] => Melbourne Cup
                    [url] => http://search.twitter.com/search?q=%22Melbourne+Cup%22
                )

            [9] => stdClass Object
                (
                    [name] => Cheney
                    [url] => http://search.twitter.com/search?q=Cheney
                )

        )

    [as_of] => Mon, 03 Nov 2008 21:49:36 +0000
) 
```

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2008-11-04T20:59:07.717

你的意思是这样的？

```
<?php

$jsonurl = "http://search.twitter.com/trends.json";
$json = file_get_contents($jsonurl,0,null,null);
$json_output = json_decode($json);

foreach ( $json_output->trends as $trend )
{
    echo "{$trend->name}\n";
} 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2010-11-03T12:58:47.963

如果您使用`json_decode($string, true)`，您将不会获得任何对象，而是将所有内容作为关联数组或数字索引数组。更容易处理，因为 PHP 提供的 stdObject 只不过是一个具有公共属性的愚蠢容器，无法使用您自己的功能进行扩展。

```
$array = json_decode($string, true);

echo $array['trends'][0]['name']; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-04T21:03:52.857

就像你定义的对象一样使用它。IE

```
$trends = $json_output->trends; 
```

# .net - 覆盖 GetHashCode 的最佳算法是什么？

> ID：263400
> 
> 赞同：1581
> 
> 时间：2008-11-04T20:53:19.927
> 
> 标签：.net, algorithm, hashcode, gethashcode

在 .NET 中，该[`GetHashCode`方法](https://docs.microsoft.com/en-us/dotnet/api/system.object.gethashcode)在整个 .NET 基类库中的很多地方都使用。正确实施它对于在集合中快速查找项目或确定相等性时尤为重要。

是否有关于如何`GetHashCode`为我的自定义类实现的标准算法或最佳实践，这样我就不会降低性能？

* * *

## 回答 #1

> 赞同：1727
> 
> 时间：2008-11-04T20:56:17.130

我通常会使用类似于 Josh Bloch*精彩的* [Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)中给出的实现。它速度很快，并且创建了一个不太可能导致冲突的非常好的哈希。选择两个不同的素数，例如 17 和 23，然后：

```
public override int GetHashCode()
{
    unchecked // Overflow is fine, just wrap
    {
        int hash = 17;
        // Suitable nullity checks etc, of course :)
        hash = hash * 23 + field1.GetHashCode();
        hash = hash * 23 + field2.GetHashCode();
        hash = hash * 23 + field3.GetHashCode();
        return hash;
    }
} 
```

如评论中所述，您可能会发现最好选择一个大素数来乘以。显然 486187739 很好......虽然我看到的大多数小数字示例都倾向于使用素数，但至少有类似的算法经常使用非素数。例如，在稍后的不完全[FNV](https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function)示例中，我使用了显然工作良好的数字 - 但初始值不是质数。（虽然乘法常数*是*素数。我不知道这有多重要。）

这比`XOR`ing 哈希码的常见做法更好，主要有两个原因。假设我们有一个包含两个`int`字段的类型：

```
XorHash(x, x) == XorHash(y, y) == 0 for all x, y
XorHash(x, y) == XorHash(y, x) for all x, y 
```

顺便说一句，早期的算法是 C# 编译器当前用于匿名类型的算法。

[这个页面](http://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx)提供了很多选项。我认为在大多数情况下，上述内容“足够好”，并且非常容易记住和正确。[FNV](http://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx#fnv)替代方案同样简单，但使用不同的常数，而`XOR`不是`ADD`作为组合操作。它看起来*像*下面的代码，但正常的 FNV 算法对单个字节进行操作，因此这需要修改为每个字节执行一次迭代，而不是每个 32 位哈希值。FNV 也是为可变长度的数据设计的，而我们在这里使用它的方式总是针对相同数量的字段值。对此答案的评论表明，此处的代码实际上并不像上面的添加方法那样有效（在测试的示例案例中）。

```
// Note: Not quite FNV!
public override int GetHashCode()
{
    unchecked // Overflow is fine, just wrap
    {
        int hash = (int) 2166136261;
        // Suitable nullity checks etc, of course :)
        hash = (hash * 16777619) ^ field1.GetHashCode();
        hash = (hash * 16777619) ^ field2.GetHashCode();
        hash = (hash * 16777619) ^ field3.GetHashCode();
        return hash;
    }
} 
```

请注意，要注意的一件事是，理想情况下，您应该防止在将您的平等敏感（因此哈希码敏感）状态添加到依赖于哈希码的集合后发生变化。

根据[文档](https://docs.microsoft.com/en-us/dotnet/api/system.object.gethashcode#notes-to-inheritors)：

> 您可以为不可变引用类型覆盖 GetHashCode。一般来说，对于可变引用类型，只有在以下情况下才应该覆盖 GetHashCode：
> 
> *   您可以从不可变的字段计算哈希码；或者
> *   您可以确保当对象包含在依赖于其哈希码的集合中时，可变对象的哈希码不会改变。

[FNV](http://eternallyconfuzzled.com/tuts/algorithms/jsw_tut_hashing.aspx)文章的链接已损坏，但这是 Internet 档案中的副本：[Eternally Confuzzled - The Art of Hashing](https://archive.vn/KJeJy)

* * *

## 回答 #2

> 赞同：504
> 
> 时间：2011-01-07T21:38:29.767

# ValueTuple - C# 7 的更新

正如@cactuaroid 在评论中提到的，可以使用一个值元组。这节省了一些击键，更重要的是纯粹在堆栈上执行（无垃圾）：

```
(PropA, PropB, PropC, PropD).GetHashCode(); 
```

（注意：使用匿名类型的原始技术似乎是在堆上创建一个对象，即垃圾，因为匿名类型是作为类实现的，尽管编译器可能会对此进行优化。对这些选项进行基准测试会很有趣，但是tuple 选项应该更好。）

# 匿名类型（原始答案）

Microsoft 已经提供了一个很好的通用 HashCode 生成器：只需将您的属性/字段值复制到匿名类型并对其进行哈希处理：

```
new { PropA, PropB, PropC, PropD }.GetHashCode(); 
```

这适用于任意数量的属性。它不使用拳击。它只是使用已经在匿名类型框架中实现的算法。

* * *

## 回答 #3

> 赞同：110
> 
> 时间：2010-04-04T18:26:08.263

这是我的哈希码助手。
它的优点是它使用泛型类型参数，因此不会导致装箱：

```
public static class HashHelper
{
    public static int GetHashCode<T1, T2>(T1 arg1, T2 arg2)
    {
         unchecked
         {
             return 31 * arg1.GetHashCode() + arg2.GetHashCode();
         }
    }

    public static int GetHashCode<T1, T2, T3>(T1 arg1, T2 arg2, T3 arg3)
    {
        unchecked
        {
            int hash = arg1.GetHashCode();
            hash = 31 * hash + arg2.GetHashCode();
            return 31 * hash + arg3.GetHashCode();
        }
    }

    public static int GetHashCode<T1, T2, T3, T4>(T1 arg1, T2 arg2, T3 arg3, 
        T4 arg4)
    {
        unchecked
        {
            int hash = arg1.GetHashCode();
            hash = 31 * hash + arg2.GetHashCode();
            hash = 31 * hash + arg3.GetHashCode();
            return 31 * hash + arg4.GetHashCode();
        }
    }

    public static int GetHashCode<T>(T[] list)
    {
        unchecked
        {
            int hash = 0;
            foreach (var item in list)
            {
                hash = 31 * hash + item.GetHashCode();
            }
            return hash;
        }
    }

    public static int GetHashCode<T>(IEnumerable<T> list)
    {
        unchecked
        {
            int hash = 0;
            foreach (var item in list)
            {
                hash = 31 * hash + item.GetHashCode();
            }
            return hash;
        }
    }

    /// <summary>
    /// Gets a hashcode for a collection for that the order of items 
    /// does not matter.
    /// So {1, 2, 3} and {3, 2, 1} will get same hash code.
    /// </summary>
    public static int GetHashCodeForOrderNoMatterCollection<T>(
        IEnumerable<T> list)
    {
        unchecked
        {
            int hash = 0;
            int count = 0;
            foreach (var item in list)
            {
                hash += item.GetHashCode();
                count++;
            }
            return 31 * hash + count.GetHashCode();
        }
    }

    /// <summary>
    /// Alternative way to get a hashcode is to use a fluent 
    /// interface like this:<br />
    /// return 0.CombineHashCode(field1).CombineHashCode(field2).
    ///     CombineHashCode(field3);
    /// </summary>
    public static int CombineHashCode<T>(this int hashCode, T arg)
    {
        unchecked
        {
            return 31 * hashCode + arg.GetHashCode();   
        }
    } 
```

它还具有扩展方法来提供流畅的界面，因此您可以像这样使用它：

```
public override int GetHashCode()
{
    return HashHelper.GetHashCode(Manufacturer, PartN, Quantity);
} 
```

或像这样：

```
public override int GetHashCode()
{
    return 0.CombineHashCode(Manufacturer)
        .CombineHashCode(PartN)
        .CombineHashCode(Quantity);
} 
```

* * *

## 回答 #4

> 赞同：101
> 
> 时间：2019-06-11T08:34:08.600

# 使用`System.HashCode`

如果您使用的是 .NET Standard 2.1 或更高版本，则可以使用[System.HashCode](https://docs.microsoft.com/en-us/dotnet/api/system.hashcode?view=netcore-2.1)结构。在早期的框架中，它可以从[`Microsoft.Bcl.HashCode`](https://www.nuget.org/packages/Microsoft.Bcl.HashCode/)包中获得。有两种使用方法：

### 哈希码组合

该`Combine`方法可用于创建一个哈希码，最多给定八个对象。

```
public override int GetHashCode() => HashCode.Combine(this.object1, this.object2); 
```

### HashCode.Add

该`Add`方法可帮助您处理集合：

```
public override int GetHashCode()
{
    var hashCode = new HashCode();
    hashCode.Add(this.object1);
    foreach (var item in this.collection)
    {
        hashCode.Add(item);
    }
    return hashCode.ToHashCode();
} 
```

# GetHashCode 变得简单

一个替代方案`System.HashCode`是超级容易使用，同时仍然很快。您可以阅读完整的博客文章“ [GetHashCode Made Easy](https://rehansaeed.com/gethashcode-made-easy/) ”以获取更多详细信息和评论。

### 使用示例

```
public class SuperHero
{
    public int Age { get; set; }
    public string Name { get; set; }
    public List<string> Powers { get; set; }

    public override int GetHashCode() =>
        HashCode.Of(this.Name).And(this.Age).AndEach(this.Powers);
} 
```

### 执行

```
public struct HashCode : IEquatable<HashCode>
{
    private const int EmptyCollectionPrimeNumber = 19;
    private readonly int value;

    private HashCode(int value) => this.value = value;

    public static implicit operator int(HashCode hashCode) => hashCode.value;

    public static bool operator ==(HashCode left, HashCode right) => left.Equals(right);

    public static bool operator !=(HashCode left, HashCode right) => !(left == right);

    public static HashCode Of<T>(T item) => new HashCode(GetHashCode(item));

    public static HashCode OfEach<T>(IEnumerable<T> items) =>
        items == null ? new HashCode(0) : new HashCode(GetHashCode(items, 0));

    public HashCode And<T>(T item) => 
        new HashCode(CombineHashCodes(this.value, GetHashCode(item)));

    public HashCode AndEach<T>(IEnumerable<T> items)
    {
        if (items == null)
        {
            return new HashCode(this.value);
        }

        return new HashCode(GetHashCode(items, this.value));
    }

    public bool Equals(HashCode other) => this.value.Equals(other.value);

    public override bool Equals(object obj)
    {
        if (obj is HashCode)
        {
            return this.Equals((HashCode)obj);
        }

        return false;
    }

    public override int GetHashCode() => this.value.GetHashCode();

    private static int CombineHashCodes(int h1, int h2)
    {
        unchecked
        {
            // Code copied from System.Tuple a good way to combine hashes.
            return ((h1 << 5) + h1) ^ h2;
        }
    }

    private static int GetHashCode<T>(T item) => item?.GetHashCode() ?? 0;

    private static int GetHashCode<T>(IEnumerable<T> items, int startHashCode)
    {
        var temp = startHashCode;

        var enumerator = items.GetEnumerator();
        if (enumerator.MoveNext())
        {
            temp = CombineHashCodes(temp, GetHashCode(enumerator.Current));

            while (enumerator.MoveNext())
            {
                temp = CombineHashCodes(temp, GetHashCode(enumerator.Current));
            }
        }
        else
        {
            temp = CombineHashCodes(temp, EmptyCollectionPrimeNumber);
        }

        return temp;
    }
} 
```

# 什么是好的算法？

## 表现

计算哈希码的算法需要很快。一个简单的算法通常会更快。不分配额外内存的一个也将减少垃圾收集的需求，这反过来也将提高性能。

特别是在 C# 哈希函数中，您经常使用`unchecked`停止溢出检查的关键字来提高性能。

## 确定性

散列算法需要是[确定性](https://en.wikipedia.org/wiki/Deterministic_algorithm)的，即给定相同的输入，它必须始终产生相同的输出。

## 减少碰撞

计算哈希码的算法需要将[哈希冲突](http://crppit.epfl.ch/documentation/Hash_Function/WiKi/Hash_collision.htm)保持在最低限度。哈希冲突是当`GetHashCode`对两个不同对象的两次调用产生相同的哈希码时发生的情况。请注意，允许碰撞（有些人误解为不允许碰撞），但应将其保持在最低限度。

很多散列函数都包含像`17`or这样的幻数`23`。这些是特殊的[素数](https://en.wikipedia.org/wiki/Prime_number)，由于它们的数学特性，与使用非素数相比，它们有助于减少散列冲突。

## 哈希均匀度

一个好的散列函数应该在其输出范围内尽可能均匀地映射预期输入，即它应该基于其均匀分布的输入输出广泛的散列。它应该具有哈希一致性。

## 防止 DoS

在 .NET Core 中，每次重新启动应用程序时，都会得到不同的哈希码。这是一项防止拒绝服务攻击 (DoS) 的安全功能。对于 .NET Framework，您**应该**通过添加以下 App.config 文件来启用此功能：

```
<?xml version ="1.0"?>  
<configuration>  
   <runtime>  
      <UseRandomizedStringHashAlgorithm enabled="1" />  
   </runtime>  
</configuration> 
```

由于这个特性，哈希码不应该在创建它们的应用程序域之外使用，它们不应该被用作集合中的关键字段并且它们不应该被持久化。

[在此处](https://andrewlock.net/why-is-string-gethashcode-different-each-time-i-run-my-program-in-net-core/)阅读有关此内容的更多信息。

# 加密安全？

该算法不必是[密码散列函数](https://en.wikipedia.org/wiki/Cryptographic_hash_function)。这意味着它不必满足以下条件：

*   生成产生给定哈希值的消息是不可行的。
*   找到两个具有相同哈希值的不同消息是不可行的。
*   对消息的微小更改应该会如此广泛地更改哈希值，以致新的哈希值看起来与旧的哈希值不相关（雪崩效应）。

* * *

## 回答 #5

> 赞同：65
> 
> 时间：2009-02-23T11:46:55.650

我在 Helper 库中有一个 Hashing 类，我将其用于此目的。

```
/// <summary> 
/// This is a simple hashing function from Robert Sedgwicks Hashing in C book.
/// Also, some simple optimizations to the algorithm in order to speed up
/// its hashing process have been added. from: www.partow.net
/// </summary>
/// <param name="input">array of objects, parameters combination that you need
/// to get a unique hash code for them</param>
/// <returns>Hash code</returns>
public static int RSHash(params object[] input)
{
    const int b = 378551;
    int a = 63689;
    int hash = 0;

    // If it overflows then just wrap around
    unchecked
    {
        for (int i = 0; i < input.Length; i++)
        {
            if (input[i] != null)
            {
                hash = hash * a + input[i].GetHashCode();
                a = a * b;
            }
        }
    }

    return hash;
} 
```

然后，您可以简单地将其用作：

```
public override int GetHashCode()
{
    return Hashing.RSHash(_field1, _field2, _field3);
} 
```

我没有评估它的性能，所以欢迎任何反馈。

* * *

## 回答 #6

> 赞同：59
> 
> 时间：2013-09-04T12:32:48.913

[这是我使用Jon Skeet 实现](https://stackoverflow.com/a/263416/704144)的助手类。

```
public static class HashCode
{
    public const int Start = 17;

    public static int Hash<T>(this int hash, T obj)
    {
        var h = EqualityComparer<T>.Default.GetHashCode(obj);
        return unchecked((hash * 31) + h);
    }
} 
```

用法：

```
public override int GetHashCode()
{
    return HashCode.Start
        .Hash(_field1)
        .Hash(_field2)
        .Hash(_field3);
} 
```

如果您想避免为 System.Int32 编写扩展方法：

```
public readonly struct HashCode
{
    private readonly int _value;

    public HashCode(int value) => _value = value;

    public static HashCode Start { get; } = new HashCode(17);

    public static implicit operator int(HashCode hash) => hash._value;

    public HashCode Hash<T>(T obj)
    {
        var h = EqualityComparer<T>.Default.GetHashCode(obj);
        return unchecked(new HashCode((_value * 31) + h));
    }

    public override int GetHashCode() => _value;
} 
```

它仍然避免了任何堆分配，并且使用方式完全相同：

```
public override int GetHashCode()
{
    // This time `HashCode.Start` is not an `Int32`, it's a `HashCode` instance.
    // And the result is implicitly converted to `Int32`.
    return HashCode.Start
        .Hash(_field1)
        .Hash(_field2)     
        .Hash(_field3);
} 
```

编辑（2018 年 5 月）：`EqualityComparer<T>.Default`getter 现在是 JIT 内在函数——Stephen Toub 在[这篇博](https://blogs.msdn.microsoft.com/dotnet/2018/04/18/performance-improvements-in-net-core-2-1)文中提到了[拉取请求](https://github.com/dotnet/coreclr/pull/14125)。

* * *

## 回答 #7

> 赞同：30
> 
> 时间：2009-02-23T11:55:44.350

在 Equals() 比较多个字段的大多数情况下，您的 GetHash() 是否在一个字段或多个字段上散列并不重要。您只需要确保计算哈希真的很便宜（请**不要分配**）和快速（**没有繁重的计算**，当然也没有数据库连接）并提供良好的分布。

繁重的工作应该是 Equals() 方法的一部分；散列应该是一个非常便宜的操作，可以在尽可能少的项目上调用 Equals()。

最后一个提示：**不要依赖 GetHashCode() 在多个应用程序运行中保持稳定**。许多 .Net 类型不保证其哈希码在重新启动后保持不变，因此您应该只将 GetHashCode() 的值用于内存数据结构。

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2014-01-14T14:15:33.613

直到最近，我的回答都非常接近 Jon Skeet 的回答。然而，我最近开始了一个使用二次幂哈希表的项目，即内部表大小为 8、16、32 等的哈希表。支持质数大小是有充分理由的，但是也是二次方大小的一些优势。

它非常糟糕。因此，经过一些实验和研究后，我开始使用以下内容重新散列我的哈希：

```
public static int ReHash(int source)
{
  unchecked
  {
    ulong c = 0xDEADBEEFDEADBEEF + (ulong)source;
    ulong d = 0xE2ADBEEFDEADBEEF ^ c;
    ulong a = d += c = c << 15 | c >> -15;
    ulong b = a += d = d << 52 | d >> -52;
    c ^= b += a = a << 26 | a >> -26;
    d ^= c += b = b << 51 | b >> -51;
    a ^= d += c = c << 28 | c >> -28;
    b ^= a += d = d << 9 | d >> -9;
    c ^= b += a = a << 47 | a >> -47;
    d ^= c += b << 54 | b >> -54;
    a ^= d += c << 32 | c >> 32;
    a += d << 25 | d >> -25;
    return (int)(a >> 1);
  }
} 
```

然后我的二次幂哈希表不再糟糕了。

但这让我感到不安，因为上述内容不应该起作用。或者更准确地说，它不应该起作用，除非原件`GetHashCode()`以非常特殊的方式很差。

重新混合一个哈希码并不能改进一个很好的哈希码，因为唯一可能的效果是我们引入了更多的冲突。

重新混合哈希码并不能改善糟糕的哈希码，因为唯一可能的影响是我们将值 53 上的大量冲突更改为大量值 18,3487,291。

重新混合散列码只能改进散列码，该散列码在避免其范围内的绝对冲突（2 ^(32 个)可能值）方面至少做得相当好，但在对散列表中的实际使用进行取模时在避免冲突方面表现不佳。虽然 2 的幂表的更简单的模数使这一点更加明显，但它也对更常见的素数表产生了负面影响，这并不那么明显（重新散列的额外工作将超过好处，但好处仍然存在）。

编辑：我也在使用开放寻址，这也会增加对碰撞的敏感性，也许比它是二次幂的事实更重要。

好吧，令人不安的是[.NET](https://referencesource.microsoft.com/#mscorlib/System/string.cs,789)`string.GetHashCode()`中的实现（或[在此处](https://stackoverflow.com/a/48775953/147511)研究）可以通过这种方式改进多少（由于更少的冲突，测试运行速度提高了大约 20-30 倍），更令人不安的是我自己的哈希码有多少可以改进（远不止这些）。

**我过去编写的所有 GetHashCode() 实现，并且确实用作该站点上答案的基础，都比我通过的要糟糕得多**。很多时候它对于大部分用途来说“足够好”，但我想要更好的东西。

所以我把那个项目放在一边（无论如何它是一个宠物项目），并开始研究如何在 .NET 中快速生成一个好的、分布良好的哈希码。

最后，我决定将[SpookyHash](http://burtleburtle.net/bob/hash/spooky.html)移植到 .NET。实际上，上面的代码是使用 SpookyHash 从 32 位输入生成 32 位输出的快速路径版本。

现在，SpookyHash 不是一个快速记住代码的好方法。我的端口更是如此，因为我手动内联了很多以提高速度*。但这就是代码重用的目的。

然后我把*那个*项目放在一边，因为就像原来的项目产生了如何产生更好的哈希码的问题一样，这个项目产生了如何产生更好的 .NET memcpy 的问题。

然后我回来了，并产生了很多重载，以便轻松地将几乎所有本机类型（`decimal`†除外）提供给哈希码。

它的速度很快，Bob Jenkins 应该得到大部分的赞誉，因为我从中移植的他的原始代码仍然更快，尤其是在算法优化的 64 位机器上‡。

完整的代码可以在[https://bitbucket.org/JonHanna/spookilysharp/src](https://bitbucket.org/JonHanna/spookilysharp/src)看到，但考虑到上面的代码是它的简化版本。

但是，由于它现在已经编写好了，因此可以更轻松地使用它：

```
public override int GetHashCode()
{
  var hash = new SpookyHash();
  hash.Update(field1);
  hash.Update(field2);
  hash.Update(field3);
  return hash.Final().GetHashCode();
} 
```

它还需要种子值，因此如果您需要处理不受信任的输入并希望防止 Hash DoS 攻击，您可以根据正常运行时间或类似设置设置种子，并使攻击者无法预测结果：

```
private static long hashSeed0 = Environment.TickCount;
private static long hashSeed1 = DateTime.Now.Ticks;
public override int GetHashCode()
{
  //produce different hashes ever time this application is restarted
  //but remain consistent in each run, so attackers have a harder time
  //DoSing the hash tables.
  var hash = new SpookyHash(hashSeed0, hashSeed1);
  hash.Update(field1);
  hash.Update(field2);
  hash.Update(field3);
  return hash.Final().GetHashCode();
} 
```

*其中一个很大的惊喜是手动内联旋转方法返回`(x << n) | (x >> -n)`了改进的东西。我本来可以肯定抖动会为我内联，但分析显示并非如此。

†<code>decimal 虽然来自 C#，但从 .NET 的角度来看并不是原生的。它的问题在于它自己`GetHashCode()`将精度视为重要，而它自己`Equals()`则没有。两者都是有效的选择，但不能像那样混合。在实现您自己的版本时，您需要选择做一个或另一个，但我不知道您想要哪个。

‡通过比较。如果在字符串上使用，64 位上的 SpookyHash 比 32 位上的速度要快得多`string.GetHashCode()`，32 位上的速度略快`string.GetHashCode()`于 64 位上的速度，这比 32 位上的 SpookyHash 快得多，尽管仍然足够快，可以作为一个合理的选择。

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2017-11-23T15:06:05.963

从[https://github.com/dotnet/coreclr/pull/14863](https://github.com/dotnet/coreclr/pull/14863)开始，有一种生成哈希码的新方法非常简单！写吧

```
public override int GetHashCode()
    => HashCode.Combine(field1, field2, field3); 
```

这将生成高质量的哈希码，而您不必担心实现细节。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2010-10-07T10:51:06.490

这个不错：

```
/// <summary>
/// Helper class for generating hash codes suitable 
/// for use in hashing algorithms and data structures like a hash table. 
/// </summary>
public static class HashCodeHelper
{
    private static int GetHashCodeInternal(int key1, int key2)
    {
        unchecked
        {
           var num = 0x7e53a269;
           num = (-1521134295 * num) + key1;
           num += (num << 10);
           num ^= (num >> 6);

           num = ((-1521134295 * num) + key2);
           num += (num << 10);
           num ^= (num >> 6);

           return num;
        }
    }

    /// <summary>
    /// Returns a hash code for the specified objects
    /// </summary>
    /// <param name="arr">An array of objects used for generating the 
    /// hash code.</param>
    /// <returns>
    /// A hash code, suitable for use in hashing algorithms and data 
    /// structures like a hash table. 
    /// </returns>
    public static int GetHashCode(params object[] arr)
    {
        int hash = 0;
        foreach (var item in arr)
            hash = GetHashCodeInternal(hash, item.GetHashCode());
        return hash;
    }

    /// <summary>
    /// Returns a hash code for the specified objects
    /// </summary>
    /// <param name="obj1">The first object.</param>
    /// <param name="obj2">The second object.</param>
    /// <param name="obj3">The third object.</param>
    /// <param name="obj4">The fourth object.</param>
    /// <returns>
    /// A hash code, suitable for use in hashing algorithms and
    /// data structures like a hash table.
    /// </returns>
    public static int GetHashCode<T1, T2, T3, T4>(T1 obj1, T2 obj2, T3 obj3,
        T4 obj4)
    {
        return GetHashCode(obj1, GetHashCode(obj2, obj3, obj4));
    }

    /// <summary>
    /// Returns a hash code for the specified objects
    /// </summary>
    /// <param name="obj1">The first object.</param>
    /// <param name="obj2">The second object.</param>
    /// <param name="obj3">The third object.</param>
    /// <returns>
    /// A hash code, suitable for use in hashing algorithms and data 
    /// structures like a hash table. 
    /// </returns>
    public static int GetHashCode<T1, T2, T3>(T1 obj1, T2 obj2, T3 obj3)
    {
        return GetHashCode(obj1, GetHashCode(obj2, obj3));
    }

    /// <summary>
    /// Returns a hash code for the specified objects
    /// </summary>
    /// <param name="obj1">The first object.</param>
    /// <param name="obj2">The second object.</param>
    /// <returns>
    /// A hash code, suitable for use in hashing algorithms and data 
    /// structures like a hash table. 
    /// </returns>
    public static int GetHashCode<T1, T2>(T1 obj1, T2 obj2)
    {
        return GetHashCodeInternal(obj1.GetHashCode(), obj2.GetHashCode());
    }
} 
```

以下是如何使用它：

```
private struct Key
{
    private Type _type;
    private string _field;

    public Type Type { get { return _type; } }
    public string Field { get { return _field; } }

    public Key(Type type, string field)
    {
        _type = type;
        _field = field;
    }

    public override int GetHashCode()
    {
        return HashCodeHelper.GetHashCode(_field, _type);
    }

    public override bool Equals(object obj)
    {
        if (!(obj is Key))
            return false;
        var tf = (Key)obj;
        return tf._field.Equals(_field) && tf._type.Equals(_type);
    }
} 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2014-01-20T23:41:33.107

[这是Jon Skeet 在上面发布的算法](https://stackoverflow.com/a/263416/33791)的另一个流畅实现，但不包括分配或装箱操作：

```
public static class Hash
{
    public const int Base = 17;

    public static int HashObject(this int hash, object obj)
    {
        unchecked { return hash * 23 + (obj == null ? 0 : obj.GetHashCode()); }
    }

    public static int HashValue<T>(this int hash, T value)
        where T : struct
    {
        unchecked { return hash * 23 + value.GetHashCode(); }
    }
} 
```

用法：

```
public class MyType<T>
{
    public string Name { get; set; }

    public string Description { get; set; }

    public int Value { get; set; }

    public IEnumerable<T> Children { get; set; }

    public override int GetHashCode()
    {
        return Hash.Base
            .HashObject(this.Name)
            .HashObject(this.Description)
            .HashValue(this.Value)
            .HashObject(this.Children);
    }
} 
```

由于泛型类型约束，编译器将确保`HashValue`不使用类调用。但是没有编译器支持，`HashObject`因为添加通用参数也会添加装箱操作。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2011-03-22T12:15:48.587

这是我的简单方法。我为此使用了经典的构建器模式。它是类型安全的（无装箱/拆箱）并且与 .NET 2.0 兼容（无扩展方法等）。

它是这样使用的：

```
public override int GetHashCode()
{
    HashBuilder b = new HashBuilder();
    b.AddItems(this.member1, this.member2, this.member3);
    return b.Result;
} 
```

这是实际的构建器类：

```
internal class HashBuilder
{
    private const int Prime1 = 17;
    private const int Prime2 = 23;
    private int result = Prime1;

    public HashBuilder()
    {
    }

    public HashBuilder(int startHash)
    {
        this.result = startHash;
    }

    public int Result
    {
        get
        {
            return this.result;
        }
    }

    public void AddItem<T>(T item)
    {
        unchecked
        {
            this.result = this.result * Prime2 + item.GetHashCode();
        }
    }

    public void AddItems<T1, T2>(T1 item1, T2 item2)
    {
        this.AddItem(item1);
        this.AddItem(item2);
    }

    public void AddItems<T1, T2, T3>(T1 item1, T2 item2, T3 item3)
    {
        this.AddItem(item1);
        this.AddItem(item2);
        this.AddItem(item3);
    }

    public void AddItems<T1, T2, T3, T4>(T1 item1, T2 item2, T3 item3, 
        T4 item4)
    {
        this.AddItem(item1);
        this.AddItem(item2);
        this.AddItem(item3);
        this.AddItem(item4);
    }

    public void AddItems<T1, T2, T3, T4, T5>(T1 item1, T2 item2, T3 item3, 
        T4 item4, T5 item5)
    {
        this.AddItem(item1);
        this.AddItem(item2);
        this.AddItem(item3);
        this.AddItem(item4);
        this.AddItem(item5);
    }        

    public void AddItems<T>(params T[] items)
    {
        foreach (T item in items)
        {
            this.AddItem(item);
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2018-05-15T12:00:46.480

如果我们的属性不超过 8 个（希望如此），这是另一种选择。

`ValueTuple`是一个结构，似乎有一个可靠的`GetHashCode`实现。

这意味着我们可以简单地这样做：

```
// Yay, no allocations and no custom implementations!
public override int GetHashCode() => (this.PropA, this.PropB).GetHashCode(); 
```

让我们看一下 .NET Core 当前对`ValueTuple`'s的实现`GetHashCode`。

这是来自[`ValueTuple`](https://github.com/dotnet/corefx/blob/master/src/System.ValueTuple/src/System/ValueTuple/ValueTuple.cs)：

```
 internal static int CombineHashCodes(int h1, int h2)
    {
        return HashHelpers.Combine(HashHelpers.Combine(HashHelpers.RandomSeed, h1), h2);
    }

    internal static int CombineHashCodes(int h1, int h2, int h3)
    {
        return HashHelpers.Combine(CombineHashCodes(h1, h2), h3);
    } 
```

这是来自[`HashHelper`](https://github.com/dotnet/corefx/blob/master/src/Common/src/System/Numerics/Hashing/HashHelpers.cs)：

```
 public static readonly int RandomSeed = Guid.NewGuid().GetHashCode();

    public static int Combine(int h1, int h2)
    {
        unchecked
        {
            // RyuJIT optimizes this to use the ROL instruction
            // Related GitHub pull request: dotnet/coreclr#1830
            uint rol5 = ((uint)h1 << 5) | ((uint)h1 >> 27);
            return ((int)rol5 + h1) ^ h2;
        }
    } 
```

用英语：

*   左旋转（循环移位）h1 5 个位置。
*   将结果和 h1 加在一起。
*   将结果与 h2 进行异或。
*   首先对{静态随机种子，h1}执行上述操作。
*   对于每个进一步的项目，对上一个结果和下一个项目（例如 h2）执行操作。

如果能更多地了解这个 ROL-5 哈希码算法的属性，那就太好了。

`ValueTuple`遗憾的是，我们自己的延迟`GetHashCode`可能没有我们希望和期望的那么快。[相关讨论中的此评论](https://github.com/dotnet/corefx/issues/8034#issuecomment-260759796)说明直接调用`HashHelpers.Combine`的性能更高。另一方面，那个是内部的，所以我们必须复制代码，牺牲我们在这里获得的大部分内容。此外，我们将负责记住首先`Combine`使用随机种子。我不知道如果我们跳过这一步会有什么后果。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-09-01T19:19:17.957

[ReSharper](https://www.jetbrains.com/resharper/)用户可以使用`ReSharper -> Edit -> Generate Code -> Equality Members`.

```
// ReSharper's GetHashCode looks like this
public override int GetHashCode() {
    unchecked {
        int hashCode = Id;
        hashCode = (hashCode * 397) ^ IntMember;
        hashCode = (hashCode * 397) ^ OtherIntMember;
        hashCode = (hashCode * 397) ^ (RefMember != null ? RefMember.GetHashCode() : 0);
        // ...
        return hashCode;
    }
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-11-05T05:03:24.743

我的大部分工作都是通过数据库连接完成的，这意味着我的类都具有来自数据库的唯一标识符。我总是使用数据库中的 ID 来生成哈希码。

```
// Unique ID from database
private int _id;

...    
{
  return _id.GetHashCode();
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-10-21T17:49:34.040

与 nightcoder 的解决方案非常相似，只是如果您愿意，它更容易提高质数。

PS：这是你在嘴里吐一点的时候之一，知道这可以重构为一种具有 9 个默认值的方法，但它会更慢，所以你只需闭上眼睛，试着忘记它。

```
/// <summary>
/// Try not to look at the source code. It works. Just rely on it.
/// </summary>
public static class HashHelper
{
    private const int PrimeOne = 17;
    private const int PrimeTwo = 23;

    public static int GetHashCode<T1, T2, T3, T4, T5, T6, T7, T8, T9, T10>(T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5, T6 arg6, T7 arg7, T8 arg8, T9 arg9, T10 arg10)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();
            hash = hash * PrimeTwo + arg5.GetHashCode();
            hash = hash * PrimeTwo + arg6.GetHashCode();
            hash = hash * PrimeTwo + arg7.GetHashCode();
            hash = hash * PrimeTwo + arg8.GetHashCode();
            hash = hash * PrimeTwo + arg9.GetHashCode();
            hash = hash * PrimeTwo + arg10.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3, T4, T5, T6, T7, T8, T9>(T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5, T6 arg6, T7 arg7, T8 arg8, T9 arg9)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();
            hash = hash * PrimeTwo + arg5.GetHashCode();
            hash = hash * PrimeTwo + arg6.GetHashCode();
            hash = hash * PrimeTwo + arg7.GetHashCode();
            hash = hash * PrimeTwo + arg8.GetHashCode();
            hash = hash * PrimeTwo + arg9.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3, T4, T5, T6, T7, T8>(T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5, T6 arg6, T7 arg7, T8 arg8)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();
            hash = hash * PrimeTwo + arg5.GetHashCode();
            hash = hash * PrimeTwo + arg6.GetHashCode();
            hash = hash * PrimeTwo + arg7.GetHashCode();
            hash = hash * PrimeTwo + arg8.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3, T4, T5, T6, T7>(T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5, T6 arg6, T7 arg7)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();
            hash = hash * PrimeTwo + arg5.GetHashCode();
            hash = hash * PrimeTwo + arg6.GetHashCode();
            hash = hash * PrimeTwo + arg7.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3, T4, T5, T6>(T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5, T6 arg6)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();
            hash = hash * PrimeTwo + arg5.GetHashCode();
            hash = hash * PrimeTwo + arg6.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3, T4, T5>(T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();
            hash = hash * PrimeTwo + arg5.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3, T4>(T1 arg1, T2 arg2, T3 arg3, T4 arg4)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();
            hash = hash * PrimeTwo + arg4.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2, T3>(T1 arg1, T2 arg2, T3 arg3)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();
            hash = hash * PrimeTwo + arg3.GetHashCode();

            return hash;
        }
    }

    public static int GetHashCode<T1, T2>(T1 arg1, T2 arg2)
    {
        unchecked
        {
            int hash = PrimeOne;
            hash = hash * PrimeTwo + arg1.GetHashCode();
            hash = hash * PrimeTwo + arg2.GetHashCode();

            return hash;
        }
    }
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-11-30T19:35:52.257

微软领导了几种散列方式......

```
//for classes that contain a single int value
return this.value;

//for classes that contain multiple int value
return x ^ y;

//for classes that contain single number bigger than int    
return ((int)value ^ (int)(value >> 32)); 

//for classes that contain class instance fields which inherit from object
return obj1.GetHashCode();

//for classes that contain multiple class instance fields which inherit from object
return obj1.GetHashCode() ^ obj2.GetHashCode() ^ obj3.GetHashCode(); 
```

我可以猜测对于多个大 int 你可以使用这个：

```
int a=((int)value1 ^ (int)(value1 >> 32));
int b=((int)value2 ^ (int)(value2 >> 32));
int c=((int)value3 ^ (int)(value3 >> 32));
return a ^ b ^ c; 
```

多类型也是如此：首先将所有转换为`int`使用，`GetHashCode()` 然后 int 值将被异或，结果是您的哈希。

对于那些使用hash作为ID（我的意思是唯一值）的人来说，hash自然被限制在一个数字内，我认为散列算法是5个字节，至少是MD5。

您可以将多个值转换为一个散列值，其中一些是相同的，因此不要将其用作标识符。（也许有一天我会使用你的组件）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-09-28T16:44:25.590

使用上面选择的实现，我遇到了浮点数和小数的问题。

该测试失败（浮点数；即使我将 2 个值切换为负数，哈希也是相同的）：

```
 var obj1 = new { A = 100m, B = 100m, C = 100m, D = 100m};
        var obj2 = new { A = 100m, B = 100m, C = -100m, D = -100m};
        var hash1 = ComputeHash(obj1.A, obj1.B, obj1.C, obj1.D);
        var hash2 = ComputeHash(obj2.A, obj2.B, obj2.C, obj2.D);
        Assert.IsFalse(hash1 == hash2, string.Format("Hashcode values should be different   hash1:{0}  hash2:{1}",hash1,hash2)); 
```

但是这个测试通过了（带整数）：

```
 var obj1 = new { A = 100m, B = 100m, C = 100, D = 100};
        var obj2 = new { A = 100m, B = 100m, C = -100, D = -100};
        var hash1 = ComputeHash(obj1.A, obj1.B, obj1.C, obj1.D);
        var hash2 = ComputeHash(obj2.A, obj2.B, obj2.C, obj2.D);
        Assert.IsFalse(hash1 == hash2, string.Format("Hashcode values should be different   hash1:{0}  hash2:{1}",hash1,hash2)); 
```

我将实现更改为不对原始类型使用 GetHashCode，它似乎效果更好

```
 private static int InternalComputeHash(params object[] obj)
    {
        unchecked
        {
            var result = (int)SEED_VALUE_PRIME;
            for (uint i = 0; i < obj.Length; i++)
            {
                var currval = result;
                var nextval = DetermineNextValue(obj[i]);
                result = (result * MULTIPLIER_VALUE_PRIME) + nextval;

            }
            return result;
        }
    }

    private static int DetermineNextValue(object value)
    {
        unchecked
        {

                int hashCode;
                if (value is short
                    || value is int
                    || value is byte
                    || value is sbyte
                    || value is uint
                    || value is ushort
                    || value is ulong
                    || value is long
                    || value is float
                    || value is double
                    || value is decimal)
                {
                    return Convert.ToInt32(value);
                }
                else
                {
                    return value != null ? value.GetHashCode() : 0;
                }
        }
    } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-04-28T05:10:01.153

这是一个实现 Josh Bloch 实现的静态助手类；并提供显式重载以“防止”装箱，并专门为长原语实现散列。

您可以传递与您的 equals 实现匹配的字符串比较。

因为 Hash 输出始终是一个 int，所以您可以只链接 Hash 调用。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using System.Runtime.CompilerServices;

namespace Sc.Util.System
{
    /// <summary>
    /// Static methods that allow easy implementation of hashCode. Example usage:
    /// <code>
    /// public override int GetHashCode()
    ///     => HashCodeHelper.Seed
    ///         .Hash(primitiveField)
    ///         .Hsh(objectField)
    ///         .Hash(iEnumerableField);
    /// </code>
    /// </summary>
    public static class HashCodeHelper
    {
        /// <summary>
        /// An initial value for a hashCode, to which is added contributions from fields.
        /// Using a non-zero value decreases collisions of hashCode values.
        /// </summary>
        public const int Seed = 23;

        private const int oddPrimeNumber = 37;

        /// <summary>
        /// Rotates the seed against a prime number.
        /// </summary>
        /// <param name="aSeed">The hash's first term.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        private static int rotateFirstTerm(int aSeed)
        {
            unchecked {
                return HashCodeHelper.oddPrimeNumber * aSeed;
            }
        }

        /// <summary>
        /// Contributes a boolean to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aBoolean">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, bool aBoolean)
        {
            unchecked {
                return HashCodeHelper.rotateFirstTerm(aSeed)
                        + (aBoolean
                                ? 1
                                : 0);
            }
        }

        /// <summary>
        /// Contributes a char to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aChar">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, char aChar)
        {
            unchecked {
                return HashCodeHelper.rotateFirstTerm(aSeed)
                        + aChar;
            }
        }

        /// <summary>
        /// Contributes an int to the developing HashCode seed.
        /// Note that byte and short are handled by this method, through implicit conversion.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aInt">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, int aInt)
        {
            unchecked {
                return HashCodeHelper.rotateFirstTerm(aSeed)
                        + aInt;
            }
        }

        /// <summary>
        /// Contributes a long to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aLong">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, long aLong)
        {
            unchecked {
                return HashCodeHelper.rotateFirstTerm(aSeed)
                        + (int)(aLong ^ (aLong >> 32));
            }
        }

        /// <summary>
        /// Contributes a float to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aFloat">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, float aFloat)
        {
            unchecked {
                return HashCodeHelper.rotateFirstTerm(aSeed)
                        + Convert.ToInt32(aFloat);
            }
        }

        /// <summary>
        /// Contributes a double to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aDouble">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, double aDouble)
            => aSeed.Hash(Convert.ToInt64(aDouble));

        /// <summary>
        /// Contributes a string to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aString">The value to contribute.</param>
        /// <param name="stringComparison">Optional comparison that creates the hash.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(
                this int aSeed,
                string aString,
                StringComparison stringComparison = StringComparison.Ordinal)
        {
            if (aString == null)
                return aSeed.Hash(0);
            switch (stringComparison) {
                case StringComparison.CurrentCulture :
                    return StringComparer.CurrentCulture.GetHashCode(aString);
                case StringComparison.CurrentCultureIgnoreCase :
                    return StringComparer.CurrentCultureIgnoreCase.GetHashCode(aString);
                case StringComparison.InvariantCulture :
                    return StringComparer.InvariantCulture.GetHashCode(aString);
                case StringComparison.InvariantCultureIgnoreCase :
                    return StringComparer.InvariantCultureIgnoreCase.GetHashCode(aString);
                case StringComparison.OrdinalIgnoreCase :
                    return StringComparer.OrdinalIgnoreCase.GetHashCode(aString);
                default :
                    return StringComparer.Ordinal.GetHashCode(aString);
            }
        }

        /// <summary>
        /// Contributes a possibly-null array to the developing HashCode seed.
        /// Each element may be a primitive, a reference, or a possibly-null array.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aArray">CAN be null.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, IEnumerable aArray)
        {
            if (aArray == null)
                return aSeed.Hash(0);
            int countPlusOne = 1; // So it differs from null
            foreach (object item in aArray) {
                ++countPlusOne;
                if (item is IEnumerable arrayItem) {
                    if (!object.ReferenceEquals(aArray, arrayItem))
                        aSeed = aSeed.Hash(arrayItem); // recursive call!
                } else
                    aSeed = aSeed.Hash(item);
            }
            return aSeed.Hash(countPlusOne);
        }

        /// <summary>
        /// Contributes a possibly-null array to the developing HashCode seed.
        /// You must provide the hash function for each element.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aArray">CAN be null.</param>
        /// <param name="hashElement">Required: yields the hash for each element
        /// in <paramref name="aArray"/>.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash<T>(this int aSeed, IEnumerable<T> aArray, Func<T, int> hashElement)
        {
            if (aArray == null)
                return aSeed.Hash(0);
            int countPlusOne = 1; // So it differs from null
            foreach (T item in aArray) {
                ++countPlusOne;
                aSeed = aSeed.Hash(hashElement(item));
            }
            return aSeed.Hash(countPlusOne);
        }

        /// <summary>
        /// Contributes a possibly-null object to the developing HashCode seed.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="aObject">CAN be null.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int Hash(this int aSeed, object aObject)
        {
            switch (aObject) {
                case null :
                    return aSeed.Hash(0);
                case bool b :
                    return aSeed.Hash(b);
                case char c :
                    return aSeed.Hash(c);
                case int i :
                    return aSeed.Hash(i);
                case long l :
                    return aSeed.Hash(l);
                case float f :
                    return aSeed.Hash(f);
                case double d :
                    return aSeed.Hash(d);
                case string s :
                    return aSeed.Hash(s);
                case IEnumerable iEnumerable :
                    return aSeed.Hash(iEnumerable);
            }
            return aSeed.Hash(aObject.GetHashCode());
        }

        /// <summary>
        /// This utility method uses reflection to iterate all specified properties that are readable
        /// on the given object, excluding any property names given in the params arguments, and
        /// generates a hashcode.
        /// </summary>
        /// <param name="aSeed">The developing hash code, or the seed: if you have no seed, use
        /// the <see cref="Seed"/>.</param>
        /// <param name="aObject">CAN be null.</param>
        /// <param name="propertySelector"><see cref="BindingFlags"/> to select the properties to hash.</param>
        /// <param name="ignorePropertyNames">Optional.</param>
        /// <returns>A hash from the properties contributed to <c>aSeed</c>.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int HashAllProperties(
                this int aSeed,
                object aObject,
                BindingFlags propertySelector
                        = BindingFlags.Instance
                        | BindingFlags.Public
                        | BindingFlags.GetProperty,
                params string[] ignorePropertyNames)
        {
            if (aObject == null)
                return aSeed.Hash(0);
            if ((ignorePropertyNames != null)
                    && (ignorePropertyNames.Length != 0)) {
                foreach (PropertyInfo propertyInfo in aObject.GetType()
                        .GetProperties(propertySelector)) {
                    if (!propertyInfo.CanRead
                            || (Array.IndexOf(ignorePropertyNames, propertyInfo.Name) >= 0))
                        continue;
                    aSeed = aSeed.Hash(propertyInfo.GetValue(aObject));
                }
            } else {
                foreach (PropertyInfo propertyInfo in aObject.GetType()
                        .GetProperties(propertySelector)) {
                    if (propertyInfo.CanRead)
                        aSeed = aSeed.Hash(propertyInfo.GetValue(aObject));
                }
            }
            return aSeed;
        }

        /// <summary>
        /// NOTICE: this method is provided to contribute a <see cref="KeyValuePair{TKey,TValue}"/> to
        /// the developing HashCode seed; by hashing the key and the value independently. HOWEVER,
        /// this method has a different name since it will not be automatically invoked by
        /// <see cref="Hash(int,object)"/>, <see cref="Hash(int,IEnumerable)"/>,
        /// or <see cref="HashAllProperties"/> --- you MUST NOT mix this method with those unless
        /// you are sure that no KeyValuePair instances will be passed to those methods; or otherwise
        /// the generated hash code will not be consistent. This method itself ALSO will not invoke
        /// this method on the Key or Value here if that itself is a KeyValuePair.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="keyValuePair">The value to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int HashKeyAndValue<TKey, TValue>(this int aSeed, KeyValuePair<TKey, TValue> keyValuePair)
            => aSeed.Hash(keyValuePair.Key)
                    .Hash(keyValuePair.Value);

        /// <summary>
        /// NOTICE: this method is provided to contribute a collection of <see cref="KeyValuePair{TKey,TValue}"/>
        /// to the developing HashCode seed; by hashing the key and the value independently. HOWEVER,
        /// this method has a different name since it will not be automatically invoked by
        /// <see cref="Hash(int,object)"/>, <see cref="Hash(int,IEnumerable)"/>,
        /// or <see cref="HashAllProperties"/> --- you MUST NOT mix this method with those unless
        /// you are sure that no KeyValuePair instances will be passed to those methods; or otherwise
        /// the generated hash code will not be consistent. This method itself ALSO will not invoke
        /// this method on a Key or Value here if that itself is a KeyValuePair or an Enumerable of
        /// KeyValuePair.
        /// </summary>
        /// <param name="aSeed">The developing HashCode value or seed.</param>
        /// <param name="keyValuePairs">The values to contribute.</param>
        /// <returns>The new hash code.</returns>
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        public static int HashKeysAndValues<TKey, TValue>(
                this int aSeed,
                IEnumerable<KeyValuePair<TKey, TValue>> keyValuePairs)
        {
            if (keyValuePairs == null)
                return aSeed.Hash(null);
            foreach (KeyValuePair<TKey, TValue> keyValuePair in keyValuePairs) {
                aSeed = aSeed.HashKeyAndValue(keyValuePair);
            }
            return aSeed;
        }
    }
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-04-20T04:54:54.087

如果你想`HashCode`从`netstandard2.1`

```
public static class HashCode
{
    public static int Combine(params object[] instances)
    {
        int hash = 17;

        foreach (var i in instances)
        {
            hash = unchecked((hash * 31) + (i?.GetHashCode() ?? 0));
        }

        return hash;
    }
} 
```

注意：如果和 一起使用`struct`，会因为装箱而分配内存

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-01-25T19:40:41.990

可以尝试采用 C++ Boost 库中的方法。像这样的东西：

```
class HashUtil
{
  public static int HashCombine(int seed, int other)
  {
    unchecked
    {
      return other + 0x9e3779b9 + (seed << 6) + (seed >> 2);
    }
  }
} 
```

进而：

```
class MyClass
{
  private string _field1;
  private int _field2;
  private AnotherClass _field3;
  private YetAnotherClass _field4;

  public override int GetHashCode()
  {
    int result = HashUtil.HashCombine(_field1.GetHashCode(), _field2);
    result = HashUtil.HashCombine(result, _field3.GetHashCode());
    return HashUtil.HashCombine(result, _field4.GetHashCode());
  }
} 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2021-02-18T14:04:27.333

我想将我的最新发现添加到我经常回来的这个线程中。

我当前的视觉工作室/项目设置提供了自动将元组重构为结构的功能。这将生成一个 GetHashCode 函数，如下所示：

```
 public override int GetHashCode()
        {
            int hashCode = -2088324004;
            hashCode = hashCode * -1521134295 + AuftragGesperrt.GetHashCode();
            hashCode = hashCode * -1521134295 + Auftrag_gesperrt_von.GetHashCode();
            hashCode = hashCode * -1521134295 + Auftrag_gesperrt_am.GetHashCode();
            return hashCode;
        } 
```

# rebol - 在 REBOL 中动态地将单词添加到上下文中

> ID：263402
> 
> 赞同：7
> 
> 时间：2008-11-04T20:53:53.187
> 
> 标签：rebol, rebol2

想象一下下面的 REBOL 代码：

```
foo: 上下文 [bar: 3]
```

我现在有一个定义的上下文`foo`。`'bar`我怎样才能在这个上下文中动态地注入一个新词？是否可以？

我试过了：

```
在 foo 'baz 3 中设置/任何
```

但这不起作用，因为表达式失败，因为上下文`in foo 'baz`中没有`'baz`定义单词。`foo`

我应该补充一点，我意识到这样做的一种方法如下：

```
foo 原型：[bar：3]
foo：上下文 foo 原型
foo: 上下文头附加 foo-prototype [baz: 3]
```

但是，如果您无权访问`foo`的原型块怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-10T10:48:54.210

您可以通过使用现有对象作为原型来创建新对象来实现相同的目的。

```
>> foo: make object! [bar: 3]
>> foo: make foo [baz: 3]
>> probe foo
make object! [
    bar: 3
    baz: 3
] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-10T19:41:56.910

有几种方法可以解决在 REBOL/2 中无法扩展对象上下文这一事实。

可能你可以只使用 BLOCK!s 而不是 OBJECT!s：

```
>> blobject: [foo 1]
== [foo 1]
>> blobject/bar
** Script Error: Invalid path value: bar
** Near: blobject/bar
>> append blobject [bar 2]
== [foo 1 bar 2]
>> blobject/bar: 3
== 3 
```

您甚至可以通过附加对象本身来使 'self 工作：

```
>> insert blobject reduce ['self blobject]
== [[...] foo 1 bar 2]
>> same? blobject blobject/self
== true 
```

但是当您要求扩展*OBJECT!s*时，您可能会选择 Peter WA Wood 的解决方案来简单地克隆对象。请记住，使用这种方法生成的克隆确实与原始对象不同。

因此，如果在克隆/扩展之前已将某个词设置为保存对象，则在克隆对象后，该词仍将保存未扩展的对象：

```
>> remember: object: make object! [foo: 1]
>> object: make object [bar: 2]
>> same? remember object
== false
>> probe remember
make object! [
   foo: 1
] 
```

如果您必须保持对对象的“引用”不变，您可能希望将需要扩展的对象包装在外部对象中，如

```
>> remember: object: make object! [access: make object! [foo: 1]]
>> object/access: make object/access [bar: 2]
>> same? remember object
== true 
```

然后，您可以在保留的同时扩展对象，因为您只存储对容器的引用。

顺便说一句，REBOL/3 将允许向 OBJECT!s 添加单词。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-18T07:06:28.053

在 REBOL/Core User Guide 中说：“许多块包含其他块和字符串。复制这样的块时，不会复制其子系列。子系列是直接引用的，与原始块是相同的系列数据。”

# wpf - 引用版本化程序集的松散 xaml

> ID：263404
> 
> 赞同：2
> 
> 时间：2008-11-04T20:54:02.190
> 
> 标签：wpf, vb.net, xaml, assemblies

我有一个独特的发展情况，并希望得到其他人的一些意见。

我有一种情况，我需要在富客户端应用程序中加载松散的 xaml 文件。给定的松散 xaml 文件可能具有对当前未加载到内存中的程序集的引用，因此在加载松散 xaml 之前加载引用的程序集。松散的 xaml 和绑定的程序集存储在不同的后端服务器上，这些后端服务器被下载到客户端并动态加载。

松散的 xaml 和/或程序集是特定于版本的，不幸的是应用程序无法在呈现 xaml 之间关闭。**v1**带组装。来自服务器 A 和 xaml 的**v1 。****v1**带组装。**服务器 B 上的v2**。两个程序集都使用相同的命名空间声明，因此对于任何给定的松散 xaml，“旧”程序集仍然可以与“新”程序集一起使用。

问题是，如果我加载包含对 assembly.v2 中“较新”功能的引用的 xaml.v2，我不会得到对 assembly.v2 的引用。

我显然无法从应用程序域中卸载 assembly.v1，并且我不确定是否可以引用通过编组在不同应用程序域中加载的 xaml 中的项目。

除了使用不同的命名空间引用之外的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T10:57:36.400

另一种选择（假设您正确地对程序集进行版本控制）是在 ns 声明中简单地包含程序集版本，如下所示：

```
xmlns:ns0="clr-namespace:MyCompany.MyProject.MyNameSpace; Assembly=MyCompany.MyProject, Version=1.0.0.0" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T16:21:57.787

我猜您已经在进行动态程序集解析和加载？如果是这样，那么您可以尝试用假程序集名称代替 Xaml 中的真实程序集名称 - 然后您可以在程序集解析代码中使用它来加载并返回正确的程序集。例如，如果您的原始来源 Xaml 是：

```
xmlns:myassembly="clr-namespace:MyApp.MyAssembly;assembly=MyAssembly" 
```

并且您知道 Xaml 想要 v2 的 MyAssembly，在将其解析为之前替换 Xaml 字符串中的程序集引用：

```
xmlns:myassembly="clr-namespace:MyApp.MyAssembly;assembly=MyAssembly.v2" 
```

..然后在您的程序集解析/加载代码中，当您看到末尾的“.v2”位时，您会寻找并加载该程序集。

请让我知道我是否误解了这个问题，或者您目前没有进行任何自定义装配解决方案 - 我认为这肯定是这种情况下的关键。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-16T09:01:59.627

我还没有确认这是否会奏效，但我相信它可能会。您可以使用 XmlnsDefinitionAttribute（在程序集级别）。例如

装配 V1 -> 装配信息.cs

```
[assembly: XmlnsDefinition( "http://schema.mycompany.com/myproject/v1", "MyCompany.MyProject" )] 
```

程序集 V2 -> 程序集信息.cs

```
[assembly: XmlnsDefinition( "http://schema.mycompany.com/myproject/v2", "MyCompany.MyProject" )] 
```

然后在 xaml 中：

```
xmlns:myassembly="http://schema.mycompany.com/myproject/v2" 
```

# java - 通过 JSSE 连接结束 XML 流？

> ID：263406
> 
> 赞同：2
> 
> 时间：2008-11-04T20:54:51.873
> 
> 标签：java, xml, jsse

我有一个 Java 服务器，它接受使用 JSSE 的 SSL 连接，并在流中使用简单的 XML 消息格式。我希望服务器阅读完整的消息，然后发送回复。事实证明这非常困难，因为 org.xml.sax.XMLReader 想要读取整个流，然后调用 close()。我知道这看起来很奇怪，但是在带有 Sun JSSE 提供程序的 Java 6 中，这确实关闭了 SSLSocket 的两端，因此没有消息可以返回。我尝试在客户端使用 Socket 的 shutdownOutput() 方法，但 JSSE 不支持此方法。

我的解决方案是传递一个包装在自定义类中的 InputStream，该类静默忽略关闭请求，并指示流在遇到第一个空行时关闭。这将 XML 限制在通常有效的范围之外，但客户端可以在必要时轻松过滤掉输入中的空白行。有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T20:57:07.783

由于每个 xml 文档只有一个根节点。因此，扫描此节点的末尾并在之后关闭流。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T00:06:42.830

您的客户如何知道何时阅读了完整的消息？如果它必须在输入流到达其末尾之前读取，那么根据定义，之后您将无法从流中读取任何内容。第二点，`close()`在输入流上调用不应该关闭套接字。当您调用`close()`输入流时，您确定套接字已关闭吗？当对等方注意到其输出流（您的输入流）已关闭时，可能是连接（错误地）关闭。

避免在输入流结束之前读取的解决方案是以某种方式分隔输入消息。例如，您可以在消息之前发送消息的长度，然后将整个消息从流中读取到缓冲区中，然后使用 XMLReader 解析缓冲区，或者创建一个特殊的 InputStream，在指定的数量之后到达其末尾数据。或者您可以在消息之后的流中添加一个特殊的分隔符，然后当底层流产生分隔符时，您将创建一个特殊的 InputStream 到达其末尾。

# php - Zend Framework - 是否有脚本来索引视图中的静态内容？

> ID：263408
> 
> 赞同：2
> 
> 时间：2008-11-04T20:55:07.320
> 
> 标签：php, zend-framework, search, lucene

我想在我的网站上添加一个搜索框——它是使用 Zend Framework 1.6 构建的——使用 Zend Search Lucene。我的大部分内容是静态的，并保存在控制器视图中。

有没有人有一个脚本可以索引视图中的内容，并将它们添加到 Lucene 搜索数据库中以便我可以搜索它们？

非常感谢，
马特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T09:45:29.603

只是一个想法：你可以使用

```
$doc = Zend_Search_Lucene_Document_Html::loadHTMLFile('http://my.host.domain/path2file');
$index->addDocument($doc); 
```

如果`allow_url_fopen`设置为使用`1`的调用应该能够通过 url 打开文件。`file_get_contents()``Zend_Search_Lucene_Document_Html::__construct()`

# xml - Delphi 中的 XML 库和教程

> ID：263419
> 
> 赞同：21
> 
> 时间：2008-11-04T20:57:04.553
> 
> 标签：xml, delphi

我打算为应用程序添加 XML 支持，但我不熟悉 Delphi 中的 XML 编程。基本上我需要基于 XML 节点创建对象并基于对象生成 XML 文件。

我应该使用哪个 XML 组件库？Delphi 有什么好的 XML 教程吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-04T21:35:55.897

您可以从查看 Delphi 的 TXMLDocument 组件开始。这将为您提供使用 XML/DOM 的基础知识。它很简单，可以通过将其拖放到您的表单中来添加。它具有 LoadFromFile 和 SaveToFile 方法，并且易于导航。

但是，在某些时候，您将耗尽 TXMLDocument 的功能，特别是如果您想使用 XPath 之类的东西。

我建议您查看属于 MSXML2_TLB 的 IXMLDOMDocument2，例如

```
 XML := CreateOleObject('MSXML2.DOMDocument.3.0') as IXMLDOMDocument2;
  XML.async := false;
  XML.SetProperty('SelectionLanguage','XPath'); 
```

您需要将 msxmldom、xmldom、XMLIntf、XMLDoc 和 MSXML2_TLB 添加到您的使用部分。

那里有一些组件库，但我建议编写自己的辅助类或函数。这是我们编写和使用的示例：

```
function XMLCreateRoot(var xml: IXMLDOMDocument2; RootName: string; xsl: string = ''; encoding: string = 'ISO-8859-1'; language: string = 'XPath'): IXMLDOMNode;
var
  NewPI:   IXMLDOMProcessingInstruction;
begin

  if language<>'' then
     xml.SetProperty('SelectionLanguage','XPath');

  if encoding<>'' then begin
     NewPI:=xml.createProcessingInstruction('xml', 'version="1.0" encoding="'+encoding+'"');
     xml.appendChild(NewPI);
  end;

  if xsl<>'' then begin
     NewPI:=xml.createProcessingInstruction('xml-stylesheet','type="text/xsl" href="'+xsl+'"');
     xml.appendChild(NewPI)
  end;

  xml.async := false;
  xml.documentElement:=xml.createElement(RootName);
  Result:=xml.documentElement;
end; 
```

从那里拿走它。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-05T08:36:53.470

我使用[simdesign](http://www.simdesign.nl/xml.html)的 nativeXML。它消除了使用 XML 的所有痛苦，您将在几分钟内启动并运行。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-04T21:33:18.647

这里有几个教程：

*   [使用 Delphi 创建、解析和操作 XML 文档](http://delphi.about.com/od/windowsshellapi/a/xml_delphi.htm)
*   [Delphi 中的基本 XML 解析](http://web.archive.org/web/20080608184001/http://homepages.borland.com/ccalvert/TechPapers/Delphi/XMLSimple/XMLSimple.html)

此外，您可能想要查看[XMLIntf 单元](http://delphi.wikia.com/wiki/Category:XMLIntf_Unit)（尽管这个链接的 Delphi Wikia 页面内容非常简单）。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-04T21:26:10.220

您可以尝试以下书籍： [Delphi Developers Guide to XML](https://rads.stackoverflow.com/amzn/click/com/1591098629 "Delphi 开发人员 XML 指南")

基本上我会推荐你​​使用微软的 DOM。您需要像导入任何其他 COM 对象一样导入该库。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-04T21:33:15.230

您可以使用 Delphi 的[XML 数据绑定](http://www.drbob42.com/examine/examin23.htm)（文件 - 新建 - 其他 - XML 映射（我不确切知道路径，我在家没有 Delphi））。

它通过 XML 提供程序创建对象/接口，因此您可以使用对象/结构而不是纯 xml 文本文件。

您不必费力地阅读和编写每个 XML 元素——您只是在处理对象的集合及其属性。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-05T18:48:14.050

我已经使用 nativeXML 大约一年了。我的需求相当简单。对我来说，XML 流畅性只是大型应用程序的一小部分，但我能够以几乎与编写代码一样快的速度实现我需要的部分，在线帮助很好，我的需求在一天而不是一周内就得到了满足或更长。我支持 davehay 对 nativeXML 的投票。

# unix - DST 后 cron 作业更改时间

> ID：263448
> 
> 赞同：2
> 
> 时间：2008-11-04T21:04:48.687
> 
> 标签：unix, shell

我的 cron 作业在 DST 结束后一小时运行。这不会发生在同一台机器 (AIX) 上其他用户的作业上。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T21:43:07.987

我认为首先要找出 cron 运行的时区：

0 1 * * * (/usr/bin/date ; /usr/bin/date -u) > ~/cron.out

您可能还希望让其 cron 作业也正在执行此操作的用户之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-04T21:34:16.633

如果您将 UTC 转换为本地时间（正确）并且该作业是针对非 DST 时区的，例如亚利桑那州，它将在一个小时后运行，相对于您的服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T21:16:00.320

您可能已经检查过了，但是服务器上的时间是否正确更改？

# python - 在 Python 中合并/添加列表

> ID：263457
> 
> 赞同：35
> 
> 时间：2008-11-04T21:06:36.983
> 
> 标签：python, list

我很确定应该有一种更 Pythonic 的方式来做到这一点 - 但我想不出一个：如何将二维列表合并为一维列表？有点像 zip/map 但有两个以上的迭代器。

示例 - 我有以下列表：

```
array = [[1, 2, 3], [4, 5, 6], [7, 8, 9]] 
```

我希望有

```
result = [12, 15, 18] # [1+4+7, 2+5+8, 3+6+9] 
```

到目前为止，我想出的是：

```
def add_list(array):
    number_items = len(array[0])
    result = [0] * number_items
    for index in range(number_items):
        for line in array:
            result[index] += line[index]
    return result 
```

但这对我来说看起来不是很优雅/Pythonic。除了不检查 2D 数组中的所有“线”是否具有相同的长度，是否可以相互添加等等。还有什么更好的方法呢？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-11-04T21:16:39.117

```
[sum(a) for a in zip(*array)] 
```

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-11-04T21:33:47.257

[sum(value) for value in zip(*array)] 是相当标准的。

这可能有助于您理解它：

```
In [1]: array=[[1, 2, 3], [4, 5, 6], [7, 8, 9]]

In [2]: array
Out[2]: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]

In [3]: *array
------------------------------------------------------------
   File "<ipython console>", line 1
     *array
     ^
<type 'exceptions.SyntaxError'>: invalid syntax 
```

*一元星本身不是算子。它将数组元素解包为函数调用的参数。*

```
In [4]: zip(*array)
Out[4]: [(1, 4, 7), (2, 5, 8), (3, 6, 9)] 
```

*zip() 是一个内置函数*

```
In [5]: zip(*array)[0]
Out[5]: (1, 4, 7) 
```

*zip 返回的列表的每个元素都是您想要的一组数字。*

```
In [6]: sum(zip(*array)[0])
Out[6]: 12

In [7]: [sum(values) for values in zip(*array)]
Out[7]: [12, 15, 18] 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-05T15:31:04.087

另一种方法：

```
map(sum, zip(*array)) 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-05T15:24:08.983

如果您正在做很多此类事情，那么您想了解[`scipy`.](http://scipy.org/)

```
>>> import scipy
>>> sum(scipy.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]]))
array([12, 15, 18]) 
```

系统会自动为您检查所有数组大小。求和是用纯 C 语言完成的，所以速度非常快。 `scipy`数组也非常节省内存。

缺点是您依赖于相当复杂的第三方模块。但这对于许多目的来说是一个很好的权衡。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-02-25T04:45:31.813

同意 Fivebells，但您也可以使用 Numpy，它是一个更小（更快的导入）和更通用的类似数组的东西的实现。（其实是scipy的依赖）。如前所述，这些都是很棒的工具，如果您处理这种操作，它们是“必须使用的”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-11-05T21:04:10.277

游戏迟到了，它的答案不如其他一些好，但我认为它有点可爱：

```
map(lambda *x:sum(x),*array) 
```

太糟糕了，`sum(1,2,3)`这不起作用。如果确实如此，我们可以消除其中的愚蠢`lambda`，但我认为这将难以辨别哪些元素（如果有）是总和的“开始”。您必须将其更改为仅关键字的争论，这会破坏很多脚本……哦，好吧。我想我们只会住在一起`lambda`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-03T13:55:00.377

> [sum(a) for a in zip(*array)]

我喜欢。我需要一些与将对象交错到项目列表中相关的东西，想出了一些类似但更简洁的甚至长度列表：

```
sum(zip(*array),()) 
```

例如，交错两个列表：

```
a = [1,2,3]
b = ['a','b','c']
sum(zip(a,b),())
(1, 'a', 2, 'b', 3, 'c') 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-03T21:02:37.843

你可以简单地这样做：

```
print [sum(x) for x in zip(*array)] 
```

如果您希望以这种方式遍历列表，可以使用`chain`该`itertools`模块：

```
from itertools import chain

for x in array.chain.from_iterable(zip(*array)):
    print x   
# prints 1, 4, 7, 2, 5, 8, ... 
```

# c# - Reading files in a .NET project

> ID：263469
> 
> 赞同：1
> 
> 时间：2008-11-04T21:18:42.873
> 
> 标签：c#, .net, installation, windows-installer, web-applications

I have a C# .NET web project that I'm currently working on. What I'm trying to do is read some files that I dropped into a dir which is at the same level as fileReader.cs which is attempting to read them. On a normal desktop app the following would work:

```
DirectoryInfo di = new DirectoryInfo(./myDir); 
```

However because it's a web project the execution context is different, and I don't know how to access these files?

Eventually fileReader will be called in an installation routine. I intend to override one of the Installer.cs' abstract methods so will this affect the execution context?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:20:33.103

Use [`Server.MapPath`](http://msdn.microsoft.com/library/ms178116.aspx) to get the local path for the currently executing page.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T21:22:27.297

Use the Server.MapPath method whichs maps the specified relative or virtual path to the corresponding physical directory on the server.

```
Server.MapPath("mydir/file.some") 
```

This returns: *C:\site\scripts\mydir\file.some*

Script also can call the MapPath with full virtual path:

```
Server.MapPath("/scripts/mydir/file.some") 
```

Here is the [link to the MSDN documentation of MapPath](http://msdn.microsoft.com/en-us/library/0e7ykf56.aspx).

# ios - iOS 上的 Cocoa 绘图/绘图框架

> ID：263472
> 
> 赞同：31
> 
> 时间：2008-11-04T21:19:25.523
> 
> 标签：ios, iphone, cocoa-touch, graph

正在考虑将一些数据图表添加到正在开发的新 iPhone 应用程序（也就是 Stocks 应用程序）。

我意识到我可以停下来做一些 Quartz 绘图，但我希望某个地方的某个人对适用于 iOS 的 Cocoa 图形框架有一个提示。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-19T21:17:59.450

# 核心情节

[Core Plot](https://github.com/core-plot/core-plot)上有一个正在积极开发中的绘图框架。

它适用于 Mac 和 iPhone。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-10-06T08:38:50.137

尽管 eisernWolf 向他的 Google 代码页面发送垃圾邮件链接，但实际上还不错。

Core Plot 是迄今为止更高级的库，也是您希望用于数学类型应用程序的方式。

但是，如果您的目标是一些简单的数据可视化，s7graphview 可以实现以下目标：

*   比核心情节简单得多。
*   作为源代码分发。只需将文件拖放到您的项目中即可。
*   这是了解一些核心动画内容如何工作的好方法。

另外我认为默认样式比 Core Plot 好一点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-05T15:45:16.023

如果您需要做的只是绘制折线图，​​请查看 Apple 发布的 Seismic 示例 - 您可以从中提取大量代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-10T16:37:07.650

我想知道同样的事情并遇到了这个示例代码（AccelerometerGraph）。

[链接到 Apple 开发网站](http://developer.apple.com/iphone/library/samplecode/AccelerometerGraph/index.html)。

我也开始玩核心情节。这是相当不错的。

# c# - 使用 ObjectDataSource 对 GridView 进行排序不是排序

> ID：263477
> 
> 赞同：2
> 
> 时间：2008-11-04T21:21:35.940
> 
> 标签：c#, asp.net

我有一个如下的网格视图：

```
 <asp:GridView DataKeyNames="TransactionID" 
               AllowSorting="True" AllowPaging="True"ID="grvBrokerage" 
               runat="server" AutoGenerateColumns="False" 
               CssClass="datatable" Width="100%"
              <Columns>
                  <asp:BoundField DataField="BrkgAccountNameOutput"              
                                  HeaderText="Account Name"/>
                  <asp:BoundField DataField="TransactionAmount" 
                                  HeaderText="Transaction Amount" 
                                  SortExpression="TransactionAmount" />
                  <asp:BoundField DataField="TransType" 
                                  HeaderText="Transaction Type"          
                                  SortExpression="TransType"/>
                  <asp:BoundField DataField="AccountBalance" 
                                  HeaderText="Account Balance"/>
                  <asp:BoundField DataField="CreateDt" 
                                  HeaderText="Transaction Date"  />
               </Columns>
 </asp:GridView> 
```

我有一个带有gridview 和objectdatasource 控件的页面。AllowPaging 和 AllowSorting 已启用。这是我使用的获取数据并将对象数据源绑定到网格的方法：

```
 protected void BindBrokerageDetails()
        {
            HomePage master = (HomePage)Page.Master;

            BrokerageAccount brokerageAccount = new BrokerageAccount();
            brokerageAccount.UserID = new Guid(Membership.GetUser().ProviderUserKey.ToString()); 

            ddlBrokerageDetails.DataSource = brokerageAccount.GetAll();
            ddlBrokerageDetails.DataTextField = "Account Name";
            ddlBrokerageDetails.DataValueField = "Account Name";
            ddlBrokerageDetails.DataBind();
           if (ddlBrokerageDetails.Items.Count > 0)
           {
               BrokerageTransactions brokerageaccountdetails = new          
                                           BrokerageTransactions();
               DataSet ds = BrokerageAccount.GetBrkID2(
                                    new Guid(Membership
                                              .GetUser()
                                              .ProviderUserKey
                                              .ToString()),
                                    ddlBrokerageDetails
                                              .SelectedItem
                                              .Text
                                              .ToString());
               foreach (DataRow dr in ds.Tables[0].Rows)
               {
                   brokerageaccountdetails.BrokerageId = new Guid(dr["BrkrgId"].ToString());
               }

               ddlBrokerageDetails.SelectedItem.Value = brokerageaccountdetails.BrokerageId.ToString();
               grvBrokerage.DataSource = ObjectDataSource1;
               grvBrokerage.DataBind();
           }           
      } 
```

我有一个排序事件，但是当我检查 grvBrokerage.DataSource 时，它​​为空。我很好奇为什么？这是代码吗？

```
 protected void grvBrokerage_Sorting(object sender, GridViewSortEventArgs e)
       {                
         DataTable dt = grvBrokerage.DataSource as DataTable;

            if (dt != null)
            {                    
              DataView dv = new DataView(dt);
              dv.Sort = e.SortExpression + " " + e.SortDirection;    
              grvBrokerage.DataSource = dv;
              grvBrokerage.DataBind();
           }
       } 
```

这是 ObjectDataSource 声明：

```
<asp:ObjectDataSource ID="ObjectDataSource1" 
                      runat="server" 
                      SelectMethod="GetAllWithId"
                      TypeName="BrokerageTransactions">
                      <SelectParameters>
                          <asp:ControlParameter  
                              ControlID="ddlBrokerageDetails"           
                              Name="brokid" 
                              PropertyName="SelectedValue"
                              Type="Object" />
                      </SelectParameters>
</asp:ObjectDataSource> 
```

谢谢，X

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-04T22:58:24.527

当您使用 ObjectDataSource（或任何其他 *DataSource）时，您为 GridView 设置 DataSourceID，而不是 DataSource。DataSourceID 应该是您的 ObjectDataSource 的 ID。如果您提供 ObjectDataSource 的声明，我可能会提供更多帮助。

至于为什么您的数据源在您的排序事件中为空，这是因为您设置了数据源，将页面发送到客户端，单击列标题，回传到服务器，现在有了一个从未有过的全新 GridView 实例它的 DataSource 属性集。旧的 GridView 实例（以及您绑定到的数据表）已被丢弃。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T23:02:19.357

当您回发时，您的数据源不再存在。

尝试在 Page_Init 函数中创建数据源，然后将 gridview 连接到它。一直为我工作（使用 SQLDataSources）。

编辑：或者，您可以在每次回发时为网格重新创建数据源。那可能行得通。

EDIT2：或者，您可以将数据源保存到 ViewState（如果它不是那么大），然后将网格重置为回发时视图状态中的任何数据源（再次强调，数据集不会非常大，否则您将加载时间慢）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T17:20:05.747

与其他 2 个答案一起，要记住的另一件事是，在使用 ObjectDataSource 时，您需要在方法上有一个参数来进行排序。ObjectDataSources 只是将排序表达式作为字符串传递给您的对象，然后由您的对象自行处理排序。在 ObjectDataSource 中，将 SortParameterName 设置为排序参数名称的值。有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.sortparametername.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.sortparametername.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T16:57:57.127

```
Protected Sub gvRevstatus_Sorting(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewSortEventArgs) Handles gvRevstatus.Sorting
    Dim instance As GridView = gvRevstatus Dim cmd As String

    cmd = "SELECT Status,CONVERT(VARCHAR(10),StatusDate,101) AS StatusDate,RevNo,CommentBY FROM tabStatus WHERE ID =" & CInt(lblId.Text.Trim) & _
    " Order by StatusDate"
    dim gvtab as datatable = BOClaim.GVBoundTab(cnstr, cmd, gvstatus) ' my own classto databind
    Dim dv As New DataView(gvtab)
    dv.Sort = e.SortExpression

    gvRevstatus.DataSource = dv
    gvRevstatus.DataBind()
End Sub 
```

# php - PHP/MySQL - How do you determin the field names from a given query result?

> ID：263478
> 
> 赞同：4
> 
> 时间：2008-11-04T21:21:38.047
> 
> 标签：php, mysql

Given a result set, how can I determin the actual names of the fields specified in the query (NOT their aliases).

```
$query = "SELECT first AS First_Name, last AS Last_Name FROM people";
$dbResult = mysql_query($query);

$fieldCount = mysql_num_fields($dbResult);
for ($i=0; $i<$fieldCount; $i++) {          
    // Set some values
    $fieldName = mysql_field_name($dbResult, $i);
} 
```

This example returns field names, but in this example it returns the alias "First_Name" instead of the actual field name "first".

Is it possible to get the actual field name from such a query. Particularly if I am writing a function and have no idea what query will be thrown at it.

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-04T21:25:07.977

If you are using MySQLi:

[http://www.php.net/manual/en/mysqli-result.fetch-field.php](http://www.php.net/manual/en/mysqli-result.fetch-field.php)

The field object has a "orgname" property.

The "classic" MySQL equivalent function doesn't report back the original column names.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-04T21:26:24.743

Short answer: you don't.

Long answer: Once the dataset is pulled by MySQL and sent back to PHP, the only information PHP now has is the columns, or aliases if you used them. There is no way to look at a result set and determine what the original column names were. You have to switch to another DB driver like mysqli to obtain this info.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T22:08:55.657

你的问题没有意义。如果你得到一个派生列，你会怎么做，即

从订单中选择 column_a + column_b 作为 order_total；

您是说您想知道原始查询是 column_a + column b 吗？

如果是这样，您可能需要编写一个查询解析器，或者从互联网上获取一个。

我认为它的实施超出了你的问题范围：）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T23:17:02.853

如果您不介意进行第二次查询（并且您使用 MySQL 5 或更高版本），您可以询问`information_schema`名称。查看[MySQL 参考](http://dev.mysql.com/doc/refman/5.1/en/columns-table.html)以获取详细信息：

> 显示来自 tbl_name 的列；

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T21:25:20.410

I'm not 100% sure about this, but I would say: there is no way.

The MySQL gives you back the result set, nothing more. It does not return the select statement nor any details about it.

So you cannot get the original field names because the server will provide you the information you asked: alias names.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T01:37:02.430

如果您尝试编写一些功能来让您知道正在获取哪些字段来处理更新 - 正确执行此操作的唯一方法是为上面的代码提供一个无 SQL 接口并管理所有 SQL 生成本身。这称为数据抽象层。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T00:27:21.727

如果您有权访问查询的字符串，则可以尝试使用正则表达式来解析它。我不是正则表达式大师，但您可以通过查看“select”和“from”之间的文本来截断字符串，然后将所有字段名称作为

```
 field FieldAlias 
```

或者

```
 field as FieldAlias 
```

# c# - How do you access the ScrollViewer element of a ListBox control in Silverlight/C#?

> ID：263485
> 
> 赞同：6
> 
> 时间：2008-11-04T21:23:04.237
> 
> 标签：c#, silverlight, listbox

I wish to dynamically change the scroll position of a Silverlight ListBox from C#, and I need to know how to access the ScrollViewer element of a ListBox control from C#?

Thanks guys, Jeff

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-26T21:34:53.850

在从 ListBox 类继承的类中，您可以使用 Protected GetTemplateChild()：

`var myScrollviewer = myListBox.GetTemplateChild("ScrollViewer") as ScrollViewer;`

如果您想从 ListBox 外部访问它，那么通过 Property 公开 ScrollViewer 应该可以工作，再次通过继承。

警告：如果您设置了自己的自定义模板，则此 Scrollviewer 可能不存在。您可以使用模板 Scrollviewer 名称而不是上述方法中的“ScrollViewer”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T22:21:37.033

好问题。我没有找到直接执行此操作的方法，但通过查看 Silverlight Controls 项目（他们在某些类中的项目控件上使用滚动查看器）非常接近。以下是获取它的方法，但它需要一个自定义列表框：

```
public class TestBox : ListBox
{
    private ScrollViewer _scrollHost;

    protected override void PrepareContainerForItemOverride(DependencyObject element, object item)
    {
        var itemsHost = VisualTreeHelper.GetParent(element) as Panel;

        for (DependencyObject obj = itemsHost; obj != item && obj != null; obj = VisualTreeHelper.GetParent(obj))
        {
            ScrollViewer viewer = obj as ScrollViewer;
            if (viewer != null)
            {
                _scrollHost = viewer;
                break;
            }
         }

        base.PrepareContainerForItemOverride(element, item);
    }
} 
```

可能有另一种挂钩该事件的方法（或另一种获取该面板的方法），如果您查看 ListBox 的模板，您将看到滚动查看器实际上名为“ScrollViewer”，但是 GetTemplateChild 方法受到保护，因此您仍然需要创建一个自定义类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-13T17:45:21.593

让我们让它变得简单... 在您的 Listbox 模板中，您可能会找到 ScrollViewer 控件。为其添加一个加载方法，您将从发送者 arg 中获取自身。

```
private void ScrollViewer_Loaded(object sender, System.Windows.RoutedEventArgs e)
    {
        myScrollViewer = (sender as ScrollViewer);
    } 
```

这对我有用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-03T09:29:06.800

您可以致电：

```
myListBox.ApplyTemplate(); 
```

强制创建 ListBox 可视化树，否则如果您尝试立即访问 GetTemplateChild() 将返回 Null。

这很好地结合了“ [Erno de Weerd](http://blogs.infosupport.com/blogs/ernow/archive/2008/11/21/Silverlight-and-the-Mouse_2800_Wheel_2900_-part-II.aspx) ”解释：继承 ListBox 以便能够调用 GetTemplateChild() 方法。

我也试过：

*   使用 ListBox 扩展方法“GetScrollHost()”，但它从未对我有用（即使在整页初始化之后）。
*   “FindName()”，但它不起作用，即使我在 ListBox 模板中指定了 ScrollViewer 名称。

伊曼纽尔（银光 3）

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-11-30T14:24:49.623

```
ScrollViewer scrollViewer = yourListBox.getScrollHost(); 
```

如果没有为列表框设置数据源，则为 null，在我的情况下，它仅在执行以下代码后才正确返回 UI 元素

```
myListBox.ItemsSource = list; 
```

# c# - 如何在 ASP.NET MVC 中获取当前用户

> ID：263486
> 
> 赞同：274
> 
> 时间：2008-11-04T21:24:25.497
> 
> 标签：c#, .net, asp.net-mvc, iis, forms-authentication

在表单模型中，我曾经通过以下方式获取当前登录用户：

```
Page.CurrentUser 
```

如何在 ASP.NET MVC 的控制器类中获取当前用户？

* * *

## 回答 #1

> 赞同：271
> 
> 时间：2008-11-04T23:19:36.857

如果您需要从控制器中获取用户，请使用`User`Controller 的属性。如果您从视图中需要它，我会在 中填充您特别需要的内容`ViewData`，或者您​​可以只调用 User ，因为我认为它是`ViewPage`.

* * *

## 回答 #2

> 赞同：207
> 
> 时间：2009-05-27T15:02:05.350

我发现这`User`行得通，也就是说，`User.Identity.Name`或者`User.IsInRole("Administrator")`。

* * *

## 回答 #3

> 赞同：62
> 
> 时间：2008-11-04T21:30:22.520

试试`HttpContext.Current.User`。

> 公共共享属性 Current() 作为 System.Web.HttpContext
> 的 System.Web.HttpContext 成员
> 
> 摘要：
> 获取或设置当前 HTTP 请求的 System.Web.HttpContext 对象。
> 
> 返回值：
> 当前 HTTP 请求的 System.Web.HttpContext

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2013-09-22T19:38:40.363

您可以像这样在 ASP.NET MVC4 中获取用户的名称：

```
System.Web.HttpContext.Current.User.Identity.Name 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-03-25T01:42:00.003

我意识到这真的很老了，但我刚刚开始使用 ASP.NET MVC，所以我想我会坚持我的两分钱：

*   `Request.IsAuthenticated`告诉您用户是否已通过身份验证。
*   `Page.User.Identity`为您提供登录用户的身份。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-11-04T21:29:28.497

我用：

```
Membership.GetUser().UserName 
```

我不确定这是否适用于 ASP.NET MVC，但值得一试:)

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-09-08T12:50:12.053

登录用户名：`System.Web.HttpContext.Current.User.Identity.Name`

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2017-01-12T13:44:53.410

用户名：

```
User.Identity.Name 
```

但是，如果您只需要获取 ID，则可以使用：

```
using Microsoft.AspNet.Identity; 
```

因此，您可以直接获取用户 ID：

```
User.Identity.GetUserId(); 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2018-01-23T23:28:23.173

我们可以使用以下代码在 ASP.Net MVC 中获取当前登录的用户：

```
var user= System.Web.HttpContext.Current.User.Identity.GetUserName(); 
```

还

```
var userName = System.Security.Principal.WindowsIdentity.GetCurrent().Name; //will give 'Domain//UserName'

Environment.UserName - Will Display format : 'Username' 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2013-06-22T19:12:38.247

为了引用使用控制器中内置于 ASP.NET MVC 4 中的简单身份验证创建的用户 ID 以进行过滤（如果您首先使用数据库和 Entity Framework 5 生成代码优先绑定并且您的表的结构如此，这将很有帮助使用了用户 ID 的外键），您可以使用

```
WebSecurity.CurrentUserId 
```

一旦添加了 using 语句

```
using System.Web.Security; 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-11-13T08:51:33.567

此页面可能是您要查找的内容：
[在 MVC3 中使用 Page.User.Identity.Name](https://stackoverflow.com/questions/4613992/using-page-user-identity-name-in-mvc3)

你只需要`User.Identity.Name`.

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2015-08-17T18:04:02.767

使用`System.Security.Principal.WindowsIdentity.GetCurrent().Name`.

这将获取当前登录的 Windows 用户。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2011-09-13T19:10:35.230

对于它的价值，在 ASP.NET MVC 3 中，您可以只使用返回当前请求的用户的用户。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-11-10T13:44:24.513

如果您在登录页面内，例如在 LoginUser_LoggedIn 事件中，Current.User.Identity.Name 将返回一个空值，因此您必须使用 yourLoginControlName.UserName 属性。

```
MembershipUser u = Membership.GetUser(LoginUser.UserName); 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2017-08-14T11:42:13.240

您可以使用以下代码：

```
Request.LogonUserIdentity.Name; 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2011-04-26T13:00:09.497

```
IPrincipal currentUser = HttpContext.Current.User;
bool writeEnable = currentUser.IsInRole("Administrator") ||
        ...
                   currentUser.IsInRole("Operator"); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-06-24T07:47:06.033

```
var ticket = FormsAuthentication.Decrypt(
                    HttpContext.Current.Request.Cookies[FormsAuthentication.FormsCookieName].Value);

if (ticket.Expired)
{
    throw new InvalidOperationException("Ticket expired.");
}

IPrincipal user =  (System.Security.Principal.IPrincipal) new RolePrincipal(new FormsIdentity(ticket)); 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-01-22T16:19:31.980

如果您恰好在 Intranet 上的 Active Directory 中工作，这里有一些提示：

（Windows 服务器 2012）

在 Web 服务器上运行任何与 AD 对话的东西都需要大量的更改和耐心。由于在 Web 服务器与本地 IIS/IIS Express 上运行时，它以 AppPool 的身份运行，因此，您必须将其设置为模拟访问该站点的任何人。

当您的 ASP.NET MVC 应用程序在网络内的 Web 服务器上运行时，如何在活动目录中获取当前登录用户：

```
// Find currently logged in user
UserPrincipal adUser = null;
using (HostingEnvironment.Impersonate())
{
    var userContext = System.Web.HttpContext.Current.User.Identity;
    PrincipalContext ctx = new PrincipalContext(ContextType.Domain, ConfigurationManager.AppSettings["AllowedDomain"], null,
                                                ContextOptions.Negotiate | ContextOptions.SecureSocketLayer);
    adUser = UserPrincipal.FindByIdentity(ctx, userContext.Name);
}
//Then work with 'adUser' from here... 
```

您必须将与“活动目录上下文”有关的所有调用包装在以下内容中，以便它充当获取 AD 信息的托管环境：

```
using (HostingEnvironment.Impersonate()){ ... } 
```

您还必须`impersonate`在 web.config 中设置为 true：

```
<system.web>
    <identity impersonate="true" /> 
```

您必须在 web.config 中启用 Windows 身份验证：

```
<authentication mode="Windows" /> 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-09-29T14:18:46.807

在 Asp.net Mvc Identity 2 中，可以通过以下方式获取当前用户名：

```
var username = System.Web.HttpContext.Current.User.Identity.Name; 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-05-01T17:15:14.610

在 IIS 管理器的身份验证下，禁用：1) 匿名身份验证 2) 表单身份验证

然后将以下内容添加到您的控制器中，以处理测试与服务器部署：

```
string sUserName = null;
string url = Request.Url.ToString();

if (url.Contains("localhost"))
  sUserName = System.Security.Principal.WindowsIdentity.GetCurrent().Name;
else
  sUserName = User.Identity.Name; 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-10-24T14:56:53.777

如果有人还在读这篇文章，那么访问我以下列方式使用的 cshtml 文件。

```
<li>Hello @User.Identity.Name</li> 
```

# .net - Log4Net 或日志记录应用程序块

> ID：263496
> 
> 赞同：12
> 
> 时间：2008-11-04T21:27:02.590
> 
> 标签：.net, logging, log4net

我的应用程序中需要一个日志框架。我有两个候选人：Log4Net 和从应用程序块记录。哪个更好？对他们中的任何一个有什么特别的好处吗？

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-04T21:30:28.450

我发现 Log4Net 更易于设置和使用。Enterprise Library 应用程序块的问题是它们倾向于包含所有东西和厨房水槽，并且可以将看似简单的事情（如日志记录）变成非常复杂的事情。也因为 Log4Net 与我也使用的 nHibernate 一起使用，所以我已经准备好了。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-04T21:44:25.393

除非您已经将企业库用于其他功能，否则我会选择 log4net。我发现企业库有点重，并且需要更多的代码来实际进行日志记录。

log4net 具有以下优点；

*   快速灵活
*   分层的、命名的日志记录类别
*   多个日志记录级别
*   输出到多个日志记录目标
*   动态 XML 配置
*   线程安全
*   日志格式很容易改变
*   经过验证的架构 (log4j)
*   模块化和可扩展设计
*   支持多种框架
*   它背后有一个强大的社区。

我已经使用 log4net 几年了，每当我需要做一些开箱即用的事情时，我很惊讶它最终变得多么容易。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-04T21:34:47.677

我的意见...... Log4Net 工作，表现良好且稳定（如果你知道我的意思，可能太稳定了给定的发布频率）。

如果您需要日志记录，则不太可能不需要企业库公开的其他功能，您将在 Microsoft 路线图上，从定期更新中受益，拥有工具支持（例如配置工具），并且总是有很多恶意文档，远远优于您使用开源获得的文档。

我想我的偏好很明确！一路企业库。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-04T22:59:30.907

Log 4 net 很好：很棒的功能，但是需要一些时间和精力来掌握配置，尤其是当默认输出不够用并且您需要扩展它时。

企业库很重，不确定它们的去向（版本之间存在一些重大变化，尤其是在 DAB 中）。所以我个人远离它。

我目前正在查看 nLog（听说过一些非常好的事情）

更新：我目前很喜欢 nlog。我想提到的一件特别的事情是从代码中配置日志级别的便利性。使用示例： - 用户体验错误 - 我们要求将日志级别设置为跟踪（菜单选项）并执行相同的步骤 - 我们要求将日志文件通过电子邮件发送给我们。（另一个菜单选项）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T19:26:17.760

[log4net 控制台应用程序](http://ysgitdiary.blogspot.com/2009/04/log4net-example-console-app.html) Bellow 的一个简单示例也是配置文件

# cocoa - How do you find the amount of free space on a mounted volume using Cocoa?

> ID：263503
> 
> 赞同：2
> 
> 时间：2008-11-04T21:29:38.280
> 
> 标签：cocoa, macos, volumes

I am using the following code to determine free space on a volume. The folder was provided using NSOpenPanel. The item selected was a mounted volume and the path returned is \Volumes\Name

```
NSDictionary* fileAttributes = [[NSFileManager defaultManager] fileSystemAttributesAtPath:folder];

unsigned long long size = [[fileAttributes objectForKey:NSFileSystemFreeSize] longLongValue]; 
```

Is there a better method to determine the free space on a mounted volume using Cocoa?

Update: This is in fact the best way to determine the free space on a volume. It appeared it wasn't working but that was due to the fact that folder was actually /Volumes rather than /Volume/VolumeName

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-06T15:39:17.377

提供的代码是 Cocoa 中确定卷上可用空间的最佳方式。只需确保提供给 [NSFileManagerObj fileSystemAttributesAtPath] 的路径包含卷的完整路径。我正在删除最后一个路径组件，以确保传递了一个文件夹而不是一个文件，这导致 /Volumes 被用作没有给出正确结果的文件夹。

```
NSDictionary* fileAttributes = [[NSFileManager defaultManager] fileSystemAttributesAtPath:folder];

unsigned long long size = [[fileAttributes objectForKey:NSFileSystemFreeSize] longLongValue]; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T06:38:00.153

statfs 与 df 的结果一致。理论上 NSFileSystemFreeSize 来自 statfs，所以你的问题不应该存在。

您可能希望运行如下 statfs 来替代 NSFileSystemFreeSize：

```
#include <sys/param.h>
#include <sys/mount.h>

int main()
{
    struct statfs buf;

    int retval = statfs("/Volumes/KINGSTON", &buf);

    printf("KINGSTON Retval: %d, fundamental file system block size %ld, total data blocks %d, total in 512 blocks: %ld\n",
            retval, buf.f_bsize, buf.f_blocks, (buf.f_bsize / 512) * buf.f_blocks); 
    printf("Free 512 blocks: %ld\n",  (buf.f_bsize / 512) * buf.f_bfree); 
    exit(0);
} 
```

# android - Placing Zoom Controls in a MapView

> ID：263507
> 
> 赞同：19
> 
> 时间：2008-11-04T21:30:22.257
> 
> 标签：android, android-mapview

I'm trying to get the zoom controls to show up in a `mapview`, the following code almost works, but the zoom controls appear in the top left of the `mapview`, not the bottom center like I'm specifying via `setGravity()`. Can someone enlighten me as to what I'm missing?

```
zoomView = (LinearLayout) mapView.getZoomControls();
zoomView.setLayoutParams(new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,ViewGroup.LayoutParams.WRAP_CONTENT)); 
zoomView.setGravity(Gravity.BOTTOM | Gravity.CENTER_HORIZONTAL);
mapView.addView(zoomView); 
```

These views/layouts are all constructed programmatically, there is no layout file to tweak.

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2010-03-23T12:41:57.843

将以下行添加到您的类的`OnCreate()`方法中：`MapView`

`view.setBuiltInZoomControls(true);`

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-11T07:27:39.023

这里的技巧是在您想要放置 ZoomControls 的位置放置另一个 Layout 容器，然后将 ZoomControls 插入其中。

真正的技巧是使用`RelativeLayout`而不是`LinearLayout`定位元素，如下示例所示`layout.xml`：

```
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" 
    android:layout_width="fill_parent" 
    android:layout_height="fill_parent"> 
  <com.google.android.maps.MapView
    android:id="@+id/myMapView"
    android:layout_width="fill_parent" 
    android:layout_height="fill_parent"
    android:enabled="true"
    android:clickable="true"
    android:apiKey="MY_MAP_API_KEY"
  />
  <LinearLayout android:id="@+id/layout_zoom" 
    android:layout_width="wrap_content" 
    android:layout_height="wrap_content" 
    android:layout_alignParentBottom="true" 
    android:layout_centerHorizontal="true" 
  /> 
</RelativeLayout> 
```

layout_zoom LinearLayout 元素位于屏幕的底部中心，将其放置*在*`MapView`.

然后在您的 Activity 中`onCreate`，获取对*layout_zoom*元素的引用并将 ZoomControl 插入其中，就像您已经完成的那样：

```
LinearLayout zoomLayout =(LinearLayout)findViewById(R.id.layout_zoom);  
View zoomView = myMapView.getZoomControls(); 
zoomLayout.addView(zoomView, new LinearLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)); 
myMapView.displayZoomControls(true); 
```

ZoomControls 现在应该出现在长按上，而不会窃取地图触摸事件。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-05-12T22:51:38.790

以上对我不起作用，但这确实（将控件放在右下角）：

```
mapView.setBuiltInZoomControls(true);
ZoomButtonsController zbc = mapView.getZoomButtonsController();
ViewGroup container = zbc.getContainer();
for (int i = 0; i < container.getChildCount(); i++) {
    View child = container.getChildAt(i);
    if (child instanceof ZoomControls) {
        FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) child.getLayoutParams();
        lp.gravity = Gravity.RIGHT | Gravity.BOTTOM;
        child.requestLayout();
        break;
    } 
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-28T06:32:53.580

Reto：感谢您的回复，但我们的想法是*不*使用 XML 布局。

我最终解决了这个问题。因为 MapView 是 ViewGroup 的子类，所以您可以轻松添加子视图（如缩放控件）。您只需要一个 MapView.LayoutParams 实例就可以了。我做了这样的事情（将缩放控件放在地图视图的底部中心）。

```
 // layout to insert zoomcontrols at the bottom center of a mapview
  MapView.LayoutParams params = MapView.LayoutParams(
    LayoutParams.WRAP_CONTENT,
    LayoutParams.WRAP_CONTENT,
    mapViewWidth / 2, mapViewHeight,
    MapView.LayoutParams.BOTTOM_CENTER);

  // add zoom controls
  mapView.addView(mapView.getZoomControls(), params); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T22:44:53.670

不幸的是，我无法从 11 月 28 日 6:32 开始对 Jason Hudgins 批准的解决方案添加评论，但我的代码出现了一个小错误：

在这一行：

```
MapView.LayoutParams params = MapView.LayoutParams( 
```

Eclipse 给我的错误是

> “方法 LayoutParams(int, int, int, int, int) 对于 MapView 类型未定义”

相反，创建一个新的 MapView.LayoutParams 对象来修复它，如下所示：

```
MapView.LayoutParams params = **new** MapView.LayoutParams( 
```

我花了一些时间才知道，因为我是 n00b :D

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-27T11:45:14.717

从[谷歌组线程](http://groups.google.com/group/android-developers/browse_thread/thread/b4a12843cd33497b)我发现这个：

没有 XML 的 ZoomControls：

```
 public class MyMapActivity extends MapActivity {  public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        RelativeLayout relativeLayout = new RelativeLayout(this);
        setContentView(relativeLayout);

        final MapView mapView = new MapView(this, DEBUG_MAP_API_KEY);
        RelativeLayout.LayoutParams mapViewLayoutParams = new
RelativeLayout.LayoutParams
(RelativeLayout.LayoutParams.FILL_PARENT,RelativeLayout.LayoutParams.FILL_PARENT );
        relativeLayout.addView(mapView, mapViewLayoutParams);

        RelativeLayout.LayoutParams zoomControlsLayoutParams = new
RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.WRAP_CONTENT,
RelativeLayout.LayoutParams.WRAP_CONTENT );
        zoomControlsLayoutParams.addRule
(RelativeLayout.ALIGN_PARENT_BOTTOM);
        zoomControlsLayoutParams.addRule
(RelativeLayout.CENTER_HORIZONTAL);

        relativeLayout.addView(mapView.getZoomControls(),
zoomControlsLayoutParams);

        mapView.setClickable(true);
        mapView.setEnabled(true);

 } 
```

使用 SDK1.1 为我工作 100%

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-09-25T06:59:22.593

你可以试试这个：

```
MapView map = (MapView)findViewById(R.id.mapview);
map.setBuiltInZoomControls(true); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-08T20:24:37.723

Reto - 使用 FILL_PARENT 的问题是缩放控件会“窃取”所有的触摸事件；这样您就无法在缩放控件可见时平移地图。你知道如何防止这种情况吗？

# .net - 将 Subversion 与 .net 项目文件一起使用的任何提示？

> ID：263514
> 
> 赞同：3
> 
> 时间：2008-11-04T21:31:14.000
> 
> 标签：.net, svn, version-control, vb.net

我们刚刚从 TFS 切换到 SVN，到目前为止我们都很喜欢它。

但是，它确实引入了一些新问题。

一种是处理项目文件（特别是.vbproj）的方式。.vbproj 文件当然总是随着文件和引用的变化而变化，如果几个人合作就会有冲突。

奇怪的是，在 TFS 中，我们不必处理管理这些冲突，该特定部分是自动处理的。现在在 SVN 中，我们正在合并工具中处理 XML，并且已经出现了一些错误。

你怎么处理这个？有小费吗？

**编辑：**顺便说一句，我们正在使用 VisualSVN。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T21:39:05.077

在 SVN 中，*proj 文件的主要问题是当人们将文件移动到不同的文件夹时，和/或当他们同时添加和删除类似命名的文件时，通常是在项目开始时。

一旦文件名和项目结构变得更加稳定，这种情况就不会再发生了。

另外，只包含 .sln 和 .vbproj 文件，不要包含不断变化的 .suo 文件，以减少头痛。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-04T21:37:35.813

如果多个开发人员将文件添加到同一个项目，则会出现此特定问题。

当多个开发人员将文件添加到同一个项目时，要解决冲突，您通常可以通过使用“先于他们的”选项来解决冲突。它会将您的两个更改添加到一起。

通过经常提交和更新可以缓解这个问题和其他合并问题。如果可能，每天提交一次或更多。你越久没有更新和提交，你和你的团队就会感到越痛苦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T21:46:09.837

我们通常做的是一次更新 *proj 文件 + 添加或移动文件存根 + 提交。使操作尽可能原子化，并尽可能缩短持续时间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T00:22:38.743

您确定您的项目文件未标记为二进制文件吗？如果您的 .vbproj 文件的 svn:mime-type 属性的值不是以 'text/' 开头的，则将禁用 Subversions 自动合并。

几年前我们从 VSS 转换时，大多数项目文件都被标记为二进制文件。删除 mime-type 属性删除了大多数冲突情况。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T00:44:23.813

试试[VisualSVN](http://visualsvn.com)。它与[TortoiseSVN](http://tortoisesvn.net)一起为您管理一切，并将 Subversion 功能与 Visual Studio 集成。它还为用户特定的项目文件和二进制文件设置 svn:ignore 以保存它们被提交到存储库。非常值得努力。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-08T18:37:26.940

试试[AnkhSVN](http://ankhsvn.open.collab.net/)。对版本 2 非常满意。开箱即用它忽略 .suo 文件等，与 VS 2008 完美配合，而且它是免费的！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-04T21:38:22.380

你需要像 Toroise 这样体面的客户。您确实偶尔会在自动合并中遇到冲突，但我从来没有与 .vbproj 发生冲突，并且它们很容易被 diff 程序纠正。

id 使用 _svn 而不是 .svn，出于多种原因，我不记得为什么现在我的头顶上出现了“。” 确实让我很伤心。

确保你不提交 .user 和 .suo 文件，否则你会不断获取项目的 VS 设置，烦人！

您还可以获取 VS 的客户端插件，例如 ankh 和 visual svn，我只使用了一点 ankh，但它有点慢，但这可能是我的 PC 故障。

# c# - 使用 webclient 类将文件上传到文件服务器

> ID：263518
> 
> 赞同：11
> 
> 时间：2008-11-04T21:31:56.387
> 
> 标签：c#, file-upload, webclient, fileserver

目前我有一个应用程序从我的网络应用程序接收上传的文件。我现在需要将该文件传输到恰好位于同一网络上的文件服务器（但可能并非总是如此）。

我试图在 C# .NET 中使用 webclient 类。

```
 string filePath = "C:\\test\\564.flv";
    try
    {
        WebClient client = new WebClient();

        NetworkCredential nc = new NetworkCredential(uName, password);

        Uri addy = new Uri("\\\\192.168.1.28\\Files\\test.flv");
        client.Credentials = nc;
        byte[] arrReturn = client.UploadFile(addy, filePath);
        Console.WriteLine(arrReturn.ToString());
    }
    catch (Exception ex)
    {
        Console.WriteLine(ex.Message);
    } 
```

位于 192.168.1.28 的机器是一个文件服务器并且有一个共享 c:\Files。截至目前，我收到登录失败的错误用户名或密码错误，但我可以打开资源管理器并成功输入该路径登录。我也可以使用远程桌面登录，所以我知道用户帐户有效。

关于这个错误的任何想法？可以这样直接传输文件吗？使用 webclient 类或其他类？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-04T21:34:28.723

只需使用

```
File.Copy(filepath, "\\\\192.168.1.28\\Files"); 
```

通过 UNC 路径公开的 windows 文件共享被视为文件系统的一部分，与 Web 无关。

使用的凭据将是 ASP.NET 工作进程的凭据，或者您启用的任何模拟。如果您可以调整它们以使其正确，则可以做到这一点。

您可能会遇到问题，因为您使用的是 IP 地址而不是服务器名称（Windows 信任设置会阻止离开域 - 通过使用 IP，您会隐藏任何域详细信息）。 **如果可能，请使用服务器名称！**

如果这不在同一个 Windows 域上，并且您尝试使用不同的域帐户，则需要将用户名指定为“[domain_or_machine]\[username]”

如果您需要指定显式凭据，则需要考虑[编写模拟解决方案](http://www.codeproject.com/KB/cs/cpimpersonation1.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-30T10:26:24.327

```
namespace FileUpload
{
public partial class Form1 : Form
{
    string fileName = "";
    public Form1()
    {
        InitializeComponent();
    }

    private void button1_Click(object sender, EventArgs e)
    {

        string path = "";
        OpenFileDialog fDialog = new OpenFileDialog();
        fDialog.Title = "Attach customer proposal document";
        fDialog.Filter = "Doc Files|*.doc|Docx File|*.docx|PDF doc|*.pdf";
        fDialog.InitialDirectory = @"C:\";
        if (fDialog.ShowDialog() == DialogResult.OK)
        {
            fileName = System.IO.Path.GetFileName(fDialog.FileName);
            path = Path.GetDirectoryName(fDialog.FileName);
            textBox1.Text = path + "\\" + fileName;

        }
    }

    private void button2_Click(object sender, EventArgs e)
    {
        try
        {
            WebClient client = new WebClient();

            NetworkCredential nc = new NetworkCredential("erandika1986", "123");

            Uri addy = new Uri(@"\\192.168.2.4\UploadDocs\"+fileName);

            client.Credentials = nc;
            byte[] arrReturn = client.UploadFile(addy, textBox1.Text);
            MessageBox.Show(arrReturn.ToString());

        }
        catch (Exception ex1)
        {
            MessageBox.Show(ex1.Message);
        }
    }
}
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T21:35:45.037

当您手动打开 IP 地址（通过 RUN 命令或映射网络驱动器）时，您的 PC 将通过管道发送您的凭据，并且文件服务器将接收来自 DC 的授权。

当 ASP.Net 尝试时，它将尝试使用 IIS 工作用户（除非打开模拟，这将列出一些其他问题）。传统上，IIS 工作用户无权跨服务器工作（甚至在 Web 服务器上的其他文件夹中）。

# vb6 - 有没有类似 Javadoc 的好 VB6 文档系统？

> ID：263534
> 
> 赞同：5
> 
> 时间：2008-11-04T21:36:01.807
> 
> 标签：vb6, documentation-system

我正在使用 VB6 代码库，我有兴趣开始为未来的开发工作生成文档。我传统上是一名 Java 开发人员，而且我已经非常习惯使用 Javadoc 系统来生成此类文档。我找到[了 VB.DOC](http://vb-doc.sourceforge.net/)，但据我所知，它适用于 .NET 环境。有没有可以在VB6中工作的？

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:49:40.407

有[一些过滤器](http://www.doxygen.nl/helpers.html)可以让您在 VB6 中使用[Doxygen](http://www.doxygen.nl/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-10T07:33:06.390

我和[VbDox 玩得很开心](http://vbdox.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T13:18:19.470

我用过[文档！X](http://www.innovasys.com/products/dx2008/overview.aspx)版本 4，但我不得不说它不是最稳定的程序，有时会导致 IDE 崩溃。也许以后的版本有所改进；他们似乎仍然支持 VB 5&6。

# ruby - 从本地文件或 url 打开一个 IO 流

> ID：263536
> 
> 赞同：109
> 
> 时间：2008-11-04T21:36:12.587
> 
> 标签：ruby, stream

我知道有其他语言的库可以采用包含本地文件路径或 url 的字符串并将其作为可读 IO 流打开。

在红宝石中有一种简单的方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-11-05T03:00:30.593

[open-uri](http://ruby-doc.org/stdlib/libdoc/open-uri/rdoc/index.html)是标准 Ruby 库的一部分，它将重新定义 的行为，`open`以便您可以打开 url 以及本地文件。它返回一个`File`对象，因此您应该能够调用 和 之类的`read`方法`readlines`。

```
require 'open-uri'
file_contents = open('local-file.txt') { |f| f.read }
web_contents  = open('http://www.stackoverflow.com') {|f| f.read } 
```

# c# - 从 Web.config 读取休眠属性

> ID：263548
> 
> 赞同：3
> 
> 时间：2008-11-04T21:38:59.883
> 
> 标签：c#, .net, xml, nhibernate, config

我正在处理的 C# 项目使用 nHibernate，并且连接字符串在 web.config 中作为 Hibernate 元素的属性。我需要阅读安装程序中的连接字符串才能在不使用 Hibernate 的情况下手动获取连接。我知道我可以使用 configManager.connectionStrings，但由于连接字符串已经在 web.config 的 Hibernate 部分中定义，我不想将它再次复制到 connectionStrings 元素中。那么我怎样才能访问它呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T17:08:06.573

您可以将连接字符串放在 web.config 的 <connectionStrings /> 部分，然后让 NHibernate 从那里获取它。在 NHibernate 设置中，删除 <connection.connection_string> 属性并将其替换为 <connection.connection_string_name> 提供来自 <connectionStrings> 部分的名称。有关详细信息，请参见[此处](http://nhforge.org/doc/nh/en/index.html#configuration-hibernatejdbc)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T15:55:47.527

```
<hibernate>
    <add key="hibernate.connection.provider" value="NHibernate.Connection.DriverConnectionProvider"/>
    <add key="hibernate.dialect" value="NHibernate.Dialect.MsSql2000Dialect"/>
    <add key="hibernate.connection.driver_class" value="NHibernate.Driver.SqlClientDriver"/>
    <add key="hibernate.connection.connection_string" value="${local}"/>
</hibernate>

<connectionStrings>
    <add name="local" connectionString="server=(local);database=db;Uid=username;Pwd=password;"/>
</connectionStrings> 
```

这使它在您的 ConfigurationManager 中可用，但仅被引用一次。

# c# - 我们有一个图形设计师，现在他们想要一个基于文本的设计师。建议？

> ID：263550
> 
> 赞同：4
> 
> 时间：2008-11-04T21:39:36.823
> 
> 标签：c#, python, scripting, parsing, embedding

很抱歉我想不出更好的标题。

问题如下：

对于我们的客户，我们创建了（作为更大应用程序的一部分）一个图形设计器，他们可以使用它来构建“场景”。

这些场景由“复合”组成，而“复合”又由“命令”组成。这些命令对象都派生自 CommandBase 并实现了一个名为 ICompilable 的接口。

场景类还实现了 ICompilable。当在命令上调用 Compile() 时，会返回一个字节数组，然后可以将其发送到它们所针对的设备（无法透露有关该硬件的太多信息，抱歉）

只是给你一个想法：

```
var scenario = new Scenario();

scenario.Add(new DelayCommand(1));
scenario.Add(new CountWithValueCommand(1,ActionEnum.Add,1));
scenario.Add(new DirectPowerCommand(23,false,150));
scenario.Add(new WaitCommand(3));
scenario.Add(new DirectPowerCommand(23,false,150));
scenario.Add(new SkipIfCommand(1,OperatorEnum.SmallerThan,10));
scenario.Add(new JumpCommand(2));

byte[] compiledData = scenario.Compile(); 
```

图形设计师从用户那里抽象出所有这些，并允许他（或她）简单地将复合材料拖放到设计师表面上。（组合可以对命令进行分组，因此我们可以为返回任务提供构建块）

最近我们的客户来找我们说，“设计师真的很酷，但我们有些人更愿意拥有某种编程语言，只是一些简单的东西。”

（当然对他们来说很简单）

我非常想为他们提供一种简单的语言，它可以调用各种命令，还可以用更好的结构替换 SkipIfCommand 等...

我不知道从哪里开始或我的选择是什么（不破坏我们所拥有的）

我听说有人嵌入诸如 Python 之类的语言，有人编写自己的语言和解析器，等等……

有什么建议么？

PS：用户只使用复合，从不使用命令。组合是在运行时动态加载的（连同它们的图形设计器），并且可以由第三方在单独的程序集中提供。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:47:19.053

据我所知，我理解你有两种选择

您可以使用 XML 样式的“标记”让他们定义实体及其分组，但这可能不是最好的。

你的选择是肯定的，你可以嵌入一种语言，但你真的需要吗，那不是矫枉过正，你怎么能控制它？

如果您只需要非常简单的语法，那么也许可以编写自己的语言。实际上，创建一个简单的解释器并不难，只要你有一种严格、明确的语言。看看你使用的任何编译器的一些例子，c#？

我在 uni 用 java 写了一个非常简单的interperter，它没有你想象的那么难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T22:08:12.163

对于简单的 DSL，这看起来是一个完美的场景。有关一些信息，请参阅[http://msdn.microsoft.com/en-us/library/bb126235(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb126235(VS.80).aspx)。

您还可以使用脚本语言，例如 lua.Net。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T22:11:58.990

如果您真的只想要一种简单的语言，那么您需要一个“递归下降解析器”。

例如，这样的语言：

```
SCENARIO MyScenario
DELAY 1
COUNT 1 ADD 1
DIRECT_POWER 23, False, 150
WAIT 3
...
END_SCENARIO 
```

你可能有这样的语法：

```
scenario :: 'SCENARIO' label newline _cmds END_SCENARIO
cmds::  _delay or _count or _direct_power or...
delay:: 'DELAY' number 
```

这给出了如下代码：

```
def scenario():
    match_word('SCENARIO')
    scenario_name = match_label()
    emit('var scenario = new Scenario();')
    cmds()
    match_word('END_SCENARIO')
    emit('byte[] ' + scenario_name + ' = scenario.Compile();')

def delay():
    match_word('DELAY')
    length = match_number()
    emit('scenario.Add(new DelayCommand('+ length +'))')

def cmds():
    word = peek_next_word()
    if word == 'DELAY':
       delay()
    elif ... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-04T22:31:45.050

这是一个用于构建 DSL 的 Pythonic 解决方案，您可以使用它来编译和创建字节码数组。

1.  编写一个简单的模块，使您的 C# 结构可用于 Python。目标是将允许用户使用的每个 C# 类（Composites 或 Commands 或其他）定义为 Python 类。

    通常，这涉及实现一组最小的方法，其中包含从 C# 类型到本机 Python 类型的不同转换，反之亦然。

2.  编写一些不错的演示，展示如何使用这些 Python 类定义来创建它们的脚本。你应该能够在 Python 中创建这样的东西。

    ```
    import * from someInterfaceModule
    scenario= Scenario(
        Delay(1),
        Repeat( Range(10),
            DirectPower( 23, False, 150),
            Wait(3),
            DirectPower( 23, False, 150)
        )
    )
    scenario.compile() 
    ```

这些是定义相对简单的类。这里的每个类都可以相当容易地实现为直接调用基本 C# 模块的 Python 模块。

语法是纯 Python，不需要额外的解析或词法扫描。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-04T22:36:41.420

要添加到 S.Lott 的评论中，以下是您如何[从 C# 评估 Python 脚本](http://www.redmountainsw.com/wordpress/archives/embedding-ironpython-c-calling-python-script)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T23:57:34.313

虽然创建这种迷你语言并将其全部编码可能会很有趣，但您需要提出的真正问题是：

1.  添加此功能/设施的商业案例是什么？
2.  谁来为这个功能买单？
3.  如果您构建此功能，谁将“签署”此功能？

当现实可能表明对此类请求的真正答案是“不”时，“非常整洁”的功能有一种构建方式。

在继续之前，看看您是否有愿意赞助的利益相关者。然后在提交项目之前与最终用户核实，看看他们真正想要什么。

干杯，

-R

# c# - 数据绑定 WPF 中 WebBrowser 的 Source 属性

> ID：263551
> 
> 赞同：90
> 
> 时间：2008-11-04T21:39:37.120
> 
> 标签：c#, wpf, xaml, data-binding, browser

有谁知道如何在 WPF ( 3.5SP1 ) 中对 WebBrowser 的 .Source 属性进行数据绑定？我有一个列表视图，我希望左侧有一个小型 WebBrowser，右侧有内容，并将每个 WebBrowser 的源与绑定到列表项的每个对象中的 URI 进行数据绑定。

到目前为止，这是我作为概念证明所拥有的，但“ `<WebBrowser Source="{Binding Path=WebAddress}"`”无法编译。

```
<DataTemplate x:Key="dealerLocatorLayout" DataType="DealerLocatorAddress">                
    <StackPanel Orientation="Horizontal">
         <!--Web Control Here-->
        <WebBrowser Source="{Binding Path=WebAddress}"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled" 
            ScrollViewer.VerticalScrollBarVisibility="Disabled" 
            Width="300"
            Height="200"
            />
        <StackPanel Orientation="Vertical">
            <StackPanel Orientation="Horizontal">
                <Label Content="{Binding Path=CompanyName}" FontWeight="Bold" Foreground="Blue" />
                <TextBox Text="{Binding Path=DisplayName}" FontWeight="Bold" />
            </StackPanel>
            <TextBox Text="{Binding Path=Street[0]}" />
            <TextBox Text="{Binding Path=Street[1]}" />
            <TextBox Text="{Binding Path=PhoneNumber}"/>
            <TextBox Text="{Binding Path=FaxNumber}"/>
            <TextBox Text="{Binding Path=Email}"/>
            <TextBox Text="{Binding Path=WebAddress}"/>
        </StackPanel>
    </StackPanel>
</DataTemplate> 
```

* * *

## 回答 #1

> 赞同：163
> 
> 时间：2008-11-05T16:12:57.403

问题是它[`WebBrowser.Source`](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.webbrowser.source?view=netframework-4.8)不是一个`DependencyProperty`. 一种解决方法是使用一些`AttachedProperty`魔法来启用此功能。

```
public static class WebBrowserUtility
{
    public static readonly DependencyProperty BindableSourceProperty =
        DependencyProperty.RegisterAttached("BindableSource", typeof(string), typeof(WebBrowserUtility), new UIPropertyMetadata(null, BindableSourcePropertyChanged));

    public static string GetBindableSource(DependencyObject obj)
    {
        return (string) obj.GetValue(BindableSourceProperty);
    }

    public static void SetBindableSource(DependencyObject obj, string value)
    {
        obj.SetValue(BindableSourceProperty, value);
    }

    public static void BindableSourcePropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)
    {
        WebBrowser browser = o as WebBrowser;
        if (browser != null)
        {
            string uri = e.NewValue as string;
            browser.Source = !String.IsNullOrEmpty(uri) ? new Uri(uri) : null;
        }
    }

} 
```

然后在您的 xaml 中执行以下操作：

```
<WebBrowser ns:WebBrowserUtility.BindableSource="{Binding WebAddress}"/> 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-07-07T15:55:10.350

我已经稍微修改了 Todd 的优秀答案，以生成一个可以处理来自 Binding 源的字符串或 Uris 的版​​本：

```
public static class WebBrowserBehaviors
{
    public static readonly DependencyProperty BindableSourceProperty =
        DependencyProperty.RegisterAttached("BindableSource", typeof(object), typeof(WebBrowserBehaviors), new UIPropertyMetadata(null, BindableSourcePropertyChanged));

    public static object GetBindableSource(DependencyObject obj)
    {
        return (string)obj.GetValue(BindableSourceProperty);
    }

    public static void SetBindableSource(DependencyObject obj, object value)
    {
        obj.SetValue(BindableSourceProperty, value);
    }

    public static void BindableSourcePropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)
    {
        WebBrowser browser = o as WebBrowser;
        if (browser == null) return;

        Uri uri = null;

        if (e.NewValue is string )
        {
            var uriString = e.NewValue as string;
            uri = string.IsNullOrWhiteSpace(uriString) ? null : new Uri(uriString);
        }
        else if (e.NewValue is Uri)
        {
            uri = e.NewValue as Uri;
        }

        browser.Source = uri;
    } 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-06-10T15:19:32.507

我写了一个包装用户控件，它利用了 DependencyProperties：

XAML：

```
<UserControl x:Class="HtmlBox">
    <WebBrowser x:Name="browser" />
</UserControl> 
```

C＃：

```
public static readonly DependencyProperty HtmlTextProperty = DependencyProperty.Register("HtmlText", typeof(string), typeof(HtmlBox));

public string HtmlText {
    get { return (string)GetValue(HtmlTextProperty); }
    set { SetValue(HtmlTextProperty, value); }
}

protected override void OnPropertyChanged(DependencyPropertyChangedEventArgs e) {
    base.OnPropertyChanged(e);
    if (e.Property == HtmlTextProperty) {
        DoBrowse();
    }
}
 private void DoBrowse() {
    if (!string.IsNullOrEmpty(HtmlText)) {
        browser.NavigateToString(HtmlText);
    }
} 
```

并像这样使用它：

```
<Controls:HtmlBox HtmlText="{Binding MyHtml}"  /> 
```

这个唯一的问题是WebBrowser控件不是“纯” wpf ...它实际上只是一个win32组件的包装器。这意味着控件不会尊重 z-index，并且将始终覆盖其他元素（例如：在滚动查看器中，这可能会导致一些麻烦）有关[MSDN上这些 win32-wpf 问题的更多信息](http://msdn.microsoft.com/en-us/library/ms742522.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-05-07T21:03:24.760

酷主意托德。

我现在对 Silverlight 4 中的 RichTextBox.Selection.Text 做了类似的事情。谢谢你的帖子。工作正常。

```
public class RichTextBoxHelper
{
    public static readonly DependencyProperty BindableSelectionTextProperty =
       DependencyProperty.RegisterAttached("BindableSelectionText", typeof(string), 
       typeof(RichTextBoxHelper), new PropertyMetadata(null, BindableSelectionTextPropertyChanged));

    public static string GetBindableSelectionText(DependencyObject obj)
    {
        return (string)obj.GetValue(BindableSelectionTextProperty);
    }

    public static void SetBindableSelectionText(DependencyObject obj, string value)
    {
        obj.SetValue(BindableSelectionTextProperty, value);
    }

    public static void BindableSelectionTextPropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)
    {
        RichTextBox rtb = o as RichTextBox;
        if (rtb != null)
        {
            string text = e.NewValue as string;
            if (text != null)
                rtb.Selection.Text = text;
        }
    }
} 
```

这是 Xaml 代码。

```
<RichTextBox IsReadOnly='False' TextWrapping='Wrap' utilities:RichTextBoxHelper.BindableSelectionText="{Binding Content}"/> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-20T19:59:21.933

这是对 Todd 和 Samuel 的回答的改进，以利用一些基本的逻辑前提以及使用空合并运算符。

```
public static void BindableSourcePropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)
{
    WebBrowser browser = o as WebBrowser;

    if ((browser != null) && (e.NewValue != null))
        browser.Source = e.NewValue as Uri ?? new Uri((string)e.NewValue);

} 
```

1.  如果浏览器为空或位置为空，我们无法使用或导航到空页面。
2.  当 #1 中的项目不为空时，然后在分配时，如果新值是 URI，则使用它。如果不是并且 URI 为空，那么它必须是一个可以放入 URI 的字符串；因为#1 强制字符串不能为空。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2012-11-15T23:33:42.450

`xaml`您需要在指向类文件 的文件的前几行声明它

```
xmlns:reportViewer="clr-namespace:CoMS.Modules.Report" 
```

# .net - DirectoryEntry.NativeObject 在 Windows 2008 中为管理员组中的用户抛出访问被拒绝

> ID：263552
> 
> 赞同：2
> 
> 时间：2008-11-04T21:40:01.720
> 
> 标签：.net, permissions, windows-server-2008, directoryservices, administrator

我有一个本地用户，它是管理员本地组的成员。

当我运行此代码时：

```
using System;
using System.DirectoryServices;

namespace nanttest
{
    class Program
    {
        public static void Main(string[] args)
        {
            using(DirectoryEntry entry = new DirectoryEntry("IIS://localhost/W3SVC"))
            {
                object absobject = entry.NativeObject;
                Console.WriteLine("Name: {0}", entry.Name);
            }

            Console.Write("Press any key to continue . . . ");
            Console.ReadKey(true);
        }
    }
} 
```

我收到：

> 未处理的异常：System.Runtime.InteropServices.COMException (0x80070005)：访问被拒绝。
> 
> 在 System.DirectoryServices.DirectoryEntry.Bind(Boolean throwIfFail) 在 System.DirectoryServices.DirectoryEntry.Bind() 在 System.DirectoryServices.DirectoryEntry.get_NativeObject() 在 nanttest.Program.Main(String[] args) 在 c:\Work\ nanttest\nanttest\Program.cs：第 20 行

如果我在以管理员身份登录时运行此代码，它可以正常工作。

此外，如果我以 DomainAdmin 用户身份登录运行此代码，则此代码将失败。我已将 MYDOMAIN\DomainAdmins 和 MYDOMAIN\mydomainuser 添加为本地管理员组的成员。

我应该为这些用户添加哪些其他权限，以便他们可以运行此代码。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-04T22:51:27.240

回答我自己的问题，以便其他人可以找到解决方案：

问题在于 Windows 2008 中的默认 UAC 设置。即使用户在管理员组中，他/她仍然需要提升权限才能运行某些操作（上面的操作似乎就是其中之一）。

因此，解决方案 1 - 使用“以管理员身份运行”运行应用程序，或者从使用该选项启动的命令提示符启动它。

解决方案 2：为管理员组禁用 UAC - 我使用了[本文中](http://www.petri.co.il/disable_uac_in_windows_vista.htm)的方法 #3 （组策略更改）。请记住在进行这些更改后重新启动服务器。

# linux - 冗余 Linux 内核系统调用

> ID：263563
> 
> 赞同：5
> 
> 时间：2008-11-04T21:43:02.730
> 
> 标签：linux, kernel, system-calls

我目前正在开发一个项目，该项目挂钩各种系统调用并将内容写入日志，具体取决于调用的是哪个。因此，例如，当我更改文件的权限时，我会在日志文件中写入一个小条目来跟踪旧权限和新权限。但是，我在确定应该观看的确切位置时遇到了一些麻烦。对于上面的示例，strace 告诉我“chmod”命令使用系统调用 sys_fchmodat()。但是，还有一个 sys_chmod() 和一个 sys_fchmod()。

我确信内核开发人员知道他们在做什么，但我想知道：所有这些（看似）冗余系统调用的意义何在，是否有任何规则说明哪些系统调用用于什么？（即“at”系统调用还是以“f”为前缀的系统调用是为了做一些特定的事情？）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-04T22:12:33.170

历史 ：-）

一旦创建了系统调用，就不能再更改它，因此当需要新功能时，就会创建新的系统调用。（当然这意味着在创建新系统调用之前有一个非常高的标准）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-04T23:59:02.457

是的，有一些命名规则。

*   chmod 采用文件名，而 fchmod 采用文件描述符。stat 与 fstat 相同。
*   fchmodat 采用文件描述符/文件名对（目录的文件描述符和目录中的文件名的文件名）。与其他 *at 通话相同；[有关说明，请参见http://kerneltrap.org/man/linux/man2/openat.2](http://kerneltrap.org/man/linux/man2/openat.2)的 NOTES 部分。

# asp.net - 亚音速构建错误

> ID：263566
> 
> 赞同：0
> 
> 时间：2008-11-04T21:43:33.227
> 
> 标签：asp.net, subsonic, build-process

我正在尝试将 SubSonic 用于具有现有数据库的新项目，但是当我在生成 SubSonic 文件后尝试构建项目时，我在不同的类上遇到了这两个相同的异常：

*   'MyData.UserCollection' 的部分声明不得指定不同的基类
*   类型“MyData.UserCollection”已经定义了一个名为“UserCollection”的成员，具有相同的参数类型

我能够使用 Northwind DB 成功构建一个新项目，所以我认为该错误与表的设置方式有关，但我不确定从那里去哪里。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T21:54:38.307

在您的项目中搜索 UserCollection。SubSonic 在 User.cs 生成的文件中为此生成了一个部分类。您要么拥有自己的 UserCollection，在这种情况下，您可能应该重命名它或将其放在另一个命名空间中。要么，要么您尝试向 UserCollection 添加功能，然后从另一种类型派生它。

最后一种可能性是您有一个用户表和一个用户表。SubSonic 会将用户更改为用户。我不确定，但它可能会导致生成错误。我还没有尝试过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-04T22:28:20.283

抢，

谢谢您的帮助。你让我走上了正确的轨道。显然，生成器不喜欢名称中带有“Collection”一词的表格。我现在看到错误在于：

```
public partial class UserCollectionCollection : ActiveList<UserCollection, UserCollectionCollection>
public partial class UserCollection : ActiveList<User, UserCollection> 
```

通过增加：

```
regexMatchExpression="Collection" 
regexReplaceExpression="Group" 
```

到我的 web.config 文件中的提供程序，我能够成功构建。

# asp.net - ASP.NET 的好日期选择器

> ID：263574
> 
> 赞同：5
> 
> 时间：2008-11-04T21:45:54.783
> 
> 标签：asp.net, calendar

我一直是 DHTML 日历的忠实粉丝[http://www.dynarch.com/projects/calendar/](http://www.dynarch.com/projects/calendar/)

我计划将它用于即将在 ASP.NET 中进行的项目，但我不介意找到一个专门作为 ASP.NET 用户控件制作的新日历控件。

有谁知道那里有一些我应该去看看的好东西吗？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-04T21:58:33.977

JQuery UI 有一个不错的日历/日期选择器，值得一看。最重要的是它是免费的！[点击这里](http://jqueryui.com/demos/datepicker/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T21:53:08.293

这个是免费的，我在订阅 Telerik 或 DevExpress 之前就使用了它。

[http://www.basicdatepicker.com/bdplite](http://www.basicdatepicker.com/bdplite)

此外，如果您使用 jQuery，那么还有一些非常出色的日期选择器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T21:51:09.687

我正在使用[来自 AJAX.NET 的日历，并](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Calendar/Calendar.aspx)进行了一些自定义调整（例如正确处理时间）和[Telerik 的 RadCalendar](http://demos.telerik.com/aspnet/prometheus/Calendar/Examples/Overview/DefaultCS.aspx)控件，这非常好（但不是免费的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T23:05:32.907

我有（除了伟大的 JQuery UI）另外两个选项：

*   Ajax Control Toolkit（来自 codeplex.com）：很棒，免费，但不支持 IE6 iFrame 覆盖错误

*   oBout 日历（[http://www.obout.com/calendar/calendar_home.aspx](http://www.obout.com/calendar/calendar_home.aspx)）：不是免费的，但可以处理 IE6 错误，并且还有一个不错的“飞行”模式，两个日历一起工作（开始/结束日期）

问候克里斯托夫

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T00:01:35.757

对于真正全面的日期相关组件，请查看 Peters Blums 的资料：[http://www.peterblum.com/DES/DateAndTime.aspx](http://www.peterblum.com/DES/DateAndTime.aspx)我们已经使用这些多年了

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T02:47:57.823

它不是免费的，但 Telerik DateTimePicker 在我的团队中表现良好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T00:57:36.490

[Ra-Ajax 日历](http://ra-ajax.org/samples/Ajax-Calendar.aspx)是 LGPL 并且免费使用...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-11T23:58:12.540

我们使用了[Yahoo! UI 图书馆日历](http://developer.yahoo.com/yui/calendar/)没有任何抱怨。

# c# - 报表查看器 - 请求 SqlClientPermission 类型的权限失败

> ID：263578
> 
> 赞同：6
> 
> 时间：2008-11-04T21:46:44.250
> 
> 标签：c#, winforms, visual-studio-2008, reporting-services, sqlclient

我在本地模式下使用 Visual Studio 2008 中的 ReportViewer 控件，并将对象作为数据源。我的类被映射到我的数据库中的数据表。在对象中，它根据需要加载相关对象。因此，在您尝试使用该属性之前，它会保留引用为空，然后它会尝试自动从数据库中加载它。这些类使用 System.Data.SqlClient 命名空间。

当我与 Windows 窗体应用程序中的对象交互时，一切都按预期工作。但是当我传递要用作报表数据源的对象并尝试自动加载相关对象时，它会失败。该代码创建了一个 SqlConnection 对象，当我在其上调用 GetCommand() 时，会引发以下异常：

```
[System.Security.SecurityException] {
"Request for the permission of type 'System.Data.SqlClient.SqlClientPermission, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' failed."
} System.Security.SecurityException 
```

我尝试搜索错误，但显示的所有结果都是针对在 SQL Server 或 ASP.Net 上运行的 CLR 程序集。在创建 SqlConnection 对象之前，我尝试在我的代码中添加以下调用（如搜索结果中所建议的那样），但它显然没有做任何事情：

```
System.Data.SqlClient.SqlClientPermission(System.Security.Permissions.PermissionState.Unrestricted).Assert(); 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-05-24T05:19:56.123

除了 CuppM 的回答。该`ExecuteReportInCurrentAppDomain`方法自 .NET4 以来已弃用，`LocalReport.SetBasePermissionsForSandboxAppDomain`应改为使用，因为 ReportViewer 现在*始终*在沙盒域中执行：

```
PermissionSet permissions = new PermissionSet(PermissionState.None);
permissions.AddPermission(new FileIOPermission(PermissionState.Unrestricted));
permissions.AddPermission(new SecurityPermission(SecurityPermissionFlag.Execution));
ReportViewer1.LocalReport.SetBasePermissionsForSandboxAppDomain(permissions); 
```

[在此处](http://msdn.microsoft.com/en-us/library/microsoft.reporting.winforms.localreport.setbasepermissionsforsandboxappdomain.aspx)查看详细信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T18:25:05.767

我找到了解决方案。您指定 System.Security.Policy.Evidence 执行程序集（或具有足够权限的程序集）到 LocalReport 以在执行期间使用。

```
reportViewer.LocalReport.ExecuteReportInCurrentAppDomain(System.Reflection.Assembly.GetExecutingAssembly().Evidence); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T13:31:36.940

以防有人像我在搜索此权限错误时那样偶然发现此问题。我在使用**Windows-Forms-Application**时遇到了这个错误，因为客户在他的机器上使用“\COMPUTERNAME\C$\Application.exe”而不是“C:\Application.exe”将快捷方式链接到我的 Application-Exe。- 这导致了 System.Security.Permission 由于不受信任的 Intranet 使用而失败。

有关更多信息，请参见[http://www.duelec.de/blog/?p=236](http://www.duelec.de/blog/?p=236)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-02T15:18:08.530

上面Artem答案的脚注......

将 Windows 身份验证添加到我的 asp.net 应用程序时遇到了这个问题。以 Framework 4.5 为目标并使用报告组件 11\. 当我允许匿名用户（在早期开发中）时，我在使用 ReportViewer 时没有遇到任何问题。一旦启用 Windows 身份验证，我就会在分组表达式上得到“#Error”，或者根本无法运行报告，给出上面列出的异常。

我能够解决这个问题，但对 Artem 发布的内容进行了略微修改。除了一般意义上的允许 CAS 信任沙盒化的 ReportViewer 代码之外，我不完全确定代码的作用。任何带有一点解释的评论将不胜感激。

```
 Dim permissions As PermissionSet = New PermissionSet(PermissionState.Unrestricted)
    myReportViewer.LocalReport.SetBasePermissionsForSandboxAppDomain(permissions) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T14:09:14.627

一个快速的想法，虽然这不是我见过的错误，但请确保您的 Assert 与设置资源数据源的代码使用相同的方法：

```
System.Data.SqlClient.SqlClientPermission mPermission = new SqlClientPermission(System.Security.Permissions.PermissionState.Unrestricted);
try
{
    mPermission.Assert();
    //rest of your code
}
//Handle Exceptions 
```

权限断言不会长期存在，它们可能是一个安全问题，因此尽可能靠近需要它们的代码最有可能工作。

# sql - 如何构建表以建模互斥的 1:n 关系？

> ID：263582
> 
> 赞同：1
> 
> 时间：2008-11-04T21:47:16.293
> 
> 标签：sql, database-design, normalization, foreign-key-relationship

在下表结构中：

```
Fruits 
(
    fruit_id,
    fruitName
)

Vegetables
(
    vegetable_id,
    vegetableName
)

favoriteFoods 
(
     food_id,
     foodName,
     type_id (References either a fruit or a vegetable)
) 
```

我意识到我可以放弃在 favoriteFoods 表上使用外键约束，然后简单地在 favoriteFoods 表中添加一个类型字段来区分水果和蔬菜。但是，您将如何构建表以便实际创建必要的外键约束？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T21:51:10.873

我只会使用 2 张桌子。与其有一个单独的水果和蔬菜表，不如有一个食物表。然后在 fkfood_id 到 food_id 上有一个外键约束。然后，如果由于某种原因你不得不添加肉，维护使用它的应用程序会容易得多。

```
Food
    (
    food_id,
    foodName,
    foodType
    )

favoriteFoods
    (
    favoritefood_id,
    fkfood_id
    ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T16:15:12.453

这取决于您将如何处理数据。

如果出于某种原因归一化对您很重要，那么以下方法效果很好。

```
Fruits (    
     fruit_id,
     food_id references favoritefoods.food_id,
     fruitName)
Vegetables(
     vegetable_id,
     food_id references favoritefoods.food_id,
     vegetableName)
favoriteFoods (
     food_id,
     foodName) 
```

favoriteFoods 表不需要“知道”它是什么类型的食物，如果有的话。每种水果和每种蔬菜都绑定了相应的喜爱食物。

如果你想从 favoriteFoods 中选择所有的水果，只需加入 fruits 表和 favoriteFoods 表。如果你喜欢的话，你甚至可以把番茄既作为蔬菜又作为水果加入。

以上是基于连接便宜的假设。在许多情况下，连接确实很便宜。在更改设计以避免连接之前检查一下。

# c# - C# 中的不可变对象模式 - 你怎么看？

> ID：263585
> 
> 赞同：47
> 
> 时间：2008-11-04T21:49:02.657
> 
> 标签：c#, functional-programming, design-patterns, immutability

在几个项目的过程中，我开发了一种用于创建不可变（只读）对象和不可变对象图的模式。不可变对象具有 100% 线程安全的优点，因此可以跨线程重用。在我的工作中，我经常在 Web 应用程序中将这种模式用于配置设置以及我在内存中加载和缓存的其他对象。缓存对象应该始终是不可变的，因为您希望确保它们不会被意外更改。

现在，您当然可以轻松地设计不可变对象，如下例所示：

```
public class SampleElement
{
  private Guid id;
  private string name;

  public SampleElement(Guid id, string name)
  {
    this.id = id;
    this.name = name;
  }

  public Guid Id
  {
    get { return id; }
  }

  public string Name
  {
    get { return name; }
  }
} 
```

这对于简单的类来说很好——但对于更复杂的类，我不喜欢通过构造函数传递所有值的概念。在属性上有设置器更可取，并且构建新对象的代码更易于阅读。

那么如何使用 setter 创建不可变对象呢？

好吧，在我的模式中，对象一开始是完全可变的，直到你用一个方法调用冻结它们。一旦一个对象被冻结，它将永远保持不可变——它不能再次变成一个可变对象。如果您需要对象的可变版本，您只需克隆它。

好的，现在开始一些代码。我在以下代码片段中尝试将模式归结为最简单的形式。IElement 是所有不可变对象最终必须实现的基本接口。

```
public interface IElement : ICloneable
{
  bool IsReadOnly { get; }
  void MakeReadOnly();
} 
```

Element 类是 IElement 接口的默认实现：

```
public abstract class Element : IElement
{
  private bool immutable;

  public bool IsReadOnly
  {
    get { return immutable; }
  }

  public virtual void MakeReadOnly()
  {
    immutable = true;
  }

  protected virtual void FailIfImmutable()
  {
    if (immutable) throw new ImmutableElementException(this);
  }

  ...
} 
```

让我们重构上面的 SampleElement 类来实现不可变对象模式：

```
public class SampleElement : Element
{
  private Guid id;
  private string name;

  public SampleElement() {}

  public Guid Id
  {
    get 
    { 
      return id; 
    }
    set
    {
      FailIfImmutable();
      id = value;
    }
  }

  public string Name
  {
    get 
    { 
      return name; 
    }
    set
    {
      FailIfImmutable();
      name = value;
    }
  }
} 
```

您现在可以通过调用 MakeReadOnly() 方法更改 Id 属性和 Name 属性，只要该对象未被标记为不可变。一旦它是不可变的，调用 setter 将产生 ImmutableElementException。

最后说明：完整模式比此处显示的代码片段更复杂。它还包含对不可变对象集合和不可变对象图的完整对象图的支持。完整模式使您可以通过调用最外层对象的 MakeReadOnly() 方法将整个对象图变为不可变。一旦开始使用这种模式创建更大的对象模型，泄漏对象的风险就会增加。泄漏对象是在对对象进行更改之前未能调用 FailIfImmutable() 方法的对象。为了测试泄漏，我还开发了一个用于单元测试的通用泄漏检测器类。它使用反射来测试是否所有属性和方法都将 ImmutableElementException 抛出为不可变状态。换句话说，这里使用了 TDD。

我已经非常喜欢这种模式，并从中发现了巨大的好处。所以我想知道的是你们中是否有人使用类似的模式？如果是，您是否知道任何记录它的好资源？我本质上是在寻找潜在的改进以及在这个主题上可能已经存在的任何标准。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-04T22:28:39.797

对于信息，第二种方法称为“冰棒不变性”。

Eric Lippert 有一系列关于不变性的博客文章，从[这里](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/immutability-in-c-part-one-kinds-of-immutability)开始。我仍然在掌握 CTP (C# 4.0)，但看起来有趣的是可选/命名参数（到 .ctor）在这里可能会做什么（当映射到只读字段时）...... [更新：我已经写了博客在[这里](https://blog.marcgravell.com/2008/11/immutability-and-optional-parameters.html)]

对于信息，我可能不会使用这些方法`virtual`- 我们可能不希望子类能够使其不可冻结。如果您希望他们能够添加额外的代码，我建议您这样做：

```
[public|protected] void Freeze()
{
    if(!frozen)
    {
        frozen = true;
        OnFrozen();
    }
}
protected virtual void OnFrozen() {} // subclass can add code here. 
```

此外 - AOP（例如 PostSharp）可能是添加所有 ThrowIfFrozen() 检查的可行选项。

（抱歉，如果我更改了术语/方法名称 - SO 在撰写回复时不会保持原始帖子可见）

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-04T21:59:32.073

另一种选择是创建某种 Builder 类。

例如，在 Java（以及 C# 和许多其他语言）中，String 是不可变的。如果要执行多个操作来创建字符串，请使用 StringBuilder。这是可变的，然后一旦你完成，你就会让它返回给你最终的 String 对象。从此，一成不变。

你可以为你的其他课程做类似的事情。你有你的不可变元素，然后是一个 ElementBuilder。构建器所做的就是存储您设置的选项，然后当您完成它时，它会构造并返回不可变的元素。

它的代码要多一些，但我认为它比在一个应该是不可变的类上设置 setter 更干净。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-04T21:58:42.027

在我最初对每次修改都必须创建一个新的事实感到不安之后`System.Drawing.Point`，几年前我完全接受了这个概念。事实上，我现在`readonly`默认创建每个字段，并且只有在有令人信服的理由时才将其更改为可变的——这令人惊讶地很少。

不过，我不太关心跨线程问题（我很少在相关的地方使用代码）。由于语义表达能力，我发现它好多了。不变性是难以错误使用的接口的缩影。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-04T21:53:14.473

您仍在处理状态，因此如果您的对象在变为不可变之前被并行化，仍然可能会被咬。

更实用的方法可能是使用每个设置器返回对象的新实例。或者创建一个可变对象并将其传递给构造函数。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-04T22:27:30.847

（相对）新的软件设计范式称为领域驱动设计，区分实体对象和值对象。

实体对象被定义为必须映射到持久数据存储中的键驱动对象的任何事物，例如员工、客户或发票等......其中更改对象的属性意味着您需要将更改保存到某处的数据存储中，并且具有相同“键”的类的多个实例的存在意味着需要同步它们，或协调它们对数据存储的持久性，以便一个实例的更改不会覆盖其他实例. 更改实体对象的属性意味着您正在更改有关该对象的某些内容 - 而不是更改您正在引用的对象...

值对象otoh，是可以被认为是不可变的对象，其效用由它们的属性值严格定义，并且多个实例不需要以任何方式协调......比如地址、电话号码或轮子汽车上，或文档中的字母……这些东西完全由它们的属性定义……文本编辑器中的大写“A”对象可以与整个文档中的任何其他大写“A”对象透明地互换，您不需要密钥来将其与所有其他“A”区分开来。从这个意义上说，它是不可变的，因为如果您将其更改为“B”（就像在电话号码对象中更改电话号码字符串一样，您不是更改与某个可变实体关联的数据，您正在从一个值切换到另一个值......就像你改变一个字符串的值一样......

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-04T23:48:19.280

@Cory Foy 和@Charles Bretana 扩展了实体和值之间存在差异的观点。尽管值对象应该始终是不可变的，但我真的不认为一个对象应该能够冻结自己，或者允许自己在代码库中任意冻结。它有一种非常难闻的气味，我担心它很难追踪一个对象被冻结的确切位置，以及它被冻结的原因，以及在调用一个对象之间它可以将状态从解冻更改为冻结的事实.

这并不是说有时你想给某物一个（可变的）实体并确保它不会被改变。

所以，不是冻结对象本身，另一种可能是复制 ReadOnlyCollection<T> 的语义

```
List<int> list = new List<int> { 1, 2, 3};
ReadOnlyCollection<int> readOnlyList = list.AsReadOnly(); 
```

您的对象可以在需要时将其作为可变部分，然后在您希望时将其变为不可变。

请注意，ReadOnlyCollection< T > 还实现了 ICollection< T >，它`Add( T item)`在接口中有一个方法。然而，在接口中也`bool IsReadOnly { get; }`定义了，以便消费者可以在调用将引发异常的方法之前进行检查。

不同之处在于您不能只将 IsReadOnly 设置为 false。集合要么是只读的，要么不是只读的，并且在集合的生命周期内永远不会改变。

在编译时拥有 C++ 为您提供的 const 正确性会很好，但这开始有它自己的一系列问题，我很高兴 C# 没有去那里。

* * *

**ICloneable** - 我想我只是参考以下内容：

> 不要实现 ICloneable
> 
> 不要在公共 API 中使用 ICloneable

[Brad Abrams - 设计指南、托管代码和 .NET Framework](http://blogs.msdn.com/brada/archive/2003/04/09/49935.aspx)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-04T21:56:12.827

System.String 是具有设置器和变异方法的不可变类的一个很好的例子，只是每个变异方法都返回一个新实例。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-11-03T21:05:54.483

这是一个重要的问题，我很乐意看到更直接的框架/语言支持来解决它。您拥有的解决方案需要大量样板文件。通过使用代码生成来自动化一些样板文件可能很简单。

您将生成一个包含所有可冻结属性的部分类。为此制作一个可重用的 T4 模板相当简单。

模板会将此作为输入：

*   命名空间
*   班级名称
*   属性名称/类型元组列表

并会输出一个 C# 文件，其中包含：

*   命名空间声明
*   部分类
*   每个属性，以及相应的类型、一个支持字段、一个 getter 和一个调用 FailIfFrozen 方法的 setter

可冻结属性上的 AOP 标记也可以工作，但它需要更多的依赖项，而 T4 内置在较新版本的 Visual Studio 中。

另一个非常相似的场景是`INotifyPropertyChanged`界面。该问题的解决方案可能适用于该问题。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-02-06T13:36:49.287

我对这种模式的问题是您没有对不变性施加任何编译时限制。编码器负责确保在将对象添加到缓存或其他非线程安全结构之前将其设置为不可变。

这就是为什么我会以泛型类的形式使用编译时限制来扩展这种编码模式，如下所示：

```
public class Immutable<T> where T : IElement
{
    private T value;

    public Immutable(T mutable) 
    {
        this.value = (T) mutable.Clone();
        this.value.MakeReadOnly();
    }

    public T Value 
    {
        get 
        {
            return this.value;
        }
    }

    public static implicit operator Immutable<T>(T mutable) 
    {
        return new Immutable<T>(mutable);
    }

    public static implicit operator T(Immutable<T> immutable)
    {
        return immutable.value;
    }
} 
```

这是一个示例，您将如何使用它：

```
// All elements of this list are guaranteed to be immutable
List<Immutable<SampleElement>> elements = 
    new List<Immutable<SampleElement>>();

for (int i = 1; i < 10; i++) 
{
    SampleElement newElement = new SampleElement();
    newElement.Id = Guid.NewGuid();
    newElement.Name = "Sample" + i.ToString();

    // The compiler will automatically convert to Immutable<SampleElement> for you
    // because of the implicit conversion operator
    elements.Add(newElement);
}

foreach (SampleElement element in elements)
    Console.Out.WriteLine(element.Name);

elements[3].Value.Id = Guid.NewGuid();      // This will throw an ImmutableElementException 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-04T21:56:37.523

我不喜欢能够将对象从可变状态更改为不可变状态的想法，这对我来说似乎违背了设计的意义。你什么时候需要这样做？只有代表 VALUES 的对象才应该是不可变的

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-05T12:37:53.470

简化元素属性的提示：使用[自动属性](http://blogesh.wordpress.com/2008/02/09/property-shortcuts-in-c-30/)并`private set`避免显式声明数据字段。例如

```
public class SampleElement {
  public SampleElement(Guid id, string name) {
    Id = id;
    Name = name;
  }

  public Guid Id {
    get; private set;
  }

  public string Name {
    get; private set;
  }
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-08T09:37:26.633

这是第 9 频道上的一个新视频，Anders Hejlsberg 在采访中从 36:30 开始谈论 C# 中的不变性。他为冰棒不变性提供了一个非常好的用例，并解释了这是您目前需要自己实现的东西。听到他说在未来的 C# 版本中对创建不可变对象图的更好支持值得考虑

[专家对专家：Anders Hejlsberg - C# 的未来](http://channel9.msdn.com/shows/Going+Deep/Expert-to-Expert-Anders-Hejlsberg-The-Future-of-C/)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-06-23T20:23:35.333

尚未讨论的针对您的特定问题的另外两个选项：

1.  构建您自己的反序列化器，它可以调用私有属性设置器。虽然一开始构建反序列化器的工作量会更大，但它使事情变得更干净。编译器将阻止您尝试调用设置器，并且您的类中的代码将更易于阅读。

2.  在每个类中放置一个构造函数，该构造函数接受一个 XElement（或某种其他形式的 XML 对象模型）并从中填充自身。显然，随着类数量的增加，这种解决方案很快就会变得不那么理想。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-11-30T20:51:28.737

有一个抽象类 ThingBase，子类 MutableThing 和 ImmutableThing 怎么样？ThingBase 将包含受保护结构中的所有数据，为字段提供公共只读属性，并为其结构提供受保护的只读属性。它还将提供一个可覆盖的 AsImmutable 方法，该方法将返回一个 ImmutableThing。

MutableThing 将使用读/写属性隐藏属性，并提供默认构造函数和接受 ThingBase 的构造函数。

不可变的东西将是一个密封的类，它覆盖 AsImmutable 以简单地返回自身。它还将提供一个接受 ThingBase 的构造函数。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2013-04-10T14:56:15.337

您可以将可选的命名参数与 nullables 一起使用，以使用非常少的样板创建一个不可变的 setter。如果您确实想将属性设置为 null，那么您可能会遇到更多麻烦。

```
class Foo{ 
    ...
    public Foo 
        Set
        ( double? majorBar=null
        , double? minorBar=null
        , int?        cats=null
        , double?     dogs=null)
    {
        return new Foo
            ( majorBar ?? MajorBar
            , minorBar ?? MinorBar
            , cats     ?? Cats
            , dogs     ?? Dogs);
    }

    public Foo
        ( double R
        , double r
        , int l
        , double e
        ) 
    {
        ....
    }
} 
```

你会这样使用它

```
var f = new Foo(10,20,30,40);
var g = f.Set(cat:99); 
```

# c# - 在 C# 中实现多于一种对象的堆栈的最佳方法是什么？

> ID：263586
> 
> 赞同：2
> 
> 时间：2008-11-04T21:49:23.717
> 
> 标签：c#, oop

我正在用 C# 编写虚拟机的实现，我需要实现 VM 的堆栈，它可以包含两种类型的条目 - 返回条目或回溯条目。实现这一点的最佳方法是什么？

我目前使用的是基本类型，如下：

```
class StackEntry { }
class Return : StackEntry { uint pc; }
class Backtrack : StackEntry { uint pc; object backtrack; }

Stack<StackEntry> stack; 
```

这可以正常工作，但产生的类型测试和向下转换感觉很笨拙。

有没有更好的方法来处理这种类型的结构？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-04T22:00:50.277

我很难想象您将如何使用它，但基本答案是您使用具有默认操作的单一类型进行后期处理

```
StackEntry { protected virtual void PostPop(); }
Return : StackEntry { protected override void PostPop(); }
Backtrack : StackEntry { protected override void PostPop(); } 
```

那有意义吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T21:52:54.393

无论如何将 BackTrack 对象放入其中有什么问题，如果没有回溯则让它为空？您可以添加一个有用的属性，例如 bool IsBacktrack { get { return _backTrack != null; } }

回溯可以有效地为空吗？如果是，则为其使用布尔标志。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T21:52:39.903

为什么你需要下投？如果您的基类公开了抽象或虚拟成员，或者是一个接口，那么您应该没有问题。这个原则是 OOP 的基础。

如果这对您不起作用，那么您在 myStack[x].GetType() 上进行切换

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T22:01:43.377

这取决于您期望的抽象级别。基类方法非常好。只有当基准测试显示这种方式损失了太多性能时，我才会尝试更深入地研究，也许使用具有显式内存布局的定制结构，其行为类似于 C `union`。

您的代码如何以负面的方式影响可用性？

# .net - 可以听一个双胞胎（也许是 WIA）扫描仪吗？

> ID：263588
> 
> 赞同：5
> 
> 时间：2008-11-04T21:49:50.580
> 
> 标签：.net, vb.net, twain, image-scanner

我正在评估 VintaSoft .net 控件和 Atalasoft DotTwain Image Capture。而且我对大多数定义和关键字感到非常但非常迷茫。

所以我问这个是因为我认为我在拉拉的土地上。是否可以收听或让扫描仪告诉我的应用程序有扫描的图像并且我可以处理它？

这个想法是有一个 winservice 等待扫描仪扫描某些东西，并在发生这种情况时处理图像。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T22:33:20.570

我只使用过 TWAIN 和 WIA 的本机接口，所以我不能保证它们之上的这些其他层。但是，对于 TWAIN，确实存在一些允许通知应用程序捕获数据的机制。我相信这是用 STI.dll 处理的，这是一个在 Windows 2000+ 上可用的旧库。查找 StiCreateInstance 以获取更多信息。

如果你选择走WIA路线，那就简单多了。您可以注册以接收事件，例如“扫描”按钮或“图像创建”事件。然后您需要做的就是处理这些事件以获取图像。其中最困难的部分是找到实现您想要的功能的硬件。

Microsoft 有一个 WIA 自动化库，它使许多这些任务变得更加简单。它可以被脚本语言使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-04T22:56:20.960

我们最近将 TWAIN 整合到我们的一个应用程序中。我们查看了 WIA，但最终 TWAIN 更加灵活，可以连接到 VRS（Virtual ReScan）等应用程序。最后它是“拉”，您请求扫描，然后等待扫描仪。VRS 的一大优点是它是我们的 TWAIN 调用和设备之间的软件，因此，它会处理一些事情，其中​​之一是它可以几乎永远等待纸张放入纸盒用于扫描。这允许“开始”扫描作业然后等待纸张，它还允许将其他页面添加到单元中。

如果您正在寻找更“推送”的东西，那么请寻找支持 ftp/smb/email 等的扫描仪或 MFP 并让它扫描，您可以简单地监控文件夹或 POP3 邮箱的工作。

您还可以查看包含（有时需要额外付费）工具的 MFP 设备，例如 Xerox 的 Template、Lexmark 的 LDSS、HP 的 DSS。

这是我们基于扫描仪集成的 .NET TWAIN 代码的链接：http: [//www.codeproject.com/KB/dotnet/twaindotnet.aspx](http://www.codeproject.com/KB/dotnet/twaindotnet.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-04T22:19:57.337

[编辑 - 如果是我，我会看看 adzm 的回答；-p]

据我了解，常规 TWAIN 是扫描仪的“拉”，而不是“推”。我很可能是错的...

我希望这样的接口确实存在于高端、大容量的扫描仪（你知道，台球桌大小的扫描仪）——但对于普通消费者扫描仪来说（AFAIK）不存在。

为了与 .NET（以及在此之前的 COM）一起使用，我一直使用[ImageMan](http://www.data-tech.com/products/imaging/imagemannettwain.aspx)进行管理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-21T06:50:35.627

可以让扫描仪告诉您的应用程序有扫描的图像。我不熟悉 VintaSoft .net 控件和 Atalasoft DotTwain Image Capture，但是对于一些 twain sdks，每次扫描后都会触发 OnPostTransfer/OnPostAllTransfer 事件，以便您可以“通知”您的 winservice

# php - 使用 PHP + MySQL 切换数据库有多快？

> ID：263599
> 
> 赞同：0
> 
> 时间：2008-11-04T21:52:03.897
> 
> 标签：php, mysql, performance, mysql-select-db

我想知道在每次调用站点的每个页面时在 2 个数据库之间切换的速度会有多慢。该站点为不同的客户提供了许多不同的数据库，以及用于一些常规设置的“全局”数据库。我想知道如果每个脚本必须连接到数据库、选择一个数据库、执行查询或 2、切换到另一个数据库然后完成页面生成，是否会为每个脚本的执行添加很多时间。我也可以在每个数据库中重复数据，我只需要维护它（只会在升级时改变）。

那么，到底有多快`mysql_select_db()`？

**编辑：**是的，我可以单独连接到每个数据库，但由于这通常是任何 PHP 脚本中最慢的部分，我想避免这种情况，尤其是因为它在每个页面上。（这很慢，因为 PHP 必须进行某种地址解析（无论是 IP 还是主机名），然后 MySQL 必须两次检查登录参数。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T22:00:34.347

假设两个数据库在同一台机器上，则不需要执行 mysql_select_db。您可以在查询中指定数据库。例如;

```
SELECT * FROM db1.table1; 
```

您还可以打开两个连接并使用从连接调用返回的 DB 对象，并使用这两个对象来选择数据库并传递给所有调用。数据库连接是所有 mysql db 调用的可选参数，只需检查文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T01:34:22.823

你问的是两个完全不同的问题。

1.  连接到多个数据库实例

2.  切换默认数据库模式。

众所周知，MySQL 的连接建立时间非常快；对不同的服务器进行两次`mysql_connect()`调用几乎不比一次更昂贵。

该调用与语句`mysql_select_db()`完全相同`USE`，只是更改了不合格表引用的默认数据库模式。

在 MySQL 周围使用术语“数据库”时要小心：它有两种不同的含义。

# c# - 图像缓存、HTTPHandler 和 FormsAuthentication

> ID：263607
> 
> 赞同：6
> 
> 时间：2008-11-04T21:54:01.193
> 
> 标签：c#, iis, cookies

**设置：**

我正在开发一个`Formsauthentication`使用 cookie 存储登录票的网站。该站点还有一个`HTTPHandler`管理存储在数据库中的图像。处理程序将图像缓存为公开并在 20 分钟后过期。我们注意到，由于图像与页面具有相同的生命周期，因此图像还包含`Formsauthentication`cookie。配置为 IIS 6，Win2k 服务器，未启用 Content Expiration。

**问题：**

我们正在经历的是人 A 登录并点击了几页。然后人 B 会点击未登录的默认页面并获取人 A 的 cookie，并且能够看到人 A 的所有数据。我们曾经通过在 IIS 中打开内容过期来重现该问题，但并没有一致地重现，因此我们不确定内容过期是否有助于我们重现它。我们假设由于图像被缓存为公共图像，并且它们还包含带有 的 cookie `FormsAuthentication`，因此 B 可能会无意中获取 A 的 cookie。我们知道这不是对网站的攻击。

有没有人经历过类似这种行为的事情？如果是这样，您能否就如何始终如一地重现此问题提供任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T22:24:06.000

我们假设 cookie 在 Response Header 中，并且正在将 Person A 的机器上存在的相同 cookie 写入 Person B。重要的是要注意这个问题发生在 IE 7 中的 Person A 和 FireFox 中的 Person B 上。同样，当人员 A 注销时，人员 B 也已注销，因为 Formsauthentication 票证在服务器上不再有效。所以是的，他们确实有不同的 cookie，但在他们的每个 cookie 中有相同的表单身份验证票。然而，在没有登录的情况下生成了一个。

我们也找到了这篇文章，但无法确认这是否是原因。[http://support.microsoft.com/default.aspx?scid=kb;EN-US;917072](http://support.microsoft.com/default.aspx?scid=kb;EN-US;917072)

我会看看 LiveHTTP 告诉我什么，并会报告回来。谢谢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T22:17:09.633

为什么 B 会得到 A 的 cookie？我假设您的意思是人 B 的会话 cookie 与 A 的登录 ID 相关联。这就是问题的关键。

在我看来，A 的登录 ID 被存储在一个可以交叉请求的地方——例如临时文件或数据库中——而没有将其与会话 cookie 关联。（相关问题：页面输出正在被缓存，但没有与会话 cookie 正确关联或检索。）当会话信息被存储或缓存时，它*必须*与 cookie 关联。考虑属于浏览器的会话数据，而不是登录。

我将安装 Firefox 扩展 LiveHTTP 并检查请求/响应标头。我敢打赌，你会看到 A 和 B 有不同的 cookie，但在服务器上它们都与相同的登录 ID 相关联。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T17:31:50.723

所有流量都是 SSL...查看 IIS 日志，所有内容都通过端口 443。唯一设置的缓存是在图像上公开，如前所述。我们的假设是这是导致问题的结果输出缓存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T22:33:03.487

当然，如果这些图像（以及 CSS 和静态 JS 文件等）没有作为 HTTPS 提供，它们将受到 ISP 或其他代理（实际上是缓存）以及它们的 cookie 的缓存。

有一个类似这样的缓存指令：

```
Cache-control: no-cache="set-cookie,set-cookie2" 
```

...这应该指示缓存不要缓存“set-cookie”响应标头，但我不确定它的支持范围有多广（尽管它是标准的）。

如果可以，在提供图像时避免使用 set-cookie 响应标头（如果您不能完全控制会话管理，可能并不容易）。如果用户必须通过身份验证才能查看某些图像，那么这些图像无论如何都不应该被公开缓存。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T22:42:22.580

抱歉，我忘了提到所有流量都通过端口 443 作为 SSL。我们正计划删除为图像设置的 cookie。但是，当所有流量都通过 SSL 处理时，我们并不感到困惑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-18T23:24:37.713

你确定你没有在页面上启用输出缓存之类的东西吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-19T06:08:48.833

安装 Fiddler 以调查您的 http 请求可能会有所帮助，如上所述。此外，请确认 cookie 是否相同。您的处理程序或表单身份验证系统是否使用静态对象引用？您的代码中可能存在竞争条件。并且没有正确锁定您的资源。

# c# - SQL 2 LINQ 查询（由数据绑定调用）完全冻结 WPF 应用程序

> ID：263612
> 
> 赞同：0
> 
> 时间：2008-11-04T21:55:33.623
> 
> 标签：c#, wpf, linq, linq-to-sql, data-binding

今天早些时候，我正在寻找一个非常奇怪的错误......我终于将其追溯到似乎导致问题的原因。

原始报告可以在这里找到：[原始问题](https://stackoverflow.com/questions/262017/weird-behaviour-when-running-clickonce-deployed-version-of-wpf-application)

细节已经发生了足够的变化，足以提出一个新问题。

当我的应用程序到达以下 LINQ 查询时，有时（并非所有时间）似乎会冻结：

```
using (NetworkDatabaseContext db = new 

NetworkDatabaseContext(UISession.ConnectionString))
{
   Ballast ballast = db.Ballasts.FirstOrDefault(b => b.NetworkId == UISession.NetworkId &&
          b.ShortAddress == this.innerBallast.ShortAddress && b.ControllerSerial == this.controllerSerial); 
```

这是它的样子：

[![没反应](https://i.stack.imgur.com/w8OYA.jpg)](https://i.stack.imgur.com/w8OYA.jpg)

大多数情况下，这工作得很好......但时不时地它会锁定。此代码是 BallastListItem 类的一部分。此类的项目绑定到页面上的 ListBox：

```
<ListView Name="lstBallasts" Margin="5" DockPanel.Dock="Top" MinHeight="100"><!-- The MinHeight is used to get a good view in the designer -->
        <ListView.View>
            <GridView>
                <GridViewColumn Header="Address" DisplayMemberBinding="{Binding InnerBallast.ShortAddress}" Width="70"/>
                <GridViewColumn Header="Name" Width="300">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <TextBox Name="txtBallastDisplayName" Text="{Binding DisplayName}" Width="270" MaxWidth="270" MaxLength="100"/>
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>
                <GridViewColumn Header="Type" DisplayMemberBinding="{Binding DeviceType}" Width="150"/>
                <GridViewColumn Header="Status" DisplayMemberBinding="{Binding InnerBallast.StandardVersion}" Width="150"/>
            </GridView>
        </ListView.View>
    </ListView> 
```

该代码是 DisplayName 属性 getter 的一部分：

```
public string DisplayName
    {
        get
        {
            using (NetworkDatabaseContext db = new NetworkDatabaseContext(UISession.ConnectionString))
            {
                Ballast ballast = db.Ballasts.FirstOrDefault(b => b.NetworkId == UISession.NetworkId && 
                   b.ShortAddress == this.innerBallast.ShortAddress && b.ControllerSerial == this.controllerSerial); 
```

所以这段代码是在数据绑定发生时调用的，之前应该已经意识到了。我仍然不知道为什么这有时会导致问题......

**更新**

在这两种情况下（当应用程序冻结和不冻结时），连接状态在查询代码之前都是“关闭”的，我可以从以下内容中看到：

```
db.Connection.State.ToString() 
```

**更新 2** 我忘了提到我将该代码移出吸气剂，所以它只被提取一次。第一次实施时一定在睡觉。该代码现在可以正常工作，尽管在 XP 上...时不时地，但问题仍然出现的频率要低得多。

*** 更新 3 *** 为了清楚起见，我使用的是 SQL Compact 数据库，数据很少

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T21:42:04.463

让属性打开数据库连接并运行查询不是一个好的模式。

更好的方法是从 LINQ 查询一组对象到 SQL，然后将它们绑定到 WPF 控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T21:52:42.773

我同意 Damien，你为什么不异步执行 DB 调用？这样，用户界面保持响应，您可以在后台优雅地处理数据库错误，而用户不知道......

# c# - 在C#中计算字符串的显示宽度？

> ID：263614
> 
> 赞同：58
> 
> 时间：2008-11-04T21:56:14.467
> 
> 标签：c#, .net

刚刚回答了这个问题的 Java 版本，而且，我不知道如何在 .net 中执行此操作。

那么如何计算 C#/.net 中字符串的显示宽度呢？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-11-04T22:26:42.313

Windows 窗体的替代方法是静态 TextRenderer.MeasureText 方法。

尽管仅限于整数大小，但它（与 TextRenderer.DrawText 一起使用）比 Graphics.MeasureString/DrawString 二重奏呈现更准确和更高质量的 ClearType 文本。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2008-11-04T22:00:28.047

您在这个问题中遇到的问题与 Java 问题中存在的问题相同 - 信息不足！WinForms 和 WPF 之间会有所不同。

对于 WinForms：[Graphics.MeasureString](http://msdn.microsoft.com/en-us/library/6xe5hazb.aspx)

对于 WPF，我不确定，但我怀疑这将取决于您绘制文本的确切方式......

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-11-04T22:37:55.270

在 WPF 中，您将使用[FormattedText](http://msdn.microsoft.com/en-us/library/system.windows.media.formattedtext.aspx)。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-04T22:00:57.233

`Graphics.MeasureString`但它有点蹩脚，正如解释和改进的那样；[这里](http://www.codeproject.com/KB/GDI-plus/measurestring.aspx)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-04T22:01:27.357

您将使用 Graphics.MeasureString。

[http://msdn.microsoft.com/en-us/library/6xe5hazb.aspx](http://msdn.microsoft.com/en-us/library/6xe5hazb.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-01T07:44:10.667

Graphics.MeasureString([要测量的文本],[用于测量文本的字体]);

生成的对象将提供以下内容：

![可用属性](https://i.stack.imgur.com/1Y39l.png)

MeasureString 的其他重载也可用。

# build-process - 在同一 CruiseControl.Net 服务器上构建主干和分支的最佳方式

> ID：263616
> 
> 赞同：3
> 
> 时间：2008-11-04T21:56:37.197
> 
> 标签：build-process, cruisecontrol.net

我们目前有一个 CruiseControl.Net 服务器，它正在我们的 svn 服务器上愉快地构建主干。我也有建立“最新”分支的新要求；CruiseControl 中是否有处理此问题的最佳实践？同时从主干和分支构建需要哪些特定更改？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T22:03:26.760

制作第二个项目，就像源代码控制指向正确分支的原始项目一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T12:58:49.067

就 Cruisecontrol.net 而言，一个项目就是一个项目。它不在乎它是树枝还是树干。只需在 ccnet.config 中设置另一个指向分支所在位置的项目。

为了使事情井井有条，我喜欢将版本号添加到分支项目的名称中，如下所示：

ProjectX <- 主干
ProjectX-4.0 <- v4.0 的历史分支

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T17:20:06.830

我通常创建一个名为分支的新工作目录，设置源代码管理以监视分支并拉到新文件夹。我还在主干构建中放置了一个排除过滤器，因此它不会通过签入分支来启动（我们的分支通常位于检查更改的主干领域内）。我还记得更改标签，如果我们标注，以反映分支命名约定。您可以做的一件非常有用的事情是，如果您只有一个分支处于活动状态，只需在您完成所有配置后将其命名为分支您只需根据需要在配置文件中注释或取消注释这些部分，而不必在所有地方升级它，比如一次是分支 6.1，下一次是 6.2，

# python - Python 的“zip”内置的 Ruby 等价物是什么？

> ID：263623
> 
> 赞同：17
> 
> 时间：2008-11-04T21:58:29.017
> 
> 标签：python, ruby, translation

`zip`Python 的内置函数是否有任何 Ruby 等价物？如果不是，那么做同样事情的简洁方法是什么？

一点上下文：当我试图找到一种干净的方法来进行涉及两个数组的检查时，就会出现这种情况。如果我有`zip`，我可以写如下内容：

```
zip(a, b).all? {|pair| pair[0] === pair[1]} 
```

我也接受一种干净的方式来做到这一点，没有任何类似的东西`zip`（其中“干净”的意思是“没有明确的循环”）。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-04T22:05:46.520

Ruby 有一个 zip 函数：

```
[1,2].zip([3,4]) => [[1,3],[2,4]] 
```

所以你的代码示例实际上是：

```
a.zip(b).all? {|pair| pair[0] === pair[1]} 
```

或者更简洁地说：

```
a.zip(b).all? {|a,b| a === b } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T22:09:07.827

你不能这样做：

```
a.eql?(b) 
```

编辑添加一个例子：

```
a = %w[a b c]
b = %w[1 2 3]
c = ['a', 'b', 'c']

a.eql?(b) # => false
a.eql?(c) # => true
a.eql?(c.reverse) # => false 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-05T21:49:58.177

这是来自红宝石规范：

```
it "returns true if other has the same length and each pair of corresponding elements are eql" do
    a = [1, 2, 3, 4]
    b = [1, 2, 3, 4]
    a.should eql(b)
    [].should eql([])
end 
```

所以你应该它应该适用于你提到的例子。

如果您不使用整数，而是使用自定义对象，我*认为*您需要覆盖 eql?。

此方法的规范在这里：

[http://github.com/rubyspec/rubyspec/tree/master/1.8/core/array/eql_spec.rb](http://github.com/rubyspec/rubyspec/tree/master/1.8/core/array/eql_spec.rb)

# events - 搜索VB6代码

> ID：263639
> 
> 赞同：2
> 
> 时间：2008-11-04T22:01:02.490
> 
> 标签：events, vb6, asp-classic

我继承了一个 ASP/VB6 代码库（还不是我的强项），我正在尝试将其分开以找出运行应用程序时收到的错误消息的原因。

我已经通过在我的班级中提出的一个事件来追溯它。在 Windows 中是否有我可以搜索大部分代码库的消耗位置？Ctrl-F（并选择当前项目）还不够。

我心中的 linux 极客说把它转储到一个*插入发行版*盒中，然后 grep 就可以了。但是 IDE 中必须有某种方法可以做到这一点……对吧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T22:04:21.063

> 但是 IDE 中必须有某种方法可以做到这一点……对吧？

不会。IDE 有一些插件，例如[MZ Tools](http://www.mztools.com/)可能*会*有所帮助。否则，只需`find`从 Windows 命令行使用该工具。`grep`当然，不如使用舒适。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T22:13:15.930

如果您安装了任何新版本的 VS (2003,5,8)，只需使用“在文件中查找”功能并将其指向 VB6 文件夹即可。

除此之外，大多数“记事本”替代品（textpad、notepad+）也提供“在文件中查找”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T14:06:37.077

查看[http://www.mztools.com/index.aspx](http://www.mztools.com/index.aspx) MZ-Tools 3.0 是 Visual Basic 6.0、Visual Basic 5.0 和 Visual Basic For Applications 编辑器的免费插件。

对于仍在使用 VB 6.0 的任何人来说，这都是必不可少的

它具有增强的查找功能以及类似于 .net Find 用法的调用过程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T22:06:43.010

我在 VB6 中有一个大型遗留代码库，需要不时进行维护，我在本地副本上使用 Microsoft 桌面搜索来帮助在代码文件中查找变量和方法名称。

[Grep](http://www.interlog.com/~tcharron/grep.html)也可用于 Windows。

# performance - 在匿名网站上启用“Windows”身份验证时是否会影响性能？

> ID：263640
> 
> 赞同：0
> 
> 时间：2008-11-04T22:01:26.903
> 
> 标签：performance, asp.net-2.0, iis-5

在 Windows 2000 上运行的高流量 ASP.NET 2.0 站点一直存在性能问题。在编辑 web.config 文件时，我注意到身份验证模式设置为“Windows”。我将其更改为“无”。该站点唯一的用户是匿名用户，每天的页面浏览量超过 25,000 次。这可能是导致性能问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-05T00:36:30.243

潜力很小，但如果您没有保护任何文件夹，那应该不是问题。

实际上，如果您需要保护文件夹路径，这主要是个问题。

可能会有一个小的性能影响，但我无法想象它会那么糟糕。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T18:10:08.007

这是非常不可能的。Windows 身份验证在 IIS 中执行，然后将令牌发送到 ASP.NET，因此，如果您使用匿名身份验证，那么它实际上是即时的，因为此令牌将在创建安全上下文时创建，并且会的。

“无”身份验证旨在用于自定义身份验证，而不是用于匿名身份验证 - 匿名是 Windows 身份验证选择之一（即 IIS 身份验证）。

也许您应该在应用程序上设置跟踪并获取记录事件周期的方法，以查看它慢的地方。这可能是一个运行缓慢的查询、超时问题、磁盘空间/交换空间不足等。

查看： http: [//msdn.microsoft.com/en-us/library/aa291347](http://msdn.microsoft.com/en-us/library/aa291347(VS.71).aspx) (VS.71).aspx ，了解有关身份验证方法的更多详细信息。

# xslt - 从代码隐藏访问 xslt 元素

> ID：263644
> 
> 赞同：1
> 
> 时间：2008-11-04T22:01:43.457
> 
> 标签：xslt, code-behind

如何为 xslt 中声明的元素设置值（在代码后面）？这是我的 xslt

```
 <xsl:for-each select="Header/Item">
      <td class="rowHead" style="vertical-align:bottom;">
        <a href="#">
          <xsl:attribute name="id">
            <xsl:text>aColumnText</xsl:text>
            <xsl:value-of select="@count"/>
          </xsl:attribute>
          <xsl:attribute name="onclick">
            <xsl:text>showPopWin('UploadFile_Step4_Modal.aspx?ColumnNumber=</xsl:text>
            <xsl:value-of select="@count"/>
            <xsl:text>',500,500,returnParameters);</xsl:text>
          </xsl:attribute>
          <xsl:value-of select="." />
        </a>
        <input type="text" name="hiddenColumnValue">
          <xsl:attribute name="id">
            <xsl:text>hiddenColumnValue</xsl:text>
            <xsl:value-of select="@count"/>
          </xsl:attribute>
        </input>
        <input type="text" name="hiddenColumnNumber">
          <xsl:attribute name="id">
            <xsl:text>hiddenColumnNumber</xsl:text>
            <xsl:value-of select="@count"/>
          </xsl:attribute>
          <xsl:attribute name="value">
            <xsl:value-of select="@count"/>
          </xsl:attribute>
        </input>
      </td>
    </xsl:for-each> 
```

现在我必须在代码隐藏中设置 hiddenColumnValue 的值，该怎么做？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-04T22:06:23.120

[使用 xslt 创建 asp.net 标记](http://www.muonlab.com/web-development/create-aspnet-markup-from-xml-and-xslt/)

# sql-server-2005 - 如何使用 GUI 在 SQL Server 2000 或 2005 中编辑文本字段（或 ntext）？

> ID：263647
> 
> 赞同：6
> 
> 时间：2008-11-04T22:04:01.017
> 
> 标签：sql-server-2005

1.  有没有办法用 SQL Server 工具做到这一点？
2.  如果没有，是否有第三方工具可以做到这一点？

在 SQL Server 2000 或 2005 的 SQL Server 管理器中编辑较长的文本列似乎没有一个好方法。虽然 SQL Server 管理器实际上不是用于编辑数据库中的数据，但 Microsoft 提供的其他工具通常会允许你这样做吗？除长文本字段外，其他所有字段都非常容易编辑。在 Access 中，您可以按 shift-f2，它会弹出一个漂亮的对话框来编辑您的文本。

[替代文字 http://techinterview.org/edit.png](http://techinterview.org/edit.png)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-04T23:01:20.637

通常，SQL Management Studio 是一个数据库管理工具，除了在这里或那里进行快速编辑之外，不用于数据输入。通常，您将编写数据脚本，或者由使用数据库进行持久性的应用程序输入数据。

（尽管我已将 Access 指向我的 SQL Server DB 以获得更好的快速和肮脏的 UI。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T20:32:31.427

这可能会打你的账单 - [SQL LOB 编辑器](http://www.withdata.com/sqllobeditor.html)。

您可能想要查看的另一个选项是[EMS SQL Studio for SQL Server](http://www.sqlmanager.net/en/products/studio/mssql)。

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T06:57:47.980

如果您特别关注一个漂亮的大型多行编辑对话框，那么是的，您肯定需要查看 Microsoft SSMS 工具系列之外的内容。他们不支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-19T23:33:20.303

这只是愚蠢的。SQL Server 2000 的企业管理器可以很好地处理多行文本。只是愚蠢地向后退并松散预先存在的功能。不像复制格式化文本是火箭科学。有人真的把球丢在了这个上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-06T23:19:15.263

在管理控制台中，是否可以执行“打开表”上下文菜单操作，然后从那里编辑数据？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-25T14:06:28.903

我完全推荐[DBVisualizer](http://dbvis.com/)。它的好处是，它支持一长串数据库和通用的所有 JDBC 驱动程序（因为它是用 Java 编写的）。您可以浏览各种数据库、更改数据并在漂亮的图表中探索模式。它以 149 美元的价格提供免费和个人版，非常值得！查看[此矩阵](http://dbvis.com/products/dbvis/features/features.jsp?page=matrix)进行比较。

您将能够在 SQL Server 2000、2005 和即将推出的版本中编辑 text 和 ntext。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-25T15:15:20.640

如果我只需要偶尔进行编辑，我可能会使用 SQL 查询分析器并只编写 UPDATE 命令的脚本。

如果这太不方便了，我接下来会看看在 Access 中链接到数据库，为了真正快速和肮脏的易用性，我将只使用 AutoForm 为表生成 UI。如果您没有 Access，我相信 OpenOffice Base 可以通过 ODBC 连接并具有类似的表单构建功能。

# c++ - 绘制大量数据

> ID：263676
> 
> 赞同：2
> 
> 时间：2008-11-04T22:12:26.680
> 
> 标签：c++, visual-studio-2008, plot, large-data-volumes

在我从事的产品中，有一个迭代循环，可以有几百到几百万次迭代。每次迭代计算一组统计变量（双精度），变量个数最多可达 1000 个（一般为 15-50 个）。

作为循环的一部分，我们绘制了变量在迭代中的变化，因此 X 轴是迭代，而 y 轴是变量（按颜色编码）：

[http://sawtoothsoftware.com/download/temp/walt/graph.jpg](http://sawtoothsoftware.com/download/temp/walt/graph.jpg)

目前，数据存储在一个文件中，其中包含：
用于变量
的 4 字节整数，用于迭代的 4 字节整数，
以及用于值的 8 字节双精度。

y 轴的总比例随时间变化，并且希望图形调整大小以适应当前比例（这可以在图片中看到）。

以大约 5 秒的间隔，读取数据并将其绘制在位图上，然后将其显示给用户。我们尝试做一些优化来避免重新绘制整个东西，但是如果迭代次数或变量数量变大，我们最终会得到一个需要超过 5 秒才能绘制的巨大文件。

如果可能的话，我正在寻找有关如何更有效、更快速地处理这么多数据的想法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T14:09:07.340

在 SQL 术语中，您应该对结果进行分组和聚合。如果不滚动屏幕，您不可能在图表上显示所有 10,000 个数据点。一种方法是您可以按时间尺度（秒、分钟等）分组并查询`AVG()`、`MAX()`或`MIN()`将数据点减少到更小的尺度。

MySQL 示例，按秒分组：

```
select time_collected, AVG(value)
from Table
group by UNIX_TIMESTAMP(time_collected) 
```

还可以考虑结合汇总值并在[烛台图](http://en.wikipedia.org/wiki/Candlestick_chart)中进行可视化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T22:43:06.057

您应该问自己，为每次迭代显示数据有多大价值，以及用户真正关心的这些数据是什么。我认为您在这里需要做的主要事情就是减少您向用户显示的数据量。

例如，如果用户只关心趋势，那么您可以很容易地摆脱每次迭代（而不是每次迭代）评估这些函数。在上图中，您可以通过每 100 次迭代仅绘制曲线上的值来获得同样信息丰富的绘图，这会将数据集的大小（以及绘图算法的速度）减少 100 倍。显然，如果您碰巧需要更多细节，您可以调整它。

为避免在重绘时重新计算数据点，只需保留已在内存中绘制的一小部分点，而不是重新计算或重新加载所有数据。您可以避免以这种方式进入磁盘，并且您不会做太多的工作来重新渲染所有这些点。

如果您担心由于采样错误而丢失异常值等问题，您可以做的一件简单的事情是根据滑动窗口而不是原始数据中的单个样本来计算样本点集。您可能会保留最大值、最小值、平均值、中值，并可能计算您向用户显示的数据的误差线。

如果你需要变得非常激进，人们已经想出了很多花哨的方法来减少和显示时间序列数据。有关更多信息，您可以查看[wikipedia 文章](http://en.wikipedia.org/wiki/Time_series)，或查看[R](http://www.r-project.org/)之类的工具包，其中已经内置了很多这些方法。

最后，[这个 stackoverflow 问题](https://stackoverflow.com/questions/219872/graph-rendering-using-3d-acceleration#219925)似乎也很相关。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T14:02:18.513

我从图表中看到，您在几百个像素上绘制了 10,000 次迭代，因此只需为图表使用 100 个信息点中的一个，而忽略其余部分。它对用户来说看起来是一样的

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-08T06:00:13.563

为什么不生成位图（或 XPM 之类的像素图）？每列（或行）对应于迭代，相同颜色的高度（行的宽度）对应于变量值。XPM 格式更简单，因为它是文本的（像素一个字符）和跨平台。

# python - 从 python 启动 VS2008 构建

> ID：263690
> 
> 赞同：1
> 
> 时间：2008-11-04T22:19:59.287
> 
> 标签：python, windows, visual-studio-2008, build-automation

如果我手动将其粘贴到命令提示符中，它可以工作，但如果我从 python 运行它，我会得到`The filename, directgory name, or volume label syntax is incorrect`.

```
os.system('%comspec% /k ""C:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat"" x86')
os.system('devenv Immersica.sln /rebuild Debug /Out last-build.txt') 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T22:27:03.733

我认为反斜杠把你弄乱了。您需要使用 R 字符串（原始）

r“字符串”

请参阅[https://docs.python.org/2/reference/lexical_analysis.html#string-literals](https://docs.python.org/2/reference/lexical_analysis.html#string-literals)以供参考

# git - 在 Mac OS X 10.5 上维护更新的 Git 二进制文件（Git by Git）的最佳实践？

> ID：263695
> 
> 赞同：5
> 
> 时间：2008-11-04T22:21:31.013
> 
> 标签：git, macos

在我的 Mac OS X 10.5 (Leopard) 机器上，我使用来自 Google Code的[git-OSX-Installer安装了 Git 1.6.0.2。](http://code.google.com/p/git-osx-installer/)安装程序将 Git 安装到 /usr/local/Git。

我现在想跟上最新的稳定 Git 版本（主分支），目前是 1.6.0.3。

我可以从 /usr/local/Git 目录中运行“git clone git://git.kernel.org/pub/scm/git/git.git”，然后使用 XCode 进行配置/制作/安装，还是不行工作？

基本上，我正在寻找将 Git 更新到最新稳定版本的最佳实践。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-04T22:33:43.173

脚本[x-git-update-to-latest-version](http://www.simplicidade.org/notes/archives/2008/09/updated_xgitupd.html) 将编译和安装最新版本的 git（来自 git 存储库）。

它设置为使用 master 分支的当前版本，但在稳定分支`HEAD`中添加一两行应该很容易。`git checkout`

它将 git 安装到`/usr/local/git-v1.6.0.2-287-g3791f77/`（例如），然后将 /usr/local/git/ 符号链接到最新目录。

您可以将其设置为定期运行（每晚？），或者通过 cron（这非常简单，但在 OS X 10.5.x 上存在一些烦人的问题），或者稍微复杂的 launchd（[Lingon](http://tuppis.com/lingon/)是一个很好的接口，尽管在不登录/注销的情况下开始运行作业，您必须运行命令`launchctrl load ~/Library/LaunchAgents/mylaunchagent.plist`）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-04T22:23:48.060

[我使用MacPorts](http://macports.org)在我的 Mac 上让 Git 保持最新。我发现 MacPorts 中还有很多其他我需要的东西，所以这对我很有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T00:20:51.383

我使用以下方法提取 git 源：

```
git clone git://git2.kernel.org/pub/scm/git/git.git 
```

并定期做

```
cd ~/git.git
git pull
make
make test
sudo make install 
```

这样我就可以保持最新状态，并且我正在使用 git 来获取 git，这感觉是正确的做法。我还没有添加一个 cron 条目来自动执行此操作。

（第一次这样做，当然是手动下载了 git 源码并编译安装，以解决明显的先有鸡还是先有蛋的问题。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-08T01:14:42.413

我从源代码编译 git 没有问题，据我所知不需要端口，所以只需以通常的方式更新您的版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T19:02:44.457

我下载了源代码并有一个小脚本来构建和更新：

```
sudo git clean -dxf
git pull
make prefix=/usr/local/git all
sudo make prefix=/usr/local/git install 
```

这会在将前缀设置为我的构建位置（/usr/local/git）之前清理文件

# php - PHP - 编辑多个数组值（如果它们存在）

> ID：263697
> 
> 赞同：1
> 
> 时间：2008-11-04T22:22:31.043
> 
> 标签：php, arrays

我有一个多维数组。我需要在其中搜索特定范围的值，编辑这些值并返回编辑后的数据。

示例数组：

```
array(3) {
  ["first"]=>
  array(1) {
    [0]=>
    string(4) "baz1"
  }
  ["second"]=>
  array(1) {
    [0]=>
    string(4) "foo1"
  }
  ["third"]=>
  array(1) {
    [0]=>
    string(4) "foo2"
  } 
```

现在我想找到任何与 foo 匹配的值（示例数组中的 foo1 和 foo2），将“-bar”插入它们（foo-bar1，foo-bar2）并返回该值。解决这个问题的最佳方法是什么？

*编辑*我应该提到 foo 实际上可以是anythingfoo（例如examplefoo1、somethingelsefoo2、blahblahfoo3）。我认为这排除了str_replace。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T22:32:36.843

如果您的阵列不会非常深，这可以工作。（$array 是您以后要替换的内容）

```
$array= array('first' => array('bazi1'), 'second' => array('foo1'), 'third' => array('foo2') );
function modify_foo(&$item, $key)
{
   $item = str_replace('foo', 'foo-bar', $item);
}
array_walk_recursive( $array, 'modify_foo' ); 
```

如果您希望 foo 即使在 somethingelsefoo2 中也被替换，那么 str_replace 就可以了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-04T22:27:03.327

像这样的东西怎么样：

```
function addDashBar($arr)
{
    foreach ($arr as $key => $value)
    {
       if (is_array($value))
           $arr[$key] = addDashBar($value)
       else
       {
           $arr[$key] = str_replace($value, "foo", "foo-bar");
       }
    }

    return $arr;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T12:07:22.470

```
 function test_replace1(&$input, $search, $replace) {
    $result = array();
    $numReplacements = 0;
    foreach ($input as &$value) {
        if (is_array($value)) {
            $result = array_merge($result, test_replace1($value, $search, $replace));
        } else {
            $value = str_replace($search, $replace, $value, $numReplacements);
            if ($numReplacements) {
                $result[] = $value;
            }
        }
    }
    return $result;
 }

 $changed_values = test_replace1($arr, 'foo', 'foo-bar'); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-06T04:00:54.587

如果你有一个一维数组，你应该可以使用 array_map();

** 编辑：我在这里有一些代码，但经过测试，它不起作用。

关于您的编辑。仅仅因为 Foo 位于字符串的末尾，并不意味着 str_replace 将不再起作用。

```
echo str_replace("foo","foo-bar","mycrazystringwithfoorightinthemiddleofit"); 
```

仍将返回

```
mycrazystringwithfoo-barrightinthemiddleofit 
```

如果您的数组是任意深度的树结构，那么您将不可避免地不得不使用递归并且问题变得不简单。您可能想查看

array_recursive_walk() 函数。 [在这里](http://us.php.net/manual/en/function.array-walk-recursive.php) 希望这会有所帮助。

# visual-studio - 添加要使用 Window 应用程序发布的 Excel 文件

> ID：263699
> 
> 赞同：2
> 
> 时间：2008-11-04T22:22:58.983
> 
> 标签：visual-studio, winforms

我已经尝试了一个小时左右，但无法做到这一点。我有一个读取 Excel 文件的 Visual Studio 项目，该文件已添加到 VS 解决方案中。当我在VS中运行项目时，文件可以成功打开。但是，当我发布项目时，该文件没有被包含在内，因此无法被应用程序打开。

我认为必须有办法让 Visual Studio 将该 excel 文件包含到部署中，但是我找不到该选项。

我现在是 Windows 应用程序开发，很抱歉这个琐碎的问题！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T22:31:36.907

您必须告诉 Visual Studio Excel 文件应该包含在发行版中。在“属性”窗口中通过将“构建操作”更改为内容来执行此操作。

或者，您可以在项目的发布设置中执行此操作，方法是右键单击项目，选择属性 > 发布 > 应用程序文件。将发布状态设置为包括（自动）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T22:31:23.397

我可以想到两种可能的方法来做到这一点：

1\. 确保文件的 CopyToOutput 目录属性设置为 Copy Always 或 Copy if Newer。

- 或者 -

2\. 创建一个后期构建步骤，将文件手动复制到您想要的任何位置。

# .net - 使用 WebDAV 访问 Exchange 2003 收件箱

> ID：263724
> 
> 赞同：5
> 
> 时间：2008-11-04T22:30:51.963
> 
> 标签：.net, exchange-server, webdav

您如何*（使用 .NET）*使用 WebDAV 获取用户收件箱（不是您自己的收件箱）中的电子邮件列表，然后获取每封电子邮件的属性和/或内容？

如果可能的话，我想在没有[WebDAV.NET](http://www.independentsoft.de/webdavex/index.html)的情况下这样做。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T22:47:41.473

看看我关于 webdav 的这篇文章。希望它能给你一些指导： [http ://weblogs.sqlteam.com/mladenp/articles/9560.aspx](http://weblogs.sqlteam.com/mladenp/articles/9560.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T01:09:45.650

我正在考虑做同样的事情，我遇到的最佳解决方案是 Henning Krause 的文章“[通过 WebDAV 访问 Exchange 存储并启用基于表单的身份验证](http://www.infini-tec.de/post/2004/12/Access-the-Exchange-store-via-WebDAV-with-Form-Based-Authentication-turned-on-Updated.aspx)”

我正要试试这个，我会让你知道它是怎么回事，如果你先完成它，我也会回来查看；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-27T17:22:00.650

I know this is an old post but I wanted to post a link to this answer in case any other users come across this question. This really helped me out using .NET and WebDAV:

[Read MS Exchange email in C#](https://stackoverflow.com/questions/652549/read-ms-exchange-email-in-c#answer-652729)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T22:45:16.143

我同意埃里克的观点。我们也开始研究没有 Independentsoft 的 Exchange/WebDAV。你可以找到几乎所有你需要的文档，但 IMO 只是不值得 - 太复杂了。如果这是出于商业目的，那么毫无疑问哪个更具成本效益。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T12:18:36.330

我知道您说过您不想使用 Independentsoft 库，但我们一直在使用它，这使得这几乎是微不足道的。所以我的建议是使用它。他们的支持也很好。

# eclipse - 在预期路径中找不到片段（eclipse jsp）

> ID：263730
> 
> 赞同：2
> 
> 时间：2008-11-04T22:33:06.013
> 
> 标签：eclipse, tagfile, validationerror

在 Eclipse 中，我有一个 javaproject（不是 web 项目），尽管它确实提供了可重用的标记文件。

布局

+src
+++META-INF
----my.tld
+++++++++++标签
---------------include.jsp

我不断收到 Fragment "/META-INF/tags/include.jsp" was not be found at expected path /Project/META-INF/tags/taginclude.jsp

如何修改 eclipse 正在寻找的路径？我需要告诉它在查找中包含“src”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T23:57:25.767

Josh，如果您正在使用 .jsp 和 .tld 文件，那么您真的不应该将其作为“Java 项目”来执行，而应该将其作为 Eclipse 中的“动态 Web 项目”。尽管如此，我会尽力回答你的问题。

根据您的文件系统图，您的文件布局不正确。如果您尝试创建一个 Web 应用程序（一个 .war 文件），那么您需要一个 WEB-INF 目录。在 WEB-INF 目录下，您需要一个 web.xml 文件（google for web.xml 以查看其中需要什么）、一个标签目录以及一个类和 lib 目录。

编译的类文件必须放在 WEB-INF/classes 目录下。您依赖的 Jar 文件必须放在 WEB-INF/lib 目录中。Tablibs 必须放在 WEB-INF/tags 目录中。最后，您的 .jsp 文件必须进入 src 目录（WEB-INF 的父目录）。

因此，您的布局应如下所示：

```
我的项目/
`--src
    |-- 网络信息
    | |-- 班级
    | | `-- MyClass.class
    | |-- 库
    | | `--我的.jar
    | |-- 标签
    | | `--我的.tld
    | `-- web.xml
    `-- 包括.jsp

```

希望这可以帮助。

-布莱恩

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-05T08:29:55.840

恐怕我不理解原始帖子中的 ascii 表示，但验证器可以利用任何具有 ModuleCore Nature 及其 .settings/org.eclipse.wst.common.component 文件的项目来找出“ /“ 方法。创建一个动态 Web 项目并检查该文件和 .project 可能会帮助您拼凑正确的内容以使其在您的 Java 项目中工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-05T09:35:40.763

可能是jsp页面的路径不对！可以ctrl+左键查看，如果打不开jsp文件建议查看路径。

# c# - 在 C# 中检测 SqlServr.exe WriteFile 操作

> ID：263734
> 
> 赞同：1
> 
> 时间：2008-11-04T22:34:38.070
> 
> 标签：c#, .net, winapi

当数据库更新时，我们需要支持在本地 SQL Server 数据库中查询新数据。由于这些是外部 SQL Server 数据库，我们可能无法使用 SQL Server Notification Services，也无法对数据库进行任何更改。

我的基本想法是观察写入数据库的数据以触发查询（而不是按设定的时间间隔轮询）。但是，我很难弄清楚如何从 SqlServr.exe 进程中获取 WriteFile 调用（可以在 Sysinternals 的进程监视器等工具中进行监视）。谁能指导我哪些 Win32 功能可以帮助我解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T02:02:01.427

您可能无法拦截 SQL Server 进程正在进行的 FileWrite() 调用 - 如果有，那将是一个巨大的安全漏洞。

幸运的是，您不需要这样做，因为文件系统可以为您提供所需的内容。

System.IO.FileSystemWatcher[类](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)允许您监视文件或目录的活动，并在发生更改时触发事件。您应该能够快速启动并运行原型，以（反）证明您的方法的可行性。

**但是**，我认为您会发现这种方法不如简单的轮询有效——因为我怀疑您最终会相当频繁地触发您自己的更新过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T09:41:41.577

As other answers mentioned, there is also some internal housekeeping that SQL performs, that might trigger your WriteFile or other low-level monitoring process.

Is it possible to write a wrapper database, that you connect to, store all changes, or timestamp of latest change. And sends them to the real storage. I think you could do something like this with views. Performance will not be optimal.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T00:46:22.733

我不认为通过文件系统是最好的选择。即使您可以访问文件系统活动，我认为也很难区分哪些文件操作添加了数据与任何其他类型的文件活动（如维护、索引碎片整理等）。

一种可能的替代方法是将[Microsoft.SqlServer.Management.Trace 命名空间](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.trace.aspx)作为一种机制来挂钩 SQL Server 并查找您想要响应的特定事件。但是，我会注意这可能导致的性能影响。

# c++ - 如何确定 CRichEditCtrl 中的文本选择是否具有多种字体大小？

> ID：263735
> 
> 赞同：1
> 
> 时间：2008-11-04T22:34:38.350
> 
> 标签：c++, mfc

问题：如何判断 CRichEditCtrl 中的文本选择是否有多种字体大小？

* * *

目标：我正在制作自己的 RichEdit 工具栏（粗体、斜体、字体类型、字体大小等）。我想模拟 MS Word 在选择的文本具有多个跨越选择的单一字体大小时所做的事情。

例如 - 您有一行文本，前 10 个字符为 9 pt 字体，接下来的 15 个字符为 14 pt 字体。如果突出显示前 5 个字符，“字体点选择”下拉菜单将显示“9”。如果您随后选择前 20 个字符，则相同的下拉菜单应显示为空/空白。

* * *

到目前为止我所做的：当 CRichEditCtrl 内部的选择发生变化时，我会收到必要的通知。此外，如果选择中只有一个字体大小，我能够弄清楚

```
CHARFORMAT cf;
cf.cbSize = sizeof(CHARFORMAT);
CRichEditCtrl ctrl;
ctrl.GetSelectionCharFormat( cf );
int nFontPtSize = cf.yHeight / 20; 
```

这将为我上面示例的第一种情况提供所需的信息。不幸的是，我在示例的第二部分中似乎得到的信息只给了我选择结束位置的信息（而不是整个选择）。

总之，在 CHARFORMAT 或我可以从 CRichEditCtrl 获得的其他一些结构中是否缺少一些信息，或者我可以做一些有趣的计算来决定选择中有多种尺寸？到目前为止，我唯一的想法是一次选择一个字符，看看该字符的当前字体大小是否与之前的任何字符不同。我主要只是希望我需要的信息在那里，我只是看不到它（以类似的方式从 CHARFORMAT 的 dwMask 成员告诉我，任何或所有粗体、斜体、下划线等都已打开）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T15:08:36.097

正如上面的答案所指出的，我能想到的最简单的方法是使用文本对象模型 (TOM)，它是通过 ITextDocument COM 接口访问的。要从您的丰富编辑控件中获取此信息（注意代码未经测试，但应该可以工作）：

```
CComPtr<IRichEditOle> richOle;
richOle.Attach(edit.GetIRichEditOle());
CComQIPtr<ITextDocument> textDoc(richOle); 
```

然后得到一个范围。这里是针对选定的文本，但 TOM 的优点之一是您可以对任何范围进行操作，而不仅仅是选定的内容。

```
CComPtr<ITextSelection> range;
textDoc->GetSelection(&range); 
```

然后获取该范围的字体，并查看其特征是什么，例如

```
CComPtr<ITextFont> font;
range->GetFont(&font);
long size;
font->GetSize(&size); 
```

如果范围是使用单一字体大小格式化的，您将恢复为“大小”。如果有多种字体大小，您将获得值“tomUndefined”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T14:15:55.130

一直在杂耍几件事，但我终于能够工作了。这就是我最终能够编译和运行所有内容的方式：

```
HWND hwnd;
ITextDocument* pDoc;
IUnknown* pUnk = NULL;
float size = 0;
hwnd = GetSafeHwnd();
::SendMessage( hwnd, EM_GETOLEINTERFACE, 0, (LPARAM)&pUnk );
   if ( pUnk && pUnk->QueryInterface( __uuidof(ITextDocument), (void**)&pDoc ) == NOERROR )
   {
      CComPtr<ITextSelection> range;
      pDoc->GetSelection( &range );
      CComPtr<ITextFont> font;
      range->GetFont( &font );     
      // If there are multiple font sizes in the selection, "size" comes back as -9999 
      font->GetSize(&size);
   }
return size; 
```

# firefox - 使用 AppleScript 从 Web 浏览器最前面的窗口中获取 URL：权威列表

> ID：263741
> 
> 赞同：15
> 
> 时间：2008-11-04T22:36:17.567
> 
> 标签：firefox, safari, applescript, flock, camino

我构建了一个**[widget][1]**，它从 Safari 最前面的窗口中获取 URL，然后允许您使用 tr.im API 缩短它。像一样甜。

我想让这更灵活，所以正在研究如何从其他浏览器获取 URL。这是适用于 Safari 的 AppleScript：

```
tell application "Safari"
    return URL of front document as string
end tell 
```

经过[一番挖掘](https://web.archive.org/web/20141112082406/http://hintsforums.macworld.com/showthread.php?t=32237)，我确定以下内容*可能*适用于 Firefox（尽管有人告诉我这对他不起作用，可能与某些扩展发生冲突？）：

```
tell application "Firefox"
    set myFirefox to properties of front window as list
    return item 3 of myFirefox
end tell 
```

*注意：以上是一个不太理想的实践示例，依赖于列表项的位置。有关 Firefox 的更好解决方案，请参见下文。*

我想做的是在这里为 Mac 上的每个现代浏览器建立一个明确的等价物列表：Opera、Camino、Flock 等。

**更新：**在我对该主题的研究中，我在[MacOSXHints.com](http://www.macosxhints.com/article.php?story=20060325015454467)上遇到了一个有用的帖子。我下面的大部分答案都是基于该讨论。

**更新 2：**我已将此页面上的 AppleScript 合并到 [widget][1] 中。它似乎工作得很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-03-07T06:01:53.147

Google Chrome for Mac 添加了用于获取 URL 的 AppleScripting 方法。

## 这是 Chromium AppleScript SDK

[https://sites.google.com/a/chromium.org/dev/developers/design-documents/applescript](https://sites.google.com/a/chromium.org/dev/developers/design-documents/applescript)

## 下面链接的页面示例：

```
 tell application "Google Chrome"
     get URL of active tab of window 1
   end tell 
```

## 这里有更多例子：

[http://laclfyoshi.blogspot.com/2010/10/google-chrome-ver.html](http://laclefyoshi.blogspot.com/2010/10/google-chrome-ver.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-21T04:38:47.970

激活 UI 脚本并运行以下代码。然后，您将在剪贴板中拥有该 URL，您可以将其粘贴。

```
tell application "Firefox" to activate
tell application "System Events"
    keystroke "l" using command down
    keystroke "c" using command down
end tell 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T16:19:14.170

这又是 Piero 带着新 id 回来了（我在尝试重新安装 Firefox 时丢失了我的 cookie ！！！）。

我刚刚尝试了 Firefox 3.04，关于 appleScript 的支持和可靠性没有任何改变。还是一样的bug...

我在网络上进行的测试和搜索得出的结论是，您无法在同一脚本中访问窗口的名称和窗口的其他属性，例如 «class curl»。

如果您正在使用窗口的名称，并且突然无法再访问它（获取随机二进制字符串），则必须再次调用此代码：

```
tell application "Firefox" to activate 
```

使用任何会在 Firefox 中产生错误的语句也可以正常工作，以使窗口名称再次可用，但重新启动 Mac 不会改变任何东西！

一旦你这样做了，正如我之前提到的，你不能再访问 «class curl»，直到下一次 Firefox 重新启动......

在 Mac 上为 Firefox 编写脚本真的是不可能的任务！

如果您希望 Firefox 支持 AppleScript，请告诉它，并为这个错误投票！！！

[https://bugzilla.mozilla.org/show_bug.cgi?id=464701](https://bugzilla.mozilla.org/show_bug.cgi?id=464701)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T10:12:48.457

当前 Firefox 3.03 中存在一个错误，如果您之前使用过如下语句，它将从 AppleScript 隐藏所有窗口属性，包括 «class curl»：

```
tell application "Firefox" to activate 
```

或者

```
tell application "Firefox"
 if (front window) exists then do_something()
end tell 
```

解决方法是改用以下代码：

```
tell application "System Events"
 tell process "Firefox"
  set frontmost to true
  set xsist to (front window) exists
  (* keep xsist value to test later on *)
 end tell
end tell 
```

**注意：**在下次重新启动 Firefox 之前，该窗口的属性将保持不可用

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-06T10:15:53.893

Firefox（在 2.0.0.14 和 3.0.1 版本上测试）：

```
tell application "Firefox"
    set myURL to «class curl» of window 1
    return myURL
end tell 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T00:53:02.450

卡米诺 1.6 及以上：

```
tell application "Camino"
    return URL of current tab of front browser window as text
end tell 
```

与之前的答案不同，这将获得焦点选项卡的 URL。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-04T18:18:23.973

感谢上面的 Brian，这是防弹版本。

他的代码要求您粘贴 URL，但此代码将 URL 设置为“FrontDocumentURL”，然后您可以将其用作脚本中的变量。

```
tell application "Firefox" to activate

tell application "System Events"
keystroke "l" using command down
keystroke "c" using command down
end tell

set FrontDocumentURL to the clipboard 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-06T10:46:46.033

OmniWeb（在 5.8 版上测试）：

```
tell application "OmniWeb"
    set myInfo to GetWindowInfo
    return item 1 of myInfo
end tell 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-06T10:13:29.610

Opera（在 9.21 和 9.62 版本上测试）：

```
tell application "Opera"
    return URL of front document as string
end tell 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-06T10:21:00.967

卡米诺（在 1.6.4 版本上测试）：

```
tell application "Camino"
    set p to properties of front tab of front window
    return |currentURI| of p as string
end tell 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-06T10:26:00.287

Flock（在 2.0 版上测试）：

```
tell application "Flock"
    set p to properties of front window as list
    return item 3 of p
end tell 
```

这取决于列表项的位置，但据我所知，这是获得该值的唯一方法。该属性的名称`address`虽然 Apple 的文档没有说明，但它似乎是 AppleScript 中的保留字。

# javascript - 如何从一开始就以字符形式获取文本区域中的插入符号列（不是像素）位置？

> ID：263743
> 
> 赞同：175
> 
> 时间：2008-11-04T22:36:52.293
> 
> 标签：javascript, textarea, caret

您如何在`<textarea>`使用 JavaScript 时获得插入符号的位置？

例如：`This is| a text`

这应该返回`7`。

你如何让它返回光标/选择周围的字符串？

例如：`'This is', '', ' a text'`。

如果单词“is”被突出显示，那么它将返回`'This ', 'is', ' a text'`。

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2008-11-04T22:58:19.130

使用 Firefox、Safari（和其他基于 Gecko 的浏览器），您可以轻松使用 textarea.selectionStart，但对于 IE 不起作用，因此您必须执行以下操作：

```
function getCaret(node) {
  if (node.selectionStart) {
    return node.selectionStart;
  } else if (!document.selection) {
    return 0;
  }

  var c = "\001",
      sel = document.selection.createRange(),
      dul = sel.duplicate(),
      len = 0;

  dul.moveToElementText(node);
  sel.text = c;
  len = dul.text.indexOf(c);
  sel.moveStart('character',-1);
  sel.text = "";
  return len;
} 
```

（[完整代码在这里](http://web.archive.org/web/20080214051356/http://www.csie.ntu.edu.tw/~b88039/html/jslib/caret.html)）

我还建议您检查 jQuery [FieldSelection](https://github.com/localhost/jquery-fieldselection)插件，它允许您执行此操作以及更多...

**编辑：**我实际上重新实现了上面的代码：

```
function getCaret(el) { 
  if (el.selectionStart) { 
    return el.selectionStart; 
  } else if (document.selection) { 
    el.focus(); 

    var r = document.selection.createRange(); 
    if (r == null) { 
      return 0; 
    } 

    var re = el.createTextRange(), 
        rc = re.duplicate(); 
    re.moveToBookmark(r.getBookmark()); 
    rc.setEndPoint('EndToStart', re); 

    return rc.text.length; 
  }  
  return 0; 
} 
```

[在此处](http://jsbin.com/iwopa)查看示例。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2010-07-30T15:38:49.967

**2010 年 9 月 5 日更新**

看到每个人似乎都被引导到这里来解决这个问题，我将我的答案添加到一个类似的问题中，该问题包含与此答案相同的代码，但对于感兴趣的人来说具有完整的背景：

[IE 的 document.selection.createRange 不包括前导或尾随空行](https://stackoverflow.com/questions/3622818/ies-document-selection-createrange-doesnt-include-leading-or-trailing-blank-li)

在 IE 中考虑尾随换行符是很棘手的，而且我还没有看到任何正确执行此操作的解决方案，包括此问题的任何其他答案。但是，可以使用以下函数，它将在 a`<textarea>`或 text中返回选择的开始和结束（在插入符号的情况下是相同的） `<input>`。

请注意，textarea 必须具有焦点，此功能才能在 IE 中正常工作。如果有疑问，请先调用 textarea 的`focus()`方法。

```
function getInputSelection(el) {
    var start = 0, end = 0, normalizedValue, range,
        textInputRange, len, endRange;

    if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
        start = el.selectionStart;
        end = el.selectionEnd;
    } else {
        range = document.selection.createRange();

        if (range && range.parentElement() == el) {
            len = el.value.length;
            normalizedValue = el.value.replace(/\r\n/g, "\n");

            // Create a working TextRange that lives only in the input
            textInputRange = el.createTextRange();
            textInputRange.moveToBookmark(range.getBookmark());

            // Check if the start and end of the selection are at the very end
            // of the input, since moveStart/moveEnd doesn't return what we want
            // in those cases
            endRange = el.createTextRange();
            endRange.collapse(false);

            if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                start = end = len;
            } else {
                start = -textInputRange.moveStart("character", -len);
                start += normalizedValue.slice(0, start).split("\n").length - 1;

                if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                    end = len;
                } else {
                    end = -textInputRange.moveEnd("character", -len);
                    end += normalizedValue.slice(0, end).split("\n").length - 1;
                }
            }
        }
    }

    return {
        start: start,
        end: end
    };
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-29T07:58:07.310

我修改了上面的函数来解释 IE 中的回车。它未经测试，但我在我的代码中做了类似的事情，所以它应该是可行的。

```
function getCaret(el) {
  if (el.selectionStart) { 
    return el.selectionStart; 
  } else if (document.selection) { 
    el.focus(); 

    var r = document.selection.createRange(); 
    if (r == null) { 
      return 0; 
    } 

    var re = el.createTextRange(), 
    rc = re.duplicate(); 
    re.moveToBookmark(r.getBookmark()); 
    rc.setEndPoint('EndToStart', re); 

    var add_newlines = 0;
    for (var i=0; i<rc.text.length; i++) {
      if (rc.text.substr(i, 2) == '\r\n') {
        add_newlines += 2;
        i++;
      }
    }

    //return rc.text.length + add_newlines;

    //We need to substract the no. of lines
    return rc.text.length - add_newlines; 
  }  
  return 0; 
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-12-25T22:05:24.707

如果你不必支持 IE，你可以`selectionStart`使用.`selectionEnd``textarea`

要获得插入符号位置，只需使用`selectionStart`：

```
function getCaretPosition(textarea) {
  return textarea.selectionStart
} 
```

要获取围绕选择的字符串，请使用以下代码：

```
function getSurroundingSelection(textarea) {
  return [textarea.value.substring(0, textarea.selectionStart)
         ,textarea.value.substring(textarea.selectionStart, textarea.selectionEnd)
         ,textarea.value.substring(textarea.selectionEnd, textarea.value.length)]
} 
```

[JSFiddle 上的演示](https://jsfiddle.net/vs9Lpp23/)。

另请参阅[HTMLTextAreaElement 文档](https://developer.mozilla.org/en-US/docs/Web/API/HTMLTextAreaElement)。

# asp.net - 为 DataContext 设置 LINQ DSN

> ID：263748
> 
> 赞同：2
> 
> 时间：2008-11-04T22:38:43.100
> 
> 标签：asp.net, linq, registry, dsn

我通常将所有配置存储在注册表中。即使我已经开始使用 LINQ，我也不希望将 DSN 放在 web.config 中，而是让它留在注册表中并将其（可能在应用程序启动事件中）附加到系统配置中。

如何才能做到这一点？

感谢任何想法！

编辑：说清楚：我不想写入 web.config 文件，我只想将 dsn（加密）保存在 web.config 以外的任何地方，所以我在所有开发阶段都有相同的 web.config （本地，staginf，实时，备份）。

克里斯托夫

**VB.Net中的解决方案代码：**

1）添加一个新类，具有一个方法，它继承自原始数据上下文：

```
Public Class MyDatabaseDataContext

Inherits DatabaseDataContext

Public Sub New()
    MyBase.New(Settings.DSN)
End Sub

 End Class 
```

2) 在所有 Linq 数据源中使用这个类，而不是原来的上下文。

```
 ContextTypeName="MyProject.MyDatabaseDataContext 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T03:12:22.627

为什么不在 web.config 中保持加密呢？如果您不想`Application_Start`使用`aspreg_iis`. 之后您甚至可以使用 IIS 管理工具编辑加密的 web.config。

```
Configuration config = WebConfigurationManager.OpenWebConfiguration(
                               HttpContext.Current.Request.ApplicationPath );
ConfigurationSection section = config.Sections["connectionStrings"];
if (!section.SectionInformation.IsProtected
    && !GlobalConfiguration.ApplicationVersion.EndsWith( "dev" )) // don't encrypt dev
{
    section.SectionInformation.ProtectSection( "DataProtectionConfigurationProvider" );
    config.Save();
} 
```

如果您必须将其存储在注册表中。您始终可以使用 DataContext 上的构造函数，该构造函数采用连接字符串并传入您从注册表中读取的值。大概您会将其存储在应用程序商店中，因此您只需从注册表中读取一次。

Scott Guthrie 有一个很好的[参考](http://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)页面来加密你的 web 配置，尽管大多数示例使用`aspreg_iis`. 我更喜欢这样做，`Application_Start`所以我不会忘记意外加密它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T15:17:57.000

这就是我所做的。我的 DataContext 有一个基类。它称为 DataContextBase，由 sqlmetal.exe 生成。我有一个名为 DataContext 的派生类，它在我的 Linq 调用中使用。它看起来像这样：

```
public class DataContext : DataContextBase
{
    public DataContext()
        : base(ConnectionHolder.ConnectionString)
    {
    }
} 
```

我的库中有一个名为 ConnectionHolder 的静态类，它存储连接字符串：

```
public static class ConnectionHolder
{
    static string _ConnectionString;

    public static string ConnectionString
    {
        get { return _ConnectionString; }
        set { _ConnectionString = value; }
    }
} 
```

（注意：这与 DataContext 是分开的，因为在我的应用程序中 Linq 之外的地方我使用了连接字符串）。在应用程序启动时，我说 ConnectionHolder.ConnectionString = （无论您存储连接字符串的位置）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-06T08:03:54.037

在处理遗留代码时，这是一个相当合理的要求。

DataContext 类是一个分部类，所以我只是添加了一个静态工厂方法来加载配置设置并创建数据上下文结果。

# visual-studio - Visual Studio 2005 C++ 调试器不断进入反汇编视图

> ID：263752
> 
> 赞同：4
> 
> 时间：2008-11-04T22:41:26.590
> 
> 标签：visual-studio, debugging, visual-studio-2005

当我“Step into”或“Step Over”时，Visual Studio 2005 C++ 调试器不断进入反汇编视图。这不是我想要的，所以我必须保持右键单击并“转到源代码”。

它并不总是这样做 - 我认为在同一解决方案（静态库和一个控制台应用程序）中的不同项目之间步进时会感到困惑，但所有项目都有默认设置并且选择了“调试”配置，并且清理和重建没有任何区别。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-06T21:25:31.687

菜单工具/选项/调试/常规下有一个选项。确保“如果源不可用则显示反汇编”。设置已关闭。

您还可以查看MSDN 站点上的[常规、调试、选项对话框。](http://msdn.microsoft.com/en-us/library/85yzd16c(VS.80).aspx)

# windows - 虚拟机上的 Windows 7

> ID：263764
> 
> 赞同：4
> 
> 时间：2008-11-04T22:45:30.200
> 
> 标签：windows, windows-7, virtualization

我知道这个问题与“直接”编程无关，但是由于我希望在 Windows 7 发布时能够为 Windows 编程做好充分准备，所以我现在想尝试一下。但是由于我没有两台电脑，我不能冒险将它安装为双启动，以防万一它搞砸了，我在双启动 XP 和 Vista 方面的经验不是最好的，所以双启动测试前的世界更加可怕；）

无论如何，我的问题是：**现在是否存在任何处理 Windows 7 的虚拟化程序？**如果有几个，哪一个最好？我真的不需要任何关于如何安装它的详细描述，我有谷歌的;）当我们说话时，安装 DVD 就在我手中，所以这也不是问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-04T22:48:59.820

我想 Microsoft VirtualPC 将是您最好的选择。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-10T20:40:37.010

我昨晚在 MacBook Pro 上使用 VMWare Fusion 安装了它，没有任何问题。我刚刚告诉 VMWare 它是 Windows Vista 64Bit。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-10T20:50:25.913

我正在使用具有默认“Windows Vista”设置的 VMware Workstation (6.5.1)。

效果很好。尽管在 google 中发现了一些错误报告，但即使 NIC 也可以工作。

编辑：我安装了当前的 Windows 7 测试版（Build 7000）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T21:24:10.970

我本周在 VirtualBox 中安装了它，没有任何问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T21:28:43.597

正如其他人所说，免费的 Microsoft VirtualPC 2007 运行 Windows 7 Beta。但是你需要注意一些事情。

1.  需要安装Virtual PC 2007 SP1
2.  Virtual PC 2007 仅支持 32 位来宾操作系统，因此您需要下载 Windows 7 Beta 32 位
3.  创建新虚拟磁盘时选择 Windows Vista

我给了它 512MB RAM，它运行得非常流畅。不过我有一个四核CPU。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-16T21:49:01.590

我在 VirtualBox 中的表现非常好，但有几点需要注意：

*   Win7 没有默认模拟 NIC (PCnet-FAST III) 的驱动程序。但是，将其更改为 Intel PRO/1000 MT 台式机就可以了。
*   默认模拟声卡的安装映像中没有驱动程序，但 Windows 更新会在网络正常运行时为您获取它。
*   Guest Additions 抱怨操作系统不受支持并且不会安装，除非您在 Vista 兼容模式下运行它们（来自 .exe 上的属性）。Windows 安装后会在启动时挂起，然后 Win7 将提供“修复”自身。它会声称失败，但之后它仍然可以正常工作。
*   ...共享文件夹功能除外。据推测，这与 Win7 中的新家庭组内容发生冲突，并且是导致挂起的原因。您仍然可以使用普通的 Samba 共享或 SFTP 或其他任何东西，所以这不是世界末日。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T00:20:04.597

我个人使用 VMWare，我想它会毫无问题地支持 Windows 7。

祝测试顺利，我希望我能得到它的副本来测试自己。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-04T22:53:48.420

VMWare 简直太棒了……作为一种选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-12T18:57:20.803

我使用免费的 VMWare Server 1.0.8 使用 Vista 设置启动并运行它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-12T19:02:26.660

我这个周末在我的 Mac 上的 Parallels 3.0 机器上安装了它。安装顺利，启动正常，但就像没有安装网卡一样。我想我需要升级到 Parallels 4.0，它应该有更完整的支持。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-16T21:35:08.483

我使用 VMWare 和 VirtualBox 将它安装在两台机器上。在一个系统上，两个安装都无法识别 NIC，而两个安装都可以在第二个系统上正常工作。Vista 在两个虚拟机的两个系统上都能正常工作。Windows 7 的测试版似乎存在驱动程序问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-16T21:46:54.123

您可以使用来自[citrix.com的](http://citrix.com)**免费**Xen Server Express 。我已经使用 Vista 模板安装了 Windows 7。没有太多时间玩它，但似乎工作得很好（好吧，至于测试版）。

您必须进行一些调整才能使其运行。从模板创建 VM 后：

*   在 XenServer 上打开控制台
*   执行“xe vm-list”并复制您创建的虚拟机的 UUID
*   执行“xe vm-param-set uuid=平台：viridian=false”
*   重新启动虚拟机并享受安装过程。

# ruby-on-rails - 将用户 ID 添加到 RubyOnRails 日志条目的最佳方法是什么？

> ID：263770
> 
> 赞同：2
> 
> 时间：2008-11-04T22:47:11.837
> 
> 标签：ruby-on-rails, logging

我正在寻找自定义 Rails 日志条目的最佳方式（我想在其中添加用户 ID）。我正在使用 Rails 2.1.2。到目前为止，我发现的唯一方法是覆盖类 BufferedLogger 的方法“add”（在 active_support/lib/active_support 中定义）。

但它并不漂亮：我必须复制那里的所有代码，它与当前的实现密切相关。有没有更好的办法？我在谷歌上找到了这个：http: [//pandejo.blogspot.com/2007/08/customize-logger-message-format.html](http://pandejo.blogspot.com/2007/08/customize-logger-message-format.html)但它似乎已经过时了。有一天，我可能会创建一个特定的审计日志，但这对于我需要的东西来说太过分了：http: [//maintainable.com/articles/rails_logging_tips#audit-logs](http://maintainable.com/articles/rails_logging_tips#audit-logs) 干杯。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T12:48:21.903

你见过[user_event_logger](http://github.com/ffmike/user_event_logger/tree/master)插件吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-01T10:52:23.823

您可以在 application_controller 的 after_filter 中执行 logger.info：

```
after_filter :logging
 def logging
  if logger && logged_in?
   logger.info "UserID: #{current_user.id.to_s}"
  end
 end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T06:26:30.957

你想捕捉什么，每个用户所做的每一个动作，或者只是一个特定的动作子集？如果一个子集，一种快速而肮脏的方法是简单地使用记录器调用将用户 ID 转储到您要跟踪的操作的日志中。

# python - 我怎样才能要求输入 root 密码但稍后再执行该操作？

> ID：263773
> 
> 赞同：7
> 
> 时间：2008-11-04T22:47:39.493
> 
> 标签：python, linux, ubuntu

我有一个 python 脚本，我想添加一个“完成后关闭”功能。

我知道我可以使用 gksudo（当用户单击“完成后关闭”时）向用户询问 root 权限，但是我以后如何使用这些权限（当脚本实际完成时）。

我已经考虑过关闭命令上的 chmod u+s ，所以我不需要密码，但我真的不想这样做。

有什么想法可以实现这一目标吗？

在此先感谢，阿什。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T23:21:50.550

而不是`chmod u+s`ing 关闭命令，允许无密码 sudo 访问该命令会更好..

至于允许在脚本末尾关闭，我想您可以使用 sudo 运行整个脚本，然后在脚本开始时将权限授予初始用户？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T23:02:05.503

gksudo 应该有一个超时，我相信它是从您上次执行 gksudo 命令的时间开始的。

所以我想我会每分钟抛出一个“gksudo echo meh”之类的东西。应该重置计时器并让您保持活跃，直到您重新启动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T23:18:05.923

提升优先级，生成 ( `fork (2)`) 一个单独的进程，该进程将`wait (2)`在主进程中降低优先级。

# resources - 在哪里可以找到有关 VectorScript 编程语言的资源？

> ID：263774
> 
> 赞同：4
> 
> 时间：2008-11-04T22:47:45.830
> 
> 标签：resources, pascal, cad

哪里可以了解更多关于 VectorScript（NNA VectorWorks CAD 应用程序中内置的类似 Pascal 的编程语言）来创建自定义“插件”对象和工具的信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-19T12:05:04.523

“官方”文档 wiki 现在位于[http://developer.vectorworks.net](http://developer.vectorworks.net)。还值得订阅[http://lists.nemetschek.net](http://lists.nemetschek.net)上的邮件列表，并查看[论坛](http://techboard.vectorworks.net/ubbthreads.php?ubb=postlist&Board=13&page=1)。

# asp.net - ASP.Net 的日期/时间范围验证器

> ID：263779
> 
> 赞同：3
> 
> 时间：2008-11-04T22:48:57.060
> 
> 标签：asp.net, validation

看起来标准的 asp.net 2 RangeValidator 控件不允许时间。例如 01/01/2008 12:00 在我的范围内不被接受，即使它应该是有效的。如果我删除它按预期工作的时间。

是否有允许日期/时间格式的验证器？

## 更新

我们没有 Ajax 扩展。理想情况下，希望将预先存在的控件或正则表达式与 CustomValidator 一起使用。验证应该是客户端，服务器验证部分很容易。

## 解决方案

我们使用了这个正则表达式：

[http://regexlib.com/REDetails.aspx?regexp_id=610](http://regexlib.com/REDetails.aspx?regexp_id=610)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T23:02:43.847

您可以使用自定义验证器并手动执行检查。

[这是一个简单的示例](http://asp.net-tutorials.com/validation/custom-validator/)，或者您可以谷歌“asp.net 自定义验证器”。如果排除“ControlToValidate”属性，则可以针对多个字段进行验证。

# php - 在生产服务器上使用 subversion 使文件生效的最佳方法是什么？

> ID：263782
> 
> 赞同：4
> 
> 时间：2008-11-04T22:51:11.140
> 
> 标签：php, linux, svn

目前我已经设置了颠覆，因此当我在 Eclipse PDT 中进行更改时，我可以提交更改并将它们保存在 /home/administrator/ *Project File*中。这个文件有 subversion 推荐的 /branches /tags 和 /trunk 目录。我将文件正确上传到存储库没有问题，但是我是否必须将 Linux 中的文件“mv”到 /var/www 才能使它们存在于服务器上？是否有我缺少的自动过程来执行此操作？我假设我们不想将 /var/www 目录（位于机器上）作为存储库，但我不知道。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T22:54:24.940

您可以`svn export`进入您的 www 目录。这将为您提供一个“干净”版本的存储库，没有 .svn 目录。

```
cd /var/www
svn export /home/administrator/MyProject/trunk MyProject 
```

* * *

编辑：从评论中添加一些好主意......

当您想要更新导出的副本时的一些选项：

*   运行`svn export --force /home/...../ MyProject`这将停止它抱怨覆盖现有文件。这种方法意味着如果您从存储库中删除一个文件，它仍将保留在您的 www 文件夹中。
*   每次更改您的 SVN 命令以导出到新目录：
    `svn export /home/..../ MyProject_20081105`
    然后创建指向该文件夹
    `ln -s MyProject_20081105 MyProject`
    的符号链接：每次“释放”时删除并重新创建符号链接。在这种情况下，导出目录根本不需要在`www`文件夹中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T22:54:46.487

您可以简单地在 /var/www 文件夹中检出存储库的副本，然后在需要时对其运行**svn update**（或将其切换到新的分支/标签等）。因此，您在进行更改和更新的本地计算机上签出了一个存储库副本，在您的网络服务器上还有另一个副本。

使用 SVN 存储库还使您能够恢复到早期版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T23:05:06.637

您还可以创建一个提交后挂钩，将提交更改的所有文件移动到 /var/www 目录。

这是一个用 python 编写的示例，它通过 ftp 将更改的文件上传到远程主机：

[http://svn.haxx.se/dev/archive-2007-08/0287.shtml](http://svn.haxx.se/dev/archive-2007-08/0287.shtml)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T23:05:45.247

您可能想记住在任何给定时间您在生产中拥有的文件 - 所以保留一个“发布”标签（例如，在 /project/tags/release 中）。当你想要发布时，将你的主干复制到那里。然后 svn 导出该发布标签。

或者其他的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T23:08:00.920

我[在这里](https://stackoverflow.com/questions/tagged/capistrano)和其他论坛上看到很多人谈论使用[Capistrano](http://www.capify.org/)进行部署，但我没有任何个人经验。

# sql - SQL 比较 GUI 可以工作，但命令行会出现问题

> ID：263786
> 
> 赞同：1
> 
> 时间：2008-11-04T22:51:59.313
> 
> 标签：sql, sqlcompare

我最近为命令行功能购买了 SQL compare 7.1 pro。一段时间以来，我们一直在使用没有问题的 GUI 版本。我正在尝试从同步中排除项目，但它不起作用。

我正在使用从 GUI 创建的 .scp 文件。我的语法是：SQLCompare.exe /pr:"file.scp" /v sync >> Log.txt。我已经尝试使用 /exclude:Function 和 /exclude:user 来排除某些项目，但它仍然会同步它们。

我可以让它排除任何东西的唯一方法是，如果我进入 .scp 文件并将我排除的“DeselectItem”更改为“SelectItem”，然后进行排除。这似乎是倒退的，因为如果有人打开 GUI 进行更改，所有选中/未选中的项目都会倒退。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-19T01:50:55.807

您是否联系过 RedGate 的支持？他们通常非常好。

# sharepoint - 如何在 Windows SharePoint Services 中移动文档和列表项？

> ID：263800
> 
> 赞同：1
> 
> 时间：2008-11-04T23:01:00.123
> 
> 标签：sharepoint

我需要为用户提供一种在 WSS 3.0 中移动文档和列表项的简单方法。他们希望能够在不丢失版本历史记录、元数据和作者/日期信息的情况下跨列表、网站和网站集移动。遗憾的是，此功能在 OOB 中不可用。有人知道一个好的解决方案/产品吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T17:19:58.047

没有任何产品可以做到这一点，即使他们做到了，它们都会修改日期和作者（修改者）。我们开发了一个定制的解决方案来做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T12:12:49.427

好的，我们最终还开发了一个定制的解决方案来满足客户的要求。结果非常好，我们决定用它制作一个小产品。对于那些感兴趣的人，现在可以在@ [www.sharepointproducts.com](http://www.sharepointproducts.com)获得免费版本 。但是，完整版不是免费的。

# sql - SQL Server 动态查询

> ID：263801
> 
> 赞同：2
> 
> 时间：2008-11-04T23:01:18.360
> 
> 标签：sql, sql-server, tsql, dynamic

我有 15 个存储过程，它们从公用表返回数据，然后将该表与特定表连接以检索库存。

例子：

```
Common: tblCommon
Specific: tblSpecific 
```

有没有办法可以将名称“tblSpecific”作为变量传递到单个存储过程中，如下所示？

```
SELECT ....
FROM tblCommon c
INNER JOIN @TABLE s on c.primaryKey = s.foreignKey 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-04T23:10:05.173

执行此操作的方法是使用通过 sp_executesql() 存储过程运行的动态生成的 SQL。

通常，您将所需的表名传递给主过程，构建要执行的 SQL 的 ncharvar 字符串，然后将其传递给 sp_executesql。

[动态 SQL 的诅咒和祝福](http://www.sommarskog.se/dynamic_sql.html)是我所见过的描述所有进出的最佳页面。

最大的问题之一是，如果您使用动态 SQL，那么调用存储过程的用户不仅必须对该过程具有执行权限，而且还必须具有访问基础表的权限。我提供的链接还描述了如何解决该问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T23:08:58.220

是的，您可以动态生成一条 SQL 语句，然后执行它。

例如，

```
DECLARE @specificTableName nvarchar(50)
DECLARE @specificColumnName nvarchar(50)

SET @specificTableName = 'tblSpecific'
SET @specificColumnName = 'colSpecific'

DECLARE @sql nvarchar(4000)

set @sql = 'SELECT ... FROM tblCommon c INNER JOIN ' +
@specificTableName + ' s ON c.PrimaryKey = s.' + @specificColumnName

exec (@sql) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T03:20:24.997

动态 SQL 很危险。您**永远**不想将传递的值直接替换为 SQL 字符串。幸运的是，听起来你已经知道了。

不幸的是，在这种情况下，您发现了不能使用 SQL 参数作为表名的问题。那么该怎么办？您不想在动态生成的 SQL 中使用传递的值，但不能以正常安全的方式将其放入查询中。

答案是查找表。创建一个“表”表，其中包含每个特定表的名称。它应该看起来像这样：

```
CREATE TABLE [tables] (table_name sysname) 
```

然后，您可以编写如下所示的查询：

```
SELECT @tblSpecific = table_name FROM [tables] WHERE table_name = @tblSpecific 
```

现在你只需要检查是否`@tblSpecific`是`NULL`. 如果不是，那么在动态 SQL 语句中使用是安全的（动态 SQL 最终是您在这里*唯一*的选择：即使用户定义的函数也让您在某种程度上这样做）。

哦，还有一件事——我为查找表选择的名称和类型并非偶然。SQL 标准已经有一个这样的表（好吧，无论如何都是一个视图）。只需使用`INFORMATION_SCHEMA.Tables`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-22T10:19:00.133

将您的查询制定/操作为字符串，然后调用`EXECUTE(@SQLStatement)`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T23:11:55.920

另一种方法是，如果数据量不是太大，您可能需要考虑一个用户定义的函数，它可以返回一个可以用来连接的表变量。

```
SELECT ....
FROM tblCommon c
INNER JOIN dbo.SomeFuntionThatReturnsData(@someparam) s on c.primaryKey = s.foreignKey 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T05:23:16.840

我会将它们分别保存为不同的存储过程。

尽可能地，我喜欢保持我的存储过程简单明了。它们很难一眼就能理解，因为无论如何表达式都延伸得太多了，并且添加一堆与声明性代码片段混合的过程代码只会让它变得更加困难。

您将得到一个包含 15 次调用的更复杂的带参数存储过程的列表，或者您将得到一个等效的更简单存储过程的列表。如果你的参数是一个表名，它就不会是那种高效执行的参数化 sp。至于表驱动的方法，它仍然是效率较低且更危险的动态存储过程。表条目很可能被错误输入，除了在表中，任何表名错误都将更不明显。耦合度上升了，粘性下降了（两者都朝着错误的方向发展）。

# sql-server - 如何在 SSIS 或其他工具中处理带有许多抑制列的参差不齐的正确文本文件？

> ID：263809
> 
> 赞同：4
> 
> 时间：2008-11-04T23:04:32.113
> 
> 标签：sql-server, ssis, text-files, etl

不规则的右平面文件选项非常适合以 CRLF 终止的单个尾随字段，但是当任何数量的空白尾随字段被抑制并且该行以 CRLF 提前终止时，我在 SSIS 中找不到其他选择，只能阅读一些列中包含一个“剩余”列，然后使用带有 SUBSTRING 操作的派生列转换来一一提取“可选”列。

我想到的一种可能性是，在连接管理器获得它之前，是否有任何方法可以通过 SSIS 中的“填充器”组件传递线路。然后，您可以获得使用连接管理器设置传入列长度的所有好处。我总是可以创建一个外部程序（或一个完全独立的 SSIS 数据流）来传递一个文件，该文件将用空格填充每一行（并且右不规则 - 只需添加相同的最小空格数以解释所有抑制字段到每个行就足够了），但这似乎相当浪费磁盘空间，并且还需要再完全读取（和写入）文件一次。

或者，如果行过早终止，也许有一个第三方数据源组件将自动简单地为 NULL 或空白和列。

还有其他选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-06T15:38:36.787

我认为您提出的解决方案听起来很合理。磁盘空间很便宜。在导入数据之前清理格式的两步过程是完全可以接受的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-07T14:42:25.987

使用脚本组件将列分隔为数据源。

# asp.net-mvc - MVC XHTML 合规性问题

> ID：263815
> 
> 赞同：1
> 
> 时间：2008-11-04T23:06:06.883
> 
> 标签：asp.net-mvc

我有一个由我的数据层填充的模型，然后我有一个局部视图，它正在呈现该模型的一个实例。

```
<li class="<%= td.Active ? "youarehere" : string.Empty %> <%= i == ViewData.Model.Count() - 1 ? "last" : string.Empty %>"> 
```

问题是`class=""`XHTML 无效，我需要更复杂的逻辑来输出类属性。使用 ASP.NET MVC 解决此问题的正确方法是什么。逻辑应该存在于视图还是模型中？

我刚刚开始使用 MVC，我想我仍在努力在哪里画线，直到我放置逻辑的位置，以及每个层包含的可接受的逻辑数量。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T23:18:14.130

我可能会实现代码以在辅助方法中呈现该类属性。要么是特定于此视图的，要么是更通用的。这样，您的视图中的代码就更少了，并且它可以处理在没有要渲染的情况下是否渲染类属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T01:06:46.827

此代码的另一件事是将计算工作移至控制器或代码隐藏。

即替换

```
<li <%= Html.GenerateAttribute("class", 
   () => string.Format("{0} {1}", td.Active 
     ? "youarehere" : string.Empty, 
   i == ViewData.Model.Count() - 1 
     ? "last" : string.Empty)) %>> 
```

有类似的东西

```
<%= Html.ListItem( ViewData.Model.Value, 
       GetItemCssClass(i, ViewData.Model.Count()) ) %> 
```

并且 GetItemCssClass 可能在代码隐藏中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T23:46:07.210

好的，所以根据菲尔的意见，这就是我所做的。有用。如果有人有任何有用的反馈，请添加评论。

1.  我创建了一个名为 GenerateAttribute 的 HtmlHelper 扩展方法。

    ```
    public static string GenerateAttribute(this HtmlHelper hh,
                                           string name,
                                           Func<string> valueFunc)
    { 
        string value = valueFunc().Trim();
        if (!string.IsNullOrEmpty(value))
            return string.Format("{0}=\"{1}\"", name, value);
        return string.Empty;
    } 
    ```

2.  从我的视图中，我调用 Html.GenerateAttribute，向它传递一个生成值的 lambda 表达式。如果值不是 string.Empty，GenerateAttribute 方法将返回完整的属性 (name="val")。

    ```
    <li <%= Html.GenerateAttribute("class", () => string.Format("{0} {1}", td.Active ? "youarehere" : string.Empty, i == ViewData.Model.Count() - 1 ? "last" : string.Empty)) %>> 
    ```

# sql - 合并总和集团？

> ID：263816
> 
> 赞同：4
> 
> 时间：2008-11-04T23:07:25.477
> 
> 标签：sql, mysql

好的。我有一个看起来像这样的查询：

```
SELECT
    SUM(`order_items`.`quantity`) as `count`,
    `menu_items`.`name`
FROM 
    `orders`,
    `menu_items`,
    `order_items` 
WHERE 
    `orders`.`id` = `order_items`.`order_id` AND 
    `menu_items`.`id` = `order_items`.`menu_item_id` AND 
    `orders`.`date` >= '2008-11-01' AND 
    `orders`.`date` <= '2008-11-30' 
GROUP BY 
    `menu_items`.`id` 
```

此查询的目的是显示在给定日期范围内售出的商品数量。尽管这可行，但我现在需要它来显示特定商品在日期范围内是否没有销售`count`。`0`我尝试`COALESCE`在周围使用，`SUM`但这并没有成功，而且我真的没想到会这样。无论如何，有谁知道我将如何实现这一目标？我有一个时刻，我觉得我应该知道这一点，但我想不出。

干杯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T00:25:36.550

`JOIN`如果将日期条件放在子句 中，这可以在没有任何子查询的情况下完成。

下面是我在 MySQL 5.0 上测试的代码。

```
SELECT m.name, COALESCE(SUM(oi.quantity), 0) AS count
FROM menu_items AS m
  LEFT OUTER JOIN (
    order_items AS oi JOIN orders AS o
      ON (o.id = oi.order_id)
  ) ON (m.id = oi.menu_item_id
      AND o.`date` BETWEEN '2008-11-01' AND '2008-11-30')
GROUP BY m.id; 
```

输出：

```
+--------+-------+
| name   | count |
+--------+-------+
| bread  |     2 | 
| milk   |     1 | 
| honey  |     2 | 
| cheese |     0 | 
+--------+-------+ 
```

这是 MySQL 风格的 DDL 和设置代码：

```
DROP TABLE IF EXISTS menu_items;
CREATE TABLE menu_items (
  id            INT PRIMARY KEY,
  name          VARCHAR(10)
) TYPE=InnoDB;

DROP TABLE IF EXISTS orders;
CREATE TABLE orders (
  id            INT PRIMARY KEY,
  `date`        DATE
) TYPE=InnoDB;

DROP TABLE IF EXISTS order_items;
CREATE TABLE order_items (
  order_id      INT,
  menu_item_id  INT,
  quantity      INT,
  PRIMARY KEY (order_id, menu_item_id),
  FOREIGN KEY (order_id) REFERENCES orders(id),
  FOREIGN KEY (menu_item_id) REFERENCES menu_items(id)
) TYPE=InnoDB;

INSERT INTO menu_items VALUES
  (1, 'bread'),
  (2, 'milk'),
  (3, 'honey'),
  (4, 'cheese');

INSERT INTO orders VALUES
  (1, '2008-11-02'),
  (2, '2008-11-03'),
  (3, '2008-10-29');

INSERT INTO order_items VALUES
  (1, 1, 1),
  (1, 3, 1),
  (2, 1, 1),
  (2, 2, 1),
  (2, 3, 1),
  (3, 4, 10); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T23:49:43.537

Randy 的回答很接近，但 where 语句删除了对那些不属于该日期范围内的任何订单的项目的任何提及。

请注意，“左连接”不同于在 where 子句中以您已经完成的方式链接表（即内部连接）。我建议您阅读不同类型的 SQL 连接（内部、外部、交叉）。

从本质上讲，您需要将您从 Randy 的查询中获得的数据与您的项目源列表相结合。使用子选择将执行此操作：

```
SELECT
    name
    , nvl(count, 0) as count
FROM 
    menu_items items 
    LEFT JOIN (
        SELECT
            menu_items.id
            , SUM(order_items.quantity) as count
        FROM 
            menu_items
            LEFT JOIN order_items ON menu_items.id = order_items.menu_item_id
            LEFT JOIN orders ON orders.id = order_items.order_id
        WHERE
            "date" between to_date('2008-11-01','YYYY-MM-DD') and to_date('2008-11-30','YYYY-MM-DD')
        GROUP BY
            menu_items.id
    ) counts on items.id = counts.id; 
```

这是在 Oracle 10g 顺便说一句。我怀疑您使用的是 Oracle，因此您需要转换为自己的数据库。

运行测试显示以下内容：

```
SQL> create table menu_items ( id number, name varchar2(10));
create table order_items (order_id number, menu_item_id number, quantity number);
create table orders (id number, "date" date);

Table created.

SQL> 
Table created.

SQL> 
Table created.

SQL> 
insert into menu_items values (1, 'bread');
insert into menu_items values (2, 'milk');
insert into menu_items values (3, 'honey');
insert into menu_items values (4, 'cheese');
SQL> 
1 row created.

SQL> 
1 row created.

SQL> 
1 row created.

SQL> 
1 row created.

SQL> 
insert into orders values (1, to_date('2008-11-02', 'YYYY-MM-DD'));
insert into orders values (2, to_date('2008-11-03', 'YYYY-MM-DD'));
insert into orders values (3, to_date('2008-10-29', 'YYYY-MM-DD'));SQL> 
1 row created.

SQL> 
1 row created.

SQL> 
insert into order_items values (1, 1, 1);
insert into order_items values (1, 3, 1);
1 row created.

SQL> 
1 row created.

SQL> 
insert into order_items values (2, 1, 1);
insert into order_items values (2, 2, 1);
insert into order_items values (2, 3, 1);

insert into order_items values (3, 4, 10);
1 row created.

SQL> 
1 row created.

SQL> 
1 row created.

SQL> 
1 row created.

SQL> SQL> 

1 row created.

SQL> 
SELECT
    name
    , nvl(count, 0) as count
FROM 
    menu_items items 
    LEFT JOIN (
        SELECT
            menu_items.id
            , SUM(order_items.quantity) as count
        FROM 
            menu_items
            LEFT JOIN order_items ON menu_items.id = order_items.menu_item_id
            LEFT JOIN orders ON orders.id = order_items.order_id
        WHERE
            "date" between to_date('2008-11-01','YYYY-MM-DD') and to_date('2008-11-30','YYYY-MM-DD')
        GROUP BY
            menu_iteSQL>   2    3    4    5    6    7  ms.id
    ) counts on items.id = counts.id;  8    9   10   11   12   13   14   15   16   17   18  

NAME            COUNT
---------- ----------
bread               2
milk                1
honey               2
cheese              0

SQL> 
drop table menu_items;
drop table order_items;
drop table orders;SQL> 
Table dropped.

SQL> 
Table dropped.

SQL> 

Table dropped.

SQL> 
```

PS：使用“日期”作为列名是不好的做法，因为它（在大多数情况下）是类型名，可能会导致查询和解析出现问题。

# sql-server - 为 Windows 服务存储用户名和密码的最佳方式是什么？

> ID：263818
> 
> 赞同：3
> 
> 时间：2008-11-04T23:07:46.223
> 
> 标签：sql-server, security, service, passwords

为 Windows 服务存储用户名和密码的最佳方式是什么？

该服务必须能够访问远程计算机上的 MS SQL Server 数据库。我们必须支持 MS SQL Server 身份验证（混合模式）而不是 NT 身份验证。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T23:55:32.057

假设 .Net，您可以加密您的配置文件。看到[这个](http://msdn.microsoft.com/en-us/library/ms998280.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T23:28:15.293

[DP API](http://en.wikipedia.org/wiki/Data_protection_API)是在 Windows 上本地存储敏感数据的标准方式。您没有提到您正在使用的编程语言，但在 .NET 中，这是从[System.Security.ProtectedData](http://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata.aspx)类公开的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T23:25:11.447

虽然我同意，理想情况下，您不需要存储此密码，但如果您这样做，则无需自己对其进行哈希处理。[加密保护数据](http://msdn.microsoft.com/en-us/library/aa380261(VS.85).aspx)。阅读本文底部的警告。不过，我实际上使用[LsaStorePrivateData](http://msdn.microsoft.com/en-us/library/ms721818(VS.85).aspx)来存储密码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T01:59:43.740

没有真正安全的方法来存储您的 Windows 服务的用户名和密码，因此为您用于访问 SQL Server 的帐户提供执行所需操作所需的最低限度的数据库权限非常重要。

编辑：我并不是说您仍然不*应该*加密用户名和密码 - 您应该使用其他答案中提到的工具之一。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T12:47:09.770

这取决于您的环境。

该服务是否在不安全的机器上运行？

我们的服务在我们的服务器机房内的服务器上的防火墙内运行，只有管理员才能访问。

我们将此类信息部署到配置文件中，因为我们使用 NT 身份验证直接限制对这些文件的访问。但在这种情况下，运行服务的机器只是一台服务器，而不是用户机器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T14:15:29.357

感谢到目前为止的答案:)

最好的方法似乎是使用使用以下类加密用户名和密码的配置文件：[System.Security.Cryptography.ProtectedData](http://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata.aspx)

这里有一个很好的背景解释：[Windows Data Protection](http://msdn.microsoft.com/en-us/library/ms995355.aspx)

# python - 从 python 启动 vs2008 构建

> ID：263820
> 
> 赞同：1
> 
> 时间：2008-11-04T23:08:03.353
> 
> 标签：python, windows, visual-studio-2008, build-automation

第一个批处理文件启动命令提示符，我需要第二个命令位于第一个命令的 ccontext 中。我怎么能在python中做到这一点？

照原样，它启动批处理，并阻塞直到批处理（及其命令提示符上下文）终止，然后在`devenv`没有必要上下文的情况下执行。

```
os.system(r'%comspec% /k ""C:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat"" x86')
os.system(r'devenv asdf.sln /rebuild Debug /Out last-build.txt') 
```

把它想象成我在 bash 中，我需要在 perl 上下文中执行命令，所以我输入`perl -c 'asdf'`. 背靠背执行 perl 和 asdf 将不起作用，我需要了解`devenv`perl 上下文的内部。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-06T08:00:33.233

我认为实现此目的的正确方法是运行以下命令：

```
%comspec% /C "%VCINSTALLDIR%\vcvarsall.bat" x86 && vcbuild "project.sln" 
```

下面您将看到同一命令的 Python 版本：

```
os.system('%comspec% /C "%VCINSTALLDIR%\\vcvarsall.bat" x86 && vcbuild "project.sln"') 
```

这应该适用于任何 Visual Studio，因此最好编辑问题以使其更通用。

关于 vcvarsall.bat 的位置，我发现了一个小问题 - 因为 VCINSTALLDIR 并不总是设置，所以您必须使用注册表项来检测安装程序的位置：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0]
"InstallDir"="c:\\Program Files\\Microsoft Visual Studio 9.0\\Common7\\IDE\\" 
```

添加`..\..\VC\vcvarsall.bat`到此路径。测试其他版本的 Visual Studio 也是一个好主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T23:21:24.560

您可以将 devenv 命令附加到原始批处理文件的末尾，如下所示：

```
'%comspec% /k "...vcvarsall.bat" x86 && devenv asdf.sln /rebuild ...' 
```

（显然，为了简单起见，我缩短了命令）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T23:29:38.270

在这些情况下，我使用可以完成所有工作的脚本。这样你就可以尽可能多地链接。有时我会即时生成脚本。

```
compileit.cmd
  call C:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat
  devenv $1.sln /rebuild Debug /Out last-build.txt 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T23:24:48.193

我从设置变量的批处理文件中运行我的 Python 脚本:-)

```
call ...\vcvarsall.bat
c:\python26\python.exe myscript.py 
```

但布雷特的解决方案听起来更好。

# git - 如何在不将其拉入工作树的情况下查看 git 存储库中所做的更改

> ID：263821
> 
> 赞同：2
> 
> 时间：2008-11-04T23:08:10.920
> 
> 标签：git

例如，我可以先 git pull 然后 git checkout HEAD-1。但是在决定是否使用 git pull 之前，有没有办法查看差异？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T23:12:17.307

`git fetch`首先更新您的远程跟踪分支。然后使用`git log ..origin`查看“origin”分支中发生了什么变化。然后，`git pull`如果您对更改感到满意，则可以执行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T07:28:37.977

如果你真的想避免*任何*远程更改进入你的仓库，你可以做一个 local `git clone`，它将使用硬链接，所以几乎不会占用额外的空间，然后应用 Greg Hewgill 的答案。如果您满意，您可以返回原始存储库并从本地克隆中提取以避免通过网络，尽管您应该`git fetch`在原始存储库中跟进以确保您的远程跟踪分支是最新的。

当然，通常情况下，这不是必需的。

# algorithm - 写出代码仍然被认为是一种算法表示吗？

> ID：263834
> 
> 赞同：2
> 
> 时间：2008-11-04T23:12:21.770
> 
> 标签：algorithm, theory, pseudocode

我刚刚在测试中丢失了 50% 的答案，因为我在期中写出了代码而不是算法，将我从 A 撞到了 C。写出代码仍然被认为是算法表示吗？

[维基百科：算法表示](http://en.wikipedia.org/wiki/Algorithm#Expressing_algorithms)（因为编程风格几乎是基于共识的）

编辑：好的，让我明确几点：

1.  测试要求使用我们从未在课堂上真正“定义”过的伪代码；我们刚刚为我们的算法写了英文。

2.  它是一个 Java 类，并在 Java 方法中写出了整个解决方案以及注释。所有这些都是手写的，写出来的时间比伪代码要长。我以为会更清楚。

3.  我通常不会对这些事情提出异议，但这是 A 和 C 之间的区别，而且我在考试中获得奖学金。

4.  最后，我写这篇文章有两个原因：

    4.1 我想展示现代编程社区对伪代码和算法表示的看法。

    4.2 我想知道在“现实世界”中什么是可以接受的；我已经编程了一段时间，但我希望能够尽快为开源项目做出贡献，我不想踩到任何人的脚趾。（虽然我很确定这个话题在现实世界中出现的可能性很小）。

再次感谢您的任何帮助/建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T23:20:24.373

你可能想举个例子。如果您的代码过于关注不属于算法的语言细节，那么可以理解的是，您可以说您的算法中混入了非算法，导致结果不正确。

我觉得推理，学习的全部目的是表明你理解这个概念，而不是弯腰并勾选所有正确的框。

可以教计算机通过大学，但还不能教计算机真正独立思考和应用知识。

吃饭反刍的心态是我一直没毕业的原因。

* * *

关于您最近的评论，实现伪代码未定义很重要。它通常有重用的术语，但它不是一种严格的语言，而不是英语（否则它将*是*一种编程语言，可以逐字解析和执行）

伪代码的**重要性**在于充实系统的*逻辑*部分，而不必过度担心“它有意义”之外的语法

通常这可以使伪代码更*简洁* **和**更易于理解。

伪代码也不依赖于读者理解语言中的“神奇语法”来处理它，他们只需要理解所使用的术语。

例如，如果你要给普通人一个 perl 算法，大多数人会死于恐惧，因为他们看不到线噪音的长板。

尽管：

```
sub foo { 
   my @args = @_ ; 
   my( $a, $b )=(@args[0],@args[1]); 
   for( @{ $a } ){
       $b .= $_ ; 
       s/id//g; 
   }
   return [$b,$a];
} 
```

对于精通 perl 的人来说，可能会产生一些连贯的感觉，对于普通的代码阅读器来说，他们得到的只是“你刚才到底说了什么”的回应。记录它也没有多大帮助。

```
| there is a subroute foo which can take a list of strings, and a default string, 
\-  which then iterates all items in  that list, 
| \-  and for each item in that list 
|     1\. appends the contents of that item to the end of the default string
|     2\. removes all instances of the string "id" in that item
| 
 \ and returns a list, which contains 
    1\. the concatentated default string 
    2\. the modified input list 
```

突然间，它变得不那么模棱两可了，更多的人可以理解它。

所以可能，编写算法的一半练习是“你不仅要证明你理解它，你还必须证明你可以向对问题一无所知的其他人解释你的推理”，这是一个至关重要的练习。你需要的能力。如果你不能传达你所做的事情，那么没有人可以使用它。

[代码还有一个讨厌的小问题，它不存在于算法中，那就是代码可能*看起来*正确，但可能不会做你*认为*它做的事情，如果它做错了，你就不会没有意识到，阅读代码逆向工程的人会弄乱它并复制一个*损坏*的算法。不好。人类形式的算法更好地翻译“这就是我想要它做的”]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-04T23:23:03.667

在这种情况下，你必须服从教授。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T23:49:08.530

您需要提供更多信息。您被要求提供算法，但提供了代码。你评论代码了吗？多少？（我想看看这个问题和你的答案，但也许这要求太多了）。

所以我会根据自己的经验来回答。如果我要求一种算法，那么我想要一些用体面的英语解释如何解决问题和/或满足问题要求的东西。图表也很好（有时更好）。段落，点形式，无论什么 - 它只需要清晰，简洁和正确。

如果您向我提供执行上述操作的代码，则为满分。但是，如果您提供纯“语言”且相当神秘的代码，那么标记将会丢失 - 或多或少取决于代码实际的神秘程度。即使有代码，我也希望看到一个图表，以显示对概念的完全理解。

在教授编程时，我面临的最困难的事情之一就是让学生写得更多，而不是更少。有时我不得不提醒他们，作业（或考试）不是“最容易混淆的代码竞赛”的参赛作品。;-)

干杯，

-R

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T20:04:33.857

作为高级算法课程的评分者，如果有简单的编码解决方案，我*总是会扣分。*

有些事情在代码中根本无法像用英语那样雄辩地表达出来。伪代码试图摆脱严格的编译器语法并允许一些表现力。这是朝着可理解性的正确方向迈出的一步，但并不总是足够的。

尤其是在算法类中，提供正确性证明（无论是通过归纳、矛盾等）以及算法的空间和时间复杂度的大 O 表示法总是很重要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T23:15:28.830

我所知道的是，在您拥有算法之前，您不应该编写任何代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-04T23:29:49.020

使用代码而不是伪代码的问题在于，从理论上讲，人们可以假设它是代码，而不是伪代码。无论如何，老师给你评分是因为你的回答，而不是你的知识——你最好按照老师喜欢的方式回答你被要求的内容。是的，我们都知道，你更清楚。但是，你知道，尝试以他人的方式推理从来都不是一个糟糕的练习。而且至少在我的国家，老师有自由评价你的权利，所以……和他相处！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T00:56:05.273

只要和你的教授谈谈，问他为什么你把问题弄错了。问他什么是正确答案，以及两者之间的根本区别是什么。

会不会是你写的算法不对？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T01:22:00.323

代码是一种编写算法，以便机器可以执行它。该定义中没有任何内容表明它不是为人类理解而编写的。用 Java 编写是否使您的算法变得模糊？这将决定我是否同意你的老师。

# java - 从 XML 生成 SQL 模式

> ID：263836
> 
> 赞同：2
> 
> 时间：2008-11-04T23:13:01.673
> 
> 标签：java, sql, oracle, xsd

我们正在使用 Oracle 11 数据库和 java 开发环境（使用 Eclipse），并希望将几个 xml 模式迁移到 SQL 模式。

看过 ax xsd 但确实需要一些我们可以在没有安装 SQL Server 的情况下从 ant/Eclipse 运行的东西。

问候，

安迪

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-04T23:21:25.510

XML 模式定义是什么？它是专有的还是开放的？可以轻松编写 XSLT 转换脚本来进行转换。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-04T23:23:34.320

另一种选择是使用 JAXB 生成 Java 对象，并使用 Hibernate 基于类层次结构创建模式。

话虽如此，这取决于您要做什么，而且我认为这样的解决方案可能会很脆弱且难以维护。

# java - K 和 V 的 HashMap 默认类型

> ID：263838
> 
> 赞同：6
> 
> 时间：2008-11-04T23:13:04.327
> 
> 标签：java, generics, collections

我通常输入我的地图声明，但正在做一些维护，发现一个没有输入。这让我思考（哦，不！）。Map 声明的默认类型是什么。考虑以下：

```
Map map = new HashMap();
map.put("one", "1st");
map.put("two", new Integer(2));
map.put("three", "3rd");
for (Map.Entry entry : map.entrySet()) {
    System.out.println(entry.getKey() + " -> " + entry.getValue());
} 
```

此错误与 Map.Entry 上的不兼容类型有关。因此，如果我键入声明：

```
Map<Object, Object> map = new HashMap(); 
```

然后一切正常。那么在声明中设置的默认类型是什么？还是我错过了其他东西？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-04T23:22:25.197

没有默认类型。

Java 泛型中的类型仅用于编译时检查。它们在运行时被擦除并且基本上消失了。

将泛型视为一个静态助手，以 a) 更好地记录您的代码，并且 b) 启用一些有限的编译时检查以确保类型安全。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-04T23:41:46.890

类型是*java.lang.Object*。

*for*构造采用Iterable*类型*并调用其*迭代器*方法。由于*Set*没有使用泛型进行类型化，因此迭代器返回 Object 类型的*对象*。这些需要显式转换为*Map.Entry*类型。

```
Map map = new HashMap();
map.put("one", "1st");
map.put("two", new Integer(2));
map.put("three", "3rd");
for (Object o : map.entrySet()) {
    Map.Entry entry = (Map.Entry) o;
    System.out.println(entry.getKey() + " -> " + entry.getValue());
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T23:22:49.953

[HashMap](http://java.sun.com/j2se/1.4.2/docs/api/java/util/HashMap.html)是对象的集合，Think C++ 容器。地图的每个元素都是一个保存数据的“桶”。
您将不同类型的数据放入存储桶中，hashmap 需要知道这些数据类型并非都是相同的。如果仅将一种类型的数据放置在哈希图中，您会收到警告，但它会编译。

# asp.net-mvc - MVC 中的数字/日期转换助手，在哪里使用它们？

> ID：263839
> 
> 赞同：2
> 
> 时间：2008-11-04T23:13:37.180
> 
> 标签：asp.net-mvc

Stackoverflow 建立在 MVC 之上，并使用日期和数字（答案计数、投票等）做了很多简单但很好的事情。我假设这一切都是通过几个静态助手类完成的。

我的问题是视图应该调用这些帮助对象还是控制器应该调用这些帮助对象并将结果嵌入到 ViewData 中？

1.  控制器填充视图数据

    *   控制器加载模型/数据
    *   控制器使用 DateHelper 静态方法将日期转换为友好字符串
    *   提供友好的日期字符串以通过 ViewData 查看
2.  控制器使用模型和视图调用 DateHelper 填充视图数据

    *   控制器加载模型/数据
    *   Controller 通过 ViewData 提供模型来查看
    *   当 ViewData 绑定到 HTML 时，它调用 DateHelper 静态方法

我怀疑数字 1 是正确的方法，但它似乎有点混乱，因为您可以获取模型列表，并且这些模型很容易在视图中循环。如果您基于一组模型实例处理并生成一堆友好的字符串，并且模型没有将这些字符串附加到特定实例的位置，那么您最终会向 ViewData 发送两个不同的数据列表。对？

感谢您的想法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-04T23:16:56.800

根据你问的人，你会得到不同的答案。我个人喜欢选项 #2，因为我希望 ViewData 是原始数据并选择它在 View 中的呈现方式。对我来说，在视图中这样做是完全可以的，因为这是一个视图问题。

但是，我知道我自己团队中的人不同意我的观点，他们认为控制器正在返回一个*演示模型*，而不仅仅是一个模型（我也同意这一点），它应该在将模型发送到之前处理所有这些转换看法。这种情况下的观点应该是超级愚蠢的。

我认为在这种情况下，每个人都没有一个绝对正确的选择。我会说根据您的经验选择其中一个并坚持下去。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T23:16:42.430

我想我更愿意在视图中使用助手。在我看来，如何呈现日期是一个以视图为中心的事情。控制器只知道视图需要显示它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T23:27:31.020

我完全赞成选项 2。我会说这是一个格式问题，在我看来，这是让视图担心的问题。

# hibernate - 如何在 HQL 中创建 Distinct 查询

> ID：263850
> 
> 赞同：104
> 
> 时间：2008-11-04T23:17:38.763
> 
> 标签：hibernate, hql, distinct

有没有办法在 HQL 中创建 Distinct 查询。通过使用“distinct”关键字或其他方法。我不确定 distinct 是否是 HQL 的有效关键字，但我正在寻找 SQL 关键字“distinct”的 HQL 等效项。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-11-04T23:25:10.730

这是我们使用的 hql 片段。（名称已更改以保护身份）

```
String queryString = "select distinct f from Foo f inner join foo.bars as b" +
                " where f.creationDate >= ? and f.creationDate < ? and b.bar = ?";
        return getHibernateTemplate().find(queryString, new Object[] {startDate, endDate, bar}); 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-11-23T22:38:11.247

值得注意的是，`distinct`HQL 中的关键字并不直接映射到`distinct`SQL 中的关键字。

如果你`distinct`在 HQL 中使用关键字，那么 Hibernate 有时会使用`distinct`SQL 关键字，但在某些情况下它会使用结果转换器来产生不同的结果。例如，当您使用这样的外部联接时：

```
select distinct o from Order o left join fetch o.lineItems 
```

在这种情况下，无法在 SQL 级别过滤掉重复项，因此 Hibernate在执行 SQL 查询**后**`ResultTransformer`使用 a来过滤重复项。

 *** * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-05-19T23:10:27.423

下次做这样的事情

```
 Criteria crit = (Criteria) session.
                  createCriteria(SomeClass.class).
                  setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);

 List claz = crit.list(); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-08-14T14:11:04.663

您也可以`Criteria.DISTINCT_ROOT_ENTITY`与 Hibernate HQL 查询一起使用。

例子：

```
Query query = getSession().createQuery("from java_pojo_name");
query.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);
return query.list(); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-28T10:52:20.393

我在结果转换器与 HQL 查询相结合时遇到了一些问题。当我尝试

```
final ResultTransformer trans = new DistinctRootEntityResultTransformer();
qry.setResultTransformer(trans); 
```

它没有用。我不得不像这样手动转换：

```
final List found = trans.transformList(qry.list()); 
```

使用 Criteria API 转换器工作得很好。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-11-03T18:25:09.507

我的主要查询在模型中如下所示：

```
@NamedQuery(name = "getAllCentralFinancialAgencyAccountCd", 
    query = "select distinct i from CentralFinancialAgencyAccountCd i") 
```

而且我仍然没有得到我认为“不同”的结果。它们只是基于表上的主键组合而不同。

所以在`DaoImpl`我添加了一行更改并最终获得了我想要的“不同”回报。一个例子是，我现在只看到一次，而不是四次看到 00。这是我添加到的代码`DaoImpl`：

```
@SuppressWarnings("unchecked")
public List<CacheModelBase> getAllCodes() {

    Session session = (Session) entityManager.getDelegate();
    org.hibernate.Query q = session.getNamedQuery("getAllCentralFinancialAgencyAccountCd");
    q.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY); // This is the one line I had to add to make it do a more distinct query.
    List<CacheModelBase> codes;
    codes = q.list();
    return codes;       
} 
```

我希望这有帮助！再一次，这可能仅在您遵循实现项目的服务、dao 和模型类型的编码实践时才有效。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-05-12T14:53:28.390

假设您有一个映射到 CUSTOMER_INFORMATION 表的客户实体，并且您想要获取客户的不同名字的列表。您可以使用下面的代码段来获得相同的效果。

```
Query distinctFirstName = session.createQuery("select ci.firstName from Customer ci group by ci.firstName");
Object [] firstNamesRows = distinctFirstName.list(); 
```

我希望它有所帮助。所以在这里我们使用 group by 而不是使用 distinct 关键字。

同样，以前我发现当我想将它应用于多个列时，很难使用 distinct 关键字。例如，我想要获取不同名字、姓氏的列表，然后按分组就可以了。在这种情况下，我很难使用 distinct 。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-08-21T09:31:44.293

您可以像这样在标准构建器中使用不同的关键字。

```
CriteriaBuilder builder = session.getCriteriaBuilder();
CriteriaQuery<Orders> query = builder.createQuery(Orders.class);
Root<Orders> root = query.from(Orders.class);
query.distinct(true).multiselect(root.get("cust_email").as(String.class)); 
```

并在您的模型类中创建字段构造函数。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-02-22T13:22:17.887

我得到了 Hibernate Query Language to use Distinct fields 的答案。您可以使用 *SELECT DISTINCT(TO_CITY) FROM FLIGHT_ROUTE*。如果使用*SQL*查询，则返回字符串列表。您不能通过实体类使用它返回值。因此，解决此类问题的答案是将*HQL*与*SQL*结合使用。

```
FROM FLIGHT_ROUTE F WHERE F.ROUTE_ID IN (SELECT SF.ROUTE_ID FROM FLIGHT_ROUTE SF GROUP BY SF.TO_CITY); 
```

从*SQL*查询语句中得到 DISTINCT ROUTE_ID 并作为列表输入。并且 IN 查询从 IN (List) 中过滤出不同的 TO_CITY。

返回类型是实体 Bean 类型。因此，您可以在 AJAX 中使用它，例如*AutoComplement*。

愿一切安好

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-05-11T04:20:01.790

如果您需要在 select 语句中为自定义 DTO 使用**new**关键字并且需要**不同的元素**，请在 new 之外使用 new ，如下所示 -

```
select distinct new com.org.AssetDTO(a.id, a.address, a.status) from Asset as a where ... 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-05-27T12:04:35.857

您可以简单地添加 GROUP BY 而不是 Distinct

```
@Query(value = "from someTableEntity where entityCode in :entityCode" +
            " group by entityCode, entityName, entityType")
List<someTableEntity > findNameByCode(@Param("entityCode") List<String> entityCode); 
```

# css - 通过 CSS 对列表进行编号，仅当有多个项目时

> ID：263884
> 
> 赞同：4
> 
> 时间：2008-11-04T23:30:54.197
> 
> 标签：css, xml

我有一个试图通过 CSS 设置样式的 XML 文档。此 XML 的相关片段如下所示：

```
<senseBlock>
    <prelim>Not numbered</prelim>
    <sense>first item</sense>
    <sense>second item</sense>
    <sense>third item</sense>
</senseBlock> 
```

我需要将`<sense>`元素呈现为有序列表，但前提是列表中有多个`<sense>`元素。在只有一个`<sense>`元素的列表中，我需要它显示为没有任何数字的普通段落。

现在我正在像这样设计我的列表，但是当只有一个项目时，我不知道如何隐藏数字：

```
senseBlock {
    display: block;
    counter-reset: sense;
}

prelim {
    display: block;
}

sense {
    display: list-item;
    list-style: decimal inside;
}

sense:before {
    counter-increment: sense;
} 
```

我考虑过使用相邻的选择器`sense + sense`来检测多个项目，但这不会为我列表中的第一个元素设置样式。我几乎已经得出结论，如果不修改 XML，这是不可能的，但我想在我放弃之前将这个挑战扩展到社区。

这只需要在最新版本的 Safari for iPhone 中工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-04T23:47:00.093

啊哈！我使用 CSS3 last-child 伪选择器自己解决了这个问题。这个 CSS 达到了预期的效果：

```
senseBlock {
    display: block;
    counter-reset: sense;
}

prelim {
    display: block;
}

sense {
    display: list-item;
    list-style: decimal inside;
}

sense:before {
    counter-increment: sense;
}

prelim + sense:last-child {
    display: block;
} 
```

# terminal - 如何找到终端窗口的宽度和高度？

> ID：263890
> 
> 赞同：355
> 
> 时间：2008-11-04T23:33:47.217
> 
> 标签：terminal

作为一个简单的例子，我想编写一个 CLI 脚本，它可以`=`在终端窗口的整个宽度上打印。

```
#!/usr/bin/env php
<?php
echo str_repeat('=', ???); 
```

或者

```
#!/usr/bin/env python
print '=' * ??? 
```

或者

```
#!/usr/bin/env bash
x=0
while [ $x -lt ??? ]; do echo -n '='; let x=$x+1 done; echo 
```

* * *

## 回答 #1

> 赞同：663
> 
> 时间：2008-11-04T23:40:49.717

*   `tput cols`告诉你列数。
*   `tput lines`告诉你行数。

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2009-02-19T01:30:49.907

在 bash 中，环境变量`$LINES`和`$COLUMNS`环境变量应该可以解决问题。将在终端大小发生任何变化时自动设置。（即[SIGWINCH](http://en.wikipedia.org/wiki/SIGWINCH)信号）

* * *

## 回答 #3

> 赞同：90
> 
> 时间：2014-11-11T00:56:26.753

还有`stty`，见[stty：打印或更改终端特性](https://www.gnu.org/software/coreutils/manual/html_node/stty-invocation.html)，更具体地说是[特殊设置](https://www.gnu.org/software/coreutils/manual/html_node/Special.html)

```
$ stty size
60 120 # <= sample output 
```

它将分别打印行数和列数，或高度和宽度。

然后你可以使用或者`cut`提取`awk`你想要的部分。

这是`stty size | cut -d" " -f1`高度/线条和`stty size | cut -d" " -f2`宽度/列

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-11-04T23:50:03.893

```
yes = | head -n$(($(tput lines) * $COLUMNS)) | tr -d '\n' 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-09-27T20:08:51.243

要在 Windows CLI 环境中执行此操作，我能找到的最佳方法是使用 mode 命令并解析输出。

```
function getTerminalSizeOnWindows() {
  $output = array();
  $size = array('width'=>0,'height'=>0);
  exec('mode',$output);
  foreach($output as $line) {
    $matches = array();
    $w = preg_match('/^\s*columns\:?\s*(\d+)\s*$/i',$line,$matches);
    if($w) {
      $size['width'] = intval($matches[1]);
    } else {
      $h = preg_match('/^\s*lines\:?\s*(\d+)\s*$/i',$line,$matches);
      if($h) {
        $size['height'] = intval($matches[1]);
      }
    }
    if($size['width'] AND $size['height']) {
      break;
    }
  }
  return $size;
} 
```

我希望它有用！

**注意**：返回的高度是缓冲区中的行数，而不是窗口中可见的行数。还有更好的选择吗？

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-04-10T00:39:56.727

在 POSIX 上，最终您希望调用`TIOCGWINSZ`(Get WINdow SiZe)`ioctl()`调用。大多数语言应该有某种包装器。例如，在 Perl 中，您可以使用[Term::Size](http://search.cpan.org/perldoc?Term::Size)：

```
use Term::Size qw( chars );

my ( $columns, $rows ) = chars \*STDOUT; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-01-17T15:53:06.947

正如我在 lyceus 的回答中提到的，他的代码将在非英语语言环境 Windows 上失败，因为输出`mode`可能不包含子字符串“columns”或“lines”：

                                         ![模式命令输出](https://i.stack.imgur.com/qwUgY.png)

您无需查找文本即可找到正确的子字符串：

```
 preg_match('/---+(\n[^|]+?){2}(?<cols>\d+)/', `mode`, $matches);
 $cols = $matches['cols']; 
```

请注意，我什至不关心线条，因为它不可靠（而且我实际上并不关心它们）。

**编辑：**根据关于 Windows 8 的评论（哦，你......），我认为这可能更可靠：

```
 preg_match('/CON.*:(\n[^|]+?){3}(?<cols>\d+)/', `mode`, $matches);
 $cols = $matches['cols']; 
```

不过要测试一下，因为我没有测试过。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-04-17T11:01:02.293

受@pixelbeat 回答的启发，这里有一个水平条，由`tput`、轻微滥用`printf`填充/填充和`tr`

```
printf "%0$(tput cols)d" 0|tr '0' '=' 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-06-22T14:33:44.773

# 获取窗口宽度

此 shell 代码使全局变量`$TERM_SIZE`跟踪终端窗口的大小：

```
set_term_size() {
    TERM_SIZE="$(stty size 2>/dev/null)" && [ "$TERM_SIZE" ] ||
        TERM_SIZE='25 80'
}
trap set_term_size WINCH
set_term_size 
```

`stty size`它在回退到假设终端高 25 行，宽 80 个字符之前尝试过。POSIX 不*要求*` 的`size`操作数[`stty`](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/stty.html)，因此需要回退。

然后，您可以使用 shell 的有限字符串替换功能访问 columsn 参数：

```
echo "${TERM_SIZE% *}" # Prints the terminal's height.
echo "${TERM_SIZE#* }" # Prints the terminal's width. 
```

当然，您使用的脚本语言可能会提供一个库来为您处理这些问题——您应该使用它。

# 打印一行

一旦你知道终端的宽度，打印一条水平线就很容易了，例如，通过滥用`printf`的字符串填充：

```
printf '%*s\n' "${TERM_SIZE#* }" '' | 
tr ' ' - 
```

第一行告诉管道`printf`打印与列一样多的空格（通过滥用字符串填充）。注意，POSIX*没有*提到`*`语法，所以这可能不像上面的代码那样可移植。

第二行告诉`tr`从该管道读取并用连字符替换每个空格。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-01-02T15:14:40.727

在某些情况下，您的行/行和列与正在使用的“终端”的实际大小不匹配。也许您可能没有可用的“tput”或“stty”。

这是一个 bash 函数，您可以使用它来直观地检查大小。这最多可以工作 140 列 x 80 行。您可以根据需要调整最大值。

```
function term_size
{
    local i=0 digits='' tens_fmt='' tens_args=()
    for i in {80..8}
    do
        echo $i $(( i - 2 ))
    done
    echo "If columns below wrap, LINES is first number in highest line above,"
    echo "If truncated, LINES is second number."
    for i in {1..14}
    do
        digits="${digits}1234567890"
        tens_fmt="${tens_fmt}%10d"
        tens_args=("${tens_args[@]}" $i)
    done
    printf "$tens_fmt\n" "${tens_args[@]}"
    echo "$digits"
} 
```

# ubuntu - 通过命令更改 Gnome 终端中的背景颜色？

> ID：263892
> 
> 赞同：27
> 
> 时间：2008-11-04T23:36:33.140
> 
> 标签：ubuntu

我正在使用 Gnome 终端，我想通过命令更改背景颜色或配置文件，以便我可以在别名中对一些命令进行分组，以便在运行某些进程时在视觉上区分我的窗口。我正在运行 Ubuntu，而 bash 是我的 shell。是否有执行此操作的命令？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-12-20T17:13:48.853

你可以像这样使用 setterm

```
setterm -term linux -back blue -fore white -clear 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-08-23T08:10:23.627

从桌面启动器尝试以下命令：

```
gnome-terminal --window-with-profile=site2 -x ssh site2 
```

使用`-x ssh`意味着终端将仅在远程站点上处于活动状态，因此完全消除了在错误机器上键入命令的可能性，因为您已经从终端命令行 ssh 退出。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T00:09:25.663

假设您在打开终端之前知道想要什么配置文件：

右键单击您的面板和“添加到面板”并添加自定义应用程序启动器

您可以定义位置、大小和配置文件（负责颜色、字体等）

```
gnome-terminal --hide-menubar --geometry 115x40+0+0
gnome-terminal --window-with-profile=logs --hide-menubar --geometry=144x15+0-55 
```

“man gnome-terminal”有很多有用的信息

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-30T03:07:12.573

1）使用您想要的颜色和设置创建一个终端配置文件，并将其命名为“myGterm”
2）编辑您的`.bashrc`文件。
3）添加以下行：

```
alias Gterm='gnome-terminal --window-with-profile=myGterm' 
```

4) 保存并关闭`.bashrc`
5) 打开终端并输入：

```
$ Gterm 
```

6）瞧！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-05T00:16:04.607

你想使用 gconftool。

Gnome 将其设置保存在类似于 Windows 注册表的层次结构中。一旦您知道要更改的项目的路径，就可以从命令行使用 gconftool 设置该项目的值。

使用 gconf-editor 浏览 Gnome 设置。
使用 gconftool 设置脚本中项目的值。

在您的情况下，您需要执行以下操作：

```
gconftool --type string --set /desktop/gnome/background/primary_color "#dadab0b08282"

```

显然，您需要用您想要的任何颜色替换该颜色值。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-09T02:27:40.683

我调查了一下，结果发现这是不可能的。我提交了错误： [http ://bugzilla.gnome.org/show_bug.cgi?id=569869](http://bugzilla.gnome.org/show_bug.cgi?id=569869)

gconftool-2 可以获取/设置配置文件属性，但无法编写现有的、打开的 gnome-terminal 脚本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-12-27T18:45:02.007

要创建 4 个具有不同背景和标题的终端，您需要将以下行添加到 .bashrc_profile 文件中

```
$.bash_profile 
```

将以下行添加到文件

```
alias term1='gnome-terminal –window-with-profile=term1'
alias term2='gnome-terminal –window-with-profile=term2'
alias term3='gnome-terminal –window-with-profile=term3'
alias term4='gnome-terminal –window-with-profile=term4' 
```

1.  现在编辑/创建您的 4 个终端配置文件
2.  打开 > 终端 > 编辑 > 配置文件 > 新建 > 配置文件名称 = term1
3.  颜色选项卡 > 选择您的字体和背景颜色
4.  标题和命令选项卡 > 初始标题 = term1
5.  对剩余的 3 个终端重复上述命令。

关闭您可能打开的所有终端，然后重新打开一个新终端并输入“term1”，然后按回车键并重复所有 4 个终端，现在您打开了 4 个独特的终端！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-09-01T14:22:24.437

在 ubuntu 20lts 上的 gnome 终端中，您可以运行如下命令：

```
echo -e '\e]11;rgb:aa/bb/cc\a' 
```

其中**aa**、**bb**、**cc**是从 0 到 255 的十六进制数。

如果您想更改前景色，请使用`\e]10;`而不是`\e]11;`

要获得正确的颜色命令，您可以使用下面代码段中的颜色选择器。

```
let bg = document.getElementById('bg');
let fg = document.getElementById('fg');
let binp = document.getElementById('numberbg');
let finp = document.getElementById('numberfg');

binp.addEventListener('input', (e) => {
   let val = spl(e);
   bg.innerText = "echo -e '\\e]11;rgb:"+val+"\\a'";   
   up(bg); up(fg);
});

finp.addEventListener('input', (e) => {
   let val = spl(e);;
   fg.innerText = "echo -e '\\e]10;rgb:"+val+"\\a'";
   up(bg); up(fg);
});

function spl(e) { 
   return e.target.value.substring(1).match(/.{1,2}/g).join('/');
}

function up(i) {
   i.style.backgroundColor = binp.value;
   i.style.color = finp.value;
}
```

```
code {
   margin: 20px;
   background: #ddd;
   border: 1px solid #333;
   padding:20px;
   clear:both;
   display: inline-block;
}
```

```
<div>
  <label for="numberbg">set background: </label>
  <input id="numberbg" type="color" value="#000000"> <BR>
  <code id="bg">
    echo -e '\e]11;rgb:00/00/00\a'
  </code>
</div>
<div>
  <label for="numberfg">set foreground: </label>
  <input id="numberfg" type="color" value="#eeeeee"> <BR>
  <code id="fg">
    echo -e '\e]10;rgb:ee/ee/ee\a'
  </code>
</div>
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-09-30T22:59:20.037

您不必通过命令执行此操作，您可以转到编辑>>首选项>>颜色来更改它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-04T23:55:06.410

我曾经使用 xterm 的命令行参数来执行此操作。我设置了我的 .olvwm（我是在和自己约会吗）来执行 4 个具有不同背景颜色的 xterm。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-10T13:45:15.407

我根据其他线程的 github 代码创建了一些函数。抱歉我不记得了。

你可以把这些函数放在你的 ~/.bashrc 文件中

如您所见，如果您调用“create_random_profile”，

首先，它将检查并删除您之前创建的任何随机配置文件。

其次，它将在 gnome 终端中创建一个随机名称配置文件。

第三，它将在环境变量中设置该名称，您可以使用该变量在预定义的函数中更改颜色。请参阅最后一个函数函数 setcolord()。

这应该很有用，有许多不同颜色的终端。此外，通过预定义的功能，您可以即时更改这些颜色。好好享受！

```
 function create_random_profile() {
          #delete previous profiles in case there were something
          #delete_one_random_profile
          prof="`mktemp -u HACK_PROFILE_XXXXXXXXXX`"
    gconftool-2 --type list --list-type string --set $prof_list "`gconftool-2 --get $prof_list | sed "s/]/,$prof]/"`"
    file="`mktemp`"
    gconftool-2 --dump "/apps/gnome-terminal/profiles/Default" | sed "s,profiles/$2,profiles/$prof,g" > "$file"
    gconftool-2 --load "$file"
    gconftool-2 --type string --set "/apps/gnome-terminal/profiles/$prof/visible_name" "$prof"
    gconftool-2 --set "/apps/gnome-terminal/profiles/$prof/use_theme_colors" --type bool false
    rm -f -- "$file"
          export __TERM_PROF=$prof
  }

  function delete_one_random_profile() {
          regular="HACK_PROFILE_"
          prof=$(gconftool-2 --get /apps/gnome-terminal/global/profile_list | sed -n "s/.*\(HACK_PROFILE_..........\).*/\1/p")     
          if [ ! -z "$prof"]; then
          echo "size ${#prof}"
          echo "size of regular ${#regular}"
               echo "DO DELETE of $prof"
          #if not empty
        gconftool-2 --type list --list-type string --set $prof_list "`gconftool-2 --get $prof_list | sed "s/$prof//;s/\[,/[/;s/,,/,/;s/,]/]/"`"
        gconftool-2 --unset "/apps/gnome-terminal/profiles/$prof"
          else
               echo "NOTHING TO DELETE"
          fi
  }

  function setcolord()   
  {
  echo "Dont forget to change to Profile0 in the menu of your terminal->Change Profile->Profile_0"
  gconftool-2 --set "/apps/gnome-terminal/profiles/$__TERM_PROF/background_color" --type string white
  gconftool-2 --set "/apps/gnome-terminal/profiles/$__TERM_PROF/foreground_color" --type string black
  }
  function setcolor_cyan()   
  {
  echo "Dont forget to change to $__TERM_PROF in the menu of your terminal->Change Profile->Profile_0"
  gconftool-2 --set "/apps/gnome-terminal/profiles/$__TERM_PROF/background_color" --type string "#8DCBCC"
  gconftool-2 --set "/apps/gnome-terminal/profiles/$__TERM_PROF/foreground_color" --type string black
  } 
```

顺便说一句，如果您已经使用随机创建终端，您可以节省时间。你可以这样做：

```
gnome-terminal --working-directory=$HOME --window-with-profile="$prof" 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-11-01T10:50:30.477

```
sudo apt-get install dconf-cli uuid-runtime
bash -c  "$(wget -qO- https://git.io/vQgMr)" 
```

[通过输入数字Gogh - Color Scheme](http://mayccoll.github.io/Gogh/)选择您想要的主题

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2019-10-27T16:06:05.963

好吧，xterm 有直接的方法来改变颜色、字体和大小：

xterm -bg Blue1 -fg white -fa '等宽' -fs 9

为什么使用 gnome 终端？

# c# - 在 FileHelpers 映射类中使用数组

> ID：263899
> 
> 赞同：4
> 
> 时间：2008-11-04T23:40:06.910
> 
> 标签：c#, .net, csv, filehelpers

我一直在寻找一种方法来允许我的 FileHelpers 映射类的一个元素成为特定长度的数组。

例如，我有一个这样的类：

```
[DelimitedRecord(",")]
public class Example
{
    public string code;
    public int month;
    public int day;
    public double h1;
    public double h2;
    public double h3;
    public double h4;
} 
```

值 h1-h4 作为一个简单地称为“h”的数组真的更有意义。它也会使处理文件更容易一些。我也知道我正在阅读的文件将始终包含这些字段，并且只有这些字段。

有没有人想出一种在 FileHelper 映射类中包含数组的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-11-02T00:51:31.023

FileHelpers 记录类需要公共字段。记录类不应被视为应遵循最佳编码实践的普通 C# 类；相反，它只是描述导入文件结构的语法。

FileHelpers 的推荐过程是遍历结果`Example[]`数组并将您需要的字段映射到更普通的类（使​​用属性而不是公共字段）。此时，您可以将 H1-H4 值复制到数组属性中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T06:46:57.640

我对所讨论的工具一无所知，但是（假设它不是工具的限制）我*真的*怀疑公共领域的智慧。属性还可以让您有机会填充这些值：

```
[DelimitedRecord(",")]
public class Example
{
    public string Code {get;set;}
    public int Month {get;set;}
    public int Day {get;set;}

    private readonly double[] h = new double[4];

    public double H1 {get {return h[0];} set {h[0] = value;}}
    public double H2 {get {return h[1];} set {h[1] = value;}}
    public double H3 {get {return h[2];} set {h[2] = value;}}
    public double H4 {get {return h[3];} set {h[3] = value;}}
} 
```

再说一次 - 我不知道该工具是否会支持这一点，但这将是一种可行的实现方式。当然，“h”值与直接成员一样好（实际上，效率稍高 - 堆上没有数组，也没有取消引用）：

```
 public double H1 {get;set;}
    public double H2 {get;set;}
    public double H3 {get;set;}
    public double H4 {get;set;} 
```

# perl - 如何从 minipan 存储库中排除模块？

> ID：263901
> 
> 赞同：4
> 
> 时间：2008-11-04T23:41:03.273
> 
> 标签：perl, minicpan

我有一个本地 MINICPAN 存储库，但我想删除模块的特定版本，并注入旧版本。

这是我采取的步骤。

```
- create the MINICPAN, not filtering any modules
- use mcpani --add for the module in question
- use mcpani --inject 
```

此时，我可以在 MINICPAN 中看到它既有我想要的版本，也有较新的版本，如果我在 cpan 中发出 install，则安装较新版本的模块。如何从我的迷你盘中删除新版本？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T05:21:19.030

过滤要注入的模块。[CPAN::Mini](http://search.cpan.org/dist/CPAN-Mini)有用于过滤的文档，我想我在之前向您指出的资源中有一些示例。:)

如果您已经拥有迷你盘，正如您在对 ysth 的评论中所说，您可以从该迷你盘创建*另一个*迷你盘。在这种情况下，“远程”CPAN 就是您所拥有的。我一直这样做：我有一个规范的 minicpan，但是为了测试东西，我从中过滤以创建新的存储库，这样我就不必处理网络。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T02:09:14.783

过滤掉模块最初不起作用吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-12-03T00:22:44.730

另一种策略是使用[Pinto](https://metacpan.org/pod/Pinto)。与 minicpan 不同，Pinto 存储库*仅*包含您想要的发行版（及其依赖项），因此无需过滤。这会产生更小且更易于管理的文件堆，因此您可以轻松地执行诸如将其检入 SCM 之类的操作。Pinto 还有一些简洁的工具来处理升级，而不会意外破坏您的应用程序。

此外，[Stratopan](https://stratopan.com)在云中托管 Pinto 存储库。您可以通过浏览器管理存储库，并在可以访问 Internet 的任何地方安装模块。它还不支持 Pinto 的所有功能，但 Stratopan 确实省去了维护本地 CPAN 的麻烦。

*免责声明：我经营 Stratopan。*

# javascript - 渲染时不显示在 SVG 元素的 onload 事件中绘制的点

> ID：263902
> 
> 赞同：4
> 
> 时间：2008-11-04T23:41:36.703
> 
> 标签：javascript, svg, repaint

我正在使用 Javascript 绘制 SVG 网格。我设法绘制了轴以及象限标签。但是，我在添加动态点时遇到了问题。

我正在尝试在 SVG 元素的 onload 事件中绘制点。使用 Firebug 时，我已经能够确认代表我的点的圆形元素已添加到 SVG DOM 中，并为位置、画笔描边等设置了正确的属性。

不幸的是，我的浏览器（Firefox 3）呈现的实际图像没有更新以反映我添加了这些新的 DOM 元素的事实！

以下是我用来将元素添加到正确 DOM 节点的代码：

```
function drawPoints()
  {
    var points = pointCollection.points;
    var grid = SVGDoc.getElementById("gridGroup");

    for(var i = 0 in points)
    {
        var x = points[i].x;
        var y = points[i].y;
        var label = points[i].event;

        //<circle cx="100" cy="50" r="40" stroke="black" stroke-width="2" fill="red"/>

        var dot = SVGDoc.createElement("circle");
        dot.setAttribute("cx", x);
        dot.setAttribute("cy", y);
        dot.setAttribute("r", 15);
        dot.setAttribute("stroke", "red");
        dot.setAttribute("stroke-width", "2");
        dot.setAttribute("fill", "black");

        grid.appendChild(dot);
    }
  } 
```

Firefox 的 Firebug 调试扩展显示的 SVG 结构是：

```
<svg width="800" height="800" version="1.1" xmlns="http://www.w3.org/2000/svg" onload="init(evt); drawAxis(); drawPoints()">
  <g id="gridGroup" stroke="green">
    <line id="xAxis" x1="0" x2="800" y1="400" y2="400" stroke-width="2"/>
    <line id="yAxis" x1="400" x2="400" y1="0" y2="800" stroke-width="2"/>
    <text id="importantLabel" x="155" y="20" font-family="Verdana" font-size="18" fill="blue" onclick="drawPoints()">Important</text>
    <text id="notImportantLabel" x="555" y="20" font-family="Verdana" font-size="18" fill="blue">Not-Important</text>
    <text id="urgentLabel" x="20" y="200" font-family="Verdana" font-size="18" fill="blue" transform="rotate(-90, 20, 200)">Urgent</text>
    <text id="notUrgentLabel" x="20" y="600" font-family="Verdana" font-size="18" fill="blue" transform="rotate(-90, 20, 600)">Not-Urgent</text>

    <circle cx="30" cy="30" r="15" stroke="red" stroke-width="2" fill="black"/>
    <circle cx="600" cy="600" r="15" stroke="red" stroke-width="2" fill="black"/>
    <circle cx="400" cy="400" r="15" stroke="red" stroke-width="2" fill="black"/>
  </g>
</svg> 
```

任何帮助将不胜感激，我是一个完整的 SVG 新手！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T00:34:05.020

为了动态创建 SVG 元素，您必须使用`createElementNS`具有适当命名空间的方法，例如

```
var dot = SVGDoc.createElementNS("http://www.w3.org/2000/svg", "circle"); 
```

有关更多信息，请参阅[Kevin Lindsay 的教程](http://www.kevlindev.com/tutorials/basics/index.htm)，尤其是[此处](http://www.kevlindev.com/tutorials/basics/shapes/js_dom/index.htm)。

# c++ - C++构造奇怪的未初始化指针

> ID：263906
> 
> 赞同：0
> 
> 时间：2008-11-04T23:43:33.750
> 
> 标签：c++

```
AlertEvent::AlertEvent(const std::string& text) :
    IMEvent(kIMEventAlert, alertText.c_str()),
    alertText(text)
{
    //inspection at time of crash shows alertText is a valid string
}

IMEvent::IMEvent(long eventID, const char* details)
{
    //during construction, details==0xcccccccc
} 
```

在相关说明中，等宽字体在 chrome 中看起来非常糟糕，这是怎么回事？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-04T23:49:03.130

alertText 可能在调试器中显示为字符串，但尚未构造（因此 alertText.c_str() 将返回一个不确定的指针）。

为了避免这种情况，可以初始化使用 text.c_str() 作为 IMEvent ctor 的参数。

```
AlertEvent::AlertEvent(const std::string& text) :
    IMEvent(kIMEventAlert, text.c_str()),
    alertText(text)
{
    //inspection at time of crash shows alertText is a valid string
}

IMEvent::IMEvent(long eventID, const char* details)
{
    //during construction, details==0xcccccccc
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T23:47:30.607

在调用 alertText 的构造函数之前调用 IMEvent 构造函数。因此，特别`alertText.c_str()`是在调用 alertText 的构造函数之前评估它的参数。这不好。

初始化器表达式按照声明被初始化的事物的顺序调用（不一定是初始化器的列出顺序）。所以首先是父类，然后是成员。如果您没有按照它们实际执行的顺序列出初始化程序，编译器有时会警告您。所以只要你做对了，规则是“不要使用你没有初始化的任何东西”。此代码在初始化之前使用 alertText。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T23:50:02.410

*在调用 alertText 的构造函数之前调用 IMEvent 构造函数。*

几乎。`alertText.c_str()`在构造 alertText 之前调用，这是真正的问题。最简单的解决方案是将其替换为`text.c_str()`

# sql-server - 如何在 Reporting Services 中缩小“列表”对象

> ID：263909
> 
> 赞同：0
> 
> 时间：2008-11-04T23:46:56.647
> 
> 标签：sql-server, reporting-services

我在 SSRS 2005 的“列表”对象中包含一个表格和一个关联的图表。我正在使用表达式来确定表格和图表的可见性，但是当表格和图表不可见时，一个丑陋的大空白空间（其中否则它们会被渲染）出现在报告中。

如果只呈现一些对象，是否有任何功能可以“缩小”列表对象？

例如，我有一个包含 3 个项目的列表：

甲乙丙
_
_

项目 B 不符合可见性标准，因此将其可见性设置为 false。结果是：

一种

C

但我想要：

交流电_

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T11:19:19.947

我不确定我是否完全理解这个问题，但是，你为什么不过滤结果而不是改变它们的可见性呢？我遇到了类似的问题，我的解决方案是重做报告，我发现可见性问题多于有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T08:10:02.010

据我所知，列表高度会根据其中控件的可见性自动增长和缩小。如果它是表格或图表，请确保将可见性设置为整个控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-29T13:26:16.363

另一种解决方案是在表格中显示您的项目，并将表格放置在列表中。

1.  将每个项目放在一个表格行（表格标题）中。
2.  根据项目的可见性设置表格行的可见性。

如果一项的可见性设置为“隐藏”，则整个表格行将被隐藏，根本不会显示。

最好的祝福

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-28T19:49:22.160

我刚刚解决了这个问题。可见性将负责使项目不可见，但是该行仍然是空的。

我的结果：

如果 A 和 C 已填充，但 B 为空。

**标题 A**
字段 A
**标题 C**
字段 C

解决方案：

1.  使用尽可能小的单个文本框创建一个列表区域（例如 1 行）。
2.  将文本框的 CanGrow 和 CanShrink 属性设置为 true
3.  使用所有报告字段填充文本框。
4.  修改报告标题的表达式，如果相关字段为空白，则写“”，否则写字段标题和回车行字符。
5.  修改报告字段的表达式，如果它为空，则写“”，否则写字段和回车符。

示例标题表达式：=IIf(Len(Fields!Highlights.Value)>2, "Highlights"+VbCrLf, "")

示例字段表达式：=IIf(Len(Fields!Highlights.Value)>2, Fields!Highlights.Value+VbCrLf, "")

# .net - 如何将“插入新行”设置为 DataGridView 中的第一行

> ID：263913
> 
> 赞同：7
> 
> 时间：2008-11-04T23:48:58.420
> 
> 标签：.net, winforms, datagridview

我试图让 DataGridView 将“插入新行”行呈现为网格中的第一行而不是最后一行。我该怎么做，在控制中甚至可能吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-05T00:40:04.103

我认为没有任何方法可以将“新行”行移动到数据网格的顶部。

但是，如果您将第一行留空并在填充数据时将行向下移动怎么办？换句话说，创建自己的“新行”行，这只是网格中的第一行，并在编辑结束时在上方添加新的空白行。

```
 Dim myrow = existingDataTable.NewRow

    existingDataTable.Rows.Add(myrow)

    adp.Fill(existingDataTable)
    With DataGridView1
        .DataSource =existingDataTable
    End With 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-14T22:42:21.757

如果您不使用绑定控件，dgvItems.Rows.Insert() 将允许您指定插入行的位置。

如果您使用的是绑定的 datagridview，但没有激活排序，请将新行添加到所需位置的数据源：

BoundTable.Rows.InsertAt(BoundTable.Rows.NewRow(), RowLocation);

我发现了一个有趣的关系，如果当前行有编辑并且该行还没有提交到数据源（即你刚刚开始输入数据），似乎有必要将活动单元格移动到另一行提交插入行之前的更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T01:53:31.193

您可以为新行的键分配一个小于所有现有行的临时值吗？然后按该键对 DataView 进行排序并将视图绑定到您的网格。

我的团队使用负数作为行 ID，直到该行被插入到数据库中。我不记得我们的新行显示在顶部，但我们也没有要求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-08T23:25:58.653

如果所有其他方法都失败了，那么骇人听闻的方法是将单独的一行 DataGridView 放在现有的上面，克隆它的列，然后连接行提交事件以将数据添加到较低的 :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T22:48:05.507

您是否正在使用 RowDataBound 事件？如果是这样，您可以检查您是否正在绑定列标题行，然后添加适当的代码以在其下方插入一行。

这样，当您的内容行被绑定时，就不会与所涉及的项目索引混淆，尽管我建议使用一些 DataKeys 或其他东西以防万一。此外，当用户分页到 GridView 中的不同行块时，使用 RowDatabound 事件将允许您有一个可用的“插入行”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-27T15:34:00.120

正如 While-E 所说，使用`Insert`而不是`Add`. 这样，您可以指定要添加新记录的位置。要在网格顶部添加新记录，只需使用`Insert(0)`.

`DataGridView1.Rows.Insert(0)`这将始终在顶部添加一条新记录

`DataGridView1.Rows(0).Cells(n).Value = "abc"`这将在 n 列设置值

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2011-06-11T07:28:25.313

我假设你的意思是当你想添加一个新行时，你希望该行实际插入到表的顶部，而不是像默认的那样插入到表的底部？好吧，如果是这样，您就不必处理排序或键值；只需使用 Insert 方法即可：

> **'创建一个新行**
> 
> 暗淡 tmpRow = 新 DataGridViewRow
> 
> **'以某种方式调整行**
> 
> tmpRow.Height = _cellRectSize
> 
> **'将行添加到顶部的DataGridView（即dgvEditor）（索引= 0）**
> 
> Me.dgvEditor.Rows.Insert(0, tmpRow)

对我来说就像一个魅力，希望它可以帮助别人！

# operating-system - 什么是可用的最简单的操作系统？

> ID：263926
> 
> 赞同：18
> 
> 时间：2008-11-04T23:54:37.380
> 
> 标签：operating-system

有哪些小型开源操作系统？我正在寻找比 Puppy Linux、Feather Linux、DSL 等小几个数量级的东西。我想运行一个命令行文本编辑器和编译器；其他任何事情都是无关紧要的。我正在寻找一个系统，我可以在合理的时间内拆开并获得对整个事物的相当好的理解。可移植且有据可查的东西的奖励积分。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-04T23:58:43.283

如果您想了解内核，请查看 Minix。Linux 内核对于学术练习来说太大了。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-16T02:34:44.663

周围还有完全不同的研究/教学操作系统，例如[**TOPSY**](http://www.topsy.net/)。

> Topsy 是一个占用空间小的原生多线程、多任务操作系统，基于具有消息传递通信基础架构的微内核架构。

ANSI C，约 20k 行。它显然被移植到 ia32、MIPS R3000/R4000、StrongARM SA110、英特尔 IXP1200、英特尔 IXP2400 和摩托罗拉 68K。你会在他们的网站上找到各种论文报告。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-05T00:14:23.127

我同意使用 Minix。你会得到 gcc、vi、emacs、bash。柔性。bison、man 和 TEX，如果你安装了整个东西，但你可以把它剪掉，只用 kernel、bash、gcc 和 vi

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-16T02:44:04.193

曾经有“PeeWeeLinux”——它是一堆运行在 Red Hat 6.2 上的 shell 脚本。一旦你弄清楚了，你就可以从一系列菜单中构建系统（挑选）。现在已经四岁了。我构建了一个 4MB 的系统：Linux 为 1/2MB，PHP 为 3.5！

然后有一个人通过使用 Linux 内核并用他的应用程序替换*init*来构建一个通信终端应用程序！

你应该说*哪个*编辑器和*哪个*编译器。例如，100K 的 Busybox 为您提供有限的 vi。但我认为如果你想要 gcc，*那*将决定目标系统的大小。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-26T12:59:52.493

试试[xv6](http://pdos.csail.mit.edu/6.828/2012/xv6.html)。它基于第六版 Unix（又名 V6）。你可以运行它`qemu`/ `bochs`。用于`gdb`查看引导本身的代码。它被许多大学用于学术目的。良好的文档。
这是[麻省理工学院自 2002 年以来基于 xv6 的 6.828 操作系统工程课程](http://pdos.csail.mit.edu/6.828/2012/overview.html)。本书分为几章，每章将帮助您了解操作系统的某些部分，如文件系统或进程管理，并并排解释 xv6 源代码，所以你不必只扫描代码就可以自己理解。
这本书真的很小~80页：[xv6 book pdf](http://pdos.csail.mit.edu/6.828/2012/xv6/xv6-rev7.pdf)。你可以通过以下方式获得它的来源`git(1)`：`$ git clone git://pdos.csail.mit.edu/xv6/xv6.git`
你也可以做一些大学给出的许多简单的任务。

干杯

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-05T00:01:33.340

仅使用您需要的部分制作您自己的发行版。

[http://www.linuxfromscratch.org/](http://www.linuxfromscratch.org/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-05T00:05:21.287

查找 Xinu - Xinu 不是 Unix - 由 Douglas Comer 撰写。它最初是在 LSI (PDP-11) 机器上，但已被移植到许多其他架构上。[您可以在普渡大学](http://www.cs.purdue.edu/research/xinu.html)找到更多信息和来源。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-05T01:03:03.153

你没有说什么编译器。[JX](http://www4.informatik.uni-erlangen.de/Projects/JX/)为我工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-05T01:24:10.850

它不完全是 FOSS，但您可能会查看 QNX（又名 Qnix）。它是针对嵌入式系统的微内核操作系统。

我没有从属关系...[请参阅此处的 wiki 链接。](http://en.wikipedia.org/wiki/QNX) 请注意，该源是不久前提供的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-27T08:56:33.323

**不是另一个完全启发式操作系统 (NACHOS)** [NACHOS wiki](http://en.wikipedia.org/wiki/Not_Another_Completely_Heuristic_Operating_System)

[cs.washington.edu](http://www.cs.washington.edu/homes/tom/nachos/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-27T09:18:42.063

[孔蒂奇](http://en.wikipedia.org/wiki/Contiki)很小。不过，对于您的需求和/或硬件目标而言，可能太小了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-09-08T12:59:36.603

如果你想硬核，回归无限有“裸机”。 [http://www.returninfinity.com/baremetal.html](http://www.returninfinity.com/baremetal.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-05T00:52:37.450

[tomsrtbt](http://www.toms.net/rb/)：“一张软盘上最多的 GNU/Linux。”

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-27T10:00:33.163

我会同意Minix。还有这本书：

[http://www.amazon.com/Operating-Systems-Implementation-Prentice-Software/dp/0131429388](https://rads.stackoverflow.com/amzn/click/com/0131429388)

其实还算可以理解。（与一些类似主题的书籍不同，这里考虑的是“了解 Linux 内核”。）它相当昂贵，但您可能可以购买早期版本的二手书。

（注意。我与这本书没有任何关系，它很好:)）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-16T02:23:35.420

OpenBSD 可能是一个不错的选择，我认为默认安装（没有 X11）大约有 15 个进程。FreeBSD 紧随其后。无论哪种方式，您都想阅读“ [FreeBSD 操作系统的设计和实现](https://rads.stackoverflow.com/amzn/click/com/0201702452)”

顺便说一句，我在 AIX、Solaris、FreeBSD 和 Linux 上花费了大量时间……而且我认为 OpenBSD 手册页是最好的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-16T02:32:18.477

我仍然怀念大学时的 XINU（XINU 不是 UNIX）。不确定它是否能提供你需要的一切，但在我上大学的时候它相当有教育意义，并且很容易与涡轮 C 一起放在软盘上 :)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-16T02:58:33.493

> 我可以拆开的系统

还请查看 Bootdisk Howto，了解您将要拆开的内容。

# image - 将矩形图像数据打包成方形纹理

> ID：263932
> 
> 赞同：20
> 
> 时间：2008-11-04T23:57:58.870
> 
> 标签：image, textures, packing

我有 N 项 2D 图像数据，它们将是矩形的，我想尽可能有效地将它们打包成 2 的单次幂纹理。

打包这些矩形的算法的简单非高效和幼稚实现很容易启动，但我相信人们已经提出算法来尽可能有效地执行此操作。我发现了与我正在寻找的类似的光照贴图打包的各种参考，但是光照贴图的算法倾向于考虑非矩形图像，这实际上使事情变得比我需要的更复杂。

有人有提示吗？我应该用谷歌搜索算法或论文作者的名字？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-05T04:09:08.097

我需要做你描述的这件事。

这是我使用的 Python 代码，它是 Python Cookbook 中的食谱：

[配方 442299：将多张不同尺寸的图片打包成一张图片](http://code.activestate.com/recipes/442299/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-05T00:30:44.577

您的一维问题称为装箱。也许这是您搜索的良好开端。

请注意，您要解决的问题非常困难（它是 NP-hard）。所以你不应该寻找最优解，而应该寻找一些聪明的启发式算法。

我认为自下而上的动态编程对于一维装箱是可能的，但对于二维情况则不然。

您可以考虑通过仅解决一维问题来简化您的问题，例如将纹理切割成一维中的多个（可变大小）切片。

另一种可能性是对其进行元启发式优化，例如进化算法或粒子群优化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-04-26T18:40:30.463

非常好的和简单的打包算法可以在这里找到：http: [//www.blackpawn.com/texts/lightmaps/](http://www.blackpawn.com/texts/lightmaps/)

它的实现只需要 200 行 C++ 行，而不是更多（我想你已经有了位图操作例程）。

对于背后的理论，Jukka Jylänki 进行了介绍（查找“收拾垃圾箱的一千种方法”）。

这篇论文的作者提供的 C++ 库在我看来确实很臃肿，但另一方面，它有很多选择，并且有很好的文档记录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-15T02:21:51.887

我有一个类似的问题，但我正在打包正方形。试试这个：[http ://www.mrashid.info/blog/stacking-squares-problem.php](http://www.mrashid.info/blog/stacking-squares-problem.php)

C++ 代码不是很优雅，但至少你对如何解决这个问题有了基本的了解。

# javascript - 使用 javascript 更改 textarea 换行

> ID：263938
> 
> 赞同：3
> 
> 时间：2008-11-05T00:00:18.537
> 
> 标签：javascript, dom

对于我的小型 wiki 应用程序，我主要需要使用 textarea 来编辑内容以使用软（或虚拟）包装。但是，在某些情况下，最好不要包装内容。我想我会通过一个按钮来关闭包装来做到这一点。这是简化的代码：

```
 <form name="wikiedit" action="[[script_name]]" method="post">
    <textarea name="content" rows="25" cols="90" wrap="virtual">[[content]]</textarea>
    <input type="button" onclick="document.wikiedit.content.wrap='off';" value="No Wrap"> &nbsp;
    <input type="submit" value="Save">
  </form> 
```

它适用于 IE，但不适用于 Firefox 或 Opera。我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T01:10:35.557

请参阅错误 41464：[https ://bugzilla.mozilla.org/show_bug.cgi?id=41464](https://bugzilla.mozilla.org/show_bug.cgi?id=41464)

现在讨厌的解决方法是用自己的克隆替换 textarea：

```
function setWrap(area, wrap) {
    if (area.wrap) {
        area.wrap= wrap;
    } else { // wrap attribute not supported - try Mozilla workaround
        area.setAttribute('wrap', wrap);
        var newarea= area.cloneNode(true);
        newarea.value= area.value;
        area.parentNode.replaceChild(newarea, area);
    }
} 
```

不相关：尽量避免直接从文档对象中访问元素，这在某些浏览器上不可靠并导致名称冲突问题。'document.forms.wikiedit' 更好，移动到表单上的 'id' 而不是 'name' 然后使用 'document.getElementById('wikiedit')' 更好。

由于类似的原因，form.elements.content 也比 form.content 更可靠......或者，实际上，您可以给 textarea 一个 ID，然后使用 getElementById 直接进入 textarea，而不必费心查看表单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T02:47:29.417

这是关于 textarea wrap 的入门，包括 CSS 解决方案：

[http://www.web-wise-wizard.com/html-tutorials/html-form-forms-textarea-wrap.html](http://www.web-wise-wizard.com/html-tutorials/html-form-forms-textarea-wrap.html)

他们引用的 CSS 解决方案是：

```
white-space: pre; overflow: auto; 
```

这将是：

```
<script type="text/javascript">
function setNoWrap(textarea) {
    textarea.style.whiteSpace = 'pre';
    textarea.style.overflow = 'auto';
}
</script>
<form name="wikiedit" action="[[script_name]]" method="post">
 <textarea name="content" rows="25" cols="90" wrap="virtual">[[content]]</textarea>
 <input type="button" onclick="setNoWrap(this);" value="No Wrap">  
 <input type="submit" value="Save">
</form> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T00:33:16.490

根据[HTML 4.01 spec](http://www.w3.org/TR/html4/interact/forms.html#edef-TEXTAREA)，`wrap`is 不是`<textarea>`s 的有效属性，这可以解释为什么它如此困难和奇怪。看起来 Firefox 确实使用了该`wrap`属性，但它不允许您更改它。

不过我确实有解决办法！这太可怕了，但就是这样。用新的完全替换 textarea。

```
// this is the onclick handler for your button
document.getElementById("nowrapButton").onclick = function() {
  var oldOne = this.form.content;  // the old textarea
  var newOne = document.createElement('textarea'); // the new textarea
  var attrs = ['name', 'rows', 'cols']; // these are the attributes to keep
  for (var i = 0; i < attrs.length; ++i) {
    // copy the attributes to the new one
    newOne.setAttribute(attrs[i], oldOne.getAttribute(attrs[i]));
  }

  // toggle the wrapping on and off
  if (oldOne.getAttribute('wrap') != 'off') {
    newOne.setAttribute('wrap', 'off');
  }

  // copy the text over
  newOne.value = oldOne.value;

  // add the new one
  oldOne.parentNode.insertBefore(newOne, oldOne);
  // get rid of the old one
  oldOne.parentNode.removeChild(oldOne);
  return false;
}; 
```

这是您可以使用的工作版本：http: [//jsbin.com/ugepa](http://jsbin.com/ugepa)

像往常一样，这在 jQuery 中会更好。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T04:13:16.433

虽然，这是一个老帖子，但当我从中得到帮助时，我也展示了一个我刚刚找到的更简单的方法。而且我认为它更正确。

要替换 .cloneNode()，我认为最好的方法是：

child.setAttribute('wrap', wrap); parent.removeChild( 孩子 ); parent.appendChild( 孩子 );

使用这种方式，您不仅可以保存自身的属性，还可以保存您添加的属性，例如脚本句柄或其他内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-05T20:45:37.787

试试这个 jQuery 扩展：[Textarea Wrap Changer](http://blog.5ubliminal.com/posts/peculiarities-of-textarea-wrap-attribute-jquery-countermeasures/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-15T22:28:59.150

这是不需要克隆文本区域的[bobince 答案](https://stackoverflow.com/questions/263938/changing-textarea-wrapping-using-javascript/264094#264094 "博宾斯的回答")的变体：

```
function setWrap(area, wrap) {
    if (area.wrap) {
        area.wrap = wrap;
    } else { // wrap attribute not supported - try Mozilla workaround
        area.setAttribute("wrap", wrap);
        area.style.overflow = "hidden";
        area.style.overflow = "auto";
    }
} 
```

这类似于[VK](https://bugzilla.mozilla.org/show_bug.cgi?id=41464#c23 "VK")在 bobince 引用的错误中的评论，但设置显示而不是溢出对我不起作用，除非我将第二组放在 setTimeout 中。

# c++ - 如果在从头到尾迭代时在地图元素上调用 erase() 会发生什么？

> ID：263945
> 
> 赞同：138
> 
> 时间：2008-11-05T00:02:56.567
> 
> 标签：c++, stl, iterator

在下面的代码中，我循环遍历地图并测试是否需要擦除元素。擦除元素并继续迭代是否安全，或者我是否需要在另一个容器中收集密钥并执行第二次循环来调用擦除（）？

```
map<string, SerialdMsg::SerialFunction_t>::iterator pm_it;
for (pm_it = port_map.begin(); pm_it != port_map.end(); pm_it++)
{
    if (pm_it->second == delete_this_id) {
        port_map.erase(pm_it->first);
    }
} 
```

更新：当然，然后我[阅读了这个](https://stackoverflow.com/questions/52714/stl-vector-vs-map-erase)我认为不相关但回答我的问题的问题。

* * *

## 回答 #1

> 赞同：188
> 
> 时间：2008-11-05T00:09:29.080

## C++11

这已在 C++11 中修复（或擦除已改进/在所有容器类型中保持一致）。
擦除方法现在返回下一个迭代器。

```
auto pm_it = port_map.begin();
while(pm_it != port_map.end())
{
    if (pm_it->second == delete_this_id)
    {
        pm_it = port_map.erase(pm_it);
    }
    else
    {
        ++pm_it;
    }
} 
```

## C++03

擦除地图中的元素不会使任何迭代器失效。
（除了被删除元素的迭代器）

实际上插入或删除不会使任何迭代器无效：

另请参阅此答案：
[Mark Ransom Technique](https://stackoverflow.com/a/180616/14065)

但是您确实需要更新您的代码：
在您的代码中，您在调用擦除后增加 pm_it。此时为时已晚，已经失效。

```
map<string, SerialdMsg::SerialFunction_t>::iterator pm_it = port_map.begin();
while(pm_it != port_map.end())
{
    if (pm_it->second == delete_this_id)
    {
        port_map.erase(pm_it++);  // Use iterator.
                                  // Note the post increment.
                                  // Increments the iterator but returns the
                                  // original value for use by erase 
    }
    else
    {
        ++pm_it;           // Can use pre-increment in this case
                           // To make sure you have the efficient version
    }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-05T14:13:48.060

这就是我的做法......

```
typedef map<string, string>   StringsMap;
typedef StringsMap::iterator  StrinsMapIterator;

StringsMap m_TheMap; // Your map, fill it up with data    

bool IsTheOneToDelete(string str)
{
     return true; // Add your deletion criteria logic here
}

void SelectiveDelete()
{
     StringsMapIter itBegin = m_TheMap.begin();
     StringsMapIter itEnd   = m_TheMap.end();
     StringsMapIter itTemp;

     while (itBegin != itEnd)
     {
          if (IsTheOneToDelete(itBegin->second)) // Criteria checking here
          {
               itTemp = itBegin;          // Keep a reference to the iter
               ++itBegin;                 // Advance in the map
               m_TheMap.erase(itTemp);    // Erase it !!!
          }
          else
               ++itBegin;                 // Just move on ...
     }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T00:18:05.630

我会这样做，大约是：

```
bool is_remove( pair<string, SerialdMsg::SerialFunction_t> val )
{
    return val.second == delete_this_id;
}

map<string, SerialdMsg::SerialFunction_t>::iterator new_end = 
    remove_if (port_map.begin( ), port_map.end( ), is_remove );

port_map.erase (new_end, port_map.end( ) ); 
```

有点奇怪

```
val.second == delete_this_id 
```

但我只是从您的示例代码中复制了它。

# windows - 如何使 Eclipse 输出 std:out 到标准 Windows 控制台

> ID：263952
> 
> 赞同：19
> 
> 时间：2008-11-05T00:06:34.140
> 
> 标签：windows, eclipse, console

正如 eclipse 用户所知，eclipse 默认捕获 std out 和 err 的输出并将其转储到与 IDE 集成的控制台中。

我希望eclipse默认使用标准的windows cmd实例来显示std:out和std:err，就像大多数其他IDE一样。有人知道如何设置吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-05T11:39:28.470

I don't know if it's possible to redirect to a proper console window, however it *can* redirect to a file (which is more useful IMHO) - under Run/Debug settings -> Common -> Standard Input and Output (it can even write to console and file at the same time).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T20:02:44.023

好吧，您可能可以扩展/替换现有的控制台视图并添加一个选项以写入 stdout/stderr。

如果您谈论的是 Java 程序并且希望它为 stdout/stderr**打开**一个新的控制台窗口，您可能必须修改 JDT 启动器。

你为什么想这么做？我发现在 Eclipse 控制台中使用 stdout/stderr 要方便得多。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-07T07:21:04.713

既然你还没有说为什么你更喜欢 Windows cmd 窗口中的 stdout，我会做一些假设： - 你只想在 Eclipse 之外移动窗口

在上述情况下，您可以通过 Eclispe 外部的选项卡拖动控制台窗口，然后打开另一个窗口，您可以像 cmd 提示一样四处移动。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-15T03:17:33.793

当您从 cmd 运行 java .class 时，它会自动输出到 windows CMD。从 bin 文件夹中获取最新的 .class 文件或使用 javac 自己编译。然后只需转到类文件所在的 windows cmd 并使用 java yourClassesName.class 运行它，它会自动将所有输出写入 windows cmd。

# java - 独立的与 NetBeans 兼容的 .form 编辑器

> ID：263959
> 
> 赞同：2
> 
> 时间：2008-11-05T00:10:38.390
> 
> 标签：java, forms, netbeans, gui-designer, matisse

是否有独立的 GUI 设计器可以读取和写入 NetBeans (Matisse) 生成的 .form 文件？我喜欢 GUI 设计器，但我不希望一个完整的 Java IDE 的所有开销仅仅用于创建和编辑 .form XML 文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T23:55:47.207

您可以查看[JFormDesigner](http://www.jformdesigner.com/)。我知道它可以导入 Netbeans .form 文件，但我不确定它是如何工作的，反之亦然。既可作为独立的，也可作为多个 IDE 的插件使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-19T19:36:59.477

可能没有可用的。表单编辑器有几个不易实现的功能，例如自定义控件和代码。
它只是复杂且不够有用。

# jquery - 将参数传递给 jQuery 的 .load() 的最佳方法

> ID：263962
> 
> 赞同：48
> 
> 时间：2008-11-05T00:12:29.683
> 
> 标签：jquery, ajax

将参数传递给`.load`

```
$("#myDiv").load("myScript.php?var=x&var2=y&var3=z") 
```

对比

```
$("#myDiv").load("myScript.php", {var1:x, var2:y, var3:z}) 
```

`.load`另外，可以处理多少有大小限制吗？可以 `myScript.php`毫无问题地返回几百行数据吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-11-05T00:17:05.383

在第一种情况下，数据通过 GET 传递给脚本，在第二种情况下通过 POST。

[http://docs.jquery.com/Ajax/load#urldatacallback](http://docs.jquery.com/Ajax/load#urldatacallback)

我认为数据大小没有限制，但是远程调用的完成当然需要更长的时间，因为数据量很大。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2014-02-08T12:54:18.043

正如大卫·瓜拉诺所说。这个

```
$("#myDiv").load("myScript.php?var=x&var2=y&var3=z") 
```

使用 GET 方法发送请求，而这个

```
$("#myDiv").load("myScript.php", {var:x, var2:y, var3:z}) 
```

使用 POST 方法发送请求。但是适用于每种方法（post/get）的任何限制都适用于问题中提到的替代用法。

例如：url 长度限制了 GET 方法发送数据的数量。

# php - 链接到除非当前 - 在 CodeIgniter 中是否可能？

> ID：263963
> 
> 赞同：0
> 
> 时间：2008-11-05T00:12:32.257
> 
> 标签：php, codeigniter

在 Ruby 中（请原谅我提及它的名称），我注意到您可以使用“链接到除非当前”来做一个锚链接，如果它是当前页面，它将删除该链接。

我知道 CodeIgniter 没有内置任何东西来做类似的事情，但我正在努力想出最好的方法来做到这一点。我有几个选择，但它们都太长太麻烦了。有没有人有任何想法（也许使用 URI 段）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T21:48:25.823

为什么不编写您自己的帮助程序来遵循 html 帮助程序 link_tag 检查器...在其中再添加一个条件以检查您是否在当前控制器中。用 xdebug 查看 codeIgniter，get_instance 返回的对象提供了对控制器几乎所有内容的访问。所以 ci->router->uri->rsegments 可以用来检查你的控制器动作。

编辑：抱歉忘记了上面那个链中的“uri”部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T00:44:44.343

你可以

A. 在链接周围使用 if 语句

或者

B. 制作自己的功能

就功能而言，CodeIgniter 是一个比 ruby​​ on rails 小得多的框架。我怀疑他们是否拥有 rails 拥有的每个有用功能的副本。

# javascript - 如何在 JavaScript 中将字符串转换为布尔值？

> ID：263965
> 
> 赞同：3117
> 
> 时间：2008-11-05T00:13:08.963
> 
> 标签：javascript, boolean-expression, boolean-operations, string-conversion

我可以将表示布尔值的字符串（例如，'true'、'false'）转换为 JavaScript 中的内在类型吗？

我在 HTML 中有一个隐藏的表单，它会根据用户在列表中的选择进行更新。此表单包含一些表示布尔值的字段，并使用固有的布尔值动态填充。但是，一旦将此值放入隐藏的输入字段中，它就会变成一个字符串。

一旦将字段转换为字符串，我能找到确定字段布尔值的唯一方法是依赖于其字符串表示的文字值。

```
var myValue = document.myForm.IS_TRUE.value;
var isTrueSet = myValue == 'true'; 
```

有没有更好的方法来实现这一点？

* * *

## 回答 #1

> 赞同：4350
> 
> 时间：2008-11-05T00:51:02.193

# 做：

```
var isTrueSet = (myValue === 'true'); 
```

使用恒等运算符 ( `===`)，当比较变量具有不同类型时，它不会进行任何隐式类型转换。

* * *

## 不：

您可能**应该谨慎使用这两种方法**来满足您的特定需求：

```
var myBool = Boolean("false");  // == true

var myBool = !!"false";  // == true 
```

任何不是空字符串的字符串都将`true`通过使用它们来评估。尽管它们是我能想到的关于布尔转换的最简洁的方法，但我认为它们不是您想要的。

* * *

## 回答 #2

> 赞同：786
> 
> 时间：2011-10-20T09:35:03.537

# 警告

这个高度赞成的遗留答案在技术上是正确的，但只涵盖了一个非常具体的场景，当您的字符串值为 EXACTLY`"true"`或`"false"`.

传递给下面这些函数的无效 json 字符串**将引发异常**。

* * *

**原答案：**

怎么样？

```
JSON.parse("True".toLowerCase()); 
```

或使用 jQuery

```
$.parseJSON("TRUE".toLowerCase()); 
```

* * *

## 回答 #3

> 赞同：274
> 
> 时间：2009-09-12T03:26:41.837

```
stringToBoolean: function(string){
    switch(string.toLowerCase().trim()){
        case "true": 
        case "yes": 
        case "1": 
          return true;

        case "false": 
        case "no": 
        case "0": 
        case null: 
          return false;

        default: 
          return Boolean(string);
    }
} 
```

* * *

## 回答 #4

> 赞同：236
> 
> 时间：2008-11-27T11:47:25.350

我认为这是非常普遍的：

`if (String(a).toLowerCase() == "true")`...

它去：

```
String(true) == "true"     //returns true
String(false) == "true"    //returns false
String("true") == "true"   //returns true
String("false") == "true"  //returns false 
```

* * *

## 回答 #5

> 赞同：159
> 
> 时间：2008-11-05T01:03:14.697

记住要匹配大小写：

```
var isTrueSet = (myValue.toLowerCase() === 'true'); 
```

此外，如果它是一个表单元素复选框，您还可以检测该复选框是否被选中：

```
var isTrueSet = document.myForm.IS_TRUE.checked; 
```

假设如果它被选中，它被“设置”等于真。这评估为真/假。

* * *

## 回答 #6

> 赞同：125
> 
> 时间：2008-11-05T02:15:28.687

您可以使用正则表达式：

```
/*
 * Converts a string to a bool.
 *
 * This conversion will:
 *
 *  - match 'true', 'on', or '1' as true.
 *  - ignore all white-space padding
 *  - ignore capitalization (case).
 *
 * '  tRue  ','ON', and '1   ' will all evaluate as true.
 *
 */
function strToBool(s)
{
    // will match one and only one of the string 'true','1', or 'on' rerardless
    // of capitalization and regardless off surrounding white-space.
    //
    regex=/^\s*(true|1|on)\s*$/i

    return regex.test(s);
} 
```

如果你喜欢扩展 String 类，你可以这样做：

```
String.prototype.bool = function() {
    return strToBool(this);
};

alert("true".bool()); 
```

对于那些想要扩展 String 对象来获得它但担心可枚举性并担心与扩展 String 对象的其他代码冲突的人（参见注释）：

```
Object.defineProperty(String.prototype, "com_example_bool", {
    get : function() {
        return (/^(true|1)$/i).test(this);
    }
});
alert("true".com_example_bool); 
```

（当然，在旧版浏览器中不起作用，Firefox 显示为 false，而 Opera、Chrome、Safari 和 IE 显示为 true。[错误 720760](https://bugzilla.mozilla.org/show_bug.cgi?id=720760)）

* * *

## 回答 #7

> 赞同：66
> 
> 时间：2014-03-06T21:37:29.237

木眼要小心。在应用获得 500 多个赞成票的最佳答案后看到后果后，我觉得有义务发布一些真正有用的东西：

让我们从最短但非常严格的方式开始：

```
var str = "true";
var mybool = JSON.parse(str); 
```

并以一种适当的、更宽容的方式结束：

```
var parseBool = function(str) 
{
    // console.log(typeof str);
    // strict: JSON.parse(str)

    if(str == null)
        return false;

    if (typeof str === 'boolean')
    {
        return (str === true);
    } 

    if(typeof str === 'string')
    {
        if(str == "")
            return false;

        str = str.replace(/^\s+|\s+$/g, '');
        if(str.toLowerCase() == 'true' || str.toLowerCase() == 'yes')
            return true;

        str = str.replace(/,/g, '.');
        str = str.replace(/^\s*\-\s*/g, '-');
    }

    // var isNum = string.match(/^[0-9]+$/) != null;
    // var isNum = /^\d+$/.test(str);
    if(!isNaN(str))
        return (parseFloat(str) != 0);

    return false;
} 
```

测试：

```
var array_1 = new Array(true, 1, "1",-1, "-1", " - 1", "true", "TrUe", "  true  ", "  TrUe", 1/0, "1.5", "1,5", 1.5, 5, -3, -0.1, 0.1, " - 0.1", Infinity, "Infinity", -Infinity, "-Infinity"," - Infinity", " yEs");

var array_2 = new Array(null, "", false, "false", "   false   ", " f alse", "FaLsE", 0, "00", "1/0", 0.0, "0.0", "0,0", "100a", "1 00", " 0 ", 0.0, "0.0", -0.0, "-0.0", " -1a ", "abc");

for(var i =0; i < array_1.length;++i){ console.log("array_1["+i+"] ("+array_1[i]+"): " + parseBool(array_1[i]));}

for(var i =0; i < array_2.length;++i){ console.log("array_2["+i+"] ("+array_2[i]+"): " + parseBool(array_2[i]));}

for(var i =0; i < array_1.length;++i){ console.log(parseBool(array_1[i]));}
for(var i =0; i < array_2.length;++i){ console.log(parseBool(array_2[i]));} 
```

* * *

## 回答 #8

> 赞同：62
> 
> 时间：2021-07-29T20:59:47.633

这是我最近遇到的最简单的布尔转换方法。想加上它。

```
JSON.parse('true'); 
```

```
let trueResponse = JSON.parse('true');

let falseResponse = JSON.parse('false');

console.log(trueResponse);
console.log(falseResponse);
```

* * *

## 回答 #9

> 赞同：51
> 
> 时间：2014-02-24T00:00:44.250

我认为@Steven 的答案是最好的答案，并且处理的情况比传入值只是一个字符串要多得多。我想对其进行一些扩展并提供以下内容：

```
function isTrue(value){
    if (typeof(value) === 'string'){
        value = value.trim().toLowerCase();
    }
    switch(value){
        case true:
        case "true":
        case 1:
        case "1":
        case "on":
        case "yes":
            return true;
        default: 
            return false;
    }
} 
```

`false`如果您已经知道您必须考虑的所有案例，则不必涵盖所有案例`true`。您可以将任何可以传递`true`值的内容传递给此方法（或添加其他值，这非常简单），其他所有内容都将被考虑`false`

* * *

## 回答 #10

> 赞同：43
> 
> 时间：2014-01-22T14:39:55.870

JSON解析的通用解决方案：

```
function getBool(val) {
    return !!JSON.parse(String(val).toLowerCase());
}

getBool("1"); //true
getBool("0"); //false
getBool("true"); //true
getBool("false"); //false
getBool("TRUE"); //true
getBool("FALSE"); //false 
```

更新（没有 JSON）：

```
function getBool(val){ 
    var num = +val;
    return !isNaN(num) ? !!num : !!String(val).toLowerCase().replace(!!0,'');
} 
```

我还创建了小提琴来测试它[http://jsfiddle.net/remunda/2GRhG/](http://jsfiddle.net/remunda/2GRhG/)

* * *

## 回答 #11

> 赞同：35
> 
> 时间：2008-11-05T01:12:11.107

你的解决方案很好。

在这种情况下使用`===`会很愚蠢，因为该字段`value`将始终是`String`.

* * *

## 回答 #12

> 赞同：27
> 
> 时间：2014-07-14T19:43:42.143

```
var falsy = /^(?:f(?:alse)?|no?|0+)$/i;
Boolean.parse = function(val) { 
    return !falsy.test(val) && !!val;
}; 
```

这将返回`false`每个假值和`true`每个真值，除了`'false'`、`'f'`、`'no'`、`'n'`和`'0'`(不区分大小写)。

```
// False
Boolean.parse(false);
Boolean.parse('false');
Boolean.parse('False');
Boolean.parse('FALSE');
Boolean.parse('f');
Boolean.parse('F');
Boolean.parse('no');
Boolean.parse('No');
Boolean.parse('NO');
Boolean.parse('n');
Boolean.parse('N');
Boolean.parse('0');
Boolean.parse('');
Boolean.parse(0);
Boolean.parse(null);
Boolean.parse(undefined);
Boolean.parse(NaN);
Boolean.parse();

//True
Boolean.parse(true);
Boolean.parse('true');
Boolean.parse('True');
Boolean.parse('t');
Boolean.parse('yes');
Boolean.parse('YES');
Boolean.parse('y');
Boolean.parse('1');
Boolean.parse('foo');
Boolean.parse({});
Boolean.parse(1);
Boolean.parse(-1);
Boolean.parse(new Date()); 
```

* * *

## 回答 #13

> 赞同：23
> 
> 时间：2010-12-07T19:35:28.347

布尔对象没有“解析”方法。`Boolean('false')`返回true，所以这不起作用。`!!'false'`也返回`true`，所以这也行不通。

如果您希望字符串`'true'`返回布尔值`true`和字符串`'false'`返回布尔值`false`，那么最简单的解决方案是使用`eval()`. `eval('true')`返回真并`eval('false')`返回假。请记住使用时的性能影响`eval()`。

* * *

## 回答 #14

> 赞同：20
> 
> 时间：2015-02-18T16:16:16.730

有很多答案，很难选择一个。就我而言，我在选择时会优先考虑性能，所以我创建[了这个 jsPerf](https://jsperf.com/cast-booleans)，希望可以在这里有所启发。

结果简介（越高越好）：

1.  [**条件语句**](https://stackoverflow.com/a/264037/2824333)：2,826,922
2.  [**Bool 对象上的开关盒**](https://stackoverflow.com/a/2114091/2824333)：2,825,469
3.  [**转换为 JSON**](https://stackoverflow.com/a/7833897/2824333)：1,867,774
4.  [**！！转化**](https://stackoverflow.com/a/21285901/2824333)次数：805,322
5.  [**字符串原型**](https://stackoverflow.com/a/264180/2824333)：713,637

它们链接到相关答案，您可以在其中找到有关每个答案的更多信息（优点和缺点）；特别是在评论中。

* * *

## 回答 #15

> 赞同：19
> 
> 时间：2016-11-25T08:57:12.657

这是从接受的答案中得出的，但实际上它有一个非常薄弱的​​地方，我很震惊它是如何获得赞成票的，它的问题是你必须考虑字符串的大小写，因为这是区分大小写的

```
var isTrueSet = (myValue.toLowerCase() === 'true'); 
```

* * *

## 回答 #16

> 赞同：18
> 
> 时间：2013-07-31T03:57:57.487

我使用以下内容：

```
function parseBool(b) {
    return !(/^(false|0)$/i).test(b) && !!b;
} 
```

除了字符串“false”（不区分大小写）和“0”之外，此函数执行通常的布尔强制转换。

* * *

## 回答 #17

> 赞同：14
> 
> 时间：2010-01-22T00:30:07.227

```
Boolean.parse = function (str) {
  switch (str.toLowerCase ()) {
    case "true":
      return true;
    case "false":
      return false;
    default:
      throw new Error ("Boolean.parse: Cannot convert string to boolean.");
  }
}; 
```

* * *

## 回答 #18

> 赞同：14
> 
> 时间：2013-01-22T16:05:15.707

您正在寻找的表达式就是

```
/^true$/i.test(myValue) 
```

如在

```
var isTrueSet = /^true$/i.test(myValue); 
```

这`myValue`会针对正则表达式进行测试，不区分大小写，并且不会修改原型。

例子：

```
/^true$/i.test("true"); // true
/^true$/i.test("TRUE"); // true
/^true$/i.test("tRuE"); // true
/^true$/i.test(" tRuE"); // false (notice the space at the beginning)
/^true$/i.test("untrue"); // false (some other solutions here will incorrectly return true
/^true$/i.test("false");// returns false
/^true$/i.test("xyz");  // returns false 
```

* * *

## 回答 #19

> 赞同：14
> 
> 时间：2016-06-03T09:37:26.723

已经有很多答案可用了。但在某些情况下，以下可能很有用。

```
// One can specify all values against which you consider truthy
var TRUTHY_VALUES = [true, 'true', 1];

function getBoolean(a) {
    return TRUTHY_VALUES.some(function(t) {
        return t === a;
    });
} 
```

在一个具有非布尔值的示例中，这可能很有用。

```
getBoolean('aa'); // false
getBoolean(false); //false
getBoolean('false'); //false

getBoolean('true'); // true
getBoolean(true); // true
getBoolean(1); // true 
```

* * *

## 回答 #20

> 赞同：14
> 
> 时间：2021-02-26T00:10:02.300

# 最简单的解决方案

## 使用 ES6+

使用**逻辑 NOT**两次**[ !! ]**获取转换后的字符串

只需粘贴此表达式...

```
const stringToBoolean = (string) => string === 'false' ? false : !!string 
```

并将您的字符串传递给它！

```
stringToBoolean('')                 // false
stringToBoolean('false')            // false
stringToBoolean('true')             // true
stringToBoolean('hello my friend!') // true 
```

奖金！

```
const betterStringToBoolean = (string) => 
  string === 'false' || string === 'undefined' || string === 'null' || string === '0' ?
  false : !!string 
```

您可以随意包含其他字符串以轻松扩展此表达式的用法...：

```
betterStringToBoolean('undefined')     // false
betterStringToBoolean('null')          // false
betterStringToBoolean('0')             // false
betterStringToBoolean('false')         // false
betterStringToBoolean('')              // false
betterStringToBoolean('true')          // true
betterStringToBoolean('anything else') // true 
```

* * *

## 回答 #21

> 赞同：13
> 
> 时间：2015-03-11T13:16:25.560

将 string("true", "false") 和 boolean 都转换为 boolean

```
('' + flag) === "true" 
```

哪里`flag`可以

```
 var flag = true
 var flag = "true"
 var flag = false
 var flag = "false" 
```

* * *

## 回答 #22

> 赞同：13
> 
> 时间：2017-07-25T04:53:14.240

你可以使用`JSON.parse`如下：

```
 var trueOrFalse='True';
result =JSON.parse(trueOrFalse.toLowerCase());
if(result==true)
  alert('this is true');
else 
  alert('this is false');
```

在这种情况下`.toLowerCase`很重要

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2018-02-22T14:26:25.823

此函数可以处理字符串以及布尔值 true/false。

```
function stringToBoolean(val){
    var a = {
        'true':true,
        'false':false
    };
    return a[val];
} 
```

下面的演示：

```
function stringToBoolean(val) {
  var a = {
    'true': true,
    'false': false
  };
  return a[val];
}

console.log(stringToBoolean("true"));

console.log(typeof(stringToBoolean("true")));

console.log(stringToBoolean("false"));

console.log(typeof(stringToBoolean("false")));

console.log(stringToBoolean(true));

console.log(typeof(stringToBoolean(true)));

console.log(stringToBoolean(false));

console.log(typeof(stringToBoolean(false)));

console.log("=============================================");
// what if value was undefined? 
console.log("undefined result:  " + stringToBoolean(undefined));
console.log("type of undefined result:  " + typeof(stringToBoolean(undefined)));
console.log("=============================================");
// what if value was an unrelated string?
console.log("unrelated string result:  " + stringToBoolean("hello world"));
console.log("type of unrelated string result:  " + typeof(stringToBoolean(undefined)));
```

* * *

## 回答 #24

> 赞同：10
> 
> 时间：2015-02-06T20:29:45.083

我正在使用这个

```
String.prototype.maybeBool = function(){

    if ( ["yes", "true", "1", "on"].indexOf( this.toLowerCase() ) !== -1 ) return true;
    if ( ["no", "false", "0", "off"].indexOf( this.toLowerCase() ) !== -1 ) return false;

    return this;

}

"on".maybeBool(); //returns true;
"off".maybeBool(); //returns false;
"I like js".maybeBool(); //returns "I like js" 
```

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2017-12-14T15:44:37.373

你为什么不试试这样的东西

```
Boolean(JSON.parse((yourString.toString()).toLowerCase())); 
```

无论情况如何，当给出其他文本而不是真或假时，它将返回错误，并且它还将捕获数字作为

```
// 0-> false
// any other number -> true 
```

* * *

## 回答 #26

> 赞同：9
> 
> 时间：2008-11-05T01:16:37.667

您需要（在您的想法中）将您的选择的价值和该价值的表示分开。

在 JavaScript 逻辑中选择一个点，他们需要从字符串标记转换为原生类型并在那里进行比较，最好是对每个需要转换的值只进行一次比较。如果字符串 sentinel 不是脚本知道的字符串，请记住解决需要发生的情况（即，您默认为 true 还是 false？）

换句话说，是的，您需要依赖字符串的值。:-)

* * *

## 回答 #27

> 赞同：9
> 
> 时间：2017-05-08T15:52:58.700

# 一个班轮

我们只需要考虑“false”字符串，因为任何其他字符串（包括“true”）已经是`true`.

```
function b(v){ return v==="false" ? false : !!v; } 
```

**测试**

```
b(true)    //true
b('true')  //true
b(false)   //false
b('false') //false 
```

* * *

### 更详尽的版本

```
function bool(v){ return v==="false" || v==="null" || v==="NaN" || v==="undefined" || v==="0" ? false : !!v; } 
```

**测试**

```
bool(true)        //true
bool("true")      //true
bool(1)           //true
bool("1")         //true
bool("hello")     //true

bool(false)       //false
bool("false")     //false
bool(0)           //false
bool("0")         //false
bool(null)        //false
bool("null")      //false
bool(NaN)         //false
bool("NaN")       //false
bool(undefined)   //false
bool("undefined") //false
bool("")          //false

bool([])          //true
bool({})          //true
bool(alert)       //true
bool(window)      //true 
```

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2021-11-06T08:39:50.140

我很惊讶没有`includes`被建议

```
let bool = "false"
bool = !["false", "0", 0].includes(bool) 
```

您可以修改检查是否为 true 或包含更多条件（例如`null`, `''`）。

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2011-09-22T14:46:53.930

放下最简单的方法（假设您的字符串将是“真”或“假”）是：

```
var z = 'true';
var y = 'false';
var b = (z === 'true'); // will evaluate to true
var c = (y === 'true'); // will evaluate to false 
```

***对于这些类型的转换，请始终***使用 === 运算符而不是 == 运算符！

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2012-04-05T18:22:02.670

就像@Shadow2531 说的，你不能直接转换它。如果您的代码将被其他人重用/使用，我还建议您考虑除 "true" 和 "false" 之外的字符串输入，它们是 'truthy' 和 'falsey'。这就是我使用的：

```
function parseBoolean(string) {
  switch (String(string).toLowerCase()) {
    case "true":
    case "1":
    case "yes":
    case "y":
      return true;
    case "false":
    case "0":
    case "no":
    case "n":
      return false;
    default:
      //you could throw an error, but 'undefined' seems a more logical reply
      return undefined;
  }
} 
```

* * *

## 回答 #31

> 赞同：8
> 
> 时间：2013-08-21T10:35:11.270

我有点晚了，但我有一个小片段可以做到这一点，它基本上维护了所有 JScripts 的真/假/*脏*-ness ，但包括`"false"`作为假的可接受值。

与提到的方法相比，我更喜欢这种方法，因为它不依赖第三方来解析代码（即：eval/JSON.parse），这在我看来是多余的，它足够短，不需要实用函数并维护其他真/假约定。

```
var value = "false";
var result = (value == "false") != Boolean(value);

// value = "true"  => result = true
// value = "false" => result = false
// value = true    => result = true
// value = false   => result = false
// value = null    => result = false
// value = []      => result = true
// etc.. 
```

* * *

## 回答 #32

> 赞同：8
> 
> 时间：2015-08-02T01:45:48.693

另一种解决方案。 [jsFiddle](http://jsfiddle.net/r5p7qobn/)

```
var toBoolean = function(value) {
    var strValue = String(value).toLowerCase();
    strValue = ((!isNaN(strValue) && strValue !== '0') &&
        strValue !== '' &&
        strValue !== 'null' &&
        strValue !== 'undefined') ? '1' : strValue;
    return strValue === 'true' || strValue === '1' ? true : false
}; 
```

测试用例在节点中运行

```
> toBoolean(true)
true
> toBoolean(false)
false
> toBoolean(undefined)
false
> toBoolean(null)
false
> toBoolean('true')
true
> toBoolean('True')
true
> toBoolean('False')
false
> toBoolean('false')
false
> toBoolean('0')
false
> toBoolean('1')
true
> toBoolean('100')
true
> 
```

* * *

## 回答 #33

> 赞同：8
> 
> 时间：2017-11-30T21:57:54.177

天哪，其中一些答案很疯狂。我喜欢 JS 和它无数种剥皮布尔值的方法。

我很震惊地没有看到我的偏好是：

```
testVar = testVar.toString().match(/^(true|[1-9][0-9]*|[0-9]*[1-9]+|yes)$/i) ? true : false; 
```

* * *

## 回答 #34

> 赞同：7
> 
> 时间：2013-01-26T23:02:50.093

我对这个问题的看法是，它旨在满足三个目标：

*   为真值和假值返回真/假，但也为多个字符串值返回真/假，如果它们是布尔值而不是字符串，则它们将是真或假。
*   其次，提供弹性接口，以便指定以外的值不会失败，而是返回默认值
*   第三，用尽可能少的代码完成所有这些工作。

使用 JSON 的问题在于它会因导致 Javascript 错误而失败。该解决方案没有弹性（尽管它满足 1 和 3）：

```
JSON.parse("FALSE") // fails 
```

这个解决方案不够简洁：

```
if(value === "TRUE" || value === "yes" || ...) { return true; } 
```

我正在为[Typecast.js](http://typecastjs.org)解决这个确切的问题。这三个目标的最佳解决方案是：

```
return /^true$/i.test(v); 
```

它适用于许多情况，在传入 {} 之类的值时不会失败，并且非常简洁。它还返回 false 作为默认值，而不是 undefined 或抛出错误，这在松散类型的 Javascript 开发中更有用。对建议它的其他答案表示赞许！

* * *

## 回答 #35

> 赞同：6
> 
> 时间：2013-11-09T20:09:43.337

我写了一个函数来匹配 PHP 的 filter_var ，它很好地做到了这一点。提供要点：[https ://gist.github.com/CMCDragonkai/7389368](https://gist.github.com/CMCDragonkai/7389368)

```
/**
 * Parses mixed type values into booleans. This is the same function as filter_var in PHP using boolean validation
 * @param  {Mixed}        value 
 * @param  {Boolean}      nullOnFailure = false
 * @return {Boolean|Null}
 */
var parseBooleanStyle = function(value, nullOnFailure = false){
    switch(value){
        case true:
        case 'true':
        case 1:
        case '1':
        case 'on':
        case 'yes':
            value = true;
            break;
        case false:
        case 'false':
        case 0:
        case '0':
        case 'off':
        case 'no':
            value = false;
            break;
        default:
            if(nullOnFailure){
                value = null;
            }else{
                value = false;
            }
            break;
    }
    return value;
}; 
```

* * *

## 回答 #36

> 赞同：6
> 
> 时间：2019-05-31T09:23:31.560

我一直使用的最简单的方法：

```
let value = 'true';
let output = value === 'true'; 
```

* * *

## 回答 #37

> 赞同：5
> 
> 时间：2013-10-16T02:40:22.930

```
function parseBool(value) {
    if (typeof value === "boolean") return value;

    if (typeof value === "number") {
        return value === 1 ? true : value === 0 ? false : undefined;
    }

    if (typeof value != "string") return undefined;

    return value.toLowerCase() === 'true' ? true : false;
} 
```

* * *

## 回答 #38

> 赞同：5
> 
> 时间：2016-04-29T15:28:35.077

这里有很多花哨的答案。真的很惊讶没有人发布这个解决方案：

```
var booleanVal = toCast > ''; 
```

在大多数情况下，这解析为 true，而不是 bool false、数字零和空字符串（显然）。您可以在事后轻松查找其他虚假字符串值，例如：

```
var booleanVal = toCast > '' && toCast != 'false' && toCast != '0'; 
```

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2017-05-16T08:34:05.390

```
String(true).toLowerCase() == 'true'; // true
String("true").toLowerCase() == 'true'; // true
String("True").toLowerCase() == 'true'; // true
String("TRUE").toLowerCase() == 'true'; // true

String(false).toLowerCase() == 'true'; // false 
```

如果您不确定输入，则上述内容适用于布尔值以及任何字符串。

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2019-04-08T09:20:18.990

如果您确定测试主题始终是一个字符串，那么明确检查它是否等于是`true`您最好的选择。

您可能需要考虑包含一些额外的代码，以防主题实际上是布尔值。

```
var isTrueSet =
    myValue === true ||
    myValue != null &&
    myValue.toString().toLowerCase() === 'true'; 
```

如果代码得到改进/重构以使用实际的布尔值而不是字符串，这可以在将来为您节省一些工作。

* * *

## 回答 #41

> 赞同：5
> 
> 时间：2020-02-27T10:06:40.103

最简单的方法是

```
a = 'True';
a = !!a && ['1', 'true', 1, true].indexOf(a.toLowerCase()) > -1; 
```

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2012-03-14T20:39:03.530

我发现对布尔值使用 '1' 和空值 '' 比使用 'true' 或 'false' 字符串值更可预测......特别是对于 html 表单，因为 Dom 元素中的未初始化/空值将始终评估为假，而其中的*任何*值都为真。

例如：

```
<input type='button' onclick='this.value = tog(this.value);' />

<script type="text/javascript">

    function tog(off) {
        if(off) {
            alert('true, toggle to false');
            return '';
        } else {
            alert('false, toggle to true');
            return '1';
        }
    }   
</script> 
```

似乎是一条更容易的道路，到目前为止它一直非常一致/容易......也许有人可以确定一种方法来打破这个？

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2012-05-23T21:09:28.263

@guinaps> 任何不是空字符串的字符串都将通过使用它们来评估为真。

如何使用 String.match() 方法

```
var str="true";
var boolStr=Boolean(str.match(/^true$/i)); 
```

仅此一项不会得到 1/0 或是/否，但它会捕获 TRUE/true，同样，对于碰巧将“true”作为子字符串的任何字符串，它将返回 false。

**编辑**

下面是处理真/假、1/0、是/否（不区分大小写）的函数

```
​function stringToBool(str) {
    var bool;
    if (str.match(/^(true|1|yes)$/i) !== null) {
        bool = true;
    } else if (str.match(/^(false|0|no)*$/i) !== null) {
        bool = false;
    } else {
        bool = null;
        if (console) console.log('"' + str + '" is not a boolean value');
    }
    return bool;
}

stringToBool('1'); // true
stringToBool('No'); // false
stringToBool('falsey'); // null ("falsey" is not a boolean value.)
stringToBool(''); // false 
```

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2014-09-17T20:17:17.327

我这样做，它将处理 1=TRUE=yes=YES=true, 0=FALSE=no=NO=false：

```
BOOL=false
if (STRING)
  BOOL=JSON.parse(STRING.toLowerCase().replace('no','false').replace('yes','true')); 
```

将 STRING 替换为您的字符串变量的名称。

如果不为空，则为数值或以下字符串之一：“true”、“TRUE”、“false”、“FALSE”、“yes”、“YES”、“no”、“NO” 会抛出错误（故意地。）

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2015-01-26T15:04:57.187

我使用自己的方法，其中包括首先检查对象是否存在以及更直观地转换为布尔值：

```
function str2bool(strvalue){
  return (strvalue && typeof strvalue == 'string') ? (strvalue.toLowerCase() == 'true' || strvalue == '1') : (strvalue == true);
} 
```

结果是：

```
var test; // false
var test2 = null; // false
var test3 = 'undefined'; // false
var test4 = 'true'; // true
var test5 = 'false'; // false
var test6 = true; // true
var test7 = false; // false
var test8 = 1; // true
var test9 = 0; // false
var test10 = '1'; // true
var test11 = '0'; // false 
```

小提琴：http: [//jsfiddle.net/av5xcj6s/](http://jsfiddle.net/av5xcj6s/)

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2019-01-08T10:16:22.657

在 nodejs 中使用[node-boolify](https://www.npmjs.com/package/node-boolify)是可能的

**布尔转换结果**

```
Boolify(true); //true
Boolify('true'); //true
Boolify('TRUE'); //null
Boolify(1); //true
Boolify(2); //null
Boolify(false); //false
Boolify('false'); //false
Boolify('FALSE'); //null
Boolify(0); //false
Boolify(null); //null
Boolify(undefined); //null
Boolify(); //null
Boolify(''); //null 
```

* * *

## 回答 #47

> 赞同：4
> 
> 时间：2020-11-13T07:47:41.883

```
/// Convert something to boolean
function toBoolean( o ) {
    if ( null !== o ) {
        let t = typeof o;
        if ( "undefined" !== typeof o ) {
            if ( "string" !== t ) return !!o;
            o = o.toLowerCase().trim();
            return "true" === o || "1" === o;
        }
    }
    return false;
}

toBoolean(false) --> false
toBoolean(true) --> true
toBoolean("false") --> false
toBoolean("true") --> true
toBoolean("TRue") --> true
toBoolean("1") --> true
toBoolean("0") --> false
toBoolean(1) --> true
toBoolean(0) --> false
toBoolean(123.456) --> true
toBoolean(0.0) --> false
toBoolean("") --> false
toBoolean(null) --> false
toBoolean() --> false 
```

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2008-11-05T01:17:58.677

如果有一些其他代码将布尔值转换为字符串，您需要确切地知道该代码如何存储真/假值。要么，要么您需要访问一个反转该转换的函数。

有无数种方法可以在字符串中表示布尔值（“true”、“Y”、“1”等）。所以你不应该依赖一些通用的字符串到布尔转换器，比如 Boolean(myValue)。无论是什么，您都需要使用一个反转原始布尔到字符串转换的例程。

如果您知道它将真正的布尔值转换为“真正的”字符串，那么您的示例代码就可以了。除了你应该使用 === 而不是 ==，所以没有自动类型转换。

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2009-05-28T13:51:06.663

```
if (String(a) == "true"){
  //true block
} else {
  //false block
} 
```

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2013-06-23T05:42:00.607

我写了一个辅助函数来处理你的案例（以及更多）。随意更改它以满足您的特定需求

```
/**
 * @example
 * <code>
 * var pageRequestParams = {'enableFeatureX': 'true'};
 * toBool(pageRequestParams.enableFeatureX);  // returns true
 *
 * toBool(pageRequestParams.enableFeatureY, true, options.enableFeatureY)
 * </code>
 * @param {*}value
 * @param {Boolean}[mapEmptyStringToTrue=false]
 * @param {Boolean}[defaultVal=false] this is returned if value is undefined.
 *
 * @returns {Boolean}
 * @example
 * <code>
 * toBool({'enableFeatureX': ''        }.enableFeatureX);          // false
 * toBool({'enableFeatureX': ''        }.enableFeatureX, true);    // true
 * toBool({                            }.enableFeatureX, true);    // false
 * toBool({'enableFeatureX': 0         }.enableFeatureX);          // false
 * toBool({'enableFeatureX': '0'       }.enableFeatureX);          // false
 * toBool({'enableFeatureX': '0 '      }.enableFeatureX);          // false
 * toBool({'enableFeatureX': 'false'   }.enableFeatureX);          // false
 * toBool({'enableFeatureX': 'falsE '  }.enableFeatureX);          // false
 * toBool({'enableFeatureX': 'no'      }.enableFeatureX);          // false
 *
 * toBool({'enableFeatureX': 1         }.enableFeatureX);          // true
 * toBool({'enableFeatureX': '-2'      }.enableFeatureX);          // true
 * toBool({'enableFeatureX': 'true'    }.enableFeatureX);          // true
 * toBool({'enableFeatureX': 'false_'  }.enableFeatureX);          // true
 * toBool({'enableFeatureX': 'john doe'}.enableFeatureX);          // true
 * </code>
 *
 */
var toBool = function (value, mapEmptyStringToTrue, defaultVal) {
    if (value === undefined) {return Boolean(defaultVal); }
    mapEmptyStringToTrue = mapEmptyStringToTrue !== undefined ? mapEmptyStringToTrue : false; // default to false
    var strFalseValues = ['0', 'false', 'no'].concat(!mapEmptyStringToTrue ? [''] : []);
    if (typeof value === 'string') {
        return (strFalseValues.indexOf(value.toLowerCase().trim()) === -1);
    }
    // value is likely null, boolean, or number
    return Boolean(value);
}; 
```

* * *

## 回答 #51

> 赞同：3
> 
> 时间：2013-07-09T21:13:00.227

这是我的 1 班轮提交：我需要评估一个字符串和输出，如果为“真”则为真，如果为“假”则为假，如果为“-12.35673”之类的则为数字。

```
val = 'false';

val = /^false$/i.test(val) ? false : ( /^true$/i.test(val) ? true : val*1 ? val*1 : val ); 
```

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2014-06-25T17:14:09.273

简单的解决方案我已经使用了一段时间

```
function asBoolean(value) {

    return (''+value) === 'true'; 

}

// asBoolean(true) ==> true
// asBoolean(false) ==> false
// asBoolean('true') ==> true
// asBoolean('false') ==> false 
```

* * *

## 回答 #53

> 赞同：3
> 
> 时间：2015-12-15T18:08:17.733

# 在一行代码中将字符串转换为布尔值的最快安全方法

有助于加快 Javascript 代码执行的功能之一是*Short-Circuit Evaluation*：

> 由于逻辑表达式是从左到右评估的，因此使用以下规则测试它们是否存在可能的“短路”评估：
> 
> *   false && (anything) 短路评估为 false。
> *   真 || (anything) 短路评估为真。

因此，如果您想测试一个字符串值是否处于`true`测试`false`状态`JSON.parse`并保持性能强劲，您可以使用`||`运算符将​​慢速代码排除在执行之外，以防测试值是布尔类型。

```
test === true || ['true','yes','1'].indexOf(test.toString().toLowerCase()) > -1 
```

由于该`Array.prototype.indexOf()`方法是第 5 版中*ECMA-262*标准的一部分，您可能需要一个**polyfill**来支持旧浏览器。

```
// Production steps of ECMA-262, Edition 5, 15.4.4.14
// Reference: http://es5.github.io/#x15.4.4.14
if (!Array.prototype.indexOf) {
  Array.prototype.indexOf = function(searchElement, fromIndex) {

    var k;

    // 1\. Let O be the result of calling ToObject passing
    //    the this value as the argument.
    if (this == null) {
      throw new TypeError('"this" is null or not defined');
    }

    var O = Object(this);

    // 2\. Let lenValue be the result of calling the Get
    //    internal method of O with the argument "length".
    // 3\. Let len be ToUint32(lenValue).
    var len = O.length >>> 0;

    // 4\. If len is 0, return -1.
    if (len === 0) {
      return -1;
    }

    // 5\. If argument fromIndex was passed let n be
    //    ToInteger(fromIndex); else let n be 0.
    var n = +fromIndex || 0;

    if (Math.abs(n) === Infinity) {
      n = 0;
    }

    // 6\. If n >= len, return -1.
    if (n >= len) {
      return -1;
    }

    // 7\. If n >= 0, then Let k be n.
    // 8\. Else, n<0, Let k be len - abs(n).
    //    If k is less than 0, then let k be 0.
    k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);

    // 9\. Repeat, while k < len
    while (k < len) {
      // a. Let Pk be ToString(k).
      //   This is implicit for LHS operands of the in operator
      // b. Let kPresent be the result of calling the
      //    HasProperty internal method of O with argument Pk.
      //   This step can be combined with c
      // c. If kPresent is true, then
      //    i.  Let elementK be the result of calling the Get
      //        internal method of O with the argument ToString(k).
      //   ii.  Let same be the result of applying the
      //        Strict Equality Comparison Algorithm to
      //        searchElement and elementK.
      //  iii.  If same is true, return k.
      if (k in O && O[k] === searchElement) {
        return k;
      }
      k++;
    }
    return -1;
  };
} 
```

* * *

## 回答 #54

> 赞同：3
> 
> 时间：2016-03-23T09:12:41.257

```
function isTrue(val) {
    try {
        return !!JSON.parse(val);
    } catch (e) {
        return false;
    }
} 
```

* * *

## 回答 #55

> 赞同：3
> 
> 时间：2017-01-06T15:18:42.963

我使用这种简单的方法（使用“myVarToTest”）：

```
var trueValuesRange = ['1', 1, 'true', true];

myVarToTest = (trueValuesRange.indexOf(myVarToTest) >= 0); 
```

* * *

## 回答 #56

> 赞同：3
> 
> 时间：2017-02-09T12:31:06.113

轻松使用这个库。

[https://github.com/rohmanhm/force-boolean](https://github.com/rohmanhm/force-boolean)

你只需要写一行

```
const ForceBoolean = require('force-boolean')

const YOUR_VAR = 'false'
console.log(ForceBoolean(YOUR_VAR)) // it's return boolean false 
```

也支持关注

```
 return false if value is number 0
 return false if value is string '0'
 return false if value is string 'false'
 return false if value is boolean false
 return true if value is number 1
 return true if value is string '1'
 return true if value is string 'true'
 return true if value is boolean true 
```

* * *

## 回答 #57

> 赞同：3
> 
> 时间：2017-04-29T11:08:04.953

这是一个简单的函数，可以解决问题，

```
 function convertStringToBool(str){
        return ((str === "True") || (str === "true")) ? true:false;
    } 
```

这将给出以下结果

```
convertStringToBool("false") //returns false
convertStringToBool("true") // returns true
convertStringToBool("False") // returns false
convertStringToBool("True") // returns true 
```

* * *

## 回答 #58

> 赞同：3
> 
> 时间：2017-10-26T01:34:44.470

当我从 URL/Form 或其他来源获得价值时，我正在使用这个。

这是非常通用的一行代码。

也许不是最好的性能，如果您需要运行它数百万次，请告诉我，我们可以检查如何优化它，否则非常好并且可定制。

```
boolResult = !(['false', '0', '', 'undefined'].indexOf(String(myVar).toLowerCase().trim()) + 1); 
```

结果：

```
myVar = true;  // true
myVar = 'true';  // true
myVar = 'TRUE';  // true
myVar = '1';  // true
myVar = 'any other value not related to false';  // true

myVar = false; // false
myVar = 'false';  // false
myVar = 'FALSE';  // false
myVar = '0';  // false 
```

* * *

## 回答 #59

> 赞同：3
> 
> 时间：2019-03-06T09:16:09.157

对于 TypeScript，我们可以使用以下函数：

```
export function stringToBoolean(s: string, valueDefault: boolean = false): boolean {
    switch(s.toLowerCase())
    {
        case "true":
        case "1":
        case "on":
        case "yes":
        case "y":
            return true;

        case "false":
        case "0":
        case "off":
        case "no":
        case "n":
            return false;
    }

    return valueDefault;
} 
```

* * *

## 回答 #60

> 赞同：3
> 
> 时间：2020-01-20T14:05:53.637

试试这个解决方案（它就像一个魅力！）：

```
function convertStrToBool(str)
    {
        switch(String(str).toLowerCase())
            {
                case 'undefined': case 'null': case 'nan': case 'false': case 'no': case 'f': case 'n': case '0': case 'off': case '':
                    return false;
                    break;
                default:
                    return true;
            };
    }; 
```

* * *

## 回答 #61

> 赞同：3
> 
> 时间：2020-05-08T14:51:31.180

许多现有的答案使用与此语义相似的方法，但我认为值得一提的是，以下“一个衬里”通常就足够了。例如，除了 OP 的情况（表单中的字符串）之外，人们经常希望从[NodeJS](https://nodejs.org/)[`process.env`](https://nodejs.org/dist/latest-v14.x/docs/api/process.html#process_process_env)中读取环境变量（据我所知，其值始终是字符串）以启用或禁用某些行为，以及这些通常具有形式。`SOME_ENV_VAR=1`

```
const toBooleanSimple = (input) => 
  ['t', 'y', '1'].some(truePrefix => truePrefix === input[0].toLowerCase()); 
```

稍微更健壮和更具表现力的实现可能如下所示：

```
/**
 * Converts strings to booleans in a manner that is less surprising
 * to the non-JS world (e.g. returns true for "1", "yes", "True", etc.
 * and false for "0", "No", "false", etc.)
 * @param input
 * @returns {boolean}
 */
function toBoolean(input) {
  if (typeof input !== 'string') {
    return Boolean(input);
  }
  const s = input.toLowerCase();
  return ['t', 'y', '1'].some(prefix => s.startsWith(prefix));
} 
```

对此的（开玩笑）单元测试可能如下所示：

```
describe(`toBoolean`, function() {
  const groups = [{
    inputs: ['y', 'Yes', 'true', '1', true, 1],
    expectedOutput: true
  }, {
    inputs: ['n', 'No', 'false', '0', false, 0],
    expectedOutput: false
  }]
  for (let group of groups) {
    for (let input of group.inputs) {
      it(`should return ${group.expectedOutput} for ${JSON.stringify(input)}`, function() {
        expect(toBoolean(input)).toEqual(group.expectedOutput);
      });
    }      
  }
}); 
```

* * *

## 回答 #62

> 赞同：3
> 
> 时间：2021-09-30T19:01:13.430

如果 String 对象上有一个函数可以为我们执行此操作，那就太好了，但我们可以轻松添加自己的原型来扩展 String 对象。

在您使用它之前，将此代码添加到您的项目中的某处。

```
String.prototype.toBoolean = function() {
   return String(this.valueOf()).toLowerCase() === true.toString();
}; 
```

试试这样：

```
var myValue = "false"
console.log("Bool is " + myValue.toBoolean())
console.log("Bool is " + "False".toBoolean())
console.log("Bool is " + "FALSE".toBoolean())
console.log("Bool is " + "TRUE".toBoolean())
console.log("Bool is " + "true".toBoolean())
console.log("Bool is " + "True".toBoolean()) 
```

因此，原始问题的结果将是：

```
var myValue = document.myForm.IS_TRUE.value;
var isTrueSet = myValue.toBoolean(); 
```

* * *

## 回答 #63

> 赞同：2
> 
> 时间：2012-10-23T12:41:10.297

我一直在使用这个片段来转换数字和布尔值：

```
var result = !isNaN(value) ? parseFloat(value) : /^\s*(true|false)\s*$/i.exec(value) ? RegExp.$1.toLowerCase() === "true" : value; 
```

* * *

## 回答 #64

> 赞同：2
> 
> 时间：2013-02-28T00:27:15.080

基于上面 Steven 的回答，我编写了这个函数作为字符串输入的通用解析器：

```
parse:
  function (value) {
    switch (value && value.toLowerCase()) {
      case null: return null;
      case "true": return true;
      case "false": return false;
      default: try { return parseFloat(value); } catch (e) { return value; }
    }
  } 
```

* * *

## 回答 #65

> 赞同：2
> 
> 时间：2013-06-23T19:39:41.573

```
 MyLib.Convert.bool = function(param) {
         var res = String(param).toLowerCase();
         return !(!Boolean(res) || res === "false" || res === "0");
     }; 
```

* * *

## 回答 #66

> 赞同：2
> 
> 时间：2014-02-17T08:52:11.710

许多现有的答案都是相似的，但大多数都忽略了给定参数也可能是一个对象的事实。

这是我刚刚整理的东西：

```
Utils.parseBoolean = function(val){
    if (typeof val === 'string' || val instanceof String){
        return /true/i.test(val);
    } else if (typeof val === 'boolean' || val instanceof Boolean){
        return new Boolean(val).valueOf();
    } else if (typeof val === 'number' || val instanceof Number){
        return new Number(val).valueOf() !== 0;
    }
    return false;
}; 
```

...以及它的单元测试

```
Utils.Tests = function(){
    window.console.log('running unit tests');

    var booleanTests = [
        ['true', true],
        ['false', false],
        ['True', true],
        ['False', false],
        [, false],
        [true, true],
        [false, false],
        ['gibberish', false],
        [0, false],
        [1, true]
    ];

    for (var i = 0; i < booleanTests.length; i++){
        var lhs = Utils.parseBoolean(booleanTests[i][0]);
        var rhs = booleanTests[i][1];
        var result = lhs === rhs;

        if (result){
            console.log('Utils.parseBoolean('+booleanTests[i][0]+') === '+booleanTests[i][1]+'\t : \tpass');
        } else {
            console.log('Utils.parseBoolean('+booleanTests[i][0]+') === '+booleanTests[i][1]+'\t : \tfail');
        }
    }
}; 
```

* * *

## 回答 #67

> 赞同：2
> 
> 时间：2014-04-10T12:42:58.073

写这个的更短的方法可能是`var isTrueSet = (myValue === "true") ? true : false;`假设只有“真”是真的，其他值是假的。

* * *

## 回答 #68

> 赞同：2
> 
> 时间：2015-02-24T21:30:43.093

为了评估布尔值和类似布尔值的字符串，我使用了这个简单的公式：

```
var trueOrStringTrue = (trueOrStringTrue === true) || (trueOrStringTrue === 'true'); 
```

很明显，它会为 true 和 'true' 返回 true。其他一切都返回假。

* * *

## 回答 #69

> 赞同：2
> 
> 时间：2016-04-18T22:38:17.783

请注意，也许将来代码会更改并返回布尔值而不是此时的一个字符串。

解决方案是：

```
//Currently
var isTrue = 'true';
//In the future (Other developer change the code)
var isTrue = true;
//The solution to both cases
(isTrue).toString() == 'true' 
```

* * *

## 回答 #70

> 赞同：2
> 
> 时间：2020-06-03T14:36:05.557

**警告：** *切勿*将此方法用于不受信任的输入，例如 URL 参数。

您可以使用该`eval()`功能。直接将您的字符串传递给`eval()`函数。

```
console.log(eval('true'), typeof eval('true'))
console.log(eval('false'), typeof eval('false'))
```

* * *

## 回答 #71

> 赞同：2
> 
> 时间：2021-07-28T14:43:02.157

```
const boolTrue = JSON.parse("true")
const boolFalse = JSON.parse("false")

console.log(boolTrue) // true
console.log(boolFalse) // false
```

将字符串布尔值（如“true”）转换为实际的布尔值只是包装到`JSON.parse()` 示例：`JSON.parse("true")`

* * *

## 回答 #72

> 赞同：2
> 
> 时间：2021-08-23T18:15:29.843

Boolean(value) 的简写是 !!value，这是因为 ! 将值转换为与当前值相反的值，然后 ! 再次将其反转回原始形式。

* * *

## 回答 #73

> 赞同：1
> 
> 时间：2011-09-27T17:47:28.703

```
function returnBoolean(str){

    str=str.toString().toLowerCase();

    if(str=='true' || str=='1' || str=='yes' || str=='y' || str=='on' || str=='+'){
        return(true);
    }
    else if(str=='false' || str=='0' || str=='no' || str=='n' || str=='off' || str=='-'){
        return(false);
    }else{
        return(undefined);
    }
} 
```

* * *

## 回答 #74

> 赞同：1
> 
> 时间：2012-08-20T12:45:05.357

`Boolean.parse()`在某些浏览器实现中确实存在。它绝对不是通用的，所以如果这是你需要的东西，那么你不应该使用这种方法。但在 Chrome 中，例如（我使用的是 v21）它工作得很好，正如人们所期望的那样。

* * *

## 回答 #75

> 赞同：1
> 
> 时间：2013-06-05T10:45:48.823

您甚至不需要将字符串转换为布尔值。只需使用以下内容： `var yourstring = yourstringValue == 1 ? true : false;`

* * *

## 回答 #76

> 赞同：1
> 
> 时间：2016-03-14T11:50:29.203

从字符串或数字中获取布尔值这是一个很好的解决方案：

```
var boolValue = Boolean(Number('0'));

var boolValue = Boolean(Number('1')); 
```

第一个将返回`false`，第二个将返回`true`。

* * *

## 回答 #77

> 赞同：1
> 
> 时间：2017-02-14T07:52:57.757

```
var trueVals = ["y", "t", "yes", "true", "gimme"];
var isTrueSet = (trueVals.indexOf(myValue) > -1) ? true : false; 
```

甚至只是

```
var trueVals = ["y", "t", "yes", "true", "gimme"];
var isTrueSet = (trueVals.indexOf(myValue) > -1); 
```

类似于一些 switch 语句，但更紧凑。仅当字符串是 trueVals 字符串之一时，返回的值才会为真。其他一切都是假的。当然，您可能希望规范化输入字符串以使其小写并修剪任何空格。

* * *

## 回答 #78

> 赞同：1
> 
> 时间：2017-04-10T15:59:47.067

**将字符串转换为布尔值**

```
var vIn = "true";
var vOut = vIn.toLowerCase()=="true"?1:0; 
```

**将字符串转换为数字**

```
var vIn = 0;
var vOut = parseInt(vIn,10/*base*/); 
```

* * *

## 回答 #79

> 赞同：1
> 
> 时间：2019-10-20T06:16:59.357

我希望这是一个最全面的用例

```
function parseBoolean(token) {
  if (typeof token === 'string') {
    switch (token.toLowerCase()) {
      case 'on':
      case 'yes':
      case 'ok':
      case 'ja':
      case 'да':
      // case '':
      // case '':
        token = true;
        break;
      default:
        token = false;
    }
  }
  let ret = false;
  try {
    ret = Boolean(JSON.parse(token));
  } catch (e) {
    // do nothing or make a notification
  }
  return ret;
} 
```

* * *

## 回答 #80

> 赞同：1
> 
> 时间：2020-02-20T16:48:03.720

在 HTML 中，属性的值最终会变成字符串。为了在不希望的情况下减轻这种情况，您可以使用一个函数有条件地将它们解析为它们在 JavaScript 或任何其他感兴趣的编程语言中表示的值。

以下是从字符串类型恢复布尔类型的解释，但它也可以进一步扩展到其他数据类型，如数字、数组或对象。

除此之外 JSON.parse 有一个[revive 参数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Examples)，它是一个函数。它也可以用来实现相同的目的。

让我们称一个看起来像*boolean*的字符串"true" 是一个*boolean 字符串*，同样我们也可以称一个像数字的字符串 "1" 是一个*数字字符串*。然后我们可以确定一个字符串是否为*布尔字符串*：

```
const isBooleanString = (string) => ['true', 'false'].some(item => item === string); 
```

之后，我们需要通过方法将*布尔字符串*解析为 JSON `JSON.parse`：

```
JSON.parse(aBooleanString); 
```

但是，任何不是*布尔字符串*、*数字字符串*或任何字符串化对象或数组（任何无效 JSON）的字符串都将导致`JSON.parse`方法抛出`SyntaxError`.

因此，您将需要知道如何调用它，即它是否为*布尔字符串*。您可以通过编写一个使上述defiend*布尔字符串*检查并调用的函数来实现这一点`JSON.parse`：

```
function parse(string){
  return isBooleanString(string) ? JSON.parse(string)
    : string;
} 
```

人们可以进一步概括该实用程序，以便通过进一步参数化它以接受可接受的布尔字符串的可选数组来*更*`isBooleanString`广泛地了解什么是*布尔*字符串：

 *```
const isBooleanString = (string, spec = ['true', 'false', 'True', 'False']) => spec.some(item => item === string); 
```

* * *

## 回答 #81

> 赞同：1
> 
> 时间：2020-05-08T08:01:42.533

```
const result: Boolean = strValue === "true" ? true : false 
```

* * *

## 回答 #82

> 赞同：1
> 
> 时间：2020-05-31T15:26:53.980

# 使用`if`语句：

```
function parseBool(str) {
  if (str.toLowerCase() == 'true') {
    var val = true;
  } else if (str.toLowerCase() == 'false') {
    var val = false;
  } else {
    //If it is not true of false it returns undefined.//
    var val = undefined;
  }
  return val;
}
console.log(parseBool(''), typeof parseBool(''));
console.log(parseBool('TrUe'), typeof parseBool('TrUe'));
console.log(parseBool('false'), typeof parseBool('false'));
```

* * *

## 回答 #83

> 赞同：1
> 
> 时间：2020-07-22T19:49:27.593

你甚至不需要使用变量，如果你知道“真”总是小写，你可以使用它来返回真或假：

```
(eval(yourBooleanString == 'true')) 
```

* * *

## 回答 #84

> 赞同：1
> 
> 时间：2020-08-12T09:08:51.897

我认为它可以用一个使用箭头功能在 1 班轮中完成

```
const convertStringToBoolean = (value) => value ? String(value).toLowerCase() === 'true' : false; 
```

你们可以使用以下代码片段运行和测试各种案例

```
const convertStringToBoolean = (value) => value ? String(value).toLowerCase() === 'true' : false;

console.log(convertStringToBoolean("a"));
console.log(convertStringToBoolean(null));
console.log(convertStringToBoolean(undefined));
console.log(convertStringToBoolean("undefined"));
console.log(convertStringToBoolean(true));
console.log(convertStringToBoolean(false));
console.log(convertStringToBoolean(0));
console.log(convertStringToBoolean(1)); // only case which will not work
```

* * *

## 回答 #85

> 赞同：1
> 
> 时间：2020-12-02T17:46:42.510

最强的方法如下，因为它也处理未定义的情况：

```
 ({'true': true, 'false': false})[myValue]; 
```

```
 ({'true': true, 'false': false})[undefined] // => undefined
    ({'true': true, 'false': false})['true'] // => true
    ({'true': true, 'false': false})['false] // => false 
```

* * *

## 回答 #86

> 赞同：1
> 
> 时间：2020-12-30T19:27:34.583

如果您确定输入仅在“真”和“假”范围内，为什么不呢：

```
let x = 'true' ;
//let x = 'false';
let y = x === 'true' ? true : false;
console.log(typeof(y), y);
```

* * *

## 回答 #87

> 赞同：1
> 
> 时间：2021-02-04T11:28:48.557

```
function convertBoolean(value): boolean {
    if (typeof value == 'string') {
        value = value.toLowerCase();
    }
    switch (value) {
        case true:
        case "true":
        case "evet": // Locale
        case "t":
        case "e": // Locale
        case "1":
        case "on":
        case "yes":
        case 1:
            return true;
        case false:
        case "false":
        case "hayır": // Locale
        case "f":
        case "h": // Locale
        case "0":
        case "off":
        case "no":
        case 0:
            return false;
        default:
            return null;
    }
} 
```

* * *

## 回答 #88

> 赞同：0
> 
> 时间：2010-08-03T06:47:43.257

以下就足够了

```
String.prototype.boolean = function() {
    return "true" == this; 
};

"true".boolean() // returns true "false".boolean() // returns false 
```

* * *

## 回答 #89

> 赞同：0
> 
> 时间：2017-07-19T05:21:07.847

您可以使用从字符串`Function`返回值或`Boolean``"true"``"false"`

```
const TRUE_OR_FALSE = str => new Function(`return ${str}`)();

const [TRUE, FALSE] = ["true", "false"];

const [T, F] = [TRUE_OR_FALSE(TRUE), TRUE_OR_FALSE(FALSE)];

console.log(T, typeof T); // `true` `"boolean"`

console.log(F, typeof F); // `false` `"boolean"`
```

* * *

## 回答 #90

> 赞同：0
> 
> 时间：2017-08-01T22:56:20.523

`toBoolean' 函数为 null、undefined、''、'false' 返回 false。它为任何其他字符串返回 true：

```
const toBoolean = (bool) => {
  if (bool === 'false') bool = false
  return !!bool
}

toBoolean('false') // returns false 
```

* * *

## 回答 #91

> 赞同：0
> 
> 时间：2021-06-12T12:49:37.960

# ES6+

```
const string = "false"
const string2 = "true"

const test = (val) => (val === "true" || val === "True")
console.log(test(string))
console.log(test(string2))
```

* * *

## 回答 #92

> 赞同：-1
> 
> 时间：2020-10-29T16:49:00.210

`false`如果您需要布尔值和`true`字符串值，则简单的一行操作：

```
storeBooleanHere = stringVariable=="true"?true:false; 
```

*   storeBooleanHere - 此变量将保存布尔值
*   stringVariable - 将布尔值存储为字符串的变量

* * *

## 回答 #93

> 赞同：-4
> 
> 时间：2020-09-29T15:41:19.143

将字符串转换为布尔值的最简单方法如下：

```
Boolean(<stringVariable>) 
```

* * *

## 回答 #94

> 赞同：-5
> 
> 时间：2015-04-24T03:43:39.787

完美且非常简单：

```
var boolean = "false";
boolean = (boolean === "true");

//boolean = JSON.parse(boolean); //or this way.. 
```

测试它：

```
var boolean = "false";
boolean = (boolean === "true");

//boolean = JSON.parse(boolean); //or this way.. 

if(boolean == true){
    alert("boolean = "+boolean);
}else{
    alert("boolean = "+boolean);
}
```

* * *

## 回答 #95

> 赞同：-5
> 
> 时间：2021-05-01T14:50:10.887

// 尝试这两种方式将字符串转换为布尔值

```
 const checkBoolean = Boolean("false"); 
    const checkBoolean1 = !!"false";  

    console.log({checkBoolean, checkBoolean1}); 
```

* * *

## 回答 #96

> 赞同：-7
> 
> 时间：2020-11-04T21:24:35.880

[![将字符串转换为布尔值的可能方法](https://i.stack.imgur.com/TnPaA.png)](https://i.stack.imgur.com/TnPaA.png) 我建议您创建一个类似于图像中第三个选项的函数并将其作为导出放置在辅助类中，并在需要时重用此函数。

* * *

## 回答 #97

> 赞同：-24
> 
> 时间：2010-01-22T00:22:38.867

只需做一个：

```
var myBool = eval (yourString); 
```

例子：

```
alert (eval ("true") == true); // TRUE
alert (eval ("true") == false); // FALSE
alert (eval ("1") == true); // TRUE
alert (eval ("1") == false); // FALSE
alert (eval ("false") == true); // FALSE;
alert (eval ("false") == false); // TRUE
alert (eval ("0") == true); // FALSE
alert (eval ("0") == false); // TRUE
alert (eval ("") == undefined); // TRUE
alert (eval () == undefined); // TRUE 
```

此方法自然地处理空字符串和未定义字符串，就好像您声明一个变量而不给它赋值一样。

# java - 如何将 NetBeans .form 文件转换为 .java？

> ID：263968
> 
> 赞同：2
> 
> 时间：2008-11-05T00:15:25.853
> 
> 标签：java, forms, netbeans, matisse

在不使用 NetBeans IDE 本身的情况下，将 NetBeans (Matisse) .form 文件转换为 .java 文件的最佳方法是什么？理想情况下，我想将 .form 文件与我的源代码一起打包，并在构建时生成 .java 文件。这将防止开发人员“意外”使用其他 IDE 将代码添加到生成的 .java 文件中，这样下次在 GUI 设计器中编辑表单本身时，NetBeans 可能会覆盖这些代码。

我搜索了谷歌，我只能找到人们说“使用 NetBeans IDE 生成 .java 文件”，这在构建时很难做到。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T10:04:54.480

Well, actually having to fight with "accidental" addition of codes is more a problem of process rather than a problem with technology. My steps would be:

1.  Prevent committing the generated .java files in the CVS/SVN repository
2.  Embed matisse form generation in a continuous integration project.

For step 1: Use a sensible naming convention and stick with the standard for all the gui object, e.g.: put all the forms inside a common package and use the .svnignore directive on java files in it.

For step 2: Fabrizio Giudici has a nice tutorial on how to build a netbeans project (yes using matisse) inside a continuous integration environment.

[http://weblogs.java.net/blog/fabriziogiudici/archive/2006/11/setting_up_netb.html](http://weblogs.java.net/blog/fabriziogiudici/archive/2006/11/setting_up_netb.html)

Note that he talks about installing netbeans first on a machine with a gui then moving the jar files in an headless machine. IIRC it was possible to install Netbeans version 4.x in an headless environment without using the gui (since it is a java application, the only steps to do were to unzip the files and create a sensible shell file launching the application with the correct jvm/classpath combo).

Anyway, if you can't enforce both rules, or you can't find how to generate the matisse artifacts in the CI server, consider the possibility to scrap the use of matisse entirely.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-24T12:47:25.663

*   *从Netbeans*复制代码并将其粘贴到*JCREATOR*中。
*   保存文件。
*   如果它需要任何名称，请写下您在*Netbean*中创建的类的名称。
*   保存。
*   *在JCREATOR*中运行代码。
*   它会自动将您的文件转换为`.java`和`.class`.
*   玩得开心，欢呼。

# cocoa - NSColor 和 NSGradient 作为属性 - 有什么理由复制吗？

> ID：263977
> 
> 赞同：4
> 
> 时间：2008-11-05T00:18:51.213
> 
> 标签：cocoa, macos

我非常熟悉想要复制属性与保留的原因。（本质上是价值与关系的论点。例如，您几乎总是想复制字符串。）

NSColor 和 NSGradient 呢？

它们都符合 NSCopying，但正如当前实现的那样，它们是不可变的。

想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T00:29:32.130

不可变对象通常将它们的`copyWithZone:`方法实现为`return [self retain]`，因为如果数据永远不会改变，那么制作单独的数据副本是没有意义的。但是，他们仍然需要实现该方法，以与任何期望 NSCopying 一致性的东西（例如 NSDictionary 键）兼容。

至于使用，我会坚持使用与其他“值”属性相同的使用模式，并且您不会看到任何性能差异，因为它们很可能会`retain`从任何地方调用`copy`。这也涵盖了诸如添加具有非平凡的 NSCopying 实现的可变子类之类的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-05T00:25:23.230

分配给您的属性的 NSColor 和 NSGradient 的子类可能不是不可变的或引用透明的，因此您仍然应该使用与任何具有常用可变子类的对象相同的逻辑来确定保留与复制，即使在实践中它大多数情况下不太重要。

# algorithm - 与非开发人员的跨学科算法构建

> ID：263978
> 
> 赞同：2
> 
> 时间：2008-11-05T00:19:30.650
> 
> 标签：algorithm, requirements, scientific-computing

是的，我知道标题是一个拗口...

我的意思是说你如何与需要理论编码和测试的主题专家沟通？

例如，天气模拟是气象学家、计算机科学家和软件工程师之间的合作。计算机科学家和软件工程师通常说同一种语言，但气象学家却处于完全不同的世界。

您如何提高学科之间的交流和理解水平？不一定只适用于天气，其他科学也是如此。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T00:24:03.280

最短的答案是持续的客户参与。

所有漂亮的 UML 图、绘儿乐 UI 模型、对四岁孩子的解释和其他技术永远不会提供使用工作应用程序的完整体验。将消费者保持在循环中允许对客户以及从客户到您的反馈周期。这种共生关系最有可能生产出对他们有用的产品。

如果您进入一个盒子并拿出您认为他们需要的产品，那很可能是他们不想要的很多东西。通过定期演示您的产品，您可以限制任何误解的影响，这样您就不会花太多时间走错路。

它可以与航位推算相提并论。如果你蒙上自己的眼睛并试图在你熟悉的区域中导航，那么你所在的位置和你认为自己所在的位置之间的误差会随着时间的推移而累积。但是，如果您定期摘下眼罩，您可以更新您的心理位置。仍然会有一个错误因素，但您正在消除累积的错误因素。

即使您认为您的沟通/解释能力是一流的，您仍然必须考虑他们沟通方式中的错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T01:07:38.650

**状态图为**这项任务创造了奇迹。它们允许您在适合与您交流的人的级别上表示计算过程。各州对那里进行的处理有一个简短的评论。状态之间的弧线显示了导致转换到新状态的条件。

构建了基本状态图后，您可以继续讨论输入状态机的信息。这是个人领域知识应该发挥作用的地方。通过图表跟踪一些数据以查看其处理流程。通常在这一点上，他们开始注意到尚未讨论的其他情况。

可能需要拖入另一个白板，将一个或多个状态展开为自己的状态图。

然后通常，当他们对流程感到满意时，就该将错误处理注入图表中了。

这种技术对我来说效果很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T04:43:56.373

我一直发现流程图是普遍可以理解的，尤其是在表示算法时。流程图通常易于阅读和制作，并且被普遍理解。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T01:04:52.587

“最短的答案是持续的客户参与。”

我建议你通过一些具体的方法来做到这一点。

1.  一种可以快速发展的语言。Python 是我的选择，你的可能会有所不同。Java——例如——可能不会在你的列表中排名靠前，因为它需要一段时间才能让东西运行起来。对于快速开发，C++ 可能需要付出太多努力。

2.  快速构建小东西。从可以开始对话的东西开始——任何东西——。构建、审查、扩展。

3.  使用单元测试将结果形式化，使您能够尽早且经常地进行重构。

一旦你有了可靠的东西，你可以考虑用 Java 或 C++ 重写或其他东西来提高性能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-14T22:39:43.710

我认为大多数评论者所缺少的实际上对您的问题非常重要 - 您正在与领域专家合作构建他们的模型的实现以测试他们的理论的想法。

大多数软件工程的东西都不是关于这种制度的——就像你说的那样，这与实现一些业务流程或构建一个必须实现 RFCxxxx 的服务器在质量上是不同的。

有人在这方面工作——试图向科学家传授负责任的软件工程的基础知识（例如，Greg Wilson 的[Software Carpentry](http://software-carpentry.org/ "软件木工")）和向软件工程人员传授有关大规模计算科学的知识（例如，Steve Easterbrook 的[非常有趣的博客](http://www.easterbrook.ca/steve/ "机缘巧合")，这与[此](http://www.easterbrook.ca/steve/?p=1999)特别相关）。我不知道为什么事情在这方面如此原始。两者在他们的博客上都有相关同事的链接。

这个制度与你可能学过的东西有许多重要的区别。其一，科学软件的整体结构一般都比较简单，但精妙之处相当高——每一行数字都可能是多个领域10年科学文献的结晶。其次，规范的整个想法有点被颠覆了——规范是“准确地模拟现实”，而科学家所拥有的是他们希望这样做的模型。在某种程度上，科学代码开发既是在实施规范草案，也是在摸索真正的规范。

@vfilby 有一个正确的想法——持续的客户参与——但不止于此。为此，您将进入科学循环 - 而不是科学家→理论→测试→解释→更新理论的循环，它将是科学家→理论→您编码→您和科学家*都*解释您自己的部分→更新理论和/或实施。领域科学家不会像您一样了解如何最好地实现他们想要的东西，或者如何将他们的模型结果与您的模型实现结果分开；另一方面，他们会比你更好地理解模型的含义以及如何更新理论。

这是一个很难平衡的行为。为了让它发挥作用，双方都必须（a）尊重对方的专业领域，（b）学习一些其他领域的知识，以及（c）在整个项目中投入工作。这类跨学科项目失败的次数多于成功的次数，但它们至关重要。我*真的*希望我有一些简单的，保证工作的技巧给你。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-14T17:40:51.240

充当程序员，并使用“可能的最松耦合”方法。

对于气象学家的案例，我对这个领域略知一二，气象学家和程序员几乎没有就实际代码进行交流。那些程序员知道足够的数学来实现气象学家想要的任何方程，然后气象学家足够怪才可以使用该软件。

我还可以将交易员与量化人员与程序员的案例联系起来，这更糟……

他们不讨论气象学，也不讨论代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T14:04:50.327

我在 Weiger 的东西上取得了很好的成功：http: [//www.processimpact.com/reqs_book/reqs_book.shtml](http://www.processimpact.com/reqs_book/reqs_book.shtml)

首先做一个愿景和范围文件： http: [//www.processimpact.com/pubs.shtml#requirements](http://www.processimpact.com/pubs.shtml#requirements)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-03T14:18:51.447

你应该经常问自己，“我将如何向市场上的那个老奶奶解释这一点？”。一旦你掌握了这些，你就可以向几乎任何人谈论和解释你的方法和程序。如果他们有一些额外的知识，那就更好了。

如果你不能，那么也许你应该问自己“也许问题不在他们这边。”。即使是站在他们这边，尝试理解他们的观点也没有什么坏处。

就个人而言，我不是一名程序员，但只要我们都坚持上述原则，与程序员交谈从来没有任何问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-05T00:40:22.373

非常小心和耐心。你不能假设理解，所以使用原型或图片等技术进行交流。

当客户发表声明时，您需要执行您认为他所说的内容，或者画出图片并展示给他。这样他更容易认清你的误解。我会避免冗长的书面描述，因为很难知道你是否理解。

客户不需要懂你的语言，所以不要试图教气象学家 CS 术语。你需要学习他的语言。即使是最微不足道的需求也应该使用原型进行测试。如果他们说：“我们需要看美国的地图”，那么你需要画一张美国的地图给他们看，然后说“这就是你想看的”吗？然后他会说“但我在这张地图上看不到密西西比河”然后你说“但你没有要求河流”然后回去重新绘制地图。等等等等

我曾经遇到过要求简单得多的情况，但出现了可怕的错误，因为客户认为它很简单，而我认为我理解。

# java - 正则表达式问题 - 引号括起来的文本块之外的一个或多个空格

> ID：263985
> 
> 赞同：2
> 
> 时间：2008-11-05T00:24:19.067
> 
> 标签：java, regex, quotes

我想用一个空格替换任何出现的多个空格，但在引号之间的文本中不采取任何操作。

有没有办法用 Java 正则表达式做到这一点？如果是这样，您可以尝试一下或给我一个提示吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T06:42:29.427

这是另一种方法，它使用前瞻来确定当前位置之后的所有引号都成对出现。

```
text = text.replaceAll("  ++(?=(?:[^\"]*+\"[^\"]*+\")*+[^\"]*+$)", " "); 
```

如果需要，可以调整前瞻以处理引用部分内的转义引号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T00:54:02.860

当尝试匹配可以包含在其他内容中的内容时，构造一个匹配两者的正则表达式会很有帮助，如下所示：

```
("[^"\\]*(?:\\.[^"\\]*)*")|(  +) 
```

这将匹配带引号的字符串或两个或多个空格。因为这两个表达式组合在一起，所以它将匹配带引号的字符串或两个或多个空格，但不匹配引号内的空格。使用此表达式，您将需要检查每个匹配项以确定它是带引号的字符串还是两个或多个空格并采取相应的措施：

```
Pattern spaceOrStringRegex = Pattern.compile( "(\"[^\"\\\\]*(?:\\\\.[^\"\\\\]*)*\")|(  +)" );

StringBuffer replacementBuffer = new StringBuffer();

Matcher spaceOrStringMatcher = spaceOrStringRegex.matcher( text );

while ( spaceOrStringMatcher.find() ) 
{
    // if the space group is the match
    if ( spaceOrStringMatcher.group( 2 ) != null ) 
    {
        // replace with a single space
        spaceOrStringMatcher.appendReplacement( replacementBuffer, " " );
    }
}

spaceOrStringMatcher.appendTail( replacementBuffer ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T00:44:27.387

引号之间的文字：引号是在同一行还是多行？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T00:58:29.230

标记它并在标记之间发出一个空格。“处理引号的java标记器”的快速谷歌出现了： [这个链接](http://www.koders.com/java/fid8C21DD2469686C91A0A2E6F25C36DFB659D267DB.aspx?s=file:semap*.java)

YMMV

编辑：所以不喜欢那个链接。这是谷歌搜索链接：[google](http://www.google.com/search?rlz=1C1CHMP_enUS291&sourceid=chrome&ie=UTF-8&q=java+tokenizer+that+handles+quotes)。这是第一个结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T01:28:40.077

就个人而言，我不使用 Java，但这个 RegExp 可以解决问题：

```
([^\" ])*(\\\".*?\\\")* 
```

尝试使用 RegExBuddy 的表达式，它会生成此代码，对我来说看起来不错：

```
try {
    Pattern regex = Pattern.compile("([^\" ])*(\\\".*?\\\")*", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);
    Matcher regexMatcher = regex.matcher(subjectString);
    while (regexMatcher.find()) {
        for (int i = 1; i <= regexMatcher.groupCount(); i++) {
            // matched text: regexMatcher.group(i)
            // match start: regexMatcher.start(i)
            // match end: regexMatcher.end(i)

            // I suppose here you must use something like
            // sstr += regexMatcher.group(i) + " "
        }
    }
} catch (PatternSyntaxException ex) {
    // Syntax error in the regular expression
} 
```

至少，它似乎在 Python 中运行良好：

```
import re

text = """
este  es   un texto de   prueba "para ver  como se comporta  " la funcion   sobre esto
"para ver  como se comporta  " la funcion   sobre esto  "o sobre otro" lo q sea
"""

ret = ""
print text  

reobj = re.compile(r'([^\" ])*(\".*?\")*', re.IGNORECASE)

for match in reobj.finditer(text):
    if match.group() <> "":
        ret = ret + match.group() + "|"

print ret 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-05T05:12:24.163

解析出引用的内容后，根据需要在其余部分上批量或逐个运行：

```
String text = "ABC   DEF GHI   JKL";
text = text.replaceAll("( )+", " ");
// text: "ABC DEF GHI JKL" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T06:14:35.427

杰夫，你在正确的轨道上，但你的代码中有一些错误，也就是说：（1）你忘记在否定字符类中转义引号；（2）第一个捕获组内的parens应该是非捕获品种；(3) 如果第二组捕获括号不参与匹配，则`group(2)`返回 null，并且您没有对此进行测试；(4) 如果您在正则表达式中测试**两个或多个**空格而不是*一个或多个*，则无需稍后检查匹配的长度。这是修改后的代码：

```
import java.util.regex.*;

public class Test
{
  public static void main(String[] args) throws Exception
  {
    String text = "blah    blah  \"boo   boo boo\"  blah  blah";
    Pattern p = Pattern.compile( "(\"[^\"\\\\]*(?:\\\\.[^\"\\\\]*)*\")|(  +)" );
    StringBuffer sb = new StringBuffer();
    Matcher m = p.matcher( text );
    while ( m.find() ) 
    {
      if ( m.group( 2 ) != null ) 
      {
        m.appendReplacement( sb, " " );
      }
    }
    m.appendTail( sb );
    System.out.println( sb.toString() );
  }
} 
```

# .net - 如何从网络驱动器获取在 Delphi 下运行的 .NET 程序集？

> ID：263987
> 
> 赞同：3
> 
> 时间：2008-11-05T00:24:42.233
> 
> 标签：.net, delphi, com, interop, permissions

[我有一个 Delphi 5 可执行文件，它通过免费的Delphi .NET](http://sourceforge.net/projects/delphinet/)代码调用 .NET 程序集，而且在大多数情况下，这很好用。但是，我的应用程序的要求之一是我们的客户能够从网络共享以及本地使用它。在我的测试机器上，我无法让它工作，我只是收到一条错误消息。.NET 代码将其权限设置为完整，但又出现了一些错误，Delphi 似乎无法获取或解释。在本地驱动器上，应用程序和程序集可以完美通信。

谁能告诉我如何至少从中获取错误消息？或者如果可能的话，谁能告诉我为什么我会这样出错？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-05T00:29:39.150

您说您已授予代码完全权限，但您是否已将 FullTrust 分配给网络共享？在 .NET 中，网络共享是本地 Intranet 域的一部分，因此您会失去一些信任。运行类似的东西；

```
CasPol.exe -m -ag 1.2 -url file://\\ShawnFa-Srv/Tools/* FullTrust 
```

有关更多信息，请参阅有关该主题的这篇文章，[使用 CasPol 完全信任共享](http://blogs.msdn.com/shawnfa/archive/2004/12/30/344554.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T00:59:45.423

更新到 .NET 3.5 SP 1。这[消除了本地 Intranet 和本地 HDD 上的文件之间的区别](http://blogs.msdn.com/vancem/archive/2008/08/13/net-framework-3-5-sp1-allows-managed-code-to-be-launched-from-a-network-share.aspx ".NET Framework 3.5 SP1 允许从网络共享启动托管代码！")WRT 代码访问安全性（包括 2.0 程序集）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T00:47:59.580

是的，我已完全信任该份额。这就是我所说的完全权限的意思，我已经习惯了向非技术人员解释它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-06T21:58:47.160

好的，我在重新审视 CasPol 和 .NET Framework 配置实用程序（实用程序）之间的差异以及它们各自的工作方式时找到了答案。这可能有点长，因为我在这里为自己以及其他有相同问题但未完成该过程的人（就像我一开始没有完成）。

当我第一次尝试 CasPol，然后是实用程序时，我没有意识到我需要将新记录输入到现有的“区域”部分，并尝试将其作为主“所有代码”部分下的新部分输入。将其移动到 Intranet 区域让代码运行。

我尝试过的另一个地方是安装 .NET Framework 3.5，但失败了，因为我错过了我没有安装 SP1。将 SP1 安装到测试机器也解决了这个问题。这种方法是我的老板决定我们要使用的，因为它最大限度地减少了我们与客户的 IT 人员之间的互动。

感谢你们俩的帮助。我很珍惜时间。

# .net - 如何从实体框架中删除关系

> ID：263992
> 
> 赞同：6
> 
> 时间：2008-11-05T00:26:36.707
> 
> 标签：.net, entity-framework

我不想在我的 edmx 实体框架中包含关系，我想让外键字段作为我的实体中的普通属性。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2016-03-01T12:35:11.283

如果您想要数据库中的普通外键，那么您使用的是错误的外键。据我所知，实体框架确保所有那些晦涩的 id 都被丢弃并替换为指向您需要的实体的指针。如果您真的想要这些外键，那么您应该查看不同的数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T12:21:07.790

[http://www.thedatafarm.com/blog/2007/09/11/EntityDataModelAssociationsWheresMyForeignKey.aspx](http://www.thedatafarm.com/blog/2007/09/11/EntityDataModelAssociationsWheresMyForeignKey.aspx)

I found the article describing the error in our ways... basically we never supposed to be querying tables via foreign keys instead take a bit more relational approach

```
(From o In nw.Orders 
 Where o.OrderID = 10281 
 Select o.Customers
).First 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T13:24:52.763

我认为您正在尝试访问一个表，说`Contact`其中有一个外键`SubscriberId`，现在说您想添加一个`Contact`带有外键 1 的表，例如下面的示例，而不是破解 edmx。

```
using (BulkSmsEntities ctx = new BulkSmsEntities())
{
    int SubscriberId = 1;
    tb_contact contact = new tb_contact();
    contact.tb_subscriber = ctx.tb_subscriber
        .First(a => a.SubscriberId == SubscriberId);
    ctx.AddTotb_subscriber_contacts(contact);
    ctx.SaveChanges();
} 
```***