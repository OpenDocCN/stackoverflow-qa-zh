# StackOverflow 问答 000326000-000326999

# iis - 创建 FTP 托管服务器网站？

> ID：326009
> 
> 赞同：0
> 
> 时间：2008-11-28T15:18:48.810
> 
> 标签：iis, ftp, hosting

我最近为我们公司购买了一个新的网络服务器 2008 并需要一个 FTP 托管站点，该站点允许客户从我们的服务器上传文件和托管网站，该站点必须内置购物篮/每月费率。如果我购买了正确的模板，专为托管而设计，我如何让它独立地与 Web 服务器一起工作？（例如创建子域、用户目录等）服务应该和这个链接完全一样： https: [//www.godaddy.com](https://www.godaddy.com)

我有所有的设备和软件我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T20:28:04.163

我不是有意冒犯，但听起来你在**这里**有点过头了。

从它的声音来看，托管网站不是您公司的主要业务。如果您是负责设置托管服务的人，并且您在这里问“我如何设置 GoDaddy 克隆？”，最终结果*会让客户非常沮丧*。

坚持你的核心竞争力，或者至少聘请一个以前做过这种事情的专业人士。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T15:33:20.607

您花费大量时间和金钱开发以潜在客户会去其他地方的方式提供该功能的软件。

您可以安装 CPanel 等软件，使管理服务器功能变得更加容易。您可以尝试第三方购物篮软件，但您可能会发现它对于您的特定需求来说太通用了，而且无论如何都需要进行集成软件开发。

# hibernate - 如何在 java 中使用库 org.hibernate？

> ID：326010
> 
> 赞同：0
> 
> 时间：2008-11-28T15:19:24.693
> 
> 标签：hibernate, netbeans

我在 Netbeans 中创建了新项目，但是当我查看它仍然使用 JDK 1.6（默认）的库时，我想更改为 JDK 6 Update 10 但是如何？我已经安装了 JDK 6 Update 10，但是当我导入 org.hibernate 时，neatbeans 不知道 org.hibernate 是哪个库。

有人可以帮助我吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T16:32:58.677

在 Netbeans 中，您可以从工具 > Java 平台定义一个新的 Java 平台。这带来了平台管理器。此时您可以单击“添加平台”按钮并浏览到新平台的位置。然后，您将设置多个平台，您可以配置每个项目以使用适当的平台。

要添加休眠库，您可以转到工具 > 库并单击“新建库”。然后浏览到 Hibernate jar 文件的位置。

然后，每个项目都可以通过右键单击项目浏览器中的库链接并单击“添加库”来添加新库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T15:29:52.080

JDK 1.6 是当前发布的版本。

我真的希望你不是在那里谈论 Java 10。

如果您想使用 Java 1.1，情况会更糟！这是 10 多年前推出的。

# lucene.net - Lucene.Net 功能

> ID：326015
> 
> 赞同：2
> 
> 时间：2008-11-28T15:21:22.363
> 
> 标签：lucene.net

Lucene.Net 新手 Lucene.Net 中最好使用的分析器是哪个？另外，我想知道如何使用停用词和词干功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T12:22:28.510

我也是 Lucene.Net 的新手，但我知道 Simple Analyzer 会省略任何停用词，并索引所有标记/作品。

这是一些 Lucene 信息的链接，顺便说一下，.NET 版本是 Java 版本的几乎完美的逐字节重写，因此 Java 文档在大多数情况下应该可以正常工作：http: [//darksleep.com /lucene/](http://darksleep.com/lucene/) . 里面有一个关于三个分析器的部分，简单、停止和标准。

我不确定 Lucene.Net 如何处理词干，但是这个链接[http://www.onjava.com/pub/a/onjava/2003/01/15/lucene.html?page=2](http://www.onjava.com/pub/a/onjava/2003/01/15/lucene.html?page=2)演示了如何在 Java 中创建自己的分析器，并使用 PorterStemFilter 进行词干提取。

> ...[T]波特词干算法（或“波特词干分析器”）是一种从英语单词中删除更常见的形态和屈折词尾的过程

我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-06T09:48:45.363

我发现的最好的分析器是 StandardAnalyzer，您也可以在其中指定停用词。例如 ：-

```
 string indexFileLocation = @"C:\Index";
        string stopWordsLocation = @"C:\Stopwords.txt";
        var directory = FSDirectory.Open(new DirectoryInfo(indexFileLocation));
        Analyzer analyzer = new StandardAnalyzer(
            Lucene.Net.Util.Version.LUCENE_29, new FileInfo(stopWordsLocation)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-12-30T21:10:41.513

这取决于您的要求。如果您的要求非常简单——例如不区分大小写、非词干搜索——那么 StandardAnalyzer 是一个不错的选择。如果您查看 Analyzer 类并熟悉过滤器，特别是[TokenFilter](https://lucenenet.apache.org/docs/3.0.3/d4/dcd/class_lucene_1_1_net_1_1_analysis_1_1_token_filter.html)，您可以通过滚动您自己的分析器来对索引进行 [大量控制。](http://www.alessandrocolla.com/write-a-custom-lucene-net-tokenfilter/)

词干很棘手，深入了解您真正需要的词干类型很重要。我使用了 Snowball 词干分析器。例如，单词“policy”和“police”在英语 Snowball 词干分析器中具有相同的词根，并且当搜索词“police”不那么热门时，会在具有“policy”的文档中获得命中。我已经实施了支持词干搜索和非词干搜索的策略，因此可以避免这种情况，但了解其影响很重要。

谨防诸如停用词之类的诱惑。如果您需要搜索短语“to be or not to be”并且启用了标准停用词，则您的搜索将无法找到包含该短语的文档。

# javascript - 选项卡的 Dojo 参数

> ID：326048
> 
> 赞同：2
> 
> 时间：2008-11-28T15:36:21.583
> 
> 标签：javascript, api, dojo

我在使用 Dojo 文档时遇到了问题（像往常一样）。
在他们的[TabContainer API](http://api.dojotoolkit.org/jsdoc/dijit/1.2/dijit.layout.TabContainer)上，他们将第二个参数列为一个名为“params”的对象，但他们从不说你可以在这个 params 对象中实际放入什么。我可以指定宽度吗？高度？我是否指定要成为容器内选项卡的 div 的 ID？

如果我想指定要由 Dojo 解析器解析的选项卡容器，也没有指定在 HTML 中放入哪些属性。我找到了以下示例，可以让您放置标题、选定和可关闭选项。还有别的事吗？

```
<div id="tabA1" dojoType="dijit.layout.ContentPane" title="First Tab"  selected="true" closable="true">
        First Tab
    </div>
    <div id="tabA2" dojoType="dijit.layout.ContentPane" title="Second Tab" closable="true">
        Second Tab
    </div>
    <div id="tabA3" dojoType="dijit.layout.ContentPane" title="Third Tab" closable="true">
        Third Tab
    </div>
</div> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-28T18:33:42.257

我不是 Dojo 小部件方面的专家，但这是我所知道的：

1.  所有 Dojo 小部件构造函数都有签名：

    var widget = new Widget(params, node);

2.  发现参数的最好方法是查看源代码——不要害怕，它们会在相关类的开头记录为变量。

3.  使用小部件的名称通常很容易找到相关文件，因为它们是由它们的路径命名的。

4.  查找这些内容的最佳方法是使用 Dojo 结帐和您最喜欢的文本编辑器。但[夜间结账](http://archive.dojotoolkit.org/nightly/dojotoolkit/)也有效（如果你跟着行李箱走）。或[Trac 源代码浏览器](http://bugs.dojotoolkit.org/browser/dijit/trunk/)。

5.  不要低估查看测试和演示的力量。

示例：dijit.layout.TabContainer ⇒ [dijit/layout/TabContainer.js](http://bugs.dojotoolkit.org/browser/dijit/trunk/layout/TabContainer.js)。如果文件丢失，请查看 _base.js 的层次结构目录或一些类似的文件——后者可以将相关的类捆绑在一起。但在大多数情况下（例如使用 TabContainer），您会立即找到它。我们去看看。

类的顶部有两个公开的文档参数：

*   tabPosition — 字符串。定义选项卡相对于选项卡内容的位置。“顶部”、“底部”、“左-h”、“右-h”。默认值：“顶部”。
*   tabStrip — 布尔值。定义 tablist 是否获得额外的布局类。默认值：假。
*   _controllerWidget - 忽略它，没有公共参数以下划线开头 - 这是指定受保护成员的常见 JavaScript 约定。

但这还不是全部。TabContainer 基于[dijit.layout.StackContainer](http://bugs.dojotoolkit.org/browser/dijit/trunk/layout/StackContainer.js)（只需查看 dojo.declare() 标头）。我们也可以使用 StackContainer 的公共参数：

*   doLayout — 布尔值。如果为真，请更改我当前显示的孩子的大小以匹配我的大小。默认值：真。
*   坚持——布尔值。跨会话记住选定的孩子。默认值：假。

正如您所看到的，代码和参数都有很好的文档记录，但并不总是反映在 API 工具中。现在我们可以放心地创建标签容器了。

但让我们先看看它的实际效果。所有 Dijit 测试始终位于[dijit/tests](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/)中。任何 dijit.layout.* 小部件都将在[dijit/tests/layout](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/)中进行测试。相关的测试文件将被命名为 test_TabContainer.html，实际上我看到了 5 个文件：

*   [test_TabContainer.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/test_TabContainer.html)。
*   [test_TabContainer_noLayout.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/test_TabContainer_noLayout.html)。
*   [test_TabContainer_prog.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/test_TabContainer_prog.html)。
*   [test_TabContainer_remote.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/test_TabContainer_remote.html)。
*   [test_TabContainerTitlePane.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/test_TabContainerTitlePane.html)。

例如，让我们重新创建[test_TabContainer.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dijit/tests/layout/test_TabContainer.html)的第一个 TabContainer ：

```
var tc = new dijit.layout.TabContainer(
  {persist: true, tabStrip: true}, "mainTabContainer"); 
```

或者我们可以像在测试内联中那样做：

```
<div id="mainTabContainer" dojoType="dijit.layout.TabContainer"
    persist="true" tabStrip="true" style="width: 100%; height: 20em;">
  ...
</div> 
```

回到你原来的问题：现在你可以看到宽度和高度被简单地指定为样式，没有特殊属性，没有什么花哨的，只是一些直观的 C​​SS。因此，如果您想以编程方式执行此操作，只需在创建 TabContainer 的新实例之前将它们设置在节点上即可。

是的，我希望 API 文档也能获得所有这些小细节，但是整个设置很直观，并且相关部分都记录在文件中。我们确实去了源代码，但我们并没有试图破译源代码，只是阅读了类顶部的人类可读的注释。

# grails - 如何在 Grails 中按多个字段排序？

> ID：326053
> 
> 赞同：41
> 
> 时间：2008-11-28T15:38:17.853
> 
> 标签：grails, sql-order-by, grails-orm

有没有办法获得按两个字段排序的列表，比如姓氏和名字？

我知道`.listOrderByLastAndFirst`并且`.list(sort:'last, first')`不会工作。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-10-27T21:12:18.677

[Hates_](https://stackoverflow.com/a/326152/2521769)标准答案似乎对我不起作用；整理`"last,first"`只会导致异常说，`"Property 'last,first' not found"`。要对两个字段进行排序，您可以执行以下操作：

```
def c = MyDomain.createCriteria()
def results = c.list {
    and{
       order('last','desc')
       order('first','desc')
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-09-02T00:45:44.340

这已经很老了，但帮助我找到了合适的解决方案。使用 withCriteria 快捷方式的“更简洁”代码示例：

```
def c = MyDomain.withCriteria {
    and {
        order('last', 'desc')
        order('first', 'desc')
    }
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-28T16:17:52.873

**这个旧的解决方案不再有效。请参阅下面的mattlary答案**

您可能必须在 HQL 中编写自定义查找器或使用 Criteria Builder。

```
MyDomain.find("from Domain as d order by last,first desc") 
```

或者

```
def c = MyDomain.createCriteria()
def results = c.list {
       order("last,first", "desc")
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-09-12T12:37:57.490

更复杂的排序标准，（在 Grails 2.1.0 中测试）

```
def c = MyDomain.withCriteria {
    property {
        order('last', 'desc')
    }
    order('first', 'desc')
} 
```

首先按 MyDomain.property.last 排序，然后按 MyDomain.first

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-30T13:33:21.830

我认为标准是最好的选择，但是您首先尝试查找器是正确的。从 GORM 检索域对象时，尝试的正确顺序是：动态查找器、条件、HQL。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-11-04T05:06:04.733

此查询是在第一个字段的基础上工作的。当第一个字段为空白时，它会被第二个字段短接。

```
order('last','desc')
order('first','desc') 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-05-29T04:45:03.927

你可以这样做

```
def results=MyDomain.findAll([sort:"last",order:'desc'],[sort:"first",order:'desc']); 
```

这行代码将首先按姓氏对域类“MyDomain”的结果进行排序，然后按人的名字排序。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-05-04T11:39:20.277

```
MyDomain.findAll(sort: ['first': 'desc','last':'desc']) 
```

适用于 grails-datastore-gorm:6.0.3

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-28T16:17:18.960

如果您要根据项目的内容对列表进行排序，则需要实现一个比较器，该比较器具有一些智能功能，可以让您根据多个属性决定排序顺序。

[这里](http://devambling.taragin.com/2008/11/groovy-sort-follow-up_05.html)展示了一些 Groovy 风格的比较器示例

但是，如果您正在排序的列表是从数据库查询返回的，那么您最好使用 CrteriaQuery 对其进行排序并对其进行排序

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-07-05T15:13:48.080

我有同样的问题。由于我的列表不是那么大，我使用常规排序，因为我想对链接域的字段进行排序：CalendarData -> Attraction

```
def listCalendar (Calendar calendar) {
    respond CalendarData.where {
        calendar == calendar
    }.list().sort{ "$it.attraction.type?:' '$it.attraction.name" }
} 
```

# javascript - 如何使用 JavaScript 创建一个小部件

> ID：326058
> 
> 赞同：-4
> 
> 时间：2008-11-28T15:40:04.633
> 
> 标签：javascript, ajax, widget

我真的不知道如何描述它，但如果你理解它并在该领域有经验，也许你可以帮助我做一些“开源”和“现成”的事情。

我想创建一个类似于框“或小部件”的东西，您可以通过点击框顶部的一些按钮来更改其内容。（嘿，盒子在网页上，应该使用 Ajax 和 Javascript）。

我尝试了一些现成的脚本，但我发现它们有限，它们让我发疯，JS 框架似乎也没有提供这样的解决方案。有没有人对那个领域有任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T17:38:58.077

仅仅因为该框位于网页上并不意味着它应该使用 AJAX，Omar。[您是否考虑过使用ClearSpring](http://www.clearspring.com/)或[WidgetBox](http://www.widgetbox.com/)等第三方解决方案？如果您需要将您的小部件放到 Myspace 上，您将需要其中之一。

也就是说，我已经针对这个问题进行了几次纯 JavaScript 运行；有关示例，请参阅[Twitterati](http://kentbrewster.com/twitterati)和[将您的 Digg 放入盒子](http://kentbrewster.com/put-your-digg-in-a-box)中，以及有关解释的我的[全球小部件峰会](http://kentbrewster.com/widget-summit/)演示文稿。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T15:50:40.900

你试过 jQuery 吗？

访问 www.jquery.com

可以在 [http://www.openjs.com/scripts/events/keyboard_shortcuts/找到一些示例](http://www.openjs.com/scripts/events/keyboard_shortcuts/)

[另请查看http://www.appelsiini.net/projects/jeditable](http://www.appelsiini.net/projects/jeditable) [http://docs.jquery.com/Tutorials:Edit_in_Place_with_Ajax](http://docs.jquery.com/Tutorials:Edit_in_Place_with_Ajax)上的就地编辑示例

# html - 如何让浮动 div 填满空间

> ID：326059
> 
> 赞同：2
> 
> 时间：2008-11-28T15:40:21.327
> 
> 标签：html, css, css-float

我正在尝试在网页上创建一个“工作流程”栏。

工作流程中的项目可能具有不同的长度。

可能有足够的项目来填充屏幕的宽度，因此流程需要换行到下一行。

我正在使用左浮动 div 来执行此操作。

但是，我希望 div 采用适当的屏幕宽度。

如果只有三个项目可以放在一条线上，那么我希望这些项目能够均匀地放在线上，同时考虑到每个项目的宽度。

目前我所能得到的只是一行上的最后一个 div 来填充剩余空间，这通常意味着我的项目都是左对齐的，例如我可以得到这样的布局：

```
AAAA -> BBBBB ->
CCCCCCCCCCCCCCCCCCCC -> DD -> EEE ->
FFFFF -> GGGG -> HHHHH

```

但我实际上希望它看起来像这样：

```
      AAAA -> BBBBB ->
CCCCCCCCCCCCCCCCCCCC -> DD -> EEE ->
   FFFFF -> GGGG -> HHHHH

```

如果你明白我的意思。

我是否需要为此使用表格而不是浮动 div？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T15:44:22.490

可能可以通过查看周围的标记来了解您有哪些元素。你可以尝试有一个周围的 div`margin: 0 auto;`

您可能需要为每个级别设置一个周围的 div。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T20:52:51.790

只是其他几个指针。你不应该有空的 li 标签，这在语义上是不正确的。同样在理想世界中，您不应该[提供 id 属性布局名称](http://nate.koechley.com/blog/2006/12/22/note_on_structural_and_semantic_meaning/)。

就我个人而言，我会将起始图像放在 ul 上，然后将结束图像放在最后一个 li 上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T15:48:20.780

不要浪费你的时间去这里：

[http://www.cssmenubuilder.com/build-breadcrumb-menu](http://www.cssmenubuilder.com/build-breadcrumb-menu)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T16:11:35.693

感谢您的及时回复。我会试试你的建议。

我目前正在尝试使用列表来执行此操作，尽管我也无法使用 div。

我已经尝试提取我的 JSP 的一些 HTML，以尝试并展示我在这方面的能力。

跨度有一类“导航”，它基本上在文本周围绘制背景图像，使其看起来像一个按钮，以及设置边距/填充/等。我省略了与按钮绘制直接相关的 CSS，因为这是我们系统中用于绘制按钮的标准框架内容。我已经包含了我正在使用的与工作流直接相关的 CSS。

我试图在第一个按钮之前绘制一个起始图像，然后在每个按钮后面绘制背景图像，以便在每个按钮之间画一条线来表示流程。然后，我在流程结束时得到了一个结束图像。

```
<html>
<body>

<STYLE>
#nav, #nav ul {
    list-style: none;
    margin: 0px;
    width: 700px;
}

#nav li {
    list-style: none;
    float: left;
    padding-left: 10px;
    padding-right: 10px;
    width: auto;
    background-image: url(/lookandfeel/images/navMenuDiv.gif);
    background-repeat: repeat-x;
}

li#ending {
    background-image: url(/lookandfeel/images/navMenuRight.gif);
    background-repeat: no-repeat;
}

li#start {
    background-image: url(/lookandfeel/images/navMenuLeft.gif);
    background-repeat: no-repeat;
}

.navigation a {
  background-image: url(/pdr/images/navigation.gif);
}
</STYLE>

<ul id="nav" style="width: 100%;border: 1px solid">
  <li id="start" />
  <LI >
    <SPAN class="navigation" >AAAAAAAAAA</SPAN>
  </li>
  <LI >
     <SPAN class=navigation >BBBB</SPAN>
  </li>
  <LI >
    <SPAN class=navigation>CCCCCCCCCCCCCCCCC</SPAN>
  </li>
  <LI>
    <SPAN class=navigation>DDDDDDDDD</SPAN>
  </li>
  <LI>
    <SPAN class=navigation>EEEEEEEE</SPAN>
  </li>
  <LI>
    <SPAN class=navigation>FFFFFFFFFFFFFF</SPAN>
  </li>
  <li>
    <SPAN class=navigation>GGGGGGGGGGGGGGGGGGGGGGGGGGGGG</SPAN
  </LI>
  <li id="ending" />
  </ul>
</body>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T16:28:39.233

将 li 元素设置为 display: inline，并给 ul 一个 text-align: justify 属性将使您部分达到那里（至少在 FFX3 和 IE7 中）。但是，在应用背景图像时确实会带来一些复杂性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T09:51:51.443

尽管我不喜欢说事情无法完成，但我认为我必须同意@johnners 对每个导航级别的周围元素的看法。即使您要使用表格布局 CSS，您也需要为每个“行”设置某种环绕元素，以使左右间距正确。

# c# - variable.ToString() 与 Convert.ToString(variable)

> ID：326060
> 
> 赞同：12
> 
> 时间：2008-11-28T15:41:16.003
> 
> 标签：c#, .net

假设我有一个整数需要转换为字符串（例如，我可能通过 TextBox 向用户显示该值。

我应该更喜欢`.ToString()`还是`Convert.ToString()`. 他们都做同样的事情（不是吗？）。

```
int someValue = 4;

// You can do this
txtSomeValue.Text = someValue.ToString();

// Or this...
txtSomeValue.Text = Convert.ToString(someValue); 
```

假设两者之间没有运行时差异，那么我的理由归结为美学和一致性。最近我一直很喜欢`Convert.ToString()`它说“嘿，我想要这个东西的*价值*作为一个字符串”。但是我知道这并不完全正确......

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-28T15:46:57.880

一项测试是

```
//This will set the variable test to null:
string test = Convert.ToString(ConfigurationSettings.AppSettings["Missing.Value"]);

//This will throw an exception:
string test = ConfigurationSettings.AppSettings["Missing.Value"].ToString(); 
```

从[http://weblogs.asp.net/jgalloway/archive/2003/11/06/36308.aspx获得了上述准备好的示例](http://weblogs.asp.net/jgalloway/archive/2003/11/06/36308.aspx)

[您可以在http://blogs.msdn.com/brada/archive/2005/03/10/392332.aspx](http://blogs.msdn.com/brada/archive/2005/03/10/392332.aspx)找到两者之间的一些基准

因此，这取决于您喜欢什么以及您的风格。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-28T15:44:44.237

凭借其大量的重载，Convert.ToString() 可用作各种输入类型的包罗万象，在处理潜在的类型范围时非常方便。如果你知道你的输入绝对是一个“int”，我会直接在它上面使用 ToString() 方法（这就是 Convert.ToString() 无论如何都会被代理调用的。）

# c++ - 在 STL 映射中，使用 map::insert 比使用 [] 更好吗？

> ID：326062
> 
> 赞同：207
> 
> 时间：2008-11-28T15:42:52.337
> 
> 标签：c++, dictionary, stl, insert, stdmap

前段时间，我和一位同事讨论了如何在 STL[映射](http://www.sgi.com/tech/stl/Map.html)中插入值。我更喜欢`map[key] = value;`它，因为它感觉自然并且读起来很清楚，而他更喜欢`map.insert(std::make_pair(key, value))`。

我刚问过他，我们都不记得为什么 insert 更好，但我相信这不仅仅是一种风格偏好，而是效率等技术原因。[SGI STL 参考](http://www.sgi.com/tech/stl/Map.html)简单地说： “严格来说，这个成员函数是不必要的：它只是为了方便而存在。”

谁能告诉我这个原因，还是我只是梦想有一个？

* * *

## 回答 #1

> 赞同：243
> 
> 时间：2008-11-29T07:03:10.760

当你写

```
map[key] = value; 
```

无法判断您是**替换**了`value`for `key`，还是**创建**了一个新`key`的`value`.

[`map::insert()`](http://en.cppreference.com/w/cpp/container/map/insert)只会创建：

```
using std::cout; using std::endl;
typedef std::map<int, std::string> MyMap;
MyMap map;
// ...
std::pair<MyMap::iterator, bool> res = map.insert(MyMap::value_type(key,value));
if ( ! res.second ) {
    cout << "key " <<  key << " already exists "
         << " with value " << (res.first)->second << endl;
} else {
    cout << "created key " << key << " with value " << value << endl;
} 
```

对于我的大多数应用程序，我通常不在乎我是在创建还是替换，所以我使用更易于阅读的`map[key] = value`.

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-11-28T16:01:34.390

当涉及到地图中已经存在的键时，两者具有不同的语义。所以它们并不能直接比较。

但是 operator[] 版本需要默认构造值，然后分配，所以如果这比复制构造更昂贵，那么它会更昂贵。有时默认构造没有意义，然后就不可能使用 operator[] 版本。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-05-13T23:39:24.620

还有一点需要注意`std::map`：

`myMap[nonExistingKey];`将在映射中创建一个新条目，键控`nonExistingKey`初始化为默认值。

当我第一次看到它时，这把我吓坏了（当我的头撞到一个令人讨厌的遗留错误时）。没想到。对我来说，这看起来像是一个 get 操作，我没想到会有“副作用”。`map.find()`从您的地图上获取时更喜欢。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-11-28T16:11:24.087

如果默认构造函数的性能影响不是问题，请看在上帝的份上，使用更易读的版本。

:)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2015-10-22T12:17:00.267

**`insert`从异常安全的角度来看更好。**

表达式`map[key] = value`实际上是两个操作：

1.  `map[key]`- 创建具有默认值的地图元素。
2.  `= value`- 将值复制到该元素中。

第二步可能会出现异常。结果，操作将仅部分完成（一个新元素被添加到地图中，但该元素没有用 初始化`value`）。操作未完成，但系统状态被修改的情况，称为有“副作用”的操作。

`insert`操作提供了强有力的保证，意味着它没有副作用（[https://en.wikipedia.org/wiki/Exception_safety](https://en.wikipedia.org/wiki/Exception_safety)）。`insert`要么完全完成，要么使地图处于未修改状态。

[http://www.cplusplus.com/reference/map/map/insert/](http://www.cplusplus.com/reference/map/map/insert/)：

> 如果要插入单个元素，则容器中不会发生异常情况下的更改（强保证）。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-06-02T13:59:58.247

如果您的应用程序对速度要求很高，我建议您使用 [] 运算符，因为它会创建原始对象的 3 个副本，其中 2 个是临时对象，迟早会被销毁。

但是在 insert() 中，创建了原始对象的 4 个副本，其中 3 个是临时对象（不一定是“临时对象”）并被销毁。

这意味着额外的时间： 1\. 一个对象内存分配 2\. 一个额外的构造函数调用 3\. 一个额外的析构函数调用 4\. 一个对象内存释放

如果您的对象很大，构造函数是典型的，析构函数会释放大量资源，以上几点更重要。关于可读性，我认为两者都足够公平。

同样的问题出现在我的脑海中，但不是可读性而是速度。这是一个示例代码，通过它我了解了我提到的观点。

```
class Sample
{
    static int _noOfObjects;

    int _objectNo;
public:
    Sample() :
        _objectNo( _noOfObjects++ )
    {
        std::cout<<"Inside default constructor of object "<<_objectNo<<std::endl;
    }

    Sample( const Sample& sample) :
    _objectNo( _noOfObjects++ )
    {
        std::cout<<"Inside copy constructor of object "<<_objectNo<<std::endl;
    }

    ~Sample()
    {
        std::cout<<"Destroying object "<<_objectNo<<std::endl;
    }
};
int Sample::_noOfObjects = 0;

int main(int argc, char* argv[])
{
    Sample sample;
    std::map<int,Sample> map;

    map.insert( std::make_pair<int,Sample>( 1, sample) );
    //map[1] = sample;
    return 0;
} 
```

![使用 insert() 时的输出](https://i.stack.imgur.com/vwGVp.png) ![使用 [] 运算符时的输出](https://i.stack.imgur.com/oVUVV.png)

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-11-19T20:49:15.687

现在在 c++11 中，我认为在 STL 映射中插入一对的最佳方法是：

```
typedef std::map<int, std::string> MyMap;
MyMap map;

auto& result = map.emplace(3,"Hello"); 
```

结果**将**是一对：

*   第一个元素（result.first），指向插入的对，如果键已经存在，则指向具有此键的对。

*   第二个元素（result.second），如果插入正确，则为 true，否则为 false，表示出现问题。

PS：如果您不关心订单，您可以使用 std::unordered_map ;)

谢谢！

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-11-29T08:31:46.183

map::insert() 的一个问题是，如果键已经存在于映射中，它不会替换值。我见过 Java 程序员编写的 C++ 代码，他们期望 insert() 的行为方式与 Java 中的 Map.put() 相同，其中值被替换。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-25T15:02:13.497

需要注意的是，您也可以使用[Boost.Assign](http://www.boost.org/doc/libs/1_38_0/libs/assign/doc/index.html#map_list_of)：

```
using namespace std;
using namespace boost::assign; // bring 'map_list_of()' into scope

void something()
{
    map<int,int> my_map = map_list_of(1,2)(2,3)(3,4)(4,5)(5,6);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-12-26T12:40:54.257

这是一个相当有限的案例，但从我收到的评论来看，我认为值得注意。

我过去见过人们以以下形式使用地图

```
map< const key, const val> Map; 
```

避免意外值覆盖的情况，然后继续编写其他一些代码：

```
const_cast< T >Map[]=val; 
```

我记得他们这样做的原因是因为他们确信在这些特定的代码位中他们不会覆盖映射值。因此，继续使用更“可读”的方法`[]`。

这些人编写的代码实际上从来没有给我带来任何直接的麻烦，但直到今天我都强烈地感觉到，当可以轻松避免风险时，不应该冒险——无论风险多么小。

如果您正在处理**绝对不能**被覆盖的地图值，请使用`insert`. 不要仅仅为了可读性而例外。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-03-18T19:24:59.973

这是另一个示例，显示如果存在则`operator[]` **覆盖**键的值，但如果存在`.insert` **则不覆盖**该值。

```
void mapTest()
{
  map<int,float> m;

  for( int i = 0 ; i  <=  2 ; i++ )
  {
    pair<map<int,float>::iterator,bool> result = m.insert( make_pair( 5, (float)i ) ) ;

    if( result.second )
      printf( "%d=>value %f successfully inserted as brand new value\n", result.first->first, result.first->second ) ;
    else
      printf( "! The map already contained %d=>value %f, nothing changed\n", result.first->first, result.first->second ) ;
  }

  puts( "All map values:" ) ;
  for( map<int,float>::iterator iter = m.begin() ; iter !=m.end() ; ++iter )
    printf( "%d=>%f\n", iter->first, iter->second ) ;

  /// now watch this.. 
  m[5]=900.f ; //using operator[] OVERWRITES map values
  puts( "All map values:" ) ;
  for( map<int,float>::iterator iter = m.begin() ; iter !=m.end() ; ++iter )
    printf( "%d=>%f\n", iter->first, iter->second ) ;

} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-07-01T22:25:04.973

`insert()`std::map函数不会覆盖与键关联的值这一事实允许我们编写对象枚举代码，如下所示：

```
string word;
map<string, size_t> dict;
while(getline(cin, word)) {
    dict.insert(make_pair(word, dict.size()));
} 
```

当我们需要将不同的非唯一对象映射到 0..N 范围内的某个 id 时，这是一个非常常见的问题。这些 id 可以在以后使用，例如，在图形算法中。在我看来，替代方案`operator[]`看起来不太可读：

```
string word;
map<string, size_t> dict;
while(getline(cin, word)) {
    size_t sz = dict.size();
    if (!dict.count(word))
        dict[word] = sz; 
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-08-10T12:29:23.560

[`insert()`](https://en.cppreference.com/w/cpp/container/map/insert)和之间的区别[`operator[]`](https://en.cppreference.com/w/cpp/container/map/operator_at)已经在其他答案中得到了很好的解释。[但是， C++11](https://en.wikipedia.org/wiki/C%2B%2B11)和[C++17](https://en.wikipedia.org/wiki/C%2B%2B17)`std::map`分别引入了新的插入方法：

*   [einpoklum 的评论](https://stackoverflow.com/questions/326062/in-stl-maps-is-it-better-to-use-mapinsert-than#comment36629301_326062)和[GutiMac 的回答](https://stackoverflow.com/a/27026678/2675154)[`emplace()`](https://en.cppreference.com/w/cpp/container/map/emplace)中也提到了C++11 提供。
*   C++17 提供[`insert_or_assign()`](https://en.cppreference.com/w/cpp/container/map/insert_or_assign)和[`try_emplace()`](https://en.cppreference.com/w/cpp/container/map/try_emplace).

让我简单总结一下“新”插入方法：

*   **`emplace()`：**如果使用得当，该方法可以通过构造要插入的元素就地避免不必要的复制或移动操作。与 类似`insert()`，只有在容器中没有具有相同键的元素时才会插入元素。
*   **`insert_or_assign()`：**此方法是`operator[]`. 与 不同`operator[]`，`insert_or_assign()`不需要地图的值类型是默认可构造的。这克服了[Greg Rogers 的回答](https://stackoverflow.com/a/326115/2675154)中提到的缺点。
*   **`try_emplace()`：**此方法是`emplace()`. 与`emplace()`,不同，`try_emplace()`如果由于映射中已经存在的键而导致插入失败，则不会修改其参数（由于移动操作）。

有关详细信息`insert_or_assign()`，请[在此处](https://stackoverflow.com/a/58110990/2675154)`try_emplace()`查看我的回答。

[Coliru 上的简单示例代码](http://coliru.stacked-crooked.com/a/0c67906c1bd3e8f1)

# .net - 如何使用程序控制连接到 Firewire 的 Video Cam

> ID：326063
> 
> 赞同：2
> 
> 时间：2008-11-28T15:43:12.147
> 
> 标签：.net, video, firewire

我需要控制（播放、倒带、停止）连接到 PC 火线的视频摄像头 这可能吗？我的程序是用 .NET 编写的

谢谢匿名

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T00:08:59.630

这是通过 DirectShow 完成的，它是 Windows SDK 的一部分。查看[DVApp 示例](http://msdn.microsoft.com/en-us/library/ms783409(VS.85).aspx)。

# inheritance - 面向对象语言中的继承概念

> ID：326068
> 
> 赞同：1
> 
> 时间：2008-11-28T15:44:55.873
> 
> 标签：inheritance, oop, conceptual

我正在和我的一个朋友讨论多重继承与单继承，并发现很明显，我对面向对象设计的概念与他的完全不同。我主要是一名 Obj-C 程序员，所以多重继承并不是我每天都在使用的东西。他主要是 Windows/PSP 下的 C++ 程序员，所以我们可能每天使用不同的概念。

他实际上带来了以下主题：新人类继承了什么？

我的想法是会有一个 Human 类，而新的存在将从该类继承并从他的两个父母那里获得一些实例变量（例如他的 DNA 和其他人）。

他的想法是，孩子会继承他的两个父母，以获得他父母的方法。

现在我有点困惑，因为老实说......从对象继承？继承不是用来从包含特定对象组通用方法的类继承的吗？这个论点真让我困惑不已。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T15:49:57.297

正面进行类比，新人类的特征来自父母产生的一对受精卵，这些受精卵只是松散地基于父母自己的DNA。

实际上，我认为这只是一个糟糕的类比。仅仅因为“继承”是从遗传学（或遗嘱和合同法？）中借用的术语，并不意味着它必须在概念上与软件开发 1:1 匹配，实际上它们只是表面上相似的概念。

例如，我的父亲是一名律师，而我的母亲是一名学校教师。我不是天生就具备任何一种技能（行为、方法……）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-28T15:53:37.180

父母也是人类，是哺乳动物家族的一部分。你的想法对我来说似乎最合乎逻辑。

```
public class Human extends Mammal implements HunterGatherer, Speech, CognitiveThought {

    public Human(Human mother, Human father) {
        super(mother, father);
        // ...
    }

    // ...
} 
```

当然我看不到：

```
public class Human extends Mother, Father { ... } 
```

我认为母亲和父亲相当参与他们孩子的建设，这三个人都是人类。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-28T16:00:01.787

同意 JeeBee，父母有建设的作用！

```
public Class HumanFactory(Human mother, Human father)
{
    public Human NewHuman()
    {
        while(!mother.IsPregnant)  // may loop infinitely in the infertile case
            father.Mate(mother)
        while(mother.IsPregnant)
            System.Threading.Sleep(1000); // may take some months, get comfortable
        return mother.DeliverBaby();
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-28T15:50:21.713

你们都错了……孩子和父母都是人类的实例…… 例如，在一个可能的类结构中，人类（所有这些）都继承自“灵长类动物”，后者继承自“哺乳动物”，后者继承自“动物”……

人类继承了灵长类动物的所有行为，如“WalkUpright()”等。
灵长类动物继承了哺乳动物的所有行为，如“Lactate()”“LiveBirth() 等……哺乳动物继承了动物的行为……

HumanBeing 的每个实例都可以有两个属性，分别称为父亲和母亲，它们都是 HumanBeing 的实例......

也许还有另一个名为 Children 的属性，它包含 HumanBeing 对象实例的集合......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T20:17:18.913

一个人就是一个类，所有的人都属于同一个类。

孩子、父亲和母亲只是该类的实例。

父母只是工厂（人本身的复合体）

不过，我们可以从[“缺失的链接”](http://en.wikipedia.org/wiki/Missing_link)继承，这取决于域。

**但是**您的朋友有一点，例如阿喀琉斯从若虫和人类继承：S，因此证明了多重继承。

超人继承了克里普顿，而蜘蛛侠是实现蜘蛛的人类！:P

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-28T15:50:01.433

好吧，我认为父母也是人。所以父母是人类的财产。它与 OOP 继承无关。如果您指的是由种族代表的人类类型，例如高加索人扩展人类，它可能会这样做

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-28T16:04:09.187

就面向对象的行为而言，您朋友的概念是错误的。一个人不会像班级那样从父母那里继承行为。一个人从每个父母那里继承一半的基因，这些基因结合起来导致行为。例如，即使父母双方都有特定的眼睛颜色，孩子也不一定有相同的眼睛颜色（如果你没有学过高中生物，请查找隐性基因）。

简而言之，在考虑类继承时不要考虑人类继承。这几乎肯定不会有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-03T00:39:04.857

简短的回答是，你和你朋友的继承概念已经被许多人所持有，并且同样是合法的。

您朋友的概念更接近“基于原型”的 OO 语言（例如 Self 和 Javascript）中的“对象继承”。你的更符合 Smalltalk、Java 和 C++ 的典型“类继承”。

Java（尤其是最近）倾向于将继承视为管理类型，现在敦促“组合”而不是继承以实现代码重用，部分原因是 Java 中的继承不如组合灵活，因此“优先组合”是一种很好的做法。部分原因是“脆弱的基类问题”。

但是，如果您的朋友更习惯于创建“mixins”，他可能会将继承更多地视为一种库包含。这可能不是 Java 或 C++ 中的最佳实践，但它*是*一种经常被理解的继承方式。

# javascript - 如何识别网页是在 iframe 中加载还是直接加载到浏览器窗口中？

> ID：326069
> 
> 赞同：703
> 
> 时间：2008-11-28T15:45:25.497
> 
> 标签：javascript, facebook, iframe

我正在编写一个基于 iframe 的 facebook 应用程序。现在我想使用相同的 html 页面来呈现普通网站以及 facebook 中的画布页面。我想知道我是否可以确定页面是在 iframe 中加载还是直接在浏览器中加载？

* * *

## 回答 #1

> 赞同：1290
> 
> 时间：2008-11-28T15:47:56.630

`window.top`由于[同源策略](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Same_origin_policy_for_JavaScript)，浏览器可以阻止访问。IE错误也会发生。这是工作代码：

```
function inIframe () {
    try {
        return window.self !== window.top;
    } catch (e) {
        return true;
    }
} 
```

`top`和`self`都是`window`对象（与 一起`parent`），因此您可以查看您的窗口是否是顶部窗口。

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2013-09-07T22:55:43.320

在与父级同源的 iframe 中时，该方法返回嵌入窗口[`window.frameElement`](https://devdocs.io/dom/window/frameelement)的元素（例如`iframe`或）。`object`否则，如果在顶级上下文中浏览，或者如果父框架和子框架具有不同的来源，它将评估为`null`.

```
window.frameElement
  ? 'embedded in iframe or object'
  : 'not embedded or cross-origin' 
```

这是一个[HTML 标准](https://html.spec.whatwg.org/multipage/browsers.html#dom-frameelement)，在所有现代浏览器中都有基本支持。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-11-28T17:53:15.223

RoBorg 是正确的，但我想补充一点。

**在 IE7/IE8 中，当微软在他们的浏览器中添加选项卡时，他们破坏了一件事情，如果你不小心的话，这会对你的 JS 造成严重破坏。**

想象一下这个页面布局：

```
MainPage.html
  IframedPage1.html   (named "foo")
  IframedPage2.html   (named "bar")
    IframedPage3.html (named "baz") 
```

现在在“baz”框架中单击一个链接（没有目标，在“baz”框架中加载）它工作正常。

如果加载的页面，我们称之为 special.html，使用 JS 来检查“它”是否有一个名为“bar”的父框架，它将返回 true（预期）。

现在让我们说 special.html 页面在加载时检查父框架（是否存在及其名称，如果它是“bar”，它会在 bar 框架中重新加载自身。例如

```
if(window.parent && window.parent.name == 'bar'){
  window.parent.location = self.location;
} 
```

到现在为止还挺好。现在出现了错误。

*假设您不是像往常一样单击原始链接并在“baz”框架中加载 special.html 页面，而是单击它或选择在新选项卡中打开它。*

当新标签加载时（***根本没有父框架！***）**IE 将进入无限循环的页面加载！**因为 IE 在 JavaScript 中“复制”了框架结构，因此新标签确实有一个父标签，并且该父标签的名称为“bar”。

好消息是检查：

```
if(self == top){
  //this returns true!
} 
```

在那个新选项卡中确实返回 true，因此您可以测试这种奇怪的情况。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2015-11-19T09:30:12.820

我不确定这个示例如何适用于较旧的 Web 浏览器，但我将它用于 IE、Firefox 和 Chrome 没有问题：

```
var iFrameDetection = (window === window.parent) ? false : true; 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2011-10-14T14:32:23.630

在 Firefox 6.0 扩展（Addon-SDK 1.0）的内容脚本中，接受的答案对我不起作用：Firefox 在每个：顶级窗口和所有 iframe 中执行内容脚本。

在内容脚本中，我得到以下结果：

```
 (window !== window.top) : false 
 (window.self !== window.top) : true 
```

这个输出的奇怪之处在于，无论代码是在 iframe 中还是在顶级窗口中运行，它总是相同的。

另一方面，谷歌浏览器似乎只在顶级窗口中执行我的内容脚本一次，所以上面的内容根本不起作用。

在两个浏览器的内容脚本中最终对我有用的是：

```
 console.log(window.frames.length + ':' + parent.frames.length); 
```

如果没有 iframe `0:0`，它会在包含一个框架的顶级窗口中打印`1:1`，并且在文档的唯一 iframe 中打印`0:1`。

这允许我的扩展程序在两个浏览器中确定是否存在任何 iframe，另外在 Firefox 中确定它是否在其中一个 iframe 中运行。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2020-05-04T15:41:11.843

```
if ( window !== window.parent ) 
{
      // The page is in an iframe   
} 
else 
{     
      // The page is not in an iframe   
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-06-20T10:04:48.233

我正在使用这个：

```
var isIframe = (self.frameElement && (self.frameElement+"").indexOf("HTMLIFrameElement") > -1); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-09-21T02:32:51.913

使用这个 javascript 函数作为如何完成此操作的示例。

```
function isNoIframeOrIframeInMyHost() {
// Validation: it must be loaded as the top page, or if it is loaded in an iframe 
// then it must be embedded in my own domain.
// Info: IF top.location.href is not accessible THEN it is embedded in an iframe 
// and the domains are different.
var myresult = true;
try {
    var tophref = top.location.href;
    var tophostname = top.location.hostname.toString();
    var myhref = location.href;
    if (tophref === myhref) {
        myresult = true;
    } else if (tophostname !== "www.yourdomain.com") {
        myresult = false;
    }
} catch (error) { 
  // error is a permission error that top.location.href is not accessible 
  // (which means parent domain <> iframe domain)!
    myresult = false;
}
return myresult;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-03-04T03:47:39.027

我实际上曾经检查 window.parent 并且它对我有用，但是最近 window 是一个循环对象，并且总是有一个父键，iframe 或没有 iframe。

正如评论所暗示的那样，很难与 window.parent 作品进行比较。如果 iframe 与父网页完全相同，则不确定这是否可行。

```
window === window.parent; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-04-12T09:24:21.067

## 目前最好的旧版浏览器断帧脚本

其他解决方案对我不起作用。这个适用于所有浏览器：

防御点击劫持的一种方法是在每个不应加框的页面中包含一个“frame-breaker”脚本。即使在不支持 X-Frame-Options-Header 的旧版浏览器中，以下方法也可以防止网页被构图。

在文档 HEAD 元素中，添加以下内容：

```
<style id="antiClickjack">body{display:none !important;}</style> 
```

首先将 ID 应用于样式元素本身：

```
<script type="text/javascript">
   if (self === top) {
       var antiClickjack = document.getElementById("antiClickjack");
       antiClickjack.parentNode.removeChild(antiClickjack);
   } else {
       top.location = self.location;
   }
</script> 
```

这样，所有内容都可以在文档 HEAD 中，并且您的 API 中只需要一个方法/标签库。

参考：[https ://www.codemagi.com/blog/post/194](https://www.codemagi.com/blog/post/194)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-11T22:04:42.120

由于您是在 facebook 应用程序的上下文中询问的，因此您可能需要考虑在发出初始请求时在服务器上检测到这一点。如果从 iframe 调用 Facebook 将传递一堆查询字符串数据，包括 fb_sig_user 键。

由于您可能需要在您的应用程序中检查和使用此数据，因此请使用它来确定要呈现的适当上下文。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-11-27T08:32:50.827

```
function amiLoadedInIFrame() {
    try {
         // Introduce a new propery in window.top
         window.top.dummyAttribute = true;
         // If window.dummyAttribute is there.. then window and window.top are same intances
         return !window.dummyAttribute;
    } catch(e) {
         // Exception will be raised when the top is in different domain
         return true;
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-12-20T16:04:12.630

按照[@magnoz](https://stackoverflow.com/a/7769187/5646334)的说法，这是他的答案的代码实现。

```
constructor() {
    let windowLen = window.frames.length;
    let parentLen = parent.frames.length;

    if (windowLen == 0 && parentLen >= 1) {
        this.isInIframe = true
        console.log('Is in Iframe!')
    } else {
        console.log('Is in main window!')
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-17T17:15:44.677

```
var inIFrame = window.location !== window.parent.location; 
```

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2011-10-25T03:57:35.517

这是我用过几次的古老代码：

```
if (parent.location.href == self.location.href) {
    window.location.href = 'https://www.facebook.com/pagename?v=app_1357902468';
} 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2013-06-17T18:08:49.367

如果您想知道用户是否从 facebook 页面选项卡或画布访问您的应用程序，请检查签名请求。如果你不明白，可能用户没有从 facebook 访问。确保确认 signed_request 字段结构和字段内容。

使用 php-sdk，您可以获得这样的签名请求：

```
$signed_request = $facebook->getSignedRequest(); 
```

您可以在此处阅读有关签名请求的更多信息：

[https://developers.facebook.com/docs/reference/php/facebook-getSignedRequest/](https://developers.facebook.com/docs/reference/php/facebook-getSignedRequest/)

和这里：

[https://developers.facebook.com/docs/reference/login/signed-request/](https://developers.facebook.com/docs/reference/login/signed-request/)

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2018-07-25T01:15:41.830

这对我来说是最简单的解决方案。

```
 <p id="demofsdfsdfs"></p>

<script>

if(window.self !== window.top) {

//run this code if in an iframe
document.getElementById("demofsdfsdfs").innerHTML = "in frame";

}else{

//run code if not in an iframe
document.getElementById("demofsdfsdfs").innerHTML = "no frame";
}

</script> 
```

* * *

## 回答 #18

> 赞同：-6
> 
> 时间：2012-10-27T15:31:39.323

```
if (window.frames.length != parent.frames.length) { page loaded in iframe } 
```

但前提是您的页面和在 iframe 中加载您的页面中的 iframe 数量不同。在您的页面中不设置 iframe 以 100% 保证此代码的结果

* * *

## 回答 #19

> 赞同：-6
> 
> 时间：2013-02-08T06:15:02.693

在每个页面中编写此 javascript

```
if (self == top)
  { window.location = "Home.aspx"; } 
```

然后它会自动重定向到主页。

# c++ - MFC 中 CTabCtrl 与 CPropertySheet 哪个更受欢迎？

> ID：326079
> 
> 赞同：7
> 
> 时间：2008-11-28T15:48:47.393
> 
> 标签：c++, mfc, cpropertysheet, ctabctrl

我不知道如何使用这两个。所以一个有利有弊的示例代码是完美的。哪个是首选？为什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-28T18:07:44.727

两者都不是优选的，它们用于不同的目的。如果您想要一个包含多个页面的对话框，请使用 CPropertySheet。如果您需要一个包含多个页面的对话框，而对话框的一部分保持固定，请使用 CTabCtrl。CTabCtrl 可以用来做 CPropertySheet 可以做的所有事情，但是由于 CTabCtrl 使用起来更复杂，所以除非您需要额外的灵活性，否则不应使用它。通过设置一些标志，CPropertySheet 也可以用作向导。

以下是使用 CTabCtrl 的示例：

[aCTabCtrl 示例 http://rabien.com/image/xcolordialog1.png](http://rabien.com/image/xcolordialog1.png)

如果这是一个 CPropertySheet，则不可能将示例颜色放在选项卡之外。（并且按钮必须在底部）

[CPropertySheet 教程](http://www.codeguru.com/cpp/controls/propertysheet/article.php/c605/)

[CTabCtrl 教程](http://www.codeguru.com/cpp/controls/controls/tabcontrols/article.php/c5239)

# xml - XSLT v1.0中排序获取最大值，新问题

> ID：326084
> 
> 赞同：2
> 
> 时间：2008-11-28T15:49:44.303
> 
> 标签：xml, xslt

我有一个包含几个`<person>`元素的 XML 文档，每个元素都包含人员的 ，以及分组元素中的`<name>`几个元素。`<preferred-number>``<preferred-numbers>`

我已经发现要获得最大的，`<preferred-number>`我必须在其中`<xsl:apply-template>`使用 a `<xsl:sort>`，然后获取第一个元素，因为 XSLT v1.0 没有`fn:max()`.

但我想这会给我带来最大的价值。那么，我怎样才能安排一个样式表来提取每个人`<name>`最棒的`<preferred-number>`呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T07:15:26.667

可以使用 FXSL 提供的“最大”模板[**——XSLT 的函数式编程库**](http://fxsl.sf.net)。FXSL 完全用 XSLT 本身编写。

以下是使用“最大”模板的示例：

当这种转变：

```
<xsl:stylesheet 版本="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:f="http://fxsl.sf.net/"
xmlns:maximum-own-compare="maximum-own-compare"
xmlns:Mycompare="我的比较"
exclude-result-prefixes="xsl f Mycompare"
>
   <xsl:import href="maximum.xsl"/>

   <xsl:输出方法="文本"/>

   <!-- 此转换必须应用于：
        numList.xml
    -->

     <我的比较:我的比较/>

    <xsl:模板匹配="/">
      <xsl:变量名="vCMPFun"
           select="document('')/*/Mycompare:*[1]"/>

      <xsl:call-template name="最大值">
        <xsl:with-param name="pList" select="/*/*"/>
        <xsl:with-param name="pCMPFun" select="$vCMPFun"/>

      </xsl:调用模板>
    </xsl:模板>

    <xsl:模板名称="MyIsGreater" 模式="f:FXSL"
      匹配="我的比较：*">
         <xsl:param name="arg1"/>
         <xsl:param name="arg2"/>

         <xsl:选择>
          <xsl:when test="$arg1 > $arg2">1</xsl:when>
          <xsl:otherwise>0</xsl:otherwise>
         </xsl:选择>
    </xsl:模板>
</xsl:样式表>

```

应用于此 XML 文档：

```
<数字>
  <num>01</num>
  <num>02</num>
  <num>03</num>
  <num>04</num>
  <num>05</num>
  <num>06</num>
  <num>07</num>
  <num>08</num>
  <num>09</num>
  <num>10</num>
</nums>

```

得到想要的结果。

```
10

```

请注意，我可以将任何需要的“比较”操作作为参数传递！例如，如果我的比较操作在 $arg1 < $arg2 时返回 1，那么上述转换将产生“01”——所有值中的最小值。

现在，我将展示原始问题的两种解决方案。

# 解决方案1（使用 FXSL 的“最大”模板）：

```
<xsl:stylesheet 版本="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:f="http://fxsl.sf.net/"
xmlns:Mycompare="我的比较"
exclude-result-prefixes="xsl f Mycompare"
>
   <xsl:import href="maximum.xsl"/>

   <xsl:output omit-xml-declaration="yes" indent="yes"/>

     <我的比较:我的比较/>

      <xsl:变量名="vCMPFun"
           select="document('')/*/Mycompare:*[1]"/>

    <xsl:模板匹配="/">
      <人员>
       <xsl:apply-templates select="*/*"/>
      </人>
    </xsl:模板>
    <xsl:template match="person">
     <人>
      <xsl:call-template name="最大值">
        <xsl:with-param name="pList" select="*/*"/>
        <xsl:with-param name="pCMPFun" select="$vCMPFun"/>

      </xsl:调用模板>
     </人>
    </xsl:模板>

    <xsl:模板名称="MyIsGreater" 模式="f:FXSL"
      匹配="我的比较：*">
         <xsl:param name="arg1"/>
         <xsl:param name="arg2"/>

         <xsl:选择>
          <xsl:when test="$arg1 > $arg2">1</xsl:when>
          <xsl:otherwise>0</xsl:otherwise>
         </xsl:选择>
    </xsl:模板>
</xsl:样式表>

```

当此转换应用于以下 XML 文档时：

```
<t>
    <人>
        <首选号码>
            <preferred-number>8</preferred-number>
            <preferred-number>10</preferred-number>
            <preferred-number>4</preferred-number>
            <preferred-number>12</preferred-number></preferred-number>
    </人>
    <人>
        <首选号码>
            <preferred-number>2</preferred-number>
            <preferred-number>11</preferred-number>
            <preferred-number>15</preferred-number>
            <preferred-number>6</preferred-number></preferred-number>
    </人>
    <人>
        <首选号码>
            <preferred-number>10</preferred-number>
            <preferred-number>44</preferred-number>
            <preferred-number>9</preferred-number></preferred-number>
    </人>
</t>

```

产生了想要的结果：

```
<人员>
   <人>
      <preferred-number>12</preferred-number>
   </人>
   <人>
      <preferred-number>15</preferred-number>
   </人>
   <人>
      <preferred-number>44</preferred-number>
   </人>
</人>

```

# 解决方案2（使用手写的模板）：

当这种转变：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>

    <xsl:模板匹配="/">
     <人员>
       <xsl:apply-templates select="*/*"/>
     </人>
    </xsl:模板>

    <xsl:template match="person">
     <人>
      <xsl:call-template name="最大值">
        <xsl:with-param name="pList" select="*/*"/>
      </xsl:调用模板>
     </人>
    </xsl:模板>

    <xsl:template name="最大">
      <xsl:param name="pList"/>

      <xsl:选择>
       <xsl:when test="not($pList)">
        -99999999999999999999
       </xsl:when>
       <xsl：否则>
         <xsl:variable name="vLen" select="count($pList)"/>

         <xsl:选择>
          <xsl:when test="$vLen = 1">
           <xsl:value-of select="$pList[1]"/>
          </xsl:when>
          <xsl：否则>
           <xsl:变量名="vHalf"
             select="floor($vLen div 2)"/>

           <xsl:变量名="vMax1">
             <xsl:call-template name="最大值">
              <xsl:with-param name="pList"
                select="$pList[not(position() > $vHalf)]"/>
             </xsl:调用模板>
           </xsl:变量>

           <xsl:变量名="vMax2">
             <xsl:call-template name="最大值">
              <xsl:with-param name="pList"
                select="$pList[位置() > $vHalf]"/>
             </xsl:调用模板>
           </xsl:变量>

           <xsl:value-of
            选择="$vMax1*($vMax1 > $vMax2)
                   +
                    $vMax2*($vMax2 >= $vMax1)
            "/>
          </xsl:否则>
         </xsl:选择>
       </xsl:否则>
      </xsl:选择>
    </xsl:模板>
</xsl:样式表>
```

应用于同一个 XML 文档，再次产生正确的结果：

```
<人员>
   <人>12</人>
   <人>15</人>
   <人>44</人>
</人>

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T16:35:34.803

我记得在 XSLT 1.0 中对内容进行排序时，您必须使用一种稍微迂回的方法。如果你还没有，你会想看看[Muenchian 分组](http://www.jenitennison.com/xslt/grouping/muenchian.html)给你一些开始的想法。

我发现[这个网站](http://www.dpawson.co.uk/xsl/sect2/N6461.html)是一个非常有用的资源。

# c# - 为什么我必须在 C# 中将枚举转换为 int？

> ID：326098
> 
> 赞同：9
> 
> 时间：2008-11-28T15:56:41.230
> 
> 标签：c#, enums, casting, int

这是我的代码：

```
internal enum WindowsMessagesFlags {
    WM_EXITSIZEMOVE      = 0x00000232,
    WM_DISPLAYCHANGE     = 0x0000007e,
    WM_MOVING            = 0x00000216,
}

protected override void WndProc(ref Message m) {
    switch(m.Msg) {
        case (int)WindowsMessagesFlags.WM_DISPLAYCHANGE:
            FixWindowSnapping();
            break;
        case (int)WindowsMessagesFlags.WM_EXITSIZEMOVE:
            SaveWindowProperties();
            break;
        case (int)WindowsMessagesFlags.WM_MOVING:
            KeepProperLocation(ref m);
            break;
    }
} 
```

有没有办法阻止铸造？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-28T15:58:49.247

排序 - 投 m.Msg 代替：

```
protected override void WndProc(ref Message m) {
    switch((WindowsMessagesFlags) m.Msg) {
        case WindowsMessagesFlags.WM_DISPLAYCHANGE:
                FixWindowSnapping();
                break;
        case WindowsMessagesFlags.WM_EXITSIZEMOVE:
                SaveWindowProperties();
                break;
        case WindowsMessagesFlags.WM_MOVING:
                KeepProperLocation(ref m);
                break;
    }
} 
```

您根本需要强制转换的原因是因为在 C# 中枚举不仅仅是数字 - 它们是与类型相关联的数字。这可以防止你做（没有铸造）：

```
HttpStatusCode status = someWindowsMessageFlag; 
```

这显然是一件好事 :) 但是，当您需要时，您总是可以“通过”底层类型（在本例中为 int）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T16:00:32.503

Message.Msg 定义为什么？

我打赌它是 Int32。

我也打赌 WindowsMessagesFlags 是你的类型，但 Message 来自框架。

这意味着您将自己的枚举与框架构建的对象一起使用，当然它们在类型方面会有一些不兼容。

枚举是一种强类型，不仅仅是*一个数字*，它是一个*在上下文中具有名称*的数字。此名称、上下文、数字、部分与数字不直接兼容，这就是您需要转换的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-23T07:43:31.270

一个原因是因为 C# 当前（4.0）不允许您在扩展方法（[相关问题](https://stackoverflow.com/questions/5518468/is-it-possible-define-an-extension-operator-method)）中为任何类型（包括枚举）编写隐式运算符重载（强制转换）。当与弱类型数据库或弱类型序列化格式（二进制写入器）集成时，干净地转换为 Int16 或从 Int16 转换会很好。

# php - 当我使用它从 HTML 中获取 img src 时，为什么这个正则表达式会返回错误？

> ID：326103
> 
> 赞同：1
> 
> 时间：2008-11-28T15:57:53.740
> 
> 标签：php, html, xml, regex, simplexml

我正在编写一个函数，它从它在 html 文件中找到的第一个图像标记中找出 src。按照此处[此线程](https://stackoverflow.com/questions/138313/how-to-extract-img-src-title-and-alt-from-html-using-php)中的说明，我得到了一些似乎正在工作的东西：

```
preg_match_all('#<img[^>]*>#i', $content, $match); 

foreach ($match as $value) {
    $img = $value[0];
                           } 

$stuff = simplexml_load_string($img);
$stuff = $stuff[src];
return $stuff; 
```

但是在使用该函数几分钟后，它开始返回如下错误：

> 警告：simplexml_load_string() [0function.simplexml-load-string0]：实体：第 1 行：解析器错误：第 42 行的路径/到/脚本中标记 img 第 1 行中的数据过早结束。

和

> 警告：simplexml_load_string() [0function.simplexml-load-string0]: tp://feeds.feedburner.com/~f/ChicagobusinesscomBreakingNews?i=KiStN" border="0"> 在第 42 行的 path/to/script 中。

我对 PHP 有点陌生，但似乎我的正则表达式错误地分割了 HTML。我怎样才能使它更“密封”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T08:47:39.863

这两行 PHP 代码应该为您提供 HTML 文件中所有 img 标记中 src 属性的所有值的列表：

```
preg_match_all('/<img\s+[^<>]*src=["\']?([^"\'<>\s]+)["\']?/i', $content, $result, PREG_PATTERN_ORDER);
$result = $result[1]; 
```

为了保持正则表达式简单，我不允许文件名中有空格。如果您想允许这样做，您需要对带引号的属性值（可以有空格）和不带引号的属性值（不能有空格）使用单独的替代方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T16:02:26.697

很可能是因为正则表达式获取的“XML”无论出于何种原因都不是正确的 XML。我可能会选择一个更复杂的正则表达式来提取 src 属性，而不是使用 SimpleXML 来获取 src。这个 REGEX 可能接近你需要的。

```
<img[^>]*src\s*=\s*['|"]?([^>]*?)['|"]?[^>]*> 
```

您也可以使用真正的 HTML Parsing 库，但我不确定 PHP 中存在哪些选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T16:09:51.097

属性中的 & 符号本身是无效的 XML（它应该被编码为“&amp;”），但有些人仍然在 HTML 页面上的 URL 上使用这种方式（并且所有浏览器都支持它）。也许这就是你的问题。

如果是这种情况，您可以在解析字符串之前对其进行清理，将“<code>&(?!amp;)”替换为“<code>&”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T16:34:02.153

关于不同的主题：

```
foreach ($match as $value) {
    $img = $value[0];
                           } 
```

可以替换为

```
$img = $match[count($match) - 1][0]; 
```

像这样的东西：

```
if (preg_match('#<img\s[^>]*>#i', $content, $match)) {
    $img = $match[0]; //first image in file only
    $stuff = simplexml_load_string($img);
    $stuff = $stuff[src];
    return $stuff;
} else {
    return null; //no match found
} 
```

# c# - 与 Page_Error 相比，使用 OnAsyncPostBackError 有什么优势

> ID：326106
> 
> 赞同：3
> 
> 时间：2008-11-28T15:59:52.473
> 
> 标签：c#, asp.net, web-services, asp.net-ajax, exception-handling

我目前正在为我们的应用程序研究异常处理架构。

我们将`UpdatePanels`广泛使用，我们还将调用 Webservices。

我想知道与似乎捕获应用程序中抛出的所有异常`ScriptManager.OnAsyncPostBackError`的事件相比，是否真的需要实现处理程序。`Page_Error`

唯一的好处似乎是可以自定义错误消息，但如果您可以访问`Scriptmanager`对象本身，就可以实现这一点。

在任何情况下，`AsynchPostBackError`意志会捕捉到不会捕捉到的东西`Page_Error`吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-29T05:29:47.190

当我们想要自定义 AJAX 回发期间发生的异常时，应该捕获 AsyncPostBackError 事件。
而 Page___Error 方法处理页面生命周期中发生的错误，即使没有使用 AJAX。

有关 AsyncPostBackError 的更多信息，请查看： http: [//www.codedigest.com/Articles/ASPNETAJAX/115_Error_Handling_in_ASPNet_Ajax_Applications.aspx](http://www.codedigest.com/Articles/ASPNETAJAX/115_Error_Handling_in_ASPNet_Ajax_Applications.aspx)

# apache-flex - Flex 智能感知忘记了 flash。*

> ID：326110
> 
> 赞同：3
> 
> 时间：2008-11-28T16:00:34.810
> 
> 标签：apache-flex, intellisense

我正在使用带有 Flex Builder 插件 (3.0.194161) 和 Flex SDK 3.2 的 Eclipse 3.3.2。最近智能感知已经开始忘记闪存中的所有内容。* 包 EXCEPT flash.errors.*

代码仍然可以编译，但尝试自动解析某些内容（CTRL+SPACE）会删除任何 flash.* import 语句，从而导致编译错误。就目前而言，我必须要么不使用 CTRL+SPACE，要么在编译之前重新添加我的 flash.*。

我已经尝试重新创建工作区/项目并重新安装了 Flex SDK，但我仍然遇到同样的问题。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T17:23:41.743

通过将以下 SWC 添加到我的库路径中，我能够解决该问题：FLEX_SDK\libs\player\10\playerglobal.swc

看起来问题是由 {targetPlayerMajorVersion} 不再解决引起的，但我不知道这是怎么发生的。

**编辑：**已知错误，如[FB-16703](http://bugs.adobe.com/jira/browse/FB-16703)和[“Targeting Flash Player 10”中所述](http://opensource.adobe.com/wiki/display/flexsdk/Targeting+Flash+Player+10)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T23:09:24.827

升级到[Flex Builder 3.0.2](http://www.adobe.com/devnet/flex/articles/sdk32_fb302.html)。我注意到旧版本的 Flex Builder 不喜欢 Flash Player 10 的新 playerglobal.swc。

# c++ - 从容器中删除元素的单语句方法

> ID：326112
> 
> 赞同：1
> 
> 时间：2008-11-28T16:00:42.813
> 
> 标签：c++, stl, erase-remove-idiom

是否有一种算法可以从容器中删除元素，如下面的代码中发生的那样？

```
vec_it = std::remove_if( vec.begin(), vec.end(), pred );
vec.erase( vec_it, vec.end() ); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-28T16:30:17.497

这样做的惯用方式就像 jalf 所说的那样。您可以构建自己的函数来更轻松地做到这一点：

```
template<typename T, typename Pred> void erase_if(T &vec, Pred pred)
{
    vec.erase(std::remove_if(vec.begin(), vec.end(), pred), vec.end());
} 
```

所以你可以使用

```
std::vector<int> myVec;
// (...) fill the vector. (...)
erase_if(myVec, myPred); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T16:17:02.377

你的意思是这样吗？

```
vec.erase( std::remove_if( vec.begin(), vec.end(), pred ), vec.end() ); 
```

这是惯用的做法。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-28T16:16:50.690

我不知道。也许有。但如果有的话，那将是一个地狱般的声明。没有人能够理解或维护它。如果这两行符合您的要求，请坚持使用。他们非常好。

# c++ - 有没有办法通过使用插件在 Firefox 中运行 ActiveX 组件？

> ID：326125
> 
> 赞同：6
> 
> 时间：2008-11-28T16:07:00.400
> 
> 标签：c++, firefox, browser, activex, xul

我有一个我们需要（如果可能）在 Firefox 中运行的 ActiveX 插件。Firefox 是否有插件（或其他方式）允许这样做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-01T09:49:31.767

我似乎找到了解决方案：

[http://code.google.com/p/ff-activex-host/](http://code.google.com/p/ff-activex-host/)

“这个 Firefox 插件使在 Firefox 中使用 ActiveX 控件成为可能。它基于 Gecko NPAPI 并提供对托管控件（事件、函数、属性）的完全访问。”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T16:09:55.557

您曾经可以在 Firefox 1.5 中使用，但我相信现在不行了，该[插件](http://www.iol.ie/~locka/mozilla/mozilla.htm)似乎不再受支持。

更多信息[在这里](http://groups.google.com/group/mozilla.dev.tech.plugins/browse_thread/thread/c1ffb11ac6bcf0e0/4209766365b7146f)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T17:24:00.277

不确定这是否有用，但是为 Firefox 编写一个 NPAPI 插件在 IMO 中相当简单——比编写 ActiveX 控件更容易，因此您可能会发现编写一个插件是值得的，特别是因为它应该适用于所有其他浏览器“对于自由”。

[这](http://git.webvm.net/?p=npsimple)是一个简单的 NPAPI 插件的一个很好的例子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T21:04:26.533

我发现了另一个有效的 ActiveX 插件。它被称为海王星。有关更多信息，请参阅[http://www.meadroid.com/neptune/index.htm](http://www.meadroid.com/neptune/index.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-20T07:56:22.283

您还可以使用 firebreath，它可以让您轻松创建一个适用于 firefox 和 IE 的插件；创建暴露给 javascript 的新方法和属性很容易，但您只需要在一个地方进行，并且它适用于两种浏览器。

[http://firebreath.googlecode.com](http://firebreath.googlecode.com)

是的，我是项目维护者之一，所以我有偏见=]

# design-patterns - 编写基于枚举值的方法，不会陷入代码异味

> ID：326128
> 
> 赞同：3
> 
> 时间：2008-11-28T16:08:27.340
> 
> 标签：design-patterns

想象一下，我有一个文档（word 文档）。

我有一个枚举，它将指示如何从文档中提取数据。因此，如果我只想要文本、图像或两者（枚举的 3 个成员）。

我有一个基于此枚举的案例陈述，但不会陷入代码异味，如何编写不太重复的代码？对于 switch 中的每个条件，我应该有一个单独的方法（最简单的方法），还是一个接受参数的方法（如枚举的值），然后使用 if 语句说 if(xyz) 做 abc，等等上。

或者有没有更快、更有效的方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T16:14:40.773

我会使用与工厂相结合的策略模式来根据枚举的值创建适当的策略。 **编辑**正如其他人指出的那样，您也可以通过地图确定正确的策略。工厂是我的选择，因为它只封装了逻辑，不需要任何数据存储。

```
public interface IExtractionStrategy
{
    object Extract( Document doc );  // or what ever result is best
}

public class TextExtractionStrategy : IExtractionStrategy
{
    public object Extract( Document doc )
    {
     .... algorithm for extracting text...
    }
}

public class ImageExtractionStrategy : IExtractionStrategy
{
    public object Extract( Document doc )
    {
     .... algorithm for extracting images...
    }
}

public static class StrategyFactory
{
     IExtractionStrategy GetStrategy( ExtractionEnum strategyType )
     {
         switch (strategyType)
         {
             case ExtractionEnum.Text:
                 return new TextExtractionStrategy();
                 break;
             case ExtractionEnum.Image:
                 return new ImageExtractionStrategy();
                 break;

             ...
         }
     }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T16:16:25.467

由于在不知道您的确切代码的情况下很难给出一般性陈述，我只能建议您阅读这篇文章：

[Back to Basics - Life After If, For and Switch - 就像](http://www.hanselman.com/blog/BackToBasicsLifeAfterIfForAndSwitchLikeADataStructuresReminder.aspx)Scott Hanselman 的数据结构提醒。

由于您的枚举中只有 3 个值，因此任何模式（如策略模式或地图）都可能是架构上的过度杀伤（不要误会我的意思，这些模式在较大的枚举上非常有用）。关键在于为特定问题选择正确的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T16:16:06.247

使用[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)将数据处理方法与其选择分离。

然后，您可以使用直线`Map<Enum, Strategy>`来保持从枚举到提取策略的关系，或者甚至让枚举的每个实例都拥有对其自己策略的引用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T17:03:30.130

换一个灯泡需要多少节课？

也许这只是术语上的差异，但在我看来，这似乎是一个需要调度表的简单案例：

```
use constant EXTRACT_TEXT => 1, EXTRACT_IMAGES => 2, EXTRACT_BOTH => 3;
my %extractor = (
    (EXTRACT_TEXT) => \&extract_text,
    (EXTRACT_IMAGES) => \&extract_images,
    (EXTRACT_BOTH) => \&extract_both,
);
...
die "no extractor found for $enum_value" if ! $extractor{ $enum_value };
$extractor{ $enum_value }->( $document_info ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T17:16:31.913

我会做（伪代码）：

```
 switch(enum)
   case images:
       extractImages();
       break;
   case text:
       extractText();
       break;
   case both:
        extractImages();
        extractText();
        break; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T17:22:47.487

如果您使用的是 Java 枚举，那么您可以利用它们实际上是对象的事实：

```
enum ExtractionEnum {
    IMAGE {
        public byte[] extract(InputStream is) { ... }
    },

    TEXT {
        public byte[] extract(InputStream is) { ... }
    };

    public abstract byte[] extract(InputStream is);
}

// ...
public void doSomething(ExtractionEnum type) {
    byte[] data = type.extract(getInputStream());
    ...
} 
```

我不确定我是否比策略模式或 good-ol' `switch`/更喜欢这个`case`，但它确实有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-28T16:14:52.380

一种解决方案可能是为您想要提取数据的每种方式设置一个类。每个类都将完成所有提取工作，并且它们可以有一个通用的 IExtract 接口。您只需根据枚举返回接口，然后调用接口上的方法。

# c# - 如何获取泛型方法的 MethodInfo？

> ID：326136
> 
> 赞同：1
> 
> 时间：2008-11-28T16:12:44.710
> 
> 标签：c#, .net, reflection, extension-methods

我正在尝试获取`MethodInfo`该方法的对象：

```
Any<TSource>(IEnumerable<TSource>, Func<TSource, Boolean>) 
```

我遇到的问题是如何为`Func<TSource, Boolean>`位指定类型参数...

```
MethodInfo method = typeof(Enumerable).GetMethod("Any", new[] { typeof(Func<what goes here?, Boolean>) }); 
```

帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-10-27T18:02:14.873

您可以创建一个扩展方法来完成检索所有方法并过滤它们以返回所需的泛型方法的工作。

```
public static class TypeExtensions
{
    private class SimpleTypeComparer : IEqualityComparer<Type>
    {
        public bool Equals(Type x, Type y)
        {
            return x.Assembly == y.Assembly &&
                x.Namespace == y.Namespace &&
                x.Name == y.Name;
        }

        public int GetHashCode(Type obj)
        {
            throw new NotImplementedException();
        }
    }

    public static MethodInfo GetGenericMethod(this Type type, string name, Type[] parameterTypes)
    {
        var methods = type.GetMethods();
        foreach (var method in methods.Where(m => m.Name == name))
        {
            var methodParameterTypes = method.GetParameters().Select(p => p.ParameterType).ToArray();

            if (methodParameterTypes.SequenceEqual(parameterTypes, new SimpleTypeComparer()))
            {
                return method;
            }
        }

        return null;
    }
} 
```

Using the extension method above, you can write code similar to what you had intended:

```
MethodInfo method = typeof(Enumerable).GetGenericMethod("Any", new[] { typeof(IEnumerable<>), typeof(Func<,>) }); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T16:19:00.110

没有办法在一次调用中获得它，因为您需要创建一个由方法的泛型参数构造的泛型类型（在本例中为 TSource）。由于它特定于方法，因此您需要获取方法来获取它并构建通用 Func 类型。鸡和蛋的问题，呵呵？

但是，您可以做的是获取在 Enumerable 上定义的所有 Any 方法，并遍历这些方法以获得您想要的方法。

# .net - 务实地定义通用外观和感觉的模板

> ID：326141
> 
> 赞同：2
> 
> 时间：2008-11-28T16:14:09.620
> 
> 标签：.net, templates

我有一个新项目，简单地说，就是试图使我们所有部门页面的外观和感觉正式化。我在 Google 上四处搜索，发现许多教程讨论了几种技术的优缺点。从我一直在阅读的内容来看，我正在寻找的是控件。基本上，我想要一个通用的页眉和页脚。

```
<header>
<content>
<footer> 
```

内容部分将是我放置与部门有关的特定内容的地方。我可以制作一个包含页眉和页脚的空白模板，这是我最初的想法。然后，一旦需要创建一个新页面，我就会复制和模板并开始填写内容。有没有更简单的方法可以务实地做到这一点？

谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T16:15:41.177

[母版页](http://www.odetocode.com/Articles/419.aspx)似乎是您正在寻找的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T16:40:32.390

从概念上讲，我认为您非常正确。根据一些非常简单的容器（页眉、页脚、内容）来构思页面模型要容易得多。您可以通过定义可用于填充较大容器的显示逻辑块（顶部导航栏、页脚链接、左侧广告栏等）更进一步。

务实地，您将如何做到这一点？首先，这取决于您使用的平台和语言。.NET、Java、PHP 或平面 HTML 的解决方案可以根据您选择绘制线条的位置以不同方式实现。在平面 HTML 中，一种方法是使用 #include 文件。在编程语言中，您必须决定您的最外层容器结构将是什么以及您将如何定义构建块（默认情况下定义如何聚合它们）。有很多可能的方法来做到这一点。

您将成为创建和管理网站的人，还是将该责任委托给整个组织中的非技术内容所有者团队？该答案可能会严重影响您的设计选择。

在许多内容管理系统中，其想法是清晰地将内容与呈现分开。因此，通常在数据库中有一个通用的内容存储范例，然后有一种动态的方式通过在轻量级平台中编写的某种显示机制来呈现该内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T17:10:31.597

您需要寻找一个模板库（我不使用 .NET，因此我无法提出任何具体建议）来将您的各种模板即时组装到页面中，而不是使用您描述的基于复制的方法。否则，您会发现自己复制模板以在周一制作所有页面，然后模板将在周二更改，您需要修改或重新创建所有页面以匹配新模板。

# blogengine.net - BlogEngine.Net 代码格式化扩展有效吗？

> ID：326160
> 
> 赞同：1
> 
> 时间：2008-11-28T16:25:53.123
> 
> 标签：blogengine.net

几个月来，我一直在努力寻找适用于 BlogEngine.Net 的代码语法格式化扩展。我不喜欢默认格式扩展的行为，并尝试了其他几个（manoli 就是其中之一），但它们似乎总是与 TinyMCE 编辑器交互不好。有谁知道一个有效的扩展，或者一种不同的方法，可以让我在我的博客上制作漂亮的代码示例，而不用自己破解 HTML 的废话？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T17:49:16.353

我会尝试将 Windows Live Writer 与 Paste From Visual Studio 插件一起使用。一个你去 WLW，你永远不会回到那个该死的 TinyMCE 界面。

WLW在这里： http: [//get.live.com/writer/overview](http://get.live.com/writer/overview)

插件在这里： http: [//gallery.live.com/liveItemDetail.aspx ?li=d8835a5e-28da-4242-82eb-e1a006b083b9&l=8](http://gallery.live.com/liveItemDetail.aspx?li=d8835a5e-28da-4242-82eb-e1a006b083b9&l=8)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T15:46:46.283

谢谢，雷夫。感谢Hanselman 在我提出问题后的第二天发布的[这篇文章，我下载了 WLW 并且现在正在使用它。](http://www.hanselman.com/blog/BestCodeSyntaxHighlighterForSnippetsInYourBlog.aspx)就获得格式精美的代码而言，我使用的是[manoli.net](http://manoli.net/csharpformat/)上开发并提供的一个小工具的剪切和粘贴。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-07T15:08:48.513

查看 SyntaxHighlighter .. 效果很好。为了轻松集成到 BlogEngine 中，请查看[我的博客文章](http://www.dscoduc.com/post/2008/09/25/More-Efficient-SyntaxHighlighter.aspx)。

# sharepoint - 网络驱动器文件共享

> ID：326167
> 
> 赞同：0
> 
> 时间：2008-11-28T16:30:17.903
> 
> 标签：sharepoint, ecm

在过去 10 年的大部分时间里，我们一直依靠各种网络映射驱动器来实现文件共享。一个用于在团队之间共享文件的驱动器号，一个用于整个组织的单独文件共享，第三个用于个人使用等。我想摆脱这个并试图决定是 ECM/Sharepoint 类型的解决方案，还是自制的应用程序，值得付出的代价和要走的路吗？或者我们是否应该仅仅依靠登录脚本/映射驱动器进行文件共享，因为它相对简单？有没有人在他们自己的组织内有任何经验或对此有想法？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T16:36:35.753

SharePoint 非常擅长文档共享。

文档通常遵循审批流程、具有权限、存在于集群中……这些东西很适合 SharePoints 文档库。

但是，有些东西不适合在 SharePoint 中生活...您是否有想要与同事共享的虚拟硬盘驱动器 (.vhd) 文件？尝试将 20GB 文件放入 SharePoint 并不是一个好主意。

SharePoint 可以处理大文件，它背后的 SQL Server 也可以...但是您是否希望您的 SQL Server 带宽被如此大的文件饱和？您是否希望您的 SQL Server 备份多次保存此类大文件的副本？

我相信有一些 Microsoft 合作伙伴提供了将文件 blob 与 SharePoint 数据库分离的功能，以便 SharePoint 可以保存元数据，而文件系统保存实际文件，SharePoint 只是成为管理访问、权限、并为整个组织的文件提供集中式界面。这将为您提供两全其美的体验。

不过现在，我认为 SharePoint 是文档的理想选择，并且我将大文件（不是以文档为中心的）保存在 Windows 文件共享中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T20:18:38.253

在更改文档管理工具时可以忽略的一件事是围绕将要存储的数量以及信息架构问题（例如不同内容的最终位置）所需的规划。

如果没有好的计划，SharePoint 尤其容易设置，并且当事情变得繁忙时特别容易遇到困难。

我不会推荐这样的本土应用程序。这个问题已经通过现成的工具解决了，从头开始开发一个将花费大量成本，而且不会让你以任何方式接近这些功能。

我有没有提到规划您的安全组和文档区域 (IA) 的重要性？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T18:17:02.913

明确地说，使用工具。

这里的主要好处是版本控制。能够轻松跳转到以前的版本，比较并查看谁修改了什么（参见大多数 VCS 的责备/注释工具 - 它打印出一个文本文件，显示何时/谁修改了文本文件中的每一行）。

其次，您可能会从问题跟踪/任务跟踪中受益。

其他好处包括从 Internet 访问网络、拥有 wiki（在某些情况下可能很棒）等。

我在工作中使用 Subversion + Redmine，我发现它非常有用 - 测试一些解决方案，您一定会发现更多优势。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T21:15:11.087

如果您只需要文档存储，那么 sharepoint 可以做得很好。WSS 是免费的，它提供了非常好的文档存储功能。

但是您必须仔细计划，因为更新现有应用程序很痛苦。如果您决定使用 Sharepoint，那么我可以给您一些建议

1.  注意安全配置（用户组，权限，..）
2.  计划好您的文档库，因为在它们之间移动文档并不容易
3.  还要考虑限制一个文档可以拥有的版本数量，因为 sharepoint 存储版本之间的完整备份，而不仅仅是更改
4.  不要使用 infopath :) 我们对它的体验非常糟糕（只是不要告诉经理）
5.  如果您真的不需要更改 Sharepoint 的图形外观而不是打扰它，因为它会带来很多问题（我说的是自定义母版页和自定义站点模板）
6.  尝试尽可能多地使用 OOB 的东西，因为开发自己的 webpart 不仅成本更高，而且可能相当复杂。
7.  确保打开搜索索引。这很棘手，因为默认情况下它是关闭的，然后你会惊讶于搜索没有像我一样工作:)

如果您尝试仅部署它并将 10.000 个文档加载到其中，那么您以后肯定会遇到问题。如果你稍微考虑一下结构，那么你最终会得到非常好的文档存储。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-11T05:38:45.810

从长远来看，迁移很可能是值得的。您将获得可靠性、版本控制、可追溯性和可扩展性。

请务必首先确定组/权限，并确定需要修复哪些链接（也许您有使用共享链接的应用程序）。

SharePoint 的开源替代品是[Alfresco](http://www.alfresco.com/)，它也非常适合 CIFS（Windows 共享）。

# c# - 具有类层次结构的 NHibernate 映射，其基类是抽象的，鉴别器不是字符串

> ID：326174
> 
> 赞同：9
> 
> 时间：2008-11-28T16:33:18.817
> 
> 标签：c#, nhibernate, fluent-nhibernate, nhibernate-mapping, domain-driven-design

以下是域模型类：

```
public abstract class BaseClass
{
...
}

public class ChildClass : BaseClass
{
...
} 
```

请注意，父类是抽象的，当需要使用流利的 nhibernate 进行映射时，这给了我一些困难。我的鉴别器是一个字节（数据库中的tinyint）。因为它不是字符串，我无法在基类上设置鉴别器值，所以这不起作用（取自 BaseClass 的映射类）：

```
DiscriminateSubClassesOnColumn<byte>("Type")
    .SubClass<ChildClass>()
    .IsIdentifiedBy((byte)OperationType.Plan)
    .MapSubClassColumns(p => { ... }) 
```

我得到的错误信息是：

类初始化方法 UnitTest1.MyClassInitialize 抛出异常。NHibernate.MappingException：NHibernate.MappingException：无法将鉴别器值格式化为实体 BaseClass 的 SQL 字符串 ---> System.FormatException：输入字符串的格式不正确..

以下帖子似乎解释了会发生什么。他们用 xml 提供了一个解决方案，但没有用流利的 nhibernate： http: [//forum.hibernate.org/viewtopic.php? t=974225](http://forum.hibernate.org/viewtopic.php?t=974225)

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-28T19:04:59.293

我找到了一种解决方法，但这看起来很像一个补丁......我在映射文件中添加了以下内容：

```
SetAttribute("discriminator-value", "-1"); 
```

它似乎指示 FNH 不要为抽象基类使用字符串（我认为它使用类名）。为了使它与 -1 值一起工作，我还将鉴别器类型从字节更改为 sbyte。

**编辑：** 我错过了：这是 DiscriminateSubClassesOnColumn 的第二个参数，它采用默认值。所以我的问题的正确答案是：

```
DiscriminateSubClassesOnColumn<sbyte>("Type", (sbyte)-1) 
```

# c++ - 我需要组合几种方法而不添加一些数据成员。有任何想法吗？

> ID：326179
> 
> 赞同：1
> 
> 时间：2008-11-28T16:35:36.427
> 
> 标签：c++, oop

假设我需要编写几个处理一些数据的函数。这些函数正在执行一项任务——一些数学计算。我想没有必要将它们与一些数据成员结合起来。

我应该使用：

1.  一个没有数据成员的类，并将这些函数声明为静态方法，这样我就可以在不创建类对象的情况下使用它们，
2.  或匿名命名空间，
3.  或者我在架构和设计方面需要更复杂的东西？

其实我写的语言是C++，但是我觉得这个问题不取决于开发的语言是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T16:38:09.103

在 C++ 中，我会使用实用程序命名空间，而不是只有静态方法的类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T16:45:33.100

我不明白为什么要将它们放在匿名名称空间中。这样做是为了确保这些函数仅在一个编译单元中使用，这与您的问题无关。

现在，要在类中的静态函数或实用程序命名空间中的自由函数之间进行选择，这取决于您的需要。这些解决方案之间存在一些差异：

*   在类中，您可以将一些函数设置为私有、受保护或公共。例如，您可能有私有函数来执行公共函数所需的常见事情。
*   命名空间可以扩展，它们的定义分布在多个文件中。
*   类可以被子类化（因此它们的功能也可以被扩展）。您可以拥有一个模型，其中包含受保护的静态函数和客户端类的子类，以便更好地封装。

# c# - 是否可以在 MS Entity Framework 中查询新添加的对象

> ID：326186
> 
> 赞同：5
> 
> 时间：2008-11-28T16:40:15.747
> 
> 标签：c#, .net, entity-framework, orm, persistence

有没有办法在实体框架中查询或访问新添加的对象（使用 ObjectContext.AddObject 方法）？我的意思是尚未使用 SaveChanges 将其保存到数据存储的情况

我知道查询被转换为底层 SQL 并针对数据存储执行，并且它还没有这个新对象。但无论如何，我很好奇 - 如果没有官方支持，也许理论上是可能的。如果不是，开发人员如何处理它？手动跟踪新对象并使用 Linq to 对象查询它们？

同样的问题也适用于 LinqToSql。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T10:06:17.440

在 EF 中，如果您使用此代码，您将拥有已在上下文中加载的所有实体（包括新添加的实体）：

```
context.ObjectStateManager.GetObjectStateEntries(EntityState.Added | EntityState.Modified | EntityState.Unchanged).Select(o => o.Entity).OfType<YourObjectType>() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T10:09:43.237

“同样的问题也适用于 LinqToSql。”

对于 LINQ-to-SQL，请查看[`DataContext.GetChangeSet()`](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.getchangeset.aspx); 这有3 个独立的待处理[集合](http://msdn.microsoft.com/en-us/library/system.data.linq.changeset_properties.aspx)`.Inserts`，`.Updates`并且`.Deletes`

请注意，这是调用该方法`ChangeSet`时的快照；`GetChangeSet()`您需要重新查询以查看任何其他更改。

# reporting-services - SSRS 表达式评估问题

> ID：326193
> 
> 赞同：1
> 
> 时间：2008-11-28T16:42:37.193
> 
> 标签：reporting-services, evaluation, expression, operator-precedence

我对报告中的表达式有疑问。我正在根据表格中的值为表格中的文本框的背景着色。该字段中的文本与 SQL Server 的备份有关。该值是日期或文本“尚未采取”。如果日期超过 2 天，我希望背景为黄色。如果它超过一周或日期值为“尚未采取”，我希望背景为红色。否则，它将是绿色的。

自从我开始编写 SSRS 报告（几周前）以来，我一直遇到的问题是我的表达似乎得到了充分评估。一个 IF 语句将同时评估其真值和假值，即使只使用其中一个。

这成为一个问题，因为“尚未采取”显然不是日期，并且要使用我需要将日期字符串转换为日期的日期。这是我目前的代码：

```
=IIF(Fields!LastBackUpTaken.Value = "Not Yet Taken","Red", IIF( IsDate(Fields!LastBackUpTaken.Value) = true,
  IIF( CDate(Fields!LastBackUpTaken.Value).AddDays(Parameters!DaysTillExpiry.Value).CompareTo(NOW()) = 1,
          "GreenYellow",
      IIF( CDate(Fields!LastBackUpTaken.Value).AddDays(7).CompareTo(NOW()) = 1, "Yellow", "Red")),
  "Red")) 
```

所以基本上，表达式为“如果 LastBackUpTaken.Value = “Not Yet Taken”，则返回红色。如果不是“Not Yet Taken”，则检查字符串是否为日期。如果不是日期，返回红色。如果是日期，则进行计算并返回适当的颜色。

此表达式适用于所有没有“尚未采用”作为其文本的文本字段。对于将“尚未采用”作为其文本的字段，没有任何颜色设置。

编辑：每当文本为“尚未采用”时，我也会收到一个我忘记提及的转换错误

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T18:03:56.013

编写一个 VB 函数，在 Report Properties 的 Code Tab 中返回颜色字符串。在这里，您可以使用您熟悉的语言结构（case 语句、常规 if 语句等）。逻辑也更容易读回。

```
Public Function GetBackgroundColor(ByVal DateString as String) As String
    'plain old vb syntax here
End Function 
```

在背景颜色属性的表达式中：

```
=Code.GetBackgroundColor(Fields!LastBackUpTaken.Value) 
```

# c# - ASP.Net 表单数据绑定问题

> ID：326194
> 
> 赞同：2
> 
> 时间：2008-11-28T16:43:40.763
> 
> 标签：c#, asp.net, forms, databound

我知道这个论坛上也有类似的问题，但解决方案对我并没有真正起作用。我正在使用来自几个不同数据源的字段填充表单控件，并且数据显示得很好。

我有一个`ImageButton`控件，它`OnClick`设置了一个事件来从表单中获取所有数据。不幸的是，当我单击按钮时，似乎页面首先重新加载，然后执行`OnClick`调用。手动输入或硬编码的数据似乎可以从输入的控件中很好地提取，但是从数据源提取的任何内容都无法读取。有任何想法吗。这是我已经工作了 6 个月的项目中的最后一个障碍。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-28T16:55:29.833

您是在谈论下拉菜单还是网格视图？你什么时候绑定数据，页面加载？

好的设计会让你在页面加载时绑定你的数据，但仅限于

```
if(!isPostBack){
    dropdown.databind()
    gridview.databind()
}. 
```

否则它将重新绑定每个页面加载。如果它没有重新加载，你可以从这些控件中获取选定的值，如果那是你要找的。

另一种方法是使用数据源对象在 aspx 页面中设置数据源和数据绑定。这会自动执行上述操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T17:15:10.807

实际上，它是隐藏字段、下拉列表、标签和文本字段。我只是尝试在`init`和中进行绑定`load`，但没有骰子。当我尝试`!isPostBack`仅绑定它时，没有显示任何字段。

我认为主要问题之一是我得到的数据集来自对 API 的方法调用。我很好地收到了数据，但它以编程方式输入，然后我也必须以编程方式进行所有控制设置。您想查看想法的代码吗？感谢您的帮助，今天没有人工作！

杰森

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-29T03:10:02.120

您是否在控件上启用了视图状态？发布代码示例将大大有助于解决您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-08T12:20:45.183

当您首先单击 asp.net 中的底部时，所有页面事件都会发生，例如`Page_Load`和...然后事件发生（在这种情况下`Click`）。但是因为一切都在重新加载，我认为`!isPostback`您的代码中有一个用于绑定数据的代码，您应该删除它以便每次都获取您的数据。或者如果不是解决方案，请发布一些代码和更多问题描述

# css - FF3/Windows CSS z-index problem with YouTube player

> ID：326196
> 
> 赞同：43
> 
> 时间：2008-11-28T16:45:27.577
> 
> 标签：css, flash, firefox, youtube, z-index

I'm stuck on what appears to be a CSS/z-index conflict with the YouTube player. In Firefox 3 under Windows XP, Take a look at this page: [http://spokenword.org/program/21396](http://spokenword.org/program/21396) Click on the Collect button and note that the pop-up <div> appears *under* the YouTube player. On other browsers the <div> appears on top. It has a z-index value of 999999\. I've tried setting the z-index of the <object> element containing the player to a lower value, but that didn't work. Any idea how to get the pop-up to appear over the player?

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-11-28T16:57:10.157

Try to add the `wmode` parameter to be `opaque` like this:

(Note that it's included in *both* a `<param>` tag **and** a `wmode` attribute on the `<embed>` tag.)

```
<object width='425' height='344'> 
    <param name='movie' value='http://www.youtube.com/v/Wj_JNwNbETA&hl=en&fs=1'> 
    <param name='type' value='application/x-shockwave-flash'> 
    <param name='allowfullscreen' value='true'> 
    <param name='allowscriptaccess' value='always'> 
    <param name="wmode" value="opaque" />
    <embed width='425' height='344'
            src='http://www.youtube.com/v/Wj_JNwNbETA&hl=en&fs=1'
            type='application/x-shockwave-flash'
            allowfullscreen='true'
            allowscriptaccess='always'
            wmode="opaque"
    ></embed> 
    </object> 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-07-27T20:07:41.967

although the recommendation by CMS is valid, there is an important update. If you want to use 'iframe' instead of 'embed' , simply add `?wmode=transparent` to your video link and that does the magic. I find this more simple and clean.

**Update**, Feb 2014

It's been a while and this may be outdated.

Somebody reported that now `&wmode=transparent` works instead.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-11-26T00:48:22.893

i've found a pure JS function that fix it in all browsers!

there you go:

```
function fix_flash() {
    // loop through every embed tag on the site
    var embeds = document.getElementsByTagName('embed');
    for (i = 0; i < embeds.length; i++) {
        embed = embeds[i];
        var new_embed;
        // everything but Firefox & Konqueror
        if (embed.outerHTML) {
            var html = embed.outerHTML;
            // replace an existing wmode parameter
            if (html.match(/wmode\s*=\s*('|")[a-zA-Z]+('|")/i))
                new_embed = html.replace(/wmode\s*=\s*('|")window('|")/i, "wmode='transparent'");
            // add a new wmode parameter
            else
                new_embed = html.replace(/<embed\s/i, "<embed wmode='transparent' ");
            // replace the old embed object with the fixed version
            embed.insertAdjacentHTML('beforeBegin', new_embed);
            embed.parentNode.removeChild(embed);
        } else {
            // cloneNode is buggy in some versions of Safari & Opera, but works fine in FF
            new_embed = embed.cloneNode(true);
            if (!new_embed.getAttribute('wmode') || new_embed.getAttribute('wmode').toLowerCase() == 'window')
                new_embed.setAttribute('wmode', 'transparent');
            embed.parentNode.replaceChild(new_embed, embed);
        }
    }
    // loop through every object tag on the site
    var objects = document.getElementsByTagName('object');
    for (i = 0; i < objects.length; i++) {
        object = objects[i];
        var new_object;
        // object is an IE specific tag so we can use outerHTML here
        if (object.outerHTML) {
            var html = object.outerHTML;
            // replace an existing wmode parameter
            if (html.match(/<param\s+name\s*=\s*('|")wmode('|")\s+value\s*=\s*('|")[a-zA-Z]+('|")\s*\/?\>/i))
                new_object = html.replace(/<param\s+name\s*=\s*('|")wmode('|")\s+value\s*=\s*('|")window('|")\s*\/?\>/i, "<param name='wmode' value='transparent' />");
            // add a new wmode parameter
            else
                new_object = html.replace(/<\/object\>/i, "<param name='wmode' value='transparent' />\n</object>");
            // loop through each of the param tags
            var children = object.childNodes;
            for (j = 0; j < children.length; j++) {
                try {
                    if (children[j] != null) {
                        var theName = children[j].getAttribute('name');
                        if (theName != null && theName.match(/flashvars/i)) {
                            new_object = new_object.replace(/<param\s+name\s*=\s*('|")flashvars('|")\s+value\s*=\s*('|")[^'"]*('|")\s*\/?\>/i, "<param name='flashvars' value='" + children[j].getAttribute('value') + "' />");
                        }
                    }
                }
                catch (err) {
                }
            }
            // replace the old embed object with the fixed versiony
            object.insertAdjacentHTML('beforeBegin', new_object);
            object.parentNode.removeChild(object);
        }
    }
} 
```

now you can just run in when the page loads with jQuery:

```
 $(document).ready(function () {
            fix_flash();    
 }); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-29T18:36:23.467

We use [jQuery Flash plugin](http://jquery.lukelutman.com/plugins/flash/) to convert YouTube links to Flash movies. In this case, wmode is passed as an option in order to get the YouTube video to appear underneath the jQuery Dialog we open:

```
$('a[href^="http://www.youtube.com"]').flash(
    { width: nnn, height: nnn, wmode: 'opaque' }
); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-09T19:06:51.623

I've noticed that wmode="opaque" terribly affects on usage of CPU. Chrome make on my notebook 50% CPU usage (without opaque ~8%).
So be careful with this option.

# c - C中的通用列表操作函数？

> ID：326202
> 
> 赞同：5
> 
> 时间：2008-11-28T16:49:22.887
> 
> 标签：c, list, function, arguments, generics

什么是 C 中的通用列表操作函数？（我在浏览一些材料时看到了这一点。）

这个函数和可以接受任何类型元素的函数有什么区别？

他们是一样的吗……？如果它们不相同，我们如何单独实现它们？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T17:06:55.723

C 没有“通用”指针或对象的概念——你能得到的最接近的是使用`void*`指针。如果您希望一段代码能够处理任何数据类型，则几乎必须使用`void*`指针。对于大小不大于指针的数据类型，您可以在类型和`void*`;之间进行转换。对于较大的数据类型，您必须使用动态内存并让`void*`成员指向动态内存。请注意内存泄漏！

```
typedef struct list_node {
  struct list_node *next;
  void *data;
} list_node;

void list_insert(list_node *node, void *data) {
  // ...
} 
```

另一方面，如果您想为每种可能的数据类型生成代码，则必须使用宏来完成，然后为您可能使用的每种数据类型实例化宏。例如：

```
#define DEFINE_LIST(type) \
  typedef struct list_node_##type { \
    struct list_node_##type *next; \
    type data; \
  }

#define IMPLEMENT_LIST_INSERT(type) \
  void list_##type##_insert(list_node_##type *node, type data) { \
    ... \
  }

DEFINE_LIST(int);     // defines struct list_node_int
DEFINE_LIST(double);  // defines struct list_node_double
IMPLEMENT_LIST_INSERT(int);    // defines list_int_insert
IMPLEMENT_LIST_INSERT(double); // defines list_double_insert 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T16:53:54.547

通用列表可能是单链接的，并且可能假设列表中的项目具有如下结构：

```
typedef struct list_item list_item;

struct list_item
{
    list_item *next;
    ...data for node...
}; 
```

使用这种布局，您可以编写函数来仅使用 next 指针来操作列表。

有时，' `...data for node...`'会是一个简单的' `void *`'；也就是说，列表项将包含指向列表中下一个节点的指针（如果没有下一个节点，则为 NULL）和指向数据的指针。

```
typedef struct list list;

struct list
{
    list *next;
    void *data;
}; 
```

由于您可以将任何指针强制转换为 ' `void *`'，因此您可以在列表中混合任何数据类型 - 但您的代码必须知道如何处理它们。

您询问“一个”通用列表函数，但可能没有一个单一功能的全能设计，当然也不是一个简单的设计。有许多可能的函数集可以生成通用列表函数。一组受 Lisp 启发，包括：

```
void *car(list *lp);    // Return the data for the first item on the list
list *cdr(list *lp);    // Return the tail of the list
list *cons(list *lp1, list *lp2);   // Construct a list from lists lp1 and lp2

list *cond(list *lp, void *data);  // Append data item to list 
```

您可能希望提供测试列表是否为空以及其他一些项目的能力。

[在 Koenig 的“ Ruminations on C++](https://rads.stackoverflow.com/amzn/click/com/0201423391) ”中可以找到一个很好的说明，诚然是在C++ 中。这些想法可以很容易地应用到 C 中——它并不难（尽管 C 中的存储管理比 C++ 中的更难）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T16:12:02.947

[Linux 内核在其linux/list.h](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=include/linux/list.h;hb=HEAD)头文件中有一个有趣的 C 语言通用链表实现。它是一个带有头节点的双向链表，使用如下：

```
struct mystruct {
    ...
    /* Contains the next and prev pointers */
    struct list_head mylist;
    ...
    /* A single struct can be in several lists */
    struct list_head another_list;
    ...
};

struct list_head mylist_head;
struct list_head another_list_head; 
```

这个小例子中有一些有趣的事情：

*   列表节点嵌入在目标结构中，不需要数据指针。
*   列表节点不必位于目标结构的开头。
*   一个结构体可以同时在多个链表中。
*   列表中的 next 和 prev 指针指向`struct list_head`，而不是目标结构（在上面的示例中，它们指向`&(foo->mylist)`第一个列表和`&(foo->another_list)`第二个列表）。

所有列表操作函数都采用指向的指针`struct list_head`（并且大多数根本不关心它是单独的头节点还是嵌入节点之一）。要从`struct list_head`到目标结构，请使用宏（与[linux/kernel.h](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=include/linux/kernel.h;hb=HEAD)头文件中的宏`list_entry`相同），它扩展为简单的指针减法。`containter_of`

由于它是一个带有头节点的双向链表，您可以在`O(1)`：

*   检查列表是否为空，或者节点是否不在任何列表中。
*   获取任何其他节点之后或之前的节点（如果该节点是头部，则获取列表的第一个或最后一个元素）。
*   在任何其他节点之后或之前插入一个节点（如果该节点是头部，则在列表的开头或结尾插入）。
*   从列表中删除一个节点（您只需要指向节点本身的指针即可执行此操作）。
*   其他几个操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-06T11:02:36.483

为了我的教义，我来开发这个“通用”列表模块，可能是 linux 内核的简化版本，包括其他但未被发现的错误，并且使用 gcc 扩展......欢迎任何评论！

```
#ifndef _LISTE
#define _LISTE
#include <stdlib.h>
typedef struct liste_s {
  struct liste_s * suivant ;
} * liste ;

#define newl(t) ( (liste) malloc ( sizeof ( struct liste_s ) + sizeof ( t ) ) )
#define elt(l,t) ( * ( ( t * ) ( l + 1 ) ) )

#define liste_vide NULL
#define videp(l) ( l == liste_vide )
#define lvide() liste_vide
#define cons(e,l) \
  ({ liste res = newl(typeof(e)) ;      \
     res->suivant = l ; \
     elt(res,typeof(e)) = e ;           \
    res ; }) 

#define hd(l,t) ({ liste res = l ; if ( videp(res) ) exit ( EXIT_FAILURE ) ; elt(res,t) ; })
#define tl(l)   ({ liste res = l ; if ( videp(res) ) exit ( EXIT_FAILURE ) ; res->suivant ;})

#endif 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T03:32:20.437

C 及其标准库不提供任何特定于列表的函数。

但是有许多有用的 C 函数库支持从其他编程语言已知的数据类型：http: [//library.gnome.org/devel/glib/2.18/glib-data-types.html](http://library.gnome.org/devel/glib/2.18/glib-data-types.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-18T05:30:13.360

如上所述，我尝试使用 MACROS 方法来创建列表操作函数。创建 INSERT 操作例程很容易，但很难创建 Delete 和遍历操作。紧随其后的是列表结构和 INSERT 例程签名：

```
#define LIST_DEFINE(type) \
    struct list_node_##type \
    { \
        type *data; \`
        struct list_node_##type *next; \
   };

LIST_INSERT(&ListHead,&Data, DataType); 
```

其中：
`ListHead`- 链表的头
`Data`- 将为其创建新节点并将数据插入节点 `DataType`的数据 - 传递的数据的数据类型

仅供参考，我在函数中分配内存并复制在新创建的节点中传递的所有数据，并将节点附加到链表中。

现在，当`LIST_DELETE`创建例程时，将使用数据中的唯一标识符来标识需要删除的节点。该标识符也`MACRO`作为将在`MACRO`扩展中替换的键在例程中传递。例行签名可以是：

```
LIST_DELETE(&ListHead, DataType, myvar->data->str, char*); 
```

其中：
`ListHead`- 链表的头部
`DataType`- 是数据的数据类型
`myvar->data->str`- 唯一键
`char*`- 键类型

现在，当键扩展时，不能使用相同的键进行比较，就像我们写的一样

```
if((keytype)ListHead->data->key == (keytype)key) 
```

它扩展到

```
ListHead->data->myvar->data->str == myvar->data->str 
```

这里没有像这样的变量：`ListHead->data->myvar->data->str`

因此，这种方法无法编写删除例程，并且由于遍历和搜索例程也使用唯一键，它们也会面临同样的问题。

并且，在不相关的说明中，如何确定唯一键的匹配逻辑，因为唯一键可以是任何东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-10-28T04:00:36.557

我一直在尝试不同的东西。这是另一个视角如何登机的问题

如果我们有以下结构：

```
typedef struct token {
    int id;
    char *name;
    struct token *next;
} Token; 
```

我们需要创建一个返回链表尾部的函数，但该函数对于任何链表都应该是通用的，所以：

```
void* tail(void* list, void* (*f)(void *)) {
    void *head = list;

    while(f(head) != NULL) {
        head = f(head);
    }

    return head;
} 
```

现在有必要创建一个函数来负责在我们的自定义结构与尾部函数中的通用可用性之间建立桥梁。这样，我们就有：

```
void* nextToken(void *a) {
    Token *t = (Token *) t;
    return (void *) (a->next);
} 
```

最后我们可以简单地使用：

```
Token *listTokens;
(...)
Token *lastToken = tail(listTokens, nextToken); 
```

# database - MySQL的替代品

> ID：326203
> 
> 赞同：7
> 
> 时间：2008-11-28T16:49:50.720
> 
> 标签：database, caching, memcached, scalability

我想为我的应用程序持久存储数据，但我并不真正需要一个完整的关系数据库。我真的可以使用基本的“缓存”式*持久*存储，其中结构只是一个（键，值）对。

代替数据库，我最好的、可扩展的选项是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-28T16:53:52.397

总是有[SQLite](http://www.sqlite.org/)，一个存储在文件中的数据库。SQLite 已经内置了并发性，因此您不必担心文件锁定之类的事情，而且读取速度非常快。

但是，如果您要进行大量数据库更改，最好在一个[事务](http://www.sqlite.org/lang_transaction.html)中一次完成所有更改。这只会将更改写入文件一次，而不是每次发出更改查询。这极大地提高了进行多项更改的速度。

发出更改查询时，无论是否在事务中，整个数据库都会被锁定，直到该查询完成。这意味着非常大的事务可能会对其他进程的性能产生不利影响，因为它们必须等待事务完成才能访问数据库。在实践中，我并没有发现这很明显，但尝试尽量减少您发出的数据库修改查询的数量始终是一个好习惯。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-28T17:16:31.850

如果您想要一个“持久缓存”，并且已经使用[memcached](http://www.danga.com/memcached/)，请检查[memcachedb](http://www.memcachedb.org)。它是一个使用 memcached 协议的持久哈希表，不需要新的客户端（但需要一个新的守护进程）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-28T19:19:10.933

我最近问了一个[类似的问题。](https://stackoverflow.com/questions/260885/storing-large-numbers-of-varying-size-objects-on-disk)以下是一些选择：

*   [Berkley DB](http://www.oracle.com/technology/products/berkeley-db/index.html)很时髦。（另见[Berkley DB 维基百科条目](http://en.wikipedia.org/wiki/Berkeley_DB)）
*   如果您在 Windows 上，那么您可以使用内置的[可扩展存储引擎](http://msdn.microsoft.com/en-us/library/ms684493(VS.85).aspx)。这曾经被称为“Jet Blue”。
*   [Microsoft SQL Compact Edition](http://support.microsoft.com/kb/920700)也是免费的（但未内置在操作系统中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-28T16:55:37.150

如果您需要可扩展性，那么 RDBMS 是您的最佳选择。在最基本的层面上，您可以将数据结构序列化为文件 - 但是，您需要考虑会限制并发性的文件锁定问题。

SQLite 是一个基于 SQL 文件的数据库引擎，它可以在没有持久数据库守护程序的情况下运行（例如，在 PHP 中，它作为扩展运行），但是它也存在并发问题（阅读[这个问题](https://stackoverflow.com/questions/320803/is-sqlite-suitable-for-use-in-a-production-website)的答案，这可以帮助您决定是否SQLite 适合你）。

除非您有充分的理由不使用真正的 DRBMS，否则我建议您坚持使用 MySQL 或其他“成熟的”引擎。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T16:53:02.443

如果您想要一些真正可扩展的东西，我不会选择平面文件或 XML 文件。随着数据的增长，它可能会影响您的性能。

*如果您在某个阶段*会有大量数据，我仍然会选择数据库 - 我会看一下[SQLIte 之](http://www.sqlite.org/)类的东西，它有一个非常简单的模式来满足您的需求。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T16:54:32.643

我真的不确定您是否*应该*这样做，但您是否考虑过将信息存储在 XML 文档中，如果它真的那么轻吗？如果你没有考虑[SQLite](http://www.sqlite.org/)？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T17:04:42.733

如果您编写一个需要嵌入式数据库的 java 程序，请查看[hsqldb](http://hsqldb.org)，因为它是用 java 编写的，并且如果从 java 程序中调用它，那么它比 sqlite 好得多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-28T17:08:46.157

如果您正在编写 Java，那么您可以直接包含 Java 数据库实现（Jared 提到了 hsqldb，还有其他）。

SQLite 适合静态包含，但如果您使用 C 等兼容语言，您也可以在应用程序中包含 MySQL。

我想你也会很高兴有 SQL 可用。XML 文件不再适用了，也许是几年前在编写 PDA 软件时，但现在即使是 iPhone 和 Android 也包含 SQLite。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-28T17:15:37.030

内存模式下的 hsqldb 将为您提供比基于平面文件的数据库更好的性能。它也很容易使用。如果表变得太大，也可以选择将其缓存在磁盘上。查看此性能比较：

[![http://hsqldb.org/images/imola_retrieve.jpg](https://i.stack.imgur.com/H9C4x.jpg)](https://i.stack.imgur.com/H9C4x.jpg)
[（来源：[hsqldb.org](http://hsqldb.org/images/imola_retrieve.jpg)）]

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-28T18:00:10.110

对于 Key=Value 对，您可以使用带有简单加载和保存过程的 INI 文件格式来加载它并将其保存到内存中的哈希表中。

以后可以扩展到任何东西，只需更改加载和保存过程以使用 db。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-28T18:28:31.393

您可以尝试[CounchDB](http://incubator.apache.org/couchdb/)，它是一个非常灵活的面向文档的数据库，不会强制您预先定义模式。它是用 Erlang 编写的，因此它被认为是非常可扩展的解决方案。可以通过 REST 接口轻松查询。

# c - 什么是 C 中的前向引用？

> ID：326205
> 
> 赞同：6
> 
> 时间：2008-11-28T16:52:09.247
> 
> 标签：c, pointers, forward-reference

什么是 C 中关于指针的前向引用？

我可以举个例子吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-28T16:54:27.760

请参阅此页面的[前向引用](https://web.archive.org/web/20080314031412/http://h30097.www3.hp.com/docs/base_doc/DOCUMENTATION/V40F_HTML/AQTLTBTE/DOCU_024.HTM)。我看不出前向引用与指针和其他 PoD 类型有何不同。

请注意，您可以转发声明类型，并声明指向该类型的变量：

```
struct MyStruct;
struct MyStruct *ptr;
struct MyStruct var;  // ILLEGAL
ptr->member;  // ILLEGAL

struct MyStruct {
    // ...
};

// Or:

typedef struct MyStruct MyStruct;
MyStruct *ptr;
MyStruct var;  // ILLEGAL
ptr->member;  // ILLEGAL

struct MyStruct {
    // ...
}; 
```

我认为这是您在处理指针和前向声明时所要求的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-28T17:22:23.040

我认为关于指针的“前向引用”意味着这样的事情：

```
struct MyStruct *ptr; // this is a forward reference.

struct MyStruct
{
  struct MyStruct *next; // another forward reference - this is much more useful
  // some data members
}; 
```

指针在定义它指向的结构之前声明。

编译器可以解决这个问题，因为指针存储了一个地址，并且您不需要知道该地址是什么来为指针保留内存。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-28T17:45:49.437

前向引用是当您声明一个类型但不定义它时。

它允许您通过指针（或 C++ 的引用）使用类型，但您不能声明变量。

这是一种告诉编译器存在某些东西的方式

假设您在**Plop.h**中定义了一个 Plop 结构：

```
struct Plop
{
   int n;
   float f;
}; 
```

现在您想添加一些适用于该结构的实用程序函数。您创建另一个文件**PlopUtils.h**（假设您无法更改 Plop.h）：

```
struct Plop; // Instead of including Plop.h, just use a forward declaration to speed up compile time

void doSomething(Plop* plop);
void doNothing(Plop* plop); 
```

现在，当您实现这些功能时，您将需要结构定义，因此您需要在 PlopUtils.cpp 中包含 Plop.h**文件**：

```
#include "PlopUtils.h"
#include "Plop.h" // now we need to include the header in order to work with the type

void doSomething(Plop* plop)
{
   plop->n ...
}

void doNothing(Plop* plop);
{
   plop->f ...
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-28T20:36:58.403

我认为 C 编译器最初有一个过程，它可以一起进行符号表构建和语义分析。例如：

```
 ....
    ... foo(a,b) + 1 ... // assumes foo returns int
    ....

    double foo(double x, double y){ ... } // violates earlier assumption 
```

为了防止这种情况，你说：

```
 double foo(double x, double y); // this is the forward declaration

    ....
    ... foo(a,b) + 1 ... // correct assumptions made
    ....

    double foo(double x, double y){ ... } // this is the real declaration 
```

帕斯卡也有同样的概念。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-29T01:19:40.550

添加到以前的答案。强制前向引用的典型情况是 struct foo 包含指向 struct bar 的指针，而 bar 包含指向 foo 的指针（声明之间的循环依赖）。在 C 中表达这种情况的唯一方法是使用前向声明，即：

```
struct foo;

struct bar
{
   struct foo *f;
};

struct foo
{
   struct bar *b;
}; 
```

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2008-11-28T18:03:44.767

前向引用允许 C 编译器执行更少的传递并显着减少编译时间。大约 20 年前，当计算机速度慢得多且编译器效率低下时，这可能很重要。

# jsp - 在 JSP 应用程序中最多强制一个用户

> ID：326206
> 
> 赞同：1
> 
> 时间：2008-11-28T16:52:35.533
> 
> 标签：jsp, session, login

我正在使用 JSP 开发一个 Web 工具，其中有许多多种类型的用户（即管理员、来宾、允许写入的用户，...）。由于这将是一个基于订阅的系统（即用户支付 3/6/12 个月的订阅费用），我需要同时强制每个用户最多登录 1 次。例如，假设 John Smith 先生订阅了这个系统；我不希望他将他的登录信息提供给他的一个朋友，这样他们就可以同时从两台不同的计算机上使用该系统。我该如何处理这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-01T00:31:17.850

我不知道您使用的是哪个框架（如果有的话）（您只指定了 JSP）。但是，如果您的应用程序的其余部分正在利用 Spring 框架，则此功能已经在 Spring Security 项目的ConcurrentSessionFilter[中](http://static.springsource.org/spring-security/site/index.html)实现[。](http://static.springsource.org/spring-security/site/reference/html/appendix-namespace.html#nsa-concurrent-session-control)它支持多种检测和处理并发登录的方法，包括上面 Peter Hilton 建议的一种。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T23:51:57.680

1.  当用户登录时，`HttpSession.getId()`为该用户存储。这可以在从用户名到会话 ID 的应用程序范围映射中，或者在数据库中。
2.  对于每个后续请求，对于已登录的用户，检查该请求`request.getSession().getId()`是为该用户存储的请求。
3.  如果请求会话 ID 不是为该用户存储的 ID，则它必须是较新会话的 ID，以便以后使用相同的用户名登录。在这种情况下，通知用户另一个登录已经接管，并调用`request.getSession().invalidate()`注销用户。

要记住的主要事情是，给定另一个会话的存储会话 ID - 而不是当前会话 - 您不能取消另一个会话。

此外，除非您在超时后清除存储的会话 ID，否则您无法拒绝第二次登录尝试，因为您无法判断第一个会话是否仍处于活动状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T17:04:31.827

当用户登录时，您将希望使他们当时可能拥有的任何其他登录无效。这意味着对发出的每个请求进行检查，但无论如何您都应该进行基本验证。例如，您可以检查他们正在访问的 IP 地址或 servlet 会话 ID 等。无论如何，这些都是需要跟踪的好东西，特别是对于事实/报告日志记录。

然后，您可以使用注销的烦恼来执行您的策略，而不会导致无法从一个系统转到另一个系统并继续使用该界面。

使用上述事实/报告日志来分析登录，以查看是否有任何使用模式与典型的单个用户不匹配 - 例如，会话在两台或多台计算机之间频繁交换，尤其是在相似的时间。

# sql - SQL 错误和存储过程表

> ID：326213
> 
> 赞同：0
> 
> 时间：2008-11-28T16:53:58.417
> 
> 标签：sql, tsql, stored-procedures

我在每个存储过程的末尾都有我在网上找到的这段代码：

```
ROLLBACK TRANSACTION

         PRINT '-----START: ERROR DETAILS-----'
         PRINT ERROR_NUMBER()
         PRINT ERROR_SEVERITY()
         PRINT ERROR_STATE()
         PRINT ERROR_PROCEDURE()
         PRINT ERROR_LINE()
         PRINT ERROR_MESSAGE()
         PRINT '-----END: ERROR DETAILS-----'

            DECLARE @prmErrmsg NVARCHAR(4000);
            DECLARE @prmErrSvr INT;

            SELECT @prmErrmsg = ERROR_MESSAGE()
                ,@prmErrSvr = ERROR_SEVERITY();

            INSERT INTO dbo.myErrors
                        ([ErrorMessage]
                        ,[ErrorSeverity]
                        ,[DateCreated])
                 VALUES
                        (@prmErrmsg
                        ,@prmErrSvr
                        ,GetutcDate())

            RAISERROR(@prmErrmsg,@prmErrSvr,1) 
```

它正在将条目写入 myErrors 表，但不会写入错误消息或错误严重性。

我的第一个问题是为什么？

我相信这与错误严重程度在一定范围内有关。

无论严重程度如何，我如何告诉它始终记录详细的错误消息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T17:37:37.597

根据[MSDN](http://msdn.microsoft.com/en-us/library/ms190358.aspx)， ERROR_MESSAGE() 等仅在 TRY ... CATCH 语句的 CATCH 块内设置。

# c# - 覆盖子类中的字段或属性

> ID：326223
> 
> 赞同：161
> 
> 时间：2008-11-28T16:58:54.397
> 
> 标签：c#, properties, field

我有一个抽象基类，我想声明一个字段或属性，在从该父类继承的每个类中将具有不同的值。

我想在基类中定义它，这样我就可以在基类方法中引用它——例如覆盖 ToString 以说“这个对象是*属性/字段*类型”。我有三种方法可以看到这样做，但我想知道 - 最好或接受的方法是什么？新手问题，不好意思。

**选项 1：**
使用抽象属性并在继承的类上覆盖它。这得益于强制执行（您必须覆盖它）并且它是干净的。但是，返回一个硬编码值而不是封装一个字段感觉有点不对劲，而且它是几行代码而不是仅仅几行代码。我还必须为“set”声明一个主体，但这不太重要（并且可能有一种方法可以避免我不知道的情况）。

```
abstract class Father
{
    abstract public int MyInt { get; set;}
}

class Son : Father
{
    public override int MyInt
    {
        get { return 1; }
        set { }
    }
} 
```

**选项 2**
我可以声明一个公共字段（或受保护的字段）并在继承的类中显式覆盖它。下面的例子会给我一个使用“new”的警告，我可能可以这样做，但感觉不对，它破坏了多态性，这就是重点。好像不是什么好主意...

```
abstract class Mother
{
    public int MyInt = 0;
}

class Daughter : Mother
{
    public int MyInt = 1;
} 
```

**选项 3**
我可以使用受保护的字段并在构造函数中设置值。这看起来很整洁，但依赖于我确保构造函数始终设置它，并且对于多个重载的构造函数，总是有可能某些代码路径不会设置值。

```
abstract class Aunt
{
    protected int MyInt;
}

class Niece : Aunt
{
    public Niece()
    {
        MyInt = 1;
    }
} 
```

这是一个理论上的问题，我想答案必须是选项 1，因为它是唯一*安全*的选择，但我刚刚开始掌握 C#，并想问有更多经验的人。

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2008-11-29T12:43:30.917

在三个解决方案中，只有**选项 1**是**多态**的。

字段本身不能被覆盖。这正是**选项 2**返回 ***新***关键字警告的原因。

警告的解决方案不是附加“new”关键字，而是实现选项 1。

**如果你需要你的字段是多态的，你需要将它包装在一个属性中。**

**如果您不需要多态行为，则**选项 3可以。**但是您应该记住，在运行时访问属性 MyInt 时，派生类无法控制返回的值。基类本身能够返回此值。**

 **这就是您的属性的真正多态实现的外观，允许派生类处于*控制*之中。

```
abstract class Parent
{
    abstract public int MyInt { get; }
}

class Father : Parent
{
    public override int MyInt
    {
        get { /* Apply formula "X" and return a value */ }
    }
}

class Mother : Parent
{
    public override int MyInt
    {
        get { /* Apply formula "Y" and return a value */ }
    }
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-28T17:11:37.477

选项 2 是一个非首发 - 你不能*覆盖*字段，你只能*隐藏*它们。

就个人而言，我每次都会选择选项1。我尝试始终将字段保密。那是如果你真的需要能够完全覆盖该属性，当然。另一种选择是在从构造函数参数设置的基类中具有只读属性：

```
abstract class Mother
{
    private readonly int myInt;
    public int MyInt { get { return myInt; } }

    protected Mother(int myInt)
    {
        this.myInt = myInt;
    }
}

class Daughter : Mother
{
    public Daughter() : base(1)
    {
    }
} 
```

如果值在实例的生命周期内不发生变化，这可能是最合适的方法。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-11-13T19:47:38.083

你可以这样做

```
class x
{
    private int _myInt;
    public virtual int myInt { get { return _myInt; } set { _myInt = value; } }
}

class y : x
{
    private int _myYInt;
    public override int myInt { get { return _myYInt; } set { _myYInt = value; } }
} 
```

virtual 让你得到一个属性，一个做某事的主体，仍然让子类覆盖它。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-28T17:33:04.530

选项 2 是个坏主意。它会导致一种叫做阴影的东西；基本上，您有两个不同的“MyInt”成员，一个在母亲中，另一个在女儿中。这样做的问题是，在母亲中实现的方法将引用母亲的“MyInt”，而在女儿中实现的方法将引用女儿的“MyInt”。这可能会导致一些严重的可读性问题，以及以后的混乱。

就个人而言，我认为最好的选择是 3；因为它提供了一个清晰的集中值，并且可以由孩子在内部引用，而无需定义自己的字段——这是选项 1 的问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-28T17:08:58.293

你可以这样定义：

```
abstract class Father
{
    //Do you need it public?
    protected readonly int MyInt;
}

class Son : Father
{
    public Son()
    {
        MyInt = 1;
    }
} 
```

通过将值设置为只读，它可以确保该类的值在对象的生命周期内保持不变。

我想下一个问题是：你为什么需要它？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-07-26T19:20:29.453

如果您正在构建一个类并且您希望有一个属性的基值，那么`virtual`在基类中使用关键字。这允许您有选择地覆盖该属性。

使用上面的示例：

```
//you may want to also use interfaces.
interface IFather
{
    int MyInt { get; set; }
}

public class Father : IFather
{
    //defaulting the value of this property to 1
    private int myInt = 1;

    public virtual int MyInt
    {
        get { return myInt; }
        set { myInt = value; }
    }
}

public class Son : Father
{
    public override int MyInt
    {
        get {

            //demonstrating that you can access base.properties
            //this will return 1 from the base class
            int baseInt = base.MyInt;

            //add 1 and return new value
            return baseInt + 1;
        }
        set
        {
            //sets the value of the property
            base.MyInt = value;
        }
    }
} 
```

在一个程序中：

```
Son son = new Son();
//son.MyInt will equal 2 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-28T17:05:36.320

我会选择选项 3，但有一个抽象的 setMyInt 方法，子类必须强制实现。这样您就不会遇到派生类忘记在构造函数中设置它的问题。

```
abstract class Base 
{
 protected int myInt;
 protected abstract void setMyInt();
}

class Derived : Base 
{
 override protected void setMyInt()
 {
   myInt = 3;
 }
} 
```

顺便说一句，如果您不指定设置，则使用选项一；在您的抽象基类属性中，派生类不必实现它。

```
abstract class Father
{
    abstract public int MyInt { get; }
}

class Son : Father
{
    public override int MyInt
    {
        get { return 1; }
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-28T17:06:22.493

如果您修改抽象基类以要求构造函数中的属性值，则可以使用选项 3，您不会错过任何路径。我真的会考虑这个选项。

```
abstract class Aunt
{
    protected int MyInt;
    protected Aunt(int myInt)
    {
        MyInt = myInt;
    }

} 
```

当然，您仍然可以选择将字段设为私有，然后根据需要公开受保护或公共属性的 getter。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-11-02T20:30:25.507

我做了这个...

```
namespace Core.Text.Menus
{
    public abstract class AbstractBaseClass
    {
        public string SELECT_MODEL;
        public string BROWSE_RECORDS;
        public string SETUP;
    }
}

namespace Core.Text.Menus
{
    public class English : AbstractBaseClass
    {
        public English()
        {
            base.SELECT_MODEL = "Select Model";
            base.BROWSE_RECORDS = "Browse Measurements";
            base.SETUP = "Setup Instrument";
        }
    }
} 
```

这样您仍然可以使用字段。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-07-23T11:18:21.403

当您想要一个带有实现的抽象类时的示例实现。子类必须：

1.  参数化抽象类的实现。
2.  完全继承抽象类的实现；
3.  有自己的实现。

在这种情况下，除了抽象类和它自己的子类之外，实现所必需的属性不应该可供使用。

```
 internal abstract class AbstractClass
    {
        //Properties for parameterization from concrete class
        protected abstract string Param1 { get; }
        protected abstract string Param2 { get; }

        //Internal fields need for manage state of object
        private string var1;
        private string var2;

        internal AbstractClass(string _var1, string _var2)
        {
            this.var1 = _var1;
            this.var2 = _var2;
        }

        internal void CalcResult()
        {
            //The result calculation uses Param1, Param2, var1, var2;
        }
    }

    internal class ConcreteClassFirst : AbstractClass
    {
        private string param1;
        private string param2;
        protected override string Param1 { get { return param1; } }
        protected override string Param2 { get { return param2; } }

        public ConcreteClassFirst(string _var1, string _var2) : base(_var1, _var2) { }

        internal void CalcParams()
        {
            //The calculation param1 and param2
        }
    }

    internal class ConcreteClassSecond : AbstractClass
    {
        private string param1;
        private string param2;

        protected override string Param1 { get { return param1; } }

        protected override string Param2 { get { return param2; } }

        public ConcreteClassSecond(string _var1, string _var2) : base(_var1, _var2) { }

        internal void CalcParams()
        {
            //The calculation param1 and param2
        }
    }

    static void Main(string[] args)
    {
        string var1_1 = "val1_1";
        string var1_2 = "val1_2";

        ConcreteClassFirst concreteClassFirst = new ConcreteClassFirst(var1_1, var1_2);
        concreteClassFirst.CalcParams();
        concreteClassFirst.CalcResult();

        string var2_1 = "val2_1";
        string var2_2 = "val2_2";

        ConcreteClassSecond concreteClassSecond = new ConcreteClassSecond(var2_1, var2_2);
        concreteClassSecond.CalcParams();
        concreteClassSecond.CalcResult();

        //Param1 and Param2 are not visible in main method
    } 
```

# asp.net - ASP.NET 中的自定义缓存

> ID：326224
> 
> 赞同：2
> 
> 时间：2008-11-28T17:00:08.093
> 
> 标签：asp.net, caching

我想在 ASP.NET 应用程序中缓存自定义数据。我将大量数据放入其中，例如 List<objects> 和其他对象。

对此有最佳做法吗？因为如果我使用静态数据，如果`w3p.exe`死亡或被回收，缓存将需要再次填充。

该数据库也被其他应用程序更新，因此需要一个线程来确保它是最新数据。

### 更新1：

刚找到这个，这可能对我有帮助

[http://www.codeproject.com/KB/web-cache/cachemanagementinaspnet.aspx?fid=229034&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2818135#xx2818135xx](http://www.codeproject.com/KB/web-cache/cachemanagementinaspnet.aspx?fid=229034&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2818135#xx2818135xx)

### 更新 2：

我正在使用 DotNetNuke 作为应用程序，(:()。我启用了持久缓存，现在整个应用程序感觉迟缓。

比如一个 Multiview 需要大约 3 秒来交换视图....

### 更新 3：

[网络缓存策略？](https://stackoverflow.com/questions/115126/strategies-for-caching-on-the-web)

与此相关的是，我正在使用 DotNetNuke 缓存方法，该方法又使用 ASP.NET`Cache`对象，它还具有基于文件的缓存。

我有一个帮手：

```
CachingProvider.Instance().Add( _
    (label & "|") + key, _
    newObject, _
    Nothing, _
    Cache.NoAbsoluteExpiration, _
    Cache.NoSlidingExpiration, _
    CacheItemPriority.NotRemovable, _
    Nothing) 
```

哪个运行将对象添加到缓存中，这是正确的吗？因为我想尽可能长时间地缓存它。我有一个每 x 分钟运行一次的线程，它将更新缓存。但我注意到，缓存被清空，我在缓存中检查对象“CacheFilled”。

作为测试，我告诉工作进程不要回收等，但它似乎仍然清除了缓存。我还将 DotNetNuke 设置从“重”更改为“轻”，但认为这是为了模块缓存。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T17:30:41.433

还可以查看 MS 企业缓存应用程序块，它允许您编写自定义过期策略、自定义存储等。 [http://msdn.microsoft.com/en-us/library/cc309502.aspx](http://msdn.microsoft.com/en-us/library/cc309502.aspx)

您还可以查看 [http://code.msdn.microsoft.com/velocity上提供的“Velocity”](http://code.msdn.microsoft.com/velocity)

如果您希望跨服务器扩展应用程序，这将很有用......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T15:07:47.600

根据您的要求，您正在寻找进程外缓存或某种分布式缓存系统。我推荐分布式缓存，因为它具有很强的可扩展性并且专用于缓存。其他人推荐了 Velocity，我们一直在评估并彻底享受它。我们已经编写了几个缓存提供程序，我们可以在评估不同的分布式缓存系统时互换它们，而无需重新构建。当我们作为最终评估的一部分对各种系统进行负载测试时，这将派上用场。

过去，我们的遗留应用程序一直是随机分类的缓存项。有 DataTables、DataViews、Hashtables、Arrays 等，在任何给定时间使用什么都没有逻辑。我们已经开始转向只缓存我们的域对象（即 POCO）集合。使用泛型集合很好，因为我们知道一切都以相同的方式存储。在它们上运行 LINQ 操作非常简单，如果我们需要存储一个专门的“视图”，系统足够高效，可以存储特定的对象集合。

我们还放置了一个抽象层，几乎所有代理都可以在 DAL 或缓存模型之间进行调用。通过这一层的调用将检查缓存未命中或缓存命中。如果有命中，它将从缓存中返回。如果有未命中，并且调用应该被缓存，它将在检索数据后尝试缓存数据。该系统的直接好处是，如果专用于缓存的机器出现硬件或软件故障，我们仍然能够从数据库中检索数据而不会发生真正的中断。当然，在这种情况下，网站的运行速度会变慢。

关于分布式缓存系统，要考虑的另一件事是，由于它们不在进程中，因此您可以让多个应用程序使用相同的缓存。那里有一些有趣的可能性，包括应用程序之间的共享数据库、数据的实时操作等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T20:49:08.910

有很多关于 ASP.NET 中的 Cache 对象以及如何使其使用 SqlDependencies 和其他类型的缓存过期的文章。无需自己编写。并且建议在会话或人们用来将大量数据塞入其中的任何其他集合中使用缓存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T15:02:15.207

Cache 和 Session*可能*会导致行为迟缓，但有时它们是正确的解决方案：适用于正确工作的正确工具规则。

就个人而言，我经常为您描述的那种角色创建伪静态单例中的集合（通常是为了避免 I/O 开销，例如存储已编译的 xslttransform），但请记住，这种缓存很脆弱，这一点非常重要，并为其设计A）。filewatch 或以其他方式监视它应该在适当的地方缓存的内容和 B)。使用 use 重新创建/填充自身 - 它应该会经常刷新。

本质上我推荐它作为性能的拐杖，但不要依赖它来做任何需要真正持久性的事情。

# file - ASP FileUpload 文件大小问题

> ID：326229
> 
> 赞同：1
> 
> 时间：2008-11-28T17:04:54.667
> 
> 标签：file, file-upload, size

我为我的 asp 应用程序使用文件上传控件，当文件上传大小大于最大请求长度时，它会引发 HttpException。

据我了解，一旦文件浏览对话框关闭，文件上传将打开文件的内存流，但无法知道对话框何时关闭，以便我可以决定是否中止上传。

有谁知道在上传开始之前检查文件大小的方法？

垃圾邮件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T17:25:37.837

如果您将文件上传留给内置的 Asp.Net 机制，则如果请求大小大于 web.config（或 machine.config）中设置的最大大小，则上传将失败。

您可以通过编写自己的 HttpHandler 并首先检查请求的大小来解决这个问题，然后在代码中处理请求数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T17:38:13.740

我怀疑是否有一种通用的方法可以在客户端检查文件大小（我的意思是所有浏览器），因为通常客户端脚本无法访问文件系统。

我曾经在服务器端捕获异常，然后在使用经典 ASP 编程时注意到用户。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T18:00:58.500

此控件可让您上传任何大小的文件。我使用它，它非常方便。我相信如果你想要的话，来源就在那里。

[http://www.brettle.com/neatupload](http://www.brettle.com/neatupload)

# asp.net - GridView 中的多个 DataKeyNames

> ID：326233
> 
> 赞同：8
> 
> 时间：2008-11-28T17:07:17.237
> 
> 标签：asp.net, gridview

我有一个从 ObjectDataSource 填充的 GridView，它的 DataKeyNames 字段中有两个项目。一个是主键，ID，另一个是类别字段（类别字段用于添加标题行来划分类别）。

显示效果很好，但我正在尝试创建删除操作。对象的删除方法只需要 ID 字段，并且在 ObjectDataSource 中，即使我将该方法定义为只需要一个 ID 字段，.net 也会抱怨，因为它正在寻找一种方法，该方法具有在 DataKeyNames 中定义的两个字段。

如果我将类别的参数添加到 delete 方法，它会起作用，但是定义一个不用于任何东西的参数会很烦人。

我可以将 ObjectDataSource 和 GridView 对象配置为具有 DataKeyNames 的两个值，但具体应该传递给哪些方法？

这两个对象的（简化）定义是：

```
<asp:ObjectDataSource ID="ObjDS1" runat="server" SelectMethod="getAllItems" 
    TypeName="Items" DeleteMethod="deleteItem">
    <DeleteParameters>
        <asp:Parameter Name="ID" Type="Int32" />
       <!-- This shouldn't be necessary: -->
        <asp:Parameter Name="Category" Type="String" />
    </DeleteParameters>
</asp:ObjectDataSource>

<asp:GridView ID="gvJItems" runat="server" AutoGenerateColumns="False" DataKeyNames="ID,Category" 
    DataSourceID="ObjDS1">
        <Columns>
            <asp:BoundField DataField="ID" Visible="false"  HeaderText="ID" />
            <asp:BoundField DataField="Name" HeaderText="Name" ItemStyle-Width="85%"/>
            <asp:TemplateField>
                <ItemTemplate>
                    <asp:LinkButton ID="lbDelete" Runat="server" 
                        OnClientClick="return confirm('Are you sure you want to delete this?');"
                            CommandName="Delete">Delete</asp:LinkButton>
                </ItemTemplate>
            </asp:TemplateField>
        </Columns>
    </asp:GridView> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-28T20:43:00.747

所有 DataKey 值将始终传递给 Delete 方法，因为由[DataKeyNames](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.datakeynames.aspx)命名的字段旨在成为唯一标识 GridView 中该项目的一个或多个字段。正如您在这里一样，它们通常用于在 ViewState 中以每行为基础轻松维护额外字段，但这样做会产生您在使用 ObjectDataSource 方法时看到的副作用。

要回答您的原始问题，不，您不能在 DataKeyNames 中将 Category 传递给 Delete 方法。不过，您可以通过将值放在模板列中的隐藏输入中来维护 ViewState 中的值。不过，与忽略 Delete 方法的参数相比，获取该值需要更多的工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-18T14:37:11.450

我的 gridview 与对象数据源有同样的问题，我是如何处理这种情况的：我在 SQL 端使用 StoredProcs。我在存储过程中又添加了一个参数，虽然我不需要那个参数。它工作得很好

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-02T17:36:36.913

您可以使用`ObjectDataSource`更新/删除事件来删除它们

```
void ODS_Updating(Object sender, ObjectDataSourceMethodEventArgs e)
{
  e.InputParameters.Remove("Type_ID");
  e.InputParameters.Remove("Document_ID");
  e.InputParameters.Remove("State_ID");
} 
```

我将`DataKeys`用于查找目的，但在更新过程中不需要它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T17:30:12.383

当使用默认的声明式删除方法时，GridView 会将这两个值都传递给 ObjectDataSource。

如果您真的不喜欢额外的参数，另一种方法是取消声明性方法并使用您自己的方法（您可以在那里删除不必要的参数），但这需要更多代码。

# windows-xp - 如何创建自己的 Windows XP 键盘映射？

> ID：326236
> 
> 赞同：4
> 
> 时间：2008-11-28T17:08:55.750
> 
> 标签：windows-xp

[我父亲在这里](http://translit.ru/)找到了他非常喜欢的俄语键盘映射。但是，它是非标准的，因此不会出现在键盘布局选择的语言（*控制面板->区域和语言选项->语言->详细信息->文本服务和输入语言->添加）下拉列表中。*据我了解，创建新映射应该是一项简单的任务 - 可能是编辑 XML 文件并重新启动。有谁知道如何做到这一点？

除此之外，我将如何编写一个程序来模拟这个？似乎它必须在系统托盘中运行（我可以弄清楚），有一个钩子拦截传入的键盘输入（不知道如何做到这一点），将其转换为配置文件，并将其发送到任何应用程序和文本窗口具有当前焦点（同样，不知道）。运气好的话，这应该不会太难。

有什么建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-28T17:15:45.517

[微软](http://www.microsoft.com/globaldev/tools/msklc.mspx)有这个实用程序

> Microsoft Keyboard Layout Creator (MSKLC) 扩展了 Windows 2000、Windows XP、Windows Server 2003 和 Windows Vistas 系统的国际功能，允许用户：

*   从头开始创建新的键盘布局
*   基于现有布局的新布局
*   修改现有键盘布局并从中构建新布局
*   编辑控制字段中的多语言输入区域设置。
*   为 x86、x64 和 IA64 平台构建键盘布局 DLL。
*   打包生成的键盘布局以供后续交付和安装。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T17:11:06.837

试试 AutoHotKey ( [http://www.autohotkey.com/](http://www.autohotkey.com/) ) 我用它在普通文本编辑器中获取 emacs 键绑定，我相信它也可以解决这个问题。

编辑：您要查找的内容在此处的快速入门中：[http ://www.autohotkey.com/docs/Tutorial.htm#Send](http://www.autohotkey.com/docs/Tutorial.htm#Send)

# python - 打包 Python 库

> ID：326254
> 
> 赞同：4
> 
> 时间：2008-11-28T17:19:08.897
> 
> 标签：python, packaging, distutils

我有一些 Munin 插件，它们报告来自 Autonomy 数据库的统计信息。他们都使用一个小型库来抓取相关数字的 XML 状态输出。

我正在尝试将库和插件捆绑到可安装 Puppet 的 RPM 中。实际的 RPM 构建应该是直截了当的；一旦我有了`distutils`-produced 的 distfile，我就可以根据从 Dag 或 EPEL repos [1] 中提取的 .spec 文件将其制作成 RPM。这是`distutils`我不确定的一点——事实上，我什至不确定我的库是否为打包而正确编写。以下是它的工作原理：

偶像7stats.py：

```
import datetime
import os
import stat
import sys
import time
import urllib
import xml.sax

class IDOL7Stats:
  cache_dir = '/tmp'

  def __init__(self, host, port):
    self.host = host
    self.port = port

  # ...

  def collect(self):
    self.data = self.__parseXML(self.__getXML())

  def total_slots(self):
    return self.data['Service:Documents:TotalSlots'] 
```

插件代码：

```
from idol7stats import IDOL7Stats
a = IDOL7Stats('db.example.com', 23113)
a.collect()
print a.total_slots() 
```

我想我希望idol7stats.py 以`/usr/lib/python2.4/site-packages/idol7stats`或Python 搜索路径中的其他内容结束。我需要什么`distutils`魔法？这：

```
from distutils.core import setup

setup(name = 'idol7stats',
  author = 'Me',
  author_email = 'me@example.com',
  version = '0.1',
  py_modules = ['idol7stats']) 
```

几乎可以工作，除了代码进入`/usr/lib/python2.4/site-packages/idol7stats.py`，而不是子目录。我希望这是因为我不了解 Python 中的模块/包/其他容器之间的区别。

那么，有什么问题呢？

[1] 是的，我可以在`/usr/lib/python2.4/site-packages`使用 RPM 时使用库，但我想知道如何打包 Python 代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T17:30:40.620

你需要创建一个*包*来做你想做的事。您需要一个名为的目录`idol7stats`，其中包含一个名为的文件`__init__.py`和要打包的任何其他库模块。此外，这会影响脚本的导入；如果你放入`idol7stats.py`一个名为 的包`idol7stats`，那么你的脚本需要“ `import idol7stats.idol7stats`”。

为避免这种情况，您可以重命名`idol7stats.py`为`idol7stats/__init__.py`，或者您可以将这一行放入`idol7stats/__init__.py`以“按摩”导入到您期望的方式：

```
from idol7stats.idol7stats import * 
```

# .net - 如何使 Windows 资源管理器中的文件夹激活外部应用程序？

> ID：326262
> 
> 赞同：0
> 
> 时间：2008-11-28T17:23:04.677
> 
> 标签：.net, file-monitoring

我需要创建一个应用程序，当用户将文件复制到特定文件夹时，我的应用程序将被激活并且文件将被更改，此外，当用户读回文件夹中的任何文件时，也会对文件。

可能吗？

我将为此使用.net。

我认为文件夹 C:\WINDOWS\assembly 是这样的吗？

任何帮助将不胜感激！谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T17:26:43.420

好吧，我相信您可以编写一个资源管理器扩展来执行此操作，但我所知道的更典型的方法是编写一个 Windows 服务，该服务使用 FileSystemWatcher 类监视相关目录来监视事件。然后该服务可以执行请求的操作（或生成可执行文件来执行此操作）。

我注意到的一个警告是，如果一次发生大量活动（从 .net 2.0 开始 - 尚未检查 3.5），有时文件观察程序可能会错过事件。

如果您使用该方法，请确保在收到更改通知时自己检查目录内容，而不是依赖文件观察程序告诉您的内容。我最终将 filewatcher 事件处理与不频繁的轮询结合起来，以确保我没有错过任何事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T17:35:30.750

您可以使用使用 FileSystemWatcher 的服务检测用户将文件复制到文件夹中。当应用程序读取文件时更改文件的内容需要修补操作系统的病毒技术。像 rootkit 或文件系统过滤器驱动程序。我不建议考虑，在写入文件后更改文件。

c:\windows\assembly 包含 GAC。.NET 安装一个隐藏文件夹内容的外壳扩展处理程序。该文件夹在其他方面非常容易访问，shell 扩展处理程序仅在您使用 Windows 资源管理器查看该文件夹时才有效。Microsoft 强烈反对使用 .NET 编写 shell 扩展处理程序，该框架也完全缺乏支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T17:27:47.663

[您可以使用FileSystemWatcher](http://msdn.microsoft.com/en-us/library/ch2s8yd7.aspx)监视更改。

> 您可以将组件配置为监视整个目录及其内容或给定目录中的特定文件或文件集。每当指定根目录中的文件或子目录被创建、删除、重命名或以其他方式更改时，FileSystemWatcher 组件都会引发事件。组件监控的更改类型包括文件或子目录的属性、大小、上次写入时间、上次访问时间和安全设置的更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T17:28:52.433

您将在 .net 中获得的最接近的东西是 FileSystemWatcher 类，它将监视更改（创建和写入）但不监视读取活动。

网上和 MSDN 上有很多示例

[http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)

# ruby-on-rails - Rails：在库中调用模型类

> ID：326277
> 
> 赞同：2
> 
> 时间：2008-11-28T17:30:49.060
> 
> 标签：ruby-on-rails, model-view-controller, rspec

我正在尝试验证参数是否是 Rails 中特定类的实例：

```
def schedule(action, *args)
  if arg.is_a? Aircraft
    ...
  end
end 
```

我在一个库类中执行此操作（文件位于*lib/*中），我得到一个**未初始化的常量 Aircraft**错误。*Aircraft 是一个模型类，在app/models*中有对应的*aircraft.rb*文件。

 *我可以在库中使用模型类和实例吗？如何？

* * *

**错误上下文：**

错误发生在 RSpec 测试中；该代码在浏览器中工作。我尝试在*_spec.rb*文件中要求模型，目前没有成功。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T19:11:29.670

您可以在 Rails 库文件中使用模型类，并且以完全正确的方式进行操作。Rails 应该在引用飞机类时自动加载它。

所以我们需要更多的背景来弄清楚为什么它对你来说失败了。您是否可以在没有 Rails 环境的情况下加载 lib/ 文件？

解决此问题的一种方法是明确要求模型文件飞机.rb。但是，您会发现这种方法很快就会导致精神错乱，因为它会以微妙而令人惊讶的方式破坏 Rails 自动加载器。如果您使用 Rails 类加载器，而不是反对它，Rails 会容易得多。

*更新*

因此，如果它在 RSpec 测试中，我们可以在规范文件中看到您用来加载环境的代码吗？它应该看起来像这样：

```
require File.dirname(__FILE__) + '/../spec_helper' 
```

它需要位于文件的顶部。这是假设你已经安装了 RSpec Rails 插件（[在这里](http://github.com/dchelimsky/rspec-rails/wikis/home)）并且你有来自 RSpec 插件的默认 spec/spec_helper.rb 文件。如果没有这样的文件，请尝试运行：

```
ruby script/generate rspec 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T18:34:01.523

这将使您可以访问飞机模型：

```
require File.dirname(__FILE__) + "/../app/models/aircraft" 
```

[编辑]

丹尼尔就上下文提出了一个很好的观点。如果您使用的是 rake 任务，请确保加载环境：

```
task :my_task => :environment do
  # something happens...
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-23T15:37:07.243

丹尼尔的回答是正确的，但考虑一下：为什么库类指的是模型类？库代码不应该知道实际的模型类，尽管它可能知道它们提供的接口。

另一个考虑：为什么该`#schedule`方法要求模型的类？如果一个新的模型类`Spaceship`想要使用`#schedule`，则`#schedule`必须更改才能使用它。那没有必要。

相反，`Aircraft`对象和其他类的对象的处理方式有什么不同`#schedule`？你能把这种差异提取到自己的方法中吗？然后，您可以将这些实现移动到每个模型类中，并决定哪个由多态性使用，而不是通过分支。

例如，过去是：

```
def schedule(action, vehicle)
  if vehicle.is_an?(Aircraft)
    possible_days = case action
    when "travel"
      ["Mon", "Wed", "Fri"]
    when "repair"
      ["Sat", "Sun"]
    end
    possible_days.rand
  elsif vehicle.is_a?(Spaceship)
    possible_days = case action
    when "travel"
      ["Sat", "Tue", "Thu"]
    when "repair"
      ["Sun", "Mon"]
    end
    possible_days.rand
  end
end 
```

会成为：

```
def schedule(action, vehicle)
  vehicle.days_action_can_be_performed(action).rand
end

class Aircraft
  def days_action_can_be_performed(action)
    possible_days = case action
    when "travel"
      ["Mon", "Wed", "Fri"]
    when "repair"
      ["Sat", "Sun"]
    end
    possible_days
  end
end

class Spaceship
  def days_action_can_be_performed(action)
    possible_days = case action
    when "travel"
      ["Sat", "Tue", "Thu"]
    when "repair"
      ["Sun", "Mon"]
    end
    possible_days
  end
end 
```

当添加一个新类时，它只需要实现`#days_action_can_be_performed`，它就可以与`#schedule`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-15T05:52:31.080

必须尝试这个： `if arg.is_a? ::Aircraft`？

# crystal-reports - 是否可以在同一个 Crystal Report 中包含一个子报表或 2 个报表？

> ID：326282
> 
> 赞同：0
> 
> 时间：2008-11-28T17:32:58.340
> 
> 标签：crystal-reports, dataset

我在 vs2008 中使用 Crystal Reports，所以我使用带有过程的数据集从数据库中获取数据，我的场景如下：

在同一个水晶报表中，我必须显示两个报表，基本上使用相同的数据集和相同的数据库，但它们是不同的查询（有分组和求和）

这可能吗？如果是我该如何解决这个问题，使用数据库专家？还是交叉表？水晶报表有哪些选项支持这些操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T17:39:03.100

您应该能够在 Crystal 中的主报表上插入“子报表”。您可以将参数从主报告传递到子报告，并在子报告中使用完全不同的命令。我不确定在 VS2008 中插入子报表的确切键盘顺序，但在 CR 2008 中，它就像使用文件菜单 INSERT > SUB REPORT 一样简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T04:34:02.833

根据我自己的经验，我必须同意 Greg - 子报告可能是解决您的问题的最容易维护的解决方案。在 VS2008 的情况下，要遵循的步骤是：

1.  转到 Crystal Reports -> 插入 -> 子报表菜单选项。
2.  单击要在主报表上放置子报表的位置。
3.  将显示“插入子报告”表单。要么选择一个现有的报告，要么使用报告向导创建一个新报告。在报告向导中，您还可以从项目中的现有数据集中进行选择。

要将主报表链接到子报表，请右键单击子报表，然后选择“更改子报表链接”。

希望有帮助。

# c# - 在运行时确定类型并将其应用于泛型类型 - 我该怎么做？

> ID：326285
> 
> 赞同：7
> 
> 时间：2008-11-28T17:33:26.310
> 
> 标签：c#, types

我想创建一个强类型列表并在运行时决定类型。这是我的代码。我认为它应该可以工作，但它没有:)

```
 Type elementType = Type.GetType(parts[0].Trim(),false,true);
        var elementsBeingSet = new List<elementType>(); 
```

您是否知道如何创建一个强类型列表，我将在运行时决定其类型？

重复：这是其他版本：

*   [动态使用泛型是不可能的吗？](https://stackoverflow.com/questions/234008/is-it-impossible-to-use-generics-dynamically)
*   [动态声明一个泛型类型实例](https://stackoverflow.com/questions/307984/declare-a-generic-type-instance-dynamically)
*   [使用仅在执行时已知的类型参数调用泛型方法](https://stackoverflow.com/questions/325156/calling-generic-method-with-a-type-argument-known-only-at-execution-time)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-28T17:42:03.030

使用`Type.MakeGenericType(type[])`：

```
Type elementType = GetElementType(); // get this type at runtime
Type listType = typeof(List<>);
Type combinedType = listType.MakeGenericType(elementType);
IList elements = (IList) Activator.CreateInstance(combinedType); 
```

您必须使用`IList`来保留结果 - 因为您不知道将在运行时使用的实际类型。

对于具有多个类型参数的泛型类型，您可以使用类似`Dictionary<,>`.

另请参阅[http://msdn.microsoft.com/en-us/library/system.type.makegenerictype.aspx](http://msdn.microsoft.com/en-us/library/system.type.makegenerictype.aspx)

# objective-c - Shark：如何过滤到一种特定的方法

> ID：326303
> 
> 赞同：5
> 
> 时间：2008-11-28T17:46:07.780
> 
> 标签：objective-c, cocoa, profiling, shark

我是 Shark 的新手，我想知道是否可以将时间样本缩小到一种特定的方法？

假设我想，只是为了它，知道在调用所有 NSArray（或子类）实例的方法“count”时使用了多少资源。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T20:22:33.783

如果您自下而上查看时间曲线图，并将在库中花费的任何 time-count 费用计入其调用者，那应该会给您想要的。它可以让您查看由于 -count 所花费的时间（即执行该方法以及该方法完成其工作所需的任何时间），还可以让您找出调用该方法的位置。你花这么多时间在 -count 上的原因可能不是因为它需要很长时间，而是因为你这样做太频繁了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T16:35:19.827

至少在功能级别上花费的时间正是 Instruments 为您提供的。使用 DTrace，您甚至可以更深入地挖掘。也许查看[我的博客文章](http://vafer.org/blog/20080812182921)。这应该有望解决问题。

例如，您可以轻松编写一个 DTrace 脚本来打印*计数*调用的内存消耗。

干杯，托斯滕

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-16T18:10:57.443

您可以按 cmd-f 搜索符号。确保“自动展开”复选框已打开，以便它进入树中。您可能需要打开窗口 -> 显示高级设置。

找到符号后，右键单击它，您有一些选项：

*   焦点符号：这将让您过滤到仅对您选择的符号和以下符号的调用

*   Retain Callstacks with：这将让您看到对符号的所有调用并过滤掉其他所有内容

完成后，您可以右键单击并“全部取消焦点”或“全部恢复”。这些命令最终会修改高级设置中的“调用堆栈数据挖掘”部分。胡闹。

# sms - 通过 Internet 进行 SMS 通信

> ID：326305
> 
> 赞同：4
> 
> 时间：2008-11-28T17:47:50.617
> 
> 标签：sms, communication, mobile-phones

如果我要从网站向移动设备发送消息，反之亦然，该怎么做？

我所知道的：几年前，我在 J2ME 平台上开发了一个简单的注册系统（只是为了尝试 J2ME）。我有一个在 pc/server 中设置的 mysql 数据库，我使用该服务器的静态 IP 进行通信。我有一个网桥，一个连接到互联网的手机，客户可以在其中发送格式化的消息。然后，该网桥将消息发送到服务器，经过验证和验证后，服务器将响应网桥，最后网桥将该消息转发给客户端。（我知道我知道..！）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T17:53:07.893

这可以通过使用连接到计算机的手机来完成，但更强大的方法是使用 SMS 聚合器 - 众所周知的是[Mblox](http://www.mblox.com/)或[Hay](http://www.hslsms.com/)，但谷歌搜索会显示更多。

它们将支持发送和接收 SMS 消息

（免责声明：两者都没有关系，尽管我的雇主确实使用 Hay）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T17:50:55.557

简短的回答是您有 4 个选项：

*   拥有自己的短信服务器

或者

*   必须为您要发送消息的每个提供商使用门户网站

或者

*   某些提供商让您通过电子邮件发送 SMS 到 SMS

或者

*   使用一些服务，让您通过他们的网络服务发送短信（这通常需要一些钱来订阅）。

# java - 寻找关于开源 Java 仪器可视化组件的建议

> ID：326307
> 
> 赞同：2
> 
> 时间：2008-11-28T17:49:09.680
> 
> 标签：java, user-interface, swing, open-source, widget

我正在整理一个需要显示一些基本实验室仪器组件的 Java 应用程序。例如，我想显示：条形图、示波器式轨迹和面板仪表（电流计指针）。渲染要求是开放的（只要引擎是免费的并且普遍可用）。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-28T17:57:37.477

我自己从来没有使用过这个，所以我不能说它有多好，但我前段时间遇到了这些工具。[DART 可视化工具](http://www.itee.uq.edu.au/~eresearch/projects/dart/outcomes/visualization.php)。他们使用开源许可证。也许那里有一些东西可以帮助你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T17:59:07.473

看看[JFreeChart](http://www.jfree.org/jfreechart/)。我们已经用它实现了几个条形图应用程序。副手我不确定示波器类型的轨迹，你必须调查一下。看起来确实有类似仪表的[能力](http://www.jfree.org/jfreechart/images/DialPlotDemo2a.png)。

# c# - 锁定在 .net 中的行为如何？

> ID：326309
> 
> 赞同：3
> 
> 时间：2008-11-28T17:50:20.067
> 
> 标签：c#, .net, multithreading, locking

```
abstract class Foo
{
    private List<Object> container;
    private bool update;

    Foo Foo()
    {
        container = new List<object>();
        update = false;
    }

    public abstract Bar CreateBar();

    public void BeginUpdate()
    {
        if (!update)
        {
            Thread update_thread = new Thread(new ThreadStart(Update));
            update_thread.Start();
        }
    }

    private void Update()
    {
        update = true;
        while (update)
        {
            lock (container)
            {
                if (...)
                    container.Add(this.CreateBar());
                else
                    container.Remove(...);
            }

            Thread.Sleep(1337);
        }
    }

    public void EndUpdate()
    {
        update = false;
    }

    public List<Object> Objects
    {
        get
        {
            lock (container)
            {
                return this.container;
            }
        }
    }
} 
```

当 Foo 之外的东西调用 Foo 的 Object 访问器时，例如，

```
List<Objects> objects = foo_instance.Objects;
foreach (Object o in objects)
{
    Thread.Sleep(31173);
} 
```

锁定将如何发生？运行 Update() 的线程是否必须等到上述 foreach 完成处理对象列表？我希望这两个可以同时工作，是制作对象深层副本的唯一解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T18:00:21.887

这段代码有几个问题：

1.  你不启动线程
2.  您可以有一个竞争条件（可能不适用于您的程序），其中多个线程调用 BeginUpdate，两者都认为更新为假，并且都启动一个线程，现在您有两个线程正在运行，可能相互干扰，因为您有一个共享数据的字段成员
3.  锁定房产有什么意义？你不需要它。请注意，由于内部更新，您从属性返回的容器有时会处于不断变化的状态。这意味着调用该属性的外部代码必须在访问其内容之前锁定容器本身。不过，您不需要锁来返回容器引用。
4.  如果您紧接着调用 EndUpdate 和 BeginUpdate ，则旧线程可能还没有机会退出

我想说的是，在您开始担心要锁定什么以及何时锁定之前，您应该修复代码，以便它不会有很多其他与线程相关的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T17:53:54.507

您的代码没有按照您的想法执行。这种方法

```
public List<Object> Objects
{
    get
    {
        lock (container)
        {
            return this.container;
        }
    }
} 
```

返回值后不持有锁。所以你的循环没有被锁定。

您不能从类中返回容器实例

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T17:53:26.410

你可以把锁作用域想象成函数作用域。在访问器方法中加锁只会在大括号之间加锁，一旦返回值，锁就会被释放。您需要在类之外（在调用者中）进行锁定以获得所需的效果。

所以循环和线程都可以同时访问对象。这很糟糕，因为如果您的线程在循环期间更改对象，则循环将抛出异常，因为集合已被修改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T18:01:28.343

krosenvald 是正确的，只要属性返回指向容器对象的指针，就会释放对象访问器上的锁定...

在你的代码中

```
List<Objects> objects = foo_instance.Objects;
foreach (Object o in objects)
{    
    Thread.Sleep(31173);
} 
```

锁只持续到第一行......正在填充引用变量“objects”......实际上没有必要为该行锁定任何东西，因为没有通过获取指针来修改内存......

# c# - 如何创建调用 IEnumerable 的表达式树 。任何（...）？

> ID：326321
> 
> 赞同：41
> 
> 时间：2008-11-28T17:55:20.930
> 
> 标签：c#, .net, linq, expression-trees

我正在尝试创建一个表示以下内容的表达式树：

```
myObject.childObjectCollection.Any(i => i.Name == "name"); 
```

为了清楚起见，我有以下内容：

```
//'myObject.childObjectCollection' is represented here by 'propertyExp'
//'i => i.Name == "name"' is represented here by 'predicateExp'
//but I am struggling with the Any() method reference - if I make the parent method
//non-generic Expression.Call() fails but, as per below, if i use <T> the 
//MethodInfo object is always null - I can't get a reference to it

private static MethodCallExpression GetAnyExpression<T>(MemberExpression propertyExp, Expression predicateExp)
{
    MethodInfo method = typeof(Enumerable).GetMethod("Any", new[]{ typeof(Func<IEnumerable<T>, Boolean>)});
    return Expression.Call(propertyExp, method, predicateExp);
} 
```

我究竟做错了什么？有人有什么建议吗？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-11-28T19:32:07.317

您的处理方式有几处问题。

1.  您正在混合抽象级别。T 参数`GetAnyExpression<T>`可能与用于实例化的类型参数不同`propertyExp.Type`。T 类型参数在抽象堆栈中离编译时间更近一步 - 除非您`GetAnyExpression<T>`通过反射调用，否则它将在编译时确定 - 但传递的表达式中嵌入的类型`propertyExp`是在运行时确定的。您将谓词作为 an 传递`Expression`也是一种抽象混淆 - 这是下一点。

2.  您传递给的谓词`GetAnyExpression`应该是一个委托值，而不是`Expression`任何类型的，因为您正在尝试调用`Enumerable.Any<T>`. 如果您试图调用 的表达式树版本`Any`，那么您应该传递 a`LambdaExpression`来代替，您将引用它，这是您可能有理由传递比 Expression 更具体的类型的罕见情况之一，这会导致我的下一点。

3.  通常，您应该传递`Expression`值。通常在使用表达式树时——这适用于所有类型的编译器，而不仅仅是 LINQ 和它的朋友——你应该以一种与你正在使用的节点树的直接组成无关的方式这样做。您**假设**您正在调用`Any`a `MemberExpression`，但您实际上并不**需要知道**您正在处理 a `MemberExpression`，而只是 a`Expression`的一些实例化类型`IEnumerable<>`。对于不熟悉编译器 AST 基础的人来说，这是一个常见的错误。[弗兰斯·布玛](http://weblogs.asp.net/fbouma/archive/2007/10/03/developing-linq-to-llblgen-pro-day-5.aspx)当他第一次开始使用表达式树时，他反复犯了同样的错误——在特殊情况下思考。一般认为。从中期和长期来看，您将为自己省去很多麻烦。

4.  这就是你的问题的实质（尽管如果你已经解决了第二个问题，也可能是第一个问题，你需要找到合适的 Any 方法的泛型重载，然后用正确的类型实例化它。反射并没有为您提供简单的方法。您需要遍历并找到合适的版本。

所以，分解它：你需要找到一个通用方法（`Any`）。这是一个执行此操作的实用程序函数：

```
static MethodBase GetGenericMethod(Type type, string name, Type[] typeArgs, 
    Type[] argTypes, BindingFlags flags)
{
    int typeArity = typeArgs.Length;
    var methods = type.GetMethods()
        .Where(m => m.Name == name)
        .Where(m => m.GetGenericArguments().Length == typeArity)
        .Select(m => m.MakeGenericMethod(typeArgs));

    return Type.DefaultBinder.SelectMethod(flags, methods.ToArray(), argTypes, null);
} 
```

但是，它需要类型参数和正确的参数类型。从你那里得到`propertyExp` `Expression`它并不完全是微不足道的，因为它`Expression`可能是一种`List<T>`类型，也可能是其他类型，但我们需要找到`IEnumerable<T>`实例化并获取它的类型参数。我把它封装成几个函数：

```
static bool IsIEnumerable(Type type)
{
    return type.IsGenericType
        && type.GetGenericTypeDefinition() == typeof(IEnumerable<>);
}

static Type GetIEnumerableImpl(Type type)
{
    // Get IEnumerable implementation. Either type is IEnumerable<T> for some T, 
    // or it implements IEnumerable<T> for some T. We need to find the interface.
    if (IsIEnumerable(type))
        return type;
    Type[] t = type.FindInterfaces((m, o) => IsIEnumerable(m), null);
    Debug.Assert(t.Length == 1);
    return t[0];
} 
```

因此，给定 any `Type`，我们现在可以从中提取`IEnumerable<T>`实例化 - 并断言是否（完全）没有实例化。

有了这项工作，解决真正的问题并不太困难。我已将您的方法重命名为 CallAny，并按照建议更改了参数类型：

```
static Expression CallAny(Expression collection, Delegate predicate)
{
    Type cType = GetIEnumerableImpl(collection.Type);
    collection = Expression.Convert(collection, cType);

    Type elemType = cType.GetGenericArguments()[0];
    Type predType = typeof(Func<,>).MakeGenericType(elemType, typeof(bool));

    // Enumerable.Any<T>(IEnumerable<T>, Func<T,bool>)
    MethodInfo anyMethod = (MethodInfo)
        GetGenericMethod(typeof(Enumerable), "Any", new[] { elemType }, 
            new[] { cType, predType }, BindingFlags.Static);

    return Expression.Call(
        anyMethod,
            collection,
            Expression.Constant(predicate));
} 
```

这是一个`Main()`使用上述所有代码并验证它是否适用于简单情况的例程：

```
static void Main()
{
    // sample
    List<string> strings = new List<string> { "foo", "bar", "baz" };

    // Trivial predicate: x => x.StartsWith("b")
    ParameterExpression p = Expression.Parameter(typeof(string), "item");
    Delegate predicate = Expression.Lambda(
        Expression.Call(
            p,
            typeof(string).GetMethod("StartsWith", new[] { typeof(string) }),
            Expression.Constant("b")),
        p).Compile();

    Expression anyCall = CallAny(
        Expression.Constant(strings),
        predicate);

    // now test it.
    Func<bool> a = (Func<bool>) Expression.Lambda(anyCall).Compile();
    Console.WriteLine("Found? {0}", a());
    Console.ReadLine();
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-08-08T14:54:05.273

巴里的回答为原始海报提出的问题提供了一个可行的解决方案。感谢这两个人的提问和回答。

当我试图为一个非常相似的问题设计一个解决方案时，我发现了这个线程：以编程方式创建一个包含对 Any() 方法的调用的表达式树。然而，作为一个额外的限制，我的解决方案的**最终目标**是通过 Linq-to-SQL 传递这样一个动态创建的表达式，以便 Any() 评估的工作实际上在 DB 本身中执行。

不幸的是，到目前为止所讨论的解决方案并不是 Linq-to-SQL 可以处理的。

假设这可能是想要构建动态表达式树的一个非常流行的原因，我决定用我的发现来扩充线程。

当我尝试使用 Barry 的 CallAny() 的结果作为 Linq-to-SQL Where() 子句中的表达式时，我收到了具有以下属性的 InvalidOperationException：

*   H结果=-2146233079
*   Message="内部 .NET Framework 数据提供程序错误 1025"
*   源=系统.数据.实体

在将硬编码的表达式树与使用 CallAny() 动态创建的树进行比较后，我发现核心问题是由于谓词表达式的 Compile() 以及尝试在 CallAny() 中调用生成的委托所致。在不深入研究 Linq-to-SQL 实现细节的情况下，我认为 Linq-to-SQL 不知道如何处理这种结构似乎是合理的。

因此，经过一些实验，我能够通过稍微修改建议的 CallAny() 实现以采用 predicateExpression 而不是 Any() 谓词逻辑的委托来实现我想要的目标。

我修改后的方法是：

```
static Expression CallAny(Expression collection, Expression predicateExpression)
{
    Type cType = GetIEnumerableImpl(collection.Type);
    collection = Expression.Convert(collection, cType); // (see "NOTE" below)

    Type elemType = cType.GetGenericArguments()[0];
    Type predType = typeof(Func<,>).MakeGenericType(elemType, typeof(bool));

    // Enumerable.Any<T>(IEnumerable<T>, Func<T,bool>)
    MethodInfo anyMethod = (MethodInfo)
        GetGenericMethod(typeof(Enumerable), "Any", new[] { elemType }, 
            new[] { cType, predType }, BindingFlags.Static);

    return Expression.Call(
        anyMethod,
        collection,
        predicateExpression);
} 
```

现在我将演示它与 EF 的用法。为了清楚起见，我应该首先展示我正在使用的玩具域模型和 EF 上下文。基本上我的模型是一个简单的博客和帖子域......其中一个博客有多个帖子，每个帖子都有一个日期：

```
public class Blog
{
    public int BlogId { get; set; }
    public string Name { get; set; }

    public virtual List<Post> Posts { get; set; }
}

public class Post
{
    public int PostId { get; set; }
    public string Title { get; set; }
    public DateTime Date { get; set; }

    public int BlogId { get; set; }
    public virtual Blog Blog { get; set; }
}

public class BloggingContext : DbContext
{
    public DbSet<Blog> Blogs { get; set; }
    public DbSet<Post> Posts { get; set; }
} 
```

建立该域后，这是我最终执行修改后的 CallAny() 并使 Linq-to-SQL 执行评估 Any() 的工作的代码。我的特定示例将着重于返回至少有一篇比指定截止日期更新的帖子的所有博客。

```
static void Main()
{
    Database.SetInitializer<BloggingContext>(
        new DropCreateDatabaseAlways<BloggingContext>());

    using (var ctx = new BloggingContext())
    {
        // insert some data
        var blog  = new Blog(){Name = "blog"};
        blog.Posts = new List<Post>() 
            { new Post() { Title = "p1", Date = DateTime.Parse("01/01/2001") } };
        blog.Posts = new List<Post>()
            { new Post() { Title = "p2", Date = DateTime.Parse("01/01/2002") } };
        blog.Posts = new List<Post>() 
            { new Post() { Title = "p3", Date = DateTime.Parse("01/01/2003") } };
        ctx.Blogs.Add(blog);

        blog = new Blog() { Name = "blog 2" };
        blog.Posts = new List<Post>()
            { new Post() { Title = "p1", Date = DateTime.Parse("01/01/2001") } };
        ctx.Blogs.Add(blog);
        ctx.SaveChanges();

        // first, do a hard-coded Where() with Any(), to demonstrate that
        // Linq-to-SQL can handle it
        var cutoffDateTime = DateTime.Parse("12/31/2001");
        var hardCodedResult = 
            ctx.Blogs.Where((b) => b.Posts.Any((p) => p.Date > cutoffDateTime));
        var hardCodedResultCount = hardCodedResult.ToList().Count;
        Debug.Assert(hardCodedResultCount > 0);

        // now do a logically equivalent Where() with Any(), but programmatically
        // build the expression tree
        var blogsWithRecentPostsExpression = 
            BuildExpressionForBlogsWithRecentPosts(cutoffDateTime);
        var dynamicExpressionResult = 
            ctx.Blogs.Where(blogsWithRecentPostsExpression);
        var dynamicExpressionResultCount = dynamicExpressionResult.ToList().Count;
        Debug.Assert(dynamicExpressionResultCount > 0);
        Debug.Assert(dynamicExpressionResultCount == hardCodedResultCount);
    }
} 
```

其中 BuildExpressionForBlogsWithRecentPosts() 是一个使用 CallAny() 的辅助函数，如下所示：

```
private Expression<Func<Blog, Boolean>> BuildExpressionForBlogsWithRecentPosts(
    DateTime cutoffDateTime)
{
    var blogParam = Expression.Parameter(typeof(Blog), "b");
    var postParam = Expression.Parameter(typeof(Post), "p");

    // (p) => p.Date > cutoffDateTime
    var left = Expression.Property(postParam, "Date");
    var right = Expression.Constant(cutoffDateTime);
    var dateGreaterThanCutoffExpression = Expression.GreaterThan(left, right);
    var lambdaForTheAnyCallPredicate = 
        Expression.Lambda<Func<Post, Boolean>>(dateGreaterThanCutoffExpression, 
            postParam);

    // (b) => b.Posts.Any((p) => p.Date > cutoffDateTime))
    var collectionProperty = Expression.Property(blogParam, "Posts");
    var resultExpression = CallAny(collectionProperty, lambdaForTheAnyCallPredicate);
    return Expression.Lambda<Func<Blog, Boolean>>(resultExpression, blogParam);
} 
```

注意：我在硬编码和动态构建的表达式之间发现了另一个看似不重要的差异。动态构建的有一个“额外的”转换调用，硬编码版本似乎没有（或不需要？）。在 CallAny() 实现中引入了转换。Linq-to-SQL 似乎没问题，所以我把它留在原地（尽管它是不必要的）。我不完全确定在比我的玩具样本更强大的用途中是否需要这种转换。

# windows-ce - 在 Windows CE 上开发 Internet 客户端

> ID：326329
> 
> 赞同：1
> 
> 时间：2008-11-28T17:58:57.693
> 
> 标签：windows-ce

我有 5台安装了 Windows CE 6.0 的[HP Compaq t5530 瘦客户机。](http://h10010.www1.hp.com/wwpc/us/en/sm/WF06a/12454-12454-321959-338927-89307-3341951.html)我有一个 Windows 2003 服务器。这 6 台电脑应该用于浏览。并且用户可以浏览一个小时并且能够延长时间。我需要开发一个简单的客户端-服务器程序来控制互联网的可用性。

解决这个问题的建议路线是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T18:55:52.477

所以你是在追求一个时间控制的浏览器应用程序，而不是别的？第一个问题：你有这个设备的 BSP（板级支持包）吗？

**是**的：修改 IESAMPLE 源代码，它是 CE 附带的浏览器，以获得您想要的显示并删除关闭按钮之类的内容，甚至可能还有标题栏。我什至可能让它[实现所有必需的 shell 功能](http://msdn.microsoft.com/en-us/library/ms898218.aspx)，以便它可以完全作为设备 shell 运行。IESShell[样本](http://www.microsoft.com/downloads/details.aspx?FamilyID=8CFCA431-C81D-4E2E-9C0D-2DA4F49A3C70&displaylang=en)将是一个非常好的开始。然后在您的项目中修改 HKLM\Init 以在设备启动时启动重新设计的 IESAMPLE，您就完成了。

**不**：它不会那么容易，但它仍然是可行的。[使用具有所需 UI 元素的IWebBrowser2 COM 控件](http://msdn.microsoft.com/en-us/library/aa454372.aspx)创建应用程序（如上述建议）。修改 HKLM\Init 以在 explorer.exe 之后启动您的应用程序（您可能必须让 explorer 作为 shell 应用程序运行），或者如果您在 C++ 中执行此操作，请实现所需的 shell 函数。如果您让 Explorer 运行，那么您需要您的应用程序在初始化时查找、禁用和隐藏开始栏。你如何让你的应用程序持续存在将取决于硬件——我对这些设备一无所知。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T19:21:04.843

我的另一个想法 - 如果你有 BSP，你可能会生成一个使用 RDP 客户端的自定义 shell，它可以连接到服务器并使用浏览器。您可能更容易控制使用时间，因为它可以在服务器上设置，但您随后的任务是让 RDP 会话自动启动浏览器并仅使用它。我对这条路线不太熟悉，所以我可能会选择我建议的设备上浏览器机制，然后通过网络服务之类的东西将时间跟踪添加回服务器。

# c# - 尽管数据表存储在缓存中，但我是否必须在每次使用后调用 dispose？

> ID：326335
> 
> 赞同：2
> 
> 时间：2008-11-28T18:00:26.707
> 
> 标签：c#, asp.net, caching, datatable, dispose

简单案例：

我在缓存中放了一个数据表

```
DataTable table = SomeClass.GetTable();
Cache["test"] = table;

then in later calls i use
DataTable table = (DataTable)Cache["test"]; 
```

现在的问题是：我是否应该在每次调用时调用 table.dispose()，尽管它存储在缓存中？意味着对象总是相同的？或者缓存每次都会创建一个副本？

谢谢 ：）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-28T18:06:12.233

你所做的只是在缓存中存储一​​个指针......实际的“表”仍然在堆上，所有.Net引用类型都存储在其中......你没有复制它......缓存中的变量只是阻止垃圾收集器擦除堆上的对象......

不，在不再需要实际对象之前，您不想调用 dispose 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T18:04:23.360

我相信你应该只在完全完成数据表后调用一次 Dispose；调用 Dispose 会更改对象的状态。

请注意，“缓存”并不总是意味着“复制”！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T19:31:21.150

DataTable 是一个托管资源，不需要调用它的 Dispose() 方法即可被垃圾收集器正确清理。

# wcf - 您是否在 WCF Web 服务中使用枚举类型？

> ID：326339
> 
> 赞同：44
> 
> 时间：2008-11-28T18:03:31.913
> 
> 标签：wcf, enums

我听说有人说枚举是邪恶的，不应该在 Web 服务中使用，因为如果分配了某些值，或者如果枚举被标记为[Flags](http://msdn.microsoft.com/en-us/library/system.flagsattribute(VS.71).aspx)属性，服务器和客户端之间可能会发生不匹配。他们还说，公开枚举的 Web 服务更难维护，但不能真正给我可行的论据。那么根据您的经验，在 WCF Web 服务中使用枚举的优缺点是什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-25T05:19:19.443

人们建议避免在 web 服务中使用枚举的原因是因为它们会产生微妙的向后兼容问题。

这同样适用于常规枚举，但在 Web 服务中，问题更加明显，特别是在 .NET 生成的代理中（见下文）。

*   如果仅输入枚举，则没有问题。
*   如果 enumerate 可以是 out 参数，那么如果您添加一个新元素并将其返回，那么旧客户端可能会遇到问题：
    *   如果客户端使用 .NET 生成的代理，它将在调用者处理它之前中断（在反序列化中）
    *   即使为代理生成的代码支持更改（例如，如果它将枚举映射到字符串），客户端中的用户代码也可能无法正确处理新的意外值（它可能很容易成为从未执行的路径）

通过将参数定义为字符串，您可以向 API 的用户发出该值将来可能会更改的信号。即使您认为该值永远不会改变，也要做好准备。

Dare Obasanjo有一篇关于这个主题的[好帖子。](http://www.25hoursaday.com/weblog/2005/08/31/WhyYouShouldAvoidUsingEnumeratedTypesInXMLWebServices.aspx)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-17T15:40:38.790

我在 WCF 中使用过枚举，也在互操作性场景中使用过。如果您控制服务的双方，则使用起来会更容易。如果您只控制服务的一侧，则需要注意您提到的问题。

枚举比字符串变量或您可能选择使用的其他变量要好得多。使用字符串而不是枚举是 SOA 中称为“松散的 Goosey”的反模式。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-17T16:05:50.737

`xsd:enumeration`通过模式元素在 WSDL 和 XSD 中完全支持枚举。它提供对单个值和标志样式枚举的支持，其中标志枚举中的多个值由空格分隔。

因此，在任何符合标准的平台上使用枚举都应该没有问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-28T21:43:33.497

当然，这完全取决于您将在何处使用此 WCF 服务。

如果是单个应用程序将使用它，那么更改合同将不会产生任何影响。

如果是多个内部应用程序，更改合约可能需要对其他应用程序进行一些更改。

最后，如果 WCF 服务是公开的，您可能必须提供 2 个版本不同的服务，以便使用它们的人有时间将他们的客户端版本转移到新服务。

老实说，这完全取决于您的需求。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-01-15T21:10:52.977

使用除枚举之外的任何其他东西都不能解决您的兼容性问题，它只会隐藏它。假设您使用 int 替换枚举。你真的解决了兼容性问题还是只是伪装它直到客户端运行时达到未知值？

但是，值得一提的是：WCF 代理不会重新创建显式设置的枚举数值。如果枚举用“holes”声明，比如

```
enum ErrorCodes
{
  OK = 0,
  GenericError = 100,
  SomeOtherError = 101,
} 
```

客户端表示将是这样的

```
enum ErrorCodes
{
  OK,
  GenericError,
  SomeOtherError,
} 
```

...在客户端导致 (int)ErrorCodes.GenericError 为 1。

您将有句法等价，但没有数字等价。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-01-12T10:54:31.013

WSDL 中的枚举必须被视为维护问题。

添加或删除枚举值是（应该是！）接口重大更新的触发器。如果枚举是一个输出值，那么您必然需要通过一个新的 URI 定义一个新版本的 WSDL，以防止当前客户端违反已建立的合同（“如果他们收到这些新的、意外的值作为回报怎么办？ ?") 如果枚举是输入值，您可以将其视为次要更新（“因为当前客户不需要知道这个新值”），但是，这些客户从添加这个新选项/功能（您添加这个新枚举值是有原因的，对吗？）将要求他们稍后或更快地切换到新版本的界面。

我认为这与枚举的功能意义无关。

坚持最佳实践，您将是安全的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T21:39:55.563

我在基于 WCF 的服务中使用了枚举，没有任何问题。您提到的可能问题绝对是要考虑的事情，尽管如果您确保在相当静态的情况下应用枚举，您可能不会遇到太多麻烦。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-04-17T06:47:48.907

真实世界的故事（值因匿名而改变）。`enum`用于在应用程序中隐含

```
public enum { orange, banana, mango } 
```

围绕顺序和新值进行了一些重构，我们决定明确说明：

```
public enum { orange=1, banana=2, grape=3, mango=4 } 
```

看起来无伤大雅……
接下来，一个网站爆炸了。从头开始，检查服务，添加调试消息，一切似乎都很好。
一天后，在兔子洞里，原因是一个使用枚举作为返回类型的基本 wcf 服务。

显然，Wcf 不喜欢没有**默认**值的枚举。

使固定：

```
public enum { wcfBugBane=0, orange=1, banana=2, grape=3, mango=4 } 
```

所以......它可能会咬你。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-12-29T21:41:27.877

这是一种方法。也许它很麻烦。我真的不喜欢不能使用枚举。

它优雅地处理无法识别的值的反序列化，而是返回默认值。默认值需要是安全的——可以是可接受的回退，也可以是应用程序可以识别为异常的东西。（如“未指定”。）

扩展防止在比较之前必须进行空检查。

```
[DataContract]
public class EnumValue<T> where T : struct
{
    [DataMember]
    private string _raw = string.Empty;

    [IgnoreDataMember]
    private bool _parsed;

    [IgnoreDataMember]
    private T _parsedValue;

    public EnumValue()
    {
        Set(default(T));
    }

    public EnumValue(T value)
    {
        Set(value);
    }

    internal T Value
    {
        get
        {
            if (_parsed) return _parsedValue;
            if (!Enum.TryParse<T>(_raw, out _parsedValue))
            {
                _parsedValue = default(T);
            }
            _parsed = true;
            return _parsedValue;
        }
    }

    public void Set(T value)
    {
        _raw = value.ToString();
        _parsedValue = value;
        _parsed = true;
    }
}

public static class EnumValueExtensions
{
    public static T GetValue<T>(this EnumValue<T> enumValue) where T : struct
    {
        return enumValue == null ? default(T) : enumValue.Value;
    }

    public static bool EqualsValue<T>(this EnumValue<T> enumValue, T compareTo) where T : struct
    {
        return (enumValue.GetValue().Equals(compareTo));
    }
} 
```

# unit-testing - 你如何进行单元测试？

> ID：326344
> 
> 赞同：8
> 
> 时间：2008-11-28T18:06:04.170
> 
> 标签：unit-testing

我已经阅读了一些关于单元测试的内容，并且想知道您是如何进行单元测试的。显然，单元测试应该将程序分解为非常小的“单元”并从那里测试功能。

但我想知道，对一个类进行单元测试就足够了吗？或者您是否更进一步，对算法、公式等进行单元测试？或者您是否将其扩展到单元测试 asp 页面/功能？或者你是否进行单元测试？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-28T18:24:49.873

> 但我想知道，对一个类进行单元测试就足够了吗？或者您是否更进一步，对算法、公式等进行单元测试？或者您是否将其扩展到单元测试 asp 页面/功能？或者你是否进行单元测试？

算法应该在一个类中，并且应该自动进行单元测试。公式作为函数在类中，它们也经过**单元**测试。单元测试测试行为、状态和所有可以测试最小开发单元的东西。所以，是的，该算法的所有细节都经过了测试。稍后，当您的类使用另一个类时，您将进行**集成**测试（这些测试通常使用单元测试程序进行测试）。这将是相同的，但在更高的级别。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T18:28:08.337

在对代码进行了一些更改（例如，重构、修复错误、添加增强功能）之后，我使用单元测试作为衡量某些东西是否仍然有效的工具。因为我使用 Java，所以单元测试在很大程度上是使用 JUnit 自动化的。我只需调用一个命令行脚本，它就会运行数百个测试来验证代码没有损坏。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T18:11:09.527

**我对功能**进行单元测试，而不是单个方法或类。编写和维护单元测试的开销并不是微不足道的，一般来说我不建议为每一点代码都编写单元测试。然而，单元测试特性是值得的，因为特性是客户付钱给你的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-28T18:22:48.050

这些是我认为对单元测试有用的通用指南：

1) 识别边界对象（Win/WebForms、CustomControls 等）。

2）识别控制对象（业务层对象）

3) 确保*至少*为边界对象调用的控制对象公共方法编写单元测试。

这样您就可以确保您涵盖了应用程序的主要功能方面（特性），并且不会冒微测试的风险（除非您愿意）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-28T20:06:25.893

我是一个非常草率的单元测试人员，但我是一名学者，所以我的大部分程序都是我自己使用的脚本或更多用于我研究的重型程序。我的很多工作都是关于编译器的，所以经典的单元测试很困难——例如，对寄存器分配器进行单元测试并不容易，除非你有一个编译器来包装它，那时你不妨去回归测试。

但也有一些大的例外。我在 Lua 中编写了大量脚本，分为模块（源文件可以并且通常是模块）。如果我正在研究新的东西，比如与 shell 交互的实用程序，我将在模块本身中放置一些单元测试。**每次加载模块时它们都会**在哪里运行。Lua 非常快，通常这无关紧要。这里有些例子：

```
断言（os.quote [[三]] == [[三]]）
断言（os.quote [[three"]] == [['three"']])
断言（os.quote [[你的妈妈]] == [['你的妈妈']]）
断言（os.quote [[$i]] == [['$i']]）

```

如果我是一只好狗，我会在编写函数之前编写一些类似的简单测试。

我对单元测试做的另一件事是，如果有什么困难，我会使用[QuickCheck](http://www.cs.chalmers.se/~rjmh/QuickCheck/)**测试代数定律**，这是一种随机测试工具，必须看到才能相信。这是我用过的唯一让单元测试*变得有趣*的工具。那里有一个链接，但您可以在[Tom Moertel 的](http://blog.moertel.com/pages/seven-lessons-from-the-icfp-programming-contest)博客上找到有关 ICFP 编程竞赛的故事。

 *希望你觉得这很有帮助。QuickCheck 已经多次保存了我的培根。最近，我使用精确有理算术测试了离散余弦变换的代码——然后将其移植到 C 中！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T18:11:48.090

我们通常在机器的 Java 库中编程。一个程序通常由超过 20 个库组成，所以我们所做的就是对每个库进行单元测试。这不是一件容易的事，因为很多时候库之间是非常耦合的，这不是很多次可能的。

我们的代码不像我们希望的那样模块化，但我们必须忍受它的兼容性问题，并且在许多情况下破坏耦合也意味着破坏兼容性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T18:18:57.200

我尽可能多地测试公共接口（我使用的是 C++，但语言并不重要）。最重要的方面是在编写代码时（紧接在之前或之后）编写测试。根据经验，我向您保证，以这种方式开发将导致更可靠的代码。并将使其更易于维护（因为破坏测试的更改显然会立即出现）。

对于所有项目，我建议您从一开始就考虑测试 - 如果您编写一个依赖于另一个复杂类的类，则使用接口以便在测试时“模拟”更复杂的对象（数据库访问、网络访问、 ETC。）。

编写大量测试似乎会减慢您的速度，但实际上，在项目的整个生命周期中，您将花费更少的时间来修复错误。

经常测试——如果它可以破坏，它会破坏——并且在你测试它时它会比在客户尝试使用它时更好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-28T18:28:40.567

仅仅对一个类进行单元测试是不够的。类一起工作，这也必须进行测试。

除了类之外，还有更多的单元：

*   模块，
*   层，
*   构架。

当然还有不同形式的测试，例如集成和验收。

我测试我觉得困难的事情，我认为可能会改变的事情，接口和我必须修复的事情。我主要从测试开始，试图确保我理解我想要解决的问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-28T20:39:24.857

**仅仅因为它编译并不意味着它运行！** 这就是单元测试的本质。试一下代码。确保它正在做你认为它正在做的事情。

让我们面对现实吧，如果你从 matlab 中引入矩阵变换，很容易在某处弄乱加号或减号。这种事情很难看到。如果不尝试，您只是不知道它是否会正常工作。 **调试 100 行代码比调试 100,000 行代码要容易得多。**

* * *

有些人把这件事推向了极端。他们试图测试每一个可以想象的事情。测试本身就是目的。

这在以后的维护阶段可能很有用。您可以快速检查以确保您的更新没有破坏任何内容。

**但是所涉及的开销可能会削弱产品开发！** 未来改变功能的变化可能涉及大量的测试更新开销。

（对于多线程和任意执行顺序，它也会变得混乱。）

* * *

最终，除非另有指示，否则我的测试试图达到中间立场。

我希望以更大的粒度进行测试，以提供一种验证基本通用功能的方法。我不太担心每一个可能的围栏场景。（这就是 ASSERT 宏的用途。）

例如：当我编写代码以通过 UDP 发送/接收消息时，我将一个快速测试放在一起，以通过环回接口使用该类发送/接收数据。没有什么花哨。快速、快速、肮脏的代码。我只是想试试看。在我在它之上构建一些东西之前，确保它确实在工作。

另一个示例：从 Firewire 摄像头读取摄像头图像。我拼凑了一个快速而肮脏的 GTK 应用程序来读取图像、处理它们并实时显示它们。其他人称之为集成测试。但我可以用它来验证我的 Firewire 接口、我的 Image 类、我的 Bayer RGGB->RGB 变换、我的图像方向和对齐方式，甚至是相机是否再次倒置。只有在证明不够充分的情况下，才需要进行更详细的测试。

另一方面，即使是简单的事情：

```
template<class TYPE> inline TYPE MIN(const TYPE & x, const TYPE & y) { return x > y ? y : x; }
template<class TYPE> inline TYPE MAX(const TYPE & x, const TYPE & y) { return x < y ? y : x; } 
```

我写了一个 1 行 SHOW 宏来确保我没有弄乱标志：

```
 SHOW(MIN(3,4));  SHOW(MAX(3,4)); 
```

我想做的只是验证它在做一般情况下应该做的事情。我不太担心它如何处理 NaN / +-Infinity / (double,int) 而不是其中一位同事决定更改参数顺序并搞砸了。

* * *

工具方面，有很多单元测试的东西。如果它对您有帮助，则为您提供更多动力。如果没有，那么你真的不需要太花哨。

我会经常编写一个测试程序，将数据转储到一个类中或从一个类中转出，然后用一个 SHOW 宏将其全部打印出来：

```
#define SHOW(X)  std::cout << # X " = " << (X) << std::endl 
```

（或者，我的许多类都可以使用内置的 operator<<(ostream&) 方法进行自我打印。这是一种非常有用的调试和测试技术！）

Makefile 可以简单地扩展为从测试程序自动生成输出文件，并自动将这些输出文件与先前已知（审查）的结果进行比较（比较）。

不花哨，也许有点不够优雅，但随着技术的发展，这是非常有效的，实现速度很快，而且开销非常低。（当您的经理不赞成在测试内容上浪费时间时，这有其优势。）

* * *

最后一个想法我会离开你。 *这会让我被标记下来，所以**不**要这样做！*

前段时间我需要一个测试程序。这是必需的可交付成果。程序本身必须验证另一个类是否正常工作。但它无法访问外部数据文件。（我们不能依赖程序相对于其他任何东西的位置。也没有绝对路径。）该项目的单元测试框架与我需要使用的编译器不兼容。它也必须在一个文件中。项目 makefile 系统不支持将多个文件链接在一起以用于低级测试程序。（应用程序，当然。他们可以使用库。但每个测试程序只有一个文件。）

所以，上帝原谅我，我*“打破了规则”* ......

<尴尬>
我用了宏。设置 #define 宏时，数据被写入第二个 .c 文件作为结构数组的初始化程序。随后，当重新编​​译软件时，第二个 .c 文件（带有 struct 数组）被 #included，并且未设置 #define 宏，它将新结果与先前存储的数据进行比较。是的，我#include 了一个 .c 文件。哦，这一切的尴尬。
</尴尬>

但这是可以完成的...

# asp.net - asp.net中的简单角色认证

> ID：326350
> 
> 赞同：5
> 
> 时间：2008-11-28T18:10:39.667
> 
> 标签：asp.net, authentication

我想在 .NET 中做一个简单的角色身份验证 - 但在大量的 apis 中迷失了......

我希望每个目录都有一个 web.config ，具有以下角色访问权限：

```
<authorization>
    <allow roles="admin"/>
    <deny users="*"/>
</authorization> 
```

在我的登录页面中，我执行 FormsAuthentication.RedirectFromLoginPage 我想指定登录用户的角色（管理员、用户等......）我不需要 RoleManagementProviders 和过度杀伤的功能（在我的情况下）角色管理。

我需要什么 API 来指定用户的角色？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T20:09:36.773

这是一个非常简单的带有角色的表单身份验证实现的链接。我相信这是最基本的表单身份验证实现： http: [//www.codeproject.com/KB/web-security/formsroleauth.aspx](http://www.codeproject.com/KB/web-security/formsroleauth.aspx)

这是关于会员提供者的一个： [http](http://www.asp.net/learn/moving-to-asp.net-2.0/module-08.aspx) ://www.asp.net/learn/moving-to-asp.net-2.0/module-08.aspx 您可能需要搜索其他教程才能清楚地了解如何自定义它。

我更喜欢成员资格提供程序，因为它允许您覆盖默认值并提供您自己的数据存储和用于不同身份验证操作的方法。我发现它比使用基本实现更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T14:02:34.733

请注意，要使用角色提供者模型，您不必使用数据库和模式，还有一些更简单的选项。您可能对使用授权管理器（从 Microsoft 免费下载）感兴趣，它允许您将角色提供程序添加到 ASP.NET 应用程序并使用其工具（通过管理工具访问的 MMC 管理单元）配置角色和权限。

[如何：在 ASP.NET 2.0 中使用授权管理器](http://msdn.microsoft.com/en-us/library/ms998336.aspx)

该工具公开的配置存储到应用程序 web.config 中引用的 xml 文件中：

```
<connectionStrings>
  <add name="LocalPolicyStore" connectionString="msxml://C:/AzManStore.xml"/>
</connectionStrings> 
```

当您将应用程序配置为使用授权管理器角色提供程序时，可以引用它：

```
<roleManager enabled="true" defaultProvider="RoleManagerAzManProvider">
  <providers>
    <add name="RoleManagerAzManProvider"
         type="System.Web.Security.AuthorizationStoreRoleProvider, System.Web, Version=2.0.0.0, Culture=neutral, publicKeyToken=b03f5f7f11d50a3a"
         applicationName="MyApp"
         connectionStringName="LocalPolicyStore"/>
  </providers>
</roleManager> 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-28T18:54:32.213

就个人而言，如果您要使用 ASP.NET 中已经提供的角色管理和用户功能，为什么要尝试组合一个解决方案，该解决方案会限制您扩展的能力。

使用角色分配的默认功能很容易，您不必担心为用户正确创建身份信息。

# ruby - RDoc：更改 ri-documentation 中“属性：”部分的名称

> ID：326352
> 
> 赞同：1
> 
> 时间：2008-11-28T18:11:08.293
> 
> 标签：ruby, metaprogramming, rdoc, ri

我正在使用一些元编程在 ruby​​ 中生成一堆方法，如下所示：

```
class EmotionalObject
  def self.mood( name, *details )
    define_method(name) do
      # ...
    end
  end

  mood :happy, #...
  mood :sad, #...
  mood :ebuillent, #...
  #...
 end 
```

我知道我可以通过`rdoc`'-A mood' 让它将我的情绪生成代码识别为属性，这很方便，从那时起它们至少会被识别。

但是，它们实际上更像是常规方法而不是属性，所以当我使用`ri`. 我没有任何常规属性，所以有什么简单的方法可以将本节的标题更改为“Moods：”或类似的东西，所以我的用户至少有足够的好奇心来输入`ri EmotionalObject#happy`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T01:19:52.003

它被硬编码到 RDoc 模板中，但是您可以通过复制默认的“html”模板并手动更改标题名称来制作一个新模板来使用。

在此处查看 RDoc 模板源：http: [//github.com/juretta/ruby/blob/master/lib/rdoc/generator/html/html.rb#L601](http://github.com/juretta/ruby/blob/master/lib/rdoc/generator/html/html.rb#L601)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-24T04:46:01.300

似乎在 rdoc 2.4.1 附近的某个地方，他们将其删除并替换为在每个元方法上`--accessor`使用注释。`##`虽然这允许您将它们从属性部分中删除，但它也迫使您单独评论每一个。

[http://rdoc.rubyforge.org/RDoc/Parser/Ruby.html](http://rdoc.rubyforge.org/RDoc/Parser/Ruby.html)

# database - 使用属性窗口管理数据库

> ID：326358
> 
> 赞同：0
> 
> 时间：2008-11-28T18:13:53.357
> 
> 标签：database, vb6, ado

请列举 Visual Basic 程序使用数据控件和 Active x 数据对象 (ADO) 访问数据库的过程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T18:38:30.080

这是一个很大的老话题，但下面是几个简单的例子，可以通过记录集阅读......

```
Dim con As New ADODB.Connection
con.connectionstring = "My Connection String" -- see ConnectionStrings.com for examples

Dim rs As New ADODB.Recordset
con.Open
rs.Open "SELECT name FROM MyTable", con, adOpenForwardOnly, adLockReadOnly

Do While Not rs.EOF
    Debug.Print rs.fields("name")
rs.movenext
Loop

rs.Close
Set rs = Nothing
con.Close
Set con = Nothing 
```

这将适用于您拥有驱动程序的任何数据库，但如果您使用支持存储过程的系统，则最好使用那些...

```
Dim con As New ADODB.Connection
con.ConnectionString = "My Connection String" -- see ConnectionStrings.com for examples

Dim cmd As New ADODB.Command
cmd.CommandText = "MySpName"
cmd.CommandType = adCmdStoredProc

Dim param1 As New ADODB.Parameter
With param1
    .Name = "@MyParam"
    .Type = adInteger
    .Direction = adParamInput
    .Value = 10
End With

cmd.Parameters.Append param1
Set param1 = Nothing

Dim rs As ADODB.Recordset
con.Open
cmd.ActiveConnection = con

Set rs = cmd.Execute

Do While Not rs.EOF
    Debug.Print rs.Fields("name")
rs.movenext
Loop

rs.Close
Set rs = Nothing
con.Close
Set con = Nothing 
```

# database - 最简单、最可维护的在线数据库解决方案？

> ID：326364
> 
> 赞同：0
> 
> 时间：2008-11-28T18:17:51.773
> 
> 标签：database

我希望创建一个在线系统来跟踪一些事情（例如，一个有孩子的数据库，每个孩子都有一次或多次医生的访问）。我希望用户能够输入数据以及搜索数据，尤其是通过移动设备。因此，这是一个适度但非零大小的自定义移动在线数据库应用程序。

考虑到诸如

*   易于初始开发
*   托管方便且成本低
*   易于维护（例如，由于安全问题等不需要随着时间的推移手动更新组件）

?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T18:23:55.287

从表面上看，这听起来像是一个微不足道的 Web 应用程序，“最简单”的路径是使用您已经熟悉的工具

[人们很可能只是推荐他们喜欢/使用的工具，虽然对他们来说“最简单”的工具可能对你的结果没有影响]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T18:25:49.667

我推荐[http://dabbledb.com/](http://dabbledb.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T18:31:25.147

我喜欢[Google App Engine](http://code.google.com/appengine/)（服务器端代码是用 Python 编写的，db 在 Google 的基础架构上）；我认为它尊重您的要求：

*   易于初始开发：Python 是有史以来最简单的语言
*   托管方便且成本低：成本为零
*   易于维护：维护成本为零。安全性应该很高，因为我们在谈论谷歌

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-20T17:21:54.163

我建议你看看[Viravis](http://www.viravis.com "在线数据库应用平台")。

# c# - 在企业库中运行时更改连接字符串

> ID：326365
> 
> 赞同：8
> 
> 时间：2008-11-28T18:18:02.147
> 
> 标签：c#, .net, database, configuration, enterprise-library

有没有办法在运行时更改企业库中数据库对象的连接字符串？我找到[了这个](http://blog.benday.com/archive/2005/05/05/357.aspx)链接，但它有点过时了（2005）

我也发现[了这一点](https://stackoverflow.com/questions/63546/vs2005-c-programmatically-change-connection-string-contained-in-appconfig)，但它似乎一般适用于.Net，我想知道是否可以专门为 EntLib 做一些事情。

我只是将连接字符串名称传递给 DatabaseFactory 对象中的 CreateDatabase() 方法，直到昨天我的项目经理要求我支持多个数据库实例。碰巧每个州都必须有一个数据库（一个用于 CA，一个用于 FL，等等），所以我的软件需要循环遍历所有数据库并对数据进行处理，但它将使用相同的配置文件。

提前致谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-03-17T02:40:18.210

看看这个：[Open Microsoft.practices.EnterpriseLibrary database with just a connection string](https://stackoverflow.com/questions/401339/open-microsoft-practices-enterpriselibrary-database-with-just-a-connection-string)

只需使用以下代码，您就可以在运行时编程创建数据库

```
database mydb = new EnterpriseLibrary.Data.Sql.SqlDatabase("connection string here"); 
```

它解决了我的问题。我有一个使用多个数据库的单个 Web 应用程序，根据 url 中的不同子域连接到不同的数据库。如：

*   abc.test.com ------>使用 Db_projectABC
*   def.test.com ------>使用 db_ProjectDEF

我使用 url-rewrite 解析子域名，并使用子域名选择它存储在主数据库中的数据库连接字符串。

谢谢

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-03T11:02:09.293

如果您查看“ [Enterprise Library Docs - 添加应用程序代码](http://msdn.microsoft.com/en-us/library/dd139953.aspx)”，它会说：

> “如果你知道你要创建的数据库的连接字符串，你可以绕过应用程序的配置信息，使用构造函数直接创建Database对象。因为Database类是抽象基类，你必须构造一个它的派生类类型。派生的数据库类型决定了 ADO.NET 数据提供者。例如，SqlDatabase 类使用 SqlClientFactory 提供者，SqlCeDatabase 类使用 SqlCeProviderFactory 提供者，OracleDatabase 类使用 OracleClientFactory 提供者。您有责任构造适当的连接字符串的数据库类的类型。”

然后继续举一些例子。这表明您不应该使用 DatabaseFactory，而应该为每个不同的连接创建一个新的 Database 类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-02-19T07:30:49.347

我们可以使用下面的代码片段来连接多个数据库。

**要添加为参考的 DLL**

1.  Microsoft.Practices.EnterpriseLibrary.Common.dll
2.  Microsoft.Practices.EnterpriseLibrary.Data.dll
3.  Microsoft.Practices.ServiceLocation.dll

片段：

```
var builder = new ConfigurationSourceBuilder();

        builder.ConfigureData()
               .ForDatabaseNamed("LocalSqlServer1")
                 .ThatIs.ASqlDatabase()
                 .WithConnectionString(@"Data Source=PCNAME\SQLEXPRESS;Initial Catalog=ContactDB;Integrated Security=True")
               .ForDatabaseNamed("LocalSqlServer2")
                 .ThatIs.ASqlDatabase()
                 .WithConnectionString(@"Data Source=PCNAME\SQLEXPRESS;Initial Catalog=MyDB;Integrated Security=True");

        var configSource = new DictionaryConfigurationSource();
        builder.UpdateConfigurationWithReplace(configSource);

Microsoft.Practices.EnterpriseLibrary.Common.Configuration.EnterpriseLibraryContainer.Current = EnterpriseLibraryContainer.CreateDefaultContainer(configSource);      

Database destinationDatabase = DatabaseFactory.CreateDatabase("LocalSqlServer2"); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-08T15:01:33.610

以下是杨的网区：

```
using Microsoft.Practices.EnterpriseLibrary.Data;
using Microsoft.Practices.EnterpriseLibrary.Configuration;
using Microsoft.Practices.EnterpriseLibrary.Data.Configuration;

DatabaseSettings settings = new DatabaseSettings();

// This maps to <databaseType> element in data config file
DatabaseTypeData type = new DatabaseTypeData("Sql Server", "Microsoft.Practices.EnterpriseLibrary.Data.Sql.SqlDatabase, Microsoft.Practices.EnterpriseLibrary.Data, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null");
settings.DatabaseTypes.Add(type);

// This maps to <connectionString> element in data config file
ConnectionStringData connectionString = new ConnectionStringData("localhost.EntLibQuickStarts");

// Followings map to <parameter> elements in data config file
ParameterData param = new ParameterData("server", "localhost");
connectionString.Parameters.Add(param);

param = new ParameterData("database", "EntLibQuickStarts");
connectionString.Parameters.Add(param);

param = new ParameterData("integrated security", "true");
connectionString.Parameters.Add(param);

settings.ConnectionStrings.Add(connectionString);

// Too bad compiler gets confused InstanceData with System.Diagnostics.InstanceData.  It maps to <instance> element in data config file
Microsoft.Practices.EnterpriseLibrary.Data.Configuration.InstanceData instance = new    Microsoft.Practices.EnterpriseLibrary.Data.Configuration.InstanceData("localhost", "Sql Server", "localhost.EntLibQuickStarts");
settings.Instances.Add(instance);

ConfigurationDictionary configurations = new ConfigurationDictionary();

// This is how to tie DatabaseSettings with ConfigurationDictionary. It maps to <configurationSection name="dataConfiguration"> element in App.config file    configurations.Add("dataConfiguration", settings);
ConfigurationContext context = ConfigurationManager.CreateContext(configurations);

Database database = new DatabaseProviderFactory(context).CreateDatabase("localhost"); 
```

# database - 使用 Zoho Creator 的经验？

> ID：326366
> 
> 赞同：0
> 
> 时间：2008-11-28T18:18:37.777
> 
> 标签：database, zoho

我希望创建一个在线系统来跟踪一些事情（例如，一个有孩子的数据库，每个孩子都有一次或多次医生的访问）。我希望用户能够输入数据以及搜索数据，尤其是通过移动设备。因此，这是一个适度但非零大小的自定义移动在线数据库应用程序。

我研究了 DabbleDB 和 Zoho Creator，寻找一种维护成本低的简单解决方案。

虽然我觉得我的应用程序并不太复杂，但我发现如果我想做一些稍微脱离主流的事情，我就会碰壁。例如，处理多对多关系，或处理 100K 记录，或对字段进行涉及的数学计算。

人们对这些在线数据库应用的体验如何？我应该继续前进，还是自己编写一个自定义应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T00:39:41.493

我还尝试使用 Zoho Creator 构建一个简单的 Web 应用程序，结果非常沮丧，以至于我现在正在寻找不同的解决方案。我认为 Zoho Creator 现在适合用于教育目的，但我不会考虑将其用于功能性应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-01T16:34:48.310

我认为这个系统还不错，但他们是有偿的。他们的价格令人印象深刻！使用免费应用程序，例如[mytaskhelper](http://mytaskhelper.com) 谢谢

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-29T10:35:45.780

我将它用于个人和商业用途。事实上，我创建了 3 个应用程序，在实际业务环境中使用，并在没有额外投资的情况下解决了很多问题。

您可以使用用户友好的表单轻松创建处理成千上万条记录的应用程序，甚至嵌入到其他网站中。

将 Creator 连接到 Reports 可以完成更多 BI 任务。这只是一个例子。

我认为你应该认真考虑一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-20T18:36:21.713

你有没有看过[Viravis](http://www.viravis.com "在线数据库应用平台")。这可能是您正在寻找的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-05T05:44:05.787

您是否尝试过使用 LongJump，该解决方案允许您使用几个可用模板之一轻松构建应用程序。我对此非常满意。

# c# - WPF：选中/取消选中位于gridview单元格模板中的复选框的所有复选框？

> ID：326374
> 
> 赞同：3
> 
> 时间：2008-11-28T18:24:37.783
> 
> 标签：c#, wpf, data-binding, gridview, checkbox

我正在尝试创建一个选中/取消选中所有`CheckBox`位于. 我将此列添加到 a （连同其他列），将 设置为 a 的 view 属性，然后将数据绑定到 custom 的集合。因此，每一行都有一个包含复选框的列以及绑定到绑定对象的属性路径的列。`CheckBoxes``GridViewColumn``GridView``GridView``ListView``ListView``DataObjects``ListView`

我想`CheckBox`通过绑定 的`IsChecked`属性来创建全部选中/取消选中`CheckBoxes`，但我不想更改`ListView`绑定到的数据对象。我的第一次尝试是将 ListView 绑定到 a`Dictionary<DataObject,Boolean>`然后将`IsChecked`属性绑定到`Value`the`Dictionary`和其他列到`Key`. *`DataObjectProperty`*. 然后，我只是在单击选中/取消选中所有时切换了`Values`字典`CheckBox`。绑定工作正常，但显然字典不支持更改通知，因此`CheckBoxes`从未更新。

有没有人对解决这个问题的最佳方法有任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T18:42:40.087

我能想到的唯一方法是将您的 DataObject 和布尔值包装在一个实现 INotofyPropertyChanged 的​​新类中。说新类是YourCollection。将实例绑定`ObservableCollection< YourNewClass >`到您的 ListView

```
 public class YourNewClass :INotifyPropertyChanged
{
    public YourDataObject Object { get; set; }

    private bool _isChecked;
    public bool IsChecked
    {
        get
        {
            return _isChecked;
        }
        set
        {
            _isChecked = value;
            OnPropertyChanged("IsChecked");
        }
    }

    public event PropertyChangedEventHandler PropertyChanged;
    protected virtual void OnPropertyChanged(string propertyName)
    {
        if (PropertyChanged != null)
            PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
    }
} 
```

# php - Hotmail、Gmail 和 Yahoo 的 PHP API？

> ID：326379
> 
> 赞同：21
> 
> 时间：2008-11-28T18:27:14.110
> 
> 标签：php, api, gmail, yahoo, hotmail

我是一名 PHP 开发人员，有点像泡菜。我正在尝试查找和/或构建一个能够与 Hotmail、Yahoo 和 GMAIL 对话的 API，以检索联系人列表（当然，在用户同意的情况下）。我最难找到的是Hotmail API。

我会从哪里开始寻找一个工作的、稳定的 API 或者我可以采取哪些步骤来开发一个用于 hotmail 的 API？是否有一个涵盖了我可以实施的所有这些基础？任何帮助将不胜感激！

谢谢！

编辑：我确实设法获得了一些服务，但是，我一直在为至少一个客户项目使用 Open Inviter，而且它似乎表现良好。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-28T20:57:25.260

一些指示：

*   Gmail：[谷歌通讯录数据 API](http://code.google.com/apis/contacts/)
*   雅虎：
    *   [地址簿 API](http://developer.yahoo.com/addressbook/) **（已弃用）**
    *   [联系人 API](http://developer.yahoo.com/social/rest_api_guide/contact_api.html)
*   Hotmail：[Windows Live 联系人 API](http://msdn.microsoft.com/en-us/library/bb463989.aspx-)

我发现的大多数脚本等并没有真正起作用。有一个商业广告使用抓取来检索联系人，但我认为这些尝试存在相当大的缺陷。上面的链接应该给你一个如何访问每个服务的地址簿的例子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T01:24:43.690

Plaxo 有一个[API 小部件](http://www.plaxo.com/api/widget)可以从 Gmail、Yahoo、AOL 和 Hotmail 导入联系人。[您可以在此处](http://www.plaxo.com/api/widget_demo)查看它的实际演示。它以前在 IE7 上遇到过一个小问题（上次检查是半年前），但如果解决了它可能会满足您的需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T19:22:58.273

Rapleaf 可能有一些适合你的东西：

[http://www.phpclasses.org/browse/package/4436.html](http://www.phpclasses.org/browse/package/4436.html)

该服务似乎与某些提供商玩猫捉老鼠，因为并非所有电子邮件提供商都提供稳定的 API 用于与其服务进行通信。（这会破坏他们的商业模式。）所以，如果你使用这些并且电子邮件提供商以某种方式打破了链条，那么你就会被打破，直到 Rapleaf 赶上来。

# wcf - 在处理单向 WCF 操作时，是否有任何关于 IIS 何时可能回收的保证？

> ID：326382
> 
> 赞同：2
> 
> 时间：2008-11-28T18:27:54.657
> 
> 标签：wcf, iis, recycle

## 背景

这个问题分为两部分。

我在 IIS 6 中托管了一个单向 WCF 操作。以下是我对其工作原理的理解：

> _1。IIS 收到一个请求。
> 
> _2。IIS 发送 HTTP 202 响应（谢谢，我稍后会处理）。
> 
> _3。IIS 调用我的单向 WCF 操作。

现在控制传递给我的 WCF 操作，它执行以下操作：

> _4。将请求信息保存到事务性的持久存储中。
> 
> _5。开始处理 OLTP 数据库中的请求。
> 
> _6。如果出现错误，请从第 5 步开始重复，或采取一些补救措施，然后清理第 4 步中保留的数据。

## 问题 1

我对 IIS 何时发送 HTTP 202 响应的理解是否正确？

## 问题2

如果 IIS 在第 2 步和第 4 步之间循环，我可能会丢失请求信息，然后再进行更改以保留它，但在客户端认为我已接受该消息之后。当有未决的请求时，IIS 是否提供了关于何时回收或不回收的任何保证？

* * *

PS：请原谅狡猾的格式。出于某种原因，降价完全搞砸了我的编号列表项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T09:28:03.510

我不确定你的假设是否正确。

即使是单向交互，在返回 202 之前，WCF 也可以非常投入；例如，如果您使用身份验证，则这一切都必须在调用方法和返回 202 之前发生，这样如果有任何问题都可以报告。

例如，如果您使用开箱即用的 wsHttpBinding，您将在实际方法调用之前看到 2-3 次消息交换，导致 200 次。这是为了交换安全信息并建立安全上下文。

诚然，如果您将服务配置为没有安全性，则不会发生这种情况，它会立即返回 202，但这表明它必须知道它是否可以从 WCF 堆栈中做到这一点。

除了所有这些 - 我不确定你想要实现什么 - 你指的是哪个 IIS 回收？我根本不是 IIS 专家，但我怀疑它会在某些东西正在积极执行时回收主机；如果您指的是手动重新启动应用程序池（或 IIS，或与此相关的机器）的任何人，我怀疑您可以做很多事情。

如果您必须确定消息不会丢失，那么我知道的唯一保证方法就是以一种或另一种方式采用可靠的消息传递，它只确认请求一旦持久存储在持久存储中；

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T16:05:02.367

在我看来，有几件事我会建议：

我知道在 IIS 中管理进程回收的唯一方法是查看您的网站正在使用的应用程序池。如果您打开 IIS 管理器 -> 应用程序池 -> 选择您的池，然后右键单击属性，在“回收”选项卡上，其中的选项可能会对您有所帮助。我想这并不能保证您不会在回收中丢失请求，但设置更长的时间会降低这种情况的可能性。

但是，听起来您要构建的系统是 MSMQ 的理想候选者，它可以提供异步服务请求，这些请求可以正确排队，而且开销或手动管道非常少。这将使您完全避免整个过程的回收问题。我不确定这是否适合您的方案，但可能需要研究一下。

# http - HTTP缓存，浏览器怪异和其他一切！

> ID：326384
> 
> 赞同：0
> 
> 时间：2008-11-28T18:28:12.423
> 
> 标签：http, caching, http-headers

昨天我试图认真对待正确缓存一些 PHP 生成的页面（想想“带有评论的文章”）。极大的失败。

长话短说：我设置了 ETag 标头，设置了 Last-Modified 标头，并与他们一起检查每个文章浏览器请求的服务器端，看看我是否可以发回 304。

问题很简单：浏览器（到目前为止尝试使用 FF 3）在 1 或 2 次重新加载后，突然停止检查页面的新鲜度并使用其缓存副本。

据我了解，使用 ETag 和 Last-Modified，浏览器必须检查每个请求的服务器（否则，为什么我们应该使用 ETag？）。

我也尝试过使用 Cache-Control 或 Expires ......什么也没有。一种或另一种方式，浏览器停止检查，或者不发回 ETag ......

我真的很沮丧……有人碰巧解决了这件事吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T18:58:35.607

如果您希望浏览器重新验证，您应该始终设置“过期”。

Firefox3 做检查是基于“Expires”标头。如果它丢失，firefox3 将弥补性能的过期日期。

参考，[firefox和ie缓存的区别](http://blog.httpwatch.com/2008/10/15/two-important-differences-between-firefox-and-ie-caching/)

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-12-02T15:01:43.697

您可以在以下位置检查当前的 FF 缓存条目

```
about:cache 
```

这将向您显示 FF 与每个缓存条目一起存储的过期日期。

# visual-studio - 如何在 ReSharper 中使用 using 语句包围代码块？

> ID：326387
> 
> 赞同：4
> 
> 时间：2008-11-28T18:29:17.087
> 
> 标签：visual-studio, visual-studio-2008, refactoring, resharper, coderush

我正在观看 Stephen A Bohlen 的出色的[Summer of NHibernate](http://www.summerofnhibernate.com/)系列，并且一直在观看他与 CodeRush 的互动。我最近安装了 ReSharper（我是 ReSharper 新手），我正在尝试找到 Stephen 用 CodeRush（切线）展示的一些 ReSharper 生产力等价物。

例如，他演示了突出显示如下所示的代码块：

```
ISession session = GetSession();
session.xxx 
```

然后把它变成

```
using (ISession session = GetSession())
{
   session.xxx
} 
```

他通过使用 using 语句突出显示他想要*包围*的块然后调用一些 CodeRush 模板来做到这一点。我一直无法弄清楚如何用 ReSharper 做同样的事情。我找到了 ReSharper Surround 命令（在 Code 命令中），但是当您选择**using**语句时，它确实围绕着您突出显示的代码块，但它似乎不够*聪明*，无法将第一行放在 using 子句中。也就是说，它导致：

```
using () 
{
  ISession session = GetSession();
  session.xxx
} 
```

这需要我将第一行移到 using 子句中。我错过了更简单的方法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-28T21:29:31.450

Resharper 提供了这种能力。如果你的类实现了 IDisposable，只需按 Alt-Enter：

*（删除图像死链接“之前”）*
*（删除图像死链接“之后”）*

您还必须将光标放在变量名上。像这样：[SShot1](http://img204.imageshack.us/img204/3872/sshot1dd8.jpg) [SShot2](http://img99.imageshack.us/img99/9543/sshot2dn0.jpg) [SShot3](http://img220.imageshack.us/img220/9697/sshot3hd5.jpg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T02:03:03.793

我只是在看那一集，想知道我是否也有同样的问题。根据这里的线索，我发现如果我有这个代码：

```
1        IList<Supplier> returnValue;
2        ISession session = SessionProvider.GetSession();
3        returnValue = session.CreateQuery("select from Supplier s").List<Supplier>();
4        return returnValue; 
```

如果我将光标放在第 2 行的会话变量上，然后按 Alt-Enter，它会给我：

```
1        IList<Supplier> returnValue;
2        using (ISession session = SessionProvider.GetSession())
3        {
4            returnValue = session.CreateQuery("select from Supplier s").List<Supplier>();
5        }
6        return returnValue; 
```

它确实让我有好几次，因为我没有将光标放在变量名上，但我确实让它工作了。

顺便说一句，我真的更喜欢观看他们使用 Code Rush 的演示，因为您可以直观地看到正在发生的事情。我想知道如果我不演讲，这是否会妨碍我。

而且您不是 Resharper 新手：您是 Resharper Padawan :)

沼泽

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T21:35:27.570

或者，如果您处于已经输入 using 的情况，并且您想用大括号包装大量代码......您可以执行`CTRL`- `E`+`U`然后`7`.

它将用大括号包裹选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T18:04:45.823

我想知道我的 ReSharper 设置是否有问题。当我的光标在

```
Class1 c = new Class1(); 
```

在下面的代码示例中，ReSharper 仅建议**使用 'var'**。如果既不提供**拆分声明和赋值**也不提供**使用构造**？

（Mindaugas——您对 DirectoryInfo 的评论当然是正确的。我的错。希望这个示例更清楚地说明了我所看到的内容）。

```
using System;

namespace DataAccessLayerTest {
    public class Class1 : IDisposable {
        public void Moo()
        {
            Console.Out.WriteLine("Moo");
        }
        public void Dispose()
        {
        }
    }

    public class Class2 {
        public void m()
        {
            Class1 c = new Class1();
            c.Moo();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-06-11T07:06:52.643

在 Visual Studio 2013 上是++`CTRL`这 应该会带来以下对话框`E``U`

![在此处输入图像描述](https://i.stack.imgur.com/djo3C.png)

然后`A`为`using`.

希望这可以节省您一些时间。

# java - 如何从文件内容创建 Java 字符串？

> ID：326390
> 
> 赞同：1675
> 
> 时间：2008-11-28T18:32:07.253
> 
> 标签：java, string, file, file-io, io

一段时间以来，我一直在使用下面的成语。它似乎是最广泛的，至少在我访问过的网站上。

有没有更好/不同的方法将文件读入Java中的字符串？

```
private String readFile(String file) throws IOException {
    BufferedReader reader = new BufferedReader(new FileReader (file));
    String         line = null;
    StringBuilder  stringBuilder = new StringBuilder();
    String         ls = System.getProperty("line.separator");

    try {
        while((line = reader.readLine()) != null) {
            stringBuilder.append(line);
            stringBuilder.append(ls);
        }

        return stringBuilder.toString();
    } finally {
        reader.close();
    }
} 
```

* * *

## 回答 #1

> 赞同：1742
> 
> 时间：2008-11-28T18:56:13.693

## 从文件中读取所有文本

Java 11 添加了[readString()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/Files.html#readString(java.nio.file.Path,java.nio.charset.Charset))方法来读取小文件`String`，保留行终止符：

```
String content = Files.readString(path, StandardCharsets.US_ASCII); 
```

对于 Java 7 和 11 之间的版本，这是一个紧凑、健壮的习惯用法，包含在一个实用方法中：

```
static String readFile(String path, Charset encoding)
  throws IOException
{
  byte[] encoded = Files.readAllBytes(Paths.get(path));
  return new String(encoded, encoding);
} 
```

## 从文件中读取文本行

Java 7 添加了一种[方便的方法，可以将文件读取为文本行，](https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllLines%28java.nio.file.Path,%20java.nio.charset.Charset%29)表示为`List<String>`. 这种方法是“有损的”，因为行分隔符从每行的末尾被剥离。

```
List<String> lines = Files.readAllLines(Paths.get(path), encoding); 
```

Java 8 添加了[`Files.lines()`](https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#lines-java.nio.file.Path-java.nio.charset.Charset-)生成`Stream<String>`. 同样，这种方法是有损的，因为行分隔符被剥离。如果`IOException`在读取文件时遇到 an ，则将其包装在 中[`UncheckedIOException`](https://docs.oracle.com/javase/8/docs/api/java/io/UncheckedIOException.html)，因为`Stream`不接受引发检查异常的 lambda。

```
try (Stream<String> lines = Files.lines(path, encoding)) {
  lines.forEach(System.out::println);
} 
```

这`Stream`确实需要一个[`close()`](https://docs.oracle.com/javase/8/docs/api/java/util/stream/BaseStream.html#close--)电话；这在 API 上的记录很差，我怀疑很多人甚至没有注意到`Stream`有一个`close()`方法。一定要使用如图所示的 ARM 块。

如果您正在使用文件以外的源，则可以改用该[`lines()`](https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html#lines--)方法`BufferedReader`。

## 内存利用率

第一种保留换行符的方法可能会暂时需要几倍于文件大小的内存，因为在短时间内原始文件内容（字节数组）和解码的字符（每个字符都是 16 位，即使已编码）作为文件中的 8 位）一次驻留在内存中。应用到您知道相对于可用内存较小的文件是最安全的。

第二种方法，读取行，通常更节省内存，因为用于解码的输入字节缓冲区不需要包含整个文件。但是，它仍然不适合相对于可用内存非常大的文件。

为了读取大文件，您需要对程序进行不同的设计，即从流中读取一大块文本，对其进行处理，然后继续下一个，重用相同的固定大小的内存块。在这里，“大”取决于计算机规格。如今，这个阈值可能是数 GB 的 RAM。`Stream<String>`如果您输入的“记录”恰好是单独的行，则使用第三种方法是一种方法。（使用 的`readLine()`方法`BufferedReader`是这种方法的程序等价物。）

## 字符编码

原始帖子中的示例中缺少的一件事是字符编码。在某些特殊情况下，平台默认值是您想要的，但它们很少见，您应该能够证明您的选择是合理的。

该类[`StandardCharsets`](https://docs.oracle.com/javase/7/docs/api/java/nio/charset/StandardCharsets.html)为所有 Java 运行时所需的编码定义了一些常量：

```
String content = readFile("test.txt", StandardCharsets.UTF_8); 
```

平台默认值可从[类`Charset`本身](https://docs.oracle.com/javase/7/docs/api/java/nio/charset/Charset.html#defaultCharset%28%29)获得：

```
String content = readFile("test.txt", Charset.defaultCharset()); 
```

* * *

注意：这个答案在很大程度上取代了我的 Java 6 版本。Java 7 的实用程序安全地简化了代码，并且使用映射字节缓冲区的旧答案阻止了读取的文件被删除，直到映射缓冲区被垃圾收集。您可以通过此答案的“已编辑”链接查看旧版本。

* * *

## 回答 #2

> 赞同：389
> 
> 时间：2008-11-28T18:44:36.697

如果您愿意使用外部库，请查看[Apache Commons IO](https://commons.apache.org/proper/commons-io/) (200KB JAR)。它包含一个方法，允许您使用一行代码[`org.apache.commons.io.FileUtils.readFileToString()`](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/FileUtils.html#readFileToString-java.io.File-java.nio.charset.Charset-)将整个内容读`File`入 a中。`String`

例子：

```
import java.io.*;
import java.nio.charset.*;
import org.apache.commons.io.*;

public String readFile() throws IOException {
    File file = new File("data.txt");
    return FileUtils.readFileToString(file, StandardCharsets.UTF_8);
} 
```

* * *

## 回答 #3

> 赞同：190
> 
> 时间：2011-09-16T20:02:17.840

一个非常精益的解决方案，基于[`Scanner`](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/Scanner.html)：

```
Scanner scanner = new Scanner( new File("poem.txt") );
String text = scanner.useDelimiter("\\A").next();
scanner.close(); // Put this call in a finally block 
```

或者，如果要设置字符集：

```
Scanner scanner = new Scanner( new File("poem.txt"), "UTF-8" );
String text = scanner.useDelimiter("\\A").next();
scanner.close(); // Put this call in a finally block 
```

或者，使用[try-with-resources](https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)块，它会调用`scanner.close()`你：

```
try (Scanner scanner = new Scanner( new File("poem.txt"), "UTF-8" )) {
    String text = scanner.useDelimiter("\\A").next();
} 
```

请记住，`Scanner`构造函数可以抛出一个`IOException`. 并且不要忘记导入`java.io`和`java.util`.

资料来源：[Pat Niemeyer 的博客](https://web.archive.org/web/20110516145331im_/http://weblogs.java.net/blog/pat/archive/2004/10/stupid_scanner.html)

* * *

## 回答 #4

> 赞同：148
> 
> 时间：2016-10-28T07:04:17.057

```
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Paths; 
```

**爪哇 7**

```
String content = new String(Files.readAllBytes(Paths.get("readMe.txt")), StandardCharsets.UTF_8); 
```

**爪哇 11**

```
String content = Files.readString(Paths.get("readMe.txt")); 
```

* * *

## 回答 #5

> 赞同：81
> 
> 时间：2008-11-28T19:00:35.183

如果您正在寻找不涉及第三方库（例如[Commons I/O](https://commons.apache.org/proper/commons-io/)）的替代方案，您可以使用[Scanner](http://java.sun.com/javase/6/docs/api/java/util/Scanner.html)类：

```
private String readFile(String pathname) throws IOException {

    File file = new File(pathname);
    StringBuilder fileContents = new StringBuilder((int)file.length());        

    try (Scanner scanner = new Scanner(file)) {
        while(scanner.hasNextLine()) {
            fileContents.append(scanner.nextLine() + System.lineSeparator());
        }
        return fileContents.toString();
    }
} 
```

* * *

## 回答 #6

> 赞同：72
> 
> 时间：2010-02-08T20:08:37.603

[Guava](https://github.com/google/guava/)的方法类似于 Willi aus Rohr 提到的 Commons IOUtils 中的方法：

```
import com.google.common.base.Charsets;
import com.google.common.io.Files;

// ...

String text = Files.toString(new File(path), Charsets.UTF_8); 
```

**PiggyPiglet 的 EDIT**
`Files#toString`已弃用，将于 2019 年 10 月移除。改为使用 `Files.asCharSource(new File(path), StandardCharsets.UTF_8).read();`

**奥斯卡·雷耶斯编辑**

这是引用库上的（简化的）底层代码：

```
InputStream in = new FileInputStream(file);
byte[] b  = new byte[file.length()];
int len = b.length;
int total = 0;

while (total < len) {
  int result = in.read(b, total, len - total);
  if (result == -1) {
    break;
  }
  total += result;
}

return new String( b , Charsets.UTF_8 ); 
```

**编辑**（由 Jonik 提供）：以上内容与最近 Guava 版本的源代码不匹配。对于当前源，请参阅[com.google.common.io](https://github.com/google/guava/blob/master/guava/src/com/google/common/io)包中的[Files](https://github.com/google/guava/blob/master/guava/src/com/google/common/io/Files.java)、[CharStreams](https://github.com/google/guava/blob/master/guava/src/com/google/common/io/CharStreams.java)、[ByteSource](https://github.com/google/guava/blob/master/guava/src/com/google/common/io/ByteSource.java)和[CharSource类。](https://github.com/google/guava/blob/master/guava/src/com/google/common/io/CharSource.java)

* * *

## 回答 #7

> 赞同：59
> 
> 时间：2012-04-16T14:33:59.960

```
import java.nio.file.Files; 
```

…………

```
 String readFile(String filename) {
            File f = new File(filename);
            try {
                byte[] bytes = Files.readAllBytes(f.toPath());
                return new String(bytes,"UTF-8");
            } catch (FileNotFoundException e) {
                e.printStackTrace();
            } catch (IOException e) {
                e.printStackTrace();
            }
            return "";
    } 
```

* * *

## 回答 #8

> 赞同：52
> 
> 时间：2014-10-29T08:51:58.050

如果你需要一个字符串处理（并行处理），Java 8 有很棒的 Stream API。

```
String result = Files.lines(Paths.get("file.txt"))
                    .parallel() // for parallel processing 
                    .map(String::trim) // to change line   
                    .filter(line -> line.length() > 2) // to filter some lines by a predicate                        
                    .collect(Collectors.joining()); // to join lines 
```

JDK 示例中提供了更多示例`sample/lambda/BulkDataOperations`，可从[Oracle Java SE 8 下载页面下载](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html)

另一个班轮示例

```
String out = String.join("\n", Files.readAllLines(Paths.get("file.txt"))); 
```

* * *

## 回答 #9

> 赞同：51
> 
> 时间：2008-11-28T19:56:35.287

该代码将规范换行符，这可能是也可能不是您真正想要做的。

这是一个不这样做的替代方案，并且（IMO）比 NIO 代码更易于理解（尽管它仍然使用`java.nio.charset.Charset`）：

```
public static String readFile(String file, String csName)
            throws IOException {
    Charset cs = Charset.forName(csName);
    return readFile(file, cs);
}

public static String readFile(String file, Charset cs)
            throws IOException {
    // No real need to close the BufferedReader/InputStreamReader
    // as they're only wrapping the stream
    FileInputStream stream = new FileInputStream(file);
    try {
        Reader reader = new BufferedReader(new InputStreamReader(stream, cs));
        StringBuilder builder = new StringBuilder();
        char[] buffer = new char[8192];
        int read;
        while ((read = reader.read(buffer, 0, buffer.length)) > 0) {
            builder.append(buffer, 0, read);
        }
        return builder.toString();
    } finally {
        // Potential issue here: if this throws an IOException,
        // it will mask any others. Normally I'd use a utility
        // method which would log exceptions and swallow them
        stream.close();
    }        
} 
```

* * *

## 回答 #10

> 赞同：31
> 
> 时间：2018-05-29T10:09:02.563

收集了从磁盘或网络读取文件作为字符串的所有可能方法。

*   [番石榴：谷歌](https://github.com/google/guava)使用类[`Resources`](https://google.github.io/guava/releases/21.0/api/docs/com/google/common/io/Resources)，[`Files`](https://google.github.io/guava/releases/21.0/api/docs/com/google/common/io/Files)

    ```
    static Charset charset = com.google.common.base.Charsets.UTF_8;
    public static String guava_ServerFile( URL url ) throws IOException {
        return Resources.toString( url, charset );
    }
    public static String guava_DiskFile( File file ) throws IOException {
        return Files.toString( file, charset );
    } 
    ```

* * *

*   [APACHE -](http://commons.apache.org/proper/commons-io/description.html)使用 IOUtils、FileUtils 类的COMMONS IO

    ```
    static Charset encoding = org.apache.commons.io.Charsets.UTF_8;
    public static String commons_IOUtils( URL url ) throws IOException {
        java.io.InputStream in = url.openStream();
        try {
            return IOUtils.toString( in, encoding );
        } finally {
            IOUtils.closeQuietly(in);
        }
    }
    public static String commons_FileUtils( File file ) throws IOException {
        return FileUtils.readFileToString( file, encoding );
        /*List<String> lines = FileUtils.readLines( fileName, encoding );
        return lines.stream().collect( Collectors.joining("\n") );*/
    } 
    ```

* * *

*   使用[Stream API](http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html)的Java 8 [BufferReader](https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html)

    ```
    public static String streamURL_Buffer( URL url ) throws IOException {
        java.io.InputStream source = url.openStream();
        BufferedReader reader = new BufferedReader( new InputStreamReader( source ) );
        //List<String> lines = reader.lines().collect( Collectors.toList() );
        return reader.lines().collect( Collectors.joining( System.lineSeparator() ) );
    }
    public static String streamFile_Buffer( File file ) throws IOException {
        BufferedReader reader = new BufferedReader( new FileReader( file ) );
        return reader.lines().collect(Collectors.joining(System.lineSeparator()));
    } 
    ```

* * *

*   带有正则表达式的扫描仪类`\A`。与输入的开头匹配。

    ```
    static String charsetName = java.nio.charset.StandardCharsets.UTF_8.toString();
    public static String streamURL_Scanner( URL url ) throws IOException {
        java.io.InputStream source = url.openStream();
        Scanner scanner = new Scanner(source, charsetName).useDelimiter("\\A");
        return scanner.hasNext() ? scanner.next() : "";
    }
    public static String streamFile_Scanner( File file ) throws IOException {
        Scanner scanner = new Scanner(file, charsetName).useDelimiter("\\A");
        return scanner.hasNext() ? scanner.next() : "";
    } 
    ```

* * *

*   Java 7 ( `java.nio.file.Files.readAllBytes`)

    ```
    public static String getDiskFile_Java7( File file ) throws IOException {
        byte[] readAllBytes = java.nio.file.Files.readAllBytes(Paths.get( file.getAbsolutePath() ));
        return new String( readAllBytes );
    } 
    ```

* * *

*   `BufferedReader`使用`InputStreamReader`.

    ```
    public static String getDiskFile_Lines( File file ) throws IOException {
        StringBuffer text = new StringBuffer();
        FileInputStream fileStream = new FileInputStream( file );
        BufferedReader br = new BufferedReader( new InputStreamReader( fileStream ) );
        for ( String line; (line = br.readLine()) != null; )
            text.append( line + System.lineSeparator() );
        return text.toString();
    } 
    ```

* * *

使用 main 方法访问上述方法的示例。

```
public static void main(String[] args) throws IOException {
    String fileName = "E:/parametarisation.csv";
    File file = new File( fileName );

    String fileStream = commons_FileUtils( file );
            // guava_DiskFile( file );
            // streamFile_Buffer( file );
            // getDiskFile_Java7( file );
            // getDiskFile_Lines( file );
    System.out.println( " File Over Disk : \n"+ fileStream );

    try {
        String src = "https://code.jquery.com/jquery-3.2.1.js";
        URL url = new URL( src );

        String urlStream = commons_IOUtils( url );
                // guava_ServerFile( url );
                // streamURL_Scanner( url );
                // streamURL_Buffer( url );
        System.out.println( " File Over Network : \n"+ urlStream );
    } catch (MalformedURLException e) {
        e.printStackTrace();
    }
} 
```

* * *

@看

*   [将 InputStream 转换为字符串的方法](https://stackoverflow.com/a/35446009/5081877)

* * *

## 回答 #11

> 赞同：26
> 
> 时间：2011-10-17T15:34:03.290

如果它是一个文本文件，为什么不使用[apache commons-io](http://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/FileUtils.html)？

它有以下方法

```
public static String readFileToString(File file) throws IOException 
```

如果您希望将这些行作为列表使用

```
public static List<String> readLines(File file) throws IOException 
```

* * *

## 回答 #12

> 赞同：25
> 
> 时间：2018-06-26T14:26:44.880

从 JDK 11 开始：

```
String file = ...
Path path = Paths.get(file);
String content = Files.readString(path);
// Or readString(path, someCharset), if you need a Charset different from UTF-8 
```

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2010-04-18T07:34:29.137

将文件读取为二进制文件并在最后进行转换

```
public static String readFileAsString(String filePath) throws IOException {
    DataInputStream dis = new DataInputStream(new FileInputStream(filePath));
    try {
        long len = new File(filePath).length();
        if (len > Integer.MAX_VALUE) throw new IOException("File "+filePath+" too large, was "+len+" bytes.");
        byte[] bytes = new byte[(int) len];
        dis.readFully(bytes);
        return new String(bytes, "UTF-8");
    } finally {
        dis.close();
    }
} 
```

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2016-04-19T16:39:06.130

使用 Java 7，这是我读取 UTF-8 文件的首选选项：

```
String content = new String(Files.readAllBytes(Paths.get(filename)), "UTF-8"); 
```

从 Java 7 开始，JDK 有了新的`java.nio.file`API，它提供了许多快捷方式，因此简单的文件操作并不总是需要 3rd 方库。

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2008-11-28T18:52:37.833

Java 试图在它所做的所有事情上都非常通用和灵活。结果，在脚本语言中相对简单的东西（您的代码将`open(file).read()`在 python 中替换为“”）要复杂得多。[除了使用外部库（如Willi aus Rohr](https://stackoverflow.com/questions/326390/is-there-an-alternative-to-this-way-of-read-file-to-a-string-in-java#326413)提到的）外，似乎没有更短的方法可以做到这一点。您的选择：

*   使用外部库。
*   将此代码复制到您的所有项目中。
*   创建您自己的迷你库，其中包含您经常使用的功能。

您最好的选择可能是第二个，因为它具有最少的依赖性。

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2018-06-21T05:46:40.693

# 使用 JDK 8 或更高版本：

***没有使用外部库***

您可以从文件内容创建一个新的 String 对象（使用`java.nio.file`包中的类）：

```
public String readStringFromFile(String filePath) throws IOException {
    String fileContent = new String(Files.readAllBytes(Paths.get(filePath)));
    return fileContent;
} 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2008-11-28T20:33:13.497

同一主题有一个变体，它使用 for 循环而不是 while 循环来限制 line 变量的范围。是否“更好”是个人品味的问题。

```
for(String line = reader.readLine(); line != null; line = reader.readLine()) {
    stringBuilder.append(line);
    stringBuilder.append(ls);
} 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2015-01-06T18:52:59.440

如果您无权访问`Files`该类，则可以使用本机解决方案。

```
static String readFile(File file, String charset)
        throws IOException
{
    FileInputStream fileInputStream = new FileInputStream(file);
    byte[] buffer = new byte[fileInputStream.available()];
    int length = fileInputStream.read(buffer);
    fileInputStream.close();
    return new String(buffer, 0, length, charset);
} 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2012-02-15T10:47:35.240

使用来自 Apache [commons-io的](http://commons.apache.org/io/)[IOUtils](http://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/IOUtils.html)和[StringWriter](http://docs.oracle.com/javase/6/docs/api/java/io/StringWriter.html)的灵活解决方案：

```
Reader input = new FileReader();
StringWriter output = new StringWriter();
try {
  IOUtils.copy(input, output);
} finally {
  input.close();
}
String fileContents = output.toString(); 
```

它适用于任何阅读器或输入流（不仅仅是文件），例如从 URL 读取时。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2010-02-08T19:51:12.280

```
public static String slurp (final File file)
throws IOException {
    StringBuilder result = new StringBuilder();

    BufferedReader reader = new BufferedReader(new FileReader(file));

    try {
        char[] buf = new char[1024];

        int r = 0;

        while ((r = reader.read(buf)) != -1) {
            result.append(buf, 0, r);
        }
    }
    finally {
        reader.close();
    }

    return result.toString();
} 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2011-10-23T07:43:29.137

这个用的方法`RandomAccessFile.readFully`，好像从JDK 1.0就可以了！

```
public static String readFileContent(String filename, Charset charset) throws IOException {
    RandomAccessFile raf = null;
    try {
        raf = new RandomAccessFile(filename, "r");
        byte[] buffer = new byte[(int)raf.length()];
        raf.readFully(buffer);
        return new String(buffer, charset);
    } finally {
        closeStream(raf);
    }
} 

private static void closeStream(Closeable c) {
    if (c != null) {
        try {
            c.close();
        } catch (IOException ex) {
            // do nothing
        }
    }
} 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2013-03-15T09:09:56.443

请注意，使用`fileInputStream.available()`返回的整数时不必表示实际文件大小，而是系统应该能够在不阻塞 IO 的情况下从流中读取的猜测字节数。一种安全简单的方法可能如下所示

```
public String readStringFromInputStream(FileInputStream fileInputStream) {
    StringBuffer stringBuffer = new StringBuffer();
    try {
        byte[] buffer;
        while (fileInputStream.available() > 0) {
            buffer = new byte[fileInputStream.available()];
            fileInputStream.read(buffer);
            stringBuffer.append(new String(buffer, "ISO-8859-1"));
        }
    } catch (FileNotFoundException e) {
    } catch (IOException e) { }
    return stringBuffer.toString();
} 
```

需要考虑的是，这种方式**不适**用于 UTF-8 这样的多字节字符编码。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2017-02-07T06:10:25.647

可以试试 Scanner 和 File 类，几行解决

```
 try
{
  String content = new Scanner(new File("file.txt")).useDelimiter("\\Z").next();
  System.out.println(content);
}
catch(FileNotFoundException e)
{
  System.out.println("not found!");
} 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2018-04-01T13:34:54.697

根据@erickson 的回答，您可以使用：

```
public String readAll(String fileName) throws IOException {
    List<String> lines = Files.readAllLines(new File(fileName).toPath());
    return String.join("\n", lines.toArray(new String[lines.size()]));
} 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2018-10-26T06:38:33.117

用户`java.nio.Files`读取文件的所有行。

```
public String readFile() throws IOException {
        File fileToRead = new File("file path");
        List<String> fileLines = Files.readAllLines(fileToRead.toPath());
        return StringUtils.join(fileLines, StringUtils.EMPTY);
} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2013-12-13T09:33:32.890

我还不能评论其他条目，所以我就把它留在这里。

这里的最佳答案之一（[https://stackoverflow.com/a/326448/1521167](https://stackoverflow.com/a/326448/1521167)）：

```
private String readFile(String pathname) throws IOException {

File file = new File(pathname);
StringBuilder fileContents = new StringBuilder((int)file.length());
Scanner scanner = new Scanner(file);
String lineSeparator = System.getProperty("line.separator");

try {
    while(scanner.hasNextLine()) {        
        fileContents.append(scanner.nextLine() + lineSeparator);
    }
    return fileContents.toString();
} finally {
    scanner.close();
}
} 
```

仍然有一个缺陷。它总是将换行符放在字符串的末尾，这可能会导致一些奇怪的错误。我的建议是将其更改为：

```
 private String readFile(String pathname) throws IOException {
    File file = new File(pathname);
    StringBuilder fileContents = new StringBuilder((int) file.length());
    Scanner scanner = new Scanner(new BufferedReader(new FileReader(file)));
    String lineSeparator = System.getProperty("line.separator");

    try {
        if (scanner.hasNextLine()) {
            fileContents.append(scanner.nextLine());
        }
        while (scanner.hasNextLine()) {
            fileContents.append(lineSeparator + scanner.nextLine());
        }
        return fileContents.toString();
    } finally {
        scanner.close();
    }
} 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2015-11-29T14:09:52.750

在 Scanner 之后 Ctrl+F'ing 后，我认为 Scanner 解决方案也应该列出。在最容易阅读的时尚中，它是这样的：

```
public String fileToString(File file, Charset charset) {
  Scanner fileReader = new Scanner(file, charset);
  fileReader.useDelimiter("\\Z"); // \Z means EOF.
  String out = fileReader.next();
  fileReader.close();
  return out;
} 
```

如果您使用 Java 7 或更新版本（并且您确实应该）考虑使用 try-with-resources 以使代码更易于阅读。没有更多的点关闭的东西乱扔所有东西。但这主要是我认为的风格选择。

我发布这个主要是为了完成主义，因为如果你需要做很多事情，[java.nio.file.Files](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html)中应该有一些东西应该可以更好地完成这项工作。

我的建议是使用[Files#readAllBytes(Path)](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes%28java.nio.file.Path%29)来获取所有字节，并将其提供给 new [String(byte[] Charset)](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html)以从中获取您可以信任的字符串。字符集在你的一生中对你来说很重要，所以现在要小心这些东西。

其他人提供了代码和东西，我不想窃取他们的荣耀。;)

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2016-12-10T15:55:40.430

使用[这个库](https://github.com/mirraj2/Ox)，它是一行：

```
String data = IO.from(new File("data.txt")).toString(); 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2017-02-15T21:15:44.533

此外，如果您的文件恰好在 jar 中，您也可以使用以下命令：

```
public String fromFileInJar(String path) {
    try ( Scanner scanner 
            = new Scanner(getClass().getResourceAsStream(path))) {
        return scanner.useDelimiter("\\A").next();
    }
} 
```

`/` 例如，如果您的 jar是

```
my.jar/com/some/thing/a.txt 
```

然后你想像这样调用它：

```
String myTxt = fromFileInJar("/com/com/thing/a.txt"); 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2017-03-15T02:39:05.237

在一行（Java 8）中，假设您有一个阅读器：

```
String sMessage = String.join("\n", reader.lines().collect(Collectors.toList())); 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-01-16T06:53:39.120

使用代码：

```
File file = new File("input.txt");
BufferedInputStream bin = new BufferedInputStream(new FileInputStream(
                file));
byte[] buffer = new byte[(int) file.length()];
bin.read(buffer);
String fileStr = new String(buffer); 
```

fileStr 包含字符串中的输出。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2022-02-04T18:39:10.757

```
Scanner sc = new Scanner(new File("yourFile.txt"));
sc.useDelimiter("\\Z");

String s = sc.next(); 
```

* * *

## 回答 #33

> 赞同：-2
> 
> 时间：2016-12-06T12:00:40.777

在 java 8 中，有一个新的类

> java.util.stream.Stream

流表示一系列元素并支持不同类型的操作以对这些元素执行计算

阅读更多相关信息：

[甲骨文文档](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html)

这里有一个例子：

```
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.stream.Stream;

public Class ReadFile{
  public  static String readFile(String filePath) {
 StringBuilder  stringBuilder = new StringBuilder();
    String ls = System.getProperty("line.separator");
        try {

            try (Stream<String> lines = Files.lines(Paths.get(filePath), StandardCharsets.UTF_8)) {
                for (String line : (Iterable<String>) lines::iterator) {

                      stringBuilder.append(line);
                      stringBuilder.append(ls);

                }
            }

        } catch (Exception e) {
            e.printStackTrace();
        }

      return stringBuilder.toString(); 

}

} 
```

# sql-server - 多位数据库字段

> ID：326392
> 
> 赞同：2
> 
> 时间：2008-11-28T18:33:04.957
> 
> 标签：sql-server, database, field

我正在使用 MSSQL 数据库并想创建一个只有 4 个可能值的列。有没有办法定义一个 2 位列？我看到了 bit 数据类型，然后下一个最小的是 tinyint，它是 1 个完整字节。

如果没有这样的领域，我会很乐意找出原因。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T18:36:06.993

您对字段大小有什么顾虑？实现字段域的方法应该是使用外键约束（MSSQL 应该有）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T18:52:10.550

我看不出这样一个领域的原因。

它绝对不能是空间——今天很便宜，除非你有很多行，否则 6 位的经济性真的可以忽略不计。但在那种情况下，无论如何它都会占用很多空间，而且每行额外的 6 位也几乎没有什么区别。

速度也不是正当理由。这样的位字段需要额外的操作来存储和检索，使得整个过程比简单地处理整个字节要慢得多。

最后，如果它是关于约束的，那么您应该使用外键或用户定义的类型（尽管这需要在 .NET 中进行额外的编码）。虽然我只是使用一个字节并在我的应用程序中实现约束。也许不是那么好，但要容易得多。

**更新：**虽然，是的，“枚举”约束在 MSSQL 中会很有用。但这又与简单的 2 位字段有点不同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T18:44:53.420

所以你是说我应该只有一个包含我的四个值的另一个表的外键？

我对此没有严重的担忧。我只是看不到给只需要 2 位的东西一个完整字节的意义。我对可变位长字段不存在的原因更加好奇。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T18:47:54.257

我同意这点。

我将创建一个包含四个可能值的查找表，然后通过外键链接到它们。

至于数据类型，smallint 和你想得到的一样小，SQL Server 的设计并不是为了保存单个数据位并对其进行操作，但它可以通过二进制列中的位运算符来完成，但即使是最小的其中在磁盘上要大得多。SQL Server Bit 列也很不寻常，因为它有 3 个潜在值（1、0 和 null）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T19:49:13.243

不重复其他先生所说的，如果你仍然想这样做，没有直接的方法......但是你可以使用两个Bit列，

然后添加一个计算列，该列生成与 2 位列的值相对应的值 (0-3)....

```
CREATE TABLE [dbo].[testTable](
    [colA] [bit] NOT NULL,
    [colB] [bit] NOT NULL,
    [CalcCol]  AS (case [colA] when (1) then (2) else (0) end+[colB])
) ON [PRIMARY] 
```

如果您需要一组不同的四个值，那么 0-3 只需将它们放入计算公式中：

```
CREATE TABLE [dbo].[testTable](
    [colA] [bit] NOT NULL,
    [colB] [bit] NOT NULL,
    [CalcCol]  As 
         (Case ColA 
             When 0 Then Case ColB WHen 0 Then ValueA Else ValueB End
                    Else Case ColB WHen 0 Then ValueC Else ValueD End
             End)
) ON [PRIMARY] 
```

唯一的问题是计算列不是直接“可写”的 - 你必须在单独的代码中写入各个位字段......比如

```
Update TestTable Set 
  colA = Case When Value In (ValueA, ValueB) Then 0 Else 1 End, 
  colB = Case When Value In (ValueA, ValueC) Then 0 Else 1 End 
Where ... 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-28T20:00:52.143

除非您的数据库存储在软盘上，否则我不会出汗。在这里听取其他人的建议，然后继续构建数据库的其余部分。

# jsf - JSF h：列标签固定宽度

> ID：326393
> 
> 赞同：10
> 
> 时间：2008-11-28T18:33:23.007
> 
> 标签：jsf

有人可以告诉我如何使用 JSF 修复数据表中列的宽度吗？

我的代码目前为：

```
<h:column>
    <f:facet name="header">
        <h:outputText value="Data Field 1" />
    </f:facet>
    <h:commandLink id="dataLink" action="#{pc_SearchResultsFragment.setField1}">
        <h:outputText value="#{(qi.data1 != null) ? '' : qi.data1}"/>                 
    </h:commandLink>
</h:column> 
```

谢谢！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-29T16:09:52.467

通常你在 dataTable 上下文中使用 h:column 。

您可以做的是在 CSS 中设置宽度。如果你有代码：

```
<h:dataTable value="#{action.items}" var="name" 
styleClass="tableClass" columnClasses="first,second"> 
```

在 CSS 文件中，您执行以下操作：

```
.first {

   width: 250px;

} 
```

那是假设你有 2 列。

[在此处](http://java.sun.com/javaee/javaserverfaces/1.2/docs/tlddocs/h/dataTable.html)查看 dataTable 属性，您还可以在此处找到各种 CSS 相关属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-04T10:38:24.923

我遇到了这个问题，我可以通过使用 h:datatable 的 columnclasses 属性来解决它。请参考标签库。

[JSF 数据表](http://download.oracle.com/javaee/5/javaserverfaces/1.2/docs/tlddocs/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-09-19T14:22:38.833

如果您使用的是 JSF 2.2，则可以通过使用其[传递](https://docs.oracle.com/javaee/7/tutorial/jsf-facelets009.htm)功能来解决此问题，并使用它将`style`属性从服务器端 XHTML 传递到客户端 html

像这样：

```
<h:column pt:style="width:20px;text-align:center;"></h:column> 
```

解决了这个问题：

```
<td style="width:20px;text-align:center;"></td> 
```

不要忘记同时添加`xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"`和使用所有其他 jsf 命名空间

* * *

## 回答 #4

> 赞同：-6
> 
> 时间：2008-11-28T20:16:53.453

```
<h:column>
    <f:facet name="header">
        <h:outputText value="Data Field 1" />
    </f:facet>
    <h:commandLink id="dataLink" action="#{pc_SearchResultsFragment.setField1}">
        <h:outputText value="#{(qi.data1 != null) ? '' : qi.data1}"/>                     
    </h:commandLink>
    <%-- <f:attribute name="width" value="20" /> fixed width --%>
    <%-- or --%>
    <%-- <f:attribute name="width" value="20%" /> percentage --%>

    <%-- also available (not a complete list, just some of the more
         common supported attributes) --%>
    <%-- <f:attribute name="align" value="left" /> --%>
    <%-- <f:attribute name="height" value="20" /> --%>
    <%-- <f:attribute name="nowrap" value="true" /> --%>
    <%-- <f:attribute name="valign" value="top" /> --%>
    <%-- <f:attribute name="bgcolor" value="red" /> --%>
    <%-- <f:attribute name="style" value="color:White;" /> --%>
</h:column> 
```

# css - :hover元素

> ID：326396
> 
> 赞同：6
> 
> 时间：2008-11-28T18:34:29.150
> 
> 标签：css, image, hover, rollover

我正在与：

```
#top ul li.corner span.right-corner:hover
{
    background-image:url("images/corner-right-over.gif");
    width:4px;
    height:15px;
    float:left;
}

#top ul li.corner span.left-corner:hover
{
    background-image:url("images/corner-left-over.gif");
    float:left;
    width:4px;
    height:15px;
} 
```

而且我似乎无法`:hover`正常工作？不知道为什么，有人有什么建议吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-28T19:41:11.123

我认为问题在于 SPAN 元素默认显示为内联 - 这意味着它们没有高度和宽度。尝试通过添加显式地使它们成为块级元素：

```
#top ul li.corner span.right-corner, #top ul li.corner span.left-corner
{
    display: block;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-09-19T13:40:48.870

写`<!DOCTYPE html>`在 HTML 文档的第一行。应该为所有类型的元素启用悬停支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T18:45:48.817

正如评论者所指出的，“top”不是有效的选择器。它应该是“#top”或“.top”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T18:51:14.063

你是在IE中测试吗？IE7及以下仅支持`:hover`（`<a>`不确定IE8）

# php - 垃圾邮件检测服务的最佳语言选择

> ID：326401
> 
> 赞同：1
> 
> 时间：2008-11-28T18:37:52.047
> 
> 标签：php, python, mysql, ruby, spam-prevention

我有大约 20 个左右活跃的博客，它们会收到相当多的垃圾邮件。因为我讨厌 CAPCHA，所以另一种选择是非常智能的垃圾邮件过滤。我想构建一个简单的 REST api，比如垃圾邮件检查服务，我会在我的所有博客中使用它。通过这种方式，我可以整合 IP 块并将垃圾邮件检测卸载到[Akisment](http://akisment.com "启蒙")、[Mollom](http://mollom.com/ "莫洛姆")、[Defensio](http://defensio.com/ "防守")等 3rd 方，并在未来的某个时候编写我自己的垃圾邮件检测，以便真正深入了解一些非常有趣的垃圾邮件检测算法。

我选择的语言是 PHP，我认为自己非常精通，我真的可以深入挖掘并提出解决方案。我觉得这个项目可以作为学习另一种语言的一个很好的练习。想到的最大的 2 是 Python 和 Ruby on Rails，因为每个人都在谈论它们，就像我们救世主的下一个到来一样。由于这主要是一个 API 并且没有任何管理员或公众面向任何东西，看起来运行一个简单的 http 服务器的基本 Python 似乎是要走的路。我错过了什么吗？伟大的社区，你会推荐什么？我很想听听您的语言、书籍和最佳实践建议。

这必须扩展，我想在写它时考虑到这一点。现在我可能可以使用 3rd 方的免费计划，但很快我就必须扩展整个事情以真正独立思考。现在我想我会把所有东西都存储在一个 MySQL 数据库中，直到我可以对它进行一些真正的分析。谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-28T19:07:23.483

我的第一个问题 -**你为什么不只使用你列出的这三种服务之一？**他们似乎完全按照您的意愿行事。抱歉我玩世不恭，但我怀疑你独自工作能否在合理的时间内击败设计这些网站使用的算法的软件工程师，特别是考虑到他们的收入来源取决于他们做得有多好。

再说一次，你可能只是比他们聪明=P。我不是一个可以判断的人。无论如何，出于您所说的原因，我推荐**python** ——您不需要花哨的公共接口，因此 python 在这方面缺乏卓越并不重要。Python 也很适合进行文本处理，它有很好的内置绑定来使用数据库（例如 sqlite；当然，如果你觉得有必要，你可以安装 MySQL）。

缺点：它可能会有点慢，这取决于你的算法有多复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T20:00:30.380

Python有一些优势。

1.  Python 中有几个 HTTP 服务器框架。查看[WSGI 参考实现](http://www.python.org/doc/2.5.2/lib/module-wsgiref.html)，了解如何使用 WSGI 标准来处理 Web 请求。它非常干净且可扩展。需要花一点时间研究一下，WSGI 就是为请求添加详细信息，直到您到达处理的某个阶段，该阶段是时候制定回复了。

2.  [MIME 电子邮件解析](http://www.python.org/doc/2.5.2/lib/module-email.html)非常简单。

3.  之后，您将使用站点黑名单和内容过滤来检测垃圾邮件。

    *   站点黑名单可以是一个大而奇特的 RDBMS。或者它可以是简单的腌制 Python 域名和 IP 地址集。我推荐一个简单的pickle set对象，它存在于内存中。它很快。您可以让您的 RESTful 服务在收到一些强制刷新的 GET 请求时从源文件重新加载此集合。

    *   文本过滤很难。我将从[SpamBayes](http://spambayes.sourceforge.net/)开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T20:15:35.030

我谦虚地推荐[Lua](http://www.lua.org)，不仅因为它是一种出色、快速的语言，已经与 Web 服务器集成，还因为您可以利用[OSBF-Lua](http://osbf-lua.luaforge.net/)，这是一种现有的垃圾邮件过滤器，已经连续几年赢得垃圾邮件过滤比赛。Fidelis Assis 和我做了大量工作，试图将模型推广到电子邮件之外，我们很高兴与您合作将其与您的应用程序集成，这正是 Lua 的设计目的。

至于扩展，在训练模式下，我们在 2006 年的机器上每秒处理数百封电子邮件，因此即使对于繁忙的网站也应该可以很好地工作。

我们需要与您合作对没有邮件标题的内容进行分类，但我已经在朝着这个方向努力了。欲了解更多信息，请写信 nr@cs.tufts.edu。（是的，我*希望*人们向我发送垃圾邮件。这是为了研究！）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T02:50:48.273

我不得不推荐 Akismet，因为它易于使用且精度高。仅使用 WordPress.com API 密钥和 API 调用，您就可以确定来自用户的给定文本块是否为垃圾邮件。我一直在使用用于 WordPress 的 Akismet 插件，它使用相同的 API，并且在过去一年左右的时间里取得了出色的成果。

Zend Framework 有一个很棒的 Akismet PHP 类，您可以独立于框架的其余部分使用，这应该使集成非常简单。文档也非常详尽。

# delphi - 我应该对实际上是接口的基类的析构函数使用“虚拟”关键字吗？

> ID：326405
> 
> 赞同：0
> 
> 时间：2008-11-28T18:40:48.827
> 
> 标签：delphi, oop, inheritance

我有一个抽象基类和派生类：

```
type TInterfaceMethod = class
  public
    destructor Destroy; virtual; abstract;
    procedure Calculate; virtual; abstract;
    procedure PrepareForWork; virtual; abstract;
end;
type ConcreteMethod = class(TInterfaceMethod)
  private
    matrix: TMinMatrix;
  public
    constructor Create(var matr: TMinMatrix);
    procedure Calculate; override;
    procedure PrepareForWork; override;
    destructor Destroy;
end; 
```

我是否真的需要像在 C++ 中那样使基类析构函数成为虚拟的，或者如果它不是虚拟的就可以了？
顺便说一句，我是正确使用“覆盖”还是需要“重载”？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T19:03:29.980

覆盖是正确的 - 您正在重新定义虚拟方法。

如果你真的希望 TInterfaceMethod 的析构函数抛出 EAbstractError，你必须将它标记为 'override; 抽象的;'。（我很惊讶它可以工作，但我用 D2007 进行了测试，它确实可以。）但是你为什么要这样做呢？

顺便说一句，不需要为每个声明使用单独的“类型”块。您可以将代码格式化为：

```
type
  TInterfaceMethod = class abstract
  public
    destructor Destroy; override; abstract;
    procedure Calculate; virtual; abstract;
    procedure PrepareForWork; virtual; abstract;
  end;

  TConcreteMethod = class(TInterfaceMethod)
  private
    matrix: TMinMatrix;
  public
    constructor Create(var matr: TMinMatrix);
    procedure Calculate; override;
    procedure PrepareForWork; override;
    destructor Destroy; override;
  end; 
```

另外，您很可能应该使用接口而不是抽象基类。并且您应该如上所述标记 TInterfaceMethod 类“抽象”。理论上，这会阻止您直接创建 TInterfaceMethod 对象。（实际上，我的 D2007 允许这样做 - 很奇怪。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T21:26:36.883

只是挑剔;-)。

虚拟析构函数 destroy 已经存在（并且被 Free 使用）。所以如果你声明一个这样的类，你会遇到一些问题。

但总结一些方法指令：

*   virtual 用于定义虚拟方法（使用运行时绑定）。
*   override 用于定义覆盖虚拟方法的方法。
*   abstract 与 virtual（或覆盖！）一起使用来定义没有实现的方法。它必须在子类中被覆盖，否则它不能被调用。
*   final 与 virtual 或 override 一起使用来定义一个不能被覆盖的方法。
*   如果您想重新引入已经在子类中的方法而不覆盖它，则使用 reintroduce。它会抑制您收到的警告。并负责隐藏不需要的方法。

# fpga - 处理 FPGA 设备要求的最佳方法

> ID：326419
> 
> 赞同：3
> 
> 时间：2008-11-28T18:47:38.687
> 
> 标签：fpga

在设计 FPGA 系统时，如何粗略估计给定任务所需的逻辑块数量？

任何人都对我对这些常见设备的期望有一个粗略的数量级吗？：

*   UART
*   具有 CRC32 的数据包解帧器
*   8个微核心

我看过 www.opencores.org，但是，他们并没有为每个项目提供多个门的大小。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-24T06:49:59.287

我建议您访问 Opencores.org，找到与您的设计相似的设计并进行综合。我会说这是估计逻辑利用率的最准确方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T18:53:11.267

整个 Amiga 可以容纳 400k 门，不包括 CPU。请参阅 Minimig 项目，它是开源的，应该包含一些有用的参考文件。还有一个 FPGA 68k 内核可以在线查看，由 tobiflex 编写。还可以查看 Commodore One 机器和 C64/CPC 内核（Z80、6845、SID、6502 等）以了解它们的比较情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T16:24:26.383

UART：3200 个门。8 位 uC：10k 门。检查[http://www.design-reuse.com/](http://www.design-reuse.com/%22design-reuse%22)以获取其他信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T08:53:38.560

我会避免使用 FPGA 进行门计数，这里有一些 4 输入查找表估计值（我的大部分经验是使用 Xilinx，但对于 Altera 和其他人来说也是类似的）：

一个原始的 UART 是几十个 LUT/FF - 如果它有一个到 micro 的总线接口，那么它会更多（可能仍然小于 100），如果它有 16550 样式的 FIFO，那么甚至更多（可能还有一些 ram 块以及）。8 位微 - 在 Xilinx 中，请参阅 Picoblaze（113 个切片 - 每个切片是两个 LUT 和两个 FF，但并非所有切片都用于每个切片）

数据包解帧器 - 不知道 - 取决于帧器规范抱歉:)

# oracle - Oracle DB 查询格式化

> ID：326425
> 
> 赞同：3
> 
> 时间：2008-11-28T18:48:58.327
> 
> 标签：oracle, select, concatenation

在对 Oracle 数据库进行查询时，我在格式化数据时遇到问题。

我想要做的是将一些数据以下面的格式导出到文本文件中；

```
 1IN20071001      40005601054910101200            1   65 
```

*   第一个数字（上面的 1）= 公司编号（位置 1-5，前面的空白）
*   IN 或 UT = IN 用于时钟输入，UT 用于时钟输出（位置 6-7）
*   20071001 = 日期（营业日期），格式为 YYYYMMDD（位置 8-15）
*   400056010549 = EmployeeID（位置 16-33，右对齐，前面有空格）
*   101012 = TTMMSS 格式的时间（位置 34-39）
*   00 = FT，始终为 00（位置 40-41）
*   空白 = 总是 8 个空格（位置 42-49）
*   1 = 不确定它的用途，但它应该始终为 1（位置 50，右对齐，前面有空格）
*   65 = “Kostnadsställe”，ENT_HR_EMPLOYEE.USERALPHA6（位置 51-55，右对齐，前面有空白）

目前我正在使用下面的查询，但这是我的 SQL 知识结束的地方......

```
COLUMN one FORMAT a5 HEADER  JUSTIFY RIGHT 
COLUMN two FORMAT a8 HEADER two 
COLUMN three FORMAT a18 HEADER three JUSTIFY RIGHT
COLUMN four FORMAT a5 HEADER three JUSTIFY RIGHT

SELECT h.fkod AS one, 'IN',
    SUBSTR(t.clockindatetime,0,4) ||
    SUBSTR(t.clockindatetime,6,2) ||
    SUBSTR(t.clockindatetime,9,2) AS two,
    i.employeeid AS three
    SUBSTR(t.clockindatetime,11,6) || '00        1',  
    h.fkod AS four
FROM ent_time_card_detail t,
    max_employeeid_history i,
    ent_hr_employee h
WHERE h.enthremployeeid = t.enthremployeeid
AND h.payrollid = i.userid
AND t.clockindatetime >= i.from_date
AND (t.clockindatetime < i.to_date OR i.to_date IS NULL); 
```

有任何 SQL-pro 可以帮助我完成格式化吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T19:05:09.167

如果 t.clockindatetime 是 oracle DATE 那么为什么不使用：
`TO_CHAR(t.clockindatetime, 'YYYYMMDD')`日期部分和 `TO_CHAR(t.clockindatetime, 'HHMISS')`时间部分（如果您希望小时数采用 24 小时格式，请使用`TO_CHAR(t.clockindatetime, 'HH24MISS')`（小时数仍然只占用 2 个字符））

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T19:09:09.940

你也可以使用[rpad 和 lpad](http://www.adp-gmbh.ch/ora/sql/rpad.html)来填充你的输出和截断额外的字符

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T21:58:56.727

超级甜，你们拯救了我的周末！:)

询问：

```
SELECT lpad('1',5) || 'IN' ||
    TO_CHAR(t.clockindatetime, 'YYYYMMDD') ||
    lpad(i.employeeid,18) ||
    TO_CHAR(t.clockindatetime, 'HH24MISS') ||
    '00        1' ||
    lpad('h.useralpha6',5)
FROM ent_time_card_detail t,
    max_employeeid_history i,
    ent_hr_employee h
WHERE h.enthremployeeid = t.enthremployeeid
AND h.payrollid = i.userid
AND t.clockindatetime >= i.from_date
AND (t.clockindatetime < i.to_date OR i.to_date IS NULL); 
```

结果：

```
 1IN20081106          1234123412101500        1   64                                                                                     
    1IN20081106              234512385100        1   64                                                                                     
    1IN20081107              234515261900        1   64 
```

我仍然需要弄清楚 time_card_detail 或 hr_employee 表是如何与我用于第 1 列的“公司编号”相关的，以及如何锁定 timecardpost 以进行篡改，但这可以等到星期一。

非常感谢！/ 彼得

# version-control - 对于玩具项目，哪种版本控制系统最容易设置和使用？

> ID：326429
> 
> 赞同：68
> 
> 时间：2008-11-28T18:52:25.447
> 
> 标签：version-control, darcs

我在 CS 系教授第三门必修的入门课程。我的一项家庭作业要求学生加快他们为之前的作业编写的代码。十倍的加速是常规的；100 或 1000 的因数并非闻所未闻。（对于 1000 倍的加速，你必须在 malloc() 中犯过新手错误。）

程序由一个序列改进是小的变化。我要求学生记录和描述每一个变化和由此产生的改进。

当你在改进一个程序时，也有可能破坏它。退出不是很好吗？

您可以看到我的意图：我的学生将从版本控制中受益匪浅。但有一些警告：

*   我们的计算环境被锁定。任何依赖于中央存储库的东西都是可疑的。
*   我们的学生超负荷工作。不仅是课程，还有工作、运动、音乐，应有尽有。对于他们来说，使用新工具必须非常简单并且有明显的好处。
*   我们的学生大部分工作都是成对完成的。在帐户之间来回获取位是有问题的。分布式版本控制也能解决这个问题吗？
*   复杂性是敌人。我知道建立一个 CVS 存储库太令人费解了——我自己仍然有麻烦，因为我每年只做一次。我听说SVN更难。

以下是我对现有系统的评论：

*   我认为中央版本控制（CVS 或 SVN）被排除在外，因为我们的学生没有创建可以与其他学生共享的存储库所需的管理权限。（我们被 Unix 文件权限困住了。）另外，在 CVS 或 SVN 上的设置太难了。
*   darcs 很容易设置，但你如何分享东西并不明显。darcs send（通过电子邮件发送补丁）似乎很有希望，但不清楚如何设置它。
*   git 的介绍性文档不适合初学者。就像 CVS 设置一样，我自己也遇到了麻烦。

我正在征求有关初学者使用什么源代码控制的建议。我怀疑我们可以找到资源来在现有系统上加上一层薄薄的外衣并简化现有文档。我们可能没有资源来编写新文档。

那么，什么是真正易于**设置**、**提交**、**恢复**和**与合作伙伴共享更改，**但不一定要易于合并或大规模工作？

一个关键的限制是**编程配对必须能够彼此共享工作并且只能彼此共享**，并且**配对每周都在变化**。我们的基础架构是带有 netapp 文件管理器的 Linux、Solaris 和 Windows。我怀疑我的 IT 员工想要为每对学生创建一个 Unix 小组。有没有我忽略的更简单的解决方案？

（感谢接受的答案，由于它对[Git Magic](http://www-cs-students.stanford.edu/~blynn/gitmagic/)的出色参考以及有用的评论而击败了其他人。）

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-11-28T19:11:11.167

我想说像 Git 这样的东西可能适合这个法案：

*   由于它是一个分布式系统，您不需要有一个中央存储库，存储库与源目录一起存在
*   创建可以邮寄和应用的补丁文件很容易。
*   尽管 git 看起来很难使用，但提交、合并、添加和删除文件的基本思想并不难学。

看看这个网站[Git Magic](http://www-cs-students.stanford.edu/~blynn/gitmagic/ch01.html) 或者，甚至这个技巧网站[GitReady](http://gitready.com/)

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-11-28T20:40:44.497

二、[Mercurial的选择](https://www.mercurial-scm.org/wiki/)

好处

*   优秀的文档。
*   显示分支的图形视图命令。
*   跨平台。
*   带有适用于所有平台（TortoiseHG 或 thg）的 GUI。
*   用于查看项目的内置 Web 服务器。
*   可以将您的项目保存在您的拇指驱动器上。
    *   即使这对中只有一个成员记得他们的笔记本电脑，也可以节省工作。并不是说那会发生。

缺点

*   如果尚未安装 Python，则必须安装。
    *   很容易做到，但这是另一个步骤。
*   了解推/拉与更新/提交之间的区别。
    *   （这对所有分布式 VCS 都是通用的）。
*   头和尖的区别。
*   有些命令不能立即使用；必须明确启用它们。
    *   （这通常被社区认为是有利的，因为它使事情变得简单；但其他一些人不同意）。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-28T18:57:54.907

Subversion 易于安装，适用于 windows、linux 和 mac os x。我不知道他们正在编写什么程序，但是 Eclipse 的 subclipse 插件相当容易安装，并且隐藏了一些存储库的复杂性。

和存储库复杂性？无论如何，这只是在每个项目中都有一个主干、标签和分支文件夹。他们可能没有太多时间，但他们应该有时间学习 SVN（或类似的），因为这是一项在他们的简历上看起来不错的技能。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-10-20T10:09:32.350

我建议查看[Fossil](http://fossil-scm.org/) - 它是一个没有依赖关系的单一可执行文件，通过 HTTP 操作所有流量，将其所有存储库数据保存在一个可以命名的文件中，并包括版本控制的 wiki、错误跟踪和网络-服务器开箱即用。哦，它是完全分布式的。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-28T20:13:37.157

我会推荐[Mercurial](http://www.selenic.com/mercurial/wiki/)（也称为“hg”）。它是一个分布式开源 VCS，不需要中央存储库。日常使用它很容易。官方网站上有足够的文档。例如查看[QuickStart](http://www.selenic.com/mercurial/wiki/index.cgi/QuickStart)。

对我来说，决定点是一个很棒的 Windows 图形用户界面 - [TortoiseHg](http://tortoisehg.sourceforge.net/)。Linux 上似乎也支持它（我自己没试过）。当然，大多数 Linux 版本都有命令行发行版。

当然，从这方面来看似乎很容易，也许对于忙碌的学生来说，概念、优势和日常操作不会那么容易习惯。但最终，即时提交、恢复到任何版本并自动从那里创建新分支的能力以及智能 diff/merge 都是不可替代的。

希望这可以帮助！

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-28T19:31:31.640

为了让您的学生真正易于使用，您可以安装一个开启自动提交功能的 SVN 服务器，并使用 webdav 共享。这样他们就可以使用 WebDAV 挂载他们的目录，并且每次点击保存时都会自动提交 - 使用 TortoiseSVN、Eclipse / Visual Studio 插件或一些 Web 访问解决方案（如 ViewVC）可以轻松访问历史记录。对于您的访问限制需求，您可以使用集成的颠覆身份验证（看[这里](http://svnbook.red-bean.com/nightly/en/svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.auth)） - 它使用简单的配置文件进行细粒度的访问控制。

配置变得容易多了（现在有更好的文档 - 看看[SVN Book](http://svnbook.red-bean.com/)），但如果您需要多个具有访问限制和 Web 界面的单独存储库，可能会变得有点复杂。

对于不知道计算机内部发生了什么的“我的办公室工作人员/老板”来说，自动提交更多的是一种解决方案，需要对 Word 文档进行版本控制。学习编程课程的学生也许还应该学习如何使用像样的 SCM。

Git 和 Mercurial 会很好，因为它们是分布式的，这使得共享变得容易 - 但是这两种工具都缺乏真正易于使用的 GUI 界面（TortoiseHg 看起来很有前途，而且 gitk 是一个非常好的存储库浏览器，但你的学生仍然需要将他们的头脑围绕在命令行工具上以充分利用这些工具）。此外，分布式 SCM 的概念更难掌握。

在专业方面，您可以使用[GitHub](https://github.com/)等公共托管解决方案，而不必担心服务器设置。这也使共享解决方案变得非常容易，但会打破您“仅彼此”的要求。但我想你无论如何都无法阻止他们交换代码，根据我的课程工作经验，我发现查看代码并验证它的唯一性是防止复制的唯一方法。

您还可以使用[PlasticSCM](http://www.codicesoftware.com)，它为许多 IDE 提供了非常好的接口，并且（至少该网站声称）为教育机构提供免费许可证。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-11-28T19:20:37.497

我认为没有理由设置源代码控制系统。查看使用例如[谷歌代码](http://www.google.com/accounts/TOS)的条款并深入研究。

我和一个 CS 同学去年用过它，效果很好，唯一的先决条件是互联网连接 :-)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-11-29T03:51:43.363

[Bazaar](http://bazaar-vcs.org/)、[Mercurial](http://www.selenic.com/mercurial/wiki/)和[Git](http://git.or.cz/)听起来适合您的案例 - 创建存储库很简单，所有学生需要共享的是文件系统上对彼此存储库的读取访问权限。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2010-03-16T00:08:21.000

Darcs 是一款出色的 DVCS，尤其适用于小型项目，例如 CS 类项目。我希望我在大学时被介绍给 Darcs 或 Git，我也赞扬你把它介绍给你的学生。

我每天都使用 Git。这是一个非常强大的 DVCS，但对于较小的项目来说可能有点矫枉过正。

任你选，这些版本控制系统中的任何一个都非常好。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-02-24T16:04:14.357

**我在Bazaar**有过一些非常好的经验。与 Git/Mercurial 一样，它是分布式的。它是无服务器的——您不需要在托管存储库的服务器上安装守护程序，即使您正在远程访问它（即，它可以像 FTP/SFTP 共享一样工作）。

分布式 VCS 是最灵活的。您可以从更传统的“中央”存储库中签出一个分支，并获得能够将您自己的小开发独立于中央服务器等的所有好处，然后也许将您的更改推回。

虽然我没有尝试过，但还有其他 VCS 的导入工具，例如 Subversion。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-01-07T09:52:04.377

`darcs send`设置起来很简单——当你运行时`darcs send <remote repo>`，它会查看`_darcs/prefs/email`远程仓库来决定将电子邮件发送到哪里。如果那里什么都没有，那么它会提示用户。

补丁的接收者只是保存文件并`darcs apply <patch file>`在适当的 repo 中运行。

因此，每个学生都可以使用自己的电子邮件地址拥有自己的存储库，`_darcs/prefs/email`并通过电子邮件交换补丁。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-10-04T08:05:05.870

关于权限，外部服务不需要贵校 IT 人员的时间。

例如，[Bitbucket](http://bitbucket.org/)（使用 Mercurial）现在允许最多 5 个用户的无限私人回购。我猜每个新的每周一对学生都在一起做一个新项目，这意味着他们可以初始化存储库，添加另一个用户，然后他们就走了。

如果他们不是每周都在处理一个新项目，则必须删除和添加权限，我鼓励他们在 Bitbucket 上拥有多个存储库（每个帐户一个），以便每个学生都可以继续访问。（无论如何，这将是一个好主意，但对于仅为期一周的项目，让一个学生帐户拥有该存储库而另一个拥有许可可能更简单。）

关于哪个 VCS，我相信 Mercurial 最适合您的平台 - 如果新用户不熟悉（并且您没有时间让他们学习）命令行界面，TortoiseHg 特别适合他们探索。

具体到您的情况，DVCS 的优势是他们在大学服务器上的副本（如果有的话）是一个成熟的 repo。您可能会发现方便您或助教访问，这应该更易于设置并且可以持续整个学期，而不是每周更换一次。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-20T01:23:38.267

建立一个颠覆存储库是微不足道的；我经常为小型项目设置一个一次性的东西（例如为 Stack Overflow 上的答案开发代码！），我怀疑任何可以学习 SCM 系统的人都会遇到任何麻烦。

```
$ svnadmin create /home/cjs/repo
$ mkdir my-project
$ cd my-project
$ vi hello.c
  [...hack hack hack...]
$ svn import -m 'Initial project import.' file:///home/cjs/repo
Adding         hello.c

Committed revision 1. 
```

也就是说，共享当然是一个问题。如果学生们在同时工作的时候总是一起工作，他们可以使用 U 盘，因为他们可以在需要时将它拔下并来回传递，以后一个人编程的人可以挂着它。不过，这并不完全方便。

另一种选择，因为他们似乎都在共享的 Unix 系统上工作，是创建一个目录，为组的其余部分（或所有用户）设置执行但未读取位，并在该目录下为 repo 使用 s3cr3t 名称，只有两个学生知道。将这个秘密名称传递给教授也可以让他随时检查学生的存储库。（“所以你按时提交了作业，但电子邮件系统丢失了它？让我看看提交的时间......”）脚本可以帮助设置它。

事实上，我想得越多，我就越开始喜欢它。在某些方面，它比 git 解决方案更简单，因为学生不必处理传递补丁（或忘记这样做），并且学生将被迫在提交之前处理合并，而不是在事情完成后处理存储库（具有随后无限期延迟处理的能力）。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-11-18T05:33:39.600

更新：六年后，我再也不会考虑将颠覆用于任何事情。Git是要走的路。所以，虽然我仍然认为 SVN 有点“简单”，但它甚至不值得再教了。

我使用过 CVS、SVN、Bazaar 和 Git（按介绍顺序），我不得不对学生说 SVN 是要走的路。事实上，当我担任首席 TA 时，我们实施了 SVN 来替代旧的“提交脚本”，它是一个 tar 和电子邮件脚本。Labstaff 设置了一个基于 Apache SVN-DAV 的存储库，并使用 authz 文件，助教和讲师可以在非常细粒度的级别控制每个学生目录和组项目的权限，从而为学生提供非常简单的首次提交路径。看[我的教程](http://www.cs.utk.edu/~cs360/svn.html)（最近的助教撕掉的凭证..嗯..）

关于在没有系统管理员干预的情况下使用 subversion，我在一个小组项目设置中也这样做过，我的小组成员以前都没有使用过 subversion，而且他们中的大多数人都在提交时几乎没有混淆（除了一个） . 我还写了一个教程来设置这样一个安全的共享存储库，[这里](http://colin.mollenhour.com/2008/09/setup-an-svn-repo-on-a-school-server/)只有基本的 SSH 访问。

我绝对**不同意**git 对于初学者来说是最好的 VCS，因为在提到任何 VCS 系统时都经历了足够的空白，更不用说 mac-daddy-written-by-Linus-himself VCS 之王 git。git 并不比 svn 复杂，这根本不正确，仅缺乏成熟的*n00b*工具就足以成为在这种情况下不使用它的理由。我刚刚开始将 git 用于我在 Netbeans 中开发的一个新项目，并且已经遇到了与 Netbeans 集成的严重限制。在一个学期中，您不会使用 svn 不提供的任何功能，因此 git 是多余的。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-28T19:04:38.730

Windows 上的 Subversion 可以像设置 TortoiseSVN 一样简单。使用它有一些学习曲线（特别是如果您以前从未使用过版本控制），但您可以通过专门为它上半节课并提供一些幻灯片供他们下载来帮助这一点。

至于集中化——我听说过提供免费 SVN 项目托管的网站。一个快速的谷歌搜索出现了[这个](https://OpenSVN.csie.org/)页面，但肯定还有更多。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-11-28T19:36:17.077

如果您正在寻找真正易于设置的东西，那么为什么不选择免费的 SVN 托管选项，您无需设置任何东西！

可悲的是，每个人都会指出你是 Assembla 的两个老的，Unfuddle，已经放弃了对他们的免费托管的支持（或者至少如果你想让它们私有），但是你仍然可以使用[Origo](http://www.origo.ethz.ch/)这给你开放和封闭的托管.

这样做的好处是您可以拥有所有项目并全部关注它们，并且可以轻松控制有权访问的人，并且您不必担心创建repos的权限。

如果您确实走这条路，并且想要消除复杂性，那么您必须使用 GUI svn 应用程序来使学习变得微不足道（因为我怀疑会有很多合并发生）。我会推荐[tortoisesvn](http://tortoisesvn.tigris.org/)，直接滑入您的 Windows 资源管理器上下文菜单。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-28T19:01:01.110

我想说你最好的选择是尝试与你的 IT 部门合作，为你的学生建立一个系统/方法来轻松创建新的 SVN/CVS 存储库。

也许您可以让 IT 部门授予您为学生创建存储库所需的权限，即使他们不会将权限授予学生自己。在学期开始时，您可能很容易编写一些脚本来从学生列表中大规模创建存储库。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-11-28T14:23:49.310

用于 Linux 的 RCS。

我发现没有什么比 RCS for Widows 更简单的了，但并不是所有的 RCS 端口都能正常工作，所以你必须尝试它们，这使得它变得不简单。Windows 对开发人员来说并不简单。来自[http://www.cs.purdue.edu/homes/trinkle/RCS/](http://www.cs.purdue.edu/homes/trinkle/RCS/)的 Windows 端口非常好。

# user-interface - 向业务用户显示嵌套公式的最佳方式是什么？

> ID：326432
> 
> 赞同：1
> 
> 时间：2008-11-28T18:53:02.140
> 
> 标签：user-interface, user-controls, formula-editor

我们的许多交易都包含由其他计算组成的计算。你是如何向用户展示层次结构/执行图的？您是否发现某个特定的控件运行良好？

在进行更改之前，您将如何预测对其中一个公式的更改结果？一个建议是以不同的颜色显示更改后的公式。对于一个大的抵消公式，你会如何突出改变？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T19:01:27.053

我不必这样做，但我会做类似以下的事情：

使用树视图类型的控件。让每个内部计算都可以单独折叠。控件可以从折叠的所有内容开始，然后用户可以单击查看内部计算。（如果内部计算有名称，则将它们用作标签。如果没有，您可以使用计算中的前几个字符来表示它）。

我不确定你的最后一个问题是什么意思，但这会起作用吗？每次用户更改内部计算时，用红色标记受其影响的所有内容。这样一来，发生了什么变化，以及是否有任何意外的副作用，都将一目了然。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T20:36:50.463

业务用户知道电子表格是什么以及它们是如何工作的。我会考虑尝试将您的表达式建模为电子表格；某种规范转换为电子表格样式的视图，然后再返回。

使用电子表格，您可以使用单元格的颜色编码进行差异。

如果您可以使用一些数据（最好是实时数据）填充电子表格视图，那么它可以充当用于修改公式的测试/完整性检查工作台。

# delphi - 如何声明 TDictionary 枚举器？

> ID：326444
> 
> 赞同：4
> 
> 时间：2008-11-28T18:58:00.040
> 
> 标签：delphi, generics, dictionary, delphi-2009

我有一个 TDictionary 存储一堆按名称索引的对象，我希望能够检查所有对象。所以我尝试了这个：

```
var enumerator: TMyObject;
begin
   for enumerator in myDictionary do 
```

但这不会编译。“不兼容的类型：‘TMyObject’和‘TPair’

所以我尝试了一些不同的方法：

```
var enumerator: TPair<string, TMyObject>; 
```

那也没有编译。这个错误信息更奇怪：不兼容的类型：'TPair'和'TPair'

所以显然我需要某种时髦的语法来用**for .. in**循环枚举我的字典。有人知道如何正确申报吗？

编辑：Fabio Gomes 给出了一个可以正常工作的示例，但我的代码仍然无法使用他的方法进行编译。也许是因为我在不同的单位工作？字典和它用于 Value 端的类都定义在一个单元中，而这段代码在别处。这是否使它成为编译器中的错误？任何人都可以验证这一点吗？

编辑2：发现问题。 [http://qc.embarcadero.com/wc/qcmain.aspx?d=69461](http://qc.embarcadero.com/wc/qcmain.aspx?d=69461)如果有人感兴趣的话。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T19:53:27.417

这正如预期的那样工作：

```
var
  Enum: TPair<string, TForm>;
  MyDict: TDictionary<string, TForm>;
begin
  MyDict := TDictionary<string, TForm>.Create;
  try
    MyDict.Add('Form1', Self);
    for Enum in MyDict do
      ShowMessage(Enum.Key);
  finally
    MyDict.Free;
  end; 
```

将此代码粘贴到任何表单的 FormCreate 事件中，然后自己查看。

# linq - 使用实体框架进行单元测试

> ID：326450
> 
> 赞同：71
> 
> 时间：2008-11-28T19:01:08.177
> 
> 标签：linq, unit-testing, entity-framework

我想测试使用实体框架构建的实体。我担心的是使用实体框架意味着直接使用数据源。那么任何想法如何对基于实体框架的组件进行单元测试？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2010-06-09T09:30:55.227

For Enity Framework 4, this looks promising: [Testability and Entity Framework 4.0](http://msdn.microsoft.com/en-us/ff714955.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-28T22:28:55.730

显然这是非常困难的。Erik 在这里雄辩地提出 - [TDD 和 ADO.NET 实体框架](https://stackoverflow.com/questions/316897/tdd-and-adonet-entity-framework#answer-316972)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-10-22T16:35:57.307

A cheap approach is to set up a database file with the same structure as your real database and set the connection string in your unit test config to point to that. The database doesn't need to have all of the tables that the real one has; just the ones the unit test needs.

A disadvantage is that you need to manage the state of the database so that unit tests don't impact each other or themselves during and between runs.

I know this approach works when both the real and unit testing DBs use SQL Express but I don't know about stubbing in a SqlExpress DB for a full SQL DB.

I realize this is technically integration testing, but it could be cheaper than refactoring your code or learning a mocking framework.

Example real connection string:

```
<add name="DrinksEntities" 
     connectionString="metadata=res://*/Model.csdl|res://*/Model.ssdl|res://*/Model.msl;provider=System.Data.SqlClient
     ;provider connection string=&quot;Data Source=localhost\sqlexpress;Initial Catalog=Drinks2;Integrated Security=True;MultipleActiveResultSets=True;Application Name=EntityFramework&quot;" 
     providerName="System.Data.EntityClient" /> 
```

Example unit testing connection string:

```
<add name="DrinksEntities" 
     connectionString="metadata=res://*/Model.csdl|res://*/Model.ssdl|res://*/Model.msl;provider=System.Data.SqlClient
     ;provider connection string=&quot;Data Source=.\SQLEXPRESS;attachdbfilename=|DataDirectory|\Inventory.mdf;Integrated Security=True;user instance=True;MultipleActiveResultSets=True;Application Name=EntityFramework&quot;" 
     providerName="System.Data.EntityClient" /> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-01T01:56:12.487

您将希望使用模拟框架来检索模拟值，而不是访问真实数据。以下是一些模拟框架的列表和一些截屏视频的链接，可帮助您入门：

*   [犀牛模拟](http://ayende.com/projects/rhino-mocks.aspx)

*   [起订量](http://code.google.com/p/moq/)

以下是一些关于如何开始的截屏视频：

*   [Moq 简介](http://dimecasts.net/Casts/CastDetails/8)
*   [犀牛嘲笑视频](http://dimecasts.net/Casts/ByTag/Rhino%20Mocks)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-09-14T23:29:04.530

我想分享另一个意见。我还能够使用 TypeMock Isolator 测试基于实体框架的组件和应用程序。然而它是商业的。

看看这篇文章： [使用 TypeMock Isolator 介绍实体框架单元测试](http://mosesofegypt.net/post/Introducing-Entity-Framework-Unit-Testing-with-TypeMock-Isolator.aspx)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-01-26T04:30:41.037

Due to the fact that version 1 of the Entity Framework breaks a few major software design principles, there really isn't any way to apply TDD when using it in your application. My research points to NHibernate if you're looking for an immediate solution. It was designed with unit testing in mind.

However, if you can wait, there appears to be hope for the next release of the Entity Framework: [Test-Driven Development Walkthrough with the Entity Framework 4.0](http://blogs.msdn.com/adonet/archive/2009/12/17/test-driven-development-walkthrough-with-the-entity-framework-4-0.aspx)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-18T20:56:08.307

尽管这些示例可能非常简单，但我已尝试讨论此问题的可能解决方案。它涉及关注点分离和我们亲爱的朋友依赖注入。

[http://devblog.petrelyn.com/](http://devblog.petrellyn.com/)

如果您想了解更多详情，请与我联系。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-01T01:49:27.727

我同意，一个模拟框架就是你所追求的。您创建未从数据源检索的“模拟”对象，并测试该对象中的数据。我个人一直在与 Moq 合作，我喜欢它——还有 Rhinomocks，还有其他。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-06-07T18:38:34.177

After lots of frustration with this I finally have a solution that I'm happy with for at least part of the problem.

First use a repository interface something like:

```
public interface IRepository
{
    IQueryable<T> GetObjectSet<T>();
} 
```

which we can use to return either an in memory collection or a real DB backed collection. Next encapsulate your queries into a query object with an interface that look something like this.

```
public interface IQuery<T>
{
    IQueryable<T> DoQuery(IQueryable<T> collection);
} 
```

Now divide your unit tests into 2 groups. The first group will test that your queries are valid. do this like so:

```
[TestMethod]
public void TestQueryFoo()
{
     using(var repo = new SqlRepository("bogus connection string"))
     {
         var query = new FooQuery(); // implements IQuery<Foo>
         var result = query.DoQuery(repo.GetObjectSet<Foo>());  // as long as we don't enumerate the IQueryable EF won't notice that the connection string is bogus
         var sqlString = ((System.Data.Objects.ObjectQuery)query).ToTraceString(); // This will throw if the query can't be compiled to SQL
     }
} 
```

The second set of unit tests can then freely test your business logic without worrying about the SQL compilation step which is, by far, where we run into the most trouble.

Its not perfect by any stretch of the imagination, triggers are obviously not going to be run, DB implemented constraints can be violated, and some issues with the context and database getting out of sync can crop up. So while end to end integration tests are still needed it is possible to catch what is IMO the most common issue to crop up at runtime in simple unit tests.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-07-28T16:57:13.873

The **BookLibrary** sample application of the **[WPF Application Framework (WAF)](http://waf.codeplex.com)** project shows how an Entity Framework based application can be unit tested.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-05-30T10:37:10.450

Here's an aggregation of the unit of work pattern+ in-memory database + t4 code generation to automatically generate a fake EF dbContext.

[http://mockingcompetence.wordpress.com/2013/05/20/fakingefdatacontext/](http://mockingcompetence.wordpress.com/2013/05/20/fakingefdatacontext/)

there are some issues(invalid linq to EF queries and no FK enforcement) with exactly replicating a real EF db connection at this time.

However, having an in-memory context to quickly run unit tests is almost essential to being able to do TDD or any other kind of unit testing centric approach.

I will be posting updates to the above link as I figure out more of the issues.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-10-15T12:03:05.487

You could use in-memory data base for testing your Entity Framework model. Look [here](http://druss.pp.ua/2013/03/unit-test-data-access-layer-entity-framework-with-in-memory-database/) for more details

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-11-29T17:24:49.010

使用模拟框架怎么样？在我看来，模拟框架可以帮助您将业务逻辑与数据库隔离开来。

# anonymous-function - Firefox：从匿名 javascript 函数传递事件

> ID：326454
> 
> 赞同：0
> 
> 时间：2008-11-28T19:02:30.933
> 
> 标签：anonymous-function, event-handling, event-passthrough

在这个简短的代码中，内联事件起作用——“事件”被传递给 testKeyPress 函数

```
<textarea id="source"
    onkeydown= "showCursPos(this); 
    var tf=testKeyPress(event);
    document.onkeypress=function(){return tf};
    document.onkeydown=function(){return tf}; " ></textarea>

function testKeyPress(e){
    if (e.ctrlKey==true ){
        if (e.which == null ){kcode=e.keyCode; }  // IE
        else if (e.which > 0){kcode=e.which; }    // gecko
        return testValidity(kcode);   //returns true-false
    }
} 
```

然而，在这个匿名版本中，gecko 中没有传递事件：

```
<textarea id="source"></textarea>

$("source").onkeydown = function(){ 
    showCursPos(this);  // this function works
    // next event is passed in IE, but not gecko
    var tf=testKeyPress(event); 
    // remaining functions work if value is forced
    document.onkeypress=function(){return tf}; 
    document.onkeydown=function(){return tf}; 
    } 
```

如何传递函数自己的事件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T19:15:04.217

是的，有一个事件对象作为参数。

你可以通过

```
var e=arguments[0] || event; // Firefox via the argument, but IE don't 
```

我不知道它们是否完全相同，但我读`<xxx onkeydown="func(event);">`为`xxx.ononkeydown=function(event){func(event);};`

参考[活动@Mozilla.org](https://developer.mozilla.org/En/DOM/Event)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T21:02:48.070

像魅力一样工作。对我的原始代码的这种修改成功地将事件从匿名函数传递到我的四个浏览器中的命名函数：IE6、FF2、NS7.2、OP9.22

```
$("source").onkeydown = function(){ 
    var e=arguments[0] || event; 
    showCursPos(this);  
    var tf=testKeyPress(e); 
    document.onkeypress=function(){return tf}; 
    document.onkeydown=function(){return tf}; 
} 
```

# asp.net - 注册启动脚本控件

> ID：326460
> 
> 赞同：1
> 
> 时间：2008-11-28T19:05:54.580
> 
> 标签：asp.net, javascript, controls

我正在寻找一个 Web 控件，我可以在其中注册与我的 aspx 内联的客户端启动脚本，因为我讨厌在代码隐藏中注册！

我到目前为止的一个例子：

```
<Ben:StartupScript runat="server">

    var form = document.getElementById("<% =form1.ClientID %>");

</Ben:StartupScript> 
```

目前，我正在重写控件的`OnPreRender`方法，将控件的内容呈现为字符串，然后`ClientScript.RegisterStartupScript`使用`Page`. 我还重写了该`Render`方法，以便不呈现控件。我还应该注意，我将`ParseChildren`属性设置为`false`并将`PersistChildren`属性设置为`true`。

一切似乎都运行良好，但我的控件允许其中包含其他 Web 控件（例如 Button）。除了不直观之外，这还可能导致运行时错误。我希望能够清除控件，但鉴于`<% ... %>`代码块，这是不可能的。

那么，是否有可能阻止开发人员嵌入子控件同时仍然允许代码块？

另外，这个想法有什么好处还是有根本性的缺陷？哈哈。

非常感谢，

本

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T20:03:24.620

这听起来是个好主意，但如果你花太多时间与继承/默认行为作斗争，那么它可能比它的价值更麻烦

如果这是一个一次性的问题，一个廉价的解决方案是直接将您的脚本嵌入到母版页的标题中；-)

另一方面，允许开发人员将自己的脚本作为 Web 控件的子项嵌入可能会很有用

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T18:05:30.470

如果您使用母版页，请在您的部分中添加另一个控件。这样您就可以轻松地将 css/js 添加到子页面的标题中。

ClientScript.RegisterScript 主要用于用户/服务器控件，

# php - 从 PHP 访问 JS 数据

> ID：326463
> 
> 赞同：0
> 
> 时间：2008-11-28T19:07:54.497
> 
> 标签：php, javascript

远程站点在 js 文件中提供数据结构。

我可以在我的页面中包含此文件以访问数据并将其显示在我的页面中。

```
<head>
    <script type="text/javascript" src="http://www.example.co.uk/includes/js/data.js"></script>
</head> 
```

有谁知道我如何使用 PHP 获取这些数据并将其存储在数据库中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T19:10:44.973

您应该通过例如[CURL](http://php.net/curl)直接获取该文件。然后解析它，如果它是 JSON 的，你可以使用[json-decode](http://es.php.net/manual/en/function.json-decode.php)。

[简单示例（在此处](http://es.php.net/manual/en/function.curl-exec.php#87015)找到的代码稍作修改版本）：

```
<?php
$url = "http://www.example.co.uk/includes/js/data.js";
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
...

$output = curl_exec($ch);
$info = curl_getinfo($ch);

if ($output === false || $info['http_code'] != 200) {
  $error = "No cURL data returned for $url [". $info['http_code']. "]";
  if (curl_error($ch))
    $error .= "\n". curl_error($ch);
  }
else {
  $js_data = json_decode($output);
  // 'OK' status; save $class members in the database, or the $output directly, 
  // depending on what you want to actually do.
  ...
}

//Display $error or do something about it

?> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T19:13:46.967

您可以通过 CURL 或其他一些 HTTP 下载库/函数获取文件。然后，解析数据。如果幸运的话，数据是 JSON 格式，您可以使用 PHP 函数将其转换为 PHP 数组。然后，遍历数组中的项目，将每个项目插入到您的数据库中。

# multithreading - MSXML XSL 转换多线程性能争用

> ID：326466
> 
> 赞同：0
> 
> 时间：2008-11-28T19:09:39.143
> 
> 标签：multithreading, xslt, msxml, contention

我有一个多线程服务器 C++ 程序，它使用 MSXML6 并不断解析 XML 消息，然后应用准备好的 XSLT 转换来生成文本。我在具有 4 个 CPU 的服务器上运行它。每个线程都是完全独立的，并使用自己的变换对象。线程之间不共享任何 COM 对象。

这很好用，但问题是可扩展性。运行时：

1.  使用一个线程，每个线程每秒可以进行大约 26 次解析+转换。
2.  有 2 个线程，我得到大约 20/s/线程，
3.  带 3 个线程，18/s/线程。
4.  有 4 个线程，15/s/线程。

由于线程之间没有共享任何东西，我期望接近线性的可伸缩性，因此 4 线程应该比 1 快 4 倍。相反，它只快 2.3 倍。

它看起来像一个经典的争用问题。我编写了测试程序来消除我的代码中存在争用的可能性。我正在使用 DOMDocument60 类而不是 FreeThreadedDOMDocument 类，以避免不必要的锁定，因为文档永远不会在线程之间共享。我努力寻找缓存行错误共享的任何证据，但至少在我的代码中没有。

另一个线索，每个线程的上下文切换速率 > 15k/s。我猜罪魁祸首是 COM 内存管理器或 MSXML 中的内存管理器。也许它有一个全局锁，必须为每个内存分配/释放获取和释放。我简直不敢相信，在这个时代，内存管理器的编写方式并不能很好地适应多线程多 CPU 场景。

有谁知道是什么导致了这种争用或如何消除它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T19:20:25.343

基于堆的内存管理器（您的基本 malloc/free）使用单个互斥锁是相当普遍的，这有相当充分的理由：堆内存区域是一个单一的连贯数据结构。

有一些替代的内存管理策略（例如分层分配器）没有这个限制。您应该调查自定义 MSXML 使用的分配器。

或者，您应该研究从多线程体系结构迁移到多进程体系结构，每个 MSXML 工作程序具有单独的进程。由于您的 MSXML 工作程序将字符串数据作为输入和输出，因此您没有序列化问题。

总结：使用多进程架构，它更适合您的问题，并且可以更好地扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T00:10:39.893

MSXML uses BSTRs, which use a global lock in its heap management. It caused us a ton of trouble for a massively multiuser app a few years ago.

We removed our use of XML in our app, you may not be able to do this, so you might be better off using an alternative XML parser.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T16:30:28.603

Thanks for the answers. I ended up implementing a mix of the two suggestions.

I made a COM+ ServicedComponent in C#, hosted it as a separate server process under COM+, and used the XSLCompiledTransform to run the transformation. The C++ server connects to this external process using COM and sends it the XML and gets back the transformed string. This doubled the performance.

# javascript - 没有 JavaScript 的 GWT？

> ID：326467
> 
> 赞同：8
> 
> 时间：2008-11-28T19:10:26.677
> 
> 标签：javascript, web-applications, gwt, graceful-degradation, noscript

我正在研究GWT。看起来不错，但我们的软件必须在没有 JS 要求的情况下工作。是否可以？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-28T19:34:50.557

不，不是。GWT 提供了一个专门为在客户端而不是服务器上运行而设计的窗口工具包。降级的（例如非javascript）代码需要向浏览器提供完整的HTML，而GWT 根本不这样做。它将您的 java 代码编译成一个 javascript 文件，然后交付给客户端，并通过客户端上的 DOM 操作构建 UI。然后有一些代码可以与服务器对话，一些是隐含的，一些是你自己编写的。这种模型不适合优雅地退化。

稍微优雅地降级的唯一方法是提供第二个非 JavaScript UI 或使用另一个不在客户端呈现前端但提供 HTML 的工具包。对不起。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-17T06:33:00.377

您可以通过创建一个“足够好”的 html 结构（带有表单帖子、链接菜单等）来优雅地降级，然后将 GWT 附加到该结构的每个部分，增强其行为。例如，使 HTML 下拉列表动态化，用打开灯箱的组件替换指向另一个页面的链接，或者用 XML http 请求替换指向另一个页面的链接以执行相同的操作（例如投票）。

我已经为客户做过很多次了。

这是大多数 GWT 开发的相反方式，但它可以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-04T04:42:13.010

在设计我的网站时，我自己也在研究这个问题。GWT 并不比仅仅编写 Javascript 文件更好，因为它们的语法几乎相同。当您共享客户端和服务器库时，真正的好处就来了。希望您在过去两年中解决了这个问题，但无论如何，这里有几个您可能会觉得有用的示例。

创建 Gmail：使用 GWT，您可以在共享包中创建一个 EmailFormatter，该包执行电子邮件列表标记，这样您的服务器就不必这样做了。然后，您可以通过在服务器端使用相同的 EmailFormatter 类来添加对旧版浏览器（“旧版本”）的支持。

表单验证：虽然从安全角度来看验证用户输入服务器端是绝对必要的，但对于大多数用户来说，在提交表单之前让 Javascript 检查表单更方便。您可以使用与 GWT 相同的 Java 代码来执行此操作。

# grails - 带参数的 Grails 转发和/或重定向

> ID：326474
> 
> 赞同：7
> 
> 时间：2008-11-28T19:15:27.587
> 
> 标签：grails, redirect, forwarding

是否可以在 Grails 中进行页面转发？我搜索但没有运气。如果可能，如何在转发方法中传递参数？如果没有，我将如何使用重定向来做到这一点？到目前为止，我已经找到了类似的重定向：

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-28T19:40:16.817

`controller`重定向在 Grails中惯用地完成。请参阅 [Grails 用户指南](https://grails.github.io/grails-doc/latest)[`redirect`](https://grails.github.io/grails-doc/latest/guide/theWebLayer.html#redirectsAndChaining)中的方法

使用参数的示例：

```
redirect(action:"show",id:4, params:[author:"Stephen King"]) 
```

您还可以通过[URL 映射](http://grails.github.io/grails-doc/latest/guide/theWebLayer.html#urlmappings)`forward`机制完成等效操作，包括添加一个或多个参数。

# vba - 将数字四舍五入到最接近的 5 或 10 或 X

> ID：326476
> 
> 赞同：63
> 
> 时间：2008-11-28T19:19:04.957
> 
> 标签：vba, rounding

给定 499、73433、2348 等数字，我可以使用什么 VBA 舍入到最接近的 5 或 10？或任意数字？

5:

```
 499 ->  500
2348 -> 2350
7343 -> 7345 
```

到 10 点：

```
 499 ->  500
2348 -> 2350
7343 -> 7340 
```

等等

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2008-11-28T19:23:25.043

这是简单的数学。给定一个数字 X 和一个舍入因子 N，公式将是：

圆形(X / N)*N

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2012-10-04T15:59:09.030

**综合答案**

```
X = 1234 'number to round
N = 5    'rounding factor
round(X/N)*N   'result is 1235 
```

对于浮点到整数，1234.564 到 1235，（这是 VB 特有的，大多数其他语言只是截断）做：

```
int(1234.564)   'result is 1235 
```

*当心：* VB 使用[Bankers Rounding](http://wiki.c2.com/?BankersRounding)，到最接近的偶数，如果你不知道这可能会令人惊讶：

```
msgbox round(1.5) 'result to 2
msgbox round(2.5) 'yes, result to 2 too 
```

*谢谢大家。*

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-28T19:24:02.793

四舍五入到最接近的 X（不是 VBA 特定的）

N = X * int(N / X + 0.5)

其中 int(...) 返回下一个最小的整数。

如果您可用的舍入函数已经舍入到**最接近**的整数，则省略 0.5

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-10-04T14:38:52.330

在 VB 中，math.round 有额外的参数来指定小数位数和舍入方法。 **Math.Round(10.665, 2, MidpointRounding.AwayFromZero)**将返回 10.67 。如果数字是小数或单一数据类型，则 math.round 返回小数数据类型。如果是双精度，则返回双精度数据类型。如果选项严格打开，这可能很重要。

(10.665).ToString("n2") 的结果从零四舍五入得到“10.67”。没有额外的参数 math.round 返回 10.66，这可能会导致不必要的差异。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-07-29T23:12:47.603

'示例：将 499 舍入到最接近的 5。您将使用 ROUND() 函数。

```
a = inputbox("number to be rounded")
 b = inputbox("Round to nearest _______ ")

  strc = Round(A/B)
  strd = strc*B

 msgbox( a & ",  Rounded to the nearest " & b & ", is" & vbnewline & strd) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T20:22:52.457

对于严格的 Visual Basic 方法，您可以将浮点值转换为整数以四舍五入到所述整数。VB 是一种罕见的类型转换语言（大多数其他语言只是截断。）

5 或 x 的倍数可以简单地通过轮前除和轮后相乘来完成。

如果你想四舍五入并保留小数位，Math.round(n, d) 可以工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-02-19T18:30:23.350

这是我们的解决方案：

```
Public Enum RoundingDirection
    Nearest
    Up
    Down
End Enum

Public Shared Function GetRoundedNumber(ByVal number As Decimal, ByVal multiplier As Decimal, ByVal direction As RoundingDirection) As Decimal
    Dim nearestValue As Decimal = (CInt(number / multiplier) * multiplier)
    Select Case direction
        Case RoundingDirection.Nearest
            Return nearestValue
        Case RoundingDirection.Up
            If nearestValue >= number Then
                Return nearestValue
            Else
                Return nearestValue + multiplier
            End If
        Case RoundingDirection.Down
            If nearestValue <= number Then
                Return nearestValue
            Else
                Return nearestValue - multiplier
            End If
    End Select
End Function 
```

用法：

```
dim decTotal as Decimal = GetRoundedNumber(CDec(499), CDec(0.05), RoundingDirection.Up) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-28T19:28:05.970

类似的东西？

```
'nearest
 n = 5
 'n = 10

 'value
 v = 496
 'v = 499 
 'v = 2348 
 'v = 7343

 'mod
 m = (v \ n) * n

 'diff between mod and the val
 i = v-m

 if i >= (n/2) then     
      msgbox m+n
 else
      msgbox m
 end if 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-28T19:35:36.203

只需 ROUND(x/5)*5 就可以完成这项工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-28T19:36:29.760

我无法添加评论，所以我将使用它

在 vbs 中运行它，并找出为什么 2 给出 2 的结果很有趣

你不能相信回合

```
 msgbox round(1.5) 'result to 2
 msgbox round(2.5) 'yes, result to 2 too 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-11-14T04:25:19.487

试试这个功能

- - - - - - - 开始 - - - - - - - -

```
Function Round_Up(ByVal d As Double) As Integer
    Dim result As Integer
    result = Math.Round(d)
    If result >= d Then
        Round_Up = result
    Else
        Round_Up = result + 1
    End If
End Function 
```

- - - - - - -结尾 - - - - - -

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-02T00:17:37.760

我稍微更新了“社区维基”（最佳答案）提供的功能，只是四舍五入到最接近的 5（或您喜欢的任何值），但有一个例外：**四舍五入的数字永远不会优于原始数字**。

*这在需要说“一家公司存活 47 年”*的情况下很有用：我希望网页显示**“存活超过 45 年”**，同时避免说谎说**“存活超过 45 年” 50 年”**。

所以当你给这个函数输入 47 时，它不会返回 50，而是会返回 45。

```
'Rounds a number to the nearest unit, never exceeding the actual value
function RoundToNearestOrBelow(num, r)

    '@param         num         Long/Integer/Double     The number to be rounded
    '@param         r           Long                    The rounding value
    '@return        OUT         Long                    The rounded value

    'Example usage :
    '   Round 47 to the nearest 5 : it will return 45
    '   Response.Write RoundToNearestBelow(47, 5)

    Dim OUT : OUT = num

    Dim rounded : rounded = Round((((num)) / r), 0) * r

    if (rounded =< num) then
        OUT = rounded
    else
        OUT = rounded - r
    end if

    'Return
    RoundToNearestOrBelow = OUT

end function 'RoundToNearestOrBelow 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2015-03-18T19:52:01.493

要在 Visual Basic 中模仿 Excel 中的 round 函数的工作方式，您只需使用： WorksheetFunction.Round(number, decimals)

这样，银行或会计四舍五入就不会进行四舍五入。

# c++ - C++中的多线程图像处理

> ID：326487
> 
> 赞同：11
> 
> 时间：2008-11-28T19:24:49.690
> 
> 标签：c++, multithreading, optimization, image-processing, parallel-processing

我正在开发一个处理不同大小图像的程序。许多这些操作从输入读取像素数据并写入单独的输出（例如模糊）。这是在每个像素的基础上完成的。

这种图像映射对 CPU 的压力很大。我想使用多线程来加快速度。我该怎么做？我正在考虑每行像素创建一个线程。

我有几个要求：

*   可执行文件的大小必须最小化。换句话说，我不能使用海量的库。什么是 C/C++ 最轻量级、可移植的线程库？
*   可执行文件的大小必须最小化。我正在考虑有一个函数 forEachRow(fp* ) 为每一行运行一个线程，或者甚至是一个 forEachPixel(fp* ) ，其中 fp 在其自己的线程中对单个像素进行操作。哪个最好？
    *   我应该使用普通函数或仿函数或函数或一些 lambda 函数还是......其他什么？
    *   一些操作使用需要来自先前处理的像素的信息的优化。这使得 forEachRow 有利。即使考虑到这一点，使用 forEachPixel 会更好吗？
*   我需要锁定我的只读和只写数组吗？
    *   输入只能从数组中读取，但许多操作需要从数组中的多个像素输入。
    *   每个像素仅写入一次输出。
*   速度也很重要（当然），但优化可执行文件大小优先。

谢谢。

**感兴趣的有关此主题的更多信息：[C++ 并行化库：OpenMP 与线程构建块](https://stackoverflow.com/questions/615264/c-parallelization-libraries-openmp-vs-thread-building-blocks)**

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-29T04:04:26.113

**不要轻易开始穿线！** 比赛条件可能是一个让人头疼的问题。特别是如果您没有很多线程经验！ **（您已被警告：这里有龙！毛茸茸的、不确定的、无法可靠复制的龙！）**

[你知道什么是死锁吗？活锁怎么样？](http://en.wikipedia.org/wiki/Deadlock)

那就是说...

* * *

正如ckarmann 和其他人已经建议的那样： **使用工作队列模型。每个 CPU 内核一个线程。** 将工作分成 N 个块。使块相当大，就像许多行一样。当每个线程空闲时，它会从队列中取出下一个工作块。

在最简单的*IDEAL*版本中，您有 N 个内核、N 个线程和问题的 N 个子部分，每个线程从一开始就知道它要做什么。

但由于启动/停止线程的开销，这在实践中通常不会发生。您真的希望线程已经生成并等待操作。（例如通过信号量。）

工作队列模型本身非常强大。它使您可以并行化诸如快速排序之类的事情，这通常不会在 N 个线程/内核之间优雅地并行化。

* * *

线程多于内核？你只是在浪费开销。每个线程都有开销。即使在#threads=#cores 下，您也永远无法获得完美的 Nx 加速因子。

每行一个线程将非常低效！每个像素一个线程？我什至不想考虑它。（在使用矢量化处理器单元时，这种逐像素方法更有意义，就像他们在旧 Cray 上使用的那样。但不是线程！）

* * *

图书馆？你的平台是什么？在 Unix/Linux/g++ 下，我建议使用 pthreads 和信号量。（Pthreads 也可以在带有 microsoft 兼容层的 windows 下使用。但是，uhgg。我不太相信它！Cygwin 在那里可能是一个更好的选择。）

在 Unix/Linux 下，*man*：

```
* pthread_create, pthread_detach.
* pthread_mutexattr_init, pthread_mutexattr_settype, pthread_mutex_init,
* pthread_mutexattr_destroy, pthread_mutex_destroy, pthread_mutex_lock,
* pthread_mutex_trylock, pthread_mutex_unlock, pthread_mutex_timedlock.
* sem_init, sem_destroy, sem_post, sem_wait, sem_trywait, sem_timedwait. 
```

有些人喜欢 pthread 的条件变量。但我总是更喜欢 POSIX 1003.1b 信号量。他们处理您想要在另一个线程开始等待更好*之前发出信号的情况。*或者在另一个线程多次发出信号的地方。

哦，帮自己一个忙：将您的线程/互斥量/信号量 pthread 调用包装到几个 C++ 类中。这将简化很多事情！

* * *

***我需要锁定我的只读和只写数组吗？***

这取决于您的精确硬件和软件。通常只读数组可以在线程之间自由共享。但有些情况并非如此。

写法大同小异。通常，只要只有一个线程正在写入每个特定的内存点，就可以了。但有些情况并非如此！

写作比阅读更麻烦，因为您可能会陷入这些奇怪的围栏情况。内存通常写成字而不是字节。当一个线程写入单词的一部分，而另一个线程写入不同的部分时，取决于哪个线程在什么时候做什么的确切时间（例如不确定性），您可能会得到一些非常不可预测的结果！

**我会谨慎行事：为每个线程提供其自己的读写区域副本。完成后，将数据复制回来。当然，都在互斥锁下。**

除非您谈论的是千兆字节的数据，否则内存块非常快。那几微秒的性能时间根本不值得调试噩梦。

如果您要使用互斥锁在线程之间共享一个公共数据区域，那么冲突/等待互斥锁的低效率会堆积起来并破坏您的效率！

* * *

看，干净的数据边界是好的多线程代码的本质。当你的界限不明确时，那就是你遇到麻烦的时候。

同样，保持边界上的所有内容互斥也很重要！并保持互斥区域短！

尽量避免同时锁定多个互斥锁。如果您确实锁定了多个互斥体，请始终以相同的顺序锁定它们！

尽可能使用 ERROR-CHECKING 或 RECURSIVE 互斥锁。FAST 互斥锁只是自找麻烦，实际（测量）速度增益很少。

如果遇到死锁情况，请在 gdb 中运行它，按 ctrl-c，访问每个线程并回溯。通过这种方式，您可以很快找到问题。（活锁更难！）

* * *

最后一个建议：构建它单线程，然后开始优化。在单核系统上，您可能会发现自己从诸如 foo[i++]=bar ==> *(foo++)=bar 之类的东西中获得的速度比从线程中获得的速度更快。

* * *

***附录：*** 我所说的***保持互斥区域短***于上方是什么意思？考虑两个线程：（给定一个 Mutex 类的全局共享互斥对象。）

```
/*ThreadA:*/ while(1){  mutex.lock();  printf("a\n");  usleep(100000); mutex.unlock(); }
/*ThreadB:*/ while(1){  mutex.lock();  printf("b\n");  usleep(100000); mutex.unlock(); } 
```

会发生什么？

在我的 Linux 版本下，一个线程将连续运行，而另一个将饿死。当 mutex.unlock() 和 mutex.lock() 之间发生上下文交换时，它们很少会改变位置。

* * *

***附录：*** 在您的情况下，这不太可能成为问题。但是对于其他问题，人们可能事先不知道完成一个特定的工作块需要多长时间。将问题分解为 100 个部分（而不是 4 个部分）并使用工作队列将其拆分为 4 个核心可以消除此类差异。

如果一个工作块的完成时间是另一个工作块的 5 倍，那么最终一切都会平息。虽然有太多的块，但获取新工作块的开销会造成明显的延迟。这是针对特定问题的平衡行为。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-28T19:50:31.947

如果你的编译器支持[OpenMP](http://openmp.org/wp/)（我知道[VC++ 8.0 和 9.0](http://msdn.microsoft.com/en-us/library/tt15eb9t(VS.80).aspx)支持，gcc 也支持），它可以让这样的事情更容易做。

您不只是想创建很多线程 - 有一个收益递减点，当您开始获得越来越多的上下文切换时，添加新线程会减慢速度。在某些时候，使用太多线程实际上会使并行版本比仅使用线性算法更慢。最佳线程数是可用 CPU/内核数的函数，以及每个线程在 I/O 等事务上花费的时间百分比。查看Herb Sutter 的[这篇文章](http://www.ddj.com/cpp/211800538)，了解有关并行性能提升的一些讨论。

OpenMP 让您可以轻松地将创建的线程数调整为可用的 CPU 数。使用它（尤其是在数据处理情况下）通常只需`#pragma omp`在现有代码中放入一些 s，并让编译器处理创建线程和同步。

一般来说 - 只要数据没有变化，您就不必锁定只读数据。如果您可以确定每个像素槽只会被写入一次，并且您可以保证在开始读取结果之前已完成所有写入，那么您也不必锁定它。

对于 OpenMP，就函子/函数对象而言，不需要做任何特别的事情。以对您最有意义的方式编写它。[这是来自英特尔](http://software.intel.com/en-us/articles/getting-started-with-openmp)的图像处理示例（将 rgb 转换为灰度）：

```
#pragma omp parallel for
for (i=0; i < numPixels; i++)
{
   pGrayScaleBitmap[i] = (unsigned BYTE)
       (pRGBBitmap[i].red * 0.299 +
        pRGBBitmap[i].green * 0.587 +
        pRGBBitmap[i].blue * 0.114);
} 
```

这会自动拆分为与 CPU 一样多的线程，并将数组的一部分分配给每个线程。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-28T19:31:08.193

我会推荐`boost::thread`和`boost::gil`（通用图像库）。因为涉及的模板很多，我不确定代码大小是否仍然可以为您所接受。但它是提升的一部分，所以它可能值得一看。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-28T19:39:50.173

作为一个左场的想法......

你在什么系统上运行这个？您是否想过在您的 PC 中使用 GPU？

Nvidia 有用于这类事情的[CUDA API](http://en.wikipedia.org/wiki/CUDA)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T19:33:24.867

我认为您不希望每行有一个线程。可能有很多行，您将花费大量内存/CPU 资源来启动/销毁线程以及 CPU 从一个切换到另一个。此外，如果您拥有带有 C 内核的 P 处理器，那么您可能不会获得比 C*P 线程更多的收益。

我建议您使用定义数量的客户端线程，例如 N 个线程，并使用应用程序的主线程将行分配给每个线程，或者他们可以简单地从“作业队列”获取指令。当一个线程完成了一行时，它可以在这个队列中检查另一行来做。

至于库，您可以使用 boost::thread，它非常便携且不太重。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T19:37:35.920

请问你是为哪个平台写的？我猜是因为可执行文件大小是一个你没有针对台式机的问题。在哪种情况下平台有多个内核或超线程？如果不是，那么向您的应用程序添加线程可能会产生相反的效果并减慢它的速度......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T14:06:46.773

要优化简单的图像转换，使用 SIMD 矢量数学比尝试多线程程序要好得多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-15T15:55:26.847

您的编译器不支持 OpenMP。另一种选择是使用库方法，英特尔的线程构建块和 Microsoft 并发运行时都可用（VS 2010）。

还有一组称为并行模式库的接口，这两个库都支持这些接口，其中有一个模板化的 parallel_for 库调用。所以而不是：

```
#pragma omp parallel for 
for (i=0; i < numPixels; i++) 
{ ...} 
```

你会写：

```
parallel_for(0,numPixels,1,ToGrayScale()); 
```

其中 ToGrayScale 是函子或函数指针。（请注意，如果您的编译器支持 lambda 表达式，那么您可以将仿函数内联为 lambda 表达式）。

```
parallel_for(0,numPixels,1,[&](int i)
{  
   pGrayScaleBitmap[i] = (unsigned BYTE)  
       (pRGBBitmap[i].red * 0.299 +  
        pRGBBitmap[i].green * 0.587 +  
        pRGBBitmap[i].blue * 0.114);  
}); 
```

-瑞克

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-09-28T15:02:10.327

查看 MSDN 上的[创建图像处理网络](http://msdn.microsoft.com/en-us/library/ff398050%28v=vs.100%29.aspx)演练，其中解释了如何使用并行模式库来组成并发图像处理管道。

我还建议[Boost.GIL](http://www.boost.org/doc/libs/release/libs/gil)，它可以生成高效的代码。对于简单的多线程示例，请查看Victor Bogado 的[gil_threaded](https://github.com/bogado/gil_threaded)。[An image processing network using Dataflow.Signals and Boost.GIL 也](http://dancinghacker.com/code/dataflow/dataflow/signals/introduction/examples/gil.html)解释了一个有趣的数据流模型。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-28T19:33:48.127

每个像素行一个线程是疯狂的，最好有大约 n-1 到 2n 个线程（对于 n 个 cpu），并使每个循环获取一个作业单元（可能是一行，或其他类型的分区）

在类 unix 上，使用 pthreads 它既简单又轻量级。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-28T19:50:23.117

`#ifdef`也许编写您自己的小型库，该库使用's 为每个平台实现一些标准线程函数？它实际上并没有太多，这将比您可以使用的任何库更能减少可执行文件的大小。

**更新：**对于工作分配 - 将您的图像分成几块并给每个线程一块。所以当它完成了这件作品时，它就完成了。这样您就可以避免实施会进一步增加可执行文件大小的作业队列。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-29T04:39:39.210

我认为无论您选择哪种线程模型（boost、pthread、本机线程等）。我认为你应该考虑一个线程池，而不是每行一个线程。线程池中的线程“启动”起来非常便宜，因为就操作系统而言，它们已经创建好了，只是给它一些事情要做。

基本上，您的池中可以说 4 个线程。然后以串行方式，对于每个像素，告诉线程池中的下一个线程来处理该像素。这样，您一次可以有效地处理不超过 4 个像素。您可以根据用户偏好或系统报告的 CPU 数量来确定池的大小。

恕我直言，这是迄今为止向 SIMD 任务添加线程的最简单方法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-01-15T10:54:30.270

很有可能，瓶颈不是 CPU，而是内存带宽，所以多线程不会有太大帮助。尽量减少内存访问并在有限的内存块上工作，以便可以缓存更多数据。不久前我遇到了类似的问题，我决定优化我的代码以使用 SSE 指令。每个单线程的速度提高了近 4 倍！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-15T16:00:12.973

我认为 map/reduce 框架将是在这种情况下使用的理想之选。您可以使用 Hadoop 流来使用现有的 C++ 应用程序。

只需实施地图并减少工作。

正如您所说，您可以将行级操作用作映射任务，并将行级操作组合到 reduce 任务中的最终图像。

希望这是有用的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-01-09T08:55:29.153

您还可以使用[IPP](https://software.intel.com/en-us/intel-ipp)或[Cassandra Vision](http://www.cassandra-vision.com/) C++ API 等库，这些库大多比您自己的代码优化得多。

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2008-11-28T21:50:56.243

还有另一种使用汇编进行优化的选择。现在，一个令人兴奋的动态代码生成项目是[softwire](https://gna.org/svn/?group=softwire)（可以追溯到一段时间 -[这](http://softwire.sourceforge.net/)是原始项目的站点）。它由 Nick Capens 开发，并发展成为现在可商用的[swiftshader](http://www.transgaming.com/products/swiftshader/)。但是原始软线的衍生产品仍然可以在 gna.org 上找到。

[这](http://www.flipcode.com/archives/Pure_Run-Time_Assembler.shtml)可以作为他的解决方案的介绍。

就个人而言，我不相信您可以通过使用多个线程来解决您的问题来获得显着的性能。

# storage - 游戏地形数据库模型

> ID：326497
> 
> 赞同：2
> 
> 时间：2008-11-28T19:32:23.747
> 
> 标签：storage, terrain

我正在为网络开发游戏。该游戏的地图将至少为 2000 公里乘以 2000 公里。我希望能够以某种粒度级别对海拔和地形类型进行编码 - 例如 100m X 100m。

对于 2000 公里乘 2000 公里的地图，将此信息存储在 100m ²桶中意味着数据库中有 20000 乘 20000 个元素或总共 400,000,000 条记录。

还有其他存储此类信息的方法吗？

更多信息

地图本身永远不会完整显示。单位将以回合制方式在地图上移动，玩家将获得有关他们所在位置和当地情况的反馈。地形将决定速度和禁止移动。

我想我想说的是地图将用于游戏，不一定用于图形或显示目的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T19:38:22.860

这取决于您要如何生成地形。例如，您可以程序化地生成它（使用低分辨率地形/高度图的插值 - 存储为两个“位图” - 从 xy 坐标播种随机插值以确保地形不会变形），并使用最少的存储. 如果您想要完全定义的地形区域，您可以单独存储它们并在适当的地方使用它们，随机生成其余部分。）

如果您想要完全定义的地形，那么您将需要研究某种压缩/流技术来仅提取您当前感兴趣的地形。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T20:25:11.127

我会通过区分地形类型和海拔来区别对待它。

1.  我认为地形类型不会像海拔那样迅速变化——可能有相同类型地形的扇区比最低粒度级别延伸的时间长得多。我会将这些扇区映射到数据库记录或某种哈希表中，具体取决于性能、内存和其他要求。

2.  我认为海拔是半连续的，因为它在很大程度上是逐渐变化的。我会尝试将这些值映射到一组连续函数（不连续的部分之间的不同集合，如海拔的突然变化）。对于任何地形高度相同或可以用简单函数描述的坐标集，您只需要定义该函数覆盖的范围即可。这应该会大大减少您需要记录来描述地形中每个点的高程的信息量。

所以基本上我会将地图分解为由（x，y）范围组成的不同扇区，一次用于地形类型，一次用于地形高程，并为每个区域构建一个哈希表，可以根据需要返回适当的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T19:35:28.310

如果您想要您正在寻找的那种粒度，那么没有明显的方法可以做到这一点。

您可以尝试二维小波变换，但这非常复杂。像傅里叶变换这样的东西会做得很好。另外，您可能不会以每块土地一条记录的方式存储地形；拥有某种可以存储编码矩阵的数据库字段更有意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T19:39:48.003

我认为通常的解决方案是将您的域分解为可管理大小的“图块”。您必须添加一些逻辑以在任何给定时间加载适当的图块，但还不错。

您不需要一次访问所有这些信息——即使每个 100 平方米的存储桶在屏幕上占用一个像素，我所知道的任何屏幕都不能同时显示 20k x 20k 像素。

此外，我不会使用数据库——查看高度映射——有效地使用像素值表示高度的黑白图像。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T19:40:35.397

无论您以哪种方式看待它，这将是非常多的信息。400,000,000 个网格单元将付出代价。

我看到了两种解决方法。首先，由于它是一个基于网络的游戏，你可能能够获得一个具有适当大小的硬盘的服务器，并像往常一样在其中存储 400M 的记录。或者更有可能创建某种您自己的存储机制以提高效率。然后，您只需要设计一种有效访问数据的方法，这可以通过考虑您可能需要一次使用所有数据的事实来完成。;)

另一种方式是某种压缩。不过，您必须小心。大多数开箱即用的压缩算法不允许您解压缩流中的任意位置。也许您的地形数据中有一些您可以使用的模式？我怀疑这将是完全随机的。我更有可能预测具有相同数据的大面积区域。也许那些可以这样编码？

# java - java后台/守护进程/服务跨平台最佳实践

> ID：326509
> 
> 赞同：27
> 
> 时间：2008-11-28T19:38:36.040
> 
> 标签：java, cross-platform, desktop-application, daemon

我正在寻找让我的桌面 java 程序在大多数平台（Windows、Mac OS、Linux [尤其是 Ubuntu]）上在后台运行的最佳方法（**守护进程/服务**？）。

通过“最佳方式”，我希望找到一种方法：

1.  需要**最少**数量的特定于平台的代码。
2.  不要求用户做任何普通计算机用户不能/不会做的事情
3.  不要成为资源狂。

我知道我的要求可能不切实际，但我希望这种情况有某种“最佳实践”。

如何前进？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-29T22:45:56.750

[您可以使用Apache Commons 守护程序代码](http://commons.apache.org/daemon/index.html)将 Java 应用程序作为服务 (Windows) 或守护程序 (Linux) 运行。

## 结构

守护进程由两部分组成。一种是用 C 编写的，用于与操作系统建立接口，另一种是用 Java 编写的，提供 Daemon API。

## 平台

支持 Win32 和类 UNIX 平台。对于 Win32 平台，请使用 procrun。对于类 UNIX 平台，请使用 jsvc。

## Java 代码

您必须编写一个实现以下方法的类（MyClass）：

```
* void load(String[] arguments): Here open the configuration files, create the trace file, create the ServerSockets, the Threads
* void start(): Start the Thread, accept incoming connections
* void stop(): Inform the Thread to live the run(), close the ServerSockets
* void destroy(): Destroy any object created in init() 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-28T20:28:01.887

[您可以使用Java Service Wrapper](http://wrapper.tanukisoftware.org/doc/english/download.jsp)将任何 Java 程序转换为服务/守护程序。它被多个 OSS 项目使用，并作为 Nexus Maven 存储库管理器的一部分提供，以便可以作为开箱即用的服务安装。要使用它，您，作者，只需要创建一个配置文件，然后运行一个简单的批处理文件来在 Windows 上创建服务或将一个 init 脚本复制到 Linux 上的正确运行级别。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-28T19:54:19.007

您可以使用 [SystemTray](http://java.sun.com/javase/6/docs/api/java/awt/SystemTray.html)类并将您的应用程序安装为默认平台中的任何其他应用程序。

对于 Windows，它可能是在启动时运行的计划任务。对于 Linux 和 OSX，我不知道（除了 crontab 有点太技术性了），但我很确定他们都有办法轻松地做同样的事情。

不幸的是（截至今天）Apple 还没有完成 1.6 端口。

它不会是真正的恶魔，而是像 Google 桌面这样的应用程序。

我听说石英是一个不错的选择。但我从未使用过它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-13T11:37:45.220

如果您不需要免费的解决方案，您可以使用 Advanced Installer (www.advancedinstaller.com)，它可以从您的 JAR 中制作 win-service 以及 MacOS 安装程序等等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T20:04:54.647

查看[JDIC，](https://jdic.dev.java.net/) Java 桌面集成组件项目。它支持桌面集成，如系统托盘（或等效）与跨平台 API。

其他人提到了 Quartz，这是一个企业作业调度程序。它可以是轻量级的，具体取决于计划的作业，但它没有任何本质上面向桌面的功能。相反，它的许多功能都依赖于企业支持，例如关系数据库。如果您的应用程序主要是调度任务，一个无头 Quartz 服务执行作业，用桌面客户​​端与该服务进行交互是合理的做法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-31T13:28:12.903

[Apache Directory Daemon](https://github.com/apache/directory-daemon/)项目听起来是最好的跨平台方式（在 POSIX 下使用 JSVC 的 Java 包装器，在 windows 下使用 procrun）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-08-15T10:04:12.570

人们有时很难找到 prunsrv.exe 和/或 prunmgr.exe（procrun 的组件），它在 apache 站点上没有很好的记录，通常可以在档案中找到（注意。他们说 procrun 是 tomcat5.exe）

对于 Windows，您可以在这里找到它：http: [//archive.apache.org/dist/commons/daemon/binaries/windows/commons-daemon-1.0.7-bin-windows.zip](http://archive.apache.org/dist/commons/daemon/binaries/windows/commons-daemon-1.0.7-bin-windows.zip)（包含 32 位和 64 位版本）

## 您不需要实现守护程序接口，也不需要下载它，可以使用 prunsrv 将任何应用程序转换为 Windows 服务

浏览其他平台的存档

# comparison - MEF 是微软的 Lua 版本吗？

> ID：326514
> 
> 赞同：2
> 
> 时间：2008-11-28T19:40:50.903
> 
> 标签：comparison, lua, mef

我看到了 MEF 和 Lua 之间的相似之处。两者都允许您注册方法并根据需要进行部署。MEF 和 Lua 都是 IoC / 依赖注入的形式吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T06:41:44.300

我假设您已经意识到这些技术之间的巨大差异并专注于以下问题：

> “MEF 和 Lua 都是 IoC / 依赖注入的形式吗？”

另外，我假设您正在谈论嵌入式 Lua 与 Lua 作为一种语言。

首先，让我们将依赖注入与控制反转分开。[Fowler 将依赖注入定义为 IoC 的一种特定形式，](http://martinfowler.com/articles/injection.html)因为 IoC 的概念已经变得如此普遍，以至于它不再是系统的显着特征。他的定义包括三种主要类型的依赖注入：构造函数注入、Setter 注入和接口注入。在所有这三种类型中，其想法是将类或接口的特定实现注入到需要它的类或方法中。这非常巧妙，因为它允许您将依赖项和使用它的类解耦。只要他们遵守合同，您就可以编辑和交换依赖项的实现，而无需其消费者关心或受到影响。

使用这个定义，我会说 MEF 通过并且嵌入式 Lua 失败。MEF 在很大程度上是一个依赖注入框架。它允许您动态加载和组合实现特定合同的外部类。另一方面，Lua 允许通过脚本进行扩展，但合同方式很少。当然，您可以为您的应用程序提供一个 Lua API，这是一种合同，但它并不能确保遵守真正的合同。

IoC 更广泛。（[Fowler](http://martinfowler.com/bliki/InversionOfControl.html)，[维基百科](http://en.wikipedia.org/wiki/Inversion_of_control)）共同的主题是主程序流暂时放弃控制但从正在工作的组件接收流状态更新。实现这一点的常用方法包括：事件、闭包和延续。

使用这个定义，MEF 很容易传递（控制在运行时传递给未知组件），您也可以为嵌入式 Lua 做一个参数。主程序一直运行，直到它需要在外部脚本中定义的函数。此时，控制权被传递给脚本，直到它完成或被中断。

需要注意的一点是，Lua 在这方面并不是特别特别。您可以嵌入 Perl、Python、Tcl 和 Ruby。事实上，IoC 的一般定义在现代编程环境中并不是特别有用。这太常见了。Fowler 说这就是他引入依赖注入作为特例的原因。在 GUI、事件、线程、守护进程、闭包、延续和单子的世界中，一切都使用 IoC。今天，当人们说“IoC”时，他们通常指的是某种依赖注入。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T20:26:16.070

MEF 与 Lua 无关，与 Lua 一点也不像。

MEF 是一个扩展框架（基本上，一个很棒的插件框架）。

Lua 是一种非常酷的脚本语言。

“两者都允许您注册方法并根据需要进行部署。” 这句话适用于 C、C++、C#、VB、SQL、DI 框架、JavaScript、通用汽车、福特、医院……

# linux - Windows CE 与嵌入式 Linux

> ID：326516
> 
> 赞同：32
> 
> 时间：2008-11-28T19:41:35.037
> 
> 标签：linux, embedded, operating-system, windows-ce

现在我确信我们都非常清楚 Linux 与 Windows 桌面的相对优点。但是，我对嵌入式开发世界的了解要少得多。我主要对工业解决方案感兴趣，因此对 iPhone 或 Android 不感兴趣，而对这两个操作系统更感兴趣。

嵌入式世界中两个平台之间的相对权衡是什么？如果您正在考虑为具有自定义硬件、部分自定义操作系统和自定义应用程序的特定项目构建一个盒子，那么您会选择哪一个？为什么？

我会假设 Windows CE 在工具上胜出，而 Linux 在成本和性能上都胜出。然而，这只是完全的猜测。有没有人有这两者的任何事实或经验？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-28T19:52:48.993

我在一家为所有硬件提供 CE 和 Linux 的公司工作了几年，所以我对这个等式的两边都相当熟悉。

*   **工具：** Windows CE 工具肯定比 Linux 提供的工具好，虽然 linux 工具肯定越来越好。
*   **性能：** Windows CE 是实时的。Linux 不是。linux 内核根本不是为确定性而设计的。您可以添加一些扩展以获得某种实时性，但 CE 胜过它。
*   **成本：**这是一个存在很大误解的领域。我的一般经验是，CE 开箱即用的成本较低（Platform Builder 为 1000 美元，运输运行时每台设备低至 3 美元。“什么？”你问？“Linux 是免费的。”嗯，没那么多, 特别是在嵌入式领域。是的，有像 Debian 这样的免费发行版。但是你可能需要很多不属于免费类别的部分。像 QT、Java 运行时和媒体编解码器这样的 UI 框架只是一个开始。此外，大多数具有商业支持系统（例如 MontaVista）的 Linux 发行版都不是免费的。
*   **源代码可用性：** Linux 支持者可能会说，由于缺少源代码，CE 是一个糟糕的选择。我只能说，在与 CE 合作的十多年中，其中一半用于为定制板做定制内核和驱动程序工作，我只需要没有随 CE 提供的源（他们提供了大量大部分）一次。我也喜欢有源，但微软提供支持，所以在极少数情况下你可能认为你需要那个源，你可以让他们解决问题（有一次我们需要源，微软提供了一个修复，而且是免费的——这是他们在 CE 下的模型。

这是否意味着CE每次都获胜？不，我根本不建议这样做。如果您是一家 Linux 商店，并且拥有大量 Linux 经验和代码资产，那么跑出去去 CE 是愚蠢的。但是，如果您是从头开始，CE 通常具有较低的 TCO。具有 Win32/C# 经验的开发人员更普遍，因此成本更低。与大多数其他发行版相比，您还可以通过 CE 获得更多的“内置”功能，这意味着如果您还没有在内部完成这些事情，那么上市时间会更快。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-11-28T22:08:29.717

我将代表 Linux 方面，至少针对我熟悉的软件类别（即 RF 数据收集设备）。或者工业应用与消费者应用。

Windows CE（及其相关工具）IMH 相当近的 E）强烈倾向于在小屏幕上创建“Windows 体验”。用户输入模式强调类似鼠标的动作。登录、应用程序选择等都尽量与标准 Windows 相似。

如果用户正在驾驶叉车，或者正在装满拣货车，或者将材料从一个地方移动到另一个地方，那么就会出现问题。

它是一个不断变化的目标——尤其是在 .NET 方面。Compact .NET 运行时存在严重缺陷，重要的库（如网络、数据处理和 UI）不完整，并且版本经常弃用以前的版本。. CE 似乎是 Windows 家族中的继子（可能是因为向硬件集成商销售的积极竞争并不多。）

一个不错的稳定的行和列 Linux 控制台对于小屏幕上的许多（根据我的经验）高使用率的应用程序来说是一个非常方便的上下文。

不过，对于您的手机或 Zune 上的游戏来说，这并不是什么好事。

笔记：

我认为 ctacke 可能准确地代表了硬件集成商的一面。我与更进一​​步的玩家——软件集成商和用户保持一致。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-06-20T19:20:33.037

选择通常主要基于感知和文化，而不是具体数据。而且，当您考虑现代操作系统的复杂性、与将其移植到定制硬件相关的所有问题以及未知的未来需求时，根据具体数据做出选择是很困难的。即使从应用程序的角度来看，事情也会随着项目的生命周期而变化。需求来来去去。你会发现自己在做你从未想过会做的事情，尤其是在可能的情况下。无处不在的 USB 和网络端口开启了许多可能性——例如添加 Cell 调制解调器支持或打印机支持。基于闪存的存储使现场软件更新成为标准操作模式。最后，每种解决方案都有其优点和缺点——没有在所有情况下都是最好的灵丹妙药。

在考虑嵌入式 Linux 开发时，我经常使用冰山的比喻；你在项目中看到的是水面以上的部分。这些是您的应用程序与之交互的部分，您需要自定义的驱动程序，您理解的部分。其余 90% 在水下，因此存在很大的可变性。驱动程序的质量问题或无法找到您将来可能想要支持的驱动程序很容易淹没项目的已知部分。很少有人同时拥有 WinCE 和 Linux 解决方案的丰富经验，因此倾向于选择舒适的（或经理舒适的）或我们所拥有的经验。以下是一些需要考虑的方面的想法：

**系统软件开发**

这个领域的问题包括 CPU 支持、驱动程序质量、现场软件更新、文件系统支持、驱动程序可用性等。过去两年发生的变化之一是 CPU 供应商现在正在将 Linux 移植到他们的新芯片中作为第一个操作系统。以前，操作系统移植通常由诸如 MontaVista 之类的 Linux 软件公司或社区努力完成。因此，Linux 内核现在支持大多数主流嵌入式 CPU，只需要很少的附加补丁。这与 5 年前的情况截然不同。因为很多人都在使用相同的源代码，所以问题会得到修复，并且通常会被贡献回主流源代码。使用 WinCE，BSP/驱动程序支持更多地是一种参考实现，然后 OEM/用户接受它，修复任何问题，这就是修复程序往往停留的地方。

从系统的角度来看，考虑未来需求的灵活性非常重要。仅仅因为它现在不是一个要求并不意味着它将来不会是一个要求。获得对外围设备的驱动程序支持几乎是不可能的，或者需要付出太大的努力才能使其实用。

大多数人很少考虑构建系统，或者从不考虑“如果有一个很好的 gui 围绕该工具，它一定很容易”。OpenEmbedded 是一种非常流行的构建嵌入式 Linux 产品的方式，最近被认可为 MontaVista 的 Linux 6 产品的技术基础，被新用户普遍认为“难以使用”。虽然 WinCE 构建工具表面上看起来更简单（高于水面的 10%），但当我需要自定义某些东西、实现软件更新等复杂功能时，您仍然会遇到问题。构建具有生产级的生产系统功能，您仍然需要团队中了解操作系统并且可以在操作系统和构建系统的详细级别上工作的人。使用 WinCE 或嵌入式 Linux，这通常意味着公司要么需要有经验丰富的内部开发人员，要么聘请专家进行部分系统软件开发。系统软件开发与应用程序开发不同，除非你有很多时间，否则通常不是没有经验就想从事的事情。公司通常会为最初的几个项目聘请专家帮助，然后在内部进行后续项目。另一个需要考虑的特性是并行构建支持。随着四核工作站成为标准，一个完整的构建可以在 1.2 小时内完成而不是 8 小时内完成是否重要？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。或聘请专家进行部分系统软件开发。系统软件开发与应用程序开发不同，除非你有很多时间，否则通常不是没有经验就想从事的事情。公司通常会为最初的几个项目聘请专家帮助，然后在内部进行后续项目。另一个需要考虑的特性是并行构建支持。随着四核工作站成为标准，一个完整的构建可以在 1.2 小时内完成而不是 8 小时内完成是否重要？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。或聘请专家进行部分系统软件开发。系统软件开发与应用程序开发不同，除非你有很多时间，否则通常不是没有经验就想从事的事情。公司通常会为最初的几个项目聘请专家帮助，然后在内部进行后续项目。另一个需要考虑的特性是并行构建支持。随着四核工作站成为标准，一个完整的构建可以在 1.2 小时内完成而不是 8 小时内完成是否重要？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。除非您有很多时间，否则通常不是您想在没有经验的情况下从事的事情。公司通常会为最初的几个项目聘请专家帮助，然后在内部进行后续项目。另一个需要考虑的特性是并行构建支持。随着四核工作站成为标准，一个完整的构建可以在 1.2 小时内完成而不是 8 小时内完成是否重要？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。除非您有很多时间，否则通常不是您想在没有经验的情况下从事的事情。公司通常会为最初的几个项目聘请专家帮助，然后在内部进行后续项目。另一个需要考虑的特性是并行构建支持。随着四核工作站成为标准，一个完整的构建可以在 1.2 小时内完成而不是 8 小时内完成是否重要？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。一个完整的构建可以在 1.2 小时而不是 8 小时内完成，这很重要吗？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。一个完整的构建可以在 1.2 小时而不是 8 小时内完成，这很重要吗？构建系统在从各种来源（如各种版本控制系统等）提取和构建源代码方面有多灵活。

嵌入式处理器正变得越来越复杂。仅仅让 cpu 运行已经不够好。如果您考虑 TI 的 OMAP3 cpu 系列，那么您必须提出以下问题：是否有可用于 3D 加速引擎的库，我什至可以在不承诺每年数百万台的情况下获得它们吗？是否支持 DSP 桥接器？这一切的代价是什么？在我最近参与的一个项目中，用于 Atmel AT91SAM9260 的基本 WinCE BSP 成本为 7000 美元。就开发人员的时间而言，这并不多，但您还必须考虑维护、升级到新版本操作系统等的持续成本。

**应用开发**

嵌入式 Linux 和 WinCE 都支持一系列应用程序库和编程语言。C 和 C++ 得到很好的支持。在 WinCE 世界中，大多数业务类型的应用程序正在迁移到 C#。Linux 有 Mono，它为 .NET 技术提供了广泛的支持，并且在嵌入式 Linux 系统中运行得非常好。嵌入式 Linux 有许多可用的 Java 开发环境。您确实遇到差异的一个领域是图形库。通常，Microsoft 图形 API 在 Linux 上没有得到很好的支持，所以如果你有一个大型的应用程序团队，他们是死硬的 Windows GUI 程序员，那么 WinCE 可能是有意义的。但是，在 Windows PC 和嵌入式 Linux 设备上运行的 GUI 工具包有很多选项。一些示例包括 GTK+、Qt、wxWidgets 等。Gimp 是在 Windows 上运行的 GTK+ 应用程序的一个示例，此外还有许多其他应用程序。它们是与 GTK+ 和 Qt 的 C# 绑定。另一个似乎在 WinCE 领域变得强大的功能是 Windows Communication Foundation (WCF)。但同样，有一些项目可以将 WCF 引入 Mono，这取决于您需要哪些部分。嵌入式 Linux 对 Python 等脚本语言的支持非常好，Python 在 200MHz ARM 处理器上运行得非常好。

人们常常认为 WinCE 是实时的，而 Linux 不是。Linux 实时支持在带有 PREEMPT 选项的股票内核中是不错的，并且通过添加一个相对较小的实时补丁，实时支持非常好。使用 Linux，您可以轻松实现亚毫秒级计时。这在过去几年中随着实时功能合并到股票内核而发生了变化。

**开发流程**

在生产环境中，最先进的嵌入式应用程序是在 PC 上开发和调试的，而不是在目标硬件上。即使在目标系统上的远程调试效果很好的设置中，在工作站上调试应用程序也效果更好。因此，一种解决方案具有良好的目标调试功能，而另一种解决方案没有这一事实并不真正相关。对于以数据为中心的系统，通常具有可以在不连接到真实 I/O 的情况下测试应用程序的模拟模式。对于 Linux 和 WinCE 应用程序，嵌入式设备的应用程序编程类似于 PC 编程。嵌入式 Linux 更进一步。由于嵌入式 Linux 技术与桌面和服务器 Linux 技术相同，几乎所有为桌面/服务器开发的东西（包括系统软件）都可以免费嵌入。这意味着非常完整的驱动程序支持（参见上面的 USB 单元调制解调器和打印机示例）、强大的文件系统支持、内存管理等。Linux 的选择范围令人震惊，但有些人可能会认为这是一个负面因素，并且更喜欢像 Windows CE 这样的集成解决方案，一切都来自一个地方。失去了灵活性，但在某些情况下，这种权衡可能是值得的。有关可以使用 Openembedded 为嵌入式 Linux 系统构建的软件包数量的示例，请参阅。并且更喜欢像 Windows CE 这样的更集成的解决方案，其中一切都来自一个地方。失去了灵活性，但在某些情况下，这种权衡可能是值得的。有关可以使用 Openembedded 为嵌入式 Linux 系统构建的软件包数量的示例，请参阅。并且更喜欢像 Windows CE 这样的更集成的解决方案，其中一切都来自一个地方。失去了灵活性，但在某些情况下，这种权衡可能是值得的。有关可以使用 Openembedded 为嵌入式 Linux 系统构建的软件包数量的示例，请参阅。

**图形用户界面趋势**

重要的是要考虑由手机（iPhone、Palm Pre 等）驱动的带有小型显示器的嵌入式设备的趋势。桌面系统中常见的标准 GUI 小部件（对话框、复选框、下拉列表等）并不适用于现代嵌入式系统。因此，考虑支持 3D 效果和设计用于触摸屏设备的小部件库非常重要。Clutter 库是此类支持的一个示例。

**远程支持**

回到调试工具的问题，大多数人停留在设备设置在实验室工作站旁边的场景上。但是，当您需要对在世界各地进行 beta 测试的设备进行故障排除时，该怎么办？这就是像 Gdb 这样的命令行调试器的优点，而不是缺点。如果您不支持新西兰的蜂窝调制解调器，或者不支持 ssh 等用于 shell 访问和传输文件的高效连接机制，您如何连接到设备？

**概括**

选择任何先进技术都不是一件容易的事，即使有经验也很难做到。因此，重要的是要提出正确的问题，并从多个角度看待决定。希望这篇文章能对此有所帮助。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-11-28T21:45:16.583

我参与过涉及定制 OEM 板的软件的项目，我不会说 Linux 更便宜。购买开发板时，您还需要购买 SDK。即使是 Linux 版本，您仍然需要付费。一些制造商为其板提供 Windows CE 和 Linux 解决方案，并且没有价格差异。对于 Windows CE，您还需要 Platform Builder 并支付许可证费用，但没有支持会更容易。

另一个重要问题是，如果您正在构建用户界面或无头设备。对于需要 LCD 屏幕和人机交互的设备，使用 Windows CE 更容易。另一方面，如果您正在构建无头设备，Linux 可能是一个更合理的选择——尤其是在涉及网络协议的情况下。我相信 Linux 实现更可靠，更容易调整。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-06-02T15:09:59.343

使用 Linux，您**永远不会独自**一人，也永远不会依赖单一实体来提供权限。有许多支持选项，您可以通过许多竞争来源自由选择系统任何部分的支持选项。

对于 Windows CE，您必须遵守必须同意的复杂许可协议中规定的许可和限制。找个律师。使用 Windows CE，您只有一个专有的操作系​​统支持来源，并且您只会在他们认为适合支持和提供您需要的东西时继续进行。您可能不同意他们的立场，但除了屈从于他们的规定外，您别无选择。增量组件、模块、开发套件、许可和支持的成本往往与专有平台堆积在一起。从长远来看，当供应商不再希望支持该平台而您无权自己支持和分发它时会发生什么？当供应商转向更新的技术并希望您与他们一起移动时会发生什么，即使您可能还没有准备好采取行动？$$$

我们对 Windows 解决方案的总体经验是，随着时间的推移，它们往往会变得更加昂贵。最初被认为是最低 TCO 的解决方案很快被吸引到维护和支持成本高昂且负担重的解决方案上。随着时间的推移，许可证必须重新谈判，而且通常不需要的新技术为了满足他们的业务需求而被供应商一时兴起被迫纳入画面。最重要的是，许可协议不断变化——请律师。

使用 Linux，您可以自由地提供内部支持和专业知识，而无需根据需要分发解决方案。您还可以自由地继续使用和支持原始提供商不再想要支持的技术。在业务连续性和控制成本方面，拥有源代码和使用它的权利（GPL、LGPL）是一个强大的吸引力，同时提供对最新技术或满足您需求的技术的访问。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-06-20T22:01:01.480

我已经开发了可以在 RT Linux（更具体地说，带有 RT 补丁的 Linux 抢占式内核）和 Windows CE 上运行的网络驱动程序。我的经验是 windows CE 在实时响应方面更稳定。帧计时还显示 Windows CE 的抖动更小。

在 RT Linux 上，我们遇到了各种各样的问题。例如，当用户移动鼠标时；我们的帧被延迟了。你猜怎么着，x-windows 的某些变体禁用中断。您可能还会觉得仅在控制台屏幕上更安全。如果您启用了 VGA 帧缓冲区，您将再次失败。我们在抖动方面再次遇到了 Windows CE 的一个问题。当 USB 控制器在 BIOS 中设置为不正确的模式并且 Windows CE 使用大量时间进行轮询时，就会出现问题。

老实说，windows CE有更多的支持。在 Linux 上，您只能靠自己。您必须阅读所有可能的邮件列表以了解您可能遇到的问题。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-28T19:55:01.297

> 部分定制的操作系统

如果操作系统是开源的（并且您具有专业知识），则更容易实现。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-10-09T08:45:54.397

对于某些嵌入式系统，Android 是一个不错的选择。（它是基于 linux 的）

*   您有许多能够在此系统上进行开发的专家。

*   您可以访问 java 或 C 中的许多库。

但它使用了大量的内存和能量。

对于付费/许可软件，我们经常忘记的是您必须处理许可证。这需要时间和精力！然后，您必须跟踪您是否正确付款。它涉及许多具有不同技能的不同人员，并且决策成本很高。

这项成本通常不包括在表明开源/免费软件比付费软件更昂贵的研究中。

使用“免费软件”可以更轻松地处理许可证，并且您在处理这些问题上花费的时间更少。就我个人而言，每次更改软件的某些部分时，我都希望避免与您的法律/财务团队进行不必要的沟通。

# c++ - 在 C++ 中重复调用 srand() 会使用相同的种子吗？

> ID：326558
> 
> 赞同：0
> 
> 时间：2008-11-28T20:13:26.143
> 
> 标签：c++, srand

如果我在驱动程序文件的主文件中声明了 srand(2)，是否需要在与驱动程序链接的代码文件中声明 srand(2)？

谢谢。

**编辑**

（来自以下用户的评论）

如果我做，

```
srand(2);
srand(2); 
```

我会得到2号种子吗？或者是其他东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T20:31:04.547

[srand](http://www.cplusplus.com/reference/clibrary/cstdlib/srand.html) (2) 将随机数生成器的种子设置为 2。使用相同的参数再次调用它会将种子再次设置为 2，并将导致随机生成器创建相同的输出。

仅供参考，如果驱动程序使用它自己的 srand 副本（即它是一个 DLL），它可能不会影响主可执行文件中使用的随机生成器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T20:16:06.310

我认为您必须进一步澄清您的问题，但总的来说，您必须声明（但不定义）您在给定翻译单元中使用的每个函数。如果要在 .cpp 文件中使用 srand，则必须`#include <stdlib.h>`在该文件中使用。

有关 srand 的用法，请查看其[文档](http://www.cplusplus.com/reference/clibrary/cstdlib/srand.html)。您通常只需要在给定进程中调用它一次，之后您可以期望每次运行相同的伪随机值序列。使用相同的种子再次调用它将重新启动值序列。如果您每次运行都需要不同的值，请尝试使用当前时间播种。

编辑：

你的意思是你有两个像这样的文件：

```
// Driver.cpp
#include <stdlib.h>
#include "otherfile.h"

int main()
{
    srand(2);
    Somefunc();
} 
```

然后另一个文件链接在：

```
// OtherFile.cpp
#include <stdlib.h>
#include "otherfile.h"

void SomeFunc()
{
    // You don't need to call srand() here, since it's already been called in driver.cpp
   int j = rand();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-27T19:24:18.843

当您使用特定种子调用 srand() 时，它会开始该种子的序列，而不管之前对 srand() 的任何调用。例如，每次您调用 srand(2) 时，对 rand() 的后续调用每次都会以相同的顺序为您提供相同的数字。所以：

```
srand(2);
srand(2); 
```

是多余的。[这个链接](http://www.cplusplus.com/reference/clibrary/cstdlib/srand/)对 srand 有很好的描述。

# python - 将 1 和 0 的字符串转换为字节数组

> ID：326571
> 
> 赞同：4
> 
> 时间：2008-11-28T20:17:22.343
> 
> 标签：python

我有一个长度为 8 的倍数的字符串，其中仅包含 0 和 1。我想将字符串转换为适合写入文件的字节数组。例如，如果我有字符串“0010011010011101”，我想获取字节数组 [0x26, 0x9d]，当写入文件时，它将给出 0x269d 作为二进制（原始）内容。

我怎样才能在 Python 中做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-28T20:24:39.147

你可以这样做：

```
>>> s = "0010011010011101"
>>> [int(s[x:x+8], 2) for x in range(0, len(s), 8)]
[38, 157] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T20:26:19.347

```
py> data = "0010011010011101"
py> data = [data[8*i:8*(i+1)] for i in range(len(data)/8)]
py> data
['00100110', '10011101']
py> data = [int(i, 2) for i in data]
py> data
[38, 157]
py> data = ''.join(chr(i) for i in data)
py> data
'&\x9d' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-28T20:34:03.777

您的问题显示了一个整数序列，但说“字节数组”并且还说“当写入文件时，将给出 0x269d 作为二进制（原始）内容”。这是三个非常不同的东西。我认为你已经过度指定了。从您的各种评论看来，您只想要文件输出，而其他描述不是您想要的。

如果您想要一个整数序列，请查看 Greg Hewgill 的答案。

如果您想要一个字节序列（如字符串） - 可以写入文件 - 请查看 Martin v. Löwis 的答案。

如果你想要一个字节数组，你必须这样做。

```
import array
intList= [int(s[x:x+8], 2) for x in range(0, len(s), 8)]
byteArray= array.array('B', intList) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-06-30T19:03:33.793

# Python 3 和 number.to_bytes

使用 Python 3，您可以使用[number.to_bytes](https://docs.python.org/3/library/stdtypes.html#int.to_bytes)将数字本地转换为字节。字节数组可以直接写入文件。

```
>>> import math,sys
>>> s='0010011010011101'
>>> int(s,2).to_bytes(math.ceil(len(s)/8),sys.byteorder)
b'\x9d&'
>>> with open('/tmp/blah', 'wb') as f:
...     f.write(int(s,2).to_bytes(math.ceil(len(s)/8),sys.byteorder))
... 
2
>>> quit() 
```

## 文件内容

```
[root@localhost prbs]# od -x /tmp/blah
0000000 269d
0000002 
```

# jquery - 导航，背景交换不是每个 鼠标悬停时

> ID：326580
> 
> 赞同：0
> 
> 时间：2008-11-28T20:22:43.910
> 
> 标签：jquery, navigation

我正在使用以下 jquery 代码：

```
$("#top ul li.corner").mouseover(function(){
    $("span.left-corner").addClass("left-corner-hover");
    $("span.right-corner").addClass("right-corner-hover");
    $("span.content").addClass("content-hover");
}).mouseout(function(){
    $("span.left-corner").removeClass("left-corner-hover");
    $("span.right-corner").removeClass("right-corner-hover");
    $("span.content").removeClass("content-hover");

}); 
```

但是正如您在选择器中看到的那样，它将执行鼠标经过的每个 li.corner。我试图让它只做鼠标悬停的那个，我将如何实现？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-28T20:28:44.660

你的`<span>`元素在你的里面`<li>`吗？如果是这样，您可以执行以下操作：

```
$('#top ul li.corner').mouseover(function() {
    $('span.left-corner', this).addClass('left-corner-hover');
    // etc...
}).mouseout(function() {
    $('span.left-corner', this).removeClass('left-corner-hover');
    // etc...
}); 
```

基本上，这会将类分配/删除到被调用的特定`<span>`元素。`<li>`

根据里面有多少东西，使用`mouseenter`and可以获得更好的结果`mouseleave`，以避免在跨越元素边界时触发鼠标悬停：

```
$('#top ul li.corner').bind('mouseenter', function() {
  // etc...
}).bind('mouseleave', function() {
  // etc...
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T20:46:52.910

我试图近似我想象你的代码的样子，并且测试运行良好：

CSS：

```
.left-corner-hover, .right-corner-hover, .content-hover {
    background-color: #CCC;
} 
```

jQuery：

```
$("#top ul li.corner").mouseover(function(){
    $("span.left-corner", this).addClass("left-corner-hover");
    $("span.right-corner", this).addClass("right-corner-hover");
    $("span.content", this).addClass("content-hover");
}).mouseout(function(){
    $("span.left-corner", this).removeClass("left-corner-hover");
    $("span.right-corner", this).removeClass("right-corner-hover");
    $("span.content", this).removeClass("content-hover");

}); 
```

html:

```
<div id="top">
    <ul>
        <li class="corner">
            <span class="left-corner">Left Corner</span>
            <span class="content">Content</span>
            <span class="right-corner">Right Corner</span>
        </li>
    </ul>
    <ul>
        <li class="corner">
            <span class="left-corner">Left Corner</span>
            <span class="content">Content</span>
            <span class="right-corner">Right Corner</span>
        </li>
    </ul>
<div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T20:57:18.783

尝试：

```
$("#top ul li.corner").mouseover(function(){
    $(this).find(".left-corner").addClass("left-corner-hover");
    // ...
}); 
```

您可能不需要指定它是一个“跨度”元素。

要尝试的另一件事是添加和删除“悬停”类，并使您的 CSS 规则如下所示：

```
.left-corner.hover { ... }
.right-corner.hover { ... } 
```

# iphone - 如何控制/覆盖 iPhone 应用程序中的自动完成功能？

> ID：326590
> 
> 赞同：3
> 
> 时间：2008-11-28T20:24:53.280
> 
> 标签：iphone, autocomplete

当用户在我的 iPhone 应用程序中输入文本时，我想控制/覆盖自动完成功能。

具体来说，我想自动完成我提供的一组单词。例如说我的名字是 BillBobJohn。当我输入“billb”时，自动完成会提示 BillBobJohn。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-28T20:40:09.333

这在这里讨论：http: [//forums.macrumors.com/showthread.php?t=573894](http://forums.macrumors.com/showthread.php?t=573894)

# javascript - 如何在 Javascript 中包装函数？

> ID：326596
> 
> 赞同：36
> 
> 时间：2008-11-28T20:26:31.310
> 
> 标签：javascript, function, try-catch, apply, wrapper

我正在为我的一个应用程序编写一个全局错误处理“模块”。

我想要的功能之一是能够轻松地用`try{} catch{}`块包装函数，以便对该函数的所有调用将自动具有将调用我的全局日志记录方法的错误处理代码。（为了避免使用 try/catch 块污染代码）。

`.call`然而，这稍微超出了我对 JavaScript、 and`.apply`方法和`this`关键字的低级功能的理解。

我写了这段代码，基于原型的`Function.wrap`方法：

```
Object.extend(Function.prototype, {
  TryCatchWrap: function() {
    var __method = this;
    return function() {
            try { __method.apply(this, arguments) } catch(ex) { ErrorHandler.Exception(ex); }
    }
  }
}); 
```

这是这样使用的：

```
function DoSomething(a, b, c, d) {
    document.write(a + b + c)
    alert(1/e);
}

var fn2 = DoSomething.TryCatchWrap();
fn2(1, 2, 3, 4); 
```

该代码完美运行。它打印出 6，然后调用我的全局错误处理程序。

我的问题是：当我包装的函数在一个对象中并且它使用“this”运算符时，这会破坏什么吗？我有点担心，因为我正在调用.apply，在那里传递一些东西，我担心这可能会破坏一些东西。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-28T21:13:26.710

我个人不会污染内置对象，而是使用装饰器技术：

```
var makeSafe = function(fn){
  return function(){
    try{
      return fn.apply(this, arguments);
    }catch(ex){
      ErrorHandler.Exception(ex);
    }
  };
}; 
```

你可以这样使用它：

```
function fnOriginal(a){
  console.log(1/a);
};

var fn2 = makeSafe(fnOriginal);
fn2(1);
fn2(0);
fn2("abracadabra!");

var obj = {
  method1: function(x){ /* do something */ },
  method2: function(x){ /* do something */ }
};

obj.safeMethod1 = makeSafe(obj.method1);
obj.method1(42);     // the original method
obj.safeMethod1(42); // the "safe" method

// let's override a method completely
obj.method2 = makeSafe(obj.method2); 
```

但是如果你确实想修改原型，你可以这样写：

```
Function.prototype.TryCatchWrap = function(){
  var fn = this; // because we call it on the function itself
  // let's copy the rest from makeSafe()
  return function(){
    try{
      return fn.apply(this, arguments);
    }catch(ex){
      ErrorHandler.Exception(ex);
    }
  };
}; 
```

明显的改进将是参数化 makeSafe() 以便您可以指定在 catch 块中调用什么函数。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2016-05-17T12:11:04.763

**2017 回答**：只使用 ES6。给定以下演示功能：

```
function doThing(){
  console.log(...arguments)
} 
```

您可以制作自己的包装函数，而无需外部库：

```
 function wrap(someFunction){
  function wrappedFunction(){
    var newArguments = [...arguments]
    newArguments.push('SECRET EXTRA ARG ADDED BY WRAPPER!')
    console.log(`You're about to run a function with these arguments: \n  ${newArguments}`)
    return someFunction(...newArguments)
  }
  return wrappedFunction
} 
```

正在使用：

```
doThing('one', 'two', 'three') 
```

正常工作。

但是使用新的包装函数：

```
const wrappedDoThing = wrap(doThing)
wrappedDoThing('one', 'two', 'three') 
```

回报：

```
one two three SECRET EXTRA ARG ADDED BY WRAPPER! 
```

**2016 回答**：使用`wrap`模块：

在下面的示例中，我正在包装`process.exit()`，但这可以与任何其他功能（也包括浏览器 JS）一起使用。

```
var wrap = require('lodash.wrap');

var log = console.log.bind(console)

var RESTART_FLUSH_DELAY = 3 * 1000

process.exit = wrap(process.exit, function(originalFunction) {
    log('Waiting', RESTART_FLUSH_DELAY, 'for buffers to flush before restarting')
    setTimeout(originalFunction, RESTART_FLUSH_DELAY)
});

process.exit(1); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-28T15:25:17.993

Object.extend(Function.prototype, { Google Chrome 控制台中的**Object.extend给了我 'undefined' 好吧，这里有一些工作示例：**

```
 Boolean.prototype.XOR =
//  ^- Note that it's a captial 'B' and so
//      you'll work on the Class and not the >b<oolean object
        function( bool2 ) { 

           var bool1 = this.valueOf();
           //         'this' refers to the actual object - and not to 'XOR'

           return (bool1 == true   &&   bool2 == false)
               || (bool1 == false   &&   bool2 == true);
        } 

alert ( "true.XOR( false ) => " true.XOR( false ) ); 
```

所以代替 Object.extend(Function.prototype, {...}) 这样做：Function.prototype.extend = {}

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-05-05T03:44:07.633

***老式的函数包装：***

```
//Our function
function myFunction() {
  //For example we do this:
  document.getElementById('demo').innerHTML = Date();
  return;
}

//Our wrapper - middleware
function wrapper(fn) {
  try {
    return function(){
      console.info('We add something else', Date());
      return fn();
    }
  }
  catch (error) {
    console.info('The error: ', error);
  }
}

//We use wrapper - middleware
myFunction = wrapper(myFunction); 
```

***ES6 风格也一样：***

```
//Our function
let myFunction = () => {
  //For example we do this:
  document.getElementById('demo').innerHTML = Date();
  return;
}

//Our wrapper - middleware
const wrapper = func => {
  try {
    return () => {
      console.info('We add something else', Date());
      return func();
    }
  }
  catch (error) {
    console.info('The error: ', error);
  }
}

//We use wrapper - middleware
myFunction = wrapper(myFunction); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-12-09T13:51:02.900

以下包装实用程序采用一个函数，使开发人员能够注入代码或包装原始代码：

```
 function wrap(originalFunction, { inject, wrapper } = {}) {

    const wrapperFn = function(...args) {
        if (typeof inject === 'function') {
            inject(originalFunction, this);
        }
        if (typeof wrapper === 'function') {
            return wrapper(originalFunction, this, args);
        }
        return originalFunction.apply(this, args);
    };

    // copy the original function's props onto the wrapper
    for(const prop in originalFunction) {
      if (originalFunction.hasOwnProperty(prop)) {
        wrapperFn[prop] = originalFunction[prop];
      }
    }
    return wrapperFn;
} 
```

使用示例：

```
 // create window.a()
(function() {

    const txt = 'correctly'; // outer scope variable

    window.a = function a(someText) { // our target
        if (someText === "isn't") {
            throw('omg');
        }
        return ['a', someText, window.a.c, txt].join(' ');
    };

    window.a.c = 'called'; // a.c property example
})();

const originalFunc = window.a;
console.log(originalFunc('is')); // logs "a is called correctly"

window.a = wrap(originalFunc);
console.log(a('is')); // logs "a is called correctly"

window.a = wrap(originalFunc, { inject(func, thisArg) { console.log('injected function'); }});
console.log(a('is')); // logs "injected function\na is called correctly"

window.a = wrap(originalFunc, { wrapper(func, thisArg, args) { console.log(`doing something else instead of ${func.name}(${args.join(', ')})`); }});
console.log(a('is')); // logs "doing something else instead of a(is)"

window.a = wrap(originalFunc, {
    wrapper(func, thisArg, args) {
        try {
            return func.apply(thisArg, args);
        } catch(err) {
            console.error('got an exception');
        }
    }
});
a("isn't"); // error message: "got an exception" 
```

最后一个例子演示了如何用 try-catch 子句包装你的函数

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-05-06T06:47:57.787

这是一个 ES6 风格：

```
const fnOriginal = (a, b, c, d) => {
    console.log(a);
    console.log(b);
    console.log(c);
    console.log(d);
    return 'Return value from fnOriginal';
};

const wrapperFunction = fn => {
    return function () {
        try {
            const returnValuFromOriginal = fn.apply(this, arguments);
            console.log('Adding a new line from Wrapper :', returnValuFromOriginal);
        } catch (ex) {
            ErrorHandler.Exception(ex);
        }
    };
};

const fnWrapped = wrapperFunction(fnOriginal);
fnWrapped(1, 2, 3, 4); 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-28T21:26:09.723

就污染命名空间而言，我实际上会再污染它们......因为在 JS 中发生的所有事情都是由某种事件引发的，所以我打算从 Prototype Event 中调用我的神奇包装函数.observe() 方法，所以我不需要到处调用它。

当然，我确实看到了所有这些的缺点，但是这个特定的项目无论如何都与 Prototype 密切相关，而且我确实希望这个错误处理程序代码尽可能全局化，所以这没什么大不了的。

感谢您的回答！

# c# - 如何获取 HttpRuntime.Cache 中对象的大小？

> ID：326606
> 
> 赞同：5
> 
> 时间：2008-11-28T20:30:24.300
> 
> 标签：c#, asp.net, caching, httpruntime.cache

我目前在 ASP.NET HttpRuntime.Cache 中存储了许多不同类型的对象，我想知道是否有办法确定每个对象有多大？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-28T21:14:05.850

看看这些问题：

[使用 C# 获取字段的大小（以字节为单位）](https://stackoverflow.com/questions/207592/getting-the-size-of-a-field-in-bytes-with-c)
[找出 .net 对象的大小](https://stackoverflow.com/questions/324053/find-out-the-size-of-a-net-object)

特别是，在这些问题中寻找 Jon Skeet 的答案。他们会告诉你为什么这个数字不准确。

至于获得估计，除非您的对象满足某些标准，否则没有办法做到这一点。

例如，如果缓存中有许多对象，共享对某些公共对象实例的引用，序列化缓存中的其中一个对象也会序列化这些公共对象的副本，从而夸大结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T21:08:41.540

您可以做的一件事是将对象序列化为磁盘上的文件。那应该给你一个想法。

来自 ASP 联盟的这个[缓存管理器也可能会有所帮助](http://aspalliance.com/cachemanager/)

# asp.net - ASP.NET MVC - 使用母版页查看，如何设置标题？

> ID：326628
> 
> 赞同：16
> 
> 时间：2008-11-28T20:40:13.703
> 
> 标签：asp.net, asp.net-mvc, master-pages

使用母版页时，为视图设置 html 标题（在头部）的首选方式是什么？

一种方法是在 .aspx 文件中使用 Page.Title，但这需要在母版页中使用，这可能会与 HTML 代码混淆。所以，让我们假设没有服务器端控件，只有纯 html。有更好的想法吗？

更新：我想在控制器或模型中的视图中设置标题。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-17T06:07:11.570

在我们的母版页中，我们创建了一个“init”ContentPlaceHolder 和一个“title”ContentPlaceHolder。如果有人想以编程方式设置 Page.Title，他们可以在 CSharp 中的 init 占位符中设置它，或者他们可以使用标签覆盖“title”占位符。

**母版页**

```
<asp:ContentPlaceHolder id="init" runat="server"></asp:ContentPlaceHolder>
<head runat="server">    
    <asp:ContentPlaceHolder ID="title" runat="server">
        <title><%=this.Page.Title%></title>
    </asp:ContentPlaceHolder>
</head> 
```

**查看页面** 可以覆盖整个“标题”内容占位符：

```
<asp:Content ID="Content1" ContentPlaceHolderID="title" runat="server">
       <title>Home Page</title>
</asp:Content> 
```

或以编程方式设置页面标题。

```
<asp:Content ID="Content1" ContentPlaceHolderID="init" runat="server">
    <%this.Title = "Home Page";%>
</asp:Content> 
```

确保从顶部的 Page 指令中删除**Title=""**，否则您将无法以编程方式更改 Page.Title。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-28T23:52:22.707

我看到很多人使用该`<%= ViewData["Title"] %>`选项。

我想你也可以插入一个`ContentPlaceHolder`命名的标题，然后在你的页面上使用它，但是在我见过的所有 MVC 示例中，他们使用第一个选项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T22:49:51.833

当我创建一个新的 MVC 项目时，其中包含文件并使用母版页。看起来它似乎将标题作为 ViewData [“Title”] 传递给 ViewData，并且在母版页中，`<head>`有一个输出 ViewData [“Title”] 的脚本块。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T13:09:04.940

我最终使用了一个代码隐藏文件来实现`Page.Title="..."`该`Page_Load()`方法。

我不喜欢这样做，但是尝试直接在 .aspx 页面中实现更改不起作用，因为它导致出现两个`<title>`标签，一个是我生成的，一个是由页面继承的主文件生成的.

理想情况下，我的页面代码应该覆盖主文件的`<title>`值，但我想这只是 ASP.Net MVC 仍然存在的那些怪癖之一，并且可能已经在更新版本的 ASP.Net MVC 框架中修复（我们仍在使用 ASP.Net MVC Beta）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-08-14T10:24:40.993

您可以在母版页中执行此操作：

```
<title>
    <%:MyTitle + " :: " %>
    <asp:ContentPlaceHolder ID="TitleContent" runat="server">
    </asp:ContentPlaceHolder>
</title> 
```

其中 MyTitle = web.config 中的一些值或硬文本，如“我的网站”

现在在视图页面中（例如索引）：

```
<asp:Content ID="Content1" ContentPlaceHolderID="TitleContent" runat="server">
<%:"My Home Page"%> 
```

现在，当您浏览主页时，标题将是“My Web :: My Home Page”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-15T07:18:15.050

我有一个从资源文件设置页面标题的基本视图类。对我来说效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-13T16:38:00.093

我创建了一个名为 Application 的类，带有一个 Title 属性（使用 get/set）：

```
public static class Application
{
    static string title;

    public static string Title
    {
        get { return title; }
        set { title = value; }
    }
} 
```

然后我为每个页面设置**Page_Load**事件的属性：

```
Application.Title = "Silly Application"; 
```

然后我只是在母版页上引用该属性：

```
<div id="divApplicationTitle">
     <asp:HyperLink runat="server" NavigateUrl="~/Default.aspx"><asp:Image ID="imgApplicationImage" runat="server" SkinID="skinApplicationLogo" /><%=Application.Title%></asp:HyperLink> 
</div> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-28T20:44:33.617

内容页面的 @Page 指令有一个 Title 属性。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-03T00:11:43.383

对于 ASP.NET 内容页面，只需添加`Title=""`占位`<%@ %>`符。

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-12-02T14:44:25.260

我们结束了

```
<head runat=server visible=false> 
```

在母版页中。

这样我们可以从 Page.Title 中读取（Page.Title 需要 head 元素存在，否则会抛出异常，使用反射器检查）。然后我们使用我们自己的头部元素——MVC 方式。

* * *

## 回答 #11

> 赞同：-8
> 
> 时间：2008-11-30T17:19:04.137

您始终可以在视图页面中使用 javascript：

```
<script type="text/javascript>
    document.title = "Hello World";
</script> 
```

# sql - 在服务器上排序还是在客户端排序？

> ID：326634
> 
> 赞同：26
> 
> 时间：2008-11-28T20:42:09.003
> 
> 标签：sql, database, performance, sorting

我在工作中与一位同事讨论过，是关于 SQL 查询和排序的。他认为您应该让服务器在将行返回给客户端之前进行任何排序。另一方面，我认为服务器可能已经够忙了，让客户端在获取行后处理排序必须更好的性能。

哪一种策略最适合多用户系统的整体性能？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-28T20:44:52.460

一般来说，你应该让数据库来做排序；如果它没有有效处理此问题的资源，则需要升级数据库服务器。

首先，数据库可能已经在您想要的字段上有索引，因此按排序顺序检索数据可能很简单。其次，客户端在获得所有结果之前无法对结果进行排序；如果服务器对结果进行排序，您可以一次处理一行，已经排序。最后，数据库可能比客户端机器更强大，并且可能更有效地执行排序。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-28T20:51:52.557

这取决于...是否涉及分页？数据集的最大大小是多少？整个数据集是否需要一直以相同的方式排序？还是根据用户选择？或者，（如果涉及分页）是否只需要对客户端屏幕上单个页面中的记录进行排序？（通常不可接受）或者是否需要对整个数据集进行排序并重新显示新排序集的第一页？

与这种排序操作的处理要求相比，客户端硬件的分布情况如何？

底线是；应该控制您的决定的是整体用户体验（当然是根据成本来衡量的）...一般来说，客户端机器比服务器慢，并且可能会导致额外的延迟。... ... 但是客户端在初始页面加载后多久会请求一次额外的自定义排序操作​​？（客户端上已经存在的客户端数据比往返速度快得多......）但是在客户端上排序总是需要在初始加载时将整个数据集发送到客户端......这会延迟初始页面显示......这可能需要延迟加载，或 AJAX，或其他技术复杂性来缓解......

在服务器 otoh 上进行排序会引入额外的可伸缩性问题，并且可能需要您向服务器场添加更多的盒子来处理额外的负载……如果您在 DB 中进行排序并达到该阈值，这可能会变得复杂。（要在数据库上横向扩展，您必须实施一些只读复制方案，或其他一些允许多个服务器（每个都进行处理）共享只读数据的解决方案）..

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-28T20:53:18.730

我赞成罗伯茨的回答，但我想补充一点。

我也喜欢在 SQL Server 中对数据进行排序，我曾在许多尝试在客户端进行排序的系统上工作过，几乎在每种情况下，我们都必须重新编写流程才能在 SQL Server 中完成。你可能会问为什么会这样？我们有两个主要原因。

1.  正在排序的数据量
2.  由于#1，需要实现正确的分页

我们处理向用户显示大量数据集的界面，并且利用 SQL Server 的强大功能来处理排序和分页比在客户端执行的性能要好得多。

为了给这个数字加上一些数字，在我们的环境中，SQL Server 端排序到客户端排序，两者都没有分页。客户端 28 秒使用 XML 进行排序，服务器端排序总加载时间 3 秒。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-28T21:30:37.017

一般来说，我同意上面表达的观点，即服务器端排序通常是要走的路。但是，有时有理由进行客户端排序：

*   排序标准是用户可选择的或众多的。在这种情况下，向表中添加少量索引可能不是一个好主意 - 特别是如果插入性能是一个问题。如果很少使用某些排序标准，则索引不一定值得，因为插入次数将超过选择次数。
*   排序标准不能用纯 SQL [不常见] 表达，或者不能被索引。它不一定是更快的客户端，但它需要服务器的负载。

要记住的重要一点是，虽然在理论上平衡强大的客户端和服务器之间的负载可能是一个好主意，但只有服务器才能维护一个索引，该索引在每次插入时都会更新。无论客户做什么，它都是从一组未索引的未排序数据开始的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-28T20:51:42.680

像往常一样，“**这取决于**”:)

例如，如果您有一个将结果发送到表示层（无论是报表、网格等）的存储过程，那么使用哪种方法可能并不重要。

不过，我通常遇到的是具有排序功能的视图（例如，因为它们直接被报表使用）但也被其他视图或其他具有自己排序的过程使用。

因此，作为一般规则，我鼓励其他人在客户端进行所有排序，并且只有在有合理理由的情况下才在服务器上进行。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-28T21:41:35.590

如果排序只是装饰性的并且客户正在获取整个数据集，我倾向于让客户处理它，因为它是关于演示的。

另外，比如说在网格中，您可能必须在客户端中实现排序，因为用户可以通过单击列标题来更改排序（不想要求服务器再次检索所有信息）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-11T15:55:53.657

与任何其他与性能相关的问题一样，通用答案是……“视情况而定”。但是，我已经开发出在客户端进行排序的偏好。我们编写基于浏览器的应用程序，我对客户端的定义分为 Web 服务器和实际的最终用户客户端，即浏览器。我有两个原因更喜欢在客户端排序而不是在数据库中排序。

首先，从设计的角度来看，存在“正确”位置的问题。大多数时候，数据的顺序不是业务规则的事情，而是最终用户方便的事情，所以我将其视为演示文稿的功能，我不喜欢将演示文稿问题推送到数据库中。也有例外，例如，项目的当前价格是存档的最新价格。如果您通过以下方式获得价格：

```
SELECT TOP 1 price 
FROM itemprice 
WHERE ItemNumber = ? 
   AND effectivedate <= getdate() 
ORDER BY effectivedate DESC 
```

那么行的顺序在很大程度上是业务规则的一部分，显然属于数据库。但是，如果您在用户按姓氏查看客户时按 LastName 排序，然后在单击 FirstName 列标题时再次按 FirstName 排序，当他们单击该标题时再次按 State 排序，那么您的排序是演示文稿的功能，并且属于表现层。

我更喜欢在客户端层排序的第二个原因是性能之一。Web 服务器水平扩展，也就是说，如果我的 Web 服务器超载了用户，我可以添加另一个，一个，另一个，另一个。我可以拥有尽可能多的前端服务器来处理负载，并且一切正常。但是，如果我使数据库过载，我就完蛋了。数据库是垂直扩展的，当然，你可以在问题上投入更多的硬件，但在某些时候成本会变得过高，所以我喜欢让数据库做它必须做的选择，让客户端做排序，这它可以很简单。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-10-17T02:34:26.307

我更喜欢客户端上的自定义排序，但我也建议大多数 SQL 语句默认应该有一些合理的 ORDER BY 子句。它对数据库的影响很小，但如果没有它，您以后可能会遇到问题。很多时候，开发人员或用户会在不知不觉中开始依赖一些初始的默认排序顺序。如果未指定 ORDER BY 子句，则数据仅按该顺序排列。在以后的某个日期，索引可能会更改，或者数据可能会重新组织，用户会抱怨，因为数据的初始顺序可能已经从他们下面改变了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-28T21:05:49.937

情况各不相同，衡量绩效很重要。

有时很明显——如果你有一个大数据集并且你对排序列表的一小部分感兴趣（例如，在 UI 应用程序中分页）——在服务器上排序可以节省数据传输。

但通常你有一个数据库和几个客户端，当客户端空闲时，数据库可能会过载。客户端上的排序并不繁重，在这种情况下它可以帮助您扩展。

# .net - 检索存储在数据库的 INT 字段中的字节数组

> ID：326648
> 
> 赞同：0
> 
> 时间：2008-11-28T20:50:34.727
> 
> 标签：.net, ado.net, bytearray

如何检索存储在数据库整数列中的字节数组？

我是否首先将其作为 int，然后作为 byte[] ？

byte[] 权限 = (byte) Convert.ToInt(dr["myField"]);

?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T20:58:59.623

好吧，数据存储为整数。您想如何将其转换为字节数组。给定一个输入，比如说 12345，输出应该是什么？

您为什么首先尝试将字节数组存储在整数列中？

编辑：既然我们知道它基本上是你所追求的标志，我不会将它转换为字节数组，我会使用枚举：

```
[Flags]
public enum Permissions
{
    Read = 1,
    Write = 2,
    Execute = 4,
    Guillotine = 8,
    Lynch = 16
    // etc
} 
```

然后你可以投：

```
Permissions permissions = (Permissions) (int) dr["Field"] 
```

# css - 在固定高度的输入字段中垂直对齐文本而不显示：表格或填充？

> ID：326650
> 
> 赞同：78
> 
> 时间：2008-11-28T20:51:36.097
> 
> 标签：css, xhtml

line-height 属性通常负责垂直对齐，但不涉及输入。有没有办法在不使用填充的情况下自动居中文本？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-06-03T16:50:29.880

我自己遇到了这个问题。我发现不指定输入高度，而是使用组合的字体高度和填充，会导致垂直对齐的文本。

例如，假设您想要一个 42px 高的输入框，字体大小为 20px。您可以简单地找到输入高度和字体大小之间的差异，将其除以 2，然后将填充设置为该数量。在这种情况下，您将有 22px 的总内边距，即每边 11px。

```
<input type="text" style="padding: 11px 0px 11px 0px; font-size: 20px;" /> 
```

这会给你一个 42px 高的输入框，具有完美的垂直对齐。

希望有帮助。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-11-29T13:05:19.657

我自己没有尝试过，但尝试设置：

```
height : 36px; //for other browsers
line-height: 36px; // for IE 
```

其中 36px 是输入的高度。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-29T15:30:24.827

在 Opera 9.62、Mozilla 3.0.4、Safari 3.2（适用于 Windows）中，如果您在输入字段的同一行中放置一些文本或至少一个空格，它会有所帮助。

```
<div style="line-height: 60px; height: 60px; border: 1px solid black;">
    <input type="text" value="foo" />&nbsp;
</div> 
```

（想象在输入语句之后有一个  ）

IE 7 忽略了我尝试过的每一个 CSS hack。我建议仅对 IE 使用填充。如果它只需要在一个特定的浏览器中工作，应该会让你更容易正确定位它。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-08-18T22:21:35.970

我知道我参加聚会迟到了，但希望这会帮助任何寻找适用于所有主要浏览器的简洁答案的人（除了 IE6，我们决定停止支持该浏览器，所以我什至拒绝再看它了） .

```
 #search #searchbox {
    height: 21px;
    line-height: 21px;
} 
```

干杯！J.P

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-03-18T04:04:38.133

在我看来，这个页面上得票最多的答案是最好的答案，但他的数学是错误的，我无法评论它。

我需要一个文本输入框正好是 40 像素高，包括一个 1 像素的边框。当然，我希望文本在所有浏览器的中心垂直对齐。

1 像素边框顶部
1 像素边框底部
8 像素顶部填充
8 像素底部填充
22 像素字体大小

1 + 1 + 8 + 8 + 22 = 40 像素。

要记住的一件事是您必须删除您的 CSS 高度属性，否则这些像素将被添加到上面的总数中。

```
<input type="text" style="padding-top:8px; padding-bottom:8px; margin: 0; border: solid 1px #000000; font-size:22px;" /> 
```

这适用于 Firefox、Chrome、IE 8 和 Safari。我只能假设如果像这样简单的东西在 IE8 中工作，它应该在 6、7 和 9 中同样工作，但我还没有测试过。请让我知道，我会相应地编辑这篇文章。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-05-29T10:21:40.310

去`line-height`。

该`vertical-align`标记适用于提交按钮，但不适用于输入字段中的文本。设置`line-height`为输入字段的高度适用于所有浏览器。包括 IE7。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-17T22:43:30.810

在对文本输入字段使用固定高度（24px）背景图像时，经过多次搜索和挫折，设置高度、行高和无填充的组合对我有用。

```
.form-text {
    color: white;
    outline: none;
    background-image: url(input_text.png);
    border-width: 0px;
    padding: 0px 10px 0px 10px;
    margin: 0px;
    width: 274px;
    height: 24px;
    line-height: 24px;
    vertical-align: middle;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-07-01T08:42:36.760

```
input[type=text]
{
   height: 15px; 
   line-height: 15px;
} 
```

这是设置垂直中间位置的正确方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-18T05:36:31.997

只要不设置输入框的高度，只设置font-size就可以了

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-03-07T03:23:37.437

我就是这样做的。

```
<ul>
   <li>First group of text here.</li>
   <li><input type="" value="" /></li>
</ul> 
```

然后在你的 CSS 文件中，

```
ul li {
  display: block;
  float: left;
} 
```

那应该对你有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-10-11T14:08:37.683

尝试 ：

```
height: 21px;
line-height: 21px; /* FOR IE */ 
```

因为在某些版本的 IE (< 9) 上，属性 height 没有被正确解释。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-06-16T04:34:05.857

聚会迟到了，但是如果您设置了 box-sizing:border-box 集（现在很多人为表单元素这样做），那么当前的答案将不起作用。

只需重置 IE8 的框大小，`box-sizing: content-box;`然后使用填充/高度答案之一。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-02-09T14:58:07.050

内部垂直对齐将取决于字体高度和输入高度，因此可以使用填充进行调整！！！

尝试一些像：

```
.InVertAlign {
   height: 40px;
   line-height: 40px;
   font-size: 2em;
   padding: 0px 14px 3px 5px;
} 
```

...

```
<input type="text" class="InVertAlign" /> 
```

请记住根据您的需要调整 css 类的值！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-06-22T22:24:44.203

我只是在 MaterialUI 的文本输入中处理这个问题。添加`padding-top: 0.5rem`到输入样式对我有用。虽然这是在调整填充，但至少您不必担心调整更新，更不用说不同的断点了。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2013-09-15T19:36:22.577

您应该删除标题文本并使用输入占位符作为标签标题。之后进行一些视觉和 CSS 工作，您的表单将看起来紧凑且用户友好。我知道缺点，但这将完全缓解对齐摔跤。

* * *

## 回答 #16

> 赞同：-11
> 
> 时间：2011-06-27T01:40:53.910

如果您的元素是包含/或显示如下的块元素：

```
display: table-cel 
```

或者，使用固定的行高，您可以像这样设置垂直对齐：

```
Vertical-Align: Middle; 
```

它不适用于其他情况，但在这些情况下可以正常工作。

# php - 通过 SSL 的 php SOAP 调用 - 如何在请求中将证书、密钥和 CA 证书卡在一起？

> ID：326656
> 
> 赞同：0
> 
> 时间：2008-11-28T20:54:09.803
> 
> 标签：php, soap, ssl

所以，我正在尝试使用类似这样的东西来使用网络服务： $client = new SoapClient("some.wsdl", array('local_cert' => "cert_key.pem"));

过去，我使用其他需要将证书和密钥连接到 local_cert 文件中的 Web 服务成功地做到了这一点。现在，我正在尝试使用同样依赖于可信 CA 的服务。这是我正在使用的 J2EE（Axis）Web 服务，每次我尝试从托管该服务的团队那里获得意见时，他们都会告诉我这一定是 PHP 问题......

我从 SoapClient 调用中得到的响应始终是无法连接。我曾经遇到过 SSL 错误，但后来我意识到我使用了错误的服务器证书，所以现在我至少知道我在创建 SSL 调用的正确路径上。

我不知道如何确保 CA 证书包含在该 local_cert 文件中。我有我的服务器证书、我的服务器证书密钥和 CA 证书，但是是否有我在 local_cert 中连接它们的顺序？我完全错过了什么吗？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T00:58:20.133

根据我的经验，IIS 和 Apache 都不需要 CA 文件来验证 Web 服务的客户端证书。您只需指定 PEM 文件（并将其安装在 IIS 的本地存储中）。我会说你的代码看起来不错。当 SSL 由于某种身份验证原因失败时，您通常会收到 Forbidden 消息。表明您无法连接的错误可能涉及未打开的端口，例如用于 SSL 的端口 443。

# open-source - 是否有 Google AdWords 的 OSS 实现

> ID：326670
> 
> 赞同：3
> 
> 时间：2008-11-28T21:01:40.837
> 
> 标签：open-source, google-ads-api, pay-per-view

是否有 Google AdWords 的开源实现，或者该技术是否以某种方式受到保护（例如获得专利）？

编辑：澄清一下，我正在寻找类似 AdWords 系统的第 3 方实施（除了概念和表面相似性之外，它与 Google AdWords 无关）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T22:30:50.343

根据您希望复制的系统部分，您应该尝试一下[OpenX 广告服务器](http://www.openx.org/)。您可以将其安装在您自己的服务器上或使用他们的托管版本。还有其他开源广告服务器，但这个似乎运行良好。

# .net - 如何检测两个文件是否在同一个“卷”上？

> ID：326672
> 
> 赞同：2
> 
> 时间：2008-11-28T21:02:26.043
> 
> 标签：.net, windows

我正在尝试使用 System.IO.File.Replace 更新文件，如果目标文件在 NAS 上，它会抛出 System.IOException。

根据[MSDN](http://msdn.microsoft.com/en-us/library/9d9h163f(VS.80).aspx)，如果目标文件位于不同的卷上，则此方法会引发异常。没错，但是如何检测两个文件是否在“不同的卷”上？

如果我使用驱动器号、映射驱动器或 UNC 路径指定同一个文件，Path.GetPathRoot 将返回不同的字符串。我无法捕获 System.IOException，因为在多种情况下都会引发这种情况，而不仅仅是文件位于不同的卷上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T22:14:55.307

您可以使用“复制”和“替换”来确保替换始终在同一卷上。或者只是捕获错误并尝试它。

```
catch IOException
  File.Copy( src,dest+".tmp", true )
 File.Replace( dest+".tmp", dest, dest_backup ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T21:08:02.180

如果您有机会将文件放在不同的卷上，最好编写自己的简单复制例程，从一个流读取并写入另一个流。这可以处理跨卷副本，允许您捕获可能遇到的其他异常，并且实现起来非常简单。

# c# - HttpRuntime.Cache[] 与 Application[]

> ID：326675
> 
> 赞同：30
> 
> 时间：2008-11-28T21:04:36.180
> 
> 标签：c#, asp.net, caching, httpruntime.cache

我知道大多数人推荐使用 HttpRuntime.Cache 因为它具有更大的灵活性……等等。但是如果您希望对象在应用程序的整个生命周期内都保留在缓存中怎么办？使用 Application[] 对象来缓存东西有什么大的缺点吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-28T22:06:07.040

只要您不滥用应用程序状态，那么我认为将其用于您不想过期的项目没有问题。或者，我可能会在使用它的代码附近使用静态变量。这样`HttpApplicationState`，如果我想访问我的数据，您就可以避免通过然后被迫引用 System.Web。

但请务必考虑如何使用您存储的对象`HttpApplicationState`。如果它是一个`DataSet`你不断为每个请求添加东西的地方，那么在某些时候你最终会在网络服务器上消耗太多的内存。如果您`HttpApplicationState`在处理请求时继续添加项目，也会发生同样的情况，在某些时候您将强制应用程序重新启动。

这可能是在您的情况下使用 Cache 的优势。消耗大量内存并不那么致命，因为当内存变得稀缺时，您允许 ASP.NET 释放缓存中的项目。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-28T05:38:34.350

缓存已弃用应用程序。如果您需要具有应用程序范围的东西，那么您应该将其创建为类的静态成员或使用缓存。如果您想使用 Cache 路由但不希望它过期，则应在将值插入缓存时使用 CacheItemPriority.NotRemovable 选项。请注意，可以使用此优先级并仍然使用缓存依赖项，例如，如果您的数据依赖于文件系统中的某些内容。CacheItemPriority 所做的只是防止 HttpRuntime.Cache 在感到内存压力时智能地清除项目，并使用其最近最少使用的算法来清除没有太多使用的项目。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-28T22:14:15.573

当您希望项目自动过期或在内存不足时被回收时，请使用缓存。否则，如果可以，请使用静态变量，因为它们会产生比挖掘 ApplicationState 集合更好的性能。我不确定什么时候使用 ApplicationState，但肯定会有一些。

# algorithm - 为图形的 Y 轴选择有吸引力的线性比例

> ID：326679
> 
> 赞同：88
> 
> 时间：2008-11-28T21:06:10.233
> 
> 标签：algorithm, math, graph

我正在编写一些代码来在我们的软件中显示条形图（或线形图）。一切都很顺利。让我难过的是标记 Y 轴。

来电者可以告诉我他们想要标记 Y 刻度的精细程度，但我似乎被困在以“有吸引力”的方式标记它们的确切内容上。我无法形容“有吸引力”，也许你也不能，但我们一看到就知道，对吧？

因此，如果数据点是：

```
 15, 234, 140, 65, 90 
```

用户在 Y 轴上要求 10 个标签，用纸和铅笔稍微摸索得出：

```
 0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250 
```

所以那里有 10 个（不包括 0），最后一个超出最大值（234 < 250），每个 25 是一个“不错的”增量。如果他们要求 8 个标签，增加 30 个看起来不错：

```
 0, 30, 60, 90, 120, 150, 180, 210, 240 
```

九个会很棘手。也许只是使用了 8 或 10 并称它足够接近就可以了。当某些点为负数时该怎么办？

我可以看到 Excel 很好地解决了这个问题。

有谁知道解决这个问题的通用算法（即使是一些蛮力也可以）？我不必很快做，但它应该看起来不错。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-11-28T21:44:39.220

很久以前，我编写了一个很好地涵盖了这一点的图形模块。挖掘灰色块得到以下结果：

*   确定数据的下限和上限。（请注意下限 = 上限的特殊情况！
*   将范围划分为所需的刻度数。
*   将刻度范围向上舍入为合适的数量。
*   相应地调整下限和上限。

让我们举个例子：

```
15, 234, 140, 65, 90 with 10 ticks 
```

1.  下限 = 15
2.  上限 = 234
3.  范围 = 234-15 = 219
4.  刻度范围 = 21.9。这应该是 25.0
5.  新的下限 = 25 * round(15/25) = 0
6.  新上限 = 25 * 轮次 (1+235/25) = 250

所以范围 = 0,25,50,...,225,250

您可以通过以下步骤获得不错的刻度范围：

1.  除以 10^x 使得结果介于 0.1 和 1.0 之间（包括 0.1，不包括 1）。
2.  相应地翻译：
    *   0.1 -> 0.1
    *   <= 0.2 -> 0.2
    *   <= 0.25 -> 0.25
    *   <= 0.3 -> 0.3
    *   <= 0.4 -> 0.4
    *   <= 0.5 -> 0.5
    *   <= 0.6 -> 0.6
    *   <= 0.7 -> 0.7
    *   <= 0.75 -> 0.75
    *   <= 0.8 -> 0.8
    *   <= 0.9 -> 0.9
    *   <= 1.0 -> 1.0
3.  乘以 10^x。

在这种情况下，21.9 除以 10^2 得到 0.219。这是 <= 0.25，所以我们现在有 0.25。乘以 10^2 得到 25。

让我们看一下带有 8 个刻度的相同示例：

```
15, 234, 140, 65, 90 with 8 ticks 
```

1.  下限 = 15
2.  上限 = 234
3.  范围 = 234-15 = 219
4.  刻度范围 = 27.375
    1.  除以 10^2 得到 0.27375，转换为 0.3，得到（乘以 10^2）30。
5.  新的下限 = 30 * round(15/30) = 0
6.  新上限 = 30 * 轮次 (1+235/30) = 240

这给出了您要求的结果;-)。

------ 由 KD 添加 ------

这是在不使用查找表等的情况下实现此算法的代码......：

```
double range = ...;
int tickCount = ...;
double unroundedTickSize = range/(tickCount-1);
double x = Math.ceil(Math.log10(unroundedTickSize)-1);
double pow10x = Math.pow(10, x);
double roundedTickRange = Math.ceil(unroundedTickSize / pow10x) * pow10x;
return roundedTickRange; 
```

一般来说，刻度数包括底部刻度，因此实际的 y 轴段比刻度数少一。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-01-25T17:49:26.763

这是我正在使用的 PHP 示例。这个函数返回一个漂亮的 Y 轴值数组，其中包含传入的最小和最大 Y 值。当然，这个例程也可以用于 X 轴值。

它允许您“建议”您可能想要多少滴答声，但该例程将返回看起来不错的内容。我添加了一些示例数据并显示了这些结果。

```
#!/usr/bin/php -q
<?php

function makeYaxis($yMin, $yMax, $ticks = 10)
{
  // This routine creates the Y axis values for a graph.
  //
  // Calculate Min amd Max graphical labels and graph
  // increments.  The number of ticks defaults to
  // 10 which is the SUGGESTED value.  Any tick value
  // entered is used as a suggested value which is
  // adjusted to be a 'pretty' value.
  //
  // Output will be an array of the Y axis values that
  // encompass the Y values.
  $result = array();
  // If yMin and yMax are identical, then
  // adjust the yMin and yMax values to actually
  // make a graph. Also avoids division by zero errors.
  if($yMin == $yMax)
  {
    $yMin = $yMin - 10;   // some small value
    $yMax = $yMax + 10;   // some small value
  }
  // Determine Range
  $range = $yMax - $yMin;
  // Adjust ticks if needed
  if($ticks < 2)
    $ticks = 2;
  else if($ticks > 2)
    $ticks -= 2;
  // Get raw step value
  $tempStep = $range/$ticks;
  // Calculate pretty step value
  $mag = floor(log10($tempStep));
  $magPow = pow(10,$mag);
  $magMsd = (int)($tempStep/$magPow + 0.5);
  $stepSize = $magMsd*$magPow;

  // build Y label array.
  // Lower and upper bounds calculations
  $lb = $stepSize * floor($yMin/$stepSize);
  $ub = $stepSize * ceil(($yMax/$stepSize));
  // Build array
  $val = $lb;
  while(1)
  {
    $result[] = $val;
    $val += $stepSize;
    if($val > $ub)
      break;
  }
  return $result;
}

// Create some sample data for demonstration purposes
$yMin = 60;
$yMax = 330;
$scale =  makeYaxis($yMin, $yMax);
print_r($scale);

$scale = makeYaxis($yMin, $yMax,5);
print_r($scale);

$yMin = 60847326;
$yMax = 73425330;
$scale =  makeYaxis($yMin, $yMax);
print_r($scale);
?> 
```

样本数据的结果输出

```
# ./test1.php
Array
(
    [0] => 60
    [1] => 90
    [2] => 120
    [3] => 150
    [4] => 180
    [5] => 210
    [6] => 240
    [7] => 270
    [8] => 300
    [9] => 330
)

Array
(
    [0] => 0
    [1] => 90
    [2] => 180
    [3] => 270
    [4] => 360
)

Array
(
    [0] => 60000000
    [1] => 62000000
    [2] => 64000000
    [3] => 66000000
    [4] => 68000000
    [5] => 70000000
    [6] => 72000000
    [7] => 74000000
) 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-10-06T12:07:51.030

试试这个代码。我已经在一些图表场景中使用它并且效果很好。它也非常快。

```
public static class AxisUtil
{
    public static float CalculateStepSize(float range, float targetSteps)
    {
        // calculate an initial guess at step size
        float tempStep = range/targetSteps;

        // get the magnitude of the step size
        float mag = (float)Math.Floor(Math.Log10(tempStep));
        float magPow = (float)Math.Pow(10, mag);

        // calculate most significant digit of the new step size
        float magMsd = (int)(tempStep/magPow + 0.5);

        // promote the MSD to either 1, 2, or 5
        if (magMsd > 5.0)
            magMsd = 10.0f;
        else if (magMsd > 2.0)
            magMsd = 5.0f;
        else if (magMsd > 1.0)
            magMsd = 2.0f;

        return magMsd*magPow;
    }
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-28T21:33:08.540

听起来来电者没有告诉你它想要的范围。

因此，您可以自由更改端点，直到您的标签数可以很好地整除为止。

让我们定义“好”。如果标签关闭，我会打电话给：

```
1\. 2^n, for some integer n. eg. ..., .25, .5, 1, 2, 4, 8, 16, ...
2\. 10^n, for some integer n. eg. ..., .01, .1, 1, 10, 100
3\. n/5 == 0, for some positive integer n, eg, 5, 10, 15, 20, 25, ...
4\. n/2 == 0, for some positive integer n, eg, 2, 4, 6, 8, 10, 12, 14, ... 
```

找到数据系列的最大值和最小值。让我们称这些点为：

```
min_point and max_point. 
```

现在您需要做的就是找到 3 个值：

```
- start_label, where start_label < min_point and start_label is an integer
- end_label, where end_label > max_point and end_label is an integer
- label_offset, where label_offset is "nice" 
```

符合等式：

```
(end_label - start_label)/label_offset == label_count 
```

可能有很多解决方案，所以只选择一个。大多数时候我打赌你可以设置

```
start_label to 0 
```

所以只需尝试不同的整数

```
end_label 
```

直到偏移量“不错”

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-10T11:43:37.677

我仍在与此作斗争:)

最初的 Gamecat 答案似乎在大多数情况下都有效，但尝试插入说，“3 个滴答声”作为所需滴答声的数量（对于相同的数据值 15、234、140、65、90）......似乎给出的刻度范围为 73，除以 10^2 后得到 0.73，映射到 0.75，给出了 75 的“不错”刻度范围。

然后计算上限：75*round(1+234/75) = 300

下限：75 * round(15/75) = 0

但很明显，如果你从 0 开始，并以 75 的步长一直到 300 的上限，你最终会得到 0,75,150,225,300 ....这无疑是有用的，但它是 4 个刻度（不包括 0）而不是需要 3 个刻度。

只是令人沮丧的是它不能 100% 的工作......当然这很可能是我在某个地方的错误！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-04-02T11:49:59.917

[Toon Krijthe](https://stackoverflow.com/users/18061/toon-krijthe)的答案在大多数情况下确实有效。但有时它会产生过多的滴答声。它也不适用于负数。解决问题的总体方法是可以的，但有更好的方法来处理这个问题。您要使用的算法将取决于您真正想要得到的。下面我将向您展示我在 JS Ploting 库中使用的代码。我已经对其进行了测试，并且它始终有效（希望 ;) ）。以下是主要步骤：

*   获取全局极值 xMin 和 xMax（包括要在算法中打印的所有图）
*   计算 xMin 和 xMax 之间的范围
*   计算范围的数量级
*   通过将范围除以刻度数减一来计算刻度大小
*   这个是可选的。如果您希望始终打印零刻度，您可以使用刻度大小来计算正刻度和负刻度的数量。刻度的总数将是它们的总和 + 1（零刻度）
*   如果您始终打印零刻度，则不需要这个。计算下限和上限，但请记住将图居中

开始吧。首先是基本计算

```
 var range = Math.abs(xMax - xMin); //both can be negative
    var rangeOrder = Math.floor(Math.log10(range)) - 1; 
    var power10 = Math.pow(10, rangeOrder);
    var maxRound = (xMax > 0) ? Math.ceil(xMax / power10) : Math.floor(xMax / power10);
    var minRound = (xMin < 0) ? Math.floor(xMin / power10) : Math.ceil(xMin / power10); 
```

我将最小值和最大值四舍五入为 100%，确保我的绘图将涵盖所有数据。将范围的 log10 取底也很重要，无论它是否为负数，然后再减去 1。否则，您的算法将不适用于小于一的数字。

```
 var fullRange = Math.abs(maxRound - minRound);
    var tickSize = Math.ceil(fullRange / (this.XTickCount - 1));

    //You can set nice looking ticks if you want
    //You can find exemplary method below 
    tickSize = this.NiceLookingTick(tickSize);

    //Here you can write a method to determine if you need zero tick
    //You can find exemplary method below
    var isZeroNeeded = this.HasZeroTick(maxRound, minRound, tickSize); 
```

我使用“漂亮的刻度”来避免像 7、13、17 等刻度。我在这里使用的方法非常简单。在需要时使用 zeroTick 也很好。这样，情节看起来更专业。您将在此答案的末尾找到所有方法。

现在你必须计算上限和下限。这在零滴答时非常容易，但在其他情况下需要更多的努力。为什么？因为我们想很好地将图集中在上限和下限内。看看我的代码。一些变量是在这个范围之外定义的，其中一些是保存整个呈现代码的对象的属性。

```
 if (isZeroNeeded) {

        var positiveTicksCount = 0;
        var negativeTickCount = 0;

        if (maxRound != 0) {

            positiveTicksCount = Math.ceil(maxRound / tickSize);
            XUpperBound = tickSize * positiveTicksCount * power10;
        }

        if (minRound != 0) {
            negativeTickCount = Math.floor(minRound / tickSize);
            XLowerBound = tickSize * negativeTickCount * power10;
        }

        XTickRange = tickSize * power10;
        this.XTickCount = positiveTicksCount - negativeTickCount + 1;
    }
    else {
        var delta = (tickSize * (this.XTickCount - 1) - fullRange) / 2.0;

        if (delta % 1 == 0) {
            XUpperBound = maxRound + delta;
            XLowerBound = minRound - delta;
        }
        else {
            XUpperBound =  maxRound + Math.ceil(delta);
            XLowerBound =  minRound - Math.floor(delta);
        }

        XTickRange = tickSize * power10;
        XUpperBound = XUpperBound * power10;
        XLowerBound = XLowerBound * power10;
    } 
```

这是我之前提到的方法，您可以自己编写，但也可以使用我的

```
this.NiceLookingTick = function (tickSize) {

    var NiceArray = [1, 2, 2.5, 3, 4, 5, 10];

    var tickOrder = Math.floor(Math.log10(tickSize));
    var power10 = Math.pow(10, tickOrder);
    tickSize = tickSize / power10;

    var niceTick;
    var minDistance = 10;
    var index = 0;

    for (var i = 0; i < NiceArray.length; i++) {
        var dist = Math.abs(NiceArray[i] - tickSize);
        if (dist < minDistance) {
            minDistance = dist;
            index = i;
        }
    }

    return NiceArray[index] * power10;
}

this.HasZeroTick = function (maxRound, minRound, tickSize) {

    if (maxRound * minRound < 0)
    {
        return true;
    }
    else if (Math.abs(maxRound) < tickSize || Math.round(minRound) < tickSize) {

        return true;
    }
    else {

        return false;
    }
} 
```

这里只有一件事不包括在内。这是“好看的界限”。这些是与“漂亮的刻度”中的数字相似的数字的下限。例如，下限从 5 开始且刻度大小为 5 比从 6 开始且刻度大小相同的绘图要好。但这我被解雇了，我把它留给你。

希望能帮助到你。干杯!

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-03-13T21:00:50.553

将此[答案](https://stackoverflow.com/a/9007526/2670547)转换为**Swift 4**

```
extension Int {

    static func makeYaxis(yMin: Int, yMax: Int, ticks: Int = 10) -> [Int] {
        var yMin = yMin
        var yMax = yMax
        var ticks = ticks
        // This routine creates the Y axis values for a graph.
        //
        // Calculate Min amd Max graphical labels and graph
        // increments.  The number of ticks defaults to
        // 10 which is the SUGGESTED value.  Any tick value
        // entered is used as a suggested value which is
        // adjusted to be a 'pretty' value.
        //
        // Output will be an array of the Y axis values that
        // encompass the Y values.
        var result = [Int]()
        // If yMin and yMax are identical, then
        // adjust the yMin and yMax values to actually
        // make a graph. Also avoids division by zero errors.
        if yMin == yMax {
            yMin -= ticks   // some small value
            yMax += ticks   // some small value
        }
        // Determine Range
        let range = yMax - yMin
        // Adjust ticks if needed
        if ticks < 2 { ticks = 2 }
        else if ticks > 2 { ticks -= 2 }

        // Get raw step value
        let tempStep: CGFloat = CGFloat(range) / CGFloat(ticks)
        // Calculate pretty step value
        let mag = floor(log10(tempStep))
        let magPow = pow(10,mag)
        let magMsd = Int(tempStep / magPow + 0.5)
        let stepSize = magMsd * Int(magPow)

        // build Y label array.
        // Lower and upper bounds calculations
        let lb = stepSize * Int(yMin/stepSize)
        let ub = stepSize * Int(ceil(CGFloat(yMax)/CGFloat(stepSize)))
        // Build array
        var val = lb
        while true {
            result.append(val)
            val += stepSize
            if val > ub { break }
        }
        return result
    }

} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-07-01T16:59:10.693

这就像一个魅力，如果你想要 10 步 + 零

```
//get proper scale for y
$maximoyi_temp= max($institucion); //get max value from data array
 for ($i=10; $i< $maximoyi_temp; $i=($i*10)) {   
    if (($divisor = ($maximoyi_temp / $i)) < 2) break; //get which divisor will give a number between 1-2    
 } 
 $factor_d = $maximoyi_temp / $i;
 $factor_d = ceil($factor_d); //round up number to 2
 $maximoyi = $factor_d * $i; //get new max value for y
 if ( ($maximoyi/ $maximoyi_temp) > 2) $maximoyi = $maximoyi /2; //check if max value is too big, then split by 2 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-04T10:36:30.683

对于任何在 ES5 Javascript 中需要它的人来说，都有些挣扎，但这里是：

```
var min=52;
var max=173;
var actualHeight=500; // 500 pixels high graph

var tickCount =Math.round(actualHeight/100); 
// we want lines about every 100 pixels.

if(tickCount <3) tickCount =3; 
var range=Math.abs(max-min);
var unroundedTickSize = range/(tickCount-1);
var x = Math.ceil(Math.log10(unroundedTickSize)-1);
var pow10x = Math.pow(10, x);
var roundedTickRange = Math.ceil(unroundedTickSize / pow10x) * pow10x;
var min_rounded=roundedTickRange * Math.floor(min/roundedTickRange);
var max_rounded= roundedTickRange * Math.ceil(max/roundedTickRange);
var nr=tickCount;
var str="";
for(var x=min_rounded;x<=max_rounded;x+=roundedTickRange)
{
    str+=x+", ";
}
console.log("nice Y axis "+str); 
```

基于 Toon Krijtje 的出色回答。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-10-28T15:22:13.820

该解决方案基于我找到 的一个[Java 示例。](https://stackoverflow.com/a/16363437/1602301)

```
const niceScale = ( minPoint, maxPoint, maxTicks) => {
    const niceNum = ( localRange,  round) => {
        var exponent,fraction,niceFraction;
        exponent = Math.floor(Math.log10(localRange));
        fraction = localRange / Math.pow(10, exponent);
        if (round) {
            if (fraction < 1.5) niceFraction = 1;
            else if (fraction < 3) niceFraction = 2;
            else if (fraction < 7) niceFraction = 5;
            else niceFraction = 10;
        } else {
            if (fraction <= 1) niceFraction = 1;
            else if (fraction <= 2) niceFraction = 2;
            else if (fraction <= 5) niceFraction = 5;
            else niceFraction = 10;
        }
        return niceFraction * Math.pow(10, exponent);
    }
    const result = [];
    const range = niceNum(maxPoint - minPoint, false);
    const stepSize = niceNum(range / (maxTicks - 1), true);
    const lBound = Math.floor(minPoint / stepSize) * stepSize;
    const uBound = Math.ceil(maxPoint / stepSize) * stepSize;
    for(let i=lBound;i<=uBound;i+=stepSize) result.push(i);
    return result;
};
console.log(niceScale(15,234,6));
// > [0, 100, 200, 300]
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-12-21T11:26:01.103

基于@Gamecat的算法，我生成了以下帮助类

```
public struct Interval
{
    public readonly double Min, Max, TickRange;

    public static Interval Find(double min, double max, int tickCount, double padding = 0.05)
    {
        double range = max - min;
        max += range*padding;
        min -= range*padding;

        var attempts = new List<Interval>();
        for (int i = tickCount; i > tickCount / 2; --i)
            attempts.Add(new Interval(min, max, i));

        return attempts.MinBy(a => a.Max - a.Min);
    }

    private Interval(double min, double max, int tickCount)
    {
        var candidates = (min <= 0 && max >= 0 && tickCount <= 8) ? new[] {2, 2.5, 3, 4, 5, 7.5, 10} : new[] {2, 2.5, 5, 10};

        double unroundedTickSize = (max - min) / (tickCount - 1);
        double x = Math.Ceiling(Math.Log10(unroundedTickSize) - 1);
        double pow10X = Math.Pow(10, x);
        TickRange = RoundUp(unroundedTickSize/pow10X, candidates) * pow10X;
        Min = TickRange * Math.Floor(min / TickRange);
        Max = TickRange * Math.Ceiling(max / TickRange);
    }

    // 1 < scaled <= 10
    private static double RoundUp(double scaled, IEnumerable<double> candidates)
    {
        return candidates.First(candidate => scaled <= candidate);
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-09-30T12:08:08.357

上述算法没有考虑最小值和最大值之间的范围太小的情况。如果这些值远高于零怎么办？然后，我们有可能以高于零的值开始 y 轴。此外，为了避免我们的线完全位于图表的上方或下方，我们必须给它一些“呼吸的空气”。

为了涵盖这些情况，我（在 PHP 上）编写了上面的代码：

```
function calculateStartingPoint($min, $ticks, $times, $scale) {

    $starting_point = $min - floor((($ticks - $times) * $scale)/2);

    if ($starting_point < 0) {
        $starting_point = 0;
    } else {
        $starting_point = floor($starting_point / $scale) * $scale;
        $starting_point = ceil($starting_point / $scale) * $scale;
        $starting_point = round($starting_point / $scale) * $scale;
    }
    return $starting_point;
}

function calculateYaxis($min, $max, $ticks = 7)
{
    print "Min = " . $min . "\n";
    print "Max = " . $max . "\n";

    $range = $max - $min;
    $step = floor($range/$ticks);
    print "First step is " . $step . "\n";
    $available_steps = array(5, 10, 20, 25, 30, 40, 50, 100, 150, 200, 300, 400, 500);
    $distance = 1000;
    $scale = 0;

    foreach ($available_steps as $i) {
        if (($i - $step < $distance) && ($i - $step > 0)) {
            $distance = $i - $step;
            $scale = $i;
        }
    }

    print "Final scale step is " . $scale . "\n";

    $times = floor($range/$scale);
    print "range/scale = " . $times . "\n";

    print "floor(times/2) = " . floor($times/2) . "\n";

    $starting_point = calculateStartingPoint($min, $ticks, $times, $scale);

    if ($starting_point + ($ticks * $scale) < $max) {
        $ticks += 1;
    }

    print "starting_point = " . $starting_point . "\n";

    // result calculation
    $result = [];
    for ($x = 0; $x <= $ticks; $x++) {
        $result[] = $starting_point + ($x * $scale);
    }
    return $result;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-08-09T07:59:38.037

[已接受答案](https://stackoverflow.com/a/326746/4521081)的演示

```
function tickEvery(range, ticks) {
  return Math.ceil((range / ticks) / Math.pow(10, Math.ceil(Math.log10(range / ticks) - 1))) * Math.pow(10, Math.ceil(Math.log10(range / ticks) - 1));
}

function update() {
  const range = document.querySelector("#range").value;
  const ticks = document.querySelector("#ticks").value;
  const result = tickEvery(range, ticks);
  document.querySelector("#result").textContent = `With range ${range} and ${ticks} ticks, tick every ${result} for a total of ${Math.ceil(range / result)} ticks at ${new Array(Math.ceil(range / result)).fill(0).map((v, n) => Math.round(n * result)).join(", ")}`;
}

update();
```

```
<input id="range" min="1" max="10000" oninput="update()" style="width:100%" type="range" value="5000" width="40" />
<br/>
<input id="ticks" min="1" max="20" oninput="update()" type="range" style="width:100%" value="10" />
<p id="result" style="font-family:sans-serif"></p>
```

# algorithm - 让我的数学焕然一新的博客（在实践中）

> ID：326680
> 
> 赞同：20
> 
> 时间：2008-11-28T21:07:54.863
> 
> 标签：algorithm, math, blogs

我的问题，[他的问题](https://stackoverflow.com/questions/11743/useful-math-for-programmers)，但博客作为资源要具体。

我发现博客很适合跟上时代……刷新材料……

那么您知道任何解决与数学相关的编程问题的博客吗...

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-28T21:09:05.483

不完全符合您的要求，但[Project Euler](http://projecteuler.net/)*让我的*数学技能焕然一新。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-28T21:23:22.303

遵循[MIT 开放课件](http://ocw.mit.edu/OcwWeb/web/courses/visits/index.htm)是学习和练习这些技能的另一种基于计算机的好方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-28T21:35:33.887

[好数学，坏数学](http://scienceblogs.com/goodmath/)是我最喜欢的常规数学博客。

Steve Yegge 的博文[Math for Programmers](http://steve-yegge.blogspot.com/2006/03/math-for-programmers.html)对程序员理解数学的重要性给出了相当不错的概述。

我也喜欢关注[数学版块](http://www.reddit.com/r/math)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-28T22:49:07.343

[Better Explained](http://betterexplained.com/)有[几篇好文章](http://betterexplained.com/articles/category/math/)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-29T00:27:43.710

如果您想对与计算机科学相关的数学进行高度清晰的解释和讨论，那么这个博客，[为开发人员开发](http://blogs.msdn.com/devdev/)，非常棒。【好久没发帖了，以前的帖子都不错。】

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-28T21:18:04.267

[这个博客](http://blog.plover.com/)有一些有趣的数学相关的东西。其中一些是相当高级的。你已经被警告过了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-28T21:27:13.827

不完全是博客，而是：[美国数学会的通知](http://www.ams.org/notices/200811/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-28T22:18:26.763

[我在The Endeavor](http://www.johndcook.com/blog)写了关于编程和数学的博客，尤其是概率和统计。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T16:05:45.340

好问题，我很惊讶到目前为止没有人提到维基百科。但是，许多文章，尤其是关于高等数学的文章都是由专家撰写的，而且细节过多，如果你只是想学一点，这并不理想。但是维基百科仍然是我经常用来查找数学问题的东西。

当涉及到特定的数学主题时，您可能还想读一本书.. ;)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-29T03:49:47.687

[MathPuzzle](http://www.mathpuzzle.com/)是我最喜欢的数学网站之一。它似乎与解决问题没有直接关系，但游戏是一种极好的学习方式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-28T21:49:46.527

它有时会偏离正题，但这个家伙经常写关于数学软件的博客

[www.walkingrandomly.com](http://www.walkingrandomly.com)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-28T22:15:19.640

与[Project Euler](http://projecteuler.net/)相比，[William Wu](http://www.ocf.berkeley.edu/~wwu/riddles/intro.shtml)更接近于 Project Euler，他面临着许多数学和 CS 挑战。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-03T11:07:32.170

[This Weeks Finds in Mathematical Physics](http://math.ucr.edu/home/baez/TWF.html)非常值得一看，但它是否是数学取决于你在哪里画出边界。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-28T22:34:23.427

在stackoverflow的帮助下找到了这个...... :)

[关联](http://www.math.princeton.edu/~wwong/blog/MAT.shtml)

在你喝第一杯咖啡之前，我想...

# inheritance - 继承、父子和覆盖

> ID：326686
> 
> 赞同：1
> 
> 时间：2008-11-28T21:09:30.803
> 
> 标签：inheritance, overriding, parent-child

刚刚在我正在阅读的一本关于 OOP 的书中看到这句话，

> 只允许孩子增加功能和添加功能。永远不允许孩子删除功能。如果您确实发现子项需要删除功能，这表明子项应该在继承层次结构中出现在父项之前！

但我的问题是，这不是压倒一切吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T21:13:40.390

您可以通过覆盖删除功能。但通常你用它来改变行为。让班级按应有的方式行事。

如果行为被删除，那么它通常是一个糟糕的类设计的标志。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T21:15:21.307

孩子不能删除功能——它可以改变它，但你不能，比如说，将公共方法设为私有。

继承的重点是您可以像处理父级一样处理子级。如果您有一个“Person”超类和一个“Employee”子类，那么 Employee 类没有 Breath() 方法是没有意义的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T21:14:16.753

覆盖方法时，可以在覆盖期间的某个时刻调用父实现，因此使用覆盖向父实现添加功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T21:19:34.620

不。实际上你会增加功能（以消极的方式）

假设您的新功能是“什么都不做”，但方法是，您的代码的*客户端*看到的仍然是相同的*界面*

您不能拥有删除其父方法的子类。

这个有可能

```
class Parent {
    public void method_one(){ 
        print "Hello";
    }
}

class Child extends Parent {
     public void method_one(){
         // do nothing
     }
 } 
```

但这不是：

```
class Parent {
    public void method_one(){ 
        print "Hello";
    }
}

class Child extends Parent {
     // Attempt remove the method visibility, thus remove funcionality 
     private void method_one(){ 
         // do nothing
     }
 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-28T21:15:21.727

这就是为什么重写（通常是任何虚拟成员）应该非常小心地完成的原因......事实上，通常，在重写时，您应该尝试同时编写基类和派生类，以便派生类实现首先调用基实现，然后执行它的附加功能......

但是这个原则并没有在 OO 语言中强制执行，并且经常被违反......

为什么这不好的例子

假设您有 CompanyA 设计的类型（类）电话

```
namespace CompanyA {
   class Phone {
       public void Dial() {
        // do work to dial the phone here
       }
   }
} 
```

没有 iagine 公司 B 定义了另一种类型 BetterPhone，它使用公司 A 的电话作为基本类型......

```
namespace CompanyB {
   class BetterPhone: CompanyA.Phone {
       public void Dial()  {
           Console.WriteLine("BetterPhoneDial");
           EstablishConenction();
           base.Dial();
       }
   }
} 
```

现在 CompanyA，其 Phone 类正在被其他公司（公司 C、D 等）使用，决定建立连接是该类中有用的东西，并修改 CompanyA.Phone，同时添加 EsatblishCONnection() 方法，也许有不同的实现......在我们有了“new”关键字之前，这种情况会破坏 CompanyB 的 BetterPhone 类......当他们第一次尝试使用新的基类时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-24T09:15:44.120

如果您的孩子需要删除父级的功能，则必须将父级声明为接口。因为接口是定义必须由其实现者遵守的契约的机制。

例如

```
 public interface IContract
{
  void DoWork();
}

public class BaseContract: IContract
{
 public virtual void DoWork()
 {
  //perform operation A
 }
} 

```

现在，如果您想声明新的 EnhancedContract 类，您可以根据要求从 BaseContract 或 IContract 派生它。如果你想对base的操作A做额外的操作，你可以从BaseContract继承它，如下所示。

```
 public class EnhancedContract: BaseContract
{
  public override void DoWork()
  {
   //perform operation B
   base.DoWork();
   //perform operation C
  }
} 

```

但是如果你对EnhancedContract的DoWork方法中的操作A不感兴趣，那么从IContract继承它。

这确保了 EnhancedWork 将执行 DoWork()，但不能保证在其中执行“操作 A”。

```
 public class EnhancedWork:IContract
{
  public void DoWork()
  {
   //perform operation D
  }
} 

```

这对于理解很重要，因为它会阻止用户进行以下投射。

```
 EnhancedContract e = new EnhancedContract();
BaseContract b = e; 

```

我相信所有这些操作在理解[Open Closed 原则](http://msdn.microsoft.com/en-us/magazine/cc546578.aspx)，[Liskov 替换原则](http://www.objectmentor.com/resources/articles/lsp.pdf)时都很重要。

继承的经验法则是“将附加功能放入现有功能中”。

# java - Eclipse 调试时类路径问题：如何将依赖项目的输出包含到 Web 项目的运行时类路径中？

> ID：326689
> 
> 赞同：10
> 
> 时间：2008-11-28T21:11:01.470
> 
> 标签：java, eclipse, eclipse-wtp

因此，我从一个从 Eclipse 正确构建和调试的 Web 服务项目（只是一个动态 Web 项目）开始。我们已经提取了一大块想要放入共享库的通用代码，所以现在这些类将进入 Web 项目引用的单独 jar 项目中。

在 web 项目上，我做了 Project->Properties->Java Build Path->Projects->Add 并添加了 jar 项目。这正确地解决了所有编译时类路径问题，并且一切正常。但是在运行时，当 tomcat 服务器启动时，spring 尝试注入 jar 文件中包含的一些类，我得到一个 NoClassDefFoundError。

我的 .class 和属性文件以及 META-INF 目录的内容显示在 ./build 目录中，但我的 WEB-INF/lib 目录似乎被就地引用，并且 jar 依赖项没有被复制在其中显示为 Web 应用程序库的一部分。

告诉eclipse另一个jar项目需要在运行时对tomcat可用的神奇咒语是什么？从我们的 ant 构建脚本中，我们首先将另一个项目构建到 WEB-INF/lib 中，一切正常，但不适用于 Eclipse 调试。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-10-26T19:51:56.343

我花了一些时间后才弄清楚这一点。如果您在 Eclipse Helios 中，请转到`properties > deployment assembly > add > project`并选择您要添加的依赖项目。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-28T21:44:43.853

Java EE 模块依赖可以解决这个问题。您已经完成了将公共类提取到自己的项目中的任务，**可能是**因为其他项目依赖于这些类。无论哪种方式，您都必须确保这是一个实用程序项目（出现在项目向导中的 Java EE 下），而不仅仅是一个普通的 Java 项目。完成后，您可以继续将 Utility 项目添加到您的构建路径（编译时路径），如您所想。

额外的（最后）步骤是在您的动态 Web 项目和共享库之间建立 Java EE 模块依赖关系，这会导致实用程序的类在部署期间放置在 WEB-INF\lib 中，甚至在 WAR 导出期间。为此，请访问动态 Web 项目的属性，并浏览到 Java EE 模块依赖项。确保在此处选择您的实用程序项目。重新部署/发布您的应用程序，您应该一切顺利。

# nunit - 你可以在网络表单中使用 NUnit 模拟请求吗？

> ID：326692
> 
> 赞同：1
> 
> 时间：2008-11-28T21:12:12.593
> 
> 标签：nunit

你能用 NUnit 和 webforms 做模拟页面请求吗？

Web服务测试呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T21:20:39.830

TypeMock 的[Ivonna](http://www.paraesthesia.com/archive/2008/04/16/asp.net-testing-with-ivonna.aspx)插件可以提供帮助。

# security - 散列密码和加密密码之间的区别

> ID：326699
> 
> 赞同：157
> 
> 时间：2008-11-28T21:14:57.050
> 
> 标签：security, language-agnostic, encryption, hash, passwords

当前[对该问题](https://stackoverflow.com/questions/325862/what-are-the-most-common-security-mistakes-programmers-make)的最高投票者指出：

> 另一个不是安全问题的问题，尽管它与安全相关，但完全无法**理解散列密码和加密密码之间的区别**。最常见于程序员试图提供不安全的“提醒我的密码”功能的代码中。

这个区别到底是什么？我一直认为散列是一种加密形式。张贴者所指的不安全功能是什么？

* * *

## 回答 #1

> 赞同：239
> 
> 时间：2008-11-28T21:16:48.603

散列是一种单向函数（嗯，映射）。这是不可逆的，您应用了安全哈希算法，您无法取回原始字符串。您最多可以做的是生成所谓的“冲突”，即找到提供相同哈希的不同字符串。密码安全散列算法旨在防止发生冲突。您可以通过使用[彩虹表来攻击安全哈希，您可以通过在存储之前对哈希应用](http://en.wikipedia.org/wiki/Rainbow_table)[盐](http://en.wikipedia.org/wiki/Salt_(cryptography))来抵消它。

加密是一种适当的（两种方式）功能。它是可逆的，如果您有密钥，您可以解密损坏的字符串以获得原始字符串。

它所指的不安全功能是，如果您对密码进行加密，您的应用程序会将密钥存储在某处，并且可以访问您的数据库（和/或代码）的攻击者可以通过获取密钥和加密文本来获取原始密码，而使用哈希是不可能的。

人们通常说，如果破解者拥有您的数据库或您的代码，他就不需要密码，因此差别不大。这是幼稚的，因为您仍然有责任保护用户的密码，主要是因为他们中的大多数人确实一遍又一遍地使用相同的密码，从而使他们因泄露密码而面临更大的风险。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-11-28T21:17:03.910

散列是一种单向函数，这意味着一旦对密码进行散列，就*很难*从散列中取回原始密码。加密是一种双向功能，从加密文本中获取原始文本要容易得多。

使用字典攻击很容易击败普通散列，攻击者只需对字典中的每个单词（或达到一定长度的每个字符组合）进行预散列，然后使用这个新字典查找散列密码。为存储的每个散列密码使用唯一的随机盐会使攻击者更难使用此方法。他们基本上需要为您使用的每个盐值创建一个新的唯一字典，从而大大减慢他们的攻击速度。

使用加密算法存储密码是不安全的，因为如果用户或管理员更容易从加密文本中获取原始密码，那么攻击者也更容易这样做。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2013-11-04T10:12:16.377

![加密密码与散列密码](https://i.stack.imgur.com/TNdb1.png)

如上图所示，如果密码被加密，它总是一个隐藏的秘密，有人可以从中提取明文密码。但是，当密码被散列时，您会很放松，因为几乎没有任何方法可以从散列值中恢复密码。

* * *

[从加密密码和散列密码中](http://www.digizol.com/2011/09/encrypted-vs-hashed-passwords-better.html)提取- 哪个更好？

## 加密好不好？

纯文本密码可以使用对称加密算法（如 DES、AES）或任何其他算法进行加密，并存储在数据库中。在身份验证时（通过用户名和密码确认身份），应用程序将解密存储在数据库中的加密密码，并与用户提供的密码进行比较是否相等。在这种类型的密码处理方法中，即使有人可以访问数据库表，密码也不会简单地重复使用。然而，这种方法也有一个坏消息。如果有人以某种方式获得了加密算法以及您的应用程序使用的密钥，他/她将能够通过解密查看存储在您的数据库中的所有用户密码。“这是我得到的最佳选择”，软件开发人员可能会尖叫，但有没有更好的方法？

## 加密哈希函数（单向）

是的，有可能是你错过了这里的重点。您是否注意到不需要解密和比较？如果有一种单向转换方法，可以将密码转换为某个转换字，但反向操作（从转换字生成密码）是不可能的。现在，即使有人可以访问数据库，也无法使用转换后的单词来复制或提取密码。在这种方法中，几乎不会有人知道您的用户的绝密密码；这将保护在多个应用程序中使用相同密码的用户。这种方法可以使用哪些算法？

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-28T21:17:50.770

我一直认为加密可以双向转换，最终值可以将您带到原始值，而使用散列，您将无法从最终结果恢复到原始值。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-28T21:20:22.357

散列算法本质上通常是加密的，但主要区别在于加密通过解密是可逆的，而散列不是。

加密函数通常接受输入并产生相同或稍大大小的加密输出。

散列函数接受输入并产生通常较小的输出，通常也是固定大小的。

虽然不可能获取散列结果并对其“去散列”以取回原始输入，但您通常可以暴力破解产生相同散列的东西。

换句话说，如果身份验证方案采用密码，对其进行哈希处理，并将其与所需密码的哈希版本进行比较，则可能不需要您实际知道原始密码，只知道其哈希值，并且您可以暴力破解即使密码不同，您也可以找到匹配的东西。

通常创建散列函数是为了最大限度地减少冲突的机会，并使仅计算会产生与其他事物相同散列的事物变得困难。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-09-11T17:40:00.950

**哈希**：

它是一种单向算法，一旦散列就不能回滚，这是它对抗加密的最佳点。

**加密**

如果我们执行加密，将有一个密钥来执行此操作。如果此密钥泄露，您的所有密码都可以轻松解密。

另一方面，即使您的数据库被黑客入侵，或者您的服务器管理员从数据库中获取数据并且您使用了散列密码，黑客也无法破解这些散列密码。如果我们使用带有适当盐的散列和 PBKDF2 的额外安全性，这实际上是不可能的。

如果你想看看你应该如何编写你的哈希函数，你可以访问[这里](https://github.com/rahulgarg1985/CodeNode/blob/master/CodeNode.Core/Utils/Hasher.cs)。

有许多算法可以执行散列。

1.  **MD5** - 使用消息摘要算法 5 (MD5) 散列函数。输出哈希的长度为 128 位。MD5 算法是由 Ron Rivest 在 1990 年代初设计的，现在不是首选方案。

2.  **SHA1** - 使用 1995 年发布的安全散列算法 (SHA1) 散列。输出散列长度为 160 位。尽管使用最广泛，但这并不是今天的首选。

3.  **HMACSHA256**、**HMACSHA384**、**HMACSHA512** - 使用 SHA-2 系列的函数 SHA-256、SHA-384 和 SHA-512。SHA-2 于 2001 年发布。如哈希函数名称所示，输出哈希长度分别为 256、384 和 512 位。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-07-22T13:38:04.097

理想情况下，您应该两者都做。

首先散列通行证密码以实现单向安全性。使用盐以增加安全性。

如果您的密码哈希数据库遭到破坏，然后加密哈希以防御字典攻击。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-28T21:29:51.590

与其他答案一样正确，在引用所在的上下文中，散列是一种可用于保护信息的工具，加密是一个获取信息的过程，使未经授权的人很难阅读/使用。

* * *

## 回答 #9

> 赞同：-10
> 
> 时间：2012-12-10T13:50:16.537

这是您可能想要使用其中一个而不是另一个的原因之一 - 密码检索。

如果您只存储用户密码的哈希值，则无法提供“忘记密码”功能。

# javascript - 在 HTML 中嵌入标签 - 我如何在 Javascript 中知道 .wav 文件已播放完毕？

> ID：326719
> 
> 赞同：2
> 
> 时间：2008-11-28T21:22:49.437
> 
> 标签：javascript, html, events, audio, embed

现在我正在尝试向网页添加一个按钮，按下该按钮将通过向 DOM 动态添加嵌入标签来开始播放 .wav 文件。声音播放时文本切换到“停止”，我希望能够在文件完成播放后自动将其切换回“播放”。

文件完成后如何自动执行一些Javascript？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T21:37:48.953

我会将声音包装在一个非常简单的 Flash 电影中，并在最后使用 actionscript 触发一个 javascript 函数。

以下是开源 flash ide 列表：http: [//osflash.org/open_source_flash_projects](http://osflash.org/open_source_flash_projects)

（这就是google在gmail中的做法）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-15T12:01:20.460

为 jQuery使用[jPlayer](http://www.happyworm.com/jquery/jplayer/ "播放器")，它有一个[在声音播放完毕时触发的事件](http://www.happyworm.com/jquery/jplayer/0.2.5/developer-guide.htm#jPlayer-onSoundComplete)。

需要客户端 Flash，但即使启用了我的 Firefox Flash 阻止程序，第一个 Flash 播放器也能正常工作。

他们已经建立了几个演示播放器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T21:36:06.803

如果您要嵌入播放器来播放文件（而不是只允许浏览器尝试自行决定使用什么（QT、WMP 等）），那么播放器应该有自己的事件可以挂钩。这取决于您使用的播放器。

# cocoa - NSApplication 委托和首选项窗格

> ID：326754
> 
> 赞同：0
> 
> 时间：2008-11-28T21:53:18.360
> 
> 标签：cocoa, macos, delegates

似乎我无法从系统偏好设置窗格中控制 NSApp 委托，这是可以理解的。有没有其他方法可以在程序激活时通知我的对象？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-28T23:16:19.860

Cocoa 框架中的大多数委托方法都是简单的通知方法。这包括`application{Will,Did}{Become,Resign}Active:`，它们是 的通知方法`NSApplication{Will,Did}{Become,Resign}ActiveNotification`。通知与委托方法位于同一位置：[NSApplication 文档](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/doc/uid/20000012-BAJJDFEC)。

因此，只需在本地注册这些通知`NSNotificationCenter`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T22:11:13.800

NSPreferencePane 为您提供了一些您可以覆盖以响应更改的方法。特别是，`mainViewDidLoad:`当您的首选项窗格第一次变为活动状态时，您有机会进行初始化。

如果您实际上是想跟踪系统偏好设置窗口何时成为主窗口或关键窗口，您可以订阅 NSWindow 的这些事件的通知。

```
//  These messages get sent to the a preference panel just before and
//  just after it becomes the currently selected preference panel.
- (void) willSelect;
- (void) didSelect;

//  The willUnselect message gets sent to the currently selected preference panel
//  just before and just after it gets swapped out for another preference panel
- (void) willUnselect;
- (void) didUnselect; 
```

# c# - 如何在循环中更新 C# 哈希表？

> ID：326757
> 
> 赞同：11
> 
> 时间：2008-11-28T21:58:46.850
> 
> 标签：c#, data-structures, loops, hashtable

我正在尝试在循环中更新哈希表，但出现错误： System.InvalidOperationException: Collection was modified; 枚举操作可能无法执行。

```
private Hashtable htSettings_m = new Hashtable();
htSettings_m.Add("SizeWidth", "728");
htSettings_m.Add("SizeHeight", "450");
string sKey = "";
string sValue = "";
foreach (DictionaryEntry deEntry in htSettings_m)
{
    // Get value from Registry and assign to sValue.
    // ...
    // Change value in hashtable.
    sKey = deEntry.Key.ToString();
    htSettings_m[sKey] = sValue;
} 
```

有没有办法解决它，或者可能有更好的数据结构来实现这个目的？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-28T22:10:37.420

您可以先将键集合读入另一个 IEnumerable 实例，然后在该列表上进行 foreach

```
 System.Collections.Hashtable ht = new System.Collections.Hashtable();

        ht.Add("test1", "test2");
        ht.Add("test3", "test4");

        List<string> keys = new List<string>();
        foreach (System.Collections.DictionaryEntry de in ht)
            keys.Add(de.Key.ToString());

        foreach(string key in keys)
        {
            ht[key] = DateTime.Now;
            Console.WriteLine(ht[key]);
        } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T22:06:47.553

在概念上我会这样做：

```
Hashtable table = new Hashtable(); // ps, I would prefer the generic dictionary..
Hashtable updates = new Hashtable();

foreach (DictionaryEntry entry in table)
{
   // logic if something needs to change or nog
   if (needsUpdate)
   {
      updates.Add(key, newValue);
   }
}

// now do the actual update
foreach (DictionaryEntry upd in updates)
{
   table[upd.Key] = upd.Value;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T04:23:50.427

如果您使用 Dictionary 而不是 Hashtable，以便知道键的类型，则复制 Keys 集合以避免此异常的最简单方法是：

```
foreach (string key in new List<string>(dictionary.Keys)) 
```

为什么你得到一个异常告诉你你已经修改了你正在迭代的集合，而实际上你没有？

在内部，Hashtable 类有一个版本字段。Add、Insert 和 Remove 方法会增加此版本。在 Hashtable 公开的任何集合上创建枚举器时，枚举器对象包括 Hashtable 的当前版本。枚举器的 MoveNext 方法检查枚举器的版本与 Hashtable 的版本，如果它们不相等，它会抛出您看到的 InvalidOperationException。

这是一种非常简单的机制，用于确定 Hashtable 是否已被修改。事实上，这有点太简单了。Keys 集合确实应该维护自己的版本，它的 GetEnumerator 方法应该将集合的版本保存在枚举器中，而不是 Hashtable 的版本。

这种方法还有另一个更微妙的设计缺陷。版本是 Int32。UpdateVersion 方法不进行边界检查。因此，如果您对 Hashtable 进行了正确数量的修改（2 次`Int32.MaxValue`，给予或接受），那么即使您在创建 Hashtable 后从根本上更改了 Hashtable，也有可能使 Hashtable 上的版本和枚举数相同。枚举器。因此，即使 MoveNext 方法应该抛出异常，它也不会抛出异常，您会得到意想不到的结果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-28T22:15:10.670

最简单的方法是将键复制到单独的集合中，然后对其进行迭代。

您使用的是 .NET 3.5 吗？如果是这样，LINQ 会让事情变得更容易一些。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-19T11:23:24.010

关键部分是**ToArray()**方法

```
var dictionary = new Dictionary<string, string>();
foreach(var key in dictionary.Keys.ToArray())
{
    dictionary[key] = "new value";
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T22:06:28.927

在枚举集合时，您不能更改存储在集合中的项目集，因为在大多数情况下，这会使迭代器变得非常困难。考虑集合代表一棵平衡树的情况，并且在插入后很可能会经历旋转。枚举将没有合理的方法来跟踪它所看到的内容。

但是，如果您只是尝试更新值，那么您可以编写：

```
deEntry.Value = sValue 
```

在此处更新值对枚举器没有影响。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-28T22:13:41.203

这取决于您为什么要遍历哈希表中的项目。但是您可能可以遍历键。所以

```
foreach (String sKey in htSettings_m.Keys)
{   // Get value from Registry and assign to sValue.
    // ...    
    // Change value in hashtable.
    htSettings_m[sKey] = sValue;
} 
```

另一种选择是创建一个新的 HashTable。迭代第一个，同时将项目添加到第二个，然后用新的替换原来的。
不过，遍历键需要较少的对象分配。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-12T18:25:05.927

这就是我在字典中的做法；将 dict 中的每个值重置为 false：

```
Dictionary<string,bool> dict = new Dictionary<string,bool>();

for (int i = 0; i < dict.Count; i++)
{
    string key = dict.ElementAt(i).Key;
    dict[key] = false;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-03-29T18:44:57.867

```
List<string> keyList = htSettings_m.Keys.Cast<string>().ToList();
foreach (string key in keyList) { 
```

它与其他答案相同，但我喜欢一行来获取密钥。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-03-11T19:59:22.410

将其转换为数组：

```
private Hashtable htSettings_m = new Hashtable();
htSettings_m.Add("SizeWidth", "728");
htSettings_m.Add("SizeHeight", "450");
string sKey = "";
string sValue = "";

ArrayList htSettings_ary = new ArrayList(htSettings_m.Keys)
foreach (DictionaryEntry deEntry in htSettings_ary)
{
    // Get value from Registry and assign to sValue.
    // ...
    // Change value in hashtable.
    sKey = deEntry.Key.ToString();
    htSettings_m[sKey] = sValue;
} 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-11-28T22:11:12.957

```
private Hashtable htSettings_m = new Hashtable();

htSettings_m.Add("SizeWidth", "728");    
htSettings_m.Add("SizeHeight", "450");    
string sValue = "";    
foreach (string sKey in htSettings_m.Keys)    
{    
    // Get value from Registry and assign to sValue    
    // ...    
    // Change value in hashtable.    
    htSettings_m[sKey] = sValue;    
} 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2008-11-28T22:10:11.133

也许您可以使用 Hashtable.Keys 集合？在更改 Hashtable 时，可能可以进行枚举。但这只是猜测...

# ruby-on-rails - 访问 has_many 关系时指定订单和限制的快捷方式？

> ID：326764
> 
> 赞同：3
> 
> 时间：2008-11-28T22:04:54.500
> 
> 标签：ruby-on-rails, activerecord

在 ActiveRecord 模型中访问 has_many 关系时，是否有提供限制和订单的快捷方式？

例如，这是我想表达的：

```
@user.posts(:limit => 5, :order => "title") 
```

与更长的版本相反：

```
Post.find(:all, :limit => 5, :order => "title", :conditions => ['user_id = ?', @user.id]) 
```

我知道您可以直接在 has_many 关系中指定它，但有没有办法即时执行，例如在一个页面上显示 10 个帖子，但在另一个页面上只显示 3 个？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-28T22:19:33.113

我在博客模型中有类似的东西：

```
 has_many :posts, :class_name => "BlogPost", :foreign_key => "owner_id",
    :order => "items.published_at desc", :include => [:creator] do
      def recent(limit=3)
        find(:all, :limit => limit, :order => "items.published_at desc")
      end
  end 
```

用法：

```
Blog.posts.recent 
```

或者

```
Blog.posts.recent(5) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T19:09:10.483

您可以使用 post 模型上的命名范围来执行此操作：

```
class Post < ActiveRecord::Base
  named_scope :limited, lambda {|*num| {:limit => num.empty? ? DEFAULT_LIMIT : num.first}}
end 
```

正如@Milan 所报告的，这本质上类似于utility_scopes，除了你只在需要的地方做零碎的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T23:14:42.283

您可以使用 Ryan Daigle 的[utility_scopes](http://github.com/yfactorial/utility_scopes/tree/master)。安装后（它是一个 gem），您将获得一些新的有用范围，例如：

```
@user.posts.ordered('title ASC').limited(5) 
```

您甚至可以为任何模型设置默认顺序和限制。

# php - 对象中的 PHP 数组转换为字符串（据我所知）

> ID：326769
> 
> 赞同：0
> 
> 时间：2008-11-28T22:07:07.567
> 
> 标签：php, debugging

我正在为 Web 应用程序开发前端代码，但在使用自定义对象时遇到了一个奇怪的问题。当我请求对象并使用时，`print_r()`我得到了这个（对象要大得多；只需将其剪切为相关代码）：

```
MemberInfo Object
(
    [meta_data] => Array
    (
        [email_recommendations] => true
        [email_updates] => false
    )
) 
```

要更改 MemberInfo 对象中的某些内容，我只需更新其属性并使用第二个函数将其发送回后端。例如，页面被加载一次（这给了我们上面显示的对象），然后我发送一个 POST 请求，并在第二次加载页面时进行更改。在第二次加载期间，我获取上面的对象，根据 POST 设置一个不同的字段`$memberInfo->meta_data['email_recommendations'] = 'false';`，然后在运行更新函数（类似于`updateMember($memberInfo);`）后使用该版本的对象来填充页面。但是，一旦我更改了对象属性值，`print_r()`就会向我展示一些不同的东西：

```
MemberInfo Object
(
    [meta_data] => {\"email_recommendations\":\"false\",\"email_updates\":\"false\"}

) 
```

我确定我忽略了一些非常愚蠢的事情；有人知道我应该寻找什么吗？我检查了一下，后端代码没有通过引用传递（函数调用是`updateMember(MemberInfo $memberInfo);`），但我的 PHP 5 对象处理有点不稳定，所以我不确定可能出了什么问题。

我不指望深入调试；我只需要知道我应该寻找的总体方向是什么导致属性发生这种变化，该属性应该是一个数组。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T22:25:36.203

那么你在调用后使用该对象`updateMember()`吗？PHP5 对象默认通过引用传递，因此如果您调用`json_encode()`该`meta_data`属性，它将表现出您描述的行为。

您可能想发布该`updateMember()`功能以确认，但听起来就是这样。

IE：

```
class MemberInfo {
    function __construct()  {
        $this->meta_data = array(
            'email_recommendations' => true,
            'email_updates' => false,
        );
    } 
}

function updateMember($meminfo) {
    $meminfo->meta_data = json_encode($meminfo->meta_data);
    // do stuff
}

$meminfo = new MemberInfo();

updateMember($meminfo);

print_r($meminfo); // you'll see the json encoded value for "meta_data" 
```

# python - 如何从当前的 python 模块动态获取类集？

> ID：326770
> 
> 赞同：5
> 
> 时间：2008-11-28T22:07:18.863
> 
> 标签：python, reflection, metaprogramming

我有一个 python 模块，它定义了许多类：

```
class A(object):
    def __call__(self):
        print "ran a"

class B(object):
    def __call__(self):
        print "ran b"

class C(object):
    def __call__(self):
        print "ran c" 
```

从模块中，我如何添加一个属性来给我所有的类？

dir() 为我提供了模块内所有内容的名称，但我似乎无法弄清楚如何从模块*内*的类名到类本身。

从模块外部，我可以简单地使用`getattr(mod, 'A')`，但我没有`self`模块本身内部的一种模块。

这似乎很明显。有人可以告诉我我错过了什么吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-28T22:16:19.110

```
import sys
getattr(sys.modules[__name__], 'A') 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T22:20:10.147

您可以将其粉碎成一个 for 语句，但这会产生混乱的代码重复。

```
import sys
import types
this_module = sys.modules[__name__]
[x for x in
    [getattr(this_module, x) for x in dir(this_module)]
    if type(x) == types.ClassType] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T23:17:31.263

```
classes = [x for x in globals().values() if isinstance(x, type)]

```

# windows - 适用于 Windows 程序员的最佳“官方”脚本语言

> ID：326775
> 
> 赞同：7
> 
> 时间：2008-11-28T22:11:08.027
> 
> 标签：windows, deployment, scripting, shell

假设有几个项目主要由聪明的实习生维护，他们最终在一段时间后离开。脚本在关键部分到处使用，例如，备份数据库、重命名、压缩、通过 ssh 移动、解压缩，然后使用不同的设置恢复它。你知道，脚本的东西。

应用程序端的编程语言已设置，但脚本的编程语言已放宽。目前可能有 bash 和 .bat 文件的健康组合，也许还有一些 Perl。

1）为了避免语言扩散，以及 2）因为我不想强迫未来的 Windows 程序员使用 bash，我想设置一种“官方”脚本语言。

谷歌为此选择了 Python，它以可读性、易学性和良好的库而闻名；但是，与类 C 语法、Pascal 或 Ruby 相比，我个人认为它的可读性不高。

无论如何，如果您被迫在 Windows 机器上只使用一种脚本语言（如果您愿意，可以使用 Cygwin）来编写所有脚本，您希望它是什么，为什么？

相关宗教战争：

*   [什么是最好的脚本语言学习？](https://stackoverflow.com/questions/213048/what-is-the-best-scripting-language-to-learn)
*   [哪种脚本语言最好？](https://stackoverflow.com/questions/70453/which-scripting-language-is-best)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-28T22:13:51.283

PowerShell - 从头开始​​设计为一种 Windows 脚本语言，它可以连接到 CLR 以实现高级功能。

（是的，我意识到这不能在 cygwin 下运行......但为什么这是一个要求？）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T22:50:10.943

当我编写跨平台产品安装程序时，为 Linux/Mac/Solaris 等编写一个 UNIX shell 脚本真的很容易，但是尝试在 BAT 中执行等效任务就像在黑暗中工作，在水下，双手被绑在后面你的背部。我不能足够强烈地说明*BAT 脚本是人类的祸害。*

所以我听说[**PowerShell**](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)让我很高兴。它是 Windows 开发人员的救星。唯一的麻烦是我相信它仍然是一个单独的安装，默认情况下它不可用（我已经读过它将在 Windows Server 2008 和 Windows 7 上）。

哦，好吧，微软只用了 20 年就将 BAT 脚本替换为 UNIX shell 之类的功能，所以我想我应该不会太忘恩负义！>:-P

在此处获取 PowerShell 的安装程序：

[http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-28T22:22:20.797

我将尝试提供一种替代方法——JavaScript 和 VBScript 即使在早已不复存在的 Windows 版本上也能正常工作，而且它们不需要像 PowerShell 那样单独安装。;) 当然，PowerShell 更**强大**：P

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T18:36:08.757

我敦促你给 Python 一个机会。一开始对“C”程序员来说看起来有点奇怪，但它很容易上手，更重要的是容易记住。您将有各种技能水平的实习生使用和修改代码，因此您需要可以从广泛的用户群中汲取的东西。如果您要麻烦安装新的东西，为什么选择 powershell，这对于任何使用它的人来说都是一条死胡同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T22:14:36.397

电源外壳。它具有广度和深度，并且（现在和将来）完全支持。例如，与 Cygwin 不同。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-14T05:14:58.160

我在 Windows 中遇到的用于界面和控件类型应用程序的最佳脚本语言是 AutoHotKey。任何在 Windows 上开发的人都应该学习这种语言......它可以为您节省大量时间，只需自动执行延迟的 Windows 任务......

我遇到的最有用的 Windows 工具之一是[Texter](http://lifehacker.com/#!238306/lifehacker-code-texter-windows)

这个实用程序是用 AutoHotKey 编写的，让我不必多次输入任何内容......对于编码员或任何填写表格或票证的人来说，这是一个不可或缺的工具......！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-02-10T22:03:23.060

如果您像我一样想要在脚本执行时显示漂亮的进度条或闪屏（而不是黑色/灰色命令提示符窗口），请使用 AutoHotkey。显示进度条是我发现的带有 JScript/VBScript (WSH) 和/或 PowerShell 的 PITA。在 AHK 中，它很简单：

```
Progress, b2 m, ACME App, Doing some magic... 
```

此外，您还可以与任何窗口中的几乎任何控件进行交互，并自动化不应自动化的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-27T14:03:02.843

对于您的特定描述，PowerShell 听起来像是一个不错的方法......但我会为 WSH 下的 JScript（或 Rhino/等下的 JavaScript）提供一个强有力的案例。听起来你喜欢 CYGWIN，但 Powershell 目前不支持其他平台（我认为原生的东西太多——这是一个单独的讨论 IMO，但谷歌应该回答它）。

我在这里做了很多事情：http: [//mikesharp.wordpress.com/2011/04/03/jquery-for-administrators/](http://mikesharp.wordpress.com/2011/04/03/jquery-for-administrators/)

一些亮点：

*   JavaScript 在 95 年之后默认安装在每个 Windows 操作系统上
*   JScript 脚本与 Active Directory 一起“开箱即用”
*   ECMAScript 是一个开放标准（JScript 是它的实现）
*   通过 ActiveX/COM JScript 可以完成大部分 Powershell 可以做的事情，而在 Rhino 下它具有 Java 的强大功能
*   可用于创建 HTA 应用程序（以及后来的带有 WinRT/HTML5 的 Metro 应用程序）

JScript 不能直接访问 .NET 框架——尽管有一些纯 .NET 中的第 3 方 JavaScript 引擎可以解释它并可以与其共享对象，例如 Jurassic 和 IronJS。还有像 JavaScriptDotNet（围绕 Chrome/V8）这样的包装器。在 WSH 下，Powershell 可能会比 JScript 更快，但其他 3rd 方解释器可能不会这么说。

请不要使用 VBScript（缺少 try/catch、没有真正的 OOP、专有、已弃用等）。

# javascript - 如何调试这个奇怪的 IE JavaScript 问题

> ID：326778
> 
> 赞同：1
> 
> 时间：2008-11-28T22:12:56.417
> 
> 标签：javascript, internet-explorer

好的，

这是我的问题，我有一个包含我的 JS 包含的 HEAD 部分的母版页。我有一个 JS 包括

```
<script src="Includes/js/browser.js" language="javascript" type="text/javascript"></script> 
```

在我的页面中，我像这样使用它：

```
<body>
<form id="form1" runat="server">
<div>
....
<script type="text/javascript">registerBookmarkButton();</script>
....
</div>
</form>
</body> 
```

我得到这个错误：

```
Line: 216
Error: Object expected 
```

请告诉我我只是错过了一些东西，这是一个愚蠢的错误

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T22:17:42.913

如你所愿。

> 你只是错过了一些东西，这是一个愚蠢的错误。

:)

话虽如此，我会尝试找出哪个文件有错误的 216 行。也许是 browser.js 文件？其他可能性包括：

*   您弄乱了 URL 并且文件未加载；
*   该函数依赖于DOM是否完全加载，但在相关元素创建之前调用（大部分JS正常情况下应该在onload事件之后完成）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T22:31:33.370

如果您可以使用 Firefox，我强烈建议您安装并启用 Firebug 插件。

否则，请参阅以下一些可能有帮助的工具：

*   [IE 中的 Javascript 故障排除工具](https://stackoverflow.com/questions/3404/javascript-troubleshooting-tools-in-ie)
*   [是否有任何好的或可靠的方法来确定 JavaScript 错误在哪里仅使用 Internet Explorer 错误消息？](https://stackoverflow.com/questions/179054/is-there-any-good-or-reliable-way-to-figure-out-where-a-javascript-error-is-usi)
*   [什么是浏览器的最佳开发“附加”[关闭]](https://stackoverflow.com/questions/313186/what-is-the-best-development-add-on-for-browsers-closed)
*   [在 IE 中调试 javascript？](https://stackoverflow.com/questions/170164/debugging-javascript-in-ie)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-28T23:03:12.150

1.  尝试通过[JSLint](http://www.jslint.com/)运行您的代码。
2.  在这里和那里添加`alert()`调用以将错误缩小到特定位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T22:48:25.957

当浏览器的脚本引擎希望找到一个对象但无法找到时，会发生“预期对象”错误。这通常发生在您尝试进行函数调用时，但脚本引擎无法使用该函数本身，这可能是因为您在调用它时输入了错误的函数名称。

要成功调试此错误，您必须首先确定错误中报告的行号处的指令。这不能通过浏览所有源文件来完成，除非你有一些心理调试能力。建议在 JavaScript 调试器中捕获异常。如果你在 MS IE 下调试它，你可能想安装可以与 MS Office 一起安装的 Microsoft Script Engine，或者穷人的 Microsoft Script Debugger。对于 Firefox，有出色的 Firebug 和 Venkman 扩展。[Jonathan Boutelle 关于在 IE 中调试 JavaScript 的博客文章](http://www.jonathanboutelle.com/mt/archives/2006/01/howto_debug_jav.html)似乎是必读的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-28T22:53:15.213

检查您是否在 yoru 代码中使用关键字作为标识符

* * *

[http://mattsnider.com/languages/javascript/reserved-words-in-javascript/](http://mattsnider.com/languages/javascript/reserved-words-in-javascript/)

[http://bytes.com/groups/javascript/424640-error-object-expected](http://bytes.com/groups/javascript/424640-error-object-expected)

[http://msdn.microsoft.com/en-us/library/0779sbks.aspx](http://msdn.microsoft.com/en-us/library/0779sbks.aspx)

# php - 类似于 Python 中 PHP 的 SimpleXML 的东西？

> ID：326794
> 
> 赞同：7
> 
> 时间：2008-11-28T22:19:06.497
> 
> 标签：php, python, xml, simplexml

Python 中有没有一种方法可以像 PHP 的 SimpleXML 扩展那样处理 XML 文件？

理想情况下，我只想能够从列表对象访问某些 xml 数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T22:26:08.903

[Python wiki](http://wiki.python.org/moin/PythonXml)上有一长串与 XML 处理相关的库。请注意，其中一些包含在标准库中。他们中的大多数会做你正在寻找的东西：

> 从列表对象访问某些 xml 数据

这有点含糊，也许一些更具体的用例可能会为您缩小该列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-16T08:01:32.267

您可能想尝试[xml.etree.ElementTree](http://docs.python.org/library/xml.etree.elementtree.html) 它提供了许多简单的方法来访问读取的 xml 和构建新的 xml。

或者更好的是使用[lxml.etree](http://codespeak.net/lxml/tutorial.html)，它提供了更方便的访问节点的方法（例如 xpath）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-05T15:05:48.617

您可能指的是这样的事情：

[http://github.com/joestump/python-simplexml](http://github.com/joestump/python-simplexml)

我自己没有使用过它，但我也在寻找 PHP 中的 simplexml 之类的东西，并且出现了这个链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-29T13:30:23.617

[lxml.objectify](http://lxml.de/objectify.html)完全符合您的要求

```
In [1]: from lxml import objectify

In [2]: x = objectify.fromstring("""<response><version>1.2</version><amount>1.01</amount><currency>USD</currency></response>""")

In [3]: x.version
Out[3]: 1.2

In [4]: x.amount
Out[4]: 1.01

In [5]: x.currency
Out[5]: 'USD' 
```

# c++ - 计算 C++ 中是否有 1/4 的可能性发生某事的最佳方法是什么？

> ID：326797
> 
> 赞同：2
> 
> 时间：2008-11-28T22:20:48.647
> 
> 标签：c++, probability, random

我想知道是否有一个聪明的方法来找出

有 1/4 的机会发生某事。

我知道我们可以使用 rand() % 4 来执行此操作并检查它是否等于 0，但是有没有不使用 rand() 的方法？在 c++ 中，谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-28T22:32:05.240

如果您的意思是要避免许多`rand()`实现的固有缺陷，您可能应该查看[Boost Random 库](http://www.boost.org/doc/libs/1_37_0/libs/random/index.html)，它有几个高质量的 pRNG（伪随机数生成器）和许多控制输出的方法。该库在`std::tr1`.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-28T22:52:33.637

**永远不要** **使用**% 将 PRNG 值截断到一个范围内。大多数 PRNG 具有相对非随机的低阶位。

对于您的情况，请使用 BCS 建议的除法 (RAND_MAX / n)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-28T22:23:47.113

![随机数发生器](https://imgs.xkcd.com/comics/random_number.png)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-28T22:50:39.743

```
rand() < RAND_MAX/n; 
```

如果您不喜欢 C 的标准 rand()，请选择比 C 更好的 rand()。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-29T00:16:04.640

我不太了解C++，所以我可能错了。但它似乎`rand()`返回 和 之间的`0`值`RAND_MAX-1`。所以也许你可以做这样的事情：

```
double odds = .25;

if(rand() <= RAND_MAX * odds) {
    // there should be .25 chance of entering this condition
} 
```

PS：也许这需要一些演员。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-28T22:24:11.310

你可以写你自己的兰特。（不要这样做）。
你可以抓住滴答数。（不要经常这样做）。
你可以数一数，每四个调用就返回 true。

您可能应该只调用 rand()。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T22:31:59.187

为什么不使用 rand()？如果您担心“真实”随机性与伪随机性，可以尝试[使用随机位的物理源](http://15359.blogspot.com/2008/11/lecture-24-on-getting-random-bits.html)。更复杂，通常是不必要的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-28T23:11:26.440

您可以使用另一种类型的 RNG，例如具有更好整体熵的[Mersenne twister 。](http://en.wikipedia.org/wiki/Mersenne_twister)我还听说了有关[带有 Carry](http://en.wikipedia.org/wiki/Multiply-with-carry) RNG 的乘法运算的好消息。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-29T10:14:32.763

4是特例。你可以假设你的 PRNG 有 50% 的机会输出一个偶数，我认为这就是 libc (rand) 的 LCG 的情况。因此，两次输出偶数的概率为 25%。

所以...

```
bool rand_afourth(void)
{
    return !!((rand() & 1) & (rand() & 1));
} 
```

现在对于学究...

你想要做的是生成一个统一的随机数，但限制在一定范围内，在这种情况下熵为 4。如果你的 PRNG 有一个 32 位的熵，你不能确定计算输出mod 4 将按预期工作。这需要更多的工作。

幸运的是，这项工作已经在 boost 库中实现了。

```
boost::uniform_int<> aFourth(1,4) 
```

例如，每次获得 1（或 2、3、4，如您所愿）时，您都会说“ok”。

但是您可能不想使用 boost 库。然后，只需[查看 uniform_int 的代码](http://www.boost.org/doc/libs/1_37_0/boost/random/uniform_int.hpp)并重现该行为。天才模仿，天才偷窃。;)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-28T23:29:03.767

尝试：

```
static int r = 0;
: : :
if ((r = (r+1)%4) == 0) {
    // do something.
} 
```

然后你会发现它给了你一个完美的 25% 的概率发生某事（假设你执行 if 语句四次的倍数。

</幽默>

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-28T22:24:11.683

嗯...自己写`rand()`？您将需要**某种**随机函数！

# c# - 如何将复选框双向绑定到标志枚举的单个位？

> ID：326802
> 
> 赞同：22
> 
> 时间：2008-11-28T22:24:23.320
> 
> 标签：c#, wpf, data-binding, enums, bit-manipulation

对于那些喜欢良好的 WPF 绑定挑战的人：

我有一个几乎实用的示例，将 a 双向绑定`CheckBox`到标志枚举的单个位（感谢 Ian Oakes，[原始 MSDN 帖子](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/c05b7e7e-25cd-4a41-8bf5-e35d2caff797/)）。但问题是绑定表现得好像它是一种方式（UI 到`DataContext`，反之亦然）。因此有效地`CheckBox`不会初始化，但如果切换它，则数据源会正确更新。Attached 是定义一些附加依赖属性以启用基于位的绑定的类。我注意到的是 ValueChanged 永远不会被调用，即使我强制`DataContext`改变。

**我尝试过：**更改属性定义的顺序，使用标签和文本框确认`DataContext`正在冒泡更新，任何合理的`FrameworkMetadataPropertyOptions`（`AffectsRender`，`BindsTwoWayByDefault`），明确设置`Binding Mode=TwoWay`，在墙上敲打头，在发生冲突时更改`ValueProperty`为`EnumValueProperty`。

任何建议或想法将不胜感激，感谢您提供的任何东西！

枚举：

```
[Flags]
public enum Department : byte
{
    None = 0x00,
    A = 0x01,
    B = 0x02,
    C = 0x04,
    D = 0x08
} // end enum Department 
```

XAML 用法：

```
CheckBox Name="studentIsInDeptACheckBox"
         ctrl:CheckBoxFlagsBehaviour.Mask="{x:Static c:Department.A}"
         ctrl:CheckBoxFlagsBehaviour.IsChecked="{Binding Path=IsChecked, RelativeSource={RelativeSource Self}}"
         ctrl:CheckBoxFlagsBehaviour.Value="{Binding Department}" 
```

班上：

```
/// <summary>
/// A helper class for providing bit-wise binding.
/// </summary>
public class CheckBoxFlagsBehaviour
{
    private static bool isValueChanging;

    public static Enum GetMask(DependencyObject obj)
    {
        return (Enum)obj.GetValue(MaskProperty);
    } // end GetMask

    public static void SetMask(DependencyObject obj, Enum value)
    {
        obj.SetValue(MaskProperty, value);
    } // end SetMask

    public static readonly DependencyProperty MaskProperty =
        DependencyProperty.RegisterAttached("Mask", typeof(Enum),
        typeof(CheckBoxFlagsBehaviour), new UIPropertyMetadata(null));

    public static Enum GetValue(DependencyObject obj)
    {
        return (Enum)obj.GetValue(ValueProperty);
    } // end GetValue

    public static void SetValue(DependencyObject obj, Enum value)
    {
        obj.SetValue(ValueProperty, value);
    } // end SetValue

    public static readonly DependencyProperty ValueProperty =
        DependencyProperty.RegisterAttached("Value", typeof(Enum),
        typeof(CheckBoxFlagsBehaviour), new UIPropertyMetadata(null, ValueChanged));

    private static void ValueChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        isValueChanging = true;
        byte mask = Convert.ToByte(GetMask(d));
        byte value = Convert.ToByte(e.NewValue);

        BindingExpression exp = BindingOperations.GetBindingExpression(d, IsCheckedProperty);
        object dataItem = GetUnderlyingDataItem(exp.DataItem);
        PropertyInfo pi = dataItem.GetType().GetProperty(exp.ParentBinding.Path.Path);
        pi.SetValue(dataItem, (value & mask) != 0, null);

        ((CheckBox)d).IsChecked = (value & mask) != 0;
        isValueChanging = false;
    } // end ValueChanged

    public static bool? GetIsChecked(DependencyObject obj)
    {
        return (bool?)obj.GetValue(IsCheckedProperty);
    } // end GetIsChecked

    public static void SetIsChecked(DependencyObject obj, bool? value)
    {
        obj.SetValue(IsCheckedProperty, value);
    } // end SetIsChecked

    public static readonly DependencyProperty IsCheckedProperty =
        DependencyProperty.RegisterAttached("IsChecked", typeof(bool?),
        typeof(CheckBoxFlagsBehaviour), new UIPropertyMetadata(false, IsCheckedChanged));

    private static void IsCheckedChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (isValueChanging) return;

        bool? isChecked = (bool?)e.NewValue;
        if (isChecked != null)
        {
            BindingExpression exp = BindingOperations.GetBindingExpression(d, ValueProperty);
            object dataItem = GetUnderlyingDataItem(exp.DataItem);
            PropertyInfo pi = dataItem.GetType().GetProperty(exp.ParentBinding.Path.Path);

            byte mask = Convert.ToByte(GetMask(d));
            byte value = Convert.ToByte(pi.GetValue(dataItem, null));

            if (isChecked.Value)
            {
                if ((value & mask) == 0)
                {
                    value = (byte)(value + mask);
                }
            }
            else
            {
                if ((value & mask) != 0)
                {
                    value = (byte)(value - mask);
                }
            }

            pi.SetValue(dataItem, value, null);
        }
    } // end IsCheckedChanged

    /// <summary>
    /// Gets the underlying data item from an object.
    /// </summary>
    /// <param name="o">The object to examine.</param>
    /// <returns>The underlying data item if appropriate, or the object passed in.</returns>
    private static object GetUnderlyingDataItem(object o)
    {
        return o is DataRowView ? ((DataRowView)o).Row : o;
    } // end GetUnderlyingDataItem
} // end class CheckBoxFlagsBehaviour 
```

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-17T17:13:32.393

您可以使用价值转换器。这是 target 的一个非常具体的实现`Enum`，但不难看出如何使转换器更通用：

```
[Flags]
public enum Department
{
    None = 0,
    A = 1,
    B = 2,
    C = 4,
    D = 8
}

public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();

        this.DepartmentsPanel.DataContext = new DataObject
        {
            Department = Department.A | Department.C
        };
    }
}

public class DataObject
{
    public DataObject()
    {
    }

    public Department Department { get; set; }
}

public class DepartmentValueConverter : IValueConverter
{
    private Department target;

    public DepartmentValueConverter()
    {
    }

    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        Department mask = (Department)parameter;
        this.target = (Department)value;
        return ((mask & this.target) != 0);
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        this.target ^= (Department)parameter;
        return this.target;
    }
} 
```

然后在 XAML 中使用转换器：

```
<Window.Resources>
    <l:DepartmentValueConverter x:Key="DeptConverter" />
</Window.Resources>

 <StackPanel x:Name="DepartmentsPanel">
    <CheckBox Content="A"
              IsChecked="{Binding 
                            Path=Department,
                            Converter={StaticResource DeptConverter},
                            ConverterParameter={x:Static l:Department.A}}"/>
    <!-- more -->
 </StackPanel> 
```

**编辑：**我没有足够的“代表”（还没有！）在下面发表评论，所以我必须更新我自己的帖子:(

在最后一条评论中，[Steve Cadwallader](https://stackoverflow.com/users/41693/steve-cadwallader)说：*“但是当涉及到双向绑定时，ConvertBack 会崩溃”*，我已经更新了上面的示例代码来处理 ConvertBack 场景；我还在[***这里***](http://www.box.net/shared/8xp0qqsc47)发布了一个示例工作应用程序（**编辑：**请注意示例代码下载还包括转换器的通用版本）。

我个人认为这要简单得多，我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-03-29T14:51:17.550

这是我想出的东西，它使 View 干净整洁（不需要静态资源，无需填写新的附加属性，绑定中不需要转换器或转换器参数），并使 ViewModel 保持干净（无需绑定额外的属性)

视图如下所示：

```
<CheckBox Content="A" IsChecked="{Binding Department[A]}"/>
<CheckBox Content="B" IsChecked="{Binding Department[B]}"/>
<CheckBox Content="C" IsChecked="{Binding Department[C]}"/>
<CheckBox Content="D" IsChecked="{Binding Department[D]}"/> 
```

ViewModel 看起来像这样：

```
public class ViewModel : ViewModelBase
{
  private Department department;

  public ViewModel()
  {
    Department = new EnumFlags<Department>(department);
  }

  public Department Department { get; private set; }
} 
```

如果您要为 Department 属性分配新值，请不要这样做。离开部门。改为将新值写入 Department.Value。

这就是魔法发生的地方（这个泛型类可以重用于任何标志枚举）

```
public class EnumFlags<T> : INotifyPropertyChanged where T : struct, IComparable, IFormattable, IConvertible
{
  private T value;

  public EnumFlags(T t)
  {
    if (!typeof(T).IsEnum) throw new ArgumentException($"{nameof(T)} must be an enum type"); // I really wish they would just let me add Enum to the generic type constraints
    value = t;
  }

  public T Value
  {
    get { return value; }
    set
    {
      if (this.value.Equals(value)) return;
      this.value = value;
      OnPropertyChanged("Item[]");
    }
  }

  [IndexerName("Item")]
  public bool this[T key]
  {
    get
    {
      // .net does not allow us to specify that T is an enum, so it thinks we can't cast T to int.
      // to get around this, cast it to object then cast that to int.
      return (((int)(object)value & (int)(object)key) == (int)(object)key);
    }
    set
    {
      if ((((int)(object)this.value & (int)(object)key) == (int)(object)key) == value) return;

      this.value = (T)(object)((int)(object)this.value ^ (int)(object)key);

      OnPropertyChanged("Item[]");
    }
  }

  #region INotifyPropertyChanged
  public event PropertyChangedEventHandler PropertyChanged;

  private void OnPropertyChanged([CallerMemberName] string memberName = "")
  {
    PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(memberName));
  }
  #endregion
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T18:19:58.727

感谢大家的帮助，我终于弄明白了。

我绑定到一个强类型的 DataSet，所以枚举存储为 System.Byte 类型而不是 System.Enum。我碰巧在我的调试输出窗口中注意到一个静默绑定转换异常，它指出了这种差异。解决方案与上述相同，但 ValueProperty 的类型为 Byte 而不是 Enum。

这是在其最终修订版中重复的 CheckBoxFlagsBehavior 类。再次感谢 Ian Oakes 的原始实施！

```
public class CheckBoxFlagsBehaviour
{
    private static bool isValueChanging;

    public static Enum GetMask(DependencyObject obj)
    {
        return (Enum)obj.GetValue(MaskProperty);
    } // end GetMask

    public static void SetMask(DependencyObject obj, Enum value)
    {
        obj.SetValue(MaskProperty, value);
    } // end SetMask

    public static readonly DependencyProperty MaskProperty =
        DependencyProperty.RegisterAttached("Mask", typeof(Enum),
        typeof(CheckBoxFlagsBehaviour), new UIPropertyMetadata(null));

    public static byte GetValue(DependencyObject obj)
    {
        return (byte)obj.GetValue(ValueProperty);
    } // end GetValue

    public static void SetValue(DependencyObject obj, byte value)
    {
        obj.SetValue(ValueProperty, value);
    } // end SetValue

    public static readonly DependencyProperty ValueProperty =
        DependencyProperty.RegisterAttached("Value", typeof(byte),
        typeof(CheckBoxFlagsBehaviour), new UIPropertyMetadata(default(byte), ValueChanged));

    private static void ValueChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        isValueChanging = true;
        byte mask = Convert.ToByte(GetMask(d));
        byte value = Convert.ToByte(e.NewValue);

        BindingExpression exp = BindingOperations.GetBindingExpression(d, IsCheckedProperty);
        object dataItem = GetUnderlyingDataItem(exp.DataItem);
        PropertyInfo pi = dataItem.GetType().GetProperty(exp.ParentBinding.Path.Path);
        pi.SetValue(dataItem, (value & mask) != 0, null);

        ((CheckBox)d).IsChecked = (value & mask) != 0;
        isValueChanging = false;
    } // end ValueChanged

    public static bool? GetIsChecked(DependencyObject obj)
    {
        return (bool?)obj.GetValue(IsCheckedProperty);
    } // end GetIsChecked

    public static void SetIsChecked(DependencyObject obj, bool? value)
    {
        obj.SetValue(IsCheckedProperty, value);
    } // end SetIsChecked

    public static readonly DependencyProperty IsCheckedProperty =
        DependencyProperty.RegisterAttached("IsChecked", typeof(bool?),
        typeof(CheckBoxFlagsBehaviour), new UIPropertyMetadata(false, IsCheckedChanged));

    private static void IsCheckedChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (isValueChanging) return;

        bool? isChecked = (bool?)e.NewValue;
        if (isChecked != null)
        {
            BindingExpression exp = BindingOperations.GetBindingExpression(d, ValueProperty);
            object dataItem = GetUnderlyingDataItem(exp.DataItem);
            PropertyInfo pi = dataItem.GetType().GetProperty(exp.ParentBinding.Path.Path);

            byte mask = Convert.ToByte(GetMask(d));
            byte value = Convert.ToByte(pi.GetValue(dataItem, null));

            if (isChecked.Value)
            {
                if ((value & mask) == 0)
                {
                    value = (byte)(value + mask);
                }
            }
            else
            {
                if ((value & mask) != 0)
                {
                    value = (byte)(value - mask);
                }
            }

            pi.SetValue(dataItem, value, null);
        }
    } // end IsCheckedChanged

    private static object GetUnderlyingDataItem(object o)
    {
        return o is DataRowView ? ((DataRowView)o).Row : o;
    } // end GetUnderlyingDataItem
} // end class CheckBoxFlagsBehaviour 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T06:42:54.327

检查绑定到 CheckBoxes 的 DataObject 包含 Department 属性是否在其 Setter 上调用了 INotifyPropertyChnaged.PropertyChanged？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-04T11:45:44.370

我还没有足够的代表发表评论，这个解决方案的目标是 user99999991：
“我猜，不能有多个复选框绑定到页面上的不同值与相同的转换器。”
另一个优点是，使用此解决方案，您还可以绑定标志掩码，而不是硬编码静态引用。

使用 IMultiValueConverter：

```
public class FlagToBoolConverter : IMultiValueConverter

{
    private YourFlagEnum selection;
    private YourFlagEnum mask;

    public static int InstanceCount = 0;

    public FlagToBoolConverter()
    {
        InstanceCount++;
    }

    public object Convert(object[] values, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        mask = (YourFlagEnum ) values[1];
        selection = (YourFlagEnum ) values[0];
        return (mask & selection) != 0;
    }

    public object[] ConvertBack(object value, Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture)
    {
        if (value.Equals(true))
        {
            selection |= mask;
        }
        else
        {
            selection &= ~mask;
        }

        object[] o = new object[2];
        o[0] = selection;
        o[1] = mask;
        return o;
    }
} 
```

ItemsControl（CheckBoxTemplates 是一个 List，因此您可以在运行时添加多个 Checkbox）：

```
 <ItemsControl ItemsSource="{Binding CheckBoxTemplates}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Vertical" Margin="40,0,0,0"></StackPanel>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                    <CheckBox Content="{Binding Path=Content}" >
                                        <CheckBox.Style>
                                            <Style TargetType="CheckBox">
                                                <Setter Property="IsChecked">
                                                    <Setter.Value>
                                                        <MultiBinding Converter="{StaticResource FlagToBoolConverter}">
                                                            <Binding Path="MyEnumProperty" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged"></Binding>
                                                            <Binding Path="MyEnumPropertyMask"></Binding>
                                                        </MultiBinding>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </CheckBox.Style>
                                    </CheckBox>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl> 
```

重要提示：声明转换器时，设置 x:Shared="False" 以便创建多个实例：

```
<UserControl.Resources>
    <ui:FlagToBoolConverter x:Key="FlagToBoolConverter" x:Shared="False"></ui:FlagToBoolConverter>
</UserControl.Resources> 
```

# c# - 如何验证域凭据？

> ID：326818
> 
> 赞同：92
> 
> 时间：2008-11-28T22:35:40.537
> 
> 标签：c#, windows, security, authentication

我想针对域控制器验证一组凭据。例如：

```
Username: STACKOVERFLOW\joel
Password: splotchy 
```

## 方法 1\. 使用模拟查询 Active Directory

很多人建议在 Active Directory 中查询某些内容。如果抛出异常，则您知道凭据无效 - 正[如此 stackoverflow question](https://stackoverflow.com/questions/290548/c-validate-a-username-and-password-against-active-directory)中所建议的那样。

然而，这种方法有一些严重的[缺点](http://bytes.com/groups/net-c/249893-fyi-easy-way-validate-ad-credentials-win2k-using-c)：

1.  您不仅在验证域帐户，而且还在进行隐式授权检查。也就是说，您正在使用模拟令牌从 AD 中读取属性。如果其他有效帐户无权读取 AD 怎么办？默认情况下，所有用户都具有读取权限，但可以将域策略设置为禁用受限帐户（和/或组）的访问权限。

2.  与 AD 的绑定具有严重的开销，必须在客户端加载 AD 架构缓存（ADSI 缓存中的 ADSI 提供程序由 DirectoryServices 使用）。这既是网络，又是 AD 服务器，会消耗资源 - 而且对于像验证用户帐户这样的简单操作来说太昂贵了。

3.  您依赖于非异常情况的异常失败，并假设这意味着用户名和密码无效。其他问题（例如网络故障、AD 连接故障、内存分配错误等）随后被错误地解释为身份验证失败。

## 方法二、LogonUser Win32 API

[其他](https://stackoverflow.com/questions/290548/c-validate-a-username-and-password-against-active-directory#290558)人建议使用[`LogonUser()`](http://msdn.microsoft.com/en-us/library/aa378184.aspx)API 函数。这听起来不错，但不幸的是，调用用户有时需要通常只授予操作系统本身的权限：

> 调用 LogonUser 的进程需要 SE_TCB_NAME 权限。如果调用进程没有此权限，LogonUser 将失败并且 GetLastError 返回 ERROR_PRIVILEGE_NOT_HELD。
> 
> 在某些情况下，调用 LogonUser 的进程还必须启用 SE_CHANGE_NOTIFY_NAME 权限；否则，LogonUser 失败并且 GetLastError 返回 ERROR_ACCESS_DENIED。本地系统帐户或属于管理员组成员的帐户不需要此权限。默认情况下，SE_CHANGE_NOTIFY_NAME 为所有用户启用，但一些管理员可能会为所有人禁用它。

[正如微软在一篇知识库文章](http://support.microsoft.com/kb/180548)中指出的那样，分发“*作为操作系统的一部分*”特权并不是您想要做的事情：

> ...调用 LogonUser 的进程必须具有 SE_TCB_NAME 权限（在用户管理器中，这是“*作为操作系统的一部分*”权限）。SE_TCB_NAME 权限非常强大， **不应授予任何任意用户，以便他们可以运行**需要验证凭据的应用程序。

`LogonUser()`此外，如果指定了空白密码，调用将失败。

* * *

验证一组域凭据的正确方法是什么？

* * *

我*碰巧*是从托管代码调用的，但这是一个一般的 Windows 问题。可以假设客户安装了 .NET Framework 2.0。

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-11-29T02:41:11.803

.NET 3.5 中的 C# 使用[System.DirectoryServices.AccountManagement](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.aspx)。

```
 bool valid = false;
 using (PrincipalContext context = new PrincipalContext(ContextType.Domain))
 {
     valid = context.ValidateCredentials( username, password );
 } 
```

这将针对当前域进行验证。查看参数化的 PrincipalContext 构造函数以获取其他选项。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2011-08-03T17:05:17.617

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Security;
using System.DirectoryServices.AccountManagement;

public struct Credentials
{
    public string Username;
    public string Password;
}

public class Domain_Authentication
{
    public Credentials Credentials;
    public string Domain;

    public Domain_Authentication(string Username, string Password, string SDomain)
    {
        Credentials.Username = Username;
        Credentials.Password = Password;
        Domain = SDomain;
    }

    public bool IsValid()
    {
        using (PrincipalContext pc = new PrincipalContext(ContextType.Domain, Domain))
        {
            // validate the credentials
            return pc.ValidateCredentials(Credentials.Username, Credentials.Password);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-11-06T17:33:44.323

我正在使用以下代码来验证凭据。下面显示的方法将确认凭据是否正确，如果不正确，密码是否已过期或需要更改。

我多年来一直在寻找这样的东西......所以我希望这对某人有所帮助！

```
using System;
using System.DirectoryServices;
using System.DirectoryServices.AccountManagement;
using System.Runtime.InteropServices;

namespace User
{
    public static class UserValidation
    {
        [DllImport("advapi32.dll", SetLastError = true)]
        static extern bool LogonUser(string principal, string authority, string password, LogonTypes logonType, LogonProviders logonProvider, out IntPtr token);
        [DllImport("kernel32.dll", SetLastError = true)]
        static extern bool CloseHandle(IntPtr handle);
        enum LogonProviders : uint
        {
            Default = 0, // default for platform (use this!)
            WinNT35,     // sends smoke signals to authority
            WinNT40,     // uses NTLM
            WinNT50      // negotiates Kerb or NTLM
        }
        enum LogonTypes : uint
        {
            Interactive = 2,
            Network = 3,
            Batch = 4,
            Service = 5,
            Unlock = 7,
            NetworkCleartext = 8,
            NewCredentials = 9
        }
        public  const int ERROR_PASSWORD_MUST_CHANGE = 1907;
        public  const int ERROR_LOGON_FAILURE = 1326;
        public  const int ERROR_ACCOUNT_RESTRICTION = 1327;
        public  const int ERROR_ACCOUNT_DISABLED = 1331;
        public  const int ERROR_INVALID_LOGON_HOURS = 1328;
        public  const int ERROR_NO_LOGON_SERVERS = 1311;
        public  const int ERROR_INVALID_WORKSTATION = 1329;
        public  const int ERROR_ACCOUNT_LOCKED_OUT = 1909;      //It gives this error if the account is locked, REGARDLESS OF WHETHER VALID CREDENTIALS WERE PROVIDED!!!
        public  const int ERROR_ACCOUNT_EXPIRED = 1793;
        public  const int ERROR_PASSWORD_EXPIRED = 1330;

        public static int CheckUserLogon(string username, string password, string domain_fqdn)
        {
            int errorCode = 0;
            using (PrincipalContext pc = new PrincipalContext(ContextType.Domain, domain_fqdn, "ADMIN_USER", "PASSWORD"))
            {
                if (!pc.ValidateCredentials(username, password))
                {
                    IntPtr token = new IntPtr();
                    try
                    {
                        if (!LogonUser(username, domain_fqdn, password, LogonTypes.Network, LogonProviders.Default, out token))
                        {
                            errorCode = Marshal.GetLastWin32Error();
                        }
                    }
                    catch (Exception)
                    {
                        throw;
                    }
                    finally
                    {
                        CloseHandle(token);
                    }
                }
            }
            return errorCode;
        }
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-02-03T15:34:10.513

以下是如何确定本地用户：

```
 public bool IsLocalUser()
    {
        return windowsIdentity.AuthenticationType == "NTLM";
    } 
```

* * *

## 伊恩·博伊德编辑

您根本不应该再使用 NTLM。它太老了，太糟糕了，以至于微软的应用程序验证器（用于捕获常见的编程错误）如果检测到您使用 NTLM 就会发出警告。

这是 Application Verifier 文档中的一章，说明如果有人错误地使用 NTLM，他们为什么要进行测试：

> ## 为什么需要 NTLM 插件
> 
> NTLM 是一种过时的身份验证协议，存在可能危及应用程序和操作系统安全性的缺陷。最重要的缺点是缺乏服务器身份验证，这可能允许攻击者诱骗用户连接到欺骗性服务器。作为缺少服务器身份验证的必然结果，使用 NTLM 的应用程序也容易受到一种称为“反射”攻击的攻击。后者允许攻击者将用户的身份验证对话劫持到合法服务器，并使用它来向用户的计算机验证攻击者的身份。NTLM 的漏洞和利用它们的方法是安全社区增加研究活动的目标。
> 
> 尽管 Kerberos 已可用多年，但许多应用程序仍被编写为仅使用 NTLM。这不必要地降低了应用程序的安全性。然而，Kerberos 不能在所有场景中替换 NTLM——主要是那些客户端需要对未加入域的系统进行身份验证的场景（家庭网络可能是其中最常见的）。Negotiate 安全包允许向后兼容的妥协，尽可能使用 Kerberos，只有在没有其他选项时才恢复到 NTLM。将代码切换为使用 Negotiate 而不是 NTLM 将显着提高我们客户的安全性，同时引入很少或没有应用程序兼容性。协商本身并不是灵丹妙药——在某些情况下，攻击者可以强制降级到 NTLM，但这些更难被利用。然而，一个直接的改进是，为正确使用 Negotiate 而编写的应用程序将自动免疫 NTLM 反射攻击。
> 
> 最后提醒一下不要使用 NTLM：*在未来的 Windows 版本中，可以在操作系统中禁用 NTLM。如果应用程序对 NTLM 有硬依赖，则在禁用 NTLM 时它们将无法进行身份验证。*
> 
> ## 插件的工作原理
> 
> 验证器插件检测到以下错误：
> 
> *   NTLM 包直接在对 AcquireCredentialsHandle（或更高级别的包装 API）的调用中指定。
>     
>     
> *   InitializeSecurityContext 调用中的目标名称为 NULL。
>     
>     
> *   InitializeSecurityContext 调用中的目标名称不是格式正确的 SPN、UPN 或 NetBIOS 样式的域名。
>     
>     
> 
> 后两种情况将强制 Negotiate 直接（第一种情况）或间接回退到 NTLM（在第二种情况下，域控制器将返回“principal not found”错误，导致 Negotiate 回退）。
> 
> 该插件还会在检测到降级到 NTLM 时记录警告；例如，当域控制器找不到 SPN 时。这些仅记录为警告，因为它们通常是合法的情况 - 例如，在对未加入域的系统进行身份验证时。
> 
> ## NTLM 停止
> 
> **5000 – 应用程序已明确选择 NTLM 包**
> 
> 严重性 - 错误
> 
> 应用程序或子系统在对 AcquireCredentialsHandle 的调用中显式选择 NTLM 而不是 Negotiate。即使客户端和服务器可以使用 Kerberos 进行身份验证，这也可以通过显式选择 NTLM 来阻止。
> 
> **如何修复此错误**
> 
> 此错误的修复方法是选择协商包代替 NTLM。如何完成将取决于客户端或服务器使用的特定网络子系统。下面给出了一些例子。您应该查阅有关您正在使用的特定库或 API 集的文档。
> 
> ```
> APIs(parameter) Used by Application    Incorrect Value  Correct Value  
> =====================================  ===============  ========================
> AcquireCredentialsHandle (pszPackage)  “NTLM”           NEGOSSP_NAME “Negotiate” 
> ```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-02T20:13:59.837

```
using System;
using System.Collections.Generic;
using System.Text;
using System.DirectoryServices.AccountManagement;

class WindowsCred
{
    private const string SPLIT_1 = "\\";

    public static bool ValidateW(string UserName, string Password)
    {
        bool valid = false;
        string Domain = "";

        if (UserName.IndexOf("\\") != -1)
        {
            string[] arrT = UserName.Split(SPLIT_1[0]);
            Domain = arrT[0];
            UserName = arrT[1];
        }

        if (Domain.Length == 0)
        {
            Domain = System.Environment.MachineName;
        }

        using (PrincipalContext context = new PrincipalContext(ContextType.Domain, Domain)) 
        {
            valid = context.ValidateCredentials(UserName, Password);
        }

        return valid;
    }
} 
```

Kashif Mushtaq 加拿大渥太华

# c# - 方法和匿名类型

> ID：326820
> 
> 赞同：4
> 
> 时间：2008-11-28T22:36:50.643
> 
> 标签：c#, extension-methods, anonymous-types, anonymous-methods

我知道您不能从方法返回匿名类型，但我想知道 Select 扩展方法如何返回匿名类型。它只是一个编译器技巧吗？

编辑

假设 L 是一个列表。这是如何运作的？

```
L.Select(s => new { Name = s }) 
```

返回类型是 IEnumerable<'a> 其​​中 'a = new {String Name}

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-28T22:42:17.323

好吧，这是泛型方法类型参数的正常类型推断。例如：

```
List<string> x = new List<string>();

// The compiler converts this:
x.Select(y => y.Length);

// Into this, using type inference:
Enumerable.Select<string, int>(x, y => y.Length); 
```

如果`x`是某个匿名类型的列表，或者推断的 lambda 表达式的返回类型是匿名类型，情况也是如此。不要忘记，即使您不能明确说明使用匿名类型的变量的类型，它仍然*具有*编译器已知的确定类型。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-28T23:32:46.007

类型实际上是由*调用者定义的*，所以它在调用函数的范围内——巧妙地避免了“返回”匿名类型的问题。

这是通过泛型类型推断完成的。[Select](http://msdn.microsoft.com/en-us/library/bb548891.aspx)的签名是`Select<Tsource, TResult>(IEnumerable<TSource>, Func<TSource, TResult>`. `IEnumerable<TSource>`显然，源集合。转换函数是编译器`Func<Tsource, TResult>`可以使用类型推断来声明匿名类型的地方。

换句话说，为了将 a 传递`Func<Tsource, TResult>`给`Select`，您（调用者）必须定义`TResult`。这意味着`Select`不是返回由它定义的匿名类型 - 而是由您定义的。

要模拟这一点，您只需让调用者定义类型：

```
TResult ReturnAnonymousType<TResult>(Func<TResult> f) {
   return f();
}

Console.WriteLine(ReturnAnonymousType(
   () => return new { Text = "Hello World!" } // type defined here, before calling 
); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-28T23:24:02.153

来自评论：“那么我将如何实施类似的方法”

您需要的只是任何通用方法：

```
public List<T> Foo<T>(T template) { // doesn't actually use "template"
    return new List<T>();  // just an example
} 
```

那么你可以拥有：

```
var list = Foo(new {Bar=1}); 
```

编译器提供`<T>`通过泛型类型推断。

有点厚颜无耻，但你甚至可以在没有实际创建匿名类型实例的情况下做到这一点：

```
public List<T> Foo<T>(Func<T> func) { // doesn't actually use "func"
    return new List<T>(); // just an example
}

var list = Foo(() => new {Bar = 1}); 
```

同样，它是由编译器通过 lambda 的返回值提供的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T22:48:03.553

Select 的返回类型是通用的，它是从大多数情况下提供的 lambda 推断出来的。

例如：

```
List<int> list = new List<int<();

var val = list.Select(x => new {value = x, mod = x % 10}); 
```

select 的返回值基于我定义的匿名类型，并从 lambda 推断到委托，再到 Select 函数。在这种情况下，Select 函数不知道也不关心特定的匿名类型，因为从它的角度来看，它是一个泛型类型。

# language-agnostic - 需要解释为什么复选框在 Safari 中看起来很时髦

> ID：326821
> 
> 赞同：-2
> 
> 时间：2008-11-28T22:37:13.747
> 
> 标签：language-agnostic, safari, communication

我办公室里的每个人都使用 Mac，因此大多数人都使用 Safari。

我们有一个页面上有 30 个复选框，我什至没有自己编写 HTML，但无论我使用带有标签的 html 输入复选框还是 asp:Checkbox 使用标签的文本属性，我的老板很恼火，因为复选框位于标签中心的下方。

我只能假设这是由于 Sarari 和它的不稳定渲染。我怀疑是否有一个不会非常复杂的修复程序（如果有请告诉我）。我什至没有自己做html，我把它发出来了。

我试图向他解释 Safari 的“现状”，但这是不可接受的。我用谷歌搜索看看是否有其他人遇到过这样的问题，（虽然我没有用谷歌搜索，我想我只是问你们）。当遇到这样的问题，他坚持认为如此轻微的事情是不可接受的时，我该怎么办？我接近这个错误吗？我的意思是 HTML 在这里是完全合理的：

```
<ul>
    <li><asp:CheckBox  CssClass="checkbox" runat="server" Text="Accessories" /></li>
    <li><asp:CheckBox  CssClass="checkbox" runat="server" Text="Art" /></li>
    <li><asp:CheckBox  CssClass="checkbox" runat="server" Text="Athletic Apparel" /></li>
    <!-- etc... -->
</ul> 
```

我怎样才能以他能理解的方式向他解释这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T22:46:08.393

哇，在你提到它之前，我什至没有真正注意到盒子比文字略低。你可以在 CSS 中解决这个问题：

```
label {
    vertical-align: bottom;
} 
```

将文本与我的复选框对齐（Safari 3.2.1）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T22:46:50.717

我不确定 Safari 和复选框的问题，但我经历过老板或客户专注于看似无关紧要的事情的情况。

我处理这个问题的方式类似于“我可以研究这个问题并尝试找到解决方案或解决方法，但这可能需要我 x 小时/天。”。

我让他们决定他们是希望我花 x 小时/天来解决他们的问题还是利用那段时间进行实际开发。

# .net - Xml 集合的序列化

> ID：326822
> 
> 赞同：3
> 
> 时间：2008-11-28T22:37:18.113
> 
> 标签：.net, xml-serialization

我想序列化以下 Xml 结构：

```
 <XmlRootElement>
     <Company name="Acme Widgets LLC">
        <DbApplication name="ApplicationA" vendor="oracle">
           <ConnSpec environment="DEV" 
                     server="DBOraDev1201" 
                     database="AppA" 
                     userId="MyUser" 
                     password="5613456#6%^%$%$#" />
           <ConnSpec environment="QA" 
                     server="DBOraQA1205" 
                     database="AppA" 
                     userId="MyUser" 
                     password="5613456#6%^%$%$#" />
       </DbApplication>
       <DbApplication name="AnotherApp" "vendor="SQLServer">
           <ConnSpec environment="DEV" 
                     server="DBMsSqlDev1201" 
                     catalog="AnoptherApp" 
                     userId="MyUser" 
                     password="5613456#6%^%$%$#" />
           <ConnSpec environment="QA" 
                     server="DBMsSqlQA1565" 
                     catalog="AnotherApp" 
                     userId="MyUser" 
                     password="5613456#6%^%$%$#" />
       </DbApplication>
     </Company>
     <Company name = "ExpertSoftware Inc" ....
        ...
     </Company>
  </XmlRootElement> 
```

但我在[链接文本中发现](http://msdn.microsoft.com/en-us/library/ms950721.aspx)

引用以上链接：...

*   问：为什么不是所有集合类的属性都被序列化了？
*   答：XmlSerializer 仅在检测到 IEnumerable 或 ICollection 接口时才对集合中的元素进行序列化。此行为是设计使然。唯一的解决方法是将自定义集合重新分解为两个类，其中一个公开包含纯集合类型之一的属性。

...

在发现您无法序列化或反序列化包含其他 Xml 属性的集合之后...建议的解决方法是将具有该集合的元素与具有其他属性的元素分开...即，您必须更改结构，使其看起来像这样：

```
 <XmlRootElement>
     <Companys>
        <Company name="Acme Widgets LLC">
           <DbApplications>
               <DbApplication name="ApplicationA" vendor="oracle">
                  <ConnSpecs>
                     <ConnSpec environment="DEV" 
                         server="DBOraDev1201" ...  />
                     <ConnSpec environment="QA" 
                         server="DBOraQA1205" 
                         database="AppA" ... />
                  </ConnSpecs>
               </DbApplication>
               <DbApplication name="AnotherApp" "vendor="SQLServer">
                  <ConnSpecs>
                      <ConnSpec environment="DEV" ... />
                      <ConnSpec environment="QA"  ... />
                  </ConnSpecs>
                </DbApplication>
           </DbApplications>
         </Company>
         <Company name = "ExpertSoftware Inc" ....
             ...
         </Company>
     </Companys>
  </XmlRootElement> 
```

有谁知道为什么会这样？或者是否有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T11:53:47.303

如果您使用的是[XmlSerializer](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)，您需要指出它如何序列化您的集合：

```
public class XmlRootElement
{
    [XmlElement(ElementName="Company")]
    public Company[] Company { get; set; }

    // Other properties ....
}

public class Company
{
    [XmlAttribute(AttributeName="name")]
    public string Name { get; set; }

    [XmlElement(ElementName = "DbApplication")]
    public DbApplication[] DbApplication { get; set; }

    // Other properties ....
}

public class DbApplication
{
    [XmlElement(ElementName = "ConnSpec")]
    public ConnSpec[] ConnSpec { get; set; }

    // Other properties ....
}

public class ConnSpec
{
    // Other properties ....
} 
```

进而：

```
using (Stream stream = new FileStream("test.xml", FileMode.Open, FileAccess.Read, FileShare.Read))
{
    XmlSerializer serializer = new XmlSerializer(typeof(XmlRootElement));
    XmlRootElement root = (XmlRootElement)serializer.Deserialize(stream);
} 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T16:31:51.033

将 XMl 序列化属性添加到所有类的另一种方法是在根元素容器类上实现[IXmlSerializable接口。](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)XmlSerializer 将使用该接口的**ReadXml**和**WriteXml**方法，允许您对序列化/反序列化过程进行更细粒度的控制。

# ruby - 如何以编程方式将 args 传递给 Ruby 中的 yield？

> ID：326825
> 
> 赞同：11
> 
> 时间：2008-11-28T22:39:06.847
> 
> 标签：ruby

如何将可变数量的参数传递给产量。我不想传递一个数组（就像下面的代码一样），我实际上想将它们作为编程数量的 args 传递给块。

```
def each_with_attributes(attributes, &block)
  results[:matches].each_with_index do |match, index|
    yield self[index], attributes.collect { |attribute| (match[:attributes][attribute] || match[:attributes]["@#{attribute}"]) }
  end
end 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-28T22:47:59.653

使用 splat-operator`*`将数组转换为参数。

```
block.call(*array) 
```

或者

```
yield *array 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T22:48:36.440

使用星号将数组扩展为参数列表中的各个组件：

```
def print_num_args(*a)
  puts a.size
end

array = [1, 2, 3]
print_num_args(array);
print_num_args(*array); 
```

将打印：

```
1
3 
```

在第一种情况下，传递数组，在第二种情况下，每个元素分别传递。请注意，被调用的函数需要处理变量参数，例如 print_num_args 所做的，如果它需要一个固定大小的参数列表并且收到的参数列表多于或少于预期，您将获得异常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-28T22:44:17.553

Asterisk 会将数组扩展为 ruby​​ 中的单个参数：

```
def test(a, b)
  puts "#{a} + #{b} = #{a + b}"
end

args = [1, 2]

test *args 
```

# flash - 对 TextField 中 htmlText 的影响

> ID：326828
> 
> 赞同：2
> 
> 时间：2008-11-28T22:41:13.553
> 
> 标签：flash, actionscript-3, actionscript, textfield

在 Flash 中，当您使用 htmlText 属性在 TextField 对象中设置文本时，更改 alpha 值不再有效。有办法解决吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T01:49:33.030

这里有些混乱。

1.  alpha 是否有效取决于文本字段是否使用设备字体，而不是是否使用 HTML。（只要您有动态/输入文本并且您没有嵌入字体，就会使用设备字体。）

2.  如果可能，只需为 Flash player 10 发布，它现在支持设备字体的 alpha。（请注意，您必须设置`alpha`文本字段或其父级的属性 - 为文本本身选择透明颜色不起作用。）

3.  v8-9 的后备选项是通过应用过滤器来强制位图缓存。例如，您可以使用颜色设置为透明的阴影。这会导致 Flash 在将文本字段绘制到屏幕之前将其渲染为位图，因此您的 alpha 将应用于位图并且一切正常。

4.  对于播放器版本 7 或更低版本，无法获取设备字体的 alpha。您必须嵌入字体或学会在没有 alpha 的情况下生活。:D

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T22:11:34.127

如果您发现文本字段没有响应该`alpha`属性，可能是因为您没有嵌入字体。确保单击文本字段属性中的“嵌入...”，然后选择“基本拉丁语”。

如果您发现您的`htmlText`格式（例如`<b>`和`<i>`）没有显示，您必须确保这些（样式）字体也被嵌入。一种简单的方法是使用您需要的样式创建隐藏或后台动态文本字段（确保也嵌入字体！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T20:49:58.347

您可以在不嵌入字体的情况下使用 blendMode 执行此操作，但会稍微牺牲文本外观（我相信）。

```
import flash.display.BlendMode;
import flash.text.TextField;
// later...
var tf:TextField = new TextField();
tf.blendMode = BlendMode.LAYER;
tf.alpha = 0.5; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-28T22:43:45.823

动态文本不支持 alpha 属性（等等）。我假设将其设置为 HTML 文本会施加相同的限制。我发现的一种方法是在影片剪辑中包含文本字段，并在影片剪辑上设置 Alpha。

# asp.net-mvc - 用于桌面的 MVC.NET

> ID：326839
> 
> 赞同：7
> 
> 时间：2008-11-28T22:46:31.060
> 
> 标签：asp.net-mvc, desktop-application

是否有任何理由表明 MVC 对桌面应用程序和 Web 应用程序的用处不同？

使 ASP.NET MVC 目录树可实现为桌面应用程序需要什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-10-16T15:41:22.450

[棱镜](http://compositewpf.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T22:55:59.217

我一直认为 MVC 一词与 n 层应用程序相同 - 如果我在这里错了，请纠正我。

当我开发时，我总是（除非有其他指示）使用以下模型/结构，也在应用程序中：

GUI（Web，Winform，等等）-> 业务逻辑-> 数据层-> 并且还有一个底层的“模型”

...这是一种 MVC - 所以是的，它对桌面应用程序也很有用。这样做的主要优点是，您可以基于相同的代码开发 web、win 和 mobile(++) 应用程序。

可以做的另一件事是将数据/业务层创建为 Web 服务......

我认为这种方法符合 SOA 的要求。

编辑：作为一个注释，四个级别的应用程序被创建为单独的项目 - 然后用作添加对项目或 DLL 或来自 GAC（或任何你喜欢的地方.....）的引用 :) 因此，不需要目录结构。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T22:56:33.770

嗯...嗯，您的视图可以呈现为任何东西... HTML、XML 等。那么，为什么不是 XAML？我想知道您是否可以通过这种方式让您的 WPF 或 Silverlight 应用程序在 MVC 框架中工作……也就是说，不需要运行 Web 服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-16T15:52:52.843

没有什么能阻止您在桌面应用程序中使用 MVC 模式。事实上，在有网络之前，它就已经在桌面上使用了。

[有关一些示例，请参见 Wikipedia](http://en.wikipedia.org/wiki/Model%E2%80%93View%E2%80%93Controller#Implementations_of_MVC_as_GUI_frameworks)

MVC 仅代表“模型视图控制器”，它描述了使用 MVC 模式将关注点彼此分离的方式。

至于在桌面上使用 ASP.NET MVC，有一些问题。一方面，它依赖于 HTTP 请求和响应。您将需要一个服务器层作为应用程序架构的一部分来侦听请求并发送响应。其次，ASP.NET MVC 视图实际上只是简单的 HTML 文本文件，旨在由 Web 浏览器解释。因此，您需要一个 HTML 呈现组件作为 GUI 前端。您可能还需要一个 CSS 渲染引擎和一个 JavaScript 解释器。

基本上，您所要做的就是运行一个专用浏览器作为前端，一个本地 Web 服务器作为后端。

因为已经有很多很棒的 MVC 框架，所以真的不需要太多。还有一些密切相关的模式，如 MVP（模型视图演示器）和 MVVM（模型-视图-视图模型）。例如，许多 WPF（Windows Presentation Framework）应用程序都是 MVVM。

# asp.net-mvc - 无法使用 smtpclient 通过 localhost iis 站点发送邮件

> ID：326853
> 
> 赞同：4
> 
> 时间：2008-11-28T22:52:55.807
> 
> 标签：asp.net-mvc, sockets, system.net.mail

我有一个在本地 iis 网站上运行的 asp.net mvc 应用程序无法使用 System.Net.Mail 中的 SmtpClient 发送邮件。我正在尝试向我的 hotmail 地址发送邮件，但出现套接字异常。知道问题可能是什么吗？

```
using(var message = new MailMessage())
            {
                message.From = new MailAddress(AdminEmail);
                message.To.Add(new MailAddress(to));
                message.Subject = subject;
                message.Body = body;
                message.IsBodyHtml = false;

                var mailClient = new SmtpClient();
                mailClient.Send(message);
            } 
```

这是一个例外：

```
{System.Net.Sockets.SocketException: No connection could be made because the target machine actively refused it 127.0.0.1:25
   at System.Net.Sockets.Socket.DoConnect(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.InternalConnect(EndPoint remoteEP)
   at System.Net.ServicePoint.ConnectSocketInternal(Boolean connectFailure, Socket s4, Socket s6, Socket& socket, IPAddress& address, ConnectSocketState state, IAsyncResult asyncResult, Int32 timeout, Exception& exception)} 
```

我认为默认应用程序池无权访问 intepub\wwwroot。这是我在尝试测试连接时遇到的错误：

服务器配置为使用带有内置帐户的直通身份验证来访问指定的物理路径。但是，IIS 管理器无法验证内置帐户是否具有访问权限。确保应用程序池标识对物理路径具有读取权限。如果此服务器已加入域，并且应用程序池标识为 NetworkService 或 LocalSystem，请验证 \$ 是否具有对物理路径的读取访问权限。然后再次测试这些设置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T00:42:45.257

根据您对我在 Joe 上面的评论的回答，您的本地计算机上没有启用 SMTP。Vista 不附带 SMTP。

因此，您要么必须安装将在 Vista 上运行的第 3 方 SMTP 应用程序，要么使用其他应用程序发送邮件，在这种情况下，您的 Hotmail 帐户可能允许您通过它发送邮件。我不使用 Hotmail，所以不知道它是否会，但它应该类似于 smtp.hotmail.com 和您的凭据。我的主要帐户是 gmail 帐户，因此我可以通过 smtp.gmail.com 使用它，当然还有我的凭据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T02:04:05.107

对于本地计算机上的开发，您还可以使用放置文件夹：

[http://www.codersbarn.com/post/2008/11/30/ASPNET-Contact-Form.aspx](http://www.codersbarn.com/post/2008/11/30/ASPNET-Contact-Form.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T00:27:23.370

与其尝试在本地设置 SMTP，不如将 SMTP 连接配置为直接通过 hotmail 发送，只需将配置元素添加到 web.config 以启用所有内容。

**编辑**

我认为我前一段时间写的[这篇文章](http://www.mitchelsellers.com/blogs/articletype/articleview/articleid/29.aspx)可能会对您有所帮助。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-01T15:43:18.450

尝试显式设置 SmtpClient 的主机。

例如：
SmtpClient mailClient = new SmtpClient();

mailClient.Host = "127.0.0.1";

mailClient.Send(消息);

# git - Git Woes：在 windows 上编辑，现在在 linux 上出现问题

> ID：326857
> 
> 赞同：5
> 
> 时间：2008-11-28T22:55:33.007
> 
> 标签：git

问题：

```
edited files on windows, using git-bash, to fix IE7 problems

committed, pushed to github repo

booted back into linux

pulled from repo

merge conflict in dozens of files

used 'git reset --hard' 
```

我该怎么做才能重回正轨？

更新：请查看以下内容以获得更清晰的图片（没有讽刺意味）

（我认为问题是我经常遇到的一个问题，即 sphinx 文件是平台相关的，我不知道如何在 pull 中跳过它们。）

```
jess@home:~$ cd Rails/nutrograph/
jess@home:~/Rails/nutrograph$ git rm nutrograph/
fatal: pathspec 'nutrograph/' did not match any files
jess@home:~/Rails/nutrograph$ git pull
remote: Counting objects: 29, done.
remote: Compressing objects: 100% (13/13), done.
remote: Total 15 (delta 11), reused 0 (delta 0)
Unpacking objects: 100% (15/15), done.
From git@github.com:shalunov/nutrograph
   1925d73..1ed7f46  master     -> origin/master
Updating 1925d73..1ed7f46
TODO: needs update
app/models/data_link.rb: needs update
app/models/footnote.rb: needs update
app/models/static_chart.rb: needs update
app/views/food_description/index.haml: needs update
app/views/food_description/titles.haml: needs update
app/views/site/about.html.erb: needs update
app/views/static_page/_random_foods.haml: needs update
app/views/static_page/index.haml: needs update
app/views/static_page/show.haml: needs update
app/views/static_page/sweet-potato-cooked-boiled-without-skin: needs update
config/development.sphinx.conf: needs update
config/environment.rb: needs update
db/migrate/10_create_food_comparisons.rb: needs update
db/sphinx/development/food_description_core.spa: needs update
db/sphinx/development/food_description_core.sph: needs update
db/sphinx/development/food_description_core.spl: needs update
public/static_pages/beans-snap-green-cooked-boiled-drained-with-salt: needs update
public/static_pages/butter-salted: needs update
public/static_pages/cheese-muenster: needs update
public/static_pages/sweet-potato-cooked-boiled-without-skin: needs update
test/fixtures/data_links.yml: needs update
test/fixtures/footnotes.yml: needs update
test/fixtures/static_charts.yml: needs update
test/unit/static_chart_test.rb: needs update
vendor/plugins/haml/init.rb: needs update
error: Entry 'app/views/static_page/index.haml' not uptodate. Cannot merge.
jess@home:~/Rails/nutrograph$ l
app/     CSV_files/  doc/  log/            public/   README.rdoc  spec/     test/  TODO             vendor/
config/  db/         lib/  Nutrograph.pdf  Rakefile  script/      stories/  tmp/   utf8_general_ci
jess@home:~/Rails/nutrograph$ mkdir backup
jess@home:~/Rails/nutrograph$ cd backup/
jess@home:~/Rails/nutrograph/backup$ git clone git@github.com:shalunov/nutrograph.git
Initialized empty Git repository in /home/jess/Rails/nutrograph/backup/nutrograph/.git/
remote: Counting objects: 2346, done.
remote: Compressing objects: 100% (2025/2025), done.
remote: Total 2346 (delta 958), reused 996 (delta 146)
Receiving objects: 100% (2346/2346), 19.74 MiB | 373 KiB/s, done.
Resolving deltas: 100% (958/958), done.
Checking out files: 100% (867/867), done.
jess@home:~/Rails/nutrograph/backup$ script/server
bash: script/server: No such file or directory
jess@home:~/Rails/nutrograph/backup$ cd nutrograph/
jess@home:~/Rails/nutrograph/backup/nutrograph$ script/server
=> Booting Mongrel (use 'script/server webrick' to force WEBrick)
=> Rails 2.1.2 application starting on http://0.0.0.0:3000
=> Call with -d to detach
=> Ctrl-C to shutdown server
/usr/lib/ruby/gems/1.8/gems/rails-2.1.2/lib/commands/servers/mongrel.rb:57:in `initialize': No such file or directory - /home/jess/Rails/nutrograph/backup/nutrograph/log/development.log (Errno::ENOENT)
    from /usr/lib/ruby/gems/1.8/gems/rails-2.1.2/lib/commands/servers/mongrel.rb:57:in `open'
    from /usr/lib/ruby/gems/1.8/gems/rails-2.1.2/lib/commands/servers/mongrel.rb:57
    from /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
    from /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
    from /usr/lib/ruby/gems/1.8/gems/activesupport-2.1.2/lib/active_support/dependencies.rb:510:in `require'
    from /usr/lib/ruby/gems/1.8/gems/activesupport-2.1.2/lib/active_support/dependencies.rb:355:in `new_constants_in'
    from /usr/lib/ruby/gems/1.8/gems/activesupport-2.1.2/lib/active_support/dependencies.rb:510:in `require'
    from /usr/lib/ruby/gems/1.8/gems/rails-2.1.2/lib/commands/server.rb:39
    from /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
    from /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
    from script/server:3
jess@home:~/Rails/nutrograph/backup/nutrograph$ git merge
usage: git-merge [options] <remote>...
   or: git-merge [options] <msg> HEAD <remote>

    --stat                show a diffstat at the end of the merge
    -n                    don't show a diffstat at the end of the merge
    --summary             (synonym to --stat)
    --log                 add list of one-line log to merge commit message
    --squash              create a single commit instead of doing a merge
    --commit              perform a commit if the merge succeeds (default)
    --ff                  allow fast forward (default)
    -s, --strategy ...    merge strategy to use
    -m, --message ...     message to be used for the merge commit (if any)

jess@home:~/Rails/nutrograph/backup/nutrograph$ git merge origin/master
Already up-to-date.
jess@home:~/Rails/nutrograph/backup/nutrograph$ git pull
Already up-to-date.
jess@home:~/Rails/nutrograph/backup/nutrograph$ cd ../..
jess@home:~/.local/share/Trash/files$ cd
jess@home:~$ cd Rails/nutrograph/
jess@home:~/Rails/nutrograph$ git merge
usage: git-merge [options] <remote>...
   or: git-merge [options] <msg> HEAD <remote>

    --stat                show a diffstat at the end of the merge
    -n                    don't show a diffstat at the end of the merge
    --summary             (synonym to --stat)
    --log                 add list of one-line log to merge commit message
    --squash              create a single commit instead of doing a merge
    --commit              perform a commit if the merge succeeds (default)
    --ff                  allow fast forward (default)
    -s, --strategy ...    merge strategy to use
    -m, --message ...     message to be used for the merge commit (if any)

jess@home:~/Rails/nutrograph$ git merge orgin
orgin - not something we can merge
jess@home:~/Rails/nutrograph$ git merge orgin/master
orgin/master - not something we can merge
jess@home:~/Rails/nutrograph$ git rebase orgin/master
TODO: needs update
app/views/static_page/index.haml: needs update
config/development.sphinx.conf: needs update
config/environment.rb: needs update
db/sphinx/development/food_description_core.spa: needs update
db/sphinx/development/food_description_core.sph: needs update
vendor/plugins/haml/init.rb: needs update
jess@home:~/Rails/nutrograph$ git reset --hard
HEAD is now at 1925d73 got rid of "Nutrition Facts" in view
jess@home:~/Rails/nutrograph$ git pull
Updating 1925d73..1ed7f46
Fast forward
 app/views/layouts/application.haml |   25 +++++++++++--------------
 app/views/static_page/index.haml   |    6 +++---
 nutrograph                         |    1 +
 public/javascripts/tabs.js         |    4 +++-
 public/stylesheets/sass/site.sass  |   16 +++++++++-------
 public/stylesheets/site.css        |   14 ++++++++------
 6 files changed, 35 insertions(+), 31 deletions(-)
 create mode 160000 nutrograph
jess@home:~/Rails/nutrograph$ script/server
=> Booting Mongrel (use 'script/server webrick' to force WEBrick)
=> Rails 2.1.2 application starting on http://0.0.0.0:3000
=> Call with -d to detach
=> Ctrl-C to shutdown server
** Starting Mongrel listening at 0.0.0.0:3000
** Starting Rails with development environment...
** Rails loaded.
** Loading any Rails specific GemPlugins
** Signals ready.  TERM => stop.  USR2 => restart.  INT => stop (no restart).
** Rails signals registered.  HUP => reload (without restart).  It might not work well.
** Mongrel 1.1.5 available at 0.0.0.0:3000
** Use CTRL-C to stop.

Processing SiteController#index (for 127.0.0.1 at 2008-11-28 16:45:38) [GET]
  Session ID: aa0ab6213969dc2ce78472f9c5f57258
  Parameters: {"action"=>"index", "controller"=>"site"}
  SQL (0.000153)   SET NAMES 'utf8'
  SQL (0.000077)   SET SQL_AUTO_IS_NULL=0
  StaticPage Columns (0.000841)   SHOW FIELDS FROM `static_pages`
 .
 .
 .
 .
Rendering template within layouts/application
Rendering static_page/index
Completed in 0.69965 (1 reqs/sec) | Rendering: 0.34820 (49%) | DB: 0.26384 (37%) | 200 OK [http://localhost/4000-beef-round-top-round-separable-lean-only-trimmed-to-quarter-inch-fat-select-cooked-braised]
^C** INT signal received.
Exiting
jess@home:~/Rails/nutrograph$ git pull
Already up-to-date.
jess@home:~/Rails/nutrograph$ git rebase origin/master
vendor/plugins/haml/init.rb: needs update
jess@home:~/Rails/nutrograph$ git pull
Already up-to-date.
jess@home:~/Rails/nutrograph$ git pull origin/master
fatal: 'origin/master': unable to chdir or not a git archive
fatal: The remote end hung up unexpectedly
jess@home:~/Rails/nutrograph$ git rebase origin/master
vendor/plugins/haml/init.rb: needs update
jess@home:~/Rails/nutrograph$ rm vendor/plugins/haml/init.rb 
jess@home:~/Rails/nutrograph$ rm vendor/plugins/haml/init.rb 
rm: cannot remove `vendor/plugins/haml/init.rb': No such file or directory
jess@home:~/Rails/nutrograph$ haml --rails .
Directory ./vendor/plugins/haml already exists, overwrite [y/N]? y
Haml plugin added to .
jess@home:~/Rails/nutrograph$ git rebase origin/master
vendor/plugins/haml/init.rb: needs update
jess@home:~/Rails/nutrograph$ git fetch origin
jess@home:~/Rails/nutrograph$ git merge origin/master
Already up-to-date.
jess@home:~/Rails/nutrograph$ git rebase origin/master
vendor/plugins/haml/init.rb: needs update
jess@home:~/Rails/nutrograph$ git pull
Already up-to-date.
jess@home:~/Rails/nutrograph$ 
```

* * *

这实际上不是换行问题，因为我将 e 文本编辑器设置为使用 unix 样式的行尾。寿，在这一点上，我不知道问题是什么，只是我需要一个解决方案。

您是否忽略了我运行了 `git reset --hard' ？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-28T22:59:06.213

听起来您需要在 Windows 中设置行尾选项：

```
git config core.autocrlf true 
```

这将在 Windows 上将行尾从 LF 转换为 CRLF，然后在`git add`. 没有这个，git 认为你把整个文件的行尾从 LF 改成了 CRLF，这很可能导致合并冲突。

此外，您的描述听起来像是您可能试图在双启动情况下在 Windows 和 Linux 之间共享相同的工作存储库。由于上述原因，我不建议这样做。为每个操作系统使用单独的存储库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T18:46:19.750

我不确定你为什么要发布整个成绩单，它确实表明你不仅仅是有行尾问题。也许您认为您遇到的几个问题都有一个原因。

我猜你是在你的 linux 系统上创建了这个 repo，然后把它上传到 GitHub，然后克隆到你的 Windows 系统。当你克隆一个 repo 时，Git 会设置一些配置参数，以便它知道`git pull`以后该怎么做，但是当你创建一个远程存储库时，你必须手动设置这些参数。（这在我见过的任何地方都没有明确记录。）

创建 GitHub 存储库后，您可以在 linux 系统上进行设置：

```
$ git config branch.master.remote origin
$ git config branch.master.merge refs/heads/master 
```

这些配置 git 以便将来从此 repo 中的 git pull 将自动合并所有远程更改。有了这些，你`pull`就可以工作了。

将远程存储库克隆到子目录中很好地解决了这个问题，因为克隆确实设置了配置，以便从您的 linux 系统中进行拉取。将 'origin' 拼写为 'orgin' 可能掩盖了你的 pull 会起作用的事实。

如果这对您有意义，我建议您删除启动 Rails 的记录，以便更容易专注于您遇到的其他问题。

# visual-studio - 在 Visual Studio 中调试时如何管道输出？

> ID：326862
> 
> 赞同：1
> 
> 时间：2008-11-28T22:58:38.493
> 
> 标签：visual-studio

例如，如果我想从命令行执行此操作，我会使用“a.exe > out.txt”。调试 (F5) 时是否可以在 Visual Studio 中执行类似操作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T23:29:44.017

在项目属性中：

*   输入命令行参数“> out.txt”
*   禁用托管进程

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T23:40:32.903

只是检查一下，您不是在使用类似的东西在 Visual Studio 中寻找输出

> System.Diagnostics.Debug.WriteLine("进入输出窗口");

正确的？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T00:06:36.967

您可以使用项目属性中的“命令参数”进行重定向。

你也可以从你的程序中重定向 stdout/err/in。以后在 C++ 中找到一个示例，与第一个更简单的解决方案相比，唯一的优势是可移植。

```
#include <iostream>
#include <string>
#include <fstream>

using namespace std;

int main ()
{
#ifdef _DEBUG
    ofstream mout("stdout.txt");
    cout.rdbuf(mout.rdbuf());
#endif
    cout<< "hello" ;
    return 0;
} 
```

# java - JInternalFrame 在 Mac OS X 下没有完全最大化

> ID：326868
> 
> 赞同：2
> 
> 时间：2008-11-28T23:05:28.417
> 
> 标签：java, macos, jinternalframe

我在 Mac OS X Java 5 下使用 JInternalFrame，当在 JDesktopPane 中最大化 JInternalFrame 时，窗口不会完全最大化，但允许最大化的属性肯定设置为 true。这是我最大化时得到的结果：

[好像图像预览不起作用。](http://www.kieransenior.co.uk/pics/jinternalframe.png)

我不知道为什么会这样。这是我的代码。

```
 JInternalFrame f = new JInternalFrame("irc.quakenet.org - #overclockers", true, true, true, true);
    f.setVisible(true);
    f.setSize(300,300);
    f.setEnabled(true);
    f.setMaximizable(true);
    try {
        f.setSelected(true);
    } catch (PropertyVetoException e) {
        e.printStackTrace();
    } 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T11:06:06.823

Swing 可能尊重您无法在 Mac 上完全最大化窗口的事实。就像，如果你最大化一个真实的窗口，它只会变大，但不会填满整个屏幕。桌面窗格可能正在模拟这种行为。

您可以通过侦听最大化事件并手动设置窗口边界以精确填充桌面窗格来覆盖它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T13:39:32.613

确实如此，Mac OS 并没有完全最大化窗口。问题是我不会仅仅通过设置活动窗口的大小来实现“停靠”窗口的效果，这意味着很可能需要一种不同的方法。不过，这似乎是解决问题的常用方法。

# verilog - 硬件描述语言（Verilog、VHDL 等）的最佳实践是什么？

> ID：326880
> 
> 赞同：71
> 
> 时间：2008-11-28T23:17:09.127
> 
> 标签：verilog, vhdl, hdl

实现 HDL 代码时应遵守哪些最佳实践？

与更常见的软件开发领域相比，有哪些共同点和不同点？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2011-03-13T18:46:47.313

有点旧线程，但想投入我的 0.02 美元。这并不是 Verilog/VHDL 所特有的……更多关于硬件设计的一般信息……特别是针对定制 ASIC 的可综合设计。

这是我基于多年的行业（而不是学术）设计经验得出的*观点。*它们没有特定的顺序

我的总括性声明是为验证执行而设计。在硬件设计中，验证是最重要的。在实际硅中发现错误时要昂贵得多。你不能只是重新编译。因此，前硅得到了更多的关注。

*   了解控制路径和数据路径之间的区别。这使您能够创建更优雅和可维护的代码。还允许您节省门并最小化 X 传播。例如，数据路径永远不需要可复位触发器，控制路径应该总是需要它。

*   在验证之前证明功能。通过正式的方法或通过波形。这有很多优点，我将解释 2。首先，它可以节省您在洋葱剥皮问题上浪费的时间。与许多应用程序级设计（尤其是在学习时）和大多数课程作业不同，代码更改的周转时间非常长（从 10 分钟到几天不等，具体取决于复杂性）。每次更改代码时，您都需要进行详细说明、lint 检查、编译、波形调出，最后是实际仿真……这本身可能需要数小时。其次，您不太可能遇到难以解决的问题。请注意，这是关于硅前验证的。这些肯定会击中后硅成本你很多$$$。相信我，验证功能的前期成本极大地降低了风险，值得付出努力。这有时很难说服最近的大学毕业生。

*   有“鸡块”。鸡位是通过驱动程序设置的 MMIO 中的位，用于禁用芯片中的功能。它旨在恢复置信度不高的更改（置信度与验证工作成正比）。在前硅中达到所有可能的状态几乎是不可能的。除非在后硅片中得到证明，否则无法真正满足您对设计的信心。即使只有 1 个状态在 0.000005% 的时间内被击中暴露错误，它也会在后硅中击中，但不一定在前硅中。

*   不惜一切代价避免控制路径中的异常。您遇到的每一个新异常都会使您的验证工作加倍。这个很难解释。假设有一个 DMA 块可以将数据保存到另一个块将使用的内存中。可以说保存的数据结构取决于正在完成的某些功能。如果您决定设计使得不同函数之间保存的数据结构不同，您只需将验证工作乘以 DMA 函数的数量。如果遵循此规则，则保存的数据结构将是所有数据的超集，可用于对内容位置进行硬编码的每个函数。一旦 DMA 保存逻辑针对 1 个功能进行验证，它就针对所有功能进行验证。

*   最小化接口（读取最小化控制路径）。这与最小化异常有关。首先，每个新接口都需要验证。这包括测试台中的新检查器/跟踪器、断言、覆盖点和总线功能模型。其次，它可以成倍地增加您的验证工作！假设您有 1 个接口用于读取缓存中的数据。现在让我们说（出于某种奇怪的原因）您决定需要另一个接口来读取主内存。您只是将验证工作量翻了两番。您现在需要在任何给定时间验证这些组合*n*：

    *   不读取缓存，不读取内存
    *   没有缓存读取，内存读取
    *   缓存读取，不读取内存
    *   缓存读取，内存读取
*   理解和交流假设。缺乏这一点是块到块通信问题的主要原因。您可以拥有一个完全验证的完美区块。但是，如果不了解所有假设，您的区块将在连接时失败。

*   最小化潜在状态。设计的状态（有意或无意）越少，验证所需的工作就越少。将类似函数分组为 1 个顶级函数（如序列器和仲裁器）是一种很好的做法。很难识别和定义这个高级函数以使其包含尽可能多的较小函数，但这样做可以极大地消除状态，进而消除潜在的错误。

*   始终提供离开街区的强信号。大多数情况下，失败是解决方案。您不知道端点块将如何处理它。您可能会遇到时间问题，这会对您的完美实施产生直接影响。

*   除非性能受到负面影响，否则避免使用粉状 FSM。与摩尔相比，Mealy FSM 更有可能产生时序问题

*   .. 最后是我最不喜欢的一个：“如果它没有坏，就不要修复它”由于涉及的风险和错误的高成本，很多时候黑客是解决问题的更实际的解决方案。其他人则通过提及现有组件的利用来避开这一点。

至于与更*传统*的软件设计进行比较：

*   离散事件驱动编程是一种完全不同的范式。人们看到 verilog 语法并认为“哦，它就像 C”......然而，事实并非如此。尽管语法相似，但人们必须有不同的想法。例如，传统的调试器在可综合的 RTL 上几乎没有意义（测试台设计不同）。纸上的波形是最好的工具。然而，话虽如此，FSM 设计有时可以模仿过程编程。具有软件背景的人往往对 FSM 很着迷（我知道我一开始就是这样做的）。

*   System Verilog 有很多很多（和很多）测试台特定的功能。它是完全面向对象的。就测试台设计而言，它与传统的软件设计非常相似。但是，它确实还有一个与之相关的维度，即时间。必须考虑竞争条件和协议延迟

*   至于验证，它也是不同的（和相同的）。有3种主要方法；

    *   形式传播验证（FPV）：你通过逻辑证明它永远有效
    *   定向随机测试。随机设置由种子定义的延迟、输入值和功能启用。 *定向*意味着种子将权重放在置信度较低的路径上。这种方法使用覆盖点来指示健康状况
    *   重点测试。这类似于传统的软件测试

...为了完整起见，我还需要讨论最佳测试台设计实践...但那是另一天

对不起，长度..我在“区域”:)

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-12-03T16:22:23.737

关于这个主题的最好的书是[Reuse Methodology Manual](http://www.amazon.com/exec/obidos/tg/detail/-/1402071418/ref=ase_penguintelecomin/102-8353601-4848123?v=glance&s=books)。它涵盖了 VHDL 和 Verilog。

特别是一些在软件中没有完全匹配的问题：

*   没有闩锁
*   小心重置
*   检查您的内部和外部时间
*   仅使用可综合的代码
*   注册所有模块的输出
*   小心阻塞与非阻塞分配
*   小心组合逻辑的敏感列表（或在 Verilog 中使用 @(*)）

一些相同的包括

*   使用 CM
*   进行代码审查
*   测试（模拟）你的代码
*   适当时重用代码
*   有一个最新的时间表
*   有规范或用例或敏捷客户

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-04-29T22:26:23.543

HDL 之类的 Verilog 和 VHDL 似乎确实鼓励意大利面条式代码。大多数模块由几个“总是”（Verilog）或“进程”（VHDL）块组成，它们可以按任何顺序排列。模块的整体算法或功能通常是完全模糊的。弄清楚代码是如何工作的（如果你没有编写它）是一个痛苦的过程。

几年前，我看到了[这篇论文](http://www.gaisler.com/doc/vhdl2proc.pdf)，它概述了一种更结构化的 VHDL 设计方法。基本思想是每个模块只有 2 个进程块。一个用于组合代码，另一个用于同步（寄存器）。它非常适合生成可读和可维护的代码。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-18T11:41:58.830

*   在 HDL 中，代码的某些部分可以同时工作，例如两行代码“可以同时工作”，这是一个优势，明智地使用。这是习惯于逐行语言的程序员一开始可能很难掌握的东西：

    *   可以根据您的需求创建长且特定的管道。
    *   你可以让你的大模块同时工作。
    *   您可以创建多个单元并并行执行工作，而不是一个单元对不同的数据执行重复操作。
*   应该特别注意引导过程——一旦你的芯片正常工作，你就大功告成了。

在硬件上调试通常比调试软件要困难得多，因此：

*   简单的代码是首选，有时还有其他方法可以加速你的代码，在它已经运行之后，例如使用更高速度的芯片等。

*   避免组件之间的“智能”协议。

*   HDL 中的工作代码比其他软件更宝贵，因为硬件很难调试，所以重用，并且还考虑使用模块的“库”，有些是免费的，有些是出售的。

*   设计不仅应考虑 HDL 代码中的错误，还应考虑您正在编程的芯片以及与芯片接口的其他硬件设备上的故障，因此应该真正考虑一种易于检查的设计。

一些调试技巧：

*   如果设计包含多个构建块，则可能希望创建从这些块之间的接口到芯片外部测试点的线路。

*   您需要在设计中保存足够多的行，以便将有趣的数据转移到外部设备进行检查。您也可以使用这些行和代码作为告诉您当前执行状态的一种方式 - 例如，如果您在某个时候收到数据，则将一些值写入行，在执行的后期您写入另一个值， ETC'

    如果您的芯片是可重新配置的，这将变得更加方便，因为您可以定制特定的测试，并随时为每个测试重新编程输出（这看起来非常适合 LED :)。)

**编辑：**

通过智能协议，我的意思是如果你的两个物理单元连接，它们应该使用最简单的通信协议进行通信。也就是说，不要在它们之间使用任何复杂的自制协议。

原因是这样的——在 FPGA/ASIC 的“内部”查找错误非常容易，因为你有模拟器。因此，如果您确定数据如您所愿，并在您的程序发送时发出，您就达到了硬件乌托邦——能够在软件级别工作:)（使用模拟器）。但是，如果您的数据无法以您想要的方式到达您的手中，并且您必须找出原因……您将不得不连接到线路，这并不容易。

在线路上查找错误很难，因为您必须使用特殊设备连接到线路，记录线路在不同时间的状态，并且您必须确保您的线路按照协议运行。

如果您需要连接两个物理单元，请使“协议”尽可能简单，直到它不会被称为协议:) 例如，如果这些单元共享一个时钟，则在它们之间添加 x 条数据线，并让一个单元写入这些，另一个单元读取，例如，在每个时钟下降时传递一个在它们之间有 x 位的“字”。如果您有 FPGA，如果原始时钟速率对于并行数据来说太快 - 您可以根据您的实验控制其速度，例如使数据保持在至少“t”时钟周期等的线上。我假设并行数据传输更简单，因为您可以在较低的时钟频率下工作并获得相同的性能，而无需在一个单元上拆分您的单词并在另一个单元上重新组装。（希望每个单元接收的“时钟”之间没有延迟）。即使这可能太复杂了:)

关于 SPI、I2C 等，我没有实现它们中的任何一个，我可以说我已经连接了两个运行在同一个时钟上的 FPGA 的腿，（不记得中间电阻的确切形成），很多更高的速率，所以我真的想不出一个很好的理由来使用它们，作为在您自己的 FPGA 之间传递数据的主要方式，除非 FPGA 彼此相距很远，这是使用串行而不是比并行总线。

[一些 FPGA 公司使用JTAG](http://en.wikipedia.org/wiki/Joint_Test_Action_Group)来测试/编程他们的产品，但不确定它是否被用作高速传输数据的方式，并且它是一种协议......（仍然可能有一些内置的芯片支持）。

如果您确实必须实现任何已知协议，请考虑为此使用预制的 HDL 代码 - 可以找到或购买。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-18T09:46:58.160

## 这是需要 JBDAVID 的 10 条硬件设计戒律的问题。

1.  使用修订/版本控制，就像在软件中一样。SVN 和 Hg 是免费的。
2.  要求代码在签入前通过语法检查。LINT 工具更好。
3.  使用全强度硬件验​​证语言进行设计验证。System-Verilog 几乎是一个安全的选择。
4.  跟踪错误。Bugzilla 和 GNATS 是免费工具。FogBugz 需要一点美元。
5.  使用断言来发现错误使用的问题。
6.  Coverage Triad 可实现稳定的设计：在模拟和正式工具中测量代码覆盖率、功能覆盖率和断言覆盖率。
7.  权力为王：使用 CPF 或 UPF 来捕获、执行和验证您的权力意图。
8.  真正的设计通常是混合信号，使用混合信号语言来验证模拟与数字。Verilog-AMS 就是这样一种解决方案。但不要过火。实数建模可以完成混合信号行为的大部分功能方面。
9.  使用硬件加速来验证必须与芯片配合使用的软件！
10.  HDL/HVL 的语法感知文本编辑器是开发人员 IDE 的最低要求。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-02-18T17:58:03.067

对于 FPGA，Xilinx 有[这个页面](https://www.xilinx.com/support/documentation/white_papers/wp231.pdf)。几乎所有这些都适用于其他 FPGA 供应商，或者会有相同的规则。很多东西都适用于 ASIC 设计。

[英特尔在此页面下](https://www.intel.com/content/www/us/en/programmable/products/design-software/fpga-design/quartus-prime/user-guides.html)提供了推荐的 HDL 编码风格和设计建议 (PDF) 。

# asp.net - 帮助 - 在 Vista 上为 IIS7 启用 ASP.NET 失败

> ID：326882
> 
> 赞同：0
> 
> 时间：2008-11-28T23:18:51.057
> 
> 标签：asp.net, iis-7, windows-vista

我实际上无法通过“打开或关闭 Windows 功能”对话框安装任何 Windows 功能。我试图让 ASP.NET 在 Vista Ultimate 上为 IIS7 工作。

我也尝试运行 aspnet_iisreg -i 但出现未指定的错误。

我检查了几个地方，但没有一个解决方案有效。它们主要与 applicationhosts.config 中的重复 mime 类型有关（没有）。

有谁知道如何解决这个问题？

瑞安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T03:17:00.967

尝试`SFC /scannow`从命令提示符运行，然后检查日志`%windir%\logs\cbs\cbs.log`以查看它是否对 .net 框架（在 vista 中被视为系统组件）进行了任何修复。

-Oisin

# unit-testing - 如何对（在内存中）实体框架进行单元测试？

> ID：326883
> 
> 赞同：2
> 
> 时间：2008-11-28T23:19:16.890
> 
> 标签：unit-testing, entity-framework, poco

如题...

我在考虑类似“内存变化”之类的东西。在 Jaroslaw Kowalski 最近的博客上，我发现了类似的方法，但我想的东西要简单得多

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T23:32:10.813

如果框架由（抽象）类组成，您可以创建虚拟具体类并对它们进行单元测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-28T23:51:05.890

除非您正在构建/修改框架本身，否则您不需要对其进行单元测试。

至于您定义的单元测试实体类，我会推荐以下内容。1\. 创建一个使用[内存数据库](http://martinfowler.com/bliki/InMemoryTestDatabase.html)的存根实现。这将允许您测试类交互。2\. 以业务逻辑不需要实体框架并直接对它们进行单元测试的方式设计您的类。

# c++ - 在 3d 空间中创建邻居节点的循环

> ID：326885
> 
> 赞同：2
> 
> 时间：2008-11-28T23:20:57.200
> 
> 标签：c++, algorithm

我想在 3-d 空间中创建一个立方体素节点的 26 个邻居。输入是节点的 x,y,z 位置和立方体边的大小。我正在尝试使用 for 循环来执行此操作，但尚未管理。我是编程的新手，请帮助我。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-28T23:25:13.337

```
for (int dz = z - 1; dz <= z + 1; ++dz)
{
  for (int dy = y - 1; dy <= y + 1; ++dy)
  {
    for (int dx = x - 1; dx <= x + 1; ++dx)
    {
      // all 27
      if ((dx != x) || (dy != y) || (dz != z))
      {
        // just the 26 neighbors
      }
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T21:27:18.957

这是一个没有嵌套循环的变体。我尝试使用与[您的问题](https://stackoverflow.com/questions/327531/can-i-optimize-code-that-has-3-for-loops-and-4-ifs)符号类似的符号。

```
// g++ 26neighbours.cpp -o 26neighbours && 26neighbours 
#include <algorithm>
#include <iostream>
#include <iterator>
#include <vector>

namespace {
  struct Pos {
    double x, y, z;

    template<class Char, class Traits>
    friend std::basic_ostream<Char, Traits>& 
    operator<< (std::basic_ostream<Char, Traits>& out, const Pos& p)
    {
      return out << p.x << " " << p.y << " " << p.z;
    }

    explicit Pos(double x_ = 0, double y_ = 0, double z_ = 0) 
      : x(x_), y(y_), z(z_)
    {
    }
  };

  template <class OutputPosIterator, class InputPosIterator, class Number>
  void translate(OutputPosIterator first, OutputPosIterator last, 
         InputPosIterator delta, Number factor)
  {
    for ( ; first != last; ++first, ++delta) {
      first->x += delta->x * factor;
      first->y += delta->y * factor;
      first->z += delta->z * factor;
    }
  }
}

int main(int argc, char *argv[])
{
  const Pos delta[] = {
    // ruby -e"(-1..1).each{|i| (-1..1).each{|j| (-1..1).each{|k| printf(\"Pos(%2d,%2d,%2d),\n\", i, j, k) if (i!=0 || j!=0 || k!=0)}}}"
    Pos(-1,-1,-1),
    Pos(-1,-1, 0),
    Pos(-1,-1, 1),
    Pos(-1, 0,-1),
    Pos(-1, 0, 0),
    Pos(-1, 0, 1),
    Pos(-1, 1,-1),
    Pos(-1, 1, 0),
    Pos(-1, 1, 1),
    Pos( 0,-1,-1),
    Pos( 0,-1, 0),
    Pos( 0,-1, 1),
    Pos( 0, 0,-1),
    Pos( 0, 0, 1),
    Pos( 0, 1,-1),
    Pos( 0, 1, 0),
    Pos( 0, 1, 1),
    Pos( 1,-1,-1),
    Pos( 1,-1, 0),
    Pos( 1,-1, 1),
    Pos( 1, 0,-1),
    Pos( 1, 0, 0),
    Pos( 1, 0, 1),
    Pos( 1, 1,-1),
    Pos( 1, 1, 0),
    Pos( 1, 1, 1),
  };
  const int N = sizeof(delta) / sizeof(*delta);

  // find neighbours of somePos
  double cube_size = 0.5; 
  Pos somePos(0.5, 0.5, 0.5);

  std::vector<Pos> neighbours(N, somePos);  
  translate(neighbours.begin(), neighbours.end(), delta, cube_size);

  // print neighbours
  std::copy(neighbours.begin(), neighbours.end(), 
        std::ostream_iterator<Pos>(std::cout, "\n"));
  std::cout << std::endl;

  return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T16:42:40.577

```
for(int i = 0; i < 27, i++)
{
   if(i == 13) continue;
   int dx = i%3 -1;
   int dy = (i/3)%3 -1;
   int dz = i/9 - 1;

   process(x+dx,y+dy,z+dz);
} 
```

# php - 如何在 PHP 中自动设置用户的语言环境？

> ID：326891
> 
> 赞同：8
> 
> 时间：2008-11-28T23:27:48.183
> 
> 标签：php, internationalization, locale

有没有一种简单的方法来解析用户的 HTTP_ACCEPT_LANGUAGE 并在 PHP 中设置语言环境？

我知道 Zend 框架有一种方法可以做到这一点，但我宁愿不安装整个框架只是为了使用那一点功能。

PEAR I18Nv2 包处于测试阶段，近三年没有更改，所以如果可能的话，我宁愿不使用它。

如果它能够确定服务器是否在 Windows 上运行也很好，因为 Windows 的语言环境字符串与世界其他地方的字符串不同......（德语是“deu”或“german”而不是“de”。 )

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T10:39:32.213

这并不像应该的那么容易（以我的拙见）。首先，您必须从中提取语言环境并按其值`$_SERVER['HTTP_ACCEPT_LANGUAGE']`对它们进行排序。`q`之后，您必须为每个给定的语言环境检索适当的系统语言环境，这在 *nix 机器上应该没问题（您可能只需要处理正确的字符集），但在 Windows 上，您必须将语言环境转换为例如，Windows 语言环境`de_DE`将是`German_Germany`（同样，如果您在应用程序中使用 UTF-8，您还必须处理字符集问题）。我认为你必须为这个问题建立一个查找表 - 并且有很多语言环境;-)

不，您尝试一个接一个的语言环境（按降序排列`q`），直到找到匹配项（如果无法设置给定的语言环境，[`setlocale()`](http://de2.php.net/manual/en/function.setlocale.php)该函数将返回）。`false`

但接下来会有最后一个障碍需要应对：

> 语言环境信息是按进程维护的，而不是按线程维护的。如果您在 Windows 上的 IIS 或 Apache 等多线程服务器 api 上运行 PHP，您可能会在脚本运行时遇到语言环境设置的突然更改，尽管脚本本身从未调用 setlocale() 本身。这是由于在同一进程的不同线程中运行的其他脚本同时使用 setlocale() 更改了进程范围的语言环境。

（见：[http](http://de2.php.net/manual/en/function.setlocale.php) ://de2.php.net/manual/en/function.setlocale.php ）

这意味着您可能会在执行脚本期间遇到突然的区域设置更改，因为具有不同区域设置的另一个用户刚刚访问了您的网页。

因此，上面提到的[`Zend_Locale`](http://framework.zend.com/manual/en/zend.locale.html)不依赖于 PHP 函数`setlocale()`（它仅用于检索系统区域设置信息），而是使用基于[Unicode CLDR Project](http://www.unicode.org/cldr/)提供的数据的系统。这使得组件独立于所有这些`setlocale()`问题，但这也引入了一些其他缺陷，例如缺乏对区域感知字符串操作的支持（例如排序）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T02:09:13.850

不错的解决方案即将[推出](http://php.net/manual/en/locale.acceptfromhttp.php)。

没有它，您将需要解析该标头。它是以逗号分隔的以分号分隔的语言环境和属性列表。

它看起来像这样：

```
en_US, en;q=0.8, fr_CA;q=0.2, *;q=0.1 
```

然后尝试每个语言环境，直到`setlocale()`接受它。准备好它们都不匹配。

不要基于它太重要或允许用户覆盖它，因为某些用户可能配置错误的浏览器。

* * *

对于 Windows 语言环境，也许您需要将 ISO 639-1 名称转换为 ISO 639-2/3？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T11:04:38.293

> 我知道 Zend 框架有一种方法可以做到这一点，但我宁愿不安装整个框架只是为了使用那一点功能。

Zend 的好消息是，您不需要全部安装。这是一个松散耦合的框架，您可以只使用 Zend_Locale 而无需使用任何其他组件。也许您想将它与 Zend_Translate 结合使用。

[看看这个](http://framework.zend.com/manual/en/zend.locale.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T12:02:36.647

有[`http_negotiate_language`](http://www.php.net/manual/en/function.http-negotiate-language.php)，但它取决于 http 扩展名。或者，请参阅手册页上的注释以获取用户空间实现。

# windows - 有什么方法可以通过 WSH 检测 Windows 域中的哪些工作站具有锁定会话？

> ID：326892
> 
> 赞同：0
> 
> 时间：2008-11-28T23:27:49.387
> 
> 标签：windows

有什么方法可以通过 WSH 检测 Windows 域中的哪些工作站具有锁定会话？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T23:41:50.107

[http://www.microsoft.com/technet/scriptcenter/resources/qanda/nov04/hey1115.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/nov04/hey1115.mspx)

如果向下滚动，则会在页面上检查计算机是否已锁定脚本。该脚本基本上抓取机器的运行进程并查找 scrnsave.exe。

还值得注意的是，该脚本的作者表示他不知道确定计算机是否被锁定的万无一失的方法。希望这有助于或至少为您指明正确的方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-02T22:51:36.773

不确定您是使用 lock 还是 in locked，但我使用 pstools 检查打开屏幕锁定的系统。我的命令行是：

pslist \machinename > machinename.txt

然后检查 machine_name.txt 文件中的 login.scr 是否存在屏幕被锁定。

# sql-server-2005 - 使用 sqlserver 2005 中的 asp 检索 unicode

> ID：326905
> 
> 赞同：1
> 
> 时间：2008-11-28T23:36:56.653
> 
> 标签：sql-server-2005, unicode, asp-classic, vbscript

我正在使用以下代码从数据库中检索消息，然后将其写入 html 页面：

```
Dim strDSN, cnn, cmd
strDSN = "Driver={SQL Server};" & "Server=(local)\sql2k5;" & ...
set cnn = Server.CreateObject("ADODB.Connection")
cnn.ConnectionString = strDSN
cnn.CursorLocation = adUseClient
cnn.Open
set cmd = Server.CreateObject("ADODB.Command")
set cmd.ActiveConnection = cnn
cmd.CommandText = "select Message from tblRecipients where ID = 72"
cmd.CommandType = adCmdText
set getRecordset = Server.CreateObject("ADODB.Recordset")
getRecordset.Open cmd, , adOpenKeyset, adLockReadOnly

Response.write getRecordset("Message") 
```

但是我得到的只是“？？？？？？”。我检查它不是浏览器，那是实际写出来的。

要插入消息，我在 SQL 服务器管理器中运行 update tblRecipients set Message = N'Добре' where ID = 72。

有关如何使其正确显示的任何帮助？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T03:08:10.890

您的数据库可能以 utf-8 以外的方式存储数据（可能是 utf-16 或 ucs 2？），而您的 asp 页面（默认情况下）需要 utf-8。这就是为什么您的数据在 SQL 管理工作室中显示正确，但在 ASP 页面中显示不正确的原因。从 SQL Management Studio 查看时，数据库中的 utf-8 数据看起来像时髦的字符。

我仍在试图弄清楚如何将我的数据存储在 utf-16 中，并允许 asp 页面在每个 sql 语句中显式转换为 utf-8 的情况下显示它。更改 asp charset="utf-16" 似乎没有奏效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T23:15:53.917

欢迎来到国际化。我整天都在和这个作斗争。

罗恩是正确的。您的数据库排序规则可能设置为 Latin-1 或类似的东西，我相信它相当于 ISO-8859-1。

但是，您存储的数据将需要更改。例如，如果您要粘贴特殊字符，如智能双引号，则需要在将它们保存到数据库之前对其进行转换。相反，如果您不转换输入的数据，则在直接显示数据库中的数据时，您将不得不使用第三方工具对其进行转换。我遇到了 ChilKat 的一个 COM 对象，我相信它就是这样做的。我找不到任何内置到 Classic ASP 中的东西，它可以从 ISO-8859-1（或任何相关的东西）转换为 UTF-8，反之亦然。

此外，在您的 HTML 中，您需要将字符集设置为您希望使用的编码类型。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T00:06:07.843

您可以尝试使用[SQL Native Client](http://msdn2.microsoft.com/en-us/library/ms130978.aspx)来查看是否可以为您解决问题，这有点疯狂，但我知道它已经解决了数据类型和经典 ASP 的其他问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-11T00:32:16.370

解决方案：伙计，这很奇怪。问题是实际的 ASP 文件是用 ANSI 编码的。显然，这就是将文件传递给客户端时使用的编码方式（如果您还记得 asp 文件只是传递给客户端的一个文件，并被 asp 引擎稍作修改，那么这很有意义）。解决方案是将 ASP 文件的编码更改为 utf-8。因此，当 utf-8 字符在文件中写入客户端时，它们与文件其余部分的编码相匹配，并被浏览器正确读取。

希望这可以帮助下一个人。
干杯，
安迪。

# python - 对嵌套函数运行单元测试

> ID：326910
> 
> 赞同：12
> 
> 时间：2008-11-28T23:41:40.917
> 
> 标签：python, testing, closures

我来自 Java 世界，您可以在其中隐藏变量和函数，然后使用反射对它们运行单元测试。我使用嵌套函数来隐藏我的类的实现细节，这样只有公共 API 是可见的。我正在尝试针对这些嵌套函数编写单元测试，以确保在开发时不会破坏它们。我曾尝试调用其中一个嵌套函数，例如：

```
def outer():
    def inner():
        pass

outer.inner() 
```

这导致错误消息：

> AttributeError：'function'对象没有属性'inner'

我有没有办法针对这些嵌套函数编写单元测试？如果没有，有没有办法像类变量一样通过在它们前面加上__来触发函数名称的名称转换？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-28T23:44:55.140

内部不存在，直到外部制造它。您应该将内部移动到可测试性的顶层函数，或者让外部测试测试自身和内部的所有可能执行路径。

请注意，内部函数不是一个简单的函数，它是一个闭包。考虑这种情况：

```
def outer(a):
    b = compute_something_from(a)
    def inner():
        do_something_with(a, b) 
```

这是标准的可测试性权衡。如果你的[圈复杂度](http://en.wikipedia.org/wiki/Cyclomatic_complexity)太高，你的测试就会太多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T00:04:42.633

Python 约定是使用前导下划线命名“私有”函数和方法。当您看到前导下划线时，您就知道不要尝试使用它。

请记住，[Python 不是 Java](http://dirtsimple.org/2004/12/python-is-not-java.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T00:25:40.050

我认为没有任何机会从 extern 命名空间访问 inner() 。

然而，在我看来，你保持 inner() 嵌套的事实意味着唯一真正重要的“合同”是 outer() 的。inner() 是实现的一部分，您不应该测试实现。如果您真的想测试 inner()，请使用涉及 inner() 的所有功能的数据对 outer() 进行广泛的测试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-06-18T12:43:07.653

我也有同样的疑问，并找到了一种方法来测试内部函数。

```
def outer():
    def inner():
        pass

    if __debug__:
        test_inner(inner)
        # return

def test_inner(f):
     f() # this calls the inner function

outer() 
```

基本上，您可以将内部函数作为参数发送到外部并根据需要对其进行测试。当调用**outer()**时，您的测试将运行，并且由于它是一个闭包，它将保留外部函数的任何额外属性（如变量）。使用列表，您可以发送任意数量的函数。要忽略**if**，一个选项是运行这样的代码：

```
python -O code.py 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-11-09T17:08:25.697

我写了一个小的帮助模块，它允许这样做：

嵌套函数示例：

```
def f(v1):
  v2 = 1
  def g(v3=2):
    return v1 + v2 + v3 + 4
  def h():
    return 16
  return g() + h() + 32

class C(object):
  def foo(self):
    def k(x):
      return [ self, x ]
    return k(3)

def m():
  vm = 1
  def n(an=2):
    vn = 4
    def o(ao=8):
      vo = 16
      return vm + an + vn + ao + vo
    return o()
  return n() 
```

这些可以使用这种代码进行单元测试：

```
import unittest
from nested import nested

class TestNested(unittest.TestCase):
  def runTest(self):
    nestedG = nested(f, 'g', v1=8, v2=1)
    self.assertEqual(nestedG(2), 15)
    nestedH = nested(f, 'h')
    self.assertEqual(nestedH(), 16)
    nestedK = nested(C.foo, 'k', self='mock')
    self.assertEqual(nestedK(5), [ 'mock', 5 ])
    nestedN = nested(m, 'n', vm=1)
    nestedO = nested(nestedN, 'o', vm=1, an=2, vn=4)
    self.assertEqual(nestedO(8), 31)

def main(argv):
  unittest.main()

if __name__ == '__main__':
  import sys
  sys.exit(main(sys.argv)) 
```

小助手模块`nested`如下所示：

```
import types

def freeVar(val):
  def nested():
    return val
  return nested.__closure__[0]

def nested(outer, innerName, **freeVars):
  if isinstance(outer, (types.FunctionType, types.MethodType)):
    outer = outer.func_code
  for const in outer.co_consts:
    if isinstance(const, types.CodeType) and const.co_name == innerName:
      return types.FunctionType(const, globals(), None, None, tuple(
          freeVar(freeVars[name]) for name in const.co_freevars)) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-09T16:12:27.737

无法从外部函数对象获取内部函数（参见其他回复！）。然而，单元测试和闭包（至少对我而言）都为开发人员带来了惊人的性能提升。我们可以两者兼得吗？我们可以单独测试嵌套函数吗？

不容易。

然而，这似乎可以通过使用 python 模块解析器、ast 或标记器来实现代码本身，提取内部函数（通过嵌套的某些路径），并允许测试以封闭函数的状态运行它们（值用于封闭的名称）和用于更多嵌套函数的存根/模拟（在测试目标中定义）。

有人知道这样的事情吗？谷歌搜索未能找到任何东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-07T21:12:49.277

我遇到了一个有趣的案例，我能够使用 MagicMock 对嵌套函数运行单元测试。关键是嵌套函数作为参数发送给我可以访问的另一个函数。为了保持OP的例子：

```
# my_app.py

def util(func):
    # run some logic using func

def outer():
    def inner():
        pass

    util(inner) 
```

能够模拟`util`函数允许访问调用参数，在这种情况下恰好是`inner`函数：

```
def test_inner
    # Arrange
    mock_util = MagicMock()

    with patch.object(my_app, 'util', mock_util):
        outer() # run the outer function to capture the util call with MagicMock

    inner_function = mock_util.call_args[0][0]

    # Act
    inner_function() # run the inner function for testing

    # Assert
    # make whatever assertions you would like 
```

这次我很幸运，因为我不需要更改我被要求测试的代码。[@Victor-Barroso 的回答](https://stackoverflow.com/a/37897092/5365001)为那些正在寻找选择的人提供了一种有意的方式来做类似的事情。虽然，如果您要更改代码，您也可以遵循[@Dustin 的建议](https://stackoverflow.com/a/326912/5365001)或关于此问题的任何其他好的答案。

# javascript - 使用 javascript 禁用按钮：FF vs IE

> ID：326919
> 
> 赞同：4
> 
> 时间：2008-11-28T23:52:39.820
> 
> 标签：javascript, html, internet-explorer

我有一排按钮，它们都创建了一个我想在新选项卡中打开的 pdf 文件。这样，按钮页面保持在顶部，并且 pdf 可以打开以进行打印。为了防止单击按钮两次，我禁用了按钮，如下所示（我使用 python）：

```
<input type='submit' value='Factureren' name='submitbutton' id='%s'
onclick="javascript:document.getElementById('%s').disabled=true; 
document.getElementById('%s').className='button_disabled';"> % ((but_id,) *3) 
```

在 FF3 中这工作正常，即提交表单，执行脚本，然后禁用按钮。在 IE 中，按钮只是禁用，但不会执行表单脚本。

这个IE问题有解决方案吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T04:11:37.037

很简单：禁用的提交按钮不会在 IE 中提交表单。考虑重构您的代码：

*   使用常规按钮，禁用它，然后从其处理程序调用 form.submit()。
*   不要禁用其“onclick”中的按钮，而是保存它，并在表单的 onsubmit 中执行此操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-28T23:56:12.637

这样做更容易：

```
 <input type='submit' value='Factureren' name='submitbutton' id='%s' 
onclick="this.disabled=true; this.className='button_disabled';"> % ((but_id,) *3) 
```

我不知道这是否能解决您的问题，但在这种情况下我会这样做。我认为无论如何您都不需要“javascript：”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T00:03:00.563

您可以尝试使用普通按钮并在 onclick 事件中触发表单 submit() 函数：

```
<input type="button" value="Factureren" name="submitbutton" 
onclick="this.disabled=true; this.className='button_disabled'; this.form.submit();"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T00:03:09.190

也许尝试将处理程序附加到表单的 onsubmit 事件而不是单击按钮？如果用户按下 ENTER 而不是单击您的按钮，这也将起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T00:03:18.270

与其控制 div，不如控制实际的提交按钮？这适用于我测试过的所有浏览器（IE6+ FF1+ 和 Safari）

```
function toggleSubmit(){  
    frm=document.forms[0]
    if(frm.submit.disabled==true){
        frm.submit.disabled=false;
    }else{
       frm.submit.disabled=true;
    }
 } 
```

然后在按钮上，您只需调用

```
<input type='submit' value='Factureren' name='submitbutton'
onclick="toggleSubmit();false;"> % ((but_id,) *3) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T00:12:04.290

```
<input type="submit" value="Factureren" name="submitbutton' id="%s"
onclick="this.disabled = true; this.className = 'button_disabled'; true;">
% ((but_id,) *3) 
```

您可以使用**它**来代替**document.getElementById('%s')**。此外，您需要返回**true**才能通过 onclick 事件。

您还可以禁用表单的 onsubmit 处理程序中的按钮。这可能更傻。

此外，如果您没有专门为禁用按钮使用类，那就太好了。CSS 选择器旨在为您选择禁用的按钮。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T19:44:25.170

看这部分：

```
onclick="javascript:document.getElementById('%s').disabled=true; 
document.getElementById('%s').className='button_disabled';" 
```

“javascript:”是不必要的和错误的。

```
onclick="document.getElementById('%s').disabled=true; 
document.getElementById('%s').className='button_disabled';" 
```

“javascript:”是链接中使用的 URL“协议”，而不是 onclick 操作。

此外，尝试告诉表单提交。我**认为**这是正确的：

```
onclick="document.getElementById('%s').disabled=true; 
document.getElementById('%s').className='button_disabled';
this.form.submit();" 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-12-16T09:12:23.060

onclick="this.disabled='禁用'; this.form.submit();" 非常适合我

# python - 在 python 中使用带有 raw_input 的诅咒

> ID：326922
> 
> 赞同：4
> 
> 时间：2008-11-28T23:54:50.143
> 
> 标签：python, console-application, ncurses

在我的 python linux 控制台应用程序中，我使用 curses 来处理数据的显示。同时我想有一个输入行来输入命令，几乎是很好的 irssi 风格。使用默认的 curses getch() 我必须做很多编码才能获得 raw_input 函数的基本功能 - 箭头键移动光标/浏览输入历史记录。

有没有一种简单的方法可以让这种行为与curses一起工作，因为它捕获输入事件，我不能只使用读取sys.stdin的函数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T04:01:43.937

使用 curses.textpad

[http://www.python.org/doc/2.4.1/lib/module-curses.textpad.html](http://www.python.org/doc/2.4.1/lib/module-curses.textpad.html)

# svn - Subversion：在分支中进行多次连续更改时，如何仅将特定修订合并到主干中？

> ID：326937
> 
> 赞同：16
> 
> 时间：2008-11-29T00:09:28.070
> 
> 标签：svn, version-control, merge, three-way-merge

我一直在使用 TortoiseSVN、svn 和 subclipse，并且我认为我了解基础知识，但是有一件事一直困扰着我一段时间：合并引入了不需要的代码。这是步骤。

`trunk/test.txt@r2`. 使用“A”创建了一个测试文件并返回：

```
A
[EOF] 
```

`branches/TRY-XX-Foo/test.txt@r3`. 扩展`trunk`到`TRY-XX-Foo`：

```
A
[EOF] 
```

`branches/TRY-XX-Foo/test.txt@r4`. 进行了不必要的更改`TRY-XX-Foo`并提交了它：

```
A
B (unwanted change)
[EOF] 
```

`branches/TRY-XX-Foo/test.txt@r5`. 修复了一个重要的错误`TRY-XX-Foo`并提交了它：

```
A
B (unwanted change)
C (important bug fix)
[EOF] 
```

现在，我只想将重要的错误修复合并回主干。所以，我运行 merge for revision `4:5`。我最终在我的工作目录中是一个冲突。

`trunk/test.txt`：

```
A
<<<<<<< .working
=======
B (unwanted change)
C (important bug fix)
>>>>>>> .merge-right.r5
[EOF] 
```

违背我的意愿，Subversion 现在已经在主干代码中包含了“不需要的更改”，我需要手动清除它们。当在分支中进行多次连续更改时，有没有办法只合并指定的修订？

问题的一部分是 B （未更改的更改）包含在 .merge-right 中，我无法区分它来自哪个修订版。我通常使用 TortoiseMerge，它的外观如下。

![text.txt.working](https://i.stack.imgur.com/NG2g7.png)

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-29T00:15:43.360

仅将修订版 4,7 和 11-15 与[svnmerge](http://www.orcaware.com/svn/wiki/Svnmerge.py)合并：

```
svnmerge.py merge -r4,7,11-15 
```

并使用常规 svn：

```
svn merge -c4,7 -r10:15 http://.../branches/TRY-XX-Foo 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-14T00:14:27.787

问题是这两个svn

```
A
<<<<<<< .working
=======
B (unwanted change)
C (important bug fix)
>>>>>>> .merge-right.r341 
```

TortoiseSVN 将这种情况视为 2 路合并。我听说过 3-way merge 这个词，所以我试了[一下 Beyond Compare](http://www.scootersoftware.com/)。使用 TortoiseSVN 进行快速设置后，编辑冲突现在会显示以下屏幕。这并不完美，因为它仍然需要人工干预，但至少我可以分辨出哪些变化来自哪里。

[见截图](http://img253.imageshack.us/img253/5138/bc33waymergelx1.png)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T15:02:03.513

我相信您正确地包含了您想要的修订，但是合并算法无法找到插入所需更改的位置，因此也包括它上面的行。以下是相同的步骤，但有一组不同的更改，我相信它会按照您最初的预期工作：

```
$ svnadmin 创建仓库
$ svn mkdir -m '' file://`pwd`/repo/trunk

提交的修订版 1。
$ svn mkdir -m '' file://`pwd`/repo/branches

提交的修订版 2。
$ svn co file://`pwd`/repo/trunk co.trunk
签出修订版 2。
$ cat > co.trunk/test.txt << EOF
> 一个
> 乙
> C
> EOF
$ svn 添加 co.trunk/test.txt
一个 co.trunk/test.txt
$ svn commit -m '' co.trunk
添加 co.trunk/test.txt
传输文件数据。
提交的修订版 3。
$ svn copy -m '' file://`pwd`/repo/trunk file://`pwd`/repo/branches/testbr

提交的修订版 4。
$ svn co file://`pwd`/repo/branches/testbr co.testbr
一个 co.testbr/test.txt
签出修订版 4。
$ cat > co.testbr/test.txt << EOF
> 一个
> A1 不需要
> 乙
> C
> EOF
$ svn commit -m '' co.testbr
发送 co.testbr/test.txt
传输文件数据。
提交的修订版 5。
$ cat > co.testbr/test.txt << EOF
> 一个
> A1 不需要
> 乙
> B1 通缉
> C
> EOF
$ svn commit -m '' co.testbr
发送 co.testbr/test.txt
传输文件数据。
提交的修订版 6。
$ svn merge -r 5:6 file://`pwd`/repo/branches/testbr co.trunk
--- 将 r6 合并到 'co.trunk' 中：
u co.trunk/test.txt
$ cat co.trunk/test.txt
一种
乙
B1 通缉
C

```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T06:20:05.327

澄清一下关于合并的事情是它实际上有两个步骤。

1.  合并
2.  犯罪

所以这意味着在你的合并完成后，你可以对 head 和另一个分支进行手动比较，以确保合并是正确的。如果它有问题，比如你的情况，你可以在提交之前手动修复它。

/约翰

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-30T07:41:12.040

在 TortoiseSVN 中，您必须只指定要合并的修订。与命令行客户端不同，您必须指定例如 -r4:5 来合并 r4 和 r5 之间的更改，您只需指定 '5' 作为修订号即可在 TortoiseSVN 合并对话框中合并。如果您不确定，请始终使用合并对话框中的日志对话框并在该日志对话框中选择要合并的修订（然后单击确定，所选修订将自动在合并对话框中设置）。

至于解决您在 TortoiseMerge 中的冲突：根据您问题中的屏幕截图，TortoiseMerge 向您显示了两条冲突的行（在底部视图中显示为“????”的行）。你想要的是包括变化'C'而不是'B'？

*   左键单击第一个'???' 行选择它，然后右键单击，从上下文菜单中选择“使用“我的”块”
*   左键单击第二个'???' 行选择它，然后右键单击，从上下文菜单中选择“使用来自“他们的”的块”
*   单击保存按钮（或文件->保存）
*   （可选）单击“标记为已解决”按钮

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-28T07:06:21.867

您可以做的另一件事是手动撤消分支上的错误提交，然后您可以像往常一样将分支合并回主干。

**TortoiseSVN**

使用 TortoiseSVN 打开文件的日志视图，选择有问题的版本，然后从右键菜单中选择“Revert changes from this revision”。提交它对您的工作副本所做的更改，然后您可以轻松地将分支合并回来。

**命令行**

要使用命令行客户端执行此操作，您需要执行反向合并（这取自使用 Subversion 的实用源代码控制一书），您可以将有问题的版本和先前版本之间的更改合并到文件的工作副本中。然后如上所述，您将提交更改，然后可以正常分支。在您的示例中，您将执行以下操作：

```
svn merge -r 4:3 test.txt 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-28T18:55:12.950

正如其他用户所指出的那样（我不会注意到它，因为我没有注意到它），可能是这种合并的琐碎性质（即缺乏围绕更改的上下文）使工具感到困惑。

我做了很多合并，正如您所发现的，Tortoise 提供的合并工具很糟糕。如果您经常这样做，则绝对必须使用三向合并工具。Beyond Compare 是我个人的最爱，但还有其他免费的（Meld、KDiff3）和非免费的（Araxis）。

你会注意到 Beyond Compare 最终做了正确的事情，即使它让你手动验证它的正确性！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T00:58:13.633

如果您不想要不需要的更改，请不要合并修订版 4:5，而只合并修订版 5。这意味着您合并了修订版 5 中提交的更改。

# c# - 有没有办法在机器上没有单词的情况下动态生成word文档

> ID：326941
> 
> 赞同：18
> 
> 时间：2008-11-29T00:13:46.283
> 
> 标签：c#, ms-word, document

我计划在网络服务器上动态生成一个 Word 文档。有没有在c#中这样做的好方法？我知道我可以编写 Word 来执行此操作，但我更喜欢另一种选择。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-29T00:49:24.387

我过去曾在一家真正想要生成 Word 文档的公司工作，最后他们对具有“.doc”扩展名的 RTF 文档非常满意。Word 可以毫无问题地识别和打开它们。

RTF 文档是使用[iText.net](http://sourceforge.net/projects/itextdotnet/)（免费的 .net 库）生成的，API 非常易于使用，性能非常好，您不需要机器上的文字，还可以扩展到生成 PDF、HTML 和未来的文本文档只需很少的努力。四年后，我创建的解决方案仍然存在，所以这是对 iText.net 有利的一点证明。

看起来[iText 官方页面](http://www.ujihara.jp/iTextdotNET/en/)表明[iText Sharp](http://itextsharp.sourceforge.net/)是目前最好的 .Net 选择，所以这是另一种选择

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-29T00:15:39.040

您最好生成一个 rtf 文件，该文件将知道如何打开。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-29T00:21:38.357

如果要生成 Office 2007 文档，请查看 Open XML File Formats，它们是简单的压缩 XML 文件，请查看以下链接：

*   [打开 XML 文件格式：它是什么，我该如何开始？](http://blogs.msdn.com/erikaehrli/archive/2006/06/23/getstartedwithOpenXMLFileFormats.aspx)
*   [介绍 Office (2007) Open XML 文件格式](http://msdn.microsoft.com/en-us/library/aa338205.aspx)

**编辑：**检查这个项目，可以作为一个很好的起点：

*   [文档制作者](http://www.codeproject.com/KB/office/DocumentMaker.aspx)

看起来非常简单和可定制，看看这个代码片段：

```
Paragraph p = new Paragraph();
p.Runs.Add(new Run("Text can have multiple format styles, they can be "));
p.Runs.Add(new Run("bold and italic", 
        TextFormats.Format.Bold | TextFormats.Format.Italic));
doc.Paragraphs.Add(p); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-29T00:25:02.843

Word 会很高兴地打开带有 .doc 扩展名的 HTML。如果包含内部样式表，则可以将其完全格式化。之前有一篇关于这个问题的帖子：

[在 C# 中导出到 Word 文档](https://stackoverflow.com/questions/282531/export-to-word-document-in-c#283932)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-29T00:35:54.163

如果没有 Word 本身，创建旧的 .DOC 文件（Word 2007 之前的版本）几乎是不可能的。格式太复杂了。微软已经发布了格式说明，但这足以让一个成年程序员落泪。这也是有原因的（历史上的），但这并不能让事情变得更好。

新的 .DOCX 会更容易，虽然还是有点麻烦。但是，根据您所针对的 Word 版本，还有一些其他选项。

一方面，有经典的 .RTF。该格式仍然非常复杂，但有据可查，并且在许多应用程序和平台上都有强大的支持。您可能会在模板文件中使用一些字符串替换来使事情变得更容易（它是非二进制的）。

然后是“旧的”Word XML 文件。我认为他们从 Word XP 开始工作。有点像 .DOCX 的前身。我用过，还不错。而且文档还不错。

最后，我会选择的简单方法是制作一个简单的 HTML。从 2000 版开始，Word 可以很好地加载 HTML 文件。以最简单的方式，只需将 HTML 文件的扩展名更改为 .DOC 即可。您还可以添加一些特定于单词的标签和注释，使其在 Word 中看起来更好。使用 Word 的另存为...HTML 选项来查看它们是什么。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T00:17:00.753

有第三方图书馆可以完成这项工作。

例如，做一个快速的 google 想出了[这个](http://www.independentsoft.de/word/index.html)。

我没有尝试过，所以我不能给你具体的建议，我害怕！

让我们知道您的身体情况如何...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T00:34:02.200

在 Office 2007 中，Microsoft 引入了一种称为[Microsoft Open Office XML 格式](http://msdn.microsoft.com/en-us/library/aa338205.aspx#office2007aboutnewfileformat_modifyingofficexmlformatsfiles)(.docx) 的新文件格式。此格式与旧版本的 Microsoft Word 不兼容。由于这是 XML，您无需安装 Word 即可创建或阅读。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T03:53:58.423

这是基于自定义模板生成文档的组件。文档是从共享点列表生成的......因此数据会从列表项中动态提取到文档中：http: [//store.sharemuch.com/products/generate-word-documents-from-sharepoint-list](http://store.sharemuch.com/products/generate-word-documents-from-sharepoint-list)

希望有帮助，

雅罗斯拉夫·彭萨斯基博客：www.sharemuch.com

# bash - 如何让我的 bash 脚本工作？

> ID：326942
> 
> 赞同：-1
> 
> 时间：2008-11-29T00:15:06.203
> 
> 标签：bash, unix, shell

我的 bash 脚本无法按我希望的方式工作：

```
#!/bin/bash

total="0"
count="0"
#FILE="$1" This is the easier way
for FILE in $*
do
    # Start processing all processable files
    while read line
    do
        if [[ "$line" =~ ^Total ]];
        then
            tmp=$(echo $line | cut -d':' -f2)
            count=$(expr $count + 1)
            total=$(expr $total + $tmp)
        fi     
    done < $FILE
done
echo "The Total Is: $total"
echo "$FILE" 
```

是否有另一种方法来修改此脚本，以便将参数读入`$1`而不是`$FILE`？我试过使用`while`循环：

```
while [ $1 != "" ]
  do ....
done 
```

同样，当我实现代码重复时。有没有办法解决这个问题？

我遇到的另一个问题是，当我有多个文件`hi*.txt`时，它会给我重复。为什么？我有类似的文件，`hi1.txt` `hi1.txt~`但波浪号文件是 0 字节，所以我的脚本不应该找到任何东西。

* * *

我所拥有的很好，但可以改进。我感谢您的 awk 建议，但它目前超出了我作为 unix 程序员的水平。

Strager：我的文本编辑器自动生成的文件不包含任何内容..它是 0 字节..但是是的，我继续删除它们只是为了确定。但是没有我的脚本实际上是两次阅读所有内容。我想当它真的不应该时它会再次循环。我试图用退出命令使该动作静音..但没有成功。

```
while [ "$1" != "" ]; do
    # Code here

    # Next argument
    shift
done 
```

这段代码非常漂亮，但我一次指定了所有可能的命令。示例：hi[145].txt 如果提供将一次读取所有三个文件。假设用户输入hi*.txt；然后，我将所有 hi 文件读取两次，然后再次添加。

我如何对其进行编码，以便它根据 hi*.txt 的规范读取我的文件（仅一次）？我真的认为这是因为没有 1 美元。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T02:49:13.973

看起来您正在尝试从提供的文件中标记为“总计：”的行中添加总计。说明您正在尝试做什么以及您如何尝试这样做总是一个好主意（请参阅[如何以聪明的方式提问](http://www.catb.org/~esr/faqs/smart-questions.html)）。

如果是这样，那么您正在以我所看到的那样复杂的方式进行操作。出了什么问题：

```
grep '^Total:' "$@" |
cut -d: -f2 |
awk '{sum += $1}
     END { print sum }' 
```

这不会打印出“总数是”等；并且不清楚为什么您在版本末尾回显 $FILE 。

您可以使用 Perl 或任何其他合适的程序来代替`awk`; 你可以在 Perl 或 Python 中完成整个工作——事实上，这项`cut`工作可以通过以下方式完成`awk`：

```
grep "^Total:" "$@" |
awk -F: '{sum += $2}
         END { print sum }' 
```

更进一步，整个工作可以通过以下方式完成`awk`：

```
awk -F: '$1 ~ /^Total/ { sum += $2 }
         END { print sum }' "$@" 
```

Perl 中的代码不会更难，结果可能会更快：

```
perl -na -F: -e '$sum += $F[1] if m/^Total:/; END { print $sum; }' "$@" 
```

在迭代 shell 脚本中提供的文件名参数时，您应该使用 ' `"$@"`' 代替 ' `$*`'，因为后一种表示法不会在文件名中保留空格。

您对“ `$1`”的评论让我感到困惑。`$1`您可能会要求在每次迭代中读取名称所在的文件；这是使用完成的：

```
while [ $# -gt 0 ]
do
     ...process $1...
     shift
done 
```

！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T00:57:41.467

```
while [ "$1" != "" ]; do
    # Code here

    # Next argument
    shift
done 
```

关于波浪号文件的问题......这些是您的文本编辑器创建的临时文件。如果您不希望它们与您的 glob 表达式（通配符）匹配，请删除它们。否则，在您的脚本中过滤它们（不推荐）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T00:34:38.317

如果你定义一个函数，它会收到 $1 的参数。为什么 1 美元对你来说比 $FILE 更有价值呢？

```
#!/bin/sh

process() {
    echo "doing something with $1"
}

for i in "$@" # Note use of "$@" to not break on filenames with whitespace
do
    process "$i"
done 
```

# mysql - 我可以原子地重命名/替换 2 个或更多表和视图吗？

> ID：326950
> 
> 赞同：1
> 
> 时间：2008-11-29T00:18:39.207
> 
> 标签：mysql, schema, migration, views, atomic

给定一个表 X 和一个视图 Y（与 X 具有相同的结构），有没有办法将 X 重命名为 Z 并将 Y 重命名为 X，这样任何查询都不会看到任何名为 X 的东西？重命名 X 并创建视图也是有效的。

关键是，作为模式迁移计划的一部分，将旧表替换为从新版本模拟旧版本的视图，以便两组客户端代码可以同时运行。

MySQL 是我的选择，但其他人的信息也会很有用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T00:23:02.817

这在 postgres 中是微不足道的，在 mysql 中是不可能的。

mysql 从事务中免除模式修改。我有 postgres 背景，所以这是一件显而易见的事情（开始事务，做一些事情，提交或回滚 - postgres 对“做一些事情”并不挑剔）。

如果您查看 mysql 的错误库，您可以在这方面找到一些错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T19:51:56.183

MySQL 与 Oracle 一样，将大多数 DDL 语句（CREATE TABLE、ALTER TABLE 等）视为导致“隐式提交”。您无法使用事务模型保护其他连接不看到您的 DDL 更改。（我相信 Postgres 在这方面是不寻常的）。

您也许可以使用 LOCK TABLES 锁定表，但我怀疑您一旦重命名表就会失去锁定！LOCK DATABASE 可能会起作用，但很可能需要所有其他客户端在您的锁定请求被授予之前完全断开连接。

当然，这会导致其他客户端在您重命名表时阻塞，这可能是一种成本低廉的操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-03-18T07:57:52.020

其他答案不正确。

您可以通过在 rename 语句中列出多个表来原子地重命名一堆表。

[在此处](http://dev.mysql.com/doc/refman/5.5/en/rename-table.html)查看文档

# integration - Linux Web 前端最佳实践

> ID：326954
> 
> 赞同：0
> 
> 时间：2008-11-29T00:23:50.757
> 
> 标签：integration, system

我想构建一个基于 Web 的前端来管理/管理我的 Linux 机器。例如，我希望能够添加用户、管理文件系统和所有这些事情。将其视为 cPanel 克隆，但更多的是系统管理员而不是 Web 管理员。

我正在考虑创建一个在我的盒子上运行并执行所有系统级别任务的服务。通过这种方式，我可以清楚地区分基于 Web 的前端和实际逻辑。服务器页面可以通过这种方式调用我的专用服务器或排队任务。但是，我不确定这是否是解决此问题的最佳方法。

我想另一个重要的问题是，在构建这样的东西时我将如何处理安全问题？

*PS：这只是一个宠物项目和学习经验，所以我对做类似事情的现有解决方案不感兴趣。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T00:39:48.210

您的解决方案似乎是解决“根本”问题的一个非常明智的解决方案。

几个建议：

1.  将“专业服务”绑定到 localhost 也将有助于确保无法从外部发出请求。
2.  检查执行操作的请求调用函数，而不是直接为服务提供完全不受限制的访问权限。所以调用函数“addToGroup(user,group)”而不是通用的“performAction(command)”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T03:56:42.150

让专门的服务守护进程以不同的用户身份运行——我们称之为“managerd”。设置您的 /etc/sudoers 文件，以便“managerd”可以执行您希望它能够以 root 身份运行的各种命令，而无需密码。

让 Web 服务器删除“触发器”文件，其中包含要在模式为“770”的目录中运行的命令，该目录中的组只有 Web 服务器用户和“managerd”是其成员。确保“managerd”在执行命令之前验证文件拥有正确的所有权。

确保 Web 界面端已锁定 - 仅通过 HTTPS 运行它，需要身份验证，如果可能，请放入特定于 IP 的 ACL，以便您只能提前从已知位置访问它。

# haskell - 如何在字符串表示中编写两个项目的加法？

> ID：326959
> 
> 赞同：-1
> 
> 时间：2008-11-29T00:28:41.587
> 
> 标签：haskell, functional-programming, lambda-calculus

例如我想添加两个表达式 e1 和 e2

```
toString (Plus e1 e)= ?? 
```

我猜它会像

```
toString (Plus e1 e)= ((toString e1) ++ "+" ++ (toString e2)) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T13:34:46.640

我对如何定义 Plus 做了一些假设。使用此代码，您只需在 ghci 提示符下键入 expr，ghci 将打印出表达式 100-30+100+30。

```
module Main where

data Expr =
    Plus Expr Expr
  | Minus Expr Expr
  | Value Int

-- This works but is not as Haskell-y as using Show
toString (Plus e1 e2) = toString e1 ++ "+" ++ toString e2
toString (Minus e1 e2)  = toString e1 ++ "-" ++ toString e2
toString (Value n) = show n

instance Show Expr where
  show (Plus e1 e2) = show e1 ++ "+" ++ show e2
  show (Minus e1 e2)  = show e1 ++ "-" ++ show e2
  show (Value n) = show n

expr = (Plus
         (Minus (Value 100) (Value 30))
         (Plus (Value 100) (Value 30))) 
```

# c# - 比较 2 个 XML 文档并将更改应用于源文档

> ID：326960
> 
> 赞同：2
> 
> 时间：2008-11-29T00:29:58.230
> 
> 标签：c#, xml, xslt, merge

这是我的问题。我有 2 个结构相同的 xmlfiles，与第一个相比，第二个 xml 只包含几个节点。

文件 1

```
 <root>
    <alpha>111</alpha>
    <beta>22</beta>
    <gamma></gamma>
    <delta></delta>
  </root> 
```

**文件2**

```
 <root>
    <beta>XX</beta>
    <delta>XX</delta>
 </root> 
```

结果应该是这样的

```
 <root>
    <alpha>111</alpha>
    <beta>22</beta>
    <gamma></gamma>
    <delta>XX</delta>
 </root> 
```

基本上，如果 File1 中任何节点的节点内容为空，则它应该从 File2 读取值（如果存在，即）。

我确实尝试了使用 Microsoft XmlDiff API 的运气，但它对我没有用（补丁过程没有将更改应用于源文档）。我也有点担心它使用的 DOM 方法，因为我要处理的 xml 的大小。你能建议一个这样做的好方法吗？我正在使用 C# 2

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T01:07:21.540

在 XSLT 中，如果在 File1 中遇到空节点，您可以使用该`document()`函数从 File2 中检索节点。就像是：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">

  <xsl:template match="root/*[.='']">
    <xsl:variable name="file2node">
        <xsl:copy-of select="document('File2.xml')/root/*[name()=name(current())]"/>
    </xsl:variable>
    <xsl:choose>
      <xsl:when test="$file2node != ''">
        <xsl:copy-of select="$file2node"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:copy/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>

  <xsl:template match="*">
    <xsl:copy>
      <xsl:copy-of select="@*"/>
      <xsl:apply-templates/>
    </xsl:copy>
  </xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T16:27:58.407

这是 Alastair 提出的更简单、更有效的解决方案（请参阅我对他的解决方案的评论）。

这种转变：

```
<xsl:stylesheet 版本="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >
  <xsl:output omit-xml-declaration="yes" indent="yes"/>

    <xsl:变量名="vFile2"
         select="document('File2.xml')"/>

    <xsl:template match="*">
      <xsl:复制>
        <xsl:copy-of select="@*"/>
            <xsl:apply-templates/>
        </xsl:copy>
    </xsl:模板>

    <xsl:template match="*[not(text())]">
      <xsl:复制>
        <xsl:副本
          select="$vFile2/*/*[name() = name(current())]/text()"/>
        </xsl:copy>
    </xsl:模板>
</xsl:样式表>

```

应用于此 XML 文档时：

```
<根>
    <alpha>111</alpha>
    <beta>22</beta>
    <伽玛></伽玛>
    <delta></delta>
</root>

```

产生想要的结果：

```
<根>
    <alpha>111</alpha>
    <beta>22</beta>
    <伽玛></伽玛>
    <delta>XX</delta>
</root>

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T00:34:31.483

这种合并似乎非常具体。

如果是这种情况，只需编写一些代码来加载两个 xml 文件并按照您的描述应用更改。

# asp.net - 您如何在 asp.net mvc 中使用显示数据“孤岛”的用户控件？

> ID：326987
> 
> 赞同：9
> 
> 时间：2008-11-29T01:10:39.693
> 
> 标签：asp.net, asp.net-mvc, user-controls, controller, viewdata

我试图找出如何在 asp.net mvc 中使用用户控件。我知道如何将用户控件添加到视图以及如何将数据传递给它。我无法弄清楚的是，您如何在不必检索和传递每个控制器中的数据的情况下做到这一点？

例如，如果我有一个用户控件，它在站点中的几个但不是所有页面上显示最近的帖子，我如何编写控制器以便我获取该用户控件的数据并将其仅从一个传递给用户控件放置在网站中，而不是在使用用户控件的每个不同控制器中获取和传递数据？

我不确定这是否有意义。是否有更好或推荐的方法来处理要在多个页面上显示的数据“孤岛”？

我来自网络表单，我可以编写一个用户控件，该控件获取自己的数据并独立于使用它的任何页面的其余部分显示数据。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-29T02:56:21.197

有多种方法可以做到这一点。

基本方法是

*   为 BaseController 中的视图填充数据（OnActionExecuting 事件）
*   编写自定义操作过滤器
*   编写应用程序控制器（例如在下面的链接中）。

OnActionExecuting 的一个例子是

```
 [HandleError]
    public class BaseController : Controller
    {
        CourseService cs = new CourseService();
        protected override void OnActionExecuting(ActionExecutingContext filterContext)
        {
            List<Tag> tags = cs.GetTags();
            ViewData["Tags"] = tags;
        }

    } 
```

您可以在任何视图上使用“标签”视图数据。这只是一个将用户控件呈现为附加内容的示例。

```
<div id="sidebar_b">
         <asp:ContentPlaceHolder ID="ContentReferenceB" runat="server" >
             <% Html.RenderPartial("Tags"); %>
         </asp:ContentPlaceHolder>
   </div> 
```

我发现以下 URL 很有用。

[http://weblogs.asp.net/stephenwalther/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx](http://weblogs.asp.net/stephenwalther/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx)

[http://blog.matthidinger.com/2008/02/21/ASPNETMVCUserControlsStartToFinish.aspx](http://blog.matthidinger.com/2008/02/21/ASPNETMVCUserControlsStartToFinish.aspx)

[http://www.aaronlerch.com/blog/2008/01/26/displaying-foo-on-every-page-of-an-aspnet-mvc-application/](http://www.aaronlerch.com/blog/2008/01/26/displaying-foo-on-every-page-of-an-aspnet-mvc-application/)

[http://blog.wekeroad.com/2008/01/07/aspnet-mvc-using-usercontrols-usefully/](http://blog.wekeroad.com/2008/01/07/aspnet-mvc-using-usercontrols-usefully/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T18:20:52.000

在[codeplex](http://www.codeplex.com/aspnet)上可用的 MVC Futures 中，包含 RenderAction HtmlHelper 扩展。这将允许您为 ueser 控件创建一个控制器，并且该控制器将填充用户控件使用的 ViewData，而无需按照建议使用基本控制器。

在视图中你会做

```
<% Html.RenderAction("Index", "UserControlController") %> 
```

或其他重载之一。

这将创建控制器的一个实例，执行该方法并将用户控件视图呈现到主视图中。主视图控制器不需要知道任何关于用户控件或其模型/数据的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T02:20:03.017

将获取此用户控件的视图数据的代码重构为它自己的方法，甚至可能是它自己的模型（类）。从需要填充控件的每个控制器调用此方法，并使用众所周知的键在 ViewData 中传递结果。您甚至可能希望将当前控制器的类型传递给您的方法，以防它需要知道要根据控制器的基本模型检索哪些数据。

```
 ViewData["RecentPosts"] = RecentPosts.GetRecentPosts( this.GetType() ); 
```

在您的控件中，使用众所周知的密钥检索数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T03:09:55.320

[如何在 ASP.NET MVC 中处理“附加内容”](http://www.singingeels.com/Blogs/Nullable/2008/08/14/How_to_Handle_Side_Content_in_ASPNET_MVC.aspx)

# .net - 使用 SqlCommand 时是否需要指定 SQL 数据类型？

> ID：326989
> 
> 赞同：0
> 
> 时间：2008-11-29T01:13:31.403
> 
> 标签：.net, ado.net

为什么我应该始终为 SqlCommand 参数指定 SQL 数据类型，有任何可证明的理由吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T01:20:26.383

我唯一一次遇到必须指定数据类型的情况是在传入 DBNull 时。当我没有指定数据类型时，它默认为 Varchar，并最终崩溃，因为我试图将整数值设置为 Null。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T20:25:40.197

**command.AddWithValue("@Id","1");** // Id 是一个整数

**command.AddWithValue("@Id",'1');** // Id 是一个整数

你们知道我们在SqlCommand里面使用“”和“”有什么区别吗？我用谷歌搜索了很长时间，但我没有看到任何关于这个问题的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T02:54:10.763

而且你会发现有时候你没有指定sql类型*和大小会得到很奇怪的错误*

始终声明正确的 sql 类型和大小是最安全的 - 并且更能自我记录

# location - 获取n英里半径内的所有邮政编码

> ID：326991
> 
> 赞同：4
> 
> 时间：2008-11-29T01:14:27.050
> 
> 标签：location, geography, zipcode

使以下功能起作用的最佳方法是什么：

```
def getNearest(zipCode, miles): 
```

也就是说，给定一个邮政编码（07024）和一个半径，返回该半径内的所有邮政编码？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-29T01:24:25.470

SourceForge 上有一个项目可以帮助解决这个问题：

[http://sourceforge.net/projects/zips/](http://sourceforge.net/projects/zips/)

它为您提供了一个包含邮政编码及其纬度/经度的数据库，以及如何计算两组坐标之间距离的编码示例。可能有更好的方法来做到这一点，但您可以让您的函数检索邮政编码及其坐标，然后逐步遍历列表中的每个邮政编码，如果邮政编码在指定的英里数内，则将其添加到列表中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T01:25:38.417

如果您希望它准确，您必须从包含每个邮政编码的位置和形状的多边形数据开始。我有一个这样的数据库（以前由美国人口普查局发布，但他们不再这样做）并在其上构建了类似的东西，但不是那个确切的要求。

如果您不关心是否*精确（我猜您不关心），您可以获得一个按*[大圆](http://mathforum.org/library/drmath/view/66987.html)距离 排序的邮政编码中心点和查询点表。[PostGIS](http://postgis.refractions.net/)提供了很好的工具来执行此操作，尽管您可以针对将执行类似任务的其他数据库构建查询。

我使用的另一种方法是构建一个包含您想要的圆圈的框，使用 lon/lat 上的 between 子句进行查询，然后在应用程序代码中执行大圆圈。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-01T19:57:12.297

也许这会有所帮助。该项目以公里为单位进行配置。您可以在 CityDAO.java 中修改这些

```
public List<City> findCityInRange(GeoPoint geoPoint, double distance) {
    List<City> cities = new ArrayList<City>();
    QueryBuilder queryBuilder = geoDistanceQuery("geoPoint")
            .point(geoPoint.getLat(), geoPoint.getLon())
            //.distance(distance, DistanceUnit.KILOMETERS) original
            .distance(distance, DistanceUnit.MILES)
            .optimizeBbox("memory")
            .geoDistance(GeoDistance.ARC);

    SearchRequestBuilder builder = esClient.getClient()
            .prepareSearch(INDEX)
            .setTypes("city")
            .setSearchType(SearchType.QUERY_THEN_FETCH)
            .setScroll(new TimeValue(60000))
            .setSize(100).setExplain(true)
            .setPostFilter(queryBuilder)
            .addSort(SortBuilders.geoDistanceSort("geoPoint")
                    .order(SortOrder.ASC)
                    .point(geoPoint.getLat(), geoPoint.getLon())
                    //.unit(DistanceUnit.KILOMETERS)); Original
                    .unit(DistanceUnit.MILES));

    SearchResponse response = builder
            .execute()
            .actionGet();

    SearchHit[] hits = response.getHits().getHits();

    scroll:
    while (true) {

        for (SearchHit hit : hits) {
            Map<String, Object> result = hit.getSource();
            cities.add(mapper.convertValue(result, City.class));
        }

        response = esClient.getClient().prepareSearchScroll(response.getScrollId()).setScroll(new TimeValue(60000)).execute().actionGet();
        if (response.getHits().getHits().length == 0) {
            break scroll;
        }
    }

    return cities;
} 
```

“LocationFinder\src\main\resources\json\cities.json”文件包含比利时的所有城市。如果需要，您也可以删除或创建条目。只要您不更改名称和/或结构，就不需要更改代码。

请务必阅读自述文件[https://github.com/GlennVanSchil/LocationFinder](https://github.com/GlennVanSchil/LocationFinder)

# debugging - 调试全屏应用程序

> ID：326992
> 
> 赞同：3
> 
> 时间：2008-11-29T01:16:50.197
> 
> 标签：debugging, language-agnostic, fullscreen

鉴于我只有一台显示器，调试使用整个屏幕的程序（例如 DirectX 应用程序）的最佳方法是什么？在这种情况下，诸如分步调试器之类的工具似乎毫无用处。此外，打印到控制台也没有那么有效，因为您只能在应用程序终止后查看控制台。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T01:19:11.393

远程调试不行吗？

否则，您可以借用第二台显示器（带视频卡）。

如果所有其他方法都失败了，您可以返回哔声信号。

（或者给自己找一台旧矩阵打印机并将每一行写入打印机；-)）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T01:22:47.190

为了只查看一些运行时信息，我将在全屏中覆盖调试文本。如果是我，我会将应用程序定位为能够在窗口下运行 - 尽管屏幕调试非常适合游戏测试（如果这是一个游戏）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T01:38:19.140

printf 调试很慢，很痛苦，而且很简单。

将您的代码中充满跟踪行，例如

```
fprint(logfile,"%s:%d\n",__FILE__,__LINE__); 
```

或 waterer 你需要你的语言并运行它。完成后，您可以浏览它所做的事情。不过，请先确保您有足够的时间和硬盘空间。它具有一些优势，例如您可以向后“运行”事物并将一次运行与下一次运行进行比较。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T02:04:26.747

我将按照 BCS 的说法添加[SysInternals 的 DebugView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx "Sysinternals 的调试视图")允许您从另一台机器远程连接到它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T02:06:15.057

您可以在窗口模式下测试 99% 的代码，然后对于需要在全屏模式下完成的部分，您可以让它跳转到全屏模式，运行一些测试，然后很快就跳回来（以编程方式或使用 alt-tab）。

基本上我想强调的是，大多数代码不会依赖于全屏，可以在一个小窗口中进行测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T02:10:10.417

您可能需要考虑阅读 Joseph Newcombers 关于图形开发人员界面的文章，网址为[http://www.flounder.com/gdi.htm](http://www.flounder.com/gdi.htm "图形开发者界面")

您可能没有在 MFC 中编码，但您应该能够获得一些有用的想法。他还有很多其他有趣的文章。****