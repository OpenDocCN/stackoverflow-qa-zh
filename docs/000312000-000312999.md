# StackOverflow 问答 000312000-000312999

# performance - 你见过最可笑的悲观情绪是什么？

> ID：312003
> 
> 赞同：146
> 
> 时间：2008-11-23T01:48:21.210
> 
> 标签：performance, optimization

我们都知道过早的优化是万恶之源，因为它会导致代码不可读/不可维护。更糟糕的是悲观化，当有人实施“优化”时，因为他们*认为*它会更快，但最终会变慢，并且出现错误，无法维护等。你见过的最荒谬的例子是什么?

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2008-11-23T03:04:04.050

我认为“过早的优化是万恶之源”这句话是方式，方式过度使用。对于许多项目来说，直到项目后期才考虑性能已成为借口。

这句话往往是人们逃避工作的拐杖。我看到当人们真的应该说“哎呀，我们真的没有事先想到这一点，现在没有时间处理它”时使用了这个短语。

我见过更多关于愚蠢性能问题的“荒谬”示例，而不是由于“悲观化”而引入的问题示例

*   在程序启动期间读取相同的注册表项数千次（或数千次）。
*   加载相同的 DLL 数百或数千次
*   通过不必要地保留文件的完整路径来浪费兆字节的内存
*   没有组织数据结构，因此它们占用的内存比他们需要的多
*   将存储文件名或路径的所有字符串调整为 MAX_PATH
*   对具有事件、回调或其他通知机制的事物进行无偿轮询

我认为更好的说法是：“没有测量和理解的优化根本不是优化——它只是随机变化”。

良好的性能工作是耗时的——通常更多的是功能或组件本身的开发。

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-11-23T02:38:53.650

数据库是悲观的乐园。

收藏夹包括：

*   将表格拆分为多个（按日期范围、字母范围等），因为它“太大”。
*   为停用的记录创建一个存档表，但继续将它与生产表进行 UNION。
*   按（部门/客户/产品/等）复制整个数据库
*   拒绝向索引添加列，因为它会使其太大。
*   创建大量汇总表，因为从原始数据重新计算太慢。
*   创建带有子字段的列以节省空间。
*   非规范化为字段作为数组。

这不是我的想法。

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2008-11-23T11:38:11.923

我认为没有绝对的规则：有些东西最好预先优化，有些则不是。

例如，我在一家公司工作，我们从卫星接收数据包。每个数据包都花费大量资金，因此所有数据都经过高度优化（即打包）。例如，纬度/经度不是作为绝对值（浮点数）发送的，而是作为相对于“当前”区域的“西北”角的偏移量发送的。在使用之前，我们必须解压缩所有数据。但我觉得这不是悲观，而是智能优化，降低沟通成本。

另一方面，我们的软件架构师决定将解压后的数据格式化为可读性很强的 XML 文档，并按原样存储在我们的数据库中（而不是将每个字段存储在相应的列中）。他们的想法是“XML 是未来”、“磁盘空间很便宜”、“处理器很便宜”，所以不需要优化任何东西。结果是我们的 16 字节数据包变成了存储在一列中的 2kB 文档，即使是简单的查询，我们也必须在内存中加载数兆字节的 XML 文档！我们每秒收到超过 50 个数据包，所以你可以想象性能变得多么糟糕（顺便说一句，公司破产了）。

同样，没有绝对的规则。是的，有时过早优化是一个错误。但有时“cpu/磁盘空间/内存很便宜”的座右铭是万恶之源。

* * *

## 回答 #4

> 赞同：81
> 
> 时间：2009-03-29T06:30:48.577

在一个旧项目中，我们继承了一些（非常优秀的）嵌入式系统程序员，他们拥有丰富的 Z-8000 经验。

我们的新环境是 32 位 Sparc Solaris。

其中一个人把所有的 int 都改成了 short 来加速我们的代码，因为从 RAM 中抓取 16 位比抓取 32 位要快。

我必须编写一个演示程序来显示在 32 位系统上抓取 32 位值比抓取 16 位值更快，并解释要抓取 16 位值 CPU 必须使 32 位宽内存访问，然后屏蔽或移动 16 位值不需要的位。

* * *

## 回答 #5

> 赞同：75
> 
> 时间：2009-03-26T15:51:19.033

哦，天哪，我想我都看过了。通常情况下，修复性能问题的人太懒惰而无法解决这些性能问题的原因，甚至研究是否真的存在性能问题。在许多这样的情况下，我想知道这是否不仅仅是那个人想要尝试一种特定的技术并拼命寻找适合他们闪亮的新锤子的钉子的情况。

**这是一个最近的例子：**

数据架构师向我提出了一个详尽的建议，即在一个相当大且复杂的应用程序中垂直分区一个键表。他想知道需要什么样的开发工作来适应变化。谈话是这样的：

**我：**你为什么要考虑这个？您要解决的问题是什么？

**他：**表 X 太宽了，出于性能原因，我们正在对其进行分区。

**我：**是什么让你觉得它太宽了？

**他：**顾问说一张表中的列太多了。

**我：**这会影响性能吗？

**他：**是的，用户报告了应用程序 XYZ 模块的间歇性减速。

**我：**你怎么知道桌子的宽度是问题的根源？

**他：**那是XYZ模块使用的键表，大概有200列。这一定是问题所在。

**我（解释）：**但是模块 XYZ 特别使用了该表中的大多数列，并且它使用的列是不可预测的，因为用户将应用程序配置为显示他们想要从该表中显示的数据。很可能有 95% 的时间我们最终会将所有表重新连接在一起，这会*损害*性能。

**他：**顾问说它太宽了，我们需要改变它。

**我：**这个顾问是谁？我不知道我们聘请了顾问，他们也根本没有与开发团队交谈。

**他：**嗯，我们还没有雇佣他们。这是他们提出的建议的一部分，但他们坚持认为我们需要重新设计这个数据库。

**我：**嗯。所以销售数据库重新设计服务的顾问认为我们需要重新设计数据库......

谈话就这样一直持续着。之后，我再次查看了有问题的表，并确定它可能可以通过一些简单的归一化来缩小范围，而无需特殊的分区策略。一旦我调查了性能问题（以前未报告过）并将它们追踪到两个因素，这当然变成了一个有争议的问题：

1.  缺少几个关键列的索引。
2.  一些流氓数据分析师通过直接使用 MSAccess 查询生产数据库定期锁定关键表（包括“太宽”表）。

当然，架构师仍在推动表格的垂直分区，以解决“太宽”的元问题。他甚至通过从另一位数据库顾问那里获得建议来支持他的案例，该顾问能够确定我们需要对数据库进行重大设计更改，而无需查看应用程序或运行任何性能分析。

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2008-11-23T02:22:43.947

我见过有人使用 alphadrive-7 来完全孵化 CHX-LT。这是一种不常见的做法。更常见的做法是初始化 ZT 转换器以减少缓冲（由于更大的净过载阻力）并创建 java 样式的字节图形。

完全悲观！

* * *

## 回答 #7

> 赞同：53
> 
> 时间：2008-11-23T02:09:26.517

我承认，没有什么惊天动地的，但我发现有人使用 StringBuffer 在 Java 的循环之外连接字符串。这很简单，比如转弯

```
String msg = "Count = " + count + " of " + total + "."; 
```

进入

```
StringBuffer sb = new StringBuffer("Count = ");
sb.append(count);
sb.append(" of ");
sb.append(total);
sb.append(".");
String msg = sb.toString(); 
```

在循环中使用该技术曾经是相当普遍的做法，因为它的速度明显更快。问题是，StringBuffer 是同步的，所以如果你只连接几个字符串，实际上会有额外的开销。（更不用说这种规模的差异绝对是微不足道的。）关于这种做法的另外两点：

1.  StringBuilder 是不同步的，因此在无法从多个线程调用您的代码的情况下，应该优先于 StringBuffer。
2.  现代 Java 编译器会在合适的时候将可读的字符串连接转换为优化的字节码。

* * *

## 回答 #8

> 赞同：47
> 
> 时间：2008-11-23T06:39:03.323

我曾经看到一个使用“根”表的 MSSQL 数据库。Root 表有四列：GUID (uniqueidentifier)、ID (int)、LastModDate (datetime) 和 CreateDate (datetime)。数据库中的所有表都是根表的外键。*每当在数据库中的任何*表中创建新行时，您必须使用几个存储过程在 Root 表中插入一个条目，然后才能访问您关心的实际表（而不是数据库为你用几个触发器简单的触发器）。

这造成了一堆无用的偷听和头痛，需要在上面写任何东西才能使用存储过程（并且消除了我将 LINQ 引入公司的希望。这是可能的，但只是不值得头痛），而且最重要的是没有甚至没有完成它应该做的事情。

选择这条路径的开发人员为它辩护，假设这节省了大量空间，因为我们没有在表本身上使用 Guid（但是......不是在根表中为我们创建的每一行生成一个 GUID 吗？） ，以某种方式提高了性能，并使审计对数据库的更改变得“容易”。

哦，数据库图看起来就像来自地狱的变异蜘蛛。

* * *

## 回答 #9

> 赞同：42
> 
> 时间：2010-07-06T14:28:34.500

**POBI**怎么样——显然是有意的悲观？

 **我 90 年代的同事厌倦了被 CEO 踢屁股，因为 CEO 在每个 ERP 软件（定制软件）发布的第一天都在寻找新功能中的性能问题。即使新功能处理千兆字节并使不可能成为可能，他总是会发现一些细节，甚至是看似重大的问题，以抱怨。他相信自己对编程了解很多，并且通过踢程序员的驴子来获得成功。

由于批评的不称职（他是 CEO，而不是 IT 人员），我的同事从来没有成功过。如果您没有性能问题，则无法消除它...

直到一个版本，他在新代码中加入了大量的延迟（200）函数调用（它是 Delphi）。上线仅用了20分钟，他就被命令亲自到CEO办公室去取回他逾期的辱骂。

到目前为止，唯一不寻常的是，当他回来时，我的同事们保持沉默，微笑着，开玩笑，出去吃一两个巨无霸，而他通常会踢桌子，对 CEO 和公司大发雷霆，然后在一天剩下的时间里被拒绝致死.

自然地，我的同事现在在办公桌前休息了一两天，提高了他在 Quake 中的瞄准技能——然后在第二天或第三天，他删除了延迟调用，重建并发布了一个“紧急补丁”，并传播了这个词他花了2天1夜来修复性能漏洞。

这是邪恶的 CEO 第一次（也是唯一一次）说“干得好！” 给他。这才是最重要的，对吧？

这是真正的 POBI。

但它也是一种社交过程优化，所以它是 100% 可以的。

我认为。

* * *

## 回答 #10

> 赞同：32
> 
> 时间：2009-03-26T19:05:37.663

“数据库独立性”。这意味着没有存储的过程、触发器等——甚至没有任何外键。

* * *

## 回答 #11

> 赞同：31
> 
> 时间：2009-10-02T22:14:01.583

```
var stringBuilder = new StringBuilder();
stringBuilder.Append(myObj.a + myObj.b + myObj.c + myObj.d);
string cat = stringBuilder.ToString(); 
```

我见过的 StringBuilder 的最佳用法。

* * *

## 回答 #12

> 赞同：26
> 
> 时间：2009-03-26T11:00:02.697

当简单的 string.split 就足够时，使用正则表达式拆分字符串

* * *

## 回答 #13

> 赞同：26
> 
> 时间：2009-05-01T07:10:29.313

我知道这个线程很晚，但我最近看到了这个：

```
bool isFinished = GetIsFinished();

switch (isFinished)
{
    case true:
        DoFinish();
        break;

    case false:
        DoNextStep();
        break;

    default:
        DoNextStep();
} 
```

你知道，以防万一布尔值有一些额外的值......

* * *

## 回答 #14

> 赞同：25
> 
> 时间：2009-03-26T18:58:23.080

我能想到的最糟糕的例子是我公司的一个内部数据库，其中包含所有员工的信息。它从 HR 那里获得每晚的更新，并在顶部有一个 ASP.NET Web 服务。许多其他应用程序使用 Web 服务来填充搜索/下拉字段等内容。

悲观的是，开发人员认为重复调用 Web 服务会太慢而无法进行重复的 SQL 查询。他做了什么？应用程序启动事件读取整个数据库并将其全部转换为内存中的对象，无限期存储，直到应用程序池被回收。这段代码太慢了，加载不到 2000 名员工需要 15 分钟。如果您在白天无意中回收了应用程序池，则可能需要 30 分钟或更长时间，因为每个 Web 服务请求都会启动多个并发重新加载。出于这个原因，新员工在创建帐户的第一天就不会出现在数据库中，因此在他们的头几天将无法访问大多数内部应用程序，摆弄他们的拇指。

悲观的第二个层次是开发经理不想碰它，因为害怕破坏依赖的应用程序，但是由于这样一个简单的组件设计不佳，我们继续在公司范围内偶尔出现关键应用程序的中断。

* * *

## 回答 #15

> 赞同：25
> 
> 时间：2009-03-26T19:52:15.697

似乎没有人提到排序，所以我会。

有好几次，我发现有人手工制作了冒泡排序，因为这种情况“不需要”调用已经存在的“太花哨”的快速排序算法。当他们手工制作的冒泡排序在他们用于测试的十行数据上运行良好时，开发人员很满意。在客户添加了几千行之后，它并没有很好地完成。

* * *

## 回答 #16

> 赞同：20
> 
> 时间：2008-11-23T02:57:20.570

我曾经开发过一个充满这样代码的应用程序：

```
 1 tuple *FindTuple( DataSet *set, int target ) {
 2     tuple *found = null;
 3     tuple *curr = GetFirstTupleOfSet(set);
 4     while (curr) {
 5         if (curr->id == target)
 6             found = curr;
 7         curr = GetNextTuple(curr);
 8     }
 9     return found;
10 } 
```

只需删除`found`，最后返回`null`，并将第六行更改为：

```
 return curr; 
```

应用程序性能翻倍。

* * *

## 回答 #17

> 赞同：20
> 
> 时间：2009-03-26T19:06:24.400

我曾经不得不尝试修改将这些 gem 包含在 Constants 类中的代码

```
public static String COMMA_DELIMINATOR=",";
public static String COMMA_SPACE_DELIMINATOR=", ";
public static String COLIN_DELIMINATOR=":"; 
```

这些中的每一个都在应用程序的其余部分中多次用于不同的目的。COMMA_DELIMINATOR 在 8 个不同的包中散布了超过 200 次使用的代码。

* * *

## 回答 #18

> 赞同：19
> 
> 时间：2009-06-01T10:49:26.467

我在内部软件中一次又一次遇到的历史第一名：

**出于“可移植性”的原因不使用 DBMS 的功能，因为“我们可能希望稍后切换到另一个供应商”。**

读我的唇语。对于任何内部工作：它不会发生！

* * *

## 回答 #19

> 赞同：17
> 
> 时间：2009-03-28T03:17:57.910

我有一位同事试图智取我们的 C 编译器的优化器并例行重写只有他才能阅读的代码。他最喜欢的技巧之一是更改可读方法，例如（编写一些代码）：

```
int some_method(int input1, int input2) {
    int x;
    if (input1 == -1) {
        return 0;
    }
    if (input1 == input2) {
        return input1;
    }
    ... a long expression here ...
    return x;
} 
```

进入这个：

```
int some_method() {
    return (input == -1) ? 0 : (input1 == input2) ? input 1 :
           ... a long expression ...
           ... a long expression ...
           ... a long expression ...
} 
```

也就是说，曾经可读的方法的第一行将变为“ `return`”，所有其他逻辑将被深度嵌套的三元表达式替换。当你试图争论这是如何不可维护时，他会指出这样一个事实，即他的方法的汇编输出要短三到四个汇编指令。它不一定*更快*，但总是*短*一点。这是一个嵌入式系统，内存使用有时很重要，但是可以进行比这更容易的优化，从而使代码保持可读性。

然后，在这之后，由于某种原因，他认为这`ptr->structElement`太难读了，所以他开始把所有这些都改成`(*ptr).structElement`这样的理论，即它更具可读性和更快。

将可读代码变成不可读代码最多可以提高 1%，有时实际上代码会变慢。

* * *

## 回答 #20

> 赞同：15
> 
> 时间：2010-07-10T01:56:15.313

在我作为一名成熟的开发人员的第一份工作中，我接手了一个项目，该项目遇到了扩展问题。它在小型数据集上工作得相当好，但在给定大量数据时会完全崩溃。

当我深入研究时，我发现最初的程序员试图通过并行化分析来加快速度——为每个额外的数据源启动一个新线程。然而，他犯了一个错误，即所有线程都需要共享资源，而它们在共享资源上处于死锁状态。当然，并发的所有好处都消失了。此外，它使大多数系统崩溃以启动 100 多个线程，但只有一个线程被锁定。我强大的开发机器是个例外，它在大约 6 小时内处理了 150 个源数据集。

所以为了修复它，我删除了多线程组件并清理了 I/O。在没有其他更改的情况下，150 个源数据集的执行时间在我的机器上下降到 10 分钟以下，在普通公司机器上从无穷大下降到不到半小时。

* * *

## 回答 #21

> 赞同：14
> 
> 时间：2009-03-27T10:26:09.150

我想我可以提供这个宝石：

```
unsigned long isqrt(unsigned long value)
{
    unsigned long tmp = 1, root = 0;
    #define ISQRT_INNER(shift) \
    { \
        if (value >= (tmp = ((root << 1) + (1 << (shift))) << (shift))) \
        { \
            root += 1 << shift; \
            value -= tmp; \
        } \
    }

    // Find out how many bytes our value uses
    // so we don't do any uneeded work.
    if (value & 0xffff0000)
    {
        if ((value & 0xff000000) == 0)
            tmp = 3;
        else
            tmp = 4;
    }
    else if (value & 0x0000ff00)
        tmp = 2;

    switch (tmp)
    {
        case 4:
            ISQRT_INNER(15);
            ISQRT_INNER(14);
            ISQRT_INNER(13);
            ISQRT_INNER(12);
        case 3:
            ISQRT_INNER(11);
            ISQRT_INNER(10);
            ISQRT_INNER( 9);
            ISQRT_INNER( 8);
        case 2:
            ISQRT_INNER( 7);
            ISQRT_INNER( 6);
            ISQRT_INNER( 5);
            ISQRT_INNER( 4);
        case 1:
            ISQRT_INNER( 3);
            ISQRT_INNER( 2);
            ISQRT_INNER( 1);
            ISQRT_INNER( 0);
    }
#undef ISQRT_INNER
    return root;
} 
```

由于平方根是在一个非常敏感的地方计算的，我的任务是寻找一种让它更快的方法。这个小的重构将执行时间减少了三分之一（对于使用的硬件和编译器的组合，YMMV）：

```
unsigned long isqrt(unsigned long value)
{
    unsigned long tmp = 1, root = 0;
    #define ISQRT_INNER(shift) \
    { \
        if (value >= (tmp = ((root << 1) + (1 << (shift))) << (shift))) \
        { \
            root += 1 << shift; \
            value -= tmp; \
        } \
    }

    ISQRT_INNER (15);
    ISQRT_INNER (14);
    ISQRT_INNER (13);
    ISQRT_INNER (12);
    ISQRT_INNER (11);
    ISQRT_INNER (10);
    ISQRT_INNER ( 9);
    ISQRT_INNER ( 8);
    ISQRT_INNER ( 7);
    ISQRT_INNER ( 6);
    ISQRT_INNER ( 5);
    ISQRT_INNER ( 4);
    ISQRT_INNER ( 3);
    ISQRT_INNER ( 2);
    ISQRT_INNER ( 1);
    ISQRT_INNER ( 0);

#undef ISQRT_INNER
    return root;
} 
```

当然，有更快更好的方法来做到这一点，但我认为这是悲观的一个很好的例子。

编辑：想想看，展开的循环实际上也是一种巧妙的悲观。深入研究版本控制，我也可以展示重构的第二阶段，它的表现甚至比上面的还要好：

```
unsigned long isqrt(unsigned long value)
{
    unsigned long tmp = 1 << 30, root = 0;

    while (tmp != 0)
    {
        if (value >= root + tmp) {
            value -= root + tmp;
            root += tmp << 1;
        }
        root >>= 1;
        tmp >>= 2;
    }

    return root;
} 
```

这是完全相同的算法，尽管实现方式略有不同，所以我认为它是合格的。

* * *

## 回答 #22

> 赞同：11
> 
> 时间：2008-11-23T02:45:25.663

这可能比你所追求的更高，但修复它（如果你被允许）也涉及更高的痛苦：

坚持手头滚动对象关系管理器/数据访问层，而不是使用已建立的、经过测试的、成熟的库之一（即使在向您指出它们之后）。

* * *

## 回答 #23

> 赞同：10
> 
> 时间：2010-07-27T13:05:32.927

所有外键约束都从数据库中删除，否则会出现很多错误。

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2009-03-26T17:43:05.677

在每次 javascript 操作之前检查您正在操作的对象是否存在。

```
if (myObj) { //or its evil cousin, if (myObj != null) {
    label.text = myObj.value; 
    // we know label exists because it has already been 
    // checked in a big if block somewhere at the top
} 
```

我对这种类型的代码的问题是似乎没有人关心如果它不存在怎么办？什么都不做？不给用户反馈？

我同意这些`Object expected`错误很烦人，但这不是最好的解决方案。

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2009-03-28T03:52:24.317

这并不完全符合这个问题，但无论如何我都会提到它作为一个警示故事。我正在开发一个运行缓慢的分布式应用程序，然后飞到华盛顿参加一个主要旨在解决问题的会议。项目负责人开始概述旨在解决延迟的重新架构。我自愿在周末进行了一些测量，将瓶颈隔离为单一方法。事实证明，在本地查找中缺少一条记录，导致应用程序必须在每笔交易中访问远程服务器。通过将记录添加回本地存储，消除了延迟 - 问题解决了。请注意，重新架构不会解决问题。

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2009-03-26T20:12:40.373

YAGNI 极端主义怎么样。这是过早悲观的一种形式。似乎任何时候你应用 YAGNI，然后你最终都需要它，导致添加它的工作量是你一开始添加它的 10 倍。如果您创建了一个成功的程序，那么您很可能会需要它。如果您习惯于创建生命很快耗尽的程序，那么请继续练习 YAGNI，因为那时我认为是 YAGNI。

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2009-05-02T18:57:18.000

不完全是过早的优化——但肯定是被误导了——这是在 BBC 网站上从一篇讨论 Windows 7 的文章中读到的。

> Curran 先生表示，Microsoft Windows 团队一直在研究操作系统的各个方面以进行改进。“通过稍微修剪 WAV 文件的关机音乐，我们能够将关机时间缩短 400 毫秒。

现在，我还没有尝试过 Windows 7，所以我可能错了，但我敢打赌，其中还有其他问题比关闭需要多长时间更重要。毕竟，一旦我看到“正在关闭 Windows”消息，显示器就会关闭并且我要走开——这 400 毫秒对我有什么好处？

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2011-01-19T03:55:39.913

我部门的某个人曾经写过一个字符串类。类似的接口`CString`，但没有 Windows 依赖。

他们所做的一项“优化”是*不*分配比必要更多的内存。显然没有意识到类`std::string`分配过多内存的原因是为了使一系列`+=`操作可以在 O(n) 时间内运行。

相反，**每次`+=`调用**都会强制重新分配，这会将重复的追加变成 O(n²) [Schlemiel the Painter's algorithm](http://www.joelonsoftware.com/articles/fog0000000319.html)。

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2008-11-23T23:09:49.860

我的一个前同事（实际上是一个[soab](http://dilbert.com/fast/1998-07-16/)）被指派为我们的 Java ERP 构建一个新模块，该模块应该收集和分析客户的数据（零售行业）。他决定将每个日历/日期时间字段拆分为其组件（秒、分钟、小时、日、月、年、一周中的某一天、bmester、trimester (!)），因为“我还要如何查询‘每个星期一’？”

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2009-03-26T09:25:19.867

没有冒犯任何人，但我只是给一个有这个的作业（java）评分

```
import java.lang.*;
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2009-03-26T19:29:50.320

也许只是在早期快速浏览一下系统将有助于指出可能的瓶颈。

“这部分不需要很快”（归档日志）“这部分必须很快”（接受新连接）

然后非常快的部分通常不需要用肮脏的怪癖进行额外的优化，通常体面的硬件和编码良好的部分就足够了。

只需回答一个简单的问题“我是否可以从快速编写这部分代码中获得任何好处？” 将是一个很好的指导方针。我的意思是，使用常识可以优化项目的其他部分！

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2009-06-05T19:46:38.517

我不认为悲观是罕见的。从我做性能调优的经验来看，很多糟糕的性能是由以“效率”为名的“良好的编程实践”造成的。例子：

*   地图集合或“字典”
    这些通常使用某种哈希编码，因此它们将具有 O(1) 性能，但只有在填充比通常使用的多得多的项目时才会达到平衡。

*   迭代器
    这些被认为可能被优化为有效的内联代码是合理的，但很少检查它们是否真的是。

*   通知和事件处理作为保持数据一致性的一种方式
    由于数据结构很少被规范化，因此必须管理不一致性，并且通知是常用的方法，因为它应该“立即”解决问题。但是，即时性和效率之间存在很大差异。还鼓励“属性”在获取或设置时深入数据结构以尝试保持一致。这些“短约束”方法会导致大量计算浪费。“长皮带”方法，例如周期性地循环通过数据结构来“修复”它，可能不那么“即时”，但效率更高。

[例子](https://stackoverflow.com/questions/926266/performance-optimization-strategies-of-last-resort/927773#927773)

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2011-09-28T20:38:57.860

```
while true; do echo 3 > /proc/sys/vm/drop_caches; sleep 3600; done 
```

这导致内核花时间清除磁盘缓存，一旦成功，一切都会缓慢运行，直到重新填充缓存。错误理解是磁盘缓存阻止内存可供应用程序使用。

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2009-03-26T22:53:31.983

我的一些同事，在现有服务器端批处理（用 C++ 编写）的“优化”项目中，使用特定于 win32 的代码和函数“优化”到死日志类（！）。

也许瓶颈在 logger.write(...) 中，谁知道呢...

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2009-03-27T06:56:41.183

一位同事必须检查特定角色对页面的访问权限 - 仅限“管理员”。这是她写的：

.

```
if( CurrentUser.CurrentRole == "Role1" || CurrentUser.CurrentRole == "Role2")  
{
// Access denied
} 
else
{
// Access granted
} 
```

代替

```
if( !CurrentUser.CurrentRole.equals("Admin") ) 
{
 // access denied
} 
```

因此，每当向系统添加新角色时，新角色都可以访问所有机密页面。

* * *

同一个同事还加入了所有查询的生产和存档表。

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2009-03-27T14:36:27.413

另一个花哨的表演技巧:)

```
if (!loadFromDb().isEmpty) {
    resultList = loadFromDb();
    // do something with results
} 
```

只需少量额外的 DB 命中，您就可以节省 10 行代码的所有时间，这在空列表上可能不会做太多事情。像这样的东西分散在代码中:)

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2011-09-13T18:54:24.883

多年前我作为顾问访问过的一家公司写了一个排序函数，看起来像这样：

```
procedure sort(string[] values, string direction)
begin
  while not sorted do
  begin
    for every value in values
    begin
      if direction="Ascending" then
      begin
        ... swap values in ascending order
      end
      else if direction="Descending" then
      begin
        ... swap values in descending order
      end
    end;
  end;
end; 
```

那是一种冒泡排序算法（本身效率低下），在内部循环中*对方向进行字符串比较！*我简直不敢相信自己的眼睛，并解释说是的，我可能可以在这里进行一些速度改进（他们毕竟是我的客户，所以我不得不对这是我见过的最非最佳代码这一事实保持外交态度:-) )

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2009-03-26T19:24:02.393

我打算提到 StringBuilder 用于微小/非循环字符串连接，但它被提到了。

将方法的变量放入私有类成员中，以防止它们“每次运行方法时都会收集垃圾”。变量是值类型。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2009-03-26T20:46:33.303

使用整数字段*按位*分配我们的客户可以将其用户添加到的应用程序访问分组的应用程序。这意味着当时我们可以创建总共 32 个组，供所有 500 多个客户共享。

啊，但是按位比较比等于快，比连接快，对吧？

不幸的是，当我完全（并且相当直言）对这段代码和它的作者感到害怕时，我发现作者是我老板的老板。事实证明，这是一个相当专制的家伙。

附言

我知道你在想什么，它完全应该是一个二进制字符串，对吧？:)

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2009-04-15T16:56:24.670

许多程序员不知道或不想知道 SQL，因此他们找到了“技巧”来避免真正使用 SQL，以便将数据放入数组中。数组使一些人快乐。（我喜欢游标和数组。可口可乐和百事可乐。）我在一些抱怨关系数据库速度慢的面向对象程序员的代码中发现了这两个代码块。（答案不是更多的内存或更多的处理器。）

本例中的表是一个巨大的表，其中 uniqueid_col 是唯一的 id 或唯一的行。

将此数据加载到 arrayX 中（因为数组必须更快）

```
   选择 uniqueid_col, col2, col3
     来自 super_big_tbl

```

（伪代码）

```
 Loop 
   arrayX.next_record
    if uniqueid_col = '829-39-3984'
      return col2
    end if
end loop 
```

（我的答案在底部。）

下一个是我也见过的一个简单错误。这个想法是你永远不会以这种方式得到重复：

```
   选择 uniqueid_col, col2, col3
     来自 super_big_tbl
 按 uniqueid_col、col2、col3 分组
   具有 uniqueid_col = '829-39-3984'

```

正确的语法应该是

```
   选择 uniqueid_col, col2, col3
     来自 super_big_tbl
    其中 uniqueid_col = '829-39-3984'

```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2009-03-26T20:56:48.287

任何不基于分析器工具的分类报告的重大优化工作都会从我那里获得巨大的 WTF。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2009-10-02T22:00:02.923

我有一个故意的......我曾经通过回溯实现排序......只是作为概念证明;））不用说它的性能是可怕的。

# design-patterns - 我可以使用什么数据库架构来保存不同类型的计费数据？

> ID：312006
> 
> 赞同：2
> 
> 时间：2008-11-23T01:51:54.650
> 
> 标签：design-patterns, database-design, architecture, schema, billing

我有一个创建订单的系统，该订单可以记入房屋帐户、货到付款 (COD) 或从信用卡中收取。我创建了以下表格：

ORDERS
order_id
billingoption_id

BILLINGOPTIONS
billingoption_id

我不确定应该如何为计费数据构建下一个表。我应该为每种类型的计费选项（即 COD、信用卡和家庭账户）建立一个单独的表吗？那么我会在 Orders 表上有另一个外键列来引用计费数据的记录吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-23T05:10:42.237

你可以用任何一种方式来做：一个大的喇叭`billingoptions`表，它的字段包含所有类型，NULL 表示不适用于给定类型的字段，或者一堆“明星”父表的子`billingoptions`表. 两者都有其优点和缺点。

对于大喇叭桌，

*   很高兴可以在单个表中轻松引用所有数据。
*   跟踪外键依赖关系并执行更新或插入是有效的。
*   但是您需要更改表结构以在将来添加新的计费选项，并且可能会存储无效的数据组合（例如，在同一记录中设置了信用卡类型和 COD 标志）。

对于小婴儿桌，

*   数据被分区并密切反映程序的对象结构很好。
*   很高兴您可以添加新的付款方式或更改现有的付款方式，而不必担心影响其他付款方式。
*   关系非常明确。您不能意外地将一笔存款与另一笔存款联系起来，因为外键将要求它与批准相关联。
*   但是您最终会在设计中引入大量表，这些表需要大量 JOIN，导航可能会很痛苦，并且在插入和更新方面效率不高。

在工作中，我们最终选择了小婴儿桌。它看起来像这样：

```
表顺序：
--> OrderId PK
-->（很多其他领域）

餐桌付款：
--> PaymentId PK
--> OrderId (FK) [每个订单可能有多个付款]
--> PaymentType [受限字段包含类似的值
       'PAYPAL' 或 'CREDIT'，你用它来知道哪个
       要查找的婴儿表，可以包含其他
       信息]

表付款贝宝：
--> PaymentPayPalId PK
--> PaymentId FK 指向 Table Payments
--> 事务号
-->（其他 PayPal 特定字段）

表付款检查：
--> PaymentCheckId PK
--> PaymentId FK 指向 Table Payments
--> 路由号
-->（其他电子支票特定字段）

+ 其余付款类型的其他表格....

```

所有支付类型共享三个交易相关表：

```
表付款批准：
--> PaymentApprovalId PK
--> PaymentId FK 指向 Table Payments
--> 状态 [一些标志意味着“成功”、“失败”、“逆转”等]
--> ProcessorMessage [服务发回的东西，比如'(M) CVV2 Matched']
--> 金额
-->（其他行政领域）

表支付存款：
--> PaymentDepositId PK
--> PaymentApprovalId FK 指向表 PaymentApprovals
--> 状态
--> 处理器消息
--> 金额
-->（其他行政领域）

表付款退款：
--> PaymentRefundId PK
--> PaymentDepositId FK 指向表 PaymentDeposits
--> 状态
--> 处理器消息
--> 金额
-->（其他行政领域）

```

我们所有的付款方式（信用卡、PayPal、Google Checkout、支票、现金、商店信用和汇票）都被抽象为适合这个 Approval --> Deposit --> Refund 比喻，并且 UI 调用相同的方法an`IPayment`和`IPaymentProcessor`具有不同实现的接口（`CybersourcePaymentProcessor`,`PayPalPaymentProcessor`等）。尽管有时 GUI 会向用户显示不同的措辞（例如，它会说“授权”和“收费”而不是“批准”和信用卡支付的“存款”，输入现金的屏幕一举执行批准/存款步骤。）

希望这是有道理的。听起来您实际上并没有存储付款信息，但考虑这些事情最终会在哪里是很有用的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-23T02:00:16.973

专注于事物。实际的东西。试着先用自然语言简单、直接地描述事物。

然后，当您要求设计指导时，您可以提供定义。在某些情况下，编写定义的行为会使设计具体化。

**订单**就是东西。订单的属性是什么？客户、产品、付款/计费选项。

**计费选项**（几乎）是东西。显然，您可以定义和识别它们。（我不确定我能不能。从你的问题来看，你似乎可以。但如果没有一句话总结，我不确定 Billion Options 发生了什么。

什么是“计费数据”？这是什么东西？它有什么属性（或属性）？

“计费数据”与订单有何关联？它与计费选项有何关系？

随意用每件事的定义来更新问题。

# .net - 连接 .NET DataSet 中的表以在 DataGridView 中显示

> ID：312009
> 
> 赞同：2
> 
> 时间：2008-11-23T01:58:31.283
> 
> 标签：.net, datagridview, join, dataset

我在 .NET 的数据集中有两个表。我想加入他们的 ID 列。然后我希望 DataGridView 显示第一个表中的两列和第二个表中的一列。

如果它更容易，两个表之间的关系是一对一的。

可以做到吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T16:34:23.103

那么，它是只读的吗？在 .NET 3.5 / C# 3.0 中，您可能很容易使用 LINQ 连接和匿名输出类型：

```
 DataTable left = new DataTable
        {
            Columns = { {"PK", typeof(int)}, {"Name", typeof(string)}},
            Rows = {{1,"abc"},{2,"def"}}
        }, right = new DataTable
        {
            Columns = { { "FK", typeof(int) }, { "Value", typeof(decimal) } },
            Rows = { { 1, 123.45M }, { 2, 678.9M } }
        };
        var qry = from x in left.Rows.Cast<DataRow>()
                  join y in right.Rows.Cast<DataRow>()
                  on x.Field<int>("PK") equals y.Field<int>("FK")
                  select new
                  {
                      Name = x.Field<string>("Name"),
                      Value = y.Field<decimal>("Value")
                  };
        var data = qry.ToList(); 
```

然后，您可以绑定到数据的“名称”和“值”。请注意，使用类型化数据集更容易，因为您可能会丢失`Cast<>`和`Field<>`垃圾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-06T22:36:30.750

为什么不使用设计师？您将两个表都放在数据集中，建立关系，然后将 Fill/Get 方法更改为如下所示（使用“内部连接”）：

> 选择 Productos.idProducto、Productos.Nombre、Precios.Precio、Tiendas.idTienda、Zonas.Zona、Productos.idZona 从
> Productos 内部加入 Precios ON Productos.idProducto = Precios.idProducto

# c# - .NET/Mono 数据库访问——简单的列访问？

> ID：312013
> 
> 赞同：0
> 
> 时间：2008-11-23T02:03:11.350
> 
> 标签：c#, .net, database, postgresql

我不确定我是否遗漏了一些非常明显的东西或什么，但我似乎无法弄清楚如何有效地访问关系数据库中的表。我将 PostgreSQL 用于数据库服务器（和 Npgsql 用于其访问）和 C# 与 Mono 2.0。

假设我有由以下`CREATE TABLE`和`INSERT`语句创建的表。

```
CREATE TABLE foo (
  id UUID NOT NULL PRIMARY KEY,
  bar VARCHAR(20) NOT NULL,
  baz INT NOT NULL
)

INSERT INTO foo VALUES ('f42d3178-b900-11dd-ac23-001966607b2e', 'foo!', 1); 
```

到目前为止，我理解它的方式，我必须（C#）：

```
using(NpgsqlConnection dbc = new NpgsqlConnection(connectionString)) {
  using(NpgsqlCommand cmd = new NpgsqlCommand("SELECT * FROM foo LIMIT 1", dbc)) {
    NpgsqlDataReader rdr = cmd.ExecuteReader();

    if(!rdr.HasRows())
      throw new Exception("No rows");

    rdr.Read();

    Guid id = rdr.GetGuid(0);
    string bar = rdr.GetString(1);
    int baz = rdr.GetString(2);
  }
} 
```

但是，我真正想做的是类似于以下伪代码：

```
using(NpgsqlConnection dbc = new NpgsqlConnection(connectionString)) {
  using(NpgsqlCommand cmd = new NpgsqlCommand("SELECT * FROM foo LIMIT 1", dbc)) {
    NpgsqlDataReader rdr = cmd.ExecuteReader();

    if(!rdr.HasRows())
      throw new Exception("No rows");

    rdr.Read();

    Guid id = (Guid)rdr["id"];
    string bar = (string)rdr["bar"];
    int baz = (int)rdr["baz"];
  }
} 
```

在我看来（希望我只是在某处遗漏了一些明显的东西）需要数据库访问的顶级方法，当您要处理大量关系时，这确实很麻烦......所以，是有没有办法做一些更接近后一种伪代码的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T02:26:25.937

如果您想轻松使用 ORM 框架。

如果您想要最大性能，这应该可以。只要记住缓存总是最快的:)

顶级示例也更快，因为没有转换。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T02:23:44.943

嘿...原来我应该只是*尝试*而不是问。找不到任何文档说它有效，但它似乎有效。

# c# - C# 中的多行模板文本控件

> ID：312015
> 
> 赞同：3
> 
> 时间：2008-11-23T02:04:18.307
> 
> 标签：c#, controls

我想要一个文本框，允许其中的某些文本是“恒定的”且不可编辑，而其余文本是可编辑的。例如，我想定义一个这样的模板：

```
<Name:>[]
<Address:>[] <City>:[] 
```

这样用户以后可以输入：

```
<Name:>[Stefan]
<Address:>[Nowhere] <City>:[Alaska] 
```

但不是：

```
<I'm typing here lol:>[Stefan]
<Address:>[Nowhere] <State>:[Alaska] 
```

理想情况下，他们甚至不能将光标放在 <> 之间，类似于 Microsoft Word 模板。

有任何想法吗？例如，蒙版文本框控件似乎在正确的路径上，但不是多行的，并且不允许您在大括号之间输入可变数量的字符。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T02:19:17.747

我不知道任何现成的组件。但是你可以试试这个简单的方法。

1.  创建一个普通的多行文本框控件
2.  创建一个基于正则表达式的模板，该模板具有`(.*)`或`([a-z]*)`任何您希望用户添加文本的位置。
3.  每当文本更改时，检查它是否仍然与正则表达式匹配。如果是这样，请接受 chagne。如果没有，请拒绝更改。

然后，您可以使用相同的正则表达式从文本框中提取数据。

您甚至可以使用 RichTextBox 并使用正则表达式来执行格式化。

**更新**这是我写的。它似乎工作：

```
[DefaultProperty("Regex")]
public partial class MaskedEdit : UserControl
{
    private Regex regex = new Regex("");
    private bool myChange = false;

    private string goodText;
    private Font dataFont;

    public MaskedEdit()
    {
        myChange = true;
        InitializeComponent();
        myChange = false;
        dataFont = new Font(Font, FontStyle.Bold);
        goodText = Text;
    }

    [Editor("System.ComponentModel.Design.MultilineStringEditor, System.Design", typeof(UITypeEditor)), Localizable(true)]
    [DefaultValue("")]
    public String Regex
    {
        get { return regex.ToString(); }
        set
        {
            if (value != null)
            {
                regex = new Regex(value);
            }
        }
    }

    [EditorBrowsable(EditorBrowsableState.Always)]
    [Browsable(true)] 
    [Editor("System.ComponentModel.Design.MultilineStringEditor, System.Design", typeof(UITypeEditor)), Localizable(true)]
    [DesignerSerializationVisibility(DesignerSerializationVisibility.Visible)]
    public override string Text
    {
        get { return rtf.Text; }
        set {
            int selSt = rtf.SelectionStart;
            int selLen = rtf.SelectionLength;

            rtf.Text = value;

            rtf.SelectionStart = selSt;
            rtf.SelectionLength = selLen;
        }
    }

    private void rtf_TextChanged(object sender, EventArgs e)
    {
        if (myChange) return;
        Match m = regex.Match(Text);
        if (m.Success)
        {
            goodText = Text;
            Colorize(m);
        }
        else
        {
            myChange = true;
            Text = goodText;
            myChange = false;
            m = regex.Match(Text);
            if (m.Success)
            {
                Colorize(m);
            }
        }
    }

    public IEnumerable<string> Data
    {
        get
        {
            Match m = regex.Match(Text);
            bool first = true;
            foreach (Group g in m.Groups)
            {
                if (first) { first = false; continue; }
                yield return Text.Substring(g.Index, g.Length);
            }
        }
    }

    private void Colorize(Match m)
    {
        int selSt = rtf.SelectionStart;
        int selLen = rtf.SelectionLength;

        rtf.SelectionStart = 0;
        rtf.SelectionLength = rtf.TextLength;
        rtf.SelectionFont = Font;
        bool first = true;
        foreach (Group g in m.Groups)
        {
            if (first) { first = false; continue; }
            rtf.SelectionStart = g.Index;
            rtf.SelectionLength = g.Length;
            rtf.SelectionFont = dataFont;
        }

        rtf.SelectionStart = selSt;
        rtf.SelectionLength = selLen;
    }

    private void MaskedEdit_FontChanged(object sender, EventArgs e)
    {
        dataFont = new Font(Font, FontStyle.Bold);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T16:08:48.977

我建议使用多个控件而不是一个。单个文本框将要求用户将光标移至下一个字段，而多个控件将允许用户在字段之间切换，这是预期的行为。如果你想让它*看起来*像一个控件（也许让它看起来像一个地址标签或其他东西），你可以使用无边框文本框并将标签和文本框都放在一个有边框和`SystemColors.Window`背景的面板中。为了获得额外的效果，最好在每个文本框下方放置线条，这很容易通过带有`BorderStyle.FixedSingle`边框的 1 像素高的标签来完成。

# css - 在 IE6 CSS 中使用双类？

> ID：312022
> 
> 赞同：24
> 
> 时间：2008-11-23T02:14:57.677
> 
> 标签：css, internet-explorer-6, css-selectors

有什么方法可以让 IE6 理解双类，比如我有一个带有颜色类的 MenuButton 类，可能还有一个点击类；像 ：

```
.LeftContent a.MenuButton {..general rules..}  
.LeftContent a.MenuButton.Orange {..sets background-image..}  
.LeftContent a.MenuButton.Clicked {...hum ta dum...} 
```

现在，IE6 可以理解`<a class="MenuButton Orange">`，但是当添加 Clicked,like 时`<a class="MenuButton Orange Clicked">`，IE 只是忽略了 Clicked 规则。

当然，我可以重写我的 CSS，并且对 .MenuButtonOrange
等有自己的规则（而且它可能比问这个问题花费的时间要短得多 ;-)，
但是天哪，它太不吸引人了，而且 Web 0.9 ......

干杯!

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-23T02:36:12.877

IE6 不支持多个类选择器。您看到`Orange`类更改的原因`a.MenuButton.Orange`是 IE6 将其解释为`a.Orange`.

我建议以可以解决此问题的方式构建标记：

```
<div class="leftcontent">
   <ul class="navmenu">
     <li><a class="menubutton orange" href="#">One</a></li>
     <li><a class="menubutton orange clicked" href="#">Two</a></li>
   </ul>
</div> 
```

通过按更具体的祖先分组，您可以创建具有该祖先范围内的类的变体（在此示例中`navmenu`）：

```
.leftcontent .navmenu a { /* ... basic styles ... */ }
.leftcontent .navmenu a.orange { /* ... extra orange ... */ }
.leftcontent .navmenu a.clicked { /* ... bold text ... */ } 
```

它不如多个类，但我用它来解决 IE 中缺乏支持的问题。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-01-07T16:47:33.210

Dean Edwards 的 IE7 脚本为 IE6 添加了多个类支持。请参阅[http://code.google.com/p/ie7-js/](http://code.google.com/p/ie7-js/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-23T13:05:25.833

> 如果我使用（就像我在问题中写的那样），特定于标签的规则，例如 .LeftContent a.MenuButton.Orange，它可以工作......
> 
> It only matches them if the classes in the selector are in the same order as the classes on the element.

这并不完全正确。IE6（和 Quirks 模式下的 IE7）每个选择器部分只记住一个类。如果你写两个，第二个会覆盖第一个。所以“a.MenuButton.Orange”在效果上与“a.Orange”相同。

所以现在仍然必须避免使用多个类选择器。

# c# - LINQy 方法来检查集合中的任何对象是否具有相同的属性值

> ID：312024
> 
> 赞同：7
> 
> 时间：2008-11-23T02:20:38.367
> 
> 标签：c#, linq

我有一个具有属性 ID 的类代理

给定一组代理，我需要检查其中是否有重复的 ID。

我目前正在使用哈希表执行此操作，但正在尝试获取 Linq-ified，这样做的好方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-23T02:35:36.013

与 Y Low 的方法类似，

**编辑：**

```
 var duplicates = agents.GroupBy(a => a.ID).Where(a=>a.Count() > 1);

 foreach (var agent in duplicates)
 {
         Console.WriteLine(agent.Key.ToString());
 } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-24T04:57:45.757

对于它的价值，我只是比较了我们在这个线程中遇到的两种方法。首先我定义了一个辅助类：

```
public class Foo
{
    public int ID;
} 
```

...然后制作了一个带有随机 ID 的实例的大列表：

```
var list = new List<Foo>();

var r = new Random();

for (int i = 0; i < 10000; i++) list.Add(new Foo { ID = r.Next() }); 
```

...最后，对代码进行计时：

```
var sw = new Stopwatch();
sw.Start();
bool b = list.Any(i => list.Where(j => i != j).Any(j => j.ID == i.ID));
Console.WriteLine(b);
Console.WriteLine(sw.ElapsedTicks);

sw.Reset();
sw.Start();
b = (list.GroupBy(i => i.ID).Count() != list.Count);
Console.WriteLine(b);
Console.WriteLine(sw.ElapsedTicks); 
```

这是一个输出：

> 错误的
> 
> 59392129
> 
> 错误的
> 
> 168151

所以我认为可以肯定地说分组然后将组数与项目数进行比较比进行强力“嵌套任何”比较要快得多*。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T17:07:24.443

我的看法（不算数！）：

```
var duplicates = agents
  .GroupBy(a => a.ID)
  .Where(g => g.Skip(1).Any()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T02:27:51.503

```
foreach(var agent in Agents) {
    if(Agents.Count(a => a.ID == agent.ID) > 1)
        Console.WriteLine("Found: {0}", agent.ID);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T02:27:52.610

```
bool b = list.Any(i => list.Any(j => j.ID == i.ID && j != i)); 
```

这是一种蛮力的方法，但它确实有效。使用 except() 扩展方法可能有更聪明的方法。

编辑：您实际上并没有说您需要知道*哪些*项目是“重复的”，只是您需要知道是否在哪里。除了给你一个可以迭代的列表之外，这将做同样的事情：

list.Where(i => list.Any(j => j.ID == i.ID && j != i))

我也喜欢分组方法（按 ID 分组并找到计数 > 1 的组）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-19T22:15:56.087

这就是我不需要在一行中进行分组的方式：

```
 List<Agent> duplicates = new HashSet<Agent>(agents.Where(c => agents.Count(x => x.ID == c.ID) > 1)).ToList(); 
```

# entity-framework - 实体框架管道：表达式树到 ESQL 到 SQL？

> ID：312030
> 
> 赞同：3
> 
> 时间：2008-11-23T02:27:02.817
> 
> 标签：entity-framework

实体框架管道是什么样的？什么被翻译成 SQL、表达式树或 ESQL，或两者兼而有之？ESQL 是实体框架提供者需要实现或翻译的东西，还是框架需要处理的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-04T23:17:40.433

Entity SQL 和 LINQ 表达式都被解析为一个通用的规范查询树，然后对其进行解析以生成提供程序特定的 SQL。

吉姆·伍利

[www.ThinqLinq.com](http://www.ThinqLinq.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T16:07:20.647

您看过[示例](http://code.msdn.microsoft.com/EFSampleProvider)提供程序源[代码](http://code.msdn.microsoft.com/EFOracleProvider)吗？

# .net - 多地图实现

> ID：312040
> 
> 赞同：1
> 
> 时间：2008-11-23T02:38:32.403
> 
> 标签：.net, performance, data-structures, collections

我正在用 C# 编写一个简单的 IDictionary 抽象，它包装了 Dictionary<K, ICollection<V>>。基本上，它将多个值映射到一个键。当值列表中的最后一项被删除时，我无法决定是删除一个键及其空列表，还是保留它（以避免在重用键时实例化新集合）并检查键的值'计数在确定密钥是否存在时。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T14:26:14.610

我会删除这些集合，以便您的 MultiMap 具有一致的行为。如果我使用您的 MultiMap，我会非常惊讶（并且不高兴）发现丢失的键的行为会有所不同，具体取决于键之前是否在 MultiMap 中。

Clear() 是否删除集合？

如果不删除集合，也可能会造成意外的内存泄漏。开发人员可能会添加许多项目，然后将其删除。内存使用（在 GC 之后）应该恢复到与添加这些项目之前相同的数量。

我不会担心创建集合的成本。我会担心您为 MultiMap 创建的合同。如果在分析您的应用程序后您发现这是一个问题，您可以为该行为修改或创建一个特殊的 MultiMap。不要陷入过早优化的陷阱。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T13:20:39.987

在 .NET 3.5 中，存在`ILookup<TKey,TValue>`和`Lookup<TKey,TValue>`充当多映射。内置实现 ( `Lookup<TKey,TValue>`) 是不可变的，但我`EditableLookup<TKey,TValue>`在[miscutil](http://www.yoda.arachsys.com/csharp/miscutil/)中编写了一个。

在那个版本中；是的-如果删除了最后一项（带有该密钥），我将删除该密钥。这使得查看存在哪些键（即`.Keys`等）变得更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T02:55:47.920

为什么即使删除所有值也不将密钥视为存在，并提供用于删除密钥的显式 API？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T06:33:28.247

这取决于您的使用模式。如果您要添加和删除大量项目，那么这些空集合将耗尽内存。我的猜测是你不会通过保留收藏来节省那么多时间。与往常一样，如果它对您的表现如此重要，您应该衡量而不是猜测哪种方式更好。

如果您真的认为创建这些集合很昂贵，那么不要一直创建新集合，而是将未使用的集合放入一个列表中，并在将新键添加到您的 hashmap 时重用它们。我认为这可能是蝇量级模式。您可能应该将未使用的集合列表保持在小于主 hashmap 大小的一半（再次测量该比率如何影响性能）。

# wpf - 将一个控件的值传递给 Converter 以设置另一个控件的宽度

> ID：312044
> 
> 赞同：14
> 
> 时间：2008-11-23T02:40:08.797
> 
> 标签：wpf, data-binding, binding, converters

我想根据容器的宽度设置 TextBlock 的宽度，减去 TextBlock 上设置的边距。

这是我的代码：

```
<TextBlock x:Name="txtStatusMessages" 
           Width="{Binding ElementName=LayoutRoot,Path=ActualWidth }"
                   TextWrapping="WrapWithOverflow" 
           Foreground="White" 
           Margin="5,5,5,5">This is a message
</TextBlock> 
```

除了由于左右边距设置为 5 导致 TextBlock 太大了 10 个单位之外，这非常有效。

好的，所以我想......让我们使用转换器。但我不知道如何传递我的容器控件的 ActualWidth（见上图：LayoutRoot）。

我知道如何使用转换器，甚至是带参数的转换器，而不是像... Binding ElementName=LayoutRoot,Path=ActualWidth 这样的参数

例如，我无法完成这项工作：

```
Width="{Binding Converter={StaticResource PositionConverter},  
       ConverterParameter={Binding ElementName=LayoutRoot,Path=ActualWidth }}" 
```

我希望我说得足够清楚，并希望您能提供帮助，因为今晚谷歌对我没有帮助。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-23T05:46:45.050

你应该使用另一个控件作为源，而不是参数。该参数必须是常数，在您的情况下可以是-5。

我现在不在 VS 附近，所以语法可能不准确，但是，它类似于：

```
Width="{Binding ElementName=LayoutRoot, Path=ActualWidth,
Converter={StaticResource PositionConverter}, ConverterParameter=-5}" 
```

（转换器将接收 -5 作为字符串，并且在使用之前必须将其转换为数字。）

根据我的经验，最好使用 DependecyProperty XXX 的 OnXXXChanged 回调，而不是将同一窗口/根控件中的控件相互绑定。原因之一是您可能希望稍后将它们绑定到外部元素。

或者，使用多重绑定：

```
<TextBlock>
    <TextBlock.Width>
        <MultiBinding Converter="{StaticResource yourConverter}">
            <MultiBinding.Bindings>
                <Binding /> <!-- Bind to parameter 1 here -->
                <Binding /> <!-- Bind to parameter 2 here -->
          </MultiBinding.Bindings>
        </MultiBinding>
    </TextBlock.Width>
</TextBlock> 
```

和一个转换器，它将两个参数转换为您想要的值。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-07-30T10:41:05.060

是的..多重绑定对我有用..实际上我试图将一个元素作为转换参数发送，但它不接受。这就是我将元素作为值传递给转换器类的原因。

下面是我的例子..

```
<ListView ... >
<ListView.View>
<GridView>
    <GridViewColumn Header="xyz" >

        <GridViewColumn.Width>
            <MultiBinding Converter="{StaticResource GetWidthfromParentControl}">
                <MultiBinding.Bindings>
                    <Binding ElementName="lstNetwork" Path="ActualWidth"/>
                    <Binding ElementName="MyGridView"/>
                </MultiBinding.Bindings>
            </MultiBinding>
        </GridViewColumn.Width>
    ....
    </GridViewColumn>
    <GridViewColumn ...>
    ....
    </GridViewColumn>
</GridView>
</ListView.View>
</ListView> 
```

在窗口调整大小时，我的第一个 gridviewcolumn 必须调整大小，而不是其他两个 gridviewcolumn ..我传递了 listview 的 Actualwidth 和总 gridview 对象作为元素..如果你去转换器代码...

```
class GetWidthfromParentControl : IMultiValueConverter
{
    #region IMultiValueConverter Members

    public object Convert(object[] values, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        GridView view = values[1] as GridView;
        GridViewColumnCollection collc = view.Columns;
        double actualWidths = collc[1].ActualWidth + collc[2].ActualWidth;
        return ((double)values[0] - actualWidths );
    }

    public object[] ConvertBack(object value, Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture)
    {
        return null;
    }

    #endregion
} 
```

这对我有用...... :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T06:19:07.263

尽管我怀疑可能有更好的方法来解决您的问题，但我想我对您想要做的事情有一个答案。（您没有提到您的容器是什么类型。例如 StackPanel 会为您处理宽度计算。请参阅下面的 TextBox#2）

首先是 XAML

```
<Window x:Class="WpfApplication1.Window2" ...
    xmlns:local="clr-namespace:WpfApplication1"
    Title="Window2" Height="300" Width="300">
    <Window.Resources>
        <local:WidthSansMarginConverter x:Key="widthConverter" />
    </Window.Resources>
    <Grid>
        <StackPanel x:Name="stack">
            <TextBlock x:Name="txtStatusMessages" 
                    Width="{Binding ElementName=stack,Path=ActualWidth, 
                        Converter={StaticResource widthConverter}}"
                    TextWrapping="WrapWithOverflow" 
                    Background="Aquamarine" 
                    Margin="5,5,5,5">
                This is a message
            </TextBlock>
            <TextBlock x:Name="txtWhatsWrongWithThis" 
                    TextWrapping="WrapWithOverflow" 
                    Background="Aquamarine" 
                    Margin="5,5,5,5">
                This is another message
            </TextBlock>
        </StackPanel>
    </Grid>
</Window> 
```

接下来是转换器。我们这里有一个问题.. 因为Convert 方法的 ConverterParameter由于某种原因[不能是动态值。](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7298ceb5-bf56-47aa-a161-5dd99189408b/)因此，我们通过在 Window 的 ctor 中设置的 Converter 的公共属性潜入 Textbox Margin。 **WidthSansMarginConverter.cs**

```
public class WidthSansMarginConverter : IValueConverter
    {
        private Thickness m_Margin = new Thickness(0.0);

        public Thickness Margin
        {
            get { return m_Margin; }
            set { m_Margin = value; }
        }
        #region IValueConverter Members

        public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            if (targetType != typeof(double)) { return null; }

            double dParentWidth = Double.Parse(value.ToString());
            double dAdjustedWidth = dParentWidth-m_Margin.Left-m_Margin.Right;
            return (dAdjustedWidth < 0 ? 0 : dAdjustedWidth);
        }

        public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            throw new NotImplementedException();
        }

        #endregion
    } 
```

Window2.xaml.cs

```
 public Window2()
        {
            InitializeComponent();

            WidthSansMarginConverter obConverter = this.FindResource("widthConverter") as WidthSansMarginConverter;
            obConverter.Margin = txtStatusMessages.Margin;
        } 
```

HTH。谢谢你的练习:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T19:01:41.040

如果您的文本框是 LayoutRoot 的直接子级，只需在文本框中设置以下属性

```
HorizontalAlignment="Stretch" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-03T16:05:03.820

根据[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7298ceb5-bf56-47aa-a161-5dd99189408b](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7298ceb5-bf56-47aa-a161-5dd99189408b)，如果您的转换器源自依赖对象。

在这种情况下，您甚至可以使用数据绑定将值传递给您在 XAML 中定义转换器（在资源字典中）的那些属性。

# sql-server - SQL Server 上的高效 ISNUMERIC() 替换？

> ID：312054
> 
> 赞同：19
> 
> 时间：2008-11-23T02:54:08.207
> 
> 标签：sql-server, user-defined-functions, isnumeric

所以我只花了 5 个小时来解决一个问题，结果不仅是由于[旧的不可靠](https://web.archive.org/web/20141209040727/http://classicasp.aspfaq.com/general/what-is-wrong-with-isnumeric.html) `ISNUMERIC`，而且看起来我的问题只出现在`ISNUMERIC`声明`WITH SCHEMABINDING`并在存储过程中调用的 UDF 时（我有很多将它提炼成一个测试用例需要做的工作，但我首先需要的是用可靠的东西替换它）。

任何关于`ISNUMERIC()`. 显然，确实需要对 , 等进行变体`int`，`money`但是人们使用的是什么（最好在 T-SQL 中，因为在这个项目中，我仅限于 SQL Server，因为这是 SQL Server 到 SQL Server 数据的大容量 SQL Server处理任务）？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-23T16:56:38.677

如果您正在运行 SQL Server 2012，您可以使用 T-SQL 函数 TRY_CAST() 或 TRY_CONVERT()，正如 Bacon Bits 在评论中提到的那样：

```
SELECT CASE WHEN TRY_CAST('foo' AS INT) IS NULL THEN 0 ELSE 1 END

SELECT CASE WHEN TRY_CAST(1 AS INT) IS NULL THEN 0 ELSE 1 END 
```

如果您使用的是 SQL 2008 R2 或更早版本，则必须使用 .NET CLR 函数并包装 System.Decimal.TryParse()。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-23T15:58:58.557

根据验证的环境和性能特征，我有时会使用 LIKE 表达式的变体。例如：

```
NOT LIKE '%[^0-9]%' 
```

请注意，这个具体的例子是相当幼稚的。它不保证该值对于转换为特定数据类型有效。如果您需要，它也不允许使用 +/- 符号或小数点。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-27T20:49:39.800

另一种选择可能是用 C 等语言编写扩展存储过程，将其制成 DLL 并使其可用于 SQL Server。

我不认为这需要太多的代码行，而且它可能会比在 .NET 中编写托管存储过程更快，因为您不会因加载 CLR 而产生额外的意外。

这里有一些信息：http: [//msdn.microsoft.com/en-us/library/ms175200.aspx](http://msdn.microsoft.com/en-us/library/ms175200.aspx)

以下是一些可能对您有用的 C++ 代码：

```
using namespace std;

int checkNumber() {
  int number = 0;
  cin >> number;
  cin.ignore(numeric_limits<int>::max(), '\n');

  if (!cin || cin.gcount() != 1)
    cout << "Not a number.";
  else
    cout << "Your entered: " << number;
  return 0;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T20:41:07.230

遵循 .NET CLR 路线，您可以使用正则表达式，尤其是在您期望一定范围的数字时。

[SQL 2005 和正则表达式](http://msdn.microsoft.com/en-us/magazine/cc163473.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-23T13:15:02.837

通常作为一种实践，我尽量不要让无类型的数据进入数据库，因为它更适合在应用程序层处理它，或者在 SQL 集成服务中处理它，以便数据正确输入开始。

过去我不得不这样做很多次，通常最快的方法是编写自己的用户定义函数来验证数据是否符合您期望的格式，因为大多数时候调用扩展存储过程的开销或用于简单验证的托管代码比仅在 T-SQL 中执行要慢。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-23T15:24:49.190

根据 Microsoft 的支持，唯一*有效*的替换 UDF 函数的方法是编写自己的 .NET 函数版本。

当然，如果您的数据库管理员允许 :)。

我的没有:(。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T09:44:15.487

如何实现这两个功能：

```
CREATE FUNCTION dbo.isReallyNumeric  
(  
    @num VARCHAR(64)  
)  
RETURNS BIT  
BEGIN  
    IF LEFT(@num, 1) = '-'  
        SET @num = SUBSTRING(@num, 2, LEN(@num))  

    DECLARE @pos TINYINT  

    SET @pos = 1 + LEN(@num) - CHARINDEX('.', REVERSE(@num))  

    RETURN CASE  
    WHEN PATINDEX('%[^0-9.-]%', @num) = 0  
        AND @num NOT IN ('.', '-', '+', '^') 
        AND LEN(@num)>0  
        AND @num NOT LIKE '%-%' 
        AND  
        (  
            ((@pos = LEN(@num)+1)  
            OR @pos = CHARINDEX('.', @num))  
        )  
    THEN  
        1  
    ELSE  
    0  
    END  
END  
GO  

CREATE FUNCTION dbo.isReallyInteger  
(  
    @num VARCHAR(64)  
)  
RETURNS BIT  
BEGIN  
    IF LEFT(@num, 1) = '-'  
        SET @num = SUBSTRING(@num, 2, LEN(@num))  

    RETURN CASE  
    WHEN PATINDEX('%[^0-9-]%', @num) = 0  
        AND CHARINDEX('-', @num) <= 1  
        AND @num NOT IN ('.', '-', '+', '^') 
        AND LEN(@num)>0  
        AND @num NOT LIKE '%-%' 
    THEN  
        1  
    ELSE  
        0  
    END  
END  
GO 
```

[原始来源](http://classicasp.aspfaq.com/general/what-is-wrong-with-isnumeric.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-24T18:23:43.553

对于 SQL Server 2005 及更高版本....利用 try/catch...

```
declare @test varchar(10), @num decimal
select @test = '0123A'

begin try
    select @num = cast(@test as decimal)
    print '1'
end try 
begin catch
    print '0'
end catch 
```

打印 0。

更改 @test = '01234' 或 @test = '01234.5' 并打印 1。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-23T08:22:46.310

您是否会处理您自己的（人类）语言之外的数字系统，例如中文等？如果是这样，我建议使用[libuninum library](http://billposer.org/Software/libuninum.html)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-10-17T02:02:28.913

IsNumeric() 似乎对空格、'D'、'E'、美元符号和各种其他字符有问题。我们通常想要的是告诉我们 CAST 或 CONVERT 是否会成功的东西。这个 UDF 虽然不是最快的解决方案，但对我来说效果很好。

```
create function dbo.udf_IsNumeric(@str varchar(50))
  returns int
as
begin
  declare @rtn int
  select @rtn =
    case
      when ltrim(rtrim(@str)) in('.', '-', '-.', '+', '+.') then 0
      when ltrim(rtrim(@str)) like '%[^-+.0-9]%' then 0
      else isnumeric(@str)
    end
  return @rtn
end 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-10-07T11:02:25.397

从 SQL 2012 开始，您可以使用 TRY_PARSE() 函数代替 ISNUMERIC()。

```
SELECT
 TRY_PARSE('123' as int) as '123'
,TRY_PARSE('abc' as int) as 'abc' 
```

# git - 如何修复丢失的 git 远程详细信息？

> ID：312055
> 
> 赞同：12
> 
> 时间：2008-11-23T02:54:34.070
> 
> 标签：git, repository

我拥有的一些存储库克隆允许我这样做：

```
% git pull
% git push 
```

但其他存储库需要我输入：

```
% git pull origin master
% git push origin master 
```

我想我在后一种情况下遗漏了一些东西 - 有谁知道这里发生了什么（不）？我正在使用最新的 git 版本，只是显然没有很好地使用它。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-23T02:59:13.937

如果您 cd 进入您的存储库目录，然后在编辑器中打开您的**.git/config文件。**

将此附加到文件的末尾：

```
[branch "master"]
     remote = origin
     merge = refs/heads/master 
```

这几乎只是一个别名，所以 git 默认知道从原始主机中提取。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-23T07:29:56.137

或者，如果您愿意，您可以执行 Brian Gianforcaro 从命令行提出的相同操作：

```
git config branch.master.remote origin
git config branch.master.merge  refs/heads/master 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-28T02:44:03.277

此外，为避免必须这样做`git push master`，您可以指定要在 Git 配置文件中推送的分支，如下所示：

```
[remote "origin"]
        ...
        push = master 
```

# memory-leaks - 最佳内存泄漏定义

> ID：312069
> 
> 赞同：55
> 
> 时间：2008-11-23T03:10:37.987
> 
> 标签：memory-leaks, definition

我觉得开发人员在谈论内存泄漏，但是当你问他们这意味着什么时，很多人都不知道。为了防止这些情况，让我们决定一个。

请不要维基百科定义...

> 您对 **内存泄漏**的最佳定义是什么 ？防止它们的*最佳方法是什么？*

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-11-23T04:19:21.903

有两个定义（至少对我来说）：

**朴素定义：**无法释放*无法访问*的内存，在分配过程执行过程中，任何进程都不能再重新分配。这主要可以通过使用 GC（垃圾收集）技术或通过自动化工具检测到来解决。

**微妙的定义：**未能释放程序正常运行不再需要的*可达内存。*使用自动化工具或不熟悉代码的程序员几乎不可能检测到这一点。虽然从技术上讲它不是泄漏，但它与天真的泄漏具有相同的含义。这不仅仅是我自己的想法。您可能会遇到用垃圾收集语言编写的项目，但仍会在其变更日志中提到修复内存泄漏。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-11-23T03:30:45.683

由于对它的引用已丢失而无法使用的分配内存。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-23T03:15:51.970

**定义**：分配后未能释放内存。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-23T03:22:10.630

分配内存资源并且一旦不再需要就没有正确释放的过程，通常是通过糟糕的编码实践引入的。

一些语言有内置的方法来帮助防止它们，尽管避免它们的最好方法是通过仔细观察代码执行路径和代码审查。保持方法简短且目的明确有助于保持资源使用范围狭窄，并且不太容易在洗牌中迷失方向。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-23T03:22:33.640

有两种方法可以定义内存泄漏。

首先，如果数据在不再有任何引用时没有被释放，则该数据是不可访问的（除非您有一些损坏的指针或读取缓冲区中的数据或其他东西）。基本上，如果您不释放/删除在堆上分配的数据，它就会变得不可用并且只会浪费内存。

可能存在指针丢失但数据仍可访问的情况。例如，如果您将指针存储在 int 中，或者存储指针的偏移量（使用指针算法），您仍然可以取回原始指针。

在第一个定义中，数据由垃圾收集器处理，垃圾收集器跟踪对数据的引用次数。

其次，如果在最后一次使用时没有释放/删除内存，则内存基本上是泄漏的。它可能会被引用，并且可以立即释放，但错误的是不这样做。可能有一个正当的理由（例如，在析构函数有一些奇怪的副作用的情况下），但这表明程序设计不好（在我看来）。

第二种类型的内存泄漏经常发生在编写使用文件 IO 的小程序时。您打开文件，写入数据，但完成后不要关闭它。FILE* 可能仍在范围内，并且可以轻松关闭。同样，这样做可能有一些原因（例如锁定其他程序的写访问权限），但对我来说，这是一个糟糕设计的标志。

在第二个定义中，垃圾收集器不处理数据，除非编译器/解释器足够聪明（或愚蠢），知道它不会再被使用，并且释放数据不会造成任何副作用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-23T05:37:40.467

[w:](http://en.wikipedia.org/wiki/Memory_leak)

> 在计算机科学中，内存泄漏是一种特殊类型的计算机程序无意的内存消耗，其中程序在不再需要时无法释放内存。这种情况通常是由于程序中的错误导致无法释放不再需要的内存。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-23T03:22:27.323

不再需要时未释放且不再“可访问”的内存。例如，在非托管代码中，如果我使用“new”来实例化一个对象，但是当我完成它时我不使用“delete”（并且我的指针已经超出范围或其他东西）。

防止它们的最佳方法可能取决于您询问的对象以及您使用的语言。当然，垃圾回收是一个很好的解决方案，但可能会有一些相关的开销，这没什么大不了的，除非你的主要关注点是性能。同样，垃圾收集可能并不总是可用，这取决于您使用的语言。

或者，您可以确保有适当的删除和/或析构函数。还有很多方法和工具可以检测内存泄漏，但这取决于您使用的语言和/或 IDE。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-23T03:34:12.103

*内存泄漏*：未能释放您之前不再需要的内存：

*   程序终止
*   分配了额外的内存

*防止内存泄漏的最佳方法*：在不再需要内存时立即释放内存。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-23T05:30:37.390

这里给出的所有定义（在我写这篇文章的时候，我们已经得到了更好的答案）未能解决一个临界案例：

您有一个单例，它在创建时分配内存，并且只要程序正在运行，即使当前使用已经完成，并且不知道将来是否会进行任何使用，该内存通常也会保留。这通常是因为重新创建它的开销。

根据“完成后无法释放”标准，这将被视为泄漏，我已经看到泄漏报告工具称此类事情为泄漏，因为内存仍在使用中。（事实上​​，代码可能不包含能够清理对象的代码。）

但是，即使重新创建对象的成本并不是那么高，我也曾在编译器库中遇到过这种性质的代码。

泄漏与否？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-23T07:02:40.387

以下是一些防止/检测内存泄漏的技术：

1.  **在内存消耗方面考虑您的算法。**其他受访者提到了这样一个事实，即您不必丢失指向已分配项目的指针以泄漏内存。即使您的实现包含零指针错误，如果您在实际需要分配的项目后很长时间仍持有分配的项目，您仍然可以有效地泄漏内存。

2.  **分析您的应用程序。**您可以使用 Valgrind 或 Purify 等内存调试器工具来查找泄漏。

3.  **黑盒测试。**观察你的编译代码在你输入大数据集后会发生什么，或者让它运行很长时间。看看它的内存占用是否有无限增长的趋势。

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2008-11-23T03:31:56.990

**编辑：这个答案是错误的。我把它作为一个例子来说明你认为自己非常了解的事情是多么容易被误解。**感谢所有指出我错误的人。

内存泄漏是： 编程错误。您的软件从系统中借用一些内存，使用它，然后在完成后无法将其返回给系统。这意味着在系统重新启动之前，任何其他程序都不能使用该特定内存块。许多此类泄漏可能会耗尽所有可用内存，从而导致系统完全无用。

为防止内存泄漏，请练习 RIIA，并始终测试您的软件。有很多工具可用于此任务。

# c++ - 使用通用算法的 C++ 中的点积

> ID：312077
> 
> 赞同：1
> 
> 时间：2008-11-23T03:24:21.110
> 
> 标签：c++, generics, dot-product

我敢肯定有一个聪明的单线使用 C++ stl 通用算法来实现任何有序容器中元素的点积，例如向量或列表。只是好像不记得了！

花哨的实现将是：

```
template <class containerT>
typename containerT::value_type dot_product (const containerT& left, const containerT& right)
{
   assert(left.size()==right.size());
   containerT::value_type result = 0;
   for (containerT::const_iterator l_it = left.begin(), r_it = right.begin();
        l_it != left.end(); ++r_it,++l_it)
   {
      result += (*l_it) * (*r_it);
   }
   return result; 
} 
```

我认为我正在重新发明轮子，并且有更聪明的方法来做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T03:27:07.467

见[`std::inner_product`](http://en.cppreference.com/w/cpp/algorithm/inner_product)从`<numeric>`。

# php - 如何处理xapian php异常

> ID：312082
> 
> 赞同：1
> 
> 时间：2008-11-23T03:33:34.023
> 
> 标签：php, exception, xapian

帮助使用 xapian php 包装器。

我有几个针对不同类别错误的自定义异常处理程序（我正在考虑将它们分开更多）。
Xapian 通过抛出标准异常对象来处理错误。我想为这些使用自定义异常处理程序。如何为已经抛出的标准异常使用自定义异常？或任何其他想法，也许如何让 Xapian 抛出其他异常类型？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T16:25:37.397

笨拙的方式：将每个 xapian API 调用包装在 try..catch 块中，并在 catch 子句中抛出更具体的自定义异常。

或骇人听闻的方式：修改 xapian php 扩展的源代码（我假设它是用 C 编写的？）以抛出自定义异常（您还必须在扩展源中定义）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T14:23:40.217

从 Xapian 中捕获通用异常，找出它们是什么，然后抛出更具体的期望。

或者...如果您希望 Xapian 的行为与现在不同，那么它*是*一个开源项目。你知道该做什么。:)

# iphone - aurioTouch 示例应用程序的音频播放/直通不起作用？

> ID：312089
> 
> 赞同：2
> 
> 时间：2008-11-23T03:47:43.917
> 
> 标签：iphone, core-audio

根据 Apple 的描述，aurioTouch 示例应用程序假设“获取音频输入并将其复制到输出”，我认为这意味着该应用程序将播放/通过 iPhone 的麦克风通过 iPhone 的扬声器拾取的任何声音。

但是，当我将应用程序加载到我的 iPhone（更新到 2.2）时，playthru 功能似乎根本不起作用。屏幕上的示波器按预期响应声音和声音，因此应用程序的音频输入部分显然可以正常工作。

是的，我尝试过切换应用程序的“静音”按钮，是的，我确保 iPhone 的“铃声/静音”开关未设置为静音，并且音量未设置为零。我错过了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-08T19:26:47.590

问题是帮助程序代码中的 DC 过滤器编写不正确。

注释掉调用 DC 过滤器的 AppDelegate 代码的第 210 和 211 行，您将立即启动并运行。

# file - 文件处理程序的限制超过 256

> ID：312091
> 
> 赞同：2
> 
> 时间：2008-11-23T03:49:58.920
> 
> 标签：file, limit, handle

我的代码打开了超过 256 个文件句柄，所以当我在 Solaris 机器上运行它时，我最终会出现“超出文件处理程序限制”错误。

我对此有两个问题

1) 这个限制是只针对 32 位软件还是 64 位软件也受此限制。我用谷歌搜索了一下，发现 64 位软件没有这个限制。（[http://developers.sun.com/solaris/articles/stdio_256.html](http://developers.sun.com/solaris/articles/stdio_256.html)）但是我构建了 64 位静态对象，当我使用它时给出错误。实际上 64 位软件意味着什么？

2）如上面的链接中给出的，我使用 ulimit 来增加文件处理程序限制（在运行时，我的意思是在运行命令之前），导出扩展文件库并且我没有收到任何错误。我们必须做的 Linux ?

谢谢 DL 库马尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T04:14:07.920

我以前遇到过这种情况。据我所知，这实际上是 solaris libc 中的一个错误，他们使用 8 位无符号整数类型将 fd 存储在 FILE 结构中。显然他们并没有以向后兼容的名义很快地改变它（如果一个程序由于某种原因依赖于 FILE 结构的实现细节）。这*不*应该是 Linux 或任何其他非 solaris *nix 上的问题。您引用的文章建议了合理的解决方法，因此您应该使用这些方法。

至于“什么是 64 位可执行文件”，它只是针对 64 位指令集编译的二进制文件。有些架构支持两者，有些则不支持。（例如 x86-64 操作系统通常允许 32 位进程以实现向后兼容性）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T04:09:29.257

要检查目标文件（可执行文件）是否为 64 位，请使用 file 命令（至少在 Linux 上）。

例如：

```
$ file `which ls`
/bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), for GNU/Linux 2.6.9, dynamically linked (uses shared libs), stripped

$ file my-32bit-exe
my-32bit-exe: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), corrupted section header size 
```

（不要介意“损坏的节标题大小”——exe 被手动修改以减小文件大小）。

ulimit 可以在 Linux 上使用（参见[ulimit(1)](http://linux.die.net/man/1/ulimit)和[ulimit(3)](http://linux.die.net/man/3/ulimit)）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T05:52:09.767

在 Solaris 上，您可以使用以下任一方式构建 64 位程序：

```
cc -xarch=v9 ... 
```

或者：

```
gcc -m64 ... 
```

正如 Evan 所说，32 位 Solaris 的基本问题是向后二进制兼容性和用于保存 fd 的 8 位整数。

我刚刚在 Solaris 10 for SPARC 上尝试了以下代码：

```
#include <stdio.h>

int main(void)
{
    size_t i;
    for (i = 0; i < 300; i++)
    {
        FILE *fp = fopen("/dev/null", "a");
        if (fp == 0)
        {
            printf("Failed on %zu\n", i);
            return(1);
        }
    }
    printf("Succeeded to %zu\n", i);
    return(0);
} 
```

编译为：

```
cc -xarch=v9 -o xxx xxx.c 
```

它给了我“在 253 上失败”。（这是测试代码：我知道它会丢弃 252 个指针。）这支持您的论点，即简单的 64 位构建。然而，还有另一个因素在起作用——资源限制。

```
$ ulimit -n
256
$ 
```

因此，通过以下方式增加默认限制：

```
$ ulimit -n 400
$ ulimit -n
400
$ ./xxx
Succeeded to 300
$ 
```

试试那个...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T14:50:23.283

就像 Evan Teran 提到的，solaris libc 对 FILE 有这个“奇怪”的限制，它只能处理 256 以下的文件句柄。

这与您可以使用 ulimit 设置的限制无关。您可以通过以下方式设置此限制：

```
#include <sys/resource.h>

struct rlimit rl;
getrlimit(RLIMIT_NOFILE,&rl);
rl.rlim_cur = 1024; /* change it to 1024 - note has to be < than rl.rlim_max */
setrlimit(RLIMIT_NOFILE,&rl); 
```

现在，我也将停止使用 FILE* 并使用 open 而不是 fopen 等。对于您真正需要使用 FILE* 的情况，在我工作的几个项目中，在程序开始时，几个文件描述符被“保留” " 通过进行套接字调用，我们有一个小型库来使用这些获取 FILE*，方法是关闭其中一个套接字，然后立即执行 fopen，它将使用刚刚关闭的 fd。当然，还需要使用 fclose 的特殊功能关闭 FILE*，然后使用套接字立即获取 fd ;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-24T10:00:41.603

最后我得到了解决方案。我对代码进行了两项更改以使其正常工作

1) 如上面 njsf 所建议的那样

2) 打开带有“F”标志的文件，如下 FILE *fp = fopen("/dev/null", "wF");

非常感谢。DL库马尔

# python - 用于设计 mmo 的好的 python 库？基于演员的设计

> ID：312096
> 
> 赞同：8
> 
> 时间：2008-11-23T03:56:09.953
> 
> 标签：python, stackless, python-stackless, mmo

我正在尝试使用python设计一个mmo游戏......

我已经评估了stackless，因为它不是一般的python而且它是一个fork，我不想使用它

我正在尝试在 pysage candygram Dramatis 和 parley 之间进行选择

有人尝试过这些库中的任何一个吗？

非常感谢您的回复

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-23T05:05:45.927

我会去[pysage](http://code.google.com/p/pysage/)。

它具有最高级别的抽象和轻量级消息传递 API，这将为您提供很大的灵活性。我想在设计 MMO 时，你会想要尽可能多的灵活性。

它还从 Erlang 的 Actor 模型中获取了一页，该模型非常可靠。

太好了，您正在尝试通过 python 构建 MMO！当您想添加很棒的图形时，它具有出色的 OpenGL 绑定！

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T15:12:16.780

最初， [Twisted Python](http://twistedmatrix.com/trac/)旨在编写 MMO，但它并不易于使用。我不知道它是否有一个 Actor 实现，也许[在 Launchpad 的 tx 项目中](https://launchpad.net/tx)？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-29T21:05:39.100

我试图用 Python 写一个 MMO，这太可怕了。现在，我在开发服务器软件方面领先于其他语言，转而使用 Erlang 及其光年。您可以在以下位置查看我的项目： http: [//www.next-gen.cc](http://www.next-gen.cc)。

顺便说一句，在 OpenGL 中编写客户端图形是一项艰巨的任务，您可能想要 Ogre3d 之类的东西（有 python 绑定）。

# c# - 您可以使用 LINQ 或 lambdas 来执行矩阵运算吗？

> ID：312103
> 
> 赞同：3
> 
> 时间：2008-11-23T04:07:57.510
> 
> 标签：c#, linq, lambda

我知道如何使用 for 循环来做到这一点。是否可以使用 LINQ 或 lambdas 做这样的事情？

```
int[] a = { 10, 20, 30 };
int[] b = { 2, 4, 10 };
int[] c = a * b; //resulting array should be { 20, 80, 300 } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T07:45:16.060

编辑：下面的代码可以工作，但它不像使用显式方法那样可读。LINQ 非常棒，它确实*增加*了可读性……但这不是其中一种情况。

这是 CMS 答案的简短版本 -`let`不需要额外的内容，当您只是进行投影时，使用点表示法更简单：

```
int[] result = Enumerable.Range(0, a.Length)
                         .Select(i => a[i] * b[i])
                         .ToArray(); 
```

另一种方法是使用带有索引的 Select 形式：

```
int[] result = a.Select((value, index) => value * b[index])
                .ToArray(); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T07:53:40.770

[在此处](http://bartdesmet.net/blogs/bart/archive/2008/11/03/c-4-0-feature-focus-part-3-intermezzo-linq-s-new-zip-operator.aspx)使用 Zip 功能（.NET 4.0 的新功能）详细信息：

```
int[] a = { 10, 20, 30 };
int[] b = { 2, 4, 10 };

int[] c = a.Zip(b, (a1, b1) => a1 * b1).ToArray(); 
```

在 .NET 4 出现之前，您可以使用上面链接中的 zip 实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T04:44:03.193

你可以这样做：

```
int[] a = {10, 20, 30};
int[] b = {2, 4, 10};

if (a.Length == b.Length)
{
  int[] result = (from i in Enumerable.Range(0, a.Length)
          let operation = a[i]*b[i]
        select operation).ToArray();
} 
```

但是我建议你如果你将使用矩阵和更高级的数学主题来获得一个好的数学库，比如[NMath](http://www.centerspace.net/)或搜索一个[Matrix 类](http://www.google.com/search?q=Matrix+C%23+.NET)实现，那里有很多......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T04:53:19.493

没有内置任何内容，但您始终可以编写自己的函数。下面的第一个是一个简单的扩展方法，可以做你想做的事。第二个允许您指定要应用的函数：

```
class Program
{
    public static void Main(string[] args)
    {
        int[] a = { 10, 20, 30 };
        int[] b = { 2, 4, 10 };
        int[] c = a.MatrixMultiply(b);
        int[] c2 = a.Zip(b, (p1, p2) => p1 * p2);
    }
}

public static class Extension
{
    public static int[] MatrixMultiply(this int[] a, int[] b)
    {
        // TODO: Add guard conditions
        int[] c = new int[a.Length];
        for (int x = 0; x < a.Length; x++)
        {
            c[x] = a[x] * b[x];
        }
        return c;
    }

    public static R[] Zip<A, B, R>(this A[] a, B[] b, Func<A, B, R> func)
    {
        // TODO: Add guard conditions
        R[] result = new R[a.Length];
        for (int x = 0; x < a.Length; x++)
        {
            result[x] = func(a[x], b[x]);
        }
        return result;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T06:31:31.620

查看[有关即将发布的 PLINQ](http://msdn.microsoft.com/en-us/magazine/cc163340.aspx)（并行 LINQ）的 MSDN 文章。从文章中，这是一个使用 PLINQ 并行化矩阵乘法的示例：

```
void ParMatrixMult(int size, double[,] m1, double[,] m2, double[,] result)
{
  Parallel.For( 0, size, delegate(int i) {
    for (int j = 0; j < size; j++) {
      result[i, j] = 0;
      for (int k = 0; k < size; k++) {
        result[i, j] += m1[i, k] * m2[k, j];
      }
    }
  });
} 
```

它使用 LINQ 和 Lambda！作为奖励，它分布在处理器上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-03T15:02:23.157

你可以编写一个简单的扩展来处理任何等级的矩阵。

```
public static class TwodimensionalArrayExtensions
{
    public static int[][] MultiplyBy(this int[][] leftMatrix, int[][] rightMatrix)
    {
        if (leftMatrix[0].Length != rightMatrix.Length)
        {
            return null; // Matrices are of incompatible dimensions
        }

        return leftMatrix.Select( // goes through <leftMatrix matrix> row by row

                (leftMatrixRow, leftMatrixRowIndexThatIsNotUsed) =>

                    rightMatrix[0].Select( // goes through first row of <rightMatrix> cell by cell

                            (rightFirstRow, rightMatrixColumnIndex) =>

                                rightMatrix
                                    .Select(rightRow => rightRow[rightMatrixColumnIndex]) // selects column from <rightMatrix> for <rightMatrixColumnIndex>
                                    .Zip(leftMatrixRow, (rowCell, columnCell) => rowCell * columnCell) // does scalar product
                                    .Sum() // computes the sum of the products (rowCell * columnCell) sequence.
                        )
                        .ToArray() // the new cell within computed matrix
            )
            .ToArray(); // the computed matrix itself
    }
} 
```

以下是一些测试值：

```
// Test1
int[][] A = { new[] { 1, 2, 3 } };
int[][] B = { new[] { 1 }, new[] { 2 }, new[] { 3 } };
int[][] result = A.MultiplyBy(B); 
```

* * *

```
// Test2
int[][] A = { new[] { 1 }, new[] { 2 }, new[] { 3 } };
int[][] B = { new[] { 1, 2, 3 } };
int[][] result = A.MultiplyBy(B); 
```

* * *

```
// Test3
int[][] A = new int[][] { new[] { 1, 2 }, new[] { 2, 2 }, new[] { 3, 1 } };
int[][] B = new int[][] { new[] { 1, 1, 1 }, new[] { 2, 3, 2 } };
int[][] result = A.MultiplyBy(B); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-16T09:41:56.883

如果事先将右矩阵转置，则乘法可以更优雅地表示如下。

```
int[][] Multiply(int[][] left, int[][] right) =>
    left.Select(lr => 
            right
                .Select(rr => 
                    lr.Zipped(rr, (l, r) => l * r).Sum())
                .ToArray())
        .ToArray(); 
```

# .net - 如何在 Windows 窗体设置文件中存储枚举值？

> ID：312107
> 
> 赞同：2
> 
> 时间：2008-11-23T04:10:17.553
> 
> 标签：.net, winforms, enums, settings, typeconverter

我正在使用 Windows 窗体和 VS2008。我想在我的应用程序的设置文件中存储一个枚举值。

VS2008 中的设置编辑器只给了我一组有限的类型。令人惊讶的是，枚举似乎不是自动支持的这些类型之一 - 我是否正确理解这一点？

通过阅读该主题，似乎我可能需要编写一个 TypeConverter 类，以使我的枚举能够转换为字符串，反之亦然。我已经为我的枚举实现了这个，并将 TypeConverter 属性添加到我的枚举中，以指示要用于该枚举的转换器类。

但是，当我尝试在我的设置文件（在“选择类型”）对话框中指定它时，它只是说我的类型没有定义，所以我有点卡住了。

谁能向我解释如何将枚举存储在 Windows 窗体应用程序的设置文件中？这似乎是一个非常简单（并且通常需要）的功能，我很惊讶它还没有得到支持，而且我似乎必须做很多工作才能让它工作（而且只有一个枚举！）。

因此，我想我一定错过了一些东西，而且实际上真的很容易......

假设我的枚举如下所示：

```
namespace MyApp
{
    enum MyEnum
    {
        Yes,
        No
    }
} 
```

...如何将此枚举中的值存储在我的设置文件中？（当然要检索它）。

（显然我可以只存储一个字符串或整数并自己解释，但这看起来很笨拙，我希望 Windows 窗体能够更干净地处理这类事情。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T04:42:19.110

枚举实际上与数字类型（默认 int）相差不远，并且可以互换使用。我认为来回转换和存储 int 并不笨重。事实上，只有字符串可以存储在设置文件中。这确实意味着，通过扩展，任何可序列化为字符串的东西。

另一种方法是存储枚举的文本值（因此它是人类可编辑的）并使用 Enum.Parse(type, string) 对其进行解析。

# c++ - C++ 链接错误：使用模板类的未定义符号

> ID：312115
> 
> 赞同：6
> 
> 时间：2008-11-23T04:32:49.630
> 
> 标签：c++, linker

我从我写的一个类中得到了一些非常奇怪的链接错误。我完全找不到任何可以描述正在发生的事情的东西。

视觉工作室 (Windows XP)

> player.obj：错误 LNK2019：未解析的外部符号“public: __thiscall TreeNode::TreeNode(void)”(??0?$TreeNode@VPlayer@@@@QAE@XZ) 在函数“public: __thiscall PlayerList::PlayerList”中引用(void)" (??0PlayerList@@QAE@XZ)

Xcode (OSX 10.5)

> 未定义符号：“TreeNode::~TreeNode()”，引用自：players.o 中的 PlayerList::~PlayerList()

头文件：generics.h

```
class TreeNode : public BaseNode{
public:
    const static int MAX_SIZE = -1; //-1 means any size allowed. 
    const static int MIN_SIZE = 0;
    //getters
    int size() const;
    vector<C*> getChildren() const;
    //setters
    void setChildren(vector<C*> &list);
    //Serialization
    virtual void display(ostream &out) const;
    virtual void read(istream &in);
    virtual void write(ostream &out) const;
    //Overrides so SC acts like an array of sorts. 
    virtual C* get(int id) const; 
    virtual int get(C *child) const;
    virtual bool has(C *child) const;
    virtual C* pop(int id);
    virtual void push(C *child);
    virtual TreeNode& operator<< (C *child); //append
    virtual void remove(int id); //Clears memory 
    virtual void remove(C *child); //Clears memory 
    //Initalizers
    TreeNode();
    TreeNode(istream &in);
    TreeNode(long id, istream &in);
    TreeNode(BaseNode* parent, istream &in);
    TreeNode(long id, BaseNode* parent);
    TreeNode(long id, BaseNode* parent, istream &in);
    ~TreeNode();
    string __name__() const{ return "TreeNode"; }
protected:
    void clearChildren();
    void initalizeChildren();
    vector<C*> _children;
}; 
```

来自 TreeNode 子类的代码

```
PlayerList::PlayerList() : TreeNode<Player>(){}
PlayerList::PlayerList(istream &in) : TreeNode<Player>(in){}
PlayerList::~PlayerList(){} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-23T11:18:01.043

当您在 .cpp 文件中定义模板时，您必须使用所有已知的类型/模板参数显式实例化它，该模板将像这样预先使用（将其放在 .cpp 文件中）：

```
template class TreeNode<Player>; 
```

如果您不知道模板将与哪些模板参数一起使用，则必须将所有定义放入标题中。像

```
template<typename T>
class TreeNode {
public:
   TreeNode() /* now, also put the code into here: */ { doSomething(); }
}; 
```

原因是当您要从某个地方使用模板时，编译器必须能够为模板的特定实例化生成代码。但是如果你把代码放到一个 .cpp 文件中并编译它，编译器就没有办法得到它的代码来生成实例化（除了使用臭名昭著的`export`关键字时，只有极少数编译器支持） .

这也是我的 C++ 陷阱答案中的一个条目：[我应该避免哪些 C++ 陷阱？](https://stackoverflow.com/questions/30373/what-c-pitfalls-should-i-avoid#293047)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T04:53:49.227

好吧，您正在声明 ~TreeNode()，但您是在定义它吗？

当您声明析构函数时，您会阻止编译器为您生成一个，但您必须在某处定义它，即使它是空的。

如果您的意图是有一个空的析构函数，您有两个选择：

- 完全删除 ~TreeNode() 的声明，并依赖自生成的析构函数 - 将其定义为空。Inling 在这里会非常好，IE。~TreeNode() {};

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T10:33:01.837

编译器抱怨找不到析构函数的实现。如前所述，如果你声明了析构函数，编译器不会自动为你生成一个。

对于[David Reis](https://stackoverflow.com/questions/312115/c-linking-errors-undefined-symbols-using-a-templated-class#312135)关于删除或提供空析构函数的建议，我显然会选择第二个。如果您的类是派生的（您有虚拟方法），那么您应该提供一个**虚拟**析构函数，即使它是空的（同样适用于 BaseNode）。

如果您依赖于编译器生成的版本，并且用户代码通过指向构造函数不是虚拟的基类的指针删除派生对象，则不会调用派生对象的析构函数，可能会泄漏资源。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T04:44:44.037

您是否忘记链接包含类函数的函数体的目标文件？

例如，你会在 .cpp 中有这样的内容：

```
TreeNode::TreeNode() :
    /* initializers here */
{
    // ...
}

TreeNode::~TreeNode()
{
    // ...
} 
```

# c++ - C++ 数组大小取决于函数参数会导致编译错误

> ID：312116
> 
> 赞同：18
> 
> 时间：2008-11-23T04:34:17.147
> 
> 标签：c++, arrays, parameters, declaration

我有一个简单的函数，其中根据 int 参数声明数组的大小。

```
 void f(int n){
        char a[n];
    };

    int main() {
        return 0;
    } 
```

这段代码在[GNU C++](http://en.wikipedia.org/wiki/G%2B%2B)上编译得很好，但在 MSVC 2005 上编译得不好。

我收到以下编译错误：

```
 .\main.cpp(4) : error C2057: expected constant expression
    .\main.cpp(4) : error C2466: cannot allocate an array of constant size 0
    .\main.cpp(4) : error C2133: 'a' : unknown size 
```

我能做些什么来纠正这个问题？

（我有兴趣使用 MSVC 进行这项工作，而不使用 new/delete）

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-23T04:44:01.930

您发现它是 Gnu 编译器对 C++ 语言的扩展之一。在这种情况下，Visual C++ 是完全正确的。C++ 中的数组必须使用编译时常量表达式的大小来定义。

在 1999 年对 C 语言的更新中添加了一个特性，称为可变长度数组，这是合法的。如果你能找到一个支持C99的C编译器，这并不容易。但这个特性不是标准 C++ 的一部分，也不会在 C++ 标准的下一次更新中添加。

C++ 中有两种解决方案。第一个是使用 std::vector，第二个只是使用 operator `new []`：

```
char *a = new char [n]; 
```

在我写答案时，另一个人发布了使用 _alloca 的建议。我强烈建议不要这样做。您只需将一种非标准的、不可移植的方法换成另一种特定于编译器的方法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-23T04:40:29.380

您从堆栈分配的方法是 g++ 扩展。要在 MSVC 下做同样的事情，你需要使用 _alloca：

```
char *a = (char *)_alloca(n); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-23T04:47:55.747

您正在使用不是标准的东西。实际上它是标准 C 但不是 C++。这是多么奇特啊！

再解释一下，运行时大小的堆栈数组不是 C++ 的一部分，而是 C99 的一部分，这是 C 的最新标准。这就是为什么有些编译器会得到它，而其他编译器不会。我建议不要使用它，以避免编译器兼容性问题。

正如 strager 所发布的，该功能的替代实现将使用 new 和 delete。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T04:40:53.437

您可以使用 new/delete 在堆上分配/释放内存。这比使用 char[n] 更慢并且可能更容易出错，但遗憾的是，它还不是 C++ 标准的一部分。

您可以将 boost 的作用域数组类用于使用 new[] 的异常安全方法。*当a*超出范围时，会自动调用 delete[] 。

```
void f(int n) {
    boost::scoped_array<char> a(new char[n]);

    /* Code here. */
} 
```

您还可以使用 std::vector 和 reserve() 一些字节：

```
void f(int n) {
    std::vector<char> a;
    a.resize(n);

    /* Code here. */
} 
```

如果您*确实*想使用 char[n]，请编译为 C99 代码而不是 C++ 代码。

如果出于某种原因绝对必须在堆栈上分配数据，请使用 _alloca 或 _malloca/_freea，它们是 MSVC 库等提供的扩展。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-07T02:42:32.577

可变长度数组是在 C99 中引入的。它在 gcc 中受支持，但在 msvc 中不受支持。根据 MSVC 团队的一位人士的说法，微软没有计划在他们的 c/C++ 编译器中支持这个功能。他建议在这些情况下使用 std::vector 。

请注意，C99 并不要求在堆栈上分配数组。编译器可以在堆上分配它。但是，gcc 确实在堆栈上分配了数组。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T15:41:41.177

通常在 C（除了其他人指出的 C99 编译器）和 C++ 中，如果要在堆栈上分配内存，则必须在编译时知道要分配的大小。局部变量是在堆栈上分配的，因此在运行时长度取决于函数参数的数组违反了此规则。Klein 正确地指出，使用“new”运算符是解决此问题的一种方法：

```
 char *a = new char [n]; 
```

 `'a' 仍然是分配在堆栈上的局部变量，但它不是整个数组（具有可变长度），它只是一个指向数组的指针（它总是相同的大小，因此在编译时已知）。数组是在堆上分配的，它通常播放堆栈的对应物——堆栈用于在编译时已知大小的东西，而堆用于在编译时不知道大小的东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-06T22:20:37.673

使用 a`vector<>`而不是数组是否合理？或者，因为您要替换 a `char *`， a `std::string`? 这些确实适用于运行时大小调整，尽管可能有其他原因不使用它们。

# delphi - 为什么 Delphi 中的字符串内存过多？

> ID：312118
> 
> 赞同：10
> 
> 时间：2008-11-23T04:38:34.190
> 
> 标签：delphi, memory-management, delphi-2009, utf-16, fastmm

我正在阅读一个包含 140 万行、大小为 24 MB（平均每行 17 个字符）的大型文本文件。

我使用的是 Delphi 2009，文件是 ANSI，但在读取时会转换为 Unicode，因此您可以说转换后的文本大小为 48 MB。

（编辑：我发现了一个更简单的例子......）

我将此文本加载到一个简单的 StringList 中：

> ```
>  AllLines := TStringList.Create;
>   AllLines.LoadFromFile(Filename); 
> ```

我发现这些数据行似乎比它们的 48 MB 占用更多的内存。

事实上，它们使用 155 MB 内存。

我不介意 Delphi 使用 48 MB 甚至高达 60 MB 的内存管理开销。但是 155 MB 似乎过多。

这不是 StringList 的错。我之前尝试将这些行加载到记录结构中，并且得到了相同的结果（160 MB）。

我没有看到或理解是什么导致 Delphi 或 FastMM 内存管理器使用 3 倍于存储字符串所需的内存量。堆分配不可能那么低效，不是吗？

我已经对此进行了调试并尽可能地对其进行了研究。任何关于为什么会发生这种情况的想法，或者可能帮助我减少过度使用的想法将不胜感激。

注意：我以这个“较小”的文件为例。我真的想加载一个 320 MB 的文件，但 Delphi 要求超过 2 GB 的 RAM 并且由于这个多余的字符串要求而耗尽内存。

附录：Marco Cantu 刚刚发表了[一份关于 Delphi 和 Unicode 的白皮书](http://blog.marcocantu.com/blog/d2009_whitepaper1.html)。Delphi 2009 将每个字符串的开销从 8 个字节增加到 12 个字节（对于指向字符串的实际指针，可能还要增加 4 个字节）。每 17x2 = 34 字节的行额外增加 16 字节几乎增加了 50%。但我看到超过 200% 的开销。额外的 150% 可能是什么？

* * *

成功！！感谢大家的建议。你们都让我思考。但我必须感谢 Jan Goyvaerts 的回答，因为他问：

> ...你为什么要使用 TStringList？文件真的必须作为单独的行存储在内存中吗？

这使我找到了一个解决方案，即我可以将我的行分组到我的程序知道的自然组中，而不是将 24 MB 文件作为 140 万行 StringList 加载。因此，这导致将 127,000 行加载到字符串列表中。

现在每行平均 190 个字符而不是 17 个。每个 StringList 行的开销是相同的，但现在行数要少得多。

当我将此应用到 320 MB 文件时，它不再耗尽内存，现在加载不到 1 GB 的 RAM。（而且加载只需要大约 10 秒，相当不错！）

解析分组的行会有一点额外的处理，但在每个组的实时处理中应该不明显。

（如果您想知道，这是一个家谱程序，这可能是我需要让它在不到 30 秒的时间内将大约 100 万人的所有数据加载到 32 位地址空间中的最后一步。所以我我们仍然有 20 秒的缓冲时间来将索引添加到数据中，这将需要允许显示和编辑数据。）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T10:39:45.053

你让我亲自在这里回答你的问题。我不知道您看到如此高内存使用率的确切原因，但您需要记住 TStringList 不仅仅是加载您的文件。这些步骤中的每一个都需要内存，这可能会导致内存碎片。TStringList 需要将您的文件加载到内存中，将其从 Ansi 转换为 Unicode，将其拆分为每一行的一个字符串，并将这些行填充到一个将被多次重新分配的数组中。

我的问题是你为什么要使用 TStringList？文件真的必须作为单独的行存储在内存中吗？您是要修改内存中的文件，还是只显示其中的一部分？将文件作为一大块保存在内存中并使用与您想要的部分匹配的正则表达式扫描整个文件将比存储单独的行更节省内存。

此外，是否必须将整个文件转换为 Unicode？虽然您的应用程序是 Unicode，但您的文件是 Ansi。我的一般建议是尽快将 Ansi 输入转换为 Unicode，因为这样做可以节省 CPU 周期。但是当您有 320 MB 的 Ansi 数据将作为 Ansi 数据保留时，内存消耗将成为瓶颈。尝试将文件作为 Ansi 保存在内存中，并且仅将您将显示给用户的部分转换为 Ansi。

如果 320 MB 文件不是您要从中提取某些信息的数据文件，而是您要修改的数据集，请考虑将其转换为关系数据库，并让数据库引擎担心如何管理庞大的数据集内存有限。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-23T07:19:09.573

如果您使用 AnsiString 制作原始记录会怎样？立马把它切成两半？仅仅因为 Delphi 默认使用 UnicodeString 并不意味着您必须使用它。

此外，如果您确切知道每个字符串的长度（在一两个字符内），那么最好使用短字符串并减少更多字节。

我很好奇是否有更好的方法来完成您正在尝试做的事情。将 320 MB 的文本加载到内存中可能不是最好的解决方案，即使您可以将其降低到只需要 320 MB

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-23T14:25:11.837

> 我使用的是 Delphi 2009，文件是 ANSI，但在读取时会转换为 Unicode，因此您可以说转换后的文本大小为 48 MB。

对不起，但我完全不明白这一点。如果你需要你的程序是 Unicode，那么文件是“ANSI”（它必须有一些字符集，如 WIN1252 或 ISO8859_1）肯定不是正确的。我首先将其转换为 UTF8。如果文件不包含任何字符 >= 128 它不会改变任何东西（它甚至会是相同的大小），但你已经为未来做好了准备。

现在您可以将其加载到 UTF8 字符串中，这不会使您的内存消耗加倍。将同时在屏幕上可见的少数字符串即时转换为 Delphi Unicode 字符串会更慢，但考虑到内存占用更小，您的程序将在很少（免费）的系统上执行得更好记忆。

现在，如果您的程序仍然使用 TStringList 消耗太多内存，您始终可以在程序中使用 TStrings 甚至 IStrings，并编写一个实现 IStrings 或继承 TStrings 的类，并且不会将所有行保留在内存中。想到的一些想法：

1.  将文件读入 TMemoryStream，并维护一个指向行首字符的指针数组。返回一个字符串很容易，你只需要在行的开头和下一行的开头之间返回一个正确的字符串，去掉 CR 和 NL。

2.  如果这仍然消耗太多内存，请将 TMemoryStream 替换为 TFileStream，并且不要维护 char 指针数组，而是维护行开始的文件偏移量数组。

3.  您还可以将 Windows API 函数用于内存映射文件。这允许您使用内存地址而不是文件偏移量，但不会像第一个想法那样消耗那么多内存。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-23T08:29:37.000

默认情况下，Delphi 2009 的 TStringList 将文件读取为 ANSI，除非有字节顺序标记将文件标识为其他内容，或者如果您提供编码作为 LoadFromFile 的可选第二个参数。

因此，如果您看到 TStringList 占用的内存比您想象的要多，则说明发生了其他事情。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-23T09:21:45.990

您是否有机会使用来自 sourceforge 的 FastMM 源代码并定义了 FullDebugMode 来编译程序？在这种情况下，FastMM 并没有真正释放未使用的内存块，这可以解释问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-23T05:39:14.050

您是否依赖 Windows 来告诉您程序使用了多少内存？它因夸大 Delphi 应用程序使用的内存而臭名昭著。

不过，我确实在您的代码中看到了大量额外的内存使用。

您的记录结构是 20 个字节——如果每行有一个这样的记录，那么您正在查看的记录数据多于文本数据。

此外，字符串具有固有的 4 字节开销——另外 25%。

我相信在 Delphi 的堆处理中有一定数量的分配粒度，但我不记得它目前是什么。即使是 8 个字节（空闲块链表的两个指针），您也看到了另外 25%。

请注意，我们的增幅已经超过 150%。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-24T18:46:47.160

其中一部分可能是块分配算法。随着列表的增长，它开始增加在每个块上分配的内存量。我已经很久没有看过它了，但我相信每次内存不足时，它都会使最后分配的数量增加一倍。当您开始处理如此大的列表时，您的分配也比您最终需要的要大得多。

**编辑-正如lkessler** 指出的那样，这种增长实际上只有 25%，但仍应将其视为问题的一部分。如果您刚刚超出临界点，则可能有一个巨大的内存块分配给未使用的列表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-24T15:48:10.793

为什么要将这么多数据加载到 TStringList 中？列表本身会有一些开销。也许 TTextReader 可以帮助你。

# opengl-es - opengl：如何避免纹理缩放

> ID：312124
> 
> 赞同：3
> 
> 时间：2008-11-23T04:42:37.457
> 
> 标签：opengl-es

如何应用始终保持其原始比例的*重复*纹理（纹理中的 1 个像素 = 屏幕上的 1 个像素），而不管应用的顶点数据如何。

我意识到这不是最常见的任务，但是否可以轻松设置 opengl 来执行此操作，或者我是否需要对尊重其原始外观的顶点数据应用某种掩码？

编辑：在我的具体情况下，我正在尝试使用相同的像素模式绘制不同大小的 2D 椭圆。椭圆是由三角形扇形制成的，我很难在上面画出任何类型的重复纹理。我希望有一些 opengl 配置组合可以轻松地做到这一点。另外，现在我意识到重要的是要提到我正在为 iphone 使用 opengles，因此 GLU 不可用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T10:44:25.200

创建有问题的 3D 对象，但不显示它。

您可以使用 gluProject 将对象的边界作为像素位置获取（以获取表示对象边缘的像素。然后您可以使用 gluUnProject 将中间像素映射到对象的坐标。

然后，您开始绘制并映射同一对象上的自定义（即时）纹理并显示它。

不知道为什么要这样做，但这应该是一个很好的起点。

编辑：

我的意思是自定义，是如果边界你的对象（在一个维度上）是 -3.0 到 1.0，并且第一个像素行是从 -3.0 到 -2.0，你的纹理贴图将指示 25% 的自定义纹理贴图在那个点上，你创建这一切都与您要在那里显示的像素的颜色有关。

仔细考虑之后，我意识到你可以在投影屏幕坐标的顶部绘制一个纹理（使用 2D 绘图工具）。

我认为这可以理解你的想法的要点。如果“对象”靠近并移开，如果纹理似乎没有放大和缩小，我认为它在交互式 3D 演示中效果不佳。但你没有说你实际上在做什么。

编辑 2：

OpenGL 2D 投影：

注意
函数名称，例如，opengles 1.1 有 glOrthox 和 glOrthof。确保检查 gl.h 头文件中可用的内容。

```
const XSize = 640, YSize = 480
glMatrixMode (GL_PROJECTION)
glLoadIdentity ()
glOrtho (0, XSize, YSize, 0, 0, 1)
glMatrixMode (GL_MODELVIEW)
glDisable(GL_DEPTH_TEST)
glClear(GL_COLOR_BUFFER_BIT)

// Now draw with 2i or 2f vertices instead of the normal vertex3f functions.
// And for ES, of course set up your data structures and call drawarrays ofr drawelements.

SwapBuffers() 
```

这将允许您在 OpenGL 中绘制 2D 形状（比使用 3D 投影要简单得多）。要混合两者，例如，先在 3D 中绘制，然后在 2D 中绘制，请点击第二个链接。

这是关于 2D 绘图的优秀教程：http:
[//basic4gl.wikispaces.com/2D+Drawing+in+OpenGL](http://basic4gl.wikispaces.com/2D+Drawing+in+OpenGL)

以下是混合两者的基础知识：
[http ://www.gamedev.net/community/forums/topic.asp ?topic_id=96440](http://www.gamedev.net/community/forums/topic.asp?topic_id=96440)

我希望这是你想要的。我从您的帖子中偷偷地怀疑您在将纹理映射到三角形点以使其显示为“笔直”时遇到了麻烦。您可能想查看 NeHe 上的基本纹理映射：
[http ://www.gamedev.net/community/forums/topic.asp?topic_id=96440](http://www.gamedev.net/community/forums/topic.asp?topic_id=96440)
例如，gltexcoord2f 根据映射到下一个绘制顶点的纹理的宽度和高度百分比来指定纹理内的点 (0.0-1.0)。使用三角扇，您可以使用一些数学方法来计算您使用顶点指定的整个对象的宽度和高度的百分比。

举个例子，一个带有纹理贴图（地球的墨卡托投影）的球体最好通过计算纬度线作为底层三角形扇形顶点值的基础来映射，因为它简化了纹理坐标的计算。使您的多边形近似于简单的几何形状，使您可以使用三角函数更轻松地计算纹理坐标。

我希望这是有帮助的。

在这里，我将不再继续使用您必须修改的桌面示例。这是一个执行正确 3D 纹理映射的 OpenGLES 示例。你可以使用我上面说的和这个例子来做 2D 纹理映射。
[http://www.zeuscmd.com/tutorials/opengles/17-TextureMapping.php](http://www.zeuscmd.com/tutorials/opengles/17-TextureMapping.php)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T20:33:45.690

我认为以下代码片段就是您所说的。但是，如果没有 hack，它会在视口大小不均匀的情况下`reshape()`闪烁得非常糟糕。`GL_NEAREST`任何见解将不胜感激。

虽然它使用纹理坐标生成，所以我不确定在 OpenGL ES 1.1 前面要告诉你什么。PowerVR 代表[暗示](http://www.khronos.org/message_boards/viewtopic.php?f=4&t=1219 "OpenGL ES 1.1 纹理坐标生成提示")了一个解决方案，但不是很明确。

```
#include <GL/glut.h>
#include <cstdlib>
#include <cmath>

static GLuint texName;

void init(void)
{
glClearColor(0,0,0,0);

// create random texture
const int texWidth = 8;
const int texHeight = 8;
GLubyte tex[texHeight][texWidth][4];
for(int i = 0; i < texHeight; i++)
    {
    for(int j = 0; j < texWidth; j++) 
        {
        tex[i][j][0] = (GLubyte) rand()%255;
        tex[i][j][1] = (GLubyte) rand()%255;
        tex[i][j][2] = (GLubyte) rand()%255;
        tex[i][j][3] = (GLubyte) 255;
        }
    }
glPixelStorei(GL_UNPACK_ALIGNMENT, 1);

glGenTextures(1, &texName);
glBindTexture(GL_TEXTURE_2D, texName);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, texWidth, texHeight, 0, GL_RGBA, GL_UNSIGNED_BYTE, tex);

// planes for texture coordinate generation
GLfloat xp[] = {1,0,0,0};
GLfloat yp[] = {0,1,0,0};
GLfloat zp[] = {0,0,1,0};
GLfloat wp[] = {0,0,0,1};
glTexGeni(GL_S, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR);
glTexGeni(GL_T, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR);
glTexGeni(GL_R, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR);
glTexGeni(GL_Q, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR);
glTexGenfv(GL_S, GL_EYE_PLANE, xp);
glTexGenfv(GL_T, GL_EYE_PLANE, yp);
glTexGenfv(GL_R, GL_EYE_PLANE, zp);
glTexGenfv(GL_Q, GL_EYE_PLANE, wp);
glEnable(GL_TEXTURE_GEN_S);
glEnable(GL_TEXTURE_GEN_T);
glEnable(GL_TEXTURE_GEN_R);
glEnable(GL_TEXTURE_GEN_Q);

glEnable(GL_DEPTH_TEST);
glShadeModel(GL_SMOOTH);
glEnable(GL_TEXTURE_2D);
glEnable(GL_CULL_FACE);
glEnable(GL_LIGHTING);
glEnable(GL_LIGHT0);
}

void display(void)
{
glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

// projection
glMatrixMode(GL_PROJECTION); glLoadIdentity();
int viewport[4]; glGetIntegerv(GL_VIEWPORT, viewport);
gluPerspective(60.0, (GLdouble)viewport[2]/(GLdouble)viewport[3], 1.0, 100.0 );

// texture matrix trickery
int tw,th;
glMatrixMode(GL_TEXTURE); glLoadIdentity();
glBindTexture(GL_TEXTURE_2D, texName);
glGetTexLevelParameteriv(GL_TEXTURE_2D, 0, GL_TEXTURE_WIDTH, &tw);
glGetTexLevelParameteriv(GL_TEXTURE_2D, 0, GL_TEXTURE_HEIGHT, &th);
glScaled( (viewport[2]/2)/(GLdouble)tw, (viewport[3]/2)/(GLdouble)th, 0 );
GLdouble proj[16];
glGetDoublev(GL_PROJECTION_MATRIX, proj); // grab projection matrix
glMultMatrixd(proj);

// view transform
glMatrixMode(GL_MODELVIEW); glLoadIdentity();
glTranslatef(0,0,-2.5);

// render textured teapot
glPushMatrix();
const float ANGLE_SPEED = 60; // degrees/sec
float angle = ANGLE_SPEED * (glutGet(GLUT_ELAPSED_TIME) / 1000.0f);
glRotatef(angle*0.5f, 1, 0, 0);
glRotatef(angle, 0, 1, 0);
glRotatef(angle*0.7f, 0, 0, 1);
glScalef(-1,-1,-1); // teapot is wound backwards (GL_CW), so flip it
glutSolidTeapot(1);
glPopMatrix();

glutSwapBuffers();
}

void reshape(int w, int h)
{
// make width/height evenly divisible by 2
w -= (w%2);
h -= (h%2);
glViewport(0, 0, (GLsizei) w, (GLsizei) h);
}

void keyboard (unsigned char key, int x, int y)
{
switch (key) 
    { 
    case 27: exit(0); break;
    default: break; 
    }
}

void idle() { glutPostRedisplay(); }

int main(int argc, char** argv)
{
glutInit(&argc, argv);
glutInitDisplayMode (GLUT_DOUBLE | GLUT_RGBA | GLUT_DEPTH);
glutInitWindowSize(640, 480);
glutInitWindowPosition(100, 100);
glutCreateWindow (argv[0]);
glutDisplayFunc(display);
glutReshapeFunc(reshape);
glutKeyboardFunc(keyboard);
glutIdleFunc(idle);

init();
glutMainLoop();
return 0;
} 
```

编辑：找出纹理矩阵唯一的方法（应该是OpenGL ES 1.1-able）：

```
#include <GL/glut.h>
#include <cstdlib>
#include <cmath>

void glutTexturedCube(GLdouble size)
{
    GLfloat texc[] = {
        1,1,    0,1,    0,0,    1,0,
        0,1,    0,0,    1,0,    1,1,
        1,0,    1,1,    0,1,    0,0,
        1,1,    0,1,    0,0,    1,0,
        0,0,    1,0,    1,1,    0,1,
        0,0,    1,0,    1,1,    0,1,
    };

    GLfloat norm[] = {
        0,0,1,      0,0,1,      0,0,1,      0,0,1,
        1,0,0,      1,0,0,      1,0,0,      1,0,0,
        0,1,0,      0,1,0,      0,1,0,      0,1,0,
        -1,0,0,     -1,0,0,     -1,0,0,     -1,0,0,
        0,-1,0,     0,-1,0,     0,-1,0,     0,-1,0,
        0,0,-1,     0,0,-1,     0,0,-1,     0,0,-1,
    };

    GLfloat vert[] = {
        1,1,1,      -1,1,1,     -1,-1,1,    1,-1,1,
        1,1,1,      1,-1,1,     1,-1,-1,    1,1,-1,
        1,1,1,      1,1,-1,     -1,1,-1,    -1,1,1,
        -1,1,1,     -1,1,-1,    -1,-1,-1,   -1,-1,1,
        -1,-1,-1,   1,-1,-1,    1,-1,1,     -1,-1,1,
        1,-1,-1,    -1,-1,-1,   -1,1,-1,    1,1,-1,
    };

    GLuint idxs[] = { 
        0, 1, 2, 3,     
        4, 5, 6, 7,     
        8, 9, 10, 11,
        12, 13, 14, 15,
        16, 17, 18, 19,
        20, 21, 22, 23,
    };

    glEnableClientState(GL_TEXTURE_COORD_ARRAY);
    glEnableClientState(GL_NORMAL_ARRAY);
    glEnableClientState(GL_VERTEX_ARRAY);
    // feed vertices in as texture coordinates
    glTexCoordPointer(3, GL_FLOAT, 0, vert);
    glNormalPointer(GL_FLOAT, 0, norm);
    glVertexPointer(3, GL_FLOAT, 0, vert);

    glPushMatrix();
    glColor4f(1, 1, 1, 1);
    glScaled(size, size, size);
    glDrawElements(GL_QUADS, sizeof(idxs)/sizeof(idxs[0]), GL_UNSIGNED_INT, idxs);
    glPopMatrix();

    glDisableClientState(GL_TEXTURE_COORD_ARRAY);
    glDisableClientState(GL_NORMAL_ARRAY);
    glDisableClientState(GL_VERTEX_ARRAY);
}

static GLuint texName;

void init(void)
{
glClearColor(0,0,0,0);

// create random texture
const int texWidth = 8;
const int texHeight = 8;
GLubyte tex[texHeight][texWidth][4];
for(int i = 0; i < texHeight; i++)
    {
    for(int j = 0; j < texWidth; j++) 
        {
        tex[i][j][0] = (GLubyte) rand()%255;
        tex[i][j][1] = (GLubyte) rand()%255;
        tex[i][j][2] = (GLubyte) rand()%255;
        tex[i][j][3] = (GLubyte) 255;
        }
    }
glPixelStorei(GL_UNPACK_ALIGNMENT, 1);

glGenTextures(1, &texName);
glBindTexture(GL_TEXTURE_2D, texName);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, texWidth, texHeight, 0, GL_RGBA, GL_UNSIGNED_BYTE, tex);

glEnable(GL_DEPTH_TEST);
glShadeModel(GL_SMOOTH);
glEnable(GL_TEXTURE_2D);
glEnable(GL_CULL_FACE);
glEnable(GL_LIGHTING);
glEnable(GL_LIGHT0);
}

void display(void)
{
glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

// projection
glMatrixMode(GL_PROJECTION); glLoadIdentity();
int viewport[4]; glGetIntegerv(GL_VIEWPORT, viewport);
gluPerspective(60.0, (GLdouble)viewport[2]/(GLdouble)viewport[3], 1.0, 100.0 );

// view transform
glMatrixMode(GL_MODELVIEW); glLoadIdentity();
glTranslatef(0,0,-3);

// render textured teapot
glPushMatrix();
const float ANGLE_SPEED = 10; // degrees/sec
float angle = ANGLE_SPEED * (glutGet(GLUT_ELAPSED_TIME) / 1000.0f);
glRotatef(angle*0.5f, 1, 0, 0);
glRotatef(angle, 0, 1, 0);
glRotatef(angle*0.7f, 0, 0, 1);

// texture matrix trickery
int tw,th;
glBindTexture(GL_TEXTURE_2D, texName);
glGetTexLevelParameteriv(GL_TEXTURE_2D, 0, GL_TEXTURE_WIDTH, &tw);
glGetTexLevelParameteriv(GL_TEXTURE_2D, 0, GL_TEXTURE_HEIGHT, &th);
GLint mmode = 0;
glGetIntegerv(GL_MATRIX_MODE, &mmode);
glMatrixMode(GL_TEXTURE); glLoadIdentity();
glScaled( (viewport[2]/2)/(GLdouble)tw, (viewport[3]/2)/(GLdouble)th, 0 );
GLdouble mat[16];
glGetDoublev(GL_PROJECTION_MATRIX, mat);
glMultMatrixd(mat);
glGetDoublev(GL_MODELVIEW_MATRIX, mat);
glMultMatrixd(mat);
glMatrixMode(mmode);

glutTexturedCube(1);
glPopMatrix();

glutSwapBuffers();
}

void reshape(int w, int h)
{
// make width/height evenly divisible by 2
w -= (w%2);
h -= (h%2);
glViewport(0, 0, (GLsizei) w, (GLsizei) h);
}

void keyboard (unsigned char key, int x, int y)
{
switch (key) 
    { 
    case 27: exit(0); break;
    default: break; 
    }
}

void idle() { glutPostRedisplay(); }

int main(int argc, char** argv)
{
glutInit(&argc, argv);
glutInitDisplayMode (GLUT_DOUBLE | GLUT_RGBA | GLUT_DEPTH);
glutInitWindowSize(640, 480);
glutInitWindowPosition(100, 100);
glutCreateWindow (argv[0]);
glutDisplayFunc(display);
glutReshapeFunc(reshape);
glutKeyboardFunc(keyboard);
glutIdleFunc(idle);

init();
glutMainLoop();
return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T04:46:20.757

我不太确定，但试试这样的：

拿你的模型矩阵、透视矩阵和类似的东西。通过将它们相乘以正确的顺序将它们混合在一起。取该矩阵的逆矩阵。将它乘以您的纹理矩阵（可能是单位矩阵）。将其设置为您的纹理矩阵。

# jquery - 带有 jquery 代码的脚本块应该放在 ASP.NET MVC 母版页的什么位置？

> ID：312150
> 
> 赞同：6
> 
> 时间：2008-11-23T05:25:06.170
> 
> 标签：jquery, asp.net-mvc

开始使用 jquery 并在为 asp.net mvc 获取 hello world 类型示例时遇到问题。尝试使用此脚本加载页面时出现运行时错误“预期对象”。

A. 脚本标签应该放在母版页的什么位置？B. 我可能做错了什么？我的页面中肯定有“a”元素？

```
<script src="../Scripts/jquery-1.2.6.min.js" type="text/javascript"></script>

            <script src="../Scripts/jquery.corner.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(document).ready(function() {
                    $("a").click(function(event) {
                        alert("Thanks for visiting!");
                    });
                });
            </script> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T05:33:23.017

嗯...

回答你的第一个问题：它们应该放在`<head>`元素中。

另外，通常我在 DOM 中接收事件时使用[“绑定”方法](http://docs.jquery.com/Events/bind#typedatafn)（就像你正在尝试做的那样）。

所以，代码看起来像：

```
$(document).ready(function()
{
    //  Bind each link to a handler:
    $("a").bind('click dblclick', function(event)
    {
         alert('click');
    })
}); 
```

此外，还有一些设计技巧（因为您正在处理我最关心的事情（带有 jQ​​uery 的 ASP.NET MVC）：

`<head>`在母版页元素的底部添加一个额外的“ContentPlaceHolder” 。这将允许您在适当的位置运行特定于页面的 javascript：在页面的“head”部分，它允许您制作特定于页面的 javascript 包含。

它看起来像这样：

```
 <asp:ContentPlaceHolder ID="HeadContent" runat="server" />
</head> 
```

**为什么这很有用？** 我会告诉你：你正在使用的那个 jQuery 圆角插件可能只用在几个页面上——为什么要在每个页面上都包含它？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T07:06:49.990

我同意 Dan 为脚本中的链接添加内容占位符。然而，就性能而言，头部通常不是放置 JavaScript 的最佳位置。最好的地方是在页面的底部。所以你的 HTML 可以在你的 JavaScript 之前加载。请参阅[Yahoo 的 YSlow 提示](http://developer.yahoo.com/performance/rules.html#js_bottom)。不过，您的代码应该仍然可以在 head 部分工作。

我喜欢将我网站的大部分 JavaScript 放在一个文件中，并将其链接到所有页面。如果它变得非常大，您可以将它分成几个文件。这利用了浏览器的缓存。

至于 jQuery 代码有什么问题。我不知道。它看起来很正确。我唯一想知道的是事件参数。尝试完全消除它。我知道该函数允许一个参数，但我通常使用“this”来代替。另外，尝试重命名参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T09:09:48.650

B）我在快速测试页面上检查了你的内联脚本，它工作正常，所以我建议使用安装了**FireBug插件的****Firefox**来查找问题：

 ***   在 Firebug 的“脚本”选项卡中，使用右侧的 Watch 窗口插入和检查部分脚本，看看它们返回了什么。
*   我会先放入`$`监视窗口并检查它是否被识别为`function()`：也许 jQuery 没有正确链接
*   然后放入 `$("a")`监视窗口并检查它返回的集合是否具有与集合中的“a”选择器对应的正确数量的项目
*   继续运行部分脚本，直到遇到错误

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-24T21:09:43.050

母版页通常存储在 /Views/Shared/Site.Master 而脚本位于 /Scripts 所以这些：

```
<script src="../Scripts/jquery-1.2.6.min.js" type="text/javascript"></script>            
<script src="../Scripts/jquery.corner.js" type="text/javascript"></script> 
```

应该

```
<script src="../../Scripts/jquery-1.2.6.min.js" type="text/javascript"></script>
<script src="../../Scripts/jquery.corner.js" type="text/javascript"></script> 
```

但我建议使用助手：

```
 public static class Helper
    {
        private static string ScriptsRoot = "~/scripts/";

        public static string ScriptUrl (string scriptFile)
        {
            return VirtualPathUtility.ToAbsolute (ScriptsRoot + scriptFile);
        }
    } 
```

然后像这样引用您的脚本：

```
<script type="text/javascript" src="<%= Helper.ScriptUrl("jquery-1.2.6.min.js") %>"></script>
<script type="text/javascript" src="<%= Helper.ScriptUrl("jquery.corner.js") %>"></script> 
```

# pagination - CouchDB 中的分页？

> ID：312163
> 
> 赞同：46
> 
> 时间：2008-11-23T05:37:17.033
> 
> 标签：pagination, couchdb

我将如何实施分页所需的查询？

基本上，当请求第 1 页时，获取前 5 个条目。对于第 2 页，获取下一个 5，依此类推。

我计划通过 couchdb-python 模块使用它，但这对实现没有任何影响。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2011-06-25T01:20:33.087

[CouchDB 指南](http://guide.couchdb.org/)对分页进行了很好的讨论，包括大量示例代码，这里：[http](http://guide.couchdb.org/draft/recipes.html#pagination) ://guide.couchdb.org/draft/recipes.html#pagination 这是他们的算法：

*   `rows_per_page + 1`从视图中请求行
*   显示`rows_per_page`行，将最后一行存储为`next_startkey`
*   作为页面信息，保持`startkey`和`next_startkey`
*   使用这些`next_*`值创建下一个链接，并使用其他值创建上一个链接

注意：在 CouchDB 中获取页面的正确方法是指定一个起始键，而不是您可能认为的起始索引。但是你怎么知道开始第二页的键是什么？聪明的解决方案：“不是为一页请求 10 行，而是请求 11 行，但只显示 10 行，并使用第 11 行中的值作为下一页的开始键。”

如果您希望多个文档发出相同的键，则需要使用`startdocid`除了`startkey`正确分页。原因是`startkey`仅凭这一点将不再足以唯一标识一行。如果您不提供`startkey`. 实际上，CouchDB 会首先查看`startkey`参数，然后如果多个潜在的起始行具有相同的键但不同的文档 ID，它将使用该`startdocid`参数进一步重新定义范围的开始。对于`enddocid`.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-24T15:46:39.067

CouchDB [HTTP View API](http://wiki.apache.org/couchdb/HTTP_view_API)为高效分页提供了充足的空间。

最简单的方法是使用`startkey`and `count`。Count 是 CouchDB 将为该视图请求返回的最大条目数，这取决于您的设计，而 startkey 是您希望 CouchDB 开始的位置。当您请求视图时，它还会告诉您有多少条目，如果您想向用户显示，您可以计算有多少页面。

所以第一个请求不会指定 startkey，只是要显示的条目数的计数。然后，您可以记下返回的最后一个条目的键，并将其用作下一页的开始键。在这个简单的表单中，您将获得重叠，其中一个页面的最后一个条目是下一个页面的第一个条目。如果这不是可取的，那么简单地不显示页面的最后一个条目是微不足道的。

执行此操作的更简单方法是使用 skip 参数计算页面的起始文档，但应谨慎使用此方法。跳过参数只是导致内部引擎不返回它正在迭代的条目。虽然这提供了所需的行为，但它比按键查找页面的第一个文档要慢得多。跳过的文档越多，请求就越慢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T05:41:12.440

到目前为止，这就是我想出的 - 获取所有帖子的 ID，然后检索前 x 个 ID 的实际项目..

它的效率不是很高，但比检索所有帖子然后扔掉大部分帖子更有效。也就是说，令我惊讶的是，它似乎运行得相当快——我运行了该`posthelper.page()`方法 100 次，只用了大约 0.5 秒。

我不想在实际问题中发布这个，所以它不会影响答案 - 这是代码：

```
allPostsUuid = """
function(doc) {
if(doc.type == 'post'){
    emit(doc._id, null);
}
}
"""

class PostsHelper:
    def __init__(self):
        server = Server(config.dbhost)
        db = server[config.dbname]
        return db

    def _getPostByUuid(self, uuid):
        return self.db.get(uuid)

    def page(self, number = 1):
        number -= 1 # start at zero offset
        start = number * config.perPage
        end = start + config.perPage

        allUuids = [
            x.key for x in self.db.query(allPostsUuid)
        ]
        ret = [
            self._getPostByUuid(x) for x in allUuids[start : end]
        ]

        if len(ret) == 0:
            raise Error404("Invalid page (%s results)" % (len(allUuids)))
        else:
            return ret 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-06-18T02:31:55.930

*   下面是我找到的递归方式：

    取两个变量

```
 var lastOffset = 0; var counter = 0;

  function someRecursive(lastOffset,counter) {

  queryView(db, whereClause).then(result => {
      var rows_per_page = 5; 

//formula below 
var page = Math.floor((lastOffset == 0 ? 0: (result.offset - lastOffset) +

  (rows_per_page * counter)) /  rows_per_page) + 1;

   var skip = page * rows_per_page;
  if (somerecursionexitcondition) {
                   counter = lastOffset == 0 ? lastOffset: counter + 1;
                   lastOffset =result.offset;
              someRecursive(lastOffset, counter).then(result => {
                               resolve();

                           });
  });

  } 
```

# java - Java 私有字段可见性

> ID：312168
> 
> 赞同：17
> 
> 时间：2008-11-23T05:43:24.073
> 
> 标签：java, language-features, visibility

所以前几天我在做一个类并使用 Eclipse 的方法创建 equals 方法时，我意识到它生成了以下**工作**代码：

```
class Test {
  private int privateInt;
  [...]
  public boolean equals(Object obj) {
    [...]
    Test t = (Test) obj;
    if ( t.privateInt == privateInt ) {
    [...]
  }
} 
```

t.privateInt..???? 应该是私人的！所以我想除了私有、受保护、包保护和公共之外，还有一个字段可见性。

那么这里发生了什么？这个怎么称呼？**有人会在哪里使用这个？**这不会破坏封装吗？如果该类没有 mutator 而我更改了它怎么办？C++ 也会发生这种情况吗？这是一个面向对象的习语吗？如果不是，那为什么 Java 这样做呢？

一般来说，我在哪里可以找到这方面的信息？

谢谢你。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-23T05:52:32.543

它可以从同一类的不同实例中访问。

根据[此页面](http://java.sun.com/docs/books/tutorial/java/javaOO/accesscontrol.html)（加粗我的）：

> 在成员级别，您也可以像顶级类一样使用公共修饰符或无修饰符（包私有），并且具有相同的含义。对于成员，还有两个额外的访问修饰符：private 和 protected。**private 修饰符指定该成员只能在其自己的类中访问。**

为了清楚起见，我将重写这一行：

```
if ( t.privateInt == this.privateInt ) 
```

我们可以同意应该允许“this.privateInt”：您正在从消息“equals”已发送到的 Test 类的实例中访问它。

不太清楚“t.privateInt”应该是可见的，因为 t 是 Test 类的一个单独实例，我们没有在其 equals 方法中执行。但是 java 允许这样做，因为两个对象（t 和 this）都属于同一类 Test 并且可以看到彼此的私有成员。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T07:00:42.420

迈克说得很对；您将对象（类的实例）与类本身混淆了。成员是*类*的私有成员，而不是类的任何特定*实例*。

我记得当我刚接触 Java 时，我同样对此感到惊讶。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T05:51:25.930

您在同一类中引用它。因此，您知道自己在做什么，不需要保护自己。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-09T13:26:26.510

允许访问其他实例的私有成员的一个重要原因是允许“复制”功能——否则它们几乎是不可能的。另外，如果您不允许其他实例访问，您将允许哪些静态方法？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T07:09:38.173

可以访问同一类的另一个实例的私有变量。这是因为您正在直接处理类的实现，这无论如何都需要您了解其内部的“私有”变量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-31T05:58:12.880

对这种混淆的简单回答是记住私有字段仅在它们被初始化（和定义）的类中是可见的......所以当你在类中创建一个类的对象时，你总是可以访问该类的私有字段通过对象引用。可能你觉得它很困难，但是当你在定义它的类中使用它时，只是认为私有字段就像一个公共字段。

# sql-server - VARCHAR 完全像 1990 年代吗？

> ID：312170
> 
> 赞同：46
> 
> 时间：2008-11-23T05:44:56.160
> 
> 标签：sql-server, nvarchar

1.  VARCHAR 不存储 Unicode 字符。
2.  NVARCHAR 确实存储 Unicode 字符。
3.  今天的应用程序应该始终与 Unicode 兼容。
4.  NVARCHAR 需要两倍的空间来存储它。
5.  第 4 点无关紧要，因为存储空间非常便宜。

Ergo：今天在设计 SQL Server 数据库时，应该始终使用 NVARCHAR。

这是合理的推理吗？有人不同意任何前提吗？今天有什么理由选择 VARCHAR 而不是 NVARCHAR 吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-11-23T06:54:08.470

您将数据类型与将存储在列中的数据相匹配。通过类似的论点，您可以说为什么不将所有数据存储在 NVARCHAR 列中，因为数字和日期可以表示为数字字符串。

如果将存储在列中的数据的最佳匹配是 VARCHAR，则使用它。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-11-23T06:48:43.553

> 第 4 点无关紧要，因为存储空间非常便宜。

它不仅仅是存储，还有带宽——CPU、内存、备份、恢复、传输。养护。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-11-23T06:15:58.673

我想说仍然有充分的理由不使用 nvarchar。

*   存储空间非常宝贵，例如在共享主机上或数据库 *非常*巨大。
*   性能至关重要。
*   棕地开发（即数据库具有使用 varchar 的现有表）。
*   您正在与另一个只理解单字节字符和/或 varchar 的旧系统集成。

然而，新的开发可能应该使用 nvarchar esp。因为 64 位系统正在成为常态。此外，公司（甚至是小公司）现在更普遍地全球化。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-11-24T05:22:23.600

对于许多不同类型的列，您应该选择 VARCHAR 而不是 NVARCHAR，并且选择将基于每列。

不需要额外开销 NVARCHAR 的典型列是：

ID 类型列：车牌、SSN、患者图表标识符等。

代码栏：国际货币代码（USD、UKP等）、ISO国家代码（US、UK等）、语言代码（en-us等）、会计分部代码等

邮政编码和邮政编码列。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-23T07:32:56.613

我相信 nvarchars 的比较比 varchars 成本更高，因此在您确实不需要 unicode 功能的地方（例如，对于某些内部 ID），它是完全有效的，甚至是首选。

存储成本仍然很**重要**。如果您有数十亿行，那么这些“小”差异会很快变大。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-23T07:29:25.840

正如其他人所指出的，这不仅仅是存储成本。

列的长度会影响每页的行数。每页的行数越少意味着可以放入缓存的行数越少，这会降低性能。我假设在 MSSQL 中，被索引的 NVARCHAR 列将占用索引中的更多空间。这意味着每个块的索引条目更少，因此索引中的块更多，因此在扫描（或搜索）索引时需要更多的搜索，这也会减慢索引访问。

所以它会在每一个方面失去你的表现。如果您真的不在乎（或者可以衡量性能并对此感到满意，当然），那很好。但是，如果您确实需要存储 unicode 字符，当然可以使用 NVARCHAR。

我可能是通过在整个数据库中使用 NVARCHAR 获得的可维护性超过了任何性能成本。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-23T08:44:50.963

这类问题总是有相同的答案：**这取决于**. 没有你应该盲目遵循的神奇规则。甚至在现代编程语言中使用 GOTO 也是合理的：[在支持循环和函数的语言中使用“goto”是否有利？如果是这样，为什么？](https://stackoverflow.com/questions/24451/goto-usage)

所以答案是：用你的头脑思考特定的情况。在这种特殊情况下，请记住，如果您的需求发生变化，您始终可以在数据库中将 varchar 转换为 nvarchar。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-23T10:15:26.660

我看到 nvarchar 列转换为 varchar 有两个原因：

1.  应用程序使用的是 MSSQL **Express Edition**，它有 4GB 的数据库大小限制。如果有许多数据库部署，切换到 MSSQL 标准版将太昂贵，就像在单租户 web 应用程序或具有嵌入式 DBMS 的应用程序中一样。更便宜的 SQL2008 网络版可以在这里提供帮助。

2.  **nvarchar(4000) 是不够的，**但你不想要一个 ntext 列。所以你转换为 varchar(8000)。但是，在大多数情况下，您可能应该转换为 nvarchar(max)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-23T06:24:52.413

您的第 3 点无效。专为单一国家使用而设计的系统不必担心 unicode，而且使用中的某些语言/产品根本不支持或仅部分支持 unicode。例如，[TurboTax](http://en.wikipedia.org/wiki/TurboTax)仅适用于美国（即使使用法语的加拿大版本仍然只是 LATIN-1），所以他们不需要或不必担心 unicode 并且可能不支持它（我不知道他们是否这样做，但即使他们这样做，这也只是一个例子）。

“今天的应用程序应该始终与 Unicode 兼容。”

可能更有效的表示为：

“今天的应用程序应该始终与 Unicode 兼容，如果不需要发生任何特殊情况来正确处理 Unicode，并且以前存在的代码库或应用程序的任何其他部分不需要专门更新以支持它”

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-23T06:24:03.057

存储比以往任何时候都便宜，但是如果您可以在给定的硬盘驱动器上存储两倍的数据，那还是很有吸引力的，不是吗？

还有用于缓存的 RAM 和固态驱动器，它们都比硬盘驱动器贵得多。当您拥有数百万行时，使用更紧凑的数据格式是有益的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-23T07:08:59.737

有没有办法让您的数据库服务器使用 UTF-8 作为编码？然后，您可以获得大多数 ASCII 加载的低存储空间的好处，以及存储 Unicode 范围内的任何内容的能力，以便可以进行扩展。

我会要求您的数据库供应商也支持 UTF-8 作为`VARCHAR`SQL 类型的编码。我不知道其他数据库服务器是如何做到的，但我知道您至少可以在 MySQL 和 PostgreSQL中的`VARCHAR`和字段中使用 UTF-8。`TEXT`

尽管如此，**不**使用 UTF-16 编码字段的唯一原因是您必须与将在 UTF-16 输入上中断的应用程序进行交互。这将是大多数旨在处理 ASCII 或 ISO-8815 文本编码的遗留应用程序，这将更好地处理 UTF-8。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-08-29T03:29:38.900

我的倾向是“使用 NVARCHAR”作为默认值......但@CadeRoux 有一个很好的观点：如果您确定数据将永远不会包含 ASCII 以外的任何内容 - 就像美国车牌一样 - VARCHAR 可能会为您节省一点点成本。

我会说他的好声明的另一面是“不要使用 NVARCHAR”来处理任何有名字（人、街道、地点）或自然语言文本（电子邮件、聊天、文章、博客帖子、照片说明）的东西。否则，您的“名字”列将无法正确编码“François”或“José”，并且您的文本列将不允许带有“外国”变音符号的文本，或者 - 就此而言 - 非常常见的美国字符，如分号“¢”，段落标记“¶”，项目符号“•”。（因为这些都不是*ASCII 字符*，并且没有好的标准方法将它们放入 VARCHAR 字段。相信我：你会伤害自己。）

在我从事的任何项目中，我从来没有因为使用 NVARCHAR 而被责骂，因为我“在磁盘空间上浪费了太多的公司资金”。而且，如果我必须重新编写代码或 DB 架构（尤其是在实时生产系统上），那么重新安装所花费的成本将轻松超过购买小 50% 的磁盘所带来的“节省”。

要真正理解这个问题，您必须真正了解 ASCII、Unicode 和 Unicode 的典型编码（如 UCS-2 和 UTF-8）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-23T05:49:02.313

我不是这方面的专家。但是为什么你不能使用 UTF-8 来获得小空间和 unicode 的组合呢？

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-08T15:09:36.957

我见过一些数据库，其中索引（索引？...不同的辩论）比数据大。如果可以摆脱索引中一半的存储需求（varchar），那么可以假设这等于给定页面的命中密度的两倍和更有效的填充因子，从而导致更快的数据检索/写入/锁定和更少的存储需求（已经提到过）。

# algorithm - 概率文件验证——算法还是库？

> ID：312175
> 
> 赞同：1
> 
> 时间：2008-11-23T05:51:39.767
> 
> 标签：algorithm, file, hash

我正在寻找一种有效的方法来部分检查慢速传输介质上“大型”数据集的完整性。这似乎是一个常见问题，因为文件大小与传输速率不成比例。

例如，对于具体数字，USB2 上的 TB 数据。通过将每个字节读入哈希或校验和来检查该数据是否仍然有效需要一天的时间，并且会增加驱动器故障的风险。

相反，此代码需要验证随机数据片段，并根据可用时间提供有效性概率。如果允许运行足够长的时间，将验证所有块（读取整个数据集的基本情况）。

用法“故事”：
-- 数据存储在大型加密容器中（大小为 1TB .. 1GB）。
-- 每个容器在不同位置的多组驱动器上冗余备份。
-- 验证检查必须在不了解基础数据或密钥的情况下进行。

该方法需要检测哪些故障模式：
- 存储传输故障（例如，控制器丢弃部分物理地址） - 扇区错误（没有为特定块返回数据）
- 单比特错误（非 ECC 内存或缓存）

当检测到错误时，数据将从冗余存储中恢复。验证数据可能必须单独存储。

由于目标是数据完整性，文件共享网络的技术似乎并不适用——“哈希树”需要在每个节点上完全存储哈希，这似乎比没有活动的场景所需的存储更多攻击者。

*   如何确定存储空间与读取文件相关块的时间之间的权衡？
*   如果散列树/散列列表是最好的方法，那么存储散列的部分值有多安全？
*   某些校验和或纠错代码是否会比散列更好的选择来提供等效保护？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T10:25:19.230

通过 USB2 进行传输，对吗？因此，您应该知道：

*   USB 通信采用数据包形式，用于高速传输的有效负载高达 1024 字节和 16 位 CRC。
*   每个数据包都被确认并可能重传。

您必须考虑这些信息来部署一种算法，该算法在 CRC 提供的担保之外添加一些担保，否则将是徒劳的。如果我没记错的话，16 位 CRC 可以检测到任何不超过 16 位的单个错误突发，以及其中的一小部分。

您可以从维基百科开始：[http](http://en.wikipedia.org/wiki/USB2) ://en.wikipedia.org/wiki/USB2和[http://en.wikipedia.org/wiki/Cyclic_redundancy_check](http://en.wikipedia.org/wiki/Cyclic_redundancy_check)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T08:45:20.603

您可能想尝试使用类似[PAR2](http://en.wikipedia.org/wiki/Parchive)的东西来创建冗余数据。这将允许您检查和更正数据，并且可能可以转换为使用随机访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T05:55:39.680

如何为文件中的数据运行存储哈希值或校验和值？然后，您只需读取数据的受限部分即可对文件内容进行有限验证。

# c# - 扩展方法的缺点？

> ID：312184
> 
> 赞同：30
> 
> 时间：2008-11-23T05:57:36.463
> 
> 标签：c#, extension-methods

扩展方法是一个非常有用的功能，您可以在任何类中添加许多您想要的功能。但我想知道是否有任何不利因素可能会给我带来麻烦。有什么意见或建议吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-23T07:39:38.457

*   扩展方法的导入方式（即一次整个命名空间）不是细化的。您无法从命名空间中导入一个扩展而不获取所有其他扩展。
*   从定义该方法的源代码中并不是很明显。这也是一个*优势*——这意味着您可以使您的代码看起来与该类型的其他方法一致，即使您出于某种原因不能将它放在同一个位置。换句话说，代码在高层次上更容易理解，但就正在执行的内容*而言更复杂。*我认为这对于一般的 LINQ 也是如此。
*   您只能拥有扩展方法，而不是属性、索引器、运算符、构造函数等。
*   如果您正在扩展 3rd 方类，并且在更高版本中他们引入了具有相同签名的新方法，您将不会轻易知道调用代码的含义已更改。如果新方法与您的扩展非常*相似*，但边界条件（或其他）略有不同，那么这可能会导致一些非常棘手的错误。不过相对不太可能发生。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T06:36:56.853

几件事：

*   除非您在 VS.NET 中，否则扩展方法的来源并不总是很清楚
*   扩展方法无法通过反射或 C# 4.0 的动态查找来解决

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T06:16:31.697

扩展方法很有趣，但它们存在潜在的问题。例如，如果您编写了一个扩展方法，而另一个库创建了一个具有相同签名的扩展方法怎么办？您最终会在使用这两个名称空间时遇到困难。

此外，可以说它们不太容易被发现。我认为这取决于这一点。在某些情况下，您的代码应该封装在一个类中，而在其他情况下，可以将该功能添加为扩展方法。

我通常将扩展方法作为我自己的类或 BCL 类的包装器，并将它们放在不同的名称空间中。例如 Utils 和 Utils.Extensions。这样就不必使用扩展。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T11:53:18.977

*   静态方法的空值检查是不同的。不一定更好或更坏 - 但不同，开发人员需要了解这一点。能够在空值上调用方法可能是出乎意料的，并且（有时）可能非常有用。

*   没有多态性（尽管支持重载）

*   如果源类型的两个扩展方法发生冲突（并且都不能称为“更好”），您可能会陷入歧义。然后编译器拒绝使用...这意味着在程序集 A 中添加扩展方法可能会破坏程序集 B 中不相关的代码。我已经看过几次了...

*   你不能在 C# 2.0 中使用，所以如果你正在为 C# 2.0 编写库，它没有帮助

*   它需要 [ExtensionAttribute] - 因此，如果您正在为 .NET 2.0 编写库，您会陷入困境：如果您声明*自己的* [ExtensionAttribute]，它可能会与 .NET 3.5 调用者发生冲突

不过不要误会我的意思——我是一个超级粉丝！

您可能会猜到我目前正在编写一个需要为 C# 2.0 和 .NET 2.0 调用者工作的库 - 并且（令人讨厌的）扩展方法将非常非常有用！

*=仅适用于编译器；已经编译的代码就可以了

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T06:08:34.723

就缺点而言，我认为它们有点像宏——你最终可能会得到更难维护的代码，因为其他人可能不熟悉你添加的扩展。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-18T12:20:05.560

我很难想象在不熟悉现有代码的情况下添加一个方法。例如，您一直在使用第三方类来做某事，鉴于您不是原始开发人员并且您不知道事物在班级？做这样的事情几乎没有意义，就像在看不见的情况下开车毫无意义一样。在 LINQ 由 Microsoft 设计人员/代码实现的情况下，这很有意义，因为他们知道如何说序列的内部实现，现在他们希望通过添加 Count 方法来扩展其功能以计算所有序列中的元素。说了这么多，

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-05-05T07:58:04.817

扩展方法有两种不同的场景：

1.  如果您想扩展来自外部程序集的任何类、接口结构，除了未标记为密封的类，您可以选择从这些类派生并使用其他方法扩展它们，您只有和我仅重复此选项可用。密封类和结构不能被继承，更不用说接口了。
2.  然而，在您自己的程序集中，为特定的类或结构或接口提供扩展方法是一个非常主观的设计问题。如果您想对将使用您的程序集的人慷慨，您可以创建非常小的接口，理想情况下只有很少的属性，然后将一大堆扩展方法附加到它们。这是示例：

    ```
    public interface IPointF{
        float X { get; }
        float Y { get; }
    }

    public struct PointF: IPointF{
        public PointF(float x, float y){
            X=x;Y=y;
        }
        public float X { get; private set; }
        public float Y { get; private set; }
    }

    public static class PointHelper{
        public static PointF ADD(this IPointF p, float val){
            return new PointF(p.x+val, p.y+val);
        }
    } 
    ```

因此，任何未来的用户都可以通过继承 IPoint 来节省大量的编码时间。

# c++ - mac 中的 kbhit()

> ID：312185
> 
> 赞同：1
> 
> 时间：2008-11-23T05:57:54.043
> 
> 标签：c++, macos

我是mac中cpp的新手。在我的程序中使用 kbhit() 时出现错误。我使用了#include，但也出现了错误，因此我使用#include 进行了搜索和测试，但仍然存在错误。所以请帮助我。提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T06:10:42.660

不知道这是否适用于 Mac，但这是我用来在 Linux 上获得单个按键的一些代码。

```
int mygetch() {
    char ch;
    int error;
    static struct termios Otty, Ntty;

    fflush(stdout);
    tcgetattr(0, &Otty);
    Ntty = Otty;

    Ntty.c_iflag  =  0;     /* input mode       */
    Ntty.c_oflag  =  0;     /* output mode      */
    Ntty.c_lflag &= ~ICANON;    /* line settings    */

#if 1
    /* disable echoing the char as it is typed */
    Ntty.c_lflag &= ~ECHO;  /* disable echo     */
#else
    /* enable echoing the char as it is typed */
    Ntty.c_lflag |=  ECHO;  /* enable echo      */
#endif

    Ntty.c_cc[VMIN]  = CMIN;    /* minimum chars to wait for */
    Ntty.c_cc[VTIME] = CTIME;   /* minimum wait time    */

#if 1
    /*
    * use this to flush the input buffer before blocking for new input
    */
    #define FLAG TCSAFLUSH
#else
    /*
    * use this to return a char from the current input buffer, or block if
    * no input is waiting.
    */
    #define FLAG TCSANOW

#endif

    if ((error = tcsetattr(0, FLAG, &Ntty)) == 0) {
        error  = read(0, &ch, 1 );        /* get char from stdin */
        error += tcsetattr(0, FLAG, &Otty);   /* restore old settings */
    }

    return (error == 1 ? (int) ch : -1 );
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T06:02:45.580

kbhit() 是非标准的。事实上，我不相信有检测键盘输入的标准功能。您能做的最好的事情是使用例如 fgetc 从标准输入读取一个字符，并希望它不会从其他地方重定向。

# architecture - 什么是 N 层架构？

> ID：312187
> 
> 赞同：195
> 
> 时间：2008-11-23T06:01:05.317
> 
> 标签：architecture, n-tier-architecture, multi-tier

我最近看到很多开发人员的职位发布，其中包含一个或多或少这样的句子：“必须具有 N-Tier 架构的经验”或“必须能够开发 N-Tier 应用程序”。

这让我问，什么是 N-Tier 架构？一个人如何获得经验？

* * *

## 回答 #1

> 赞同：248
> 
> 时间：2008-11-23T06:10:10.837

[维基百科](http://en.wikipedia.org/wiki/Multitier_architecture)：

> 在软件工程中，多层架构（通常称为 n 层架构）是一种客户端-服务器架构，其中表示、应用程序处理和数据管理在逻辑上是独立的过程。例如，使用中间件为用户和数据库之间的数据请求提供服务的应用程序采用多层架构。“多层架构”使用最广泛的指的是三层架构。

什么是“层”是有争议的，但在我看来，它至少需要跨越流程边界。或者它被称为图层。但是，它不需要在物理上不同的机器中。虽然我不推荐它，但您*可以*在同一个盒子上托管逻辑层和数据库。

![替代文字](https://upload.wikimedia.org/wikipedia/en/6/66/Overview_of_a_three-tier_application.png)

**编辑**：一个含义是表示层和逻辑层（有时称为业务逻辑层）需要“跨线”跨越机器边界，有时在不可靠、缓慢和/或不安全的网络上。这与简单的桌面应用程序非常不同，其中数据与文件位于同一台机器上，或者您可以直接访问数据库的 Web 应用程序。

对于 n 层编程，您需要将数据打包成某种称为“数据集”的可传输形式，然后通过网络传输它们。.NET 的[DataSet](http://msdn.microsoft.com/en-us/library/system.data.dataset.aspx)类或[SOAP](http://www.w3.org/TR/soap/)之类的 Web 服务协议是通过网络传输对象的少数尝试。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-23T06:13:25.307

它基于您如何将表示层与核心业务逻辑和数据访问分开（[维基百科](http://en.wikipedia.org/wiki/Front-end_and_back-end)）

*   [三层](http://en.wikipedia.org/wiki/Multitier_architecture)表示表示层+组件层+数据访问层。
*   N 层是在这些层之外添加额外的层，通常是为了额外的模块化、可配置性或与其他系统的互操作性。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-23T06:04:29.100

这是一个流行词，指的是普通的 Web 体系结构，例如 Javascript - ASP.Net - 中间件 - 数据库层。这些东西中的每一个都是一个“层”。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-02-07T14:17:33.613

> N 层数据应用程序是分成多个层的数据应用程序。也称为“分布式应用程序”和“多层应用程序”，n 层应用程序将处理分离为分布在客户端和服务器之间的离散层。当您开发访问数据的应用程序时，您应该清楚地区分构成应用程序的各个层。
> 
> 典型的 n 层应用程序包括表示层、中间层和数据层。在 n 层应用程序中分离各个层的最简单方法是为要包含在应用程序中的每个层创建离散项目。例如，表示层可能是 Windows 窗体应用程序，而数据访问逻辑可能是位于中间层的类库。此外，表示层可能通过服务等服务与中间层中的数据访问逻辑进行通信。将应用程序组件分成不同的层可以提高应用程序的可维护性和可扩展性。它通过更容易地采用新技术来实现这一点，这些新技术可以应用于单个层，而无需重新设计整个解决方案。此外，

取自微软[网站](https://msdn.microsoft.com/en-us/library/bb384398.aspx)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-01-16T16:19:12.000

如果我理解了这个问题，那么在我看来，提问者真的是在问“好的，所以 3 层很好理解，但似乎围绕 4 层或概括地说，N 层架构的意思是。那么......被广泛理解和同意的 N 层定义是什么？

这实际上是一个相当深的问题，为了解释原因，我需要更深入一点。忍受我。

经典的 3 层架构：数据库、“业务逻辑”和表示，是阐明如何遵守关注点分离原则的好方法。也就是说，如果我想改变“业务”想要为客户服务的方式，我不应该查看整个系统来弄清楚如何做到这一点，尤其是决策业务问题不应该分散不顾一切地通过代码。

现在，这个模型已经运行了几十年，它是经典的“客户端-服务器”模型。快进到云产品，其中 Web 浏览器是广泛且物理分布的一组用户的用户界面，通常最终必须添加内容分发服务，这不是经典 3 层架构的一部分（以及需要自行管理）。

这个概念概括了服务、微服务、数据和计算的分布方式等等。某物是否是“层”很大程度上取决于该层是否为该层后面（或下面）的服务提供接口和部署模型。因此，内容分发网络将是一个层，但身份验证服务不会。

现在，带着这个概念去阅读 N 层架构示例的其他描述，你就会开始理解这个问题。其他观点包括基于供应商的方法（例如 NGINX）、内容感知负载平衡器、数据隔离和安全服务（例如 IBM Datapower），所有这些都*可能会或可能不会*为给定的架构、部署和用例增加价值。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-23T06:04:25.140

据我了解，N-Tier 使用单独的物理机将业务逻辑、客户端访问和数据相互分离。理论是其中一个可以独立于其他更新。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-09-22T05:50:44.517

N 层数据应用程序是分成多个层的数据应用程序。也称为“分布式应用程序”和“多层应用程序”，n 层应用程序将处理分离为分布在客户端和服务器之间的离散层。当您开发访问数据的应用程序时，您应该清楚地区分构成应用程序的各个层。

等等[http://msdn.microsoft.com/en-us/library/bb384398.aspx](http://msdn.microsoft.com/en-us/library/bb384398.aspx)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-05-01T19:57:49.423

**在构建通常的 MCV**（一种 3 层架构）时，可以决定使用双层接口来实现 MCV，这样实际上就可以替换特定的层，而无需修改甚至一行代码。

**我们经常看到这样做的好处**，例如在您希望能够使用多个数据库的情况下（在这种情况下，您在控制层和数据层之间有一个双重接口）。

**当你把它放在视图层**（展示）上时，你就可以（等一下！！）用另一台机器替换用户界面，从而自动化真实输入（！！！）——从而你可以运行数千个乏味的可用性测试无需任何用户一次又一次地点击和重新点击并重新点击相同的东西。

有些人将这种具有 1 个或 2 个双接口的**3 层架构描述为****4 层**或**5 层**架构，隐含地暗示了双接口。

其他情况包括（但不限于）您 - 在半复制或完全复制的数据库系统的情况下实际上能够将其中一个数据库视为“主”，因此您将拥有一个层由主数据库组成，另一个由从数据库组成。

***移动示例***

**因此，多层 - 或 N 层**- 确实有一些解释，而我肯定会坚持 3 层 + 额外的层，其中包括楔入其间的薄接口磁盘以启用所述层交换，并且在测试（特别是在移动设备上使用），您现在可以在真实软件上运行用户测试，通过以控制逻辑无法区分真实用户点击的方式**模拟用户点击。****这在模拟真实用户测试**中几乎是最重要的，因为您可以记录来自用户 OTA 的所有输入，然后在进行回归测试时重复使用相同的输入。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-07-03T23:04:12.610

当我们谈论层时，我们通常谈论物理进程（具有不同的内存空间）。

因此，如果应用程序的层部署在不同的进程中，那么这些不同的进程将是不同的层。

> 例如，在 3 层应用程序中，业务层与大型机（独立进程）对话并与报告服务（独立进程）对话，那么该应用程序将是 5 层。

因此，通用名称是 n-tier。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-07-21T02:15:58.973

来自[https://docs.microsoft.com/en-us/azure/architecture/guide/architecture-styles/n-tier](https://docs.microsoft.com/en-us/azure/architecture/guide/architecture-styles/n-tier)

N层架构主要将**应用程序轮胎**划分为**逻辑轮胎**和**物理层**，并将它们划分为子部分。 [![在此处输入图像描述](https://i.stack.imgur.com/rAtGm.png)](https://i.stack.imgur.com/rAtGm.png)

层是一种分离职责和管理依赖关系的方法。每一层都有特定的职责。较高层可以使用较低层中的服务，但反之则不行。

层在物理上是分开的，在不同的机器上运行。一个层可以直接调用另一个层，或者使用异步消息传递（消息队列）。尽管每一层都可能托管在自己的层中，但这不是必需的。多个层可能托管在同一层上。物理分离层提高了可扩展性和弹性，但也增加了额外网络通信的延迟。

传统的三层应用程序具有表示层、中间层和数据库层。中间层是可选的。更复杂的应用程序可以有超过三层。上图显示了一个具有两个中间层的应用程序，封装了不同的功能区域。

N 层应用程序可以具有封闭层架构或开放层架构：

```
In a closed layer architecture, a layer can only call the next layer immediately down.
In an open layer architecture, a layer can call any of the layers below it. 
```

封闭层架构限制了层之间的依赖关系。但是，如果一层只是将请求传递到下一层，它可能会产生不必要的网络流量。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-05-20T11:10:33.843

N 层应用程序是涉及三个以上组件的应用程序。那些组件是什么？

*   缓存
*   异步行为的消息队列
*   负载均衡器
*   用于搜索海量数据的搜索服务器
*   处理海量数据的组件
*   运行异构技术的组件，通常称为 Web 服务等。

所有像 Instagram、Facebook 这样的社交应用程序，像 Uber、Airbnb 这样的大型行业服务，像 Pokemon Go 这样的在线大型多人游戏，具有花哨功能的应用程序都是 n 层应用程序。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-22T13:48:52.470

Martin Fowler 清楚地证明：

分层是软件设计人员用来分解复杂软件系统的最常用技术之一。您可以在机器架构中看到它，其中层从带有操作系统调用的编程语言下降到设备驱动程序和 CPU 指令集，以及芯片内部的逻辑门。网络在 TCP 之上有 FTP，它在 IP 之上，在以太网之上。

当从层的角度考虑系统时，您可以想象软件中的主要子系统以某种形式的层蛋糕排列，其中每一层都位于较低的层上。在这个方案中，高层使用低层定义的各种服务，但低层不知道高层。此外，每一层通常对上层隐藏其较低层，因此第 4 层使用第 3 层的服务，第 3 层使用第 2 层的服务，但第 4 层不知道第 2 层。（并非所有分层架构都像这样不透明，但大多数是——或者更确切地说，大多数是不透明的。）

将系统分解成层有许多重要的好处。

• 您可以将单个层理解为一个连贯的整体，而无需对其他层了解太多。您可以了解如何在 TCP 之上构建 FTP 服务，而无需了解以太网如何工作的细节。

• 您可以用相同基本服务的替代实现来替换层。FTP 服务无需更改即可通过以太网、PPP 或任何有线电视公司使用的方式运行。

• 最小化层之间的依赖关系。如果有线电视公司改变其物理传输系统，只要他们使 IP 工作，我们就不必改变我们的 FTP 服务。

• 图层是标准化的好地方。TCP 和 IP 是标准，因为它们定义了它们的层应该如何操作。

• 一旦您构建了一个层，您就可以将它用于许多更高级别的服务。因此，FTP、telnet、SSH 和 HTTP 使用 TCP/IP。否则，所有这些高级协议都必须编写自己的低级协议。来自凯尔·杰弗里·帕萨雷利图书馆

分层是一项重要的技术，但也有缺点。

• 层很好地封装了一些但不是全部的东西。因此，您有时会得到级联更改。分层企业应用程序中的经典示例是添加一个需要在 UI 上显示的字段，该字段必须在数据库中，因此必须添加到其间的每一层。

• 额外的层会损害性能。在每一层，事物通常都需要从一种表示形式转换为另一种表示形式。但是，底层函数的封装通常会给您带来超过补偿的效率增益。可以优化控制事务的层，然后使一切变得更快。但是分层架构中最难的部分是决定拥有哪些层以及每一层的职责是什么。

# java - 在 Java 中生成分区

> ID：312188
> 
> 赞同：2
> 
> 时间：2008-11-23T06:01:52.397
> 
> 标签：java, set, data-partitioning

我得到一个整数（我们称之为 x），我需要生成一个数组数组，其中每个子数组是一个元素列表，这些元素是给定整数集合中的一个，以及每个子数组的所有元素的总和是 x。数组数组需要包含这种形式的所有可能的不同子数组。

例如，如果 x 是 3 并且可能元素的列表是 {1, 2}，我希望生成 {{1, 2}, {2, 1}}。

执行此操作的最佳方法是什么（在伪代码或 Java 中）？这个二维数组是存储此类数据的最佳方式吗？我想不出比这更好的了，但我猜那里有什么东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T07:02:43.757

对于存储，您可能需要一个 HashSet 的 LinkedList：

```
LinkedList<HashSet<Integer>> l; 
```

对于问题：这是子集问题，它是 NP-Complete，所以我认为没有已知的快速方法可以解决。我没有采用任何优化理论，所以我能做的最好的就是搜索输入的幂集，看看它们的总和是否与输出匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T06:23:20.623

由于您不知道“子数组”的大小，我建议您使用 Java 中的集合之一，例如[`ArrayList<E>`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/ArrayList.html).

# linux - 如何在没有鼠标的情况下从我的 xterm 中复制文本？

> ID：312213
> 
> 赞同：36
> 
> 时间：2008-11-23T06:26:24.017
> 
> 标签：linux, command-line, keyboard, xterm

我想使用从另一个 xterm 中的命令行运行的命令的部分输出，或者作为不同命令的一部分。例如：

```
> grep error error.log
error: can't find file ~/<some very long path>/thisfile 
```

我想这样做：

```
>ls ~/<some very long path>/ 
```

我知道有两种方法可以做到这一点： 1.用鼠标
复制。 2\. 使用/ / / / / /etc... 的某种组合从输出中仅提取我需要的内容，然后在反引号内使用*它。*`~/<some very long path>/`
`head``tail``awk``sed``perl``cut`

 *有没有不使用鼠标复制文本的方法？想到的例子是 VIM 中的可视模式，但我不知道如何在 xterm 中做到这一点。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-23T06:31:15.880

您可以使用 GNU 屏幕的复制和粘贴命令。

快速教程：

1.  打开屏幕：（`screen`或`screen myprog my args here`）
2.  运行你的程序，产生你想要复制的输出
3.  进入复制模式：`Control`+ `a`+`[`
4.  将光标移动到起点
5.  打`Enter`
6.  将光标移动到终点
7.  打`Enter`
8.  粘贴：`Control`+ `a`+`]`

屏幕比这更强大（我用它来标记几个虚拟终端，而不需要特殊的终端模拟器，而且当 X 崩溃或其他东西时我不会失去我的会话）。要离开屏幕，只需结束您的 shell 会话，或键入`Ctrl`+ `a`、`Ctrl`+ `\`。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-25T21:09:08.633

我发现[XSel](http://www.vergenet.net/~conrad/software/xsel/)在类似情况下很有用。它是一个操纵 X 选择的工具。例如，这会将命令的输出存储到剪贴板：

```
grep error error.log | xsel -bi 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-02-25T10:05:34.263

您也可以使用which`tmux`具有[与](https://superuser.com/questions/236158/tmux-vs-screen). `screen`一旦你进入`tmux`并且你有你想要复制的输出，你可以执行以下操作来复制然后粘贴它：

1.  `Ctrl + B`使用,进入复印模式`[`
2.  用箭头键移动光标，然后用`Ctrl + Space`
3.  移动光标选择要复制的文本/区域，然后复制`Alt + W`（这将立即退出复制模式）
4.  您现在可以粘贴（`tmux`仅在内部）使用`Ctrl + B`，`]`

这些说明假定启用*了 emacs*键绑定。对于*vi*绑定，请参阅此[比较](https://superuser.com/a/197272)或按照[此](https://awhan.wordpress.com/2010/06/20/copy-paste-in-tmux/)分步指南进行操作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T07:03:57.093

OP 说他不想这样做，但这里有一种 unix utils 方法可以为后代做这件事。如果您学习了这些小的 unix 实用程序，它们会非常强大。

> ls $( 目录名 $( grep 错误 error.log | head -1 | cut -d " " -f 5- ) )

注意：记忆中的语法

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T20:19:47.593

您可以使用 xterm 设备号将输出直接发送到相关 xterm。这是命令。

```
xyz$ls /home/ankit/documents/etc/x/y/z > /dev/pts/0 
```

（或 waterever 是设备名称，您可以使用命令 'w' 打开 xterm 来获取它）

试试看，希望这可以解决您的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-04-12T19:35:47.467

最简单的方法是使用`byobu`which uses one `tmux`or `screen`in the background。它是一个包装工具，使使用`screen`或`tmux`方式更高效、快速和简单。因此，它也使得复制 n 粘贴变得非常简单。
一旦你进入`byobu`并且你有你想要复制的输出，你可以执行以下操作来复制然后粘贴它：

1.  按 进入滚动模式`F7`。此模式允许在先前命令的输出或文本编辑器的正文中使用箭头键或`PageUp`和键上下滚动。`PageDown`
2.  使用箭头键将光标移动到您要开始复制的位置。
3.  按下并释放`Space`栏。
4.  移动光标选择要复制的文本/区域（这看起来非常类似于 vim VISUAL 模式）
5.  按复制`Enter`（这将立即退出滚动模式和复制模式）
6.  您现在可以使用粘贴`Alt + Insert`（仅在`byobu`默认情况下，但您可以通过安装 xclip 并在 byobu 中进行一些设置来扩展启用粘贴的应用程序 -> 观看[终端多路复用器简介 - 第 2 部分](https://www.youtube.com/watch?v=2sD5zlW8a5E&t=1058s)，大约从第 42 分钟到第 48 分钟）

# ruby - 如何从 Capistrano 运行 rake 任务？

> ID：312214
> 
> 赞同：108
> 
> 时间：2008-11-23T06:28:55.713
> 
> 标签：ruby, rake, capistrano

我已经有一个 deploy.rb 可以在我的生产服务器上部署我的应用程序。

我的应用程序包含一个自定义 rake 任务（lib/tasks 目录中的 .rake 文件）。

我想创建一个将远程运行该 rake 任务的上限任务。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2010-02-03T13:12:35.697

更明确一点，在您的`\config\deploy.rb`, 添加任何任务或命名空间之外：

```
namespace :rake do  
  desc "Run a task on a remote server."  
  # run like: cap staging rake:invoke task=a_certain_task  
  task :invoke do  
    run("cd #{deploy_to}/current; /usr/bin/env rake #{ENV['task']} RAILS_ENV=#{rails_env}")  
  end  
end 
```

然后，从`/rails_root/`，您可以运行：

```
cap staging rake:invoke task=rebuild_table_abc 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2014-03-06T19:29:28.123

**Capistrano 3 通用版本**（运行任何 rake 任务）

构建 Mirek Rusin 答案的通用版本：

```
desc 'Invoke a rake command on the remote server'
task :invoke, [:command] => 'deploy:set_rails_env' do |task, args|
  on primary(:app) do
    within current_path do
      with :rails_env => fetch(:rails_env) do
        rake args[:command]
      end
    end
  end
end 
```

示例用法：`cap staging "invoke[db:migrate]"`

请注意，`deploy:set_rails_env`需要来自 capistrano-rails gem

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2013-12-10T21:59:34.560

……几年后……

看看 capistrano 的 rails 插件，你可以在[https://github.com/capistrano/rails/blob/master/lib/capistrano/tasks/migrations.rake#L5-L14](https://github.com/capistrano/rails/blob/master/lib/capistrano/tasks/migrations.rake#L5-L14)看到它看起来像：

```
desc 'Runs rake db:migrate if migrations are set'
task :migrate => [:set_rails_env] do
  on primary fetch(:migration_role) do
    within release_path do
      with rails_env: fetch(:rails_env) do
        execute :rake, "db:migrate"
      end
    end
  end
end 
```

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2008-11-23T06:46:08.080

```
run("cd #{deploy_to}/current && /usr/bin/env rake `<task_name>` RAILS_ENV=production") 
```

用谷歌找到它——http: [//ananelson.com/said/on/2007/12/30/remote-rake-tasks-with-capistrano/](http://ananelson.com/said/on/2007/12/30/remote-rake-tasks-with-capistrano/)

这`RAILS_ENV=production`是一个陷阱——我一开始并没有想到它，也无法弄清楚为什么任务没有做任何事情。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2012-05-08T01:37:32.910

## 使用 Capistrano 风格的 rake 调用

有一种通用的方式可以“正常工作”`require 'bundler/capistrano'`以及修改 rake 的其他扩展。如果您使用多阶段，这也适用于预生产环境。要旨？如果可以，请使用配置变量。

```
desc "Run the super-awesome rake task"
task :super_awesome do
  rake = fetch(:rake, 'rake')
  rails_env = fetch(:rails_env, 'production')

  run "cd '#{current_path}' && #{rake} super_awesome RAILS_ENV=#{rails_env}"
end 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2016-03-31T10:58:18.700

## 使用[`capistrano-rake`](https://github.com/sheharyarn/capistrano-rake)宝石

只需安装 gem 而不会弄乱自定义 capistrano 配方并在远程服务器上执行所需的 rake 任务，如下所示：

```
cap production invoke:rake TASK=my:rake_task 
```

*全面披露：我写的*

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-08-29T11:52:05.223

我个人在生产中使用这样的辅助方法：

```
def run_rake(task, options={}, &block)
  command = "cd #{latest_release} && /usr/bin/env bundle exec rake #{task}"
  run(command, options, &block)
end 
```

这允许运行类似于使用运行（命令）方法的 rake 任务。

* * *

注意：这类似于[杜克](https://stackoverflow.com/questions/312214/how-do-i-run-a-rake-task-from-capistrano/6351396#6351396)提出的建议，但我：

*   使用 latest_release 而不是 current_release - 根据我的经验，运行 rake 命令时它更符合您的期望；
*   遵循 Rake 和 Capistrano 的命名约定（而不是：cmd -> task 和 rake -> run_rake）
*   不要设置 RAILS_ENV=#{​​rails_env} 因为设置它的正确位置是 default_run_options 变量。例如 default_run_options[:env] = {'RAILS_ENV' => 'production'} # -> DRY！

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-01-30T02:04:17.590

有一个有趣的 gem [cape](https://github.com/njonsson/cape)可以让你的 rake 任务作为 Capistrano 任务可用，所以你可以远程运行它们。`cape`有据可查，但这里是关于如何设置 i 的简短概述。

安装 gem 后，只需将其添加到您的`config/deploy.rb`文件中。

```
# config/deploy.rb
require 'cape'
Cape do
  # Create Capistrano recipes for all Rake tasks.
  mirror_rake_tasks
end 
```

现在，您可以`rake`通过`cap`.

作为额外的奖励，`cape`让您设置您希望如何在本地和远程运行您的 rake 任务（不再`bundle exec rake`），只需将其添加到您的`config/deploy.rb`文件中：

```
# Configure Cape to execute Rake via Bundler, both locally and remotely.
Cape.local_rake_executable  = '/usr/bin/env bundle exec rake'
Cape.remote_rake_executable = '/usr/bin/env bundle exec rake' 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-12-06T14:13:29.617

```
namespace :rake_task do
  task :invoke do
    if ENV['COMMAND'].to_s.strip == ''
      puts "USAGE: cap rake_task:invoke COMMAND='db:migrate'" 
    else
      run "cd #{current_path} && RAILS_ENV=production rake #{ENV['COMMAND']}"
    end
  end                           
end 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-12-23T07:18:00.377

这对我有用：

```
task :invoke, :command do |task, args|
  on roles(:app) do
    within current_path do
      with rails_env: fetch(:rails_env) do
        execute :rake, args[:command]
      end
    end
  end
end 
```

然后简单地运行`cap production "invoke[task_name]"`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-06-14T23:31:34.070

这是我放入 deploy.rb 以简化运行 rake 任务的内容。它是 capistrano 的 run() 方法的简单包装。

```
def rake(cmd, options={}, &block)
  command = "cd #{current_release} && /usr/bin/env bundle exec rake #{cmd} RAILS_ENV=#{rails_env}"
  run(command, options, &block)
end 
```

然后我像这样运行任何 rake 任务：

```
rake 'app:compile:jammit' 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-07-26T17:22:38.710

这也有效：

```
run("cd #{release_path}/current && /usr/bin/rake <rake_task_name>", :env => {'RAILS_ENV' => rails_env}) 
```

更多信息：[Capistrano Run](https://github.com/capistrano/capistrano/wiki/2.x-DSL-Action-Invocation-Run)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-07-04T06:33:03.760

其中大部分来自[上面的答案](https://stackoverflow.com/questions/312214/how-do-i-run-a-rake-task-from-capistrano/#10491397)，并略微增强了从 capistrano 运行任何 rake 任务

从 capistrano 运行任何 rake 任务

```
$ cap rake -s rake_task=$rake_task

# Capfile     
task :rake do
  rake = fetch(:rake, 'rake')
  rails_env = fetch(:rails_env, 'production')

  run "cd '#{current_path}' && #{rake} #{rake_task} RAILS_ENV=#{rails_env}"
end 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-09-24T01:21:34.127

如果您希望能够传递多个参数，请尝试以下操作（基于 marinosbern 的回答）：

```
task :invoke, [:command] => 'deploy:set_rails_env' do |task, args|
  on primary(:app) do
    within current_path do
      with :rails_env => fetch(:rails_env) do
        execute :rake, "#{args.command}[#{args.extras.join(",")}]"
      end
    end
  end
end 
```

然后你可以像这样运行一个任务：`cap production invoke["task","arg1","arg2"]`

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-09-13T14:37:33.753

以前的答案对我没有帮助，我发现了这个：来自[http://kenglish.co/run-rake-tasks-on-the-server-with-capistrano-3-and-rbenv/](http://kenglish.co/run-rake-tasks-on-the-server-with-capistrano-3-and-rbenv/)

```
namespace :deploy do
  # ....
  # @example
  #   bundle exec cap uat deploy:invoke task=users:update_defaults
  desc 'Invoke rake task on the server'
  task :invoke do
    fail 'no task provided' unless ENV['task']

    on roles(:app) do
      within release_path do
        with rails_env: fetch(:rails_env) do
          execute :rake, ENV['task']
        end
      end
    end
  end

end 
```

运行你的任务使用

```
bundle exec cap uat deploy:invoke task=users:update_defaults 
```

也许它对某人有用

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-05-12T00:44:34.980

所以我一直在努力。它看起来运作良好。但是，您需要一个格式化程序才能真正利用代码。

如果您不想使用格式化程序，只需将日志级别设置为调试模式。这些 semas 到 h

```
SSHKit.config.output_verbosity = Logger::DEBUG 
```

# 帽子的东西

```
namespace :invoke do
  desc 'Run a bash task on a remote server. cap environment invoke:bash[\'ls -la\'] '
  task :bash, :execute do |_task, args|
    on roles(:app), in: :sequence do
      SSHKit.config.format = :supersimple
      execute args[:execute]
    end
  end

  desc 'Run a rake task on a remote server. cap environment invoke:rake[\'db:migrate\'] '
  task :rake, :task do |_task, args|
    on primary :app do
      within current_path do
        with rails_env: fetch(:rails_env) do
          SSHKit.config.format = :supersimple
          rake args[:task]
        end
      end
    end
  end
end 
```

这是我为使用上面的代码而构建的格式化程序。它基于 sshkit 中内置的 :textsimple，但它不是调用自定义任务的好方法。哦，这很多不适用于最新版本的 sshkit gem。我知道它适用于 1.7.1。我这样说是因为主分支更改了可用的 SSHKit::Command 方法。

```
module SSHKit
  module Formatter
    class SuperSimple < SSHKit::Formatter::Abstract
      def write(obj)
        case obj
        when SSHKit::Command    then write_command(obj)
        when SSHKit::LogMessage then write_log_message(obj)
        end
      end
      alias :<< :write

      private

      def write_command(command)
        unless command.started? && SSHKit.config.output_verbosity == Logger::DEBUG
          original_output << "Running #{String(command)} #{command.host.user ? "as #{command.host.user}@" : "on "}#{command.host}\n"
          if SSHKit.config.output_verbosity == Logger::DEBUG
            original_output << "Command: #{command.to_command}" + "\n"
          end
        end

        unless command.stdout.empty?
          command.stdout.lines.each do |line|
            original_output << line
            original_output << "\n" unless line[-1] == "\n"
          end
        end

        unless command.stderr.empty?
          command.stderr.lines.each do |line|
            original_output << line
            original_output << "\n" unless line[-1] == "\n"
          end
        end

      end

      def write_log_message(log_message)
        original_output << log_message.to_s + "\n"
      end
    end
  end
end 
```

# cocoa-touch - 将两个 UIImageView 旋转 360 度

> ID：312226
> 
> 赞同：1
> 
> 时间：2008-11-23T06:44:53.200
> 
> 标签：cocoa-touch

我一直在尝试有两个固定大小的 UIImageviews，上面有图像（覆盖所有视图），但我一直在努力（我放弃！）以圆形方式旋转它们中的每一个。因此，如果我有一个 UIView，另一个紧挨着它，我希望能够跟随它旋转第一个（以及另一个立即，没有间隙），并以 360 度的方式旋转，它只是不可能的！

任何人都可以帮助我吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T01:28:47.473

我编写的第一批 iPhone 代码中有一次是显示一个由树叶制成的时钟。

时钟由三片叶子（小时、分钟和秒）创建，我们有一个叶子图像，用不同的缩放比例、不透明度等绘制，以呈现时钟的外观。

下面的 UIView 在视图的中心绘制了一个时钟，使用平移和缩放将叶子放在正确的位置。CTM 被保存和恢复以保存重复的翻译。

您可能想看看它是否有助于您处理坐标系和旋转。

```
- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) 
    {
        // Initialization code
        self.minutes = 49;
        self.seconds = 0;

        // clear to transparent
        self.clearsContextBeforeDrawing = YES;
        self.backgroundColor = [UIColor clearColor];

        [self tick:nil];
    }
    return self;
}

- (void)tick:(NSTimer *)timer
{
    // get time
    NSDate * time = [NSDate date];
    NSCalendar * gregorian = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];
    NSDateComponents * comp = [gregorian components:NSHourCalendarUnit|NSMinuteCalendarUnit|NSSecondCalendarUnit fromDate:time];

    // update the time
    self.seconds = [comp second];
    self.minutes = [comp minute];
    self.hours = [comp hour];

    // redisplay
    [self setNeedsDisplay];
}

- (float)toRadians:(float)deg
{
    return deg * 3.14/180.0;
}

- (void)drawClock:(CGPoint)pos hours:(NSInteger)theHours minutes:(NSInteger)theMinutes seconds:(NSInteger)theSeconds
{
    UIImage * leaf = [UIImage imageNamed:@"leaf.png"];

    // context
    CGContextRef myContext = UIGraphicsGetCurrentContext();

    // save original state
    CGContextSaveGState(myContext);

    // set alpha and move it to centre of clock
    CGContextSetAlpha(myContext, 0.8);
    CGContextTranslateCTM (myContext, pos.x, pos.y);

    // save centred state
    CGContextSaveGState(myContext);

    // rotate and translate the hour 'hand'
    CGContextRotateCTM (myContext, [self toRadians:(theHours-3.0+theMinutes/60.0)*360/12.0 - 10] );
    CGContextTranslateCTM (myContext, -5, -[leaf size].height/12);

    // draw the hour hand and restore to translated
    CGContextDrawImage(myContext, CGRectMake(0, 0, [leaf size].width/6, [leaf size].height/6), [leaf CGImage]);

    // restore centred state and resave
    CGContextRestoreGState(myContext);
    CGContextSaveGState(myContext);

    // rotate and transform the minute 'hand'
    CGContextRotateCTM (myContext, [self toRadians:((theMinutes-15)*360.0 /60.0) - 10]);
    CGContextTranslateCTM (myContext, -5, -[leaf size].height/10);

    // draw the minute hand and restore original context
    CGContextDrawImage(myContext, CGRectMake(0, 0, [leaf size].width/5, [leaf size].height/5), [leaf CGImage]);

    // restore centred state
    CGContextRestoreGState(myContext);

    // rotate and transform the second 'hand'
    CGContextSetAlpha(myContext, 0.5);
    CGContextRotateCTM (myContext, [self toRadians:((theSeconds-15)*360 /60.0) - 10]);
    CGContextTranslateCTM (myContext, -5, -[leaf size].height/10);

    // draw the second hand and restore original context
    CGContextDrawImage(myContext, CGRectMake(0, 0, [leaf size].width/5, [leaf size].height/5), [leaf CGImage]);
    CGContextRestoreGState(myContext);
}

- (void)drawRect:(CGRect)rect
{
    // draw clock in clock view
    [self drawClock:CGPointMake(rect.size.width/2,rect.size.height/2) hours:self.hours minutes:self.minutes seconds:self.seconds];

    // test code for centering hands
//  [self drawClock:CGPointMake(rect.size.width/2,rect.size.height/2) hours:12 minutes:00 seconds:00];
} 
```

# pdf - PDF 文件的正确 MIME 媒体类型

> ID：312230
> 
> 赞同：1393
> 
> 时间：2008-11-23T06:49:08.497
> 
> 标签：pdf, http-headers, content-type, mime

在处理 PDF 时，我遇到过 MIME 类型`application/pdf`等`application/x-pdf`。

这两种类型之间有区别吗？如果有，那是什么？一个比另一个更受欢迎吗？

我正在开发一个必须提供大量 PDF 的网络应用程序，如果有的话，我想以正确的方式进行操作。

* * *

## 回答 #1

> 赞同：1829
> 
> 时间：2008-11-23T07:22:44.950

标准媒体类型（以前称为 MIME 类型）是`application/pdf`. 分配在[RFC 3778 中定义，应用程序/pdf 媒体类型](http://www.rfc-editor.org/rfc/rfc3778.txt "RFC 3778")，引用自[媒体类型注册表](http://www.iana.org/assignments/media-types/ "IANA |  MIME 媒体类型")。

媒体类型由标准机构[Internet 号码分配机构](http://www.iana.org/ "IANA")(IANA) 控制。这是管理根名称服务器和 IP 地址空间的同一组织。

使用`x-pdf`早于 PDF 媒体类型的标准化。命名空间中的媒体类型`x-`被认为是实验性的，就像命名空间中的媒体类型被认为`vnd.`是特定于供应商的一样。`x-pdf`可能用于与旧软件的兼容性。

* * *

## 回答 #2

> 赞同：162
> 
> 时间：2010-12-29T12:13:22.453

这是[RFC 2045 - Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Body](https://www.rfc-editor.org/rfc/rfc2045#section-5.1 "RFC 2045 - 多用途 Internet 邮件扩展 (MIME) 第 1 部分：Internet 消息正文的格式 - 第 5.1 节：Content-Type 标头字段的语法")中定义的约定。

> 1.  私有*[子类型]*值（以“X-”开头）可以在两个合作代理之间双边定义，无需外部注册或标准化。此类值无法注册或标准化。
>     
>     
> 2.  新标准值应按照[RFC 2048](https://www.rfc-editor.org/rfc/rfc2048)中的说明向 IANA 注册。

类似的限制适用于顶级类型。来自同一来源，

> 如果出于任何原因要使用其他顶级类型，则必须为其命名以“X-”开头，以表明其非标准状态并避免与未来的正式名称发生潜在冲突。

*（请注意，根据 RFC 2045，“[m] 媒体类型和子类型的匹配始终不区分大小写”，因此“X-”和“x-”的解释没有区别。）*

因此可以公平地猜测，在 IANA 定义“application/foo”之前使用了“application/x-foo”。不知道 IANA 令牌分配的人可能仍会使用它。

正如 Chris Hanson 所说，MIME 类型由 IANA 控制。这在[RFC 2048 - Multipurpose Internet Mail Extensions (MIME) Part 4: Registration Procedures](https://www.rfc-editor.org/rfc/rfc2048 "RFC 2048 - Internet 邮件扩展 (MIME) 第四部分：注册程序")中有详细说明。根据[IANA 引用的](http://www.iana.org/assignments/media-types/application/ "IANA - 应用程序媒体类型")RFC [3778](https://www.rfc-editor.org/rfc/rfc3778#section-2 "RFC 3778：应用程序/pdf 媒体类型 - 第 2 节：历史")作为“应用程序/pdf”的定义，

> application/pdf 媒体类型由 Paul Lindner 于 1993 年首次注册，供 gopher 协议使用；随后，Steve Zilles 于 1994 年对注册进行了更新。

“application/pdf”类型已经存在了十多年。所以在我看来，在新应用程序中使用“application/x-pdf”的地方，这个决定可能不是经过深思熟虑的。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2015-12-14T08:31:27.367

来自维基百科媒体类型，

> 媒体类型由类型、子类型和可选参数组成。例如，一个 HTML 文件可能被指定为 text/html；字符集=UTF-8。
> 
> 媒体类型由顶级类型名称和子类型名称组成，并进一步构造成所谓的“树”。

```
top-level type name / subtype name [ ; parameters ]

top-level type name / [ tree. ] subtype name [ +suffix ] [ ; parameters ] 
```

所有媒体类型都应使用 IANA 注册程序进行注册。当前创建了以下树：`standard`, `vendor`,`personal`或`vanity`, 未注册`x.`

**标准：**

> 标准树中的媒体类型不使用任何树方面（前缀）。

```
type / media type name [+suffix] 
```

示例：“应用程序/xhtml+xml”、“图像/png”

**小贩：**

> 供应商树用于与公开可用产品相关的媒体类型。它使用`vnd.`刻面。

```
type / vnd. media type name [+suffix] - used in the case of well-known producer

type / vnd. producer's name followed by media type name [+suffix] - producer's name must be approved by IANA

type / vnd. producer's name followed by product's name [+suffix] - producer's name must be approved by IANA 
```

**个人或虚荣树：**

> 个人或名利树包括实验性创建的媒体类型或作为非商业发行的产品的一部分。它使用 `prs.`刻面。

```
type / prs. media type name [+suffix] 
```

**未注册的 x。树：**

> “x”。tree 可用于专门用于私人、本地环境的媒体类型，并且只有在交换双方的积极同意下才能使用。无法注册此树中的类型。
> 
> 根据 RFC 6838 的先前版本 - 已过时的 RFC 2048（1996 年 11 月发布）**，如果有的话，应该很少需要使用未注册的实验类型，因此同时使用“x-”和“x”。不鼓励表格**。该 RFC 的先前版本 - RFC 1590 和 RFC 1521 声明子类型名称使用“x-”符号可用于未注册和私有子类型，但该建议在 1996 年 11 月被废弃。

```
type / x. media type name [+suffix] 
```

所以很明显，标准类型的 MIME 类型`application/pdf`是适合使用的类型，而您应该避免使用[RFC 2048](https://www.rfc-editor.org/rfc/rfc2048)和[RFC 6838](https://www.rfc-editor.org/rfc/rfc6838)`x-`中所述的过时和未注册的媒体类型。

# debugging - 如何使用 Firebug 调试 JavaScript？

> ID：312234
> 
> 赞同：2
> 
> 时间：2008-11-23T06:59:36.370
> 
> 标签：debugging, firebug

我似乎无法使用 Firebug 调试我的 JavaScript 代码。播放按钮是灰色的。我使用 FireFox 3.0.4 和 Firebug 1.2.1。

是否有任何已知问题？

这是我要调试的脚本：

（断点设置 on`<img onclick>`和 function `say()`），代码执行良好。

```
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <script type="text/javascript" src="jquery/jquery-1.2.6"></script>
        <script type="text/javascript">
            function say(text){
                alert(text);
            }
        </script>
        <title>DOM Level 0 Event Handlers</title>
    </head>
    <body>
        <img onclick="say('Vroom vroom');" id="vstar" src="vstar.jpg" alt="vstar" />
        <div id="console"></div>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T08:16:47.273

检查您是否在控制台中启用了“支持脚本调试”。出于性能原因，它默认禁用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T07:07:00.067

如果我忘记设置断点，或者我在未执行的地方设置了断点，我通常会看到这种行为（因此执行永远不会停止，所以播放按钮永远不会做任何事情）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T20:52:09.340

您需要关闭所有 Firefox 实例并重新打开。Firefox 具有共享内存，因此您无法打开新页面。

# javascript - 不同浏览器的 document.body.offsetWidth 变化

> ID：312244
> 
> 赞同：2
> 
> 时间：2008-11-23T07:08:41.750
> 
> 标签：javascript, html

document.body.offsetWidth 返回 Firefox 中从左侧到垂直滚动条左侧的内部宽度值。在 IE 中它不会，而是从垂直滚动条的左侧返回到右侧。有谁知道一种明智的方法，我可以制作一个可验证的，例如“var = offsetw;” 为了让 offsetw 成为滚动条宽度，我需要减去以获得像 document.body.innerWidth 一样的 firefox 值？这就是我所拥有的。

```
if (parseInt(navigator.appVersion)>3) {
    if (navigator.appName=="Netscape") {
        winW = 16;
        winH = 16;
    }
    if (navigator.appName.indexOf("Microsoft")!=-1) {
        winW = 20;
        winH = 20;
    }
    if (navigator.appName.indexOf("Mozilla")!=-1){
        winW = 0;
        winH = 0;
    }
} 
```

Firefox 当前使用 16 值而不是 Mozilla 行声明的零，这表明它是错误的。

只有当这些浏览器不自动从 document.body.offsetWidth 中减去滚动条时，我才会添加或修复以使每个浏览器的 winW 和 winH 滚动条的正确大小

谢谢 ：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T12:41:39.550

> document.body.offsetWidth 返回 Firefox 中从左侧到垂直滚动条左侧的内部宽度值。

对我来说不是，它返回与 IE、Opera、Konqueror 和 Safari 相同的值。示例代码？

通过 appName 嗅探浏览器在最好的情况下是非常不可靠的，并且在这种情况下无论如何都不会涵盖它，因为滚动条的大小受操作系统和用户偏好的影响比浏览器更多。

相反，如果您想读取“内部尺寸”，请使用 clientWidth/clientHeight 而不是 offsetWidth/offsetHeight，或者使用滚动条测量块内的块的 offsetWidth。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T11:42:00.607

您是否尝试过 javascript 库？这是摆脱这些问题的最简单方法。我推荐：jquery 或 YUI（Yahoo 用户界面），其中所有内容都封装在类中，使代码几乎兼容所有浏览器。

除了这个考虑，在下面的页面中你可以找到一个知道滚动条宽度的函数（我没有测试过）：

[http://www.alexandre-gomes.com/?p=115](http://www.alexandre-gomes.com/?p=115)

[http://javascript.jstruebig.de/javascript/70/](http://javascript.jstruebig.de/javascript/70/)

代码是这样的（我不知道它是否兼容所有浏览器）：

```
function scrollbarWidth() {

    // Scrollbalken im Body ausschalten

    document.body.style.overflow = 'hidden';

    var width = document.body.clientWidth;

    // Scrollbalken

    document.body.style.overflow = 'scroll';

    width -= document.body.clientWidth;

    // Der IE im Standardmode

    if(!width) width = document.body.offsetWidth-document.body.clientWidth;

    // urspr?ngliche Einstellungen

    document.body.style.overflow = '';

    return width;

} 
```

# c++ - C++ 中的“string”、“stream”和“stringstream”类是什么？

> ID：312245
> 
> 赞同：13
> 
> 时间：2008-11-23T07:08:52.950
> 
> 标签：c++, stl

我想知道c++中的string和stream有什么区别，stringstream是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-23T08:38:50.663

*   `istream`和`ostream`：流数据的接口（文件、套接字等）
*   [`istringstream`](http://www.cplusplus.com/reference/iostream/istringstream/istringstream.html):`istream`包装字符串并提供其内容的
*   [`ostringstream`](http://www.cplusplus.com/reference/iostream/ostringstream/ostringstream.html):`ostream`将写入的内容保存为字符串

例子：

```
istringstream datastream("1 2 3");

int val;
datastream >> val;
cout << val << endl; // prints 1

datastream >> val;
cout << val << endl; // prints 2

datastream >> val;
cout << val << endl; // prints 3

ostringstream outstream;
outstream << 1 << "+" << 2 << "=" << 3;
cout << outstream.str() << endl; // prints "1+2=3" 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-23T07:18:44.210

非常非正式地：字符串是字符的集合，流是操纵移动数据的工具。字符串流是一个 c++ 类，它允许您使用字符串作为流数据的源和目标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T07:39:02.593

我的猜测是 stringstream 就像一个 iostream，但不是写入或读取文件，而是写入或读取字符串。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T08:50:36.380

在 C 和/或 Unix 中，基本的隐喻是文件。标准输出、标准输入、网络套接字都使用文件描述符表示。因此，您可以使用`fprintf()`写入这些“文件”而不知道下面的内容。

作为一种更安全、更酷的替代方案，C++ 将[iostream](http://www.cplusplus.com/reference/iostream/)作为基本隐喻，几乎内置于使用`<<`运算符的语言中。同样，可以使用流访问文件、字符串和（带有库）网络，而无需知道它是什么。

# security - 是否有任何安全电子邮件选项？

> ID：312254
> 
> 赞同：0
> 
> 时间：2008-11-23T07:17:37.503
> 
> 标签：security, email

是否有任何好的且易于使用的选项来发送安全电子邮件？为什么这不常见？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T07:24:26.193

SMTP 具有支持大多数供应商支持的加密的扩展。接收服务器需要有证书（不是发送方）。因此，将出站邮件中继配置为坚持加密连接并验证证书通常会做到这一点。

如果要对最终用户进行加密，S/MIME 或 GPG 是两个主要选项。S/MIME 支持内置于邮件客户端 MS Outlook、Thunderbird 和其他一些客户端中。

但是，证书管理仍然存在一个重大问题，这在大多数情况下都是令人头疼的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T07:25:24.257

[GnuPG](http://www.gnupg.org/)可能是你最好的选择。它得到了广泛的支持和良好的测试。

# python - 有效的键盘输入处理

> ID：312263
> 
> 赞同：9
> 
> 时间：2008-11-23T07:26:06.767
> 
> 标签：python, user-interface, keyboard, user-input, interactive

什么是实现键盘处理的好方法？在我编写键盘交互程序（例如俄罗斯方块游戏）的任何语言中，我最终都会得到一些如下所示的代码：

```
for event in pygame.event.get():
    if event.type == KEYDOWN:
        if False: pass          #make everything an elif
        elif rotating: pass
        elif event.key == K_q:
        elif event.key == K_e:
        elif event.key == K_LEFT:
            curpiece.shift(-1, 0)
            shadowpiece = curpiece.clone(); setupshadow(shadowpiece)
        elif event.key == K_RIGHT:
            curpiece.shift(1, 0)
            shadowpiece = curpiece.clone(); setupshadow(shadowpiece) 
```

（缩短）。我不喜欢这样，因为它必须进入我的主循环，并且它与程序的所有部分都混淆了。这也使得不可能有一个用户配置屏幕，他们可以在其中更改哪些键映射到哪些操作。有没有使用某种形式的函数回调来做到这一点的好模式？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-23T07:32:57.723

您可以创建一个字典，其中键是输入，值是处理按键的函数：

```
def handle_quit():
  quit()

def handle_left():
    curpiece.shift(-1, 0)
    shadowpiece = curpiece.clone(); setupshadow(shadowpiece)

def handle_right():
    curpiece.shift(1, 0)
    shadowpiece = curpiece.clone(); setupshadow(shadowpiece)

def handle_pause():
    if not paused:
        paused = True

branch = {
  K_q: handle_quit
  K_e: handle_pause
  K_LEFT: handle_left
  K_RIGHT: handle_right
}

for event in pygame.event.get():
    if event.type == KEYDOWN:
        branch[event.key]() 
```

然后更改键是修改字典键的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T20:03:50.483

除了[superjoe30的回答](https://stackoverflow.com/questions/312263/effective-keyboard-input-handling#312270)，还可以使用两级映射（两本词典）

*   键 => 命令字符串
*   命令字符串 => 函数

我认为这将使允许用户定义的映射更容易。也就是说，用户可以将他们的键映射到“命令”而不是“函数的名称”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-24T12:05:58.793

我现在做的是有某种输入收集类/函数/线程，它将检查预定义的键->事件绑定列表。

像这样的东西：

```
class InputHandler:
    def __init__ (self, eventDispatcher):
        self.keys = {}
        self.eventDispatcher = eventDispatcher
    def add_key_binding (self, key, event):
        self.keys.update((key, event,))
    def gather_input (self):
        for event in pygame.event.get():
            if event.type == KEYDOWN:
                event = self.keys.get(event.key, None)
                if not event is None:
                    self.eventDispatcher.dispatch(event)

....
inputHandler = InputHandler(EventDispatcher)
inputHandler.add_key_binding(K_q, "quit_event")
...
inputHandler.gather_input()
.... 
```

这基本上就是 superjoe30 正在做的事情，只是我没有直接调用回调，而是通过使用事件调度系统添加了另一个级别的分离，以便任何关心被按下的键的代码都只需侦听该事件。

此外，键可以轻松绑定到不同的事件，可以从配置文件或其他内容中读取，并且任何未绑定到事件的键都将被忽略。

# sql - 在涉及“日期范围”和“订单 ID”的大表中查询的推荐索引

> ID：312273
> 
> 赞同：1
> 
> 时间：2008-11-23T07:38:49.583
> 
> 标签：sql, sql-server, indexing

我有一个查询（由 LINQ to SQL 创建）来获取在某个日期范围内进行的“站点访问”列表，这些日期范围导致了订单（orderid 不为空）。

查询没有问题。我只需要有关为其创建正确索引的建议。我在生产站点上尝试不同的组合并设法搞砸了，以至于外键断开连接。在一些恐慌之后，我修复了这个问题 - 但我想我现在会在重新创建索引之前征求意见。

该表接近一百万行，我需要索引来帮助我。此查询仅用于报告，因此不必非常快，只是不要延迟其他用户的查询（它正在这样做）。

```
SELECT TOP 1000
  t0.SiteVisitId, t0.OrderId, t0.Date, 
  t1.Domain, t0.Referer, t0.CampaignId
FROM 
  SiteVisit AS t0
  LEFT OUTER JOIN KnownReferer AS t1 ON t1.KnownRefererId = t0.KnownRefererId
WHERE
  t0.Date <= @p0 
  AND t0.Date >= @p1
  AND t0.OrderId IS NOT NULL
ORDER BY 
  t0.Date DESC

@p0='2008-11-1 23:59:59:000', @p1='2008-10-1 00:00:00:000' 
```

我目前有一个聚集索引`SiteVisitId`，这是我的身份整数列。

我不知道以下哪个最有可能是最有效的：

*   创建索引`Date`
*   创建一个索引`Date`和一个单独的索引`OrderId`
*   `Date`在AND上创建“多列”索引`OrderId`
*   其他组合？

我还想知道是否应该创建一个单独的位列，`hasOrder`而不是检查`OrderId IS NOT NULL`这是否更有效。

仅供参考：KnownReferer 只是一个包含 100 个左右已知 HttpReferer 列表的表格，因此我可以轻松查看来自 google、yahoo 等的点击量。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T08:34:48.703

您希望在典型日期范围之间有多少行？您通常一次看一个月吗？

我将从`[Date]`列上的索引开始。如果对于典型的查询，结果行数很小，则不需要将该`[OrderId]`列添加到索引中。

另一方面，如果您在一个典型的月份中有大量行，那么您可以将该`[OrderId]`列添加到索引中，但由于它被视为布尔值，它可能不会给您带来太多收益。`NULL`这取决于vs有多少行`NOT NULL`。如果给定月份有很多行，但只有少数行有效`[OrderId]`，那么索引可能会提高性能。

阅读此相关问题中接受的答案，并确定是否值得对附加列进行索引：

[我应该在 SQL Server 中索引一个位字段吗？](https://stackoverflow.com/questions/231125/should-i-index-a-bit-field-in-sql-server)

当然，测试索引以及使用**和不**使用索引生成的计划。

**更新：**其他一些答案指定了更积极的索引，这应该会提高此查询的性能，但可能会对表上的其他操作产生不利影响。例如，建议的覆盖索引将允许 SQL Server 处理此查询而对实际表的影响很小，但是当其他查询写入实际表时可能会导致问题（因为 SQL Server 需要同时更新表和覆盖索引）这种情况）。

因为这是一个报告查询，所以我会尽可能少地优化它。如果这个查询运行时间很长，导致其他更关键的查询运行缓慢或超时，我只会优化这个查询以减少它对其他查询的影响。

不过，如果您希望该表继续增长，我会考虑使用单独的报告模式并定期从该表中提取数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T09:47:06.890

我将在 Date 和 OrderId 以及 INCLUDE 列 SiteVisitId、Referer、CampaignId 上创建一个索引（假设您使用的是 SQL Server 2005 及更高版本）。还要在外键列 KnownRefererId 上创建索引。

鉴于这是一个报告查询并且可以承受奇数未提交的行，我建议使用 NOLOCK（或 READ UNCOMMITED 提示）：

```
using (var trans = new TransactionScope(TransactionScopeOption.Required,
                      new TransactionOptions
                      {
                          IsolationLevel = IsolationLevel.ReadUncommitted
                      }))
{
    // Put your linq to sql query here
} 
```

[参考](http://www.hanselman.com/blog/GettingLINQToSQLAndLINQToEntitiesToUseNOLOCK.aspx)。

**警告：仅在有****充分理由**的情况下使用 NOLOCK 提示。在过去，我看到开发人员因使用毯子而感到悲痛！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T15:19:48.357

```
SELECT TOP 1000
  t0.SiteVisitId, t0.OrderId, t0.Date, 
  t1.Domain, t0.Referer, t0.CampaignId
FROM 
  SiteVisit AS t0
LEFT OUTER JOIN KnownReferer AS t1 ON t1.KnownRefererId = t0.KnownRefererId
WHERE
  t0.Date <= @p0 
  AND t0.Date >= @p1
  AND t0.OrderId IS NOT NULL
ORDER BY 
  t0.Date DESC

@p0='2008-11-1 23:59:59:000', @p1='2008-10-1 00:00:00:000' 
```

我将在这里猜测表统计信息，由此产生的设计可能会减慢其他查询 - 但这通常是权衡。我通常发现，在移动聚集索引时，最好创建一个替换索引，以免过多干扰其他查询。

假设在 1 个月的日期范围内有很多行，而其中的 OrderId 为 NULL 的行相对较少 - 你最好在 Date 上使用聚集索引。这应该会给你一个聚集索引扫描，结果 nicleley 为你的 TOP 1000 排序。

您可能还希望 KnownReferer.KnownRefererId 成为聚集索引或与 knownRefererId + Domain 的组合索引，以避免查找该表。我猜你的 KnownReferers 的数量虽然很少 - 所以我不希望从中获得太多好处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T09:17:27.183

如果您需要在 SiteVisit 中存储在您的 KnownReferer 表中没有 KnownRefererId 并且具有 Null OrderId 的行，这也是值得考虑的。如果您不需要这些，请更改从表中删除它们，并将您的聚集索引更改为同时在 SiteVisitId 和 Date 上，查询应该很快。

但我确信您存储这些额外的行是有原因的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T09:38:07.610

如果您真的想优化此查询中的 bejesus 并且您可以接受稍微慢一点的插入到表中，您可以在以下位置创建索引：-

```
(Date, OrderId, SiteVisitId, Domain, Referer, CampaignId) 
```

这将使数据库完全从索引中返回答案，而无需任何排序或单独的表访问。

# javascript - 如何在 Vista Sidebar 中绘制程序图形？

> ID：312278
> 
> 赞同：4
> 
> 时间：2008-11-23T07:47:35.307
> 
> 标签：javascript, windows-vista, sidebar, windows-desktop-gadgets, vml

如何在 Vista 侧边栏小工具中绘制程序图形？

我有一个随时间收集数据的小工具，我想绘制动画图。我目前的方法是使用我在计时器滴答时从 JScript 更新的 VML 绘制图形。这是最好的方法吗？我可以将 DLL 函数中的位图位作为源返回到`<IMG>`. 将位图位嵌入 HTML 本身（并再次通过 JScript 更新它）？我很想听听一些想法。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-13T03:18:25.923

您现在可以将 Silverlight 2 与 Sidebar 小工具一起使用 - Codeplex ( [http://www.codeplex.com/Silverlight](http://www.codeplex.com/Silverlight) ) 上提供的 Silverlight 工具包包括图表控件（支持动画），因此应该相对简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-23T15:39:00.547

wz_jsgraphics 怎么样？

通过 javascript 实现的 DHTML 图形

[http://www.walterzorn.com/jsgraphics/jsgraphics_e.htm](http://www.walterzorn.com/jsgraphics/jsgraphics_e.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-07T13:10:14.057

我目前的做法是使用 Javascript 和 Adob​​e Flash Player 通过 ActionScript 中的 ExternalInterface 进行通信。它将本地 Javascript 实例与 Flash Player 实例无缝集成，您可以在两者之间进行任何通信。您可以在 ActionScript 中使用出色的绘图 API，并真正获得一些功能来制作图表，或者只是嵌入一些来自网络的工具。

但是，如果沙盒允许，通过定位 DLL 生成数据会很棒！我手头没有任何功能可以测试它，所以我把它留给其他贡献者。

# php - 通过 python 或 php 从 gmail 获取附件

> ID：312284
> 
> 赞同：8
> 
> 时间：2008-11-23T08:03:16.757
> 
> 标签：php, python, gmail, attachment

我一直在尝试查找有关如何在 python 或 PHP 中从 gmail 帐户检索附件的信息，我希望这里的人可以提供一些帮助，谢谢。

有关的：

*   [如何从 Gmail 下载所有带有附件的电子邮件？](https://stackoverflow.com/questions/348630/how-can-i-download-all-emails-with-attachments-from-gmail)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T09:08:39.387

您必须启用对您的 GMail 帐户的 IMAP 访问（设置 → 转发和 POP/IMAP），然后使用`imaplib.IMAP4_SSL`它来访问它。

使用每条消息的原始文本作为参数`email.message_from_string`来处理任何附件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-18T13:59:06.633

我采用了上面的代码并对其进行了修复并进行了测试。它适用于 PHP5。

```
<?php 

$gmail_username = 'email@gmail.com';
$gmail_password = 'password';
$imap = imap_open ("{imap.gmail.com:993/imap/ssl}INBOX", $gmail_username, $gmail_password) or die("can't connect: " . imap_last_error());
$savefilepath = '//Server/share/Local/Pathname/'; //absolute path to images directory
$imagefilepath = '/Local/Pathname/'; //relative path to images directory
$savethumbpath = '/Local/Pathname/'; //relative path to images directory
$headers = imap_headers($imap);
foreach ($headers as $mail) {
    $flags = substr($mail, 0, 4);
    //Check for unread msgs, get their UID, and queue them up
    if (strpos($flags, "U")) {
        preg_match('/[0-9]+/',$mail,$match);
        $new_msg[] = implode('',$match);     
    }
}
if ($new_msg) {
    foreach ($new_msg as $result) {
        $structure = imap_fetchstructure($imap,$result);
        $parts = $structure->parts;
        foreach ($parts as $part) {
            if ($part->parameters[0]->attribute == "NAME") {
                //Generate a filename with format DATE_RANDOM#_ATTACHMENTNAME.EXT
                $savefilename = date("m-d-Y") . '_' . rand() . '_' . $part->parameters[0]->value;
                   save_attachment(imap_fetchbody($imap,$result,2),$savefilename,$savefilepath,$savethumbpath);
                imap_fetchbody($imap,$result,2); //This marks message as read
            } 
        }
    }
}
/* grab emails */
$emails = imap_search($imap,'ALL');
/* if emails are returned, cycle through each... */
if($emails) {
  /* put the newest emails on top */
  $total = imap_num_msg($imap);
  /* for every email... */
  for( $i = $total; $i >= 1; $i--) {
        $headers = imap_header($imap, $i);
        $from = $headers->from[0]->mailbox . "@" . $headers->from[0]->host;
        echo $from . "\n";
        imap_delete($imap,$i);
        imap_mail_move($imap,"$i:$i", "[Gmail]/Trash"); // Change or remove this line if you are not connecting to gmail. The path to the Trash folder in your Gmail may be different, capitalization is relevant.
  }
}else{
        echo "no emails";
}
/* close the connection */
   imap_expunge($imap);
   imap_close($imap);

function save_attachment( $content , $filename , $localfilepath, $thumbfilepath ) {
     if (imap_base64($content) != FALSE) {   
         $file = fopen($localfilepath.$filename, 'w');
         fwrite($file, imap_base64($content));
         fclose($file);
     }
}
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-01T09:08:48.473

我发现了一些有效的代码！这会将任何附件下载到选定的文件夹

```
<?php 

$gmail_username = 'username@gmail.com';
$gmail_password = 'mypassword';

$imap = imap_open ("{imap.gmail.com:993/imap/ssl}INBOX", $gmail_username, $gmail_password) or die("can't connect: " . imap_last_error());
$savefilepath = 'path/to/images_folder/'; //absolute path to images directory
$imagefilepath = 'images/'; //relative path to images directory

$headers = imap_headers($imap);
foreach ($headers as $mail) {
    $flags = substr($mail, 0, 4);
    //Check for unread msgs, get their UID, and queue them up
    if (strpos($flags, "U")) {
        preg_match('/[0-9]+/',$mail,$match);
        $new_msg[] = implode('',$match);     
    }
}

if ($new_msg) {
    foreach ($new_msg as $result) {
        $structure = imap_fetchstructure($imap,$result);
        $parts = $structure->parts;
        foreach ($parts as $part) {
            if ($part->parameters[0]->attribute == "NAME") {
                //Generate a filename with format DATE_RANDOM#_ATTACHMENTNAME.EXT
                $savefilename = date("m-d-Y") . '_' . mt_rand(rand(), 6) . '_' . $part->parameters[0]->value;
                save_attachment(imap_fetchbody($imap,$result,2),$savefilename,$savefilepath,$savethumbpath);
                imap_fetchbody($imap,$result,2); //This marks message as read
            } 
        }
    }
}

imap_close($imap);

function save_attachment( $content , $filename , $localfilepath, $thumbfilepath ) {
    if (imap_base64($content) != FALSE) {   
        $file = fopen($localfilepath.$filename, 'w');
        fwrite($file, imap_base64($content));
        fclose($file);
    }
}
?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-06-18T12:42:16.640

```
I recently worked on this topic and here is the code which works well. It also saves the details of the attachments in a word document with the following details:
-> Date
-> Time
-> From
-> Email ID
-> Subject

<?php 

 /*
    *   Gmail attachment extractor.
    *
    *   Downloads attachments from Gmail and saves it to a file.
    *   Uses PHP IMAP extension, so make sure it is enabled in your php.ini,
    *   extension=php_imap.dll
    *
    */

    header('Content-type:application\msword');
    header('Content-Disposition:attachment;Filename=document_name.doc');
    set_time_limit(0); 
    /* connect to gmail with your credentials */
    $hostname = '{imap.googlemail.com:993/imap/ssl}INBOX';
    $username = 'email@gmail.com';
    $password = 'password';
    /* try to connect */
    $inbox = imap_open($hostname,$username,$password) or die('Cannot connect to       
    Gmail: ' . imap_last_error());
    /* get all new emails. If set to 'ALL' instead 
    * of 'NEW' retrieves all the emails, but can be 
    * resource intensive, so the following variable, 
    * $max_emails, puts the limit on the number of emails downloaded.
    * 
    */
    $emails = imap_search($inbox,'ALL');
    /* useful only if the above search is set to 'ALL' */
    $max_emails = 110;

    /* if any emails found, iterate through each email */
    if($emails){
    $count = 1;

    /* put the newest emails on top */
    rsort($emails);
    /* for every email... */
    foreach($emails as $email_number){
    /* get information specific to this email */
    //$overview = imap_fetch_overview($inbox,$email_number,0);
    $check=imap_check($inbox);
    $result=imap_fetch_overview($inbox,"1:{$check->Nmsgs}",0);
    foreach($result as $overview){
    echo "#{$overview->msgno}({$overview->date})-From: {$overview->from}
    {$overview->subject}\n"}
    /* get mail message */
    $message = imap_fetchbody($inbox,$email_number,2);
    /* get mail structure */
    $structure =imap_fetchstructure($inbox, $email_number);
    //$functions = array('function1' => imap_fetchstructure($inbox,
    $email_number));
    //print_r(array_keys($functions));
    $attachments = array();
    //print_r(array_keys($attachments[$i]));
    if($structure->parts[$i]->ifdparameters){
    foreach($structure->parts[$i]->dparameters as $object){
    if(strtolower($object->attribute) == 'filename'){
    $attachments[$i]['is_attachment'] = true;
    $attachments[$i]['filename'] = $object->value;
        }
       }
      }
       if($structure->parts[$i]->ifparameters) 
       {
         foreach($structure->parts[$i]->parameters as $object) 
         {
             if(strtolower($object->attribute) == 'name') 
            {
                $attachments[$i]['is_attachment'] = true;
                $attachments[$i]['name'] = $object->value;
            }
        }
     }
     if($attachments[$i]['is_attachment']){
     $attachments[$i]['attachment']imap_fetchbody($inbox,$email_number,$i+1);
     /* 4 = QUOTED-PRINTABLE encoding */
     if($structure->parts[$i]->encoding == 3){ 
     $attachments[$i]['attachment'] = base64_decode($attachments[$i]  
           ['attachment']);
      }
      /* 3 = BASE64 encoding */
      elseif($structure->parts[$i]->encoding == 4){ 
      $attachments[$i]['attachment'] =              

      quoted_printable_decode($attachments[$i]['attachment']);
      }

       }
      }
     }
       /* iterate through each attachment and save it */
       foreach($attachments as $attachment)
       {
       if($attachment['is_attachment'] == 1){
        $filename = $attachment['name'];
        if(empty($filename)) $filename = $attachment['filename'];
        if(empty($filename)) $filename = time() . ".dat";
       /* prefix the email number to the filename in case two emails
       * have the attachment with the same file name.
       */
       $fp = fopen($email_number . "-" . $filename, "w+");
       fwrite($fp, $attachment['attachment']);
        fclose($fp);
        }

        }

          if($count++ >= $max_emails) break;

         }

       } 

        /* close the connection */

       imap_close($inbox);

  ?> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-14T01:17:43.577

imap_open 的 php 文档在评论中解释了连接到 gmail（例如 2007 年 10 月 31 日 07:50）：

`$mbox = imap_open("{imap.gmail.com:993/imap/ssl}INBOX", "username@gmail.com", "password") or die("can't connect: " . imap_last_error());`

显然，您必须根据需要填写实际的用户名和密码，然后按照以下说明识别电子邮件部分中的附件：[http ://www.electrictoolbox.com/extract-attachments-email -php-imap/](http://www.electrictoolbox.com/extract-attachments-email-php-imap/)

总而言之，它说您使用：

`// in a for($i=1;$i<$nummsgs;$i++) loop over all the messages in the inbox $structure = imap_fetchstructure($mbox, $i);`

识别结构中的附件。但是，这是解构 MIME 消息的一个相当复杂的过程（必须考虑到许多可选的可变性），因此该功能的基本原理/概述在该电动工具箱页面中。

# c++ - 从类中返回一个指针

> ID：312286
> 
> 赞同：2
> 
> 时间：2008-11-23T08:04:31.557
> 
> 标签：c++, pointers, linked-list

对于我的编程课，我必须编写一个链表类。我们必须包含的函数之一是 next()。该函数将返回列表中下一个元素的内存地址。

```
#include <iostream>
using namespace std;

class Set {
    private:
        int num;
        Set *nextval;
        bool empty;
    public:
        Set();
        <some return type> next();
};

<some return type> Set::next() {
    Set *current;
    current = this;
    return current->next;
}

int main() {
    Set a, *b, *c;
    for (int i=50;i>=0;i=i-2) a.insert(i); // I've ommited since it does not pertain to my question

    // Test the next_element() iterator
    b = a.next();
    c = b->next();
    cout << "Third element of b = " << c->value() << endl;

    return 0;
} 
```

如您所见，我需要将指针设置为保存列表`*b`中`*c`下一个元素的内存地址。我的问题是我会使用什么样的返回类型？我试过用 Set 和 Set* 代替但得到编译器错误。任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-23T08:07:27.730

`Set*`是正确的。您在此功能中遇到了一个相当愚蠢的错误：

```
Set* Set::next() {
    Set *current;
    current = this;
    return current->next;
} 
```

最后一行应该是`return current->nextval`. 否则，您将尝试返回指向该`next`函数的指针……可能永远都不是您想要的。:-)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-23T08:12:59.777

luqui 是正确的，虽然你的**下一个**函数过于复杂，但没有理由复制*this*指针，这很愚蠢。改用这个：

```
Set* Set::next() {
    return nextval;
} 
```

# c - 在 Vista 上捕获“程序停止工作”

> ID：312300
> 
> 赞同：6
> 
> 时间：2008-11-23T08:37:37.093
> 
> 标签：c, windows-vista

在 Vista 上，我遇到了应用程序崩溃处理程序的问题。基本上，如果发生了无法被 SEH 捕获的意外情况，我会弹出“应用程序停止工作”、blablabla、“关闭程序/调试程序”的弹出窗口——也就是说，在我使用禁用错误报告之后系统控制面板。启用错误报告后，您将获得一个任务对话框，其中包含在线搜索解决方案、关闭、调试。

*如果它发生在自动化工具中，这并不是那么有趣，我想知道是否有办法完全*摆脱它，阅读，如果我的应用程序崩溃，它只是崩溃到命令行或消失但没有弹出对话框.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T10:32:05.677

采用

```
SetErrorMode(SetErrorMode(0)|SEM_NOGPFAULTERRORBOX); 
```

但我建议安装一个创建转储的异常处理程序，以便您可以验证发生了什么。例如[crashrpt](http://code.google.com/p/crashrpt/)（或[此处](http://www.codeproject.com/KB/debug/crash_report.aspx)）。

也可以看看

*   [http://msdn.microsoft.com/en-us/library/ms680621(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms680621(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-28T18:47:51.963

函数[信号](http://www.cs.cf.ac.uk/Dave/C/node24.html "信号")适用于所有 POSIX 平台：

```
signal(SIGSEGV, &signal_handler); 
```

如果您需要捕获信号不支持的异常，您还可以查看[AddVectoredExceptionHandler](http://msdn.microsoft.com/en-us/library/ms679274(VS.85).aspx)，这是 W32 特有的函数。

# c++ - 使用数组防止 C++ 中的堆栈溢出？

> ID：312302
> 
> 赞同：1
> 
> 时间：2008-11-23T08:39:12.597
> 
> 标签：c++

如果我们在 C++ 中使用数组来实现堆栈，那么减少溢出条件机会的最佳方法是什么？还要牢记时空权衡？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T08:42:32.027

当您接近“溢出条件”时，只需调整您的数组大小，即当下一个元素不再适合时。或者使用 a `std::vector`，您可以轻松调整其大小。

不确定，但你知道这个`std::stack`类，它实现了一个在 C++ 中自动调整大小的堆栈？

[编辑] 如果你不想调整大小，但正确失败，抛出异常是你能做的最好的事情。例如，您可以定义 a`StackOverflowException`并在没有空间的情况下将其抛出，以便客户做出反应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T08:49:01.327

您可以使用 std::stack 来实现堆栈。如果您正在寻找家庭作业的答案，请保留一组数据项（或指向它们的指针）。这个数组可以随着堆栈的增长或缩小而增长或缩小。增长/收缩因子*决定了您对速度或尺寸优化的关注程度。

*通过增长/收缩因子，我的意思是当你增长或收缩时你添加或删除了多少元素。这些自然是二次幂值或倍数，因为您可以添加或乘以一个简单的数字（例如 += 4096，*= 2）。使用较大的值有助于防止堆栈大小调整，这会导致代码更快，但会消耗更多内存。较小的值会产生相反的效果，甚至会导致非 MMU 系统（如某些便携式设备）上的内存碎片。对于使用存储桶的实现，这基本上是您的存储桶大小。

对于堆栈，您可以使用链表、带桶的链表、分配数组（使用 malloc/realloc/free）、std::vector 或其他线性结构。

如果您关心代码大小，请使用 std::stack (duh) 或 std::vector 作为起点。但是，由于大多数 C++ 编译器将这些编译为庞大的函数集，您可能会使用 malloc 数组推出轻量级类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T11:30:49.083

虽然这个答案并没有准确地提供实施技巧，但它回答了您如何经常保护自己免受某些错误（如缓冲区溢出）的影响。GCC 对此有一个标志：

> `-fmudflap -fmudflapth -fmudflapir` 对于支持它的前端（C 和 C++），检测所有有风险的指针/数组解引用操作、一些标准库字符串/堆函数，以及其他一些具有范围/有效性测试的相关结构。如此检测的模块应该不受缓冲区溢出、无效堆使用和其他一些 C/C++ 编程错误的影响。该工具依赖于一个单独的运行时库 (libmudflap)，如果在链接时给出 -fmudflap，它将被链接到一个程序中。检测程序的运行时行为由 MUDFLAP_OPTIONS 环境变量控制。有关其选项，请参见“env MUDFLAP_OPTIONS=-help a.out”。

通常，这需要编译器支持，因为不能重载`[]`原生数组（如`char[]`）或指针（如）的下标运算符`char*`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T23:50:31.743

只需跟踪数组的大小。如果你有一个大小为 10 的数组，只需将该大小存储在一个“int”中。然后每次访问数组时，只需检查索引值是否小于您的大小值。这不会伤害你的“大 O”时间

# compiler-construction - Ajax 控制工具包 - Toolscriptmanager 不可用

> ID：312306
> 
> 赞同：0
> 
> 时间：2008-11-23T08:42:42.353
> 
> 标签：compiler-construction, asp.net-2.0, ajaxcontroltoolkit

我一直试图让这个 asp.net 2.0 应用程序启动并运行，但收效甚微。我删除了所有引用并再次添加了 ajax 控件工具包，但仍然收到“未指定 ToolScriptManager：ID 属性”。

[http://www.naeem.sarfraz.name/image001.jpg](http://www.naeem.sarfraz.name/image001.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T09:08:11.960

检查项目中的**AjaxControlToolkit 参考**。如果 AjaxControlToolkit 不在全局程序集缓存 (C:\Windows\assembly) 中，则必须设置“复制本地”属性。然后 dll 将被复制到执行您的网站/网络应用程序期间需要的二进制文件夹中。

# facebook - 托管 Facebook 应用程序？

> ID：312311
> 
> 赞同：6
> 
> 时间：2008-11-23T09:02:01.350
> 
> 标签：facebook, hosting

我查看了 FaceBook 开发者页面，发现可以创建一个 FaceBook 应用程序，但是这个应用程序必须由您托管！

我是新人，有人有这方面的经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T13:15:11.883

是的，您必须拥有 Facebook 外部的服务器。基本上会发生什么是你给 facebook 你的应用程序的 URL。当有人试图从 facebook ( [http://app.facebook.com/yourAppName/](http://app.facebook.com/yourAppName/) ) 查看它时，它会将请求以及一些用于验证的特殊密钥转发到您的应用程序的服务器。您的所有代码都在您的托管服务器上，并且可以从那里调用回 facebook 的 API/Web 服务以获取任何需要的数据。然后你可以在回复中返回任何 UI/HTML/FBML 标记，facebook 会显示它。

Facebook 也有许多预先编写的库，适用于多种语言。例如，用于 Ruby 的[Facebooker 。](http://facebooker.rubyforge.org/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T09:04:28.177

我真的没有看到一个问题。肯定有很多开发人员创建了这样的应用程序（查看 facebook 中所有可用的应用程序）。

我个人试过一次。是的，你需要一个地方来发布你的应用程序（网络服务器）......

一些帮助开始：[https ://developers.facebook.com/docs/](https://developers.facebook.com/docs/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T12:33:01.797

您不必托管您的应用程序。[这是一家将免费托管您的 Facebook 应用程序一年的公司。](http://joyent.com/developers/facebook)

# c++ - 发布版本与调试版本的运行方式不同的一些原因是什么

> ID：312312
> 
> 赞同：58
> 
> 时间：2008-11-23T09:03:28.773
> 
> 标签：c++, visual-studio, visual-studio-2005

我有一个 Visual Studio 2005 C++ 程序，它在发布模式下的运行方式与在调试模式下的运行方式不同。在发布模式下，会发生（明显的）间歇性崩溃。在调试模式下，它不会崩溃。发布版本与调试版本的工作方式不同的一些原因是什么？

还值得一提的是，我的程序相当复杂，并使用多个第三方库进行 XML 处理、消息代理等......

提前致谢！

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-11-23T10:01:40.527

[**幸存的发布版本**](https://www.codeproject.com/Articles/548/Surviving-the-Release-Version) 提供了一个很好的概述。

我遇到的事情 - 大多数已经提到

**变量初始化** 是迄今为止最常见的。在 Visual Studio 中，调试构建显式地将分配的内存初始化为给定值，请参见此处的[内存值](https://community.kde.org/index.php?title=Guidelines_and_HOWTOs/Debugging/MS_Windows&redirect=no#Memory_Values)。这些值通常很容易发现，当用作索引时会导致越界错误，当用作指针时会导致访问冲突。然而，未初始化的布尔值是正确的，并且可能导致未初始化的内存错误多年未被检测到。

在没有明确初始化内存的 Release 版本中，它只保留以前的内容。这会导致“有趣的值”和“随机”崩溃，但通常会导致确定性崩溃，需要在实际崩溃的命令之前执行明显不相关的命令。这是由第一个命令“设置”具有特定值的内存位置引起的，当内存位置被回收时，第二个命令将它们视为初始化。未初始化的堆栈变量比堆更常见，但后者也发生在我身上。

无论您是从 Visual Studio（附加调试器）开始还是从资源管理器开始，原始内存初始化在发布版本中也可能不同。这使得“最好”的发布构建错误永远不会出现在调试器下。

**在我的经验中，有效的优化**排在第二位。C++ 标准允许进行许多优化，这可能令人惊讶，但完全有效，例如，当两个指针对相同的内存位置起别名时，不考虑初始化顺序，或者多个线程修改相同的内存位置，并且您期望某个顺序线程 B 在其中看到线程 A 所做的更改。通常，编译器会因此而受到指责。不要那么快，年轻的野人！- 见下文

**时序**发布版本不仅仅是“运行得更快”，出于各种原因（优化、提供线程同步点的日志记录功能、调试代码（如未执行的断言等）），操作之间的相对时序也发生了巨大变化。最常见的问题是竞争条件，还有死锁和基于消息/计时器/事件的代码的简单“不同顺序”执行。尽管它们是时间问题，但它们*在*构建和平台上的稳定性令人惊讶，并且复制品“始终有效，除了在 PC 23 上”。

**保护字节**。调试构建通常会在选定的实例和分配周围放置（更多）保护字节，以防止索引溢出，有时甚至下溢。在代码依赖于偏移量或大小的极少数情况下，例如序列化原始结构，它们是不同的。

**其他代码差异**一些指令 - 例如断言 - 在发布版本中评估为无。有时它们有不同的副作用。这在宏诡计中很普遍，就像在经典中一样（警告：多个错误）

```
#ifdef DEBUG
#define Log(x) cout << #x << x << "\n";
#else 
#define Log(x)
#endif

if (foo)
  Log(x)
if (bar)
  Run(); 
```

在发布版本中，计算结果为*if (foo && bar)* 这种类型的错误在普通 C/C++ 代码和正确编写的宏中非常罕见。

**编译器错误**这真的从来没有发生过。嗯 - 确实如此，但在你职业生涯的大部分时间里，假设它没有，你会更好。在使用 VC6 的十年中，我发现一个我仍然确信这是一个未修复的编译器错误，与对经文（即标准）理解不足的数十种模式（甚至可能是数百个实例）相比。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-23T09:12:35.010

在调试版本中，通常启用断言和/或调试符号。这可能导致不同的内存布局。如果出现错误指针、数组溢出或类似的内存访问，您在一种情况下访问关键错误内存（例如函数指针），在其他情况下可能只是一些非关键内存（例如，只是一个文档字符串被丢弃）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-23T09:07:39.730

未显式初始化的变量将或可能不会在发布版本中归零。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T09:15:05.690

发布版本（希望）会比您的调试版本运行得更快。如果您使用多个线程，您可能会看到更多的交错，或者只是一个线程比其他线程运行得更快，您可能在调试构建中没有注意到。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-23T09:17:44.717

发布版本通常在编译器中启用优化进行编译，而调试版本通常不是。

In some languages or when using many different libraries this can cause intermittent crashes - especially when the chosen optimization level is very high.

我知道 gcc C++ 编译器就是这种情况，但我不确定微软的编译器。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-23T09:38:39.433

[不久前](https://stackoverflow.com/questions/186237/program-only-crashes-as-release-build-how-to-debug)我遇到了类似的问题，最终是由于在发布版本中对堆栈的处理方式不同造成的。其他可能不同的事情：

*   VS 编译器中的调试版本处理内存分配的方式不同（即，在清除的内存上写入 0xcc 等）
*   循环展开和其他编译器优化
*   指针的点亮

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-23T09:47:57.263

它取决于编译器供应商和您使用 DEBUG 标志编译的库。虽然 DEBUG 代码不应该影响正在运行的代码（应该没有副作用），但它有时会影响。

特别是，变量只能在 DEBUG 模式下初始化，而在 RELEASE 模式下保持未初始化。Visual Studio 编译器中的 STL 在 DEBUG 和 RELEASE 模式下是不同的。这个想法是在 DEBUG 中对迭代器进行全面检查以检测可能的错误（使用无效的迭代器，例如，如果在检索迭代器后发生插入，则将迭代器插入到向量中，则该迭代器无效）。

第三方库也是如此，我能想到的第一个库是 QT4，如果与创建图形对象的线程不同的线程执行绘画操作，它将使用断言终止您的程序。

进行所有更改后，您的代码和内存占用在两种模式下都会有所不同。如果该位置是可读的，则指针（读取一个通过数组末尾的位置）问题可能会未被检测到。

断言旨在在 DEBUG 期间终止应用程序并从 RELEASE 构建中消失，因此我不会认为断言是您的问题。流氓指针或访问结束将是我的第一个嫌疑人。

前段时间有一些编译器优化破坏代码的问题，但我最近没有读到抱怨。那里可能存在优化问题，但这不是我的第一个怀疑。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-11T22:56:15.860

[https://web.archive.org/web/20090503153840/https://www.debuginfo.com/tips/userbpntdll.html](https://web.archive.org/web/20090503153840/https://www.debuginfo.com/tips/userbpntdll.html)

由于在调试版本中添加了保护字节，您可能能够“安全地”访问数组（尤其是动态数组）越界的内存，但这会导致发布版本中的访问冲突. 此错误可能会被忽视，从而导致堆损坏，并可能在与原始错误无关的位置发生访问冲突。

使用 PageHeap（或者，如果您安装了调试工具，则可以使用 gflags）来发现与损坏堆相关的错误。

[https://web.archive.org/web/20090210190738/https://support.microsoft.com/kb/286470](https://web.archive.org/web/20090210190738/https://support.microsoft.com/kb/286470)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-09T21:21:22.420

以我的经验，最常见的原因似乎是配置比发布/构建设置有更多的不同。例如，包含不同的库，或者调试版本与发布版本具有不同的堆栈大小。

为了在我们的 Visual Studio 2005 项目中避免这种情况，我们广泛使用属性表。这样发布和调试配置可以共享通用设置。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-17T08:49:16.390

这篇文章以及提供的链接对于修复相关错误非常有帮助。添加到上面的列表中，调用约定的差异也可能导致这种行为 - 它在发布构建中失败，仅对我进行了优化。我声明为 __stdcall 并定义为 __cdecl （默认情况下）。[奇怪的是，即使在警告级别 4 MSVC 中也没有选择此警告？]

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-08-23T16:30:44.277

在可以在 Release 模式下执行的优化中（在 Debug 下不可以），复制省略可以产生不同的结果。更具体地说，RVO（返回值优化），取决于您的构造函数的设计方式。

[什么是复制省略和返回值优化？](https://stackoverflow.com/questions/12953127/what-are-copy-elision-and-return-value-optimization)

# powershell - PowerShell 中的环境变量，名称中带有点 (.)

> ID：312314
> 
> 赞同：41
> 
> 时间：2008-11-23T09:06:48.780
> 
> 标签：powershell, environment-variables

我知道我可以使用`$Env`. 例如，我可以`FOO`使用`$Env:FOO`.

我不知道如何访问名为`FOO.BAR`.

`$Env:FOO.BAR`不起作用。如何从 PowerShell 中访问它？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-11-23T23:18:47.813

要访问名称包含非字母数字字符的任何类型的 PowerShell 变量，请使用 ${...} 表示法，如下所示：

```
${env:variable.with.dots} = "Hi there"
${env:variable.with.dots} 
```

这适用于任何驱动器（注册表、文件系统等）中的变量

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-23T09:18:51.207

使用 .NET 方法获取变量：

```
[Environment]::GetEnvironmentVariable("FOO.BAR") 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T10:31:26.877

采用：

```
Get-WMIObject Win32_Environment -filter "name='foo.bar'" 
```

# asp.net - 如何让我的自动完成扩展器工作？

> ID：312318
> 
> 赞同：2
> 
> 时间：2008-11-23T09:08:40.930
> 
> 标签：asp.net, asp.net-ajax, autocompleteextender

我已经尝试在我的代码中搜索错误，但我自己无法让自动完成扩展器工作。把招工广告。

这是我的代码：（摘自我的 aspx 页面）

```
 <asp:TextBox ID="TextBox1" Width="120px" runat="server"></asp:TextBox>
    <cc1:AutoCompleteExtender ID="AutoCompleteExtender1" runat="server" TargetControlID="TextBox1" ServiceMethod="GetCompletionList" ServicePath="SearchAutoComplete.asmx" MinimumPrefixLength="1">
    </cc1:AutoCompleteExtender> 
```

我的网络服务代码：

```
 [WebMethod]
    public static string[] GetCompletionList(string prefixText, int count)
    {
        List<string> returnData = new List<string>();
        MySqlConnection con = new MySqlConnection(Connection.ConnectionString());
        string sql = "select title from blog where title like '%" + prefixText + "%'";
        MySqlCommand cmd = new MySqlCommand(sql, con);
        con.Open();
        MySqlDataReader reader = cmd.ExecuteReader(CommandBehavior.CloseConnection);
        while (reader.Read())
        {
            returnData.Add(reader["title"].ToString());
        }
        return returnData.ToArray();
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T16:55:03.407

如何解决此问题：

注释掉你的 SQL 代码。只需返回一个包含一些测试数据的数组。那样有用吗？你看到了吗？如果没有，则不会调用您的 Web 服务代码。如果可行，您的问题出在您的数据库代码上……您的 Web 服务代码在调用页面上吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T13:16:31.100

除了`GetCompletionList`方法被错误地声明为 之外`static`，它还需要有两个属性；`[System.Web.Services.WebMethod]`和`[System.Web.Script.Services.ScriptMethod]`

所以你的声明应该是这样的：

```
[System.Web.Services.WebMethod]
[System.Web.Script.Services.ScriptMethod]
public string[] GetCompletionList(string prefixText, int count) { ... 
```

此外，您的服务类应具有以下属性：

```
[WebService(Namespace = "http://tempuri.org/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[System.ComponentModel.ToolboxItem(false)]
[System.Web.Script.Services.ScriptService] 
```

`GetCompletionList`如果您的方法抛出异常，自动完成扩展器也会出现故障。为了防止这种情况，您应该`try..catch`在函数代码周围添加一个块

```
[System.Web.Services.WebMethod]
[System.Web.Script.Services.ScriptMethod]
public string[] GetCompletionList(string prefixText, int count)
{
    List<string> returnData = new List<string>();

    try
    {
        // database access code that sets returnData
    }
    catch (Exception ex)
    {
        // log the exception
    }

    return returnData.ToArray();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T20:45:28.340

我认为您的问题是该`GetCompletionList`方法已声明`static`。

如果您在调试器会话中仅运行 .asmx 代码（或者如果您已将代码部署到 Web 服务器，则浏览到 .asmx 文件）您应该会看到 Web 服务的可用操作列表。当我更改 Ajax 控件工具包示例中的代码以将此方法声明为静态时，操作不再在列表中，并且自动完成扩展器也停止工作。

将您的方法签名更改为：

```
public string[] GetCompletionList(string prefixText, int count) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-01T06:00:21.667

像这样在 ScriptManager 中添加对 Web 服务的引用

```
<asp:ScriptManager ID="ScriptManager1" runat="server">
<Services>
 <asp:ServiceReference Path="AutoComplete.asmx" />
 </Services>
 </asp:ScriptManager> 
```

请参阅下面的链接以获取更多信息

[gridview中的Ajax自动完成文本框](http://csharpdotnetfreak.blogspot.com/2009/01/ajax-autocomplete-textbox-gridview.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-13T10:55:51.030

首先，从 Web 方法声明中删除“静态”。其次是在你的添加 EnableCaching="true" CompletionSetCount="20"

```
 <cc1:AutoCompleteExtender  

      </cc1:AutoCompleteExtender> 
```

代码块。希望这能解决您的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-06-12T23:04:39.610

当你创建一个 Web 服务时，在顶部有一行写着：

> ' 要允许使用 ASP.NET AJAX 从脚本调用此 Web 服务，请取消注释以下行。

```
'<System.Web.Script.Services.ScriptService()> _
<WebService(Namespace:="http://tempuri.org/")> _
<WebServiceBinding(ConformsTo:=WsiProfiles.BasicProfile1_1)> _
<Global.Microsoft.VisualBasic.CompilerServices.DesignerGenerated()> _ 
```

只需取消注释该行：

```
<System.Web.Script.Services.ScriptService()> _ 
```

这在 Visual Studio 2010 中发生在我身上。

# delphi - 在 Delphi 2006 中调试“WITH”语句的问题

> ID：312321
> 
> 赞同：6
> 
> 时间：2008-11-23T09:13:35.443
> 
> 标签：delphi

> **可能重复：**
> [Delphi 的“with”有什么问题](https://stackoverflow.com/questions/71419/whats-wrong-with-delphis-with)

我在调试 BDS 2006 中使用“WITH”语句的代码时遇到问题 调试器不会显示类或记录中的变量值。我做错了什么还是 BDS 2006 有错误？

```
type
  TNumber = class
      Num: Integer;
  end;

implementation

{$R *.dfm}

var
   MyNumber: TNumber;

procedure TForm2.FormCreate(Sender: TObject);
begin
   MyNumber := TNumber.Create;
   MyNumber.Num := 10;   /// MyNumber.Num Can be seen with debugger
   with  MyNumber do
   begin
     Num := Num +1 ;           /// Num is not seen by the  debugger
     MyNumber.Num := Num +1 ;  /// MyNumber.Num is seen but Num is not seen by the  debugger
   end;
end; 
```

编辑：

当然可以使用变量的全名但是如果你有一个超过一层的复杂结构，事情就会变得非常混乱

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-23T11:25:19.967

`With`许多语言功能都认为它属于“仅仅因为你拥有它并不意味着你必须使用它”类别。在*极*少数情况下我会给它留有余地——我发现一两种情况下，当使用极其复杂的多级结构时，编译器的工作不会像你期望的那样完全符合你的预期。它并且更容易包含，但是在 10 年的 Delphi 编码中，我认为这些可以用一只手的手指来计算。

它*确实*倾向于在示例中被大量使用，因为代码看起来确实更干净，但实际上在查看您未编写或未使用的代码时确定变量是简单的还是结构的一部分对维护的影响在一段时间内很容易超过这一点。我曾经使用过的每个 Delphi 版本的调试器的已知问题是关键问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-23T09:26:13.390

当您将鼠标悬停在变量上时，调试器无法在要检查的源代码中显示的变量和相关的 with 语句之间建立连接。您必须检查调试监视窗口中的值并在那里指定完整的变量，例如 MyNumber.Num。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-23T12:14:42.037

with 语句的调试问题是已知的。这就是我看到它们时删除它们的原因之一。在我看来，你永远不应该以可维护性为代价来提高编码速度。

我经常看到的一个常见结构（并且学会了讨厌）是：

```
with TMyObject.Create do
  try
    Method1(blah, blah, blah);
    Method2(blah, blah, blah);
  finally 
    Free;
  end; 
```

甚至可以在 with 语句中添加更多结构：

```
with A, B, C, D do
  // Aargh! 
```

但是话又说回来，如果可以替换，有时 with 语句也有有效的用途：

```
A.B.C.D.E.Method1;
A.B.C.D.E.Method2;
A.B.C.D.E.Method3;
A.B.C.D.E.Method4;
A.B.C.D.E.Method5;
A.B.C.D.E.Method6; 
```

和

```
with A.B.C.D.E do begin
  Method1;
  Method2;
  Method3;
  Method4;
  Method5;
  Method6;
end; 
```

虽然使用`A.B.C.D.E`有点问题，但它往往是“delphi方式”。但是现在有了类助手，我们可以有一个完全有效的解决方案：

```
TAHelper = class helper for TA
public
  procedure Method1;
endl

procedure TAHelper.Method1;
begin
  // You can (should) add sanity checks here.
  B.C.D.E.Method1;
end; 
```

所以现在你可以使用：

```
A.Method1; 
```

在我看来，这要好得多。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-26T18:42:47.150

The **with** statement is syntactic NutraSweet: It tastes a lot like syntactic sugar, but leaves a bad aftertaste and turns out to actually be harmful in the long term. It's best to just not use it.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-25T19:11:16.937

我很少使用**With..do**并且倾向于这样做

```
var
  Sc : TE_Type;
begin
  Sc := A.B.C.D.E;
  sc.Method1;
  sc.Method2;
  sc.Method3;
  sc.Method4;
  sc.Method5;
  sc.Method6;
end; 
```

当然，为 Sc 取一个体面的名字不会有什么坏处。而且我认为它比**with..do**更清晰，并且调试器发现自己要好得多。所以，我非常喜欢“捷径”变量。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-23T10:18:13.287

“With”引入了歧义，并可能导致比它解决的问题更多的问题。考虑干脆不使用它。

[Castalia](http://www.twodesk.com/castalia/index.html)有一个重构可以帮助删除它们。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-25T23:05:54.810

我完全相信包含可怕的“with”子句只是为了让书籍作者不必在他们的示例代码中包含所有那些丑陋的 TWinComponent 字符串。在现实生活中，除了代码片段和教科书之外，几乎没有充分的理由使用“with”。

The primary reason is it breaks the debugger. It would be very impractical for the debugger to evaluate entire clauses when finding the value of a variable, so its not a bug, its just unsupported in all delphi debuggers I know about. If you're like me, stuck maintaining hundreds of thousands of lines from a programmer that basically copied everything out of the textbook, it makes debugging a living hell.

Bottom line, DON'T USE WITH-CLAUSES... EVER!

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-03-17T17:36:46.170

**With** is not a bad practice at all. The only bad thing is that you can not debug easily that lines, but if you use it carefully there is no problem at all. May be its not a good practice for juniors, but if you know where to use it, its just ok.

Lets EMBA improve it in any way they can to avoid the common rants about it.

# java - 如果在 hashmap.put 调用中构造

> ID：312322
> 
> 赞同：0
> 
> 时间：2008-11-23T09:15:02.553
> 
> 标签：java, hashmap

我有一个 Hashmap `<String,Integer`> 类型的变量。

在这种情况下，整数值可能必须根据标志变量的值进行一些操作。我是这样做的...

```
Hashmapvariable.put( somestring,
    if (flag_variable) {
     //manipulation code goes here
     new Integer(manipulated value);
    } else {
     new Integer(non-manipulated value);
    }
); 
```

但我收到一个错误：

> 令牌上的语法错误，错误的构造。

在 Hashmapvariable.put 调用中。

我还收到另一个错误

> 标记 ")" 上的语法错误，删除此标记。

在最后的“）；” 线。但我不能删除“）”——它是 put 方法调用的右括号。

我不明白这个。我在做什么错？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-23T09:27:23.280

```
 new Integer(flag_variable ? manipulated value : non-manipulated value) 
```

有诀窍吗

编辑：在 Java 5 上，我想你也可以写

```
hashmap.put(someString, flag_variable ? manipulated value : non-manipulated value) 
```

由于自动装箱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T09:23:11.697

您不能在方法调用中放置语句。

但是，一种选择可能是创建一个返回 a 的方法，`Integer`例如：

```
private Integer getIntegerDependingOnFlag(boolean flag)
{
    if (flag)
        return new Integer(MANIPULATED_VALUE);
    else
        return new Integer(NON-MANIPULATED_VALUE);
} 
```

然后，您可以像这样拨打电话：

```
hashmap.put(someString, getIntegerDependingOnFlag(flag)); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T09:41:09.537

这不是方案，因此 if 语句不会评估为值。正如其他人所说，您将不得不使用 tri-if-thing （这个名字现在出于某种原因让我无法理解）或创建一个函数。

# algorithm - 找到射线和多边形之间交点的最快方法是什么？

> ID：312328
> 
> 赞同：5
> 
> 时间：2008-11-23T09:20:19.643
> 
> 标签：algorithm, polygon, raytracing

和问题所问的差不多。最好用伪代码回答并引用。正确的答案应该重视速度而不是简单。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T09:24:49.273

请参阅[3D 中光线、线段、平面和三角形的交点](http://www.softsurfer.com/Archive/algorithm_0105/algorithm_0105.htm)。您可以找到对多边形进行三角剖分的方法。

如果你真的需要光线/多边形相交，它在[实时渲染](http://www.realtimerendering.com/)的 16.9 （第二版为 13.8）。

> 我们首先计算射线和[多边形的平面] 之间的交点`pie_p`，这很容易通过用`x`射线替换来完成。

```
 n_p DOT (o + td) + d_p = 0 <=> t = (-d_p - n_p DOT o) / (n_p DOT d) 
```

> 如果分母`|n_p DOT d| < epsilon`是`epsilon`非常小的数字，则认为射线平行于多边形平面并且不会发生相交。否则，`p`计算射线和多边形平面的交点 ：`p = o + td`。此后，判断是否`p`在多边形内的问题从三个维度减少到了两个维度……

有关详细信息，请参阅本书。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T12:28:08.577

```
struct point
{
    float x
    float y
    float z
}

struct ray
{
    point R1
    point R2
}

struct polygon
{
    point P[]
    int count
}

float dotProduct(point A, point B)
{
    return A.x*B.x + A.y*B.y + A.z*B.z
}

point crossProduct(point A, point B)
{
    return point(A.y*B.z-A.z*B.y, A.z*B.x-A.x*B.z, A.x*B.y-A.y*B.x)
}

point vectorSub(point A, point B)
{
    return point(A.x-B.x, A.y-B.y, A.z-B.z) 
}

point scalarMult(float a, Point B)
{
    return point(a*B.x, a*B.y, a*B.z)
}

bool findIntersection(ray Ray, polygon Poly, point& Answer)
{
    point plane_normal = crossProduct(vectorSub(Poly.P[1], Poly.P[0]), vectorSub(Poly.P[2], Poly.P[0]))

    float denominator = dotProduct(vectorSub(Ray.R2, Poly.P[0]), plane_normal)

    if (denominator == 0) { return FALSE } // ray is parallel to the polygon

    float ray_scalar = dotProduct(vectorSub(Poly.P[0], Ray.R1), plane_normal)

    Answer = vectorAdd(Ray.R1, scalarMult(ray_scalar, Ray.R2))

    // verify that the point falls inside the polygon

    point test_line = vectorSub(Answer, Poly.P[0])
    point test_axis = crossProduct(plane_normal, test_line)

    bool point_is_inside = FALSE

    point test_point = vectorSub(Poly.P[1], Answer)
    bool prev_point_ahead = (dotProduct(test_line, test_point) > 0)
    bool prev_point_above = (dotProduct(test_axis, test_point) > 0)

    bool this_point_ahead
    bool this_point_above

    int index = 2;
    while (index < Poly.count)
    {
        test_point = vectorSub(Poly.P[index], Answer)
        this_point_ahead = (dotProduct(test_line, test_point) > 0)

        if (prev_point_ahead OR this_point_ahead)
        {
            this_point_above = (dotProduct(test_axis, test_point) > 0)

            if (prev_point_above XOR this_point_above)
            {
                point_is_inside = !point_is_inside
            }
        }

        prev_point_ahead = this_point_ahead
        prev_point_above = this_point_above
        index++
    }

    return point_is_inside
}
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T09:37:49.437

整本书的章节都致力于这个特殊的要求——在这里描述一个合适的算法太长了。我建议阅读任何数量的计算机图形学参考作品，特别是：

*   光线追踪简介，编辑。安德鲁·S·格拉斯纳，ISBN 0122861604

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-10T21:49:22.103

```
function Collision(PlaneOrigin,PlaneDirection,RayOrigin,RayDirection)
    return RayOrigin-RayDirection*Dot(PlaneDirection,RayOrigin-PlaneOrigin)/Dot(PlaneDirection,RayDirection)
end 
```

（PlaneDirection 是垂直于平面的单位向量）

# prototype - 用于快速游戏开发和游戏原型设计的建议平台/工具

> ID：312357
> 
> 赞同：38
> 
> 时间：2008-11-23T10:12:35.917
> 
> 标签：prototype, rad

我应该使用哪些平台和工具来进行快速游戏开发和原型设计？

假设我想尝试一个简单的游戏或游戏机制，那么快速创建可玩的东西的最佳工具是什么，我可以尝试尝试这个想法？

该平台不一定必须易于学习，这不是问题，但一旦学会它必须快速使用。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-24T06:53:56.880

用于 2D 游戏的[Flash](http://www.adobe.com/products/flash/)或[Game Maker 。](http://www.yoyogames.com/gamemaker)[Unity](http://unity3d.com/)用于 3D 游戏。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-23T10:26:54.423

[Pygame](http://en.wikipedia.org/wiki/Pygame)值得一试，主要是因为可以使用 Python 这样的高级编程语言来构建游戏。

请参阅[您将什么用于游戏开发？](https://stackoverflow.com/questions/92887/what-do-you-use-for-game-dev)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-11-23T10:17:52.943

你调查过微软的 XNA 平台吗？

*   [http://msdn.microsoft.com/en-us/xna/default.aspx](http://msdn.microsoft.com/en-us/xna/default.aspx)

*   [http://www.xna.com/](http://www.xna.com/)

*   [http://creators.xna.com/en-US/](http://creators.xna.com/en-US/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-05T18:44:58.313

我喜欢索引卡和记号笔。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-23T13:35:56.943

如果平台独立性是一个考虑因素，您可能需要查看[jMonkeyEngine](http://www.jmonkeyengine.com)。它是一个用 Java 编写的基于场景图的 3D 引擎。

```
public class HelloWorld extends SimpleGame{
 public static void main(String[] args) {
  HelloWorld app = new HelloWorld(); // Create Object
  // Signal to show properties dialog
  app.setConfigShowMode(ConfigShowMode.AlwaysShow);
  app.start(); // Start the program
 }
 protected void simpleInitGame() {
  // Make a box
  Box b = new Box("Mybox", new Vector3f(0,0,0), new Vector3f(1,1,1));
  rootNode.attachChild(b); // Put it in the scene graph
 }
} 
```

这段代码就是您开始在屏幕上显示 3D 图元所需的全部内容。该示例为您内置了许多基本功能，包括摄像头控制、WASD 移动和综合性能统计。您当然可以覆盖所有这些并做任何您想做的事情。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-24T12:32:18.927

我建议您尝试以下方法：

Flash 非常适合快速开发 2d 游戏（以及用于 actionscript 3 的[FlashDevelop](http://www.flashdevelop.org) 3 IDE），但它很昂贵。

[Silverlight](http://www.bluerosegames.com/silverlight-games-101/) 2 是另一个不错的选择，如果您使用 Visual Studio Express 和一些免费的图形编辑器（如 inkscape），它可以免费使用。

如果你想做一些 3d，我强烈建议你看看[Blitz3D](http://www.blitzbasic.com/)（它使用旧的 DirectX 7，但你仍然可以用它做强大的东西）。您可以使用它进行非常快速的原型制作。您也可以尝试[BlitzMax](http://www.blitzbasic.com)，以获得强大的 2d 引擎（也有 irrlicht3d、minib3d 等 3d 引擎插件）。

对于更强大的 3d 引擎，您应该尝试[MOGRE](http://www.ogre3d.org/wiki/index.php/MOGRE)（.NET Ogre3d 包装器）。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-23T10:18:22.413

我会说 Flash 之类的东西，因为它是快速和可编码性的完美结合。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2011-02-22T17:30:09.077

还有一个基于 Lua 编程语言的快速 2D 游戏原型引擎[Love2D 。](http://love2d.org/)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-11-23T10:40:42.600

[HGE](http://hge.relishgames.com/ "Haaf的游戏引擎") (C++, DirectX)

非常简单易用的 2D 游戏开发库。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-23T10:37:00.597

[http://wiki.blender.org/index.php/Game_Engine](http://wiki.blender.org/index.php/Game_Engine)

Blender Game Engine 是一个 3D 游戏开发环境，具有基于 Python 的“AI”系统。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-07-20T09:35:39.087

Flash 毫无疑问是游戏原型制作的最佳平台。使用 Flash，您可以在几个小时内运行游戏。与低级语言和框架相比，学习曲线一点也不差。

关于 Flash IMO 的好处是：

*   图形和代码可以在同一个应用程序中管理，非常方便。
*   ActionScript（Flash 的开发语言）使重用代码变得非常容易。
*   有大量的 2D、3D、物理等库，可以让您的游戏更加精美。
*   Flash 游戏可以在世界上 98% 的计算机上运行。
*   围绕 Flash（尤其是使用 Flash 进行游戏）的社区非常庞大且反应迅速。
*   社区。
*   我提到社区了吗？

总而言之，Flash 是 IMO 概念验证和快速游戏开发的最佳平台。社区使事情变得更容易，因为您想做的大部分事情已经做了很多次，并且通常在许多论坛和博客上讨论。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-24T16:50:35.817

你应该看看[Allegro](http://www.talula.demon.co.uk/allegro/)，它学起来很快，而且是一个很棒的原型设计库，即使你选择将它用于最终开发，它也是一个很棒的游戏库。

几年前我开始使用它，最近我读了一[本书](https://rads.stackoverflow.com/amzn/click/com/1598632892)，给我带来了很多全新的想法，我又开始研究它。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-24T07:15:28.567

试试 Game Maker 7 [http://www.yoyogames.com/gamemaker/](http://www.yoyogames.com/gamemaker/)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-07-20T09:06:00.817

我使用[SFML](http://www.sfml-dev.org/)。它类似于 SDL，但 OO 和更面向游戏开发。它是免费且非常易于使用的，具有清晰的文档和教程，不断开发，跨平台，并且绑定到 C、D、.NET、Python 和 Ruby。它是用 C++ 编写的。

我还建议一个优秀的 2d 物理引擎——Chipmunk Physics。它非常快，用 C 编写，绑定了 Python(pymunk) 和 Ruby 以及可能更多的语言，而且非常容易设置。快速搭建一个小游戏来测试一个想法很容易。

所以... Python 或 Ruby 与 Chipmunk Physics 和 SFML。还有 Ruby 的 Gosu 游戏引擎，并且有一些 Chipmunk Physics 集成，但我实际上没有使用这个。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-01T20:48:35.853

[ApocalyX](http://apocalyx.sourceforge.net/)值得一试，你使用 Lua 编写代码，虽然它不是那么快速、简单、干净或易于使用，但它有很多功能，而且其中的原型设计非常快。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-27T01:58:18.177

我碰巧喜欢 TorqueScript——它多年来一直为我服务——而且我喜欢 Torque Game Builder。对于 3D，他们有 Torque Game Engine 和 Torque Game Engine Advanced。[GarageGames](http://www.garagegames.com/products/browse/)是相当不错的东西。前面的学习曲线很小，但之后你就会开始航行

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-23T10:55:59.357

如果是2D游戏，QT的QGraphicsScene非常好用。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-03-22T22:36:57.297

[IndieLib](http://www.indielib.com/)这些天看起来很漂亮。也提供很多不错的教程和指南。它是 C++，但也有允许您使用 .NET 的包装器。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-11-04T22:30:01.387

[http://www.openprocessing.org/](http://www.openprocessing.org/)

很棒的资源——我们经常用它来制作图形效果和简单游戏机制的原型。

希望这可以帮助，

-汤姆

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-07T14:38:43.597

如果你的 coll 使用 2d 的动态语言，那么 PyGame 和 3d 我真的很喜欢 Panda3d，它们都是跨平台的。如果你不喜欢 python，你可以查看 XNA 或 TAO 都在 .NET 上运行，我认为 TAO 也可以在 Mono 上运行。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-06-02T14:33:06.237

我更喜欢使用 Unity3D 进行开发，但在原型设计方面没有什么能比得上 Flash。Flash 是一个完美的平台，用于在将游戏机制实施到生产流程之前对其进行测试和改进。学习曲线也很小。

Flash 使用 Actionscript 和 Unity Javascript，所以因为它们都是 ECMA 脚本语言，所以从原型到生产的过渡很顺利。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-11-27T01:53:04.880

我正在使用 Python 进行原型设计，CGKit 是一个令人难以置信的库，在 PyOpenGL 的帮助下，可以轻松创建可播放的演示，并且大多数优秀的 3d 内容创建工具都支持 Python 脚本，这对你来说是必不可少的。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-11-23T10:55:23.617

如果你喜欢动态语言，试试[Pygame](http://www.pygame.org)？另外，我认为您也可以使用这个来定位 OpenGL...取决于您在看什么。XNA Game Studio 很棒……或者你想看看一些 Mac 软件

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-10-16T15:18:17.140

我会选择[www.Unity3D.com](http://www.Unity3D.com)作为我的首选平台。

为什么？因为它是一个跨平台的框架，所以如果你以后付钱，你也可以发布到例如。iPhone、iPad、Android、Xbox、Playstation 和 Wii...

启动起来有点“困难”，但据我所知，它目前是 iPhone/iPad 3D 游戏开发最常用的平台之一。

你也可以做 2D 的东西，但引擎从一开始就是建立在 3D 之上的，包括心理、闪电、阴影，你可以使用免费许可证构建免费游戏。用户需要的只是下载并安装游戏（像往常一样）或在浏览器中玩游戏（这需要用户下载并安装插件，就像 Flash/Java 一样）

Unity3Dplayer 利用平台的 3D 加速，所以一些演示非常好看。

另一方面，Flash 对于图形艺术家来说是一个更简单的平台（从一开始），但它还没有真正为 3D 设计 - 今天史蒂夫乔布斯又名“苹果之神”仍然认为 iPhone/iPad 不应该能够运行 Flash 应用程序在他们的 iOS 中。（因为它可能会让太多的免费游戏在 AppleStore 之外通过，这将导致苹果在应用程序上的收入减少，也不会迫使开发人员学习如何编写原生 Objective-C）

所以我会选择 Unity3D

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-09-29T18:51:36.103

Flash 允许您开发游戏，这些游戏可以使用 AIR 作为桌面应用程序运行，也可以作为瘦客户端运行，可以在带有 flex 或 AS3 的浏览器中运行，甚至可以在带有 Flash Mobile 的手机中运行。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-07-17T17:22:36.547

许多尚普兰学院的游戏设计专业学生使用多媒体融合进行快速原型设计和开发。

这是这里已经很不错的答案列表中的另一个相当不错的部分。 [多媒体融合](http://www.clickteam.com/website/usa/)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2012-03-22T18:53:08.403

用于快速原型制作的 GameMaker。

我从未使用过 PyGames，但我的兄弟一直在使用它，如果您想要比 GameMaker 更强大的东西，我建议您尝试使用它，但老实说 GameMaker 非常强大。

对于 3D 游戏，我会尝试 Blender。Blender 可以使用 Python 进行扩展。我也听说过很多关于 Unity 的好消息。

对于在线游戏，我会使用 HTML5 的 GameMaker。或者我只会学习 HTML5。

我经常使用 python，虽然我从未将它用于游戏，但我可以看到它的易用性对游戏非常有益。我用 GameMaker 创建了一些游戏。这是一个非常好的程序。如果您想创建一些花哨的东西，请使用它。如果您想花时间创建自己的架构来构建游戏，请使用另一个程序。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-11-15T04:33:44.800

你可以使用铜立方。您可以在没有任何代码的情况下启动并运行基本游戏，然后使用内置脚本语言添加一些特定的游戏逻辑。然后它将编译为 Flash SWF 或本机 Windows EXE。

[您可以在此处](http://www.brighthub.com/hubfolio/matthew-casperson/blog/archive/2009/08/26/coppercube-tutorials.aspx)阅读一些教程来帮助您开始使用 Coppercube 。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-10-16T14:56:07.203

Flash 的一个有趣的变化（仅限 2D 游戏），**如果您的项目是 UI**密集型（例如战争游戏、角色扮演游戏、策略），也可以使用 Flex SDK 和 Flash Builder 4，它还允许您拖放 UI 组件并快速将原型对话框或界面等放在一起。如果您正在做一个典型的 Flash 射击游戏或休闲 Flash 游戏，我可能不建议在这种情况下使用 Flex。

# svn - Windows SVN 服务器上的 SVN 和 SVN+SSH 的区别？

> ID：312370
> 
> 赞同：4
> 
> 时间：2008-11-23T10:34:55.203
> 
> 标签：svn

我试图了解常规 svn:// 和 svn+ssh:// 访问在颠覆存储库安全性方面的差异。

我已经在自定义端口和 IP 地址中设置了我的 subversion 存储库，并在防火墙上打开了相同的端口，并将存储库配置为只允许经过身份验证的用户访问。

据我了解，subversion svn:// 访问通过 subversion 端口连接，而 svn+ssh:// 连接到 ssh 端口以创建到服务器的隧道（很像使用 PuTTY）。

我认为 svn+ssh 的使用是没有向世界开放 svn 端口的额外安全性，还是我错过了其他东西？

**编辑：** svn+ssh:// 命令与打开到我的服务器的 PuTTY 隧道并使用 svn://localhost/repository 有何不同？我已经阅读了几篇关于如何获得颠覆以使 svn+ssh 在 Windows 中工作的文章，但我无法完全理解。用 PuTTY 打开隧道就可以了，但我必须记住在调用 svn://localhost/repository 之前先打开它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T10:40:05.410

没错，根据[文档](http://svnbook.red-bean.com/en/1.0/ch06s03.html)，SSH 版本所做的是创建隧道，因此您将使用更安全的版本，而不是使用 svn“套接字”，使用 SSH 协议在两端之间进行通信。

svn+ssh:// 和使用 PuTTY 创建自己的隧道的区别在于前者的便利性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T10:44:03.310

使用 SSH 可确保加密流量，这样任何人都无法在途中截获您的消息。SSH 使用的加密在不安全的网络上提供数据的机密性和完整性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T10:55:14.083

如果我没记错 svn: 要求您运行 svn 服务器（它挂在套接字上并且可能被黑客入侵）。使用 svn+ssh：您不需要运行服务器。客户端通过正常的安全和加密的 ssh 连接到目标机器并远程启动必要的命令。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-24T12:34:39.890

[Subversion 1.5+] 如果你正确配置你的 svn:// 你会强制 svnserve 使用加密。这需要服务器端和客户端的 sasl 支持。

# debugging - 编写应用程序时的调试级别

> ID：312378
> 
> 赞同：23
> 
> 时间：2008-11-23T10:46:44.540
> 
> 标签：debugging

我想知道你们在编写应用程序时是否对调试级别有任何建议。

我考虑了4个级别：

0：无调试
1：所有输入和输出
2：来自具有主要参数的重要函数的“我在这里”通知
3：所有变量详细

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-23T11:11:58.730

这是我们在我参与的一个项目中所做的。这不是日志级别的圣经，只是一种可能性。日志记录应该适合您的情况。

*   LOG_SEVERE，需要程序退出的严重错误（例如，在应用程序中，您的磁盘空间不足）。
*   LOG_ERROR，无法恢复但程序可以继续运行的错误消息（例如，在服务器应用程序中，客户端通过错误数据发送但其他客户端可以继续运行）。
*   LOG_WARNING，应通知您的可恢复问题（例如，配置文件中的值无效，因此您退回到默认值）。
*   LOG_INFO，信息性消息。
*   LOG_ENTRY，记录所有函数的进入和退出。
*   LOG_PARM，记录所有函数的进入和退出，参数传递和返回值（包括全局影响，如果有的话）。
*   LOG_DEBUG，一般调试信息，基本有用的信息，可以单行输出。
*   LOG_HIDEBUG，更详细的调试消息，例如缓冲区的十六进制转储。

每个级别还记录了“较低”级别的消息。有时会出现关于调试消息应该是 LOG_DEBUG 还是 LOG_HIDEBUG 的问题，但我们主要基于它将推送到日志文件的行数。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-24T00:07:46.230

我通常使用的不仅仅是四个级别，尽管它们不一定有名称。`syslog`您可能会查看 ' ' 守护进程提供的级别。

```
0 - Emergency (emerg)
1 - Alerts (alert)
2 - Critical (crit)
3 - Errors (err)
4 - Warnings (warn)
5 - Notification (notice)
6 - Information (info)
7 - Debug (debug) 
```

（[log4j](https://logging.apache.org/log4j/2.x/manual/customloglevels.html)包在 'debug' 之下添加了一个级别，称为 'Trace'，但只提供了 'Fatal' where[`syslog`](http://man7.org/linux/man-pages/man3/syslog.3.html)并[`syslogd`](https://linux.die.net/man/8/syslogd)提供 Emergency、Alerts 和 Critical。）这些不是直接相关的，但应该让您稍作思考。Pax 提供的列表非常合理。

我经常发现有用的一件事是调试分段——可以为系统的不同组件设置不同级别的调试。例如，根据问题出在哪里，我可能需要在输入部分和宏管理部分进行大量调试，而在主处理代码中不需要任何调试。整个程序的单一调试级别总比没有好得多，但对于复杂的程序，差异化是无价的。

[您可以在我的SOQ](https://github.com/jleffler/soq)（堆栈溢出问题）存储库中找到我在 GitHub 上使用的源代码，即[src/libsoq](https://github.com/jleffler/soq/tree/master/src/libsoq) 子目录中的 files `debug.h`、`debug.c`、 。`mddebug.c`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-23T12:33:17.617

我有：

*   严重/致命，程序无法继续，通常用户丢失它。
*   错误，确实有问题，使用的数据可能已损坏，但您可能很幸运。
*   警告，这是不对的，我可以继续，但请看一下。
*   提示/信息，我喜欢说点什么，但我不希望你听。
*   调试，所有信息只对程序员感兴趣。

通常最低的两个级别被阻止。但是其他的都显示了。而且如果你想挡住Fatal关卡，我也没问题，但别指望我事后收拾烂摊子（可惜我还是要……）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T10:56:51.523

无论您选择什么，都会有一些您想看到的东西，它只是进入下一个级别......

我认为这个问题没有一个普遍的答案，因为它非常依赖于应用程序在做什么。就像海恩斯手册中的油腻页面（英国读者会明白我的意思），我倾向于发现您最终会在传统上很麻烦的地区进行大量伐木，而在将导致的地区几乎没有你麻烦*下*。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T11:10:55.927

这是我的清单：

*   静音模式：

应用程序不会发出任何与调试相关的信息。在任何情况下，应用程序都不会向 UART 或调试控制台发送任何内容。

*   错误模式：

硬性和不可恢复的错误记录到控制台。

*   警告模式：

启用旨在帮助其他程序员的额外调试信息。

这种模式不是为了捕捉错误，而是为了向使用我的应用程序/库的其他程序员提供信息。在警告模式下，我主要检查输入参数并尝试检测是否有人试图做一些愚蠢的事情。就像蛮力解决方案或仅传递最慢的数据类型一样。

*   调试模式（1-4 级）

在调试模式下，我开始记录所有内容，按出现频率排序。第一级不是很冗长。我的程序/应用程序所做的主要事情都会被记录下来。不多了。此模式旨在用于粗略了解客户正在做什么。

调试模式越高，记录的信息就越多。

我的最高调试级别是为所有进程间和线程间通信保留的。所有对信号量、互斥体等的访问都将尽可能详细地记录下来。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T12:56:51.267

0：不记录

1：异常记录：记录每个抛出的错误。例如在 c# 中：登录 catch 块。当这些日志操作被触发时，你就知道你有一个错误。如果存在不应该被击中的情况等，您还可以登录 switch 语句。

2：操作记录：记录操作，不在catch块中（正常操作），应设置为高调试。通过这种方式，您可以看到哪个方法开始执行，然后在一个 catch 块中结束。

另外，请考虑日志记录开关，例如数据包日志记录（true：记录网络数据包/消息，false：不记录）。只是不要过度使用开关。

在异常处理中，每个方法体至少应该在一个 try-catch 块中，至少在末尾有一个通用的异常捕获。将日志记录放在 catch 块中，在系统消息和堆栈跟踪之外添加可选信息以指示导致错误的原因，然后抛出错误。仅当用户收到错误通知，或者您处于没有活动用户界面的应用程序的顶层时，才停止进一步抛出错误。（例如服务器端日志记录。）然后您需要在给客户端应用程序的消息中指出服务器端发生了错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-23T12:19:37.050

我缩进将调试日志与审计日志和异常日志分开。因此，信息性的日志，例如成功或未成功完成的函数 SendMessage 将是审核日志，但应用程序发送导致异常的消息的任何失败的日志将是异常日志。

调试日志仅用于调试目的。这些级别由我选择调试的严重程度。

我认为对于在一个小组中工作的开发人员来说，在开始编码之前设置这些规则很重要。所以日志记录将是一致的。

感谢您的好建议！

暗里。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-23T11:12:06.530

对于不同级别的日志记录，真正最重要的是所有开发人员都使用相同的定义。

我已经看到开发人员在未能交付数据包时从 tcp 包记录错误的示例，即使该数据包已被处理并由调用者完成重新发送。
有问题的开发人员说：“但在这种情况下，这是一个错误”。

您需要定义如下内容：
错误意味着*应用程序*失败并需要重新启动。
警告可能意味着应用程序的单个功能已失败，但应用程序可以恢复并继续
等等......

级别的确切数量并不像在整个应用程序中一致使用这些级别那么重要。

如果可以在运行时更改级别并且可能的话为应用程序的不同部分选择不同的级别，这将非常有帮助。

# wpf - WPF 绘图笔刷性能

> ID：312379
> 
> 赞同：2
> 
> 时间：2008-11-23T10:47:10.637
> 
> 标签：wpf

我需要在画布的背景上绘制网格线，该画布上将放置其他控件。

我尝试创建一个 StreamGeometry，使用它来绘制线条，并将其分配给 DrawingBrush。但是我发现如果 StreamGeometry 的行太多，在将 DrawingBrush 分配给 Canvas 后程序会变得迟缓。

是否有“预渲染”网格线并将其分配给画布？

我尝试`Freeze()`了画笔和几何，但这似乎不起作用。我还有什么其他选择？

这是我的代码：

```
public void RenderGrid()
{
    this.UpdateGrid();
    Pen grid_pen = new Pen(Brushes.Blue, 0.1);
    StreamGeometry sg = new StreamGeometry();

    DrawingBrush b = new DrawingBrush();
    GeometryDrawing gd = new GeometryDrawing();
    gd.Geometry = sg;
    gd.Pen = grid_pen;
    b.Drawing = gd;

    StreamGeometryContext ctx = sg.Open();
    foreach (double d in this.VerticalGrids)
    {

        ctx.BeginFigure(new Point(d, 0), true, false);
        ctx.LineTo(new Point(d, this.RenderSize.Height), true,false);
    }
    foreach (double d in this.HorizontalGrids)
    {

        ctx.BeginFigure(new Point(0, d), true, false);
        ctx.LineTo(new Point(this.RenderSize.Width, d),true, false);
    }
    ctx.Close();
    sg.Freeze();
    gd.Freeze();

    b.Freeze();
    this.Background = b;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-24T03:00:06.570

我的建议是保持原始倒计时。您正在使 WPF 花费 CPU 周期和带宽来创建大量网格并将其发送到渲染线程和 GPU。

DrawingBrush 是一个[TileBrush](http://msdn.microsoft.com/en-us/library/system.windows.media.tilebrush.aspx)。

在 DrawingImage 上绘制一个网格单元，并使用 TileMode、Viewbox 和 Viewport 属性来平铺网格。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-08T06:21:57.657

The [solution offered by Ifeanyi Echeruo](https://stackoverflow.com/questions/312379/wpf-drawingbrush-performance#313314) worked very nicely for me. However, I also needed the grid to scale dynamically. Rather than rebuild the brush each time, I used a single xaml-defined brush for the background of my element, then implemented some hooks to rescale that brush each time the grid lines needed to be resized.

Using the LocalValueEnumerator on the element's Background property, I update the brush's "Viewport" property each time a rescale is needed

```
<DrawingBrush x:Key="MyBrush" TileMode="Tile" Stretch="Fill" 
  Viewport="0,0,250,250" ViewportUnits="Absolute">

LocalValueEnumerator props = Background.GetLocalValueEnumerator();
while (props.MoveNext())
{
  DependencyProperty prop = props.Current.Property;
  if ((prop.Name == "Viewport") && (!prop.ReadOnly))
  {
    Background.SetValue(prop, new Rect(0, 0, m_ColumnWidth, m_RowHeight));
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T19:32:19.720

一种解决方案是覆盖面板上的 OnRender(DrawingContext dc) 方法并在其中绘制线条。

另一种选择是使用轻量级的视觉元素来绘制线条。此元素应添加到面板的可视化树中。当 ShowGridLines 属性设置为 true 时，标准 WPF Grid 控件使用类似的方法在行和列之间绘制线条。

# unit-testing - 您如何调整单元测试以应对不断变化的需求？

> ID：312388
> 
> 赞同：6
> 
> 时间：2008-11-23T11:01:12.327
> 
> 标签：unit-testing

我有一个项目，我一直在使用 TDD 和单元测试作为“软件虎钳”。本质上，我将需求转化为验证代码是否符合需求的测试。我很少需要回过头来编辑单元测试，这才是重点：只有“真正的”代码应该被修改。目前，有 900 个单元测试。

现在，金主改变了一些要求。由于以前的要求在现有的单元测试中被如此彻底地编码，似乎改变它们以符合新的要求会招致灾难。你如何调整你的单元测试套件来处理这种变化？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T11:12:05.783

根据定义，[单元测试](http://en.wikipedia.org/wiki/Unit_testing)不会复制应用程序的需求。它们描述了模块的要求。这是一个区别，即使在具有不同要求的应用程序中也可以重用该模块，或者根本不使用该模块。因此，不断变化的需求不会影响真正的单元测试（除非您必须为新模块编写新的或放弃旧的测试，以便不再需要更改的需求的模块）。

另一方面：[验收测试](http://en.wikipedia.org/wiki/Acceptance_testing)处理应用程序级别的要求。所以我认为你谈论的是验收测试。

我会将新要求添加为新的验收测试。但是对于旧的，您必须仔细查看它们，它们是如何因更改要求而失效的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T11:37:58.163

我会添加新的测试并让它们通过。然后你看看哪些测试被破坏了。如果您认为旧测试与新测试相矛盾，那么您可能必须删除旧测试。否则，您更改代码以使旧测试也通过。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T11:41:04.990

> 本质上，我将需求转化为验证代码是否符合需求的测试

虽然我同意 Mnementh 的回答，但对我来说，这是关键评论。如果测试是需求的翻译版本，那么如果需求已更改，则测试必须更改。

或者他们正在测试不符合客户要求的东西。

> 据报道，正如约翰·梅纳德·凯恩斯所说：“当事实发生变化时，我会改变我的看法。先生，你是做什么的？”

我认为这里有一个类似的情况。你的事实已经为你改变了

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T09:05:25.380

> 由于以前的要求在现有的单元测试中被如此彻底地编码，似乎改变它们以符合新的要求会招致灾难。

有什么具体的理由让你这么想吗？我感到有些恐惧，还是只是“在工作时不要破坏它”

改变发生。在这种情况下，这意味着更多的工作时间金钱。如果业务没有问题，你也不应该（除非时间表是不人道的：）。如果规格发生变化，

*   确保已签入工作版本。
*   重复步骤 1 以确定。
*   扫描您的测试套件。找到你需要取出的。找到需要改变的。查找您需要了解的新测试。用一张白纸做笔记
*   现在一次进行一项测试。除非您没有遵循 DRY / Once and only once 原则，否则您需要进行的任何更改都应该在一个地方进行。如果没有，您应该早点进行重构.. 但现在还不算晚.. 在进行更改之前将代码提取到一个地方
*   重复上一步直到完成

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T11:20:31.390

如果您的单元测试不再符合要求，那么它们不应该存在——毕竟——它们现在告诉你的只是你的代码符合不再存在的要求！

每当您的需求发生变化时，您应该更改代表已更改需求的测试并验证测试现在是否失败（而以前它们都通过了，对吧？;)）

然后更改您的源代码，以便重新编写的测试现在通过。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-24T01:20:30.470

我对你的问题有两个答案，一个是哲学的，另一个是战术的。

在哲学方面，将单元测试视为代码很重要。这意味着好的代码的所有正常特征通常​​都适用于好的测试：意图揭示、删除重复等。我在单元测试中看到的许多（也许是大多数）失败都是因为人们没有处理他们的测试这种方式，而不是仅仅对它们进行编码并且从不重新访问它们以查看它们是否应该被重构。

以我的经验，如果你的单元测试成为改变的障碍，那是因为你的测试中有技术债务。

所以我的战术建议是，在你尝试改变你的需求之前，你应该重构你的测试。每个测试都应该有一个通过/失败的唯一理由，并且在此之外的行为应该在共享代码中。这意味着对于任何给定的行为更改，您将有两个地方来更改测试：

1.  实际验证该行为的测试
2.  共享夹具代码中使用行为的地方

您可能会发现这篇文章很有用：[自然地种植您的线束](http://www.developertesting.com/archives/month200508/20050824-Grow-your-harness.html)。它实际上是关于功能测试的可重用测试工具，但我发现这些想法在我的单元测试中也非常有用。

# mysql - Joins 和 where 条件

> ID：312400
> 
> 赞同：1
> 
> 时间：2008-11-23T11:16:21.453
> 
> 标签：mysql, join, where

我有以下（缩短的查询）：

```
SELECT 
    `Statistics`.`StatisticID`,
    COUNT(DISTINCT `Flags`.`FlagType`) AS `FlagCount`
FROM `Statistics`
LEFT JOIN `Flags` ON `Statistics`.`StatisticID` = `Flags`.`StatisticID`
WHERE `FlagCount` = 0
GROUP BY `Statistics`.`StatisticID`
ORDER BY `SubmittedTime` DESC
LIMIT 0, 10 
```

现在，在子句中都没有`FlagCount = 0`或`COUNT(Flags.FlagType)`工作。`WHERE`我考虑过使用 a`SET`但我不确定如何将它添加到查询中。有任何想法吗？

谢谢，

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T11:22:37.167

使用[`HAVING COUNT(DISTINCT Flags.FlagType) = 0`](http://dev.mysql.com/doc/refman/5.0/en/select.html).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T12:40:17.570

如果 HAVING 不起作用，也许您可​​以尝试子查询。

```
SELECT 
    `Statistics`.`StatisticID`,
    COUNT(DISTINCT `Flags`.`FlagType`) AS `FlagCount`
FROM `Statistics`
    LEFT JOIN `Flags` ON `Statistics`.`StatisticID` = `Flags`.`StatisticID`
WHERE `Statistics`.`StatisticID`
  IN (SELECT `Flags`.`StatisticID` 
      FROM `Flags`
      HAVING COUNT(DISTINCT `Flags`.`FlagType`) <= 3
      GROUP BY `Flags`.`StatisticID`
  )
GROUP BY `Statistics`.`StatisticID`
ORDER BY `SubmittedTime` DESC
LIMIT 0, 10 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T11:29:02.283

试试这个：

```
SELECT 
    `Statistics`.`StatisticID`,
    COUNT(DISTINCT `Flags`.`FlagType`) AS `FlagCount`
FROM `Statistics`
LEFT JOIN `Flags` ON `Statistics`.`StatisticID` = `Flags`.`StatisticID`
                     And `FlagCount` = 0
GROUP BY `Statistics`.`StatisticID`
ORDER BY `SubmittedTime` DESC
LIMIT 0, 10 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T12:04:35.177

@eed3si9n

这部分有效 - 但是我需要它是 <= 3 这似乎不起作用。

此外，该`HAVING`子句最后执行，它不会返回我需要的结果（由 设置`LIMIT`）。有没有办法我可以在一个`WHERE`子句中做到这一点？

# c# - 静态链接优势

> ID：312406
> 
> 赞同：10
> 
> 时间：2008-11-23T11:24:12.187
> 
> 标签：c#, linker

我最近在这里阅读了一个关于静态和动态链接的问题，这让我想起了一些关于它的问题。从那篇文章中，我可以看到技术差异是什么（直接包括目标文件内容，而不是仅仅指向它），但我想更多地了解这样做的利弊。

前段时间，我的一位从事编程多年的朋友感叹 C# 没有静态链接，并说这是他未来版本最想要的功能。不幸的是，我是新手，并不真正理解这种说法。

感谢您的任何启发！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-23T11:38:58.677

静态链接的优点是它消除了对库的外部依赖——也就是说，您正在使用的库的行为永远不会改变，因为有人更改了磁盘上的库。这也是静态链接的缺点之一。如果操作系统发生变化并且需要新版本的库才能正常工作，则必须提供二进制文件的升级版本。同样，如果将错误修复添加到库中，如果您已静态链接，则不会自动获得该错误修复。

大多数（事实上，可能是所有这些天）操作系统可以为多个进程加载一个动态库的副本，这就是为什么在 UNIX 上它们被称为共享对象。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-23T11:36:24.033

静态可执行文件包含它需要的所有对象，因此在执行时不会调用外部 DLL。优点是可以跨许多平台移植，无论该系统上安装了什么版本的 DLL。最大的缺点是您可能会浪费磁盘空间，因为您包含在系统/外部 DLL 中已经存在的可执行代码中。此外，我认为，但我不太确定，DLL 在主内存中只加载一次，无论有多少可执行文件正在使用它们，但是如果你静态链接可执行文件中的库对象，你会加载相同的代码两次（一个用于其余程序使用的 DLL 和一个用于您的可执行文件的 DLL）。另一方面，这可能是一个优势而不是一个劣势，因为可执行文件只包含它需要的外部库的对象，而不是整个库。当应用程序需要 DLL 时，它会作为一个整体加载到内存中。

静态链接非常适合编译您希望作为小工具从一个系统携带到另一个系统的小型应用程序。也就是说，当它没有包含在每个 Linux 发行版中时，拥有一个静态编译版本的 tcpdump 对我来说真的很有用。无论内核、glibc 或其他系统库有什么版本，它都必须在每个 Linux 上工作。也许它在 Windows 世界中没有多大意义，因为平台更加同质化。如果您为 Windows XP / NET vX.X 进行编译，它将适用于许多计算机。如果您为 Debian XX 编译某些东西，它肯定无法在较旧/较新的 Debian 或其他发行版（如 Redhat）上运行。

这个[帖子](https://stackoverflow.com/questions/311882/what-do-statically-linked-and-dynamically-linked-mean)也可以解决你的问题。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-23T12:05:39.107

老实说，出于一百万个原因，我不确定静态链接在 C# 中是否真的是一个好主意。一个原因是，与 C 或 C++ 等语言相比，C# 具有程序集的概念，程序集基本上是可执行文件或 DLL。

现在，如果您想在 .NET 中静态链接事物，您要么

*   将多个程序集中的类合并到一个程序集中。这会破坏很多东西，比如“**内部**”访问修饰符。
*   在同一个可执行文件中有多个程序集。但是，这将使程序集的整个概念变得毫无用处，并且需要重新设计 .NET Framework 中的反射方法。

我确信有一种巧妙的方法可以避免这些问题，但我不太明白在 .NET 或 Java 等托管环境中进行静态链接的意义。我的意思是，静态链接确实可以提高性能，但并没有那么多。无论如何，我们不会使用托管语言来提高它们的执行速度。

另一个问题是 DLL 地狱，但在 .NET 中，这几乎是一个已解决的问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-11-10T02:57:28.777

所有需要的东西都打包成一个可执行文件。所以，

*   你不需要安装任何其他的东西。只需复制并运行。或者跑到它所在的地方。没有安装程序，没有警告，没有由于错误的 DLL 版本而导致的奇怪错误。就这样。
*   您的用户也可以享受这种简单性。这通常更为重要。没有人欢迎安装依赖项。特别是如果它像 .NET 框架一样庞大。

当然可执行文件的大小会增加，但它应该小于一堆愚蠢的图形文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-15T16:28:23.343

有一个很好的例子来说明静态链接和动态链接之间的区别。如果您查看 InkScape 项目，您会发现[InkscapePortable](http://portableapps.com/apps/graphics_pictures/inkscape_portable)和 InkScape。InkscapePortable 将使用 USB 记忆棒运行。InkScape 不会。

# .net - 使用 Oslo 和 M 有什么优势，您什么时候使用？

> ID：312412
> 
> 赞同：6
> 
> 时间：2008-11-23T11:33:19.563
> 
> 标签：.net, modeling, oslo, m

在参加了关于 Oslo/MI 的演讲后，我有点想了解使用它相对于现有方法的优势以及它在什么情况下有用。

我知道它很新，并非所有细节都已发布等，但有人能给我一些优势吗？你什么时候可以使用它？

谢谢，

亚历克斯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T12:32:32.577

这个问题似乎有您正在寻找的答案：
[模型驱动开发有什么好处？](https://stackoverflow.com/questions/308803/what-is-model-driven-development-good-for)

Erik Wynne 有一篇关于这个主题的不错的博文：
[Oslo == 42](http://erikwynne.blogspot.com/2008/11/oslo-42.html)

他还链接到 MSDN 上的一篇文章，其中包含一些有趣的想法：
[我们为什么需要奥斯陆？](http://social.msdn.microsoft.com/Forums/en-US/oslo/thread/ae08521d-c61b-4622-9a12-3d572bd97b6a)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T14:03:27.077

我没有玩过 Oslo alpha 位，但我的肤浅理解是：

*   试图让开发人员更容易以对他们工作的领域有意义的方式表达和存储他们的想法——即领域建模。

*   试图在程序执行期间使这些存储的想法可访问。

因此，更多的趋势是声明性而不是程序性逻辑。这似乎是发展世界的发展方式。我是个老顽固，远未信服。

但是我们不能继续像埃及金字塔那样制作软件，数百万块砖相互堆叠，没有结构完整性，只有蛮力和成千上万的奴隶。所以我们需要这些新想法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T15:25:42.437

模型共享也将变得普遍，特别是一旦奥斯陆存储库可以托管在云中的 SQL 数据服务中。模型互操作性是游戏的名称。

Oslo 有一些意想不到的用途，这些用途将变得普遍，但最初我知道它们的目标是支持想要创建 Microsoft CRM 和 Sharepoint 等应用程序的开发人员。这些系统是数据驱动的，直至用户界面布局。对于某些类型的系统，它是一种有效且富有成效的方法，并提供了一个非常可扩展和可维护的架构。

有关更多信息，请参阅我在奥斯陆的文章：http: [//dvanderboom.wordpress.com/2009/01/17/why-oslo-is-important/](http://dvanderboom.wordpress.com/2009/01/17/why-oslo-is-important/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-24T23:07:00.690

再想一想，在阅读了 Qdoom 和 RoadWarrior 发布的文章后，我可以看到 Oslo 帮助分享，

好的，您可以使用 xml 和 xsd 之类的东西共享模型，但 Oslo 可以让它更容易，因为看起来您可以从它们生成类和数据库，同时将模型存储在中央存储库中。

也许以后人们也会出售常见场景的模型。

# checkbox - 支柱复选框

> ID：312424
> 
> 赞同：2
> 
> 时间：2008-11-23T11:49:22.260
> 
> 标签：checkbox, struts, field

我正在尝试将`fieldValue`复选框设置为我从属性标签中获得的值。

我在语法上有问题。

这是我尝试过的：

```
<s:form id="myForm" method="post" action="removeUser" enctype="multipart/form-data">
     <s:iterator value="myList">
        <tr>
            <td><s:property value="id"/></td> 
            <td><s:property value="name"/></td> 
            <td><s:property value="email"/></td>
            <td><s:checkbox label="delete" name="delete" fieldValue="<s:property value='id'/>"/></td>
        </tr>
    </s:iterator>

    <s:submit id="saveForm" value="Delete users"></s:submit>
  </s:form> 
```

然而，它一直把我`true`作为`fieldValue`

熟悉struts的人可以帮帮我吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T14:38:51.637

我认为你不能这样做：

*<s:checkbox label="delete" name="delete" fieldValue="<s:property value='id'/>"/>*

fieldValue 需要一个 OGNL 表达式。我做了一些Struts，不是太多，你可以试试：

字段值="%{id}"

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-29T15:33:23.143

尝试做：

```
fieldValue="<s:property value= "${id }"  />" 
```

或者

```
fieldValue="<s:property value=<c:out value="${id }"/>   />" 
```

这将需要：

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%> 
```

# php - 我正在使用 Zend gdata 打开文档，希望能够读写电子表格单元格

> ID：312427
> 
> 赞同：0
> 
> 时间：2008-11-23T11:55:57.240
> 
> 标签：php, zend-framework, gdata-api, spreadsheet

我不擅长编程并且我试图打开我的电子表格文档之一。在下面使用的基本登录信息中，然后我请求列出我的所有电子表格，该电子表格在 $feed 中返回。

现在我担心我在打开文档时没有走上正确的轨道，所以我可以读写单元格。

```
<?php

require_once '../library/Zend/Loader.php';
Zend_Loader::loadClass('Zend_Gdata_Spreadsheets');
Zend_Loader::loadClass('Zend_Gdata_ClientLogin');
$user="username";
$pass="user password";

// login
$service = Zend_Gdata_Spreadsheets::AUTH_SERVICE_NAME;
$client = Zend_Gdata_ClientLogin::getHttpClient($user, $pass, $service);

$spreadsheetService = new Zend_Gdata_Spreadsheets($client);
$feed = $spreadsheetService->getSpreadsheetFeed();

print_r ($feed);
?> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T18:00:50.250

我忘记了我的 id 是哪个社交网络，所以我激活了一个新的。有点像赛隆。

> 我查看了zend手册。我是 php 新手，所以访问 $feed 之类的对象仍然令人困惑。Zend 文档需要更好地利用 http 来扩展存在的信息。
> 
> IE。来自zend手册的报价
> 
> > “鉴于您已经检索到的 Zend_Gdata_Spreadsheets_SpreadsheetEntry 对象的电子表格键，您可以获取包含与该电子表格关联的工作表列表的提要。”

$feed 返回[Zend_Gdata_Spreadsheets_SpreadsheetEntry](http://framework.zend.com/apidoc/core/Zend_Gdata/Spreadsheets/Zend_Gdata_Spreadsheets_SpreadsheetEntry.html)对象

好的，所以我学会了使用下面的代码显示可用的文件。

> foreach ($feed->entries as $entry) {
> echo $entry->title->text .' '。$entry->content->文本。"\n"; }

我想我开始明白了，但不确定我应该读什么。

[http://framework.zend.com/apidoc/core/Zend_Gdata/Spreadsheets/Zend_Gdata_Spreadsheets.html](http://framework.zend.com/apidoc/core/Zend_Gdata/Spreadsheets/Zend_Gdata_Spreadsheets.html) 也在制作更多场景。但它缺少指向[http://code.google.com/apis/spreadsheets/docs/2.0/developers_guide_protocol.html#ListingSpreadsheets](http://code.google.com/apis/spreadsheets/docs/2.0/developers_guide_protocol.html#ListingSpreadsheets)的链接，它是 $feed 上的结构，以及指向一个片段的指针。

尝试更多了解如何在 PHP 中使用对象类和函数。读取 [类变量、范围解析运算符和不同版本的 PHP](https://stackoverflow.com/questions/539677/class-variables-scope-resolution-operator-and-different-versions-of-php)

[这是在 PHP 类中处理 getter/setter 的合理方法吗？](https://stackoverflow.com/questions/32145/is-this-a-reasonable-way-to-handle-getters-setters-in-a-php-class)

我有没有提到这一点，[http://code.google.com/apis/spreadsheets/docs/2.0/developers_guide_protocol.html#ListingSpreadsheets](http://code.google.com/apis/spreadsheets/docs/2.0/developers_guide_protocol.html#ListingSpreadsheets)

[http://zendguru.wordpress.com/2009/04/17/zend-framework-select-statement-and-where-clause-examples/](http://zendguru.wordpress.com/2009/04/17/zend-framework-select-statement-and-where-clause-examples/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T08:04:53.840

你在正确的轨道上。您是否正在使用[http://framework.zend.com/manual/en/zend.gdata.spreadsheets.html](http://framework.zend.com/manual/en/zend.gdata.spreadsheets.html)找到的信息？

您的代码正在获取一个电子表格提要，其中列出了所有可用的电子表格，这是重要的一步。您需要按照上面的链接获取基于列表的提要或基于单元格的提要。

该文档非常好，我建议您通读一遍（是的，它很长）。

# logging - 使用策略注入应用程序块进行日志记录

> ID：312428
> 
> 赞同：2
> 
> 时间：2008-11-23T11:59:06.343
> 
> 标签：logging, enterprise-library, marshalbyrefobject, policy-injection

**大家好**

我想问一下，在这些情况下如何使用策略注入应用程序块来记录方法的进入和退出：

**案例1：** 在记录 Web 表单控件的事件处理程序的情况下，您知道该类假设 _Default 必须从类**System.Web.UI.Page**继承，因此我们不能从**MarshalByRefObject**类继承我们的类，因此日志记录将不起作用.

**Case2：**如果我们有一个**静态**类并且我们必须记录其中的方法，我们可以做些什么来从**MarshalByRefObject** calss 继承这个类，以便获得日志记录工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T14:14:13.217

在我看来，他们有一些愚蠢的要求才能应用日志记录......这可能是一个题外话，但您可能希望查看 Spring.AOP 框架以将日志记录应用到您的对象，而无需从 MarshalByRefObject 继承。（在多重继承截断语言中，我认为这是一个烦人且苛刻的要求）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T02:54:06.407

关于案例 1，策略注入块能够作用于您拥有接口的对象。如果您在编写时还没有考虑到接口，可以使用 Refactor->Extract Interface 操作在 Visual Studio 中轻松完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-25T17:32:33.827

关于案例 2，您的“静态”类实际上不可能是静态类。它可以从 MarshalByRefObject 继承或实现您指定的接口。然后它可以有一个私有构造函数和一个你策略注入的单例实例。您的所有静态方法只会在类的单例实例上调用相应的（策略注入）实例方法。

# macos - Mac OS X 10.4+ 上的 Bash 配置

> ID：312435
> 
> 赞同：8
> 
> 时间：2008-11-23T12:06:08.060
> 
> 标签：macos, bash, configuration, shell

在 OSX 上配置 bash 时，`~/.profile`它似乎一旦`~/.bash_profile`存在就完全忽略它。如果这是正确且预期的行为，我应该添加我的额外配置内容`~/.bash_profile`还是使用它来代替`~/.profile`？

提前致谢。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-23T12:11:11.327

这是预期的行为。看[这里](http://telin.ugent.be/~slippens/drupal/bashrc_and_others)

> 当 bash 作为交互式登录 shell 或作为带有 --login 选项的非交互式 shell 调用时，它首先从文件 /etc/profile 中读取并执行命令（如果该文件存在）。读取该文件后，它会按顺序查找 ~/.bash_profile、~/.bash_login 和 ~/.profile，然后从第一个存在且可读的文件中读取并执行命令。

所以只有第一个可读的才重要。

至于您应该使用哪个，这取决于您 - 除非有公司政策或其他创建特定政策或依赖现有特定政策的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T22:51:20.037

它将是“源〜/ .profile”

# python - 你如何将列表分成大小均匀的块？

> ID：312443
> 
> 赞同：2795
> 
> 时间：2008-11-23T12:15:52.050
> 
> 标签：python, list, split, chunks

我有一个任意长度的列表，我需要将它分成大小相等的块并对其进行操作。有一些明显的方法可以做到这一点，比如保留一个计数器和两个列表，当第二个列表填满时，将其添加到第一个列表中，并为下一轮数据清空第二个列表，但这可能非常昂贵。

我想知道是否有人对任何长度的列表有一个很好的解决方案，例如使用生成器。

我一直在寻找有用的东西，`itertools`但找不到任何明显有用的东西。不过可能错过了。

相关问题：[以块为单位迭代列表的最“pythonic”方式是什么？](https://stackoverflow.com/questions/434287/what-is-the-most-pythonic-way-to-iterate-over-a-list-in-chunks)

* * *

## 回答 #1

> 赞同：4018
> 
> 时间：2008-11-23T12:33:53.433

这是一个产生你想要的块的生成器：

```
def chunks(lst, n):
    """Yield successive n-sized chunks from lst."""
    for i in range(0, len(lst), n):
        yield lst[i:i + n] 
```

* * *

```
import pprint
pprint.pprint(list(chunks(range(10, 75), 10)))
[[10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],
 [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
 [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
 [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
 [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
 [70, 71, 72, 73, 74]] 
```

* * *

如果您使用的是 Python 2，则应使用`xrange()`而不是`range()`：

```
def chunks(lst, n):
    """Yield successive n-sized chunks from lst."""
    for i in xrange(0, len(lst), n):
        yield lst[i:i + n] 
```

* * *

您也可以简单地使用列表推导而不是编写函数，尽管将这样的操作封装在命名函数中是一个好主意，以便您的代码更容易理解。蟒蛇 3：

```
[lst[i:i + n] for i in range(0, len(lst), n)] 
```

Python 2 版本：

```
[lst[i:i + n] for i in xrange(0, len(lst), n)] 
```

* * *

## 回答 #2

> 赞同：635
> 
> 时间：2009-11-17T20:17:16.617

如果你想要一些超级简单的东西：

```
def chunks(l, n):
    n = max(1, n)
    return (l[i:i+n] for i in range(0, len(l), n)) 
```

在 Python 2.x 的情况下使用`xrange()`而不是`range()`

* * *

## 回答 #3

> 赞同：355
> 
> 时间：2013-06-05T08:54:26.183

我知道这有点老了，但还没有人提到[`numpy.array_split`](https://docs.scipy.org/doc/numpy/reference/generated/numpy.array_split.html)：

```
import numpy as np

lst = range(50)
np.array_split(lst, 5)
# [array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]),
#  array([10, 11, 12, 13, 14, 15, 16, 17, 18, 19]),
#  array([20, 21, 22, 23, 24, 25, 26, 27, 28, 29]),
#  array([30, 31, 32, 33, 34, 35, 36, 37, 38, 39]),
#  array([40, 41, 42, 43, 44, 45, 46, 47, 48, 49])] 
```

* * *

## 回答 #4

> 赞同：336
> 
> 时间：2008-11-23T15:48:53.540

直接来自（旧）Python 文档（itertools 的食谱）：

```
from itertools import izip, chain, repeat

def grouper(n, iterable, padvalue=None):
    "grouper(3, 'abcdefg', 'x') --> ('a','b','c'), ('d','e','f'), ('g','x','x')"
    return izip(*[chain(iterable, repeat(padvalue, n-1))]*n) 
```

JFSebastian 建议的当前版本：

```
#from itertools import izip_longest as zip_longest # for Python 2.x
from itertools import zip_longest # for Python 3.x
#from six.moves import zip_longest # for both (uses the six compat library)

def grouper(n, iterable, padvalue=None):
    "grouper(3, 'abcdefg', 'x') --> ('a','b','c'), ('d','e','f'), ('g','x','x')"
    return zip_longest(*[iter(iterable)]*n, fillvalue=padvalue) 
```

我猜Guido 的时间机器工作——工作——将工作——将工作——又工作了。

这些解决方案之所以有效，是因为`[iter(iterable)]*n`（或早期版本中的等效方案）创建了*一个*迭代器，`n`在列表中重复了多次。`izip_longest`然后有效地执行“每个”迭代器的循环；因为这是同一个迭代器，所以每次这样的调用都会推进它，导致每个这样的 zip-roundrobin 生成一个`n`项目元组。

* * *

## 回答 #5

> 赞同：254
> 
> 时间：2014-02-26T15:02:00.293

我很惊讶没有人想到使用`iter`'s 的[两个参数形式](http://docs.python.org/2/library/functions.html#iter)：

```
from itertools import islice

def chunk(it, size):
    it = iter(it)
    return iter(lambda: tuple(islice(it, size)), ()) 
```

演示：

```
>>> list(chunk(range(14), 3))
[(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, 11), (12, 13)] 
```

这适用于任何可迭代对象并延迟生成输出。它返回元组而不是迭代器，但我认为它仍然具有一定的优雅性。它也不垫；如果你想要填充，上面的简单变化就足够了：

```
from itertools import islice, chain, repeat

def chunk_pad(it, size, padval=None):
    it = chain(iter(it), repeat(padval))
    return iter(lambda: tuple(islice(it, size)), (padval,) * size) 
```

演示：

```
>>> list(chunk_pad(range(14), 3))
[(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, 11), (12, 13, None)]
>>> list(chunk_pad(range(14), 3, 'a'))
[(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, 11), (12, 13, 'a')] 
```

与`izip_longest`基于 - 的解决方案一样，上述解决方案*总是很*重要。据我所知，对于可以*选择*填充的函数，没有单行或两行 itertools 配方。通过结合上述两种方法，这个方法非常接近：

```
_no_padding = object()

def chunk(it, size, padval=_no_padding):
    if padval == _no_padding:
        it = iter(it)
        sentinel = ()
    else:
        it = chain(iter(it), repeat(padval))
        sentinel = (padval,) * size
    return iter(lambda: tuple(islice(it, size)), sentinel) 
```

演示：

```
>>> list(chunk(range(14), 3))
[(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, 11), (12, 13)]
>>> list(chunk(range(14), 3, None))
[(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, 11), (12, 13, None)]
>>> list(chunk(range(14), 3, 'a'))
[(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, 11), (12, 13, 'a')] 
```

我相信这是提供可选填充的最短分块器。

正如 Tomasz Gandor 所[观察到](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks/22045226?noredirect=1#comment93566337_22045226)的，如果两个填充分块器遇到一长串填充值，它们将意外停止。这是以合理方式解决该问题的最终变体：

```
_no_padding = object()
def chunk(it, size, padval=_no_padding):
    it = iter(it)
    chunker = iter(lambda: tuple(islice(it, size)), ())
    if padval == _no_padding:
        yield from chunker
    else:
        for ch in chunker:
            yield ch if len(ch) == size else ch + (padval,) * (size - len(ch)) 
```

演示：

```
>>> list(chunk([1, 2, (), (), 5], 2))
[(1, 2), ((), ()), (5,)]
>>> list(chunk([1, 2, None, None, 5], 2, None))
[(1, 2), (None, None), (5, None)] 
```

* * *

## 回答 #6

> 赞同：114
> 
> 时间：2008-11-23T12:41:37.317

这是一个适用于任意迭代的生成器：

```
def split_seq(iterable, size):
    it = iter(iterable)
    item = list(itertools.islice(it, size))
    while item:
        yield item
        item = list(itertools.islice(it, size)) 
```

例子：

```
>>> import pprint
>>> pprint.pprint(list(split_seq(xrange(75), 10)))
[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],
 [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
 [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
 [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
 [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
 [70, 71, 72, 73, 74]] 
```

* * *

## 回答 #7

> 赞同：78
> 
> 时间：2010-07-12T07:58:43.420

简单而不失优雅

```
L = range(1, 1000)
print [L[x:x+10] for x in xrange(0, len(L), 10)] 
```

或者，如果您愿意：

```
def chunks(L, n): return [L[x: x+n] for x in xrange(0, len(L), n)]
chunks(L, 10) 
```

* * *

## 回答 #8

> 赞同：65
> 
> 时间：2010-06-26T19:10:07.963

```
def chunk(input, size):
    return map(None, *([iter(input)] * size)) 
```

* * *

## 回答 #9

> 赞同：57
> 
> 时间：2014-02-13T23:07:17.073

## 你如何将列表分成大小均匀的块？

对我来说，“大小均匀的块”意味着它们的长度都相同，或者除非该选项，否则它们的长度**差异最小**。例如，21 个项目的 5 个篮子可能会产生以下结果：

```
>>> import statistics
>>> statistics.variance([5,5,5,5,1]) 
3.2
>>> statistics.variance([5,4,4,4,4]) 
0.19999999999999998 
```

更喜欢后一种结果的一个实际原因是：如果您使用这些功能来分配工作，那么您已经内置了一个可能在其他人之前完成的前景，因此它会在其他人继续努力工作时无所事事。

### 在这里批评其他答案

当我最初写这个答案时，其他答案都不是大小均匀的块 - 它们最后都留下了一个小块，所以它们没有很好的平衡，并且具有高于必要的长度差异。

例如，当前的最佳答案以：

```
[60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
[70, 71, 72, 73, 74]] 
```

其他人，喜欢`list(grouper(3, range(7)))`，并且`chunk(range(7), 3)`都返回：`[(0, 1, 2), (3, 4, 5), (6, None, None)]`。' `None`s 只是填充，在我看来相当不雅。他们没有均匀地分块迭代。

为什么我们不能更好地划分这些？

### 循环解决方案

使用 的高级平衡解决方案`itertools.cycle`，这就是我今天可能会这样做的方式。这是设置：

```
from itertools import cycle
items = range(10, 75)
number_of_baskets = 10 
```

现在我们需要我们的列表来填充元素：

```
baskets = [[] for _ in range(number_of_baskets)] 
```

最后，我们将要分配的元素与篮子循环一起压缩，直到我们用完元素，从语义上讲，这正是我们想要的：

```
for element, basket in zip(items, cycle(baskets)):
    basket.append(element) 
```

结果如下：

```
>>> from pprint import pprint
>>> pprint(baskets)
[[10, 20, 30, 40, 50, 60, 70],
 [11, 21, 31, 41, 51, 61, 71],
 [12, 22, 32, 42, 52, 62, 72],
 [13, 23, 33, 43, 53, 63, 73],
 [14, 24, 34, 44, 54, 64, 74],
 [15, 25, 35, 45, 55, 65],
 [16, 26, 36, 46, 56, 66],
 [17, 27, 37, 47, 57, 67],
 [18, 28, 38, 48, 58, 68],
 [19, 29, 39, 49, 59, 69]] 
```

为了生产这个解决方案，我们编写了一个函数，并提供类型注释：

```
from itertools import cycle
from typing import List, Any

def cycle_baskets(items: List[Any], maxbaskets: int) -> List[List[Any]]:
    baskets = [[] for _ in range(min(maxbaskets, len(items)))]
    for item, basket in zip(items, cycle(baskets)):
        basket.append(item)
    return baskets 
```

在上面，我们获取了我们的项目列表，以及篮子的最大数量。我们创建一个空列表列表，以循环方式在其中附加每个元素。

### 切片

另一个优雅的解决方案是使用切片 - 特别是切片的不太常用的**step**参数。IE：

```
start = 0
stop = None
step = number_of_baskets

first_basket = items[start:stop:step] 
```

这特别优雅，因为切片不关心数据的长度——结果，我们的第一个篮子，只要它需要的长度。我们只需要增加每个篮子的起点。

事实上，这可能是单行代码，但我们将使用多行代码以提高可读性并避免代码行过长：

```
from typing import List, Any

def slice_baskets(items: List[Any], maxbaskets: int) -> List[List[Any]]:
    n_baskets = min(maxbaskets, len(items))
    return [items[i::n_baskets] for i in range(n_baskets)] 
```

并且`islice`从 itertools 模块将提供一种惰性迭代方法，就像问题中最初要求的那样。

我不认为大多数用例会受益匪浅，因为原始数据已经完全物化在列表中，但对于大型数据集，它可以节省近一半的内存使用量。

```
from itertools import islice
from typing import List, Any, Generator

def yield_islice_baskets(items: List[Any], maxbaskets: int) -> Generator[List[Any], None, None]:
    n_baskets = min(maxbaskets, len(items))
    for i in range(n_baskets):
        yield islice(items, i, None, n_baskets) 
```

查看结果：

```
from pprint import pprint

items = list(range(10, 75))
pprint(cycle_baskets(items, 10))
pprint(slice_baskets(items, 10))
pprint([list(s) for s in yield_islice_baskets(items, 10)]) 
```

### 更新了先前的解决方案

这是另一个平衡的解决方案，改编自我过去在生产中使用的一个函数，它使用了模运算符：

```
def baskets_from(items, maxbaskets=25):
    baskets = [[] for _ in range(maxbaskets)]
    for i, item in enumerate(items):
        baskets[i % maxbaskets].append(item)
    return filter(None, baskets) 
```

我创建了一个生成器，如果你把它放到一个列表中，它也会做同样的事情：

```
def iter_baskets_from(items, maxbaskets=3):
    '''generates evenly balanced baskets from indexable iterable'''
    item_count = len(items)
    baskets = min(item_count, maxbaskets)
    for x_i in range(baskets):
        yield [items[y_i] for y_i in range(x_i, item_count, baskets)] 
```

最后，因为我看到所有上述函数都以连续的顺序返回元素（因为它们是给定的）：

```
def iter_baskets_contiguous(items, maxbaskets=3, item_count=None):
    '''
    generates balanced baskets from iterable, contiguous contents
    provide item_count if providing a iterator that doesn't support len()
    '''
    item_count = item_count or len(items)
    baskets = min(item_count, maxbaskets)
    items = iter(items)
    floor = item_count // baskets 
    ceiling = floor + 1
    stepdown = item_count % baskets
    for x_i in range(baskets):
        length = ceiling if x_i < stepdown else floor
        yield [items.next() for _ in range(length)] 
```

## 输出

要测试它们：

```
print(baskets_from(range(6), 8))
print(list(iter_baskets_from(range(6), 8)))
print(list(iter_baskets_contiguous(range(6), 8)))
print(baskets_from(range(22), 8))
print(list(iter_baskets_from(range(22), 8)))
print(list(iter_baskets_contiguous(range(22), 8)))
print(baskets_from('ABCDEFG', 3))
print(list(iter_baskets_from('ABCDEFG', 3)))
print(list(iter_baskets_contiguous('ABCDEFG', 3)))
print(baskets_from(range(26), 5))
print(list(iter_baskets_from(range(26), 5)))
print(list(iter_baskets_contiguous(range(26), 5))) 
```

打印出来：

```
[[0], [1], [2], [3], [4], [5]]
[[0], [1], [2], [3], [4], [5]]
[[0], [1], [2], [3], [4], [5]]
[[0, 8, 16], [1, 9, 17], [2, 10, 18], [3, 11, 19], [4, 12, 20], [5, 13, 21], [6, 14], [7, 15]]
[[0, 8, 16], [1, 9, 17], [2, 10, 18], [3, 11, 19], [4, 12, 20], [5, 13, 21], [6, 14], [7, 15]]
[[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10, 11], [12, 13, 14], [15, 16, 17], [18, 19], [20, 21]]
[['A', 'D', 'G'], ['B', 'E'], ['C', 'F']]
[['A', 'D', 'G'], ['B', 'E'], ['C', 'F']]
[['A', 'B', 'C'], ['D', 'E'], ['F', 'G']]
[[0, 5, 10, 15, 20, 25], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18, 23], [4, 9, 14, 19, 24]]
[[0, 5, 10, 15, 20, 25], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18, 23], [4, 9, 14, 19, 24]]
[[0, 1, 2, 3, 4, 5], [6, 7, 8, 9, 10], [11, 12, 13, 14, 15], [16, 17, 18, 19, 20], [21, 22, 23, 24, 25]] 
```

请注意，连续生成器以与其他两个相同的长度模式提供块，但项目都是有序的，并且它们被均匀划分，就像一个可以划分离散元素的列表一样。

* * *

## 回答 #10

> 赞同：53
> 
> 时间：2008-11-23T12:40:39.830

如果您知道列表大小：

```
def SplitList(mylist, chunk_size):
    return [mylist[offs:offs+chunk_size] for offs in range(0, len(mylist), chunk_size)] 
```

如果你不（迭代器）：

```
def IterChunks(sequence, chunk_size):
    res = []
    for item in sequence:
        res.append(item)
        if len(res) >= chunk_size:
            yield res
            res = []
    if res:
        yield res  # yield the last, incomplete, portion 
```

在后一种情况下，如果您可以确定序列始终包含给定大小的整数块（即没有不完整的最后一个块），则可以以更漂亮的方式对其进行改写。

* * *

## 回答 #11

> 赞同：51
> 
> 时间：2015-03-12T12:36:10.303

[我在这个问题的副本](https://stackoverflow.com/questions/23286254/convert-list-to-a-list-of-tuples-python)中看到了最棒的 Python 式答案：

```
from itertools import zip_longest

a = range(1, 16)
i = iter(a)
r = list(zip_longest(i, i, i))
>>> print(r)
[(1, 2, 3), (4, 5, 6), (7, 8, 9), (10, 11, 12), (13, 14, 15)] 
```

您可以为任何 n 创建 n 元组。如果`a = range(1, 15)`，那么结果将是：

```
[(1, 2, 3), (4, 5, 6), (7, 8, 9), (10, 11, 12), (13, 14, None)] 
```

如果列表被平均划分，则可以替换`zip_longest`为`zip`，否则三元组`(13, 14, None)`将丢失。上面使用了 Python 3。对于 Python 2，使用`izip_longest`.

* * *

## 回答 #12

> 赞同：37
> 
> 时间：2015-12-16T21:42:56.703

```
[AA[i:i+SS] for i in range(len(AA))[::SS]] 
```

其中 AA 是数组，SS 是块大小。例如：

```
>>> AA=range(10,21);SS=3
>>> [AA[i:i+SS] for i in range(len(AA))[::SS]]
[[10, 11, 12], [13, 14, 15], [16, 17, 18], [19, 20]]
# or [range(10, 13), range(13, 16), range(16, 19), range(19, 21)] in py3 
```

要扩展 py3 中的范围，请执行

```
(py3) >>> [list(AA[i:i+SS]) for i in range(len(AA))[::SS]]
[[10, 11, 12], [13, 14, 15], [16, 17, 18], [19, 20]] 
```

* * *

## 回答 #13

> 赞同：36
> 
> 时间：2018-08-26T01:40:11.330

**不要重新发明轮子。**

**给定**

```
import itertools as it
import collections as ct

import more_itertools as mit

iterable = range(11)
n = 3 
```

**代码**

[*`more_itertools`*](https://github.com/more-itertools/more-itertools)^+

```
list(mit.chunked(iterable, n))
# [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10]]

list(mit.sliced(iterable, n))
# [range(0, 3), range(3, 6), range(6, 9), range(9, 11)]

list(mit.grouper(n, iterable))
# [(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, None)]

list(mit.windowed(iterable, len(iterable)//n, step=n))
# [(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, None)]

list(mit.chunked_even(iterable, n))
# [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10]] 
```

（或DIY，如果你愿意）

*标准库*

```
list(it.zip_longest(*[iter(iterable)] * n))
# [(0, 1, 2), (3, 4, 5), (6, 7, 8), (9, 10, None)] 
```

```
d = {}
for i, x in enumerate(iterable):
    d.setdefault(i//n, []).append(x)

list(d.values())
# [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10]] 
```

```
dd = ct.defaultdict(list)
for i, x in enumerate(iterable):
    dd[i//n].append(x)

list(dd.values())
# [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10]] 
```

**参考**

*   [`more_itertools.chunked`](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.chunked)（[相关贴](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks/16315158#16315158)）
*   [`more_itertools.sliced`](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.sliced)
*   [`more_itertools.grouper`](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.grouper)（[相关帖子](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks/312644#312644)）
*   [`more_itertools.windowed`](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.windowed)（另见[`stagger`](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.stagger)，[`zip_offset`](https://more-itertools.readthedocs.io/en/stable/api.html#more_itertools.zip_offset)）
*   [`more_itertools.chunked_even`](https://more-itertools.readthedocs.io/en/latest/api.html#more_itertools.chunked_even)
*   [`zip_longest`](https://docs.python.org/3/library/itertools.html#itertools.zip_longest)（[相关职位](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks/3125186#3125186)，[相关职位](https://stackoverflow.com/questions/312443/how-do-you-split-a-list-into-evenly-sized-chunks/29009933#29009933)）
*   [`setdefault`](https://docs.python.org/3/library/stdtypes.html#dict.setdefault)（排序结果需要 Python 3.6+）
*   [`collections.defaultdict`](https://docs.python.org/3/library/collections.html#collections.defaultdict) （排序结果需要 Python 3.6+）

[^(+实现)[itertools 配方](https://docs.python.org/3/library/itertools.html#itertools-recipes)等的第三方库。`> pip install more_itertools`]

* * *

## 回答 #14

> 赞同：28
> 
> 时间：2011-04-19T05:27:19.640

例如，如果您的块大小为 3，则可以执行以下操作：

```
zip(*[iterable[i::3] for i in range(3)]) 
```

来源： [http ://code.activestate.com/recipes/303060-group-a-list-into-sequential-n-tuples/](http://code.activestate.com/recipes/303060-group-a-list-into-sequential-n-tuples/)

当我的块大小是我可以输入的固定数字时，我会使用它，例如“3”，并且永远不会改变。

* * *

## 回答 #15

> 赞同：27
> 
> 时间：2013-11-20T20:55:22.177

toolz库具有以下[功能](https://github.com/pytoolz/toolz)`partition`：

```
from toolz.itertoolz.core import partition

list(partition(2, [1, 2, 3, 4]))
[(1, 2), (3, 4)] 
```

* * *

## 回答 #16

> 赞同：26
> 
> 时间：2019-12-10T11:59:57.977

使用Python 3.8 中的[赋值表达式](https://www.python.org/dev/peps/pep-0572/)，它变得非常好：

```
import itertools

def batch(iterable, size):
    it = iter(iterable)
    while item := list(itertools.islice(it, size)):
        yield item 
```

这适用于任意迭代，而不仅仅是列表。

```
>>> import pprint
>>> pprint.pprint(list(batch(range(75), 10)))
[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],
 [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
 [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
 [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
 [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
 [70, 71, 72, 73, 74]] 
```

* * *

## 回答 #17

> 赞同：23
> 
> 时间：2018-01-07T08:58:54.647

我对不同方法的性能很好奇，这里是：

在 Python 3.5.1 上测试

```
import time
batch_size = 7
arr_len = 298937

#---------slice-------------

print("\r\nslice")
start = time.time()
arr = [i for i in range(0, arr_len)]
while True:
    if not arr:
        break

    tmp = arr[0:batch_size]
    arr = arr[batch_size:-1]
print(time.time() - start)

#-----------index-----------

print("\r\nindex")
arr = [i for i in range(0, arr_len)]
start = time.time()
for i in range(0, round(len(arr) / batch_size + 1)):
    tmp = arr[batch_size * i : batch_size * (i + 1)]
print(time.time() - start)

#----------batches 1------------

def batch(iterable, n=1):
    l = len(iterable)
    for ndx in range(0, l, n):
        yield iterable[ndx:min(ndx + n, l)]

print("\r\nbatches 1")
arr = [i for i in range(0, arr_len)]
start = time.time()
for x in batch(arr, batch_size):
    tmp = x
print(time.time() - start)

#----------batches 2------------

from itertools import islice, chain

def batch(iterable, size):
    sourceiter = iter(iterable)
    while True:
        batchiter = islice(sourceiter, size)
        yield chain([next(batchiter)], batchiter)

print("\r\nbatches 2")
arr = [i for i in range(0, arr_len)]
start = time.time()
for x in batch(arr, batch_size):
    tmp = x
print(time.time() - start)

#---------chunks-------------
def chunks(l, n):
    """Yield successive n-sized chunks from l."""
    for i in range(0, len(l), n):
        yield l[i:i + n]
print("\r\nchunks")
arr = [i for i in range(0, arr_len)]
start = time.time()
for x in chunks(arr, batch_size):
    tmp = x
print(time.time() - start)

#-----------grouper-----------

from itertools import zip_longest # for Python 3.x
#from six.moves import zip_longest # for both (uses the six compat library)

def grouper(iterable, n, padvalue=None):
    "grouper(3, 'abcdefg', 'x') --> ('a','b','c'), ('d','e','f'), ('g','x','x')"
    return zip_longest(*[iter(iterable)]*n, fillvalue=padvalue)

arr = [i for i in range(0, arr_len)]
print("\r\ngrouper")
start = time.time()
for x in grouper(arr, batch_size):
    tmp = x
print(time.time() - start) 
```

**结果：**

```
slice
31.18285083770752

index
0.02184295654296875

batches 1
0.03503894805908203

batches 2
0.22681021690368652

chunks
0.019841909408569336

grouper
0.006506919860839844 
```

* * *

## 回答 #18

> 赞同：21
> 
> 时间：2013-10-09T06:17:29.367

我非常喜欢 tzot 和 JFSebastian 提出的 Python doc 版本，但它有两个缺点：

*   它不是很明确
*   我通常不希望最后一个块中的填充值

我在我的代码中经常使用这个：

```
from itertools import islice

def chunks(n, iterable):
    iterable = iter(iterable)
    while True:
        yield tuple(islice(iterable, n)) or iterable.next() 
```

更新：一个懒惰的块版本：

```
from itertools import chain, islice

def chunks(n, iterable):
   iterable = iter(iterable)
   while True:
       yield chain([next(iterable)], islice(iterable, n-1)) 
```

* * *

## 回答 #19

> 赞同：20
> 
> 时间：2017-01-27T23:12:07.890

您还可以[`get_chunks`](http://utilspie.readthedocs.io/en/latest/#get-chunks)将库的功能[`utilspie`](http://utilspie.readthedocs.io)用作：

```
>>> from utilspie import iterutils
>>> a = [1, 2, 3, 4, 5, 6, 7, 8, 9]

>>> list(iterutils.get_chunks(a, 5))
[[1, 2, 3, 4, 5], [6, 7, 8, 9]] 
```

您可以[`utilspie`](https://pypi.python.org/pypi/utilspie)通过 pip 安装：

```
sudo pip install utilspie 
```

*免责声明：我是[utilspie](https://github.com/moin18/utilspie) library*的创建者。

* * *

## 回答 #20

> 赞同：18
> 
> 时间：2015-07-02T07:32:49.237

代码：

```
def split_list(the_list, chunk_size):
    result_list = []
    while the_list:
        result_list.append(the_list[:chunk_size])
        the_list = the_list[chunk_size:]
    return result_list

a_list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

print split_list(a_list, 3) 
```

结果：

```
[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]] 
```

* * *

## 回答 #21

> 赞同：15
> 
> 时间：2015-11-03T23:10:50.297

在这一点上，我认为我们需要一个**递归生成器**，以防万一......

在python 2中：

```
def chunks(li, n):
    if li == []:
        return
    yield li[:n]
    for e in chunks(li[n:], n):
        yield e 
```

在python 3中：

```
def chunks(li, n):
    if li == []:
        return
    yield li[:n]
    yield from chunks(li[n:], n) 
```

此外，在外星人大规模入侵的情况下，**装饰的递归生成器**可能会变得很方便：

```
def dec(gen):
    def new_gen(li, n):
        for e in gen(li, n):
            if e == []:
                return
            yield e
    return new_gen

@dec
def chunks(li, n):
    yield li[:n]
    for e in chunks(li[n:], n):
        yield e 
```

* * *

## 回答 #22

> 赞同：13
> 
> 时间：2008-11-23T12:51:16.863

呵呵，一行版本

```
In [48]: chunk = lambda ulist, step:  map(lambda i: ulist[i:i+step],  xrange(0, len(ulist), step))

In [49]: chunk(range(1,100), 10)
Out[49]: 
[[1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
 [11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
 [21, 22, 23, 24, 25, 26, 27, 28, 29, 30],
 [31, 32, 33, 34, 35, 36, 37, 38, 39, 40],
 [41, 42, 43, 44, 45, 46, 47, 48, 49, 50],
 [51, 52, 53, 54, 55, 56, 57, 58, 59, 60],
 [61, 62, 63, 64, 65, 66, 67, 68, 69, 70],
 [71, 72, 73, 74, 75, 76, 77, 78, 79, 80],
 [81, 82, 83, 84, 85, 86, 87, 88, 89, 90],
 [91, 92, 93, 94, 95, 96, 97, 98, 99]] 
```

* * *

## 回答 #23

> 赞同：13
> 
> 时间：2008-11-24T16:56:57.067

```
def split_seq(seq, num_pieces):
    start = 0
    for i in xrange(num_pieces):
        stop = start + len(seq[i::num_pieces])
        yield seq[start:stop]
        start = stop 
```

用法：

```
seq = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

for seq in split_seq(seq, 3):
    print seq 
```

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2010-02-16T05:49:47.980

不调用 len() 这对大型列表有好处：

```
def splitter(l, n):
    i = 0
    chunk = l[:n]
    while chunk:
        yield chunk
        i += n
        chunk = l[i:i+n] 
```

这是针对可迭代的：

```
def isplitter(l, n):
    l = iter(l)
    chunk = list(islice(l, n))
    while chunk:
        yield chunk
        chunk = list(islice(l, n)) 
```

以上的功能风味：

```
def isplitter2(l, n):
    return takewhile(bool,
                     (tuple(islice(start, n))
                            for start in repeat(iter(l)))) 
```

或者：

```
def chunks_gen_sentinel(n, seq):
    continuous_slices = imap(islice, repeat(iter(seq)), repeat(0), repeat(n))
    return iter(imap(tuple, continuous_slices).next,()) 
```

或者：

```
def chunks_gen_filter(n, seq):
    continuous_slices = imap(islice, repeat(iter(seq)), repeat(0), repeat(n))
    return takewhile(bool,imap(tuple, continuous_slices)) 
```

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2015-02-28T20:05:03.317

另一个更明确的版本。

```
def chunkList(initialList, chunkSize):
    """
    This function chunks a list into sub lists 
    that have a length equals to chunkSize.

    Example:
    lst = [3, 4, 9, 7, 1, 1, 2, 3]
    print(chunkList(lst, 3)) 
    returns
    [[3, 4, 9], [7, 1, 1], [2, 3]]
    """
    finalList = []
    for i in range(0, len(initialList), chunkSize):
        finalList.append(initialList[i:i+chunkSize])
    return finalList 
```

* * *

## 回答 #26

> 赞同：11
> 
> 时间：2013-02-18T13:31:51.440

请参阅[此参考](http://docs.python.org/3.3/library/functions.html?highlight=zip#zip)

```
>>> orange = range(1, 1001)
>>> otuples = list( zip(*[iter(orange)]*10))
>>> print(otuples)
[(1, 2, 3, 4, 5, 6, 7, 8, 9, 10), ... (991, 992, 993, 994, 995, 996, 997, 998, 999, 1000)]
>>> olist = [list(i) for i in otuples]
>>> print(olist)
[[1, 2, 3, 4, 5, 6, 7, 8, 9, 10], ..., [991, 992, 993, 994, 995, 996, 997, 998, 999, 1000]]
>>> 
```

Python3

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2012-02-13T04:50:38.350

```
def chunks(iterable,n):
    """assumes n is an integer>0
    """
    iterable=iter(iterable)
    while True:
        result=[]
        for i in range(n):
            try:
                a=next(iterable)
            except StopIteration:
                break
            else:
                result.append(a)
        if result:
            yield result
        else:
            break

g1=(i*i for i in range(10))
g2=chunks(g1,3)
print g2
'<generator object chunks at 0x0337B9B8>'
print list(g2)
'[[0, 1, 4], [9, 16, 25], [36, 49, 64], [81]]' 
```

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2016-11-03T19:10:45.350

因为这里的每个人都在谈论迭代器。[`boltons`](https://boltons.readthedocs.io/)有完美的方法，称为[`iterutils.chunked_iter`](https://boltons.readthedocs.io/en/latest/iterutils.html#boltons.iterutils.chunked_iter).

```
from boltons import iterutils

list(iterutils.chunked_iter(list(range(50)), 11)) 
```

输出：

```
[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
 [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],
 [22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32],
 [33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43],
 [44, 45, 46, 47, 48, 49]] 
```

但是，如果您不想对内存留情，您可以使用旧方式并`list`首先使用[`iterutils.chunked`](https://boltons.readthedocs.io/en/latest/iterutils.html#boltons.iterutils.chunked).

* * *

## 回答 #29

> 赞同：9
> 
> 时间：2011-05-03T16:27:37.780

考虑使用[matplotlib.cbook](http://matplotlib.sourceforge.net/)片段

例如：

```
import matplotlib.cbook as cbook
segments = cbook.pieces(np.arange(20), 3)
for s in segments:
     print s 
```

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2015-07-15T23:27:19.153

```
a = [1, 2, 3, 4, 5, 6, 7, 8, 9]
CHUNK = 4
[a[i*CHUNK:(i+1)*CHUNK] for i in xrange((len(a) + CHUNK - 1) / CHUNK )] 
```

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2017-04-17T15:38:56.040

另一种解决方案

```
def make_chunks(data, chunk_size): 
    while data:
        chunk, data = data[:chunk_size], data[chunk_size:]
        yield chunk

>>> for chunk in make_chunks([1, 2, 3, 4, 5, 6, 7], 2):
...     print chunk
... 
[1, 2]
[3, 4]
[5, 6]
[7]
>>> 
```

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2009-11-03T16:45:31.877

```
>>> def f(x, n, acc=[]): return f(x[n:], n, acc+[(x[:n])]) if x else acc
>>> f("Hallo Welt", 3)
['Hal', 'lo ', 'Wel', 't']
>>> 
```

如果你在括号中 - 我拿起一本关于 Erlang 的书 :)

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2012-08-27T22:58:05.640

我意识到这个问题很老（在谷歌上偶然发现），但肯定比任何巨大的复杂建议更简单、更清晰，并且只使用切片：

```
def chunker(iterable, chunksize):
    for i,c in enumerate(iterable[::chunksize]):
        yield iterable[i*chunksize:(i+1)*chunksize]

>>> for chunk in chunker(range(0,100), 10):
...     print list(chunk)
... 
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
[10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
[20, 21, 22, 23, 24, 25, 26, 27, 28, 29]
... etc ... 
```

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2016-08-06T20:44:07.587

根据[这个答案](https://stackoverflow.com/a/21767522/15055)，票数最高的答案最后会留下一个“矮子”。这是我的解决方案，可以真正获得尽可能均匀大小的块，没有矮子。它基本上试图准确地选择应该拆分列表的小数点，但只是将其四舍五入到最接近的整数：

```
from __future__ import division  # not needed in Python 3
def n_even_chunks(l, n):
    """Yield n as even chunks as possible from l."""
    last = 0
    for i in range(1, n+1):
        cur = int(round(i * (len(l) / n)))
        yield l[last:cur]
        last = cur 
```

示范：

```
>>> pprint.pprint(list(n_even_chunks(list(range(100)), 9)))
[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
 [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],
 [22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32],
 [33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43],
 [44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55],
 [56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66],
 [67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77],
 [78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88],
 [89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]]
>>> pprint.pprint(list(n_even_chunks(list(range(100)), 11)))
[[0, 1, 2, 3, 4, 5, 6, 7, 8],
 [9, 10, 11, 12, 13, 14, 15, 16, 17],
 [18, 19, 20, 21, 22, 23, 24, 25, 26],
 [27, 28, 29, 30, 31, 32, 33, 34, 35],
 [36, 37, 38, 39, 40, 41, 42, 43, 44],
 [45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
 [55, 56, 57, 58, 59, 60, 61, 62, 63],
 [64, 65, 66, 67, 68, 69, 70, 71, 72],
 [73, 74, 75, 76, 77, 78, 79, 80, 81],
 [82, 83, 84, 85, 86, 87, 88, 89, 90],
 [91, 92, 93, 94, 95, 96, 97, 98, 99]] 
```

与投票最多的`chunks`答案进行比较：

```
>>> pprint.pprint(list(chunks(list(range(100)), 100//9)))
[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
 [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],
 [22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32],
 [33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43],
 [44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
 [55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65],
 [66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76],
 [77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87],
 [88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98],
 [99]]
>>> pprint.pprint(list(chunks(list(range(100)), 100//11)))
[[0, 1, 2, 3, 4, 5, 6, 7, 8],
 [9, 10, 11, 12, 13, 14, 15, 16, 17],
 [18, 19, 20, 21, 22, 23, 24, 25, 26],
 [27, 28, 29, 30, 31, 32, 33, 34, 35],
 [36, 37, 38, 39, 40, 41, 42, 43, 44],
 [45, 46, 47, 48, 49, 50, 51, 52, 53],
 [54, 55, 56, 57, 58, 59, 60, 61, 62],
 [63, 64, 65, 66, 67, 68, 69, 70, 71],
 [72, 73, 74, 75, 76, 77, 78, 79, 80],
 [81, 82, 83, 84, 85, 86, 87, 88, 89],
 [90, 91, 92, 93, 94, 95, 96, 97, 98],
 [99]] 
```

* * *

## 回答 #35

> 赞同：5
> 
> 时间：2016-11-20T04:32:29.887

您可以使用 numpy 的 array_split 函数，例如，`np.array_split(np.array(data), 20)`分成 20 个几乎相等大小的块。

为了确保块的大小完全相等，请使用`np.split`.

* * *

## 回答 #36

> 赞同：5
> 
> 时间：2017-11-03T12:38:56.040

我想我没有看到这个选项，所以只是添加另一个:))：

```
def chunks(iterable, chunk_size):
  i = 0;
  while i < len(iterable):
    yield iterable[i:i+chunk_size]
    i += chunk_size 
```

* * *

## 回答 #37

> 赞同：5
> 
> 时间：2019-07-09T14:04:12.397

python`pydash`包可能是一个不错的选择。

```
from pydash.arrays import chunk
ids = ['22', '89', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '1']
chunk_ids = chunk(ids,5)
print(chunk_ids)
# output: [['22', '89', '2', '3', '4'], ['5', '6', '7', '8', '9'], ['10', '11', '1']] 
```

更多结帐[pydash 块列表](https://pydash.readthedocs.io/en/latest/api.html?highlight=chunk%20list)

* * *

## 回答 #38

> 赞同：4
> 
> 时间：2008-11-26T07:24:49.110

```
def chunk(lst):
    out = []
    for x in xrange(2, len(lst) + 1):
        if not len(lst) % x:
            factor = len(lst) / x
            break
    while lst:
        out.append([lst.pop(0) for x in xrange(factor)])
    return out 
```

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2014-12-09T03:54:49.717

让 r 是块大小， L 是初始列表，你可以这样做。

```
chunkL = [ [i for i in L[r*k:r*(k+1)] ] for k in range(len(L)/r)] 
```

* * *

## 回答 #40

> 赞同：4
> 
> 时间：2015-02-27T02:33:35.490

使用列表推导：

```
l = [1,2,3,4,5,6,7,8,9,10,11,12]
k = 5 #chunk size
print [tuple(l[x:y]) for (x, y) in [(x, x+k) for x in range(0, len(l), k)]] 
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2015-11-04T09:12:27.593

在这一点上，我认为我们需要强制匿名递归函数。

```
Y = lambda f: (lambda x: x(x))(lambda y: f(lambda *args: y(y)(*args)))
chunks = Y(lambda f: lambda n: [n[0][:n[1]]] + f((n[0][n[1]:], n[1])) if len(n[0]) > 0 else []) 
```

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2017-01-11T09:18:53.907

我在下面有一个解决方案确实有效，但比该解决方案更重要的是对其他方法的一些评论。首先，一个好的解决方案不应该要求一个按顺序遍历子迭代器的循环。如果我跑

```
g = paged_iter(list(range(50)), 11))
i0 = next(g)
i1 = next(g)
list(i1)
list(i0) 
```

最后一个命令的适当输出是

```
 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10] 
```

不是

```
 [] 
```

由于这里大多数基于 itertools 的解决方案都返回了。这不仅仅是按顺序访问迭代器的常见无聊限制。想象一个消费者试图清理输入不当的数据，这些数据颠倒了 5 个块的适当顺序，即数据看起来像 [B5, A5, D5, C5] 并且应该看起来像 [A5, B5, C5, D5]（其中A5 只是五个元素而不是子列表）。这个消费者会查看分组函数声称的行为，并毫不犹豫地编写一个循环，例如

```
i = 0
out = []
for it in paged_iter(data,5)
    if (i % 2 == 0):
         swapped = it
    else: 
         out += list(it)
         out += list(swapped)
    i = i + 1 
```

如果你偷偷地假设子迭代器总是按顺序完全使用，这将产生神秘的错误结果。如果您想从块中交错元素，情况会变得更糟。

其次，相当数量的建议解决方案隐含地依赖于迭代器具有确定性顺序的事实（例如，它们没有设置），虽然一些使用 islice 的解决方案可能没问题，但让我担心。

第三，itertools grouper 方法有效，但配方依赖于 zip_longest（或 zip）函数的内部行为，这不是其已发布行为的一部分。特别是，grouper 函数之所以起作用，是因为在 zip_longest(i0...in) 中，下一个函数总是在重新开始之前按 next(i0)、next(i1)、... next(in) 的顺序调用。当 grouper 传递同一个迭代器对象的 n 个副本时，它依赖于这种行为。

最后，虽然下面的解决方案可以改进，如果你做出上面批评的假设，即子迭代器是按顺序访问的，并且在没有这个假设的情况下完全阅读，一个必须隐式（通过调用链）或显式（通过双端队列或其他数据结构）存储元素对于某个地方的每个子迭代器。所以不要浪费时间（就像我一样）假设一个人可以通过一些聪明的技巧来解决这个问题。

```
def paged_iter(iterat, n):
    itr = iter(iterat)
    deq = None
    try:
        while(True):
            deq = collections.deque(maxlen=n)
            for q in range(n):
                deq.append(next(itr))
            yield (i for i in deq)
    except StopIteration:
        yield (i for i in deq) 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2017-03-08T17:03:46.637

这是一个使用 itertools.groupby 的想法：

```
def chunks(l, n):
    c = itertools.count()
    return (it for _, it in itertools.groupby(l, lambda x: next(c)//n)) 
```

这将返回一个生成器的生成器。如果你想要一个列表列表，只需将最后一行替换为

```
 return [list(it) for _, it in itertools.groupby(l, lambda x: next(c)//n)] 
```

返回列表的示例：

```
>>> chunks('abcdefghij', 4)
[['a', 'b', 'c', 'd'], ['e', 'f', 'g', 'h'], ['i', 'j']] 
```

（所以是的，这会受到“矮小的问题”的影响，在给定的情况下这可能是也可能不是问题。）

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2014-03-03T04:30:24.130

我为此专门编写了一个小型库，可[在此处](https://github.com/rectangletangle/iterlib)获得。该库的`chunked`功能特别高效，因为它是作为[生成器](https://wiki.python.org/moin/Generators)实现的，因此在某些情况下可以节省大量内存。它也不依赖切片符号，因此可以使用任意迭代器。

```
import iterlib

print list(iterlib.chunked(xrange(1, 1000), 10))
# prints [(1, 2, 3, 4, 5, 6, 7, 8, 9, 10), (11, 12, 13, 14, 15, 16, 17, 18, 19, 20), ...] 
```

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2015-04-17T18:48:35.570

上面的答案（由 koffein 提供）有一个小问题：列表总是被分割成相等数量的分割，而不是每个分区的相同数量的项目。这是我的版本。"// chs + 1" 考虑到项目的数量可能无法完全除以分区大小，因此最后一个分区只会被部分填充。

```
# Given 'l' is your list

chs = 12 # Your chunksize
partitioned = [ l[i*chs:(i*chs)+chs] for i in range((len(l) // chs)+1) ] 
```

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2017-10-30T08:13:46.497

没有魔法，但简单而正确：

```
def chunks(iterable, n):
    """Yield successive n-sized chunks from iterable."""
    values = []
    for i, item in enumerate(iterable, 1):
        values.append(item)
        if i % n == 0:
            yield values
            values = []
    if values:
        yield values 
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2020-06-29T17:54:13.790

一个抽象将是

```
l = [1,2,3,4,5,6,7,8,9]
n = 3
outList = []
for i in range(n, len(l) + n, n):
    outList.append(l[i-n:i])

print(outList) 
```

这将打印：

> [[1, 2, 3], [4, 5, 6], [7, 8, 9]]

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2021-04-06T11:06:37.140

# 一个*简单*的解决方案

> OP 已请求“大小相等的块”。*我将“大小相等”理解为“平衡”大小：如果*不可能大小相等（例如，23/5），我们正在寻找大小*大致*相同的物品组。

 *这里的输入是：

*   项目列表：（`input_list`例如 23 个数字的列表）
*   拆分这些项目的组数：（`n_groups`例如`5`）

输入：

```
input_list = list(range(23))
n_groups = 5 
```

## 连续元素组：

```
approx_sizes = len(input_list)/n_groups 

groups_cont = [input_list[int(i*approx_sizes):int((i+1)*approx_sizes)] 
               for i in range(n_groups)] 
```

## “每 N 个”元素组：

```
groups_leap = [input_list[i::n_groups] 
               for i in range(n_groups)] 
```

### 结果

```
print(len(input_list))

print('Contiguous elements lists:')
print(groups_cont)

print('Leap every "N" items lists:')
print(groups_leap) 
```

> 将输出：
> 
> ```
> 23
> 
> Contiguous elements lists:
> [[0, 1, 2, 3], [4, 5, 6, 7, 8], [9, 10, 11, 12], [13, 14, 15, 16, 17], [18, 19, 20, 21, 22]]
> 
> Leap every "N" items lists:
> [[0, 5, 10, 15, 20], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18], [4, 9, 14, 19]] 
> ```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2013-09-13T19:11:44.557

*   适用于任何可迭代的
*   内部数据是生成器对象（不是列表）
*   一个班轮

```
在 [259] 中：get_in_chunks = lambda itr,n: ((v for _,v in g) for _,g in itertools.groupby(enumerate(itr),lambda (ind,_): ind/n))

在 [260] 中：list(list(x) for x in get_in_chunks(range(30),7))
输出[260]：
[[0, 1, 2, 3, 4, 5, 6],
 [7, 8, 9, 10, 11, 12, 13],
 [14, 15, 16, 17, 18, 19, 20],
 [21, 22, 23, 24, 25, 26, 27],
 [28, 29]]

```

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2014-09-03T17:43:15.433

就像@AaronHall 一样，我来到这里寻找大小大致均匀的块。对此有不同的解释。就我而言，如果所需的大小为 N，我希望每个组的大小>=N。因此，在上述大多数情况下创建的孤儿应该重新分配给其他组。

这可以使用以下方法完成：

```
def nChunks(l, n):
    """ Yield n successive chunks from l.
    Works for lists,  pandas dataframes, etc
    """
    newn = int(1.0 * len(l) / n + 0.5)
    for i in xrange(0, n-1):
        yield l[i*newn:i*newn+newn]
    yield l[n*newn-newn:] 
```

（从[将列表拆分为大约相等长度的 N 部分](https://stackoverflow.com/questions/2130016/splitting-a-list-of-arbitrary-size-into-only-roughly-n-equal-parts)）只需将其称为 nChunks(l,l/n) 或 nChunks(l,floor(l/n))

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2015-09-18T17:54:39.500

我已经提出了以下解决方案，而无需创建临时列表对象，它应该适用于任何可迭代对象。请注意，此版本适用于 Python 2.x：

```
def chunked(iterable, size):
    stop = []
    it = iter(iterable)
    def _next_chunk():
        try:
            for _ in xrange(size):
                yield next(it)
        except StopIteration:
            stop.append(True)
            return

    while not stop:
        yield _next_chunk()

for it in chunked(xrange(16), 4):
   print list(it) 
```

输出：

```
[0, 1, 2, 3]
[4, 5, 6, 7]
[8, 9, 10, 11]
[12, 13, 14, 15] 
[] 
```

如您所见，如果 len(iterable) % size == 0 那么我们有额外的空迭代器对象。但我不认为这是一个大问题。

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2017-07-06T22:24:14.247

这适用于 v2/v3，可内联，基于生成器并且仅使用标准库：

```
import itertools
def split_groups(iter_in, group_size):
    return ((x for _, x in item) for _, item in itertools.groupby(enumerate(iter_in), key=lambda x: x[0] // group_size)) 
```

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2015-10-16T22:09:29.580

由于我必须做这样的事情，这是我的解决方案，给出了一个生成器和一个批量大小：

```
def pop_n_elems_from_generator(g, n):
    elems = []
    try:
        for idx in xrange(0, n):
            elems.append(g.next())
        return elems
    except StopIteration:
        return elems 
```

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2019-07-15T15:27:09.277

这个问题让我想起了 Raku（以前的 Perl 6）`.comb(n)`方法。它将字符串分解为- 大小的`n`块。（除此之外还有更多内容，但我会省略细节。）

在 Python3 中实现类似的函数作为 lambda 表达式很容易：

```
comb = lambda s,n: (s[i:i+n] for i in range(0,len(s),n)) 
```

然后你可以这样称呼它：

```
some_list = list(range(0, 20))  # creates a list of 20 elements
generator = comb(some_list, 4)  # creates a generator that will generate lists of 4 elements
for sublist in generator:
    print(sublist)  # prints a sublist of four elements, as it's generated 
```

当然，您不必将生成器分配给变量；你可以像这样直接循环它：

```
for sublist in comb(some_list, 4):
    print(sublist)  # prints a sublist of four elements, as it's generated 
```

作为奖励，此`comb()`函数还对字符串进行操作：

```
list( comb('catdogant', 3) )  # returns ['cat', 'dog', 'ant'] 
```

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2020-06-05T13:34:18.177

任何可迭代的通用分块器，它使用户可以选择最后如何处理部分块。

在 Python 3 上测试。

`chunker.py`

```
from enum import Enum

class PartialChunkOptions(Enum):
    INCLUDE = 0
    EXCLUDE = 1
    PAD = 2
    ERROR = 3

class PartialChunkException(Exception):
    pass

def chunker(iterable, n, on_partial=PartialChunkOptions.INCLUDE, pad=None):
    """
    A chunker yielding n-element lists from an iterable, with various options
    about what to do about a partial chunk at the end.

    on_partial=PartialChunkOptions.INCLUDE (the default):
                     include the partial chunk as a short (<n) element list

    on_partial=PartialChunkOptions.EXCLUDE
                     do not include the partial chunk

    on_partial=PartialChunkOptions.PAD
                     pad to an n-element list 
                     (also pass pad=<pad_value>, default None)

    on_partial=PartialChunkOptions.ERROR
                     raise a RuntimeError if a partial chunk is encountered
    """

    on_partial = PartialChunkOptions(on_partial)        

    iterator = iter(iterable)
    while True:
        vals = []
        for i in range(n):
            try:
                vals.append(next(iterator))
            except StopIteration:
                if vals:
                    if on_partial == PartialChunkOptions.INCLUDE:
                        yield vals
                    elif on_partial == PartialChunkOptions.EXCLUDE:
                        pass
                    elif on_partial == PartialChunkOptions.PAD:
                        yield vals + [pad] * (n - len(vals))
                    elif on_partial == PartialChunkOptions.ERROR:
                        raise PartialChunkException
                    return
                return
        yield vals 
```

`test.py`

```
import chunker

chunk_size = 3

for it in (range(100, 107),
          range(100, 109)):

    print("\nITERABLE TO CHUNK: {}".format(it))
    print("CHUNK SIZE: {}".format(chunk_size))

    for option in chunker.PartialChunkOptions.__members__.values():
        print("\noption {} used".format(option))
        try:
            for chunk in chunker.chunker(it, chunk_size, on_partial=option):
                print(chunk)
        except chunker.PartialChunkException:
            print("PartialChunkException was raised")
    print("") 
```

的输出`test.py`

```
 ITERABLE TO CHUNK: range(100, 107)
CHUNK SIZE: 3

option PartialChunkOptions.INCLUDE used
[100, 101, 102]
[103, 104, 105]
[106]

option PartialChunkOptions.EXCLUDE used
[100, 101, 102]
[103, 104, 105]

option PartialChunkOptions.PAD used
[100, 101, 102]
[103, 104, 105]
[106, None, None]

option PartialChunkOptions.ERROR used
[100, 101, 102]
[103, 104, 105]
PartialChunkException was raised

ITERABLE TO CHUNK: range(100, 109)
CHUNK SIZE: 3

option PartialChunkOptions.INCLUDE used
[100, 101, 102]
[103, 104, 105]
[106, 107, 108]

option PartialChunkOptions.EXCLUDE used
[100, 101, 102]
[103, 104, 105]
[106, 107, 108]

option PartialChunkOptions.PAD used
[100, 101, 102]
[103, 104, 105]
[106, 107, 108]

option PartialChunkOptions.ERROR used
[100, 101, 102]
[103, 104, 105]
[106, 107, 108] 
```

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2021-03-21T16:27:34.113

虽然有很多答案我有很简单的方法：

```
 x = list(range(10, 75))
indices = x[0::10]
print("indices: ", indices)
xx = [x[i-10:i] for i in indices ]
print("x= ", x)
print ("xx= ",xx) 
```

结果将是：

> 指数：[10, 20, 30, 40, 50, 60, 70] x= [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50、51、52、53、54、55、56、57、58、59、60、61、62、63、64、65、66、67、68、69、70、71、72、73、74]
> 
> xx = [[10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
> [20, 21, 22, 23, 24, 25,26, 27, 28, 29],
> [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
> [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
> [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
> [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
> [70, 71, 72, 73, 74]]

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2018-03-23T18:27:35.233

我不喜欢按块大小拆分元素的想法，例如脚本可以将 101 到 3 个块划分为 [50, 50, 1]。为了我的需要，我需要按比例拆分，并保持顺序不变。首先，我编写了自己的脚本，效果很好，而且非常简单。但是我后来看到[了这个答案](https://stackoverflow.com/a/21767522/3110300)，脚本比我的好，我推荐它。这是我的脚本：

```
def proportional_dividing(N, n):
    """
    N - length of array (bigger number)
    n - number of chunks (smaller number)
    output - arr, containing N numbers, diveded roundly to n chunks
    """
    arr = []
    if N == 0:
        return arr
    elif n == 0:
        arr.append(N)
        return arr
    r = N // n
    for i in range(n-1):
        arr.append(r)
    arr.append(N-r*(n-1))

    last_n = arr[-1]
    # last number always will be r <= last_n < 2*r
    # when last_n == r it's ok, but when last_n > r ...
    if last_n > r:
        # ... and if difference too big (bigger than 1), then
        if abs(r-last_n) > 1:
            #[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 7] # N=29, n=12
            # we need to give unnecessary numbers to first elements back
            diff = last_n - r
            for k in range(diff):
                arr[k] += 1
            arr[-1] = r
            # and we receive [3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2]
    return arr

def split_items(items, chunks):
    arr = proportional_dividing(len(items), chunks)
    splitted = []
    for chunk_size in arr:
        splitted.append(items[:chunk_size])
        items = items[chunk_size:]
    print(splitted)
    return splitted

items = [1,2,3,4,5,6,7,8,9,10,11]
chunks = 3
split_items(items, chunks)
split_items(['a','b','c','d','e','f','g','h','i','g','k','l', 'm'], 3)
split_items(['a','b','c','d','e','f','g','h','i','g','k','l', 'm', 'n'], 3)
split_items(range(100), 4)
split_items(range(99), 4)
split_items(range(101), 4) 
```

和输出：

```
[[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11]]
[['a', 'b', 'c', 'd'], ['e', 'f', 'g', 'h'], ['i', 'g', 'k', 'l', 'm']]
[['a', 'b', 'c', 'd', 'e'], ['f', 'g', 'h', 'i', 'g'], ['k', 'l', 'm', 'n']]
[range(0, 25), range(25, 50), range(50, 75), range(75, 100)]
[range(0, 25), range(25, 50), range(50, 75), range(75, 99)]
[range(0, 25), range(25, 50), range(50, 75), range(75, 101)] 
```

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2019-05-23T10:35:48.957

如果您不关心订单：

```
> from itertools import groupby
> batch_no = 3
> data = 'abcdefgh'

> [
    [x[1] for x in x[1]] 
    for x in 
    groupby(
      sorted(
        (x[0] % batch_no, x[1]) 
        for x in 
        enumerate(data)
      ),
      key=lambda x: x[0]
    )
  ]

[['a', 'd', 'g'], ['b', 'e', 'h'], ['c', 'f']] 
```

此解决方案不会生成相同大小的集合，而是分配值以使批次尽可能大，同时保持生成的批次数量。

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2020-09-24T07:01:48.677

我创建了这两个高效且懒惰的花哨的单行代码，输入和输出都是可迭代的，而且它们不依赖于任何模块：

第一个单行是完全惰性的，这意味着它返回生成迭代器的迭代器（即生成的每个块都是迭代块元素的迭代器），这个版本适用于块非常大或元素一个接一个缓慢生成的情况，应该成为生产后立即可用：

[在线尝试！](https://tio.run/##RY/BCsIwDIbve4ocG6hg0dPAJxlDutltURdH7Q768jXpBvZQmvD9X9Llk6YXn3Lup5UfV0ohvuECTz93Nw@ULHANxgQYXhHIwgjEEHidQ/QpGGMGixZ6SogFuVsIinxpMdHzKIgTBxzAYUOtsONOSkZBoyPlQru1B22qr6q0ZC03kXjcGesK5CyROBm20DRdiXXK@ba8fVH8/7MvcpS8kwUYW8z5Bw "Python 3 – 在线试用")

```
chunk_iters = lambda it, n: ((e for i, g in enumerate(((f,), cit)) for j, e in zip(range((1, n - 1)[i]), g)) for cit in (iter(it),) for f in cit) 
```

第二个单行返回生成列表的迭代器。一旦整个块的元素通过输入迭代器变得可用，或者如果到达最后一个块的最后一个元素，就会生成每个列表。如果输入元素快速生成或立即可用，则应使用此版本。其他明智的第一个更懒惰的单线版本应该被使用。

[在线尝试！](https://tio.run/##TY/BDoIwEETvfMV4MNmNNYHoqQlfQoipWqCxLATKwa/HVhJlb7sz8zYzvkM3yGVdH90ir5t3c5hRwpv@/jRwQUE0yKMZJng4AVW14u/qFNp0sbL0djLBEiU/ESvmzWKT3u7CvtLeCnnGEVLjhMrWlS5whktY10TLT0dZImccSjjOsgSRBJmMtJYKheLKOkOccXISSFSk/d/uCtEWyWOk4NiIa17XDw "Python 3 – 在线试用")

```
chunk_lists = lambda it, n: (l for l in ([],) for i, g in enumerate((it, ((),))) for e in g for l in (l[:len(l) % n] + [e][:1 - i],) if (len(l) % n == 0) != i) 
```

我还提供了第一个单行的多行版本`chunk_iters`，它返回生成另一个迭代器的迭代器（遍历每个块的元素）：

[在线尝试！](https://tio.run/##XY/LCsIwEEX3@YpZJhDBoivBLyml9DGxgzItMV3Un4@ZtGpxVsnlnDvJtIRh5FOMPTrohpnvNQX0T03BApuLgjQdBbiC5Ck2ORJ8ZKyzot0GyiyEjx7c9@5GD2QBgRheNGnf8A01wwEKY6V65/58VB/XiZiw/w377UoJyUKu9YWF4rwVT544aLZQlm1ubIVrqnxucvvu36t/TL48j01lYnwD "Python 3 – 在线试用")

```
def chunk_iters(it, n):
    cit = iter(it)
    def one_chunk(f):
        yield f
        for i, e in zip(range(n - 1), cit):
            yield e
    for f in cit:
        yield one_chunk(f) 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2021-04-20T14:46:09.390

```
from itertools import islice
l=[1,2,3,4,5,6]
chuncksize=input("Enter chunk size")
m=[]
obj=iter(l)
m.append(list(islice(l,3)))
m.append(list(islice(l,3)))
print(m) 
```

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2021-12-16T15:29:25.557

[使用接受的答案](http://https:/https://stackoverflow.com/a/312464/8010865)中的生成器可以轻松完成此任务。我正在添加实现长度方法的类实现，这可能对某人有用。我需要知道进度（用`tqdm`），所以生成器应该已经返回了块的数量。

```
class ChunksIterator(object):
    def __init__(self, data, n):
        self._data = data
        self._l = len(data)
        self._n = n

    def __iter__(self):
        for i in range(0, self._l, self._n):
            yield self._data[i:i + self._n]

    def __len__(self):
        rem = 1 if self._l % self._n != 0 else 0
        return self._l // self._n + rem 
```

用法：

```
it = ChunksIterator([1,2,3,4,5,6,7,8,9], 2)
print(len(it))
for i in it:
  print(i) 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2022-01-02T11:14:27.230

[senderle 答案](https://stackoverflow.com/a/22045226/1022684)的单行版本：

```
from itertools import islice
from functools import partial

seq = [1,2,3,4,5,6,7]
size = 3
result = list(iter(partial(lambda it: tuple(islice(it, size)), iter(seq)), ()))
assert result == [(1, 2, 3), (4, 5, 6), (7,)] 
```

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2022-01-31T14:53:24.967

假设列表是`lst`

```
import math

# length of the list len(lst) is ln
# size of a chunk is size

for num in range ( math.ceil(ln/size) ):
    start, end = num*size, min((num+1)*size, ln)
    print(lst[start:end]) 
```

* * *

## 回答 #64

> 赞同：-1
> 
> 时间：2019-04-20T18:28:54.083

### 懒加载版

> ```
> import pprint
> pprint.pprint(list(chunks(range(10, 75), 10)))
> [range(10, 20),
>  range(20, 30),
>  range(30, 40),
>  range(40, 50),
>  range(50, 60),
>  range(60, 70),
>  range(70, 75)] 
> ```
> 
> *^([将此实现的结果与[接受的答案](https://stackoverflow.com/a/312464/3423324)的示例使用结果相结合。])*

上述许多函数都假设整个迭代的长度是预先知道的，或者至少计算起来很便宜。

对于一些流对象，这意味着首先将完整数据加载到内存中（例如下载整个文件）以获取长度信息。

但是，如果您还不知道完整尺寸，则可以改用此代码：

```
def chunks(iterable, size):
    """
    Yield successive chunks from iterable, being `size` long.

    https://stackoverflow.com/a/55776536/3423324
    :param iterable: The object you want to split into pieces.
    :param size: The size each of the resulting pieces should have.
    """
    i = 0
    while True:
        sliced = iterable[i:i + size]
        if len(sliced) == 0:
            # to suppress stuff like `range(max, max)`.
            break
        # end if
        yield sliced
        if len(sliced) < size:
            # our slice is not the full length, so we must have passed the end of the iterator
            break
        # end if
        i += size  # so we start the next chunk at the right place.
    # end while
# end def 
```

这是有效的，因为如果您传递了可迭代的结尾， slice 命令将返回更少/没有元素：

```
"abc"[0:2] == 'ab'
"abc"[2:4] == 'c'
"abc"[4:6] == '' 
```

我们现在使用切片的结果，并计算生成的块的长度。如果它低于我们的预期，我们知道我们可以结束迭代。

这样迭代器将不会被执行，除非访问。

* * *

## 回答 #65

> 赞同：-1
> 
> 时间：2019-12-03T18:34:33.307

一种不需要 itertools 但仍适用于任意生成器的老式方法：

```
def chunks(g, n):
  """divide a generator 'g' into small chunks
  Yields:
    a chunk that has 'n' or less items
  """
  n = max(1, n)
  buff = []
  for item in g:
    buff.append(item)
    if len(buff) == n:
      yield buff
      buff = []
  if buff:
    yield buff 
```

* * *

## 回答 #66

> 赞同：-1
> 
> 时间：2020-04-14T16:18:52.350

```
def main():
  print(chunkify([1,2,3,4,5,6],2))

def chunkify(list, n):
  chunks = []
  for i in range(0, len(list), n):
    chunks.append(list[i:i+n])
  return chunks

main() 
```

我认为这很简单，可以给你一大块数组。

* * *

## 回答 #67

> 赞同：-1
> 
> 时间：2020-07-28T14:07:15.307

这是一段用 Python3 编写的代码，其作用与 np.array_split 相同。

```
list(map(list, map(functools.partial(filter, None), itertools.zip_longest(*iter(lambda: tuple(itertools.islice(a, n)), ()))))) 
```

这是一个相当长的单行，但它确实将项目平均分配到生成的子列表中。

* * *

## 回答 #68

> 赞同：-2
> 
> 时间：2013-05-26T15:18:42.210

使用python的List Comprehensions

```
[range(t,t+10) for t in range(1,1000,10)]

[[1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
 [11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
 [21, 22, 23, 24, 25, 26, 27, 28, 29, 30],....
 ....[981, 982, 983, 984, 985, 986, 987, 988, 989, 990],
 [991, 992, 993, 994, 995, 996, 997, 998, 999, 1000]] 
```

访问[此链接](http://docs.python.org/2/tutorial/datastructures.html#list-comprehensions)以了解列表理解

* * *

## 回答 #69

> 赞同：-2
> 
> 时间：2013-11-26T21:58:03.577

是的，这是一个老问题，但我不得不发布这个问题，因为它比类似的问题还要短一点。是的，结果看起来很乱，但如果它的长度差不多……

```
>>> n = 3 # number of groups
>>> biglist = range(30)
>>>
>>> [ biglist[i::n] for i in xrange(n) ]
[[0, 3, 6, 9, 12, 15, 18, 21, 24, 27],
 [1, 4, 7, 10, 13, 16, 19, 22, 25, 28],
 [2, 5, 8, 11, 14, 17, 20, 23, 26, 29]] 
```

# python - Python 2.6 + JCC + Pylucene 问题

> ID：312444
> 
> 赞同：5
> 
> 时间：2008-11-23T12:17:18.427
> 
> 标签：python, pylucene, jcc

问候，

我正在尝试在 Python 2.6 中使用 pylucene。由于 2.6 没有 windows 构建，我尝试构建源代码。

首先，我构建JCC（windows，使用cygwin）

```
python setup.py build
running build
running build_py
[...]
building 'jcc' extension
error: None

python setup.py install
running install
[...]
copying jcc\config.py -> build\lib.win32-2.6\jcc
copying jcc\classes\org\osafoundation\jcc\PythonException.class -> build\lib.win32-2.6\jcc\classes\org\osafoundation\jcc
running build_ext
building 'jcc' extension
error: None 
```

请注意，它不会复制我的“F:\Python26\Lib\site-packages”目录中的任何内容。我不知道为什么。所以，我不知道它是否真的安装了。

现在，我将制作 pylucene

```
make
/cygdrive/f/Python26//python.exe -m jcc --shared --jar lucene-java-2.4.0/build/lucene-core-2.4.0.jar 
[...]
'doc:(I)Lorg/apache/lucene/document/Document;' --version 2.4.0 --files 2 --build

f:\Python26\python.exe: No module named jcc
make: *** [compile] Error 1 
```

因此，似乎根本没有安装 JCC。

然后，我尝试复制 F:\Python26\Lib\site-packages 下的“jcc build”，并尝试再次制作 pylucene：

```
make
[...]
f:\Python26\python.exe: jcc is a package and cannot be directly executed
make: *** [compile] Error 1 
```

有没有其他人看到这个并找到解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T14:48:46.953

尝试：

> /cygdrive/f/Python26//python.exe setup.py build

和

> /cygdrive/f/Python26//python.exe setup.py build setup.py install

我相信您正在使用 cygwin 中的 python 来安装 jcc 和 windows 中的 python 来运行...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-12T02:45:07.480

几个检查站

*   `error: None`表示构建时出错，它没有成功，所以扩展没有构建

*   如果您使用的是cygwin，我想您需要使用python的cygwin版本，但是根据这个您使用的是windows版本，它安装在 F:\Python -`/cygdrive/f/Python26//python.exe`中，

*   我建议您尝试使用[mingw32](http://www.mingw.org/)，安装 mingw32 并`python setup.py build -c mingw32`尝试`python setup.py install`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-15T20:16:18.607

就可以构建jcc并安装，

顶部完整代码。

13998字节

导入时，报错。

```
>>> import jcc
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "D:\Python26\lib\site-packages\jcc-2.5.1-py2.6-win32.egg\jcc\__init__.py"
, line 29, in <module>
    from _jcc import initVM
ImportError: DLL load failed: 找不到指定的模块。(cant find appointed modules)
>>> 
```

# oracle - Oracle Forms Builder 应用程序的安装程序？

> ID：312454
> 
> 赞同：0
> 
> 时间：2008-11-23T12:28:20.653
> 
> 标签：oracle

我使用 oracle 表单构建器在 Oracle 中创建了一个小项目 - 如何`setup.exe`为我的项目创建安装程序 ()（在 MS Windows 上设置应用程序的安装程序？）

请...帮助我，非常感谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T22:12:55.480

在 Forms 6i 之前，您可以在目标 PC 上安装 Forms 运行时客户端。该目标 PC 还需要连接到数据库。运行时客户端不需要许可证。

从 6i 开始，Forms 组件可以通过应用程序服务器运行，客户端通过浏览器中的 Java 小程序访问它。应用服务器需要连接到数据库，但最终客户端不需要。应用服务器需要适当的 Oracle 许可。

Forms 6i 本身可以选择通过已安装的运行时客户端或通过 Web 浏览器运行。

表单无法通过简单的 Windows 安装程序实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T18:30:47.673

您使用的是什么版本的 oracle 表单？
在我的上一份工作中，我们使用了 Forms v4.5（Developer 2000）——对于那个版本（现在已经很老了），必须在客户端计算机上安装 Forms Runtime 软件。
然后，当用户双击 .FMX 文件时，Forms 运行时 (F45run32.exe) 将加载并运行该表单。
对于 v4.5 来说，您无法创建独立安装，这是一个很长的说法。（这可能会随着未来的版本而改变）

# php - 缩放灯

> ID：312455
> 
> 赞同：3
> 
> 时间：2008-11-23T12:28:36.050
> 
> 标签：php, mysql, lamp

我有一个客户，其 LAMP 网站主要提供视频服务。他目前在一台包含所有组件的服务器上。他有一些缩放问题。有哪些可以用来提供帮助的技术。

我使用将数据库分离到另一台服务器，在它和网络服务器之间有一个 GB 以太网。也许添加更多带有负载平衡的 Web 服务器和带有复制的额外 MySQL 服务器？

如果可能的话，想要一些关于如何扩展的中型、大型、超大型示例。

该视频实际上是以jpg图像的形式出现的。类似于这个网站：

[http://www.webcams.travel/webcam/1170170095](http://www.webcams.travel/webcam/1170170095)

并添加一些细节。我认为每小时的最大访问量是 1000 人，我认为拥有这个会很幸运。可能每天接近1000个。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-23T19:18:57.860

关于 CloudFront 和 MemCache 等的建议都很好，假设它们解决了您的性能问题的根源。

在数据库方面：配置文件，配置文件，配置文件。将数据库移动到单独的服务器（可能）是一个很好的步骤，但是如果您没有分析在此数据库实例上运行的查询，您不知道需要改进什么。

首先对最常见的查询执行[EXPLAIN ，并检查您是否对大型或不断增长的表进行了不必要的顺序扫描。](http://dev.mysql.com/doc/refman/5.0/en/explain.html "MySQL解释文档")必要时索引。

是否有任何查询传回未使用的列？

您是否像其他评论者担心的那样，从数据库中提供您的图形/视频内容？文件应该保存在文件系统中，并从那里提供。

你所有的桌子都是 MyISAM 吗？经常更新的表可以通过将它们移动到[InnoDB](http://dev.mysql.com/doc/refman/5.1/en/innodb.html "InnoDB 文档")来显示性能改进，在那里它们可以受益于行级锁定（与 MyISAM 的表级锁定相反）。

这些只是简单的一般性建议——如果没有更多关于*什么*是慢的细节，很难提供更深层次的东西。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T16:11:55.927

首先，我同意在尝试扩展之前您必须知道瓶颈是什么。这里有一些常规的建议可以帮助您入门：

1.  从数据库中获取视频。我看不出这在任何情况下都有什么意义。

2.  再添加一台服务器以仅提供视频内容，并将 HTML/应用程序保留为原始服务器。这不仅减少了负载，而且通过克服任何[HTTP 连接限制](http://www.google.com/search?q=http+connection+limit)在客户端提高了性能。

3.  缓存 - 这可能意味着[Memcahce](http://www.danga.com/memcached/)或只是预先构建 HTML 输出，而不是为每个请求动态处理它。

4.  如果您有幸达到“超大型”，您可能会考虑使用[CDN](http://en.wikipedia.org/wiki/Content_Delivery_Network)。我敢肯定，在那之前你会遇到许多其他障碍。

祝你好运。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-23T12:53:55.157

您需要确切地找出问题所在 - 没有通用的解决方案。

你需要用真实的硬件和可以模拟大量客户端的东西来构建一个性能测试环境。这可能相当昂贵。

如果问题是数据库（可能是），那么解决方案通常是将其拆分为多个数据库，每个数据库都保存部分数据。

但我不会想象任何理智的人会在 MySQL 上存储视频 - 如果他这样做，那么可能需要进行重构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T16:32:58.647

配置文件以查看他的站点的各个部分实际造成了多少负载。

我认为大部分负载实际上是为视频提供服务 - 使用代理将这项工作重定向到第二个（第三个，第四个......）服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T16:41:44.743

Barrett 的回答几乎就是我会做的——找出瓶颈，查看 memcached，将数据库从 Web 服务移到单独的服务器上，等等。

我要补充一点，亚马逊有一项名为[CloudFront](http://aws.amazon.com/cloudfront/)的新服务，它将提供来自地理位置接近的服务器的内容。我还没有尝试过，但这可能是一种以相对较低的成本分散负载的方法。

此外，查看 Livejournal 和 Facebook 关于他们如何扩展系统的演示文稿，它们可能会根据您的应用程序结构提供一些见解。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-29T13:21:51.300

您应该从应用程序开始分析并找出瓶颈所在 - 如果它是 PHP，使用 xdebug 之类的东西将是一个好的开始。可能是您花费了很长时间序列化数据或与数据库通信 - 因此使用 Memcached 进行缓存可能会有所帮助。

其次，如果你使用的是 MySQL，请开启 MySQL 慢查询日志（my.cnf 中的 log_slow_queries）；这可以用来让您了解昂贵的数据库查询是什么，并且一旦您知道可以通过 EXPLAIN <> 来调整它们，正如已经提到的那样。可能您只需要向数据库添加一些索引，此时它会再次变得很快。还有其他相关的 my.cnf 参数，例如不使用索引的日志查询。

第三，查看 Yahoo 的 page speed firefox 插件之类的工具 - 它会提出一些建议（例如卸载静态内容、压缩您返回的内容、确保您有过期的标头等）。也许服务器本身不是瓶颈，并且由于对第三方（外部 JS、广告、flash ...）的依赖，页面需要很长时间才能呈现。

与 Web 服务器相比，您需要了解数据库服务器的繁忙程度，以了解需要在何处添加额外硬件（即您是否需要多个带有前端负载平衡器的 Web 服务器，或者您是否需要具有复制或两者兼有的多个数据库服务器？）。

我敢肯定还有很多可以说的......

# networking - 如何在 Windows 上增加 TTL 值？

> ID：312459
> 
> 赞同：3
> 
> 时间：2008-11-23T12:31:59.303
> 
> 标签：networking

在 Linux 上，这很容易做到。在 Windows 上可以吗？

澄清：我想增加所有传入数据包的 TTL。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T12:43:33.523

如果您指的是默认值（而不是特定于给定数据包），则注册表项是：

```
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters]
    DefaultTTL 
```

并且可以设置为 1 到 255。

而且，Vinko Vrsalovic 可靠地通知我（谢谢），您还可以通过修改 DefaultTTL 键为每个接口设置它：

```
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters
    \Interfaces\<InterfaceID>] 
```

以下问题编辑：

对于传入的数据包，TTL 在源处创建并由 TCP/IP 堆栈为每一跳递减时附加到数据包标头。您可以编写一个程序来吸收数据包并创建一个新数据包，但它需要对 TCP/IP 堆栈的低级访问（无论目标 IP 地址如何都吸收数据包，并创建一个具有特定 TTL 和欺骗源的新数据包地址）。IBM 用他们的边缘服务器负载均衡器做了类似的事情，但这并不容易。他们也只需要吸收几个 IP 地址，**而不是**任意数量。

您还有一个问题，并非源和目标之间的所有数据包都将通过您的节点 - 这是网络的本质，也是它提供冗余的原因。这对您来说可能是也可能不是问题。

# java - 开始使用 Eclipse RCP

> ID：312461
> 
> 赞同：14
> 
> 时间：2008-11-23T12:32:38.537
> 
> 标签：java, eclipse, eclipse-plugin, eclipse-rcp

我将很快开始为我现在的雇主维护一个 Eclipse RCP 应用程序。
您对这个平台有什么体验？有什么优点，有什么缺点，我应该注意什么？
另外，您可以推荐哪些阅读材料（书籍、教程）？我在网上找到的大多数教程都已经过时了，有没有更好的更新的？
我开始阅读 [Eclipse Rich Client Platform: Designing, Coding, and Packaging Java(TM) Applications](https://rads.stackoverflow.com/amzn/click/com/0321334612) 但由于它也已经过时了，所以我一开始就被卡住了，而且这本书实际上更像是一本食谱的集合做一些关于该主题的真正书籍（它不能很好地解释核心概念）。
那么，关于使用 Eclipse RCP 开发应用程序的优点和缺点，您能告诉我什么，以及您的阅读建议是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-23T12:58:12.293

*   [Eclipse 富客户端平台 (RCP) 与 Eclipse Ganymede (3.4) - 教程](http://www.vogella.de/articles/RichClientPlatform/article.html)
*   [JFace 示例](http://www.java2s.com/Code/Java/SWT-JFace-Eclipse/CatalogSWT-JFace-Eclipse.htm)
*   [通过视图链接使您的 Eclipse 应用程序更丰富](http://www-128.ibm.com/developerworks/opensource/library/os-ecllink/)
*   [RCP 常见问题](http://wiki.eclipse.org/RCP_FAQ)
*   [Eclipse Java 开发人员指南](https://rads.stackoverflow.com/amzn/click/com/0321305027)

Eclipse RCP 并不像人们所说的那么容易。它本质上是在编写一个 Eclipse 插件，您必须学习一种全新的 JFace/Eclipse 做事方式。

[![Eclipse Java 开发人员指南](https://i.stack.imgur.com/3LCJW.jpg)](https://i.stack.imgur.com/3LCJW.jpg)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-03T00:39:10.533

Eclipse 资源页面和 Eclipse Wiki 中包含许多很好的在线参考资料。[Eclipse Live http://live.eclipse.org/](http://live.eclipse.org/)上也有相当多的教程和其他演示文稿形式的好材料，其中一些来自 eclipsecon 会议。

我建议从这些资源的最新条目开始，因为现在 RCP 比几年前要容易得多。

可以尝试的一些事情： 1) 使用平台命令框架，而不是作为 RCP 示例程序中流砥柱的旧 Actions 框架。2) 使用数据绑定农事来简化 UI 布线。3) 如果您正在开发基于表单的应用程序，请查看 UI Forms API，它提供了一种控制表单样式的好方法（并添加了可折叠部分等细节）。4) 查看 EMF 以构建您的数据模型 - 数据绑定现在直接支持 EMF。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T13:57:26.993

好的一面：了解所有 API 及其要求确实很难，但随着您注意到代码变得更好的结构和可维护性，以后肯定会有所回报。原因之一是您被迫遵守有关开发丰富而复杂的桌面应用程序的所有最佳实践。

坏的一面：很容易过度设计你的应用程序，所以要小心。

我相信你提到的那本书是迄今为止大部分基础都在那里的最好的书。阅读本书后，我的建议是从 CVS 下载（更好的是，设置 CVS 存储库浏览器）Eclipse 及其相关项目的源代码，并将其用作解决特定问题的指南。除了反复试验之外，这是找出实现复杂应用程序的“Eclipse RCP”方式的最佳方式。使用和学习大量示例（并且大部分时间写得很好）源代码的一种方法是考虑 Eclipse IDE 或其子项目上的特定功能，该功能与您想要实现的功能类似，然后去看看在其源代码中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-11T15:25:55.247

以下是我用来帮助学习不同事物的两个在线资源：

[http://www.vogella.de/eclipse.html](http://www.vogella.de/eclipse.html)
[http://www.eclipse-tips.com/tutorials](http://www.eclipse-tips.com/tutorials)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-19T07:29:25.760

[Contributing to Eclipse](https://rads.stackoverflow.com/amzn/click/com/0321205758)很好地介绍了 eclipse 的开发方式。虽然在技术上有点过时，但它提供了 eclipse 平台的开发原理和核心概念的概述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-19T14:05:07.717

Eclipse Platform Plug-In Developer Guide 中的 Programmer's Guide（在 Eclipse 的 F1 帮助和[http://help.eclipse.org/helios/index.jsp?nav=/2_0](http://help.eclipse.org/helios/index.jsp?nav=/2_0)中的 3.6，在撰写本文时的最新版本）有关于特定子系统如何工作和组合在一起的许多有用的概述信息。

这个来源可能看起来很明显，但根据我的经验，很难找到这些信息。（对我来说，Google 似乎总是转而发布和转发新闻组或论坛主题或其他（通常有用且写得很好，但过时的）Eclipse Corner 2002 年的文章。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-26T01:13:37.960

请尝试阅读本书：《EclipseRCP 富客户端平台 - 设计、编码和打包 Java 应用程序 Addison Wesley》

# windows - 如何从 Windows 客户端打开 SSH 隧道作为后台程序？

> ID：312471
> 
> 赞同：5
> 
> 时间：2008-11-23T12:50:04.133
> 
> 标签：windows, ssh

我希望 Win 机器在机器启动时通过隧道连接到 SSH 服务器。我还希望 win 机器在 SSH 程序崩溃时重新启动它。SSH 程序越轻量级越稳定，我越开心。

我有什么选择？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T12:59:31.587

查看使用 srvany 将 SSH 客户端作为 Windows 服务启动。然后您可以将服务设置为在 Windows 启动时自动启动。

本质上，srvany.exe 将允许您从 Windows 服务控制管理器启动任何程序。

[http://support.microsoft.com/kb/137890](http://support.microsoft.com/kb/137890)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T12:55:49.473

[PuTTY 套件](http://www.chiark.greenend.org.uk/~sgtatham/putty/)可能是您最好的选择，IMO 。（免责声明：我有偏见，因为 Simon Tatham 是我的大学朋友。请注意，这意味着我知道他是多么细致......）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-13T20:47:13.047

如果您希望在断开连接的情况下**重新启动程序**，我所知道的最好的应该是软件推荐：[AlwaysUp](http://www.coretechnologies.com/products/AlwaysUp/)（2015 年 5 月不是免费的）。

它仍然是**轻量级的 4.2MB 安装程序，并且****内存**消耗量不大：

```
C:\>tasklist | find "always" /i
AlwaysUp.exe                  3112 Console                    1    17.388 KB 
```

当转换为服务时，**稳定性**`SrvAny`（或只是使服务工作）`SC`可能是一场噩梦。*AlwaysUp*，只要我已经测试过，它可以解决大多数问题，并为您提供**额外的选项**，如详细的日志、统计信息、电子邮件警报......等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-03-19T03:55:19.777

PuTTy 肯定是最好的选择，但它不支持自动重启。我个人经常使用 ssh 隧道，我有 30 多个隧道。我想要一个可以轻松配置和维护的脚本，所以我想出了一个 PowerShell 脚本。张贴[在这里](http://tsherlock.tech/2019/03/13/simple-ssh-tunnel-auto-reconnect-using-putty-and-powershell/)。SO规则要求我也发布解决方案作为答案，很高兴这样做：

要开始使用它，您需要这样的配置：

```
# LocalPort TargetHost  TargetPort  SshHost SshUsername SshKeyPath 
18080   google.com  80  bastion.example.com User    D:\secure\path\to\private_key.ppk 
```

将其保存为 config.csv。并使用 powershell 脚本来保持它是：

```
<#
.SYNOPSIS
  Powershell script for keeping ssh tunnel up and running

.DESCRIPTION
  This script uses configuration of tunnels located in config.csv. For more information visit http://tsherlock.tech/2019/03/13/simple-ssh-tunnel-auto-reconnect-using-putty-and-powershell/

.NOTES
  Version:        1.0
  Author:         Anton Shkuratov
  Creation Date:  2019-03-13
  Purpose/Change: Initial script development

#>

$currentDir = $PSScriptRoot
if (-not $env:PATH.Contains($currentDir)) {
  $env:PATH="$env:PATH;$currentDir"
}

# Check plink is accessible
try {
  Start-Process plink.exe -WindowStyle Hidden
} catch {
  Write-Host Error running plink.exe Please make sure its path is in PATH environment variable
  EXIT 1
}

# Parse config
$config = [System.IO.File]::ReadAllLines("$currentDir\config.csv");
$bindings = New-Object System.Collections.ArrayList
$regex = New-Object System.Text.RegularExpressions.Regex("(\d)+\s([^ ]+)\s(\d+)\s([^ ]+)\s([^ ]+)\s([^ ]+)", [System.Text.RegularExpressions.RegexOptions]::IgnoreCase);
$keyPasswords = @{}
$procs = @{}

foreach($line in $config) {
  $match = $regex.Match($line)

  if ($match.Success) {
    $sshKey = $match.Groups[6];

    $bindings.Add(@{
      LocalPort = $match.Groups[1];
      TargetHost = $match.Groups[2];
      TargetPort = $match.Groups.Groups[3];
      SshHost = $match.Groups[4];
      SshUser = $match.Groups[5];
      SshKey = $match.Groups[6];
    });

    if (-not $keyPasswords.ContainsKey($sshKey)) {
      $pass = Read-Host "Please enter password for key (if set): $sshKey" -AsSecureString
      $keyPasswords.Add($sshKey, $pass);
    }
  }
}

# Starting Processes
function EnsureRunning($procs, $keyPasswords, $binding) {

  if ($procs.ContainsKey($binding) -and $procs[$binding].HasExited) {

    $proc = $procs[$binding]
    $sshKey = $binding.sshKey
    $out = $proc.StandardError.ReadToEnd()

    if ($out.Contains("Wrong passphrase")) {
      Write-Host "Wrong pass phrase for $sshKey, please re-enter"
      $pass = Read-Host "Please enter password for key: $sshKey" -AsSecureString
      $keyPasswords[$sshKey] = $pass;
    } else {
      $exitCode = $proc.ExitCode
      $tHost = $binding.sshHost

      Write-Host "Connection to $tHost is lost, exit code: $exitCode"
    }
  }

  if (-not $procs.ContainsKey($binding) -or $procs[$binding].HasExited) {
    $sshUser = $binding.SshUser
    $sshHost = $binding.SshHost
    $sshKey = $binding.SshKey
    $lPort = $binding.LocalPort
    $tPort = $binding.TargetPort
    $tHost = $binding.TargetHost
    $sshKeyPass = [Runtime.InteropServices.Marshal]::PtrToStringAuto([Runtime.InteropServices.Marshal]::SecureStringToBSTR($keyPasswords[$sshKey]))

    $psi = New-Object System.Diagnostics.ProcessStartInfo;
    $psi.FileName = "plink.exe";
    $psi.UseShellExecute = $false;

    $psi.CreateNoWindow = $true;
    $psi.RedirectStandardInput = $true;
    $psi.RedirectStandardError = $true;

    $psi.Arguments = "-ssh $sshUser@$sshHost -i `"$sshKey`" -batch -pw $sshKeyPass -L $lPort`:$tHost`:$tPort"

    $proc = [System.Diagnostics.Process]::Start($psi);

    Start-Sleep 1

    if (-not $proc.HasExited) {
      Write-Host Connected to $sshUser@$sshHost
    }

    $procs[$binding] = $proc;
  }
}

function EnsureAllRunning($procs, $keyPasswords, $bindings) {
  while($true) {
    foreach($binding in $bindings) {
      EnsureRunning $procs $keyPasswords $binding
    }
    Start-Sleep 1
  }
}

try {
  # Waiting for exit command
  Write-Host Working... Press Ctrl+C to stop execution...
  EnsureAllRunning $procs $keyPasswords $bindings
} finally {
  # Clean up
  Write-Host Clean up

  foreach($proc in $procs.Values) {
    if ($proc -ne $null -and -not $proc.HasExited) {
      $proc.Kill();
    }
  }
} 
```

然后只需运行它：

```
powershell -File autossh.ps1 
```

# regex - 正则表达式过滤器以消除字母“I”前带有 AlphaNumeric 的记录

> ID：312487
> 
> 赞同：2
> 
> 时间：2008-11-23T13:08:50.867
> 
> 标签：regex

如果第一个“I”之前有一个字母数字字符，需要帮助缩小此 Regex 的范围以不返回记录

```
"I([ ]{1,2})([a-zA-Z]|\d){2,13}" 
```

想要从这个字符串中捕获 I APF，而不是 I ARPT。

```
I APF                     'NAPLES MUNI ARPT.            ' 42894 JEB 29785584 
```

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T13:17:36.043

`\b`表示正则表达式中的单词边界，因此以下应该有效（假设您对正则表达式的其余部分感到满意​​）：

```
("\bI([ ]{1,2})([a-zA-Z]|\d){2,13}") 
```

单词边界定义为单词字符和非单词字符之间的零宽度空间。根据您的正则表达式引擎，单词字符可能是字母数字字符或下划线，因此使用 \b 将匹配 I ALF in`-I ALF`但不匹配`_I ALF`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T13:20:21.950

```
\bI[ ]{1,2}[A-Za-z0-9]{2,13} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T17:23:48.713

边界一词似乎是一个很好的解决方案。您没有告诉我们您将使用哪种正则表达式引擎/语言：例如，JavaScript 没有后视功能。
正如另一位指出的那样，您的表达方式有点过于复杂（这会损害速度）。
我的版本是：

```
\bI  ?[A-Za-z\d]{2,13} 
```

有或没有捕获，取决于您的需要。您可能还想用 \b 结束表达式，以确保表达式后不再有字母数字字符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T16:06:20.447

你可以尝试做一个消极的回顾：

```
(?<![a-zA-Z0-9])I([ ]{1,2})([a-zA-Z]|\d){2,13} 
```

我不确定它的工作范围有多广（即使用不同的正则表达式库）

# windows-installer - 将 MSIUSEREALADMINDETECTION 添加到 MSI 的脚本

> ID：312490
> 
> 赞同：8
> 
> 时间：2008-11-23T13:10:27.743
> 
> 标签：windows-installer

[任何人都有一个本着这个方便脚本](http://blogs.msdn.com/astebner/archive/2007/05/28/2958062.aspx)的精神的脚本（JScript、VBScript 或类似的），但添加了[MSIUSEREALADMINDETECTION](http://msdn.microsoft.com/en-us/library/aa816403(VS.85).aspx)属性

我知道我可以手动使用 Orca 或使用它的转换功能，但我不想去那里。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-23T14:15:53.557

一些参考

*   [Windows Installer SDK - 执行 SQL 语句](http://msdn.microsoft.com/en-us/library/aa368568(VS.85).aspx)

*   [wirunsql.vbs](http://www.koders.com/noncode/fid9C9C2D7366257C7CD2F39E21D97397EB035201BE.aspx)

修改问题中引用的 CustomAction_NoImpersonate.js 会给出这个脚本，它可以在 Properties 表中添加/设置任何值。

使用“cscript.exe MSI_SetProperty.js your.msi 属性值”调用

```
// MSI_SetProperty.js <msi-file> <property> <value>
// Performs a post-build fixup of an msi to set the specified property (and add it if it doesn't already exist)

// Constant values from Windows Installer SDK
var msiOpenDatabaseModeTransact = 1;
var msiViewModifyInsert         = 1;
var msiViewModifyUpdate         = 2;  

if (WScript.Arguments.Length != 3)
{
    WScript.StdErr.WriteLine("Usage: " + WScript.ScriptName + "file property value");
    WScript.Quit(1);
}

var filespec = WScript.Arguments(0);
var property = WScript.Arguments(1);
var value = parseInt(WScript.Arguments(2));
var installer = WScript.CreateObject("WindowsInstaller.Installer");
var database = installer.OpenDatabase(filespec, msiOpenDatabaseModeTransact);

WScript.StdOut.WriteLine("Looking for property:" + property);

try
{   
    var sql = "SELECT Property, Value FROM Property WHERE Property = '" + property + "'";   
    var view = database.OpenView(sql);  
    view.Execute();     
    var record = view.Fetch();  

    if (record)
    {       
        while (record)
        {
            WScript.StdOut.Write("Found: " + record.StringData(0) + ", " + record.StringData(1) + ", " + record.StringData(2));
            if (record.IntegerData(2) != value)
            {
                WScript.StdOut.WriteLine(" - changing to " + value);
                record.IntegerData(2) = value;
                view.Modify(msiViewModifyUpdate,record);
            }
            else
                WScript.StdOut.WriteLine(" - OK");

            record = view.Fetch();
        }
    }
    else
    {           
        WScript.StdOut.WriteLine("Not found, so adding");
        // There may be a better way to do this?
        sql = "INSERT INTO Property (Property,Value) VALUES ('" + property + "','" + value + "')";
        view = database.OpenView(sql);
        view.Execute();     
    }
    view.Close();
    database.Commit();
}
catch(e)
{
    WScript.StdErr.WriteLine(e);
    WScript.Quit(1);
} 
```

# svn - 强制 SVN 签出命令覆盖当前文件

> ID：312491
> 
> 赞同：66
> 
> 时间：2008-11-23T13:10:36.450
> 
> 标签：svn

我正在向 SVN 添加现有站点。

这些文件已经存在于网络服务器上，现在相同的副本（- 配置文件）存在于存储库中。

我想将 webserver 目录转换为 SVN 工作副本，但是当我运行时：

```
svn checkout http://path.to/svn/repo/httpdocs . 
```

我得到错误：

> svn：添加文件失败''：同名对象已存在

我如何告诉 SVN 只覆盖那些内容相同的文件？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-08-10T15:57:17.540

`svn checkout --force svn://repo website.dir`

然后

`svn revert -R website.dir`

将检查 website.dir 中现有文件的顶部，但不会覆盖它们。然后还原将覆盖它们。这样，您无需关闭站点即可完成它。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-11-23T13:27:16.820

试试这个`--force`选项。`svn help checkout`给出细节。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-07-09T12:18:54.067

这可以很容易地完成。我所做的只是将现有目录（不受版本控制）移动到临时目录。然后我将SVN版本检查到我正确的目录名，将临时目录中的文件复制到SVN目录中，并恢复SVN目录中的文件。如果这没有意义，下面有一个例子：

```
/usr/local/www

mv www temp_www
svn co http://www.yourrepo.com/therepo www
cp -pR ./temp_www/* ./www
svn revert -R ./www/*
svn update 
```

我希望这会有所帮助，但不确定为什么只是简单的 SVN 更新并没有将文件改回来？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-04-18T13:13:07.837

I did not have 1.5 available to me, because I am not in control of the computer. The file that was causing me a problem happened to be a .jar file in the lib directory. Here is what I did to solve the problem:

```
rm -rf lib
svn up 
```

This builds on Ned's answer. That is: I just removed the sub directory that was causing me a problem rather than the entire repository.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-23T13:13:46.973

从存储库拉到一个新目录，然后将旧目录重命名为 ，将新目录重命名为`old_crufty`，`my_real_webserver_directory`一切顺利。

如果您的意图是每个文件都在 SVN 中，那么这是测试您的理论的好方法。如果您的意图是某些文件不在 SVN 中，请使用 Brian 的复制/粘贴技术。

# php - Codeigniter - 我希望为我的一个控制器和一个模型使用/连接到不同的数据库

> ID：312511
> 
> 赞同：1
> 
> 时间：2008-11-23T13:22:45.287
> 
> 标签：php, codeigniter

我希望为我的一个控制器和一个模型使用/连接到不同的数据库。我发布了这个消息，因为在 CI 的论坛上我没有得到任何回应。

我在 database.php 中添加了这个：

```
$db['tdb']['hostname'] = "localhost";//localhost

$db['tdb']['username'] = "username";//root

$db['tdb']['password'] = "password";//empty

$db['tdb']['database'] = "databasename";

$db['tdb']['dbdriver'] = "mysql";

$db['tdb']['dbprefix'] = "";

$db['tdb']['pconnect'] = FALSE;

$db['tdb']['db_debug'] = FALSE;

$db['tdb']['cache_on'] = FALSE;

$db['tdb']['cachedir'] = "";

$db['tdb']['char_set'] = "utf8";

$db['tdb']['dbcollat'] = "utf8_general_ci"; 
```

这是我的模型：

```
<?php

class Tadmin_model extends Model{

    function Tadmin_model(){

        parent::Model();

        $tdb = $this->load->database('tdb', TRUE);            
    }

    function FInsert($usernames){

        $query = $tdb->query("SELECT * FROM following");

        return $query->row();
    }    
}

?> 
```

这是我的控制器的开始：

```
<?php

class Tadmin extends Controller{

    function Tradmin(){

        parent::Controller();

        $this->load->model('tadmin_model'); 
```

我得到这个错误：

> 遇到 PHP 错误
> 
> 严重性：通知
> 
> 消息：未定义变量：tdb
> 
> 文件名：models/tadmin_model.php
> 
> 电话号码： ...
> 
> 致命错误：在线调用 /blablabla/tadmin_model.php 中非对象的成员函数 query() ...

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T03:18:04.317

您的问题不在于使用 CodeIgniter 的数据库函数，而在于类中的变量范围。当您加载模型时，您将连接到数据库并将结果分配给模型构造函数中的局部变量。当任何函数完成时，局部变量将被丢弃。稍后您尝试在已被丢弃的 $tdb 变量上调用 query() 方法并得到错误。

您需要将 $this->load->database() 的结果存储在构造函数和方法都可以使用的位置。您可以将 $this->load->database() 调用移动到控制器方法中，并在每次调用模型上的 Tradmin 方法时连接到另一个数据库。

如果您想让模型中的所有方法都可以使用 $tdb，另一种方法是在类上使用成员变量，它看起来像这样......

```
<?php

class Tadmin_model extends Model{
    var $tdb;

    function Tadmin_model(){

        parent::Model();

        $this->tdb = $this->load->database('tdb', TRUE);            
    }

    function FInsert($usernames){

        $query = $this->tdb->query("SELECT * FROM following");

        return $query->row();
    }    
}

?> 
```

希望有帮助。

吉姆。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T19:12:40.320

你试过在 FIinsert 函数中加载 $tdb 吗？看起来 $tdb 可能是一个局部变量，FIinsert 无法访问...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-08T20:23:58.843

tdb 需要在构造函数的范围之外定义，即作为类成员，如：

```
class Tadmin_model extends Model {
    var $tdb;

    function Tadmin_model() {
        parent::Model();
        $this->tdb = $this->load->database('tdb', TRUE);            
    }
} 
```

# google-maps - 从 Google Maps API 中的单个 LatLong 确定缩放级别

> ID：312517
> 
> 赞同：6
> 
> 时间：2008-11-23T13:26:30.083
> 
> 标签：google-maps

我在使用 Google Maps API 时遇到了一些问题；我想确定某个地方的经纬度（例如，根据城市名称），然后将我的地图重点放在它上面。LatLong 部分正在工作，因此将地图集中在该点上。但是，当我只有一个点时，我无法弄清楚如何确定一个好的缩放级别。我不能只是去一些大多数时候看起来不错的标准缩放级别，因为例如，当用户输入“俄罗斯”而不是“阿姆斯特丹”时会发生什么？一些帮助将不胜感激:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-27T21:03:18.210

我刚刚在 Google IO 上问了这个问题。此功能存在，但未记录在案，并且还没有访问器。您想要做的是获取[结构化地址](http://code.google.com/apis/maps/documentation/services.html#Geocoding_Structured)。检查您返回的 json 结构并查找这些新参数。当我有机会尝试这个时，我会发布更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T14:03:23.893

您的问题缺少输入参数。您说的是 LatLon 点，但实际上您需要 LatLonBounds 来聚焦可用的地图窗口大小。我假设您想模仿官方的 Google 地图行为。除了地理编码之外，它们还依赖于 Gmap API 无法访问的其他数据。所以你必须提供你自己的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T21:03:27.427

如果您可以为其提供适当的矩形边界对象，则以下调用将为您提供缩放级别：

```
GMap2.getBoundsZoomLevel(bounds) 
```

但是如何计算边界？

您可以使用地图使用“通过眼睛”确定的矩形手动注释每个源记录，并让某人输入值。

理想情况下，您需要数据，幸运的是 DBPedia 上有大量数据。

我的几何和代数有点生疏，但两者都有一点，我相信你可以根据你想要查看的位置区域计算出一个矩形。（如果假设一个方形城市，可能从平方根开始，或者如果假设一个圆形城市，则重新排列 πr ^(2 ）)

[试试](http://dbpedia.org/snorql/)这个查询来提取区域的面积。

```
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX dbpedia2: <http://dbpedia.org/property/>
SELECT ?url, ?label, ?lat, ?long, ?area WHERE {
   ?url geo:lat ?lat .
   ?url geo:lat ?long .
   ?url rdfs:label ?label . FILTER ( lang(?label) = 'en' ) .
   ?url dbpedia2:area ?area . FILTER ( datatype(?area) = xsd:double ) 
} LIMIT 10 
```

您需要缓存结果或将它们加载到更快的本地数据源中，因为 DBPedia 正在搜索数百万个非结构化数据（以及 RDF 数据）的三元组。您可以从 DBPedia[下载 Titles、Infobox 和坐标数据集](http://wiki.dbpedia.org/Downloads32)并将它们加载到例如 Jena 中。请记住在加载过程中关闭所有验证选项:-)

您还可以使用具有相当可用的 Web 表单的[RESTful API](http://dbpedia.org/sparql)访问此数据，并且可以使用 firefox 下载窗口中的“复制下载链接按钮”或将输出格式设置为 HTML 来提取其生成的 URL。它还生成 XML 和[JSON](http://tinyurl.com/c8oqdg)。

不要忘记为摇摆不定的城市添加边距...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-11T01:31:04.877

我也有同样的问题，尼克·雷塔拉克的回答对我有用。为了提供更多详细信息，未记录属性的名称是“ExtendedData”，其中包含“LatLonBox”，其中包含适当缩放级别的北、南、东和西边界。

例如，如果您要搜索“90210”，这里是输出（为了便于阅读，我已对其进行了格式化）：

```
{
    "id":"p1",
    "address":"Beverly Hills, CA 90210, USA",
    "AddressDetails":{
        "Accuracy":5,
        "Country":{
            "AdministrativeArea":{
                "AdministrativeAreaName":"CA",
                "SubAdministrativeArea":{
                    "Locality":{
                        "LocalityName":"Beverly Hills",
                        "PostalCode":{"PostalCodeNumber":"90210"}
                    },
                    "SubAdministrativeAreaName":"Los Angeles"
                }
            },
            "CountryName":"USA",
            "CountryNameCode":"US"
        }
    }, 
```

> ```
>  // This is what you're looking for
>      "ExtendedData":{
>          "LatLonBox":{
>              "north":34.13919,
>              "south":34.067018, 
>              "east":-118.38971, 
>              "west":-118.442796
>          }
>      }, 
> ```

```
 "Point":{
        "coordinates":[-118.4104684,34.1030032,0]
    }
} 
```

虽然这是无证的，所以我不确定它是否会在 API 更改后继续存在。最好不要假设它会一直存在，并定义一些合理的默认缩放值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-03T15:08:22.787

您是否从地理编码器获取您的位置点？如果是这样，您可以获取该点的准确性并以此为基础进行缩放（更高的准确性 = 更高的缩放）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-05T18:26:33.207

我在这里用 Objective-C 实现了 Nick Retallack 的解决方案的一个版本。

[Google Maps GMap2.getBoundsZoomLevel(bounds) 的等效 Objective-C 代码？](https://stackoverflow.com/questions/4055968/equivlent-objective-c-code-for-google-maps-gmap2-getboundszoomlevelbounds)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-06-14T19:43:44.417

我在[这里](https://stackoverflow.com/questions/44552575/setting-perfect-zoom-level-for-a-place-with-google-api)遇到了同样的问题，但使用了更新的 API 版本。新的解决方案是`map.fitBounds(autocomplete.getPlace().geometry.viewport);`.

# .net - 在包装 DLL 中引用 Microsoft Enterprise Library DLL 文件

> ID：312523
> 
> 赞同：3
> 
> 时间：2008-11-23T13:30:32.087
> 
> 标签：.net, dll, reference, gac

我正在使用[Microsoft Enterprise Library](http://en.wikipedia.org/wiki/Microsoft_Enterprise_Library)编写应用程序。我为该企业库 DLL 文件编写了一个包装 DLL。我想在一些[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)应用程序中使用我的包装器。问题是每次我想使用我的包装器时，我都会在编译中收到一个错误，指出缺少对 Enterprise Library DLL 文件的引用。

我可以通过提供这个参考来简单地解决它，但我认为我在这里遗漏了一些东西，因为我只是将企业库 DLL 文件包装在我的 DLL 中。为什么没有从我的包装项目继承到 Windows 窗体项目的引用？

据我了解，Windows 窗体应用程序搜索 bin 目录，然后搜索[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache)，如果找不到所需的 DLL 文件，则会引发错误。

Microsoft 企业库 DLL 文件已经签名并在 GAC 中，那么这里有什么问题？正如我所说，我觉得我错过了一些东西！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T13:38:45.830

程序集引用不可传递。

如果引用并调用引用程序集 B 的程序集 A，则不会自动获得对程序集 B 的引用。如果您与 A 的交互需要来自 B 的类型，那么您也需要引用 B。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T13:38:14.770

您必须指定您使用的库（然后才会在本地文件夹和 GAC 中搜索它）

引用不是“继承的”，因为它是动态链接的（并且不包含在您的 dll 中），它们将在需要时打开。

# macos - OS X 使用 ssh_config 在 sudo 下运行 rsync

> ID：312527
> 
> 赞同：2
> 
> 时间：2008-11-23T13:34:46.337
> 
> 标签：macos, ssh, rsync

我想设置一个自动`rsync`作业，将我的 OS X 机器上的一堆用户帐户备份到 linux 文件服务器。我已经设置了从我的帐户到另一台机器的无密码 ssh，它工作得很好，所以我尝试使用这个命令：

```
sudo rsync -avz /Users/jbloggs myserv:/var/Backup/ 
```

我在哪里`myserv`设置了别名`~/.ssh/config`。我遇到的问题是我必须使用 sudo 才能使该命令正常工作——在我的个人帐户下，我无权访问其他用户的主目录来复制文件以进行备份。该命令在没有 sudo 的情况下在我自己的帐户上运行良好，但是当我在 sudo 下运行时，它不再查看我的`~/.ssh/config`内容（因此它抱怨“未知主机 myserv”）。

如何让 rsync 在 sudo 下运行以仍然查看我的个人信息`~/.ssh/config`？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T13:47:51.163

您可以使用

```
ssh -i /Users/myuser/.ssh/id_rsa -F /Users/myuser/.ssh/config login@host 
```

让 ssh 使用您的配置/密钥文件。使用“-v”检查它正在使用哪个文件。您还可以将您的配置 / id 复制到 /var/root/.ssh，默认情况下将在通过 sudo 使用 ssh 时使用。

要将这些选项传递给 rsync，您必须像这样设置“--rsh”/“-e”：

```
rsync -e "ssh -i ... -F ..." 
```

# python - 没有名为 django.core 的模块

> ID：312549
> 
> 赞同：69
> 
> 时间：2008-11-23T14:09:24.893
> 
> 标签：python, django

卸载旧 Django 版本后，我已更新到最新的 Django 版本 1.0.2。但是现在当我运行 django-admin.py 时，出现以下错误。我该如何解决这个问题？

```
Traceback (most recent call last):
  File "C:\Python25\Lib\site-packages\django\bin\django-admin.py", line 2, in <module>
    from django.core import management
ImportError: No module named django.core 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2012-04-09T07:13:06.340

我在 Windows 上遇到了同样的问题，看来我已经找到了问题所在。我安装了 2.7 和 3.x。好像和.py的关联程序有关：

在命令行类型中：

> 关联.py

结果是：

.py=Python.文件

这意味着 .py 与 Python.File 相关联

然后我尝试了这个：

> ftype Python.File

我有：

Python.File="C:\Python32\python.exe" "%1" %*

这意味着在命令行中 .py 与我的 Python 3.2 安装相关联——这就是为什么我不能只键入“django-admin.py blah blah”来使用 django。

您需要做的就是更改关联：

> ftype Python.File="C:\Python27\python.exe" "%1" %*

然后一切都好！

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-11-28T08:40:35.383

您必须确保 django 在您的 PYTHONPATH 中。

要测试，只需`import django`从 python shell 执行。应该没有输出：

```
ActivePython 2.5.1.1 (ActiveState Software Inc.) based on
Python 2.5.1 (r251:54863, May  1 2007, 17:47:05) [MSC v.1310 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import django
>>> 
```

如果您通过`setuptools`(`easy_install`或django 附带的) 安装了 django，则`setup.py`检查文件 ( , , ...) 是否指向正确的文件夹。`site-packages``.pth``easy-install.pth``django.pth`

嗨。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2010-01-31T16:08:18.423

您可以通过提供 django-admin.py 文件的完整路径来解决此问题

```
python c:\python25\scripts\django-admin.py startproject mysite 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-02-28T21:21:39.587

我今天遇到了这个问题，原来我的路径中有 C:\Python26 并且 .py 文件与 Python 3.1 相关联。通过程序和功能或运行 .msi 修复正确版本的 Python 将修复关联。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-11-18T17:07:18.320

正如上面其他人提到的，对我来说这是一个 PYTHONPATH 环境变量问题，但没有人真正展示过如何为可以使用额外指令的人设置它。

**Linux (bash)**

我在我的主文件夹中的 bashrc 文件中设置了这个变量（.bashrc 是我的文件，因为我的 shell 是 /bin/bash）。

```
vim ~/.bashrc
export PYTHONPATH=/usr/local/python-2.7.2/lib/python2.7/site-packages:$PYTHONPATH
source ~/.bashrc 
```

路径应该在您的 django 源所在的任何位置。我的位于/usr/local/python-2.7.2/lib/python2.7/site-packages/django，所以我只是指定了/usr/local/python-2.7.2/lib/python2.7/site-没有 django 部分的软件包。

**操作系统**

在 OSX 上，路径是`/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages`，您可以将其添加到`/etc/profile`：

```
sudo echo "PYTHONPATH=/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages:$PYTHONPATH" >> /etc/profile
source /etc/profile 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-01-17T15:21:48.930

我确定这与我的设置中的某些错误有关，但是我遇到了同样的问题，如果我这样称呼它，它可以正常工作

```
c:\somedir>python c:\Python26\scripts\django-admin.py startproject mysite 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-03-02T10:16:13.253

如果您使用的是 Windows，则不要使用 'django-admin.py' 运行，因为这将调用您的外部 python.exe 来执行并且它无法读入虚拟环境中的 django。尝试“python django-admin.py”在您的环境中使用您的 python.exe。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-03-08T00:30:52.040

这对我有用 bitnami djangostack：

```
python apps\django\django\bin\django-admin.py startproject mysite 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-03-01T06:31:43.740

我在windows xp中遇到了同样的问题。原因是我安装了多个 python 版本（2.6、3.2）。windows 的 PATH 正确设置为 python26，但 .py 文件与 python32 相关联。我希望.py文件与python26关联。要解决它，最简单的方法是右键单击* .py（如django-admin.py），选择“打开方式”->“选择程序...” ->“浏览...”（选择 c:\python26\python.ext）->“确定”。然后我们可以在 cmd 中运行 django-admin.py，而不需要解释性前缀“c:\python26\lib\site-packages\django\bin”。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-03-23T14:24:32.437

我知道这是一个老问题，但我也遇到了同样的问题，在我的情况下，这是因为我正在使用带有 django 的 virtualenv，但是 Windows 中的 .py 文件扩展名与主要的 Python 安装相关联，所以运行django-admin.py 直接来自命令提示符，导致它在没有安装 django 的情况下使用主要的 Python 安装运行。

所以，由于我不知道 Windows 中是否有任何等效的哈希磅，我通过运行 python 后跟 django-admin.py 的完整路径来解决这个问题，或者您也可以修改 virtualenv 批处理脚本来更改文件关联并在您停用它时将其更改回来（尽管我不知道该怎么做，因为我对批处理脚本并不熟悉）。

希望这可以帮助，

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-10-03T20:30:54.067

我遇到了同样的问题，并记得我在前一天下午安装了 iPython。我卸载了 iPython，问题就消失了。顺便说一句，我正在使用 virtualenv。我已经在系统范围的站点包目录中安装了 iPython，所以我只是在我正在使用的每个 virtualenv 中重新安装了 iPython。昨天安装 iPython 后，我注意到一条警告消息（来自 iPython 的 0.13 版），它检测到我正在使用 virtualenv，如果遇到任何问题，我应该在每个 virtualenv 中安装 iPyton。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-05-27T16:49:34.437

如果您的路径变量是正确的，并且您可以从 python shell 执行以下操作： from django.core import management ，请确保您在“django-admin.py”之前包含“python”：python django-admin.py startproject thelittlethings

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-03-10T08:20:27.470

最简单但不是最优雅的解决方案是从 Scripts 文件夹中复制 django-admin.py。Scripts 文件夹将在您的 Python 安装下找到。在我的计算机上，它位于 C:\Python26\Scripts 中。然后将 django-admin.py 粘贴到您尝试从中运行文件的文件夹中。确实，使用系统路径将提供灵活性。如果您赶时间，这是一个特殊的解决方案。然后输入例如 python django-admin.py startproject fluffyteaspoons，您将创建项目 fluffyteaspoons

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-12-15T23:47:01.987

就我而言，我使用的是 OS X Lion，并且我已经使用[自制软件](https://brew.sh/)安装了 Python ，但我遇到了同样的错误，但这里发布的解决方案都没有帮助我。就我而言，我只需要编辑脚本：

```
vim /usr/local/share/python/django-admin.py 
```

我注意到第一行是错误的，因为它指向系统的 python 安装：

```
#!/usr/bin/python 
```

我只是将其修改为指向 homebrew 的安装：

```
#!/usr/local/bin/python 
```

它奏效了:)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-09-24T20:56:05.600

这适用于 Mac OS X

在终端运行 python 在 python 中：import sys print sys.path

查找站点包路径。我在 sys.path 的输出中找到了这个：'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages'

退出蟒蛇。查找您当前的站点包在哪里。我的在 /Library/Python/2.6/site-packages

现在要小心：检查站点包的内容以确保它是空的。也就是说，目录 /Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages 应该是空的，或者只包含一个自述文件。如果是，请删除该目录，因为您现在要创建符号链接。

ln -s /Library/Python/2.6/site-packages /Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages

如果您不删除该文件夹，您会将符号链接放在该文件夹中。

其他选项是将路径添加到 sys.path。我选择了符号链接路由，因为我有几个版本的 python，我不想要几个版本的 Django，只想指向已知的工作副本。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-01-27T13:22:58.837

我刚刚在安装了 Python 2.7 和 3.2 并将 virualenv 与 Python 2.7 和 Django 1.4.3 一起使用的 Windows Vista 中遇到了相同的 ImportError。

我将资源管理器中 .py 文件的文件关联从 3.2 更改为 2.7。右键单击 .py 文件并更改设置。我仍然收到 ImportError。

我`cmd.exe`以管理员身份运行并复制粘贴了早期的`ftype`内容。出现错误后，请注意双引号未正确从浏览器复制到 cmd。在cmd中重写了命令，但我仍然得到ImportError。

在活动虚拟环境的根目录中，我明确给出了`python`命令和 django-admin.py 的路径。 `(env_p27) C:\Users\Gemmu\env_p27>python .\Scripts\django-admin.py startproject mysite`

那行得通。

感谢大家的帮助。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-08-01T10:29:30.380

这发生在我身上，因为我运行`pip`时`sudo`我的 virtualenv 设置为不导入外部站点包，所以 Django 是为 root 用户安装的，但不是在 virtualenv 中，即使我在运行 sudo 时激活了 virtualenv。

解决方案切换到root，激活venv然后执行pip install。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-09-01T22:02:24.050

[附上 lichenbo](https://stackoverflow.com/users/1376351/lichenbo)所说的话...如果您使用的是 Windows，则不要使用 'django-admin.py' 运行...

我在虚拟环境中运行，因此创建新项目的路径和命令如下所示：

```
(DjangoEnv)  C:\users\timreilly\Envs\django\Scripts\django-admin.exe startproject myproject 
```

DjangoEnv 是我的虚拟环境的名称。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-01-28T12:29:27.037

像往常一样，安装脚本未能设置世界读取/执行权限:) 这样做：

```
sudo find  /usr/lib/python2.5/site-packages/django -type d -exec chmod go+rx {} \;
sudo find  /usr/lib/python2.5/site-packages/django -type f -exec chmod go+r {} \; 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-09-15T17:59:01.957

感谢您发布问题和答案。我安装了两个版本的 Python，但 root 指向 /usr/bin 版本，我想在 /usr/local/bin 中使用 2.7 版本的 Python。重建/重新安装 Django 和 mysqldb 后，一切都很好，我没有收到错误消息。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-01-01T11:24:35.910

小快速修复只是创建符号链接`ln -s $SOMEWHERE/lib/python2.6/site-packages/django/ ./django`

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-01-18T07:54:57.207

我遇到了同样的问题，很明显我遇到了`PYTHONPATH`配置问题。解决方案很简单，只需在安装 Python 的目录（我的是：C:\Python27）的目录中创建一个具有此名称`django.pth`的文件。将以下行添加到文件中：`PYTHONHOME\Lib\site-packages``PYTHONHOME``django.pth`

```
PYTHONHOME\Lib\site-packages\django 
```

当然，您必须`PYTHONHOME`按照我的说明更改为 Python 的安装目录。

请注意，您可以编辑`django.pth`以包含要包含在`PYTHONPATH`. 实际上，您可以根据需要命名该文件，`path.pth`例如，如果您希望它更通用并包含多个目录路径。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2012-04-25T08:11:12.793

嗯..我做了一些激进的事情。我 unistall python 并从 Environment `Variables/PATH this: ;C:\Python26\Scripts;C:\Python26.` And Its work 中删除......我以前遇到过你的问题。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-12-27T08:01:43.797

我意识到发生这种情况是因为我没有跑步`python setup.py install`。这设置了环境。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-02-08T06:35:41.147

在阅读了很多之后，我找到了一个适合我的解决方案。

我有

```
 django version 1.9.2 
```

1.  在“路径”中设置所有系统变量。用户变量和 PYTHONPATH 中没有重复副本。 [![在此处输入图像描述](https://i.stack.imgur.com/pygwL.png)](https://i.stack.imgur.com/pygwL.png)

2.  然后在 regedit 中设置 Value

[![在此处输入图像描述](https://i.stack.imgur.com/HtlWl.png)](https://i.stack.imgur.com/HtlWl.png)

3.  通过命令在所需文件夹中创建了一个 virtualenv

    虚拟环境 VENV

4.  最后在 cmd

***使用的命令***

```
django-admin.py startproject MySite

***and not this***

python django-admin.py startproject MySite 
```

在“VENV”的根文件夹中

它奏效了

# .net-3.5 - 从已知的 XSD 生成 .Net 对象

> ID：312551
> 
> 赞同：3
> 
> 时间：2008-11-23T14:10:33.050
> 
> 标签：.net-3.5, xsd

我有一些定义我的对象层次结构的 XSD-s。例如 math.xsd、base.xsd 而 math.xsd 取决于 base.xsd。我需要从那些 xsd-s 生成类。

我已经阅读了这两个工具： [CodeXS](http://www.bware.biz/CodeXS/CodeXS.asmx)工具和 [XSD.exe](http://www.bware.biz/CodeXS/CodeXS.asmx)。xsd.exe 的问题是我没有成功从两个相互依赖的 xsd-s 生成类。有没有人知道在这种情况下使用 xsd.exe 的正确参数？

此外，我正在寻找： - 更多工具 - 这些工具之间的比较 - xsd to object using .net 3.5 谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-22T01:46:06.943

您没有理由不能使用相同的方法`xsd.exe`，然后针对生成的 CodeDOM 模型运行您自己的代码，以在将 .cs 文件写入磁盘之前进行所需的修改。

一般的想法是将 XSD 文件加载到`XmlSchema`对象中，然后使用内部`XmlCodeExporter`和`XmlSchemaImporter`类来填充 CodeDOM 命名空间。

完成此操作后，您可以自由地对 CodeDOM AST 进行所需的任何调整，然后将其写入磁盘。

例如。

```
 XmlSchema schema = null; // Load XSD file here
  var schemas = new XmlSchemas();
  schemas.Add(schema);

  var ns = new CodeNamespace { Name = "MyNamespace" };

  ns.Imports.Add(new CodeNamespaceImport("System"));
  ns.Imports.Add(new CodeNamespaceImport("System.Collections.Generic"));

  var exporter = new XmlCodeExporter(ns); 
  var importer = new XmlSchemaImporter(schemas); 

  foreach (XmlSchemaElement element in schema.Elements.Values) 
  { 
    var mapping = importer.ImportTypeMapping(element.QualifiedName);
    exporter.ExportTypeMapping(mapping); 
  }

  // Transform CodeDOM as required, adding new attributes, methods, modifying
  // inheritance hierarchy, whatever.

  var provider = new CSharpCodeProvider(); 
  using (var writer = new StreamWriter(outputFile, false))
    provider.GenerateCodeFromNamespace(ns, writer, new CodeGeneratorOptions()) 
```

如果您的架构引用其他架构，您必须使用`XmlSchemaSet`，并将`XmlResolver`属性设置为您编写的解析器，它将找到导入的架构并`XmlSchemaSet`在您调用`Compile()`它时将它们提供给您。

导入的模式可以在不同的命名空间中声明事物，如果您希望`XmlSerializer`在不同的命名空间中使用导入的项目生成 XML，您可能需要稍微修改生成的 CodeDOM。

但这是可能的。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T16:36:09.233

[Microsoft：XSDObjectGen - 示例代码生成器 1.4.2.1](http://www.microsoft.com/downloads/details.aspx?familyid=89e6b1e5-f66c-4a4d-933b-46222bb01eb0&displaylang=en)
[Stackoverflow：XSDObjectGen.exe 与 XSD.exe](https://stackoverflow.com/questions/289335/xsdobjectgenexe-vs-xsdexe)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-15T01:21:52.307

它是一种 [昂贵的] 商业产品，我不能以某种方式保证它，但另一种可能性是[http://www.liquid-technologies.com/](http://www.liquid-technologies.com/)。他们的“xsd-gen”工具支持多种语言，例如 Java/C#/Silverlight 甚至 C++！如果您需要一致地支持两种语言，则值得一看。

注意：他们有社区版，但没有代码生成功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-20T05:03:17.653

不久前我有一个项目，涉及将 DTD 文档转换为 XSD 文档，然后转换为 .Net 类。XSD.exe 变成了无用代码，因为有许多 XSD 文档引用了一个通用的基本 XSD。我最终编写了自己的 XSD 到 .Net 生成器，使用反射的组合来操纵 system.xml 的内部，并通过逆向工程 xsd.exe。我花了大约 2 周的时间来破解一个可行的生成器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-19T20:00:17.900

您是否尝试过[LINQ to XSD](http://linqtoxsd.codeplex.com/)？项目名称并没有真正描述它的目标，所以我应该说它是 xsd.exe 的有用替代品。

# java - 寻找可嵌入的 SQL 美化器或重新格式化程序

> ID：312552
> 
> 赞同：30
> 
> 时间：2008-11-23T14:10:59.197
> 
> 标签：java, sql, open-source

我正在寻找用于 SQL 的 Java 开源美化器或重新格式化程序，可用于清理我使用[openArchitectureWare](http://www.openarchitectureware.org)生成的 DDL 语句。

[“在线代码美化器和格式化](https://stackoverflow.com/questions/206441/online-code-beautifier-and-formatter)程序”的答案对我没有用处，我无法让[Simple SQL Formatter](http://www.ohloh.net/projects/simplesqlformatter)为我工作。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-17T23:00:34.877

**更新 2：**

`org.hibernate.jdbc.util.BasicFormatterImpl`在 4.0 版中移动。它现在位于：`org.hibernate.engine.jdbc.internal.BasicFormatterImpl`。

**更新 1：**

技术在前进。正如 Alex 所指出的，**`org.hibernate.pretty.Formatter`从 3.3.2.GA 版本开始不再存在**。替换是`org.hibernate.jdbc.util.BasicFormatterImpl`：

```
String formattedSQL = new BasicFormatterImpl().format(sql); 
```

* * *

**原始答案：**

如果您使用的是 Hibernate，他们有一个内置的：`org.hibernate.pretty.Formatter`

```
String formattedSQL = new Formatter(sql).format(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-02-02T10:44:00.740

在 Hibernate v3.3.2.GA 中，*org.hibernate.pretty.Formatter*不再存在。您可以使用它的替代品：*org.hibernate.jdbc.util.BasicFormatterImpl*

将*org.hibernate.engine.jdbc.internal.BasicFormatterImpl*用于 Hibernate 4.0+。

```
Formatter f = new BasicFormatterImpl();
String formatted_sql_code = f.format(ugly_sql_code); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T10:27:11.373

eclipse[数据工具平台](http://www.eclipse.org/datatools/)的一部分是[SQL 开发工具项目](http://www.eclipse.org/datatools/project_sqldevtools/)。

描述如何使用[SQL 查询解析器](http://www.eclipse.org/datatools/project_sqldevtools/sqltools_doc/SQL%20Query%20Parser%20User%20documentation.htm)的页面有一个非常简短的[SQLQuerySourceFormat](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.datatools.doc.isv/html/reference/api/org/eclipse/datatools/modelbase/sql/query/util/SQLQuerySourceFormat.html)使用，它提供了这些选项：

*   preserveSourceFormat = 生成 SQL 源文本时保留输入源格式的选项
*   statementTerminator = 分隔多个 SQL 语句的字符
*   hostVariablePrefix = 宿主语言变量前面的字符
*   parameterMarker = 标识宿主语言参数的字符
*   delimitedIdentifierQuote* = 包含分隔标识符的字符，其大小写将被保留
*   omitSchema = 当前模式（在 SQL 源代码中省略，对不合格的表引用隐含）
*   qualifyIdentifiers = 描述 SQL 源中的标识符如何被限定的标志
*   preserveComments = 在解析的 SQL 源或/和生成的 SQL 源中保留注释的选项
*   generateCommentsForStatementOnly = 仅在完整语句的上下文中为 SQL 源生成注释的选项，或者如果设置为 false，也为语句上下文之外的单个 SQL 查询对象生成注释

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T17:07:12.723

你有没有考虑过：

[http://www.sqlinform.com](http://www.sqlinform.com)

它们提供 API 版本和命令行版本（以及在线版本）。

虽然不知道成本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T05:46:08.180

也许[jsqlparser](http://jsqlparser.sourceforge.net/)会为你工作。

并不像您想象的那么容易找到，因为那里有相当多的已失效项目。事实上，我没能找到它，所以最终做了我自己的事情（基于 h2 解析器 - 如果一切都失败了，你可以联系我）。因此，我不知道它是否有美化器，但在上面写一个应该足够直截了当。

它基于语法和 JavaCC，因此无论如何可能比用 antlr 重新发明这个轮子更好。您可能会发现，如果您需要在复杂语句中支持各种 sql 方言，那么任何基于语法的方法都会让您失败。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T17:32:52.053

这行得通吗 - [SQL 格式化程序。](http://www.wangz.net/cgi-bin/pp/gsqlparser/sqlpp/sqlformat.tpl)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T00:01:03.590

您可以只使用[SQL 语法并使用](http://antlr.org/grammar/list)[antlr](http://antlr.org)构建 AST 。然后您可以以您喜欢的任何格式输出树。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-12-27T14:47:08.997

所以这绝对是您正在寻找的：支持 Oracle、SQL Server、DB2、MySQL、Teradata 和 PostgreSQL[的 SQL 格式化程序库。](http://www.sqlparser.com/features/sql-formatter.php)

# .net - 在 MS Access 中使用 .Net 的方法

> ID：312558
> 
> 赞同：4
> 
> 时间：2008-11-23T14:15:35.427
> 
> 标签：.net, ms-access, interop

我想在 MS Access 中包含自定义 .Net 控件和 .Net 表单。这是可能的，但我想知道是否有关于该主题的任何新的好文章。
随着时间的推移，我发现了一些与该主题相关的内容，但总是觉得这个过程有点麻烦（参见下面的参考资料）。

问题之一是部署：
我的用户的机器有普通的用户帐户，我想知道我是否可以将 dll 部署在与应用程序相同的文件夹中（在用户的`Application Data`文件夹中）并从代码中引用它们而无需在下面注册它们该计算机上的管理员帐户。
目前，当网络上有新版本可用时，Access 应用程序会自动部署。

**参考**

*   [使用 InteropForms 2.0 工具包部署应用程序](http://blogs.msdn.com/vbteam/archive/2007/06/04/deploying-applications-with-the-interopforms-2-0-toolkit.aspx)
*   [使用互操作表单工具包的提示和技巧](http://channel9.msdn.com/posts/funkyonex/Tips-and-Tricks-with-the-Interop-Forms-Toolkit/)
*   [在 MS Access 中使用 InteropUserControl/InteropForm](http://social.msdn.microsoft.com/forums/en-US/vbinterop/thread/3b104a18-7db5-4418-a239-4ff9cede1c89/)
*   [使用 Interop Forms Toolkit 2.0 构建混合应用程序](http://channel9.msdn.com/posts/funkyonex/Building-Hybrid-Applications-with-the-Interop-Forms-Toolkit-20/Default.aspx?wa=wsignin1.0)
*   [关于 Interop Forms Toolkit 2.0 教程的代码项目文章](http://www.codeproject.com/KB/vb-interop/VB6InteropToolkit2.aspx)

**编辑 09DEC2008**：
我不敢相信我是唯一对此感兴趣的人？是否有人尝试在 Access 中使用 .Net，作为改进 UI 或缓慢迁移到完整 /Net 应用程序的一种方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T15:01:49.873

只是一个警告-我曾经在一个基于访问的系统上工作，该系统的发展已经超出了访问的设计目的，这是一件真正的苦差事。

我对您的项目一无所知，但考虑转向更灵活/可扩展的系统以避免出现问题可能是一个想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T18:52:55.597

您没有看到很多人这样做（在 Access 中使用 .Net 表单）的原因有两个。

1.  MS Access 不是 .Net 应用程序，因此您必须编组 COM-Interop 和 .Net 框架之间的调用，这对性能很重要且容易出现问题。
2.  MS Access 不是持久数据的好解决方案。它更适合用作原型制作工具。您最好使用内置的 ADO.Net Dataset 类，如果需要，该类可以持久化为 XML。它绝对是一个更好的性能选择，也是一个使用托管内存、多线程等的 .Net 解决方案。

    在 Access 中可以做的任何事情都可以在使用 ADO.Net 的 .Net 应用程序中做得更好。

# sql - MySQL - 与 GROUP_CONCAT 一起在哪里

> ID：312561
> 
> 赞同：4
> 
> 时间：2008-11-23T14:23:36.113
> 
> 标签：sql, mysql

IN() 中使用的查询返回： `1, 2`。然而，整个查询返回 0 行，这是不可能的，因为它们存在。我在这里做错了什么？

```
SELECT DISTINCT 
  li.auto_id
FROM 
  links AS li
  JOIN group_data AS gi ON 
    li.auto_id = gi.autoid AND li.user_id = gi.userid
WHERE 
  gi.groupid IN 
  (
    SELECT 
      CAST( GROUP_CONCAT( gf.groupid ) AS CHAR )
    FROM 
      group_followers AS gf
    WHERE 
      gf.userid_ext = '1'
    GROUP BY 
      gf.userid_ext
  )
  AND li.keyword LIKE '%shiba%' 
```

太感谢了，

冰

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-23T14:31:41.307

从[文档](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat)：

> GROUP_CONCAT(expr)：
> 此函数返回一个字符串结果，其中包含来自组的串联非 NULL 值。

你得到一个*包含*. `'1,2'`这不是您可以提供给 IN 子句的任何内容，因为它是一个*值*，而不是两个值。

只需在没有 的情况下执行此操作即可`GROUP_CONCAT`：

```
gi.groupid IN 
(
  SELECT 
    gf.groupid
  FROM 
    ...
) 
```

# c# - 类分桶。.

> ID：312565
> 
> 赞同：1
> 
> 时间：2008-11-23T14:28:05.700
> 
> 标签：c#, projects-and-solutions, directory-structure

好的，所以我一直在尝试将每个人的课程之一放在某个根文件夹中，或者：

UI
BusinessLogic
DataAccess
BusinessObjects
接口

我还有一些我似乎不太好斗的地方，所以我正在寻找建议

1.  一个 Cache 类，它维护一个私有字典并允许基于某些特定键对对象进行不同的访问

2.  事件 Arg 类？

此外，在一个项目下，我现在开始拥有拥有全部 3 个（数据访问、业务对象、业务逻辑）的子系统。我应该如何分解文件夹结构？

一种。

ProjectX
--Subsystem1
----BusinessObjects
----DataAccess
----BusinessObjects
--Subsystem2
----BusinessObjects
----DataAccess
----BusinessObjects

或者

ProjectX
--BusienssLogic
----Subsystem1BL
----Subsystem2BL
--DataAccess
----Subsystem1DA
---- Subsystem2DA
--BusinessObjects ----
Subsystem1BO
----Subsystem2BO

或者

ProjectX
--BusinessLogic
--DataAccess --BusinessObjects
（
每个功能子系统没有子目录）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T18:07:00.610

我尝试将我的程序集名称与其命名空间对齐，并使用 .NET Framework 本身作为指导。我坚信使用驱动文件夹结构的命名空间结构可以使代码库更易于维护。

例如，我有一个缓存提供程序，它是我们使用的全局开发人员框架的一部分。它位于类似于以下内容的名称空间中：

[公司].Core.Data.Caching

我还有其他与数据相关的功能，这些功能在逻辑上也属于数据功能，因此缓存具有适配器、转换器和生成器等兄弟。所以，假设我们有以下命名空间：

[公司].Core.Data.Adapters
[公司].Core.Data.Converters
[公司].Core.Data.Caching
[公司].Core.Data.Generators

这些相关的命名空间存在于一个名为 [Company].Core.Data 的程序集中，这也是项目名称。遵循这种结构，在解决方案中查找内容变得非常简单。说到结构，现在我们回到它们在磁盘上的存储方式。

项目名称是根文件夹名称。这假设我的源代码管理文件夹，即本地计算机上的“C:\Source Control”：

C:\Source Control\Core[Company].Core.Data\
C:\Source Control\Core[Company].Core.Data\Adapters
C:\Source Control\Core[Company].Core.Data\Caching
C:\ Source Control\Core[Company].Core.Data\Converters
C:\Source Control\Core[Company].Core.Data\Generators

所以，作为一个层次结构，它看起来像：

[解决方案]
--[Company].Core.Data
----[Adapters]
------(Adapters files)
----[Caching]
------(Caching files)
---- [转换器]
------（转换器文件）

我将所有项目放在同一级别，并使用文件夹改变子命名空间。这样命名空间和物理结构很容易协调。困难的部分是找到平衡。您不希望拥有大量较小的程序集，因此我通常会将它们分组在更高的级别，并最终在它趋于变得太大或子命名空间比其他部分更频繁地更改时对其进行重构.

我已经这样做了很多年了，它不仅对我自己，而且对我的开发人员来说都非常舒适。

至于您的 EventArgs 问题，我同意我通常每个文件做一个类的共识，但如果是单一使用，将例外将 EventArgs 类与另一个类一起放置。对于多用途，我将它们放在程序集中的最高逻辑点，允许命名空间结构绑定我的范围。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T14:41:05.627

我通常喜欢坚持 1 个类，1 个文件的规则，但是对于 EventArgs，我实际上喜欢在定义委托或事件的同一个文件中声明它们。除非，args 被多个类层次结构使用，这在我身上并不经常发生。

至于缓存，我会放在它支持的类的文件夹中。

尽管我喜欢良好的组织，但它可能会变得过于肛门。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T14:42:04.797

没有一种正确的方法可以做到这一点。

下载一些使用与您的项目类似的技术的开源项目，并从中汲取您的想法。

抱歉，我错过了 C# 标签。优秀的 .NET 项目示例已在[此处](https://stackoverflow.com/questions/155217/good-c-code-samples)和[此处](https://stackoverflow.com/questions/164809/what-are-the-most-relevant-oss-projects-for-net)之前介绍过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T14:53:01.407

这主要是个人口味。

我同意 Brian Genisio关于在哪里放置 EventArg 类等[所说](https://stackoverflow.com/questions/312565/class-bucketing#312579)的话：如果你只使用它们一次，请将它们放在你使用它们的同一个文件中。对于通用类/文件，我总是有一个“通用”文件夹（多么方便！;-)）

关于文件夹结构：我会选择第二个，那个是 3 层，并保持子系统分开。双赢！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T14:53:55.537

我只想添加对名称的评论。我觉得商业这个词会导致误用。我们这样做了，现在我们不知道它是关于什么的：域逻辑或服务层。我建议使用域名之类的名称。Domain.Impl（将接口与 Impl 分开）然后是服务……如果您使用 ORM，可能还有持久性……如果您使用不同的方法可能会有所不同，但老实说，我对名称 BusinessLogic、DataAccess 感到困惑和业务对象。我不明白什么是什么。BusinessObjects 应该包含业务逻辑，逻辑？还是他们只是 DTO？那为什么他们在与 DataAccess 不同的项目中呢？

# windows - 如何在 Windows 中组合 GUI 应用程序

> ID：312569
> 
> 赞同：2
> 
> 时间：2008-11-23T14:32:40.947
> 
> 标签：windows, qt, winapi, user-interface, ipc

我有一个使用 Qt 框架的 Windows GUI 应用程序（当前版本为 3.3.5，可能会更改为 Qt4）。

我想在主应用程序中组合其他 Windows GUI 应用程序。由于一些我无法控制的约束，我无法直接在主应用程序中使用这些小部件。最终布局应如下所示：

![http://i.stack.imgur.com/RlK7T.png](https://i.stack.imgur.com/RlK7T.png "应用布局")

目前我正在使用[Hosting .exe applications into a dialog](http://www.codeproject.com/KB/dialog/exeHosting.aspx)中概述的方法。为了传递`HWND`子应用程序，我在进程之间使用我自己的 IPC。然后，我需要使用`resizeEvent`调用`::MoveWindow`子窗口的 Qt 转发调整大小事件。

是否有更好或更通用的机制来执行此操作？有人建议我使用 ActiveX，但我对这项技术还不够熟悉。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-24T16:47:01.520

以下是一些 Windows 应用程序如何处理此问题：

如果小部件应用程序*必须*在它自己的 EXE 中，那么您可以使用 OLE 文档对象嵌入（我认为这是正确的术语）。这与用于将实时 Excel 文档嵌入 Word 文档的技术相同。基本上，类似 WMF 的数据用于跨进程呈现 UI。这需要在主机程序和小部件程序中进行大量工作，***除非***您在此基础上构建的框架自动支持这一点。MFC 在这方面做得很好......（伙计，我只是在赞美 MFC 吗？？）

更好的解决方案是使用某种类型的进程内解决方案。让所有小部件都是 DLL。这就是 ActiveX 的工作原理。如果小部件需要耗尽进程，请将渲染和进程外的东西分成两部分。一个执行进程外工作并在托管进程中本地执行渲染的 EXE。使用某种类型的 IPC 将它们粘合在一起。

我怀疑“你无法控制的限制”将使几乎任何“理智”的实施都变得不可能......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T19:02:43.743

HWND 是 Win32 GUI 最基本的构建块。除此之外的任何事情都需要托管应用程序的合作。例如，通过将父 HWND 发送到托管应用程序。

# c++ - 使用 C 风格的字符串有哪些缺点？

> ID：312570
> 
> 赞同：8
> 
> 时间：2008-11-23T14:33:52.583
> 
> 标签：c++, c, string

我知道[缓冲区溢出](http://en.wikipedia.org/wiki/Buffer_overflow)是使用 C 风格字符串（char 数组）的一种潜在危险。如果我知道我的数据将适合我的缓冲区，那么仍然可以使用它们吗？我需要注意 C 样式字符串的其他固有缺点吗？

**编辑：**这是一个接近我正在研究的例子：

```
char buffer[1024];
char * line = NULL;
while ((line = fgets(fp)) != NULL) { // this won't compile, but that's not the issue
    // parse one line of command output here.
} 
```

此代码从使用`popen("df")`命令创建的 FILE 指针中获取数据。我正在尝试运行 Linux 命令并解析它们的输出以获取有关操作系统的信息。以这种方式将缓冲区设置为任意大小有什么问题（或危险）吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-24T04:59:46.393

There are a few disadvantages to C strings:

1.  Getting the length is a relatively expensive operation.
2.  No embedded nul characters are allowed.
3.  The signed-ness of chars is implementation defined.
4.  The character set is implementation defined.
5.  The size of the char type is implementation defined.
6.  Have to keep track separately of how each string is allocated and so how it must be free'd, or even if it needs to be free'd at all.
7.  No way to refer to a slice of the string as another string.
8.  字符串不是不可变的，这意味着它们必须单独同步。
9.  不能在编译时操作字符串。
10.  Switch case 不能是字符串。
11.  C 预处理器无法识别表达式中的字符串。
12.  无法将字符串作为模板参数 (C++) 传递。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-23T15:24:04.010

C 字符串缺少 C++ 对应字符串的以下方面：

*   自动内存管理：您必须手动分配和释放它们的内存。
*   连接效率的额外容量：C++ 字符串的容量通常大于它们的大小。这允许在不进行多次重新分配的情况下增加大小。
*   没有嵌入的 NUL：根据定义，一个 NUL 字符结束一个 C 字符串；C++ 字符串保留一个内部大小计数器，因此它们不需要特殊值来标记它们的结束。
*   明智的比较和赋值运算符：即使允许比较 C 字符串指针，它几乎总是*不是*预期的。类似地，分配 C 字符串指针（或将它们传递给函数）会产生所有权模糊。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-23T14:46:22.497

在许多应用程序中，无法在恒定时间内访问长度是一个严重的开销。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-23T21:10:02.253

您可能知道今天 1024 字节足以容纳任何输入，但您不知道明天或明年会发生怎样的变化。

如果过早的优化是万恶之源，那么神奇的数字就是根。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-23T14:38:20.780

如有必要，增长字符串（字符数组）所需的内存管理等有点无聊。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-23T14:41:25.080

没有办法将 NUL 字符（如果您需要它们）嵌入到 C 风格的字符串中。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-23T17:21:13.573

好吧，要评论您的具体示例，您不知道调用 df 返回的数据将适合您的缓冲区。永远不要相信未经处理的输入到您的应用程序中，即使它应该来自像 df 这样的已知来源。

例如，如果一个名为“df”的程序被放置在您的搜索路径中的某个位置，以便它被执行而不是系统 df，它可能被用来利用您的缓冲区限制。或者如果 df 被恶意程序替换。

从文件读取输入时，请使用一个函数，该函数可让您指定要读取的最大字节数。在 OSX 和 Linux 下， fgets() 实际上被定义为 `char *fgets(char *s, int size, FILE *stream);`在这些系统上使用是安全的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-23T14:36:53.357

当您有一个字节数组而不是字符串时，字符编码问题往往会浮出水面。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-23T19:23:56.710

在您的特定情况下，危险的不是 c 字符串，而是将不确定数量的数据读入固定大小的缓冲区。例如，永远不要使用 gets(char*)。

不过，看看你的例子，它似乎根本不正确 - 试试这个：

```
char buffer[1024];
char * line = NULL;
while ((line = fgets(buffer, sizeof(buffer), fp)) != NULL) {
    // parse one line of command output here.
} 
```

这是对 c 字符串的完全安全使用，尽管您必须处理`line`不包含整行但被截断为 1023 个字符（加上空终止符）的可能性。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-23T14:45:27.800

我认为使用它们是可以的，人们已经使用它们多年了。但如果可能的话，我宁愿使用 std::string ，因为 1）你不必每次都那么谨慎，可以考虑你的域的问题，而不是认为你每次都需要添加另一个参数......内存管理和那种东西......在更高级别上编码更安全...... 2）可能还有一些其他小问题，这些问题并不大，但仍然......就像人们已经提到的......编码，unicode ...创建 std::string 的所有那些“相关”的东西都想到了...:)

**更新**

我在一个项目上工作了半年。不知何故，我愚蠢到在交付前从未在发布模式下编译...... :) 好吧......幸运的是，我在 3 小时后发现了一个错误。这是一个非常简单的字符串缓冲区溢出。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-24T00:05:03.913

No Unicode support is reason enough these days...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-23T14:44:31.173

c 字符串有可能被滥用，因为必须扫描字符串以确定它的结束位置。

**strlen** - 查找长度，扫描字符串，直到你命中 NUL，或者访问受保护的内存

**strcat** - 必须扫描以找到 NUL，以确定从哪里开始连接。ac 字符串中不知道是否会出现缓冲区溢出。

c 字符串是有风险的，但通常比字符串对象快。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-23T15:28:27.887

恕我直言，cstrings 最难的一点是内存管理，因为如果您需要传递 cstring 的副本或者是否可以将文字传递给函数，即，您需要小心。该函数将释放传递的字符串还是将引用保留更长的时间然后用于函数调用。这同样适用于 cstring 返回值。

因此，如果不付出很大的努力，就不可能共享 cstring 副本。这在许多情况下以内存中相同 cstring 的不必要副本结束。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-23T15:31:16.307

这个问题真的没有答案。
如果您用 C 语言编写，您有什么选择？
如果你用 C++ 编写，你为什么要问？不使用 C++ 原语的原因是什么？
我能想到的唯一原因是：链接 C 和 C++ 代码并在接口中的某处有 char *。有时很容易使用 char * 而不是一直进行来回转换（特别是如果它真的是具有 3 种不同 C++ 字符串对象类型的“好”C++ 代码）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-23T17:21:38.517

C 弦，就像 C 的许多其他方面一样，给你足够的空间让自己上吊。它们简单快速，但在可能违反空终止符等假设或输入可能超出缓冲区的情况下是不安全的。要可靠地执行它们，您必须遵守相当卫生的编码实践。

曾经有一种说法，高级语言的规范定义是“任何比 C 具有更好的字符串处理能力的语言”。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-24T00:36:51.383

Another consideration is who will be maintaining your code? What about in two years? Will that person be as comfortable with C-stlye strings as you are? As the STL gets more mature, it seems like people will be increasingly more comfortable with with STL strings than with C-style strings.

# java - 我怎么能在 JList 中只允许唯一的字符串？

> ID：312573
> 
> 赞同：3
> 
> 时间：2008-11-23T14:37:50.407
> 
> 标签：java, swing, jlist, jcomponent

我有一个包含一堆字符串的 JList。我希望它表现得像一个 Set，这样它就只会拥有唯一的值。有没有办法在不检查那里不存在新字符串的情况下实现这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T15:05:26.607

看看文档：[1.4.2](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/JList.html) | [爪哇 6](http://java.sun.com/javase/6/docs/api/javax/swing/JList.html)

您可以通过 JList#setModel(ListModel) 设置您自己的 ListModel，它可能由例如 HashSet 而不是默认使用的 Vector 支持。

另请参阅[ListModel](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/ListModel.html)和[AbstractListModel](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/AbstractListModel.html)

# sql-server - 如何简单地为表和数据生成 CREATE SQL 脚本？

> ID：312576
> 
> 赞同：30
> 
> 时间：2008-11-23T14:39:21.637
> 
> 标签：sql-server

所以我习惯了 PHPMySQL，如果我想将一个表从一个数据库传输到另一个数据库，我：

*   上桌
*   点击“导出”
*   CTRL-C
*   转到另一个数据库，插入 SQL，CTRL-V

在 MS SQL Server 2008 Express 中，我尝试：

*   右键单击，脚本表为，CREATE TO
    *   但这只会给我 CREATE TABLE sql，而不是 INSERT INTO sql
*   右键单击，脚本表为，插入到
    *   这给了我 INSERT TO sql 但假设我要填写数据（！）
*   所以我启动了 SQL Server 2008 Express 导入/导出数据向导，但它似乎也没有给我想要的简单 CREATE/INSERT INTO 脚本。:-(

那么如何在 MS SQL Server 2008 Express 中获得一个简单的 SQL 转储表，PHPMySQL 给我的那种：

```
-- phpMyAdmin SQL Dump
-- version 2.11.9.2
-- http://www.phpmyadmin.net
--
-- Host: localhost
-- Generation Time: Nov 23, 2008 at 03:34 PM
-- Server version: 5.0.67
-- PHP Version: 5.2.6

SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";

--
-- Database: `test`
--

-- --------------------------------------------------------

--
-- Table structure for table `members`
--

CREATE TABLE IF NOT EXISTS `members` (
  `id` int(11) NOT NULL auto_increment,
  `firstName` varchar(50) collate latin1_general_ci NOT NULL,
  `lastName` varchar(50) collate latin1_general_ci NOT NULL,
  `age` int(11) NOT NULL,
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci AUTO_INCREMENT=4 ;

--
-- Dumping data for table `members`
--

INSERT INTO `members` (`id`, `firstName`, `lastName`, `age`) VALUES
(1, 'Jim', 'Taylor', 34),
(2, 'John', 'McGregor', 23),
(3, 'Alice', 'Anderson', 33); 
```

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2012-12-12T11:44:52.890

在 SQL Server Management Studio 中，您可以右键单击数据库并选择：

任务 -> 生成脚本 - 下一步 -> 从列表中选择您需要的对象 -> 单击高级 然后简单地继续完成向导。确保在提示选择脚本选项时将“脚本数据”设置为 TRUE。

SQL Server 2008

![在此处输入图像描述](https://i.stack.imgur.com/pWNr4.png)

SQL Server 2008 R2

![在此处输入图像描述](https://i.stack.imgur.com/O86uq.png)

进一步阅读：

Robert Burke：SQL Server 2005 - 编写数据库脚本

取自堆栈溢出： [如何获取 SQL Server 数据的脚本？](https://stackoverflow.com/questions/2321052/get-script-of-sql-server-data)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T15:01:42.120

看这里：[Simon Holywell：SQL Server 2005 转储到 SQL 语句](http://www.simonholywell.com/article/sql-server-2005-dump-to-sql-statements.html)。

西蒙所说的（不是双关语）是这样的：没有内置的东西，但是有一种“脚本方式”可以做到这一点。他制作了一个可以使用的 PHP 脚本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T13:35:35.847

您应该使用数据库发布向导来执行此操作

[http://www.codeplex.com/sqlhost/Wiki/View.aspx?title=Database%20Publishing%20Wizard](http://www.codeplex.com/sqlhost/Wiki/View.aspx?title=Database%20Publishing%20Wizard)

# python - 在 Ubuntu 下的 Eclipse 中调试 pylons

> ID：312599
> 
> 赞同：1
> 
> 时间：2008-11-23T15:05:37.543
> 
> 标签：python, eclipse, debugging, ubuntu, pylons

我正在尝试让 pylons 在 Ubuntu 下的 Eclipse 中进行调试。具体来说。我不确定“运行配置”对话框中的“主模块”使用什么。

（[这](https://stackoverflow.com/questions/147650/debug-pylons-application-through-eclipse)是关于stackoverflow的类似问题，但我认为它适用于Windows，因为我在我的系统上找不到paster-script.py）

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-24T17:59:18.940

我现在设法解决了这个问题。

在安装 pylons 后`Window>Preferences>Pydev>Interpreter-Python`删除 python 解释器并重新加载它（选择）。`New`

在终端 cd 进入项目目录。然后输入`sudo python setup.py develop` Not sure what this does, but it does the trick（如果有人想填写，请填写）

在 中`Run>Open Debug Dialog`输入粘贴的位置`Main Module`。对我来说这是`/usr/bin/paster`. 然后在`Arguments`选项卡中`Program arguments`输入`serve /locationOfYourProject/development.ini`

一切准备就绪。我花了很多时间才发现如果参数包括它不起作用`--reload`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T11:09:15.203

我让它以几乎相同的方式运行 - 尽管您不必执行 setup.py 开发步骤 - 没有它它可以正常工作。

它的作用是为以项目名称命名的 python 包设置到项目目录的全局链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-12T11:48:15.960

我确实需要这一步“sudo python setup.py develop”来让它运行..否则它会抛出一些异常。

顺便说一句， setup.py 是您创建的项目中的一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T15:39:03.653

没有在 Eclipse 上尝试过，但我敢打赌，我一直用来在 WingIDE 中调试 Pylons 应用程序的解决方案也可以在这里工作。

1.  编写以下两行代码（将其命名为 run_me.py 或类似名称）并将其保存在您的项目目录中：

    从 paste.script.serve 导入 ServeCommand

    ServeCommand("serve").run(["development.ini"])

2.  将此文件设置为主调试目标（又名主模块）

3.  享受。

# wcf - 从自定义源（非标准 XML）加载 WCF 配置（用于服务器 + 客户端）

> ID：312604
> 
> 赞同：5
> 
> 时间：2008-11-23T15:11:13.273
> 
> 标签：wcf, configuration

我一直在尝试找到一种方法来从备用源加载我的 WCF 服务配置（XML 配置数据的巨大 BLOB）——而不是标准的 web.config / app.config。

我们在一个受限的环境中运行，我们无法访问服务器的文件系统，因此我们无法自己对 WCF 配置进行调整和更改——我们总是必须找到 IT 经理来处理这个问题。我们已将整个配置放入 SQL Server 数据库，并将 web.config 基本上缩减为一个部分 - 就是这样。

现在，我们想知道是否有一个很好的、记录在案的方法来为 WCF 做同样的事情——是否有一种机制可以插入某种“配置提供程序”？我们能否以某种方式将配置条目存储在数据库表中，并在服务启动时将它们提供给服务？

我还没有找到任何真正有用且易于理解的文档和示例......这里有任何接受者吗？！？！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T06:33:56.937

你可以做到这一点，虽然它有点工作。

在服务方面，您必须创建自己的自定义[`ServiceHost`](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehost.aspx)并覆盖该[`ApplyConfiguration`](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehost.applyconfiguration.aspx)方法。

看看[这篇博文](http://blogs.msdn.com/dotnetinterop/archive/2008/09/22/custom-service-config-file-for-a-wcf-service-hosted-in-iis.aspx)

在客户端，您执行类似的操作，但提供自定义[`ChannelFactory`](http://msdn.microsoft.com/en-us/library/system.servicemodel.channelfactory.aspx)并覆盖[`ApplyConfiguration`](http://msdn.microsoft.com/en-us/library/system.servicemodel.channelfactory.applyconfiguration.aspx)那里的方法。

# javascript - 提交使用 javascript 添加的表单输入字段

> ID：312605
> 
> 赞同：11
> 
> 时间：2008-11-23T15:12:47.293
> 
> 标签：javascript, form-submit

我正在制作一个简单的表单来创建民意调查，因此我希望可以添加额外的输入字段，以防用户想要在民意调查中获得更多选项。

我制作了向表单添加新输入字段的 Javascript 代码，但是在提交表单时不会发布动态添加的输入字段（我使用标准提交按钮）。

**有没有办法让动态添加的字段作为表单的一部分发布/识别？**

```
<form id="myForm" method="post">  
  <input type="submit">
  <input type="text" name="poll[question]">  
  <input type="text" name="poll[option1]">  
  <input type="text" name="poll[option2]">  
</form>  
<a href="javascript:addOption();">Add option</a>  

<script>  
  var optionNumber = 3; //The first option to be added is number 3  
  function addOption() {  
    var theForm = document.getElementById("myForm");  
    var newOption = document.createElement("input");  
    newOption.name = "poll[option"+optionNumber+"]";  // poll[optionX]
    newOption.type = "text";
    theForm.appendChild(newOption);  
    optionNumber++;
  }  
</script> 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-10T04:45:20.277

我刚刚调试了我遇到类似问题的网站。对我来说，结果是我的表格和表单标签以“错误”的顺序导致了这个问题。

破碎的：

```
桌子
  形式

```

在职的：

```
形式
  桌子

```

这指出了一些非常重要的事情。浏览器可能会很好地呈现，并且表单可能会正常工作，使用格式错误的 html，但是您仍然可以通过没有正确格式化的 html 来破坏事情，像这样。也许我应该开始使用 mod_tidy！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T15:54:16.603

您的代码可以正常工作：

```
<?php
    print_r($_REQUEST)
?>
<html>
<body>

<form id="myForm" method="post"> 
    <input type="submit">
    <input type="text" name="poll[question]"> 
    <input type="text" name="poll[option1]"> 
    <input type="text" name="poll[option2]"> 
</form> 
<a href="javascript:addOption();">Add option</a> 

<script> 
    var optionNumber = 3; //The first option to be added is number 3 
    function addOption() { 
        var theForm = document.getElementById("myForm"); 
        var newOption = document.createElement("input"); 
        newOption.name = "poll[option"+optionNumber+"]"; // poll[optionX]
        newOption.type = "text";
        theForm.appendChild(newOption); 
        optionNumber++;
    } 
</script>
</body>
</html> 
```

单击两次添加选项，您将获得

数组 ( [poll] => 数组 ( [question] => [option1] => [option2] => [option3] => [option4] => ) )

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T15:31:33.543

你确定你在这里没有犯任何错误吗？

我将您的代码复制到一个新页面中，并将以下代码添加到 ASP.NET 页面后面的代码中（它应该适用于任何框架）：

```
protected void Page_Load(object sender, EventArgs e)
{
    foreach (string p in this.Request.Params.Keys) {
        if (p.StartsWith("poll")) {
            Response.Write(p + "&nbsp;&nbsp;" + this.Request.Params[p] + "<br />");
        }
    }
} 
```

我添加了额外的字段并输入了测试值，输出清楚地显示了所有动态输入字段发回服务器。

这是输出：

```
poll[question]  test1
poll[option1]  test2
poll[option2]  test3
poll[option3]  test4
poll[option4]  test5
poll[option5]  test6
poll[option6]  test7 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T15:28:50.007

您始终可以使用 javascript 函数自己序列化表单，然后提交（使用 AJAX 或 get 请求或其他东西）。
[http://malsup.com/jquery/form/comp/](http://malsup.com/jquery/form/comp/)

# objective-c - 为什么我需要将 self 转换为 id？

> ID：312608
> 
> 赞同：5
> 
> 时间：2008-11-23T15:17:39.953
> 
> 标签：objective-c, casting, initialization

我有一个带有 (id) 参数的 init 方法：

```
 -(id) initWithObject:(id) obj; 
```

我试图这样称呼它：

```
 [[MyClass alloc] initWithObject:self]; 
```

但是 XCode 抱怨该参数是“不同的 Objective-C 类型”（这通常表示类型不匹配或间接错误级别）。

如果我明确地将 self 转换为 (id)，警告就会消失。在任何一种情况下，代码都会按预期运行。有趣的是，在下一行中，我将 self 传递给另一个也采用 id 的方法，并且效果很好。

我想知道我是否遗漏了一些微妙的东西——或者它是编译器的一个特性？

在我确定它是必要的原因之前，我并不完全舒服地施放它。

[编辑]

我被要求提供更多代码。不确定还有很多其他相关的。这是我进行调用的实际代码。请注意，它本身位于 init 方法中。这是`initWithSource`发出警告的电话：

```
 -(id) initWithFrame:(CGRect) frame
{
    self = [super initWithFrame: frame];
    if( self )
    {
        delegate = nil;
        touchDelegate = [[TBCTouchDelegate alloc] initWithSource:self];
        [touchDelegate.viewWasTappedEvent addTarget: self action:@selector(viewWasTapped:)];
    }
    return self;
} 
```

这是被调用的 init 方法：

```
 -(id) initWithSource:(id) sourceObject
{
    self = [super init];
    if (self != nil) 
    {
        // Uninteresting initialisation snipped
    }
    return self;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-23T19:51:26.593

通常这意味着`initWithSource:`在不同的类上有多个方法名称，它们的参数类型相互冲突。请记住，如果一个变量被键入，因为`id`编译器不知道它是什么类。因此，如果您调用`initWithSource:`一个`id`-typed 对象并且多个类都有一个`initWithSource:`方法，那么编译器基本上只会选择两者之一。如果它选择了“错误的”，那么你会得到一个“distinct Objective-C type”错误。

那么为什么这会发生在你身上呢？我不是 100% 确定，但请记住`+[TBCTouchDelegate alloc]`返回一个`id`. 因此链接 alloc/init 调用等价于：

```
id o = [TBCTouchDelegate alloc];
touchDelegate = [o initWithSource:self]; 
```

因此，您正在调用`initWithSource:`一个`id`-typed 变量。如果存在冲突的`initWithSource:`方法，您可能会收到此编译器错误。

有冲突的方法吗？我检查了系统，唯一有冲突的是`NSAppleScript`：

```
- (id)initWithSource:(NSString *)source; 
```

现在`NSAppleScript` *是*Foundation 的一部分，但我注意到这是 iPhone 代码。所以也许你只在为模拟器而不是设备编译时得到这个错误？

无论如何，如果这是您的问题，您可以通过将 alloc/init 拆分为两条不同的行来解决它：

```
touchDelegate = [TBCTouchDelegate alloc];
touchDelegate = [touchDelegate initWithSource:self]; 
```

现在，您调用`initWithSource:`的是全类型变量（而不是`id`-typed），因此编译器不再需要猜测要选择哪个变量。或者您可以从以下位置投射回报`+alloc`：

```
touchDelegate = [(TBCTouchDelegate *)[TBCTouchDelegate alloc] initWithSource:self]; 
```

另一种解决方案是重命名`initWithSource:`以避免冲突，并可能使其更具描述性。你没有说这个类当前的名字是什么，也没有说“源”是什么，所以我不能排除任何可能性。

# .net - TIBCO.EMS .NET 客户端/WCF 通道

> ID：312612
> 
> 赞同：10
> 
> 时间：2008-11-23T15:22:47.197
> 
> 标签：.net, wcf, client, tibco-ems

伙计们，

TIBCO 早在 4 月就宣布支持 WCF 频道 - 现在有什么实现了吗？

我可以在哪里以及如何下载这些新的 WCF 通道位，或者我可以在哪里获得当前 .NET 2.0/3.5 版本的“TIBCO.EMS .NET 客户端库”？

到目前为止，我们是一家小型 ISV，与 TIBCO 没有任何联系，但我们的一个大客户要求我们与他的 TIBCO EMS 系统进行互操作，但无法提供我们需要的技术背景信息 :-(

感谢您的任何提示和指示！马克

后续行动 - 2009 年 1 月 14 日：这里没有太多回应......你们这些使用 TIBCO EMS 的人 - 你如何与之交互，例如来回通信和发送数据？

**更新**（2010 年 4 月）
我有机会检查了 .NET 中的“本机”TIBCO.EMS.dll 以及他们的 WCF 实现，我的结论是：使用本机 API。这很容易，很简单，很有效。

WCF 部分是可怕的。他们是不完整的，非常非传统的，他们不觉得自己是一个好的 WCF 公民。TIBCO 只提供一个传输元素——你不能只使用现成的 emsBinding 或其他东西——你必须自己定义。我非常失望 - 我对 TIBCO 这样规模和声誉的公司抱有更多期望......

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-29T01:11:13.767

如果您直接使用 Tibco EMS .NET 客户端，您的通信堆栈将会简单得多。它是根据 JMS 设计的，JMS 广泛用于企业软件开发。因此，有很多关于如何进行 JMS 编程的技术书籍。Java 和 C# 非常相似，因此很容易进行心理转换以将其应用于 Tibco EMS .NET 客户端编程。

在为分布式应用程序设计和实现了许多通信通道之后，我的经验是堆栈越简单，操作就越可靠和无故障。

WCF 之类的抽象层的问题在于，几乎总是存在潜伏在某处的泄漏抽象问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T01:02:21.850

对于 tibco 和 wcf，您需要至少运行 4.4.3 版本作为 tibco 支持的最低版本。否则你将不得不使用标准协议。他们确实有 .net，因此您不必进行互操作。到目前为止，我还没有使用 WCF 组件，因为我工作的地方仍在 4.3.0 上，虽然他们说它应该可以工作，但它不受支持。我们刚刚得到了我们应该很快更新到 5 的位。

如果他们想让你使用它，你必须从你的客户那里得到这些东西。这将是我的意见，除了你最好的选择是联系 Tibco 看看你是否能解决问题。

不过，最大的问题是您的客户使用的是什么版本的 Tibco EMS。

# c# - 从客户端应用程序发送电子邮件而不存储密码

> ID：312621
> 
> 赞同：1
> 
> 时间：2008-11-23T15:31:47.083
> 
> 标签：c#, security, email

我的目标：从 C# Windows 窗体应用程序中发送电子邮件（例如支持请求、错误报告）。我知道如何在技术上做到这一点，但这里有一个问题：

为了在邮件服务器（例如 gmx、yahoo、自己的网站）上验证自己的身份，我需要将登录详细信息存储在应用程序（在客户端系统上运行）中。如果有人提取它或嗅探网络流量，他将可以访问我的电子邮件帐户。也许可以使用安全连接消除第二个威胁。但是，无论密码是否被混淆，仍然可以从应用程序中获取密码。

那么是否有“安全”概念使我能够从我的程序中发送电子邮件消息，该程序在客户端 PC 上运行，无需以可访问的形式存储密码，也不需要特殊的 Web 服务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T15:39:46.990

过去我有这样的要求，我们通过使用网络服务发布消息来解决。

例如，如果用户想要提交错误报告，它将被转换为对我们的 Web 服务器的 Web 服务调用，然后将相应地转发。

回答您的问题：您无法隐藏您的邮件服务器。如果您的程序可以发送电子邮件，那么使用另一个程序的用户也可以。（对于 Web 服务也是如此。）您可以做的是使用开放的 smtp 服务器（smtp 中继），但这只是自找麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T15:41:17.160

如果您向域发送消息，表明邮件服务器是您的最终目的地，您不需要验证发件人，您只需在将邮件中继到另一个域时执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T15:45:17.417

您可以只允许通过 Active Directory 身份验证的用户发送电子邮件。这将允许您在您的应用程序能够发送邮件之前检查用户是否拥有有效的帐户并且是否在有效的组“域\MyMailSendUsers”中。

如果您使用的是本地邮件服务器，也可以将其配置为仅允许来自某些资源的连接。如果您使用来自外部供应商（雅虎、谷歌等）的邮件，那么您将不得不存储用户名和密码，除了要求用户在每次他们想要发送时输入它们之外，没有真正的解决方法，您然后可以将它们存储在运行时变量中（并对其进行加密）以确保它们的安全。

# c# - 从 Windsor Container 中删除或覆盖组件

> ID：312624
> 
> 赞同：5
> 
> 时间：2008-11-23T15:34:41.570
> 
> 标签：c#, .net, dependency-injection, inversion-of-control, castle-windsor

我正在尝试完成一件看似超级简单的事情：从我的单元测试中，我想用模拟/假对象替换正在解析的类型。

例如：xml 配置声明服务 IInterface 的组件应解析为 ClassA。很好，但是从我的单元测试中，我希望类型解析为 FakeClassA。我不能为此使用 container.AddComponent，因为“已经为给定键注册了一个组件......”。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T20:31:26.510

IKernel 有一个[RemoveComponent](http://www.castleproject.org/container/documentation/trunk/manual/mktypedocs/Generated_IKernel.html#IKernel_Methods19)方法。

但是对于单元测试，建议您根本不要使用容器，或者如果测试设置由于依赖关系而变得过于密集，请使用[AutoMockingContainer](http://blog.eleutian.com/CommentView,guid,762249da-e25a-4503-8f20-c6d59b1a69bc.aspx)。

[这是](https://github.com/codechip/rhino-tools/tree/master/testing)另一个（更新的）实现。

# javascript - 从 Firefox 扩展在当前选项卡/窗口中打开 URL

> ID：312625
> 
> 赞同：13
> 
> 时间：2008-11-23T15:35:21.117
> 
> 标签：javascript, firefox, xul

我正在创建一个 Firefox 扩展...从菜单项在当前选项卡中打开 URL 的 javascript 是什么？

例如，在我的 overlay.xul 文件中，我有以下行：

```
<menuitem label="Visit homepage" oncommand="window.location='http://www.somepage.com'"/> 
```

但在 Firefox 中，当我单击菜单项时，它会打开 URL，但会破坏浏览器的整个布局。

这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-23T16:32:12.907

浏览了一圈后，我发现我必须将上面的代码替换为：

```
<menuitem label="Visit homepage" oncommand="content.wrappedJSObject.location='http://www.somepage.com'"/> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-30T23:02:00.443

从菜单项中，您可以使用**openUILinkIn**。它的工作原理如下：

```
openUILinkIn(url, where); 
```

哪里可以是：选项卡、当前、窗口（以及其他一些很少使用的选项）

如果您想根据用户按下的键盘修饰符做出不同的行为，您可以使用另一个函数**whereToOpenLink**，它根据用户的偏好和修饰符返回选项卡/当前/窗口。

```
openUILinkIn(url, whereToOpenLink(event)); 
```

因此我使用：

```
<menuitem label="Visit homepage" 
          oncommand="openUILinkIn('http://example.com/', whereToOpenLink(event))"/> 
```

如果您不在菜单项的上下文中，您可能需要查看另一个内置 XBL，它为标签添加链接和打开 HREF：

```
<label value="google" class="text-link" href="http://google.com/" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-29T03:20:48.683

```
<menuitem label="Visit Report Site" oncommand="var win = Components.classes['@mozilla.org/appshell/window-mediator;1']
.getService(Components.interfaces.nsIWindowMediator)
.getMostRecentWindow('navigator:browser'); win.openUILinkIn('http://www.google.com', 'tab');"/> 
```

在新标签页中打开 URL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T09:33:14.453

在你的命令上调用这个 JS 函数

```
//open a url current window:
function openUrl(url) {
content.wrappedJSObject.location = url;
newTabBrowser = gBrowser.selectedBrowser;
newTabBrowser.addEventListener("load", highlight, true);
}

//new tab
function openUrlNewTab(url) {
var win = Components.classes['@mozilla.org/appshell/window-mediator;1']
            .getService(Components.interfaces.nsIWindowMediator)
            .getMostRecentWindow('navigator:browser');
win.gBrowser.selectedTab = win.gBrowser.addTab(url);
} 
```

# visual-studio-express - 需要热键/按钮来注释掉 Visual Studio 2008 Express 中的代码块

> ID：312626
> 
> 赞同：25
> 
> 时间：2008-11-23T15:35:30.570
> 
> 标签：visual-studio-express

我来自 Eclipse，在 Visual Studio 2008 Express 中工作，只想突出显示代码，右键单击并将其注释掉。

*   右键什么都没有
*   寻找工具 | 选项，工具栏，命令，找不到它的按钮...

如何激活此评论/取消评论功能，我知道 Visual Studio 2003 有它。

这是答案，结果取决于您使用的是什么：

**Visual Studio 2008 完整版：**

评论 `Ctrl`- `K`, `Ctrl`-`C`
取消 评论`Ctrl`- `K`, `Ctrl`-`U`

**Visual Web Developer 2008 速成版：**

评论 `Ctrl`- `K`, `Ctrl`-`C`
取消 评论`Ctrl`- `K`, `Ctrl`-`U`

**Visual C# 2008 速成版：**

评论 `Ctrl`- `E`, `Ctrl`-`C`
取消 评论`Ctrl`- `E`, `Ctrl`-`U`

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-23T16:57:01.950

奇怪的是`Ctrl`+ `E`，`C`（评论）和`Ctrl`+ `E`，`U`（取消评论）

[![](https://lh4.ggpht.com/_nxgDpneh8yk/SSmK9owk_dI/AAAAAAAAAZA/CIOm5V9Jbyw/s800/Comment_in_EE.JPG)](http://picasaweb.google.com/lh/photo/jS75c4D1FfUA9kBy92nB5Q?authkey=-b3uGjHkX3g)

正如 Mauro 所说，通常是`Ctrl`+和+ 。Express Edition 默认（也是唯一的）键盘映射另有说明。`K``C``Ctrl``K``U`

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-23T15:39:50.813

组合键

评论 `Ctrl`- `K`, `Ctrl`-`C`
取消 评论`Ctrl`- `K`, `Ctrl`-`U`

那是VS 2008，不知道快递版是否有同样的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T15:45:09.833

Mauro 对捷径的看法是正确的，它们也在 Express 中。您还可以在“编辑”->“高级”菜单中访问“注释/取消注释”块命令。您可能还有一个工具栏图标来执行此操作，看起来像几行，带有一些缩进的蓝色行。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T20:05:06.267

Visual Assist X 也有更好的快捷键：

> `/`- 用注释块`//`
> `*`- 用注释块`/* */`

我不确定 Visual Assist 是否适用于 The express edition

# neural-network - 神经网络的非数学描述

> ID：312627
> 
> 赞同：14
> 
> 时间：2008-11-23T15:35:57.870
> 
> 标签：neural-network

我不是数学家。我喜欢一个很好的数学难题，但我全心全意地承认我的弱点。也就是说，我一直对神经网络很感兴趣，虽然我对它们的了解足以从头开始实现它们，但当我需要理解任何只能找到数学证明的概念时，我就碰壁了。程序员的神经网络指南在哪里，用代码而不是公式来解释实际推理？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-23T17:17:50.770

另一种选择是非数学、非编程的解释。[Blondie24: Playing at the Edge of AI](https://rads.stackoverflow.com/amzn/click/com/1558607838)一书对神经网络做了很好的解释。这是关于作者开发的跳棋AI。它并非*完全*没有编程参考，但它很好地解释了算法是如何工作的，而无需进入解决方案的代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T15:50:31.290

不幸的是，我不知道是否有一个好的单一“程序员资源”可以为您提供所有概念。我喜欢[Neural and Adaptive Systems: Fundamentals through Simulations](https://rads.stackoverflow.com/amzn/click/com/0471351679)。

对神经网络有“程序员的理解”的最好方法不是检查代码，而是检查问题和正确的结果。所以，如果你不想看数学，我建议你看一个给定的问题。例如，将 XOR 问题作为为什么需要非线性激活函数的示例，查看变量的数量及其可能值以了解为什么神经网络需要具有一定的大小和拓扑才能有效，以及将您的数据拆分为训练/测试方案并进行研究以了解为什么过度拟合是危险的。用数据检查代码。

我还建议不要太挂断电话，而是进一步阅读。一旦您看到它们在循环和建设性神经网络中的泛化，前馈网络中的某些实践就会变得更加清晰。我还建议扩大范围：贝叶斯网络、模糊认知图、SOM、玻尔兹曼机、模拟退火和强化学习都有直觉。

这是否有助于回答您的问题？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T16:30:29.930

您需要对 Pascal 或 Delphi 有一点了解，但ThinkQuest 的[这个概述](http://library.thinkquest.org/C007009/introduction/preface/preface.html)从编程的角度来看非常有帮助。它还解释了一些困难以及为什么数学看起来有点吓人。（我也不是数学家。）

不久前，我对这类事情非常感兴趣（大部分情况下仍然如此），并寻找一些我可以很快跟进的演练。

希望至少有一点帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T16:07:54.000

我个人使用过：

C++ 中的实用神经网络食谱

[http://www.amazon.com/Practical-Neural-Network-Recipes-C/dp/0124790402/ref=pd_bxgy_b_img_b/179-4083507-8029219](https://rads.stackoverflow.com/amzn/click/com/0124790402)

在我看来，作者并没有充分利用 C++ 更强大的功能，在很多情况下它读起来更像是带有类的传统 C。这本书现在也有点过时了。

但是 - 如果您需要解释神经网络中使用的算法和技术，并以聪明的外行可以理解的方式进行解释，以便您可以离开并自己尝试这些东西，那么我肯定会尝试这本书。这里没有太多的肚脐凝视，这是我喜欢的。

它将带您了解编写神经网络所需的所有主要内容 - 如何将实际输出与期望的输出进行比较以获得错误信号，然后将此错误信号与反向传播算法结合使用来修改网络链接连接优势，迭代地执行此操作，以便神经网络逐渐“学习”任务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-03T22:20:58.943

我写了一篇几乎完全是这个标题的文章。本文描述了如何将数据表示为神经网络，以及其他机器学习方法，例如支持向量机。

[http://www.heatonresearch.com/content/non-mathematical-introduction-using-neural-networks](http://www.heatonresearch.com/content/non-mathematical-introduction-using-neural-networks)

# ruby-on-rails - Rails 中没有命名空间的路由（2.2）

> ID：312628
> 
> 赞同：0
> 
> 时间：2008-11-23T15:36:04.267
> 
> 标签：ruby-on-rails, ruby, routing

与此处提出的问题有关[——rails 资源路由中的默认段名称](https://stackoverflow.com/questions/182040/default-segment-name-in-rails-resources-routing)。

在尝试生成没有命名空间前缀的资源时遇到问题（即 /:apple_id/oranges/）。使用插件给了我 //:apple_id/oranges?

有更简单的方法吗？也许是2.2的问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T13:49:06.880

我所做的就是把整个东西完全从命名空间中取出

`map.resources :fruits, :path_prefix => ":apple_id", :name_prefix => "apple_"`

它会是

```
 apple_fruits GET    /:apple_id/fruits                                    {:controller=>"fruits", :action=>"index"}
                       formatted_apple_fruits GET    /:apple_id/fruits.:format                            {:controller=>"fruits", :action=>"index"}
                                              POST   /:apple_id/fruits                                    {:controller=>"fruits", :action=>"create"}
                                              POST   /:apple_id/fruits.:format                            {:controller=>"fruits", :action=>"create"}
                              new_apple_fruit GET    /:apple_id/fruits/new                                {:controller=>"fruits", :action=>"new"}
                    formatted_new_apple_fruit GET    /:apple_id/fruits/new.:format                        {:controller=>"fruits", :action=>"new"}
                             edit_apple_fruit GET    /:apple_id/fruits/:id/edit                           {:controller=>"fruits", :action=>"edit"}
                   formatted_edit_apple_fruit GET    /:apple_id/fruits/:id/edit.:format                   {:controller=>"fruits", :action=>"edit"}
                                  apple_fruit GET    /:apple_id/fruits/:id                                {:controller=>"fruits", :action=>"show"}
                        formatted_apple_fruit GET    /:apple_id/fruits/:id.:format                        {:controller=>"fruits", :action=>"show"}
                                              PUT    /:apple_id/fruits/:id                                {:controller=>"fruits", :action=>"update"}
                                              PUT    /:apple_id/fruits/:id.:format                        {:controller=>"fruits", :action=>"update"}
                                              DELETE /:apple_id/fruits/:id                                {:controller=>"fruits", :action=>"destroy"}
                                              DELETE /:apple_id/fruits/:id.:format                        {:controller=>"fruits", :action=>"destroy"} 
```

这对我有用，希望它也对你有用:)

# java - 每个包有多少个类？每个类的方法？每个方法的行数？

> ID：312642
> 
> 赞同：30
> 
> 时间：2008-11-23T15:47:35.103
> 
> 标签：java

我必须对一些巨大的 Java 项目做一个一般性的说明，我对此几乎没有知名度，我想知道是否有任何指导方针来确定：

*   每个包有多少类可以被认为是正确的、低的或高的（这个项目每个包有 3.89 个类，这对我来说似乎有点太小了），
*   每个类的方法数？（这个项目每个类有 6.54 个方法......
*   每个方法的行数？（这个项目每个方法大约有 7 行（对我来说似乎相当不错，可能有点低））

我应该注意，这个问题只涉及体积。我有一堆来自质量工具（checkstyle、jdepend、cpd、pmd、ncss）的报告，这些报告让我对代码冗余、类使用、错误等有了更多的了解。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-23T15:54:13.327

Steve McConnell 在他的书 Code Complete 中建议每个类使用大约 7 个方法，并且方法中没有更多行可以在单个屏幕中查看而无需滚动。

我不确定每个包的类。

我强烈建议阅读 Code Complete 以获取有关此类主题的更多信息。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-23T15:54:08.990

我认为这样的统计数据毫无用处，知道每个方法的行数如何表明它对项目是否有用；我认为您应该更多地关注以下方面：

1.  你的包包含类似的类吗？
2.  您的班级是否作为一个实体独立工作？
3.  类中的方法是否正确有效地运行？

当然除了内存使用之外，方法是否很大都没有关系？在非常冗长的方法中要寻找的另一件事是堆栈跟踪是否会比将功能添加到父方法更大。我会警惕基于代码行来衡量项目的成功。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-23T16:05:21.900

Robert C. Martin，最近出版了《干净的代码》一书，他指出每个方法的行数应该尽可能少。1-7 行之间是一个很好的经验法则。

在 Jeff Bay 的文章“Object Calisthenics”中，The ThoughtWorks Anthology 一书中也提出了一个很好的观点。他提出了 9 个非常核心的约束，从长远来看，这些约束将使你成为更好的 OO 开发人员。[在此处阅读有关它们的更多信息。](http://binstock.blogspot.com/2008/04/perfecting-oos-small-classes-and-short.html)

为了回答您的具体问题，这些是专门针对您的限制： - 每个包不超过 10 个类 - 每个类最多 50 行

这些约束可能并不适合您的所有实际项目，但在小型（爱好？）项目中使用它们将迫使您进行更好的实践。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-23T16:00:18.213

不幸的是，软件中没有绝对（客观）的质量概念。因此，这些没有“正确”的价值。但是，这里有两个（个人）观察：

3.89 个类/包非常低。这意味着你将在一个复杂的包树中战斗。

每个方法 7 行：确实听起来不错。但是，如果这些数字是由于有意减少方法的行数而达到的，那么您可能最终会得到一个逻辑任务分散在几个私有方法上，这将使理解类变得更加困难（在某些情况下）。实际上，在 CodeComplete-2 中，作者引用了一项研究，该研究发现方法长度的重要性远低于其圈复杂度和嵌套级别。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-23T19:41:22.183

一个有用的设计指南说每个类应该只做一件事并且做好。这不会为每个类提供固定数量的方法，但会限制数量并使类更易于理解和维护。

对于方法，您可以采用类似的观点，并以尽可能小的方法为目标，但不能更小。可以这样想：如果您可以将方法拆分为两个或更多不同的部分，那么它显然不会尽可能小。小方法易于理解，通过像这样拆分代码，您将更好地了解高级方法并将细节推送到低级方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-23T19:47:01.593

（注：tl;博士在最底部提供我的真实意见）

我不会引用任何大牌并说这是正确的答案，因为这总是取决于你如何做所有这些事情。例如方法的数量：如果你正在为现代高清液晶电视遥控器制作一个控制软件，它有大约 40-50 个按钮，你怎么能**连贯**地把它分解成类，这样你就只有 7 种方法每班？

就我个人而言，我喜欢将一个访问器级别的所有方法保留在一个类中，这意味着某些实用程序类最终可能拥有数百种方法，但在我看来，做一些`StringUtil.escapeXMLspecialCharacters(someString)`比`StringUtil.XML.escapeSpecialCharacters(someString)`or更容易`XMLUtil.escapeSpecialCharacters(someString)`。虽然这些似乎都是不错的解决方案，但第一个蓬勃发展（至少在我看来，就是这样！）因为它是访问该方法的简单且非常容易的方法：您不必考虑您正在处理的字符串是否包含XML 或 XHTML 或 JSON 或任何其他方法，您只需从通用方法组中选择一种方法即可。

继续前面的电视遥控器类比，假设您确实将它们分成不同的类。如果我们允许自己平均每个类有 7 个这样的方法，并设法将遥控器上的按钮分组到有意义的组`MenuButtons`中，例如`AdjustmentButtons`和“NumberSelectorButtons”，我们最终会得到大约 8 个类。这实际上并不是一件坏事，但它很容易让人感到困惑，特别是如果他们没有非常小心地划分为敏感的群体。想象一下您的 TVRemotes'R'Us Inc. 办公室周围的咆哮：“谁说电源开/关按钮是控制按钮？” “谁是把音量 +/- 放到菜单按钮的小丑？PRE/CH *（在当前和上一个频道和/或图像源之间切换的按钮）*按钮不是数字按钮！” “指南按钮根据上下文同时打开电视指南和导航菜单，我们要如何处理它！？”

因此，正如您希望从这个示例中看到的那样，使用任意数字来限制自己可能会引入一些不必要的复杂性并破坏应用程序的逻辑流程。

在我投入最后两分钱之前，关于每个方法的行数的一件事：将代码视为块。每个循环都是一个块，每个条件都是一个块，依此类推。一个具有单一职责的代码单元所需的这些块的最小数量是多少？那应该是你的限制因素，而不是“到处都有七”的愿望。从包中的类数、类中的方法和方法中的代码行数。

这是**TL;DR**：

所以，我真正的看法实际上是这样的：包中的类数量应该相当少。我最近开始做以下事情，但我不确定我是否会跟上它：

*   包`foo`包含用于实现的接口和其他通用类。
*   包`foo.bar`包含上述功能接口的实现`bar`
*   包`foo.baz`包含上述功能接口的实现`baz`

这通常意味着我的整个结构有一个连贯的（而且很可能是很少的）类，通过阅读顶级类接口（及其注释），我也应该能够理解其他包。

每个类的方法：所有这些都是我上面解释的。如果你的班级不能没有 170 种方法，那就让它拥有它们吧。重构是一种美德，而不是可以一直应用的东西。

Lines per method: As low as possible, I usually end up with 10 to 25 lines per method and 25 is a bit high for me so I'd say 10 is a good balance point for that.

# c - 递增 C 指针

> ID：312648
> 
> 赞同：6
> 
> 时间：2008-11-23T15:53:27.430
> 
> 标签：c, pointers

我认为如果指向 char 数组的 ac 指针递增，那么它将指向该数组中的下一个元素。但是当我尝试这个时，我发现我必须增加它两次。尝试使用 sizeof(char) 进行增量，我发现添加 char 的大小太多了，因此必须将其除以 2。

```
#include <stdio.h>

int main(int argc, char * argv[]){
   char *pi;
   int i;
   pi = argv[1];
   printf("%d args.\n",argc-1);
   printf("input: ");
   for(i=0;i<argc-1;i++){
      printf("%c, ",*pi);
      /*The line below increments pi by 1 char worth of bytes */
      //pi+=sizeof(pi)/2;
      /* An alternative to the above line is putting pi++ twice - why? */
      pi++;
      pi++;
   }
   printf("\n");
   return 0;
} 
```

难道我做错了什么？还是我误解了递增指针的方法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-23T16:02:07.337

sizeof(char) 保证为 1，但 sizeof(char*) 不是。

然而，您的功能**只是偶然地起作用**。

例如，尝试使用以下参数调用它：

```
abc defg 
```

这将产生：

```
2 args.
input: a, c, 
```

这是完全错误的。问题是您正在递增指向 argv 的元素 1 的指针，而不是指向 argv 的指针。

尝试这个：

```
#include <stdio.h>

int main(int argc, char * argv[]){
   char **pi;
   int i;

   pi = argv + 1;
   printf("%d args.\n",argc-1);
   printf("input: ");
   for(i=0;i<argc-1;i++){
      printf("%c, ",**pi);
      pi++;
   }
   printf("\n");
   return 0;
} 
```

这将打印每个参数的第一个字符：

```
2 args.
input: a, d, 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T15:59:36.403

如果您有一个`ptr`类型的指针`T*`并添加`N`，则该指针将前进一个`N * sizeof (*ptr)`或等效`N * sizeof (T)`字节。你只是忘了取消引用`pi`。所以你得到的`sizeof (pi)`是 的 sizeof `char*`，而不是 a 的 sizeof `char`。您的行相当于`pi+=sizeof(char*)/2;`您平台上的指针有 4 个字节大。因此实际上你做到了`pi+=2;`。`pi+=2`如果要增加 2 倍，请写入。请注意，`char`根据定义，它的 sizeof 为 1。你不需要做`sizeof (char)`，它总是1。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T16:02:23.170

sizeof(pi) 返回 (char*) 的大小，它是 pi 的类型（一个指针，可能是两个、四个或八个字节）。sizeof(char) 将返回 1。

但是，要理解的另一件事是，每当您将指针递增一个数字时（例如： pi += sizeof(char); pi++; 等），无论如何您都会将指针递增基本大小。所以：

```
int *ipointer = &int_array[0];
ipointer += 2; 
```

实际上会将 ipointer 增加 2*倍 sizeof int*。

您似乎做错的另一件事是将 pi 指向第一个参数，然后遍历所有参数。如果您想遍历参数，请尝试以下操作：

```
for (i = 1; i < argc; i++) {
    pi = argv[i];
    // ... do something with pi
} 
```

# java - 如何在 Ant 目标中使用文件大小

> ID：312652
> 
> 赞同：6
> 
> 时间：2008-11-23T15:56:47.673
> 
> 标签：java, ant, filesize

我目前正在用 Ant 构建脚本替换我的自制构建脚本。

现在我需要用特定文件的大小替换各种标记。我知道如何通过`<length>`任务获取以字节为单位的大小并存储在属性中，但我也需要以千字节和兆字节为单位的大小。

如何以其他表示形式（KB、MB）访问文件大小或从 Ant 目标中计算这些值并将它们存储在属性中？

**编辑：**在我发现这个`<script>`任务之后，使用一些 JavaScript 计算其他值并使用`project.setNewProperty("foo", "bar");`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-28T20:00:17.277

我找到了一个不需要任何第三方库或自定义任务的解决方案，它使用[`<script>`允许](http://ant.apache.org/manual/Tasks/script.html)从Ant 目标中使用 JavaScript（或任何其他[Apache BSF](http://jakarta.apache.org/bsf)或[JSR 223支持的语言）的任务。](https://scripting.dev.java.net/)

```
<target name="insert-filesize">
    <length file="${afile}" property="fs.length.bytes" />

    <script language="javascript">
    <![CDATA[
        var length_bytes = project.getProperty("fs.length.bytes");
        var length_kbytes = Math.round((length_bytes / 1024) * Math.pow(10,2))
                          / Math.pow(10,2);
        var length_mbytes = Math.round((length_kbytes / 1024) * Math.pow(10,2))
                          / Math.pow(10,2);
        project.setNewProperty("fs.length.kb", length_kbytes);
        project.setNewProperty("fs.length.mb", length_mbytes);
    ]]>
    </script>

    <copy todir="${target.dir}">
        <fileset dir="${source.dir}">
            <include name="**/*" />
            <exclude name="**/*.zip" />
        </fileset>
        <filterset begintoken="$$$$" endtoken="$$$$">
            <filter token="SIZEBYTES" value="${fs.length.bytes}"/>
            <filter token="SIZEKILOBYTES" value="${fs.length.kb}"/>
            <filter token="SIZEMEGABYTES" value="${fs.length.mb}"/>
        </filterset>
    </copy>
</target> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T16:03:23.353

在[http://ant-contrib.sourceforge.net/](http://ant-contrib.sourceforge.net/)有一个数学任务可能有用

# java - 如何摆脱Java小程序加载过程中出现的白色矩形闪烁？

> ID：312672
> 
> 赞同：3
> 
> 时间：2008-11-23T16:12:35.597
> 
> 标签：java, browser, applet

加载小程序时，它会在瞬间显示一个白色矩形。我们怎样才能摆脱它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T13:21:21.963

Did you try loading your applet offscreen?

You can then use MAYSCRIPT+LiveConnect to have your applet signal that it is running and have JavaScript move the applet container back onscreen.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T11:04:25.250

如果您的目标是 Java 6，您可以尝试使用新的插件选项来显示加载屏幕。[http://www.oracle.com/technetwork/java/javase/plugin2-142482.html#LOADING_SCREEN](http://www.oracle.com/technetwork/java/javase/plugin2-142482.html#LOADING_SCREEN)

# python - Python、optparse 和文件掩码

> ID：312673
> 
> 赞同：3
> 
> 时间：2008-11-23T16:12:42.930
> 
> 标签：python, optparse

```
if __name__=='__main__':
    parser = OptionParser()
    parser.add_option("-i", "--input_file", 
                    dest="input_filename",
                      help="Read input from FILE", metavar="FILE")

    (options, args) = parser.parse_args()
    print options 
```

结果是

```
$ python convert.py -i video_*
{'input_filename': 'video_1.wmv'} 
```

当前文件夹中有 video_[1-6].wmv。问题是为什么video_*变成video_1.wmv。我做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-23T16:20:25.100

Python 与此无关——它是 shell。

称呼

```
$ python convert.py -i 'video_*' 
```

它会传入那个通配符。

其他六个值作为 args 传入，没有附加到`-i`，就像您运行 一样`python convert.py -i video_1 video_2 video_3 video_4 video_5 video_6`，并且`-i`唯一附加到紧接的下一个参数。

也就是说，您最好的选择可能是从 读取您的输入文件名`args`，而不是使用`options.input`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T16:20:51.290

打印出 args，你会看到其他文件的去向......

它们被转换为 argv 中的单独参数，并且 optparse 仅将第一个参数作为 input_filename 选项的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T20:22:25.640

澄清：

```
aprogram -e *.wmv 
```

在 Linux shell 上，所有通配符 (*.wmv) 都由 shell 扩展。所以`aprogram`实际上收到了论点：

```
sys.argv == ['aprogram', '-e', '1.wmv', '2.wmv', '3.wmv'] 
```

就像[查尔斯](https://stackoverflow.com/questions/312673/python-optparse-and-file-mask#312677)说的那样，你可以引用这个论点让它从字面上传递：

```
aprogram -e "*.wmv" 
```

这将传入：

```
sys.argv == ['aprogram', '-e', '*.wmv'] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T18:54:25.287

这并不明显，即使您阅读了一些标准（如[this](http://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap12.html)或[this](http://www.faqs.org/docs/artu/ch10s05.html)）。

命令行的*args*部分——几乎普遍——是输入文件。

只有非常罕见的奇数情况下，输入文件被指定为选项。它确实会发生，但非常罕见。

此外，输出文件永远不会被命名为*args*。它们几乎总是作为命名选项提供。

这个想法是

1.  大多数程序可以（并且应该）从标准输入读取。的命令行参数`-`是“stdin”的代码。如果没有给出参数，stdin 是后备计划。

2.  如果您的程序打开任何文件，它也可以打开命令行中指定的无限数量的文件。Shell 通过为您扩展通配符来促进这一点。[但是，Windows 不会为您执行此操作。]

3.  您的程序不应该在没有明确的命令行选项的情况下覆盖文件，例如“-o somefile”来写入文件。

请注意，`cp`、`mv`、`rm`是不遵循这些标准的程序的重要示例。

# directory - xampp 包括不工作

> ID：312674
> 
> 赞同：2
> 
> 时间：2008-11-23T16:16:13.937
> 
> 标签：directory, localhost, xampp, include

首先，我如何知道我的 html 文件是否在 Xampp 的 localhost 上运行？是否有关于如何管理文件/目录并使所有这些都在 htdocs 下工作的教程？是否有关于如何设置包含的好教程？

我想在我的 html 中使用 Xampp 中的“包含”。我可以同时使用 html 包含和 php 包含吗？我必须放shtml吗？我可以使用 shtml、html、htm 和 php 包含吗？它们是否必须在一个包含目录中，该目录是 htdocs 下的子目录？我可以在其他子目录中引用包含吗？我的网站将有 100 多个页面，我正在尝试使用不同的版本进行“实验”，直到我满意为止。所以，我有各种下拉菜单的子目录。不幸的是，我似乎无法在 xampp 中使用它。无法从 Vista Buttons 显示我的 javascript 菜单，现在我将我的站点的主目录移动到 htdocs 目录。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-07-19T14:27:47.563

Since **XAMPP** uses **Apache** you need to configure it to permit **SSI**.

> To permit SSI on your server, you must have the following directive either in your httpd.conf file, or in a .htaccess file:
> 
> ```
> Options +Includes 
> ```
> 
> This tells Apache that you want to permit files to be parsed for SSI directives. Note that most configurations contain multiple Options directives that can override each other. You will probably need to apply the Options to the specific directory where you want SSI enabled in order to assure that it gets evaluated last.
> 
> Not just any file is parsed for SSI directives. You have to tell Apache which files should be parsed. There are two ways to do this. You can tell Apache to parse any file with a particular file extension, such as .shtml, with the following directives:
> 
> ```
> AddType text/html .shtml
> AddOutputFilter INCLUDES .shtml 
> ```
> 
> One disadvantage to this approach is that if you wanted to add SSI directives to an existing page, you would have to change the name of that page, and all links to that page, in order to give it a .shtml extension, so that those directives would be executed.
> 
> The other method is to use the XBitHack directive:
> 
> ```
> XBitHack on 
> ```
> 
> XBitHack tells Apache to parse files for SSI directives if they have the execute bit set. So, to add SSI directives to an existing page, rather than having to change the file name, you would just need to make the file executable using chmod.
> 
> ```
> chmod +x pagename.html 
> ```

According to [Apache Tutorial: Introduction to Server Side Includes](http://httpd.apache.org/docs/2.2/howto/ssi.html#configuring)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-07-07T15:58:47.543

我遇到了同样的问题，但我无法弄清楚我必须修改的确切位置以及哪些文件。因此，要修复它，请按照 XAMPP 本地主机服务器中的以下步骤进行操作。

1.  转到您的：

    ```
    c:/xampp/apache/conf/httpd.conf 
    ```

2.  搜索：

    ```
    AddType text/html .shtml 
    ```

3.  添加以下两行：

    ```
    AddType text/html .html
    AddOutputFilter INCLUDES .html 
    ```

4.  转到**Xampp 控制面板**并**停止会话并重新启动**。

5.  在浏览器中刷新页面并查看，虚拟包含将开始工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T17:08:16.920

要回答您的第一个问题，您可以访问[http://localhost/](http://localhost/)吗？如果是这样，那么 xampp 运行正常，您无需再做任何事情。

**编辑：**如果您想确保一切正常，请将 foo.html 放在 /xampp/htdocs 下，然后在[http://localhost/foo.html](http://localhost/foo.html)的浏览器中访问它。如果您无法获取此页面，则 xampp 仍然无法正常运行。

在回答您的第二个问题时，无论是 HTML 还是 PHP 中的所有包含都是服务器端的。如果您正确安装了 xampp，那么您可以立即开始使用 PHP 并可以使用 PHP 中的包含函数（请注意，即使页面仅包含 HTML，如果您使用的是 PHP，它仍然必须具有 .php 扩展名） .

如果您更愿意在 .html 页面中使用 SSI，那么[此链接](http://forums.site5.com/showthread.php?t=6543)可能会提供有关如何在 xampp 中设置和调试 SSI 的一些帮助。

此外，如果您还没有这样做，我建议您在安装了 Firebug 的 Firefox 中工作。Firebug 将处理您的大部分 JavaScript 调试需求。

最后一点，如果您移动了目录等，我首先要检查的是脚本标签上的 src 属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T22:34:31.580

我发现要在 XAMPP 中使用包含功能，您的包含包含功能的页面需要具有扩展名“.shtml”，而包含的文件具有“.html”。大多数现代浏览器不需要 shtml 扩展，但 XAMPP 似乎需要。

.js 似乎是一样的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T17:21:29.937

您可能想查看 AMPstart 而不是 xampp-control。它有一些很好的能力，可以让您将站点文件夹放在 htdocs 之外，而不会弄乱 apache conf 的东西

# php - 如何删除 FTP 程序添加到代码中的多余空格？

> ID：312688
> 
> 赞同：1
> 
> 时间：2008-11-23T16:35:46.363
> 
> 标签：php, ftp, whitespace

这种情况反复发生，非常烦人。我将一些 PHP 代码上传到客户端的服务器。几个星期过去了。他们要求进行更改，我重新下载代码，因为他们已经进行了一些更改。但是，我上次查看时曾经整洁的代码现在到处都添加了额外的空白行。所以现在我在一些代码之间有两行空格，现在有 3 行。我有一堆行粘在一起，因为它们是同一个 for 循环或类似的一部分，它们现在都分散在周围，没有办法来区分它们。

有没有解决这个问题的程序/实用程序？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-23T16:37:29.807

以二进制模式而不是 ascii 上传。Ascii 模式正在将所有换行符（unix 行尾字符）更改为回车 + 换行符（Windows 行尾字符）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T16:55:06.293

当您使用空格时（您使用的是空格，对吗？），您也可能在使用制表符的其他编辑器中遇到问题。在 Linux/OSX 和 Windows 上的开发人员之间共享源代码时，我看到了类似的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T16:56:09.113

我敢打赌这是由于系统试图将在 Windows 系统中创建的文本文件转换为 Unix/Linux 系统正在使用的文件（然后再返回）。

Windows 同时使用回车和换行，我认为 Unix 只使用换行（或者是回车）。

我使用 Ultra Edit 作为我的主要文本编辑器（不是 Emacs 和 vi 不规则 :o），它有 DOS 模式和 Unix 模式来处理这类事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T17:30:00.543

强制您的客户端以二进制模式传输所有文件。当您的文件中有 unicode 文本时，这也很有用，您永远不知道文本模式可能会做出什么假设！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T17:45:24.600

猜测一下，我会说您是在 Unix/Max 系统上开发，但客户在 Windows 系统上运行（反之亦然）。我还猜想您正在以二进制模式上传/下载文件。Windows 编辑器可能正在将 Unix LF 转换为 LF/CR 对，您的编辑器会将其视为两个新行。如果您以 ASCII 模式上传和下载，文件将在两种格式之间自动转换。

# javascript - 如何在 .js 文件中动态导入 .js 文件？

> ID：312692
> 
> 赞同：4
> 
> 时间：2008-11-23T16:40:30.020
> 
> 标签：javascript, dynamic, import

### 重复问题 - 请参阅：[如何动态加载 javascript 文件？（想想 C 的#include）](https://stackoverflow.com/questions/21294/how-do-you-dynamically-load-a-javascript-file-think-cs-include)

* * *

是否有与@import 等效的javascript？因为使用以下从 javascript 文件中包含另一个 javascript 文件的方式看起来不是很好和干净。

```
 document.write("<script type='text/javascript' src='something.js'></script>"); 
```

谷歌有一些类似于我正在寻找的东西，但它只适用于他们的托管文件，我不知道这些功能在内部是如何工作的（他们所有的代码都是压缩的）

```
 google.load("maps", "2"); 
```

我需要这个，因为有些 javascript 文件有时只在我的应用程序中使用。

# python - Python：重载构造函数的问题

> ID：312695
> 
> 赞同：7
> 
> 时间：2008-11-23T16:41:56.180
> 
> 标签：python, exception, constructor-overloading

警告：我已经学习了 10 分钟的 Python，所以对任何愚蠢的问题表示歉意！

我编写了以下代码，但是出现以下异常：

> 消息文件名称行位置追溯节点 31 异常。类型错误：此构造函数不接受任何参数

```
class Computer:

    name = "Computer1"
    ip = "0.0.0.0"
    screenSize = 17

    def Computer(compName, compIp, compScreenSize):
        name = compName
        ip = compIp
        screenSize = compScreenSize

        printStats()

        return

    def Computer():
        printStats()

        return

    def printStats():
        print "Computer Statistics: --------------------------------"
        print "Name:" + name
        print "IP:" + ip
        print "ScreenSize:" , screenSize // cannot concatenate 'str' and 'tuple' objects
        print "-----------------------------------------------------"
        return

comp1 = Computer()
comp2 = Computer("The best computer in the world", "27.1.0.128",22) 
```

有什么想法吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-23T17:09:12.270

我将假设您来自 Java-ish 背景，因此需要指出一些关键差异。

```
class Computer(object):
    """Docstrings are used kind of like Javadoc to document classes and
    members.  They are the first thing inside a class or method.

    You probably want to extend object, to make it a "new-style" class.
    There are reasons for this that are a bit complex to explain."""

    # everything down here is a static variable, unlike in Java or C# where
    # declarations here are for what members a class has.  All instance
    # variables in Python are dynamic, unless you specifically tell Python
    # otherwise.
    defaultName = "belinda"
    defaultRes = (1024, 768)
    defaultIP = "192.168.5.307"

    def __init__(self, name=defaultName, resolution=defaultRes, ip=defaultIP):
        """Constructors in Python are called __init__.  Methods with names
        like __something__ often have special significance to the Python
        interpreter.

        The first argument to any class method is a reference to the current
        object, called "self" by convention.

        You can use default function arguments instead of function
        overloading."""
        self.name = name
        self.resolution = resolution
        self.ip = ip
        # and so on

    def printStats(self):
        """You could instead use a __str__(self, ...) function to return this
        string.  Then you could simply do "print(str(computer))" if you wanted
        to."""
        print "Computer Statistics: --------------------------------"
        print "Name:" + self.name
        print "IP:" + self.ip
        print "ScreenSize:" , self.resolution //cannot concatenate 'str' and 'tuple' objects
        print "-----------------------------------------------------" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T16:44:22.493

Python 中的构造函数称为`__init__`. 您还必须使用“self”作为类中所有方法的第一个参数，并使用它来设置类中的实例变量。

```
class Computer:

    def __init__(self, compName = "Computer1", compIp = "0.0.0.0", compScreenSize = 22):
        self.name = compName
        self.ip = compIp
        self.screenSize = compScreenSize

        self.printStats()

    def printStats(self):
        print "Computer Statistics: --------------------------------"
        print "Name:", self.name
        print "IP:", self.ip
        print "ScreenSize:", self.screenSize
        print "-----------------------------------------------------"

comp1 = Computer()
comp2 = Computer("The best computer in the world", "27.1.0.128",22) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-23T17:31:44.097

老兄给自己买一本python书。潜入 Python 非常好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T16:46:08.260

首先，看[这里](http://docs.python.org/tutorial/classes.html#class-objects)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-23T16:48:45.650

有几点需要指出：

1.  Python 中的所有实例方法都有一个显式的 self 参数。
2.  构造函数被调用`__init__`。
3.  您不能重载方法。您可以通过使用默认方法参数来实现类似的效果。

**C++：**

```
class comp  {
  std::string m_name;
  foo(std::string name);
};

foo::foo(std::string name) : m_name(name) {} 
```

**Python：**

```
class comp:
  def __init__(self, name=None):
    if name: self.name = name
    else: self.name = 'defaultName' 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-23T16:46:02.253

那不是有效的python。

Python 类的构造函数是`def __init__(self, ...):`，你不能重载它。

您可以做的是使用参数的默认值，例如。

```
class Computer:
    def __init__(self, compName="Computer1", compIp="0.0.0.0", compScreenSize=17):
        self.name = compName
        self.ip = compIp
        self.screenSize = compScreenSize

        self.printStats()

        return

    def printStats(self):
        print "Computer Statistics: --------------------------------"
        print "Name      : %s" % self.name
        print "IP        : %s" % self.ip
        print "ScreenSize: %s" % self.screenSize
        print "-----------------------------------------------------"
        return

comp1 = Computer()
comp2 = Computer("The best computer in the world", "27.1.0.128",22) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-23T16:49:23.247

啊，这些是新 Python 开发人员的常见问题。

首先，应该调用构造函数：

```
__init__() 
```

您的第二个问题是忘记将 self 参数包含到您的类方法中。

此外，当您定义第二个构造函数时，您将替换 Computer() 方法的定义。Python 是非常动态的，它会很高兴地让你重新定义类方法。

如果您不想使参数成为必需，则更 Pythonic 的方法可能是使用参数的默认值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T16:11:29.047

Python 不支持函数重载。

# .net - 长时间保持数据库连接打开是否安全

> ID：312702
> 
> 赞同：38
> 
> 时间：2008-11-23T16:46:49.397
> 
> 标签：.net, database, database-connection

我有一个连接到远程数据库的 .net 客户端应用程序。在客户端的生命周期（小时）内保持单个连接打开是否安全？

如果我有多个（10 或 100 个）客户端运行，答案是否成立？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-23T17:01:55.967

这样做绝对安全。这就是客户端-服务器应用程序的工作方式。如果您使用的是三层应用程序，则应用程序服务器将保持连接池处于打开状态。

可扩展性是一个问题，或者至少曾经是机器内存比现代套件少的时代。对于两层（客户端-服务器）应用程序，每个客户端都打开一个连接并保持打开状态。这有几个影响：

*   每个连接都使用内存，因此大量（相对）空闲连接会耗尽机器内存。但是，现代的 64 位服务器可以拥有数十或数百 GB 的内存，因此它可以支持非常大量的此类连接。

*   如果客户端计算机上未提交事务，则只要事务打开，锁就会保持打开状态。这导致了一类问题，当有人可以开始交易，去吃午饭并忘记他们留下了一些东西时。这将一次将事务引用的任何记录锁定几个小时。

*   然而，事务可以很容易地覆盖对数据库的多个访问，这对于连接池来说更难做到。

池化架构（在 3 层架构中很常见）在应用程序服务器和数据库之间具有有限数量的连接。查询只需使用下一个可用连接并立即提交更新。这使用更少的资源，因为您只打开了有限数量的连接，并且（结合[乐观并发](https://stackoverflow.com/questions/129329/optimistic-vs-pessimistic-locking#129397)策略）将消除大量潜在的应用程序并发问题。

为了使用[长事务](http://en.wikipedia.org/wiki/Long-running_transaction)（即覆盖对数据库的多次调用的事务），必须将事务与连接分离。这是 TP 监视器的基本架构，并且有一些标准协议（例如[XA](http://www.opengroup.org/publications/catalog/c193.htm)或[OLE 事务](http://msdn.microsoft.com/en-us/library/cc229116%28PROT.10%29.aspx)）来支持这一点。如果这种类型的外部管理事务不可用，则应用程序必须构造一个[补偿事务](http://en.wikipedia.org/wiki/Compensating_transaction)，以撤消应用程序事务所做的更改。[工作流管理系统](http://en.wikipedia.org/wiki/Workflow_application)经常使用这种类型的架构。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-23T17:45:46.690

**根据业务操作打开和关闭您的连接**

如果您正在谈论客户端/服务器应用程序，我建议您在使用完每个连接后立即关闭它。虽然每个单独的应用程序实例可能会在打开连接时对性能造成*很小的影响，但您的应用程序作为一个整体将可以更好地扩展。*这在一定程度上取决于您使用的数据库服务器。SQL Server 将根据安装的硬件处理不同数量的并发连接。如果您想将客户端/服务器应用程序扩展到数千个桌面，小型数据库服务器可能无法处理所有打开连接的桌面，但可以很好地处理仅打开部分连接的数千个桌面。

几年前我亲眼目睹了这一点。一个部署到几个部门的应用程序没有出现任何问题，然后在整个组织中部署。应用程序很快非常非常慢。该组织正在考虑为他们的数据库服务器购买一块非常昂贵的硬件来获得一些性能。我建议他们在每次业务操作后打开和关闭数据库连接。幸运的是，他们已经构建了应用程序，因此这不是一个困难的更改。他们在每周一次的网络更新中进行了更改并推出了它。一夜之间，应用程序性能显着提高。他们节省了数千美元。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-23T17:40:16.170

长期联系的困难在于您可能无法完全确定它们是否仍然存在。网络故障、服务器重新启动或有状态防火墙忘记其某些状态都可能导致“陈旧”的连接看起来是打开的，但当您尝试使用它时会出现错误。

连接池方案通常通过让一些系统偶尔检查池中的连接是否健康，或者在超时之后丢弃未使用的连接来解决这个问题。

一般来说，在分布式系统中，您需要围绕各种故障进行编码，保持长期连接打开会使这变得更加困难 - 但如果您愿意这样做，那就太好了。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-23T19:29:10.367

虽然具体细节通常很重要，但长时间保持连接打开并没有错。

如果您的应用程序是连接池 - 池中的连接槽通常保持连接，直到需要它们。

在基于连接的许可模型之外，现在非常罕见，维护连接本身消耗的资源可以忽略不计。

通过 TCP 运行的 SQLServer 客户端每隔 30 秒发送一次保活。（Keepalive 本质上是 0 len TCP 数据包）*通常*认为是可忽略的流量。

如果您在带宽非常少或 WLAN 链接不可靠的环境中运行，则增加 TCP 保持活动间隔可能有助于提高长时间连接保持活动状态的机会并减少线路上的“空闲聊天”数量。

您会或不想使用连接池是有原因的。

反对使用池：

消除环境污染的可能性 - 其他查询设置可能干扰查询执行的特殊环境选项（xact_abort，事务隔离级别..等）

如果配置/许可的连接限制有效，则应用程序中的空闲连接是其他应用程序无法使用的连接。

反对每次连接：

连接设置（尤其是安全连接设置）需要在客户端和服务器之间进行多次额外的往返——往返往往是 WAN 应用程序的性能杀手。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-23T17:40:22.973

它确实取决于您拥有打开连接的客户端数量以及您是否使用任何类型的连接池。

如果您是三层系统并且您的中间层启用了连接池，则客户端设置不适用。如果您不使用中间层，那么如果您担心与服务器的连接数量，那么现在是考虑它的时候了，因为这个中间层将帮助您更好地管理它。

每个打开的连接都会占用服务器上一定数量的内存并增加一些开销。给定一个两层系统，其中客户端直接与服务器通信，那么您需要查看服务器的规格和客户端数量，看看是否值得保持连接打开。如果您是一个两层系统并且您有数千个活动客户端，那么您可能不想让它们全部打开......如果您是一个两层系统并且只有几十个客户端，那么让它们保持打开.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-23T16:51:32.087

一般来说，您不应该像这样保持连接打开。.NET 有一个 ADO.NET 连接池系统，它完全可以满足您的要求，并且做得更好。;-)

更新：我是一个'tard。被动地发布。不适用于这里。

-Oisin

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-23T16:52:00.213

当然。当您长时间保持事务打开时（在某些隔离级别），您确实只会遇到问题。

有一个许可的连接限制，并且连接确实会占用服务器上的内存，所以越少越好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-23T17:32:41.130

这是安全的。这几乎就是池的作用......在程序运行期间保持连接打开并将其用于不同的查询。

但是您可能需要注意数据库连接超时。连接将失效，您将开始收到奇怪的错误。将数据库中的超时值设置为一个非常大的值，或者通过偶尔的虚拟查询保持连接。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-23T17:01:16.997

取决于数据库以及您正在使用它做什么。大多数情况下，打开和关闭任何连接都会产生费用。例如，如果您在移动设备（SQL Server Compact Edition）上使用 SQLCE，那么实际上推荐的方法是在设备上保持连接打开，因为打开和关闭连接的费用不值得麻烦。

现在相比之下，如果您正在使用多用户数据库，您将需要更仔细地管理这些连接。如前所述，ADO.Net 连接池在帮助您管理效率方面做得很好。

# platform-builder - 在 Platform Builder DAT 文件中使用 #include 指令

> ID：312708
> 
> 赞同：1
> 
> 时间：2008-11-23T16:53:14.393
> 
> 标签：platform-builder

所以我知道我可以在 BIB 和 REG 文件中使用#include 来提取其他文件，如下所示：

```
#include $(_PLATFORMROOT)\MYPLATFORM\FILES\MYBIB.BIB 
```

但似乎我无法让 DAT 文件以相同的方式运行。我在这里错过了什么吗？我有一个具有相当大的 DAT 文件的组件，我不希望用户被迫将整个内容粘贴到他们的 PROJECT.DAT 文件中，而是有一个简单的单行包含将其拉入。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T19:30:54.977

从进一步的测试和其他使用 Platform Builder 的开发人员的反馈来看，这确实是 SYSGEN 过程的一个限制。DAT 文件解析器根本不支持#include 指令。建议使用一些技巧来获得类似的行为，我认为“最好的”方法是使用 PostFmergeObj.bat 文件附加 DAT 内容，然后将 2 个文件放在客户的 BSP\FILES 文件夹中（批处理文件PostFmergeObj.bat 和附加到其平台的 INITOBJ.DAT 文件的 DAT 文件）。[此处概述了](http://guruce.com/blogpost/filteringdatfiles)一种类似的技术，用于从 DAT 文件中过滤片段。

希望 PB 的下一个版本会有更好的 DAT 解析器。

# jquery - jQuery $(document).ready 和 ASP.NET MVC 部分

> ID：312718
> 
> 赞同：7
> 
> 时间：2008-11-23T17:01:46.607
> 
> 标签：jquery, asp.net-mvc

我的应用程序中有很多部分，其中一些需要在 $(document).ready 时做一些 jQuery 优点。

问题是，如果我将 $(document).ready 直接放入部分的脚本块中，那么如果另一个部分做同样的事情，这将被覆盖。

这似乎是一个解决方案，需要收集各种 $(document).ready 花絮，然后将其包含在单个 $(document).ready 实例中。

是否已经有明确的方法来做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-23T17:03:10.800

好吧，只是普通的老没关系！

[http://www.learningjquery.com/2006/09/multiple-document-ready](http://www.learningjquery.com/2006/09/multiple-document-ready)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-23T20:32:26.950

做这样的事情有什么问题吗：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<Myapp...SearchResultsViewModel>" %>

<script type="text/javascript">
    $(document).ready(function () {
        alert('partial is ready.');
    });
</script>

<h1>This is my <%: Model.name %> partial view</h1> 
```

# c# - 找出给定长度的所有可能单词的好方法是什么

> ID：312732
> 
> 赞同：7
> 
> 时间：2008-11-23T17:18:40.177
> 
> 标签：c#, string, algorithm, iterator

我正在尝试在 C# 中创建一个生成以下输出字符串的算法：

```
AAAA
AAAB
AAAC
...and so on...
ZZZX
ZZZY
ZZZZ 
```

实现这一目标的最佳方法是什么？

```
public static IEnumerable<string> GetWords()
{
    //Perform algorithm
    yield return word;
} 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-23T17:22:57.093

好吧，如果长度是常数 4，那么这将处理它：

```
public static IEnumerable<String> GetWords()
{
    for (Char c1 = 'A'; c1 <= 'Z'; c1++)
    {
        for (Char c2 = 'A'; c2 <= 'Z'; c2++)
        {
            for (Char c3 = 'A'; c3 <= 'Z'; c3++)
            {
                for (Char c4 = 'A'; c4 <= 'Z'; c4++)
                {
                    yield return "" + c1 + c2 + c3 + c4;
                }
            }
        }
    }
} 
```

如果长度是一个参数，这个递归解决方案将处理它：

```
public static IEnumerable<String> GetWords(Int32 length)
{
    if (length <= 0)
        yield break;

    for (Char c = 'A'; c <= 'Z'; c++)
    {
        if (length > 1)
        {
            foreach (String restWord in GetWords(length - 1))
                yield return c + restWord;
        }
        else
            yield return "" + c;
    }
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-23T17:50:17.833

总是有强制性的 LINQ 实现。很可能是垃圾性能，但是从什么时候开始性能阻碍了使用很酷的新功能？

```
var letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray();

var sequence = from one in letters
               from two in letters
               from three in letters
               from four in letters
               orderby one, two, three, four
               select new string(new[] { one, two, three, four }); 
```

'sequence' 现在将是一个包含 AAAA 到 ZZZZ 的 IQueryable。

编辑：

好的，所以让我感到困扰的是，应该可以使用 LINQ 使用可配置的字母表制作可配置长度的序列。所以就在这里。再次，完全没有意义，但它困扰着我。

```
public void Nonsense()
{
    var letters = new[]{"A","B","C","D","E","F",
                        "G","H","I","J","K","L",
                        "M","N","O","P","Q","R","S",
                        "T","U","V","W","X","Y","Z"};

    foreach (var val in Sequence(letters, 4))
        Console.WriteLine(val);
}

private IQueryable<string> Sequence(string[] alphabet, int size)
{
    // create the first level
    var sequence = alphabet.AsQueryable();

    // add each subsequent level
    for (var i = 1; i < size; i++)
        sequence = AddLevel(sequence, alphabet);

    return from value in sequence
           orderby value
           select value;
}

private IQueryable<string> AddLevel(IQueryable<string> current, string[] characters)
{
    return from one in current
           from character in characters
           select one + character;
} 
```

对 Sequence 方法的调用会生成与以前相同的 AAAA 到 ZZZZ 列表，但现在您可以更改使用的字典以及生成的单词的长度。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-25T01:45:40.167

只是对 Garry Shutler 的评论，但我想要代码着色：

你真的不需要让它 IQuaryable，也不需要排序，所以你可以删除第二种方法。向前迈出的一步是使用 Aggregate 作为叉积，它最终是这样的：

```
IEnumerable<string> letters = new[]{
                "A","B","C","D","E","F",                       
                "G","H","I","J","K","L",
                "M","N","O","P","Q","R","S",           
                "T","U","V","W","X","Y","Z"};

var result = Enumerable.Range(0, 4)
                .Aggregate(letters, (curr, i) => curr.SelectMany(s => letters, (s, c) => s + c));

foreach (var val in result)
     Console.WriteLine(val); 
```

安德斯应该因为 Linq 的事情获得诺贝尔奖！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-24T03:14:38.193

GNU 重击！

```
{a..z}{a..z}{a..z}{a..z} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T18:56:29.463

受到 Garry Shutler 回答的启发，我决定用 T-SQL 重新编码他的回答。

假设“Letters”是一个只有一个字段 MyChar 和 CHAR(1) 的表。它有 26 行，每行一个字母。所以我们有（您可以在 SQL Server 上复制粘贴此代码并按原样运行以查看它的实际效果）：

```
DECLARE @Letters TABLE (
    MyChar CHAR(1) PRIMARY KEY
)
DECLARE @N INT
SET @N=0
WHILE @N<26 BEGIN
    INSERT @Letters (MyChar) VALUES ( CHAR( @N + 65) )
    SET @N = @N + 1
END
-- SELECT * FROM @Letters ORDER BY 1

SELECT A.MyChar, B.MyChar, C.MyChar, D.MyChar
FROM @Letters A, Letters B, Letters C, Letters D
ORDER BY 1,2,3,4 
```

优点是：它很容易扩展到使用大写/小写，或使用非英语拉丁字符（想想“Ñ”或 cedille、eszets 等），你仍然会得到一个有序的集合，只需要添加一个排序规则. 此外，SQL Server 在单核机器上的执行速度将比 LINQ 稍快，在多核（或多处理器）上，执行可以并行执行，从而获得更大的提升。

不幸的是，它被困在 4 个字母的特定情况下。lassevk 的递归解决方案更通用，尝试在 T-SQL 中进行通用解决方案必然意味着动态 SQL 及其所有危险。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-24T01:58:53.933

Python！

（这只是一个 hack，不要把我当回事 :-)

```
# Convert a number to the base 26 using [A-Z] as the cyphers
def itoa26(n): 
   array = [] 
   while n: 
      lowestDigit = n % 26
      array.append(chr(lowestDigit + ord('A'))) 
      n /= 26 
   array.reverse() 
   return ''.join(array)

def generateSequences(nChars):
   for n in xrange(26**nChars):
      string = itoa26(n)
      yield 'A'*(nChars - len(string)) + string

for string in generateSequences(3):
   print string 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-24T02:43:47.850

哈斯克尔！

```
replicateM 4 ['A'..'Z'] 
```

红宝石！

```
('A'*4..'Z'*4).to_a 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-25T14:34:32.080

这是 C# 中相同函数的递归版本：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.IO;

namespace ConsoleApplication1Test
{
    class Program
    {
        static char[] my_func( char[] my_chars, int level)
        {
            if (level > 1)
                my_func(my_chars, level - 1);
            my_chars[(my_chars.Length - level)]++;
            if (my_chars[(my_chars.Length - level)] == ('Z' + 1))
            {
                my_chars[(my_chars.Length - level)] = 'A';
                return my_chars;
            }
            else
            {
                Console.Out.WriteLine(my_chars);
                return my_func(my_chars, level);
            }
        }
        static void Main(string[] args)
        {
            char[] text = { 'A', 'A', 'A', 'A' };
            my_func(text,text.Length);
            Console.ReadKey();
        }
    }
} 
```

从 AAAA 打印到 ZZZZ

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-05T00:26:50.277

更简单的 Python！

```
def getWords(length=3):
    if length == 0: raise StopIteration
    for letter in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ':
        if length == 1: yield letter
        else:
            for partialWord in getWords(length-1):
                yield letter+partialWord 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-23T19:46:06.120

javascript！

```
var chars = 4, abc = "ABCDEFGHIJKLMNOPQRSTUVWXYZ", top = 1, fact = [];
for (i = 0; i < chars; i++) { fact.unshift(top); top *= abc.length; }
for (i = 0; i < top; i++)
{
    for (j = 0; j < chars; j++) 
        document.write(abc[Math.floor(i/fact[j]) % abc.length]);
    document.write("<br \>\n");
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-25T01:48:58.367

使用自动谷歌搜索每个字母组合的东西，然后查看是否有更多的“.sz”或“.af”点击然后“.com”点击五个第一个结果......;）

说真的，您正在寻找的可能是尝试（数据结构），尽管您仍然需要*填充*可能更难的东西......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-07-31T11:11:54.020

一个非常简单但很棒的代码，可以生成所有 3 个和 4 个英文字母的单词

```
#include <iostream>
using namespace std;
char alpha[26]={'a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'}
int main() {
int num;
cin >> num;
if (num == 3) { //all 3 letter words
    for (int i = 0; i <= 25; i++) {
        for (int o = 0; o <= 25; o++) {
            for (int p = 0; p <= 25; p++) {
                cout << alpha[i] << alpha[o] << alpha[p] << " ";
            }
        }
    }
}
else if (num == 4) { //all 4 letter words
    for (int i = 0; i <= 25; i++) {
        for (int o = 0; o <= 25; o++) {
            for (int p = 0; p <= 25; p++) {
                for (int q = 0; q <= 25; q++) {
                    cout << alpha[i] << alpha[o] << alpha[p] << alpha[q] << " ";
                }
            }
        }
    }
}
else {
    cout << "Not more than 4"; //it will take more than 2 hours for generating all 5 letter words
  }
} 
```

# c# - DropdownList.selectedIndex 始终为 0（是的，我确实有！isPostBack）

> ID：312735
> 
> 赞同：5
> 
> 时间：2008-11-23T17:21:11.763
> 
> 标签：c#, asp.net, drop-down-menu, postback

**（向下滚动到帖子底部以找到解决方案。）**

得到一个包含 Datalist 的 asp.net 页面。在这个数据列表中，有一个包含下拉列表的模板，每次数据列表填充一个项目时，都会调用一个 ItemCreatedCommand。itemCreatedCommand 负责对下拉列表进行数据绑定。

我认为问题出在此处，我正在使用 ItemCreatedCommand 来填充它 - 但奇怪的是，如果我选择“绿色”颜色，页面将自动回发，我会看到下拉菜单仍然是绿色，但是当尝试使用它的 SelectedIndex 时，我总是得到 0...

```
protected void DataListProducts_ItemCreatedCommand(object
    source, DataListItemEventArgs e)

 var itemId = (String)DataListProducts.DataKeys[e.Item.ItemIndex];
 var item = itemBLL.GetFullItem(itemId); 

 var DropDownListColor = (DropDownList)e.Item.FindControl("DropDownListColor");

 //Also tried with :
 //if(!isPostBack) {

 DropDownListColor.DataSource = item.ColorList;
 DropDownList.Color.Databind();

 // } End !isPostBack)

    Label1.test = DropDownListColor.SelectedIndex.toString();
 // <- THIS IS ALWAYS 0! *grr* 
```

我已经缩小了查看代码的范围，但您仍然可以看到我正在尝试做的事情:) 我这样做的原因，而不是直接在 aspx-page 上声明颜色的数据源，是我需要运行一个测试 if(showColors)，但我不想用我认为应该在代码隐藏文件中的代码弄乱 html 页面。

编辑：在尝试更改 SelectedIndexChange 之后 - 我现在脑子里有一个“逻辑”混乱 - 我如何更改数据列表中的元素？因为，据我所知 - 我没有任何方法可以检查这个特定下拉列表属于数据列表中的哪些项目......或者？我将尝试几种方法，看看我最终会得到什么;）但是请发表你对这个问题的想法：）

**解决方案：**

要么将事件冒泡到 ItemCommand，要么处理事件，获取发送者父级（这是一个 datalistItem 并在其中操作元素。

```
 protected void DropDownListColor_SelectedIndexChanged(object sender, EventArgs e)
        {
            DropDownList dropDownListColor = (DropDownList)sender;
            DataListItem dataListItem = (DataListItem)dropDownListColor.Parent;

            var item = items[dataListItem.ItemIndex];
            var color = item.ItemColor[dropDownListColor.SelectedIndex];

            var LabelPrice = (Label)dataListItem.FindControl("LabelPrice");
            LabelPrice.Text = color.Price; 
        } 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-23T17:28:09.097

当DataList 绑定数据时，AutoPostBack 尚未处理，即ItemCreated 事件中的值仍然是原始值。

您需要处理下拉控件的 SelectedIndexChange 事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T19:10:11.137

关于你的第二个问题：

我建议您从下拉列表中删除 AutoPostBack，添加一个“更新”按钮，并在按钮 Click 事件中更新数据。

该按钮可以保存 Command 和 CommandArgument 值，因此很容易与数据库记录关联。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T21:31:12.710

一些 MSDN 链接与 C# 冒泡示例

[http://msdn.microsoft.com/en-us/library/system.web.ui.control.onbubbleevent.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.control.onbubbleevent.aspx)

[http://msdn.microsoft.com/en-us/library/aa719644(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa719644(VS.71).aspx)

[http://msdn.microsoft.com/en-us/library/aa720044(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa720044(VS.71).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-11T11:04:32.023

谢谢你的解决方案

```
 protected void ddlOnSelectedIndexChanged(object sender, EventArgs e) {
     try {
         ModalPopupExtender1.Show();
         if (ViewState["Colors"] != null) {
             FillColors(ViewState["Colors"].ToString());
         }

         DropDownList dropDownListColor = (DropDownList)sender;
         DataListItem dataListItem = (DataListItem)dropDownListColor.Parent;

         Image image = (Image)dataListItem.FindControl("mdlImage");
         Label ProductCode = (Label)dataListItem.FindControl("lblprdCode");
         Label ProductName = (Label)dataListItem.FindControl("lblProdName");
         DropDownList ddlQuantity = (DropDownList)dataListItem.FindControl("ddlQuantity");
         Label ProductPrice = (Label)dataListItem.FindControl("lblProdPrice");
         Label TotalPrice = (Label)dataListItem.FindControl("lblTotPrice");
         //Label ProductPrice = (Label)dataListItem.FindControl("lblProdPrice");
     } catch (Exception ex) {

     }
 } 
```

# c++ - 为对容器的第一个元素提供迭代器

> ID：312749
> 
> 赞同：9
> 
> 时间：2008-11-23T17:35:38.393
> 
> 标签：c++, generics, templates, stl

我有一个装满成对的容器。我想使用 STL 通用算法对其进行迭代（在我的情况下，它将是 inner_product，但将其视为一个通用问题）。我使用的算法首先和最后需要迭代器。我可以提供特殊的迭代器 first 和 last 不会在对上而是在每对的第一个元素上进行迭代？

我知道我可以手动完成，提供一个手工制作的函数对象，它将是标准容器迭代器的包装器，将它尊重到该对本身的第一个成员意图，但我认为还有一个聪明的-liner 为我做这件事。那会是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-23T17:59:52.480

我环顾四周，发现`boost::transform_iterator`。我想出了这段代码。令人惊讶的是它的效果如何：

```
#include <map>
#include <algorithm>
#include <iostream>
#include <string>
#include <iterator>
#include <boost/iterator/transform_iterator.hpp>
#include <boost/bind.hpp>
#include <boost/function.hpp>

int main() {
    typedef std::map<std::string, int>::value_type value_type;
    std::map<std::string, int> a;
    a["one"] = 1;
    a["two"] = 2;

    // returns the second element 
    boost::function<int(value_type&)> f = boost::bind(&value_type::second, _1);
    std::copy(boost::make_transform_iterator(a.begin(), f), 
              boost::make_transform_iterator(a.end(), f),
              std::ostream_iterator<int>(std::cout, " "));

} 
```

它正在打印`"1 2 "`到标准输出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T17:40:42.427

您可以自己继承例如 std::vector::const_iterator ，重新实现 operator* 和 operator-> 以返回该对中的第一个。您还需要创建自己的 begin() 和 end() 函数来返回您的自定义迭代器。

您还可以创建二进制函数类并将其传递给 inner_product。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T17:51:43.760

没有聪明的单线解决方案。您最大的希望是编写一个包装迭代器。这实际上是一个非常规范的解决方案。您可能会检查 Boost 是否已经拥有您需要的东西。如果没有，请尝试编写一个通用的包装器，它可以用于其他问题。

STL 包含这样一个迭代器包装器，称为`reverse_iterator`. 这个名字暗示了它的用途。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T18:00:57.377

最终，我认为你的想法是要走的路。您可以使用 Boost 来帮助您做到这一点。首先，您需要一个函数来获取您的配对并返回第一个元素。我认为您可以使用[Lambda library](http://www.boost.org/doc/libs/1_37_0/doc/html/lambda.html)内联编写这样的函数，但为了便于阅读，我想我只需要编写一个简单的函数来代替。然后将该函数与您的原始迭代器一起传递，[`transform_iterator`](http://www.boost.org/doc/libs/1_37_0/libs/iterator/doc/transform_iterator.html)为您的序列的开始和结束构造一个。

# visual-studio - 在 Visual C++ 2008 (9.0) 中更改 ncb 文件的位置

> ID：312759
> 
> 赞同：0
> 
> 时间：2008-11-23T17:48:17.713
> 
> 标签：visual-studio, visual-c++

我已经调整了 VC++ 设置，以便我所有的实际代码都将转到一个地方，而编译器生成的二进制文件将转到另一个地方。这个 ncb 文件是个例外。它是一个相当大的 IDE 生成的二进制文件（Intellisense 数据库）。除了解决方案文件夹之外，我似乎无法将其移动到任何地方。我在谷歌上重新搜索过，发现一些参考资料说这是不可能的。有人有解决方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T22:04:49.943

Visual Studio 不允许您移动该文件。 [CodeProject 上的这篇文章展示了一个人如何通过创建](http://69.10.233.10/KB/cpp/Symbolic_Links_for_Apps.aspx)[符号链接](http://en.wikipedia.org/wiki/Symbolic_link)的“穷人”版本来解决这个问题。这涉及挂钩 Windows 的[`CreateFile`](http://msdn.microsoft.com/en-us/library/aa363858%28VS.85%29.aspx)功能。这种方法对我来说似乎有点矫枉过正。如果可能的话，我想我会学会忍受这个限制。

# c# - 连接到 SQL Server 的 winforms 的理想设计。

> ID：312762
> 
> 赞同：1
> 
> 时间：2008-11-23T17:50:50.300
> 
> 标签：c#, sql-server, winforms

我有一个执行以下操作的 winforms 应用程序：

在每个查询上：

1.  数据库连接
2.  数据库查询
3.  数据库断开连接

因为我们试图避免必须保持数据库连接打开。这会影响性能，因为我们每次都必须连接/断开连接。

这里的理想化模型是什么，它具有最快的性能，但没有打开连接太久。这里有最佳实践吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T18:02:31.163

最有效的方法是连接池，只要您确保关闭连接， [ADO.NET 就会自动为您执行此操作。](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)`SqlConnection`只需将您的对象包装成`using`语句，您就不必担心它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T18:36:39.503

使用连接池连接/断开连接的开销*非常小。*您的瓶颈绝对是数据库查询本身，因此打开全局连接无济于事。

如果您的查询太慢，请尝试优化它们。如果这不起作用，您将查看缓存、异步提取或非规范化。我真的没有想到保持数据库连接的一般用例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T18:13:28.303

也许尝试考虑缓存您的数据？我自己的粗略测试表明，在内存数据中查询比从数据库中查询相同数据快 20 倍。尽管这种方法可能不适合您的架构或数据需求，但如果可以的话，总是值得考虑在某处缓存经常访问的数据。

# java - 如何在 maven2 中跟踪插件依赖项？

> ID：312767
> 
> 赞同：24
> 
> 时间：2008-11-23T17:59:53.527
> 
> 标签：java, maven-2, maven-plugin

我试图找到一个包含某个 jar 文件的石器版本的邪恶插件。我怎么做 ？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2011-08-31T18:11:14.323

`mvn dependency:resolve-plugins`给出每个插件的依赖列表

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-24T04:26:55.757

另外， mvn -X 会吐出各种信息，我相信它包括依赖版本。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-11-24T17:34:04.263

`mvn dependency:tree`- 显示所有依赖关系的树，包括传递依赖关系

# iphone - 非 3G iPhone 的三角 GPS 精度如何？

> ID：312775
> 
> 赞同：3
> 
> 时间：2008-11-23T18:07:07.520
> 
> 标签：iphone, cocoa-touch, gps, gis

有人对非 3G iPhone 使用的三角 GPS 有任何经验吗？与3G定位相比如何？如果没有可用的 GPS 信号，iPhone 3G 是否使用三角测量？无论如何确定非3G坐标的准确性吗？谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-23T18:24:06.567

我已经用一堆不同的设备（包括 3G iphone 和 3G 黑莓）做了很多移动软件，这就是我发现的。

当您有清晰的视线并且至少有 9 颗卫星存在时，黑莓和 iPhone GPS 非常好。在一些人口密集的住宅区或城市地区，您可能只能获得 5-6 颗卫星，这可能需要一段时间才能收敛。

如果您没有信号，像 iPhone 这样的 GSM 手机会尝试使用信号塔的信号强度找到您的位置，但它不如 GPS 准确......不是很远。

我听说过，虽然这还没有得到证实，但 iPhone 在找不到 GPS 锁定时也会使用一些服务器端机器学习，这意味着它需要平均所有手机信号塔，加上所有拥有 GPS 的用户的平均值使用您所在地区的 GPS 来尝试找到您的最佳位置。这有时称为 AGPS 或辅助 GPS，其中 GPS 信息和手机信号塔强度一起使用。

此外，我唯一能想到的要找到非 3G 坐标的准确性，就是在代码中以编程方式切换提供程序，或者只是进入首选项并关闭 3G 并编写一个执行一些测试的应用程序。

Pragmatic Programmers 有一本很棒的[iPhone SDK 书籍](http://pragprog.com/titles/amiphd/iphone-sdk-development)，其中刚刚添加了关于使用 Location API 的一章，因此这可能是一个很好的起点。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T19:05:52.597

CLLocation 类具有属性“horizo​​ntalAccuracy”（用于纬度/经度）和“verticalAccuracy”（用于海拔）。

除了手机信号塔和 GPS，位置也可以由 Skyhook Wireless 确定，它有一个 Wi-Fi 基站 MAC 地址和位置的数据库。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-23T19:10:01.793

仅使用 GSM 塔时，为 +/- 500m（变化很大，有时更精确）。

如果它找到已知的 Wi-Fi 网络，那么它会下降到 +/- 50m。

# .net - 带有 Episerver 的 TDD

> ID：312776
> 
> 赞同：6
> 
> 时间：2008-11-23T18:08:08.547
> 
> 标签：.net, tdd, episerver

抽象表服务器基础架构以简化测试的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-28T13:51:14.750

我最近[用 EPiServer 写了一篇关于 TDD 的文章](http://marekblotny.blogspot.com/2009/03/tdd-with-episerver.html)。

基本上，这个想法是使用 Model-View-Presenter 设计模式将尽可能多的逻辑与 asp.net 运行时隔离开来。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T20:29:58.433

也许这篇文章会有所帮助：[EPiServer CMS 5 R2 and unit testing](http://labs.episerver.com/en/Blogs/Cristian-Libardo/Dates/2008/10/R2-and-unit-testing/)

# c# - SqlCommandBuilder 使用表名而不是视图

> ID：312777
> 
> 赞同：1
> 
> 时间：2008-11-23T18:09:02.337
> 
> 标签：c#, ado.net, sqlcommandbuilder

我正在使用 SqlCommandBuilder 对象从 SqlDataAdapter 中的 Select 语句生成更新语句。

我的问题是，在我的 Select 语句中，我从一个名为 vwUsers 的视图中进行选择。我使用的 SqlCommandBuilder 对象为表用户而不是视图 vwUsers 生成了更新语句。我怎样才能覆盖这种行为？

（我需要它来使用视图，因为这是执行触发器的地方。我们将触发器添加到表视图而不是原始表）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T13:25:11.847

我通过删除命令生成器并自己编写 SQL 更新命令解决了我的问题！

# c# - 屏保如何支持多台显示器？

> ID：312783
> 
> 赞同：1
> 
> 时间：2008-11-23T18:12:50.427
> 
> 标签：c#, multiple-monitors, screensaver

如果我在 C# 中使用 windows.form 开发屏幕保护程序，我将如何支持多个显示器？显然我需要一种方法来枚举监视器，也许也为它们创建表单或者只是淡入黑色？有没有人解决这个问题？

任何见解都会有所帮助，最好的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T18:40:34.550

我会推荐[CodeProject 中的这篇文章，](http://www.codeproject.com/KB/cs/scrframework.aspx)它帮助我创建了我的第一个屏幕保护程序并讨论了多显示器支持。

`[System.Windows.Forms.Screen](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.aspx)`类有你需要的关于有多少监视器以及这些监视器的边界的所有信息。该物业`[AllScreens](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.allscreens.aspx)`将是一个很好的起点。

`for (int i = Screen.AllScreens.GetLowerBound(0); i <= Screen.AllScreens.GetUpperBound(0); i++)
{
ScreensaverFormList[i].Bounds = Screen.AllScreens[i].Bounds;
}` 

# java - 为什么在 Java 中使用类作为结构不好的做法？

> ID：312785
> 
> 赞同：14
> 
> 时间：2008-11-23T18:14:19.563
> 
> 标签：java, oop, class, struct

我们最近进行了一次代码审查。使用了我的一个类，以便我可以从/向方法返回/传递不止一种类型的数据。该类唯一的方法是 getters/setters 。团队的一位成员（我尊重他的意见）说，开设这样的课程是不好的做法（而且不是很 OOP）。这是为什么 ？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-23T18:25:14.067

有一种观点认为类应该是“数据结构”（即专注于存储没有功能的数据）或“面向功能”（即专注于执行某些操作同时存储最小状态）。如果您遵循该论点（这是有道理的，但并不总是那么容易做到），那么这并没有什么错。

事实上，有人会争辩说 bean 和实体 bean 本质上就是这样 - 带有 getter 和 setter 的数据容器。

我已经看到某些来源（例如，“干净代码”一书）认为应该避免使用具有多个参数的方法，而是将它们作为具有 getter 和 setter 的单个对象传递。这也更接近于顺序无关紧要的命名参数的“smalltalk 模型”。

所以我认为如果使用得当，你的设计是有意义的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T19:43:08.373

请注意，这里有两个单独的问题。

1.  “类结构”类是否明智？

2.  创建一个从方法返回多个值的类是否明智？

**类结构类**

一个对象类应该——在大多数情况下——代表一个真实世界的对象类。一个被动的、类似结构的 java bean（所有 getter 和 setter）*可能*代表真实世界的事物。

然而，大多数现实世界的事物都有规则、约束、行为和它们参与的基本动词。类似结构的类很少能很好地匹配现实世界的东西，它通常是一些技术性的东西。这使得它不是理想的 OO 设计。

**一个方法的多次返回**

虽然 Python 有这个，但 Java 没有。*多个返回值本身*不是 OO 问题。这是一个克服语言限制的问题。

多个返回值可能意味着对象已更改状态。也许一种方法会改变状态，而某些 getter 组会返回源自这种状态变化的值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-23T22:22:36.257

老实说，这对我来说听起来不错。审稿人提出了什么替代方案？

遵循 OOP“最佳实践”，一切都很好，但你必须务实并真正完成工作。

在某些情况下，使用这样的值对象（OO 代表“结构”）是一种完全合法的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T18:23:23.807

通常，您需要将操作类所需的知识隔离到类本身中。如果你有一个这样的类，要么它在多个地方使用，因此可以在这两个地方承担一些功能，或者它在一个地方，应该是一个内部类。如果它以多种方式使用，但以完全不同的方式使用，例如没有共享功能，将其作为单个类是误导性的，表明没有共享功能。

但是，这些一般规则可能适用也可能不适用通常有特定的原因，因此这取决于您的班级应该代表什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T18:30:51.107

我认为他可能会因为不好的做法而混淆“不是很 OOP”。我认为他希望您提供几种方法，每种方法都会返回所需的 1 个值（因为无论如何您都必须在新类中使用它们，这还不错）。

请注意，在这种情况下，您可能不应该使用 getter/setter，只需公开数据即可。不，这“不是很 OOP”，但它是正确的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T18:56:31.103

[也许 Josh Bloch在这里](http://java.sun.com/developer/Books/effectivejava/Chapter5.pdf)对此提供了一些见解。

# php - 从 FPDF 1.53 升级到 1.6——有什么问题吗？

> ID：312788
> 
> 赞同：0
> 
> 时间：2008-11-23T18:20:09.257
> 
> 标签：php, pdf, fpdf

我想大多数人已经知道，或者如果你不知道，[FPDF](http://www.fpdf.org/)在过去将近 4 年没有发布之后，于去年 8 月发布了一个新版本 1.6。我想知道是否有人在从 1.53 升级到 1.6 时遇到任何问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T19:05:18.573

我的脚本更新到 1.6 没有任何问题，新版本修复了我在 IE 上遇到的问题，所以我对这次更新很满意。

# c# - 应用程序的正确 .NET DLL 结构

> ID：312789
> 
> 赞同：1
> 
> 时间：2008-11-23T18:21:18.100
> 
> 标签：c#, .net, asp.net, architecture

...如果有这样的事情。这是在 .NET 应用程序中构建 DLL/引用的两种方法的图像：[http](http://www.experts-exchange.com/images/t80668/compArch.png) ://www.experts-exchange.com/images/t80668/compArch.png 。该应用程序可以是网站（在这种情况下）或 winform。每个框代表一个 DLL。对于 winform 应用程序，只需将“webcontrols”替换为“winformcomponents”即可。

第一个（顶部）图像是我喜欢的。您可能想要扩展“一些”基本 Web 控件并直接使用其他控件。第二张图片使您可以通过界面扩展任何 Web 控件。对我来说，这似乎有点矫枉过正，因为您可能只想简单地使用已经存在的东西而无需修改。哪个更好，有什么优点/缺点？

第一个图像将最低通用结构（异常、fileIO、常量等）放入 common.dll 中。第二张图片将应用程序业务逻辑和通用放入一个 DLL 中。哪个更好，每种方法的优点/缺点是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T19:19:01.180

拥有大量引用通常很糟糕，因为加载 DLL 的成本不可忽略。它可能没有那么优雅，但是更少的模块可以提高你的性能。在我们的工艺中，您必须在完全模块化的优雅与严酷的性能现实之间找到平衡。在我们的工艺中，像往常一样，在您开始分析以衡量应用程序的性能之前，您不会知道什么是平衡。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T19:06:43.470

我认为这真的取决于程序员的偏好。

这一切都归结为依赖关系。一个 DLL 中的更多内容意味着它自然会在该 DLL 上创建更多的依赖项。

由于以下原因，我个人倾向于遵循与 MS 结构类似的路线：

*   它使自定义“框架”的新手更容易找到他们想要的东西（例如`CompName.Web.UI`，`CompName.Data`.
*   它有助于减少对“明显”选择的依赖。我不太热衷于`CompName.Common`DLL 类型，因为它没有明确指出可能的依赖项，而`CompName.Web.UI`表明它可能被任何 Web 应用程序使用。
*   明显的大小减小，因为 DLL 内容将更加“相关”。

应用程序内层的 DLL 是有意义的，其中的类型应该只是业务模型所需的那些类型，其他对象（如实用程序、数据访问等）应该在它们自己的库中。

# apache-flex - Flash Builder 与 FlashDevelop 的优缺点是什么？

> ID：312792
> 
> 赞同：15
> 
> 时间：2008-11-23T18:23:48.470
> 
> 标签：apache-flex, flash, ide, flashdevelop

我想在应用程序开发中使用 FLASH。我正在为此寻找一个好的IDE。有人建议使用 Flash Develop。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-20T13:57:35.223

**闪存生成器**

*优点*

*   更好的调试和分析
*   MXML 的可视化设计器
*   因为 Eclipse：支持其他语言（例如，使用 Aptana、PDT...）以及使用 Eclipse 平台的插件以及 FlexBuilder 未附带的功能（带有 CFEclipse“动态片段”、“自动代码”的代码片段对于带有 Monkey 脚本的 getter/setter...)
*   支持虚拟文件夹/文件（指向由 Eclipse 处理的外部文件/文件夹的链接，因此也可以在 Windows 上工作）
*   重构（重命名类、函数、属性并自动更改依赖项）

*缺点*

*   商业许可证
*   大，因为 Eclipse 与 FlexBuilder 插件版本的较新 Eclipse 版本存在问题（例如，不适用于 Eclipse Ganymede 3.4.1）
*   使用 Eclipse 插件添加和配置缺少的功能需要时间并在 Internet 中搜索（哪个插件？设置等）
*   代码辅助只是平均的，有时是错误的，例如。如果缺少正确的导入（“java.lang.NullPointerException”）
*   缺少代码格式化程序或自动获取/设置程序（但有其他 Eclipse 插件的解决方案，如 Monkey Scripts、CFeclipse、Flexformatter "FlexPrettyPrintCommand"...）
*   如果 Eclipse 中的后台任务正在运行，有时会有点迟钝
*   没有包资源管理器
*   仅限 AS2 和 AS3 - 无 Haxe

**Flash开发**

*优点*

*   免费和开源（使用 C# 开发）
*   轻巧活泼
*   ActionScript 的最佳可用代码辅助
*   支持所有 Flash 语言 - AS2、AS3、haxe
*   用于自动 getter/setter、变量、事件处理程序代码的“自动代码”
*   带有集成片段编辑器的代码片段
*   可通过插件扩展
*   支持 asdoc 评论
*   包资源管理器（显示 SWC 文件中的类、符号）
*   基本重构
*   每个项目有多个源代码文件夹
*   [有用的插件](http://www.flashdevelop.org/wikidocs/index.php?title=3rd_Party_Plugins_FD4)：ANT 集成、SWC 创建、迷你地图、快速导航

*缺点*

*   仅适用于 Windows
*   没有 MXML 的可视化设计器
*   不支持项目内的虚拟文件夹/文件
*   弱重构
*   必须手动更改类路径
*   插件通常无法在较新的版本中运行，并且许多插件很少更新
*   对调试 Haxe 应用程序的有限支持

**常见的**

*优点*

*   适用于各种 Flash 应用程序的项目：网站、AIR（桌面、移动）
*   使用断点和单步调试 FP/AIR 应用程序
*   使用监视窗口和本地人进行调试
*   支持 ASDoc 注释
*   自动添加导入和组织导入
*   类向导
*   SVG/GIT 集成

缺点

*   无需编辑图形或动画（为此使用 Flash IDE）

**概括**

用于调试，MXML 表单的可视化设计：**Flash Builder**

用于在 Windows 下编写 AS2/AS3/Haxe 项目：**FlashDevelop**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T19:09:43.947

使用 FlexBuilder 的主要原因：有一个真正的调试器，您可以设置断点和单步并监视/编辑变量。

除非 FlashDevelop 已经 .. 开发了 .. 不要认为它有任何这些。

顺便说一句 - 如果您是学生/教师 FlexBuilder 可以*免费获得*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T14:12:35.417

Flex builder 具有 MXML 的设计视图，因此您可以更直观地构建。另一方面，Flashdevelop 是免费的！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-02T13:13:29.580

我一直在使用 Flash 开发人员。现在尝试 FlashDevelop。FlashDevelop 又快又轻，正因为如此，我正试图切换。

我正在使用 HG + TortoiseHG 进行源代码控制。我有 2 个屏幕，所以有外部源代码控制不是一个大问题。此外，由于没有所有小的源代码控制图标，IDE 也更加简洁。

[DesignView](http://www.adobe.com/cfusion/marketplace/index.cfm?event=marketplace.offering&offeringid=10299&marketplaceid=1)有助于没有集成设计。

此外，我可以使用 FlashDevelop 进行调试并查看变量。我正在使用 FD3.2.1。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-24T14:17:19.013

除了已经提到的，Flex Builder 有一些很好的工具可以帮助开发人员学习如何以**数据向导**的形式创建一个支持数据的 Flex 应用程序，还有一个很好的**Web 服务自省**工具，它可以自动创建一个 ActionScript 3 客户端。网络服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T07:25:48.640

我正在使用新的 Jetbrains IntelliJ 8，它很棒（特别是如果你习惯了 java 开发）。拥有比任何其他 IDE 更好的 XML/JavaScript 编辑器。

最新版本的 IntelliJ 也有一个很好的 flex/javascript 调试器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T21:11:03.070

下面是 FlashDevelop（使用 Flex 3 SDK）和 FlexBuilder 之间的两个客观对比。首先，只有 FlexBuilder 包含 AdvancedDataGrid。其次，FlashDevelop 没有源代码控制集成。

AdvancedDataGrid*不*包含在免费或开源的 Flex 3 SDK 中；如果你想要它，你必须购买 FlexBuilder。（我认为如果您拥有 FlexBuilder，可能可以通过另一个 SDK 使用它。）

FlashDevelop 没有任何源代码控制集成，FlexBuilder 拥有现有的、稳定的 Eclipse 源代码控制选项。这包括 SVN 的 Subclipse 以及许多其他东西。作为一名长期使用 Visual Studio 和 Emacs 的用户，在 FlashDevelop 中，我开始对离开编辑器进行签入感到不满意。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-05-17T14:18:09.947

Flash Builder，即使在 4.5 版中，也具有原始的、无用的语法着色和自定义功能。从一个 700 美元的套餐中，我至少期望我可以用我的免费文本编辑器做些什么。在语法着色首选项中，共有 6 个关键字，您不能添加任何自定义。我应该如何编写具有变量名、函数调用和类看起来完全相同的代码？我会坚持使用 Flash Pro CS5.5 和 SciTe。

# python - Python 等价于 Ruby 的延续

> ID：312794
> 
> 赞同：7
> 
> 时间：2008-11-23T18:25:01.103
> 
> 标签：python, ruby, continuations

Ruby 中以下代码的 Python 等价物是什么？

```
def loop
  cont=nil
  for i in 1..4
    puts i
    callcc {|continuation| cont=continuation} if i==2
  end
  return cont
end

> c=loop
1
2
3
4
> c.call
3
4 
```

参考：[轻量级开发成功的秘诀，第 9 部分：基于延续的框架](http://www-128.ibm.com/developerworks/java/library/os-lightweight9/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T18:33:09.463

您引用的文章包含指向“资源”部分中的[Continuations Made Simple And Illustrated](http://www.ps.uni-sb.de/~duchier/python/continuations.html)的链接，其中讨论了 Python 语言中的 continuation。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T18:31:52.930

看一下制作生成器的[yield](http://www.python.org/doc/2.6/reference/simple_stmts.html#the-yield-statement)语句。

我不会说任何红宝石，但看起来你正在寻找这个：

```
def loop():
    for i in xrange(1,5):
        print i
        if i == 2:
            yield

for i in loop():
    print "pass" 
```

编辑：我意识到这基本上是真正延续的专业化，但对于大多数目的来说应该足够了。用于`yield`返回继续和`.next()`生成器上的消息（仅通过调用返回`loop()`）以重新输入。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T23:01:14.213

使用[`generator_tools`](http://www.fiber-space.de/generator_tools/doc/generator_tools.html#mozTocId557432)（安装：' `$ easy_install generator_tools`'）：

```
from generator_tools import copy_generator

def _callg(generator, generator_copy=None):
    for _ in generator: # run to the end
        pass
    if generator_copy is not None:
        return lambda: _callg(copy_generator(generator_copy))

def loop(c):
    c.next() # advance to yield's expression
    return _callg(c, copy_generator(c))

if __name__ == '__main__':
    def loop_gen():
        i = 1
        while i <= 4:
            print i
            if i == 2:
                yield
            i += 1

    c = loop(loop_gen())
    print("c:", c)
    for _ in range(2):
        print("c():", c()) 
```

输出：

```
1
2
3
4
('c:', <function <lambda> at 0x00A9AC70>)
3
4
('c():', None)
3
4
('c():', None) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-01T20:00:43.837

有许多在特殊情况下有效的弱解决方法（请参阅此问题的其他答案），但没有 Python 语言构造等效于`callcc`或可用于构建等效于`callcc`.

您可能想尝试[Stackless Python](http://www.stackless.com/)或[greenlet](http://pypi.python.org/pypi/greenlet) Python 扩展，它们都提供协程，基于它们可以构建一次性延续，但这仍然比 Ruby `callcc`（提供完整延续）弱。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T20:52:30.120

```
def loop():    
    def f(i, cont=[None]):        
        for i in range(i, 5):
            print i
            if i == 2:
                cont[0] = lambda i=i+1: f(i)
        return cont[0]
    return f(1)

if __name__ == '__main__':
    c = loop()
    c() 
```

# ios - 如何将 NSURLConnection 与 UIProgressView 集成？

> ID：312796
> 
> 赞同：24
> 
> 时间：2008-11-23T18:26:22.833
> 
> 标签：ios, objective-c, iphone, cocoa-touch

我正在尝试将 NSURLConnection 对象与 UIProgressView 集成，因此我可以在后台进行文件下载时更新用户。

我创建了一个单独的对象来在后台下载文件，但在弄清楚如何使用正确的值更新 UIProgressView 对象中的进度属性时遇到了问题。这可能是非常简单的事情，但我无法通过谷歌搜索来弄清楚。

这是我的代码：

```
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response {
    [self.resourceData setLength:0];
    self.filesize = [NSNumber numberWithLongLong:[response expectedContentLength]];
    NSLog(@"content-length: %d bytes", self.filesize);
}

- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
    [self.resourceData appendData:data];

    NSNumber *resourceLength = [NSNumber numberWithUnsignedInteger:[self.resourceData length]];
    NSLog(@"resourceData length: %d", [resourceLength intValue]);
    NSLog(@"filesize: %d", self.filesize);
    NSLog(@"float filesize: %f", [self.filesize floatValue]);
    progressView.progress = [resourceLength floatValue] / [self.filesize floatValue];
    NSLog(@"progress: %f", [resourceLength floatValue] / [self.filesize floatValue]);
} 
```

如您所见，**resourceData**成员变量保存正在下载的文件数据。**filesize**成员变量保存文件的完整大小，由我的 Web 服务在其 Content-Length 标头中返回。

一切正常，我继续通过多次执行**didReceiveData**来获取下载的数据，但是当我尝试计算进度值时，没有返回正确的值。有关我在控制台日志中获得的内容的小示例，请参见下文：

```
content-length: 4687472 bytes
resourceData length: 2904616
filesize: 4687472
float filesize: -1.000000
progress: -2904616.000000 
```

作为参考，**progressView.progress**是一个浮点数。**filesize**是一个 NSNumber，它持有一个 long long。最后，**resourceLength**是一个包含 NSUInteger 的 NSNumber。

我在这里想念什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-23T19:58:58.183

不知道我在这里错过了什么，但你`filesize`的 -1 似乎是你的问题。[API 文档](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURLResponse_Class/Reference/Reference.html#//apple_ref/occ/instm/NSURLResponse/expectedContentLength)明确指出`expectedContentLength`可能不可用，并且在`NSURLResponseUnknownLength`这些情况下会返回。 `NSURLResponseUnknownLength`定义为：

```
#define NSURLResponseUnknownLength ((long long)-1) 
```

在这些情况下，您无法获得准确的进度。您需要处理此问题并显示某种不确定的进度表。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-24T01:04:02.937

我认为您打印的文件大小错误。如果`self.filesize`确实是 a `NSNumber`，则使用`%@`格式打印它，因为它是一个对象，而不是原语：

```
NSLog(@"filesize: %@", self.filesize); 
```

通过使用`%d`，您只是打印 self.filesize 的*指针*值。要打印出实际的 long long 值，请使用`%lli`（`%d`仅适用于 32 位值）：

```
NSLog(@"filesize: %lli", [self.filesize longLongValue]); 
```

所以你的 self.filesize*实际上是*-1 并且划分是正确的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-25T12:59:20.023

在您的代码中，文件大小似乎是一个 NSNumber 对象（！）。所以

`NSLog(@"filesize: %d", self.filesize);`

和

`NSLog(@"content-length: %d bytes", self.filesize);`

可能会报告该对象（或其他）的地址（id）之类的东西。这是

`filesize: 4687472`

你看。正如其他人指出的，响应返回的文件大小确实是-1，即

`NSURLResponseUnknownLength`

即，服务器没有返回文件大小。

# workflow-foundation - WF项目：快递版

> ID：312803
> 
> 赞同：3
> 
> 时间：2008-11-23T18:35:22.067
> 
> 标签：workflow-foundation

有没有Visual Studio Express Edition 可以开发WF 应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T19:03:07.097

快速版本中缺少工作流设计器。但是你仍然可以做工作流。

例如，请查看[此](http://www.codeproject.com/KB/WF/WFExpress.aspx)链接。

# sharepoint - 使用 WebClient 将文档上传到 SharePoint 文档库中的特定文件夹

> ID：312807
> 
> 赞同：1
> 
> 时间：2008-11-23T18:40:54.003
> 
> 标签：sharepoint, document, webclient, document-library

我有一些客户端代码可以将 Outlook 电子邮件上传到文档库，只要路径指向文档库的根目录，它就可以正常工作。

```
@"https://<server>/sites/<subweb>/<customer>/<teamweb>/<Documents>/" + docname; 
```

是这个函数中的 projectUrl ：

```
public bool SaveMail(string filepath, string projectUrl)
    {
        try
        {
            using (WebClient webclient = new WebClient())
            {
                webclient.UseDefaultCredentials = true;
                webclient.UploadFile(projectUrl, "PUT", filepath);
            }
        }
        catch(Exception ex)
        {
            //TO DO Write the exception to the log file
            return false;
        }
        return true;
    } 
```

但我无法弄清楚如何上传到现有文件夹，即同一文档库中的“电子邮件”。甚至谷歌似乎都不知道答案:-)

注意：我知道我可以使用 SharePoint 中的复制 Web 服务之类的东西将文件移动到其最终目标，但这更像是一种解决方法。

* * *

我什么时候才能学会不工作到深夜:-(

对不起那个问题。Igalse 是对的，我只需要在 URL 中添加“emails/”。我可以发誓我曾尝试过，但话又说回来，看起来我没有。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T23:54:30.017

使用您的代码，我刚刚将 /Emails/ 添加到 projectUrl 并且上传工作正常。你试过吗？也许你有权限问题。

# entity-framework - 我必须使用实体框架模型中的所有表吗？

> ID：312810
> 
> 赞同：0
> 
> 时间：2008-11-23T18:45:37.660
> 
> 标签：entity-framework

我正在为微软的 Pubs 数据库的一个子集构建一个实体框架模型。我只对出版商和书籍感兴趣，而不是出版商和员工，但出版商和 emoloyees 表之间存在外键约束。当我从模型中删除员工实体时，由于外键约束，模型将无法验证。

当该子集链接到具有外键约束的其他表时，如何为该数据库子集创建模型？

因为这是一个演示，我从数据库中删除了有问题的表和约束，但这在生产中不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-24T00:03:11.263

您可以创建相关数据的视图并将您的模型绑定到该视图。我不是数据库专家，但我以前共事过的 DBA 推荐了这种方法，因为她说数据库服务器上的视图一开始就不太密集。

在 3.5 SP1 发布之前，我们在 LINQ to SQL 之上构建了一个 DAL（没有 DBML 映射，但这是另一回事），它将所有域对象映射到存储过程或视图。这样一来，DBA 对遵循更多设置的执行计划以及能够将数据库逻辑封装在代码库之外的调用感到高兴。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T13:37:15.037

正确的方法是将外键列公开为标量属性。[在这篇博文](http://blogs.msdn.com/adonet/archive/2008/11/24/working-with-large-models-in-entity-framework-part-1.aspx "在实体框架中使用大型模型")中有完整的解释和可下载的示例代码。 您可能会发现帖子的其余部分也很有趣。

# iphone - iPhone NavBar 示例中谁负责创建 MainViewController 实例

> ID：312819
> 
> 赞同：1
> 
> 时间：2008-11-23T18:59:10.393
> 
> 标签：iphone, cocoa-touch, xcode, model-view-controller, interface-builder

我正在从 iPhone 开发中心探索[NavBar 示例。](https://developer.apple.com/iphone/library/samplecode/NavBar/index.html)

更具体地说，我试图了解 MainViewController 对象的实例化位置，但我根本找不到发生这种情况的位置。

对 MainViewController 类的唯一引用是在 AppDelegate 中，其中有一个前向声明和#import。但是，删除这些句子不会影响程序。

该对象可能是在 nib 文件中创建的，但同样，我找不到它。

我真的很喜欢 Xcode 开发环境。然而，我不喜欢的是，有许多不同的地方可以创建/连接对象，这使得理解其他人的代码变得非常困难。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T20:16:07.697

如果您查看 MainWINdow.xib 文件并单击“导航控制器”旁边的显示三角形，您将看到 MainViewController 的一个实例。这是通过从库中拖动“视图控制器”对象然后更改其类来创建的。

# wpf - 您将如何为 WPF 设计一个对接库？

> ID：312828
> 
> 赞同：0
> 
> 时间：2008-11-23T19:07:37.587
> 
> 标签：wpf, design-patterns, oop, docking

我想在 wpf 中实现一个停靠库，其行为类似于 Adob​​e Photoshops CS3。

您可以通过鼠标拖动将浮动面板附加到其他面板或 Dock 上。码头有固定的位置。

您会使用中央对接管理器类吗？消息流会是什么样子？我正在考虑使用 2 个接口，称为 IDock 和 IDockable，面板实现这两个接口，以及一个仅实现 IDock 的扩展坞。

我正在寻找一些可以帮助我的特定设计模式或 OO 原则，以便整体设计是合理的。我知道我在这里并不是很具体，但那是因为我不知道从哪里开始。

面板到面板移动示例：

[替代文字 http://dl.getdropbox.com/u/133877/Misc/Stackoverflow/wpf_dock_01.png](http://dl.getdropbox.com/u/133877/Misc/Stackoverflow/wpf_dock_01.png)

[替代文字 http://dl.getdropbox.com/u/133877/Misc/Stackoverflow/wpf_dock_02.png](http://dl.getdropbox.com/u/133877/Misc/Stackoverflow/wpf_dock_02.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-23T19:32:04.383

也许你可以开始学习[http://www.codeplex.com/AvalonDock](http://www.codeplex.com/AvalonDock)这是一个 wpf 对接库。可能有一些东西可以从中学习。

# php - 如何在 CakePHP 中使用模型中的电子邮件组件？

> ID：312846
> 
> 赞同：6
> 
> 时间：2008-11-23T19:29:43.437
> 
> 标签：php, cakephp

我有一个非常简单的模型。我想在模型的方法中添加一个发送电子邮件例程：

```
$this->Email->delivery = 'smtp';
$this->Email->template = 'default';
$this->Email->sendAs = 'text';     
$this->Email->from    = 'email';
$this->Email->to      = 'email';
$this->Email->subject = 'Error'; 
```

我试过把

```
App::import('Component', 'Email'); 
```

在顶部，无济于事。我得到的错误是：

> 致命错误：在第 23 行的 E:\xampp\htdocs8080\app\models\debug.php 中调用未定义的方法 stdClass::send()

有任何想法吗？

我正在运行 CakePHP 1.2

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-17T09:42:06.110

即使这不是最佳实践，您实际上也可以在模型中使用 EmailComponent，但是您需要实例化它（在模型中没有自动组件加载）并且您需要将其传递给控制器​​。EmailComponent 依赖于控制器，因为它需要与视图的连接，用于呈现电子邮件模板和布局。

在您的模型中使用这样的方法

```
function sendEmail(&$controller) {
    App::import('Component', 'Email');
    $email = new EmailComponent();
    $email->startup($controller);
} 
```

您可以像这样在控制器中使用它：

$this->Model->sendEmail($this);

（如果您使用的是 PHP5，请省略方法签名中的 &）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-06T04:29:58.513

好吧，你做错了。您应该在 AppController 中放置电子邮件发送例程：

```
function _sendMail($to,$subject,$template) {
    $this->Email->to = $to;
    // $this->Email->bcc = array('secret@example.com'); // copies
    $this->Email->subject = $subject;
    $this->Email->replyTo = 'noreply@domain.com';
    $this->Email->from = 'MyName <noreply@domain.com>';
    $this->Email->template = $template;
    $this->Email->sendAs = 'text'; //Send as 'html', 'text' or 'both' (default is 'text')
    $this->Email->send();
} 
```

然后像这样从任何控制器使用它：

```
$this->_sendMail($this->data['User']['email'],'Thanks for registering!','register'); 
```

不要忘记放置

```
var $components = array('Email'); 
```

在控制器中，您正在使用 _sendMail 函数。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-01-25T20:26:59.623

CakePHP 2.0 有一个新的 CakeEmail 类，它可以在任何地方工作：

[http://book.cakephp.org/2.0/en/core-utility-libraries/email.html](http://book.cakephp.org/2.0/en/core-utility-libraries/email.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-24T00:44:50.027

组件应该用于控制器，而不是模型。

在您的控制器中使用

```
var $components = array('Email'); 
```

无需使用 App::import();

在不了解您的应用程序以及想要在模型中使用它的原因的情况下，我可能会建议您重新考虑您的系统架构并将此逻辑移动到您的控制器中。

如果您在您的模式中确实需要它，您的代码包含类似...

```
$this->Email->delivery = ... 
```

您是否已经创建了组件的新实例并将其设置为模型的一个名为 Email 的属性？（不知道这是否会起作用。）

您得到的错误是因为您在 stdClass 对象上调用 send() 方法，即不是 EmailComponent 的实例。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-07T16:15:24.977

好的，确实在模型中使用组件并不好。我的问题是我不想在我的控制器中写一百万次电子邮件块：

> $this->Email->delivery = 'smtp';
> 
> $this->Email->template = $template;
> 
> $this->Email->sendAs = '文本';
> 
> $this->Email->from = $from;
> 
> $this->Email->to = $to;
> 
> $this->电子邮件->主题 = $主题；
> 
> $this->电子邮件->发送();

如果我在控制器中使用 5 次，几乎不会干燥。所以我创建了一个名为 Wrapper 的组件，并添加了一个 sendEmail 例程，所以我可以写：

> $this->Wrapper->sendEmail($from,$to,$subject,$template,$body);

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-05T18:23:39.907

我和你在一起，贾斯汀。

我有一系列模型，它们根据某些操作触发电子邮件，这些操作可能来自用户、管理员和用于自动化流程的 shell 脚本。

在模型中集中电子邮件响应（例如当订单记录被“取消”时）比在多个位置重写电子邮件要容易得多。

此外，我在模型中有自动化流程，这些流程处理一些核心“逻辑”，这些“逻辑”级联到其他 hasOne、belongsTo 或 hasMany 模型，这些模型是 biz 规则。

例如，一个 crontabbed 的 shell 脚本调用 Offer->expire() 来“过期”一个 Offer，然后调用 Offer->make() 来制作另一个 Offer，但如果它不能，那么它调用 Request->expire() 来'过期'原始请求。电子邮件必须发送给第一个过期的报价接收者、任何新的报价接收者和/或发送给请求者（如果它过期）。这些可以由 crontabbed shell 或用户或可以手动管理请求和提议的管理员调用。都使用不同的控制器或接口。

这就是我所做的并且可以在模型和控制器中调用它：

```
if(empty($this->MailsController)) {
    App::import('Controller','Mails');
    $this->MailsController = new MailsController();
    $this->MailsController->constructClasses();
    $this->MailsController->Email->startup($this->MailsController);
} 
```

现在，我几乎可以从任何地方调用它，并通过模型内部的以下调用集中所有逻辑，以查找哪些数据（）、生成哪些电子邮件、将其发送给谁等：

```
$this->MailsController->orderMail($user_id,$this->id,$mode); 
```

由于所有电子邮件逻辑基本上都是由模型通过 MailsController 间接调用的，因此我将尝试 rscherer 的代码。

希望这会有所帮助，oh4real

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T18:09:19.697

我有一个应用程序，我在其中将单行添加到模型（model1）。然后该模型触发进入另一个模型 (model2)。模型 1 有许多模型 2。我只想在 model2 插入成功时发送电子邮件。所以我希望model1每次成功插入model2时都会发送电子邮件。

在这一点上，重构系统架构的时间太长了。

我的解决方案？当我执行 Model1->addRecord 时，它执行 model2->addRecord()。我让 model1 跟踪来自 model2->addRecord 的每个失败或成功。然后我从 model1->addRecord 返回一个成功/失败数组给调用控制器（model1_controller）。然后我会从那里让 model1_controller 发出电子邮件。

因此，无需完全重写架构即可正确执行此操作。只需从 Model1 向控制器返回更多信息，然后让控制器（正确地）发送电子邮件。

抱歉，有些不清楚的帖子。我的大脑现在处于代码模式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-27T18:43:32.340

查看一个名为 Eventful 的插件

它将允许您广播和收听自定义事件。对于我下面的海报：您可以广播 Model1Saved 事件，在 model2 中监听它，然后执行第二次保存，然后他们将成功事件广播回 model1，甚至是控制器。从那里您可以发送您的电子邮件。

# dns - 我可以使用 confstr 设置两个名称服务器吗？

> ID：312854
> 
> 赞同：1
> 
> 时间：2008-11-23T19:34:16.127
> 
> 标签：dns, nameservers, qnx

我正在尝试在我的 QNX 系统中设置两个动态名称服务器 IP 地址。`_nameserver=xxx.xxx.xxx.xxx`我已经能够使用 confstr 通过将字符串设置为 _CS_RESOLVE 来设置地址。然后 res_search 返回给定名称的正确 IP 地址。我其实有两个问题：

1.  如何使用 setconf 设置两个名称服务器（主要和次要）？

2.  如果名称服务器 IP 地址发生更改，我可以在我的应用程序运行时再次调用 setconf 来更改它们吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-23T19:48:40.107

根据[QNX 文档](http://www.qnx.com/developers/docs/6.3.2/neutrino/utilities/r/resolv.conf.html)，您的 confstr() 设置需要包含：

```
nameserver_1.2.3.4
nameserver_5.6.7.8 
```

（即每个名称服务器一行，最多三个）

如果名称服务器发生更改，您可能需要调用`res_init()`以强制解析器库使用新设置。

# idisposable - NDepend CQL 查询缺少 IDisposable 实现

> ID：312857
> 
> 赞同：5
> 
> 时间：2008-11-23T19:36:40.880
> 
> 标签：idisposable, ndepend, cql, cqlinq

我意识到这个问题正在寻找的查询不足以找到 IDisposable 实现的每一个小问题，但每一个早期警告都很重要，所以我会尽我所能。

我想知道是否有人为 NDepend 提出了一个 CQL 查询，该查询将列出所有未实现 IDisposable 但具有一个或多个字段的类。一个类可能会通过错误（即有人忘记检查 IDisposable 实现的字段类型）或通过代码演变（即在某个字段中使用的类在某处获得 IDisposable 附加到以后的日期，所有用法都没有更新）。

查找所有未实现 IDisposable 的类的简单查询是：

```
SELECT TYPES WHERE !Implement "System.IDisposable" 
```

但是，这当然不会检查该类*是否应该*为上述规则实现 IDisposable。

有没有人有这样的疑问？我仍然在掌握 CQL，所以这部分让我望而却步。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-24T12:59:15.723

Lasse，由于 CQLinq（LINQ 上的代码规则）功能匹配应该实现 IDisposable 的类型现在是可能的。实际上现在提供了两个相关的默认规则，您可以轻松编写自己的相关规则：

*   [具有一次性实例字段的类型必须是一次性的](http://www.ndepend.com/DefaultRules/webframe.html?Q_Types_with_disposable_instance_fields_must_be_disposable.html)
*   [具有非托管资源的一次性类型应声明终结器](http://www.ndepend.com/DefaultRules/webframe.html?Q_Disposable_types_with_unmanaged_resources_should_declare_finalizer.html)

* * *

```
// <Name>Types with disposable instance fields must be disposable</Name>
warnif count > 0

let iDisposable = ThirdParty.Types.WithFullName("System.IDisposable").FirstOrDefault() 
where iDisposable != null // iDisposable can be null if the code base doesn't use at all System.IDisposable

from t in Application.Types where 
   !t.Implement(iDisposable) && 
   !t.IsGeneratedByCompiler 

let instanceFieldsDisposable = 
    t.InstanceFields.Where(f => f.FieldType != null &&
                                f.FieldType.Implement(iDisposable))

where instanceFieldsDisposable.Count() > 0
select new { t, instanceFieldsDisposable } 
```

* * *

```
// <Name>Disposable types with unmanaged resources should declare finalizer</Name>
// warnif count > 0
let iDisposable = ThirdParty.Types.WithFullName("System.IDisposable").SingleOrDefault()
where iDisposable != null // iDisposable can be null if the code base deosn't use at all System.IDisposable

let disposableTypes = Application.Types.ThatImplement(iDisposable)
let unmanagedResourcesFields = disposableTypes.ChildFields().Where(f => 
   !f.IsStatic && 
    f.FieldType != null && 
    f.FieldType.FullName.EqualsAny("System.IntPtr","System.UIntPtr","System.Runtime.InteropServices.HandleRef")).ToHashSet()
let disposableTypesWithUnmanagedResource = unmanagedResourcesFields.ParentTypes()

from t in disposableTypesWithUnmanagedResource
where !t.HasFinalizer
let unmanagedResourcesTypeFields = unmanagedResourcesFields.Intersect(t.InstanceFields)
select new { t, unmanagedResourcesTypeFields } 
```

# .net - 如何在运行时转换类型？

> ID：312858
> 
> 赞同：21
> 
> 时间：2008-11-23T19:37:13.110
> 
> 标签：.net, reflection, runtime, type-conversion

我的场景应该很简单......我要转换的类型*总是**“*字符串”。我想转换为...可能是很多东西 - 整数、日期时间、...字符串等。

 *这很容易：

```
string valueToConvertFrom = "123";

int blah = Convert.ToInt32(valueToConvertFrom); 
```

但是......我不知道（直到运行时）我需要转换为的值是“Int”（或其他）。我试过这个：

```
string valueToConvertFrom = "123";

Type convertToType = typeof(int);

object blah = Convert.ChangeType(valueToConvertFrom, convertToType); 
```

但这给了我以下错误：“对象必须实现 IConvertible。”

我不想做一个 switch 语句并根据类型名称调用“Convert.ToBlah”......有什么建议吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-23T20:15:28.120

干净的方法是使用 TypeConverter。您可以通过调用 [TypeDescriptor.GetConverter](http://msdn.microsoft.com/en-us/library/system.componentmodel.typedescriptor.getconverter.aspx)来获取类型转换器的实例，然后使用类型转换器的实例进行转换。所以是这样的：

```
string valueToConvertFrom = "123";

Type convertToType = typeof(int);

TypeConverter tc =  TypeDescriptor.GetConverter(convertToType);             

object blah =tc.ConvertFromString(valueToConvertFrom); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T20:04:47.377

String 类实现了 IConvertible，这段代码应该可以工作。您的目标是哪个版本的 .NET？

```
object o = Convert.ChangeType( str, convertToType ); 
```

此外，您提到的大多数类型都实现了 Parse 方法，因此您最好的选择可能是这样的。

```
Type convertToType = ...;
MethodInfo mi = convertToType.GetMethod("Parse", BindingFlags.Static);
object blah;
if(mi != null)
{
    blah = mi.Invoke(null, new object[]{valueToConvertFrom});
}
else
{
    // the type doesn't implement the Parse method, handle it another way :/
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-10-29T23:32:50.350

Timothy 的问题，通常应用于 .NET 中的类型转换问题，是一个非常大的问题。虽然转换策略在具有已知类型的特定场景中有些简单，但不幸的是，在 .NET 的任何实现中都没有通用策略来在运行时完成从一种任意类型到另一种类型的类型转换，Redmond 也没有这种策略。但是，Microsoft 为类型转换的一般概念提供了一些很好的指南，包括：

*   [.NET Framework 中的类型转换](http://msdn.microsoft.com/en-us/library/98bbex99.aspx)
*   [类型转换和类型转换（C# 编程指南）](http://msdn.microsoft.com/en-us/library/ms173105.aspx)
*   [类型转换器和 XAML](http://msdn.microsoft.com/en-us/library/cc645047%28v=VS.95%29.aspx)

我不得不在我的系统中处理相同的一般问题，作为一种解决方案，我将所有标准策略整合到一种方法中。这个问题的范围很广，相关的转换策略也是多种多样的，所以这种整合的方法只能在一篇完整的技术文章中涵盖。但是，我在这里提供了我的方法文档的副本，希望这将帮助您牢牢掌握在开发类似的通用解决方案时需要解决的总体要求。这是我的文档的链接：

*   [转换类型方法](http://mjappfactory.com/Links/ConvertType.pdf)

我希望这可以帮助你，

标记

# image - 如何使用 Grails j2d 插件来缩放图像

> ID：312859
> 
> 赞同：1
> 
> 时间：2008-11-23T19:37:19.773
> 
> 标签：image, grails, groovy

我正在使用 grails j2d，它反过来`GraphicsBuilder`用来制作一个简单的服务来缩放图像。我的问题是专门访问下载的图像高度和宽度属性，以便将正确的参数传递给缩放方法。如何在转换闭包中访问这些属性？

```
Controller {
   def scale = {
       def targetW = new Integer(params?.w?:64)
       def targetH = new Integer(params?.h?:48)
       renderImage( [width: targetW  ,height: targetH ] ) {
          image( url: params?.url ) {
             transformations {
                scale( x: 1 , y: 1 , interpolation: 'bicubic' )
             }
          }
       }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T06:59:15.433

我根本不知道 J2D 插件，但您可能会检查您传递给图像调用的闭包的委托是什么。在转换调用之前添加一行“def d = delegate”，然后调试它以查看委托的类型。如果它是一个图像，那么你应该能够得到 delegate.width 或 delegate.w 或类似的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-05-05T12:04:23.767

neswest j2d 插件公开了这些值，因此您可以正常作为参数传递。

# sql - 使用 SQL Server 2000 进行数据透视

> ID：312861
> 
> 赞同：16
> 
> 时间：2008-11-23T19:42:07.657
> 
> 标签：sql, sql-server, tsql, sql-server-2000

我整理了我的问题的一个示例场景，我希望它足以让有人指出我正确的方向。

我有两张桌子

产品

![替代文字](https://i.stack.imgur.com/ktnI0.gif)

产品元

![替代文字](https://i.stack.imgur.com/dBrc0.gif)

我需要以下结果集

![替代文字](https://i.stack.imgur.com/Ken2R.gif)

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2011-04-27T05:23:01.597

我意识到这是两年前的事了，但让我感到困扰的是，接受的答案要求使用动态 SQL，而最受好评的答案不起作用：

```
Select P.ProductId, P.Name
    , Min( Case When PM.MetaKey = 'A' Then PM.MetaValue End ) As A
    , Min( Case When PM.MetaKey = 'B' Then PM.MetaValue End ) As B
    , Min( Case When PM.MetaKey = 'C' Then PM.MetaValue End ) As C
From Products As P
        Join ProductMeta As PM
            On PM.ProductId = P.ProductId
Group By P.ProductId, P.Name 
```

您*必须*使用分组依据，否则您将获得交错的结果。如果您使用 Group By，则必须将不在 Group By 子句中的每一列包装在聚合函数（或子查询）中。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-28T16:53:34.173

我们过去成功地使用了以下方法......

```
SELECT [p].ProductID,
       [p].Name,
       MAX(CASE [m].MetaKey
             WHEN 'A'
               THEN [m].MetaValue
           END) AS A,
       MAX(CASE [m].MetaKey
             WHEN 'B'
               THEN [m].MetaValue
           END) AS B,
       MAX(CASE [m].MetaKey
             WHEN 'C'
               THEN [m].MetaValue
           END) AS C
FROM   Products [p]
       INNER JOIN ProductMeta [m]
         ON [p].ProductId = [m].ProductId
GROUP  BY [p].ProductID,
          [p].Name 
```

它也可以是有用的转置聚合使用...

```
SUM(CASE x WHEN 'y' THEN yVal ELSE 0 END) AS SUMYVal 
```

**编辑**

还值得注意的是，这是使用 ANSI 标准 SQL，因此它可以跨平台工作 :)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-03-31T21:12:52.880

如果您的数据库引擎是 2005 并且您的数据库处于 2000 兼容模式，则可以通过从 2005 数据库运行查询来解决较低的兼容模式。通过在查询中为您的表使用 3 部分命名约定来定位 2000 数据库，例如`DatabaseNameHere.dbo.TableNameHere`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T20:03:56.833

```
Select a.ProductId
  ,a.Name
  ,(Select c.MetaValue
    From [Product Meta] c
    Where c.ProductId = a.ProductId
    And c.MetaKey = 'A') As 'A'
   ,(Select d.MetaValue
    From [Product Meta] d
    Where d.ProductId = a.ProductId
    And d.MetaKey = 'B') As 'B'
   ,(Select e.MetaValue
      From [Product Meta] e
      Where e.ProductId = a.ProductId
      And e.MetaKey = 'C') As 'C'
From Products a
Order By a.ProductId Asc 
```

# c - 将 int 转换为 LPCWSTR (Win32) 的正确方法

> ID：312865
> 
> 赞同：3
> 
> 时间：2008-11-23T19:45:15.763
> 
> 标签：c, winapi, type-conversion

我正在尝试学习基本的 Win32 编程并遇到了一个令人沮丧的问题。我希望转换一个变量（称之为 NumClicks）并将其显示为应用程序名称（作为字符串的一部分）。从我所见，从 int + 一些文本块到 char* 是有问题的，因为将其转换为必需的结束数据类型 (LPCWSTR) 比直接转换更困难。

任何想法或链接？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T19:53:36.587

使用[wsprintf](http://msdn.microsoft.com/en-us/library/ms647550(VS.85).aspx)
它允许您编写字符串，就像 printf 允许您打印一行文本一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T22:54:58.857

[**_itow_s** _](http://msdn.microsoft.com/en-us/library/0we9x30h%28VS.80%29.aspx "_itow_s")

如果您要寻找的不仅仅是 INT 到 LPWSTR 的转换（例如格式化），我建议您使用[**StringCchPrintfW**](http://msdn.microsoft.com/en-us/library/ms647541%28VS.85%29.aspx "字符串CchPrintfW")。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-20T21:13:18.187

这是我在需要 LPCWSTR 时使用的代码：

```
 int f =55;  
wchar_t buffer[10];
_itow_s (f, buffer, 10);
func_using_lpcwstr_as_parameter(buffer); 
```

注意此示例中的缓冲区溢出

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-23T00:51:30.153

而不是使用 wsprintf 我会使用 sprinf(buf, "%S", "plain old string");

# asp.net - Asp.Net 评级控制

> ID：312875
> 
> 赞同：2
> 
> 时间：2008-11-23T19:53:28.740
> 
> 标签：asp.net, javascript, ajax, client-side

我无法在 javascript 中`ASP.NET`选择评级控件。`value(CurrentValue)`我正在使用评级控制，`datagrid`有人知道如何在 JavaScript 中获得评级吗`CurrentValue`？`ASP.NET`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-27T04:57:07.503

您能否提供任何要在其中使用 Rating 控件的当前值的 Javascript 代码片段？
我认为，您可能需要在隐藏的变量中设置值，并将变量名称以数组的形式发送到 Javascript，方法如下：

1.  在 DataGrid 的 RowDataBound 事件中

    ```
    AjaxControlToolkit.Rating objRatingControl= (AjaxControlToolkit.Rating)row.FindControl("objRatingControl");
    Page.ClientScript.RegisterArrayDeclaration("RatingControlIDs", "'" + objRatingControl.ClientID + "'"); 
    ```

2.  现在您可以在 Javascript 中使用这个评级控件数组。

# javascript - 来自嵌入式 .swf 跨浏览器的弹出窗口

> ID：312877
> 
> 赞同：3
> 
> 时间：2008-11-23T19:54:25.760
> 
> 标签：javascript, actionscript-3, safari, popup

情况：您在 html 页面中嵌入了一个 .swf，当您单击 .swf 中的某些内容时，它需要弹出一个无镶边窗口。通常这会很容易 - 但考虑一下 Safari，它在启用弹出窗口阻止程序时完全禁用所有“window.open”功能（如果该功能被触发 onclick，它会例外，但它不计算 flash 中的点击次数） . 如何为不执行 window.open 的浏览器创建优雅降级（提供替代且大致等效的体验）的东西？

（注意：这是我们正在谈论的 AS3 和 Safari 3 for PC 或 Mac - 但更广泛地说，任何不支持或拒绝允许 javascript window.open 功能的浏览器。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T03:02:31.947

`wmode='opaque'`如果您的 SWF 是使用或加载的`wmode='transparent'`，那么您可以让 SWF 输出 JavaScript 代码，该代码将创建一个`<div>`位于 SWF 区域上方的空白。然后它`<div>`可以处理`onclick`事件并创建弹出窗口而不是 Flash 代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-26T00:46:27.663

div 叠加层比项目应得的更复杂 - 查看[code.google.com/p/popupfromflash](http://code.google.com/p/popupfromflash/)了解我想出的代码。

它尝试使用 ExternalInterface 来设置 window.open 函数，如果失败（特别是在 Safari 中），它会回调到 flash 并提示它执行 navigateToURL 以正常弹出窗口（而不是无色）

# javascript - Actionscript3 到 JavaScript 的通信：最佳实践

> ID：312880
> 
> 赞同：6
> 
> 时间：2008-11-23T20:01:34.653
> 
> 标签：javascript, actionscript-3, externalinterface

在比上一个问题更抽象的层面[上](https://stackoverflow.com/questions/299729/javascript-to-flash-communication)，根据我的经验，有 3 种方法可以使用 AS3 从嵌入式 .swf 调用 html 页面上的 javascript 函数：ExternalInterface、fscommand 和 navigateToURL。

让我们比较和对比这些方法（也许还有我没有列出的其他方法）并讨论每种方法的优缺点 - 现在，ExternalInterface*似乎*是灵活性方面的最佳选择，但它适用于所有情况吗？在执行速度或类似方面是否有具体的好处？我很好奇——我们怎么看？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-24T04:44:19.340

ExternalInferface 是为了让 JS 和 Flash 之间的通信更容易而创建的，因此使用其他任何东西都没有任何意义。常见的做法是在调用某些 JS 之前，首先通过评估 ExternalInterface.available 属性的值来检查其是否可用。此属性告诉您要从中调用某些 JS 的 SWF 是否位于提供外部接口的容器内。换句话说，如果使用 ExternalInterface 将起作用。如果它不可用，那么只需使用 flash.net.sendToUrl。切勿使用 fscommand()，因为它使用 VBScript，并且可能会导致与页面上的其他 VBScript 发生冲突。此外，您只能使用 fscommand 发送一个参数字符串，并且必须在 JS 端拆分它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T19:20:41.317

这完全取决于您是否希望通信是同步的，因为`ExternaInterface`可以像 where 一样返回数据`navigatoToURL`并且`fscommand`是异步的，并且只能调用 javascript 函数；他们不能返回值或响应。

来自与外部接口相关的实时文档：

> 通过 ActionScript，您可以在 HTML 页面上执行以下操作：
> 
> *   调用任何 JavaScript 函数。
> *   传递任意数量的参数，任何名称。
> *   传递各种数据类型（布尔、数字、字符串等）。
> *   从 JavaScript 函数接收返回值。
> 
> 通过 HTML 页面上的 JavaScript，您可以：
> 
> *   调用 ActionScript 函数。
> *   使用标准函数调用表示法传递参数。
> *   将值返回给 JavaScript 函数。

该类`flash.external.ExternalInterface`是该类的直接替代品`flash.system.fscommand`。

因此，使用 ExternalInterface 是 flash 和 Javascript 函数之间的首选方法或通信，但如果调用仅仅是异步的，则可以使用`flash.net.navigateToURL`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T15:25:47.190

**外部接口**

*   您可以从 JS-AS 和 AS-JS 调用中获取返回值
*   编码您的参数（使用数组、对象等调用。无需对它们进行编码）
*   跨浏览器
*   当您发送 HTML 或 JSON（特殊编码）时存在缺陷，它[会在内部中断](http://codinginparadise.org/weblog/2006/02/how-to-speed-up-flash-8s.html "http://codinginparadise.org/weblog/2006/02/how-to-speed-up-flash-8s.html")

**获取网址**

*   只能调用JS，得不到返回值，需要对数据进行编码
*   比弃用更好，在 Flash 10 中它已被删除
*   它真的被删除了，所以不要使用它；）

**fs 命令**

*   来吧，ExternalInterface 是解决方案（2008 年）。

# php - 如何在 localhost 上运行文件？

> ID：312881
> 
> 赞同：32
> 
> 时间：2008-11-23T20:02:13.043
> 
> 标签：php, localhost, xampp, include, ssi

我如何在 localhost 上实际运行文件？我知道它正在工作，但是如何在其上运行文件，以及如何验证该文件实际上是在 localhost 上运行的？

**这里的服务器新手，其他问题（我有运行 Apache 2.2 的 xampp）：** 从您的回答看来，我必须在浏览器中输入路径才能在 localhost 上打开文件。所以，如果我想将文件放在子目录中，我必须输入包括目录在内的完整路径？

有没有办法让浏览器在我处理我的 html 时指向本地主机，而不必一直输入路径？

我在 Dreamweaver CS3 中工作，并且想使用**包含**命令（SSI 或 PHP），但不必一直将我的文件放在 HostGator 上以查看它们是否正常工作。

最好的方法是什么（请具体说明，我一无所知）。如果任何地方都有详细的教程，非常感谢链接。

谢谢

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-23T20:05:57.327

好的，感谢您提供更具体的信息，人们现在可以删除他们的反对票...

您提出的建议是很常见的事情！您想在本地运行您的 Web 应用程序，而不是将其上传到您的主机。这完全没问题，这就是您的 Apache 的用途。您的 Apache 是一个 Web 服务器，这意味着它的主要目的是提供 HTML、PHP、ASP 等文件。有些喜欢 PHP；它首先发送到解释器，然后将呈现的文件发送到浏览器。总而言之：它只是为您的浏览器（客户端）提供页面。

您的 Web 服务器有一个根目录，即 wwwroot (IIS) 或 htdocs (apache、xampp) 或其他类似 public_html、www 或 html 等的目录。这取决于您的操作系统和 Web 服务器。

现在，如果您在浏览器中键入内容`http://localhost`，您的浏览器将被定向到此 webroot，并且服务器将提供任何可以在那里找到的 , 等（以可定制的顺序）`index.html`。`index.php`

如果您有一个名为“mytutorial”的项目，您可以输入`http://localhost/mytutorial`，服务器将显示您的教程的索引文件等。如果您查看本教程文件夹的绝对路径，那么它只是您的 webroot 的子文件夹，即它本身位于您硬盘的某个位置，但这对您的本地主机无关紧要。

所以相对路径是

```
http://localhost/mytutorial 
```

而绝对路径可能是

```
c:/webservices/apache/www 
```

或者

```
c:/xampp/htdocs 
```

如果您使用 Dreamweaver，您可以通过在项目设置中将本地服务器设置为测试服务器来简化测试过程。试试看！这很简单。完成后，您只需按下任何文件的浏览器图标，它将在 localhost 上打开。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2019-09-13T01:52:55.187

您可以通过使用以下命令运行来做到这一点。

```
php -S localhost:8888 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-23T20:07:43.657

我不太清楚你的意思，所以我将简单地开始：

如果您尝试“运行”的文件是静态内容，例如 HTML 甚至 Javascript，则无需在“本地主机”上运行它……您应该能够从它所在的任何位置打开它机器在您的浏览器中。

如果它是一段服务器端代码（ASP[.NET]、php 等等，你需要运行 Web 服务器，或者如果你使用 Visual Studio，请为你的应用程序启动开发服务器（F5调试，或 CTRL+F5 不调试启动）。

如果您使用的是 Web 服务器，则需要将网站配置为将主目录设置为文件所在的目录（或者，只需将文件放在配置的主目录中）。

如果您使用的是 Visual Studio，则该文件只需要在您的项目中即可。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T20:07:36.217

本地主机是您现在正在使用的计算机。您可以通过在命令提示符下键入命令并按 Enter 来运行。如果您询问如何从您的编程环境运行事物，那么答案取决于您使用的环境。大多数语言都有类似`system`或`exec`用于运行外部程序的命令。您需要更具体地了解您实际想要做什么，以及在尝试实现它时遇到了哪些障碍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T20:14:00.010

查看您的其他问题，我假设您正在尝试在您的网络服务器上运行 php 或 asp 文件或其他内容，这是您在网页设计中的第一次尝试。

一旦你正确安装了 php（当你得到 XAMPP 时你可能已经这样做了），只需将你想要的任何文件放在你的 localhost 下（也许是 /www/var/html ？）它应该运行。当然，您可以在浏览器中的 localhost/file.php 中进行检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-02-05T19:02:34.270

这样想吧。

您键入的任何内容都是`localhost/`服务器根目录中的路径（www 或 htdocs）。

您不需要指定要运行的文件的完整路径，只需指定根文件夹之后的路径，因为放置会将`localhost/`您带到根文件夹本身。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-16T22:09:32.703

我目前在 VScode 工作。我想运行我的 html 页面只是为了查看我的所有主要元素。

1）首先，在vs中，右键单击所需的html文件并选择“复制路径”。不要选择亲戚。

2）最后，在地址栏中粘贴html路径（我使用chrome）并按Enter。您的 html 页面应显示。希望这可以帮助某人。

# c++ - 什么是信号和插槽？

> ID：312895
> 
> 赞同：27
> 
> 时间：2008-11-23T20:12:03.867
> 
> 标签：c++, design-patterns, signals-slots

有人可以简单地解释“信号和插槽”模式吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-23T20:25:00.707

信号和槽是一种将发送器（信号）和零个或多个接收器（槽）解耦的方法。假设您有一个系统，其中包含您希望对系统的任何其他对这些事件感兴趣的部分可用的事件。与其将生成事件的代码硬连接到想要了解这些事件的代码，不如使用信号和槽模式。

当发送者发出事件信号时（通常通过调用与该事件/信号相关的函数），该事件的所有接收者都会被自动调用。这允许您在程序的生命周期内根据需要连接和断开接收器。

由于这个问题被标记为 C++，这里有一个指向[Boost.Signals](http://www.boost.org/doc/libs/1_37_0/doc/html/signals.html)库的链接，其中有更详尽的解释。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-23T20:27:48.140

我认为当您将信号和插槽视为[观察者模式或发布/订阅者模式](http://en.wikipedia.org/wiki/Observer_pattern)的可能实现工具时，可以最好地描述它们。有一个`signal`，例如`buttonPressed(IdType)`在发布者端。每当按下按钮时，都会调用连接到该信号的所有插槽。插槽位于订阅方一侧。例如，插槽可以是`sendMail(IdType)`.

随着事件“按下按钮”，插槽将知道按下了哪个按钮，因为 id 将被移交。`IdType`表示通过发布者和订阅者之间的连接发送的数据的类型。订阅者可能的操作是可以与`connect(signal, slot)`连接，因此如果按下按钮，则调用该特定插槽。`buttonPressed(IdType)``sendMail(IdType)`

这样做的好处是订阅者（插槽端）不需要关心信号的细节。它只需要连接。因此，这里我们有大量的*松散耦合*。您可以更改按钮的实现，但插槽的界面仍然相同。

查看[Qt Signals/Slots](http://doc.trolltech.com/4.5/signalsandslots.html)或[Boost Signals](http://www.boost.org/doc/html/signals.html)了解更多信息。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-23T20:30:30.977

想象一下在您的应用程序中有一个 GUI。大多数时候，控制流不会是非常线性的，也就是说，您需要一个与 GUI 交互的用户（如按钮、菜单等），而不是有一个清晰的动作序列。

这本质上是一个事件驱动模型，可以通过信号和槽模式很好地实现。信号是由对象（想想 GUI 组件）生成的事件，而插槽是这些事件的接收者。

这是一个示例：假设您有一个复选框，在您的编程语言中表示为一个对象。该复选框可能会发生多种情况：它可以被切换，这反过来也意味着它要么被设置，要么被取消。这些是它可以发出的信号。我们将它们命名为 checkboxToggled、checkboxSet 和 checkboxUnset。如您所见，在此示例中，复选框将始终在切换时发出 checkboxToggled 信号，但也恰好是其他两个信号之一，具体取决于状态如何变化。

现在想象有一些其他对象，即一个标签，为了这个例子，它总是作为一个对象存在，但可以“出现”和“消失”，以及一个系统哔声（也由一个对象表示），它可以简单地哔哔声。这些是这些对象所拥有的插槽。我们将它们称为“messageAppear”、“messageDisappear”和“beep”。

假设您希望每次切换复选框时系统发出蜂鸣声，并且标签的出现或消失取决于用户是否选中或清除了复选框。

因此，您可以将以下信号连接到以下插槽（左侧的信号，右侧的插槽）：

```
checkboxToggled -> beep
checkboxSet -> messageAppear
checkboxUnset -> messageDisappear 
```

基本上就是这样。

信号和槽也可能有参数。例如，使用设置数值的滑块，您希望在用户移动滑块后立即将更改后的值与发射的信号一起发送：sliderChanged(int)。

当然，要真正做一些有用的事情，你会编写一些自己的类，其中包含一些自己的信号和插槽。这很容易完成，并且使用这些自己的信号和插槽，您可以以事件驱动的方式与 GUI 或代码的其他部分进行交互。

请记住，信号和时隙通常是对称的，因为通常可能存在与时隙相对应的信号。例如，一个复选框在切换时可能会发出一个信号，但它也可能包含一个切换复选框本身的插槽。分离总是彼此相反设置的复选框很容易实现。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-23T20:26:44.617

我假设您在谈论 QT 的信号和插槽。
这很简单。

一个类的实例可以触发一个信号，而另一个类的另一个实例可能会在槽中捕获该信号。这有点像函数调用，只是调用函数的人不需要知道谁想要接收调用。

最好的说明方法是举例。
QPushButton 类有一个信号 QPushButton::clicked()。每当单击按钮时都会触发该信号。按钮不需要知道谁有兴趣知道发生了点击。它只是触发信号，任何有兴趣的人都可以连接到它。
放置按钮的 QDialog 实际上很想知道按钮何时被单击。它有插槽 MyDialog::buttonClicked()。在 MyDialog c'tor 上，您需要将按钮 click() 信号连接到对话框的 buttonClicked() 插槽，以便在触发信号时调用该插槽。

一堆更高级的东西：

*   参数，信号可以有参数，这些参数也可以选择传递给插槽。
*   跨线程调用 - 如果您正在建立一个需要跨线程的信号槽连接，那么 QT 将自动缓冲信号并将它们排队到正确的线程。这会自动发生，例如当 GUI 线程需要与工作线程通信时。

[这是 QT 文档中的更多信息。](http://doc.trolltech.com/4.5/signalsandslots.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-14T11:34:06.893

我为信号和槽找到的最好的例子和解释是[这个代码项目文章](http://www.codeproject.com/Articles/6780/Type-safe-Signals-and-Slots-in-C-Part-2)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-05-07T13:41:35.980

有一个常见的误解，认为类是名词，如 Person、Dog、Bicycle 等。那么认为一个人（实例）有一条狗和一辆自行车是有道理的。

让我们从什么是对象（假设是）开始。对象是数据和过程。什么是程序？数据和程序。对象应该是（相对）“小的”独立子程序。因为 oo 编程的教学非常含糊且被滥用（需要引用），人们认为一切都需要是类或对象。事实并非如此，对象是具有“小”API（公共子例程）的“小”独立程序。一些程序员甚至不将他们的项目分解为子程序，而只是使用数据和过程更合适的对象。

现在，假设我们同意对象是程序，我们可能会同意，在大多数情况下，程序不需要具有类似大小和复杂性的其他程序的副本（即一个对象不是指向另一个对象的指针），它可能需要更小的程序来管理数据（如数据结构），但恕我直言不需要另一个对象。

为什么？因为耦合对象使它们相互依赖。为什么这么糟糕？因为当对象是独立的时，您可以测试它们并且还向其他程序员和客户保证该对象（一个小的独立程序）能够以高确定性执行某些任务。您还可以确保只要没有对该对象进行任何更改，它就会继续执行。

那么什么是插槽和信号呢？如果您了解对象就像程序一样，理想情况下它们不应该保存指向其他对象的副本或指针，那么您需要某种方式让它们进行通信。例如，在您的计算机上运行的进程可以使用套接字、IP 地址和端口进行通信。[对象可以使用与RPC](https://en.wikipedia.org/wiki/Remote_procedure_call)非常相似的东西，称为信号和槽。这些是一种数据结构，旨在作为两个较大对象之间的中介，这些对象存储对象的子例程 ( `slots`) 并允许其他对象使用适当的参数调用 ( `signal`) 这些子例程 () `slots`，而不需要知道关于这些其他对象的任何信息，而不知道它们需要哪些参数。

因此，底层结构是（可能）强类型过程指针的集合（可能是数组），其他对象可以使用合适的参数调用，而无需指向这些对象的指针。调用者只需要访问定义预期参数的信号对象（不包含实现细节）。

这也是灵活的，因为它允许一些特殊的用例，比如只响应一次信号的槽，一个信号的多个槽以及其他类似的用例，比如去抖动。

# jquery - UI 可用性 - 重新排序和合并列

> ID：312900
> 
> 赞同：2
> 
> 时间：2008-11-23T20:16:42.907
> 
> 标签：jquery, user-interface, usability

我正在为需要在 CSV 文件中合并列的兄弟编写一个基于 Web 的小实用程序。我知道这样的事情肯定存在于某个地方，但其中很大一部分是一个有趣的小练习。

无论如何，我试图找出最好/最简洁的方式来呈现他重新排序列并选择合并哪些列的 UI 部分。

jQuery UI“可选”交互提供了我需要的大约 85% - 列的简单重新排序 - 但我在合并时遇到了一些困难。我要做的是使“合并”列成为单个项目下的嵌套列表。

例如：

```
<ul id="columns">
<li>Column 1</li>
<li>Column 2</li>
</ul> 
```

会成为：

```
<ul id="columns">
<li>Column 1<ul class="merge"><li>Column 2</li></ul></li>
</ul> 
```

事实证明，这比我预期的要痛苦一些，所以我想知道是否有人对更好的方式来呈现整体 UI 有任何想法。我对 jQuery 相当熟悉，所以如果可以在 jQuery 中完成，我会加分：D

@dylanfm：这*不是*表格数据 - 它只是列*名*列表，但没有实际数据。此外，我使用的特定 HTML 元素几乎不是我所要求的核心。

@smo：我喜欢您想法的简单性，但问题是有*几十个*不同的列，因此不幸的是，每列列出每列一次是不可能的。

@strager：这几乎正是我一直在尝试做的，只是让 UI 以我想要的方式响应的细节给我带来了问题。我现在就给你答案，我想这对我来说又回到了盐矿。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T01:15:44.847

基本步骤：

1.  获取要合并的列列表作为 <li> 的数组。
    *   如果要合并两个已合并的列（或其中一个列已合并），请提取组中的每一列。在您的结构中，您希望“第 1 列”有自己的 <li>，而没有子 <ul>。
    *   您可能想要克隆这些，因为您将删除 (6) 中的原始节点。
2.  创建一个新的 <ul> 节点，添加正确的“合并”类名。
3.  添加您在 (1) 中收集的所有 <li>，除了第一个之外，并将它们作为子项插入 <ul>。
4.  插入 <ul> 作为您在 (1) 中收集的第一个 <li> 的最后一个子项。
5.  插入 <li>（(4) 中的父项）作为列列表 ($('#columns')) 的子项。
6.  删除要合并的原始列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T20:36:38.980

我想说坚持使用表格来存储表格数据，无序列表似乎不太适合内容。

# unit-testing - 在典型的 Web 应用程序中，单元测试与功能测试之间的正确平衡是什么？

> ID：312904
> 
> 赞同：6
> 
> 时间：2008-11-23T20:22:28.697
> 
> 标签：unit-testing, functional-testing

单元测试的编写和维护成本更低，但它们并不涵盖所有场景。它们之间的正确平衡是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T20:47:04.747

区分这两种测试的意图和范围很重要：

*   [单元测试](http://en.wikipedia.org/wiki/Unit_testing)通常在模块/类级别测试特定功能，例如 create-X、update-Y、foo-the-bar、compact-the-whizbang 等。一个类可能有多个单元测试

*   功能[测试](http://en.wikipedia.org/wiki/Acceptance_testing)，也称为“验收测试”，通常测试从最外层界面到处理结束的用例场景，例如从用户界面到数据库再返回，从输入过程到通知实用程序， ETC。

这两种类型的测试*不能互换*，并且通常是*不相交*的。因此，在它们之间取得“平衡”的想法毫无意义。您要么需要它们，要么不需要它们。

如果您指的是在测试框架中对每种类型的测试进行编码的难易程度，那是一个不同的问题——但是框架的使用（例如，NUnit 与用户机器人）不会改变测试框架的类型/性质测试。

一般来说，最好的“平衡”是对信心和完整性进行单元测试，对客户接受进行功能测试

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-24T14:54:57.610

我同意 Steven Lowe 的观点，即单元测试和功能测试之间没有权衡，因为它们用于非常不同的目的。

单元测试是关于方法和类型验证，以及回归测试。功能测试是关于功能、场景和可行性测试。在我看来，几乎没有重叠，

如果有帮助，这是我的测试类别。

开发人员由内而外，专注于代码：

*   断言 - 验证数据流和结构
*   调试器 - 验证代码流和数据
*   单元测试 - 验证每个功能
*   集成测试 - 验证子系统
*   系统测试 - 验证功能
*   回归测试 - 验证缺陷保持不变
*   安全测试 - 验证系统不容易被渗透。

测试人员从外部开始，向内工作，专注于功能：

*   验收测试 - 验证最终用户要求
*   场景测试 - 验证真实世界的情况
*   全局测试 - 验证可行的输入
*   回归测试 - 验证缺陷保持不变
*   可用性测试 - 验证系统是否易于使用
*   安全测试 - 验证系统不容易被渗透
*   代码覆盖率 - 测试未触及的代码
*   兼容性 - 与以前的版本
*   寻找怪癖和粗糙的边缘。

最终用户从外部工作，通常很少关注：

*   验收测试 - 验证最终用户要求
*   场景测试 - 验证真实世界的情况
*   可用性测试 - 验证系统是否易于使用
*   寻找怪癖和粗糙的边缘。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-24T01:08:50.913

我喜欢[Brian Marick](http://www.exampler.com/old-blog/2003/08/21/#agile-testing-project-1)关于自动化测试的象限，其中区别是面向业务与技术，支持编程与批评产品。

有了这个框架，平衡的问题就变成了，我现在需要什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T20:32:42.000

在我目前正在开发的应用程序上，功能测试可能有 10:1 的单元。单元测试的工作很简单，比如从数据库中检索实体、数据库/网络连接的错误处理测试等。这些东西运行得很快——几分钟或更短，并且由开发人员每天运行。

功能测试虽然较少，但往往是厨房水槽方法 - 用户能否完成订单等往往涵盖业务领域，最终由业务分析和运营运行 - 对我们来说很遗憾，通常是手动运行。这些事情需要几周的时间来运行，并且通常需要完成一个发布周期。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T20:51:09.827

我目前的项目有大约 60% 的单元测试覆盖率，所有用户故事在 selenium 测试中都有用户故事的快乐日覆盖率，有些还有额外的覆盖率。

我们一直在讨论这个问题：为了更高的覆盖率，推动单元测试覆盖越来越荒谬的场景真的有什么意义吗？

争论是扩展 selenium 测试增加了对具有商业价值的事物的测试覆盖率。客户真的关心可能失败的单元测试极端案例吗？

当您擅长 selenium 测试时，编写具有商业价值的新测试的成本就会降低。对我们来说，它们就像单元测试一样简单。

运行时成本是另一个问题。我们有一小群盒子一直在运行这些测试。

所以我们倾向于更喜欢网络测试，可能是因为我们已经擅长编写它们并且它们提供了不可否认的商业价值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T21:13:44.990

最初，由于验收测试的初始成本因素，我倾向于选择单元测试而不是功能/验收测试。然而，随着时间的推移，我改变了我的理念，现在我强烈支持尽可能选择验收测试，并且只在验收测试不能满足我的需求时使用单元测试。

选择验收而不是单元测试的基本原理与[SOLID的基本原理相同](http://codebetter.com/blogs/david_laribee/archive/2008/09/09/why-solid-gimme-an-s.aspx)代码。您的实现应该能够通过重构等发生巨大变化，但所有业务案例 - 验收测试 - 应该能够保持不变并证明可接受的系统行为（测试通过）。对于单元测试，测试与实现代码之间通常存在自然的强耦合。即使它是测试代码，它仍然是代码，应该避免强耦合。通过选择验收测试，您通常会沿着成功的螺旋式下降，以创建精心计划的、可消耗的解耦 api，让您的实现在幕后更改，而无需强制更改测试。此外，您的开发人员实施思想与业务系统行为思想一致。最后，我发现所有这些对业务和编码人员的满意度都更好。

从理论的角度来看，我经常问自己，如果不能通过验收测试来测试一段代码，为什么那段代码应该存在？IE - 如果它不是有效业务场景的一部分，那么该代码是否增加了价值，或者目前是否会增加成本？

此外，如果您很好地评论/记录您的验收测试，那么这些评论/文档通常是系统中最新和最准确的语言 - 这通常可以让您避免使用其他价值较低的文档方法。单元测试不适合这种形式的“业务术语”通信。

最后，我并没有仅仅从我的个人发展形成这个观点，在我的“非常公司”的工作环境中，几个不同的项目团队已经证明它是成功的。

JB [http://jb-brown.blogspot.com](http://jb-brown.blogspot.com)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-23T21:17:11.240

测试应该快速运行并帮助定位问题。单元测试允许您通过仅测试有问题的模块来做到这一点。然而，功能/集成/验收测试可以在大多数 Web 场景中足够快地运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-24T23:42:44.713

我曾经读到单元测试是一个“可执行要求”，这对我来说非常有意义。如果您的测试不专注于证明业务需求，那么它真的没有用。如果您有详细的要求（那就是酸测试），那么您将编写许多单元测试来练习每个可能的场景，从而确保您的数据结构算法和逻辑的完整性。如果您正在测试一些不是要求的东西，但您知道必须为真才能通过测试，那么您很可能缺少要求。

# .net - 如何让 .NET CCW 程序集从 dll.config 加载配置

> ID：312906
> 
> 赞同：2
> 
> 时间：2008-11-23T20:23:03.457
> 
> 标签：.net, com-interop, configuration-files

我有一个 .NET 组件公开为**CCW**（Com Callable Wrapper）并被加载到非托管 IIS 应用程序（ATL 服务器）中。该程序集使用`regasm /codebase`.

该组件需要配置，例如通常放入 IIS 应用程序的 Web.config 文件中。但我不想将配置放入 w3pw.exe.config 或 machine.config - 理想情况下，我希望将配置与暴露给 COM 的程序集一起实时安装。

我还没有找到实现这一目标的方法。由于 COM 程序集被加载到默认的 AppDomain 中，所以我认为我不能将该域配置为从备用位置加载。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T21:22:40.840

你可以试试

```
AppDomain.CurrentDomain.SetData ("APP_CONFIG_FILE",ConfigFile); 
```

其中 ConfigFile 是应用程序的 app.config 文件的完整路径。(c:\test\myapp.config) 从将 App.Config[数据加载到 DLL 中](http://thisoldcode.net/PermaLink,guid,3b28420f-7683-457f-8d2f-c29674bf4571.aspx)

# algorithm - 合并至少共享 2 个元素的集合的算法

> ID：312912
> 
> 赞同：13
> 
> 时间：2008-11-23T20:27:03.633
> 
> 标签：algorithm, set, graph-theory

给定一个集合列表：

*   S_1：[1、2、3、4]
*   S_2：[3、4、5、6、7]
*   S_3 : [ 8, 9, 10, 11 ]
*   S_4：[1、8、12、13]
*   S_5 : [ 6, 7, 14, 15, 16, 17 ]

合并所有共享至少 2 个元素的集合的最有效方法是什么？我想这类似于连接组件问题。所以结果是：

*   [ 1, 2, 3, 4, 5, 6, 7, 14, 15, 16, 17] (S_1 UNION S_2 UNION S_5)
*   [ 8, 9, 10, 11 ]
*   [ 1, 8, 12, 13 ]（S_4 与 S_1 共享 1，与 S_3 共享 8，但未合并，因为它们仅共享一个元素）

朴素的实现是 O(N^2)，其中 N 是集合的数量，这对我们来说是行不通的。这需要对数百万组有效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T21:51:45.290

```
Let there be a list of many Sets named (S)

Perform a pass through all elements of S, to determine the range (LOW .. HIGH).

Create an array of pointer to Set, of dimensions (LOW, HIGH), named (M).

do
    Init all elements of M to NULL.   

    Iterate though S, processing them one Set at a time, named (Si).

        Permutate all ordered pairs in Si. (P1, P2) where P1 <= P2.
        For each pair examine M(P1, P2)
            if M(P1, P2) is NULL
                Continue with the next pair.
            otherwise
                Merge Si, into the Set pointed to by, M(P1, P2).
                Remove Si from S, as it has been merged.
                Move on to processing Set S(i + 1)

        If Si was not merged, 
            Permutate again through Si
            For each pair, make M(P1, P2) point to Si.

while At least one set was merged during the pass. 
```

我的头是说这是关于订单（2N ln N）。带着一粒盐。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T21:18:00.817

如果您可以对集合中的元素进行排序，则可以考虑在集合上使用[Mergesort](http://en.wikipedia.org/wiki/Merge_sort)。唯一需要的修改是在合并阶段检查重复项。如果找到，只需丢弃重复项。由于归并排序是 O(n*log(n))，与朴素的 O(n^2) 算法相比，这将提供改进的速度。

但是，要真正有效，您应该维护一个排序集并使其保持排序，这样您就可以跳过排序阶段并直接进入合并阶段。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T08:14:44.237

我看不出这如何在少于 O(n^2) 的时间内完成。

每个集合都需要与其他集合进行比较，以查看它们是否包含 2 个或更多共享元素。这是 n*(n-1)/2 比较，因此 O(n^2)，即使检查共享元素需要恒定时间。

在排序中，简单的实现是 O(n^2) 但您可以利用有序比较的传递性（例如，您知道快速排序的下分区中的任何内容都不需要与上分区中的任何内容进行比较，因为它已经与枢轴进行了比较）。这就是排序为 O(n * log n) 的原因。

这不适用于这里。因此，除非集合有什么特别之处，可以让我们跳过基于先前比较结果的比较，否则它通常会是 O(n^2)。

保罗。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T21:23:56.717

附注：这取决于这种情况发生的频率。如果大多数集合对*确实*共享至少两个元素，那么在您逐步进行比较的同时构建新集合可能是最有效的，如果它们不符合条件则将其丢弃。如果大多数对*不*共享至少两个元素，那么将新集合的构建推迟到条件确认后可能会更有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T21:41:13.220

如果您的元素本质上是数字的，或者可以自然排序（即，您可以分配一个值，例如 1、2、42 等...），我建议对合并集使用基数排序，然后再做一个传球以了解独特的元素。

该算法应该是 O(n)，并且您可以使用按位移位运算符和位掩码对基数排序进行相当多的优化。我为我正在做的一个项目做了类似的事情，它就像一个魅力。

# procmail - Procmail 问题

> ID：312915
> 
> 赞同：0
> 
> 时间：2008-11-23T20:27:53.790
> 
> 标签：procmail

几周以来我一直在努力解决这个问题......

我的目标是在我的收件箱中搜索以下消息：

```
Hello
Hi
Hey 
```

我使用三个文件为我执行此操作。第一个，我的 $HOME 中的 .forward 文件

```
"|IFS=' '&&exec usr/bin/procmail||exit 75 #username" 
```

这两个在我的 ~/.procmail 目录中

```
.procmailrc

VERBOSE=off
MAILDIR=$HOME/Mail
PMDIR=$HOME/.procmail
DEFAULT=/var/spool/mail/username
LOGFILE=$PMDIR/log
INCLUDERC=$PMDIR/general.rc
#end of .procmailrc 
```

最后是规则文件：general.rc

```
:0
* ^From:.*sumone@sumaddy.com
* ^Subject:.*hello
$HOME/Mail/Hello 
```

应该发生的是，所有这三个文件共同复制和移动主题中包含 hello 模式的邮件。为了安全起见，它还会寻找某个人的地址。然后，当这些模式匹配时，它将坚持找到的内容并创建指定的路径；如果它还不存在。

但它没有这样做。我在emacs、vi、..中编辑完这些文件然后保存后，它会自动工作吗？还是我需要编译它？

如果我这样做，.procmailrc 可能需要（如果不是全部）'Shell=/bin/sh'

不是我没试过...

* * *

不，我开发不佳的设计是处理传入的邮件..

我已经通过向自己发送电子邮件对其进行了测试。

我认为，我的 General.RC 文件不是编码写入的。因为，在我给自己发送电子邮件后，它应该直接复制并将其移动到指定的目录。

* * *

难怪我犯了这些错误，我已经编辑了这三个文件一百万次。

我的 LOG 文件中没有显示任何内容...

我已经修复了其他所有问题，并且我知道我的 /usr/bin/procmail 存在，因为我使用 whereis 来查看它的路径。

但我的测试仍然失败。我不断给自己发送电子邮件并检查我的邮件文件夹，看看我的“你好”文件中的字节是否增加了..

我怎样才能让日志工作？general.rc 错了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T20:59:09.187

Procmail 会在邮件进入时处理它，而不是当它只是放在您的邮箱中时。如果您想处理已经在您的邮箱中的邮件，您必须再次通过 procmail 传递它，或者通过“退回”给自己，或者通过 procmail 管道传递。在像 mutt 这样的命令行电子邮件客户端中，您可以使用 'b' 命令执行前者，后者通过键入`|procmail`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T21:14:24.100

如果您希望处理已有的电子邮件，您需要：

1.  退出任何邮件客户端
2.  移开您当前的收件箱 (mv /var/spool/mail/username /tmp/mail.username )
3.  formail +1 -ds procmail < /tmp/mail.username

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-24T01:03:20.427

1.  您的 ~.forward 文件在 usr 之前缺少一个“/”。另外，您可以像这样保持简短；

    "| **/**usr/bin/procmail"

2.  将您的 .procmailrc 放在您的 HOME 目录下
3.  设置 MAILDIR 后，在 general.rc 中只写“Hello”作为邮箱名称。同样在配方开头使用“：0：”来启用锁定，所有交付都必须锁定邮箱文件！
4.  确保您在服务器上的 /usr/bin/procmail 中安装了 procmail。
5.  确保您的 MAILDIR 中存在“Hello”文件。
6.  检查日志文件

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-02T01:12:56.833

我认为在进行任何其他调试之前，您主要关心的是验证 procmail 是否正在您传入的电子邮件消息上运行。

我的建议是让你的 .procmailrc 文件看起来像这样（没有别的）

```
VERBOSE=on
LOGFILE=/tmp/procmail.log

:0 fhbw
| sed "s/^Subject:/& --procmail working--/" 
```

然后给自己发一封电子邮件。

您应该在 /tmp/procmail.log 中获得一个日志文件，并且您的电子邮件应该到达您的邮箱，并且主题行已修改为包含“--procmail working--”。

如果这不起作用，则不会调用 procmail，您应该编辑问题以显示 .forward 文件的当前内容。

如果可行，那么问题出在 .procmailrc 或 general.rc 文件的内容上。您应该编辑您的问题以显示这两个文件的当前内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-09T07:51:35.890

如果您只想在磁盘上查找带有这些主题行之一的邮件，我建议`fgrep`您在收件箱中查找。

# c# - 在 Silverlight 中的 TextBox 上按 Enter

> ID：312922
> 
> 赞同：10
> 
> 时间：2008-11-23T20:33:55.430
> 
> 标签：c#, silverlight, silverlight-2.0

我正在开发一个 Silverlight 应用程序，您需要在文本框中输入信息，然后按 Enter。好吧，我没有找到 onclick 事件，所以我所做的是使用 onkeypressup 事件并检查是否是按下的回车键，如果这样做“等等”。

只是感觉有更好的方法来做到这一点。那么问题来了，有吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-24T02:48:50.120

我认为这是捕捉 Key.Enter 的方法。

此外，如果您使用 KeyDown 事件而不是 KeyUp 事件，您的代码将更具可读性。

如果您只关心为单个控件捕获 Key.Enter，那么您的方法是正确的。

您还可以通过使用其容器的 KeyDown 事件（“事件冒泡”）来捕获一组相关控件的 Key.Enter。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-23T21:06:26.410

你真的想要它在文本框中吗？我会在容器（例如 Grid、Canvas）上放置一个 onkeyup 处理程序，以便在表单上的任意位置按下按钮。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-12T10:06:01.470

如果您想绑定 Command 属性而不是使用 Click 事件，这将起作用。首先为 Click 创建一个事件处理程序（见下文），然后在 KeyUp 中执行：

```
 private void MyTextBox_KeyUp(object sender, KeyEventArgs e)
    {
        if (e.Key == Key.Enter) SomeButton_Click(this, null);

    }

    private void SomeButton_Click(object sender, RoutedEventArgs e)
    {
        ICommand cmd = SomeButton.Command;
        if (cmd.CanExecute(null))
        {
            cmd.Execute(null);
        }
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-05T13:19:22.133

使用命令模式时，我使用以下实现：

```
private void MyTextBox_KeyDown(object sender, KeyEventArgs e)
{
    if (e.Key == Key.Enter)
    {
        BindingExpression b = MyTextBox.GetBindingExpression(TextBox.TextProperty); 
        if (b != null)
            b.UpdateSource();

        ICommand cmd = SomeButton.Command;
        if (cmd.CanExecute(null))
            cmd.Execute(null);
    }
} 
```

当您按 Enter 时，文本框的数据源不会更新，并且该命令使用旧值。因此，您必须在执行命令之前调用 UpdateSource。

当然，您可以在比文本框更高的级别上捕获事件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-16T22:22:18.457

好吧，我对 Silverlight 很陌生，我为具有一个 DependencyProperty 按钮的按钮创建了 HitEnter 行为。

然后我手动连接按钮和行为（在后面的代码中），然后当输入时我在按钮上输入命令。

# javascript - Django 身份验证和 Ajax - 需要登录的 URL

> ID：312925
> 
> 赞同：50
> 
> 时间：2008-11-23T20:35:16.240
> 
> 标签：javascript, python, django, authentication

我想在我的 Django 编码网站中添加一些[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29) -niceness。

在我的 Django 代码中，我使用`@login_required`装饰器 from`django.contrib.auth.decorators`来标记哪个视图需要身份验证。未经过身份验证的用户单击它时的默认行为是将他/她重定向到登录页面，然后传递目标页面。

我在一些网站上看到并且非常喜欢的是，当用户点击一个链接到一个仅限登录用户的地方时，他/她不会被重定向到登录页面，而是会弹出一个窗口（通过 JavaScript）询问他/她登录或注册。没有重定向部分，因此如果用户认为他/她真的不喜欢该网站而浪费时间注册，则无需使用“返回”键。

因此，问题是：您将如何管理自动将某些链接标记为“受限”的任务，以便 JavaScript 可以处理它们的`onclick`事件并显示“请登录”弹出窗口？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-02-07T05:20:02.193

我面临同样的问题，并且像您一样，我想要一个简单的装饰器来包裹 Django ajax 视图，以便以与其他视图相同的方式处理身份验证。对我来说似乎很有希望的一种方法是将这样的装饰器与 JavaScript 结合使用，以在响应中查找特定值。

这是装饰器的~~第一次~~修订草案：

```
from functools import wraps

def ajax_login_required(view_func):
    @wraps(view_func)
    def wrapper(request, *args, **kwargs):
        if request.user.is_authenticated():
            return view_func(request, *args, **kwargs)
        json = simplejson.dumps({ 'not_authenticated': True })
        return HttpResponse(json, mimetype='application/json')
    return wrapper 
```

这是视图：

```
@ajax_login_required
def ajax_update_module(request, module_slug, action):
    # Etc ...
    return HttpResponse(json, mimetype='application/json') 
```

这是JavaScript（jQuery）：

```
$.post('/restricted-url/', data, function(json) {
    if (json.not_authenticated) {
        alert('Not authorized.');  // Or something in a message DIV
        return;
    }
    // Etc ...
}); 
```

* * *

**编辑**：我已尝试`functools.wraps`按照建议使用。我实际上并没有在工作代码中使用这个装饰器，所以要小心可能的错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T21:53:30.013

听起来像是页面模板的可能性。

1.  您可以将`LINK_VIA`您提供的 a（或某物）作为`onClick="return popup(this, 'arg')"`or传递`None`。每个链接都是`<A HREF="link" {{LINK_VIA}}>some text</a>`.

    *   对于匿名会话，`LINK_VIA`有一个值。
    *   对于已登录的会话，`LINK_VIA`为 None
2.  您可以在标签周围使用`{% if %}`声明。`<A HREF=...>`这似乎很罗嗦。

3.  您可以使用 for 编写自己的自定义标签`{% link_via %}`。我对此不够熟悉，但是您可以将链接和文本作为字符串提供，并且您的标签可以生成两种链接中的一种。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-23T23:02:44.537

我同意[S.Lott](https://stackoverflow.com/questions/312925/django-authentication-and-ajax-urls-that-require-login#313015)

在模板中进行检查，如果用户已登录，则照常放链接，如果没有，则放类似

```
<a href="{{link}}" onclick="return login_popup()"> 
```

如果用户说取消，login_popup 将返回 false。

这可能在[Jinja2](http://jinja.pocoo.org/2/)中通过它的[宏](http://jinja.pocoo.org/2/documentation/templates#macros)更容易完成。

如果模板不知道哪些 url 需要用户登录，您可能需要重新考虑您的设计。

如果必须的话，我想你可以做与 django url 调度程序相同的事情来发现视图函数。
看：`django.core.urlresolvers`

一旦你抓住了视图功能，你可以检查它是否用@login_required 装饰。

这可能会在自定义标签中完成。
如果您使用 Jinja2，则不需要标签，只需实现功能并将其暴露给 Environment，这很简单，但您必须阅读一下 Jinja2 的 API）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-03-01T14:12:06.773

基于[Eric Walker 的](https://stackoverflow.com/a/523196/5044937)解决方案构建，但适用于 Django 2.0

```
# Standard Imports
import functools
import django.http

def ajax_login_required(view_func):
    @functools.wraps(view_func)
    def wrapper(request, *args, **kwargs):
        if request.user.is_authenticated:
            return view_func(request, *args, **kwargs)

        return django.http.JsonResponse('Unauthorized', status=401, safe=False)

    return wrapper 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-08-21T10:44:48.547

这是带有 wrap.__doc__ ， wrap.__name__ 的装饰器的建议版本

```
from functools import wraps

def ajax_login_required(function):
    def wrap(request, *args, **kwargs):
        if request.user.is_authenticated():
            return function(request, *args, **kwargs)
        json = simplejson.dumps({ 'not_authenticated': True })
        return HttpResponse(json, mimetype='application/json')  
    wrap.__doc__ = function.__doc__
    wrap.__name__ = function.__name__
    return wrap 
```

# python - Windows和apache下的Python作为FastCGI

> ID：312928
> 
> 赞同：6
> 
> 时间：2008-11-23T20:39:15.823
> 
> 标签：python, windows, apache, fastcgi

我需要在具有 windows/apache/FastCGI 的现有系统下运行一个简单的请求/响应 python 模块。

我尝试过的所有 python 的 FastCGI 包装器都只适用于 Linux（它们使用 socket.fromfd() 和其他类似的东西）。

是否有在 Windows 下运行的包装器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T19:08:44.413

您可能会发现完全放弃 FastCGI 并在 localhost 端口上运行 python 网络服务器更容易。然后只需使用 mod_rewrite 将 apache url 映射到内部网络服务器。

（我开始在我的托管公司提供 FastCGI，令我惊讶的是，几乎每个人都放弃了它，转而只在我提供的端口上运行自己的 Web 服务器。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T20:43:16.910

一个[Django 错误](http://code.djangoproject.com/ticket/8742)表明[python-fastcgi](http://pypi.python.org/pypi/python-fastcgi)可以为您工作，它的 PyPI 页面报告说它可以在 Windows 上工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T21:36:14.807

我建议[mod_python](http://www.modpython.org/)或[mod_wsgi](http://code.google.com/p/modwsgi/)。

# c# - Windows 窗体 ProgressBar：启动/停止选取框的最简单方法？

> ID：312936
> 
> 赞同：83
> 
> 时间：2008-11-23T20:49:07.070
> 
> 标签：c#, winforms, progress-bar

我正在使用 C# 和 Windows 窗体。我在程序中有一个正常的进度条工作正常，但现在我有另一个操作无法轻松计算持续时间。我想显示一个进度条，但不知道启动/停止滚动选取框的最佳方式。我希望有一些简单的东西，比如设置选取框速度，然后有一个 start() 和 stop() ，但它似乎并不那么简单。我必须在后台运行一个空循环吗？我怎样才能最好地做到这一点？谢谢

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-11-23T21:40:20.600

使用样式设置为 的进度条`Marquee`。这表示一个不确定的进度条。

```
myProgressBar.Style = ProgressBarStyle.Marquee; 
```

您还可以使用该[`MarqueeAnimationSpeed`](http://msdn.microsoft.com/en-us/library/system.windows.forms.progressbar.marqueeanimationspeed.aspx)属性来设置小块色块在进度条上设置动画所需的时间。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-03-03T18:06:01.400

要开始/停止动画，您应该这样做：

开始：

```
progressBar1.Style = ProgressBarStyle.Marquee;
progressBar1.MarqueeAnimationSpeed = 30; 
```

停止：

```
progressBar1.Style = ProgressBarStyle.Continuous;
progressBar1.MarqueeAnimationSpeed = 0; 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-23T21:52:00.157

这不是他们的工作方式。您通过使其可见来“启动”选取框样式的进度条，通过隐藏它来停止它。您可以更改 Style 属性。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-07-14T23:16:05.870

此代码是用户等待身份验证服务器响应的登录表单的一部分。

```
using System;
using System.ComponentModel;
using System.Threading;
using System.Windows.Forms;

namespace LoginWithProgressBar
{
    public partial class TheForm : Form
    {
        // BackgroundWorker object deals with the long running task
        private readonly BackgroundWorker _bw = new BackgroundWorker();

        public TheForm()
        {
            InitializeComponent();

            // set MarqueeAnimationSpeed
            progressBar.MarqueeAnimationSpeed = 30;

            // set Visible false before you start long running task
            progressBar.Visible = false;

            _bw.DoWork += Login;
            _bw.RunWorkerCompleted += BwRunWorkerCompleted;
        }

        private void BwRunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            // hide the progress bar when the long running process finishes
            progressBar.Hide();
        }

        private static void Login(object sender, DoWorkEventArgs doWorkEventArgs)
        {
            // emulate long (3 seconds) running task
            Thread.Sleep(3000);
        }

        private void ButtonLoginClick(object sender, EventArgs e)
        {
            // show the progress bar when the associated event fires (here, a button click)
            progressBar.Show();

            // start the long running task async
            _bw.RunWorkerAsync();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-23T21:29:05.910

MSDN 上有一篇不错的[文章](http://msdn.microsoft.com/en-us/magazine/cc163909.aspx)，其中包含有关此主题的代码。我假设将 Style 属性设置为 ProgressBarStyle.Marquee 是不合适的（或者那是您要控制的？？-尽管您可以控制速度，但我认为无法停止/启动此动画正如@Paul 指出的那样）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-07-13T20:29:25.763

这里已经有很多好的答案，尽管您还需要记住，如果您在 UI 线程上进行长时间运行的处理（通常是一个坏主意），那么您也不会看到选取框移动。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-11-23T20:55:12.470

您可以使用[计时器](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx)（System.Windows.Forms.Timer）。

钩住它的 Tick 事件，前进然后进度条，直到它达到最大值。当它（达到最大值）并且您没有完成工作时，将进度条值重置为最小值。

...就像 Windows 资源管理器 :-)

# apache-flex - Flex 3 中的 virtual 关键字是否会导致性能下降？

> ID：312938
> 
> 赞同：0
> 
> 时间：2008-11-23T20:50:16.693
> 
> 标签：apache-flex, flex3, virtual

正如标题所说的那样。虚拟关键字是否会导致性能下降？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T21:33:44.810

首先，在 Actionscript 中，您不需要像在 C# 中那样显式地将要覆盖的方法标记为虚拟方法，编译器会为您执行此操作。这就是为什么关键字没有出现在任何文档中的原因，因为从开发人员的角度来看它是无关紧要的。

不过，要回答您的问题，即是否覆盖方法会使其变慢，只要您的类是密封的，答案是否定的，这意味着您在定义类时不使用“动态”关键字。

原因是在构造密封类时，您将对该对象的每个方法都有显式标记，当覆盖方法时，您会直接获得新函数的标记，该类不必查找它运行时就像在动态类中一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T21:39:08.030

现在所有方法在 AS3 中都是虚拟的。但我的猜测是“虚拟”将在未来版本的 AS poss 中强制执行。通过一些编译器选项设置。

# uml - UML用例图后置条件实现（附图）

> ID：312942
> 
> 赞同：2
> 
> 时间：2008-11-23T20:54:23.330
> 
> 标签：uml, use-case

我通过尝试模拟汽车服务车库如何使用图表和文档来学习 UML。我遇到的一个问题是后置条件（或者更确切地说，GOTO）语句。

虚线 << include >> 关系仅用于前提条件吗？用例气泡可以相互连接并遵循逻辑路径吗？

所以这就是我到目前为止所拥有的...... 1）“结算付款”泡沫在错误的地方吗？是否应该将其 << include >>ed 到其他气泡中？2）我是否应该将“请求服务”气泡也与技术人员联系起来，因为他将是修理汽车的人？

图片

![http://i.stack.imgur.com/iIBIt.jpg](https://i.stack.imgur.com/iIBIt.jpg)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T22:22:16.490

用例就像类。它们具有继承（扩展）和关系，例如包含和使用。

先决条件是常见的关系约束。我们中的一些人在用例的文本中写了前置条件和后置条件。您可以绘制它，但这不是必需的。

不要尝试对用例气泡进行排序。这就是活动图和序列图的用途。这就是叙事文本的用途。这是用户已经知道的事情。

此外，不要浪费大量时间将用例视为超高级编程语言。请记住，演员们已经知道他们在做什么；他们不需要帮助排序。

您需要专注于捕获参与者、用例以及用例中的基本“扩展”、“使用”、“包含”。用例模型不是编程。用例图是“谁”和“什么”的知识捕获。

将其视为更像是定义参与者可以做什么的安全模型。顺序、顺序和其他细节并不像演员做什么那么重要。

当您将 Actor 与 Actor 关联时（例如 Technician 和 Front Desk），您是在说 Actor 在系统之外进行交互。您是说技术人员从不登录系统来完成他们的工作或记录他们的时间。

如果技术人员确实会登录以获取工作并记录时间，那么技术人员会参与一些用例。

用例不是编程。他们是演员做的事情。用例是通过构建在一个大型的通用软件中来连接的。您不需要在用例之间绘制数据流或逻辑箭头。它们都可以在很大程度上独立。

设计系统时，您将实现以某种顺序连接用例的 UI 功能和数据库功能。

# silverlight - Silverlight 设计架构

> ID：312947
> 
> 赞同：3
> 
> 时间：2008-11-23T20:58:15.303
> 
> 标签：silverlight

有没有好的 Silverlight 设计架构？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T21:06:42.993

[Prism](http://www.codeplex.com/CompositeWPF)最初是为 WPF 设计的，但现在有 Silverlight 版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T17:58:51.173

还有[Caliburn](http://www.codeplex.com/caliburn/)，一个“Silverlight 和 WPF 的应用程序框架”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-25T00:52:31.777

您可以查看 Rocky Lhotka 的 Silverlight 的 CSLA.NET - [CslaLight](http://www.lhotka.net/cslalight/Default.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T13:34:39.427

很快，微软将发布新版本的 Prism（尽管与之前的答案不同），Silverlight 版本的 Prism 只是一个概念证明。PnP 团队希望在接下来的几个月内发布完整版本。今天流行的故事是使用 WPF 已经成功使用的相同 MVVM 模式（搜索 Silverlight 和 MVVM 会产生很多信息）。

# .net - 将值传递给 .Net 中的表单

> ID：312948
> 
> 赞同：0
> 
> 时间：2008-11-23T20:59:04.567
> 
> 标签：.net, winforms, c++-cli

我想将一个整数值传递给 .Net 中的表单，以便它可以加载正确的数据。我正在使用它，以便当我双击列表中的记录时，会打开一个表单，其中加载了该记录中的数据，因此可以对其进行编辑。做这个的最好方式是什么？我应该在调用 Show() 方法之前创建一个属性并设置它，还是应该重载构造函数或其他东西并以这种方式将值作为初始化值发送？

注意 - 这不需要向表单发送多个值 - 只需要一个值。

这并不重要，但这是在 C++ .Net 中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T21:04:28.160

我会建议别的东西。

创建一个静态方法（到您要打开的表单） - 将参数传递给静态方法。

让静态方法来新建表单、加载数据并调用 Show 方法。

这样调用表单就不必过多地弄乱表单（ctor、设置值、调用 show）——你将这个逻辑远离并封装在表单中——这意味着你也可以在不复制的情况下重复使用它代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T21:46:02.057

在构造函数中使其成为强制性的。如果您没有要编辑的内容，那么拥有这些表单之一是没有意义的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T22:00:16.863

添加一个接受参数并调用默认构造函数的新构造函数。通过保留默认构造函数，您仍然可以使用 Visual Studio 表单设计器，并且您的新构造函数需要做的就是存储该值。

或者您可以添加一个存储该值的公共属性。然后创建表单类的对象、设置属性并显示表单。

# c++ - 在 C++ 中，如何将 >> 和 << 运算符用于二进制数据？

> ID：312957
> 
> 赞同：4
> 
> 时间：2008-11-23T21:06:43.727
> 
> 标签：c++, stream

有没有办法使用这些运算符来输入和输出二进制数据？我想这样做的原因是它使代码可读。例如：infile >> filedecrypter >> metadataparser >> audiodecoder >> effects >> soundplayer；

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T22:18:33.910

需要明确的是，您是否打算复制 iostream 的语义？因为看起来你提出了一些不同的建议。在您给出的示例中：

```
infile >> filedecrypter >> metadataparser >> audiodecoder >> effects >> soundplayer; 
```

在 iostreams 中，这里的意思是从 infile 读取到 filedecrypter 直到你得到空白，然后从 infile 读取到 metadataparser 直到更多的空白，等等。

看起来您提出了一些不同的建议，其中 metadataparser 从 filedecrypter 读取，从 metadataparser 读取 audiodecoder 等。在这种情况下，我认为您的问题的答案需要稍微限定一下。

**你能用运算符 >>**来表达这个结构吗？**可能是**的。

**您可以为此**使用 iostreams吗？****可能不是**。**

 **我建议您在说 A >> B 时澄清它的含义。也许首先将其表达为常规方法而不是运算符重载，这可能会澄清问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T21:08:33.753

`operator<<`如果库或您的代码为其工作提供重载，那么确实可以做到`operator>>`这一点。关于如何做到这一点的简单示例：

```
class transformer {
    public:
    virtual std::iostream& transform(std::iostream&) = 0;
};

class noise : public transformer {
    public:
    virtual std::iostream& transform(std::iostream&) {
         /* extract, change and put into again */
    }
};

class echo : public transformer {
    public:
    virtual std::iostream& transform(std::iostream&) {
         /* extract, change and put into again */
    }
};

std::iostream& operator>>(std::iostream& io, transformer& ts) {
    return ts.transform(io);
}

int main() {
    std::stringstream data;
    std::ifstream file("sound.wav");

    noise n; echo e;

    data << file.rdbuf();
    data >> n >> e;
    /* pipelined data now ready to be played back */
} 
```

使用 pure 的问题`std::istream`在于您会阅读，但是您无法将转换后的数据放回管道中的下一步。因此我在`std::iostream`这里使用。这种方法似乎效率不高，因为每个 operator>> 调用都会提取整个数据，然后再次放入。

要拥有一种更高效的流式传输方式，那就是创建一个`expression template`. 这意味着，当`operator>>`被调用时，您还没有进行转换，但您返回的表达式类型将记录其类型内的操作链：

```
typedef transform< echo< noise< istream > > > pipeline;
std::ifstream file("file.wav");
pipeline pipe(file);
int byte = pipe.get(); 
```

将是这种类型的一个例子。管道的结构被解码为类型本身。因此，管道中不再需要虚函数。不是按需构建的，这里使用typedef来说明原理。编写这样一个系统并不容易。因此，您可能应该研究现有系统，例如 Boost.Iostreams（见下文）。为了让您了解它的外观，这是我刚刚为您编写的示例:)：

```
#include <iostream>

template<typename T>
struct transformer {
    int get() {
        return static_cast<T*>(this)->read();
    }
};

struct echot {
    template<typename Chain>
    struct chain : transformer< chain<Chain> > {
        Chain c;

        int read() {
            return c.get() + 1;
        }

        chain(Chain const& c):c(c) { }
    };
} echo;

struct noiset {
    template<typename Chain>
    struct chain : transformer< chain<Chain> > {
        Chain c;

        int read() {
            return c.get() * 2;
        }

        chain(Chain c):c(c) { }
    };
} noise;

template<typename T>
typename T::template chain<std::istream&> operator>>(std::istream& is, T) {
    return typename T::template chain<std::istream&>(is);
}

template<typename T, typename U>
typename U::template chain<T> operator>>(T t, U u) {
    return typename U::template chain<T>(t);
}

int main() {
    std::cout << (std::cin >> echo >> noise).get() << std::endl;
} 
```

此处输入 0 得到 ASCII 码 48，加 1，再乘以 2，得到值 98，最终也输出。我认为您同意这不是初学者想要编写的代码。所以也许考虑提升。

Boost 有一个复杂的 iostreams 库，它可以做很多事情。我相信你会找到适合这个的东西。[Boost.Iostreams](http://www.boost.org/doc/libs/1_37_0/libs/iostreams/doc/index.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T21:20:10.797

当然可以。只需定义您自己的 operator>> 和 operator<< 以便他们做“正确的事”...

我会这样做，所以我会在类中有方法，比如 toStream(ostream& os) 和 fromStream(istream& )，然后定义

```
istream& operator>> (istream& is, T& t)
{
     t.fromStream(is);
     return t;
}

ostream& operator<< (ostream& os, const T& t)
{
     t.toStream(os);
     return t;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-23T22:16:24.567

无需使用流来移动数据。您可以创建自己的类来执行此操作。这显示了一个例子。显然，Decrypt 和 MetaDataParser 类可以是具有虚函数的抽象基类，以允许将各种功能插入在一起。

```
#include <iostream>                                                         
#include <istream>                                                          
using namespace std;                                                        

class Data2                                                                 
{                                                                           
};                                                                          

class Data3                                                                 
{                                                                           
};                                                                          

class Decrypt                                                               
{                                                                         
};                                                                          

class MetaDataParser                                                        
{                                                                           
};                                                                          

Data2& operator>>(istream& in, Decrypt& decrypt)                            
{                                                                           
  return *new Data2;                                                        
}                                                                           

Data3& operator>>(Data2& d2, MetaDataParser& mdp)                           
{                                                                           
  return *new Data3;                                                        
}                                                                           

int main()                                                                  
{                                                                           
  Decrypt decrypt;                                                          
  MetaDataParser mdp;                                                       

  cin >> decrypt >> mdp;                                                    
} 
```

# jquery - 鼠标悬停后一直淡入

> ID：312967
> 
> 赞同：1
> 
> 时间：2008-11-23T21:15:30.540
> 
> 标签：jquery, fade

我试图淡入

在鼠标悬停和在鼠标移出时淡出：

```
 $("p.follow").mouseover(function(){
        $(this).fadeTo("slow", 1.00);
})
$("p.follow").mouseout(function(){
        $(this).fadeTo("fast", 0.50);
}) 
```

如果你去 ryancoughlin.com 并在右侧，如果你翻过它，你会明白我的意思，它几乎就像被卡住并不断淡入一样。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T21:22:20.760

试试这个：

```
$("p.follow").hover(function()
   {
      $(this).stop().fadeTo("slow", 1.00);
   },
   function()
   {
      $(this).stop().fadeTo("fast", 0.50);
   }); 
```

两个关键区别：我使用 jQuery[`hover`](http://docs.jquery.com/Events/hover)事件来关联 mouseover 和 mouseout 事件处理程序，这样子元素不会导致混乱的行为，并且我使用该[`stop()`](http://docs.jquery.com/Effects/stop)函数来防止动画重叠和相互抵消。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T09:18:04.530

可能值得看一下[hoverintent](http://cherne.net/brian/resources/jquery.hoverIntent.html)插件，它基本上使用了一点 setTimeout，这样如果用户快速将鼠标移过元素，它就不会激活。自己编写代码很容易，但值得一看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T21:23:25.457

每次鼠标移到元素上时都会触发 mouseover 事件。由于效果是按顺序执行的，并且鼠标悬停非常频繁地触发，因此您会得到很多必须“缓慢”执行的效果。

您可能想要的是悬停事件，每个条目只执行一次。

# php - 如何修复 Apache 不稳定？

> ID：312983
> 
> 赞同：0
> 
> 时间：2008-11-23T21:28:31.000
> 
> 标签：php, apache2, debian

我在 Debian 上配置了一个简单的 LAMP 堆栈，但我遇到了 Apache Web 服务器的一些问题。

每 3-4 小时，Web 服务器就会进入死锁状态，并且所有命中数据库的请求都会阻塞。服务器正在为每个请求创建一个新的子节点。进程的数量增加得非常快。几秒钟后，Monit 发现有问题并重新启动 Apache 服务器。

我怀疑这个问题是由 PHP 处理数据库连接池的方式产生的，因为服务器仍然能够回答静态内容请求。你经历过这样的行为吗？我应该怎么做？

**更新：**问题解决了。将 APC 用于操作码缓存和用户数据似乎是个坏主意。我现在使用 Memcache 来存储用户数据，而 APC 仅用于代码。我仍然不时遇到一些分段错误，但服务器大部分时间都很稳定。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T22:02:33.910

我怀疑问题是：

*   一个困难的长时间运行的数据库查询，它会阻止进一步的请求。如果您使用只有表级锁定的 MySQL MyISAM 引擎，这相当容易，并且读取器可以轻松阻塞写入器，反之亦然，因此对用户表的单个棘手查询几乎可以阻塞整个服务器，同时数据库等待 I/O。您通常可以使用“SHOW PROCESSLIST”或为您执行此操作的工具来诊断此问题。
*   对于 prefork 服务器上可用的 RAM，将 MaxClients 设置得太高 - 几乎每个人都这样做。如果您使用的是“胖”的 prefork Apache（例如，使用进程内 PHP），那么不要将 MaxClients 设置为高于您有足够 ram 的值。这可能比 100 或 150 的典型值小很多。

这两件事共同导致了您所看到的问题。它们都需要修复，因为它们可能单独导致问题。

这完全基于猜测和经验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T21:40:21.350

为什么不看日志？`/var/log/apache2/*`是一个很好的起点。在服务器死机之前请求什么？从那里开始，您可能可以推断出问题所在。由于 php 脚本默认在 30 秒后终止，因此错误需要相当大才能导致类似的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-23T21:47:54.157

检查您在 /etc/apache2/apache2.conf 中的超时设置，当 Timeout 设置为高并且系统被一堆断开的连接击中时，我看到了类似的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-08T18:35:59.313

mysql-slow 日志对于查找导致问题的缓慢查询也很有用。

# regex - 正则表达式将查询字符串值解析为命名组

> ID：312989
> 
> 赞同：1
> 
> 时间：2008-11-23T21:31:32.083
> 
> 标签：regex, query-string, groupname

我有一个包含以下内容的 HTML：

```
... some text ...
<a href="file.aspx?userId=123&section=2">link</a> ... some text ...
... some text ...
<a href="file.aspx?section=5&user=678">link</a> ... some text ...
... some text ... 
```

我想解析它并与命名组匹配：

**比赛 1**

组[“用户”]=123

组[“部分”]=2

**比赛 2**

组[“用户”]=678

组[“部分”]=5

如果参数总是按顺序排列，首先是用户，然后是部分，我可以做到这一点，但如果顺序不同，我不知道该怎么做。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-01-13T16:53:27.927

在我的情况下，我必须解析一个 Url，因为实用程序[HttpUtility.ParseQueryString](http://msdn.microsoft.com/en-us/library/ms150045.aspx)在 WP7 中不可用。所以，我创建了一个这样的扩展方法：

```
public static class UriExtensions
{
    private static readonly Regex queryStringRegex;
    static UriExtensions()
    {
        queryStringRegex = new Regex(@"[\?&](?<name>[^&=]+)=(?<value>[^&=]+)");
    }

    public static IEnumerable<KeyValuePair<string, string>> ParseQueryString(this Uri uri)
    {
        if (uri == null)
            throw new ArgumentException("uri");

        var matches = queryStringRegex.Matches(uri.OriginalString);
        for (int i = 0; i < matches.Count; i++)
        {
            var match = matches[i];
            yield return new KeyValuePair<string, string>(match.Groups["name"].Value, match.Groups["value"].Value);
        }
    }
} 
```

然后就是使用它的问题，例如

```
 var uri = new Uri(HttpUtility.UrlDecode(@"file.aspx?userId=123&section=2"),UriKind.RelativeOrAbsolute);
        var parameters = uri.ParseQueryString().ToDictionary( kvp => kvp.Key, kvp => kvp.Value);
        var userId = parameters["userId"];
        var section = parameters["section"]; 
```

**注意：**我直接返回 IEnumerable 而不是字典，只是因为我假设可能存在重复的参数名称。如果有重复的名字，那么字典会抛出异常。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T22:13:39.113

为什么要使用正则表达式来拆分它？

您可以先提取查询字符串。在 & 上拆分结果，然后通过从 = 上拆分结果来创建地图

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T00:00:23.063

您没有指定您正在使用哪种语言，但这应该可以在 C# 中解决问题：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;

namespace RegexTest
{
    class Program
    {
        static void Main(string[] args)
        {
            string subjectString = @"... some text ...
                <a href=""file.aspx?userId=123&section=2"">link</a> ... some text ...
... some text ...
<a href=""file.aspx?section=5&user=678"">link</a> ... some text ...
... some text ...";
            Regex regexObj = 
               new Regex(@"<a href=""file.aspx\?(?:(?:userId=(?<user>.+?)&section=(?<section>.+?)"")|(?:section=(?<section>.+?)&user=(?<user>.+?)""))");
            Match matchResults = regexObj.Match(subjectString);
            while (matchResults.Success)
            {
                string user = matchResults.Groups["user"].Value;
                string section = matchResults.Groups["section"].Value;
                Console.WriteLine(string.Format("User = {0}, Section = {1}", user, section));
                matchResults = matchResults.NextMatch();
            }
            Console.ReadKey();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-23T23:14:20.910

使用正则表达式首先找到键值对然后进行拆分......似乎不对。

我对完整的正则表达式解决方案感兴趣。

任何人？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T23:17:33.383

看一下这个

```
\<a\s+href\s*=\s*["'](?<baseUri>.+?)\?(?:(?<key>.+?)=(?<value>.+?)[&"'])*\s*\> 
```

您可以通过 Groups["key"].Captures[i] & Groups["value"].Captures[i] 获得对

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T23:23:49.143

也许是这样的（我对正则表达式很生疏，而且一开始并不擅长它们。未经测试）：

```
/href="[^?]*([?&](userId=(?<user>\d+))|section=(?<section>\d+))*"/ 
```

（顺便说一下，XHTML 格式不正确；& 应该是 & 在属性中。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-24T14:18:03.253

一个克服排序问题的简单python实现

```
In [2]: x = re.compile('(?:(userId|section)=(\d+))+')

In [3]: t = 'href="file.aspx?section=2&userId=123"'

In [4]: x.findall(t)
Out[4]: [('section', '2'), ('userId', '123')]

In [5]: t = 'href="file.aspx?userId=123&section=2"'

In [6]: x.findall(t)
Out[6]: [('userId', '123'), ('section', '2')] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-24T05:34:16.057

另一种方法是将捕获组放在前瞻中：

```
Regex r = new Regex(@"<a href=""file\.aspx\?" +
                    @"(?=[^""<>]*?user=(?<user>\w+))" +
                    @"(?=[^""<>]*?section=(?<section>\w+))"; 
```

如果只有两个参数，则没有理由比 Mike 和 strager 建议的基于交替的方法更喜欢这种方式。但是，如果您需要匹配*三个*参数，其他正则表达式将增长到其当前长度的几倍，而这个正则表达式只需要另一个前瞻，就像现有的两个一样。

顺便说一句，与您对克劳斯的回应相反，您使用哪种语言非常重要。从一种语言到另一种语言，功能、语法和 API 存在巨大差异。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-24T09:36:19.297

您没有说您使用的是哪种正则表达式风格。由于您的示例 URL 链接到 .aspx 文件，我将假设为 .NET。在 .NET 中，一个正则表达式可以有多个具有相同名称的命名捕获组，并且 .NET 会将它们视为一个组。因此，您可以使用正则表达式

```
userID=(?<user>\d+)&section=(?<section>\d+)|section=(?<section>\d+)&userID=(?<user>\d+) 
```

这个带有交替的简单正则表达式将比任何环视技巧更有效。如果您的要求包括仅在参数位于链接中时匹配参数，则可以轻松扩展它。*******`**